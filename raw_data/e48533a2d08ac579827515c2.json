{
    "url": "http://localhost:9999/artema/FlashWarp/docs/flash/help.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Cross-site scripting (DOM-based)",
    "issueType": 2097936,
    "severity": "High",
    "confidence": "Firm",
    "issueBackground": "DOM-based cross-site scripting vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the HTML document in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause JavaScript code supplied by the attacker to execute within the user's browser in the context of that user's session with the application.<br><br>The attacker-supplied code can perform a wide variety of actions, such as stealing the victim's session token or login credentials, performing arbitrary actions on the victim's behalf, and logging their keystrokes.<br><br>Users can be induced to visit the attacker's crafted URL in various ways, similar to the usual attack delivery vectors for reflected cross-site scripting vulnerabilities. ",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based cross-site scripting vulnerabilities is not to dynamically write data into the HTML document that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing script code into the document. In many cases, the relevant data can be validated on a whitelist basis, to allow only content that is known to be safe. In other cases, it will be necessary to sanitize or encode the data. This can be a complex task, and depending on the context that the data is to be inserted may need to involve a combination of JavaScript escaping, HTML encoding, and URL encoding, in the appropriate sequence.",
    "issueDetail": "The application may be vulnerable to DOM-based cross-site scripting. Data is read from <b>window.location.search</b> and written to <b>the 'innerHTML' property of a DOM element</b> via the following statements:<ul><li>var query = window.location.search.substring(1);</li><li>var pairs = query.split(\",\");</li><li>var value = pairs[i].substring(pos+1);</li><li>args[argname] = unescape(value);</li><li>return args;</li><li>var args = getArgs();</li><li>return args[name];</li><li>var externalQuery = GetCookie(\"externalQuery\");</li><li>searchTerm = externalQuery;</li><li>searchTerm = searchTerm.replace (/(%20)+/g,\" \") ;</li><li>searchTerm = searchTerm.toLowerCase();</li><li>searchTerm = filterTheChars(searchTerm);</li><li>ch = line.substr(ndx,1);</li><li>retChr = ch;</li><li>retStr += retChr;</li><li>return retStr;</li><li>searchTerm = filterTheChars(searchTerm);</li><li>temp = searchTerm.replace(re_1,\"\");</li><li>searchTerm = temp;</li><li>tempArr = searchTerm.split(\" \",100);</li><li>myArr[myArr.length] = tempArr[ndx];</li><li>searchTerm = searchTerm + myArr[ndx] + \" \";</li><li>temp = searchTerm.replace(re_2,\"\");</li><li>searchTerm = temp;</li><li>srch_input_massaged = searchTerm;</li><li>stStr = \"&lt;div class=\\\"form\\\"&gt;\" + MSG_pagesContaining + \"&lt;strong&gt;\" + srch_input_massaged + \"&lt;/strong&gt;&lt;/div&gt;&lt;br /&gt;&lt;br /&gt;\\n\";</li><li>document.getElementById(\"results\").innerHTML = stStr + buildHtmlResultsStr();</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/artema/FlashWarp/docs/flash/help.js",
                "path": "/artema/FlashWarp/docs/flash/help.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9hcnRlbWEvRmxhc2hXYXJwL2RvY3MvZmxhc2gvaGVscC5qcyBIVFRQLzEuMQ0KSG9zdDogbG9jYWxob3N0Ojk5OTkNCg0K",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMjUzNjcNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IEZyaSwgMDcgTm92IDIwMTQgMDA6MjQ6MDIgR01UDQpMYXN0LU1vZGlmaWVkOiBGcmksIDA3IE5vdiAyMDE0IDAwOjI0OjAyIEdNVA0KDQovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwovLwovLyAgQURPQkUgU1lTVEVNUyBJTkNPUlBPUkFURUQKLy8gIENvcHlyaWdodCAyMDA4IEFkb2JlIFN5c3RlbXMgSW5jb3Jwb3JhdGVkCi8vICBBbGwgUmlnaHRzIFJlc2VydmVkLgovLwovLyAgTk9USUNFOiBBZG9iZSBwZXJtaXRzIHlvdSB0byB1c2UsIG1vZGlmeSwgYW5kIGRpc3RyaWJ1dGUgdGhpcyBmaWxlCi8vICBpbiBhY2NvcmRhbmNlIHdpdGggdGhlIHRlcm1zIG9mIHRoZSBsaWNlbnNlIGFncmVlbWVudCBhY2NvbXBhbnlpbmcgaXQuCi8vCi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgoKZnVuY3Rpb24gY2xvc2VQb3B1cCgpCnsKICB3aW5kb3cuY2xvc2UoKTsKfQpmdW5jdGlvbiBzY3JvbGxUb05hbWVBbmNob3IoKSAKewoJdmFyIG5hbWVBbmNob3IgPSB3aW5kb3cubG9jYXRpb24uaHJlZjsKCXZhciB2YWx1ZSA9IG5hbWVBbmNob3Iuc3BsaXQoIm5hbWVBbmNob3I9Iik7CgkKCWlmICh2YWx1ZVsxXSAhPSBudWxsKSB7IAoJCWRvY3VtZW50LmxvY2F0aW9uID12YWx1ZVswXSsiIyIrIHZhbHVlWzFdOwoJfQp9Ci8vIEhJREVTIEFORCBTSE9XUyBMQVJHRSBHUkFQSElDUyBJTiBUSEUgQ09OVEVOVCBQQUdFUwpmdW5jdGlvbiBzaG93SGlkZUltYWdlKHRoaXNJRCwgb2JqKSAKewoJCgl2YXIgaW1nRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXNJRCk7Cgl2YXIgaW1nVGV4dCA9IG9iajsKCglpZiggaW1nRWxlbWVudC5jbGFzc05hbWUgPT0gImxhcmdlSW1hZ2UiICkKCXsKCQkJaW1nRWxlbWVudC5zcmMgPSAiaW1hZ2VzLyIgKyB0aGlzSUQgKyAiLnBuZyI7CgkJCWltZ0VsZW1lbnQuY2xhc3NOYW1lPSJzbWFsbEltYWdlIjsKCQkJb2JqLmNsYXNzTmFtZT0ic2hvd0ltYWdlTGluayI7CgkJCW9iai5ocmVmPSIjIjsKCQkJb2JqLmZpcnN0Q2hpbGQubm9kZVZhbHVlID0gdGVybXNfQUhWX0xBUkdFX0dSQVBISUM7CgkJCXdpbmRvdy5mb2N1cygpOwoJfQoJZWxzZQoJewoJCQlpbWdFbGVtZW50LnNyYyA9ICJpbWFnZXMvIiArIHRoaXNJRCArICJfcG9wdXAucG5nIjsKCQkJaW1nRWxlbWVudC5jbGFzc05hbWU9ImxhcmdlSW1hZ2UiOwoJCQlvYmouY2xhc3NOYW1lPSJoaWRlSW1hZ2VMaW5rIjsKCQkJb2JqLmhyZWY9IiMiOwoJCQlvYmouZmlyc3RDaGlsZC5ub2RlVmFsdWUgPSB0ZXJtc19BSFZfU01BTExfR1JBUEhJQzsKCQkJd2luZG93LmZvY3VzKCk7Cgl9Cn0KLy8ganMgZnVuY3Rpb24gZm9yIGV4cGFuZCBjb2xsYXBzZSBtZW51IGZ1bmN0aW9uYWxpdHkKZnVuY3Rpb24gS2V5Q2hlY2soZSwgdHJlZSwgaWR4KQp7CiAgdmFyIEtleUlEID0gKHdpbmRvdy5ldmVudCkgPyBldmVudC5rZXlDb2RlIDogZS5rZXlDb2RlOwogIHZhciBub2RlID0gIFlBSE9PLndpZGdldC5UcmVlVmlldy5nZXROb2RlKHRyZWUsIGlkeCk7CiAgIHN3aXRjaChLZXlJRCkKICAgewogICAgICBjYXNlIDM3OgogICAgIC8vIGFsZXJ0KCJBcnJvdyBMZWZ0Iik7CiAgICAgIG5vZGUuY29sbGFwc2UoKTsKICAgICAgYnJlYWs7CiAgICAgIGNhc2UgMzk6CiAgICAgLy8gYWxlcnQoIkFycm93IFJpZ2h0Iik7CiAgICAgIG5vZGUuZXhwYW5kKCk7CiAgICAgIGJyZWFrOwogICB9Cn0KLy8ganMgZnVuY3Rpb24gZm9yIGhpZGUvZGlzcGxheSBtaW5pLWVsZW1lbnRzIGZ1bmN0aW9uYWxpdHkKZnVuY3Rpb24gdG9nZ2xlTGF5ZXIod2hpY2hMYXllcikgewoJaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKSB7CgkJLy8gdGhpcyBpcyB0aGUgd2F5IHRoZSBzdGFuZGFyZHMgd29yawoJCXZhciBvYmo9ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQod2hpY2hMYXllcik7CgkJdmFyIGltZyA9IG9iai5wcmV2aW91c1NpYmxpbmcuZmlyc3RDaGlsZC5maXJzdENoaWxkOwoJCWltZy5zZXRBdHRyaWJ1dGUoInNyYyIsImltYWdlcy9vbi5naWYiKTsKCQl2YXIgc3R5bGVhdHQgPSBvYmouc3R5bGU7CgkJc3R5bGVhdHQuZGlzcGxheSA9IHN0eWxlYXR0LmRpc3BsYXk/ICIiOiJibG9jayI7CgkJCgkJLy9jaGFuZ2UgdGhlIGNsYXNzIG9mIHRoZSBoMyBwZXIgZGVzaWduCgkJaWYgKG9iai5wcmV2aW91c1NpYmxpbmcuY2xhc3NOYW1lID09PSAidG9waWN0aXRsZTMiKQl7CgkJCW9iai5wcmV2aW91c1NpYmxpbmcuY2xhc3NOYW1lID0idG9waWN0aXRsZTNvZmYiOwoJCSAgICBpbWcuc2V0QXR0cmlidXRlKCJzcmMiLCJpbWFnZXMvb24uZ2lmIik7CgkJfSBlbHNlIGlmIChvYmoucHJldmlvdXNTaWJsaW5nLmNsYXNzTmFtZSA9PT0gInRvcGljdGl0bGUzb2ZmIikJewoJCQlvYmoucHJldmlvdXNTaWJsaW5nLmNsYXNzTmFtZSA9InRvcGljdGl0bGUzIjsKCQkJaW1nLnNldEF0dHJpYnV0ZSgic3JjIiwiaW1hZ2VzL29mZi5naWYiKTsKCQl9IAoJfQoJZWxzZSBpZiAoZG9jdW1lbnQuYWxsKSB7CgkJLy8gdGhpcyBpcyB0aGUgd2F5IG9sZCBtc2llIHZlcnNpb25zIHdvcmsKCQl2YXIgc3R5bGUyID0gZG9jdW1lbnQuYWxsW3doaWNoTGF5ZXJdLnN0eWxlOwoJCXN0eWxlMi5kaXNwbGF5ID0gc3R5bGUyLmRpc3BsYXk/ICIiOiJibG9jayI7Cgl9Cn0KIGZ1bmN0aW9uIGFkZEJvb2ttYXJrKCBibV91cmxfc3RyLCBibV9zdHJfbGFiZWwgKSB7CiAgcGFyZW50Lm5hdmlnYXRpb24uZmxhc2hQcm94eS5jYWxsKCdhZGRCb29rbWFyaycsIGJtX3VybF9zdHIsIGJtX3N0cl9sYWJlbCApOwp9Cgp2YXIgdXBwZXJBc2NpaVhsYXRUYmwgPSBuZXcgQXJyYXkoCjIyMywic3MiLAoyMzAsImFlIiwKMTk4LCJhZSIsCjE1Niwib2UiLAoxNDAsIm9lIiwKMjQwLCJldGgiLAoyMDgsImV0aCIsCjE0MSwieSIsCjE1OSwieSIKKTsKCnZhciBtYXhOdW1iZXJPZlNob3duU2VhcmNoSGl0cyA9IDMwOwp2YXIgc2hvd0lucHV0U3RyaW5nQWxlcnRzID0gMDsKdmFyIG5hdmlnYXRpb25Db29raWUgPSAiIjsKCi8vLy8vLy8vLy8vLy8vIENPT0tJRS1SRUxBVEVEIEZVTkNUSU9OUyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwovLyAgdGVzdCB0aGUgbmF2aWdhdG9yIG9iamVjdCBmb3IgY29va2llIGVuYWJsaW5nCi8vICBhZGRpdGlvbmFsIGNvZGUgd291bGQgbmVlZCB0byBiZSBhZGRlZCBmb3IKLy8gIHRvIHN1cHBvcnQgYnJvd3NlcnMgcHJlIG5hdmlnYXRvciA0IG9yIElFNSBvciAKLy8gIG90aGVyIGJyb3dzZXJzIHRoYXQgZG9udCBzdXBwb3J0Ci8vICB0aGUgbmF2aWdhdG9yIG9iamVjdCBpZiBhbnkgLi4gCiBmdW5jdGlvbiBjb29raWVzTm90RW5hYmxlZCgpIAp7CglyZXR1cm4gdHJ1ZTsgICAgIC8vIFdlJ3JlIG5vdCBnb2luZyB0byB1c2UgY29va2llcwp9Ci8qCiAqIFRoaXMgZnVuY3Rpb24gcGFyc2VzIGNvbW1hLXNlcGFyYXRlZCBuYW1lPXZhbHVlIAogKiBhcmd1bWVudCBwYWlycyBmcm9tIHRoZSBxdWVyeSBzdHJpbmcgb2YgdGhlIFVSTC4gCiAqIEl0IHN0b3JlcyB0aGUgbmFtZT12YWx1ZSBwYWlycyBpbiAKICogcHJvcGVydGllcyBvZiBhbiBvYmplY3QgYW5kIHJldHVybnMgdGhhdCBvYmplY3QuCiAqLwpmdW5jdGlvbiBnZXRBcmdzKCkgCnsKCXZhciBhcmdzID0gbmV3IE9iamVjdCgpOwoJdmFyIHF1ZXJ5ID0gd2luZG93LmxvY2F0aW9uLnNlYXJjaC5zdWJzdHJpbmcoMSk7IAoJLy8gR2V0IHF1ZXJ5IHN0cmluZwoJaWYgKHF1ZXJ5Lmxlbmd0aCA+IDApCXsKCQl2YXIgcGFpcnMgPSBxdWVyeS5zcGxpdCgiLCIpOwoJCS8vIEJyZWFrIGF0IGNvbW1hCgkJZm9yKHZhciBpID0gMDsgaSA8IHBhaXJzLmxlbmd0aDsgaSsrKSAKCQl7CgkJCXZhciBwb3MgPSBwYWlyc1tpXS5pbmRleE9mKCc9Jyk7CgkJCSAgLy8gTG9vayBmb3IgIm5hbWU9dmFsdWUiCgkJCWlmIChwb3MgPT0gLTEpIGNvbnRpbnVlOwoJCQkgIC8vIElmIG5vdCBmb3VuZCwgc2tpcAoJCQl2YXIgYXJnbmFtZSA9IHBhaXJzW2ldLnN1YnN0cmluZygwLHBvcyk7CgkJCSAgLy8gRXh0cmFjdCB0aGUgbmFtZQoJCQl2YXIgdmFsdWUgPSBwYWlyc1tpXS5zdWJzdHJpbmcocG9zKzEpOwoJCQkgIC8vIEV4dHJhY3QgdGhlIHZhbHVlCgkJCWFyZ3NbYXJnbmFtZV0gPSB1bmVzY2FwZSh2YWx1ZSk7CgkJICAJICAvLyBTdG9yZSBhcyBhIHByb3BlcnR5CgkJCSAgLy8gSW4gSmF2YVNjcmlwdCAxLjUsIHVzZSBkZWNvZGVVUklDb21wb25lbnQoICApIAoJCQkgIC8vIGluc3RlYWQgb2YgZXNjYXBlKCAgKQoJCX0KCX0gZWxzZSB7CgkJYXJnc1tuYW1lXSA9IGZhbHNlOwkJCgl9CglyZXR1cm4gYXJnczsgICAgIC8vIFJldHVybiB0aGUgb2JqZWN0Cn0KCi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8gQ09PS0lFLVJFTEFURUQgRlVOQ1RJT05TIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwovLyBCaWxsIERvcnRjaCBnZXRDb29raWVWYWwgYW5kIEdldENvb2tpZSByb3V0aW5lcwpmdW5jdGlvbiBnZXRDb29raWVWYWwob2Zmc2V0KSB7CiAgdmFyIGVuZHN0cj1kb2N1bWVudC5jb29raWUuaW5kZXhPZigiOyIsb2Zmc2V0KTsKICBpZiAoZW5kc3RyPT0tMSllbmRzdHI9ZG9jdW1lbnQuY29va2llLmxlbmd0aDsKICByZXR1cm4gdW5lc2NhcGUoZG9jdW1lbnQuY29va2llLnN1YnN0cmluZyhvZmZzZXQsIGVuZHN0cikpOwp9CmZ1bmN0aW9uIEdldENvb2tpZShuYW1lKSB7CiAgdmFyIGFyZz1uYW1lKyI9IjsKICB2YXIgYWxlbj1hcmcubGVuZ3RoOwogIHZhciBjbGVuPWRvY3VtZW50LmNvb2tpZS5sZW5ndGg7CiAgdmFyIGk9MDsKCiAgaWYgKGNvb2tpZXNOb3RFbmFibGVkKCkpCiAgewoJdmFyIGFyZ3MgPSBnZXRBcmdzKCk7CglpZiAoYXJnc1tuYW1lXSAhPT0gZmFsc2UpIHsgCgkJcmV0dXJuIGFyZ3NbbmFtZV07Cgl9CQogIH0gZWxzZSB7CgkgIHdoaWxlKGk8Y2xlbil7CgkgICAgdmFyIGo9aSthbGVuOwoJICAgIGlmKGRvY3VtZW50LmNvb2tpZS5zdWJzdHJpbmcoaSxqKT09YXJnKXJldHVybiBnZXRDb29raWVWYWwoaik7CgkgICAgaT1kb2N1bWVudC5jb29raWUuaW5kZXhPZigiICIsaSkrMTsKCSAgICBpZihpPT0wKWJyZWFrOyAKCSAgfQoJICByZXR1cm4gbnVsbDsKCX0KfQpmdW5jdGlvbiBnZXRUb3BDb29raWVWYWwob2Zmc2V0KSB7CiAgdmFyIGVuZHN0cj1kb2N1bWVudC5jb29raWUuaW5kZXhPZigiOyIsb2Zmc2V0KTsKICBpZiAoZW5kc3RyPT0tMSllbmRzdHI9ZG9jdW1lbnQuY29va2llLmxlbmd0aDsKICByZXR1cm4gdW5lc2NhcGUoZG9jdW1lbnQuY29va2llLnN1YnN0cmluZyhvZmZzZXQsIGVuZHN0cikpOwp9CmZ1bmN0aW9uIEdldFRvcENvb2tpZShuYW1lKSB7CiAgdmFyIGFyZz1uYW1lKyI9IjsKICB2YXIgYWxlbj1hcmcubGVuZ3RoOwogIHZhciBjbGVuPWRvY3VtZW50LmNvb2tpZS5sZW5ndGg7CiAgdmFyIGk9MDsKICB3aGlsZShpPGNsZW4pewogICAgdmFyIGo9aSthbGVuOwogICAgaWYoZG9jdW1lbnQuY29va2llLnN1YnN0cmluZyhpLGopPT1hcmcpcmV0dXJuIGdldFRvcENvb2tpZVZhbChqKTsKICAgIGk9ZG9jdW1lbnQuY29va2llLmluZGV4T2YoIiAiLGkpKzE7CiAgICBpZihpPT0wKWJyZWFrOyAKICB9CiAgcmV0dXJuIG51bGw7Cn0KLy8gU2V0Q29va2llCi8vIC0tLS0tLS0tLS0tCi8vIFRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIHRvIHNldCBhIGNvb2tpZSBpbiB0aGUgY3VycmVudCBkb2N1bWVudC4KLy8gIHBhcmFtczoKLy8JCW4gLSBuYW1lIG9mIHRoZSBjb29raWUKLy8JCXYgLSB2YWx1ZSBvZiB0aGUgY29va2llCi8vCQltaW51dGVzIC0gdGhlIGR1cmF0aW9uIG9mIHRoZSBjb29raWUgaW4gbWludXRlcyAodGhhdCBpcywgaG93IG1hbnkgbWludXRlcyBiZWZvcmUgaXQgZXhwaXJlcykKZnVuY3Rpb24gU2V0Q29va2llKG4sdixtaW51dGVzKSB7CiB2YXIgVGhlbiA9IG5ldyBEYXRlKCk7CiBUaGVuLnNldFRpbWUoVGhlbi5nZXRUaW1lKCkgKyBtaW51dGVzICogNjAgKiAxMDAwKTsKIGRvY3VtZW50LmNvb2tpZSA9IG4gKyAiPSIgKyB2ICsgIjtleHBpcmVzPSIgKyBUaGVuLnRvR01UU3RyaW5nKCk7Cn0KLy8gZ2V0Q29udGVudENvb2tpZQovLyAtLS0tLS0tLS0tLS0tLS0tCi8vIFRoaXMgZnVuY3Rpb24gcmVhZHMgdGhlIGNvbnRlbnQgY29va2llIHNldCBieSB0aGUgaGFuZGxlQ29udGV4dCBmdW50aW9uLgovLwpmdW5jdGlvbiBnZXRDb250ZW50Q29va2llKCkKewoJdmFyIGNvbnRlbnRDb29raWUgPSBHZXRDb29raWUoImNvbnRlbnQiKTsKCWRvY3VtZW50LmNvb2tpZSA9ICJjb250ZW50PSI7CgoJLy8gV2hhdCBkb2VzIHRoaXMgZXhwcmVzc2lvbiBtZWFuPwoJLy8gKGNvbnRlbnRDb29raWUuaW5kZXhPZigiaHRtIikgIT0gLTEpCglpZiAoIChjb250ZW50Q29va2llICE9IG51bGwpICYmIChjb250ZW50Q29va2llLmluZGV4T2YoImh0bSIpICE9IC0xKSApIAoJewoJCWRvY3VtZW50LmNvb2tpZSA9ICJjb250ZW50PSI7IC8vIFdpcGUgb3V0IHRoZSBjb29raWUKCQlkb2N1bWVudC5jb29raWUgPSAiaGlzdFI9IiArIGNvbnRlbnRDb29raWU7CgkJbG9jYXRpb24ucmVwbGFjZShjb250ZW50Q29va2llKTsKCX0JCQkKfQovLyBnZXROYXZpZ2F0aW9uQ29va2llCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gVGhpcyBmdW5jdGlvbiByZWFkcyB0aGUgY29udGVudCBjb29raWUgc2V0IGJ5IHRoZSBoYW5kbGVDb250ZXh0IGZ1bnRpb24uCi8vCmZ1bmN0aW9uIGdldE5hdmlnYXRpb25Db29raWUoKQp7CgluYXZpZ2F0aW9uQ29va2llID0gR2V0Q29va2llKCJuYXZpZ2F0aW9uIik7Cglkb2N1bWVudC5jb29raWUgPSAibmF2aWdhdGlvbj0iOwoKCS8vIFdoYXQgZG9lcyB0aGlzIGV4cHJlc3Npb24gbWVhbj8KCS8vIChuYXZpZ2F0aW9uQ29va2llLmluZGV4T2YoImh0bSIpICE9IC0xKQoJaWYgKCAobmF2aWdhdGlvbkNvb2tpZSAhPSBudWxsKSAmJiAobmF2aWdhdGlvbkNvb2tpZS5pbmRleE9mKCJodG0iKSAhPSAtMSkgKSAKCXsKCQlkb2N1bWVudC5jb29raWUgPSAibmF2aWdhdGlvbj0iOyAvLyBXaXBlIG91dCB0aGUgY29va2llCgkJZG9jdW1lbnQuY29va2llID0gImhpc3RMPSIgKyBuYXZpZ2F0aW9uQ29va2llOwoJCWxvY2F0aW9uLnJlcGxhY2UobmF2aWdhdGlvbkNvb2tpZSk7Cgl9CgkJCQkKfQoKLy8gaGFuZGxlQ29udGV4dAovLyAtLS0tLS0tLS0tLS0tCi8vIFRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIGZyb20gY29udGVudCBwYWdlcy4gSXQgc2V0cyBhIGNvb2tpZSBhcyBzb29uCi8vIGFzIHRoZSBwYWdlIGlzIGxvYWRlZC4gSWYgdGhlIGNvbnRlbnQgcGFnZSBpcyBub3QgaW4gaXQncyBwcm9wZXIgcGxhY2UKLy8gaW4gdGhlIGZyYW1lc2V0LCB0aGUgZnJhbWVzZXQgd2lsbCBiZSBsb2FkZWQgYW5kIHRoZSBwYWdlIHdpbGwgYmUgCi8vIHJlc3RvcmVkIHVzaW5nIHRoZSB2YWx1ZSBpbiB0aGlzIGNvb2tpZS4KLy8KZnVuY3Rpb24gaGFuZGxlQ29udGV4dCh3aGljaCkKewp9Ci8vIGxhc3ROb2RlT2YKLy8gLS0tLS0tLS0tLQovLyBUaGlzIGZ1bmN0aW9uIGdldHMgcGFzc2VkIGEgVVJMIGFuZCByZXR1cm5zIHRoZSBsYXN0IG5vZGUgb2Ygc2FtZS4KZnVuY3Rpb24gbGFzdE5vZGVPZihlKQp7Cgl2YXIgZXhwciA9ICIiICsgZTsKCXZhciB0byA9IGV4cHIuaW5kZXhPZigiPyIpOwoJaWYoIHRvICE9PSAtMSkgewoJCXZhciBwYXRoID0gZXhwci5zdWJzdHJpbmcoMCx0byk7CQkKCQl2YXIgcGllY2VzID0gcGF0aC5zcGxpdCgiLyIpOwoJCXJldHVybiBwaWVjZXNbcGllY2VzLmxlbmd0aCAtMV07Cgl9ICBlbHNlCXsJCgkJdmFyIHBvcyA9IGV4cHIubGFzdEluZGV4T2YoIi8iKTsJCgkJaWYoIChwb3MgIT0gLTEpICYmIChwb3MrMSAhPSBleHByLmxlbmd0aCkgKSB7CgkJCXJldHVybiBleHByLnN1YnN0cihwb3MrMSk7CgkJfSBlbHNlIHsKCQkJcmV0dXJuIGV4cHI7CgkJfQoJfQp9Ci8vIGZyYW1lQnVzdGVyCi8vIC0tLS0tLS0tLS0tCi8vIFRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIGJ5IHRoZSBmcmFtZXNldCB0byBlbnN1cmUgaXQncyBhbHdheXMgbG9hZGVkCi8vIGF0IHRoZSB0b3AgbGV2ZWwgb2YgdGhlIGN1cnJlbnQgd2luZG93LgovLwpmdW5jdGlvbiBmcmFtZUJ1c3RlcigpCnsKfQoKCi8vIFNFQVJDSCBSRUxBVEVELi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uU0VBUkNIIFJFTEFURUQKLy8gU0VBUkNIIFJFTEFURUQuLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi5TRUFSQ0ggUkVMQVRFRAovLyBTRUFSQ0ggUkVMQVRFRC4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLlNFQVJDSCBSRUxBVEVECi8vIFNFQVJDSCBSRUxBVEVELi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uU0VBUkNIIFJFTEFURUQKLy8gU0VBUkNIIFJFTEFURUQuLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi5TRUFSQ0ggUkVMQVRFRAovLyBTRUFSQ0ggUkVMQVRFRC4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLlNFQVJDSCBSRUxBVEVECi8vIFNFQVJDSCBSRUxBVEVELi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uU0VBUkNIIFJFTEFURUQKLy8gU0VBUkNIIFJFTEFURUQuLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi5TRUFSQ0ggUkVMQVRFRAovLyBTRUFSQ0ggUkVMQVRFRC4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLlNFQVJDSCBSRUxBVEVECi8vIFNFQVJDSCBSRUxBVEVELi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uU0VBUkNIIFJFTEFURUQKZnVuY3Rpb24gYnViYmxlU29ydFdpdGhTaGFkb3coYSxiKQp7Cgl2YXIgdGVtcDsKCWZvcih2YXIgaj0xOyBqPGEubGVuZ3RoOyBqKyspIHsKCQlmb3IodmFyIGk9MDsgaTxqOyBpKyspIHsKCQkJaWYoIGFbaV0gPCBhW2pdICkgewkKCQkJCXRlbXAgPSBhW2pdO2Fbal0gPSBhW2ldO2FbaV0gPSB0ZW1wOwoJCQkJdGVtcCA9IGJbal07YltqXSA9IGJbaV07YltpXSA9IHRlbXA7CgkJCX0KCQl9Cgl9Cn0KLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KZnVuY3Rpb24gYnVpbGRIdG1sUmVzdWx0c1N0cigpCnsKCXZhciBpbm5lckhUTUxzdHJpbmcsbmR4RW5kOwoKCS8vIEdhdGhlciBhbGwgb2YgdGhlIHJlc3VsdHMgZGlzcGxheSBsaW5lcyBpbnRvIHRoZSAncmVzdWx0c0FycicKCW5keEVuZCA9IChtYXRjaGVzQXJySW5kaWNlcy5sZW5ndGggPiBtYXhOdW1iZXJPZlNob3duU2VhcmNoSGl0cyApID8gbWF4TnVtYmVyT2ZTaG93blNlYXJjaEhpdHMgOiBtYXRjaGVzQXJySW5kaWNlcy5sZW5ndGg7CgoJZm9yKHZhciBuZHg9MCwgcmVzdWx0c0FyciA9IG5ldyBBcnJheSgpOyBuZHggPCBuZHhFbmQ7IG5keCsrKSB7CgkJcmVzdWx0c0FycltyZXN1bHRzQXJyLmxlbmd0aF0gPSBidWlsZFJlc3VsdHNTdHJPbmVMaW5lKG1hdGNoZXNBcnJJbmRpY2VzW25keF0sbWF0Y2hlc0FyckhpdHNbbmR4XSk7Cgl9CgoJLy8gQ29udmVydCB0aGlzICdyZXN1bHRzQXJyJyBpbnRvIGEgc2luZ2xlIHN0cmluZyB0aGF0IHdpbGwgYmUgaW5qZWN0ZWQgaW50byB0aGlzIHNlYXJjaCBwYWdlLgoJaW5uZXJIVE1Mc3RyaW5nID0gIjxvbD4iOwoJZm9yKCB2YXIgbmR4PTA7IG5keCA8IHJlc3VsdHNBcnIubGVuZ3RoOyBuZHgrKyApIHsKCQlpbm5lckhUTUxzdHJpbmcgPSBpbm5lckhUTUxzdHJpbmcgKyByZXN1bHRzQXJyW25keF07Cgl9Cglpbm5lckhUTUxzdHJpbmcgPSBpbm5lckhUTUxzdHJpbmcgKyAiPC9vbD4iOwoJcmV0dXJuIGlubmVySFRNTHN0cmluZzsKfQovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpmdW5jdGlvbiBidWlsZFJlc3VsdHNTdHJPbmVMaW5lKGEsYikKewoJdmFyIHJldFN0cjsKCXJldFN0ciA9ICI8bGkgY2xhc3M9XCJzZWFyY2hyZXN1bHRzXCI+PGEgaHJlZj1cIiIgKyBmaWxlQXJyW2FdICsgIi5odG1sXCI+IjsKCgkvLyBmb3IgZGVidWcuLi4KCS8vcmV0U3RyICs9ICJ0YXJnZXQ9XCJjb250ZW50XCIgIjsKCS8vcmV0U3RyICs9ICJ0aXRsZT1cIiIgKyB0b3AuZmlsZUFyclthXSArICIuaHRtbC0iOwoJLy9yZXRTdHIgKz0gYSArICItIiArIGIgKyAiXCI+IjsKCgkvLyBmb3IgcHJvZHVjdGlvbi4uLgoJLy9yZXRTdHIgKz0gInRhcmdldD1cIkFkb2JlSGVscFwiID4iOwoKCXJldFN0ciArPSB0aXRsZUFyclthXSArICI8L2E+PC9saT4iOwoJcmV0dXJuIHJldFN0cjsKfQovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyBjaGVja0ZvckhpdHMKLy8gIEJyZWFrIHVwIHRoZSBzZWFyY2ggdGVybSBpbnRvIHdvcmRzLgovLyAgQ2hlY2sgZWFjaCBvZiB0aG9zZSB3b3JkcyBhZ2FpbnN0Li4uCi8vCQkoYSkgY2FjaGVkIHRpdGxlcyBhbmQgCi8vCQkoYikgY2FjaGVkIGNvbnRlbnQgbGluZXMgCi8vICBQZXJmb3JtIHRoZSBoaXQgZGV0ZWN0aW9uIGZvciBlYWNoIG9uZSwgCi8vICBzdG9yaW5nIHRoZSByZXN1bHRzIGludG8gKGhpdHMtb3JkZXJlZCkgCi8vCQknbWF0Y2hlc0FyckluZGljZXMnIGFuZCAKLy8JCSdtYXRjaGVzQXJySGl0cycuCi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmZ1bmN0aW9uIGNoZWNrRm9ySGl0cygpCnsKCXZhciBpbnB1dFdvcmRzID0gbmV3IEFycmF5KCk7Cgl2YXIgdGVtcEFyciA9IG5ldyBBcnJheSgpOwoKCS8vIFNwbGl0IHRoZSBzZWFyY2ggdGVybSBpbnRvIGluZGl2aWR1YWwgc2VhcmNoIHdvcmRzCgkJdGVtcEFyciA9IHNlYXJjaFRlcm0uc3BsaXQoIiAiKTsKCQlmb3IodmFyIG5keD0wOyBuZHggPCB0ZW1wQXJyLmxlbmd0aDsgbmR4KyspIHsKCQkJaWYoIHRlbXBBcnJbbmR4XS5sZW5ndGggKSB7CgkJCQlpbnB1dFdvcmRzW2lucHV0V29yZHMubGVuZ3RoXSA9IHRlbXBBcnJbbmR4XTsKCQkJfQoJCX0KCgkvLyBJbml0aWFsaXphdGlvbgoJCW1hdGNoZXNBcnJIaXRzID0gbmV3IEFycmF5KCk7CgkJbWF0Y2hlc0FyckluZGljZXMgPSBuZXcgQXJyYXkoKTsKCgkvLyBJbml0aWFsaXplIHRoZSAnbWFza0FycicgYW5kIHRoZSAnaGl0c0FycicKCQltYXNrQXJyID0gbmV3IEFycmF5KCk7CgkJaGl0c0FyciA9IG5ldyBBcnJheSgpOwoJCWZvciggdmFyIG5keCA9IDA7IG5keCA8IGZpbGVBcnIubGVuZ3RoOyBuZHgrKyApIHsKCQkJbWFza0FyclttYXNrQXJyLmxlbmd0aF0gPSAxOwoJCQloaXRzQXJyW2hpdHNBcnIubGVuZ3RoXSA9IDA7CgkJfQoKCS8vIERvIGNoZWNraW5nIGZvciBtYXRjaGVzIG9uIEVBQ0ggT0YgVEhFIElOUFVUIFdPUkRTCgkJZm9yKCB2YXIgbmR4ID0gMDsgbmR4IDwgaW5wdXRXb3Jkcy5sZW5ndGg7IG5keCsrICkgewoKCQkJLy8gISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhCgkJCWlmKCAhIGNoZWNrRm9ySGl0c1dvcmRBZ2FpbnN0UGFnZXMoIGlucHV0V29yZHNbbmR4XSApICkgewoJCQkJcmV0dXJuOyAJLy8gTm8gc2Vuc2UgaW4gY29udGludWluZywgbWF0Y2ggaGFzIGZhaWxlZC4KCQkJfQoJCQkvLyAhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEKCgkJCWZvciggdmFyIG5keDIgPSAwOyBuZHgyIDwgaGl0c0Fyci5sZW5ndGg7IG5keDIrKyApIHsKCQkJCWlmKCBoaXRzQXJyW25keDJdID09IDAgKSB7CgkJCQkJbWFza0FycltuZHgyXSA9IDA7CgkJCQl9CgkJCQllbHNlIHsKCQkJCQlpZiggbWFza0FycltuZHgyXSAhPSAwICkgewoJCQkJCQltYXNrQXJyW25keDJdICs9IGhpdHNBcnJbbmR4Ml07CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoKCS8vIEZyb20gdGhlIGZpbmFsICdtYXNrQXJyJywgZ2VuZXJhdGUgJ21hdGNoZXNBcnJIaXRzJyBhbmQgJ21hdGNoZXNBcnJJbmRpY2VzJwkKCQlmb3IoIHZhciBuZHggPSAwOyBuZHggPCBtYXNrQXJyLmxlbmd0aDsgbmR4KysgKSB7CgkJCWlmKCBtYXNrQXJyW25keF0gKSB7CgkJCQltYXRjaGVzQXJySGl0c1ttYXRjaGVzQXJySGl0cy5sZW5ndGhdID0gbWFza0FycltuZHhdOwoJCQkJbWF0Y2hlc0FyckluZGljZXNbbWF0Y2hlc0FyckluZGljZXMubGVuZ3RoXSA9IG5keDsKCQkJfQoJCX0KCgkvLyBJZiB0aGVyZSB3ZXJlIGFueSBoaXRzLCB0aGVuIHNvcnQgdGhlbSBieSBoaWdoZXN0IGhpdHMgZmlyc3QKCQlpZiggbWF0Y2hlc0FyckluZGljZXMubGVuZ3RoICkgewoJCQlidWJibGVTb3J0V2l0aFNoYWRvdyhtYXRjaGVzQXJySGl0cywgbWF0Y2hlc0FyckluZGljZXMpOwoJCX0KfQovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpmdW5jdGlvbiBjaGVja0ZvckhpdHNXb3JkQWdhaW5zdFBhZ2VzKHcpCQkKewoJdmFyIGhpdEFueXdoZXJlID0gMDsKCQoJaWYoc2hvd0lucHV0U3RyaW5nQWxlcnRzKXthbGVydCggIkxlbmd0aCBvZiBzYzI6ICIgKyBzYzIubGVuZ3RoICk7fQoKCS8vIFByb2Nlc3MgZWFjaCBvZiB0aGUgY29udGVudCBsaW5lcyAob25lIHBlciBmaWxlL3BhZ2UpCgkJZm9yKHZhciBuZHg9MDsgbmR4IDwgc2MyLmxlbmd0aDsgbmR4KyspIHsKCgkJCS8vIFB1dCB0aGUgY2FjaGVkIHRpdGxlIGludG8gZ2xvYl90aXRsZQoJCQkJZ2xvYl90aXRsZSA9IHNjMVtuZHhdOwoKCQkJLy8gUHV0IHRoZSBjYWNoZWQgY29udGVudCBsaW5lIGludG8gZ2xvYl9waHJhc2UKCQkJCWdsb2JfcGhyYXNlID0gc2MyW25keF07CgkJCQkKCQkJaWYoIG1hc2tBcnJbbmR4XSApIHsKCQkJLy8gISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhIQoJCQkJaWYoIGRvY3VtZW50LmlzRGJsQnl0ZSApIHsKCQkJCQloaXRzQXJyW25keF0gPSBjaGVja0ZvckhpdHNXb3JkQWdhaW5zdFRpdGxlQW5kTGluZTIodyxuZHgpOwoJCQkJfQoJCQkJZWxzZSB7CgkJCQkJaGl0c0FycltuZHhdID0gY2hlY2tGb3JIaXRzV29yZEFnYWluc3RUaXRsZUFuZExpbmUodyxuZHgpOwoJCQkJfQoJCQkJaWYoIGhpdHNBcnJbbmR4XSApIHsKCQkJCQloaXRBbnl3aGVyZSA9IDE7CgkJCQl9CgkJCS8vICEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEKCQkJfQoJCX0KCXJldHVybiBoaXRBbnl3aGVyZTsKfQovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpmdW5jdGlvbiBjaGVja0ZvckhpdHNXb3JkQWdhaW5zdFRpdGxlQW5kTGluZSh3LCBsaW5lTmR4KQp7Cgl2YXIgd29yZHM7Cgl2YXIgdGl0bGVIaXRDbnQgPSAwOwoJdmFyIGNvbnRlbnRIaXRDbnQgPSAwOwoJdmFyIHJlZ2V4ID0gbmV3IFJlZ0V4cCh3LCAiaSIpOwoKCS8vIFRJVExFIC4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uCgkJd29yZHMgPSBuZXcgQXJyYXkoKTsKCQlpZihnbG9iX3RpdGxlIT1udWxsKXsKCQkJd29yZHMgPSBnbG9iX3RpdGxlLnNwbGl0KCIgIik7CgkJfQoJCS8vIEVYRUNVVEUgVElUTEUgTUFUQ0ggVEVTVAoJCWZvciggdmFyIG5keCA9IDA7IG5keCA8IHdvcmRzLmxlbmd0aDsgbmR4KysgKSB7CgkJCWlmKCB3ID09IHdvcmRzW25keF0gKSB7CgkJCQl0aXRsZUhpdENudCArPSAxMDA7CgkJCQlicmVhazsKCQkJfQoJCX0KCgkvLyBDT05URU5UIC4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uCgkJd29yZHMgPSBuZXcgQXJyYXkoKTsKCQlpZihnbG9iX3BocmFzZSE9bnVsbCl7CgkJCXdvcmRzID0gZ2xvYl9waHJhc2Uuc3BsaXQoIiAiKTsKCQl9CgkJLy8gRVhFQ1VURSBDT05URU5UIE1BVENIIFRFU1QKCQlpZiggcmVnZXgudGVzdChnbG9iX3BocmFzZSkgKSB7CS8vIFNlZSBpZiB3b3JkIGlzIGFueXdoZXJlIHdpdGhpbiB0aGUgcGhyYXNlIGZpcnN0LgoJCQlmb3IoIHZhciBuZHggPSAwOyBuZHggPCB3b3Jkcy5sZW5ndGg7IG5keCsrICkgewoJCQkJaWYoIHcgPT0gd29yZHNbbmR4XSApIHsKCQkJCQljb250ZW50SGl0Q250ICs9IGdldEluc3RhbmNlQ291bnQobGluZU5keCxuZHgpOwoJCQkJCWJyZWFrOwoJCQkJfQoJCQkJLy9lbHNlIGlmKCB3IDwgd29yZHNbbmR4XSApIHsgLy8gSWYgd29yZCBpcyBncmVhdGVyIHRoYW4gdGhlIHJlbWFpbmluZyB3b3JkcywgbGVhdmUKCQkJCS8vCWJyZWFrOwoJCQkJLy99CgkJCX0KCQl9CgoJcmV0dXJuIHRpdGxlSGl0Q250ICsgY29udGVudEhpdENudDsKfQovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpmdW5jdGlvbiBjaGVja0ZvckhpdHNXb3JkQWdhaW5zdFRpdGxlQW5kTGluZTIodywgbGluZU5keCkKewoJdmFyIHRpdGxlSGl0Q250ID0gMDsKCXZhciBjb250ZW50SGl0Q250ID0gMDsKCgkvLyBUSVRMRSAuLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLgoJCWlmKCBnbG9iX3RpdGxlLmluZGV4T2YodykgIT0gLTEgKSB7CgkJCXRpdGxlSGl0Q250ID0gMTAwOwoJCX0KCgkvLyBDT05URU5UIC4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uCgkJY29udGVudEhpdENudCA9IGluZGV4ZXNPZihnbG9iX3BocmFzZSx3KTsKCglyZXR1cm4gdGl0bGVIaXRDbnQgKyBjb250ZW50SGl0Q250Owp9Ci8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8vIGNoZWNrVGhlSW5wdXRTdHJpbmcKLy8gCi8vICByZXR1cm5zLi4uCi8vCQllbXB0eSBzdHJpbmcgLSBpZiB0aGVyZSBpcyB2YWxpZCBpbnB1dCB0byBzZWFyY2gKLy8JCW1lc3NhZ2Ugc3RyaW5nIC0gaWYgdGhlcmUgaXMgTk8gVkFMSUQgSU5QVVQgdG8gc2VhcmNoCi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmZ1bmN0aW9uIGNoZWNrVGhlSW5wdXRTdHJpbmcoKQp7Cgl2YXIgbXlBcnIgPSBuZXcgQXJyYXkoKTsKCXZhciB0ZW1wQXJyID0gbmV3IEFycmF5KCk7Cgl2YXIgZm91bmRTdG9wT3JTaG9ydFdvcmQgPSAwOwoJdmFyIHB0bjEgPSAvXGRcRC87Cgl2YXIgcHRuMiA9IC9cRFxkLzsKCgloYW5kbGVXaGl0ZXNwYWNlUmVtb3ZhbCgpOwoJc2VhcmNoVGVybSA9IHNlYXJjaFRlcm0ucmVwbGFjZSAoLyglMjApKy9nLCIgIikgOwoJc2VhcmNoVGVybSA9IHNlYXJjaFRlcm0udG9Mb3dlckNhc2UoKTsKCglzZWFyY2hUZXJtID0gZmlsdGVyVGhlQ2hhcnMoc2VhcmNoVGVybSk7CgkJCgloYW5kbGVXaGl0ZXNwYWNlUmVtb3ZhbCgpOwoKCWlmKCBzZWFyY2hUZXJtLmxlbmd0aCApIHsKCQkKCQkvLyBTcGxpdCB0aGUgc2VhcmNoVGVybQoJCQl0ZW1wQXJyID0gc2VhcmNoVGVybS5zcGxpdCgiICIsMTAwKTsKCQkJaWYoc2hvd0lucHV0U3RyaW5nQWxlcnRzKXthbGVydCggInNpemUgb2YgdGVtcEFycjogIiArIHRlbXBBcnIubGVuZ3RoICk7fQoKCQkvLyBIYW5kbGUgcGVyaW9kcwoJCQlmb3IoIHZhciBuZHggPSAwOyBuZHggPCB0ZW1wQXJyLmxlbmd0aDsgbmR4KysgKSB7CgkJCQlpZiggdGVtcEFycltuZHhdLmNoYXJDb2RlQXQoMCkgPT0gNDYgKSB7CS8vIHBlcmlvZHMgYXQgdGhlIHN0YXJ0IG9mIHdvcmQKCQkJCQkvL3RlbXBBcnJbbmR4XSA9IHRlbXBBcnJbbmR4XS5zdWJzdHIoMSk7IC8vIE5PVEU6IFdlIGRvbid0IHdhbnQgdG8gZG8gdGhpcy4gKGUuZy4gIi50eHQiKQoJCQkJfQoJCQkJaWYoIHRlbXBBcnJbbmR4XS5jaGFyQ29kZUF0KHRlbXBBcnJbbmR4XS5sZW5ndGgtMSkgPT0gNDYgKSB7IC8vIGVuZCBvZiB3b3JkCgkJCQkJdGVtcEFycltuZHhdID0gdGVtcEFycltuZHhdLnN1YnN0cigwLHRlbXBBcnJbbmR4XS5sZW5ndGgtMSk7CgkJCQl9CgkJCX0KCQkJCgkJLy8gRG8gc3RvcHdvcmRzIGFuZCBzaG9ydHdvcmRzIHJlbW92YWwKCQkJZm9yKCB2YXIgbmR4ID0gMDsgbmR4IDwgdGVtcEFyci5sZW5ndGg7IG5keCsrICkgewoJCQkJdmFyIHdvcmQgPSB0ZW1wQXJyW25keF07CgkJCQlpZihzaG93SW5wdXRTdHJpbmdBbGVydHMpe2FsZXJ0KCAiQ2hlY2tpbmcgd29yZDogIiArIHdvcmQgKTt9CgkJCQkKCQkJCWlmKCAhIHN3W3dvcmRdICkgewoJCQkJCWlmKCB3b3JkLmxlbmd0aCA8IDIgKSB7CgkJCQkJCWZvdW5kU3RvcE9yU2hvcnRXb3JkID0gMTsKCQkJCQl9CgkJCQkJZWxzZSBpZiggKHdvcmQubGVuZ3RoID4gMikgfHwgKHB0bjEudGVzdCh3b3JkKSB8fCBwdG4yLnRlc3Qod29yZCkpICkgewoJCQkJCQlteUFycltteUFyci5sZW5ndGhdID0gdGVtcEFycltuZHhdOwoJCQkJCX0KCQkJCQllbHNlIHsKCQkJCQkJZm91bmRTdG9wT3JTaG9ydFdvcmQgPSAxOwoJCQkJCX0KCQkJCX0KCQkJCWVsc2UgewoJCQkJCWZvdW5kU3RvcE9yU2hvcnRXb3JkID0gMTsKCQkJCX0KCQkJfQoKCQkvLyBOb3cgcmVjb25zdHJ1Y3QgdGhlIHNlYXJjaFRlcm0sIGJhc2VkIHVwb24gdGhlICdteUFycicKCQkJc2VhcmNoVGVybSA9ICIiOwoJCQlmb3IoIHZhciBuZHggPSAwOyBuZHggPCBteUFyci5sZW5ndGg7IG5keCsrICkgewoJCQkJc2VhcmNoVGVybSA9IHNlYXJjaFRlcm0gKyBteUFycltuZHhdICsgIiAiOwoJCQl9CgoJCWhhbmRsZVdoaXRlc3BhY2VSZW1vdmFsKCk7CgoJCWlmKHNob3dJbnB1dFN0cmluZ0FsZXJ0cyl7YWxlcnQoICJGSU5BTCBTRUFSQ0ggVEVSTTogKiIgKyBzZWFyY2hUZXJtICsgIioiICk7fQoJCQkKCQlpZiggZm91bmRTdG9wT3JTaG9ydFdvcmQgJiYgISBzZWFyY2hUZXJtLmxlbmd0aCApIHsKCQkJcmV0dXJuIE1TR19zdG9wQW5kU2hvcnRXb3JkczsKCQl9CgkJc3JjaF9pbnB1dF9tYXNzYWdlZCA9IHNlYXJjaFRlcm07CgkJcmV0dXJuICIiOwoJfSAKCWVsc2UgewoJCXJldHVybiBNU0dfbm9TZWFyY2hUZXJtRW50ZXJlZDsKCX0KfQovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpmdW5jdGlvbiBjaGVja1RoZUlucHV0U3RyaW5nMigpCQkvLyBkb3VibGUtYnl0ZSB2ZXJzaW9uCnsKCXZhciB0ZW1wQXJyID0gbmV3IEFycmF5KCk7CgoJaGFuZGxlV2hpdGVzcGFjZVJlbW92YWwoKTsKCXNlYXJjaFRlcm0gPSBzZWFyY2hUZXJtLnRvTG93ZXJDYXNlKCk7CgoJaWYoIHNlYXJjaFRlcm0ubGVuZ3RoICkgewoKCQkvLyBTcGxpdCB0aGUgc2VhcmNoVGVybQoJCQl0ZW1wQXJyID0gc2VhcmNoVGVybS5zcGxpdCgiICIsMTAwKTsKCQkJaWYoc2hvd0lucHV0U3RyaW5nQWxlcnRzKXthbGVydCggIm51bWJlciBvZiBzZWFyY2ggdGVybXM6ICIgKyB0ZW1wQXJyLmxlbmd0aCApO30KCgkJLy8gTm93IHJlY29uc3RydWN0IHRoZSBzZWFyY2hUZXJtLCBiYXNlZCB1cG9uIHRoZSAndGVtcEFycicKCQkJc2VhcmNoVGVybSA9ICIiOwoJCQlmb3IoIHZhciBuZHggPSAwOyBuZHggPCB0ZW1wQXJyLmxlbmd0aDsgbmR4KysgKSB7CgkJCQlzZWFyY2hUZXJtID0gc2VhcmNoVGVybSArIHRlbXBBcnJbbmR4XSArICIgIjsKCQkJfQoJCQloYW5kbGVXaGl0ZXNwYWNlUmVtb3ZhbCgpOwoKaWYoc2hvd0lucHV0U3RyaW5nQWxlcnRzKXthbGVydCggIk1hc3NhZ2VkIHNlYXJjaCB0ZXJtOiAiICsgc2VhcmNoVGVybSApO30KCgkJc3JjaF9pbnB1dF9tYXNzYWdlZCA9IHNlYXJjaFRlcm07CgkJcmV0dXJuICIiOwoJfQoJZWxzZSB7CgkJcmV0dXJuIE1TR19ub1NlYXJjaFRlcm1FbnRlcmVkOwoJfQp9Ci8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmZ1bmN0aW9uIGRvSUVzZWFyY2goKQp7Cgl2YXIgc3RTdHIgPSAiIjsKCQkJCglkb2N1bWVudC5mb3Jtc1swXS5zaF90ZXJtLnZhbHVlID0gc3JjaF9pbnB1dF92ZXJiYXRpbTsKCQoJaWYoIHNyY2hfbWVzc2FnZS5sZW5ndGggKSB7CgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInJlc3VsdHMiKS5pbm5lckhUTUwgPSBzcmNoX21lc3NhZ2U7CgkJc3JjaF9tZXNzYWdlID0gIiI7Cgl9CgllbHNlIGlmKCBzcmNoXzFfc2hvdCApIHsKCQlzcmNoXzFfc2hvdCA9IDA7CgkJCgkJc2VhcmNoVGVybSA9IHNyY2hfaW5wdXRfbWFzc2FnZWQ7CgkJY2hlY2tGb3JIaXRzKCk7CS8vIFNldHM6ICdtYXRjaGVzQXJySW5kaWNlcycgYW5kICdtYXRjaGVzQXJySGl0cycKCgkJaWYoIG1hdGNoZXNBcnJJbmRpY2VzLmxlbmd0aCApIHsJLy8gSWYgdGhlcmUgd2VyZSBtYXRjaGVzL2hpdHMuLi4gIC8qIENoYW5nZWQgZm9yIENTNCAqLwoKCQkJc3RTdHIgPSAiPGRpdiBjbGFzcz1cImZvcm1cIj4iICsgTVNHX3BhZ2VzQ29udGFpbmluZyArICI8c3Ryb25nPiIgKyBzcmNoX2lucHV0X21hc3NhZ2VkICsgIjwvc3Ryb25nPjwvZGl2PjxiciAvPjxiciAvPlxuIjsKCgkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJyZXN1bHRzIikuaW5uZXJIVE1MID0gc3RTdHIgKyBidWlsZEh0bWxSZXN1bHRzU3RyKCk7CgkJfQoJCWVsc2UgeyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLyogQ2hhbmdlZCBmb3IgQ1M0ICovCgkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJyZXN1bHRzIikuaW5uZXJIVE1MID0gTVNHX25vUGFnZXNDb250YWluICsgIjxzdHJvbmc+IiArIHNyY2hfaW5wdXRfbWFzc2FnZWQgKyAiPC9zdHJvbmc+PGJyIC8+PGJyIC8+IjsKCgkJfQoJCS8vc2VhcmNoaW5nX21lc3NhZ2Uuc3R5bGUudmlzaWJpbGl0eT0idmlzaWJsZSI7Cgl9CglzcmNoX2lucHV0X3ZlcmJhdGltID0gIiI7Cn0KLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KZnVuY3Rpb24gZ2V0SW5zdGFuY2VDb3VudCggbGluZUluZGV4LCB3b3JkSW5kZXggKQp7Cgl2YXIgaW5zdGFuY2VzU3RyID0gaW5zdGFuY2VzW2xpbmVJbmRleF07CS8vIGUuZy4gIjE0MzI5MzEiCgl2YXIgY2ggPSBpbnN0YW5jZXNTdHIuc3Vic3RyKHdvcmRJbmRleCwxKTsKCQoJcmV0dXJuIHBhcnNlSW50KGNoKTsKfQovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpmdW5jdGlvbiBoYW5kbGVXaGl0ZXNwYWNlUmVtb3ZhbCgpCnsKCXZhciByZV8xID0gL15ccy87Cgl2YXIgcmVfMiA9IC9ccyQvOwoJdmFyIHJlXzMgPSAvXHNccy87Cgl2YXIgdGVtcDsKCgkvLyBSZW1vdmUgbGVhZGluZyB3aGl0ZXNwYWNlCgkJd2hpbGUoIHRydWUgKSB7CgkJCXRlbXAgPSBzZWFyY2hUZXJtLnJlcGxhY2UocmVfMSwiIik7CgkJCWlmKCB0ZW1wID09IHNlYXJjaFRlcm0gKSB7CgkJCQlicmVhazsKCQkJfQoJCQlzZWFyY2hUZXJtID0gdGVtcDsKCQl9CgkvLyBSZW1vdmUgdHJhaWxpbmcgd2hpdGVzcGFjZQoJCXdoaWxlKCB0cnVlICkgewoJCQl0ZW1wID0gc2VhcmNoVGVybS5yZXBsYWNlKHJlXzIsIiIpOwoJCQlpZiggdGVtcCA9PSBzZWFyY2hUZXJtICkgewoJCQkJYnJlYWs7CgkJCX0KCQkJc2VhcmNoVGVybSA9IHRlbXA7CgkJfQoJLy8gUmVwbGFjZSBtdWx0aXBsZSBjb250aWd1b3VzIHNwYWNlcyB3aXRoIGEgc2luZ2xlIHNwYWNlCgkJd2hpbGUoIHNlYXJjaFRlcm0uc2VhcmNoKHJlXzMpICE9IC0xICkgewoJCQl0ZW1wID0gc2VhcmNoVGVybS5yZXBsYWNlKHJlXzMsIiAiKTsKCQkJc2VhcmNoVGVybSA9IHRlbXA7CgkJfQp9Ci8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KZnVuY3Rpb24gaXNBY2NlcHRhYmxlQ2hhcihjaHJOZHgpCnsKCXZhciBhY2NlcHRhYmxlQ2hhcnMgPSBuZXcgQXJyYXkoIDMyLCA0NiwgOTUgKTsJLy8gc3BhY2UsIHBlcmlvZCwgdW5kZXJzY29yZQoJCglmb3IoIHZhciBuZHggPSAwOyBuZHggPCBhY2NlcHRhYmxlQ2hhcnMubGVuZ3RoOyBuZHgrKyApIHsKCQlpZiggY2hyTmR4ID09IGFjY2VwdGFibGVDaGFyc1tuZHhdICkgewoJCQlyZXR1cm4gdHJ1ZTsKCQl9Cgl9CglyZXR1cm4gZmFsc2U7Cn0KLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpmdW5jdGlvbiBpbmRleGVzT2Yoc3RyLHB0bikKewoJdmFyIHBvc2l0aW9uID0gMDsKCXZhciBoaXRzID0gLTE7Cgl2YXIgc3RhcnQgPSAtMTsKCgl3aGlsZSggcG9zaXRpb24gIT0gLTEgKSB7CgkJcG9zaXRpb24gPSBzdHIuaW5kZXhPZihwdG4sIHN0YXJ0KzEpOwoJCWhpdHMgKz0gMTsKCQlzdGFydCA9IHBvc2l0aW9uOwoJfQoJcmV0dXJuIGhpdHM7Cn0KLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpmdW5jdGlvbiBmaWx0ZXJUaGVDaGFycyhsaW5lKQp7Cgl2YXIgcmV0U3RyID0gIiIsdGVtcFN0cjsKCXZhciBjaCwgY2hDb2RlLCByZXRDaHI7Cgl2YXIgbmR4OwoJCglmb3IoIG5keCA9IDA7IG5keCA8IGxpbmUubGVuZ3RoOyBuZHgrKyApIHsKCQljaCA9IGxpbmUuc3Vic3RyKG5keCwxKTsKCQljaENvZGUgPSBjaC5jaGFyQ29kZUF0KDApOwoJCQoJCQoJCQlpZiggKGNoQ29kZSA+PSAxOTIpICYmIChjaENvZGUgPD0gMjIxKSApIHsJLy8gSGFuZGxlIGNhcGl0YWwgdXBwZXItQVNDSUkgY2hhcmFjdGVycwoJCQkJY2hDb2RlID0gY2hDb2RlICsgMzI7CgkJCQlyZXRDaHIgPSBBU0NJSV90b19jaGFyKGNoQ29kZSk7CgkJCX0KCQkJZWxzZSBpZiggd2l0aGluQWNjZXB0YWJsZVJhbmdlcyhjaENvZGUpIHx8IGlzQWNjZXB0YWJsZUNoYXIoY2hDb2RlKSApIHsgLy8gQWNjZXB0YWJsZSBjaGFyYWN0ZXJzCgkJCQlyZXRDaHIgPSBjaDsKCQkJfQoJCQllbHNlIHsKCQkJCXRlbXBTdHIgPSBpc0xpZ2F0dXJlQ2hhcihjaENvZGUpOwoKCQkJCWlmKCB0ZW1wU3RyLmxlbmd0aCApIHsJLy9Eb24ndCByZXBsYWNlIGxpZ2F0dXJlcy4KCQkJCQlyZXRDaHIgPSBjaDsKCQkJCX0KCQkJCWVsc2UgewkJLy8gVHVybiBhbGwgZWxzZSBpbnRvIHNwYWNlCQoJCQkJCXJldENociA9ICIgIjsKCQkJCX0KCQkJfQoKCQkvLyBHcm93IHRoZSByZXR1cm4gc3RyaW5nCgkJCXJldFN0ciArPSByZXRDaHI7Cgl9CgkKCXJldHVybiByZXRTdHI7Cn0KLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpmdW5jdGlvbiBpc0xpZ2F0dXJlQ2hhcihjb2RlVG9DaGVjaykgewoJdmFyIHhsYXRUYmxOZHgsIGNvZGUsIHJlcGxTdHIgPSAiIjsKCglmb3IoIHhsYXRUYmxOZHggPSAwOyB4bGF0VGJsTmR4IDwgdXBwZXJBc2NpaVhsYXRUYmwubGVuZ3RoOyB4bGF0VGJsTmR4Kz0yICkgewoKCQljb2RlID0gdXBwZXJBc2NpaVhsYXRUYmxbeGxhdFRibE5keF07CgkJaWYoIGNvZGUgPT0gY29kZVRvQ2hlY2sgKSB7CgkJCXJlcGxTdHIgPSB1cHBlckFzY2lpWGxhdFRibFt4bGF0VGJsTmR4KzFdOwoJCQlicmVhazsKCQl9Cgl9CgkKCXJldHVybiByZXBsU3RyOwp9Ci8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KZnVuY3Rpb24gcmVzcG9uZFRvU2VhcmNoQnV0dG9uKCkgCnsKCXZhciBteVN0cjsKCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJyZXN1bHRzIikuaW5uZXJIVE1MID0gIiI7IC8vV2UgZG9uJ3QgZXhwZWN0IHRoaXMgdG8gYmUgc2xvdyBlbm91Z2ggdG8gbmVlZCBhIG1lc3NhZ2UuCQoJc3JjaF9pbnB1dF92ZXJiYXRpbSA9IGRvY3VtZW50LmZvcm1zWzBdLnNoX3Rlcm0udmFsdWU7CglzZWFyY2hUZXJtID0gZG9jdW1lbnQuZm9ybXNbMF0uc2hfdGVybS52YWx1ZTsKCQoJaWYoIGRvY3VtZW50LmlzRGJsQnl0ZSApIHsKCQlteVN0ciA9IGNoZWNrVGhlSW5wdXRTdHJpbmcyKCk7Cgl9CgllbHNlIHsKCQlteVN0ciA9IGNoZWNrVGhlSW5wdXRTdHJpbmcoKTsJCgl9CgkKCXNyY2hfbWVzc2FnZSA9IG15U3RyOwoJc3JjaF8xX3Nob3QgPSBzcmNoX21lc3NhZ2UubGVuZ3RoID8gMCA6IDE7CgkKCWRvSUVzZWFyY2goKTsKfQovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmZ1bmN0aW9uIHJlc3BvbmRUb1NlYXJjaExvYWQoKSAKewoJdmFyIGV4dGVybmFsUXVlcnkgPSBHZXRDb29raWUoImV4dGVybmFsUXVlcnkiKTsKCWlmIChleHRlcm5hbFF1ZXJ5ID09IG51bGwpIHsgCgkJCWV4dGVybmFsUXVlcnkgPSBHZXRDb29raWUoInNoX3Rlcm0iKTsKCX0KCglpZiAoZXh0ZXJuYWxRdWVyeSAhPSBudWxsKSB7IAoJCXZhciBteVN0cjsKCQlzcmNoX2lucHV0X3ZlcmJhdGltID0gZXh0ZXJuYWxRdWVyeTsKCQlzZWFyY2hUZXJtID0gZXh0ZXJuYWxRdWVyeTsKCQoJCWlmKGRvY3VtZW50LmlzRGJsQnl0ZSApIHsKCQkgIG15U3RyID0gY2hlY2tUaGVJbnB1dFN0cmluZzIoKTsKCQl9CgkJZWxzZSB7CgkJICBteVN0ciA9IGNoZWNrVGhlSW5wdXRTdHJpbmcoKTsJCgkJfQoJCQoJCXNyY2hfbWVzc2FnZSA9IG15U3RyOwoJCXNyY2hfMV9zaG90ID0gc3JjaF9tZXNzYWdlLmxlbmd0aCA/IDAgOiAxOwoJCQoJCWRvSUVzZWFyY2goKTsKCX0KfQovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpmdW5jdGlvbiBzdHJSZXBsYWNlKG9yaWcsc3JjLGRlc3QpCnsKCXZhciBzdGFydFBvcz0wOwoJdmFyIG1hdGNoUG9zID0gb3JpZy5pbmRleE9mKHNyYyxzdGFydFBvcyk7Cgl2YXIgcmV0TGluZT0iIjsKCQoJd2hpbGUobWF0Y2hQb3MgIT0gLTEpIHsKCQlyZXRMaW5lID0gcmV0TGluZSArIG9yaWcuc3Vic3RyaW5nKHN0YXJ0UG9zLG1hdGNoUG9zKSArIGRlc3Q7CgkJc3RhcnRQb3MgPSBtYXRjaFBvcysxOwoJCW1hdGNoUG9zID0gb3JpZy5pbmRleE9mKHNyYyxzdGFydFBvcyk7Cgl9CglpZighIHJldExpbmUubGVuZ3RoKSB7cmV0dXJuIG9yaWc7fQoJZWxzZSB7cmV0dXJuIHJldExpbmUrb3JpZy5zdWJzdHJpbmcoc3RhcnRQb3Msb3JpZy5sZW5ndGgpO30KfQovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmZ1bmN0aW9uIHdpdGhpbkFjY2VwdGFibGVSYW5nZXMoY2hyTmR4KQp7CQoJdmFyIGFjY2VwdGFibGVSYW5nZXMgPSBuZXcgQXJyYXkoICI0OC01NyIsIjY1LTkwIiwiOTctMTIyIiwiMjI0LTIyOSIsIjIzMS0yMzkiLCIyNDEtMjQ2IiwiMjQ4LTI1MyIsIjI1NS0yNTUiKTsKCQoJZm9yKCB2YXIgbmR4ID0gMDsgbmR4IDwgYWNjZXB0YWJsZVJhbmdlcy5sZW5ndGg7IG5keCsrICkgewoJCXZhciBzdGFydF9maW5pc2ggPSBuZXcgQXJyYXkoKTsKCgkJc3RhcnRfZmluaXNoID0gYWNjZXB0YWJsZVJhbmdlc1tuZHhdLnNwbGl0KCItIik7CgkJCgkJaWYoIChjaHJOZHggPj0gc3RhcnRfZmluaXNoWzBdKSAmJiAoY2hyTmR4IDw9IHN0YXJ0X2ZpbmlzaFsxXSkgKSB7CgkJCXJldHVybiB0cnVlOwoJCX0KCX0KCXJldHVybiBmYWxzZTsKfQovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmZ1bmN0aW9uIEFTQ0lJX3RvX2NoYXIobnVtX2luKQp7Cgl2YXIgc3RyX291dCA9ICIiOwoJdmFyIG51bV9vdXQgPSBwYXJzZUludChudW1faW4pOwoJCgludW1fb3V0ID0gdW5lc2NhcGUoJyUnICsgbnVtX291dC50b1N0cmluZygxNikpOwoJc3RyX291dCArPSBudW1fb3V0OwoJCglyZXR1cm4gdW5lc2NhcGUoc3RyX291dCk7Cn0KLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQp2YXIgYWd0PW5hdmlnYXRvci51c2VyQWdlbnQudG9Mb3dlckNhc2UoKTsKdmFyIHVzZV9pZV9iZWhhdmlvciA9IGZhbHNlOwp2YXIgdXNlX2llXzZfYmVoYXZpb3IgPSBmYWxzZTsKaWYgKGFndC5pbmRleE9mKCJtc2llIikgIT0gLTEpIHsKICB1c2VfaWVfYmVoYXZpb3IgPSB0cnVlOwp9CmlmICgoYWd0LmluZGV4T2YoIm1zaWUgNSIpICE9IC0xKSB8fCAoYWd0LmluZGV4T2YoIm1zaWUgNiIpICE9IC0xKSkgewogIHVzZV9pZV82X2JlaGF2aW9yID0gdHJ1ZTsKfQoKLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKdmFyIFVybCA9IHsKCgkvLyBwdWJsaWMgbWV0aG9kIGZvciB1cmwgZW5jb2RpbmcKCWVuY29kZSA6IGZ1bmN0aW9uIChzdHJpbmcpIHsKCQlyZXR1cm4gZXNjYXBlKHRoaXMuX3V0ZjhfZW5jb2RlKHN0cmluZykpOwoJfSwKCgkvLyBwdWJsaWMgbWV0aG9kIGZvciB1cmwgZGVjb2RpbmcKCWRlY29kZSA6IGZ1bmN0aW9uIChzdHJpbmcpIHsKCQlyZXR1cm4gdGhpcy5fdXRmOF9kZWNvZGUodW5lc2NhcGUoc3RyaW5nKSk7Cgl9LAoKCS8vIHByaXZhdGUgbWV0aG9kIGZvciBVVEYtOCBlbmNvZGluZwoJX3V0ZjhfZW5jb2RlIDogZnVuY3Rpb24gKHN0cmluZykgewoJCXN0cmluZyA9IHN0cmluZy5yZXBsYWNlKC9cclxuL2csIlxuIik7CgkJdmFyIHV0ZnRleHQgPSAiIjsKCgkJZm9yICh2YXIgbiA9IDA7IG4gPCBzdHJpbmcubGVuZ3RoOyBuKyspIHsKCgkJCXZhciBjID0gc3RyaW5nLmNoYXJDb2RlQXQobik7CgoJCQlpZiAoYyA8IDEyOCkgewoJCQkJdXRmdGV4dCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGMpOwoJCQl9CgkJCWVsc2UgaWYoKGMgPiAxMjcpICYmIChjIDwgMjA0OCkpIHsKCQkJCXV0ZnRleHQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoYyA+PiA2KSB8IDE5Mik7CgkJCQl1dGZ0ZXh0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoKGMgJiA2MykgfCAxMjgpOwoJCQl9CgkJCWVsc2UgewoJCQkJdXRmdGV4dCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKChjID4+IDEyKSB8IDIyNCk7CgkJCQl1dGZ0ZXh0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoKChjID4+IDYpICYgNjMpIHwgMTI4KTsKCQkJCXV0ZnRleHQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoYyAmIDYzKSB8IDEyOCk7CgkJCX0KCgkJfQoKCQlyZXR1cm4gdXRmdGV4dDsKCX0sCgoJLy8gcHJpdmF0ZSBtZXRob2QgZm9yIFVURi04IGRlY29kaW5nCglfdXRmOF9kZWNvZGUgOiBmdW5jdGlvbiAodXRmdGV4dCkgewoJCXZhciBzdHJpbmcgPSAiIjsKCQl2YXIgaSA9IDA7CgkJdmFyIGMgPSBjMSA9IGMyID0gMDsKCgkJd2hpbGUgKCBpIDwgdXRmdGV4dC5sZW5ndGggKSB7CgoJCQljID0gdXRmdGV4dC5jaGFyQ29kZUF0KGkpOwoKCQkJaWYgKGMgPCAxMjgpIHsKCQkJCXN0cmluZyArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGMpOwoJCQkJaSsrOwoJCQl9CgkJCWVsc2UgaWYoKGMgPiAxOTEpICYmIChjIDwgMjI0KSkgewoJCQkJYzIgPSB1dGZ0ZXh0LmNoYXJDb2RlQXQoaSsxKTsKCQkJCXN0cmluZyArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKCgoYyAmIDMxKSA8PCA2KSB8IChjMiAmIDYzKSk7CgkJCQlpICs9IDI7CgkJCX0KCQkJZWxzZSB7CgkJCQljMiA9IHV0ZnRleHQuY2hhckNvZGVBdChpKzEpOwoJCQkJYzMgPSB1dGZ0ZXh0LmNoYXJDb2RlQXQoaSsyKTsKCQkJCXN0cmluZyArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKCgoYyAmIDE1KSA8PCAxMikgfCAoKGMyICYgNjMpIDw8IDYpIHwgKGMzICYgNjMpKTsKCQkJCWkgKz0gMzsKCQkJfQoKCQl9CgoJCXJldHVybiBzdHJpbmc7Cgl9Cgp9Cg==",
                "body": "Ly8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KLy8KLy8gIEFET0JFIFNZU1RFTVMgSU5DT1JQT1JBVEVECi8vICBDb3B5cmlnaHQgMjAwOCBBZG9iZSBTeXN0ZW1zIEluY29ycG9yYXRlZAovLyAgQWxsIFJpZ2h0cyBSZXNlcnZlZC4KLy8KLy8gIE5PVElDRTogQWRvYmUgcGVybWl0cyB5b3UgdG8gdXNlLCBtb2RpZnksIGFuZCBkaXN0cmlidXRlIHRoaXMgZmlsZQovLyAgaW4gYWNjb3JkYW5jZSB3aXRoIHRoZSB0ZXJtcyBvZiB0aGUgbGljZW5zZSBhZ3JlZW1lbnQgYWNjb21wYW55aW5nIGl0LgovLwovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKCmZ1bmN0aW9uIGNsb3NlUG9wdXAoKQp7CiAgd2luZG93LmNsb3NlKCk7Cn0KZnVuY3Rpb24gc2Nyb2xsVG9OYW1lQW5jaG9yKCkgCnsKCXZhciBuYW1lQW5jaG9yID0gd2luZG93LmxvY2F0aW9uLmhyZWY7Cgl2YXIgdmFsdWUgPSBuYW1lQW5jaG9yLnNwbGl0KCJuYW1lQW5jaG9yPSIpOwoJCglpZiAodmFsdWVbMV0gIT0gbnVsbCkgeyAKCQlkb2N1bWVudC5sb2NhdGlvbiA9dmFsdWVbMF0rIiMiKyB2YWx1ZVsxXTsKCX0KfQovLyBISURFUyBBTkQgU0hPV1MgTEFSR0UgR1JBUEhJQ1MgSU4gVEhFIENPTlRFTlQgUEFHRVMKZnVuY3Rpb24gc2hvd0hpZGVJbWFnZSh0aGlzSUQsIG9iaikgCnsKCQoJdmFyIGltZ0VsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0aGlzSUQpOwoJdmFyIGltZ1RleHQgPSBvYmo7CgoJaWYoIGltZ0VsZW1lbnQuY2xhc3NOYW1lID09ICJsYXJnZUltYWdlIiApCgl7CgkJCWltZ0VsZW1lbnQuc3JjID0gImltYWdlcy8iICsgdGhpc0lEICsgIi5wbmciOwoJCQlpbWdFbGVtZW50LmNsYXNzTmFtZT0ic21hbGxJbWFnZSI7CgkJCW9iai5jbGFzc05hbWU9InNob3dJbWFnZUxpbmsiOwoJCQlvYmouaHJlZj0iIyI7CgkJCW9iai5maXJzdENoaWxkLm5vZGVWYWx1ZSA9IHRlcm1zX0FIVl9MQVJHRV9HUkFQSElDOwoJCQl3aW5kb3cuZm9jdXMoKTsKCX0KCWVsc2UKCXsKCQkJaW1nRWxlbWVudC5zcmMgPSAiaW1hZ2VzLyIgKyB0aGlzSUQgKyAiX3BvcHVwLnBuZyI7CgkJCWltZ0VsZW1lbnQuY2xhc3NOYW1lPSJsYXJnZUltYWdlIjsKCQkJb2JqLmNsYXNzTmFtZT0iaGlkZUltYWdlTGluayI7CgkJCW9iai5ocmVmPSIjIjsKCQkJb2JqLmZpcnN0Q2hpbGQubm9kZVZhbHVlID0gdGVybXNfQUhWX1NNQUxMX0dSQVBISUM7CgkJCXdpbmRvdy5mb2N1cygpOwoJfQp9Ci8vIGpzIGZ1bmN0aW9uIGZvciBleHBhbmQgY29sbGFwc2UgbWVudSBmdW5jdGlvbmFsaXR5CmZ1bmN0aW9uIEtleUNoZWNrKGUsIHRyZWUsIGlkeCkKewogIHZhciBLZXlJRCA9ICh3aW5kb3cuZXZlbnQpID8gZXZlbnQua2V5Q29kZSA6IGUua2V5Q29kZTsKICB2YXIgbm9kZSA9ICBZQUhPTy53aWRnZXQuVHJlZVZpZXcuZ2V0Tm9kZSh0cmVlLCBpZHgpOwogICBzd2l0Y2goS2V5SUQpCiAgIHsKICAgICAgY2FzZSAzNzoKICAgICAvLyBhbGVydCgiQXJyb3cgTGVmdCIpOwogICAgICBub2RlLmNvbGxhcHNlKCk7CiAgICAgIGJyZWFrOwogICAgICBjYXNlIDM5OgogICAgIC8vIGFsZXJ0KCJBcnJvdyBSaWdodCIpOwogICAgICBub2RlLmV4cGFuZCgpOwogICAgICBicmVhazsKICAgfQp9Ci8vIGpzIGZ1bmN0aW9uIGZvciBoaWRlL2Rpc3BsYXkgbWluaS1lbGVtZW50cyBmdW5jdGlvbmFsaXR5CmZ1bmN0aW9uIHRvZ2dsZUxheWVyKHdoaWNoTGF5ZXIpIHsKCWlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCkgewoJCS8vIHRoaXMgaXMgdGhlIHdheSB0aGUgc3RhbmRhcmRzIHdvcmsKCQl2YXIgb2JqPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHdoaWNoTGF5ZXIpOwoJCXZhciBpbWcgPSBvYmoucHJldmlvdXNTaWJsaW5nLmZpcnN0Q2hpbGQuZmlyc3RDaGlsZDsKCQlpbWcuc2V0QXR0cmlidXRlKCJzcmMiLCJpbWFnZXMvb24uZ2lmIik7CgkJdmFyIHN0eWxlYXR0ID0gb2JqLnN0eWxlOwoJCXN0eWxlYXR0LmRpc3BsYXkgPSBzdHlsZWF0dC5kaXNwbGF5PyAiIjoiYmxvY2siOwoJCQoJCS8vY2hhbmdlIHRoZSBjbGFzcyBvZiB0aGUgaDMgcGVyIGRlc2lnbgoJCWlmIChvYmoucHJldmlvdXNTaWJsaW5nLmNsYXNzTmFtZSA9PT0gInRvcGljdGl0bGUzIikJewoJCQlvYmoucHJldmlvdXNTaWJsaW5nLmNsYXNzTmFtZSA9InRvcGljdGl0bGUzb2ZmIjsKCQkgICAgaW1nLnNldEF0dHJpYnV0ZSgic3JjIiwiaW1hZ2VzL29uLmdpZiIpOwoJCX0gZWxzZSBpZiAob2JqLnByZXZpb3VzU2libGluZy5jbGFzc05hbWUgPT09ICJ0b3BpY3RpdGxlM29mZiIpCXsKCQkJb2JqLnByZXZpb3VzU2libGluZy5jbGFzc05hbWUgPSJ0b3BpY3RpdGxlMyI7CgkJCWltZy5zZXRBdHRyaWJ1dGUoInNyYyIsImltYWdlcy9vZmYuZ2lmIik7CgkJfSAKCX0KCWVsc2UgaWYgKGRvY3VtZW50LmFsbCkgewoJCS8vIHRoaXMgaXMgdGhlIHdheSBvbGQgbXNpZSB2ZXJzaW9ucyB3b3JrCgkJdmFyIHN0eWxlMiA9IGRvY3VtZW50LmFsbFt3aGljaExheWVyXS5zdHlsZTsKCQlzdHlsZTIuZGlzcGxheSA9IHN0eWxlMi5kaXNwbGF5PyAiIjoiYmxvY2siOwoJfQp9CiBmdW5jdGlvbiBhZGRCb29rbWFyayggYm1fdXJsX3N0ciwgYm1fc3RyX2xhYmVsICkgewogIHBhcmVudC5uYXZpZ2F0aW9uLmZsYXNoUHJveHkuY2FsbCgnYWRkQm9va21hcmsnLCBibV91cmxfc3RyLCBibV9zdHJfbGFiZWwgKTsKfQoKdmFyIHVwcGVyQXNjaWlYbGF0VGJsID0gbmV3IEFycmF5KAoyMjMsInNzIiwKMjMwLCJhZSIsCjE5OCwiYWUiLAoxNTYsIm9lIiwKMTQwLCJvZSIsCjI0MCwiZXRoIiwKMjA4LCJldGgiLAoxNDEsInkiLAoxNTksInkiCik7Cgp2YXIgbWF4TnVtYmVyT2ZTaG93blNlYXJjaEhpdHMgPSAzMDsKdmFyIHNob3dJbnB1dFN0cmluZ0FsZXJ0cyA9IDA7CnZhciBuYXZpZ2F0aW9uQ29va2llID0gIiI7CgovLy8vLy8vLy8vLy8vLyBDT09LSUUtUkVMQVRFRCBGVU5DVElPTlMgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KLy8gIHRlc3QgdGhlIG5hdmlnYXRvciBvYmplY3QgZm9yIGNvb2tpZSBlbmFibGluZwovLyAgYWRkaXRpb25hbCBjb2RlIHdvdWxkIG5lZWQgdG8gYmUgYWRkZWQgZm9yCi8vICB0byBzdXBwb3J0IGJyb3dzZXJzIHByZSBuYXZpZ2F0b3IgNCBvciBJRTUgb3IgCi8vICBvdGhlciBicm93c2VycyB0aGF0IGRvbnQgc3VwcG9ydAovLyAgdGhlIG5hdmlnYXRvciBvYmplY3QgaWYgYW55IC4uIAogZnVuY3Rpb24gY29va2llc05vdEVuYWJsZWQoKSAKewoJcmV0dXJuIHRydWU7ICAgICAvLyBXZSdyZSBub3QgZ29pbmcgdG8gdXNlIGNvb2tpZXMKfQovKgogKiBUaGlzIGZ1bmN0aW9uIHBhcnNlcyBjb21tYS1zZXBhcmF0ZWQgbmFtZT12YWx1ZSAKICogYXJndW1lbnQgcGFpcnMgZnJvbSB0aGUgcXVlcnkgc3RyaW5nIG9mIHRoZSBVUkwuIAogKiBJdCBzdG9yZXMgdGhlIG5hbWU9dmFsdWUgcGFpcnMgaW4gCiAqIHByb3BlcnRpZXMgb2YgYW4gb2JqZWN0IGFuZCByZXR1cm5zIHRoYXQgb2JqZWN0LgogKi8KZnVuY3Rpb24gZ2V0QXJncygpIAp7Cgl2YXIgYXJncyA9IG5ldyBPYmplY3QoKTsKCXZhciBxdWVyeSA9IHdpbmRvdy5sb2NhdGlvbi5zZWFyY2guc3Vic3RyaW5nKDEpOyAKCS8vIEdldCBxdWVyeSBzdHJpbmcKCWlmIChxdWVyeS5sZW5ndGggPiAwKQl7CgkJdmFyIHBhaXJzID0gcXVlcnkuc3BsaXQoIiwiKTsKCQkvLyBCcmVhayBhdCBjb21tYQoJCWZvcih2YXIgaSA9IDA7IGkgPCBwYWlycy5sZW5ndGg7IGkrKykgCgkJewoJCQl2YXIgcG9zID0gcGFpcnNbaV0uaW5kZXhPZignPScpOwoJCQkgIC8vIExvb2sgZm9yICJuYW1lPXZhbHVlIgoJCQlpZiAocG9zID09IC0xKSBjb250aW51ZTsKCQkJICAvLyBJZiBub3QgZm91bmQsIHNraXAKCQkJdmFyIGFyZ25hbWUgPSBwYWlyc1tpXS5zdWJzdHJpbmcoMCxwb3MpOwoJCQkgIC8vIEV4dHJhY3QgdGhlIG5hbWUKCQkJdmFyIHZhbHVlID0gcGFpcnNbaV0uc3Vic3RyaW5nKHBvcysxKTsKCQkJICAvLyBFeHRyYWN0IHRoZSB2YWx1ZQoJCQlhcmdzW2FyZ25hbWVdID0gdW5lc2NhcGUodmFsdWUpOwoJCSAgCSAgLy8gU3RvcmUgYXMgYSBwcm9wZXJ0eQoJCQkgIC8vIEluIEphdmFTY3JpcHQgMS41LCB1c2UgZGVjb2RlVVJJQ29tcG9uZW50KCAgKSAKCQkJICAvLyBpbnN0ZWFkIG9mIGVzY2FwZSggICkKCQl9Cgl9IGVsc2UgewoJCWFyZ3NbbmFtZV0gPSBmYWxzZTsJCQoJfQoJcmV0dXJuIGFyZ3M7ICAgICAvLyBSZXR1cm4gdGhlIG9iamVjdAp9CgovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vIENPT0tJRS1SRUxBVEVEIEZVTkNUSU9OUyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KLy8gQmlsbCBEb3J0Y2ggZ2V0Q29va2llVmFsIGFuZCBHZXRDb29raWUgcm91dGluZXMKZnVuY3Rpb24gZ2V0Q29va2llVmFsKG9mZnNldCkgewogIHZhciBlbmRzdHI9ZG9jdW1lbnQuY29va2llLmluZGV4T2YoIjsiLG9mZnNldCk7CiAgaWYgKGVuZHN0cj09LTEpZW5kc3RyPWRvY3VtZW50LmNvb2tpZS5sZW5ndGg7CiAgcmV0dXJuIHVuZXNjYXBlKGRvY3VtZW50LmNvb2tpZS5zdWJzdHJpbmcob2Zmc2V0LCBlbmRzdHIpKTsKfQpmdW5jdGlvbiBHZXRDb29raWUobmFtZSkgewogIHZhciBhcmc9bmFtZSsiPSI7CiAgdmFyIGFsZW49YXJnLmxlbmd0aDsKICB2YXIgY2xlbj1kb2N1bWVudC5jb29raWUubGVuZ3RoOwogIHZhciBpPTA7CgogIGlmIChjb29raWVzTm90RW5hYmxlZCgpKQogIHsKCXZhciBhcmdzID0gZ2V0QXJncygpOwoJaWYgKGFyZ3NbbmFtZV0gIT09IGZhbHNlKSB7IAoJCXJldHVybiBhcmdzW25hbWVdOwoJfQkKICB9IGVsc2UgewoJICB3aGlsZShpPGNsZW4pewoJICAgIHZhciBqPWkrYWxlbjsKCSAgICBpZihkb2N1bWVudC5jb29raWUuc3Vic3RyaW5nKGksaik9PWFyZylyZXR1cm4gZ2V0Q29va2llVmFsKGopOwoJICAgIGk9ZG9jdW1lbnQuY29va2llLmluZGV4T2YoIiAiLGkpKzE7CgkgICAgaWYoaT09MClicmVhazsgCgkgIH0KCSAgcmV0dXJuIG51bGw7Cgl9Cn0KZnVuY3Rpb24gZ2V0VG9wQ29va2llVmFsKG9mZnNldCkgewogIHZhciBlbmRzdHI9ZG9jdW1lbnQuY29va2llLmluZGV4T2YoIjsiLG9mZnNldCk7CiAgaWYgKGVuZHN0cj09LTEpZW5kc3RyPWRvY3VtZW50LmNvb2tpZS5sZW5ndGg7CiAgcmV0dXJuIHVuZXNjYXBlKGRvY3VtZW50LmNvb2tpZS5zdWJzdHJpbmcob2Zmc2V0LCBlbmRzdHIpKTsKfQpmdW5jdGlvbiBHZXRUb3BDb29raWUobmFtZSkgewogIHZhciBhcmc9bmFtZSsiPSI7CiAgdmFyIGFsZW49YXJnLmxlbmd0aDsKICB2YXIgY2xlbj1kb2N1bWVudC5jb29raWUubGVuZ3RoOwogIHZhciBpPTA7CiAgd2hpbGUoaTxjbGVuKXsKICAgIHZhciBqPWkrYWxlbjsKICAgIGlmKGRvY3VtZW50LmNvb2tpZS5zdWJzdHJpbmcoaSxqKT09YXJnKXJldHVybiBnZXRUb3BDb29raWVWYWwoaik7CiAgICBpPWRvY3VtZW50LmNvb2tpZS5pbmRleE9mKCIgIixpKSsxOwogICAgaWYoaT09MClicmVhazsgCiAgfQogIHJldHVybiBudWxsOwp9Ci8vIFNldENvb2tpZQovLyAtLS0tLS0tLS0tLQovLyBUaGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCB0byBzZXQgYSBjb29raWUgaW4gdGhlIGN1cnJlbnQgZG9jdW1lbnQuCi8vICBwYXJhbXM6Ci8vCQluIC0gbmFtZSBvZiB0aGUgY29va2llCi8vCQl2IC0gdmFsdWUgb2YgdGhlIGNvb2tpZQovLwkJbWludXRlcyAtIHRoZSBkdXJhdGlvbiBvZiB0aGUgY29va2llIGluIG1pbnV0ZXMgKHRoYXQgaXMsIGhvdyBtYW55IG1pbnV0ZXMgYmVmb3JlIGl0IGV4cGlyZXMpCmZ1bmN0aW9uIFNldENvb2tpZShuLHYsbWludXRlcykgewogdmFyIFRoZW4gPSBuZXcgRGF0ZSgpOwogVGhlbi5zZXRUaW1lKFRoZW4uZ2V0VGltZSgpICsgbWludXRlcyAqIDYwICogMTAwMCk7CiBkb2N1bWVudC5jb29raWUgPSBuICsgIj0iICsgdiArICI7ZXhwaXJlcz0iICsgVGhlbi50b0dNVFN0cmluZygpOwp9Ci8vIGdldENvbnRlbnRDb29raWUKLy8gLS0tLS0tLS0tLS0tLS0tLQovLyBUaGlzIGZ1bmN0aW9uIHJlYWRzIHRoZSBjb250ZW50IGNvb2tpZSBzZXQgYnkgdGhlIGhhbmRsZUNvbnRleHQgZnVudGlvbi4KLy8KZnVuY3Rpb24gZ2V0Q29udGVudENvb2tpZSgpCnsKCXZhciBjb250ZW50Q29va2llID0gR2V0Q29va2llKCJjb250ZW50Iik7Cglkb2N1bWVudC5jb29raWUgPSAiY29udGVudD0iOwoKCS8vIFdoYXQgZG9lcyB0aGlzIGV4cHJlc3Npb24gbWVhbj8KCS8vIChjb250ZW50Q29va2llLmluZGV4T2YoImh0bSIpICE9IC0xKQoJaWYgKCAoY29udGVudENvb2tpZSAhPSBudWxsKSAmJiAoY29udGVudENvb2tpZS5pbmRleE9mKCJodG0iKSAhPSAtMSkgKSAKCXsKCQlkb2N1bWVudC5jb29raWUgPSAiY29udGVudD0iOyAvLyBXaXBlIG91dCB0aGUgY29va2llCgkJZG9jdW1lbnQuY29va2llID0gImhpc3RSPSIgKyBjb250ZW50Q29va2llOwoJCWxvY2F0aW9uLnJlcGxhY2UoY29udGVudENvb2tpZSk7Cgl9CQkJCn0KLy8gZ2V0TmF2aWdhdGlvbkNvb2tpZQovLyAtLS0tLS0tLS0tLS0tLS0tLS0tCi8vIFRoaXMgZnVuY3Rpb24gcmVhZHMgdGhlIGNvbnRlbnQgY29va2llIHNldCBieSB0aGUgaGFuZGxlQ29udGV4dCBmdW50aW9uLgovLwpmdW5jdGlvbiBnZXROYXZpZ2F0aW9uQ29va2llKCkKewoJbmF2aWdhdGlvbkNvb2tpZSA9IEdldENvb2tpZSgibmF2aWdhdGlvbiIpOwoJZG9jdW1lbnQuY29va2llID0gIm5hdmlnYXRpb249IjsKCgkvLyBXaGF0IGRvZXMgdGhpcyBleHByZXNzaW9uIG1lYW4/CgkvLyAobmF2aWdhdGlvbkNvb2tpZS5pbmRleE9mKCJodG0iKSAhPSAtMSkKCWlmICggKG5hdmlnYXRpb25Db29raWUgIT0gbnVsbCkgJiYgKG5hdmlnYXRpb25Db29raWUuaW5kZXhPZigiaHRtIikgIT0gLTEpICkgCgl7CgkJZG9jdW1lbnQuY29va2llID0gIm5hdmlnYXRpb249IjsgLy8gV2lwZSBvdXQgdGhlIGNvb2tpZQoJCWRvY3VtZW50LmNvb2tpZSA9ICJoaXN0TD0iICsgbmF2aWdhdGlvbkNvb2tpZTsKCQlsb2NhdGlvbi5yZXBsYWNlKG5hdmlnYXRpb25Db29raWUpOwoJfQoJCQkJCn0KCi8vIGhhbmRsZUNvbnRleHQKLy8gLS0tLS0tLS0tLS0tLQovLyBUaGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCBmcm9tIGNvbnRlbnQgcGFnZXMuIEl0IHNldHMgYSBjb29raWUgYXMgc29vbgovLyBhcyB0aGUgcGFnZSBpcyBsb2FkZWQuIElmIHRoZSBjb250ZW50IHBhZ2UgaXMgbm90IGluIGl0J3MgcHJvcGVyIHBsYWNlCi8vIGluIHRoZSBmcmFtZXNldCwgdGhlIGZyYW1lc2V0IHdpbGwgYmUgbG9hZGVkIGFuZCB0aGUgcGFnZSB3aWxsIGJlIAovLyByZXN0b3JlZCB1c2luZyB0aGUgdmFsdWUgaW4gdGhpcyBjb29raWUuCi8vCmZ1bmN0aW9uIGhhbmRsZUNvbnRleHQod2hpY2gpCnsKfQovLyBsYXN0Tm9kZU9mCi8vIC0tLS0tLS0tLS0KLy8gVGhpcyBmdW5jdGlvbiBnZXRzIHBhc3NlZCBhIFVSTCBhbmQgcmV0dXJucyB0aGUgbGFzdCBub2RlIG9mIHNhbWUuCmZ1bmN0aW9uIGxhc3ROb2RlT2YoZSkKewoJdmFyIGV4cHIgPSAiIiArIGU7Cgl2YXIgdG8gPSBleHByLmluZGV4T2YoIj8iKTsKCWlmKCB0byAhPT0gLTEpIHsKCQl2YXIgcGF0aCA9IGV4cHIuc3Vic3RyaW5nKDAsdG8pOwkJCgkJdmFyIHBpZWNlcyA9IHBhdGguc3BsaXQoIi8iKTsKCQlyZXR1cm4gcGllY2VzW3BpZWNlcy5sZW5ndGggLTFdOwoJfSAgZWxzZQl7CQoJCXZhciBwb3MgPSBleHByLmxhc3RJbmRleE9mKCIvIik7CQoJCWlmKCAocG9zICE9IC0xKSAmJiAocG9zKzEgIT0gZXhwci5sZW5ndGgpICkgewoJCQlyZXR1cm4gZXhwci5zdWJzdHIocG9zKzEpOwoJCX0gZWxzZSB7CgkJCXJldHVybiBleHByOwoJCX0KCX0KfQovLyBmcmFtZUJ1c3RlcgovLyAtLS0tLS0tLS0tLQovLyBUaGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCBieSB0aGUgZnJhbWVzZXQgdG8gZW5zdXJlIGl0J3MgYWx3YXlzIGxvYWRlZAovLyBhdCB0aGUgdG9wIGxldmVsIG9mIHRoZSBjdXJyZW50IHdpbmRvdy4KLy8KZnVuY3Rpb24gZnJhbWVCdXN0ZXIoKQp7Cn0KCgovLyBTRUFSQ0ggUkVMQVRFRC4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLlNFQVJDSCBSRUxBVEVECi8vIFNFQVJDSCBSRUxBVEVELi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uU0VBUkNIIFJFTEFURUQKLy8gU0VBUkNIIFJFTEFURUQuLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi5TRUFSQ0ggUkVMQVRFRAovLyBTRUFSQ0ggUkVMQVRFRC4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLlNFQVJDSCBSRUxBVEVECi8vIFNFQVJDSCBSRUxBVEVELi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uU0VBUkNIIFJFTEFURUQKLy8gU0VBUkNIIFJFTEFURUQuLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi5TRUFSQ0ggUkVMQVRFRAovLyBTRUFSQ0ggUkVMQVRFRC4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLlNFQVJDSCBSRUxBVEVECi8vIFNFQVJDSCBSRUxBVEVELi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uU0VBUkNIIFJFTEFURUQKLy8gU0VBUkNIIFJFTEFURUQuLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi5TRUFSQ0ggUkVMQVRFRAovLyBTRUFSQ0ggUkVMQVRFRC4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLlNFQVJDSCBSRUxBVEVECmZ1bmN0aW9uIGJ1YmJsZVNvcnRXaXRoU2hhZG93KGEsYikKewoJdmFyIHRlbXA7Cglmb3IodmFyIGo9MTsgajxhLmxlbmd0aDsgaisrKSB7CgkJZm9yKHZhciBpPTA7IGk8ajsgaSsrKSB7CgkJCWlmKCBhW2ldIDwgYVtqXSApIHsJCgkJCQl0ZW1wID0gYVtqXTthW2pdID0gYVtpXTthW2ldID0gdGVtcDsKCQkJCXRlbXAgPSBiW2pdO2Jbal0gPSBiW2ldO2JbaV0gPSB0ZW1wOwoJCQl9CgkJfQoJfQp9Ci8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmZ1bmN0aW9uIGJ1aWxkSHRtbFJlc3VsdHNTdHIoKQp7Cgl2YXIgaW5uZXJIVE1Mc3RyaW5nLG5keEVuZDsKCgkvLyBHYXRoZXIgYWxsIG9mIHRoZSByZXN1bHRzIGRpc3BsYXkgbGluZXMgaW50byB0aGUgJ3Jlc3VsdHNBcnInCgluZHhFbmQgPSAobWF0Y2hlc0FyckluZGljZXMubGVuZ3RoID4gbWF4TnVtYmVyT2ZTaG93blNlYXJjaEhpdHMgKSA/IG1heE51bWJlck9mU2hvd25TZWFyY2hIaXRzIDogbWF0Y2hlc0FyckluZGljZXMubGVuZ3RoOwoKCWZvcih2YXIgbmR4PTAsIHJlc3VsdHNBcnIgPSBuZXcgQXJyYXkoKTsgbmR4IDwgbmR4RW5kOyBuZHgrKykgewoJCXJlc3VsdHNBcnJbcmVzdWx0c0Fyci5sZW5ndGhdID0gYnVpbGRSZXN1bHRzU3RyT25lTGluZShtYXRjaGVzQXJySW5kaWNlc1tuZHhdLG1hdGNoZXNBcnJIaXRzW25keF0pOwoJfQoKCS8vIENvbnZlcnQgdGhpcyAncmVzdWx0c0FycicgaW50byBhIHNpbmdsZSBzdHJpbmcgdGhhdCB3aWxsIGJlIGluamVjdGVkIGludG8gdGhpcyBzZWFyY2ggcGFnZS4KCWlubmVySFRNTHN0cmluZyA9ICI8b2w+IjsKCWZvciggdmFyIG5keD0wOyBuZHggPCByZXN1bHRzQXJyLmxlbmd0aDsgbmR4KysgKSB7CgkJaW5uZXJIVE1Mc3RyaW5nID0gaW5uZXJIVE1Mc3RyaW5nICsgcmVzdWx0c0FycltuZHhdOwoJfQoJaW5uZXJIVE1Mc3RyaW5nID0gaW5uZXJIVE1Mc3RyaW5nICsgIjwvb2w+IjsKCXJldHVybiBpbm5lckhUTUxzdHJpbmc7Cn0KLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KZnVuY3Rpb24gYnVpbGRSZXN1bHRzU3RyT25lTGluZShhLGIpCnsKCXZhciByZXRTdHI7CglyZXRTdHIgPSAiPGxpIGNsYXNzPVwic2VhcmNocmVzdWx0c1wiPjxhIGhyZWY9XCIiICsgZmlsZUFyclthXSArICIuaHRtbFwiPiI7CgoJLy8gZm9yIGRlYnVnLi4uCgkvL3JldFN0ciArPSAidGFyZ2V0PVwiY29udGVudFwiICI7CgkvL3JldFN0ciArPSAidGl0bGU9XCIiICsgdG9wLmZpbGVBcnJbYV0gKyAiLmh0bWwtIjsKCS8vcmV0U3RyICs9IGEgKyAiLSIgKyBiICsgIlwiPiI7CgoJLy8gZm9yIHByb2R1Y3Rpb24uLi4KCS8vcmV0U3RyICs9ICJ0YXJnZXQ9XCJBZG9iZUhlbHBcIiA+IjsKCglyZXRTdHIgKz0gdGl0bGVBcnJbYV0gKyAiPC9hPjwvbGk+IjsKCXJldHVybiByZXRTdHI7Cn0KLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gY2hlY2tGb3JIaXRzCi8vICBCcmVhayB1cCB0aGUgc2VhcmNoIHRlcm0gaW50byB3b3Jkcy4KLy8gIENoZWNrIGVhY2ggb2YgdGhvc2Ugd29yZHMgYWdhaW5zdC4uLgovLwkJKGEpIGNhY2hlZCB0aXRsZXMgYW5kIAovLwkJKGIpIGNhY2hlZCBjb250ZW50IGxpbmVzIAovLyAgUGVyZm9ybSB0aGUgaGl0IGRldGVjdGlvbiBmb3IgZWFjaCBvbmUsIAovLyAgc3RvcmluZyB0aGUgcmVzdWx0cyBpbnRvIChoaXRzLW9yZGVyZWQpIAovLwkJJ21hdGNoZXNBcnJJbmRpY2VzJyBhbmQgCi8vCQknbWF0Y2hlc0FyckhpdHMnLgovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpmdW5jdGlvbiBjaGVja0ZvckhpdHMoKQp7Cgl2YXIgaW5wdXRXb3JkcyA9IG5ldyBBcnJheSgpOwoJdmFyIHRlbXBBcnIgPSBuZXcgQXJyYXkoKTsKCgkvLyBTcGxpdCB0aGUgc2VhcmNoIHRlcm0gaW50byBpbmRpdmlkdWFsIHNlYXJjaCB3b3JkcwoJCXRlbXBBcnIgPSBzZWFyY2hUZXJtLnNwbGl0KCIgIik7CgkJZm9yKHZhciBuZHg9MDsgbmR4IDwgdGVtcEFyci5sZW5ndGg7IG5keCsrKSB7CgkJCWlmKCB0ZW1wQXJyW25keF0ubGVuZ3RoICkgewoJCQkJaW5wdXRXb3Jkc1tpbnB1dFdvcmRzLmxlbmd0aF0gPSB0ZW1wQXJyW25keF07CgkJCX0KCQl9CgoJLy8gSW5pdGlhbGl6YXRpb24KCQltYXRjaGVzQXJySGl0cyA9IG5ldyBBcnJheSgpOwoJCW1hdGNoZXNBcnJJbmRpY2VzID0gbmV3IEFycmF5KCk7CgoJLy8gSW5pdGlhbGl6ZSB0aGUgJ21hc2tBcnInIGFuZCB0aGUgJ2hpdHNBcnInCgkJbWFza0FyciA9IG5ldyBBcnJheSgpOwoJCWhpdHNBcnIgPSBuZXcgQXJyYXkoKTsKCQlmb3IoIHZhciBuZHggPSAwOyBuZHggPCBmaWxlQXJyLmxlbmd0aDsgbmR4KysgKSB7CgkJCW1hc2tBcnJbbWFza0Fyci5sZW5ndGhdID0gMTsKCQkJaGl0c0FycltoaXRzQXJyLmxlbmd0aF0gPSAwOwoJCX0KCgkvLyBEbyBjaGVja2luZyBmb3IgbWF0Y2hlcyBvbiBFQUNIIE9GIFRIRSBJTlBVVCBXT1JEUwoJCWZvciggdmFyIG5keCA9IDA7IG5keCA8IGlucHV0V29yZHMubGVuZ3RoOyBuZHgrKyApIHsKCgkJCS8vICEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhIQoJCQlpZiggISBjaGVja0ZvckhpdHNXb3JkQWdhaW5zdFBhZ2VzKCBpbnB1dFdvcmRzW25keF0gKSApIHsKCQkJCXJldHVybjsgCS8vIE5vIHNlbnNlIGluIGNvbnRpbnVpbmcsIG1hdGNoIGhhcyBmYWlsZWQuCgkJCX0KCQkJLy8gISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhCgoJCQlmb3IoIHZhciBuZHgyID0gMDsgbmR4MiA8IGhpdHNBcnIubGVuZ3RoOyBuZHgyKysgKSB7CgkJCQlpZiggaGl0c0FycltuZHgyXSA9PSAwICkgewoJCQkJCW1hc2tBcnJbbmR4Ml0gPSAwOwoJCQkJfQoJCQkJZWxzZSB7CgkJCQkJaWYoIG1hc2tBcnJbbmR4Ml0gIT0gMCApIHsKCQkJCQkJbWFza0FycltuZHgyXSArPSBoaXRzQXJyW25keDJdOwoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCgkvLyBGcm9tIHRoZSBmaW5hbCAnbWFza0FycicsIGdlbmVyYXRlICdtYXRjaGVzQXJySGl0cycgYW5kICdtYXRjaGVzQXJySW5kaWNlcycJCgkJZm9yKCB2YXIgbmR4ID0gMDsgbmR4IDwgbWFza0Fyci5sZW5ndGg7IG5keCsrICkgewoJCQlpZiggbWFza0FycltuZHhdICkgewoJCQkJbWF0Y2hlc0FyckhpdHNbbWF0Y2hlc0FyckhpdHMubGVuZ3RoXSA9IG1hc2tBcnJbbmR4XTsKCQkJCW1hdGNoZXNBcnJJbmRpY2VzW21hdGNoZXNBcnJJbmRpY2VzLmxlbmd0aF0gPSBuZHg7CgkJCX0KCQl9CgoJLy8gSWYgdGhlcmUgd2VyZSBhbnkgaGl0cywgdGhlbiBzb3J0IHRoZW0gYnkgaGlnaGVzdCBoaXRzIGZpcnN0CgkJaWYoIG1hdGNoZXNBcnJJbmRpY2VzLmxlbmd0aCApIHsKCQkJYnViYmxlU29ydFdpdGhTaGFkb3cobWF0Y2hlc0FyckhpdHMsIG1hdGNoZXNBcnJJbmRpY2VzKTsKCQl9Cn0KLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KZnVuY3Rpb24gY2hlY2tGb3JIaXRzV29yZEFnYWluc3RQYWdlcyh3KQkJCnsKCXZhciBoaXRBbnl3aGVyZSA9IDA7CgkKCWlmKHNob3dJbnB1dFN0cmluZ0FsZXJ0cyl7YWxlcnQoICJMZW5ndGggb2Ygc2MyOiAiICsgc2MyLmxlbmd0aCApO30KCgkvLyBQcm9jZXNzIGVhY2ggb2YgdGhlIGNvbnRlbnQgbGluZXMgKG9uZSBwZXIgZmlsZS9wYWdlKQoJCWZvcih2YXIgbmR4PTA7IG5keCA8IHNjMi5sZW5ndGg7IG5keCsrKSB7CgoJCQkvLyBQdXQgdGhlIGNhY2hlZCB0aXRsZSBpbnRvIGdsb2JfdGl0bGUKCQkJCWdsb2JfdGl0bGUgPSBzYzFbbmR4XTsKCgkJCS8vIFB1dCB0aGUgY2FjaGVkIGNvbnRlbnQgbGluZSBpbnRvIGdsb2JfcGhyYXNlCgkJCQlnbG9iX3BocmFzZSA9IHNjMltuZHhdOwoJCQkJCgkJCWlmKCBtYXNrQXJyW25keF0gKSB7CgkJCS8vICEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEKCQkJCWlmKCBkb2N1bWVudC5pc0RibEJ5dGUgKSB7CgkJCQkJaGl0c0FycltuZHhdID0gY2hlY2tGb3JIaXRzV29yZEFnYWluc3RUaXRsZUFuZExpbmUyKHcsbmR4KTsKCQkJCX0KCQkJCWVsc2UgewoJCQkJCWhpdHNBcnJbbmR4XSA9IGNoZWNrRm9ySGl0c1dvcmRBZ2FpbnN0VGl0bGVBbmRMaW5lKHcsbmR4KTsKCQkJCX0KCQkJCWlmKCBoaXRzQXJyW25keF0gKSB7CgkJCQkJaGl0QW55d2hlcmUgPSAxOwoJCQkJfQoJCQkvLyAhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhCgkJCX0KCQl9CglyZXR1cm4gaGl0QW55d2hlcmU7Cn0KLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KZnVuY3Rpb24gY2hlY2tGb3JIaXRzV29yZEFnYWluc3RUaXRsZUFuZExpbmUodywgbGluZU5keCkKewoJdmFyIHdvcmRzOwoJdmFyIHRpdGxlSGl0Q250ID0gMDsKCXZhciBjb250ZW50SGl0Q250ID0gMDsKCXZhciByZWdleCA9IG5ldyBSZWdFeHAodywgImkiKTsKCgkvLyBUSVRMRSAuLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLgoJCXdvcmRzID0gbmV3IEFycmF5KCk7CgkJaWYoZ2xvYl90aXRsZSE9bnVsbCl7CgkJCXdvcmRzID0gZ2xvYl90aXRsZS5zcGxpdCgiICIpOwoJCX0KCQkvLyBFWEVDVVRFIFRJVExFIE1BVENIIFRFU1QKCQlmb3IoIHZhciBuZHggPSAwOyBuZHggPCB3b3Jkcy5sZW5ndGg7IG5keCsrICkgewoJCQlpZiggdyA9PSB3b3Jkc1tuZHhdICkgewoJCQkJdGl0bGVIaXRDbnQgKz0gMTAwOwoJCQkJYnJlYWs7CgkJCX0KCQl9CgoJLy8gQ09OVEVOVCAuLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLgoJCXdvcmRzID0gbmV3IEFycmF5KCk7CgkJaWYoZ2xvYl9waHJhc2UhPW51bGwpewoJCQl3b3JkcyA9IGdsb2JfcGhyYXNlLnNwbGl0KCIgIik7CgkJfQoJCS8vIEVYRUNVVEUgQ09OVEVOVCBNQVRDSCBURVNUCgkJaWYoIHJlZ2V4LnRlc3QoZ2xvYl9waHJhc2UpICkgewkvLyBTZWUgaWYgd29yZCBpcyBhbnl3aGVyZSB3aXRoaW4gdGhlIHBocmFzZSBmaXJzdC4KCQkJZm9yKCB2YXIgbmR4ID0gMDsgbmR4IDwgd29yZHMubGVuZ3RoOyBuZHgrKyApIHsKCQkJCWlmKCB3ID09IHdvcmRzW25keF0gKSB7CgkJCQkJY29udGVudEhpdENudCArPSBnZXRJbnN0YW5jZUNvdW50KGxpbmVOZHgsbmR4KTsKCQkJCQlicmVhazsKCQkJCX0KCQkJCS8vZWxzZSBpZiggdyA8IHdvcmRzW25keF0gKSB7IC8vIElmIHdvcmQgaXMgZ3JlYXRlciB0aGFuIHRoZSByZW1haW5pbmcgd29yZHMsIGxlYXZlCgkJCQkvLwlicmVhazsKCQkJCS8vfQoJCQl9CgkJfQoKCXJldHVybiB0aXRsZUhpdENudCArIGNvbnRlbnRIaXRDbnQ7Cn0KLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KZnVuY3Rpb24gY2hlY2tGb3JIaXRzV29yZEFnYWluc3RUaXRsZUFuZExpbmUyKHcsIGxpbmVOZHgpCnsKCXZhciB0aXRsZUhpdENudCA9IDA7Cgl2YXIgY29udGVudEhpdENudCA9IDA7CgoJLy8gVElUTEUgLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4KCQlpZiggZ2xvYl90aXRsZS5pbmRleE9mKHcpICE9IC0xICkgewoJCQl0aXRsZUhpdENudCA9IDEwMDsKCQl9CgoJLy8gQ09OVEVOVCAuLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLgoJCWNvbnRlbnRIaXRDbnQgPSBpbmRleGVzT2YoZ2xvYl9waHJhc2Usdyk7CgoJcmV0dXJuIHRpdGxlSGl0Q250ICsgY29udGVudEhpdENudDsKfQovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyBjaGVja1RoZUlucHV0U3RyaW5nCi8vIAovLyAgcmV0dXJucy4uLgovLwkJZW1wdHkgc3RyaW5nIC0gaWYgdGhlcmUgaXMgdmFsaWQgaW5wdXQgdG8gc2VhcmNoCi8vCQltZXNzYWdlIHN0cmluZyAtIGlmIHRoZXJlIGlzIE5PIFZBTElEIElOUFVUIHRvIHNlYXJjaAovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpmdW5jdGlvbiBjaGVja1RoZUlucHV0U3RyaW5nKCkKewoJdmFyIG15QXJyID0gbmV3IEFycmF5KCk7Cgl2YXIgdGVtcEFyciA9IG5ldyBBcnJheSgpOwoJdmFyIGZvdW5kU3RvcE9yU2hvcnRXb3JkID0gMDsKCXZhciBwdG4xID0gL1xkXEQvOwoJdmFyIHB0bjIgPSAvXERcZC87CgoJaGFuZGxlV2hpdGVzcGFjZVJlbW92YWwoKTsKCXNlYXJjaFRlcm0gPSBzZWFyY2hUZXJtLnJlcGxhY2UgKC8oJTIwKSsvZywiICIpIDsKCXNlYXJjaFRlcm0gPSBzZWFyY2hUZXJtLnRvTG93ZXJDYXNlKCk7CgoJc2VhcmNoVGVybSA9IGZpbHRlclRoZUNoYXJzKHNlYXJjaFRlcm0pOwoJCQoJaGFuZGxlV2hpdGVzcGFjZVJlbW92YWwoKTsKCglpZiggc2VhcmNoVGVybS5sZW5ndGggKSB7CgkJCgkJLy8gU3BsaXQgdGhlIHNlYXJjaFRlcm0KCQkJdGVtcEFyciA9IHNlYXJjaFRlcm0uc3BsaXQoIiAiLDEwMCk7CgkJCWlmKHNob3dJbnB1dFN0cmluZ0FsZXJ0cyl7YWxlcnQoICJzaXplIG9mIHRlbXBBcnI6ICIgKyB0ZW1wQXJyLmxlbmd0aCApO30KCgkJLy8gSGFuZGxlIHBlcmlvZHMKCQkJZm9yKCB2YXIgbmR4ID0gMDsgbmR4IDwgdGVtcEFyci5sZW5ndGg7IG5keCsrICkgewoJCQkJaWYoIHRlbXBBcnJbbmR4XS5jaGFyQ29kZUF0KDApID09IDQ2ICkgewkvLyBwZXJpb2RzIGF0IHRoZSBzdGFydCBvZiB3b3JkCgkJCQkJLy90ZW1wQXJyW25keF0gPSB0ZW1wQXJyW25keF0uc3Vic3RyKDEpOyAvLyBOT1RFOiBXZSBkb24ndCB3YW50IHRvIGRvIHRoaXMuIChlLmcuICIudHh0IikKCQkJCX0KCQkJCWlmKCB0ZW1wQXJyW25keF0uY2hhckNvZGVBdCh0ZW1wQXJyW25keF0ubGVuZ3RoLTEpID09IDQ2ICkgeyAvLyBlbmQgb2Ygd29yZAoJCQkJCXRlbXBBcnJbbmR4XSA9IHRlbXBBcnJbbmR4XS5zdWJzdHIoMCx0ZW1wQXJyW25keF0ubGVuZ3RoLTEpOwoJCQkJfQoJCQl9CgkJCQoJCS8vIERvIHN0b3B3b3JkcyBhbmQgc2hvcnR3b3JkcyByZW1vdmFsCgkJCWZvciggdmFyIG5keCA9IDA7IG5keCA8IHRlbXBBcnIubGVuZ3RoOyBuZHgrKyApIHsKCQkJCXZhciB3b3JkID0gdGVtcEFycltuZHhdOwoJCQkJaWYoc2hvd0lucHV0U3RyaW5nQWxlcnRzKXthbGVydCggIkNoZWNraW5nIHdvcmQ6ICIgKyB3b3JkICk7fQoJCQkJCgkJCQlpZiggISBzd1t3b3JkXSApIHsKCQkJCQlpZiggd29yZC5sZW5ndGggPCAyICkgewoJCQkJCQlmb3VuZFN0b3BPclNob3J0V29yZCA9IDE7CgkJCQkJfQoJCQkJCWVsc2UgaWYoICh3b3JkLmxlbmd0aCA+IDIpIHx8IChwdG4xLnRlc3Qod29yZCkgfHwgcHRuMi50ZXN0KHdvcmQpKSApIHsKCQkJCQkJbXlBcnJbbXlBcnIubGVuZ3RoXSA9IHRlbXBBcnJbbmR4XTsKCQkJCQl9CgkJCQkJZWxzZSB7CgkJCQkJCWZvdW5kU3RvcE9yU2hvcnRXb3JkID0gMTsKCQkJCQl9CgkJCQl9CgkJCQllbHNlIHsKCQkJCQlmb3VuZFN0b3BPclNob3J0V29yZCA9IDE7CgkJCQl9CgkJCX0KCgkJLy8gTm93IHJlY29uc3RydWN0IHRoZSBzZWFyY2hUZXJtLCBiYXNlZCB1cG9uIHRoZSAnbXlBcnInCgkJCXNlYXJjaFRlcm0gPSAiIjsKCQkJZm9yKCB2YXIgbmR4ID0gMDsgbmR4IDwgbXlBcnIubGVuZ3RoOyBuZHgrKyApIHsKCQkJCXNlYXJjaFRlcm0gPSBzZWFyY2hUZXJtICsgbXlBcnJbbmR4XSArICIgIjsKCQkJfQoKCQloYW5kbGVXaGl0ZXNwYWNlUmVtb3ZhbCgpOwoKCQlpZihzaG93SW5wdXRTdHJpbmdBbGVydHMpe2FsZXJ0KCAiRklOQUwgU0VBUkNIIFRFUk06ICoiICsgc2VhcmNoVGVybSArICIqIiApO30KCQkJCgkJaWYoIGZvdW5kU3RvcE9yU2hvcnRXb3JkICYmICEgc2VhcmNoVGVybS5sZW5ndGggKSB7CgkJCXJldHVybiBNU0dfc3RvcEFuZFNob3J0V29yZHM7CgkJfQoJCXNyY2hfaW5wdXRfbWFzc2FnZWQgPSBzZWFyY2hUZXJtOwoJCXJldHVybiAiIjsKCX0gCgllbHNlIHsKCQlyZXR1cm4gTVNHX25vU2VhcmNoVGVybUVudGVyZWQ7Cgl9Cn0KLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KZnVuY3Rpb24gY2hlY2tUaGVJbnB1dFN0cmluZzIoKQkJLy8gZG91YmxlLWJ5dGUgdmVyc2lvbgp7Cgl2YXIgdGVtcEFyciA9IG5ldyBBcnJheSgpOwoKCWhhbmRsZVdoaXRlc3BhY2VSZW1vdmFsKCk7CglzZWFyY2hUZXJtID0gc2VhcmNoVGVybS50b0xvd2VyQ2FzZSgpOwoKCWlmKCBzZWFyY2hUZXJtLmxlbmd0aCApIHsKCgkJLy8gU3BsaXQgdGhlIHNlYXJjaFRlcm0KCQkJdGVtcEFyciA9IHNlYXJjaFRlcm0uc3BsaXQoIiAiLDEwMCk7CgkJCWlmKHNob3dJbnB1dFN0cmluZ0FsZXJ0cyl7YWxlcnQoICJudW1iZXIgb2Ygc2VhcmNoIHRlcm1zOiAiICsgdGVtcEFyci5sZW5ndGggKTt9CgoJCS8vIE5vdyByZWNvbnN0cnVjdCB0aGUgc2VhcmNoVGVybSwgYmFzZWQgdXBvbiB0aGUgJ3RlbXBBcnInCgkJCXNlYXJjaFRlcm0gPSAiIjsKCQkJZm9yKCB2YXIgbmR4ID0gMDsgbmR4IDwgdGVtcEFyci5sZW5ndGg7IG5keCsrICkgewoJCQkJc2VhcmNoVGVybSA9IHNlYXJjaFRlcm0gKyB0ZW1wQXJyW25keF0gKyAiICI7CgkJCX0KCQkJaGFuZGxlV2hpdGVzcGFjZVJlbW92YWwoKTsKCmlmKHNob3dJbnB1dFN0cmluZ0FsZXJ0cyl7YWxlcnQoICJNYXNzYWdlZCBzZWFyY2ggdGVybTogIiArIHNlYXJjaFRlcm0gKTt9CgoJCXNyY2hfaW5wdXRfbWFzc2FnZWQgPSBzZWFyY2hUZXJtOwoJCXJldHVybiAiIjsKCX0KCWVsc2UgewoJCXJldHVybiBNU0dfbm9TZWFyY2hUZXJtRW50ZXJlZDsKCX0KfQovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpmdW5jdGlvbiBkb0lFc2VhcmNoKCkKewoJdmFyIHN0U3RyID0gIiI7CgkJCQoJZG9jdW1lbnQuZm9ybXNbMF0uc2hfdGVybS52YWx1ZSA9IHNyY2hfaW5wdXRfdmVyYmF0aW07CgkKCWlmKCBzcmNoX21lc3NhZ2UubGVuZ3RoICkgewoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJyZXN1bHRzIikuaW5uZXJIVE1MID0gc3JjaF9tZXNzYWdlOwoJCXNyY2hfbWVzc2FnZSA9ICIiOwoJfQoJZWxzZSBpZiggc3JjaF8xX3Nob3QgKSB7CgkJc3JjaF8xX3Nob3QgPSAwOwoJCQoJCXNlYXJjaFRlcm0gPSBzcmNoX2lucHV0X21hc3NhZ2VkOwoJCWNoZWNrRm9ySGl0cygpOwkvLyBTZXRzOiAnbWF0Y2hlc0FyckluZGljZXMnIGFuZCAnbWF0Y2hlc0FyckhpdHMnCgoJCWlmKCBtYXRjaGVzQXJySW5kaWNlcy5sZW5ndGggKSB7CS8vIElmIHRoZXJlIHdlcmUgbWF0Y2hlcy9oaXRzLi4uICAvKiBDaGFuZ2VkIGZvciBDUzQgKi8KCgkJCXN0U3RyID0gIjxkaXYgY2xhc3M9XCJmb3JtXCI+IiArIE1TR19wYWdlc0NvbnRhaW5pbmcgKyAiPHN0cm9uZz4iICsgc3JjaF9pbnB1dF9tYXNzYWdlZCArICI8L3N0cm9uZz48L2Rpdj48YnIgLz48YnIgLz5cbiI7CgoJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicmVzdWx0cyIpLmlubmVySFRNTCA9IHN0U3RyICsgYnVpbGRIdG1sUmVzdWx0c1N0cigpOwoJCX0KCQllbHNlIHsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qIENoYW5nZWQgZm9yIENTNCAqLwoJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicmVzdWx0cyIpLmlubmVySFRNTCA9IE1TR19ub1BhZ2VzQ29udGFpbiArICI8c3Ryb25nPiIgKyBzcmNoX2lucHV0X21hc3NhZ2VkICsgIjwvc3Ryb25nPjxiciAvPjxiciAvPiI7CgoJCX0KCQkvL3NlYXJjaGluZ19tZXNzYWdlLnN0eWxlLnZpc2liaWxpdHk9InZpc2libGUiOwoJfQoJc3JjaF9pbnB1dF92ZXJiYXRpbSA9ICIiOwp9Ci8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmZ1bmN0aW9uIGdldEluc3RhbmNlQ291bnQoIGxpbmVJbmRleCwgd29yZEluZGV4ICkKewoJdmFyIGluc3RhbmNlc1N0ciA9IGluc3RhbmNlc1tsaW5lSW5kZXhdOwkvLyBlLmcuICIxNDMyOTMxIgoJdmFyIGNoID0gaW5zdGFuY2VzU3RyLnN1YnN0cih3b3JkSW5kZXgsMSk7CgkKCXJldHVybiBwYXJzZUludChjaCk7Cn0KLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KZnVuY3Rpb24gaGFuZGxlV2hpdGVzcGFjZVJlbW92YWwoKQp7Cgl2YXIgcmVfMSA9IC9eXHMvOwoJdmFyIHJlXzIgPSAvXHMkLzsKCXZhciByZV8zID0gL1xzXHMvOwoJdmFyIHRlbXA7CgoJLy8gUmVtb3ZlIGxlYWRpbmcgd2hpdGVzcGFjZQoJCXdoaWxlKCB0cnVlICkgewoJCQl0ZW1wID0gc2VhcmNoVGVybS5yZXBsYWNlKHJlXzEsIiIpOwoJCQlpZiggdGVtcCA9PSBzZWFyY2hUZXJtICkgewoJCQkJYnJlYWs7CgkJCX0KCQkJc2VhcmNoVGVybSA9IHRlbXA7CgkJfQoJLy8gUmVtb3ZlIHRyYWlsaW5nIHdoaXRlc3BhY2UKCQl3aGlsZSggdHJ1ZSApIHsKCQkJdGVtcCA9IHNlYXJjaFRlcm0ucmVwbGFjZShyZV8yLCIiKTsKCQkJaWYoIHRlbXAgPT0gc2VhcmNoVGVybSApIHsKCQkJCWJyZWFrOwoJCQl9CgkJCXNlYXJjaFRlcm0gPSB0ZW1wOwoJCX0KCS8vIFJlcGxhY2UgbXVsdGlwbGUgY29udGlndW91cyBzcGFjZXMgd2l0aCBhIHNpbmdsZSBzcGFjZQoJCXdoaWxlKCBzZWFyY2hUZXJtLnNlYXJjaChyZV8zKSAhPSAtMSApIHsKCQkJdGVtcCA9IHNlYXJjaFRlcm0ucmVwbGFjZShyZV8zLCIgIik7CgkJCXNlYXJjaFRlcm0gPSB0ZW1wOwoJCX0KfQovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmZ1bmN0aW9uIGlzQWNjZXB0YWJsZUNoYXIoY2hyTmR4KQp7Cgl2YXIgYWNjZXB0YWJsZUNoYXJzID0gbmV3IEFycmF5KCAzMiwgNDYsIDk1ICk7CS8vIHNwYWNlLCBwZXJpb2QsIHVuZGVyc2NvcmUKCQoJZm9yKCB2YXIgbmR4ID0gMDsgbmR4IDwgYWNjZXB0YWJsZUNoYXJzLmxlbmd0aDsgbmR4KysgKSB7CgkJaWYoIGNock5keCA9PSBhY2NlcHRhYmxlQ2hhcnNbbmR4XSApIHsKCQkJcmV0dXJuIHRydWU7CgkJfQoJfQoJcmV0dXJuIGZhbHNlOwp9Ci8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KZnVuY3Rpb24gaW5kZXhlc09mKHN0cixwdG4pCnsKCXZhciBwb3NpdGlvbiA9IDA7Cgl2YXIgaGl0cyA9IC0xOwoJdmFyIHN0YXJ0ID0gLTE7CgoJd2hpbGUoIHBvc2l0aW9uICE9IC0xICkgewoJCXBvc2l0aW9uID0gc3RyLmluZGV4T2YocHRuLCBzdGFydCsxKTsKCQloaXRzICs9IDE7CgkJc3RhcnQgPSBwb3NpdGlvbjsKCX0KCXJldHVybiBoaXRzOwp9Ci8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KZnVuY3Rpb24gZmlsdGVyVGhlQ2hhcnMobGluZSkKewoJdmFyIHJldFN0ciA9ICIiLHRlbXBTdHI7Cgl2YXIgY2gsIGNoQ29kZSwgcmV0Q2hyOwoJdmFyIG5keDsKCQoJZm9yKCBuZHggPSAwOyBuZHggPCBsaW5lLmxlbmd0aDsgbmR4KysgKSB7CgkJY2ggPSBsaW5lLnN1YnN0cihuZHgsMSk7CgkJY2hDb2RlID0gY2guY2hhckNvZGVBdCgwKTsKCQkKCQkKCQkJaWYoIChjaENvZGUgPj0gMTkyKSAmJiAoY2hDb2RlIDw9IDIyMSkgKSB7CS8vIEhhbmRsZSBjYXBpdGFsIHVwcGVyLUFTQ0lJIGNoYXJhY3RlcnMKCQkJCWNoQ29kZSA9IGNoQ29kZSArIDMyOwoJCQkJcmV0Q2hyID0gQVNDSUlfdG9fY2hhcihjaENvZGUpOwoJCQl9CgkJCWVsc2UgaWYoIHdpdGhpbkFjY2VwdGFibGVSYW5nZXMoY2hDb2RlKSB8fCBpc0FjY2VwdGFibGVDaGFyKGNoQ29kZSkgKSB7IC8vIEFjY2VwdGFibGUgY2hhcmFjdGVycwoJCQkJcmV0Q2hyID0gY2g7CgkJCX0KCQkJZWxzZSB7CgkJCQl0ZW1wU3RyID0gaXNMaWdhdHVyZUNoYXIoY2hDb2RlKTsKCgkJCQlpZiggdGVtcFN0ci5sZW5ndGggKSB7CS8vRG9uJ3QgcmVwbGFjZSBsaWdhdHVyZXMuCgkJCQkJcmV0Q2hyID0gY2g7CgkJCQl9CgkJCQllbHNlIHsJCS8vIFR1cm4gYWxsIGVsc2UgaW50byBzcGFjZQkKCQkJCQlyZXRDaHIgPSAiICI7CgkJCQl9CgkJCX0KCgkJLy8gR3JvdyB0aGUgcmV0dXJuIHN0cmluZwoJCQlyZXRTdHIgKz0gcmV0Q2hyOwoJfQoJCglyZXR1cm4gcmV0U3RyOwp9Ci8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KZnVuY3Rpb24gaXNMaWdhdHVyZUNoYXIoY29kZVRvQ2hlY2spIHsKCXZhciB4bGF0VGJsTmR4LCBjb2RlLCByZXBsU3RyID0gIiI7CgoJZm9yKCB4bGF0VGJsTmR4ID0gMDsgeGxhdFRibE5keCA8IHVwcGVyQXNjaWlYbGF0VGJsLmxlbmd0aDsgeGxhdFRibE5keCs9MiApIHsKCgkJY29kZSA9IHVwcGVyQXNjaWlYbGF0VGJsW3hsYXRUYmxOZHhdOwoJCWlmKCBjb2RlID09IGNvZGVUb0NoZWNrICkgewoJCQlyZXBsU3RyID0gdXBwZXJBc2NpaVhsYXRUYmxbeGxhdFRibE5keCsxXTsKCQkJYnJlYWs7CgkJfQoJfQoJCglyZXR1cm4gcmVwbFN0cjsKfQovLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmZ1bmN0aW9uIHJlc3BvbmRUb1NlYXJjaEJ1dHRvbigpIAp7Cgl2YXIgbXlTdHI7Cglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicmVzdWx0cyIpLmlubmVySFRNTCA9ICIiOyAvL1dlIGRvbid0IGV4cGVjdCB0aGlzIHRvIGJlIHNsb3cgZW5vdWdoIHRvIG5lZWQgYSBtZXNzYWdlLgkKCXNyY2hfaW5wdXRfdmVyYmF0aW0gPSBkb2N1bWVudC5mb3Jtc1swXS5zaF90ZXJtLnZhbHVlOwoJc2VhcmNoVGVybSA9IGRvY3VtZW50LmZvcm1zWzBdLnNoX3Rlcm0udmFsdWU7CgkKCWlmKCBkb2N1bWVudC5pc0RibEJ5dGUgKSB7CgkJbXlTdHIgPSBjaGVja1RoZUlucHV0U3RyaW5nMigpOwoJfQoJZWxzZSB7CgkJbXlTdHIgPSBjaGVja1RoZUlucHV0U3RyaW5nKCk7CQoJfQoJCglzcmNoX21lc3NhZ2UgPSBteVN0cjsKCXNyY2hfMV9zaG90ID0gc3JjaF9tZXNzYWdlLmxlbmd0aCA/IDAgOiAxOwoJCglkb0lFc2VhcmNoKCk7Cn0KLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpmdW5jdGlvbiByZXNwb25kVG9TZWFyY2hMb2FkKCkgCnsKCXZhciBleHRlcm5hbFF1ZXJ5ID0gR2V0Q29va2llKCJleHRlcm5hbFF1ZXJ5Iik7CglpZiAoZXh0ZXJuYWxRdWVyeSA9PSBudWxsKSB7IAoJCQlleHRlcm5hbFF1ZXJ5ID0gR2V0Q29va2llKCJzaF90ZXJtIik7Cgl9CgoJaWYgKGV4dGVybmFsUXVlcnkgIT0gbnVsbCkgeyAKCQl2YXIgbXlTdHI7CgkJc3JjaF9pbnB1dF92ZXJiYXRpbSA9IGV4dGVybmFsUXVlcnk7CgkJc2VhcmNoVGVybSA9IGV4dGVybmFsUXVlcnk7CgkKCQlpZihkb2N1bWVudC5pc0RibEJ5dGUgKSB7CgkJICBteVN0ciA9IGNoZWNrVGhlSW5wdXRTdHJpbmcyKCk7CgkJfQoJCWVsc2UgewoJCSAgbXlTdHIgPSBjaGVja1RoZUlucHV0U3RyaW5nKCk7CQoJCX0KCQkKCQlzcmNoX21lc3NhZ2UgPSBteVN0cjsKCQlzcmNoXzFfc2hvdCA9IHNyY2hfbWVzc2FnZS5sZW5ndGggPyAwIDogMTsKCQkKCQlkb0lFc2VhcmNoKCk7Cgl9Cn0KLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KZnVuY3Rpb24gc3RyUmVwbGFjZShvcmlnLHNyYyxkZXN0KQp7Cgl2YXIgc3RhcnRQb3M9MDsKCXZhciBtYXRjaFBvcyA9IG9yaWcuaW5kZXhPZihzcmMsc3RhcnRQb3MpOwoJdmFyIHJldExpbmU9IiI7CgkKCXdoaWxlKG1hdGNoUG9zICE9IC0xKSB7CgkJcmV0TGluZSA9IHJldExpbmUgKyBvcmlnLnN1YnN0cmluZyhzdGFydFBvcyxtYXRjaFBvcykgKyBkZXN0OwoJCXN0YXJ0UG9zID0gbWF0Y2hQb3MrMTsKCQltYXRjaFBvcyA9IG9yaWcuaW5kZXhPZihzcmMsc3RhcnRQb3MpOwoJfQoJaWYoISByZXRMaW5lLmxlbmd0aCkge3JldHVybiBvcmlnO30KCWVsc2Uge3JldHVybiByZXRMaW5lK29yaWcuc3Vic3RyaW5nKHN0YXJ0UG9zLG9yaWcubGVuZ3RoKTt9Cn0KLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpmdW5jdGlvbiB3aXRoaW5BY2NlcHRhYmxlUmFuZ2VzKGNock5keCkKewkKCXZhciBhY2NlcHRhYmxlUmFuZ2VzID0gbmV3IEFycmF5KCAiNDgtNTciLCI2NS05MCIsIjk3LTEyMiIsIjIyNC0yMjkiLCIyMzEtMjM5IiwiMjQxLTI0NiIsIjI0OC0yNTMiLCIyNTUtMjU1Iik7CgkKCWZvciggdmFyIG5keCA9IDA7IG5keCA8IGFjY2VwdGFibGVSYW5nZXMubGVuZ3RoOyBuZHgrKyApIHsKCQl2YXIgc3RhcnRfZmluaXNoID0gbmV3IEFycmF5KCk7CgoJCXN0YXJ0X2ZpbmlzaCA9IGFjY2VwdGFibGVSYW5nZXNbbmR4XS5zcGxpdCgiLSIpOwoJCQoJCWlmKCAoY2hyTmR4ID49IHN0YXJ0X2ZpbmlzaFswXSkgJiYgKGNock5keCA8PSBzdGFydF9maW5pc2hbMV0pICkgewoJCQlyZXR1cm4gdHJ1ZTsKCQl9Cgl9CglyZXR1cm4gZmFsc2U7Cn0KLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpmdW5jdGlvbiBBU0NJSV90b19jaGFyKG51bV9pbikKewoJdmFyIHN0cl9vdXQgPSAiIjsKCXZhciBudW1fb3V0ID0gcGFyc2VJbnQobnVtX2luKTsKCQoJbnVtX291dCA9IHVuZXNjYXBlKCclJyArIG51bV9vdXQudG9TdHJpbmcoMTYpKTsKCXN0cl9vdXQgKz0gbnVtX291dDsKCQoJcmV0dXJuIHVuZXNjYXBlKHN0cl9vdXQpOwp9Ci8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KdmFyIGFndD1uYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCk7CnZhciB1c2VfaWVfYmVoYXZpb3IgPSBmYWxzZTsKdmFyIHVzZV9pZV82X2JlaGF2aW9yID0gZmFsc2U7CmlmIChhZ3QuaW5kZXhPZigibXNpZSIpICE9IC0xKSB7CiAgdXNlX2llX2JlaGF2aW9yID0gdHJ1ZTsKfQppZiAoKGFndC5pbmRleE9mKCJtc2llIDUiKSAhPSAtMSkgfHwgKGFndC5pbmRleE9mKCJtc2llIDYiKSAhPSAtMSkpIHsKICB1c2VfaWVfNl9iZWhhdmlvciA9IHRydWU7Cn0KCi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCnZhciBVcmwgPSB7CgoJLy8gcHVibGljIG1ldGhvZCBmb3IgdXJsIGVuY29kaW5nCgllbmNvZGUgOiBmdW5jdGlvbiAoc3RyaW5nKSB7CgkJcmV0dXJuIGVzY2FwZSh0aGlzLl91dGY4X2VuY29kZShzdHJpbmcpKTsKCX0sCgoJLy8gcHVibGljIG1ldGhvZCBmb3IgdXJsIGRlY29kaW5nCglkZWNvZGUgOiBmdW5jdGlvbiAoc3RyaW5nKSB7CgkJcmV0dXJuIHRoaXMuX3V0ZjhfZGVjb2RlKHVuZXNjYXBlKHN0cmluZykpOwoJfSwKCgkvLyBwcml2YXRlIG1ldGhvZCBmb3IgVVRGLTggZW5jb2RpbmcKCV91dGY4X2VuY29kZSA6IGZ1bmN0aW9uIChzdHJpbmcpIHsKCQlzdHJpbmcgPSBzdHJpbmcucmVwbGFjZSgvXHJcbi9nLCJcbiIpOwoJCXZhciB1dGZ0ZXh0ID0gIiI7CgoJCWZvciAodmFyIG4gPSAwOyBuIDwgc3RyaW5nLmxlbmd0aDsgbisrKSB7CgoJCQl2YXIgYyA9IHN0cmluZy5jaGFyQ29kZUF0KG4pOwoKCQkJaWYgKGMgPCAxMjgpIHsKCQkJCXV0ZnRleHQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShjKTsKCQkJfQoJCQllbHNlIGlmKChjID4gMTI3KSAmJiAoYyA8IDIwNDgpKSB7CgkJCQl1dGZ0ZXh0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoKGMgPj4gNikgfCAxOTIpOwoJCQkJdXRmdGV4dCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKChjICYgNjMpIHwgMTI4KTsKCQkJfQoJCQllbHNlIHsKCQkJCXV0ZnRleHQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoYyA+PiAxMikgfCAyMjQpOwoJCQkJdXRmdGV4dCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKCgoYyA+PiA2KSAmIDYzKSB8IDEyOCk7CgkJCQl1dGZ0ZXh0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoKGMgJiA2MykgfCAxMjgpOwoJCQl9CgoJCX0KCgkJcmV0dXJuIHV0ZnRleHQ7Cgl9LAoKCS8vIHByaXZhdGUgbWV0aG9kIGZvciBVVEYtOCBkZWNvZGluZwoJX3V0ZjhfZGVjb2RlIDogZnVuY3Rpb24gKHV0ZnRleHQpIHsKCQl2YXIgc3RyaW5nID0gIiI7CgkJdmFyIGkgPSAwOwoJCXZhciBjID0gYzEgPSBjMiA9IDA7CgoJCXdoaWxlICggaSA8IHV0ZnRleHQubGVuZ3RoICkgewoKCQkJYyA9IHV0ZnRleHQuY2hhckNvZGVBdChpKTsKCgkJCWlmIChjIDwgMTI4KSB7CgkJCQlzdHJpbmcgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShjKTsKCQkJCWkrKzsKCQkJfQoJCQllbHNlIGlmKChjID4gMTkxKSAmJiAoYyA8IDIyNCkpIHsKCQkJCWMyID0gdXRmdGV4dC5jaGFyQ29kZUF0KGkrMSk7CgkJCQlzdHJpbmcgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoKGMgJiAzMSkgPDwgNikgfCAoYzIgJiA2MykpOwoJCQkJaSArPSAyOwoJCQl9CgkJCWVsc2UgewoJCQkJYzIgPSB1dGZ0ZXh0LmNoYXJDb2RlQXQoaSsxKTsKCQkJCWMzID0gdXRmdGV4dC5jaGFyQ29kZUF0KGkrMik7CgkJCQlzdHJpbmcgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoKGMgJiAxNSkgPDwgMTIpIHwgKChjMiAmIDYzKSA8PCA2KSB8IChjMyAmIDYzKSk7CgkJCQlpICs9IDM7CgkJCX0KCgkJfQoKCQlyZXR1cm4gc3RyaW5nOwoJfQoKfQo=",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Fri, 07 Nov 2014 00:24:02 GMT",
                    "Content-Length": "25367",
                    "Date": "Fri, 07 Nov 2014 00:24:02 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}