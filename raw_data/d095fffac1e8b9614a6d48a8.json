{
    "url": "http://localhost:9999/ripvtech/angular.js/src/ngScenario/Scenario.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "DOM data manipulation (DOM-based)",
    "issueType": 5247488,
    "severity": "Information",
    "confidence": "Firm",
    "issueBackground": "DOM-based DOM data manipulation vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this to a data field within the DOM that is used within the visible UI or client-side application logic. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will modify the appearance or behavior of the client-side UI. An attacker may be able to leverage this to perform virtual defacement of the application, or possibly to induce the user to perform unintended actions.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based DOM data manipulation vulnerabilities is not to dynamically write to DOM data fields any data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from being stored. In general, this is best achieved by using a whitelist of permitted values.",
    "issueDetail": "The application may be vulnerable to DOM-based DOM data manipulation. Data is read from <b>window.location.href</b> and written to <b>the 'text()' function of JQuery</b> via the following statements:<ul><li>var href = window.location.href;</li><li>body.find('#system-error').tex...' ) .text('Scenario runner mus...' + href.split(':' ) [0 ] + ':// is not supporte...' );</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/ripvtech/angular.js/src/ngScenario/Scenario.js",
                "path": "/ripvtech/angular.js/src/ngScenario/Scenario.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9yaXB2dGVjaC9hbmd1bGFyLmpzL3NyYy9uZ1NjZW5hcmlvL1NjZW5hcmlvLmpzIEhUVFAvMS4xDQpIb3N0OiBsb2NhbGhvc3Q6OTk5OQ0KDQo=",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogOTY1MQ0KQWNjZXB0LVJhbmdlczogYnl0ZXMNCkNvbnRlbnQtVHlwZTogYXBwbGljYXRpb24vamF2YXNjcmlwdA0KRGF0ZTogVGh1LCAwNiBOb3YgMjAxNCAwODowMDoxNCBHTVQNCkxhc3QtTW9kaWZpZWQ6IFRodSwgMDYgTm92IDIwMTQgMDg6MDA6MTAgR01UDQoNCid1c2Ugc3RyaWN0JzsKCgovKioKICogU2V0dXAgZmlsZSBmb3IgdGhlIFNjZW5hcmlvLgogKiBNdXN0IGJlIGZpcnN0IGluIHRoZSBjb21waWxhdGlvbi9ib290c3RyYXAgbGlzdC4KICovCgovLyBQdWJsaWMgbmFtZXNwYWNlCmFuZ3VsYXIuc2NlbmFyaW8gPSBhbmd1bGFyLnNjZW5hcmlvIHx8IHt9OwoKLyoqCiAqIEV4cG9zZSBqUXVlcnkgKGUuZy4gZm9yIGN1c3RvbSBkc2wgZXh0ZW5zaW9ucykuCiAqLwphbmd1bGFyLnNjZW5hcmlvLmpRdWVyeSA9IF9qUXVlcnk7CgovKioKICogRGVmaW5lcyBhIG5ldyBvdXRwdXQgZm9ybWF0LgogKgogKiBAcGFyYW0ge3N0cmluZ30gbmFtZSB0aGUgbmFtZSBvZiB0aGUgbmV3IG91dHB1dCBmb3JtYXQKICogQHBhcmFtIHtmdW5jdGlvbigpfSBmbiBmdW5jdGlvbihjb250ZXh0LCBydW5uZXIpIHRoYXQgZ2VuZXJhdGVzIHRoZSBvdXRwdXQKICovCmFuZ3VsYXIuc2NlbmFyaW8ub3V0cHV0ID0gYW5ndWxhci5zY2VuYXJpby5vdXRwdXQgfHwgZnVuY3Rpb24obmFtZSwgZm4pIHsKICBhbmd1bGFyLnNjZW5hcmlvLm91dHB1dFtuYW1lXSA9IGZuOwp9OwoKLyoqCiAqIERlZmluZXMgYSBuZXcgRFNMIHN0YXRlbWVudC4gSWYgeW91ciBmYWN0b3J5IGZ1bmN0aW9uIHJldHVybnMgYSBGdXR1cmUKICogaXQncyByZXR1cm5lZCwgb3RoZXJ3aXNlIHRoZSByZXN1bHQgaXMgYXNzdW1lZCB0byBiZSBhIG1hcCBvZiBmdW5jdGlvbnMKICogZm9yIGNoYWluaW5nLiBDaGFpbmVkIGZ1bmN0aW9ucyBhcmUgc3ViamVjdCB0byB0aGUgc2FtZSBydWxlcy4KICoKICogTm90ZTogQWxsIGZ1bmN0aW9ucyBvbiB0aGUgY2hhaW4gYXJlIGJvdW5kIHRvIHRoZSBjaGFpbiBzY29wZSBzbyB2YWx1ZXMKICogICBzZXQgb24gInRoaXMiIGluIHlvdXIgc3RhdGVtZW50IGZ1bmN0aW9uIGFyZSBhdmFpbGFibGUgaW4gdGhlIGNoYWluZWQKICogICBmdW5jdGlvbnMuCiAqCiAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIFRoZSBuYW1lIG9mIHRoZSBzdGF0ZW1lbnQKICogQHBhcmFtIHtmdW5jdGlvbigpfSBmbiBGYWN0b3J5IGZ1bmN0aW9uKCksIHJldHVybiBhIGZ1bmN0aW9uIGZvcgogKiAgdGhlIHN0YXRlbWVudC4KICovCmFuZ3VsYXIuc2NlbmFyaW8uZHNsID0gYW5ndWxhci5zY2VuYXJpby5kc2wgfHwgZnVuY3Rpb24obmFtZSwgZm4pIHsKICBhbmd1bGFyLnNjZW5hcmlvLmRzbFtuYW1lXSA9IGZ1bmN0aW9uKCkgewogICAgLyoganNoaW50IC1XMDQwICovLyogVGhlIGRzbCBiaW5kcyBgdGhpc2AgZm9yIHVzIHdoZW4gY2FsbGluZyBjaGFpbmVkIGZ1bmN0aW9ucyAqLwogICAgZnVuY3Rpb24gZXhlY3V0ZVN0YXRlbWVudChzdGF0ZW1lbnQsIGFyZ3MpIHsKICAgICAgdmFyIHJlc3VsdCA9IHN0YXRlbWVudC5hcHBseSh0aGlzLCBhcmdzKTsKICAgICAgaWYgKGFuZ3VsYXIuaXNGdW5jdGlvbihyZXN1bHQpIHx8IHJlc3VsdCBpbnN0YW5jZW9mIGFuZ3VsYXIuc2NlbmFyaW8uRnV0dXJlKQogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgdmFyIGNoYWluID0gYW5ndWxhci5leHRlbmQoe30sIHJlc3VsdCk7CiAgICAgIGFuZ3VsYXIuZm9yRWFjaChjaGFpbiwgZnVuY3Rpb24odmFsdWUsIG5hbWUpIHsKICAgICAgICBpZiAoYW5ndWxhci5pc0Z1bmN0aW9uKHZhbHVlKSkgewogICAgICAgICAgY2hhaW5bbmFtZV0gPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIGV4ZWN1dGVTdGF0ZW1lbnQuY2FsbChzZWxmLCB2YWx1ZSwgYXJndW1lbnRzKTsKICAgICAgICAgIH07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNoYWluW25hbWVdID0gdmFsdWU7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgcmV0dXJuIGNoYWluOwogICAgfQogICAgdmFyIHN0YXRlbWVudCA9IGZuLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBleGVjdXRlU3RhdGVtZW50LmNhbGwodGhpcywgc3RhdGVtZW50LCBhcmd1bWVudHMpOwogICAgfTsKICB9Owp9OwoKLyoqCiAqIERlZmluZXMgYSBuZXcgbWF0Y2hlciBmb3IgdXNlIHdpdGggdGhlIGV4cGVjdHMoKSBzdGF0ZW1lbnQuIFRoZSB2YWx1ZQogKiB0aGlzLmFjdHVhbCAobGlrZSBpbiBKYXNtaW5lKSBpcyBhdmFpbGFibGUgaW4geW91ciBtYXRjaGVyIHRvIGNvbXBhcmUKICogYWdhaW5zdC4gWW91ciBmdW5jdGlvbiBzaG91bGQgcmV0dXJuIGEgYm9vbGVhbi4gVGhlIGZ1dHVyZSBpcyBhdXRvbWF0aWNhbGx5CiAqIGNyZWF0ZWQgZm9yIHlvdS4KICoKICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgVGhlIG5hbWUgb2YgdGhlIG1hdGNoZXIKICogQHBhcmFtIHtmdW5jdGlvbigpfSBmbiBUaGUgbWF0Y2hpbmcgZnVuY3Rpb24oZXhwZWN0ZWQpLgogKi8KYW5ndWxhci5zY2VuYXJpby5tYXRjaGVyID0gYW5ndWxhci5zY2VuYXJpby5tYXRjaGVyIHx8IGZ1bmN0aW9uKG5hbWUsIGZuKSB7CiAgYW5ndWxhci5zY2VuYXJpby5tYXRjaGVyW25hbWVdID0gZnVuY3Rpb24oZXhwZWN0ZWQpIHsKICAgIHZhciBkZXNjcmlwdGlvbiA9IHRoaXMuZnV0dXJlLm5hbWUgKwogICAgICAgICAgICAgICAgICAgICAgKHRoaXMuaW52ZXJzZSA/ICcgbm90ICcgOiAnICcpICsgbmFtZSArCiAgICAgICAgICAgICAgICAgICAgICAnICcgKyBhbmd1bGFyLnRvSnNvbihleHBlY3RlZCk7CiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICB0aGlzLmFkZEZ1dHVyZSgnZXhwZWN0ICcgKyBkZXNjcmlwdGlvbiwKICAgICAgZnVuY3Rpb24oZG9uZSkgewogICAgICAgIHZhciBlcnJvcjsKICAgICAgICBzZWxmLmFjdHVhbCA9IHNlbGYuZnV0dXJlLnZhbHVlOwogICAgICAgIGlmICgoc2VsZi5pbnZlcnNlICYmIGZuLmNhbGwoc2VsZiwgZXhwZWN0ZWQpKSB8fAogICAgICAgICAgICAoIXNlbGYuaW52ZXJzZSAmJiAhZm4uY2FsbChzZWxmLCBleHBlY3RlZCkpKSB7CiAgICAgICAgICBlcnJvciA9ICdleHBlY3RlZCAnICsgZGVzY3JpcHRpb24gKwogICAgICAgICAgICAnIGJ1dCB3YXMgJyArIGFuZ3VsYXIudG9Kc29uKHNlbGYuYWN0dWFsKTsKICAgICAgICB9CiAgICAgICAgZG9uZShlcnJvcik7CiAgICB9KTsKICB9Owp9OwoKLyoqCiAqIEluaXRpYWxpemUgdGhlIHNjZW5hcmlvIHJ1bm5lciBhbmQgcnVuICEKICoKICogQWNjZXNzIGdsb2JhbCB3aW5kb3cgYW5kIGRvY3VtZW50IG9iamVjdAogKiBBY2Nlc3MgJHJ1bm5lciB0aHJvdWdoIGNsb3N1cmUKICoKICogQHBhcmFtIHtPYmplY3Q9fSBjb25maWcgQ29uZmlnIG9wdGlvbnMKICovCmFuZ3VsYXIuc2NlbmFyaW8uc2V0VXBBbmRSdW4gPSBmdW5jdGlvbihjb25maWcpIHsKICB2YXIgaHJlZiA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmOwogIHZhciBib2R5ID0gX2pRdWVyeShkb2N1bWVudC5ib2R5KTsKICB2YXIgb3V0cHV0ID0gW107CiAgdmFyIG9iak1vZGVsID0gbmV3IGFuZ3VsYXIuc2NlbmFyaW8uT2JqZWN0TW9kZWwoJHJ1bm5lcik7CgogIGlmIChjb25maWcgJiYgY29uZmlnLnNjZW5hcmlvX291dHB1dCkgewogICAgb3V0cHV0ID0gY29uZmlnLnNjZW5hcmlvX291dHB1dC5zcGxpdCgnLCcpOwogIH0KCiAgYW5ndWxhci5mb3JFYWNoKGFuZ3VsYXIuc2NlbmFyaW8ub3V0cHV0LCBmdW5jdGlvbihmbiwgbmFtZSkgewogICAgaWYgKCFvdXRwdXQubGVuZ3RoIHx8IG91dHB1dC5pbmRleE9mKG5hbWUpICE9IC0xKSB7CiAgICAgIHZhciBjb250ZXh0ID0gYm9keS5hcHBlbmQoJzxkaXY+PC9kaXY+JykuZmluZCgnZGl2Omxhc3QnKTsKICAgICAgY29udGV4dC5hdHRyKCdpZCcsIG5hbWUpOwogICAgICBmbi5jYWxsKHt9LCBjb250ZXh0LCAkcnVubmVyLCBvYmpNb2RlbCk7CiAgICB9CiAgfSk7CgogIGlmICghL15odHRwLy50ZXN0KGhyZWYpICYmICEvXmh0dHBzLy50ZXN0KGhyZWYpKSB7CiAgICBib2R5LmFwcGVuZCgnPHAgaWQ9InN5c3RlbS1lcnJvciI+PC9wPicpOwogICAgYm9keS5maW5kKCcjc3lzdGVtLWVycm9yJykudGV4dCgKICAgICAgJ1NjZW5hcmlvIHJ1bm5lciBtdXN0IGJlIHJ1biB1c2luZyBodHRwIG9yIGh0dHBzLiBUaGUgcHJvdG9jb2wgJyArCiAgICAgIGhyZWYuc3BsaXQoJzonKVswXSArICc6Ly8gaXMgbm90IHN1cHBvcnRlZC4nCiAgICApOwogICAgcmV0dXJuOwogIH0KCiAgdmFyIGFwcEZyYW1lID0gYm9keS5hcHBlbmQoJzxkaXYgaWQ9ImFwcGxpY2F0aW9uIj48L2Rpdj4nKS5maW5kKCcjYXBwbGljYXRpb24nKTsKICB2YXIgYXBwbGljYXRpb24gPSBuZXcgYW5ndWxhci5zY2VuYXJpby5BcHBsaWNhdGlvbihhcHBGcmFtZSk7CgogICRydW5uZXIub24oJ1J1bm5lckVuZCcsIGZ1bmN0aW9uKCkgewogICAgYXBwRnJhbWUuY3NzKCdkaXNwbGF5JywgJ25vbmUnKTsKICAgIGFwcEZyYW1lLmZpbmQoJ2lmcmFtZScpLmF0dHIoJ3NyYycsICdhYm91dDpibGFuaycpOwogIH0pOwoKICAkcnVubmVyLm9uKCdSdW5uZXJFcnJvcicsIGZ1bmN0aW9uKGVycm9yKSB7CiAgICBpZiAod2luZG93LmNvbnNvbGUpIHsKICAgICAgY29uc29sZS5sb2coZm9ybWF0RXhjZXB0aW9uKGVycm9yKSk7CiAgICB9IGVsc2UgewogICAgICAvLyBEbyBzb21ldGhpbmcgZm9yIElFCiAgICAgIGFsZXJ0KGVycm9yKTsKICAgIH0KICB9KTsKCiAgJHJ1bm5lci5ydW4oYXBwbGljYXRpb24pOwp9OwoKLyoqCiAqIEl0ZXJhdGVzIHRocm91Z2ggbGlzdCB3aXRoIGl0ZXJhdG9yIGZ1bmN0aW9uIHRoYXQgbXVzdCBjYWxsIHRoZQogKiBjb250aW51ZUZ1bmN0aW9uIHRvIGNvbnRpbnVlIGl0ZXJhdGluZy4KICoKICogQHBhcmFtIHtBcnJheX0gbGlzdCBsaXN0IHRvIGl0ZXJhdGUgb3ZlcgogKiBAcGFyYW0ge2Z1bmN0aW9uKCl9IGl0ZXJhdG9yIENhbGxiYWNrIGZ1bmN0aW9uKHZhbHVlLCBjb250aW51ZUZ1bmN0aW9uKQogKiBAcGFyYW0ge2Z1bmN0aW9uKCl9IGRvbmUgQ2FsbGJhY2sgZnVuY3Rpb24oZXJyb3IsIHJlc3VsdCkgY2FsbGVkIHdoZW4KICogICBpdGVyYXRpb24gZmluaXNoZXMgb3IgYW4gZXJyb3Igb2NjdXJzLgogKi8KZnVuY3Rpb24gYXN5bmNGb3JFYWNoKGxpc3QsIGl0ZXJhdG9yLCBkb25lKSB7CiAgdmFyIGkgPSAwOwogIGZ1bmN0aW9uIGxvb3AoZXJyb3IsIGluZGV4KSB7CiAgICBpZiAoaW5kZXggJiYgaW5kZXggPiBpKSB7CiAgICAgIGkgPSBpbmRleDsKICAgIH0KICAgIGlmIChlcnJvciB8fCBpID49IGxpc3QubGVuZ3RoKSB7CiAgICAgIGRvbmUoZXJyb3IpOwogICAgfSBlbHNlIHsKICAgICAgdHJ5IHsKICAgICAgICBpdGVyYXRvcihsaXN0W2krK10sIGxvb3ApOwogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgZG9uZShlKTsKICAgICAgfQogICAgfQogIH0KICBsb29wKCk7Cn0KCi8qKgogKiBGb3JtYXRzIGFuIGV4Y2VwdGlvbiBpbnRvIGEgc3RyaW5nIHdpdGggdGhlIHN0YWNrIHRyYWNlLCBidXQgbGltaXRzCiAqIHRvIGEgc3BlY2lmaWMgbGluZSBsZW5ndGguCiAqCiAqIEBwYXJhbSB7T2JqZWN0fSBlcnJvciBUaGUgZXhjZXB0aW9uIHRvIGZvcm1hdCwgY2FuIGJlIGFueXRoaW5nIHRocm93YWJsZQogKiBAcGFyYW0ge051bWJlcj19IFttYXhTdGFja0xpbmVzPTVdIG1heCBsaW5lcyBvZiB0aGUgc3RhY2sgdHJhY2UgdG8gaW5jbHVkZQogKiAgZGVmYXVsdCBpcyA1LgogKi8KZnVuY3Rpb24gZm9ybWF0RXhjZXB0aW9uKGVycm9yLCBtYXhTdGFja0xpbmVzKSB7CiAgbWF4U3RhY2tMaW5lcyA9IG1heFN0YWNrTGluZXMgfHwgNTsKICB2YXIgbWVzc2FnZSA9IGVycm9yLnRvU3RyaW5nKCk7CiAgaWYgKGVycm9yLnN0YWNrKSB7CiAgICB2YXIgc3RhY2sgPSBlcnJvci5zdGFjay5zcGxpdCgnXG4nKTsKICAgIGlmIChzdGFja1swXS5pbmRleE9mKG1lc3NhZ2UpID09PSAtMSkgewogICAgICBtYXhTdGFja0xpbmVzKys7CiAgICAgIHN0YWNrLnVuc2hpZnQoZXJyb3IubWVzc2FnZSk7CiAgICB9CiAgICBtZXNzYWdlID0gc3RhY2suc2xpY2UoMCwgbWF4U3RhY2tMaW5lcykuam9pbignXG4nKTsKICB9CiAgcmV0dXJuIG1lc3NhZ2U7Cn0KCi8qKgogKiBSZXR1cm5zIGEgZnVuY3Rpb24gdGhhdCBnZXRzIHRoZSBmaWxlIG5hbWUgYW5kIGxpbmUgbnVtYmVyIGZyb20gYQogKiBsb2NhdGlvbiBpbiB0aGUgc3RhY2sgaWYgYXZhaWxhYmxlIGJhc2VkIG9uIHRoZSBjYWxsIHNpdGUuCiAqCiAqIE5vdGU6IHRoaXMgcmV0dXJucyBhbm90aGVyIGZ1bmN0aW9uIGJlY2F1c2UgYWNjZXNzaW5nIC5zdGFjayBpcyB2ZXJ5CiAqIGV4cGVuc2l2ZSBpbiBDaHJvbWUuCiAqCiAqIEBwYXJhbSB7TnVtYmVyfSBvZmZzZXQgTnVtYmVyIG9mIHN0YWNrIGxpbmVzIHRvIHNraXAKICovCmZ1bmN0aW9uIGNhbGxlckZpbGUob2Zmc2V0KSB7CiAgdmFyIGVycm9yID0gbmV3IEVycm9yKCk7CgogIHJldHVybiBmdW5jdGlvbigpIHsKICAgIHZhciBsaW5lID0gKGVycm9yLnN0YWNrIHx8ICcnKS5zcGxpdCgnXG4nKVtvZmZzZXRdOwoKICAgIC8vIENsZWFuIHVwIHRoZSBzdGFjayB0cmFjZSBsaW5lCiAgICBpZiAobGluZSkgewogICAgICBpZiAobGluZS5pbmRleE9mKCdAJykgIT09IC0xKSB7CiAgICAgICAgLy8gRmlyZWZveAogICAgICAgIGxpbmUgPSBsaW5lLnN1YnN0cmluZyhsaW5lLmluZGV4T2YoJ0AnKSsxKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBDaHJvbWUKICAgICAgICBsaW5lID0gbGluZS5zdWJzdHJpbmcobGluZS5pbmRleE9mKCcoJykrMSkucmVwbGFjZSgnKScsICcnKTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiBsaW5lIHx8ICcnOwogIH07Cn0KCgovKioKICogRG9uJ3QgdXNlIHRoZSBqUXVlcnkgdHJpZ2dlciBtZXRob2Qgc2luY2UgaXQgd29ya3MgaW5jb3JyZWN0bHkuCiAqCiAqIGpRdWVyeSBub3RpZmllcyBsaXN0ZW5lcnMgYW5kIHRoZW4gY2hhbmdlcyB0aGUgc3RhdGUgb2YgYSBjaGVja2JveCBhbmQKICogZG9lcyBub3QgY3JlYXRlIGEgcmVhbCBicm93c2VyIGV2ZW50LiBBIHJlYWwgY2xpY2sgY2hhbmdlcyB0aGUgc3RhdGUgb2YKICogdGhlIGNoZWNrYm94IGFuZCB0aGVuIG5vdGlmaWVzIGxpc3RlbmVycy4KICoKICogVG8gd29yayBhcm91bmQgdGhpcyB3ZSBpbnN0ZWFkIHVzZSBvdXIgb3duIGhhbmRsZXIgdGhhdCBmaXJlcyBhIHJlYWwgZXZlbnQuCiAqLwooZnVuY3Rpb24oZm4pewogIC8vIFdlIG5lZWQgYSBoYW5kbGUgdG8gdGhlIG9yaWdpbmFsIHRyaWdnZXIgZnVuY3Rpb24gZm9yIGlucHV0IHRlc3RzLgogIHZhciBwYXJlbnRUcmlnZ2VyID0gZm4uX29yaWdpbmFsVHJpZ2dlciA9IGZuLnRyaWdnZXI7CiAgZm4udHJpZ2dlciA9IGZ1bmN0aW9uKHR5cGUpIHsKICAgIGlmICgvKGNsaWNrfGNoYW5nZXxrZXlkb3dufGJsdXJ8aW5wdXR8bW91c2Vkb3dufG1vdXNldXApLy50ZXN0KHR5cGUpKSB7CiAgICAgIHZhciBwcm9jZXNzRGVmYXVsdHMgPSBbXTsKICAgICAgdGhpcy5lYWNoKGZ1bmN0aW9uKGluZGV4LCBub2RlKSB7CiAgICAgICAgcHJvY2Vzc0RlZmF1bHRzLnB1c2goYnJvd3NlclRyaWdnZXIobm9kZSwgdHlwZSkpOwogICAgICB9KTsKCiAgICAgIC8vIHRoaXMgaXMgbm90IGNvbXBhdGlibGUgd2l0aCBqUXVlcnkgLSB3ZSByZXR1cm4gYW4gYXJyYXkgb2YgcmV0dXJuZWQgdmFsdWVzLAogICAgICAvLyBzbyB0aGF0IHNjZW5hcmlvIHJ1bm5lciBrbm93IHdoZXRoZXIgSlMgY29kZSBoYXMgcHJldmVudERlZmF1bHQoKSBvZiB0aGUgZXZlbnQgb3Igbm90Li4uCiAgICAgIHJldHVybiBwcm9jZXNzRGVmYXVsdHM7CiAgICB9CiAgICByZXR1cm4gcGFyZW50VHJpZ2dlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogIH07Cn0pKF9qUXVlcnkuZm4pOwoKLyoqCiAqIEZpbmRzIGFsbCBiaW5kaW5ncyB3aXRoIHRoZSBzdWJzdHJpbmcgbWF0Y2ggb2YgbmFtZSBhbmQgcmV0dXJucyBhbgogKiBhcnJheSBvZiB0aGVpciB2YWx1ZXMuCiAqCiAqIEBwYXJhbSB7c3RyaW5nfSBiaW5kRXhwIFRoZSBuYW1lIHRvIG1hdGNoCiAqIEByZXR1cm4ge0FycmF5LjxzdHJpbmc+fSBTdHJpbmcgb2YgYmluZGluZyB2YWx1ZXMKICovCl9qUXVlcnkuZm4uYmluZGluZ3MgPSBmdW5jdGlvbih3aW5kb3dKcXVlcnksIGJpbmRFeHApIHsKICB2YXIgcmVzdWx0ID0gW10sIG1hdGNoLAogICAgICBiaW5kU2VsZWN0b3IgPSAnLm5nLWJpbmRpbmc6dmlzaWJsZSc7CiAgaWYgKGFuZ3VsYXIuaXNTdHJpbmcoYmluZEV4cCkpIHsKICAgIGJpbmRFeHAgPSBiaW5kRXhwLnJlcGxhY2UoL1xzL2csICcnKTsKICAgIG1hdGNoID0gZnVuY3Rpb24gKGFjdHVhbEV4cCkgewogICAgICBpZiAoYWN0dWFsRXhwKSB7CiAgICAgICAgYWN0dWFsRXhwID0gYWN0dWFsRXhwLnJlcGxhY2UoL1xzL2csICcnKTsKICAgICAgICBpZiAoYWN0dWFsRXhwID09IGJpbmRFeHApIHJldHVybiB0cnVlOwogICAgICAgIGlmIChhY3R1YWxFeHAuaW5kZXhPZihiaW5kRXhwKSA9PT0gMCkgewogICAgICAgICAgcmV0dXJuIGFjdHVhbEV4cC5jaGFyQXQoYmluZEV4cC5sZW5ndGgpID09ICd8JzsKICAgICAgICB9CiAgICAgIH0KICAgIH07CiAgfSBlbHNlIGlmIChiaW5kRXhwKSB7CiAgICBtYXRjaCA9IGZ1bmN0aW9uKGFjdHVhbEV4cCkgewogICAgICByZXR1cm4gYWN0dWFsRXhwICYmIGJpbmRFeHAuZXhlYyhhY3R1YWxFeHApOwogICAgfTsKICB9IGVsc2UgewogICAgbWF0Y2ggPSBmdW5jdGlvbihhY3R1YWxFeHApIHsKICAgICAgcmV0dXJuICEhYWN0dWFsRXhwOwogICAgfTsKICB9CiAgdmFyIHNlbGVjdGlvbiA9IHRoaXMuZmluZChiaW5kU2VsZWN0b3IpOwogIGlmICh0aGlzLmlzKGJpbmRTZWxlY3RvcikpIHsKICAgIHNlbGVjdGlvbiA9IHNlbGVjdGlvbi5hZGQodGhpcyk7CiAgfQoKICBmdW5jdGlvbiBwdXNoKHZhbHVlKSB7CiAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkgewogICAgICB2YWx1ZSA9ICcnOwogICAgfSBlbHNlIGlmICh0eXBlb2YgdmFsdWUgIT09ICdzdHJpbmcnKSB7CiAgICAgIHZhbHVlID0gYW5ndWxhci50b0pzb24odmFsdWUpOwogICAgfQogICAgcmVzdWx0LnB1c2goJycgKyB2YWx1ZSk7CiAgfQoKICBzZWxlY3Rpb24uZWFjaChmdW5jdGlvbigpIHsKICAgIHZhciBlbGVtZW50ID0gd2luZG93SnF1ZXJ5KHRoaXMpLAogICAgICAgIGJpbmRpbmdzOwogICAgaWYgKGJpbmRpbmdzID0gZWxlbWVudC5kYXRhKCckYmluZGluZycpKSB7CiAgICAgIGZvcih2YXIgZXhwcmVzc2lvbnMgPSBbXSwgYmluZGluZywgaj0wLCBqaj1iaW5kaW5ncy5sZW5ndGg7ICBqPGpqOyBqKyspIHsKICAgICAgICBiaW5kaW5nID0gYmluZGluZ3Nbal07CgogICAgICAgIGlmIChiaW5kaW5nLmV4cHJlc3Npb25zKSB7CiAgICAgICAgICBleHByZXNzaW9ucyA9IGJpbmRpbmcuZXhwcmVzc2lvbnM7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGV4cHJlc3Npb25zID0gW2JpbmRpbmddOwogICAgICAgIH0KICAgICAgICBmb3IgKHZhciBzY29wZSwgZXhwcmVzc2lvbiwgaSA9IDAsIGlpID0gZXhwcmVzc2lvbnMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgICAgZXhwcmVzc2lvbiA9IGV4cHJlc3Npb25zW2ldOwogICAgICAgICAgaWYobWF0Y2goZXhwcmVzc2lvbikpIHsKICAgICAgICAgICAgc2NvcGUgPSBzY29wZSB8fCBlbGVtZW50LnNjb3BlKCk7CiAgICAgICAgICAgIHB1c2goc2NvcGUuJGV2YWwoZXhwcmVzc2lvbikpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogIH0pOwogIHJldHVybiByZXN1bHQ7Cn07Cg==",
                "body": "J3VzZSBzdHJpY3QnOwoKCi8qKgogKiBTZXR1cCBmaWxlIGZvciB0aGUgU2NlbmFyaW8uCiAqIE11c3QgYmUgZmlyc3QgaW4gdGhlIGNvbXBpbGF0aW9uL2Jvb3RzdHJhcCBsaXN0LgogKi8KCi8vIFB1YmxpYyBuYW1lc3BhY2UKYW5ndWxhci5zY2VuYXJpbyA9IGFuZ3VsYXIuc2NlbmFyaW8gfHwge307CgovKioKICogRXhwb3NlIGpRdWVyeSAoZS5nLiBmb3IgY3VzdG9tIGRzbCBleHRlbnNpb25zKS4KICovCmFuZ3VsYXIuc2NlbmFyaW8ualF1ZXJ5ID0gX2pRdWVyeTsKCi8qKgogKiBEZWZpbmVzIGEgbmV3IG91dHB1dCBmb3JtYXQuCiAqCiAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIHRoZSBuYW1lIG9mIHRoZSBuZXcgb3V0cHV0IGZvcm1hdAogKiBAcGFyYW0ge2Z1bmN0aW9uKCl9IGZuIGZ1bmN0aW9uKGNvbnRleHQsIHJ1bm5lcikgdGhhdCBnZW5lcmF0ZXMgdGhlIG91dHB1dAogKi8KYW5ndWxhci5zY2VuYXJpby5vdXRwdXQgPSBhbmd1bGFyLnNjZW5hcmlvLm91dHB1dCB8fCBmdW5jdGlvbihuYW1lLCBmbikgewogIGFuZ3VsYXIuc2NlbmFyaW8ub3V0cHV0W25hbWVdID0gZm47Cn07CgovKioKICogRGVmaW5lcyBhIG5ldyBEU0wgc3RhdGVtZW50LiBJZiB5b3VyIGZhY3RvcnkgZnVuY3Rpb24gcmV0dXJucyBhIEZ1dHVyZQogKiBpdCdzIHJldHVybmVkLCBvdGhlcndpc2UgdGhlIHJlc3VsdCBpcyBhc3N1bWVkIHRvIGJlIGEgbWFwIG9mIGZ1bmN0aW9ucwogKiBmb3IgY2hhaW5pbmcuIENoYWluZWQgZnVuY3Rpb25zIGFyZSBzdWJqZWN0IHRvIHRoZSBzYW1lIHJ1bGVzLgogKgogKiBOb3RlOiBBbGwgZnVuY3Rpb25zIG9uIHRoZSBjaGFpbiBhcmUgYm91bmQgdG8gdGhlIGNoYWluIHNjb3BlIHNvIHZhbHVlcwogKiAgIHNldCBvbiAidGhpcyIgaW4geW91ciBzdGF0ZW1lbnQgZnVuY3Rpb24gYXJlIGF2YWlsYWJsZSBpbiB0aGUgY2hhaW5lZAogKiAgIGZ1bmN0aW9ucy4KICoKICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgVGhlIG5hbWUgb2YgdGhlIHN0YXRlbWVudAogKiBAcGFyYW0ge2Z1bmN0aW9uKCl9IGZuIEZhY3RvcnkgZnVuY3Rpb24oKSwgcmV0dXJuIGEgZnVuY3Rpb24gZm9yCiAqICB0aGUgc3RhdGVtZW50LgogKi8KYW5ndWxhci5zY2VuYXJpby5kc2wgPSBhbmd1bGFyLnNjZW5hcmlvLmRzbCB8fCBmdW5jdGlvbihuYW1lLCBmbikgewogIGFuZ3VsYXIuc2NlbmFyaW8uZHNsW25hbWVdID0gZnVuY3Rpb24oKSB7CiAgICAvKiBqc2hpbnQgLVcwNDAgKi8vKiBUaGUgZHNsIGJpbmRzIGB0aGlzYCBmb3IgdXMgd2hlbiBjYWxsaW5nIGNoYWluZWQgZnVuY3Rpb25zICovCiAgICBmdW5jdGlvbiBleGVjdXRlU3RhdGVtZW50KHN0YXRlbWVudCwgYXJncykgewogICAgICB2YXIgcmVzdWx0ID0gc3RhdGVtZW50LmFwcGx5KHRoaXMsIGFyZ3MpOwogICAgICBpZiAoYW5ndWxhci5pc0Z1bmN0aW9uKHJlc3VsdCkgfHwgcmVzdWx0IGluc3RhbmNlb2YgYW5ndWxhci5zY2VuYXJpby5GdXR1cmUpCiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICB2YXIgY2hhaW4gPSBhbmd1bGFyLmV4dGVuZCh7fSwgcmVzdWx0KTsKICAgICAgYW5ndWxhci5mb3JFYWNoKGNoYWluLCBmdW5jdGlvbih2YWx1ZSwgbmFtZSkgewogICAgICAgIGlmIChhbmd1bGFyLmlzRnVuY3Rpb24odmFsdWUpKSB7CiAgICAgICAgICBjaGFpbltuYW1lXSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gZXhlY3V0ZVN0YXRlbWVudC5jYWxsKHNlbGYsIHZhbHVlLCBhcmd1bWVudHMpOwogICAgICAgICAgfTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY2hhaW5bbmFtZV0gPSB2YWx1ZTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICByZXR1cm4gY2hhaW47CiAgICB9CiAgICB2YXIgc3RhdGVtZW50ID0gZm4uYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIGV4ZWN1dGVTdGF0ZW1lbnQuY2FsbCh0aGlzLCBzdGF0ZW1lbnQsIGFyZ3VtZW50cyk7CiAgICB9OwogIH07Cn07CgovKioKICogRGVmaW5lcyBhIG5ldyBtYXRjaGVyIGZvciB1c2Ugd2l0aCB0aGUgZXhwZWN0cygpIHN0YXRlbWVudC4gVGhlIHZhbHVlCiAqIHRoaXMuYWN0dWFsIChsaWtlIGluIEphc21pbmUpIGlzIGF2YWlsYWJsZSBpbiB5b3VyIG1hdGNoZXIgdG8gY29tcGFyZQogKiBhZ2FpbnN0LiBZb3VyIGZ1bmN0aW9uIHNob3VsZCByZXR1cm4gYSBib29sZWFuLiBUaGUgZnV0dXJlIGlzIGF1dG9tYXRpY2FsbHkKICogY3JlYXRlZCBmb3IgeW91LgogKgogKiBAcGFyYW0ge3N0cmluZ30gbmFtZSBUaGUgbmFtZSBvZiB0aGUgbWF0Y2hlcgogKiBAcGFyYW0ge2Z1bmN0aW9uKCl9IGZuIFRoZSBtYXRjaGluZyBmdW5jdGlvbihleHBlY3RlZCkuCiAqLwphbmd1bGFyLnNjZW5hcmlvLm1hdGNoZXIgPSBhbmd1bGFyLnNjZW5hcmlvLm1hdGNoZXIgfHwgZnVuY3Rpb24obmFtZSwgZm4pIHsKICBhbmd1bGFyLnNjZW5hcmlvLm1hdGNoZXJbbmFtZV0gPSBmdW5jdGlvbihleHBlY3RlZCkgewogICAgdmFyIGRlc2NyaXB0aW9uID0gdGhpcy5mdXR1cmUubmFtZSArCiAgICAgICAgICAgICAgICAgICAgICAodGhpcy5pbnZlcnNlID8gJyBub3QgJyA6ICcgJykgKyBuYW1lICsKICAgICAgICAgICAgICAgICAgICAgICcgJyArIGFuZ3VsYXIudG9Kc29uKGV4cGVjdGVkKTsKICAgIHZhciBzZWxmID0gdGhpczsKICAgIHRoaXMuYWRkRnV0dXJlKCdleHBlY3QgJyArIGRlc2NyaXB0aW9uLAogICAgICBmdW5jdGlvbihkb25lKSB7CiAgICAgICAgdmFyIGVycm9yOwogICAgICAgIHNlbGYuYWN0dWFsID0gc2VsZi5mdXR1cmUudmFsdWU7CiAgICAgICAgaWYgKChzZWxmLmludmVyc2UgJiYgZm4uY2FsbChzZWxmLCBleHBlY3RlZCkpIHx8CiAgICAgICAgICAgICghc2VsZi5pbnZlcnNlICYmICFmbi5jYWxsKHNlbGYsIGV4cGVjdGVkKSkpIHsKICAgICAgICAgIGVycm9yID0gJ2V4cGVjdGVkICcgKyBkZXNjcmlwdGlvbiArCiAgICAgICAgICAgICcgYnV0IHdhcyAnICsgYW5ndWxhci50b0pzb24oc2VsZi5hY3R1YWwpOwogICAgICAgIH0KICAgICAgICBkb25lKGVycm9yKTsKICAgIH0pOwogIH07Cn07CgovKioKICogSW5pdGlhbGl6ZSB0aGUgc2NlbmFyaW8gcnVubmVyIGFuZCBydW4gIQogKgogKiBBY2Nlc3MgZ2xvYmFsIHdpbmRvdyBhbmQgZG9jdW1lbnQgb2JqZWN0CiAqIEFjY2VzcyAkcnVubmVyIHRocm91Z2ggY2xvc3VyZQogKgogKiBAcGFyYW0ge09iamVjdD19IGNvbmZpZyBDb25maWcgb3B0aW9ucwogKi8KYW5ndWxhci5zY2VuYXJpby5zZXRVcEFuZFJ1biA9IGZ1bmN0aW9uKGNvbmZpZykgewogIHZhciBocmVmID0gd2luZG93LmxvY2F0aW9uLmhyZWY7CiAgdmFyIGJvZHkgPSBfalF1ZXJ5KGRvY3VtZW50LmJvZHkpOwogIHZhciBvdXRwdXQgPSBbXTsKICB2YXIgb2JqTW9kZWwgPSBuZXcgYW5ndWxhci5zY2VuYXJpby5PYmplY3RNb2RlbCgkcnVubmVyKTsKCiAgaWYgKGNvbmZpZyAmJiBjb25maWcuc2NlbmFyaW9fb3V0cHV0KSB7CiAgICBvdXRwdXQgPSBjb25maWcuc2NlbmFyaW9fb3V0cHV0LnNwbGl0KCcsJyk7CiAgfQoKICBhbmd1bGFyLmZvckVhY2goYW5ndWxhci5zY2VuYXJpby5vdXRwdXQsIGZ1bmN0aW9uKGZuLCBuYW1lKSB7CiAgICBpZiAoIW91dHB1dC5sZW5ndGggfHwgb3V0cHV0LmluZGV4T2YobmFtZSkgIT0gLTEpIHsKICAgICAgdmFyIGNvbnRleHQgPSBib2R5LmFwcGVuZCgnPGRpdj48L2Rpdj4nKS5maW5kKCdkaXY6bGFzdCcpOwogICAgICBjb250ZXh0LmF0dHIoJ2lkJywgbmFtZSk7CiAgICAgIGZuLmNhbGwoe30sIGNvbnRleHQsICRydW5uZXIsIG9iak1vZGVsKTsKICAgIH0KICB9KTsKCiAgaWYgKCEvXmh0dHAvLnRlc3QoaHJlZikgJiYgIS9eaHR0cHMvLnRlc3QoaHJlZikpIHsKICAgIGJvZHkuYXBwZW5kKCc8cCBpZD0ic3lzdGVtLWVycm9yIj48L3A+Jyk7CiAgICBib2R5LmZpbmQoJyNzeXN0ZW0tZXJyb3InKS50ZXh0KAogICAgICAnU2NlbmFyaW8gcnVubmVyIG11c3QgYmUgcnVuIHVzaW5nIGh0dHAgb3IgaHR0cHMuIFRoZSBwcm90b2NvbCAnICsKICAgICAgaHJlZi5zcGxpdCgnOicpWzBdICsgJzovLyBpcyBub3Qgc3VwcG9ydGVkLicKICAgICk7CiAgICByZXR1cm47CiAgfQoKICB2YXIgYXBwRnJhbWUgPSBib2R5LmFwcGVuZCgnPGRpdiBpZD0iYXBwbGljYXRpb24iPjwvZGl2PicpLmZpbmQoJyNhcHBsaWNhdGlvbicpOwogIHZhciBhcHBsaWNhdGlvbiA9IG5ldyBhbmd1bGFyLnNjZW5hcmlvLkFwcGxpY2F0aW9uKGFwcEZyYW1lKTsKCiAgJHJ1bm5lci5vbignUnVubmVyRW5kJywgZnVuY3Rpb24oKSB7CiAgICBhcHBGcmFtZS5jc3MoJ2Rpc3BsYXknLCAnbm9uZScpOwogICAgYXBwRnJhbWUuZmluZCgnaWZyYW1lJykuYXR0cignc3JjJywgJ2Fib3V0OmJsYW5rJyk7CiAgfSk7CgogICRydW5uZXIub24oJ1J1bm5lckVycm9yJywgZnVuY3Rpb24oZXJyb3IpIHsKICAgIGlmICh3aW5kb3cuY29uc29sZSkgewogICAgICBjb25zb2xlLmxvZyhmb3JtYXRFeGNlcHRpb24oZXJyb3IpKTsKICAgIH0gZWxzZSB7CiAgICAgIC8vIERvIHNvbWV0aGluZyBmb3IgSUUKICAgICAgYWxlcnQoZXJyb3IpOwogICAgfQogIH0pOwoKICAkcnVubmVyLnJ1bihhcHBsaWNhdGlvbik7Cn07CgovKioKICogSXRlcmF0ZXMgdGhyb3VnaCBsaXN0IHdpdGggaXRlcmF0b3IgZnVuY3Rpb24gdGhhdCBtdXN0IGNhbGwgdGhlCiAqIGNvbnRpbnVlRnVuY3Rpb24gdG8gY29udGludWUgaXRlcmF0aW5nLgogKgogKiBAcGFyYW0ge0FycmF5fSBsaXN0IGxpc3QgdG8gaXRlcmF0ZSBvdmVyCiAqIEBwYXJhbSB7ZnVuY3Rpb24oKX0gaXRlcmF0b3IgQ2FsbGJhY2sgZnVuY3Rpb24odmFsdWUsIGNvbnRpbnVlRnVuY3Rpb24pCiAqIEBwYXJhbSB7ZnVuY3Rpb24oKX0gZG9uZSBDYWxsYmFjayBmdW5jdGlvbihlcnJvciwgcmVzdWx0KSBjYWxsZWQgd2hlbgogKiAgIGl0ZXJhdGlvbiBmaW5pc2hlcyBvciBhbiBlcnJvciBvY2N1cnMuCiAqLwpmdW5jdGlvbiBhc3luY0ZvckVhY2gobGlzdCwgaXRlcmF0b3IsIGRvbmUpIHsKICB2YXIgaSA9IDA7CiAgZnVuY3Rpb24gbG9vcChlcnJvciwgaW5kZXgpIHsKICAgIGlmIChpbmRleCAmJiBpbmRleCA+IGkpIHsKICAgICAgaSA9IGluZGV4OwogICAgfQogICAgaWYgKGVycm9yIHx8IGkgPj0gbGlzdC5sZW5ndGgpIHsKICAgICAgZG9uZShlcnJvcik7CiAgICB9IGVsc2UgewogICAgICB0cnkgewogICAgICAgIGl0ZXJhdG9yKGxpc3RbaSsrXSwgbG9vcCk7CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICBkb25lKGUpOwogICAgICB9CiAgICB9CiAgfQogIGxvb3AoKTsKfQoKLyoqCiAqIEZvcm1hdHMgYW4gZXhjZXB0aW9uIGludG8gYSBzdHJpbmcgd2l0aCB0aGUgc3RhY2sgdHJhY2UsIGJ1dCBsaW1pdHMKICogdG8gYSBzcGVjaWZpYyBsaW5lIGxlbmd0aC4KICoKICogQHBhcmFtIHtPYmplY3R9IGVycm9yIFRoZSBleGNlcHRpb24gdG8gZm9ybWF0LCBjYW4gYmUgYW55dGhpbmcgdGhyb3dhYmxlCiAqIEBwYXJhbSB7TnVtYmVyPX0gW21heFN0YWNrTGluZXM9NV0gbWF4IGxpbmVzIG9mIHRoZSBzdGFjayB0cmFjZSB0byBpbmNsdWRlCiAqICBkZWZhdWx0IGlzIDUuCiAqLwpmdW5jdGlvbiBmb3JtYXRFeGNlcHRpb24oZXJyb3IsIG1heFN0YWNrTGluZXMpIHsKICBtYXhTdGFja0xpbmVzID0gbWF4U3RhY2tMaW5lcyB8fCA1OwogIHZhciBtZXNzYWdlID0gZXJyb3IudG9TdHJpbmcoKTsKICBpZiAoZXJyb3Iuc3RhY2spIHsKICAgIHZhciBzdGFjayA9IGVycm9yLnN0YWNrLnNwbGl0KCdcbicpOwogICAgaWYgKHN0YWNrWzBdLmluZGV4T2YobWVzc2FnZSkgPT09IC0xKSB7CiAgICAgIG1heFN0YWNrTGluZXMrKzsKICAgICAgc3RhY2sudW5zaGlmdChlcnJvci5tZXNzYWdlKTsKICAgIH0KICAgIG1lc3NhZ2UgPSBzdGFjay5zbGljZSgwLCBtYXhTdGFja0xpbmVzKS5qb2luKCdcbicpOwogIH0KICByZXR1cm4gbWVzc2FnZTsKfQoKLyoqCiAqIFJldHVybnMgYSBmdW5jdGlvbiB0aGF0IGdldHMgdGhlIGZpbGUgbmFtZSBhbmQgbGluZSBudW1iZXIgZnJvbSBhCiAqIGxvY2F0aW9uIGluIHRoZSBzdGFjayBpZiBhdmFpbGFibGUgYmFzZWQgb24gdGhlIGNhbGwgc2l0ZS4KICoKICogTm90ZTogdGhpcyByZXR1cm5zIGFub3RoZXIgZnVuY3Rpb24gYmVjYXVzZSBhY2Nlc3NpbmcgLnN0YWNrIGlzIHZlcnkKICogZXhwZW5zaXZlIGluIENocm9tZS4KICoKICogQHBhcmFtIHtOdW1iZXJ9IG9mZnNldCBOdW1iZXIgb2Ygc3RhY2sgbGluZXMgdG8gc2tpcAogKi8KZnVuY3Rpb24gY2FsbGVyRmlsZShvZmZzZXQpIHsKICB2YXIgZXJyb3IgPSBuZXcgRXJyb3IoKTsKCiAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgdmFyIGxpbmUgPSAoZXJyb3Iuc3RhY2sgfHwgJycpLnNwbGl0KCdcbicpW29mZnNldF07CgogICAgLy8gQ2xlYW4gdXAgdGhlIHN0YWNrIHRyYWNlIGxpbmUKICAgIGlmIChsaW5lKSB7CiAgICAgIGlmIChsaW5lLmluZGV4T2YoJ0AnKSAhPT0gLTEpIHsKICAgICAgICAvLyBGaXJlZm94CiAgICAgICAgbGluZSA9IGxpbmUuc3Vic3RyaW5nKGxpbmUuaW5kZXhPZignQCcpKzEpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIENocm9tZQogICAgICAgIGxpbmUgPSBsaW5lLnN1YnN0cmluZyhsaW5lLmluZGV4T2YoJygnKSsxKS5yZXBsYWNlKCcpJywgJycpOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIGxpbmUgfHwgJyc7CiAgfTsKfQoKCi8qKgogKiBEb24ndCB1c2UgdGhlIGpRdWVyeSB0cmlnZ2VyIG1ldGhvZCBzaW5jZSBpdCB3b3JrcyBpbmNvcnJlY3RseS4KICoKICogalF1ZXJ5IG5vdGlmaWVzIGxpc3RlbmVycyBhbmQgdGhlbiBjaGFuZ2VzIHRoZSBzdGF0ZSBvZiBhIGNoZWNrYm94IGFuZAogKiBkb2VzIG5vdCBjcmVhdGUgYSByZWFsIGJyb3dzZXIgZXZlbnQuIEEgcmVhbCBjbGljayBjaGFuZ2VzIHRoZSBzdGF0ZSBvZgogKiB0aGUgY2hlY2tib3ggYW5kIHRoZW4gbm90aWZpZXMgbGlzdGVuZXJzLgogKgogKiBUbyB3b3JrIGFyb3VuZCB0aGlzIHdlIGluc3RlYWQgdXNlIG91ciBvd24gaGFuZGxlciB0aGF0IGZpcmVzIGEgcmVhbCBldmVudC4KICovCihmdW5jdGlvbihmbil7CiAgLy8gV2UgbmVlZCBhIGhhbmRsZSB0byB0aGUgb3JpZ2luYWwgdHJpZ2dlciBmdW5jdGlvbiBmb3IgaW5wdXQgdGVzdHMuCiAgdmFyIHBhcmVudFRyaWdnZXIgPSBmbi5fb3JpZ2luYWxUcmlnZ2VyID0gZm4udHJpZ2dlcjsKICBmbi50cmlnZ2VyID0gZnVuY3Rpb24odHlwZSkgewogICAgaWYgKC8oY2xpY2t8Y2hhbmdlfGtleWRvd258Ymx1cnxpbnB1dHxtb3VzZWRvd258bW91c2V1cCkvLnRlc3QodHlwZSkpIHsKICAgICAgdmFyIHByb2Nlc3NEZWZhdWx0cyA9IFtdOwogICAgICB0aGlzLmVhY2goZnVuY3Rpb24oaW5kZXgsIG5vZGUpIHsKICAgICAgICBwcm9jZXNzRGVmYXVsdHMucHVzaChicm93c2VyVHJpZ2dlcihub2RlLCB0eXBlKSk7CiAgICAgIH0pOwoKICAgICAgLy8gdGhpcyBpcyBub3QgY29tcGF0aWJsZSB3aXRoIGpRdWVyeSAtIHdlIHJldHVybiBhbiBhcnJheSBvZiByZXR1cm5lZCB2YWx1ZXMsCiAgICAgIC8vIHNvIHRoYXQgc2NlbmFyaW8gcnVubmVyIGtub3cgd2hldGhlciBKUyBjb2RlIGhhcyBwcmV2ZW50RGVmYXVsdCgpIG9mIHRoZSBldmVudCBvciBub3QuLi4KICAgICAgcmV0dXJuIHByb2Nlc3NEZWZhdWx0czsKICAgIH0KICAgIHJldHVybiBwYXJlbnRUcmlnZ2VyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgfTsKfSkoX2pRdWVyeS5mbik7CgovKioKICogRmluZHMgYWxsIGJpbmRpbmdzIHdpdGggdGhlIHN1YnN0cmluZyBtYXRjaCBvZiBuYW1lIGFuZCByZXR1cm5zIGFuCiAqIGFycmF5IG9mIHRoZWlyIHZhbHVlcy4KICoKICogQHBhcmFtIHtzdHJpbmd9IGJpbmRFeHAgVGhlIG5hbWUgdG8gbWF0Y2gKICogQHJldHVybiB7QXJyYXkuPHN0cmluZz59IFN0cmluZyBvZiBiaW5kaW5nIHZhbHVlcwogKi8KX2pRdWVyeS5mbi5iaW5kaW5ncyA9IGZ1bmN0aW9uKHdpbmRvd0pxdWVyeSwgYmluZEV4cCkgewogIHZhciByZXN1bHQgPSBbXSwgbWF0Y2gsCiAgICAgIGJpbmRTZWxlY3RvciA9ICcubmctYmluZGluZzp2aXNpYmxlJzsKICBpZiAoYW5ndWxhci5pc1N0cmluZyhiaW5kRXhwKSkgewogICAgYmluZEV4cCA9IGJpbmRFeHAucmVwbGFjZSgvXHMvZywgJycpOwogICAgbWF0Y2ggPSBmdW5jdGlvbiAoYWN0dWFsRXhwKSB7CiAgICAgIGlmIChhY3R1YWxFeHApIHsKICAgICAgICBhY3R1YWxFeHAgPSBhY3R1YWxFeHAucmVwbGFjZSgvXHMvZywgJycpOwogICAgICAgIGlmIChhY3R1YWxFeHAgPT0gYmluZEV4cCkgcmV0dXJuIHRydWU7CiAgICAgICAgaWYgKGFjdHVhbEV4cC5pbmRleE9mKGJpbmRFeHApID09PSAwKSB7CiAgICAgICAgICByZXR1cm4gYWN0dWFsRXhwLmNoYXJBdChiaW5kRXhwLmxlbmd0aCkgPT0gJ3wnOwogICAgICAgIH0KICAgICAgfQogICAgfTsKICB9IGVsc2UgaWYgKGJpbmRFeHApIHsKICAgIG1hdGNoID0gZnVuY3Rpb24oYWN0dWFsRXhwKSB7CiAgICAgIHJldHVybiBhY3R1YWxFeHAgJiYgYmluZEV4cC5leGVjKGFjdHVhbEV4cCk7CiAgICB9OwogIH0gZWxzZSB7CiAgICBtYXRjaCA9IGZ1bmN0aW9uKGFjdHVhbEV4cCkgewogICAgICByZXR1cm4gISFhY3R1YWxFeHA7CiAgICB9OwogIH0KICB2YXIgc2VsZWN0aW9uID0gdGhpcy5maW5kKGJpbmRTZWxlY3Rvcik7CiAgaWYgKHRoaXMuaXMoYmluZFNlbGVjdG9yKSkgewogICAgc2VsZWN0aW9uID0gc2VsZWN0aW9uLmFkZCh0aGlzKTsKICB9CgogIGZ1bmN0aW9uIHB1c2godmFsdWUpIHsKICAgIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIHZhbHVlID0gJyc7CiAgICB9IGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gJ3N0cmluZycpIHsKICAgICAgdmFsdWUgPSBhbmd1bGFyLnRvSnNvbih2YWx1ZSk7CiAgICB9CiAgICByZXN1bHQucHVzaCgnJyArIHZhbHVlKTsKICB9CgogIHNlbGVjdGlvbi5lYWNoKGZ1bmN0aW9uKCkgewogICAgdmFyIGVsZW1lbnQgPSB3aW5kb3dKcXVlcnkodGhpcyksCiAgICAgICAgYmluZGluZ3M7CiAgICBpZiAoYmluZGluZ3MgPSBlbGVtZW50LmRhdGEoJyRiaW5kaW5nJykpIHsKICAgICAgZm9yKHZhciBleHByZXNzaW9ucyA9IFtdLCBiaW5kaW5nLCBqPTAsIGpqPWJpbmRpbmdzLmxlbmd0aDsgIGo8amo7IGorKykgewogICAgICAgIGJpbmRpbmcgPSBiaW5kaW5nc1tqXTsKCiAgICAgICAgaWYgKGJpbmRpbmcuZXhwcmVzc2lvbnMpIHsKICAgICAgICAgIGV4cHJlc3Npb25zID0gYmluZGluZy5leHByZXNzaW9uczsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZXhwcmVzc2lvbnMgPSBbYmluZGluZ107CiAgICAgICAgfQogICAgICAgIGZvciAodmFyIHNjb3BlLCBleHByZXNzaW9uLCBpID0gMCwgaWkgPSBleHByZXNzaW9ucy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICBleHByZXNzaW9uID0gZXhwcmVzc2lvbnNbaV07CiAgICAgICAgICBpZihtYXRjaChleHByZXNzaW9uKSkgewogICAgICAgICAgICBzY29wZSA9IHNjb3BlIHx8IGVsZW1lbnQuc2NvcGUoKTsKICAgICAgICAgICAgcHVzaChzY29wZS4kZXZhbChleHByZXNzaW9uKSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfSk7CiAgcmV0dXJuIHJlc3VsdDsKfTsK",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Thu, 06 Nov 2014 08:00:10 GMT",
                    "Content-Length": "9651",
                    "Date": "Thu, 06 Nov 2014 08:00:14 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}