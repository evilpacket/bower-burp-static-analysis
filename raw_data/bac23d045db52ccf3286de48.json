{
    "url": "http://localhost:9999/lhorie/mithril.js/archive/v0.1.17/mithril.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Link manipulation (DOM-based)",
    "issueType": 5246976,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based link manipulation vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this to a navigation target within the current page, such as a clickable link or the submission URL of a form. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will modify the target of links within the response. An attacker may be able to leverage this to perform various attacks, including:<ul><li>Causing the user to redirect to an arbitrary external URL, to facilitate a phishing attack.</li><li>Causing the user to submit sensitive form data to a server controlled by the attacker.</li><li>Causing the user to perform an unintended action within the application, by changing the file or query string associated with a link.</li><li>Bypassing browser anti-XSS defenses by injecting on-site links containing XSS exploits, since browser anti-XSS defenses typically do not operate on on-site links.</li></ul>",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based link manipulation vulnerabilities is not to dynamically set the target URLs of links or forms using data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing an arbitrary URL as a link target. In general, this is best achieved by using a whitelist of URLs that are permitted link targets, and strictly validating the target against this list before setting the link target.",
    "issueDetail": "The application may be vulnerable to DOM-based link manipulation. Data is read from <b>window.location.pathname</b> and written to <b>the 'href' property of a DOM element</b> via the following statement:<ul><li>element.href = window.location.pathname + modes[m.route.mode] + element.pathname</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/lhorie/mithril.js/archive/v0.1.17/mithril.js",
                "path": "/lhorie/mithril.js/archive/v0.1.17/mithril.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9saG9yaWUvbWl0aHJpbC5qcy9hcmNoaXZlL3YwLjEuMTcvbWl0aHJpbC5qcyBIVFRQLzEuMQ0KSG9zdDogbG9jYWxob3N0Ojk5OTkNCg0K",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMjM2ODINCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IEZyaSwgMDcgTm92IDIwMTQgMTY6MTI6MTkgR01UDQpMYXN0LU1vZGlmaWVkOiBGcmksIDA3IE5vdiAyMDE0IDE2OjEyOjE3IEdNVA0KDQpNaXRocmlsID0gbSA9IG5ldyBmdW5jdGlvbiBhcHAod2luZG93KSB7Cgl2YXIgc2VsZWN0b3JDYWNoZSA9IHt9Cgl2YXIgdHlwZSA9IHt9LnRvU3RyaW5nCgl2YXIgcGFyc2VyID0gLyg/OihefCN8XC4pKFteI1wuXFtcXV0rKSl8KFxbLis/XF0pL2csIGF0dHJQYXJzZXIgPSAvXFsoLis/KSg/Oj0oInwnfCkoLio/KVwyKT9cXS8KCglmdW5jdGlvbiBtKCkgewoJCXZhciBhcmdzID0gYXJndW1lbnRzCgkJdmFyIGhhc0F0dHJzID0gdHlwZS5jYWxsKGFyZ3NbMV0pID09ICJbb2JqZWN0IE9iamVjdF0iICYmICEoInRhZyIgaW4gYXJnc1sxXSkgJiYgISgic3VidHJlZSIgaW4gYXJnc1sxXSkKCQl2YXIgYXR0cnMgPSBoYXNBdHRycyA/IGFyZ3NbMV0gOiB7fQoJCXZhciBjbGFzc0F0dHJOYW1lID0gImNsYXNzIiBpbiBhdHRycyA/ICJjbGFzcyIgOiAiY2xhc3NOYW1lIgoJCXZhciBjZWxsID0gc2VsZWN0b3JDYWNoZVthcmdzWzBdXQoJCWlmIChjZWxsID09PSB1bmRlZmluZWQpIHsKCQkJc2VsZWN0b3JDYWNoZVthcmdzWzBdXSA9IGNlbGwgPSB7dGFnOiAiZGl2IiwgYXR0cnM6IHt9fQoJCQl2YXIgbWF0Y2gsIGNsYXNzZXMgPSBbXQoJCQl3aGlsZSAobWF0Y2ggPSBwYXJzZXIuZXhlYyhhcmdzWzBdKSkgewoJCQkJaWYgKG1hdGNoWzFdID09ICIiKSBjZWxsLnRhZyA9IG1hdGNoWzJdCgkJCQllbHNlIGlmIChtYXRjaFsxXSA9PSAiIyIpIGNlbGwuYXR0cnMuaWQgPSBtYXRjaFsyXQoJCQkJZWxzZSBpZiAobWF0Y2hbMV0gPT0gIi4iKSBjbGFzc2VzLnB1c2gobWF0Y2hbMl0pCgkJCQllbHNlIGlmIChtYXRjaFszXVswXSA9PSAiWyIpIHsKCQkJCQl2YXIgcGFpciA9IGF0dHJQYXJzZXIuZXhlYyhtYXRjaFszXSkKCQkJCQljZWxsLmF0dHJzW3BhaXJbMV1dID0gcGFpclszXSB8fCAocGFpclsyXSA/ICIiIDp0cnVlKQoJCQkJfQoJCQl9CgkJCWlmIChjbGFzc2VzLmxlbmd0aCA+IDApIGNlbGwuYXR0cnNbY2xhc3NBdHRyTmFtZV0gPSBjbGFzc2VzLmpvaW4oIiAiKQoJCX0KCQljZWxsID0gY2xvbmUoY2VsbCkKCQljZWxsLmF0dHJzID0gY2xvbmUoY2VsbC5hdHRycykKCQljZWxsLmNoaWxkcmVuID0gaGFzQXR0cnMgPyBhcmdzWzJdIDogYXJnc1sxXQoJCWZvciAodmFyIGF0dHJOYW1lIGluIGF0dHJzKSB7CgkJCWlmIChhdHRyTmFtZSA9PSBjbGFzc0F0dHJOYW1lKSBjZWxsLmF0dHJzW2F0dHJOYW1lXSA9IChjZWxsLmF0dHJzW2F0dHJOYW1lXSB8fCAiIikgKyAiICIgKyBhdHRyc1thdHRyTmFtZV0KCQkJZWxzZSBjZWxsLmF0dHJzW2F0dHJOYW1lXSA9IGF0dHJzW2F0dHJOYW1lXQoJCX0KCQlyZXR1cm4gY2VsbAoJfQoJZnVuY3Rpb24gYnVpbGQocGFyZW50RWxlbWVudCwgcGFyZW50VGFnLCBwYXJlbnRDYWNoZSwgcGFyZW50SW5kZXgsIGRhdGEsIGNhY2hlZCwgc2hvdWxkUmVhdHRhY2gsIGluZGV4LCBlZGl0YWJsZSwgbmFtZXNwYWNlLCBjb25maWdzKSB7CgkJaWYgKGRhdGEgPT09IG51bGwgfHwgZGF0YSA9PT0gdW5kZWZpbmVkKSBkYXRhID0gIiIKCQlpZiAoZGF0YS5zdWJ0cmVlID09PSAicmV0YWluIikgcmV0dXJuIGNhY2hlZAoKCQl2YXIgY2FjaGVkVHlwZSA9IHR5cGUuY2FsbChjYWNoZWQpLCBkYXRhVHlwZSA9IHR5cGUuY2FsbChkYXRhKQoJCWlmIChjYWNoZWRUeXBlICE9IGRhdGFUeXBlKSB7CgkJCWlmIChjYWNoZWQgIT09IG51bGwgJiYgY2FjaGVkICE9PSB1bmRlZmluZWQpIHsKCQkJCWlmIChwYXJlbnRDYWNoZSAmJiBwYXJlbnRDYWNoZS5ub2RlcykgewoJCQkJCXZhciBvZmZzZXQgPSBpbmRleCAtIHBhcmVudEluZGV4CgkJCQkJdmFyIGVuZCA9IG9mZnNldCArIChkYXRhVHlwZSA9PSAiW29iamVjdCBBcnJheV0iID8gZGF0YSA6IGNhY2hlZC5ub2RlcykubGVuZ3RoCgkJCQkJY2xlYXIocGFyZW50Q2FjaGUubm9kZXMuc2xpY2Uob2Zmc2V0LCBlbmQpLCBwYXJlbnRDYWNoZS5zbGljZShvZmZzZXQsIGVuZCkpCgkJCQl9CgkJCQllbHNlIGNsZWFyKGNhY2hlZC5ub2RlcywgY2FjaGVkKQoJCQl9CgkJCWNhY2hlZCA9IG5ldyBkYXRhLmNvbnN0cnVjdG9yCgkJCWNhY2hlZC5ub2RlcyA9IFtdCgkJfQoKCQlpZiAoZGF0YVR5cGUgPT0gIltvYmplY3QgQXJyYXldIikgewoJCQl2YXIgbm9kZXMgPSBbXSwgaW50YWN0ID0gY2FjaGVkLmxlbmd0aCA9PT0gZGF0YS5sZW5ndGgsIHN1YkFycmF5Q291bnQgPSAwCgkJCQoJCQl2YXIgREVMRVRJT04gPSAxLCBJTlNFUlRJT04gPSAyICwgTU9WRSA9IDMKCQkJdmFyIGV4aXN0aW5nID0ge30sIHNob3VsZE1haW50YWluSWRlbnRpdGllcyA9IGZhbHNlCgkJCWZvciAodmFyIGkgPSAwOyBpIDwgY2FjaGVkLmxlbmd0aDsgaSsrKSB7CgkJCQlpZiAoY2FjaGVkW2ldICYmIGNhY2hlZFtpXS5hdHRycyAmJiBjYWNoZWRbaV0uYXR0cnMua2V5ICE9PSB1bmRlZmluZWQpIHsKCQkJCQlzaG91bGRNYWludGFpbklkZW50aXRpZXMgPSB0cnVlCgkJCQkJZXhpc3RpbmdbY2FjaGVkW2ldLmF0dHJzLmtleV0gPSB7YWN0aW9uOiBERUxFVElPTiwgaW5kZXg6IGl9CgkJCQl9CgkJCX0KCQkJaWYgKHNob3VsZE1haW50YWluSWRlbnRpdGllcykgewoJCQkJZm9yICh2YXIgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSsrKSB7CgkJCQkJaWYgKGRhdGFbaV0gJiYgZGF0YVtpXS5hdHRycyAmJiBkYXRhW2ldLmF0dHJzLmtleSAhPT0gdW5kZWZpbmVkKSB7CgkJCQkJCXZhciBrZXkgPSBkYXRhW2ldLmF0dHJzLmtleQoJCQkJCQlpZiAoIWV4aXN0aW5nW2tleV0pIGV4aXN0aW5nW2tleV0gPSB7YWN0aW9uOiBJTlNFUlRJT04sIGluZGV4OiBpfQoJCQkJCQllbHNlIGV4aXN0aW5nW2tleV0gPSB7YWN0aW9uOiBNT1ZFLCBpbmRleDogaSwgZnJvbTogZXhpc3Rpbmdba2V5XS5pbmRleCwgZWxlbWVudDogcGFyZW50RWxlbWVudC5jaGlsZE5vZGVzW2V4aXN0aW5nW2tleV0uaW5kZXhdfQoJCQkJCX0KCQkJCX0KCQkJCXZhciBhY3Rpb25zID0gT2JqZWN0LmtleXMoZXhpc3RpbmcpLm1hcChmdW5jdGlvbihrZXkpIHtyZXR1cm4gZXhpc3Rpbmdba2V5XX0pCgkJCQl2YXIgY2hhbmdlcyA9IGFjdGlvbnMuc29ydChmdW5jdGlvbihhLCBiKSB7cmV0dXJuIGEuYWN0aW9uIC0gYi5hY3Rpb24gfHwgYi5pbmRleCAtIGEuaW5kZXh9KQoJCQkJdmFyIG5ld0NhY2hlZCA9IG5ldyBBcnJheShjYWNoZWQubGVuZ3RoKQoJCQkJCgkJCQlmb3IgKHZhciBpID0gMCwgY2hhbmdlOyBjaGFuZ2UgPSBjaGFuZ2VzW2ldOyBpKyspIHsKCQkJCQlpZiAoY2hhbmdlLmFjdGlvbiA9PSBERUxFVElPTikgewoJCQkJCQljbGVhcihjYWNoZWRbY2hhbmdlLmluZGV4XS5ub2RlcywgY2FjaGVkW2NoYW5nZS5pbmRleF0pCgkJCQkJCW5ld0NhY2hlZC5zcGxpY2UoY2hhbmdlLmluZGV4LCAxKQoJCQkJCX0KCQkJCQlpZiAoY2hhbmdlLmFjdGlvbiA9PSBJTlNFUlRJT04pIHsKCQkJCQkJdmFyIGR1bW15ID0gd2luZG93LmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJCQkJCWR1bW15LmtleSA9IGRhdGFbY2hhbmdlLmluZGV4XS5hdHRycy5rZXkudG9TdHJpbmcoKQoJCQkJCQlwYXJlbnRFbGVtZW50Lmluc2VydEJlZm9yZShkdW1teSwgcGFyZW50RWxlbWVudC5jaGlsZE5vZGVzW2NoYW5nZS5pbmRleF0pCgkJCQkJCW5ld0NhY2hlZC5zcGxpY2UoY2hhbmdlLmluZGV4LCAwLCB7YXR0cnM6IHtrZXk6IGRhdGFbY2hhbmdlLmluZGV4XS5hdHRycy5rZXl9LCBub2RlczogW2R1bW15XX0pCgkJCQkJfQoJCQkJCQoJCQkJCWlmIChjaGFuZ2UuYWN0aW9uID09IE1PVkUpIHsKCQkJCQkJaWYgKHBhcmVudEVsZW1lbnQuY2hpbGROb2Rlc1tjaGFuZ2UuaW5kZXhdICE9PSBjaGFuZ2UuZWxlbWVudCkgewoJCQkJCQkJcGFyZW50RWxlbWVudC5pbnNlcnRCZWZvcmUoY2hhbmdlLmVsZW1lbnQsIHBhcmVudEVsZW1lbnQuY2hpbGROb2Rlc1tjaGFuZ2UuaW5kZXhdKQoJCQkJCQl9CgkJCQkJCW5ld0NhY2hlZFtjaGFuZ2UuaW5kZXhdID0gY2FjaGVkW2NoYW5nZS5mcm9tXQoJCQkJCX0KCQkJCX0KCQkJCWNhY2hlZCA9IG5ld0NhY2hlZAoJCQkJY2FjaGVkLm5vZGVzID0gW10KCQkJCWZvciAodmFyIGkgPSAwLCBjaGlsZDsgY2hpbGQgPSBwYXJlbnRFbGVtZW50LmNoaWxkTm9kZXNbaV07IGkrKykgY2FjaGVkLm5vZGVzLnB1c2goY2hpbGQpCgkJCX0KCQkJCgkJCWZvciAodmFyIGkgPSAwLCBjYWNoZUNvdW50ID0gMDsgaSA8IGRhdGEubGVuZ3RoOyBpKyspIHsKCQkJCXZhciBpdGVtID0gYnVpbGQocGFyZW50RWxlbWVudCwgcGFyZW50VGFnLCBjYWNoZWQsIGluZGV4LCBkYXRhW2ldLCBjYWNoZWRbY2FjaGVDb3VudF0sIHNob3VsZFJlYXR0YWNoLCBpbmRleCArIHN1YkFycmF5Q291bnQgfHwgc3ViQXJyYXlDb3VudCwgZWRpdGFibGUsIG5hbWVzcGFjZSwgY29uZmlncykKCQkJCWlmIChpdGVtID09PSB1bmRlZmluZWQpIGNvbnRpbnVlCgkJCQlpZiAoIWl0ZW0ubm9kZXMuaW50YWN0KSBpbnRhY3QgPSBmYWxzZQoJCQkJc3ViQXJyYXlDb3VudCArPSBpdGVtIGluc3RhbmNlb2YgQXJyYXkgPyBpdGVtLmxlbmd0aCA6IDEKCQkJCWNhY2hlZFtjYWNoZUNvdW50KytdID0gaXRlbQoJCQl9CgkJCWlmICghaW50YWN0KSB7CgkJCQlmb3IgKHZhciBpID0gMDsgaSA8IGRhdGEubGVuZ3RoOyBpKyspIHsKCQkJCQlpZiAoY2FjaGVkW2ldICE9PSB1bmRlZmluZWQpIG5vZGVzID0gbm9kZXMuY29uY2F0KGNhY2hlZFtpXS5ub2RlcykKCQkJCX0KCQkJCWZvciAodmFyIGkgPSBub2Rlcy5sZW5ndGgsIG5vZGU7IG5vZGUgPSBjYWNoZWQubm9kZXNbaV07IGkrKykgewoJCQkJCWlmIChub2RlLnBhcmVudE5vZGUgIT09IG51bGwgJiYgbm9kZS5wYXJlbnROb2RlLmNoaWxkTm9kZXMubGVuZ3RoICE9IG5vZGVzLmxlbmd0aCkgewoJCQkJCQlub2RlLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQobm9kZSkKCQkJCQkJaWYgKGNhY2hlZFtpXSkgdW5sb2FkKGNhY2hlZFtpXSkKCQkJCQl9CgkJCQl9CgkJCQlmb3IgKHZhciBpID0gY2FjaGVkLm5vZGVzLmxlbmd0aCwgbm9kZTsgbm9kZSA9IG5vZGVzW2ldOyBpKyspIHsKCQkJCQlpZiAobm9kZS5wYXJlbnROb2RlID09PSBudWxsKSBwYXJlbnRFbGVtZW50LmFwcGVuZENoaWxkKG5vZGUpCgkJCQl9CgkJCQlpZiAoZGF0YS5sZW5ndGggPCBjYWNoZWQubGVuZ3RoKSBjYWNoZWQubGVuZ3RoID0gZGF0YS5sZW5ndGgKCQkJCWNhY2hlZC5ub2RlcyA9IG5vZGVzCgkJCX0KCQkJCgkJfQoJCWVsc2UgaWYgKGRhdGFUeXBlID09ICJbb2JqZWN0IE9iamVjdF0iKSB7CgkJCWlmIChkYXRhLnRhZyAhPSBjYWNoZWQudGFnIHx8IE9iamVjdC5rZXlzKGRhdGEuYXR0cnMpLmpvaW4oKSAhPSBPYmplY3Qua2V5cyhjYWNoZWQuYXR0cnMpLmpvaW4oKSB8fCBkYXRhLmF0dHJzLmlkICE9IGNhY2hlZC5hdHRycy5pZCkgY2xlYXIoY2FjaGVkLm5vZGVzLCBjYWNoZWQpCgkJCWlmICh0eXBlb2YgZGF0YS50YWcgIT0gInN0cmluZyIpIHJldHVybgoKCQkJdmFyIG5vZGUsIGlzTmV3ID0gY2FjaGVkLm5vZGVzLmxlbmd0aCA9PT0gMAoJCQlpZiAoZGF0YS5hdHRycy54bWxucykgbmFtZXNwYWNlID0gZGF0YS5hdHRycy54bWxucwoJCQllbHNlIGlmIChkYXRhLnRhZyA9PT0gInN2ZyIpIG5hbWVzcGFjZSA9ICJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKCQkJaWYgKGlzTmV3KSB7CgkJCQlub2RlID0gbmFtZXNwYWNlID09PSB1bmRlZmluZWQgPyB3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRWxlbWVudChkYXRhLnRhZykgOiB3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKG5hbWVzcGFjZSwgZGF0YS50YWcpCgkJCQljYWNoZWQgPSB7CgkJCQkJdGFnOiBkYXRhLnRhZywKCQkJCQkvL3Byb2Nlc3MgY2hpbGRyZW4gYmVmb3JlIGF0dHJzIHNvIHRoYXQgc2VsZWN0LnZhbHVlIHdvcmtzIGNvcnJlY3RseQoJCQkJCWNoaWxkcmVuOiBkYXRhLmNoaWxkcmVuICE9PSB1bmRlZmluZWQgPyBidWlsZChub2RlLCBkYXRhLnRhZywgdW5kZWZpbmVkLCB1bmRlZmluZWQsIGRhdGEuY2hpbGRyZW4sIGNhY2hlZC5jaGlsZHJlbiwgdHJ1ZSwgMCwgZGF0YS5hdHRycy5jb250ZW50ZWRpdGFibGUgPyBub2RlIDogZWRpdGFibGUsIG5hbWVzcGFjZSwgY29uZmlncykgOiB1bmRlZmluZWQsCgkJCQkJYXR0cnM6IHNldEF0dHJpYnV0ZXMobm9kZSwgZGF0YS50YWcsIGRhdGEuYXR0cnMsIHt9LCBuYW1lc3BhY2UpLAoJCQkJCW5vZGVzOiBbbm9kZV0KCQkJCX0KCQkJCXBhcmVudEVsZW1lbnQuaW5zZXJ0QmVmb3JlKG5vZGUsIHBhcmVudEVsZW1lbnQuY2hpbGROb2Rlc1tpbmRleF0gfHwgbnVsbCkKCQkJfQoJCQllbHNlIHsKCQkJCW5vZGUgPSBjYWNoZWQubm9kZXNbMF0KCQkJCXNldEF0dHJpYnV0ZXMobm9kZSwgZGF0YS50YWcsIGRhdGEuYXR0cnMsIGNhY2hlZC5hdHRycywgbmFtZXNwYWNlKQoJCQkJY2FjaGVkLmNoaWxkcmVuID0gYnVpbGQobm9kZSwgZGF0YS50YWcsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCBkYXRhLmNoaWxkcmVuLCBjYWNoZWQuY2hpbGRyZW4sIGZhbHNlLCAwLCBkYXRhLmF0dHJzLmNvbnRlbnRlZGl0YWJsZSA/IG5vZGUgOiBlZGl0YWJsZSwgbmFtZXNwYWNlLCBjb25maWdzKQoJCQkJY2FjaGVkLm5vZGVzLmludGFjdCA9IHRydWUKCQkJCWlmIChzaG91bGRSZWF0dGFjaCA9PT0gdHJ1ZSkgcGFyZW50RWxlbWVudC5pbnNlcnRCZWZvcmUobm9kZSwgcGFyZW50RWxlbWVudC5jaGlsZE5vZGVzW2luZGV4XSB8fCBudWxsKQoJCQl9CgkJCWlmICh0eXBlLmNhbGwoZGF0YS5hdHRyc1siY29uZmlnIl0pID09ICJbb2JqZWN0IEZ1bmN0aW9uXSIpIHsKCQkJCWNvbmZpZ3MucHVzaChkYXRhLmF0dHJzWyJjb25maWciXS5iaW5kKHdpbmRvdywgbm9kZSwgIWlzTmV3LCBjYWNoZWQuY29uZmlnQ29udGV4dCA9IGNhY2hlZC5jb25maWdDb250ZXh0IHx8IHt9LCBjYWNoZWQpKQoJCQl9CgkJfQoJCWVsc2UgewoJCQl2YXIgbm9kZXMKCQkJaWYgKGNhY2hlZC5ub2Rlcy5sZW5ndGggPT09IDApIHsKCQkJCWlmIChkYXRhLiR0cnVzdGVkKSB7CgkJCQkJbm9kZXMgPSBpbmplY3RIVE1MKHBhcmVudEVsZW1lbnQsIGluZGV4LCBkYXRhKQoJCQkJfQoJCQkJZWxzZSB7CgkJCQkJbm9kZXMgPSBbd2luZG93LmRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGRhdGEpXQoJCQkJCXBhcmVudEVsZW1lbnQuaW5zZXJ0QmVmb3JlKG5vZGVzWzBdLCBwYXJlbnRFbGVtZW50LmNoaWxkTm9kZXNbaW5kZXhdIHx8IG51bGwpCgkJCQl9CgkJCQljYWNoZWQgPSAic3RyaW5nIG51bWJlciBib29sZWFuIi5pbmRleE9mKHR5cGVvZiBkYXRhKSA+IC0xID8gbmV3IGRhdGEuY29uc3RydWN0b3IoZGF0YSkgOiBkYXRhCgkJCQljYWNoZWQubm9kZXMgPSBub2RlcwoJCQl9CgkJCWVsc2UgaWYgKGNhY2hlZC52YWx1ZU9mKCkgIT09IGRhdGEudmFsdWVPZigpIHx8IHNob3VsZFJlYXR0YWNoID09PSB0cnVlKSB7CgkJCQlub2RlcyA9IGNhY2hlZC5ub2RlcwoJCQkJaWYgKCFlZGl0YWJsZSB8fCBlZGl0YWJsZSAhPT0gd2luZG93LmRvY3VtZW50LmFjdGl2ZUVsZW1lbnQpIHsKCQkJCQlpZiAoZGF0YS4kdHJ1c3RlZCkgewoJCQkJCQljbGVhcihub2RlcywgY2FjaGVkKQoJCQkJCQlub2RlcyA9IGluamVjdEhUTUwocGFyZW50RWxlbWVudCwgaW5kZXgsIGRhdGEpCgkJCQkJfQoJCQkJCWVsc2UgewoJCQkJCQlpZiAocGFyZW50VGFnID09PSAidGV4dGFyZWEiKSBwYXJlbnRFbGVtZW50LnZhbHVlID0gZGF0YQoJCQkJCQllbHNlIGlmIChlZGl0YWJsZSkgZWRpdGFibGUuaW5uZXJIVE1MID0gZGF0YQoJCQkJCQllbHNlIHsKCQkJCQkJCWlmIChub2Rlc1swXS5ub2RlVHlwZSA9PSAxIHx8IG5vZGVzLmxlbmd0aCA+IDEpIHsgLy93YXMgYSB0cnVzdGVkIHN0cmluZwoJCQkJCQkJCWNsZWFyKGNhY2hlZC5ub2RlcywgY2FjaGVkKQoJCQkJCQkJCW5vZGVzID0gW3dpbmRvdy5kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShkYXRhKV0KCQkJCQkJCX0KCQkJCQkJCXBhcmVudEVsZW1lbnQuaW5zZXJ0QmVmb3JlKG5vZGVzWzBdLCBwYXJlbnRFbGVtZW50LmNoaWxkTm9kZXNbaW5kZXhdIHx8IG51bGwpCgkJCQkJCQlub2Rlc1swXS5ub2RlVmFsdWUgPSBkYXRhCgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCQljYWNoZWQgPSBuZXcgZGF0YS5jb25zdHJ1Y3RvcihkYXRhKQoJCQkJY2FjaGVkLm5vZGVzID0gbm9kZXMKCQkJfQoJCQllbHNlIGNhY2hlZC5ub2Rlcy5pbnRhY3QgPSB0cnVlCgkJfQoKCQlyZXR1cm4gY2FjaGVkCgl9CglmdW5jdGlvbiBzZXRBdHRyaWJ1dGVzKG5vZGUsIHRhZywgZGF0YUF0dHJzLCBjYWNoZWRBdHRycywgbmFtZXNwYWNlKSB7CgkJZm9yICh2YXIgYXR0ck5hbWUgaW4gZGF0YUF0dHJzKSB7CgkJCXZhciBkYXRhQXR0ciA9IGRhdGFBdHRyc1thdHRyTmFtZV0KCQkJdmFyIGNhY2hlZEF0dHIgPSBjYWNoZWRBdHRyc1thdHRyTmFtZV0KCQkJaWYgKCEoYXR0ck5hbWUgaW4gY2FjaGVkQXR0cnMpIHx8IChjYWNoZWRBdHRyICE9PSBkYXRhQXR0cikgfHwgbm9kZSA9PT0gd2luZG93LmRvY3VtZW50LmFjdGl2ZUVsZW1lbnQpIHsKCQkJCWNhY2hlZEF0dHJzW2F0dHJOYW1lXSA9IGRhdGFBdHRyCgkJCQlpZiAoYXR0ck5hbWUgPT09ICJjb25maWciKSBjb250aW51ZQoJCQkJZWxzZSBpZiAodHlwZW9mIGRhdGFBdHRyID09ICJmdW5jdGlvbiIgJiYgYXR0ck5hbWUuaW5kZXhPZigib24iKSA9PSAwKSB7CgkJCQkJbm9kZVthdHRyTmFtZV0gPSBhdXRvcmVkcmF3KGRhdGFBdHRyLCBub2RlKQoJCQkJfQoJCQkJZWxzZSBpZiAoYXR0ck5hbWUgPT09ICJzdHlsZSIgJiYgdHlwZW9mIGRhdGFBdHRyID09ICJvYmplY3QiKSB7CgkJCQkJZm9yICh2YXIgcnVsZSBpbiBkYXRhQXR0cikgewoJCQkJCQlpZiAoY2FjaGVkQXR0ciA9PT0gdW5kZWZpbmVkIHx8IGNhY2hlZEF0dHJbcnVsZV0gIT09IGRhdGFBdHRyW3J1bGVdKSBub2RlLnN0eWxlW3J1bGVdID0gZGF0YUF0dHJbcnVsZV0KCQkJCQl9CgkJCQkJZm9yICh2YXIgcnVsZSBpbiBjYWNoZWRBdHRyKSB7CgkJCQkJCWlmICghKHJ1bGUgaW4gZGF0YUF0dHIpKSBub2RlLnN0eWxlW3J1bGVdID0gIiIKCQkJCQl9CgkJCQl9CgkJCQllbHNlIGlmIChuYW1lc3BhY2UgIT09IHVuZGVmaW5lZCkgewoJCQkJCWlmIChhdHRyTmFtZSA9PT0gImhyZWYiKSBub2RlLnNldEF0dHJpYnV0ZU5TKCJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiwgImhyZWYiLCBkYXRhQXR0cikKCQkJCQllbHNlIGlmIChhdHRyTmFtZSA9PT0gImNsYXNzTmFtZSIpIG5vZGUuc2V0QXR0cmlidXRlKCJjbGFzcyIsIGRhdGFBdHRyKQoJCQkJCWVsc2Ugbm9kZS5zZXRBdHRyaWJ1dGUoYXR0ck5hbWUsIGRhdGFBdHRyKQoJCQkJfQoJCQkJZWxzZSBpZiAoYXR0ck5hbWUgPT09ICJ2YWx1ZSIgJiYgdGFnID09PSAiaW5wdXQiKSB7CgkJCQkJaWYgKG5vZGUudmFsdWUgIT09IGRhdGFBdHRyKSBub2RlLnZhbHVlID0gZGF0YUF0dHIKCQkJCX0KCQkJCWVsc2UgaWYgKGF0dHJOYW1lIGluIG5vZGUgJiYgIShhdHRyTmFtZSA9PSAibGlzdCIgfHwgYXR0ck5hbWUgPT0gInN0eWxlIikpIHsKCQkJCQlub2RlW2F0dHJOYW1lXSA9IGRhdGFBdHRyCgkJCQl9CgkJCQllbHNlIG5vZGUuc2V0QXR0cmlidXRlKGF0dHJOYW1lLCBkYXRhQXR0cikKCQkJfQoJCX0KCQlyZXR1cm4gY2FjaGVkQXR0cnMKCX0KCWZ1bmN0aW9uIGNsZWFyKG5vZGVzLCBjYWNoZWQpIHsKCQlmb3IgKHZhciBpID0gbm9kZXMubGVuZ3RoIC0gMTsgaSA+IC0xOyBpLS0pIHsKCQkJaWYgKG5vZGVzW2ldICYmIG5vZGVzW2ldLnBhcmVudE5vZGUpIHsKCQkJCW5vZGVzW2ldLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQobm9kZXNbaV0pCgkJCQljYWNoZWQgPSBbXS5jb25jYXQoY2FjaGVkKQoJCQkJaWYgKGNhY2hlZFtpXSkgdW5sb2FkKGNhY2hlZFtpXSkKCQkJfQoJCX0KCQlub2Rlcy5sZW5ndGggPSAwCgl9CglmdW5jdGlvbiB1bmxvYWQoY2FjaGVkKSB7CgkJaWYgKGNhY2hlZC5jb25maWdDb250ZXh0ICYmIHR5cGVvZiBjYWNoZWQuY29uZmlnQ29udGV4dC5vbnVubG9hZCA9PSAiZnVuY3Rpb24iKSBjYWNoZWQuY29uZmlnQ29udGV4dC5vbnVubG9hZCgpCgkJaWYgKGNhY2hlZC5jaGlsZHJlbiBpbnN0YW5jZW9mIEFycmF5KSBmb3IgKHZhciBpID0gMDsgaSA8IGNhY2hlZC5jaGlsZHJlbi5sZW5ndGg7IGkrKykgdW5sb2FkKGNhY2hlZC5jaGlsZHJlbltpXSkKCX0KCWZ1bmN0aW9uIGluamVjdEhUTUwocGFyZW50RWxlbWVudCwgaW5kZXgsIGRhdGEpIHsKCQl2YXIgbmV4dFNpYmxpbmcgPSBwYXJlbnRFbGVtZW50LmNoaWxkTm9kZXNbaW5kZXhdCgkJaWYgKG5leHRTaWJsaW5nKSB7CgkJCXZhciBpc0VsZW1lbnQgPSBuZXh0U2libGluZy5ub2RlVHlwZSAhPSAxCgkJCXZhciBwbGFjZWhvbGRlciA9IHdpbmRvdy5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzcGFuIikKCQkJaWYgKGlzRWxlbWVudCkgewoJCQkJcGFyZW50RWxlbWVudC5pbnNlcnRCZWZvcmUocGxhY2Vob2xkZXIsIG5leHRTaWJsaW5nKQoJCQkJcGxhY2Vob2xkZXIuaW5zZXJ0QWRqYWNlbnRIVE1MKCJiZWZvcmViZWdpbiIsIGRhdGEpCgkJCQlwYXJlbnRFbGVtZW50LnJlbW92ZUNoaWxkKHBsYWNlaG9sZGVyKQoJCQl9CgkJCWVsc2UgbmV4dFNpYmxpbmcuaW5zZXJ0QWRqYWNlbnRIVE1MKCJiZWZvcmViZWdpbiIsIGRhdGEpCgkJfQoJCWVsc2UgcGFyZW50RWxlbWVudC5pbnNlcnRBZGphY2VudEhUTUwoImJlZm9yZWVuZCIsIGRhdGEpCgkJdmFyIG5vZGVzID0gW10KCQl3aGlsZSAocGFyZW50RWxlbWVudC5jaGlsZE5vZGVzW2luZGV4XSAhPT0gbmV4dFNpYmxpbmcpIHsKCQkJbm9kZXMucHVzaChwYXJlbnRFbGVtZW50LmNoaWxkTm9kZXNbaW5kZXhdKQoJCQlpbmRleCsrCgkJfQoJCXJldHVybiBub2RlcwoJfQoJZnVuY3Rpb24gY2xvbmUob2JqZWN0KSB7CgkJdmFyIHJlc3VsdCA9IHt9CgkJZm9yICh2YXIgcHJvcCBpbiBvYmplY3QpIHJlc3VsdFtwcm9wXSA9IG9iamVjdFtwcm9wXQoJCXJldHVybiByZXN1bHQKCX0KCWZ1bmN0aW9uIGF1dG9yZWRyYXcoY2FsbGJhY2ssIG9iamVjdCkgewoJCXJldHVybiBmdW5jdGlvbihlKSB7CgkJCWUgPSBlIHx8IGV2ZW50CgkJCW0uc3RhcnRDb21wdXRhdGlvbigpCgkJCXRyeSB7cmV0dXJuIGNhbGxiYWNrLmNhbGwob2JqZWN0LCBlKX0KCQkJZmluYWxseSB7bS5lbmRDb21wdXRhdGlvbigpfQoJCX0KCX0KCgl2YXIgaHRtbAoJdmFyIGRvY3VtZW50Tm9kZSA9IHsKCQlpbnNlcnRBZGphY2VudEhUTUw6IGZ1bmN0aW9uKF8sIGRhdGEpIHsKCQkJd2luZG93LmRvY3VtZW50LndyaXRlKGRhdGEpCgkJCXdpbmRvdy5kb2N1bWVudC5jbG9zZSgpCgkJfSwKCQlhcHBlbmRDaGlsZDogZnVuY3Rpb24obm9kZSkgewoJCQlpZiAoaHRtbCA9PT0gdW5kZWZpbmVkKSBodG1sID0gd2luZG93LmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImh0bWwiKQoJCQlpZiAobm9kZS5ub2RlTmFtZSA9PSAiSFRNTCIpIGh0bWwgPSBub2RlCgkJCWVsc2UgaHRtbC5hcHBlbmRDaGlsZChub2RlKQoJCQlpZiAod2luZG93LmRvY3VtZW50LmRvY3VtZW50RWxlbWVudCAhPT0gaHRtbCkgewoJCQkJd2luZG93LmRvY3VtZW50LnJlcGxhY2VDaGlsZChodG1sLCB3aW5kb3cuZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KQoJCQl9CgkJfSwKCQlpbnNlcnRCZWZvcmU6IGZ1bmN0aW9uKG5vZGUpIHsKCQkJdGhpcy5hcHBlbmRDaGlsZChub2RlKQoJCX0sCgkJY2hpbGROb2RlczogW10KCX0KCXZhciBub2RlQ2FjaGUgPSBbXSwgY2VsbENhY2hlID0ge30KCW0ucmVuZGVyID0gZnVuY3Rpb24ocm9vdCwgY2VsbCkgewoJCXZhciBjb25maWdzID0gW10KCQlpZiAoIXJvb3QpIHRocm93IG5ldyBFcnJvcigiUGxlYXNlIGVuc3VyZSB0aGUgRE9NIGVsZW1lbnQgZXhpc3RzIGJlZm9yZSByZW5kZXJpbmcgYSB0ZW1wbGF0ZSBpbnRvIGl0LiIpCgkJdmFyIGlkID0gZ2V0Q2VsbENhY2hlSWQocm9vdCkKCQl2YXIgbm9kZSA9IHJvb3QgPT0gd2luZG93LmRvY3VtZW50IHx8IHJvb3QgPT0gd2luZG93LmRvY3VtZW50LmRvY3VtZW50RWxlbWVudCA/IGRvY3VtZW50Tm9kZSA6IHJvb3QKCQlpZiAoY2VsbENhY2hlW2lkXSA9PT0gdW5kZWZpbmVkKSBjbGVhcihub2RlLmNoaWxkTm9kZXMpCgkJY2VsbENhY2hlW2lkXSA9IGJ1aWxkKG5vZGUsIG51bGwsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCBjZWxsLCBjZWxsQ2FjaGVbaWRdLCBmYWxzZSwgMCwgbnVsbCwgdW5kZWZpbmVkLCBjb25maWdzKQoJCWZvciAodmFyIGkgPSAwOyBpIDwgY29uZmlncy5sZW5ndGg7IGkrKykgY29uZmlnc1tpXSgpCgl9CglmdW5jdGlvbiBnZXRDZWxsQ2FjaGVJZChlbGVtZW50KSB7CgkJdmFyIGluZGV4ID0gbm9kZUNhY2hlLmluZGV4T2YoZWxlbWVudCkKCQlyZXR1cm4gaW5kZXggPCAwID8gbm9kZUNhY2hlLnB1c2goZWxlbWVudCkgLSAxIDogaW5kZXgKCX0KCgltLnRydXN0ID0gZnVuY3Rpb24odmFsdWUpIHsKCQl2YWx1ZSA9IG5ldyBTdHJpbmcodmFsdWUpCgkJdmFsdWUuJHRydXN0ZWQgPSB0cnVlCgkJcmV0dXJuIHZhbHVlCgl9CgoJdmFyIHJvb3RzID0gW10sIG1vZHVsZXMgPSBbXSwgY29udHJvbGxlcnMgPSBbXSwgbm93ID0gMCwgbGFzdFJlZHJhdyA9IDAsIGxhc3RSZWRyYXdJZCA9IDAsIGNvbXB1dGVQb3N0UmVkcmF3SG9vayA9IG51bGwKCW0ubW9kdWxlID0gZnVuY3Rpb24ocm9vdCwgbW9kdWxlKSB7CgkJdmFyIGluZGV4ID0gcm9vdHMuaW5kZXhPZihyb290KQoJCWlmIChpbmRleCA8IDApIGluZGV4ID0gcm9vdHMubGVuZ3RoCgkJdmFyIGlzUHJldmVudGVkID0gZmFsc2UKCQlpZiAoY29udHJvbGxlcnNbaW5kZXhdICYmIHR5cGVvZiBjb250cm9sbGVyc1tpbmRleF0ub251bmxvYWQgPT0gImZ1bmN0aW9uIikgewoJCQl2YXIgZXZlbnQgPSB7CgkJCQlwcmV2ZW50RGVmYXVsdDogZnVuY3Rpb24oKSB7aXNQcmV2ZW50ZWQgPSB0cnVlfQoJCQl9CgkJCWNvbnRyb2xsZXJzW2luZGV4XS5vbnVubG9hZChldmVudCkKCQl9CgkJaWYgKCFpc1ByZXZlbnRlZCkgewoJCQltLnN0YXJ0Q29tcHV0YXRpb24oKQoJCQlyb290c1tpbmRleF0gPSByb290CgkJCW1vZHVsZXNbaW5kZXhdID0gbW9kdWxlCgkJCWNvbnRyb2xsZXJzW2luZGV4XSA9IG5ldyBtb2R1bGUuY29udHJvbGxlcgoJCQltLmVuZENvbXB1dGF0aW9uKCkKCQl9Cgl9CgltLnJlZHJhdyA9IGZ1bmN0aW9uKCkgewoJCW5vdyA9IHdpbmRvdy5wZXJmb3JtYW5jZSAmJiB3aW5kb3cucGVyZm9ybWFuY2Uubm93ID8gd2luZG93LnBlcmZvcm1hbmNlLm5vdygpIDogbmV3IHdpbmRvdy5EYXRlKCkuZ2V0VGltZSgpCgkJaWYgKG5vdyAtIGxhc3RSZWRyYXcgPiAxNikgcmVkcmF3KCkKCQllbHNlIHsKCQkJdmFyIGNhbmNlbCA9IHdpbmRvdy5jYW5jZWxBbmltYXRpb25GcmFtZSB8fCB3aW5kb3cuY2xlYXJUaW1lb3V0CgkJCXZhciBkZWZlciA9IHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHwgd2luZG93LnNldFRpbWVvdXQKCQkJY2FuY2VsKGxhc3RSZWRyYXdJZCkKCQkJbGFzdFJlZHJhd0lkID0gZGVmZXIocmVkcmF3LCAwKQoJCX0KCX0KCWZ1bmN0aW9uIHJlZHJhdygpIHsKCQlmb3IgKHZhciBpID0gMDsgaSA8IHJvb3RzLmxlbmd0aDsgaSsrKSB7CgkJCWlmIChjb250cm9sbGVyc1tpXSkgbS5yZW5kZXIocm9vdHNbaV0sIG1vZHVsZXNbaV0udmlldyhjb250cm9sbGVyc1tpXSkpCgkJfQoJCWlmIChjb21wdXRlUG9zdFJlZHJhd0hvb2spIHsKCQkJY29tcHV0ZVBvc3RSZWRyYXdIb29rKCkKCQkJY29tcHV0ZVBvc3RSZWRyYXdIb29rID0gbnVsbAoJCX0KCQlsYXN0UmVkcmF3ID0gbm93Cgl9CgoJdmFyIHBlbmRpbmdSZXF1ZXN0cyA9IDAKCW0uc3RhcnRDb21wdXRhdGlvbiA9IGZ1bmN0aW9uKCkge3BlbmRpbmdSZXF1ZXN0cysrfQoJbS5lbmRDb21wdXRhdGlvbiA9IGZ1bmN0aW9uKCkgewoJCXBlbmRpbmdSZXF1ZXN0cyA9IE1hdGgubWF4KHBlbmRpbmdSZXF1ZXN0cyAtIDEsIDApCgkJaWYgKHBlbmRpbmdSZXF1ZXN0cyA9PSAwKSBtLnJlZHJhdygpCgl9CgoJbS53aXRoQXR0ciA9IGZ1bmN0aW9uKHByb3AsIHdpdGhBdHRyQ2FsbGJhY2spIHsKCQlyZXR1cm4gZnVuY3Rpb24oZSkgewoJCQllID0gZSB8fCBldmVudAoJCQl3aXRoQXR0ckNhbGxiYWNrKHByb3AgaW4gZS5jdXJyZW50VGFyZ2V0ID8gZS5jdXJyZW50VGFyZ2V0W3Byb3BdIDogZS5jdXJyZW50VGFyZ2V0LmdldEF0dHJpYnV0ZShwcm9wKSkKCQl9Cgl9CgoJLy9yb3V0aW5nCgl2YXIgbW9kZXMgPSB7cGF0aG5hbWU6ICIiLCBoYXNoOiAiIyIsIHNlYXJjaDogIj8ifQoJdmFyIHJlZGlyZWN0ID0gZnVuY3Rpb24oKSB7fSwgcm91dGVQYXJhbXMgPSB7fSwgY3VycmVudFJvdXRlCgltLnJvdXRlID0gZnVuY3Rpb24oKSB7CgkJaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDApIHJldHVybiBjdXJyZW50Um91dGUKCQllbHNlIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAzICYmIHR5cGVvZiBhcmd1bWVudHNbMV0gPT0gInN0cmluZyIpIHsKCQkJdmFyIHJvb3QgPSBhcmd1bWVudHNbMF0sIGRlZmF1bHRSb3V0ZSA9IGFyZ3VtZW50c1sxXSwgcm91dGVyID0gYXJndW1lbnRzWzJdCgkJCXJlZGlyZWN0ID0gZnVuY3Rpb24oc291cmNlKSB7CgkJCQl2YXIgcGF0aCA9IGN1cnJlbnRSb3V0ZSA9IG5vcm1hbGl6ZVJvdXRlKHNvdXJjZSkKCQkJCWlmICghcm91dGVCeVZhbHVlKHJvb3QsIHJvdXRlciwgcGF0aCkpIHsKCQkJCQltLnJvdXRlKGRlZmF1bHRSb3V0ZSwgdHJ1ZSkKCQkJCX0KCQkJfQoJCQl2YXIgbGlzdGVuZXIgPSBtLnJvdXRlLm1vZGUgPT0gImhhc2giID8gIm9uaGFzaGNoYW5nZSIgOiAib25wb3BzdGF0ZSIKCQkJd2luZG93W2xpc3RlbmVyXSA9IGZ1bmN0aW9uKCkgewoJCQkJaWYgKGN1cnJlbnRSb3V0ZSAhPSBub3JtYWxpemVSb3V0ZSh3aW5kb3cubG9jYXRpb25bbS5yb3V0ZS5tb2RlXSkpIHsKCQkJCQlyZWRpcmVjdCh3aW5kb3cubG9jYXRpb25bbS5yb3V0ZS5tb2RlXSkKCQkJCX0KCQkJfQoJCQljb21wdXRlUG9zdFJlZHJhd0hvb2sgPSBzZXRTY3JvbGwKCQkJd2luZG93W2xpc3RlbmVyXSgpCgkJCWN1cnJlbnRSb3V0ZSA9IG5vcm1hbGl6ZVJvdXRlKHdpbmRvdy5sb2NhdGlvblttLnJvdXRlLm1vZGVdKQoJCX0KCQllbHNlIGlmIChhcmd1bWVudHNbMF0uYWRkRXZlbnRMaXN0ZW5lcikgewoJCQl2YXIgZWxlbWVudCA9IGFyZ3VtZW50c1swXQoJCQl2YXIgaXNJbml0aWFsaXplZCA9IGFyZ3VtZW50c1sxXQoJCQlpZiAoZWxlbWVudC5ocmVmLmluZGV4T2YobW9kZXNbbS5yb3V0ZS5tb2RlXSkgPCAwKSB7CgkJCQllbGVtZW50LmhyZWYgPSB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUgKyBtb2Rlc1ttLnJvdXRlLm1vZGVdICsgZWxlbWVudC5wYXRobmFtZQoJCQl9CgkJCWlmICghaXNJbml0aWFsaXplZCkgewoJCQkJZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCJjbGljayIsIHJvdXRlVW5vYnRydXNpdmUpCgkJCQllbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgcm91dGVVbm9idHJ1c2l2ZSkKCQkJfQoJCX0KCQllbHNlIGlmICh0eXBlb2YgYXJndW1lbnRzWzBdID09ICJzdHJpbmciKSB7CgkJCWN1cnJlbnRSb3V0ZSA9IGFyZ3VtZW50c1swXQoJCQl2YXIgcXVlcnlzdHJpbmcgPSB0eXBlb2YgYXJndW1lbnRzWzFdID09ICJvYmplY3QiID8gYnVpbGRRdWVyeVN0cmluZyhhcmd1bWVudHNbMV0pIDogbnVsbAoJCQlpZiAocXVlcnlzdHJpbmcpIGN1cnJlbnRSb3V0ZSArPSAoY3VycmVudFJvdXRlLmluZGV4T2YoIj8iKSA9PT0gLTEgPyAiPyIgOiAiJiIpICsgcXVlcnlzdHJpbmcKCgkJCXZhciBzaG91bGRSZXBsYWNlSGlzdG9yeUVudHJ5ID0gKGFyZ3VtZW50cy5sZW5ndGggPT0gMyA/IGFyZ3VtZW50c1syXSA6IGFyZ3VtZW50c1sxXSkgPT09IHRydWUKCgkJCWlmICh3aW5kb3cuaGlzdG9yeS5wdXNoU3RhdGUpIHsKCQkJCWNvbXB1dGVQb3N0UmVkcmF3SG9vayA9IGZ1bmN0aW9uKCkgewoJCQkJCXdpbmRvdy5oaXN0b3J5W3Nob3VsZFJlcGxhY2VIaXN0b3J5RW50cnkgPyAicmVwbGFjZVN0YXRlIiA6ICJwdXNoU3RhdGUiXShudWxsLCB3aW5kb3cuZG9jdW1lbnQudGl0bGUsIG1vZGVzW20ucm91dGUubW9kZV0gKyBjdXJyZW50Um91dGUpCgkJCQkJc2V0U2Nyb2xsKCkKCQkJCX0KCQkJCXJlZGlyZWN0KG1vZGVzW20ucm91dGUubW9kZV0gKyBjdXJyZW50Um91dGUpCgkJCX0KCQkJZWxzZSB3aW5kb3cubG9jYXRpb25bbS5yb3V0ZS5tb2RlXSA9IGN1cnJlbnRSb3V0ZQoJCX0KCX0KCW0ucm91dGUucGFyYW0gPSBmdW5jdGlvbihrZXkpIHtyZXR1cm4gcm91dGVQYXJhbXNba2V5XX0KCW0ucm91dGUubW9kZSA9ICJzZWFyY2giCglmdW5jdGlvbiBub3JtYWxpemVSb3V0ZShyb3V0ZSkge3JldHVybiByb3V0ZS5zbGljZShtb2Rlc1ttLnJvdXRlLm1vZGVdLmxlbmd0aCl9CglmdW5jdGlvbiByb3V0ZUJ5VmFsdWUocm9vdCwgcm91dGVyLCBwYXRoKSB7CgkJcm91dGVQYXJhbXMgPSB7fQoKCQl2YXIgcXVlcnlTdGFydCA9IHBhdGguaW5kZXhPZigiPyIpCgkJaWYgKHF1ZXJ5U3RhcnQgIT09IC0xKSB7CgkJCXJvdXRlUGFyYW1zID0gcGFyc2VRdWVyeVN0cmluZyhwYXRoLnN1YnN0cihxdWVyeVN0YXJ0ICsgMSwgcGF0aC5sZW5ndGgpKQoJCQlwYXRoID0gcGF0aC5zdWJzdHIoMCwgcXVlcnlTdGFydCkKCQl9CgoJCWZvciAodmFyIHJvdXRlIGluIHJvdXRlcikgewoJCQlpZiAocm91dGUgPT0gcGF0aCkgewoJCQkJY2xlYXIocm9vdC5jaGlsZE5vZGVzLCBjZWxsQ2FjaGVbZ2V0Q2VsbENhY2hlSWQocm9vdCldKQoJCQkJbS5tb2R1bGUocm9vdCwgcm91dGVyW3JvdXRlXSkKCQkJCXJldHVybiB0cnVlCgkJCX0KCgkJCXZhciBtYXRjaGVyID0gbmV3IFJlZ0V4cCgiXiIgKyByb3V0ZS5yZXBsYWNlKC86W15cL10rP1wuezN9L2csICIoLio/KSIpLnJlcGxhY2UoLzpbXlwvXSsvZywgIihbXlxcL10rKSIpICsgIlwvPyQiKQoKCQkJaWYgKG1hdGNoZXIudGVzdChwYXRoKSkgewoJCQkJY2xlYXIocm9vdC5jaGlsZE5vZGVzLCBjZWxsQ2FjaGVbZ2V0Q2VsbENhY2hlSWQocm9vdCldKQoJCQkJcGF0aC5yZXBsYWNlKG1hdGNoZXIsIGZ1bmN0aW9uKCkgewoJCQkJCXZhciBrZXlzID0gcm91dGUubWF0Y2goLzpbXlwvXSsvZykgfHwgW10KCQkJCQl2YXIgdmFsdWVzID0gW10uc2xpY2UuY2FsbChhcmd1bWVudHMsIDEsIC0yKQoJCQkJCWZvciAodmFyIGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykgcm91dGVQYXJhbXNba2V5c1tpXS5yZXBsYWNlKC86fFwuL2csICIiKV0gPSBkZWNvZGVTcGFjZSh2YWx1ZXNbaV0pCgkJCQkJbS5tb2R1bGUocm9vdCwgcm91dGVyW3JvdXRlXSkKCQkJCX0pCgkJCQlyZXR1cm4gdHJ1ZQoJCQl9CgkJfQoJfQoJZnVuY3Rpb24gcm91dGVVbm9idHJ1c2l2ZShlKSB7CgkJZSA9IGUgfHwgZXZlbnQKCQlpZiAoZS5jdHJsS2V5IHx8IGUubWV0YUtleSB8fCBlLndoaWNoID09IDIpIHJldHVybgoJCWUucHJldmVudERlZmF1bHQoKQoJCW0ucm91dGUoZS5jdXJyZW50VGFyZ2V0W20ucm91dGUubW9kZV0uc2xpY2UobW9kZXNbbS5yb3V0ZS5tb2RlXS5sZW5ndGgpKQoJfQoJZnVuY3Rpb24gc2V0U2Nyb2xsKCkgewoJCWlmIChtLnJvdXRlLm1vZGUgIT0gImhhc2giICYmIHdpbmRvdy5sb2NhdGlvbi5oYXNoKSB3aW5kb3cubG9jYXRpb24uaGFzaCA9IHdpbmRvdy5sb2NhdGlvbi5oYXNoCgkJZWxzZSB3aW5kb3cuc2Nyb2xsVG8oMCwgMCkKCX0KCWZ1bmN0aW9uIGJ1aWxkUXVlcnlTdHJpbmcob2JqZWN0LCBwcmVmaXgpIHsKCQl2YXIgc3RyID0gW10KCQlmb3IodmFyIHByb3AgaW4gb2JqZWN0KSB7CgkJCXZhciBrZXkgPSBwcmVmaXggPyBwcmVmaXggKyAiWyIgKyBwcm9wICsgIl0iIDogcHJvcCwgdmFsdWUgPSBvYmplY3RbcHJvcF0KCQkJc3RyLnB1c2godHlwZW9mIHZhbHVlID09ICJvYmplY3QiID8gYnVpbGRRdWVyeVN0cmluZyh2YWx1ZSwga2V5KSA6IGVuY29kZVVSSUNvbXBvbmVudChrZXkpICsgIj0iICsgZW5jb2RlVVJJQ29tcG9uZW50KHZhbHVlKSkKCQl9CgkJcmV0dXJuIHN0ci5qb2luKCImIikKCX0KCWZ1bmN0aW9uIHBhcnNlUXVlcnlTdHJpbmcoc3RyKSB7CgkJdmFyIHBhaXJzID0gc3RyLnNwbGl0KCImIiksIHBhcmFtcyA9IHt9CgkJZm9yICh2YXIgaSA9IDA7IGkgPCBwYWlycy5sZW5ndGg7IGkrKykgewoJCQl2YXIgcGFpciA9IHBhaXJzW2ldLnNwbGl0KCI9IikKCQkJcGFyYW1zW2RlY29kZVNwYWNlKHBhaXJbMF0pXSA9IHBhaXJbMV0gPyBkZWNvZGVTcGFjZShwYWlyWzFdKSA6IChwYWlyLmxlbmd0aCA9PT0gMSA/IHRydWUgOiAiIikKCQl9CgkJcmV0dXJuIHBhcmFtcwoJfQoJZnVuY3Rpb24gZGVjb2RlU3BhY2Uoc3RyaW5nKSB7CgkJcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChzdHJpbmcucmVwbGFjZSgvXCsvZywgIiAiKSkKCX0KCgkvL21vZGVsCgltLnByb3AgPSBmdW5jdGlvbihzdG9yZSkgewoJCXZhciBwcm9wID0gZnVuY3Rpb24oKSB7CgkJCWlmIChhcmd1bWVudHMubGVuZ3RoKSBzdG9yZSA9IGFyZ3VtZW50c1swXQoJCQlyZXR1cm4gc3RvcmUKCQl9CgkJcHJvcC50b0pTT04gPSBmdW5jdGlvbigpIHsKCQkJcmV0dXJuIHN0b3JlCgkJfQoJCXJldHVybiBwcm9wCgl9CgoJdmFyIG5vbmUgPSB7fQoJbS5kZWZlcnJlZCA9IGZ1bmN0aW9uKCkgewoJCXZhciByZXNvbHZlcnMgPSBbXSwgcmVqZWN0ZXJzID0gW10sIHJlc29sdmVkID0gbm9uZSwgcmVqZWN0ZWQgPSBub25lLCBwcm9taXNlID0gbS5wcm9wKCkKCQl2YXIgb2JqZWN0ID0gewoJCQlyZXNvbHZlOiBmdW5jdGlvbih2YWx1ZSkgewoJCQkJaWYgKHJlc29sdmVkID09PSBub25lKSBwcm9taXNlKHJlc29sdmVkID0gdmFsdWUpCgkJCQlmb3IgKHZhciBpID0gMDsgaSA8IHJlc29sdmVycy5sZW5ndGg7IGkrKykgcmVzb2x2ZXJzW2ldKHZhbHVlKQoJCQkJcmVzb2x2ZXJzLmxlbmd0aCA9IHJlamVjdGVycy5sZW5ndGggPSAwCgkJCX0sCgkJCXJlamVjdDogZnVuY3Rpb24odmFsdWUpIHsKCQkJCWlmIChyZWplY3RlZCA9PT0gbm9uZSkgcmVqZWN0ZWQgPSB2YWx1ZQoJCQkJZm9yICh2YXIgaSA9IDA7IGkgPCByZWplY3RlcnMubGVuZ3RoOyBpKyspIHJlamVjdGVyc1tpXSh2YWx1ZSkKCQkJCXJlc29sdmVycy5sZW5ndGggPSByZWplY3RlcnMubGVuZ3RoID0gMAoJCQl9LAoJCQlwcm9taXNlOiBwcm9taXNlCgkJfQoJCW9iamVjdC5wcm9taXNlLnJlc29sdmVycyA9IHJlc29sdmVycwoJCW9iamVjdC5wcm9taXNlLnRoZW4gPSBmdW5jdGlvbihzdWNjZXNzLCBlcnJvcikgewoJCQl2YXIgbmV4dCA9IG0uZGVmZXJyZWQoKQoJCQlpZiAoIXN1Y2Nlc3MpIHN1Y2Nlc3MgPSBpZGVudGl0eQoJCQlpZiAoIWVycm9yKSBlcnJvciA9IGlkZW50aXR5CgkJCWZ1bmN0aW9uIGNhbGxiYWNrKG1ldGhvZCwgY2FsbGJhY2spIHsKCQkJCXJldHVybiBmdW5jdGlvbih2YWx1ZSkgewoJCQkJCXRyeSB7CgkJCQkJCXZhciByZXN1bHQgPSBjYWxsYmFjayh2YWx1ZSkKCQkJCQkJaWYgKHJlc3VsdCAmJiB0eXBlb2YgcmVzdWx0LnRoZW4gPT0gImZ1bmN0aW9uIikgcmVzdWx0LnRoZW4obmV4dFttZXRob2RdLCBlcnJvcikKCQkJCQkJZWxzZSBuZXh0W21ldGhvZF0ocmVzdWx0ICE9PSB1bmRlZmluZWQgPyByZXN1bHQgOiB2YWx1ZSkKCQkJCQl9CgkJCQkJY2F0Y2ggKGUpIHsKCQkJCQkJaWYgKGUgaW5zdGFuY2VvZiBFcnJvciAmJiBlLmNvbnN0cnVjdG9yICE9PSBFcnJvcikgdGhyb3cgZQoJCQkJCQllbHNlIG5leHQucmVqZWN0KGUpCgkJCQkJfQoJCQkJfQoJCQl9CgkJCWlmIChyZXNvbHZlZCAhPT0gbm9uZSkgY2FsbGJhY2soInJlc29sdmUiLCBzdWNjZXNzKShyZXNvbHZlZCkKCQkJZWxzZSBpZiAocmVqZWN0ZWQgIT09IG5vbmUpIGNhbGxiYWNrKCJyZWplY3QiLCBlcnJvcikocmVqZWN0ZWQpCgkJCWVsc2UgewoJCQkJcmVzb2x2ZXJzLnB1c2goY2FsbGJhY2soInJlc29sdmUiLCBzdWNjZXNzKSkKCQkJCXJlamVjdGVycy5wdXNoKGNhbGxiYWNrKCJyZWplY3QiLCBlcnJvcikpCgkJCX0KCQkJcmV0dXJuIG5leHQucHJvbWlzZQoJCX0KCQlyZXR1cm4gb2JqZWN0Cgl9CgltLnN5bmMgPSBmdW5jdGlvbihhcmdzKSB7CgkJdmFyIG1ldGhvZCA9ICJyZXNvbHZlIgoJCWZ1bmN0aW9uIHN5bmNocm9uaXplcihwb3MsIHJlc29sdmVkKSB7CgkJCXJldHVybiBmdW5jdGlvbih2YWx1ZSkgewoJCQkJcmVzdWx0c1twb3NdID0gdmFsdWUKCQkJCWlmICghcmVzb2x2ZWQpIG1ldGhvZCA9ICJyZWplY3QiCgkJCQlpZiAoLS1vdXRzdGFuZGluZyA9PSAwKSB7CgkJCQkJZGVmZXJyZWQucHJvbWlzZShyZXN1bHRzKQoJCQkJCWRlZmVycmVkW21ldGhvZF0ocmVzdWx0cykKCQkJCX0KCQkJCXJldHVybiB2YWx1ZQoJCQl9CgkJfQoKCQl2YXIgZGVmZXJyZWQgPSBtLmRlZmVycmVkKCkKCQl2YXIgb3V0c3RhbmRpbmcgPSBhcmdzLmxlbmd0aAoJCXZhciByZXN1bHRzID0gbmV3IEFycmF5KG91dHN0YW5kaW5nKQoJCWZvciAodmFyIGkgPSAwOyBpIDwgYXJncy5sZW5ndGg7IGkrKykgewoJCQlhcmdzW2ldLnRoZW4oc3luY2hyb25pemVyKGksIHRydWUpLCBzeW5jaHJvbml6ZXIoaSwgZmFsc2UpKQoJCX0KCQlyZXR1cm4gZGVmZXJyZWQucHJvbWlzZQoJfQoJZnVuY3Rpb24gaWRlbnRpdHkodmFsdWUpIHtyZXR1cm4gdmFsdWV9CgoJZnVuY3Rpb24gYWpheChvcHRpb25zKSB7CgkJdmFyIHhociA9IG5ldyB3aW5kb3cuWE1MSHR0cFJlcXVlc3QKCQl4aHIub3BlbihvcHRpb25zLm1ldGhvZCwgb3B0aW9ucy51cmwsIHRydWUsIG9wdGlvbnMudXNlciwgb3B0aW9ucy5wYXNzd29yZCkKCQl4aHIub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24oKSB7CgkJCWlmICh4aHIucmVhZHlTdGF0ZSA9PT0gNCkgewoJCQkJaWYgKHhoci5zdGF0dXMgPj0gMjAwICYmIHhoci5zdGF0dXMgPCAzMDApIG9wdGlvbnMub25sb2FkKHt0eXBlOiAibG9hZCIsIHRhcmdldDogeGhyfSkKCQkJCWVsc2Ugb3B0aW9ucy5vbmVycm9yKHt0eXBlOiAiZXJyb3IiLCB0YXJnZXQ6IHhocn0pCgkJCX0KCQl9CgkJaWYgKG9wdGlvbnMuc2VyaWFsaXplID09IEpTT04uc3RyaW5naWZ5ICYmIG9wdGlvbnMubWV0aG9kICE9ICJHRVQiKSB7CgkJCXhoci5zZXRSZXF1ZXN0SGVhZGVyKCJDb250ZW50LVR5cGUiLCAiYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD11dGYtOCIpOwoJCX0KCQlpZiAodHlwZW9mIG9wdGlvbnMuY29uZmlnID09ICJmdW5jdGlvbiIpIHsKCQkJdmFyIG1heWJlWGhyID0gb3B0aW9ucy5jb25maWcoeGhyLCBvcHRpb25zKQoJCQlpZiAobWF5YmVYaHIgIT09IHVuZGVmaW5lZCkgeGhyID0gbWF5YmVYaHIKCQl9CgkJeGhyLnNlbmQob3B0aW9ucy5kYXRhKQoJCXJldHVybiB4aHIKCX0KCWZ1bmN0aW9uIGJpbmREYXRhKHhock9wdGlvbnMsIGRhdGEsIHNlcmlhbGl6ZSkgewoJCWlmIChkYXRhICYmIE9iamVjdC5rZXlzKGRhdGEpLmxlbmd0aCA+IDApIHsKCQkJaWYgKHhock9wdGlvbnMubWV0aG9kID09ICJHRVQiKSB7CgkJCQl4aHJPcHRpb25zLnVybCA9IHhock9wdGlvbnMudXJsICsgKHhock9wdGlvbnMudXJsLmluZGV4T2YoIj8iKSA8IDAgPyAiPyIgOiAiJiIpICsgYnVpbGRRdWVyeVN0cmluZyhkYXRhKQoJCQl9CgkJCWVsc2UgeGhyT3B0aW9ucy5kYXRhID0gc2VyaWFsaXplKGRhdGEpCgkJfQoJCXJldHVybiB4aHJPcHRpb25zCgl9CglmdW5jdGlvbiBwYXJhbWV0ZXJpemVVcmwodXJsLCBkYXRhKSB7CgkJdmFyIHRva2VucyA9IHVybC5tYXRjaCgvOlthLXpdXHcrL2dpKQoJCWlmICh0b2tlbnMgJiYgZGF0YSkgewoJCQlmb3IgKHZhciBpID0gMDsgaSA8IHRva2Vucy5sZW5ndGg7IGkrKykgewoJCQkJdmFyIGtleSA9IHRva2Vuc1tpXS5zbGljZSgxKQoJCQkJdXJsID0gdXJsLnJlcGxhY2UodG9rZW5zW2ldLCBkYXRhW2tleV0pCgkJCQlkZWxldGUgZGF0YVtrZXldCgkJCX0KCQl9CgkJcmV0dXJuIHVybAoJfQoKCW0ucmVxdWVzdCA9IGZ1bmN0aW9uKHhock9wdGlvbnMpIHsKCQlpZiAoeGhyT3B0aW9ucy5iYWNrZ3JvdW5kICE9PSB0cnVlKSBtLnN0YXJ0Q29tcHV0YXRpb24oKQoJCXZhciBkZWZlcnJlZCA9IG0uZGVmZXJyZWQoKQoJCXZhciBzZXJpYWxpemUgPSB4aHJPcHRpb25zLnNlcmlhbGl6ZSA9IHhock9wdGlvbnMuc2VyaWFsaXplIHx8IEpTT04uc3RyaW5naWZ5CgkJdmFyIGRlc2VyaWFsaXplID0geGhyT3B0aW9ucy5kZXNlcmlhbGl6ZSA9IHhock9wdGlvbnMuZGVzZXJpYWxpemUgfHwgSlNPTi5wYXJzZQoJCXZhciBleHRyYWN0ID0geGhyT3B0aW9ucy5leHRyYWN0IHx8IGZ1bmN0aW9uKHhocikgewoJCQlyZXR1cm4geGhyLnJlc3BvbnNlVGV4dC5sZW5ndGggPT09IDAgJiYgZGVzZXJpYWxpemUgPT09IEpTT04ucGFyc2UgPyBudWxsIDogeGhyLnJlc3BvbnNlVGV4dAoJCX0KCQl4aHJPcHRpb25zLnVybCA9IHBhcmFtZXRlcml6ZVVybCh4aHJPcHRpb25zLnVybCwgeGhyT3B0aW9ucy5kYXRhKQoJCXhock9wdGlvbnMgPSBiaW5kRGF0YSh4aHJPcHRpb25zLCB4aHJPcHRpb25zLmRhdGEsIHNlcmlhbGl6ZSkKCQl4aHJPcHRpb25zLm9ubG9hZCA9IHhock9wdGlvbnMub25lcnJvciA9IGZ1bmN0aW9uKGUpIHsKCQkJdHJ5IHsKCQkJCWUgPSBlIHx8IGV2ZW50CgkJCQl2YXIgdW53cmFwID0gKGUudHlwZSA9PSAibG9hZCIgPyB4aHJPcHRpb25zLnVud3JhcFN1Y2Nlc3MgOiB4aHJPcHRpb25zLnVud3JhcEVycm9yKSB8fCBpZGVudGl0eQoJCQkJdmFyIHJlc3BvbnNlID0gdW53cmFwKGRlc2VyaWFsaXplKGV4dHJhY3QoZS50YXJnZXQsIHhock9wdGlvbnMpKSkKCQkJCWlmIChlLnR5cGUgPT0gImxvYWQiKSB7CgkJCQkJaWYgKHJlc3BvbnNlIGluc3RhbmNlb2YgQXJyYXkgJiYgeGhyT3B0aW9ucy50eXBlKSB7CgkJCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgcmVzcG9uc2UubGVuZ3RoOyBpKyspIHJlc3BvbnNlW2ldID0gbmV3IHhock9wdGlvbnMudHlwZShyZXNwb25zZVtpXSkKCQkJCQl9CgkJCQkJZWxzZSBpZiAoeGhyT3B0aW9ucy50eXBlKSByZXNwb25zZSA9IG5ldyB4aHJPcHRpb25zLnR5cGUocmVzcG9uc2UpCgkJCQl9CgkJCQlkZWZlcnJlZFtlLnR5cGUgPT0gImxvYWQiID8gInJlc29sdmUiIDogInJlamVjdCJdKHJlc3BvbnNlKQoJCQl9CgkJCWNhdGNoIChlKSB7CgkJCQlpZiAoZSBpbnN0YW5jZW9mIFN5bnRheEVycm9yKSB0aHJvdyBuZXcgU3ludGF4RXJyb3IoIkNvdWxkIG5vdCBwYXJzZSBIVFRQIHJlc3BvbnNlLiBTZWUgaHR0cDovL2xob3JpZS5naXRodWIuaW8vbWl0aHJpbC9taXRocmlsLnJlcXVlc3QuaHRtbCN1c2luZy12YXJpYWJsZS1kYXRhLWZvcm1hdHMiKQoJCQkJZWxzZSBpZiAoZSBpbnN0YW5jZW9mIEVycm9yICYmIGUuY29uc3RydWN0b3IgIT09IEVycm9yKSB0aHJvdyBlCgkJCQllbHNlIGRlZmVycmVkLnJlamVjdChlKQoJCQl9CgkJCWlmICh4aHJPcHRpb25zLmJhY2tncm91bmQgIT09IHRydWUpIG0uZW5kQ29tcHV0YXRpb24oKQoJCX0KCQlhamF4KHhock9wdGlvbnMpCgkJcmV0dXJuIGRlZmVycmVkLnByb21pc2UKCX0KCgkvL3Rlc3RpbmcgQVBJCgltLmRlcHMgPSBmdW5jdGlvbihtb2NrKSB7cmV0dXJuIHdpbmRvdyA9IG1vY2t9CgkvL2ZvciBpbnRlcm5hbCB0ZXN0aW5nIG9ubHksIGRvIG5vdCB1c2UgYG0uZGVwcy5mYWN0b3J5YAoJbS5kZXBzLmZhY3RvcnkgPSBhcHAKCglyZXR1cm4gbQp9KHR5cGVvZiB3aW5kb3cgIT0gInVuZGVmaW5lZCIgPyB3aW5kb3cgOiB7fSkKCmlmICh0eXBlb2YgbW9kdWxlICE9ICJ1bmRlZmluZWQiICYmIG1vZHVsZSAhPT0gbnVsbCkgbW9kdWxlLmV4cG9ydHMgPSBtCmlmICh0eXBlb2YgZGVmaW5lID09ICJmdW5jdGlvbiIgJiYgZGVmaW5lLmFtZCkgZGVmaW5lKGZ1bmN0aW9uKCkge3JldHVybiBtfSkKCjs7Owo=",
                "body": "TWl0aHJpbCA9IG0gPSBuZXcgZnVuY3Rpb24gYXBwKHdpbmRvdykgewoJdmFyIHNlbGVjdG9yQ2FjaGUgPSB7fQoJdmFyIHR5cGUgPSB7fS50b1N0cmluZwoJdmFyIHBhcnNlciA9IC8oPzooXnwjfFwuKShbXiNcLlxbXF1dKykpfChcWy4rP1xdKS9nLCBhdHRyUGFyc2VyID0gL1xbKC4rPykoPzo9KCJ8J3wpKC4qPylcMik/XF0vCgoJZnVuY3Rpb24gbSgpIHsKCQl2YXIgYXJncyA9IGFyZ3VtZW50cwoJCXZhciBoYXNBdHRycyA9IHR5cGUuY2FsbChhcmdzWzFdKSA9PSAiW29iamVjdCBPYmplY3RdIiAmJiAhKCJ0YWciIGluIGFyZ3NbMV0pICYmICEoInN1YnRyZWUiIGluIGFyZ3NbMV0pCgkJdmFyIGF0dHJzID0gaGFzQXR0cnMgPyBhcmdzWzFdIDoge30KCQl2YXIgY2xhc3NBdHRyTmFtZSA9ICJjbGFzcyIgaW4gYXR0cnMgPyAiY2xhc3MiIDogImNsYXNzTmFtZSIKCQl2YXIgY2VsbCA9IHNlbGVjdG9yQ2FjaGVbYXJnc1swXV0KCQlpZiAoY2VsbCA9PT0gdW5kZWZpbmVkKSB7CgkJCXNlbGVjdG9yQ2FjaGVbYXJnc1swXV0gPSBjZWxsID0ge3RhZzogImRpdiIsIGF0dHJzOiB7fX0KCQkJdmFyIG1hdGNoLCBjbGFzc2VzID0gW10KCQkJd2hpbGUgKG1hdGNoID0gcGFyc2VyLmV4ZWMoYXJnc1swXSkpIHsKCQkJCWlmIChtYXRjaFsxXSA9PSAiIikgY2VsbC50YWcgPSBtYXRjaFsyXQoJCQkJZWxzZSBpZiAobWF0Y2hbMV0gPT0gIiMiKSBjZWxsLmF0dHJzLmlkID0gbWF0Y2hbMl0KCQkJCWVsc2UgaWYgKG1hdGNoWzFdID09ICIuIikgY2xhc3Nlcy5wdXNoKG1hdGNoWzJdKQoJCQkJZWxzZSBpZiAobWF0Y2hbM11bMF0gPT0gIlsiKSB7CgkJCQkJdmFyIHBhaXIgPSBhdHRyUGFyc2VyLmV4ZWMobWF0Y2hbM10pCgkJCQkJY2VsbC5hdHRyc1twYWlyWzFdXSA9IHBhaXJbM10gfHwgKHBhaXJbMl0gPyAiIiA6dHJ1ZSkKCQkJCX0KCQkJfQoJCQlpZiAoY2xhc3Nlcy5sZW5ndGggPiAwKSBjZWxsLmF0dHJzW2NsYXNzQXR0ck5hbWVdID0gY2xhc3Nlcy5qb2luKCIgIikKCQl9CgkJY2VsbCA9IGNsb25lKGNlbGwpCgkJY2VsbC5hdHRycyA9IGNsb25lKGNlbGwuYXR0cnMpCgkJY2VsbC5jaGlsZHJlbiA9IGhhc0F0dHJzID8gYXJnc1syXSA6IGFyZ3NbMV0KCQlmb3IgKHZhciBhdHRyTmFtZSBpbiBhdHRycykgewoJCQlpZiAoYXR0ck5hbWUgPT0gY2xhc3NBdHRyTmFtZSkgY2VsbC5hdHRyc1thdHRyTmFtZV0gPSAoY2VsbC5hdHRyc1thdHRyTmFtZV0gfHwgIiIpICsgIiAiICsgYXR0cnNbYXR0ck5hbWVdCgkJCWVsc2UgY2VsbC5hdHRyc1thdHRyTmFtZV0gPSBhdHRyc1thdHRyTmFtZV0KCQl9CgkJcmV0dXJuIGNlbGwKCX0KCWZ1bmN0aW9uIGJ1aWxkKHBhcmVudEVsZW1lbnQsIHBhcmVudFRhZywgcGFyZW50Q2FjaGUsIHBhcmVudEluZGV4LCBkYXRhLCBjYWNoZWQsIHNob3VsZFJlYXR0YWNoLCBpbmRleCwgZWRpdGFibGUsIG5hbWVzcGFjZSwgY29uZmlncykgewoJCWlmIChkYXRhID09PSBudWxsIHx8IGRhdGEgPT09IHVuZGVmaW5lZCkgZGF0YSA9ICIiCgkJaWYgKGRhdGEuc3VidHJlZSA9PT0gInJldGFpbiIpIHJldHVybiBjYWNoZWQKCgkJdmFyIGNhY2hlZFR5cGUgPSB0eXBlLmNhbGwoY2FjaGVkKSwgZGF0YVR5cGUgPSB0eXBlLmNhbGwoZGF0YSkKCQlpZiAoY2FjaGVkVHlwZSAhPSBkYXRhVHlwZSkgewoJCQlpZiAoY2FjaGVkICE9PSBudWxsICYmIGNhY2hlZCAhPT0gdW5kZWZpbmVkKSB7CgkJCQlpZiAocGFyZW50Q2FjaGUgJiYgcGFyZW50Q2FjaGUubm9kZXMpIHsKCQkJCQl2YXIgb2Zmc2V0ID0gaW5kZXggLSBwYXJlbnRJbmRleAoJCQkJCXZhciBlbmQgPSBvZmZzZXQgKyAoZGF0YVR5cGUgPT0gIltvYmplY3QgQXJyYXldIiA/IGRhdGEgOiBjYWNoZWQubm9kZXMpLmxlbmd0aAoJCQkJCWNsZWFyKHBhcmVudENhY2hlLm5vZGVzLnNsaWNlKG9mZnNldCwgZW5kKSwgcGFyZW50Q2FjaGUuc2xpY2Uob2Zmc2V0LCBlbmQpKQoJCQkJfQoJCQkJZWxzZSBjbGVhcihjYWNoZWQubm9kZXMsIGNhY2hlZCkKCQkJfQoJCQljYWNoZWQgPSBuZXcgZGF0YS5jb25zdHJ1Y3RvcgoJCQljYWNoZWQubm9kZXMgPSBbXQoJCX0KCgkJaWYgKGRhdGFUeXBlID09ICJbb2JqZWN0IEFycmF5XSIpIHsKCQkJdmFyIG5vZGVzID0gW10sIGludGFjdCA9IGNhY2hlZC5sZW5ndGggPT09IGRhdGEubGVuZ3RoLCBzdWJBcnJheUNvdW50ID0gMAoJCQkKCQkJdmFyIERFTEVUSU9OID0gMSwgSU5TRVJUSU9OID0gMiAsIE1PVkUgPSAzCgkJCXZhciBleGlzdGluZyA9IHt9LCBzaG91bGRNYWludGFpbklkZW50aXRpZXMgPSBmYWxzZQoJCQlmb3IgKHZhciBpID0gMDsgaSA8IGNhY2hlZC5sZW5ndGg7IGkrKykgewoJCQkJaWYgKGNhY2hlZFtpXSAmJiBjYWNoZWRbaV0uYXR0cnMgJiYgY2FjaGVkW2ldLmF0dHJzLmtleSAhPT0gdW5kZWZpbmVkKSB7CgkJCQkJc2hvdWxkTWFpbnRhaW5JZGVudGl0aWVzID0gdHJ1ZQoJCQkJCWV4aXN0aW5nW2NhY2hlZFtpXS5hdHRycy5rZXldID0ge2FjdGlvbjogREVMRVRJT04sIGluZGV4OiBpfQoJCQkJfQoJCQl9CgkJCWlmIChzaG91bGRNYWludGFpbklkZW50aXRpZXMpIHsKCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkrKykgewoJCQkJCWlmIChkYXRhW2ldICYmIGRhdGFbaV0uYXR0cnMgJiYgZGF0YVtpXS5hdHRycy5rZXkgIT09IHVuZGVmaW5lZCkgewoJCQkJCQl2YXIga2V5ID0gZGF0YVtpXS5hdHRycy5rZXkKCQkJCQkJaWYgKCFleGlzdGluZ1trZXldKSBleGlzdGluZ1trZXldID0ge2FjdGlvbjogSU5TRVJUSU9OLCBpbmRleDogaX0KCQkJCQkJZWxzZSBleGlzdGluZ1trZXldID0ge2FjdGlvbjogTU9WRSwgaW5kZXg6IGksIGZyb206IGV4aXN0aW5nW2tleV0uaW5kZXgsIGVsZW1lbnQ6IHBhcmVudEVsZW1lbnQuY2hpbGROb2Rlc1tleGlzdGluZ1trZXldLmluZGV4XX0KCQkJCQl9CgkJCQl9CgkJCQl2YXIgYWN0aW9ucyA9IE9iamVjdC5rZXlzKGV4aXN0aW5nKS5tYXAoZnVuY3Rpb24oa2V5KSB7cmV0dXJuIGV4aXN0aW5nW2tleV19KQoJCQkJdmFyIGNoYW5nZXMgPSBhY3Rpb25zLnNvcnQoZnVuY3Rpb24oYSwgYikge3JldHVybiBhLmFjdGlvbiAtIGIuYWN0aW9uIHx8IGIuaW5kZXggLSBhLmluZGV4fSkKCQkJCXZhciBuZXdDYWNoZWQgPSBuZXcgQXJyYXkoY2FjaGVkLmxlbmd0aCkKCQkJCQoJCQkJZm9yICh2YXIgaSA9IDAsIGNoYW5nZTsgY2hhbmdlID0gY2hhbmdlc1tpXTsgaSsrKSB7CgkJCQkJaWYgKGNoYW5nZS5hY3Rpb24gPT0gREVMRVRJT04pIHsKCQkJCQkJY2xlYXIoY2FjaGVkW2NoYW5nZS5pbmRleF0ubm9kZXMsIGNhY2hlZFtjaGFuZ2UuaW5kZXhdKQoJCQkJCQluZXdDYWNoZWQuc3BsaWNlKGNoYW5nZS5pbmRleCwgMSkKCQkJCQl9CgkJCQkJaWYgKGNoYW5nZS5hY3Rpb24gPT0gSU5TRVJUSU9OKSB7CgkJCQkJCXZhciBkdW1teSA9IHdpbmRvdy5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCQkJCQlkdW1teS5rZXkgPSBkYXRhW2NoYW5nZS5pbmRleF0uYXR0cnMua2V5LnRvU3RyaW5nKCkKCQkJCQkJcGFyZW50RWxlbWVudC5pbnNlcnRCZWZvcmUoZHVtbXksIHBhcmVudEVsZW1lbnQuY2hpbGROb2Rlc1tjaGFuZ2UuaW5kZXhdKQoJCQkJCQluZXdDYWNoZWQuc3BsaWNlKGNoYW5nZS5pbmRleCwgMCwge2F0dHJzOiB7a2V5OiBkYXRhW2NoYW5nZS5pbmRleF0uYXR0cnMua2V5fSwgbm9kZXM6IFtkdW1teV19KQoJCQkJCX0KCQkJCQkKCQkJCQlpZiAoY2hhbmdlLmFjdGlvbiA9PSBNT1ZFKSB7CgkJCQkJCWlmIChwYXJlbnRFbGVtZW50LmNoaWxkTm9kZXNbY2hhbmdlLmluZGV4XSAhPT0gY2hhbmdlLmVsZW1lbnQpIHsKCQkJCQkJCXBhcmVudEVsZW1lbnQuaW5zZXJ0QmVmb3JlKGNoYW5nZS5lbGVtZW50LCBwYXJlbnRFbGVtZW50LmNoaWxkTm9kZXNbY2hhbmdlLmluZGV4XSkKCQkJCQkJfQoJCQkJCQluZXdDYWNoZWRbY2hhbmdlLmluZGV4XSA9IGNhY2hlZFtjaGFuZ2UuZnJvbV0KCQkJCQl9CgkJCQl9CgkJCQljYWNoZWQgPSBuZXdDYWNoZWQKCQkJCWNhY2hlZC5ub2RlcyA9IFtdCgkJCQlmb3IgKHZhciBpID0gMCwgY2hpbGQ7IGNoaWxkID0gcGFyZW50RWxlbWVudC5jaGlsZE5vZGVzW2ldOyBpKyspIGNhY2hlZC5ub2Rlcy5wdXNoKGNoaWxkKQoJCQl9CgkJCQoJCQlmb3IgKHZhciBpID0gMCwgY2FjaGVDb3VudCA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSsrKSB7CgkJCQl2YXIgaXRlbSA9IGJ1aWxkKHBhcmVudEVsZW1lbnQsIHBhcmVudFRhZywgY2FjaGVkLCBpbmRleCwgZGF0YVtpXSwgY2FjaGVkW2NhY2hlQ291bnRdLCBzaG91bGRSZWF0dGFjaCwgaW5kZXggKyBzdWJBcnJheUNvdW50IHx8IHN1YkFycmF5Q291bnQsIGVkaXRhYmxlLCBuYW1lc3BhY2UsIGNvbmZpZ3MpCgkJCQlpZiAoaXRlbSA9PT0gdW5kZWZpbmVkKSBjb250aW51ZQoJCQkJaWYgKCFpdGVtLm5vZGVzLmludGFjdCkgaW50YWN0ID0gZmFsc2UKCQkJCXN1YkFycmF5Q291bnQgKz0gaXRlbSBpbnN0YW5jZW9mIEFycmF5ID8gaXRlbS5sZW5ndGggOiAxCgkJCQljYWNoZWRbY2FjaGVDb3VudCsrXSA9IGl0ZW0KCQkJfQoJCQlpZiAoIWludGFjdCkgewoJCQkJZm9yICh2YXIgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSsrKSB7CgkJCQkJaWYgKGNhY2hlZFtpXSAhPT0gdW5kZWZpbmVkKSBub2RlcyA9IG5vZGVzLmNvbmNhdChjYWNoZWRbaV0ubm9kZXMpCgkJCQl9CgkJCQlmb3IgKHZhciBpID0gbm9kZXMubGVuZ3RoLCBub2RlOyBub2RlID0gY2FjaGVkLm5vZGVzW2ldOyBpKyspIHsKCQkJCQlpZiAobm9kZS5wYXJlbnROb2RlICE9PSBudWxsICYmIG5vZGUucGFyZW50Tm9kZS5jaGlsZE5vZGVzLmxlbmd0aCAhPSBub2Rlcy5sZW5ndGgpIHsKCQkJCQkJbm9kZS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKG5vZGUpCgkJCQkJCWlmIChjYWNoZWRbaV0pIHVubG9hZChjYWNoZWRbaV0pCgkJCQkJfQoJCQkJfQoJCQkJZm9yICh2YXIgaSA9IGNhY2hlZC5ub2Rlcy5sZW5ndGgsIG5vZGU7IG5vZGUgPSBub2Rlc1tpXTsgaSsrKSB7CgkJCQkJaWYgKG5vZGUucGFyZW50Tm9kZSA9PT0gbnVsbCkgcGFyZW50RWxlbWVudC5hcHBlbmRDaGlsZChub2RlKQoJCQkJfQoJCQkJaWYgKGRhdGEubGVuZ3RoIDwgY2FjaGVkLmxlbmd0aCkgY2FjaGVkLmxlbmd0aCA9IGRhdGEubGVuZ3RoCgkJCQljYWNoZWQubm9kZXMgPSBub2RlcwoJCQl9CgkJCQoJCX0KCQllbHNlIGlmIChkYXRhVHlwZSA9PSAiW29iamVjdCBPYmplY3RdIikgewoJCQlpZiAoZGF0YS50YWcgIT0gY2FjaGVkLnRhZyB8fCBPYmplY3Qua2V5cyhkYXRhLmF0dHJzKS5qb2luKCkgIT0gT2JqZWN0LmtleXMoY2FjaGVkLmF0dHJzKS5qb2luKCkgfHwgZGF0YS5hdHRycy5pZCAhPSBjYWNoZWQuYXR0cnMuaWQpIGNsZWFyKGNhY2hlZC5ub2RlcywgY2FjaGVkKQoJCQlpZiAodHlwZW9mIGRhdGEudGFnICE9ICJzdHJpbmciKSByZXR1cm4KCgkJCXZhciBub2RlLCBpc05ldyA9IGNhY2hlZC5ub2Rlcy5sZW5ndGggPT09IDAKCQkJaWYgKGRhdGEuYXR0cnMueG1sbnMpIG5hbWVzcGFjZSA9IGRhdGEuYXR0cnMueG1sbnMKCQkJZWxzZSBpZiAoZGF0YS50YWcgPT09ICJzdmciKSBuYW1lc3BhY2UgPSAiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCgkJCWlmIChpc05ldykgewoJCQkJbm9kZSA9IG5hbWVzcGFjZSA9PT0gdW5kZWZpbmVkID8gd2luZG93LmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoZGF0YS50YWcpIDogd2luZG93LmRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhuYW1lc3BhY2UsIGRhdGEudGFnKQoJCQkJY2FjaGVkID0gewoJCQkJCXRhZzogZGF0YS50YWcsCgkJCQkJLy9wcm9jZXNzIGNoaWxkcmVuIGJlZm9yZSBhdHRycyBzbyB0aGF0IHNlbGVjdC52YWx1ZSB3b3JrcyBjb3JyZWN0bHkKCQkJCQljaGlsZHJlbjogZGF0YS5jaGlsZHJlbiAhPT0gdW5kZWZpbmVkID8gYnVpbGQobm9kZSwgZGF0YS50YWcsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCBkYXRhLmNoaWxkcmVuLCBjYWNoZWQuY2hpbGRyZW4sIHRydWUsIDAsIGRhdGEuYXR0cnMuY29udGVudGVkaXRhYmxlID8gbm9kZSA6IGVkaXRhYmxlLCBuYW1lc3BhY2UsIGNvbmZpZ3MpIDogdW5kZWZpbmVkLAoJCQkJCWF0dHJzOiBzZXRBdHRyaWJ1dGVzKG5vZGUsIGRhdGEudGFnLCBkYXRhLmF0dHJzLCB7fSwgbmFtZXNwYWNlKSwKCQkJCQlub2RlczogW25vZGVdCgkJCQl9CgkJCQlwYXJlbnRFbGVtZW50Lmluc2VydEJlZm9yZShub2RlLCBwYXJlbnRFbGVtZW50LmNoaWxkTm9kZXNbaW5kZXhdIHx8IG51bGwpCgkJCX0KCQkJZWxzZSB7CgkJCQlub2RlID0gY2FjaGVkLm5vZGVzWzBdCgkJCQlzZXRBdHRyaWJ1dGVzKG5vZGUsIGRhdGEudGFnLCBkYXRhLmF0dHJzLCBjYWNoZWQuYXR0cnMsIG5hbWVzcGFjZSkKCQkJCWNhY2hlZC5jaGlsZHJlbiA9IGJ1aWxkKG5vZGUsIGRhdGEudGFnLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgZGF0YS5jaGlsZHJlbiwgY2FjaGVkLmNoaWxkcmVuLCBmYWxzZSwgMCwgZGF0YS5hdHRycy5jb250ZW50ZWRpdGFibGUgPyBub2RlIDogZWRpdGFibGUsIG5hbWVzcGFjZSwgY29uZmlncykKCQkJCWNhY2hlZC5ub2Rlcy5pbnRhY3QgPSB0cnVlCgkJCQlpZiAoc2hvdWxkUmVhdHRhY2ggPT09IHRydWUpIHBhcmVudEVsZW1lbnQuaW5zZXJ0QmVmb3JlKG5vZGUsIHBhcmVudEVsZW1lbnQuY2hpbGROb2Rlc1tpbmRleF0gfHwgbnVsbCkKCQkJfQoJCQlpZiAodHlwZS5jYWxsKGRhdGEuYXR0cnNbImNvbmZpZyJdKSA9PSAiW29iamVjdCBGdW5jdGlvbl0iKSB7CgkJCQljb25maWdzLnB1c2goZGF0YS5hdHRyc1siY29uZmlnIl0uYmluZCh3aW5kb3csIG5vZGUsICFpc05ldywgY2FjaGVkLmNvbmZpZ0NvbnRleHQgPSBjYWNoZWQuY29uZmlnQ29udGV4dCB8fCB7fSwgY2FjaGVkKSkKCQkJfQoJCX0KCQllbHNlIHsKCQkJdmFyIG5vZGVzCgkJCWlmIChjYWNoZWQubm9kZXMubGVuZ3RoID09PSAwKSB7CgkJCQlpZiAoZGF0YS4kdHJ1c3RlZCkgewoJCQkJCW5vZGVzID0gaW5qZWN0SFRNTChwYXJlbnRFbGVtZW50LCBpbmRleCwgZGF0YSkKCQkJCX0KCQkJCWVsc2UgewoJCQkJCW5vZGVzID0gW3dpbmRvdy5kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShkYXRhKV0KCQkJCQlwYXJlbnRFbGVtZW50Lmluc2VydEJlZm9yZShub2Rlc1swXSwgcGFyZW50RWxlbWVudC5jaGlsZE5vZGVzW2luZGV4XSB8fCBudWxsKQoJCQkJfQoJCQkJY2FjaGVkID0gInN0cmluZyBudW1iZXIgYm9vbGVhbiIuaW5kZXhPZih0eXBlb2YgZGF0YSkgPiAtMSA/IG5ldyBkYXRhLmNvbnN0cnVjdG9yKGRhdGEpIDogZGF0YQoJCQkJY2FjaGVkLm5vZGVzID0gbm9kZXMKCQkJfQoJCQllbHNlIGlmIChjYWNoZWQudmFsdWVPZigpICE9PSBkYXRhLnZhbHVlT2YoKSB8fCBzaG91bGRSZWF0dGFjaCA9PT0gdHJ1ZSkgewoJCQkJbm9kZXMgPSBjYWNoZWQubm9kZXMKCQkJCWlmICghZWRpdGFibGUgfHwgZWRpdGFibGUgIT09IHdpbmRvdy5kb2N1bWVudC5hY3RpdmVFbGVtZW50KSB7CgkJCQkJaWYgKGRhdGEuJHRydXN0ZWQpIHsKCQkJCQkJY2xlYXIobm9kZXMsIGNhY2hlZCkKCQkJCQkJbm9kZXMgPSBpbmplY3RIVE1MKHBhcmVudEVsZW1lbnQsIGluZGV4LCBkYXRhKQoJCQkJCX0KCQkJCQllbHNlIHsKCQkJCQkJaWYgKHBhcmVudFRhZyA9PT0gInRleHRhcmVhIikgcGFyZW50RWxlbWVudC52YWx1ZSA9IGRhdGEKCQkJCQkJZWxzZSBpZiAoZWRpdGFibGUpIGVkaXRhYmxlLmlubmVySFRNTCA9IGRhdGEKCQkJCQkJZWxzZSB7CgkJCQkJCQlpZiAobm9kZXNbMF0ubm9kZVR5cGUgPT0gMSB8fCBub2Rlcy5sZW5ndGggPiAxKSB7IC8vd2FzIGEgdHJ1c3RlZCBzdHJpbmcKCQkJCQkJCQljbGVhcihjYWNoZWQubm9kZXMsIGNhY2hlZCkKCQkJCQkJCQlub2RlcyA9IFt3aW5kb3cuZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoZGF0YSldCgkJCQkJCQl9CgkJCQkJCQlwYXJlbnRFbGVtZW50Lmluc2VydEJlZm9yZShub2Rlc1swXSwgcGFyZW50RWxlbWVudC5jaGlsZE5vZGVzW2luZGV4XSB8fCBudWxsKQoJCQkJCQkJbm9kZXNbMF0ubm9kZVZhbHVlID0gZGF0YQoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQkJY2FjaGVkID0gbmV3IGRhdGEuY29uc3RydWN0b3IoZGF0YSkKCQkJCWNhY2hlZC5ub2RlcyA9IG5vZGVzCgkJCX0KCQkJZWxzZSBjYWNoZWQubm9kZXMuaW50YWN0ID0gdHJ1ZQoJCX0KCgkJcmV0dXJuIGNhY2hlZAoJfQoJZnVuY3Rpb24gc2V0QXR0cmlidXRlcyhub2RlLCB0YWcsIGRhdGFBdHRycywgY2FjaGVkQXR0cnMsIG5hbWVzcGFjZSkgewoJCWZvciAodmFyIGF0dHJOYW1lIGluIGRhdGFBdHRycykgewoJCQl2YXIgZGF0YUF0dHIgPSBkYXRhQXR0cnNbYXR0ck5hbWVdCgkJCXZhciBjYWNoZWRBdHRyID0gY2FjaGVkQXR0cnNbYXR0ck5hbWVdCgkJCWlmICghKGF0dHJOYW1lIGluIGNhY2hlZEF0dHJzKSB8fCAoY2FjaGVkQXR0ciAhPT0gZGF0YUF0dHIpIHx8IG5vZGUgPT09IHdpbmRvdy5kb2N1bWVudC5hY3RpdmVFbGVtZW50KSB7CgkJCQljYWNoZWRBdHRyc1thdHRyTmFtZV0gPSBkYXRhQXR0cgoJCQkJaWYgKGF0dHJOYW1lID09PSAiY29uZmlnIikgY29udGludWUKCQkJCWVsc2UgaWYgKHR5cGVvZiBkYXRhQXR0ciA9PSAiZnVuY3Rpb24iICYmIGF0dHJOYW1lLmluZGV4T2YoIm9uIikgPT0gMCkgewoJCQkJCW5vZGVbYXR0ck5hbWVdID0gYXV0b3JlZHJhdyhkYXRhQXR0ciwgbm9kZSkKCQkJCX0KCQkJCWVsc2UgaWYgKGF0dHJOYW1lID09PSAic3R5bGUiICYmIHR5cGVvZiBkYXRhQXR0ciA9PSAib2JqZWN0IikgewoJCQkJCWZvciAodmFyIHJ1bGUgaW4gZGF0YUF0dHIpIHsKCQkJCQkJaWYgKGNhY2hlZEF0dHIgPT09IHVuZGVmaW5lZCB8fCBjYWNoZWRBdHRyW3J1bGVdICE9PSBkYXRhQXR0cltydWxlXSkgbm9kZS5zdHlsZVtydWxlXSA9IGRhdGFBdHRyW3J1bGVdCgkJCQkJfQoJCQkJCWZvciAodmFyIHJ1bGUgaW4gY2FjaGVkQXR0cikgewoJCQkJCQlpZiAoIShydWxlIGluIGRhdGFBdHRyKSkgbm9kZS5zdHlsZVtydWxlXSA9ICIiCgkJCQkJfQoJCQkJfQoJCQkJZWxzZSBpZiAobmFtZXNwYWNlICE9PSB1bmRlZmluZWQpIHsKCQkJCQlpZiAoYXR0ck5hbWUgPT09ICJocmVmIikgbm9kZS5zZXRBdHRyaWJ1dGVOUygiaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIsICJocmVmIiwgZGF0YUF0dHIpCgkJCQkJZWxzZSBpZiAoYXR0ck5hbWUgPT09ICJjbGFzc05hbWUiKSBub2RlLnNldEF0dHJpYnV0ZSgiY2xhc3MiLCBkYXRhQXR0cikKCQkJCQllbHNlIG5vZGUuc2V0QXR0cmlidXRlKGF0dHJOYW1lLCBkYXRhQXR0cikKCQkJCX0KCQkJCWVsc2UgaWYgKGF0dHJOYW1lID09PSAidmFsdWUiICYmIHRhZyA9PT0gImlucHV0IikgewoJCQkJCWlmIChub2RlLnZhbHVlICE9PSBkYXRhQXR0cikgbm9kZS52YWx1ZSA9IGRhdGFBdHRyCgkJCQl9CgkJCQllbHNlIGlmIChhdHRyTmFtZSBpbiBub2RlICYmICEoYXR0ck5hbWUgPT0gImxpc3QiIHx8IGF0dHJOYW1lID09ICJzdHlsZSIpKSB7CgkJCQkJbm9kZVthdHRyTmFtZV0gPSBkYXRhQXR0cgoJCQkJfQoJCQkJZWxzZSBub2RlLnNldEF0dHJpYnV0ZShhdHRyTmFtZSwgZGF0YUF0dHIpCgkJCX0KCQl9CgkJcmV0dXJuIGNhY2hlZEF0dHJzCgl9CglmdW5jdGlvbiBjbGVhcihub2RlcywgY2FjaGVkKSB7CgkJZm9yICh2YXIgaSA9IG5vZGVzLmxlbmd0aCAtIDE7IGkgPiAtMTsgaS0tKSB7CgkJCWlmIChub2Rlc1tpXSAmJiBub2Rlc1tpXS5wYXJlbnROb2RlKSB7CgkJCQlub2Rlc1tpXS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKG5vZGVzW2ldKQoJCQkJY2FjaGVkID0gW10uY29uY2F0KGNhY2hlZCkKCQkJCWlmIChjYWNoZWRbaV0pIHVubG9hZChjYWNoZWRbaV0pCgkJCX0KCQl9CgkJbm9kZXMubGVuZ3RoID0gMAoJfQoJZnVuY3Rpb24gdW5sb2FkKGNhY2hlZCkgewoJCWlmIChjYWNoZWQuY29uZmlnQ29udGV4dCAmJiB0eXBlb2YgY2FjaGVkLmNvbmZpZ0NvbnRleHQub251bmxvYWQgPT0gImZ1bmN0aW9uIikgY2FjaGVkLmNvbmZpZ0NvbnRleHQub251bmxvYWQoKQoJCWlmIChjYWNoZWQuY2hpbGRyZW4gaW5zdGFuY2VvZiBBcnJheSkgZm9yICh2YXIgaSA9IDA7IGkgPCBjYWNoZWQuY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHVubG9hZChjYWNoZWQuY2hpbGRyZW5baV0pCgl9CglmdW5jdGlvbiBpbmplY3RIVE1MKHBhcmVudEVsZW1lbnQsIGluZGV4LCBkYXRhKSB7CgkJdmFyIG5leHRTaWJsaW5nID0gcGFyZW50RWxlbWVudC5jaGlsZE5vZGVzW2luZGV4XQoJCWlmIChuZXh0U2libGluZykgewoJCQl2YXIgaXNFbGVtZW50ID0gbmV4dFNpYmxpbmcubm9kZVR5cGUgIT0gMQoJCQl2YXIgcGxhY2Vob2xkZXIgPSB3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic3BhbiIpCgkJCWlmIChpc0VsZW1lbnQpIHsKCQkJCXBhcmVudEVsZW1lbnQuaW5zZXJ0QmVmb3JlKHBsYWNlaG9sZGVyLCBuZXh0U2libGluZykKCQkJCXBsYWNlaG9sZGVyLmluc2VydEFkamFjZW50SFRNTCgiYmVmb3JlYmVnaW4iLCBkYXRhKQoJCQkJcGFyZW50RWxlbWVudC5yZW1vdmVDaGlsZChwbGFjZWhvbGRlcikKCQkJfQoJCQllbHNlIG5leHRTaWJsaW5nLmluc2VydEFkamFjZW50SFRNTCgiYmVmb3JlYmVnaW4iLCBkYXRhKQoJCX0KCQllbHNlIHBhcmVudEVsZW1lbnQuaW5zZXJ0QWRqYWNlbnRIVE1MKCJiZWZvcmVlbmQiLCBkYXRhKQoJCXZhciBub2RlcyA9IFtdCgkJd2hpbGUgKHBhcmVudEVsZW1lbnQuY2hpbGROb2Rlc1tpbmRleF0gIT09IG5leHRTaWJsaW5nKSB7CgkJCW5vZGVzLnB1c2gocGFyZW50RWxlbWVudC5jaGlsZE5vZGVzW2luZGV4XSkKCQkJaW5kZXgrKwoJCX0KCQlyZXR1cm4gbm9kZXMKCX0KCWZ1bmN0aW9uIGNsb25lKG9iamVjdCkgewoJCXZhciByZXN1bHQgPSB7fQoJCWZvciAodmFyIHByb3AgaW4gb2JqZWN0KSByZXN1bHRbcHJvcF0gPSBvYmplY3RbcHJvcF0KCQlyZXR1cm4gcmVzdWx0Cgl9CglmdW5jdGlvbiBhdXRvcmVkcmF3KGNhbGxiYWNrLCBvYmplY3QpIHsKCQlyZXR1cm4gZnVuY3Rpb24oZSkgewoJCQllID0gZSB8fCBldmVudAoJCQltLnN0YXJ0Q29tcHV0YXRpb24oKQoJCQl0cnkge3JldHVybiBjYWxsYmFjay5jYWxsKG9iamVjdCwgZSl9CgkJCWZpbmFsbHkge20uZW5kQ29tcHV0YXRpb24oKX0KCQl9Cgl9CgoJdmFyIGh0bWwKCXZhciBkb2N1bWVudE5vZGUgPSB7CgkJaW5zZXJ0QWRqYWNlbnRIVE1MOiBmdW5jdGlvbihfLCBkYXRhKSB7CgkJCXdpbmRvdy5kb2N1bWVudC53cml0ZShkYXRhKQoJCQl3aW5kb3cuZG9jdW1lbnQuY2xvc2UoKQoJCX0sCgkJYXBwZW5kQ2hpbGQ6IGZ1bmN0aW9uKG5vZGUpIHsKCQkJaWYgKGh0bWwgPT09IHVuZGVmaW5lZCkgaHRtbCA9IHdpbmRvdy5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJodG1sIikKCQkJaWYgKG5vZGUubm9kZU5hbWUgPT0gIkhUTUwiKSBodG1sID0gbm9kZQoJCQllbHNlIGh0bWwuYXBwZW5kQ2hpbGQobm9kZSkKCQkJaWYgKHdpbmRvdy5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQgIT09IGh0bWwpIHsKCQkJCXdpbmRvdy5kb2N1bWVudC5yZXBsYWNlQ2hpbGQoaHRtbCwgd2luZG93LmRvY3VtZW50LmRvY3VtZW50RWxlbWVudCkKCQkJfQoJCX0sCgkJaW5zZXJ0QmVmb3JlOiBmdW5jdGlvbihub2RlKSB7CgkJCXRoaXMuYXBwZW5kQ2hpbGQobm9kZSkKCQl9LAoJCWNoaWxkTm9kZXM6IFtdCgl9Cgl2YXIgbm9kZUNhY2hlID0gW10sIGNlbGxDYWNoZSA9IHt9CgltLnJlbmRlciA9IGZ1bmN0aW9uKHJvb3QsIGNlbGwpIHsKCQl2YXIgY29uZmlncyA9IFtdCgkJaWYgKCFyb290KSB0aHJvdyBuZXcgRXJyb3IoIlBsZWFzZSBlbnN1cmUgdGhlIERPTSBlbGVtZW50IGV4aXN0cyBiZWZvcmUgcmVuZGVyaW5nIGEgdGVtcGxhdGUgaW50byBpdC4iKQoJCXZhciBpZCA9IGdldENlbGxDYWNoZUlkKHJvb3QpCgkJdmFyIG5vZGUgPSByb290ID09IHdpbmRvdy5kb2N1bWVudCB8fCByb290ID09IHdpbmRvdy5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQgPyBkb2N1bWVudE5vZGUgOiByb290CgkJaWYgKGNlbGxDYWNoZVtpZF0gPT09IHVuZGVmaW5lZCkgY2xlYXIobm9kZS5jaGlsZE5vZGVzKQoJCWNlbGxDYWNoZVtpZF0gPSBidWlsZChub2RlLCBudWxsLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgY2VsbCwgY2VsbENhY2hlW2lkXSwgZmFsc2UsIDAsIG51bGwsIHVuZGVmaW5lZCwgY29uZmlncykKCQlmb3IgKHZhciBpID0gMDsgaSA8IGNvbmZpZ3MubGVuZ3RoOyBpKyspIGNvbmZpZ3NbaV0oKQoJfQoJZnVuY3Rpb24gZ2V0Q2VsbENhY2hlSWQoZWxlbWVudCkgewoJCXZhciBpbmRleCA9IG5vZGVDYWNoZS5pbmRleE9mKGVsZW1lbnQpCgkJcmV0dXJuIGluZGV4IDwgMCA/IG5vZGVDYWNoZS5wdXNoKGVsZW1lbnQpIC0gMSA6IGluZGV4Cgl9CgoJbS50cnVzdCA9IGZ1bmN0aW9uKHZhbHVlKSB7CgkJdmFsdWUgPSBuZXcgU3RyaW5nKHZhbHVlKQoJCXZhbHVlLiR0cnVzdGVkID0gdHJ1ZQoJCXJldHVybiB2YWx1ZQoJfQoKCXZhciByb290cyA9IFtdLCBtb2R1bGVzID0gW10sIGNvbnRyb2xsZXJzID0gW10sIG5vdyA9IDAsIGxhc3RSZWRyYXcgPSAwLCBsYXN0UmVkcmF3SWQgPSAwLCBjb21wdXRlUG9zdFJlZHJhd0hvb2sgPSBudWxsCgltLm1vZHVsZSA9IGZ1bmN0aW9uKHJvb3QsIG1vZHVsZSkgewoJCXZhciBpbmRleCA9IHJvb3RzLmluZGV4T2Yocm9vdCkKCQlpZiAoaW5kZXggPCAwKSBpbmRleCA9IHJvb3RzLmxlbmd0aAoJCXZhciBpc1ByZXZlbnRlZCA9IGZhbHNlCgkJaWYgKGNvbnRyb2xsZXJzW2luZGV4XSAmJiB0eXBlb2YgY29udHJvbGxlcnNbaW5kZXhdLm9udW5sb2FkID09ICJmdW5jdGlvbiIpIHsKCQkJdmFyIGV2ZW50ID0gewoJCQkJcHJldmVudERlZmF1bHQ6IGZ1bmN0aW9uKCkge2lzUHJldmVudGVkID0gdHJ1ZX0KCQkJfQoJCQljb250cm9sbGVyc1tpbmRleF0ub251bmxvYWQoZXZlbnQpCgkJfQoJCWlmICghaXNQcmV2ZW50ZWQpIHsKCQkJbS5zdGFydENvbXB1dGF0aW9uKCkKCQkJcm9vdHNbaW5kZXhdID0gcm9vdAoJCQltb2R1bGVzW2luZGV4XSA9IG1vZHVsZQoJCQljb250cm9sbGVyc1tpbmRleF0gPSBuZXcgbW9kdWxlLmNvbnRyb2xsZXIKCQkJbS5lbmRDb21wdXRhdGlvbigpCgkJfQoJfQoJbS5yZWRyYXcgPSBmdW5jdGlvbigpIHsKCQlub3cgPSB3aW5kb3cucGVyZm9ybWFuY2UgJiYgd2luZG93LnBlcmZvcm1hbmNlLm5vdyA/IHdpbmRvdy5wZXJmb3JtYW5jZS5ub3coKSA6IG5ldyB3aW5kb3cuRGF0ZSgpLmdldFRpbWUoKQoJCWlmIChub3cgLSBsYXN0UmVkcmF3ID4gMTYpIHJlZHJhdygpCgkJZWxzZSB7CgkJCXZhciBjYW5jZWwgPSB3aW5kb3cuY2FuY2VsQW5pbWF0aW9uRnJhbWUgfHwgd2luZG93LmNsZWFyVGltZW91dAoJCQl2YXIgZGVmZXIgPSB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8IHdpbmRvdy5zZXRUaW1lb3V0CgkJCWNhbmNlbChsYXN0UmVkcmF3SWQpCgkJCWxhc3RSZWRyYXdJZCA9IGRlZmVyKHJlZHJhdywgMCkKCQl9Cgl9CglmdW5jdGlvbiByZWRyYXcoKSB7CgkJZm9yICh2YXIgaSA9IDA7IGkgPCByb290cy5sZW5ndGg7IGkrKykgewoJCQlpZiAoY29udHJvbGxlcnNbaV0pIG0ucmVuZGVyKHJvb3RzW2ldLCBtb2R1bGVzW2ldLnZpZXcoY29udHJvbGxlcnNbaV0pKQoJCX0KCQlpZiAoY29tcHV0ZVBvc3RSZWRyYXdIb29rKSB7CgkJCWNvbXB1dGVQb3N0UmVkcmF3SG9vaygpCgkJCWNvbXB1dGVQb3N0UmVkcmF3SG9vayA9IG51bGwKCQl9CgkJbGFzdFJlZHJhdyA9IG5vdwoJfQoKCXZhciBwZW5kaW5nUmVxdWVzdHMgPSAwCgltLnN0YXJ0Q29tcHV0YXRpb24gPSBmdW5jdGlvbigpIHtwZW5kaW5nUmVxdWVzdHMrK30KCW0uZW5kQ29tcHV0YXRpb24gPSBmdW5jdGlvbigpIHsKCQlwZW5kaW5nUmVxdWVzdHMgPSBNYXRoLm1heChwZW5kaW5nUmVxdWVzdHMgLSAxLCAwKQoJCWlmIChwZW5kaW5nUmVxdWVzdHMgPT0gMCkgbS5yZWRyYXcoKQoJfQoKCW0ud2l0aEF0dHIgPSBmdW5jdGlvbihwcm9wLCB3aXRoQXR0ckNhbGxiYWNrKSB7CgkJcmV0dXJuIGZ1bmN0aW9uKGUpIHsKCQkJZSA9IGUgfHwgZXZlbnQKCQkJd2l0aEF0dHJDYWxsYmFjayhwcm9wIGluIGUuY3VycmVudFRhcmdldCA/IGUuY3VycmVudFRhcmdldFtwcm9wXSA6IGUuY3VycmVudFRhcmdldC5nZXRBdHRyaWJ1dGUocHJvcCkpCgkJfQoJfQoKCS8vcm91dGluZwoJdmFyIG1vZGVzID0ge3BhdGhuYW1lOiAiIiwgaGFzaDogIiMiLCBzZWFyY2g6ICI/In0KCXZhciByZWRpcmVjdCA9IGZ1bmN0aW9uKCkge30sIHJvdXRlUGFyYW1zID0ge30sIGN1cnJlbnRSb3V0ZQoJbS5yb3V0ZSA9IGZ1bmN0aW9uKCkgewoJCWlmIChhcmd1bWVudHMubGVuZ3RoID09PSAwKSByZXR1cm4gY3VycmVudFJvdXRlCgkJZWxzZSBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMyAmJiB0eXBlb2YgYXJndW1lbnRzWzFdID09ICJzdHJpbmciKSB7CgkJCXZhciByb290ID0gYXJndW1lbnRzWzBdLCBkZWZhdWx0Um91dGUgPSBhcmd1bWVudHNbMV0sIHJvdXRlciA9IGFyZ3VtZW50c1syXQoJCQlyZWRpcmVjdCA9IGZ1bmN0aW9uKHNvdXJjZSkgewoJCQkJdmFyIHBhdGggPSBjdXJyZW50Um91dGUgPSBub3JtYWxpemVSb3V0ZShzb3VyY2UpCgkJCQlpZiAoIXJvdXRlQnlWYWx1ZShyb290LCByb3V0ZXIsIHBhdGgpKSB7CgkJCQkJbS5yb3V0ZShkZWZhdWx0Um91dGUsIHRydWUpCgkJCQl9CgkJCX0KCQkJdmFyIGxpc3RlbmVyID0gbS5yb3V0ZS5tb2RlID09ICJoYXNoIiA/ICJvbmhhc2hjaGFuZ2UiIDogIm9ucG9wc3RhdGUiCgkJCXdpbmRvd1tsaXN0ZW5lcl0gPSBmdW5jdGlvbigpIHsKCQkJCWlmIChjdXJyZW50Um91dGUgIT0gbm9ybWFsaXplUm91dGUod2luZG93LmxvY2F0aW9uW20ucm91dGUubW9kZV0pKSB7CgkJCQkJcmVkaXJlY3Qod2luZG93LmxvY2F0aW9uW20ucm91dGUubW9kZV0pCgkJCQl9CgkJCX0KCQkJY29tcHV0ZVBvc3RSZWRyYXdIb29rID0gc2V0U2Nyb2xsCgkJCXdpbmRvd1tsaXN0ZW5lcl0oKQoJCQljdXJyZW50Um91dGUgPSBub3JtYWxpemVSb3V0ZSh3aW5kb3cubG9jYXRpb25bbS5yb3V0ZS5tb2RlXSkKCQl9CgkJZWxzZSBpZiAoYXJndW1lbnRzWzBdLmFkZEV2ZW50TGlzdGVuZXIpIHsKCQkJdmFyIGVsZW1lbnQgPSBhcmd1bWVudHNbMF0KCQkJdmFyIGlzSW5pdGlhbGl6ZWQgPSBhcmd1bWVudHNbMV0KCQkJaWYgKGVsZW1lbnQuaHJlZi5pbmRleE9mKG1vZGVzW20ucm91dGUubW9kZV0pIDwgMCkgewoJCQkJZWxlbWVudC5ocmVmID0gd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lICsgbW9kZXNbbS5yb3V0ZS5tb2RlXSArIGVsZW1lbnQucGF0aG5hbWUKCQkJfQoJCQlpZiAoIWlzSW5pdGlhbGl6ZWQpIHsKCQkJCWVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigiY2xpY2siLCByb3V0ZVVub2J0cnVzaXZlKQoJCQkJZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIHJvdXRlVW5vYnRydXNpdmUpCgkJCX0KCQl9CgkJZWxzZSBpZiAodHlwZW9mIGFyZ3VtZW50c1swXSA9PSAic3RyaW5nIikgewoJCQljdXJyZW50Um91dGUgPSBhcmd1bWVudHNbMF0KCQkJdmFyIHF1ZXJ5c3RyaW5nID0gdHlwZW9mIGFyZ3VtZW50c1sxXSA9PSAib2JqZWN0IiA/IGJ1aWxkUXVlcnlTdHJpbmcoYXJndW1lbnRzWzFdKSA6IG51bGwKCQkJaWYgKHF1ZXJ5c3RyaW5nKSBjdXJyZW50Um91dGUgKz0gKGN1cnJlbnRSb3V0ZS5pbmRleE9mKCI/IikgPT09IC0xID8gIj8iIDogIiYiKSArIHF1ZXJ5c3RyaW5nCgoJCQl2YXIgc2hvdWxkUmVwbGFjZUhpc3RvcnlFbnRyeSA9IChhcmd1bWVudHMubGVuZ3RoID09IDMgPyBhcmd1bWVudHNbMl0gOiBhcmd1bWVudHNbMV0pID09PSB0cnVlCgoJCQlpZiAod2luZG93Lmhpc3RvcnkucHVzaFN0YXRlKSB7CgkJCQljb21wdXRlUG9zdFJlZHJhd0hvb2sgPSBmdW5jdGlvbigpIHsKCQkJCQl3aW5kb3cuaGlzdG9yeVtzaG91bGRSZXBsYWNlSGlzdG9yeUVudHJ5ID8gInJlcGxhY2VTdGF0ZSIgOiAicHVzaFN0YXRlIl0obnVsbCwgd2luZG93LmRvY3VtZW50LnRpdGxlLCBtb2Rlc1ttLnJvdXRlLm1vZGVdICsgY3VycmVudFJvdXRlKQoJCQkJCXNldFNjcm9sbCgpCgkJCQl9CgkJCQlyZWRpcmVjdChtb2Rlc1ttLnJvdXRlLm1vZGVdICsgY3VycmVudFJvdXRlKQoJCQl9CgkJCWVsc2Ugd2luZG93LmxvY2F0aW9uW20ucm91dGUubW9kZV0gPSBjdXJyZW50Um91dGUKCQl9Cgl9CgltLnJvdXRlLnBhcmFtID0gZnVuY3Rpb24oa2V5KSB7cmV0dXJuIHJvdXRlUGFyYW1zW2tleV19CgltLnJvdXRlLm1vZGUgPSAic2VhcmNoIgoJZnVuY3Rpb24gbm9ybWFsaXplUm91dGUocm91dGUpIHtyZXR1cm4gcm91dGUuc2xpY2UobW9kZXNbbS5yb3V0ZS5tb2RlXS5sZW5ndGgpfQoJZnVuY3Rpb24gcm91dGVCeVZhbHVlKHJvb3QsIHJvdXRlciwgcGF0aCkgewoJCXJvdXRlUGFyYW1zID0ge30KCgkJdmFyIHF1ZXJ5U3RhcnQgPSBwYXRoLmluZGV4T2YoIj8iKQoJCWlmIChxdWVyeVN0YXJ0ICE9PSAtMSkgewoJCQlyb3V0ZVBhcmFtcyA9IHBhcnNlUXVlcnlTdHJpbmcocGF0aC5zdWJzdHIocXVlcnlTdGFydCArIDEsIHBhdGgubGVuZ3RoKSkKCQkJcGF0aCA9IHBhdGguc3Vic3RyKDAsIHF1ZXJ5U3RhcnQpCgkJfQoKCQlmb3IgKHZhciByb3V0ZSBpbiByb3V0ZXIpIHsKCQkJaWYgKHJvdXRlID09IHBhdGgpIHsKCQkJCWNsZWFyKHJvb3QuY2hpbGROb2RlcywgY2VsbENhY2hlW2dldENlbGxDYWNoZUlkKHJvb3QpXSkKCQkJCW0ubW9kdWxlKHJvb3QsIHJvdXRlcltyb3V0ZV0pCgkJCQlyZXR1cm4gdHJ1ZQoJCQl9CgoJCQl2YXIgbWF0Y2hlciA9IG5ldyBSZWdFeHAoIl4iICsgcm91dGUucmVwbGFjZSgvOlteXC9dKz9cLnszfS9nLCAiKC4qPykiKS5yZXBsYWNlKC86W15cL10rL2csICIoW15cXC9dKykiKSArICJcLz8kIikKCgkJCWlmIChtYXRjaGVyLnRlc3QocGF0aCkpIHsKCQkJCWNsZWFyKHJvb3QuY2hpbGROb2RlcywgY2VsbENhY2hlW2dldENlbGxDYWNoZUlkKHJvb3QpXSkKCQkJCXBhdGgucmVwbGFjZShtYXRjaGVyLCBmdW5jdGlvbigpIHsKCQkJCQl2YXIga2V5cyA9IHJvdXRlLm1hdGNoKC86W15cL10rL2cpIHx8IFtdCgkJCQkJdmFyIHZhbHVlcyA9IFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxLCAtMikKCQkJCQlmb3IgKHZhciBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHJvdXRlUGFyYW1zW2tleXNbaV0ucmVwbGFjZSgvOnxcLi9nLCAiIildID0gZGVjb2RlU3BhY2UodmFsdWVzW2ldKQoJCQkJCW0ubW9kdWxlKHJvb3QsIHJvdXRlcltyb3V0ZV0pCgkJCQl9KQoJCQkJcmV0dXJuIHRydWUKCQkJfQoJCX0KCX0KCWZ1bmN0aW9uIHJvdXRlVW5vYnRydXNpdmUoZSkgewoJCWUgPSBlIHx8IGV2ZW50CgkJaWYgKGUuY3RybEtleSB8fCBlLm1ldGFLZXkgfHwgZS53aGljaCA9PSAyKSByZXR1cm4KCQllLnByZXZlbnREZWZhdWx0KCkKCQltLnJvdXRlKGUuY3VycmVudFRhcmdldFttLnJvdXRlLm1vZGVdLnNsaWNlKG1vZGVzW20ucm91dGUubW9kZV0ubGVuZ3RoKSkKCX0KCWZ1bmN0aW9uIHNldFNjcm9sbCgpIHsKCQlpZiAobS5yb3V0ZS5tb2RlICE9ICJoYXNoIiAmJiB3aW5kb3cubG9jYXRpb24uaGFzaCkgd2luZG93LmxvY2F0aW9uLmhhc2ggPSB3aW5kb3cubG9jYXRpb24uaGFzaAoJCWVsc2Ugd2luZG93LnNjcm9sbFRvKDAsIDApCgl9CglmdW5jdGlvbiBidWlsZFF1ZXJ5U3RyaW5nKG9iamVjdCwgcHJlZml4KSB7CgkJdmFyIHN0ciA9IFtdCgkJZm9yKHZhciBwcm9wIGluIG9iamVjdCkgewoJCQl2YXIga2V5ID0gcHJlZml4ID8gcHJlZml4ICsgIlsiICsgcHJvcCArICJdIiA6IHByb3AsIHZhbHVlID0gb2JqZWN0W3Byb3BdCgkJCXN0ci5wdXNoKHR5cGVvZiB2YWx1ZSA9PSAib2JqZWN0IiA/IGJ1aWxkUXVlcnlTdHJpbmcodmFsdWUsIGtleSkgOiBlbmNvZGVVUklDb21wb25lbnQoa2V5KSArICI9IiArIGVuY29kZVVSSUNvbXBvbmVudCh2YWx1ZSkpCgkJfQoJCXJldHVybiBzdHIuam9pbigiJiIpCgl9CglmdW5jdGlvbiBwYXJzZVF1ZXJ5U3RyaW5nKHN0cikgewoJCXZhciBwYWlycyA9IHN0ci5zcGxpdCgiJiIpLCBwYXJhbXMgPSB7fQoJCWZvciAodmFyIGkgPSAwOyBpIDwgcGFpcnMubGVuZ3RoOyBpKyspIHsKCQkJdmFyIHBhaXIgPSBwYWlyc1tpXS5zcGxpdCgiPSIpCgkJCXBhcmFtc1tkZWNvZGVTcGFjZShwYWlyWzBdKV0gPSBwYWlyWzFdID8gZGVjb2RlU3BhY2UocGFpclsxXSkgOiAocGFpci5sZW5ndGggPT09IDEgPyB0cnVlIDogIiIpCgkJfQoJCXJldHVybiBwYXJhbXMKCX0KCWZ1bmN0aW9uIGRlY29kZVNwYWNlKHN0cmluZykgewoJCXJldHVybiBkZWNvZGVVUklDb21wb25lbnQoc3RyaW5nLnJlcGxhY2UoL1wrL2csICIgIikpCgl9CgoJLy9tb2RlbAoJbS5wcm9wID0gZnVuY3Rpb24oc3RvcmUpIHsKCQl2YXIgcHJvcCA9IGZ1bmN0aW9uKCkgewoJCQlpZiAoYXJndW1lbnRzLmxlbmd0aCkgc3RvcmUgPSBhcmd1bWVudHNbMF0KCQkJcmV0dXJuIHN0b3JlCgkJfQoJCXByb3AudG9KU09OID0gZnVuY3Rpb24oKSB7CgkJCXJldHVybiBzdG9yZQoJCX0KCQlyZXR1cm4gcHJvcAoJfQoKCXZhciBub25lID0ge30KCW0uZGVmZXJyZWQgPSBmdW5jdGlvbigpIHsKCQl2YXIgcmVzb2x2ZXJzID0gW10sIHJlamVjdGVycyA9IFtdLCByZXNvbHZlZCA9IG5vbmUsIHJlamVjdGVkID0gbm9uZSwgcHJvbWlzZSA9IG0ucHJvcCgpCgkJdmFyIG9iamVjdCA9IHsKCQkJcmVzb2x2ZTogZnVuY3Rpb24odmFsdWUpIHsKCQkJCWlmIChyZXNvbHZlZCA9PT0gbm9uZSkgcHJvbWlzZShyZXNvbHZlZCA9IHZhbHVlKQoJCQkJZm9yICh2YXIgaSA9IDA7IGkgPCByZXNvbHZlcnMubGVuZ3RoOyBpKyspIHJlc29sdmVyc1tpXSh2YWx1ZSkKCQkJCXJlc29sdmVycy5sZW5ndGggPSByZWplY3RlcnMubGVuZ3RoID0gMAoJCQl9LAoJCQlyZWplY3Q6IGZ1bmN0aW9uKHZhbHVlKSB7CgkJCQlpZiAocmVqZWN0ZWQgPT09IG5vbmUpIHJlamVjdGVkID0gdmFsdWUKCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgcmVqZWN0ZXJzLmxlbmd0aDsgaSsrKSByZWplY3RlcnNbaV0odmFsdWUpCgkJCQlyZXNvbHZlcnMubGVuZ3RoID0gcmVqZWN0ZXJzLmxlbmd0aCA9IDAKCQkJfSwKCQkJcHJvbWlzZTogcHJvbWlzZQoJCX0KCQlvYmplY3QucHJvbWlzZS5yZXNvbHZlcnMgPSByZXNvbHZlcnMKCQlvYmplY3QucHJvbWlzZS50aGVuID0gZnVuY3Rpb24oc3VjY2VzcywgZXJyb3IpIHsKCQkJdmFyIG5leHQgPSBtLmRlZmVycmVkKCkKCQkJaWYgKCFzdWNjZXNzKSBzdWNjZXNzID0gaWRlbnRpdHkKCQkJaWYgKCFlcnJvcikgZXJyb3IgPSBpZGVudGl0eQoJCQlmdW5jdGlvbiBjYWxsYmFjayhtZXRob2QsIGNhbGxiYWNrKSB7CgkJCQlyZXR1cm4gZnVuY3Rpb24odmFsdWUpIHsKCQkJCQl0cnkgewoJCQkJCQl2YXIgcmVzdWx0ID0gY2FsbGJhY2sodmFsdWUpCgkJCQkJCWlmIChyZXN1bHQgJiYgdHlwZW9mIHJlc3VsdC50aGVuID09ICJmdW5jdGlvbiIpIHJlc3VsdC50aGVuKG5leHRbbWV0aG9kXSwgZXJyb3IpCgkJCQkJCWVsc2UgbmV4dFttZXRob2RdKHJlc3VsdCAhPT0gdW5kZWZpbmVkID8gcmVzdWx0IDogdmFsdWUpCgkJCQkJfQoJCQkJCWNhdGNoIChlKSB7CgkJCQkJCWlmIChlIGluc3RhbmNlb2YgRXJyb3IgJiYgZS5jb25zdHJ1Y3RvciAhPT0gRXJyb3IpIHRocm93IGUKCQkJCQkJZWxzZSBuZXh0LnJlamVjdChlKQoJCQkJCX0KCQkJCX0KCQkJfQoJCQlpZiAocmVzb2x2ZWQgIT09IG5vbmUpIGNhbGxiYWNrKCJyZXNvbHZlIiwgc3VjY2VzcykocmVzb2x2ZWQpCgkJCWVsc2UgaWYgKHJlamVjdGVkICE9PSBub25lKSBjYWxsYmFjaygicmVqZWN0IiwgZXJyb3IpKHJlamVjdGVkKQoJCQllbHNlIHsKCQkJCXJlc29sdmVycy5wdXNoKGNhbGxiYWNrKCJyZXNvbHZlIiwgc3VjY2VzcykpCgkJCQlyZWplY3RlcnMucHVzaChjYWxsYmFjaygicmVqZWN0IiwgZXJyb3IpKQoJCQl9CgkJCXJldHVybiBuZXh0LnByb21pc2UKCQl9CgkJcmV0dXJuIG9iamVjdAoJfQoJbS5zeW5jID0gZnVuY3Rpb24oYXJncykgewoJCXZhciBtZXRob2QgPSAicmVzb2x2ZSIKCQlmdW5jdGlvbiBzeW5jaHJvbml6ZXIocG9zLCByZXNvbHZlZCkgewoJCQlyZXR1cm4gZnVuY3Rpb24odmFsdWUpIHsKCQkJCXJlc3VsdHNbcG9zXSA9IHZhbHVlCgkJCQlpZiAoIXJlc29sdmVkKSBtZXRob2QgPSAicmVqZWN0IgoJCQkJaWYgKC0tb3V0c3RhbmRpbmcgPT0gMCkgewoJCQkJCWRlZmVycmVkLnByb21pc2UocmVzdWx0cykKCQkJCQlkZWZlcnJlZFttZXRob2RdKHJlc3VsdHMpCgkJCQl9CgkJCQlyZXR1cm4gdmFsdWUKCQkJfQoJCX0KCgkJdmFyIGRlZmVycmVkID0gbS5kZWZlcnJlZCgpCgkJdmFyIG91dHN0YW5kaW5nID0gYXJncy5sZW5ndGgKCQl2YXIgcmVzdWx0cyA9IG5ldyBBcnJheShvdXRzdGFuZGluZykKCQlmb3IgKHZhciBpID0gMDsgaSA8IGFyZ3MubGVuZ3RoOyBpKyspIHsKCQkJYXJnc1tpXS50aGVuKHN5bmNocm9uaXplcihpLCB0cnVlKSwgc3luY2hyb25pemVyKGksIGZhbHNlKSkKCQl9CgkJcmV0dXJuIGRlZmVycmVkLnByb21pc2UKCX0KCWZ1bmN0aW9uIGlkZW50aXR5KHZhbHVlKSB7cmV0dXJuIHZhbHVlfQoKCWZ1bmN0aW9uIGFqYXgob3B0aW9ucykgewoJCXZhciB4aHIgPSBuZXcgd2luZG93LlhNTEh0dHBSZXF1ZXN0CgkJeGhyLm9wZW4ob3B0aW9ucy5tZXRob2QsIG9wdGlvbnMudXJsLCB0cnVlLCBvcHRpb25zLnVzZXIsIG9wdGlvbnMucGFzc3dvcmQpCgkJeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uKCkgewoJCQlpZiAoeGhyLnJlYWR5U3RhdGUgPT09IDQpIHsKCQkJCWlmICh4aHIuc3RhdHVzID49IDIwMCAmJiB4aHIuc3RhdHVzIDwgMzAwKSBvcHRpb25zLm9ubG9hZCh7dHlwZTogImxvYWQiLCB0YXJnZXQ6IHhocn0pCgkJCQllbHNlIG9wdGlvbnMub25lcnJvcih7dHlwZTogImVycm9yIiwgdGFyZ2V0OiB4aHJ9KQoJCQl9CgkJfQoJCWlmIChvcHRpb25zLnNlcmlhbGl6ZSA9PSBKU09OLnN0cmluZ2lmeSAmJiBvcHRpb25zLm1ldGhvZCAhPSAiR0VUIikgewoJCQl4aHIuc2V0UmVxdWVzdEhlYWRlcigiQ29udGVudC1UeXBlIiwgImFwcGxpY2F0aW9uL2pzb247IGNoYXJzZXQ9dXRmLTgiKTsKCQl9CgkJaWYgKHR5cGVvZiBvcHRpb25zLmNvbmZpZyA9PSAiZnVuY3Rpb24iKSB7CgkJCXZhciBtYXliZVhociA9IG9wdGlvbnMuY29uZmlnKHhociwgb3B0aW9ucykKCQkJaWYgKG1heWJlWGhyICE9PSB1bmRlZmluZWQpIHhociA9IG1heWJlWGhyCgkJfQoJCXhoci5zZW5kKG9wdGlvbnMuZGF0YSkKCQlyZXR1cm4geGhyCgl9CglmdW5jdGlvbiBiaW5kRGF0YSh4aHJPcHRpb25zLCBkYXRhLCBzZXJpYWxpemUpIHsKCQlpZiAoZGF0YSAmJiBPYmplY3Qua2V5cyhkYXRhKS5sZW5ndGggPiAwKSB7CgkJCWlmICh4aHJPcHRpb25zLm1ldGhvZCA9PSAiR0VUIikgewoJCQkJeGhyT3B0aW9ucy51cmwgPSB4aHJPcHRpb25zLnVybCArICh4aHJPcHRpb25zLnVybC5pbmRleE9mKCI/IikgPCAwID8gIj8iIDogIiYiKSArIGJ1aWxkUXVlcnlTdHJpbmcoZGF0YSkKCQkJfQoJCQllbHNlIHhock9wdGlvbnMuZGF0YSA9IHNlcmlhbGl6ZShkYXRhKQoJCX0KCQlyZXR1cm4geGhyT3B0aW9ucwoJfQoJZnVuY3Rpb24gcGFyYW1ldGVyaXplVXJsKHVybCwgZGF0YSkgewoJCXZhciB0b2tlbnMgPSB1cmwubWF0Y2goLzpbYS16XVx3Ky9naSkKCQlpZiAodG9rZW5zICYmIGRhdGEpIHsKCQkJZm9yICh2YXIgaSA9IDA7IGkgPCB0b2tlbnMubGVuZ3RoOyBpKyspIHsKCQkJCXZhciBrZXkgPSB0b2tlbnNbaV0uc2xpY2UoMSkKCQkJCXVybCA9IHVybC5yZXBsYWNlKHRva2Vuc1tpXSwgZGF0YVtrZXldKQoJCQkJZGVsZXRlIGRhdGFba2V5XQoJCQl9CgkJfQoJCXJldHVybiB1cmwKCX0KCgltLnJlcXVlc3QgPSBmdW5jdGlvbih4aHJPcHRpb25zKSB7CgkJaWYgKHhock9wdGlvbnMuYmFja2dyb3VuZCAhPT0gdHJ1ZSkgbS5zdGFydENvbXB1dGF0aW9uKCkKCQl2YXIgZGVmZXJyZWQgPSBtLmRlZmVycmVkKCkKCQl2YXIgc2VyaWFsaXplID0geGhyT3B0aW9ucy5zZXJpYWxpemUgPSB4aHJPcHRpb25zLnNlcmlhbGl6ZSB8fCBKU09OLnN0cmluZ2lmeQoJCXZhciBkZXNlcmlhbGl6ZSA9IHhock9wdGlvbnMuZGVzZXJpYWxpemUgPSB4aHJPcHRpb25zLmRlc2VyaWFsaXplIHx8IEpTT04ucGFyc2UKCQl2YXIgZXh0cmFjdCA9IHhock9wdGlvbnMuZXh0cmFjdCB8fCBmdW5jdGlvbih4aHIpIHsKCQkJcmV0dXJuIHhoci5yZXNwb25zZVRleHQubGVuZ3RoID09PSAwICYmIGRlc2VyaWFsaXplID09PSBKU09OLnBhcnNlID8gbnVsbCA6IHhoci5yZXNwb25zZVRleHQKCQl9CgkJeGhyT3B0aW9ucy51cmwgPSBwYXJhbWV0ZXJpemVVcmwoeGhyT3B0aW9ucy51cmwsIHhock9wdGlvbnMuZGF0YSkKCQl4aHJPcHRpb25zID0gYmluZERhdGEoeGhyT3B0aW9ucywgeGhyT3B0aW9ucy5kYXRhLCBzZXJpYWxpemUpCgkJeGhyT3B0aW9ucy5vbmxvYWQgPSB4aHJPcHRpb25zLm9uZXJyb3IgPSBmdW5jdGlvbihlKSB7CgkJCXRyeSB7CgkJCQllID0gZSB8fCBldmVudAoJCQkJdmFyIHVud3JhcCA9IChlLnR5cGUgPT0gImxvYWQiID8geGhyT3B0aW9ucy51bndyYXBTdWNjZXNzIDogeGhyT3B0aW9ucy51bndyYXBFcnJvcikgfHwgaWRlbnRpdHkKCQkJCXZhciByZXNwb25zZSA9IHVud3JhcChkZXNlcmlhbGl6ZShleHRyYWN0KGUudGFyZ2V0LCB4aHJPcHRpb25zKSkpCgkJCQlpZiAoZS50eXBlID09ICJsb2FkIikgewoJCQkJCWlmIChyZXNwb25zZSBpbnN0YW5jZW9mIEFycmF5ICYmIHhock9wdGlvbnMudHlwZSkgewoJCQkJCQlmb3IgKHZhciBpID0gMDsgaSA8IHJlc3BvbnNlLmxlbmd0aDsgaSsrKSByZXNwb25zZVtpXSA9IG5ldyB4aHJPcHRpb25zLnR5cGUocmVzcG9uc2VbaV0pCgkJCQkJfQoJCQkJCWVsc2UgaWYgKHhock9wdGlvbnMudHlwZSkgcmVzcG9uc2UgPSBuZXcgeGhyT3B0aW9ucy50eXBlKHJlc3BvbnNlKQoJCQkJfQoJCQkJZGVmZXJyZWRbZS50eXBlID09ICJsb2FkIiA/ICJyZXNvbHZlIiA6ICJyZWplY3QiXShyZXNwb25zZSkKCQkJfQoJCQljYXRjaCAoZSkgewoJCQkJaWYgKGUgaW5zdGFuY2VvZiBTeW50YXhFcnJvcikgdGhyb3cgbmV3IFN5bnRheEVycm9yKCJDb3VsZCBub3QgcGFyc2UgSFRUUCByZXNwb25zZS4gU2VlIGh0dHA6Ly9saG9yaWUuZ2l0aHViLmlvL21pdGhyaWwvbWl0aHJpbC5yZXF1ZXN0Lmh0bWwjdXNpbmctdmFyaWFibGUtZGF0YS1mb3JtYXRzIikKCQkJCWVsc2UgaWYgKGUgaW5zdGFuY2VvZiBFcnJvciAmJiBlLmNvbnN0cnVjdG9yICE9PSBFcnJvcikgdGhyb3cgZQoJCQkJZWxzZSBkZWZlcnJlZC5yZWplY3QoZSkKCQkJfQoJCQlpZiAoeGhyT3B0aW9ucy5iYWNrZ3JvdW5kICE9PSB0cnVlKSBtLmVuZENvbXB1dGF0aW9uKCkKCQl9CgkJYWpheCh4aHJPcHRpb25zKQoJCXJldHVybiBkZWZlcnJlZC5wcm9taXNlCgl9CgoJLy90ZXN0aW5nIEFQSQoJbS5kZXBzID0gZnVuY3Rpb24obW9jaykge3JldHVybiB3aW5kb3cgPSBtb2NrfQoJLy9mb3IgaW50ZXJuYWwgdGVzdGluZyBvbmx5LCBkbyBub3QgdXNlIGBtLmRlcHMuZmFjdG9yeWAKCW0uZGVwcy5mYWN0b3J5ID0gYXBwCgoJcmV0dXJuIG0KfSh0eXBlb2Ygd2luZG93ICE9ICJ1bmRlZmluZWQiID8gd2luZG93IDoge30pCgppZiAodHlwZW9mIG1vZHVsZSAhPSAidW5kZWZpbmVkIiAmJiBtb2R1bGUgIT09IG51bGwpIG1vZHVsZS5leHBvcnRzID0gbQppZiAodHlwZW9mIGRlZmluZSA9PSAiZnVuY3Rpb24iICYmIGRlZmluZS5hbWQpIGRlZmluZShmdW5jdGlvbigpIHtyZXR1cm4gbX0pCgo7OzsK",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Fri, 07 Nov 2014 16:12:17 GMT",
                    "Content-Length": "23682",
                    "Date": "Fri, 07 Nov 2014 16:12:19 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}