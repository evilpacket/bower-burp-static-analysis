{
    "url": "http://localhost:9999/lhorie/mithril/archive/v0.1.19/mithril-tests.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Link manipulation (DOM-based)",
    "issueType": 5246976,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based link manipulation vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this to a navigation target within the current page, such as a clickable link or the submission URL of a form. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will modify the target of links within the response. An attacker may be able to leverage this to perform various attacks, including:<ul><li>Causing the user to redirect to an arbitrary external URL, to facilitate a phishing attack.</li><li>Causing the user to submit sensitive form data to a server controlled by the attacker.</li><li>Causing the user to perform an unintended action within the application, by changing the file or query string associated with a link.</li><li>Bypassing browser anti-XSS defenses by injecting on-site links containing XSS exploits, since browser anti-XSS defenses typically do not operate on on-site links.</li></ul>",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based link manipulation vulnerabilities is not to dynamically set the target URLs of links or forms using data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing an arbitrary URL as a link target. In general, this is best achieved by using a whitelist of URLs that are permitted link targets, and strictly validating the target against this list before setting the link target.",
    "issueDetail": "The application may be vulnerable to DOM-based link manipulation. Data is read from <b>window.location.pathname</b> and written to <b>the 'href' property of a DOM element</b> via the following statement:<ul><li>element.href = window.location.pathname + modes[m.route.mode] + element.pathname</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/lhorie/mithril/archive/v0.1.19/mithril-tests.js",
                "path": "/lhorie/mithril/archive/v0.1.19/mithril-tests.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9saG9yaWUvbWl0aHJpbC9hcmNoaXZlL3YwLjEuMTkvbWl0aHJpbC10ZXN0cy5qcyBIVFRQLzEuMQ0KSG9zdDogbG9jYWxob3N0Ojk5OTkNCg0K",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogODAyNjENCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IEZyaSwgMDcgTm92IDIwMTQgMTY6MTI6MDcgR01UDQpMYXN0LU1vZGlmaWVkOiBGcmksIDA3IE5vdiAyMDE0IDE2OjEyOjA1IEdNVA0KDQpNaXRocmlsID0gbSA9IG5ldyBmdW5jdGlvbiBhcHAod2luZG93KSB7Cgl2YXIgdHlwZSA9IHt9LnRvU3RyaW5nCgl2YXIgcGFyc2VyID0gLyg/OihefCN8XC4pKFteI1wuXFtcXV0rKSl8KFxbLis/XF0pL2csIGF0dHJQYXJzZXIgPSAvXFsoLis/KSg/Oj0oInwnfCkoLio/KVwyKT9cXS8KCQoJZnVuY3Rpb24gbSgpIHsKCQl2YXIgYXJncyA9IGFyZ3VtZW50cwoJCXZhciBoYXNBdHRycyA9IHR5cGUuY2FsbChhcmdzWzFdKSA9PSAiW29iamVjdCBPYmplY3RdIiAmJiAhKCJ0YWciIGluIGFyZ3NbMV0pICYmICEoInN1YnRyZWUiIGluIGFyZ3NbMV0pCgkJdmFyIGF0dHJzID0gaGFzQXR0cnMgPyBhcmdzWzFdIDoge30KCQl2YXIgY2xhc3NBdHRyTmFtZSA9ICJjbGFzcyIgaW4gYXR0cnMgPyAiY2xhc3MiIDogImNsYXNzTmFtZSIKCQl2YXIgY2VsbCA9IHt0YWc6ICJkaXYiLCBhdHRyczoge319CgkJdmFyIG1hdGNoLCBjbGFzc2VzID0gW10KCQl3aGlsZSAobWF0Y2ggPSBwYXJzZXIuZXhlYyhhcmdzWzBdKSkgewoJCQlpZiAobWF0Y2hbMV0gPT0gIiIpIGNlbGwudGFnID0gbWF0Y2hbMl0KCQkJZWxzZSBpZiAobWF0Y2hbMV0gPT0gIiMiKSBjZWxsLmF0dHJzLmlkID0gbWF0Y2hbMl0KCQkJZWxzZSBpZiAobWF0Y2hbMV0gPT0gIi4iKSBjbGFzc2VzLnB1c2gobWF0Y2hbMl0pCgkJCWVsc2UgaWYgKG1hdGNoWzNdWzBdID09ICJbIikgewoJCQkJdmFyIHBhaXIgPSBhdHRyUGFyc2VyLmV4ZWMobWF0Y2hbM10pCgkJCQljZWxsLmF0dHJzW3BhaXJbMV1dID0gcGFpclszXSB8fCAocGFpclsyXSA/ICIiIDp0cnVlKQoJCQl9CgkJfQoJCWlmIChjbGFzc2VzLmxlbmd0aCA+IDApIGNlbGwuYXR0cnNbY2xhc3NBdHRyTmFtZV0gPSBjbGFzc2VzLmpvaW4oIiAiKQoJCQoJCWNlbGwuY2hpbGRyZW4gPSBoYXNBdHRycyA/IGFyZ3NbMl0gOiBhcmdzWzFdCgkJCgkJZm9yICh2YXIgYXR0ck5hbWUgaW4gYXR0cnMpIHsKCQkJaWYgKGF0dHJOYW1lID09IGNsYXNzQXR0ck5hbWUpIGNlbGwuYXR0cnNbYXR0ck5hbWVdID0gKGNlbGwuYXR0cnNbYXR0ck5hbWVdIHx8ICIiKSArICIgIiArIGF0dHJzW2F0dHJOYW1lXQoJCQllbHNlIGNlbGwuYXR0cnNbYXR0ck5hbWVdID0gYXR0cnNbYXR0ck5hbWVdCgkJfQoJCXJldHVybiBjZWxsCgl9CglmdW5jdGlvbiBidWlsZChwYXJlbnRFbGVtZW50LCBwYXJlbnRUYWcsIHBhcmVudENhY2hlLCBwYXJlbnRJbmRleCwgZGF0YSwgY2FjaGVkLCBzaG91bGRSZWF0dGFjaCwgaW5kZXgsIGVkaXRhYmxlLCBuYW1lc3BhY2UsIGNvbmZpZ3MpIHsKCQlpZiAoZGF0YSA9PT0gbnVsbCB8fCBkYXRhID09PSB1bmRlZmluZWQpIGRhdGEgPSAiIgoJCWlmIChkYXRhLnN1YnRyZWUgPT09ICJyZXRhaW4iKSByZXR1cm4gY2FjaGVkCgoJCXZhciBjYWNoZWRUeXBlID0gdHlwZS5jYWxsKGNhY2hlZCksIGRhdGFUeXBlID0gdHlwZS5jYWxsKGRhdGEpCgkJaWYgKGNhY2hlZFR5cGUgIT0gZGF0YVR5cGUpIHsKCQkJaWYgKGNhY2hlZCAhPT0gbnVsbCAmJiBjYWNoZWQgIT09IHVuZGVmaW5lZCkgewoJCQkJaWYgKHBhcmVudENhY2hlICYmIHBhcmVudENhY2hlLm5vZGVzKSB7CgkJCQkJdmFyIG9mZnNldCA9IGluZGV4IC0gcGFyZW50SW5kZXgKCQkJCQl2YXIgZW5kID0gb2Zmc2V0ICsgKGRhdGFUeXBlID09ICJbb2JqZWN0IEFycmF5XSIgPyBkYXRhIDogY2FjaGVkLm5vZGVzKS5sZW5ndGgKCQkJCQljbGVhcihwYXJlbnRDYWNoZS5ub2Rlcy5zbGljZShvZmZzZXQsIGVuZCksIHBhcmVudENhY2hlLnNsaWNlKG9mZnNldCwgZW5kKSkKCQkJCX0KCQkJCWVsc2UgY2xlYXIoY2FjaGVkLm5vZGVzLCBjYWNoZWQpCgkJCX0KCQkJY2FjaGVkID0gbmV3IGRhdGEuY29uc3RydWN0b3IKCQkJY2FjaGVkLm5vZGVzID0gW10KCQl9CgoJCWlmIChkYXRhVHlwZSA9PSAiW29iamVjdCBBcnJheV0iKSB7CgkJCWRhdGEgPSBmbGF0dGVuKGRhdGEpCgkJCXZhciBub2RlcyA9IFtdLCBpbnRhY3QgPSBjYWNoZWQubGVuZ3RoID09PSBkYXRhLmxlbmd0aCwgc3ViQXJyYXlDb3VudCA9IDAKCQkJCgkJCXZhciBERUxFVElPTiA9IDEsIElOU0VSVElPTiA9IDIgLCBNT1ZFID0gMwoJCQl2YXIgZXhpc3RpbmcgPSB7fSwgdW5rZXllZCA9IFtdLCBzaG91bGRNYWludGFpbklkZW50aXRpZXMgPSBmYWxzZQoJCQlmb3IgKHZhciBpID0gMDsgaSA8IGNhY2hlZC5sZW5ndGg7IGkrKykgewoJCQkJaWYgKGNhY2hlZFtpXSAmJiBjYWNoZWRbaV0uYXR0cnMgJiYgY2FjaGVkW2ldLmF0dHJzLmtleSAhPT0gdW5kZWZpbmVkKSB7CgkJCQkJc2hvdWxkTWFpbnRhaW5JZGVudGl0aWVzID0gdHJ1ZQoJCQkJCWV4aXN0aW5nW2NhY2hlZFtpXS5hdHRycy5rZXldID0ge2FjdGlvbjogREVMRVRJT04sIGluZGV4OiBpfQoJCQkJfQoJCQl9CgkJCWlmIChzaG91bGRNYWludGFpbklkZW50aXRpZXMpIHsKCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkrKykgewoJCQkJCWlmIChkYXRhW2ldICYmIGRhdGFbaV0uYXR0cnMpIHsKCQkJCQkJaWYgKGRhdGFbaV0uYXR0cnMua2V5ICE9PSB1bmRlZmluZWQpIHsKCQkJCQkJCXZhciBrZXkgPSBkYXRhW2ldLmF0dHJzLmtleQoJCQkJCQkJaWYgKCFleGlzdGluZ1trZXldKSBleGlzdGluZ1trZXldID0ge2FjdGlvbjogSU5TRVJUSU9OLCBpbmRleDogaX0KCQkJCQkJCWVsc2UgZXhpc3Rpbmdba2V5XSA9IHthY3Rpb246IE1PVkUsIGluZGV4OiBpLCBmcm9tOiBleGlzdGluZ1trZXldLmluZGV4LCBlbGVtZW50OiBwYXJlbnRFbGVtZW50LmNoaWxkTm9kZXNbZXhpc3Rpbmdba2V5XS5pbmRleF19CgkJCQkJCX0KCQkJCQkJZWxzZSB1bmtleWVkLnB1c2goe2luZGV4OiBpLCBlbGVtZW50OiBwYXJlbnRFbGVtZW50LmNoaWxkTm9kZXNbaV19KQoJCQkJCX0KCQkJCX0KCQkJCXZhciBhY3Rpb25zID0gT2JqZWN0LmtleXMoZXhpc3RpbmcpLm1hcChmdW5jdGlvbihrZXkpIHtyZXR1cm4gZXhpc3Rpbmdba2V5XX0pCgkJCQl2YXIgY2hhbmdlcyA9IGFjdGlvbnMuc29ydChmdW5jdGlvbihhLCBiKSB7cmV0dXJuIGEuYWN0aW9uIC0gYi5hY3Rpb24gfHwgYS5pbmRleCAtIGIuaW5kZXh9KQoJCQkJdmFyIG5ld0NhY2hlZCA9IGNhY2hlZC5zbGljZSgpCgkJCQkKCQkJCWZvciAodmFyIGkgPSAwLCBjaGFuZ2U7IGNoYW5nZSA9IGNoYW5nZXNbaV07IGkrKykgewoJCQkJCWlmIChjaGFuZ2UuYWN0aW9uID09IERFTEVUSU9OKSB7CgkJCQkJCWNsZWFyKGNhY2hlZFtjaGFuZ2UuaW5kZXhdLm5vZGVzLCBjYWNoZWRbY2hhbmdlLmluZGV4XSkKCQkJCQkJbmV3Q2FjaGVkLnNwbGljZShjaGFuZ2UuaW5kZXgsIDEpCgkJCQkJfQoJCQkJCWlmIChjaGFuZ2UuYWN0aW9uID09IElOU0VSVElPTikgewoJCQkJCQl2YXIgZHVtbXkgPSB3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQkJCQkJZHVtbXkua2V5ID0gZGF0YVtjaGFuZ2UuaW5kZXhdLmF0dHJzLmtleQoJCQkJCQlwYXJlbnRFbGVtZW50Lmluc2VydEJlZm9yZShkdW1teSwgcGFyZW50RWxlbWVudC5jaGlsZE5vZGVzW2NoYW5nZS5pbmRleF0pCgkJCQkJCW5ld0NhY2hlZC5zcGxpY2UoY2hhbmdlLmluZGV4LCAwLCB7YXR0cnM6IHtrZXk6IGRhdGFbY2hhbmdlLmluZGV4XS5hdHRycy5rZXl9LCBub2RlczogW2R1bW15XX0pCgkJCQkJfQoJCQkJCQoJCQkJCWlmIChjaGFuZ2UuYWN0aW9uID09IE1PVkUpIHsKCQkJCQkJaWYgKHBhcmVudEVsZW1lbnQuY2hpbGROb2Rlc1tjaGFuZ2UuaW5kZXhdICE9PSBjaGFuZ2UuZWxlbWVudCkgewoJCQkJCQkJcGFyZW50RWxlbWVudC5pbnNlcnRCZWZvcmUoY2hhbmdlLmVsZW1lbnQsIHBhcmVudEVsZW1lbnQuY2hpbGROb2Rlc1tjaGFuZ2UuaW5kZXhdKQoJCQkJCQl9CgkJCQkJCW5ld0NhY2hlZFtjaGFuZ2UuaW5kZXhdID0gY2FjaGVkW2NoYW5nZS5mcm9tXQoJCQkJCX0KCQkJCX0KCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgdW5rZXllZC5sZW5ndGg7IGkrKykgewoJCQkJCXZhciBjaGFuZ2UgPSB1bmtleWVkW2ldCgkJCQkJcGFyZW50RWxlbWVudC5pbnNlcnRCZWZvcmUoY2hhbmdlLmVsZW1lbnQsIHBhcmVudEVsZW1lbnQuY2hpbGROb2Rlc1tjaGFuZ2UuaW5kZXhdKQoJCQkJCW5ld0NhY2hlZFtjaGFuZ2UuaW5kZXhdID0gY2FjaGVkW2NoYW5nZS5pbmRleF0KCQkJCX0KCQkJCWNhY2hlZCA9IG5ld0NhY2hlZAoJCQkJY2FjaGVkLm5vZGVzID0gW10KCQkJCWZvciAodmFyIGkgPSAwLCBjaGlsZDsgY2hpbGQgPSBwYXJlbnRFbGVtZW50LmNoaWxkTm9kZXNbaV07IGkrKykgY2FjaGVkLm5vZGVzLnB1c2goY2hpbGQpCgkJCX0KCQkJCgkJCWZvciAodmFyIGkgPSAwLCBjYWNoZUNvdW50ID0gMDsgaSA8IGRhdGEubGVuZ3RoOyBpKyspIHsKCQkJCXZhciBpdGVtID0gYnVpbGQocGFyZW50RWxlbWVudCwgcGFyZW50VGFnLCBjYWNoZWQsIGluZGV4LCBkYXRhW2ldLCBjYWNoZWRbY2FjaGVDb3VudF0sIHNob3VsZFJlYXR0YWNoLCBpbmRleCArIHN1YkFycmF5Q291bnQgfHwgc3ViQXJyYXlDb3VudCwgZWRpdGFibGUsIG5hbWVzcGFjZSwgY29uZmlncykKCQkJCWlmIChpdGVtID09PSB1bmRlZmluZWQpIGNvbnRpbnVlCgkJCQlpZiAoIWl0ZW0ubm9kZXMuaW50YWN0KSBpbnRhY3QgPSBmYWxzZQoJCQkJdmFyIGlzQXJyYXkgPSBpdGVtIGluc3RhbmNlb2YgQXJyYXkKCQkJCXN1YkFycmF5Q291bnQgKz0gaXNBcnJheSA/IGl0ZW0ubGVuZ3RoIDogMQoJCQkJY2FjaGVkW2NhY2hlQ291bnQrK10gPSBpdGVtCgkJCX0KCQkJaWYgKCFpbnRhY3QpIHsKCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkrKykgewoJCQkJCWlmIChjYWNoZWRbaV0gIT09IHVuZGVmaW5lZCkgbm9kZXMgPSBub2Rlcy5jb25jYXQoY2FjaGVkW2ldLm5vZGVzKQoJCQkJfQoJCQkJZm9yICh2YXIgaSA9IDAsIG5vZGU7IG5vZGUgPSBjYWNoZWQubm9kZXNbaV07IGkrKykgewoJCQkJCWlmIChub2RlLnBhcmVudE5vZGUgIT09IG51bGwgJiYgbm9kZXMuaW5kZXhPZihub2RlKSA8IDApIG5vZGUucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChub2RlKQoJCQkJfQoJCQkJZm9yICh2YXIgaSA9IGNhY2hlZC5ub2Rlcy5sZW5ndGgsIG5vZGU7IG5vZGUgPSBub2Rlc1tpXTsgaSsrKSB7CgkJCQkJaWYgKG5vZGUucGFyZW50Tm9kZSA9PT0gbnVsbCkgcGFyZW50RWxlbWVudC5hcHBlbmRDaGlsZChub2RlKQoJCQkJfQoJCQkJaWYgKGRhdGEubGVuZ3RoIDwgY2FjaGVkLmxlbmd0aCkgY2FjaGVkLmxlbmd0aCA9IGRhdGEubGVuZ3RoCgkJCQljYWNoZWQubm9kZXMgPSBub2RlcwoJCQl9CgkJCQoJCX0KCQllbHNlIGlmIChkYXRhVHlwZSA9PSAiW29iamVjdCBPYmplY3RdIikgewoJCQlpZiAoZGF0YS50YWcgIT0gY2FjaGVkLnRhZyB8fCBPYmplY3Qua2V5cyhkYXRhLmF0dHJzKS5qb2luKCkgIT0gT2JqZWN0LmtleXMoY2FjaGVkLmF0dHJzKS5qb2luKCkgfHwgZGF0YS5hdHRycy5pZCAhPSBjYWNoZWQuYXR0cnMuaWQpIHsKCQkJCWNsZWFyKGNhY2hlZC5ub2RlcykKCQkJCWlmIChjYWNoZWQuY29uZmlnQ29udGV4dCAmJiB0eXBlb2YgY2FjaGVkLmNvbmZpZ0NvbnRleHQub251bmxvYWQgPT0gImZ1bmN0aW9uIikgY2FjaGVkLmNvbmZpZ0NvbnRleHQub251bmxvYWQoKQoJCQl9CgkJCWlmICh0eXBlb2YgZGF0YS50YWcgIT0gInN0cmluZyIpIHJldHVybgoKCQkJdmFyIG5vZGUsIGlzTmV3ID0gY2FjaGVkLm5vZGVzLmxlbmd0aCA9PT0gMAoJCQlpZiAoZGF0YS5hdHRycy54bWxucykgbmFtZXNwYWNlID0gZGF0YS5hdHRycy54bWxucwoJCQllbHNlIGlmIChkYXRhLnRhZyA9PT0gInN2ZyIpIG5hbWVzcGFjZSA9ICJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKCQkJaWYgKGlzTmV3KSB7CgkJCQlub2RlID0gbmFtZXNwYWNlID09PSB1bmRlZmluZWQgPyB3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRWxlbWVudChkYXRhLnRhZykgOiB3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKG5hbWVzcGFjZSwgZGF0YS50YWcpCgkJCQljYWNoZWQgPSB7CgkJCQkJdGFnOiBkYXRhLnRhZywKCQkJCQkvL3Byb2Nlc3MgY2hpbGRyZW4gYmVmb3JlIGF0dHJzIHNvIHRoYXQgc2VsZWN0LnZhbHVlIHdvcmtzIGNvcnJlY3RseQoJCQkJCWNoaWxkcmVuOiBkYXRhLmNoaWxkcmVuICE9PSB1bmRlZmluZWQgPyBidWlsZChub2RlLCBkYXRhLnRhZywgdW5kZWZpbmVkLCB1bmRlZmluZWQsIGRhdGEuY2hpbGRyZW4sIGNhY2hlZC5jaGlsZHJlbiwgdHJ1ZSwgMCwgZGF0YS5hdHRycy5jb250ZW50ZWRpdGFibGUgPyBub2RlIDogZWRpdGFibGUsIG5hbWVzcGFjZSwgY29uZmlncykgOiB1bmRlZmluZWQsCgkJCQkJYXR0cnM6IHNldEF0dHJpYnV0ZXMobm9kZSwgZGF0YS50YWcsIGRhdGEuYXR0cnMsIHt9LCBuYW1lc3BhY2UpLAoJCQkJCW5vZGVzOiBbbm9kZV0KCQkJCX0KCQkJCXBhcmVudEVsZW1lbnQuaW5zZXJ0QmVmb3JlKG5vZGUsIHBhcmVudEVsZW1lbnQuY2hpbGROb2Rlc1tpbmRleF0gfHwgbnVsbCkKCQkJfQoJCQllbHNlIHsKCQkJCW5vZGUgPSBjYWNoZWQubm9kZXNbMF0KCQkJCXNldEF0dHJpYnV0ZXMobm9kZSwgZGF0YS50YWcsIGRhdGEuYXR0cnMsIGNhY2hlZC5hdHRycywgbmFtZXNwYWNlKQoJCQkJY2FjaGVkLmNoaWxkcmVuID0gYnVpbGQobm9kZSwgZGF0YS50YWcsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCBkYXRhLmNoaWxkcmVuLCBjYWNoZWQuY2hpbGRyZW4sIGZhbHNlLCAwLCBkYXRhLmF0dHJzLmNvbnRlbnRlZGl0YWJsZSA/IG5vZGUgOiBlZGl0YWJsZSwgbmFtZXNwYWNlLCBjb25maWdzKQoJCQkJY2FjaGVkLm5vZGVzLmludGFjdCA9IHRydWUKCQkJCWlmIChzaG91bGRSZWF0dGFjaCA9PT0gdHJ1ZSkgcGFyZW50RWxlbWVudC5pbnNlcnRCZWZvcmUobm9kZSwgcGFyZW50RWxlbWVudC5jaGlsZE5vZGVzW2luZGV4XSB8fCBudWxsKQoJCQl9CgkJCWlmICh0eXBlLmNhbGwoZGF0YS5hdHRyc1siY29uZmlnIl0pID09ICJbb2JqZWN0IEZ1bmN0aW9uXSIpIHsKCQkJCWNvbmZpZ3MucHVzaChkYXRhLmF0dHJzWyJjb25maWciXS5iaW5kKHdpbmRvdywgbm9kZSwgIWlzTmV3LCBjYWNoZWQuY29uZmlnQ29udGV4dCA9IGNhY2hlZC5jb25maWdDb250ZXh0IHx8IHt9LCBjYWNoZWQpKQoJCQl9CgkJfQoJCWVsc2UgewoJCQl2YXIgbm9kZXMKCQkJaWYgKGNhY2hlZC5ub2Rlcy5sZW5ndGggPT09IDApIHsKCQkJCWlmIChkYXRhLiR0cnVzdGVkKSB7CgkJCQkJbm9kZXMgPSBpbmplY3RIVE1MKHBhcmVudEVsZW1lbnQsIGluZGV4LCBkYXRhKQoJCQkJfQoJCQkJZWxzZSB7CgkJCQkJbm9kZXMgPSBbd2luZG93LmRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGRhdGEpXQoJCQkJCXBhcmVudEVsZW1lbnQuaW5zZXJ0QmVmb3JlKG5vZGVzWzBdLCBwYXJlbnRFbGVtZW50LmNoaWxkTm9kZXNbaW5kZXhdIHx8IG51bGwpCgkJCQl9CgkJCQljYWNoZWQgPSAic3RyaW5nIG51bWJlciBib29sZWFuIi5pbmRleE9mKHR5cGVvZiBkYXRhKSA+IC0xID8gbmV3IGRhdGEuY29uc3RydWN0b3IoZGF0YSkgOiBkYXRhCgkJCQljYWNoZWQubm9kZXMgPSBub2RlcwoJCQl9CgkJCWVsc2UgaWYgKGNhY2hlZC52YWx1ZU9mKCkgIT09IGRhdGEudmFsdWVPZigpIHx8IHNob3VsZFJlYXR0YWNoID09PSB0cnVlKSB7CgkJCQlub2RlcyA9IGNhY2hlZC5ub2RlcwoJCQkJaWYgKCFlZGl0YWJsZSB8fCBlZGl0YWJsZSAhPT0gd2luZG93LmRvY3VtZW50LmFjdGl2ZUVsZW1lbnQpIHsKCQkJCQlpZiAoZGF0YS4kdHJ1c3RlZCkgewoJCQkJCQljbGVhcihub2RlcywgY2FjaGVkKQoJCQkJCQlub2RlcyA9IGluamVjdEhUTUwocGFyZW50RWxlbWVudCwgaW5kZXgsIGRhdGEpCgkJCQkJfQoJCQkJCWVsc2UgewoJCQkJCQlpZiAocGFyZW50VGFnID09PSAidGV4dGFyZWEiKSBwYXJlbnRFbGVtZW50LnZhbHVlID0gZGF0YQoJCQkJCQllbHNlIGlmIChlZGl0YWJsZSkgZWRpdGFibGUuaW5uZXJIVE1MID0gZGF0YQoJCQkJCQllbHNlIHsKCQkJCQkJCWlmIChub2Rlc1swXS5ub2RlVHlwZSA9PSAxIHx8IG5vZGVzLmxlbmd0aCA+IDEpIHsgLy93YXMgYSB0cnVzdGVkIHN0cmluZwoJCQkJCQkJCWNsZWFyKGNhY2hlZC5ub2RlcywgY2FjaGVkKQoJCQkJCQkJCW5vZGVzID0gW3dpbmRvdy5kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShkYXRhKV0KCQkJCQkJCX0KCQkJCQkJCXBhcmVudEVsZW1lbnQuaW5zZXJ0QmVmb3JlKG5vZGVzWzBdLCBwYXJlbnRFbGVtZW50LmNoaWxkTm9kZXNbaW5kZXhdIHx8IG51bGwpCgkJCQkJCQlub2Rlc1swXS5ub2RlVmFsdWUgPSBkYXRhCgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCQljYWNoZWQgPSBuZXcgZGF0YS5jb25zdHJ1Y3RvcihkYXRhKQoJCQkJY2FjaGVkLm5vZGVzID0gbm9kZXMKCQkJfQoJCQllbHNlIGNhY2hlZC5ub2Rlcy5pbnRhY3QgPSB0cnVlCgkJfQoKCQlyZXR1cm4gY2FjaGVkCgl9CglmdW5jdGlvbiBzZXRBdHRyaWJ1dGVzKG5vZGUsIHRhZywgZGF0YUF0dHJzLCBjYWNoZWRBdHRycywgbmFtZXNwYWNlKSB7CgkJdmFyIGdyb3VwcyA9IHt9CgkJZm9yICh2YXIgYXR0ck5hbWUgaW4gZGF0YUF0dHJzKSB7CgkJCXZhciBkYXRhQXR0ciA9IGRhdGFBdHRyc1thdHRyTmFtZV0KCQkJdmFyIGNhY2hlZEF0dHIgPSBjYWNoZWRBdHRyc1thdHRyTmFtZV0KCQkJaWYgKCEoYXR0ck5hbWUgaW4gY2FjaGVkQXR0cnMpIHx8IChjYWNoZWRBdHRyICE9PSBkYXRhQXR0cikgfHwgbm9kZSA9PT0gd2luZG93LmRvY3VtZW50LmFjdGl2ZUVsZW1lbnQpIHsKCQkJCWNhY2hlZEF0dHJzW2F0dHJOYW1lXSA9IGRhdGFBdHRyCgkJCQlpZiAoYXR0ck5hbWUgPT09ICJjb25maWciKSBjb250aW51ZQoJCQkJZWxzZSBpZiAodHlwZW9mIGRhdGFBdHRyID09ICJmdW5jdGlvbiIgJiYgYXR0ck5hbWUuaW5kZXhPZigib24iKSA9PSAwKSB7CgkJCQkJbm9kZVthdHRyTmFtZV0gPSBhdXRvcmVkcmF3KGRhdGFBdHRyLCBub2RlKQoJCQkJfQoJCQkJZWxzZSBpZiAoYXR0ck5hbWUgPT09ICJzdHlsZSIgJiYgdHlwZW9mIGRhdGFBdHRyID09ICJvYmplY3QiKSB7CgkJCQkJZm9yICh2YXIgcnVsZSBpbiBkYXRhQXR0cikgewoJCQkJCQlpZiAoY2FjaGVkQXR0ciA9PT0gdW5kZWZpbmVkIHx8IGNhY2hlZEF0dHJbcnVsZV0gIT09IGRhdGFBdHRyW3J1bGVdKSBub2RlLnN0eWxlW3J1bGVdID0gZGF0YUF0dHJbcnVsZV0KCQkJCQl9CgkJCQkJZm9yICh2YXIgcnVsZSBpbiBjYWNoZWRBdHRyKSB7CgkJCQkJCWlmICghKHJ1bGUgaW4gZGF0YUF0dHIpKSBub2RlLnN0eWxlW3J1bGVdID0gIiIKCQkJCQl9CgkJCQl9CgkJCQllbHNlIGlmIChuYW1lc3BhY2UgIT09IHVuZGVmaW5lZCkgewoJCQkJCWlmIChhdHRyTmFtZSA9PT0gImhyZWYiKSBub2RlLnNldEF0dHJpYnV0ZU5TKCJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiwgImhyZWYiLCBkYXRhQXR0cikKCQkJCQllbHNlIGlmIChhdHRyTmFtZSA9PT0gImNsYXNzTmFtZSIpIG5vZGUuc2V0QXR0cmlidXRlKCJjbGFzcyIsIGRhdGFBdHRyKQoJCQkJCWVsc2Ugbm9kZS5zZXRBdHRyaWJ1dGUoYXR0ck5hbWUsIGRhdGFBdHRyKQoJCQkJfQoJCQkJZWxzZSBpZiAoYXR0ck5hbWUgPT09ICJ2YWx1ZSIgJiYgdGFnID09PSAiaW5wdXQiKSB7CgkJCQkJaWYgKG5vZGUudmFsdWUgIT09IGRhdGFBdHRyKSBub2RlLnZhbHVlID0gZGF0YUF0dHIKCQkJCX0KCQkJCWVsc2UgaWYgKGF0dHJOYW1lIGluIG5vZGUgJiYgIShhdHRyTmFtZSA9PSAibGlzdCIgfHwgYXR0ck5hbWUgPT0gInN0eWxlIikpIHsKCQkJCQlub2RlW2F0dHJOYW1lXSA9IGRhdGFBdHRyCgkJCQl9CgkJCQllbHNlIG5vZGUuc2V0QXR0cmlidXRlKGF0dHJOYW1lLCBkYXRhQXR0cikKCQkJfQoJCX0KCQlyZXR1cm4gY2FjaGVkQXR0cnMKCX0KCWZ1bmN0aW9uIGNsZWFyKG5vZGVzLCBjYWNoZWQpIHsKCQlmb3IgKHZhciBpID0gbm9kZXMubGVuZ3RoIC0gMTsgaSA+IC0xOyBpLS0pIHsKCQkJaWYgKG5vZGVzW2ldICYmIG5vZGVzW2ldLnBhcmVudE5vZGUpIHsKCQkJCW5vZGVzW2ldLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQobm9kZXNbaV0pCgkJCQljYWNoZWQgPSBbXS5jb25jYXQoY2FjaGVkKQoJCQkJaWYgKGNhY2hlZFtpXSkgdW5sb2FkKGNhY2hlZFtpXSkKCQkJfQoJCX0KCQlpZiAobm9kZXMubGVuZ3RoICE9IDApIG5vZGVzLmxlbmd0aCA9IDAKCX0KCWZ1bmN0aW9uIHVubG9hZChjYWNoZWQpIHsKCQlpZiAoY2FjaGVkLmNvbmZpZ0NvbnRleHQgJiYgdHlwZW9mIGNhY2hlZC5jb25maWdDb250ZXh0Lm9udW5sb2FkID09ICJmdW5jdGlvbiIpIGNhY2hlZC5jb25maWdDb250ZXh0Lm9udW5sb2FkKCkKCQlpZiAoY2FjaGVkLmNoaWxkcmVuKSB7CgkJCWlmIChjYWNoZWQuY2hpbGRyZW4gaW5zdGFuY2VvZiBBcnJheSkgZm9yICh2YXIgaSA9IDA7IGkgPCBjYWNoZWQuY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHVubG9hZChjYWNoZWQuY2hpbGRyZW5baV0pCgkJCWVsc2UgaWYgKGNhY2hlZC5jaGlsZHJlbi50YWcpIHVubG9hZChjYWNoZWQuY2hpbGRyZW4pCgkJfQoJfQoJZnVuY3Rpb24gaW5qZWN0SFRNTChwYXJlbnRFbGVtZW50LCBpbmRleCwgZGF0YSkgewoJCXZhciBuZXh0U2libGluZyA9IHBhcmVudEVsZW1lbnQuY2hpbGROb2Rlc1tpbmRleF0KCQlpZiAobmV4dFNpYmxpbmcpIHsKCQkJdmFyIGlzRWxlbWVudCA9IG5leHRTaWJsaW5nLm5vZGVUeXBlICE9IDEKCQkJdmFyIHBsYWNlaG9sZGVyID0gd2luZG93LmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNwYW4iKQoJCQlpZiAoaXNFbGVtZW50KSB7CgkJCQlwYXJlbnRFbGVtZW50Lmluc2VydEJlZm9yZShwbGFjZWhvbGRlciwgbmV4dFNpYmxpbmcpCgkJCQlwbGFjZWhvbGRlci5pbnNlcnRBZGphY2VudEhUTUwoImJlZm9yZWJlZ2luIiwgZGF0YSkKCQkJCXBhcmVudEVsZW1lbnQucmVtb3ZlQ2hpbGQocGxhY2Vob2xkZXIpCgkJCX0KCQkJZWxzZSBuZXh0U2libGluZy5pbnNlcnRBZGphY2VudEhUTUwoImJlZm9yZWJlZ2luIiwgZGF0YSkKCQl9CgkJZWxzZSBwYXJlbnRFbGVtZW50Lmluc2VydEFkamFjZW50SFRNTCgiYmVmb3JlZW5kIiwgZGF0YSkKCQl2YXIgbm9kZXMgPSBbXQoJCXdoaWxlIChwYXJlbnRFbGVtZW50LmNoaWxkTm9kZXNbaW5kZXhdICE9PSBuZXh0U2libGluZykgewoJCQlub2Rlcy5wdXNoKHBhcmVudEVsZW1lbnQuY2hpbGROb2Rlc1tpbmRleF0pCgkJCWluZGV4KysKCQl9CgkJcmV0dXJuIG5vZGVzCgl9CglmdW5jdGlvbiBmbGF0dGVuKGRhdGEpIHsKCQl2YXIgZmxhdHRlbmVkID0gW10KCQlmb3IgKHZhciBpID0gMDsgaSA8IGRhdGEubGVuZ3RoOyBpKyspIHsKCQkJdmFyIGl0ZW0gPSBkYXRhW2ldCgkJCWlmIChpdGVtIGluc3RhbmNlb2YgQXJyYXkpIGZsYXR0ZW5lZC5wdXNoLmFwcGx5KGZsYXR0ZW5lZCwgZmxhdHRlbihpdGVtKSkKCQkJZWxzZSBmbGF0dGVuZWQucHVzaChpdGVtKQoJCX0KCQlyZXR1cm4gZmxhdHRlbmVkCgl9CglmdW5jdGlvbiBhdXRvcmVkcmF3KGNhbGxiYWNrLCBvYmplY3QsIGdyb3VwKSB7CgkJcmV0dXJuIGZ1bmN0aW9uKGUpIHsKCQkJZSA9IGUgfHwgZXZlbnQKCQkJbS5zdGFydENvbXB1dGF0aW9uKCkKCQkJdHJ5IHtyZXR1cm4gY2FsbGJhY2suY2FsbChvYmplY3QsIGUpfQoJCQlmaW5hbGx5IHsKCQkJCWlmICghbGFzdFJlZHJhd0lkKSBsYXN0UmVkcmF3SWQgPSAtMTsKCQkJCW0uZW5kQ29tcHV0YXRpb24oKQoJCQl9CgkJfQoJfQoKCXZhciBodG1sCgl2YXIgZG9jdW1lbnROb2RlID0gewoJCWluc2VydEFkamFjZW50SFRNTDogZnVuY3Rpb24oXywgZGF0YSkgewoJCQl3aW5kb3cuZG9jdW1lbnQud3JpdGUoZGF0YSkKCQkJd2luZG93LmRvY3VtZW50LmNsb3NlKCkKCQl9LAoJCWFwcGVuZENoaWxkOiBmdW5jdGlvbihub2RlKSB7CgkJCWlmIChodG1sID09PSB1bmRlZmluZWQpIGh0bWwgPSB3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaHRtbCIpCgkJCWlmIChub2RlLm5vZGVOYW1lID09ICJIVE1MIikgaHRtbCA9IG5vZGUKCQkJZWxzZSBodG1sLmFwcGVuZENoaWxkKG5vZGUpCgkJCWlmICh3aW5kb3cuZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50ICYmIHdpbmRvdy5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQgIT09IGh0bWwpIHsKCQkJCXdpbmRvdy5kb2N1bWVudC5yZXBsYWNlQ2hpbGQoaHRtbCwgd2luZG93LmRvY3VtZW50LmRvY3VtZW50RWxlbWVudCkKCQkJfQoJCQllbHNlIHdpbmRvdy5kb2N1bWVudC5hcHBlbmRDaGlsZChodG1sKQoJCX0sCgkJaW5zZXJ0QmVmb3JlOiBmdW5jdGlvbihub2RlKSB7CgkJCXRoaXMuYXBwZW5kQ2hpbGQobm9kZSkKCQl9LAoJCWNoaWxkTm9kZXM6IFtdCgl9Cgl2YXIgbm9kZUNhY2hlID0gW10sIGNlbGxDYWNoZSA9IHt9CgltLnJlbmRlciA9IGZ1bmN0aW9uKHJvb3QsIGNlbGwpIHsKCQl2YXIgY29uZmlncyA9IFtdCgkJaWYgKCFyb290KSB0aHJvdyBuZXcgRXJyb3IoIlBsZWFzZSBlbnN1cmUgdGhlIERPTSBlbGVtZW50IGV4aXN0cyBiZWZvcmUgcmVuZGVyaW5nIGEgdGVtcGxhdGUgaW50byBpdC4iKQoJCXZhciBpZCA9IGdldENlbGxDYWNoZUtleShyb290KQoJCXZhciBub2RlID0gcm9vdCA9PSB3aW5kb3cuZG9jdW1lbnQgfHwgcm9vdCA9PSB3aW5kb3cuZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50ID8gZG9jdW1lbnROb2RlIDogcm9vdAoJCWlmIChjZWxsQ2FjaGVbaWRdID09PSB1bmRlZmluZWQpIGNsZWFyKG5vZGUuY2hpbGROb2RlcykKCQljZWxsQ2FjaGVbaWRdID0gYnVpbGQobm9kZSwgbnVsbCwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIGNlbGwsIGNlbGxDYWNoZVtpZF0sIGZhbHNlLCAwLCBudWxsLCB1bmRlZmluZWQsIGNvbmZpZ3MpCgkJZm9yICh2YXIgaSA9IDA7IGkgPCBjb25maWdzLmxlbmd0aDsgaSsrKSBjb25maWdzW2ldKCkKCX0KCWZ1bmN0aW9uIGdldENlbGxDYWNoZUtleShlbGVtZW50KSB7CgkJdmFyIGluZGV4ID0gbm9kZUNhY2hlLmluZGV4T2YoZWxlbWVudCkKCQlyZXR1cm4gaW5kZXggPCAwID8gbm9kZUNhY2hlLnB1c2goZWxlbWVudCkgLSAxIDogaW5kZXgKCX0KCgltLnRydXN0ID0gZnVuY3Rpb24odmFsdWUpIHsKCQl2YWx1ZSA9IG5ldyBTdHJpbmcodmFsdWUpCgkJdmFsdWUuJHRydXN0ZWQgPSB0cnVlCgkJcmV0dXJuIHZhbHVlCgl9CgoJdmFyIHJvb3RzID0gW10sIG1vZHVsZXMgPSBbXSwgY29udHJvbGxlcnMgPSBbXSwgbGFzdFJlZHJhd0lkID0gMCwgY29tcHV0ZVBvc3RSZWRyYXdIb29rID0gbnVsbAoJbS5tb2R1bGUgPSBmdW5jdGlvbihyb290LCBtb2R1bGUpIHsKCQl2YXIgaW5kZXggPSByb290cy5pbmRleE9mKHJvb3QpCgkJaWYgKGluZGV4IDwgMCkgaW5kZXggPSByb290cy5sZW5ndGgKCQl2YXIgaXNQcmV2ZW50ZWQgPSBmYWxzZQoJCWlmIChjb250cm9sbGVyc1tpbmRleF0gJiYgdHlwZW9mIGNvbnRyb2xsZXJzW2luZGV4XS5vbnVubG9hZCA9PSAiZnVuY3Rpb24iKSB7CgkJCXZhciBldmVudCA9IHsKCQkJCXByZXZlbnREZWZhdWx0OiBmdW5jdGlvbigpIHtpc1ByZXZlbnRlZCA9IHRydWV9CgkJCX0KCQkJY29udHJvbGxlcnNbaW5kZXhdLm9udW5sb2FkKGV2ZW50KQoJCX0KCQlpZiAoIWlzUHJldmVudGVkKSB7CgkJCW0uc3RhcnRDb21wdXRhdGlvbigpCgkJCXJvb3RzW2luZGV4XSA9IHJvb3QKCQkJbW9kdWxlc1tpbmRleF0gPSBtb2R1bGUKCQkJY29udHJvbGxlcnNbaW5kZXhdID0gbmV3IG1vZHVsZS5jb250cm9sbGVyCgkJCW0uZW5kQ29tcHV0YXRpb24oKQoJCX0KCX0KCW0ucmVkcmF3ID0gZnVuY3Rpb24oKSB7CgkJdmFyIGNhbmNlbCA9IHdpbmRvdy5jYW5jZWxBbmltYXRpb25GcmFtZSB8fCB3aW5kb3cuY2xlYXJUaW1lb3V0CgkJdmFyIGRlZmVyID0gd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSB8fCB3aW5kb3cuc2V0VGltZW91dAoJCWlmIChsYXN0UmVkcmF3SWQpIHsKCQkJY2FuY2VsKGxhc3RSZWRyYXdJZCkKCQkJbGFzdFJlZHJhd0lkID0gZGVmZXIocmVkcmF3LCAwKQoJCX0KCQllbHNlIHsKCQkJcmVkcmF3KCkKCQkJbGFzdFJlZHJhd0lkID0gZGVmZXIoZnVuY3Rpb24oKSB7bGFzdFJlZHJhd0lkID0gbnVsbH0sIDApCgkJfQoJfQoJZnVuY3Rpb24gcmVkcmF3KCkgewoJCWZvciAodmFyIGkgPSAwOyBpIDwgcm9vdHMubGVuZ3RoOyBpKyspIHsKCQkJaWYgKGNvbnRyb2xsZXJzW2ldKSBtLnJlbmRlcihyb290c1tpXSwgbW9kdWxlc1tpXS52aWV3KGNvbnRyb2xsZXJzW2ldKSkKCQl9CgkJaWYgKGNvbXB1dGVQb3N0UmVkcmF3SG9vaykgewoJCQljb21wdXRlUG9zdFJlZHJhd0hvb2soKQoJCQljb21wdXRlUG9zdFJlZHJhd0hvb2sgPSBudWxsCgkJfQoJCWxhc3RSZWRyYXdJZCA9IG51bGwKCX0KCgl2YXIgcGVuZGluZ1JlcXVlc3RzID0gMAoJbS5zdGFydENvbXB1dGF0aW9uID0gZnVuY3Rpb24oKSB7cGVuZGluZ1JlcXVlc3RzKyt9CgltLmVuZENvbXB1dGF0aW9uID0gZnVuY3Rpb24oKSB7CgkJcGVuZGluZ1JlcXVlc3RzID0gTWF0aC5tYXgocGVuZGluZ1JlcXVlc3RzIC0gMSwgMCkKCQlpZiAocGVuZGluZ1JlcXVlc3RzID09IDApIG0ucmVkcmF3KCkKCX0KCgltLndpdGhBdHRyID0gZnVuY3Rpb24ocHJvcCwgd2l0aEF0dHJDYWxsYmFjaykgewoJCXJldHVybiBmdW5jdGlvbihlKSB7CgkJCWUgPSBlIHx8IGV2ZW50CgkJCXdpdGhBdHRyQ2FsbGJhY2socHJvcCBpbiBlLmN1cnJlbnRUYXJnZXQgPyBlLmN1cnJlbnRUYXJnZXRbcHJvcF0gOiBlLmN1cnJlbnRUYXJnZXQuZ2V0QXR0cmlidXRlKHByb3ApKQoJCX0KCX0KCgkvL3JvdXRpbmcKCXZhciBtb2RlcyA9IHtwYXRobmFtZTogIiIsIGhhc2g6ICIjIiwgc2VhcmNoOiAiPyJ9Cgl2YXIgcmVkaXJlY3QgPSBmdW5jdGlvbigpIHt9LCByb3V0ZVBhcmFtcyA9IHt9LCBjdXJyZW50Um91dGUKCW0ucm91dGUgPSBmdW5jdGlvbigpIHsKCQlpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMCkgcmV0dXJuIGN1cnJlbnRSb3V0ZQoJCWVsc2UgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDMgJiYgdHlwZW9mIGFyZ3VtZW50c1sxXSA9PSAic3RyaW5nIikgewoJCQl2YXIgcm9vdCA9IGFyZ3VtZW50c1swXSwgZGVmYXVsdFJvdXRlID0gYXJndW1lbnRzWzFdLCByb3V0ZXIgPSBhcmd1bWVudHNbMl0KCQkJcmVkaXJlY3QgPSBmdW5jdGlvbihzb3VyY2UpIHsKCQkJCXZhciBwYXRoID0gY3VycmVudFJvdXRlID0gbm9ybWFsaXplUm91dGUoc291cmNlKQoJCQkJaWYgKCFyb3V0ZUJ5VmFsdWUocm9vdCwgcm91dGVyLCBwYXRoKSkgewoJCQkJCW0ucm91dGUoZGVmYXVsdFJvdXRlLCB0cnVlKQoJCQkJfQoJCQl9CgkJCXZhciBsaXN0ZW5lciA9IG0ucm91dGUubW9kZSA9PSAiaGFzaCIgPyAib25oYXNoY2hhbmdlIiA6ICJvbnBvcHN0YXRlIgoJCQl3aW5kb3dbbGlzdGVuZXJdID0gZnVuY3Rpb24oKSB7CgkJCQlpZiAoY3VycmVudFJvdXRlICE9IG5vcm1hbGl6ZVJvdXRlKHdpbmRvdy5sb2NhdGlvblttLnJvdXRlLm1vZGVdKSkgewoJCQkJCXJlZGlyZWN0KHdpbmRvdy5sb2NhdGlvblttLnJvdXRlLm1vZGVdKQoJCQkJfQoJCQl9CgkJCWNvbXB1dGVQb3N0UmVkcmF3SG9vayA9IHNldFNjcm9sbAoJCQl3aW5kb3dbbGlzdGVuZXJdKCkKCQl9CgkJZWxzZSBpZiAoYXJndW1lbnRzWzBdLmFkZEV2ZW50TGlzdGVuZXIpIHsKCQkJdmFyIGVsZW1lbnQgPSBhcmd1bWVudHNbMF0KCQkJdmFyIGlzSW5pdGlhbGl6ZWQgPSBhcmd1bWVudHNbMV0KCQkJaWYgKGVsZW1lbnQuaHJlZi5pbmRleE9mKG1vZGVzW20ucm91dGUubW9kZV0pIDwgMCkgewoJCQkJZWxlbWVudC5ocmVmID0gd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lICsgbW9kZXNbbS5yb3V0ZS5tb2RlXSArIGVsZW1lbnQucGF0aG5hbWUKCQkJfQoJCQlpZiAoIWlzSW5pdGlhbGl6ZWQpIHsKCQkJCWVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigiY2xpY2siLCByb3V0ZVVub2J0cnVzaXZlKQoJCQkJZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIHJvdXRlVW5vYnRydXNpdmUpCgkJCX0KCQl9CgkJZWxzZSBpZiAodHlwZW9mIGFyZ3VtZW50c1swXSA9PSAic3RyaW5nIikgewoJCQljdXJyZW50Um91dGUgPSBhcmd1bWVudHNbMF0KCQkJdmFyIHF1ZXJ5c3RyaW5nID0gdHlwZW9mIGFyZ3VtZW50c1sxXSA9PSAib2JqZWN0IiA/IGJ1aWxkUXVlcnlTdHJpbmcoYXJndW1lbnRzWzFdKSA6IG51bGwKCQkJaWYgKHF1ZXJ5c3RyaW5nKSBjdXJyZW50Um91dGUgKz0gKGN1cnJlbnRSb3V0ZS5pbmRleE9mKCI/IikgPT09IC0xID8gIj8iIDogIiYiKSArIHF1ZXJ5c3RyaW5nCgoJCQl2YXIgc2hvdWxkUmVwbGFjZUhpc3RvcnlFbnRyeSA9IChhcmd1bWVudHMubGVuZ3RoID09IDMgPyBhcmd1bWVudHNbMl0gOiBhcmd1bWVudHNbMV0pID09PSB0cnVlCgkJCQoJCQlpZiAod2luZG93Lmhpc3RvcnkucHVzaFN0YXRlKSB7CgkJCQljb21wdXRlUG9zdFJlZHJhd0hvb2sgPSBmdW5jdGlvbigpIHsKCQkJCQl3aW5kb3cuaGlzdG9yeVtzaG91bGRSZXBsYWNlSGlzdG9yeUVudHJ5ID8gInJlcGxhY2VTdGF0ZSIgOiAicHVzaFN0YXRlIl0obnVsbCwgd2luZG93LmRvY3VtZW50LnRpdGxlLCBtb2Rlc1ttLnJvdXRlLm1vZGVdICsgY3VycmVudFJvdXRlKQoJCQkJCXNldFNjcm9sbCgpCgkJCQl9CgkJCQlyZWRpcmVjdChtb2Rlc1ttLnJvdXRlLm1vZGVdICsgY3VycmVudFJvdXRlKQoJCQl9CgkJCWVsc2Ugd2luZG93LmxvY2F0aW9uW20ucm91dGUubW9kZV0gPSBjdXJyZW50Um91dGUKCQl9Cgl9CgltLnJvdXRlLnBhcmFtID0gZnVuY3Rpb24oa2V5KSB7cmV0dXJuIHJvdXRlUGFyYW1zW2tleV19CgltLnJvdXRlLm1vZGUgPSAic2VhcmNoIgoJZnVuY3Rpb24gbm9ybWFsaXplUm91dGUocm91dGUpIHtyZXR1cm4gcm91dGUuc2xpY2UobW9kZXNbbS5yb3V0ZS5tb2RlXS5sZW5ndGgpfQoJZnVuY3Rpb24gcm91dGVCeVZhbHVlKHJvb3QsIHJvdXRlciwgcGF0aCkgewoJCXJvdXRlUGFyYW1zID0ge30KCgkJdmFyIHF1ZXJ5U3RhcnQgPSBwYXRoLmluZGV4T2YoIj8iKQoJCWlmIChxdWVyeVN0YXJ0ICE9PSAtMSkgewoJCQlyb3V0ZVBhcmFtcyA9IHBhcnNlUXVlcnlTdHJpbmcocGF0aC5zdWJzdHIocXVlcnlTdGFydCArIDEsIHBhdGgubGVuZ3RoKSkKCQkJcGF0aCA9IHBhdGguc3Vic3RyKDAsIHF1ZXJ5U3RhcnQpCgkJfQoKCQlmb3IgKHZhciByb3V0ZSBpbiByb3V0ZXIpIHsKCQkJaWYgKHJvdXRlID09IHBhdGgpIHsKCQkJCXJlc2V0KHJvb3QpCgkJCQltLm1vZHVsZShyb290LCByb3V0ZXJbcm91dGVdKQoJCQkJcmV0dXJuIHRydWUKCQkJfQoKCQkJdmFyIG1hdGNoZXIgPSBuZXcgUmVnRXhwKCJeIiArIHJvdXRlLnJlcGxhY2UoLzpbXlwvXSs/XC57M30vZywgIiguKj8pIikucmVwbGFjZSgvOlteXC9dKy9nLCAiKFteXFwvXSspIikgKyAiXC8/JCIpCgoJCQlpZiAobWF0Y2hlci50ZXN0KHBhdGgpKSB7CgkJCQlyZXNldChyb290KQoJCQkJcGF0aC5yZXBsYWNlKG1hdGNoZXIsIGZ1bmN0aW9uKCkgewoJCQkJCXZhciBrZXlzID0gcm91dGUubWF0Y2goLzpbXlwvXSsvZykgfHwgW10KCQkJCQl2YXIgdmFsdWVzID0gW10uc2xpY2UuY2FsbChhcmd1bWVudHMsIDEsIC0yKQoJCQkJCWZvciAodmFyIGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykgcm91dGVQYXJhbXNba2V5c1tpXS5yZXBsYWNlKC86fFwuL2csICIiKV0gPSBkZWNvZGVTcGFjZSh2YWx1ZXNbaV0pCgkJCQkJbS5tb2R1bGUocm9vdCwgcm91dGVyW3JvdXRlXSkKCQkJCX0pCgkJCQlyZXR1cm4gdHJ1ZQoJCQl9CgkJfQoJfQoJZnVuY3Rpb24gcmVzZXQocm9vdCkgewoJCXZhciBjYWNoZUtleSA9IGdldENlbGxDYWNoZUtleShyb290KQoJCWNsZWFyKHJvb3QuY2hpbGROb2RlcywgY2VsbENhY2hlW2NhY2hlS2V5XSkKCQljZWxsQ2FjaGVbY2FjaGVLZXldID0gdW5kZWZpbmVkCgl9CglmdW5jdGlvbiByb3V0ZVVub2J0cnVzaXZlKGUpIHsKCQllID0gZSB8fCBldmVudAoJCWlmIChlLmN0cmxLZXkgfHwgZS5tZXRhS2V5IHx8IGUud2hpY2ggPT0gMikgcmV0dXJuCgkJZS5wcmV2ZW50RGVmYXVsdCgpCgkJbS5yb3V0ZShlLmN1cnJlbnRUYXJnZXRbbS5yb3V0ZS5tb2RlXS5zbGljZShtb2Rlc1ttLnJvdXRlLm1vZGVdLmxlbmd0aCkpCgl9CglmdW5jdGlvbiBzZXRTY3JvbGwoKSB7CgkJaWYgKG0ucm91dGUubW9kZSAhPSAiaGFzaCIgJiYgd2luZG93LmxvY2F0aW9uLmhhc2gpIHdpbmRvdy5sb2NhdGlvbi5oYXNoID0gd2luZG93LmxvY2F0aW9uLmhhc2gKCQllbHNlIHdpbmRvdy5zY3JvbGxUbygwLCAwKQoJfQoJZnVuY3Rpb24gYnVpbGRRdWVyeVN0cmluZyhvYmplY3QsIHByZWZpeCkgewoJCXZhciBzdHIgPSBbXQoJCWZvcih2YXIgcHJvcCBpbiBvYmplY3QpIHsKCQkJdmFyIGtleSA9IHByZWZpeCA/IHByZWZpeCArICJbIiArIHByb3AgKyAiXSIgOiBwcm9wLCB2YWx1ZSA9IG9iamVjdFtwcm9wXQoJCQlzdHIucHVzaCh0eXBlb2YgdmFsdWUgPT0gIm9iamVjdCIgPyBidWlsZFF1ZXJ5U3RyaW5nKHZhbHVlLCBrZXkpIDogZW5jb2RlVVJJQ29tcG9uZW50KGtleSkgKyAiPSIgKyBlbmNvZGVVUklDb21wb25lbnQodmFsdWUpKQoJCX0KCQlyZXR1cm4gc3RyLmpvaW4oIiYiKQoJfQoJZnVuY3Rpb24gcGFyc2VRdWVyeVN0cmluZyhzdHIpIHsKCQl2YXIgcGFpcnMgPSBzdHIuc3BsaXQoIiYiKSwgcGFyYW1zID0ge30KCQlmb3IgKHZhciBpID0gMDsgaSA8IHBhaXJzLmxlbmd0aDsgaSsrKSB7CgkJCXZhciBwYWlyID0gcGFpcnNbaV0uc3BsaXQoIj0iKQoJCQlwYXJhbXNbZGVjb2RlU3BhY2UocGFpclswXSldID0gcGFpclsxXSA/IGRlY29kZVNwYWNlKHBhaXJbMV0pIDogKHBhaXIubGVuZ3RoID09PSAxID8gdHJ1ZSA6ICIiKQoJCX0KCQlyZXR1cm4gcGFyYW1zCgl9CglmdW5jdGlvbiBkZWNvZGVTcGFjZShzdHJpbmcpIHsKCQlyZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KHN0cmluZy5yZXBsYWNlKC9cKy9nLCAiICIpKQoJfQoKCS8vbW9kZWwKCW0ucHJvcCA9IGZ1bmN0aW9uKHN0b3JlKSB7CgkJdmFyIHByb3AgPSBmdW5jdGlvbigpIHsKCQkJaWYgKGFyZ3VtZW50cy5sZW5ndGgpIHN0b3JlID0gYXJndW1lbnRzWzBdCgkJCXJldHVybiBzdG9yZQoJCX0KCQlwcm9wLnRvSlNPTiA9IGZ1bmN0aW9uKCkgewoJCQlyZXR1cm4gc3RvcmUKCQl9CgkJcmV0dXJuIHByb3AKCX0KCgl2YXIgbm9uZSA9IHt9CgltLmRlZmVycmVkID0gZnVuY3Rpb24oKSB7CgkJdmFyIHJlc29sdmVycyA9IFtdLCByZWplY3RlcnMgPSBbXSwgcmVzb2x2ZWQgPSBub25lLCByZWplY3RlZCA9IG5vbmUsIHByb21pc2UgPSBtLnByb3AoKQoJCXZhciBvYmplY3QgPSB7CgkJCXJlc29sdmU6IGZ1bmN0aW9uKHZhbHVlKSB7CgkJCQlpZiAocmVzb2x2ZWQgPT09IG5vbmUpIHByb21pc2UocmVzb2x2ZWQgPSB2YWx1ZSkKCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgcmVzb2x2ZXJzLmxlbmd0aDsgaSsrKSByZXNvbHZlcnNbaV0odmFsdWUpCgkJCQlyZXNvbHZlcnMubGVuZ3RoID0gcmVqZWN0ZXJzLmxlbmd0aCA9IDAKCQkJfSwKCQkJcmVqZWN0OiBmdW5jdGlvbih2YWx1ZSkgewoJCQkJaWYgKHJlamVjdGVkID09PSBub25lKSByZWplY3RlZCA9IHZhbHVlCgkJCQlmb3IgKHZhciBpID0gMDsgaSA8IHJlamVjdGVycy5sZW5ndGg7IGkrKykgcmVqZWN0ZXJzW2ldKHZhbHVlKQoJCQkJcmVzb2x2ZXJzLmxlbmd0aCA9IHJlamVjdGVycy5sZW5ndGggPSAwCgkJCX0sCgkJCXByb21pc2U6IHByb21pc2UKCQl9CgkJb2JqZWN0LnByb21pc2UucmVzb2x2ZXJzID0gcmVzb2x2ZXJzCgkJb2JqZWN0LnByb21pc2UudGhlbiA9IGZ1bmN0aW9uKHN1Y2Nlc3MsIGVycm9yKSB7CgkJCXZhciBuZXh0ID0gbS5kZWZlcnJlZCgpCgkJCWlmICghc3VjY2Vzcykgc3VjY2VzcyA9IGlkZW50aXR5CgkJCWlmICghZXJyb3IpIGVycm9yID0gaWRlbnRpdHkKCQkJZnVuY3Rpb24gY2FsbGJhY2sobWV0aG9kLCBjYWxsYmFjaykgewoJCQkJcmV0dXJuIGZ1bmN0aW9uKHZhbHVlKSB7CgkJCQkJdHJ5IHsKCQkJCQkJdmFyIHJlc3VsdCA9IGNhbGxiYWNrKHZhbHVlKQoJCQkJCQlpZiAocmVzdWx0ICYmIHR5cGVvZiByZXN1bHQudGhlbiA9PSAiZnVuY3Rpb24iKSByZXN1bHQudGhlbihuZXh0W21ldGhvZF0sIGVycm9yKQoJCQkJCQllbHNlIG5leHRbbWV0aG9kXShyZXN1bHQgIT09IHVuZGVmaW5lZCA/IHJlc3VsdCA6IHZhbHVlKQoJCQkJCX0KCQkJCQljYXRjaCAoZSkgewoJCQkJCQlpZiAoZSBpbnN0YW5jZW9mIEVycm9yICYmIGUuY29uc3RydWN0b3IgIT09IEVycm9yKSB0aHJvdyBlCgkJCQkJCWVsc2UgbmV4dC5yZWplY3QoZSkKCQkJCQl9CgkJCQl9CgkJCX0KCQkJaWYgKHJlc29sdmVkICE9PSBub25lKSBjYWxsYmFjaygicmVzb2x2ZSIsIHN1Y2Nlc3MpKHJlc29sdmVkKQoJCQllbHNlIGlmIChyZWplY3RlZCAhPT0gbm9uZSkgY2FsbGJhY2soInJlamVjdCIsIGVycm9yKShyZWplY3RlZCkKCQkJZWxzZSB7CgkJCQlyZXNvbHZlcnMucHVzaChjYWxsYmFjaygicmVzb2x2ZSIsIHN1Y2Nlc3MpKQoJCQkJcmVqZWN0ZXJzLnB1c2goY2FsbGJhY2soInJlamVjdCIsIGVycm9yKSkKCQkJfQoJCQlyZXR1cm4gbmV4dC5wcm9taXNlCgkJfQoJCXJldHVybiBvYmplY3QKCX0KCW0uc3luYyA9IGZ1bmN0aW9uKGFyZ3MpIHsKCQl2YXIgbWV0aG9kID0gInJlc29sdmUiCgkJZnVuY3Rpb24gc3luY2hyb25pemVyKHBvcywgcmVzb2x2ZWQpIHsKCQkJcmV0dXJuIGZ1bmN0aW9uKHZhbHVlKSB7CgkJCQlyZXN1bHRzW3Bvc10gPSB2YWx1ZQoJCQkJaWYgKCFyZXNvbHZlZCkgbWV0aG9kID0gInJlamVjdCIKCQkJCWlmICgtLW91dHN0YW5kaW5nID09IDApIHsKCQkJCQlkZWZlcnJlZC5wcm9taXNlKHJlc3VsdHMpCgkJCQkJZGVmZXJyZWRbbWV0aG9kXShyZXN1bHRzKQoJCQkJfQoJCQkJcmV0dXJuIHZhbHVlCgkJCX0KCQl9CgoJCXZhciBkZWZlcnJlZCA9IG0uZGVmZXJyZWQoKQoJCXZhciBvdXRzdGFuZGluZyA9IGFyZ3MubGVuZ3RoCgkJdmFyIHJlc3VsdHMgPSBuZXcgQXJyYXkob3V0c3RhbmRpbmcpCgkJZm9yICh2YXIgaSA9IDA7IGkgPCBhcmdzLmxlbmd0aDsgaSsrKSB7CgkJCWFyZ3NbaV0udGhlbihzeW5jaHJvbml6ZXIoaSwgdHJ1ZSksIHN5bmNocm9uaXplcihpLCBmYWxzZSkpCgkJfQoJCXJldHVybiBkZWZlcnJlZC5wcm9taXNlCgl9CglmdW5jdGlvbiBpZGVudGl0eSh2YWx1ZSkge3JldHVybiB2YWx1ZX0KCglmdW5jdGlvbiBhamF4KG9wdGlvbnMpIHsKCQl2YXIgeGhyID0gbmV3IHdpbmRvdy5YTUxIdHRwUmVxdWVzdAoJCXhoci5vcGVuKG9wdGlvbnMubWV0aG9kLCBvcHRpb25zLnVybCwgdHJ1ZSwgb3B0aW9ucy51c2VyLCBvcHRpb25zLnBhc3N3b3JkKQoJCXhoci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbigpIHsKCQkJaWYgKHhoci5yZWFkeVN0YXRlID09PSA0KSB7CgkJCQlpZiAoeGhyLnN0YXR1cyA+PSAyMDAgJiYgeGhyLnN0YXR1cyA8IDMwMCkgb3B0aW9ucy5vbmxvYWQoe3R5cGU6ICJsb2FkIiwgdGFyZ2V0OiB4aHJ9KQoJCQkJZWxzZSBvcHRpb25zLm9uZXJyb3Ioe3R5cGU6ICJlcnJvciIsIHRhcmdldDogeGhyfSkKCQkJfQoJCX0KCQlpZiAob3B0aW9ucy5zZXJpYWxpemUgPT0gSlNPTi5zdHJpbmdpZnkgJiYgb3B0aW9ucy5tZXRob2QgIT0gIkdFVCIpIHsKCQkJeGhyLnNldFJlcXVlc3RIZWFkZXIoIkNvbnRlbnQtVHlwZSIsICJhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PXV0Zi04Iik7CgkJfQoJCWlmICh0eXBlb2Ygb3B0aW9ucy5jb25maWcgPT0gImZ1bmN0aW9uIikgewoJCQl2YXIgbWF5YmVYaHIgPSBvcHRpb25zLmNvbmZpZyh4aHIsIG9wdGlvbnMpCgkJCWlmIChtYXliZVhociAhPT0gdW5kZWZpbmVkKSB4aHIgPSBtYXliZVhocgoJCX0KCQl4aHIuc2VuZChvcHRpb25zLm1ldGhvZCA9PSAiR0VUIiA/ICIiIDogb3B0aW9ucy5kYXRhKQoJCXJldHVybiB4aHIKCX0KCWZ1bmN0aW9uIGJpbmREYXRhKHhock9wdGlvbnMsIGRhdGEsIHNlcmlhbGl6ZSkgewoJCWlmIChkYXRhICYmIE9iamVjdC5rZXlzKGRhdGEpLmxlbmd0aCA+IDApIHsKCQkJaWYgKHhock9wdGlvbnMubWV0aG9kID09ICJHRVQiKSB7CgkJCQl4aHJPcHRpb25zLnVybCA9IHhock9wdGlvbnMudXJsICsgKHhock9wdGlvbnMudXJsLmluZGV4T2YoIj8iKSA8IDAgPyAiPyIgOiAiJiIpICsgYnVpbGRRdWVyeVN0cmluZyhkYXRhKQoJCQl9CgkJCWVsc2UgeGhyT3B0aW9ucy5kYXRhID0gc2VyaWFsaXplKGRhdGEpCgkJfQoJCXJldHVybiB4aHJPcHRpb25zCgl9CglmdW5jdGlvbiBwYXJhbWV0ZXJpemVVcmwodXJsLCBkYXRhKSB7CgkJdmFyIHRva2VucyA9IHVybC5tYXRjaCgvOlthLXpdXHcrL2dpKQoJCWlmICh0b2tlbnMgJiYgZGF0YSkgewoJCQlmb3IgKHZhciBpID0gMDsgaSA8IHRva2Vucy5sZW5ndGg7IGkrKykgewoJCQkJdmFyIGtleSA9IHRva2Vuc1tpXS5zbGljZSgxKQoJCQkJdXJsID0gdXJsLnJlcGxhY2UodG9rZW5zW2ldLCBkYXRhW2tleV0pCgkJCQlkZWxldGUgZGF0YVtrZXldCgkJCX0KCQl9CgkJcmV0dXJuIHVybAoJfQoKCW0ucmVxdWVzdCA9IGZ1bmN0aW9uKHhock9wdGlvbnMpIHsKCQlpZiAoeGhyT3B0aW9ucy5iYWNrZ3JvdW5kICE9PSB0cnVlKSBtLnN0YXJ0Q29tcHV0YXRpb24oKQoJCXZhciBkZWZlcnJlZCA9IG0uZGVmZXJyZWQoKQoJCXZhciBzZXJpYWxpemUgPSB4aHJPcHRpb25zLnNlcmlhbGl6ZSA9IHhock9wdGlvbnMuc2VyaWFsaXplIHx8IEpTT04uc3RyaW5naWZ5CgkJdmFyIGRlc2VyaWFsaXplID0geGhyT3B0aW9ucy5kZXNlcmlhbGl6ZSA9IHhock9wdGlvbnMuZGVzZXJpYWxpemUgfHwgSlNPTi5wYXJzZQoJCXZhciBleHRyYWN0ID0geGhyT3B0aW9ucy5leHRyYWN0IHx8IGZ1bmN0aW9uKHhocikgewoJCQlyZXR1cm4geGhyLnJlc3BvbnNlVGV4dC5sZW5ndGggPT09IDAgJiYgZGVzZXJpYWxpemUgPT09IEpTT04ucGFyc2UgPyBudWxsIDogeGhyLnJlc3BvbnNlVGV4dAoJCX0KCQl4aHJPcHRpb25zLnVybCA9IHBhcmFtZXRlcml6ZVVybCh4aHJPcHRpb25zLnVybCwgeGhyT3B0aW9ucy5kYXRhKQoJCXhock9wdGlvbnMgPSBiaW5kRGF0YSh4aHJPcHRpb25zLCB4aHJPcHRpb25zLmRhdGEsIHNlcmlhbGl6ZSkKCQl4aHJPcHRpb25zLm9ubG9hZCA9IHhock9wdGlvbnMub25lcnJvciA9IGZ1bmN0aW9uKGUpIHsKCQkJdHJ5IHsKCQkJCWUgPSBlIHx8IGV2ZW50CgkJCQl2YXIgdW53cmFwID0gKGUudHlwZSA9PSAibG9hZCIgPyB4aHJPcHRpb25zLnVud3JhcFN1Y2Nlc3MgOiB4aHJPcHRpb25zLnVud3JhcEVycm9yKSB8fCBpZGVudGl0eQoJCQkJdmFyIHJlc3BvbnNlID0gdW53cmFwKGRlc2VyaWFsaXplKGV4dHJhY3QoZS50YXJnZXQsIHhock9wdGlvbnMpKSkKCQkJCWlmIChlLnR5cGUgPT0gImxvYWQiKSB7CgkJCQkJaWYgKHJlc3BvbnNlIGluc3RhbmNlb2YgQXJyYXkgJiYgeGhyT3B0aW9ucy50eXBlKSB7CgkJCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgcmVzcG9uc2UubGVuZ3RoOyBpKyspIHJlc3BvbnNlW2ldID0gbmV3IHhock9wdGlvbnMudHlwZShyZXNwb25zZVtpXSkKCQkJCQl9CgkJCQkJZWxzZSBpZiAoeGhyT3B0aW9ucy50eXBlKSByZXNwb25zZSA9IG5ldyB4aHJPcHRpb25zLnR5cGUocmVzcG9uc2UpCgkJCQl9CgkJCQlkZWZlcnJlZFtlLnR5cGUgPT0gImxvYWQiID8gInJlc29sdmUiIDogInJlamVjdCJdKHJlc3BvbnNlKQoJCQl9CgkJCWNhdGNoIChlKSB7CgkJCQlpZiAoZSBpbnN0YW5jZW9mIFN5bnRheEVycm9yKSB0aHJvdyBuZXcgU3ludGF4RXJyb3IoIkNvdWxkIG5vdCBwYXJzZSBIVFRQIHJlc3BvbnNlLiBTZWUgaHR0cDovL2xob3JpZS5naXRodWIuaW8vbWl0aHJpbC9taXRocmlsLnJlcXVlc3QuaHRtbCN1c2luZy12YXJpYWJsZS1kYXRhLWZvcm1hdHMiKQoJCQkJZWxzZSBpZiAoZSBpbnN0YW5jZW9mIEVycm9yICYmIGUuY29uc3RydWN0b3IgIT09IEVycm9yKSB0aHJvdyBlCgkJCQllbHNlIGRlZmVycmVkLnJlamVjdChlKQoJCQl9CgkJCWlmICh4aHJPcHRpb25zLmJhY2tncm91bmQgIT09IHRydWUpIG0uZW5kQ29tcHV0YXRpb24oKQoJCX0KCQlhamF4KHhock9wdGlvbnMpCgkJcmV0dXJuIGRlZmVycmVkLnByb21pc2UKCX0KCgkvL3Rlc3RpbmcgQVBJCgltLmRlcHMgPSBmdW5jdGlvbihtb2NrKSB7cmV0dXJuIHdpbmRvdyA9IG1vY2t9CgkvL2ZvciBpbnRlcm5hbCB0ZXN0aW5nIG9ubHksIGRvIG5vdCB1c2UgYG0uZGVwcy5mYWN0b3J5YAoJbS5kZXBzLmZhY3RvcnkgPSBhcHAKCglyZXR1cm4gbQp9KHR5cGVvZiB3aW5kb3cgIT0gInVuZGVmaW5lZCIgPyB3aW5kb3cgOiB7fSkKCmlmICh0eXBlb2YgbW9kdWxlICE9ICJ1bmRlZmluZWQiICYmIG1vZHVsZSAhPT0gbnVsbCkgbW9kdWxlLmV4cG9ydHMgPSBtCmlmICh0eXBlb2YgZGVmaW5lID09ICJmdW5jdGlvbiIgJiYgZGVmaW5lLmFtZCkgZGVmaW5lKGZ1bmN0aW9uKCkge3JldHVybiBtfSkKCjs7OwoKZnVuY3Rpb24gdGVzdChjb25kaXRpb24pIHsKCXRyeSB7aWYgKCFjb25kaXRpb24oKSkgdGhyb3cgbmV3IEVycm9yfQoJY2F0Y2ggKGUpIHtjb25zb2xlLmVycm9yKGUpO3Rlc3QuZmFpbHVyZXMucHVzaChjb25kaXRpb24pfQoJdGVzdC50b3RhbCsrCn0KdGVzdC50b3RhbCA9IDAKdGVzdC5mYWlsdXJlcyA9IFtdCnRlc3QucHJpbnQgPSBmdW5jdGlvbihwcmludCkgewoJZm9yICh2YXIgaSA9IDA7IGkgPCB0ZXN0LmZhaWx1cmVzLmxlbmd0aDsgaSsrKSB7CgkJcHJpbnQodGVzdC5mYWlsdXJlc1tpXS50b1N0cmluZygpKQoJfQoJcHJpbnQoInRlc3RzOiAiICsgdGVzdC50b3RhbCArICJcbmZhaWx1cmVzOiAiICsgdGVzdC5mYWlsdXJlcy5sZW5ndGgpCgoJaWYgKHRlc3QuZmFpbHVyZXMubGVuZ3RoID4gMCkgewoJCXRocm93IG5ldyBFcnJvcih0ZXN0LmZhaWx1cmVzLmxlbmd0aCArICIgdGVzdHMgZGlkIG5vdCBwYXNzIikKCX0KfQoKdmFyIG1vY2sgPSB7fQptb2NrLndpbmRvdyA9IG5ldyBmdW5jdGlvbigpIHsKCXZhciB3aW5kb3cgPSB7fQoJd2luZG93LmRvY3VtZW50ID0ge30KCXdpbmRvdy5kb2N1bWVudC5jaGlsZE5vZGVzID0gW10KCXdpbmRvdy5kb2N1bWVudC5jcmVhdGVFbGVtZW50ID0gZnVuY3Rpb24odGFnKSB7CgkJcmV0dXJuIHsKCQkJc3R5bGU6IHt9LAoJCQljaGlsZE5vZGVzOiBbXSwKCQkJbm9kZVR5cGU6IDEsCgkJCW5vZGVOYW1lOiB0YWcudG9VcHBlckNhc2UoKSwKCQkJYXBwZW5kQ2hpbGQ6IHdpbmRvdy5kb2N1bWVudC5hcHBlbmRDaGlsZCwKCQkJcmVtb3ZlQ2hpbGQ6IHdpbmRvdy5kb2N1bWVudC5yZW1vdmVDaGlsZCwKCQkJcmVwbGFjZUNoaWxkOiB3aW5kb3cuZG9jdW1lbnQucmVwbGFjZUNoaWxkLAoJCQlpbnNlcnRCZWZvcmU6IGZ1bmN0aW9uKG5vZGUsIHJlZmVyZW5jZSkgewoJCQkJbm9kZS5wYXJlbnROb2RlID0gdGhpcwoJCQkJdmFyIHJlZmVyZW5jZUluZGV4ID0gdGhpcy5jaGlsZE5vZGVzLmluZGV4T2YocmVmZXJlbmNlKQoJCQkJaWYgKHJlZmVyZW5jZUluZGV4IDwgMCkgdGhpcy5jaGlsZE5vZGVzLnB1c2gobm9kZSkKCQkJCWVsc2UgewoJCQkJCXZhciBpbmRleCA9IHRoaXMuY2hpbGROb2Rlcy5pbmRleE9mKG5vZGUpCgkJCQkJaWYgKGluZGV4ID4gLTEpIHRoaXMuY2hpbGROb2Rlcy5zcGxpY2UoaW5kZXgsIDEpCgkJCQkJdGhpcy5jaGlsZE5vZGVzLnNwbGljZShyZWZlcmVuY2VJbmRleCwgMCwgbm9kZSkKCQkJCX0KCQkJfSwKCQkJaW5zZXJ0QWRqYWNlbnRIVE1MOiBmdW5jdGlvbihwb3NpdGlvbiwgaHRtbCkgewoJCQkJLy90b2RvOiBhY2NlcHQgbWFya3VwCgkJCQlpZiAocG9zaXRpb24gPT0gImJlZm9yZWJlZ2luIikgewoJCQkJCXRoaXMucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUod2luZG93LmRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGh0bWwpLCB0aGlzKQoJCQkJfQoJCQkJZWxzZSBpZiAocG9zaXRpb24gPT0gImJlZm9yZWVuZCIpIHsKCQkJCQl0aGlzLmFwcGVuZENoaWxkKHdpbmRvdy5kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShodG1sKSkKCQkJCX0KCQkJfSwKCQkJc2V0QXR0cmlidXRlOiBmdW5jdGlvbihuYW1lLCB2YWx1ZSkgewoJCQkJdGhpc1tuYW1lXSA9IHZhbHVlLnRvU3RyaW5nKCkKCQkJfSwKCQkJc2V0QXR0cmlidXRlTlM6IGZ1bmN0aW9uKG5hbWVzcGFjZSwgbmFtZSwgdmFsdWUpIHsKCQkJCXRoaXMubmFtZXNwYWNlVVJJID0gbmFtZXNwYWNlCgkJCQl0aGlzW25hbWVdID0gdmFsdWUudG9TdHJpbmcoKQoJCQl9LAoJCQlnZXRBdHRyaWJ1dGU6IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7CgkJCQlyZXR1cm4gdGhpc1tuYW1lXQoJCQl9CgkJfQoJfQoJd2luZG93LmRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyA9IGZ1bmN0aW9uKG5hbWVzcGFjZSwgdGFnKSB7CgkJdmFyIGVsZW1lbnQgPSB3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpCgkJZWxlbWVudC5uYW1lc3BhY2VVUkkgPSBuYW1lc3BhY2UKCQlyZXR1cm4gZWxlbWVudAoJfQoJd2luZG93LmRvY3VtZW50LmNyZWF0ZVRleHROb2RlID0gZnVuY3Rpb24odGV4dCkgewoJCXJldHVybiB7bm9kZVZhbHVlOiB0ZXh0LnRvU3RyaW5nKCl9Cgl9Cgl3aW5kb3cuZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50ID0gd2luZG93LmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImh0bWwiKQoJd2luZG93LmRvY3VtZW50LnJlcGxhY2VDaGlsZCA9IGZ1bmN0aW9uKG5ld0NoaWxkLCBvbGRDaGlsZCkgewoJCXZhciBpbmRleCA9IHRoaXMuY2hpbGROb2Rlcy5pbmRleE9mKG9sZENoaWxkKQoJCWlmIChpbmRleCA+IC0xKSB0aGlzLmNoaWxkTm9kZXMuc3BsaWNlKGluZGV4LCAxLCBuZXdDaGlsZCkKCQllbHNlIHRoaXMuY2hpbGROb2Rlcy5wdXNoKG5ld0NoaWxkKQoJCW5ld0NoaWxkLnBhcmVudE5vZGUgPSB0aGlzCgkJb2xkQ2hpbGQucGFyZW50Tm9kZSA9IG51bGwKCX0KCXdpbmRvdy5kb2N1bWVudC5hcHBlbmRDaGlsZCA9IGZ1bmN0aW9uKGNoaWxkKSB7CgkJdmFyIGluZGV4ID0gdGhpcy5jaGlsZE5vZGVzLmluZGV4T2YoY2hpbGQpCgkJaWYgKGluZGV4ID4gLTEpIHRoaXMuY2hpbGROb2Rlcy5zcGxpY2UoaW5kZXgsIDEpCgkJdGhpcy5jaGlsZE5vZGVzLnB1c2goY2hpbGQpCgkJY2hpbGQucGFyZW50Tm9kZSA9IHRoaXMKCX0KCXdpbmRvdy5kb2N1bWVudC5yZW1vdmVDaGlsZCA9IGZ1bmN0aW9uKGNoaWxkKSB7CgkJdmFyIGluZGV4ID0gdGhpcy5jaGlsZE5vZGVzLmluZGV4T2YoY2hpbGQpCgkJdGhpcy5jaGlsZE5vZGVzLnNwbGljZShpbmRleCwgMSkKCQljaGlsZC5wYXJlbnROb2RlID0gbnVsbAoJfQoJd2luZG93LnNjcm9sbFRvID0gZnVuY3Rpb24oKSB7fQoJd2luZG93LmNhbmNlbEFuaW1hdGlvbkZyYW1lID0gZnVuY3Rpb24oKSB7fQoJd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7CgkJd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZS4kY2FsbGJhY2sgPSBjYWxsYmFjawoJCXJldHVybiB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRpZCsrCgl9Cgl3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRpZCA9IDEKCXdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUgPSBmdW5jdGlvbigpIHsKCQlpZiAod2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZS4kY2FsbGJhY2spIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJGNhbGxiYWNrKCkKCQl3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRjYWxsYmFjayA9IG51bGwKCX0KCXdpbmRvdy5YTUxIdHRwUmVxdWVzdCA9IG5ldyBmdW5jdGlvbigpIHsKCQl2YXIgcmVxdWVzdCA9IGZ1bmN0aW9uKCkgewoJCQl0aGlzLiRoZWFkZXJzID0ge30KCQkJdGhpcy5zZXRSZXF1ZXN0SGVhZGVyID0gZnVuY3Rpb24oa2V5LCB2YWx1ZSkgewoJCQkJdGhpcy4kaGVhZGVyc1trZXldID0gdmFsdWUKCQkJfQoJCQl0aGlzLm9wZW4gPSBmdW5jdGlvbihtZXRob2QsIHVybCkgewoJCQkJdGhpcy5tZXRob2QgPSBtZXRob2QKCQkJCXRoaXMudXJsID0gdXJsCgkJCX0KCQkJdGhpcy5zZW5kID0gZnVuY3Rpb24oKSB7CgkJCQl0aGlzLnJlc3BvbnNlVGV4dCA9IEpTT04uc3RyaW5naWZ5KHRoaXMpCgkJCQl0aGlzLnJlYWR5U3RhdGUgPSA0CgkJCQl0aGlzLnN0YXR1cyA9IDIwMAoJCQkJcmVxdWVzdC4kaW5zdGFuY2VzLnB1c2godGhpcykKCQkJfQoJCX0KCQlyZXF1ZXN0LiRpbnN0YW5jZXMgPSBbXQoJCXJldHVybiByZXF1ZXN0Cgl9Cgl3aW5kb3cubG9jYXRpb24gPSB7c2VhcmNoOiAiIiwgcGF0aG5hbWU6ICIiLCBoYXNoOiAiIn0sCgl3aW5kb3cuaGlzdG9yeSA9IHt9Cgl3aW5kb3cuaGlzdG9yeS5wdXNoU3RhdGUgPSBmdW5jdGlvbihkYXRhLCB0aXRsZSwgdXJsKSB7CgkJd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lID0gd2luZG93LmxvY2F0aW9uLnNlYXJjaCA9IHdpbmRvdy5sb2NhdGlvbi5oYXNoID0gdXJsCgl9LAoJd2luZG93Lmhpc3RvcnkucmVwbGFjZVN0YXRlID0gZnVuY3Rpb24oZGF0YSwgdGl0bGUsIHVybCkgewoJCXdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSA9IHdpbmRvdy5sb2NhdGlvbi5zZWFyY2ggPSB3aW5kb3cubG9jYXRpb24uaGFzaCA9IHVybAoJfQoJcmV0dXJuIHdpbmRvdwp9CmZ1bmN0aW9uIHRlc3RNaXRocmlsKG1vY2spIHsKCW0uZGVwcyhtb2NrKQoKCS8vbQoJdGVzdChmdW5jdGlvbigpIHtyZXR1cm4gbSgiZGl2IikudGFnID09PSAiZGl2In0pCgl0ZXN0KGZ1bmN0aW9uKCkge3JldHVybiBtKCIuZm9vIikudGFnID09PSAiZGl2In0pCgl0ZXN0KGZ1bmN0aW9uKCkge3JldHVybiBtKCIuZm9vIikuYXR0cnMuY2xhc3NOYW1lID09PSAiZm9vIn0pCgl0ZXN0KGZ1bmN0aW9uKCkge3JldHVybiBtKCJbdGl0bGU9YmFyXSIpLnRhZyA9PT0gImRpdiJ9KQoJdGVzdChmdW5jdGlvbigpIHtyZXR1cm4gbSgiW3RpdGxlPWJhcl0iKS5hdHRycy50aXRsZSA9PT0gImJhciJ9KQoJdGVzdChmdW5jdGlvbigpIHtyZXR1cm4gbSgiW3RpdGxlPVwnYmFyXCddIikuYXR0cnMudGl0bGUgPT09ICJiYXIifSkKCXRlc3QoZnVuY3Rpb24oKSB7cmV0dXJuIG0oIlt0aXRsZT1cImJhclwiXSIpLmF0dHJzLnRpdGxlID09PSAiYmFyIn0pCgl0ZXN0KGZ1bmN0aW9uKCkge3JldHVybiBtKCJkaXYiLCAidGVzdCIpLmNoaWxkcmVuID09PSAidGVzdCJ9KQoJdGVzdChmdW5jdGlvbigpIHtyZXR1cm4gbSgiZGl2IiwgWyJ0ZXN0Il0pLmNoaWxkcmVuWzBdID09PSAidGVzdCJ9KQoJdGVzdChmdW5jdGlvbigpIHtyZXR1cm4gbSgiZGl2Iiwge3RpdGxlOiAiYmFyIn0sICJ0ZXN0IikuYXR0cnMudGl0bGUgPT09ICJiYXIifSkKCXRlc3QoZnVuY3Rpb24oKSB7cmV0dXJuIG0oImRpdiIsIHt0aXRsZTogImJhciJ9LCAidGVzdCIpLmNoaWxkcmVuID09PSAidGVzdCJ9KQoJdGVzdChmdW5jdGlvbigpIHtyZXR1cm4gbSgiZGl2Iiwge3RpdGxlOiAiYmFyIn0sIFsidGVzdCJdKS5jaGlsZHJlblswXSA9PT0gInRlc3QifSkKCXRlc3QoZnVuY3Rpb24oKSB7cmV0dXJuIG0oImRpdiIsIHt0aXRsZTogImJhciJ9LCBtKCJkaXYiKSkuY2hpbGRyZW4udGFnID09PSAiZGl2In0pCgl0ZXN0KGZ1bmN0aW9uKCkge3JldHVybiBtKCJkaXYiLCB7dGl0bGU6ICJiYXIifSwgW20oImRpdiIpXSkuY2hpbGRyZW5bMF0udGFnID09PSAiZGl2In0pCgl0ZXN0KGZ1bmN0aW9uKCkge3JldHVybiBtKCJkaXYiLCBbImEiLCAiYiJdKS5jaGlsZHJlbi5sZW5ndGggPT09IDJ9KQoJdGVzdChmdW5jdGlvbigpIHtyZXR1cm4gbSgiZGl2IiwgW20oImRpdiIpXSkuY2hpbGRyZW5bMF0udGFnID09PSAiZGl2In0pCgl0ZXN0KGZ1bmN0aW9uKCkge3JldHVybiBtKCJkaXYiLCBtKCJkaXYiKSkuY2hpbGRyZW4udGFnID09PSAiZGl2In0pIC8veWVzLCB0aGlzIGlzIGV4cGVjdGVkIGJlaGF2aW9yOiBzZWUgbWV0aG9kIHNpZ25hdHVyZQoJdGVzdChmdW5jdGlvbigpIHtyZXR1cm4gbSgiZGl2IiwgW3VuZGVmaW5lZF0pLnRhZyA9PT0gImRpdiJ9KQoJdGVzdChmdW5jdGlvbigpIHtyZXR1cm4gbSgiZGl2IiwgW3tmb286ICJiYXIifV0pfSkgLy9hcyBsb25nIGFzIGl0IGRvZXNuJ3QgdGhyb3cgZXJyb3JzLCBpdCdzIGZpbmUKCXRlc3QoZnVuY3Rpb24oKSB7cmV0dXJuIG0oInN2ZyIsIFttKCJnIildKX0pCgl0ZXN0KGZ1bmN0aW9uKCkge3JldHVybiBtKCJzdmciLCBbbSgiYVtocmVmPSdodHRwOi8vZ29vZ2xlLmNvbSddIildKX0pCgl0ZXN0KGZ1bmN0aW9uKCkge3JldHVybiBtKCIuZm9vIiwge2NsYXNzOiAiYmFyIn0pLmF0dHJzLmNsYXNzID09ICJmb28gYmFyIn0pCgl0ZXN0KGZ1bmN0aW9uKCkge3JldHVybiBtKCIuZm9vIiwge2NsYXNzTmFtZTogImJhciJ9KS5hdHRycy5jbGFzc05hbWUgPT0gImZvbyBiYXIifSkKCgkvL20ubW9kdWxlCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkKCgkJdmFyIHJvb3QxID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ubW9kdWxlKHJvb3QxLCB7CgkJCWNvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge3RoaXMudmFsdWUgPSAidGVzdDEifSwKCQkJdmlldzogZnVuY3Rpb24oY3RybCkge3JldHVybiBjdHJsLnZhbHVlfQoJCX0pCgoJCXZhciByb290MiA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLm1vZHVsZShyb290MiwgewoJCQljb250cm9sbGVyOiBmdW5jdGlvbigpIHt0aGlzLnZhbHVlID0gInRlc3QyIn0sCgkJCXZpZXc6IGZ1bmN0aW9uKGN0cmwpIHtyZXR1cm4gY3RybC52YWx1ZX0KCQl9KQoKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpCgoJCXJldHVybiByb290MS5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZSA9PT0gInRlc3QxIiAmJiByb290Mi5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZSA9PT0gInRlc3QyIgoJfSkKCgkvL20ud2l0aEF0dHIKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHZhbHVlCgkJdmFyIGhhbmRsZXIgPSBtLndpdGhBdHRyKCJ0ZXN0IiwgZnVuY3Rpb24oZGF0YSkge3ZhbHVlID0gZGF0YX0pCgkJaGFuZGxlcih7Y3VycmVudFRhcmdldDoge3Rlc3Q6ICJmb28ifX0pCgkJcmV0dXJuIHZhbHVlID09PSAiZm9vIgoJfSkKCgkvL20udHJ1c3QKCXRlc3QoZnVuY3Rpb24oKSB7cmV0dXJuIG0udHJ1c3QoInRlc3QiKS52YWx1ZU9mKCkgPT09ICJ0ZXN0In0pCgoJLy9tLnJlbmRlcgoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCAidGVzdCIpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5ub2RlVmFsdWUgPT09ICJ0ZXN0IgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2Iiwge2NsYXNzOiAiYSJ9KSkKCQl2YXIgZWxlbWVudEJlZm9yZSA9IHJvb3QuY2hpbGROb2Rlc1swXQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIHtjbGFzczogImIifSkpCgkJdmFyIGVsZW1lbnRBZnRlciA9IHJvb3QuY2hpbGROb2Rlc1swXQoJCXJldHVybiBlbGVtZW50QmVmb3JlID09PSBlbGVtZW50QWZ0ZXIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oIi5hIikpCgkJdmFyIGVsZW1lbnRCZWZvcmUgPSByb290LmNoaWxkTm9kZXNbMF0KCQltLnJlbmRlcihyb290LCBtKCIuYiIpKQoJCXZhciBlbGVtZW50QWZ0ZXIgPSByb290LmNoaWxkTm9kZXNbMF0KCQlyZXR1cm4gZWxlbWVudEJlZm9yZSA9PT0gZWxlbWVudEFmdGVyCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCB7aWQ6ICJhIn0pKQoJCXZhciBlbGVtZW50QmVmb3JlID0gcm9vdC5jaGlsZE5vZGVzWzBdCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2Iiwge3RpdGxlOiAiYiJ9KSkKCQl2YXIgZWxlbWVudEFmdGVyID0gcm9vdC5jaGlsZE5vZGVzWzBdCgkJcmV0dXJuIGVsZW1lbnRCZWZvcmUgIT09IGVsZW1lbnRBZnRlcgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgiI2EiKSkKCQl2YXIgZWxlbWVudEJlZm9yZSA9IHJvb3QuY2hpbGROb2Rlc1swXQoJCW0ucmVuZGVyKHJvb3QsIG0oIlt0aXRsZT1iXSIpKQoJCXZhciBlbGVtZW50QWZ0ZXIgPSByb290LmNoaWxkTm9kZXNbMF0KCQlyZXR1cm4gZWxlbWVudEJlZm9yZSAhPT0gZWxlbWVudEFmdGVyCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCIjYSIpKQoJCXZhciBlbGVtZW50QmVmb3JlID0gcm9vdC5jaGlsZE5vZGVzWzBdCgkJbS5yZW5kZXIocm9vdCwgInRlc3QiKQoJCXZhciBlbGVtZW50QWZ0ZXIgPSByb290LmNoaWxkTm9kZXNbMF0KCQlyZXR1cm4gZWxlbWVudEJlZm9yZSAhPT0gZWxlbWVudEFmdGVyCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCBbdW5kZWZpbmVkXSkpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZSA9PT0gIiIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oInN2ZyIsIFttKCJnIildKSkKCQl2YXIgZyA9IHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzBdCgkJcmV0dXJuIGcubm9kZU5hbWUgPT09ICJHIiAmJiBnLm5hbWVzcGFjZVVSSSA9PSAiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCJzdmciLCBbbSgiYVtocmVmPSdodHRwOi8vZ29vZ2xlLmNvbSddIildKSkKCQlyZXR1cm4gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMF0ubm9kZU5hbWUgPT09ICJBIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2LmNsYXNzbmFtZSIsIFttKCJhIiwge2hyZWY6ICIvZmlyc3QifSldKSkKCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCBbbSgiYSIsIHtocmVmOiAiL3NlY29uZCJ9KV0pKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlcy5sZW5ndGggPT0gMQoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgidWwiLCBbbSgibGkiKV0pKQoJCW0ucmVuZGVyKHJvb3QsIG0oInVsIiwgW20oImxpIiksIHVuZGVmaW5lZF0pKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1sxXS5ub2RlVmFsdWUgPT09ICIiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCJ1bCIsIFttKCJsaSIpLCBtKCJsaSIpXSkpCgkJbS5yZW5kZXIocm9vdCwgbSgidWwiLCBbbSgibGkiKSwgdW5kZWZpbmVkXSkpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzLmxlbmd0aCA9PSAyICYmIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzFdLm5vZGVWYWx1ZSA9PT0gIiIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oInVsIiwgW20oImxpIildKSkKCQltLnJlbmRlcihyb290LCBtKCJ1bCIsIFt1bmRlZmluZWRdKSkKCQlyZXR1cm4gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlID09PSAiIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgidWwiLCBbbSgibGkiKV0pKQoJCW0ucmVuZGVyKHJvb3QsIG0oInVsIiwgW3t9XSkpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzLmxlbmd0aCA9PT0gMAoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgidWwiLCBbbSgibGkiLCBbbSgiYSIpXSldKSkKCQltLnJlbmRlcihyb290LCBtKCJ1bCIsIFt7c3VidHJlZTogInJldGFpbiJ9XSkpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMF0ubm9kZU5hbWUgPT09ICJBIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzQzCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgiYSIsIHtjb25maWc6IG0ucm91dGV9LCAidGVzdCIpKQoJCW0ucmVuZGVyKHJvb3QsIG0oImEiLCB7Y29uZmlnOiBtLnJvdXRlfSwgInRlc3QiKSkKCQlyZXR1cm4gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlID09PSAidGVzdCIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy8yOQoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCXZhciBsaXN0ID0gW2ZhbHNlLCBmYWxzZV0KCQltLnJlbmRlcihyb290LCBsaXN0LnJldmVyc2UoKS5tYXAoZnVuY3Rpb24oZmxhZywgaW5kZXgpIHsKCQkJcmV0dXJuIG0oImlucHV0W3R5cGU9Y2hlY2tib3hdIiwge29uY2xpY2s6IG0ud2l0aEF0dHIoImNoZWNrZWQiLCBmdW5jdGlvbih2YWx1ZSkge2xpc3RbaW5kZXhdID0gdmFsdWV9KSwgY2hlY2tlZDogZmxhZ30pCgkJfSkpCgoJCW1vY2suZG9jdW1lbnQuYWN0aXZlRWxlbWVudCA9IHJvb3QuY2hpbGROb2Rlc1swXQoJCXJvb3QuY2hpbGROb2Rlc1swXS5jaGVja2VkID0gdHJ1ZQoJCXJvb3QuY2hpbGROb2Rlc1swXS5vbmNsaWNrKHtjdXJyZW50VGFyZ2V0OiB7Y2hlY2tlZDogdHJ1ZX19KQoKCQltLnJlbmRlcihyb290LCBsaXN0LnJldmVyc2UoKS5tYXAoZnVuY3Rpb24oZmxhZywgaW5kZXgpIHsKCQkJcmV0dXJuIG0oImlucHV0W3R5cGU9Y2hlY2tib3hdIiwge29uY2xpY2s6IG0ud2l0aEF0dHIoImNoZWNrZWQiLCBmdW5jdGlvbih2YWx1ZSkge2xpc3RbaW5kZXhdID0gdmFsdWV9KSwgY2hlY2tlZDogZmxhZ30pCgkJfSkpCgoJCW1vY2suZG9jdW1lbnQuYWN0aXZlRWxlbWVudCA9IG51bGwKCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5jaGVja2VkID09PSBmYWxzZSAmJiByb290LmNoaWxkTm9kZXNbMV0uY2hlY2tlZCA9PT0gdHJ1ZQoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzQ0ICgxKQoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oIiNmb28iLCBbbnVsbCwgbSgiI2JhciIpXSkpCgkJbS5yZW5kZXIocm9vdCwgbSgiI2ZvbyIsIFsidGVzdCIsIG0oIiNiYXIiKV0pKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1swXS5ub2RlVmFsdWUgPT09ICJ0ZXN0IgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzQ0ICgyKQoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oIiNmb28iLCBbbnVsbCwgbSgiI2JhciIpXSkpCgkJbS5yZW5kZXIocm9vdCwgbSgiI2ZvbyIsIFttKCJkaXYiKSwgbSgiI2JhciIpXSkpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzBdLm5vZGVOYW1lID09PSAiRElWIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzQ0ICgzKQoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oIiNmb28iLCBbInRlc3QiLCBtKCIjYmFyIildKSkKCQltLnJlbmRlcihyb290LCBtKCIjZm9vIiwgW20oImRpdiIpLCBtKCIjYmFyIildKSkKCQlyZXR1cm4gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMF0ubm9kZU5hbWUgPT09ICJESVYiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvNDQgKDQpCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgiI2ZvbyIsIFttKCJkaXYiKSwgbSgiI2JhciIpXSkpCgkJbS5yZW5kZXIocm9vdCwgbSgiI2ZvbyIsIFsidGVzdCIsIG0oIiNiYXIiKV0pKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1swXS5ub2RlVmFsdWUgPT09ICJ0ZXN0IgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzQ0ICg1KQoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oIiNmb28iLCBbbSgiI2JhciIpXSkpCgkJbS5yZW5kZXIocm9vdCwgbSgiI2ZvbyIsIFttKCIjYmFyIiksIFttKCIjYmF6IildXSkpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzFdLmlkID09PSAiYmF6IgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzQ4CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50CgkJbS5yZW5kZXIocm9vdCwgbSgiaHRtbCIsIFttKCIjZm9vIildKSkKCQl2YXIgcmVzdWx0ID0gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMF0uaWQgPT09ICJmb28iCgkJcm9vdC5jaGlsZE5vZGVzID0gW21vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaHRtbCIpXQoJCXJldHVybiByZXN1bHQKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy80OQoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oImEiLCAidGVzdCIpKQoJCW0ucmVuZGVyKHJvb3QsIG0oImEuZm9vIiwgInRlc3QiKSkKCQlyZXR1cm4gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlID09PSAidGVzdCIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy80OQoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oImEuZm9vIiwgInRlc3QiKSkKCQltLnJlbmRlcihyb290LCBtKCJhIiwgInRlc3QiKSkKCQlyZXR1cm4gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlID09PSAidGVzdCIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy80OQoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oImEuZm9vIiwgInRlc3QiKSkKCQltLnJlbmRlcihyb290LCBtKCJhIiwgInRlc3QxIikpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZSA9PT0gInRlc3QxIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzQ5CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgiYSIsICJ0ZXN0IikpCgkJbS5yZW5kZXIocm9vdCwgbSgiYSIsICJ0ZXN0MSIpKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1swXS5ub2RlVmFsdWUgPT09ICJ0ZXN0MSIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy81MAoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oIiNmb28iLCBbW20oImRpdiIsICJhIiksIG0oImRpdiIsICJiIildLCBtKCIjYmFyIildKSkKCQlyZXR1cm4gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMV0uY2hpbGROb2Rlc1swXS5ub2RlVmFsdWUgPT09ICJiIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzUwCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgiI2ZvbyIsIFtbbSgiZGl2IiwgImEiKSwgbSgiZGl2IiwgImIiKV0sIG0oIiNiYXIiKV0pKQoJCW0ucmVuZGVyKHJvb3QsIG0oIiNmb28iLCBbW20oImRpdiIsICJhIiksIG0oImRpdiIsICJiIiksIG0oImRpdiIsICJjIildLCBtKCIjYmFyIildKSkKCQlyZXR1cm4gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMl0uY2hpbGROb2Rlc1swXS5ub2RlVmFsdWUgPT09ICJjIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzUwCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgiI2ZvbyIsIFtbbSgiZGl2IiwgImEiKSwgbSgiZGl2IiwgImIiKV0sIFttKCJkaXYiLCAiYyIpLCBtKCJkaXYiLCAiZCIpXSwgbSgiI2JhciIpXSkpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzNdLmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlID09PSAiZCIgJiYgcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbNF0uaWQgPT09ICJiYXIiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvNTAKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCIjZm9vIiwgW1ttKCJkaXYiLCAiYSIpLCBtKCJkaXYiLCAiYiIpXSwgInRlc3QiXSkpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzFdLmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlID09PSAiYiIgJiYgcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMl0ubm9kZVZhbHVlID09PSAidGVzdCIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy81MAoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oIiNmb28iLCBbWyJhIiwgImIiXSwgInRlc3QiXSkpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzFdLm5vZGVWYWx1ZSA9PT0gImIiICYmIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzJdLm5vZGVWYWx1ZSA9PT0gInRlc3QiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvNTEKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCJtYWluIiwgW20oImJ1dHRvbiIpLCBtKCJhcnRpY2xlIiwgW20oInNlY3Rpb24iKSwgbSgibmF2IildKV0pKQoJCW0ucmVuZGVyKHJvb3QsIG0oIm1haW4iLCBbbSgiYnV0dG9uIiksIG0oImFydGljbGUiLCBbbSgic3BhbiIpLCBtKCJuYXYiKV0pXSkpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzFdLmNoaWxkTm9kZXNbMF0ubm9kZU5hbWUgPT09ICJTUEFOIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzUxCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgibWFpbiIsIFttKCJidXR0b24iKSwgbSgiYXJ0aWNsZSIsIFttKCJzZWN0aW9uIiksIG0oIm5hdiIpXSldKSkKCQltLnJlbmRlcihyb290LCBtKCJtYWluIiwgW20oImJ1dHRvbiIpLCBtKCJhcnRpY2xlIiwgWyJ0ZXN0IiwgbSgibmF2IildKV0pKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1sxXS5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZSA9PT0gInRlc3QiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvNTEKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCJtYWluIiwgW20oImJ1dHRvbiIpLCBtKCJhcnRpY2xlIiwgW20oInNlY3Rpb24iKSwgbSgibmF2IildKV0pKQoJCW0ucmVuZGVyKHJvb3QsIG0oIm1haW4iLCBbbSgiYnV0dG9uIiksIG0oImFydGljbGUiLCBbbS50cnVzdCgidGVzdCIpLCBtKCJuYXYiKV0pXSkpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzFdLmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlID09PSAidGVzdCIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy81NQoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oIiNhIikpCgkJdmFyIGVsZW1lbnRCZWZvcmUgPSByb290LmNoaWxkTm9kZXNbMF0KCQltLnJlbmRlcihyb290LCBtKCIjYiIpKQoJCXZhciBlbGVtZW50QWZ0ZXIgPSByb290LmNoaWxkTm9kZXNbMF0KCQlyZXR1cm4gZWxlbWVudEJlZm9yZSAhPT0gZWxlbWVudEFmdGVyCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvNTYKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBbbnVsbCwgImZvbyJdKQoJCW0ucmVuZGVyKHJvb3QsIFsiYmFyIl0pCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlcy5sZW5ndGggPT0gMQoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzU2CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2IiwgImZvbyIpKQoJCXJldHVybiByb290LmNoaWxkTm9kZXMubGVuZ3RoID09IDEKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIFttKCJidXR0b24iKSwgbSgidWwiKV0pKQoJCXZhciB2YWx1ZUJlZm9yZSA9IHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzBdLm5vZGVOYW1lCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2IiwgW3VuZGVmaW5lZCwgbSgidWwiKV0pKQoJCXZhciB2YWx1ZUFmdGVyID0gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlCgkJcmV0dXJuIHZhbHVlQmVmb3JlID09PSAiQlVUVE9OIiAmJiB2YWx1ZUFmdGVyID09PSAiIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2IiwgW20oInVsIiksIHVuZGVmaW5lZF0pKQoJCXZhciB2YWx1ZUJlZm9yZTEgPSByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1swXS5ub2RlTmFtZQoJCXZhciB2YWx1ZUJlZm9yZTIgPSByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1sxXS5ub2RlVmFsdWUKCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCBbdW5kZWZpbmVkLCBtKCJ1bCIpXSkpCgkJdmFyIHZhbHVlQWZ0ZXIxID0gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlCgkJdmFyIHZhbHVlQWZ0ZXIyID0gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMV0ubm9kZU5hbWUKCQlyZXR1cm4gdmFsdWVCZWZvcmUxID09PSAiVUwiICYmIHZhbHVlQWZ0ZXIxID09PSAiIiAmJiB2YWx1ZUJlZm9yZTIgPT09ICIiICYmIHZhbHVlQWZ0ZXIyID09PSAiVUwiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvNzkKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCB7c3R5bGU6IHtiYWNrZ3JvdW5kOiAicmVkIn19KSkKCQl2YXIgdmFsdWVCZWZvcmUgPSByb290LmNoaWxkTm9kZXNbMF0uc3R5bGUuYmFja2dyb3VuZAoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIHtzdHlsZToge319KSkKCQl2YXIgdmFsdWVBZnRlciA9IHJvb3QuY2hpbGROb2Rlc1swXS5zdHlsZS5iYWNrZ3JvdW5kCgkJcmV0dXJuIHZhbHVlQmVmb3JlID09PSAicmVkIiAmJiB2YWx1ZUFmdGVyID09PSAiIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2W3N0eWxlPSdiYWNrZ3JvdW5kOnJlZCddIikpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5zdHlsZSA9PT0gImJhY2tncm91bmQ6cmVkIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2Iiwge3N0eWxlOiB7YmFja2dyb3VuZDogInJlZCJ9fSkpCgkJdmFyIHZhbHVlQmVmb3JlID0gcm9vdC5jaGlsZE5vZGVzWzBdLnN0eWxlLmJhY2tncm91bmQKCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCB7fSkpCgkJdmFyIHZhbHVlQWZ0ZXIgPSByb290LmNoaWxkTm9kZXNbMF0uc3R5bGUuYmFja2dyb3VuZAoJCXJldHVybiB2YWx1ZUJlZm9yZSA9PT0gInJlZCIgJiYgdmFsdWVBZnRlciA9PT0gdW5kZWZpbmVkCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQl2YXIgbW9kdWxlID0ge30sIHVubG9hZGVkID0gZmFsc2UKCQltb2R1bGUuY29udHJvbGxlciA9IGZ1bmN0aW9uKCkgewoJCQl0aGlzLm9udW5sb2FkID0gZnVuY3Rpb24oKSB7dW5sb2FkZWQgPSB0cnVlfQoJCX0KCQltb2R1bGUudmlldyA9IGZ1bmN0aW9uKCkge30KCQltLm1vZHVsZShyb290LCBtb2R1bGUpCgkJbS5tb2R1bGUocm9vdCwge2NvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sIHZpZXc6IGZ1bmN0aW9uKCkge319KQoJCXJldHVybiB1bmxvYWRlZCA9PT0gdHJ1ZQoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzg3CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2IiwgW1ttKCJhIiksIG0oImEiKV0sIG0oImJ1dHRvbiIpXSkpCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2IiwgW1ttKCJhIildLCBtKCJidXR0b24iKV0pKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlcy5sZW5ndGggPT0gMiAmJiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1sxXS5ub2RlTmFtZSA9PSAiQlVUVE9OIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzg3CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2IiwgW20oImEiKSwgbSgiYiIpLCBtKCJidXR0b24iKV0pKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIFttKCJhIiksIG0oImJ1dHRvbiIpXSkpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzLmxlbmd0aCA9PSAyICYmIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzFdLm5vZGVOYW1lID09ICJCVVRUT04iCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvOTkKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCBbbSgiaW1nIiksIG0oImgxIildKSkKCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCBbbSgiYSIpXSkpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzLmxlbmd0aCA9PSAxICYmIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzBdLm5vZGVOYW1lID09ICJBIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzEyMAoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIFsiYSIsICJiIiwgImMiLCAiZCJdKSkKCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCBbWyJkIiwgImUiXV0pKQoJCXZhciBjaGlsZHJlbiA9IHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzCgkJcmV0dXJuIGNoaWxkcmVuLmxlbmd0aCA9PSAyICYmIGNoaWxkcmVuWzBdLm5vZGVWYWx1ZSA9PSAiZCIgJiYgY2hpbGRyZW5bMV0ubm9kZVZhbHVlID09ICJlIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzEyMAoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIFtbImEiLCAiYiIsICJjIiwgImQiXV0pKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIFsiZCIsICJlIl0pKQoJCXZhciBjaGlsZHJlbiA9IHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzCgkJcmV0dXJuIGNoaWxkcmVuLmxlbmd0aCA9PSAyICYmIGNoaWxkcmVuWzBdLm5vZGVWYWx1ZSA9PSAiZCIgJiYgY2hpbGRyZW5bMV0ubm9kZVZhbHVlID09ICJlIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzEyMAoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIFsieCIsIFtbImEiXSwgImIiLCAiYyIsICJkIl1dKSkKCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCBbImQiLCBbImUiXV0pKQoJCXZhciBjaGlsZHJlbiA9IHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzCgkJcmV0dXJuIGNoaWxkcmVuLmxlbmd0aCA9PSAyICYmIGNoaWxkcmVuWzBdLm5vZGVWYWx1ZSA9PSAiZCIgJiYgY2hpbGRyZW5bMV0ubm9kZVZhbHVlID09ICJlIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzEyMAoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIFsiYiJdKSkKCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCBbWyJlIl1dKSkKCQl2YXIgY2hpbGRyZW4gPSByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2RlcwoJCXJldHVybiBjaGlsZHJlbi5sZW5ndGggPT0gMSAmJiBjaGlsZHJlblswXS5ub2RlVmFsdWUgPT0gImUiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvMTIwCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2IiwgWyJhIiwgWyJiIl1dKSkKCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCBbImQiLCBbWyJlIl1dXSkpCgkJdmFyIGNoaWxkcmVuID0gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXMKCQlyZXR1cm4gY2hpbGRyZW4ubGVuZ3RoID09IDIgJiYgY2hpbGRyZW5bMF0ubm9kZVZhbHVlID09ICJkIiAmJiBjaGlsZHJlblsxXS5ub2RlVmFsdWUgPT0gImUiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvMTIwCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2IiwgWyJhIiwgW1siYiJdXV0pKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIFsiZCIsIFsiZSJdXSkpCgkJdmFyIGNoaWxkcmVuID0gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXMKCQlyZXR1cm4gY2hpbGRyZW4ubGVuZ3RoID09IDIgJiYgY2hpbGRyZW5bMF0ubm9kZVZhbHVlID09ICJkIiAmJiBjaGlsZHJlblsxXS5ub2RlVmFsdWUgPT0gImUiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvMTIwCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2IiwgWyJhIiwgW1siYiJdLCAiYyJdXSkpCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2IiwgWyJkIiwgW1tbImUiXV0sICJ4Il1dKSkKCQl2YXIgY2hpbGRyZW4gPSByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2RlcwoJCXJldHVybiBjaGlsZHJlbi5sZW5ndGggPT0gMyAmJiBjaGlsZHJlblswXS5ub2RlVmFsdWUgPT0gImQiICYmIGNoaWxkcmVuWzFdLm5vZGVWYWx1ZSA9PSAiZSIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoKCQl2YXIgc3VjY2VzcyA9IGZhbHNlCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2Iiwge2NvbmZpZzogZnVuY3Rpb24oZWxlbSwgaXNJbml0aWFsaXplZCwgY3R4KSB7Y3R4LmRhdGEgPSAxfX0pKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIHtjb25maWc6IGZ1bmN0aW9uKGVsZW0sIGlzSW5pdGlhbGl6ZWQsIGN0eCkge3N1Y2Nlc3MgPSBjdHguZGF0YSA9PT0gMX19KSkKCQlyZXR1cm4gc3VjY2VzcwoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgoJCXZhciBpbmRleCA9IDA7CgkJdmFyIHN1Y2Nlc3MgPSB0cnVlOwoJCXZhciBzdGF0ZWZ1bENvbmZpZyA9IGZ1bmN0aW9uKGVsZW0sIGlzSW5pdGlhbGl6ZWQsIGN0eCkge2N0eC5kYXRhID0gaW5kZXgrK30KCQl2YXIgbm9kZSA9IG0oImRpdiIsIHtjb25maWc6IHN0YXRlZnVsQ29uZmlnfSk7CgkJbS5yZW5kZXIocm9vdCwgW25vZGUsIG5vZGVdKTsKCgkJaW5kZXggPSAwOwoJCXZhciBjaGVja0NvbmZpZyA9IGZ1bmN0aW9uKGVsZW0sIGlzSW5pdGlhbGl6ZWQsIGN0eCkgewoJCQlzdWNjZXNzID0gc3VjY2VzcyAmJiAoY3R4LmRhdGEgPT09IGluZGV4KyspCgkJfQoJCW5vZGUgPSBtKCJkaXYiLCB7Y29uZmlnOiBjaGVja0NvbmZpZ30pOwoJCW0ucmVuZGVyKHJvb3QsIFtub2RlLCBub2RlXSk7CgkJcmV0dXJuIHN1Y2Nlc3M7Cgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQl2YXIgcGFyZW50CgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2IiwgbSgiYSIsIHsKCQkJY29uZmlnOiBmdW5jdGlvbihlbCkge3BhcmVudCA9IGVsLnBhcmVudE5vZGUucGFyZW50Tm9kZX0KCQl9KSkpOwoJCXJldHVybiBwYXJlbnQgPT09IHJvb3QKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCXZhciBjb3VudCA9IDAKCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCBtKCJhIiwgewoJCQljb25maWc6IGZ1bmN0aW9uKGVsKSB7CgkJCQl2YXIgaXNsYW5kID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCQkJY291bnQrKwoJCQkJaWYgKGNvdW50ID4gMikgdGhyb3cgInRvbyBtdWNoIHJlY3Vyc2lvbi4uLiIKCQkJCW0ucmVuZGVyKGlzbGFuZCwgbSgiZGl2IikpCgkJCX0KCQl9KSkpOwoJCXJldHVybiBjb3VudCA9PSAxCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvMTI5CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2IiwgW1siZm9vIiwgImJhciJdLCBbImZvbyIsICJiYXIiXSwgWyJmb28iLCAiYmFyIl1dKSk7CgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2IiwgWyJhc2RmIiwgImFzZGYyIiwgImFzZGYzIl0pKTsKCQlyZXR1cm4gdHJ1ZQoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzk4CgkJLy9pbnNlcnQgYXQgYmVnaW5uaW5nCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgW20oImEiLCB7a2V5OiAxfSksIG0oImEiLCB7a2V5OiAyfSksIG0oImEiLCB7a2V5OiAzfSldKQoJCXZhciBmaXJzdEJlZm9yZSA9IHJvb3QuY2hpbGROb2Rlc1swXQoJCW0ucmVuZGVyKHJvb3QsIFttKCJhIiwge2tleTogNH0pLCBtKCJhIiwge2tleTogMX0pLCBtKCJhIiwge2tleTogMn0pLCBtKCJhIiwge2tleTogM30pXSkKCQl2YXIgZmlyc3RBZnRlciA9IHJvb3QuY2hpbGROb2Rlc1sxXQoJCXJldHVybiBmaXJzdEJlZm9yZSA9PSBmaXJzdEFmdGVyICYmIHJvb3QuY2hpbGROb2Rlc1swXS5rZXkgPT0gNCAmJiByb290LmNoaWxkTm9kZXMubGVuZ3RoID09IDQKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy85OAoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIFttKCJhIiwge2tleTogMX0pLCBtKCJhIiwge2tleTogMn0pLCBtKCJhIiwge2tleTogM30pXSkKCQl2YXIgZmlyc3RCZWZvcmUgPSByb290LmNoaWxkTm9kZXNbMF0KCQltLnJlbmRlcihyb290LCBbbSgiYSIsIHtrZXk6IDR9KSwgbSgiYSIsIHtrZXk6IDF9KSwgbSgiYSIsIHtrZXk6IDJ9KV0pCgkJdmFyIGZpcnN0QWZ0ZXIgPSByb290LmNoaWxkTm9kZXNbMV0KCQlyZXR1cm4gZmlyc3RCZWZvcmUgPT0gZmlyc3RBZnRlciAmJiByb290LmNoaWxkTm9kZXNbMF0ua2V5ID09IDQgJiYgcm9vdC5jaGlsZE5vZGVzLmxlbmd0aCA9PSAzCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvOTgKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBbbSgiYSIsIHtrZXk6IDF9KSwgbSgiYSIsIHtrZXk6IDJ9KSwgbSgiYSIsIHtrZXk6IDN9KV0pCgkJdmFyIGZpcnN0QmVmb3JlID0gcm9vdC5jaGlsZE5vZGVzWzFdCgkJbS5yZW5kZXIocm9vdCwgW20oImEiLCB7a2V5OiAyfSksIG0oImEiLCB7a2V5OiAzfSksIG0oImEiLCB7a2V5OiA0fSldKQoJCXZhciBmaXJzdEFmdGVyID0gcm9vdC5jaGlsZE5vZGVzWzBdCgkJcmV0dXJuIGZpcnN0QmVmb3JlID09IGZpcnN0QWZ0ZXIgJiYgcm9vdC5jaGlsZE5vZGVzWzBdLmtleSA9PT0gIjIiICYmIHJvb3QuY2hpbGROb2Rlcy5sZW5ndGggPT09IDMKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy85OAoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIFttKCJhIiwge2tleTogMX0pLCBtKCJhIiwge2tleTogMn0pLCBtKCJhIiwge2tleTogM30pLCBtKCJhIiwge2tleTogNH0pLCBtKCJhIiwge2tleTogNX0pXSkKCQl2YXIgZmlyc3RCZWZvcmUgPSByb290LmNoaWxkTm9kZXNbMF0KCQl2YXIgc2Vjb25kQmVmb3JlID0gcm9vdC5jaGlsZE5vZGVzWzFdCgkJdmFyIGZvdXJ0aEJlZm9yZSA9IHJvb3QuY2hpbGROb2Rlc1szXQoJCW0ucmVuZGVyKHJvb3QsIFttKCJhIiwge2tleTogNH0pLCBtKCJhIiwge2tleTogMTB9KSwgbSgiYSIsIHtrZXk6IDF9KSwgbSgiYSIsIHtrZXk6IDJ9KV0pCgkJdmFyIGZpcnN0QWZ0ZXIgPSByb290LmNoaWxkTm9kZXNbMl0KCQl2YXIgc2Vjb25kQWZ0ZXIgPSByb290LmNoaWxkTm9kZXNbM10KCQl2YXIgZm91cnRoQWZ0ZXIgPSByb290LmNoaWxkTm9kZXNbMF0KCQlyZXR1cm4gZmlyc3RCZWZvcmUgPT09IGZpcnN0QWZ0ZXIgJiYgc2Vjb25kQmVmb3JlID09PSBzZWNvbmRBZnRlciAmJiBmb3VydGhCZWZvcmUgPT09IGZvdXJ0aEFmdGVyICYmIHJvb3QuY2hpbGROb2Rlc1sxXS5rZXkgPT0gIjEwIiAmJiByb290LmNoaWxkTm9kZXMubGVuZ3RoID09PSA0Cgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvOTgKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBbbSgiYSIsIHtrZXk6IDF9KSwgbSgiYSIsIHtrZXk6IDJ9KSwgbSgiYSIsIHtrZXk6IDN9KSwgbSgiYSIsIHtrZXk6IDR9KSwgbSgiYSIsIHtrZXk6IDV9KV0pCgkJdmFyIGZpcnN0QmVmb3JlID0gcm9vdC5jaGlsZE5vZGVzWzBdCgkJdmFyIHNlY29uZEJlZm9yZSA9IHJvb3QuY2hpbGROb2Rlc1sxXQoJCXZhciBmb3VydGhCZWZvcmUgPSByb290LmNoaWxkTm9kZXNbM10KCQltLnJlbmRlcihyb290LCBbbSgiYSIsIHtrZXk6IDR9KSwgbSgiYSIsIHtrZXk6IDEwfSksIG0oImEiLCB7a2V5OiAyfSksIG0oImEiLCB7a2V5OiAxfSksIG0oImEiLCB7a2V5OiA2fSksIG0oImEiLCB7a2V5OiA3fSldKQoJCXZhciBmaXJzdEFmdGVyID0gcm9vdC5jaGlsZE5vZGVzWzNdCgkJdmFyIHNlY29uZEFmdGVyID0gcm9vdC5jaGlsZE5vZGVzWzJdCgkJdmFyIGZvdXJ0aEFmdGVyID0gcm9vdC5jaGlsZE5vZGVzWzBdCgkJcmV0dXJuIGZpcnN0QmVmb3JlID09PSBmaXJzdEFmdGVyICYmIHNlY29uZEJlZm9yZSA9PT0gc2Vjb25kQWZ0ZXIgJiYgZm91cnRoQmVmb3JlID09PSBmb3VydGhBZnRlciAmJiByb290LmNoaWxkTm9kZXNbMV0ua2V5ID09ICIxMCIgJiYgcm9vdC5jaGlsZE5vZGVzWzRdLmtleSA9PSAiNiIgJiYgcm9vdC5jaGlsZE5vZGVzWzVdLmtleSA9PSAiNyIgJiYgcm9vdC5jaGlsZE5vZGVzLmxlbmd0aCA9PT0gNgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzE0OQoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIFttKCJhIiwge2tleTogMX0pLCBtKCJhIiwge2tleTogMn0pLCBtKCJhIiksIG0oImEiLCB7a2V5OiA0fSksIG0oImEiLCB7a2V5OiA1fSldKQoJCXZhciBmaXJzdEJlZm9yZSA9IHJvb3QuY2hpbGROb2Rlc1swXQoJCXZhciBzZWNvbmRCZWZvcmUgPSByb290LmNoaWxkTm9kZXNbMV0KCQl2YXIgdGhpcmRCZWZvcmUgPSByb290LmNoaWxkTm9kZXNbMl0KCQl2YXIgZm91cnRoQmVmb3JlID0gcm9vdC5jaGlsZE5vZGVzWzNdCgkJdmFyIGZpZnRoQmVmb3JlID0gcm9vdC5jaGlsZE5vZGVzWzRdCgkJbS5yZW5kZXIocm9vdCwgW20oImEiLCB7a2V5OiA0fSksIG0oImEiLCB7a2V5OiA1fSksIG0oImEiKSwgbSgiYSIsIHtrZXk6IDF9KSwgbSgiYSIsIHtrZXk6IDJ9KV0pCgkJdmFyIGZpcnN0QWZ0ZXIgPSByb290LmNoaWxkTm9kZXNbM10KCQl2YXIgc2Vjb25kQWZ0ZXIgPSByb290LmNoaWxkTm9kZXNbNF0KCQl2YXIgdGhpcmRBZnRlciA9IHJvb3QuY2hpbGROb2Rlc1syXQoJCXZhciBmb3VydGhBZnRlciA9IHJvb3QuY2hpbGROb2Rlc1swXQoJCXZhciBmaWZ0aEFmdGVyID0gcm9vdC5jaGlsZE5vZGVzWzFdCgkJcmV0dXJuIGZpcnN0QmVmb3JlID09PSBmaXJzdEFmdGVyICYmIHNlY29uZEJlZm9yZSA9PT0gc2Vjb25kQWZ0ZXIgJiYgdGhpcmRCZWZvcmUgPT09IHRoaXJkQWZ0ZXIgJiYgZm91cnRoQmVmb3JlID09PSBmb3VydGhBZnRlciAmJiBmaWZ0aEJlZm9yZSA9PT0gZmlmdGhBZnRlcgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzEzNAoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIHtjb250ZW50ZWRpdGFibGU6IHRydWV9LCAidGVzdCIpKQoJCW1vY2suZG9jdW1lbnQuYWN0aXZlRWxlbWVudCA9IHJvb3QuY2hpbGROb2Rlc1swXQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIHtjb250ZW50ZWRpdGFibGU6IHRydWV9LCAidGVzdDEiKSkKCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCB7Y29udGVudGVkaXRhYmxlOiBmYWxzZX0sICJ0ZXN0MiIpKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1swXS5ub2RlVmFsdWUgPT09ICJ0ZXN0MiIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy8xMzYKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCJ0ZXh0YXJlYSIsIFsidGVzdCJdKSkKCQltLnJlbmRlcihyb290LCBtKCJ0ZXh0YXJlYSIsIFsidGVzdDEiXSkpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS52YWx1ZSA9PT0gInRlc3QxIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJdmFyIHVubG9hZGVkID0gMAoJCW0ucmVuZGVyKHJvb3QsIFsKCQkJbSgiZGl2IiwgewoJCQkJa2V5OiAxLAoJCQkJY29uZmlnOiBmdW5jdGlvbihlbCwgaW5pdCwgY3R4KSB7CgkJCQkJY3R4Lm9udW5sb2FkID0gZnVuY3Rpb24oKSB7CgkJCQkJCXVubG9hZGVkKysKCQkJCQl9CgkJCQl9CgkJCX0pCgkJXSkKCQltLnJlbmRlcihyb290LCBbCgkJCW0oImRpdiIsIHtrZXk6IDJ9KSwKCQkJbSgiZGl2IiwgewoJCQkJa2V5OiAxLAoJCQkJY29uZmlnOiBmdW5jdGlvbihlbCwgaW5pdCwgY3R4KSB7CgkJCQkJY3R4Lm9udW5sb2FkID0gZnVuY3Rpb24oKSB7CgkJCQkJCXVubG9hZGVkKysKCQkJCQl9CgkJCQl9CgkJCX0pCgkJXSkKCQlyZXR1cm4gdW5sb2FkZWQgPT0gMAoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJdmFyIHVubG9hZGVkUGFyZW50ID0gMAoJCXZhciB1bmxvYWRlZENoaWxkID0gMAoJCXZhciBjb25maWdQYXJlbnQgPSBmdW5jdGlvbihlbCwgaW5pdCwgY3R4KSB7CgkJCWN0eC5vbnVubG9hZCA9IGZ1bmN0aW9uKCkgewoJCQkJdW5sb2FkZWRQYXJlbnQrKwoJCQl9CgkJfQoJCXZhciBjb25maWdDaGlsZCA9IGZ1bmN0aW9uKGVsLCBpbml0LCBjdHgpIHsKCQkJY3R4Lm9udW5sb2FkID0gZnVuY3Rpb24oKSB7CgkJCQl1bmxvYWRlZENoaWxkKysKCQkJfQoJCX0KCQl2YXIgdW5sb2FkZWQgPSAwCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2Iiwge2NvbmZpZzogY29uZmlnUGFyZW50fSwgbSgiYSIsIHtjb25maWc6IGNvbmZpZ0NoaWxkfSkpKQoJCW0ucmVuZGVyKHJvb3QsIG0oIm1haW4iLCB7Y29uZmlnOiBjb25maWdQYXJlbnR9LCBtKCJhIiwge2NvbmZpZzogY29uZmlnQ2hpbGR9KSkpCgkJcmV0dXJuIHVubG9hZGVkUGFyZW50ID09PSAxICYmIHVubG9hZGVkQ2hpbGQgPT09IDAKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCXZhciB1bmxvYWRlZFBhcmVudCA9IDAKCQl2YXIgdW5sb2FkZWRDaGlsZCA9IDAKCQl2YXIgY29uZmlnUGFyZW50ID0gZnVuY3Rpb24oZWwsIGluaXQsIGN0eCkgewoJCQljdHgub251bmxvYWQgPSBmdW5jdGlvbigpIHsKCQkJCXVubG9hZGVkUGFyZW50KysKCQkJfQoJCX0KCQl2YXIgY29uZmlnQ2hpbGQgPSBmdW5jdGlvbihlbCwgaW5pdCwgY3R4KSB7CgkJCWN0eC5vbnVubG9hZCA9IGZ1bmN0aW9uKCkgewoJCQkJdW5sb2FkZWRDaGlsZCsrCgkJCX0KCQl9CgkJdmFyIHVubG9hZGVkID0gMAoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIHtjb25maWc6IGNvbmZpZ1BhcmVudH0sIG0oImEiLCB7Y29uZmlnOiBjb25maWdDaGlsZH0pKSkKCQltLnJlbmRlcihyb290LCBtKCJtYWluIiwge2NvbmZpZzogY29uZmlnUGFyZW50fSwgbSgiYiIsIHtjb25maWc6IGNvbmZpZ0NoaWxkfSkpKQoJCXJldHVybiB1bmxvYWRlZFBhcmVudCA9PT0gMSAmJiB1bmxvYWRlZENoaWxkID09PSAxCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvMTUwCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgW20oImEiKSwgbSgiZGl2IildKQoJCW0ucmVuZGVyKHJvb3QsIFtbXSwgbSgiZGl2IildKQoJCXJldHVybiByb290LmNoaWxkTm9kZXMubGVuZ3RoID09IDEgJiYgcm9vdC5jaGlsZE5vZGVzWzBdLm5vZGVOYW1lID09ICJESVYiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvMTU2CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2IiwgWwoJCQlbImEiLCAiYiIsICJjIiwgImQiXS5tYXAoZnVuY3Rpb24oKSB7CgkJCQlyZXR1cm4gW20oImRpdiIpLCAiICJdCgkJCX0pLAoJCQltKCJzcGFuIikKCQldKSkKCQlyZXR1cm4gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbOF0ubm9kZU5hbWUgPT0gIlNQQU4iCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvMTU3CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgidWwiLCBbbSgibGkiLCB7a2V5OiAwfSksIG0oImxpIiwge2tleTogMn0pLCBtKCJsaSIsIHtrZXk6IDR9KV0pKQoJCW0ucmVuZGVyKHJvb3QsIG0oInVsIiwgW20oImxpIiwge2tleTogMH0pLCBtKCJsaSIsIHtrZXk6IDF9KSwgbSgibGkiLCB7a2V5OiAyfSksIG0oImxpIiwge2tleTogM30pLCBtKCJsaSIsIHtrZXk6IDR9KSwgbSgibGkiLCB7a2V5OiA1fSldKSkKCQlyZXR1cm4gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXMubWFwKGZ1bmN0aW9uKG4pIHtyZXR1cm4gbi5rZXl9KS5qb2luKCIiKSA9PSAiMDEyMzQ1IgoJfSkKCS8vZW5kIG0ucmVuZGVyCgoJLy9tLnJlZHJhdwoJdGVzdChmdW5jdGlvbigpIHsKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vc2V0dXAKCQl2YXIgY29udHJvbGxlcgoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ubW9kdWxlKHJvb3QsIHsKCQkJY29udHJvbGxlcjogZnVuY3Rpb24oKSB7Y29udHJvbGxlciA9IHRoaXN9LAoJCQl2aWV3OiBmdW5jdGlvbihjdHJsKSB7cmV0dXJuIGN0cmwudmFsdWV9CgkJfSkKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpCgkJdmFyIHZhbHVlQmVmb3JlID0gcm9vdC5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZQoJCWNvbnRyb2xsZXIudmFsdWUgPSAiZm9vIgoJCW0ucmVkcmF3KCkKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpCgkJcmV0dXJuIHZhbHVlQmVmb3JlID09PSAiIiAmJiByb290LmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlID09PSAiZm9vIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3NldHVwCgkJdmFyIGNvdW50ID0gMAoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ubW9kdWxlKHJvb3QsIHsKCQkJY29udHJvbGxlcjogZnVuY3Rpb24oKSB7fSwKCQkJdmlldzogZnVuY3Rpb24oY3RybCkgewoJCQkJY291bnQrKwoJCQl9CgkJfSkKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vdGVhcmRvd24KCQltLnJlZHJhdygpIC8vc2hvdWxkIHJ1biBzeW5jaHJvbm91c2x5CgkJCgkJbS5yZWRyYXcoKSAvL3Jlc3Qgc2hvdWxkIHJ1biBhc3luY2hyb25vdXNseSBzaW5jZSB0aGV5J3JlIHNwYW1taW5nCgkJbS5yZWRyYXcoKQoJCW0ucmVkcmF3KCkKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vdGVhcmRvd24KCQlyZXR1cm4gY291bnQgPT09IDMKCX0pCgoJLy9tLnJvdXRlCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy9zZXR1cAoJCW1vY2subG9jYXRpb24uc2VhcmNoID0gIj8iCgoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucm91dGUubW9kZSA9ICJzZWFyY2giCgkJbS5yb3V0ZShyb290LCAiL3Rlc3QxIiwgewoJCQkiL3Rlc3QxIjoge2NvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sIHZpZXc6IGZ1bmN0aW9uKCkge3JldHVybiAiZm9vIn19CgkJfSkKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vdGVhcmRvd24KCQlyZXR1cm4gbW9jay5sb2NhdGlvbi5zZWFyY2ggPT0gIj8vdGVzdDEiICYmIHJvb3QuY2hpbGROb2Rlc1swXS5ub2RlVmFsdWUgPT09ICJmb28iCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vc2V0dXAKCQltb2NrLmxvY2F0aW9uLnBhdGhuYW1lID0gIi8iCgoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucm91dGUubW9kZSA9ICJwYXRobmFtZSIKCQltLnJvdXRlKHJvb3QsICIvdGVzdDIiLCB7CgkJCSIvdGVzdDIiOiB7Y29udHJvbGxlcjogZnVuY3Rpb24oKSB7fSwgdmlldzogZnVuY3Rpb24oKSB7cmV0dXJuICJmb28ifX0KCQl9KQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy90ZWFyZG93bgoJCXJldHVybiBtb2NrLmxvY2F0aW9uLnBhdGhuYW1lID09ICIvdGVzdDIiICYmIHJvb3QuY2hpbGROb2Rlc1swXS5ub2RlVmFsdWUgPT09ICJmb28iCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vc2V0dXAKCQltb2NrLmxvY2F0aW9uLmhhc2ggPSAiIyIKCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yb3V0ZS5tb2RlID0gImhhc2giCgkJbS5yb3V0ZShyb290LCAiL3Rlc3QzIiwgewoJCQkiL3Rlc3QzIjoge2NvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sIHZpZXc6IGZ1bmN0aW9uKCkge3JldHVybiAiZm9vIn19CgkJfSkKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vdGVhcmRvd24KCQlyZXR1cm4gbW9jay5sb2NhdGlvbi5oYXNoID09ICIjL3Rlc3QzIiAmJiByb290LmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlID09PSAiZm9vIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3NldHVwCgkJbW9jay5sb2NhdGlvbi5zZWFyY2ggPSAiPyIKCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yb3V0ZS5tb2RlID0gInNlYXJjaCIKCQltLnJvdXRlKHJvb3QsICIvdGVzdDQvZm9vIiwgewoJCQkiL3Rlc3Q0Lzp0ZXN0Ijoge2NvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sIHZpZXc6IGZ1bmN0aW9uKCkge3JldHVybiBtLnJvdXRlLnBhcmFtKCJ0ZXN0Iil9fQoJCX0pCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3RlYXJkb3duCgkJcmV0dXJuIG1vY2subG9jYXRpb24uc2VhcmNoID09ICI/L3Rlc3Q0L2ZvbyIgJiYgcm9vdC5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZSA9PT0gImZvbyIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy9zZXR1cAoJCW1vY2subG9jYXRpb24uc2VhcmNoID0gIj8iCgoJCXZhciBtb2R1bGUgPSB7Y29udHJvbGxlcjogZnVuY3Rpb24oKSB7fSwgdmlldzogZnVuY3Rpb24oKSB7cmV0dXJuIG0ucm91dGUucGFyYW0oInRlc3QiKX19CgoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucm91dGUubW9kZSA9ICJzZWFyY2giCgkJbS5yb3V0ZShyb290LCAiL3Rlc3Q1L2ZvbyIsIHsKCQkJIi8iOiBtb2R1bGUsCgkJCSIvdGVzdDUvOnRlc3QiOiBtb2R1bGUKCQl9KQoJCXZhciBwYXJhbVZhbHVlQmVmb3JlID0gbS5yb3V0ZS5wYXJhbSgidGVzdCIpCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKQoJCW0ucm91dGUoIi8iKQoJCXZhciBwYXJhbVZhbHVlQWZ0ZXIgPSBtLnJvdXRlLnBhcmFtKCJ0ZXN0IikKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vdGVhcmRvd24KCQlyZXR1cm4gbW9jay5sb2NhdGlvbi5zZWFyY2ggPT0gIj8vIiAmJiBwYXJhbVZhbHVlQmVmb3JlID09PSAiZm9vIiAmJiBwYXJhbVZhbHVlQWZ0ZXIgPT09IHVuZGVmaW5lZAoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3NldHVwCgkJbW9jay5sb2NhdGlvbi5zZWFyY2ggPSAiPyIKCgkJdmFyIG1vZHVsZSA9IHtjb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LCB2aWV3OiBmdW5jdGlvbigpIHtyZXR1cm4gbS5yb3V0ZS5wYXJhbSgiYTEiKX19CgoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucm91dGUubW9kZSA9ICJzZWFyY2giCgkJbS5yb3V0ZShyb290LCAiL3Rlc3Q2L2ZvbyIsIHsKCQkJIi8iOiBtb2R1bGUsCgkJCSIvdGVzdDYvOmExIjogbW9kdWxlCgkJfSkKCQl2YXIgcGFyYW1WYWx1ZUJlZm9yZSA9IG0ucm91dGUucGFyYW0oImExIikKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpCgkJbS5yb3V0ZSgiLyIpCgkJdmFyIHBhcmFtVmFsdWVBZnRlciA9IG0ucm91dGUucGFyYW0oImExIikKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vdGVhcmRvd24KCQlyZXR1cm4gbW9jay5sb2NhdGlvbi5zZWFyY2ggPT0gIj8vIiAmJiBwYXJhbVZhbHVlQmVmb3JlID09PSAiZm9vIiAmJiBwYXJhbVZhbHVlQWZ0ZXIgPT09IHVuZGVmaW5lZAoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzYxCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3NldHVwCgkJbW9jay5sb2NhdGlvbi5zZWFyY2ggPSAiPyIKCgkJdmFyIG1vZHVsZSA9IHtjb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LCB2aWV3OiBmdW5jdGlvbigpIHtyZXR1cm4gbS5yb3V0ZS5wYXJhbSgiYTEiKX19CgoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucm91dGUubW9kZSA9ICJzZWFyY2giCgkJbS5yb3V0ZShyb290LCAiL3Rlc3Q3L2ZvbyIsIHsKCQkJIi8iOiBtb2R1bGUsCgkJCSIvdGVzdDcvOmExIjogbW9kdWxlCgkJfSkKCQl2YXIgcm91dGVWYWx1ZUJlZm9yZSA9IG0ucm91dGUoKQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkKCQltLnJvdXRlKCIvIikKCQl2YXIgcm91dGVWYWx1ZUFmdGVyID0gbS5yb3V0ZSgpCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3RlYXJkb3duCgkJcmV0dXJuIHJvdXRlVmFsdWVCZWZvcmUgPT09ICIvdGVzdDcvZm9vIiAmJiByb3V0ZVZhbHVlQWZ0ZXIgPT09ICIvIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3NldHVwCgkJbW9jay5sb2NhdGlvbi5zZWFyY2ggPSAiPyIKCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yb3V0ZS5tb2RlID0gInNlYXJjaCIKCQltLnJvdXRlKHJvb3QsICIvdGVzdDgvZm9vL1NFUC9iYXIvYmF6IiwgewoJCQkiL3Rlc3Q4Lzp0ZXN0L1NFUC86cGF0aC4uLiI6IHsKCQkJCWNvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sCgkJCQl2aWV3OiBmdW5jdGlvbigpIHsKCQkJCQlyZXR1cm4gbS5yb3V0ZS5wYXJhbSgidGVzdCIpICsgIl8iICsgbS5yb3V0ZS5wYXJhbSgicGF0aCIpCgkJCQl9CgkJCX0KCQl9KQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy90ZWFyZG93bgoJCXJldHVybiBtb2NrLmxvY2F0aW9uLnNlYXJjaCA9PSAiPy90ZXN0OC9mb28vU0VQL2Jhci9iYXoiICYmIHJvb3QuY2hpbGROb2Rlc1swXS5ub2RlVmFsdWUgPT09ICJmb29fYmFyL2JheiIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy9zZXR1cAoJCW1vY2subG9jYXRpb24uc2VhcmNoID0gIj8iCgoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucm91dGUubW9kZSA9ICJzZWFyY2giCgkJbS5yb3V0ZShyb290LCAiL3Rlc3Q5L2Zvby9iYXIvU0VQL2JheiIsIHsKCQkJIi90ZXN0OS86dGVzdC4uLi9TRVAvOnBhdGgiOiB7CgkJCQljb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LAoJCQkJdmlldzogZnVuY3Rpb24oKSB7CgkJCQkJcmV0dXJuIG0ucm91dGUucGFyYW0oInRlc3QiKSArICJfIiArIG0ucm91dGUucGFyYW0oInBhdGgiKQoJCQkJfQoJCQl9CgkJfSkKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vdGVhcmRvd24KCQlyZXR1cm4gbW9jay5sb2NhdGlvbi5zZWFyY2ggPT0gIj8vdGVzdDkvZm9vL2Jhci9TRVAvYmF6IiAmJiByb290LmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlID09PSAiZm9vL2Jhcl9iYXoiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vc2V0dXAKCQltb2NrLmxvY2F0aW9uLnNlYXJjaCA9ICI/IgoKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJvdXRlLm1vZGUgPSAic2VhcmNoIgoJCW0ucm91dGUocm9vdCwgIi90ZXN0MTAvZm9vJTIwYmFyIiwgewoJCQkiL3Rlc3QxMC86dGVzdCI6IHsKCQkJCWNvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sCgkJCQl2aWV3OiBmdW5jdGlvbigpIHsKCQkJCQlyZXR1cm4gbS5yb3V0ZS5wYXJhbSgidGVzdCIpCgkJCQl9CgkJCX0KCQl9KQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy90ZWFyZG93bgoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlID09PSAiZm9vIGJhciIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy9zZXR1cAoJCW1vY2subG9jYXRpb24uc2VhcmNoID0gIj8iCgoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucm91dGUubW9kZSA9ICJzZWFyY2giCgkJbS5yb3V0ZShyb290LCAiLyIsIHsKCQkJIi8iOiB7Y29udHJvbGxlcjogZnVuY3Rpb24oKSB7fSwgdmlldzogZnVuY3Rpb24oKSB7cmV0dXJuICJmb28ifX0sCgkJCSIvdGVzdDExIjoge2NvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sIHZpZXc6IGZ1bmN0aW9uKCkge3JldHVybiAiYmFyIn19CgkJfSkKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpCgkJbS5yb3V0ZSgiL3Rlc3QxMS8iKQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy90ZWFyZG93bgoJCXJldHVybiBtb2NrLmxvY2F0aW9uLnNlYXJjaCA9PSAiPy90ZXN0MTEvIiAmJiByb290LmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlID09PSAiYmFyIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3NldHVwCgkJbW9jay5sb2NhdGlvbi5zZWFyY2ggPSAiPyIKCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yb3V0ZS5tb2RlID0gInNlYXJjaCIKCQltLnJvdXRlKHJvb3QsICIvIiwgewoJCQkiLyI6IHtjb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LCB2aWV3OiBmdW5jdGlvbigpIHt9fSwKCQkJIi90ZXN0MTIiOiB7Y29udHJvbGxlcjogZnVuY3Rpb24oKSB7fSwgdmlldzogZnVuY3Rpb24oKSB7fX0KCQl9KQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkKCQltLnJvdXRlKCIvdGVzdDEyP2E9Zm9vJmI9YmFyIikKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vdGVhcmRvd24KCQlyZXR1cm4gbW9jay5sb2NhdGlvbi5zZWFyY2ggPT0gIj8vdGVzdDEyP2E9Zm9vJmI9YmFyIiAmJiBtLnJvdXRlLnBhcmFtKCJhIikgPT0gImZvbyIgJiYgbS5yb3V0ZS5wYXJhbSgiYiIpID09ICJiYXIiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vc2V0dXAKCQltb2NrLmxvY2F0aW9uLnNlYXJjaCA9ICI/IgoKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJvdXRlLm1vZGUgPSAic2VhcmNoIgoJCW0ucm91dGUocm9vdCwgIi8iLCB7CgkJCSIvIjoge2NvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sIHZpZXc6IGZ1bmN0aW9uKCkge3JldHVybiAiYmFyIn19LAoJCQkiL3Rlc3QxMy86dGVzdCI6IHtjb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LCB2aWV3OiBmdW5jdGlvbigpIHtyZXR1cm4gbS5yb3V0ZS5wYXJhbSgidGVzdCIpfX0KCQl9KQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkKCQltLnJvdXRlKCIvdGVzdDEzL2Zvbz90ZXN0PWJhciIpCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3RlYXJkb3duCgkJcmV0dXJuIG1vY2subG9jYXRpb24uc2VhcmNoID09ICI/L3Rlc3QxMy9mb28/dGVzdD1iYXIiICYmIHJvb3QuY2hpbGROb2Rlc1swXS5ub2RlVmFsdWUgPT09ICJmb28iCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vc2V0dXAKCQltb2NrLmxvY2F0aW9uLnNlYXJjaCA9ICI/IgoKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJvdXRlLm1vZGUgPSAic2VhcmNoIgoJCW0ucm91dGUocm9vdCwgIi8iLCB7CgkJCSIvIjoge2NvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sIHZpZXc6IGZ1bmN0aW9uKCkge3JldHVybiAiYmFyIn19LAoJCQkiL3Rlc3QxNCI6IHtjb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LCB2aWV3OiBmdW5jdGlvbigpIHtyZXR1cm4gImZvbyJ9fQoJCX0pCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKQoJCW0ucm91dGUoIi90ZXN0MTQ/dGVzdCZ0ZXN0Mj0iKQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy90ZWFyZG93bgoJCXJldHVybiBtb2NrLmxvY2F0aW9uLnNlYXJjaCA9PSAiPy90ZXN0MTQ/dGVzdCZ0ZXN0Mj0iICYmIG0ucm91dGUucGFyYW0oInRlc3QiKSA9PT0gdHJ1ZSAmJiBtLnJvdXRlLnBhcmFtKCJ0ZXN0MiIpID09PSAiIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3NldHVwCgkJbW9jay5sb2NhdGlvbi5zZWFyY2ggPSAiPyIKCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yb3V0ZS5tb2RlID0gInNlYXJjaCIKCQltLnJvdXRlKHJvb3QsICIvIiwgewoJCQkiLyI6IHtjb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LCB2aWV3OiBmdW5jdGlvbigpIHt9fSwKCQkJIi90ZXN0MTIiOiB7Y29udHJvbGxlcjogZnVuY3Rpb24oKSB7fSwgdmlldzogZnVuY3Rpb24oKSB7fX0KCQl9KQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkKCQltLnJvdXRlKCIvdGVzdDEyIiwge2E6ICJmb28iLCBiOiAiYmFyIn0pCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3RlYXJkb3duCgkJcmV0dXJuIG1vY2subG9jYXRpb24uc2VhcmNoID09ICI/L3Rlc3QxMj9hPWZvbyZiPWJhciIgJiYgbS5yb3V0ZS5wYXJhbSgiYSIpID09ICJmb28iICYmIG0ucm91dGUucGFyYW0oImIiKSA9PSAiYmFyIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3NldHVwCgkJbW9jay5sb2NhdGlvbi5zZWFyY2ggPSAiPyIKCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJdmFyIHJvdXRlMSwgcm91dGUyCgkJbS5yb3V0ZS5tb2RlID0gInNlYXJjaCIKCQltLnJvdXRlKHJvb3QsICIvIiwgewoJCQkiLyI6IHtjb250cm9sbGVyOiBmdW5jdGlvbigpIHtyb3V0ZTEgPSBtLnJvdXRlKCl9LCB2aWV3OiBmdW5jdGlvbigpIHt9fSwKCQkJIi90ZXN0MTMiOiB7Y29udHJvbGxlcjogZnVuY3Rpb24oKSB7cm91dGUyID0gbS5yb3V0ZSgpfSwgdmlldzogZnVuY3Rpb24oKSB7fX0KCQl9KQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkKCQltLnJvdXRlKCIvdGVzdDEzIikKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vdGVhcmRvd24KCQlyZXR1cm4gcm91dGUxID09ICIvIiAmJiByb3V0ZTIgPT0gIi90ZXN0MTMiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vc2V0dXAKCQltb2NrLmxvY2F0aW9uLnNlYXJjaCA9ICI/IgoKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQl2YXIgdW5sb2FkZWQgPSAwCgkJbS5yb3V0ZS5tb2RlID0gInNlYXJjaCIKCQltLnJvdXRlKHJvb3QsICIvIiwgewoJCQkiLyI6IHsKCQkJCWNvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sCgkJCQl2aWV3OiBmdW5jdGlvbigpIHsKCQkJCQlyZXR1cm4gbSgiZGl2IiwgewoJCQkJCQljb25maWc6IGZ1bmN0aW9uKGVsLCBpbml0LCBjdHgpIHsKCQkJCQkJCWN0eC5vbnVubG9hZCA9IGZ1bmN0aW9uKCkgewoJCQkJCQkJCXVubG9hZGVkKysKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0pCgkJCQl9CgkJCX0sCgkJCSIvdGVzdDE0Ijoge2NvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sIHZpZXc6IGZ1bmN0aW9uKCkge319CgkJfSkKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpCgkJbS5yb3V0ZSgiL3Rlc3QxNCIpCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3RlYXJkb3duCgkJcmV0dXJuIHVubG9hZGVkID09IDEKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy9zZXR1cAoJCW1vY2subG9jYXRpb24uc2VhcmNoID0gIj8iCgoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCXZhciB1bmxvYWRlZCA9IDAKCQltLnJvdXRlLm1vZGUgPSAic2VhcmNoIgoJCW0ucm91dGUocm9vdCwgIi8iLCB7CgkJCSIvIjogewoJCQkJY29udHJvbGxlcjogZnVuY3Rpb24oKSB7fSwKCQkJCXZpZXc6IGZ1bmN0aW9uKCkgewoJCQkJCXJldHVybiBbCgkJCQkJCW0oImRpdiIpLAoJCQkJCQltKCJkaXYiLCB7CgkJCQkJCQljb25maWc6IGZ1bmN0aW9uKGVsLCBpbml0LCBjdHgpIHsKCQkJCQkJCQljdHgub251bmxvYWQgPSBmdW5jdGlvbigpIHsKCQkJCQkJCQkJdW5sb2FkZWQrKwoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJfSkKCQkJCQldCgkJCQl9CgkJCX0sCgkJCSIvdGVzdDE1IjogewoJCQkJY29udHJvbGxlcjogZnVuY3Rpb24oKSB7fSwKCQkJCXZpZXc6IGZ1bmN0aW9uKCkgewoJCQkJCXJldHVybiBbbSgiZGl2IildCgkJCQl9CgkJCX0KCQl9KQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkKCQltLnJvdXRlKCIvdGVzdDE1IikKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vdGVhcmRvd24KCQlyZXR1cm4gdW5sb2FkZWQgPT0gMQoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3NldHVwCgkJbW9jay5sb2NhdGlvbi5zZWFyY2ggPSAiPyIKCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJdmFyIHVubG9hZGVkID0gMAoJCW0ucm91dGUubW9kZSA9ICJzZWFyY2giCgkJbS5yb3V0ZShyb290LCAiLyIsIHsKCQkJIi8iOiB7CgkJCQljb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LAoJCQkJdmlldzogZnVuY3Rpb24oKSB7CgkJCQkJcmV0dXJuIG0oImRpdiIsIHsKCQkJCQkJY29uZmlnOiBmdW5jdGlvbihlbCwgaW5pdCwgY3R4KSB7CgkJCQkJCQljdHgub251bmxvYWQgPSBmdW5jdGlvbigpIHsKCQkJCQkJCQl1bmxvYWRlZCsrCgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9KQoJCQkJfQoJCQl9LAoJCQkiL3Rlc3QxNiI6IHsKCQkJCWNvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sCgkJCQl2aWV3OiBmdW5jdGlvbigpIHsKCQkJCQlyZXR1cm4gbSgiYSIpCgkJCQl9CgkJCX0KCQl9KQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkKCQltLnJvdXRlKCIvdGVzdDE2IikKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vdGVhcmRvd24KCQlyZXR1cm4gdW5sb2FkZWQgPT0gMQoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3NldHVwCgkJbW9jay5sb2NhdGlvbi5zZWFyY2ggPSAiPyIKCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJdmFyIHVubG9hZGVkID0gMAoJCW0ucm91dGUubW9kZSA9ICJzZWFyY2giCgkJbS5yb3V0ZShyb290LCAiLyIsIHsKCQkJIi8iOiB7CgkJCQljb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LAoJCQkJdmlldzogZnVuY3Rpb24oKSB7CgkJCQkJcmV0dXJuIFsKCQkJCQkJbSgiZGl2IiwgewoJCQkJCQkJY29uZmlnOiBmdW5jdGlvbihlbCwgaW5pdCwgY3R4KSB7CgkJCQkJCQkJY3R4Lm9udW5sb2FkID0gZnVuY3Rpb24oKSB7CgkJCQkJCQkJCXVubG9hZGVkKysKCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCX0pCgkJCQkJXQoJCQkJfQoJCQl9LAoJCQkiL3Rlc3QxNyI6IHsKCQkJCWNvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sCgkJCQl2aWV3OiBmdW5jdGlvbigpIHsKCQkJCQlyZXR1cm4gbSgiYSIpCgkJCQl9CgkJCX0KCQl9KQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkKCQltLnJvdXRlKCIvdGVzdDE3IikKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vdGVhcmRvd24KCQlyZXR1cm4gdW5sb2FkZWQgPT0gMQoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3NldHVwCgkJbW9jay5sb2NhdGlvbi5zZWFyY2ggPSAiPyIKCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJdmFyIHVubG9hZGVkID0gMAoJCW0ucm91dGUubW9kZSA9ICJzZWFyY2giCgkJbS5yb3V0ZShyb290LCAiLyIsIHsKCQkJIi8iOiB7CgkJCQljb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LAoJCQkJdmlldzogZnVuY3Rpb24oKSB7CgkJCQkJcmV0dXJuIG0oImRpdiIsIHsKCQkJCQkJY29uZmlnOiBmdW5jdGlvbihlbCwgaW5pdCwgY3R4KSB7CgkJCQkJCQljdHgub251bmxvYWQgPSBmdW5jdGlvbigpIHsKCQkJCQkJCQl1bmxvYWRlZCsrCgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9KQoJCQkJfQoJCQl9LAoJCQkiL3Rlc3QxOCI6IHsKCQkJCWNvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sCgkJCQl2aWV3OiBmdW5jdGlvbigpIHsKCQkJCQlyZXR1cm4gW20oImEiKV0KCQkJCX0KCQkJfQoJCX0pCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKQoJCW0ucm91dGUoIi90ZXN0MTgiKQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy90ZWFyZG93bgoJCXJldHVybiB1bmxvYWRlZCA9PSAxCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vc2V0dXAKCQltb2NrLmxvY2F0aW9uLnNlYXJjaCA9ICI/IgoKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQl2YXIgdW5sb2FkZWQgPSAwCgkJbS5yb3V0ZS5tb2RlID0gInNlYXJjaCIKCQltLnJvdXRlKHJvb3QsICIvIiwgewoJCQkiLyI6IHsKCQkJCWNvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sCgkJCQl2aWV3OiBmdW5jdGlvbigpIHsKCQkJCQlyZXR1cm4gWwoJCQkJCQltKCJkaXYiLCB7CgkJCQkJCQlrZXk6IDEsCgkJCQkJCQljb25maWc6IGZ1bmN0aW9uKGVsLCBpbml0LCBjdHgpIHsKCQkJCQkJCQljdHgub251bmxvYWQgPSBmdW5jdGlvbigpIHsKCQkJCQkJCQkJdW5sb2FkZWQrKwoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJfSkKCQkJCQldCgkJCQl9CgkJCX0sCgkJCSIvdGVzdDIwIjogewoJCQkJY29udHJvbGxlcjogZnVuY3Rpb24oKSB7fSwKCQkJCXZpZXc6IGZ1bmN0aW9uKCkgewoJCQkJCXJldHVybiBbCgkJCQkJCW0oImRpdiIsIHsKCQkJCQkJCWtleTogMiwKCQkJCQkJCWNvbmZpZzogZnVuY3Rpb24oZWwsIGluaXQsIGN0eCkgewoJCQkJCQkJCWN0eC5vbnVubG9hZCA9IGZ1bmN0aW9uKCkgewoJCQkJCQkJCQl1bmxvYWRlZCsrCgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQl9KQoJCQkJCV0KCQkJCX0KCQkJfQoJCX0pCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKQoJCW0ucm91dGUoIi90ZXN0MjAiKQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy90ZWFyZG93bgoJCXJldHVybiB1bmxvYWRlZCA9PSAxCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vc2V0dXAKCQltb2NrLmxvY2F0aW9uLnNlYXJjaCA9ICI/IgoKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQl2YXIgdW5sb2FkZWQgPSAwCgkJbS5yb3V0ZS5tb2RlID0gInNlYXJjaCIKCQltLnJvdXRlKHJvb3QsICIvIiwgewoJCQkiLyI6IHsKCQkJCWNvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sCgkJCQl2aWV3OiBmdW5jdGlvbigpIHsKCQkJCQlyZXR1cm4gWwoJCQkJCQltKCJkaXYiLCB7CgkJCQkJCQlrZXk6IDEsCgkJCQkJCQljb25maWc6IGZ1bmN0aW9uKGVsLCBpbml0LCBjdHgpIHsKCQkJCQkJCQljdHgub251bmxvYWQgPSBmdW5jdGlvbigpIHsKCQkJCQkJCQkJdW5sb2FkZWQrKwoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJfSkKCQkJCQldCgkJCQl9CgkJCX0sCgkJCSIvdGVzdDIxIjogewoJCQkJY29udHJvbGxlcjogZnVuY3Rpb24oKSB7fSwKCQkJCXZpZXc6IGZ1bmN0aW9uKCkgewoJCQkJCXJldHVybiBbCgkJCQkJCW0oImRpdiIsIHsKCQkJCQkJCWNvbmZpZzogZnVuY3Rpb24oZWwsIGluaXQsIGN0eCkgewoJCQkJCQkJCWN0eC5vbnVubG9hZCA9IGZ1bmN0aW9uKCkgewoJCQkJCQkJCQl1bmxvYWRlZCsrCgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQl9KQoJCQkJCV0KCQkJCX0KCQkJfQoJCX0pCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKQoJCW0ucm91dGUoIi90ZXN0MjEiKQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy90ZWFyZG93bgoJCXJldHVybiB1bmxvYWRlZCA9PSAxCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vc2V0dXAKCQltb2NrLmxvY2F0aW9uLnNlYXJjaCA9ICI/IgoKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJvdXRlLm1vZGUgPSAic2VhcmNoIgoJCW0ucm91dGUocm9vdCwgIi9mb28iLCB7CgkJCSIvZm9vIjogewoJCQkJY29udHJvbGxlcjogZnVuY3Rpb24oKSB7fSwKCQkJCXZpZXc6IGZ1bmN0aW9uKCkgewoJCQkJCXJldHVybiBtKCJkaXYiLCAiZm9vIik7CgkJCQl9CgkJCX0sCgkJCSIvYmFyIjogewoJCQkJY29udHJvbGxlcjogZnVuY3Rpb24oKSB7fSwKCQkJCXZpZXc6IGZ1bmN0aW9uKCkgewoJCQkJCXJldHVybiBtKCJkaXYiLCAiYmFyIik7CgkJCQl9CgkJCX0sCgkJfSkKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpCgkJdmFyIGZvbyA9IHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZTsKCQltLnJvdXRlKCIvYmFyIikKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vdGVhcmRvd24KCQl2YXIgYmFyID0gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlOwoJCXJldHVybiAoZm9vID09PSAiZm9vIiAmJiBiYXIgPT09ICJiYXIiKQoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3NldHVwCgkJbW9jay5sb2NhdGlvbi5zZWFyY2ggPSAiPyIKCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJdmFyIHVubG9hZGVkID0gMAoJCXZhciBjb25maWcgPSBmdW5jdGlvbihlbCwgaW5pdCwgY3R4KSB7CgkJCWN0eC5vbnVubG9hZCA9IGZ1bmN0aW9uKCkgewoJCQkJdW5sb2FkZWQrKwoJCQl9CgkJfQoJCW0ucm91dGUubW9kZSA9ICJzZWFyY2giCgkJbS5yb3V0ZShyb290LCAiL2ZvbzEiLCB7CgkJCSIvZm9vMSI6IHsKCQkJCWNvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sCgkJCQl2aWV3OiBmdW5jdGlvbigpIHsKCQkJCQlyZXR1cm4gbSgiZGl2IiwgbSgiYSIsIHtjb25maWc6IGNvbmZpZ30sICJmb28iKSk7CgkJCQl9CgkJCX0sCgkJCSIvYmFyMSI6IHsKCQkJCWNvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sCgkJCQl2aWV3OiBmdW5jdGlvbigpIHsKCQkJCQlyZXR1cm4gbSgibWFpbiIsIG0oImEiLCB7Y29uZmlnOiBjb25maWd9LCAiZm9vIikpOwoJCQkJfQoJCQl9LAoJCX0pCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKQoJCW0ucm91dGUoIi9iYXIxIikKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vdGVhcmRvd24KCQlyZXR1cm4gdW5sb2FkZWQgPT0gMQoJfSkKCS8vZW5kIG0ucm91dGUKCgkvL20ucHJvcAoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgcHJvcCA9IG0ucHJvcCgidGVzdCIpCgkJcmV0dXJuIHByb3AoKSA9PT0gInRlc3QiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgcHJvcCA9IG0ucHJvcCgidGVzdCIpCgkJcHJvcCgiZm9vIikKCQlyZXR1cm4gcHJvcCgpID09PSAiZm9vIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHByb3AgPSBtLnByb3AoInRlc3QiKQoJCXJldHVybiBKU09OLnN0cmluZ2lmeShwcm9wKSA9PT0gJyJ0ZXN0IicKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciBvYmogPSB7cHJvcDogbS5wcm9wKCJ0ZXN0Iil9CgkJcmV0dXJuIEpTT04uc3RyaW5naWZ5KG9iaikgPT09ICd7InByb3AiOiJ0ZXN0In0nCgl9KQoKCS8vbS5yZXF1ZXN0Cgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciBwcm9wID0gbS5yZXF1ZXN0KHttZXRob2Q6ICJHRVQiLCB1cmw6ICJ0ZXN0In0pCgkJbW9jay5YTUxIdHRwUmVxdWVzdC4kaW5zdGFuY2VzLnBvcCgpLm9ucmVhZHlzdGF0ZWNoYW5nZSgpCgkJcmV0dXJuIHByb3AoKS5tZXRob2QgPT09ICJHRVQiICYmIHByb3AoKS51cmwgPT09ICJ0ZXN0IgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHByb3AgPSBtLnJlcXVlc3Qoe21ldGhvZDogIkdFVCIsIHVybDogInRlc3QifSkudGhlbihmdW5jdGlvbih2YWx1ZSkge3JldHVybiAiZm9vIn0pCgkJbW9jay5YTUxIdHRwUmVxdWVzdC4kaW5zdGFuY2VzLnBvcCgpLm9ucmVhZHlzdGF0ZWNoYW5nZSgpCgkJcmV0dXJuIHByb3AoKSA9PT0gImZvbyIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciBwcm9wID0gbS5yZXF1ZXN0KHttZXRob2Q6ICJQT1NUIiwgdXJsOiAiaHR0cDovL2RvbWFpbi5jb206ODAiLCBkYXRhOiB7fX0pLnRoZW4oZnVuY3Rpb24odmFsdWUpIHtyZXR1cm4gdmFsdWV9KQoJCW1vY2suWE1MSHR0cFJlcXVlc3QuJGluc3RhbmNlcy5wb3AoKS5vbnJlYWR5c3RhdGVjaGFuZ2UoKQoJCXJldHVybiBwcm9wKCkudXJsID09PSAiaHR0cDovL2RvbWFpbi5jb206ODAiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgcHJvcCA9IG0ucmVxdWVzdCh7bWV0aG9kOiAiUE9TVCIsIHVybDogImh0dHA6Ly9kb21haW4uY29tOjgwLzp0ZXN0MSIsIGRhdGE6IHt0ZXN0MTogImZvbyJ9fSkudGhlbihmdW5jdGlvbih2YWx1ZSkge3JldHVybiB2YWx1ZX0pCgkJbW9jay5YTUxIdHRwUmVxdWVzdC4kaW5zdGFuY2VzLnBvcCgpLm9ucmVhZHlzdGF0ZWNoYW5nZSgpCgkJcmV0dXJuIHByb3AoKS51cmwgPT09ICJodHRwOi8vZG9tYWluLmNvbTo4MC9mb28iCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgZXJyb3IgPSBtLnByb3AoIm5vIGVycm9yIikKCQl2YXIgcHJvcCA9IG0ucmVxdWVzdCh7bWV0aG9kOiAiR0VUIiwgdXJsOiAidGVzdCIsIGRlc2VyaWFsaXplOiBmdW5jdGlvbigpIHt0aHJvdyBuZXcgRXJyb3IoImVycm9yIG9jY3VycmVkIil9fSkudGhlbihudWxsLCBlcnJvcikKCQltb2NrLlhNTEh0dHBSZXF1ZXN0LiRpbnN0YW5jZXMucG9wKCkub25yZWFkeXN0YXRlY2hhbmdlKCkKCQlyZXR1cm4gcHJvcCgpID09PSB1bmRlZmluZWQgJiYgZXJyb3IoKS5tZXNzYWdlID09PSAiZXJyb3Igb2NjdXJyZWQiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgZXJyb3IgPSBtLnByb3AoIm5vIGVycm9yIiksIGV4Y2VwdGlvbgoJCXZhciBwcm9wID0gbS5yZXF1ZXN0KHttZXRob2Q6ICJHRVQiLCB1cmw6ICJ0ZXN0IiwgZGVzZXJpYWxpemU6IGZ1bmN0aW9uKCkge3Rocm93IG5ldyBUeXBlRXJyb3IoImVycm9yIG9jY3VycmVkIil9fSkudGhlbihudWxsLCBlcnJvcikKCQl0cnkge21vY2suWE1MSHR0cFJlcXVlc3QuJGluc3RhbmNlcy5wb3AoKS5vbnJlYWR5c3RhdGVjaGFuZ2UoKX0KCQljYXRjaCAoZSkge2V4Y2VwdGlvbiA9IGV9CgkJbS5lbmRDb21wdXRhdGlvbigpCgkJcmV0dXJuIHByb3AoKSA9PT0gdW5kZWZpbmVkICYmIGVycm9yKCkgPT09ICJubyBlcnJvciIgJiYgZXhjZXB0aW9uLm1lc3NhZ2UgPT0gImVycm9yIG9jY3VycmVkIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIGVycm9yID0gbS5wcm9wKCJubyBlcnJvciIpCgkJdmFyIHByb3AgPSBtLnJlcXVlc3Qoe21ldGhvZDogIlBPU1QiLCB1cmw6ICJ0ZXN0In0pLnRoZW4obnVsbCwgZXJyb3IpCgkJdmFyIHhociA9IG1vY2suWE1MSHR0cFJlcXVlc3QuJGluc3RhbmNlcy5wb3AoKQoJCXhoci5vbnJlYWR5c3RhdGVjaGFuZ2UoKQoJCXJldHVybiB4aHIuJGhlYWRlcnNbIkNvbnRlbnQtVHlwZSJdID09ICJhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PXV0Zi04IgoJfSkKCgkvL20uZGVmZXJyZWQKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHZhbHVlCgkJdmFyIGRlZmVycmVkID0gbS5kZWZlcnJlZCgpCgkJZGVmZXJyZWQucHJvbWlzZS50aGVuKGZ1bmN0aW9uKGRhdGEpIHt2YWx1ZSA9IGRhdGF9KQoJCWRlZmVycmVkLnJlc29sdmUoInRlc3QiKQoJCXJldHVybiB2YWx1ZSA9PT0gInRlc3QiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgdmFsdWUKCQl2YXIgZGVmZXJyZWQgPSBtLmRlZmVycmVkKCkKCQlkZWZlcnJlZC5wcm9taXNlLnRoZW4oZnVuY3Rpb24oZGF0YSkge3JldHVybiAiZm9vIn0pLnRoZW4oZnVuY3Rpb24oZGF0YSkge3ZhbHVlID0gZGF0YX0pCgkJZGVmZXJyZWQucmVzb2x2ZSgidGVzdCIpCgkJcmV0dXJuIHZhbHVlID09PSAiZm9vIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHZhbHVlCgkJdmFyIGRlZmVycmVkID0gbS5kZWZlcnJlZCgpCgkJZGVmZXJyZWQucHJvbWlzZS50aGVuKG51bGwsIGZ1bmN0aW9uKGRhdGEpIHt2YWx1ZSA9IGRhdGF9KQoJCWRlZmVycmVkLnJlamVjdCgidGVzdCIpCgkJcmV0dXJuIHZhbHVlID09PSAidGVzdCIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciB2YWx1ZQoJCXZhciBkZWZlcnJlZCA9IG0uZGVmZXJyZWQoKQoJCWRlZmVycmVkLnByb21pc2UudGhlbihudWxsLCBmdW5jdGlvbihkYXRhKSB7cmV0dXJuICJmb28ifSkudGhlbihudWxsLCBmdW5jdGlvbihkYXRhKSB7dmFsdWUgPSBkYXRhfSkKCQlkZWZlcnJlZC5yZWplY3QoInRlc3QiKQoJCXJldHVybiB2YWx1ZSA9PT0gImZvbyIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciB2YWx1ZTEsIHZhbHVlMgoJCXZhciBkZWZlcnJlZCA9IG0uZGVmZXJyZWQoKQoJCWRlZmVycmVkLnByb21pc2UudGhlbihmdW5jdGlvbihkYXRhKSB7dGhyb3cgbmV3IEVycm9yfSkudGhlbihmdW5jdGlvbihkYXRhKSB7dmFsdWUxID0gMX0sIGZ1bmN0aW9uKGRhdGEpIHt2YWx1ZTIgPSBkYXRhfSkKCQlkZWZlcnJlZC5yZXNvbHZlKCJ0ZXN0IikKCQlyZXR1cm4gdmFsdWUxID09PSB1bmRlZmluZWQgJiYgdmFsdWUyIGluc3RhbmNlb2YgRXJyb3IKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciBkZWZlcnJlZDEgPSBtLmRlZmVycmVkKCkKCQl2YXIgZGVmZXJyZWQyID0gbS5kZWZlcnJlZCgpCgkJdmFyIHZhbHVlMSwgdmFsdWUyCgkJZGVmZXJyZWQxLnByb21pc2UudGhlbihmdW5jdGlvbihkYXRhKSB7CgkJCXZhbHVlMSA9IGRhdGEKCQkJcmV0dXJuIGRlZmVycmVkMi5wcm9taXNlCgkJfSkudGhlbihmdW5jdGlvbihkYXRhKSB7CgkJCXZhbHVlMiA9IGRhdGEKCQl9KQoJCWRlZmVycmVkMS5yZXNvbHZlKDEpCgkJZGVmZXJyZWQyLnJlc29sdmUoMikKCQlyZXR1cm4gdmFsdWUxID09PSAxICYmIHZhbHVlMiA9PT0gMgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzgwCgkJdmFyIGRlZmVycmVkID0gbS5kZWZlcnJlZCgpLCB2YWx1ZQoJCWRlZmVycmVkLnJlc29sdmUoMSkKCQlkZWZlcnJlZC5wcm9taXNlLnRoZW4oZnVuY3Rpb24oZGF0YSkgewoJCQl2YWx1ZSA9IGRhdGEKCQl9KQoJCXJldHVybiB2YWx1ZSA9PT0gMQoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzgwCgkJdmFyIGRlZmVycmVkID0gbS5kZWZlcnJlZCgpLCB2YWx1ZQoJCWRlZmVycmVkLnJlamVjdCgxKQoJCWRlZmVycmVkLnByb21pc2UudGhlbihudWxsLCBmdW5jdGlvbihkYXRhKSB7CgkJCXZhbHVlID0gZGF0YQoJCX0pCgkJcmV0dXJuIHZhbHVlID09PSAxCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvODAKCQl2YXIgZGVmZXJyZWQgPSBtLmRlZmVycmVkKCksIHZhbHVlCgkJZGVmZXJyZWQucmVzb2x2ZSgxKQoJCWRlZmVycmVkLnJlc29sdmUoMikKCQlkZWZlcnJlZC5wcm9taXNlLnRoZW4oZnVuY3Rpb24oZGF0YSkgewoJCQl2YWx1ZSA9IGRhdGEKCQl9KQoJCXJldHVybiB2YWx1ZSA9PT0gMQoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzgwCgkJdmFyIGRlZmVycmVkID0gbS5kZWZlcnJlZCgpLCB2YWx1ZQoJCWRlZmVycmVkLnByb21pc2UudGhlbihmdW5jdGlvbihkYXRhKSB7CgkJCXZhbHVlID0gZGF0YQoJCX0pCgkJZGVmZXJyZWQucmVzb2x2ZSgxKQoJCWRlZmVycmVkLnJlc29sdmUoMikKCQlyZXR1cm4gdmFsdWUgPT09IDEKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy84MAoJCXZhciBkZWZlcnJlZCA9IG0uZGVmZXJyZWQoKSwgdmFsdWUxLCB2YWx1ZTIKCQlkZWZlcnJlZC5wcm9taXNlLnRoZW4oZnVuY3Rpb24oZGF0YSkgewoJCQl2YWx1ZTEgPSBkYXRhCgkJfSwgZnVuY3Rpb24oZGF0YSkgewoJCQl2YWx1ZTIgPSBkYXRhCgkJfSkKCQlkZWZlcnJlZC5yZXNvbHZlKDEpCgkJZGVmZXJyZWQucmVqZWN0KDIpCgkJcmV0dXJuIHZhbHVlMSA9PT0gMSAmJiB2YWx1ZTIgPT09IHVuZGVmaW5lZAoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzgwCgkJdmFyIGRlZmVycmVkID0gbS5kZWZlcnJlZCgpLCB2YWx1ZTEsIHZhbHVlMgoJCWRlZmVycmVkLnByb21pc2UudGhlbihmdW5jdGlvbigpIHsKCQkJdmFsdWUxID0gZGF0YQoJCX0sIGZ1bmN0aW9uKGRhdGEpIHsKCQkJdmFsdWUyID0gZGF0YQoJCX0pCgkJZGVmZXJyZWQucmVqZWN0KDEpCgkJZGVmZXJyZWQucmVzb2x2ZSgyKQoJCXJldHVybiB2YWx1ZTEgPT09IHVuZGVmaW5lZCAmJiB2YWx1ZTIgPT09IDEKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy84MAoJCXZhciBkZWZlcnJlZCA9IG0uZGVmZXJyZWQoKSwgdmFsdWUKCQlkZWZlcnJlZC5wcm9taXNlLnRoZW4obnVsbCwgZnVuY3Rpb24oZGF0YSkgewoJCQl2YWx1ZSA9IGRhdGEKCQl9KQoJCWRlZmVycmVkLnJlamVjdCgxKQoJCWRlZmVycmVkLnJlamVjdCgyKQoJCXJldHVybiB2YWx1ZSA9PT0gMQoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzg1CgkJdmFyIGRlZmVycmVkID0gbS5kZWZlcnJlZCgpLCB2YWx1ZQoJCWRlZmVycmVkLnJlc29sdmUoKQoJCWRlZmVycmVkLnByb21pc2UudGhlbihmdW5jdGlvbihkYXRhKSB7CgkJCXZhbHVlID0gMQoJCX0pCgkJcmV0dXJuIHZhbHVlID09PSAxCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvODUKCQl2YXIgZGVmZXJyZWQgPSBtLmRlZmVycmVkKCksIHZhbHVlCgkJZGVmZXJyZWQucmVqZWN0KCkKCQlkZWZlcnJlZC5wcm9taXNlLnRoZW4obnVsbCwgZnVuY3Rpb24oZGF0YSkgewoJCQl2YWx1ZSA9IDEKCQl9KQoJCXJldHVybiB2YWx1ZSA9PT0gMQoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIGRlZmVycmVkID0gbS5kZWZlcnJlZCgpLCB2YWx1ZQoJCWRlZmVycmVkLnJlc29sdmUoMSkKCQlyZXR1cm4gZGVmZXJyZWQucHJvbWlzZSgpID09PSAxCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgZGVmZXJyZWQgPSBtLmRlZmVycmVkKCksIHZhbHVlCgkJdmFyIHByb21pc2UgPSBkZWZlcnJlZC5wcm9taXNlLnRoZW4oZnVuY3Rpb24oZGF0YSkge3JldHVybiBkYXRhICsgMX0pCgkJZGVmZXJyZWQucmVzb2x2ZSgxKQoJCXJldHVybiBwcm9taXNlKCkgPT09IDIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciBkZWZlcnJlZCA9IG0uZGVmZXJyZWQoKSwgdmFsdWUKCQlkZWZlcnJlZC5yZWplY3QoMSkKCQlyZXR1cm4gZGVmZXJyZWQucHJvbWlzZSgpID09PSB1bmRlZmluZWQKCX0pCgoJLy9tLnN5bmMKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHZhbHVlCgkJdmFyIGRlZmVycmVkMSA9IG0uZGVmZXJyZWQoKQoJCXZhciBkZWZlcnJlZDIgPSBtLmRlZmVycmVkKCkKCQltLnN5bmMoW2RlZmVycmVkMS5wcm9taXNlLCBkZWZlcnJlZDIucHJvbWlzZV0pLnRoZW4oZnVuY3Rpb24oZGF0YSkge3ZhbHVlID0gZGF0YX0pCgkJZGVmZXJyZWQxLnJlc29sdmUoInRlc3QiKQoJCWRlZmVycmVkMi5yZXNvbHZlKCJmb28iKQoJCXJldHVybiB2YWx1ZVswXSA9PT0gInRlc3QiICYmIHZhbHVlWzFdID09PSAiZm9vIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHZhbHVlCgkJdmFyIGRlZmVycmVkMSA9IG0uZGVmZXJyZWQoKQoJCXZhciBkZWZlcnJlZDIgPSBtLmRlZmVycmVkKCkKCQltLnN5bmMoW2RlZmVycmVkMS5wcm9taXNlLCBkZWZlcnJlZDIucHJvbWlzZV0pLnRoZW4oZnVuY3Rpb24oZGF0YSkge3ZhbHVlID0gZGF0YX0pCgkJZGVmZXJyZWQyLnJlc29sdmUoImZvbyIpCgkJZGVmZXJyZWQxLnJlc29sdmUoInRlc3QiKQoJCXJldHVybiB2YWx1ZVswXSA9PT0gInRlc3QiICYmIHZhbHVlWzFdID09PSAiZm9vIgoJfSkKCgkvL20uc3RhcnRDb21wdXRhdGlvbi9tLmVuZENvbXB1dGF0aW9uCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkKCgkJdmFyIGNvbnRyb2xsZXIKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLm1vZHVsZShyb290LCB7CgkJCWNvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge2NvbnRyb2xsZXIgPSB0aGlzfSwKCQkJdmlldzogZnVuY3Rpb24oY3RybCkge3JldHVybiBjdHJsLnZhbHVlfQoJCX0pCgoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkKCgkJbS5zdGFydENvbXB1dGF0aW9uKCkKCQljb250cm9sbGVyLnZhbHVlID0gImZvbyIKCQltLmVuZENvbXB1dGF0aW9uKCkKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpCgkJCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5ub2RlVmFsdWUgPT09ICJmb28iCgl9KQoKCS8vY29uc29sZS5sb2cgcHJlc2VuY2UKCXRlc3QoZnVuY3Rpb24oKSB7CgkJcmV0dXJuIG0uZGVwcy5mYWN0b3J5LnRvU3RyaW5nKCkuaW5kZXhPZigiY29uc29sZSIpIDwgMAoJfSkKCgkvLyBjb25maWcgY29udGV4dAoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCgkJdmFyIHN1Y2Nlc3MgPSBmYWxzZTsKCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCB7Y29uZmlnOiBmdW5jdGlvbihlbGVtLCBpc0luaXRpYWxpemVkLCBjdHgpIHtjdHguZGF0YT0xfX0pKTsKCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCB7Y29uZmlnOiBmdW5jdGlvbihlbGVtLCBpc0luaXRpYWxpemVkLCBjdHgpIHtzdWNjZXNzID0gY3R4LmRhdGE9PT0xfX0pKTsKCQlyZXR1cm4gc3VjY2VzczsKCX0pCgoJLy8gbW9yZSBjb21wbGV4IGNvbmZpZyBjb250ZXh0Cgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoKCQl2YXIgaWR4ID0gMDsKCQl2YXIgc3VjY2VzcyA9IHRydWU7CgkJdmFyIHN0YXRlZnVsQ29uZmlnID0gZnVuY3Rpb24oZWxlbSwgaXNJbml0aWFsaXplZCwgY3R4KSB7Y3R4LmRhdGE9aWR4Kyt9CgkJdmFyIG5vZGUgPSBtKCJkaXYiLCB7Y29uZmlnOiBzdGF0ZWZ1bENvbmZpZ30pOwoJCW0ucmVuZGVyKHJvb3QsIFtub2RlLCBub2RlXSk7CgoJCWlkeCA9IDA7CgkJdmFyIGNoZWNrQ29uZmlnID0gZnVuY3Rpb24oZWxlbSwgaXNJbml0aWFsaXplZCwgY3R4KSB7CgkJCXN1Y2Nlc3MgPSBzdWNjZXNzICYmIChjdHguZGF0YSA9PT0gaWR4KyspCgkJfQoJCW5vZGUgPSBtKCJkaXYiLCB7Y29uZmlnOiBjaGVja0NvbmZpZ30pOwoJCW0ucmVuZGVyKHJvb3QsIFtub2RlLCBub2RlXSk7CgkJcmV0dXJuIHN1Y2Nlc3M7Cgl9KQoKfQoKLy9tb2Nrcwp0ZXN0TWl0aHJpbChtb2NrLndpbmRvdykKCnRlc3QucHJpbnQoY29uc29sZS5sb2cpCg==",
                "body": "TWl0aHJpbCA9IG0gPSBuZXcgZnVuY3Rpb24gYXBwKHdpbmRvdykgewoJdmFyIHR5cGUgPSB7fS50b1N0cmluZwoJdmFyIHBhcnNlciA9IC8oPzooXnwjfFwuKShbXiNcLlxbXF1dKykpfChcWy4rP1xdKS9nLCBhdHRyUGFyc2VyID0gL1xbKC4rPykoPzo9KCJ8J3wpKC4qPylcMik/XF0vCgkKCWZ1bmN0aW9uIG0oKSB7CgkJdmFyIGFyZ3MgPSBhcmd1bWVudHMKCQl2YXIgaGFzQXR0cnMgPSB0eXBlLmNhbGwoYXJnc1sxXSkgPT0gIltvYmplY3QgT2JqZWN0XSIgJiYgISgidGFnIiBpbiBhcmdzWzFdKSAmJiAhKCJzdWJ0cmVlIiBpbiBhcmdzWzFdKQoJCXZhciBhdHRycyA9IGhhc0F0dHJzID8gYXJnc1sxXSA6IHt9CgkJdmFyIGNsYXNzQXR0ck5hbWUgPSAiY2xhc3MiIGluIGF0dHJzID8gImNsYXNzIiA6ICJjbGFzc05hbWUiCgkJdmFyIGNlbGwgPSB7dGFnOiAiZGl2IiwgYXR0cnM6IHt9fQoJCXZhciBtYXRjaCwgY2xhc3NlcyA9IFtdCgkJd2hpbGUgKG1hdGNoID0gcGFyc2VyLmV4ZWMoYXJnc1swXSkpIHsKCQkJaWYgKG1hdGNoWzFdID09ICIiKSBjZWxsLnRhZyA9IG1hdGNoWzJdCgkJCWVsc2UgaWYgKG1hdGNoWzFdID09ICIjIikgY2VsbC5hdHRycy5pZCA9IG1hdGNoWzJdCgkJCWVsc2UgaWYgKG1hdGNoWzFdID09ICIuIikgY2xhc3Nlcy5wdXNoKG1hdGNoWzJdKQoJCQllbHNlIGlmIChtYXRjaFszXVswXSA9PSAiWyIpIHsKCQkJCXZhciBwYWlyID0gYXR0clBhcnNlci5leGVjKG1hdGNoWzNdKQoJCQkJY2VsbC5hdHRyc1twYWlyWzFdXSA9IHBhaXJbM10gfHwgKHBhaXJbMl0gPyAiIiA6dHJ1ZSkKCQkJfQoJCX0KCQlpZiAoY2xhc3Nlcy5sZW5ndGggPiAwKSBjZWxsLmF0dHJzW2NsYXNzQXR0ck5hbWVdID0gY2xhc3Nlcy5qb2luKCIgIikKCQkKCQljZWxsLmNoaWxkcmVuID0gaGFzQXR0cnMgPyBhcmdzWzJdIDogYXJnc1sxXQoJCQoJCWZvciAodmFyIGF0dHJOYW1lIGluIGF0dHJzKSB7CgkJCWlmIChhdHRyTmFtZSA9PSBjbGFzc0F0dHJOYW1lKSBjZWxsLmF0dHJzW2F0dHJOYW1lXSA9IChjZWxsLmF0dHJzW2F0dHJOYW1lXSB8fCAiIikgKyAiICIgKyBhdHRyc1thdHRyTmFtZV0KCQkJZWxzZSBjZWxsLmF0dHJzW2F0dHJOYW1lXSA9IGF0dHJzW2F0dHJOYW1lXQoJCX0KCQlyZXR1cm4gY2VsbAoJfQoJZnVuY3Rpb24gYnVpbGQocGFyZW50RWxlbWVudCwgcGFyZW50VGFnLCBwYXJlbnRDYWNoZSwgcGFyZW50SW5kZXgsIGRhdGEsIGNhY2hlZCwgc2hvdWxkUmVhdHRhY2gsIGluZGV4LCBlZGl0YWJsZSwgbmFtZXNwYWNlLCBjb25maWdzKSB7CgkJaWYgKGRhdGEgPT09IG51bGwgfHwgZGF0YSA9PT0gdW5kZWZpbmVkKSBkYXRhID0gIiIKCQlpZiAoZGF0YS5zdWJ0cmVlID09PSAicmV0YWluIikgcmV0dXJuIGNhY2hlZAoKCQl2YXIgY2FjaGVkVHlwZSA9IHR5cGUuY2FsbChjYWNoZWQpLCBkYXRhVHlwZSA9IHR5cGUuY2FsbChkYXRhKQoJCWlmIChjYWNoZWRUeXBlICE9IGRhdGFUeXBlKSB7CgkJCWlmIChjYWNoZWQgIT09IG51bGwgJiYgY2FjaGVkICE9PSB1bmRlZmluZWQpIHsKCQkJCWlmIChwYXJlbnRDYWNoZSAmJiBwYXJlbnRDYWNoZS5ub2RlcykgewoJCQkJCXZhciBvZmZzZXQgPSBpbmRleCAtIHBhcmVudEluZGV4CgkJCQkJdmFyIGVuZCA9IG9mZnNldCArIChkYXRhVHlwZSA9PSAiW29iamVjdCBBcnJheV0iID8gZGF0YSA6IGNhY2hlZC5ub2RlcykubGVuZ3RoCgkJCQkJY2xlYXIocGFyZW50Q2FjaGUubm9kZXMuc2xpY2Uob2Zmc2V0LCBlbmQpLCBwYXJlbnRDYWNoZS5zbGljZShvZmZzZXQsIGVuZCkpCgkJCQl9CgkJCQllbHNlIGNsZWFyKGNhY2hlZC5ub2RlcywgY2FjaGVkKQoJCQl9CgkJCWNhY2hlZCA9IG5ldyBkYXRhLmNvbnN0cnVjdG9yCgkJCWNhY2hlZC5ub2RlcyA9IFtdCgkJfQoKCQlpZiAoZGF0YVR5cGUgPT0gIltvYmplY3QgQXJyYXldIikgewoJCQlkYXRhID0gZmxhdHRlbihkYXRhKQoJCQl2YXIgbm9kZXMgPSBbXSwgaW50YWN0ID0gY2FjaGVkLmxlbmd0aCA9PT0gZGF0YS5sZW5ndGgsIHN1YkFycmF5Q291bnQgPSAwCgkJCQoJCQl2YXIgREVMRVRJT04gPSAxLCBJTlNFUlRJT04gPSAyICwgTU9WRSA9IDMKCQkJdmFyIGV4aXN0aW5nID0ge30sIHVua2V5ZWQgPSBbXSwgc2hvdWxkTWFpbnRhaW5JZGVudGl0aWVzID0gZmFsc2UKCQkJZm9yICh2YXIgaSA9IDA7IGkgPCBjYWNoZWQubGVuZ3RoOyBpKyspIHsKCQkJCWlmIChjYWNoZWRbaV0gJiYgY2FjaGVkW2ldLmF0dHJzICYmIGNhY2hlZFtpXS5hdHRycy5rZXkgIT09IHVuZGVmaW5lZCkgewoJCQkJCXNob3VsZE1haW50YWluSWRlbnRpdGllcyA9IHRydWUKCQkJCQlleGlzdGluZ1tjYWNoZWRbaV0uYXR0cnMua2V5XSA9IHthY3Rpb246IERFTEVUSU9OLCBpbmRleDogaX0KCQkJCX0KCQkJfQoJCQlpZiAoc2hvdWxkTWFpbnRhaW5JZGVudGl0aWVzKSB7CgkJCQlmb3IgKHZhciBpID0gMDsgaSA8IGRhdGEubGVuZ3RoOyBpKyspIHsKCQkJCQlpZiAoZGF0YVtpXSAmJiBkYXRhW2ldLmF0dHJzKSB7CgkJCQkJCWlmIChkYXRhW2ldLmF0dHJzLmtleSAhPT0gdW5kZWZpbmVkKSB7CgkJCQkJCQl2YXIga2V5ID0gZGF0YVtpXS5hdHRycy5rZXkKCQkJCQkJCWlmICghZXhpc3Rpbmdba2V5XSkgZXhpc3Rpbmdba2V5XSA9IHthY3Rpb246IElOU0VSVElPTiwgaW5kZXg6IGl9CgkJCQkJCQllbHNlIGV4aXN0aW5nW2tleV0gPSB7YWN0aW9uOiBNT1ZFLCBpbmRleDogaSwgZnJvbTogZXhpc3Rpbmdba2V5XS5pbmRleCwgZWxlbWVudDogcGFyZW50RWxlbWVudC5jaGlsZE5vZGVzW2V4aXN0aW5nW2tleV0uaW5kZXhdfQoJCQkJCQl9CgkJCQkJCWVsc2UgdW5rZXllZC5wdXNoKHtpbmRleDogaSwgZWxlbWVudDogcGFyZW50RWxlbWVudC5jaGlsZE5vZGVzW2ldfSkKCQkJCQl9CgkJCQl9CgkJCQl2YXIgYWN0aW9ucyA9IE9iamVjdC5rZXlzKGV4aXN0aW5nKS5tYXAoZnVuY3Rpb24oa2V5KSB7cmV0dXJuIGV4aXN0aW5nW2tleV19KQoJCQkJdmFyIGNoYW5nZXMgPSBhY3Rpb25zLnNvcnQoZnVuY3Rpb24oYSwgYikge3JldHVybiBhLmFjdGlvbiAtIGIuYWN0aW9uIHx8IGEuaW5kZXggLSBiLmluZGV4fSkKCQkJCXZhciBuZXdDYWNoZWQgPSBjYWNoZWQuc2xpY2UoKQoJCQkJCgkJCQlmb3IgKHZhciBpID0gMCwgY2hhbmdlOyBjaGFuZ2UgPSBjaGFuZ2VzW2ldOyBpKyspIHsKCQkJCQlpZiAoY2hhbmdlLmFjdGlvbiA9PSBERUxFVElPTikgewoJCQkJCQljbGVhcihjYWNoZWRbY2hhbmdlLmluZGV4XS5ub2RlcywgY2FjaGVkW2NoYW5nZS5pbmRleF0pCgkJCQkJCW5ld0NhY2hlZC5zcGxpY2UoY2hhbmdlLmluZGV4LCAxKQoJCQkJCX0KCQkJCQlpZiAoY2hhbmdlLmFjdGlvbiA9PSBJTlNFUlRJT04pIHsKCQkJCQkJdmFyIGR1bW15ID0gd2luZG93LmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJCQkJCWR1bW15LmtleSA9IGRhdGFbY2hhbmdlLmluZGV4XS5hdHRycy5rZXkKCQkJCQkJcGFyZW50RWxlbWVudC5pbnNlcnRCZWZvcmUoZHVtbXksIHBhcmVudEVsZW1lbnQuY2hpbGROb2Rlc1tjaGFuZ2UuaW5kZXhdKQoJCQkJCQluZXdDYWNoZWQuc3BsaWNlKGNoYW5nZS5pbmRleCwgMCwge2F0dHJzOiB7a2V5OiBkYXRhW2NoYW5nZS5pbmRleF0uYXR0cnMua2V5fSwgbm9kZXM6IFtkdW1teV19KQoJCQkJCX0KCQkJCQkKCQkJCQlpZiAoY2hhbmdlLmFjdGlvbiA9PSBNT1ZFKSB7CgkJCQkJCWlmIChwYXJlbnRFbGVtZW50LmNoaWxkTm9kZXNbY2hhbmdlLmluZGV4XSAhPT0gY2hhbmdlLmVsZW1lbnQpIHsKCQkJCQkJCXBhcmVudEVsZW1lbnQuaW5zZXJ0QmVmb3JlKGNoYW5nZS5lbGVtZW50LCBwYXJlbnRFbGVtZW50LmNoaWxkTm9kZXNbY2hhbmdlLmluZGV4XSkKCQkJCQkJfQoJCQkJCQluZXdDYWNoZWRbY2hhbmdlLmluZGV4XSA9IGNhY2hlZFtjaGFuZ2UuZnJvbV0KCQkJCQl9CgkJCQl9CgkJCQlmb3IgKHZhciBpID0gMDsgaSA8IHVua2V5ZWQubGVuZ3RoOyBpKyspIHsKCQkJCQl2YXIgY2hhbmdlID0gdW5rZXllZFtpXQoJCQkJCXBhcmVudEVsZW1lbnQuaW5zZXJ0QmVmb3JlKGNoYW5nZS5lbGVtZW50LCBwYXJlbnRFbGVtZW50LmNoaWxkTm9kZXNbY2hhbmdlLmluZGV4XSkKCQkJCQluZXdDYWNoZWRbY2hhbmdlLmluZGV4XSA9IGNhY2hlZFtjaGFuZ2UuaW5kZXhdCgkJCQl9CgkJCQljYWNoZWQgPSBuZXdDYWNoZWQKCQkJCWNhY2hlZC5ub2RlcyA9IFtdCgkJCQlmb3IgKHZhciBpID0gMCwgY2hpbGQ7IGNoaWxkID0gcGFyZW50RWxlbWVudC5jaGlsZE5vZGVzW2ldOyBpKyspIGNhY2hlZC5ub2Rlcy5wdXNoKGNoaWxkKQoJCQl9CgkJCQoJCQlmb3IgKHZhciBpID0gMCwgY2FjaGVDb3VudCA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSsrKSB7CgkJCQl2YXIgaXRlbSA9IGJ1aWxkKHBhcmVudEVsZW1lbnQsIHBhcmVudFRhZywgY2FjaGVkLCBpbmRleCwgZGF0YVtpXSwgY2FjaGVkW2NhY2hlQ291bnRdLCBzaG91bGRSZWF0dGFjaCwgaW5kZXggKyBzdWJBcnJheUNvdW50IHx8IHN1YkFycmF5Q291bnQsIGVkaXRhYmxlLCBuYW1lc3BhY2UsIGNvbmZpZ3MpCgkJCQlpZiAoaXRlbSA9PT0gdW5kZWZpbmVkKSBjb250aW51ZQoJCQkJaWYgKCFpdGVtLm5vZGVzLmludGFjdCkgaW50YWN0ID0gZmFsc2UKCQkJCXZhciBpc0FycmF5ID0gaXRlbSBpbnN0YW5jZW9mIEFycmF5CgkJCQlzdWJBcnJheUNvdW50ICs9IGlzQXJyYXkgPyBpdGVtLmxlbmd0aCA6IDEKCQkJCWNhY2hlZFtjYWNoZUNvdW50KytdID0gaXRlbQoJCQl9CgkJCWlmICghaW50YWN0KSB7CgkJCQlmb3IgKHZhciBpID0gMDsgaSA8IGRhdGEubGVuZ3RoOyBpKyspIHsKCQkJCQlpZiAoY2FjaGVkW2ldICE9PSB1bmRlZmluZWQpIG5vZGVzID0gbm9kZXMuY29uY2F0KGNhY2hlZFtpXS5ub2RlcykKCQkJCX0KCQkJCWZvciAodmFyIGkgPSAwLCBub2RlOyBub2RlID0gY2FjaGVkLm5vZGVzW2ldOyBpKyspIHsKCQkJCQlpZiAobm9kZS5wYXJlbnROb2RlICE9PSBudWxsICYmIG5vZGVzLmluZGV4T2Yobm9kZSkgPCAwKSBub2RlLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQobm9kZSkKCQkJCX0KCQkJCWZvciAodmFyIGkgPSBjYWNoZWQubm9kZXMubGVuZ3RoLCBub2RlOyBub2RlID0gbm9kZXNbaV07IGkrKykgewoJCQkJCWlmIChub2RlLnBhcmVudE5vZGUgPT09IG51bGwpIHBhcmVudEVsZW1lbnQuYXBwZW5kQ2hpbGQobm9kZSkKCQkJCX0KCQkJCWlmIChkYXRhLmxlbmd0aCA8IGNhY2hlZC5sZW5ndGgpIGNhY2hlZC5sZW5ndGggPSBkYXRhLmxlbmd0aAoJCQkJY2FjaGVkLm5vZGVzID0gbm9kZXMKCQkJfQoJCQkKCQl9CgkJZWxzZSBpZiAoZGF0YVR5cGUgPT0gIltvYmplY3QgT2JqZWN0XSIpIHsKCQkJaWYgKGRhdGEudGFnICE9IGNhY2hlZC50YWcgfHwgT2JqZWN0LmtleXMoZGF0YS5hdHRycykuam9pbigpICE9IE9iamVjdC5rZXlzKGNhY2hlZC5hdHRycykuam9pbigpIHx8IGRhdGEuYXR0cnMuaWQgIT0gY2FjaGVkLmF0dHJzLmlkKSB7CgkJCQljbGVhcihjYWNoZWQubm9kZXMpCgkJCQlpZiAoY2FjaGVkLmNvbmZpZ0NvbnRleHQgJiYgdHlwZW9mIGNhY2hlZC5jb25maWdDb250ZXh0Lm9udW5sb2FkID09ICJmdW5jdGlvbiIpIGNhY2hlZC5jb25maWdDb250ZXh0Lm9udW5sb2FkKCkKCQkJfQoJCQlpZiAodHlwZW9mIGRhdGEudGFnICE9ICJzdHJpbmciKSByZXR1cm4KCgkJCXZhciBub2RlLCBpc05ldyA9IGNhY2hlZC5ub2Rlcy5sZW5ndGggPT09IDAKCQkJaWYgKGRhdGEuYXR0cnMueG1sbnMpIG5hbWVzcGFjZSA9IGRhdGEuYXR0cnMueG1sbnMKCQkJZWxzZSBpZiAoZGF0YS50YWcgPT09ICJzdmciKSBuYW1lc3BhY2UgPSAiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCgkJCWlmIChpc05ldykgewoJCQkJbm9kZSA9IG5hbWVzcGFjZSA9PT0gdW5kZWZpbmVkID8gd2luZG93LmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoZGF0YS50YWcpIDogd2luZG93LmRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhuYW1lc3BhY2UsIGRhdGEudGFnKQoJCQkJY2FjaGVkID0gewoJCQkJCXRhZzogZGF0YS50YWcsCgkJCQkJLy9wcm9jZXNzIGNoaWxkcmVuIGJlZm9yZSBhdHRycyBzbyB0aGF0IHNlbGVjdC52YWx1ZSB3b3JrcyBjb3JyZWN0bHkKCQkJCQljaGlsZHJlbjogZGF0YS5jaGlsZHJlbiAhPT0gdW5kZWZpbmVkID8gYnVpbGQobm9kZSwgZGF0YS50YWcsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCBkYXRhLmNoaWxkcmVuLCBjYWNoZWQuY2hpbGRyZW4sIHRydWUsIDAsIGRhdGEuYXR0cnMuY29udGVudGVkaXRhYmxlID8gbm9kZSA6IGVkaXRhYmxlLCBuYW1lc3BhY2UsIGNvbmZpZ3MpIDogdW5kZWZpbmVkLAoJCQkJCWF0dHJzOiBzZXRBdHRyaWJ1dGVzKG5vZGUsIGRhdGEudGFnLCBkYXRhLmF0dHJzLCB7fSwgbmFtZXNwYWNlKSwKCQkJCQlub2RlczogW25vZGVdCgkJCQl9CgkJCQlwYXJlbnRFbGVtZW50Lmluc2VydEJlZm9yZShub2RlLCBwYXJlbnRFbGVtZW50LmNoaWxkTm9kZXNbaW5kZXhdIHx8IG51bGwpCgkJCX0KCQkJZWxzZSB7CgkJCQlub2RlID0gY2FjaGVkLm5vZGVzWzBdCgkJCQlzZXRBdHRyaWJ1dGVzKG5vZGUsIGRhdGEudGFnLCBkYXRhLmF0dHJzLCBjYWNoZWQuYXR0cnMsIG5hbWVzcGFjZSkKCQkJCWNhY2hlZC5jaGlsZHJlbiA9IGJ1aWxkKG5vZGUsIGRhdGEudGFnLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgZGF0YS5jaGlsZHJlbiwgY2FjaGVkLmNoaWxkcmVuLCBmYWxzZSwgMCwgZGF0YS5hdHRycy5jb250ZW50ZWRpdGFibGUgPyBub2RlIDogZWRpdGFibGUsIG5hbWVzcGFjZSwgY29uZmlncykKCQkJCWNhY2hlZC5ub2Rlcy5pbnRhY3QgPSB0cnVlCgkJCQlpZiAoc2hvdWxkUmVhdHRhY2ggPT09IHRydWUpIHBhcmVudEVsZW1lbnQuaW5zZXJ0QmVmb3JlKG5vZGUsIHBhcmVudEVsZW1lbnQuY2hpbGROb2Rlc1tpbmRleF0gfHwgbnVsbCkKCQkJfQoJCQlpZiAodHlwZS5jYWxsKGRhdGEuYXR0cnNbImNvbmZpZyJdKSA9PSAiW29iamVjdCBGdW5jdGlvbl0iKSB7CgkJCQljb25maWdzLnB1c2goZGF0YS5hdHRyc1siY29uZmlnIl0uYmluZCh3aW5kb3csIG5vZGUsICFpc05ldywgY2FjaGVkLmNvbmZpZ0NvbnRleHQgPSBjYWNoZWQuY29uZmlnQ29udGV4dCB8fCB7fSwgY2FjaGVkKSkKCQkJfQoJCX0KCQllbHNlIHsKCQkJdmFyIG5vZGVzCgkJCWlmIChjYWNoZWQubm9kZXMubGVuZ3RoID09PSAwKSB7CgkJCQlpZiAoZGF0YS4kdHJ1c3RlZCkgewoJCQkJCW5vZGVzID0gaW5qZWN0SFRNTChwYXJlbnRFbGVtZW50LCBpbmRleCwgZGF0YSkKCQkJCX0KCQkJCWVsc2UgewoJCQkJCW5vZGVzID0gW3dpbmRvdy5kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShkYXRhKV0KCQkJCQlwYXJlbnRFbGVtZW50Lmluc2VydEJlZm9yZShub2Rlc1swXSwgcGFyZW50RWxlbWVudC5jaGlsZE5vZGVzW2luZGV4XSB8fCBudWxsKQoJCQkJfQoJCQkJY2FjaGVkID0gInN0cmluZyBudW1iZXIgYm9vbGVhbiIuaW5kZXhPZih0eXBlb2YgZGF0YSkgPiAtMSA/IG5ldyBkYXRhLmNvbnN0cnVjdG9yKGRhdGEpIDogZGF0YQoJCQkJY2FjaGVkLm5vZGVzID0gbm9kZXMKCQkJfQoJCQllbHNlIGlmIChjYWNoZWQudmFsdWVPZigpICE9PSBkYXRhLnZhbHVlT2YoKSB8fCBzaG91bGRSZWF0dGFjaCA9PT0gdHJ1ZSkgewoJCQkJbm9kZXMgPSBjYWNoZWQubm9kZXMKCQkJCWlmICghZWRpdGFibGUgfHwgZWRpdGFibGUgIT09IHdpbmRvdy5kb2N1bWVudC5hY3RpdmVFbGVtZW50KSB7CgkJCQkJaWYgKGRhdGEuJHRydXN0ZWQpIHsKCQkJCQkJY2xlYXIobm9kZXMsIGNhY2hlZCkKCQkJCQkJbm9kZXMgPSBpbmplY3RIVE1MKHBhcmVudEVsZW1lbnQsIGluZGV4LCBkYXRhKQoJCQkJCX0KCQkJCQllbHNlIHsKCQkJCQkJaWYgKHBhcmVudFRhZyA9PT0gInRleHRhcmVhIikgcGFyZW50RWxlbWVudC52YWx1ZSA9IGRhdGEKCQkJCQkJZWxzZSBpZiAoZWRpdGFibGUpIGVkaXRhYmxlLmlubmVySFRNTCA9IGRhdGEKCQkJCQkJZWxzZSB7CgkJCQkJCQlpZiAobm9kZXNbMF0ubm9kZVR5cGUgPT0gMSB8fCBub2Rlcy5sZW5ndGggPiAxKSB7IC8vd2FzIGEgdHJ1c3RlZCBzdHJpbmcKCQkJCQkJCQljbGVhcihjYWNoZWQubm9kZXMsIGNhY2hlZCkKCQkJCQkJCQlub2RlcyA9IFt3aW5kb3cuZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoZGF0YSldCgkJCQkJCQl9CgkJCQkJCQlwYXJlbnRFbGVtZW50Lmluc2VydEJlZm9yZShub2Rlc1swXSwgcGFyZW50RWxlbWVudC5jaGlsZE5vZGVzW2luZGV4XSB8fCBudWxsKQoJCQkJCQkJbm9kZXNbMF0ubm9kZVZhbHVlID0gZGF0YQoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQkJY2FjaGVkID0gbmV3IGRhdGEuY29uc3RydWN0b3IoZGF0YSkKCQkJCWNhY2hlZC5ub2RlcyA9IG5vZGVzCgkJCX0KCQkJZWxzZSBjYWNoZWQubm9kZXMuaW50YWN0ID0gdHJ1ZQoJCX0KCgkJcmV0dXJuIGNhY2hlZAoJfQoJZnVuY3Rpb24gc2V0QXR0cmlidXRlcyhub2RlLCB0YWcsIGRhdGFBdHRycywgY2FjaGVkQXR0cnMsIG5hbWVzcGFjZSkgewoJCXZhciBncm91cHMgPSB7fQoJCWZvciAodmFyIGF0dHJOYW1lIGluIGRhdGFBdHRycykgewoJCQl2YXIgZGF0YUF0dHIgPSBkYXRhQXR0cnNbYXR0ck5hbWVdCgkJCXZhciBjYWNoZWRBdHRyID0gY2FjaGVkQXR0cnNbYXR0ck5hbWVdCgkJCWlmICghKGF0dHJOYW1lIGluIGNhY2hlZEF0dHJzKSB8fCAoY2FjaGVkQXR0ciAhPT0gZGF0YUF0dHIpIHx8IG5vZGUgPT09IHdpbmRvdy5kb2N1bWVudC5hY3RpdmVFbGVtZW50KSB7CgkJCQljYWNoZWRBdHRyc1thdHRyTmFtZV0gPSBkYXRhQXR0cgoJCQkJaWYgKGF0dHJOYW1lID09PSAiY29uZmlnIikgY29udGludWUKCQkJCWVsc2UgaWYgKHR5cGVvZiBkYXRhQXR0ciA9PSAiZnVuY3Rpb24iICYmIGF0dHJOYW1lLmluZGV4T2YoIm9uIikgPT0gMCkgewoJCQkJCW5vZGVbYXR0ck5hbWVdID0gYXV0b3JlZHJhdyhkYXRhQXR0ciwgbm9kZSkKCQkJCX0KCQkJCWVsc2UgaWYgKGF0dHJOYW1lID09PSAic3R5bGUiICYmIHR5cGVvZiBkYXRhQXR0ciA9PSAib2JqZWN0IikgewoJCQkJCWZvciAodmFyIHJ1bGUgaW4gZGF0YUF0dHIpIHsKCQkJCQkJaWYgKGNhY2hlZEF0dHIgPT09IHVuZGVmaW5lZCB8fCBjYWNoZWRBdHRyW3J1bGVdICE9PSBkYXRhQXR0cltydWxlXSkgbm9kZS5zdHlsZVtydWxlXSA9IGRhdGFBdHRyW3J1bGVdCgkJCQkJfQoJCQkJCWZvciAodmFyIHJ1bGUgaW4gY2FjaGVkQXR0cikgewoJCQkJCQlpZiAoIShydWxlIGluIGRhdGFBdHRyKSkgbm9kZS5zdHlsZVtydWxlXSA9ICIiCgkJCQkJfQoJCQkJfQoJCQkJZWxzZSBpZiAobmFtZXNwYWNlICE9PSB1bmRlZmluZWQpIHsKCQkJCQlpZiAoYXR0ck5hbWUgPT09ICJocmVmIikgbm9kZS5zZXRBdHRyaWJ1dGVOUygiaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIsICJocmVmIiwgZGF0YUF0dHIpCgkJCQkJZWxzZSBpZiAoYXR0ck5hbWUgPT09ICJjbGFzc05hbWUiKSBub2RlLnNldEF0dHJpYnV0ZSgiY2xhc3MiLCBkYXRhQXR0cikKCQkJCQllbHNlIG5vZGUuc2V0QXR0cmlidXRlKGF0dHJOYW1lLCBkYXRhQXR0cikKCQkJCX0KCQkJCWVsc2UgaWYgKGF0dHJOYW1lID09PSAidmFsdWUiICYmIHRhZyA9PT0gImlucHV0IikgewoJCQkJCWlmIChub2RlLnZhbHVlICE9PSBkYXRhQXR0cikgbm9kZS52YWx1ZSA9IGRhdGFBdHRyCgkJCQl9CgkJCQllbHNlIGlmIChhdHRyTmFtZSBpbiBub2RlICYmICEoYXR0ck5hbWUgPT0gImxpc3QiIHx8IGF0dHJOYW1lID09ICJzdHlsZSIpKSB7CgkJCQkJbm9kZVthdHRyTmFtZV0gPSBkYXRhQXR0cgoJCQkJfQoJCQkJZWxzZSBub2RlLnNldEF0dHJpYnV0ZShhdHRyTmFtZSwgZGF0YUF0dHIpCgkJCX0KCQl9CgkJcmV0dXJuIGNhY2hlZEF0dHJzCgl9CglmdW5jdGlvbiBjbGVhcihub2RlcywgY2FjaGVkKSB7CgkJZm9yICh2YXIgaSA9IG5vZGVzLmxlbmd0aCAtIDE7IGkgPiAtMTsgaS0tKSB7CgkJCWlmIChub2Rlc1tpXSAmJiBub2Rlc1tpXS5wYXJlbnROb2RlKSB7CgkJCQlub2Rlc1tpXS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKG5vZGVzW2ldKQoJCQkJY2FjaGVkID0gW10uY29uY2F0KGNhY2hlZCkKCQkJCWlmIChjYWNoZWRbaV0pIHVubG9hZChjYWNoZWRbaV0pCgkJCX0KCQl9CgkJaWYgKG5vZGVzLmxlbmd0aCAhPSAwKSBub2Rlcy5sZW5ndGggPSAwCgl9CglmdW5jdGlvbiB1bmxvYWQoY2FjaGVkKSB7CgkJaWYgKGNhY2hlZC5jb25maWdDb250ZXh0ICYmIHR5cGVvZiBjYWNoZWQuY29uZmlnQ29udGV4dC5vbnVubG9hZCA9PSAiZnVuY3Rpb24iKSBjYWNoZWQuY29uZmlnQ29udGV4dC5vbnVubG9hZCgpCgkJaWYgKGNhY2hlZC5jaGlsZHJlbikgewoJCQlpZiAoY2FjaGVkLmNoaWxkcmVuIGluc3RhbmNlb2YgQXJyYXkpIGZvciAodmFyIGkgPSAwOyBpIDwgY2FjaGVkLmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB1bmxvYWQoY2FjaGVkLmNoaWxkcmVuW2ldKQoJCQllbHNlIGlmIChjYWNoZWQuY2hpbGRyZW4udGFnKSB1bmxvYWQoY2FjaGVkLmNoaWxkcmVuKQoJCX0KCX0KCWZ1bmN0aW9uIGluamVjdEhUTUwocGFyZW50RWxlbWVudCwgaW5kZXgsIGRhdGEpIHsKCQl2YXIgbmV4dFNpYmxpbmcgPSBwYXJlbnRFbGVtZW50LmNoaWxkTm9kZXNbaW5kZXhdCgkJaWYgKG5leHRTaWJsaW5nKSB7CgkJCXZhciBpc0VsZW1lbnQgPSBuZXh0U2libGluZy5ub2RlVHlwZSAhPSAxCgkJCXZhciBwbGFjZWhvbGRlciA9IHdpbmRvdy5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzcGFuIikKCQkJaWYgKGlzRWxlbWVudCkgewoJCQkJcGFyZW50RWxlbWVudC5pbnNlcnRCZWZvcmUocGxhY2Vob2xkZXIsIG5leHRTaWJsaW5nKQoJCQkJcGxhY2Vob2xkZXIuaW5zZXJ0QWRqYWNlbnRIVE1MKCJiZWZvcmViZWdpbiIsIGRhdGEpCgkJCQlwYXJlbnRFbGVtZW50LnJlbW92ZUNoaWxkKHBsYWNlaG9sZGVyKQoJCQl9CgkJCWVsc2UgbmV4dFNpYmxpbmcuaW5zZXJ0QWRqYWNlbnRIVE1MKCJiZWZvcmViZWdpbiIsIGRhdGEpCgkJfQoJCWVsc2UgcGFyZW50RWxlbWVudC5pbnNlcnRBZGphY2VudEhUTUwoImJlZm9yZWVuZCIsIGRhdGEpCgkJdmFyIG5vZGVzID0gW10KCQl3aGlsZSAocGFyZW50RWxlbWVudC5jaGlsZE5vZGVzW2luZGV4XSAhPT0gbmV4dFNpYmxpbmcpIHsKCQkJbm9kZXMucHVzaChwYXJlbnRFbGVtZW50LmNoaWxkTm9kZXNbaW5kZXhdKQoJCQlpbmRleCsrCgkJfQoJCXJldHVybiBub2RlcwoJfQoJZnVuY3Rpb24gZmxhdHRlbihkYXRhKSB7CgkJdmFyIGZsYXR0ZW5lZCA9IFtdCgkJZm9yICh2YXIgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSsrKSB7CgkJCXZhciBpdGVtID0gZGF0YVtpXQoJCQlpZiAoaXRlbSBpbnN0YW5jZW9mIEFycmF5KSBmbGF0dGVuZWQucHVzaC5hcHBseShmbGF0dGVuZWQsIGZsYXR0ZW4oaXRlbSkpCgkJCWVsc2UgZmxhdHRlbmVkLnB1c2goaXRlbSkKCQl9CgkJcmV0dXJuIGZsYXR0ZW5lZAoJfQoJZnVuY3Rpb24gYXV0b3JlZHJhdyhjYWxsYmFjaywgb2JqZWN0LCBncm91cCkgewoJCXJldHVybiBmdW5jdGlvbihlKSB7CgkJCWUgPSBlIHx8IGV2ZW50CgkJCW0uc3RhcnRDb21wdXRhdGlvbigpCgkJCXRyeSB7cmV0dXJuIGNhbGxiYWNrLmNhbGwob2JqZWN0LCBlKX0KCQkJZmluYWxseSB7CgkJCQlpZiAoIWxhc3RSZWRyYXdJZCkgbGFzdFJlZHJhd0lkID0gLTE7CgkJCQltLmVuZENvbXB1dGF0aW9uKCkKCQkJfQoJCX0KCX0KCgl2YXIgaHRtbAoJdmFyIGRvY3VtZW50Tm9kZSA9IHsKCQlpbnNlcnRBZGphY2VudEhUTUw6IGZ1bmN0aW9uKF8sIGRhdGEpIHsKCQkJd2luZG93LmRvY3VtZW50LndyaXRlKGRhdGEpCgkJCXdpbmRvdy5kb2N1bWVudC5jbG9zZSgpCgkJfSwKCQlhcHBlbmRDaGlsZDogZnVuY3Rpb24obm9kZSkgewoJCQlpZiAoaHRtbCA9PT0gdW5kZWZpbmVkKSBodG1sID0gd2luZG93LmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImh0bWwiKQoJCQlpZiAobm9kZS5ub2RlTmFtZSA9PSAiSFRNTCIpIGh0bWwgPSBub2RlCgkJCWVsc2UgaHRtbC5hcHBlbmRDaGlsZChub2RlKQoJCQlpZiAod2luZG93LmRvY3VtZW50LmRvY3VtZW50RWxlbWVudCAmJiB3aW5kb3cuZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50ICE9PSBodG1sKSB7CgkJCQl3aW5kb3cuZG9jdW1lbnQucmVwbGFjZUNoaWxkKGh0bWwsIHdpbmRvdy5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpCgkJCX0KCQkJZWxzZSB3aW5kb3cuZG9jdW1lbnQuYXBwZW5kQ2hpbGQoaHRtbCkKCQl9LAoJCWluc2VydEJlZm9yZTogZnVuY3Rpb24obm9kZSkgewoJCQl0aGlzLmFwcGVuZENoaWxkKG5vZGUpCgkJfSwKCQljaGlsZE5vZGVzOiBbXQoJfQoJdmFyIG5vZGVDYWNoZSA9IFtdLCBjZWxsQ2FjaGUgPSB7fQoJbS5yZW5kZXIgPSBmdW5jdGlvbihyb290LCBjZWxsKSB7CgkJdmFyIGNvbmZpZ3MgPSBbXQoJCWlmICghcm9vdCkgdGhyb3cgbmV3IEVycm9yKCJQbGVhc2UgZW5zdXJlIHRoZSBET00gZWxlbWVudCBleGlzdHMgYmVmb3JlIHJlbmRlcmluZyBhIHRlbXBsYXRlIGludG8gaXQuIikKCQl2YXIgaWQgPSBnZXRDZWxsQ2FjaGVLZXkocm9vdCkKCQl2YXIgbm9kZSA9IHJvb3QgPT0gd2luZG93LmRvY3VtZW50IHx8IHJvb3QgPT0gd2luZG93LmRvY3VtZW50LmRvY3VtZW50RWxlbWVudCA/IGRvY3VtZW50Tm9kZSA6IHJvb3QKCQlpZiAoY2VsbENhY2hlW2lkXSA9PT0gdW5kZWZpbmVkKSBjbGVhcihub2RlLmNoaWxkTm9kZXMpCgkJY2VsbENhY2hlW2lkXSA9IGJ1aWxkKG5vZGUsIG51bGwsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCBjZWxsLCBjZWxsQ2FjaGVbaWRdLCBmYWxzZSwgMCwgbnVsbCwgdW5kZWZpbmVkLCBjb25maWdzKQoJCWZvciAodmFyIGkgPSAwOyBpIDwgY29uZmlncy5sZW5ndGg7IGkrKykgY29uZmlnc1tpXSgpCgl9CglmdW5jdGlvbiBnZXRDZWxsQ2FjaGVLZXkoZWxlbWVudCkgewoJCXZhciBpbmRleCA9IG5vZGVDYWNoZS5pbmRleE9mKGVsZW1lbnQpCgkJcmV0dXJuIGluZGV4IDwgMCA/IG5vZGVDYWNoZS5wdXNoKGVsZW1lbnQpIC0gMSA6IGluZGV4Cgl9CgoJbS50cnVzdCA9IGZ1bmN0aW9uKHZhbHVlKSB7CgkJdmFsdWUgPSBuZXcgU3RyaW5nKHZhbHVlKQoJCXZhbHVlLiR0cnVzdGVkID0gdHJ1ZQoJCXJldHVybiB2YWx1ZQoJfQoKCXZhciByb290cyA9IFtdLCBtb2R1bGVzID0gW10sIGNvbnRyb2xsZXJzID0gW10sIGxhc3RSZWRyYXdJZCA9IDAsIGNvbXB1dGVQb3N0UmVkcmF3SG9vayA9IG51bGwKCW0ubW9kdWxlID0gZnVuY3Rpb24ocm9vdCwgbW9kdWxlKSB7CgkJdmFyIGluZGV4ID0gcm9vdHMuaW5kZXhPZihyb290KQoJCWlmIChpbmRleCA8IDApIGluZGV4ID0gcm9vdHMubGVuZ3RoCgkJdmFyIGlzUHJldmVudGVkID0gZmFsc2UKCQlpZiAoY29udHJvbGxlcnNbaW5kZXhdICYmIHR5cGVvZiBjb250cm9sbGVyc1tpbmRleF0ub251bmxvYWQgPT0gImZ1bmN0aW9uIikgewoJCQl2YXIgZXZlbnQgPSB7CgkJCQlwcmV2ZW50RGVmYXVsdDogZnVuY3Rpb24oKSB7aXNQcmV2ZW50ZWQgPSB0cnVlfQoJCQl9CgkJCWNvbnRyb2xsZXJzW2luZGV4XS5vbnVubG9hZChldmVudCkKCQl9CgkJaWYgKCFpc1ByZXZlbnRlZCkgewoJCQltLnN0YXJ0Q29tcHV0YXRpb24oKQoJCQlyb290c1tpbmRleF0gPSByb290CgkJCW1vZHVsZXNbaW5kZXhdID0gbW9kdWxlCgkJCWNvbnRyb2xsZXJzW2luZGV4XSA9IG5ldyBtb2R1bGUuY29udHJvbGxlcgoJCQltLmVuZENvbXB1dGF0aW9uKCkKCQl9Cgl9CgltLnJlZHJhdyA9IGZ1bmN0aW9uKCkgewoJCXZhciBjYW5jZWwgPSB3aW5kb3cuY2FuY2VsQW5pbWF0aW9uRnJhbWUgfHwgd2luZG93LmNsZWFyVGltZW91dAoJCXZhciBkZWZlciA9IHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHwgd2luZG93LnNldFRpbWVvdXQKCQlpZiAobGFzdFJlZHJhd0lkKSB7CgkJCWNhbmNlbChsYXN0UmVkcmF3SWQpCgkJCWxhc3RSZWRyYXdJZCA9IGRlZmVyKHJlZHJhdywgMCkKCQl9CgkJZWxzZSB7CgkJCXJlZHJhdygpCgkJCWxhc3RSZWRyYXdJZCA9IGRlZmVyKGZ1bmN0aW9uKCkge2xhc3RSZWRyYXdJZCA9IG51bGx9LCAwKQoJCX0KCX0KCWZ1bmN0aW9uIHJlZHJhdygpIHsKCQlmb3IgKHZhciBpID0gMDsgaSA8IHJvb3RzLmxlbmd0aDsgaSsrKSB7CgkJCWlmIChjb250cm9sbGVyc1tpXSkgbS5yZW5kZXIocm9vdHNbaV0sIG1vZHVsZXNbaV0udmlldyhjb250cm9sbGVyc1tpXSkpCgkJfQoJCWlmIChjb21wdXRlUG9zdFJlZHJhd0hvb2spIHsKCQkJY29tcHV0ZVBvc3RSZWRyYXdIb29rKCkKCQkJY29tcHV0ZVBvc3RSZWRyYXdIb29rID0gbnVsbAoJCX0KCQlsYXN0UmVkcmF3SWQgPSBudWxsCgl9CgoJdmFyIHBlbmRpbmdSZXF1ZXN0cyA9IDAKCW0uc3RhcnRDb21wdXRhdGlvbiA9IGZ1bmN0aW9uKCkge3BlbmRpbmdSZXF1ZXN0cysrfQoJbS5lbmRDb21wdXRhdGlvbiA9IGZ1bmN0aW9uKCkgewoJCXBlbmRpbmdSZXF1ZXN0cyA9IE1hdGgubWF4KHBlbmRpbmdSZXF1ZXN0cyAtIDEsIDApCgkJaWYgKHBlbmRpbmdSZXF1ZXN0cyA9PSAwKSBtLnJlZHJhdygpCgl9CgoJbS53aXRoQXR0ciA9IGZ1bmN0aW9uKHByb3AsIHdpdGhBdHRyQ2FsbGJhY2spIHsKCQlyZXR1cm4gZnVuY3Rpb24oZSkgewoJCQllID0gZSB8fCBldmVudAoJCQl3aXRoQXR0ckNhbGxiYWNrKHByb3AgaW4gZS5jdXJyZW50VGFyZ2V0ID8gZS5jdXJyZW50VGFyZ2V0W3Byb3BdIDogZS5jdXJyZW50VGFyZ2V0LmdldEF0dHJpYnV0ZShwcm9wKSkKCQl9Cgl9CgoJLy9yb3V0aW5nCgl2YXIgbW9kZXMgPSB7cGF0aG5hbWU6ICIiLCBoYXNoOiAiIyIsIHNlYXJjaDogIj8ifQoJdmFyIHJlZGlyZWN0ID0gZnVuY3Rpb24oKSB7fSwgcm91dGVQYXJhbXMgPSB7fSwgY3VycmVudFJvdXRlCgltLnJvdXRlID0gZnVuY3Rpb24oKSB7CgkJaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDApIHJldHVybiBjdXJyZW50Um91dGUKCQllbHNlIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAzICYmIHR5cGVvZiBhcmd1bWVudHNbMV0gPT0gInN0cmluZyIpIHsKCQkJdmFyIHJvb3QgPSBhcmd1bWVudHNbMF0sIGRlZmF1bHRSb3V0ZSA9IGFyZ3VtZW50c1sxXSwgcm91dGVyID0gYXJndW1lbnRzWzJdCgkJCXJlZGlyZWN0ID0gZnVuY3Rpb24oc291cmNlKSB7CgkJCQl2YXIgcGF0aCA9IGN1cnJlbnRSb3V0ZSA9IG5vcm1hbGl6ZVJvdXRlKHNvdXJjZSkKCQkJCWlmICghcm91dGVCeVZhbHVlKHJvb3QsIHJvdXRlciwgcGF0aCkpIHsKCQkJCQltLnJvdXRlKGRlZmF1bHRSb3V0ZSwgdHJ1ZSkKCQkJCX0KCQkJfQoJCQl2YXIgbGlzdGVuZXIgPSBtLnJvdXRlLm1vZGUgPT0gImhhc2giID8gIm9uaGFzaGNoYW5nZSIgOiAib25wb3BzdGF0ZSIKCQkJd2luZG93W2xpc3RlbmVyXSA9IGZ1bmN0aW9uKCkgewoJCQkJaWYgKGN1cnJlbnRSb3V0ZSAhPSBub3JtYWxpemVSb3V0ZSh3aW5kb3cubG9jYXRpb25bbS5yb3V0ZS5tb2RlXSkpIHsKCQkJCQlyZWRpcmVjdCh3aW5kb3cubG9jYXRpb25bbS5yb3V0ZS5tb2RlXSkKCQkJCX0KCQkJfQoJCQljb21wdXRlUG9zdFJlZHJhd0hvb2sgPSBzZXRTY3JvbGwKCQkJd2luZG93W2xpc3RlbmVyXSgpCgkJfQoJCWVsc2UgaWYgKGFyZ3VtZW50c1swXS5hZGRFdmVudExpc3RlbmVyKSB7CgkJCXZhciBlbGVtZW50ID0gYXJndW1lbnRzWzBdCgkJCXZhciBpc0luaXRpYWxpemVkID0gYXJndW1lbnRzWzFdCgkJCWlmIChlbGVtZW50LmhyZWYuaW5kZXhPZihtb2Rlc1ttLnJvdXRlLm1vZGVdKSA8IDApIHsKCQkJCWVsZW1lbnQuaHJlZiA9IHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSArIG1vZGVzW20ucm91dGUubW9kZV0gKyBlbGVtZW50LnBhdGhuYW1lCgkJCX0KCQkJaWYgKCFpc0luaXRpYWxpemVkKSB7CgkJCQllbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoImNsaWNrIiwgcm91dGVVbm9idHJ1c2l2ZSkKCQkJCWVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCByb3V0ZVVub2J0cnVzaXZlKQoJCQl9CgkJfQoJCWVsc2UgaWYgKHR5cGVvZiBhcmd1bWVudHNbMF0gPT0gInN0cmluZyIpIHsKCQkJY3VycmVudFJvdXRlID0gYXJndW1lbnRzWzBdCgkJCXZhciBxdWVyeXN0cmluZyA9IHR5cGVvZiBhcmd1bWVudHNbMV0gPT0gIm9iamVjdCIgPyBidWlsZFF1ZXJ5U3RyaW5nKGFyZ3VtZW50c1sxXSkgOiBudWxsCgkJCWlmIChxdWVyeXN0cmluZykgY3VycmVudFJvdXRlICs9IChjdXJyZW50Um91dGUuaW5kZXhPZigiPyIpID09PSAtMSA/ICI/IiA6ICImIikgKyBxdWVyeXN0cmluZwoKCQkJdmFyIHNob3VsZFJlcGxhY2VIaXN0b3J5RW50cnkgPSAoYXJndW1lbnRzLmxlbmd0aCA9PSAzID8gYXJndW1lbnRzWzJdIDogYXJndW1lbnRzWzFdKSA9PT0gdHJ1ZQoJCQkKCQkJaWYgKHdpbmRvdy5oaXN0b3J5LnB1c2hTdGF0ZSkgewoJCQkJY29tcHV0ZVBvc3RSZWRyYXdIb29rID0gZnVuY3Rpb24oKSB7CgkJCQkJd2luZG93Lmhpc3Rvcnlbc2hvdWxkUmVwbGFjZUhpc3RvcnlFbnRyeSA/ICJyZXBsYWNlU3RhdGUiIDogInB1c2hTdGF0ZSJdKG51bGwsIHdpbmRvdy5kb2N1bWVudC50aXRsZSwgbW9kZXNbbS5yb3V0ZS5tb2RlXSArIGN1cnJlbnRSb3V0ZSkKCQkJCQlzZXRTY3JvbGwoKQoJCQkJfQoJCQkJcmVkaXJlY3QobW9kZXNbbS5yb3V0ZS5tb2RlXSArIGN1cnJlbnRSb3V0ZSkKCQkJfQoJCQllbHNlIHdpbmRvdy5sb2NhdGlvblttLnJvdXRlLm1vZGVdID0gY3VycmVudFJvdXRlCgkJfQoJfQoJbS5yb3V0ZS5wYXJhbSA9IGZ1bmN0aW9uKGtleSkge3JldHVybiByb3V0ZVBhcmFtc1trZXldfQoJbS5yb3V0ZS5tb2RlID0gInNlYXJjaCIKCWZ1bmN0aW9uIG5vcm1hbGl6ZVJvdXRlKHJvdXRlKSB7cmV0dXJuIHJvdXRlLnNsaWNlKG1vZGVzW20ucm91dGUubW9kZV0ubGVuZ3RoKX0KCWZ1bmN0aW9uIHJvdXRlQnlWYWx1ZShyb290LCByb3V0ZXIsIHBhdGgpIHsKCQlyb3V0ZVBhcmFtcyA9IHt9CgoJCXZhciBxdWVyeVN0YXJ0ID0gcGF0aC5pbmRleE9mKCI/IikKCQlpZiAocXVlcnlTdGFydCAhPT0gLTEpIHsKCQkJcm91dGVQYXJhbXMgPSBwYXJzZVF1ZXJ5U3RyaW5nKHBhdGguc3Vic3RyKHF1ZXJ5U3RhcnQgKyAxLCBwYXRoLmxlbmd0aCkpCgkJCXBhdGggPSBwYXRoLnN1YnN0cigwLCBxdWVyeVN0YXJ0KQoJCX0KCgkJZm9yICh2YXIgcm91dGUgaW4gcm91dGVyKSB7CgkJCWlmIChyb3V0ZSA9PSBwYXRoKSB7CgkJCQlyZXNldChyb290KQoJCQkJbS5tb2R1bGUocm9vdCwgcm91dGVyW3JvdXRlXSkKCQkJCXJldHVybiB0cnVlCgkJCX0KCgkJCXZhciBtYXRjaGVyID0gbmV3IFJlZ0V4cCgiXiIgKyByb3V0ZS5yZXBsYWNlKC86W15cL10rP1wuezN9L2csICIoLio/KSIpLnJlcGxhY2UoLzpbXlwvXSsvZywgIihbXlxcL10rKSIpICsgIlwvPyQiKQoKCQkJaWYgKG1hdGNoZXIudGVzdChwYXRoKSkgewoJCQkJcmVzZXQocm9vdCkKCQkJCXBhdGgucmVwbGFjZShtYXRjaGVyLCBmdW5jdGlvbigpIHsKCQkJCQl2YXIga2V5cyA9IHJvdXRlLm1hdGNoKC86W15cL10rL2cpIHx8IFtdCgkJCQkJdmFyIHZhbHVlcyA9IFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxLCAtMikKCQkJCQlmb3IgKHZhciBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHJvdXRlUGFyYW1zW2tleXNbaV0ucmVwbGFjZSgvOnxcLi9nLCAiIildID0gZGVjb2RlU3BhY2UodmFsdWVzW2ldKQoJCQkJCW0ubW9kdWxlKHJvb3QsIHJvdXRlcltyb3V0ZV0pCgkJCQl9KQoJCQkJcmV0dXJuIHRydWUKCQkJfQoJCX0KCX0KCWZ1bmN0aW9uIHJlc2V0KHJvb3QpIHsKCQl2YXIgY2FjaGVLZXkgPSBnZXRDZWxsQ2FjaGVLZXkocm9vdCkKCQljbGVhcihyb290LmNoaWxkTm9kZXMsIGNlbGxDYWNoZVtjYWNoZUtleV0pCgkJY2VsbENhY2hlW2NhY2hlS2V5XSA9IHVuZGVmaW5lZAoJfQoJZnVuY3Rpb24gcm91dGVVbm9idHJ1c2l2ZShlKSB7CgkJZSA9IGUgfHwgZXZlbnQKCQlpZiAoZS5jdHJsS2V5IHx8IGUubWV0YUtleSB8fCBlLndoaWNoID09IDIpIHJldHVybgoJCWUucHJldmVudERlZmF1bHQoKQoJCW0ucm91dGUoZS5jdXJyZW50VGFyZ2V0W20ucm91dGUubW9kZV0uc2xpY2UobW9kZXNbbS5yb3V0ZS5tb2RlXS5sZW5ndGgpKQoJfQoJZnVuY3Rpb24gc2V0U2Nyb2xsKCkgewoJCWlmIChtLnJvdXRlLm1vZGUgIT0gImhhc2giICYmIHdpbmRvdy5sb2NhdGlvbi5oYXNoKSB3aW5kb3cubG9jYXRpb24uaGFzaCA9IHdpbmRvdy5sb2NhdGlvbi5oYXNoCgkJZWxzZSB3aW5kb3cuc2Nyb2xsVG8oMCwgMCkKCX0KCWZ1bmN0aW9uIGJ1aWxkUXVlcnlTdHJpbmcob2JqZWN0LCBwcmVmaXgpIHsKCQl2YXIgc3RyID0gW10KCQlmb3IodmFyIHByb3AgaW4gb2JqZWN0KSB7CgkJCXZhciBrZXkgPSBwcmVmaXggPyBwcmVmaXggKyAiWyIgKyBwcm9wICsgIl0iIDogcHJvcCwgdmFsdWUgPSBvYmplY3RbcHJvcF0KCQkJc3RyLnB1c2godHlwZW9mIHZhbHVlID09ICJvYmplY3QiID8gYnVpbGRRdWVyeVN0cmluZyh2YWx1ZSwga2V5KSA6IGVuY29kZVVSSUNvbXBvbmVudChrZXkpICsgIj0iICsgZW5jb2RlVVJJQ29tcG9uZW50KHZhbHVlKSkKCQl9CgkJcmV0dXJuIHN0ci5qb2luKCImIikKCX0KCWZ1bmN0aW9uIHBhcnNlUXVlcnlTdHJpbmcoc3RyKSB7CgkJdmFyIHBhaXJzID0gc3RyLnNwbGl0KCImIiksIHBhcmFtcyA9IHt9CgkJZm9yICh2YXIgaSA9IDA7IGkgPCBwYWlycy5sZW5ndGg7IGkrKykgewoJCQl2YXIgcGFpciA9IHBhaXJzW2ldLnNwbGl0KCI9IikKCQkJcGFyYW1zW2RlY29kZVNwYWNlKHBhaXJbMF0pXSA9IHBhaXJbMV0gPyBkZWNvZGVTcGFjZShwYWlyWzFdKSA6IChwYWlyLmxlbmd0aCA9PT0gMSA/IHRydWUgOiAiIikKCQl9CgkJcmV0dXJuIHBhcmFtcwoJfQoJZnVuY3Rpb24gZGVjb2RlU3BhY2Uoc3RyaW5nKSB7CgkJcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChzdHJpbmcucmVwbGFjZSgvXCsvZywgIiAiKSkKCX0KCgkvL21vZGVsCgltLnByb3AgPSBmdW5jdGlvbihzdG9yZSkgewoJCXZhciBwcm9wID0gZnVuY3Rpb24oKSB7CgkJCWlmIChhcmd1bWVudHMubGVuZ3RoKSBzdG9yZSA9IGFyZ3VtZW50c1swXQoJCQlyZXR1cm4gc3RvcmUKCQl9CgkJcHJvcC50b0pTT04gPSBmdW5jdGlvbigpIHsKCQkJcmV0dXJuIHN0b3JlCgkJfQoJCXJldHVybiBwcm9wCgl9CgoJdmFyIG5vbmUgPSB7fQoJbS5kZWZlcnJlZCA9IGZ1bmN0aW9uKCkgewoJCXZhciByZXNvbHZlcnMgPSBbXSwgcmVqZWN0ZXJzID0gW10sIHJlc29sdmVkID0gbm9uZSwgcmVqZWN0ZWQgPSBub25lLCBwcm9taXNlID0gbS5wcm9wKCkKCQl2YXIgb2JqZWN0ID0gewoJCQlyZXNvbHZlOiBmdW5jdGlvbih2YWx1ZSkgewoJCQkJaWYgKHJlc29sdmVkID09PSBub25lKSBwcm9taXNlKHJlc29sdmVkID0gdmFsdWUpCgkJCQlmb3IgKHZhciBpID0gMDsgaSA8IHJlc29sdmVycy5sZW5ndGg7IGkrKykgcmVzb2x2ZXJzW2ldKHZhbHVlKQoJCQkJcmVzb2x2ZXJzLmxlbmd0aCA9IHJlamVjdGVycy5sZW5ndGggPSAwCgkJCX0sCgkJCXJlamVjdDogZnVuY3Rpb24odmFsdWUpIHsKCQkJCWlmIChyZWplY3RlZCA9PT0gbm9uZSkgcmVqZWN0ZWQgPSB2YWx1ZQoJCQkJZm9yICh2YXIgaSA9IDA7IGkgPCByZWplY3RlcnMubGVuZ3RoOyBpKyspIHJlamVjdGVyc1tpXSh2YWx1ZSkKCQkJCXJlc29sdmVycy5sZW5ndGggPSByZWplY3RlcnMubGVuZ3RoID0gMAoJCQl9LAoJCQlwcm9taXNlOiBwcm9taXNlCgkJfQoJCW9iamVjdC5wcm9taXNlLnJlc29sdmVycyA9IHJlc29sdmVycwoJCW9iamVjdC5wcm9taXNlLnRoZW4gPSBmdW5jdGlvbihzdWNjZXNzLCBlcnJvcikgewoJCQl2YXIgbmV4dCA9IG0uZGVmZXJyZWQoKQoJCQlpZiAoIXN1Y2Nlc3MpIHN1Y2Nlc3MgPSBpZGVudGl0eQoJCQlpZiAoIWVycm9yKSBlcnJvciA9IGlkZW50aXR5CgkJCWZ1bmN0aW9uIGNhbGxiYWNrKG1ldGhvZCwgY2FsbGJhY2spIHsKCQkJCXJldHVybiBmdW5jdGlvbih2YWx1ZSkgewoJCQkJCXRyeSB7CgkJCQkJCXZhciByZXN1bHQgPSBjYWxsYmFjayh2YWx1ZSkKCQkJCQkJaWYgKHJlc3VsdCAmJiB0eXBlb2YgcmVzdWx0LnRoZW4gPT0gImZ1bmN0aW9uIikgcmVzdWx0LnRoZW4obmV4dFttZXRob2RdLCBlcnJvcikKCQkJCQkJZWxzZSBuZXh0W21ldGhvZF0ocmVzdWx0ICE9PSB1bmRlZmluZWQgPyByZXN1bHQgOiB2YWx1ZSkKCQkJCQl9CgkJCQkJY2F0Y2ggKGUpIHsKCQkJCQkJaWYgKGUgaW5zdGFuY2VvZiBFcnJvciAmJiBlLmNvbnN0cnVjdG9yICE9PSBFcnJvcikgdGhyb3cgZQoJCQkJCQllbHNlIG5leHQucmVqZWN0KGUpCgkJCQkJfQoJCQkJfQoJCQl9CgkJCWlmIChyZXNvbHZlZCAhPT0gbm9uZSkgY2FsbGJhY2soInJlc29sdmUiLCBzdWNjZXNzKShyZXNvbHZlZCkKCQkJZWxzZSBpZiAocmVqZWN0ZWQgIT09IG5vbmUpIGNhbGxiYWNrKCJyZWplY3QiLCBlcnJvcikocmVqZWN0ZWQpCgkJCWVsc2UgewoJCQkJcmVzb2x2ZXJzLnB1c2goY2FsbGJhY2soInJlc29sdmUiLCBzdWNjZXNzKSkKCQkJCXJlamVjdGVycy5wdXNoKGNhbGxiYWNrKCJyZWplY3QiLCBlcnJvcikpCgkJCX0KCQkJcmV0dXJuIG5leHQucHJvbWlzZQoJCX0KCQlyZXR1cm4gb2JqZWN0Cgl9CgltLnN5bmMgPSBmdW5jdGlvbihhcmdzKSB7CgkJdmFyIG1ldGhvZCA9ICJyZXNvbHZlIgoJCWZ1bmN0aW9uIHN5bmNocm9uaXplcihwb3MsIHJlc29sdmVkKSB7CgkJCXJldHVybiBmdW5jdGlvbih2YWx1ZSkgewoJCQkJcmVzdWx0c1twb3NdID0gdmFsdWUKCQkJCWlmICghcmVzb2x2ZWQpIG1ldGhvZCA9ICJyZWplY3QiCgkJCQlpZiAoLS1vdXRzdGFuZGluZyA9PSAwKSB7CgkJCQkJZGVmZXJyZWQucHJvbWlzZShyZXN1bHRzKQoJCQkJCWRlZmVycmVkW21ldGhvZF0ocmVzdWx0cykKCQkJCX0KCQkJCXJldHVybiB2YWx1ZQoJCQl9CgkJfQoKCQl2YXIgZGVmZXJyZWQgPSBtLmRlZmVycmVkKCkKCQl2YXIgb3V0c3RhbmRpbmcgPSBhcmdzLmxlbmd0aAoJCXZhciByZXN1bHRzID0gbmV3IEFycmF5KG91dHN0YW5kaW5nKQoJCWZvciAodmFyIGkgPSAwOyBpIDwgYXJncy5sZW5ndGg7IGkrKykgewoJCQlhcmdzW2ldLnRoZW4oc3luY2hyb25pemVyKGksIHRydWUpLCBzeW5jaHJvbml6ZXIoaSwgZmFsc2UpKQoJCX0KCQlyZXR1cm4gZGVmZXJyZWQucHJvbWlzZQoJfQoJZnVuY3Rpb24gaWRlbnRpdHkodmFsdWUpIHtyZXR1cm4gdmFsdWV9CgoJZnVuY3Rpb24gYWpheChvcHRpb25zKSB7CgkJdmFyIHhociA9IG5ldyB3aW5kb3cuWE1MSHR0cFJlcXVlc3QKCQl4aHIub3BlbihvcHRpb25zLm1ldGhvZCwgb3B0aW9ucy51cmwsIHRydWUsIG9wdGlvbnMudXNlciwgb3B0aW9ucy5wYXNzd29yZCkKCQl4aHIub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24oKSB7CgkJCWlmICh4aHIucmVhZHlTdGF0ZSA9PT0gNCkgewoJCQkJaWYgKHhoci5zdGF0dXMgPj0gMjAwICYmIHhoci5zdGF0dXMgPCAzMDApIG9wdGlvbnMub25sb2FkKHt0eXBlOiAibG9hZCIsIHRhcmdldDogeGhyfSkKCQkJCWVsc2Ugb3B0aW9ucy5vbmVycm9yKHt0eXBlOiAiZXJyb3IiLCB0YXJnZXQ6IHhocn0pCgkJCX0KCQl9CgkJaWYgKG9wdGlvbnMuc2VyaWFsaXplID09IEpTT04uc3RyaW5naWZ5ICYmIG9wdGlvbnMubWV0aG9kICE9ICJHRVQiKSB7CgkJCXhoci5zZXRSZXF1ZXN0SGVhZGVyKCJDb250ZW50LVR5cGUiLCAiYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD11dGYtOCIpOwoJCX0KCQlpZiAodHlwZW9mIG9wdGlvbnMuY29uZmlnID09ICJmdW5jdGlvbiIpIHsKCQkJdmFyIG1heWJlWGhyID0gb3B0aW9ucy5jb25maWcoeGhyLCBvcHRpb25zKQoJCQlpZiAobWF5YmVYaHIgIT09IHVuZGVmaW5lZCkgeGhyID0gbWF5YmVYaHIKCQl9CgkJeGhyLnNlbmQob3B0aW9ucy5tZXRob2QgPT0gIkdFVCIgPyAiIiA6IG9wdGlvbnMuZGF0YSkKCQlyZXR1cm4geGhyCgl9CglmdW5jdGlvbiBiaW5kRGF0YSh4aHJPcHRpb25zLCBkYXRhLCBzZXJpYWxpemUpIHsKCQlpZiAoZGF0YSAmJiBPYmplY3Qua2V5cyhkYXRhKS5sZW5ndGggPiAwKSB7CgkJCWlmICh4aHJPcHRpb25zLm1ldGhvZCA9PSAiR0VUIikgewoJCQkJeGhyT3B0aW9ucy51cmwgPSB4aHJPcHRpb25zLnVybCArICh4aHJPcHRpb25zLnVybC5pbmRleE9mKCI/IikgPCAwID8gIj8iIDogIiYiKSArIGJ1aWxkUXVlcnlTdHJpbmcoZGF0YSkKCQkJfQoJCQllbHNlIHhock9wdGlvbnMuZGF0YSA9IHNlcmlhbGl6ZShkYXRhKQoJCX0KCQlyZXR1cm4geGhyT3B0aW9ucwoJfQoJZnVuY3Rpb24gcGFyYW1ldGVyaXplVXJsKHVybCwgZGF0YSkgewoJCXZhciB0b2tlbnMgPSB1cmwubWF0Y2goLzpbYS16XVx3Ky9naSkKCQlpZiAodG9rZW5zICYmIGRhdGEpIHsKCQkJZm9yICh2YXIgaSA9IDA7IGkgPCB0b2tlbnMubGVuZ3RoOyBpKyspIHsKCQkJCXZhciBrZXkgPSB0b2tlbnNbaV0uc2xpY2UoMSkKCQkJCXVybCA9IHVybC5yZXBsYWNlKHRva2Vuc1tpXSwgZGF0YVtrZXldKQoJCQkJZGVsZXRlIGRhdGFba2V5XQoJCQl9CgkJfQoJCXJldHVybiB1cmwKCX0KCgltLnJlcXVlc3QgPSBmdW5jdGlvbih4aHJPcHRpb25zKSB7CgkJaWYgKHhock9wdGlvbnMuYmFja2dyb3VuZCAhPT0gdHJ1ZSkgbS5zdGFydENvbXB1dGF0aW9uKCkKCQl2YXIgZGVmZXJyZWQgPSBtLmRlZmVycmVkKCkKCQl2YXIgc2VyaWFsaXplID0geGhyT3B0aW9ucy5zZXJpYWxpemUgPSB4aHJPcHRpb25zLnNlcmlhbGl6ZSB8fCBKU09OLnN0cmluZ2lmeQoJCXZhciBkZXNlcmlhbGl6ZSA9IHhock9wdGlvbnMuZGVzZXJpYWxpemUgPSB4aHJPcHRpb25zLmRlc2VyaWFsaXplIHx8IEpTT04ucGFyc2UKCQl2YXIgZXh0cmFjdCA9IHhock9wdGlvbnMuZXh0cmFjdCB8fCBmdW5jdGlvbih4aHIpIHsKCQkJcmV0dXJuIHhoci5yZXNwb25zZVRleHQubGVuZ3RoID09PSAwICYmIGRlc2VyaWFsaXplID09PSBKU09OLnBhcnNlID8gbnVsbCA6IHhoci5yZXNwb25zZVRleHQKCQl9CgkJeGhyT3B0aW9ucy51cmwgPSBwYXJhbWV0ZXJpemVVcmwoeGhyT3B0aW9ucy51cmwsIHhock9wdGlvbnMuZGF0YSkKCQl4aHJPcHRpb25zID0gYmluZERhdGEoeGhyT3B0aW9ucywgeGhyT3B0aW9ucy5kYXRhLCBzZXJpYWxpemUpCgkJeGhyT3B0aW9ucy5vbmxvYWQgPSB4aHJPcHRpb25zLm9uZXJyb3IgPSBmdW5jdGlvbihlKSB7CgkJCXRyeSB7CgkJCQllID0gZSB8fCBldmVudAoJCQkJdmFyIHVud3JhcCA9IChlLnR5cGUgPT0gImxvYWQiID8geGhyT3B0aW9ucy51bndyYXBTdWNjZXNzIDogeGhyT3B0aW9ucy51bndyYXBFcnJvcikgfHwgaWRlbnRpdHkKCQkJCXZhciByZXNwb25zZSA9IHVud3JhcChkZXNlcmlhbGl6ZShleHRyYWN0KGUudGFyZ2V0LCB4aHJPcHRpb25zKSkpCgkJCQlpZiAoZS50eXBlID09ICJsb2FkIikgewoJCQkJCWlmIChyZXNwb25zZSBpbnN0YW5jZW9mIEFycmF5ICYmIHhock9wdGlvbnMudHlwZSkgewoJCQkJCQlmb3IgKHZhciBpID0gMDsgaSA8IHJlc3BvbnNlLmxlbmd0aDsgaSsrKSByZXNwb25zZVtpXSA9IG5ldyB4aHJPcHRpb25zLnR5cGUocmVzcG9uc2VbaV0pCgkJCQkJfQoJCQkJCWVsc2UgaWYgKHhock9wdGlvbnMudHlwZSkgcmVzcG9uc2UgPSBuZXcgeGhyT3B0aW9ucy50eXBlKHJlc3BvbnNlKQoJCQkJfQoJCQkJZGVmZXJyZWRbZS50eXBlID09ICJsb2FkIiA/ICJyZXNvbHZlIiA6ICJyZWplY3QiXShyZXNwb25zZSkKCQkJfQoJCQljYXRjaCAoZSkgewoJCQkJaWYgKGUgaW5zdGFuY2VvZiBTeW50YXhFcnJvcikgdGhyb3cgbmV3IFN5bnRheEVycm9yKCJDb3VsZCBub3QgcGFyc2UgSFRUUCByZXNwb25zZS4gU2VlIGh0dHA6Ly9saG9yaWUuZ2l0aHViLmlvL21pdGhyaWwvbWl0aHJpbC5yZXF1ZXN0Lmh0bWwjdXNpbmctdmFyaWFibGUtZGF0YS1mb3JtYXRzIikKCQkJCWVsc2UgaWYgKGUgaW5zdGFuY2VvZiBFcnJvciAmJiBlLmNvbnN0cnVjdG9yICE9PSBFcnJvcikgdGhyb3cgZQoJCQkJZWxzZSBkZWZlcnJlZC5yZWplY3QoZSkKCQkJfQoJCQlpZiAoeGhyT3B0aW9ucy5iYWNrZ3JvdW5kICE9PSB0cnVlKSBtLmVuZENvbXB1dGF0aW9uKCkKCQl9CgkJYWpheCh4aHJPcHRpb25zKQoJCXJldHVybiBkZWZlcnJlZC5wcm9taXNlCgl9CgoJLy90ZXN0aW5nIEFQSQoJbS5kZXBzID0gZnVuY3Rpb24obW9jaykge3JldHVybiB3aW5kb3cgPSBtb2NrfQoJLy9mb3IgaW50ZXJuYWwgdGVzdGluZyBvbmx5LCBkbyBub3QgdXNlIGBtLmRlcHMuZmFjdG9yeWAKCW0uZGVwcy5mYWN0b3J5ID0gYXBwCgoJcmV0dXJuIG0KfSh0eXBlb2Ygd2luZG93ICE9ICJ1bmRlZmluZWQiID8gd2luZG93IDoge30pCgppZiAodHlwZW9mIG1vZHVsZSAhPSAidW5kZWZpbmVkIiAmJiBtb2R1bGUgIT09IG51bGwpIG1vZHVsZS5leHBvcnRzID0gbQppZiAodHlwZW9mIGRlZmluZSA9PSAiZnVuY3Rpb24iICYmIGRlZmluZS5hbWQpIGRlZmluZShmdW5jdGlvbigpIHtyZXR1cm4gbX0pCgo7OzsKCmZ1bmN0aW9uIHRlc3QoY29uZGl0aW9uKSB7Cgl0cnkge2lmICghY29uZGl0aW9uKCkpIHRocm93IG5ldyBFcnJvcn0KCWNhdGNoIChlKSB7Y29uc29sZS5lcnJvcihlKTt0ZXN0LmZhaWx1cmVzLnB1c2goY29uZGl0aW9uKX0KCXRlc3QudG90YWwrKwp9CnRlc3QudG90YWwgPSAwCnRlc3QuZmFpbHVyZXMgPSBbXQp0ZXN0LnByaW50ID0gZnVuY3Rpb24ocHJpbnQpIHsKCWZvciAodmFyIGkgPSAwOyBpIDwgdGVzdC5mYWlsdXJlcy5sZW5ndGg7IGkrKykgewoJCXByaW50KHRlc3QuZmFpbHVyZXNbaV0udG9TdHJpbmcoKSkKCX0KCXByaW50KCJ0ZXN0czogIiArIHRlc3QudG90YWwgKyAiXG5mYWlsdXJlczogIiArIHRlc3QuZmFpbHVyZXMubGVuZ3RoKQoKCWlmICh0ZXN0LmZhaWx1cmVzLmxlbmd0aCA+IDApIHsKCQl0aHJvdyBuZXcgRXJyb3IodGVzdC5mYWlsdXJlcy5sZW5ndGggKyAiIHRlc3RzIGRpZCBub3QgcGFzcyIpCgl9Cn0KCnZhciBtb2NrID0ge30KbW9jay53aW5kb3cgPSBuZXcgZnVuY3Rpb24oKSB7Cgl2YXIgd2luZG93ID0ge30KCXdpbmRvdy5kb2N1bWVudCA9IHt9Cgl3aW5kb3cuZG9jdW1lbnQuY2hpbGROb2RlcyA9IFtdCgl3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCA9IGZ1bmN0aW9uKHRhZykgewoJCXJldHVybiB7CgkJCXN0eWxlOiB7fSwKCQkJY2hpbGROb2RlczogW10sCgkJCW5vZGVUeXBlOiAxLAoJCQlub2RlTmFtZTogdGFnLnRvVXBwZXJDYXNlKCksCgkJCWFwcGVuZENoaWxkOiB3aW5kb3cuZG9jdW1lbnQuYXBwZW5kQ2hpbGQsCgkJCXJlbW92ZUNoaWxkOiB3aW5kb3cuZG9jdW1lbnQucmVtb3ZlQ2hpbGQsCgkJCXJlcGxhY2VDaGlsZDogd2luZG93LmRvY3VtZW50LnJlcGxhY2VDaGlsZCwKCQkJaW5zZXJ0QmVmb3JlOiBmdW5jdGlvbihub2RlLCByZWZlcmVuY2UpIHsKCQkJCW5vZGUucGFyZW50Tm9kZSA9IHRoaXMKCQkJCXZhciByZWZlcmVuY2VJbmRleCA9IHRoaXMuY2hpbGROb2Rlcy5pbmRleE9mKHJlZmVyZW5jZSkKCQkJCWlmIChyZWZlcmVuY2VJbmRleCA8IDApIHRoaXMuY2hpbGROb2Rlcy5wdXNoKG5vZGUpCgkJCQllbHNlIHsKCQkJCQl2YXIgaW5kZXggPSB0aGlzLmNoaWxkTm9kZXMuaW5kZXhPZihub2RlKQoJCQkJCWlmIChpbmRleCA+IC0xKSB0aGlzLmNoaWxkTm9kZXMuc3BsaWNlKGluZGV4LCAxKQoJCQkJCXRoaXMuY2hpbGROb2Rlcy5zcGxpY2UocmVmZXJlbmNlSW5kZXgsIDAsIG5vZGUpCgkJCQl9CgkJCX0sCgkJCWluc2VydEFkamFjZW50SFRNTDogZnVuY3Rpb24ocG9zaXRpb24sIGh0bWwpIHsKCQkJCS8vdG9kbzogYWNjZXB0IG1hcmt1cAoJCQkJaWYgKHBvc2l0aW9uID09ICJiZWZvcmViZWdpbiIpIHsKCQkJCQl0aGlzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHdpbmRvdy5kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShodG1sKSwgdGhpcykKCQkJCX0KCQkJCWVsc2UgaWYgKHBvc2l0aW9uID09ICJiZWZvcmVlbmQiKSB7CgkJCQkJdGhpcy5hcHBlbmRDaGlsZCh3aW5kb3cuZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoaHRtbCkpCgkJCQl9CgkJCX0sCgkJCXNldEF0dHJpYnV0ZTogZnVuY3Rpb24obmFtZSwgdmFsdWUpIHsKCQkJCXRoaXNbbmFtZV0gPSB2YWx1ZS50b1N0cmluZygpCgkJCX0sCgkJCXNldEF0dHJpYnV0ZU5TOiBmdW5jdGlvbihuYW1lc3BhY2UsIG5hbWUsIHZhbHVlKSB7CgkJCQl0aGlzLm5hbWVzcGFjZVVSSSA9IG5hbWVzcGFjZQoJCQkJdGhpc1tuYW1lXSA9IHZhbHVlLnRvU3RyaW5nKCkKCQkJfSwKCQkJZ2V0QXR0cmlidXRlOiBmdW5jdGlvbihuYW1lLCB2YWx1ZSkgewoJCQkJcmV0dXJuIHRoaXNbbmFtZV0KCQkJfQoJCX0KCX0KCXdpbmRvdy5kb2N1bWVudC5jcmVhdGVFbGVtZW50TlMgPSBmdW5jdGlvbihuYW1lc3BhY2UsIHRhZykgewoJCXZhciBlbGVtZW50ID0gd2luZG93LmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKQoJCWVsZW1lbnQubmFtZXNwYWNlVVJJID0gbmFtZXNwYWNlCgkJcmV0dXJuIGVsZW1lbnQKCX0KCXdpbmRvdy5kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSA9IGZ1bmN0aW9uKHRleHQpIHsKCQlyZXR1cm4ge25vZGVWYWx1ZTogdGV4dC50b1N0cmluZygpfQoJfQoJd2luZG93LmRvY3VtZW50LmRvY3VtZW50RWxlbWVudCA9IHdpbmRvdy5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJodG1sIikKCXdpbmRvdy5kb2N1bWVudC5yZXBsYWNlQ2hpbGQgPSBmdW5jdGlvbihuZXdDaGlsZCwgb2xkQ2hpbGQpIHsKCQl2YXIgaW5kZXggPSB0aGlzLmNoaWxkTm9kZXMuaW5kZXhPZihvbGRDaGlsZCkKCQlpZiAoaW5kZXggPiAtMSkgdGhpcy5jaGlsZE5vZGVzLnNwbGljZShpbmRleCwgMSwgbmV3Q2hpbGQpCgkJZWxzZSB0aGlzLmNoaWxkTm9kZXMucHVzaChuZXdDaGlsZCkKCQluZXdDaGlsZC5wYXJlbnROb2RlID0gdGhpcwoJCW9sZENoaWxkLnBhcmVudE5vZGUgPSBudWxsCgl9Cgl3aW5kb3cuZG9jdW1lbnQuYXBwZW5kQ2hpbGQgPSBmdW5jdGlvbihjaGlsZCkgewoJCXZhciBpbmRleCA9IHRoaXMuY2hpbGROb2Rlcy5pbmRleE9mKGNoaWxkKQoJCWlmIChpbmRleCA+IC0xKSB0aGlzLmNoaWxkTm9kZXMuc3BsaWNlKGluZGV4LCAxKQoJCXRoaXMuY2hpbGROb2Rlcy5wdXNoKGNoaWxkKQoJCWNoaWxkLnBhcmVudE5vZGUgPSB0aGlzCgl9Cgl3aW5kb3cuZG9jdW1lbnQucmVtb3ZlQ2hpbGQgPSBmdW5jdGlvbihjaGlsZCkgewoJCXZhciBpbmRleCA9IHRoaXMuY2hpbGROb2Rlcy5pbmRleE9mKGNoaWxkKQoJCXRoaXMuY2hpbGROb2Rlcy5zcGxpY2UoaW5kZXgsIDEpCgkJY2hpbGQucGFyZW50Tm9kZSA9IG51bGwKCX0KCXdpbmRvdy5zY3JvbGxUbyA9IGZ1bmN0aW9uKCkge30KCXdpbmRvdy5jYW5jZWxBbmltYXRpb25GcmFtZSA9IGZ1bmN0aW9uKCkge30KCXdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUgPSBmdW5jdGlvbihjYWxsYmFjaykgewoJCXdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJGNhbGxiYWNrID0gY2FsbGJhY2sKCQlyZXR1cm4gd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZS4kaWQrKwoJfQoJd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZS4kaWQgPSAxCgl3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlID0gZnVuY3Rpb24oKSB7CgkJaWYgKHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJGNhbGxiYWNrKSB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRjYWxsYmFjaygpCgkJd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZS4kY2FsbGJhY2sgPSBudWxsCgl9Cgl3aW5kb3cuWE1MSHR0cFJlcXVlc3QgPSBuZXcgZnVuY3Rpb24oKSB7CgkJdmFyIHJlcXVlc3QgPSBmdW5jdGlvbigpIHsKCQkJdGhpcy4kaGVhZGVycyA9IHt9CgkJCXRoaXMuc2V0UmVxdWVzdEhlYWRlciA9IGZ1bmN0aW9uKGtleSwgdmFsdWUpIHsKCQkJCXRoaXMuJGhlYWRlcnNba2V5XSA9IHZhbHVlCgkJCX0KCQkJdGhpcy5vcGVuID0gZnVuY3Rpb24obWV0aG9kLCB1cmwpIHsKCQkJCXRoaXMubWV0aG9kID0gbWV0aG9kCgkJCQl0aGlzLnVybCA9IHVybAoJCQl9CgkJCXRoaXMuc2VuZCA9IGZ1bmN0aW9uKCkgewoJCQkJdGhpcy5yZXNwb25zZVRleHQgPSBKU09OLnN0cmluZ2lmeSh0aGlzKQoJCQkJdGhpcy5yZWFkeVN0YXRlID0gNAoJCQkJdGhpcy5zdGF0dXMgPSAyMDAKCQkJCXJlcXVlc3QuJGluc3RhbmNlcy5wdXNoKHRoaXMpCgkJCX0KCQl9CgkJcmVxdWVzdC4kaW5zdGFuY2VzID0gW10KCQlyZXR1cm4gcmVxdWVzdAoJfQoJd2luZG93LmxvY2F0aW9uID0ge3NlYXJjaDogIiIsIHBhdGhuYW1lOiAiIiwgaGFzaDogIiJ9LAoJd2luZG93Lmhpc3RvcnkgPSB7fQoJd2luZG93Lmhpc3RvcnkucHVzaFN0YXRlID0gZnVuY3Rpb24oZGF0YSwgdGl0bGUsIHVybCkgewoJCXdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSA9IHdpbmRvdy5sb2NhdGlvbi5zZWFyY2ggPSB3aW5kb3cubG9jYXRpb24uaGFzaCA9IHVybAoJfSwKCXdpbmRvdy5oaXN0b3J5LnJlcGxhY2VTdGF0ZSA9IGZ1bmN0aW9uKGRhdGEsIHRpdGxlLCB1cmwpIHsKCQl3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUgPSB3aW5kb3cubG9jYXRpb24uc2VhcmNoID0gd2luZG93LmxvY2F0aW9uLmhhc2ggPSB1cmwKCX0KCXJldHVybiB3aW5kb3cKfQpmdW5jdGlvbiB0ZXN0TWl0aHJpbChtb2NrKSB7CgltLmRlcHMobW9jaykKCgkvL20KCXRlc3QoZnVuY3Rpb24oKSB7cmV0dXJuIG0oImRpdiIpLnRhZyA9PT0gImRpdiJ9KQoJdGVzdChmdW5jdGlvbigpIHtyZXR1cm4gbSgiLmZvbyIpLnRhZyA9PT0gImRpdiJ9KQoJdGVzdChmdW5jdGlvbigpIHtyZXR1cm4gbSgiLmZvbyIpLmF0dHJzLmNsYXNzTmFtZSA9PT0gImZvbyJ9KQoJdGVzdChmdW5jdGlvbigpIHtyZXR1cm4gbSgiW3RpdGxlPWJhcl0iKS50YWcgPT09ICJkaXYifSkKCXRlc3QoZnVuY3Rpb24oKSB7cmV0dXJuIG0oIlt0aXRsZT1iYXJdIikuYXR0cnMudGl0bGUgPT09ICJiYXIifSkKCXRlc3QoZnVuY3Rpb24oKSB7cmV0dXJuIG0oIlt0aXRsZT1cJ2JhclwnXSIpLmF0dHJzLnRpdGxlID09PSAiYmFyIn0pCgl0ZXN0KGZ1bmN0aW9uKCkge3JldHVybiBtKCJbdGl0bGU9XCJiYXJcIl0iKS5hdHRycy50aXRsZSA9PT0gImJhciJ9KQoJdGVzdChmdW5jdGlvbigpIHtyZXR1cm4gbSgiZGl2IiwgInRlc3QiKS5jaGlsZHJlbiA9PT0gInRlc3QifSkKCXRlc3QoZnVuY3Rpb24oKSB7cmV0dXJuIG0oImRpdiIsIFsidGVzdCJdKS5jaGlsZHJlblswXSA9PT0gInRlc3QifSkKCXRlc3QoZnVuY3Rpb24oKSB7cmV0dXJuIG0oImRpdiIsIHt0aXRsZTogImJhciJ9LCAidGVzdCIpLmF0dHJzLnRpdGxlID09PSAiYmFyIn0pCgl0ZXN0KGZ1bmN0aW9uKCkge3JldHVybiBtKCJkaXYiLCB7dGl0bGU6ICJiYXIifSwgInRlc3QiKS5jaGlsZHJlbiA9PT0gInRlc3QifSkKCXRlc3QoZnVuY3Rpb24oKSB7cmV0dXJuIG0oImRpdiIsIHt0aXRsZTogImJhciJ9LCBbInRlc3QiXSkuY2hpbGRyZW5bMF0gPT09ICJ0ZXN0In0pCgl0ZXN0KGZ1bmN0aW9uKCkge3JldHVybiBtKCJkaXYiLCB7dGl0bGU6ICJiYXIifSwgbSgiZGl2IikpLmNoaWxkcmVuLnRhZyA9PT0gImRpdiJ9KQoJdGVzdChmdW5jdGlvbigpIHtyZXR1cm4gbSgiZGl2Iiwge3RpdGxlOiAiYmFyIn0sIFttKCJkaXYiKV0pLmNoaWxkcmVuWzBdLnRhZyA9PT0gImRpdiJ9KQoJdGVzdChmdW5jdGlvbigpIHtyZXR1cm4gbSgiZGl2IiwgWyJhIiwgImIiXSkuY2hpbGRyZW4ubGVuZ3RoID09PSAyfSkKCXRlc3QoZnVuY3Rpb24oKSB7cmV0dXJuIG0oImRpdiIsIFttKCJkaXYiKV0pLmNoaWxkcmVuWzBdLnRhZyA9PT0gImRpdiJ9KQoJdGVzdChmdW5jdGlvbigpIHtyZXR1cm4gbSgiZGl2IiwgbSgiZGl2IikpLmNoaWxkcmVuLnRhZyA9PT0gImRpdiJ9KSAvL3llcywgdGhpcyBpcyBleHBlY3RlZCBiZWhhdmlvcjogc2VlIG1ldGhvZCBzaWduYXR1cmUKCXRlc3QoZnVuY3Rpb24oKSB7cmV0dXJuIG0oImRpdiIsIFt1bmRlZmluZWRdKS50YWcgPT09ICJkaXYifSkKCXRlc3QoZnVuY3Rpb24oKSB7cmV0dXJuIG0oImRpdiIsIFt7Zm9vOiAiYmFyIn1dKX0pIC8vYXMgbG9uZyBhcyBpdCBkb2Vzbid0IHRocm93IGVycm9ycywgaXQncyBmaW5lCgl0ZXN0KGZ1bmN0aW9uKCkge3JldHVybiBtKCJzdmciLCBbbSgiZyIpXSl9KQoJdGVzdChmdW5jdGlvbigpIHtyZXR1cm4gbSgic3ZnIiwgW20oImFbaHJlZj0naHR0cDovL2dvb2dsZS5jb20nXSIpXSl9KQoJdGVzdChmdW5jdGlvbigpIHtyZXR1cm4gbSgiLmZvbyIsIHtjbGFzczogImJhciJ9KS5hdHRycy5jbGFzcyA9PSAiZm9vIGJhciJ9KQoJdGVzdChmdW5jdGlvbigpIHtyZXR1cm4gbSgiLmZvbyIsIHtjbGFzc05hbWU6ICJiYXIifSkuYXR0cnMuY2xhc3NOYW1lID09ICJmb28gYmFyIn0pCgoJLy9tLm1vZHVsZQoJdGVzdChmdW5jdGlvbigpIHsKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpCgoJCXZhciByb290MSA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLm1vZHVsZShyb290MSwgewoJCQljb250cm9sbGVyOiBmdW5jdGlvbigpIHt0aGlzLnZhbHVlID0gInRlc3QxIn0sCgkJCXZpZXc6IGZ1bmN0aW9uKGN0cmwpIHtyZXR1cm4gY3RybC52YWx1ZX0KCQl9KQoKCQl2YXIgcm9vdDIgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5tb2R1bGUocm9vdDIsIHsKCQkJY29udHJvbGxlcjogZnVuY3Rpb24oKSB7dGhpcy52YWx1ZSA9ICJ0ZXN0MiJ9LAoJCQl2aWV3OiBmdW5jdGlvbihjdHJsKSB7cmV0dXJuIGN0cmwudmFsdWV9CgkJfSkKCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKQoKCQlyZXR1cm4gcm9vdDEuY2hpbGROb2Rlc1swXS5ub2RlVmFsdWUgPT09ICJ0ZXN0MSIgJiYgcm9vdDIuY2hpbGROb2Rlc1swXS5ub2RlVmFsdWUgPT09ICJ0ZXN0MiIKCX0pCgoJLy9tLndpdGhBdHRyCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciB2YWx1ZQoJCXZhciBoYW5kbGVyID0gbS53aXRoQXR0cigidGVzdCIsIGZ1bmN0aW9uKGRhdGEpIHt2YWx1ZSA9IGRhdGF9KQoJCWhhbmRsZXIoe2N1cnJlbnRUYXJnZXQ6IHt0ZXN0OiAiZm9vIn19KQoJCXJldHVybiB2YWx1ZSA9PT0gImZvbyIKCX0pCgoJLy9tLnRydXN0Cgl0ZXN0KGZ1bmN0aW9uKCkge3JldHVybiBtLnRydXN0KCJ0ZXN0IikudmFsdWVPZigpID09PSAidGVzdCJ9KQoKCS8vbS5yZW5kZXIKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgInRlc3QiKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlID09PSAidGVzdCIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIHtjbGFzczogImEifSkpCgkJdmFyIGVsZW1lbnRCZWZvcmUgPSByb290LmNoaWxkTm9kZXNbMF0KCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCB7Y2xhc3M6ICJiIn0pKQoJCXZhciBlbGVtZW50QWZ0ZXIgPSByb290LmNoaWxkTm9kZXNbMF0KCQlyZXR1cm4gZWxlbWVudEJlZm9yZSA9PT0gZWxlbWVudEFmdGVyCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCIuYSIpKQoJCXZhciBlbGVtZW50QmVmb3JlID0gcm9vdC5jaGlsZE5vZGVzWzBdCgkJbS5yZW5kZXIocm9vdCwgbSgiLmIiKSkKCQl2YXIgZWxlbWVudEFmdGVyID0gcm9vdC5jaGlsZE5vZGVzWzBdCgkJcmV0dXJuIGVsZW1lbnRCZWZvcmUgPT09IGVsZW1lbnRBZnRlcgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2Iiwge2lkOiAiYSJ9KSkKCQl2YXIgZWxlbWVudEJlZm9yZSA9IHJvb3QuY2hpbGROb2Rlc1swXQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIHt0aXRsZTogImIifSkpCgkJdmFyIGVsZW1lbnRBZnRlciA9IHJvb3QuY2hpbGROb2Rlc1swXQoJCXJldHVybiBlbGVtZW50QmVmb3JlICE9PSBlbGVtZW50QWZ0ZXIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oIiNhIikpCgkJdmFyIGVsZW1lbnRCZWZvcmUgPSByb290LmNoaWxkTm9kZXNbMF0KCQltLnJlbmRlcihyb290LCBtKCJbdGl0bGU9Yl0iKSkKCQl2YXIgZWxlbWVudEFmdGVyID0gcm9vdC5jaGlsZE5vZGVzWzBdCgkJcmV0dXJuIGVsZW1lbnRCZWZvcmUgIT09IGVsZW1lbnRBZnRlcgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgiI2EiKSkKCQl2YXIgZWxlbWVudEJlZm9yZSA9IHJvb3QuY2hpbGROb2Rlc1swXQoJCW0ucmVuZGVyKHJvb3QsICJ0ZXN0IikKCQl2YXIgZWxlbWVudEFmdGVyID0gcm9vdC5jaGlsZE5vZGVzWzBdCgkJcmV0dXJuIGVsZW1lbnRCZWZvcmUgIT09IGVsZW1lbnRBZnRlcgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2IiwgW3VuZGVmaW5lZF0pKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1swXS5ub2RlVmFsdWUgPT09ICIiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCJzdmciLCBbbSgiZyIpXSkpCgkJdmFyIGcgPSByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1swXQoJCXJldHVybiBnLm5vZGVOYW1lID09PSAiRyIgJiYgZy5uYW1lc3BhY2VVUkkgPT0gImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgic3ZnIiwgW20oImFbaHJlZj0naHR0cDovL2dvb2dsZS5jb20nXSIpXSkpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzBdLm5vZGVOYW1lID09PSAiQSIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdi5jbGFzc25hbWUiLCBbbSgiYSIsIHtocmVmOiAiL2ZpcnN0In0pXSkpCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2IiwgW20oImEiLCB7aHJlZjogIi9zZWNvbmQifSldKSkKCQlyZXR1cm4gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXMubGVuZ3RoID09IDEKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oInVsIiwgW20oImxpIildKSkKCQltLnJlbmRlcihyb290LCBtKCJ1bCIsIFttKCJsaSIpLCB1bmRlZmluZWRdKSkKCQlyZXR1cm4gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMV0ubm9kZVZhbHVlID09PSAiIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgidWwiLCBbbSgibGkiKSwgbSgibGkiKV0pKQoJCW0ucmVuZGVyKHJvb3QsIG0oInVsIiwgW20oImxpIiksIHVuZGVmaW5lZF0pKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlcy5sZW5ndGggPT0gMiAmJiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1sxXS5ub2RlVmFsdWUgPT09ICIiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCJ1bCIsIFttKCJsaSIpXSkpCgkJbS5yZW5kZXIocm9vdCwgbSgidWwiLCBbdW5kZWZpbmVkXSkpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZSA9PT0gIiIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oInVsIiwgW20oImxpIildKSkKCQltLnJlbmRlcihyb290LCBtKCJ1bCIsIFt7fV0pKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlcy5sZW5ndGggPT09IDAKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oInVsIiwgW20oImxpIiwgW20oImEiKV0pXSkpCgkJbS5yZW5kZXIocm9vdCwgbSgidWwiLCBbe3N1YnRyZWU6ICJyZXRhaW4ifV0pKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzBdLm5vZGVOYW1lID09PSAiQSIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy80MwoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oImEiLCB7Y29uZmlnOiBtLnJvdXRlfSwgInRlc3QiKSkKCQltLnJlbmRlcihyb290LCBtKCJhIiwge2NvbmZpZzogbS5yb3V0ZX0sICJ0ZXN0IikpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZSA9PT0gInRlc3QiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvMjkKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQl2YXIgbGlzdCA9IFtmYWxzZSwgZmFsc2VdCgkJbS5yZW5kZXIocm9vdCwgbGlzdC5yZXZlcnNlKCkubWFwKGZ1bmN0aW9uKGZsYWcsIGluZGV4KSB7CgkJCXJldHVybiBtKCJpbnB1dFt0eXBlPWNoZWNrYm94XSIsIHtvbmNsaWNrOiBtLndpdGhBdHRyKCJjaGVja2VkIiwgZnVuY3Rpb24odmFsdWUpIHtsaXN0W2luZGV4XSA9IHZhbHVlfSksIGNoZWNrZWQ6IGZsYWd9KQoJCX0pKQoKCQltb2NrLmRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgPSByb290LmNoaWxkTm9kZXNbMF0KCQlyb290LmNoaWxkTm9kZXNbMF0uY2hlY2tlZCA9IHRydWUKCQlyb290LmNoaWxkTm9kZXNbMF0ub25jbGljayh7Y3VycmVudFRhcmdldDoge2NoZWNrZWQ6IHRydWV9fSkKCgkJbS5yZW5kZXIocm9vdCwgbGlzdC5yZXZlcnNlKCkubWFwKGZ1bmN0aW9uKGZsYWcsIGluZGV4KSB7CgkJCXJldHVybiBtKCJpbnB1dFt0eXBlPWNoZWNrYm94XSIsIHtvbmNsaWNrOiBtLndpdGhBdHRyKCJjaGVja2VkIiwgZnVuY3Rpb24odmFsdWUpIHtsaXN0W2luZGV4XSA9IHZhbHVlfSksIGNoZWNrZWQ6IGZsYWd9KQoJCX0pKQoKCQltb2NrLmRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgPSBudWxsCgoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uY2hlY2tlZCA9PT0gZmFsc2UgJiYgcm9vdC5jaGlsZE5vZGVzWzFdLmNoZWNrZWQgPT09IHRydWUKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy80NCAoMSkKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCIjZm9vIiwgW251bGwsIG0oIiNiYXIiKV0pKQoJCW0ucmVuZGVyKHJvb3QsIG0oIiNmb28iLCBbInRlc3QiLCBtKCIjYmFyIildKSkKCQlyZXR1cm4gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlID09PSAidGVzdCIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy80NCAoMikKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCIjZm9vIiwgW251bGwsIG0oIiNiYXIiKV0pKQoJCW0ucmVuZGVyKHJvb3QsIG0oIiNmb28iLCBbbSgiZGl2IiksIG0oIiNiYXIiKV0pKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1swXS5ub2RlTmFtZSA9PT0gIkRJViIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy80NCAoMykKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCIjZm9vIiwgWyJ0ZXN0IiwgbSgiI2JhciIpXSkpCgkJbS5yZW5kZXIocm9vdCwgbSgiI2ZvbyIsIFttKCJkaXYiKSwgbSgiI2JhciIpXSkpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzBdLm5vZGVOYW1lID09PSAiRElWIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzQ0ICg0KQoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oIiNmb28iLCBbbSgiZGl2IiksIG0oIiNiYXIiKV0pKQoJCW0ucmVuZGVyKHJvb3QsIG0oIiNmb28iLCBbInRlc3QiLCBtKCIjYmFyIildKSkKCQlyZXR1cm4gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlID09PSAidGVzdCIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy80NCAoNSkKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCIjZm9vIiwgW20oIiNiYXIiKV0pKQoJCW0ucmVuZGVyKHJvb3QsIG0oIiNmb28iLCBbbSgiI2JhciIpLCBbbSgiI2JheiIpXV0pKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1sxXS5pZCA9PT0gImJheiIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy80OAoJCXZhciByb290ID0gbW9jay5kb2N1bWVudAoJCW0ucmVuZGVyKHJvb3QsIG0oImh0bWwiLCBbbSgiI2ZvbyIpXSkpCgkJdmFyIHJlc3VsdCA9IHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzBdLmlkID09PSAiZm9vIgoJCXJvb3QuY2hpbGROb2RlcyA9IFttb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImh0bWwiKV0KCQlyZXR1cm4gcmVzdWx0Cgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvNDkKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCJhIiwgInRlc3QiKSkKCQltLnJlbmRlcihyb290LCBtKCJhLmZvbyIsICJ0ZXN0IikpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZSA9PT0gInRlc3QiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvNDkKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCJhLmZvbyIsICJ0ZXN0IikpCgkJbS5yZW5kZXIocm9vdCwgbSgiYSIsICJ0ZXN0IikpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZSA9PT0gInRlc3QiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvNDkKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCJhLmZvbyIsICJ0ZXN0IikpCgkJbS5yZW5kZXIocm9vdCwgbSgiYSIsICJ0ZXN0MSIpKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1swXS5ub2RlVmFsdWUgPT09ICJ0ZXN0MSIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy80OQoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oImEiLCAidGVzdCIpKQoJCW0ucmVuZGVyKHJvb3QsIG0oImEiLCAidGVzdDEiKSkKCQlyZXR1cm4gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlID09PSAidGVzdDEiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvNTAKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCIjZm9vIiwgW1ttKCJkaXYiLCAiYSIpLCBtKCJkaXYiLCAiYiIpXSwgbSgiI2JhciIpXSkpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzFdLmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlID09PSAiYiIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy81MAoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oIiNmb28iLCBbW20oImRpdiIsICJhIiksIG0oImRpdiIsICJiIildLCBtKCIjYmFyIildKSkKCQltLnJlbmRlcihyb290LCBtKCIjZm9vIiwgW1ttKCJkaXYiLCAiYSIpLCBtKCJkaXYiLCAiYiIpLCBtKCJkaXYiLCAiYyIpXSwgbSgiI2JhciIpXSkpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzJdLmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlID09PSAiYyIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy81MAoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oIiNmb28iLCBbW20oImRpdiIsICJhIiksIG0oImRpdiIsICJiIildLCBbbSgiZGl2IiwgImMiKSwgbSgiZGl2IiwgImQiKV0sIG0oIiNiYXIiKV0pKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1szXS5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZSA9PT0gImQiICYmIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzRdLmlkID09PSAiYmFyIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzUwCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgiI2ZvbyIsIFtbbSgiZGl2IiwgImEiKSwgbSgiZGl2IiwgImIiKV0sICJ0ZXN0Il0pKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1sxXS5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZSA9PT0gImIiICYmIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzJdLm5vZGVWYWx1ZSA9PT0gInRlc3QiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvNTAKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCIjZm9vIiwgW1siYSIsICJiIl0sICJ0ZXN0Il0pKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1sxXS5ub2RlVmFsdWUgPT09ICJiIiAmJiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1syXS5ub2RlVmFsdWUgPT09ICJ0ZXN0IgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzUxCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgibWFpbiIsIFttKCJidXR0b24iKSwgbSgiYXJ0aWNsZSIsIFttKCJzZWN0aW9uIiksIG0oIm5hdiIpXSldKSkKCQltLnJlbmRlcihyb290LCBtKCJtYWluIiwgW20oImJ1dHRvbiIpLCBtKCJhcnRpY2xlIiwgW20oInNwYW4iKSwgbSgibmF2IildKV0pKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1sxXS5jaGlsZE5vZGVzWzBdLm5vZGVOYW1lID09PSAiU1BBTiIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy81MQoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oIm1haW4iLCBbbSgiYnV0dG9uIiksIG0oImFydGljbGUiLCBbbSgic2VjdGlvbiIpLCBtKCJuYXYiKV0pXSkpCgkJbS5yZW5kZXIocm9vdCwgbSgibWFpbiIsIFttKCJidXR0b24iKSwgbSgiYXJ0aWNsZSIsIFsidGVzdCIsIG0oIm5hdiIpXSldKSkKCQlyZXR1cm4gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMV0uY2hpbGROb2Rlc1swXS5ub2RlVmFsdWUgPT09ICJ0ZXN0IgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzUxCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgibWFpbiIsIFttKCJidXR0b24iKSwgbSgiYXJ0aWNsZSIsIFttKCJzZWN0aW9uIiksIG0oIm5hdiIpXSldKSkKCQltLnJlbmRlcihyb290LCBtKCJtYWluIiwgW20oImJ1dHRvbiIpLCBtKCJhcnRpY2xlIiwgW20udHJ1c3QoInRlc3QiKSwgbSgibmF2IildKV0pKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1sxXS5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZSA9PT0gInRlc3QiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvNTUKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCIjYSIpKQoJCXZhciBlbGVtZW50QmVmb3JlID0gcm9vdC5jaGlsZE5vZGVzWzBdCgkJbS5yZW5kZXIocm9vdCwgbSgiI2IiKSkKCQl2YXIgZWxlbWVudEFmdGVyID0gcm9vdC5jaGlsZE5vZGVzWzBdCgkJcmV0dXJuIGVsZW1lbnRCZWZvcmUgIT09IGVsZW1lbnRBZnRlcgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzU2CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgW251bGwsICJmb28iXSkKCQltLnJlbmRlcihyb290LCBbImJhciJdKQoJCXJldHVybiByb290LmNoaWxkTm9kZXMubGVuZ3RoID09IDEKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy81NgoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsICJmb28iKSkKCQlyZXR1cm4gcm9vdC5jaGlsZE5vZGVzLmxlbmd0aCA9PSAxCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCBbbSgiYnV0dG9uIiksIG0oInVsIildKSkKCQl2YXIgdmFsdWVCZWZvcmUgPSByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1swXS5ub2RlTmFtZQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIFt1bmRlZmluZWQsIG0oInVsIildKSkKCQl2YXIgdmFsdWVBZnRlciA9IHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZQoJCXJldHVybiB2YWx1ZUJlZm9yZSA9PT0gIkJVVFRPTiIgJiYgdmFsdWVBZnRlciA9PT0gIiIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIFttKCJ1bCIpLCB1bmRlZmluZWRdKSkKCQl2YXIgdmFsdWVCZWZvcmUxID0gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMF0ubm9kZU5hbWUKCQl2YXIgdmFsdWVCZWZvcmUyID0gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMV0ubm9kZVZhbHVlCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2IiwgW3VuZGVmaW5lZCwgbSgidWwiKV0pKQoJCXZhciB2YWx1ZUFmdGVyMSA9IHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZQoJCXZhciB2YWx1ZUFmdGVyMiA9IHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzFdLm5vZGVOYW1lCgkJcmV0dXJuIHZhbHVlQmVmb3JlMSA9PT0gIlVMIiAmJiB2YWx1ZUFmdGVyMSA9PT0gIiIgJiYgdmFsdWVCZWZvcmUyID09PSAiIiAmJiB2YWx1ZUFmdGVyMiA9PT0gIlVMIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzc5CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2Iiwge3N0eWxlOiB7YmFja2dyb3VuZDogInJlZCJ9fSkpCgkJdmFyIHZhbHVlQmVmb3JlID0gcm9vdC5jaGlsZE5vZGVzWzBdLnN0eWxlLmJhY2tncm91bmQKCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCB7c3R5bGU6IHt9fSkpCgkJdmFyIHZhbHVlQWZ0ZXIgPSByb290LmNoaWxkTm9kZXNbMF0uc3R5bGUuYmFja2dyb3VuZAoJCXJldHVybiB2YWx1ZUJlZm9yZSA9PT0gInJlZCIgJiYgdmFsdWVBZnRlciA9PT0gIiIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdltzdHlsZT0nYmFja2dyb3VuZDpyZWQnXSIpKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uc3R5bGUgPT09ICJiYWNrZ3JvdW5kOnJlZCIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIHtzdHlsZToge2JhY2tncm91bmQ6ICJyZWQifX0pKQoJCXZhciB2YWx1ZUJlZm9yZSA9IHJvb3QuY2hpbGROb2Rlc1swXS5zdHlsZS5iYWNrZ3JvdW5kCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2Iiwge30pKQoJCXZhciB2YWx1ZUFmdGVyID0gcm9vdC5jaGlsZE5vZGVzWzBdLnN0eWxlLmJhY2tncm91bmQKCQlyZXR1cm4gdmFsdWVCZWZvcmUgPT09ICJyZWQiICYmIHZhbHVlQWZ0ZXIgPT09IHVuZGVmaW5lZAoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJdmFyIG1vZHVsZSA9IHt9LCB1bmxvYWRlZCA9IGZhbHNlCgkJbW9kdWxlLmNvbnRyb2xsZXIgPSBmdW5jdGlvbigpIHsKCQkJdGhpcy5vbnVubG9hZCA9IGZ1bmN0aW9uKCkge3VubG9hZGVkID0gdHJ1ZX0KCQl9CgkJbW9kdWxlLnZpZXcgPSBmdW5jdGlvbigpIHt9CgkJbS5tb2R1bGUocm9vdCwgbW9kdWxlKQoJCW0ubW9kdWxlKHJvb3QsIHtjb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LCB2aWV3OiBmdW5jdGlvbigpIHt9fSkKCQlyZXR1cm4gdW5sb2FkZWQgPT09IHRydWUKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy84NwoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIFtbbSgiYSIpLCBtKCJhIildLCBtKCJidXR0b24iKV0pKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIFtbbSgiYSIpXSwgbSgiYnV0dG9uIildKSkKCQlyZXR1cm4gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXMubGVuZ3RoID09IDIgJiYgcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMV0ubm9kZU5hbWUgPT0gIkJVVFRPTiIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy84NwoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIFttKCJhIiksIG0oImIiKSwgbSgiYnV0dG9uIildKSkKCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCBbbSgiYSIpLCBtKCJidXR0b24iKV0pKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlcy5sZW5ndGggPT0gMiAmJiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1sxXS5ub2RlTmFtZSA9PSAiQlVUVE9OIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzk5CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2IiwgW20oImltZyIpLCBtKCJoMSIpXSkpCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2IiwgW20oImEiKV0pKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlcy5sZW5ndGggPT0gMSAmJiByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1swXS5ub2RlTmFtZSA9PSAiQSIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy8xMjAKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCBbImEiLCAiYiIsICJjIiwgImQiXSkpCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2IiwgW1siZCIsICJlIl1dKSkKCQl2YXIgY2hpbGRyZW4gPSByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2RlcwoJCXJldHVybiBjaGlsZHJlbi5sZW5ndGggPT0gMiAmJiBjaGlsZHJlblswXS5ub2RlVmFsdWUgPT0gImQiICYmIGNoaWxkcmVuWzFdLm5vZGVWYWx1ZSA9PSAiZSIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy8xMjAKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCBbWyJhIiwgImIiLCAiYyIsICJkIl1dKSkKCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCBbImQiLCAiZSJdKSkKCQl2YXIgY2hpbGRyZW4gPSByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2RlcwoJCXJldHVybiBjaGlsZHJlbi5sZW5ndGggPT0gMiAmJiBjaGlsZHJlblswXS5ub2RlVmFsdWUgPT0gImQiICYmIGNoaWxkcmVuWzFdLm5vZGVWYWx1ZSA9PSAiZSIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy8xMjAKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCBbIngiLCBbWyJhIl0sICJiIiwgImMiLCAiZCJdXSkpCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2IiwgWyJkIiwgWyJlIl1dKSkKCQl2YXIgY2hpbGRyZW4gPSByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2RlcwoJCXJldHVybiBjaGlsZHJlbi5sZW5ndGggPT0gMiAmJiBjaGlsZHJlblswXS5ub2RlVmFsdWUgPT0gImQiICYmIGNoaWxkcmVuWzFdLm5vZGVWYWx1ZSA9PSAiZSIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy8xMjAKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCBbImIiXSkpCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2IiwgW1siZSJdXSkpCgkJdmFyIGNoaWxkcmVuID0gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXMKCQlyZXR1cm4gY2hpbGRyZW4ubGVuZ3RoID09IDEgJiYgY2hpbGRyZW5bMF0ubm9kZVZhbHVlID09ICJlIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzEyMAoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIFsiYSIsIFsiYiJdXSkpCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2IiwgWyJkIiwgW1siZSJdXV0pKQoJCXZhciBjaGlsZHJlbiA9IHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzCgkJcmV0dXJuIGNoaWxkcmVuLmxlbmd0aCA9PSAyICYmIGNoaWxkcmVuWzBdLm5vZGVWYWx1ZSA9PSAiZCIgJiYgY2hpbGRyZW5bMV0ubm9kZVZhbHVlID09ICJlIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzEyMAoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIFsiYSIsIFtbImIiXV1dKSkKCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCBbImQiLCBbImUiXV0pKQoJCXZhciBjaGlsZHJlbiA9IHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzCgkJcmV0dXJuIGNoaWxkcmVuLmxlbmd0aCA9PSAyICYmIGNoaWxkcmVuWzBdLm5vZGVWYWx1ZSA9PSAiZCIgJiYgY2hpbGRyZW5bMV0ubm9kZVZhbHVlID09ICJlIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzEyMAoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIFsiYSIsIFtbImIiXSwgImMiXV0pKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIFsiZCIsIFtbWyJlIl1dLCAieCJdXSkpCgkJdmFyIGNoaWxkcmVuID0gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXMKCQlyZXR1cm4gY2hpbGRyZW4ubGVuZ3RoID09IDMgJiYgY2hpbGRyZW5bMF0ubm9kZVZhbHVlID09ICJkIiAmJiBjaGlsZHJlblsxXS5ub2RlVmFsdWUgPT0gImUiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCgkJdmFyIHN1Y2Nlc3MgPSBmYWxzZQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIHtjb25maWc6IGZ1bmN0aW9uKGVsZW0sIGlzSW5pdGlhbGl6ZWQsIGN0eCkge2N0eC5kYXRhID0gMX19KSkKCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCB7Y29uZmlnOiBmdW5jdGlvbihlbGVtLCBpc0luaXRpYWxpemVkLCBjdHgpIHtzdWNjZXNzID0gY3R4LmRhdGEgPT09IDF9fSkpCgkJcmV0dXJuIHN1Y2Nlc3MKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoKCQl2YXIgaW5kZXggPSAwOwoJCXZhciBzdWNjZXNzID0gdHJ1ZTsKCQl2YXIgc3RhdGVmdWxDb25maWcgPSBmdW5jdGlvbihlbGVtLCBpc0luaXRpYWxpemVkLCBjdHgpIHtjdHguZGF0YSA9IGluZGV4Kyt9CgkJdmFyIG5vZGUgPSBtKCJkaXYiLCB7Y29uZmlnOiBzdGF0ZWZ1bENvbmZpZ30pOwoJCW0ucmVuZGVyKHJvb3QsIFtub2RlLCBub2RlXSk7CgoJCWluZGV4ID0gMDsKCQl2YXIgY2hlY2tDb25maWcgPSBmdW5jdGlvbihlbGVtLCBpc0luaXRpYWxpemVkLCBjdHgpIHsKCQkJc3VjY2VzcyA9IHN1Y2Nlc3MgJiYgKGN0eC5kYXRhID09PSBpbmRleCsrKQoJCX0KCQlub2RlID0gbSgiZGl2Iiwge2NvbmZpZzogY2hlY2tDb25maWd9KTsKCQltLnJlbmRlcihyb290LCBbbm9kZSwgbm9kZV0pOwoJCXJldHVybiBzdWNjZXNzOwoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJdmFyIHBhcmVudAoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIG0oImEiLCB7CgkJCWNvbmZpZzogZnVuY3Rpb24oZWwpIHtwYXJlbnQgPSBlbC5wYXJlbnROb2RlLnBhcmVudE5vZGV9CgkJfSkpKTsKCQlyZXR1cm4gcGFyZW50ID09PSByb290Cgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQl2YXIgY291bnQgPSAwCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2IiwgbSgiYSIsIHsKCQkJY29uZmlnOiBmdW5jdGlvbihlbCkgewoJCQkJdmFyIGlzbGFuZCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQkJCWNvdW50KysKCQkJCWlmIChjb3VudCA+IDIpIHRocm93ICJ0b28gbXVjaCByZWN1cnNpb24uLi4iCgkJCQltLnJlbmRlcihpc2xhbmQsIG0oImRpdiIpKQoJCQl9CgkJfSkpKTsKCQlyZXR1cm4gY291bnQgPT0gMQoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzEyOQoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIFtbImZvbyIsICJiYXIiXSwgWyJmb28iLCAiYmFyIl0sIFsiZm9vIiwgImJhciJdXSkpOwoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIFsiYXNkZiIsICJhc2RmMiIsICJhc2RmMyJdKSk7CgkJcmV0dXJuIHRydWUKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy85OAoJCS8vaW5zZXJ0IGF0IGJlZ2lubmluZwoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIFttKCJhIiwge2tleTogMX0pLCBtKCJhIiwge2tleTogMn0pLCBtKCJhIiwge2tleTogM30pXSkKCQl2YXIgZmlyc3RCZWZvcmUgPSByb290LmNoaWxkTm9kZXNbMF0KCQltLnJlbmRlcihyb290LCBbbSgiYSIsIHtrZXk6IDR9KSwgbSgiYSIsIHtrZXk6IDF9KSwgbSgiYSIsIHtrZXk6IDJ9KSwgbSgiYSIsIHtrZXk6IDN9KV0pCgkJdmFyIGZpcnN0QWZ0ZXIgPSByb290LmNoaWxkTm9kZXNbMV0KCQlyZXR1cm4gZmlyc3RCZWZvcmUgPT0gZmlyc3RBZnRlciAmJiByb290LmNoaWxkTm9kZXNbMF0ua2V5ID09IDQgJiYgcm9vdC5jaGlsZE5vZGVzLmxlbmd0aCA9PSA0Cgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvOTgKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBbbSgiYSIsIHtrZXk6IDF9KSwgbSgiYSIsIHtrZXk6IDJ9KSwgbSgiYSIsIHtrZXk6IDN9KV0pCgkJdmFyIGZpcnN0QmVmb3JlID0gcm9vdC5jaGlsZE5vZGVzWzBdCgkJbS5yZW5kZXIocm9vdCwgW20oImEiLCB7a2V5OiA0fSksIG0oImEiLCB7a2V5OiAxfSksIG0oImEiLCB7a2V5OiAyfSldKQoJCXZhciBmaXJzdEFmdGVyID0gcm9vdC5jaGlsZE5vZGVzWzFdCgkJcmV0dXJuIGZpcnN0QmVmb3JlID09IGZpcnN0QWZ0ZXIgJiYgcm9vdC5jaGlsZE5vZGVzWzBdLmtleSA9PSA0ICYmIHJvb3QuY2hpbGROb2Rlcy5sZW5ndGggPT0gMwoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzk4CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgW20oImEiLCB7a2V5OiAxfSksIG0oImEiLCB7a2V5OiAyfSksIG0oImEiLCB7a2V5OiAzfSldKQoJCXZhciBmaXJzdEJlZm9yZSA9IHJvb3QuY2hpbGROb2Rlc1sxXQoJCW0ucmVuZGVyKHJvb3QsIFttKCJhIiwge2tleTogMn0pLCBtKCJhIiwge2tleTogM30pLCBtKCJhIiwge2tleTogNH0pXSkKCQl2YXIgZmlyc3RBZnRlciA9IHJvb3QuY2hpbGROb2Rlc1swXQoJCXJldHVybiBmaXJzdEJlZm9yZSA9PSBmaXJzdEFmdGVyICYmIHJvb3QuY2hpbGROb2Rlc1swXS5rZXkgPT09ICIyIiAmJiByb290LmNoaWxkTm9kZXMubGVuZ3RoID09PSAzCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvOTgKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBbbSgiYSIsIHtrZXk6IDF9KSwgbSgiYSIsIHtrZXk6IDJ9KSwgbSgiYSIsIHtrZXk6IDN9KSwgbSgiYSIsIHtrZXk6IDR9KSwgbSgiYSIsIHtrZXk6IDV9KV0pCgkJdmFyIGZpcnN0QmVmb3JlID0gcm9vdC5jaGlsZE5vZGVzWzBdCgkJdmFyIHNlY29uZEJlZm9yZSA9IHJvb3QuY2hpbGROb2Rlc1sxXQoJCXZhciBmb3VydGhCZWZvcmUgPSByb290LmNoaWxkTm9kZXNbM10KCQltLnJlbmRlcihyb290LCBbbSgiYSIsIHtrZXk6IDR9KSwgbSgiYSIsIHtrZXk6IDEwfSksIG0oImEiLCB7a2V5OiAxfSksIG0oImEiLCB7a2V5OiAyfSldKQoJCXZhciBmaXJzdEFmdGVyID0gcm9vdC5jaGlsZE5vZGVzWzJdCgkJdmFyIHNlY29uZEFmdGVyID0gcm9vdC5jaGlsZE5vZGVzWzNdCgkJdmFyIGZvdXJ0aEFmdGVyID0gcm9vdC5jaGlsZE5vZGVzWzBdCgkJcmV0dXJuIGZpcnN0QmVmb3JlID09PSBmaXJzdEFmdGVyICYmIHNlY29uZEJlZm9yZSA9PT0gc2Vjb25kQWZ0ZXIgJiYgZm91cnRoQmVmb3JlID09PSBmb3VydGhBZnRlciAmJiByb290LmNoaWxkTm9kZXNbMV0ua2V5ID09ICIxMCIgJiYgcm9vdC5jaGlsZE5vZGVzLmxlbmd0aCA9PT0gNAoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzk4CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgW20oImEiLCB7a2V5OiAxfSksIG0oImEiLCB7a2V5OiAyfSksIG0oImEiLCB7a2V5OiAzfSksIG0oImEiLCB7a2V5OiA0fSksIG0oImEiLCB7a2V5OiA1fSldKQoJCXZhciBmaXJzdEJlZm9yZSA9IHJvb3QuY2hpbGROb2Rlc1swXQoJCXZhciBzZWNvbmRCZWZvcmUgPSByb290LmNoaWxkTm9kZXNbMV0KCQl2YXIgZm91cnRoQmVmb3JlID0gcm9vdC5jaGlsZE5vZGVzWzNdCgkJbS5yZW5kZXIocm9vdCwgW20oImEiLCB7a2V5OiA0fSksIG0oImEiLCB7a2V5OiAxMH0pLCBtKCJhIiwge2tleTogMn0pLCBtKCJhIiwge2tleTogMX0pLCBtKCJhIiwge2tleTogNn0pLCBtKCJhIiwge2tleTogN30pXSkKCQl2YXIgZmlyc3RBZnRlciA9IHJvb3QuY2hpbGROb2Rlc1szXQoJCXZhciBzZWNvbmRBZnRlciA9IHJvb3QuY2hpbGROb2Rlc1syXQoJCXZhciBmb3VydGhBZnRlciA9IHJvb3QuY2hpbGROb2Rlc1swXQoJCXJldHVybiBmaXJzdEJlZm9yZSA9PT0gZmlyc3RBZnRlciAmJiBzZWNvbmRCZWZvcmUgPT09IHNlY29uZEFmdGVyICYmIGZvdXJ0aEJlZm9yZSA9PT0gZm91cnRoQWZ0ZXIgJiYgcm9vdC5jaGlsZE5vZGVzWzFdLmtleSA9PSAiMTAiICYmIHJvb3QuY2hpbGROb2Rlc1s0XS5rZXkgPT0gIjYiICYmIHJvb3QuY2hpbGROb2Rlc1s1XS5rZXkgPT0gIjciICYmIHJvb3QuY2hpbGROb2Rlcy5sZW5ndGggPT09IDYKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy8xNDkKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBbbSgiYSIsIHtrZXk6IDF9KSwgbSgiYSIsIHtrZXk6IDJ9KSwgbSgiYSIpLCBtKCJhIiwge2tleTogNH0pLCBtKCJhIiwge2tleTogNX0pXSkKCQl2YXIgZmlyc3RCZWZvcmUgPSByb290LmNoaWxkTm9kZXNbMF0KCQl2YXIgc2Vjb25kQmVmb3JlID0gcm9vdC5jaGlsZE5vZGVzWzFdCgkJdmFyIHRoaXJkQmVmb3JlID0gcm9vdC5jaGlsZE5vZGVzWzJdCgkJdmFyIGZvdXJ0aEJlZm9yZSA9IHJvb3QuY2hpbGROb2Rlc1szXQoJCXZhciBmaWZ0aEJlZm9yZSA9IHJvb3QuY2hpbGROb2Rlc1s0XQoJCW0ucmVuZGVyKHJvb3QsIFttKCJhIiwge2tleTogNH0pLCBtKCJhIiwge2tleTogNX0pLCBtKCJhIiksIG0oImEiLCB7a2V5OiAxfSksIG0oImEiLCB7a2V5OiAyfSldKQoJCXZhciBmaXJzdEFmdGVyID0gcm9vdC5jaGlsZE5vZGVzWzNdCgkJdmFyIHNlY29uZEFmdGVyID0gcm9vdC5jaGlsZE5vZGVzWzRdCgkJdmFyIHRoaXJkQWZ0ZXIgPSByb290LmNoaWxkTm9kZXNbMl0KCQl2YXIgZm91cnRoQWZ0ZXIgPSByb290LmNoaWxkTm9kZXNbMF0KCQl2YXIgZmlmdGhBZnRlciA9IHJvb3QuY2hpbGROb2Rlc1sxXQoJCXJldHVybiBmaXJzdEJlZm9yZSA9PT0gZmlyc3RBZnRlciAmJiBzZWNvbmRCZWZvcmUgPT09IHNlY29uZEFmdGVyICYmIHRoaXJkQmVmb3JlID09PSB0aGlyZEFmdGVyICYmIGZvdXJ0aEJlZm9yZSA9PT0gZm91cnRoQWZ0ZXIgJiYgZmlmdGhCZWZvcmUgPT09IGZpZnRoQWZ0ZXIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy8xMzQKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCB7Y29udGVudGVkaXRhYmxlOiB0cnVlfSwgInRlc3QiKSkKCQltb2NrLmRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgPSByb290LmNoaWxkTm9kZXNbMF0KCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCB7Y29udGVudGVkaXRhYmxlOiB0cnVlfSwgInRlc3QxIikpCgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2Iiwge2NvbnRlbnRlZGl0YWJsZTogZmFsc2V9LCAidGVzdDIiKSkKCQlyZXR1cm4gcm9vdC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlID09PSAidGVzdDIiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvMTM2CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yZW5kZXIocm9vdCwgbSgidGV4dGFyZWEiLCBbInRlc3QiXSkpCgkJbS5yZW5kZXIocm9vdCwgbSgidGV4dGFyZWEiLCBbInRlc3QxIl0pKQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0udmFsdWUgPT09ICJ0ZXN0MSIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCXZhciB1bmxvYWRlZCA9IDAKCQltLnJlbmRlcihyb290LCBbCgkJCW0oImRpdiIsIHsKCQkJCWtleTogMSwKCQkJCWNvbmZpZzogZnVuY3Rpb24oZWwsIGluaXQsIGN0eCkgewoJCQkJCWN0eC5vbnVubG9hZCA9IGZ1bmN0aW9uKCkgewoJCQkJCQl1bmxvYWRlZCsrCgkJCQkJfQoJCQkJfQoJCQl9KQoJCV0pCgkJbS5yZW5kZXIocm9vdCwgWwoJCQltKCJkaXYiLCB7a2V5OiAyfSksCgkJCW0oImRpdiIsIHsKCQkJCWtleTogMSwKCQkJCWNvbmZpZzogZnVuY3Rpb24oZWwsIGluaXQsIGN0eCkgewoJCQkJCWN0eC5vbnVubG9hZCA9IGZ1bmN0aW9uKCkgewoJCQkJCQl1bmxvYWRlZCsrCgkJCQkJfQoJCQkJfQoJCQl9KQoJCV0pCgkJcmV0dXJuIHVubG9hZGVkID09IDAKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCXZhciB1bmxvYWRlZFBhcmVudCA9IDAKCQl2YXIgdW5sb2FkZWRDaGlsZCA9IDAKCQl2YXIgY29uZmlnUGFyZW50ID0gZnVuY3Rpb24oZWwsIGluaXQsIGN0eCkgewoJCQljdHgub251bmxvYWQgPSBmdW5jdGlvbigpIHsKCQkJCXVubG9hZGVkUGFyZW50KysKCQkJfQoJCX0KCQl2YXIgY29uZmlnQ2hpbGQgPSBmdW5jdGlvbihlbCwgaW5pdCwgY3R4KSB7CgkJCWN0eC5vbnVubG9hZCA9IGZ1bmN0aW9uKCkgewoJCQkJdW5sb2FkZWRDaGlsZCsrCgkJCX0KCQl9CgkJdmFyIHVubG9hZGVkID0gMAoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIHtjb25maWc6IGNvbmZpZ1BhcmVudH0sIG0oImEiLCB7Y29uZmlnOiBjb25maWdDaGlsZH0pKSkKCQltLnJlbmRlcihyb290LCBtKCJtYWluIiwge2NvbmZpZzogY29uZmlnUGFyZW50fSwgbSgiYSIsIHtjb25maWc6IGNvbmZpZ0NoaWxkfSkpKQoJCXJldHVybiB1bmxvYWRlZFBhcmVudCA9PT0gMSAmJiB1bmxvYWRlZENoaWxkID09PSAwCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQl2YXIgdW5sb2FkZWRQYXJlbnQgPSAwCgkJdmFyIHVubG9hZGVkQ2hpbGQgPSAwCgkJdmFyIGNvbmZpZ1BhcmVudCA9IGZ1bmN0aW9uKGVsLCBpbml0LCBjdHgpIHsKCQkJY3R4Lm9udW5sb2FkID0gZnVuY3Rpb24oKSB7CgkJCQl1bmxvYWRlZFBhcmVudCsrCgkJCX0KCQl9CgkJdmFyIGNvbmZpZ0NoaWxkID0gZnVuY3Rpb24oZWwsIGluaXQsIGN0eCkgewoJCQljdHgub251bmxvYWQgPSBmdW5jdGlvbigpIHsKCQkJCXVubG9hZGVkQ2hpbGQrKwoJCQl9CgkJfQoJCXZhciB1bmxvYWRlZCA9IDAKCQltLnJlbmRlcihyb290LCBtKCJkaXYiLCB7Y29uZmlnOiBjb25maWdQYXJlbnR9LCBtKCJhIiwge2NvbmZpZzogY29uZmlnQ2hpbGR9KSkpCgkJbS5yZW5kZXIocm9vdCwgbSgibWFpbiIsIHtjb25maWc6IGNvbmZpZ1BhcmVudH0sIG0oImIiLCB7Y29uZmlnOiBjb25maWdDaGlsZH0pKSkKCQlyZXR1cm4gdW5sb2FkZWRQYXJlbnQgPT09IDEgJiYgdW5sb2FkZWRDaGlsZCA9PT0gMQoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzE1MAoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIFttKCJhIiksIG0oImRpdiIpXSkKCQltLnJlbmRlcihyb290LCBbW10sIG0oImRpdiIpXSkKCQlyZXR1cm4gcm9vdC5jaGlsZE5vZGVzLmxlbmd0aCA9PSAxICYmIHJvb3QuY2hpbGROb2Rlc1swXS5ub2RlTmFtZSA9PSAiRElWIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzE1NgoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oImRpdiIsIFsKCQkJWyJhIiwgImIiLCAiYyIsICJkIl0ubWFwKGZ1bmN0aW9uKCkgewoJCQkJcmV0dXJuIFttKCJkaXYiKSwgIiAiXQoJCQl9KSwKCQkJbSgic3BhbiIpCgkJXSkpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzhdLm5vZGVOYW1lID09ICJTUEFOIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzE1NwoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucmVuZGVyKHJvb3QsIG0oInVsIiwgW20oImxpIiwge2tleTogMH0pLCBtKCJsaSIsIHtrZXk6IDJ9KSwgbSgibGkiLCB7a2V5OiA0fSldKSkKCQltLnJlbmRlcihyb290LCBtKCJ1bCIsIFttKCJsaSIsIHtrZXk6IDB9KSwgbSgibGkiLCB7a2V5OiAxfSksIG0oImxpIiwge2tleTogMn0pLCBtKCJsaSIsIHtrZXk6IDN9KSwgbSgibGkiLCB7a2V5OiA0fSksIG0oImxpIiwge2tleTogNX0pXSkpCgkJcmV0dXJuIHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzLm1hcChmdW5jdGlvbihuKSB7cmV0dXJuIG4ua2V5fSkuam9pbigiIikgPT0gIjAxMjM0NSIKCX0pCgkvL2VuZCBtLnJlbmRlcgoKCS8vbS5yZWRyYXcKCXRlc3QoZnVuY3Rpb24oKSB7CgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3NldHVwCgkJdmFyIGNvbnRyb2xsZXIKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLm1vZHVsZShyb290LCB7CgkJCWNvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge2NvbnRyb2xsZXIgPSB0aGlzfSwKCQkJdmlldzogZnVuY3Rpb24oY3RybCkge3JldHVybiBjdHJsLnZhbHVlfQoJCX0pCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKQoJCXZhciB2YWx1ZUJlZm9yZSA9IHJvb3QuY2hpbGROb2Rlc1swXS5ub2RlVmFsdWUKCQljb250cm9sbGVyLnZhbHVlID0gImZvbyIKCQltLnJlZHJhdygpCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKQoJCXJldHVybiB2YWx1ZUJlZm9yZSA9PT0gIiIgJiYgcm9vdC5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZSA9PT0gImZvbyIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy9zZXR1cAoJCXZhciBjb3VudCA9IDAKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLm1vZHVsZShyb290LCB7CgkJCWNvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sCgkJCXZpZXc6IGZ1bmN0aW9uKGN0cmwpIHsKCQkJCWNvdW50KysKCQkJfQoJCX0pCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3RlYXJkb3duCgkJbS5yZWRyYXcoKSAvL3Nob3VsZCBydW4gc3luY2hyb25vdXNseQoJCQoJCW0ucmVkcmF3KCkgLy9yZXN0IHNob3VsZCBydW4gYXN5bmNocm9ub3VzbHkgc2luY2UgdGhleSdyZSBzcGFtbWluZwoJCW0ucmVkcmF3KCkKCQltLnJlZHJhdygpCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3RlYXJkb3duCgkJcmV0dXJuIGNvdW50ID09PSAzCgl9KQoKCS8vbS5yb3V0ZQoJdGVzdChmdW5jdGlvbigpIHsKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vc2V0dXAKCQltb2NrLmxvY2F0aW9uLnNlYXJjaCA9ICI/IgoKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJvdXRlLm1vZGUgPSAic2VhcmNoIgoJCW0ucm91dGUocm9vdCwgIi90ZXN0MSIsIHsKCQkJIi90ZXN0MSI6IHtjb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LCB2aWV3OiBmdW5jdGlvbigpIHtyZXR1cm4gImZvbyJ9fQoJCX0pCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3RlYXJkb3duCgkJcmV0dXJuIG1vY2subG9jYXRpb24uc2VhcmNoID09ICI/L3Rlc3QxIiAmJiByb290LmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlID09PSAiZm9vIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3NldHVwCgkJbW9jay5sb2NhdGlvbi5wYXRobmFtZSA9ICIvIgoKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJvdXRlLm1vZGUgPSAicGF0aG5hbWUiCgkJbS5yb3V0ZShyb290LCAiL3Rlc3QyIiwgewoJCQkiL3Rlc3QyIjoge2NvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sIHZpZXc6IGZ1bmN0aW9uKCkge3JldHVybiAiZm9vIn19CgkJfSkKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vdGVhcmRvd24KCQlyZXR1cm4gbW9jay5sb2NhdGlvbi5wYXRobmFtZSA9PSAiL3Rlc3QyIiAmJiByb290LmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlID09PSAiZm9vIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3NldHVwCgkJbW9jay5sb2NhdGlvbi5oYXNoID0gIiMiCgoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucm91dGUubW9kZSA9ICJoYXNoIgoJCW0ucm91dGUocm9vdCwgIi90ZXN0MyIsIHsKCQkJIi90ZXN0MyI6IHtjb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LCB2aWV3OiBmdW5jdGlvbigpIHtyZXR1cm4gImZvbyJ9fQoJCX0pCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3RlYXJkb3duCgkJcmV0dXJuIG1vY2subG9jYXRpb24uaGFzaCA9PSAiIy90ZXN0MyIgJiYgcm9vdC5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZSA9PT0gImZvbyIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy9zZXR1cAoJCW1vY2subG9jYXRpb24uc2VhcmNoID0gIj8iCgoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucm91dGUubW9kZSA9ICJzZWFyY2giCgkJbS5yb3V0ZShyb290LCAiL3Rlc3Q0L2ZvbyIsIHsKCQkJIi90ZXN0NC86dGVzdCI6IHtjb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LCB2aWV3OiBmdW5jdGlvbigpIHtyZXR1cm4gbS5yb3V0ZS5wYXJhbSgidGVzdCIpfX0KCQl9KQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy90ZWFyZG93bgoJCXJldHVybiBtb2NrLmxvY2F0aW9uLnNlYXJjaCA9PSAiPy90ZXN0NC9mb28iICYmIHJvb3QuY2hpbGROb2Rlc1swXS5ub2RlVmFsdWUgPT09ICJmb28iCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vc2V0dXAKCQltb2NrLmxvY2F0aW9uLnNlYXJjaCA9ICI/IgoKCQl2YXIgbW9kdWxlID0ge2NvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sIHZpZXc6IGZ1bmN0aW9uKCkge3JldHVybiBtLnJvdXRlLnBhcmFtKCJ0ZXN0Iil9fQoKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJvdXRlLm1vZGUgPSAic2VhcmNoIgoJCW0ucm91dGUocm9vdCwgIi90ZXN0NS9mb28iLCB7CgkJCSIvIjogbW9kdWxlLAoJCQkiL3Rlc3Q1Lzp0ZXN0IjogbW9kdWxlCgkJfSkKCQl2YXIgcGFyYW1WYWx1ZUJlZm9yZSA9IG0ucm91dGUucGFyYW0oInRlc3QiKQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkKCQltLnJvdXRlKCIvIikKCQl2YXIgcGFyYW1WYWx1ZUFmdGVyID0gbS5yb3V0ZS5wYXJhbSgidGVzdCIpCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3RlYXJkb3duCgkJcmV0dXJuIG1vY2subG9jYXRpb24uc2VhcmNoID09ICI/LyIgJiYgcGFyYW1WYWx1ZUJlZm9yZSA9PT0gImZvbyIgJiYgcGFyYW1WYWx1ZUFmdGVyID09PSB1bmRlZmluZWQKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy9zZXR1cAoJCW1vY2subG9jYXRpb24uc2VhcmNoID0gIj8iCgoJCXZhciBtb2R1bGUgPSB7Y29udHJvbGxlcjogZnVuY3Rpb24oKSB7fSwgdmlldzogZnVuY3Rpb24oKSB7cmV0dXJuIG0ucm91dGUucGFyYW0oImExIil9fQoKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJvdXRlLm1vZGUgPSAic2VhcmNoIgoJCW0ucm91dGUocm9vdCwgIi90ZXN0Ni9mb28iLCB7CgkJCSIvIjogbW9kdWxlLAoJCQkiL3Rlc3Q2LzphMSI6IG1vZHVsZQoJCX0pCgkJdmFyIHBhcmFtVmFsdWVCZWZvcmUgPSBtLnJvdXRlLnBhcmFtKCJhMSIpCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKQoJCW0ucm91dGUoIi8iKQoJCXZhciBwYXJhbVZhbHVlQWZ0ZXIgPSBtLnJvdXRlLnBhcmFtKCJhMSIpCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3RlYXJkb3duCgkJcmV0dXJuIG1vY2subG9jYXRpb24uc2VhcmNoID09ICI/LyIgJiYgcGFyYW1WYWx1ZUJlZm9yZSA9PT0gImZvbyIgJiYgcGFyYW1WYWx1ZUFmdGVyID09PSB1bmRlZmluZWQKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy82MQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy9zZXR1cAoJCW1vY2subG9jYXRpb24uc2VhcmNoID0gIj8iCgoJCXZhciBtb2R1bGUgPSB7Y29udHJvbGxlcjogZnVuY3Rpb24oKSB7fSwgdmlldzogZnVuY3Rpb24oKSB7cmV0dXJuIG0ucm91dGUucGFyYW0oImExIil9fQoKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJvdXRlLm1vZGUgPSAic2VhcmNoIgoJCW0ucm91dGUocm9vdCwgIi90ZXN0Ny9mb28iLCB7CgkJCSIvIjogbW9kdWxlLAoJCQkiL3Rlc3Q3LzphMSI6IG1vZHVsZQoJCX0pCgkJdmFyIHJvdXRlVmFsdWVCZWZvcmUgPSBtLnJvdXRlKCkKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpCgkJbS5yb3V0ZSgiLyIpCgkJdmFyIHJvdXRlVmFsdWVBZnRlciA9IG0ucm91dGUoKQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy90ZWFyZG93bgoJCXJldHVybiByb3V0ZVZhbHVlQmVmb3JlID09PSAiL3Rlc3Q3L2ZvbyIgJiYgcm91dGVWYWx1ZUFmdGVyID09PSAiLyIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy9zZXR1cAoJCW1vY2subG9jYXRpb24uc2VhcmNoID0gIj8iCgoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucm91dGUubW9kZSA9ICJzZWFyY2giCgkJbS5yb3V0ZShyb290LCAiL3Rlc3Q4L2Zvby9TRVAvYmFyL2JheiIsIHsKCQkJIi90ZXN0OC86dGVzdC9TRVAvOnBhdGguLi4iOiB7CgkJCQljb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LAoJCQkJdmlldzogZnVuY3Rpb24oKSB7CgkJCQkJcmV0dXJuIG0ucm91dGUucGFyYW0oInRlc3QiKSArICJfIiArIG0ucm91dGUucGFyYW0oInBhdGgiKQoJCQkJfQoJCQl9CgkJfSkKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vdGVhcmRvd24KCQlyZXR1cm4gbW9jay5sb2NhdGlvbi5zZWFyY2ggPT0gIj8vdGVzdDgvZm9vL1NFUC9iYXIvYmF6IiAmJiByb290LmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlID09PSAiZm9vX2Jhci9iYXoiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vc2V0dXAKCQltb2NrLmxvY2F0aW9uLnNlYXJjaCA9ICI/IgoKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJvdXRlLm1vZGUgPSAic2VhcmNoIgoJCW0ucm91dGUocm9vdCwgIi90ZXN0OS9mb28vYmFyL1NFUC9iYXoiLCB7CgkJCSIvdGVzdDkvOnRlc3QuLi4vU0VQLzpwYXRoIjogewoJCQkJY29udHJvbGxlcjogZnVuY3Rpb24oKSB7fSwKCQkJCXZpZXc6IGZ1bmN0aW9uKCkgewoJCQkJCXJldHVybiBtLnJvdXRlLnBhcmFtKCJ0ZXN0IikgKyAiXyIgKyBtLnJvdXRlLnBhcmFtKCJwYXRoIikKCQkJCX0KCQkJfQoJCX0pCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3RlYXJkb3duCgkJcmV0dXJuIG1vY2subG9jYXRpb24uc2VhcmNoID09ICI/L3Rlc3Q5L2Zvby9iYXIvU0VQL2JheiIgJiYgcm9vdC5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZSA9PT0gImZvby9iYXJfYmF6IgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3NldHVwCgkJbW9jay5sb2NhdGlvbi5zZWFyY2ggPSAiPyIKCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yb3V0ZS5tb2RlID0gInNlYXJjaCIKCQltLnJvdXRlKHJvb3QsICIvdGVzdDEwL2ZvbyUyMGJhciIsIHsKCQkJIi90ZXN0MTAvOnRlc3QiOiB7CgkJCQljb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LAoJCQkJdmlldzogZnVuY3Rpb24oKSB7CgkJCQkJcmV0dXJuIG0ucm91dGUucGFyYW0oInRlc3QiKQoJCQkJfQoJCQl9CgkJfSkKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vdGVhcmRvd24KCQlyZXR1cm4gcm9vdC5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZSA9PT0gImZvbyBiYXIiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vc2V0dXAKCQltb2NrLmxvY2F0aW9uLnNlYXJjaCA9ICI/IgoKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQltLnJvdXRlLm1vZGUgPSAic2VhcmNoIgoJCW0ucm91dGUocm9vdCwgIi8iLCB7CgkJCSIvIjoge2NvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sIHZpZXc6IGZ1bmN0aW9uKCkge3JldHVybiAiZm9vIn19LAoJCQkiL3Rlc3QxMSI6IHtjb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LCB2aWV3OiBmdW5jdGlvbigpIHtyZXR1cm4gImJhciJ9fQoJCX0pCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKQoJCW0ucm91dGUoIi90ZXN0MTEvIikKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vdGVhcmRvd24KCQlyZXR1cm4gbW9jay5sb2NhdGlvbi5zZWFyY2ggPT0gIj8vdGVzdDExLyIgJiYgcm9vdC5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZSA9PT0gImJhciIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy9zZXR1cAoJCW1vY2subG9jYXRpb24uc2VhcmNoID0gIj8iCgoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucm91dGUubW9kZSA9ICJzZWFyY2giCgkJbS5yb3V0ZShyb290LCAiLyIsIHsKCQkJIi8iOiB7Y29udHJvbGxlcjogZnVuY3Rpb24oKSB7fSwgdmlldzogZnVuY3Rpb24oKSB7fX0sCgkJCSIvdGVzdDEyIjoge2NvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sIHZpZXc6IGZ1bmN0aW9uKCkge319CgkJfSkKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpCgkJbS5yb3V0ZSgiL3Rlc3QxMj9hPWZvbyZiPWJhciIpCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3RlYXJkb3duCgkJcmV0dXJuIG1vY2subG9jYXRpb24uc2VhcmNoID09ICI/L3Rlc3QxMj9hPWZvbyZiPWJhciIgJiYgbS5yb3V0ZS5wYXJhbSgiYSIpID09ICJmb28iICYmIG0ucm91dGUucGFyYW0oImIiKSA9PSAiYmFyIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3NldHVwCgkJbW9jay5sb2NhdGlvbi5zZWFyY2ggPSAiPyIKCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yb3V0ZS5tb2RlID0gInNlYXJjaCIKCQltLnJvdXRlKHJvb3QsICIvIiwgewoJCQkiLyI6IHtjb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LCB2aWV3OiBmdW5jdGlvbigpIHtyZXR1cm4gImJhciJ9fSwKCQkJIi90ZXN0MTMvOnRlc3QiOiB7Y29udHJvbGxlcjogZnVuY3Rpb24oKSB7fSwgdmlldzogZnVuY3Rpb24oKSB7cmV0dXJuIG0ucm91dGUucGFyYW0oInRlc3QiKX19CgkJfSkKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpCgkJbS5yb3V0ZSgiL3Rlc3QxMy9mb28/dGVzdD1iYXIiKQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy90ZWFyZG93bgoJCXJldHVybiBtb2NrLmxvY2F0aW9uLnNlYXJjaCA9PSAiPy90ZXN0MTMvZm9vP3Rlc3Q9YmFyIiAmJiByb290LmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlID09PSAiZm9vIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3NldHVwCgkJbW9jay5sb2NhdGlvbi5zZWFyY2ggPSAiPyIKCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yb3V0ZS5tb2RlID0gInNlYXJjaCIKCQltLnJvdXRlKHJvb3QsICIvIiwgewoJCQkiLyI6IHtjb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LCB2aWV3OiBmdW5jdGlvbigpIHtyZXR1cm4gImJhciJ9fSwKCQkJIi90ZXN0MTQiOiB7Y29udHJvbGxlcjogZnVuY3Rpb24oKSB7fSwgdmlldzogZnVuY3Rpb24oKSB7cmV0dXJuICJmb28ifX0KCQl9KQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkKCQltLnJvdXRlKCIvdGVzdDE0P3Rlc3QmdGVzdDI9IikKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vdGVhcmRvd24KCQlyZXR1cm4gbW9jay5sb2NhdGlvbi5zZWFyY2ggPT0gIj8vdGVzdDE0P3Rlc3QmdGVzdDI9IiAmJiBtLnJvdXRlLnBhcmFtKCJ0ZXN0IikgPT09IHRydWUgJiYgbS5yb3V0ZS5wYXJhbSgidGVzdDIiKSA9PT0gIiIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy9zZXR1cAoJCW1vY2subG9jYXRpb24uc2VhcmNoID0gIj8iCgoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCW0ucm91dGUubW9kZSA9ICJzZWFyY2giCgkJbS5yb3V0ZShyb290LCAiLyIsIHsKCQkJIi8iOiB7Y29udHJvbGxlcjogZnVuY3Rpb24oKSB7fSwgdmlldzogZnVuY3Rpb24oKSB7fX0sCgkJCSIvdGVzdDEyIjoge2NvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sIHZpZXc6IGZ1bmN0aW9uKCkge319CgkJfSkKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpCgkJbS5yb3V0ZSgiL3Rlc3QxMiIsIHthOiAiZm9vIiwgYjogImJhciJ9KQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy90ZWFyZG93bgoJCXJldHVybiBtb2NrLmxvY2F0aW9uLnNlYXJjaCA9PSAiPy90ZXN0MTI/YT1mb28mYj1iYXIiICYmIG0ucm91dGUucGFyYW0oImEiKSA9PSAiZm9vIiAmJiBtLnJvdXRlLnBhcmFtKCJiIikgPT0gImJhciIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy9zZXR1cAoJCW1vY2subG9jYXRpb24uc2VhcmNoID0gIj8iCgoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCXZhciByb3V0ZTEsIHJvdXRlMgoJCW0ucm91dGUubW9kZSA9ICJzZWFyY2giCgkJbS5yb3V0ZShyb290LCAiLyIsIHsKCQkJIi8iOiB7Y29udHJvbGxlcjogZnVuY3Rpb24oKSB7cm91dGUxID0gbS5yb3V0ZSgpfSwgdmlldzogZnVuY3Rpb24oKSB7fX0sCgkJCSIvdGVzdDEzIjoge2NvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge3JvdXRlMiA9IG0ucm91dGUoKX0sIHZpZXc6IGZ1bmN0aW9uKCkge319CgkJfSkKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpCgkJbS5yb3V0ZSgiL3Rlc3QxMyIpCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3RlYXJkb3duCgkJcmV0dXJuIHJvdXRlMSA9PSAiLyIgJiYgcm91dGUyID09ICIvdGVzdDEzIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3NldHVwCgkJbW9jay5sb2NhdGlvbi5zZWFyY2ggPSAiPyIKCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJdmFyIHVubG9hZGVkID0gMAoJCW0ucm91dGUubW9kZSA9ICJzZWFyY2giCgkJbS5yb3V0ZShyb290LCAiLyIsIHsKCQkJIi8iOiB7CgkJCQljb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LAoJCQkJdmlldzogZnVuY3Rpb24oKSB7CgkJCQkJcmV0dXJuIG0oImRpdiIsIHsKCQkJCQkJY29uZmlnOiBmdW5jdGlvbihlbCwgaW5pdCwgY3R4KSB7CgkJCQkJCQljdHgub251bmxvYWQgPSBmdW5jdGlvbigpIHsKCQkJCQkJCQl1bmxvYWRlZCsrCgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9KQoJCQkJfQoJCQl9LAoJCQkiL3Rlc3QxNCI6IHtjb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LCB2aWV3OiBmdW5jdGlvbigpIHt9fQoJCX0pCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKQoJCW0ucm91dGUoIi90ZXN0MTQiKQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy90ZWFyZG93bgoJCXJldHVybiB1bmxvYWRlZCA9PSAxCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vc2V0dXAKCQltb2NrLmxvY2F0aW9uLnNlYXJjaCA9ICI/IgoKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCQl2YXIgdW5sb2FkZWQgPSAwCgkJbS5yb3V0ZS5tb2RlID0gInNlYXJjaCIKCQltLnJvdXRlKHJvb3QsICIvIiwgewoJCQkiLyI6IHsKCQkJCWNvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sCgkJCQl2aWV3OiBmdW5jdGlvbigpIHsKCQkJCQlyZXR1cm4gWwoJCQkJCQltKCJkaXYiKSwKCQkJCQkJbSgiZGl2IiwgewoJCQkJCQkJY29uZmlnOiBmdW5jdGlvbihlbCwgaW5pdCwgY3R4KSB7CgkJCQkJCQkJY3R4Lm9udW5sb2FkID0gZnVuY3Rpb24oKSB7CgkJCQkJCQkJCXVubG9hZGVkKysKCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCX0pCgkJCQkJXQoJCQkJfQoJCQl9LAoJCQkiL3Rlc3QxNSI6IHsKCQkJCWNvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sCgkJCQl2aWV3OiBmdW5jdGlvbigpIHsKCQkJCQlyZXR1cm4gW20oImRpdiIpXQoJCQkJfQoJCQl9CgkJfSkKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpCgkJbS5yb3V0ZSgiL3Rlc3QxNSIpCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3RlYXJkb3duCgkJcmV0dXJuIHVubG9hZGVkID09IDEKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy9zZXR1cAoJCW1vY2subG9jYXRpb24uc2VhcmNoID0gIj8iCgoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCXZhciB1bmxvYWRlZCA9IDAKCQltLnJvdXRlLm1vZGUgPSAic2VhcmNoIgoJCW0ucm91dGUocm9vdCwgIi8iLCB7CgkJCSIvIjogewoJCQkJY29udHJvbGxlcjogZnVuY3Rpb24oKSB7fSwKCQkJCXZpZXc6IGZ1bmN0aW9uKCkgewoJCQkJCXJldHVybiBtKCJkaXYiLCB7CgkJCQkJCWNvbmZpZzogZnVuY3Rpb24oZWwsIGluaXQsIGN0eCkgewoJCQkJCQkJY3R4Lm9udW5sb2FkID0gZnVuY3Rpb24oKSB7CgkJCQkJCQkJdW5sb2FkZWQrKwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfSkKCQkJCX0KCQkJfSwKCQkJIi90ZXN0MTYiOiB7CgkJCQljb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LAoJCQkJdmlldzogZnVuY3Rpb24oKSB7CgkJCQkJcmV0dXJuIG0oImEiKQoJCQkJfQoJCQl9CgkJfSkKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpCgkJbS5yb3V0ZSgiL3Rlc3QxNiIpCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3RlYXJkb3duCgkJcmV0dXJuIHVubG9hZGVkID09IDEKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy9zZXR1cAoJCW1vY2subG9jYXRpb24uc2VhcmNoID0gIj8iCgoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCXZhciB1bmxvYWRlZCA9IDAKCQltLnJvdXRlLm1vZGUgPSAic2VhcmNoIgoJCW0ucm91dGUocm9vdCwgIi8iLCB7CgkJCSIvIjogewoJCQkJY29udHJvbGxlcjogZnVuY3Rpb24oKSB7fSwKCQkJCXZpZXc6IGZ1bmN0aW9uKCkgewoJCQkJCXJldHVybiBbCgkJCQkJCW0oImRpdiIsIHsKCQkJCQkJCWNvbmZpZzogZnVuY3Rpb24oZWwsIGluaXQsIGN0eCkgewoJCQkJCQkJCWN0eC5vbnVubG9hZCA9IGZ1bmN0aW9uKCkgewoJCQkJCQkJCQl1bmxvYWRlZCsrCgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQl9KQoJCQkJCV0KCQkJCX0KCQkJfSwKCQkJIi90ZXN0MTciOiB7CgkJCQljb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LAoJCQkJdmlldzogZnVuY3Rpb24oKSB7CgkJCQkJcmV0dXJuIG0oImEiKQoJCQkJfQoJCQl9CgkJfSkKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpCgkJbS5yb3V0ZSgiL3Rlc3QxNyIpCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3RlYXJkb3duCgkJcmV0dXJuIHVubG9hZGVkID09IDEKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy9zZXR1cAoJCW1vY2subG9jYXRpb24uc2VhcmNoID0gIj8iCgoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCXZhciB1bmxvYWRlZCA9IDAKCQltLnJvdXRlLm1vZGUgPSAic2VhcmNoIgoJCW0ucm91dGUocm9vdCwgIi8iLCB7CgkJCSIvIjogewoJCQkJY29udHJvbGxlcjogZnVuY3Rpb24oKSB7fSwKCQkJCXZpZXc6IGZ1bmN0aW9uKCkgewoJCQkJCXJldHVybiBtKCJkaXYiLCB7CgkJCQkJCWNvbmZpZzogZnVuY3Rpb24oZWwsIGluaXQsIGN0eCkgewoJCQkJCQkJY3R4Lm9udW5sb2FkID0gZnVuY3Rpb24oKSB7CgkJCQkJCQkJdW5sb2FkZWQrKwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfSkKCQkJCX0KCQkJfSwKCQkJIi90ZXN0MTgiOiB7CgkJCQljb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LAoJCQkJdmlldzogZnVuY3Rpb24oKSB7CgkJCQkJcmV0dXJuIFttKCJhIildCgkJCQl9CgkJCX0KCQl9KQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkKCQltLnJvdXRlKCIvdGVzdDE4IikKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vdGVhcmRvd24KCQlyZXR1cm4gdW5sb2FkZWQgPT0gMQoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3NldHVwCgkJbW9jay5sb2NhdGlvbi5zZWFyY2ggPSAiPyIKCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJdmFyIHVubG9hZGVkID0gMAoJCW0ucm91dGUubW9kZSA9ICJzZWFyY2giCgkJbS5yb3V0ZShyb290LCAiLyIsIHsKCQkJIi8iOiB7CgkJCQljb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LAoJCQkJdmlldzogZnVuY3Rpb24oKSB7CgkJCQkJcmV0dXJuIFsKCQkJCQkJbSgiZGl2IiwgewoJCQkJCQkJa2V5OiAxLAoJCQkJCQkJY29uZmlnOiBmdW5jdGlvbihlbCwgaW5pdCwgY3R4KSB7CgkJCQkJCQkJY3R4Lm9udW5sb2FkID0gZnVuY3Rpb24oKSB7CgkJCQkJCQkJCXVubG9hZGVkKysKCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCX0pCgkJCQkJXQoJCQkJfQoJCQl9LAoJCQkiL3Rlc3QyMCI6IHsKCQkJCWNvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sCgkJCQl2aWV3OiBmdW5jdGlvbigpIHsKCQkJCQlyZXR1cm4gWwoJCQkJCQltKCJkaXYiLCB7CgkJCQkJCQlrZXk6IDIsCgkJCQkJCQljb25maWc6IGZ1bmN0aW9uKGVsLCBpbml0LCBjdHgpIHsKCQkJCQkJCQljdHgub251bmxvYWQgPSBmdW5jdGlvbigpIHsKCQkJCQkJCQkJdW5sb2FkZWQrKwoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJfSkKCQkJCQldCgkJCQl9CgkJCX0KCQl9KQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkKCQltLnJvdXRlKCIvdGVzdDIwIikKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vdGVhcmRvd24KCQlyZXR1cm4gdW5sb2FkZWQgPT0gMQoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3NldHVwCgkJbW9jay5sb2NhdGlvbi5zZWFyY2ggPSAiPyIKCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJdmFyIHVubG9hZGVkID0gMAoJCW0ucm91dGUubW9kZSA9ICJzZWFyY2giCgkJbS5yb3V0ZShyb290LCAiLyIsIHsKCQkJIi8iOiB7CgkJCQljb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LAoJCQkJdmlldzogZnVuY3Rpb24oKSB7CgkJCQkJcmV0dXJuIFsKCQkJCQkJbSgiZGl2IiwgewoJCQkJCQkJa2V5OiAxLAoJCQkJCQkJY29uZmlnOiBmdW5jdGlvbihlbCwgaW5pdCwgY3R4KSB7CgkJCQkJCQkJY3R4Lm9udW5sb2FkID0gZnVuY3Rpb24oKSB7CgkJCQkJCQkJCXVubG9hZGVkKysKCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCX0pCgkJCQkJXQoJCQkJfQoJCQl9LAoJCQkiL3Rlc3QyMSI6IHsKCQkJCWNvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sCgkJCQl2aWV3OiBmdW5jdGlvbigpIHsKCQkJCQlyZXR1cm4gWwoJCQkJCQltKCJkaXYiLCB7CgkJCQkJCQljb25maWc6IGZ1bmN0aW9uKGVsLCBpbml0LCBjdHgpIHsKCQkJCQkJCQljdHgub251bmxvYWQgPSBmdW5jdGlvbigpIHsKCQkJCQkJCQkJdW5sb2FkZWQrKwoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJfSkKCQkJCQldCgkJCQl9CgkJCX0KCQl9KQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkKCQltLnJvdXRlKCIvdGVzdDIxIikKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpIC8vdGVhcmRvd24KCQlyZXR1cm4gdW5sb2FkZWQgPT0gMQoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3NldHVwCgkJbW9jay5sb2NhdGlvbi5zZWFyY2ggPSAiPyIKCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5yb3V0ZS5tb2RlID0gInNlYXJjaCIKCQltLnJvdXRlKHJvb3QsICIvZm9vIiwgewoJCQkiL2ZvbyI6IHsKCQkJCWNvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sCgkJCQl2aWV3OiBmdW5jdGlvbigpIHsKCQkJCQlyZXR1cm4gbSgiZGl2IiwgImZvbyIpOwoJCQkJfQoJCQl9LAoJCQkiL2JhciI6IHsKCQkJCWNvbnRyb2xsZXI6IGZ1bmN0aW9uKCkge30sCgkJCQl2aWV3OiBmdW5jdGlvbigpIHsKCQkJCQlyZXR1cm4gbSgiZGl2IiwgImJhciIpOwoJCQkJfQoJCQl9LAoJCX0pCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKQoJCXZhciBmb28gPSByb290LmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1swXS5ub2RlVmFsdWU7CgkJbS5yb3V0ZSgiL2JhciIpCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3RlYXJkb3duCgkJdmFyIGJhciA9IHJvb3QuY2hpbGROb2Rlc1swXS5jaGlsZE5vZGVzWzBdLm5vZGVWYWx1ZTsKCQlyZXR1cm4gKGZvbyA9PT0gImZvbyIgJiYgYmFyID09PSAiYmFyIikKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkgLy9zZXR1cAoJCW1vY2subG9jYXRpb24uc2VhcmNoID0gIj8iCgoJCXZhciByb290ID0gbW9jay5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQoJCXZhciB1bmxvYWRlZCA9IDAKCQl2YXIgY29uZmlnID0gZnVuY3Rpb24oZWwsIGluaXQsIGN0eCkgewoJCQljdHgub251bmxvYWQgPSBmdW5jdGlvbigpIHsKCQkJCXVubG9hZGVkKysKCQkJfQoJCX0KCQltLnJvdXRlLm1vZGUgPSAic2VhcmNoIgoJCW0ucm91dGUocm9vdCwgIi9mb28xIiwgewoJCQkiL2ZvbzEiOiB7CgkJCQljb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LAoJCQkJdmlldzogZnVuY3Rpb24oKSB7CgkJCQkJcmV0dXJuIG0oImRpdiIsIG0oImEiLCB7Y29uZmlnOiBjb25maWd9LCAiZm9vIikpOwoJCQkJfQoJCQl9LAoJCQkiL2JhcjEiOiB7CgkJCQljb250cm9sbGVyOiBmdW5jdGlvbigpIHt9LAoJCQkJdmlldzogZnVuY3Rpb24oKSB7CgkJCQkJcmV0dXJuIG0oIm1haW4iLCBtKCJhIiwge2NvbmZpZzogY29uZmlnfSwgImZvbyIpKTsKCQkJCX0KCQkJfSwKCQl9KQoJCW1vY2sucmVxdWVzdEFuaW1hdGlvbkZyYW1lLiRyZXNvbHZlKCkKCQltLnJvdXRlKCIvYmFyMSIpCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKSAvL3RlYXJkb3duCgkJcmV0dXJuIHVubG9hZGVkID09IDEKCX0pCgkvL2VuZCBtLnJvdXRlCgoJLy9tLnByb3AKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHByb3AgPSBtLnByb3AoInRlc3QiKQoJCXJldHVybiBwcm9wKCkgPT09ICJ0ZXN0IgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHByb3AgPSBtLnByb3AoInRlc3QiKQoJCXByb3AoImZvbyIpCgkJcmV0dXJuIHByb3AoKSA9PT0gImZvbyIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciBwcm9wID0gbS5wcm9wKCJ0ZXN0IikKCQlyZXR1cm4gSlNPTi5zdHJpbmdpZnkocHJvcCkgPT09ICcidGVzdCInCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgb2JqID0ge3Byb3A6IG0ucHJvcCgidGVzdCIpfQoJCXJldHVybiBKU09OLnN0cmluZ2lmeShvYmopID09PSAneyJwcm9wIjoidGVzdCJ9JwoJfSkKCgkvL20ucmVxdWVzdAoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgcHJvcCA9IG0ucmVxdWVzdCh7bWV0aG9kOiAiR0VUIiwgdXJsOiAidGVzdCJ9KQoJCW1vY2suWE1MSHR0cFJlcXVlc3QuJGluc3RhbmNlcy5wb3AoKS5vbnJlYWR5c3RhdGVjaGFuZ2UoKQoJCXJldHVybiBwcm9wKCkubWV0aG9kID09PSAiR0VUIiAmJiBwcm9wKCkudXJsID09PSAidGVzdCIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciBwcm9wID0gbS5yZXF1ZXN0KHttZXRob2Q6ICJHRVQiLCB1cmw6ICJ0ZXN0In0pLnRoZW4oZnVuY3Rpb24odmFsdWUpIHtyZXR1cm4gImZvbyJ9KQoJCW1vY2suWE1MSHR0cFJlcXVlc3QuJGluc3RhbmNlcy5wb3AoKS5vbnJlYWR5c3RhdGVjaGFuZ2UoKQoJCXJldHVybiBwcm9wKCkgPT09ICJmb28iCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgcHJvcCA9IG0ucmVxdWVzdCh7bWV0aG9kOiAiUE9TVCIsIHVybDogImh0dHA6Ly9kb21haW4uY29tOjgwIiwgZGF0YToge319KS50aGVuKGZ1bmN0aW9uKHZhbHVlKSB7cmV0dXJuIHZhbHVlfSkKCQltb2NrLlhNTEh0dHBSZXF1ZXN0LiRpbnN0YW5jZXMucG9wKCkub25yZWFkeXN0YXRlY2hhbmdlKCkKCQlyZXR1cm4gcHJvcCgpLnVybCA9PT0gImh0dHA6Ly9kb21haW4uY29tOjgwIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHByb3AgPSBtLnJlcXVlc3Qoe21ldGhvZDogIlBPU1QiLCB1cmw6ICJodHRwOi8vZG9tYWluLmNvbTo4MC86dGVzdDEiLCBkYXRhOiB7dGVzdDE6ICJmb28ifX0pLnRoZW4oZnVuY3Rpb24odmFsdWUpIHtyZXR1cm4gdmFsdWV9KQoJCW1vY2suWE1MSHR0cFJlcXVlc3QuJGluc3RhbmNlcy5wb3AoKS5vbnJlYWR5c3RhdGVjaGFuZ2UoKQoJCXJldHVybiBwcm9wKCkudXJsID09PSAiaHR0cDovL2RvbWFpbi5jb206ODAvZm9vIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIGVycm9yID0gbS5wcm9wKCJubyBlcnJvciIpCgkJdmFyIHByb3AgPSBtLnJlcXVlc3Qoe21ldGhvZDogIkdFVCIsIHVybDogInRlc3QiLCBkZXNlcmlhbGl6ZTogZnVuY3Rpb24oKSB7dGhyb3cgbmV3IEVycm9yKCJlcnJvciBvY2N1cnJlZCIpfX0pLnRoZW4obnVsbCwgZXJyb3IpCgkJbW9jay5YTUxIdHRwUmVxdWVzdC4kaW5zdGFuY2VzLnBvcCgpLm9ucmVhZHlzdGF0ZWNoYW5nZSgpCgkJcmV0dXJuIHByb3AoKSA9PT0gdW5kZWZpbmVkICYmIGVycm9yKCkubWVzc2FnZSA9PT0gImVycm9yIG9jY3VycmVkIgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIGVycm9yID0gbS5wcm9wKCJubyBlcnJvciIpLCBleGNlcHRpb24KCQl2YXIgcHJvcCA9IG0ucmVxdWVzdCh7bWV0aG9kOiAiR0VUIiwgdXJsOiAidGVzdCIsIGRlc2VyaWFsaXplOiBmdW5jdGlvbigpIHt0aHJvdyBuZXcgVHlwZUVycm9yKCJlcnJvciBvY2N1cnJlZCIpfX0pLnRoZW4obnVsbCwgZXJyb3IpCgkJdHJ5IHttb2NrLlhNTEh0dHBSZXF1ZXN0LiRpbnN0YW5jZXMucG9wKCkub25yZWFkeXN0YXRlY2hhbmdlKCl9CgkJY2F0Y2ggKGUpIHtleGNlcHRpb24gPSBlfQoJCW0uZW5kQ29tcHV0YXRpb24oKQoJCXJldHVybiBwcm9wKCkgPT09IHVuZGVmaW5lZCAmJiBlcnJvcigpID09PSAibm8gZXJyb3IiICYmIGV4Y2VwdGlvbi5tZXNzYWdlID09ICJlcnJvciBvY2N1cnJlZCIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciBlcnJvciA9IG0ucHJvcCgibm8gZXJyb3IiKQoJCXZhciBwcm9wID0gbS5yZXF1ZXN0KHttZXRob2Q6ICJQT1NUIiwgdXJsOiAidGVzdCJ9KS50aGVuKG51bGwsIGVycm9yKQoJCXZhciB4aHIgPSBtb2NrLlhNTEh0dHBSZXF1ZXN0LiRpbnN0YW5jZXMucG9wKCkKCQl4aHIub25yZWFkeXN0YXRlY2hhbmdlKCkKCQlyZXR1cm4geGhyLiRoZWFkZXJzWyJDb250ZW50LVR5cGUiXSA9PSAiYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD11dGYtOCIKCX0pCgoJLy9tLmRlZmVycmVkCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciB2YWx1ZQoJCXZhciBkZWZlcnJlZCA9IG0uZGVmZXJyZWQoKQoJCWRlZmVycmVkLnByb21pc2UudGhlbihmdW5jdGlvbihkYXRhKSB7dmFsdWUgPSBkYXRhfSkKCQlkZWZlcnJlZC5yZXNvbHZlKCJ0ZXN0IikKCQlyZXR1cm4gdmFsdWUgPT09ICJ0ZXN0IgoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHZhbHVlCgkJdmFyIGRlZmVycmVkID0gbS5kZWZlcnJlZCgpCgkJZGVmZXJyZWQucHJvbWlzZS50aGVuKGZ1bmN0aW9uKGRhdGEpIHtyZXR1cm4gImZvbyJ9KS50aGVuKGZ1bmN0aW9uKGRhdGEpIHt2YWx1ZSA9IGRhdGF9KQoJCWRlZmVycmVkLnJlc29sdmUoInRlc3QiKQoJCXJldHVybiB2YWx1ZSA9PT0gImZvbyIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciB2YWx1ZQoJCXZhciBkZWZlcnJlZCA9IG0uZGVmZXJyZWQoKQoJCWRlZmVycmVkLnByb21pc2UudGhlbihudWxsLCBmdW5jdGlvbihkYXRhKSB7dmFsdWUgPSBkYXRhfSkKCQlkZWZlcnJlZC5yZWplY3QoInRlc3QiKQoJCXJldHVybiB2YWx1ZSA9PT0gInRlc3QiCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgdmFsdWUKCQl2YXIgZGVmZXJyZWQgPSBtLmRlZmVycmVkKCkKCQlkZWZlcnJlZC5wcm9taXNlLnRoZW4obnVsbCwgZnVuY3Rpb24oZGF0YSkge3JldHVybiAiZm9vIn0pLnRoZW4obnVsbCwgZnVuY3Rpb24oZGF0YSkge3ZhbHVlID0gZGF0YX0pCgkJZGVmZXJyZWQucmVqZWN0KCJ0ZXN0IikKCQlyZXR1cm4gdmFsdWUgPT09ICJmb28iCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgdmFsdWUxLCB2YWx1ZTIKCQl2YXIgZGVmZXJyZWQgPSBtLmRlZmVycmVkKCkKCQlkZWZlcnJlZC5wcm9taXNlLnRoZW4oZnVuY3Rpb24oZGF0YSkge3Rocm93IG5ldyBFcnJvcn0pLnRoZW4oZnVuY3Rpb24oZGF0YSkge3ZhbHVlMSA9IDF9LCBmdW5jdGlvbihkYXRhKSB7dmFsdWUyID0gZGF0YX0pCgkJZGVmZXJyZWQucmVzb2x2ZSgidGVzdCIpCgkJcmV0dXJuIHZhbHVlMSA9PT0gdW5kZWZpbmVkICYmIHZhbHVlMiBpbnN0YW5jZW9mIEVycm9yCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgZGVmZXJyZWQxID0gbS5kZWZlcnJlZCgpCgkJdmFyIGRlZmVycmVkMiA9IG0uZGVmZXJyZWQoKQoJCXZhciB2YWx1ZTEsIHZhbHVlMgoJCWRlZmVycmVkMS5wcm9taXNlLnRoZW4oZnVuY3Rpb24oZGF0YSkgewoJCQl2YWx1ZTEgPSBkYXRhCgkJCXJldHVybiBkZWZlcnJlZDIucHJvbWlzZQoJCX0pLnRoZW4oZnVuY3Rpb24oZGF0YSkgewoJCQl2YWx1ZTIgPSBkYXRhCgkJfSkKCQlkZWZlcnJlZDEucmVzb2x2ZSgxKQoJCWRlZmVycmVkMi5yZXNvbHZlKDIpCgkJcmV0dXJuIHZhbHVlMSA9PT0gMSAmJiB2YWx1ZTIgPT09IDIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy84MAoJCXZhciBkZWZlcnJlZCA9IG0uZGVmZXJyZWQoKSwgdmFsdWUKCQlkZWZlcnJlZC5yZXNvbHZlKDEpCgkJZGVmZXJyZWQucHJvbWlzZS50aGVuKGZ1bmN0aW9uKGRhdGEpIHsKCQkJdmFsdWUgPSBkYXRhCgkJfSkKCQlyZXR1cm4gdmFsdWUgPT09IDEKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy84MAoJCXZhciBkZWZlcnJlZCA9IG0uZGVmZXJyZWQoKSwgdmFsdWUKCQlkZWZlcnJlZC5yZWplY3QoMSkKCQlkZWZlcnJlZC5wcm9taXNlLnRoZW4obnVsbCwgZnVuY3Rpb24oZGF0YSkgewoJCQl2YWx1ZSA9IGRhdGEKCQl9KQoJCXJldHVybiB2YWx1ZSA9PT0gMQoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzgwCgkJdmFyIGRlZmVycmVkID0gbS5kZWZlcnJlZCgpLCB2YWx1ZQoJCWRlZmVycmVkLnJlc29sdmUoMSkKCQlkZWZlcnJlZC5yZXNvbHZlKDIpCgkJZGVmZXJyZWQucHJvbWlzZS50aGVuKGZ1bmN0aW9uKGRhdGEpIHsKCQkJdmFsdWUgPSBkYXRhCgkJfSkKCQlyZXR1cm4gdmFsdWUgPT09IDEKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy84MAoJCXZhciBkZWZlcnJlZCA9IG0uZGVmZXJyZWQoKSwgdmFsdWUKCQlkZWZlcnJlZC5wcm9taXNlLnRoZW4oZnVuY3Rpb24oZGF0YSkgewoJCQl2YWx1ZSA9IGRhdGEKCQl9KQoJCWRlZmVycmVkLnJlc29sdmUoMSkKCQlkZWZlcnJlZC5yZXNvbHZlKDIpCgkJcmV0dXJuIHZhbHVlID09PSAxCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvODAKCQl2YXIgZGVmZXJyZWQgPSBtLmRlZmVycmVkKCksIHZhbHVlMSwgdmFsdWUyCgkJZGVmZXJyZWQucHJvbWlzZS50aGVuKGZ1bmN0aW9uKGRhdGEpIHsKCQkJdmFsdWUxID0gZGF0YQoJCX0sIGZ1bmN0aW9uKGRhdGEpIHsKCQkJdmFsdWUyID0gZGF0YQoJCX0pCgkJZGVmZXJyZWQucmVzb2x2ZSgxKQoJCWRlZmVycmVkLnJlamVjdCgyKQoJCXJldHVybiB2YWx1ZTEgPT09IDEgJiYgdmFsdWUyID09PSB1bmRlZmluZWQKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy84MAoJCXZhciBkZWZlcnJlZCA9IG0uZGVmZXJyZWQoKSwgdmFsdWUxLCB2YWx1ZTIKCQlkZWZlcnJlZC5wcm9taXNlLnRoZW4oZnVuY3Rpb24oKSB7CgkJCXZhbHVlMSA9IGRhdGEKCQl9LCBmdW5jdGlvbihkYXRhKSB7CgkJCXZhbHVlMiA9IGRhdGEKCQl9KQoJCWRlZmVycmVkLnJlamVjdCgxKQoJCWRlZmVycmVkLnJlc29sdmUoMikKCQlyZXR1cm4gdmFsdWUxID09PSB1bmRlZmluZWQgJiYgdmFsdWUyID09PSAxCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQkvL2h0dHBzOi8vZ2l0aHViLmNvbS9saG9yaWUvbWl0aHJpbC5qcy9pc3N1ZXMvODAKCQl2YXIgZGVmZXJyZWQgPSBtLmRlZmVycmVkKCksIHZhbHVlCgkJZGVmZXJyZWQucHJvbWlzZS50aGVuKG51bGwsIGZ1bmN0aW9uKGRhdGEpIHsKCQkJdmFsdWUgPSBkYXRhCgkJfSkKCQlkZWZlcnJlZC5yZWplY3QoMSkKCQlkZWZlcnJlZC5yZWplY3QoMikKCQlyZXR1cm4gdmFsdWUgPT09IDEKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCS8vaHR0cHM6Ly9naXRodWIuY29tL2xob3JpZS9taXRocmlsLmpzL2lzc3Vlcy84NQoJCXZhciBkZWZlcnJlZCA9IG0uZGVmZXJyZWQoKSwgdmFsdWUKCQlkZWZlcnJlZC5yZXNvbHZlKCkKCQlkZWZlcnJlZC5wcm9taXNlLnRoZW4oZnVuY3Rpb24oZGF0YSkgewoJCQl2YWx1ZSA9IDEKCQl9KQoJCXJldHVybiB2YWx1ZSA9PT0gMQoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJLy9odHRwczovL2dpdGh1Yi5jb20vbGhvcmllL21pdGhyaWwuanMvaXNzdWVzLzg1CgkJdmFyIGRlZmVycmVkID0gbS5kZWZlcnJlZCgpLCB2YWx1ZQoJCWRlZmVycmVkLnJlamVjdCgpCgkJZGVmZXJyZWQucHJvbWlzZS50aGVuKG51bGwsIGZ1bmN0aW9uKGRhdGEpIHsKCQkJdmFsdWUgPSAxCgkJfSkKCQlyZXR1cm4gdmFsdWUgPT09IDEKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciBkZWZlcnJlZCA9IG0uZGVmZXJyZWQoKSwgdmFsdWUKCQlkZWZlcnJlZC5yZXNvbHZlKDEpCgkJcmV0dXJuIGRlZmVycmVkLnByb21pc2UoKSA9PT0gMQoJfSkKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIGRlZmVycmVkID0gbS5kZWZlcnJlZCgpLCB2YWx1ZQoJCXZhciBwcm9taXNlID0gZGVmZXJyZWQucHJvbWlzZS50aGVuKGZ1bmN0aW9uKGRhdGEpIHtyZXR1cm4gZGF0YSArIDF9KQoJCWRlZmVycmVkLnJlc29sdmUoMSkKCQlyZXR1cm4gcHJvbWlzZSgpID09PSAyCgl9KQoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgZGVmZXJyZWQgPSBtLmRlZmVycmVkKCksIHZhbHVlCgkJZGVmZXJyZWQucmVqZWN0KDEpCgkJcmV0dXJuIGRlZmVycmVkLnByb21pc2UoKSA9PT0gdW5kZWZpbmVkCgl9KQoKCS8vbS5zeW5jCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciB2YWx1ZQoJCXZhciBkZWZlcnJlZDEgPSBtLmRlZmVycmVkKCkKCQl2YXIgZGVmZXJyZWQyID0gbS5kZWZlcnJlZCgpCgkJbS5zeW5jKFtkZWZlcnJlZDEucHJvbWlzZSwgZGVmZXJyZWQyLnByb21pc2VdKS50aGVuKGZ1bmN0aW9uKGRhdGEpIHt2YWx1ZSA9IGRhdGF9KQoJCWRlZmVycmVkMS5yZXNvbHZlKCJ0ZXN0IikKCQlkZWZlcnJlZDIucmVzb2x2ZSgiZm9vIikKCQlyZXR1cm4gdmFsdWVbMF0gPT09ICJ0ZXN0IiAmJiB2YWx1ZVsxXSA9PT0gImZvbyIKCX0pCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXZhciB2YWx1ZQoJCXZhciBkZWZlcnJlZDEgPSBtLmRlZmVycmVkKCkKCQl2YXIgZGVmZXJyZWQyID0gbS5kZWZlcnJlZCgpCgkJbS5zeW5jKFtkZWZlcnJlZDEucHJvbWlzZSwgZGVmZXJyZWQyLnByb21pc2VdKS50aGVuKGZ1bmN0aW9uKGRhdGEpIHt2YWx1ZSA9IGRhdGF9KQoJCWRlZmVycmVkMi5yZXNvbHZlKCJmb28iKQoJCWRlZmVycmVkMS5yZXNvbHZlKCJ0ZXN0IikKCQlyZXR1cm4gdmFsdWVbMF0gPT09ICJ0ZXN0IiAmJiB2YWx1ZVsxXSA9PT0gImZvbyIKCX0pCgoJLy9tLnN0YXJ0Q29tcHV0YXRpb24vbS5lbmRDb21wdXRhdGlvbgoJdGVzdChmdW5jdGlvbigpIHsKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpCgoJCXZhciBjb250cm9sbGVyCgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgkJbS5tb2R1bGUocm9vdCwgewoJCQljb250cm9sbGVyOiBmdW5jdGlvbigpIHtjb250cm9sbGVyID0gdGhpc30sCgkJCXZpZXc6IGZ1bmN0aW9uKGN0cmwpIHtyZXR1cm4gY3RybC52YWx1ZX0KCQl9KQoKCQltb2NrLnJlcXVlc3RBbmltYXRpb25GcmFtZS4kcmVzb2x2ZSgpCgoJCW0uc3RhcnRDb21wdXRhdGlvbigpCgkJY29udHJvbGxlci52YWx1ZSA9ICJmb28iCgkJbS5lbmRDb21wdXRhdGlvbigpCgkJbW9jay5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUuJHJlc29sdmUoKQoJCQoJCXJldHVybiByb290LmNoaWxkTm9kZXNbMF0ubm9kZVZhbHVlID09PSAiZm9vIgoJfSkKCgkvL2NvbnNvbGUubG9nIHByZXNlbmNlCgl0ZXN0KGZ1bmN0aW9uKCkgewoJCXJldHVybiBtLmRlcHMuZmFjdG9yeS50b1N0cmluZygpLmluZGV4T2YoImNvbnNvbGUiKSA8IDAKCX0pCgoJLy8gY29uZmlnIGNvbnRleHQKCXRlc3QoZnVuY3Rpb24oKSB7CgkJdmFyIHJvb3QgPSBtb2NrLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCgoJCXZhciBzdWNjZXNzID0gZmFsc2U7CgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2Iiwge2NvbmZpZzogZnVuY3Rpb24oZWxlbSwgaXNJbml0aWFsaXplZCwgY3R4KSB7Y3R4LmRhdGE9MX19KSk7CgkJbS5yZW5kZXIocm9vdCwgbSgiZGl2Iiwge2NvbmZpZzogZnVuY3Rpb24oZWxlbSwgaXNJbml0aWFsaXplZCwgY3R4KSB7c3VjY2VzcyA9IGN0eC5kYXRhPT09MX19KSk7CgkJcmV0dXJuIHN1Y2Nlc3M7Cgl9KQoKCS8vIG1vcmUgY29tcGxleCBjb25maWcgY29udGV4dAoJdGVzdChmdW5jdGlvbigpIHsKCQl2YXIgcm9vdCA9IG1vY2suZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKCgkJdmFyIGlkeCA9IDA7CgkJdmFyIHN1Y2Nlc3MgPSB0cnVlOwoJCXZhciBzdGF0ZWZ1bENvbmZpZyA9IGZ1bmN0aW9uKGVsZW0sIGlzSW5pdGlhbGl6ZWQsIGN0eCkge2N0eC5kYXRhPWlkeCsrfQoJCXZhciBub2RlID0gbSgiZGl2Iiwge2NvbmZpZzogc3RhdGVmdWxDb25maWd9KTsKCQltLnJlbmRlcihyb290LCBbbm9kZSwgbm9kZV0pOwoKCQlpZHggPSAwOwoJCXZhciBjaGVja0NvbmZpZyA9IGZ1bmN0aW9uKGVsZW0sIGlzSW5pdGlhbGl6ZWQsIGN0eCkgewoJCQlzdWNjZXNzID0gc3VjY2VzcyAmJiAoY3R4LmRhdGEgPT09IGlkeCsrKQoJCX0KCQlub2RlID0gbSgiZGl2Iiwge2NvbmZpZzogY2hlY2tDb25maWd9KTsKCQltLnJlbmRlcihyb290LCBbbm9kZSwgbm9kZV0pOwoJCXJldHVybiBzdWNjZXNzOwoJfSkKCn0KCi8vbW9ja3MKdGVzdE1pdGhyaWwobW9jay53aW5kb3cpCgp0ZXN0LnByaW50KGNvbnNvbGUubG9nKQo=",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Fri, 07 Nov 2014 16:12:05 GMT",
                    "Content-Length": "80261",
                    "Date": "Fri, 07 Nov 2014 16:12:07 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}