{
    "url": "http://localhost:9999/phono/s.phono.com/releases/0.6/samples/kitchen-sink/www/kitchen-sink.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Cross-site scripting (DOM-based)",
    "issueType": 2097936,
    "severity": "High",
    "confidence": "Firm",
    "issueBackground": "DOM-based cross-site scripting vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the HTML document in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause JavaScript code supplied by the attacker to execute within the user's browser in the context of that user's session with the application.<br><br>The attacker-supplied code can perform a wide variety of actions, such as stealing the victim's session token or login credentials, performing arbitrary actions on the victim's behalf, and logging their keystrokes.<br><br>Users can be induced to visit the attacker's crafted URL in various ways, similar to the usual attack delivery vectors for reflected cross-site scripting vulnerabilities. ",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based cross-site scripting vulnerabilities is not to dynamically write data into the HTML document that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing script code into the document. In many cases, the relevant data can be validated on a whitelist basis, to allow only content that is known to be safe. In other cases, it will be necessary to sanitize or encode the data. This can be a complex task, and depending on the context that the data is to be inserted may need to involve a combination of JavaScript escaping, HTML encoding, and URL encoding, in the appropriate sequence.",
    "issueDetail": "The application may be vulnerable to DOM-based cross-site scripting. Data is read from <b>window.location.href</b> and written to <b>the 'html()' function of JQuery</b> via the following statements:<ul><li>var baseUrl = window.location.href.substring(0, window.location.href.indexOf('?'));</li><li>newPhonoDi....find(\" ...sessionId+ \"&lt;/a&gt;\" ) </li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/phono/s.phono.com/releases/0.6/samples/kitchen-sink/www/kitchen-sink.js",
                "path": "/phono/s.phono.com/releases/0.6/samples/kitchen-sink/www/kitchen-sink.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9waG9uby9zLnBob25vLmNvbS9yZWxlYXNlcy8wLjYvc2FtcGxlcy9raXRjaGVuLXNpbmsvd3d3L2tpdGNoZW4tc2luay5qcyBIVFRQLzEuMQ0KSG9zdDogbG9jYWxob3N0Ojk5OTkNCg0K",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMjE5NjQNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IEZyaSwgMDcgTm92IDIwMTQgMjE6NTg6MjYgR01UDQpMYXN0LU1vZGlmaWVkOiBGcmksIDA3IE5vdiAyMDE0IDIxOjU4OjIyIEdNVA0KDQovKiBLaXRjaGVuIFNpbmsgKi8KJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CiAgICAvKiB1c2UgY29kZSBsaWtlIHRoaXMgdG8gc2VwY2lmaXkgYSBwYXJ0aWN1bGFyIGNvZGVjLiAqLwogICAgLyoKICAgICBQaG9uby51dGlsLmZpbHRlcldpZGViYW5kID0gZnVuY3Rpb24ob2ZmZXIsIHdpZGViYW5kKSB7CiAgICAgICAgdmFyIGNvZGVjcyA9IG5ldyBBcnJheSgpOwogICAgICAgIFBob25vLnV0aWwuZWFjaChvZmZlciwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGlmICghd2lkZWJhbmQpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLm5hbWUudG9VcHBlckNhc2UoKSA9PSAiRzcyMiIgJiYgdGhpcy5yYXRlID09ICI4MDAwIikgewogICAgICAgICAgICAgICAgICAgIGNvZGVjcy5wdXNoKHRoaXMpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLm5hbWUgPT0gInRlbGVwaG9uZS1ldmVudCIpewogICAgICAgICAgICAgICAgICAgIGNvZGVjcy5wdXNoKHRoaXMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29kZWNzLnB1c2godGhpcyk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICByZXR1cm4gY29kZWNzOwogICAgfTsgICAKICAgICovIAoKICAgIHZhciBwaG9ub3M9e30sIGNhbGxzPXt9LCBjaGF0cz17fTsKICAgIAogICAgZnVuY3Rpb24gdXJsUGFyYW0obmFtZSl7Cgl2YXIgcmVzdWx0cyA9IG5ldyBSZWdFeHAoJ1tcXD8mXScgKyBuYW1lICsgJz0oW14mI10qKScpLmV4ZWMod2luZG93LmxvY2F0aW9uLmhyZWYpOwoJaWYgKCFyZXN1bHRzKSB7IHJldHVybiB1bmRlZmluZWQ7IH0KCXJldHVybiBkZWNvZGVVUklDb21wb25lbnQocmVzdWx0c1sxXSkgfHwgdW5kZWZpbmVkOwogICAgfQoKICAgIGZ1bmN0aW9uIGNyZWF0ZU5ld1Bob25vKCl7CgkvL0Nsb25lIGEgcGhvbm8gZGl2Cgl2YXIgcGhvbm9DdHIgPSAoJCgiLnBob25vIikuc2l6ZSgpICsgMSkgLSAxOwoJdmFyIG5ld1Bob25vSUQgPSAiUGhvbm8iICsgcGhvbm9DdHI7Cgl2YXIgZmlyc3RQaG9ubyA9ICQoJy5waG9ubycpLmZpcnN0KCkKCXZhciBuZXdQaG9ub0RpdiA9IGZpcnN0UGhvbm8uY2xvbmUoKQogICAgICAgIHZhciBhdWRpb1R5cGUgPSAkKCcuYXVkaW8tcGx1Z2luJykudmFsKCk7CiAgICAgICAgdmFyIGJyaWRnZWQgPSBmYWxzZTsKICAgICAgICB2YXIgY29ubmVjdGlvblVybCA9IHdpbmRvdy5sb2NhdGlvbi5wcm90b2NvbCsiLy9hcHAucGhvbm8uY29tL2h0dHAtYmluZCI7CiAgICAgICAgdmFyIHByb3Zpc2lvbmluZ1VybCA9IHVuZGVmaW5lZDsKICAgICAgICB2YXIgZGlhbFN0cmluZyA9ICJzaXA6MzM2NkBsb2dpbi56aXBkeC5jb20iOwogICAgICAgIHZhciBjaGF0U3RyaW5nID0gImVuMmZyQGJvdC50YWxrLmdvb2dsZS5jb20iOwogICAgICAgIHZhciBndyA9ICJndy12Ni5kLnBob25vLmNvbSI7CiAgICAgICAgCiAgICAgICAgaWYgKGNvbm5lY3Rpb25VcmwuaW5kZXhPZigiZmlsZToiKSA9PSAwKXsKICAgICAgICAgICAgY29ubmVjdGlvblVybCA9ICJodHRwOi8vYXBwLnBob25vLmNvbS9odHRwLWJpbmQiOwogICAgICAgIH0KCiAgICAgICAgLy8gRG8gd2UgaGF2ZSBVUkwgcGFyYW1ldGVycyB0byBvdmVycmlkZSBoZXJlPwogICAgICAgIGlmIChhdWRpb1R5cGUgPT0gImF1dG8iICYmIHVybFBhcmFtKCJhdWRpbyIpICE9IHVuZGVmaW5lZCkgYXVkaW9UeXBlID0gdXJsUGFyYW0oImF1ZGlvIik7CiAgICAgICAgaWYgKHVybFBhcmFtKCJjb25uZWN0aW9uVXJsIikgIT0gdW5kZWZpbmVkKSBjb25uZWN0aW9uVXJsID0gdXJsUGFyYW0oImNvbm5lY3Rpb25VcmwiKTsKICAgICAgICBpZiAodXJsUGFyYW0oInByb3Zpc2lvbmluZ1VybCIpICE9IHVuZGVmaW5lZCkgcHJvdmlzaW9uaW5nVXJsID0gdXJsUGFyYW0oInByb3Zpc2lvbmluZ1VybCIpOwogICAgICAgIGlmICh1cmxQYXJhbSgiZGlhbCIpICE9IHVuZGVmaW5lZCkgZGlhbFN0cmluZyA9IHVybFBhcmFtKCJkaWFsIik7CiAgICAgICAgaWYgKHVybFBhcmFtKCJjaGF0IikgIT0gdW5kZWZpbmVkKSBjaGF0U3RyaW5nID0gdXJsUGFyYW0oImNoYXQiKTsKICAgICAgICBpZiAodXJsUGFyYW0oImdhdGV3YXkiKSAhPSB1bmRlZmluZWQpIGd3ID0gdXJsUGFyYW0oImdhdGV3YXkiKTsKCgogICAgICAgIGNvbnNvbGUubG9nKCJhdWRpb1R5cGUgPSAiICsgYXVkaW9UeXBlKTsKICAgICAgICBjb25zb2xlLmxvZygiZGlhbFN0cmluZyA9ICIgKyBkaWFsU3RyaW5nKTsKICAgICAgICBjb25zb2xlLmxvZygiY2hhclN0cmluZyA9ICIgKyBjaGF0U3RyaW5nKTsKCgluZXdQaG9ub0Rpdi5hdHRyKCJpZCIsbmV3UGhvbm9JRCkuYXBwZW5kVG8oJy5waG9ub0hsZHInKS5zaG93KCk7CgluZXdQaG9ub0Rpdi5maW5kKCIucGhvbm9JRCIpLnRleHQobmV3UGhvbm9JRCsiOiIpOwogICAgICAgIG5ld1Bob25vRGl2LmZpbmQoIi5hdWRpb1R5cGUiKS50ZXh0KGF1ZGlvVHlwZSk7CiAgICAgICAgbmV3UGhvbm9EaXYuZmluZCgiLmNhbGxUbyIpLnZhbChkaWFsU3RyaW5nKTsKICAgICAgICBuZXdQaG9ub0Rpdi5maW5kKCIuY2hhdFRvIikudmFsKGNoYXRTdHJpbmcpOwoKICAgICAgICB2YXIgYXVkaW8gPSBhdWRpb1R5cGU7CiAgICAgICAgdmFyIHZpZGVvID0gZmFsc2U7CgogICAgICAgIHZhciBwcm90b2NvbCA9ICJzaXA6IjsKICAgICAgICBpZiAoYXVkaW9UeXBlID09ICJ3ZWJydGMiIHx8IGF1ZGlvVHlwZSA9PSAianNlcCIpIHByb3RvY29sID0gInhtcHA6IjsKCiAgICAgICAgaWYgKGF1ZGlvVHlwZSA9PSAiZmxhc2giKSB7CiAgICAgICAgICAgIGd3ID0gImd3LXYzLmQucGhvbm8uY29tIjsKICAgICAgICAgICAgYXVkaW8gPSAiZmxhc2giOwogICAgICAgICAgICBicmlkZ2VkID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGlmIChhdWRpb1R5cGUgPT0gInBhbmRhIikgewogICAgICAgICAgICBndyA9ICJndy12NC5kLnBob25vLmNvbSI7CiAgICAgICAgICAgIGF1ZGlvID0gImZsYXNoIjsKICAgICAgICAgICAgYnJpZGdlZCA9IGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgaWYgKGF1ZGlvVHlwZSA9PSAicGFuZGFicmlkZ2VkIikgewogICAgICAgICAgICBndyA9ICJndy12NC5kLnBob25vLmNvbSI7CiAgICAgICAgICAgIGF1ZGlvID0gImZsYXNoIjsKICAgICAgICAgICAgYnJpZGdlZCA9IHRydWU7CiAgICAgICAgfQoKICAgICAgICBpZiAoYXVkaW9UeXBlID09ICJqc2VwIikgewogICAgICAgICAgICBndyA9ICJndy12Ni5kLnBob25vLmNvbSI7CiAgICAgICAgICAgIGF1ZGlvID0gImpzZXAiOwogICAgICAgICAgICB2aWRlbyA9IHRydWU7CiAgICAgICAgfQoKCXBob25vc1tuZXdQaG9ub0lEXSA9ICQucGhvbm8oewoJICAgIGFwaUtleTogIkMxN0QxNjdGLTA5QzYtNEU0Qy1BM0RELTIwMjVENDhCQTI0MyIsCiAgICAgICAgICAgIGNvbm5lY3Rpb25Vcmw6Y29ubmVjdGlvblVybCwKICAgICAgICAgICAgcHJvdmlzaW9uaW5nVXJsOnByb3Zpc2lvbmluZ1VybCwKICAgICAgICAgICAgZ2F0ZXdheTpndywKCiAgICAgICAgICAgIG9uUmVhZHk6IGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgICAgICAgICB2YXIgYmFzZVVybCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmLnN1YnN0cmluZygwLCB3aW5kb3cubG9jYXRpb24uaHJlZi5pbmRleE9mKCc/JykpOwogICAgICAgICAgICAgICAgbmV3UGhvbm9EaXYuZmluZCgiLnNlc3Npb25JZCIpLmh0bWwoIjxhIGNsYXNzPSdzZXNzaW9uSWQnIHRhcmdldD0nX2JsYW5rJyBocmVmPSciICsgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYXNlVXJsICsgIj9hdWRpbz0iICsgYXVkaW9UeXBlIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyAiJmNvbm5lY3Rpb25Vcmw9IiArIGNvbm5lY3Rpb25VcmwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArICImZGlhbD0iICsgcHJvdG9jb2wgKyB0aGlzLnNlc3Npb25JZCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgIiZjaGF0PSIgKyB0aGlzLnNlc3Npb25JZCArICInPiIgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArIHRoaXMuc2Vzc2lvbklkICsgIjwvYT4iKTsKICAgICAgICAgICAgICAgIG5ld1Bob25vRGl2LmZpbmQoIi5waG9uZUNvbnRyb2wiKS5zaG93KCk7CgogICAgICAgICAgICAgICAgbmV3UGhvbm9EaXYuZmluZCgiLmF1ZGlvVHlwZSIpLnRleHQodGhpcy5hdWRpby50eXBlKTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmF1ZGlvLnR5cGUgPT0gImZsYXNoIiAmJiBndyA9PSAiZ3ctdjQuZC5waG9uby5jb20iKSB7CiAgICAgICAgICAgICAgICAgICAgbmV3UGhvbm9EaXYuZmluZCgiLmF1ZGlvVHlwZSIpLnRleHQoYnJpZGdlZD8iZmxhc2ggKG5ldyAtIGJyaWRnZWQpIjoiZmxhc2ggKG5ldykiKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5hdWRpby50eXBlID09ICJmbGFzaCIpIHsKICAgICAgICAgICAgICAgICAgICBuZXdQaG9ub0Rpdi5maW5kKCIuYXVkaW9UeXBlIikudGV4dCgiZmxhc2ggKG9sZCkiKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAodGhpcy5hdWRpby5hdWRpb0luRGV2aWNlcyl7CiAgICAgICAgICAgICAgICAgICAgdmFyIGluTGlzdCA9IHRoaXMuYXVkaW8uYXVkaW9JbkRldmljZXMoKTsKICAgICAgICAgICAgICAgICAgICAvL3ZhciBpbkxpc3QgPSBbIkEiLCJCIiwiQyJdOwogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJkZXZpY2VzIGFyZSA6Iitpbkxpc3QpOwogICAgICAgICAgICAgICAgICAgIHZhciBvdXRwdXQgPSBbXTsKCiAgICAgICAgICAgICAgICAgICAgZm9yIChsPTA7bDxpbkxpc3QubGVuZ3RoO2wrKyl7CiAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dC5wdXNoKCc8b3B0aW9uIHZhbHVlPSInKyBpbkxpc3RbbF0gKyciPicrIGluTGlzdFtsXSArJzwvb3B0aW9uPicpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBuZXdQaG9ub0Rpdi5maW5kKCIuYXVkaW8taW5wdXQiKS5odG1sKG91dHB1dC5qb2luKCcnKSk7OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coIlsiK25ld1Bob25vSUQrIl0gUGhvbm8gbG9hZGVkIik7IAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiggISB0aGlzLmF1ZGlvLnBlcm1pc3Npb24oKSApewogICAgICAgICAgICAgICAgICAgdGhpcy5hdWRpby5zaG93UGVybWlzc2lvbkJveCgpOwogICAgICAgICAgICAgICAgfQoKCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG9uVW5yZWFkeTogZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICAgICAgICAgIG5ld1Bob25vRGl2LmZpbmQoIi5zZXNzaW9uSWQiKS50ZXh0KCJkaXNjb25uZWN0ZWQiKTsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJbIituZXdQaG9ub0lEKyJdIFBob25vIGRpc2Nvbm5lY3RlZCIpOyAgCiAgICAgICAgICAgIH0sCQkgICAKICAgICAgICAgICAgb25FcnJvcjogZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICAgICAgICAgIG5ld1Bob25vRGl2LmZpbmQoIi5zZXNzaW9uSWQiKS50ZXh0KGV2ZW50LnJlYXNvbik7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhldmVudC5yZWFzb24pOyAgCiAgICAgICAgICAgIH0sCQkgICAKCSAgICBhdWRpbzogewogICAgICAgICAgICAgICAgdHlwZTogYXVkaW8sCiAgICAgICAgICAgICAgICBqYXI6ICIuLi8uLi8uLi9wbHVnaW5zL2F1ZGlvL3Bob25vLmF1ZGlvLmphciIsCiAgICAgICAgICAgICAgICBzd2Y6ICIuLi8uLi8uLi9wbHVnaW5zL2F1ZGlvL3Bob25vLmF1ZGlvLnN3ZiIsCiAgICAgICAgICAgICAgICBtZWRpYToge2F1ZGlvOnRydWUsIHZpZGVvOnZpZGVvfSwKICAgICAgICAgICAgICAgIGJyaWRnZWQ6IGJyaWRnZWQsCiAgICAgICAgICAgICAgICBvblBlcm1pc3Npb25Cb3hTaG93OiBmdW5jdGlvbihldmVudCkgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJbIituZXdQaG9ub0lEKyJdIEZsYXNoIHBlcm1pc3Npb24gYm94IGxvYWRlZCIpOyAKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBvblBlcm1pc3Npb25Cb3hIaWRlOiBmdW5jdGlvbihldmVudCkgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJbIituZXdQaG9ub0lEKyJdIEZsYXNoIHBlcm1pc3Npb24gYm94IGNsb3NlZCIpOwogICAgICAgICAgICAgICAgICAgIGlmKCAhIHRoaXMucGVybWlzc2lvbigpICl7CiAgICAgICAJCSAgICAJdGhpcy5zaG93UGVybWlzc2lvbkJveCgpOwogICAgICAgCQkgICAgfQogICAgICAgICAgICAgICAgfQoJICAgIH0sCSAgICAgIAoJICAgIHBob25lOiB7CiAgICAgICAgICAgICAgICByaW5nVG9uZTogInJpbmd0b25lcy9EaWdnenRvbmVfTWFyaW1iYS5tcDMiLAogICAgICAgICAgICAgICAgcmluZ2JhY2tUb25lOiAicmluZ3RvbmVzL3JpbmdiYWNrLXVzLm1wMyIsCiAgICAgICAgICAgICAgICBvbkluY29taW5nQ2FsbDogZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICAgICAgICAgICAgICAvLyB3YXMgcHVzaCB0byB0YWxrIGVuYWJsZWQgZm9yIGNhbGxzPwoJCSAgICB2YXIgcHR0RW5hYmxlZDsKCQkgICAgKCQoIiMiK25ld1Bob25vSUQpLmZpbmQoIi5wdXNoLXRvLXRhbGsiKS5pcygiOmNoZWNrZWQiKSkgPyBwdHRFbmFibGVkID0gdHJ1ZSA6IHB0dEVuYWJsZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICB2YXIgbmV3Q2FsbElEID0gY3JlYXRlQ2FsbERpdihuZXdQaG9ub0lELCJpbmNvbWluZyIscHR0RW5hYmxlZCk7CiAgICAgICAgICAgICAgICAgICAgdmFyIG5ld0NhbGxEaXYgPSAkKCIjIituZXdDYWxsSUQpOwogICAgICAgICAgICAgICAgICAgIG5ld0NhbGxEaXYuZmluZCgiLmNhbGxIZWFkZXIgLmNhbGxEZXRhaWwiKS5odG1sKCI8c3Ryb25nPkluY29taW5nIGNhbGwgZnJvbTogPC9zdHJvbmc+IiArIGV2ZW50LmNhbGwuaW5pdGlhdG9yKTsKICAgICAgICAgICAgICAgICAgICBuZXdDYWxsRGl2LmZpbmQoIi5jYWxsSGVhZGVyIC5jYWxsSUQiKS5odG1sKG5ld0NhbGxJRCk7CiAgICAgICAgICAgIAkgICAgY2FsbHNbbmV3Q2FsbElEXSA9IGV2ZW50LmNhbGw7CiAgICAgICAgICAgIAkgICAgY29uc29sZS5sb2coIlsiK25ld1Bob25vSUQrIl0gTmV3IGluY29taW5nIGNhbGwiKTsKICAgICAgICAgICAgICAgICAgICBldmVudC5jYWxsLnRvbmVzKHRydWUpOyAKICAgICAgICAgICAgCSAgICAvL0JpbmQgZXZlbnRzIGZyb20gdGhpcyBjYWxsCiAgICAgICAgICAgIAkgICAgY2FsbHNbbmV3Q2FsbElEXS5iaW5kKHsKICAgICAgICAgICAgIAkgICAgICAgIG9uSGFuZ3VwOiBmdW5jdGlvbihldmVudCkgewoJICAgICAgICAgICAgICAgICAgICB3aW5kb3cuY2xlYXJJbnRlcnZhbChjYWxsc1tuZXdDYWxsSURdLmVuZXJneVBvbGwpOwogICAgICAgICAgICAgCSAgICAgICAgICAgIG5ld0NhbGxEaXYuc2xpZGVVcCgpOwogICAgICAgICAgICAgCSAgICAgICAgICAgIGNhbGxzW25ld0NhbGxJRF0gPSBudWxsOwogICAgICAgICAgICAgCSAgICAgICAgICAgIGNvbnNvbGUubG9nKCJbIituZXdQaG9ub0lEKyJdIFsiK25ld0NhbGxJRCsiXSBDYWxsIGh1bmd1cCIpOwogICAgICAgICAgICAgCSAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgb25BbnN3ZXI6IGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2VjdXJlID0gY2FsbHNbbmV3Q2FsbElEXS5zZWN1cmUoKTsKICAgICAgICAgICAgCSAgICAgICAgICAgIGNvbnNvbGUubG9nKCJbIituZXdQaG9ub0lEKyJdIFsiK25ld0NhbGxJRCsiXSBDYWxsIGFuc3dlcmVkIHVzaW5nICIgKyBjYWxsc1tuZXdDYWxsSURdLmNvZGVjLm5hbWUgKyAiLyIgKyBjYWxsc1tuZXdDYWxsSURdLmNvZGVjLnJhdGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3Q2FsbERpdi5maW5kKCIuY2FsbENvZGVjIikuaHRtbCgiPHN0cm9uZz5Db2RlYzo8L3N0cm9uZz4gIiArIGNhbGxzW25ld0NhbGxJRF0uY29kZWMubmFtZSArICIvIiArIGNhbGxzW25ld0NhbGxJRF0uY29kZWMucmF0ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdDYWxsRGl2LmZpbmQoIi5jYWxsU2VjdXJlIikuaHRtbChzZWN1cmUgPyAiKHNlY3VyZSkiIDogIiIpOyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxzW25ld0NhbGxJRF0uZW5lcmd5UG9sbCA9IHdpbmRvdy5zZXRJbnRlcnZhbChmdW5jdGlvbigpewoJICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNhbGxEaXYgPSAkKCIjIituZXdDYWxsSUQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0ciA9ICI8c3Ryb25nPk1pYzo8L3N0cm9uZz4gIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZSA9IGNhbGxzW25ld0NhbGxJRF0uZW5lcmd5KCkubWljOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoaT0wO2k8MTA7aSsrKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyID0gc3RyKyAoKGkgPCBtZSk/IlgiOiJfIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxEaXYuZmluZCgiLmNhbGxNaWNFbmVyZ3kiKS5odG1sKHN0cik7CQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0ciA9ICI8c3Ryb25nPlNwazo8L3N0cm9uZz4gIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZSA9IGNhbGxzW25ld0NhbGxJRF0uZW5lcmd5KCkuc3BrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoaT0wO2k8MTA7aSsrKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyID0gc3RyKyAoKGkgPCBzZSk/IlgiOiJfIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld0NhbGxEaXYuZmluZCgiLmNhbGxTcGtFbmVyZ3kiKS5odG1sKHN0cik7CQoJCSAgICAgICAgICAgIH0sNTAwKTsKCQkJICAgIAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgCSAgICAgICAgb25FcnJvcjogZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICAgICAgIAkgICAJICAgIGNvbnNvbGUubG9nKCJbIituZXdQaG9ub0lEKyJdIFsiK25ld0NhbGxJRCsiXSBFcnJvcjogWyIgKyBldmVudC5yZWFzb24gKyAiXSIpOwogICAgICAgICAgICAgCSAgICAgICAgfQogICAgICAgICAgICAJICAgIH0pOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIG9uRXJyb3I6IGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgICAgIAkgICAgY29uc29sZS5sb2coIlsiK25ld1Bob25vSUQrIl0gRXJyb3I6IFsiICsgZXZlbnQucmVhc29uICsgIl0iKTsKICAgICAgICAgICAgICAgIH0KCSAgICB9LAoJICAgIAoJICAgIG1lc3NhZ2luZzogewogICAgICAgICAgICAgICAgb25NZXNzYWdlOiBmdW5jdGlvbihldmVudCwgbWVzc2FnZSkgewogICAgICAgICAgICAJICAgIHZhciBKSUQgPSBtZXNzYWdlLmZyb20uc3BsaXQoIi8iKTsKICAgICAgICAgICAgCSAgICBjb25zb2xlLmxvZygiWyIrbmV3UGhvbm9JRCsiXSBNZXNzYWdlIGZyb20gIiArIEpJRFswXSArICIgWyIgKyBtZXNzYWdlLmJvZHkgKyAiXSIpOwogICAgICAgICAgICAJICAgIHJvdXRlTWVzc2FnZShuZXdQaG9ub0lELCJpbmNvbWluZyIsSklEWzBdLG1lc3NhZ2UuYm9keSk7CiAgICAgICAgICAgICAgICB9CgkgICAgfQogICAgICAgIH0pOwogICAgfQogICAgCiAgICAvL0NyZWF0ZXMgYSBuZXcgY2FsbAogICAgZnVuY3Rpb24gY3JlYXRlTmV3Q2FsbChwaG9ub0lELCB0byl7CgkvL2Nsb25lIGEgY2FsbCBib3gKCXZhciBwaG9ub0RpdiA9ICQoIiMiK3Bob25vSUQpOwoJCgkvLyB3YXMgcHVzaCB0byB0YWxrIGVuYWJsZWQgZm9yIGNhbGxzPwoJdmFyIHB0dEVuYWJsZWQ7CgkocGhvbm9EaXYuZmluZCgiLnB1c2gtdG8tdGFsayIpLmlzKCI6Y2hlY2tlZCIpKSA/IHB0dEVuYWJsZWQgPSB0cnVlIDogcHR0RW5hYmxlZCA9IGZhbHNlOwoJCgl2YXIgbmV3Q2FsbElEID0gY3JlYXRlQ2FsbERpdihwaG9ub0lELCJvdXRnb2luZyIscHR0RW5hYmxlZCk7Cgl2YXIgY2FsbERpdiA9ICQoIiMiK25ld0NhbGxJRCk7CgljYWxsRGl2LmZpbmQoIi5jYWxsSUQiKS50ZXh0KG5ld0NhbGxJRCk7CgljYWxsRGl2LmZpbmQoIi5jYWxsRGV0YWlsIikuaHRtbCgiPHN0cm9uZz5PdXRnb2luZyBjYWxsIHRvOjwvc3Ryb25nPiAiICsgdG8pOwoJY29uc29sZS5sb2coIlsiK3Bob25vRGl2LmF0dHIoJ2lkJykrIl0gWyIrbmV3Q2FsbElEKyJdIENhbGxpbmcgIit0byk7CgkKCWNhbGxzW25ld0NhbGxJRF0gPSBwaG9ub3NbcGhvbm9JRF0ucGhvbmUuZGlhbCh0bywgewoJICAgIHRvbmVzOiB0cnVlLAoJICAgIHB1c2hUb1RhbGs6IHB0dEVuYWJsZWQsCiAgICAgICAgICAgIG9uQW5zd2VyOiBmdW5jdGlvbihldmVudCkgewogICAgICAgICAgICAgICAgdmFyIHNlY3VyZSA9IGNhbGxzW25ld0NhbGxJRF0uc2VjdXJlKCk7CiAgICAgICAgICAgIAljb25zb2xlLmxvZygiWyIrcGhvbm9EaXYuYXR0cignaWQnKSsiXSBbIituZXdDYWxsSUQrIl0gQ2FsbCBhbnN3ZXJlZCB1c2luZyAiICsgY2FsbHNbbmV3Q2FsbElEXS5jb2RlYy5uYW1lICsgIi8iICsgY2FsbHNbbmV3Q2FsbElEXS5jb2RlYy5yYXRlKTsKICAgICAgICAgICAgICAgIGNhbGxEaXYuZmluZCgiLmNhbGxDb2RlYyIpLmh0bWwoIjxzdHJvbmc+Q29kZWM6PC9zdHJvbmc+ICIgKyBjYWxsc1tuZXdDYWxsSURdLmNvZGVjLm5hbWUgKyAiLyIgKyBjYWxsc1tuZXdDYWxsSURdLmNvZGVjLnJhdGUpOwogICAgICAgICAgICAgICAgY2FsbERpdi5maW5kKCIuY2FsbFNlY3VyZSIpLmh0bWwoc2VjdXJlID8gIihzZWN1cmUpIiA6ICIiKTsgCiAgICAgICAgICAgICAgICBjYWxsc1tuZXdDYWxsSURdLmVuZXJneVBvbGwgPSB3aW5kb3cuc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKXsKCSAgICAgICAgICAgICB2YXIgY2FsbERpdiA9ICQoIiMiK25ld0NhbGxJRCk7CiAgICAgICAgICAgICAgICAgICAgIHN0ciA9ICI8c3Ryb25nPk1pYzo8L3N0cm9uZz4gIjsKICAgICAgICAgICAgICAgICAgICAgbWUgPSBjYWxsc1tuZXdDYWxsSURdLmVuZXJneSgpLm1pYzsKICAgICAgICAgICAgICAgICAgICAgZm9yIChpPTA7aTwxMDtpKyspewogICAgICAgICAgICAgICAgICAgICAgIHN0ciA9IHN0cisgKChpIDwgbWUpPyJYIjoiXyIpOwogICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgIGNhbGxEaXYuZmluZCgiLmNhbGxNaWNFbmVyZ3kiKS5odG1sKHN0cik7CQogICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgc3RyID0gIjxzdHJvbmc+U3BrOjwvc3Ryb25nPiAiOwogICAgICAgICAgICAgICAgICAgICBzZSA9IGNhbGxzW25ld0NhbGxJRF0uZW5lcmd5KCkuc3BrOwogICAgICAgICAgICAgICAgICAgICBmb3IgKGk9MDtpPDEwO2krKyl7CiAgICAgICAgICAgICAgICAgICAgICAgc3RyID0gc3RyKyAoKGkgPCBzZSk/IlgiOiJfIik7CiAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgY2FsbERpdi5maW5kKCIuY2FsbFNwa0VuZXJneSIpLmh0bWwoc3RyKTsJCgkJfSw1MDApOwoJCQkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgb25IYW5ndXA6IGZ1bmN0aW9uKCkgewoJCXdpbmRvdy5jbGVhckludGVydmFsKGNhbGxzW25ld0NhbGxJRF0uZW5lcmd5UG9sbCk7CiAgICAgICAgICAgIAljYWxsc1tuZXdDYWxsSURdID0gbnVsbDsKICAgICAgICAgICAgCSQoIiMiK25ld0NhbGxJRCkuc2xpZGVVcCgpOwogICAgICAgICAgICAJY29uc29sZS5sb2coIlsiK3Bob25vRGl2LmF0dHIoJ2lkJykrIl0gWyIrbmV3Q2FsbElEKyJdIENhbGwgaHVuZ3VwIik7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0KICAgIAogICAgLy9Sb3V0ZXMgYSBtZXNzYWdlIHRvIHRoZSBhcHByb3ByaWF0ZSBjaGF0IG9yIGNyZWF0ZXMgYSBuZXcgY2hhdAogICAgZnVuY3Rpb24gcm91dGVNZXNzYWdlKHBob25vSUQsIHR5cGUsIGppZCwgbWVzc2FnZSl7Cgl2YXIgdGhlQ2hhdCA9ICIiOwoJJC5lYWNoKGNoYXRzLCBmdW5jdGlvbihrZXksIHZhbHVlKSB7CgkgICAgaWYoIHZhbHVlID09IGppZCApewoJCXRoZUNoYXQgPSBrZXk7CgkJdmFyIG5ld01zZyA9IGNoYXRNZXNzYWdlKGppZCxtZXNzYWdlLCJpbmJvdW5kIik7CgkJdmFyIGNoYXREaXYgPSAkKCIjIit0aGVDaGF0KTsKCQlyZW5kZXJOZXdNZXNzYWdlKGNoYXREaXYsIG5ld01zZyk7CgkJY2hhdERpdi5maW5kKCIuY2hhdFR4dElucHV0IikuZm9jdXMoKTsKCQlyZXR1cm47CgkgICAgfQogICAJfSk7CiAgIAkKIAkvL0RpZCB3ZSBmaW5kIGEgY2hhdD8KCWlmKCEgdGhlQ2hhdC5sZW5ndGgpewoJICAgIGNyZWF0ZU5ld0NoYXQocGhvbm9JRCxqaWQsbWVzc2FnZSk7Cgl9CiAgICB9CiAgICAKICAgIC8vT3V0cHV0cyBhbiBJTSBtZXNzYWdlCiAgICBmdW5jdGlvbiByZW5kZXJOZXdNZXNzYWdlKGNoYXQsIG1zZyl7CgljaGF0LmZpbmQoIi5jaGF0Qm94IikuYXBwZW5kKG1zZyk7CgljaGF0LmZpbmQoIi5jaGF0Qm94IikuYXR0cih7IHNjcm9sbFRvcDogY2hhdC5maW5kKCIuY2hhdEJveCIpLmF0dHIoInNjcm9sbEhlaWdodCIpIH0pOwogICAgfQogICAgCiAgICAvL0NyZWF0ZXMgYSBuZXcgZGl2IHRvIGhvbGQgYSBjYWxsLiBSZXR1cm5zIHRoZSBpZCBvZiB0aGUgbmV3IGRpdgogICAgZnVuY3Rpb24gY3JlYXRlQ2FsbERpdihwaG9ub0lELGNhbGxUeXBlLHB0dEVuYWJsZWQpewoJLy9jbG9uZSBhIGNhbGwgYm94Cgl2YXIgcGhvbm9EaXYgPSAkKCIjIitwaG9ub0lEKTsKCXZhciBjYWxsQm94ID0gcGhvbm9EaXYuZmluZCgiLmNhbGxzIik7Cgl2YXIgbmV3Q2FsbEN0ciA9ICgkKCIuY2FsbEhsZHIiKS5zaXplKCkgKyAxKSAtIDI7CgluZXdDYWxsSUQgPSAiQ2FsbCIgKyBuZXdDYWxsQ3RyOwoJdmFyIGZpcnN0Q2FsbCA9ICQoIi5jYWxsSGxkciIpLmZpcnN0KCkKCXZhciBuZXdDYWxsRGl2ID0gZmlyc3RDYWxsLmNsb25lKCkKCW5ld0NhbGxEaXYuYXR0cigiaWQiLG5ld0NhbGxJRCkuYXBwZW5kVG8oY2FsbEJveCkuc2hvdygpOwoJCglpZiggY2FsbFR5cGUgPT0gIm91dGdvaW5nIil7CgkgICAgbmV3Q2FsbERpdi5maW5kKCIuY2FsbElucHV0cyIpLnNob3coKTsKCX1lbHNlewoJICAgIG5ld0NhbGxEaXYuZmluZCgiLmNhbGxDb250cm9scyIpLnNob3coKTsKCX0KCQoJcHR0RW5hYmxlZCA/IG5ld0NhbGxEaXYuZmluZCgiLnRhbGtTdGFydCIpLnNob3coKSA6IG5ld0NhbGxEaXYuZmluZCgiLnRhbGtTdGFydCIpLmhpZGUoKTsKCQoJcmV0dXJuIG5ld0NhbGxJRDsKICAgIH0KICAgIAogICAgLy9DcmVhdGVzIGEgbmV3IGNoYXQKICAgIGZ1bmN0aW9uIGNyZWF0ZU5ld0NoYXQocGhvbm9JRCwgdG8sIG1lc3NhZ2UpewoJLy9jbG9uZSBhIGNoYXQgYm94Cgl2YXIgcGhvbm9EaXYgPSAkKCIjIitwaG9ub0lEKTsKCXZhciBuZXdDaGF0SUQgPSBjcmVhdGVDaGF0RGl2KHBob25vSUQpOwoJdmFyIGNoYXREaXYgPSAkKCIjIituZXdDaGF0SUQpOwoJY2hhdERpdi5maW5kKCIuY2hhdElEIikudGV4dChuZXdDaGF0SUQpOwoJY2hhdERpdi5maW5kKCIuY2hhdERldGFpbCIpLmh0bWwodG8pOwoJCglpZiggbWVzc2FnZS5sZW5ndGggKXsKCSAgICB2YXIgbmV3TXNnID0gY2hhdE1lc3NhZ2UodG8sbWVzc2FnZSwiaW5ib3VuZCIpOwoJICAgIHJlbmRlck5ld01lc3NhZ2UoY2hhdERpdiwgbmV3TXNnKTsKCX0KCQoJY29uc29sZS5sb2coIlsiK3Bob25vRGl2LmF0dHIoJ2lkJykrIl0gWyIrbmV3Q2hhdElEKyJdIENoYXQgc3RhcnRlZCB3aXRoICIgKyB0byk7CgkKCWNoYXRzW25ld0NoYXRJRF0gPSB0bzsKICAgIH0KICAgIAogICAgLy9DcmVhdGVzIGEgbmV3IGRpdiB0byBob2xkIGEgY2hhdC4gUmV0dXJucyB0aGUgaWQgb2YgdGhlIG5ldyBkaXYKICAgIGZ1bmN0aW9uIGNyZWF0ZUNoYXREaXYocGhvbm9JRCl7CgkvL2Nsb25lIGEgY2hhdCBib3gKCXZhciBwaG9ub0RpdiA9ICQoIiMiK3Bob25vSUQpOwoJdmFyIGNoYXRCb3ggPSBwaG9ub0Rpdi5maW5kKCIuY2hhdHMiKTsKCXZhciBuZXdDaGF0Q3RyID0gKCQoIi5jaGF0SGxkciIpLnNpemUoKSArIDEpIC0gMjsKCW5ld0NoYXRJRCA9ICJDaGF0IiArIG5ld0NoYXRDdHI7Cgl2YXIgZmlyc3RDaGF0ID0gJCgiLmNoYXRIbGRyIikuZmlyc3QoKTsKCXZhciBuZXdDaGF0RGl2ID0gZmlyc3RDaGF0LmNsb25lKCk7CgluZXdDaGF0RGl2LmF0dHIoImlkIixuZXdDaGF0SUQpLmFwcGVuZFRvKGNoYXRCb3gpLnNob3coKTsKCW5ld0NoYXREaXYuZmluZCgiLmNoYXRUeHRJbnB1dCIpLmZvY3VzKCk7CgkKCXJldHVybiBuZXdDaGF0SUQ7CiAgICB9CgogICAgZnVuY3Rpb24gaXNJT1MoKSB7CiAgICAgICAgdmFyIHVzZXJBZ2VudCA9IHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50OwogICAgICAgIGlmICh1c2VyQWdlbnQubWF0Y2goL2lQYWQvaSkgfHwgdXNlckFnZW50Lm1hdGNoKC9pUGhvbmUvaSkpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gaXNBbmRyb2lkKCkgewogICAgICAgIHZhciB1c2VyQWdlbnQgPSB3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudDsKICAgICAgICBpZiAodXNlckFnZW50Lm1hdGNoKC9BbmRyb2lkL2kpKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICAKICAgIC8vIENyZWF0ZSBhbmQgcmV0dXJuIGEgY2hhdCBtZXNzYWdlIGJ1YmJsZQogICAgdmFyIGNoYXRNZXNzYWdlID0gZnVuY3Rpb24oZnJvbSxib2R5LHR5cGUpewoJdmFyIHJlc3VsdDsKCQoJaWYoIHR5cGUgPT0gJ2luYm91bmQnKXsKCSAgICB2YXIgYm9yZGVyU3R5bGUgPSAiaW5ib3VuZCI7CgkgICAgdmFyIGZyb21TdHlsZSA9ICJmcm9tSW5ib3VuZCI7Cgl9ZWxzZXsKCSAgICB2YXIgYm9yZGVyU3R5bGUgPSAib3V0Ym91bmQiOwoJICAgIHZhciBmcm9tU3R5bGUgPSAiZnJvbU91dGJvdW5kIjsKCX0KCQoJcmVzdWx0ID0gJCgiPGRpdj4iKQoJICAgIC5hZGRDbGFzcygiY2hhdEVudHJ5IikKCSAgICAuYWRkQ2xhc3MoYm9yZGVyU3R5bGUpOwoJdmFyIGZyb21IZWFkZXIgPSAkKCI8ZGl2PiIpCgkgICAgLmFkZENsYXNzKCJmcm9tIikKCSAgICAuYWRkQ2xhc3MoZnJvbVN0eWxlKQoJICAgIC5odG1sKGZyb20pCgkgICAgLmFwcGVuZFRvKHJlc3VsdCk7Cgl2YXIgbXNnQm9keSA9ICQoIjxkaXY+IikKCSAgICAuYWRkQ2xhc3MoImJvZHkiKQoJICAgIC5odG1sKGJvZHkpCgkgICAgLmFwcGVuZFRvKHJlc3VsdCk7CgkKCXJldHVybiByZXN1bHQ7CiAgICB9CiAgICAKICAgIC8vRE9NIEV2ZW50IEhhbmRsZXJzCiAgICAkKCIuYWRkUGhvbm8iKS5jbGljayhmdW5jdGlvbigpewoJY3JlYXRlTmV3UGhvbm8oKTsKCXJldHVybiBmYWxzZTsKICAgIH0pOwogICAgCiAgICAkKCcuY2xvc2VQaG9ubycpLmxpdmUoJ2NsaWNrJywgZnVuY3Rpb24oKSB7Cgl2YXIgdGhpc1Bob25vID0gJCh0aGlzKS5jbG9zZXN0KCIucGhvbm8iKTsKCXZhciB0aGlzUGhvbm9JRCA9ICQodGhpcykuY2xvc2VzdCgiLnBob25vIikuYXR0cigiaWQiKTsKCXRoaXNQaG9uby5zbGlkZVVwKCk7CglwaG9ub3NbdGhpc1Bob25vLmF0dHIoImlkIildID0gbnVsbDsKCQoJdGhpc1Bob25vLmZpbmQoIi5jYWxsSGxkciIpLmVhY2goZnVuY3Rpb24oKXsKCSAgICBjYWxsc1skKHRoaXMpLmF0dHIoImlkIildID0gbnVsbDsKCX0pOwoJY29uc29sZS5sb2coIlsiK3RoaXNQaG9ub0lEKyJdIFBob25lIHJlbW92ZWQiKTsKICAgIH0pOwogICAgCiAgICAkKCcuY2xvc2VDaGF0JykubGl2ZSgnY2xpY2snLCBmdW5jdGlvbigpIHsKCXZhciB0aGlzQ2hhdCA9ICQodGhpcykuY2xvc2VzdCgiLmNoYXRIbGRyIik7Cgl2YXIgdGhpc0NoYXRJRCA9ICQodGhpcykuY2xvc2VzdCgiLmNoYXRIbGRyIikuYXR0cigiaWQiKTsKCXRoaXNDaGF0LnNsaWRlVXAoKTsKCWNoYXRzW3RoaXNDaGF0SURdID0gbnVsbDsJCgljb25zb2xlLmxvZygiWyIrdGhpc0NoYXRJRCsiXSBDaGF0IGNsb3NlZCIpOwogICAgfSk7CiAgICAKICAgICQoJy5jYWxsJykubGl2ZSgnY2xpY2snLCBmdW5jdGlvbigpIHsKCXZhciB0aGlzUGhvbm8gPSAkKHRoaXMpLmNsb3Nlc3QoIi5waG9ubyIpLmF0dHIoImlkIik7Cgl2YXIgY2FsbFRvID0gJC50cmltKCQoIiMiK3RoaXNQaG9ubykuZmluZCgiLmNhbGxUbyIpLnZhbCgpKTsKCWNyZWF0ZU5ld0NhbGwodGhpc1Bob25vLCBjYWxsVG8pOwogICAgfSk7CiAgICAKICAgICQoJy5oZWFkc2V0JykubGl2ZSgnY2hhbmdlJywgZnVuY3Rpb24oKSB7Cgl2YXIgcGhvbm9JZCA9ICQodGhpcykuY2xvc2VzdCgiLnBob25vIikuYXR0cigiaWQiKTsKCXZhciBoZWFkc2V0RW5hYmxlZCA9ICQoIiMiK3Bob25vSWQpLmZpbmQoIi5oZWFkc2V0IikuaXMoIjpjaGVja2VkIik7Cgljb25zb2xlLmxvZygiWyIrcGhvbm9JZCsiXSBIZWFkc2V0OiAiICsgaGVhZHNldEVuYWJsZWQpOwogICAgCXBob25vc1twaG9ub0lkXS5waG9uZS5oZWFkc2V0KGhlYWRzZXRFbmFibGVkKTsJCQogICAgfSk7CgogICAgJCgnLndpZGViYW5kJykubGl2ZSgnY2hhbmdlJywgZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIHBob25vSWQgPSAkKHRoaXMpLmNsb3Nlc3QoIi5waG9ubyIpLmF0dHIoImlkIik7Cgl2YXIgd2lkZWJhbmREaXNhYmxlZCA9ICQoIiMiK3Bob25vSWQpLmZpbmQoIi53aWRlYmFuZCIpLmlzKCI6Y2hlY2tlZCIpOwoJY29uc29sZS5sb2coIlsiK3Bob25vSWQrIl0gV2lkZWJhbmREaXNhYmxlZDogIiArIHdpZGViYW5kRGlzYWJsZWQpOwogICAgCXBob25vc1twaG9ub0lkXS5waG9uZS53aWRlYmFuZCghd2lkZWJhbmREaXNhYmxlZCk7CiAgICB9KTsKICAgIAogICAgJCgnLnJpbmctdG9uZSwgLnJpbmdiYWNrLXRvbmUnKS5saXZlKCQuYnJvd3Nlci5tc2llID8gJ2NsaWNrJzogJ2NoYW5nZScsIGZ1bmN0aW9uKCkgewoJdmFyIHBob25vSWQgPSAkKHRoaXMpLmNsb3Nlc3QoIi5waG9ubyIpLmF0dHIoImlkIik7Cgl2YXIgdG9uZSA9ICQodGhpcykudmFsKCk7CgkKCWlmKCQodGhpcykuaGFzQ2xhc3MoInJpbmctdG9uZSIpKXsKCSAgICBwaG9ub3NbcGhvbm9JZF0ucGhvbmUucmluZ1RvbmUodG9uZSk7CgkgICAgY29uc29sZS5sb2coIlsiK3Bob25vSWQrIl0gUmluZyB0b25lIHNldDogIiArIHRvbmUpOwoJfWVsc2V7CgkgICAgcGhvbm9zW3Bob25vSWRdLnBob25lLnJpbmdiYWNrVG9uZSh0b25lKTsKCSAgICBjb25zb2xlLmxvZygiWyIrcGhvbm9JZCsiXSBSaW5nYmFjayB0b25lIHNldDogIiArIHRvbmUpOwoJfQkKICAgIH0pOwogICAgJCgnLmF1ZGlvLWlucHV0JykubGl2ZSgkLmJyb3dzZXIubXNpZSA/ICdjbGljayc6ICdjaGFuZ2UnLCBmdW5jdGlvbigpIHsKCXZhciBwaG9ub0lkID0gJCh0aGlzKS5jbG9zZXN0KCIucGhvbm8iKS5hdHRyKCJpZCIpOwogICAgICAgIHZhciBkZXZpY2UgPSAkKHRoaXMpLnZhbCgpOwogICAgICAgIGNvbnNvbGUubG9nKCJbIitwaG9ub0lkKyJdIEF1ZGlvIElucHV0IHNldDogIiArIGRldmljZSk7CglwaG9ub3NbcGhvbm9JZF0ucGhvbmUuYXVkaW9JbnB1dChkZXZpY2UpOwogICAgfSk7IAogICAgJCgnLnNlY3VyaXR5LW9wdGlvbicpLmxpdmUoJC5icm93c2VyLm1zaWUgPyAnY2xpY2snOiAnY2hhbmdlJywgZnVuY3Rpb24oKSB7Cgl2YXIgcGhvbm9JZCA9ICQodGhpcykuY2xvc2VzdCgiLnBob25vIikuYXR0cigiaWQiKTsKICAgICAgICB2YXIgc2VjdXJpdHkgPSAkKHRoaXMpLnZhbCgpOwogICAgICAgIGNvbnNvbGUubG9nKCJbIitwaG9ub0lkKyJdIFNlY3VyaXR5IHNldDogIiArIHNlY3VyaXR5KTsKCXBob25vc1twaG9ub0lkXS5waG9uZS5zZWN1cml0eShzZWN1cml0eSk7CiAgICB9KTsgCiAgICAkKCcuZmxhc2hIZWxwIGEnKS5saXZlKCdjbGljaycsIGZ1bmN0aW9uKCkgewoJdmFyIHRoaXNQaG9ubyA9ICQodGhpcykuY2xvc2VzdCgiLnBob25vIik7CgkkKCIuZmxhc2gtaGxkciIpLmNzcygibGVmdCIsIjI1MC41cHgiKTsKCXRoaXNQaG9uby5maW5kKCIuZmxhc2hIZWxwIikudGV4dCgiVHJ5IGFnYWluIik7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSk7CiAgICAKICAgICQoJy5jaGF0JykubGl2ZSgnY2xpY2snLCBmdW5jdGlvbigpIHsKCXZhciB0aGlzUGhvbm8gPSAkKHRoaXMpLmNsb3Nlc3QoIi5waG9ubyIpLmF0dHIoImlkIik7Cgl2YXIgY2hhdFRvID0gJC50cmltKCQoIiMiK3RoaXNQaG9ubykuZmluZCgiLmNoYXRUbyIpLnZhbCgpKTsKCWNyZWF0ZU5ld0NoYXQodGhpc1Bob25vLCBjaGF0VG8sICIiKTsKICAgIH0pOwogICAgCiAgICAkKCcuc2VuZE1zZycpLmxpdmUoJ2NsaWNrJywgZnVuY3Rpb24oKSB7Cgl2YXIgdGhpc1Bob25vID0gJCh0aGlzKS5jbG9zZXN0KCIucGhvbm8iKTsKCXZhciB0aGlzQ2hhdCA9ICQodGhpcykuY2xvc2VzdCgiLmNoYXRIbGRyIik7Cgl2YXIgbXNnVGV4dCA9IHRoaXNDaGF0LmZpbmQoIi5jaGF0VHh0SW5wdXQiKS52YWwoKTsKCXZhciBuZXdNc2cgPSBjaGF0TWVzc2FnZSgiWW91Iixtc2dUZXh0LCJvdXRnb2luZyIpOwoJcmVuZGVyTmV3TWVzc2FnZSh0aGlzQ2hhdCxuZXdNc2cpOwoJcGhvbm9zW3RoaXNQaG9uby5hdHRyKCJpZCIpXS5tZXNzYWdpbmcuc2VuZChjaGF0c1t0aGlzQ2hhdC5hdHRyKCJpZCIpXSxtc2dUZXh0KTsKCXRoaXNDaGF0LmZpbmQoIi5jaGF0VHh0SW5wdXQiKS52YWwoIiIpOwoJY29uc29sZS5sb2coIlsiK3RoaXNQaG9uby5hdHRyKCdpZCcpKyJdIFNlbmRpbmcgbWVzc2FnZSB0bzogIiArIGNoYXRzW3RoaXNDaGF0LmF0dHIoJ2lkJyldICsgIiBbIiArIG1zZ1RleHQgKyAiXSIpOwogICAgfSk7CiAgICAKICAgICQoJy5oYW5ndXAnKS5saXZlKCdjbGljaycsIGZ1bmN0aW9uKCkgewoJdmFyIHRoaXNDYWxsID0gJCh0aGlzKS5jbG9zZXN0KCIuY2FsbEhsZHIiKS5hdHRyKCJpZCIpOwoJY2FsbHNbdGhpc0NhbGxdLmhhbmd1cCgpOwoJCgkkKCIjIit0aGlzQ2FsbCkuc2xpZGVVcCgiZmFzdCIsIGZ1bmN0aW9uKCl7CgkgICAgJCh0aGlzKS5yZW1vdmUoKTsJCgl9KTsKICAgIH0pOwogICAgCiAgICAkKCcuYW5zd2VyJykubGl2ZSgnY2xpY2snLCBmdW5jdGlvbigpIHsKCXZhciBjYWxsRGl2ID0gJCh0aGlzKS5jbG9zZXN0KCIuY2FsbEhsZHIiKTsKCWNhbGxzW2NhbGxEaXYuYXR0cigiaWQiKV0uYW5zd2VyKCk7CgljYWxsRGl2LmZpbmQoIi5jYWxsQ29udHJvbHMiKS5oaWRlKCk7CgljYWxsRGl2LmZpbmQoIi5jYWxsSW5wdXRzIikuc2hvdygpOwoJY29uc29sZS5sb2coIkNhbGwgYW5zd2VyZWQiKTsKICAgIH0pOwogICAgCiAgICAkKCcubXV0ZScpLmxpdmUoJ2NsaWNrJywgZnVuY3Rpb24oKSB7Cgl2YXIgdGhpc0NhbGwgPSAkKHRoaXMpLmNsb3Nlc3QoIi5jYWxsSGxkciIpLmF0dHIoImlkIik7CgljYWxsc1t0aGlzQ2FsbF0ubXV0ZSh0cnVlKTsKICAgIH0pOwogICAgCiAgICAkKCcudW5NdXRlJykubGl2ZSgnY2xpY2snLCBmdW5jdGlvbigpIHsKCXZhciB0aGlzQ2FsbCA9ICQodGhpcykuY2xvc2VzdCgiLmNhbGxIbGRyIikuYXR0cigiaWQiKTsKCWNhbGxzW3RoaXNDYWxsXS5tdXRlKGZhbHNlKTsKICAgIH0pOwogICAgCiAgICAkKCcuZGlnaXQnKS5saXZlKCdjbGljaycsIGZ1bmN0aW9uKCkgewoJdmFyIHRoaXNDYWxsID0gJCh0aGlzKS5jbG9zZXN0KCIuY2FsbEhsZHIiKS5hdHRyKCJpZCIpOwoJdmFyIHRoZURpZ2l0ID0gJCh0aGlzKS5hdHRyKCJ2YWx1ZSIpOwoJY2FsbHNbdGhpc0NhbGxdLmRpZ2l0KHRoZURpZ2l0KTsKICAgIH0pOwogICAgCiAgICAkKCcudGFsa1N0YXJ0JykubGl2ZSgnbW91c2Vkb3duJywgZnVuY3Rpb24oKSB7Cgl2YXIgdGhpc0NhbGwgPSAkKHRoaXMpLmNsb3Nlc3QoIi5jYWxsSGxkciIpLmF0dHIoImlkIik7CgljYWxsc1t0aGlzQ2FsbF0udGFsa2luZyh0cnVlKTsKICAgIH0pOwogICAgCiAgICAkKCcudGFsa1N0YXJ0JykubGl2ZSgnbW91c2V1cCcsIGZ1bmN0aW9uKCkgewoJdmFyIHRoaXNDYWxsID0gJCh0aGlzKS5jbG9zZXN0KCIuY2FsbEhsZHIiKS5hdHRyKCJpZCIpOwoJY2FsbHNbdGhpc0NhbGxdLnRhbGtpbmcoZmFsc2UpOwogICAgfSk7CiAgICAKICAgICQoJy5zaG93Q2FsbCcpLmxpdmUoJ2NsaWNrJywgZnVuY3Rpb24oKSB7Cgl2YXIgdGhpc1Bob25vID0gJCh0aGlzKS5jbG9zZXN0KCIucGhvbm8iKTsKCXRoaXNQaG9uby5maW5kKCIucGhvbmVJbnB1dCIpLnNob3coKTsKCXRoaXNQaG9uby5maW5kKCIuY2hhdElucHV0IikuaGlkZSgpOwogICAgfSk7CiAgICAKICAgICQoJy50ZXh0JykubGl2ZSgnY2xpY2snLCBmdW5jdGlvbigpIHsKCXZhciB0aGlzUGhvbm8gPSAkKHRoaXMpLmNsb3Nlc3QoIi5waG9ubyIpOwoJdmFyIHRvID0gdGhpc1Bob25vLmZpbmQoIi5qaWQiKS52YWwoKTsKCXZhciBtc2cgPSB0aGlzUGhvbm8uZmluZCgiLm1zZ0JvZHkiKS52YWwoKTsKCXNlbmRNZXNzYWdlKHRoaXNQaG9uby5hdHRyKCJpZCIpLHRvLG1zZyk7Cgl0aGlzUGhvbm8uZmluZCgiLm1zZ0JvZHkiKS52YWwoIiIpOwogICAgfSk7CiAgICAKICAgICQoIi5sb2dUb2dnbGVyIikuY2xpY2soZnVuY3Rpb24oKXsKCWlmKCAkKCIjbG9nQ29uc29sZSIpLmNzcygiaGVpZ2h0IikgPT0gIjI1cHgiICl7CgkgICAgJCgiI2xvZ0NvbnNvbGUiKS5jc3MoImhlaWdodCIsIjI0NXB4Iik7CgkgICAgJCgiYm9keSIpLmNzcygibWFyZ2luLWJvdHRvbSIsIjI4NXB4Iik7CgkgICAgJCh0aGlzKS50ZXh0KCJIaWRlIExvZyBWaWV3ZXIiKTsKCX1lbHNlewoJICAgICQoIiNsb2dDb25zb2xlIikuY3NzKCJoZWlnaHQiLCIyNXB4Iik7CgkgICAgJCgiYm9keSIpLmNzcygibWFyZ2luLWJvdHRvbSIsIjI1cHgiKTsKCSAgICAkKHRoaXMpLnRleHQoIlNob3cgTG9nIFZpZXdlciIpOwoJfQoJCglyZXR1cm4gZmFsc2U7CiAgICB9KTsKCiAgICBpZih3aW5kb3cubG9jYXRpb24ucHJvdG9jb2wgIT0gImh0dHBzOiIgJiYgd2luZG93LmxvY2F0aW9uLnByb3RvY29sICE9ICJodHRwOiIgJiYgIWlzSU9TKCkgJiYgIWlzQW5kcm9pZCgpKXsKCXZhciBlcnJvclRleHQgPSAiTG9va3MgbGlrZSB5b3UgYXJlIHJ1bm5pbmcgdGhpcyBzYW1wbGUgbG9jYWxseSBhbmQgbm90IG9uIGEgd2ViIHNlcnZlci4gVG8gcnVuIHRoaXMgZXhhbXBsZSwgZWl0aGVyIGxvYWQgaXQgZnJvbSBhIHdlYiBzZXJ2ZXIgb3IgPGEgaHJlZj0naHR0cDovL3d3dy5tYWNyb21lZGlhLmNvbS9zdXBwb3J0L2RvY3VtZW50YXRpb24vZW4vZmxhc2hwbGF5ZXIvaGVscC9zZXR0aW5nc19tYW5hZ2VyMDQuaHRtbCcgdGFyZ2V0PSdfYmxhbmsnPmVkaXQgeW91ciBGbGFzaCBzZWN1cml0eSBzZXR0aW5nczwvYT4uIjsKCWVycm9yVGV4dCArPSAiPGJyLz5TZWxlY3QgXCJFZGl0IGxvY2F0aW9uc1wiID4gXCJBZGQgbG9jYXRpb25cIiA+IFwiQnJvd3NlIGZvciBmb2xkZXJcIiBhbmQgc2VsZWN0IHRoZSBcIi9qc1wiIGZvbGRlciBpbiB0aGUgcm9vdCBvZiB5b3VyIGRvd25sb2FkLiI7CgllcnJvclRleHQgKz0gIiA8YSBocmVmPScjJyBvbmNsaWNrPSckKHRoaXMpLnBhcmVudCgpLnNsaWRlVXAoKTsnPkNsb3NlIHRoaXM8L2E+IjsKCXZhciBlcnJvckJveCA9ICQoIjxkaXY+IikKCSAgICAuYWRkQ2xhc3MoImVycm9yIikKCSAgICAuaHRtbChlcnJvclRleHQpCgkgICAgLnByZXBlbmRUbygiYm9keSIpOwogICAgfQoKICAgIGNyZWF0ZU5ld1Bob25vKCk7Cn0pOwoK",
                "body": "LyogS2l0Y2hlbiBTaW5rICovCiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewogICAgLyogdXNlIGNvZGUgbGlrZSB0aGlzIHRvIHNlcGNpZml5IGEgcGFydGljdWxhciBjb2RlYy4gKi8KICAgIC8qCiAgICAgUGhvbm8udXRpbC5maWx0ZXJXaWRlYmFuZCA9IGZ1bmN0aW9uKG9mZmVyLCB3aWRlYmFuZCkgewogICAgICAgIHZhciBjb2RlY3MgPSBuZXcgQXJyYXkoKTsKICAgICAgICBQaG9uby51dGlsLmVhY2gob2ZmZXIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICBpZiAoIXdpZGViYW5kKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5uYW1lLnRvVXBwZXJDYXNlKCkgPT0gIkc3MjIiICYmIHRoaXMucmF0ZSA9PSAiODAwMCIpIHsKICAgICAgICAgICAgICAgICAgICBjb2RlY3MucHVzaCh0aGlzKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5uYW1lID09ICJ0ZWxlcGhvbmUtZXZlbnQiKXsKICAgICAgICAgICAgICAgICAgICBjb2RlY3MucHVzaCh0aGlzKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvZGVjcy5wdXNoKHRoaXMpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIGNvZGVjczsKICAgIH07ICAgCiAgICAqLyAKCiAgICB2YXIgcGhvbm9zPXt9LCBjYWxscz17fSwgY2hhdHM9e307CiAgICAKICAgIGZ1bmN0aW9uIHVybFBhcmFtKG5hbWUpewoJdmFyIHJlc3VsdHMgPSBuZXcgUmVnRXhwKCdbXFw/Jl0nICsgbmFtZSArICc9KFteJiNdKiknKS5leGVjKHdpbmRvdy5sb2NhdGlvbi5ocmVmKTsKCWlmICghcmVzdWx0cykgeyByZXR1cm4gdW5kZWZpbmVkOyB9CglyZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KHJlc3VsdHNbMV0pIHx8IHVuZGVmaW5lZDsKICAgIH0KCiAgICBmdW5jdGlvbiBjcmVhdGVOZXdQaG9ubygpewoJLy9DbG9uZSBhIHBob25vIGRpdgoJdmFyIHBob25vQ3RyID0gKCQoIi5waG9ubyIpLnNpemUoKSArIDEpIC0gMTsKCXZhciBuZXdQaG9ub0lEID0gIlBob25vIiArIHBob25vQ3RyOwoJdmFyIGZpcnN0UGhvbm8gPSAkKCcucGhvbm8nKS5maXJzdCgpCgl2YXIgbmV3UGhvbm9EaXYgPSBmaXJzdFBob25vLmNsb25lKCkKICAgICAgICB2YXIgYXVkaW9UeXBlID0gJCgnLmF1ZGlvLXBsdWdpbicpLnZhbCgpOwogICAgICAgIHZhciBicmlkZ2VkID0gZmFsc2U7CiAgICAgICAgdmFyIGNvbm5lY3Rpb25VcmwgPSB3aW5kb3cubG9jYXRpb24ucHJvdG9jb2wrIi8vYXBwLnBob25vLmNvbS9odHRwLWJpbmQiOwogICAgICAgIHZhciBwcm92aXNpb25pbmdVcmwgPSB1bmRlZmluZWQ7CiAgICAgICAgdmFyIGRpYWxTdHJpbmcgPSAic2lwOjMzNjZAbG9naW4uemlwZHguY29tIjsKICAgICAgICB2YXIgY2hhdFN0cmluZyA9ICJlbjJmckBib3QudGFsay5nb29nbGUuY29tIjsKICAgICAgICB2YXIgZ3cgPSAiZ3ctdjYuZC5waG9uby5jb20iOwogICAgICAgIAogICAgICAgIGlmIChjb25uZWN0aW9uVXJsLmluZGV4T2YoImZpbGU6IikgPT0gMCl7CiAgICAgICAgICAgIGNvbm5lY3Rpb25VcmwgPSAiaHR0cDovL2FwcC5waG9uby5jb20vaHR0cC1iaW5kIjsKICAgICAgICB9CgogICAgICAgIC8vIERvIHdlIGhhdmUgVVJMIHBhcmFtZXRlcnMgdG8gb3ZlcnJpZGUgaGVyZT8KICAgICAgICBpZiAoYXVkaW9UeXBlID09ICJhdXRvIiAmJiB1cmxQYXJhbSgiYXVkaW8iKSAhPSB1bmRlZmluZWQpIGF1ZGlvVHlwZSA9IHVybFBhcmFtKCJhdWRpbyIpOwogICAgICAgIGlmICh1cmxQYXJhbSgiY29ubmVjdGlvblVybCIpICE9IHVuZGVmaW5lZCkgY29ubmVjdGlvblVybCA9IHVybFBhcmFtKCJjb25uZWN0aW9uVXJsIik7CiAgICAgICAgaWYgKHVybFBhcmFtKCJwcm92aXNpb25pbmdVcmwiKSAhPSB1bmRlZmluZWQpIHByb3Zpc2lvbmluZ1VybCA9IHVybFBhcmFtKCJwcm92aXNpb25pbmdVcmwiKTsKICAgICAgICBpZiAodXJsUGFyYW0oImRpYWwiKSAhPSB1bmRlZmluZWQpIGRpYWxTdHJpbmcgPSB1cmxQYXJhbSgiZGlhbCIpOwogICAgICAgIGlmICh1cmxQYXJhbSgiY2hhdCIpICE9IHVuZGVmaW5lZCkgY2hhdFN0cmluZyA9IHVybFBhcmFtKCJjaGF0Iik7CiAgICAgICAgaWYgKHVybFBhcmFtKCJnYXRld2F5IikgIT0gdW5kZWZpbmVkKSBndyA9IHVybFBhcmFtKCJnYXRld2F5Iik7CgoKICAgICAgICBjb25zb2xlLmxvZygiYXVkaW9UeXBlID0gIiArIGF1ZGlvVHlwZSk7CiAgICAgICAgY29uc29sZS5sb2coImRpYWxTdHJpbmcgPSAiICsgZGlhbFN0cmluZyk7CiAgICAgICAgY29uc29sZS5sb2coImNoYXJTdHJpbmcgPSAiICsgY2hhdFN0cmluZyk7CgoJbmV3UGhvbm9EaXYuYXR0cigiaWQiLG5ld1Bob25vSUQpLmFwcGVuZFRvKCcucGhvbm9IbGRyJykuc2hvdygpOwoJbmV3UGhvbm9EaXYuZmluZCgiLnBob25vSUQiKS50ZXh0KG5ld1Bob25vSUQrIjoiKTsKICAgICAgICBuZXdQaG9ub0Rpdi5maW5kKCIuYXVkaW9UeXBlIikudGV4dChhdWRpb1R5cGUpOwogICAgICAgIG5ld1Bob25vRGl2LmZpbmQoIi5jYWxsVG8iKS52YWwoZGlhbFN0cmluZyk7CiAgICAgICAgbmV3UGhvbm9EaXYuZmluZCgiLmNoYXRUbyIpLnZhbChjaGF0U3RyaW5nKTsKCiAgICAgICAgdmFyIGF1ZGlvID0gYXVkaW9UeXBlOwogICAgICAgIHZhciB2aWRlbyA9IGZhbHNlOwoKICAgICAgICB2YXIgcHJvdG9jb2wgPSAic2lwOiI7CiAgICAgICAgaWYgKGF1ZGlvVHlwZSA9PSAid2VicnRjIiB8fCBhdWRpb1R5cGUgPT0gImpzZXAiKSBwcm90b2NvbCA9ICJ4bXBwOiI7CgogICAgICAgIGlmIChhdWRpb1R5cGUgPT0gImZsYXNoIikgewogICAgICAgICAgICBndyA9ICJndy12My5kLnBob25vLmNvbSI7CiAgICAgICAgICAgIGF1ZGlvID0gImZsYXNoIjsKICAgICAgICAgICAgYnJpZGdlZCA9IHRydWU7CiAgICAgICAgfQoKICAgICAgICBpZiAoYXVkaW9UeXBlID09ICJwYW5kYSIpIHsKICAgICAgICAgICAgZ3cgPSAiZ3ctdjQuZC5waG9uby5jb20iOwogICAgICAgICAgICBhdWRpbyA9ICJmbGFzaCI7CiAgICAgICAgICAgIGJyaWRnZWQgPSBmYWxzZTsKICAgICAgICB9CgogICAgICAgIGlmIChhdWRpb1R5cGUgPT0gInBhbmRhYnJpZGdlZCIpIHsKICAgICAgICAgICAgZ3cgPSAiZ3ctdjQuZC5waG9uby5jb20iOwogICAgICAgICAgICBhdWRpbyA9ICJmbGFzaCI7CiAgICAgICAgICAgIGJyaWRnZWQgPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgaWYgKGF1ZGlvVHlwZSA9PSAianNlcCIpIHsKICAgICAgICAgICAgZ3cgPSAiZ3ctdjYuZC5waG9uby5jb20iOwogICAgICAgICAgICBhdWRpbyA9ICJqc2VwIjsKICAgICAgICAgICAgdmlkZW8gPSB0cnVlOwogICAgICAgIH0KCglwaG9ub3NbbmV3UGhvbm9JRF0gPSAkLnBob25vKHsKCSAgICBhcGlLZXk6ICJDMTdEMTY3Ri0wOUM2LTRFNEMtQTNERC0yMDI1RDQ4QkEyNDMiLAogICAgICAgICAgICBjb25uZWN0aW9uVXJsOmNvbm5lY3Rpb25VcmwsCiAgICAgICAgICAgIHByb3Zpc2lvbmluZ1VybDpwcm92aXNpb25pbmdVcmwsCiAgICAgICAgICAgIGdhdGV3YXk6Z3csCgogICAgICAgICAgICBvblJlYWR5OiBmdW5jdGlvbihldmVudCkgewogICAgICAgICAgICAgICAgdmFyIGJhc2VVcmwgPSB3aW5kb3cubG9jYXRpb24uaHJlZi5zdWJzdHJpbmcoMCwgd2luZG93LmxvY2F0aW9uLmhyZWYuaW5kZXhPZignPycpKTsKICAgICAgICAgICAgICAgIG5ld1Bob25vRGl2LmZpbmQoIi5zZXNzaW9uSWQiKS5odG1sKCI8YSBjbGFzcz0nc2Vzc2lvbklkJyB0YXJnZXQ9J19ibGFuaycgaHJlZj0nIiArIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFzZVVybCArICI/YXVkaW89IiArIGF1ZGlvVHlwZSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgIiZjb25uZWN0aW9uVXJsPSIgKyBjb25uZWN0aW9uVXJsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyAiJmRpYWw9IiArIHByb3RvY29sICsgdGhpcy5zZXNzaW9uSWQgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArICImY2hhdD0iICsgdGhpcy5zZXNzaW9uSWQgKyAiJz4iIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyB0aGlzLnNlc3Npb25JZCArICI8L2E+Iik7CiAgICAgICAgICAgICAgICBuZXdQaG9ub0Rpdi5maW5kKCIucGhvbmVDb250cm9sIikuc2hvdygpOwoKICAgICAgICAgICAgICAgIG5ld1Bob25vRGl2LmZpbmQoIi5hdWRpb1R5cGUiKS50ZXh0KHRoaXMuYXVkaW8udHlwZSk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5hdWRpby50eXBlID09ICJmbGFzaCIgJiYgZ3cgPT0gImd3LXY0LmQucGhvbm8uY29tIikgewogICAgICAgICAgICAgICAgICAgIG5ld1Bob25vRGl2LmZpbmQoIi5hdWRpb1R5cGUiKS50ZXh0KGJyaWRnZWQ/ImZsYXNoIChuZXcgLSBicmlkZ2VkKSI6ImZsYXNoIChuZXcpIik7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuYXVkaW8udHlwZSA9PSAiZmxhc2giKSB7CiAgICAgICAgICAgICAgICAgICAgbmV3UGhvbm9EaXYuZmluZCgiLmF1ZGlvVHlwZSIpLnRleHQoImZsYXNoIChvbGQpIik7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHRoaXMuYXVkaW8uYXVkaW9JbkRldmljZXMpewogICAgICAgICAgICAgICAgICAgIHZhciBpbkxpc3QgPSB0aGlzLmF1ZGlvLmF1ZGlvSW5EZXZpY2VzKCk7CiAgICAgICAgICAgICAgICAgICAgLy92YXIgaW5MaXN0ID0gWyJBIiwiQiIsIkMiXTsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiZGV2aWNlcyBhcmUgOiIraW5MaXN0KTsKICAgICAgICAgICAgICAgICAgICB2YXIgb3V0cHV0ID0gW107CgogICAgICAgICAgICAgICAgICAgIGZvciAobD0wO2w8aW5MaXN0Lmxlbmd0aDtsKyspewogICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXQucHVzaCgnPG9wdGlvbiB2YWx1ZT0iJysgaW5MaXN0W2xdICsnIj4nKyBpbkxpc3RbbF0gKyc8L29wdGlvbj4nKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgbmV3UGhvbm9EaXYuZmluZCgiLmF1ZGlvLWlucHV0IikuaHRtbChvdXRwdXQuam9pbignJykpOzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJbIituZXdQaG9ub0lEKyJdIFBob25vIGxvYWRlZCIpOyAKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYoICEgdGhpcy5hdWRpby5wZXJtaXNzaW9uKCkgKXsKICAgICAgICAgICAgICAgICAgIHRoaXMuYXVkaW8uc2hvd1Blcm1pc3Npb25Cb3goKTsKICAgICAgICAgICAgICAgIH0KCgogICAgICAgICAgICB9LAogICAgICAgICAgICBvblVucmVhZHk6IGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgICAgICAgICBuZXdQaG9ub0Rpdi5maW5kKCIuc2Vzc2lvbklkIikudGV4dCgiZGlzY29ubmVjdGVkIik7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiWyIrbmV3UGhvbm9JRCsiXSBQaG9ubyBkaXNjb25uZWN0ZWQiKTsgIAogICAgICAgICAgICB9LAkJICAgCiAgICAgICAgICAgIG9uRXJyb3I6IGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgICAgICAgICBuZXdQaG9ub0Rpdi5maW5kKCIuc2Vzc2lvbklkIikudGV4dChldmVudC5yZWFzb24pOwogICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXZlbnQucmVhc29uKTsgIAogICAgICAgICAgICB9LAkJICAgCgkgICAgYXVkaW86IHsKICAgICAgICAgICAgICAgIHR5cGU6IGF1ZGlvLAogICAgICAgICAgICAgICAgamFyOiAiLi4vLi4vLi4vcGx1Z2lucy9hdWRpby9waG9uby5hdWRpby5qYXIiLAogICAgICAgICAgICAgICAgc3dmOiAiLi4vLi4vLi4vcGx1Z2lucy9hdWRpby9waG9uby5hdWRpby5zd2YiLAogICAgICAgICAgICAgICAgbWVkaWE6IHthdWRpbzp0cnVlLCB2aWRlbzp2aWRlb30sCiAgICAgICAgICAgICAgICBicmlkZ2VkOiBicmlkZ2VkLAogICAgICAgICAgICAgICAgb25QZXJtaXNzaW9uQm94U2hvdzogZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiWyIrbmV3UGhvbm9JRCsiXSBGbGFzaCBwZXJtaXNzaW9uIGJveCBsb2FkZWQiKTsgCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgb25QZXJtaXNzaW9uQm94SGlkZTogZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiWyIrbmV3UGhvbm9JRCsiXSBGbGFzaCBwZXJtaXNzaW9uIGJveCBjbG9zZWQiKTsKICAgICAgICAgICAgICAgICAgICBpZiggISB0aGlzLnBlcm1pc3Npb24oKSApewogICAgICAgCQkgICAgCXRoaXMuc2hvd1Blcm1pc3Npb25Cb3goKTsKICAgICAgIAkJICAgIH0KICAgICAgICAgICAgICAgIH0KCSAgICB9LAkgICAgICAKCSAgICBwaG9uZTogewogICAgICAgICAgICAgICAgcmluZ1RvbmU6ICJyaW5ndG9uZXMvRGlnZ3p0b25lX01hcmltYmEubXAzIiwKICAgICAgICAgICAgICAgIHJpbmdiYWNrVG9uZTogInJpbmd0b25lcy9yaW5nYmFjay11cy5tcDMiLAogICAgICAgICAgICAgICAgb25JbmNvbWluZ0NhbGw6IGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgICAgICAgICAgICAgLy8gd2FzIHB1c2ggdG8gdGFsayBlbmFibGVkIGZvciBjYWxscz8KCQkgICAgdmFyIHB0dEVuYWJsZWQ7CgkJICAgICgkKCIjIituZXdQaG9ub0lEKS5maW5kKCIucHVzaC10by10YWxrIikuaXMoIjpjaGVja2VkIikpID8gcHR0RW5hYmxlZCA9IHRydWUgOiBwdHRFbmFibGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgdmFyIG5ld0NhbGxJRCA9IGNyZWF0ZUNhbGxEaXYobmV3UGhvbm9JRCwiaW5jb21pbmciLHB0dEVuYWJsZWQpOwogICAgICAgICAgICAgICAgICAgIHZhciBuZXdDYWxsRGl2ID0gJCgiIyIrbmV3Q2FsbElEKTsKICAgICAgICAgICAgICAgICAgICBuZXdDYWxsRGl2LmZpbmQoIi5jYWxsSGVhZGVyIC5jYWxsRGV0YWlsIikuaHRtbCgiPHN0cm9uZz5JbmNvbWluZyBjYWxsIGZyb206IDwvc3Ryb25nPiIgKyBldmVudC5jYWxsLmluaXRpYXRvcik7CiAgICAgICAgICAgICAgICAgICAgbmV3Q2FsbERpdi5maW5kKCIuY2FsbEhlYWRlciAuY2FsbElEIikuaHRtbChuZXdDYWxsSUQpOwogICAgICAgICAgICAJICAgIGNhbGxzW25ld0NhbGxJRF0gPSBldmVudC5jYWxsOwogICAgICAgICAgICAJICAgIGNvbnNvbGUubG9nKCJbIituZXdQaG9ub0lEKyJdIE5ldyBpbmNvbWluZyBjYWxsIik7CiAgICAgICAgICAgICAgICAgICAgZXZlbnQuY2FsbC50b25lcyh0cnVlKTsgCiAgICAgICAgICAgIAkgICAgLy9CaW5kIGV2ZW50cyBmcm9tIHRoaXMgY2FsbAogICAgICAgICAgICAJICAgIGNhbGxzW25ld0NhbGxJRF0uYmluZCh7CiAgICAgICAgICAgICAJICAgICAgICBvbkhhbmd1cDogZnVuY3Rpb24oZXZlbnQpIHsKCSAgICAgICAgICAgICAgICAgICAgd2luZG93LmNsZWFySW50ZXJ2YWwoY2FsbHNbbmV3Q2FsbElEXS5lbmVyZ3lQb2xsKTsKICAgICAgICAgICAgIAkgICAgICAgICAgICBuZXdDYWxsRGl2LnNsaWRlVXAoKTsKICAgICAgICAgICAgIAkgICAgICAgICAgICBjYWxsc1tuZXdDYWxsSURdID0gbnVsbDsKICAgICAgICAgICAgIAkgICAgICAgICAgICBjb25zb2xlLmxvZygiWyIrbmV3UGhvbm9JRCsiXSBbIituZXdDYWxsSUQrIl0gQ2FsbCBodW5ndXAiKTsKICAgICAgICAgICAgIAkgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIG9uQW5zd2VyOiBmdW5jdGlvbihldmVudCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNlY3VyZSA9IGNhbGxzW25ld0NhbGxJRF0uc2VjdXJlKCk7CiAgICAgICAgICAgIAkgICAgICAgICAgICBjb25zb2xlLmxvZygiWyIrbmV3UGhvbm9JRCsiXSBbIituZXdDYWxsSUQrIl0gQ2FsbCBhbnN3ZXJlZCB1c2luZyAiICsgY2FsbHNbbmV3Q2FsbElEXS5jb2RlYy5uYW1lICsgIi8iICsgY2FsbHNbbmV3Q2FsbElEXS5jb2RlYy5yYXRlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld0NhbGxEaXYuZmluZCgiLmNhbGxDb2RlYyIpLmh0bWwoIjxzdHJvbmc+Q29kZWM6PC9zdHJvbmc+ICIgKyBjYWxsc1tuZXdDYWxsSURdLmNvZGVjLm5hbWUgKyAiLyIgKyBjYWxsc1tuZXdDYWxsSURdLmNvZGVjLnJhdGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3Q2FsbERpdi5maW5kKCIuY2FsbFNlY3VyZSIpLmh0bWwoc2VjdXJlID8gIihzZWN1cmUpIiA6ICIiKTsgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsc1tuZXdDYWxsSURdLmVuZXJneVBvbGwgPSB3aW5kb3cuc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKXsKCSAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjYWxsRGl2ID0gJCgiIyIrbmV3Q2FsbElEKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHIgPSAiPHN0cm9uZz5NaWM6PC9zdHJvbmc+ICI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWUgPSBjYWxsc1tuZXdDYWxsSURdLmVuZXJneSgpLm1pYzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGk9MDtpPDEwO2krKyl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0ciA9IHN0cisgKChpIDwgbWUpPyJYIjoiXyIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsRGl2LmZpbmQoIi5jYWxsTWljRW5lcmd5IikuaHRtbChzdHIpOwkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHIgPSAiPHN0cm9uZz5TcGs6PC9zdHJvbmc+ICI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2UgPSBjYWxsc1tuZXdDYWxsSURdLmVuZXJneSgpLnNwazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGk9MDtpPDEwO2krKyl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0ciA9IHN0cisgKChpIDwgc2UpPyJYIjoiXyIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdDYWxsRGl2LmZpbmQoIi5jYWxsU3BrRW5lcmd5IikuaHRtbChzdHIpOwkKCQkgICAgICAgICAgICB9LDUwMCk7CgkJCSAgICAKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgIAkgICAgICAgIG9uRXJyb3I6IGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgICAgICAJICAgCSAgICBjb25zb2xlLmxvZygiWyIrbmV3UGhvbm9JRCsiXSBbIituZXdDYWxsSUQrIl0gRXJyb3I6IFsiICsgZXZlbnQucmVhc29uICsgIl0iKTsKICAgICAgICAgICAgIAkgICAgICAgIH0KICAgICAgICAgICAgCSAgICB9KTsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBvbkVycm9yOiBmdW5jdGlvbihldmVudCkgewogICAgICAgICAgICAJICAgIGNvbnNvbGUubG9nKCJbIituZXdQaG9ub0lEKyJdIEVycm9yOiBbIiArIGV2ZW50LnJlYXNvbiArICJdIik7CiAgICAgICAgICAgICAgICB9CgkgICAgfSwKCSAgICAKCSAgICBtZXNzYWdpbmc6IHsKICAgICAgICAgICAgICAgIG9uTWVzc2FnZTogZnVuY3Rpb24oZXZlbnQsIG1lc3NhZ2UpIHsKICAgICAgICAgICAgCSAgICB2YXIgSklEID0gbWVzc2FnZS5mcm9tLnNwbGl0KCIvIik7CiAgICAgICAgICAgIAkgICAgY29uc29sZS5sb2coIlsiK25ld1Bob25vSUQrIl0gTWVzc2FnZSBmcm9tICIgKyBKSURbMF0gKyAiIFsiICsgbWVzc2FnZS5ib2R5ICsgIl0iKTsKICAgICAgICAgICAgCSAgICByb3V0ZU1lc3NhZ2UobmV3UGhvbm9JRCwiaW5jb21pbmciLEpJRFswXSxtZXNzYWdlLmJvZHkpOwogICAgICAgICAgICAgICAgfQoJICAgIH0KICAgICAgICB9KTsKICAgIH0KICAgIAogICAgLy9DcmVhdGVzIGEgbmV3IGNhbGwKICAgIGZ1bmN0aW9uIGNyZWF0ZU5ld0NhbGwocGhvbm9JRCwgdG8pewoJLy9jbG9uZSBhIGNhbGwgYm94Cgl2YXIgcGhvbm9EaXYgPSAkKCIjIitwaG9ub0lEKTsKCQoJLy8gd2FzIHB1c2ggdG8gdGFsayBlbmFibGVkIGZvciBjYWxscz8KCXZhciBwdHRFbmFibGVkOwoJKHBob25vRGl2LmZpbmQoIi5wdXNoLXRvLXRhbGsiKS5pcygiOmNoZWNrZWQiKSkgPyBwdHRFbmFibGVkID0gdHJ1ZSA6IHB0dEVuYWJsZWQgPSBmYWxzZTsKCQoJdmFyIG5ld0NhbGxJRCA9IGNyZWF0ZUNhbGxEaXYocGhvbm9JRCwib3V0Z29pbmciLHB0dEVuYWJsZWQpOwoJdmFyIGNhbGxEaXYgPSAkKCIjIituZXdDYWxsSUQpOwoJY2FsbERpdi5maW5kKCIuY2FsbElEIikudGV4dChuZXdDYWxsSUQpOwoJY2FsbERpdi5maW5kKCIuY2FsbERldGFpbCIpLmh0bWwoIjxzdHJvbmc+T3V0Z29pbmcgY2FsbCB0bzo8L3N0cm9uZz4gIiArIHRvKTsKCWNvbnNvbGUubG9nKCJbIitwaG9ub0Rpdi5hdHRyKCdpZCcpKyJdIFsiK25ld0NhbGxJRCsiXSBDYWxsaW5nICIrdG8pOwoJCgljYWxsc1tuZXdDYWxsSURdID0gcGhvbm9zW3Bob25vSURdLnBob25lLmRpYWwodG8sIHsKCSAgICB0b25lczogdHJ1ZSwKCSAgICBwdXNoVG9UYWxrOiBwdHRFbmFibGVkLAogICAgICAgICAgICBvbkFuc3dlcjogZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICAgICAgICAgIHZhciBzZWN1cmUgPSBjYWxsc1tuZXdDYWxsSURdLnNlY3VyZSgpOwogICAgICAgICAgICAJY29uc29sZS5sb2coIlsiK3Bob25vRGl2LmF0dHIoJ2lkJykrIl0gWyIrbmV3Q2FsbElEKyJdIENhbGwgYW5zd2VyZWQgdXNpbmcgIiArIGNhbGxzW25ld0NhbGxJRF0uY29kZWMubmFtZSArICIvIiArIGNhbGxzW25ld0NhbGxJRF0uY29kZWMucmF0ZSk7CiAgICAgICAgICAgICAgICBjYWxsRGl2LmZpbmQoIi5jYWxsQ29kZWMiKS5odG1sKCI8c3Ryb25nPkNvZGVjOjwvc3Ryb25nPiAiICsgY2FsbHNbbmV3Q2FsbElEXS5jb2RlYy5uYW1lICsgIi8iICsgY2FsbHNbbmV3Q2FsbElEXS5jb2RlYy5yYXRlKTsKICAgICAgICAgICAgICAgIGNhbGxEaXYuZmluZCgiLmNhbGxTZWN1cmUiKS5odG1sKHNlY3VyZSA/ICIoc2VjdXJlKSIgOiAiIik7IAogICAgICAgICAgICAgICAgY2FsbHNbbmV3Q2FsbElEXS5lbmVyZ3lQb2xsID0gd2luZG93LnNldEludGVydmFsKGZ1bmN0aW9uKCl7CgkgICAgICAgICAgICAgdmFyIGNhbGxEaXYgPSAkKCIjIituZXdDYWxsSUQpOwogICAgICAgICAgICAgICAgICAgICBzdHIgPSAiPHN0cm9uZz5NaWM6PC9zdHJvbmc+ICI7CiAgICAgICAgICAgICAgICAgICAgIG1lID0gY2FsbHNbbmV3Q2FsbElEXS5lbmVyZ3koKS5taWM7CiAgICAgICAgICAgICAgICAgICAgIGZvciAoaT0wO2k8MTA7aSsrKXsKICAgICAgICAgICAgICAgICAgICAgICBzdHIgPSBzdHIrICgoaSA8IG1lKT8iWCI6Il8iKTsKICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICBjYWxsRGl2LmZpbmQoIi5jYWxsTWljRW5lcmd5IikuaHRtbChzdHIpOwkKICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIHN0ciA9ICI8c3Ryb25nPlNwazo8L3N0cm9uZz4gIjsKICAgICAgICAgICAgICAgICAgICAgc2UgPSBjYWxsc1tuZXdDYWxsSURdLmVuZXJneSgpLnNwazsKICAgICAgICAgICAgICAgICAgICAgZm9yIChpPTA7aTwxMDtpKyspewogICAgICAgICAgICAgICAgICAgICAgIHN0ciA9IHN0cisgKChpIDwgc2UpPyJYIjoiXyIpOwogICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgIGNhbGxEaXYuZmluZCgiLmNhbGxTcGtFbmVyZ3kiKS5odG1sKHN0cik7CQoJCX0sNTAwKTsKCQkJCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG9uSGFuZ3VwOiBmdW5jdGlvbigpIHsKCQl3aW5kb3cuY2xlYXJJbnRlcnZhbChjYWxsc1tuZXdDYWxsSURdLmVuZXJneVBvbGwpOwogICAgICAgICAgICAJY2FsbHNbbmV3Q2FsbElEXSA9IG51bGw7CiAgICAgICAgICAgIAkkKCIjIituZXdDYWxsSUQpLnNsaWRlVXAoKTsKICAgICAgICAgICAgCWNvbnNvbGUubG9nKCJbIitwaG9ub0Rpdi5hdHRyKCdpZCcpKyJdIFsiK25ld0NhbGxJRCsiXSBDYWxsIGh1bmd1cCIpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9CiAgICAKICAgIC8vUm91dGVzIGEgbWVzc2FnZSB0byB0aGUgYXBwcm9wcmlhdGUgY2hhdCBvciBjcmVhdGVzIGEgbmV3IGNoYXQKICAgIGZ1bmN0aW9uIHJvdXRlTWVzc2FnZShwaG9ub0lELCB0eXBlLCBqaWQsIG1lc3NhZ2UpewoJdmFyIHRoZUNoYXQgPSAiIjsKCSQuZWFjaChjaGF0cywgZnVuY3Rpb24oa2V5LCB2YWx1ZSkgewoJICAgIGlmKCB2YWx1ZSA9PSBqaWQgKXsKCQl0aGVDaGF0ID0ga2V5OwoJCXZhciBuZXdNc2cgPSBjaGF0TWVzc2FnZShqaWQsbWVzc2FnZSwiaW5ib3VuZCIpOwoJCXZhciBjaGF0RGl2ID0gJCgiIyIrdGhlQ2hhdCk7CgkJcmVuZGVyTmV3TWVzc2FnZShjaGF0RGl2LCBuZXdNc2cpOwoJCWNoYXREaXYuZmluZCgiLmNoYXRUeHRJbnB1dCIpLmZvY3VzKCk7CgkJcmV0dXJuOwoJICAgIH0KICAgCX0pOwogICAJCiAJLy9EaWQgd2UgZmluZCBhIGNoYXQ/CglpZighIHRoZUNoYXQubGVuZ3RoKXsKCSAgICBjcmVhdGVOZXdDaGF0KHBob25vSUQsamlkLG1lc3NhZ2UpOwoJfQogICAgfQogICAgCiAgICAvL091dHB1dHMgYW4gSU0gbWVzc2FnZQogICAgZnVuY3Rpb24gcmVuZGVyTmV3TWVzc2FnZShjaGF0LCBtc2cpewoJY2hhdC5maW5kKCIuY2hhdEJveCIpLmFwcGVuZChtc2cpOwoJY2hhdC5maW5kKCIuY2hhdEJveCIpLmF0dHIoeyBzY3JvbGxUb3A6IGNoYXQuZmluZCgiLmNoYXRCb3giKS5hdHRyKCJzY3JvbGxIZWlnaHQiKSB9KTsKICAgIH0KICAgIAogICAgLy9DcmVhdGVzIGEgbmV3IGRpdiB0byBob2xkIGEgY2FsbC4gUmV0dXJucyB0aGUgaWQgb2YgdGhlIG5ldyBkaXYKICAgIGZ1bmN0aW9uIGNyZWF0ZUNhbGxEaXYocGhvbm9JRCxjYWxsVHlwZSxwdHRFbmFibGVkKXsKCS8vY2xvbmUgYSBjYWxsIGJveAoJdmFyIHBob25vRGl2ID0gJCgiIyIrcGhvbm9JRCk7Cgl2YXIgY2FsbEJveCA9IHBob25vRGl2LmZpbmQoIi5jYWxscyIpOwoJdmFyIG5ld0NhbGxDdHIgPSAoJCgiLmNhbGxIbGRyIikuc2l6ZSgpICsgMSkgLSAyOwoJbmV3Q2FsbElEID0gIkNhbGwiICsgbmV3Q2FsbEN0cjsKCXZhciBmaXJzdENhbGwgPSAkKCIuY2FsbEhsZHIiKS5maXJzdCgpCgl2YXIgbmV3Q2FsbERpdiA9IGZpcnN0Q2FsbC5jbG9uZSgpCgluZXdDYWxsRGl2LmF0dHIoImlkIixuZXdDYWxsSUQpLmFwcGVuZFRvKGNhbGxCb3gpLnNob3coKTsKCQoJaWYoIGNhbGxUeXBlID09ICJvdXRnb2luZyIpewoJICAgIG5ld0NhbGxEaXYuZmluZCgiLmNhbGxJbnB1dHMiKS5zaG93KCk7Cgl9ZWxzZXsKCSAgICBuZXdDYWxsRGl2LmZpbmQoIi5jYWxsQ29udHJvbHMiKS5zaG93KCk7Cgl9CgkKCXB0dEVuYWJsZWQgPyBuZXdDYWxsRGl2LmZpbmQoIi50YWxrU3RhcnQiKS5zaG93KCkgOiBuZXdDYWxsRGl2LmZpbmQoIi50YWxrU3RhcnQiKS5oaWRlKCk7CgkKCXJldHVybiBuZXdDYWxsSUQ7CiAgICB9CiAgICAKICAgIC8vQ3JlYXRlcyBhIG5ldyBjaGF0CiAgICBmdW5jdGlvbiBjcmVhdGVOZXdDaGF0KHBob25vSUQsIHRvLCBtZXNzYWdlKXsKCS8vY2xvbmUgYSBjaGF0IGJveAoJdmFyIHBob25vRGl2ID0gJCgiIyIrcGhvbm9JRCk7Cgl2YXIgbmV3Q2hhdElEID0gY3JlYXRlQ2hhdERpdihwaG9ub0lEKTsKCXZhciBjaGF0RGl2ID0gJCgiIyIrbmV3Q2hhdElEKTsKCWNoYXREaXYuZmluZCgiLmNoYXRJRCIpLnRleHQobmV3Q2hhdElEKTsKCWNoYXREaXYuZmluZCgiLmNoYXREZXRhaWwiKS5odG1sKHRvKTsKCQoJaWYoIG1lc3NhZ2UubGVuZ3RoICl7CgkgICAgdmFyIG5ld01zZyA9IGNoYXRNZXNzYWdlKHRvLG1lc3NhZ2UsImluYm91bmQiKTsKCSAgICByZW5kZXJOZXdNZXNzYWdlKGNoYXREaXYsIG5ld01zZyk7Cgl9CgkKCWNvbnNvbGUubG9nKCJbIitwaG9ub0Rpdi5hdHRyKCdpZCcpKyJdIFsiK25ld0NoYXRJRCsiXSBDaGF0IHN0YXJ0ZWQgd2l0aCAiICsgdG8pOwoJCgljaGF0c1tuZXdDaGF0SURdID0gdG87CiAgICB9CiAgICAKICAgIC8vQ3JlYXRlcyBhIG5ldyBkaXYgdG8gaG9sZCBhIGNoYXQuIFJldHVybnMgdGhlIGlkIG9mIHRoZSBuZXcgZGl2CiAgICBmdW5jdGlvbiBjcmVhdGVDaGF0RGl2KHBob25vSUQpewoJLy9jbG9uZSBhIGNoYXQgYm94Cgl2YXIgcGhvbm9EaXYgPSAkKCIjIitwaG9ub0lEKTsKCXZhciBjaGF0Qm94ID0gcGhvbm9EaXYuZmluZCgiLmNoYXRzIik7Cgl2YXIgbmV3Q2hhdEN0ciA9ICgkKCIuY2hhdEhsZHIiKS5zaXplKCkgKyAxKSAtIDI7CgluZXdDaGF0SUQgPSAiQ2hhdCIgKyBuZXdDaGF0Q3RyOwoJdmFyIGZpcnN0Q2hhdCA9ICQoIi5jaGF0SGxkciIpLmZpcnN0KCk7Cgl2YXIgbmV3Q2hhdERpdiA9IGZpcnN0Q2hhdC5jbG9uZSgpOwoJbmV3Q2hhdERpdi5hdHRyKCJpZCIsbmV3Q2hhdElEKS5hcHBlbmRUbyhjaGF0Qm94KS5zaG93KCk7CgluZXdDaGF0RGl2LmZpbmQoIi5jaGF0VHh0SW5wdXQiKS5mb2N1cygpOwoJCglyZXR1cm4gbmV3Q2hhdElEOwogICAgfQoKICAgIGZ1bmN0aW9uIGlzSU9TKCkgewogICAgICAgIHZhciB1c2VyQWdlbnQgPSB3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudDsKICAgICAgICBpZiAodXNlckFnZW50Lm1hdGNoKC9pUGFkL2kpIHx8IHVzZXJBZ2VudC5tYXRjaCgvaVBob25lL2kpKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGlzQW5kcm9pZCgpIHsKICAgICAgICB2YXIgdXNlckFnZW50ID0gd2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQ7CiAgICAgICAgaWYgKHVzZXJBZ2VudC5tYXRjaCgvQW5kcm9pZC9pKSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgCiAgICAvLyBDcmVhdGUgYW5kIHJldHVybiBhIGNoYXQgbWVzc2FnZSBidWJibGUKICAgIHZhciBjaGF0TWVzc2FnZSA9IGZ1bmN0aW9uKGZyb20sYm9keSx0eXBlKXsKCXZhciByZXN1bHQ7CgkKCWlmKCB0eXBlID09ICdpbmJvdW5kJyl7CgkgICAgdmFyIGJvcmRlclN0eWxlID0gImluYm91bmQiOwoJICAgIHZhciBmcm9tU3R5bGUgPSAiZnJvbUluYm91bmQiOwoJfWVsc2V7CgkgICAgdmFyIGJvcmRlclN0eWxlID0gIm91dGJvdW5kIjsKCSAgICB2YXIgZnJvbVN0eWxlID0gImZyb21PdXRib3VuZCI7Cgl9CgkKCXJlc3VsdCA9ICQoIjxkaXY+IikKCSAgICAuYWRkQ2xhc3MoImNoYXRFbnRyeSIpCgkgICAgLmFkZENsYXNzKGJvcmRlclN0eWxlKTsKCXZhciBmcm9tSGVhZGVyID0gJCgiPGRpdj4iKQoJICAgIC5hZGRDbGFzcygiZnJvbSIpCgkgICAgLmFkZENsYXNzKGZyb21TdHlsZSkKCSAgICAuaHRtbChmcm9tKQoJICAgIC5hcHBlbmRUbyhyZXN1bHQpOwoJdmFyIG1zZ0JvZHkgPSAkKCI8ZGl2PiIpCgkgICAgLmFkZENsYXNzKCJib2R5IikKCSAgICAuaHRtbChib2R5KQoJICAgIC5hcHBlbmRUbyhyZXN1bHQpOwoJCglyZXR1cm4gcmVzdWx0OwogICAgfQogICAgCiAgICAvL0RPTSBFdmVudCBIYW5kbGVycwogICAgJCgiLmFkZFBob25vIikuY2xpY2soZnVuY3Rpb24oKXsKCWNyZWF0ZU5ld1Bob25vKCk7CglyZXR1cm4gZmFsc2U7CiAgICB9KTsKICAgIAogICAgJCgnLmNsb3NlUGhvbm8nKS5saXZlKCdjbGljaycsIGZ1bmN0aW9uKCkgewoJdmFyIHRoaXNQaG9ubyA9ICQodGhpcykuY2xvc2VzdCgiLnBob25vIik7Cgl2YXIgdGhpc1Bob25vSUQgPSAkKHRoaXMpLmNsb3Nlc3QoIi5waG9ubyIpLmF0dHIoImlkIik7Cgl0aGlzUGhvbm8uc2xpZGVVcCgpOwoJcGhvbm9zW3RoaXNQaG9uby5hdHRyKCJpZCIpXSA9IG51bGw7CgkKCXRoaXNQaG9uby5maW5kKCIuY2FsbEhsZHIiKS5lYWNoKGZ1bmN0aW9uKCl7CgkgICAgY2FsbHNbJCh0aGlzKS5hdHRyKCJpZCIpXSA9IG51bGw7Cgl9KTsKCWNvbnNvbGUubG9nKCJbIit0aGlzUGhvbm9JRCsiXSBQaG9uZSByZW1vdmVkIik7CiAgICB9KTsKICAgIAogICAgJCgnLmNsb3NlQ2hhdCcpLmxpdmUoJ2NsaWNrJywgZnVuY3Rpb24oKSB7Cgl2YXIgdGhpc0NoYXQgPSAkKHRoaXMpLmNsb3Nlc3QoIi5jaGF0SGxkciIpOwoJdmFyIHRoaXNDaGF0SUQgPSAkKHRoaXMpLmNsb3Nlc3QoIi5jaGF0SGxkciIpLmF0dHIoImlkIik7Cgl0aGlzQ2hhdC5zbGlkZVVwKCk7CgljaGF0c1t0aGlzQ2hhdElEXSA9IG51bGw7CQoJY29uc29sZS5sb2coIlsiK3RoaXNDaGF0SUQrIl0gQ2hhdCBjbG9zZWQiKTsKICAgIH0pOwogICAgCiAgICAkKCcuY2FsbCcpLmxpdmUoJ2NsaWNrJywgZnVuY3Rpb24oKSB7Cgl2YXIgdGhpc1Bob25vID0gJCh0aGlzKS5jbG9zZXN0KCIucGhvbm8iKS5hdHRyKCJpZCIpOwoJdmFyIGNhbGxUbyA9ICQudHJpbSgkKCIjIit0aGlzUGhvbm8pLmZpbmQoIi5jYWxsVG8iKS52YWwoKSk7CgljcmVhdGVOZXdDYWxsKHRoaXNQaG9ubywgY2FsbFRvKTsKICAgIH0pOwogICAgCiAgICAkKCcuaGVhZHNldCcpLmxpdmUoJ2NoYW5nZScsIGZ1bmN0aW9uKCkgewoJdmFyIHBob25vSWQgPSAkKHRoaXMpLmNsb3Nlc3QoIi5waG9ubyIpLmF0dHIoImlkIik7Cgl2YXIgaGVhZHNldEVuYWJsZWQgPSAkKCIjIitwaG9ub0lkKS5maW5kKCIuaGVhZHNldCIpLmlzKCI6Y2hlY2tlZCIpOwoJY29uc29sZS5sb2coIlsiK3Bob25vSWQrIl0gSGVhZHNldDogIiArIGhlYWRzZXRFbmFibGVkKTsKICAgIAlwaG9ub3NbcGhvbm9JZF0ucGhvbmUuaGVhZHNldChoZWFkc2V0RW5hYmxlZCk7CQkKICAgIH0pOwoKICAgICQoJy53aWRlYmFuZCcpLmxpdmUoJ2NoYW5nZScsIGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBwaG9ub0lkID0gJCh0aGlzKS5jbG9zZXN0KCIucGhvbm8iKS5hdHRyKCJpZCIpOwoJdmFyIHdpZGViYW5kRGlzYWJsZWQgPSAkKCIjIitwaG9ub0lkKS5maW5kKCIud2lkZWJhbmQiKS5pcygiOmNoZWNrZWQiKTsKCWNvbnNvbGUubG9nKCJbIitwaG9ub0lkKyJdIFdpZGViYW5kRGlzYWJsZWQ6ICIgKyB3aWRlYmFuZERpc2FibGVkKTsKICAgIAlwaG9ub3NbcGhvbm9JZF0ucGhvbmUud2lkZWJhbmQoIXdpZGViYW5kRGlzYWJsZWQpOwogICAgfSk7CiAgICAKICAgICQoJy5yaW5nLXRvbmUsIC5yaW5nYmFjay10b25lJykubGl2ZSgkLmJyb3dzZXIubXNpZSA/ICdjbGljayc6ICdjaGFuZ2UnLCBmdW5jdGlvbigpIHsKCXZhciBwaG9ub0lkID0gJCh0aGlzKS5jbG9zZXN0KCIucGhvbm8iKS5hdHRyKCJpZCIpOwoJdmFyIHRvbmUgPSAkKHRoaXMpLnZhbCgpOwoJCglpZigkKHRoaXMpLmhhc0NsYXNzKCJyaW5nLXRvbmUiKSl7CgkgICAgcGhvbm9zW3Bob25vSWRdLnBob25lLnJpbmdUb25lKHRvbmUpOwoJICAgIGNvbnNvbGUubG9nKCJbIitwaG9ub0lkKyJdIFJpbmcgdG9uZSBzZXQ6ICIgKyB0b25lKTsKCX1lbHNlewoJICAgIHBob25vc1twaG9ub0lkXS5waG9uZS5yaW5nYmFja1RvbmUodG9uZSk7CgkgICAgY29uc29sZS5sb2coIlsiK3Bob25vSWQrIl0gUmluZ2JhY2sgdG9uZSBzZXQ6ICIgKyB0b25lKTsKCX0JCiAgICB9KTsKICAgICQoJy5hdWRpby1pbnB1dCcpLmxpdmUoJC5icm93c2VyLm1zaWUgPyAnY2xpY2snOiAnY2hhbmdlJywgZnVuY3Rpb24oKSB7Cgl2YXIgcGhvbm9JZCA9ICQodGhpcykuY2xvc2VzdCgiLnBob25vIikuYXR0cigiaWQiKTsKICAgICAgICB2YXIgZGV2aWNlID0gJCh0aGlzKS52YWwoKTsKICAgICAgICBjb25zb2xlLmxvZygiWyIrcGhvbm9JZCsiXSBBdWRpbyBJbnB1dCBzZXQ6ICIgKyBkZXZpY2UpOwoJcGhvbm9zW3Bob25vSWRdLnBob25lLmF1ZGlvSW5wdXQoZGV2aWNlKTsKICAgIH0pOyAKICAgICQoJy5zZWN1cml0eS1vcHRpb24nKS5saXZlKCQuYnJvd3Nlci5tc2llID8gJ2NsaWNrJzogJ2NoYW5nZScsIGZ1bmN0aW9uKCkgewoJdmFyIHBob25vSWQgPSAkKHRoaXMpLmNsb3Nlc3QoIi5waG9ubyIpLmF0dHIoImlkIik7CiAgICAgICAgdmFyIHNlY3VyaXR5ID0gJCh0aGlzKS52YWwoKTsKICAgICAgICBjb25zb2xlLmxvZygiWyIrcGhvbm9JZCsiXSBTZWN1cml0eSBzZXQ6ICIgKyBzZWN1cml0eSk7CglwaG9ub3NbcGhvbm9JZF0ucGhvbmUuc2VjdXJpdHkoc2VjdXJpdHkpOwogICAgfSk7IAogICAgJCgnLmZsYXNoSGVscCBhJykubGl2ZSgnY2xpY2snLCBmdW5jdGlvbigpIHsKCXZhciB0aGlzUGhvbm8gPSAkKHRoaXMpLmNsb3Nlc3QoIi5waG9ubyIpOwoJJCgiLmZsYXNoLWhsZHIiKS5jc3MoImxlZnQiLCIyNTAuNXB4Iik7Cgl0aGlzUGhvbm8uZmluZCgiLmZsYXNoSGVscCIpLnRleHQoIlRyeSBhZ2FpbiIpOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0pOwogICAgCiAgICAkKCcuY2hhdCcpLmxpdmUoJ2NsaWNrJywgZnVuY3Rpb24oKSB7Cgl2YXIgdGhpc1Bob25vID0gJCh0aGlzKS5jbG9zZXN0KCIucGhvbm8iKS5hdHRyKCJpZCIpOwoJdmFyIGNoYXRUbyA9ICQudHJpbSgkKCIjIit0aGlzUGhvbm8pLmZpbmQoIi5jaGF0VG8iKS52YWwoKSk7CgljcmVhdGVOZXdDaGF0KHRoaXNQaG9ubywgY2hhdFRvLCAiIik7CiAgICB9KTsKICAgIAogICAgJCgnLnNlbmRNc2cnKS5saXZlKCdjbGljaycsIGZ1bmN0aW9uKCkgewoJdmFyIHRoaXNQaG9ubyA9ICQodGhpcykuY2xvc2VzdCgiLnBob25vIik7Cgl2YXIgdGhpc0NoYXQgPSAkKHRoaXMpLmNsb3Nlc3QoIi5jaGF0SGxkciIpOwoJdmFyIG1zZ1RleHQgPSB0aGlzQ2hhdC5maW5kKCIuY2hhdFR4dElucHV0IikudmFsKCk7Cgl2YXIgbmV3TXNnID0gY2hhdE1lc3NhZ2UoIllvdSIsbXNnVGV4dCwib3V0Z29pbmciKTsKCXJlbmRlck5ld01lc3NhZ2UodGhpc0NoYXQsbmV3TXNnKTsKCXBob25vc1t0aGlzUGhvbm8uYXR0cigiaWQiKV0ubWVzc2FnaW5nLnNlbmQoY2hhdHNbdGhpc0NoYXQuYXR0cigiaWQiKV0sbXNnVGV4dCk7Cgl0aGlzQ2hhdC5maW5kKCIuY2hhdFR4dElucHV0IikudmFsKCIiKTsKCWNvbnNvbGUubG9nKCJbIit0aGlzUGhvbm8uYXR0cignaWQnKSsiXSBTZW5kaW5nIG1lc3NhZ2UgdG86ICIgKyBjaGF0c1t0aGlzQ2hhdC5hdHRyKCdpZCcpXSArICIgWyIgKyBtc2dUZXh0ICsgIl0iKTsKICAgIH0pOwogICAgCiAgICAkKCcuaGFuZ3VwJykubGl2ZSgnY2xpY2snLCBmdW5jdGlvbigpIHsKCXZhciB0aGlzQ2FsbCA9ICQodGhpcykuY2xvc2VzdCgiLmNhbGxIbGRyIikuYXR0cigiaWQiKTsKCWNhbGxzW3RoaXNDYWxsXS5oYW5ndXAoKTsKCQoJJCgiIyIrdGhpc0NhbGwpLnNsaWRlVXAoImZhc3QiLCBmdW5jdGlvbigpewoJICAgICQodGhpcykucmVtb3ZlKCk7CQoJfSk7CiAgICB9KTsKICAgIAogICAgJCgnLmFuc3dlcicpLmxpdmUoJ2NsaWNrJywgZnVuY3Rpb24oKSB7Cgl2YXIgY2FsbERpdiA9ICQodGhpcykuY2xvc2VzdCgiLmNhbGxIbGRyIik7CgljYWxsc1tjYWxsRGl2LmF0dHIoImlkIildLmFuc3dlcigpOwoJY2FsbERpdi5maW5kKCIuY2FsbENvbnRyb2xzIikuaGlkZSgpOwoJY2FsbERpdi5maW5kKCIuY2FsbElucHV0cyIpLnNob3coKTsKCWNvbnNvbGUubG9nKCJDYWxsIGFuc3dlcmVkIik7CiAgICB9KTsKICAgIAogICAgJCgnLm11dGUnKS5saXZlKCdjbGljaycsIGZ1bmN0aW9uKCkgewoJdmFyIHRoaXNDYWxsID0gJCh0aGlzKS5jbG9zZXN0KCIuY2FsbEhsZHIiKS5hdHRyKCJpZCIpOwoJY2FsbHNbdGhpc0NhbGxdLm11dGUodHJ1ZSk7CiAgICB9KTsKICAgIAogICAgJCgnLnVuTXV0ZScpLmxpdmUoJ2NsaWNrJywgZnVuY3Rpb24oKSB7Cgl2YXIgdGhpc0NhbGwgPSAkKHRoaXMpLmNsb3Nlc3QoIi5jYWxsSGxkciIpLmF0dHIoImlkIik7CgljYWxsc1t0aGlzQ2FsbF0ubXV0ZShmYWxzZSk7CiAgICB9KTsKICAgIAogICAgJCgnLmRpZ2l0JykubGl2ZSgnY2xpY2snLCBmdW5jdGlvbigpIHsKCXZhciB0aGlzQ2FsbCA9ICQodGhpcykuY2xvc2VzdCgiLmNhbGxIbGRyIikuYXR0cigiaWQiKTsKCXZhciB0aGVEaWdpdCA9ICQodGhpcykuYXR0cigidmFsdWUiKTsKCWNhbGxzW3RoaXNDYWxsXS5kaWdpdCh0aGVEaWdpdCk7CiAgICB9KTsKICAgIAogICAgJCgnLnRhbGtTdGFydCcpLmxpdmUoJ21vdXNlZG93bicsIGZ1bmN0aW9uKCkgewoJdmFyIHRoaXNDYWxsID0gJCh0aGlzKS5jbG9zZXN0KCIuY2FsbEhsZHIiKS5hdHRyKCJpZCIpOwoJY2FsbHNbdGhpc0NhbGxdLnRhbGtpbmcodHJ1ZSk7CiAgICB9KTsKICAgIAogICAgJCgnLnRhbGtTdGFydCcpLmxpdmUoJ21vdXNldXAnLCBmdW5jdGlvbigpIHsKCXZhciB0aGlzQ2FsbCA9ICQodGhpcykuY2xvc2VzdCgiLmNhbGxIbGRyIikuYXR0cigiaWQiKTsKCWNhbGxzW3RoaXNDYWxsXS50YWxraW5nKGZhbHNlKTsKICAgIH0pOwogICAgCiAgICAkKCcuc2hvd0NhbGwnKS5saXZlKCdjbGljaycsIGZ1bmN0aW9uKCkgewoJdmFyIHRoaXNQaG9ubyA9ICQodGhpcykuY2xvc2VzdCgiLnBob25vIik7Cgl0aGlzUGhvbm8uZmluZCgiLnBob25lSW5wdXQiKS5zaG93KCk7Cgl0aGlzUGhvbm8uZmluZCgiLmNoYXRJbnB1dCIpLmhpZGUoKTsKICAgIH0pOwogICAgCiAgICAkKCcudGV4dCcpLmxpdmUoJ2NsaWNrJywgZnVuY3Rpb24oKSB7Cgl2YXIgdGhpc1Bob25vID0gJCh0aGlzKS5jbG9zZXN0KCIucGhvbm8iKTsKCXZhciB0byA9IHRoaXNQaG9uby5maW5kKCIuamlkIikudmFsKCk7Cgl2YXIgbXNnID0gdGhpc1Bob25vLmZpbmQoIi5tc2dCb2R5IikudmFsKCk7CglzZW5kTWVzc2FnZSh0aGlzUGhvbm8uYXR0cigiaWQiKSx0byxtc2cpOwoJdGhpc1Bob25vLmZpbmQoIi5tc2dCb2R5IikudmFsKCIiKTsKICAgIH0pOwogICAgCiAgICAkKCIubG9nVG9nZ2xlciIpLmNsaWNrKGZ1bmN0aW9uKCl7CglpZiggJCgiI2xvZ0NvbnNvbGUiKS5jc3MoImhlaWdodCIpID09ICIyNXB4IiApewoJICAgICQoIiNsb2dDb25zb2xlIikuY3NzKCJoZWlnaHQiLCIyNDVweCIpOwoJICAgICQoImJvZHkiKS5jc3MoIm1hcmdpbi1ib3R0b20iLCIyODVweCIpOwoJICAgICQodGhpcykudGV4dCgiSGlkZSBMb2cgVmlld2VyIik7Cgl9ZWxzZXsKCSAgICAkKCIjbG9nQ29uc29sZSIpLmNzcygiaGVpZ2h0IiwiMjVweCIpOwoJICAgICQoImJvZHkiKS5jc3MoIm1hcmdpbi1ib3R0b20iLCIyNXB4Iik7CgkgICAgJCh0aGlzKS50ZXh0KCJTaG93IExvZyBWaWV3ZXIiKTsKCX0KCQoJcmV0dXJuIGZhbHNlOwogICAgfSk7CgogICAgaWYod2luZG93LmxvY2F0aW9uLnByb3RvY29sICE9ICJodHRwczoiICYmIHdpbmRvdy5sb2NhdGlvbi5wcm90b2NvbCAhPSAiaHR0cDoiICYmICFpc0lPUygpICYmICFpc0FuZHJvaWQoKSl7Cgl2YXIgZXJyb3JUZXh0ID0gIkxvb2tzIGxpa2UgeW91IGFyZSBydW5uaW5nIHRoaXMgc2FtcGxlIGxvY2FsbHkgYW5kIG5vdCBvbiBhIHdlYiBzZXJ2ZXIuIFRvIHJ1biB0aGlzIGV4YW1wbGUsIGVpdGhlciBsb2FkIGl0IGZyb20gYSB3ZWIgc2VydmVyIG9yIDxhIGhyZWY9J2h0dHA6Ly93d3cubWFjcm9tZWRpYS5jb20vc3VwcG9ydC9kb2N1bWVudGF0aW9uL2VuL2ZsYXNocGxheWVyL2hlbHAvc2V0dGluZ3NfbWFuYWdlcjA0Lmh0bWwnIHRhcmdldD0nX2JsYW5rJz5lZGl0IHlvdXIgRmxhc2ggc2VjdXJpdHkgc2V0dGluZ3M8L2E+LiI7CgllcnJvclRleHQgKz0gIjxici8+U2VsZWN0IFwiRWRpdCBsb2NhdGlvbnNcIiA+IFwiQWRkIGxvY2F0aW9uXCIgPiBcIkJyb3dzZSBmb3IgZm9sZGVyXCIgYW5kIHNlbGVjdCB0aGUgXCIvanNcIiBmb2xkZXIgaW4gdGhlIHJvb3Qgb2YgeW91ciBkb3dubG9hZC4iOwoJZXJyb3JUZXh0ICs9ICIgPGEgaHJlZj0nIycgb25jbGljaz0nJCh0aGlzKS5wYXJlbnQoKS5zbGlkZVVwKCk7Jz5DbG9zZSB0aGlzPC9hPiI7Cgl2YXIgZXJyb3JCb3ggPSAkKCI8ZGl2PiIpCgkgICAgLmFkZENsYXNzKCJlcnJvciIpCgkgICAgLmh0bWwoZXJyb3JUZXh0KQoJICAgIC5wcmVwZW5kVG8oImJvZHkiKTsKICAgIH0KCiAgICBjcmVhdGVOZXdQaG9ubygpOwp9KTsKCg==",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Fri, 07 Nov 2014 21:58:22 GMT",
                    "Content-Length": "21964",
                    "Date": "Fri, 07 Nov 2014 21:58:26 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}