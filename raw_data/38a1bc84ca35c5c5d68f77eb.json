{
    "url": "http://localhost:9999/google/closure-library/closure/goog/testing/testrunner.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Link manipulation (DOM-based)",
    "issueType": 5246976,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based link manipulation vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this to a navigation target within the current page, such as a clickable link or the submission URL of a form. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will modify the target of links within the response. An attacker may be able to leverage this to perform various attacks, including:<ul><li>Causing the user to redirect to an arbitrary external URL, to facilitate a phishing attack.</li><li>Causing the user to submit sensitive form data to a server controlled by the attacker.</li><li>Causing the user to perform an unintended action within the application, by changing the file or query string associated with a link.</li><li>Bypassing browser anti-XSS defenses by injecting on-site links containing XSS exploits, since browser anti-XSS defenses typically do not operate on on-site links.</li></ul>",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based link manipulation vulnerabilities is not to dynamically set the target URLs of links or forms using data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing an arbitrary URL as a link target. In general, this is best achieved by using a whitelist of URLs that are permitted link targets, and strictly validating the target against this list before setting the link target.",
    "issueDetail": "The application may be vulnerable to DOM-based link manipulation. Data is read from <b>window.location.search</b> and written to <b>the 'href' property of a DOM element</b> via the following statements:<ul><li>var search = window.location.search;</li><li>newSearch = search + '&amp;' + newSearch;</li><li>newSearch = '?' + newSearch;</li><li>newSearch= search.substr(0 , oldTests.index) + newSearch+ search.substr(oldTests.index+ oldTests[0 ] .length);</li><li>href = href.split('#')[0].split('?')[0] + newSearch + hash;</li><li>a.href = href;</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/google/closure-library/closure/goog/testing/testrunner.js",
                "path": "/google/closure-library/closure/goog/testing/testrunner.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9nb29nbGUvY2xvc3VyZS1saWJyYXJ5L2Nsb3N1cmUvZ29vZy90ZXN0aW5nL3Rlc3RydW5uZXIuanMgSFRUUC8xLjENCkhvc3Q6IGxvY2FsaG9zdDo5OTk5DQoNCg==",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMTIzMDQNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IFRodSwgMDYgTm92IDIwMTQgMTU6Mzc6NDIgR01UDQpMYXN0LU1vZGlmaWVkOiBUaHUsIDA2IE5vdiAyMDE0IDE1OjM3OjIxIEdNVA0KDQovLyBDb3B5cmlnaHQgMjAwNyBUaGUgQ2xvc3VyZSBMaWJyYXJ5IEF1dGhvcnMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuCi8vCi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwovLyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCi8vIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAovLwovLyAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAovLwovLyBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCi8vIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUy1JUyIgQkFTSVMsCi8vIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgovLyBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCi8vIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoKLyoqCiAqIEBmaWxlb3ZlcnZpZXcgVGhlIHRlc3QgcnVubmVyIGlzIGEgc2luZ2xldG9uIG9iamVjdCB0aGF0IGlzIHVzZWQgdG8gZXhlY3V0ZQogKiBhIGdvb2cudGVzdGluZy5UZXN0Q2FzZXMsIGRpc3BsYXkgdGhlIHJlc3VsdHMsIGFuZCBleHBvc2UgdGhlIHJlc3VsdHMgdG8KICogU2VsZW5pdW0gZm9yIGF1dG9tYXRpb24uICBJZiBhIFRlc3RDYXNlIGhhc24ndCBiZWVuIHJlZ2lzdGVyZWQgd2l0aCB0aGUKICogcnVubmVyIGJ5IHRoZSB0aW1lIHdpbmRvdy5vbmxvYWQgb2NjdXJzLCB0aGUgdGVzdFJ1bm5lciB3aWxsIHRyeSB0byBhdXRvLQogKiBkaXNjb3ZlciBKc1VuaXQgc3R5bGUgdGVzdCBwYWdlcy4KICoKICogVGhlIGhvb2tzIGZvciBzZWxlbml1bSBhcmUgKHNlZSBodHRwOi8vZ28vc2VsZW5pdW0taG9vay1zZXR1cCk6LQogKiAgLSBCb29sZWFuIEdfdGVzdFJ1bm5lci5pc0ZpbmlzaGVkKCkKICogIC0gQm9vbGVhbiBHX3Rlc3RSdW5uZXIuaXNTdWNjZXNzKCkKICogIC0gU3RyaW5nIEdfdGVzdFJ1bm5lci5nZXRSZXBvcnQoKQogKiAgLSBudW1iZXIgR190ZXN0UnVubmVyLmdldFJ1blRpbWUoKQogKiAgLSBPYmplY3Q8c3RyaW5nLCBBcnJheTxzdHJpbmc+PiBHX3Rlc3RSdW5uZXIuZ2V0VGVzdFJlc3VsdHMoKQogKgogKiBUZXN0aW5nIGNvZGUgc2hvdWxkIG5vdCBoYXZlIGRlcGVuZGVuY2llcyBvdXRzaWRlIG9mIGdvb2cudGVzdGluZyBzbyBhcyB0bwogKiByZWR1Y2UgdGhlIGNoYW5jZSBvZiBtYXNraW5nIG1pc3NpbmcgZGVwZW5kZW5jaWVzLgogKgogKi8KCmdvb2cucHJvdmlkZSgnZ29vZy50ZXN0aW5nLlRlc3RSdW5uZXInKTsKCmdvb2cucmVxdWlyZSgnZ29vZy50ZXN0aW5nLlRlc3RDYXNlJyk7CgoKCi8qKgogKiBDb25zdHJ1Y3QgYSB0ZXN0IHJ1bm5lci4KICoKICogTk9URSh1c2VyKTogVGhpcyBpcyBjdXJyZW50bHkgcHJldHR5IHdlaXJkLCBJJ20gZXNzZW50aWFsbHkgdHJ5aW5nIHRvCiAqIGNyZWF0ZSBhIHdyYXBwZXIgdGhhdCB0aGUgU2VsZW5pdW0gdGVzdCBjYW4gaG9vayBpbnRvIHRvIHF1ZXJ5IHRoZSBzdGF0ZSBvZgogKiB0aGUgcnVubmluZyB0ZXN0IGNhc2UsIHdoaWxlIG1ha2luZyBnb29nLnRlc3RpbmcuVGVzdENhc2UgZ2VuZXJhbC4KICoKICogQGNvbnN0cnVjdG9yCiAqLwpnb29nLnRlc3RpbmcuVGVzdFJ1bm5lciA9IGZ1bmN0aW9uKCkgewogIC8qKgogICAqIEVycm9ycyB0aGF0IG9jY3VycmVkIGluIHRoZSB3aW5kb3cuCiAgICogQHR5cGUge0FycmF5PHN0cmluZz59CiAgICovCiAgdGhpcy5lcnJvcnMgPSBbXTsKfTsKCgovKioKICogUmVmZXJlbmNlIHRvIHRoZSBhY3RpdmUgdGVzdCBjYXNlLgogKiBAdHlwZSB7Z29vZy50ZXN0aW5nLlRlc3RDYXNlP30KICovCmdvb2cudGVzdGluZy5UZXN0UnVubmVyLnByb3RvdHlwZS50ZXN0Q2FzZSA9IG51bGw7CgoKLyoqCiAqIFdoZXRoZXIgdGhlIHRlc3QgcnVubmVyIGhhcyBiZWVuIGluaXRpYWxpemVkIHlldC4KICogQHR5cGUge2Jvb2xlYW59CiAqLwpnb29nLnRlc3RpbmcuVGVzdFJ1bm5lci5wcm90b3R5cGUuaW5pdGlhbGl6ZWQgPSBmYWxzZTsKCgovKioKICogRWxlbWVudCBjcmVhdGVkIGluIHRoZSBkb2N1bWVudCB0byBhZGQgdGVzdCByZXN1bHRzIHRvLgogKiBAdHlwZSB7RWxlbWVudH0KICogQHByaXZhdGUKICovCmdvb2cudGVzdGluZy5UZXN0UnVubmVyLnByb3RvdHlwZS5sb2dFbF8gPSBudWxsOwoKCi8qKgogKiBGdW5jdGlvbiB0byB1c2Ugd2hlbiBmaWx0ZXJpbmcgZXJyb3JzLgogKiBAdHlwZSB7KGZ1bmN0aW9uKHN0cmluZykpP30KICogQHByaXZhdGUKICovCmdvb2cudGVzdGluZy5UZXN0UnVubmVyLnByb3RvdHlwZS5lcnJvckZpbHRlcl8gPSBudWxsOwoKCi8qKgogKiBXaGV0aGVyIGFuIGVtcHR5IHRlc3QgY2FzZSBjb3VudHMgYXMgYW4gZXJyb3IuCiAqIEB0eXBlIHtib29sZWFufQogKiBAcHJpdmF0ZQogKi8KZ29vZy50ZXN0aW5nLlRlc3RSdW5uZXIucHJvdG90eXBlLnN0cmljdF8gPSB0cnVlOwoKCi8qKgogKiBJbml0aWFsaXplcyB0aGUgdGVzdCBydW5uZXIuCiAqIEBwYXJhbSB7Z29vZy50ZXN0aW5nLlRlc3RDYXNlfSB0ZXN0Q2FzZSBUaGUgdGVzdCBjYXNlIHRvIGluaXRpYWxpemUgd2l0aC4KICovCmdvb2cudGVzdGluZy5UZXN0UnVubmVyLnByb3RvdHlwZS5pbml0aWFsaXplID0gZnVuY3Rpb24odGVzdENhc2UpIHsKICBpZiAodGhpcy50ZXN0Q2FzZSAmJiB0aGlzLnRlc3RDYXNlLnJ1bm5pbmcpIHsKICAgIHRocm93IEVycm9yKCdUaGUgdGVzdCBydW5uZXIgaXMgYWxyZWFkeSB3YWl0aW5nIGZvciBhIHRlc3QgdG8gY29tcGxldGUnKTsKICB9CiAgdGhpcy50ZXN0Q2FzZSA9IHRlc3RDYXNlOwogIHRoaXMuaW5pdGlhbGl6ZWQgPSB0cnVlOwp9OwoKCi8qKgogKiBCeSBkZWZhdWx0LCB0aGUgdGVzdCBydW5uZXIgaXMgc3RyaWN0LCBhbmQgZmFpbHMgaWYgaXQgcnVucyBhbiBlbXB0eQogKiB0ZXN0IGNhc2UuCiAqIEBwYXJhbSB7Ym9vbGVhbn0gc3RyaWN0IFdoZXRoZXIgdGhlIHRlc3QgcnVubmVyIHNob3VsZCBmYWlsIG9uIGFuIGVtcHR5CiAqICAgICB0ZXN0IGNhc2UuCiAqLwpnb29nLnRlc3RpbmcuVGVzdFJ1bm5lci5wcm90b3R5cGUuc2V0U3RyaWN0ID0gZnVuY3Rpb24oc3RyaWN0KSB7CiAgdGhpcy5zdHJpY3RfID0gc3RyaWN0Owp9OwoKCi8qKgogKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSB0ZXN0IHJ1bm5lciBzaG91bGQgZmFpbCBvbiBhbiBlbXB0eQogKiAgICAgdGVzdCBjYXNlLgogKi8KZ29vZy50ZXN0aW5nLlRlc3RSdW5uZXIucHJvdG90eXBlLmlzU3RyaWN0ID0gZnVuY3Rpb24oKSB7CiAgcmV0dXJuIHRoaXMuc3RyaWN0XzsKfTsKCgovKioKICogUmV0dXJucyB0cnVlIGlmIHRoZSB0ZXN0IHJ1bm5lciBpcyBpbml0aWFsaXplZC4KICogVXNlZCBieSBTZWxlbml1bSBIb29rcy4KICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgdGVzdCBydW5uZXIgaXMgYWN0aXZlLgogKi8KZ29vZy50ZXN0aW5nLlRlc3RSdW5uZXIucHJvdG90eXBlLmlzSW5pdGlhbGl6ZWQgPSBmdW5jdGlvbigpIHsKICByZXR1cm4gdGhpcy5pbml0aWFsaXplZDsKfTsKCgovKioKICogUmV0dXJucyB0cnVlIGlmIHRoZSB0ZXN0IHJ1bm5lciBpcyBmaW5pc2hlZC4KICogVXNlZCBieSBTZWxlbml1bSBIb29rcy4KICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgdGVzdCBydW5uZXIgaXMgYWN0aXZlLgogKi8KZ29vZy50ZXN0aW5nLlRlc3RSdW5uZXIucHJvdG90eXBlLmlzRmluaXNoZWQgPSBmdW5jdGlvbigpIHsKICByZXR1cm4gdGhpcy5lcnJvcnMubGVuZ3RoID4gMCB8fAogICAgICB0aGlzLmluaXRpYWxpemVkICYmICEhdGhpcy50ZXN0Q2FzZSAmJiB0aGlzLnRlc3RDYXNlLnN0YXJ0ZWQgJiYKICAgICAgIXRoaXMudGVzdENhc2UucnVubmluZzsKfTsKCgovKioKICogUmV0dXJucyB0cnVlIGlmIHRoZSB0ZXN0IGNhc2UgZGlkbid0IGZhaWwuCiAqIFVzZWQgYnkgU2VsZW5pdW0gSG9va3MuCiAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhlIGN1cnJlbnQgdGVzdCByZXR1cm5lZCBzdWNjZXNzZnVsbHkuCiAqLwpnb29nLnRlc3RpbmcuVGVzdFJ1bm5lci5wcm90b3R5cGUuaXNTdWNjZXNzID0gZnVuY3Rpb24oKSB7CiAgcmV0dXJuICF0aGlzLmhhc0Vycm9ycygpICYmICEhdGhpcy50ZXN0Q2FzZSAmJiB0aGlzLnRlc3RDYXNlLmlzU3VjY2VzcygpOwp9OwoKCi8qKgogKiBSZXR1cm5zIHRydWUgaWYgdGhlIHRlc3QgY2FzZSBydW5uZXIgaGFzIGVycm9ycyB0aGF0IHdlcmUgY2F1Z2h0IG91dHNpZGUgb2YKICogdGhlIHRlc3QgY2FzZS4KICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGVyZSB3ZXJlIEpTIGVycm9ycy4KICovCmdvb2cudGVzdGluZy5UZXN0UnVubmVyLnByb3RvdHlwZS5oYXNFcnJvcnMgPSBmdW5jdGlvbigpIHsKICByZXR1cm4gdGhpcy5lcnJvcnMubGVuZ3RoID4gMDsKfTsKCgovKioKICogTG9ncyBhbiBlcnJvciB0aGF0IG9jY3VycmVkLiAgVXNlZCBpbiB0aGUgY2FzZSBvZiBlbnZpcm9ubWVudCBzZXR0aW5nIHVwCiAqIGFuIG9uZXJyb3IgaGFuZGxlci4KICogQHBhcmFtIHtzdHJpbmd9IG1zZyBFcnJvciBtZXNzYWdlLgogKi8KZ29vZy50ZXN0aW5nLlRlc3RSdW5uZXIucHJvdG90eXBlLmxvZ0Vycm9yID0gZnVuY3Rpb24obXNnKSB7CiAgaWYgKCF0aGlzLmVycm9yRmlsdGVyXyB8fCB0aGlzLmVycm9yRmlsdGVyXy5jYWxsKG51bGwsIG1zZykpIHsKICAgIHRoaXMuZXJyb3JzLnB1c2gobXNnKTsKICB9Cn07CgoKLyoqCiAqIExvZyBmYWlsdXJlIGluIGN1cnJlbnQgcnVubmluZyB0ZXN0LgogKiBAcGFyYW0ge0Vycm9yfSBleCBFeGNlcHRpb24uCiAqLwpnb29nLnRlc3RpbmcuVGVzdFJ1bm5lci5wcm90b3R5cGUubG9nVGVzdEZhaWx1cmUgPSBmdW5jdGlvbihleCkgewogIHZhciB0ZXN0TmFtZSA9IC8qKiBAdHlwZSB7c3RyaW5nfSAqLyAoZ29vZy50ZXN0aW5nLlRlc3RDYXNlLmN1cnJlbnRUZXN0TmFtZSk7CiAgaWYgKHRoaXMudGVzdENhc2UpIHsKICAgIHRoaXMudGVzdENhc2UubG9nRXJyb3IodGVzdE5hbWUsIGV4KTsKICB9IGVsc2UgewogICAgLy8gTk9URTogRG8gbm90IGZvcmdldCB0byBsb2cgdGhlIG9yaWdpbmFsIGV4Y2VwdGlvbiByYWlzZWQuCiAgICB0aHJvdyBuZXcgRXJyb3IoJ1Rlc3QgcnVubmVyIG5vdCBpbml0aWFsaXplZCB3aXRoIGEgdGVzdCBjYXNlLiBPcmlnaW5hbCAnICsKICAgICAgICAgICAgICAgICAgICAnZXhjZXB0aW9uOiAnICsgZXgubWVzc2FnZSk7CiAgfQp9OwoKCi8qKgogKiBTZXRzIGEgZnVuY3Rpb24gdG8gdXNlIGFzIGEgZmlsdGVyIGZvciBlcnJvcnMuCiAqIEBwYXJhbSB7ZnVuY3Rpb24oc3RyaW5nKX0gZm4gRmlsdGVyIGZ1bmN0aW9uLgogKi8KZ29vZy50ZXN0aW5nLlRlc3RSdW5uZXIucHJvdG90eXBlLnNldEVycm9yRmlsdGVyID0gZnVuY3Rpb24oZm4pIHsKICB0aGlzLmVycm9yRmlsdGVyXyA9IGZuOwp9OwoKCi8qKgogKiBSZXR1cm5zIGEgcmVwb3J0IG9mIHRoZSB0ZXN0IGNhc2UgdGhhdCByYW4uCiAqIFVzZWQgYnkgU2VsZW5pdW0gSG9va3MuCiAqIEBwYXJhbSB7Ym9vbGVhbj19IG9wdF92ZXJib3NlIElmIHRydWUgcmVzdWx0cyB3aWxsIGluY2x1ZGUgZGF0YSBhYm91dCBhbGwKICogICAgIHRlc3RzLCBub3QganVzdCB3aGF0IGZhaWxlZC4KICogQHJldHVybiB7c3RyaW5nfSBBIHJlcG9ydCBzdW1tYXJ5IG9mIHRoZSB0ZXN0LgogKi8KZ29vZy50ZXN0aW5nLlRlc3RSdW5uZXIucHJvdG90eXBlLmdldFJlcG9ydCA9IGZ1bmN0aW9uKG9wdF92ZXJib3NlKSB7CiAgdmFyIHJlcG9ydCA9IFtdOwogIGlmICh0aGlzLnRlc3RDYXNlKSB7CiAgICByZXBvcnQucHVzaCh0aGlzLnRlc3RDYXNlLmdldFJlcG9ydChvcHRfdmVyYm9zZSkpOwogIH0KICBpZiAodGhpcy5lcnJvcnMubGVuZ3RoID4gMCkgewogICAgcmVwb3J0LnB1c2goJ0phdmFTY3JpcHQgZXJyb3JzIGRldGVjdGVkIGJ5IHRlc3QgcnVubmVyOicpOwogICAgcmVwb3J0LnB1c2guYXBwbHkocmVwb3J0LCB0aGlzLmVycm9ycyk7CiAgICByZXBvcnQucHVzaCgnXG4nKTsKICB9CiAgcmV0dXJuIHJlcG9ydC5qb2luKCdcbicpOwp9OwoKCi8qKgogKiBSZXR1cm5zIHRoZSBhbW91bnQgb2YgdGltZSBpdCB0b29rIGZvciB0aGUgdGVzdCB0byBydW4uCiAqIFVzZWQgYnkgU2VsZW5pdW0gSG9va3MuCiAqIEByZXR1cm4ge251bWJlcn0gVGhlIHJ1biB0aW1lLCBpbiBtaWxsaXNlY29uZHMuCiAqLwpnb29nLnRlc3RpbmcuVGVzdFJ1bm5lci5wcm90b3R5cGUuZ2V0UnVuVGltZSA9IGZ1bmN0aW9uKCkgewogIHJldHVybiB0aGlzLnRlc3RDYXNlID8gdGhpcy50ZXN0Q2FzZS5nZXRSdW5UaW1lKCkgOiAwOwp9OwoKCi8qKgogKiBSZXR1cm5zIHRoZSBudW1iZXIgb2Ygc2NyaXB0IGZpbGVzIHRoYXQgd2VyZSBsb2FkZWQgaW4gb3JkZXIgdG8gcnVuIHRoZSB0ZXN0LgogKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBudW1iZXIgb2Ygc2NyaXB0IGZpbGVzLgogKi8KZ29vZy50ZXN0aW5nLlRlc3RSdW5uZXIucHJvdG90eXBlLmdldE51bUZpbGVzTG9hZGVkID0gZnVuY3Rpb24oKSB7CiAgcmV0dXJuIHRoaXMudGVzdENhc2UgPyB0aGlzLnRlc3RDYXNlLmdldE51bUZpbGVzTG9hZGVkKCkgOiAwOwp9OwoKCi8qKgogKiBFeGVjdXRlcyBhIHRlc3QgY2FzZSBhbmQgcHJpbnRzIHRoZSByZXN1bHRzIHRvIHRoZSB3aW5kb3cuCiAqLwpnb29nLnRlc3RpbmcuVGVzdFJ1bm5lci5wcm90b3R5cGUuZXhlY3V0ZSA9IGZ1bmN0aW9uKCkgewogIGlmICghdGhpcy50ZXN0Q2FzZSkgewogICAgdGhyb3cgRXJyb3IoJ1RoZSB0ZXN0IHJ1bm5lciBtdXN0IGJlIGluaXRpYWxpemVkIHdpdGggYSB0ZXN0IGNhc2UgJyArCiAgICAgICAgICAgICAgICAnYmVmb3JlIGV4ZWN1dGUgY2FuIGJlIGNhbGxlZC4nKTsKICB9CgogIGlmICh0aGlzLnN0cmljdF8gJiYgdGhpcy50ZXN0Q2FzZS5nZXRDb3VudCgpID09IDApIHsKICAgIHRocm93IEVycm9yKAogICAgICAgICdObyB0ZXN0cyBmb3VuZCBpbiBnaXZlbiB0ZXN0IGNhc2U6ICcgKwogICAgICAgIHRoaXMudGVzdENhc2UuZ2V0TmFtZSgpICsgJyAnICsKICAgICAgICAnQnkgZGVmYXVsdCwgdGhlIHRlc3QgcnVubmVyIGZhaWxzIGlmIGEgdGVzdCBjYXNlIGhhcyBubyB0ZXN0cy4gJyArCiAgICAgICAgJ1RvIG1vZGlmeSB0aGlzIGJlaGF2aW9yLCBzZWUgZ29vZy50ZXN0aW5nLlRlc3RSdW5uZXJcJ3MgJyArCiAgICAgICAgJ3NldFN0cmljdCgpIG1ldGhvZCwgb3IgR190ZXN0UnVubmVyLnNldFN0cmljdCgpJyk7CiAgfQoKICB0aGlzLnRlc3RDYXNlLnNldENvbXBsZXRlZENhbGxiYWNrKGdvb2cuYmluZCh0aGlzLm9uQ29tcGxldGVfLCB0aGlzKSk7CiAgdGhpcy50ZXN0Q2FzZS5ydW5UZXN0cygpOwp9OwoKCi8qKgogKiBXcml0ZXMgdGhlIHJlc3VsdHMgdG8gdGhlIGRvY3VtZW50IHdoZW4gdGhlIHRlc3QgY2FzZSBjb21wbGV0ZXMuCiAqIEBwcml2YXRlCiAqLwpnb29nLnRlc3RpbmcuVGVzdFJ1bm5lci5wcm90b3R5cGUub25Db21wbGV0ZV8gPSBmdW5jdGlvbigpIHsKICB2YXIgbG9nID0gdGhpcy50ZXN0Q2FzZS5nZXRSZXBvcnQodHJ1ZSk7CiAgaWYgKHRoaXMuZXJyb3JzLmxlbmd0aCA+IDApIHsKICAgIGxvZyArPSAnXG4nICsgdGhpcy5lcnJvcnMuam9pbignXG4nKTsKICB9CgogIGlmICghdGhpcy5sb2dFbF8pIHsKICAgIHZhciBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjbG9zdXJlVGVzdFJ1bm5lckxvZycpOwogICAgaWYgKGVsID09IG51bGwpIHsKICAgICAgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChlbCk7CiAgICB9CiAgICB0aGlzLmxvZ0VsXyA9IGVsOwogIH0KCiAgLy8gSGlnaGxpZ2h0IHRoZSBwYWdlIHRvIGluZGljYXRlIHRoZSBvdmVyYWxsIG91dGNvbWUuCiAgdGhpcy53cml0ZUxvZyhsb2cpOwoKICAvLyBUT0RPKGNocmlzaGVucnkpOiBNYWtlIHRoaXMgd29yayB3aXRoIG11bHRpcGxlIHRlc3QgY2FzZXMgKGIvODYwMzYzOCkuCiAgdmFyIHJ1bkFnYWluTGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsKICBydW5BZ2Fpbkxpbmsuc3R5bGUuZGlzcGxheSA9ICdpbmxpbmUtYmxvY2snOwogIHJ1bkFnYWluTGluay5zdHlsZS5mb250U2l6ZSA9ICdzbWFsbCc7CiAgcnVuQWdhaW5MaW5rLnN0eWxlLm1hcmdpbkJvdHRvbSA9ICcxNnB4JzsKICBydW5BZ2FpbkxpbmsuaHJlZiA9ICcnOwogIHJ1bkFnYWluTGluay5vbmNsaWNrID0gZ29vZy5iaW5kKGZ1bmN0aW9uKCkgewogICAgdGhpcy5leGVjdXRlKCk7CiAgICByZXR1cm4gZmFsc2U7CiAgfSwgdGhpcyk7CiAgcnVuQWdhaW5MaW5rLmlubmVySFRNTCA9ICdSdW4gYWdhaW4gd2l0aG91dCByZWxvYWRpbmcnOwogIHRoaXMubG9nRWxfLmFwcGVuZENoaWxkKHJ1bkFnYWluTGluayk7Cn07CgoKLyoqCiAqIFdyaXRlcyBhIG5pY2VseSBmb3JtYXR0ZWQgbG9nIG91dCB0byB0aGUgZG9jdW1lbnQuCiAqIEBwYXJhbSB7c3RyaW5nfSBsb2cgVGhlIHN0cmluZyB0byB3cml0ZS4KICovCmdvb2cudGVzdGluZy5UZXN0UnVubmVyLnByb3RvdHlwZS53cml0ZUxvZyA9IGZ1bmN0aW9uKGxvZykgewogIHZhciBsaW5lcyA9IGxvZy5zcGxpdCgnXG4nKTsKICBmb3IgKHZhciBpID0gMDsgaSA8IGxpbmVzLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgbGluZSA9IGxpbmVzW2ldOwogICAgdmFyIGNvbG9yOwogICAgdmFyIGlzRmFpbE9yRXJyb3IgPSAvRkFJTEVELy50ZXN0KGxpbmUpIHx8IC9FUlJPUi8udGVzdChsaW5lKTsKICAgIGlmICgvUEFTU0VELy50ZXN0KGxpbmUpKSB7CiAgICAgIGNvbG9yID0gJ2RhcmtncmVlbic7CiAgICB9IGVsc2UgaWYgKGlzRmFpbE9yRXJyb3IpIHsKICAgICAgY29sb3IgPSAnZGFya3JlZCc7CiAgICB9IGVsc2UgewogICAgICBjb2xvciA9ICcjMzMzJzsKICAgIH0KICAgIHZhciBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgIGlmIChsaW5lLnN1YnN0cigwLCAyKSA9PSAnPiAnKSB7CiAgICAgIC8vIFRoZSBzdGFjayB0cmFjZSBtYXkgY29udGFpbiBsaW5rcyBzbyBpdCBoYXMgdG8gYmUgaW50ZXJwcmV0ZWQgYXMgSFRNTC4KICAgICAgZGl2LmlubmVySFRNTCA9IGxpbmU7CiAgICB9IGVsc2UgewogICAgICBkaXYuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUobGluZSkpOwogICAgfQoKICAgIHZhciB0ZXN0TmFtZU1hdGNoID0KICAgICAgICAvKFxTKykgKFxbW15cXV0qXSApPzogKEZBSUxFRHxFUlJPUnxQQVNTRUQpLy5leGVjKGxpbmUpOwogICAgaWYgKHRlc3ROYW1lTWF0Y2gpIHsKICAgICAgLy8gQnVpbGQgYSBVUkwgdG8gcnVuIHRoZSB0ZXN0IGluZGl2aWR1YWxseS4gIElmIHRoaXMgdGVzdCB3YXMgYWxyZWFkeQogICAgICAvLyBwYXJ0IG9mIGFub3RoZXIgc3Vic2V0IHRlc3QsIHdlIG5lZWQgdG8gb3ZlcndyaXRlIHRoZSBvbGQgcnVuVGVzdHMKICAgICAgLy8gcXVlcnkgcGFyYW1ldGVyLiAgV2UgYWxzbyBuZWVkIHRvIGRvIHRoaXMgd2l0aG91dCBicmluZ2luZyBpbiBhbnkKICAgICAgLy8gZXh0cmEgZGVwZW5kZW5jaWVzLCBvdGhlcndpc2Ugd2UgY291bGQgbWFzayBtaXNzaW5nIGRlcGVuZGVuY3kgYnVncy4KICAgICAgdmFyIG5ld1NlYXJjaCA9ICdydW5UZXN0cz0nICsgdGVzdE5hbWVNYXRjaFsxXTsKICAgICAgdmFyIHNlYXJjaCA9IHdpbmRvdy5sb2NhdGlvbi5zZWFyY2g7CiAgICAgIGlmIChzZWFyY2gpIHsKICAgICAgICB2YXIgb2xkVGVzdHMgPSAvcnVuVGVzdHM9KFteJl0qKS8uZXhlYyhzZWFyY2gpOwogICAgICAgIGlmIChvbGRUZXN0cykgewogICAgICAgICAgbmV3U2VhcmNoID0gc2VhcmNoLnN1YnN0cigwLCBvbGRUZXN0cy5pbmRleCkgKwogICAgICAgICAgICAgICAgICAgICAgbmV3U2VhcmNoICsKICAgICAgICAgICAgICAgICAgICAgIHNlYXJjaC5zdWJzdHIob2xkVGVzdHMuaW5kZXggKyBvbGRUZXN0c1swXS5sZW5ndGgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBuZXdTZWFyY2ggPSBzZWFyY2ggKyAnJicgKyBuZXdTZWFyY2g7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIG5ld1NlYXJjaCA9ICc/JyArIG5ld1NlYXJjaDsKICAgICAgfQogICAgICB2YXIgaHJlZiA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmOwogICAgICB2YXIgaGFzaCA9IHdpbmRvdy5sb2NhdGlvbi5oYXNoOwogICAgICBpZiAoaGFzaCAmJiBoYXNoLmNoYXJBdCgwKSAhPSAnIycpIHsKICAgICAgICBoYXNoID0gJyMnICsgaGFzaDsKICAgICAgfQogICAgICBocmVmID0gaHJlZi5zcGxpdCgnIycpWzBdLnNwbGl0KCc/JylbMF0gKyBuZXdTZWFyY2ggKyBoYXNoOwoKICAgICAgLy8gQWRkIHRoZSBsaW5rLgogICAgICB2YXIgYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ0EnKTsKICAgICAgYS5pbm5lckhUTUwgPSAnKHJ1biBpbmRpdmlkdWFsbHkpJzsKICAgICAgYS5zdHlsZS5mb250U2l6ZSA9ICcwLjhlbSc7CiAgICAgIGEuc3R5bGUuY29sb3IgPSAnIzg4OCc7CiAgICAgIGEuaHJlZiA9IGhyZWY7CiAgICAgIGRpdi5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnICcpKTsKICAgICAgZGl2LmFwcGVuZENoaWxkKGEpOwogICAgfQoKICAgIGRpdi5zdHlsZS5jb2xvciA9IGNvbG9yOwogICAgZGl2LnN0eWxlLmZvbnQgPSAnbm9ybWFsIDEwMCUgbW9ub3NwYWNlJzsKICAgIGRpdi5zdHlsZS53b3JkV3JhcCA9ICdicmVhay13b3JkJzsKICAgIGlmIChpID09IDApIHsKICAgICAgLy8gSGlnaGxpZ2h0IHRoZSBmaXJzdCBsaW5lIGFzIGEgaGVhZGVyIHRoYXQgaW5kaWNhdGVzIHRoZSB0ZXN0IG91dGNvbWUuCiAgICAgIGRpdi5zdHlsZS5wYWRkaW5nID0gJzIwcHgnOwogICAgICBkaXYuc3R5bGUubWFyZ2luQm90dG9tID0gJzEwcHgnOwogICAgICBpZiAoaXNGYWlsT3JFcnJvcikgewogICAgICAgIGRpdi5zdHlsZS5ib3JkZXIgPSAnNXB4IHNvbGlkICcgKyBjb2xvcjsKICAgICAgICBkaXYuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJyNmZmVlZWUnOwogICAgICB9IGVsc2UgewogICAgICAgIGRpdi5zdHlsZS5ib3JkZXIgPSAnMXB4IHNvbGlkIGJsYWNrJzsKICAgICAgICBkaXYuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJyNlZWZmZWUnOwogICAgICB9CiAgICB9CgogICAgdHJ5IHsKICAgICAgZGl2LnN0eWxlLndoaXRlU3BhY2UgPSAncHJlLXdyYXAnOwogICAgfSBjYXRjaCAoZSkgewogICAgICAvLyBOT1RFKGJyZW5uZW1hbik6IElFIHJhaXNlcyBhbiBleGNlcHRpb24gd2hlbiBhc3NpZ25pbmcgdG8gcHJlLXdyYXAuCiAgICAgIC8vIFRoYW5rZnVsbHksIGl0IGRvZXNuJ3QgY29sbGFwc2Ugd2hpdGVzcGFjZSB3aGVuIHVzaW5nIG1vbm9zcGFjZSBmb250cywKICAgICAgLy8gc28gaXQgd2lsbCBkaXNwbGF5IGNvcnJlY3RseSBpZiB3ZSBpZ25vcmUgdGhlIGV4Y2VwdGlvbi4KICAgIH0KCiAgICBpZiAoaSA8IDIpIHsKICAgICAgZGl2LnN0eWxlLmZvbnRXZWlnaHQgPSAnYm9sZCc7CiAgICB9CiAgICB0aGlzLmxvZ0VsXy5hcHBlbmRDaGlsZChkaXYpOwogIH0KfTsKCgovKioKICogTG9ncyBhIG1lc3NhZ2UgdG8gdGhlIGN1cnJlbnQgdGVzdCBjYXNlLgogKiBAcGFyYW0ge3N0cmluZ30gcyBUaGUgdGV4dCB0byBvdXRwdXQgdG8gdGhlIGxvZy4KICovCmdvb2cudGVzdGluZy5UZXN0UnVubmVyLnByb3RvdHlwZS5sb2cgPSBmdW5jdGlvbihzKSB7CiAgaWYgKHRoaXMudGVzdENhc2UpIHsKICAgIHRoaXMudGVzdENhc2UubG9nKHMpOwogIH0KfTsKCgovLyBUT0RPKG5uYXplKTogUHJvcGVybHkgaGFuZGxlIHNlcnZpbmcgdGVzdCByZXN1bHRzIHdoZW4gbXVsdGlwbGUgdGVzdCBjYXNlcwovLyBhcmUgcnVuLgovKioKICogQHJldHVybiB7T2JqZWN0PHN0cmluZywgIUFycmF5PHN0cmluZz4+fSBBIG1hcCBvZiB0ZXN0IG5hbWVzIHRvIGEgbGlzdCBvZgogKiB0ZXN0IGZhaWx1cmVzIChpZiBhbnkpIHRvIHByb3ZpZGUgZm9ybWF0dGVkIGRhdGEgZm9yIHRoZSB0ZXN0IHJ1bm5lci4KICovCmdvb2cudGVzdGluZy5UZXN0UnVubmVyLnByb3RvdHlwZS5nZXRUZXN0UmVzdWx0cyA9IGZ1bmN0aW9uKCkgewogIGlmICh0aGlzLnRlc3RDYXNlKSB7CiAgICByZXR1cm4gdGhpcy50ZXN0Q2FzZS5nZXRUZXN0UmVzdWx0cygpOwogIH0KICByZXR1cm4gbnVsbDsKfTsK",
                "body": "Ly8gQ29weXJpZ2h0IDIwMDcgVGhlIENsb3N1cmUgTGlicmFyeSBBdXRob3JzLiBBbGwgUmlnaHRzIFJlc2VydmVkLgovLwovLyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKLy8geW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgovLyBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKLy8KLy8gICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKLy8KLy8gVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQovLyBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMtSVMiIEJBU0lTLAovLyBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KLy8gU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAovLyBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCi8qKgogKiBAZmlsZW92ZXJ2aWV3IFRoZSB0ZXN0IHJ1bm5lciBpcyBhIHNpbmdsZXRvbiBvYmplY3QgdGhhdCBpcyB1c2VkIHRvIGV4ZWN1dGUKICogYSBnb29nLnRlc3RpbmcuVGVzdENhc2VzLCBkaXNwbGF5IHRoZSByZXN1bHRzLCBhbmQgZXhwb3NlIHRoZSByZXN1bHRzIHRvCiAqIFNlbGVuaXVtIGZvciBhdXRvbWF0aW9uLiAgSWYgYSBUZXN0Q2FzZSBoYXNuJ3QgYmVlbiByZWdpc3RlcmVkIHdpdGggdGhlCiAqIHJ1bm5lciBieSB0aGUgdGltZSB3aW5kb3cub25sb2FkIG9jY3VycywgdGhlIHRlc3RSdW5uZXIgd2lsbCB0cnkgdG8gYXV0by0KICogZGlzY292ZXIgSnNVbml0IHN0eWxlIHRlc3QgcGFnZXMuCiAqCiAqIFRoZSBob29rcyBmb3Igc2VsZW5pdW0gYXJlIChzZWUgaHR0cDovL2dvL3NlbGVuaXVtLWhvb2stc2V0dXApOi0KICogIC0gQm9vbGVhbiBHX3Rlc3RSdW5uZXIuaXNGaW5pc2hlZCgpCiAqICAtIEJvb2xlYW4gR190ZXN0UnVubmVyLmlzU3VjY2VzcygpCiAqICAtIFN0cmluZyBHX3Rlc3RSdW5uZXIuZ2V0UmVwb3J0KCkKICogIC0gbnVtYmVyIEdfdGVzdFJ1bm5lci5nZXRSdW5UaW1lKCkKICogIC0gT2JqZWN0PHN0cmluZywgQXJyYXk8c3RyaW5nPj4gR190ZXN0UnVubmVyLmdldFRlc3RSZXN1bHRzKCkKICoKICogVGVzdGluZyBjb2RlIHNob3VsZCBub3QgaGF2ZSBkZXBlbmRlbmNpZXMgb3V0c2lkZSBvZiBnb29nLnRlc3Rpbmcgc28gYXMgdG8KICogcmVkdWNlIHRoZSBjaGFuY2Ugb2YgbWFza2luZyBtaXNzaW5nIGRlcGVuZGVuY2llcy4KICoKICovCgpnb29nLnByb3ZpZGUoJ2dvb2cudGVzdGluZy5UZXN0UnVubmVyJyk7Cgpnb29nLnJlcXVpcmUoJ2dvb2cudGVzdGluZy5UZXN0Q2FzZScpOwoKCgovKioKICogQ29uc3RydWN0IGEgdGVzdCBydW5uZXIuCiAqCiAqIE5PVEUodXNlcik6IFRoaXMgaXMgY3VycmVudGx5IHByZXR0eSB3ZWlyZCwgSSdtIGVzc2VudGlhbGx5IHRyeWluZyB0bwogKiBjcmVhdGUgYSB3cmFwcGVyIHRoYXQgdGhlIFNlbGVuaXVtIHRlc3QgY2FuIGhvb2sgaW50byB0byBxdWVyeSB0aGUgc3RhdGUgb2YKICogdGhlIHJ1bm5pbmcgdGVzdCBjYXNlLCB3aGlsZSBtYWtpbmcgZ29vZy50ZXN0aW5nLlRlc3RDYXNlIGdlbmVyYWwuCiAqCiAqIEBjb25zdHJ1Y3RvcgogKi8KZ29vZy50ZXN0aW5nLlRlc3RSdW5uZXIgPSBmdW5jdGlvbigpIHsKICAvKioKICAgKiBFcnJvcnMgdGhhdCBvY2N1cnJlZCBpbiB0aGUgd2luZG93LgogICAqIEB0eXBlIHtBcnJheTxzdHJpbmc+fQogICAqLwogIHRoaXMuZXJyb3JzID0gW107Cn07CgoKLyoqCiAqIFJlZmVyZW5jZSB0byB0aGUgYWN0aXZlIHRlc3QgY2FzZS4KICogQHR5cGUge2dvb2cudGVzdGluZy5UZXN0Q2FzZT99CiAqLwpnb29nLnRlc3RpbmcuVGVzdFJ1bm5lci5wcm90b3R5cGUudGVzdENhc2UgPSBudWxsOwoKCi8qKgogKiBXaGV0aGVyIHRoZSB0ZXN0IHJ1bm5lciBoYXMgYmVlbiBpbml0aWFsaXplZCB5ZXQuCiAqIEB0eXBlIHtib29sZWFufQogKi8KZ29vZy50ZXN0aW5nLlRlc3RSdW5uZXIucHJvdG90eXBlLmluaXRpYWxpemVkID0gZmFsc2U7CgoKLyoqCiAqIEVsZW1lbnQgY3JlYXRlZCBpbiB0aGUgZG9jdW1lbnQgdG8gYWRkIHRlc3QgcmVzdWx0cyB0by4KICogQHR5cGUge0VsZW1lbnR9CiAqIEBwcml2YXRlCiAqLwpnb29nLnRlc3RpbmcuVGVzdFJ1bm5lci5wcm90b3R5cGUubG9nRWxfID0gbnVsbDsKCgovKioKICogRnVuY3Rpb24gdG8gdXNlIHdoZW4gZmlsdGVyaW5nIGVycm9ycy4KICogQHR5cGUgeyhmdW5jdGlvbihzdHJpbmcpKT99CiAqIEBwcml2YXRlCiAqLwpnb29nLnRlc3RpbmcuVGVzdFJ1bm5lci5wcm90b3R5cGUuZXJyb3JGaWx0ZXJfID0gbnVsbDsKCgovKioKICogV2hldGhlciBhbiBlbXB0eSB0ZXN0IGNhc2UgY291bnRzIGFzIGFuIGVycm9yLgogKiBAdHlwZSB7Ym9vbGVhbn0KICogQHByaXZhdGUKICovCmdvb2cudGVzdGluZy5UZXN0UnVubmVyLnByb3RvdHlwZS5zdHJpY3RfID0gdHJ1ZTsKCgovKioKICogSW5pdGlhbGl6ZXMgdGhlIHRlc3QgcnVubmVyLgogKiBAcGFyYW0ge2dvb2cudGVzdGluZy5UZXN0Q2FzZX0gdGVzdENhc2UgVGhlIHRlc3QgY2FzZSB0byBpbml0aWFsaXplIHdpdGguCiAqLwpnb29nLnRlc3RpbmcuVGVzdFJ1bm5lci5wcm90b3R5cGUuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uKHRlc3RDYXNlKSB7CiAgaWYgKHRoaXMudGVzdENhc2UgJiYgdGhpcy50ZXN0Q2FzZS5ydW5uaW5nKSB7CiAgICB0aHJvdyBFcnJvcignVGhlIHRlc3QgcnVubmVyIGlzIGFscmVhZHkgd2FpdGluZyBmb3IgYSB0ZXN0IHRvIGNvbXBsZXRlJyk7CiAgfQogIHRoaXMudGVzdENhc2UgPSB0ZXN0Q2FzZTsKICB0aGlzLmluaXRpYWxpemVkID0gdHJ1ZTsKfTsKCgovKioKICogQnkgZGVmYXVsdCwgdGhlIHRlc3QgcnVubmVyIGlzIHN0cmljdCwgYW5kIGZhaWxzIGlmIGl0IHJ1bnMgYW4gZW1wdHkKICogdGVzdCBjYXNlLgogKiBAcGFyYW0ge2Jvb2xlYW59IHN0cmljdCBXaGV0aGVyIHRoZSB0ZXN0IHJ1bm5lciBzaG91bGQgZmFpbCBvbiBhbiBlbXB0eQogKiAgICAgdGVzdCBjYXNlLgogKi8KZ29vZy50ZXN0aW5nLlRlc3RSdW5uZXIucHJvdG90eXBlLnNldFN0cmljdCA9IGZ1bmN0aW9uKHN0cmljdCkgewogIHRoaXMuc3RyaWN0XyA9IHN0cmljdDsKfTsKCgovKioKICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgdGVzdCBydW5uZXIgc2hvdWxkIGZhaWwgb24gYW4gZW1wdHkKICogICAgIHRlc3QgY2FzZS4KICovCmdvb2cudGVzdGluZy5UZXN0UnVubmVyLnByb3RvdHlwZS5pc1N0cmljdCA9IGZ1bmN0aW9uKCkgewogIHJldHVybiB0aGlzLnN0cmljdF87Cn07CgoKLyoqCiAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgdGVzdCBydW5uZXIgaXMgaW5pdGlhbGl6ZWQuCiAqIFVzZWQgYnkgU2VsZW5pdW0gSG9va3MuCiAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhlIHRlc3QgcnVubmVyIGlzIGFjdGl2ZS4KICovCmdvb2cudGVzdGluZy5UZXN0UnVubmVyLnByb3RvdHlwZS5pc0luaXRpYWxpemVkID0gZnVuY3Rpb24oKSB7CiAgcmV0dXJuIHRoaXMuaW5pdGlhbGl6ZWQ7Cn07CgoKLyoqCiAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgdGVzdCBydW5uZXIgaXMgZmluaXNoZWQuCiAqIFVzZWQgYnkgU2VsZW5pdW0gSG9va3MuCiAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhlIHRlc3QgcnVubmVyIGlzIGFjdGl2ZS4KICovCmdvb2cudGVzdGluZy5UZXN0UnVubmVyLnByb3RvdHlwZS5pc0ZpbmlzaGVkID0gZnVuY3Rpb24oKSB7CiAgcmV0dXJuIHRoaXMuZXJyb3JzLmxlbmd0aCA+IDAgfHwKICAgICAgdGhpcy5pbml0aWFsaXplZCAmJiAhIXRoaXMudGVzdENhc2UgJiYgdGhpcy50ZXN0Q2FzZS5zdGFydGVkICYmCiAgICAgICF0aGlzLnRlc3RDYXNlLnJ1bm5pbmc7Cn07CgoKLyoqCiAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgdGVzdCBjYXNlIGRpZG4ndCBmYWlsLgogKiBVc2VkIGJ5IFNlbGVuaXVtIEhvb2tzLgogKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSBjdXJyZW50IHRlc3QgcmV0dXJuZWQgc3VjY2Vzc2Z1bGx5LgogKi8KZ29vZy50ZXN0aW5nLlRlc3RSdW5uZXIucHJvdG90eXBlLmlzU3VjY2VzcyA9IGZ1bmN0aW9uKCkgewogIHJldHVybiAhdGhpcy5oYXNFcnJvcnMoKSAmJiAhIXRoaXMudGVzdENhc2UgJiYgdGhpcy50ZXN0Q2FzZS5pc1N1Y2Nlc3MoKTsKfTsKCgovKioKICogUmV0dXJucyB0cnVlIGlmIHRoZSB0ZXN0IGNhc2UgcnVubmVyIGhhcyBlcnJvcnMgdGhhdCB3ZXJlIGNhdWdodCBvdXRzaWRlIG9mCiAqIHRoZSB0ZXN0IGNhc2UuCiAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhlcmUgd2VyZSBKUyBlcnJvcnMuCiAqLwpnb29nLnRlc3RpbmcuVGVzdFJ1bm5lci5wcm90b3R5cGUuaGFzRXJyb3JzID0gZnVuY3Rpb24oKSB7CiAgcmV0dXJuIHRoaXMuZXJyb3JzLmxlbmd0aCA+IDA7Cn07CgoKLyoqCiAqIExvZ3MgYW4gZXJyb3IgdGhhdCBvY2N1cnJlZC4gIFVzZWQgaW4gdGhlIGNhc2Ugb2YgZW52aXJvbm1lbnQgc2V0dGluZyB1cAogKiBhbiBvbmVycm9yIGhhbmRsZXIuCiAqIEBwYXJhbSB7c3RyaW5nfSBtc2cgRXJyb3IgbWVzc2FnZS4KICovCmdvb2cudGVzdGluZy5UZXN0UnVubmVyLnByb3RvdHlwZS5sb2dFcnJvciA9IGZ1bmN0aW9uKG1zZykgewogIGlmICghdGhpcy5lcnJvckZpbHRlcl8gfHwgdGhpcy5lcnJvckZpbHRlcl8uY2FsbChudWxsLCBtc2cpKSB7CiAgICB0aGlzLmVycm9ycy5wdXNoKG1zZyk7CiAgfQp9OwoKCi8qKgogKiBMb2cgZmFpbHVyZSBpbiBjdXJyZW50IHJ1bm5pbmcgdGVzdC4KICogQHBhcmFtIHtFcnJvcn0gZXggRXhjZXB0aW9uLgogKi8KZ29vZy50ZXN0aW5nLlRlc3RSdW5uZXIucHJvdG90eXBlLmxvZ1Rlc3RGYWlsdXJlID0gZnVuY3Rpb24oZXgpIHsKICB2YXIgdGVzdE5hbWUgPSAvKiogQHR5cGUge3N0cmluZ30gKi8gKGdvb2cudGVzdGluZy5UZXN0Q2FzZS5jdXJyZW50VGVzdE5hbWUpOwogIGlmICh0aGlzLnRlc3RDYXNlKSB7CiAgICB0aGlzLnRlc3RDYXNlLmxvZ0Vycm9yKHRlc3ROYW1lLCBleCk7CiAgfSBlbHNlIHsKICAgIC8vIE5PVEU6IERvIG5vdCBmb3JnZXQgdG8gbG9nIHRoZSBvcmlnaW5hbCBleGNlcHRpb24gcmFpc2VkLgogICAgdGhyb3cgbmV3IEVycm9yKCdUZXN0IHJ1bm5lciBub3QgaW5pdGlhbGl6ZWQgd2l0aCBhIHRlc3QgY2FzZS4gT3JpZ2luYWwgJyArCiAgICAgICAgICAgICAgICAgICAgJ2V4Y2VwdGlvbjogJyArIGV4Lm1lc3NhZ2UpOwogIH0KfTsKCgovKioKICogU2V0cyBhIGZ1bmN0aW9uIHRvIHVzZSBhcyBhIGZpbHRlciBmb3IgZXJyb3JzLgogKiBAcGFyYW0ge2Z1bmN0aW9uKHN0cmluZyl9IGZuIEZpbHRlciBmdW5jdGlvbi4KICovCmdvb2cudGVzdGluZy5UZXN0UnVubmVyLnByb3RvdHlwZS5zZXRFcnJvckZpbHRlciA9IGZ1bmN0aW9uKGZuKSB7CiAgdGhpcy5lcnJvckZpbHRlcl8gPSBmbjsKfTsKCgovKioKICogUmV0dXJucyBhIHJlcG9ydCBvZiB0aGUgdGVzdCBjYXNlIHRoYXQgcmFuLgogKiBVc2VkIGJ5IFNlbGVuaXVtIEhvb2tzLgogKiBAcGFyYW0ge2Jvb2xlYW49fSBvcHRfdmVyYm9zZSBJZiB0cnVlIHJlc3VsdHMgd2lsbCBpbmNsdWRlIGRhdGEgYWJvdXQgYWxsCiAqICAgICB0ZXN0cywgbm90IGp1c3Qgd2hhdCBmYWlsZWQuCiAqIEByZXR1cm4ge3N0cmluZ30gQSByZXBvcnQgc3VtbWFyeSBvZiB0aGUgdGVzdC4KICovCmdvb2cudGVzdGluZy5UZXN0UnVubmVyLnByb3RvdHlwZS5nZXRSZXBvcnQgPSBmdW5jdGlvbihvcHRfdmVyYm9zZSkgewogIHZhciByZXBvcnQgPSBbXTsKICBpZiAodGhpcy50ZXN0Q2FzZSkgewogICAgcmVwb3J0LnB1c2godGhpcy50ZXN0Q2FzZS5nZXRSZXBvcnQob3B0X3ZlcmJvc2UpKTsKICB9CiAgaWYgKHRoaXMuZXJyb3JzLmxlbmd0aCA+IDApIHsKICAgIHJlcG9ydC5wdXNoKCdKYXZhU2NyaXB0IGVycm9ycyBkZXRlY3RlZCBieSB0ZXN0IHJ1bm5lcjonKTsKICAgIHJlcG9ydC5wdXNoLmFwcGx5KHJlcG9ydCwgdGhpcy5lcnJvcnMpOwogICAgcmVwb3J0LnB1c2goJ1xuJyk7CiAgfQogIHJldHVybiByZXBvcnQuam9pbignXG4nKTsKfTsKCgovKioKICogUmV0dXJucyB0aGUgYW1vdW50IG9mIHRpbWUgaXQgdG9vayBmb3IgdGhlIHRlc3QgdG8gcnVuLgogKiBVc2VkIGJ5IFNlbGVuaXVtIEhvb2tzLgogKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBydW4gdGltZSwgaW4gbWlsbGlzZWNvbmRzLgogKi8KZ29vZy50ZXN0aW5nLlRlc3RSdW5uZXIucHJvdG90eXBlLmdldFJ1blRpbWUgPSBmdW5jdGlvbigpIHsKICByZXR1cm4gdGhpcy50ZXN0Q2FzZSA/IHRoaXMudGVzdENhc2UuZ2V0UnVuVGltZSgpIDogMDsKfTsKCgovKioKICogUmV0dXJucyB0aGUgbnVtYmVyIG9mIHNjcmlwdCBmaWxlcyB0aGF0IHdlcmUgbG9hZGVkIGluIG9yZGVyIHRvIHJ1biB0aGUgdGVzdC4KICogQHJldHVybiB7bnVtYmVyfSBUaGUgbnVtYmVyIG9mIHNjcmlwdCBmaWxlcy4KICovCmdvb2cudGVzdGluZy5UZXN0UnVubmVyLnByb3RvdHlwZS5nZXROdW1GaWxlc0xvYWRlZCA9IGZ1bmN0aW9uKCkgewogIHJldHVybiB0aGlzLnRlc3RDYXNlID8gdGhpcy50ZXN0Q2FzZS5nZXROdW1GaWxlc0xvYWRlZCgpIDogMDsKfTsKCgovKioKICogRXhlY3V0ZXMgYSB0ZXN0IGNhc2UgYW5kIHByaW50cyB0aGUgcmVzdWx0cyB0byB0aGUgd2luZG93LgogKi8KZ29vZy50ZXN0aW5nLlRlc3RSdW5uZXIucHJvdG90eXBlLmV4ZWN1dGUgPSBmdW5jdGlvbigpIHsKICBpZiAoIXRoaXMudGVzdENhc2UpIHsKICAgIHRocm93IEVycm9yKCdUaGUgdGVzdCBydW5uZXIgbXVzdCBiZSBpbml0aWFsaXplZCB3aXRoIGEgdGVzdCBjYXNlICcgKwogICAgICAgICAgICAgICAgJ2JlZm9yZSBleGVjdXRlIGNhbiBiZSBjYWxsZWQuJyk7CiAgfQoKICBpZiAodGhpcy5zdHJpY3RfICYmIHRoaXMudGVzdENhc2UuZ2V0Q291bnQoKSA9PSAwKSB7CiAgICB0aHJvdyBFcnJvcigKICAgICAgICAnTm8gdGVzdHMgZm91bmQgaW4gZ2l2ZW4gdGVzdCBjYXNlOiAnICsKICAgICAgICB0aGlzLnRlc3RDYXNlLmdldE5hbWUoKSArICcgJyArCiAgICAgICAgJ0J5IGRlZmF1bHQsIHRoZSB0ZXN0IHJ1bm5lciBmYWlscyBpZiBhIHRlc3QgY2FzZSBoYXMgbm8gdGVzdHMuICcgKwogICAgICAgICdUbyBtb2RpZnkgdGhpcyBiZWhhdmlvciwgc2VlIGdvb2cudGVzdGluZy5UZXN0UnVubmVyXCdzICcgKwogICAgICAgICdzZXRTdHJpY3QoKSBtZXRob2QsIG9yIEdfdGVzdFJ1bm5lci5zZXRTdHJpY3QoKScpOwogIH0KCiAgdGhpcy50ZXN0Q2FzZS5zZXRDb21wbGV0ZWRDYWxsYmFjayhnb29nLmJpbmQodGhpcy5vbkNvbXBsZXRlXywgdGhpcykpOwogIHRoaXMudGVzdENhc2UucnVuVGVzdHMoKTsKfTsKCgovKioKICogV3JpdGVzIHRoZSByZXN1bHRzIHRvIHRoZSBkb2N1bWVudCB3aGVuIHRoZSB0ZXN0IGNhc2UgY29tcGxldGVzLgogKiBAcHJpdmF0ZQogKi8KZ29vZy50ZXN0aW5nLlRlc3RSdW5uZXIucHJvdG90eXBlLm9uQ29tcGxldGVfID0gZnVuY3Rpb24oKSB7CiAgdmFyIGxvZyA9IHRoaXMudGVzdENhc2UuZ2V0UmVwb3J0KHRydWUpOwogIGlmICh0aGlzLmVycm9ycy5sZW5ndGggPiAwKSB7CiAgICBsb2cgKz0gJ1xuJyArIHRoaXMuZXJyb3JzLmpvaW4oJ1xuJyk7CiAgfQoKICBpZiAoIXRoaXMubG9nRWxfKSB7CiAgICB2YXIgZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2xvc3VyZVRlc3RSdW5uZXJMb2cnKTsKICAgIGlmIChlbCA9PSBudWxsKSB7CiAgICAgIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZWwpOwogICAgfQogICAgdGhpcy5sb2dFbF8gPSBlbDsKICB9CgogIC8vIEhpZ2hsaWdodCB0aGUgcGFnZSB0byBpbmRpY2F0ZSB0aGUgb3ZlcmFsbCBvdXRjb21lLgogIHRoaXMud3JpdGVMb2cobG9nKTsKCiAgLy8gVE9ETyhjaHJpc2hlbnJ5KTogTWFrZSB0aGlzIHdvcmsgd2l0aCBtdWx0aXBsZSB0ZXN0IGNhc2VzIChiLzg2MDM2MzgpLgogIHZhciBydW5BZ2FpbkxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7CiAgcnVuQWdhaW5MaW5rLnN0eWxlLmRpc3BsYXkgPSAnaW5saW5lLWJsb2NrJzsKICBydW5BZ2Fpbkxpbmsuc3R5bGUuZm9udFNpemUgPSAnc21hbGwnOwogIHJ1bkFnYWluTGluay5zdHlsZS5tYXJnaW5Cb3R0b20gPSAnMTZweCc7CiAgcnVuQWdhaW5MaW5rLmhyZWYgPSAnJzsKICBydW5BZ2Fpbkxpbmsub25jbGljayA9IGdvb2cuYmluZChmdW5jdGlvbigpIHsKICAgIHRoaXMuZXhlY3V0ZSgpOwogICAgcmV0dXJuIGZhbHNlOwogIH0sIHRoaXMpOwogIHJ1bkFnYWluTGluay5pbm5lckhUTUwgPSAnUnVuIGFnYWluIHdpdGhvdXQgcmVsb2FkaW5nJzsKICB0aGlzLmxvZ0VsXy5hcHBlbmRDaGlsZChydW5BZ2FpbkxpbmspOwp9OwoKCi8qKgogKiBXcml0ZXMgYSBuaWNlbHkgZm9ybWF0dGVkIGxvZyBvdXQgdG8gdGhlIGRvY3VtZW50LgogKiBAcGFyYW0ge3N0cmluZ30gbG9nIFRoZSBzdHJpbmcgdG8gd3JpdGUuCiAqLwpnb29nLnRlc3RpbmcuVGVzdFJ1bm5lci5wcm90b3R5cGUud3JpdGVMb2cgPSBmdW5jdGlvbihsb2cpIHsKICB2YXIgbGluZXMgPSBsb2cuc3BsaXQoJ1xuJyk7CiAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaW5lcy5sZW5ndGg7IGkrKykgewogICAgdmFyIGxpbmUgPSBsaW5lc1tpXTsKICAgIHZhciBjb2xvcjsKICAgIHZhciBpc0ZhaWxPckVycm9yID0gL0ZBSUxFRC8udGVzdChsaW5lKSB8fCAvRVJST1IvLnRlc3QobGluZSk7CiAgICBpZiAoL1BBU1NFRC8udGVzdChsaW5lKSkgewogICAgICBjb2xvciA9ICdkYXJrZ3JlZW4nOwogICAgfSBlbHNlIGlmIChpc0ZhaWxPckVycm9yKSB7CiAgICAgIGNvbG9yID0gJ2RhcmtyZWQnOwogICAgfSBlbHNlIHsKICAgICAgY29sb3IgPSAnIzMzMyc7CiAgICB9CiAgICB2YXIgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICBpZiAobGluZS5zdWJzdHIoMCwgMikgPT0gJz4gJykgewogICAgICAvLyBUaGUgc3RhY2sgdHJhY2UgbWF5IGNvbnRhaW4gbGlua3Mgc28gaXQgaGFzIHRvIGJlIGludGVycHJldGVkIGFzIEhUTUwuCiAgICAgIGRpdi5pbm5lckhUTUwgPSBsaW5lOwogICAgfSBlbHNlIHsKICAgICAgZGl2LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGxpbmUpKTsKICAgIH0KCiAgICB2YXIgdGVzdE5hbWVNYXRjaCA9CiAgICAgICAgLyhcUyspIChcW1teXF1dKl0gKT86IChGQUlMRUR8RVJST1J8UEFTU0VEKS8uZXhlYyhsaW5lKTsKICAgIGlmICh0ZXN0TmFtZU1hdGNoKSB7CiAgICAgIC8vIEJ1aWxkIGEgVVJMIHRvIHJ1biB0aGUgdGVzdCBpbmRpdmlkdWFsbHkuICBJZiB0aGlzIHRlc3Qgd2FzIGFscmVhZHkKICAgICAgLy8gcGFydCBvZiBhbm90aGVyIHN1YnNldCB0ZXN0LCB3ZSBuZWVkIHRvIG92ZXJ3cml0ZSB0aGUgb2xkIHJ1blRlc3RzCiAgICAgIC8vIHF1ZXJ5IHBhcmFtZXRlci4gIFdlIGFsc28gbmVlZCB0byBkbyB0aGlzIHdpdGhvdXQgYnJpbmdpbmcgaW4gYW55CiAgICAgIC8vIGV4dHJhIGRlcGVuZGVuY2llcywgb3RoZXJ3aXNlIHdlIGNvdWxkIG1hc2sgbWlzc2luZyBkZXBlbmRlbmN5IGJ1Z3MuCiAgICAgIHZhciBuZXdTZWFyY2ggPSAncnVuVGVzdHM9JyArIHRlc3ROYW1lTWF0Y2hbMV07CiAgICAgIHZhciBzZWFyY2ggPSB3aW5kb3cubG9jYXRpb24uc2VhcmNoOwogICAgICBpZiAoc2VhcmNoKSB7CiAgICAgICAgdmFyIG9sZFRlc3RzID0gL3J1blRlc3RzPShbXiZdKikvLmV4ZWMoc2VhcmNoKTsKICAgICAgICBpZiAob2xkVGVzdHMpIHsKICAgICAgICAgIG5ld1NlYXJjaCA9IHNlYXJjaC5zdWJzdHIoMCwgb2xkVGVzdHMuaW5kZXgpICsKICAgICAgICAgICAgICAgICAgICAgIG5ld1NlYXJjaCArCiAgICAgICAgICAgICAgICAgICAgICBzZWFyY2guc3Vic3RyKG9sZFRlc3RzLmluZGV4ICsgb2xkVGVzdHNbMF0ubGVuZ3RoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbmV3U2VhcmNoID0gc2VhcmNoICsgJyYnICsgbmV3U2VhcmNoOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBuZXdTZWFyY2ggPSAnPycgKyBuZXdTZWFyY2g7CiAgICAgIH0KICAgICAgdmFyIGhyZWYgPSB3aW5kb3cubG9jYXRpb24uaHJlZjsKICAgICAgdmFyIGhhc2ggPSB3aW5kb3cubG9jYXRpb24uaGFzaDsKICAgICAgaWYgKGhhc2ggJiYgaGFzaC5jaGFyQXQoMCkgIT0gJyMnKSB7CiAgICAgICAgaGFzaCA9ICcjJyArIGhhc2g7CiAgICAgIH0KICAgICAgaHJlZiA9IGhyZWYuc3BsaXQoJyMnKVswXS5zcGxpdCgnPycpWzBdICsgbmV3U2VhcmNoICsgaGFzaDsKCiAgICAgIC8vIEFkZCB0aGUgbGluay4KICAgICAgdmFyIGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdBJyk7CiAgICAgIGEuaW5uZXJIVE1MID0gJyhydW4gaW5kaXZpZHVhbGx5KSc7CiAgICAgIGEuc3R5bGUuZm9udFNpemUgPSAnMC44ZW0nOwogICAgICBhLnN0eWxlLmNvbG9yID0gJyM4ODgnOwogICAgICBhLmhyZWYgPSBocmVmOwogICAgICBkaXYuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJyAnKSk7CiAgICAgIGRpdi5hcHBlbmRDaGlsZChhKTsKICAgIH0KCiAgICBkaXYuc3R5bGUuY29sb3IgPSBjb2xvcjsKICAgIGRpdi5zdHlsZS5mb250ID0gJ25vcm1hbCAxMDAlIG1vbm9zcGFjZSc7CiAgICBkaXYuc3R5bGUud29yZFdyYXAgPSAnYnJlYWstd29yZCc7CiAgICBpZiAoaSA9PSAwKSB7CiAgICAgIC8vIEhpZ2hsaWdodCB0aGUgZmlyc3QgbGluZSBhcyBhIGhlYWRlciB0aGF0IGluZGljYXRlcyB0aGUgdGVzdCBvdXRjb21lLgogICAgICBkaXYuc3R5bGUucGFkZGluZyA9ICcyMHB4JzsKICAgICAgZGl2LnN0eWxlLm1hcmdpbkJvdHRvbSA9ICcxMHB4JzsKICAgICAgaWYgKGlzRmFpbE9yRXJyb3IpIHsKICAgICAgICBkaXYuc3R5bGUuYm9yZGVyID0gJzVweCBzb2xpZCAnICsgY29sb3I7CiAgICAgICAgZGl2LnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICcjZmZlZWVlJzsKICAgICAgfSBlbHNlIHsKICAgICAgICBkaXYuc3R5bGUuYm9yZGVyID0gJzFweCBzb2xpZCBibGFjayc7CiAgICAgICAgZGl2LnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICcjZWVmZmVlJzsKICAgICAgfQogICAgfQoKICAgIHRyeSB7CiAgICAgIGRpdi5zdHlsZS53aGl0ZVNwYWNlID0gJ3ByZS13cmFwJzsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgLy8gTk9URShicmVubmVtYW4pOiBJRSByYWlzZXMgYW4gZXhjZXB0aW9uIHdoZW4gYXNzaWduaW5nIHRvIHByZS13cmFwLgogICAgICAvLyBUaGFua2Z1bGx5LCBpdCBkb2Vzbid0IGNvbGxhcHNlIHdoaXRlc3BhY2Ugd2hlbiB1c2luZyBtb25vc3BhY2UgZm9udHMsCiAgICAgIC8vIHNvIGl0IHdpbGwgZGlzcGxheSBjb3JyZWN0bHkgaWYgd2UgaWdub3JlIHRoZSBleGNlcHRpb24uCiAgICB9CgogICAgaWYgKGkgPCAyKSB7CiAgICAgIGRpdi5zdHlsZS5mb250V2VpZ2h0ID0gJ2JvbGQnOwogICAgfQogICAgdGhpcy5sb2dFbF8uYXBwZW5kQ2hpbGQoZGl2KTsKICB9Cn07CgoKLyoqCiAqIExvZ3MgYSBtZXNzYWdlIHRvIHRoZSBjdXJyZW50IHRlc3QgY2FzZS4KICogQHBhcmFtIHtzdHJpbmd9IHMgVGhlIHRleHQgdG8gb3V0cHV0IHRvIHRoZSBsb2cuCiAqLwpnb29nLnRlc3RpbmcuVGVzdFJ1bm5lci5wcm90b3R5cGUubG9nID0gZnVuY3Rpb24ocykgewogIGlmICh0aGlzLnRlc3RDYXNlKSB7CiAgICB0aGlzLnRlc3RDYXNlLmxvZyhzKTsKICB9Cn07CgoKLy8gVE9ETyhubmF6ZSk6IFByb3Blcmx5IGhhbmRsZSBzZXJ2aW5nIHRlc3QgcmVzdWx0cyB3aGVuIG11bHRpcGxlIHRlc3QgY2FzZXMKLy8gYXJlIHJ1bi4KLyoqCiAqIEByZXR1cm4ge09iamVjdDxzdHJpbmcsICFBcnJheTxzdHJpbmc+Pn0gQSBtYXAgb2YgdGVzdCBuYW1lcyB0byBhIGxpc3Qgb2YKICogdGVzdCBmYWlsdXJlcyAoaWYgYW55KSB0byBwcm92aWRlIGZvcm1hdHRlZCBkYXRhIGZvciB0aGUgdGVzdCBydW5uZXIuCiAqLwpnb29nLnRlc3RpbmcuVGVzdFJ1bm5lci5wcm90b3R5cGUuZ2V0VGVzdFJlc3VsdHMgPSBmdW5jdGlvbigpIHsKICBpZiAodGhpcy50ZXN0Q2FzZSkgewogICAgcmV0dXJuIHRoaXMudGVzdENhc2UuZ2V0VGVzdFJlc3VsdHMoKTsKICB9CiAgcmV0dXJuIG51bGw7Cn07Cg==",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Thu, 06 Nov 2014 15:37:21 GMT",
                    "Content-Length": "12304",
                    "Date": "Thu, 06 Nov 2014 15:37:42 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}