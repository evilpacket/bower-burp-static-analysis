{
    "url": "http://localhost:9999/sapo/Ink/test/unit/Ink.Dom.Event_1/test.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "DOM data manipulation (DOM-based)",
    "issueType": 5247488,
    "severity": "Information",
    "confidence": "Firm",
    "issueBackground": "DOM-based DOM data manipulation vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this to a data field within the DOM that is used within the visible UI or client-side application logic. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will modify the appearance or behavior of the client-side UI. An attacker may be able to leverage this to perform virtual defacement of the application, or possibly to induce the user to perform unintended actions.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based DOM data manipulation vulnerabilities is not to dynamically write to DOM data fields any data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from being stored. In general, this is best achieved by using a whitelist of permitted values.",
    "issueDetail": "The application may be vulnerable to DOM-based DOM data manipulation. Data is read from <b>location.pathname</b> and written to <b>history.pushState()</b> via the following statement:<ul><li>history.pushState( '' , '' , location.pathname.replace( /_\\d\\/$/ , '_2/' ) );</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/sapo/Ink/test/unit/Ink.Dom.Event_1/test.js",
                "path": "/sapo/Ink/test/unit/Ink.Dom.Event_1/test.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9zYXBvL0luay90ZXN0L3VuaXQvSW5rLkRvbS5FdmVudF8xL3Rlc3QuanMgSFRUUC8xLjENCkhvc3Q6IGxvY2FsaG9zdDo5OTk5DQoNCg==",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMTA4NjENCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IEZyaSwgMDcgTm92IDIwMTQgMDQ6NDc6MzAgR01UDQpMYXN0LU1vZGlmaWVkOiBGcmksIDA3IE5vdiAyMDE0IDA0OjQ3OjE0IEdNVA0KDQpRVW5pdC5jb25maWcudGVzdFRpbWVvdXQgPSA0MDAwOwoKSW5rLnJlcXVpcmVNb2R1bGVzKFsnSW5rLkRvbS5FdmVudF8xJywgJ0luay5Eb20uRWxlbWVudF8xJywgJ0luay5Eb20uU2VsZWN0b3JfMScsICdJbmsuRG9tLkJyb3dzZXJfMSddLCBmdW5jdGlvbiAoSW5rRXZlbnQsIElua0VsZW1lbnQsIFNlbGVjdG9yLCBCcm93c2VyKSB7CiAgICAoZnVuY3Rpb24gKCkgewogICAgICAgIG1vZHVsZSgndGhyb3R0bGUnKTsKCiAgICAgICAgdmFyIHBhc3MgPSBmdW5jdGlvbiAoKSB7IG9rKHRydWUpOyB9OwogICAgICAgIHZhciBmYWlsID0gZnVuY3Rpb24gKCkgeyBvayhmYWxzZSk7IH07CgogICAgICAgIGZ1bmN0aW9uIHRlc3RXaXRoQ2xvY2sobmFtZSwgdGVzdEJhY2spIHsKICAgICAgICAgICAgcmV0dXJuIHRlc3QobmFtZSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIGNsb2NrID0gc2lub24udXNlRmFrZVRpbWVycygpOwogICAgICAgICAgICAgICAgY2xvY2sudGljaygxMDAwKTsKICAgICAgICAgICAgICAgIHRlc3RCYWNrKGNsb2NrKTsKICAgICAgICAgICAgICAgIGNsb2NrLnJlc3RvcmUoKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICB0ZXN0V2l0aENsb2NrKCdEZWxheSBzZWNvbmQgY2FsbCcsIGZ1bmN0aW9uIChjbG9jaykgewogICAgICAgICAgICB2YXIgc3B5ID0gc2lub24uc3B5KCk7CiAgICAgICAgICAgIHZhciB0aHJvdHRsZWRGdW5jID0gSW5rRXZlbnQudGhyb3R0bGUoc3B5LCAxMDApOwoKICAgICAgICAgICAgdGhyb3R0bGVkRnVuYygpOwogICAgICAgICAgICB0aHJvdHRsZWRGdW5jKCk7CiAgICAgICAgICAgIG9rKHNweS5jYWxsZWRPbmNlLCAnZmlyc3QgY2FsbCBjb21lcyBpbW1lZGlhdGVseScpOwogICAgICAgICAgICBjbG9jay50aWNrKDEwMSk7CiAgICAgICAgICAgIG9rKHNweS5jYWxsZWRUd2ljZSwgJ3NlY29uZCBjYWxsIGNvbWVzIGV2ZW50dWFsbHknKTsKICAgICAgICB9KTsKICAgICAgICB0ZXN0V2l0aENsb2NrKCdMaW1pdCBhbW91bnQgb2YgY2FsbHMnLCBmdW5jdGlvbiAoY2xvY2spIHsKICAgICAgICAgICAgdmFyIHNweSA9IHNpbm9uLnNweSgpOwogICAgICAgICAgICB2YXIgdGhyb3R0bGVkRnVuYyA9IElua0V2ZW50LnRocm90dGxlKHNweSwgMTAwKTsKCiAgICAgICAgICAgIC8vIENhbGwgYSBmZXcgdGltZXMsIHdhaXQKICAgICAgICAgICAgdGhyb3R0bGVkRnVuYygpOwogICAgICAgICAgICB0aHJvdHRsZWRGdW5jKCk7CiAgICAgICAgICAgIHRocm90dGxlZEZ1bmMoKTsKICAgICAgICAgICAgdGhyb3R0bGVkRnVuYygpOwogICAgICAgICAgICB0aHJvdHRsZWRGdW5jKCk7CiAgICAgICAgICAgIHRocm90dGxlZEZ1bmMoKTsKICAgICAgICAgICAgY2xvY2sudGljaygxMDEpOwoKICAgICAgICAgICAgb2soc3B5LmNhbGxlZFR3aWNlKTsKICAgICAgICB9KTsKICAgICAgICB0ZXN0V2l0aENsb2NrKCdPcmRlciBvZiBjYWxscycsIGZ1bmN0aW9uIChjbG9jaykgewogICAgICAgICAgICB2YXIgc3B5ID0gc2lub24uc3B5KCk7CiAgICAgICAgICAgIHZhciB0aHJvdHRsZWRGdW5jID0gSW5rRXZlbnQudGhyb3R0bGUoc3B5LCAxMDApOwoKICAgICAgICAgICAgdGhyb3R0bGVkRnVuYygxKTsKICAgICAgICAgICAgdGhyb3R0bGVkRnVuYygxLjIpOyAgLy8gSWdub3JlZAogICAgICAgICAgICB0aHJvdHRsZWRGdW5jKDEuNSk7ICAvLyBJZ25vcmVkCiAgICAgICAgICAgIHRocm90dGxlZEZ1bmMoMik7CiAgICAgICAgICAgIG9rKHNweS5sYXN0Q2FsbC5jYWxsZWRXaXRoKDEpKTsKICAgICAgICAgICAgY2xvY2sudGljaygxMDEpOwogICAgICAgICAgICBvayhzcHkubGFzdENhbGwuY2FsbGVkV2l0aCgyKSk7CgogICAgICAgICAgICB0aHJvdHRsZWRGdW5jKDIuNyk7ICAvLyBJZ25vcmVkCiAgICAgICAgICAgIHRocm90dGxlZEZ1bmMoMi44KTsgIC8vIElnbm9yZWQKICAgICAgICAgICAgdGhyb3R0bGVkRnVuYygyLjkpOyAgLy8gSWdub3JlZAogICAgICAgICAgICB0aHJvdHRsZWRGdW5jKDMpOwogICAgICAgICAgICBjbG9jay50aWNrKDEwMSk7CiAgICAgICAgICAgIG9rKHNweS5sYXN0Q2FsbC5jYWxsZWRXaXRoKDMpKTsKICAgICAgICB9KTsKICAgICAgICB0ZXN0V2l0aENsb2NrKCdDb250ZXh0IGFuZCBhcmd1bWVudHMnLCBmdW5jdGlvbiAoY2xvY2spIHsKICAgICAgICAgICAgSW5rRXZlbnQudGhyb3R0bGUoZnVuY3Rpb24gKGFyZykgewogICAgICAgICAgICAgICAgZXF1YWwoYXJnLCAnYXJnJyk7CiAgICAgICAgICAgICAgICBlcXVhbCh0aGlzLCAndGhpcycpOwogICAgICAgICAgICB9LCAwKS5jYWxsKCd0aGlzJywgJ2FyZycpOwogICAgICAgICAgICBjbG9jay50aWNrKDEwMSk7CiAgICAgICAgfSk7CiAgICAgICAgdGVzdFdpdGhDbG9jaygnU2VwYXJhdGVkIGNhbGxzJywgZnVuY3Rpb24gKGNsb2NrKSB7CiAgICAgICAgICAgIHZhciBzcHkgPSBzaW5vbi5zcHkoKTsKICAgICAgICAgICAgdmFyIGZld1RpbWVzID0gSW5rRXZlbnQudGhyb3R0bGUoc3B5LCAyMCk7CgogICAgICAgICAgICBmZXdUaW1lcygxKTsKICAgICAgICAgICAgY2xvY2sudGljaygyMSk7CiAgICAgICAgICAgIG9rKHNweS5sYXN0Q2FsbC5jYWxsZWRXaXRoKDEpKTsKCiAgICAgICAgICAgIGZld1RpbWVzKDIpOwogICAgICAgICAgICBjbG9jay50aWNrKDIwKTsKICAgICAgICAgICAgb2soc3B5Lmxhc3RDYWxsLmNhbGxlZFdpdGgoMikpOwoKICAgICAgICAgICAgZmV3VGltZXMoMyk7CiAgICAgICAgICAgIGNsb2NrLnRpY2soMjApOwogICAgICAgICAgICBvayhzcHkubGFzdENhbGwuY2FsbGVkV2l0aCgzKSk7CiAgICAgICAgfSk7CgoKICAgICAgICB0ZXN0V2l0aENsb2NrKCdjYWxsZWQgd2l0aCB0aGUgY29ycmVjdCB0aW1pbmcgYmV0d2VlbiBjYWxscycsIGZ1bmN0aW9uIChjbG9jaykgewogICAgICAgICAgICB2YXIgbG9nID0gW107CiAgICAgICAgICAgIHZhciBzcHk7CgogICAgICAgICAgICB2YXIgdGVzdFN0YXJ0ID0gK25ldyBEYXRlKCk7CiAgICAgICAgICAgIHZhciB0aHJvdHRsZWQgPSBJbmtFdmVudC50aHJvdHRsZShzcHkgPSBzaW5vbi5zcHkoZnVuY3Rpb24gKG4pIHsKICAgICAgICAgICAgICAgIGxvZy5wdXNoKCtuZXcgRGF0ZSgpIC0gdGVzdFN0YXJ0KTsKICAgICAgICAgICAgfSksIDIwMCk7CgogICAgICAgICAgICB0aHJvdHRsZWQoMSk7CiAgICAgICAgICAgIHRocm90dGxlZCgnaWdub3JlIG1lJyk7CiAgICAgICAgICAgIHRocm90dGxlZCgyKTsKICAgICAgICAgICAgY2xvY2sudGljayg1MCk7CgogICAgICAgICAgICBjbG9jay50aWNrKDIwMCk7CgogICAgICAgICAgICBvayhzcHkuY2FsbGVkVHdpY2UpOwoKICAgICAgICAgICAgZGVlcEVxdWFsKGxvZywgWzAsIDIwMF0pOwogICAgICAgIH0pOwogICAgfSgpKTsKCiAgICBtb2R1bGUoJ29ic2VydmUnKTsKCiAgICBhc3luY1Rlc3QoJ2Jhc2ljJywgZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBkaXYgPSBJbmtFbGVtZW50LmNyZWF0ZSgnZGl2Jyk7CiAgICAgICAgSW5rRXZlbnQub2JzZXJ2ZShkaXYsICdjbGljaycsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgb2sodHJ1ZSk7CiAgICAgICAgICAgIHN0YXJ0KCk7CiAgICAgICAgfSk7CiAgICAgICAgSW5rRXZlbnQuZmlyZShkaXYsICdjbGljaycpOwogICAgfSk7CgogICAgdGVzdCgncmV0dXJuIHRoZSBoYW5kbGVyJywgZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBoYW5kbGVyID0gZnVuY3Rpb24gKCkge307CiAgICAgICAgdmFyIGNiID0gSW5rRXZlbnQub2JzZXJ2ZShJbmtFbGVtZW50LmNyZWF0ZSgnZGl2JyksICdrZXl1cCcsIGhhbmRsZXIpOwogICAgICAgIGVxdWFsKHR5cGVvZiBjYiwgJ2Z1bmN0aW9uJywgJ3JldHVybmVkIGEgZnVuY3Rpb24nKTsKICAgICAgICBvayhjYiA9PT0gaGFuZGxlciwgJ3JldHVybmVkIHNhbWUgZnVuY3Rpb24nKTsKICAgIH0pOwoKICAgIG1vZHVsZSgnb2JzZXJ2ZU9uY2UnKTsKCiAgICBhc3luY1Rlc3QoJ2ZpcmUgb25seSBvbmNlJywgZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBkaXYgPSBJbmtFbGVtZW50LmNyZWF0ZSgnZGl2Jyk7CiAgICAgICAgSW5rRXZlbnQub2JzZXJ2ZU9uY2UoZGl2LCAnY2xpY2snLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIG9rKHRydWUpOwogICAgICAgICAgICBzdGFydCgpOwogICAgICAgIH0pOwogICAgICAgIGV4cGVjdCgxKTsgIC8vIFRoZSBhYm92ZSBvayh0cnVlKSB3aWxsIGJyZWFrIGlmIGNhbGxlZCBtb3JlIHRoYW4gb25jZS4KICAgICAgICBJbmtFdmVudC5maXJlKGRpdiwgJ2NsaWNrJyk7CiAgICAgICAgSW5rRXZlbnQuZmlyZShkaXYsICdjbGljaycpOwogICAgICAgIElua0V2ZW50LmZpcmUoZGl2LCAnY2xpY2snKTsKICAgICAgICBJbmtFdmVudC5maXJlKGRpdiwgJ2NsaWNrJyk7CiAgICB9KTsKCiAgICB0ZXN0KCdyZXR1cm4gdGhlIGhhbmRsZXInLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGhhbmRsZXIgPSBmdW5jdGlvbiAoKSB7fTsKICAgICAgICB2YXIgY2IgPSBJbmtFdmVudC5vYnNlcnZlT25jZShJbmtFbGVtZW50LmNyZWF0ZSgnZGl2JyksICdrZXl1cCcsIGhhbmRsZXIpOwogICAgICAgIG9rKGNiICE9PSBoYW5kbGVyLCAncmV0dXJuZWQgdGhlIG9uY2VCYWNrJyk7CiAgICAgICAgb2sodHlwZW9mIGNiID09PSAnZnVuY3Rpb24nLCAncmV0dXJuZWQgYSBmdW5jdGlvbicpOwogICAgfSk7CgogICAgKGZ1bmN0aW9uICgpIHsKICAgICAgICAvLyBUT0RPIERSWSB0aGlzCiAgICAgICAgdmFyIGVsZW0sCiAgICAgICAgICAgIGNoaWxkLAogICAgICAgICAgICBncmFuZENoaWxkOwoKICAgICAgICBtb2R1bGUoJ29ic2VydmVEZWxlZ2F0ZWQgZmlyZWQnLCB7CiAgICAgICAgICAgIHNldHVwOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBlbGVtID0gSW5rRWxlbWVudC5jcmVhdGUoJ3VsJyk7CiAgICAgICAgICAgICAgICBjaGlsZCA9IElua0VsZW1lbnQuY3JlYXRlKCdsaScpOwogICAgICAgICAgICAgICAgZ3JhbmRDaGlsZCA9IElua0VsZW1lbnQuY3JlYXRlKCdzcGFuJyk7CiAgICAgICAgICAgICAgICBncmFuZENoaWxkLmNsYXNzTmFtZSA9ICd0aGUtZ3JhbmRjaGlsZCc7CgogICAgICAgICAgICAgICAgZWxlbS5hcHBlbmRDaGlsZChjaGlsZCk7CiAgICAgICAgICAgICAgICBjaGlsZC5hcHBlbmRDaGlsZChncmFuZENoaWxkKTsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZWxlbSk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHRlYXJkb3duOiBmdW5jdGlvbiAoKSB7IGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoZWxlbSk7IH0KICAgICAgICB9KTsKCiAgICAgICAgYXN5bmNUZXN0KCdvYnNlcnZlRGVsZWdhdGVkIGZpcmVkJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBleHBlY3QoMSk7CiAgICAgICAgICAgIElua0V2ZW50Lm9ic2VydmVEZWxlZ2F0ZWQoZWxlbSwgJ2NsaWNrJywgJ2xpJywgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICAgICAgICBvayhJbmtFdmVudC5lbGVtZW50KGV2ZW50KSA9PT0gY2hpbGQsICdJbmtFdmVudC5lbGVtZW50KGV2ZW50KSByZXNvbHZlcyB0byB0aGUgc2VsZWN0ZWQgZWxlbWVudCcpOwogICAgICAgICAgICAgICAgc3RhcnQoICk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgSW5rRXZlbnQuZmlyZShncmFuZENoaWxkLCAnY2xpY2snKTsKICAgICAgICB9KTsKICAgIH0pKCk7CgogICAgKGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgZWxlbSwKICAgICAgICAgICAgY2hpbGQsCiAgICAgICAgICAgIGdyYW5kQ2hpbGQ7CgogICAgICAgIG1vZHVsZSgnb2JzZXJ2ZURlbGVnYXRlZCBub3QgZmlyZWQnICwgewogICAgICAgICAgICBzZXR1cDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgZWxlbSA9IElua0VsZW1lbnQuY3JlYXRlKCd1bCcpOwogICAgICAgICAgICAgICAgY2hpbGQgPSBJbmtFbGVtZW50LmNyZWF0ZSgnbGknKTsKICAgICAgICAgICAgICAgIGdyYW5kQ2hpbGQgPSBJbmtFbGVtZW50LmNyZWF0ZSgnc3BhbicpOwogICAgICAgICAgICAgICAgZ3JhbmRDaGlsZC5jbGFzc05hbWUgPSAndGhlLWdyYW5kY2hpbGQnOwoKICAgICAgICAgICAgICAgIGVsZW0uYXBwZW5kQ2hpbGQoY2hpbGQpOwogICAgICAgICAgICAgICAgY2hpbGQuYXBwZW5kQ2hpbGQoZ3JhbmRDaGlsZCk7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGVsZW0pOwogICAgICAgICAgICB9LAogICAgICAgICAgICB0ZWFyZG93bjogZnVuY3Rpb24gKCkgeyBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGVsZW0pOyB9CiAgICAgICAgfSk7CiAgICAgICAgYXN5bmNUZXN0KCdvYnNlcnZlRGVsZWdhdGVkIG5vdCBmaXJlZCcsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZXhwZWN0KDEpOwogICAgICAgICAgICBJbmtFdmVudC5vYnNlcnZlRGVsZWdhdGVkKGVsZW0sICdjbGljaycsICd1bCcsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgICAgICAgb2soZmFsc2UsICdzaG91bGQgbm90IGZpcmUgZXZlbnQgb24gZGVsZWdhdGlvbiBwYXJlbnQnKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIElua0V2ZW50Lm9ic2VydmUoZWxlbSwgJ2NsaWNrJywgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICAgICAgICBvayh0cnVlLCAnc2hvdWxkIGZpcmUgbm9ybWFsIGV2ZW50Jyk7CiAgICAgICAgICAgICAgICBzdGFydCggKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBJbmtFdmVudC5maXJlKGVsZW0sICdjbGljaycpOwogICAgICAgIH0pOwogICAgfSkoICk7CgogICAgKGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgZWxlbSwKICAgICAgICAgICAgY2hpbGQsCiAgICAgICAgICAgIGdyYW5kQ2hpbGQ7CgogICAgICAgIG1vZHVsZSgnb2JzZXJ2ZURlbGVnYXRlZCBub3QgZmlyZWQnICwgewogICAgICAgICAgICBzZXR1cDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgZWxlbSA9IElua0VsZW1lbnQuY3JlYXRlKCd1bCcpOwogICAgICAgICAgICAgICAgY2hpbGQgPSBJbmtFbGVtZW50LmNyZWF0ZSgnbGknKTsKICAgICAgICAgICAgICAgIGdyYW5kQ2hpbGQgPSBJbmtFbGVtZW50LmNyZWF0ZSgnc3BhbicpOwogICAgICAgICAgICAgICAgZ3JhbmRDaGlsZC5jbGFzc05hbWUgPSAndGhlLWdyYW5kY2hpbGQnOwoKICAgICAgICAgICAgICAgIGVsZW0uYXBwZW5kQ2hpbGQoY2hpbGQpOwogICAgICAgICAgICAgICAgY2hpbGQuYXBwZW5kQ2hpbGQoZ3JhbmRDaGlsZCk7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGVsZW0pOwogICAgICAgICAgICB9LAogICAgICAgICAgICB0ZWFyZG93bjogZnVuY3Rpb24gKCkgeyBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGVsZW0pOyB9CiAgICAgICAgfSk7CgogICAgICAgIHRlc3QoJ29ic2VydmVEZWxlZ2F0ZWQgKyBzb21lIHNlbGVjdG9ycycsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZXhwZWN0KDIpOwogICAgICAgICAgICBzdG9wKDIpOwogICAgICAgICAgICBJbmtFdmVudC5vYnNlcnZlRGVsZWdhdGVkKGVsZW0sICdjbGljaycsICdsaSA+IHNwYW4uY2xhc3NJRG9udEhhdmUnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBvayhmYWxzZSwgJ3Nob3VsZCBub3QgZmluZCB0aGlzIGVsZW1lbnQnKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBJbmtFdmVudC5vYnNlcnZlRGVsZWdhdGVkKGVsZW0sICdjbGljaycsICdsaSA+IHNwYW4nLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBvayh0cnVlLCAnc2VsZWN0ZWQgYnkgdGFnIG5hbWUsIGNvcnJlY3RseScpOwogICAgICAgICAgICAgICAgc3RhcnQoKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBJbmtFdmVudC5vYnNlcnZlRGVsZWdhdGVkKGVsZW0sICdjbGljaycsICdsaSA+IHNwYW4udGhlLWdyYW5kY2hpbGQnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBvayh0cnVlLCAnc2VsZWN0ZWQgYnkgY2xhc3MsIGNvcnJlY3RseScpOwogICAgICAgICAgICAgICAgc3RhcnQoKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBJbmtFdmVudC5maXJlKGdyYW5kQ2hpbGQsICdjbGljaycpOwogICAgICAgIH0pOwogICAgfSgpKTsKCiAgICAoZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBlbGVtLAogICAgICAgICAgICBjaGlsZCwKICAgICAgICAgICAgZ3JhbmRDaGlsZDsKCiAgICAgICAgbW9kdWxlKCdvYnNlcnZlRGVsZWdhdGVkIG9uIG1hbnkgY2hpbGRyZW4nICwgewogICAgICAgICAgICBzZXR1cDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgZWxlbSA9IElua0VsZW1lbnQuY3JlYXRlKCd1bCcpOwogICAgICAgICAgICAgICAgY2hpbGQgPSBJbmtFbGVtZW50LmNyZWF0ZSgnbGknKTsKICAgICAgICAgICAgICAgIGdyYW5kQ2hpbGQgPSBJbmtFbGVtZW50LmNyZWF0ZSgnc3BhbicpOwogICAgICAgICAgICAgICAgZ3JhbmRDaGlsZDIgPSBJbmtFbGVtZW50LmNyZWF0ZSgnc3BhbicpOwogICAgICAgICAgICAgICAgZ3JhbmRDaGlsZDMgPSBJbmtFbGVtZW50LmNyZWF0ZSgnc3BhbicpOwogICAgICAgICAgICAgICAgZ3JhbmRDaGlsZC5jbGFzc05hbWUgPSAndGhlLWdyYW5kY2hpbGQnOwogICAgICAgICAgICAgICAgZ3JhbmRDaGlsZDIuY2xhc3NOYW1lID0gJ3RoZS1ncmFuZGNoaWxkLTInOwogICAgICAgICAgICAgICAgZ3JhbmRDaGlsZDMuY2xhc3NOYW1lID0gJ3RoZS1ncmFuZGNoaWxkLTMnOwoKICAgICAgICAgICAgICAgIGVsZW0uYXBwZW5kQ2hpbGQoY2hpbGQpOwogICAgICAgICAgICAgICAgY2hpbGQuYXBwZW5kQ2hpbGQoZ3JhbmRDaGlsZCk7CiAgICAgICAgICAgICAgICBjaGlsZC5hcHBlbmRDaGlsZChncmFuZENoaWxkMik7CiAgICAgICAgICAgICAgICBjaGlsZC5hcHBlbmRDaGlsZChncmFuZENoaWxkMyk7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGVsZW0pOwogICAgICAgICAgICB9LAogICAgICAgICAgICB0ZWFyZG93bjogZnVuY3Rpb24gKCkgeyBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGVsZW0pOyB9CiAgICAgICAgfSk7CgogICAgICAgIGFzeW5jVGVzdCgnb2JzZXJ2ZURlbGVnYXRlZCBvbiBtYW55IGNoaWxkcmVuJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBleHBlY3QoMSk7CgogICAgICAgICAgICBJbmtFdmVudC5vYnNlcnZlRGVsZWdhdGVkKGVsZW0sICdjbGljaycsICcudGhlLWdyYW5kY2hpbGQnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBvayhmYWxzZSk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgSW5rRXZlbnQub2JzZXJ2ZURlbGVnYXRlZChlbGVtLCAnY2xpY2snLCAnLnRoZS1ncmFuZGNoaWxkLTInLCBmdW5jdGlvbiAoZXYpIHsKICAgICAgICAgICAgICAgIG9rKElua0V2ZW50LmVsZW1lbnQoZXYpID09PSBncmFuZENoaWxkMik7CiAgICAgICAgICAgICAgICBzdGFydCgpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIElua0V2ZW50Lm9ic2VydmVEZWxlZ2F0ZWQoZWxlbSwgJ2NsaWNrJywgJy50aGUtZ3JhbmRjaGlsZC0zJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgb2soZmFsc2UpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIElua0V2ZW50LmZpcmUoZ3JhbmRDaGlsZDIsICdjbGljaycpOwogICAgICAgIH0pOwogICAgfSgpKTsKCiAgICBtb2R1bGUoJ2hhc2hjaGFuZ2UnLCB7CiAgICAgICAgc2V0dXA6IGZ1bmN0aW9uICgpIHsgbG9jYXRpb24uaGFzaCA9ICcnOyB9LAogICAgICAgIHRlYXJkb3duOiBmdW5jdGlvbiAoKSB7IGxvY2F0aW9uLmhhc2ggPSAnJzsgfQogICAgfSk7CgogICAgYXN5bmNUZXN0KCdvYnNlcnZlIGl0JywgZnVuY3Rpb24gKCApIHsKICAgICAgICBpZiAoQnJvd3Nlci5JRSAmJiBwYXJzZUZsb2F0KEJyb3dzZXIudmVyc2lvbikgPCA4KSB7CiAgICAgICAgICAgIG9rKHRydWUsICdza2lwcGVkJyk7CiAgICAgICAgICAgIHN0YXJ0KCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciBjYiA9IElua0V2ZW50Lm9ic2VydmUoIHdpbmRvdyAsICdoYXNoY2hhbmdlJyAsIGZ1bmN0aW9uKCBlICkgewogICAgICAgICAgICBvayh0cnVlLCAnY2FsbGJhY2sgdG8gb25oYXNoY2hhbmdlIGNhbGxlZCcpOwogICAgICAgICAgICBJbmtFdmVudC5zdG9wT2JzZXJ2aW5nKHdpbmRvdywgJ2hhc2hjaGFuZ2UnLCBjYik7CiAgICAgICAgICAgIHN0YXJ0KCk7CiAgICAgICAgfSk7CgogICAgICAgIGxvY2F0aW9uLmhhc2ggPSAnY2hhbmdlZCc7CiAgICB9KTsKCiAgICBtb2R1bGUoJ3B1c2hzdGF0ZScpOwogICAgYXN5bmNUZXN0KCd0ZXN0IHB1c2hTdGF0ZScsIGZ1bmN0aW9uICggKSB7CiAgICAgICAgaWYgKEJyb3dzZXIuSUUgJiYgcGFyc2VGbG9hdChCcm93c2VyLnZlcnNpb24pIDwgMTApIHsKICAgICAgICAgICAgb2sodHJ1ZSwgJ3NraXBwZWQnKTsKICAgICAgICAgICAgc3RhcnQoKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBoaXN0b3J5LnB1c2hTdGF0ZSggJycgLCAnJyAsIGxvY2F0aW9uLnBhdGhuYW1lLnJlcGxhY2UoIC9fXGRcLyQvICwgJ18yLycgKSApOwoKICAgICAgICB2YXIgY2IgPSBJbmtFdmVudC5vYnNlcnZlKCB3aW5kb3cgLCAncG9wc3RhdGUnICwgZnVuY3Rpb24oIGUgKSB7CiAgICAgICAgICAgIG9rKHRydWUpOwogICAgICAgICAgICBJbmtFdmVudC5zdG9wT2JzZXJ2aW5nKHdpbmRvdywgJ3BvcHN0YXRlJywgY2IpOwogICAgICAgICAgICBzdGFydCgpOwogICAgICAgIH0pOwoKICAgICAgICBleHBlY3QoMSk7CiAgICAgICAgaGlzdG9yeS5iYWNrKCApOwogICAgfSk7Cn0pOwoK",
                "body": "UVVuaXQuY29uZmlnLnRlc3RUaW1lb3V0ID0gNDAwMDsKCkluay5yZXF1aXJlTW9kdWxlcyhbJ0luay5Eb20uRXZlbnRfMScsICdJbmsuRG9tLkVsZW1lbnRfMScsICdJbmsuRG9tLlNlbGVjdG9yXzEnLCAnSW5rLkRvbS5Ccm93c2VyXzEnXSwgZnVuY3Rpb24gKElua0V2ZW50LCBJbmtFbGVtZW50LCBTZWxlY3RvciwgQnJvd3NlcikgewogICAgKGZ1bmN0aW9uICgpIHsKICAgICAgICBtb2R1bGUoJ3Rocm90dGxlJyk7CgogICAgICAgIHZhciBwYXNzID0gZnVuY3Rpb24gKCkgeyBvayh0cnVlKTsgfTsKICAgICAgICB2YXIgZmFpbCA9IGZ1bmN0aW9uICgpIHsgb2soZmFsc2UpOyB9OwoKICAgICAgICBmdW5jdGlvbiB0ZXN0V2l0aENsb2NrKG5hbWUsIHRlc3RCYWNrKSB7CiAgICAgICAgICAgIHJldHVybiB0ZXN0KG5hbWUsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBjbG9jayA9IHNpbm9uLnVzZUZha2VUaW1lcnMoKTsKICAgICAgICAgICAgICAgIGNsb2NrLnRpY2soMTAwMCk7CiAgICAgICAgICAgICAgICB0ZXN0QmFjayhjbG9jayk7CiAgICAgICAgICAgICAgICBjbG9jay5yZXN0b3JlKCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgdGVzdFdpdGhDbG9jaygnRGVsYXkgc2Vjb25kIGNhbGwnLCBmdW5jdGlvbiAoY2xvY2spIHsKICAgICAgICAgICAgdmFyIHNweSA9IHNpbm9uLnNweSgpOwogICAgICAgICAgICB2YXIgdGhyb3R0bGVkRnVuYyA9IElua0V2ZW50LnRocm90dGxlKHNweSwgMTAwKTsKCiAgICAgICAgICAgIHRocm90dGxlZEZ1bmMoKTsKICAgICAgICAgICAgdGhyb3R0bGVkRnVuYygpOwogICAgICAgICAgICBvayhzcHkuY2FsbGVkT25jZSwgJ2ZpcnN0IGNhbGwgY29tZXMgaW1tZWRpYXRlbHknKTsKICAgICAgICAgICAgY2xvY2sudGljaygxMDEpOwogICAgICAgICAgICBvayhzcHkuY2FsbGVkVHdpY2UsICdzZWNvbmQgY2FsbCBjb21lcyBldmVudHVhbGx5Jyk7CiAgICAgICAgfSk7CiAgICAgICAgdGVzdFdpdGhDbG9jaygnTGltaXQgYW1vdW50IG9mIGNhbGxzJywgZnVuY3Rpb24gKGNsb2NrKSB7CiAgICAgICAgICAgIHZhciBzcHkgPSBzaW5vbi5zcHkoKTsKICAgICAgICAgICAgdmFyIHRocm90dGxlZEZ1bmMgPSBJbmtFdmVudC50aHJvdHRsZShzcHksIDEwMCk7CgogICAgICAgICAgICAvLyBDYWxsIGEgZmV3IHRpbWVzLCB3YWl0CiAgICAgICAgICAgIHRocm90dGxlZEZ1bmMoKTsKICAgICAgICAgICAgdGhyb3R0bGVkRnVuYygpOwogICAgICAgICAgICB0aHJvdHRsZWRGdW5jKCk7CiAgICAgICAgICAgIHRocm90dGxlZEZ1bmMoKTsKICAgICAgICAgICAgdGhyb3R0bGVkRnVuYygpOwogICAgICAgICAgICB0aHJvdHRsZWRGdW5jKCk7CiAgICAgICAgICAgIGNsb2NrLnRpY2soMTAxKTsKCiAgICAgICAgICAgIG9rKHNweS5jYWxsZWRUd2ljZSk7CiAgICAgICAgfSk7CiAgICAgICAgdGVzdFdpdGhDbG9jaygnT3JkZXIgb2YgY2FsbHMnLCBmdW5jdGlvbiAoY2xvY2spIHsKICAgICAgICAgICAgdmFyIHNweSA9IHNpbm9uLnNweSgpOwogICAgICAgICAgICB2YXIgdGhyb3R0bGVkRnVuYyA9IElua0V2ZW50LnRocm90dGxlKHNweSwgMTAwKTsKCiAgICAgICAgICAgIHRocm90dGxlZEZ1bmMoMSk7CiAgICAgICAgICAgIHRocm90dGxlZEZ1bmMoMS4yKTsgIC8vIElnbm9yZWQKICAgICAgICAgICAgdGhyb3R0bGVkRnVuYygxLjUpOyAgLy8gSWdub3JlZAogICAgICAgICAgICB0aHJvdHRsZWRGdW5jKDIpOwogICAgICAgICAgICBvayhzcHkubGFzdENhbGwuY2FsbGVkV2l0aCgxKSk7CiAgICAgICAgICAgIGNsb2NrLnRpY2soMTAxKTsKICAgICAgICAgICAgb2soc3B5Lmxhc3RDYWxsLmNhbGxlZFdpdGgoMikpOwoKICAgICAgICAgICAgdGhyb3R0bGVkRnVuYygyLjcpOyAgLy8gSWdub3JlZAogICAgICAgICAgICB0aHJvdHRsZWRGdW5jKDIuOCk7ICAvLyBJZ25vcmVkCiAgICAgICAgICAgIHRocm90dGxlZEZ1bmMoMi45KTsgIC8vIElnbm9yZWQKICAgICAgICAgICAgdGhyb3R0bGVkRnVuYygzKTsKICAgICAgICAgICAgY2xvY2sudGljaygxMDEpOwogICAgICAgICAgICBvayhzcHkubGFzdENhbGwuY2FsbGVkV2l0aCgzKSk7CiAgICAgICAgfSk7CiAgICAgICAgdGVzdFdpdGhDbG9jaygnQ29udGV4dCBhbmQgYXJndW1lbnRzJywgZnVuY3Rpb24gKGNsb2NrKSB7CiAgICAgICAgICAgIElua0V2ZW50LnRocm90dGxlKGZ1bmN0aW9uIChhcmcpIHsKICAgICAgICAgICAgICAgIGVxdWFsKGFyZywgJ2FyZycpOwogICAgICAgICAgICAgICAgZXF1YWwodGhpcywgJ3RoaXMnKTsKICAgICAgICAgICAgfSwgMCkuY2FsbCgndGhpcycsICdhcmcnKTsKICAgICAgICAgICAgY2xvY2sudGljaygxMDEpOwogICAgICAgIH0pOwogICAgICAgIHRlc3RXaXRoQ2xvY2soJ1NlcGFyYXRlZCBjYWxscycsIGZ1bmN0aW9uIChjbG9jaykgewogICAgICAgICAgICB2YXIgc3B5ID0gc2lub24uc3B5KCk7CiAgICAgICAgICAgIHZhciBmZXdUaW1lcyA9IElua0V2ZW50LnRocm90dGxlKHNweSwgMjApOwoKICAgICAgICAgICAgZmV3VGltZXMoMSk7CiAgICAgICAgICAgIGNsb2NrLnRpY2soMjEpOwogICAgICAgICAgICBvayhzcHkubGFzdENhbGwuY2FsbGVkV2l0aCgxKSk7CgogICAgICAgICAgICBmZXdUaW1lcygyKTsKICAgICAgICAgICAgY2xvY2sudGljaygyMCk7CiAgICAgICAgICAgIG9rKHNweS5sYXN0Q2FsbC5jYWxsZWRXaXRoKDIpKTsKCiAgICAgICAgICAgIGZld1RpbWVzKDMpOwogICAgICAgICAgICBjbG9jay50aWNrKDIwKTsKICAgICAgICAgICAgb2soc3B5Lmxhc3RDYWxsLmNhbGxlZFdpdGgoMykpOwogICAgICAgIH0pOwoKCiAgICAgICAgdGVzdFdpdGhDbG9jaygnY2FsbGVkIHdpdGggdGhlIGNvcnJlY3QgdGltaW5nIGJldHdlZW4gY2FsbHMnLCBmdW5jdGlvbiAoY2xvY2spIHsKICAgICAgICAgICAgdmFyIGxvZyA9IFtdOwogICAgICAgICAgICB2YXIgc3B5OwoKICAgICAgICAgICAgdmFyIHRlc3RTdGFydCA9ICtuZXcgRGF0ZSgpOwogICAgICAgICAgICB2YXIgdGhyb3R0bGVkID0gSW5rRXZlbnQudGhyb3R0bGUoc3B5ID0gc2lub24uc3B5KGZ1bmN0aW9uIChuKSB7CiAgICAgICAgICAgICAgICBsb2cucHVzaCgrbmV3IERhdGUoKSAtIHRlc3RTdGFydCk7CiAgICAgICAgICAgIH0pLCAyMDApOwoKICAgICAgICAgICAgdGhyb3R0bGVkKDEpOwogICAgICAgICAgICB0aHJvdHRsZWQoJ2lnbm9yZSBtZScpOwogICAgICAgICAgICB0aHJvdHRsZWQoMik7CiAgICAgICAgICAgIGNsb2NrLnRpY2soNTApOwoKICAgICAgICAgICAgY2xvY2sudGljaygyMDApOwoKICAgICAgICAgICAgb2soc3B5LmNhbGxlZFR3aWNlKTsKCiAgICAgICAgICAgIGRlZXBFcXVhbChsb2csIFswLCAyMDBdKTsKICAgICAgICB9KTsKICAgIH0oKSk7CgogICAgbW9kdWxlKCdvYnNlcnZlJyk7CgogICAgYXN5bmNUZXN0KCdiYXNpYycsIGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgZGl2ID0gSW5rRWxlbWVudC5jcmVhdGUoJ2RpdicpOwogICAgICAgIElua0V2ZW50Lm9ic2VydmUoZGl2LCAnY2xpY2snLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIG9rKHRydWUpOwogICAgICAgICAgICBzdGFydCgpOwogICAgICAgIH0pOwogICAgICAgIElua0V2ZW50LmZpcmUoZGl2LCAnY2xpY2snKTsKICAgIH0pOwoKICAgIHRlc3QoJ3JldHVybiB0aGUgaGFuZGxlcicsIGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgaGFuZGxlciA9IGZ1bmN0aW9uICgpIHt9OwogICAgICAgIHZhciBjYiA9IElua0V2ZW50Lm9ic2VydmUoSW5rRWxlbWVudC5jcmVhdGUoJ2RpdicpLCAna2V5dXAnLCBoYW5kbGVyKTsKICAgICAgICBlcXVhbCh0eXBlb2YgY2IsICdmdW5jdGlvbicsICdyZXR1cm5lZCBhIGZ1bmN0aW9uJyk7CiAgICAgICAgb2soY2IgPT09IGhhbmRsZXIsICdyZXR1cm5lZCBzYW1lIGZ1bmN0aW9uJyk7CiAgICB9KTsKCiAgICBtb2R1bGUoJ29ic2VydmVPbmNlJyk7CgogICAgYXN5bmNUZXN0KCdmaXJlIG9ubHkgb25jZScsIGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgZGl2ID0gSW5rRWxlbWVudC5jcmVhdGUoJ2RpdicpOwogICAgICAgIElua0V2ZW50Lm9ic2VydmVPbmNlKGRpdiwgJ2NsaWNrJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBvayh0cnVlKTsKICAgICAgICAgICAgc3RhcnQoKTsKICAgICAgICB9KTsKICAgICAgICBleHBlY3QoMSk7ICAvLyBUaGUgYWJvdmUgb2sodHJ1ZSkgd2lsbCBicmVhayBpZiBjYWxsZWQgbW9yZSB0aGFuIG9uY2UuCiAgICAgICAgSW5rRXZlbnQuZmlyZShkaXYsICdjbGljaycpOwogICAgICAgIElua0V2ZW50LmZpcmUoZGl2LCAnY2xpY2snKTsKICAgICAgICBJbmtFdmVudC5maXJlKGRpdiwgJ2NsaWNrJyk7CiAgICAgICAgSW5rRXZlbnQuZmlyZShkaXYsICdjbGljaycpOwogICAgfSk7CgogICAgdGVzdCgncmV0dXJuIHRoZSBoYW5kbGVyJywgZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBoYW5kbGVyID0gZnVuY3Rpb24gKCkge307CiAgICAgICAgdmFyIGNiID0gSW5rRXZlbnQub2JzZXJ2ZU9uY2UoSW5rRWxlbWVudC5jcmVhdGUoJ2RpdicpLCAna2V5dXAnLCBoYW5kbGVyKTsKICAgICAgICBvayhjYiAhPT0gaGFuZGxlciwgJ3JldHVybmVkIHRoZSBvbmNlQmFjaycpOwogICAgICAgIG9rKHR5cGVvZiBjYiA9PT0gJ2Z1bmN0aW9uJywgJ3JldHVybmVkIGEgZnVuY3Rpb24nKTsKICAgIH0pOwoKICAgIChmdW5jdGlvbiAoKSB7CiAgICAgICAgLy8gVE9ETyBEUlkgdGhpcwogICAgICAgIHZhciBlbGVtLAogICAgICAgICAgICBjaGlsZCwKICAgICAgICAgICAgZ3JhbmRDaGlsZDsKCiAgICAgICAgbW9kdWxlKCdvYnNlcnZlRGVsZWdhdGVkIGZpcmVkJywgewogICAgICAgICAgICBzZXR1cDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgZWxlbSA9IElua0VsZW1lbnQuY3JlYXRlKCd1bCcpOwogICAgICAgICAgICAgICAgY2hpbGQgPSBJbmtFbGVtZW50LmNyZWF0ZSgnbGknKTsKICAgICAgICAgICAgICAgIGdyYW5kQ2hpbGQgPSBJbmtFbGVtZW50LmNyZWF0ZSgnc3BhbicpOwogICAgICAgICAgICAgICAgZ3JhbmRDaGlsZC5jbGFzc05hbWUgPSAndGhlLWdyYW5kY2hpbGQnOwoKICAgICAgICAgICAgICAgIGVsZW0uYXBwZW5kQ2hpbGQoY2hpbGQpOwogICAgICAgICAgICAgICAgY2hpbGQuYXBwZW5kQ2hpbGQoZ3JhbmRDaGlsZCk7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGVsZW0pOwogICAgICAgICAgICB9LAogICAgICAgICAgICB0ZWFyZG93bjogZnVuY3Rpb24gKCkgeyBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGVsZW0pOyB9CiAgICAgICAgfSk7CgogICAgICAgIGFzeW5jVGVzdCgnb2JzZXJ2ZURlbGVnYXRlZCBmaXJlZCcsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZXhwZWN0KDEpOwogICAgICAgICAgICBJbmtFdmVudC5vYnNlcnZlRGVsZWdhdGVkKGVsZW0sICdjbGljaycsICdsaScsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgICAgICAgb2soSW5rRXZlbnQuZWxlbWVudChldmVudCkgPT09IGNoaWxkLCAnSW5rRXZlbnQuZWxlbWVudChldmVudCkgcmVzb2x2ZXMgdG8gdGhlIHNlbGVjdGVkIGVsZW1lbnQnKTsKICAgICAgICAgICAgICAgIHN0YXJ0KCApOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIElua0V2ZW50LmZpcmUoZ3JhbmRDaGlsZCwgJ2NsaWNrJyk7CiAgICAgICAgfSk7CiAgICB9KSgpOwoKICAgIChmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGVsZW0sCiAgICAgICAgICAgIGNoaWxkLAogICAgICAgICAgICBncmFuZENoaWxkOwoKICAgICAgICBtb2R1bGUoJ29ic2VydmVEZWxlZ2F0ZWQgbm90IGZpcmVkJyAsIHsKICAgICAgICAgICAgc2V0dXA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGVsZW0gPSBJbmtFbGVtZW50LmNyZWF0ZSgndWwnKTsKICAgICAgICAgICAgICAgIGNoaWxkID0gSW5rRWxlbWVudC5jcmVhdGUoJ2xpJyk7CiAgICAgICAgICAgICAgICBncmFuZENoaWxkID0gSW5rRWxlbWVudC5jcmVhdGUoJ3NwYW4nKTsKICAgICAgICAgICAgICAgIGdyYW5kQ2hpbGQuY2xhc3NOYW1lID0gJ3RoZS1ncmFuZGNoaWxkJzsKCiAgICAgICAgICAgICAgICBlbGVtLmFwcGVuZENoaWxkKGNoaWxkKTsKICAgICAgICAgICAgICAgIGNoaWxkLmFwcGVuZENoaWxkKGdyYW5kQ2hpbGQpOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChlbGVtKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgdGVhcmRvd246IGZ1bmN0aW9uICgpIHsgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChlbGVtKTsgfQogICAgICAgIH0pOwogICAgICAgIGFzeW5jVGVzdCgnb2JzZXJ2ZURlbGVnYXRlZCBub3QgZmlyZWQnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGV4cGVjdCgxKTsKICAgICAgICAgICAgSW5rRXZlbnQub2JzZXJ2ZURlbGVnYXRlZChlbGVtLCAnY2xpY2snLCAndWwnLCBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgICAgICAgIG9rKGZhbHNlLCAnc2hvdWxkIG5vdCBmaXJlIGV2ZW50IG9uIGRlbGVnYXRpb24gcGFyZW50Jyk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBJbmtFdmVudC5vYnNlcnZlKGVsZW0sICdjbGljaycsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgICAgICAgb2sodHJ1ZSwgJ3Nob3VsZCBmaXJlIG5vcm1hbCBldmVudCcpOwogICAgICAgICAgICAgICAgc3RhcnQoICk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgSW5rRXZlbnQuZmlyZShlbGVtLCAnY2xpY2snKTsKICAgICAgICB9KTsKICAgIH0pKCApOwoKICAgIChmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGVsZW0sCiAgICAgICAgICAgIGNoaWxkLAogICAgICAgICAgICBncmFuZENoaWxkOwoKICAgICAgICBtb2R1bGUoJ29ic2VydmVEZWxlZ2F0ZWQgbm90IGZpcmVkJyAsIHsKICAgICAgICAgICAgc2V0dXA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGVsZW0gPSBJbmtFbGVtZW50LmNyZWF0ZSgndWwnKTsKICAgICAgICAgICAgICAgIGNoaWxkID0gSW5rRWxlbWVudC5jcmVhdGUoJ2xpJyk7CiAgICAgICAgICAgICAgICBncmFuZENoaWxkID0gSW5rRWxlbWVudC5jcmVhdGUoJ3NwYW4nKTsKICAgICAgICAgICAgICAgIGdyYW5kQ2hpbGQuY2xhc3NOYW1lID0gJ3RoZS1ncmFuZGNoaWxkJzsKCiAgICAgICAgICAgICAgICBlbGVtLmFwcGVuZENoaWxkKGNoaWxkKTsKICAgICAgICAgICAgICAgIGNoaWxkLmFwcGVuZENoaWxkKGdyYW5kQ2hpbGQpOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChlbGVtKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgdGVhcmRvd246IGZ1bmN0aW9uICgpIHsgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChlbGVtKTsgfQogICAgICAgIH0pOwoKICAgICAgICB0ZXN0KCdvYnNlcnZlRGVsZWdhdGVkICsgc29tZSBzZWxlY3RvcnMnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGV4cGVjdCgyKTsKICAgICAgICAgICAgc3RvcCgyKTsKICAgICAgICAgICAgSW5rRXZlbnQub2JzZXJ2ZURlbGVnYXRlZChlbGVtLCAnY2xpY2snLCAnbGkgPiBzcGFuLmNsYXNzSURvbnRIYXZlJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgb2soZmFsc2UsICdzaG91bGQgbm90IGZpbmQgdGhpcyBlbGVtZW50Jyk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgSW5rRXZlbnQub2JzZXJ2ZURlbGVnYXRlZChlbGVtLCAnY2xpY2snLCAnbGkgPiBzcGFuJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgb2sodHJ1ZSwgJ3NlbGVjdGVkIGJ5IHRhZyBuYW1lLCBjb3JyZWN0bHknKTsKICAgICAgICAgICAgICAgIHN0YXJ0KCk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgSW5rRXZlbnQub2JzZXJ2ZURlbGVnYXRlZChlbGVtLCAnY2xpY2snLCAnbGkgPiBzcGFuLnRoZS1ncmFuZGNoaWxkJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgb2sodHJ1ZSwgJ3NlbGVjdGVkIGJ5IGNsYXNzLCBjb3JyZWN0bHknKTsKICAgICAgICAgICAgICAgIHN0YXJ0KCk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgSW5rRXZlbnQuZmlyZShncmFuZENoaWxkLCAnY2xpY2snKTsKICAgICAgICB9KTsKICAgIH0oKSk7CgogICAgKGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgZWxlbSwKICAgICAgICAgICAgY2hpbGQsCiAgICAgICAgICAgIGdyYW5kQ2hpbGQ7CgogICAgICAgIG1vZHVsZSgnb2JzZXJ2ZURlbGVnYXRlZCBvbiBtYW55IGNoaWxkcmVuJyAsIHsKICAgICAgICAgICAgc2V0dXA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGVsZW0gPSBJbmtFbGVtZW50LmNyZWF0ZSgndWwnKTsKICAgICAgICAgICAgICAgIGNoaWxkID0gSW5rRWxlbWVudC5jcmVhdGUoJ2xpJyk7CiAgICAgICAgICAgICAgICBncmFuZENoaWxkID0gSW5rRWxlbWVudC5jcmVhdGUoJ3NwYW4nKTsKICAgICAgICAgICAgICAgIGdyYW5kQ2hpbGQyID0gSW5rRWxlbWVudC5jcmVhdGUoJ3NwYW4nKTsKICAgICAgICAgICAgICAgIGdyYW5kQ2hpbGQzID0gSW5rRWxlbWVudC5jcmVhdGUoJ3NwYW4nKTsKICAgICAgICAgICAgICAgIGdyYW5kQ2hpbGQuY2xhc3NOYW1lID0gJ3RoZS1ncmFuZGNoaWxkJzsKICAgICAgICAgICAgICAgIGdyYW5kQ2hpbGQyLmNsYXNzTmFtZSA9ICd0aGUtZ3JhbmRjaGlsZC0yJzsKICAgICAgICAgICAgICAgIGdyYW5kQ2hpbGQzLmNsYXNzTmFtZSA9ICd0aGUtZ3JhbmRjaGlsZC0zJzsKCiAgICAgICAgICAgICAgICBlbGVtLmFwcGVuZENoaWxkKGNoaWxkKTsKICAgICAgICAgICAgICAgIGNoaWxkLmFwcGVuZENoaWxkKGdyYW5kQ2hpbGQpOwogICAgICAgICAgICAgICAgY2hpbGQuYXBwZW5kQ2hpbGQoZ3JhbmRDaGlsZDIpOwogICAgICAgICAgICAgICAgY2hpbGQuYXBwZW5kQ2hpbGQoZ3JhbmRDaGlsZDMpOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChlbGVtKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgdGVhcmRvd246IGZ1bmN0aW9uICgpIHsgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChlbGVtKTsgfQogICAgICAgIH0pOwoKICAgICAgICBhc3luY1Rlc3QoJ29ic2VydmVEZWxlZ2F0ZWQgb24gbWFueSBjaGlsZHJlbicsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZXhwZWN0KDEpOwoKICAgICAgICAgICAgSW5rRXZlbnQub2JzZXJ2ZURlbGVnYXRlZChlbGVtLCAnY2xpY2snLCAnLnRoZS1ncmFuZGNoaWxkJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgb2soZmFsc2UpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIElua0V2ZW50Lm9ic2VydmVEZWxlZ2F0ZWQoZWxlbSwgJ2NsaWNrJywgJy50aGUtZ3JhbmRjaGlsZC0yJywgZnVuY3Rpb24gKGV2KSB7CiAgICAgICAgICAgICAgICBvayhJbmtFdmVudC5lbGVtZW50KGV2KSA9PT0gZ3JhbmRDaGlsZDIpOwogICAgICAgICAgICAgICAgc3RhcnQoKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBJbmtFdmVudC5vYnNlcnZlRGVsZWdhdGVkKGVsZW0sICdjbGljaycsICcudGhlLWdyYW5kY2hpbGQtMycsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIG9rKGZhbHNlKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBJbmtFdmVudC5maXJlKGdyYW5kQ2hpbGQyLCAnY2xpY2snKTsKICAgICAgICB9KTsKICAgIH0oKSk7CgogICAgbW9kdWxlKCdoYXNoY2hhbmdlJywgewogICAgICAgIHNldHVwOiBmdW5jdGlvbiAoKSB7IGxvY2F0aW9uLmhhc2ggPSAnJzsgfSwKICAgICAgICB0ZWFyZG93bjogZnVuY3Rpb24gKCkgeyBsb2NhdGlvbi5oYXNoID0gJyc7IH0KICAgIH0pOwoKICAgIGFzeW5jVGVzdCgnb2JzZXJ2ZSBpdCcsIGZ1bmN0aW9uICggKSB7CiAgICAgICAgaWYgKEJyb3dzZXIuSUUgJiYgcGFyc2VGbG9hdChCcm93c2VyLnZlcnNpb24pIDwgOCkgewogICAgICAgICAgICBvayh0cnVlLCAnc2tpcHBlZCcpOwogICAgICAgICAgICBzdGFydCgpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2YXIgY2IgPSBJbmtFdmVudC5vYnNlcnZlKCB3aW5kb3cgLCAnaGFzaGNoYW5nZScgLCBmdW5jdGlvbiggZSApIHsKICAgICAgICAgICAgb2sodHJ1ZSwgJ2NhbGxiYWNrIHRvIG9uaGFzaGNoYW5nZSBjYWxsZWQnKTsKICAgICAgICAgICAgSW5rRXZlbnQuc3RvcE9ic2VydmluZyh3aW5kb3csICdoYXNoY2hhbmdlJywgY2IpOwogICAgICAgICAgICBzdGFydCgpOwogICAgICAgIH0pOwoKICAgICAgICBsb2NhdGlvbi5oYXNoID0gJ2NoYW5nZWQnOwogICAgfSk7CgogICAgbW9kdWxlKCdwdXNoc3RhdGUnKTsKICAgIGFzeW5jVGVzdCgndGVzdCBwdXNoU3RhdGUnLCBmdW5jdGlvbiAoICkgewogICAgICAgIGlmIChCcm93c2VyLklFICYmIHBhcnNlRmxvYXQoQnJvd3Nlci52ZXJzaW9uKSA8IDEwKSB7CiAgICAgICAgICAgIG9rKHRydWUsICdza2lwcGVkJyk7CiAgICAgICAgICAgIHN0YXJ0KCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaGlzdG9yeS5wdXNoU3RhdGUoICcnICwgJycgLCBsb2NhdGlvbi5wYXRobmFtZS5yZXBsYWNlKCAvX1xkXC8kLyAsICdfMi8nICkgKTsKCiAgICAgICAgdmFyIGNiID0gSW5rRXZlbnQub2JzZXJ2ZSggd2luZG93ICwgJ3BvcHN0YXRlJyAsIGZ1bmN0aW9uKCBlICkgewogICAgICAgICAgICBvayh0cnVlKTsKICAgICAgICAgICAgSW5rRXZlbnQuc3RvcE9ic2VydmluZyh3aW5kb3csICdwb3BzdGF0ZScsIGNiKTsKICAgICAgICAgICAgc3RhcnQoKTsKICAgICAgICB9KTsKCiAgICAgICAgZXhwZWN0KDEpOwogICAgICAgIGhpc3RvcnkuYmFjayggKTsKICAgIH0pOwp9KTsKCg==",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Fri, 07 Nov 2014 04:47:14 GMT",
                    "Content-Length": "10861",
                    "Date": "Fri, 07 Nov 2014 04:47:30 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}