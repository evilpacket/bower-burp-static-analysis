{
    "url": "http://localhost:9999/nalbion/closure-bootstrap/javascript/bootstrap3/Tabs.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Client-side JSON injection (DOM-based)",
    "issueType": 2098032,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based JSON injection vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and incorporates this into a string that is parsed as a JSON data structure and then processed by the application. An attacker may be able to use this behavior to construct a URL which, if visited by another application user, will cause arbitrary JSON data to be processed. Depending on the purpose for which this data is used, it may be possible to subvert the application's logic, or cause unintended actions on behalf of the user.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based JSON injection vulnerabilities is not to parse as JSON any string containing data that originated from an untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from modifying the JSON structure in inappropriate ways. This may involve strict validation of specific items to ensure they do not contain any characters that may interfere with the structure of the JSON when it is parsed.",
    "issueDetail": "The application may be vulnerable to DOM-based client-side JSON injection. Data is read from <b>window.location.hash</b> and written to <b>JSON.parse()</b> via the following statements:<ul><li>var historyValue = (this.history_ ? this.history_.getToken() : window.location.hash) || {};</li><li>historyValue = JSON.parse(historyValue);</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/nalbion/closure-bootstrap/javascript/bootstrap3/Tabs.js",
                "path": "/nalbion/closure-bootstrap/javascript/bootstrap3/Tabs.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9uYWxiaW9uL2Nsb3N1cmUtYm9vdHN0cmFwL2phdmFzY3JpcHQvYm9vdHN0cmFwMy9UYWJzLmpzIEhUVFAvMS4xDQpIb3N0OiBsb2NhbGhvc3Q6OTk5OQ0KDQo=",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMjA5NzcNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IFRodSwgMDYgTm92IDIwMTQgMTU6MzQ6MjUgR01UDQpMYXN0LU1vZGlmaWVkOiBUaHUsIDA2IE5vdiAyMDE0IDE1OjM0OjIxIEdNVA0KDQpnb29nLnByb3ZpZGUoJ2Jvb3RzdHJhcDMuVGFicycpOwoKZ29vZy5yZXF1aXJlKCdib290c3RyYXAzLlRhYkJhclJlbmRlcmVyJyk7Cmdvb2cucmVxdWlyZSgnYm9vdHN0cmFwMy5UYWJSZW5kZXJlcicpOwpnb29nLnJlcXVpcmUoJ2Jvb3RzdHJhcDMudXRpbHMnKTsKCmdvb2cucmVxdWlyZSgnZ29vZy5kb20nKTsKZ29vZy5yZXF1aXJlKCdnb29nLmV2ZW50cy5FdmVudFRhcmdldCcpOwpnb29nLnJlcXVpcmUoJ2dvb2cudWkuVGFiQmFyJyk7Cmdvb2cucmVxdWlyZSgnZ29vZy5uZXQuWGhySW8nKTsKZ29vZy5yZXF1aXJlKCdnb29nLlVyaScpOwpnb29nLnJlcXVpcmUoJ2dvb2cuSGlzdG9yeScpOwpnb29nLnJlcXVpcmUoJ2dvb2cubmV0LmNvb2tpZXMnKTsKZ29vZy5yZXF1aXJlKCdnb29nLmRlYnVnLkxvZ2dlcicpOwoKLyoqCiAqIEBmaWxlb3ZlcnZpZXcgQmFzZWQgb24gSlF1ZXJ5VGFicywgYnV0IHVzZXMgc3R5bGVzIGZyb20gaHR0cDovL3R3aXR0ZXIuZ2l0aHViLmNvbS9ib290c3RyYXAvY29tcG9uZW50cy5odG1sI25hdnM6CiAqCiAqIDxwcmU+CiAqIAkmbHQ7ZGl2IGlkPSJwcm9maWxlVGFicyI+CiAmbHQ7dWwgY2xhc3M9Im5hdiBuYXYtdGFicyI+CiAmbHQ7bGk+Jmx0O2EgaHJlZj0iI3NlYXJjaFRhYiI+U2VhcmNoPC9hPjwvbGk+CiAmbHQ7bGk+Jmx0O2EgaHJlZj0iYWpheC9zYXZlZF9zZWFyY2guaHRtbCI+U2F2ZWQgUHJvZmlsZSZsdDsvYT48L2xpPgogJmx0O2xpPiZsdDthIGhyZWY9IiNhZGRUYWJUYWIiPkFkZCZsdDsvbGk+CiAmbHQ7L3VsPgogJmx0O2RpdiBpZD0ic2VhcmNoVGFiIj4KICZsdDsvZGl2PgogJmx0O2RpdiBpZD0iYWRkVGFiVGFiIj4KICZsdDsvZGl2PgogJmx0Oy9kaXY+CiA8L3ByZT4KCiBAYXV0aG9yIE5pY2hvbGFzIEFsYmlvbgogKi8KCi8qKgogKiBKUXVlcnlVSS1zdHlsZSB0YWJzIGNvbnRhaW5lciB3aXRoIEJvb3RzdHJhcCBzdHlsaW5nIC0gYmFzZWQgb24gZ29vZy51aS5UYWJQYW5lCiAqCiAqIEBwYXJhbSB7c3RyaW5nPX0gb3B0X2Nvb2tpZU5hbWUgLSBlZzogJ3RhYi1pbmRleCcuIFByb3ZpZGUgYSBuYW1lIGlmIHRoZSBsYXN0IHNlbGVjdGVkIHRhYiBzaG91bGQgYmUgc2F2ZWQgaW4gYSBjb29raWUgYW5kICMKICogQHBhcmFtIHtzdHJpbmc9fSBvcHRfY2xhc3MgJ25hdi1zdGFja2VkJyBvciAnbmF2LWp1c3RpZmllZCcKICogQHBhcmFtIHtnb29nLnVpLkNvbnRhaW5lclJlbmRlcmVyPX0gb3B0X3JlbmRlcmVyIFJlbmRlcmVyIHVzZWQgdG8gcmVuZGVyIG9yCiAqICAgICBkZWNvcmF0ZSB0aGUgY29udGFpbmVyOyBkZWZhdWx0cyB0byB7QGxpbmsgZ29vZy51aS5Db250YWluZXJSZW5kZXJlcn0uCiAqIEBwYXJhbSB7Z29vZy5kb20uRG9tSGVscGVyPX0gb3B0X2RvbUhlbHBlciBET00gaGVscGVyLCB1c2VkIGZvciBkb2N1bWVudCBpbnRlcmFjdGlvbi4KICoKICogQGV4dGVuZHMge2dvb2cudWkuRGlzcG9zYWJsZX0gcmF0aGVyIHRoYW4gQ29tcG9uZW50IG9yIENvbnRhaW5lciAodGhpcyBjbGFzcyBtYW5hZ2VzIGEgZ29vZy51aS5UYWJCYXIgYW5kIHRoZSBwYW5lcykKICogQGNvbnN0cnVjdG9yCiAqLwpib290c3RyYXAzLlRhYnMgPSBmdW5jdGlvbiggb3B0X2Nvb2tpZU5hbWUsIG9wdF9jbGFzcywgb3B0X3JlbmRlcmVyLCBvcHRfZG9tSGVscGVyICkgewovLwl0aGlzLnNldExvY2F0aW9uKCduYXYtc3RhY2tlZCcgPT0gb3B0X2NsYXNzID8gZ29vZy51aS5UYWJCYXIuTG9jYXRpb24uU1RBUlQgOiBnb29nLnVpLlRhYkJhci5Mb2NhdGlvbi5UT1ApOwovLwlnb29nLnVpLkNvbnRhaW5lci5jYWxsKHRoaXMsIHRoaXMuZ2V0T3JpZW50YXRpb24oKSwKLy8JCQkJCQlvcHRfcmVuZGVyZXIgfHwgYm9vdHN0cmFwMy5UYWJzUmVuZGVyZXIuZ2V0SW5zdGFuY2UoKSwgb3B0X2RvbUhlbHBlcik7Ci8vCWdvb2cudWkuQ29tcG9uZW50LmNhbGwodGhpcywgb3B0X2RvbUhlbHBlcik7Cglnb29nLkRpc3Bvc2FibGUuY2FsbCh0aGlzKTsKCgkvKioKCSAqIEB0eXBlIHtnb29nLnVpLlRhYkJhci5Mb2NhdGlvbn0KCSAqIEBwcml2YXRlCgkgKi8KCXRoaXMubG9jYXRpb25fID0gJ25hdi1zdGFja2VkJyA9PSBvcHRfY2xhc3MgPwoJCQkJLy9nb29nLmRvbS5jbGFzc2VzLmhhcyhlbGVtZW50LCAnbmF2LXN0YWNrZWQnKSA/CgkJCQlnb29nLnVpLlRhYkJhci5Mb2NhdGlvbi5TVEFSVCA6CgkJCQlnb29nLnVpLlRhYkJhci5Mb2NhdGlvbi5UT1A7CgoJdGhpcy50YWJCYXJfID0gbmV3IGdvb2cudWkuVGFiQmFyKCB0aGlzLmxvY2F0aW9uXywKCQkJCQkJCQkJCW9wdF9yZW5kZXJlciB8fCBib290c3RyYXAzLlRhYkJhclJlbmRlcmVyLmdldEluc3RhbmNlKCkgKTsKCgl0aGlzLmV4dHJhQ2xhc3NfID0gb3B0X2NsYXNzOwoKCS8qKgoJICogRG9tSGVscGVyIHVzZWQgdG8gaW50ZXJhY3Qgd2l0aCB0aGUgZG9jdW1lbnQsIGFsbG93aW5nIGNvbXBvbmVudHMgdG8gYmUKCSAqIGNyZWF0ZWQgaW4gYSBkaWZmZXJlbnQgd2luZG93LiAgVGhpcyBwcm9wZXJ0eSBpcyBjb25zaWRlcmVkIHByb3RlY3RlZDsKCSAqIHN1YmNsYXNzZXMgb2YgQ29tcG9uZW50IG1heSByZWZlciB0byBpdCBkaXJlY3RseS4KCSAqIEB0eXBlIHtnb29nLmRvbS5Eb21IZWxwZXJ9CgkgKiBAcHJvdGVjdGVkCgkgKiBAc3VwcHJlc3Mge3VuZGVyc2NvcmV9CgkgKi8KLy8JdGhpcy5kb21fID0gb3B0X2RvbUhlbHBlciB8fCBnb29nLmRvbS5nZXREb21IZWxwZXIoKTsKCgkvKioKCSAqIEB0eXBlIHtzdHJpbmd8dW5kZWZpbmVkfQoJICovCgl0aGlzLmNvb2tpZU5hbWVfID0gb3B0X2Nvb2tpZU5hbWU7CgovLwkvKioKLy8JICogQHR5cGUge2dvb2cuSGlzdG9yeX0KLy8JICogQHByaXZhdGUKLy8JICovCi8vCXRoaXMuaGlzdG9yeV8gPSBuZXcgZ29vZy5IaXN0b3J5KCk7CgovLyAgLyoqCi8vICAgKiBAdHlwZSB7QXJyYXkuPHN0cmluZz59Ci8vICAgKiBAcHJpdmF0ZQovLyAgICovCi8vICB0aGlzLnRhYkVsZW1lbnRzXyA9IFtdOwoKLy8gIC8qKgovLyAgICogQHR5cGUge09iamVjdC48c3RyaW5nLCBFbGVtZW50Pn0KLy8gICAqIEBwcml2YXRlCi8vICAgKi8KLy8gIHRoaXMuY29udGVudFBhbmVzXyA9IHt9Owp9Owpnb29nLmluaGVyaXRzKGJvb3RzdHJhcDMuVGFicywgZ29vZy5EaXNwb3NhYmxlKTsKCi8qKgogKiBAdHlwZSB7Z29vZy5kZWJ1Zy5Mb2dnZXJ9CiAqIEBwcml2YXRlCiAqLwpib290c3RyYXAzLlRhYnMubG9nZ2VyXyA9IGdvb2cuZGVidWcuTG9nZ2VyLmdldExvZ2dlcignYm9vdHN0cmFwMy5UYWJzJyk7CgovKioKICogQHR5cGUge2dvb2cudWkuVGFiQmFyfQogKiBAcHJpdmF0ZQogKi8KYm9vdHN0cmFwMy5UYWJzLnByb3RvdHlwZS50YWJCYXJfOwoKLyoqCiAqIEB0eXBlIHtIVE1MRGl2RWxlbWVudH0KICogQHByaXZhdGUKICovCmJvb3RzdHJhcDMuVGFicy5wcm90b3R5cGUudmlzaWJsZUNvbnRlbnRQYW5lXzsKCi8qKgogKiBAdHlwZSB7Z29vZy5IaXN0b3J5fQogKiBAcHJpdmF0ZQogKi8KYm9vdHN0cmFwMy5UYWJzLnByb3RvdHlwZS5oaXN0b3J5XzsKCmJvb3RzdHJhcDMuVGFicy5wcm90b3R5cGUuZmFkZSA9IHRydWU7CgovKioKICogQHR5cGUge2dvb2cuZXZlbnRzLktleX0KICogQHByaXZhdGUKICovCmJvb3RzdHJhcDMuVGFicy5wcm90b3R5cGUuc2VsZWN0SGFuZGxlcktleV87CgovLy8qKgovLyAqIEBwYXJhbSB7RWxlbWVudH0gZWxlbWVudCBFbGVtZW50IHRvIGRlY29yYXRlLgovLyAqLwovL2Jvb3RzdHJhcDMuVGFicy5wcm90b3R5cGUuZGVjb3JhdGUgPSBmdW5jdGlvbihlbGVtZW50KSB7Ci8vCXRoaXMuZGVjb3JhdGVJbnRlcm5hbChlbGVtZW50KTsKLy8JdGhpcy5lbnRlckRvY3VtZW50KCk7Ci8vfTsKCi8vLyoqCi8vICogQG92ZXJyaWRlCi8vICovCi8vYm9vdHN0cmFwMy5UYWJzLnByb3RvdHlwZS5jcmVhdGVEb20gPSBmdW5jdGlvbigpIHsKLy8JdGhpcy5kZWNvcmF0ZUludGVybmFsKCAvKiogQHR5cGUge0hUTUxMSUVsZW1lbnR9ICovICh0aGlzLmRvbV8uY3JlYXRlRWxlbWVudCgndWwnKSkgKTsKLy99OwoKLyoqCiAqIEBwYXJhbSB7SFRNTFVsRWxlbWVudH0gdGFiQmFyRWwKICogQHBhcmFtIHtIVE1MRWxlbWVudH0gY29udGFpbmVyRWxlbWVudCAtIHBhcmVudCBub2RlIG9mIHRhYkJhckVsCiAqLwpib290c3RyYXAzLlRhYnMucHJvdG90eXBlLmNyZWF0ZUFuZEFkZENvbnRlbnRXcmFwcGVyRWxlbWVudCA9IGZ1bmN0aW9uKCB0YWJCYXJFbCwgY29udGFpbmVyRWxlbWVudCApIHsKCXZhciBjb250ZW50V3JhcHBlckVsID0gdGhpcy50YWJCYXJfLmdldERvbUhlbHBlcigpLmNyZWF0ZURvbSgnZGl2JywKCQl0aGlzLnRhYkJhcl8uZ2V0T3JpZW50YXRpb24oKSA9PSBnb29nLnVpLkNvbnRhaW5lci5PcmllbnRhdGlvbi5WRVJUSUNBTCA/CgkJCSd0YWItY29udGVudCBjb2wtc20tMTAnIDogJ3RhYi1jb250ZW50Jyk7CgoJdmFyIGxvY2F0aW9uID0gdGhpcy50YWJCYXJfLmdldExvY2F0aW9uKCk7CglpZiggbG9jYXRpb24gPT0gZ29vZy51aS5UYWJCYXIuTG9jYXRpb24uQk9UVE9NIHx8CgkJbG9jYXRpb24gPT0gZ29vZy51aS5UYWJCYXIuTG9jYXRpb24uRU5EICkKCXsKCQlnb29nLmRvbS5pbnNlcnRTaWJsaW5nQmVmb3JlKCBjb250ZW50V3JhcHBlckVsLCB0YWJCYXJFbCApOwoJfSBlbHNlIHsKCQljb250YWluZXJFbGVtZW50LmFwcGVuZENoaWxkKCBjb250ZW50V3JhcHBlckVsICk7Cgl9CgoJcmV0dXJuIGNvbnRlbnRXcmFwcGVyRWw7Cn07CgoKLyoqCiAqIERlY29yYXRlcyB0aGUgZ2l2ZW4gZWxlbWVudCBhcyBhIFRhYkJhciBhbmQgYXNzb2NpYXRlcyBUYWJQYW5lcyB3aXRoIGVhY2ggVGFiLgogKiBAcGFyYW0ge0VsZW1lbnR9IGNvbnRhaW5lckVsZW1lbnQgRWxlbWVudCB0byBkZWNvcmF0ZS4KICogQG92ZXJyaWRlCiAqLwpib290c3RyYXAzLlRhYnMucHJvdG90eXBlLmRlY29yYXRlID0gZnVuY3Rpb24oY29udGFpbmVyRWxlbWVudCkgewovLwl0aGlzLnNldEVsZW1lbnRJbnRlcm5hbChlbGVtZW50KTsKCgl2YXIgdGFiQmFyRWwgPSBnb29nLmRvbS5jbGFzc2VzLmhhcyhjb250YWluZXJFbGVtZW50LCAnbmF2JykgPwoJCQkJCQljb250YWluZXJFbGVtZW50IDoKCQkJCQkJZ29vZy5kb20uZ2V0RWxlbWVudEJ5Q2xhc3MoJ25hdicsIGNvbnRhaW5lckVsZW1lbnQpOyAvLyBnb29nLmRvbS5nZXRGaXJzdEVsZW1lbnRDaGlsZChlbGVtZW50KTsKCi8vCWdvb2cuZG9tLnNldEZvY3VzYWJsZVRhYkluZGV4KCB0YWJCYXJFbCwgZmFsc2UgKTsKCi8vCWdvb2cudWkucmVnaXN0cnkuc2V0RGVjb3JhdG9yQnlDbGFzc05hbWUoICd0YWInLAovLwkJZnVuY3Rpb24oKSB7Ci8vCQkJcmV0dXJuIG5ldyBnb29nLnVpLlRhYihudWxsLCBib290c3RyYXAzLlRhYnMuVGFiUmVuZGVyZXIuZ2V0SW5zdGFuY2UoKSk7Ci8vCQl9Ci8vCSk7CgoJdmFyIHNlbGVjdGVkVGFiSW5kZXggPSB0aGlzLmNhbGN1bGF0ZVNlbGVjdGVkVGFiSW5kZXgodGFiQmFyRWwpOwoKLy8JdGhpcy5hZGRDaGlsZCggdGhpcy50YWJCYXJfLCBmYWxzZSApOwoJLy90aGlzLnRhYkJhcl8uc2V0Rm9jdXNhYmxlKGZhbHNlKTsKCS8vdGhpcy50YWJCYXJfLnNldFBhcmVudCggdGhpcyApOwoJaWYoICF0aGlzLnRhYkJhcl8uaXNJbkRvY3VtZW50KCkgKSB7CgkJdHJ5IHsKCQkJdGhpcy50YWJCYXJfLmRlY29yYXRlKCB0YWJCYXJFbCApOwoJCX0gY2F0Y2goIGUgKSB7CgkJCWNvbnNvbGUuZXJyb3IoZSk7CgkJfQoJfQoKCXRoaXMuaW5pdGlhbGlzZVRhYlBhbmVzRnJvbVRhYnMoIHRhYkJhckVsLAoJCWdvb2cuZG9tLmdldEVsZW1lbnRzQnlUYWdOYW1lQW5kQ2xhc3MoJ2xpJywgdW5kZWZpbmVkLCB0YWJCYXJFbCksCgkJc2VsZWN0ZWRUYWJJbmRleCApOwoKCS8vIGFkZENoaWxkKGNoaWxkLCBvcHRfcmVuZGVyKQoJLy8gYWRkQ2hpbGRBdChjaGlsZCwgaW5zZXJ0aW9uSW5kZXgsIG9wdF9yZW5kZXIpCgoJdGhpcy50YWJCYXJfLnNldFNlbGVjdGVkVGFiSW5kZXgoIHNlbGVjdGVkVGFiSW5kZXggKTsJCS8vIG9yIHRoaXMudGFiQmFyXy5zZXRTZWxlY3RlZFRhYiggc2VsZWN0ZWRUYWIgKTsKCgl0aGlzLmxpc3RlblRvVGFiRXZlbnRzXygpOwp9OwoKLyoqCiAqIEBwYXJhbSB7SFRNTEVMZW1lbnR9IGNvbnRhaW5lckVsZW1lbnQKICovCmJvb3RzdHJhcDMuVGFicy5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24oIGNvbnRhaW5lckVsZW1lbnQgKSB7Cgl0aGlzLnRhYkJhcl8ucmVuZGVyKCBjb250YWluZXJFbGVtZW50ICk7CgoJdmFyIHRhYkJhckVsID0gdGhpcy50YWJCYXJfLmdldEVsZW1lbnQoKTsKCWlmKCB0aGlzLmV4dHJhQ2xhc3NfICkgewoJCWdvb2cuZG9tLmNsYXNzZXMuYWRkKHRhYkJhckVsLCB0aGlzLmV4dHJhQ2xhc3NfKTsKCX0KCgl0aGlzLmNyZWF0ZUFuZEFkZENvbnRlbnRXcmFwcGVyRWxlbWVudCggdGFiQmFyRWwsIGNvbnRhaW5lckVsZW1lbnQgKTsKCgl0aGlzLmRlY29yYXRlKGNvbnRhaW5lckVsZW1lbnQpOwp9OwoKLyoqCiAqIElmIGFuICZsdDtpbnB1dD4gY29udHJvbCB3aXRoIGlkPSJoaXN0b3J5X3N0YXRlIiBpcyBmb3VuZCBpbiB0aGUgcGFnZSwKICogcGFyc2UgdGhlIHZhbHVlIGFzIGVpdGhlcjoKICogCS0gSlNPTjogPGNvZGU+eyIke2Nvb2tpZU5hbWVffSI6IGluZGV4LCAuLi59PC9jb2RlPgogKiAJLSBvciBhcyBhIDAtYmFzZWQgaW5kZXgKICogT3RoZXJ3aXNlLCBhdHRlbXB0IHRvIHJlYWQgdGhlIGNvb2tpZQogKiBAcGFyYW0ge0hUTUxFbGVtZW50fSB0YWJCYXJFbAogKiBAcmV0dXJucyB7bnVtYmVyfQogKi8KYm9vdHN0cmFwMy5UYWJzLnByb3RvdHlwZS5jYWxjdWxhdGVTZWxlY3RlZFRhYkluZGV4ID0gZnVuY3Rpb24odGFiQmFyRWwpIHsKCXZhciBzZWxlY3RlZFRhYkluZGV4ID0gMCwKCQloaXN0b3J5Q3RybCA9IC8qKiBAdHlwZSB7SFRNTElucHV0RWxlbWVudD19ICovKGdvb2cuZG9tLmdldEVsZW1lbnQoJ2hpc3Rvcnlfc3RhdGUnKSksCgkJc2VsZWN0ZWRUYWJJZDsKCWlmKCBoaXN0b3J5Q3RybCA9PSBudWxsICkgewoJCWlmKCB0aGlzLmNvb2tpZU5hbWVfICkgewoJCQlzZWxlY3RlZFRhYklkID0gZ29vZy5uZXQuY29va2llcy5nZXQodGhpcy5jb29raWVOYW1lXywgJzAnKTsKCQl9Cgl9IGVsc2UgaWYoIGhpc3RvcnlDdHJsLnZhbHVlICkgewoJCXZhciBoaXN0b3J5VmFsdWUgPSBoaXN0b3J5Q3RybC52YWx1ZTsKCQlpZiggaGlzdG9yeVZhbHVlLmNoYXJBdCgwKSA9PSAneycgKSB7CgkJCWlmKCB0aGlzLmNvb2tpZU5hbWVfICkgewoJCQkJaGlzdG9yeVZhbHVlID0gaGlzdG9yeVZhbHVlLnJlcGxhY2UoLycvZywgJyInKTsKCQkJCXNlbGVjdGVkVGFiSWQgPSBKU09OLnBhcnNlKGhpc3RvcnlWYWx1ZSlbdGhpcy5jb29raWVOYW1lX107CgkJCX0KCQl9IGVsc2UgewoJCQlzZWxlY3RlZFRhYklkID0gaGlzdG9yeUN0cmwudmFsdWU7CgkJfQoJCXRoaXMuaGlzdG9yeV8gPSBuZXcgZ29vZy5IaXN0b3J5KCBmYWxzZSwgdW5kZWZpbmVkLCBoaXN0b3J5Q3RybCApOwoJCS8vKGhpc3RvcnlUb2tlbiBpcyBtYXBwZWQgdG8gc2VsZWN0ZWRUYWJJbmRleCBvbiB0aGUgc2VydmVyIGlmIHRoZSBjb29raWUgInRhYi1pbmRleCIgaXMgc2V0KSB2YXIgaGlzdG9yeVRva2VuID0gdGhpcy5oaXN0b3J5Xy5nZXRUb2tlbigpOwoJfQoKCWlmKCBzZWxlY3RlZFRhYklkICE9PSB1bmRlZmluZWQgKSB7CgkJaWYoIC9edGFiXy8udGVzdChzZWxlY3RlZFRhYklkKSApIHsKCQkJdmFyIHNlbGVjdGVkVGFiID0gdGhpcy50YWJCYXJfLmdldENoaWxkKHNlbGVjdGVkVGFiSWQpOwoJCQlpZiggc2VsZWN0ZWRUYWIgKSB7CgkJCQlzZWxlY3RlZFRhYkluZGV4ID0gdGhpcy50YWJCYXJfLmluZGV4T2ZDaGlsZChzZWxlY3RlZFRhYik7CgkJCX0KCQl9IGVsc2UgewoJCQlzZWxlY3RlZFRhYkluZGV4ID0gcGFyc2VJbnQoIHNlbGVjdGVkVGFiSWQgKTsKCQl9Cgl9CgoJaWYoIHNlbGVjdGVkVGFiSW5kZXggPT0gMCApIHsKCQl2YXIgYWN0aXZlID0gdGFiQmFyRWwuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnYWN0aXZlJylbMF07CgkJc2VsZWN0ZWRUYWJJbmRleCA9IGJvb3RzdHJhcDMudXRpbHMuaW5kZXhPZkVsZW1lbnRXaXRoaW5QYXJlbnQoYWN0aXZlKTsKCX0KCXJldHVybiBzZWxlY3RlZFRhYkluZGV4Owp9OwoKLyoqCiAqIEBwYXJhbSB7c3RyaW5nfSB0YWJJZAogKi8KYm9vdHN0cmFwMy5UYWJzLnByb3RvdHlwZS5zdG9yZVRhYklkSW5IaXN0b3J5ID0gZnVuY3Rpb24oIHRhYklkICkgewoJdmFyIGhpc3RvcnlWYWx1ZSA9ICh0aGlzLmhpc3RvcnlfID8gdGhpcy5oaXN0b3J5Xy5nZXRUb2tlbigpIDogd2luZG93LmxvY2F0aW9uLmhhc2gpIHx8IHt9OwoJLy8gdXBkYXRlIHRoZSBoaXN0b3J5VmFsdWUgd2l0aCB0YWJJZCBvciB7dGhpcy5jb29raWVOYW1lXzogdGFiSWR9CglpZiggdGhpcy5jb29raWVOYW1lXyApIHsKLy8JCXZhciB1bmRlcnNjb3JlID0gdGFiSWQuaW5kZXhPZignXycpOwovLwkJdGFiSW5kZXggPSB0YWJJbmRleCB8fCB1bmRlcnNjb3JlIDwgMCA/ICcwJyA6IHRhYklkLnN1YnN0cmluZyggMywgdW5kZXJzY29yZSApOyAJLy8gdGFiWF9jb250ZW50Ci8vCQkJdGFiSW5kZXggPSBib290c3RyYXAzLnV0aWxzLmluZGV4T2ZFbGVtZW50V2l0aGluUGFyZW50KCkKCQlnb29nLm5ldC5jb29raWVzLnNldCggdGhpcy5jb29raWVOYW1lXywgJyMnICsgdGFiSWQgKTsgLy90YWJJbmRleCApOwoKCQlpZiggL150YWJfLy50ZXN0KGhpc3RvcnlWYWx1ZSkgKSB7CgkJCWhpc3RvcnlWYWx1ZSA9IGhpc3RvcnlWYWx1ZS5zdWJzdHJpbmcoMSk7CgkJfQoJCWlmKCBoaXN0b3J5VmFsdWVbMF0gPT0gJ3snICkgewoJCQloaXN0b3J5VmFsdWUgPSBKU09OLnBhcnNlKGhpc3RvcnlWYWx1ZSk7CgkJCWhpc3RvcnlWYWx1ZVt0aGlzLmNvb2tpZU5hbWVfXSA9IHRhYklkOwoJCX0gZWxzZSB7CgkJCWJvb3RzdHJhcDMuVGFicy5sb2dnZXJfLndhcm5pbmcoJ292ZXJ3cml0aW5nIGhpc3Rvcnk6ICcsIGhpc3RvcnlWYWx1ZSk7CgkJCWhpc3RvcnlWYWx1ZSA9IHt9OwoJCX0KCQloaXN0b3J5VmFsdWVbdGhpcy5jb29raWVOYW1lX10gPSB0YWJJZDsKCQloaXN0b3J5VmFsdWUgPSBKU09OLnN0cmluZ2lmeShoaXN0b3J5VmFsdWUpOwoJfSBlbHNlIHsKCQloaXN0b3J5VmFsdWUgPSB0YWJJZDsKCX0KCgkvL2Jvb3RzdHJhcDMuVGFicy5sb2dnZXJfLmluZm8oJ3VwZGF0aW5nIFVSTCBoYXNoOiAnICsgdGFiSWQpOyAvLyArICcsIHNjcm9sbFRvcDogJyArIHNjcm9sbFRvcCk7CglpZiggdGhpcy5oaXN0b3J5XyApIHsKLy8gVE9ETzogZGVjb3JhdGUoKSBhY3R1YWxseSBleHBlY3RzIGFuIGludGVnZXIgb3IgYSBKU09OIHN0cmluZywgZWc6IHtjb29raWVOYW1lOmluZGV4LC4uLn0KCQl0aGlzLmhpc3RvcnlfLnNldFRva2VuKGhpc3RvcnlWYWx1ZSk7Cgl9IGVsc2UgewovLwkJCQkJdmFyIHVyaSA9IGdvb2cuVXJpLnBhcnNlKHdpbmRvdy5sb2NhdGlvbik7Ci8vCQkJCQl1cmkuc2V0RnJhZ21lbnQoIHRhYklkICk7Ci8vCQkJCQl3aW5kb3cubG9jYXRpb24gPSB1cmkudG9TdHJpbmcoKTsKCQl3aW5kb3cubG9jYXRpb24uaGFzaCA9ICcjJyArIGhpc3RvcnlWYWx1ZTsKCX0KfTsKCgovKioKICogQHBhcmFtIHtIVE1MVUxFbGVtZW50fSB0YWJCYXJFbAogKiBAcGFyYW0ge0FycmF5LjxIVE1MTElFbGVtZW50Pn0gdGFiRWxlbWVudHMKICogQHBhcmFtIHtudW1iZXJ9IHNlbGVjdGVkVGFiSW5kZXgKICovCmJvb3RzdHJhcDMuVGFicy5wcm90b3R5cGUuaW5pdGlhbGlzZVRhYlBhbmVzRnJvbVRhYnMgPSBmdW5jdGlvbih0YWJCYXJFbCwgdGFiRWxlbWVudHMsIHNlbGVjdGVkVGFiSW5kZXgpIHsKCXZhciBjb250ZW50V3JhcHBlckVsOwoKCS8vIGFkZCB0aGUgY2xhc3MgbmFtZXMgdG8gZWFjaCBvZiB0aGUgdGFiIHBhbmVzLgoJLy8gRnVuY3Rpb24gcGFzc2VkIHRvIGZvckVhY2g6IChlbGVtZW50LCBpbmRleCwgYXJyYXkpCglnb29nLmFycmF5LmZvckVhY2goIHRhYkVsZW1lbnRzLCBmdW5jdGlvbih0YWJFbGVtZW50LCBpbmRleCkgewoJCS8vdGFiRWxlbWVudC5jbGFzc05hbWUgPSAndGFiJzsKCQkvL3RhYkVsZW1lbnQub25jbGljayA9IGZ1bmN0aW9uKCl7IHJldHVybiBmYWxzZTsgfTsKCQl2YXIgYSA9IGdvb2cuZG9tLmdldEZpcnN0RWxlbWVudENoaWxkKHRhYkVsZW1lbnQpLAoJCQlocmVmID0gbmV3IGdvb2cuVXJpKGEuaHJlZik7Ci8vCQlpZiggIXRhYkVsZW1lbnQuaWQgKSB7Ci8vCQkJdGFiRWxlbWVudC5pZCA9ICd0YWInICsgaW5kZXg7Ci8vCQl9CgkJYS5vbmNsaWNrID0gZnVuY3Rpb24oKSB7IHJldHVybiBmYWxzZTsgfTsKCQlpZiggaHJlZi5oYXNGcmFnbWVudCgpICkgewoJCQkvLyBDb250ZW50IGhhcyBhbHJlYWR5IGJlZW4gcHJvdmlkZWQsIGJ1dCB3ZSBvbmx5IHdhbnQgdG8gc2hvdyB0aGUgc2VsZWN0ZWQgdGFiCgkJCXZhciBjb250ZW50UGFuZUlkID0gaHJlZi5nZXRGcmFnbWVudCgpLAoJCQkJY29udGVudFBhbmUgPSAvKiogQHR5cGUge0hUTUxFbGVtZW50fSAqLyhnb29nLmRvbS5nZXRFbGVtZW50KCBjb250ZW50UGFuZUlkICkpOwoJCQlpZiggIWNvbnRlbnRQYW5lICkgewoJCQkJaWYoICFjb250ZW50V3JhcHBlckVsICkgewoJCQkJCWNvbnRlbnRXcmFwcGVyRWwgPSBnb29nLmRvbS5nZXRFbGVtZW50QnlDbGFzcyggJ3RhYi1jb250ZW50JywgdGFiQmFyRWwucGFyZW50Tm9kZSApIHx8CgkJCQkJCXRoaXMuY3JlYXRlQW5kQWRkQ29udGVudFdyYXBwZXJFbGVtZW50KCB0YWJCYXJFbCwgdGFiQmFyRWwucGFyZW50Tm9kZSApOwoJCQkJfQoKCQkJCWNvbnRlbnRQYW5lID0gZ29vZy5kb20uY3JlYXRlRG9tKCdkaXYnLCB7J2lkJzogY29udGVudFBhbmVJZH0pOwoJCQkJY29udGVudFBhbmUuaW5uZXJIVE1MID0gdGhpcy50YWJCYXJfLmdldENoaWxkQXQoaW5kZXgpLmdldFRhYlBhbmVDb250ZW50KCk7CgkJCQljb250ZW50V3JhcHBlckVsLmFwcGVuZENoaWxkKCBjb250ZW50UGFuZSApOwoJCQl9CgoJCQlpZiggaW5kZXggIT0gc2VsZWN0ZWRUYWJJbmRleCApIHsKCQkJCWdvb2cuZG9tLmNsYXNzZXMucmVtb3ZlKCB0YWJFbGVtZW50LCAnaW4nLCAnYWN0aXZlJyApOwoJCQl9CgkJCQl0aGlzLnNob3dUYWJDb250ZW50UGFuZV8oIGNvbnRlbnRQYW5lLCBpbmRleCA9PSBzZWxlY3RlZFRhYkluZGV4LCB0YWJFbGVtZW50LmlkICk7Ci8vCQkJaWYoIHRoaXMuZmFkZSApIHsKLy8JCQkJaWYoIGluZGV4ID09IHNlbGVjdGVkVGFiSW5kZXggKSB7Ci8vCQkJCQlnb29nLmRvbS5jbGFzc2VzLmFkZCggY29udGVudFBhbmUsICd0YWItcGFuZScsICdmYWRlJywgJ2luJywgJ2FjdGl2ZScgKTsKLy8JCQkJfSBlbHNlIHsKLy8JCQkJCWdvb2cuZG9tLmNsYXNzZXMuYWRkKCBjb250ZW50UGFuZSwgJ3RhYi1wYW5lJywgJ2ZhZGUnICk7Ci8vCQkJCX0KLy8JCQl9IGVsc2UgewovLwkJCQlpZiggaW5kZXggPT0gc2VsZWN0ZWRUYWJJbmRleCApIHsKLy8JCQkJCWdvb2cuZG9tLmNsYXNzZXMuYWRkKCBjb250ZW50UGFuZSwgJ3RhYi1wYW5lJywgJ2FjdGl2ZScgKTsKLy8JCQkJfSBlbHNlIHsKLy8JCQkJCWdvb2cuZG9tLmNsYXNzZXMuYWRkKCBjb250ZW50UGFuZSwgJ3RhYi1wYW5lJyApOwovLwkJCQl9Ci8vCQkJfQoJCQkvL2dvb2cuc3R5bGUuc2hvd0VsZW1lbnQoIGNvbnRlbnRQYW5lLCBmYWxzZSApOwoJCQlib290c3RyYXAzLlRhYnMuZGVjb3JhdGVDb250ZW50UGFuZSggY29udGVudFBhbmUsIHRoaXMuZmFkZSApOwoJCX0KCX0sIHRoaXMgKTsKfTsKCgovKioKICogQXR0ZW1wdCB0byBhdXRvbWF0aWNhbGx5IGRlY29yYXRlIHRoZSBkb3dubG9hZGVkIGNvbnRlbnQKICogQHBhcmFtIHtIVE1MRWxlbWVudH0gY29udGVudFBhbmUKICogQHBhcmFtIHtib29sZWFufSBmYWRlCiAqLwpib290c3RyYXAzLlRhYnMuZGVjb3JhdGVDb250ZW50UGFuZSA9IGZ1bmN0aW9uKCBjb250ZW50UGFuZSwgZmFkZSApIHsKCXZhciBlbGVtZW50VG9EZWNvcmF0ZSA9IGNvbnRlbnRQYW5lLmlkICE9IG51bGwgPyBjb250ZW50UGFuZSA6IGdvb2cuZG9tLmdldEZpcnN0RWxlbWVudENoaWxkKCBjb250ZW50UGFuZSApOwoKCWlmKCBmYWRlICkgewoJCWdvb2cuZG9tLmNsYXNzZXMuYWRkKCBlbGVtZW50VG9EZWNvcmF0ZSwgJ3RhYi1wYW5lJywgJ2ZhZGUnICk7Cgl9IGVsc2UgewoJCWdvb2cuZG9tLmNsYXNzZXMuYWRkKCBlbGVtZW50VG9EZWNvcmF0ZSwgJ3RhYi1wYW5lJyApOwoJfQoKCWJvb3RzdHJhcDMuVGFicy5sb2dnZXJfLmZpbmUoJ2RlY29yYXRlQ29udGVudFBhbmUgJyArIGVsZW1lbnRUb0RlY29yYXRlLmlkKTsKCXZhciBkZWNvcmF0b3IgPSBnb29nLnVpLnJlZ2lzdHJ5LmdldERlY29yYXRvciggZWxlbWVudFRvRGVjb3JhdGUgKTsKCWlmKCBkZWNvcmF0b3IgKSB7CgkJZGVjb3JhdG9yLmRlY29yYXRlKGVsZW1lbnRUb0RlY29yYXRlKTsKCX0KfTsKCgovKioKICogQHBhcmFtIHtzdHJpbmd9IHRpdGxlCiAqIEBwYXJhbSB7c3RyaW5nfSBocmVmIC0gdGhlIFVSTCAoI2lkIG9mIGVsZW1lbnQgd2l0aGluIHBhZ2UsIG9yIFVSTCB0byBsb2FkIGJ5IEFKQVgpCiAqIEBwYXJhbSB7c3RyaW5nfGZ1bmN0aW9ufHVuZGVmaW5lZH0gb3B0X2NvbnRlbnQgdXNlZCB3aGVuIGhyZWYgaXMgbm90IGFuIEFKQVggVVJMCiAqLwpib290c3RyYXAzLlRhYnMucHJvdG90eXBlLmFkZENoaWxkID0gZnVuY3Rpb24oIHRpdGxlLCBocmVmLCBvcHRfY29udGVudCApIHsKCXZhciB0YWIgPSBuZXcgYm9vdHN0cmFwMy5UYWIodGl0bGUsIG9wdF9jb250ZW50ICk7Ci8vCQltYXRjaCA9IC8jKC4rKS8uZXhlYyhocmVmKTsKLy8JCXRhYi5pZF8KCS8vIE5lZWQgdG8gc2V0IGhyZWYgYmVmb3JlIGNhbGxpbmcgYWRkQ2hpbGQoKSBiZWNhdXNlIHRoZSByZW5kZXJlciB1c2VzIHRoZSBocmVmLgoJdGFiLnNldEhyZWYoIGhyZWYgKTsKCXRoaXMudGFiQmFyXy5hZGRDaGlsZCggdGFiLCB0cnVlICk7Ci8vCS8vIHNlZW1zIG1vcmUgbGlrZWx5IGZvciB0aGlzLnRhYnNfLmdldENoaWxkKGhyZWYpIHRvIHdvcmsgaWYgd2UgY2FsbAovLwkvLyBzZXRIcmVmKCkgYWZ0ZXIgYWRkQ2hpbGQoaHJlZikKLy8JdGFiLnNldEhyZWYoIGhyZWYgKTsKfTsKCi8qKgogKiBAcGFyYW0ge2dvb2cudWkuVGFifSB0YWIKICogQHBhcmFtIHtib29sZWFufHVuZGVmaW5lZH0gb3B0X3VucmVuZGVyCiAqIEByZXR1cm4ge2dvb2cudWkuQ29tcG9uZW50fG51bGx9CiAqLwpib290c3RyYXAzLlRhYnMucHJvdG90eXBlLnJlbW92ZUNoaWxkID0gZnVuY3Rpb24oIHRhYiwgb3B0X3VucmVuZGVyICkgewoKCS8vIFJlbW92ZSB0aGUgYXNzb2NpYXRlZCBjb250ZW50IHBhbmUgZnJvbSB0aGUgRE9NCgl2YXIgdGFiRWxlbWVudCA9IHRhYi5nZXRFbGVtZW50KCksCgkJYSA9IGdvb2cuZG9tLmdldEZpcnN0RWxlbWVudENoaWxkKHRhYkVsZW1lbnQpLAoJCWhyZWYgPSBuZXcgZ29vZy5VcmkoYS5ocmVmKTsKCglpZiggaHJlZi5oYXNGcmFnbWVudCgpICkgewoJCXZhciBmcmFnbWVudCA9IGhyZWYuZ2V0RnJhZ21lbnQoKTsKCQlib290c3RyYXAzLlRhYnMubG9nZ2VyXy5maW5lKCdyZW1vdmluZyB0YWIgY29udGVudCBwYW5lJyArIGZyYWdtZW50ICk7CgkJdmFyIGNvbnRlbnRQYW5lID0gZ29vZy5kb20uZ2V0RWxlbWVudCggZnJhZ21lbnQgKTsKCi8vSSBkb24ndCB0aGluayB3ZSBuZWVkIHRvIGRlc2VsZWN0IHRoZSB0YWIgLSBob3BlZnVsbHkgdGhlIHN1cGVyIGltcGwgd2lsbCB0YWtlIGNhcmUgb2YgdGhhdAovLwkJaWYoIGNvbnRlbnRQYW5lID09PSB0aGlzLnZpc2libGVDb250ZW50UGFuZV8gKSB7Ci8vCQkJdGhpcy5kb1NlbGVjdFRhYl8oIHRoaXMudGFiQmFyXy5nZXQgKQovLwkJfQoJCWdvb2cuZG9tLnJlbW92ZU5vZGUoIGNvbnRlbnRQYW5lICk7Cgl9CgovLwl0aGlzLnNob3dUYWJDb250ZW50UGFuZV8oIHRoaXMudmlzaWJsZUNvbnRlbnRQYW5lXywgZmFsc2UgKTsKCgkvLyBSZW1vdmUgdGhlIHRhYgoJcmV0dXJuIGJvb3RzdHJhcDMuVGFicy5zdXBlckNsYXNzXy5yZW1vdmVDaGlsZC5jYWxsKHRoaXMsIHRhYiwgb3B0X3VucmVuZGVyKTsKfTsKCgovLy8qKgovLyAqIENvbmZpZ3VyZXMgdGhlIGNvbnRhaW5lciBhZnRlciBpdHMgRE9NIGhhcyBiZWVuIHJlbmRlcmVkLCBhbmQgc2V0cyB1cCBldmVudCBoYW5kbGluZy4KLy8gKiBPdmVycmlkZXMge0BsaW5rIGdvb2cudWkuQ29tcG9uZW50I2VudGVyRG9jdW1lbnR9LgovLyAqIEBvdmVycmlkZQovLyAqLwovL2Jvb3RzdHJhcDMuVGFicy5wcm90b3R5cGUuZW50ZXJEb2N1bWVudCA9IGZ1bmN0aW9uKCkgewovLwl0aGlzLmhpc3RvcnlfID0gbmV3IGdvb2cuSGlzdG9yeSgpOwoKLy8JdmFyIHRhYnMgPSB0aGlzOwoKLy8gSGFuZGxlIGNsaWNrcyBvbiBlYWNoIHRhYgovLwlnb29nLmV2ZW50cy5saXN0ZW4oIHRoaXMudGFiQmFyXywgZ29vZy51aS5Db21wb25lbnQuRXZlbnRUeXBlLlNFTEVDVCwKLy8JCWZ1bmN0aW9uKGUpIHsKLy8JCQl2YXIgdGFiID0gZS50YXJnZXQ7Ci8vLy8JCQlib290c3RyYXAzLlRhYnMubG9nZ2VyXy5pbmZvKCdTRUxFQ1QgZXZlbnQ6ICcgKyB0YWIpOwovLy8vCQkJdGFicy5kb1NlbGVjdFRhYl8odGFiKTsKLy8JCX0KLy8JKTsKLy99OwoKYm9vdHN0cmFwMy5UYWJzLnByb3RvdHlwZS5kaXNwb3NlSW50ZXJuYWwgPSBmdW5jdGlvbigpIHsKLy8JYm9vdHN0cmFwMy5UYWJzLnN1cGVyQ2xhc3NfLmRpc3Bvc2VJbnRlcm5hbC5jYWxsKHRoaXMpOwoKCWdvb2cuZXZlbnRzLnVubGlzdGVuQnlLZXkodGhpcy5zZWxlY3RIYW5kbGVyS2V5Xyk7CgoJdGhpcy50YWJCYXJfLmRpc3Bvc2UoKTsKCWRlbGV0ZSB0aGlzLnRhYkJhcl87Ci8vaWYgdGhlIGNvbXBpbGVyIGNvbXBsYWlucyBhYm91dCB0aGlzLnRhYkJhcl8uZ2V0SGFuZGxlcigpCi8vCXRoaXMucmVtb3ZlQWxsTGlzdGVuZXJzKCk7Ci8vCWlmICh0aGlzLmV2ZW50SGFuZGxlcl8pIHsKLy8JCXRoaXMuZXZlbnRIYW5kbGVyXy5kaXNwb3NlKCk7Ci8vCQlkZWxldGUgdGhpcy5ldmVudEhhbmRsZXJfOwovLwl9Cn07CgovL2Jvb3RzdHJhcDMuVGFicy5wcm90b3R5cGUuZ2V0SGFuZGxlciA9IGZ1bmN0aW9uKCkgewovLwlyZXR1cm4gbmV3IGdvb2cuZXZlbnRzLkV2ZW50SGFuZGxlcigpOwovL307Cgpib290c3RyYXAzLlRhYnMucHJvdG90eXBlLmxpc3RlblRvVGFiRXZlbnRzXyA9IGZ1bmN0aW9uKCkgewoJLy8gTGlzdGVuIGZvciBTRUxFQ1QsIFVOU0VMRUNULCBESVNBQkxFLCBhbmQgSElERSBldmVudHMgZGlzcGF0Y2hlZCBieSB0YWJzLgovLwl0aGlzLnRhYkJhcl8uZ2V0SGFuZGxlcigpLgoJdGhpcy5zZWxlY3RIYW5kbGVyS2V5XyA9IGdvb2cuZXZlbnRzLmxpc3Rlbih0aGlzLnRhYkJhcl8sCgkJCQkJCQkJCQkJCWdvb2cudWkuQ29tcG9uZW50LkV2ZW50VHlwZS5TRUxFQ1QsCgkJCQkJCQkJCQkJCXRoaXMuaGFuZGxlVGFiU2VsZWN0LCBmYWxzZSwgdGhpcyk7Ci8vCQlsaXN0ZW4odGhpcywgZ29vZy51aS5Db21wb25lbnQuRXZlbnRUeXBlLkRJU0FCTEUsIHRoaXMuaGFuZGxlVGFiRGlzYWJsZSkuCi8vCQlsaXN0ZW4odGhpcywgZ29vZy51aS5Db21wb25lbnQuRXZlbnRUeXBlLkhJREUsIHRoaXMuaGFuZGxlVGFiSGlkZSk7Ci8vCQlbZ29vZy5ldmVudHMuRXZlbnRUeXBlLlNFTEVDVCwgZ29vZy5ldmVudHMuRXZlbnRUeXBlLkNMSUNLXSwKLy8JCWdvb2cuYmluZCh0aGlzLnRhYkJhcl8uc2V0U2VsZWN0ZWRUYWIsIHRoaXMudGFiQmFyXywgdGFiKSk7Cn07CgovL2lmIHRoZSBjb21waWxlciBjb21wbGFpbnMgYWJvdXQgdGhpcy50YWJCYXJfLmdldEhhbmRsZXIoKQovL2Jvb3RzdHJhcDMuVGFicy5wcm90b3R5cGUuZ2V0SGFuZGxlciA9IGZ1bmN0aW9uKCkgewovLwlpZiAoIXRoaXMuZXZlbnRIYW5kbGVyXykgewovLwkJdGhpcy5ldmVudEhhbmRsZXJfID0gbmV3IGdvb2cuZXZlbnRzLkV2ZW50SGFuZGxlcih0aGlzKTsKLy8JfQovLwlyZXR1cm4gdGhpcy5ldmVudEhhbmRsZXJfOwovL307Ci8vCi8vYm9vdHN0cmFwMy5UYWJzLnByb3RvdHlwZS5yZW1vdmVBbGxMaXN0ZW5lcnMgPSBmdW5jdGlvbigpIHsKLy8JaWYgKHRoaXMuZXZlbnRIYW5kbGVyXykgewovLwkJdGhpcy5ldmVudEhhbmRsZXJfLnJlbW92ZUFsbCgpOwovLwl9Ci8vfTsKCgpib290c3RyYXAzLlRhYnMucHJvdG90eXBlLnNldFN0YWNrZWQgPSBmdW5jdGlvbihzdGFja2VkKSB7Cgl0aGlzLnRhYkJhcl8uc2V0TG9jYXRpb24oc3RhY2tlZCA/IGdvb2cudWkuVGFiQmFyLkxvY2F0aW9uLlNUQVJUIDogZ29vZy51aS5UYWJCYXIuTG9jYXRpb24uVE9QKTsKfTsKCmJvb3RzdHJhcDMuVGFicy5wcm90b3R5cGUuc2V0T3JpZW50YXRpb24gPSBmdW5jdGlvbihvcmllbnRhdGlvbikgewoJdmFyIGVsZW1lbnQgPSB0aGlzLnRhYkJhcl8uZ2V0RWxlbWVudCgpOwoJaWYoIGVsZW1lbnQgKSB7CgkJZ29vZy5kb20uY2xhc3Nlcy5lbmFibGUoIGVsZW1lbnQsICduYXYtc3RhY2tlZCcsCgkJCQkJCQkJZ29vZy51aS5Db250YWluZXIuT3JpZW50YXRpb24uVkVSVElDQUwgPT0gb3JpZW50YXRpb24gKTsKCX0KCXRoaXMudGFiQmFyXy5vcmllbnRhdGlvbl8gPSBvcmllbnRhdGlvbjsKfTsKCgovKioKICogQHJldHVybnMge2dvb2cudWkuVGFiQmFyfQogKi8KYm9vdHN0cmFwMy5UYWJzLnByb3RvdHlwZS5nZXRUYWJCYXIgPSBmdW5jdGlvbigpIHsKCXJldHVybiB0aGlzLnRhYkJhcl87Cn07CgovLy8qKiBNYWtlIHRoaXMgd29yayB3aXRoIENvbXBvbmVudC9Db250YWluZXIuYWRkQ2hpbGQoIHRoaXMsIGJvb2xlYW4gKSAqLwovL2Jvb3RzdHJhcDMuVGFicy5wcm90b3R5cGUuZ2V0UGFyZW50ID0gZnVuY3Rpb24oKSB7Ci8vCXJldHVybiB0aGlzLnBhcmVudF87IC8vdGFiQmFyXy5nZXRQYXJlbnQoKTsKLy99OwovL2Jvb3RzdHJhcDMuVGFicy5wcm90b3R5cGUuc2V0UGFyZW50ID0gZnVuY3Rpb24ocGFyZW50KSB7Ci8vCXRoaXMucGFyZW50XyA9IHBhcmVudDsgLy90YWJCYXJfLnNldFBhcmVudChwYXJlbnQpOwovL307Ci8vYm9vdHN0cmFwMy5UYWJzLnByb3RvdHlwZS5nZXRJZCA9IGZ1bmN0aW9uKCkgewovLwlyZXR1cm4gdGhpcy50YWJCYXJfLmdldElkKCk7Ci8vfTsKCi8qKgogKiBAcGFyYW0ge251bWJlcn0gc2VsZWN0ZWRUYWJJbmRleAogKi8KYm9vdHN0cmFwMy5UYWJzLnByb3RvdHlwZS5zZXRTZWxlY3RlZFRhYkluZGV4ID0gZnVuY3Rpb24gKHNlbGVjdGVkVGFiSW5kZXgpIHsKCXRoaXMudGFiQmFyXy5zZXRTZWxlY3RlZFRhYkluZGV4KCBzZWxlY3RlZFRhYkluZGV4ICk7Cn07CgovKioKICogQHBhcmFtIHtmdW5jdGlvbihnb29nLnVpLlRhYiwgbnVtYmVyPSl9IGYKICovCmJvb3RzdHJhcDMuVGFicy5wcm90b3R5cGUuZm9yRWFjaFRhYiA9IGZ1bmN0aW9uKCBmICkgewoJdGhpcy50YWJCYXJfLmZvckVhY2hDaGlsZCggZiApOwp9OwoKCmJvb3RzdHJhcDMuVGFicy5wcm90b3R5cGUuaGFuZGxlVGFiU2VsZWN0ID0gZnVuY3Rpb24oZSkgewoJdGhpcy5kb1NlbGVjdFRhYl8oIGUudGFyZ2V0ICk7Cn07CgoKLyoqCiAqIElmIHRoZSBzZWxlY3RlZCB0YWIgaGFzIGEgZnJhZ21lbnQgVVJMLCBzaG93IHRoZSBjb250ZW50IHBhbmUgd2l0aCBhbiBJRCBtYXRjaGluZyB0aGUgZnJhZ21lbnQuCiAqIE90aGVyd2lzZSwKICogQHBhcmFtIHtnb29nLnVpLlRhYn0gdGFiCiAqIEBwcml2YXRlCiAqLwpib290c3RyYXAzLlRhYnMucHJvdG90eXBlLmRvU2VsZWN0VGFiXyA9IGZ1bmN0aW9uKCB0YWIgKSB7Cgl2YXIgdGFiRWxlbWVudCA9IHRhYi5nZXRFbGVtZW50KCksCgkJYSA9IGdvb2cuZG9tLmdldEZpcnN0RWxlbWVudENoaWxkKHRhYkVsZW1lbnQpLAoJCWhyZWYgPSBuZXcgZ29vZy5VcmkoYS5ocmVmKSwKCQl0YWJzID0gdGhpczsKCgl0aGlzLnNob3dUYWJDb250ZW50UGFuZV8oIC8qKiBAdHlwZSB7IUhUTUxEaXZFbGVtZW50fSAqLyh0aGlzLnZpc2libGVDb250ZW50UGFuZV8pLCBmYWxzZSApOwoJaWYoIGhyZWYuaGFzRnJhZ21lbnQoKSApIHsKCQl2YXIgZnJhZ21lbnQgPSBocmVmLmdldEZyYWdtZW50KCk7CgkJYm9vdHN0cmFwMy5UYWJzLmxvZ2dlcl8uZmluZSgncmUgb3BlbiB0YWIgJyArIGZyYWdtZW50ICk7CgkJdmFyIGNvbnRlbnRQYW5lID0gLyoqIEB0eXBlIHshSFRNTERpdkVsZW1lbnR9ICovKGdvb2cuZG9tLmdldEVsZW1lbnQoIGZyYWdtZW50ICkpOwoJCXRoaXMuc2hvd1RhYkNvbnRlbnRQYW5lXyggY29udGVudFBhbmUsIHRydWUsIGZyYWdtZW50ICk7Cgl9IGVsc2UgewoJCWJvb3RzdHJhcDMuVGFicy5sb2dnZXJfLmZpbmUoJ2Rvd25sb2FkIGNvbnRlbnQgZm9yIHRhYiAnICsgaHJlZik7CgkJZ29vZy5uZXQuWGhySW8uc2VuZCggaHJlZiwgZnVuY3Rpb24oZXZlbnQpIHsKCQkJaWYoIGV2ZW50LnRhcmdldC5pc1N1Y2Nlc3MoKSApIHsKCQkJCS8vIGluamVjdCB0aGUgY29udGVudCBhcyBhIG5ldyBkaXYgYW5kIHVwZGF0ZSB0aGUgPGE+J3MgaHJlZiB0byBwb2ludCBhdCB0aGUgdGFiUGFuZQoJCQkJdmFyIGh0bWwgPSBldmVudC50YXJnZXQuZ2V0UmVzcG9uc2VUZXh0KCksCgkJCQkJdGFiUGFuZUlkID0gdGFiLmdldElkKCkgKyAnX2NvbnRlbnQnLAoJCQkJCWNvbnRlbnRQYW5lID0gLyoqIEB0eXBlIHtIVE1MRWxlbWVudH0gKi8oZ29vZy5kb20uY3JlYXRlRG9tKCdkaXYnLCB7aWQ6IHRhYlBhbmVJZH0sCgkJCQkJCXRhYnMuZG9tXy5odG1sVG9Eb2N1bWVudEZyYWdtZW50KGh0bWwpICkpOwoJCQkJLy8gVE9ETzogdXNlIHRoZSB1dGlsLmdldFRlbXBGcmFtZSgpIG1ldGhvZCB0byBpbnNlcnQgdGhlIHJlc3BvbnNlVGV4dCBpbnRvIG91ciBET00/CgoJCQkJYS5ocmVmID0gJyMnICsgdGFiUGFuZUlkOwoJCQkJLy9nb29nLmRvbS5hcHBlbmRDaGlsZCggdGFiRWxlbWVudC5wYXJlbnROb2RlLCBuZXdOb2RlICkKCQkJCWdvb2cuZG9tLmluc2VydFNpYmxpbmdBZnRlciggY29udGVudFBhbmUsIHRhYkVsZW1lbnQucGFyZW50Tm9kZSApOwovLwkJCQlnb29nLmRvbS5jbGFzc2VzLmFkZCggY29udGVudFBhbmUsICd0YWItcGFuZWwnICk7CgkJCQl0YWJzLnNob3dUYWJDb250ZW50UGFuZV8oIGNvbnRlbnRQYW5lLCB0cnVlLCB0YWJQYW5lSWQgKTsKCQkJCWJvb3RzdHJhcDMuVGFicy5kZWNvcmF0ZUNvbnRlbnRQYW5lKCBjb250ZW50UGFuZSwgdGFicy5mYWRlICk7CgkJCQl0YWJzLmRpc3BhdGNoRXZlbnQoIG5ldyBnb29nLmV2ZW50cy5FdmVudCggZ29vZy5ldmVudHMuRXZlbnRUeXBlLkxPQUQsIGNvbnRlbnRQYW5lICkgKTsKLy8JCQl9IGVsc2UgewovLwkJCSAJdmFyIHN0YXR1cyA9IGV2ZW50LnRhcmdldC5nZXRTdGF0dXMoKTsgICAJCS8vIDQwNAovLwkJCSAJdmFyIHN0YXR1c1RleHQgPSBldmVudC50YXJnZXQuZ2V0U3RhdHVzVGV4dCgpOyAvLyBub3QgZm91bmQKLy8JCQkJdmFyIGpzb24gPSBldmVudC50YXJnZXQuZ2V0UmVzcG9uc2VKc29uKCk7CgkJCX0KCQl9KTsKCX0KfTsKCgovKioKICogQHBhcmFtIHshSFRNTERpdkVsZW1lbnR9IGNvbnRlbnRQYW5lCiAqIEBwYXJhbSB7Ym9vbGVhbn0gc2hvdwogKiBAcGFyYW0ge3N0cmluZz19IHRhYklkIC0gVGhlIFVSTCBmcmFnbWVudC4gZWc6ICdzZWFyY2hUYWInLCAndGFiMV9jb250ZW50JywgJ2FkZFRhYlRhYicuCiAqIAkJCQkJCQlDYW4gYmUgdW5kZWZpbmVkIGlmIHtAY29kZSBzaG93fSBpcyBmYWxzZQogKiBAcHJpdmF0ZQogKi8KYm9vdHN0cmFwMy5UYWJzLnByb3RvdHlwZS5zaG93VGFiQ29udGVudFBhbmVfID0gZnVuY3Rpb24oIGNvbnRlbnRQYW5lLCBzaG93LCB0YWJJZCApIHsKCWlmKCBjb250ZW50UGFuZSApIHsKCQkvL2lmKCBzaG93ICkgeyBnb29nLmRvbS5jbGFzc2VzLmFkZCggY29udGVudFBhbmUsICd0YWItcGFuZScsICdmYWRlJywgJ2luJywgJ2FjdGl2ZScgKTsgfQoJCWdvb2cuZG9tLmNsYXNzZXMuZW5hYmxlKCBjb250ZW50UGFuZSwgJ2FjdGl2ZScsIHNob3cgKTsKCQlpZiggdGhpcy5mYWRlICkgewoJCQlnb29nLmRvbS5jbGFzc2VzLmVuYWJsZSggY29udGVudFBhbmUsICdpbicsIHNob3cgKTsKCQl9CgovLwkJZ29vZy5zdHlsZS5zaG93RWxlbWVudCggY29udGVudFBhbmUsIHNob3cgKTsKCQlpZiggc2hvdyApIHsKCQkJdmFyIHNjcm9sbFRvcCA9IHdpbmRvdy5kb2N1bWVudC5ib2R5LnNjcm9sbFRvcDsKCgkJCXRoaXMuc3RvcmVUYWJJZEluSGlzdG9yeSggdGFiSWQgKTsKCgkJCS8vIHJlc2V0IHRoZSBzY3JvbGwgcG9zaXRpb24gKHNldHRpbmcgd2luZG93LmxvY2F0aW9uLmhhc2ggc2Nyb2xscyB0byB0aGUgYW5jaG9yIGxvY2F0aW9uKQovLwkJCXdpbmRvdy5kb2N1bWVudC5ib2R5LnNjcm9sbFRvcCA9IHNjcm9sbFRvcDsKCQkJd2luZG93LnNjcm9sbFRvKCB3aW5kb3cuZG9jdW1lbnQuYm9keS5zY3JvbGxMZWZ0LCBzY3JvbGxUb3AgKTsKCgkJCXRoaXMudmlzaWJsZUNvbnRlbnRQYW5lXyA9IGNvbnRlbnRQYW5lOwoJCX0KCX0KfTsKCgovKioKICogQHJldHVybiB7bnVtYmVyfQogKi8KYm9vdHN0cmFwMy5UYWJzLnByb3RvdHlwZS5nZXRTZWxlY3RlZFRhYkluZGV4ID0gZnVuY3Rpb24oKSB7CglyZXR1cm4gdGhpcy50YWJCYXJfLmdldFNlbGVjdGVkVGFiSW5kZXgoKTsKfTsKCi8qKgogKiBAcmV0dXJuIHtFbGVtZW50fQogKi8KYm9vdHN0cmFwMy5UYWJzLnByb3RvdHlwZS5nZXRDdXJyZW50Q29udGVudFBhbmUgPSBmdW5jdGlvbigpIHsKCXJldHVybiB0aGlzLnZpc2libGVDb250ZW50UGFuZV87Cn07CgovKioKICogQHJldHVybiB7bnVtYmVyfQogKi8KYm9vdHN0cmFwMy5UYWJzLnByb3RvdHlwZS5nZXRNaW5XaWR0aCA9IGZ1bmN0aW9uKCkgewoJLy9yZXR1cm4gdGhpcy50YWJCYXJfLmdldENvbnRlbnRFbGVtZW50KCkuY2xpZW50V2lkdGg7Cgl2YXIgZWwgPSB0aGlzLnRhYkJhcl8uZ2V0Q29udGVudEVsZW1lbnQoKSwKCQl3aWR0aCA9IDgsIC8vZ29vZy5zdHlsZS5nZXRQYWRkaW5nQm94KCBlbCApLmxlZnQgKiAyLAoJCWkgPSB0aGlzLnRhYkJhcl8uZ2V0Q2hpbGRDb3VudCgpOwoJd2hpbGUoIGktLSAhPSAwICkgewoJCWVsID0gdGhpcy50YWJCYXJfLmdldENoaWxkQXQoaSkuZ2V0Q29udGVudEVsZW1lbnQoKTsKCQl3aWR0aCArPSAoZWwub2Zmc2V0V2lkdGggKyAyKTsKCX0KCXJldHVybiB3aWR0aDsKfTsK",
                "body": "Z29vZy5wcm92aWRlKCdib290c3RyYXAzLlRhYnMnKTsKCmdvb2cucmVxdWlyZSgnYm9vdHN0cmFwMy5UYWJCYXJSZW5kZXJlcicpOwpnb29nLnJlcXVpcmUoJ2Jvb3RzdHJhcDMuVGFiUmVuZGVyZXInKTsKZ29vZy5yZXF1aXJlKCdib290c3RyYXAzLnV0aWxzJyk7Cgpnb29nLnJlcXVpcmUoJ2dvb2cuZG9tJyk7Cmdvb2cucmVxdWlyZSgnZ29vZy5ldmVudHMuRXZlbnRUYXJnZXQnKTsKZ29vZy5yZXF1aXJlKCdnb29nLnVpLlRhYkJhcicpOwpnb29nLnJlcXVpcmUoJ2dvb2cubmV0LlhocklvJyk7Cmdvb2cucmVxdWlyZSgnZ29vZy5VcmknKTsKZ29vZy5yZXF1aXJlKCdnb29nLkhpc3RvcnknKTsKZ29vZy5yZXF1aXJlKCdnb29nLm5ldC5jb29raWVzJyk7Cmdvb2cucmVxdWlyZSgnZ29vZy5kZWJ1Zy5Mb2dnZXInKTsKCi8qKgogKiBAZmlsZW92ZXJ2aWV3IEJhc2VkIG9uIEpRdWVyeVRhYnMsIGJ1dCB1c2VzIHN0eWxlcyBmcm9tIGh0dHA6Ly90d2l0dGVyLmdpdGh1Yi5jb20vYm9vdHN0cmFwL2NvbXBvbmVudHMuaHRtbCNuYXZzOgogKgogKiA8cHJlPgogKiAJJmx0O2RpdiBpZD0icHJvZmlsZVRhYnMiPgogJmx0O3VsIGNsYXNzPSJuYXYgbmF2LXRhYnMiPgogJmx0O2xpPiZsdDthIGhyZWY9IiNzZWFyY2hUYWIiPlNlYXJjaDwvYT48L2xpPgogJmx0O2xpPiZsdDthIGhyZWY9ImFqYXgvc2F2ZWRfc2VhcmNoLmh0bWwiPlNhdmVkIFByb2ZpbGUmbHQ7L2E+PC9saT4KICZsdDtsaT4mbHQ7YSBocmVmPSIjYWRkVGFiVGFiIj5BZGQmbHQ7L2xpPgogJmx0Oy91bD4KICZsdDtkaXYgaWQ9InNlYXJjaFRhYiI+CiAmbHQ7L2Rpdj4KICZsdDtkaXYgaWQ9ImFkZFRhYlRhYiI+CiAmbHQ7L2Rpdj4KICZsdDsvZGl2PgogPC9wcmU+CgogQGF1dGhvciBOaWNob2xhcyBBbGJpb24KICovCgovKioKICogSlF1ZXJ5VUktc3R5bGUgdGFicyBjb250YWluZXIgd2l0aCBCb290c3RyYXAgc3R5bGluZyAtIGJhc2VkIG9uIGdvb2cudWkuVGFiUGFuZQogKgogKiBAcGFyYW0ge3N0cmluZz19IG9wdF9jb29raWVOYW1lIC0gZWc6ICd0YWItaW5kZXgnLiBQcm92aWRlIGEgbmFtZSBpZiB0aGUgbGFzdCBzZWxlY3RlZCB0YWIgc2hvdWxkIGJlIHNhdmVkIGluIGEgY29va2llIGFuZCAjCiAqIEBwYXJhbSB7c3RyaW5nPX0gb3B0X2NsYXNzICduYXYtc3RhY2tlZCcgb3IgJ25hdi1qdXN0aWZpZWQnCiAqIEBwYXJhbSB7Z29vZy51aS5Db250YWluZXJSZW5kZXJlcj19IG9wdF9yZW5kZXJlciBSZW5kZXJlciB1c2VkIHRvIHJlbmRlciBvcgogKiAgICAgZGVjb3JhdGUgdGhlIGNvbnRhaW5lcjsgZGVmYXVsdHMgdG8ge0BsaW5rIGdvb2cudWkuQ29udGFpbmVyUmVuZGVyZXJ9LgogKiBAcGFyYW0ge2dvb2cuZG9tLkRvbUhlbHBlcj19IG9wdF9kb21IZWxwZXIgRE9NIGhlbHBlciwgdXNlZCBmb3IgZG9jdW1lbnQgaW50ZXJhY3Rpb24uCiAqCiAqIEBleHRlbmRzIHtnb29nLnVpLkRpc3Bvc2FibGV9IHJhdGhlciB0aGFuIENvbXBvbmVudCBvciBDb250YWluZXIgKHRoaXMgY2xhc3MgbWFuYWdlcyBhIGdvb2cudWkuVGFiQmFyIGFuZCB0aGUgcGFuZXMpCiAqIEBjb25zdHJ1Y3RvcgogKi8KYm9vdHN0cmFwMy5UYWJzID0gZnVuY3Rpb24oIG9wdF9jb29raWVOYW1lLCBvcHRfY2xhc3MsIG9wdF9yZW5kZXJlciwgb3B0X2RvbUhlbHBlciApIHsKLy8JdGhpcy5zZXRMb2NhdGlvbignbmF2LXN0YWNrZWQnID09IG9wdF9jbGFzcyA/IGdvb2cudWkuVGFiQmFyLkxvY2F0aW9uLlNUQVJUIDogZ29vZy51aS5UYWJCYXIuTG9jYXRpb24uVE9QKTsKLy8JZ29vZy51aS5Db250YWluZXIuY2FsbCh0aGlzLCB0aGlzLmdldE9yaWVudGF0aW9uKCksCi8vCQkJCQkJb3B0X3JlbmRlcmVyIHx8IGJvb3RzdHJhcDMuVGFic1JlbmRlcmVyLmdldEluc3RhbmNlKCksIG9wdF9kb21IZWxwZXIpOwovLwlnb29nLnVpLkNvbXBvbmVudC5jYWxsKHRoaXMsIG9wdF9kb21IZWxwZXIpOwoJZ29vZy5EaXNwb3NhYmxlLmNhbGwodGhpcyk7CgoJLyoqCgkgKiBAdHlwZSB7Z29vZy51aS5UYWJCYXIuTG9jYXRpb259CgkgKiBAcHJpdmF0ZQoJICovCgl0aGlzLmxvY2F0aW9uXyA9ICduYXYtc3RhY2tlZCcgPT0gb3B0X2NsYXNzID8KCQkJCS8vZ29vZy5kb20uY2xhc3Nlcy5oYXMoZWxlbWVudCwgJ25hdi1zdGFja2VkJykgPwoJCQkJZ29vZy51aS5UYWJCYXIuTG9jYXRpb24uU1RBUlQgOgoJCQkJZ29vZy51aS5UYWJCYXIuTG9jYXRpb24uVE9QOwoKCXRoaXMudGFiQmFyXyA9IG5ldyBnb29nLnVpLlRhYkJhciggdGhpcy5sb2NhdGlvbl8sCgkJCQkJCQkJCQlvcHRfcmVuZGVyZXIgfHwgYm9vdHN0cmFwMy5UYWJCYXJSZW5kZXJlci5nZXRJbnN0YW5jZSgpICk7CgoJdGhpcy5leHRyYUNsYXNzXyA9IG9wdF9jbGFzczsKCgkvKioKCSAqIERvbUhlbHBlciB1c2VkIHRvIGludGVyYWN0IHdpdGggdGhlIGRvY3VtZW50LCBhbGxvd2luZyBjb21wb25lbnRzIHRvIGJlCgkgKiBjcmVhdGVkIGluIGEgZGlmZmVyZW50IHdpbmRvdy4gIFRoaXMgcHJvcGVydHkgaXMgY29uc2lkZXJlZCBwcm90ZWN0ZWQ7CgkgKiBzdWJjbGFzc2VzIG9mIENvbXBvbmVudCBtYXkgcmVmZXIgdG8gaXQgZGlyZWN0bHkuCgkgKiBAdHlwZSB7Z29vZy5kb20uRG9tSGVscGVyfQoJICogQHByb3RlY3RlZAoJICogQHN1cHByZXNzIHt1bmRlcnNjb3JlfQoJICovCi8vCXRoaXMuZG9tXyA9IG9wdF9kb21IZWxwZXIgfHwgZ29vZy5kb20uZ2V0RG9tSGVscGVyKCk7CgoJLyoqCgkgKiBAdHlwZSB7c3RyaW5nfHVuZGVmaW5lZH0KCSAqLwoJdGhpcy5jb29raWVOYW1lXyA9IG9wdF9jb29raWVOYW1lOwoKLy8JLyoqCi8vCSAqIEB0eXBlIHtnb29nLkhpc3Rvcnl9Ci8vCSAqIEBwcml2YXRlCi8vCSAqLwovLwl0aGlzLmhpc3RvcnlfID0gbmV3IGdvb2cuSGlzdG9yeSgpOwoKLy8gIC8qKgovLyAgICogQHR5cGUge0FycmF5LjxzdHJpbmc+fQovLyAgICogQHByaXZhdGUKLy8gICAqLwovLyAgdGhpcy50YWJFbGVtZW50c18gPSBbXTsKCi8vICAvKioKLy8gICAqIEB0eXBlIHtPYmplY3QuPHN0cmluZywgRWxlbWVudD59Ci8vICAgKiBAcHJpdmF0ZQovLyAgICovCi8vICB0aGlzLmNvbnRlbnRQYW5lc18gPSB7fTsKfTsKZ29vZy5pbmhlcml0cyhib290c3RyYXAzLlRhYnMsIGdvb2cuRGlzcG9zYWJsZSk7CgovKioKICogQHR5cGUge2dvb2cuZGVidWcuTG9nZ2VyfQogKiBAcHJpdmF0ZQogKi8KYm9vdHN0cmFwMy5UYWJzLmxvZ2dlcl8gPSBnb29nLmRlYnVnLkxvZ2dlci5nZXRMb2dnZXIoJ2Jvb3RzdHJhcDMuVGFicycpOwoKLyoqCiAqIEB0eXBlIHtnb29nLnVpLlRhYkJhcn0KICogQHByaXZhdGUKICovCmJvb3RzdHJhcDMuVGFicy5wcm90b3R5cGUudGFiQmFyXzsKCi8qKgogKiBAdHlwZSB7SFRNTERpdkVsZW1lbnR9CiAqIEBwcml2YXRlCiAqLwpib290c3RyYXAzLlRhYnMucHJvdG90eXBlLnZpc2libGVDb250ZW50UGFuZV87CgovKioKICogQHR5cGUge2dvb2cuSGlzdG9yeX0KICogQHByaXZhdGUKICovCmJvb3RzdHJhcDMuVGFicy5wcm90b3R5cGUuaGlzdG9yeV87Cgpib290c3RyYXAzLlRhYnMucHJvdG90eXBlLmZhZGUgPSB0cnVlOwoKLyoqCiAqIEB0eXBlIHtnb29nLmV2ZW50cy5LZXl9CiAqIEBwcml2YXRlCiAqLwpib290c3RyYXAzLlRhYnMucHJvdG90eXBlLnNlbGVjdEhhbmRsZXJLZXlfOwoKLy8vKioKLy8gKiBAcGFyYW0ge0VsZW1lbnR9IGVsZW1lbnQgRWxlbWVudCB0byBkZWNvcmF0ZS4KLy8gKi8KLy9ib290c3RyYXAzLlRhYnMucHJvdG90eXBlLmRlY29yYXRlID0gZnVuY3Rpb24oZWxlbWVudCkgewovLwl0aGlzLmRlY29yYXRlSW50ZXJuYWwoZWxlbWVudCk7Ci8vCXRoaXMuZW50ZXJEb2N1bWVudCgpOwovL307CgovLy8qKgovLyAqIEBvdmVycmlkZQovLyAqLwovL2Jvb3RzdHJhcDMuVGFicy5wcm90b3R5cGUuY3JlYXRlRG9tID0gZnVuY3Rpb24oKSB7Ci8vCXRoaXMuZGVjb3JhdGVJbnRlcm5hbCggLyoqIEB0eXBlIHtIVE1MTElFbGVtZW50fSAqLyAodGhpcy5kb21fLmNyZWF0ZUVsZW1lbnQoJ3VsJykpICk7Ci8vfTsKCi8qKgogKiBAcGFyYW0ge0hUTUxVbEVsZW1lbnR9IHRhYkJhckVsCiAqIEBwYXJhbSB7SFRNTEVsZW1lbnR9IGNvbnRhaW5lckVsZW1lbnQgLSBwYXJlbnQgbm9kZSBvZiB0YWJCYXJFbAogKi8KYm9vdHN0cmFwMy5UYWJzLnByb3RvdHlwZS5jcmVhdGVBbmRBZGRDb250ZW50V3JhcHBlckVsZW1lbnQgPSBmdW5jdGlvbiggdGFiQmFyRWwsIGNvbnRhaW5lckVsZW1lbnQgKSB7Cgl2YXIgY29udGVudFdyYXBwZXJFbCA9IHRoaXMudGFiQmFyXy5nZXREb21IZWxwZXIoKS5jcmVhdGVEb20oJ2RpdicsCgkJdGhpcy50YWJCYXJfLmdldE9yaWVudGF0aW9uKCkgPT0gZ29vZy51aS5Db250YWluZXIuT3JpZW50YXRpb24uVkVSVElDQUwgPwoJCQkndGFiLWNvbnRlbnQgY29sLXNtLTEwJyA6ICd0YWItY29udGVudCcpOwoKCXZhciBsb2NhdGlvbiA9IHRoaXMudGFiQmFyXy5nZXRMb2NhdGlvbigpOwoJaWYoIGxvY2F0aW9uID09IGdvb2cudWkuVGFiQmFyLkxvY2F0aW9uLkJPVFRPTSB8fAoJCWxvY2F0aW9uID09IGdvb2cudWkuVGFiQmFyLkxvY2F0aW9uLkVORCApCgl7CgkJZ29vZy5kb20uaW5zZXJ0U2libGluZ0JlZm9yZSggY29udGVudFdyYXBwZXJFbCwgdGFiQmFyRWwgKTsKCX0gZWxzZSB7CgkJY29udGFpbmVyRWxlbWVudC5hcHBlbmRDaGlsZCggY29udGVudFdyYXBwZXJFbCApOwoJfQoKCXJldHVybiBjb250ZW50V3JhcHBlckVsOwp9OwoKCi8qKgogKiBEZWNvcmF0ZXMgdGhlIGdpdmVuIGVsZW1lbnQgYXMgYSBUYWJCYXIgYW5kIGFzc29jaWF0ZXMgVGFiUGFuZXMgd2l0aCBlYWNoIFRhYi4KICogQHBhcmFtIHtFbGVtZW50fSBjb250YWluZXJFbGVtZW50IEVsZW1lbnQgdG8gZGVjb3JhdGUuCiAqIEBvdmVycmlkZQogKi8KYm9vdHN0cmFwMy5UYWJzLnByb3RvdHlwZS5kZWNvcmF0ZSA9IGZ1bmN0aW9uKGNvbnRhaW5lckVsZW1lbnQpIHsKLy8JdGhpcy5zZXRFbGVtZW50SW50ZXJuYWwoZWxlbWVudCk7CgoJdmFyIHRhYkJhckVsID0gZ29vZy5kb20uY2xhc3Nlcy5oYXMoY29udGFpbmVyRWxlbWVudCwgJ25hdicpID8KCQkJCQkJY29udGFpbmVyRWxlbWVudCA6CgkJCQkJCWdvb2cuZG9tLmdldEVsZW1lbnRCeUNsYXNzKCduYXYnLCBjb250YWluZXJFbGVtZW50KTsgLy8gZ29vZy5kb20uZ2V0Rmlyc3RFbGVtZW50Q2hpbGQoZWxlbWVudCk7CgovLwlnb29nLmRvbS5zZXRGb2N1c2FibGVUYWJJbmRleCggdGFiQmFyRWwsIGZhbHNlICk7CgovLwlnb29nLnVpLnJlZ2lzdHJ5LnNldERlY29yYXRvckJ5Q2xhc3NOYW1lKCAndGFiJywKLy8JCWZ1bmN0aW9uKCkgewovLwkJCXJldHVybiBuZXcgZ29vZy51aS5UYWIobnVsbCwgYm9vdHN0cmFwMy5UYWJzLlRhYlJlbmRlcmVyLmdldEluc3RhbmNlKCkpOwovLwkJfQovLwkpOwoKCXZhciBzZWxlY3RlZFRhYkluZGV4ID0gdGhpcy5jYWxjdWxhdGVTZWxlY3RlZFRhYkluZGV4KHRhYkJhckVsKTsKCi8vCXRoaXMuYWRkQ2hpbGQoIHRoaXMudGFiQmFyXywgZmFsc2UgKTsKCS8vdGhpcy50YWJCYXJfLnNldEZvY3VzYWJsZShmYWxzZSk7CgkvL3RoaXMudGFiQmFyXy5zZXRQYXJlbnQoIHRoaXMgKTsKCWlmKCAhdGhpcy50YWJCYXJfLmlzSW5Eb2N1bWVudCgpICkgewoJCXRyeSB7CgkJCXRoaXMudGFiQmFyXy5kZWNvcmF0ZSggdGFiQmFyRWwgKTsKCQl9IGNhdGNoKCBlICkgewoJCQljb25zb2xlLmVycm9yKGUpOwoJCX0KCX0KCgl0aGlzLmluaXRpYWxpc2VUYWJQYW5lc0Zyb21UYWJzKCB0YWJCYXJFbCwKCQlnb29nLmRvbS5nZXRFbGVtZW50c0J5VGFnTmFtZUFuZENsYXNzKCdsaScsIHVuZGVmaW5lZCwgdGFiQmFyRWwpLAoJCXNlbGVjdGVkVGFiSW5kZXggKTsKCgkvLyBhZGRDaGlsZChjaGlsZCwgb3B0X3JlbmRlcikKCS8vIGFkZENoaWxkQXQoY2hpbGQsIGluc2VydGlvbkluZGV4LCBvcHRfcmVuZGVyKQoKCXRoaXMudGFiQmFyXy5zZXRTZWxlY3RlZFRhYkluZGV4KCBzZWxlY3RlZFRhYkluZGV4ICk7CQkvLyBvciB0aGlzLnRhYkJhcl8uc2V0U2VsZWN0ZWRUYWIoIHNlbGVjdGVkVGFiICk7CgoJdGhpcy5saXN0ZW5Ub1RhYkV2ZW50c18oKTsKfTsKCi8qKgogKiBAcGFyYW0ge0hUTUxFTGVtZW50fSBjb250YWluZXJFbGVtZW50CiAqLwpib290c3RyYXAzLlRhYnMucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uKCBjb250YWluZXJFbGVtZW50ICkgewoJdGhpcy50YWJCYXJfLnJlbmRlciggY29udGFpbmVyRWxlbWVudCApOwoKCXZhciB0YWJCYXJFbCA9IHRoaXMudGFiQmFyXy5nZXRFbGVtZW50KCk7CglpZiggdGhpcy5leHRyYUNsYXNzXyApIHsKCQlnb29nLmRvbS5jbGFzc2VzLmFkZCh0YWJCYXJFbCwgdGhpcy5leHRyYUNsYXNzXyk7Cgl9CgoJdGhpcy5jcmVhdGVBbmRBZGRDb250ZW50V3JhcHBlckVsZW1lbnQoIHRhYkJhckVsLCBjb250YWluZXJFbGVtZW50ICk7CgoJdGhpcy5kZWNvcmF0ZShjb250YWluZXJFbGVtZW50KTsKfTsKCi8qKgogKiBJZiBhbiAmbHQ7aW5wdXQ+IGNvbnRyb2wgd2l0aCBpZD0iaGlzdG9yeV9zdGF0ZSIgaXMgZm91bmQgaW4gdGhlIHBhZ2UsCiAqIHBhcnNlIHRoZSB2YWx1ZSBhcyBlaXRoZXI6CiAqIAktIEpTT046IDxjb2RlPnsiJHtjb29raWVOYW1lX30iOiBpbmRleCwgLi4ufTwvY29kZT4KICogCS0gb3IgYXMgYSAwLWJhc2VkIGluZGV4CiAqIE90aGVyd2lzZSwgYXR0ZW1wdCB0byByZWFkIHRoZSBjb29raWUKICogQHBhcmFtIHtIVE1MRWxlbWVudH0gdGFiQmFyRWwKICogQHJldHVybnMge251bWJlcn0KICovCmJvb3RzdHJhcDMuVGFicy5wcm90b3R5cGUuY2FsY3VsYXRlU2VsZWN0ZWRUYWJJbmRleCA9IGZ1bmN0aW9uKHRhYkJhckVsKSB7Cgl2YXIgc2VsZWN0ZWRUYWJJbmRleCA9IDAsCgkJaGlzdG9yeUN0cmwgPSAvKiogQHR5cGUge0hUTUxJbnB1dEVsZW1lbnQ9fSAqLyhnb29nLmRvbS5nZXRFbGVtZW50KCdoaXN0b3J5X3N0YXRlJykpLAoJCXNlbGVjdGVkVGFiSWQ7CglpZiggaGlzdG9yeUN0cmwgPT0gbnVsbCApIHsKCQlpZiggdGhpcy5jb29raWVOYW1lXyApIHsKCQkJc2VsZWN0ZWRUYWJJZCA9IGdvb2cubmV0LmNvb2tpZXMuZ2V0KHRoaXMuY29va2llTmFtZV8sICcwJyk7CgkJfQoJfSBlbHNlIGlmKCBoaXN0b3J5Q3RybC52YWx1ZSApIHsKCQl2YXIgaGlzdG9yeVZhbHVlID0gaGlzdG9yeUN0cmwudmFsdWU7CgkJaWYoIGhpc3RvcnlWYWx1ZS5jaGFyQXQoMCkgPT0gJ3snICkgewoJCQlpZiggdGhpcy5jb29raWVOYW1lXyApIHsKCQkJCWhpc3RvcnlWYWx1ZSA9IGhpc3RvcnlWYWx1ZS5yZXBsYWNlKC8nL2csICciJyk7CgkJCQlzZWxlY3RlZFRhYklkID0gSlNPTi5wYXJzZShoaXN0b3J5VmFsdWUpW3RoaXMuY29va2llTmFtZV9dOwoJCQl9CgkJfSBlbHNlIHsKCQkJc2VsZWN0ZWRUYWJJZCA9IGhpc3RvcnlDdHJsLnZhbHVlOwoJCX0KCQl0aGlzLmhpc3RvcnlfID0gbmV3IGdvb2cuSGlzdG9yeSggZmFsc2UsIHVuZGVmaW5lZCwgaGlzdG9yeUN0cmwgKTsKCQkvLyhoaXN0b3J5VG9rZW4gaXMgbWFwcGVkIHRvIHNlbGVjdGVkVGFiSW5kZXggb24gdGhlIHNlcnZlciBpZiB0aGUgY29va2llICJ0YWItaW5kZXgiIGlzIHNldCkgdmFyIGhpc3RvcnlUb2tlbiA9IHRoaXMuaGlzdG9yeV8uZ2V0VG9rZW4oKTsKCX0KCglpZiggc2VsZWN0ZWRUYWJJZCAhPT0gdW5kZWZpbmVkICkgewoJCWlmKCAvXnRhYl8vLnRlc3Qoc2VsZWN0ZWRUYWJJZCkgKSB7CgkJCXZhciBzZWxlY3RlZFRhYiA9IHRoaXMudGFiQmFyXy5nZXRDaGlsZChzZWxlY3RlZFRhYklkKTsKCQkJaWYoIHNlbGVjdGVkVGFiICkgewoJCQkJc2VsZWN0ZWRUYWJJbmRleCA9IHRoaXMudGFiQmFyXy5pbmRleE9mQ2hpbGQoc2VsZWN0ZWRUYWIpOwoJCQl9CgkJfSBlbHNlIHsKCQkJc2VsZWN0ZWRUYWJJbmRleCA9IHBhcnNlSW50KCBzZWxlY3RlZFRhYklkICk7CgkJfQoJfQoKCWlmKCBzZWxlY3RlZFRhYkluZGV4ID09IDAgKSB7CgkJdmFyIGFjdGl2ZSA9IHRhYkJhckVsLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ2FjdGl2ZScpWzBdOwoJCXNlbGVjdGVkVGFiSW5kZXggPSBib290c3RyYXAzLnV0aWxzLmluZGV4T2ZFbGVtZW50V2l0aGluUGFyZW50KGFjdGl2ZSk7Cgl9CglyZXR1cm4gc2VsZWN0ZWRUYWJJbmRleDsKfTsKCi8qKgogKiBAcGFyYW0ge3N0cmluZ30gdGFiSWQKICovCmJvb3RzdHJhcDMuVGFicy5wcm90b3R5cGUuc3RvcmVUYWJJZEluSGlzdG9yeSA9IGZ1bmN0aW9uKCB0YWJJZCApIHsKCXZhciBoaXN0b3J5VmFsdWUgPSAodGhpcy5oaXN0b3J5XyA/IHRoaXMuaGlzdG9yeV8uZ2V0VG9rZW4oKSA6IHdpbmRvdy5sb2NhdGlvbi5oYXNoKSB8fCB7fTsKCS8vIHVwZGF0ZSB0aGUgaGlzdG9yeVZhbHVlIHdpdGggdGFiSWQgb3Ige3RoaXMuY29va2llTmFtZV86IHRhYklkfQoJaWYoIHRoaXMuY29va2llTmFtZV8gKSB7Ci8vCQl2YXIgdW5kZXJzY29yZSA9IHRhYklkLmluZGV4T2YoJ18nKTsKLy8JCXRhYkluZGV4ID0gdGFiSW5kZXggfHwgdW5kZXJzY29yZSA8IDAgPyAnMCcgOiB0YWJJZC5zdWJzdHJpbmcoIDMsIHVuZGVyc2NvcmUgKTsgCS8vIHRhYlhfY29udGVudAovLwkJCXRhYkluZGV4ID0gYm9vdHN0cmFwMy51dGlscy5pbmRleE9mRWxlbWVudFdpdGhpblBhcmVudCgpCgkJZ29vZy5uZXQuY29va2llcy5zZXQoIHRoaXMuY29va2llTmFtZV8sICcjJyArIHRhYklkICk7IC8vdGFiSW5kZXggKTsKCgkJaWYoIC9edGFiXy8udGVzdChoaXN0b3J5VmFsdWUpICkgewoJCQloaXN0b3J5VmFsdWUgPSBoaXN0b3J5VmFsdWUuc3Vic3RyaW5nKDEpOwoJCX0KCQlpZiggaGlzdG9yeVZhbHVlWzBdID09ICd7JyApIHsKCQkJaGlzdG9yeVZhbHVlID0gSlNPTi5wYXJzZShoaXN0b3J5VmFsdWUpOwoJCQloaXN0b3J5VmFsdWVbdGhpcy5jb29raWVOYW1lX10gPSB0YWJJZDsKCQl9IGVsc2UgewoJCQlib290c3RyYXAzLlRhYnMubG9nZ2VyXy53YXJuaW5nKCdvdmVyd3JpdGluZyBoaXN0b3J5OiAnLCBoaXN0b3J5VmFsdWUpOwoJCQloaXN0b3J5VmFsdWUgPSB7fTsKCQl9CgkJaGlzdG9yeVZhbHVlW3RoaXMuY29va2llTmFtZV9dID0gdGFiSWQ7CgkJaGlzdG9yeVZhbHVlID0gSlNPTi5zdHJpbmdpZnkoaGlzdG9yeVZhbHVlKTsKCX0gZWxzZSB7CgkJaGlzdG9yeVZhbHVlID0gdGFiSWQ7Cgl9CgoJLy9ib290c3RyYXAzLlRhYnMubG9nZ2VyXy5pbmZvKCd1cGRhdGluZyBVUkwgaGFzaDogJyArIHRhYklkKTsgLy8gKyAnLCBzY3JvbGxUb3A6ICcgKyBzY3JvbGxUb3ApOwoJaWYoIHRoaXMuaGlzdG9yeV8gKSB7Ci8vIFRPRE86IGRlY29yYXRlKCkgYWN0dWFsbHkgZXhwZWN0cyBhbiBpbnRlZ2VyIG9yIGEgSlNPTiBzdHJpbmcsIGVnOiB7Y29va2llTmFtZTppbmRleCwuLi59CgkJdGhpcy5oaXN0b3J5Xy5zZXRUb2tlbihoaXN0b3J5VmFsdWUpOwoJfSBlbHNlIHsKLy8JCQkJCXZhciB1cmkgPSBnb29nLlVyaS5wYXJzZSh3aW5kb3cubG9jYXRpb24pOwovLwkJCQkJdXJpLnNldEZyYWdtZW50KCB0YWJJZCApOwovLwkJCQkJd2luZG93LmxvY2F0aW9uID0gdXJpLnRvU3RyaW5nKCk7CgkJd2luZG93LmxvY2F0aW9uLmhhc2ggPSAnIycgKyBoaXN0b3J5VmFsdWU7Cgl9Cn07CgoKLyoqCiAqIEBwYXJhbSB7SFRNTFVMRWxlbWVudH0gdGFiQmFyRWwKICogQHBhcmFtIHtBcnJheS48SFRNTExJRWxlbWVudD59IHRhYkVsZW1lbnRzCiAqIEBwYXJhbSB7bnVtYmVyfSBzZWxlY3RlZFRhYkluZGV4CiAqLwpib290c3RyYXAzLlRhYnMucHJvdG90eXBlLmluaXRpYWxpc2VUYWJQYW5lc0Zyb21UYWJzID0gZnVuY3Rpb24odGFiQmFyRWwsIHRhYkVsZW1lbnRzLCBzZWxlY3RlZFRhYkluZGV4KSB7Cgl2YXIgY29udGVudFdyYXBwZXJFbDsKCgkvLyBhZGQgdGhlIGNsYXNzIG5hbWVzIHRvIGVhY2ggb2YgdGhlIHRhYiBwYW5lcy4KCS8vIEZ1bmN0aW9uIHBhc3NlZCB0byBmb3JFYWNoOiAoZWxlbWVudCwgaW5kZXgsIGFycmF5KQoJZ29vZy5hcnJheS5mb3JFYWNoKCB0YWJFbGVtZW50cywgZnVuY3Rpb24odGFiRWxlbWVudCwgaW5kZXgpIHsKCQkvL3RhYkVsZW1lbnQuY2xhc3NOYW1lID0gJ3RhYic7CgkJLy90YWJFbGVtZW50Lm9uY2xpY2sgPSBmdW5jdGlvbigpeyByZXR1cm4gZmFsc2U7IH07CgkJdmFyIGEgPSBnb29nLmRvbS5nZXRGaXJzdEVsZW1lbnRDaGlsZCh0YWJFbGVtZW50KSwKCQkJaHJlZiA9IG5ldyBnb29nLlVyaShhLmhyZWYpOwovLwkJaWYoICF0YWJFbGVtZW50LmlkICkgewovLwkJCXRhYkVsZW1lbnQuaWQgPSAndGFiJyArIGluZGV4OwovLwkJfQoJCWEub25jbGljayA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gZmFsc2U7IH07CgkJaWYoIGhyZWYuaGFzRnJhZ21lbnQoKSApIHsKCQkJLy8gQ29udGVudCBoYXMgYWxyZWFkeSBiZWVuIHByb3ZpZGVkLCBidXQgd2Ugb25seSB3YW50IHRvIHNob3cgdGhlIHNlbGVjdGVkIHRhYgoJCQl2YXIgY29udGVudFBhbmVJZCA9IGhyZWYuZ2V0RnJhZ21lbnQoKSwKCQkJCWNvbnRlbnRQYW5lID0gLyoqIEB0eXBlIHtIVE1MRWxlbWVudH0gKi8oZ29vZy5kb20uZ2V0RWxlbWVudCggY29udGVudFBhbmVJZCApKTsKCQkJaWYoICFjb250ZW50UGFuZSApIHsKCQkJCWlmKCAhY29udGVudFdyYXBwZXJFbCApIHsKCQkJCQljb250ZW50V3JhcHBlckVsID0gZ29vZy5kb20uZ2V0RWxlbWVudEJ5Q2xhc3MoICd0YWItY29udGVudCcsIHRhYkJhckVsLnBhcmVudE5vZGUgKSB8fAoJCQkJCQl0aGlzLmNyZWF0ZUFuZEFkZENvbnRlbnRXcmFwcGVyRWxlbWVudCggdGFiQmFyRWwsIHRhYkJhckVsLnBhcmVudE5vZGUgKTsKCQkJCX0KCgkJCQljb250ZW50UGFuZSA9IGdvb2cuZG9tLmNyZWF0ZURvbSgnZGl2JywgeydpZCc6IGNvbnRlbnRQYW5lSWR9KTsKCQkJCWNvbnRlbnRQYW5lLmlubmVySFRNTCA9IHRoaXMudGFiQmFyXy5nZXRDaGlsZEF0KGluZGV4KS5nZXRUYWJQYW5lQ29udGVudCgpOwoJCQkJY29udGVudFdyYXBwZXJFbC5hcHBlbmRDaGlsZCggY29udGVudFBhbmUgKTsKCQkJfQoKCQkJaWYoIGluZGV4ICE9IHNlbGVjdGVkVGFiSW5kZXggKSB7CgkJCQlnb29nLmRvbS5jbGFzc2VzLnJlbW92ZSggdGFiRWxlbWVudCwgJ2luJywgJ2FjdGl2ZScgKTsKCQkJfQoJCQkJdGhpcy5zaG93VGFiQ29udGVudFBhbmVfKCBjb250ZW50UGFuZSwgaW5kZXggPT0gc2VsZWN0ZWRUYWJJbmRleCwgdGFiRWxlbWVudC5pZCApOwovLwkJCWlmKCB0aGlzLmZhZGUgKSB7Ci8vCQkJCWlmKCBpbmRleCA9PSBzZWxlY3RlZFRhYkluZGV4ICkgewovLwkJCQkJZ29vZy5kb20uY2xhc3Nlcy5hZGQoIGNvbnRlbnRQYW5lLCAndGFiLXBhbmUnLCAnZmFkZScsICdpbicsICdhY3RpdmUnICk7Ci8vCQkJCX0gZWxzZSB7Ci8vCQkJCQlnb29nLmRvbS5jbGFzc2VzLmFkZCggY29udGVudFBhbmUsICd0YWItcGFuZScsICdmYWRlJyApOwovLwkJCQl9Ci8vCQkJfSBlbHNlIHsKLy8JCQkJaWYoIGluZGV4ID09IHNlbGVjdGVkVGFiSW5kZXggKSB7Ci8vCQkJCQlnb29nLmRvbS5jbGFzc2VzLmFkZCggY29udGVudFBhbmUsICd0YWItcGFuZScsICdhY3RpdmUnICk7Ci8vCQkJCX0gZWxzZSB7Ci8vCQkJCQlnb29nLmRvbS5jbGFzc2VzLmFkZCggY29udGVudFBhbmUsICd0YWItcGFuZScgKTsKLy8JCQkJfQovLwkJCX0KCQkJLy9nb29nLnN0eWxlLnNob3dFbGVtZW50KCBjb250ZW50UGFuZSwgZmFsc2UgKTsKCQkJYm9vdHN0cmFwMy5UYWJzLmRlY29yYXRlQ29udGVudFBhbmUoIGNvbnRlbnRQYW5lLCB0aGlzLmZhZGUgKTsKCQl9Cgl9LCB0aGlzICk7Cn07CgoKLyoqCiAqIEF0dGVtcHQgdG8gYXV0b21hdGljYWxseSBkZWNvcmF0ZSB0aGUgZG93bmxvYWRlZCBjb250ZW50CiAqIEBwYXJhbSB7SFRNTEVsZW1lbnR9IGNvbnRlbnRQYW5lCiAqIEBwYXJhbSB7Ym9vbGVhbn0gZmFkZQogKi8KYm9vdHN0cmFwMy5UYWJzLmRlY29yYXRlQ29udGVudFBhbmUgPSBmdW5jdGlvbiggY29udGVudFBhbmUsIGZhZGUgKSB7Cgl2YXIgZWxlbWVudFRvRGVjb3JhdGUgPSBjb250ZW50UGFuZS5pZCAhPSBudWxsID8gY29udGVudFBhbmUgOiBnb29nLmRvbS5nZXRGaXJzdEVsZW1lbnRDaGlsZCggY29udGVudFBhbmUgKTsKCglpZiggZmFkZSApIHsKCQlnb29nLmRvbS5jbGFzc2VzLmFkZCggZWxlbWVudFRvRGVjb3JhdGUsICd0YWItcGFuZScsICdmYWRlJyApOwoJfSBlbHNlIHsKCQlnb29nLmRvbS5jbGFzc2VzLmFkZCggZWxlbWVudFRvRGVjb3JhdGUsICd0YWItcGFuZScgKTsKCX0KCglib290c3RyYXAzLlRhYnMubG9nZ2VyXy5maW5lKCdkZWNvcmF0ZUNvbnRlbnRQYW5lICcgKyBlbGVtZW50VG9EZWNvcmF0ZS5pZCk7Cgl2YXIgZGVjb3JhdG9yID0gZ29vZy51aS5yZWdpc3RyeS5nZXREZWNvcmF0b3IoIGVsZW1lbnRUb0RlY29yYXRlICk7CglpZiggZGVjb3JhdG9yICkgewoJCWRlY29yYXRvci5kZWNvcmF0ZShlbGVtZW50VG9EZWNvcmF0ZSk7Cgl9Cn07CgoKLyoqCiAqIEBwYXJhbSB7c3RyaW5nfSB0aXRsZQogKiBAcGFyYW0ge3N0cmluZ30gaHJlZiAtIHRoZSBVUkwgKCNpZCBvZiBlbGVtZW50IHdpdGhpbiBwYWdlLCBvciBVUkwgdG8gbG9hZCBieSBBSkFYKQogKiBAcGFyYW0ge3N0cmluZ3xmdW5jdGlvbnx1bmRlZmluZWR9IG9wdF9jb250ZW50IHVzZWQgd2hlbiBocmVmIGlzIG5vdCBhbiBBSkFYIFVSTAogKi8KYm9vdHN0cmFwMy5UYWJzLnByb3RvdHlwZS5hZGRDaGlsZCA9IGZ1bmN0aW9uKCB0aXRsZSwgaHJlZiwgb3B0X2NvbnRlbnQgKSB7Cgl2YXIgdGFiID0gbmV3IGJvb3RzdHJhcDMuVGFiKHRpdGxlLCBvcHRfY29udGVudCApOwovLwkJbWF0Y2ggPSAvIyguKykvLmV4ZWMoaHJlZik7Ci8vCQl0YWIuaWRfCgkvLyBOZWVkIHRvIHNldCBocmVmIGJlZm9yZSBjYWxsaW5nIGFkZENoaWxkKCkgYmVjYXVzZSB0aGUgcmVuZGVyZXIgdXNlcyB0aGUgaHJlZi4KCXRhYi5zZXRIcmVmKCBocmVmICk7Cgl0aGlzLnRhYkJhcl8uYWRkQ2hpbGQoIHRhYiwgdHJ1ZSApOwovLwkvLyBzZWVtcyBtb3JlIGxpa2VseSBmb3IgdGhpcy50YWJzXy5nZXRDaGlsZChocmVmKSB0byB3b3JrIGlmIHdlIGNhbGwKLy8JLy8gc2V0SHJlZigpIGFmdGVyIGFkZENoaWxkKGhyZWYpCi8vCXRhYi5zZXRIcmVmKCBocmVmICk7Cn07CgovKioKICogQHBhcmFtIHtnb29nLnVpLlRhYn0gdGFiCiAqIEBwYXJhbSB7Ym9vbGVhbnx1bmRlZmluZWR9IG9wdF91bnJlbmRlcgogKiBAcmV0dXJuIHtnb29nLnVpLkNvbXBvbmVudHxudWxsfQogKi8KYm9vdHN0cmFwMy5UYWJzLnByb3RvdHlwZS5yZW1vdmVDaGlsZCA9IGZ1bmN0aW9uKCB0YWIsIG9wdF91bnJlbmRlciApIHsKCgkvLyBSZW1vdmUgdGhlIGFzc29jaWF0ZWQgY29udGVudCBwYW5lIGZyb20gdGhlIERPTQoJdmFyIHRhYkVsZW1lbnQgPSB0YWIuZ2V0RWxlbWVudCgpLAoJCWEgPSBnb29nLmRvbS5nZXRGaXJzdEVsZW1lbnRDaGlsZCh0YWJFbGVtZW50KSwKCQlocmVmID0gbmV3IGdvb2cuVXJpKGEuaHJlZik7CgoJaWYoIGhyZWYuaGFzRnJhZ21lbnQoKSApIHsKCQl2YXIgZnJhZ21lbnQgPSBocmVmLmdldEZyYWdtZW50KCk7CgkJYm9vdHN0cmFwMy5UYWJzLmxvZ2dlcl8uZmluZSgncmVtb3ZpbmcgdGFiIGNvbnRlbnQgcGFuZScgKyBmcmFnbWVudCApOwoJCXZhciBjb250ZW50UGFuZSA9IGdvb2cuZG9tLmdldEVsZW1lbnQoIGZyYWdtZW50ICk7CgovL0kgZG9uJ3QgdGhpbmsgd2UgbmVlZCB0byBkZXNlbGVjdCB0aGUgdGFiIC0gaG9wZWZ1bGx5IHRoZSBzdXBlciBpbXBsIHdpbGwgdGFrZSBjYXJlIG9mIHRoYXQKLy8JCWlmKCBjb250ZW50UGFuZSA9PT0gdGhpcy52aXNpYmxlQ29udGVudFBhbmVfICkgewovLwkJCXRoaXMuZG9TZWxlY3RUYWJfKCB0aGlzLnRhYkJhcl8uZ2V0ICkKLy8JCX0KCQlnb29nLmRvbS5yZW1vdmVOb2RlKCBjb250ZW50UGFuZSApOwoJfQoKLy8JdGhpcy5zaG93VGFiQ29udGVudFBhbmVfKCB0aGlzLnZpc2libGVDb250ZW50UGFuZV8sIGZhbHNlICk7CgoJLy8gUmVtb3ZlIHRoZSB0YWIKCXJldHVybiBib290c3RyYXAzLlRhYnMuc3VwZXJDbGFzc18ucmVtb3ZlQ2hpbGQuY2FsbCh0aGlzLCB0YWIsIG9wdF91bnJlbmRlcik7Cn07CgoKLy8vKioKLy8gKiBDb25maWd1cmVzIHRoZSBjb250YWluZXIgYWZ0ZXIgaXRzIERPTSBoYXMgYmVlbiByZW5kZXJlZCwgYW5kIHNldHMgdXAgZXZlbnQgaGFuZGxpbmcuCi8vICogT3ZlcnJpZGVzIHtAbGluayBnb29nLnVpLkNvbXBvbmVudCNlbnRlckRvY3VtZW50fS4KLy8gKiBAb3ZlcnJpZGUKLy8gKi8KLy9ib290c3RyYXAzLlRhYnMucHJvdG90eXBlLmVudGVyRG9jdW1lbnQgPSBmdW5jdGlvbigpIHsKLy8JdGhpcy5oaXN0b3J5XyA9IG5ldyBnb29nLkhpc3RvcnkoKTsKCi8vCXZhciB0YWJzID0gdGhpczsKCi8vIEhhbmRsZSBjbGlja3Mgb24gZWFjaCB0YWIKLy8JZ29vZy5ldmVudHMubGlzdGVuKCB0aGlzLnRhYkJhcl8sIGdvb2cudWkuQ29tcG9uZW50LkV2ZW50VHlwZS5TRUxFQ1QsCi8vCQlmdW5jdGlvbihlKSB7Ci8vCQkJdmFyIHRhYiA9IGUudGFyZ2V0OwovLy8vCQkJYm9vdHN0cmFwMy5UYWJzLmxvZ2dlcl8uaW5mbygnU0VMRUNUIGV2ZW50OiAnICsgdGFiKTsKLy8vLwkJCXRhYnMuZG9TZWxlY3RUYWJfKHRhYik7Ci8vCQl9Ci8vCSk7Ci8vfTsKCmJvb3RzdHJhcDMuVGFicy5wcm90b3R5cGUuZGlzcG9zZUludGVybmFsID0gZnVuY3Rpb24oKSB7Ci8vCWJvb3RzdHJhcDMuVGFicy5zdXBlckNsYXNzXy5kaXNwb3NlSW50ZXJuYWwuY2FsbCh0aGlzKTsKCglnb29nLmV2ZW50cy51bmxpc3RlbkJ5S2V5KHRoaXMuc2VsZWN0SGFuZGxlcktleV8pOwoKCXRoaXMudGFiQmFyXy5kaXNwb3NlKCk7CglkZWxldGUgdGhpcy50YWJCYXJfOwovL2lmIHRoZSBjb21waWxlciBjb21wbGFpbnMgYWJvdXQgdGhpcy50YWJCYXJfLmdldEhhbmRsZXIoKQovLwl0aGlzLnJlbW92ZUFsbExpc3RlbmVycygpOwovLwlpZiAodGhpcy5ldmVudEhhbmRsZXJfKSB7Ci8vCQl0aGlzLmV2ZW50SGFuZGxlcl8uZGlzcG9zZSgpOwovLwkJZGVsZXRlIHRoaXMuZXZlbnRIYW5kbGVyXzsKLy8JfQp9OwoKLy9ib290c3RyYXAzLlRhYnMucHJvdG90eXBlLmdldEhhbmRsZXIgPSBmdW5jdGlvbigpIHsKLy8JcmV0dXJuIG5ldyBnb29nLmV2ZW50cy5FdmVudEhhbmRsZXIoKTsKLy99OwoKYm9vdHN0cmFwMy5UYWJzLnByb3RvdHlwZS5saXN0ZW5Ub1RhYkV2ZW50c18gPSBmdW5jdGlvbigpIHsKCS8vIExpc3RlbiBmb3IgU0VMRUNULCBVTlNFTEVDVCwgRElTQUJMRSwgYW5kIEhJREUgZXZlbnRzIGRpc3BhdGNoZWQgYnkgdGFicy4KLy8JdGhpcy50YWJCYXJfLmdldEhhbmRsZXIoKS4KCXRoaXMuc2VsZWN0SGFuZGxlcktleV8gPSBnb29nLmV2ZW50cy5saXN0ZW4odGhpcy50YWJCYXJfLAoJCQkJCQkJCQkJCQlnb29nLnVpLkNvbXBvbmVudC5FdmVudFR5cGUuU0VMRUNULAoJCQkJCQkJCQkJCQl0aGlzLmhhbmRsZVRhYlNlbGVjdCwgZmFsc2UsIHRoaXMpOwovLwkJbGlzdGVuKHRoaXMsIGdvb2cudWkuQ29tcG9uZW50LkV2ZW50VHlwZS5ESVNBQkxFLCB0aGlzLmhhbmRsZVRhYkRpc2FibGUpLgovLwkJbGlzdGVuKHRoaXMsIGdvb2cudWkuQ29tcG9uZW50LkV2ZW50VHlwZS5ISURFLCB0aGlzLmhhbmRsZVRhYkhpZGUpOwovLwkJW2dvb2cuZXZlbnRzLkV2ZW50VHlwZS5TRUxFQ1QsIGdvb2cuZXZlbnRzLkV2ZW50VHlwZS5DTElDS10sCi8vCQlnb29nLmJpbmQodGhpcy50YWJCYXJfLnNldFNlbGVjdGVkVGFiLCB0aGlzLnRhYkJhcl8sIHRhYikpOwp9OwoKLy9pZiB0aGUgY29tcGlsZXIgY29tcGxhaW5zIGFib3V0IHRoaXMudGFiQmFyXy5nZXRIYW5kbGVyKCkKLy9ib290c3RyYXAzLlRhYnMucHJvdG90eXBlLmdldEhhbmRsZXIgPSBmdW5jdGlvbigpIHsKLy8JaWYgKCF0aGlzLmV2ZW50SGFuZGxlcl8pIHsKLy8JCXRoaXMuZXZlbnRIYW5kbGVyXyA9IG5ldyBnb29nLmV2ZW50cy5FdmVudEhhbmRsZXIodGhpcyk7Ci8vCX0KLy8JcmV0dXJuIHRoaXMuZXZlbnRIYW5kbGVyXzsKLy99OwovLwovL2Jvb3RzdHJhcDMuVGFicy5wcm90b3R5cGUucmVtb3ZlQWxsTGlzdGVuZXJzID0gZnVuY3Rpb24oKSB7Ci8vCWlmICh0aGlzLmV2ZW50SGFuZGxlcl8pIHsKLy8JCXRoaXMuZXZlbnRIYW5kbGVyXy5yZW1vdmVBbGwoKTsKLy8JfQovL307CgoKYm9vdHN0cmFwMy5UYWJzLnByb3RvdHlwZS5zZXRTdGFja2VkID0gZnVuY3Rpb24oc3RhY2tlZCkgewoJdGhpcy50YWJCYXJfLnNldExvY2F0aW9uKHN0YWNrZWQgPyBnb29nLnVpLlRhYkJhci5Mb2NhdGlvbi5TVEFSVCA6IGdvb2cudWkuVGFiQmFyLkxvY2F0aW9uLlRPUCk7Cn07Cgpib290c3RyYXAzLlRhYnMucHJvdG90eXBlLnNldE9yaWVudGF0aW9uID0gZnVuY3Rpb24ob3JpZW50YXRpb24pIHsKCXZhciBlbGVtZW50ID0gdGhpcy50YWJCYXJfLmdldEVsZW1lbnQoKTsKCWlmKCBlbGVtZW50ICkgewoJCWdvb2cuZG9tLmNsYXNzZXMuZW5hYmxlKCBlbGVtZW50LCAnbmF2LXN0YWNrZWQnLAoJCQkJCQkJCWdvb2cudWkuQ29udGFpbmVyLk9yaWVudGF0aW9uLlZFUlRJQ0FMID09IG9yaWVudGF0aW9uICk7Cgl9Cgl0aGlzLnRhYkJhcl8ub3JpZW50YXRpb25fID0gb3JpZW50YXRpb247Cn07CgoKLyoqCiAqIEByZXR1cm5zIHtnb29nLnVpLlRhYkJhcn0KICovCmJvb3RzdHJhcDMuVGFicy5wcm90b3R5cGUuZ2V0VGFiQmFyID0gZnVuY3Rpb24oKSB7CglyZXR1cm4gdGhpcy50YWJCYXJfOwp9OwoKLy8vKiogTWFrZSB0aGlzIHdvcmsgd2l0aCBDb21wb25lbnQvQ29udGFpbmVyLmFkZENoaWxkKCB0aGlzLCBib29sZWFuICkgKi8KLy9ib290c3RyYXAzLlRhYnMucHJvdG90eXBlLmdldFBhcmVudCA9IGZ1bmN0aW9uKCkgewovLwlyZXR1cm4gdGhpcy5wYXJlbnRfOyAvL3RhYkJhcl8uZ2V0UGFyZW50KCk7Ci8vfTsKLy9ib290c3RyYXAzLlRhYnMucHJvdG90eXBlLnNldFBhcmVudCA9IGZ1bmN0aW9uKHBhcmVudCkgewovLwl0aGlzLnBhcmVudF8gPSBwYXJlbnQ7IC8vdGFiQmFyXy5zZXRQYXJlbnQocGFyZW50KTsKLy99OwovL2Jvb3RzdHJhcDMuVGFicy5wcm90b3R5cGUuZ2V0SWQgPSBmdW5jdGlvbigpIHsKLy8JcmV0dXJuIHRoaXMudGFiQmFyXy5nZXRJZCgpOwovL307CgovKioKICogQHBhcmFtIHtudW1iZXJ9IHNlbGVjdGVkVGFiSW5kZXgKICovCmJvb3RzdHJhcDMuVGFicy5wcm90b3R5cGUuc2V0U2VsZWN0ZWRUYWJJbmRleCA9IGZ1bmN0aW9uIChzZWxlY3RlZFRhYkluZGV4KSB7Cgl0aGlzLnRhYkJhcl8uc2V0U2VsZWN0ZWRUYWJJbmRleCggc2VsZWN0ZWRUYWJJbmRleCApOwp9OwoKLyoqCiAqIEBwYXJhbSB7ZnVuY3Rpb24oZ29vZy51aS5UYWIsIG51bWJlcj0pfSBmCiAqLwpib290c3RyYXAzLlRhYnMucHJvdG90eXBlLmZvckVhY2hUYWIgPSBmdW5jdGlvbiggZiApIHsKCXRoaXMudGFiQmFyXy5mb3JFYWNoQ2hpbGQoIGYgKTsKfTsKCgpib290c3RyYXAzLlRhYnMucHJvdG90eXBlLmhhbmRsZVRhYlNlbGVjdCA9IGZ1bmN0aW9uKGUpIHsKCXRoaXMuZG9TZWxlY3RUYWJfKCBlLnRhcmdldCApOwp9OwoKCi8qKgogKiBJZiB0aGUgc2VsZWN0ZWQgdGFiIGhhcyBhIGZyYWdtZW50IFVSTCwgc2hvdyB0aGUgY29udGVudCBwYW5lIHdpdGggYW4gSUQgbWF0Y2hpbmcgdGhlIGZyYWdtZW50LgogKiBPdGhlcndpc2UsCiAqIEBwYXJhbSB7Z29vZy51aS5UYWJ9IHRhYgogKiBAcHJpdmF0ZQogKi8KYm9vdHN0cmFwMy5UYWJzLnByb3RvdHlwZS5kb1NlbGVjdFRhYl8gPSBmdW5jdGlvbiggdGFiICkgewoJdmFyIHRhYkVsZW1lbnQgPSB0YWIuZ2V0RWxlbWVudCgpLAoJCWEgPSBnb29nLmRvbS5nZXRGaXJzdEVsZW1lbnRDaGlsZCh0YWJFbGVtZW50KSwKCQlocmVmID0gbmV3IGdvb2cuVXJpKGEuaHJlZiksCgkJdGFicyA9IHRoaXM7CgoJdGhpcy5zaG93VGFiQ29udGVudFBhbmVfKCAvKiogQHR5cGUgeyFIVE1MRGl2RWxlbWVudH0gKi8odGhpcy52aXNpYmxlQ29udGVudFBhbmVfKSwgZmFsc2UgKTsKCWlmKCBocmVmLmhhc0ZyYWdtZW50KCkgKSB7CgkJdmFyIGZyYWdtZW50ID0gaHJlZi5nZXRGcmFnbWVudCgpOwoJCWJvb3RzdHJhcDMuVGFicy5sb2dnZXJfLmZpbmUoJ3JlIG9wZW4gdGFiICcgKyBmcmFnbWVudCApOwoJCXZhciBjb250ZW50UGFuZSA9IC8qKiBAdHlwZSB7IUhUTUxEaXZFbGVtZW50fSAqLyhnb29nLmRvbS5nZXRFbGVtZW50KCBmcmFnbWVudCApKTsKCQl0aGlzLnNob3dUYWJDb250ZW50UGFuZV8oIGNvbnRlbnRQYW5lLCB0cnVlLCBmcmFnbWVudCApOwoJfSBlbHNlIHsKCQlib290c3RyYXAzLlRhYnMubG9nZ2VyXy5maW5lKCdkb3dubG9hZCBjb250ZW50IGZvciB0YWIgJyArIGhyZWYpOwoJCWdvb2cubmV0LlhocklvLnNlbmQoIGhyZWYsIGZ1bmN0aW9uKGV2ZW50KSB7CgkJCWlmKCBldmVudC50YXJnZXQuaXNTdWNjZXNzKCkgKSB7CgkJCQkvLyBpbmplY3QgdGhlIGNvbnRlbnQgYXMgYSBuZXcgZGl2IGFuZCB1cGRhdGUgdGhlIDxhPidzIGhyZWYgdG8gcG9pbnQgYXQgdGhlIHRhYlBhbmUKCQkJCXZhciBodG1sID0gZXZlbnQudGFyZ2V0LmdldFJlc3BvbnNlVGV4dCgpLAoJCQkJCXRhYlBhbmVJZCA9IHRhYi5nZXRJZCgpICsgJ19jb250ZW50JywKCQkJCQljb250ZW50UGFuZSA9IC8qKiBAdHlwZSB7SFRNTEVsZW1lbnR9ICovKGdvb2cuZG9tLmNyZWF0ZURvbSgnZGl2Jywge2lkOiB0YWJQYW5lSWR9LAoJCQkJCQl0YWJzLmRvbV8uaHRtbFRvRG9jdW1lbnRGcmFnbWVudChodG1sKSApKTsKCQkJCS8vIFRPRE86IHVzZSB0aGUgdXRpbC5nZXRUZW1wRnJhbWUoKSBtZXRob2QgdG8gaW5zZXJ0IHRoZSByZXNwb25zZVRleHQgaW50byBvdXIgRE9NPwoKCQkJCWEuaHJlZiA9ICcjJyArIHRhYlBhbmVJZDsKCQkJCS8vZ29vZy5kb20uYXBwZW5kQ2hpbGQoIHRhYkVsZW1lbnQucGFyZW50Tm9kZSwgbmV3Tm9kZSApCgkJCQlnb29nLmRvbS5pbnNlcnRTaWJsaW5nQWZ0ZXIoIGNvbnRlbnRQYW5lLCB0YWJFbGVtZW50LnBhcmVudE5vZGUgKTsKLy8JCQkJZ29vZy5kb20uY2xhc3Nlcy5hZGQoIGNvbnRlbnRQYW5lLCAndGFiLXBhbmVsJyApOwoJCQkJdGFicy5zaG93VGFiQ29udGVudFBhbmVfKCBjb250ZW50UGFuZSwgdHJ1ZSwgdGFiUGFuZUlkICk7CgkJCQlib290c3RyYXAzLlRhYnMuZGVjb3JhdGVDb250ZW50UGFuZSggY29udGVudFBhbmUsIHRhYnMuZmFkZSApOwoJCQkJdGFicy5kaXNwYXRjaEV2ZW50KCBuZXcgZ29vZy5ldmVudHMuRXZlbnQoIGdvb2cuZXZlbnRzLkV2ZW50VHlwZS5MT0FELCBjb250ZW50UGFuZSApICk7Ci8vCQkJfSBlbHNlIHsKLy8JCQkgCXZhciBzdGF0dXMgPSBldmVudC50YXJnZXQuZ2V0U3RhdHVzKCk7ICAgCQkvLyA0MDQKLy8JCQkgCXZhciBzdGF0dXNUZXh0ID0gZXZlbnQudGFyZ2V0LmdldFN0YXR1c1RleHQoKTsgLy8gbm90IGZvdW5kCi8vCQkJCXZhciBqc29uID0gZXZlbnQudGFyZ2V0LmdldFJlc3BvbnNlSnNvbigpOwoJCQl9CgkJfSk7Cgl9Cn07CgoKLyoqCiAqIEBwYXJhbSB7IUhUTUxEaXZFbGVtZW50fSBjb250ZW50UGFuZQogKiBAcGFyYW0ge2Jvb2xlYW59IHNob3cKICogQHBhcmFtIHtzdHJpbmc9fSB0YWJJZCAtIFRoZSBVUkwgZnJhZ21lbnQuIGVnOiAnc2VhcmNoVGFiJywgJ3RhYjFfY29udGVudCcsICdhZGRUYWJUYWInLgogKiAJCQkJCQkJQ2FuIGJlIHVuZGVmaW5lZCBpZiB7QGNvZGUgc2hvd30gaXMgZmFsc2UKICogQHByaXZhdGUKICovCmJvb3RzdHJhcDMuVGFicy5wcm90b3R5cGUuc2hvd1RhYkNvbnRlbnRQYW5lXyA9IGZ1bmN0aW9uKCBjb250ZW50UGFuZSwgc2hvdywgdGFiSWQgKSB7CglpZiggY29udGVudFBhbmUgKSB7CgkJLy9pZiggc2hvdyApIHsgZ29vZy5kb20uY2xhc3Nlcy5hZGQoIGNvbnRlbnRQYW5lLCAndGFiLXBhbmUnLCAnZmFkZScsICdpbicsICdhY3RpdmUnICk7IH0KCQlnb29nLmRvbS5jbGFzc2VzLmVuYWJsZSggY29udGVudFBhbmUsICdhY3RpdmUnLCBzaG93ICk7CgkJaWYoIHRoaXMuZmFkZSApIHsKCQkJZ29vZy5kb20uY2xhc3Nlcy5lbmFibGUoIGNvbnRlbnRQYW5lLCAnaW4nLCBzaG93ICk7CgkJfQoKLy8JCWdvb2cuc3R5bGUuc2hvd0VsZW1lbnQoIGNvbnRlbnRQYW5lLCBzaG93ICk7CgkJaWYoIHNob3cgKSB7CgkJCXZhciBzY3JvbGxUb3AgPSB3aW5kb3cuZG9jdW1lbnQuYm9keS5zY3JvbGxUb3A7CgoJCQl0aGlzLnN0b3JlVGFiSWRJbkhpc3RvcnkoIHRhYklkICk7CgoJCQkvLyByZXNldCB0aGUgc2Nyb2xsIHBvc2l0aW9uIChzZXR0aW5nIHdpbmRvdy5sb2NhdGlvbi5oYXNoIHNjcm9sbHMgdG8gdGhlIGFuY2hvciBsb2NhdGlvbikKLy8JCQl3aW5kb3cuZG9jdW1lbnQuYm9keS5zY3JvbGxUb3AgPSBzY3JvbGxUb3A7CgkJCXdpbmRvdy5zY3JvbGxUbyggd2luZG93LmRvY3VtZW50LmJvZHkuc2Nyb2xsTGVmdCwgc2Nyb2xsVG9wICk7CgoJCQl0aGlzLnZpc2libGVDb250ZW50UGFuZV8gPSBjb250ZW50UGFuZTsKCQl9Cgl9Cn07CgoKLyoqCiAqIEByZXR1cm4ge251bWJlcn0KICovCmJvb3RzdHJhcDMuVGFicy5wcm90b3R5cGUuZ2V0U2VsZWN0ZWRUYWJJbmRleCA9IGZ1bmN0aW9uKCkgewoJcmV0dXJuIHRoaXMudGFiQmFyXy5nZXRTZWxlY3RlZFRhYkluZGV4KCk7Cn07CgovKioKICogQHJldHVybiB7RWxlbWVudH0KICovCmJvb3RzdHJhcDMuVGFicy5wcm90b3R5cGUuZ2V0Q3VycmVudENvbnRlbnRQYW5lID0gZnVuY3Rpb24oKSB7CglyZXR1cm4gdGhpcy52aXNpYmxlQ29udGVudFBhbmVfOwp9OwoKLyoqCiAqIEByZXR1cm4ge251bWJlcn0KICovCmJvb3RzdHJhcDMuVGFicy5wcm90b3R5cGUuZ2V0TWluV2lkdGggPSBmdW5jdGlvbigpIHsKCS8vcmV0dXJuIHRoaXMudGFiQmFyXy5nZXRDb250ZW50RWxlbWVudCgpLmNsaWVudFdpZHRoOwoJdmFyIGVsID0gdGhpcy50YWJCYXJfLmdldENvbnRlbnRFbGVtZW50KCksCgkJd2lkdGggPSA4LCAvL2dvb2cuc3R5bGUuZ2V0UGFkZGluZ0JveCggZWwgKS5sZWZ0ICogMiwKCQlpID0gdGhpcy50YWJCYXJfLmdldENoaWxkQ291bnQoKTsKCXdoaWxlKCBpLS0gIT0gMCApIHsKCQllbCA9IHRoaXMudGFiQmFyXy5nZXRDaGlsZEF0KGkpLmdldENvbnRlbnRFbGVtZW50KCk7CgkJd2lkdGggKz0gKGVsLm9mZnNldFdpZHRoICsgMik7Cgl9CglyZXR1cm4gd2lkdGg7Cn07Cg==",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Thu, 06 Nov 2014 15:34:21 GMT",
                    "Content-Length": "20977",
                    "Date": "Thu, 06 Nov 2014 15:34:25 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}