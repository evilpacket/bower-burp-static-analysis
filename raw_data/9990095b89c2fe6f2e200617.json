{
    "url": "http://localhost:9999/ariya/esprima/demo/parse.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "DOM data manipulation (DOM-based)",
    "issueType": 5247488,
    "severity": "Information",
    "confidence": "Firm",
    "issueBackground": "DOM-based DOM data manipulation vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this to a data field within the DOM that is used within the visible UI or client-side application logic. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will modify the appearance or behavior of the client-side UI. An attacker may be able to leverage this to perform virtual defacement of the application, or possibly to induce the user to perform unintended actions.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based DOM data manipulation vulnerabilities is not to dynamically write to DOM data fields any data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from being stored. In general, this is best achieved by using a whitelist of permitted values.",
    "issueDetail": "The application may be vulnerable to DOM-based DOM data manipulation. Data is read from <b>location.pathname</b> and written to <b>the 'value' property of a DOM element</b> via the following statement:<ul><li>el.value = location.protocol + \"//\" + location.host + location.pathname + '?code=' + encodeURIComponent(code);</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/ariya/esprima/demo/parse.js",
                "path": "/ariya/esprima/demo/parse.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9hcml5YS9lc3ByaW1hL2RlbW8vcGFyc2UuanMgSFRUUC8xLjENCkhvc3Q6IGxvY2FsaG9zdDo5OTk5DQoNCg==",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMTAxNjENCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IFRodSwgMDYgTm92IDIwMTQgMjM6MjQ6NTQgR01UDQpMYXN0LU1vZGlmaWVkOiBUaHUsIDA2IE5vdiAyMDE0IDIzOjI0OjUzIEdNVA0KDQovKgogIENvcHlyaWdodCAoQykgMjAxMyBBcml5YSBIaWRheWF0IDxhcml5YS5oaWRheWF0QGdtYWlsLmNvbT4KICBDb3B5cmlnaHQgKEMpIDIwMTIgQXJpeWEgSGlkYXlhdCA8YXJpeWEuaGlkYXlhdEBnbWFpbC5jb20+CiAgQ29weXJpZ2h0IChDKSAyMDExIEFyaXlhIEhpZGF5YXQgPGFyaXlhLmhpZGF5YXRAZ21haWwuY29tPgoKICBSZWRpc3RyaWJ1dGlvbiBhbmQgdXNlIGluIHNvdXJjZSBhbmQgYmluYXJ5IGZvcm1zLCB3aXRoIG9yIHdpdGhvdXQKICBtb2RpZmljYXRpb24sIGFyZSBwZXJtaXR0ZWQgcHJvdmlkZWQgdGhhdCB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnMgYXJlIG1ldDoKCiAgICAqIFJlZGlzdHJpYnV0aW9ucyBvZiBzb3VyY2UgY29kZSBtdXN0IHJldGFpbiB0aGUgYWJvdmUgY29weXJpZ2h0CiAgICAgIG5vdGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lci4KICAgICogUmVkaXN0cmlidXRpb25zIGluIGJpbmFyeSBmb3JtIG11c3QgcmVwcm9kdWNlIHRoZSBhYm92ZSBjb3B5cmlnaHQKICAgICAgbm90aWNlLCB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyIGluIHRoZQogICAgICBkb2N1bWVudGF0aW9uIGFuZC9vciBvdGhlciBtYXRlcmlhbHMgcHJvdmlkZWQgd2l0aCB0aGUgZGlzdHJpYnV0aW9uLgoKICBUSElTIFNPRlRXQVJFIElTIFBST1ZJREVEIEJZIFRIRSBDT1BZUklHSFQgSE9MREVSUyBBTkQgQ09OVFJJQlVUT1JTICJBUyBJUyIKICBBTkQgQU5ZIEVYUFJFU1MgT1IgSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgVEhFCiAgSU1QTElFRCBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSBBTkQgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UKICBBUkUgRElTQ0xBSU1FRC4gSU4gTk8gRVZFTlQgU0hBTEwgPENPUFlSSUdIVCBIT0xERVI+IEJFIExJQUJMRSBGT1IgQU5ZCiAgRElSRUNULCBJTkRJUkVDVCwgSU5DSURFTlRBTCwgU1BFQ0lBTCwgRVhFTVBMQVJZLCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVMKICAoSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFBST0NVUkVNRU5UIE9GIFNVQlNUSVRVVEUgR09PRFMgT1IgU0VSVklDRVM7CiAgTE9TUyBPRiBVU0UsIERBVEEsIE9SIFBST0ZJVFM7IE9SIEJVU0lORVNTIElOVEVSUlVQVElPTikgSE9XRVZFUiBDQVVTRUQgQU5ECiAgT04gQU5ZIFRIRU9SWSBPRiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQ09OVFJBQ1QsIFNUUklDVCBMSUFCSUxJVFksIE9SIFRPUlQKICAoSU5DTFVESU5HIE5FR0xJR0VOQ0UgT1IgT1RIRVJXSVNFKSBBUklTSU5HIElOIEFOWSBXQVkgT1VUIE9GIFRIRSBVU0UgT0YKICBUSElTIFNPRlRXQVJFLCBFVkVOIElGIEFEVklTRUQgT0YgVEhFIFBPU1NJQklMSVRZIE9GIFNVQ0ggREFNQUdFLgoqLwoKLypqc2xpbnQgc2xvcHB5OnRydWUgYnJvd3Nlcjp0cnVlICovCi8qZ2xvYmFsIGVzcHJpbWE6dHJ1ZSwgWVVJOnRydWUsIHJlcXVpcmU6dHJ1ZSAqLwoKdmFyIHBhcnNlSWQsIHRyZWU7CgpmdW5jdGlvbiBpZChpKSB7CiAgICByZXR1cm4gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaSk7Cn0KCllVSSh7IGdhbGxlcnk6ICdnYWxsZXJ5LTIwMTMuMDEuMDktMjMtMjQnIH0pLnVzZSgnZ2FsbGVyeS1zbS10cmVldmlldycsIGZ1bmN0aW9uIChZKSB7CgogICAgd2luZG93LnVwZGF0ZVRyZWUgPSBmdW5jdGlvbiAoc3ludGF4KSB7CgogICAgICAgIGlmICh0eXBlb2Ygc3ludGF4ID09PSAndW5kZWZpbmVkJykgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiAoaWQoJ3RhYl90cmVlJykuY2xhc3NOYW1lICE9PSAnYWN0aXZlJykgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiAodHlwZW9mIHRyZWUgPT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgIHRyZWUgPSBuZXcgWS5UcmVlVmlldyh7CiAgICAgICAgICAgICAgICBsYXp5UmVuZGVyOiBmYWxzZSwKICAgICAgICAgICAgICAgIGNvbnRhaW5lcjogJyN0cmVldmlldycKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRyZWUucmVuZGVyKCk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBjb2xsYXBzZUFsbCgpIHsKICAgICAgICAgICAgWS5hbGwoJy55dWkzLXRyZWV2aWV3LWNhbi1oYXZlLWNoaWxkcmVuJykuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB0cmVlLmdldE5vZGVCeUlkKHRoaXMuZ2V0KCdpZCcpKS5jbG9zZSgpOwogICAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGV4cGFuZEFsbCgpIHsKICAgICAgICAgICAgWS5hbGwoJy55dWkzLXRyZWV2aWV3LWNhbi1oYXZlLWNoaWxkcmVuJykuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB0cmVlLmdldE5vZGVCeUlkKHRoaXMuZ2V0KCdpZCcpKS5vcGVuKCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgaWQoJ2NvbGxhcHNlJykub25jbGljayA9IGNvbGxhcHNlQWxsOwogICAgICAgIGlkKCdleHBhbmQnKS5vbmNsaWNrID0gZXhwYW5kQWxsOwoKICAgICAgICBmdW5jdGlvbiBpc0FycmF5KG8pIHsKICAgICAgICAgICAgcmV0dXJuICh0eXBlb2YgQXJyYXkuaXNBcnJheSA9PT0gJ2Z1bmN0aW9uJykgPyBBcnJheS5pc0FycmF5KG8pIDoKICAgICAgICAgICAgICAgIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuYXBwbHkobykgPT09ICdbb2JqZWN0IEFycmF5XSc7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBjb252ZXJ0KG5hbWUsIG5vZGUpIHsKICAgICAgICAgICAgdmFyIGksIGtleSwgaXRlbSwgc3ViaXRlbTsKCiAgICAgICAgICAgIGl0ZW0gPSB0cmVlLmNyZWF0ZU5vZGUoKTsKCiAgICAgICAgICAgIHN3aXRjaCAodHlwZW9mIG5vZGUpIHsKCiAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6CiAgICAgICAgICAgIGNhc2UgJ251bWJlcic6CiAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOgogICAgICAgICAgICAgICAgaXRlbS5sYWJlbCA9IG5hbWUgKyAnOiAnICsgbm9kZS50b1N0cmluZygpOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlICdvYmplY3QnOgogICAgICAgICAgICAgICAgaWYgKCFub2RlKSB7CiAgICAgICAgICAgICAgICAgICAgaXRlbS5sYWJlbCA9IG5hbWUgKyAnOiBudWxsJzsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXRlbTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChub2RlIGluc3RhbmNlb2YgUmVnRXhwKSB7CiAgICAgICAgICAgICAgICAgICAgaXRlbS5sYWJlbCA9IG5hbWUgKyAnOiAnICsgbm9kZS50b1N0cmluZygpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBpdGVtOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaXRlbS5sYWJlbCA9IG5hbWU7CiAgICAgICAgICAgICAgICBpZiAoaXNBcnJheShub2RlKSkgewogICAgICAgICAgICAgICAgICAgIGlmIChub2RlLmxlbmd0aCA9PT0gMiAmJiBuYW1lID09PSAncmFuZ2UnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0ubGFiZWwgPSBuYW1lICsgJzogWycgKyBub2RlWzBdICsgJywgJyArIG5vZGVbMV0gKyAnXSc7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5sYWJlbCA9IGl0ZW0ubGFiZWwgKyAnIFsnICsgbm9kZS5sZW5ndGggKyAnXSc7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBub2RlLmxlbmd0aDsgaSArPSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJpdGVtID0gY29udmVydChTdHJpbmcoaSksIG5vZGVbaV0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN1Yml0ZW0uY2hpbGRyZW4ubGVuZ3RoID09PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5hcHBlbmQoc3ViaXRlbS5jaGlsZHJlblswXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uYXBwZW5kKHN1Yml0ZW0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBub2RlLnR5cGUgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0ubGFiZWwgPSBuYW1lOwogICAgICAgICAgICAgICAgICAgICAgICBzdWJpdGVtID0gdHJlZS5jcmVhdGVOb2RlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHN1Yml0ZW0ubGFiZWwgPSBub2RlLnR5cGU7CiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uYXBwZW5kKHN1Yml0ZW0pOwogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGtleSBpbiBub2RlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG5vZGUsIGtleSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoa2V5ICE9PSAndHlwZScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3ViaXRlbS5hcHBlbmQoY29udmVydChrZXksIG5vZGVba2V5XSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoa2V5IGluIG5vZGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobm9kZSwga2V5KSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uYXBwZW5kKGNvbnZlcnQoa2V5LCBub2RlW2tleV0pKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIGl0ZW0ubGFiZWwgPSAnW1Vua25vd25dJzsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gaXRlbTsKICAgICAgICB9CgoKICAgICAgICB0cmVlLmNsZWFyKCk7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RyZWV2aWV3JykuaW5uZXJIVE1MID0gJyc7CiAgICAgICAgdHJlZS5yb290Tm9kZS5hcHBlbmQoY29udmVydCgnUHJvZ3JhbSBib2R5Jywgc3ludGF4LmJvZHkpKTsKICAgICAgICB0cmVlLnJlbmRlcigpOwoKICAgICAgICBleHBhbmRBbGwoKTsKICAgIH07Cgp9KTsKCgpmdW5jdGlvbiBwYXJzZShkZWxheSkgewogICAgaWYgKHBhcnNlSWQpIHsKICAgICAgICB3aW5kb3cuY2xlYXJUaW1lb3V0KHBhcnNlSWQpOwogICAgfQoKICAgIHBhcnNlSWQgPSB3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGNvZGUsIG9wdGlvbnMsIHJlc3VsdCwgZWwsIHN0cjsKCiAgICAgICAgLy8gU3BlY2lhbCBoYW5kbGluZyBmb3IgcmVndWxhciBleHByZXNzaW9uIGxpdGVyYWwgc2luY2Ugd2UgbmVlZCB0bwogICAgICAgIC8vIGNvbnZlcnQgaXQgdG8gYSBzdHJpbmcgbGl0ZXJhbCwgb3RoZXJ3aXNlIGl0IHdpbGwgYmUgZGVjb2RlZAogICAgICAgIC8vIGFzIG9iamVjdCAie30iIGFuZCB0aGUgcmVndWxhciBleHByZXNzaW9uIHdvdWxkIGJlIGxvc3QuCiAgICAgICAgZnVuY3Rpb24gYWRqdXN0UmVnZXhMaXRlcmFsKGtleSwgdmFsdWUpIHsKICAgICAgICAgICAgaWYgKGtleSA9PT0gJ3ZhbHVlJyAmJiB2YWx1ZSBpbnN0YW5jZW9mIFJlZ0V4cCkgewogICAgICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZS50b1N0cmluZygpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICB9CgogICAgICAgIGNvZGUgPSB3aW5kb3cuZWRpdG9yLmdldFRleHQoKTsKICAgICAgICBvcHRpb25zID0gewogICAgICAgICAgICBhdHRhY2hDb21tZW50OiBpZCgnY29tbWVudCcpLmNoZWNrZWQsCiAgICAgICAgICAgIHJhbmdlOiBpZCgncmFuZ2UnKS5jaGVja2VkLAogICAgICAgICAgICBsb2M6IGlkKCdsb2MnKS5jaGVja2VkLAogICAgICAgICAgICB0b2xlcmFudDogaWQoJ3RvbGVyYW50JykuY2hlY2tlZAogICAgICAgIH07CgogICAgICAgIGlkKCd0b2tlbnMnKS52YWx1ZSA9ICcnOwogICAgICAgIGlkKCdpbmZvJykuY2xhc3NOYW1lID0gJ2FsZXJ0LWJveCBzZWNvbmRhcnknOwoKICAgICAgICB0cnkgewogICAgICAgICAgICByZXN1bHQgPSBlc3ByaW1hLnBhcnNlKGNvZGUsIG9wdGlvbnMpOwogICAgICAgICAgICBzdHIgPSBKU09OLnN0cmluZ2lmeShyZXN1bHQsIGFkanVzdFJlZ2V4TGl0ZXJhbCwgNCk7CiAgICAgICAgICAgIG9wdGlvbnMudG9rZW5zID0gdHJ1ZTsKICAgICAgICAgICAgaWQoJ3Rva2VucycpLnZhbHVlID0gSlNPTi5zdHJpbmdpZnkoZXNwcmltYS5wYXJzZShjb2RlLCBvcHRpb25zKS50b2tlbnMsCiAgICAgICAgICAgICAgICBhZGp1c3RSZWdleExpdGVyYWwsIDQpOwogICAgICAgICAgICBpZiAod2luZG93LnVwZGF0ZVRyZWUpIHsKICAgICAgICAgICAgICAgIHdpbmRvdy51cGRhdGVUcmVlKHJlc3VsdCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWQoJ2luZm8nKS5pbm5lckhUTUwgPSAnTm8gZXJyb3InOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgaWYgKHdpbmRvdy51cGRhdGVUcmVlKSB7CiAgICAgICAgICAgICAgICB3aW5kb3cudXBkYXRlVHJlZSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN0ciA9IGUubmFtZSArICc6ICcgKyBlLm1lc3NhZ2U7CiAgICAgICAgICAgIGlkKCdpbmZvJykuaW5uZXJIVE1MICA9IHN0cjsKICAgICAgICAgICAgaWQoJ2luZm8nKS5jbGFzc05hbWUgPSAnYWxlcnQtYm94IGFsZXJ0JzsKICAgICAgICB9CgogICAgICAgIGVsID0gaWQoJ3N5bnRheCcpOwogICAgICAgIGVsLnZhbHVlID0gc3RyOwoKICAgICAgICBlbCA9IGlkKCd1cmwnKTsKICAgICAgICBlbC52YWx1ZSA9IGxvY2F0aW9uLnByb3RvY29sICsgIi8vIiArIGxvY2F0aW9uLmhvc3QgKyBsb2NhdGlvbi5wYXRobmFtZSArICc/Y29kZT0nICsgZW5jb2RlVVJJQ29tcG9uZW50KGNvZGUpOwoKICAgICAgICBwYXJzZUlkID0gdW5kZWZpbmVkOwogICAgfSwgZGVsYXkgfHwgODExKTsKfQoKd2luZG93Lm9ubG9hZCA9IGZ1bmN0aW9uICgpIHsKICAgIGZ1bmN0aW9uIHF1aWNrUGFyc2UoKSB7IHBhcnNlKDEpOyB9CgogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbW1lbnQnKS5vbmNoYW5nZSA9IHF1aWNrUGFyc2U7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmFuZ2UnKS5vbmNoYW5nZSA9IHF1aWNrUGFyc2U7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9jJykub25jaGFuZ2UgPSBxdWlja1BhcnNlOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvbGVyYW50Jykub25jaGFuZ2UgPSBxdWlja1BhcnNlOwoKICAgIC8vIFNwZWNpYWwgaGFuZGxpbmcgZm9yIElFLgogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbW1lbnQnKS5vbmNsaWNrID0gcXVpY2tQYXJzZTsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyYW5nZScpLm9uY2xpY2sgPSBxdWlja1BhcnNlOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYycpLm9uY2xpY2sgPSBxdWlja1BhcnNlOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvbGVyYW50Jykub25jbGljayA9IHF1aWNrUGFyc2U7CgogICAgaWQoJ3Nob3dfc3ludGF4Jykub25jbGljayA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBpZCgndGFiX3RyZWUnKS5jbGFzc05hbWUgPSBpZCgnc2hvd190cmVlJykuY2xhc3NOYW1lID0gJyc7CiAgICAgICAgaWQoJ3RhYl9zeW50YXgnKS5jbGFzc05hbWUgPSBpZCgnc2hvd19zeW50YXgnKS5jbGFzc05hbWUgPSAnYWN0aXZlJzsKICAgICAgICBpZCgndGFiX3Rva2VucycpLmNsYXNzTmFtZSA9IGlkKCdzaG93X3Rva2VucycpLmNsYXNzTmFtZSA9ICcnOwogICAgICAgIGlkKCd0YWJfdHJlZScpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgaWQoJ3RhYl9zeW50YXgnKS5zdHlsZS5kaXNwbGF5ID0gJyc7CiAgICAgICAgaWQoJ3RhYl90b2tlbnMnKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgfTsKCiAgICBpZCgnc2hvd190cmVlJykub25jbGljayA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBpZCgndGFiX3RyZWUnKS5jbGFzc05hbWUgPSBpZCgnc2hvd190cmVlJykuY2xhc3NOYW1lID0gJ2FjdGl2ZSc7CiAgICAgICAgaWQoJ3RhYl9zeW50YXgnKS5jbGFzc05hbWUgPSBpZCgnc2hvd19zeW50YXgnKS5jbGFzc05hbWUgPSAnJzsKICAgICAgICBpZCgndGFiX3Rva2VucycpLmNsYXNzTmFtZSA9IGlkKCdzaG93X3Rva2VucycpLmNsYXNzTmFtZSA9ICcnOwogICAgICAgIGlkKCd0YWJfdHJlZScpLnN0eWxlLmRpc3BsYXkgPSAnJzsKICAgICAgICBpZCgndGFiX3N5bnRheCcpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgaWQoJ3RhYl90b2tlbnMnKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgIHF1aWNrUGFyc2UoKTsKICAgIH07CgogICAgaWQoJ3Nob3dfdG9rZW5zJykub25jbGljayA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBpZCgndGFiX3RyZWUnKS5jbGFzc05hbWUgPSBpZCgnc2hvd190cmVlJykuY2xhc3NOYW1lID0gJyc7CiAgICAgICAgaWQoJ3RhYl9zeW50YXgnKS5jbGFzc05hbWUgPSBpZCgnc2hvd19zeW50YXgnKS5jbGFzc05hbWUgPSAnJzsKICAgICAgICBpZCgndGFiX3Rva2VucycpLmNsYXNzTmFtZSA9IGlkKCdzaG93X3Rva2VucycpLmNsYXNzTmFtZSA9ICdhY3RpdmUnOwogICAgICAgIGlkKCd0YWJfdHJlZScpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgaWQoJ3RhYl9zeW50YXgnKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgIGlkKCd0YWJfdG9rZW5zJykuc3R5bGUuZGlzcGxheSA9ICcnOwogICAgfTsKCiAgICB0cnkgewogICAgICAgIHJlcXVpcmUoWydjdXN0b20vZWRpdG9yJ10sIGZ1bmN0aW9uIChlZGl0b3IpIHsKICAgICAgICAgICAgdmFyIHF1ZXJpZXMsIGVsZW1lbnRzLCBjb2RlLCBpLCBpeiwgcGFpcjsKCiAgICAgICAgICAgIHdpbmRvdy5lZGl0b3IgPSBlZGl0b3IoeyBwYXJlbnQ6ICdlZGl0b3InLCBsYW5nOiAnanMnIH0pOwogICAgICAgICAgICB3aW5kb3cuZWRpdG9yLmdldFRleHRWaWV3KCkuZ2V0TW9kZWwoKS5hZGRFdmVudExpc3RlbmVyKCJDaGFuZ2VkIiwgcGFyc2UpOwogICAgICAgICAgICBwYXJzZSgxMDApOwoKICAgICAgICAgICAgaWYgKGxvY2F0aW9uLnNlYXJjaCkgewogICAgICAgICAgICAgICAgcXVlcmllcyA9IHt9OwogICAgICAgICAgICAgICAgZWxlbWVudHMgPSBsb2NhdGlvbi5zZWFyY2guc3Vic3RyaW5nKDEpLnNwbGl0KC9bOyZdLyk7CiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwLCBpeiA9IGVsZW1lbnRzLmxlbmd0aDsgaSA8IGl6OyBpICs9IDEpIHsKICAgICAgICAgICAgICAgICAgICBwYWlyID0gZWxlbWVudHNbaV0uc3BsaXQoJz0nKTsKICAgICAgICAgICAgICAgICAgICBpZiAocGFpci5sZW5ndGggPT09IDIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcXVlcmllc1tkZWNvZGVVUklDb21wb25lbnQocGFpclswXSldID0gZGVjb2RlVVJJQ29tcG9uZW50KHBhaXJbMV0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvZGUgPSBxdWVyaWVzLmNvZGU7CiAgICAgICAgICAgICAgICBpZiAoY29kZSkgewogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5lZGl0b3Iuc2V0VGV4dChjb2RlKTsKICAgICAgICAgICAgICAgICAgICBxdWlja1BhcnNlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgIH0KCgp9Owo=",
                "body": "LyoKICBDb3B5cmlnaHQgKEMpIDIwMTMgQXJpeWEgSGlkYXlhdCA8YXJpeWEuaGlkYXlhdEBnbWFpbC5jb20+CiAgQ29weXJpZ2h0IChDKSAyMDEyIEFyaXlhIEhpZGF5YXQgPGFyaXlhLmhpZGF5YXRAZ21haWwuY29tPgogIENvcHlyaWdodCAoQykgMjAxMSBBcml5YSBIaWRheWF0IDxhcml5YS5oaWRheWF0QGdtYWlsLmNvbT4KCiAgUmVkaXN0cmlidXRpb24gYW5kIHVzZSBpbiBzb3VyY2UgYW5kIGJpbmFyeSBmb3Jtcywgd2l0aCBvciB3aXRob3V0CiAgbW9kaWZpY2F0aW9uLCBhcmUgcGVybWl0dGVkIHByb3ZpZGVkIHRoYXQgdGhlIGZvbGxvd2luZyBjb25kaXRpb25zIGFyZSBtZXQ6CgogICAgKiBSZWRpc3RyaWJ1dGlvbnMgb2Ygc291cmNlIGNvZGUgbXVzdCByZXRhaW4gdGhlIGFib3ZlIGNvcHlyaWdodAogICAgICBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIuCiAgICAqIFJlZGlzdHJpYnV0aW9ucyBpbiBiaW5hcnkgZm9ybSBtdXN0IHJlcHJvZHVjZSB0aGUgYWJvdmUgY29weXJpZ2h0CiAgICAgIG5vdGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lciBpbiB0aGUKICAgICAgZG9jdW1lbnRhdGlvbiBhbmQvb3Igb3RoZXIgbWF0ZXJpYWxzIHByb3ZpZGVkIHdpdGggdGhlIGRpc3RyaWJ1dGlvbi4KCiAgVEhJUyBTT0ZUV0FSRSBJUyBQUk9WSURFRCBCWSBUSEUgQ09QWVJJR0hUIEhPTERFUlMgQU5EIENPTlRSSUJVVE9SUyAiQVMgSVMiCiAgQU5EIEFOWSBFWFBSRVNTIE9SIElNUExJRUQgV0FSUkFOVElFUywgSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFRIRQogIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkgQU5EIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFCiAgQVJFIERJU0NMQUlNRUQuIElOIE5PIEVWRU5UIFNIQUxMIDxDT1BZUklHSFQgSE9MREVSPiBCRSBMSUFCTEUgRk9SIEFOWQogIERJUkVDVCwgSU5ESVJFQ1QsIElOQ0lERU5UQUwsIFNQRUNJQUwsIEVYRU1QTEFSWSwgT1IgQ09OU0VRVUVOVElBTCBEQU1BR0VTCiAgKElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBQUk9DVVJFTUVOVCBPRiBTVUJTVElUVVRFIEdPT0RTIE9SIFNFUlZJQ0VTOwogIExPU1MgT0YgVVNFLCBEQVRBLCBPUiBQUk9GSVRTOyBPUiBCVVNJTkVTUyBJTlRFUlJVUFRJT04pIEhPV0VWRVIgQ0FVU0VEIEFORAogIE9OIEFOWSBUSEVPUlkgT0YgTElBQklMSVRZLCBXSEVUSEVSIElOIENPTlRSQUNULCBTVFJJQ1QgTElBQklMSVRZLCBPUiBUT1JUCiAgKElOQ0xVRElORyBORUdMSUdFTkNFIE9SIE9USEVSV0lTRSkgQVJJU0lORyBJTiBBTlkgV0FZIE9VVCBPRiBUSEUgVVNFIE9GCiAgVEhJUyBTT0ZUV0FSRSwgRVZFTiBJRiBBRFZJU0VEIE9GIFRIRSBQT1NTSUJJTElUWSBPRiBTVUNIIERBTUFHRS4KKi8KCi8qanNsaW50IHNsb3BweTp0cnVlIGJyb3dzZXI6dHJ1ZSAqLwovKmdsb2JhbCBlc3ByaW1hOnRydWUsIFlVSTp0cnVlLCByZXF1aXJlOnRydWUgKi8KCnZhciBwYXJzZUlkLCB0cmVlOwoKZnVuY3Rpb24gaWQoaSkgewogICAgcmV0dXJuIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGkpOwp9CgpZVUkoeyBnYWxsZXJ5OiAnZ2FsbGVyeS0yMDEzLjAxLjA5LTIzLTI0JyB9KS51c2UoJ2dhbGxlcnktc20tdHJlZXZpZXcnLCBmdW5jdGlvbiAoWSkgewoKICAgIHdpbmRvdy51cGRhdGVUcmVlID0gZnVuY3Rpb24gKHN5bnRheCkgewoKICAgICAgICBpZiAodHlwZW9mIHN5bnRheCA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKGlkKCd0YWJfdHJlZScpLmNsYXNzTmFtZSAhPT0gJ2FjdGl2ZScpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKHR5cGVvZiB0cmVlID09PSAndW5kZWZpbmVkJykgewogICAgICAgICAgICB0cmVlID0gbmV3IFkuVHJlZVZpZXcoewogICAgICAgICAgICAgICAgbGF6eVJlbmRlcjogZmFsc2UsCiAgICAgICAgICAgICAgICBjb250YWluZXI6ICcjdHJlZXZpZXcnCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0cmVlLnJlbmRlcigpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gY29sbGFwc2VBbGwoKSB7CiAgICAgICAgICAgIFkuYWxsKCcueXVpMy10cmVldmlldy1jYW4taGF2ZS1jaGlsZHJlbicpLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdHJlZS5nZXROb2RlQnlJZCh0aGlzLmdldCgnaWQnKSkuY2xvc2UoKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBleHBhbmRBbGwoKSB7CiAgICAgICAgICAgIFkuYWxsKCcueXVpMy10cmVldmlldy1jYW4taGF2ZS1jaGlsZHJlbicpLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdHJlZS5nZXROb2RlQnlJZCh0aGlzLmdldCgnaWQnKSkub3BlbigpOwogICAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGlkKCdjb2xsYXBzZScpLm9uY2xpY2sgPSBjb2xsYXBzZUFsbDsKICAgICAgICBpZCgnZXhwYW5kJykub25jbGljayA9IGV4cGFuZEFsbDsKCiAgICAgICAgZnVuY3Rpb24gaXNBcnJheShvKSB7CiAgICAgICAgICAgIHJldHVybiAodHlwZW9mIEFycmF5LmlzQXJyYXkgPT09ICdmdW5jdGlvbicpID8gQXJyYXkuaXNBcnJheShvKSA6CiAgICAgICAgICAgICAgICBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmFwcGx5KG8pID09PSAnW29iamVjdCBBcnJheV0nOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gY29udmVydChuYW1lLCBub2RlKSB7CiAgICAgICAgICAgIHZhciBpLCBrZXksIGl0ZW0sIHN1Yml0ZW07CgogICAgICAgICAgICBpdGVtID0gdHJlZS5jcmVhdGVOb2RlKCk7CgogICAgICAgICAgICBzd2l0Y2ggKHR5cGVvZiBub2RlKSB7CgogICAgICAgICAgICBjYXNlICdzdHJpbmcnOgogICAgICAgICAgICBjYXNlICdudW1iZXInOgogICAgICAgICAgICBjYXNlICdib29sZWFuJzoKICAgICAgICAgICAgICAgIGl0ZW0ubGFiZWwgPSBuYW1lICsgJzogJyArIG5vZGUudG9TdHJpbmcoKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAnb2JqZWN0JzoKICAgICAgICAgICAgICAgIGlmICghbm9kZSkgewogICAgICAgICAgICAgICAgICAgIGl0ZW0ubGFiZWwgPSBuYW1lICsgJzogbnVsbCc7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAobm9kZSBpbnN0YW5jZW9mIFJlZ0V4cCkgewogICAgICAgICAgICAgICAgICAgIGl0ZW0ubGFiZWwgPSBuYW1lICsgJzogJyArIG5vZGUudG9TdHJpbmcoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXRlbTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGl0ZW0ubGFiZWwgPSBuYW1lOwogICAgICAgICAgICAgICAgaWYgKGlzQXJyYXkobm9kZSkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5sZW5ndGggPT09IDIgJiYgbmFtZSA9PT0gJ3JhbmdlJykgewogICAgICAgICAgICAgICAgICAgICAgICBpdGVtLmxhYmVsID0gbmFtZSArICc6IFsnICsgbm9kZVswXSArICcsICcgKyBub2RlWzFdICsgJ10nOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0ubGFiZWwgPSBpdGVtLmxhYmVsICsgJyBbJyArIG5vZGUubGVuZ3RoICsgJ10nOwogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbm9kZS5sZW5ndGg7IGkgKz0gMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3ViaXRlbSA9IGNvbnZlcnQoU3RyaW5nKGkpLCBub2RlW2ldKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdWJpdGVtLmNoaWxkcmVuLmxlbmd0aCA9PT0gMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uYXBwZW5kKHN1Yml0ZW0uY2hpbGRyZW5bMF0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLmFwcGVuZChzdWJpdGVtKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2Ygbm9kZS50eXBlICE9PSAndW5kZWZpbmVkJykgewogICAgICAgICAgICAgICAgICAgICAgICBpdGVtLmxhYmVsID0gbmFtZTsKICAgICAgICAgICAgICAgICAgICAgICAgc3ViaXRlbSA9IHRyZWUuY3JlYXRlTm9kZSgpOwogICAgICAgICAgICAgICAgICAgICAgICBzdWJpdGVtLmxhYmVsID0gbm9kZS50eXBlOwogICAgICAgICAgICAgICAgICAgICAgICBpdGVtLmFwcGVuZChzdWJpdGVtKTsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChrZXkgaW4gbm9kZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChub2RlLCBrZXkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGtleSAhPT0gJ3R5cGUnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Yml0ZW0uYXBwZW5kKGNvbnZlcnQoa2V5LCBub2RlW2tleV0pKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGtleSBpbiBub2RlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG5vZGUsIGtleSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLmFwcGVuZChjb252ZXJ0KGtleSwgbm9kZVtrZXldKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICBpdGVtLmxhYmVsID0gJ1tVbmtub3duXSc7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIGl0ZW07CiAgICAgICAgfQoKCiAgICAgICAgdHJlZS5jbGVhcigpOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0cmVldmlldycpLmlubmVySFRNTCA9ICcnOwogICAgICAgIHRyZWUucm9vdE5vZGUuYXBwZW5kKGNvbnZlcnQoJ1Byb2dyYW0gYm9keScsIHN5bnRheC5ib2R5KSk7CiAgICAgICAgdHJlZS5yZW5kZXIoKTsKCiAgICAgICAgZXhwYW5kQWxsKCk7CiAgICB9OwoKfSk7CgoKZnVuY3Rpb24gcGFyc2UoZGVsYXkpIHsKICAgIGlmIChwYXJzZUlkKSB7CiAgICAgICAgd2luZG93LmNsZWFyVGltZW91dChwYXJzZUlkKTsKICAgIH0KCiAgICBwYXJzZUlkID0gd2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBjb2RlLCBvcHRpb25zLCByZXN1bHQsIGVsLCBzdHI7CgogICAgICAgIC8vIFNwZWNpYWwgaGFuZGxpbmcgZm9yIHJlZ3VsYXIgZXhwcmVzc2lvbiBsaXRlcmFsIHNpbmNlIHdlIG5lZWQgdG8KICAgICAgICAvLyBjb252ZXJ0IGl0IHRvIGEgc3RyaW5nIGxpdGVyYWwsIG90aGVyd2lzZSBpdCB3aWxsIGJlIGRlY29kZWQKICAgICAgICAvLyBhcyBvYmplY3QgInt9IiBhbmQgdGhlIHJlZ3VsYXIgZXhwcmVzc2lvbiB3b3VsZCBiZSBsb3N0LgogICAgICAgIGZ1bmN0aW9uIGFkanVzdFJlZ2V4TGl0ZXJhbChrZXksIHZhbHVlKSB7CiAgICAgICAgICAgIGlmIChrZXkgPT09ICd2YWx1ZScgJiYgdmFsdWUgaW5zdGFuY2VvZiBSZWdFeHApIHsKICAgICAgICAgICAgICAgIHZhbHVlID0gdmFsdWUudG9TdHJpbmcoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgfQoKICAgICAgICBjb2RlID0gd2luZG93LmVkaXRvci5nZXRUZXh0KCk7CiAgICAgICAgb3B0aW9ucyA9IHsKICAgICAgICAgICAgYXR0YWNoQ29tbWVudDogaWQoJ2NvbW1lbnQnKS5jaGVja2VkLAogICAgICAgICAgICByYW5nZTogaWQoJ3JhbmdlJykuY2hlY2tlZCwKICAgICAgICAgICAgbG9jOiBpZCgnbG9jJykuY2hlY2tlZCwKICAgICAgICAgICAgdG9sZXJhbnQ6IGlkKCd0b2xlcmFudCcpLmNoZWNrZWQKICAgICAgICB9OwoKICAgICAgICBpZCgndG9rZW5zJykudmFsdWUgPSAnJzsKICAgICAgICBpZCgnaW5mbycpLmNsYXNzTmFtZSA9ICdhbGVydC1ib3ggc2Vjb25kYXJ5JzsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmVzdWx0ID0gZXNwcmltYS5wYXJzZShjb2RlLCBvcHRpb25zKTsKICAgICAgICAgICAgc3RyID0gSlNPTi5zdHJpbmdpZnkocmVzdWx0LCBhZGp1c3RSZWdleExpdGVyYWwsIDQpOwogICAgICAgICAgICBvcHRpb25zLnRva2VucyA9IHRydWU7CiAgICAgICAgICAgIGlkKCd0b2tlbnMnKS52YWx1ZSA9IEpTT04uc3RyaW5naWZ5KGVzcHJpbWEucGFyc2UoY29kZSwgb3B0aW9ucykudG9rZW5zLAogICAgICAgICAgICAgICAgYWRqdXN0UmVnZXhMaXRlcmFsLCA0KTsKICAgICAgICAgICAgaWYgKHdpbmRvdy51cGRhdGVUcmVlKSB7CiAgICAgICAgICAgICAgICB3aW5kb3cudXBkYXRlVHJlZShyZXN1bHQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlkKCdpbmZvJykuaW5uZXJIVE1MID0gJ05vIGVycm9yJzsKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIGlmICh3aW5kb3cudXBkYXRlVHJlZSkgewogICAgICAgICAgICAgICAgd2luZG93LnVwZGF0ZVRyZWUoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBzdHIgPSBlLm5hbWUgKyAnOiAnICsgZS5tZXNzYWdlOwogICAgICAgICAgICBpZCgnaW5mbycpLmlubmVySFRNTCAgPSBzdHI7CiAgICAgICAgICAgIGlkKCdpbmZvJykuY2xhc3NOYW1lID0gJ2FsZXJ0LWJveCBhbGVydCc7CiAgICAgICAgfQoKICAgICAgICBlbCA9IGlkKCdzeW50YXgnKTsKICAgICAgICBlbC52YWx1ZSA9IHN0cjsKCiAgICAgICAgZWwgPSBpZCgndXJsJyk7CiAgICAgICAgZWwudmFsdWUgPSBsb2NhdGlvbi5wcm90b2NvbCArICIvLyIgKyBsb2NhdGlvbi5ob3N0ICsgbG9jYXRpb24ucGF0aG5hbWUgKyAnP2NvZGU9JyArIGVuY29kZVVSSUNvbXBvbmVudChjb2RlKTsKCiAgICAgICAgcGFyc2VJZCA9IHVuZGVmaW5lZDsKICAgIH0sIGRlbGF5IHx8IDgxMSk7Cn0KCndpbmRvdy5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7CiAgICBmdW5jdGlvbiBxdWlja1BhcnNlKCkgeyBwYXJzZSgxKTsgfQoKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb21tZW50Jykub25jaGFuZ2UgPSBxdWlja1BhcnNlOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JhbmdlJykub25jaGFuZ2UgPSBxdWlja1BhcnNlOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYycpLm9uY2hhbmdlID0gcXVpY2tQYXJzZTsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b2xlcmFudCcpLm9uY2hhbmdlID0gcXVpY2tQYXJzZTsKCiAgICAvLyBTcGVjaWFsIGhhbmRsaW5nIGZvciBJRS4KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb21tZW50Jykub25jbGljayA9IHF1aWNrUGFyc2U7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmFuZ2UnKS5vbmNsaWNrID0gcXVpY2tQYXJzZTsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2MnKS5vbmNsaWNrID0gcXVpY2tQYXJzZTsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b2xlcmFudCcpLm9uY2xpY2sgPSBxdWlja1BhcnNlOwoKICAgIGlkKCdzaG93X3N5bnRheCcpLm9uY2xpY2sgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgaWQoJ3RhYl90cmVlJykuY2xhc3NOYW1lID0gaWQoJ3Nob3dfdHJlZScpLmNsYXNzTmFtZSA9ICcnOwogICAgICAgIGlkKCd0YWJfc3ludGF4JykuY2xhc3NOYW1lID0gaWQoJ3Nob3dfc3ludGF4JykuY2xhc3NOYW1lID0gJ2FjdGl2ZSc7CiAgICAgICAgaWQoJ3RhYl90b2tlbnMnKS5jbGFzc05hbWUgPSBpZCgnc2hvd190b2tlbnMnKS5jbGFzc05hbWUgPSAnJzsKICAgICAgICBpZCgndGFiX3RyZWUnKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgIGlkKCd0YWJfc3ludGF4Jykuc3R5bGUuZGlzcGxheSA9ICcnOwogICAgICAgIGlkKCd0YWJfdG9rZW5zJykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgIH07CgogICAgaWQoJ3Nob3dfdHJlZScpLm9uY2xpY2sgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgaWQoJ3RhYl90cmVlJykuY2xhc3NOYW1lID0gaWQoJ3Nob3dfdHJlZScpLmNsYXNzTmFtZSA9ICdhY3RpdmUnOwogICAgICAgIGlkKCd0YWJfc3ludGF4JykuY2xhc3NOYW1lID0gaWQoJ3Nob3dfc3ludGF4JykuY2xhc3NOYW1lID0gJyc7CiAgICAgICAgaWQoJ3RhYl90b2tlbnMnKS5jbGFzc05hbWUgPSBpZCgnc2hvd190b2tlbnMnKS5jbGFzc05hbWUgPSAnJzsKICAgICAgICBpZCgndGFiX3RyZWUnKS5zdHlsZS5kaXNwbGF5ID0gJyc7CiAgICAgICAgaWQoJ3RhYl9zeW50YXgnKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgIGlkKCd0YWJfdG9rZW5zJykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICBxdWlja1BhcnNlKCk7CiAgICB9OwoKICAgIGlkKCdzaG93X3Rva2VucycpLm9uY2xpY2sgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgaWQoJ3RhYl90cmVlJykuY2xhc3NOYW1lID0gaWQoJ3Nob3dfdHJlZScpLmNsYXNzTmFtZSA9ICcnOwogICAgICAgIGlkKCd0YWJfc3ludGF4JykuY2xhc3NOYW1lID0gaWQoJ3Nob3dfc3ludGF4JykuY2xhc3NOYW1lID0gJyc7CiAgICAgICAgaWQoJ3RhYl90b2tlbnMnKS5jbGFzc05hbWUgPSBpZCgnc2hvd190b2tlbnMnKS5jbGFzc05hbWUgPSAnYWN0aXZlJzsKICAgICAgICBpZCgndGFiX3RyZWUnKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgIGlkKCd0YWJfc3ludGF4Jykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICBpZCgndGFiX3Rva2VucycpLnN0eWxlLmRpc3BsYXkgPSAnJzsKICAgIH07CgogICAgdHJ5IHsKICAgICAgICByZXF1aXJlKFsnY3VzdG9tL2VkaXRvciddLCBmdW5jdGlvbiAoZWRpdG9yKSB7CiAgICAgICAgICAgIHZhciBxdWVyaWVzLCBlbGVtZW50cywgY29kZSwgaSwgaXosIHBhaXI7CgogICAgICAgICAgICB3aW5kb3cuZWRpdG9yID0gZWRpdG9yKHsgcGFyZW50OiAnZWRpdG9yJywgbGFuZzogJ2pzJyB9KTsKICAgICAgICAgICAgd2luZG93LmVkaXRvci5nZXRUZXh0VmlldygpLmdldE1vZGVsKCkuYWRkRXZlbnRMaXN0ZW5lcigiQ2hhbmdlZCIsIHBhcnNlKTsKICAgICAgICAgICAgcGFyc2UoMTAwKTsKCiAgICAgICAgICAgIGlmIChsb2NhdGlvbi5zZWFyY2gpIHsKICAgICAgICAgICAgICAgIHF1ZXJpZXMgPSB7fTsKICAgICAgICAgICAgICAgIGVsZW1lbnRzID0gbG9jYXRpb24uc2VhcmNoLnN1YnN0cmluZygxKS5zcGxpdCgvWzsmXS8pOwogICAgICAgICAgICAgICAgZm9yIChpID0gMCwgaXogPSBlbGVtZW50cy5sZW5ndGg7IGkgPCBpejsgaSArPSAxKSB7CiAgICAgICAgICAgICAgICAgICAgcGFpciA9IGVsZW1lbnRzW2ldLnNwbGl0KCc9Jyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHBhaXIubGVuZ3RoID09PSAyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXJpZXNbZGVjb2RlVVJJQ29tcG9uZW50KHBhaXJbMF0pXSA9IGRlY29kZVVSSUNvbXBvbmVudChwYWlyWzFdKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb2RlID0gcXVlcmllcy5jb2RlOwogICAgICAgICAgICAgICAgaWYgKGNvZGUpIHsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZWRpdG9yLnNldFRleHQoY29kZSk7CiAgICAgICAgICAgICAgICAgICAgcXVpY2tQYXJzZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9IGNhdGNoIChlKSB7CiAgICB9CgoKfTsK",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Thu, 06 Nov 2014 23:24:53 GMT",
                    "Content-Length": "10161",
                    "Date": "Thu, 06 Nov 2014 23:24:54 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}