{
    "url": "http://localhost:9999/toushay/log4javascript/console_uncompressed.html",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Document domain manipulation (DOM-based)",
    "issueType": 5247232,
    "severity": "Medium",
    "confidence": "Firm",
    "issueBackground": "DOM-based document domain manipulation vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and sets the document.domain property with this data. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause the response page to set an arbitrary document.domain value.<br><br>The document.domain property is used by browsers in their enforcement of the same origin policy. If two pages from different origins explicitly set the same document.domain value, then those two pages can interact in unrestricted ways. If an attacker can cause a page of a targeted application, and another page they control (either directly, or via an XSS-like vulnerability), to set the same document.domain value, then the attacker may be able to fully compromise the targeted application page via the page they already control, with the same possibilities for exploitation as regular cross-site scripting (XSS) vulnerabilities.<br><br>Browsers generally enforce some restrictions on the values that can be assigned to document.domain, and may prevent the use of completely different values than the actual origin of the page. However, there are two important caveats to this. Firstly, browsers allow the use of child or parent domains, so an attacker may be able to switch the domain of the targeted application page to that of a related application with a weaker security posture. Secondly, some browser quirks enable switching to completely unrelated domains. These caveats mean that the ability to manipulate the document.domain property of a page generally represents a security vulnerability whose severity is not far behind regular XSS.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based document domain manipulation vulnerabilities is not to dynamically set the document.domain property using data that originated from any untrusted source. If it is necessary to programmatically set the document.domain property from within client-side code, then the application should employ a set list of acceptable values, and assign only from values in that list.",
    "issueDetail": "The application may be vulnerable to DOM-based document domain manipulation. Data is read from <b>location.search</b> and written to <b>document.domain</b> via the following statements:<ul><li>var queryBits = unescape(location.search).substr(1).split(\"&amp;\"), nameValueBits;</li><li>nameValueBits = queryBits[i].split(\"=\");</li><li>document.domain = nameValueBits[1];</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/toushay/log4javascript/console_uncompressed.html",
                "path": "/toushay/log4javascript/console_uncompressed.html",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC90b3VzaGF5L2xvZzRqYXZhc2NyaXB0L2NvbnNvbGVfdW5jb21wcmVzc2VkLmh0bWwgSFRUUC8xLjENCkhvc3Q6IGxvY2FsaG9zdDo5OTk5DQoNCg==",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogNzA3ODQNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IHRleHQvaHRtbDsgY2hhcnNldD11dGYtOA0KRGF0ZTogRnJpLCAwNyBOb3YgMjAxNCAwOTowMzo0NiBHTVQNCkxhc3QtTW9kaWZpZWQ6IEZyaSwgMDcgTm92IDIwMTQgMDk6MDM6NDYgR01UDQoNCjwhRE9DVFlQRSBodG1sIFBVQkxJQyAiLS8vVzNDLy9EVEQgWEhUTUwgMS4wIFN0cmljdC8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9UUi94aHRtbDEvRFREL3hodG1sMS1zdHJpY3QuZHRkIj4NCjxodG1sIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIiBsYW5nPSJlbiIgeG1sOmxhbmc9ImVuIj4NCgk8aGVhZD4NCgkJPHRpdGxlPmxvZzRqYXZhc2NyaXB0PC90aXRsZT4NCgkJPG1ldGEgaHR0cC1lcXVpdj0iQ29udGVudC1UeXBlIiBjb250ZW50PSJ0ZXh0L2h0bWw7IGNoYXJzZXQ9dXRmLTgiIC8+DQoJCTwhLS0gTWFrZSBJRTggYmVoYXZlIGxpa2UgSUU3LCBoYXZpbmcgZ29uZSB0byBhbGwgdGhlIHRyb3VibGUgb2YgbWFraW5nIElFIHdvcmsgLS0+DQoJCTxtZXRhIGh0dHAtZXF1aXY9IlgtVUEtQ29tcGF0aWJsZSIgY29udGVudD0iSUU9NyIgLz4NCgkJPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPnZhciBpc0llID0gZmFsc2UsIGlzSWVQcmU3ID0gZmFsc2U7PC9zY3JpcHQ+DQoJCTwhLS1baWYgSUVdPjxzY3JpcHQgdHlwZT0idGV4dC9qYXZhc2NyaXB0Ij5pc0llID0gdHJ1ZTwvc2NyaXB0PjwhW2VuZGlmXS0tPg0KCQk8IS0tW2lmIGx0IElFIDddPjxzY3JpcHQgdHlwZT0idGV4dC9qYXZhc2NyaXB0Ij5pc0llUHJlNyA9IHRydWU8L3NjcmlwdD48IVtlbmRpZl0tLT4NCgkJPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPg0KCQkJLy88IVtDREFUQVsNCgkJCXZhciBsb2dnaW5nRW5hYmxlZCA9IHRydWU7DQoJCQl2YXIgbG9nUXVldWVkRXZlbnRzVGltZXIgPSBudWxsOw0KCQkJdmFyIGxvZ0VudHJpZXMgPSBbXTsNCgkJCXZhciBsb2dFbnRyaWVzQW5kU2VwYXJhdG9ycyA9IFtdOw0KCQkJdmFyIGxvZ0l0ZW1zID0gW107DQoJCQl2YXIgcmVuZGVyRGVsYXkgPSAxMDA7DQoJCQl2YXIgdW5yZW5kZXJlZExvZ0l0ZW1zRXhpc3QgPSBmYWxzZTsNCgkJCXZhciByb290R3JvdXAsIGN1cnJlbnRHcm91cCA9IG51bGw7DQoJCQl2YXIgbG9hZGVkID0gZmFsc2U7DQoJCQl2YXIgY3VycmVudExvZ0l0ZW0gPSBudWxsOw0KCQkJdmFyIGxvZ01haW5Db250YWluZXI7DQoNCgkJCWZ1bmN0aW9uIGNvcHlQcm9wZXJ0aWVzKG9iaiwgcHJvcHMpIHsNCgkJCQlmb3IgKHZhciBpIGluIHByb3BzKSB7DQoJCQkJCW9ialtpXSA9IHByb3BzW2ldOw0KCQkJCX0NCgkJCX0NCg0KCQkJLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8NCg0KCQkJZnVuY3Rpb24gTG9nSXRlbSgpIHsNCgkJCX0NCg0KCQkJTG9nSXRlbS5wcm90b3R5cGUgPSB7DQoJCQkJbWFpbkNvbnRhaW5lcjogbnVsbCwNCgkJCQl3cmFwcGVkQ29udGFpbmVyOiBudWxsLA0KCQkJCXVud3JhcHBlZENvbnRhaW5lcjogbnVsbCwNCgkJCQlncm91cDogbnVsbCwNCg0KCQkJCWFwcGVuZFRvTG9nOiBmdW5jdGlvbigpIHsNCgkJCQkJZm9yICh2YXIgaSA9IDAsIGxlbiA9IHRoaXMuZWxlbWVudENvbnRhaW5lcnMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsNCgkJCQkJCXRoaXMuZWxlbWVudENvbnRhaW5lcnNbaV0uYXBwZW5kVG9Mb2coKTsNCgkJCQkJfQ0KCQkJCQl0aGlzLmdyb3VwLnVwZGF0ZSgpOw0KCQkJCX0sDQoNCgkJCQlkb1JlbW92ZTogZnVuY3Rpb24oZG9VcGRhdGUsIHJlbW92ZUZyb21Hcm91cCkgew0KCQkJCQlpZiAodGhpcy5yZW5kZXJlZCkgew0KCQkJCQkJZm9yICh2YXIgaSA9IDAsIGxlbiA9IHRoaXMuZWxlbWVudENvbnRhaW5lcnMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsNCgkJCQkJCQl0aGlzLmVsZW1lbnRDb250YWluZXJzW2ldLnJlbW92ZSgpOw0KCQkJCQkJfQ0KCQkJCQkJdGhpcy51bndyYXBwZWRFbGVtZW50Q29udGFpbmVyID0gbnVsbDsNCgkJCQkJCXRoaXMud3JhcHBlZEVsZW1lbnRDb250YWluZXIgPSBudWxsOw0KCQkJCQkJdGhpcy5tYWluRWxlbWVudENvbnRhaW5lciA9IG51bGw7DQoJCQkJCX0NCgkJCQkJaWYgKHRoaXMuZ3JvdXAgJiYgcmVtb3ZlRnJvbUdyb3VwKSB7DQoJCQkJCQl0aGlzLmdyb3VwLnJlbW92ZUNoaWxkKHRoaXMsIGRvVXBkYXRlKTsNCgkJCQkJfQ0KCQkJCQlpZiAodGhpcyA9PT0gY3VycmVudExvZ0l0ZW0pIHsNCgkJCQkJCWN1cnJlbnRMb2dJdGVtID0gbnVsbDsNCgkJCQkJfQ0KCQkJCX0sDQoNCgkJCQlyZW1vdmU6IGZ1bmN0aW9uKGRvVXBkYXRlLCByZW1vdmVGcm9tR3JvdXApIHsNCgkJCQkJdGhpcy5kb1JlbW92ZShkb1VwZGF0ZSwgcmVtb3ZlRnJvbUdyb3VwKTsNCgkJCQl9LA0KDQoJCQkJcmVuZGVyOiBmdW5jdGlvbigpIHt9LA0KDQoJCQkJYWNjZXB0OiBmdW5jdGlvbih2aXNpdG9yKSB7DQoJCQkJCXZpc2l0b3IudmlzaXQodGhpcyk7DQoJCQkJfSwNCg0KCQkJCWdldFVud3JhcHBlZERvbUNvbnRhaW5lcjogZnVuY3Rpb24oKSB7DQoJCQkJCXJldHVybiB0aGlzLmdyb3VwLnVud3JhcHBlZEVsZW1lbnRDb250YWluZXIuY29udGVudERpdjsNCgkJCQl9LA0KDQoJCQkJZ2V0V3JhcHBlZERvbUNvbnRhaW5lcjogZnVuY3Rpb24oKSB7DQoJCQkJCXJldHVybiB0aGlzLmdyb3VwLndyYXBwZWRFbGVtZW50Q29udGFpbmVyLmNvbnRlbnREaXY7DQoJCQkJfSwNCg0KCQkJCWdldE1haW5Eb21Db250YWluZXI6IGZ1bmN0aW9uKCkgew0KCQkJCQlyZXR1cm4gdGhpcy5ncm91cC5tYWluRWxlbWVudENvbnRhaW5lci5jb250ZW50RGl2Ow0KCQkJCX0NCgkJCX07DQoNCgkJCUxvZ0l0ZW0uc2VyaWFsaXplZEl0ZW1LZXlzID0ge0xPR19FTlRSWTogMCwgR1JPVVBfU1RBUlQ6IDEsIEdST1VQX0VORDogMn07DQoNCgkJCS8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoNCgkJCWZ1bmN0aW9uIExvZ0l0ZW1Db250YWluZXJFbGVtZW50KCkgew0KCQkJfQ0KDQoJCQlMb2dJdGVtQ29udGFpbmVyRWxlbWVudC5wcm90b3R5cGUgPSB7DQoJCQkJYXBwZW5kVG9Mb2c6IGZ1bmN0aW9uKCkgew0KCQkJCQl2YXIgaW5zZXJ0QmVmb3JlRmlyc3QgPSAobmV3ZXN0QXRUb3AgJiYgdGhpcy5jb250YWluZXJEb21Ob2RlLmhhc0NoaWxkTm9kZXMoKSk7DQoJCQkJCWlmIChpbnNlcnRCZWZvcmVGaXJzdCkgew0KCQkJCQkJdGhpcy5jb250YWluZXJEb21Ob2RlLmluc2VydEJlZm9yZSh0aGlzLm1haW5EaXYsIHRoaXMuY29udGFpbmVyRG9tTm9kZS5maXJzdENoaWxkKTsNCgkJCQkJfSBlbHNlIHsNCgkJCQkJCXRoaXMuY29udGFpbmVyRG9tTm9kZS5hcHBlbmRDaGlsZCh0aGlzLm1haW5EaXYpOw0KCQkJCQl9DQoJCQkJfQ0KCQkJfTsNCg0KCQkJLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8NCg0KCQkJZnVuY3Rpb24gU2VwYXJhdG9yRWxlbWVudENvbnRhaW5lcihjb250YWluZXJEb21Ob2RlKSB7DQoJCQkJdGhpcy5jb250YWluZXJEb21Ob2RlID0gY29udGFpbmVyRG9tTm9kZTsNCgkJCQl0aGlzLm1haW5EaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCgkJCQl0aGlzLm1haW5EaXYuY2xhc3NOYW1lID0gInNlcGFyYXRvciI7DQoJCQkJdGhpcy5tYWluRGl2LmlubmVySFRNTCA9ICImbmJzcDsiOw0KCQkJfQ0KDQoJCQlTZXBhcmF0b3JFbGVtZW50Q29udGFpbmVyLnByb3RvdHlwZSA9IG5ldyBMb2dJdGVtQ29udGFpbmVyRWxlbWVudCgpOw0KDQoJCQlTZXBhcmF0b3JFbGVtZW50Q29udGFpbmVyLnByb3RvdHlwZS5yZW1vdmUgPSBmdW5jdGlvbigpIHsNCgkJCQl0aGlzLm1haW5EaXYucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLm1haW5EaXYpOw0KCQkJCXRoaXMubWFpbkRpdiA9IG51bGw7DQoJCQl9Ow0KDQoJCQkvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLw0KDQoJCQlmdW5jdGlvbiBTZXBhcmF0b3IoKSB7DQoJCQkJdGhpcy5yZW5kZXJlZCA9IGZhbHNlOw0KCQkJfQ0KDQoJCQlTZXBhcmF0b3IucHJvdG90eXBlID0gbmV3IExvZ0l0ZW0oKTsNCg0KCQkJY29weVByb3BlcnRpZXMoU2VwYXJhdG9yLnByb3RvdHlwZSwgew0KCQkJCXJlbmRlcjogZnVuY3Rpb24oKSB7DQoJCQkJCXZhciBjb250YWluZXJEb21Ob2RlID0gdGhpcy5ncm91cC5jb250ZW50RGl2Ow0KCQkJCQlpZiAoaXNJZSkgew0KCQkJCQkJdGhpcy51bndyYXBwZWRFbGVtZW50Q29udGFpbmVyID0gbmV3IFNlcGFyYXRvckVsZW1lbnRDb250YWluZXIodGhpcy5nZXRVbndyYXBwZWREb21Db250YWluZXIoKSk7DQoJCQkJCQl0aGlzLndyYXBwZWRFbGVtZW50Q29udGFpbmVyID0gbmV3IFNlcGFyYXRvckVsZW1lbnRDb250YWluZXIodGhpcy5nZXRXcmFwcGVkRG9tQ29udGFpbmVyKCkpOw0KCQkJCQkJdGhpcy5lbGVtZW50Q29udGFpbmVycyA9IFt0aGlzLnVud3JhcHBlZEVsZW1lbnRDb250YWluZXIsIHRoaXMud3JhcHBlZEVsZW1lbnRDb250YWluZXJdOw0KCQkJCQl9IGVsc2Ugew0KCQkJCQkJdGhpcy5tYWluRWxlbWVudENvbnRhaW5lciA9IG5ldyBTZXBhcmF0b3JFbGVtZW50Q29udGFpbmVyKHRoaXMuZ2V0TWFpbkRvbUNvbnRhaW5lcigpKTsNCgkJCQkJCXRoaXMuZWxlbWVudENvbnRhaW5lcnMgPSBbdGhpcy5tYWluRWxlbWVudENvbnRhaW5lcl07DQoJCQkJCX0NCgkJCQkJdGhpcy5jb250ZW50ID0gdGhpcy5mb3JtYXR0ZWRNZXNzYWdlOw0KCQkJCQl0aGlzLnJlbmRlcmVkID0gdHJ1ZTsNCgkJCQl9DQoJCQl9KTsNCg0KCQkJLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8NCg0KCQkJZnVuY3Rpb24gR3JvdXBFbGVtZW50Q29udGFpbmVyKGdyb3VwLCBjb250YWluZXJEb21Ob2RlLCBpc1Jvb3QsIGlzV3JhcHBlZCkgew0KCQkJCXRoaXMuZ3JvdXAgPSBncm91cDsNCgkJCQl0aGlzLmNvbnRhaW5lckRvbU5vZGUgPSBjb250YWluZXJEb21Ob2RlOw0KCQkJCXRoaXMuaXNSb290ID0gaXNSb290Ow0KCQkJCXRoaXMuaXNXcmFwcGVkID0gaXNXcmFwcGVkOw0KCQkJCXRoaXMuZXhwYW5kYWJsZSA9IGZhbHNlOw0KDQoJCQkJaWYgKHRoaXMuaXNSb290KSB7DQoJCQkJCWlmIChpc0llKSB7DQoJCQkJCQl0aGlzLmNvbnRlbnREaXYgPSBsb2dNYWluQ29udGFpbmVyLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpKTsNCgkJCQkJCXRoaXMuY29udGVudERpdi5pZCA9IHRoaXMuaXNXcmFwcGVkID8gImxvZ193cmFwcGVkIiA6ICJsb2dfdW53cmFwcGVkIjsNCgkJCQkJfSBlbHNlIHsNCgkJCQkJCXRoaXMuY29udGVudERpdiA9IGxvZ01haW5Db250YWluZXI7DQoJCQkJCX0NCgkJCQl9IGVsc2Ugew0KCQkJCQl2YXIgZ3JvdXBFbGVtZW50Q29udGFpbmVyID0gdGhpczsNCgkJCQkJDQoJCQkJCXRoaXMubWFpbkRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOw0KCQkJCQl0aGlzLm1haW5EaXYuY2xhc3NOYW1lID0gImdyb3VwIjsNCg0KCQkJCQl0aGlzLmhlYWRpbmdEaXYgPSB0aGlzLm1haW5EaXYuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikpOw0KCQkJCQl0aGlzLmhlYWRpbmdEaXYuY2xhc3NOYW1lID0gImdyb3VwaGVhZGluZyI7DQoNCgkJCQkJdGhpcy5leHBhbmRlciA9IHRoaXMuaGVhZGluZ0Rpdi5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzcGFuIikpOw0KCQkJCQl0aGlzLmV4cGFuZGVyLmNsYXNzTmFtZSA9ICJleHBhbmRlciB1bnNlbGVjdGFibGUgZ3JleWVkb3V0IjsNCgkJCQkJdGhpcy5leHBhbmRlci51bnNlbGVjdGFibGUgPSB0cnVlOw0KCQkJCQl2YXIgZXhwYW5kZXJUZXh0ID0gdGhpcy5ncm91cC5leHBhbmRlZCA/ICItIiA6ICIrIjsNCgkJCQkJdGhpcy5leHBhbmRlclRleHROb2RlID0gdGhpcy5leHBhbmRlci5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShleHBhbmRlclRleHQpKTsNCgkJCQkJDQoJCQkJCXRoaXMuaGVhZGluZ0Rpdi5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgiICIgKyB0aGlzLmdyb3VwLm5hbWUpKTsNCg0KCQkJCQl0aGlzLmNvbnRlbnREaXYgPSB0aGlzLm1haW5EaXYuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikpOw0KCQkJCQl2YXIgY29udGVudENzc0NsYXNzID0gdGhpcy5ncm91cC5leHBhbmRlZCA/ICJleHBhbmRlZCIgOiAiY29sbGFwc2VkIjsNCgkJCQkJdGhpcy5jb250ZW50RGl2LmNsYXNzTmFtZSA9ICJncm91cGNvbnRlbnQgIiArIGNvbnRlbnRDc3NDbGFzczsNCg0KCQkJCQl0aGlzLmV4cGFuZGVyLm9uY2xpY2sgPSBmdW5jdGlvbigpIHsNCgkJCQkJCWlmIChncm91cEVsZW1lbnRDb250YWluZXIuZ3JvdXAuZXhwYW5kYWJsZSkgew0KCQkJCQkJCWdyb3VwRWxlbWVudENvbnRhaW5lci5ncm91cC50b2dnbGVFeHBhbmRlZCgpOw0KCQkJCQkJfQ0KCQkJCQl9Ow0KCQkJCX0NCgkJCX0NCg0KCQkJR3JvdXBFbGVtZW50Q29udGFpbmVyLnByb3RvdHlwZSA9IG5ldyBMb2dJdGVtQ29udGFpbmVyRWxlbWVudCgpOw0KDQoJCQljb3B5UHJvcGVydGllcyhHcm91cEVsZW1lbnRDb250YWluZXIucHJvdG90eXBlLCB7DQoJCQkJdG9nZ2xlRXhwYW5kZWQ6IGZ1bmN0aW9uKCkgew0KCQkJCQlpZiAoIXRoaXMuaXNSb290KSB7DQoJCQkJCQl2YXIgb2xkQ3NzQ2xhc3MsIG5ld0Nzc0NsYXNzLCBleHBhbmRlclRleHQ7DQoJCQkJCQlpZiAodGhpcy5ncm91cC5leHBhbmRlZCkgew0KCQkJCQkJCW5ld0Nzc0NsYXNzID0gImV4cGFuZGVkIjsNCgkJCQkJCQlvbGRDc3NDbGFzcyA9ICJjb2xsYXBzZWQiOw0KCQkJCQkJCWV4cGFuZGVyVGV4dCA9ICItIjsNCgkJCQkJCX0gZWxzZSB7DQoJCQkJCQkJbmV3Q3NzQ2xhc3MgPSAiY29sbGFwc2VkIjsNCgkJCQkJCQlvbGRDc3NDbGFzcyA9ICJleHBhbmRlZCI7DQoJCQkJCQkJZXhwYW5kZXJUZXh0ID0gIisiOw0KCQkJCQkJfQ0KCQkJCQkJcmVwbGFjZUNsYXNzKHRoaXMuY29udGVudERpdiwgbmV3Q3NzQ2xhc3MsIG9sZENzc0NsYXNzKTsNCgkJCQkJCXRoaXMuZXhwYW5kZXJUZXh0Tm9kZS5ub2RlVmFsdWUgPSBleHBhbmRlclRleHQ7DQoJCQkJCX0NCgkJCQl9LA0KDQoJCQkJcmVtb3ZlOiBmdW5jdGlvbigpIHsNCgkJCQkJaWYgKCF0aGlzLmlzUm9vdCkgew0KCQkJCQkJdGhpcy5oZWFkaW5nRGl2ID0gbnVsbDsNCgkJCQkJCXRoaXMuZXhwYW5kZXIub25jbGljayA9IG51bGw7DQoJCQkJCQl0aGlzLmV4cGFuZGVyID0gbnVsbDsNCgkJCQkJCXRoaXMuZXhwYW5kZXJUZXh0Tm9kZSA9IG51bGw7DQoJCQkJCQl0aGlzLmNvbnRlbnREaXYgPSBudWxsOw0KCQkJCQkJdGhpcy5jb250YWluZXJEb21Ob2RlID0gbnVsbDsNCgkJCQkJCXRoaXMubWFpbkRpdi5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMubWFpbkRpdik7DQoJCQkJCQl0aGlzLm1haW5EaXYgPSBudWxsOw0KCQkJCQl9DQoJCQkJfSwNCg0KCQkJCXJldmVyc2VDaGlsZHJlbjogZnVuY3Rpb24oKSB7DQoJCQkJCS8vIEludmVydCB0aGUgb3JkZXIgb2YgdGhlIGxvZyBlbnRyaWVzDQoJCQkJCXZhciBub2RlID0gbnVsbDsNCg0KCQkJCQkvLyBSZW1vdmUgYWxsIHRoZSBsb2cgY29udGFpbmVyIG5vZGVzDQoJCQkJCXZhciBjaGlsZERvbU5vZGVzID0gW107DQoJCQkJCXdoaWxlICgobm9kZSA9IHRoaXMuY29udGVudERpdi5maXJzdENoaWxkKSkgew0KCQkJCQkJdGhpcy5jb250ZW50RGl2LnJlbW92ZUNoaWxkKG5vZGUpOw0KCQkJCQkJY2hpbGREb21Ob2Rlcy5wdXNoKG5vZGUpOw0KCQkJCQl9DQoNCgkJCQkJLy8gUHV0IHRoZW0gYWxsIGJhY2sgaW4gcmV2ZXJzZSBvcmRlcg0KCQkJCQl3aGlsZSAoKG5vZGUgPSBjaGlsZERvbU5vZGVzLnBvcCgpKSkgew0KCQkJCQkJdGhpcy5jb250ZW50RGl2LmFwcGVuZENoaWxkKG5vZGUpOw0KCQkJCQl9DQoJCQkJfSwNCg0KCQkJCXVwZGF0ZTogZnVuY3Rpb24oKSB7DQoJCQkJCWlmICghdGhpcy5pc1Jvb3QpIHsNCgkJCQkJCWlmICh0aGlzLmdyb3VwLmV4cGFuZGFibGUpIHsNCgkJCQkJCQlyZW1vdmVDbGFzcyh0aGlzLmV4cGFuZGVyLCAiZ3JleWVkb3V0Iik7DQoJCQkJCQl9IGVsc2Ugew0KCQkJCQkJCWFkZENsYXNzKHRoaXMuZXhwYW5kZXIsICJncmV5ZWRvdXQiKTsNCgkJCQkJCX0NCgkJCQkJfQ0KCQkJCX0sDQoNCgkJCQljbGVhcjogZnVuY3Rpb24oKSB7DQoJCQkJCWlmICh0aGlzLmlzUm9vdCkgew0KCQkJCQkJdGhpcy5jb250ZW50RGl2LmlubmVySFRNTCA9ICIiOw0KCQkJCQl9DQoJCQkJfQ0KCQkJfSk7DQoNCgkJCS8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoNCgkJCWZ1bmN0aW9uIEdyb3VwKG5hbWUsIGlzUm9vdCwgaW5pdGlhbGx5RXhwYW5kZWQpIHsNCgkJCQl0aGlzLm5hbWUgPSBuYW1lOw0KCQkJCXRoaXMuZ3JvdXAgPSBudWxsOw0KCQkJCXRoaXMuaXNSb290ID0gaXNSb290Ow0KCQkJCXRoaXMuaW5pdGlhbGx5RXhwYW5kZWQgPSBpbml0aWFsbHlFeHBhbmRlZDsNCgkJCQl0aGlzLmVsZW1lbnRDb250YWluZXJzID0gW107DQoJCQkJdGhpcy5jaGlsZHJlbiA9IFtdOw0KCQkJCXRoaXMuZXhwYW5kZWQgPSBpbml0aWFsbHlFeHBhbmRlZDsNCgkJCQl0aGlzLnJlbmRlcmVkID0gZmFsc2U7DQoJCQkJdGhpcy5leHBhbmRhYmxlID0gZmFsc2U7DQoJCQl9DQoNCgkJCUdyb3VwLnByb3RvdHlwZSA9IG5ldyBMb2dJdGVtKCk7DQoNCgkJCWNvcHlQcm9wZXJ0aWVzKEdyb3VwLnByb3RvdHlwZSwgew0KCQkJCWFkZENoaWxkOiBmdW5jdGlvbihsb2dJdGVtKSB7DQoJCQkJCXRoaXMuY2hpbGRyZW4ucHVzaChsb2dJdGVtKTsNCgkJCQkJbG9nSXRlbS5ncm91cCA9IHRoaXM7DQoJCQkJfSwNCg0KCQkJCXJlbmRlcjogZnVuY3Rpb24oKSB7DQoJCQkJCWlmIChpc0llKSB7DQoJCQkJCQl2YXIgdW53cmFwcGVkRG9tQ29udGFpbmVyLCB3cmFwcGVkRG9tQ29udGFpbmVyOw0KCQkJCQkJaWYgKHRoaXMuaXNSb290KSB7DQoJCQkJCQkJdW53cmFwcGVkRG9tQ29udGFpbmVyID0gbG9nTWFpbkNvbnRhaW5lcjsNCgkJCQkJCQl3cmFwcGVkRG9tQ29udGFpbmVyID0gbG9nTWFpbkNvbnRhaW5lcjsNCgkJCQkJCX0gZWxzZSB7DQoJCQkJCQkJdW53cmFwcGVkRG9tQ29udGFpbmVyID0gdGhpcy5nZXRVbndyYXBwZWREb21Db250YWluZXIoKTsNCgkJCQkJCQl3cmFwcGVkRG9tQ29udGFpbmVyID0gdGhpcy5nZXRXcmFwcGVkRG9tQ29udGFpbmVyKCk7DQoJCQkJCQl9DQoJCQkJCQl0aGlzLnVud3JhcHBlZEVsZW1lbnRDb250YWluZXIgPSBuZXcgR3JvdXBFbGVtZW50Q29udGFpbmVyKHRoaXMsIHVud3JhcHBlZERvbUNvbnRhaW5lciwgdGhpcy5pc1Jvb3QsIGZhbHNlKTsNCgkJCQkJCXRoaXMud3JhcHBlZEVsZW1lbnRDb250YWluZXIgPSBuZXcgR3JvdXBFbGVtZW50Q29udGFpbmVyKHRoaXMsIHdyYXBwZWREb21Db250YWluZXIsIHRoaXMuaXNSb290LCB0cnVlKTsNCgkJCQkJCXRoaXMuZWxlbWVudENvbnRhaW5lcnMgPSBbdGhpcy51bndyYXBwZWRFbGVtZW50Q29udGFpbmVyLCB0aGlzLndyYXBwZWRFbGVtZW50Q29udGFpbmVyXTsNCgkJCQkJfSBlbHNlIHsNCgkJCQkJCXZhciBtYWluRG9tQ29udGFpbmVyID0gdGhpcy5pc1Jvb3QgPyBsb2dNYWluQ29udGFpbmVyIDogdGhpcy5nZXRNYWluRG9tQ29udGFpbmVyKCk7DQoJCQkJCQl0aGlzLm1haW5FbGVtZW50Q29udGFpbmVyID0gbmV3IEdyb3VwRWxlbWVudENvbnRhaW5lcih0aGlzLCBtYWluRG9tQ29udGFpbmVyLCB0aGlzLmlzUm9vdCwgZmFsc2UpOw0KCQkJCQkJdGhpcy5lbGVtZW50Q29udGFpbmVycyA9IFt0aGlzLm1haW5FbGVtZW50Q29udGFpbmVyXTsNCgkJCQkJfQ0KCQkJCQl0aGlzLnJlbmRlcmVkID0gdHJ1ZTsNCgkJCQl9LA0KDQoJCQkJdG9nZ2xlRXhwYW5kZWQ6IGZ1bmN0aW9uKCkgew0KCQkJCQl0aGlzLmV4cGFuZGVkID0gIXRoaXMuZXhwYW5kZWQ7DQoJCQkJCWZvciAodmFyIGkgPSAwLCBsZW4gPSB0aGlzLmVsZW1lbnRDb250YWluZXJzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7DQoJCQkJCQl0aGlzLmVsZW1lbnRDb250YWluZXJzW2ldLnRvZ2dsZUV4cGFuZGVkKCk7DQoJCQkJCX0NCgkJCQl9LA0KDQoJCQkJZXhwYW5kOiBmdW5jdGlvbigpIHsNCgkJCQkJaWYgKCF0aGlzLmV4cGFuZGVkKSB7DQoJCQkJCQl0aGlzLnRvZ2dsZUV4cGFuZGVkKCk7DQoJCQkJCX0NCgkJCQl9LA0KDQoJCQkJYWNjZXB0OiBmdW5jdGlvbih2aXNpdG9yKSB7DQoJCQkJCXZpc2l0b3IudmlzaXRHcm91cCh0aGlzKTsNCgkJCQl9LA0KDQoJCQkJcmV2ZXJzZUNoaWxkcmVuOiBmdW5jdGlvbigpIHsNCgkJCQkJaWYgKHRoaXMucmVuZGVyZWQpIHsNCgkJCQkJCWZvciAodmFyIGkgPSAwLCBsZW4gPSB0aGlzLmVsZW1lbnRDb250YWluZXJzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7DQoJCQkJCQkJdGhpcy5lbGVtZW50Q29udGFpbmVyc1tpXS5yZXZlcnNlQ2hpbGRyZW4oKTsNCgkJCQkJCX0NCgkJCQkJfQ0KCQkJCX0sDQoNCgkJCQl1cGRhdGU6IGZ1bmN0aW9uKCkgew0KCQkJCQl2YXIgcHJldmlvdXNseUV4cGFuZGFibGUgPSB0aGlzLmV4cGFuZGFibGU7DQoJCQkJCXRoaXMuZXhwYW5kYWJsZSA9ICh0aGlzLmNoaWxkcmVuLmxlbmd0aCAhPT0gMCk7DQoJCQkJCWlmICh0aGlzLmV4cGFuZGFibGUgIT09IHByZXZpb3VzbHlFeHBhbmRhYmxlKSB7DQoJCQkJCQlmb3IgKHZhciBpID0gMCwgbGVuID0gdGhpcy5lbGVtZW50Q29udGFpbmVycy5sZW5ndGg7IGkgPCBsZW47IGkrKykgew0KCQkJCQkJCXRoaXMuZWxlbWVudENvbnRhaW5lcnNbaV0udXBkYXRlKCk7DQoJCQkJCQl9DQoJCQkJCX0NCgkJCQl9LA0KDQoJCQkJZmxhdHRlbjogZnVuY3Rpb24oKSB7DQoJCQkJCXZhciB2aXNpdG9yID0gbmV3IEdyb3VwRmxhdHRlbmVyKCk7DQoJCQkJCXRoaXMuYWNjZXB0KHZpc2l0b3IpOw0KCQkJCQlyZXR1cm4gdmlzaXRvci5sb2dFbnRyaWVzQW5kU2VwYXJhdG9yczsNCgkJCQl9LA0KDQoJCQkJcmVtb3ZlQ2hpbGQ6IGZ1bmN0aW9uKGNoaWxkLCBkb1VwZGF0ZSkgew0KCQkJCQlhcnJheV9yZW1vdmUodGhpcy5jaGlsZHJlbiwgY2hpbGQpOw0KCQkJCQljaGlsZC5ncm91cCA9IG51bGw7DQoJCQkJCWlmIChkb1VwZGF0ZSkgew0KCQkJCQkJdGhpcy51cGRhdGUoKTsNCgkJCQkJfQ0KCQkJCX0sDQoNCgkJCQlyZW1vdmU6IGZ1bmN0aW9uKGRvVXBkYXRlLCByZW1vdmVGcm9tR3JvdXApIHsNCgkJCQkJZm9yICh2YXIgaSA9IDAsIGxlbiA9IHRoaXMuY2hpbGRyZW4ubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsNCgkJCQkJCXRoaXMuY2hpbGRyZW5baV0ucmVtb3ZlKGZhbHNlLCBmYWxzZSk7DQoJCQkJCX0NCgkJCQkJdGhpcy5jaGlsZHJlbiA9IFtdOw0KCQkJCQl0aGlzLnVwZGF0ZSgpOw0KCQkJCQlpZiAodGhpcyA9PT0gY3VycmVudEdyb3VwKSB7DQoJCQkJCQljdXJyZW50R3JvdXAgPSB0aGlzLmdyb3VwOw0KCQkJCQl9DQoJCQkJCXRoaXMuZG9SZW1vdmUoZG9VcGRhdGUsIHJlbW92ZUZyb21Hcm91cCk7DQoJCQkJfSwNCg0KCQkJCXNlcmlhbGl6ZTogZnVuY3Rpb24oaXRlbXMpIHsNCgkJCQkJaXRlbXMucHVzaChbTG9nSXRlbS5zZXJpYWxpemVkSXRlbUtleXMuR1JPVVBfU1RBUlQsIHRoaXMubmFtZV0pOw0KCQkJCQlmb3IgKHZhciBpID0gMCwgbGVuID0gdGhpcy5jaGlsZHJlbi5sZW5ndGg7IGkgPCBsZW47IGkrKykgew0KCQkJCQkJdGhpcy5jaGlsZHJlbltpXS5zZXJpYWxpemUoaXRlbXMpOw0KCQkJCQl9DQoJCQkJCWlmICh0aGlzICE9PSBjdXJyZW50R3JvdXApIHsNCgkJCQkJCWl0ZW1zLnB1c2goW0xvZ0l0ZW0uc2VyaWFsaXplZEl0ZW1LZXlzLkdST1VQX0VORF0pOw0KCQkJCQl9DQoJCQkJfSwNCg0KCQkJCWNsZWFyOiBmdW5jdGlvbigpIHsNCgkJCQkJZm9yICh2YXIgaSA9IDAsIGxlbiA9IHRoaXMuZWxlbWVudENvbnRhaW5lcnMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsNCgkJCQkJCXRoaXMuZWxlbWVudENvbnRhaW5lcnNbaV0uY2xlYXIoKTsNCgkJCQkJfQ0KCQkJCX0NCgkJCX0pOw0KDQoJCQkvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLw0KDQoJCQlmdW5jdGlvbiBMb2dFbnRyeUVsZW1lbnRDb250YWluZXIoKSB7DQoJCQl9DQoNCgkJCUxvZ0VudHJ5RWxlbWVudENvbnRhaW5lci5wcm90b3R5cGUgPSBuZXcgTG9nSXRlbUNvbnRhaW5lckVsZW1lbnQoKTsNCg0KCQkJY29weVByb3BlcnRpZXMoTG9nRW50cnlFbGVtZW50Q29udGFpbmVyLnByb3RvdHlwZSwgew0KCQkJCXJlbW92ZTogZnVuY3Rpb24oKSB7DQoJCQkJCXRoaXMuZG9SZW1vdmUoKTsNCgkJCQl9LA0KDQoJCQkJZG9SZW1vdmU6IGZ1bmN0aW9uKCkgew0KCQkJCQl0aGlzLm1haW5EaXYucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLm1haW5EaXYpOw0KCQkJCQl0aGlzLm1haW5EaXYgPSBudWxsOw0KCQkJCQl0aGlzLmNvbnRlbnRFbGVtZW50ID0gbnVsbDsNCgkJCQkJdGhpcy5jb250YWluZXJEb21Ob2RlID0gbnVsbDsNCgkJCQl9LA0KDQoJCQkJc2V0Q29udGVudDogZnVuY3Rpb24oY29udGVudCwgd3JhcHBlZENvbnRlbnQpIHsNCgkJCQkJaWYgKGNvbnRlbnQgPT09IHRoaXMuZm9ybWF0dGVkTWVzc2FnZSkgew0KCQkJCQkJdGhpcy5jb250ZW50RWxlbWVudC5pbm5lckhUTUwgPSAiIjsNCgkJCQkJCXRoaXMuY29udGVudEVsZW1lbnQuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUodGhpcy5mb3JtYXR0ZWRNZXNzYWdlKSk7DQoJCQkJCX0gZWxzZSB7DQoJCQkJCQl0aGlzLmNvbnRlbnRFbGVtZW50LmlubmVySFRNTCA9IGNvbnRlbnQ7DQoJCQkJCX0NCgkJCQl9LA0KDQoJCQkJc2V0U2VhcmNoTWF0Y2g6IGZ1bmN0aW9uKGlzTWF0Y2gpIHsNCgkJCQkJdmFyIG9sZENzc0NsYXNzID0gaXNNYXRjaCA/ICJzZWFyY2hub25tYXRjaCIgOiAic2VhcmNobWF0Y2giOw0KCQkJCQl2YXIgbmV3Q3NzQ2xhc3MgPSBpc01hdGNoID8gInNlYXJjaG1hdGNoIiA6ICJzZWFyY2hub25tYXRjaCI7DQoJCQkJCXJlcGxhY2VDbGFzcyh0aGlzLm1haW5EaXYsIG5ld0Nzc0NsYXNzLCBvbGRDc3NDbGFzcyk7DQoJCQkJfSwNCg0KCQkJCWNsZWFyU2VhcmNoOiBmdW5jdGlvbigpIHsNCgkJCQkJcmVtb3ZlQ2xhc3ModGhpcy5tYWluRGl2LCAic2VhcmNobWF0Y2giKTsNCgkJCQkJcmVtb3ZlQ2xhc3ModGhpcy5tYWluRGl2LCAic2VhcmNobm9ubWF0Y2giKTsNCgkJCQl9DQoJCQl9KTsNCg0KCQkJLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8NCg0KCQkJZnVuY3Rpb24gTG9nRW50cnlXcmFwcGVkRWxlbWVudENvbnRhaW5lcihsb2dFbnRyeSwgY29udGFpbmVyRG9tTm9kZSkgew0KCQkJCXRoaXMubG9nRW50cnkgPSBsb2dFbnRyeTsNCgkJCQl0aGlzLmNvbnRhaW5lckRvbU5vZGUgPSBjb250YWluZXJEb21Ob2RlOw0KCQkJCXRoaXMubWFpbkRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOw0KCQkJCXRoaXMubWFpbkRpdi5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh0aGlzLmxvZ0VudHJ5LmZvcm1hdHRlZE1lc3NhZ2UpKTsNCgkJCQl0aGlzLm1haW5EaXYuY2xhc3NOYW1lID0gImxvZ2VudHJ5IHdyYXBwZWQgIiArIHRoaXMubG9nRW50cnkubGV2ZWw7DQoJCQkJdGhpcy5jb250ZW50RWxlbWVudCA9IHRoaXMubWFpbkRpdjsNCgkJCX0NCg0KCQkJTG9nRW50cnlXcmFwcGVkRWxlbWVudENvbnRhaW5lci5wcm90b3R5cGUgPSBuZXcgTG9nRW50cnlFbGVtZW50Q29udGFpbmVyKCk7DQoNCgkJCUxvZ0VudHJ5V3JhcHBlZEVsZW1lbnRDb250YWluZXIucHJvdG90eXBlLnNldENvbnRlbnQgPSBmdW5jdGlvbihjb250ZW50LCB3cmFwcGVkQ29udGVudCkgew0KCQkJCWlmIChjb250ZW50ID09PSB0aGlzLmZvcm1hdHRlZE1lc3NhZ2UpIHsNCgkJCQkJdGhpcy5jb250ZW50RWxlbWVudC5pbm5lckhUTUwgPSAiIjsNCgkJCQkJdGhpcy5jb250ZW50RWxlbWVudC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh0aGlzLmZvcm1hdHRlZE1lc3NhZ2UpKTsNCgkJCQl9IGVsc2Ugew0KCQkJCQl0aGlzLmNvbnRlbnRFbGVtZW50LmlubmVySFRNTCA9IHdyYXBwZWRDb250ZW50Ow0KCQkJCX0NCgkJCX07DQoNCgkJCS8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoNCgkJCWZ1bmN0aW9uIExvZ0VudHJ5VW53cmFwcGVkRWxlbWVudENvbnRhaW5lcihsb2dFbnRyeSwgY29udGFpbmVyRG9tTm9kZSkgew0KCQkJCXRoaXMubG9nRW50cnkgPSBsb2dFbnRyeTsNCgkJCQl0aGlzLmNvbnRhaW5lckRvbU5vZGUgPSBjb250YWluZXJEb21Ob2RlOw0KCQkJCXRoaXMubWFpbkRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOw0KCQkJCXRoaXMubWFpbkRpdi5jbGFzc05hbWUgPSAibG9nZW50cnkgdW53cmFwcGVkICIgKyB0aGlzLmxvZ0VudHJ5LmxldmVsOw0KCQkJCXRoaXMucHJlID0gdGhpcy5tYWluRGl2LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInByZSIpKTsNCgkJCQl0aGlzLnByZS5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh0aGlzLmxvZ0VudHJ5LmZvcm1hdHRlZE1lc3NhZ2UpKTsNCgkJCQl0aGlzLnByZS5jbGFzc05hbWUgPSAidW53cmFwcGVkIjsNCgkJCQl0aGlzLmNvbnRlbnRFbGVtZW50ID0gdGhpcy5wcmU7DQoJCQl9DQoNCgkJCUxvZ0VudHJ5VW53cmFwcGVkRWxlbWVudENvbnRhaW5lci5wcm90b3R5cGUgPSBuZXcgTG9nRW50cnlFbGVtZW50Q29udGFpbmVyKCk7DQoNCgkJCUxvZ0VudHJ5VW53cmFwcGVkRWxlbWVudENvbnRhaW5lci5wcm90b3R5cGUucmVtb3ZlID0gZnVuY3Rpb24oKSB7DQoJCQkJdGhpcy5kb1JlbW92ZSgpOw0KCQkJCXRoaXMucHJlID0gbnVsbDsNCgkJCX07DQoNCgkJCS8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoNCgkJCWZ1bmN0aW9uIExvZ0VudHJ5TWFpbkVsZW1lbnRDb250YWluZXIobG9nRW50cnksIGNvbnRhaW5lckRvbU5vZGUpIHsNCgkJCQl0aGlzLmxvZ0VudHJ5ID0gbG9nRW50cnk7DQoJCQkJdGhpcy5jb250YWluZXJEb21Ob2RlID0gY29udGFpbmVyRG9tTm9kZTsNCgkJCQl0aGlzLm1haW5EaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCgkJCQl0aGlzLm1haW5EaXYuY2xhc3NOYW1lID0gImxvZ2VudHJ5IG5vbmllbG9nZW50cnkgIiArIHRoaXMubG9nRW50cnkubGV2ZWw7DQoJCQkJdGhpcy5jb250ZW50RWxlbWVudCA9IHRoaXMubWFpbkRpdi5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzcGFuIikpOw0KCQkJCXRoaXMuY29udGVudEVsZW1lbnQuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUodGhpcy5sb2dFbnRyeS5mb3JtYXR0ZWRNZXNzYWdlKSk7DQoJCQl9DQoNCgkJCUxvZ0VudHJ5TWFpbkVsZW1lbnRDb250YWluZXIucHJvdG90eXBlID0gbmV3IExvZ0VudHJ5RWxlbWVudENvbnRhaW5lcigpOw0KDQoJCQkvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLw0KDQoJCQlmdW5jdGlvbiBMb2dFbnRyeShsZXZlbCwgZm9ybWF0dGVkTWVzc2FnZSkgew0KCQkJCXRoaXMubGV2ZWwgPSBsZXZlbDsNCgkJCQl0aGlzLmZvcm1hdHRlZE1lc3NhZ2UgPSBmb3JtYXR0ZWRNZXNzYWdlOw0KCQkJCXRoaXMucmVuZGVyZWQgPSBmYWxzZTsNCgkJCX0NCg0KCQkJTG9nRW50cnkucHJvdG90eXBlID0gbmV3IExvZ0l0ZW0oKTsNCg0KCQkJY29weVByb3BlcnRpZXMoTG9nRW50cnkucHJvdG90eXBlLCB7DQoJCQkJcmVuZGVyOiBmdW5jdGlvbigpIHsNCgkJCQkJdmFyIGxvZ0VudHJ5ID0gdGhpczsNCgkJCQkJdmFyIGNvbnRhaW5lckRvbU5vZGUgPSB0aGlzLmdyb3VwLmNvbnRlbnREaXY7DQoNCgkJCQkJLy8gU3VwcG9ydCBmb3IgdGhlIENTUyBhdHRyaWJ1dGUgd2hpdGUtc3BhY2UgaW4gSUUgZm9yIFdpbmRvd3MgaXMNCgkJCQkJLy8gbm9uLWV4aXN0ZW50IHByZSB2ZXJzaW9uIDYgYW5kIHNsaWdodGx5IG9kZCBpbiA2LCBzbyBpbnN0ZWFkDQoJCQkJCS8vIHVzZSB0d28gZGlmZmVyZW50IEhUTUwgZWxlbWVudHMNCgkJCQkJaWYgKGlzSWUpIHsNCgkJCQkJCXRoaXMuZm9ybWF0dGVkTWVzc2FnZSA9IHRoaXMuZm9ybWF0dGVkTWVzc2FnZS5yZXBsYWNlKC9cclxuL2csICJcciIpOyAvLyBXb3JrYXJvdW5kIGZvciBJRSdzIHRyZWF0bWVudCBvZiB3aGl0ZSBzcGFjZQ0KCQkJCQkJdGhpcy51bndyYXBwZWRFbGVtZW50Q29udGFpbmVyID0gbmV3IExvZ0VudHJ5VW53cmFwcGVkRWxlbWVudENvbnRhaW5lcih0aGlzLCB0aGlzLmdldFVud3JhcHBlZERvbUNvbnRhaW5lcigpKTsNCgkJCQkJCXRoaXMud3JhcHBlZEVsZW1lbnRDb250YWluZXIgPSBuZXcgTG9nRW50cnlXcmFwcGVkRWxlbWVudENvbnRhaW5lcih0aGlzLCB0aGlzLmdldFdyYXBwZWREb21Db250YWluZXIoKSk7DQoJCQkJCQl0aGlzLmVsZW1lbnRDb250YWluZXJzID0gW3RoaXMudW53cmFwcGVkRWxlbWVudENvbnRhaW5lciwgdGhpcy53cmFwcGVkRWxlbWVudENvbnRhaW5lcl07DQoJCQkJCX0gZWxzZSB7DQoJCQkJCQl0aGlzLm1haW5FbGVtZW50Q29udGFpbmVyID0gbmV3IExvZ0VudHJ5TWFpbkVsZW1lbnRDb250YWluZXIodGhpcywgdGhpcy5nZXRNYWluRG9tQ29udGFpbmVyKCkpOw0KCQkJCQkJdGhpcy5lbGVtZW50Q29udGFpbmVycyA9IFt0aGlzLm1haW5FbGVtZW50Q29udGFpbmVyXTsNCgkJCQkJfQ0KCQkJCQl0aGlzLmNvbnRlbnQgPSB0aGlzLmZvcm1hdHRlZE1lc3NhZ2U7DQoJCQkJCXRoaXMucmVuZGVyZWQgPSB0cnVlOw0KCQkJCX0sDQoNCgkJCQlzZXRDb250ZW50OiBmdW5jdGlvbihjb250ZW50LCB3cmFwcGVkQ29udGVudCkgew0KCQkJCQlpZiAoY29udGVudCAhPSB0aGlzLmNvbnRlbnQpIHsNCgkJCQkJCWlmIChpc0llICYmIChjb250ZW50ICE9PSB0aGlzLmZvcm1hdHRlZE1lc3NhZ2UpKSB7DQoJCQkJCQkJY29udGVudCA9IGNvbnRlbnQucmVwbGFjZSgvXHJcbi9nLCAiXHIiKTsgLy8gV29ya2Fyb3VuZCBmb3IgSUUncyB0cmVhdG1lbnQgb2Ygd2hpdGUgc3BhY2UNCgkJCQkJCX0NCgkJCQkJCWZvciAodmFyIGkgPSAwLCBsZW4gPSB0aGlzLmVsZW1lbnRDb250YWluZXJzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7DQoJCQkJCQkJdGhpcy5lbGVtZW50Q29udGFpbmVyc1tpXS5zZXRDb250ZW50KGNvbnRlbnQsIHdyYXBwZWRDb250ZW50KTsNCgkJCQkJCX0NCgkJCQkJCXRoaXMuY29udGVudCA9IGNvbnRlbnQ7DQoJCQkJCX0NCgkJCQl9LA0KDQoJCQkJZ2V0U2VhcmNoTWF0Y2hlczogZnVuY3Rpb24oKSB7DQoJCQkJCXZhciBtYXRjaGVzID0gW107DQoJCQkJCXZhciBpLCBsZW47DQoJCQkJCWlmIChpc0llKSB7DQoJCQkJCQl2YXIgdW53cmFwcGVkRWxzID0gZ2V0RWxlbWVudHNCeUNsYXNzKHRoaXMudW53cmFwcGVkRWxlbWVudENvbnRhaW5lci5tYWluRGl2LCAic2VhcmNodGVybSIsICJzcGFuIik7DQoJCQkJCQl2YXIgd3JhcHBlZEVscyA9IGdldEVsZW1lbnRzQnlDbGFzcyh0aGlzLndyYXBwZWRFbGVtZW50Q29udGFpbmVyLm1haW5EaXYsICJzZWFyY2h0ZXJtIiwgInNwYW4iKTsNCgkJCQkJCWZvciAoaSA9IDAsIGxlbiA9IHVud3JhcHBlZEVscy5sZW5ndGg7IGkgPCBsZW47IGkrKykgew0KCQkJCQkJCW1hdGNoZXNbaV0gPSBuZXcgTWF0Y2godGhpcy5sZXZlbCwgbnVsbCwgdW53cmFwcGVkRWxzW2ldLCB3cmFwcGVkRWxzW2ldKTsNCgkJCQkJCX0NCgkJCQkJfSBlbHNlIHsNCgkJCQkJCXZhciBlbHMgPSBnZXRFbGVtZW50c0J5Q2xhc3ModGhpcy5tYWluRWxlbWVudENvbnRhaW5lci5tYWluRGl2LCAic2VhcmNodGVybSIsICJzcGFuIik7DQoJCQkJCQlmb3IgKGkgPSAwLCBsZW4gPSBlbHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsNCgkJCQkJCQltYXRjaGVzW2ldID0gbmV3IE1hdGNoKHRoaXMubGV2ZWwsIGVsc1tpXSk7DQoJCQkJCQl9DQoJCQkJCX0NCgkJCQkJcmV0dXJuIG1hdGNoZXM7DQoJCQkJfSwNCg0KCQkJCXNldFNlYXJjaE1hdGNoOiBmdW5jdGlvbihpc01hdGNoKSB7DQoJCQkJCWZvciAodmFyIGkgPSAwLCBsZW4gPSB0aGlzLmVsZW1lbnRDb250YWluZXJzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7DQoJCQkJCQl0aGlzLmVsZW1lbnRDb250YWluZXJzW2ldLnNldFNlYXJjaE1hdGNoKGlzTWF0Y2gpOw0KCQkJCQl9DQoJCQkJfSwNCg0KCQkJCWNsZWFyU2VhcmNoOiBmdW5jdGlvbigpIHsNCgkJCQkJZm9yICh2YXIgaSA9IDAsIGxlbiA9IHRoaXMuZWxlbWVudENvbnRhaW5lcnMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsNCgkJCQkJCXRoaXMuZWxlbWVudENvbnRhaW5lcnNbaV0uY2xlYXJTZWFyY2goKTsNCgkJCQkJfQ0KCQkJCX0sDQoNCgkJCQlhY2NlcHQ6IGZ1bmN0aW9uKHZpc2l0b3IpIHsNCgkJCQkJdmlzaXRvci52aXNpdExvZ0VudHJ5KHRoaXMpOw0KCQkJCX0sDQoNCgkJCQlzZXJpYWxpemU6IGZ1bmN0aW9uKGl0ZW1zKSB7DQoJCQkJCWl0ZW1zLnB1c2goW0xvZ0l0ZW0uc2VyaWFsaXplZEl0ZW1LZXlzLkxPR19FTlRSWSwgdGhpcy5sZXZlbCwgdGhpcy5mb3JtYXR0ZWRNZXNzYWdlXSk7DQoJCQkJfQ0KCQkJfSk7DQoNCgkJCS8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoNCgkJCWZ1bmN0aW9uIExvZ0l0ZW1WaXNpdG9yKCkgew0KCQkJfQ0KDQoJCQlMb2dJdGVtVmlzaXRvci5wcm90b3R5cGUgPSB7DQoJCQkJdmlzaXQ6IGZ1bmN0aW9uKGxvZ0l0ZW0pIHsNCgkJCQl9LA0KDQoJCQkJdmlzaXRQYXJlbnQ6IGZ1bmN0aW9uKGxvZ0l0ZW0pIHsNCgkJCQkJaWYgKGxvZ0l0ZW0uZ3JvdXApIHsNCgkJCQkJCWxvZ0l0ZW0uZ3JvdXAuYWNjZXB0KHRoaXMpOw0KCQkJCQl9DQoJCQkJfSwNCg0KCQkJCXZpc2l0Q2hpbGRyZW46IGZ1bmN0aW9uKGxvZ0l0ZW0pIHsNCgkJCQkJZm9yICh2YXIgaSA9IDAsIGxlbiA9IGxvZ0l0ZW0uY2hpbGRyZW4ubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsNCgkJCQkJCWxvZ0l0ZW0uY2hpbGRyZW5baV0uYWNjZXB0KHRoaXMpOw0KCQkJCQl9DQoJCQkJfSwNCg0KCQkJCXZpc2l0TG9nRW50cnk6IGZ1bmN0aW9uKGxvZ0VudHJ5KSB7DQoJCQkJCXRoaXMudmlzaXQobG9nRW50cnkpOw0KCQkJCX0sDQoNCgkJCQl2aXNpdFNlcGFyYXRvcjogZnVuY3Rpb24oc2VwYXJhdG9yKSB7DQoJCQkJCXRoaXMudmlzaXQoc2VwYXJhdG9yKTsNCgkJCQl9LA0KDQoJCQkJdmlzaXRHcm91cDogZnVuY3Rpb24oZ3JvdXApIHsNCgkJCQkJdGhpcy52aXNpdChncm91cCk7DQoJCQkJfQ0KCQkJfTsNCg0KCQkJLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8NCg0KCQkJZnVuY3Rpb24gR3JvdXBGbGF0dGVuZXIoKSB7DQoJCQkJdGhpcy5sb2dFbnRyaWVzQW5kU2VwYXJhdG9ycyA9IFtdOw0KCQkJfQ0KDQoJCQlHcm91cEZsYXR0ZW5lci5wcm90b3R5cGUgPSBuZXcgTG9nSXRlbVZpc2l0b3IoKTsNCg0KCQkJR3JvdXBGbGF0dGVuZXIucHJvdG90eXBlLnZpc2l0R3JvdXAgPSBmdW5jdGlvbihncm91cCkgew0KCQkJCXRoaXMudmlzaXRDaGlsZHJlbihncm91cCk7DQoJCQl9Ow0KDQoJCQlHcm91cEZsYXR0ZW5lci5wcm90b3R5cGUudmlzaXRMb2dFbnRyeSA9IGZ1bmN0aW9uKGxvZ0VudHJ5KSB7DQoJCQkJdGhpcy5sb2dFbnRyaWVzQW5kU2VwYXJhdG9ycy5wdXNoKGxvZ0VudHJ5KTsNCgkJCX07DQoNCgkJCUdyb3VwRmxhdHRlbmVyLnByb3RvdHlwZS52aXNpdFNlcGFyYXRvciA9IGZ1bmN0aW9uKHNlcGFyYXRvcikgew0KCQkJCXRoaXMubG9nRW50cmllc0FuZFNlcGFyYXRvcnMucHVzaChzZXBhcmF0b3IpOw0KCQkJfTsNCg0KCQkJLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8NCg0KCQkJd2luZG93Lm9ubG9hZCA9IGZ1bmN0aW9uKCkgew0KCQkJCS8vIFNvcnQgb3V0IGRvY3VtZW50LmRvbWFpbg0KCQkJCWlmIChsb2NhdGlvbi5zZWFyY2gpIHsNCgkJCQkJdmFyIHF1ZXJ5Qml0cyA9IHVuZXNjYXBlKGxvY2F0aW9uLnNlYXJjaCkuc3Vic3RyKDEpLnNwbGl0KCImIiksIG5hbWVWYWx1ZUJpdHM7DQoJCQkJCWZvciAodmFyIGkgPSAwLCBsZW4gPSBxdWVyeUJpdHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsNCgkJCQkJCW5hbWVWYWx1ZUJpdHMgPSBxdWVyeUJpdHNbaV0uc3BsaXQoIj0iKTsNCgkJCQkJCWlmIChuYW1lVmFsdWVCaXRzWzBdID09ICJsb2c0amF2YXNjcmlwdF9kb21haW4iKSB7DQoJCQkJCQkJZG9jdW1lbnQuZG9tYWluID0gbmFtZVZhbHVlQml0c1sxXTsNCgkJCQkJCQlicmVhazsNCgkJCQkJCX0NCgkJCQkJfQ0KCQkJCX0NCg0KCQkJCS8vIENyZWF0ZSBET00gb2JqZWN0cw0KCQkJCWxvZ01haW5Db250YWluZXIgPSAkKCJsb2ciKTsNCgkJCQlpZiAoaXNJZVByZTcpIHsNCgkJCQkJYWRkQ2xhc3MobG9nTWFpbkNvbnRhaW5lciwgIm9sZEllIik7DQoJCQkJfQ0KDQoJCQkJcm9vdEdyb3VwID0gbmV3IEdyb3VwKCJyb290IiwgdHJ1ZSk7DQoJCQkJcm9vdEdyb3VwLnJlbmRlcigpOw0KCQkJCWN1cnJlbnRHcm91cCA9IHJvb3RHcm91cDsNCgkJCQkNCgkJCQlzZXRDb21tYW5kSW5wdXRXaWR0aCgpOw0KCQkJCXNldExvZ0NvbnRhaW5lckhlaWdodCgpOw0KCQkJCXRvZ2dsZUxvZ2dpbmdFbmFibGVkKCk7DQoJCQkJdG9nZ2xlU2VhcmNoRW5hYmxlZCgpOw0KCQkJCXRvZ2dsZVNlYXJjaEZpbHRlcigpOw0KCQkJCXRvZ2dsZVNlYXJjaEhpZ2hsaWdodCgpOw0KCQkJCWFwcGx5RmlsdGVycygpOw0KCQkJCWNoZWNrQWxsTGV2ZWxzKCk7DQoJCQkJdG9nZ2xlV3JhcCgpOw0KCQkJCXRvZ2dsZU5ld2VzdEF0VG9wKCk7DQoJCQkJdG9nZ2xlU2Nyb2xsVG9MYXRlc3QoKTsNCgkJCQlyZW5kZXJRdWV1ZWRMb2dJdGVtcygpOw0KCQkJCWxvYWRlZCA9IHRydWU7DQoJCQkJJCgiY29tbWFuZCIpLnZhbHVlID0gIiI7DQoJCQkJJCgiY29tbWFuZCIpLmF1dG9jb21wbGV0ZSA9ICJvZmYiOw0KCQkJCSQoImNvbW1hbmQiKS5vbmtleWRvd24gPSBmdW5jdGlvbihldnQpIHsNCgkJCQkJZXZ0ID0gZ2V0RXZlbnQoZXZ0KTsNCgkJCQkJaWYgKGV2dC5rZXlDb2RlID09IDEwIHx8IGV2dC5rZXlDb2RlID09IDEzKSB7IC8vIFJldHVybi9FbnRlcg0KCQkJCQkJZXZhbENvbW1hbmRMaW5lKCk7DQoJCQkJCQlzdG9wUHJvcGFnYXRpb24oZXZ0KTsNCgkJCQkJfSBlbHNlIGlmIChldnQua2V5Q29kZSA9PSAyNykgeyAvLyBFc2NhcGUNCgkJCQkJCXRoaXMudmFsdWUgPSAiIjsNCgkJCQkJCXRoaXMuZm9jdXMoKTsNCgkJCQkJfSBlbHNlIGlmIChldnQua2V5Q29kZSA9PSAzOCAmJiBjb21tYW5kSGlzdG9yeS5sZW5ndGggPiAwKSB7IC8vIFVwDQoJCQkJCQljdXJyZW50Q29tbWFuZEluZGV4ID0gTWF0aC5tYXgoMCwgY3VycmVudENvbW1hbmRJbmRleCAtIDEpOw0KCQkJCQkJdGhpcy52YWx1ZSA9IGNvbW1hbmRIaXN0b3J5W2N1cnJlbnRDb21tYW5kSW5kZXhdOw0KCQkJCQkJbW92ZUNhcmV0VG9FbmQodGhpcyk7DQoJCQkJCX0gZWxzZSBpZiAoZXZ0LmtleUNvZGUgPT0gNDAgJiYgY29tbWFuZEhpc3RvcnkubGVuZ3RoID4gMCkgeyAvLyBEb3duDQoJCQkJCQljdXJyZW50Q29tbWFuZEluZGV4ID0gTWF0aC5taW4oY29tbWFuZEhpc3RvcnkubGVuZ3RoIC0gMSwgY3VycmVudENvbW1hbmRJbmRleCArIDEpOw0KCQkJCQkJdGhpcy52YWx1ZSA9IGNvbW1hbmRIaXN0b3J5W2N1cnJlbnRDb21tYW5kSW5kZXhdOw0KCQkJCQkJbW92ZUNhcmV0VG9FbmQodGhpcyk7DQoJCQkJCX0NCgkJCQl9Ow0KDQoJCQkJLy8gUHJldmVudCB0aGUga2V5cHJlc3MgbW92aW5nIHRoZSBjYXJldCBpbiBGaXJlZm94DQoJCQkJJCgiY29tbWFuZCIpLm9ua2V5cHJlc3MgPSBmdW5jdGlvbihldnQpIHsNCgkJCQkJZXZ0ID0gZ2V0RXZlbnQoZXZ0KTsNCgkJCQkJaWYgKGV2dC5rZXlDb2RlID09IDM4ICYmIGNvbW1hbmRIaXN0b3J5Lmxlbmd0aCA+IDAgJiYgZXZ0LnByZXZlbnREZWZhdWx0KSB7IC8vIFVwDQoJCQkJCQlldnQucHJldmVudERlZmF1bHQoKTsNCgkJCQkJfQ0KCQkJCX07DQoNCgkJCQkvLyBQcmV2ZW50IHRoZSBrZXl1cCBldmVudCBibHVycmluZyB0aGUgaW5wdXQgaW4gT3BlcmENCgkJCQkkKCJjb21tYW5kIikub25rZXl1cCA9IGZ1bmN0aW9uKGV2dCkgew0KCQkJCQlldnQgPSBnZXRFdmVudChldnQpOw0KCQkJCQlpZiAoZXZ0LmtleUNvZGUgPT0gMjcgJiYgZXZ0LnByZXZlbnREZWZhdWx0KSB7IC8vIFVwDQoJCQkJCQlldnQucHJldmVudERlZmF1bHQoKTsNCgkJCQkJCXRoaXMuZm9jdXMoKTsNCgkJCQkJfQ0KCQkJCX07DQoNCgkJCQkvLyBBZGQgZG9jdW1lbnQga2V5Ym9hcmQgc2hvcnRjdXRzDQoJCQkJZG9jdW1lbnQub25rZXlkb3duID0gZnVuY3Rpb24ga2V5RXZlbnRIYW5kbGVyKGV2dCkgew0KCQkJCQlldnQgPSBnZXRFdmVudChldnQpOw0KCQkJCQlzd2l0Y2ggKGV2dC5rZXlDb2RlKSB7DQoJCQkJCQljYXNlIDY5OiAvLyBDdHJsICsgc2hpZnQgKyBFOiByZS1leGVjdXRlIGxhc3QgY29tbWFuZA0KCQkJCQkJCWlmIChldnQuc2hpZnRLZXkgJiYgKGV2dC5jdHJsS2V5IHx8IGV2dC5tZXRhS2V5KSkgew0KCQkJCQkJCQlldmFsTGFzdENvbW1hbmQoKTsNCgkJCQkJCQkJY2FuY2VsS2V5RXZlbnQoZXZ0KTsNCgkJCQkJCQkJcmV0dXJuIGZhbHNlOw0KCQkJCQkJCX0NCgkJCQkJCQlicmVhazsNCgkJCQkJCWNhc2UgNzU6IC8vIEN0cmwgKyBzaGlmdCArIEs6IGZvY3VzIHNlYXJjaA0KCQkJCQkJCWlmIChldnQuc2hpZnRLZXkgJiYgKGV2dC5jdHJsS2V5IHx8IGV2dC5tZXRhS2V5KSkgew0KCQkJCQkJCQlmb2N1c1NlYXJjaCgpOw0KCQkJCQkJCQljYW5jZWxLZXlFdmVudChldnQpOw0KCQkJCQkJCQlyZXR1cm4gZmFsc2U7DQoJCQkJCQkJfQ0KCQkJCQkJCWJyZWFrOw0KCQkJCQkJY2FzZSA0MDogLy8gQ3RybCArIHNoaWZ0ICsgZG93biBhcnJvdzogZm9jdXMgY29tbWFuZCBsaW5lDQoJCQkJCQljYXNlIDc2OiAvLyBDdHJsICsgc2hpZnQgKyBMOiBmb2N1cyBjb21tYW5kIGxpbmUNCgkJCQkJCQlpZiAoZXZ0LnNoaWZ0S2V5ICYmIChldnQuY3RybEtleSB8fCBldnQubWV0YUtleSkpIHsNCgkJCQkJCQkJZm9jdXNDb21tYW5kTGluZSgpOw0KCQkJCQkJCQljYW5jZWxLZXlFdmVudChldnQpOw0KCQkJCQkJCQlyZXR1cm4gZmFsc2U7DQoJCQkJCQkJfQ0KCQkJCQkJCWJyZWFrOw0KCQkJCQl9DQoJCQkJfTsNCg0KCQkJCS8vIFdvcmthcm91bmQgdG8gbWFrZSBzdXJlIGxvZyBkaXYgc3RhcnRzIGF0IHRoZSBjb3JyZWN0IHNpemUNCgkJCQlzZXRUaW1lb3V0KHNldExvZ0NvbnRhaW5lckhlaWdodCwgMjApOw0KDQoJCQkJc2V0U2hvd0NvbW1hbmRMaW5lKHNob3dDb21tYW5kTGluZSk7DQoJCQkJZG9TZWFyY2goKTsNCgkJCX07DQoNCgkJCXdpbmRvdy5vbnVubG9hZCA9IGZ1bmN0aW9uKCkgew0KCQkJCWlmIChtYWluV2luZG93RXhpc3RzKCkpIHsNCgkJCQkJYXBwZW5kZXIudW5sb2FkKCk7DQoJCQkJfQ0KCQkJCWFwcGVuZGVyID0gbnVsbDsNCgkJCX07DQoNCgkJCS8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoNCgkJCWZ1bmN0aW9uIHRvZ2dsZUxvZ2dpbmdFbmFibGVkKCkgew0KCQkJCXNldExvZ2dpbmdFbmFibGVkKCQoImVuYWJsZUxvZ2dpbmciKS5jaGVja2VkKTsNCgkJCX0NCg0KCQkJZnVuY3Rpb24gc2V0TG9nZ2luZ0VuYWJsZWQoZW5hYmxlKSB7DQoJCQkJbG9nZ2luZ0VuYWJsZWQgPSBlbmFibGU7DQoJCQl9DQoNCgkJCXZhciBhcHBlbmRlciA9IG51bGw7DQoNCgkJCWZ1bmN0aW9uIHNldEFwcGVuZGVyKGFwcGVuZGVyUGFyYW0pIHsNCgkJCQlhcHBlbmRlciA9IGFwcGVuZGVyUGFyYW07DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIHNldFNob3dDbG9zZUJ1dHRvbihzaG93Q2xvc2VCdXR0b24pIHsNCgkJCQkkKCJjbG9zZUJ1dHRvbiIpLnN0eWxlLmRpc3BsYXkgPSBzaG93Q2xvc2VCdXR0b24gPyAiaW5saW5lIiA6ICJub25lIjsNCgkJCX0NCg0KCQkJZnVuY3Rpb24gc2V0U2hvd0hpZGVCdXR0b24oc2hvd0hpZGVCdXR0b24pIHsNCgkJCQkkKCJoaWRlQnV0dG9uIikuc3R5bGUuZGlzcGxheSA9IHNob3dIaWRlQnV0dG9uID8gImlubGluZSIgOiAibm9uZSI7DQoJCQl9DQoNCgkJCXZhciBuZXdlc3RBdFRvcCA9IGZhbHNlOw0KDQoJCQkvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLw0KDQoJCQlmdW5jdGlvbiBMb2dJdGVtQ29udGVudFJldmVyc2VyKCkgew0KCQkJfQ0KCQkJDQoJCQlMb2dJdGVtQ29udGVudFJldmVyc2VyLnByb3RvdHlwZSA9IG5ldyBMb2dJdGVtVmlzaXRvcigpOw0KCQkJDQoJCQlMb2dJdGVtQ29udGVudFJldmVyc2VyLnByb3RvdHlwZS52aXNpdEdyb3VwID0gZnVuY3Rpb24oZ3JvdXApIHsNCgkJCQlncm91cC5yZXZlcnNlQ2hpbGRyZW4oKTsNCgkJCQl0aGlzLnZpc2l0Q2hpbGRyZW4oZ3JvdXApOw0KCQkJfTsNCg0KCQkJLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8NCg0KCQkJZnVuY3Rpb24gc2V0TmV3ZXN0QXRUb3AoaXNOZXdlc3RBdFRvcCkgew0KCQkJCXZhciBvbGROZXdlc3RBdFRvcCA9IG5ld2VzdEF0VG9wOw0KCQkJCXZhciBpLCBpTGVuLCBqLCBqTGVuOw0KCQkJCW5ld2VzdEF0VG9wID0gQm9vbGVhbihpc05ld2VzdEF0VG9wKTsNCgkJCQlpZiAob2xkTmV3ZXN0QXRUb3AgIT0gbmV3ZXN0QXRUb3ApIHsNCgkJCQkJdmFyIHZpc2l0b3IgPSBuZXcgTG9nSXRlbUNvbnRlbnRSZXZlcnNlcigpOw0KCQkJCQlyb290R3JvdXAuYWNjZXB0KHZpc2l0b3IpOw0KDQoJCQkJCS8vIFJlYXNzZW1ibGUgdGhlIG1hdGNoZXMgYXJyYXkNCgkJCQkJaWYgKGN1cnJlbnRTZWFyY2gpIHsNCgkJCQkJCXZhciBjdXJyZW50TWF0Y2ggPSBjdXJyZW50U2VhcmNoLm1hdGNoZXNbY3VycmVudE1hdGNoSW5kZXhdOw0KCQkJCQkJdmFyIG1hdGNoSW5kZXggPSAwOw0KCQkJCQkJdmFyIG1hdGNoZXMgPSBbXTsNCgkJCQkJCXZhciBhY3RPbkxvZ0VudHJ5ID0gZnVuY3Rpb24obG9nRW50cnkpIHsNCgkJCQkJCQl2YXIgbG9nRW50cnlNYXRjaGVzID0gbG9nRW50cnkuZ2V0U2VhcmNoTWF0Y2hlcygpOw0KCQkJCQkJCWZvciAoaiA9IDAsIGpMZW4gPSBsb2dFbnRyeU1hdGNoZXMubGVuZ3RoOyBqIDwgakxlbjsgaisrKSB7DQoJCQkJCQkJCW1hdGNoZXNbbWF0Y2hJbmRleF0gPSBsb2dFbnRyeU1hdGNoZXNbal07DQoJCQkJCQkJCWlmIChjdXJyZW50TWF0Y2ggJiYgbG9nRW50cnlNYXRjaGVzW2pdLmVxdWFscyhjdXJyZW50TWF0Y2gpKSB7DQoJCQkJCQkJCQljdXJyZW50TWF0Y2hJbmRleCA9IG1hdGNoSW5kZXg7DQoJCQkJCQkJCX0NCgkJCQkJCQkJbWF0Y2hJbmRleCsrOw0KCQkJCQkJCX0NCgkJCQkJCX07DQoJCQkJCQlpZiAobmV3ZXN0QXRUb3ApIHsNCgkJCQkJCQlmb3IgKGkgPSBsb2dFbnRyaWVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7DQoJCQkJCQkJCWFjdE9uTG9nRW50cnkobG9nRW50cmllc1tpXSk7DQoJCQkJCQkJfQ0KCQkJCQkJfSBlbHNlIHsNCgkJCQkJCQlmb3IgKGkgPSAwLCBpTGVuID0gbG9nRW50cmllcy5sZW5ndGg7IGkgPCBpTGVuOyBpKyspIHsNCgkJCQkJCQkJYWN0T25Mb2dFbnRyeShsb2dFbnRyaWVzW2ldKTsNCgkJCQkJCQl9DQoJCQkJCQl9DQoJCQkJCQljdXJyZW50U2VhcmNoLm1hdGNoZXMgPSBtYXRjaGVzOw0KCQkJCQkJaWYgKGN1cnJlbnRNYXRjaCkgew0KCQkJCQkJCWN1cnJlbnRNYXRjaC5zZXRDdXJyZW50KCk7DQoJCQkJCQl9DQoJCQkJCX0gZWxzZSBpZiAoc2Nyb2xsVG9MYXRlc3QpIHsNCgkJCQkJCWRvU2Nyb2xsVG9MYXRlc3QoKTsNCgkJCQkJfQ0KCQkJCX0NCgkJCQkkKCJuZXdlc3RBdFRvcCIpLmNoZWNrZWQgPSBpc05ld2VzdEF0VG9wOw0KCQkJfQ0KDQoJCQlmdW5jdGlvbiB0b2dnbGVOZXdlc3RBdFRvcCgpIHsNCgkJCQl2YXIgaXNOZXdlc3RBdFRvcCA9ICQoIm5ld2VzdEF0VG9wIikuY2hlY2tlZDsNCgkJCQlzZXROZXdlc3RBdFRvcChpc05ld2VzdEF0VG9wKTsNCgkJCX0NCg0KCQkJdmFyIHNjcm9sbFRvTGF0ZXN0ID0gdHJ1ZTsNCg0KCQkJZnVuY3Rpb24gc2V0U2Nyb2xsVG9MYXRlc3QoaXNTY3JvbGxUb0xhdGVzdCkgew0KCQkJCXNjcm9sbFRvTGF0ZXN0ID0gaXNTY3JvbGxUb0xhdGVzdDsNCgkJCQlpZiAoc2Nyb2xsVG9MYXRlc3QpIHsNCgkJCQkJZG9TY3JvbGxUb0xhdGVzdCgpOw0KCQkJCX0NCgkJCQkkKCJzY3JvbGxUb0xhdGVzdCIpLmNoZWNrZWQgPSBpc1Njcm9sbFRvTGF0ZXN0Ow0KCQkJfQ0KDQoJCQlmdW5jdGlvbiB0b2dnbGVTY3JvbGxUb0xhdGVzdCgpIHsNCgkJCQl2YXIgaXNTY3JvbGxUb0xhdGVzdCA9ICQoInNjcm9sbFRvTGF0ZXN0IikuY2hlY2tlZDsNCgkJCQlzZXRTY3JvbGxUb0xhdGVzdChpc1Njcm9sbFRvTGF0ZXN0KTsNCgkJCX0NCg0KCQkJZnVuY3Rpb24gZG9TY3JvbGxUb0xhdGVzdCgpIHsNCgkJCQl2YXIgbCA9IGxvZ01haW5Db250YWluZXI7DQoJCQkJaWYgKHR5cGVvZiBsLnNjcm9sbFRvcCAhPSAidW5kZWZpbmVkIikgew0KCQkJCQlpZiAobmV3ZXN0QXRUb3ApIHsNCgkJCQkJCWwuc2Nyb2xsVG9wID0gMDsNCgkJCQkJfSBlbHNlIHsNCgkJCQkJCXZhciBsYXRlc3RMb2dFbnRyeSA9IGwubGFzdENoaWxkOw0KCQkJCQkJaWYgKGxhdGVzdExvZ0VudHJ5KSB7DQoJCQkJCQkJbC5zY3JvbGxUb3AgPSBsLnNjcm9sbEhlaWdodDsNCgkJCQkJCX0NCgkJCQkJfQ0KCQkJCX0NCgkJCX0NCg0KCQkJdmFyIGNsb3NlSWZPcGVuZXJDbG9zZXMgPSB0cnVlOw0KDQoJCQlmdW5jdGlvbiBzZXRDbG9zZUlmT3BlbmVyQ2xvc2VzKGlzQ2xvc2VJZk9wZW5lckNsb3Nlcykgew0KCQkJCWNsb3NlSWZPcGVuZXJDbG9zZXMgPSBpc0Nsb3NlSWZPcGVuZXJDbG9zZXM7DQoJCQl9DQoNCgkJCXZhciBtYXhNZXNzYWdlcyA9IG51bGw7DQoNCgkJCWZ1bmN0aW9uIHNldE1heE1lc3NhZ2VzKG1heCkgew0KCQkJCW1heE1lc3NhZ2VzID0gbWF4Ow0KCQkJCXBydW5lTG9nRW50cmllcygpOw0KCQkJfQ0KDQoJCQl2YXIgc2hvd0NvbW1hbmRMaW5lID0gZmFsc2U7DQoNCgkJCWZ1bmN0aW9uIHNldFNob3dDb21tYW5kTGluZShpc1Nob3dDb21tYW5kTGluZSkgew0KCQkJCXNob3dDb21tYW5kTGluZSA9IGlzU2hvd0NvbW1hbmRMaW5lOw0KCQkJCWlmIChsb2FkZWQpIHsNCgkJCQkJJCgiY29tbWFuZExpbmUiKS5zdHlsZS5kaXNwbGF5ID0gc2hvd0NvbW1hbmRMaW5lID8gImJsb2NrIiA6ICJub25lIjsNCgkJCQkJc2V0Q29tbWFuZElucHV0V2lkdGgoKTsNCgkJCQkJc2V0TG9nQ29udGFpbmVySGVpZ2h0KCk7DQoJCQkJfQ0KCQkJfQ0KDQoJCQlmdW5jdGlvbiBmb2N1c0NvbW1hbmRMaW5lKCkgew0KCQkJCWlmIChsb2FkZWQpIHsNCgkJCQkJJCgiY29tbWFuZCIpLmZvY3VzKCk7DQoJCQkJfQ0KCQkJfQ0KDQoJCQlmdW5jdGlvbiBmb2N1c1NlYXJjaCgpIHsNCgkJCQlpZiAobG9hZGVkKSB7DQoJCQkJCSQoInNlYXJjaEJveCIpLmZvY3VzKCk7DQoJCQkJfQ0KCQkJfQ0KDQoJCQlmdW5jdGlvbiBnZXRMb2dJdGVtcygpIHsNCgkJCQl2YXIgaXRlbXMgPSBbXTsNCgkJCQlmb3IgKHZhciBpID0gMCwgbGVuID0gbG9nSXRlbXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsNCgkJCQkJbG9nSXRlbXNbaV0uc2VyaWFsaXplKGl0ZW1zKTsNCgkJCQl9DQoJCQkJcmV0dXJuIGl0ZW1zOw0KCQkJfQ0KDQoJCQlmdW5jdGlvbiBzZXRMb2dJdGVtcyhpdGVtcykgew0KCQkJCXZhciBsb2dnaW5nUmVhbGx5RW5hYmxlZCA9IGxvZ2dpbmdFbmFibGVkOw0KCQkJCS8vIFRlbXBvcmFyaWx5IHR1cm4gbG9nZ2luZyBvbg0KCQkJCWxvZ2dpbmdFbmFibGVkID0gdHJ1ZTsNCgkJCQlmb3IgKHZhciBpID0gMCwgbGVuID0gaXRlbXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsNCgkJCQkJc3dpdGNoIChpdGVtc1tpXVswXSkgew0KCQkJCQkJY2FzZSBMb2dJdGVtLnNlcmlhbGl6ZWRJdGVtS2V5cy5MT0dfRU5UUlk6DQoJCQkJCQkJbG9nKGl0ZW1zW2ldWzFdLCBpdGVtc1tpXVsyXSk7DQoJCQkJCQkJYnJlYWs7DQoJCQkJCQljYXNlIExvZ0l0ZW0uc2VyaWFsaXplZEl0ZW1LZXlzLkdST1VQX1NUQVJUOg0KCQkJCQkJCWdyb3VwKGl0ZW1zW2ldWzFdKTsNCgkJCQkJCQlicmVhazsNCgkJCQkJCWNhc2UgTG9nSXRlbS5zZXJpYWxpemVkSXRlbUtleXMuR1JPVVBfRU5EOg0KCQkJCQkJCWdyb3VwRW5kKCk7DQoJCQkJCQkJYnJlYWs7DQoJCQkJCX0NCgkJCQl9DQoJCQkJbG9nZ2luZ0VuYWJsZWQgPSBsb2dnaW5nUmVhbGx5RW5hYmxlZDsNCgkJCX0NCg0KCQkJZnVuY3Rpb24gbG9nKGxvZ0xldmVsLCBmb3JtYXR0ZWRNZXNzYWdlKSB7DQoJCQkJaWYgKGxvZ2dpbmdFbmFibGVkKSB7DQoJCQkJCXZhciBsb2dFbnRyeSA9IG5ldyBMb2dFbnRyeShsb2dMZXZlbCwgZm9ybWF0dGVkTWVzc2FnZSk7DQoJCQkJCWxvZ0VudHJpZXMucHVzaChsb2dFbnRyeSk7DQoJCQkJCWxvZ0VudHJpZXNBbmRTZXBhcmF0b3JzLnB1c2gobG9nRW50cnkpOw0KCQkJCQlsb2dJdGVtcy5wdXNoKGxvZ0VudHJ5KTsNCgkJCQkJY3VycmVudEdyb3VwLmFkZENoaWxkKGxvZ0VudHJ5KTsNCgkJCQkJaWYgKGxvYWRlZCkgew0KCQkJCQkJaWYgKGxvZ1F1ZXVlZEV2ZW50c1RpbWVyICE9PSBudWxsKSB7DQoJCQkJCQkJY2xlYXJUaW1lb3V0KGxvZ1F1ZXVlZEV2ZW50c1RpbWVyKTsNCgkJCQkJCX0NCgkJCQkJCWxvZ1F1ZXVlZEV2ZW50c1RpbWVyID0gc2V0VGltZW91dChyZW5kZXJRdWV1ZWRMb2dJdGVtcywgcmVuZGVyRGVsYXkpOw0KCQkJCQkJdW5yZW5kZXJlZExvZ0l0ZW1zRXhpc3QgPSB0cnVlOw0KCQkJCQl9DQoJCQkJfQ0KCQkJfQ0KDQoJCQlmdW5jdGlvbiByZW5kZXJRdWV1ZWRMb2dJdGVtcygpIHsNCgkJCQlsb2dRdWV1ZWRFdmVudHNUaW1lciA9IG51bGw7DQoJCQkJdmFyIHBydW5lZCA9IHBydW5lTG9nRW50cmllcygpOw0KDQoJCQkJLy8gUmVuZGVyIGFueSB1bnJlbmRlcmVkIGxvZyBlbnRyaWVzIGFuZCBhcHBseSB0aGUgY3VycmVudCBzZWFyY2ggdG8gdGhlbQ0KCQkJCXZhciBpbml0aWFsbHlIYXNNYXRjaGVzID0gY3VycmVudFNlYXJjaCA/IGN1cnJlbnRTZWFyY2guaGFzTWF0Y2hlcygpIDogZmFsc2U7DQoJCQkJZm9yICh2YXIgaSA9IDAsIGxlbiA9IGxvZ0l0ZW1zLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7DQoJCQkJCWlmICghbG9nSXRlbXNbaV0ucmVuZGVyZWQpIHsNCgkJCQkJCWxvZ0l0ZW1zW2ldLnJlbmRlcigpOw0KCQkJCQkJbG9nSXRlbXNbaV0uYXBwZW5kVG9Mb2coKTsNCgkJCQkJCWlmIChjdXJyZW50U2VhcmNoICYmIChsb2dJdGVtc1tpXSBpbnN0YW5jZW9mIExvZ0VudHJ5KSkgew0KCQkJCQkJCWN1cnJlbnRTZWFyY2guYXBwbHlUbyhsb2dJdGVtc1tpXSk7DQoJCQkJCQl9DQoJCQkJCX0NCgkJCQl9DQoJCQkJaWYgKGN1cnJlbnRTZWFyY2gpIHsNCgkJCQkJaWYgKHBydW5lZCkgew0KCQkJCQkJaWYgKGN1cnJlbnRTZWFyY2guaGFzVmlzaWJsZU1hdGNoZXMoKSkgew0KCQkJCQkJCWlmIChjdXJyZW50TWF0Y2hJbmRleCA9PT0gbnVsbCkgew0KCQkJCQkJCQlzZXRDdXJyZW50TWF0Y2hJbmRleCgwKTsNCgkJCQkJCQl9DQoJCQkJCQkJZGlzcGxheU1hdGNoZXMoKTsNCgkJCQkJCX0gZWxzZSB7DQoJCQkJCQkJZGlzcGxheU5vTWF0Y2hlcygpOw0KCQkJCQkJfQ0KCQkJCQl9IGVsc2UgaWYgKCFpbml0aWFsbHlIYXNNYXRjaGVzICYmIGN1cnJlbnRTZWFyY2guaGFzVmlzaWJsZU1hdGNoZXMoKSkgew0KCQkJCQkJc2V0Q3VycmVudE1hdGNoSW5kZXgoMCk7DQoJCQkJCQlkaXNwbGF5TWF0Y2hlcygpOw0KCQkJCQl9DQoJCQkJfQ0KCQkJCWlmIChzY3JvbGxUb0xhdGVzdCkgew0KCQkJCQlkb1Njcm9sbFRvTGF0ZXN0KCk7DQoJCQkJfQ0KCQkJCXVucmVuZGVyZWRMb2dJdGVtc0V4aXN0ID0gZmFsc2U7DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIHBydW5lTG9nRW50cmllcygpIHsNCgkJCQlpZiAoKG1heE1lc3NhZ2VzICE9PSBudWxsKSAmJiAobG9nRW50cmllc0FuZFNlcGFyYXRvcnMubGVuZ3RoID4gbWF4TWVzc2FnZXMpKSB7DQoJCQkJCXZhciBudW1iZXJUb0RlbGV0ZSA9IGxvZ0VudHJpZXNBbmRTZXBhcmF0b3JzLmxlbmd0aCAtIG1heE1lc3NhZ2VzOw0KCQkJCQl2YXIgcHJ1bmVkTG9nRW50cmllcyA9IGxvZ0VudHJpZXNBbmRTZXBhcmF0b3JzLnNsaWNlKDAsIG51bWJlclRvRGVsZXRlKTsNCgkJCQkJaWYgKGN1cnJlbnRTZWFyY2gpIHsNCgkJCQkJCWN1cnJlbnRTZWFyY2gucmVtb3ZlTWF0Y2hlcyhwcnVuZWRMb2dFbnRyaWVzKTsNCgkJCQkJfQ0KCQkJCQl2YXIgZ3JvdXA7DQoJCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgbnVtYmVyVG9EZWxldGU7IGkrKykgew0KCQkJCQkJZ3JvdXAgPSBsb2dFbnRyaWVzQW5kU2VwYXJhdG9yc1tpXS5ncm91cDsNCgkJCQkJCWFycmF5X3JlbW92ZShsb2dJdGVtcywgbG9nRW50cmllc0FuZFNlcGFyYXRvcnNbaV0pOw0KCQkJCQkJYXJyYXlfcmVtb3ZlKGxvZ0VudHJpZXMsIGxvZ0VudHJpZXNBbmRTZXBhcmF0b3JzW2ldKTsNCgkJCQkJCWxvZ0VudHJpZXNBbmRTZXBhcmF0b3JzW2ldLnJlbW92ZSh0cnVlLCB0cnVlKTsNCgkJCQkJCWlmIChncm91cC5jaGlsZHJlbi5sZW5ndGggPT09IDAgJiYgZ3JvdXAgIT09IGN1cnJlbnRHcm91cCAmJiBncm91cCAhPT0gcm9vdEdyb3VwKSB7DQoJCQkJCQkJYXJyYXlfcmVtb3ZlKGxvZ0l0ZW1zLCBncm91cCk7DQoJCQkJCQkJZ3JvdXAucmVtb3ZlKHRydWUsIHRydWUpOw0KCQkJCQkJfQ0KCQkJCQl9DQoJCQkJCWxvZ0VudHJpZXNBbmRTZXBhcmF0b3JzID0gYXJyYXlfcmVtb3ZlRnJvbVN0YXJ0KGxvZ0VudHJpZXNBbmRTZXBhcmF0b3JzLCBudW1iZXJUb0RlbGV0ZSk7DQoJCQkJCXJldHVybiB0cnVlOw0KCQkJCX0NCgkJCQlyZXR1cm4gZmFsc2U7DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIGdyb3VwKG5hbWUsIHN0YXJ0RXhwYW5kZWQpIHsNCgkJCQlpZiAobG9nZ2luZ0VuYWJsZWQpIHsNCgkJCQkJaW5pdGlhbGx5RXhwYW5kZWQgPSAodHlwZW9mIHN0YXJ0RXhwYW5kZWQgPT09ICJ1bmRlZmluZWQiKSA/IHRydWUgOiBCb29sZWFuKHN0YXJ0RXhwYW5kZWQpOw0KCQkJCQl2YXIgbmV3R3JvdXAgPSBuZXcgR3JvdXAobmFtZSwgZmFsc2UsIGluaXRpYWxseUV4cGFuZGVkKTsNCgkJCQkJY3VycmVudEdyb3VwLmFkZENoaWxkKG5ld0dyb3VwKTsNCgkJCQkJY3VycmVudEdyb3VwID0gbmV3R3JvdXA7DQoJCQkJCWxvZ0l0ZW1zLnB1c2gobmV3R3JvdXApOw0KCQkJCQlpZiAobG9hZGVkKSB7DQoJCQkJCQlpZiAobG9nUXVldWVkRXZlbnRzVGltZXIgIT09IG51bGwpIHsNCgkJCQkJCQljbGVhclRpbWVvdXQobG9nUXVldWVkRXZlbnRzVGltZXIpOw0KCQkJCQkJfQ0KCQkJCQkJbG9nUXVldWVkRXZlbnRzVGltZXIgPSBzZXRUaW1lb3V0KHJlbmRlclF1ZXVlZExvZ0l0ZW1zLCByZW5kZXJEZWxheSk7DQoJCQkJCQl1bnJlbmRlcmVkTG9nSXRlbXNFeGlzdCA9IHRydWU7DQoJCQkJCX0NCgkJCQl9DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIGdyb3VwRW5kKCkgew0KCQkJCWN1cnJlbnRHcm91cCA9IChjdXJyZW50R3JvdXAgPT09IHJvb3RHcm91cCkgPyByb290R3JvdXAgOiBjdXJyZW50R3JvdXAuZ3JvdXA7DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIG1haW5QYWdlUmVsb2FkZWQoKSB7DQoJCQkJY3VycmVudEdyb3VwID0gcm9vdEdyb3VwOw0KCQkJCXZhciBzZXBhcmF0b3IgPSBuZXcgU2VwYXJhdG9yKCk7DQoJCQkJbG9nRW50cmllc0FuZFNlcGFyYXRvcnMucHVzaChzZXBhcmF0b3IpOw0KCQkJCWxvZ0l0ZW1zLnB1c2goc2VwYXJhdG9yKTsNCgkJCQljdXJyZW50R3JvdXAuYWRkQ2hpbGQoc2VwYXJhdG9yKTsNCgkJCX0NCg0KCQkJZnVuY3Rpb24gY2xvc2VXaW5kb3coKSB7DQoJCQkJaWYgKGFwcGVuZGVyICYmIG1haW5XaW5kb3dFeGlzdHMoKSkgew0KCQkJCQlhcHBlbmRlci5jbG9zZSh0cnVlKTsNCgkJCQl9IGVsc2Ugew0KCQkJCQl3aW5kb3cuY2xvc2UoKTsNCgkJCQl9DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIGhpZGUoKSB7DQoJCQkJaWYgKGFwcGVuZGVyICYmIG1haW5XaW5kb3dFeGlzdHMoKSkgew0KCQkJCQlhcHBlbmRlci5oaWRlKCk7DQoJCQkJfQ0KCQkJfQ0KDQoJCQl2YXIgbWFpbldpbmRvdyA9IHdpbmRvdzsNCgkJCXZhciB3aW5kb3dJZCA9ICJsb2c0amF2YXNjcmlwdENvbnNvbGVXaW5kb3dfIiArIG5ldyBEYXRlKCkuZ2V0VGltZSgpICsgIl8iICsgKCIiICsgTWF0aC5yYW5kb20oKSkuc3Vic3RyKDIpOw0KDQoJCQlmdW5jdGlvbiBzZXRNYWluV2luZG93KHdpbikgew0KCQkJCW1haW5XaW5kb3cgPSB3aW47DQoJCQkJbWFpbldpbmRvd1t3aW5kb3dJZF0gPSB3aW5kb3c7DQoJCQkJLy8gSWYgdGhpcyBpcyBhIHBvcC11cCwgcG9sbCB0aGUgb3BlbmVyIHRvIHNlZSBpZiBpdCdzIGNsb3NlZA0KCQkJCWlmIChvcGVuZXIgJiYgY2xvc2VJZk9wZW5lckNsb3Nlcykgew0KCQkJCQlwb2xsT3BlbmVyKCk7DQoJCQkJfQ0KCQkJfQ0KDQoJCQlmdW5jdGlvbiBwb2xsT3BlbmVyKCkgew0KCQkJCWlmIChjbG9zZUlmT3BlbmVyQ2xvc2VzKSB7DQoJCQkJCWlmIChtYWluV2luZG93RXhpc3RzKCkpIHsNCgkJCQkJCXNldFRpbWVvdXQocG9sbE9wZW5lciwgNTAwKTsNCgkJCQkJfSBlbHNlIHsNCgkJCQkJCWNsb3NlV2luZG93KCk7DQoJCQkJCX0NCgkJCQl9DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIG1haW5XaW5kb3dFeGlzdHMoKSB7DQoJCQkJdHJ5IHsNCgkJCQkJcmV0dXJuIChtYWluV2luZG93ICYmICFtYWluV2luZG93LmNsb3NlZCAmJg0KCQkJCQkJbWFpbldpbmRvd1t3aW5kb3dJZF0gPT0gd2luZG93KTsNCgkJCQl9IGNhdGNoIChleCkge30NCgkJCQlyZXR1cm4gZmFsc2U7DQoJCQl9DQoNCgkJCXZhciBsb2dMZXZlbHMgPSBbIlRSQUNFIiwgIkRFQlVHIiwgIklORk8iLCAiV0FSTiIsICJFUlJPUiIsICJGQVRBTCJdOw0KDQoJCQlmdW5jdGlvbiBnZXRDaGVja0JveChsb2dMZXZlbCkgew0KCQkJCXJldHVybiAkKCJzd2l0Y2hfIiArIGxvZ0xldmVsKTsNCgkJCX0NCg0KCQkJZnVuY3Rpb24gZ2V0SWVXcmFwcGVkTG9nQ29udGFpbmVyKCkgew0KCQkJCXJldHVybiAkKCJsb2dfd3JhcHBlZCIpOw0KCQkJfQ0KDQoJCQlmdW5jdGlvbiBnZXRJZVVud3JhcHBlZExvZ0NvbnRhaW5lcigpIHsNCgkJCQlyZXR1cm4gJCgibG9nX3Vud3JhcHBlZCIpOw0KCQkJfQ0KDQoJCQlmdW5jdGlvbiBhcHBseUZpbHRlcnMoKSB7DQoJCQkJZm9yICh2YXIgaSA9IDA7IGkgPCBsb2dMZXZlbHMubGVuZ3RoOyBpKyspIHsNCgkJCQkJaWYgKGdldENoZWNrQm94KGxvZ0xldmVsc1tpXSkuY2hlY2tlZCkgew0KCQkJCQkJYWRkQ2xhc3MobG9nTWFpbkNvbnRhaW5lciwgbG9nTGV2ZWxzW2ldKTsNCgkJCQkJfSBlbHNlIHsNCgkJCQkJCXJlbW92ZUNsYXNzKGxvZ01haW5Db250YWluZXIsIGxvZ0xldmVsc1tpXSk7DQoJCQkJCX0NCgkJCQl9DQoJCQkJdXBkYXRlU2VhcmNoRnJvbUZpbHRlcnMoKTsNCgkJCX0NCg0KCQkJZnVuY3Rpb24gdG9nZ2xlQWxsTGV2ZWxzKCkgew0KCQkJCXZhciB0dXJuT24gPSAkKCJzd2l0Y2hfQUxMIikuY2hlY2tlZDsNCgkJCQlmb3IgKHZhciBpID0gMDsgaSA8IGxvZ0xldmVscy5sZW5ndGg7IGkrKykgew0KCQkJCQlnZXRDaGVja0JveChsb2dMZXZlbHNbaV0pLmNoZWNrZWQgPSB0dXJuT247DQoJCQkJCWlmICh0dXJuT24pIHsNCgkJCQkJCWFkZENsYXNzKGxvZ01haW5Db250YWluZXIsIGxvZ0xldmVsc1tpXSk7DQoJCQkJCX0gZWxzZSB7DQoJCQkJCQlyZW1vdmVDbGFzcyhsb2dNYWluQ29udGFpbmVyLCBsb2dMZXZlbHNbaV0pOw0KCQkJCQl9DQoJCQkJfQ0KCQkJfQ0KDQoJCQlmdW5jdGlvbiBjaGVja0FsbExldmVscygpIHsNCgkJCQlmb3IgKHZhciBpID0gMDsgaSA8IGxvZ0xldmVscy5sZW5ndGg7IGkrKykgew0KCQkJCQlpZiAoIWdldENoZWNrQm94KGxvZ0xldmVsc1tpXSkuY2hlY2tlZCkgew0KCQkJCQkJZ2V0Q2hlY2tCb3goIkFMTCIpLmNoZWNrZWQgPSBmYWxzZTsNCgkJCQkJCXJldHVybjsNCgkJCQkJfQ0KCQkJCX0NCgkJCQlnZXRDaGVja0JveCgiQUxMIikuY2hlY2tlZCA9IHRydWU7DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIGNsZWFyTG9nKCkgew0KCQkJCXJvb3RHcm91cC5jbGVhcigpOw0KCQkJCWN1cnJlbnRHcm91cCA9IHJvb3RHcm91cDsNCgkJCQlsb2dFbnRyaWVzID0gW107DQoJCQkJbG9nSXRlbXMgPSBbXTsNCgkJCQlsb2dFbnRyaWVzQW5kU2VwYXJhdG9ycyA9IFtdOw0KIAkJCQlkb1NlYXJjaCgpOw0KCQkJfQ0KDQoJCQlmdW5jdGlvbiB0b2dnbGVXcmFwKCkgew0KCQkJCXZhciBlbmFibGUgPSAkKCJ3cmFwIikuY2hlY2tlZDsNCgkJCQlpZiAoZW5hYmxlKSB7DQoJCQkJCWFkZENsYXNzKGxvZ01haW5Db250YWluZXIsICJ3cmFwIik7DQoJCQkJfSBlbHNlIHsNCgkJCQkJcmVtb3ZlQ2xhc3MobG9nTWFpbkNvbnRhaW5lciwgIndyYXAiKTsNCgkJCQl9DQoJCQkJcmVmcmVzaEN1cnJlbnRNYXRjaCgpOw0KCQkJfQ0KDQoJCQkvKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovDQoNCgkJCS8vIFNlYXJjaA0KDQoJCQl2YXIgc2VhcmNoVGltZXIgPSBudWxsOw0KDQoJCQlmdW5jdGlvbiBzY2hlZHVsZVNlYXJjaCgpIHsNCgkJCQl0cnkgew0KCQkJCQljbGVhclRpbWVvdXQoc2VhcmNoVGltZXIpOw0KCQkJCX0gY2F0Y2ggKGV4KSB7DQoJCQkJCS8vIERvIG5vdGhpbmcNCgkJCQl9DQoJCQkJc2VhcmNoVGltZXIgPSBzZXRUaW1lb3V0KGRvU2VhcmNoLCA1MDApOw0KCQkJfQ0KDQoJCQlmdW5jdGlvbiBTZWFyY2goc2VhcmNoVGVybSwgaXNSZWdleCwgc2VhcmNoUmVnZXgsIGlzQ2FzZVNlbnNpdGl2ZSkgew0KCQkJCXRoaXMuc2VhcmNoVGVybSA9IHNlYXJjaFRlcm07DQoJCQkJdGhpcy5pc1JlZ2V4ID0gaXNSZWdleDsNCgkJCQl0aGlzLnNlYXJjaFJlZ2V4ID0gc2VhcmNoUmVnZXg7DQoJCQkJdGhpcy5pc0Nhc2VTZW5zaXRpdmUgPSBpc0Nhc2VTZW5zaXRpdmU7DQoJCQkJdGhpcy5tYXRjaGVzID0gW107DQoJCQl9DQoNCgkJCVNlYXJjaC5wcm90b3R5cGUgPSB7DQoJCQkJaGFzTWF0Y2hlczogZnVuY3Rpb24oKSB7DQoJCQkJCXJldHVybiB0aGlzLm1hdGNoZXMubGVuZ3RoID4gMDsNCgkJCQl9LA0KDQoJCQkJaGFzVmlzaWJsZU1hdGNoZXM6IGZ1bmN0aW9uKCkgew0KCQkJCQlpZiAodGhpcy5oYXNNYXRjaGVzKCkpIHsNCgkJCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5tYXRjaGVzLmxlbmd0aDsgaSsrKSB7DQoJCQkJCQkJaWYgKHRoaXMubWF0Y2hlc1tpXS5pc1Zpc2libGUoKSkgew0KCQkJCQkJCQlyZXR1cm4gdHJ1ZTsNCgkJCQkJCQl9DQoJCQkJCQl9DQoJCQkJCX0NCgkJCQkJcmV0dXJuIGZhbHNlOw0KCQkJCX0sDQoNCgkJCQltYXRjaDogZnVuY3Rpb24obG9nRW50cnkpIHsNCgkJCQkJdmFyIGVudHJ5VGV4dCA9IFN0cmluZyhsb2dFbnRyeS5mb3JtYXR0ZWRNZXNzYWdlKTsNCgkJCQkJdmFyIG1hdGNoZXNTZWFyY2ggPSBmYWxzZTsNCgkJCQkJaWYgKHRoaXMuaXNSZWdleCkgew0KCQkJCQkJbWF0Y2hlc1NlYXJjaCA9IHRoaXMuc2VhcmNoUmVnZXgudGVzdChlbnRyeVRleHQpOw0KCQkJCQl9IGVsc2UgaWYgKHRoaXMuaXNDYXNlU2Vuc2l0aXZlKSB7DQoJCQkJCQltYXRjaGVzU2VhcmNoID0gKGVudHJ5VGV4dC5pbmRleE9mKHRoaXMuc2VhcmNoVGVybSkgPiAtMSk7DQoJCQkJCX0gZWxzZSB7DQoJCQkJCQltYXRjaGVzU2VhcmNoID0gKGVudHJ5VGV4dC50b0xvd2VyQ2FzZSgpLmluZGV4T2YodGhpcy5zZWFyY2hUZXJtLnRvTG93ZXJDYXNlKCkpID4gLTEpOw0KCQkJCQl9DQoJCQkJCXJldHVybiBtYXRjaGVzU2VhcmNoOw0KCQkJCX0sDQoNCgkJCQlnZXROZXh0VmlzaWJsZU1hdGNoSW5kZXg6IGZ1bmN0aW9uKCkgew0KCQkJCQlmb3IgKHZhciBpID0gY3VycmVudE1hdGNoSW5kZXggKyAxOyBpIDwgdGhpcy5tYXRjaGVzLmxlbmd0aDsgaSsrKSB7DQoJCQkJCQlpZiAodGhpcy5tYXRjaGVzW2ldLmlzVmlzaWJsZSgpKSB7DQoJCQkJCQkJcmV0dXJuIGk7DQoJCQkJCQl9DQoJCQkJCX0NCgkJCQkJLy8gU3RhcnQgYWdhaW4gZnJvbSB0aGUgZmlyc3QgbWF0Y2gNCgkJCQkJZm9yIChpID0gMDsgaSA8PSBjdXJyZW50TWF0Y2hJbmRleDsgaSsrKSB7DQoJCQkJCQlpZiAodGhpcy5tYXRjaGVzW2ldLmlzVmlzaWJsZSgpKSB7DQoJCQkJCQkJcmV0dXJuIGk7DQoJCQkJCQl9DQoJCQkJCX0NCgkJCQkJcmV0dXJuIC0xOw0KCQkJCX0sDQoNCgkJCQlnZXRQcmV2aW91c1Zpc2libGVNYXRjaEluZGV4OiBmdW5jdGlvbigpIHsNCgkJCQkJZm9yICh2YXIgaSA9IGN1cnJlbnRNYXRjaEluZGV4IC0gMTsgaSA+PSAwOyBpLS0pIHsNCgkJCQkJCWlmICh0aGlzLm1hdGNoZXNbaV0uaXNWaXNpYmxlKCkpIHsNCgkJCQkJCQlyZXR1cm4gaTsNCgkJCQkJCX0NCgkJCQkJfQ0KCQkJCQkvLyBTdGFydCBhZ2FpbiBmcm9tIHRoZSBsYXN0IG1hdGNoDQoJCQkJCWZvciAodmFyIGkgPSB0aGlzLm1hdGNoZXMubGVuZ3RoIC0gMTsgaSA+PSBjdXJyZW50TWF0Y2hJbmRleDsgaS0tKSB7DQoJCQkJCQlpZiAodGhpcy5tYXRjaGVzW2ldLmlzVmlzaWJsZSgpKSB7DQoJCQkJCQkJcmV0dXJuIGk7DQoJCQkJCQl9DQoJCQkJCX0NCgkJCQkJcmV0dXJuIC0xOw0KCQkJCX0sDQoNCgkJCQlhcHBseVRvOiBmdW5jdGlvbihsb2dFbnRyeSkgew0KCQkJCQl2YXIgZG9lc01hdGNoID0gdGhpcy5tYXRjaChsb2dFbnRyeSk7DQoJCQkJCWlmIChkb2VzTWF0Y2gpIHsNCgkJCQkJCWxvZ0VudHJ5Lmdyb3VwLmV4cGFuZCgpOw0KCQkJCQkJbG9nRW50cnkuc2V0U2VhcmNoTWF0Y2godHJ1ZSk7DQoJCQkJCQl2YXIgbG9nRW50cnlDb250ZW50Ow0KCQkJCQkJdmFyIHdyYXBwZWRMb2dFbnRyeUNvbnRlbnQ7DQoJCQkJCQl2YXIgc2VhcmNoVGVybVJlcGxhY2VtZW50U3RhcnRUYWcgPSAiPHNwYW4gY2xhc3M9XCJzZWFyY2h0ZXJtXCI+IjsNCgkJCQkJCXZhciBzZWFyY2hUZXJtUmVwbGFjZW1lbnRFbmRUYWcgPSAiPCIgKyAiL3NwYW4+IjsNCgkJCQkJCXZhciBwcmVUYWdOYW1lID0gaXNJZSA/ICJwcmUiIDogInNwYW4iOw0KCQkJCQkJdmFyIHByZVN0YXJ0VGFnID0gIjwiICsgcHJlVGFnTmFtZSArICIgY2xhc3M9XCJwcmVcIj4iOw0KCQkJCQkJdmFyIHByZUVuZFRhZyA9ICI8IiArICIvIiArIHByZVRhZ05hbWUgKyAiPiI7DQoJCQkJCQl2YXIgc3RhcnRJbmRleCA9IDA7DQoJCQkJCQl2YXIgc2VhcmNoSW5kZXgsIG1hdGNoZWRUZXh0LCB0ZXh0QmVmb3JlTWF0Y2g7DQoJCQkJCQlpZiAodGhpcy5pc1JlZ2V4KSB7DQoJCQkJCQkJdmFyIGZsYWdzID0gdGhpcy5pc0Nhc2VTZW5zaXRpdmUgPyAiZyIgOiAiZ2kiOw0KCQkJCQkJCXZhciBjYXB0dXJpbmdSZWdleCA9IG5ldyBSZWdFeHAoIigiICsgdGhpcy5zZWFyY2hSZWdleC5zb3VyY2UgKyAiKSIsIGZsYWdzKTsNCg0KCQkJCQkJCS8vIFJlcGxhY2UgdGhlIHNlYXJjaCB0ZXJtIHdpdGggdGVtcG9yYXJ5IHRva2VucyBmb3IgdGhlIHN0YXJ0IGFuZCBlbmQgdGFncw0KCQkJCQkJCXZhciBybmQgPSAoIiIgKyBNYXRoLnJhbmRvbSgpKS5zdWJzdHIoMik7DQoJCQkJCQkJdmFyIHN0YXJ0VG9rZW4gPSAiJSVzIiArIHJuZCArICIlJSI7DQoJCQkJCQkJdmFyIGVuZFRva2VuID0gIiUlZSIgKyBybmQgKyAiJSUiOw0KCQkJCQkJCWxvZ0VudHJ5Q29udGVudCA9IGxvZ0VudHJ5LmZvcm1hdHRlZE1lc3NhZ2UucmVwbGFjZShjYXB0dXJpbmdSZWdleCwgc3RhcnRUb2tlbiArICIkMSIgKyBlbmRUb2tlbik7DQoNCgkJCQkJCQkvLyBFc2NhcGUgdGhlIEhUTUwgdG8gZ2V0IHJpZCBvZiBhbmdsZSBicmFja2V0cw0KCQkJCQkJCWxvZ0VudHJ5Q29udGVudCA9IGVzY2FwZUh0bWwobG9nRW50cnlDb250ZW50KTsNCg0KCQkJCQkJCS8vIFN1YnN0aXR1dGUgdGhlIHByb3BlciBIVE1MIGJhY2sgaW4gZm9yIHRoZSBzZWFyY2ggbWF0Y2gNCgkJCQkJCQl2YXIgcmVzdWx0Ow0KCQkJCQkJCXZhciBzZWFyY2hTdHJpbmcgPSBsb2dFbnRyeUNvbnRlbnQ7DQoJCQkJCQkJbG9nRW50cnlDb250ZW50ID0gIiI7DQoJCQkJCQkJd3JhcHBlZExvZ0VudHJ5Q29udGVudCA9ICIiOw0KCQkJCQkJCXdoaWxlICgoc2VhcmNoSW5kZXggPSBzZWFyY2hTdHJpbmcuaW5kZXhPZihzdGFydFRva2VuLCBzdGFydEluZGV4KSkgPiAtMSkgew0KCQkJCQkJCQl2YXIgZW5kVG9rZW5JbmRleCA9IHNlYXJjaFN0cmluZy5pbmRleE9mKGVuZFRva2VuLCBzZWFyY2hJbmRleCk7DQoJCQkJCQkJCW1hdGNoZWRUZXh0ID0gc2VhcmNoU3RyaW5nLnN1YnN0cmluZyhzZWFyY2hJbmRleCArIHN0YXJ0VG9rZW4ubGVuZ3RoLCBlbmRUb2tlbkluZGV4KTsNCgkJCQkJCQkJdGV4dEJlZm9yZU1hdGNoID0gc2VhcmNoU3RyaW5nLnN1YnN0cmluZyhzdGFydEluZGV4LCBzZWFyY2hJbmRleCk7DQoJCQkJCQkJCWxvZ0VudHJ5Q29udGVudCArPSBwcmVTdGFydFRhZyArIHRleHRCZWZvcmVNYXRjaCArIHByZUVuZFRhZzsNCgkJCQkJCQkJbG9nRW50cnlDb250ZW50ICs9IHNlYXJjaFRlcm1SZXBsYWNlbWVudFN0YXJ0VGFnICsgcHJlU3RhcnRUYWcgKyBtYXRjaGVkVGV4dCArDQoJCQkJCQkJCQlwcmVFbmRUYWcgKyBzZWFyY2hUZXJtUmVwbGFjZW1lbnRFbmRUYWc7DQoJCQkJCQkJCWlmIChpc0llKSB7DQoJCQkJCQkJCQl3cmFwcGVkTG9nRW50cnlDb250ZW50ICs9IHRleHRCZWZvcmVNYXRjaCArIHNlYXJjaFRlcm1SZXBsYWNlbWVudFN0YXJ0VGFnICsNCgkJCQkJCQkJCQltYXRjaGVkVGV4dCArIHNlYXJjaFRlcm1SZXBsYWNlbWVudEVuZFRhZzsNCgkJCQkJCQkJfQ0KCQkJCQkJCQlzdGFydEluZGV4ID0gZW5kVG9rZW5JbmRleCArIGVuZFRva2VuLmxlbmd0aDsNCgkJCQkJCQl9DQoJCQkJCQkJbG9nRW50cnlDb250ZW50ICs9IHByZVN0YXJ0VGFnICsgc2VhcmNoU3RyaW5nLnN1YnN0cihzdGFydEluZGV4KSArIHByZUVuZFRhZzsNCgkJCQkJCQlpZiAoaXNJZSkgew0KCQkJCQkJCQl3cmFwcGVkTG9nRW50cnlDb250ZW50ICs9IHNlYXJjaFN0cmluZy5zdWJzdHIoc3RhcnRJbmRleCk7DQoJCQkJCQkJfQ0KCQkJCQkJfSBlbHNlIHsNCgkJCQkJCQlsb2dFbnRyeUNvbnRlbnQgPSAiIjsNCgkJCQkJCQl3cmFwcGVkTG9nRW50cnlDb250ZW50ID0gIiI7DQoJCQkJCQkJdmFyIHNlYXJjaFRlcm1SZXBsYWNlbWVudExlbmd0aCA9IHNlYXJjaFRlcm1SZXBsYWNlbWVudFN0YXJ0VGFnLmxlbmd0aCArDQoJCQkJCQkJCXRoaXMuc2VhcmNoVGVybS5sZW5ndGggKyBzZWFyY2hUZXJtUmVwbGFjZW1lbnRFbmRUYWcubGVuZ3RoOw0KCQkJCQkJCXZhciBzZWFyY2hUZXJtTGVuZ3RoID0gdGhpcy5zZWFyY2hUZXJtLmxlbmd0aDsNCgkJCQkJCQl2YXIgc2VhcmNoVGVybUxvd2VyQ2FzZSA9IHRoaXMuc2VhcmNoVGVybS50b0xvd2VyQ2FzZSgpOw0KCQkJCQkJCXZhciBsb2dUZXh0TG93ZXJDYXNlID0gbG9nRW50cnkuZm9ybWF0dGVkTWVzc2FnZS50b0xvd2VyQ2FzZSgpOw0KCQkJCQkJCXdoaWxlICgoc2VhcmNoSW5kZXggPSBsb2dUZXh0TG93ZXJDYXNlLmluZGV4T2Yoc2VhcmNoVGVybUxvd2VyQ2FzZSwgc3RhcnRJbmRleCkpID4gLTEpIHsNCgkJCQkJCQkJbWF0Y2hlZFRleHQgPSBlc2NhcGVIdG1sKGxvZ0VudHJ5LmZvcm1hdHRlZE1lc3NhZ2Uuc3Vic3RyKHNlYXJjaEluZGV4LCB0aGlzLnNlYXJjaFRlcm0ubGVuZ3RoKSk7DQoJCQkJCQkJCXRleHRCZWZvcmVNYXRjaCA9IGVzY2FwZUh0bWwobG9nRW50cnkuZm9ybWF0dGVkTWVzc2FnZS5zdWJzdHJpbmcoc3RhcnRJbmRleCwgc2VhcmNoSW5kZXgpKTsNCgkJCQkJCQkJdmFyIHNlYXJjaFRlcm1SZXBsYWNlbWVudCA9IHNlYXJjaFRlcm1SZXBsYWNlbWVudFN0YXJ0VGFnICsNCgkJCQkJCQkJCXByZVN0YXJ0VGFnICsgbWF0Y2hlZFRleHQgKyBwcmVFbmRUYWcgKyBzZWFyY2hUZXJtUmVwbGFjZW1lbnRFbmRUYWc7DQoJCQkJCQkJCWxvZ0VudHJ5Q29udGVudCArPSBwcmVTdGFydFRhZyArIHRleHRCZWZvcmVNYXRjaCArIHByZUVuZFRhZyArIHNlYXJjaFRlcm1SZXBsYWNlbWVudDsNCgkJCQkJCQkJaWYgKGlzSWUpIHsNCgkJCQkJCQkJCXdyYXBwZWRMb2dFbnRyeUNvbnRlbnQgKz0gdGV4dEJlZm9yZU1hdGNoICsgc2VhcmNoVGVybVJlcGxhY2VtZW50U3RhcnRUYWcgKw0KCQkJCQkJCQkJCW1hdGNoZWRUZXh0ICsgc2VhcmNoVGVybVJlcGxhY2VtZW50RW5kVGFnOw0KCQkJCQkJCQl9DQoJCQkJCQkJCXN0YXJ0SW5kZXggPSBzZWFyY2hJbmRleCArIHNlYXJjaFRlcm1MZW5ndGg7DQoJCQkJCQkJfQ0KCQkJCQkJCXZhciB0ZXh0QWZ0ZXJMYXN0TWF0Y2ggPSBlc2NhcGVIdG1sKGxvZ0VudHJ5LmZvcm1hdHRlZE1lc3NhZ2Uuc3Vic3RyKHN0YXJ0SW5kZXgpKTsNCgkJCQkJCQlsb2dFbnRyeUNvbnRlbnQgKz0gcHJlU3RhcnRUYWcgKyB0ZXh0QWZ0ZXJMYXN0TWF0Y2ggKyBwcmVFbmRUYWc7DQoJCQkJCQkJaWYgKGlzSWUpIHsNCgkJCQkJCQkJd3JhcHBlZExvZ0VudHJ5Q29udGVudCArPSB0ZXh0QWZ0ZXJMYXN0TWF0Y2g7DQoJCQkJCQkJfQ0KCQkJCQkJfQ0KCQkJCQkJbG9nRW50cnkuc2V0Q29udGVudChsb2dFbnRyeUNvbnRlbnQsIHdyYXBwZWRMb2dFbnRyeUNvbnRlbnQpOw0KCQkJCQkJdmFyIGxvZ0VudHJ5TWF0Y2hlcyA9IGxvZ0VudHJ5LmdldFNlYXJjaE1hdGNoZXMoKTsNCgkJCQkJCXRoaXMubWF0Y2hlcyA9IHRoaXMubWF0Y2hlcy5jb25jYXQobG9nRW50cnlNYXRjaGVzKTsNCgkJCQkJfSBlbHNlIHsNCgkJCQkJCWxvZ0VudHJ5LnNldFNlYXJjaE1hdGNoKGZhbHNlKTsNCgkJCQkJCWxvZ0VudHJ5LnNldENvbnRlbnQobG9nRW50cnkuZm9ybWF0dGVkTWVzc2FnZSwgbG9nRW50cnkuZm9ybWF0dGVkTWVzc2FnZSk7DQoJCQkJCX0NCgkJCQkJcmV0dXJuIGRvZXNNYXRjaDsNCgkJCQl9LA0KDQoJCQkJcmVtb3ZlTWF0Y2hlczogZnVuY3Rpb24obG9nRW50cmllcykgew0KCQkJCQl2YXIgbWF0Y2hlc1RvUmVtb3ZlQ291bnQgPSAwOw0KCQkJCQl2YXIgY3VycmVudE1hdGNoUmVtb3ZlZCA9IGZhbHNlOw0KCQkJCQl2YXIgbWF0Y2hlc1RvUmVtb3ZlID0gW107DQoJCQkJCXZhciBpLCBpTGVuLCBqLCBqTGVuOw0KDQoJCQkJCS8vIEVzdGFibGlzaCB0aGUgbGlzdCBvZiBtYXRjaGVzIHRvIGJlIHJlbW92ZWQNCgkJCQkJZm9yIChpID0gMCwgaUxlbiA9IHRoaXMubWF0Y2hlcy5sZW5ndGg7IGkgPCBpTGVuOyBpKyspIHsNCgkJCQkJCWZvciAoaiA9IDAsIGpMZW4gPSBsb2dFbnRyaWVzLmxlbmd0aDsgaiA8IGpMZW47IGorKykgew0KCQkJCQkJCWlmICh0aGlzLm1hdGNoZXNbaV0uYmVsb25nc1RvKGxvZ0VudHJpZXNbal0pKSB7DQoJCQkJCQkJCW1hdGNoZXNUb1JlbW92ZS5wdXNoKHRoaXMubWF0Y2hlc1tpXSk7DQoJCQkJCQkJCWlmIChpID09PSBjdXJyZW50TWF0Y2hJbmRleCkgew0KCQkJCQkJCQkJY3VycmVudE1hdGNoUmVtb3ZlZCA9IHRydWU7DQoJCQkJCQkJCX0NCgkJCQkJCQl9DQoJCQkJCQl9DQoJCQkJCX0NCg0KCQkJCQkvLyBTZXQgdGhlIG5ldyBjdXJyZW50IG1hdGNoIGluZGV4IGlmIHRoZSBjdXJyZW50IG1hdGNoIGhhcyBiZWVuIGRlbGV0ZWQNCgkJCQkJLy8gVGhpcyB3aWxsIGJlIHRoZSBmaXJzdCBtYXRjaCB0aGF0IGFwcGVhcnMgYWZ0ZXIgdGhlIGZpcnN0IGxvZyBlbnRyeSBiZWluZw0KCQkJCQkvLyBkZWxldGVkLCBpZiBvbmUgZXhpc3RzOyBvdGhlcndpc2UsIGl0J3MgdGhlIGZpcnN0IG1hdGNoIG92ZXJhbGwNCgkJCQkJdmFyIG5ld01hdGNoID0gY3VycmVudE1hdGNoUmVtb3ZlZCA/IG51bGwgOiB0aGlzLm1hdGNoZXNbY3VycmVudE1hdGNoSW5kZXhdOw0KCQkJCQlpZiAoY3VycmVudE1hdGNoUmVtb3ZlZCkgew0KCQkJCQkJZm9yIChpID0gY3VycmVudE1hdGNoSW5kZXgsIGlMZW4gPSB0aGlzLm1hdGNoZXMubGVuZ3RoOyBpIDwgaUxlbjsgaSsrKSB7DQoJCQkJCQkJaWYgKHRoaXMubWF0Y2hlc1tpXS5pc1Zpc2libGUoKSAmJiAhYXJyYXlfY29udGFpbnMobWF0Y2hlc1RvUmVtb3ZlLCB0aGlzLm1hdGNoZXNbaV0pKSB7DQoJCQkJCQkJCW5ld01hdGNoID0gdGhpcy5tYXRjaGVzW2ldOw0KCQkJCQkJCQlicmVhazsNCgkJCQkJCQl9DQoJCQkJCQl9DQoJCQkJCX0NCg0KCQkJCQkvLyBSZW1vdmUgdGhlIG1hdGNoZXMNCgkJCQkJZm9yIChpID0gMCwgaUxlbiA9IG1hdGNoZXNUb1JlbW92ZS5sZW5ndGg7IGkgPCBpTGVuOyBpKyspIHsNCgkJCQkJCWFycmF5X3JlbW92ZSh0aGlzLm1hdGNoZXMsIG1hdGNoZXNUb1JlbW92ZVtpXSk7DQoJCQkJCQltYXRjaGVzVG9SZW1vdmVbaV0ucmVtb3ZlKCk7DQoJCQkJCX0NCg0KCQkJCQkvLyBTZXQgdGhlIG5ldyBtYXRjaCwgaWYgb25lIGV4aXN0cw0KCQkJCQlpZiAodGhpcy5oYXNWaXNpYmxlTWF0Y2hlcygpKSB7DQoJCQkJCQlpZiAobmV3TWF0Y2ggPT09IG51bGwpIHsNCgkJCQkJCQlzZXRDdXJyZW50TWF0Y2hJbmRleCgwKTsNCgkJCQkJCX0gZWxzZSB7DQoJCQkJCQkJLy8gR2V0IHRoZSBpbmRleCBvZiB0aGUgbmV3IG1hdGNoDQoJCQkJCQkJdmFyIG5ld01hdGNoSW5kZXggPSAwOw0KCQkJCQkJCWZvciAoaSA9IDAsIGlMZW4gPSB0aGlzLm1hdGNoZXMubGVuZ3RoOyBpIDwgaUxlbjsgaSsrKSB7DQoJCQkJCQkJCWlmIChuZXdNYXRjaCA9PT0gdGhpcy5tYXRjaGVzW2ldKSB7DQoJCQkJCQkJCQluZXdNYXRjaEluZGV4ID0gaTsNCgkJCQkJCQkJCWJyZWFrOw0KCQkJCQkJCQl9DQoJCQkJCQkJfQ0KCQkJCQkJCXNldEN1cnJlbnRNYXRjaEluZGV4KG5ld01hdGNoSW5kZXgpOw0KCQkJCQkJfQ0KCQkJCQl9IGVsc2Ugew0KCQkJCQkJY3VycmVudE1hdGNoSW5kZXggPSBudWxsOw0KCQkJCQkJZGlzcGxheU5vTWF0Y2hlcygpOw0KCQkJCQl9DQoJCQkJfQ0KCQkJfTsNCg0KCQkJZnVuY3Rpb24gZ2V0UGFnZU9mZnNldFRvcChlbCwgY29udGFpbmVyKSB7DQoJCQkJdmFyIGN1cnJlbnRFbCA9IGVsOw0KCQkJCXZhciB5ID0gMDsNCgkJCQl3aGlsZSAoY3VycmVudEVsICYmIGN1cnJlbnRFbCAhPSBjb250YWluZXIpIHsNCgkJCQkJeSArPSBjdXJyZW50RWwub2Zmc2V0VG9wOw0KCQkJCQljdXJyZW50RWwgPSBjdXJyZW50RWwub2Zmc2V0UGFyZW50Ow0KCQkJCX0NCgkJCQlyZXR1cm4geTsNCgkJCX0NCg0KCQkJZnVuY3Rpb24gc2Nyb2xsSW50b1ZpZXcoZWwpIHsNCgkJCQl2YXIgbG9nQ29udGFpbmVyID0gbG9nTWFpbkNvbnRhaW5lcjsNCgkJCQkvLyBDaGVjayBpZiB0aGUgd2hvbGUgd2lkdGggb2YgdGhlIGVsZW1lbnQgaXMgdmlzaWJsZSBhbmQgY2VudHJlIGlmIG5vdA0KCQkJCWlmICghJCgid3JhcCIpLmNoZWNrZWQpIHsNCgkJCQkJdmFyIGxvZ0NvbnRhaW5lckxlZnQgPSBsb2dDb250YWluZXIuc2Nyb2xsTGVmdDsNCgkJCQkJdmFyIGxvZ0NvbnRhaW5lclJpZ2h0ID0gbG9nQ29udGFpbmVyTGVmdCAgKyBsb2dDb250YWluZXIub2Zmc2V0V2lkdGg7DQoJCQkJCXZhciBlbExlZnQgPSBlbC5vZmZzZXRMZWZ0Ow0KCQkJCQl2YXIgZWxSaWdodCA9IGVsTGVmdCArIGVsLm9mZnNldFdpZHRoOw0KCQkJCQlpZiAoZWxMZWZ0IDwgbG9nQ29udGFpbmVyTGVmdCB8fCBlbFJpZ2h0ID4gbG9nQ29udGFpbmVyUmlnaHQpIHsNCgkJCQkJCWxvZ0NvbnRhaW5lci5zY3JvbGxMZWZ0ID0gZWxMZWZ0IC0gKGxvZ0NvbnRhaW5lci5vZmZzZXRXaWR0aCAtIGVsLm9mZnNldFdpZHRoKSAvIDI7DQoJCQkJCX0NCgkJCQl9DQoJCQkJLy8gQ2hlY2sgaWYgdGhlIHdob2xlIGhlaWdodCBvZiB0aGUgZWxlbWVudCBpcyB2aXNpYmxlIGFuZCBjZW50cmUgaWYgbm90DQoJCQkJdmFyIGxvZ0NvbnRhaW5lclRvcCA9IGxvZ0NvbnRhaW5lci5zY3JvbGxUb3A7DQoJCQkJdmFyIGxvZ0NvbnRhaW5lckJvdHRvbSA9IGxvZ0NvbnRhaW5lclRvcCAgKyBsb2dDb250YWluZXIub2Zmc2V0SGVpZ2h0Ow0KCQkJCXZhciBlbFRvcCA9IGdldFBhZ2VPZmZzZXRUb3AoZWwpIC0gZ2V0VG9vbEJhcnNIZWlnaHQoKTsNCgkJCQl2YXIgZWxCb3R0b20gPSBlbFRvcCArIGVsLm9mZnNldEhlaWdodDsNCgkJCQlpZiAoZWxUb3AgPCBsb2dDb250YWluZXJUb3AgfHwgZWxCb3R0b20gPiBsb2dDb250YWluZXJCb3R0b20pIHsNCgkJCQkJbG9nQ29udGFpbmVyLnNjcm9sbFRvcCA9IGVsVG9wIC0gKGxvZ0NvbnRhaW5lci5vZmZzZXRIZWlnaHQgLSBlbC5vZmZzZXRIZWlnaHQpIC8gMjsNCgkJCQl9DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIE1hdGNoKGxvZ0VudHJ5TGV2ZWwsIHNwYW5Jbk1haW5EaXYsIHNwYW5JblVud3JhcHBlZFByZSwgc3BhbkluV3JhcHBlZERpdikgew0KCQkJCXRoaXMubG9nRW50cnlMZXZlbCA9IGxvZ0VudHJ5TGV2ZWw7DQoJCQkJdGhpcy5zcGFuSW5NYWluRGl2ID0gc3BhbkluTWFpbkRpdjsNCgkJCQlpZiAoaXNJZSkgew0KCQkJCQl0aGlzLnNwYW5JblVud3JhcHBlZFByZSA9IHNwYW5JblVud3JhcHBlZFByZTsNCgkJCQkJdGhpcy5zcGFuSW5XcmFwcGVkRGl2ID0gc3BhbkluV3JhcHBlZERpdjsNCgkJCQl9DQoJCQkJdGhpcy5tYWluU3BhbiA9IGlzSWUgPyBzcGFuSW5VbndyYXBwZWRQcmUgOiBzcGFuSW5NYWluRGl2Ow0KCQkJfQ0KDQoJCQlNYXRjaC5wcm90b3R5cGUgPSB7DQoJCQkJZXF1YWxzOiBmdW5jdGlvbihtYXRjaCkgew0KCQkJCQlyZXR1cm4gdGhpcy5tYWluU3BhbiA9PT0gbWF0Y2gubWFpblNwYW47DQoJCQkJfSwNCg0KCQkJCXNldEN1cnJlbnQ6IGZ1bmN0aW9uKCkgew0KCQkJCQlpZiAoaXNJZSkgew0KCQkJCQkJYWRkQ2xhc3ModGhpcy5zcGFuSW5VbndyYXBwZWRQcmUsICJjdXJyZW50bWF0Y2giKTsNCgkJCQkJCWFkZENsYXNzKHRoaXMuc3BhbkluV3JhcHBlZERpdiwgImN1cnJlbnRtYXRjaCIpOw0KCQkJCQkJLy8gU2Nyb2xsIHRoZSB2aXNpYmxlIG9uZSBpbnRvIHZpZXcNCgkJCQkJCXZhciBlbGVtZW50VG9TY3JvbGwgPSAkKCJ3cmFwIikuY2hlY2tlZCA/IHRoaXMuc3BhbkluV3JhcHBlZERpdiA6IHRoaXMuc3BhbkluVW53cmFwcGVkUHJlOw0KCQkJCQkJc2Nyb2xsSW50b1ZpZXcoZWxlbWVudFRvU2Nyb2xsKTsNCgkJCQkJfSBlbHNlIHsNCgkJCQkJCWFkZENsYXNzKHRoaXMuc3BhbkluTWFpbkRpdiwgImN1cnJlbnRtYXRjaCIpOw0KCQkJCQkJc2Nyb2xsSW50b1ZpZXcodGhpcy5zcGFuSW5NYWluRGl2KTsNCgkJCQkJfQ0KCQkJCX0sDQoNCgkJCQliZWxvbmdzVG86IGZ1bmN0aW9uKGxvZ0VudHJ5KSB7DQoJCQkJCWlmIChpc0llKSB7DQoJCQkJCQlyZXR1cm4gaXNEZXNjZW5kYW50KHRoaXMuc3BhbkluVW53cmFwcGVkUHJlLCBsb2dFbnRyeS51bndyYXBwZWRQcmUpOw0KCQkJCQl9IGVsc2Ugew0KCQkJCQkJcmV0dXJuIGlzRGVzY2VuZGFudCh0aGlzLnNwYW5Jbk1haW5EaXYsIGxvZ0VudHJ5Lm1haW5EaXYpOw0KCQkJCQl9DQoJCQkJfSwNCg0KCQkJCXNldE5vdEN1cnJlbnQ6IGZ1bmN0aW9uKCkgew0KCQkJCQlpZiAoaXNJZSkgew0KCQkJCQkJcmVtb3ZlQ2xhc3ModGhpcy5zcGFuSW5VbndyYXBwZWRQcmUsICJjdXJyZW50bWF0Y2giKTsNCgkJCQkJCXJlbW92ZUNsYXNzKHRoaXMuc3BhbkluV3JhcHBlZERpdiwgImN1cnJlbnRtYXRjaCIpOw0KCQkJCQl9IGVsc2Ugew0KCQkJCQkJcmVtb3ZlQ2xhc3ModGhpcy5zcGFuSW5NYWluRGl2LCAiY3VycmVudG1hdGNoIik7DQoJCQkJCX0NCgkJCQl9LA0KDQoJCQkJaXNPcnBoYW46IGZ1bmN0aW9uKCkgew0KCQkJCQlyZXR1cm4gaXNPcnBoYW4odGhpcy5tYWluU3Bhbik7DQoJCQkJfSwNCg0KCQkJCWlzVmlzaWJsZTogZnVuY3Rpb24oKSB7DQoJCQkJCXJldHVybiBnZXRDaGVja0JveCh0aGlzLmxvZ0VudHJ5TGV2ZWwpLmNoZWNrZWQ7DQoJCQkJfSwNCg0KCQkJCXJlbW92ZTogZnVuY3Rpb24oKSB7DQoJCQkJCWlmIChpc0llKSB7DQoJCQkJCQl0aGlzLnNwYW5JblVud3JhcHBlZFByZSA9IG51bGw7DQoJCQkJCQl0aGlzLnNwYW5JbldyYXBwZWREaXYgPSBudWxsOw0KCQkJCQl9IGVsc2Ugew0KCQkJCQkJdGhpcy5zcGFuSW5NYWluRGl2ID0gbnVsbDsNCgkJCQkJfQ0KCQkJCX0NCgkJCX07DQoNCgkJCXZhciBjdXJyZW50U2VhcmNoID0gbnVsbDsNCgkJCXZhciBjdXJyZW50TWF0Y2hJbmRleCA9IG51bGw7DQoNCgkJCWZ1bmN0aW9uIGRvU2VhcmNoKCkgew0KCQkJCXZhciBzZWFyY2hCb3ggPSAkKCJzZWFyY2hCb3giKTsNCgkJCQl2YXIgc2VhcmNoVGVybSA9IHNlYXJjaEJveC52YWx1ZTsNCgkJCQl2YXIgaXNSZWdleCA9ICQoInNlYXJjaFJlZ2V4IikuY2hlY2tlZDsNCgkJCQl2YXIgaXNDYXNlU2Vuc2l0aXZlID0gJCgic2VhcmNoQ2FzZVNlbnNpdGl2ZSIpLmNoZWNrZWQ7DQoJCQkJdmFyIGk7DQoNCgkJCQlpZiAoc2VhcmNoVGVybSA9PT0gIiIpIHsNCgkJCQkJJCgic2VhcmNoUmVzZXQiKS5kaXNhYmxlZCA9IHRydWU7DQoJCQkJCSQoInNlYXJjaE5hdiIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQoJCQkJCXJlbW92ZUNsYXNzKGRvY3VtZW50LmJvZHksICJzZWFyY2hpbmciKTsNCgkJCQkJcmVtb3ZlQ2xhc3Moc2VhcmNoQm94LCAiaGFzbWF0Y2hlcyIpOw0KCQkJCQlyZW1vdmVDbGFzcyhzZWFyY2hCb3gsICJub21hdGNoZXMiKTsNCgkJCQkJZm9yIChpID0gMDsgaSA8IGxvZ0VudHJpZXMubGVuZ3RoOyBpKyspIHsNCgkJCQkJCWxvZ0VudHJpZXNbaV0uY2xlYXJTZWFyY2goKTsNCgkJCQkJCWxvZ0VudHJpZXNbaV0uc2V0Q29udGVudChsb2dFbnRyaWVzW2ldLmZvcm1hdHRlZE1lc3NhZ2UsIGxvZ0VudHJpZXNbaV0uZm9ybWF0dGVkTWVzc2FnZSk7DQoJCQkJCX0NCgkJCQkJY3VycmVudFNlYXJjaCA9IG51bGw7DQoJCQkJCXNldExvZ0NvbnRhaW5lckhlaWdodCgpOw0KCQkJCX0gZWxzZSB7DQoJCQkJCSQoInNlYXJjaFJlc2V0IikuZGlzYWJsZWQgPSBmYWxzZTsNCgkJCQkJJCgic2VhcmNoTmF2Iikuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7DQoJCQkJCXZhciBzZWFyY2hSZWdleDsNCgkJCQkJdmFyIHJlZ2V4VmFsaWQ7DQoJCQkJCWlmIChpc1JlZ2V4KSB7DQoJCQkJCQl0cnkgew0KCQkJCQkJCXNlYXJjaFJlZ2V4ID0gaXNDYXNlU2Vuc2l0aXZlID8gbmV3IFJlZ0V4cChzZWFyY2hUZXJtLCAiZyIpIDogbmV3IFJlZ0V4cChzZWFyY2hUZXJtLCAiZ2kiKTsNCgkJCQkJCQlyZWdleFZhbGlkID0gdHJ1ZTsNCgkJCQkJCQlyZXBsYWNlQ2xhc3Moc2VhcmNoQm94LCAidmFsaWRyZWdleCIsICJpbnZhbGlkcmVnZXgiKTsNCgkJCQkJCQlzZWFyY2hCb3gudGl0bGUgPSAiVmFsaWQgcmVnZXgiOw0KCQkJCQkJfSBjYXRjaCAoZXgpIHsNCgkJCQkJCQlyZWdleFZhbGlkID0gZmFsc2U7DQoJCQkJCQkJcmVwbGFjZUNsYXNzKHNlYXJjaEJveCwgImludmFsaWRyZWdleCIsICJ2YWxpZHJlZ2V4Iik7DQoJCQkJCQkJc2VhcmNoQm94LnRpdGxlID0gIkludmFsaWQgcmVnZXg6ICIgKyAoZXgubWVzc2FnZSA/IGV4Lm1lc3NhZ2UgOiAoZXguZGVzY3JpcHRpb24gPyBleC5kZXNjcmlwdGlvbiA6ICJ1bmtub3duIGVycm9yIikpOw0KCQkJCQkJCXJldHVybjsNCgkJCQkJCX0NCgkJCQkJfSBlbHNlIHsNCgkJCQkJCXNlYXJjaEJveC50aXRsZSA9ICIiOw0KCQkJCQkJcmVtb3ZlQ2xhc3Moc2VhcmNoQm94LCAidmFsaWRyZWdleCIpOw0KCQkJCQkJcmVtb3ZlQ2xhc3Moc2VhcmNoQm94LCAiaW52YWxpZHJlZ2V4Iik7DQoJCQkJCX0NCgkJCQkJYWRkQ2xhc3MoZG9jdW1lbnQuYm9keSwgInNlYXJjaGluZyIpOw0KCQkJCQljdXJyZW50U2VhcmNoID0gbmV3IFNlYXJjaChzZWFyY2hUZXJtLCBpc1JlZ2V4LCBzZWFyY2hSZWdleCwgaXNDYXNlU2Vuc2l0aXZlKTsNCgkJCQkJZm9yIChpID0gMDsgaSA8IGxvZ0VudHJpZXMubGVuZ3RoOyBpKyspIHsNCgkJCQkJCWN1cnJlbnRTZWFyY2guYXBwbHlUbyhsb2dFbnRyaWVzW2ldKTsNCgkJCQkJfQ0KCQkJCQlzZXRMb2dDb250YWluZXJIZWlnaHQoKTsNCg0KCQkJCQkvLyBIaWdobGlnaHQgdGhlIGZpcnN0IHNlYXJjaCBtYXRjaA0KCQkJCQlpZiAoY3VycmVudFNlYXJjaC5oYXNWaXNpYmxlTWF0Y2hlcygpKSB7DQoJCQkJCQlzZXRDdXJyZW50TWF0Y2hJbmRleCgwKTsNCgkJCQkJCWRpc3BsYXlNYXRjaGVzKCk7DQoJCQkJCX0gZWxzZSB7DQoJCQkJCQlkaXNwbGF5Tm9NYXRjaGVzKCk7DQoJCQkJCX0NCgkJCQl9DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIHVwZGF0ZVNlYXJjaEZyb21GaWx0ZXJzKCkgew0KCQkJCWlmIChjdXJyZW50U2VhcmNoKSB7DQoJCQkJCWlmIChjdXJyZW50U2VhcmNoLmhhc01hdGNoZXMoKSkgew0KCQkJCQkJaWYgKGN1cnJlbnRNYXRjaEluZGV4ID09PSBudWxsKSB7DQoJCQkJCQkJY3VycmVudE1hdGNoSW5kZXggPSAwOw0KCQkJCQkJfQ0KCQkJCQkJdmFyIGN1cnJlbnRNYXRjaCA9IGN1cnJlbnRTZWFyY2gubWF0Y2hlc1tjdXJyZW50TWF0Y2hJbmRleF07DQoJCQkJCQlpZiAoY3VycmVudE1hdGNoLmlzVmlzaWJsZSgpKSB7DQoJCQkJCQkJZGlzcGxheU1hdGNoZXMoKTsNCgkJCQkJCQlzZXRDdXJyZW50TWF0Y2hJbmRleChjdXJyZW50TWF0Y2hJbmRleCk7DQoJCQkJCQl9IGVsc2Ugew0KCQkJCQkJCWN1cnJlbnRNYXRjaC5zZXROb3RDdXJyZW50KCk7DQoJCQkJCQkJLy8gRmluZCB0aGUgbmV4dCB2aXNpYmxlIG1hdGNoLCBpZiBvbmUgZXhpc3RzDQoJCQkJCQkJdmFyIG5leHRWaXNpYmxlTWF0Y2hJbmRleCA9IGN1cnJlbnRTZWFyY2guZ2V0TmV4dFZpc2libGVNYXRjaEluZGV4KCk7DQoJCQkJCQkJaWYgKG5leHRWaXNpYmxlTWF0Y2hJbmRleCA+IC0xKSB7DQoJCQkJCQkJCXNldEN1cnJlbnRNYXRjaEluZGV4KG5leHRWaXNpYmxlTWF0Y2hJbmRleCk7DQoJCQkJCQkJCWRpc3BsYXlNYXRjaGVzKCk7DQoJCQkJCQkJfSBlbHNlIHsNCgkJCQkJCQkJZGlzcGxheU5vTWF0Y2hlcygpOw0KCQkJCQkJCX0NCgkJCQkJCX0NCgkJCQkJfSBlbHNlIHsNCgkJCQkJCWRpc3BsYXlOb01hdGNoZXMoKTsNCgkJCQkJfQ0KCQkJCX0NCgkJCX0NCg0KCQkJZnVuY3Rpb24gcmVmcmVzaEN1cnJlbnRNYXRjaCgpIHsNCgkJCQlpZiAoY3VycmVudFNlYXJjaCAmJiBjdXJyZW50U2VhcmNoLmhhc1Zpc2libGVNYXRjaGVzKCkpIHsNCgkJCQkJc2V0Q3VycmVudE1hdGNoSW5kZXgoY3VycmVudE1hdGNoSW5kZXgpOw0KCQkJCX0NCgkJCX0NCg0KCQkJZnVuY3Rpb24gZGlzcGxheU1hdGNoZXMoKSB7DQoJCQkJcmVwbGFjZUNsYXNzKCQoInNlYXJjaEJveCIpLCAiaGFzbWF0Y2hlcyIsICJub21hdGNoZXMiKTsNCgkJCQkkKCJzZWFyY2hCb3giKS50aXRsZSA9ICIiICsgY3VycmVudFNlYXJjaC5tYXRjaGVzLmxlbmd0aCArICIgbWF0Y2hlcyBmb3VuZCI7DQoJCQkJJCgic2VhcmNoTmF2Iikuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7DQoJCQkJc2V0TG9nQ29udGFpbmVySGVpZ2h0KCk7DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIGRpc3BsYXlOb01hdGNoZXMoKSB7DQoJCQkJcmVwbGFjZUNsYXNzKCQoInNlYXJjaEJveCIpLCAibm9tYXRjaGVzIiwgImhhc21hdGNoZXMiKTsNCgkJCQkkKCJzZWFyY2hCb3giKS50aXRsZSA9ICJObyBtYXRjaGVzIGZvdW5kIjsNCgkJCQkkKCJzZWFyY2hOYXYiKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOw0KCQkJCXNldExvZ0NvbnRhaW5lckhlaWdodCgpOw0KCQkJfQ0KDQoJCQlmdW5jdGlvbiB0b2dnbGVTZWFyY2hFbmFibGVkKGVuYWJsZSkgew0KCQkJCWVuYWJsZSA9ICh0eXBlb2YgZW5hYmxlID09ICJ1bmRlZmluZWQiKSA/ICEkKCJzZWFyY2hEaXNhYmxlIikuY2hlY2tlZCA6IGVuYWJsZTsNCgkJCQkkKCJzZWFyY2hCb3giKS5kaXNhYmxlZCA9ICFlbmFibGU7DQoJCQkJJCgic2VhcmNoUmVzZXQiKS5kaXNhYmxlZCA9ICFlbmFibGU7DQoJCQkJJCgic2VhcmNoUmVnZXgiKS5kaXNhYmxlZCA9ICFlbmFibGU7DQoJCQkJJCgic2VhcmNoTmV4dCIpLmRpc2FibGVkID0gIWVuYWJsZTsNCgkJCQkkKCJzZWFyY2hQcmV2aW91cyIpLmRpc2FibGVkID0gIWVuYWJsZTsNCgkJCQkkKCJzZWFyY2hDYXNlU2Vuc2l0aXZlIikuZGlzYWJsZWQgPSAhZW5hYmxlOw0KCQkJCSQoInNlYXJjaE5hdiIpLnN0eWxlLmRpc3BsYXkgPSAoZW5hYmxlICYmICgkKCJzZWFyY2hCb3giKS52YWx1ZSAhPT0gIiIpICYmDQoJCQkJCQljdXJyZW50U2VhcmNoICYmIGN1cnJlbnRTZWFyY2guaGFzVmlzaWJsZU1hdGNoZXMoKSkgPw0KCQkJCQkiYmxvY2siIDogIm5vbmUiOw0KCQkJCWlmIChlbmFibGUpIHsNCgkJCQkJcmVtb3ZlQ2xhc3MoJCgic2VhcmNoIiksICJncmV5ZWRvdXQiKTsNCgkJCQkJYWRkQ2xhc3MoZG9jdW1lbnQuYm9keSwgInNlYXJjaGluZyIpOw0KCQkJCQlpZiAoJCgic2VhcmNoSGlnaGxpZ2h0IikuY2hlY2tlZCkgew0KCQkJCQkJYWRkQ2xhc3MobG9nTWFpbkNvbnRhaW5lciwgInNlYXJjaGhpZ2hsaWdodCIpOw0KCQkJCQl9IGVsc2Ugew0KCQkJCQkJcmVtb3ZlQ2xhc3MobG9nTWFpbkNvbnRhaW5lciwgInNlYXJjaGhpZ2hsaWdodCIpOw0KCQkJCQl9DQoJCQkJCWlmICgkKCJzZWFyY2hGaWx0ZXIiKS5jaGVja2VkKSB7DQoJCQkJCQlhZGRDbGFzcyhsb2dNYWluQ29udGFpbmVyLCAic2VhcmNoZmlsdGVyIik7DQoJCQkJCX0gZWxzZSB7DQoJCQkJCQlyZW1vdmVDbGFzcyhsb2dNYWluQ29udGFpbmVyLCAic2VhcmNoZmlsdGVyIik7DQoJCQkJCX0NCgkJCQkJJCgic2VhcmNoRGlzYWJsZSIpLmNoZWNrZWQgPSAhZW5hYmxlOw0KCQkJCX0gZWxzZSB7DQoJCQkJCWFkZENsYXNzKCQoInNlYXJjaCIpLCAiZ3JleWVkb3V0Iik7DQoJCQkJCXJlbW92ZUNsYXNzKGRvY3VtZW50LmJvZHksICJzZWFyY2hpbmciKTsNCgkJCQkJcmVtb3ZlQ2xhc3MobG9nTWFpbkNvbnRhaW5lciwgInNlYXJjaGhpZ2hsaWdodCIpOw0KCQkJCQlyZW1vdmVDbGFzcyhsb2dNYWluQ29udGFpbmVyLCAic2VhcmNoZmlsdGVyIik7DQoJCQkJfQ0KCQkJCXNldExvZ0NvbnRhaW5lckhlaWdodCgpOw0KCQkJfQ0KDQoJCQlmdW5jdGlvbiB0b2dnbGVTZWFyY2hGaWx0ZXIoKSB7DQoJCQkJdmFyIGVuYWJsZSA9ICQoInNlYXJjaEZpbHRlciIpLmNoZWNrZWQ7DQoJCQkJaWYgKGVuYWJsZSkgew0KCQkJCQlhZGRDbGFzcyhsb2dNYWluQ29udGFpbmVyLCAic2VhcmNoZmlsdGVyIik7DQoJCQkJfSBlbHNlIHsNCgkJCQkJcmVtb3ZlQ2xhc3MobG9nTWFpbkNvbnRhaW5lciwgInNlYXJjaGZpbHRlciIpOw0KCQkJCX0NCgkJCQlyZWZyZXNoQ3VycmVudE1hdGNoKCk7DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIHRvZ2dsZVNlYXJjaEhpZ2hsaWdodCgpIHsNCgkJCQl2YXIgZW5hYmxlID0gJCgic2VhcmNoSGlnaGxpZ2h0IikuY2hlY2tlZDsNCgkJCQlpZiAoZW5hYmxlKSB7DQoJCQkJCWFkZENsYXNzKGxvZ01haW5Db250YWluZXIsICJzZWFyY2hoaWdobGlnaHQiKTsNCgkJCQl9IGVsc2Ugew0KCQkJCQlyZW1vdmVDbGFzcyhsb2dNYWluQ29udGFpbmVyLCAic2VhcmNoaGlnaGxpZ2h0Iik7DQoJCQkJfQ0KCQkJfQ0KDQoJCQlmdW5jdGlvbiBjbGVhclNlYXJjaCgpIHsNCgkJCQkkKCJzZWFyY2hCb3giKS52YWx1ZSA9ICIiOw0KCQkJCWRvU2VhcmNoKCk7DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIHNlYXJjaE5leHQoKSB7DQoJCQkJaWYgKGN1cnJlbnRTZWFyY2ggIT09IG51bGwgJiYgY3VycmVudE1hdGNoSW5kZXggIT09IG51bGwpIHsNCgkJCQkJY3VycmVudFNlYXJjaC5tYXRjaGVzW2N1cnJlbnRNYXRjaEluZGV4XS5zZXROb3RDdXJyZW50KCk7DQoJCQkJCXZhciBuZXh0TWF0Y2hJbmRleCA9IGN1cnJlbnRTZWFyY2guZ2V0TmV4dFZpc2libGVNYXRjaEluZGV4KCk7DQoJCQkJCWlmIChuZXh0TWF0Y2hJbmRleCA+IGN1cnJlbnRNYXRjaEluZGV4IHx8IGNvbmZpcm0oIlJlYWNoZWQgdGhlIGVuZCBvZiB0aGUgcGFnZS4gU3RhcnQgZnJvbSB0aGUgdG9wPyIpKSB7DQoJCQkJCQlzZXRDdXJyZW50TWF0Y2hJbmRleChuZXh0TWF0Y2hJbmRleCk7DQoJCQkJCX0NCgkJCQl9DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIHNlYXJjaFByZXZpb3VzKCkgew0KCQkJCWlmIChjdXJyZW50U2VhcmNoICE9PSBudWxsICYmIGN1cnJlbnRNYXRjaEluZGV4ICE9PSBudWxsKSB7DQoJCQkJCWN1cnJlbnRTZWFyY2gubWF0Y2hlc1tjdXJyZW50TWF0Y2hJbmRleF0uc2V0Tm90Q3VycmVudCgpOw0KCQkJCQl2YXIgcHJldmlvdXNNYXRjaEluZGV4ID0gY3VycmVudFNlYXJjaC5nZXRQcmV2aW91c1Zpc2libGVNYXRjaEluZGV4KCk7DQoJCQkJCWlmIChwcmV2aW91c01hdGNoSW5kZXggPCBjdXJyZW50TWF0Y2hJbmRleCB8fCBjb25maXJtKCJSZWFjaGVkIHRoZSBzdGFydCBvZiB0aGUgcGFnZS4gQ29udGludWUgZnJvbSB0aGUgYm90dG9tPyIpKSB7DQoJCQkJCQlzZXRDdXJyZW50TWF0Y2hJbmRleChwcmV2aW91c01hdGNoSW5kZXgpOw0KCQkJCQl9DQoJCQkJfQ0KCQkJfQ0KDQoJCQlmdW5jdGlvbiBzZXRDdXJyZW50TWF0Y2hJbmRleChpbmRleCkgew0KCQkJCWN1cnJlbnRNYXRjaEluZGV4ID0gaW5kZXg7DQoJCQkJY3VycmVudFNlYXJjaC5tYXRjaGVzW2N1cnJlbnRNYXRjaEluZGV4XS5zZXRDdXJyZW50KCk7DQoJCQl9DQoNCgkJCS8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi8NCg0KCQkJLy8gQ1NTIFV0aWxpdGllcw0KDQoJCQlmdW5jdGlvbiBhZGRDbGFzcyhlbCwgY3NzQ2xhc3MpIHsNCgkJCQlpZiAoIWhhc0NsYXNzKGVsLCBjc3NDbGFzcykpIHsNCgkJCQkJaWYgKGVsLmNsYXNzTmFtZSkgew0KCQkJCQkJZWwuY2xhc3NOYW1lICs9ICIgIiArIGNzc0NsYXNzOw0KCQkJCQl9IGVsc2Ugew0KCQkJCQkJZWwuY2xhc3NOYW1lID0gY3NzQ2xhc3M7DQoJCQkJCX0NCgkJCQl9DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIGhhc0NsYXNzKGVsLCBjc3NDbGFzcykgew0KCQkJCWlmIChlbC5jbGFzc05hbWUpIHsNCgkJCQkJdmFyIGNsYXNzTmFtZXMgPSBlbC5jbGFzc05hbWUuc3BsaXQoIiAiKTsNCgkJCQkJcmV0dXJuIGFycmF5X2NvbnRhaW5zKGNsYXNzTmFtZXMsIGNzc0NsYXNzKTsNCgkJCQl9DQoJCQkJcmV0dXJuIGZhbHNlOw0KCQkJfQ0KDQoJCQlmdW5jdGlvbiByZW1vdmVDbGFzcyhlbCwgY3NzQ2xhc3MpIHsNCgkJCQlpZiAoaGFzQ2xhc3MoZWwsIGNzc0NsYXNzKSkgew0KCQkJCQkvLyBSZWJ1aWxkIHRoZSBjbGFzc05hbWUgcHJvcGVydHkNCgkJCQkJdmFyIGV4aXN0aW5nQ2xhc3NlcyA9IGVsLmNsYXNzTmFtZS5zcGxpdCgiICIpOw0KCQkJCQl2YXIgbmV3Q2xhc3NlcyA9IFtdOw0KCQkJCQlmb3IgKHZhciBpID0gMCwgbGVuID0gZXhpc3RpbmdDbGFzc2VzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7DQoJCQkJCQlpZiAoZXhpc3RpbmdDbGFzc2VzW2ldICE9IGNzc0NsYXNzKSB7DQoJCQkJCQkJbmV3Q2xhc3Nlc1tuZXdDbGFzc2VzLmxlbmd0aF0gPSBleGlzdGluZ0NsYXNzZXNbaV07DQoJCQkJCQl9DQoJCQkJCX0NCgkJCQkJZWwuY2xhc3NOYW1lID0gbmV3Q2xhc3Nlcy5qb2luKCIgIik7DQoJCQkJfQ0KCQkJfQ0KDQoJCQlmdW5jdGlvbiByZXBsYWNlQ2xhc3MoZWwsIG5ld0Nzc0NsYXNzLCBvbGRDc3NDbGFzcykgew0KCQkJCXJlbW92ZUNsYXNzKGVsLCBvbGRDc3NDbGFzcyk7DQoJCQkJYWRkQ2xhc3MoZWwsIG5ld0Nzc0NsYXNzKTsNCgkJCX0NCg0KCQkJLyogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqLw0KDQoJCQkvLyBPdGhlciB1dGlsaXR5IGZ1bmN0aW9ucw0KDQoJCQlmdW5jdGlvbiBnZXRFbGVtZW50c0J5Q2xhc3MoZWwsIGNzc0NsYXNzLCB0YWdOYW1lKSB7DQoJCQkJdmFyIGVsZW1lbnRzID0gZWwuZ2V0RWxlbWVudHNCeVRhZ05hbWUodGFnTmFtZSk7DQoJCQkJdmFyIG1hdGNoZXMgPSBbXTsNCgkJCQlmb3IgKHZhciBpID0gMCwgbGVuID0gZWxlbWVudHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsNCgkJCQkJaWYgKGhhc0NsYXNzKGVsZW1lbnRzW2ldLCBjc3NDbGFzcykpIHsNCgkJCQkJCW1hdGNoZXMucHVzaChlbGVtZW50c1tpXSk7DQoJCQkJCX0NCgkJCQl9DQoJCQkJcmV0dXJuIG1hdGNoZXM7DQoJCQl9DQoNCgkJCS8vIFN5bnRheCBib3Jyb3dlZCBmcm9tIFByb3RvdHlwZSBsaWJyYXJ5DQoJCQlmdW5jdGlvbiAkKGlkKSB7DQoJCQkJcmV0dXJuIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKTsNCgkJCX0NCg0KCQkJZnVuY3Rpb24gaXNEZXNjZW5kYW50KG5vZGUsIGFuY2VzdG9yTm9kZSkgew0KCQkJCXdoaWxlIChub2RlICE9IG51bGwpIHsNCgkJCQkJaWYgKG5vZGUgPT09IGFuY2VzdG9yTm9kZSkgew0KCQkJCQkJcmV0dXJuIHRydWU7DQoJCQkJCX0NCgkJCQkJbm9kZSA9IG5vZGUucGFyZW50Tm9kZTsNCgkJCQl9DQoJCQkJcmV0dXJuIGZhbHNlOw0KCQkJfQ0KDQoJCQlmdW5jdGlvbiBpc09ycGhhbihub2RlKSB7DQoJCQkJdmFyIGN1cnJlbnROb2RlID0gbm9kZTsNCgkJCQl3aGlsZSAoY3VycmVudE5vZGUpIHsNCgkJCQkJaWYgKGN1cnJlbnROb2RlID09IGRvY3VtZW50LmJvZHkpIHsNCgkJCQkJCXJldHVybiBmYWxzZTsNCgkJCQkJfQ0KCQkJCQljdXJyZW50Tm9kZSA9IGN1cnJlbnROb2RlLnBhcmVudE5vZGU7DQoJCQkJfQ0KCQkJCXJldHVybiB0cnVlOw0KCQkJfQ0KDQoJCQlmdW5jdGlvbiBlc2NhcGVIdG1sKHN0cikgew0KCQkJCXJldHVybiBzdHIucmVwbGFjZSgvJi9nLCAiJmFtcDsiKS5yZXBsYWNlKC9bPF0vZywgIiZsdDsiKS5yZXBsYWNlKC8+L2csICImZ3Q7Iik7DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIGdldFdpbmRvd1dpZHRoKCkgew0KCQkJCWlmICh3aW5kb3cuaW5uZXJXaWR0aCkgew0KCQkJCQlyZXR1cm4gd2luZG93LmlubmVyV2lkdGg7DQoJCQkJfSBlbHNlIGlmIChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQgJiYgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoKSB7DQoJCQkJCXJldHVybiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGg7DQoJCQkJfSBlbHNlIGlmIChkb2N1bWVudC5ib2R5KSB7DQoJCQkJCXJldHVybiBkb2N1bWVudC5ib2R5LmNsaWVudFdpZHRoOw0KCQkJCX0NCgkJCQlyZXR1cm4gMDsNCgkJCX0NCg0KCQkJZnVuY3Rpb24gZ2V0V2luZG93SGVpZ2h0KCkgew0KCQkJCWlmICh3aW5kb3cuaW5uZXJIZWlnaHQpIHsNCgkJCQkJcmV0dXJuIHdpbmRvdy5pbm5lckhlaWdodDsNCgkJCQl9IGVsc2UgaWYgKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCAmJiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0KSB7DQoJCQkJCXJldHVybiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0Ow0KCQkJCX0gZWxzZSBpZiAoZG9jdW1lbnQuYm9keSkgew0KCQkJCQlyZXR1cm4gZG9jdW1lbnQuYm9keS5jbGllbnRIZWlnaHQ7DQoJCQkJfQ0KCQkJCXJldHVybiAwOw0KCQkJfQ0KDQoJCQlmdW5jdGlvbiBnZXRUb29sQmFyc0hlaWdodCgpIHsNCgkJCQlyZXR1cm4gJCgic3dpdGNoZXMiKS5vZmZzZXRIZWlnaHQ7DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIGdldENocm9tZUhlaWdodCgpIHsNCgkJCQl2YXIgaGVpZ2h0ID0gZ2V0VG9vbEJhcnNIZWlnaHQoKTsNCgkJCQlpZiAoc2hvd0NvbW1hbmRMaW5lKSB7DQoJCQkJCWhlaWdodCArPSAkKCJjb21tYW5kTGluZSIpLm9mZnNldEhlaWdodDsNCgkJCQl9DQoJCQkJcmV0dXJuIGhlaWdodDsNCgkJCX0NCg0KCQkJZnVuY3Rpb24gc2V0TG9nQ29udGFpbmVySGVpZ2h0KCkgew0KCQkJCWlmIChsb2dNYWluQ29udGFpbmVyKSB7DQoJCQkJCXZhciB3aW5kb3dIZWlnaHQgPSBnZXRXaW5kb3dIZWlnaHQoKTsNCgkJCQkJJCgiYm9keSIpLnN0eWxlLmhlaWdodCA9IGdldFdpbmRvd0hlaWdodCgpICsgInB4IjsNCgkJCQkJbG9nTWFpbkNvbnRhaW5lci5zdHlsZS5oZWlnaHQgPSAiIiArDQoJCQkJCQlNYXRoLm1heCgwLCB3aW5kb3dIZWlnaHQgLSBnZXRDaHJvbWVIZWlnaHQoKSkgKyAicHgiOw0KCQkJCX0NCgkJCX0NCg0KCQkJZnVuY3Rpb24gc2V0Q29tbWFuZElucHV0V2lkdGgoKSB7DQoJCQkJaWYgKHNob3dDb21tYW5kTGluZSkgew0KCQkJCQkkKCJjb21tYW5kIikuc3R5bGUud2lkdGggPSAiIiArIE1hdGgubWF4KDAsICQoImNvbW1hbmRMaW5lQ29udGFpbmVyIikub2Zmc2V0V2lkdGggLQ0KCQkJCQkJKCQoImV2YWx1YXRlQnV0dG9uIikub2Zmc2V0V2lkdGggKyAxMykpICsgInB4IjsNCgkJCQl9DQoJCQl9DQoNCgkJCXdpbmRvdy5vbnJlc2l6ZSA9IGZ1bmN0aW9uKCkgew0KCQkJCXNldENvbW1hbmRJbnB1dFdpZHRoKCk7DQoJCQkJc2V0TG9nQ29udGFpbmVySGVpZ2h0KCk7DQoJCQl9Ow0KDQoJCQlpZiAoIUFycmF5LnByb3RvdHlwZS5wdXNoKSB7DQoJCQkJQXJyYXkucHJvdG90eXBlLnB1c2ggPSBmdW5jdGlvbigpIHsNCgkJCSAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBsZW47IGkrKyl7DQoJCQkgICAgICAgICAgICB0aGlzW3RoaXMubGVuZ3RoXSA9IGFyZ3VtZW50c1tpXTsNCgkJCSAgICAgICAgfQ0KCQkJICAgICAgICByZXR1cm4gdGhpcy5sZW5ndGg7DQoJCQkJfTsNCgkJCX0NCg0KCQkJaWYgKCFBcnJheS5wcm90b3R5cGUucG9wKSB7DQoJCQkJQXJyYXkucHJvdG90eXBlLnBvcCA9IGZ1bmN0aW9uKCkgew0KCQkJCQlpZiAodGhpcy5sZW5ndGggPiAwKSB7DQoJCQkJCQl2YXIgdmFsID0gdGhpc1t0aGlzLmxlbmd0aCAtIDFdOw0KCQkJCQkJdGhpcy5sZW5ndGggPSB0aGlzLmxlbmd0aCAtIDE7DQoJCQkJCQlyZXR1cm4gdmFsOw0KCQkJCQl9DQoJCQkJfTsNCgkJCX0NCg0KCQkJaWYgKCFBcnJheS5wcm90b3R5cGUuc2hpZnQpIHsNCgkJCQlBcnJheS5wcm90b3R5cGUuc2hpZnQgPSBmdW5jdGlvbigpIHsNCgkJCQkJaWYgKHRoaXMubGVuZ3RoID4gMCkgew0KCQkJCQkJdmFyIGZpcnN0SXRlbSA9IHRoaXNbMF07DQoJCQkJCQlmb3IgKHZhciBpID0gMCwgbGVuID0gdGhpcy5sZW5ndGggLSAxOyBpIDwgbGVuOyBpKyspIHsNCgkJCQkJCQl0aGlzW2ldID0gdGhpc1tpICsgMV07DQoJCQkJCQl9DQoJCQkJCQl0aGlzLmxlbmd0aCA9IHRoaXMubGVuZ3RoIC0gMTsNCgkJCQkJCXJldHVybiBmaXJzdEl0ZW07DQoJCQkJCX0NCgkJCQl9Ow0KCQkJfQ0KDQoJCQlpZiAoIUFycmF5LnByb3RvdHlwZS5zcGxpY2UpIHsNCgkJCQlBcnJheS5wcm90b3R5cGUuc3BsaWNlID0gZnVuY3Rpb24oc3RhcnRJbmRleCwgZGVsZXRlQ291bnQpIHsNCgkJCQkJdmFyIGl0ZW1zQWZ0ZXJEZWxldGVkID0gdGhpcy5zbGljZShzdGFydEluZGV4ICsgZGVsZXRlQ291bnQpOw0KCQkJCQl2YXIgaXRlbXNEZWxldGVkID0gdGhpcy5zbGljZShzdGFydEluZGV4LCBzdGFydEluZGV4ICsgZGVsZXRlQ291bnQpOw0KCQkJCQl0aGlzLmxlbmd0aCA9IHN0YXJ0SW5kZXg7DQoJCQkJCS8vIENvcHkgdGhlIGFyZ3VtZW50cyBpbnRvIGEgcHJvcGVyIEFycmF5IG9iamVjdA0KCQkJCQl2YXIgYXJndW1lbnRzQXJyYXkgPSBbXTsNCgkJCQkJZm9yICh2YXIgaSA9IDAsIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBsZW47IGkrKykgew0KCQkJCQkJYXJndW1lbnRzQXJyYXlbaV0gPSBhcmd1bWVudHNbaV07DQoJCQkJCX0NCgkJCQkJdmFyIGl0ZW1zVG9BcHBlbmQgPSAoYXJndW1lbnRzQXJyYXkubGVuZ3RoID4gMikgPw0KCQkJCQkJaXRlbXNBZnRlckRlbGV0ZWQgPSBhcmd1bWVudHNBcnJheS5zbGljZSgyKS5jb25jYXQoaXRlbXNBZnRlckRlbGV0ZWQpIDogaXRlbXNBZnRlckRlbGV0ZWQ7DQoJCQkJCWZvciAoaSA9IDAsIGxlbiA9IGl0ZW1zVG9BcHBlbmQubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsNCgkJCQkJCXRoaXMucHVzaChpdGVtc1RvQXBwZW5kW2ldKTsNCgkJCQkJfQ0KCQkJCQlyZXR1cm4gaXRlbXNEZWxldGVkOw0KCQkJCX07DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIGFycmF5X3JlbW92ZShhcnIsIHZhbCkgew0KCQkJCXZhciBpbmRleCA9IC0xOw0KCQkJCWZvciAodmFyIGkgPSAwLCBsZW4gPSBhcnIubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsNCgkJCQkJaWYgKGFycltpXSA9PT0gdmFsKSB7DQoJCQkJCQlpbmRleCA9IGk7DQoJCQkJCQlicmVhazsNCgkJCQkJfQ0KCQkJCX0NCgkJCQlpZiAoaW5kZXggPj0gMCkgew0KCQkJCQlhcnIuc3BsaWNlKGluZGV4LCAxKTsNCgkJCQkJcmV0dXJuIGluZGV4Ow0KCQkJCX0gZWxzZSB7DQoJCQkJCXJldHVybiBmYWxzZTsNCgkJCQl9DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIGFycmF5X3JlbW92ZUZyb21TdGFydChhcnJheSwgbnVtYmVyVG9SZW1vdmUpIHsNCgkJCQlpZiAoQXJyYXkucHJvdG90eXBlLnNwbGljZSkgew0KCQkJCQlhcnJheS5zcGxpY2UoMCwgbnVtYmVyVG9SZW1vdmUpOw0KCQkJCX0gZWxzZSB7DQoJCQkJCWZvciAodmFyIGkgPSBudW1iZXJUb1JlbW92ZSwgbGVuID0gYXJyYXkubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsNCgkJCQkJCWFycmF5W2kgLSBudW1iZXJUb1JlbW92ZV0gPSBhcnJheVtpXTsNCgkJCQkJfQ0KCQkJCQlhcnJheS5sZW5ndGggPSBhcnJheS5sZW5ndGggLSBudW1iZXJUb1JlbW92ZTsNCgkJCQl9DQoJCQkJcmV0dXJuIGFycmF5Ow0KCQkJfQ0KDQoJCQlmdW5jdGlvbiBhcnJheV9jb250YWlucyhhcnIsIHZhbCkgew0KCQkJCWZvciAodmFyIGkgPSAwLCBsZW4gPSBhcnIubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsNCgkJCQkJaWYgKGFycltpXSA9PSB2YWwpIHsNCgkJCQkJCXJldHVybiB0cnVlOw0KCQkJCQl9DQoJCQkJfQ0KCQkJCXJldHVybiBmYWxzZTsNCgkJCX0NCg0KCQkJZnVuY3Rpb24gZ2V0RXJyb3JNZXNzYWdlKGV4KSB7DQoJCQkJaWYgKGV4Lm1lc3NhZ2UpIHsNCgkJCQkJcmV0dXJuIGV4Lm1lc3NhZ2U7DQoJCQkJfSBlbHNlIGlmIChleC5kZXNjcmlwdGlvbikgew0KCQkJCQlyZXR1cm4gZXguZGVzY3JpcHRpb247DQoJCQkJfQ0KCQkJCXJldHVybiAiIiArIGV4Ow0KCQkJfQ0KDQoJCQlmdW5jdGlvbiBtb3ZlQ2FyZXRUb0VuZChpbnB1dCkgew0KCQkJCWlmIChpbnB1dC5zZXRTZWxlY3Rpb25SYW5nZSkgew0KCQkJCQlpbnB1dC5mb2N1cygpOw0KCQkJCQl2YXIgbGVuZ3RoID0gaW5wdXQudmFsdWUubGVuZ3RoOw0KCQkJCQlpbnB1dC5zZXRTZWxlY3Rpb25SYW5nZShsZW5ndGgsIGxlbmd0aCk7DQoJCQkJfSBlbHNlIGlmIChpbnB1dC5jcmVhdGVUZXh0UmFuZ2UpIHsNCgkJCQkJdmFyIHJhbmdlID0gaW5wdXQuY3JlYXRlVGV4dFJhbmdlKCk7DQoJCQkJCXJhbmdlLmNvbGxhcHNlKGZhbHNlKTsNCgkJCQkJcmFuZ2Uuc2VsZWN0KCk7DQoJCQkJfQ0KCQkJCWlucHV0LmZvY3VzKCk7DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIHN0b3BQcm9wYWdhdGlvbihldnQpIHsNCgkJCQlpZiAoZXZ0LnN0b3BQcm9wYWdhdGlvbikgew0KCQkJCQlldnQuc3RvcFByb3BhZ2F0aW9uKCk7DQoJCQkJfSBlbHNlIGlmICh0eXBlb2YgZXZ0LmNhbmNlbEJ1YmJsZSAhPSAidW5kZWZpbmVkIikgew0KCQkJCQlldnQuY2FuY2VsQnViYmxlID0gdHJ1ZTsNCgkJCQl9DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIGdldEV2ZW50KGV2dCkgew0KCQkJCXJldHVybiBldnQgPyBldnQgOiBldmVudDsNCgkJCX0NCg0KCQkJZnVuY3Rpb24gZ2V0VGFyZ2V0KGV2dCkgew0KCQkJCXJldHVybiBldnQudGFyZ2V0ID8gZXZ0LnRhcmdldCA6IGV2dC5zcmNFbGVtZW50Ow0KCQkJfQ0KDQoJCQlmdW5jdGlvbiBnZXRSZWxhdGVkVGFyZ2V0KGV2dCkgew0KCQkJCWlmIChldnQucmVsYXRlZFRhcmdldCkgew0KCQkJCQlyZXR1cm4gZXZ0LnJlbGF0ZWRUYXJnZXQ7DQoJCQkJfSBlbHNlIGlmIChldnQuc3JjRWxlbWVudCkgew0KCQkJCQlzd2l0Y2goZXZ0LnR5cGUpIHsNCgkJCQkJCWNhc2UgIm1vdXNlb3ZlciI6DQoJCQkJCQkJcmV0dXJuIGV2dC5mcm9tRWxlbWVudDsNCgkJCQkJCWNhc2UgIm1vdXNlb3V0IjoNCgkJCQkJCQlyZXR1cm4gZXZ0LnRvRWxlbWVudDsNCgkJCQkJCWRlZmF1bHQ6DQoJCQkJCQkJcmV0dXJuIGV2dC5zcmNFbGVtZW50Ow0KCQkJCQl9DQoJCQkJfQ0KCQkJfQ0KDQoJCQlmdW5jdGlvbiBjYW5jZWxLZXlFdmVudChldnQpIHsNCgkJCQlldnQucmV0dXJuVmFsdWUgPSBmYWxzZTsNCgkJCQlzdG9wUHJvcGFnYXRpb24oZXZ0KTsNCgkJCX0NCg0KCQkJZnVuY3Rpb24gZXZhbENvbW1hbmRMaW5lKCkgew0KCQkJCXZhciBleHByID0gJCgiY29tbWFuZCIpLnZhbHVlOw0KCQkJCWV2YWxDb21tYW5kKGV4cHIpOw0KCQkJCSQoImNvbW1hbmQiKS52YWx1ZSA9ICIiOw0KCQkJfQ0KDQoJCQlmdW5jdGlvbiBldmFsTGFzdENvbW1hbmQoKSB7DQoJCQkJaWYgKGxhc3RDb21tYW5kICE9IG51bGwpIHsNCgkJCQkJZXZhbENvbW1hbmQobGFzdENvbW1hbmQpOw0KCQkJCX0NCgkJCX0NCg0KCQkJdmFyIGxhc3RDb21tYW5kID0gbnVsbDsNCgkJCXZhciBjb21tYW5kSGlzdG9yeSA9IFtdOw0KCQkJdmFyIGN1cnJlbnRDb21tYW5kSW5kZXggPSAwOw0KDQoJCQlmdW5jdGlvbiBldmFsQ29tbWFuZChleHByKSB7DQoJCQkJaWYgKGFwcGVuZGVyKSB7DQoJCQkJCWFwcGVuZGVyLmV2YWxDb21tYW5kQW5kQXBwZW5kKGV4cHIpOw0KCQkJCX0gZWxzZSB7DQoJCQkJCXZhciBwcmVmaXggPSAiPj4+ICIgKyBleHByICsgIlxyXG4iOw0KCQkJCQl0cnkgew0KCQkJCQkJbG9nKCJJTkZPIiwgcHJlZml4ICsgZXZhbChleHByKSk7DQoJCQkJCX0gY2F0Y2ggKGV4KSB7DQoJCQkJCQlsb2coIkVSUk9SIiwgcHJlZml4ICsgIkVycm9yOiAiICsgZ2V0RXJyb3JNZXNzYWdlKGV4KSk7DQoJCQkJCX0NCgkJCQl9DQoJCQkJLy8gVXBkYXRlIGNvbW1hbmQgaGlzdG9yeQ0KCQkJCWlmIChleHByICE9IGNvbW1hbmRIaXN0b3J5W2NvbW1hbmRIaXN0b3J5Lmxlbmd0aCAtIDFdKSB7DQoJCQkJCWNvbW1hbmRIaXN0b3J5LnB1c2goZXhwcik7DQoJCQkJCS8vIFVwZGF0ZSB0aGUgYXBwZW5kZXINCgkJCQkJaWYgKGFwcGVuZGVyKSB7DQoJCQkJCQlhcHBlbmRlci5zdG9yZUNvbW1hbmRIaXN0b3J5KGNvbW1hbmRIaXN0b3J5KTsNCgkJCQkJfQ0KCQkJCX0NCgkJCQljdXJyZW50Q29tbWFuZEluZGV4ID0gKGV4cHIgPT0gY29tbWFuZEhpc3RvcnlbY3VycmVudENvbW1hbmRJbmRleF0pID8gY3VycmVudENvbW1hbmRJbmRleCArIDEgOiBjb21tYW5kSGlzdG9yeS5sZW5ndGg7DQoJCQkJbGFzdENvbW1hbmQgPSBleHByOw0KCQkJfQ0KCQkJLy9dXT4NCgkJPC9zY3JpcHQ+DQoJCTxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+DQoJCQlib2R5IHsNCgkJCQliYWNrZ3JvdW5kLWNvbG9yOiB3aGl0ZTsNCgkJCQljb2xvcjogYmxhY2s7DQoJCQkJcGFkZGluZzogMDsNCgkJCQltYXJnaW46IDA7DQoJCQkJZm9udC1mYW1pbHk6IHRhaG9tYSwgdmVyZGFuYSwgYXJpYWwsIGhlbHZldGljYSwgc2Fucy1zZXJpZjsNCgkJCQlvdmVyZmxvdzogaGlkZGVuOw0KCQkJfQ0KDQoJCQlkaXYjc3dpdGNoZXNDb250YWluZXIgaW5wdXQgew0KCQkJCW1hcmdpbi1ib3R0b206IDA7DQoJCQl9DQoNCgkJCWRpdi50b29sYmFyIHsNCgkJCQlib3JkZXItdG9wOiBzb2xpZCAjZmZmZmZmIDFweDsNCgkJCQlib3JkZXItYm90dG9tOiBzb2xpZCAjYWNhODk5IDFweDsNCgkJCQliYWNrZ3JvdW5kLWNvbG9yOiAjZjFlZmU3Ow0KCQkJCXBhZGRpbmc6IDNweCA1cHg7DQoJCQkJZm9udC1zaXplOiA2OC43NSU7DQoJCQl9DQoNCgkJCWRpdi50b29sYmFyLCBkaXYjc2VhcmNoIGlucHV0IHsNCgkJCQlmb250LWZhbWlseTogdGFob21hLCB2ZXJkYW5hLCBhcmlhbCwgaGVsdmV0aWNhLCBzYW5zLXNlcmlmOw0KCQkJfQ0KDQoJCQlkaXYudG9vbGJhciBpbnB1dC5idXR0b24gew0KCQkJCXBhZGRpbmc6IDAgNXB4Ow0KCQkJCWZvbnQtc2l6ZTogMTAwJTsNCgkJCX0NCg0KCQkJZGl2LnRvb2xiYXIgaW5wdXQuaGlkZGVuIHsNCgkJCQlkaXNwbGF5OiBub25lOw0KCQkJfQ0KDQoJCQlkaXYjc3dpdGNoZXMgaW5wdXQjY2xlYXJCdXR0b24gew0KCQkJCW1hcmdpbi1sZWZ0OiAyMHB4Ow0KCQkJfQ0KDQoJCQlkaXYjbGV2ZWxzIGxhYmVsIHsNCgkJCQlmb250LXdlaWdodDogYm9sZDsNCgkJCX0NCg0KCQkJZGl2I2xldmVscyBsYWJlbCwgZGl2I29wdGlvbnMgbGFiZWwgew0KCQkJCW1hcmdpbi1yaWdodDogNXB4Ow0KCQkJfQ0KDQoJCQlkaXYjbGV2ZWxzIGxhYmVsI3dyYXBMYWJlbCB7DQoJCQkJZm9udC13ZWlnaHQ6IG5vcm1hbDsNCgkJCX0NCg0KCQkJZGl2I3NlYXJjaCBsYWJlbCB7DQoJCQkJbWFyZ2luLXJpZ2h0OiAxMHB4Ow0KCQkJfQ0KDQoJCQlkaXYjc2VhcmNoIGxhYmVsLnNlYXJjaGJveGxhYmVsIHsNCgkJCQltYXJnaW4tcmlnaHQ6IDA7DQoJCQl9DQoNCgkJCWRpdiNzZWFyY2ggaW5wdXQgew0KCQkJCWZvbnQtc2l6ZTogMTAwJTsNCgkJCX0NCg0KCQkJZGl2I3NlYXJjaCBpbnB1dC52YWxpZHJlZ2V4IHsNCgkJCQljb2xvcjogZ3JlZW47DQoJCQl9DQoNCgkJCWRpdiNzZWFyY2ggaW5wdXQuaW52YWxpZHJlZ2V4IHsNCgkJCQljb2xvcjogcmVkOw0KCQkJfQ0KDQoJCQlkaXYjc2VhcmNoIGlucHV0Lm5vbWF0Y2hlcyB7DQoJCQkJY29sb3I6IHdoaXRlOw0KCQkJCWJhY2tncm91bmQtY29sb3I6ICNmZjY2NjY7DQoJCQl9DQoNCgkJCWRpdiNzZWFyY2ggaW5wdXQubm9tYXRjaGVzIHsNCgkJCQljb2xvcjogd2hpdGU7DQoJCQkJYmFja2dyb3VuZC1jb2xvcjogI2ZmNjY2NjsNCgkJCX0NCg0KCQkJZGl2I3NlYXJjaE5hdiB7DQoJCQkJZGlzcGxheTogbm9uZTsNCgkJCX0NCg0KCQkJZGl2I2NvbW1hbmRMaW5lIHsNCgkJCQlkaXNwbGF5OiBub25lOw0KCQkJfQ0KDQoJCQlkaXYjY29tbWFuZExpbmUgaW5wdXQjY29tbWFuZCB7DQoJCQkJZm9udC1zaXplOiAxMDAlOw0KCQkJCWZvbnQtZmFtaWx5OiBDb3VyaWVyIE5ldywgQ291cmllcjsNCgkJCX0NCg0KCQkJZGl2I2NvbW1hbmRMaW5lIGlucHV0I2V2YWx1YXRlQnV0dG9uIHsNCgkJCX0NCg0KCQkJKi5ncmV5ZWRvdXQgew0KCQkJCWNvbG9yOiBncmF5ICFpbXBvcnRhbnQ7DQoJCQkJYm9yZGVyLWNvbG9yOiBncmF5ICFpbXBvcnRhbnQ7DQoJCQl9DQoNCgkJCSouZ3JleWVkb3V0ICouYWx3YXlzZW5hYmxlZCB7IGNvbG9yOiBibGFjazsgfQ0KDQoJCQkqLnVuc2VsZWN0YWJsZSB7DQoJCQkJLWtodG1sLXVzZXItc2VsZWN0OiBub25lOw0KCQkJCS1tb3otdXNlci1zZWxlY3Q6IG5vbmU7DQoJCQkJdXNlci1zZWxlY3Q6IG5vbmU7DQoJCQl9DQoNCgkJCWRpdiNsb2cgew0KCQkJCWZvbnQtZmFtaWx5OiBDb3VyaWVyIE5ldywgQ291cmllcjsNCgkJCQlmb250LXNpemU6IDc1JTsNCgkJCQl3aWR0aDogMTAwJTsNCgkJCQlvdmVyZmxvdzogYXV0bzsNCgkJCQljbGVhcjogYm90aDsNCgkJCQlwb3NpdGlvbjogcmVsYXRpdmU7DQoJCQl9DQoNCgkJCWRpdi5ncm91cCB7DQoJCQkJYm9yZGVyLWNvbG9yOiAjY2NjY2NjOw0KCQkJCWJvcmRlci1zdHlsZTogc29saWQ7DQoJCQkJYm9yZGVyLXdpZHRoOiAxcHggMCAxcHggMXB4Ow0KCQkJCW92ZXJmbG93OiB2aXNpYmxlOw0KCQkJfQ0KDQoJCQlkaXYub2xkSWUgZGl2Lmdyb3VwLCBkaXYub2xkSWUgZGl2Lmdyb3VwICosIGRpdi5vbGRJZSAqLmxvZ2VudHJ5IHsNCgkJCQloZWlnaHQ6IDElOw0KCQkJfQ0KDQoJCQlkaXYuZ3JvdXAgZGl2Lmdyb3VwaGVhZGluZyBzcGFuLmV4cGFuZGVyIHsNCgkJCQlib3JkZXI6IHNvbGlkIGJsYWNrIDFweDsNCgkJCQlmb250LWZhbWlseTogQ291cmllciBOZXcsIENvdXJpZXI7DQoJCQkJZm9udC1zaXplOiAwLjgzM2VtOw0KCQkJCWJhY2tncm91bmQtY29sb3I6ICNlZWVlZWU7DQoJCQkJcG9zaXRpb246IHJlbGF0aXZlOw0KCQkJCXRvcDogLTFweDsNCgkJCQljb2xvcjogYmxhY2s7DQoJCQkJcGFkZGluZzogMCAycHg7DQoJCQkJY3Vyc29yOiBwb2ludGVyOw0KCQkJCWN1cnNvcjogaGFuZDsNCgkJCQloZWlnaHQ6IDElOw0KCQkJfQ0KDQoJCQlkaXYuZ3JvdXAgZGl2Lmdyb3VwY29udGVudCB7DQoJCQkJbWFyZ2luLWxlZnQ6IDEwcHg7DQoJCQkJcGFkZGluZy1ib3R0b206IDJweDsNCgkJCQlvdmVyZmxvdzogdmlzaWJsZTsNCgkJCX0NCg0KCQkJZGl2Lmdyb3VwIGRpdi5leHBhbmRlZCB7DQoJCQkJZGlzcGxheTogYmxvY2s7DQoJCQl9DQoNCgkJCWRpdi5ncm91cCBkaXYuY29sbGFwc2VkIHsNCgkJCQlkaXNwbGF5OiBub25lOw0KCQkJfQ0KDQoJCQkqLmxvZ2VudHJ5IHsNCgkJCQlvdmVyZmxvdzogdmlzaWJsZTsNCgkJCQlkaXNwbGF5OiBub25lOw0KCQkJCXdoaXRlLXNwYWNlOiBwcmU7DQoJCQl9DQoNCgkJCXNwYW4ucHJlIHsNCgkJCQl3aGl0ZS1zcGFjZTogcHJlOw0KCQkJfQ0KCQkJDQoJCQlwcmUudW53cmFwcGVkIHsNCgkJCQlkaXNwbGF5OiBpbmxpbmUgIWltcG9ydGFudDsNCgkJCX0NCg0KCQkJcHJlLnVud3JhcHBlZCBwcmUucHJlLCBkaXYud3JhcHBlZCBwcmUucHJlIHsNCgkJCQlkaXNwbGF5OiBpbmxpbmU7DQoJCQl9DQoNCgkJCWRpdi53cmFwcGVkIHByZS5wcmUgew0KCQkJCXdoaXRlLXNwYWNlOiBub3JtYWw7DQoJCQl9DQoNCgkJCWRpdi53cmFwcGVkIHsNCgkJCQlkaXNwbGF5OiBub25lOw0KCQkJfQ0KDQoJCQlib2R5LnNlYXJjaGluZyAqLmxvZ2VudHJ5IHNwYW4uY3VycmVudG1hdGNoIHsNCgkJCQljb2xvcjogd2hpdGUgIWltcG9ydGFudDsNCgkJCQliYWNrZ3JvdW5kLWNvbG9yOiBncmVlbiAhaW1wb3J0YW50Ow0KCQkJfQ0KDQoJCQlib2R5LnNlYXJjaGluZyBkaXYuc2VhcmNoaGlnaGxpZ2h0ICoubG9nZW50cnkgc3Bhbi5zZWFyY2h0ZXJtIHsNCgkJCQljb2xvcjogYmxhY2s7DQoJCQkJYmFja2dyb3VuZC1jb2xvcjogeWVsbG93Ow0KCQkJfQ0KDQoJCQlkaXYud3JhcCAqLmxvZ2VudHJ5IHsNCgkJCQl3aGl0ZS1zcGFjZTogbm9ybWFsICFpbXBvcnRhbnQ7DQoJCQkJYm9yZGVyLXdpZHRoOiAwIDAgMXB4IDA7DQoJCQkJYm9yZGVyLWNvbG9yOiAjZGRkZGRkOw0KCQkJCWJvcmRlci1zdHlsZTogZG90dGVkOw0KCQkJfQ0KDQoJCQlkaXYud3JhcCAjbG9nX3dyYXBwZWQsICNsb2dfdW53cmFwcGVkIHsNCgkJCQlkaXNwbGF5OiBibG9jazsNCgkJCX0NCg0KCQkJZGl2LndyYXAgI2xvZ191bndyYXBwZWQsICNsb2dfd3JhcHBlZCB7DQoJCQkJZGlzcGxheTogbm9uZTsNCgkJCX0NCg0KCQkJZGl2LndyYXAgKi5sb2dlbnRyeSBzcGFuLnByZSB7DQoJCQkJb3ZlcmZsb3c6IHZpc2libGU7DQoJCQkJd2hpdGUtc3BhY2U6IG5vcm1hbDsNCgkJCX0NCg0KCQkJZGl2LndyYXAgKi5sb2dlbnRyeSBwcmUudW53cmFwcGVkIHsNCgkJCQlkaXNwbGF5OiBub25lOw0KCQkJfQ0KDQoJCQlkaXYud3JhcCAqLmxvZ2VudHJ5IHNwYW4ud3JhcHBlZCB7DQoJCQkJZGlzcGxheTogaW5saW5lOw0KCQkJfQ0KDQoJCQlkaXYuc2VhcmNoZmlsdGVyICouc2VhcmNobm9ubWF0Y2ggew0KCQkJCWRpc3BsYXk6IG5vbmUgIWltcG9ydGFudDsNCgkJCX0NCg0KCQkJZGl2I2xvZyAqLlRSQUNFLCBsYWJlbCNsYWJlbF9UUkFDRSB7DQoJCQkJY29sb3I6ICM2NjY2NjY7DQoJCQl9DQoNCgkJCWRpdiNsb2cgKi5ERUJVRywgbGFiZWwjbGFiZWxfREVCVUcgew0KCQkJCWNvbG9yOiBncmVlbjsNCgkJCX0NCg0KCQkJZGl2I2xvZyAqLklORk8sIGxhYmVsI2xhYmVsX0lORk8gew0KCQkJCWNvbG9yOiAjMDAwMDk5Ow0KCQkJfQ0KDQoJCQlkaXYjbG9nICouV0FSTiwgbGFiZWwjbGFiZWxfV0FSTiB7DQoJCQkJY29sb3I6ICM5OTk5MDA7DQoJCQl9DQoNCgkJCWRpdiNsb2cgKi5FUlJPUiwgbGFiZWwjbGFiZWxfRVJST1Igew0KCQkJCWNvbG9yOiByZWQ7DQoJCQl9DQoNCgkJCWRpdiNsb2cgKi5GQVRBTCwgbGFiZWwjbGFiZWxfRkFUQUwgew0KCQkJCWNvbG9yOiAjNjYwMDY2Ow0KCQkJfQ0KDQoJCQlkaXYuVFJBQ0UjbG9nICouVFJBQ0UsDQoJCQlkaXYuREVCVUcjbG9nICouREVCVUcsDQoJCQlkaXYuSU5GTyNsb2cgKi5JTkZPLA0KCQkJZGl2LldBUk4jbG9nICouV0FSTiwNCgkJCWRpdi5FUlJPUiNsb2cgKi5FUlJPUiwNCgkJCWRpdi5GQVRBTCNsb2cgKi5GQVRBTCB7DQoJCQkJZGlzcGxheTogYmxvY2s7DQoJCQl9DQoNCgkJCWRpdiNsb2cgZGl2LnNlcGFyYXRvciB7DQoJCQkJYmFja2dyb3VuZC1jb2xvcjogI2NjY2NjYzsNCgkJCQltYXJnaW46IDVweCAwOw0KCQkJCWxpbmUtaGVpZ2h0OiAxcHg7DQoJCQl9DQoJCTwvc3R5bGU+DQoJPC9oZWFkPg0KDQoJPGJvZHkgaWQ9ImJvZHkiPg0KCQk8ZGl2IGlkPSJzd2l0Y2hlc0NvbnRhaW5lciI+DQoJCQk8ZGl2IGlkPSJzd2l0Y2hlcyI+DQoJCQkJPGRpdiBpZD0ibGV2ZWxzIiBjbGFzcz0idG9vbGJhciI+DQoJCQkJCUZpbHRlcnM6DQoJCQkJCTxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9InN3aXRjaF9UUkFDRSIgb25jbGljaz0iYXBwbHlGaWx0ZXJzKCk7IGNoZWNrQWxsTGV2ZWxzKCkiIGNoZWNrZWQ9ImNoZWNrZWQiIHRpdGxlPSJTaG93L2hpZGUgdHJhY2UgbWVzc2FnZXMiIC8+PGxhYmVsIGZvcj0ic3dpdGNoX1RSQUNFIiBpZD0ibGFiZWxfVFJBQ0UiPnRyYWNlPC9sYWJlbD4NCgkJCQkJPGlucHV0IHR5cGU9ImNoZWNrYm94IiBpZD0ic3dpdGNoX0RFQlVHIiBvbmNsaWNrPSJhcHBseUZpbHRlcnMoKTsgY2hlY2tBbGxMZXZlbHMoKSIgY2hlY2tlZD0iY2hlY2tlZCIgdGl0bGU9IlNob3cvaGlkZSBkZWJ1ZyBtZXNzYWdlcyIgLz48bGFiZWwgZm9yPSJzd2l0Y2hfREVCVUciIGlkPSJsYWJlbF9ERUJVRyI+ZGVidWc8L2xhYmVsPg0KCQkJCQk8aW5wdXQgdHlwZT0iY2hlY2tib3giIGlkPSJzd2l0Y2hfSU5GTyIgb25jbGljaz0iYXBwbHlGaWx0ZXJzKCk7IGNoZWNrQWxsTGV2ZWxzKCkiIGNoZWNrZWQ9ImNoZWNrZWQiIHRpdGxlPSJTaG93L2hpZGUgaW5mbyBtZXNzYWdlcyIgLz48bGFiZWwgZm9yPSJzd2l0Y2hfSU5GTyIgaWQ9ImxhYmVsX0lORk8iPmluZm88L2xhYmVsPg0KCQkJCQk8aW5wdXQgdHlwZT0iY2hlY2tib3giIGlkPSJzd2l0Y2hfV0FSTiIgb25jbGljaz0iYXBwbHlGaWx0ZXJzKCk7IGNoZWNrQWxsTGV2ZWxzKCkiIGNoZWNrZWQ9ImNoZWNrZWQiIHRpdGxlPSJTaG93L2hpZGUgd2FybiBtZXNzYWdlcyIgLz48bGFiZWwgZm9yPSJzd2l0Y2hfV0FSTiIgaWQ9ImxhYmVsX1dBUk4iPndhcm48L2xhYmVsPg0KCQkJCQk8aW5wdXQgdHlwZT0iY2hlY2tib3giIGlkPSJzd2l0Y2hfRVJST1IiIG9uY2xpY2s9ImFwcGx5RmlsdGVycygpOyBjaGVja0FsbExldmVscygpIiBjaGVja2VkPSJjaGVja2VkIiB0aXRsZT0iU2hvdy9oaWRlIGVycm9yIG1lc3NhZ2VzIiAvPjxsYWJlbCBmb3I9InN3aXRjaF9FUlJPUiIgaWQ9ImxhYmVsX0VSUk9SIj5lcnJvcjwvbGFiZWw+DQoJCQkJCTxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9InN3aXRjaF9GQVRBTCIgb25jbGljaz0iYXBwbHlGaWx0ZXJzKCk7IGNoZWNrQWxsTGV2ZWxzKCkiIGNoZWNrZWQ9ImNoZWNrZWQiIHRpdGxlPSJTaG93L2hpZGUgZmF0YWwgbWVzc2FnZXMiIC8+PGxhYmVsIGZvcj0ic3dpdGNoX0ZBVEFMIiBpZD0ibGFiZWxfRkFUQUwiPmZhdGFsPC9sYWJlbD4NCgkJCQkJPGlucHV0IHR5cGU9ImNoZWNrYm94IiBpZD0ic3dpdGNoX0FMTCIgb25jbGljaz0idG9nZ2xlQWxsTGV2ZWxzKCk7IGFwcGx5RmlsdGVycygpIiBjaGVja2VkPSJjaGVja2VkIiB0aXRsZT0iU2hvdy9oaWRlIGFsbCBtZXNzYWdlcyIgLz48bGFiZWwgZm9yPSJzd2l0Y2hfQUxMIiBpZD0ibGFiZWxfQUxMIj5hbGw8L2xhYmVsPg0KCQkJCTwvZGl2Pg0KCQkJCTxkaXYgaWQ9InNlYXJjaCIgY2xhc3M9InRvb2xiYXIiPg0KCQkJCQk8bGFiZWwgZm9yPSJzZWFyY2hCb3giIGNsYXNzPSJzZWFyY2hib3hsYWJlbCI+U2VhcmNoOjwvbGFiZWw+IDxpbnB1dCB0eXBlPSJ0ZXh0IiBpZD0ic2VhcmNoQm94IiBvbmNsaWNrPSJ0b2dnbGVTZWFyY2hFbmFibGVkKHRydWUpIiBvbmtleXVwPSJzY2hlZHVsZVNlYXJjaCgpIiBzaXplPSIyMCIgLz4NCgkJCQkJPGlucHV0IHR5cGU9ImJ1dHRvbiIgaWQ9InNlYXJjaFJlc2V0IiBkaXNhYmxlZD0iZGlzYWJsZWQiIHZhbHVlPSJSZXNldCIgb25jbGljaz0iY2xlYXJTZWFyY2goKSIgY2xhc3M9ImJ1dHRvbiIgdGl0bGU9IlJlc2V0IHRoZSBzZWFyY2giIC8+DQoJCQkJCTxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9InNlYXJjaFJlZ2V4IiBvbmNsaWNrPSJkb1NlYXJjaCgpIiB0aXRsZT0iSWYgY2hlY2tlZCwgc2VhcmNoIGlzIHRyZWF0ZWQgYXMgYSByZWd1bGFyIGV4cHJlc3Npb24iIC8+PGxhYmVsIGZvcj0ic2VhcmNoUmVnZXgiPlJlZ2V4PC9sYWJlbD4NCgkJCQkJPGlucHV0IHR5cGU9ImNoZWNrYm94IiBpZD0ic2VhcmNoQ2FzZVNlbnNpdGl2ZSIgb25jbGljaz0iZG9TZWFyY2goKSIgdGl0bGU9IklmIGNoZWNrZWQsIHNlYXJjaCBpcyBjYXNlIHNlbnNpdGl2ZSIgLz48bGFiZWwgZm9yPSJzZWFyY2hDYXNlU2Vuc2l0aXZlIj5NYXRjaCBjYXNlPC9sYWJlbD4NCgkJCQkJPGlucHV0IHR5cGU9ImNoZWNrYm94IiBpZD0ic2VhcmNoRGlzYWJsZSIgb25jbGljaz0idG9nZ2xlU2VhcmNoRW5hYmxlZCgpIiB0aXRsZT0iRW5hYmxlL2Rpc2FibGUgc2VhcmNoIiAvPjxsYWJlbCBmb3I9InNlYXJjaERpc2FibGUiIGNsYXNzPSJhbHdheXNlbmFibGVkIj5EaXNhYmxlPC9sYWJlbD4NCgkJCQkJPGRpdiBpZD0ic2VhcmNoTmF2Ij4NCgkJCQkJCTxpbnB1dCB0eXBlPSJidXR0b24iIGlkPSJzZWFyY2hOZXh0IiBkaXNhYmxlZD0iZGlzYWJsZWQiIHZhbHVlPSJOZXh0IiBvbmNsaWNrPSJzZWFyY2hOZXh0KCkiIGNsYXNzPSJidXR0b24iIHRpdGxlPSJHbyB0byB0aGUgbmV4dCBtYXRjaGluZyBsb2cgZW50cnkiIC8+DQoJCQkJCQk8aW5wdXQgdHlwZT0iYnV0dG9uIiBpZD0ic2VhcmNoUHJldmlvdXMiIGRpc2FibGVkPSJkaXNhYmxlZCIgdmFsdWU9IlByZXZpb3VzIiBvbmNsaWNrPSJzZWFyY2hQcmV2aW91cygpIiBjbGFzcz0iYnV0dG9uIiB0aXRsZT0iR28gdG8gdGhlIHByZXZpb3VzIG1hdGNoaW5nIGxvZyBlbnRyeSIgLz4NCgkJCQkJCTxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9InNlYXJjaEZpbHRlciIgb25jbGljaz0idG9nZ2xlU2VhcmNoRmlsdGVyKCkiIHRpdGxlPSJJZiBjaGVja2VkLCBub24tbWF0Y2hpbmcgbG9nIGVudHJpZXMgYXJlIGZpbHRlcmVkIG91dCIgLz48bGFiZWwgZm9yPSJzZWFyY2hGaWx0ZXIiPkZpbHRlcjwvbGFiZWw+DQoJCQkJCQk8aW5wdXQgdHlwZT0iY2hlY2tib3giIGlkPSJzZWFyY2hIaWdobGlnaHQiIG9uY2xpY2s9InRvZ2dsZVNlYXJjaEhpZ2hsaWdodCgpIiB0aXRsZT0iSGlnaGxpZ2h0IG1hdGNoZWQgc2VhcmNoIHRlcm1zIiAvPjxsYWJlbCBmb3I9InNlYXJjaEhpZ2hsaWdodCIgY2xhc3M9ImFsd2F5c2VuYWJsZWQiPkhpZ2hsaWdodCBhbGw8L2xhYmVsPg0KCQkJCQk8L2Rpdj4NCgkJCQk8L2Rpdj4NCgkJCQk8ZGl2IGlkPSJvcHRpb25zIiBjbGFzcz0idG9vbGJhciI+DQoJCQkJCU9wdGlvbnM6DQoJCQkJCTxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9ImVuYWJsZUxvZ2dpbmciIG9uY2xpY2s9InRvZ2dsZUxvZ2dpbmdFbmFibGVkKCkiIGNoZWNrZWQ9ImNoZWNrZWQiIHRpdGxlPSJFbmFibGUvZGlzYWJsZSBsb2dnaW5nIiAvPjxsYWJlbCBmb3I9ImVuYWJsZUxvZ2dpbmciIGlkPSJlbmFibGVMb2dnaW5nTGFiZWwiPkxvZzwvbGFiZWw+DQoJCQkJCTxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9IndyYXAiIG9uY2xpY2s9InRvZ2dsZVdyYXAoKSIgdGl0bGU9IkVuYWJsZSAvIGRpc2FibGUgd29yZCB3cmFwIiAvPjxsYWJlbCBmb3I9IndyYXAiIGlkPSJ3cmFwTGFiZWwiPldyYXA8L2xhYmVsPg0KCQkJCQk8aW5wdXQgdHlwZT0iY2hlY2tib3giIGlkPSJuZXdlc3RBdFRvcCIgb25jbGljaz0idG9nZ2xlTmV3ZXN0QXRUb3AoKSIgdGl0bGU9IklmIGNoZWNrZWQsIGNhdXNlcyBuZXdlc3QgbWVzc2FnZXMgdG8gYXBwZWFyIGF0IHRoZSB0b3AiIC8+PGxhYmVsIGZvcj0ibmV3ZXN0QXRUb3AiIGlkPSJuZXdlc3RBdFRvcExhYmVsIj5OZXdlc3QgYXQgdGhlIHRvcDwvbGFiZWw+DQoJCQkJCTxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9InNjcm9sbFRvTGF0ZXN0IiBvbmNsaWNrPSJ0b2dnbGVTY3JvbGxUb0xhdGVzdCgpIiBjaGVja2VkPSJjaGVja2VkIiB0aXRsZT0iSWYgY2hlY2tlZCwgd2luZG93IGF1dG9tYXRpY2FsbHkgc2Nyb2xscyB0byBhIG5ldyBtZXNzYWdlIHdoZW4gaXQgaXMgYWRkZWQiIC8+PGxhYmVsIGZvcj0ic2Nyb2xsVG9MYXRlc3QiIGlkPSJzY3JvbGxUb0xhdGVzdExhYmVsIj5TY3JvbGwgdG8gbGF0ZXN0PC9sYWJlbD4NCgkJCQkJPGlucHV0IHR5cGU9ImJ1dHRvbiIgaWQ9ImNsZWFyQnV0dG9uIiB2YWx1ZT0iQ2xlYXIiIG9uY2xpY2s9ImNsZWFyTG9nKCkiIGNsYXNzPSJidXR0b24iIHRpdGxlPSJDbGVhciBhbGwgbG9nIG1lc3NhZ2VzIiAgLz4NCgkJCQkJPGlucHV0IHR5cGU9ImJ1dHRvbiIgaWQ9ImhpZGVCdXR0b24iIHZhbHVlPSJIaWRlIiBvbmNsaWNrPSJoaWRlKCkiIGNsYXNzPSJoaWRkZW4gYnV0dG9uIiB0aXRsZT0iSGlkZSB0aGUgY29uc29sZSIgLz4NCgkJCQkJPGlucHV0IHR5cGU9ImJ1dHRvbiIgaWQ9ImNsb3NlQnV0dG9uIiB2YWx1ZT0iQ2xvc2UiIG9uY2xpY2s9ImNsb3NlV2luZG93KCkiIGNsYXNzPSJoaWRkZW4gYnV0dG9uIiB0aXRsZT0iQ2xvc2UgdGhlIHdpbmRvdyIgLz4NCgkJCQk8L2Rpdj4NCgkJCTwvZGl2Pg0KCQk8L2Rpdj4NCgkJPGRpdiBpZD0ibG9nIiBjbGFzcz0iVFJBQ0UgREVCVUcgSU5GTyBXQVJOIEVSUk9SIEZBVEFMIj48L2Rpdj4NCgkJPGRpdiBpZD0iY29tbWFuZExpbmUiIGNsYXNzPSJ0b29sYmFyIj4NCgkJCTxkaXYgaWQ9ImNvbW1hbmRMaW5lQ29udGFpbmVyIj4NCgkJCQk8aW5wdXQgdHlwZT0idGV4dCIgaWQ9ImNvbW1hbmQiIHRpdGxlPSJFbnRlciBhIEphdmFTY3JpcHQgY29tbWFuZCBoZXJlIGFuZCBoaXQgcmV0dXJuIG9yIHByZXNzICdFdmFsdWF0ZSciIC8+DQoJCQkJPGlucHV0IHR5cGU9ImJ1dHRvbiIgaWQ9ImV2YWx1YXRlQnV0dG9uIiB2YWx1ZT0iRXZhbHVhdGUiIGNsYXNzPSJidXR0b24iIHRpdGxlPSJFdmFsdWF0ZSB0aGUgY29tbWFuZCIgb25jbGljaz0iZXZhbENvbW1hbmRMaW5lKCkiIC8+DQoJCQk8L2Rpdj4NCgkJPC9kaXY+DQoJPC9ib2R5Pg0KPC9odG1sPg0K",
                "body": "PCFET0NUWVBFIGh0bWwgUFVCTElDICItLy9XM0MvL0RURCBYSFRNTCAxLjAgU3RyaWN0Ly9FTiIgImh0dHA6Ly93d3cudzMub3JnL1RSL3hodG1sMS9EVEQveGh0bWwxLXN0cmljdC5kdGQiPg0KPGh0bWwgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiIGxhbmc9ImVuIiB4bWw6bGFuZz0iZW4iPg0KCTxoZWFkPg0KCQk8dGl0bGU+bG9nNGphdmFzY3JpcHQ8L3RpdGxlPg0KCQk8bWV0YSBodHRwLWVxdWl2PSJDb250ZW50LVR5cGUiIGNvbnRlbnQ9InRleHQvaHRtbDsgY2hhcnNldD11dGYtOCIgLz4NCgkJPCEtLSBNYWtlIElFOCBiZWhhdmUgbGlrZSBJRTcsIGhhdmluZyBnb25lIHRvIGFsbCB0aGUgdHJvdWJsZSBvZiBtYWtpbmcgSUUgd29yayAtLT4NCgkJPG1ldGEgaHR0cC1lcXVpdj0iWC1VQS1Db21wYXRpYmxlIiBjb250ZW50PSJJRT03IiAvPg0KCQk8c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCI+dmFyIGlzSWUgPSBmYWxzZSwgaXNJZVByZTcgPSBmYWxzZTs8L3NjcmlwdD4NCgkJPCEtLVtpZiBJRV0+PHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPmlzSWUgPSB0cnVlPC9zY3JpcHQ+PCFbZW5kaWZdLS0+DQoJCTwhLS1baWYgbHQgSUUgN10+PHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPmlzSWVQcmU3ID0gdHJ1ZTwvc2NyaXB0PjwhW2VuZGlmXS0tPg0KCQk8c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCI+DQoJCQkvLzwhW0NEQVRBWw0KCQkJdmFyIGxvZ2dpbmdFbmFibGVkID0gdHJ1ZTsNCgkJCXZhciBsb2dRdWV1ZWRFdmVudHNUaW1lciA9IG51bGw7DQoJCQl2YXIgbG9nRW50cmllcyA9IFtdOw0KCQkJdmFyIGxvZ0VudHJpZXNBbmRTZXBhcmF0b3JzID0gW107DQoJCQl2YXIgbG9nSXRlbXMgPSBbXTsNCgkJCXZhciByZW5kZXJEZWxheSA9IDEwMDsNCgkJCXZhciB1bnJlbmRlcmVkTG9nSXRlbXNFeGlzdCA9IGZhbHNlOw0KCQkJdmFyIHJvb3RHcm91cCwgY3VycmVudEdyb3VwID0gbnVsbDsNCgkJCXZhciBsb2FkZWQgPSBmYWxzZTsNCgkJCXZhciBjdXJyZW50TG9nSXRlbSA9IG51bGw7DQoJCQl2YXIgbG9nTWFpbkNvbnRhaW5lcjsNCg0KCQkJZnVuY3Rpb24gY29weVByb3BlcnRpZXMob2JqLCBwcm9wcykgew0KCQkJCWZvciAodmFyIGkgaW4gcHJvcHMpIHsNCgkJCQkJb2JqW2ldID0gcHJvcHNbaV07DQoJCQkJfQ0KCQkJfQ0KDQoJCQkvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLw0KDQoJCQlmdW5jdGlvbiBMb2dJdGVtKCkgew0KCQkJfQ0KDQoJCQlMb2dJdGVtLnByb3RvdHlwZSA9IHsNCgkJCQltYWluQ29udGFpbmVyOiBudWxsLA0KCQkJCXdyYXBwZWRDb250YWluZXI6IG51bGwsDQoJCQkJdW53cmFwcGVkQ29udGFpbmVyOiBudWxsLA0KCQkJCWdyb3VwOiBudWxsLA0KDQoJCQkJYXBwZW5kVG9Mb2c6IGZ1bmN0aW9uKCkgew0KCQkJCQlmb3IgKHZhciBpID0gMCwgbGVuID0gdGhpcy5lbGVtZW50Q29udGFpbmVycy5sZW5ndGg7IGkgPCBsZW47IGkrKykgew0KCQkJCQkJdGhpcy5lbGVtZW50Q29udGFpbmVyc1tpXS5hcHBlbmRUb0xvZygpOw0KCQkJCQl9DQoJCQkJCXRoaXMuZ3JvdXAudXBkYXRlKCk7DQoJCQkJfSwNCg0KCQkJCWRvUmVtb3ZlOiBmdW5jdGlvbihkb1VwZGF0ZSwgcmVtb3ZlRnJvbUdyb3VwKSB7DQoJCQkJCWlmICh0aGlzLnJlbmRlcmVkKSB7DQoJCQkJCQlmb3IgKHZhciBpID0gMCwgbGVuID0gdGhpcy5lbGVtZW50Q29udGFpbmVycy5sZW5ndGg7IGkgPCBsZW47IGkrKykgew0KCQkJCQkJCXRoaXMuZWxlbWVudENvbnRhaW5lcnNbaV0ucmVtb3ZlKCk7DQoJCQkJCQl9DQoJCQkJCQl0aGlzLnVud3JhcHBlZEVsZW1lbnRDb250YWluZXIgPSBudWxsOw0KCQkJCQkJdGhpcy53cmFwcGVkRWxlbWVudENvbnRhaW5lciA9IG51bGw7DQoJCQkJCQl0aGlzLm1haW5FbGVtZW50Q29udGFpbmVyID0gbnVsbDsNCgkJCQkJfQ0KCQkJCQlpZiAodGhpcy5ncm91cCAmJiByZW1vdmVGcm9tR3JvdXApIHsNCgkJCQkJCXRoaXMuZ3JvdXAucmVtb3ZlQ2hpbGQodGhpcywgZG9VcGRhdGUpOw0KCQkJCQl9DQoJCQkJCWlmICh0aGlzID09PSBjdXJyZW50TG9nSXRlbSkgew0KCQkJCQkJY3VycmVudExvZ0l0ZW0gPSBudWxsOw0KCQkJCQl9DQoJCQkJfSwNCg0KCQkJCXJlbW92ZTogZnVuY3Rpb24oZG9VcGRhdGUsIHJlbW92ZUZyb21Hcm91cCkgew0KCQkJCQl0aGlzLmRvUmVtb3ZlKGRvVXBkYXRlLCByZW1vdmVGcm9tR3JvdXApOw0KCQkJCX0sDQoNCgkJCQlyZW5kZXI6IGZ1bmN0aW9uKCkge30sDQoNCgkJCQlhY2NlcHQ6IGZ1bmN0aW9uKHZpc2l0b3IpIHsNCgkJCQkJdmlzaXRvci52aXNpdCh0aGlzKTsNCgkJCQl9LA0KDQoJCQkJZ2V0VW53cmFwcGVkRG9tQ29udGFpbmVyOiBmdW5jdGlvbigpIHsNCgkJCQkJcmV0dXJuIHRoaXMuZ3JvdXAudW53cmFwcGVkRWxlbWVudENvbnRhaW5lci5jb250ZW50RGl2Ow0KCQkJCX0sDQoNCgkJCQlnZXRXcmFwcGVkRG9tQ29udGFpbmVyOiBmdW5jdGlvbigpIHsNCgkJCQkJcmV0dXJuIHRoaXMuZ3JvdXAud3JhcHBlZEVsZW1lbnRDb250YWluZXIuY29udGVudERpdjsNCgkJCQl9LA0KDQoJCQkJZ2V0TWFpbkRvbUNvbnRhaW5lcjogZnVuY3Rpb24oKSB7DQoJCQkJCXJldHVybiB0aGlzLmdyb3VwLm1haW5FbGVtZW50Q29udGFpbmVyLmNvbnRlbnREaXY7DQoJCQkJfQ0KCQkJfTsNCg0KCQkJTG9nSXRlbS5zZXJpYWxpemVkSXRlbUtleXMgPSB7TE9HX0VOVFJZOiAwLCBHUk9VUF9TVEFSVDogMSwgR1JPVVBfRU5EOiAyfTsNCg0KCQkJLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8NCg0KCQkJZnVuY3Rpb24gTG9nSXRlbUNvbnRhaW5lckVsZW1lbnQoKSB7DQoJCQl9DQoNCgkJCUxvZ0l0ZW1Db250YWluZXJFbGVtZW50LnByb3RvdHlwZSA9IHsNCgkJCQlhcHBlbmRUb0xvZzogZnVuY3Rpb24oKSB7DQoJCQkJCXZhciBpbnNlcnRCZWZvcmVGaXJzdCA9IChuZXdlc3RBdFRvcCAmJiB0aGlzLmNvbnRhaW5lckRvbU5vZGUuaGFzQ2hpbGROb2RlcygpKTsNCgkJCQkJaWYgKGluc2VydEJlZm9yZUZpcnN0KSB7DQoJCQkJCQl0aGlzLmNvbnRhaW5lckRvbU5vZGUuaW5zZXJ0QmVmb3JlKHRoaXMubWFpbkRpdiwgdGhpcy5jb250YWluZXJEb21Ob2RlLmZpcnN0Q2hpbGQpOw0KCQkJCQl9IGVsc2Ugew0KCQkJCQkJdGhpcy5jb250YWluZXJEb21Ob2RlLmFwcGVuZENoaWxkKHRoaXMubWFpbkRpdik7DQoJCQkJCX0NCgkJCQl9DQoJCQl9Ow0KDQoJCQkvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLw0KDQoJCQlmdW5jdGlvbiBTZXBhcmF0b3JFbGVtZW50Q29udGFpbmVyKGNvbnRhaW5lckRvbU5vZGUpIHsNCgkJCQl0aGlzLmNvbnRhaW5lckRvbU5vZGUgPSBjb250YWluZXJEb21Ob2RlOw0KCQkJCXRoaXMubWFpbkRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOw0KCQkJCXRoaXMubWFpbkRpdi5jbGFzc05hbWUgPSAic2VwYXJhdG9yIjsNCgkJCQl0aGlzLm1haW5EaXYuaW5uZXJIVE1MID0gIiZuYnNwOyI7DQoJCQl9DQoNCgkJCVNlcGFyYXRvckVsZW1lbnRDb250YWluZXIucHJvdG90eXBlID0gbmV3IExvZ0l0ZW1Db250YWluZXJFbGVtZW50KCk7DQoNCgkJCVNlcGFyYXRvckVsZW1lbnRDb250YWluZXIucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uKCkgew0KCQkJCXRoaXMubWFpbkRpdi5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMubWFpbkRpdik7DQoJCQkJdGhpcy5tYWluRGl2ID0gbnVsbDsNCgkJCX07DQoNCgkJCS8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoNCgkJCWZ1bmN0aW9uIFNlcGFyYXRvcigpIHsNCgkJCQl0aGlzLnJlbmRlcmVkID0gZmFsc2U7DQoJCQl9DQoNCgkJCVNlcGFyYXRvci5wcm90b3R5cGUgPSBuZXcgTG9nSXRlbSgpOw0KDQoJCQljb3B5UHJvcGVydGllcyhTZXBhcmF0b3IucHJvdG90eXBlLCB7DQoJCQkJcmVuZGVyOiBmdW5jdGlvbigpIHsNCgkJCQkJdmFyIGNvbnRhaW5lckRvbU5vZGUgPSB0aGlzLmdyb3VwLmNvbnRlbnREaXY7DQoJCQkJCWlmIChpc0llKSB7DQoJCQkJCQl0aGlzLnVud3JhcHBlZEVsZW1lbnRDb250YWluZXIgPSBuZXcgU2VwYXJhdG9yRWxlbWVudENvbnRhaW5lcih0aGlzLmdldFVud3JhcHBlZERvbUNvbnRhaW5lcigpKTsNCgkJCQkJCXRoaXMud3JhcHBlZEVsZW1lbnRDb250YWluZXIgPSBuZXcgU2VwYXJhdG9yRWxlbWVudENvbnRhaW5lcih0aGlzLmdldFdyYXBwZWREb21Db250YWluZXIoKSk7DQoJCQkJCQl0aGlzLmVsZW1lbnRDb250YWluZXJzID0gW3RoaXMudW53cmFwcGVkRWxlbWVudENvbnRhaW5lciwgdGhpcy53cmFwcGVkRWxlbWVudENvbnRhaW5lcl07DQoJCQkJCX0gZWxzZSB7DQoJCQkJCQl0aGlzLm1haW5FbGVtZW50Q29udGFpbmVyID0gbmV3IFNlcGFyYXRvckVsZW1lbnRDb250YWluZXIodGhpcy5nZXRNYWluRG9tQ29udGFpbmVyKCkpOw0KCQkJCQkJdGhpcy5lbGVtZW50Q29udGFpbmVycyA9IFt0aGlzLm1haW5FbGVtZW50Q29udGFpbmVyXTsNCgkJCQkJfQ0KCQkJCQl0aGlzLmNvbnRlbnQgPSB0aGlzLmZvcm1hdHRlZE1lc3NhZ2U7DQoJCQkJCXRoaXMucmVuZGVyZWQgPSB0cnVlOw0KCQkJCX0NCgkJCX0pOw0KDQoJCQkvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLw0KDQoJCQlmdW5jdGlvbiBHcm91cEVsZW1lbnRDb250YWluZXIoZ3JvdXAsIGNvbnRhaW5lckRvbU5vZGUsIGlzUm9vdCwgaXNXcmFwcGVkKSB7DQoJCQkJdGhpcy5ncm91cCA9IGdyb3VwOw0KCQkJCXRoaXMuY29udGFpbmVyRG9tTm9kZSA9IGNvbnRhaW5lckRvbU5vZGU7DQoJCQkJdGhpcy5pc1Jvb3QgPSBpc1Jvb3Q7DQoJCQkJdGhpcy5pc1dyYXBwZWQgPSBpc1dyYXBwZWQ7DQoJCQkJdGhpcy5leHBhbmRhYmxlID0gZmFsc2U7DQoNCgkJCQlpZiAodGhpcy5pc1Jvb3QpIHsNCgkJCQkJaWYgKGlzSWUpIHsNCgkJCQkJCXRoaXMuY29udGVudERpdiA9IGxvZ01haW5Db250YWluZXIuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikpOw0KCQkJCQkJdGhpcy5jb250ZW50RGl2LmlkID0gdGhpcy5pc1dyYXBwZWQgPyAibG9nX3dyYXBwZWQiIDogImxvZ191bndyYXBwZWQiOw0KCQkJCQl9IGVsc2Ugew0KCQkJCQkJdGhpcy5jb250ZW50RGl2ID0gbG9nTWFpbkNvbnRhaW5lcjsNCgkJCQkJfQ0KCQkJCX0gZWxzZSB7DQoJCQkJCXZhciBncm91cEVsZW1lbnRDb250YWluZXIgPSB0aGlzOw0KCQkJCQkNCgkJCQkJdGhpcy5tYWluRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQoJCQkJCXRoaXMubWFpbkRpdi5jbGFzc05hbWUgPSAiZ3JvdXAiOw0KDQoJCQkJCXRoaXMuaGVhZGluZ0RpdiA9IHRoaXMubWFpbkRpdi5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKSk7DQoJCQkJCXRoaXMuaGVhZGluZ0Rpdi5jbGFzc05hbWUgPSAiZ3JvdXBoZWFkaW5nIjsNCg0KCQkJCQl0aGlzLmV4cGFuZGVyID0gdGhpcy5oZWFkaW5nRGl2LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNwYW4iKSk7DQoJCQkJCXRoaXMuZXhwYW5kZXIuY2xhc3NOYW1lID0gImV4cGFuZGVyIHVuc2VsZWN0YWJsZSBncmV5ZWRvdXQiOw0KCQkJCQl0aGlzLmV4cGFuZGVyLnVuc2VsZWN0YWJsZSA9IHRydWU7DQoJCQkJCXZhciBleHBhbmRlclRleHQgPSB0aGlzLmdyb3VwLmV4cGFuZGVkID8gIi0iIDogIisiOw0KCQkJCQl0aGlzLmV4cGFuZGVyVGV4dE5vZGUgPSB0aGlzLmV4cGFuZGVyLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGV4cGFuZGVyVGV4dCkpOw0KCQkJCQkNCgkJCQkJdGhpcy5oZWFkaW5nRGl2LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCIgIiArIHRoaXMuZ3JvdXAubmFtZSkpOw0KDQoJCQkJCXRoaXMuY29udGVudERpdiA9IHRoaXMubWFpbkRpdi5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKSk7DQoJCQkJCXZhciBjb250ZW50Q3NzQ2xhc3MgPSB0aGlzLmdyb3VwLmV4cGFuZGVkID8gImV4cGFuZGVkIiA6ICJjb2xsYXBzZWQiOw0KCQkJCQl0aGlzLmNvbnRlbnREaXYuY2xhc3NOYW1lID0gImdyb3VwY29udGVudCAiICsgY29udGVudENzc0NsYXNzOw0KDQoJCQkJCXRoaXMuZXhwYW5kZXIub25jbGljayA9IGZ1bmN0aW9uKCkgew0KCQkJCQkJaWYgKGdyb3VwRWxlbWVudENvbnRhaW5lci5ncm91cC5leHBhbmRhYmxlKSB7DQoJCQkJCQkJZ3JvdXBFbGVtZW50Q29udGFpbmVyLmdyb3VwLnRvZ2dsZUV4cGFuZGVkKCk7DQoJCQkJCQl9DQoJCQkJCX07DQoJCQkJfQ0KCQkJfQ0KDQoJCQlHcm91cEVsZW1lbnRDb250YWluZXIucHJvdG90eXBlID0gbmV3IExvZ0l0ZW1Db250YWluZXJFbGVtZW50KCk7DQoNCgkJCWNvcHlQcm9wZXJ0aWVzKEdyb3VwRWxlbWVudENvbnRhaW5lci5wcm90b3R5cGUsIHsNCgkJCQl0b2dnbGVFeHBhbmRlZDogZnVuY3Rpb24oKSB7DQoJCQkJCWlmICghdGhpcy5pc1Jvb3QpIHsNCgkJCQkJCXZhciBvbGRDc3NDbGFzcywgbmV3Q3NzQ2xhc3MsIGV4cGFuZGVyVGV4dDsNCgkJCQkJCWlmICh0aGlzLmdyb3VwLmV4cGFuZGVkKSB7DQoJCQkJCQkJbmV3Q3NzQ2xhc3MgPSAiZXhwYW5kZWQiOw0KCQkJCQkJCW9sZENzc0NsYXNzID0gImNvbGxhcHNlZCI7DQoJCQkJCQkJZXhwYW5kZXJUZXh0ID0gIi0iOw0KCQkJCQkJfSBlbHNlIHsNCgkJCQkJCQluZXdDc3NDbGFzcyA9ICJjb2xsYXBzZWQiOw0KCQkJCQkJCW9sZENzc0NsYXNzID0gImV4cGFuZGVkIjsNCgkJCQkJCQlleHBhbmRlclRleHQgPSAiKyI7DQoJCQkJCQl9DQoJCQkJCQlyZXBsYWNlQ2xhc3ModGhpcy5jb250ZW50RGl2LCBuZXdDc3NDbGFzcywgb2xkQ3NzQ2xhc3MpOw0KCQkJCQkJdGhpcy5leHBhbmRlclRleHROb2RlLm5vZGVWYWx1ZSA9IGV4cGFuZGVyVGV4dDsNCgkJCQkJfQ0KCQkJCX0sDQoNCgkJCQlyZW1vdmU6IGZ1bmN0aW9uKCkgew0KCQkJCQlpZiAoIXRoaXMuaXNSb290KSB7DQoJCQkJCQl0aGlzLmhlYWRpbmdEaXYgPSBudWxsOw0KCQkJCQkJdGhpcy5leHBhbmRlci5vbmNsaWNrID0gbnVsbDsNCgkJCQkJCXRoaXMuZXhwYW5kZXIgPSBudWxsOw0KCQkJCQkJdGhpcy5leHBhbmRlclRleHROb2RlID0gbnVsbDsNCgkJCQkJCXRoaXMuY29udGVudERpdiA9IG51bGw7DQoJCQkJCQl0aGlzLmNvbnRhaW5lckRvbU5vZGUgPSBudWxsOw0KCQkJCQkJdGhpcy5tYWluRGl2LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5tYWluRGl2KTsNCgkJCQkJCXRoaXMubWFpbkRpdiA9IG51bGw7DQoJCQkJCX0NCgkJCQl9LA0KDQoJCQkJcmV2ZXJzZUNoaWxkcmVuOiBmdW5jdGlvbigpIHsNCgkJCQkJLy8gSW52ZXJ0IHRoZSBvcmRlciBvZiB0aGUgbG9nIGVudHJpZXMNCgkJCQkJdmFyIG5vZGUgPSBudWxsOw0KDQoJCQkJCS8vIFJlbW92ZSBhbGwgdGhlIGxvZyBjb250YWluZXIgbm9kZXMNCgkJCQkJdmFyIGNoaWxkRG9tTm9kZXMgPSBbXTsNCgkJCQkJd2hpbGUgKChub2RlID0gdGhpcy5jb250ZW50RGl2LmZpcnN0Q2hpbGQpKSB7DQoJCQkJCQl0aGlzLmNvbnRlbnREaXYucmVtb3ZlQ2hpbGQobm9kZSk7DQoJCQkJCQljaGlsZERvbU5vZGVzLnB1c2gobm9kZSk7DQoJCQkJCX0NCg0KCQkJCQkvLyBQdXQgdGhlbSBhbGwgYmFjayBpbiByZXZlcnNlIG9yZGVyDQoJCQkJCXdoaWxlICgobm9kZSA9IGNoaWxkRG9tTm9kZXMucG9wKCkpKSB7DQoJCQkJCQl0aGlzLmNvbnRlbnREaXYuYXBwZW5kQ2hpbGQobm9kZSk7DQoJCQkJCX0NCgkJCQl9LA0KDQoJCQkJdXBkYXRlOiBmdW5jdGlvbigpIHsNCgkJCQkJaWYgKCF0aGlzLmlzUm9vdCkgew0KCQkJCQkJaWYgKHRoaXMuZ3JvdXAuZXhwYW5kYWJsZSkgew0KCQkJCQkJCXJlbW92ZUNsYXNzKHRoaXMuZXhwYW5kZXIsICJncmV5ZWRvdXQiKTsNCgkJCQkJCX0gZWxzZSB7DQoJCQkJCQkJYWRkQ2xhc3ModGhpcy5leHBhbmRlciwgImdyZXllZG91dCIpOw0KCQkJCQkJfQ0KCQkJCQl9DQoJCQkJfSwNCg0KCQkJCWNsZWFyOiBmdW5jdGlvbigpIHsNCgkJCQkJaWYgKHRoaXMuaXNSb290KSB7DQoJCQkJCQl0aGlzLmNvbnRlbnREaXYuaW5uZXJIVE1MID0gIiI7DQoJCQkJCX0NCgkJCQl9DQoJCQl9KTsNCg0KCQkJLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8NCg0KCQkJZnVuY3Rpb24gR3JvdXAobmFtZSwgaXNSb290LCBpbml0aWFsbHlFeHBhbmRlZCkgew0KCQkJCXRoaXMubmFtZSA9IG5hbWU7DQoJCQkJdGhpcy5ncm91cCA9IG51bGw7DQoJCQkJdGhpcy5pc1Jvb3QgPSBpc1Jvb3Q7DQoJCQkJdGhpcy5pbml0aWFsbHlFeHBhbmRlZCA9IGluaXRpYWxseUV4cGFuZGVkOw0KCQkJCXRoaXMuZWxlbWVudENvbnRhaW5lcnMgPSBbXTsNCgkJCQl0aGlzLmNoaWxkcmVuID0gW107DQoJCQkJdGhpcy5leHBhbmRlZCA9IGluaXRpYWxseUV4cGFuZGVkOw0KCQkJCXRoaXMucmVuZGVyZWQgPSBmYWxzZTsNCgkJCQl0aGlzLmV4cGFuZGFibGUgPSBmYWxzZTsNCgkJCX0NCg0KCQkJR3JvdXAucHJvdG90eXBlID0gbmV3IExvZ0l0ZW0oKTsNCg0KCQkJY29weVByb3BlcnRpZXMoR3JvdXAucHJvdG90eXBlLCB7DQoJCQkJYWRkQ2hpbGQ6IGZ1bmN0aW9uKGxvZ0l0ZW0pIHsNCgkJCQkJdGhpcy5jaGlsZHJlbi5wdXNoKGxvZ0l0ZW0pOw0KCQkJCQlsb2dJdGVtLmdyb3VwID0gdGhpczsNCgkJCQl9LA0KDQoJCQkJcmVuZGVyOiBmdW5jdGlvbigpIHsNCgkJCQkJaWYgKGlzSWUpIHsNCgkJCQkJCXZhciB1bndyYXBwZWREb21Db250YWluZXIsIHdyYXBwZWREb21Db250YWluZXI7DQoJCQkJCQlpZiAodGhpcy5pc1Jvb3QpIHsNCgkJCQkJCQl1bndyYXBwZWREb21Db250YWluZXIgPSBsb2dNYWluQ29udGFpbmVyOw0KCQkJCQkJCXdyYXBwZWREb21Db250YWluZXIgPSBsb2dNYWluQ29udGFpbmVyOw0KCQkJCQkJfSBlbHNlIHsNCgkJCQkJCQl1bndyYXBwZWREb21Db250YWluZXIgPSB0aGlzLmdldFVud3JhcHBlZERvbUNvbnRhaW5lcigpOw0KCQkJCQkJCXdyYXBwZWREb21Db250YWluZXIgPSB0aGlzLmdldFdyYXBwZWREb21Db250YWluZXIoKTsNCgkJCQkJCX0NCgkJCQkJCXRoaXMudW53cmFwcGVkRWxlbWVudENvbnRhaW5lciA9IG5ldyBHcm91cEVsZW1lbnRDb250YWluZXIodGhpcywgdW53cmFwcGVkRG9tQ29udGFpbmVyLCB0aGlzLmlzUm9vdCwgZmFsc2UpOw0KCQkJCQkJdGhpcy53cmFwcGVkRWxlbWVudENvbnRhaW5lciA9IG5ldyBHcm91cEVsZW1lbnRDb250YWluZXIodGhpcywgd3JhcHBlZERvbUNvbnRhaW5lciwgdGhpcy5pc1Jvb3QsIHRydWUpOw0KCQkJCQkJdGhpcy5lbGVtZW50Q29udGFpbmVycyA9IFt0aGlzLnVud3JhcHBlZEVsZW1lbnRDb250YWluZXIsIHRoaXMud3JhcHBlZEVsZW1lbnRDb250YWluZXJdOw0KCQkJCQl9IGVsc2Ugew0KCQkJCQkJdmFyIG1haW5Eb21Db250YWluZXIgPSB0aGlzLmlzUm9vdCA/IGxvZ01haW5Db250YWluZXIgOiB0aGlzLmdldE1haW5Eb21Db250YWluZXIoKTsNCgkJCQkJCXRoaXMubWFpbkVsZW1lbnRDb250YWluZXIgPSBuZXcgR3JvdXBFbGVtZW50Q29udGFpbmVyKHRoaXMsIG1haW5Eb21Db250YWluZXIsIHRoaXMuaXNSb290LCBmYWxzZSk7DQoJCQkJCQl0aGlzLmVsZW1lbnRDb250YWluZXJzID0gW3RoaXMubWFpbkVsZW1lbnRDb250YWluZXJdOw0KCQkJCQl9DQoJCQkJCXRoaXMucmVuZGVyZWQgPSB0cnVlOw0KCQkJCX0sDQoNCgkJCQl0b2dnbGVFeHBhbmRlZDogZnVuY3Rpb24oKSB7DQoJCQkJCXRoaXMuZXhwYW5kZWQgPSAhdGhpcy5leHBhbmRlZDsNCgkJCQkJZm9yICh2YXIgaSA9IDAsIGxlbiA9IHRoaXMuZWxlbWVudENvbnRhaW5lcnMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsNCgkJCQkJCXRoaXMuZWxlbWVudENvbnRhaW5lcnNbaV0udG9nZ2xlRXhwYW5kZWQoKTsNCgkJCQkJfQ0KCQkJCX0sDQoNCgkJCQlleHBhbmQ6IGZ1bmN0aW9uKCkgew0KCQkJCQlpZiAoIXRoaXMuZXhwYW5kZWQpIHsNCgkJCQkJCXRoaXMudG9nZ2xlRXhwYW5kZWQoKTsNCgkJCQkJfQ0KCQkJCX0sDQoNCgkJCQlhY2NlcHQ6IGZ1bmN0aW9uKHZpc2l0b3IpIHsNCgkJCQkJdmlzaXRvci52aXNpdEdyb3VwKHRoaXMpOw0KCQkJCX0sDQoNCgkJCQlyZXZlcnNlQ2hpbGRyZW46IGZ1bmN0aW9uKCkgew0KCQkJCQlpZiAodGhpcy5yZW5kZXJlZCkgew0KCQkJCQkJZm9yICh2YXIgaSA9IDAsIGxlbiA9IHRoaXMuZWxlbWVudENvbnRhaW5lcnMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsNCgkJCQkJCQl0aGlzLmVsZW1lbnRDb250YWluZXJzW2ldLnJldmVyc2VDaGlsZHJlbigpOw0KCQkJCQkJfQ0KCQkJCQl9DQoJCQkJfSwNCg0KCQkJCXVwZGF0ZTogZnVuY3Rpb24oKSB7DQoJCQkJCXZhciBwcmV2aW91c2x5RXhwYW5kYWJsZSA9IHRoaXMuZXhwYW5kYWJsZTsNCgkJCQkJdGhpcy5leHBhbmRhYmxlID0gKHRoaXMuY2hpbGRyZW4ubGVuZ3RoICE9PSAwKTsNCgkJCQkJaWYgKHRoaXMuZXhwYW5kYWJsZSAhPT0gcHJldmlvdXNseUV4cGFuZGFibGUpIHsNCgkJCQkJCWZvciAodmFyIGkgPSAwLCBsZW4gPSB0aGlzLmVsZW1lbnRDb250YWluZXJzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7DQoJCQkJCQkJdGhpcy5lbGVtZW50Q29udGFpbmVyc1tpXS51cGRhdGUoKTsNCgkJCQkJCX0NCgkJCQkJfQ0KCQkJCX0sDQoNCgkJCQlmbGF0dGVuOiBmdW5jdGlvbigpIHsNCgkJCQkJdmFyIHZpc2l0b3IgPSBuZXcgR3JvdXBGbGF0dGVuZXIoKTsNCgkJCQkJdGhpcy5hY2NlcHQodmlzaXRvcik7DQoJCQkJCXJldHVybiB2aXNpdG9yLmxvZ0VudHJpZXNBbmRTZXBhcmF0b3JzOw0KCQkJCX0sDQoNCgkJCQlyZW1vdmVDaGlsZDogZnVuY3Rpb24oY2hpbGQsIGRvVXBkYXRlKSB7DQoJCQkJCWFycmF5X3JlbW92ZSh0aGlzLmNoaWxkcmVuLCBjaGlsZCk7DQoJCQkJCWNoaWxkLmdyb3VwID0gbnVsbDsNCgkJCQkJaWYgKGRvVXBkYXRlKSB7DQoJCQkJCQl0aGlzLnVwZGF0ZSgpOw0KCQkJCQl9DQoJCQkJfSwNCg0KCQkJCXJlbW92ZTogZnVuY3Rpb24oZG9VcGRhdGUsIHJlbW92ZUZyb21Hcm91cCkgew0KCQkJCQlmb3IgKHZhciBpID0gMCwgbGVuID0gdGhpcy5jaGlsZHJlbi5sZW5ndGg7IGkgPCBsZW47IGkrKykgew0KCQkJCQkJdGhpcy5jaGlsZHJlbltpXS5yZW1vdmUoZmFsc2UsIGZhbHNlKTsNCgkJCQkJfQ0KCQkJCQl0aGlzLmNoaWxkcmVuID0gW107DQoJCQkJCXRoaXMudXBkYXRlKCk7DQoJCQkJCWlmICh0aGlzID09PSBjdXJyZW50R3JvdXApIHsNCgkJCQkJCWN1cnJlbnRHcm91cCA9IHRoaXMuZ3JvdXA7DQoJCQkJCX0NCgkJCQkJdGhpcy5kb1JlbW92ZShkb1VwZGF0ZSwgcmVtb3ZlRnJvbUdyb3VwKTsNCgkJCQl9LA0KDQoJCQkJc2VyaWFsaXplOiBmdW5jdGlvbihpdGVtcykgew0KCQkJCQlpdGVtcy5wdXNoKFtMb2dJdGVtLnNlcmlhbGl6ZWRJdGVtS2V5cy5HUk9VUF9TVEFSVCwgdGhpcy5uYW1lXSk7DQoJCQkJCWZvciAodmFyIGkgPSAwLCBsZW4gPSB0aGlzLmNoaWxkcmVuLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7DQoJCQkJCQl0aGlzLmNoaWxkcmVuW2ldLnNlcmlhbGl6ZShpdGVtcyk7DQoJCQkJCX0NCgkJCQkJaWYgKHRoaXMgIT09IGN1cnJlbnRHcm91cCkgew0KCQkJCQkJaXRlbXMucHVzaChbTG9nSXRlbS5zZXJpYWxpemVkSXRlbUtleXMuR1JPVVBfRU5EXSk7DQoJCQkJCX0NCgkJCQl9LA0KDQoJCQkJY2xlYXI6IGZ1bmN0aW9uKCkgew0KCQkJCQlmb3IgKHZhciBpID0gMCwgbGVuID0gdGhpcy5lbGVtZW50Q29udGFpbmVycy5sZW5ndGg7IGkgPCBsZW47IGkrKykgew0KCQkJCQkJdGhpcy5lbGVtZW50Q29udGFpbmVyc1tpXS5jbGVhcigpOw0KCQkJCQl9DQoJCQkJfQ0KCQkJfSk7DQoNCgkJCS8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoNCgkJCWZ1bmN0aW9uIExvZ0VudHJ5RWxlbWVudENvbnRhaW5lcigpIHsNCgkJCX0NCg0KCQkJTG9nRW50cnlFbGVtZW50Q29udGFpbmVyLnByb3RvdHlwZSA9IG5ldyBMb2dJdGVtQ29udGFpbmVyRWxlbWVudCgpOw0KDQoJCQljb3B5UHJvcGVydGllcyhMb2dFbnRyeUVsZW1lbnRDb250YWluZXIucHJvdG90eXBlLCB7DQoJCQkJcmVtb3ZlOiBmdW5jdGlvbigpIHsNCgkJCQkJdGhpcy5kb1JlbW92ZSgpOw0KCQkJCX0sDQoNCgkJCQlkb1JlbW92ZTogZnVuY3Rpb24oKSB7DQoJCQkJCXRoaXMubWFpbkRpdi5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMubWFpbkRpdik7DQoJCQkJCXRoaXMubWFpbkRpdiA9IG51bGw7DQoJCQkJCXRoaXMuY29udGVudEVsZW1lbnQgPSBudWxsOw0KCQkJCQl0aGlzLmNvbnRhaW5lckRvbU5vZGUgPSBudWxsOw0KCQkJCX0sDQoNCgkJCQlzZXRDb250ZW50OiBmdW5jdGlvbihjb250ZW50LCB3cmFwcGVkQ29udGVudCkgew0KCQkJCQlpZiAoY29udGVudCA9PT0gdGhpcy5mb3JtYXR0ZWRNZXNzYWdlKSB7DQoJCQkJCQl0aGlzLmNvbnRlbnRFbGVtZW50LmlubmVySFRNTCA9ICIiOw0KCQkJCQkJdGhpcy5jb250ZW50RWxlbWVudC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh0aGlzLmZvcm1hdHRlZE1lc3NhZ2UpKTsNCgkJCQkJfSBlbHNlIHsNCgkJCQkJCXRoaXMuY29udGVudEVsZW1lbnQuaW5uZXJIVE1MID0gY29udGVudDsNCgkJCQkJfQ0KCQkJCX0sDQoNCgkJCQlzZXRTZWFyY2hNYXRjaDogZnVuY3Rpb24oaXNNYXRjaCkgew0KCQkJCQl2YXIgb2xkQ3NzQ2xhc3MgPSBpc01hdGNoID8gInNlYXJjaG5vbm1hdGNoIiA6ICJzZWFyY2htYXRjaCI7DQoJCQkJCXZhciBuZXdDc3NDbGFzcyA9IGlzTWF0Y2ggPyAic2VhcmNobWF0Y2giIDogInNlYXJjaG5vbm1hdGNoIjsNCgkJCQkJcmVwbGFjZUNsYXNzKHRoaXMubWFpbkRpdiwgbmV3Q3NzQ2xhc3MsIG9sZENzc0NsYXNzKTsNCgkJCQl9LA0KDQoJCQkJY2xlYXJTZWFyY2g6IGZ1bmN0aW9uKCkgew0KCQkJCQlyZW1vdmVDbGFzcyh0aGlzLm1haW5EaXYsICJzZWFyY2htYXRjaCIpOw0KCQkJCQlyZW1vdmVDbGFzcyh0aGlzLm1haW5EaXYsICJzZWFyY2hub25tYXRjaCIpOw0KCQkJCX0NCgkJCX0pOw0KDQoJCQkvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLw0KDQoJCQlmdW5jdGlvbiBMb2dFbnRyeVdyYXBwZWRFbGVtZW50Q29udGFpbmVyKGxvZ0VudHJ5LCBjb250YWluZXJEb21Ob2RlKSB7DQoJCQkJdGhpcy5sb2dFbnRyeSA9IGxvZ0VudHJ5Ow0KCQkJCXRoaXMuY29udGFpbmVyRG9tTm9kZSA9IGNvbnRhaW5lckRvbU5vZGU7DQoJCQkJdGhpcy5tYWluRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQoJCQkJdGhpcy5tYWluRGl2LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHRoaXMubG9nRW50cnkuZm9ybWF0dGVkTWVzc2FnZSkpOw0KCQkJCXRoaXMubWFpbkRpdi5jbGFzc05hbWUgPSAibG9nZW50cnkgd3JhcHBlZCAiICsgdGhpcy5sb2dFbnRyeS5sZXZlbDsNCgkJCQl0aGlzLmNvbnRlbnRFbGVtZW50ID0gdGhpcy5tYWluRGl2Ow0KCQkJfQ0KDQoJCQlMb2dFbnRyeVdyYXBwZWRFbGVtZW50Q29udGFpbmVyLnByb3RvdHlwZSA9IG5ldyBMb2dFbnRyeUVsZW1lbnRDb250YWluZXIoKTsNCg0KCQkJTG9nRW50cnlXcmFwcGVkRWxlbWVudENvbnRhaW5lci5wcm90b3R5cGUuc2V0Q29udGVudCA9IGZ1bmN0aW9uKGNvbnRlbnQsIHdyYXBwZWRDb250ZW50KSB7DQoJCQkJaWYgKGNvbnRlbnQgPT09IHRoaXMuZm9ybWF0dGVkTWVzc2FnZSkgew0KCQkJCQl0aGlzLmNvbnRlbnRFbGVtZW50LmlubmVySFRNTCA9ICIiOw0KCQkJCQl0aGlzLmNvbnRlbnRFbGVtZW50LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHRoaXMuZm9ybWF0dGVkTWVzc2FnZSkpOw0KCQkJCX0gZWxzZSB7DQoJCQkJCXRoaXMuY29udGVudEVsZW1lbnQuaW5uZXJIVE1MID0gd3JhcHBlZENvbnRlbnQ7DQoJCQkJfQ0KCQkJfTsNCg0KCQkJLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8NCg0KCQkJZnVuY3Rpb24gTG9nRW50cnlVbndyYXBwZWRFbGVtZW50Q29udGFpbmVyKGxvZ0VudHJ5LCBjb250YWluZXJEb21Ob2RlKSB7DQoJCQkJdGhpcy5sb2dFbnRyeSA9IGxvZ0VudHJ5Ow0KCQkJCXRoaXMuY29udGFpbmVyRG9tTm9kZSA9IGNvbnRhaW5lckRvbU5vZGU7DQoJCQkJdGhpcy5tYWluRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQoJCQkJdGhpcy5tYWluRGl2LmNsYXNzTmFtZSA9ICJsb2dlbnRyeSB1bndyYXBwZWQgIiArIHRoaXMubG9nRW50cnkubGV2ZWw7DQoJCQkJdGhpcy5wcmUgPSB0aGlzLm1haW5EaXYuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgicHJlIikpOw0KCQkJCXRoaXMucHJlLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHRoaXMubG9nRW50cnkuZm9ybWF0dGVkTWVzc2FnZSkpOw0KCQkJCXRoaXMucHJlLmNsYXNzTmFtZSA9ICJ1bndyYXBwZWQiOw0KCQkJCXRoaXMuY29udGVudEVsZW1lbnQgPSB0aGlzLnByZTsNCgkJCX0NCg0KCQkJTG9nRW50cnlVbndyYXBwZWRFbGVtZW50Q29udGFpbmVyLnByb3RvdHlwZSA9IG5ldyBMb2dFbnRyeUVsZW1lbnRDb250YWluZXIoKTsNCg0KCQkJTG9nRW50cnlVbndyYXBwZWRFbGVtZW50Q29udGFpbmVyLnByb3RvdHlwZS5yZW1vdmUgPSBmdW5jdGlvbigpIHsNCgkJCQl0aGlzLmRvUmVtb3ZlKCk7DQoJCQkJdGhpcy5wcmUgPSBudWxsOw0KCQkJfTsNCg0KCQkJLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8NCg0KCQkJZnVuY3Rpb24gTG9nRW50cnlNYWluRWxlbWVudENvbnRhaW5lcihsb2dFbnRyeSwgY29udGFpbmVyRG9tTm9kZSkgew0KCQkJCXRoaXMubG9nRW50cnkgPSBsb2dFbnRyeTsNCgkJCQl0aGlzLmNvbnRhaW5lckRvbU5vZGUgPSBjb250YWluZXJEb21Ob2RlOw0KCQkJCXRoaXMubWFpbkRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOw0KCQkJCXRoaXMubWFpbkRpdi5jbGFzc05hbWUgPSAibG9nZW50cnkgbm9uaWVsb2dlbnRyeSAiICsgdGhpcy5sb2dFbnRyeS5sZXZlbDsNCgkJCQl0aGlzLmNvbnRlbnRFbGVtZW50ID0gdGhpcy5tYWluRGl2LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNwYW4iKSk7DQoJCQkJdGhpcy5jb250ZW50RWxlbWVudC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh0aGlzLmxvZ0VudHJ5LmZvcm1hdHRlZE1lc3NhZ2UpKTsNCgkJCX0NCg0KCQkJTG9nRW50cnlNYWluRWxlbWVudENvbnRhaW5lci5wcm90b3R5cGUgPSBuZXcgTG9nRW50cnlFbGVtZW50Q29udGFpbmVyKCk7DQoNCgkJCS8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoNCgkJCWZ1bmN0aW9uIExvZ0VudHJ5KGxldmVsLCBmb3JtYXR0ZWRNZXNzYWdlKSB7DQoJCQkJdGhpcy5sZXZlbCA9IGxldmVsOw0KCQkJCXRoaXMuZm9ybWF0dGVkTWVzc2FnZSA9IGZvcm1hdHRlZE1lc3NhZ2U7DQoJCQkJdGhpcy5yZW5kZXJlZCA9IGZhbHNlOw0KCQkJfQ0KDQoJCQlMb2dFbnRyeS5wcm90b3R5cGUgPSBuZXcgTG9nSXRlbSgpOw0KDQoJCQljb3B5UHJvcGVydGllcyhMb2dFbnRyeS5wcm90b3R5cGUsIHsNCgkJCQlyZW5kZXI6IGZ1bmN0aW9uKCkgew0KCQkJCQl2YXIgbG9nRW50cnkgPSB0aGlzOw0KCQkJCQl2YXIgY29udGFpbmVyRG9tTm9kZSA9IHRoaXMuZ3JvdXAuY29udGVudERpdjsNCg0KCQkJCQkvLyBTdXBwb3J0IGZvciB0aGUgQ1NTIGF0dHJpYnV0ZSB3aGl0ZS1zcGFjZSBpbiBJRSBmb3IgV2luZG93cyBpcw0KCQkJCQkvLyBub24tZXhpc3RlbnQgcHJlIHZlcnNpb24gNiBhbmQgc2xpZ2h0bHkgb2RkIGluIDYsIHNvIGluc3RlYWQNCgkJCQkJLy8gdXNlIHR3byBkaWZmZXJlbnQgSFRNTCBlbGVtZW50cw0KCQkJCQlpZiAoaXNJZSkgew0KCQkJCQkJdGhpcy5mb3JtYXR0ZWRNZXNzYWdlID0gdGhpcy5mb3JtYXR0ZWRNZXNzYWdlLnJlcGxhY2UoL1xyXG4vZywgIlxyIik7IC8vIFdvcmthcm91bmQgZm9yIElFJ3MgdHJlYXRtZW50IG9mIHdoaXRlIHNwYWNlDQoJCQkJCQl0aGlzLnVud3JhcHBlZEVsZW1lbnRDb250YWluZXIgPSBuZXcgTG9nRW50cnlVbndyYXBwZWRFbGVtZW50Q29udGFpbmVyKHRoaXMsIHRoaXMuZ2V0VW53cmFwcGVkRG9tQ29udGFpbmVyKCkpOw0KCQkJCQkJdGhpcy53cmFwcGVkRWxlbWVudENvbnRhaW5lciA9IG5ldyBMb2dFbnRyeVdyYXBwZWRFbGVtZW50Q29udGFpbmVyKHRoaXMsIHRoaXMuZ2V0V3JhcHBlZERvbUNvbnRhaW5lcigpKTsNCgkJCQkJCXRoaXMuZWxlbWVudENvbnRhaW5lcnMgPSBbdGhpcy51bndyYXBwZWRFbGVtZW50Q29udGFpbmVyLCB0aGlzLndyYXBwZWRFbGVtZW50Q29udGFpbmVyXTsNCgkJCQkJfSBlbHNlIHsNCgkJCQkJCXRoaXMubWFpbkVsZW1lbnRDb250YWluZXIgPSBuZXcgTG9nRW50cnlNYWluRWxlbWVudENvbnRhaW5lcih0aGlzLCB0aGlzLmdldE1haW5Eb21Db250YWluZXIoKSk7DQoJCQkJCQl0aGlzLmVsZW1lbnRDb250YWluZXJzID0gW3RoaXMubWFpbkVsZW1lbnRDb250YWluZXJdOw0KCQkJCQl9DQoJCQkJCXRoaXMuY29udGVudCA9IHRoaXMuZm9ybWF0dGVkTWVzc2FnZTsNCgkJCQkJdGhpcy5yZW5kZXJlZCA9IHRydWU7DQoJCQkJfSwNCg0KCQkJCXNldENvbnRlbnQ6IGZ1bmN0aW9uKGNvbnRlbnQsIHdyYXBwZWRDb250ZW50KSB7DQoJCQkJCWlmIChjb250ZW50ICE9IHRoaXMuY29udGVudCkgew0KCQkJCQkJaWYgKGlzSWUgJiYgKGNvbnRlbnQgIT09IHRoaXMuZm9ybWF0dGVkTWVzc2FnZSkpIHsNCgkJCQkJCQljb250ZW50ID0gY29udGVudC5yZXBsYWNlKC9cclxuL2csICJcciIpOyAvLyBXb3JrYXJvdW5kIGZvciBJRSdzIHRyZWF0bWVudCBvZiB3aGl0ZSBzcGFjZQ0KCQkJCQkJfQ0KCQkJCQkJZm9yICh2YXIgaSA9IDAsIGxlbiA9IHRoaXMuZWxlbWVudENvbnRhaW5lcnMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsNCgkJCQkJCQl0aGlzLmVsZW1lbnRDb250YWluZXJzW2ldLnNldENvbnRlbnQoY29udGVudCwgd3JhcHBlZENvbnRlbnQpOw0KCQkJCQkJfQ0KCQkJCQkJdGhpcy5jb250ZW50ID0gY29udGVudDsNCgkJCQkJfQ0KCQkJCX0sDQoNCgkJCQlnZXRTZWFyY2hNYXRjaGVzOiBmdW5jdGlvbigpIHsNCgkJCQkJdmFyIG1hdGNoZXMgPSBbXTsNCgkJCQkJdmFyIGksIGxlbjsNCgkJCQkJaWYgKGlzSWUpIHsNCgkJCQkJCXZhciB1bndyYXBwZWRFbHMgPSBnZXRFbGVtZW50c0J5Q2xhc3ModGhpcy51bndyYXBwZWRFbGVtZW50Q29udGFpbmVyLm1haW5EaXYsICJzZWFyY2h0ZXJtIiwgInNwYW4iKTsNCgkJCQkJCXZhciB3cmFwcGVkRWxzID0gZ2V0RWxlbWVudHNCeUNsYXNzKHRoaXMud3JhcHBlZEVsZW1lbnRDb250YWluZXIubWFpbkRpdiwgInNlYXJjaHRlcm0iLCAic3BhbiIpOw0KCQkJCQkJZm9yIChpID0gMCwgbGVuID0gdW53cmFwcGVkRWxzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7DQoJCQkJCQkJbWF0Y2hlc1tpXSA9IG5ldyBNYXRjaCh0aGlzLmxldmVsLCBudWxsLCB1bndyYXBwZWRFbHNbaV0sIHdyYXBwZWRFbHNbaV0pOw0KCQkJCQkJfQ0KCQkJCQl9IGVsc2Ugew0KCQkJCQkJdmFyIGVscyA9IGdldEVsZW1lbnRzQnlDbGFzcyh0aGlzLm1haW5FbGVtZW50Q29udGFpbmVyLm1haW5EaXYsICJzZWFyY2h0ZXJtIiwgInNwYW4iKTsNCgkJCQkJCWZvciAoaSA9IDAsIGxlbiA9IGVscy5sZW5ndGg7IGkgPCBsZW47IGkrKykgew0KCQkJCQkJCW1hdGNoZXNbaV0gPSBuZXcgTWF0Y2godGhpcy5sZXZlbCwgZWxzW2ldKTsNCgkJCQkJCX0NCgkJCQkJfQ0KCQkJCQlyZXR1cm4gbWF0Y2hlczsNCgkJCQl9LA0KDQoJCQkJc2V0U2VhcmNoTWF0Y2g6IGZ1bmN0aW9uKGlzTWF0Y2gpIHsNCgkJCQkJZm9yICh2YXIgaSA9IDAsIGxlbiA9IHRoaXMuZWxlbWVudENvbnRhaW5lcnMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsNCgkJCQkJCXRoaXMuZWxlbWVudENvbnRhaW5lcnNbaV0uc2V0U2VhcmNoTWF0Y2goaXNNYXRjaCk7DQoJCQkJCX0NCgkJCQl9LA0KDQoJCQkJY2xlYXJTZWFyY2g6IGZ1bmN0aW9uKCkgew0KCQkJCQlmb3IgKHZhciBpID0gMCwgbGVuID0gdGhpcy5lbGVtZW50Q29udGFpbmVycy5sZW5ndGg7IGkgPCBsZW47IGkrKykgew0KCQkJCQkJdGhpcy5lbGVtZW50Q29udGFpbmVyc1tpXS5jbGVhclNlYXJjaCgpOw0KCQkJCQl9DQoJCQkJfSwNCg0KCQkJCWFjY2VwdDogZnVuY3Rpb24odmlzaXRvcikgew0KCQkJCQl2aXNpdG9yLnZpc2l0TG9nRW50cnkodGhpcyk7DQoJCQkJfSwNCg0KCQkJCXNlcmlhbGl6ZTogZnVuY3Rpb24oaXRlbXMpIHsNCgkJCQkJaXRlbXMucHVzaChbTG9nSXRlbS5zZXJpYWxpemVkSXRlbUtleXMuTE9HX0VOVFJZLCB0aGlzLmxldmVsLCB0aGlzLmZvcm1hdHRlZE1lc3NhZ2VdKTsNCgkJCQl9DQoJCQl9KTsNCg0KCQkJLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8NCg0KCQkJZnVuY3Rpb24gTG9nSXRlbVZpc2l0b3IoKSB7DQoJCQl9DQoNCgkJCUxvZ0l0ZW1WaXNpdG9yLnByb3RvdHlwZSA9IHsNCgkJCQl2aXNpdDogZnVuY3Rpb24obG9nSXRlbSkgew0KCQkJCX0sDQoNCgkJCQl2aXNpdFBhcmVudDogZnVuY3Rpb24obG9nSXRlbSkgew0KCQkJCQlpZiAobG9nSXRlbS5ncm91cCkgew0KCQkJCQkJbG9nSXRlbS5ncm91cC5hY2NlcHQodGhpcyk7DQoJCQkJCX0NCgkJCQl9LA0KDQoJCQkJdmlzaXRDaGlsZHJlbjogZnVuY3Rpb24obG9nSXRlbSkgew0KCQkJCQlmb3IgKHZhciBpID0gMCwgbGVuID0gbG9nSXRlbS5jaGlsZHJlbi5sZW5ndGg7IGkgPCBsZW47IGkrKykgew0KCQkJCQkJbG9nSXRlbS5jaGlsZHJlbltpXS5hY2NlcHQodGhpcyk7DQoJCQkJCX0NCgkJCQl9LA0KDQoJCQkJdmlzaXRMb2dFbnRyeTogZnVuY3Rpb24obG9nRW50cnkpIHsNCgkJCQkJdGhpcy52aXNpdChsb2dFbnRyeSk7DQoJCQkJfSwNCg0KCQkJCXZpc2l0U2VwYXJhdG9yOiBmdW5jdGlvbihzZXBhcmF0b3IpIHsNCgkJCQkJdGhpcy52aXNpdChzZXBhcmF0b3IpOw0KCQkJCX0sDQoNCgkJCQl2aXNpdEdyb3VwOiBmdW5jdGlvbihncm91cCkgew0KCQkJCQl0aGlzLnZpc2l0KGdyb3VwKTsNCgkJCQl9DQoJCQl9Ow0KDQoJCQkvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLw0KDQoJCQlmdW5jdGlvbiBHcm91cEZsYXR0ZW5lcigpIHsNCgkJCQl0aGlzLmxvZ0VudHJpZXNBbmRTZXBhcmF0b3JzID0gW107DQoJCQl9DQoNCgkJCUdyb3VwRmxhdHRlbmVyLnByb3RvdHlwZSA9IG5ldyBMb2dJdGVtVmlzaXRvcigpOw0KDQoJCQlHcm91cEZsYXR0ZW5lci5wcm90b3R5cGUudmlzaXRHcm91cCA9IGZ1bmN0aW9uKGdyb3VwKSB7DQoJCQkJdGhpcy52aXNpdENoaWxkcmVuKGdyb3VwKTsNCgkJCX07DQoNCgkJCUdyb3VwRmxhdHRlbmVyLnByb3RvdHlwZS52aXNpdExvZ0VudHJ5ID0gZnVuY3Rpb24obG9nRW50cnkpIHsNCgkJCQl0aGlzLmxvZ0VudHJpZXNBbmRTZXBhcmF0b3JzLnB1c2gobG9nRW50cnkpOw0KCQkJfTsNCg0KCQkJR3JvdXBGbGF0dGVuZXIucHJvdG90eXBlLnZpc2l0U2VwYXJhdG9yID0gZnVuY3Rpb24oc2VwYXJhdG9yKSB7DQoJCQkJdGhpcy5sb2dFbnRyaWVzQW5kU2VwYXJhdG9ycy5wdXNoKHNlcGFyYXRvcik7DQoJCQl9Ow0KDQoJCQkvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLw0KDQoJCQl3aW5kb3cub25sb2FkID0gZnVuY3Rpb24oKSB7DQoJCQkJLy8gU29ydCBvdXQgZG9jdW1lbnQuZG9tYWluDQoJCQkJaWYgKGxvY2F0aW9uLnNlYXJjaCkgew0KCQkJCQl2YXIgcXVlcnlCaXRzID0gdW5lc2NhcGUobG9jYXRpb24uc2VhcmNoKS5zdWJzdHIoMSkuc3BsaXQoIiYiKSwgbmFtZVZhbHVlQml0czsNCgkJCQkJZm9yICh2YXIgaSA9IDAsIGxlbiA9IHF1ZXJ5Qml0cy5sZW5ndGg7IGkgPCBsZW47IGkrKykgew0KCQkJCQkJbmFtZVZhbHVlQml0cyA9IHF1ZXJ5Qml0c1tpXS5zcGxpdCgiPSIpOw0KCQkJCQkJaWYgKG5hbWVWYWx1ZUJpdHNbMF0gPT0gImxvZzRqYXZhc2NyaXB0X2RvbWFpbiIpIHsNCgkJCQkJCQlkb2N1bWVudC5kb21haW4gPSBuYW1lVmFsdWVCaXRzWzFdOw0KCQkJCQkJCWJyZWFrOw0KCQkJCQkJfQ0KCQkJCQl9DQoJCQkJfQ0KDQoJCQkJLy8gQ3JlYXRlIERPTSBvYmplY3RzDQoJCQkJbG9nTWFpbkNvbnRhaW5lciA9ICQoImxvZyIpOw0KCQkJCWlmIChpc0llUHJlNykgew0KCQkJCQlhZGRDbGFzcyhsb2dNYWluQ29udGFpbmVyLCAib2xkSWUiKTsNCgkJCQl9DQoNCgkJCQlyb290R3JvdXAgPSBuZXcgR3JvdXAoInJvb3QiLCB0cnVlKTsNCgkJCQlyb290R3JvdXAucmVuZGVyKCk7DQoJCQkJY3VycmVudEdyb3VwID0gcm9vdEdyb3VwOw0KCQkJCQ0KCQkJCXNldENvbW1hbmRJbnB1dFdpZHRoKCk7DQoJCQkJc2V0TG9nQ29udGFpbmVySGVpZ2h0KCk7DQoJCQkJdG9nZ2xlTG9nZ2luZ0VuYWJsZWQoKTsNCgkJCQl0b2dnbGVTZWFyY2hFbmFibGVkKCk7DQoJCQkJdG9nZ2xlU2VhcmNoRmlsdGVyKCk7DQoJCQkJdG9nZ2xlU2VhcmNoSGlnaGxpZ2h0KCk7DQoJCQkJYXBwbHlGaWx0ZXJzKCk7DQoJCQkJY2hlY2tBbGxMZXZlbHMoKTsNCgkJCQl0b2dnbGVXcmFwKCk7DQoJCQkJdG9nZ2xlTmV3ZXN0QXRUb3AoKTsNCgkJCQl0b2dnbGVTY3JvbGxUb0xhdGVzdCgpOw0KCQkJCXJlbmRlclF1ZXVlZExvZ0l0ZW1zKCk7DQoJCQkJbG9hZGVkID0gdHJ1ZTsNCgkJCQkkKCJjb21tYW5kIikudmFsdWUgPSAiIjsNCgkJCQkkKCJjb21tYW5kIikuYXV0b2NvbXBsZXRlID0gIm9mZiI7DQoJCQkJJCgiY29tbWFuZCIpLm9ua2V5ZG93biA9IGZ1bmN0aW9uKGV2dCkgew0KCQkJCQlldnQgPSBnZXRFdmVudChldnQpOw0KCQkJCQlpZiAoZXZ0LmtleUNvZGUgPT0gMTAgfHwgZXZ0LmtleUNvZGUgPT0gMTMpIHsgLy8gUmV0dXJuL0VudGVyDQoJCQkJCQlldmFsQ29tbWFuZExpbmUoKTsNCgkJCQkJCXN0b3BQcm9wYWdhdGlvbihldnQpOw0KCQkJCQl9IGVsc2UgaWYgKGV2dC5rZXlDb2RlID09IDI3KSB7IC8vIEVzY2FwZQ0KCQkJCQkJdGhpcy52YWx1ZSA9ICIiOw0KCQkJCQkJdGhpcy5mb2N1cygpOw0KCQkJCQl9IGVsc2UgaWYgKGV2dC5rZXlDb2RlID09IDM4ICYmIGNvbW1hbmRIaXN0b3J5Lmxlbmd0aCA+IDApIHsgLy8gVXANCgkJCQkJCWN1cnJlbnRDb21tYW5kSW5kZXggPSBNYXRoLm1heCgwLCBjdXJyZW50Q29tbWFuZEluZGV4IC0gMSk7DQoJCQkJCQl0aGlzLnZhbHVlID0gY29tbWFuZEhpc3RvcnlbY3VycmVudENvbW1hbmRJbmRleF07DQoJCQkJCQltb3ZlQ2FyZXRUb0VuZCh0aGlzKTsNCgkJCQkJfSBlbHNlIGlmIChldnQua2V5Q29kZSA9PSA0MCAmJiBjb21tYW5kSGlzdG9yeS5sZW5ndGggPiAwKSB7IC8vIERvd24NCgkJCQkJCWN1cnJlbnRDb21tYW5kSW5kZXggPSBNYXRoLm1pbihjb21tYW5kSGlzdG9yeS5sZW5ndGggLSAxLCBjdXJyZW50Q29tbWFuZEluZGV4ICsgMSk7DQoJCQkJCQl0aGlzLnZhbHVlID0gY29tbWFuZEhpc3RvcnlbY3VycmVudENvbW1hbmRJbmRleF07DQoJCQkJCQltb3ZlQ2FyZXRUb0VuZCh0aGlzKTsNCgkJCQkJfQ0KCQkJCX07DQoNCgkJCQkvLyBQcmV2ZW50IHRoZSBrZXlwcmVzcyBtb3ZpbmcgdGhlIGNhcmV0IGluIEZpcmVmb3gNCgkJCQkkKCJjb21tYW5kIikub25rZXlwcmVzcyA9IGZ1bmN0aW9uKGV2dCkgew0KCQkJCQlldnQgPSBnZXRFdmVudChldnQpOw0KCQkJCQlpZiAoZXZ0LmtleUNvZGUgPT0gMzggJiYgY29tbWFuZEhpc3RvcnkubGVuZ3RoID4gMCAmJiBldnQucHJldmVudERlZmF1bHQpIHsgLy8gVXANCgkJCQkJCWV2dC5wcmV2ZW50RGVmYXVsdCgpOw0KCQkJCQl9DQoJCQkJfTsNCg0KCQkJCS8vIFByZXZlbnQgdGhlIGtleXVwIGV2ZW50IGJsdXJyaW5nIHRoZSBpbnB1dCBpbiBPcGVyYQ0KCQkJCSQoImNvbW1hbmQiKS5vbmtleXVwID0gZnVuY3Rpb24oZXZ0KSB7DQoJCQkJCWV2dCA9IGdldEV2ZW50KGV2dCk7DQoJCQkJCWlmIChldnQua2V5Q29kZSA9PSAyNyAmJiBldnQucHJldmVudERlZmF1bHQpIHsgLy8gVXANCgkJCQkJCWV2dC5wcmV2ZW50RGVmYXVsdCgpOw0KCQkJCQkJdGhpcy5mb2N1cygpOw0KCQkJCQl9DQoJCQkJfTsNCg0KCQkJCS8vIEFkZCBkb2N1bWVudCBrZXlib2FyZCBzaG9ydGN1dHMNCgkJCQlkb2N1bWVudC5vbmtleWRvd24gPSBmdW5jdGlvbiBrZXlFdmVudEhhbmRsZXIoZXZ0KSB7DQoJCQkJCWV2dCA9IGdldEV2ZW50KGV2dCk7DQoJCQkJCXN3aXRjaCAoZXZ0LmtleUNvZGUpIHsNCgkJCQkJCWNhc2UgNjk6IC8vIEN0cmwgKyBzaGlmdCArIEU6IHJlLWV4ZWN1dGUgbGFzdCBjb21tYW5kDQoJCQkJCQkJaWYgKGV2dC5zaGlmdEtleSAmJiAoZXZ0LmN0cmxLZXkgfHwgZXZ0Lm1ldGFLZXkpKSB7DQoJCQkJCQkJCWV2YWxMYXN0Q29tbWFuZCgpOw0KCQkJCQkJCQljYW5jZWxLZXlFdmVudChldnQpOw0KCQkJCQkJCQlyZXR1cm4gZmFsc2U7DQoJCQkJCQkJfQ0KCQkJCQkJCWJyZWFrOw0KCQkJCQkJY2FzZSA3NTogLy8gQ3RybCArIHNoaWZ0ICsgSzogZm9jdXMgc2VhcmNoDQoJCQkJCQkJaWYgKGV2dC5zaGlmdEtleSAmJiAoZXZ0LmN0cmxLZXkgfHwgZXZ0Lm1ldGFLZXkpKSB7DQoJCQkJCQkJCWZvY3VzU2VhcmNoKCk7DQoJCQkJCQkJCWNhbmNlbEtleUV2ZW50KGV2dCk7DQoJCQkJCQkJCXJldHVybiBmYWxzZTsNCgkJCQkJCQl9DQoJCQkJCQkJYnJlYWs7DQoJCQkJCQljYXNlIDQwOiAvLyBDdHJsICsgc2hpZnQgKyBkb3duIGFycm93OiBmb2N1cyBjb21tYW5kIGxpbmUNCgkJCQkJCWNhc2UgNzY6IC8vIEN0cmwgKyBzaGlmdCArIEw6IGZvY3VzIGNvbW1hbmQgbGluZQ0KCQkJCQkJCWlmIChldnQuc2hpZnRLZXkgJiYgKGV2dC5jdHJsS2V5IHx8IGV2dC5tZXRhS2V5KSkgew0KCQkJCQkJCQlmb2N1c0NvbW1hbmRMaW5lKCk7DQoJCQkJCQkJCWNhbmNlbEtleUV2ZW50KGV2dCk7DQoJCQkJCQkJCXJldHVybiBmYWxzZTsNCgkJCQkJCQl9DQoJCQkJCQkJYnJlYWs7DQoJCQkJCX0NCgkJCQl9Ow0KDQoJCQkJLy8gV29ya2Fyb3VuZCB0byBtYWtlIHN1cmUgbG9nIGRpdiBzdGFydHMgYXQgdGhlIGNvcnJlY3Qgc2l6ZQ0KCQkJCXNldFRpbWVvdXQoc2V0TG9nQ29udGFpbmVySGVpZ2h0LCAyMCk7DQoNCgkJCQlzZXRTaG93Q29tbWFuZExpbmUoc2hvd0NvbW1hbmRMaW5lKTsNCgkJCQlkb1NlYXJjaCgpOw0KCQkJfTsNCg0KCQkJd2luZG93Lm9udW5sb2FkID0gZnVuY3Rpb24oKSB7DQoJCQkJaWYgKG1haW5XaW5kb3dFeGlzdHMoKSkgew0KCQkJCQlhcHBlbmRlci51bmxvYWQoKTsNCgkJCQl9DQoJCQkJYXBwZW5kZXIgPSBudWxsOw0KCQkJfTsNCg0KCQkJLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8NCg0KCQkJZnVuY3Rpb24gdG9nZ2xlTG9nZ2luZ0VuYWJsZWQoKSB7DQoJCQkJc2V0TG9nZ2luZ0VuYWJsZWQoJCgiZW5hYmxlTG9nZ2luZyIpLmNoZWNrZWQpOw0KCQkJfQ0KDQoJCQlmdW5jdGlvbiBzZXRMb2dnaW5nRW5hYmxlZChlbmFibGUpIHsNCgkJCQlsb2dnaW5nRW5hYmxlZCA9IGVuYWJsZTsNCgkJCX0NCg0KCQkJdmFyIGFwcGVuZGVyID0gbnVsbDsNCg0KCQkJZnVuY3Rpb24gc2V0QXBwZW5kZXIoYXBwZW5kZXJQYXJhbSkgew0KCQkJCWFwcGVuZGVyID0gYXBwZW5kZXJQYXJhbTsNCgkJCX0NCg0KCQkJZnVuY3Rpb24gc2V0U2hvd0Nsb3NlQnV0dG9uKHNob3dDbG9zZUJ1dHRvbikgew0KCQkJCSQoImNsb3NlQnV0dG9uIikuc3R5bGUuZGlzcGxheSA9IHNob3dDbG9zZUJ1dHRvbiA/ICJpbmxpbmUiIDogIm5vbmUiOw0KCQkJfQ0KDQoJCQlmdW5jdGlvbiBzZXRTaG93SGlkZUJ1dHRvbihzaG93SGlkZUJ1dHRvbikgew0KCQkJCSQoImhpZGVCdXR0b24iKS5zdHlsZS5kaXNwbGF5ID0gc2hvd0hpZGVCdXR0b24gPyAiaW5saW5lIiA6ICJub25lIjsNCgkJCX0NCg0KCQkJdmFyIG5ld2VzdEF0VG9wID0gZmFsc2U7DQoNCgkJCS8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovDQoNCgkJCWZ1bmN0aW9uIExvZ0l0ZW1Db250ZW50UmV2ZXJzZXIoKSB7DQoJCQl9DQoJCQkNCgkJCUxvZ0l0ZW1Db250ZW50UmV2ZXJzZXIucHJvdG90eXBlID0gbmV3IExvZ0l0ZW1WaXNpdG9yKCk7DQoJCQkNCgkJCUxvZ0l0ZW1Db250ZW50UmV2ZXJzZXIucHJvdG90eXBlLnZpc2l0R3JvdXAgPSBmdW5jdGlvbihncm91cCkgew0KCQkJCWdyb3VwLnJldmVyc2VDaGlsZHJlbigpOw0KCQkJCXRoaXMudmlzaXRDaGlsZHJlbihncm91cCk7DQoJCQl9Ow0KDQoJCQkvKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLw0KDQoJCQlmdW5jdGlvbiBzZXROZXdlc3RBdFRvcChpc05ld2VzdEF0VG9wKSB7DQoJCQkJdmFyIG9sZE5ld2VzdEF0VG9wID0gbmV3ZXN0QXRUb3A7DQoJCQkJdmFyIGksIGlMZW4sIGosIGpMZW47DQoJCQkJbmV3ZXN0QXRUb3AgPSBCb29sZWFuKGlzTmV3ZXN0QXRUb3ApOw0KCQkJCWlmIChvbGROZXdlc3RBdFRvcCAhPSBuZXdlc3RBdFRvcCkgew0KCQkJCQl2YXIgdmlzaXRvciA9IG5ldyBMb2dJdGVtQ29udGVudFJldmVyc2VyKCk7DQoJCQkJCXJvb3RHcm91cC5hY2NlcHQodmlzaXRvcik7DQoNCgkJCQkJLy8gUmVhc3NlbWJsZSB0aGUgbWF0Y2hlcyBhcnJheQ0KCQkJCQlpZiAoY3VycmVudFNlYXJjaCkgew0KCQkJCQkJdmFyIGN1cnJlbnRNYXRjaCA9IGN1cnJlbnRTZWFyY2gubWF0Y2hlc1tjdXJyZW50TWF0Y2hJbmRleF07DQoJCQkJCQl2YXIgbWF0Y2hJbmRleCA9IDA7DQoJCQkJCQl2YXIgbWF0Y2hlcyA9IFtdOw0KCQkJCQkJdmFyIGFjdE9uTG9nRW50cnkgPSBmdW5jdGlvbihsb2dFbnRyeSkgew0KCQkJCQkJCXZhciBsb2dFbnRyeU1hdGNoZXMgPSBsb2dFbnRyeS5nZXRTZWFyY2hNYXRjaGVzKCk7DQoJCQkJCQkJZm9yIChqID0gMCwgakxlbiA9IGxvZ0VudHJ5TWF0Y2hlcy5sZW5ndGg7IGogPCBqTGVuOyBqKyspIHsNCgkJCQkJCQkJbWF0Y2hlc1ttYXRjaEluZGV4XSA9IGxvZ0VudHJ5TWF0Y2hlc1tqXTsNCgkJCQkJCQkJaWYgKGN1cnJlbnRNYXRjaCAmJiBsb2dFbnRyeU1hdGNoZXNbal0uZXF1YWxzKGN1cnJlbnRNYXRjaCkpIHsNCgkJCQkJCQkJCWN1cnJlbnRNYXRjaEluZGV4ID0gbWF0Y2hJbmRleDsNCgkJCQkJCQkJfQ0KCQkJCQkJCQltYXRjaEluZGV4Kys7DQoJCQkJCQkJfQ0KCQkJCQkJfTsNCgkJCQkJCWlmIChuZXdlc3RBdFRvcCkgew0KCQkJCQkJCWZvciAoaSA9IGxvZ0VudHJpZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsNCgkJCQkJCQkJYWN0T25Mb2dFbnRyeShsb2dFbnRyaWVzW2ldKTsNCgkJCQkJCQl9DQoJCQkJCQl9IGVsc2Ugew0KCQkJCQkJCWZvciAoaSA9IDAsIGlMZW4gPSBsb2dFbnRyaWVzLmxlbmd0aDsgaSA8IGlMZW47IGkrKykgew0KCQkJCQkJCQlhY3RPbkxvZ0VudHJ5KGxvZ0VudHJpZXNbaV0pOw0KCQkJCQkJCX0NCgkJCQkJCX0NCgkJCQkJCWN1cnJlbnRTZWFyY2gubWF0Y2hlcyA9IG1hdGNoZXM7DQoJCQkJCQlpZiAoY3VycmVudE1hdGNoKSB7DQoJCQkJCQkJY3VycmVudE1hdGNoLnNldEN1cnJlbnQoKTsNCgkJCQkJCX0NCgkJCQkJfSBlbHNlIGlmIChzY3JvbGxUb0xhdGVzdCkgew0KCQkJCQkJZG9TY3JvbGxUb0xhdGVzdCgpOw0KCQkJCQl9DQoJCQkJfQ0KCQkJCSQoIm5ld2VzdEF0VG9wIikuY2hlY2tlZCA9IGlzTmV3ZXN0QXRUb3A7DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIHRvZ2dsZU5ld2VzdEF0VG9wKCkgew0KCQkJCXZhciBpc05ld2VzdEF0VG9wID0gJCgibmV3ZXN0QXRUb3AiKS5jaGVja2VkOw0KCQkJCXNldE5ld2VzdEF0VG9wKGlzTmV3ZXN0QXRUb3ApOw0KCQkJfQ0KDQoJCQl2YXIgc2Nyb2xsVG9MYXRlc3QgPSB0cnVlOw0KDQoJCQlmdW5jdGlvbiBzZXRTY3JvbGxUb0xhdGVzdChpc1Njcm9sbFRvTGF0ZXN0KSB7DQoJCQkJc2Nyb2xsVG9MYXRlc3QgPSBpc1Njcm9sbFRvTGF0ZXN0Ow0KCQkJCWlmIChzY3JvbGxUb0xhdGVzdCkgew0KCQkJCQlkb1Njcm9sbFRvTGF0ZXN0KCk7DQoJCQkJfQ0KCQkJCSQoInNjcm9sbFRvTGF0ZXN0IikuY2hlY2tlZCA9IGlzU2Nyb2xsVG9MYXRlc3Q7DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIHRvZ2dsZVNjcm9sbFRvTGF0ZXN0KCkgew0KCQkJCXZhciBpc1Njcm9sbFRvTGF0ZXN0ID0gJCgic2Nyb2xsVG9MYXRlc3QiKS5jaGVja2VkOw0KCQkJCXNldFNjcm9sbFRvTGF0ZXN0KGlzU2Nyb2xsVG9MYXRlc3QpOw0KCQkJfQ0KDQoJCQlmdW5jdGlvbiBkb1Njcm9sbFRvTGF0ZXN0KCkgew0KCQkJCXZhciBsID0gbG9nTWFpbkNvbnRhaW5lcjsNCgkJCQlpZiAodHlwZW9mIGwuc2Nyb2xsVG9wICE9ICJ1bmRlZmluZWQiKSB7DQoJCQkJCWlmIChuZXdlc3RBdFRvcCkgew0KCQkJCQkJbC5zY3JvbGxUb3AgPSAwOw0KCQkJCQl9IGVsc2Ugew0KCQkJCQkJdmFyIGxhdGVzdExvZ0VudHJ5ID0gbC5sYXN0Q2hpbGQ7DQoJCQkJCQlpZiAobGF0ZXN0TG9nRW50cnkpIHsNCgkJCQkJCQlsLnNjcm9sbFRvcCA9IGwuc2Nyb2xsSGVpZ2h0Ow0KCQkJCQkJfQ0KCQkJCQl9DQoJCQkJfQ0KCQkJfQ0KDQoJCQl2YXIgY2xvc2VJZk9wZW5lckNsb3NlcyA9IHRydWU7DQoNCgkJCWZ1bmN0aW9uIHNldENsb3NlSWZPcGVuZXJDbG9zZXMoaXNDbG9zZUlmT3BlbmVyQ2xvc2VzKSB7DQoJCQkJY2xvc2VJZk9wZW5lckNsb3NlcyA9IGlzQ2xvc2VJZk9wZW5lckNsb3NlczsNCgkJCX0NCg0KCQkJdmFyIG1heE1lc3NhZ2VzID0gbnVsbDsNCg0KCQkJZnVuY3Rpb24gc2V0TWF4TWVzc2FnZXMobWF4KSB7DQoJCQkJbWF4TWVzc2FnZXMgPSBtYXg7DQoJCQkJcHJ1bmVMb2dFbnRyaWVzKCk7DQoJCQl9DQoNCgkJCXZhciBzaG93Q29tbWFuZExpbmUgPSBmYWxzZTsNCg0KCQkJZnVuY3Rpb24gc2V0U2hvd0NvbW1hbmRMaW5lKGlzU2hvd0NvbW1hbmRMaW5lKSB7DQoJCQkJc2hvd0NvbW1hbmRMaW5lID0gaXNTaG93Q29tbWFuZExpbmU7DQoJCQkJaWYgKGxvYWRlZCkgew0KCQkJCQkkKCJjb21tYW5kTGluZSIpLnN0eWxlLmRpc3BsYXkgPSBzaG93Q29tbWFuZExpbmUgPyAiYmxvY2siIDogIm5vbmUiOw0KCQkJCQlzZXRDb21tYW5kSW5wdXRXaWR0aCgpOw0KCQkJCQlzZXRMb2dDb250YWluZXJIZWlnaHQoKTsNCgkJCQl9DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIGZvY3VzQ29tbWFuZExpbmUoKSB7DQoJCQkJaWYgKGxvYWRlZCkgew0KCQkJCQkkKCJjb21tYW5kIikuZm9jdXMoKTsNCgkJCQl9DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIGZvY3VzU2VhcmNoKCkgew0KCQkJCWlmIChsb2FkZWQpIHsNCgkJCQkJJCgic2VhcmNoQm94IikuZm9jdXMoKTsNCgkJCQl9DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIGdldExvZ0l0ZW1zKCkgew0KCQkJCXZhciBpdGVtcyA9IFtdOw0KCQkJCWZvciAodmFyIGkgPSAwLCBsZW4gPSBsb2dJdGVtcy5sZW5ndGg7IGkgPCBsZW47IGkrKykgew0KCQkJCQlsb2dJdGVtc1tpXS5zZXJpYWxpemUoaXRlbXMpOw0KCQkJCX0NCgkJCQlyZXR1cm4gaXRlbXM7DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIHNldExvZ0l0ZW1zKGl0ZW1zKSB7DQoJCQkJdmFyIGxvZ2dpbmdSZWFsbHlFbmFibGVkID0gbG9nZ2luZ0VuYWJsZWQ7DQoJCQkJLy8gVGVtcG9yYXJpbHkgdHVybiBsb2dnaW5nIG9uDQoJCQkJbG9nZ2luZ0VuYWJsZWQgPSB0cnVlOw0KCQkJCWZvciAodmFyIGkgPSAwLCBsZW4gPSBpdGVtcy5sZW5ndGg7IGkgPCBsZW47IGkrKykgew0KCQkJCQlzd2l0Y2ggKGl0ZW1zW2ldWzBdKSB7DQoJCQkJCQljYXNlIExvZ0l0ZW0uc2VyaWFsaXplZEl0ZW1LZXlzLkxPR19FTlRSWToNCgkJCQkJCQlsb2coaXRlbXNbaV1bMV0sIGl0ZW1zW2ldWzJdKTsNCgkJCQkJCQlicmVhazsNCgkJCQkJCWNhc2UgTG9nSXRlbS5zZXJpYWxpemVkSXRlbUtleXMuR1JPVVBfU1RBUlQ6DQoJCQkJCQkJZ3JvdXAoaXRlbXNbaV1bMV0pOw0KCQkJCQkJCWJyZWFrOw0KCQkJCQkJY2FzZSBMb2dJdGVtLnNlcmlhbGl6ZWRJdGVtS2V5cy5HUk9VUF9FTkQ6DQoJCQkJCQkJZ3JvdXBFbmQoKTsNCgkJCQkJCQlicmVhazsNCgkJCQkJfQ0KCQkJCX0NCgkJCQlsb2dnaW5nRW5hYmxlZCA9IGxvZ2dpbmdSZWFsbHlFbmFibGVkOw0KCQkJfQ0KDQoJCQlmdW5jdGlvbiBsb2cobG9nTGV2ZWwsIGZvcm1hdHRlZE1lc3NhZ2UpIHsNCgkJCQlpZiAobG9nZ2luZ0VuYWJsZWQpIHsNCgkJCQkJdmFyIGxvZ0VudHJ5ID0gbmV3IExvZ0VudHJ5KGxvZ0xldmVsLCBmb3JtYXR0ZWRNZXNzYWdlKTsNCgkJCQkJbG9nRW50cmllcy5wdXNoKGxvZ0VudHJ5KTsNCgkJCQkJbG9nRW50cmllc0FuZFNlcGFyYXRvcnMucHVzaChsb2dFbnRyeSk7DQoJCQkJCWxvZ0l0ZW1zLnB1c2gobG9nRW50cnkpOw0KCQkJCQljdXJyZW50R3JvdXAuYWRkQ2hpbGQobG9nRW50cnkpOw0KCQkJCQlpZiAobG9hZGVkKSB7DQoJCQkJCQlpZiAobG9nUXVldWVkRXZlbnRzVGltZXIgIT09IG51bGwpIHsNCgkJCQkJCQljbGVhclRpbWVvdXQobG9nUXVldWVkRXZlbnRzVGltZXIpOw0KCQkJCQkJfQ0KCQkJCQkJbG9nUXVldWVkRXZlbnRzVGltZXIgPSBzZXRUaW1lb3V0KHJlbmRlclF1ZXVlZExvZ0l0ZW1zLCByZW5kZXJEZWxheSk7DQoJCQkJCQl1bnJlbmRlcmVkTG9nSXRlbXNFeGlzdCA9IHRydWU7DQoJCQkJCX0NCgkJCQl9DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIHJlbmRlclF1ZXVlZExvZ0l0ZW1zKCkgew0KCQkJCWxvZ1F1ZXVlZEV2ZW50c1RpbWVyID0gbnVsbDsNCgkJCQl2YXIgcHJ1bmVkID0gcHJ1bmVMb2dFbnRyaWVzKCk7DQoNCgkJCQkvLyBSZW5kZXIgYW55IHVucmVuZGVyZWQgbG9nIGVudHJpZXMgYW5kIGFwcGx5IHRoZSBjdXJyZW50IHNlYXJjaCB0byB0aGVtDQoJCQkJdmFyIGluaXRpYWxseUhhc01hdGNoZXMgPSBjdXJyZW50U2VhcmNoID8gY3VycmVudFNlYXJjaC5oYXNNYXRjaGVzKCkgOiBmYWxzZTsNCgkJCQlmb3IgKHZhciBpID0gMCwgbGVuID0gbG9nSXRlbXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsNCgkJCQkJaWYgKCFsb2dJdGVtc1tpXS5yZW5kZXJlZCkgew0KCQkJCQkJbG9nSXRlbXNbaV0ucmVuZGVyKCk7DQoJCQkJCQlsb2dJdGVtc1tpXS5hcHBlbmRUb0xvZygpOw0KCQkJCQkJaWYgKGN1cnJlbnRTZWFyY2ggJiYgKGxvZ0l0ZW1zW2ldIGluc3RhbmNlb2YgTG9nRW50cnkpKSB7DQoJCQkJCQkJY3VycmVudFNlYXJjaC5hcHBseVRvKGxvZ0l0ZW1zW2ldKTsNCgkJCQkJCX0NCgkJCQkJfQ0KCQkJCX0NCgkJCQlpZiAoY3VycmVudFNlYXJjaCkgew0KCQkJCQlpZiAocHJ1bmVkKSB7DQoJCQkJCQlpZiAoY3VycmVudFNlYXJjaC5oYXNWaXNpYmxlTWF0Y2hlcygpKSB7DQoJCQkJCQkJaWYgKGN1cnJlbnRNYXRjaEluZGV4ID09PSBudWxsKSB7DQoJCQkJCQkJCXNldEN1cnJlbnRNYXRjaEluZGV4KDApOw0KCQkJCQkJCX0NCgkJCQkJCQlkaXNwbGF5TWF0Y2hlcygpOw0KCQkJCQkJfSBlbHNlIHsNCgkJCQkJCQlkaXNwbGF5Tm9NYXRjaGVzKCk7DQoJCQkJCQl9DQoJCQkJCX0gZWxzZSBpZiAoIWluaXRpYWxseUhhc01hdGNoZXMgJiYgY3VycmVudFNlYXJjaC5oYXNWaXNpYmxlTWF0Y2hlcygpKSB7DQoJCQkJCQlzZXRDdXJyZW50TWF0Y2hJbmRleCgwKTsNCgkJCQkJCWRpc3BsYXlNYXRjaGVzKCk7DQoJCQkJCX0NCgkJCQl9DQoJCQkJaWYgKHNjcm9sbFRvTGF0ZXN0KSB7DQoJCQkJCWRvU2Nyb2xsVG9MYXRlc3QoKTsNCgkJCQl9DQoJCQkJdW5yZW5kZXJlZExvZ0l0ZW1zRXhpc3QgPSBmYWxzZTsNCgkJCX0NCg0KCQkJZnVuY3Rpb24gcHJ1bmVMb2dFbnRyaWVzKCkgew0KCQkJCWlmICgobWF4TWVzc2FnZXMgIT09IG51bGwpICYmIChsb2dFbnRyaWVzQW5kU2VwYXJhdG9ycy5sZW5ndGggPiBtYXhNZXNzYWdlcykpIHsNCgkJCQkJdmFyIG51bWJlclRvRGVsZXRlID0gbG9nRW50cmllc0FuZFNlcGFyYXRvcnMubGVuZ3RoIC0gbWF4TWVzc2FnZXM7DQoJCQkJCXZhciBwcnVuZWRMb2dFbnRyaWVzID0gbG9nRW50cmllc0FuZFNlcGFyYXRvcnMuc2xpY2UoMCwgbnVtYmVyVG9EZWxldGUpOw0KCQkJCQlpZiAoY3VycmVudFNlYXJjaCkgew0KCQkJCQkJY3VycmVudFNlYXJjaC5yZW1vdmVNYXRjaGVzKHBydW5lZExvZ0VudHJpZXMpOw0KCQkJCQl9DQoJCQkJCXZhciBncm91cDsNCgkJCQkJZm9yICh2YXIgaSA9IDA7IGkgPCBudW1iZXJUb0RlbGV0ZTsgaSsrKSB7DQoJCQkJCQlncm91cCA9IGxvZ0VudHJpZXNBbmRTZXBhcmF0b3JzW2ldLmdyb3VwOw0KCQkJCQkJYXJyYXlfcmVtb3ZlKGxvZ0l0ZW1zLCBsb2dFbnRyaWVzQW5kU2VwYXJhdG9yc1tpXSk7DQoJCQkJCQlhcnJheV9yZW1vdmUobG9nRW50cmllcywgbG9nRW50cmllc0FuZFNlcGFyYXRvcnNbaV0pOw0KCQkJCQkJbG9nRW50cmllc0FuZFNlcGFyYXRvcnNbaV0ucmVtb3ZlKHRydWUsIHRydWUpOw0KCQkJCQkJaWYgKGdyb3VwLmNoaWxkcmVuLmxlbmd0aCA9PT0gMCAmJiBncm91cCAhPT0gY3VycmVudEdyb3VwICYmIGdyb3VwICE9PSByb290R3JvdXApIHsNCgkJCQkJCQlhcnJheV9yZW1vdmUobG9nSXRlbXMsIGdyb3VwKTsNCgkJCQkJCQlncm91cC5yZW1vdmUodHJ1ZSwgdHJ1ZSk7DQoJCQkJCQl9DQoJCQkJCX0NCgkJCQkJbG9nRW50cmllc0FuZFNlcGFyYXRvcnMgPSBhcnJheV9yZW1vdmVGcm9tU3RhcnQobG9nRW50cmllc0FuZFNlcGFyYXRvcnMsIG51bWJlclRvRGVsZXRlKTsNCgkJCQkJcmV0dXJuIHRydWU7DQoJCQkJfQ0KCQkJCXJldHVybiBmYWxzZTsNCgkJCX0NCg0KCQkJZnVuY3Rpb24gZ3JvdXAobmFtZSwgc3RhcnRFeHBhbmRlZCkgew0KCQkJCWlmIChsb2dnaW5nRW5hYmxlZCkgew0KCQkJCQlpbml0aWFsbHlFeHBhbmRlZCA9ICh0eXBlb2Ygc3RhcnRFeHBhbmRlZCA9PT0gInVuZGVmaW5lZCIpID8gdHJ1ZSA6IEJvb2xlYW4oc3RhcnRFeHBhbmRlZCk7DQoJCQkJCXZhciBuZXdHcm91cCA9IG5ldyBHcm91cChuYW1lLCBmYWxzZSwgaW5pdGlhbGx5RXhwYW5kZWQpOw0KCQkJCQljdXJyZW50R3JvdXAuYWRkQ2hpbGQobmV3R3JvdXApOw0KCQkJCQljdXJyZW50R3JvdXAgPSBuZXdHcm91cDsNCgkJCQkJbG9nSXRlbXMucHVzaChuZXdHcm91cCk7DQoJCQkJCWlmIChsb2FkZWQpIHsNCgkJCQkJCWlmIChsb2dRdWV1ZWRFdmVudHNUaW1lciAhPT0gbnVsbCkgew0KCQkJCQkJCWNsZWFyVGltZW91dChsb2dRdWV1ZWRFdmVudHNUaW1lcik7DQoJCQkJCQl9DQoJCQkJCQlsb2dRdWV1ZWRFdmVudHNUaW1lciA9IHNldFRpbWVvdXQocmVuZGVyUXVldWVkTG9nSXRlbXMsIHJlbmRlckRlbGF5KTsNCgkJCQkJCXVucmVuZGVyZWRMb2dJdGVtc0V4aXN0ID0gdHJ1ZTsNCgkJCQkJfQ0KCQkJCX0NCgkJCX0NCg0KCQkJZnVuY3Rpb24gZ3JvdXBFbmQoKSB7DQoJCQkJY3VycmVudEdyb3VwID0gKGN1cnJlbnRHcm91cCA9PT0gcm9vdEdyb3VwKSA/IHJvb3RHcm91cCA6IGN1cnJlbnRHcm91cC5ncm91cDsNCgkJCX0NCg0KCQkJZnVuY3Rpb24gbWFpblBhZ2VSZWxvYWRlZCgpIHsNCgkJCQljdXJyZW50R3JvdXAgPSByb290R3JvdXA7DQoJCQkJdmFyIHNlcGFyYXRvciA9IG5ldyBTZXBhcmF0b3IoKTsNCgkJCQlsb2dFbnRyaWVzQW5kU2VwYXJhdG9ycy5wdXNoKHNlcGFyYXRvcik7DQoJCQkJbG9nSXRlbXMucHVzaChzZXBhcmF0b3IpOw0KCQkJCWN1cnJlbnRHcm91cC5hZGRDaGlsZChzZXBhcmF0b3IpOw0KCQkJfQ0KDQoJCQlmdW5jdGlvbiBjbG9zZVdpbmRvdygpIHsNCgkJCQlpZiAoYXBwZW5kZXIgJiYgbWFpbldpbmRvd0V4aXN0cygpKSB7DQoJCQkJCWFwcGVuZGVyLmNsb3NlKHRydWUpOw0KCQkJCX0gZWxzZSB7DQoJCQkJCXdpbmRvdy5jbG9zZSgpOw0KCQkJCX0NCgkJCX0NCg0KCQkJZnVuY3Rpb24gaGlkZSgpIHsNCgkJCQlpZiAoYXBwZW5kZXIgJiYgbWFpbldpbmRvd0V4aXN0cygpKSB7DQoJCQkJCWFwcGVuZGVyLmhpZGUoKTsNCgkJCQl9DQoJCQl9DQoNCgkJCXZhciBtYWluV2luZG93ID0gd2luZG93Ow0KCQkJdmFyIHdpbmRvd0lkID0gImxvZzRqYXZhc2NyaXB0Q29uc29sZVdpbmRvd18iICsgbmV3IERhdGUoKS5nZXRUaW1lKCkgKyAiXyIgKyAoIiIgKyBNYXRoLnJhbmRvbSgpKS5zdWJzdHIoMik7DQoNCgkJCWZ1bmN0aW9uIHNldE1haW5XaW5kb3cod2luKSB7DQoJCQkJbWFpbldpbmRvdyA9IHdpbjsNCgkJCQltYWluV2luZG93W3dpbmRvd0lkXSA9IHdpbmRvdzsNCgkJCQkvLyBJZiB0aGlzIGlzIGEgcG9wLXVwLCBwb2xsIHRoZSBvcGVuZXIgdG8gc2VlIGlmIGl0J3MgY2xvc2VkDQoJCQkJaWYgKG9wZW5lciAmJiBjbG9zZUlmT3BlbmVyQ2xvc2VzKSB7DQoJCQkJCXBvbGxPcGVuZXIoKTsNCgkJCQl9DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIHBvbGxPcGVuZXIoKSB7DQoJCQkJaWYgKGNsb3NlSWZPcGVuZXJDbG9zZXMpIHsNCgkJCQkJaWYgKG1haW5XaW5kb3dFeGlzdHMoKSkgew0KCQkJCQkJc2V0VGltZW91dChwb2xsT3BlbmVyLCA1MDApOw0KCQkJCQl9IGVsc2Ugew0KCQkJCQkJY2xvc2VXaW5kb3coKTsNCgkJCQkJfQ0KCQkJCX0NCgkJCX0NCg0KCQkJZnVuY3Rpb24gbWFpbldpbmRvd0V4aXN0cygpIHsNCgkJCQl0cnkgew0KCQkJCQlyZXR1cm4gKG1haW5XaW5kb3cgJiYgIW1haW5XaW5kb3cuY2xvc2VkICYmDQoJCQkJCQltYWluV2luZG93W3dpbmRvd0lkXSA9PSB3aW5kb3cpOw0KCQkJCX0gY2F0Y2ggKGV4KSB7fQ0KCQkJCXJldHVybiBmYWxzZTsNCgkJCX0NCg0KCQkJdmFyIGxvZ0xldmVscyA9IFsiVFJBQ0UiLCAiREVCVUciLCAiSU5GTyIsICJXQVJOIiwgIkVSUk9SIiwgIkZBVEFMIl07DQoNCgkJCWZ1bmN0aW9uIGdldENoZWNrQm94KGxvZ0xldmVsKSB7DQoJCQkJcmV0dXJuICQoInN3aXRjaF8iICsgbG9nTGV2ZWwpOw0KCQkJfQ0KDQoJCQlmdW5jdGlvbiBnZXRJZVdyYXBwZWRMb2dDb250YWluZXIoKSB7DQoJCQkJcmV0dXJuICQoImxvZ193cmFwcGVkIik7DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIGdldEllVW53cmFwcGVkTG9nQ29udGFpbmVyKCkgew0KCQkJCXJldHVybiAkKCJsb2dfdW53cmFwcGVkIik7DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIGFwcGx5RmlsdGVycygpIHsNCgkJCQlmb3IgKHZhciBpID0gMDsgaSA8IGxvZ0xldmVscy5sZW5ndGg7IGkrKykgew0KCQkJCQlpZiAoZ2V0Q2hlY2tCb3gobG9nTGV2ZWxzW2ldKS5jaGVja2VkKSB7DQoJCQkJCQlhZGRDbGFzcyhsb2dNYWluQ29udGFpbmVyLCBsb2dMZXZlbHNbaV0pOw0KCQkJCQl9IGVsc2Ugew0KCQkJCQkJcmVtb3ZlQ2xhc3MobG9nTWFpbkNvbnRhaW5lciwgbG9nTGV2ZWxzW2ldKTsNCgkJCQkJfQ0KCQkJCX0NCgkJCQl1cGRhdGVTZWFyY2hGcm9tRmlsdGVycygpOw0KCQkJfQ0KDQoJCQlmdW5jdGlvbiB0b2dnbGVBbGxMZXZlbHMoKSB7DQoJCQkJdmFyIHR1cm5PbiA9ICQoInN3aXRjaF9BTEwiKS5jaGVja2VkOw0KCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgbG9nTGV2ZWxzLmxlbmd0aDsgaSsrKSB7DQoJCQkJCWdldENoZWNrQm94KGxvZ0xldmVsc1tpXSkuY2hlY2tlZCA9IHR1cm5PbjsNCgkJCQkJaWYgKHR1cm5Pbikgew0KCQkJCQkJYWRkQ2xhc3MobG9nTWFpbkNvbnRhaW5lciwgbG9nTGV2ZWxzW2ldKTsNCgkJCQkJfSBlbHNlIHsNCgkJCQkJCXJlbW92ZUNsYXNzKGxvZ01haW5Db250YWluZXIsIGxvZ0xldmVsc1tpXSk7DQoJCQkJCX0NCgkJCQl9DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIGNoZWNrQWxsTGV2ZWxzKCkgew0KCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgbG9nTGV2ZWxzLmxlbmd0aDsgaSsrKSB7DQoJCQkJCWlmICghZ2V0Q2hlY2tCb3gobG9nTGV2ZWxzW2ldKS5jaGVja2VkKSB7DQoJCQkJCQlnZXRDaGVja0JveCgiQUxMIikuY2hlY2tlZCA9IGZhbHNlOw0KCQkJCQkJcmV0dXJuOw0KCQkJCQl9DQoJCQkJfQ0KCQkJCWdldENoZWNrQm94KCJBTEwiKS5jaGVja2VkID0gdHJ1ZTsNCgkJCX0NCg0KCQkJZnVuY3Rpb24gY2xlYXJMb2coKSB7DQoJCQkJcm9vdEdyb3VwLmNsZWFyKCk7DQoJCQkJY3VycmVudEdyb3VwID0gcm9vdEdyb3VwOw0KCQkJCWxvZ0VudHJpZXMgPSBbXTsNCgkJCQlsb2dJdGVtcyA9IFtdOw0KCQkJCWxvZ0VudHJpZXNBbmRTZXBhcmF0b3JzID0gW107DQogCQkJCWRvU2VhcmNoKCk7DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIHRvZ2dsZVdyYXAoKSB7DQoJCQkJdmFyIGVuYWJsZSA9ICQoIndyYXAiKS5jaGVja2VkOw0KCQkJCWlmIChlbmFibGUpIHsNCgkJCQkJYWRkQ2xhc3MobG9nTWFpbkNvbnRhaW5lciwgIndyYXAiKTsNCgkJCQl9IGVsc2Ugew0KCQkJCQlyZW1vdmVDbGFzcyhsb2dNYWluQ29udGFpbmVyLCAid3JhcCIpOw0KCQkJCX0NCgkJCQlyZWZyZXNoQ3VycmVudE1hdGNoKCk7DQoJCQl9DQoNCgkJCS8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi8NCg0KCQkJLy8gU2VhcmNoDQoNCgkJCXZhciBzZWFyY2hUaW1lciA9IG51bGw7DQoNCgkJCWZ1bmN0aW9uIHNjaGVkdWxlU2VhcmNoKCkgew0KCQkJCXRyeSB7DQoJCQkJCWNsZWFyVGltZW91dChzZWFyY2hUaW1lcik7DQoJCQkJfSBjYXRjaCAoZXgpIHsNCgkJCQkJLy8gRG8gbm90aGluZw0KCQkJCX0NCgkJCQlzZWFyY2hUaW1lciA9IHNldFRpbWVvdXQoZG9TZWFyY2gsIDUwMCk7DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIFNlYXJjaChzZWFyY2hUZXJtLCBpc1JlZ2V4LCBzZWFyY2hSZWdleCwgaXNDYXNlU2Vuc2l0aXZlKSB7DQoJCQkJdGhpcy5zZWFyY2hUZXJtID0gc2VhcmNoVGVybTsNCgkJCQl0aGlzLmlzUmVnZXggPSBpc1JlZ2V4Ow0KCQkJCXRoaXMuc2VhcmNoUmVnZXggPSBzZWFyY2hSZWdleDsNCgkJCQl0aGlzLmlzQ2FzZVNlbnNpdGl2ZSA9IGlzQ2FzZVNlbnNpdGl2ZTsNCgkJCQl0aGlzLm1hdGNoZXMgPSBbXTsNCgkJCX0NCg0KCQkJU2VhcmNoLnByb3RvdHlwZSA9IHsNCgkJCQloYXNNYXRjaGVzOiBmdW5jdGlvbigpIHsNCgkJCQkJcmV0dXJuIHRoaXMubWF0Y2hlcy5sZW5ndGggPiAwOw0KCQkJCX0sDQoNCgkJCQloYXNWaXNpYmxlTWF0Y2hlczogZnVuY3Rpb24oKSB7DQoJCQkJCWlmICh0aGlzLmhhc01hdGNoZXMoKSkgew0KCQkJCQkJZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLm1hdGNoZXMubGVuZ3RoOyBpKyspIHsNCgkJCQkJCQlpZiAodGhpcy5tYXRjaGVzW2ldLmlzVmlzaWJsZSgpKSB7DQoJCQkJCQkJCXJldHVybiB0cnVlOw0KCQkJCQkJCX0NCgkJCQkJCX0NCgkJCQkJfQ0KCQkJCQlyZXR1cm4gZmFsc2U7DQoJCQkJfSwNCg0KCQkJCW1hdGNoOiBmdW5jdGlvbihsb2dFbnRyeSkgew0KCQkJCQl2YXIgZW50cnlUZXh0ID0gU3RyaW5nKGxvZ0VudHJ5LmZvcm1hdHRlZE1lc3NhZ2UpOw0KCQkJCQl2YXIgbWF0Y2hlc1NlYXJjaCA9IGZhbHNlOw0KCQkJCQlpZiAodGhpcy5pc1JlZ2V4KSB7DQoJCQkJCQltYXRjaGVzU2VhcmNoID0gdGhpcy5zZWFyY2hSZWdleC50ZXN0KGVudHJ5VGV4dCk7DQoJCQkJCX0gZWxzZSBpZiAodGhpcy5pc0Nhc2VTZW5zaXRpdmUpIHsNCgkJCQkJCW1hdGNoZXNTZWFyY2ggPSAoZW50cnlUZXh0LmluZGV4T2YodGhpcy5zZWFyY2hUZXJtKSA+IC0xKTsNCgkJCQkJfSBlbHNlIHsNCgkJCQkJCW1hdGNoZXNTZWFyY2ggPSAoZW50cnlUZXh0LnRvTG93ZXJDYXNlKCkuaW5kZXhPZih0aGlzLnNlYXJjaFRlcm0udG9Mb3dlckNhc2UoKSkgPiAtMSk7DQoJCQkJCX0NCgkJCQkJcmV0dXJuIG1hdGNoZXNTZWFyY2g7DQoJCQkJfSwNCg0KCQkJCWdldE5leHRWaXNpYmxlTWF0Y2hJbmRleDogZnVuY3Rpb24oKSB7DQoJCQkJCWZvciAodmFyIGkgPSBjdXJyZW50TWF0Y2hJbmRleCArIDE7IGkgPCB0aGlzLm1hdGNoZXMubGVuZ3RoOyBpKyspIHsNCgkJCQkJCWlmICh0aGlzLm1hdGNoZXNbaV0uaXNWaXNpYmxlKCkpIHsNCgkJCQkJCQlyZXR1cm4gaTsNCgkJCQkJCX0NCgkJCQkJfQ0KCQkJCQkvLyBTdGFydCBhZ2FpbiBmcm9tIHRoZSBmaXJzdCBtYXRjaA0KCQkJCQlmb3IgKGkgPSAwOyBpIDw9IGN1cnJlbnRNYXRjaEluZGV4OyBpKyspIHsNCgkJCQkJCWlmICh0aGlzLm1hdGNoZXNbaV0uaXNWaXNpYmxlKCkpIHsNCgkJCQkJCQlyZXR1cm4gaTsNCgkJCQkJCX0NCgkJCQkJfQ0KCQkJCQlyZXR1cm4gLTE7DQoJCQkJfSwNCg0KCQkJCWdldFByZXZpb3VzVmlzaWJsZU1hdGNoSW5kZXg6IGZ1bmN0aW9uKCkgew0KCQkJCQlmb3IgKHZhciBpID0gY3VycmVudE1hdGNoSW5kZXggLSAxOyBpID49IDA7IGktLSkgew0KCQkJCQkJaWYgKHRoaXMubWF0Y2hlc1tpXS5pc1Zpc2libGUoKSkgew0KCQkJCQkJCXJldHVybiBpOw0KCQkJCQkJfQ0KCQkJCQl9DQoJCQkJCS8vIFN0YXJ0IGFnYWluIGZyb20gdGhlIGxhc3QgbWF0Y2gNCgkJCQkJZm9yICh2YXIgaSA9IHRoaXMubWF0Y2hlcy5sZW5ndGggLSAxOyBpID49IGN1cnJlbnRNYXRjaEluZGV4OyBpLS0pIHsNCgkJCQkJCWlmICh0aGlzLm1hdGNoZXNbaV0uaXNWaXNpYmxlKCkpIHsNCgkJCQkJCQlyZXR1cm4gaTsNCgkJCQkJCX0NCgkJCQkJfQ0KCQkJCQlyZXR1cm4gLTE7DQoJCQkJfSwNCg0KCQkJCWFwcGx5VG86IGZ1bmN0aW9uKGxvZ0VudHJ5KSB7DQoJCQkJCXZhciBkb2VzTWF0Y2ggPSB0aGlzLm1hdGNoKGxvZ0VudHJ5KTsNCgkJCQkJaWYgKGRvZXNNYXRjaCkgew0KCQkJCQkJbG9nRW50cnkuZ3JvdXAuZXhwYW5kKCk7DQoJCQkJCQlsb2dFbnRyeS5zZXRTZWFyY2hNYXRjaCh0cnVlKTsNCgkJCQkJCXZhciBsb2dFbnRyeUNvbnRlbnQ7DQoJCQkJCQl2YXIgd3JhcHBlZExvZ0VudHJ5Q29udGVudDsNCgkJCQkJCXZhciBzZWFyY2hUZXJtUmVwbGFjZW1lbnRTdGFydFRhZyA9ICI8c3BhbiBjbGFzcz1cInNlYXJjaHRlcm1cIj4iOw0KCQkJCQkJdmFyIHNlYXJjaFRlcm1SZXBsYWNlbWVudEVuZFRhZyA9ICI8IiArICIvc3Bhbj4iOw0KCQkJCQkJdmFyIHByZVRhZ05hbWUgPSBpc0llID8gInByZSIgOiAic3BhbiI7DQoJCQkJCQl2YXIgcHJlU3RhcnRUYWcgPSAiPCIgKyBwcmVUYWdOYW1lICsgIiBjbGFzcz1cInByZVwiPiI7DQoJCQkJCQl2YXIgcHJlRW5kVGFnID0gIjwiICsgIi8iICsgcHJlVGFnTmFtZSArICI+IjsNCgkJCQkJCXZhciBzdGFydEluZGV4ID0gMDsNCgkJCQkJCXZhciBzZWFyY2hJbmRleCwgbWF0Y2hlZFRleHQsIHRleHRCZWZvcmVNYXRjaDsNCgkJCQkJCWlmICh0aGlzLmlzUmVnZXgpIHsNCgkJCQkJCQl2YXIgZmxhZ3MgPSB0aGlzLmlzQ2FzZVNlbnNpdGl2ZSA/ICJnIiA6ICJnaSI7DQoJCQkJCQkJdmFyIGNhcHR1cmluZ1JlZ2V4ID0gbmV3IFJlZ0V4cCgiKCIgKyB0aGlzLnNlYXJjaFJlZ2V4LnNvdXJjZSArICIpIiwgZmxhZ3MpOw0KDQoJCQkJCQkJLy8gUmVwbGFjZSB0aGUgc2VhcmNoIHRlcm0gd2l0aCB0ZW1wb3JhcnkgdG9rZW5zIGZvciB0aGUgc3RhcnQgYW5kIGVuZCB0YWdzDQoJCQkJCQkJdmFyIHJuZCA9ICgiIiArIE1hdGgucmFuZG9tKCkpLnN1YnN0cigyKTsNCgkJCQkJCQl2YXIgc3RhcnRUb2tlbiA9ICIlJXMiICsgcm5kICsgIiUlIjsNCgkJCQkJCQl2YXIgZW5kVG9rZW4gPSAiJSVlIiArIHJuZCArICIlJSI7DQoJCQkJCQkJbG9nRW50cnlDb250ZW50ID0gbG9nRW50cnkuZm9ybWF0dGVkTWVzc2FnZS5yZXBsYWNlKGNhcHR1cmluZ1JlZ2V4LCBzdGFydFRva2VuICsgIiQxIiArIGVuZFRva2VuKTsNCg0KCQkJCQkJCS8vIEVzY2FwZSB0aGUgSFRNTCB0byBnZXQgcmlkIG9mIGFuZ2xlIGJyYWNrZXRzDQoJCQkJCQkJbG9nRW50cnlDb250ZW50ID0gZXNjYXBlSHRtbChsb2dFbnRyeUNvbnRlbnQpOw0KDQoJCQkJCQkJLy8gU3Vic3RpdHV0ZSB0aGUgcHJvcGVyIEhUTUwgYmFjayBpbiBmb3IgdGhlIHNlYXJjaCBtYXRjaA0KCQkJCQkJCXZhciByZXN1bHQ7DQoJCQkJCQkJdmFyIHNlYXJjaFN0cmluZyA9IGxvZ0VudHJ5Q29udGVudDsNCgkJCQkJCQlsb2dFbnRyeUNvbnRlbnQgPSAiIjsNCgkJCQkJCQl3cmFwcGVkTG9nRW50cnlDb250ZW50ID0gIiI7DQoJCQkJCQkJd2hpbGUgKChzZWFyY2hJbmRleCA9IHNlYXJjaFN0cmluZy5pbmRleE9mKHN0YXJ0VG9rZW4sIHN0YXJ0SW5kZXgpKSA+IC0xKSB7DQoJCQkJCQkJCXZhciBlbmRUb2tlbkluZGV4ID0gc2VhcmNoU3RyaW5nLmluZGV4T2YoZW5kVG9rZW4sIHNlYXJjaEluZGV4KTsNCgkJCQkJCQkJbWF0Y2hlZFRleHQgPSBzZWFyY2hTdHJpbmcuc3Vic3RyaW5nKHNlYXJjaEluZGV4ICsgc3RhcnRUb2tlbi5sZW5ndGgsIGVuZFRva2VuSW5kZXgpOw0KCQkJCQkJCQl0ZXh0QmVmb3JlTWF0Y2ggPSBzZWFyY2hTdHJpbmcuc3Vic3RyaW5nKHN0YXJ0SW5kZXgsIHNlYXJjaEluZGV4KTsNCgkJCQkJCQkJbG9nRW50cnlDb250ZW50ICs9IHByZVN0YXJ0VGFnICsgdGV4dEJlZm9yZU1hdGNoICsgcHJlRW5kVGFnOw0KCQkJCQkJCQlsb2dFbnRyeUNvbnRlbnQgKz0gc2VhcmNoVGVybVJlcGxhY2VtZW50U3RhcnRUYWcgKyBwcmVTdGFydFRhZyArIG1hdGNoZWRUZXh0ICsNCgkJCQkJCQkJCXByZUVuZFRhZyArIHNlYXJjaFRlcm1SZXBsYWNlbWVudEVuZFRhZzsNCgkJCQkJCQkJaWYgKGlzSWUpIHsNCgkJCQkJCQkJCXdyYXBwZWRMb2dFbnRyeUNvbnRlbnQgKz0gdGV4dEJlZm9yZU1hdGNoICsgc2VhcmNoVGVybVJlcGxhY2VtZW50U3RhcnRUYWcgKw0KCQkJCQkJCQkJCW1hdGNoZWRUZXh0ICsgc2VhcmNoVGVybVJlcGxhY2VtZW50RW5kVGFnOw0KCQkJCQkJCQl9DQoJCQkJCQkJCXN0YXJ0SW5kZXggPSBlbmRUb2tlbkluZGV4ICsgZW5kVG9rZW4ubGVuZ3RoOw0KCQkJCQkJCX0NCgkJCQkJCQlsb2dFbnRyeUNvbnRlbnQgKz0gcHJlU3RhcnRUYWcgKyBzZWFyY2hTdHJpbmcuc3Vic3RyKHN0YXJ0SW5kZXgpICsgcHJlRW5kVGFnOw0KCQkJCQkJCWlmIChpc0llKSB7DQoJCQkJCQkJCXdyYXBwZWRMb2dFbnRyeUNvbnRlbnQgKz0gc2VhcmNoU3RyaW5nLnN1YnN0cihzdGFydEluZGV4KTsNCgkJCQkJCQl9DQoJCQkJCQl9IGVsc2Ugew0KCQkJCQkJCWxvZ0VudHJ5Q29udGVudCA9ICIiOw0KCQkJCQkJCXdyYXBwZWRMb2dFbnRyeUNvbnRlbnQgPSAiIjsNCgkJCQkJCQl2YXIgc2VhcmNoVGVybVJlcGxhY2VtZW50TGVuZ3RoID0gc2VhcmNoVGVybVJlcGxhY2VtZW50U3RhcnRUYWcubGVuZ3RoICsNCgkJCQkJCQkJdGhpcy5zZWFyY2hUZXJtLmxlbmd0aCArIHNlYXJjaFRlcm1SZXBsYWNlbWVudEVuZFRhZy5sZW5ndGg7DQoJCQkJCQkJdmFyIHNlYXJjaFRlcm1MZW5ndGggPSB0aGlzLnNlYXJjaFRlcm0ubGVuZ3RoOw0KCQkJCQkJCXZhciBzZWFyY2hUZXJtTG93ZXJDYXNlID0gdGhpcy5zZWFyY2hUZXJtLnRvTG93ZXJDYXNlKCk7DQoJCQkJCQkJdmFyIGxvZ1RleHRMb3dlckNhc2UgPSBsb2dFbnRyeS5mb3JtYXR0ZWRNZXNzYWdlLnRvTG93ZXJDYXNlKCk7DQoJCQkJCQkJd2hpbGUgKChzZWFyY2hJbmRleCA9IGxvZ1RleHRMb3dlckNhc2UuaW5kZXhPZihzZWFyY2hUZXJtTG93ZXJDYXNlLCBzdGFydEluZGV4KSkgPiAtMSkgew0KCQkJCQkJCQltYXRjaGVkVGV4dCA9IGVzY2FwZUh0bWwobG9nRW50cnkuZm9ybWF0dGVkTWVzc2FnZS5zdWJzdHIoc2VhcmNoSW5kZXgsIHRoaXMuc2VhcmNoVGVybS5sZW5ndGgpKTsNCgkJCQkJCQkJdGV4dEJlZm9yZU1hdGNoID0gZXNjYXBlSHRtbChsb2dFbnRyeS5mb3JtYXR0ZWRNZXNzYWdlLnN1YnN0cmluZyhzdGFydEluZGV4LCBzZWFyY2hJbmRleCkpOw0KCQkJCQkJCQl2YXIgc2VhcmNoVGVybVJlcGxhY2VtZW50ID0gc2VhcmNoVGVybVJlcGxhY2VtZW50U3RhcnRUYWcgKw0KCQkJCQkJCQkJcHJlU3RhcnRUYWcgKyBtYXRjaGVkVGV4dCArIHByZUVuZFRhZyArIHNlYXJjaFRlcm1SZXBsYWNlbWVudEVuZFRhZzsNCgkJCQkJCQkJbG9nRW50cnlDb250ZW50ICs9IHByZVN0YXJ0VGFnICsgdGV4dEJlZm9yZU1hdGNoICsgcHJlRW5kVGFnICsgc2VhcmNoVGVybVJlcGxhY2VtZW50Ow0KCQkJCQkJCQlpZiAoaXNJZSkgew0KCQkJCQkJCQkJd3JhcHBlZExvZ0VudHJ5Q29udGVudCArPSB0ZXh0QmVmb3JlTWF0Y2ggKyBzZWFyY2hUZXJtUmVwbGFjZW1lbnRTdGFydFRhZyArDQoJCQkJCQkJCQkJbWF0Y2hlZFRleHQgKyBzZWFyY2hUZXJtUmVwbGFjZW1lbnRFbmRUYWc7DQoJCQkJCQkJCX0NCgkJCQkJCQkJc3RhcnRJbmRleCA9IHNlYXJjaEluZGV4ICsgc2VhcmNoVGVybUxlbmd0aDsNCgkJCQkJCQl9DQoJCQkJCQkJdmFyIHRleHRBZnRlckxhc3RNYXRjaCA9IGVzY2FwZUh0bWwobG9nRW50cnkuZm9ybWF0dGVkTWVzc2FnZS5zdWJzdHIoc3RhcnRJbmRleCkpOw0KCQkJCQkJCWxvZ0VudHJ5Q29udGVudCArPSBwcmVTdGFydFRhZyArIHRleHRBZnRlckxhc3RNYXRjaCArIHByZUVuZFRhZzsNCgkJCQkJCQlpZiAoaXNJZSkgew0KCQkJCQkJCQl3cmFwcGVkTG9nRW50cnlDb250ZW50ICs9IHRleHRBZnRlckxhc3RNYXRjaDsNCgkJCQkJCQl9DQoJCQkJCQl9DQoJCQkJCQlsb2dFbnRyeS5zZXRDb250ZW50KGxvZ0VudHJ5Q29udGVudCwgd3JhcHBlZExvZ0VudHJ5Q29udGVudCk7DQoJCQkJCQl2YXIgbG9nRW50cnlNYXRjaGVzID0gbG9nRW50cnkuZ2V0U2VhcmNoTWF0Y2hlcygpOw0KCQkJCQkJdGhpcy5tYXRjaGVzID0gdGhpcy5tYXRjaGVzLmNvbmNhdChsb2dFbnRyeU1hdGNoZXMpOw0KCQkJCQl9IGVsc2Ugew0KCQkJCQkJbG9nRW50cnkuc2V0U2VhcmNoTWF0Y2goZmFsc2UpOw0KCQkJCQkJbG9nRW50cnkuc2V0Q29udGVudChsb2dFbnRyeS5mb3JtYXR0ZWRNZXNzYWdlLCBsb2dFbnRyeS5mb3JtYXR0ZWRNZXNzYWdlKTsNCgkJCQkJfQ0KCQkJCQlyZXR1cm4gZG9lc01hdGNoOw0KCQkJCX0sDQoNCgkJCQlyZW1vdmVNYXRjaGVzOiBmdW5jdGlvbihsb2dFbnRyaWVzKSB7DQoJCQkJCXZhciBtYXRjaGVzVG9SZW1vdmVDb3VudCA9IDA7DQoJCQkJCXZhciBjdXJyZW50TWF0Y2hSZW1vdmVkID0gZmFsc2U7DQoJCQkJCXZhciBtYXRjaGVzVG9SZW1vdmUgPSBbXTsNCgkJCQkJdmFyIGksIGlMZW4sIGosIGpMZW47DQoNCgkJCQkJLy8gRXN0YWJsaXNoIHRoZSBsaXN0IG9mIG1hdGNoZXMgdG8gYmUgcmVtb3ZlZA0KCQkJCQlmb3IgKGkgPSAwLCBpTGVuID0gdGhpcy5tYXRjaGVzLmxlbmd0aDsgaSA8IGlMZW47IGkrKykgew0KCQkJCQkJZm9yIChqID0gMCwgakxlbiA9IGxvZ0VudHJpZXMubGVuZ3RoOyBqIDwgakxlbjsgaisrKSB7DQoJCQkJCQkJaWYgKHRoaXMubWF0Y2hlc1tpXS5iZWxvbmdzVG8obG9nRW50cmllc1tqXSkpIHsNCgkJCQkJCQkJbWF0Y2hlc1RvUmVtb3ZlLnB1c2godGhpcy5tYXRjaGVzW2ldKTsNCgkJCQkJCQkJaWYgKGkgPT09IGN1cnJlbnRNYXRjaEluZGV4KSB7DQoJCQkJCQkJCQljdXJyZW50TWF0Y2hSZW1vdmVkID0gdHJ1ZTsNCgkJCQkJCQkJfQ0KCQkJCQkJCX0NCgkJCQkJCX0NCgkJCQkJfQ0KDQoJCQkJCS8vIFNldCB0aGUgbmV3IGN1cnJlbnQgbWF0Y2ggaW5kZXggaWYgdGhlIGN1cnJlbnQgbWF0Y2ggaGFzIGJlZW4gZGVsZXRlZA0KCQkJCQkvLyBUaGlzIHdpbGwgYmUgdGhlIGZpcnN0IG1hdGNoIHRoYXQgYXBwZWFycyBhZnRlciB0aGUgZmlyc3QgbG9nIGVudHJ5IGJlaW5nDQoJCQkJCS8vIGRlbGV0ZWQsIGlmIG9uZSBleGlzdHM7IG90aGVyd2lzZSwgaXQncyB0aGUgZmlyc3QgbWF0Y2ggb3ZlcmFsbA0KCQkJCQl2YXIgbmV3TWF0Y2ggPSBjdXJyZW50TWF0Y2hSZW1vdmVkID8gbnVsbCA6IHRoaXMubWF0Y2hlc1tjdXJyZW50TWF0Y2hJbmRleF07DQoJCQkJCWlmIChjdXJyZW50TWF0Y2hSZW1vdmVkKSB7DQoJCQkJCQlmb3IgKGkgPSBjdXJyZW50TWF0Y2hJbmRleCwgaUxlbiA9IHRoaXMubWF0Y2hlcy5sZW5ndGg7IGkgPCBpTGVuOyBpKyspIHsNCgkJCQkJCQlpZiAodGhpcy5tYXRjaGVzW2ldLmlzVmlzaWJsZSgpICYmICFhcnJheV9jb250YWlucyhtYXRjaGVzVG9SZW1vdmUsIHRoaXMubWF0Y2hlc1tpXSkpIHsNCgkJCQkJCQkJbmV3TWF0Y2ggPSB0aGlzLm1hdGNoZXNbaV07DQoJCQkJCQkJCWJyZWFrOw0KCQkJCQkJCX0NCgkJCQkJCX0NCgkJCQkJfQ0KDQoJCQkJCS8vIFJlbW92ZSB0aGUgbWF0Y2hlcw0KCQkJCQlmb3IgKGkgPSAwLCBpTGVuID0gbWF0Y2hlc1RvUmVtb3ZlLmxlbmd0aDsgaSA8IGlMZW47IGkrKykgew0KCQkJCQkJYXJyYXlfcmVtb3ZlKHRoaXMubWF0Y2hlcywgbWF0Y2hlc1RvUmVtb3ZlW2ldKTsNCgkJCQkJCW1hdGNoZXNUb1JlbW92ZVtpXS5yZW1vdmUoKTsNCgkJCQkJfQ0KDQoJCQkJCS8vIFNldCB0aGUgbmV3IG1hdGNoLCBpZiBvbmUgZXhpc3RzDQoJCQkJCWlmICh0aGlzLmhhc1Zpc2libGVNYXRjaGVzKCkpIHsNCgkJCQkJCWlmIChuZXdNYXRjaCA9PT0gbnVsbCkgew0KCQkJCQkJCXNldEN1cnJlbnRNYXRjaEluZGV4KDApOw0KCQkJCQkJfSBlbHNlIHsNCgkJCQkJCQkvLyBHZXQgdGhlIGluZGV4IG9mIHRoZSBuZXcgbWF0Y2gNCgkJCQkJCQl2YXIgbmV3TWF0Y2hJbmRleCA9IDA7DQoJCQkJCQkJZm9yIChpID0gMCwgaUxlbiA9IHRoaXMubWF0Y2hlcy5sZW5ndGg7IGkgPCBpTGVuOyBpKyspIHsNCgkJCQkJCQkJaWYgKG5ld01hdGNoID09PSB0aGlzLm1hdGNoZXNbaV0pIHsNCgkJCQkJCQkJCW5ld01hdGNoSW5kZXggPSBpOw0KCQkJCQkJCQkJYnJlYWs7DQoJCQkJCQkJCX0NCgkJCQkJCQl9DQoJCQkJCQkJc2V0Q3VycmVudE1hdGNoSW5kZXgobmV3TWF0Y2hJbmRleCk7DQoJCQkJCQl9DQoJCQkJCX0gZWxzZSB7DQoJCQkJCQljdXJyZW50TWF0Y2hJbmRleCA9IG51bGw7DQoJCQkJCQlkaXNwbGF5Tm9NYXRjaGVzKCk7DQoJCQkJCX0NCgkJCQl9DQoJCQl9Ow0KDQoJCQlmdW5jdGlvbiBnZXRQYWdlT2Zmc2V0VG9wKGVsLCBjb250YWluZXIpIHsNCgkJCQl2YXIgY3VycmVudEVsID0gZWw7DQoJCQkJdmFyIHkgPSAwOw0KCQkJCXdoaWxlIChjdXJyZW50RWwgJiYgY3VycmVudEVsICE9IGNvbnRhaW5lcikgew0KCQkJCQl5ICs9IGN1cnJlbnRFbC5vZmZzZXRUb3A7DQoJCQkJCWN1cnJlbnRFbCA9IGN1cnJlbnRFbC5vZmZzZXRQYXJlbnQ7DQoJCQkJfQ0KCQkJCXJldHVybiB5Ow0KCQkJfQ0KDQoJCQlmdW5jdGlvbiBzY3JvbGxJbnRvVmlldyhlbCkgew0KCQkJCXZhciBsb2dDb250YWluZXIgPSBsb2dNYWluQ29udGFpbmVyOw0KCQkJCS8vIENoZWNrIGlmIHRoZSB3aG9sZSB3aWR0aCBvZiB0aGUgZWxlbWVudCBpcyB2aXNpYmxlIGFuZCBjZW50cmUgaWYgbm90DQoJCQkJaWYgKCEkKCJ3cmFwIikuY2hlY2tlZCkgew0KCQkJCQl2YXIgbG9nQ29udGFpbmVyTGVmdCA9IGxvZ0NvbnRhaW5lci5zY3JvbGxMZWZ0Ow0KCQkJCQl2YXIgbG9nQ29udGFpbmVyUmlnaHQgPSBsb2dDb250YWluZXJMZWZ0ICArIGxvZ0NvbnRhaW5lci5vZmZzZXRXaWR0aDsNCgkJCQkJdmFyIGVsTGVmdCA9IGVsLm9mZnNldExlZnQ7DQoJCQkJCXZhciBlbFJpZ2h0ID0gZWxMZWZ0ICsgZWwub2Zmc2V0V2lkdGg7DQoJCQkJCWlmIChlbExlZnQgPCBsb2dDb250YWluZXJMZWZ0IHx8IGVsUmlnaHQgPiBsb2dDb250YWluZXJSaWdodCkgew0KCQkJCQkJbG9nQ29udGFpbmVyLnNjcm9sbExlZnQgPSBlbExlZnQgLSAobG9nQ29udGFpbmVyLm9mZnNldFdpZHRoIC0gZWwub2Zmc2V0V2lkdGgpIC8gMjsNCgkJCQkJfQ0KCQkJCX0NCgkJCQkvLyBDaGVjayBpZiB0aGUgd2hvbGUgaGVpZ2h0IG9mIHRoZSBlbGVtZW50IGlzIHZpc2libGUgYW5kIGNlbnRyZSBpZiBub3QNCgkJCQl2YXIgbG9nQ29udGFpbmVyVG9wID0gbG9nQ29udGFpbmVyLnNjcm9sbFRvcDsNCgkJCQl2YXIgbG9nQ29udGFpbmVyQm90dG9tID0gbG9nQ29udGFpbmVyVG9wICArIGxvZ0NvbnRhaW5lci5vZmZzZXRIZWlnaHQ7DQoJCQkJdmFyIGVsVG9wID0gZ2V0UGFnZU9mZnNldFRvcChlbCkgLSBnZXRUb29sQmFyc0hlaWdodCgpOw0KCQkJCXZhciBlbEJvdHRvbSA9IGVsVG9wICsgZWwub2Zmc2V0SGVpZ2h0Ow0KCQkJCWlmIChlbFRvcCA8IGxvZ0NvbnRhaW5lclRvcCB8fCBlbEJvdHRvbSA+IGxvZ0NvbnRhaW5lckJvdHRvbSkgew0KCQkJCQlsb2dDb250YWluZXIuc2Nyb2xsVG9wID0gZWxUb3AgLSAobG9nQ29udGFpbmVyLm9mZnNldEhlaWdodCAtIGVsLm9mZnNldEhlaWdodCkgLyAyOw0KCQkJCX0NCgkJCX0NCg0KCQkJZnVuY3Rpb24gTWF0Y2gobG9nRW50cnlMZXZlbCwgc3BhbkluTWFpbkRpdiwgc3BhbkluVW53cmFwcGVkUHJlLCBzcGFuSW5XcmFwcGVkRGl2KSB7DQoJCQkJdGhpcy5sb2dFbnRyeUxldmVsID0gbG9nRW50cnlMZXZlbDsNCgkJCQl0aGlzLnNwYW5Jbk1haW5EaXYgPSBzcGFuSW5NYWluRGl2Ow0KCQkJCWlmIChpc0llKSB7DQoJCQkJCXRoaXMuc3BhbkluVW53cmFwcGVkUHJlID0gc3BhbkluVW53cmFwcGVkUHJlOw0KCQkJCQl0aGlzLnNwYW5JbldyYXBwZWREaXYgPSBzcGFuSW5XcmFwcGVkRGl2Ow0KCQkJCX0NCgkJCQl0aGlzLm1haW5TcGFuID0gaXNJZSA/IHNwYW5JblVud3JhcHBlZFByZSA6IHNwYW5Jbk1haW5EaXY7DQoJCQl9DQoNCgkJCU1hdGNoLnByb3RvdHlwZSA9IHsNCgkJCQllcXVhbHM6IGZ1bmN0aW9uKG1hdGNoKSB7DQoJCQkJCXJldHVybiB0aGlzLm1haW5TcGFuID09PSBtYXRjaC5tYWluU3BhbjsNCgkJCQl9LA0KDQoJCQkJc2V0Q3VycmVudDogZnVuY3Rpb24oKSB7DQoJCQkJCWlmIChpc0llKSB7DQoJCQkJCQlhZGRDbGFzcyh0aGlzLnNwYW5JblVud3JhcHBlZFByZSwgImN1cnJlbnRtYXRjaCIpOw0KCQkJCQkJYWRkQ2xhc3ModGhpcy5zcGFuSW5XcmFwcGVkRGl2LCAiY3VycmVudG1hdGNoIik7DQoJCQkJCQkvLyBTY3JvbGwgdGhlIHZpc2libGUgb25lIGludG8gdmlldw0KCQkJCQkJdmFyIGVsZW1lbnRUb1Njcm9sbCA9ICQoIndyYXAiKS5jaGVja2VkID8gdGhpcy5zcGFuSW5XcmFwcGVkRGl2IDogdGhpcy5zcGFuSW5VbndyYXBwZWRQcmU7DQoJCQkJCQlzY3JvbGxJbnRvVmlldyhlbGVtZW50VG9TY3JvbGwpOw0KCQkJCQl9IGVsc2Ugew0KCQkJCQkJYWRkQ2xhc3ModGhpcy5zcGFuSW5NYWluRGl2LCAiY3VycmVudG1hdGNoIik7DQoJCQkJCQlzY3JvbGxJbnRvVmlldyh0aGlzLnNwYW5Jbk1haW5EaXYpOw0KCQkJCQl9DQoJCQkJfSwNCg0KCQkJCWJlbG9uZ3NUbzogZnVuY3Rpb24obG9nRW50cnkpIHsNCgkJCQkJaWYgKGlzSWUpIHsNCgkJCQkJCXJldHVybiBpc0Rlc2NlbmRhbnQodGhpcy5zcGFuSW5VbndyYXBwZWRQcmUsIGxvZ0VudHJ5LnVud3JhcHBlZFByZSk7DQoJCQkJCX0gZWxzZSB7DQoJCQkJCQlyZXR1cm4gaXNEZXNjZW5kYW50KHRoaXMuc3BhbkluTWFpbkRpdiwgbG9nRW50cnkubWFpbkRpdik7DQoJCQkJCX0NCgkJCQl9LA0KDQoJCQkJc2V0Tm90Q3VycmVudDogZnVuY3Rpb24oKSB7DQoJCQkJCWlmIChpc0llKSB7DQoJCQkJCQlyZW1vdmVDbGFzcyh0aGlzLnNwYW5JblVud3JhcHBlZFByZSwgImN1cnJlbnRtYXRjaCIpOw0KCQkJCQkJcmVtb3ZlQ2xhc3ModGhpcy5zcGFuSW5XcmFwcGVkRGl2LCAiY3VycmVudG1hdGNoIik7DQoJCQkJCX0gZWxzZSB7DQoJCQkJCQlyZW1vdmVDbGFzcyh0aGlzLnNwYW5Jbk1haW5EaXYsICJjdXJyZW50bWF0Y2giKTsNCgkJCQkJfQ0KCQkJCX0sDQoNCgkJCQlpc09ycGhhbjogZnVuY3Rpb24oKSB7DQoJCQkJCXJldHVybiBpc09ycGhhbih0aGlzLm1haW5TcGFuKTsNCgkJCQl9LA0KDQoJCQkJaXNWaXNpYmxlOiBmdW5jdGlvbigpIHsNCgkJCQkJcmV0dXJuIGdldENoZWNrQm94KHRoaXMubG9nRW50cnlMZXZlbCkuY2hlY2tlZDsNCgkJCQl9LA0KDQoJCQkJcmVtb3ZlOiBmdW5jdGlvbigpIHsNCgkJCQkJaWYgKGlzSWUpIHsNCgkJCQkJCXRoaXMuc3BhbkluVW53cmFwcGVkUHJlID0gbnVsbDsNCgkJCQkJCXRoaXMuc3BhbkluV3JhcHBlZERpdiA9IG51bGw7DQoJCQkJCX0gZWxzZSB7DQoJCQkJCQl0aGlzLnNwYW5Jbk1haW5EaXYgPSBudWxsOw0KCQkJCQl9DQoJCQkJfQ0KCQkJfTsNCg0KCQkJdmFyIGN1cnJlbnRTZWFyY2ggPSBudWxsOw0KCQkJdmFyIGN1cnJlbnRNYXRjaEluZGV4ID0gbnVsbDsNCg0KCQkJZnVuY3Rpb24gZG9TZWFyY2goKSB7DQoJCQkJdmFyIHNlYXJjaEJveCA9ICQoInNlYXJjaEJveCIpOw0KCQkJCXZhciBzZWFyY2hUZXJtID0gc2VhcmNoQm94LnZhbHVlOw0KCQkJCXZhciBpc1JlZ2V4ID0gJCgic2VhcmNoUmVnZXgiKS5jaGVja2VkOw0KCQkJCXZhciBpc0Nhc2VTZW5zaXRpdmUgPSAkKCJzZWFyY2hDYXNlU2Vuc2l0aXZlIikuY2hlY2tlZDsNCgkJCQl2YXIgaTsNCg0KCQkJCWlmIChzZWFyY2hUZXJtID09PSAiIikgew0KCQkJCQkkKCJzZWFyY2hSZXNldCIpLmRpc2FibGVkID0gdHJ1ZTsNCgkJCQkJJCgic2VhcmNoTmF2Iikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsNCgkJCQkJcmVtb3ZlQ2xhc3MoZG9jdW1lbnQuYm9keSwgInNlYXJjaGluZyIpOw0KCQkJCQlyZW1vdmVDbGFzcyhzZWFyY2hCb3gsICJoYXNtYXRjaGVzIik7DQoJCQkJCXJlbW92ZUNsYXNzKHNlYXJjaEJveCwgIm5vbWF0Y2hlcyIpOw0KCQkJCQlmb3IgKGkgPSAwOyBpIDwgbG9nRW50cmllcy5sZW5ndGg7IGkrKykgew0KCQkJCQkJbG9nRW50cmllc1tpXS5jbGVhclNlYXJjaCgpOw0KCQkJCQkJbG9nRW50cmllc1tpXS5zZXRDb250ZW50KGxvZ0VudHJpZXNbaV0uZm9ybWF0dGVkTWVzc2FnZSwgbG9nRW50cmllc1tpXS5mb3JtYXR0ZWRNZXNzYWdlKTsNCgkJCQkJfQ0KCQkJCQljdXJyZW50U2VhcmNoID0gbnVsbDsNCgkJCQkJc2V0TG9nQ29udGFpbmVySGVpZ2h0KCk7DQoJCQkJfSBlbHNlIHsNCgkJCQkJJCgic2VhcmNoUmVzZXQiKS5kaXNhYmxlZCA9IGZhbHNlOw0KCQkJCQkkKCJzZWFyY2hOYXYiKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsNCgkJCQkJdmFyIHNlYXJjaFJlZ2V4Ow0KCQkJCQl2YXIgcmVnZXhWYWxpZDsNCgkJCQkJaWYgKGlzUmVnZXgpIHsNCgkJCQkJCXRyeSB7DQoJCQkJCQkJc2VhcmNoUmVnZXggPSBpc0Nhc2VTZW5zaXRpdmUgPyBuZXcgUmVnRXhwKHNlYXJjaFRlcm0sICJnIikgOiBuZXcgUmVnRXhwKHNlYXJjaFRlcm0sICJnaSIpOw0KCQkJCQkJCXJlZ2V4VmFsaWQgPSB0cnVlOw0KCQkJCQkJCXJlcGxhY2VDbGFzcyhzZWFyY2hCb3gsICJ2YWxpZHJlZ2V4IiwgImludmFsaWRyZWdleCIpOw0KCQkJCQkJCXNlYXJjaEJveC50aXRsZSA9ICJWYWxpZCByZWdleCI7DQoJCQkJCQl9IGNhdGNoIChleCkgew0KCQkJCQkJCXJlZ2V4VmFsaWQgPSBmYWxzZTsNCgkJCQkJCQlyZXBsYWNlQ2xhc3Moc2VhcmNoQm94LCAiaW52YWxpZHJlZ2V4IiwgInZhbGlkcmVnZXgiKTsNCgkJCQkJCQlzZWFyY2hCb3gudGl0bGUgPSAiSW52YWxpZCByZWdleDogIiArIChleC5tZXNzYWdlID8gZXgubWVzc2FnZSA6IChleC5kZXNjcmlwdGlvbiA/IGV4LmRlc2NyaXB0aW9uIDogInVua25vd24gZXJyb3IiKSk7DQoJCQkJCQkJcmV0dXJuOw0KCQkJCQkJfQ0KCQkJCQl9IGVsc2Ugew0KCQkJCQkJc2VhcmNoQm94LnRpdGxlID0gIiI7DQoJCQkJCQlyZW1vdmVDbGFzcyhzZWFyY2hCb3gsICJ2YWxpZHJlZ2V4Iik7DQoJCQkJCQlyZW1vdmVDbGFzcyhzZWFyY2hCb3gsICJpbnZhbGlkcmVnZXgiKTsNCgkJCQkJfQ0KCQkJCQlhZGRDbGFzcyhkb2N1bWVudC5ib2R5LCAic2VhcmNoaW5nIik7DQoJCQkJCWN1cnJlbnRTZWFyY2ggPSBuZXcgU2VhcmNoKHNlYXJjaFRlcm0sIGlzUmVnZXgsIHNlYXJjaFJlZ2V4LCBpc0Nhc2VTZW5zaXRpdmUpOw0KCQkJCQlmb3IgKGkgPSAwOyBpIDwgbG9nRW50cmllcy5sZW5ndGg7IGkrKykgew0KCQkJCQkJY3VycmVudFNlYXJjaC5hcHBseVRvKGxvZ0VudHJpZXNbaV0pOw0KCQkJCQl9DQoJCQkJCXNldExvZ0NvbnRhaW5lckhlaWdodCgpOw0KDQoJCQkJCS8vIEhpZ2hsaWdodCB0aGUgZmlyc3Qgc2VhcmNoIG1hdGNoDQoJCQkJCWlmIChjdXJyZW50U2VhcmNoLmhhc1Zpc2libGVNYXRjaGVzKCkpIHsNCgkJCQkJCXNldEN1cnJlbnRNYXRjaEluZGV4KDApOw0KCQkJCQkJZGlzcGxheU1hdGNoZXMoKTsNCgkJCQkJfSBlbHNlIHsNCgkJCQkJCWRpc3BsYXlOb01hdGNoZXMoKTsNCgkJCQkJfQ0KCQkJCX0NCgkJCX0NCg0KCQkJZnVuY3Rpb24gdXBkYXRlU2VhcmNoRnJvbUZpbHRlcnMoKSB7DQoJCQkJaWYgKGN1cnJlbnRTZWFyY2gpIHsNCgkJCQkJaWYgKGN1cnJlbnRTZWFyY2guaGFzTWF0Y2hlcygpKSB7DQoJCQkJCQlpZiAoY3VycmVudE1hdGNoSW5kZXggPT09IG51bGwpIHsNCgkJCQkJCQljdXJyZW50TWF0Y2hJbmRleCA9IDA7DQoJCQkJCQl9DQoJCQkJCQl2YXIgY3VycmVudE1hdGNoID0gY3VycmVudFNlYXJjaC5tYXRjaGVzW2N1cnJlbnRNYXRjaEluZGV4XTsNCgkJCQkJCWlmIChjdXJyZW50TWF0Y2guaXNWaXNpYmxlKCkpIHsNCgkJCQkJCQlkaXNwbGF5TWF0Y2hlcygpOw0KCQkJCQkJCXNldEN1cnJlbnRNYXRjaEluZGV4KGN1cnJlbnRNYXRjaEluZGV4KTsNCgkJCQkJCX0gZWxzZSB7DQoJCQkJCQkJY3VycmVudE1hdGNoLnNldE5vdEN1cnJlbnQoKTsNCgkJCQkJCQkvLyBGaW5kIHRoZSBuZXh0IHZpc2libGUgbWF0Y2gsIGlmIG9uZSBleGlzdHMNCgkJCQkJCQl2YXIgbmV4dFZpc2libGVNYXRjaEluZGV4ID0gY3VycmVudFNlYXJjaC5nZXROZXh0VmlzaWJsZU1hdGNoSW5kZXgoKTsNCgkJCQkJCQlpZiAobmV4dFZpc2libGVNYXRjaEluZGV4ID4gLTEpIHsNCgkJCQkJCQkJc2V0Q3VycmVudE1hdGNoSW5kZXgobmV4dFZpc2libGVNYXRjaEluZGV4KTsNCgkJCQkJCQkJZGlzcGxheU1hdGNoZXMoKTsNCgkJCQkJCQl9IGVsc2Ugew0KCQkJCQkJCQlkaXNwbGF5Tm9NYXRjaGVzKCk7DQoJCQkJCQkJfQ0KCQkJCQkJfQ0KCQkJCQl9IGVsc2Ugew0KCQkJCQkJZGlzcGxheU5vTWF0Y2hlcygpOw0KCQkJCQl9DQoJCQkJfQ0KCQkJfQ0KDQoJCQlmdW5jdGlvbiByZWZyZXNoQ3VycmVudE1hdGNoKCkgew0KCQkJCWlmIChjdXJyZW50U2VhcmNoICYmIGN1cnJlbnRTZWFyY2guaGFzVmlzaWJsZU1hdGNoZXMoKSkgew0KCQkJCQlzZXRDdXJyZW50TWF0Y2hJbmRleChjdXJyZW50TWF0Y2hJbmRleCk7DQoJCQkJfQ0KCQkJfQ0KDQoJCQlmdW5jdGlvbiBkaXNwbGF5TWF0Y2hlcygpIHsNCgkJCQlyZXBsYWNlQ2xhc3MoJCgic2VhcmNoQm94IiksICJoYXNtYXRjaGVzIiwgIm5vbWF0Y2hlcyIpOw0KCQkJCSQoInNlYXJjaEJveCIpLnRpdGxlID0gIiIgKyBjdXJyZW50U2VhcmNoLm1hdGNoZXMubGVuZ3RoICsgIiBtYXRjaGVzIGZvdW5kIjsNCgkJCQkkKCJzZWFyY2hOYXYiKS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsNCgkJCQlzZXRMb2dDb250YWluZXJIZWlnaHQoKTsNCgkJCX0NCg0KCQkJZnVuY3Rpb24gZGlzcGxheU5vTWF0Y2hlcygpIHsNCgkJCQlyZXBsYWNlQ2xhc3MoJCgic2VhcmNoQm94IiksICJub21hdGNoZXMiLCAiaGFzbWF0Y2hlcyIpOw0KCQkJCSQoInNlYXJjaEJveCIpLnRpdGxlID0gIk5vIG1hdGNoZXMgZm91bmQiOw0KCQkJCSQoInNlYXJjaE5hdiIpLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7DQoJCQkJc2V0TG9nQ29udGFpbmVySGVpZ2h0KCk7DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIHRvZ2dsZVNlYXJjaEVuYWJsZWQoZW5hYmxlKSB7DQoJCQkJZW5hYmxlID0gKHR5cGVvZiBlbmFibGUgPT0gInVuZGVmaW5lZCIpID8gISQoInNlYXJjaERpc2FibGUiKS5jaGVja2VkIDogZW5hYmxlOw0KCQkJCSQoInNlYXJjaEJveCIpLmRpc2FibGVkID0gIWVuYWJsZTsNCgkJCQkkKCJzZWFyY2hSZXNldCIpLmRpc2FibGVkID0gIWVuYWJsZTsNCgkJCQkkKCJzZWFyY2hSZWdleCIpLmRpc2FibGVkID0gIWVuYWJsZTsNCgkJCQkkKCJzZWFyY2hOZXh0IikuZGlzYWJsZWQgPSAhZW5hYmxlOw0KCQkJCSQoInNlYXJjaFByZXZpb3VzIikuZGlzYWJsZWQgPSAhZW5hYmxlOw0KCQkJCSQoInNlYXJjaENhc2VTZW5zaXRpdmUiKS5kaXNhYmxlZCA9ICFlbmFibGU7DQoJCQkJJCgic2VhcmNoTmF2Iikuc3R5bGUuZGlzcGxheSA9IChlbmFibGUgJiYgKCQoInNlYXJjaEJveCIpLnZhbHVlICE9PSAiIikgJiYNCgkJCQkJCWN1cnJlbnRTZWFyY2ggJiYgY3VycmVudFNlYXJjaC5oYXNWaXNpYmxlTWF0Y2hlcygpKSA/DQoJCQkJCSJibG9jayIgOiAibm9uZSI7DQoJCQkJaWYgKGVuYWJsZSkgew0KCQkJCQlyZW1vdmVDbGFzcygkKCJzZWFyY2giKSwgImdyZXllZG91dCIpOw0KCQkJCQlhZGRDbGFzcyhkb2N1bWVudC5ib2R5LCAic2VhcmNoaW5nIik7DQoJCQkJCWlmICgkKCJzZWFyY2hIaWdobGlnaHQiKS5jaGVja2VkKSB7DQoJCQkJCQlhZGRDbGFzcyhsb2dNYWluQ29udGFpbmVyLCAic2VhcmNoaGlnaGxpZ2h0Iik7DQoJCQkJCX0gZWxzZSB7DQoJCQkJCQlyZW1vdmVDbGFzcyhsb2dNYWluQ29udGFpbmVyLCAic2VhcmNoaGlnaGxpZ2h0Iik7DQoJCQkJCX0NCgkJCQkJaWYgKCQoInNlYXJjaEZpbHRlciIpLmNoZWNrZWQpIHsNCgkJCQkJCWFkZENsYXNzKGxvZ01haW5Db250YWluZXIsICJzZWFyY2hmaWx0ZXIiKTsNCgkJCQkJfSBlbHNlIHsNCgkJCQkJCXJlbW92ZUNsYXNzKGxvZ01haW5Db250YWluZXIsICJzZWFyY2hmaWx0ZXIiKTsNCgkJCQkJfQ0KCQkJCQkkKCJzZWFyY2hEaXNhYmxlIikuY2hlY2tlZCA9ICFlbmFibGU7DQoJCQkJfSBlbHNlIHsNCgkJCQkJYWRkQ2xhc3MoJCgic2VhcmNoIiksICJncmV5ZWRvdXQiKTsNCgkJCQkJcmVtb3ZlQ2xhc3MoZG9jdW1lbnQuYm9keSwgInNlYXJjaGluZyIpOw0KCQkJCQlyZW1vdmVDbGFzcyhsb2dNYWluQ29udGFpbmVyLCAic2VhcmNoaGlnaGxpZ2h0Iik7DQoJCQkJCXJlbW92ZUNsYXNzKGxvZ01haW5Db250YWluZXIsICJzZWFyY2hmaWx0ZXIiKTsNCgkJCQl9DQoJCQkJc2V0TG9nQ29udGFpbmVySGVpZ2h0KCk7DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIHRvZ2dsZVNlYXJjaEZpbHRlcigpIHsNCgkJCQl2YXIgZW5hYmxlID0gJCgic2VhcmNoRmlsdGVyIikuY2hlY2tlZDsNCgkJCQlpZiAoZW5hYmxlKSB7DQoJCQkJCWFkZENsYXNzKGxvZ01haW5Db250YWluZXIsICJzZWFyY2hmaWx0ZXIiKTsNCgkJCQl9IGVsc2Ugew0KCQkJCQlyZW1vdmVDbGFzcyhsb2dNYWluQ29udGFpbmVyLCAic2VhcmNoZmlsdGVyIik7DQoJCQkJfQ0KCQkJCXJlZnJlc2hDdXJyZW50TWF0Y2goKTsNCgkJCX0NCg0KCQkJZnVuY3Rpb24gdG9nZ2xlU2VhcmNoSGlnaGxpZ2h0KCkgew0KCQkJCXZhciBlbmFibGUgPSAkKCJzZWFyY2hIaWdobGlnaHQiKS5jaGVja2VkOw0KCQkJCWlmIChlbmFibGUpIHsNCgkJCQkJYWRkQ2xhc3MobG9nTWFpbkNvbnRhaW5lciwgInNlYXJjaGhpZ2hsaWdodCIpOw0KCQkJCX0gZWxzZSB7DQoJCQkJCXJlbW92ZUNsYXNzKGxvZ01haW5Db250YWluZXIsICJzZWFyY2hoaWdobGlnaHQiKTsNCgkJCQl9DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIGNsZWFyU2VhcmNoKCkgew0KCQkJCSQoInNlYXJjaEJveCIpLnZhbHVlID0gIiI7DQoJCQkJZG9TZWFyY2goKTsNCgkJCX0NCg0KCQkJZnVuY3Rpb24gc2VhcmNoTmV4dCgpIHsNCgkJCQlpZiAoY3VycmVudFNlYXJjaCAhPT0gbnVsbCAmJiBjdXJyZW50TWF0Y2hJbmRleCAhPT0gbnVsbCkgew0KCQkJCQljdXJyZW50U2VhcmNoLm1hdGNoZXNbY3VycmVudE1hdGNoSW5kZXhdLnNldE5vdEN1cnJlbnQoKTsNCgkJCQkJdmFyIG5leHRNYXRjaEluZGV4ID0gY3VycmVudFNlYXJjaC5nZXROZXh0VmlzaWJsZU1hdGNoSW5kZXgoKTsNCgkJCQkJaWYgKG5leHRNYXRjaEluZGV4ID4gY3VycmVudE1hdGNoSW5kZXggfHwgY29uZmlybSgiUmVhY2hlZCB0aGUgZW5kIG9mIHRoZSBwYWdlLiBTdGFydCBmcm9tIHRoZSB0b3A/IikpIHsNCgkJCQkJCXNldEN1cnJlbnRNYXRjaEluZGV4KG5leHRNYXRjaEluZGV4KTsNCgkJCQkJfQ0KCQkJCX0NCgkJCX0NCg0KCQkJZnVuY3Rpb24gc2VhcmNoUHJldmlvdXMoKSB7DQoJCQkJaWYgKGN1cnJlbnRTZWFyY2ggIT09IG51bGwgJiYgY3VycmVudE1hdGNoSW5kZXggIT09IG51bGwpIHsNCgkJCQkJY3VycmVudFNlYXJjaC5tYXRjaGVzW2N1cnJlbnRNYXRjaEluZGV4XS5zZXROb3RDdXJyZW50KCk7DQoJCQkJCXZhciBwcmV2aW91c01hdGNoSW5kZXggPSBjdXJyZW50U2VhcmNoLmdldFByZXZpb3VzVmlzaWJsZU1hdGNoSW5kZXgoKTsNCgkJCQkJaWYgKHByZXZpb3VzTWF0Y2hJbmRleCA8IGN1cnJlbnRNYXRjaEluZGV4IHx8IGNvbmZpcm0oIlJlYWNoZWQgdGhlIHN0YXJ0IG9mIHRoZSBwYWdlLiBDb250aW51ZSBmcm9tIHRoZSBib3R0b20/IikpIHsNCgkJCQkJCXNldEN1cnJlbnRNYXRjaEluZGV4KHByZXZpb3VzTWF0Y2hJbmRleCk7DQoJCQkJCX0NCgkJCQl9DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIHNldEN1cnJlbnRNYXRjaEluZGV4KGluZGV4KSB7DQoJCQkJY3VycmVudE1hdGNoSW5kZXggPSBpbmRleDsNCgkJCQljdXJyZW50U2VhcmNoLm1hdGNoZXNbY3VycmVudE1hdGNoSW5kZXhdLnNldEN1cnJlbnQoKTsNCgkJCX0NCg0KCQkJLyogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqLw0KDQoJCQkvLyBDU1MgVXRpbGl0aWVzDQoNCgkJCWZ1bmN0aW9uIGFkZENsYXNzKGVsLCBjc3NDbGFzcykgew0KCQkJCWlmICghaGFzQ2xhc3MoZWwsIGNzc0NsYXNzKSkgew0KCQkJCQlpZiAoZWwuY2xhc3NOYW1lKSB7DQoJCQkJCQllbC5jbGFzc05hbWUgKz0gIiAiICsgY3NzQ2xhc3M7DQoJCQkJCX0gZWxzZSB7DQoJCQkJCQllbC5jbGFzc05hbWUgPSBjc3NDbGFzczsNCgkJCQkJfQ0KCQkJCX0NCgkJCX0NCg0KCQkJZnVuY3Rpb24gaGFzQ2xhc3MoZWwsIGNzc0NsYXNzKSB7DQoJCQkJaWYgKGVsLmNsYXNzTmFtZSkgew0KCQkJCQl2YXIgY2xhc3NOYW1lcyA9IGVsLmNsYXNzTmFtZS5zcGxpdCgiICIpOw0KCQkJCQlyZXR1cm4gYXJyYXlfY29udGFpbnMoY2xhc3NOYW1lcywgY3NzQ2xhc3MpOw0KCQkJCX0NCgkJCQlyZXR1cm4gZmFsc2U7DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIHJlbW92ZUNsYXNzKGVsLCBjc3NDbGFzcykgew0KCQkJCWlmIChoYXNDbGFzcyhlbCwgY3NzQ2xhc3MpKSB7DQoJCQkJCS8vIFJlYnVpbGQgdGhlIGNsYXNzTmFtZSBwcm9wZXJ0eQ0KCQkJCQl2YXIgZXhpc3RpbmdDbGFzc2VzID0gZWwuY2xhc3NOYW1lLnNwbGl0KCIgIik7DQoJCQkJCXZhciBuZXdDbGFzc2VzID0gW107DQoJCQkJCWZvciAodmFyIGkgPSAwLCBsZW4gPSBleGlzdGluZ0NsYXNzZXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsNCgkJCQkJCWlmIChleGlzdGluZ0NsYXNzZXNbaV0gIT0gY3NzQ2xhc3MpIHsNCgkJCQkJCQluZXdDbGFzc2VzW25ld0NsYXNzZXMubGVuZ3RoXSA9IGV4aXN0aW5nQ2xhc3Nlc1tpXTsNCgkJCQkJCX0NCgkJCQkJfQ0KCQkJCQllbC5jbGFzc05hbWUgPSBuZXdDbGFzc2VzLmpvaW4oIiAiKTsNCgkJCQl9DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIHJlcGxhY2VDbGFzcyhlbCwgbmV3Q3NzQ2xhc3MsIG9sZENzc0NsYXNzKSB7DQoJCQkJcmVtb3ZlQ2xhc3MoZWwsIG9sZENzc0NsYXNzKTsNCgkJCQlhZGRDbGFzcyhlbCwgbmV3Q3NzQ2xhc3MpOw0KCQkJfQ0KDQoJCQkvKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovDQoNCgkJCS8vIE90aGVyIHV0aWxpdHkgZnVuY3Rpb25zDQoNCgkJCWZ1bmN0aW9uIGdldEVsZW1lbnRzQnlDbGFzcyhlbCwgY3NzQ2xhc3MsIHRhZ05hbWUpIHsNCgkJCQl2YXIgZWxlbWVudHMgPSBlbC5nZXRFbGVtZW50c0J5VGFnTmFtZSh0YWdOYW1lKTsNCgkJCQl2YXIgbWF0Y2hlcyA9IFtdOw0KCQkJCWZvciAodmFyIGkgPSAwLCBsZW4gPSBlbGVtZW50cy5sZW5ndGg7IGkgPCBsZW47IGkrKykgew0KCQkJCQlpZiAoaGFzQ2xhc3MoZWxlbWVudHNbaV0sIGNzc0NsYXNzKSkgew0KCQkJCQkJbWF0Y2hlcy5wdXNoKGVsZW1lbnRzW2ldKTsNCgkJCQkJfQ0KCQkJCX0NCgkJCQlyZXR1cm4gbWF0Y2hlczsNCgkJCX0NCg0KCQkJLy8gU3ludGF4IGJvcnJvd2VkIGZyb20gUHJvdG90eXBlIGxpYnJhcnkNCgkJCWZ1bmN0aW9uICQoaWQpIHsNCgkJCQlyZXR1cm4gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpOw0KCQkJfQ0KDQoJCQlmdW5jdGlvbiBpc0Rlc2NlbmRhbnQobm9kZSwgYW5jZXN0b3JOb2RlKSB7DQoJCQkJd2hpbGUgKG5vZGUgIT0gbnVsbCkgew0KCQkJCQlpZiAobm9kZSA9PT0gYW5jZXN0b3JOb2RlKSB7DQoJCQkJCQlyZXR1cm4gdHJ1ZTsNCgkJCQkJfQ0KCQkJCQlub2RlID0gbm9kZS5wYXJlbnROb2RlOw0KCQkJCX0NCgkJCQlyZXR1cm4gZmFsc2U7DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIGlzT3JwaGFuKG5vZGUpIHsNCgkJCQl2YXIgY3VycmVudE5vZGUgPSBub2RlOw0KCQkJCXdoaWxlIChjdXJyZW50Tm9kZSkgew0KCQkJCQlpZiAoY3VycmVudE5vZGUgPT0gZG9jdW1lbnQuYm9keSkgew0KCQkJCQkJcmV0dXJuIGZhbHNlOw0KCQkJCQl9DQoJCQkJCWN1cnJlbnROb2RlID0gY3VycmVudE5vZGUucGFyZW50Tm9kZTsNCgkJCQl9DQoJCQkJcmV0dXJuIHRydWU7DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIGVzY2FwZUh0bWwoc3RyKSB7DQoJCQkJcmV0dXJuIHN0ci5yZXBsYWNlKC8mL2csICImYW1wOyIpLnJlcGxhY2UoL1s8XS9nLCAiJmx0OyIpLnJlcGxhY2UoLz4vZywgIiZndDsiKTsNCgkJCX0NCg0KCQkJZnVuY3Rpb24gZ2V0V2luZG93V2lkdGgoKSB7DQoJCQkJaWYgKHdpbmRvdy5pbm5lcldpZHRoKSB7DQoJCQkJCXJldHVybiB3aW5kb3cuaW5uZXJXaWR0aDsNCgkJCQl9IGVsc2UgaWYgKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCAmJiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGgpIHsNCgkJCQkJcmV0dXJuIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aDsNCgkJCQl9IGVsc2UgaWYgKGRvY3VtZW50LmJvZHkpIHsNCgkJCQkJcmV0dXJuIGRvY3VtZW50LmJvZHkuY2xpZW50V2lkdGg7DQoJCQkJfQ0KCQkJCXJldHVybiAwOw0KCQkJfQ0KDQoJCQlmdW5jdGlvbiBnZXRXaW5kb3dIZWlnaHQoKSB7DQoJCQkJaWYgKHdpbmRvdy5pbm5lckhlaWdodCkgew0KCQkJCQlyZXR1cm4gd2luZG93LmlubmVySGVpZ2h0Ow0KCQkJCX0gZWxzZSBpZiAoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50ICYmIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQpIHsNCgkJCQkJcmV0dXJuIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQ7DQoJCQkJfSBlbHNlIGlmIChkb2N1bWVudC5ib2R5KSB7DQoJCQkJCXJldHVybiBkb2N1bWVudC5ib2R5LmNsaWVudEhlaWdodDsNCgkJCQl9DQoJCQkJcmV0dXJuIDA7DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIGdldFRvb2xCYXJzSGVpZ2h0KCkgew0KCQkJCXJldHVybiAkKCJzd2l0Y2hlcyIpLm9mZnNldEhlaWdodDsNCgkJCX0NCg0KCQkJZnVuY3Rpb24gZ2V0Q2hyb21lSGVpZ2h0KCkgew0KCQkJCXZhciBoZWlnaHQgPSBnZXRUb29sQmFyc0hlaWdodCgpOw0KCQkJCWlmIChzaG93Q29tbWFuZExpbmUpIHsNCgkJCQkJaGVpZ2h0ICs9ICQoImNvbW1hbmRMaW5lIikub2Zmc2V0SGVpZ2h0Ow0KCQkJCX0NCgkJCQlyZXR1cm4gaGVpZ2h0Ow0KCQkJfQ0KDQoJCQlmdW5jdGlvbiBzZXRMb2dDb250YWluZXJIZWlnaHQoKSB7DQoJCQkJaWYgKGxvZ01haW5Db250YWluZXIpIHsNCgkJCQkJdmFyIHdpbmRvd0hlaWdodCA9IGdldFdpbmRvd0hlaWdodCgpOw0KCQkJCQkkKCJib2R5Iikuc3R5bGUuaGVpZ2h0ID0gZ2V0V2luZG93SGVpZ2h0KCkgKyAicHgiOw0KCQkJCQlsb2dNYWluQ29udGFpbmVyLnN0eWxlLmhlaWdodCA9ICIiICsNCgkJCQkJCU1hdGgubWF4KDAsIHdpbmRvd0hlaWdodCAtIGdldENocm9tZUhlaWdodCgpKSArICJweCI7DQoJCQkJfQ0KCQkJfQ0KDQoJCQlmdW5jdGlvbiBzZXRDb21tYW5kSW5wdXRXaWR0aCgpIHsNCgkJCQlpZiAoc2hvd0NvbW1hbmRMaW5lKSB7DQoJCQkJCSQoImNvbW1hbmQiKS5zdHlsZS53aWR0aCA9ICIiICsgTWF0aC5tYXgoMCwgJCgiY29tbWFuZExpbmVDb250YWluZXIiKS5vZmZzZXRXaWR0aCAtDQoJCQkJCQkoJCgiZXZhbHVhdGVCdXR0b24iKS5vZmZzZXRXaWR0aCArIDEzKSkgKyAicHgiOw0KCQkJCX0NCgkJCX0NCg0KCQkJd2luZG93Lm9ucmVzaXplID0gZnVuY3Rpb24oKSB7DQoJCQkJc2V0Q29tbWFuZElucHV0V2lkdGgoKTsNCgkJCQlzZXRMb2dDb250YWluZXJIZWlnaHQoKTsNCgkJCX07DQoNCgkJCWlmICghQXJyYXkucHJvdG90eXBlLnB1c2gpIHsNCgkJCQlBcnJheS5wcm90b3R5cGUucHVzaCA9IGZ1bmN0aW9uKCkgew0KCQkJICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKXsNCgkJCSAgICAgICAgICAgIHRoaXNbdGhpcy5sZW5ndGhdID0gYXJndW1lbnRzW2ldOw0KCQkJICAgICAgICB9DQoJCQkgICAgICAgIHJldHVybiB0aGlzLmxlbmd0aDsNCgkJCQl9Ow0KCQkJfQ0KDQoJCQlpZiAoIUFycmF5LnByb3RvdHlwZS5wb3ApIHsNCgkJCQlBcnJheS5wcm90b3R5cGUucG9wID0gZnVuY3Rpb24oKSB7DQoJCQkJCWlmICh0aGlzLmxlbmd0aCA+IDApIHsNCgkJCQkJCXZhciB2YWwgPSB0aGlzW3RoaXMubGVuZ3RoIC0gMV07DQoJCQkJCQl0aGlzLmxlbmd0aCA9IHRoaXMubGVuZ3RoIC0gMTsNCgkJCQkJCXJldHVybiB2YWw7DQoJCQkJCX0NCgkJCQl9Ow0KCQkJfQ0KDQoJCQlpZiAoIUFycmF5LnByb3RvdHlwZS5zaGlmdCkgew0KCQkJCUFycmF5LnByb3RvdHlwZS5zaGlmdCA9IGZ1bmN0aW9uKCkgew0KCQkJCQlpZiAodGhpcy5sZW5ndGggPiAwKSB7DQoJCQkJCQl2YXIgZmlyc3RJdGVtID0gdGhpc1swXTsNCgkJCQkJCWZvciAodmFyIGkgPSAwLCBsZW4gPSB0aGlzLmxlbmd0aCAtIDE7IGkgPCBsZW47IGkrKykgew0KCQkJCQkJCXRoaXNbaV0gPSB0aGlzW2kgKyAxXTsNCgkJCQkJCX0NCgkJCQkJCXRoaXMubGVuZ3RoID0gdGhpcy5sZW5ndGggLSAxOw0KCQkJCQkJcmV0dXJuIGZpcnN0SXRlbTsNCgkJCQkJfQ0KCQkJCX07DQoJCQl9DQoNCgkJCWlmICghQXJyYXkucHJvdG90eXBlLnNwbGljZSkgew0KCQkJCUFycmF5LnByb3RvdHlwZS5zcGxpY2UgPSBmdW5jdGlvbihzdGFydEluZGV4LCBkZWxldGVDb3VudCkgew0KCQkJCQl2YXIgaXRlbXNBZnRlckRlbGV0ZWQgPSB0aGlzLnNsaWNlKHN0YXJ0SW5kZXggKyBkZWxldGVDb3VudCk7DQoJCQkJCXZhciBpdGVtc0RlbGV0ZWQgPSB0aGlzLnNsaWNlKHN0YXJ0SW5kZXgsIHN0YXJ0SW5kZXggKyBkZWxldGVDb3VudCk7DQoJCQkJCXRoaXMubGVuZ3RoID0gc3RhcnRJbmRleDsNCgkJCQkJLy8gQ29weSB0aGUgYXJndW1lbnRzIGludG8gYSBwcm9wZXIgQXJyYXkgb2JqZWN0DQoJCQkJCXZhciBhcmd1bWVudHNBcnJheSA9IFtdOw0KCQkJCQlmb3IgKHZhciBpID0gMCwgbGVuID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7DQoJCQkJCQlhcmd1bWVudHNBcnJheVtpXSA9IGFyZ3VtZW50c1tpXTsNCgkJCQkJfQ0KCQkJCQl2YXIgaXRlbXNUb0FwcGVuZCA9IChhcmd1bWVudHNBcnJheS5sZW5ndGggPiAyKSA/DQoJCQkJCQlpdGVtc0FmdGVyRGVsZXRlZCA9IGFyZ3VtZW50c0FycmF5LnNsaWNlKDIpLmNvbmNhdChpdGVtc0FmdGVyRGVsZXRlZCkgOiBpdGVtc0FmdGVyRGVsZXRlZDsNCgkJCQkJZm9yIChpID0gMCwgbGVuID0gaXRlbXNUb0FwcGVuZC5sZW5ndGg7IGkgPCBsZW47IGkrKykgew0KCQkJCQkJdGhpcy5wdXNoKGl0ZW1zVG9BcHBlbmRbaV0pOw0KCQkJCQl9DQoJCQkJCXJldHVybiBpdGVtc0RlbGV0ZWQ7DQoJCQkJfTsNCgkJCX0NCg0KCQkJZnVuY3Rpb24gYXJyYXlfcmVtb3ZlKGFyciwgdmFsKSB7DQoJCQkJdmFyIGluZGV4ID0gLTE7DQoJCQkJZm9yICh2YXIgaSA9IDAsIGxlbiA9IGFyci5sZW5ndGg7IGkgPCBsZW47IGkrKykgew0KCQkJCQlpZiAoYXJyW2ldID09PSB2YWwpIHsNCgkJCQkJCWluZGV4ID0gaTsNCgkJCQkJCWJyZWFrOw0KCQkJCQl9DQoJCQkJfQ0KCQkJCWlmIChpbmRleCA+PSAwKSB7DQoJCQkJCWFyci5zcGxpY2UoaW5kZXgsIDEpOw0KCQkJCQlyZXR1cm4gaW5kZXg7DQoJCQkJfSBlbHNlIHsNCgkJCQkJcmV0dXJuIGZhbHNlOw0KCQkJCX0NCgkJCX0NCg0KCQkJZnVuY3Rpb24gYXJyYXlfcmVtb3ZlRnJvbVN0YXJ0KGFycmF5LCBudW1iZXJUb1JlbW92ZSkgew0KCQkJCWlmIChBcnJheS5wcm90b3R5cGUuc3BsaWNlKSB7DQoJCQkJCWFycmF5LnNwbGljZSgwLCBudW1iZXJUb1JlbW92ZSk7DQoJCQkJfSBlbHNlIHsNCgkJCQkJZm9yICh2YXIgaSA9IG51bWJlclRvUmVtb3ZlLCBsZW4gPSBhcnJheS5sZW5ndGg7IGkgPCBsZW47IGkrKykgew0KCQkJCQkJYXJyYXlbaSAtIG51bWJlclRvUmVtb3ZlXSA9IGFycmF5W2ldOw0KCQkJCQl9DQoJCQkJCWFycmF5Lmxlbmd0aCA9IGFycmF5Lmxlbmd0aCAtIG51bWJlclRvUmVtb3ZlOw0KCQkJCX0NCgkJCQlyZXR1cm4gYXJyYXk7DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIGFycmF5X2NvbnRhaW5zKGFyciwgdmFsKSB7DQoJCQkJZm9yICh2YXIgaSA9IDAsIGxlbiA9IGFyci5sZW5ndGg7IGkgPCBsZW47IGkrKykgew0KCQkJCQlpZiAoYXJyW2ldID09IHZhbCkgew0KCQkJCQkJcmV0dXJuIHRydWU7DQoJCQkJCX0NCgkJCQl9DQoJCQkJcmV0dXJuIGZhbHNlOw0KCQkJfQ0KDQoJCQlmdW5jdGlvbiBnZXRFcnJvck1lc3NhZ2UoZXgpIHsNCgkJCQlpZiAoZXgubWVzc2FnZSkgew0KCQkJCQlyZXR1cm4gZXgubWVzc2FnZTsNCgkJCQl9IGVsc2UgaWYgKGV4LmRlc2NyaXB0aW9uKSB7DQoJCQkJCXJldHVybiBleC5kZXNjcmlwdGlvbjsNCgkJCQl9DQoJCQkJcmV0dXJuICIiICsgZXg7DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIG1vdmVDYXJldFRvRW5kKGlucHV0KSB7DQoJCQkJaWYgKGlucHV0LnNldFNlbGVjdGlvblJhbmdlKSB7DQoJCQkJCWlucHV0LmZvY3VzKCk7DQoJCQkJCXZhciBsZW5ndGggPSBpbnB1dC52YWx1ZS5sZW5ndGg7DQoJCQkJCWlucHV0LnNldFNlbGVjdGlvblJhbmdlKGxlbmd0aCwgbGVuZ3RoKTsNCgkJCQl9IGVsc2UgaWYgKGlucHV0LmNyZWF0ZVRleHRSYW5nZSkgew0KCQkJCQl2YXIgcmFuZ2UgPSBpbnB1dC5jcmVhdGVUZXh0UmFuZ2UoKTsNCgkJCQkJcmFuZ2UuY29sbGFwc2UoZmFsc2UpOw0KCQkJCQlyYW5nZS5zZWxlY3QoKTsNCgkJCQl9DQoJCQkJaW5wdXQuZm9jdXMoKTsNCgkJCX0NCg0KCQkJZnVuY3Rpb24gc3RvcFByb3BhZ2F0aW9uKGV2dCkgew0KCQkJCWlmIChldnQuc3RvcFByb3BhZ2F0aW9uKSB7DQoJCQkJCWV2dC5zdG9wUHJvcGFnYXRpb24oKTsNCgkJCQl9IGVsc2UgaWYgKHR5cGVvZiBldnQuY2FuY2VsQnViYmxlICE9ICJ1bmRlZmluZWQiKSB7DQoJCQkJCWV2dC5jYW5jZWxCdWJibGUgPSB0cnVlOw0KCQkJCX0NCgkJCX0NCg0KCQkJZnVuY3Rpb24gZ2V0RXZlbnQoZXZ0KSB7DQoJCQkJcmV0dXJuIGV2dCA/IGV2dCA6IGV2ZW50Ow0KCQkJfQ0KDQoJCQlmdW5jdGlvbiBnZXRUYXJnZXQoZXZ0KSB7DQoJCQkJcmV0dXJuIGV2dC50YXJnZXQgPyBldnQudGFyZ2V0IDogZXZ0LnNyY0VsZW1lbnQ7DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIGdldFJlbGF0ZWRUYXJnZXQoZXZ0KSB7DQoJCQkJaWYgKGV2dC5yZWxhdGVkVGFyZ2V0KSB7DQoJCQkJCXJldHVybiBldnQucmVsYXRlZFRhcmdldDsNCgkJCQl9IGVsc2UgaWYgKGV2dC5zcmNFbGVtZW50KSB7DQoJCQkJCXN3aXRjaChldnQudHlwZSkgew0KCQkJCQkJY2FzZSAibW91c2VvdmVyIjoNCgkJCQkJCQlyZXR1cm4gZXZ0LmZyb21FbGVtZW50Ow0KCQkJCQkJY2FzZSAibW91c2VvdXQiOg0KCQkJCQkJCXJldHVybiBldnQudG9FbGVtZW50Ow0KCQkJCQkJZGVmYXVsdDoNCgkJCQkJCQlyZXR1cm4gZXZ0LnNyY0VsZW1lbnQ7DQoJCQkJCX0NCgkJCQl9DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIGNhbmNlbEtleUV2ZW50KGV2dCkgew0KCQkJCWV2dC5yZXR1cm5WYWx1ZSA9IGZhbHNlOw0KCQkJCXN0b3BQcm9wYWdhdGlvbihldnQpOw0KCQkJfQ0KDQoJCQlmdW5jdGlvbiBldmFsQ29tbWFuZExpbmUoKSB7DQoJCQkJdmFyIGV4cHIgPSAkKCJjb21tYW5kIikudmFsdWU7DQoJCQkJZXZhbENvbW1hbmQoZXhwcik7DQoJCQkJJCgiY29tbWFuZCIpLnZhbHVlID0gIiI7DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIGV2YWxMYXN0Q29tbWFuZCgpIHsNCgkJCQlpZiAobGFzdENvbW1hbmQgIT0gbnVsbCkgew0KCQkJCQlldmFsQ29tbWFuZChsYXN0Q29tbWFuZCk7DQoJCQkJfQ0KCQkJfQ0KDQoJCQl2YXIgbGFzdENvbW1hbmQgPSBudWxsOw0KCQkJdmFyIGNvbW1hbmRIaXN0b3J5ID0gW107DQoJCQl2YXIgY3VycmVudENvbW1hbmRJbmRleCA9IDA7DQoNCgkJCWZ1bmN0aW9uIGV2YWxDb21tYW5kKGV4cHIpIHsNCgkJCQlpZiAoYXBwZW5kZXIpIHsNCgkJCQkJYXBwZW5kZXIuZXZhbENvbW1hbmRBbmRBcHBlbmQoZXhwcik7DQoJCQkJfSBlbHNlIHsNCgkJCQkJdmFyIHByZWZpeCA9ICI+Pj4gIiArIGV4cHIgKyAiXHJcbiI7DQoJCQkJCXRyeSB7DQoJCQkJCQlsb2coIklORk8iLCBwcmVmaXggKyBldmFsKGV4cHIpKTsNCgkJCQkJfSBjYXRjaCAoZXgpIHsNCgkJCQkJCWxvZygiRVJST1IiLCBwcmVmaXggKyAiRXJyb3I6ICIgKyBnZXRFcnJvck1lc3NhZ2UoZXgpKTsNCgkJCQkJfQ0KCQkJCX0NCgkJCQkvLyBVcGRhdGUgY29tbWFuZCBoaXN0b3J5DQoJCQkJaWYgKGV4cHIgIT0gY29tbWFuZEhpc3RvcnlbY29tbWFuZEhpc3RvcnkubGVuZ3RoIC0gMV0pIHsNCgkJCQkJY29tbWFuZEhpc3RvcnkucHVzaChleHByKTsNCgkJCQkJLy8gVXBkYXRlIHRoZSBhcHBlbmRlcg0KCQkJCQlpZiAoYXBwZW5kZXIpIHsNCgkJCQkJCWFwcGVuZGVyLnN0b3JlQ29tbWFuZEhpc3RvcnkoY29tbWFuZEhpc3RvcnkpOw0KCQkJCQl9DQoJCQkJfQ0KCQkJCWN1cnJlbnRDb21tYW5kSW5kZXggPSAoZXhwciA9PSBjb21tYW5kSGlzdG9yeVtjdXJyZW50Q29tbWFuZEluZGV4XSkgPyBjdXJyZW50Q29tbWFuZEluZGV4ICsgMSA6IGNvbW1hbmRIaXN0b3J5Lmxlbmd0aDsNCgkJCQlsYXN0Q29tbWFuZCA9IGV4cHI7DQoJCQl9DQoJCQkvL11dPg0KCQk8L3NjcmlwdD4NCgkJPHN0eWxlIHR5cGU9InRleHQvY3NzIj4NCgkJCWJvZHkgew0KCQkJCWJhY2tncm91bmQtY29sb3I6IHdoaXRlOw0KCQkJCWNvbG9yOiBibGFjazsNCgkJCQlwYWRkaW5nOiAwOw0KCQkJCW1hcmdpbjogMDsNCgkJCQlmb250LWZhbWlseTogdGFob21hLCB2ZXJkYW5hLCBhcmlhbCwgaGVsdmV0aWNhLCBzYW5zLXNlcmlmOw0KCQkJCW92ZXJmbG93OiBoaWRkZW47DQoJCQl9DQoNCgkJCWRpdiNzd2l0Y2hlc0NvbnRhaW5lciBpbnB1dCB7DQoJCQkJbWFyZ2luLWJvdHRvbTogMDsNCgkJCX0NCg0KCQkJZGl2LnRvb2xiYXIgew0KCQkJCWJvcmRlci10b3A6IHNvbGlkICNmZmZmZmYgMXB4Ow0KCQkJCWJvcmRlci1ib3R0b206IHNvbGlkICNhY2E4OTkgMXB4Ow0KCQkJCWJhY2tncm91bmQtY29sb3I6ICNmMWVmZTc7DQoJCQkJcGFkZGluZzogM3B4IDVweDsNCgkJCQlmb250LXNpemU6IDY4Ljc1JTsNCgkJCX0NCg0KCQkJZGl2LnRvb2xiYXIsIGRpdiNzZWFyY2ggaW5wdXQgew0KCQkJCWZvbnQtZmFtaWx5OiB0YWhvbWEsIHZlcmRhbmEsIGFyaWFsLCBoZWx2ZXRpY2EsIHNhbnMtc2VyaWY7DQoJCQl9DQoNCgkJCWRpdi50b29sYmFyIGlucHV0LmJ1dHRvbiB7DQoJCQkJcGFkZGluZzogMCA1cHg7DQoJCQkJZm9udC1zaXplOiAxMDAlOw0KCQkJfQ0KDQoJCQlkaXYudG9vbGJhciBpbnB1dC5oaWRkZW4gew0KCQkJCWRpc3BsYXk6IG5vbmU7DQoJCQl9DQoNCgkJCWRpdiNzd2l0Y2hlcyBpbnB1dCNjbGVhckJ1dHRvbiB7DQoJCQkJbWFyZ2luLWxlZnQ6IDIwcHg7DQoJCQl9DQoNCgkJCWRpdiNsZXZlbHMgbGFiZWwgew0KCQkJCWZvbnQtd2VpZ2h0OiBib2xkOw0KCQkJfQ0KDQoJCQlkaXYjbGV2ZWxzIGxhYmVsLCBkaXYjb3B0aW9ucyBsYWJlbCB7DQoJCQkJbWFyZ2luLXJpZ2h0OiA1cHg7DQoJCQl9DQoNCgkJCWRpdiNsZXZlbHMgbGFiZWwjd3JhcExhYmVsIHsNCgkJCQlmb250LXdlaWdodDogbm9ybWFsOw0KCQkJfQ0KDQoJCQlkaXYjc2VhcmNoIGxhYmVsIHsNCgkJCQltYXJnaW4tcmlnaHQ6IDEwcHg7DQoJCQl9DQoNCgkJCWRpdiNzZWFyY2ggbGFiZWwuc2VhcmNoYm94bGFiZWwgew0KCQkJCW1hcmdpbi1yaWdodDogMDsNCgkJCX0NCg0KCQkJZGl2I3NlYXJjaCBpbnB1dCB7DQoJCQkJZm9udC1zaXplOiAxMDAlOw0KCQkJfQ0KDQoJCQlkaXYjc2VhcmNoIGlucHV0LnZhbGlkcmVnZXggew0KCQkJCWNvbG9yOiBncmVlbjsNCgkJCX0NCg0KCQkJZGl2I3NlYXJjaCBpbnB1dC5pbnZhbGlkcmVnZXggew0KCQkJCWNvbG9yOiByZWQ7DQoJCQl9DQoNCgkJCWRpdiNzZWFyY2ggaW5wdXQubm9tYXRjaGVzIHsNCgkJCQljb2xvcjogd2hpdGU7DQoJCQkJYmFja2dyb3VuZC1jb2xvcjogI2ZmNjY2NjsNCgkJCX0NCg0KCQkJZGl2I3NlYXJjaCBpbnB1dC5ub21hdGNoZXMgew0KCQkJCWNvbG9yOiB3aGl0ZTsNCgkJCQliYWNrZ3JvdW5kLWNvbG9yOiAjZmY2NjY2Ow0KCQkJfQ0KDQoJCQlkaXYjc2VhcmNoTmF2IHsNCgkJCQlkaXNwbGF5OiBub25lOw0KCQkJfQ0KDQoJCQlkaXYjY29tbWFuZExpbmUgew0KCQkJCWRpc3BsYXk6IG5vbmU7DQoJCQl9DQoNCgkJCWRpdiNjb21tYW5kTGluZSBpbnB1dCNjb21tYW5kIHsNCgkJCQlmb250LXNpemU6IDEwMCU7DQoJCQkJZm9udC1mYW1pbHk6IENvdXJpZXIgTmV3LCBDb3VyaWVyOw0KCQkJfQ0KDQoJCQlkaXYjY29tbWFuZExpbmUgaW5wdXQjZXZhbHVhdGVCdXR0b24gew0KCQkJfQ0KDQoJCQkqLmdyZXllZG91dCB7DQoJCQkJY29sb3I6IGdyYXkgIWltcG9ydGFudDsNCgkJCQlib3JkZXItY29sb3I6IGdyYXkgIWltcG9ydGFudDsNCgkJCX0NCg0KCQkJKi5ncmV5ZWRvdXQgKi5hbHdheXNlbmFibGVkIHsgY29sb3I6IGJsYWNrOyB9DQoNCgkJCSoudW5zZWxlY3RhYmxlIHsNCgkJCQkta2h0bWwtdXNlci1zZWxlY3Q6IG5vbmU7DQoJCQkJLW1vei11c2VyLXNlbGVjdDogbm9uZTsNCgkJCQl1c2VyLXNlbGVjdDogbm9uZTsNCgkJCX0NCg0KCQkJZGl2I2xvZyB7DQoJCQkJZm9udC1mYW1pbHk6IENvdXJpZXIgTmV3LCBDb3VyaWVyOw0KCQkJCWZvbnQtc2l6ZTogNzUlOw0KCQkJCXdpZHRoOiAxMDAlOw0KCQkJCW92ZXJmbG93OiBhdXRvOw0KCQkJCWNsZWFyOiBib3RoOw0KCQkJCXBvc2l0aW9uOiByZWxhdGl2ZTsNCgkJCX0NCg0KCQkJZGl2Lmdyb3VwIHsNCgkJCQlib3JkZXItY29sb3I6ICNjY2NjY2M7DQoJCQkJYm9yZGVyLXN0eWxlOiBzb2xpZDsNCgkJCQlib3JkZXItd2lkdGg6IDFweCAwIDFweCAxcHg7DQoJCQkJb3ZlcmZsb3c6IHZpc2libGU7DQoJCQl9DQoNCgkJCWRpdi5vbGRJZSBkaXYuZ3JvdXAsIGRpdi5vbGRJZSBkaXYuZ3JvdXAgKiwgZGl2Lm9sZEllICoubG9nZW50cnkgew0KCQkJCWhlaWdodDogMSU7DQoJCQl9DQoNCgkJCWRpdi5ncm91cCBkaXYuZ3JvdXBoZWFkaW5nIHNwYW4uZXhwYW5kZXIgew0KCQkJCWJvcmRlcjogc29saWQgYmxhY2sgMXB4Ow0KCQkJCWZvbnQtZmFtaWx5OiBDb3VyaWVyIE5ldywgQ291cmllcjsNCgkJCQlmb250LXNpemU6IDAuODMzZW07DQoJCQkJYmFja2dyb3VuZC1jb2xvcjogI2VlZWVlZTsNCgkJCQlwb3NpdGlvbjogcmVsYXRpdmU7DQoJCQkJdG9wOiAtMXB4Ow0KCQkJCWNvbG9yOiBibGFjazsNCgkJCQlwYWRkaW5nOiAwIDJweDsNCgkJCQljdXJzb3I6IHBvaW50ZXI7DQoJCQkJY3Vyc29yOiBoYW5kOw0KCQkJCWhlaWdodDogMSU7DQoJCQl9DQoNCgkJCWRpdi5ncm91cCBkaXYuZ3JvdXBjb250ZW50IHsNCgkJCQltYXJnaW4tbGVmdDogMTBweDsNCgkJCQlwYWRkaW5nLWJvdHRvbTogMnB4Ow0KCQkJCW92ZXJmbG93OiB2aXNpYmxlOw0KCQkJfQ0KDQoJCQlkaXYuZ3JvdXAgZGl2LmV4cGFuZGVkIHsNCgkJCQlkaXNwbGF5OiBibG9jazsNCgkJCX0NCg0KCQkJZGl2Lmdyb3VwIGRpdi5jb2xsYXBzZWQgew0KCQkJCWRpc3BsYXk6IG5vbmU7DQoJCQl9DQoNCgkJCSoubG9nZW50cnkgew0KCQkJCW92ZXJmbG93OiB2aXNpYmxlOw0KCQkJCWRpc3BsYXk6IG5vbmU7DQoJCQkJd2hpdGUtc3BhY2U6IHByZTsNCgkJCX0NCg0KCQkJc3Bhbi5wcmUgew0KCQkJCXdoaXRlLXNwYWNlOiBwcmU7DQoJCQl9DQoJCQkNCgkJCXByZS51bndyYXBwZWQgew0KCQkJCWRpc3BsYXk6IGlubGluZSAhaW1wb3J0YW50Ow0KCQkJfQ0KDQoJCQlwcmUudW53cmFwcGVkIHByZS5wcmUsIGRpdi53cmFwcGVkIHByZS5wcmUgew0KCQkJCWRpc3BsYXk6IGlubGluZTsNCgkJCX0NCg0KCQkJZGl2LndyYXBwZWQgcHJlLnByZSB7DQoJCQkJd2hpdGUtc3BhY2U6IG5vcm1hbDsNCgkJCX0NCg0KCQkJZGl2LndyYXBwZWQgew0KCQkJCWRpc3BsYXk6IG5vbmU7DQoJCQl9DQoNCgkJCWJvZHkuc2VhcmNoaW5nICoubG9nZW50cnkgc3Bhbi5jdXJyZW50bWF0Y2ggew0KCQkJCWNvbG9yOiB3aGl0ZSAhaW1wb3J0YW50Ow0KCQkJCWJhY2tncm91bmQtY29sb3I6IGdyZWVuICFpbXBvcnRhbnQ7DQoJCQl9DQoNCgkJCWJvZHkuc2VhcmNoaW5nIGRpdi5zZWFyY2hoaWdobGlnaHQgKi5sb2dlbnRyeSBzcGFuLnNlYXJjaHRlcm0gew0KCQkJCWNvbG9yOiBibGFjazsNCgkJCQliYWNrZ3JvdW5kLWNvbG9yOiB5ZWxsb3c7DQoJCQl9DQoNCgkJCWRpdi53cmFwICoubG9nZW50cnkgew0KCQkJCXdoaXRlLXNwYWNlOiBub3JtYWwgIWltcG9ydGFudDsNCgkJCQlib3JkZXItd2lkdGg6IDAgMCAxcHggMDsNCgkJCQlib3JkZXItY29sb3I6ICNkZGRkZGQ7DQoJCQkJYm9yZGVyLXN0eWxlOiBkb3R0ZWQ7DQoJCQl9DQoNCgkJCWRpdi53cmFwICNsb2dfd3JhcHBlZCwgI2xvZ191bndyYXBwZWQgew0KCQkJCWRpc3BsYXk6IGJsb2NrOw0KCQkJfQ0KDQoJCQlkaXYud3JhcCAjbG9nX3Vud3JhcHBlZCwgI2xvZ193cmFwcGVkIHsNCgkJCQlkaXNwbGF5OiBub25lOw0KCQkJfQ0KDQoJCQlkaXYud3JhcCAqLmxvZ2VudHJ5IHNwYW4ucHJlIHsNCgkJCQlvdmVyZmxvdzogdmlzaWJsZTsNCgkJCQl3aGl0ZS1zcGFjZTogbm9ybWFsOw0KCQkJfQ0KDQoJCQlkaXYud3JhcCAqLmxvZ2VudHJ5IHByZS51bndyYXBwZWQgew0KCQkJCWRpc3BsYXk6IG5vbmU7DQoJCQl9DQoNCgkJCWRpdi53cmFwICoubG9nZW50cnkgc3Bhbi53cmFwcGVkIHsNCgkJCQlkaXNwbGF5OiBpbmxpbmU7DQoJCQl9DQoNCgkJCWRpdi5zZWFyY2hmaWx0ZXIgKi5zZWFyY2hub25tYXRjaCB7DQoJCQkJZGlzcGxheTogbm9uZSAhaW1wb3J0YW50Ow0KCQkJfQ0KDQoJCQlkaXYjbG9nICouVFJBQ0UsIGxhYmVsI2xhYmVsX1RSQUNFIHsNCgkJCQljb2xvcjogIzY2NjY2NjsNCgkJCX0NCg0KCQkJZGl2I2xvZyAqLkRFQlVHLCBsYWJlbCNsYWJlbF9ERUJVRyB7DQoJCQkJY29sb3I6IGdyZWVuOw0KCQkJfQ0KDQoJCQlkaXYjbG9nICouSU5GTywgbGFiZWwjbGFiZWxfSU5GTyB7DQoJCQkJY29sb3I6ICMwMDAwOTk7DQoJCQl9DQoNCgkJCWRpdiNsb2cgKi5XQVJOLCBsYWJlbCNsYWJlbF9XQVJOIHsNCgkJCQljb2xvcjogIzk5OTkwMDsNCgkJCX0NCg0KCQkJZGl2I2xvZyAqLkVSUk9SLCBsYWJlbCNsYWJlbF9FUlJPUiB7DQoJCQkJY29sb3I6IHJlZDsNCgkJCX0NCg0KCQkJZGl2I2xvZyAqLkZBVEFMLCBsYWJlbCNsYWJlbF9GQVRBTCB7DQoJCQkJY29sb3I6ICM2NjAwNjY7DQoJCQl9DQoNCgkJCWRpdi5UUkFDRSNsb2cgKi5UUkFDRSwNCgkJCWRpdi5ERUJVRyNsb2cgKi5ERUJVRywNCgkJCWRpdi5JTkZPI2xvZyAqLklORk8sDQoJCQlkaXYuV0FSTiNsb2cgKi5XQVJOLA0KCQkJZGl2LkVSUk9SI2xvZyAqLkVSUk9SLA0KCQkJZGl2LkZBVEFMI2xvZyAqLkZBVEFMIHsNCgkJCQlkaXNwbGF5OiBibG9jazsNCgkJCX0NCg0KCQkJZGl2I2xvZyBkaXYuc2VwYXJhdG9yIHsNCgkJCQliYWNrZ3JvdW5kLWNvbG9yOiAjY2NjY2NjOw0KCQkJCW1hcmdpbjogNXB4IDA7DQoJCQkJbGluZS1oZWlnaHQ6IDFweDsNCgkJCX0NCgkJPC9zdHlsZT4NCgk8L2hlYWQ+DQoNCgk8Ym9keSBpZD0iYm9keSI+DQoJCTxkaXYgaWQ9InN3aXRjaGVzQ29udGFpbmVyIj4NCgkJCTxkaXYgaWQ9InN3aXRjaGVzIj4NCgkJCQk8ZGl2IGlkPSJsZXZlbHMiIGNsYXNzPSJ0b29sYmFyIj4NCgkJCQkJRmlsdGVyczoNCgkJCQkJPGlucHV0IHR5cGU9ImNoZWNrYm94IiBpZD0ic3dpdGNoX1RSQUNFIiBvbmNsaWNrPSJhcHBseUZpbHRlcnMoKTsgY2hlY2tBbGxMZXZlbHMoKSIgY2hlY2tlZD0iY2hlY2tlZCIgdGl0bGU9IlNob3cvaGlkZSB0cmFjZSBtZXNzYWdlcyIgLz48bGFiZWwgZm9yPSJzd2l0Y2hfVFJBQ0UiIGlkPSJsYWJlbF9UUkFDRSI+dHJhY2U8L2xhYmVsPg0KCQkJCQk8aW5wdXQgdHlwZT0iY2hlY2tib3giIGlkPSJzd2l0Y2hfREVCVUciIG9uY2xpY2s9ImFwcGx5RmlsdGVycygpOyBjaGVja0FsbExldmVscygpIiBjaGVja2VkPSJjaGVja2VkIiB0aXRsZT0iU2hvdy9oaWRlIGRlYnVnIG1lc3NhZ2VzIiAvPjxsYWJlbCBmb3I9InN3aXRjaF9ERUJVRyIgaWQ9ImxhYmVsX0RFQlVHIj5kZWJ1ZzwvbGFiZWw+DQoJCQkJCTxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9InN3aXRjaF9JTkZPIiBvbmNsaWNrPSJhcHBseUZpbHRlcnMoKTsgY2hlY2tBbGxMZXZlbHMoKSIgY2hlY2tlZD0iY2hlY2tlZCIgdGl0bGU9IlNob3cvaGlkZSBpbmZvIG1lc3NhZ2VzIiAvPjxsYWJlbCBmb3I9InN3aXRjaF9JTkZPIiBpZD0ibGFiZWxfSU5GTyI+aW5mbzwvbGFiZWw+DQoJCQkJCTxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9InN3aXRjaF9XQVJOIiBvbmNsaWNrPSJhcHBseUZpbHRlcnMoKTsgY2hlY2tBbGxMZXZlbHMoKSIgY2hlY2tlZD0iY2hlY2tlZCIgdGl0bGU9IlNob3cvaGlkZSB3YXJuIG1lc3NhZ2VzIiAvPjxsYWJlbCBmb3I9InN3aXRjaF9XQVJOIiBpZD0ibGFiZWxfV0FSTiI+d2FybjwvbGFiZWw+DQoJCQkJCTxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9InN3aXRjaF9FUlJPUiIgb25jbGljaz0iYXBwbHlGaWx0ZXJzKCk7IGNoZWNrQWxsTGV2ZWxzKCkiIGNoZWNrZWQ9ImNoZWNrZWQiIHRpdGxlPSJTaG93L2hpZGUgZXJyb3IgbWVzc2FnZXMiIC8+PGxhYmVsIGZvcj0ic3dpdGNoX0VSUk9SIiBpZD0ibGFiZWxfRVJST1IiPmVycm9yPC9sYWJlbD4NCgkJCQkJPGlucHV0IHR5cGU9ImNoZWNrYm94IiBpZD0ic3dpdGNoX0ZBVEFMIiBvbmNsaWNrPSJhcHBseUZpbHRlcnMoKTsgY2hlY2tBbGxMZXZlbHMoKSIgY2hlY2tlZD0iY2hlY2tlZCIgdGl0bGU9IlNob3cvaGlkZSBmYXRhbCBtZXNzYWdlcyIgLz48bGFiZWwgZm9yPSJzd2l0Y2hfRkFUQUwiIGlkPSJsYWJlbF9GQVRBTCI+ZmF0YWw8L2xhYmVsPg0KCQkJCQk8aW5wdXQgdHlwZT0iY2hlY2tib3giIGlkPSJzd2l0Y2hfQUxMIiBvbmNsaWNrPSJ0b2dnbGVBbGxMZXZlbHMoKTsgYXBwbHlGaWx0ZXJzKCkiIGNoZWNrZWQ9ImNoZWNrZWQiIHRpdGxlPSJTaG93L2hpZGUgYWxsIG1lc3NhZ2VzIiAvPjxsYWJlbCBmb3I9InN3aXRjaF9BTEwiIGlkPSJsYWJlbF9BTEwiPmFsbDwvbGFiZWw+DQoJCQkJPC9kaXY+DQoJCQkJPGRpdiBpZD0ic2VhcmNoIiBjbGFzcz0idG9vbGJhciI+DQoJCQkJCTxsYWJlbCBmb3I9InNlYXJjaEJveCIgY2xhc3M9InNlYXJjaGJveGxhYmVsIj5TZWFyY2g6PC9sYWJlbD4gPGlucHV0IHR5cGU9InRleHQiIGlkPSJzZWFyY2hCb3giIG9uY2xpY2s9InRvZ2dsZVNlYXJjaEVuYWJsZWQodHJ1ZSkiIG9ua2V5dXA9InNjaGVkdWxlU2VhcmNoKCkiIHNpemU9IjIwIiAvPg0KCQkJCQk8aW5wdXQgdHlwZT0iYnV0dG9uIiBpZD0ic2VhcmNoUmVzZXQiIGRpc2FibGVkPSJkaXNhYmxlZCIgdmFsdWU9IlJlc2V0IiBvbmNsaWNrPSJjbGVhclNlYXJjaCgpIiBjbGFzcz0iYnV0dG9uIiB0aXRsZT0iUmVzZXQgdGhlIHNlYXJjaCIgLz4NCgkJCQkJPGlucHV0IHR5cGU9ImNoZWNrYm94IiBpZD0ic2VhcmNoUmVnZXgiIG9uY2xpY2s9ImRvU2VhcmNoKCkiIHRpdGxlPSJJZiBjaGVja2VkLCBzZWFyY2ggaXMgdHJlYXRlZCBhcyBhIHJlZ3VsYXIgZXhwcmVzc2lvbiIgLz48bGFiZWwgZm9yPSJzZWFyY2hSZWdleCI+UmVnZXg8L2xhYmVsPg0KCQkJCQk8aW5wdXQgdHlwZT0iY2hlY2tib3giIGlkPSJzZWFyY2hDYXNlU2Vuc2l0aXZlIiBvbmNsaWNrPSJkb1NlYXJjaCgpIiB0aXRsZT0iSWYgY2hlY2tlZCwgc2VhcmNoIGlzIGNhc2Ugc2Vuc2l0aXZlIiAvPjxsYWJlbCBmb3I9InNlYXJjaENhc2VTZW5zaXRpdmUiPk1hdGNoIGNhc2U8L2xhYmVsPg0KCQkJCQk8aW5wdXQgdHlwZT0iY2hlY2tib3giIGlkPSJzZWFyY2hEaXNhYmxlIiBvbmNsaWNrPSJ0b2dnbGVTZWFyY2hFbmFibGVkKCkiIHRpdGxlPSJFbmFibGUvZGlzYWJsZSBzZWFyY2giIC8+PGxhYmVsIGZvcj0ic2VhcmNoRGlzYWJsZSIgY2xhc3M9ImFsd2F5c2VuYWJsZWQiPkRpc2FibGU8L2xhYmVsPg0KCQkJCQk8ZGl2IGlkPSJzZWFyY2hOYXYiPg0KCQkJCQkJPGlucHV0IHR5cGU9ImJ1dHRvbiIgaWQ9InNlYXJjaE5leHQiIGRpc2FibGVkPSJkaXNhYmxlZCIgdmFsdWU9Ik5leHQiIG9uY2xpY2s9InNlYXJjaE5leHQoKSIgY2xhc3M9ImJ1dHRvbiIgdGl0bGU9IkdvIHRvIHRoZSBuZXh0IG1hdGNoaW5nIGxvZyBlbnRyeSIgLz4NCgkJCQkJCTxpbnB1dCB0eXBlPSJidXR0b24iIGlkPSJzZWFyY2hQcmV2aW91cyIgZGlzYWJsZWQ9ImRpc2FibGVkIiB2YWx1ZT0iUHJldmlvdXMiIG9uY2xpY2s9InNlYXJjaFByZXZpb3VzKCkiIGNsYXNzPSJidXR0b24iIHRpdGxlPSJHbyB0byB0aGUgcHJldmlvdXMgbWF0Y2hpbmcgbG9nIGVudHJ5IiAvPg0KCQkJCQkJPGlucHV0IHR5cGU9ImNoZWNrYm94IiBpZD0ic2VhcmNoRmlsdGVyIiBvbmNsaWNrPSJ0b2dnbGVTZWFyY2hGaWx0ZXIoKSIgdGl0bGU9IklmIGNoZWNrZWQsIG5vbi1tYXRjaGluZyBsb2cgZW50cmllcyBhcmUgZmlsdGVyZWQgb3V0IiAvPjxsYWJlbCBmb3I9InNlYXJjaEZpbHRlciI+RmlsdGVyPC9sYWJlbD4NCgkJCQkJCTxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9InNlYXJjaEhpZ2hsaWdodCIgb25jbGljaz0idG9nZ2xlU2VhcmNoSGlnaGxpZ2h0KCkiIHRpdGxlPSJIaWdobGlnaHQgbWF0Y2hlZCBzZWFyY2ggdGVybXMiIC8+PGxhYmVsIGZvcj0ic2VhcmNoSGlnaGxpZ2h0IiBjbGFzcz0iYWx3YXlzZW5hYmxlZCI+SGlnaGxpZ2h0IGFsbDwvbGFiZWw+DQoJCQkJCTwvZGl2Pg0KCQkJCTwvZGl2Pg0KCQkJCTxkaXYgaWQ9Im9wdGlvbnMiIGNsYXNzPSJ0b29sYmFyIj4NCgkJCQkJT3B0aW9uczoNCgkJCQkJPGlucHV0IHR5cGU9ImNoZWNrYm94IiBpZD0iZW5hYmxlTG9nZ2luZyIgb25jbGljaz0idG9nZ2xlTG9nZ2luZ0VuYWJsZWQoKSIgY2hlY2tlZD0iY2hlY2tlZCIgdGl0bGU9IkVuYWJsZS9kaXNhYmxlIGxvZ2dpbmciIC8+PGxhYmVsIGZvcj0iZW5hYmxlTG9nZ2luZyIgaWQ9ImVuYWJsZUxvZ2dpbmdMYWJlbCI+TG9nPC9sYWJlbD4NCgkJCQkJPGlucHV0IHR5cGU9ImNoZWNrYm94IiBpZD0id3JhcCIgb25jbGljaz0idG9nZ2xlV3JhcCgpIiB0aXRsZT0iRW5hYmxlIC8gZGlzYWJsZSB3b3JkIHdyYXAiIC8+PGxhYmVsIGZvcj0id3JhcCIgaWQ9IndyYXBMYWJlbCI+V3JhcDwvbGFiZWw+DQoJCQkJCTxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9Im5ld2VzdEF0VG9wIiBvbmNsaWNrPSJ0b2dnbGVOZXdlc3RBdFRvcCgpIiB0aXRsZT0iSWYgY2hlY2tlZCwgY2F1c2VzIG5ld2VzdCBtZXNzYWdlcyB0byBhcHBlYXIgYXQgdGhlIHRvcCIgLz48bGFiZWwgZm9yPSJuZXdlc3RBdFRvcCIgaWQ9Im5ld2VzdEF0VG9wTGFiZWwiPk5ld2VzdCBhdCB0aGUgdG9wPC9sYWJlbD4NCgkJCQkJPGlucHV0IHR5cGU9ImNoZWNrYm94IiBpZD0ic2Nyb2xsVG9MYXRlc3QiIG9uY2xpY2s9InRvZ2dsZVNjcm9sbFRvTGF0ZXN0KCkiIGNoZWNrZWQ9ImNoZWNrZWQiIHRpdGxlPSJJZiBjaGVja2VkLCB3aW5kb3cgYXV0b21hdGljYWxseSBzY3JvbGxzIHRvIGEgbmV3IG1lc3NhZ2Ugd2hlbiBpdCBpcyBhZGRlZCIgLz48bGFiZWwgZm9yPSJzY3JvbGxUb0xhdGVzdCIgaWQ9InNjcm9sbFRvTGF0ZXN0TGFiZWwiPlNjcm9sbCB0byBsYXRlc3Q8L2xhYmVsPg0KCQkJCQk8aW5wdXQgdHlwZT0iYnV0dG9uIiBpZD0iY2xlYXJCdXR0b24iIHZhbHVlPSJDbGVhciIgb25jbGljaz0iY2xlYXJMb2coKSIgY2xhc3M9ImJ1dHRvbiIgdGl0bGU9IkNsZWFyIGFsbCBsb2cgbWVzc2FnZXMiICAvPg0KCQkJCQk8aW5wdXQgdHlwZT0iYnV0dG9uIiBpZD0iaGlkZUJ1dHRvbiIgdmFsdWU9IkhpZGUiIG9uY2xpY2s9ImhpZGUoKSIgY2xhc3M9ImhpZGRlbiBidXR0b24iIHRpdGxlPSJIaWRlIHRoZSBjb25zb2xlIiAvPg0KCQkJCQk8aW5wdXQgdHlwZT0iYnV0dG9uIiBpZD0iY2xvc2VCdXR0b24iIHZhbHVlPSJDbG9zZSIgb25jbGljaz0iY2xvc2VXaW5kb3coKSIgY2xhc3M9ImhpZGRlbiBidXR0b24iIHRpdGxlPSJDbG9zZSB0aGUgd2luZG93IiAvPg0KCQkJCTwvZGl2Pg0KCQkJPC9kaXY+DQoJCTwvZGl2Pg0KCQk8ZGl2IGlkPSJsb2ciIGNsYXNzPSJUUkFDRSBERUJVRyBJTkZPIFdBUk4gRVJST1IgRkFUQUwiPjwvZGl2Pg0KCQk8ZGl2IGlkPSJjb21tYW5kTGluZSIgY2xhc3M9InRvb2xiYXIiPg0KCQkJPGRpdiBpZD0iY29tbWFuZExpbmVDb250YWluZXIiPg0KCQkJCTxpbnB1dCB0eXBlPSJ0ZXh0IiBpZD0iY29tbWFuZCIgdGl0bGU9IkVudGVyIGEgSmF2YVNjcmlwdCBjb21tYW5kIGhlcmUgYW5kIGhpdCByZXR1cm4gb3IgcHJlc3MgJ0V2YWx1YXRlJyIgLz4NCgkJCQk8aW5wdXQgdHlwZT0iYnV0dG9uIiBpZD0iZXZhbHVhdGVCdXR0b24iIHZhbHVlPSJFdmFsdWF0ZSIgY2xhc3M9ImJ1dHRvbiIgdGl0bGU9IkV2YWx1YXRlIHRoZSBjb21tYW5kIiBvbmNsaWNrPSJldmFsQ29tbWFuZExpbmUoKSIgLz4NCgkJCTwvZGl2Pg0KCQk8L2Rpdj4NCgk8L2JvZHk+DQo8L2h0bWw+DQo=",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Fri, 07 Nov 2014 09:03:46 GMT",
                    "Content-Length": "70784",
                    "Date": "Fri, 07 Nov 2014 09:03:46 GMT",
                    "Content-Type": "text/html; charset=utf-8"
                },
                "cookies": [],
                "mimeType": "HTML",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}