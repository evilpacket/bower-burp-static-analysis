{
    "url": "http://localhost:9999/CreateJS/PreloadJS/src/preloadjs/AbstractLoader.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Link manipulation (DOM-based)",
    "issueType": 5246976,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based link manipulation vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this to a navigation target within the current page, such as a clickable link or the submission URL of a form. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will modify the target of links within the response. An attacker may be able to leverage this to perform various attacks, including:<ul><li>Causing the user to redirect to an arbitrary external URL, to facilitate a phishing attack.</li><li>Causing the user to submit sensitive form data to a server controlled by the attacker.</li><li>Causing the user to perform an unintended action within the application, by changing the file or query string associated with a link.</li><li>Bypassing browser anti-XSS defenses by injecting on-site links containing XSS exploits, since browser anti-XSS defenses typically do not operate on on-site links.</li></ul>",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based link manipulation vulnerabilities is not to dynamically set the target URLs of links or forms using data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing an arbitrary URL as a link target. In general, this is best achieved by using a whitelist of URLs that are permitted link targets, and strictly validating the target against this list before setting the link target.",
    "issueDetail": "The application may be vulnerable to DOM-based link manipulation. Data is read from <b>location.href</b> and written to <b>the 'href' property of a DOM element</b> via the following statement:<ul><li>host.href = location.href;</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/CreateJS/PreloadJS/src/preloadjs/AbstractLoader.js",
                "path": "/CreateJS/PreloadJS/src/preloadjs/AbstractLoader.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9DcmVhdGVKUy9QcmVsb2FkSlMvc3JjL3ByZWxvYWRqcy9BYnN0cmFjdExvYWRlci5qcyBIVFRQLzEuMQ0KSG9zdDogbG9jYWxob3N0Ojk5OTkNCg0K",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMTQ5NjINCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IFRodSwgMDYgTm92IDIwMTQgMTk6MzY6NTUgR01UDQpMYXN0LU1vZGlmaWVkOiBUaHUsIDA2IE5vdiAyMDE0IDE5OjM2OjU0IEdNVA0KDQovKgoqIEFic3RyYWN0TG9hZGVyCiogVmlzaXQgaHR0cDovL2NyZWF0ZWpzLmNvbS8gZm9yIGRvY3VtZW50YXRpb24sIHVwZGF0ZXMgYW5kIGV4YW1wbGVzLgoqCioKKiBDb3B5cmlnaHQgKGMpIDIwMTIgZ3NraW5uZXIuY29tLCBpbmMuCioKKiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbgoqIG9idGFpbmluZyBhIGNvcHkgb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uCiogZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8gZGVhbCBpbiB0aGUgU29mdHdhcmUgd2l0aG91dAoqIHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMgdG8gdXNlLAoqIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsCiogY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlCiogU29mdHdhcmUgaXMgZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcKKiBjb25kaXRpb25zOgoqCiogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUKKiBpbmNsdWRlZCBpbiBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KKgoqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELAoqIEVYUFJFU1MgT1IgSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUwoqIE9GIE1FUkNIQU5UQUJJTElUWSwgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5ECiogTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SUyBPUiBDT1BZUklHSFQKKiBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSIExJQUJJTElUWSwKKiBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcKKiBGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SCiogT1RIRVIgREVBTElOR1MgSU4gVEhFIFNPRlRXQVJFLgoqLwoKLyoqCiAqIEBtb2R1bGUgUHJlbG9hZEpTCiAqLwoKLy8gbmFtZXNwYWNlOgp0aGlzLmNyZWF0ZWpzID0gdGhpcy5jcmVhdGVqc3x8e307CgooZnVuY3Rpb24oKSB7CgkidXNlIHN0cmljdCI7CgkvKioKCSAqIFRoZSBiYXNlIGxvYWRlciwgd2hpY2ggZGVmaW5lcyBhbGwgdGhlIGdlbmVyaWMgY2FsbGJhY2tzIGFuZCBldmVudHMuIEFsbCBsb2FkZXJzIGV4dGVuZCB0aGlzIGNsYXNzLCBpbmNsdWRpbmcgdGhlCgkgKiB7eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZSJ9fXt7L2Nyb3NzTGlua319LgoJICogQGNsYXNzIEFic3RyYWN0TG9hZGVyCgkgKiBAZXh0ZW5kcyBFdmVudERpc3BhdGNoZXIKCSAqLwoJdmFyIEFic3RyYWN0TG9hZGVyID0gZnVuY3Rpb24gKCkgewoJCXRoaXMuaW5pdCgpOwoJfTsKCgl2YXIgcCA9IEFic3RyYWN0TG9hZGVyLnByb3RvdHlwZSA9IG5ldyBjcmVhdGVqcy5FdmVudERpc3BhdGNoZXIoKTsKCUFic3RyYWN0TG9hZGVyLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IEFic3RyYWN0TG9hZGVyOwoJdmFyIHMgPSBBYnN0cmFjdExvYWRlcjsKCgkvKioKCSAqIFRoZSBSZWd1bGFyIEV4cHJlc3Npb24gdXNlZCB0byB0ZXN0IGZpbGUgVVJMUyBmb3IgYW4gYWJzb2x1dGUgcGF0aC4KCSAqIEBwcm9wZXJ0eSBBQlNPTFVURV9QQVRICgkgKiBAc3RhdGljCgkgKiBAdHlwZSB7UmVnRXhwfQoJICogQHNpbmNlIDAuNC4yCgkgKi8KCXMuQUJTT0xVVEVfUEFUVCA9IC9eKD86XHcrOik/XC97Mn0vaTsKCgkvKioKCSAqIFRoZSBSZWd1bGFyIEV4cHJlc3Npb24gdXNlZCB0byB0ZXN0IGZpbGUgVVJMUyBmb3IgYW4gYWJzb2x1dGUgcGF0aC4KCSAqIEBwcm9wZXJ0eSBSRUxBVElWRV9QQVRICgkgKiBAc3RhdGljCgkgKiBAdHlwZSB7UmVnRXhwfQoJICogQHNpbmNlIDAuNC4yCgkgKi8KCXMuUkVMQVRJVkVfUEFUVCA9ICgvXlsuL10qP1wvL2kpOwoKCS8qKgoJICogVGhlIFJlZ3VsYXIgRXhwcmVzc2lvbiB1c2VkIHRvIHRlc3QgZmlsZSBVUkxTIGZvciBhbiBleHRlbnNpb24uIE5vdGUgdGhhdCBVUklzIG11c3QgYWxyZWFkeSBoYXZlIHRoZSBxdWVyeSBzdHJpbmcKCSAqIHJlbW92ZWQuCgkgKiBAcHJvcGVydHkgRVhURU5TSU9OX1BBVFQKCSAqIEBzdGF0aWMKCSAqIEB0eXBlIHtSZWdFeHB9CgkgKiBAc2luY2UgMC40LjIKCSAqLwoJcy5FWFRFTlNJT05fUEFUVCA9IC9cLz9bXi9dK1wuKFx3ezEsNX0pJC9pOwoKCS8qKgoJICogSWYgdGhlIGxvYWRlciBoYXMgY29tcGxldGVkIGxvYWRpbmcuIFRoaXMgcHJvdmlkZXMgYSBxdWljayBjaGVjaywgYnV0IGFsc28gZW5zdXJlcyB0aGF0IHRoZSBkaWZmZXJlbnQgYXBwcm9hY2hlcwoJICogdXNlZCBmb3IgbG9hZGluZyBkbyBub3QgcGlsZSB1cCByZXN1bHRpbmcgaW4gbW9yZSB0aGFuIG9uZSA8Y29kZT5jb21wbGV0ZTwvY29kZT4gZXZlbnQuCgkgKiBAcHJvcGVydHkgbG9hZGVkCgkgKiBAdHlwZSB7Qm9vbGVhbn0KCSAqIEBkZWZhdWx0IGZhbHNlCgkgKi8KCXAubG9hZGVkID0gZmFsc2U7CgoJLyoqCgkgKiBEZXRlcm1pbmUgaWYgdGhlIGxvYWRlciB3YXMgY2FuY2VsZWQuIENhbmNlbGVkIGxvYWRzIHdpbGwgbm90IGZpcmUgY29tcGxldGUgZXZlbnRzLiBOb3RlIHRoYXQKCSAqIHt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlIn19e3svY3Jvc3NMaW5rfX0gcXVldWVzIHNob3VsZCBiZSBjbG9zZWQgdXNpbmcge3sjY3Jvc3NMaW5rICJBYnN0cmFjdExvYWRlci9jbG9zZSJ9fXt7L2Nyb3NzTGlua319CgkgKiBpbnN0ZWFkIG9mIHNldHRpbmcgdGhpcyBwcm9wZXJ0eS4KCSAqIEBwcm9wZXJ0eSBjYW5jZWxlZAoJICogQHR5cGUge0Jvb2xlYW59CgkgKiBAZGVmYXVsdCBmYWxzZQoJICovCglwLmNhbmNlbGVkID0gZmFsc2U7CgoJLyoqCgkgKiBUaGUgY3VycmVudCBsb2FkIHByb2dyZXNzIChwZXJjZW50YWdlKSBmb3IgdGhpcyBpdGVtLiBUaGlzIHdpbGwgYmUgYSBudW1iZXIgYmV0d2VlbiAwIGFuZCAxLgoJICoKCSAqIDxoND5FeGFtcGxlPC9oND4KCSAqCgkgKiAgICAgdmFyIHF1ZXVlID0gbmV3IGNyZWF0ZWpzLkxvYWRRdWV1ZSgpOwoJICogICAgIHF1ZXVlLmxvYWRGaWxlKCJsYXJnZUltYWdlLnBuZyIpOwoJICogICAgIHF1ZXVlLm9uKCJwcm9ncmVzcyIsIGZ1bmN0aW9uKCkgewoJICogICAgICAgICBjb25zb2xlLmxvZygiUHJvZ3Jlc3M6IiwgcXVldWUucHJvZ3Jlc3MsIGV2ZW50LnByb2dyZXNzKTsKCSAqICAgICB9KTsKCSAqCgkgKiBAcHJvcGVydHkgcHJvZ3Jlc3MKCSAqIEB0eXBlIHtOdW1iZXJ9CgkgKiBAZGVmYXVsdCAwCgkgKi8KCXAucHJvZ3Jlc3MgPSAwOwoKCS8qKgoJICogVGhlIGl0ZW0gdGhpcyBsb2FkZXIgcmVwcmVzZW50cy4gTm90ZSB0aGF0IHRoaXMgaXMgbnVsbCBpbiBhIHt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlIn19e3svY3Jvc3NMaW5rfX0sIGJ1dCB3aWxsCgkgKiBiZSBhdmFpbGFibGUgb24gbG9hZGVycyBzdWNoIGFzIHt7I2Nyb3NzTGluayAiWEhSTG9hZGVyIn19e3svY3Jvc3NMaW5rfX0gYW5kIHt7I2Nyb3NzTGluayAiVGFnTG9hZGVyIn19e3svY3Jvc3NMaW5rfX0uCgkgKiBAcHJvcGVydHkgX2l0ZW0KCSAqIEB0eXBlIHtPYmplY3R9CgkgKiBAcHJpdmF0ZQoJICovCglwLl9pdGVtID0gbnVsbDsKCi8vIEV2ZW50cwoJLyoqCgkgKiBUaGUgZXZlbnQgdGhhdCBpcyBmaXJlZCB3aGVuIHRoZSBvdmVyYWxsIHByb2dyZXNzIGNoYW5nZXMuCgkgKiBAZXZlbnQgcHJvZ3Jlc3MKCSAqIEBwYXJhbSB7T2JqZWN0fSB0YXJnZXQgVGhlIG9iamVjdCB0aGF0IGRpc3BhdGNoZWQgdGhlIGV2ZW50LgoJICogQHBhcmFtIHtTdHJpbmd9IHR5cGUgVGhlIGV2ZW50IHR5cGUuCgkgKiBAcGFyYW0ge051bWJlcn0gbG9hZGVkIFRoZSBhbW91bnQgdGhhdCBoYXMgYmVlbiBsb2FkZWQgc28gZmFyLiBOb3RlIHRoYXQgdGhpcyBpcyBtYXkganVzdCBiZSBhIHBlcmNlbnRhZ2Ugb2YgMSwKCSAqIHNpbmNlIGZpbGUgc2l6ZXMgY2FuIG5vdCBiZSBkZXRlcm1pbmVkIGJlZm9yZSBhIGxvYWQgaXMga2lja2VkIG9mZiwgaWYgYXQgYWxsLgoJICogQHBhcmFtIHtOdW1iZXJ9IHRvdGFsIFRoZSB0b3RhbCBudW1iZXIgb2YgYnl0ZXMuIE5vdGUgdGhhdCB0aGlzIG1heSBqdXN0IGJlIDEuCgkgKiBAcGFyYW0ge051bWJlcn0gcHJvZ3Jlc3MgVGhlIHJhdGlvIHRoYXQgaGFzIGJlZW4gbG9hZGVkIGJldHdlZW4gMCBhbmQgMS4KCSAqIEBzaW5jZSAwLjMuMAoJICovCgoJLyoqCgkgKiBUaGUgZXZlbnQgdGhhdCBpcyBmaXJlZCB3aGVuIGEgbG9hZCBzdGFydHMuCgkgKiBAZXZlbnQgbG9hZHN0YXJ0CgkgKiBAcGFyYW0ge09iamVjdH0gdGFyZ2V0IFRoZSBvYmplY3QgdGhhdCBkaXNwYXRjaGVkIHRoZSBldmVudC4KCSAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlIFRoZSBldmVudCB0eXBlLgoJICogQHNpbmNlIDAuMy4xCgkgKi8KCgkvKioKCSAqIFRoZSBldmVudCB0aGF0IGlzIGZpcmVkIHdoZW4gdGhlIGVudGlyZSBxdWV1ZSBoYXMgYmVlbiBsb2FkZWQuCgkgKiBAZXZlbnQgY29tcGxldGUKCSAqIEBwYXJhbSB7T2JqZWN0fSB0YXJnZXQgVGhlIG9iamVjdCB0aGF0IGRpc3BhdGNoZWQgdGhlIGV2ZW50LgoJICogQHBhcmFtIHtTdHJpbmd9IHR5cGUgVGhlIGV2ZW50IHR5cGUuCgkgKiBAc2luY2UgMC4zLjAKCSAqLwoKCS8qKgoJICogVGhlIGV2ZW50IHRoYXQgaXMgZmlyZWQgd2hlbiB0aGUgbG9hZGVyIGVuY291bnRlcnMgYW4gZXJyb3IuIElmIHRoZSBlcnJvciB3YXMgZW5jb3VudGVyZWQgYnkgYSBmaWxlLCB0aGUgZXZlbnQgd2lsbAoJICogY29udGFpbiB0aGUgaXRlbSB0aGF0IGNhdXNlZCB0aGUgZXJyb3IuIFRoZXJlIG1heSBiZSBhZGRpdGlvbmFsIHByb3BlcnRpZXMgc3VjaCBhcyB0aGUgZXJyb3IgcmVhc29uIG9uIGV2ZW50CgkgKiBvYmplY3RzLgoJICogQGV2ZW50IGVycm9yCgkgKiBAcGFyYW0ge09iamVjdH0gdGFyZ2V0IFRoZSBvYmplY3QgdGhhdCBkaXNwYXRjaGVkIHRoZSBldmVudC4KCSAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlIFRoZSBldmVudCB0eXBlLgoJICogQHBhcmFtIHtPYmplY3R9IFtpdGVtXSBUaGUgaXRlbSB0aGF0IHdhcyBiZWluZyBsb2FkZWQgdGhhdCBjYXVzZWQgdGhlIGVycm9yLiBUaGUgaXRlbSB3YXMgc3BlY2lmaWVkIGluCgkgKiB0aGUge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvbG9hZEZpbGUifX17ey9jcm9zc0xpbmt9fSBvciB7eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZS9sb2FkTWFuaWZlc3QifX17ey9jcm9zc0xpbmt9fQoJICogY2FsbC4gSWYgb25seSBhIHN0cmluZyBwYXRoIG9yIHRhZyB3YXMgc3BlY2lmaWVkLCB0aGUgb2JqZWN0IHdpbGwgY29udGFpbiB0aGF0IHZhbHVlIGFzIGEgYHNyY2AgcHJvcGVydHkuCgkgKiBAcGFyYW0ge1N0cmluZ30gW2Vycm9yXSBUaGUgZXJyb3Igb2JqZWN0IG9yIHRleHQuCgkgKiBAc2luY2UgMC4zLjAKCSAqLwoKCS8vVE9ETzogRGVwcmVjYXRlZAoJLyoqCgkgKiBSRU1PVkVELiBVc2Uge3sjY3Jvc3NMaW5rICJFdmVudERpc3BhdGNoZXIvYWRkRXZlbnRMaXN0ZW5lciJ9fXt7L2Nyb3NzTGlua319IGFuZCB0aGUge3sjY3Jvc3NMaW5rICJBYnN0cmFjdExvYWRlci9wcm9ncmVzczpldmVudCJ9fXt7L2Nyb3NzTGlua319CgkgKiBldmVudC4KCSAqIEBwcm9wZXJ0eSBvblByb2dyZXNzCgkgKiBAdHlwZSB7RnVuY3Rpb259CgkgKiBAZGVwcmVjYXRlZCBVc2UgYWRkRXZlbnRMaXN0ZW5lciBhbmQgdGhlICJwcm9ncmVzcyIgZXZlbnQuCgkgKi8KCS8qKgoJICogUkVNT1ZFRC4gVXNlIHt7I2Nyb3NzTGluayAiRXZlbnREaXNwYXRjaGVyL2FkZEV2ZW50TGlzdGVuZXIifX17ey9jcm9zc0xpbmt9fSBhbmQgdGhlIHt7I2Nyb3NzTGluayAiQWJzdHJhY3RMb2FkZXIvbG9hZHN0YXJ0OmV2ZW50In19e3svY3Jvc3NMaW5rfX0KCSAqIGV2ZW50LgoJICogQHByb3BlcnR5IG9uTG9hZFN0YXJ0CgkgKiBAdHlwZSB7RnVuY3Rpb259CgkgKiBAZGVwcmVjYXRlZCBVc2UgYWRkRXZlbnRMaXN0ZW5lciBhbmQgdGhlICJsb2Fkc3RhcnQiIGV2ZW50LgoJICovCgkvKioKCSAqIFJFTU9WRUQuIFVzZSB7eyNjcm9zc0xpbmsgIkV2ZW50RGlzcGF0Y2hlci9hZGRFdmVudExpc3RlbmVyIn19e3svY3Jvc3NMaW5rfX0gYW5kIHRoZSB7eyNjcm9zc0xpbmsgIkFic3RyYWN0TG9hZGVyL2NvbXBsZXRlOmV2ZW50In19e3svY3Jvc3NMaW5rfX0KCSAqIGV2ZW50LgoJICogQHByb3BlcnR5IG9uQ29tcGxldGUKCSAqIEB0eXBlIHtGdW5jdGlvbn0KCSAqIEBkZXByZWNhdGVkIFVzZSBhZGRFdmVudExpc3RlbmVyIGFuZCB0aGUgImNvbXBsZXRlIiBldmVudC4KCSAqLwoJLyoqCgkgKiBSRU1PVkVELiBVc2Uge3sjY3Jvc3NMaW5rICJFdmVudERpc3BhdGNoZXIvYWRkRXZlbnRMaXN0ZW5lciJ9fXt7L2Nyb3NzTGlua319IGFuZCB0aGUge3sjY3Jvc3NMaW5rICJBYnN0cmFjdExvYWRlci9lcnJvcjpldmVudCJ9fXt7L2Nyb3NzTGlua319CgkgKiBldmVudC4KCSAqIEBwcm9wZXJ0eSBvbkVycm9yCgkgKiBAdHlwZSB7RnVuY3Rpb259CgkgKiBAZGVwcmVjYXRlZCBVc2UgYWRkRXZlbnRMaXN0ZW5lciBhbmQgdGhlICJlcnJvciIgZXZlbnQuCgkgKi8KCgkvKioKCSAqIEdldCBhIHJlZmVyZW5jZSB0byB0aGUgbWFuaWZlc3QgaXRlbSB0aGF0IGlzIGxvYWRlZCBieSB0aGlzIGxvYWRlci4gSW4gbW9zdCBjYXNlcyB0aGlzIHdpbGwgYmUgdGhlIHZhbHVlIHRoYXQgd2FzCgkgKiBwYXNzZWQgaW50byB7eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZSJ9fXt7L2Nyb3NzTGlua319IHVzaW5nIHt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlL2xvYWRGaWxlIn19e3svY3Jvc3NMaW5rfX0gb3IKCSAqIHt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlL2xvYWRNYW5pZmVzdCJ9fXt7L2Nyb3NzTGlua319LiBIb3dldmVyIGlmIG9ubHkgYSBTdHJpbmcgcGF0aCB3YXMgcGFzc2VkIGluLCB0aGVuIGl0IHdpbGwKCSAqIGJlIGFuIE9iamVjdCBjcmVhdGVkIGJ5IHRoZSBMb2FkUXVldWUuCgkgKiBAcmV0dXJuIHtPYmplY3R9IFRoZSBtYW5pZmVzdCBpdGVtIHRoYXQgdGhpcyBsb2FkZXIgaXMgcmVzcG9uc2libGUgZm9yIGxvYWRpbmcuCgkgKi8KCXAuZ2V0SXRlbSA9IGZ1bmN0aW9uKCkgewoJCXJldHVybiB0aGlzLl9pdGVtOwoJfTsKCgkvKioKCSAqIEluaXRpYWxpemUgdGhlIGxvYWRlci4gVGhpcyBpcyBjYWxsZWQgYnkgdGhlIGNvbnN0cnVjdG9yLgoJICogQG1ldGhvZCBpbml0CgkgKiBAcHJpdmF0ZQoJICovCglwLmluaXQgPSBmdW5jdGlvbiAoKSB7fTsKCgkvKioKCSAqIEJlZ2luIGxvYWRpbmcgdGhlIHF1ZXVlZCBpdGVtcy4gVGhpcyBtZXRob2QgY2FuIGJlIGNhbGxlZCB3aGVuIGEge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUifX17ey9jcm9zc0xpbmt9fSBpcyBzZXQKCSAqIHVwIGJ1dCBub3Qgc3RhcnRlZCBpbW1lZGlhdGVseS4KCSAqIEBleGFtcGxlCgkgKiAgICAgIHZhciBxdWV1ZSA9IG5ldyBjcmVhdGVqcy5Mb2FkUXVldWUoKTsKCSAqICAgICAgcXVldWUuYWRkRXZlbnRMaXN0ZW5lcigiY29tcGxldGUiLCBoYW5kbGVDb21wbGV0ZSk7CgkgKiAgICAgIHF1ZXVlLmxvYWRNYW5pZmVzdChmaWxlQXJyYXksIGZhbHNlKTsgLy8gTm90ZSB0aGUgMm5kIGFyZ3VtZW50IHRoYXQgdGVsbHMgdGhlIHF1ZXVlIG5vdCB0byBzdGFydCBsb2FkaW5nIHlldAoJICogICAgICBxdWV1ZS5sb2FkKCk7CgkgKiBAbWV0aG9kIGxvYWQKCSAqLwoJcC5sb2FkID0gZnVuY3Rpb24oKSB7fTsKCgkvKioKCSAqIENsb3NlIHRoZSBhY3RpdmUgcXVldWUuIENsb3NpbmcgYSBxdWV1ZSBjb21wbGV0ZWx5IGVtcHRpZXMgdGhlIHF1ZXVlLCBhbmQgcHJldmVudHMgYW55IHJlbWFpbmluZyBpdGVtcyBmcm9tCgkgKiBzdGFydGluZyB0byBkb3dubG9hZC4gTm90ZSB0aGF0IGN1cnJlbnRseSBhbnkgYWN0aXZlIGxvYWRzIHdpbGwgcmVtYWluIG9wZW4sIGFuZCBldmVudHMgbWF5IGJlIHByb2Nlc3NlZC4KCSAqCgkgKiBUbyBzdG9wIGFuZCByZXN0YXJ0IGEgcXVldWUsIHVzZSB0aGUge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvc2V0UGF1c2VkIn19e3svY3Jvc3NMaW5rfX0gbWV0aG9kIGluc3RlYWQuCgkgKiBAbWV0aG9kIGNsb3NlCgkgKi8KCXAuY2xvc2UgPSBmdW5jdGlvbigpIHt9OwoKCi8vQ2FsbGJhY2sgcHJveGllcwoJLyoqCgkgKiBEaXNwYXRjaCBhIGxvYWRzdGFydCBldmVudC4gUGxlYXNlIHNlZSB0aGUge3sjY3Jvc3NMaW5rICJBYnN0cmFjdExvYWRlci9sb2Fkc3RhcnQ6ZXZlbnQifX17ey9jcm9zc0xpbmt9fSBldmVudAoJICogZm9yIGRldGFpbHMgb24gdGhlIGV2ZW50IHBheWxvYWQuCgkgKiBAbWV0aG9kIF9zZW5kTG9hZFN0YXJ0CgkgKiBAcHJvdGVjdGVkCgkgKi8KCXAuX3NlbmRMb2FkU3RhcnQgPSBmdW5jdGlvbigpIHsKCQlpZiAodGhpcy5faXNDYW5jZWxlZCgpKSB7IHJldHVybjsgfQoJCXRoaXMuZGlzcGF0Y2hFdmVudCgibG9hZHN0YXJ0Iik7Cgl9OwoKCS8qKgoJICogRGlzcGF0Y2ggYSBwcm9ncmVzcyBldmVudC4gUGxlYXNlIHNlZSB0aGUge3sjY3Jvc3NMaW5rICJBYnN0cmFjdExvYWRlci9wcm9ncmVzczpldmVudCJ9fXt7L2Nyb3NzTGlua319IGV2ZW50IGZvcgoJICogZGV0YWlscyBvbiB0aGUgZXZlbnQgcGF5bG9hZC4KCSAqIEBtZXRob2QgX3NlbmRQcm9ncmVzcwoJICogQHBhcmFtIHtOdW1iZXIgfCBPYmplY3R9IHZhbHVlIFRoZSBwcm9ncmVzcyBvZiB0aGUgbG9hZGVkIGl0ZW0sIG9yIGFuIG9iamVjdCBjb250YWluaW5nIDxjb2RlPmxvYWRlZDwvY29kZT4KCSAqIGFuZCA8Y29kZT50b3RhbDwvY29kZT4gcHJvcGVydGllcy4KCSAqIEBwcm90ZWN0ZWQKCSAqLwoJcC5fc2VuZFByb2dyZXNzID0gZnVuY3Rpb24odmFsdWUpIHsKCQlpZiAodGhpcy5faXNDYW5jZWxlZCgpKSB7IHJldHVybjsgfQoJCXZhciBldmVudCA9IG51bGw7CgkJaWYgKHR5cGVvZih2YWx1ZSkgPT0gIm51bWJlciIpIHsKCQkJdGhpcy5wcm9ncmVzcyA9IHZhbHVlOwoJCQlldmVudCA9IG5ldyBjcmVhdGVqcy5FdmVudCgicHJvZ3Jlc3MiKTsKCQkJZXZlbnQubG9hZGVkID0gdGhpcy5wcm9ncmVzczsKCQkJZXZlbnQudG90YWwgPSAxOwoJCX0gZWxzZSB7CgkJCWV2ZW50ID0gdmFsdWU7CgkJCXRoaXMucHJvZ3Jlc3MgPSB2YWx1ZS5sb2FkZWQgLyB2YWx1ZS50b3RhbDsKCQkJaWYgKGlzTmFOKHRoaXMucHJvZ3Jlc3MpIHx8IHRoaXMucHJvZ3Jlc3MgPT0gSW5maW5pdHkpIHsgdGhpcy5wcm9ncmVzcyA9IDA7IH0KCQl9CgkJZXZlbnQucHJvZ3Jlc3MgPSB0aGlzLnByb2dyZXNzOwoJCXRoaXMuaGFzRXZlbnRMaXN0ZW5lcigicHJvZ3Jlc3MiKSAmJiB0aGlzLmRpc3BhdGNoRXZlbnQoZXZlbnQpOwoJfTsKCgkvKioKCSAqIERpc3BhdGNoIGEgY29tcGxldGUgZXZlbnQuIFBsZWFzZSBzZWUgdGhlIHt7I2Nyb3NzTGluayAiQWJzdHJhY3RMb2FkZXIvY29tcGxldGU6ZXZlbnQifX17ey9jcm9zc0xpbmt9fSBldmVudAoJICogZm9yIGRldGFpbHMgb24gdGhlIGV2ZW50IHBheWxvYWQuCgkgKiBAbWV0aG9kIF9zZW5kQ29tcGxldGUKCSAqIEBwcm90ZWN0ZWQKCSAqLwoJcC5fc2VuZENvbXBsZXRlID0gZnVuY3Rpb24oKSB7CgkJaWYgKHRoaXMuX2lzQ2FuY2VsZWQoKSkgeyByZXR1cm47IH0KCQl0aGlzLmRpc3BhdGNoRXZlbnQoImNvbXBsZXRlIik7Cgl9OwoKCS8qKgoJICogRGlzcGF0Y2ggYW4gZXJyb3IgZXZlbnQuIFBsZWFzZSBzZWUgdGhlIHt7I2Nyb3NzTGluayAiQWJzdHJhY3RMb2FkZXIvZXJyb3I6ZXZlbnQifX17ey9jcm9zc0xpbmt9fSBldmVudCBmb3IKCSAqIGRldGFpbHMgb24gdGhlIGV2ZW50IHBheWxvYWQuCgkgKiBAbWV0aG9kIF9zZW5kRXJyb3IKCSAqIEBwYXJhbSB7T2JqZWN0fSBldmVudCBUaGUgZXZlbnQgb2JqZWN0IGNvbnRhaW5pbmcgc3BlY2lmaWMgZXJyb3IgcHJvcGVydGllcy4KCSAqIEBwcm90ZWN0ZWQKCSAqLwoJcC5fc2VuZEVycm9yID0gZnVuY3Rpb24oZXZlbnQpIHsKCQlpZiAodGhpcy5faXNDYW5jZWxlZCgpIHx8ICF0aGlzLmhhc0V2ZW50TGlzdGVuZXIoImVycm9yIikpIHsgcmV0dXJuOyB9CgkJaWYgKGV2ZW50ID09IG51bGwpIHsKCQkJZXZlbnQgPSBuZXcgY3JlYXRlanMuRXZlbnQoImVycm9yIik7CgkJfQoJCXRoaXMuZGlzcGF0Y2hFdmVudChldmVudCk7Cgl9OwoKCS8qKgoJICogRGV0ZXJtaW5lIGlmIHRoZSBsb2FkIGhhcyBiZWVuIGNhbmNlbGVkLiBUaGlzIGlzIGltcG9ydGFudCB0byBlbnN1cmUgdGhhdCBtZXRob2QgY2FsbHMgb3IgYXN5bmNocm9ub3VzIGV2ZW50cwoJICogZG8gbm90IGNhdXNlIGlzc3VlcyBhZnRlciB0aGUgcXVldWUgaGFzIGJlZW4gY2xlYW5lZCB1cC4KCSAqIEBtZXRob2QgX2lzQ2FuY2VsZWQKCSAqIEByZXR1cm4ge0Jvb2xlYW59IElmIHRoZSBsb2FkZXIgaGFzIGJlZW4gY2FuY2VsZWQuCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXAuX2lzQ2FuY2VsZWQgPSBmdW5jdGlvbigpIHsKCQlpZiAod2luZG93LmNyZWF0ZWpzID09IG51bGwgfHwgdGhpcy5jYW5jZWxlZCkgewoJCQlyZXR1cm4gdHJ1ZTsKCQl9CgkJcmV0dXJuIGZhbHNlOwoJfTsKCgkvKioKCSAqIEBtZXRob2QgX3BhcnNlVVJJCgkgKiBQYXJzZSBhIGZpbGUgcGF0aCB0byBkZXRlcm1pbmUgdGhlIGluZm9ybWF0aW9uIHdlIG5lZWQgdG8gd29yayB3aXRoIGl0LiBDdXJyZW50bHksIFByZWxvYWRKUyBuZWVkcyB0byBrbm93OgoJICogPHVsPgoJICogICAgIDxsaT5JZiB0aGUgcGF0aCBpcyBhYnNvbHV0ZS4gQWJzb2x1dGUgcGF0aHMgc3RhcnQgd2l0aCBhIHByb3RvY29sIChzdWNoIGFzIGBodHRwOi8vYCwgYGZpbGU6Ly9gLCBvcgoJICogICAgIGAvL25ldHdvcmtQYXRoYCk8L2xpPgoJICogICAgIDxsaT5JZiB0aGUgcGF0aCBpcyByZWxhdGl2ZS4gUmVsYXRpdmUgcGF0aHMgc3RhcnQgd2l0aCBgLi4vYCBvciBgL3BhdGhgIChvciBzaW1pbGFyKTwvbGk+CgkgKiAgICAgPGxpPlRoZSBmaWxlIGV4dGVuc2lvbi4gVGhpcyBpcyBkZXRlcm1pbmVkIGJ5IHRoZSBmaWxlbmFtZSB3aXRoIGFuIGV4dGVuc2lvbi4gUXVlcnkgc3RyaW5ncyBhcmUgZHJvcHBlZCwgYW5kCgkgKiAgICAgdGhlIGZpbGUgcGF0aCBpcyBleHBlY3RlZCB0byBmb2xsb3cgdGhlIGZvcm1hdCBgbmFtZS5leHRgLjwvbGk+CgkgKiA8L3VsPgoJICoKCSAqIDxzdHJvbmc+Tm90ZTo8L3N0cm9uZz4gVGhpcyBoYXMgY2hhbmdlZCBmcm9tIGVhcmxpZXIgdmVyc2lvbnMsIHdoaWNoIHVzZWQgYSBzaW5nbGUsIGNvbXBsaWNhdGVkIFJlZ3VsYXIgRXhwcmVzc2lvbiwgd2hpY2gKCSAqIHdhcyBkaWZmaWN1bHQgdG8gbWFpbnRhaW4sIGFuZCBvdmVyLWFnZ3Jlc3NpdmUgaW4gZGV0ZXJtaW5pbmcgYWxsIGZpbGUgcHJvcGVydGllcy4gSXQgaGFzIGJlZW4gc2ltcGxpZmllZCB0bwoJICogb25seSBwdWxsIG91dCB3aGF0IGl0IG5lZWRzLgoJICogQHBhcmFtIHBhdGgKCSAqIEByZXR1cm5zIHtPYmplY3R9IEFuIE9iamVjdCB3aXRoIGFuIGBhYnNvbHV0ZWAgYW5kIGByZWxhdGl2ZWAgQm9vbGVhbiwgYXMgd2VsbCBhcyBhbiBvcHRpb25hbCAnZXh0ZW5zaW9uYCBTdHJpbmcKCSAqIHByb3BlcnR5LCB3aGljaCBpcyB0aGUgbG93ZXJjYXNlIGV4dGVuc2lvbi4KCSAqIEBwcml2YXRlCgkgKi8KCXAuX3BhcnNlVVJJID0gZnVuY3Rpb24ocGF0aCkgewoJCXZhciBpbmZvID0geyBhYnNvbHV0ZTogZmFsc2UsIHJlbGF0aXZlOmZhbHNlIH07CgkJaWYgKHBhdGggPT0gbnVsbCkgeyByZXR1cm4gaW5mbzsgfTsKCgkJLy8gRHJvcCB0aGUgcXVlcnkgc3RyaW5nCgkJdmFyIHF1ZXJ5SW5kZXggPSBwYXRoLmluZGV4T2YoIj8iKTsKCQlpZiAocXVlcnlJbmRleCA+IC0xKSB7CgkJCXBhdGggPSBwYXRoLnN1YnN0cigwLHF1ZXJ5SW5kZXgpOwoJCX0KCgkJLy8gQWJzb2x1dGUKCQl2YXIgbWF0Y2g7CgkJaWYgKHMuQUJTT0xVVEVfUEFUVC50ZXN0KHBhdGgpKSB7CgkJCWluZm8uYWJzb2x1dGUgPSB0cnVlOwoKCQkvLyBSZWxhdGl2ZQoJCX0gZWxzZSBpZiAocy5SRUxBVElWRV9QQVRULnRlc3QocGF0aCkpIHsKCQkJaW5mby5yZWxhdGl2ZSA9IHRydWU7CgkJfQoKCQkvLyBFeHRlbnNpb24KCQlpZiAobWF0Y2ggPSBwYXRoLm1hdGNoKHMuRVhURU5TSU9OX1BBVFQpKSB7CgkJCWluZm8uZXh0ZW5zaW9uID0gbWF0Y2hbMV0udG9Mb3dlckNhc2UoKTsKCQl9CgkJcmV0dXJuIGluZm87Cgl9OwoKCS8qKgoJICogRm9ybWF0cyBhbiBvYmplY3QgaW50byBhIHF1ZXJ5IHN0cmluZyBmb3IgZWl0aGVyIGEgUE9TVCBvciBHRVQgcmVxdWVzdC4KCSAqIEBtZXRob2QgX2Zvcm1hdFF1ZXJ5U3RyaW5nCgkgKiBAcGFyYW0ge09iamVjdH0gZGF0YSBUaGUgZGF0YSB0byBjb252ZXJ0IHRvIGEgcXVlcnkgc3RyaW5nLgoJICogQHBhcmFtIHtBcnJheX0gW3F1ZXJ5XSBFeGlzdGluZyBuYW1lL3ZhbHVlIHBhaXJzIHRvIGFwcGVuZCBvbiB0byB0aGlzIHF1ZXJ5LgoJICogQHByaXZhdGUKCSAqLwoJcC5fZm9ybWF0UXVlcnlTdHJpbmcgPSBmdW5jdGlvbihkYXRhLCBxdWVyeSkgewoJCWlmIChkYXRhID09IG51bGwpIHsKCQkJdGhyb3cgbmV3IEVycm9yKCdZb3UgbXVzdCBzcGVjaWZ5IGRhdGEuJyk7CgkJfQoJCXZhciBwYXJhbXMgPSBbXTsKCQlmb3IgKHZhciBuIGluIGRhdGEpIHsKCQkJcGFyYW1zLnB1c2gobisnPScrZXNjYXBlKGRhdGFbbl0pKTsKCQl9CgkJaWYgKHF1ZXJ5KSB7CgkJCXBhcmFtcyA9IHBhcmFtcy5jb25jYXQocXVlcnkpOwoJCX0KCQlyZXR1cm4gcGFyYW1zLmpvaW4oJyYnKTsKCX07CgoJLyoqCgkgKiBBIHV0aWxpdHkgbWV0aG9kIHRoYXQgYnVpbGRzIGEgZmlsZSBwYXRoIHVzaW5nIGEgc291cmNlIGFuZCBhIGRhdGEgb2JqZWN0LCBhbmQgZm9ybWF0cyBpdCBpbnRvIGEgbmV3IHBhdGguIEFsbAoJICogb2YgdGhlIGxvYWRlcnMgaW4gUHJlbG9hZEpTIHVzZSB0aGlzIG1ldGhvZCB0byBjb21waWxlIHBhdGhzIHdoZW4gbG9hZGluZy4KCSAqIEBtZXRob2QgYnVpbGRQYXRoCgkgKiBAcGFyYW0ge1N0cmluZ30gc3JjIFRoZSBzb3VyY2UgcGF0aCB0byBhZGQgdmFsdWVzIHRvLgoJICogQHBhcmFtIHtPYmplY3R9IFtkYXRhXSBPYmplY3QgdXNlZCB0byBhcHBlbmQgdmFsdWVzIHRvIHRoaXMgcmVxdWVzdCBhcyBhIHF1ZXJ5IHN0cmluZy4gRXhpc3RpbmcgcGFyYW1ldGVycyBvbiB0aGUKCSAqIHBhdGggd2lsbCBiZSBwcmVzZXJ2ZWQuCgkgKiBAcmV0dXJucyB7c3RyaW5nfSBBIGZvcm1hdHRlZCBzdHJpbmcgdGhhdCBjb250YWlucyB0aGUgcGF0aCBhbmQgdGhlIHN1cHBsaWVkIHBhcmFtZXRlcnMuCgkgKiBAc2luY2UgMC4zLjEKCSAqLwoJcC5idWlsZFBhdGggPSBmdW5jdGlvbihzcmMsIGRhdGEpIHsKCQlpZiAoZGF0YSA9PSBudWxsKSB7CgkJCXJldHVybiBzcmM7CgkJfQoKCQl2YXIgcXVlcnkgPSBbXTsKCQl2YXIgaWR4ID0gc3JjLmluZGV4T2YoJz8nKTsKCgkJaWYgKGlkeCAhPSAtMSkgewoJCQl2YXIgcSA9IHNyYy5zbGljZShpZHgrMSk7CgkJCXF1ZXJ5ID0gcXVlcnkuY29uY2F0KHEuc3BsaXQoJyYnKSk7CgkJfQoKCQlpZiAoaWR4ICE9IC0xKSB7CgkJCXJldHVybiBzcmMuc2xpY2UoMCwgaWR4KSArICc/JyArIHRoaXMuX2Zvcm1hdFF1ZXJ5U3RyaW5nKGRhdGEsIHF1ZXJ5KTsKCQl9IGVsc2UgewoJCQlyZXR1cm4gc3JjICsgJz8nICsgdGhpcy5fZm9ybWF0UXVlcnlTdHJpbmcoZGF0YSwgcXVlcnkpOwoJCX0KCX07CgoJLyoqCgkgKiBAbWV0aG9kIF9pc0Nyb3NzRG9tYWluCgkgKiBAcGFyYW0ge09iamVjdH0gaXRlbSBBIGxvYWQgaXRlbSB3aXRoIGEgYHNyY2AgcHJvcGVydHkKCSAqIEByZXR1cm4ge0Jvb2xlYW59IElmIHRoZSBsb2FkIGl0ZW0gaXMgbG9hZGluZyBmcm9tIGEgZGlmZmVyZW50IGRvbWFpbiB0aGFuIHRoZSBjdXJyZW50IGxvY2F0aW9uLgoJICogQHByaXZhdGUKCSAqLwoJcC5faXNDcm9zc0RvbWFpbiA9IGZ1bmN0aW9uKGl0ZW0pIHsKCQl2YXIgdGFyZ2V0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYSIpOwoJCXRhcmdldC5ocmVmID0gaXRlbS5zcmM7CgoJCXZhciBob3N0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYSIpOwoJCWhvc3QuaHJlZiA9IGxvY2F0aW9uLmhyZWY7CgoJCXZhciBjcm9zc2RvbWFpbiA9ICh0YXJnZXQuaG9zdG5hbWUgIT0gIiIpICYmCgkJCQkodGFyZ2V0LnBvcnQgIT0gaG9zdC5wb3J0IHx8CgkJCQkJCXRhcmdldC5wcm90b2NvbCAhPSBob3N0LnByb3RvY29sIHx8CgkJCQkJCXRhcmdldC5ob3N0bmFtZSAhPSBob3N0Lmhvc3RuYW1lKTsKCQlyZXR1cm4gY3Jvc3Nkb21haW47Cgl9CgoJLyoqCgkgKiBAbWV0aG9kIF9pc0xvY2FsCgkgKiBAcGFyYW0ge09iamVjdH0gaXRlbSBBIGxvYWQgaXRlbSB3aXRoIGEgYHNyY2AgcHJvcGVydHkKCSAqIEByZXR1cm4ge0Jvb2xlYW59IElmIHRoZSBsb2FkIGl0ZW0gaXMgbG9hZGluZyBmcm9tIHRoZSAiZmlsZToiIHByb3RvY29sLiBBc3N1bWUgdGhhdCB0aGUgaG9zdCBtdXN0IGJlIGxvY2FsIGFzCgkgKiB3ZWxsLgoJICogQHByaXZhdGUKCSAqLwoJcC5faXNMb2NhbCA9IGZ1bmN0aW9uKGl0ZW0pIHsKCQl2YXIgdGFyZ2V0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYSIpOwoJCXRhcmdldC5ocmVmID0gaXRlbS5zcmM7CgkJcmV0dXJuIHRhcmdldC5ob3N0bmFtZSA9PSAiIiAmJiB0YXJnZXQucHJvdG9jb2wgPT0gImZpbGU6IjsKCX07CgoJLyoqCgkgKiBAbWV0aG9kIHRvU3RyaW5nCgkgKiBAcmV0dXJuIHtTdHJpbmd9IGEgc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBpbnN0YW5jZS4KCSAqLwoJcC50b1N0cmluZyA9IGZ1bmN0aW9uKCkgewoJCXJldHVybiAiW1ByZWxvYWRKUyBBYnN0cmFjdExvYWRlcl0iOwoJfTsKCgljcmVhdGVqcy5BYnN0cmFjdExvYWRlciA9IEFic3RyYWN0TG9hZGVyOwoKfSgpKTsK",
                "body": "LyoKKiBBYnN0cmFjdExvYWRlcgoqIFZpc2l0IGh0dHA6Ly9jcmVhdGVqcy5jb20vIGZvciBkb2N1bWVudGF0aW9uLCB1cGRhdGVzIGFuZCBleGFtcGxlcy4KKgoqCiogQ29weXJpZ2h0IChjKSAyMDEyIGdza2lubmVyLmNvbSwgaW5jLgoqCiogUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24KKiBvYnRhaW5pbmcgYSBjb3B5IG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbgoqIGZpbGVzICh0aGUgIlNvZnR3YXJlIiksIHRvIGRlYWwgaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQKKiByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzIHRvIHVzZSwKKiBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbAoqIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZQoqIFNvZnR3YXJlIGlzIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nCiogY29uZGl0aW9uczoKKgoqIFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlCiogaW5jbHVkZWQgaW4gYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuCioKKiBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwKKiBFWFBSRVNTIE9SIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMKKiBPRiBNRVJDSEFOVEFCSUxJVFksIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORAoqIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUlMgT1IgQ09QWVJJR0hUCiogSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUiBMSUFCSUxJVFksCiogV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HCiogRlJPTSwgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUgoqIE9USEVSIERFQUxJTkdTIElOIFRIRSBTT0ZUV0FSRS4KKi8KCi8qKgogKiBAbW9kdWxlIFByZWxvYWRKUwogKi8KCi8vIG5hbWVzcGFjZToKdGhpcy5jcmVhdGVqcyA9IHRoaXMuY3JlYXRlanN8fHt9OwoKKGZ1bmN0aW9uKCkgewoJInVzZSBzdHJpY3QiOwoJLyoqCgkgKiBUaGUgYmFzZSBsb2FkZXIsIHdoaWNoIGRlZmluZXMgYWxsIHRoZSBnZW5lcmljIGNhbGxiYWNrcyBhbmQgZXZlbnRzLiBBbGwgbG9hZGVycyBleHRlbmQgdGhpcyBjbGFzcywgaW5jbHVkaW5nIHRoZQoJICoge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUifX17ey9jcm9zc0xpbmt9fS4KCSAqIEBjbGFzcyBBYnN0cmFjdExvYWRlcgoJICogQGV4dGVuZHMgRXZlbnREaXNwYXRjaGVyCgkgKi8KCXZhciBBYnN0cmFjdExvYWRlciA9IGZ1bmN0aW9uICgpIHsKCQl0aGlzLmluaXQoKTsKCX07CgoJdmFyIHAgPSBBYnN0cmFjdExvYWRlci5wcm90b3R5cGUgPSBuZXcgY3JlYXRlanMuRXZlbnREaXNwYXRjaGVyKCk7CglBYnN0cmFjdExvYWRlci5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBBYnN0cmFjdExvYWRlcjsKCXZhciBzID0gQWJzdHJhY3RMb2FkZXI7CgoJLyoqCgkgKiBUaGUgUmVndWxhciBFeHByZXNzaW9uIHVzZWQgdG8gdGVzdCBmaWxlIFVSTFMgZm9yIGFuIGFic29sdXRlIHBhdGguCgkgKiBAcHJvcGVydHkgQUJTT0xVVEVfUEFUSAoJICogQHN0YXRpYwoJICogQHR5cGUge1JlZ0V4cH0KCSAqIEBzaW5jZSAwLjQuMgoJICovCglzLkFCU09MVVRFX1BBVFQgPSAvXig/Olx3KzopP1wvezJ9L2k7CgoJLyoqCgkgKiBUaGUgUmVndWxhciBFeHByZXNzaW9uIHVzZWQgdG8gdGVzdCBmaWxlIFVSTFMgZm9yIGFuIGFic29sdXRlIHBhdGguCgkgKiBAcHJvcGVydHkgUkVMQVRJVkVfUEFUSAoJICogQHN0YXRpYwoJICogQHR5cGUge1JlZ0V4cH0KCSAqIEBzaW5jZSAwLjQuMgoJICovCglzLlJFTEFUSVZFX1BBVFQgPSAoL15bLi9dKj9cLy9pKTsKCgkvKioKCSAqIFRoZSBSZWd1bGFyIEV4cHJlc3Npb24gdXNlZCB0byB0ZXN0IGZpbGUgVVJMUyBmb3IgYW4gZXh0ZW5zaW9uLiBOb3RlIHRoYXQgVVJJcyBtdXN0IGFscmVhZHkgaGF2ZSB0aGUgcXVlcnkgc3RyaW5nCgkgKiByZW1vdmVkLgoJICogQHByb3BlcnR5IEVYVEVOU0lPTl9QQVRUCgkgKiBAc3RhdGljCgkgKiBAdHlwZSB7UmVnRXhwfQoJICogQHNpbmNlIDAuNC4yCgkgKi8KCXMuRVhURU5TSU9OX1BBVFQgPSAvXC8/W14vXStcLihcd3sxLDV9KSQvaTsKCgkvKioKCSAqIElmIHRoZSBsb2FkZXIgaGFzIGNvbXBsZXRlZCBsb2FkaW5nLiBUaGlzIHByb3ZpZGVzIGEgcXVpY2sgY2hlY2ssIGJ1dCBhbHNvIGVuc3VyZXMgdGhhdCB0aGUgZGlmZmVyZW50IGFwcHJvYWNoZXMKCSAqIHVzZWQgZm9yIGxvYWRpbmcgZG8gbm90IHBpbGUgdXAgcmVzdWx0aW5nIGluIG1vcmUgdGhhbiBvbmUgPGNvZGU+Y29tcGxldGU8L2NvZGU+IGV2ZW50LgoJICogQHByb3BlcnR5IGxvYWRlZAoJICogQHR5cGUge0Jvb2xlYW59CgkgKiBAZGVmYXVsdCBmYWxzZQoJICovCglwLmxvYWRlZCA9IGZhbHNlOwoKCS8qKgoJICogRGV0ZXJtaW5lIGlmIHRoZSBsb2FkZXIgd2FzIGNhbmNlbGVkLiBDYW5jZWxlZCBsb2FkcyB3aWxsIG5vdCBmaXJlIGNvbXBsZXRlIGV2ZW50cy4gTm90ZSB0aGF0CgkgKiB7eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZSJ9fXt7L2Nyb3NzTGlua319IHF1ZXVlcyBzaG91bGQgYmUgY2xvc2VkIHVzaW5nIHt7I2Nyb3NzTGluayAiQWJzdHJhY3RMb2FkZXIvY2xvc2UifX17ey9jcm9zc0xpbmt9fQoJICogaW5zdGVhZCBvZiBzZXR0aW5nIHRoaXMgcHJvcGVydHkuCgkgKiBAcHJvcGVydHkgY2FuY2VsZWQKCSAqIEB0eXBlIHtCb29sZWFufQoJICogQGRlZmF1bHQgZmFsc2UKCSAqLwoJcC5jYW5jZWxlZCA9IGZhbHNlOwoKCS8qKgoJICogVGhlIGN1cnJlbnQgbG9hZCBwcm9ncmVzcyAocGVyY2VudGFnZSkgZm9yIHRoaXMgaXRlbS4gVGhpcyB3aWxsIGJlIGEgbnVtYmVyIGJldHdlZW4gMCBhbmQgMS4KCSAqCgkgKiA8aDQ+RXhhbXBsZTwvaDQ+CgkgKgoJICogICAgIHZhciBxdWV1ZSA9IG5ldyBjcmVhdGVqcy5Mb2FkUXVldWUoKTsKCSAqICAgICBxdWV1ZS5sb2FkRmlsZSgibGFyZ2VJbWFnZS5wbmciKTsKCSAqICAgICBxdWV1ZS5vbigicHJvZ3Jlc3MiLCBmdW5jdGlvbigpIHsKCSAqICAgICAgICAgY29uc29sZS5sb2coIlByb2dyZXNzOiIsIHF1ZXVlLnByb2dyZXNzLCBldmVudC5wcm9ncmVzcyk7CgkgKiAgICAgfSk7CgkgKgoJICogQHByb3BlcnR5IHByb2dyZXNzCgkgKiBAdHlwZSB7TnVtYmVyfQoJICogQGRlZmF1bHQgMAoJICovCglwLnByb2dyZXNzID0gMDsKCgkvKioKCSAqIFRoZSBpdGVtIHRoaXMgbG9hZGVyIHJlcHJlc2VudHMuIE5vdGUgdGhhdCB0aGlzIGlzIG51bGwgaW4gYSB7eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZSJ9fXt7L2Nyb3NzTGlua319LCBidXQgd2lsbAoJICogYmUgYXZhaWxhYmxlIG9uIGxvYWRlcnMgc3VjaCBhcyB7eyNjcm9zc0xpbmsgIlhIUkxvYWRlciJ9fXt7L2Nyb3NzTGlua319IGFuZCB7eyNjcm9zc0xpbmsgIlRhZ0xvYWRlciJ9fXt7L2Nyb3NzTGlua319LgoJICogQHByb3BlcnR5IF9pdGVtCgkgKiBAdHlwZSB7T2JqZWN0fQoJICogQHByaXZhdGUKCSAqLwoJcC5faXRlbSA9IG51bGw7CgovLyBFdmVudHMKCS8qKgoJICogVGhlIGV2ZW50IHRoYXQgaXMgZmlyZWQgd2hlbiB0aGUgb3ZlcmFsbCBwcm9ncmVzcyBjaGFuZ2VzLgoJICogQGV2ZW50IHByb2dyZXNzCgkgKiBAcGFyYW0ge09iamVjdH0gdGFyZ2V0IFRoZSBvYmplY3QgdGhhdCBkaXNwYXRjaGVkIHRoZSBldmVudC4KCSAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlIFRoZSBldmVudCB0eXBlLgoJICogQHBhcmFtIHtOdW1iZXJ9IGxvYWRlZCBUaGUgYW1vdW50IHRoYXQgaGFzIGJlZW4gbG9hZGVkIHNvIGZhci4gTm90ZSB0aGF0IHRoaXMgaXMgbWF5IGp1c3QgYmUgYSBwZXJjZW50YWdlIG9mIDEsCgkgKiBzaW5jZSBmaWxlIHNpemVzIGNhbiBub3QgYmUgZGV0ZXJtaW5lZCBiZWZvcmUgYSBsb2FkIGlzIGtpY2tlZCBvZmYsIGlmIGF0IGFsbC4KCSAqIEBwYXJhbSB7TnVtYmVyfSB0b3RhbCBUaGUgdG90YWwgbnVtYmVyIG9mIGJ5dGVzLiBOb3RlIHRoYXQgdGhpcyBtYXkganVzdCBiZSAxLgoJICogQHBhcmFtIHtOdW1iZXJ9IHByb2dyZXNzIFRoZSByYXRpbyB0aGF0IGhhcyBiZWVuIGxvYWRlZCBiZXR3ZWVuIDAgYW5kIDEuCgkgKiBAc2luY2UgMC4zLjAKCSAqLwoKCS8qKgoJICogVGhlIGV2ZW50IHRoYXQgaXMgZmlyZWQgd2hlbiBhIGxvYWQgc3RhcnRzLgoJICogQGV2ZW50IGxvYWRzdGFydAoJICogQHBhcmFtIHtPYmplY3R9IHRhcmdldCBUaGUgb2JqZWN0IHRoYXQgZGlzcGF0Y2hlZCB0aGUgZXZlbnQuCgkgKiBAcGFyYW0ge1N0cmluZ30gdHlwZSBUaGUgZXZlbnQgdHlwZS4KCSAqIEBzaW5jZSAwLjMuMQoJICovCgoJLyoqCgkgKiBUaGUgZXZlbnQgdGhhdCBpcyBmaXJlZCB3aGVuIHRoZSBlbnRpcmUgcXVldWUgaGFzIGJlZW4gbG9hZGVkLgoJICogQGV2ZW50IGNvbXBsZXRlCgkgKiBAcGFyYW0ge09iamVjdH0gdGFyZ2V0IFRoZSBvYmplY3QgdGhhdCBkaXNwYXRjaGVkIHRoZSBldmVudC4KCSAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlIFRoZSBldmVudCB0eXBlLgoJICogQHNpbmNlIDAuMy4wCgkgKi8KCgkvKioKCSAqIFRoZSBldmVudCB0aGF0IGlzIGZpcmVkIHdoZW4gdGhlIGxvYWRlciBlbmNvdW50ZXJzIGFuIGVycm9yLiBJZiB0aGUgZXJyb3Igd2FzIGVuY291bnRlcmVkIGJ5IGEgZmlsZSwgdGhlIGV2ZW50IHdpbGwKCSAqIGNvbnRhaW4gdGhlIGl0ZW0gdGhhdCBjYXVzZWQgdGhlIGVycm9yLiBUaGVyZSBtYXkgYmUgYWRkaXRpb25hbCBwcm9wZXJ0aWVzIHN1Y2ggYXMgdGhlIGVycm9yIHJlYXNvbiBvbiBldmVudAoJICogb2JqZWN0cy4KCSAqIEBldmVudCBlcnJvcgoJICogQHBhcmFtIHtPYmplY3R9IHRhcmdldCBUaGUgb2JqZWN0IHRoYXQgZGlzcGF0Y2hlZCB0aGUgZXZlbnQuCgkgKiBAcGFyYW0ge1N0cmluZ30gdHlwZSBUaGUgZXZlbnQgdHlwZS4KCSAqIEBwYXJhbSB7T2JqZWN0fSBbaXRlbV0gVGhlIGl0ZW0gdGhhdCB3YXMgYmVpbmcgbG9hZGVkIHRoYXQgY2F1c2VkIHRoZSBlcnJvci4gVGhlIGl0ZW0gd2FzIHNwZWNpZmllZCBpbgoJICogdGhlIHt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlL2xvYWRGaWxlIn19e3svY3Jvc3NMaW5rfX0gb3Ige3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvbG9hZE1hbmlmZXN0In19e3svY3Jvc3NMaW5rfX0KCSAqIGNhbGwuIElmIG9ubHkgYSBzdHJpbmcgcGF0aCBvciB0YWcgd2FzIHNwZWNpZmllZCwgdGhlIG9iamVjdCB3aWxsIGNvbnRhaW4gdGhhdCB2YWx1ZSBhcyBhIGBzcmNgIHByb3BlcnR5LgoJICogQHBhcmFtIHtTdHJpbmd9IFtlcnJvcl0gVGhlIGVycm9yIG9iamVjdCBvciB0ZXh0LgoJICogQHNpbmNlIDAuMy4wCgkgKi8KCgkvL1RPRE86IERlcHJlY2F0ZWQKCS8qKgoJICogUkVNT1ZFRC4gVXNlIHt7I2Nyb3NzTGluayAiRXZlbnREaXNwYXRjaGVyL2FkZEV2ZW50TGlzdGVuZXIifX17ey9jcm9zc0xpbmt9fSBhbmQgdGhlIHt7I2Nyb3NzTGluayAiQWJzdHJhY3RMb2FkZXIvcHJvZ3Jlc3M6ZXZlbnQifX17ey9jcm9zc0xpbmt9fQoJICogZXZlbnQuCgkgKiBAcHJvcGVydHkgb25Qcm9ncmVzcwoJICogQHR5cGUge0Z1bmN0aW9ufQoJICogQGRlcHJlY2F0ZWQgVXNlIGFkZEV2ZW50TGlzdGVuZXIgYW5kIHRoZSAicHJvZ3Jlc3MiIGV2ZW50LgoJICovCgkvKioKCSAqIFJFTU9WRUQuIFVzZSB7eyNjcm9zc0xpbmsgIkV2ZW50RGlzcGF0Y2hlci9hZGRFdmVudExpc3RlbmVyIn19e3svY3Jvc3NMaW5rfX0gYW5kIHRoZSB7eyNjcm9zc0xpbmsgIkFic3RyYWN0TG9hZGVyL2xvYWRzdGFydDpldmVudCJ9fXt7L2Nyb3NzTGlua319CgkgKiBldmVudC4KCSAqIEBwcm9wZXJ0eSBvbkxvYWRTdGFydAoJICogQHR5cGUge0Z1bmN0aW9ufQoJICogQGRlcHJlY2F0ZWQgVXNlIGFkZEV2ZW50TGlzdGVuZXIgYW5kIHRoZSAibG9hZHN0YXJ0IiBldmVudC4KCSAqLwoJLyoqCgkgKiBSRU1PVkVELiBVc2Uge3sjY3Jvc3NMaW5rICJFdmVudERpc3BhdGNoZXIvYWRkRXZlbnRMaXN0ZW5lciJ9fXt7L2Nyb3NzTGlua319IGFuZCB0aGUge3sjY3Jvc3NMaW5rICJBYnN0cmFjdExvYWRlci9jb21wbGV0ZTpldmVudCJ9fXt7L2Nyb3NzTGlua319CgkgKiBldmVudC4KCSAqIEBwcm9wZXJ0eSBvbkNvbXBsZXRlCgkgKiBAdHlwZSB7RnVuY3Rpb259CgkgKiBAZGVwcmVjYXRlZCBVc2UgYWRkRXZlbnRMaXN0ZW5lciBhbmQgdGhlICJjb21wbGV0ZSIgZXZlbnQuCgkgKi8KCS8qKgoJICogUkVNT1ZFRC4gVXNlIHt7I2Nyb3NzTGluayAiRXZlbnREaXNwYXRjaGVyL2FkZEV2ZW50TGlzdGVuZXIifX17ey9jcm9zc0xpbmt9fSBhbmQgdGhlIHt7I2Nyb3NzTGluayAiQWJzdHJhY3RMb2FkZXIvZXJyb3I6ZXZlbnQifX17ey9jcm9zc0xpbmt9fQoJICogZXZlbnQuCgkgKiBAcHJvcGVydHkgb25FcnJvcgoJICogQHR5cGUge0Z1bmN0aW9ufQoJICogQGRlcHJlY2F0ZWQgVXNlIGFkZEV2ZW50TGlzdGVuZXIgYW5kIHRoZSAiZXJyb3IiIGV2ZW50LgoJICovCgoJLyoqCgkgKiBHZXQgYSByZWZlcmVuY2UgdG8gdGhlIG1hbmlmZXN0IGl0ZW0gdGhhdCBpcyBsb2FkZWQgYnkgdGhpcyBsb2FkZXIuIEluIG1vc3QgY2FzZXMgdGhpcyB3aWxsIGJlIHRoZSB2YWx1ZSB0aGF0IHdhcwoJICogcGFzc2VkIGludG8ge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUifX17ey9jcm9zc0xpbmt9fSB1c2luZyB7eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZS9sb2FkRmlsZSJ9fXt7L2Nyb3NzTGlua319IG9yCgkgKiB7eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZS9sb2FkTWFuaWZlc3QifX17ey9jcm9zc0xpbmt9fS4gSG93ZXZlciBpZiBvbmx5IGEgU3RyaW5nIHBhdGggd2FzIHBhc3NlZCBpbiwgdGhlbiBpdCB3aWxsCgkgKiBiZSBhbiBPYmplY3QgY3JlYXRlZCBieSB0aGUgTG9hZFF1ZXVlLgoJICogQHJldHVybiB7T2JqZWN0fSBUaGUgbWFuaWZlc3QgaXRlbSB0aGF0IHRoaXMgbG9hZGVyIGlzIHJlc3BvbnNpYmxlIGZvciBsb2FkaW5nLgoJICovCglwLmdldEl0ZW0gPSBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5faXRlbTsKCX07CgoJLyoqCgkgKiBJbml0aWFsaXplIHRoZSBsb2FkZXIuIFRoaXMgaXMgY2FsbGVkIGJ5IHRoZSBjb25zdHJ1Y3Rvci4KCSAqIEBtZXRob2QgaW5pdAoJICogQHByaXZhdGUKCSAqLwoJcC5pbml0ID0gZnVuY3Rpb24gKCkge307CgoJLyoqCgkgKiBCZWdpbiBsb2FkaW5nIHRoZSBxdWV1ZWQgaXRlbXMuIFRoaXMgbWV0aG9kIGNhbiBiZSBjYWxsZWQgd2hlbiBhIHt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlIn19e3svY3Jvc3NMaW5rfX0gaXMgc2V0CgkgKiB1cCBidXQgbm90IHN0YXJ0ZWQgaW1tZWRpYXRlbHkuCgkgKiBAZXhhbXBsZQoJICogICAgICB2YXIgcXVldWUgPSBuZXcgY3JlYXRlanMuTG9hZFF1ZXVlKCk7CgkgKiAgICAgIHF1ZXVlLmFkZEV2ZW50TGlzdGVuZXIoImNvbXBsZXRlIiwgaGFuZGxlQ29tcGxldGUpOwoJICogICAgICBxdWV1ZS5sb2FkTWFuaWZlc3QoZmlsZUFycmF5LCBmYWxzZSk7IC8vIE5vdGUgdGhlIDJuZCBhcmd1bWVudCB0aGF0IHRlbGxzIHRoZSBxdWV1ZSBub3QgdG8gc3RhcnQgbG9hZGluZyB5ZXQKCSAqICAgICAgcXVldWUubG9hZCgpOwoJICogQG1ldGhvZCBsb2FkCgkgKi8KCXAubG9hZCA9IGZ1bmN0aW9uKCkge307CgoJLyoqCgkgKiBDbG9zZSB0aGUgYWN0aXZlIHF1ZXVlLiBDbG9zaW5nIGEgcXVldWUgY29tcGxldGVseSBlbXB0aWVzIHRoZSBxdWV1ZSwgYW5kIHByZXZlbnRzIGFueSByZW1haW5pbmcgaXRlbXMgZnJvbQoJICogc3RhcnRpbmcgdG8gZG93bmxvYWQuIE5vdGUgdGhhdCBjdXJyZW50bHkgYW55IGFjdGl2ZSBsb2FkcyB3aWxsIHJlbWFpbiBvcGVuLCBhbmQgZXZlbnRzIG1heSBiZSBwcm9jZXNzZWQuCgkgKgoJICogVG8gc3RvcCBhbmQgcmVzdGFydCBhIHF1ZXVlLCB1c2UgdGhlIHt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlL3NldFBhdXNlZCJ9fXt7L2Nyb3NzTGlua319IG1ldGhvZCBpbnN0ZWFkLgoJICogQG1ldGhvZCBjbG9zZQoJICovCglwLmNsb3NlID0gZnVuY3Rpb24oKSB7fTsKCgovL0NhbGxiYWNrIHByb3hpZXMKCS8qKgoJICogRGlzcGF0Y2ggYSBsb2Fkc3RhcnQgZXZlbnQuIFBsZWFzZSBzZWUgdGhlIHt7I2Nyb3NzTGluayAiQWJzdHJhY3RMb2FkZXIvbG9hZHN0YXJ0OmV2ZW50In19e3svY3Jvc3NMaW5rfX0gZXZlbnQKCSAqIGZvciBkZXRhaWxzIG9uIHRoZSBldmVudCBwYXlsb2FkLgoJICogQG1ldGhvZCBfc2VuZExvYWRTdGFydAoJICogQHByb3RlY3RlZAoJICovCglwLl9zZW5kTG9hZFN0YXJ0ID0gZnVuY3Rpb24oKSB7CgkJaWYgKHRoaXMuX2lzQ2FuY2VsZWQoKSkgeyByZXR1cm47IH0KCQl0aGlzLmRpc3BhdGNoRXZlbnQoImxvYWRzdGFydCIpOwoJfTsKCgkvKioKCSAqIERpc3BhdGNoIGEgcHJvZ3Jlc3MgZXZlbnQuIFBsZWFzZSBzZWUgdGhlIHt7I2Nyb3NzTGluayAiQWJzdHJhY3RMb2FkZXIvcHJvZ3Jlc3M6ZXZlbnQifX17ey9jcm9zc0xpbmt9fSBldmVudCBmb3IKCSAqIGRldGFpbHMgb24gdGhlIGV2ZW50IHBheWxvYWQuCgkgKiBAbWV0aG9kIF9zZW5kUHJvZ3Jlc3MKCSAqIEBwYXJhbSB7TnVtYmVyIHwgT2JqZWN0fSB2YWx1ZSBUaGUgcHJvZ3Jlc3Mgb2YgdGhlIGxvYWRlZCBpdGVtLCBvciBhbiBvYmplY3QgY29udGFpbmluZyA8Y29kZT5sb2FkZWQ8L2NvZGU+CgkgKiBhbmQgPGNvZGU+dG90YWw8L2NvZGU+IHByb3BlcnRpZXMuCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXAuX3NlbmRQcm9ncmVzcyA9IGZ1bmN0aW9uKHZhbHVlKSB7CgkJaWYgKHRoaXMuX2lzQ2FuY2VsZWQoKSkgeyByZXR1cm47IH0KCQl2YXIgZXZlbnQgPSBudWxsOwoJCWlmICh0eXBlb2YodmFsdWUpID09ICJudW1iZXIiKSB7CgkJCXRoaXMucHJvZ3Jlc3MgPSB2YWx1ZTsKCQkJZXZlbnQgPSBuZXcgY3JlYXRlanMuRXZlbnQoInByb2dyZXNzIik7CgkJCWV2ZW50LmxvYWRlZCA9IHRoaXMucHJvZ3Jlc3M7CgkJCWV2ZW50LnRvdGFsID0gMTsKCQl9IGVsc2UgewoJCQlldmVudCA9IHZhbHVlOwoJCQl0aGlzLnByb2dyZXNzID0gdmFsdWUubG9hZGVkIC8gdmFsdWUudG90YWw7CgkJCWlmIChpc05hTih0aGlzLnByb2dyZXNzKSB8fCB0aGlzLnByb2dyZXNzID09IEluZmluaXR5KSB7IHRoaXMucHJvZ3Jlc3MgPSAwOyB9CgkJfQoJCWV2ZW50LnByb2dyZXNzID0gdGhpcy5wcm9ncmVzczsKCQl0aGlzLmhhc0V2ZW50TGlzdGVuZXIoInByb2dyZXNzIikgJiYgdGhpcy5kaXNwYXRjaEV2ZW50KGV2ZW50KTsKCX07CgoJLyoqCgkgKiBEaXNwYXRjaCBhIGNvbXBsZXRlIGV2ZW50LiBQbGVhc2Ugc2VlIHRoZSB7eyNjcm9zc0xpbmsgIkFic3RyYWN0TG9hZGVyL2NvbXBsZXRlOmV2ZW50In19e3svY3Jvc3NMaW5rfX0gZXZlbnQKCSAqIGZvciBkZXRhaWxzIG9uIHRoZSBldmVudCBwYXlsb2FkLgoJICogQG1ldGhvZCBfc2VuZENvbXBsZXRlCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXAuX3NlbmRDb21wbGV0ZSA9IGZ1bmN0aW9uKCkgewoJCWlmICh0aGlzLl9pc0NhbmNlbGVkKCkpIHsgcmV0dXJuOyB9CgkJdGhpcy5kaXNwYXRjaEV2ZW50KCJjb21wbGV0ZSIpOwoJfTsKCgkvKioKCSAqIERpc3BhdGNoIGFuIGVycm9yIGV2ZW50LiBQbGVhc2Ugc2VlIHRoZSB7eyNjcm9zc0xpbmsgIkFic3RyYWN0TG9hZGVyL2Vycm9yOmV2ZW50In19e3svY3Jvc3NMaW5rfX0gZXZlbnQgZm9yCgkgKiBkZXRhaWxzIG9uIHRoZSBldmVudCBwYXlsb2FkLgoJICogQG1ldGhvZCBfc2VuZEVycm9yCgkgKiBAcGFyYW0ge09iamVjdH0gZXZlbnQgVGhlIGV2ZW50IG9iamVjdCBjb250YWluaW5nIHNwZWNpZmljIGVycm9yIHByb3BlcnRpZXMuCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXAuX3NlbmRFcnJvciA9IGZ1bmN0aW9uKGV2ZW50KSB7CgkJaWYgKHRoaXMuX2lzQ2FuY2VsZWQoKSB8fCAhdGhpcy5oYXNFdmVudExpc3RlbmVyKCJlcnJvciIpKSB7IHJldHVybjsgfQoJCWlmIChldmVudCA9PSBudWxsKSB7CgkJCWV2ZW50ID0gbmV3IGNyZWF0ZWpzLkV2ZW50KCJlcnJvciIpOwoJCX0KCQl0aGlzLmRpc3BhdGNoRXZlbnQoZXZlbnQpOwoJfTsKCgkvKioKCSAqIERldGVybWluZSBpZiB0aGUgbG9hZCBoYXMgYmVlbiBjYW5jZWxlZC4gVGhpcyBpcyBpbXBvcnRhbnQgdG8gZW5zdXJlIHRoYXQgbWV0aG9kIGNhbGxzIG9yIGFzeW5jaHJvbm91cyBldmVudHMKCSAqIGRvIG5vdCBjYXVzZSBpc3N1ZXMgYWZ0ZXIgdGhlIHF1ZXVlIGhhcyBiZWVuIGNsZWFuZWQgdXAuCgkgKiBAbWV0aG9kIF9pc0NhbmNlbGVkCgkgKiBAcmV0dXJuIHtCb29sZWFufSBJZiB0aGUgbG9hZGVyIGhhcyBiZWVuIGNhbmNlbGVkLgoJICogQHByb3RlY3RlZAoJICovCglwLl9pc0NhbmNlbGVkID0gZnVuY3Rpb24oKSB7CgkJaWYgKHdpbmRvdy5jcmVhdGVqcyA9PSBudWxsIHx8IHRoaXMuY2FuY2VsZWQpIHsKCQkJcmV0dXJuIHRydWU7CgkJfQoJCXJldHVybiBmYWxzZTsKCX07CgoJLyoqCgkgKiBAbWV0aG9kIF9wYXJzZVVSSQoJICogUGFyc2UgYSBmaWxlIHBhdGggdG8gZGV0ZXJtaW5lIHRoZSBpbmZvcm1hdGlvbiB3ZSBuZWVkIHRvIHdvcmsgd2l0aCBpdC4gQ3VycmVudGx5LCBQcmVsb2FkSlMgbmVlZHMgdG8ga25vdzoKCSAqIDx1bD4KCSAqICAgICA8bGk+SWYgdGhlIHBhdGggaXMgYWJzb2x1dGUuIEFic29sdXRlIHBhdGhzIHN0YXJ0IHdpdGggYSBwcm90b2NvbCAoc3VjaCBhcyBgaHR0cDovL2AsIGBmaWxlOi8vYCwgb3IKCSAqICAgICBgLy9uZXR3b3JrUGF0aGApPC9saT4KCSAqICAgICA8bGk+SWYgdGhlIHBhdGggaXMgcmVsYXRpdmUuIFJlbGF0aXZlIHBhdGhzIHN0YXJ0IHdpdGggYC4uL2Agb3IgYC9wYXRoYCAob3Igc2ltaWxhcik8L2xpPgoJICogICAgIDxsaT5UaGUgZmlsZSBleHRlbnNpb24uIFRoaXMgaXMgZGV0ZXJtaW5lZCBieSB0aGUgZmlsZW5hbWUgd2l0aCBhbiBleHRlbnNpb24uIFF1ZXJ5IHN0cmluZ3MgYXJlIGRyb3BwZWQsIGFuZAoJICogICAgIHRoZSBmaWxlIHBhdGggaXMgZXhwZWN0ZWQgdG8gZm9sbG93IHRoZSBmb3JtYXQgYG5hbWUuZXh0YC48L2xpPgoJICogPC91bD4KCSAqCgkgKiA8c3Ryb25nPk5vdGU6PC9zdHJvbmc+IFRoaXMgaGFzIGNoYW5nZWQgZnJvbSBlYXJsaWVyIHZlcnNpb25zLCB3aGljaCB1c2VkIGEgc2luZ2xlLCBjb21wbGljYXRlZCBSZWd1bGFyIEV4cHJlc3Npb24sIHdoaWNoCgkgKiB3YXMgZGlmZmljdWx0IHRvIG1haW50YWluLCBhbmQgb3Zlci1hZ2dyZXNzaXZlIGluIGRldGVybWluaW5nIGFsbCBmaWxlIHByb3BlcnRpZXMuIEl0IGhhcyBiZWVuIHNpbXBsaWZpZWQgdG8KCSAqIG9ubHkgcHVsbCBvdXQgd2hhdCBpdCBuZWVkcy4KCSAqIEBwYXJhbSBwYXRoCgkgKiBAcmV0dXJucyB7T2JqZWN0fSBBbiBPYmplY3Qgd2l0aCBhbiBgYWJzb2x1dGVgIGFuZCBgcmVsYXRpdmVgIEJvb2xlYW4sIGFzIHdlbGwgYXMgYW4gb3B0aW9uYWwgJ2V4dGVuc2lvbmAgU3RyaW5nCgkgKiBwcm9wZXJ0eSwgd2hpY2ggaXMgdGhlIGxvd2VyY2FzZSBleHRlbnNpb24uCgkgKiBAcHJpdmF0ZQoJICovCglwLl9wYXJzZVVSSSA9IGZ1bmN0aW9uKHBhdGgpIHsKCQl2YXIgaW5mbyA9IHsgYWJzb2x1dGU6IGZhbHNlLCByZWxhdGl2ZTpmYWxzZSB9OwoJCWlmIChwYXRoID09IG51bGwpIHsgcmV0dXJuIGluZm87IH07CgoJCS8vIERyb3AgdGhlIHF1ZXJ5IHN0cmluZwoJCXZhciBxdWVyeUluZGV4ID0gcGF0aC5pbmRleE9mKCI/Iik7CgkJaWYgKHF1ZXJ5SW5kZXggPiAtMSkgewoJCQlwYXRoID0gcGF0aC5zdWJzdHIoMCxxdWVyeUluZGV4KTsKCQl9CgoJCS8vIEFic29sdXRlCgkJdmFyIG1hdGNoOwoJCWlmIChzLkFCU09MVVRFX1BBVFQudGVzdChwYXRoKSkgewoJCQlpbmZvLmFic29sdXRlID0gdHJ1ZTsKCgkJLy8gUmVsYXRpdmUKCQl9IGVsc2UgaWYgKHMuUkVMQVRJVkVfUEFUVC50ZXN0KHBhdGgpKSB7CgkJCWluZm8ucmVsYXRpdmUgPSB0cnVlOwoJCX0KCgkJLy8gRXh0ZW5zaW9uCgkJaWYgKG1hdGNoID0gcGF0aC5tYXRjaChzLkVYVEVOU0lPTl9QQVRUKSkgewoJCQlpbmZvLmV4dGVuc2lvbiA9IG1hdGNoWzFdLnRvTG93ZXJDYXNlKCk7CgkJfQoJCXJldHVybiBpbmZvOwoJfTsKCgkvKioKCSAqIEZvcm1hdHMgYW4gb2JqZWN0IGludG8gYSBxdWVyeSBzdHJpbmcgZm9yIGVpdGhlciBhIFBPU1Qgb3IgR0VUIHJlcXVlc3QuCgkgKiBAbWV0aG9kIF9mb3JtYXRRdWVyeVN0cmluZwoJICogQHBhcmFtIHtPYmplY3R9IGRhdGEgVGhlIGRhdGEgdG8gY29udmVydCB0byBhIHF1ZXJ5IHN0cmluZy4KCSAqIEBwYXJhbSB7QXJyYXl9IFtxdWVyeV0gRXhpc3RpbmcgbmFtZS92YWx1ZSBwYWlycyB0byBhcHBlbmQgb24gdG8gdGhpcyBxdWVyeS4KCSAqIEBwcml2YXRlCgkgKi8KCXAuX2Zvcm1hdFF1ZXJ5U3RyaW5nID0gZnVuY3Rpb24oZGF0YSwgcXVlcnkpIHsKCQlpZiAoZGF0YSA9PSBudWxsKSB7CgkJCXRocm93IG5ldyBFcnJvcignWW91IG11c3Qgc3BlY2lmeSBkYXRhLicpOwoJCX0KCQl2YXIgcGFyYW1zID0gW107CgkJZm9yICh2YXIgbiBpbiBkYXRhKSB7CgkJCXBhcmFtcy5wdXNoKG4rJz0nK2VzY2FwZShkYXRhW25dKSk7CgkJfQoJCWlmIChxdWVyeSkgewoJCQlwYXJhbXMgPSBwYXJhbXMuY29uY2F0KHF1ZXJ5KTsKCQl9CgkJcmV0dXJuIHBhcmFtcy5qb2luKCcmJyk7Cgl9OwoKCS8qKgoJICogQSB1dGlsaXR5IG1ldGhvZCB0aGF0IGJ1aWxkcyBhIGZpbGUgcGF0aCB1c2luZyBhIHNvdXJjZSBhbmQgYSBkYXRhIG9iamVjdCwgYW5kIGZvcm1hdHMgaXQgaW50byBhIG5ldyBwYXRoLiBBbGwKCSAqIG9mIHRoZSBsb2FkZXJzIGluIFByZWxvYWRKUyB1c2UgdGhpcyBtZXRob2QgdG8gY29tcGlsZSBwYXRocyB3aGVuIGxvYWRpbmcuCgkgKiBAbWV0aG9kIGJ1aWxkUGF0aAoJICogQHBhcmFtIHtTdHJpbmd9IHNyYyBUaGUgc291cmNlIHBhdGggdG8gYWRkIHZhbHVlcyB0by4KCSAqIEBwYXJhbSB7T2JqZWN0fSBbZGF0YV0gT2JqZWN0IHVzZWQgdG8gYXBwZW5kIHZhbHVlcyB0byB0aGlzIHJlcXVlc3QgYXMgYSBxdWVyeSBzdHJpbmcuIEV4aXN0aW5nIHBhcmFtZXRlcnMgb24gdGhlCgkgKiBwYXRoIHdpbGwgYmUgcHJlc2VydmVkLgoJICogQHJldHVybnMge3N0cmluZ30gQSBmb3JtYXR0ZWQgc3RyaW5nIHRoYXQgY29udGFpbnMgdGhlIHBhdGggYW5kIHRoZSBzdXBwbGllZCBwYXJhbWV0ZXJzLgoJICogQHNpbmNlIDAuMy4xCgkgKi8KCXAuYnVpbGRQYXRoID0gZnVuY3Rpb24oc3JjLCBkYXRhKSB7CgkJaWYgKGRhdGEgPT0gbnVsbCkgewoJCQlyZXR1cm4gc3JjOwoJCX0KCgkJdmFyIHF1ZXJ5ID0gW107CgkJdmFyIGlkeCA9IHNyYy5pbmRleE9mKCc/Jyk7CgoJCWlmIChpZHggIT0gLTEpIHsKCQkJdmFyIHEgPSBzcmMuc2xpY2UoaWR4KzEpOwoJCQlxdWVyeSA9IHF1ZXJ5LmNvbmNhdChxLnNwbGl0KCcmJykpOwoJCX0KCgkJaWYgKGlkeCAhPSAtMSkgewoJCQlyZXR1cm4gc3JjLnNsaWNlKDAsIGlkeCkgKyAnPycgKyB0aGlzLl9mb3JtYXRRdWVyeVN0cmluZyhkYXRhLCBxdWVyeSk7CgkJfSBlbHNlIHsKCQkJcmV0dXJuIHNyYyArICc/JyArIHRoaXMuX2Zvcm1hdFF1ZXJ5U3RyaW5nKGRhdGEsIHF1ZXJ5KTsKCQl9Cgl9OwoKCS8qKgoJICogQG1ldGhvZCBfaXNDcm9zc0RvbWFpbgoJICogQHBhcmFtIHtPYmplY3R9IGl0ZW0gQSBsb2FkIGl0ZW0gd2l0aCBhIGBzcmNgIHByb3BlcnR5CgkgKiBAcmV0dXJuIHtCb29sZWFufSBJZiB0aGUgbG9hZCBpdGVtIGlzIGxvYWRpbmcgZnJvbSBhIGRpZmZlcmVudCBkb21haW4gdGhhbiB0aGUgY3VycmVudCBsb2NhdGlvbi4KCSAqIEBwcml2YXRlCgkgKi8KCXAuX2lzQ3Jvc3NEb21haW4gPSBmdW5jdGlvbihpdGVtKSB7CgkJdmFyIHRhcmdldCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImEiKTsKCQl0YXJnZXQuaHJlZiA9IGl0ZW0uc3JjOwoKCQl2YXIgaG9zdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImEiKTsKCQlob3N0LmhyZWYgPSBsb2NhdGlvbi5ocmVmOwoKCQl2YXIgY3Jvc3Nkb21haW4gPSAodGFyZ2V0Lmhvc3RuYW1lICE9ICIiKSAmJgoJCQkJKHRhcmdldC5wb3J0ICE9IGhvc3QucG9ydCB8fAoJCQkJCQl0YXJnZXQucHJvdG9jb2wgIT0gaG9zdC5wcm90b2NvbCB8fAoJCQkJCQl0YXJnZXQuaG9zdG5hbWUgIT0gaG9zdC5ob3N0bmFtZSk7CgkJcmV0dXJuIGNyb3NzZG9tYWluOwoJfQoKCS8qKgoJICogQG1ldGhvZCBfaXNMb2NhbAoJICogQHBhcmFtIHtPYmplY3R9IGl0ZW0gQSBsb2FkIGl0ZW0gd2l0aCBhIGBzcmNgIHByb3BlcnR5CgkgKiBAcmV0dXJuIHtCb29sZWFufSBJZiB0aGUgbG9hZCBpdGVtIGlzIGxvYWRpbmcgZnJvbSB0aGUgImZpbGU6IiBwcm90b2NvbC4gQXNzdW1lIHRoYXQgdGhlIGhvc3QgbXVzdCBiZSBsb2NhbCBhcwoJICogd2VsbC4KCSAqIEBwcml2YXRlCgkgKi8KCXAuX2lzTG9jYWwgPSBmdW5jdGlvbihpdGVtKSB7CgkJdmFyIHRhcmdldCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImEiKTsKCQl0YXJnZXQuaHJlZiA9IGl0ZW0uc3JjOwoJCXJldHVybiB0YXJnZXQuaG9zdG5hbWUgPT0gIiIgJiYgdGFyZ2V0LnByb3RvY29sID09ICJmaWxlOiI7Cgl9OwoKCS8qKgoJICogQG1ldGhvZCB0b1N0cmluZwoJICogQHJldHVybiB7U3RyaW5nfSBhIHN0cmluZyByZXByZXNlbnRhdGlvbiBvZiB0aGUgaW5zdGFuY2UuCgkgKi8KCXAudG9TdHJpbmcgPSBmdW5jdGlvbigpIHsKCQlyZXR1cm4gIltQcmVsb2FkSlMgQWJzdHJhY3RMb2FkZXJdIjsKCX07CgoJY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIgPSBBYnN0cmFjdExvYWRlcjsKCn0oKSk7Cg==",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Thu, 06 Nov 2014 19:36:54 GMT",
                    "Content-Length": "14962",
                    "Date": "Thu, 06 Nov 2014 19:36:55 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}