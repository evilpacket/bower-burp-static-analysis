{
    "url": "http://localhost:9999/tscheibl/angular-ie7.js/test/ng/browserSpecs.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Cookie manipulation (DOM-based)",
    "issueType": 5245696,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based cookie manipulation vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the value of a cookie in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will set an arbitrary value in the user's cookie.<br><br>The potential impact of the vulnerability depends on the role that the cookie plays within the application. If the cookie is used to control the behavior that results from certain user actions (for example, a 'production' versus 'demo' mode setting), then the attacker may be able to cause the user to perform unintended actions by manipulating the cookie's value. If the cookie is used to track the user's session, then the attacker may be able to perform a session fixation attack, in which they set the cookie's value to a valid token that they have obtained from the application, and then hijack the session during the victim user's subsequent interaction with the application.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based cookie manipulation vulnerabilities is not to dynamically write to cookies using data that originated from any untrusted source. This behavior should never be implemented for cookies that have any role in controlling privileged actions or user sessions within the application.",
    "issueDetail": "The application may be vulnerable to DOM-based cookie manipulation. Data is read from <b>location.pathname</b> and written to <b>document.cookie</b> via the following statements:<ul><li>var path = location.pathname;</li><li>var parts = path.split('/');</li><li>document.cookie = name + \"=;path=\" + (parts.join('/') || '/') + \";expires=Thu, 01 Jan 1970 00:00:00 GMT\";</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/tscheibl/angular-ie7.js/test/ng/browserSpecs.js",
                "path": "/tscheibl/angular-ie7.js/test/ng/browserSpecs.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC90c2NoZWlibC9hbmd1bGFyLWllNy5qcy90ZXN0L25nL2Jyb3dzZXJTcGVjcy5qcyBIVFRQLzEuMQ0KSG9zdDogbG9jYWxob3N0Ojk5OTkNCg0K",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMTk4MTgNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IFRodSwgMDYgTm92IDIwMTQgMDc6NTM6NDAgR01UDQpMYXN0LU1vZGlmaWVkOiBUaHUsIDA2IE5vdiAyMDE0IDA3OjUzOjM4IEdNVA0KDQondXNlIHN0cmljdCc7CgpmdW5jdGlvbiBNb2NrV2luZG93KCkgewogIHZhciBldmVudHMgPSB7fTsKICB2YXIgdGltZW91dHMgPSB0aGlzLnRpbWVvdXRzID0gW107CgogIHRoaXMuc2V0VGltZW91dCA9IGZ1bmN0aW9uKGZuKSB7CiAgICByZXR1cm4gdGltZW91dHMucHVzaChmbikgLSAxOwogIH07CgogIHRoaXMuY2xlYXJUaW1lb3V0ID0gZnVuY3Rpb24oaWQpIHsKICAgIHRpbWVvdXRzW2lkXSA9IG5vb3A7CiAgfTsKCiAgdGhpcy5zZXRUaW1lb3V0LmZsdXNoID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgbGVuZ3RoID0gdGltZW91dHMubGVuZ3RoOwogICAgd2hpbGUgKGxlbmd0aC0tID4gMCkgdGltZW91dHMuc2hpZnQoKSgpOwogIH07CgogIHRoaXMuYWRkRXZlbnRMaXN0ZW5lciA9IGZ1bmN0aW9uKG5hbWUsIGxpc3RlbmVyKSB7CiAgICBpZiAoaXNVbmRlZmluZWQoZXZlbnRzW25hbWVdKSkgZXZlbnRzW25hbWVdID0gW107CiAgICBldmVudHNbbmFtZV0ucHVzaChsaXN0ZW5lcik7CiAgfTsKCiAgdGhpcy5hdHRhY2hFdmVudCA9IGZ1bmN0aW9uKG5hbWUsIGxpc3RlbmVyKSB7CiAgICB0aGlzLmFkZEV2ZW50TGlzdGVuZXIobmFtZS5zdWJzdHIoMiksIGxpc3RlbmVyKTsKICB9OwoKICB0aGlzLnJlbW92ZUV2ZW50TGlzdGVuZXIgPSBub29wOwogIHRoaXMuZGV0YWNoRXZlbnQgPSBub29wOwoKICB0aGlzLmZpcmUgPSBmdW5jdGlvbihuYW1lKSB7CiAgICBmb3JFYWNoKGV2ZW50c1tuYW1lXSwgZnVuY3Rpb24oZm4pIHsKICAgICAgZm4oe3R5cGU6IG5hbWV9KTsgLy8gdHlwZSB0byBtYWtlIGpRdWVyeSBoYXBweQogICAgfSk7CiAgfTsKCiAgdGhpcy5sb2NhdGlvbiA9IHsKICAgIGhyZWY6ICdodHRwOi8vc2VydmVyJywKICAgIHJlcGxhY2U6IG5vb3AKICB9OwoKICB0aGlzLmhpc3RvcnkgPSB7CiAgICByZXBsYWNlU3RhdGU6IG5vb3AsCiAgICBwdXNoU3RhdGU6IG5vb3AKICB9Owp9CgpmdW5jdGlvbiBNb2NrRG9jdW1lbnQoKSB7CiAgdmFyIHNlbGYgPSB0aGlzOwoKICB0aGlzWzBdID0gd2luZG93LmRvY3VtZW50CiAgdGhpcy5iYXNlUGF0aCA9ICcvJzsKCiAgdGhpcy5maW5kID0gZnVuY3Rpb24obmFtZSkgewogICAgaWYgKG5hbWUgPT0gJ2Jhc2UnKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgYXR0cjogZnVuY3Rpb24obmFtZSl7CiAgICAgICAgICBpZiAobmFtZSA9PSAnaHJlZicpIHsKICAgICAgICAgICAgcmV0dXJuIHNlbGYuYmFzZVBhdGg7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IobmFtZSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9IGVsc2UgewogICAgICB0aHJvdyBuZXcgRXJyb3IobmFtZSk7CiAgICB9CiAgfQp9CgpkZXNjcmliZSgnYnJvd3NlcicsIGZ1bmN0aW9uKCkgewoKICB2YXIgYnJvd3NlciwgZmFrZVdpbmRvdywgZmFrZURvY3VtZW50LCBsb2dzLCBzY3JpcHRzLCByZW1vdmVkU2NyaXB0cywgc25pZmZlcjsKCiAgYmVmb3JlRWFjaChmdW5jdGlvbigpIHsKICAgIHNjcmlwdHMgPSBbXTsKICAgIHJlbW92ZWRTY3JpcHRzID0gW107CiAgICBzbmlmZmVyID0ge2hpc3Rvcnk6IHRydWUsIGhhc2hjaGFuZ2U6IHRydWV9OwogICAgZmFrZVdpbmRvdyA9IG5ldyBNb2NrV2luZG93KCk7CiAgICBmYWtlRG9jdW1lbnQgPSBuZXcgTW9ja0RvY3VtZW50KCk7CgogICAgdmFyIGZha2VCb2R5ID0gW3thcHBlbmRDaGlsZDogZnVuY3Rpb24obm9kZSl7c2NyaXB0cy5wdXNoKG5vZGUpO30sCiAgICAgICAgICAgICAgICAgICAgIHJlbW92ZUNoaWxkOiBmdW5jdGlvbihub2RlKXtyZW1vdmVkU2NyaXB0cy5wdXNoKG5vZGUpO319XTsKCiAgICBsb2dzID0ge2xvZzpbXSwgd2FybjpbXSwgaW5mbzpbXSwgZXJyb3I6W119OwoKICAgIHZhciBmYWtlTG9nID0ge2xvZzogZnVuY3Rpb24oKSB7IGxvZ3MubG9nLnB1c2goc2xpY2UuY2FsbChhcmd1bWVudHMpKTsgfSwKICAgICAgICAgICAgICAgICAgIHdhcm46IGZ1bmN0aW9uKCkgeyBsb2dzLndhcm4ucHVzaChzbGljZS5jYWxsKGFyZ3VtZW50cykpOyB9LAogICAgICAgICAgICAgICAgICAgaW5mbzogZnVuY3Rpb24oKSB7IGxvZ3MuaW5mby5wdXNoKHNsaWNlLmNhbGwoYXJndW1lbnRzKSk7IH0sCiAgICAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24oKSB7IGxvZ3MuZXJyb3IucHVzaChzbGljZS5jYWxsKGFyZ3VtZW50cykpOyB9fTsKCiAgICBicm93c2VyID0gbmV3IEJyb3dzZXIoZmFrZVdpbmRvdywgZmFrZURvY3VtZW50LCBmYWtlTG9nLCBzbmlmZmVyKTsKICB9KTsKCiAgaXQoJ3Nob3VsZCBjb250YWluIGNvb2tpZSBjcnVuY2hlcicsIGZ1bmN0aW9uKCkgewogICAgZXhwZWN0KGJyb3dzZXIuY29va2llcykudG9CZURlZmluZWQoKTsKICB9KTsKCiAgZGVzY3JpYmUoJ291dHN0YWRpbmcgcmVxdWVzdHMnLCBmdW5jdGlvbigpIHsKICAgIGl0KCdzaG91bGQgcHJvY2VzcyBjYWxsYmFja3MgaW1tZWRpZXRseSB3aXRoIG5vIG91dHN0YW5kaW5nIHJlcXVlc3RzJywgZnVuY3Rpb24oKSB7CiAgICAgIHZhciBjYWxsYmFjayA9IGphc21pbmUuY3JlYXRlU3B5KCdjYWxsYmFjaycpOwogICAgICBicm93c2VyLm5vdGlmeVdoZW5Ob091dHN0YW5kaW5nUmVxdWVzdHMoY2FsbGJhY2spOwogICAgICBleHBlY3QoY2FsbGJhY2spLnRvSGF2ZUJlZW5DYWxsZWQoKTsKICAgIH0pOwogIH0pOwoKCiAgZGVzY3JpYmUoJ2RlZmVyJywgZnVuY3Rpb24oKSB7CiAgICBpdCgnc2hvdWxkIGV4ZWN1dGUgZm4gYXN5bmNocm9uaW91c2x5IHZpYSBzZXRUaW1lb3V0JywgZnVuY3Rpb24oKSB7CiAgICAgIHZhciBjYWxsYmFjayA9IGphc21pbmUuY3JlYXRlU3B5KCdkZWZlcnJlZCcpOwoKICAgICAgYnJvd3Nlci5kZWZlcihjYWxsYmFjayk7CiAgICAgIGV4cGVjdChjYWxsYmFjaykubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTsKCiAgICAgIGZha2VXaW5kb3cuc2V0VGltZW91dC5mbHVzaCgpOwogICAgICBleHBlY3QoY2FsbGJhY2spLnRvSGF2ZUJlZW5DYWxsZWRPbmNlKCk7CiAgICB9KTsKCgogICAgaXQoJ3Nob3VsZCB1cGRhdGUgb3V0c3RhbmRpbmdSZXF1ZXN0cyBjb3VudGVyJywgZnVuY3Rpb24oKSB7CiAgICAgIHZhciBjYWxsYmFjayA9IGphc21pbmUuY3JlYXRlU3B5KCdkZWZlcnJlZCcpOwoKICAgICAgYnJvd3Nlci5kZWZlcihjYWxsYmFjayk7CiAgICAgIGV4cGVjdChjYWxsYmFjaykubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTsKCiAgICAgIGZha2VXaW5kb3cuc2V0VGltZW91dC5mbHVzaCgpOwogICAgICBleHBlY3QoY2FsbGJhY2spLnRvSGF2ZUJlZW5DYWxsZWRPbmNlKCk7CiAgICB9KTsKCgogICAgaXQoJ3Nob3VsZCByZXR1cm4gdW5pcXVlIGRlZmVySWQnLCBmdW5jdGlvbigpIHsKICAgICAgdmFyIGRlZmVySWQxID0gYnJvd3Nlci5kZWZlcihub29wKSwKICAgICAgICAgIGRlZmVySWQyID0gYnJvd3Nlci5kZWZlcihub29wKTsKCiAgICAgIGV4cGVjdChkZWZlcklkMSkudG9CZURlZmluZWQoKTsKICAgICAgZXhwZWN0KGRlZmVySWQyKS50b0JlRGVmaW5lZCgpOwogICAgICBleHBlY3QoZGVmZXJJZDEpLm5vdC50b0VxdWFsKGRlZmVySWQyKTsKICAgIH0pOwoKCiAgICBkZXNjcmliZSgnY2FuY2VsJywgZnVuY3Rpb24oKSB7CiAgICAgIGl0KCdzaG91bGQgYWxsb3cgdGFza3MgdG8gYmUgY2FuY2VsZWQgd2l0aCByZXR1cm5lZCBkZWZlcklkJywgZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGxvZyA9IFtdLAogICAgICAgICAgICBkZWZlcklkMSA9IGJyb3dzZXIuZGVmZXIoZnVuY3Rpb24oKSB7IGxvZy5wdXNoKCdjYW5jZWwgbWUnKTsgfSksCiAgICAgICAgICAgIGRlZmVySWQyID0gYnJvd3Nlci5kZWZlcihmdW5jdGlvbigpIHsgbG9nLnB1c2goJ29rJyk7IH0pLAogICAgICAgICAgICBkZWZlcklkMyA9IGJyb3dzZXIuZGVmZXIoZnVuY3Rpb24oKSB7IGxvZy5wdXNoKCdjYW5jZWwgbWUsIG5vdyEnKTsgfSk7CgogICAgICAgIGV4cGVjdChsb2cpLnRvRXF1YWwoW10pOwogICAgICAgIGV4cGVjdChicm93c2VyLmRlZmVyLmNhbmNlbChkZWZlcklkMSkpLnRvQmUodHJ1ZSk7CiAgICAgICAgZXhwZWN0KGJyb3dzZXIuZGVmZXIuY2FuY2VsKGRlZmVySWQzKSkudG9CZSh0cnVlKTsKICAgICAgICBmYWtlV2luZG93LnNldFRpbWVvdXQuZmx1c2goKTsKICAgICAgICBleHBlY3QobG9nKS50b0VxdWFsKFsnb2snXSk7CiAgICAgICAgZXhwZWN0KGJyb3dzZXIuZGVmZXIuY2FuY2VsKGRlZmVySWQyKSkudG9CZShmYWxzZSk7CiAgICAgIH0pOwogICAgfSk7CiAgfSk7CgoKICBkZXNjcmliZSgnY29va2llcycsIGZ1bmN0aW9uKCkgewoKICAgIGZ1bmN0aW9uIGRlbGV0ZUFsbENvb2tpZXMoKSB7CiAgICAgIHZhciBjb29raWVzID0gZG9jdW1lbnQuY29va2llLnNwbGl0KCI7Iik7CiAgICAgIHZhciBwYXRoID0gbG9jYXRpb24ucGF0aG5hbWU7CgogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNvb2tpZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICB2YXIgY29va2llID0gY29va2llc1tpXTsKICAgICAgICB2YXIgZXFQb3MgPSBjb29raWUuaW5kZXhPZigiPSIpOwogICAgICAgIHZhciBuYW1lID0gZXFQb3MgPiAtMSA/IGNvb2tpZS5zdWJzdHIoMCwgZXFQb3MpIDogY29va2llOwogICAgICAgIHZhciBwYXJ0cyA9IHBhdGguc3BsaXQoJy8nKTsKICAgICAgICB3aGlsZSAocGFydHMubGVuZ3RoKSB7CiAgICAgICAgICBkb2N1bWVudC5jb29raWUgPSBuYW1lICsgIj07cGF0aD0iICsgKHBhcnRzLmpvaW4oJy8nKSB8fCAnLycpICsgIjtleHBpcmVzPVRodSwgMDEgSmFuIDE5NzAgMDA6MDA6MDAgR01UIjsKICAgICAgICAgIHBhcnRzLnBvcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIGJlZm9yZUVhY2goZnVuY3Rpb24oKSB7CiAgICAgIGRlbGV0ZUFsbENvb2tpZXMoKTsKICAgICAgZXhwZWN0KGRvY3VtZW50LmNvb2tpZSkudG9FcXVhbCgnJyk7CiAgICB9KTsKCgogICAgYWZ0ZXJFYWNoKGZ1bmN0aW9uKCkgewogICAgICBkZWxldGVBbGxDb29raWVzKCk7CiAgICAgIGV4cGVjdChkb2N1bWVudC5jb29raWUpLnRvRXF1YWwoJycpOwogICAgfSk7CgoKICAgIGRlc2NyaWJlKCdyZW1vdmUgYWxsIHZpYSAobnVsbCknLCBmdW5jdGlvbigpIHsKCiAgICAgIGl0KCdzaG91bGQgZG8gbm90aGluZyB3aGVuIG5vIGNvb2tpZXMgYXJlIHNldCcsIGZ1bmN0aW9uKCkgewogICAgICAgIGJyb3dzZXIuY29va2llcyhudWxsKTsKICAgICAgICBleHBlY3QoZG9jdW1lbnQuY29va2llKS50b0VxdWFsKCcnKTsKICAgICAgICBleHBlY3QoYnJvd3Nlci5jb29raWVzKCkpLnRvRXF1YWwoe30pOwogICAgICB9KTsKCiAgICB9KTsKCiAgICBkZXNjcmliZSgncmVtb3ZlIHZpYSBjb29raWVzKGNvb2tpZU5hbWUsIHVuZGVmaW5lZCknLCBmdW5jdGlvbigpIHsKCiAgICAgIGl0KCdzaG91bGQgcmVtb3ZlIGEgY29va2llIHdoZW4gaXQgaXMgcHJlc2VudCcsIGZ1bmN0aW9uKCkgewogICAgICAgIGRvY3VtZW50LmNvb2tpZSA9ICdmb289YmFyO3BhdGg9Lyc7CgogICAgICAgIGJyb3dzZXIuY29va2llcygnZm9vJywgdW5kZWZpbmVkKTsKCiAgICAgICAgZXhwZWN0KGRvY3VtZW50LmNvb2tpZSkudG9FcXVhbCgnJyk7CiAgICAgICAgZXhwZWN0KGJyb3dzZXIuY29va2llcygpKS50b0VxdWFsKHt9KTsKICAgICAgfSk7CgoKICAgICAgaXQoJ3Nob3VsZCBkbyBub3RoaW5nIHdoZW4gYW4gbm9uZXhpc3RpbmcgY29va2llIGlzIGJlaW5nIHJlbW92ZWQnLCBmdW5jdGlvbigpIHsKICAgICAgICBicm93c2VyLmNvb2tpZXMoJ2RvZXNudGV4aXN0JywgdW5kZWZpbmVkKTsKICAgICAgICBleHBlY3QoZG9jdW1lbnQuY29va2llKS50b0VxdWFsKCcnKTsKICAgICAgICBleHBlY3QoYnJvd3Nlci5jb29raWVzKCkpLnRvRXF1YWwoe30pOwogICAgICB9KTsKICAgIH0pOwoKCiAgICBkZXNjcmliZSgncHV0IHZpYSBjb29raWVzKGNvb2tpZU5hbWUsIHN0cmluZyknLCBmdW5jdGlvbigpIHsKCiAgICAgIGl0KCdzaG91bGQgY3JlYXRlIGFuZCBzdG9yZSBhIGNvb2tpZScsIGZ1bmN0aW9uKCkgewogICAgICAgIGJyb3dzZXIuY29va2llcygnY29va2llTmFtZScsICdjb29raWU9VmFsdWUnKTsKICAgICAgICBleHBlY3QoZG9jdW1lbnQuY29va2llKS50b01hdGNoKC9jb29raWVOYW1lPWNvb2tpZSUzRFZhbHVlOz8gPy8pOwogICAgICAgIGV4cGVjdChicm93c2VyLmNvb2tpZXMoKSkudG9FcXVhbCh7J2Nvb2tpZU5hbWUnOidjb29raWU9VmFsdWUnfSk7CiAgICAgIH0pOwoKCiAgICAgIGl0KCdzaG91bGQgb3ZlcndyaXRlIGFuIGV4aXN0aW5nIHVuc3luY2VkIGNvb2tpZScsIGZ1bmN0aW9uKCkgewogICAgICAgIGRvY3VtZW50LmNvb2tpZSA9ICJjb29raWU9bmV3O3BhdGg9LyI7CgogICAgICAgIHZhciBvbGRWYWwgPSBicm93c2VyLmNvb2tpZXMoJ2Nvb2tpZScsICduZXdlcicpOwoKICAgICAgICBleHBlY3QoZG9jdW1lbnQuY29va2llKS50b0VxdWFsKCdjb29raWU9bmV3ZXInKTsKICAgICAgICBleHBlY3QoYnJvd3Nlci5jb29raWVzKCkpLnRvRXF1YWwoeydjb29raWUnOiduZXdlcid9KTsKICAgICAgICBleHBlY3Qob2xkVmFsKS5ub3QudG9CZURlZmluZWQoKTsKICAgICAgfSk7CgogICAgICBpdCgnc2hvdWxkIGVzY2FwZSBib3RoIG5hbWUgYW5kIHZhbHVlJywgZnVuY3Rpb24oKSB7CiAgICAgICAgYnJvd3Nlci5jb29raWVzKCdjb29raWUxPScsICd2YWw7dWUnKTsKICAgICAgICBicm93c2VyLmNvb2tpZXMoJ2Nvb2tpZTI9YmFyO2JheicsICd2YWw9dWUnKTsKCiAgICAgICAgdmFyIHJhd0Nvb2tpZXMgPSBkb2N1bWVudC5jb29raWUuc3BsaXQoIjsgIik7IC8vb3JkZXIgaXMgbm90IGd1YXJhbnRlZWQsIHNvIHdlIG5lZWQgdG8gcGFyc2UKICAgICAgICBleHBlY3QocmF3Q29va2llcy5sZW5ndGgpLnRvRXF1YWwoMik7CiAgICAgICAgZXhwZWN0KHJhd0Nvb2tpZXMpLnRvQ29udGFpbignY29va2llMSUzRD12YWwlM0J1ZScpOwogICAgICAgIGV4cGVjdChyYXdDb29raWVzKS50b0NvbnRhaW4oJ2Nvb2tpZTIlM0RiYXIlM0JiYXo9dmFsJTNEdWUnKTsKICAgICAgfSk7CgogICAgICBpdCgnc2hvdWxkIGxvZyB3YXJuaW5ncyB3aGVuIDRrYiBwZXIgY29va2llIHN0b3JhZ2UgbGltaXQgaXMgcmVhY2hlZCcsIGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBpLCBsb25nVmFsID0gJycsIGNvb2tpZVN0cjsKCiAgICAgICAgZm9yKGk9MDsgaTw0MDgzOyBpKyspIHsKICAgICAgICAgIGxvbmdWYWwgKz0gJysnOwogICAgICAgIH0KCiAgICAgICAgY29va2llU3RyID0gZG9jdW1lbnQuY29va2llOwogICAgICAgIGJyb3dzZXIuY29va2llcygneCcsIGxvbmdWYWwpOyAvL3RvdGFsIHNpemUgNDA5My00MDk2LCBzbyBpdCBzaG91bGQgZ28gdGhyb3VnaAogICAgICAgIGV4cGVjdChkb2N1bWVudC5jb29raWUpLm5vdC50b0VxdWFsKGNvb2tpZVN0cik7CiAgICAgICAgZXhwZWN0KGJyb3dzZXIuY29va2llcygpWyd4J10pLnRvRXF1YWwobG9uZ1ZhbCk7CiAgICAgICAgZXhwZWN0KGxvZ3Mud2FybikudG9FcXVhbChbXSk7CgogICAgICAgIGJyb3dzZXIuY29va2llcygneCcsIGxvbmdWYWwgKyAneHh4eCcpOyAvL3RvdGFsIHNpemUgNDA5Ny00MDk5LCBhIHdhcm5pbmcgc2hvdWxkIGJlIGxvZ2dlZAogICAgICAgIGV4cGVjdChsb2dzLndhcm4pLnRvRXF1YWwoCiAgICAgICAgICBbWyAiQ29va2llICd4JyBwb3NzaWJseSBub3Qgc2V0IG9yIG92ZXJmbG93ZWQgYmVjYXVzZSBpdCB3YXMgdG9vIGxhcmdlICg0MDk3ID4gNDA5NiAiICsKICAgICAgICAgICAgICJieXRlcykhIiBdXSk7CgogICAgICAgIC8vZm9yY2UgYnJvd3NlciB0byBkcm9wcGVkIGEgY29va2llIGFuZCBtYWtlIHN1cmUgdGhhdCB0aGUgY2FjaGUgaXMgbm90IG91dCBvZiBzeW5jCiAgICAgICAgYnJvd3Nlci5jb29raWVzKCd4JywgJ3Nob3J0VmFsJyk7CiAgICAgICAgZXhwZWN0KGJyb3dzZXIuY29va2llcygpLngpLnRvRXF1YWwoJ3Nob3J0VmFsJyk7IC8vbmVlZGVkIHRvIHByaW1lIHRoZSBjYWNoZQogICAgICAgIGNvb2tpZVN0ciA9IGRvY3VtZW50LmNvb2tpZTsKICAgICAgICBicm93c2VyLmNvb2tpZXMoJ3gnLCBsb25nVmFsICsgbG9uZ1ZhbCArIGxvbmdWYWwpOyAvL3Nob3VsZCBiZSB0b28gbG9uZyBmb3IgYWxsIGJyb3dzZXJzCgogICAgICAgIGlmIChkb2N1bWVudC5jb29raWUgIT09IGNvb2tpZVN0cikgewogICAgICAgICAgdGhpcy5mYWlsKG5ldyBFcnJvcigiYnJvd3NlciBkaWRuJ3QgZHJvcCBsb25nIGNvb2tpZSB3aGVuIGl0IHdhcyBleHBlY3RlZC4gbWFrZSB0aGUgIiArCiAgICAgICAgICAgICAgImNvb2tpZSBpbiB0aGlzIHRlc3QgbG9uZ2VyIikpOwogICAgICAgIH0KCiAgICAgICAgZXhwZWN0KGJyb3dzZXIuY29va2llcygpLngpLnRvRXF1YWwoJ3Nob3J0VmFsJyk7CiAgICAgIH0pOwogICAgfSk7CgogICAgZGVzY3JpYmUoJ3B1dCB2aWEgY29va2llcyhjb29raWVOYW1lLCBzdHJpbmcpLCBpZiBubyA8YmFzZSBocmVmPiAnLCBmdW5jdGlvbiAoKSB7CiAgICAgIGJlZm9yZUVhY2goZnVuY3Rpb24gKCkgewogICAgICAgIGZha2VEb2N1bWVudC5iYXNlUGF0aCA9IHVuZGVmaW5lZDsKICAgICAgfSk7CgogICAgICBpdCgnc2hvdWxkIGRlZmF1bHQgcGF0aCBpbiBjb29raWUgdG8gIiIgKGVtcHR5IHN0cmluZyknLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgYnJvd3Nlci5jb29raWVzKCdjb29raWUnLCAnYmVuZGVyJyk7CiAgICAgICAgLy8gVGhpcyBvbmx5IGZhaWxzIGluIFNhZmFyaSBhbmQgSUUgd2hlbiBjb29raWVQYXRoIHJldHVybnMgdW5kZWZpbmVkCiAgICAgICAgLy8gV2hlcmUgaXQgbm93IHN1Y2NlZWRzIHNpbmNlIGJhc2VIcmVmIHJldHVybiAnJyBpbnN0ZWFkIG9mIHVuZGVmaW5lZAogICAgICAgIGV4cGVjdChkb2N1bWVudC5jb29raWUpLnRvRXF1YWwoJ2Nvb2tpZT1iZW5kZXInKTsKICAgICAgfSk7CiAgICB9KTsKCiAgICBkZXNjcmliZSgnZ2V0IHZpYSBjb29raWVzKClbY29va2llTmFtZV0nLCBmdW5jdGlvbigpIHsKCiAgICAgIGl0KCdzaG91bGQgcmV0dXJuIHVuZGVmaW5lZCBmb3Igbm9uZXhpc3RlbnQgY29va2llJywgZnVuY3Rpb24oKSB7CiAgICAgICAgZXhwZWN0KGJyb3dzZXIuY29va2llcygpLm5vbmV4aXN0ZW50KS5ub3QudG9CZURlZmluZWQoKTsKICAgICAgfSk7CgoKICAgICAgaXQgKCdzaG91bGQgcmV0dXJuIGEgdmFsdWUgZm9yIGFuIGV4aXN0aW5nIGNvb2tpZScsIGZ1bmN0aW9uKCkgewogICAgICAgIGRvY3VtZW50LmNvb2tpZSA9ICJmb289YmFyPWJhejtwYXRoPS8iOwogICAgICAgIGV4cGVjdChicm93c2VyLmNvb2tpZXMoKS5mb28pLnRvRXF1YWwoJ2Jhcj1iYXonKTsKICAgICAgfSk7CgogICAgICBpdCgnc2hvdWxkIHJldHVybiB0aGUgdGhlIGZpcnN0IHZhbHVlIHByb3ZpZGVkIGZvciBhIGNvb2tpZScsIGZ1bmN0aW9uKCkgewogICAgICAgIC8vIEZvciBhIGNvb2tpZSB0aGF0IGhhcyBkaWZmZXJlbnQgdmFsdWVzIHRoYXQgZGlmZmVyIGJ5IHBhdGgsIHRoZQogICAgICAgIC8vIHZhbHVlIGZvciB0aGUgbW9zdCBzcGVjaWZpYyBwYXRoIGFwcGVhcnMgZmlyc3QuICBicm93c2VyLmNvb2tpZXMoKQogICAgICAgIC8vIHNob3VsZCBwcm92aWRlIHRoYXQgdmFsdWUgZm9yIHRoZSBjb29raWUuCiAgICAgICAgZG9jdW1lbnQuY29va2llID0gJ2Zvbz0iZmlyc3QiOyBmb289InNlY29uZCInOwogICAgICAgIGV4cGVjdChicm93c2VyLmNvb2tpZXMoKVsnZm9vJ10pLnRvQmUoJyJmaXJzdCInKTsKICAgICAgfSk7CgogICAgICBpdCAoJ3Nob3VsZCB1bmVzY2FwZSBjb29raWUgdmFsdWVzIHRoYXQgd2VyZSBlc2NhcGVkIGJ5IHB1dHMnLCBmdW5jdGlvbigpIHsKICAgICAgICBkb2N1bWVudC5jb29raWUgPSAiY29va2llMiUzRGJhciUzQmJhej12YWwlM0R1ZTtwYXRoPS8iOwogICAgICAgIGV4cGVjdChicm93c2VyLmNvb2tpZXMoKVsnY29va2llMj1iYXI7YmF6J10pLnRvRXF1YWwoJ3ZhbD11ZScpOwogICAgICB9KTsKCgogICAgICBpdCgnc2hvdWxkIHByZXNlcnZlIGxlYWRpbmcgJiB0cmFpbGluZyBzcGFjZXMgaW4gbmFtZXMgYW5kIHZhbHVlcycsIGZ1bmN0aW9uKCkgewogICAgICAgIGJyb3dzZXIuY29va2llcygnIGNvb2tpZSBuYW1lICcsICcgY29va2llIHZhbHVlICcpOwogICAgICAgIGV4cGVjdChicm93c2VyLmNvb2tpZXMoKVsnIGNvb2tpZSBuYW1lICddKS50b0VxdWFsKCcgY29va2llIHZhbHVlICcpOwogICAgICAgIGV4cGVjdChicm93c2VyLmNvb2tpZXMoKVsnY29va2llIG5hbWUnXSkubm90LnRvQmVEZWZpbmVkKCk7CiAgICAgIH0pOwogICAgfSk7CgoKICAgIGRlc2NyaWJlKCdnZXRBbGwgdmlhIGNvb2tpZXMoKScsIGZ1bmN0aW9uKCkgewoKICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gY29va2llcyBhcyBoYXNoJywgZnVuY3Rpb24oKSB7CiAgICAgICAgZG9jdW1lbnQuY29va2llID0gImZvbzE9YmFyMTtwYXRoPS8iOwogICAgICAgIGRvY3VtZW50LmNvb2tpZSA9ICJmb28yPWJhcjI7cGF0aD0vIjsKICAgICAgICBleHBlY3QoYnJvd3Nlci5jb29raWVzKCkpLnRvRXF1YWwoeydmb28xJzonYmFyMScsICdmb28yJzonYmFyMid9KTsKICAgICAgfSk7CgoKICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gZW1wdHkgaGFzaCBpZiBubyBjb29raWVzIGV4aXN0JywgZnVuY3Rpb24oKSB7CiAgICAgICAgZXhwZWN0KGJyb3dzZXIuY29va2llcygpKS50b0VxdWFsKHt9KTsKICAgICAgfSk7CiAgICB9KTsKCgogICAgaXQoJ3Nob3VsZCBwaWNrIHVwIGV4dGVybmFsIGNoYW5nZXMgbWFkZSB0byBicm93c2VyIGNvb2tpZXMnLCBmdW5jdGlvbigpIHsKICAgICAgYnJvd3Nlci5jb29raWVzKCdvYXRtZWFsQ29va2llJywgJ2Ryb29sJyk7CiAgICAgIGV4cGVjdChicm93c2VyLmNvb2tpZXMoKSkudG9FcXVhbCh7J29hdG1lYWxDb29raWUnOidkcm9vbCd9KTsKCiAgICAgIGRvY3VtZW50LmNvb2tpZSA9ICdvYXRtZWFsQ29va2llPWNoYW5nZWQ7cGF0aD0vJzsKICAgICAgZXhwZWN0KGJyb3dzZXIuY29va2llcygpLm9hdG1lYWxDb29raWUpLnRvRXF1YWwoJ2NoYW5nZWQnKTsKICAgIH0pOwoKCiAgICBpdCgnc2hvdWxkIGluaXRpYWxpemUgY29va2llIGNhY2hlIHdpdGggZXhpc3RpbmcgY29va2llcycsIGZ1bmN0aW9uKCkgewogICAgICBkb2N1bWVudC5jb29raWUgPSAiZXhpc3RpbmdDb29raWU9ZXhpc3RpbmdWYWx1ZTtwYXRoPS8iOwogICAgICBleHBlY3QoYnJvd3Nlci5jb29raWVzKCkpLnRvRXF1YWwoeydleGlzdGluZ0Nvb2tpZSc6J2V4aXN0aW5nVmFsdWUnfSk7CiAgICB9KTsKCiAgfSk7CgogIGRlc2NyaWJlKCdwb2xsZXInLCBmdW5jdGlvbigpIHsKCiAgICBpdCgnc2hvdWxkIGNhbGwgZnVuY3Rpb25zIGluIHBvbGxGbnMgaW4gcmVndWxhciBpbnRlcnZhbHMnLCBmdW5jdGlvbigpIHsKICAgICAgdmFyIGxvZyA9ICcnOwogICAgICBicm93c2VyLmFkZFBvbGxGbihmdW5jdGlvbigpIHtsb2crPSdhJzt9KTsKICAgICAgYnJvd3Nlci5hZGRQb2xsRm4oZnVuY3Rpb24oKSB7bG9nKz0nYic7fSk7CiAgICAgIGV4cGVjdChsb2cpLnRvRXF1YWwoJycpOwogICAgICBmYWtlV2luZG93LnNldFRpbWVvdXQuZmx1c2goKTsKICAgICAgZXhwZWN0KGxvZykudG9FcXVhbCgnYWInKTsKICAgICAgZmFrZVdpbmRvdy5zZXRUaW1lb3V0LmZsdXNoKCk7CiAgICAgIGV4cGVjdChsb2cpLnRvRXF1YWwoJ2FiYWInKTsKICAgIH0pOwoKICAgIGl0KCdzaG91bGQgc3RhcnRQb2xsZXInLCBmdW5jdGlvbigpIHsKICAgICAgZXhwZWN0KGZha2VXaW5kb3cudGltZW91dHMubGVuZ3RoKS50b0VxdWFsKDApOwoKICAgICAgYnJvd3Nlci5hZGRQb2xsRm4oZnVuY3Rpb24oKSB7fSk7CiAgICAgIGV4cGVjdChmYWtlV2luZG93LnRpbWVvdXRzLmxlbmd0aCkudG9FcXVhbCgxKTsKCiAgICAgIC8vc2hvdWxkIHJlbWFpbiAxIGFzIGl0IGlzIHRoZSBjaGVjayBmbgogICAgICBicm93c2VyLmFkZFBvbGxGbihmdW5jdGlvbigpIHt9KTsKICAgICAgZXhwZWN0KGZha2VXaW5kb3cudGltZW91dHMubGVuZ3RoKS50b0VxdWFsKDEpOwogICAgfSk7CgogICAgaXQoJ3Nob3VsZCByZXR1cm4gZm4gdGhhdCB3YXMgcGFzc2VkIGludG8gYWRkUG9sbEZuJywgZnVuY3Rpb24oKSB7CiAgICAgIHZhciBmbiA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gMTsgfTsKICAgICAgdmFyIHJldHVybmVkRm4gPSBicm93c2VyLmFkZFBvbGxGbihmbik7CiAgICAgIGV4cGVjdChyZXR1cm5lZEZuKS50b0JlKGZuKTsKICAgIH0pOwogIH0pOwoKICBkZXNjcmliZSgndXJsJywgZnVuY3Rpb24oKSB7CiAgICB2YXIgcHVzaFN0YXRlLCByZXBsYWNlU3RhdGUsIGxvY2F0aW9uUmVwbGFjZTsKCiAgICBiZWZvcmVFYWNoKGZ1bmN0aW9uKCkgewogICAgICBwdXNoU3RhdGUgPSBzcHlPbihmYWtlV2luZG93Lmhpc3RvcnksICdwdXNoU3RhdGUnKTsKICAgICAgcmVwbGFjZVN0YXRlID0gc3B5T24oZmFrZVdpbmRvdy5oaXN0b3J5LCAncmVwbGFjZVN0YXRlJyk7CiAgICAgIGxvY2F0aW9uUmVwbGFjZSA9IHNweU9uKGZha2VXaW5kb3cubG9jYXRpb24sICdyZXBsYWNlJyk7CiAgICB9KTsKCiAgICBpdCgnc2hvdWxkIHJldHVybiBjdXJyZW50IGxvY2F0aW9uLmhyZWYnLCBmdW5jdGlvbigpIHsKICAgICAgZmFrZVdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJ2h0dHA6Ly90ZXN0LmNvbSc7CiAgICAgIGV4cGVjdChicm93c2VyLnVybCgpKS50b0VxdWFsKCdodHRwOi8vdGVzdC5jb20nKTsKCiAgICAgIGZha2VXaW5kb3cubG9jYXRpb24uaHJlZiA9ICdodHRwczovL2Fub3RoZXIuY29tJzsKICAgICAgZXhwZWN0KGJyb3dzZXIudXJsKCkpLnRvRXF1YWwoJ2h0dHBzOi8vYW5vdGhlci5jb20nKTsKICAgIH0pOwoKICAgIGl0KCdzaG91bGQgdXNlIGhpc3RvcnkucHVzaFN0YXRlIHdoZW4gYXZhaWxhYmxlJywgZnVuY3Rpb24oKSB7CiAgICAgIHNuaWZmZXIuaGlzdG9yeSA9IHRydWU7CiAgICAgIGJyb3dzZXIudXJsKCdodHRwOi8vbmV3Lm9yZycpOwoKICAgICAgZXhwZWN0KHB1c2hTdGF0ZSkudG9IYXZlQmVlbkNhbGxlZE9uY2UoKTsKICAgICAgZXhwZWN0KHB1c2hTdGF0ZS5hcmdzRm9yQ2FsbFswXVsyXSkudG9FcXVhbCgnaHR0cDovL25ldy5vcmcnKTsKCiAgICAgIGV4cGVjdChyZXBsYWNlU3RhdGUpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7CiAgICAgIGV4cGVjdChsb2NhdGlvblJlcGxhY2UpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7CiAgICAgIGV4cGVjdChmYWtlV2luZG93LmxvY2F0aW9uLmhyZWYpLnRvRXF1YWwoJ2h0dHA6Ly9zZXJ2ZXInKTsKICAgIH0pOwoKICAgIGl0KCdzaG91bGQgdXNlIGhpc3RvcnkucmVwbGFjZVN0YXRlIHdoZW4gYXZhaWxhYmxlJywgZnVuY3Rpb24oKSB7CiAgICAgIHNuaWZmZXIuaGlzdG9yeSA9IHRydWU7CiAgICAgIGJyb3dzZXIudXJsKCdodHRwOi8vbmV3Lm9yZycsIHRydWUpOwoKICAgICAgZXhwZWN0KHJlcGxhY2VTdGF0ZSkudG9IYXZlQmVlbkNhbGxlZE9uY2UoKTsKICAgICAgZXhwZWN0KHJlcGxhY2VTdGF0ZS5hcmdzRm9yQ2FsbFswXVsyXSkudG9FcXVhbCgnaHR0cDovL25ldy5vcmcnKTsKCiAgICAgIGV4cGVjdChwdXNoU3RhdGUpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7CiAgICAgIGV4cGVjdChsb2NhdGlvblJlcGxhY2UpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7CiAgICAgIGV4cGVjdChmYWtlV2luZG93LmxvY2F0aW9uLmhyZWYpLnRvRXF1YWwoJ2h0dHA6Ly9zZXJ2ZXInKTsKICAgIH0pOwoKICAgIGl0KCdzaG91bGQgc2V0IGxvY2F0aW9uLmhyZWYgd2hlbiBwdXNoU3RhdGUgbm90IGF2YWlsYWJsZScsIGZ1bmN0aW9uKCkgewogICAgICBzbmlmZmVyLmhpc3RvcnkgPSBmYWxzZTsKICAgICAgYnJvd3Nlci51cmwoJ2h0dHA6Ly9uZXcub3JnJyk7CgogICAgICBleHBlY3QoZmFrZVdpbmRvdy5sb2NhdGlvbi5ocmVmKS50b0VxdWFsKCdodHRwOi8vbmV3Lm9yZycpOwoKICAgICAgZXhwZWN0KHB1c2hTdGF0ZSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTsKICAgICAgZXhwZWN0KHJlcGxhY2VTdGF0ZSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTsKICAgICAgZXhwZWN0KGxvY2F0aW9uUmVwbGFjZSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTsKICAgIH0pOwoKICAgIGl0KCdzaG91bGQgdXNlIGxvY2F0aW9uLnJlcGxhY2Ugd2hlbiBoaXN0b3J5LnJlcGxhY2VTdGF0ZSBub3QgYXZhaWxhYmxlJywgZnVuY3Rpb24oKSB7CiAgICAgIHNuaWZmZXIuaGlzdG9yeSA9IGZhbHNlOwogICAgICBicm93c2VyLnVybCgnaHR0cDovL25ldy5vcmcnLCB0cnVlKTsKCiAgICAgIGV4cGVjdChsb2NhdGlvblJlcGxhY2UpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdodHRwOi8vbmV3Lm9yZycpOwoKICAgICAgZXhwZWN0KHB1c2hTdGF0ZSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTsKICAgICAgZXhwZWN0KHJlcGxhY2VTdGF0ZSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTsKICAgICAgZXhwZWN0KGZha2VXaW5kb3cubG9jYXRpb24uaHJlZikudG9FcXVhbCgnaHR0cDovL3NlcnZlcicpOwogICAgfSk7CgogICAgaXQoJ3Nob3VsZCByZXR1cm4gJGJyb3dzZXIgdG8gYWxsb3cgY2hhaW5pbmcnLCBmdW5jdGlvbigpIHsKICAgICAgZXhwZWN0KGJyb3dzZXIudXJsKCdodHRwOi8vYW55LmNvbScpKS50b0JlKGJyb3dzZXIpOwogICAgfSk7CgoKICAgIGl0KCdzaG91bGQgZGVjb2RlIHNpbmdsZSBxdW90ZXMgdG8gd29yayBhcm91bmQgRkYgYnVnIDQwNzI3MycsIGZ1bmN0aW9uKCkgewogICAgICBmYWtlV2luZG93LmxvY2F0aW9uLmhyZWYgPSAiaHR0cDovL2ZmLWJ1Zy8/c2luZ2xlJTI3cXVvdGUiOwogICAgICBleHBlY3QoYnJvd3Nlci51cmwoKSkudG9CZSgiaHR0cDovL2ZmLWJ1Zy8/c2luZ2xlJ3F1b3RlIik7CiAgICB9KTsKCiAgICBpdCgnc2hvdWxkIG5vdCBzZXQgVVJMIHdoZW4gdGhlIFVSTCBpcyBhbHJlYWR5IHNldCcsIGZ1bmN0aW9uKCkgewogICAgICB2YXIgY3VycmVudCA9IGZha2VXaW5kb3cubG9jYXRpb24uaHJlZjsKICAgICAgc25pZmZlci5oaXN0b3J5ID0gZmFsc2U7CiAgICAgIGZha2VXaW5kb3cubG9jYXRpb24uaHJlZiA9ICdkb250Y2hhbmdlJzsKICAgICAgYnJvd3Nlci51cmwoY3VycmVudCk7CiAgICAgIGV4cGVjdChmYWtlV2luZG93LmxvY2F0aW9uLmhyZWYpLnRvQmUoJ2RvbnRjaGFuZ2UnKTsKICAgIH0pOwogIH0pOwoKICBkZXNjcmliZSgndXJsQ2hhbmdlJywgZnVuY3Rpb24oKSB7CiAgICB2YXIgY2FsbGJhY2s7CgogICAgYmVmb3JlRWFjaChmdW5jdGlvbigpIHsKICAgICAgY2FsbGJhY2sgPSBqYXNtaW5lLmNyZWF0ZVNweSgnb25VcmxDaGFuZ2UnKTsKICAgIH0pOwoKICAgIGFmdGVyRWFjaChmdW5jdGlvbigpIHsKICAgICAgaWYgKCFqUXVlcnkpIGpxTGl0ZShmYWtlV2luZG93KS5kZWFsb2MoKTsKICAgIH0pOwoKICAgIGl0KCdzaG91bGQgcmV0dXJuIHJlZ2lzdGVyZWQgY2FsbGJhY2snLCBmdW5jdGlvbigpIHsKICAgICAgZXhwZWN0KGJyb3dzZXIub25VcmxDaGFuZ2UoY2FsbGJhY2spKS50b0JlKGNhbGxiYWNrKTsKICAgIH0pOwoKICAgIGl0KCdzaG91bGQgZm9yd2FyZCBwb3BzdGF0ZSBldmVudCB3aXRoIG5ldyB1cmwgd2hlbiBoaXN0b3J5IHN1cHBvcnRlZCcsIGZ1bmN0aW9uKCkgewogICAgICBzbmlmZmVyLmhpc3RvcnkgPSB0cnVlOwogICAgICBicm93c2VyLm9uVXJsQ2hhbmdlKGNhbGxiYWNrKTsKICAgICAgZmFrZVdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJ2h0dHA6Ly9zZXJ2ZXIvbmV3JzsKCiAgICAgIGZha2VXaW5kb3cuZmlyZSgncG9wc3RhdGUnKTsKICAgICAgZXhwZWN0KGNhbGxiYWNrKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnaHR0cDovL3NlcnZlci9uZXcnKTsKCiAgICAgIGZha2VXaW5kb3cuZmlyZSgnaGFzaGNoYW5nZScpOwogICAgICBmYWtlV2luZG93LnNldFRpbWVvdXQuZmx1c2goKTsKICAgICAgZXhwZWN0KGNhbGxiYWNrKS50b0hhdmVCZWVuQ2FsbGVkT25jZSgpOwogICAgfSk7CgogICAgaXQoJ3Nob3VsZCBmb3J3YXJkIG9ubHkgcG9wc3RhdGUgZXZlbnQgd2hlbiBib3RoIGhpc3RvcnkgYW5kIGhhc2hjaGFuZ2Ugc3VwcG9ydGVkJywgZnVuY3Rpb24oKSB7CiAgICAgIHNuaWZmZXIuaGlzdG9yeSA9IHRydWU7CiAgICAgIHNuaWZmZXIuaGFzaGNoYW5nZSA9IHRydWU7CiAgICAgIGJyb3dzZXIub25VcmxDaGFuZ2UoY2FsbGJhY2spOwogICAgICBmYWtlV2luZG93LmxvY2F0aW9uLmhyZWYgPSAnaHR0cDovL3NlcnZlci9uZXcnOwoKICAgICAgZmFrZVdpbmRvdy5maXJlKCdwb3BzdGF0ZScpOwogICAgICBleHBlY3QoY2FsbGJhY2spLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdodHRwOi8vc2VydmVyL25ldycpOwoKICAgICAgZmFrZVdpbmRvdy5maXJlKCdoYXNoY2hhbmdlJyk7CiAgICAgIGZha2VXaW5kb3cuc2V0VGltZW91dC5mbHVzaCgpOwogICAgICBleHBlY3QoY2FsbGJhY2spLnRvSGF2ZUJlZW5DYWxsZWRPbmNlKCk7CiAgICB9KTsKCiAgICBpdCgnc2hvdWxkIGZvcndhcmQgaGFzaGNoYW5nZSBldmVudCB3aXRoIG5ldyB1cmwgd2hlbiBvbmx5IGhhc2hjaGFuZ2Ugc3VwcG9ydGVkJywgZnVuY3Rpb24oKSB7CiAgICAgIHNuaWZmZXIuaGlzdG9yeSA9IGZhbHNlOwogICAgICBzbmlmZmVyLmhhc2hjaGFuZ2UgPSB0cnVlOwogICAgICBicm93c2VyLm9uVXJsQ2hhbmdlKGNhbGxiYWNrKTsKICAgICAgZmFrZVdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJ2h0dHA6Ly9zZXJ2ZXIvbmV3JzsKCiAgICAgIGZha2VXaW5kb3cuZmlyZSgnaGFzaGNoYW5nZScpOwogICAgICBleHBlY3QoY2FsbGJhY2spLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdodHRwOi8vc2VydmVyL25ldycpOwoKICAgICAgZmFrZVdpbmRvdy5maXJlKCdwb3BzdGF0ZScpOwogICAgICBmYWtlV2luZG93LnNldFRpbWVvdXQuZmx1c2goKTsKICAgICAgZXhwZWN0KGNhbGxiYWNrKS50b0hhdmVCZWVuQ2FsbGVkT25jZSgpOwogICAgfSk7CgogICAgaXQoJ3Nob3VsZCB1c2UgcG9sbGluZyB3aGVuIG5laXRoZXIgaGlzdG9yeSBub3IgaGFzaGNoYW5nZSBzdXBwb3J0ZWQnLCBmdW5jdGlvbigpIHsKICAgICAgc25pZmZlci5oaXN0b3J5ID0gZmFsc2U7CiAgICAgIHNuaWZmZXIuaGFzaGNoYW5nZSA9IGZhbHNlOwogICAgICBicm93c2VyLm9uVXJsQ2hhbmdlKGNhbGxiYWNrKTsKCiAgICAgIGZha2VXaW5kb3cubG9jYXRpb24uaHJlZiA9ICdodHRwOi8vc2VydmVyLm5ldyc7CiAgICAgIGZha2VXaW5kb3cuc2V0VGltZW91dC5mbHVzaCgpOwogICAgICBleHBlY3QoY2FsbGJhY2spLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdodHRwOi8vc2VydmVyLm5ldycpOwoKICAgICAgY2FsbGJhY2sucmVzZXQoKTsKCiAgICAgIGZha2VXaW5kb3cuZmlyZSgncG9wc3RhdGUnKTsKICAgICAgZmFrZVdpbmRvdy5maXJlKCdoYXNoY2hhbmdlJyk7CiAgICAgIGV4cGVjdChjYWxsYmFjaykubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTsKICAgIH0pOwoKICAgIGRlc2NyaWJlKCdhZnRlciBhbiBpbml0aWFsIGxvY2F0aW9uIGNoYW5nZSBieSBicm93c2VyLnVybCBtZXRob2Qgd2hlbiBuZWl0aGVyIGhpc3Rvcnkgbm9yIGhhc2hjaGFuZ2Ugc3VwcG9ydGVkJywgZnVuY3Rpb24oKSB7CiAgICAgIGJlZm9yZUVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgc25pZmZlci5oaXN0b3J5ID0gZmFsc2U7CiAgICAgICAgc25pZmZlci5oYXNoY2hhbmdlID0gZmFsc2U7CiAgICAgICAgYnJvd3Nlci51cmwoImh0dHA6Ly9zZXJ2ZXIuY3VycmVudCIpOwogICAgICB9KTsKCiAgICAgIGl0KCdzaG91bGQgZmlyZSBjYWxsYmFjayB3aXRoIHRoZSBjb3JyZWN0IFVSTCBvbiBsb2NhdGlvbiBjaGFuZ2Ugb3V0c2lkZSBvZiBhbmd1bGFyJywgZnVuY3Rpb24oKSB7CiAgICAgICAgYnJvd3Nlci5vblVybENoYW5nZShjYWxsYmFjayk7CgogICAgICAgIGZha2VXaW5kb3cubG9jYXRpb24uaHJlZiA9ICdodHRwOi8vc2VydmVyLm5ldyc7CiAgICAgICAgZmFrZVdpbmRvdy5zZXRUaW1lb3V0LmZsdXNoKCk7CiAgICAgICAgZXhwZWN0KGNhbGxiYWNrKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnaHR0cDovL3NlcnZlci5uZXcnKTsKCiAgICAgICAgZmFrZVdpbmRvdy5maXJlKCdwb3BzdGF0ZScpOwogICAgICAgIGZha2VXaW5kb3cuZmlyZSgnaGFzaGNoYW5nZScpOwogICAgICAgIGV4cGVjdChjYWxsYmFjaykudG9IYXZlQmVlbkNhbGxlZE9uY2UoKTsKICAgICAgfSk7CgogICAgfSk7CgogICAgaXQoJ3Nob3VsZCBub3QgZmlyZSB1cmxDaGFuZ2UgaWYgY2hhbmdlZCBieSBicm93c2VyLnVybCBtZXRob2QgKHBvbGxpbmcpJywgZnVuY3Rpb24oKSB7CiAgICAgIHNuaWZmZXIuaGlzdG9yeSA9IGZhbHNlOwogICAgICBzbmlmZmVyLmhhc2hjaGFuZ2UgPSBmYWxzZTsKICAgICAgYnJvd3Nlci5vblVybENoYW5nZShjYWxsYmFjayk7CiAgICAgIGJyb3dzZXIudXJsKCdodHRwOi8vbmV3LmNvbScpOwoKICAgICAgZmFrZVdpbmRvdy5zZXRUaW1lb3V0LmZsdXNoKCk7CiAgICAgIGV4cGVjdChjYWxsYmFjaykubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTsKICAgIH0pOwoKICAgIGl0KCdzaG91bGQgbm90IGZpcmUgdXJsQ2hhbmdlIGlmIGNoYW5nZWQgYnkgYnJvd3Nlci51cmwgbWV0aG9kIChoYXNoY2hhbmdlKScsIGZ1bmN0aW9uKCkgewogICAgICBzbmlmZmVyLmhpc3RvcnkgPSBmYWxzZTsKICAgICAgc25pZmZlci5oYXNoY2hhbmdlID0gdHJ1ZTsKICAgICAgYnJvd3Nlci5vblVybENoYW5nZShjYWxsYmFjayk7CiAgICAgIGJyb3dzZXIudXJsKCdodHRwOi8vbmV3LmNvbScpOwoKICAgICAgZmFrZVdpbmRvdy5maXJlKCdoYXNoY2hhbmdlJyk7CiAgICAgIGV4cGVjdChjYWxsYmFjaykubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTsKICAgIH0pOwogIH0pOwoKCiAgZGVzY3JpYmUoJ2Jhc2VIcmVmJywgZnVuY3Rpb24oKSB7CiAgICB2YXIganFEb2NIZWFkOwoKICAgIGJlZm9yZUVhY2goZnVuY3Rpb24oKSB7CiAgICAgIGpxRG9jSGVhZCA9IGpxTGl0ZShkb2N1bWVudCkuZmluZCgnaGVhZCcpOwogICAgfSk7CgogICAgaXQoJ3Nob3VsZCByZXR1cm4gdmFsdWUgZnJvbSA8YmFzZSBocmVmPicsIGZ1bmN0aW9uKCkgewogICAgICBmYWtlRG9jdW1lbnQuYmFzZVBhdGggPSAnL2Jhc2UvcGF0aC8nOwogICAgICBleHBlY3QoYnJvd3Nlci5iYXNlSHJlZigpKS50b0VxdWFsKCcvYmFzZS9wYXRoLycpOwogICAgfSk7CgogICAgaXQoJ3Nob3VsZCByZXR1cm4gXCdcJyAoZW1wdHkgc3RyaW5nKSBpZiBubyA8YmFzZSBocmVmPicsIGZ1bmN0aW9uKCkgewogICAgICBmYWtlRG9jdW1lbnQuYmFzZVBhdGggPSB1bmRlZmluZWQ7CiAgICAgIGV4cGVjdChicm93c2VyLmJhc2VIcmVmKCkpLnRvRXF1YWwoJycpOwogICAgfSk7CgogICAgaXQoJ3Nob3VsZCByZW1vdmUgZG9tYWluIGZyb20gPGJhc2UgaHJlZj4nLCBmdW5jdGlvbigpIHsKICAgICAgZmFrZURvY3VtZW50LmJhc2VQYXRoID0gJ2h0dHA6Ly9ob3N0LmNvbS9iYXNlL3BhdGgvJzsKICAgICAgZXhwZWN0KGJyb3dzZXIuYmFzZUhyZWYoKSkudG9FcXVhbCgnL2Jhc2UvcGF0aC8nKTsKCiAgICAgIGZha2VEb2N1bWVudC5iYXNlUGF0aCA9ICdodHRwOi8vaG9zdC5jb20vYmFzZS9wYXRoL2luZGV4Lmh0bWwnOwogICAgICBleHBlY3QoYnJvd3Nlci5iYXNlSHJlZigpKS50b0VxdWFsKCcvYmFzZS9wYXRoL2luZGV4Lmh0bWwnKTsKICAgIH0pOwoKICAgIGl0KCdzaG91bGQgcmVtb3ZlIGRvbWFpbiBmcm9tIDxiYXNlIGhyZWY+IGJlZ2lubmluZyB3aXRoIFwnLy9cJycsIGZ1bmN0aW9uKCkgewogICAgICBmYWtlRG9jdW1lbnQuYmFzZVBhdGggPSAnLy9nb29nbGUuY29tL2Jhc2UvcGF0aC8nOwogICAgICBleHBlY3QoYnJvd3Nlci5iYXNlSHJlZigpKS50b0VxdWFsKCcvYmFzZS9wYXRoLycpOwogICAgfSk7CiAgfSk7Cn0pOwo=",
                "body": "J3VzZSBzdHJpY3QnOwoKZnVuY3Rpb24gTW9ja1dpbmRvdygpIHsKICB2YXIgZXZlbnRzID0ge307CiAgdmFyIHRpbWVvdXRzID0gdGhpcy50aW1lb3V0cyA9IFtdOwoKICB0aGlzLnNldFRpbWVvdXQgPSBmdW5jdGlvbihmbikgewogICAgcmV0dXJuIHRpbWVvdXRzLnB1c2goZm4pIC0gMTsKICB9OwoKICB0aGlzLmNsZWFyVGltZW91dCA9IGZ1bmN0aW9uKGlkKSB7CiAgICB0aW1lb3V0c1tpZF0gPSBub29wOwogIH07CgogIHRoaXMuc2V0VGltZW91dC5mbHVzaCA9IGZ1bmN0aW9uKCkgewogICAgdmFyIGxlbmd0aCA9IHRpbWVvdXRzLmxlbmd0aDsKICAgIHdoaWxlIChsZW5ndGgtLSA+IDApIHRpbWVvdXRzLnNoaWZ0KCkoKTsKICB9OwoKICB0aGlzLmFkZEV2ZW50TGlzdGVuZXIgPSBmdW5jdGlvbihuYW1lLCBsaXN0ZW5lcikgewogICAgaWYgKGlzVW5kZWZpbmVkKGV2ZW50c1tuYW1lXSkpIGV2ZW50c1tuYW1lXSA9IFtdOwogICAgZXZlbnRzW25hbWVdLnB1c2gobGlzdGVuZXIpOwogIH07CgogIHRoaXMuYXR0YWNoRXZlbnQgPSBmdW5jdGlvbihuYW1lLCBsaXN0ZW5lcikgewogICAgdGhpcy5hZGRFdmVudExpc3RlbmVyKG5hbWUuc3Vic3RyKDIpLCBsaXN0ZW5lcik7CiAgfTsKCiAgdGhpcy5yZW1vdmVFdmVudExpc3RlbmVyID0gbm9vcDsKICB0aGlzLmRldGFjaEV2ZW50ID0gbm9vcDsKCiAgdGhpcy5maXJlID0gZnVuY3Rpb24obmFtZSkgewogICAgZm9yRWFjaChldmVudHNbbmFtZV0sIGZ1bmN0aW9uKGZuKSB7CiAgICAgIGZuKHt0eXBlOiBuYW1lfSk7IC8vIHR5cGUgdG8gbWFrZSBqUXVlcnkgaGFwcHkKICAgIH0pOwogIH07CgogIHRoaXMubG9jYXRpb24gPSB7CiAgICBocmVmOiAnaHR0cDovL3NlcnZlcicsCiAgICByZXBsYWNlOiBub29wCiAgfTsKCiAgdGhpcy5oaXN0b3J5ID0gewogICAgcmVwbGFjZVN0YXRlOiBub29wLAogICAgcHVzaFN0YXRlOiBub29wCiAgfTsKfQoKZnVuY3Rpb24gTW9ja0RvY3VtZW50KCkgewogIHZhciBzZWxmID0gdGhpczsKCiAgdGhpc1swXSA9IHdpbmRvdy5kb2N1bWVudAogIHRoaXMuYmFzZVBhdGggPSAnLyc7CgogIHRoaXMuZmluZCA9IGZ1bmN0aW9uKG5hbWUpIHsKICAgIGlmIChuYW1lID09ICdiYXNlJykgewogICAgICByZXR1cm4gewogICAgICAgIGF0dHI6IGZ1bmN0aW9uKG5hbWUpewogICAgICAgICAgaWYgKG5hbWUgPT0gJ2hyZWYnKSB7CiAgICAgICAgICAgIHJldHVybiBzZWxmLmJhc2VQYXRoOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKG5hbWUpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKG5hbWUpOwogICAgfQogIH0KfQoKZGVzY3JpYmUoJ2Jyb3dzZXInLCBmdW5jdGlvbigpIHsKCiAgdmFyIGJyb3dzZXIsIGZha2VXaW5kb3csIGZha2VEb2N1bWVudCwgbG9ncywgc2NyaXB0cywgcmVtb3ZlZFNjcmlwdHMsIHNuaWZmZXI7CgogIGJlZm9yZUVhY2goZnVuY3Rpb24oKSB7CiAgICBzY3JpcHRzID0gW107CiAgICByZW1vdmVkU2NyaXB0cyA9IFtdOwogICAgc25pZmZlciA9IHtoaXN0b3J5OiB0cnVlLCBoYXNoY2hhbmdlOiB0cnVlfTsKICAgIGZha2VXaW5kb3cgPSBuZXcgTW9ja1dpbmRvdygpOwogICAgZmFrZURvY3VtZW50ID0gbmV3IE1vY2tEb2N1bWVudCgpOwoKICAgIHZhciBmYWtlQm9keSA9IFt7YXBwZW5kQ2hpbGQ6IGZ1bmN0aW9uKG5vZGUpe3NjcmlwdHMucHVzaChub2RlKTt9LAogICAgICAgICAgICAgICAgICAgICByZW1vdmVDaGlsZDogZnVuY3Rpb24obm9kZSl7cmVtb3ZlZFNjcmlwdHMucHVzaChub2RlKTt9fV07CgogICAgbG9ncyA9IHtsb2c6W10sIHdhcm46W10sIGluZm86W10sIGVycm9yOltdfTsKCiAgICB2YXIgZmFrZUxvZyA9IHtsb2c6IGZ1bmN0aW9uKCkgeyBsb2dzLmxvZy5wdXNoKHNsaWNlLmNhbGwoYXJndW1lbnRzKSk7IH0sCiAgICAgICAgICAgICAgICAgICB3YXJuOiBmdW5jdGlvbigpIHsgbG9ncy53YXJuLnB1c2goc2xpY2UuY2FsbChhcmd1bWVudHMpKTsgfSwKICAgICAgICAgICAgICAgICAgIGluZm86IGZ1bmN0aW9uKCkgeyBsb2dzLmluZm8ucHVzaChzbGljZS5jYWxsKGFyZ3VtZW50cykpOyB9LAogICAgICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKCkgeyBsb2dzLmVycm9yLnB1c2goc2xpY2UuY2FsbChhcmd1bWVudHMpKTsgfX07CgogICAgYnJvd3NlciA9IG5ldyBCcm93c2VyKGZha2VXaW5kb3csIGZha2VEb2N1bWVudCwgZmFrZUxvZywgc25pZmZlcik7CiAgfSk7CgogIGl0KCdzaG91bGQgY29udGFpbiBjb29raWUgY3J1bmNoZXInLCBmdW5jdGlvbigpIHsKICAgIGV4cGVjdChicm93c2VyLmNvb2tpZXMpLnRvQmVEZWZpbmVkKCk7CiAgfSk7CgogIGRlc2NyaWJlKCdvdXRzdGFkaW5nIHJlcXVlc3RzJywgZnVuY3Rpb24oKSB7CiAgICBpdCgnc2hvdWxkIHByb2Nlc3MgY2FsbGJhY2tzIGltbWVkaWV0bHkgd2l0aCBubyBvdXRzdGFuZGluZyByZXF1ZXN0cycsIGZ1bmN0aW9uKCkgewogICAgICB2YXIgY2FsbGJhY2sgPSBqYXNtaW5lLmNyZWF0ZVNweSgnY2FsbGJhY2snKTsKICAgICAgYnJvd3Nlci5ub3RpZnlXaGVuTm9PdXRzdGFuZGluZ1JlcXVlc3RzKGNhbGxiYWNrKTsKICAgICAgZXhwZWN0KGNhbGxiYWNrKS50b0hhdmVCZWVuQ2FsbGVkKCk7CiAgICB9KTsKICB9KTsKCgogIGRlc2NyaWJlKCdkZWZlcicsIGZ1bmN0aW9uKCkgewogICAgaXQoJ3Nob3VsZCBleGVjdXRlIGZuIGFzeW5jaHJvbmlvdXNseSB2aWEgc2V0VGltZW91dCcsIGZ1bmN0aW9uKCkgewogICAgICB2YXIgY2FsbGJhY2sgPSBqYXNtaW5lLmNyZWF0ZVNweSgnZGVmZXJyZWQnKTsKCiAgICAgIGJyb3dzZXIuZGVmZXIoY2FsbGJhY2spOwogICAgICBleHBlY3QoY2FsbGJhY2spLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7CgogICAgICBmYWtlV2luZG93LnNldFRpbWVvdXQuZmx1c2goKTsKICAgICAgZXhwZWN0KGNhbGxiYWNrKS50b0hhdmVCZWVuQ2FsbGVkT25jZSgpOwogICAgfSk7CgoKICAgIGl0KCdzaG91bGQgdXBkYXRlIG91dHN0YW5kaW5nUmVxdWVzdHMgY291bnRlcicsIGZ1bmN0aW9uKCkgewogICAgICB2YXIgY2FsbGJhY2sgPSBqYXNtaW5lLmNyZWF0ZVNweSgnZGVmZXJyZWQnKTsKCiAgICAgIGJyb3dzZXIuZGVmZXIoY2FsbGJhY2spOwogICAgICBleHBlY3QoY2FsbGJhY2spLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7CgogICAgICBmYWtlV2luZG93LnNldFRpbWVvdXQuZmx1c2goKTsKICAgICAgZXhwZWN0KGNhbGxiYWNrKS50b0hhdmVCZWVuQ2FsbGVkT25jZSgpOwogICAgfSk7CgoKICAgIGl0KCdzaG91bGQgcmV0dXJuIHVuaXF1ZSBkZWZlcklkJywgZnVuY3Rpb24oKSB7CiAgICAgIHZhciBkZWZlcklkMSA9IGJyb3dzZXIuZGVmZXIobm9vcCksCiAgICAgICAgICBkZWZlcklkMiA9IGJyb3dzZXIuZGVmZXIobm9vcCk7CgogICAgICBleHBlY3QoZGVmZXJJZDEpLnRvQmVEZWZpbmVkKCk7CiAgICAgIGV4cGVjdChkZWZlcklkMikudG9CZURlZmluZWQoKTsKICAgICAgZXhwZWN0KGRlZmVySWQxKS5ub3QudG9FcXVhbChkZWZlcklkMik7CiAgICB9KTsKCgogICAgZGVzY3JpYmUoJ2NhbmNlbCcsIGZ1bmN0aW9uKCkgewogICAgICBpdCgnc2hvdWxkIGFsbG93IHRhc2tzIHRvIGJlIGNhbmNlbGVkIHdpdGggcmV0dXJuZWQgZGVmZXJJZCcsIGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBsb2cgPSBbXSwKICAgICAgICAgICAgZGVmZXJJZDEgPSBicm93c2VyLmRlZmVyKGZ1bmN0aW9uKCkgeyBsb2cucHVzaCgnY2FuY2VsIG1lJyk7IH0pLAogICAgICAgICAgICBkZWZlcklkMiA9IGJyb3dzZXIuZGVmZXIoZnVuY3Rpb24oKSB7IGxvZy5wdXNoKCdvaycpOyB9KSwKICAgICAgICAgICAgZGVmZXJJZDMgPSBicm93c2VyLmRlZmVyKGZ1bmN0aW9uKCkgeyBsb2cucHVzaCgnY2FuY2VsIG1lLCBub3chJyk7IH0pOwoKICAgICAgICBleHBlY3QobG9nKS50b0VxdWFsKFtdKTsKICAgICAgICBleHBlY3QoYnJvd3Nlci5kZWZlci5jYW5jZWwoZGVmZXJJZDEpKS50b0JlKHRydWUpOwogICAgICAgIGV4cGVjdChicm93c2VyLmRlZmVyLmNhbmNlbChkZWZlcklkMykpLnRvQmUodHJ1ZSk7CiAgICAgICAgZmFrZVdpbmRvdy5zZXRUaW1lb3V0LmZsdXNoKCk7CiAgICAgICAgZXhwZWN0KGxvZykudG9FcXVhbChbJ29rJ10pOwogICAgICAgIGV4cGVjdChicm93c2VyLmRlZmVyLmNhbmNlbChkZWZlcklkMikpLnRvQmUoZmFsc2UpOwogICAgICB9KTsKICAgIH0pOwogIH0pOwoKCiAgZGVzY3JpYmUoJ2Nvb2tpZXMnLCBmdW5jdGlvbigpIHsKCiAgICBmdW5jdGlvbiBkZWxldGVBbGxDb29raWVzKCkgewogICAgICB2YXIgY29va2llcyA9IGRvY3VtZW50LmNvb2tpZS5zcGxpdCgiOyIpOwogICAgICB2YXIgcGF0aCA9IGxvY2F0aW9uLnBhdGhuYW1lOwoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjb29raWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFyIGNvb2tpZSA9IGNvb2tpZXNbaV07CiAgICAgICAgdmFyIGVxUG9zID0gY29va2llLmluZGV4T2YoIj0iKTsKICAgICAgICB2YXIgbmFtZSA9IGVxUG9zID4gLTEgPyBjb29raWUuc3Vic3RyKDAsIGVxUG9zKSA6IGNvb2tpZTsKICAgICAgICB2YXIgcGFydHMgPSBwYXRoLnNwbGl0KCcvJyk7CiAgICAgICAgd2hpbGUgKHBhcnRzLmxlbmd0aCkgewogICAgICAgICAgZG9jdW1lbnQuY29va2llID0gbmFtZSArICI9O3BhdGg9IiArIChwYXJ0cy5qb2luKCcvJykgfHwgJy8nKSArICI7ZXhwaXJlcz1UaHUsIDAxIEphbiAxOTcwIDAwOjAwOjAwIEdNVCI7CiAgICAgICAgICBwYXJ0cy5wb3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBiZWZvcmVFYWNoKGZ1bmN0aW9uKCkgewogICAgICBkZWxldGVBbGxDb29raWVzKCk7CiAgICAgIGV4cGVjdChkb2N1bWVudC5jb29raWUpLnRvRXF1YWwoJycpOwogICAgfSk7CgoKICAgIGFmdGVyRWFjaChmdW5jdGlvbigpIHsKICAgICAgZGVsZXRlQWxsQ29va2llcygpOwogICAgICBleHBlY3QoZG9jdW1lbnQuY29va2llKS50b0VxdWFsKCcnKTsKICAgIH0pOwoKCiAgICBkZXNjcmliZSgncmVtb3ZlIGFsbCB2aWEgKG51bGwpJywgZnVuY3Rpb24oKSB7CgogICAgICBpdCgnc2hvdWxkIGRvIG5vdGhpbmcgd2hlbiBubyBjb29raWVzIGFyZSBzZXQnLCBmdW5jdGlvbigpIHsKICAgICAgICBicm93c2VyLmNvb2tpZXMobnVsbCk7CiAgICAgICAgZXhwZWN0KGRvY3VtZW50LmNvb2tpZSkudG9FcXVhbCgnJyk7CiAgICAgICAgZXhwZWN0KGJyb3dzZXIuY29va2llcygpKS50b0VxdWFsKHt9KTsKICAgICAgfSk7CgogICAgfSk7CgogICAgZGVzY3JpYmUoJ3JlbW92ZSB2aWEgY29va2llcyhjb29raWVOYW1lLCB1bmRlZmluZWQpJywgZnVuY3Rpb24oKSB7CgogICAgICBpdCgnc2hvdWxkIHJlbW92ZSBhIGNvb2tpZSB3aGVuIGl0IGlzIHByZXNlbnQnLCBmdW5jdGlvbigpIHsKICAgICAgICBkb2N1bWVudC5jb29raWUgPSAnZm9vPWJhcjtwYXRoPS8nOwoKICAgICAgICBicm93c2VyLmNvb2tpZXMoJ2ZvbycsIHVuZGVmaW5lZCk7CgogICAgICAgIGV4cGVjdChkb2N1bWVudC5jb29raWUpLnRvRXF1YWwoJycpOwogICAgICAgIGV4cGVjdChicm93c2VyLmNvb2tpZXMoKSkudG9FcXVhbCh7fSk7CiAgICAgIH0pOwoKCiAgICAgIGl0KCdzaG91bGQgZG8gbm90aGluZyB3aGVuIGFuIG5vbmV4aXN0aW5nIGNvb2tpZSBpcyBiZWluZyByZW1vdmVkJywgZnVuY3Rpb24oKSB7CiAgICAgICAgYnJvd3Nlci5jb29raWVzKCdkb2VzbnRleGlzdCcsIHVuZGVmaW5lZCk7CiAgICAgICAgZXhwZWN0KGRvY3VtZW50LmNvb2tpZSkudG9FcXVhbCgnJyk7CiAgICAgICAgZXhwZWN0KGJyb3dzZXIuY29va2llcygpKS50b0VxdWFsKHt9KTsKICAgICAgfSk7CiAgICB9KTsKCgogICAgZGVzY3JpYmUoJ3B1dCB2aWEgY29va2llcyhjb29raWVOYW1lLCBzdHJpbmcpJywgZnVuY3Rpb24oKSB7CgogICAgICBpdCgnc2hvdWxkIGNyZWF0ZSBhbmQgc3RvcmUgYSBjb29raWUnLCBmdW5jdGlvbigpIHsKICAgICAgICBicm93c2VyLmNvb2tpZXMoJ2Nvb2tpZU5hbWUnLCAnY29va2llPVZhbHVlJyk7CiAgICAgICAgZXhwZWN0KGRvY3VtZW50LmNvb2tpZSkudG9NYXRjaCgvY29va2llTmFtZT1jb29raWUlM0RWYWx1ZTs/ID8vKTsKICAgICAgICBleHBlY3QoYnJvd3Nlci5jb29raWVzKCkpLnRvRXF1YWwoeydjb29raWVOYW1lJzonY29va2llPVZhbHVlJ30pOwogICAgICB9KTsKCgogICAgICBpdCgnc2hvdWxkIG92ZXJ3cml0ZSBhbiBleGlzdGluZyB1bnN5bmNlZCBjb29raWUnLCBmdW5jdGlvbigpIHsKICAgICAgICBkb2N1bWVudC5jb29raWUgPSAiY29va2llPW5ldztwYXRoPS8iOwoKICAgICAgICB2YXIgb2xkVmFsID0gYnJvd3Nlci5jb29raWVzKCdjb29raWUnLCAnbmV3ZXInKTsKCiAgICAgICAgZXhwZWN0KGRvY3VtZW50LmNvb2tpZSkudG9FcXVhbCgnY29va2llPW5ld2VyJyk7CiAgICAgICAgZXhwZWN0KGJyb3dzZXIuY29va2llcygpKS50b0VxdWFsKHsnY29va2llJzonbmV3ZXInfSk7CiAgICAgICAgZXhwZWN0KG9sZFZhbCkubm90LnRvQmVEZWZpbmVkKCk7CiAgICAgIH0pOwoKICAgICAgaXQoJ3Nob3VsZCBlc2NhcGUgYm90aCBuYW1lIGFuZCB2YWx1ZScsIGZ1bmN0aW9uKCkgewogICAgICAgIGJyb3dzZXIuY29va2llcygnY29va2llMT0nLCAndmFsO3VlJyk7CiAgICAgICAgYnJvd3Nlci5jb29raWVzKCdjb29raWUyPWJhcjtiYXonLCAndmFsPXVlJyk7CgogICAgICAgIHZhciByYXdDb29raWVzID0gZG9jdW1lbnQuY29va2llLnNwbGl0KCI7ICIpOyAvL29yZGVyIGlzIG5vdCBndWFyYW50ZWVkLCBzbyB3ZSBuZWVkIHRvIHBhcnNlCiAgICAgICAgZXhwZWN0KHJhd0Nvb2tpZXMubGVuZ3RoKS50b0VxdWFsKDIpOwogICAgICAgIGV4cGVjdChyYXdDb29raWVzKS50b0NvbnRhaW4oJ2Nvb2tpZTElM0Q9dmFsJTNCdWUnKTsKICAgICAgICBleHBlY3QocmF3Q29va2llcykudG9Db250YWluKCdjb29raWUyJTNEYmFyJTNCYmF6PXZhbCUzRHVlJyk7CiAgICAgIH0pOwoKICAgICAgaXQoJ3Nob3VsZCBsb2cgd2FybmluZ3Mgd2hlbiA0a2IgcGVyIGNvb2tpZSBzdG9yYWdlIGxpbWl0IGlzIHJlYWNoZWQnLCBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgaSwgbG9uZ1ZhbCA9ICcnLCBjb29raWVTdHI7CgogICAgICAgIGZvcihpPTA7IGk8NDA4MzsgaSsrKSB7CiAgICAgICAgICBsb25nVmFsICs9ICcrJzsKICAgICAgICB9CgogICAgICAgIGNvb2tpZVN0ciA9IGRvY3VtZW50LmNvb2tpZTsKICAgICAgICBicm93c2VyLmNvb2tpZXMoJ3gnLCBsb25nVmFsKTsgLy90b3RhbCBzaXplIDQwOTMtNDA5Niwgc28gaXQgc2hvdWxkIGdvIHRocm91Z2gKICAgICAgICBleHBlY3QoZG9jdW1lbnQuY29va2llKS5ub3QudG9FcXVhbChjb29raWVTdHIpOwogICAgICAgIGV4cGVjdChicm93c2VyLmNvb2tpZXMoKVsneCddKS50b0VxdWFsKGxvbmdWYWwpOwogICAgICAgIGV4cGVjdChsb2dzLndhcm4pLnRvRXF1YWwoW10pOwoKICAgICAgICBicm93c2VyLmNvb2tpZXMoJ3gnLCBsb25nVmFsICsgJ3h4eHgnKTsgLy90b3RhbCBzaXplIDQwOTctNDA5OSwgYSB3YXJuaW5nIHNob3VsZCBiZSBsb2dnZWQKICAgICAgICBleHBlY3QobG9ncy53YXJuKS50b0VxdWFsKAogICAgICAgICAgW1sgIkNvb2tpZSAneCcgcG9zc2libHkgbm90IHNldCBvciBvdmVyZmxvd2VkIGJlY2F1c2UgaXQgd2FzIHRvbyBsYXJnZSAoNDA5NyA+IDQwOTYgIiArCiAgICAgICAgICAgICAiYnl0ZXMpISIgXV0pOwoKICAgICAgICAvL2ZvcmNlIGJyb3dzZXIgdG8gZHJvcHBlZCBhIGNvb2tpZSBhbmQgbWFrZSBzdXJlIHRoYXQgdGhlIGNhY2hlIGlzIG5vdCBvdXQgb2Ygc3luYwogICAgICAgIGJyb3dzZXIuY29va2llcygneCcsICdzaG9ydFZhbCcpOwogICAgICAgIGV4cGVjdChicm93c2VyLmNvb2tpZXMoKS54KS50b0VxdWFsKCdzaG9ydFZhbCcpOyAvL25lZWRlZCB0byBwcmltZSB0aGUgY2FjaGUKICAgICAgICBjb29raWVTdHIgPSBkb2N1bWVudC5jb29raWU7CiAgICAgICAgYnJvd3Nlci5jb29raWVzKCd4JywgbG9uZ1ZhbCArIGxvbmdWYWwgKyBsb25nVmFsKTsgLy9zaG91bGQgYmUgdG9vIGxvbmcgZm9yIGFsbCBicm93c2VycwoKICAgICAgICBpZiAoZG9jdW1lbnQuY29va2llICE9PSBjb29raWVTdHIpIHsKICAgICAgICAgIHRoaXMuZmFpbChuZXcgRXJyb3IoImJyb3dzZXIgZGlkbid0IGRyb3AgbG9uZyBjb29raWUgd2hlbiBpdCB3YXMgZXhwZWN0ZWQuIG1ha2UgdGhlICIgKwogICAgICAgICAgICAgICJjb29raWUgaW4gdGhpcyB0ZXN0IGxvbmdlciIpKTsKICAgICAgICB9CgogICAgICAgIGV4cGVjdChicm93c2VyLmNvb2tpZXMoKS54KS50b0VxdWFsKCdzaG9ydFZhbCcpOwogICAgICB9KTsKICAgIH0pOwoKICAgIGRlc2NyaWJlKCdwdXQgdmlhIGNvb2tpZXMoY29va2llTmFtZSwgc3RyaW5nKSwgaWYgbm8gPGJhc2UgaHJlZj4gJywgZnVuY3Rpb24gKCkgewogICAgICBiZWZvcmVFYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgICBmYWtlRG9jdW1lbnQuYmFzZVBhdGggPSB1bmRlZmluZWQ7CiAgICAgIH0pOwoKICAgICAgaXQoJ3Nob3VsZCBkZWZhdWx0IHBhdGggaW4gY29va2llIHRvICIiIChlbXB0eSBzdHJpbmcpJywgZnVuY3Rpb24gKCkgewogICAgICAgIGJyb3dzZXIuY29va2llcygnY29va2llJywgJ2JlbmRlcicpOwogICAgICAgIC8vIFRoaXMgb25seSBmYWlscyBpbiBTYWZhcmkgYW5kIElFIHdoZW4gY29va2llUGF0aCByZXR1cm5zIHVuZGVmaW5lZAogICAgICAgIC8vIFdoZXJlIGl0IG5vdyBzdWNjZWVkcyBzaW5jZSBiYXNlSHJlZiByZXR1cm4gJycgaW5zdGVhZCBvZiB1bmRlZmluZWQKICAgICAgICBleHBlY3QoZG9jdW1lbnQuY29va2llKS50b0VxdWFsKCdjb29raWU9YmVuZGVyJyk7CiAgICAgIH0pOwogICAgfSk7CgogICAgZGVzY3JpYmUoJ2dldCB2aWEgY29va2llcygpW2Nvb2tpZU5hbWVdJywgZnVuY3Rpb24oKSB7CgogICAgICBpdCgnc2hvdWxkIHJldHVybiB1bmRlZmluZWQgZm9yIG5vbmV4aXN0ZW50IGNvb2tpZScsIGZ1bmN0aW9uKCkgewogICAgICAgIGV4cGVjdChicm93c2VyLmNvb2tpZXMoKS5ub25leGlzdGVudCkubm90LnRvQmVEZWZpbmVkKCk7CiAgICAgIH0pOwoKCiAgICAgIGl0ICgnc2hvdWxkIHJldHVybiBhIHZhbHVlIGZvciBhbiBleGlzdGluZyBjb29raWUnLCBmdW5jdGlvbigpIHsKICAgICAgICBkb2N1bWVudC5jb29raWUgPSAiZm9vPWJhcj1iYXo7cGF0aD0vIjsKICAgICAgICBleHBlY3QoYnJvd3Nlci5jb29raWVzKCkuZm9vKS50b0VxdWFsKCdiYXI9YmF6Jyk7CiAgICAgIH0pOwoKICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gdGhlIHRoZSBmaXJzdCB2YWx1ZSBwcm92aWRlZCBmb3IgYSBjb29raWUnLCBmdW5jdGlvbigpIHsKICAgICAgICAvLyBGb3IgYSBjb29raWUgdGhhdCBoYXMgZGlmZmVyZW50IHZhbHVlcyB0aGF0IGRpZmZlciBieSBwYXRoLCB0aGUKICAgICAgICAvLyB2YWx1ZSBmb3IgdGhlIG1vc3Qgc3BlY2lmaWMgcGF0aCBhcHBlYXJzIGZpcnN0LiAgYnJvd3Nlci5jb29raWVzKCkKICAgICAgICAvLyBzaG91bGQgcHJvdmlkZSB0aGF0IHZhbHVlIGZvciB0aGUgY29va2llLgogICAgICAgIGRvY3VtZW50LmNvb2tpZSA9ICdmb289ImZpcnN0IjsgZm9vPSJzZWNvbmQiJzsKICAgICAgICBleHBlY3QoYnJvd3Nlci5jb29raWVzKClbJ2ZvbyddKS50b0JlKCciZmlyc3QiJyk7CiAgICAgIH0pOwoKICAgICAgaXQgKCdzaG91bGQgdW5lc2NhcGUgY29va2llIHZhbHVlcyB0aGF0IHdlcmUgZXNjYXBlZCBieSBwdXRzJywgZnVuY3Rpb24oKSB7CiAgICAgICAgZG9jdW1lbnQuY29va2llID0gImNvb2tpZTIlM0RiYXIlM0JiYXo9dmFsJTNEdWU7cGF0aD0vIjsKICAgICAgICBleHBlY3QoYnJvd3Nlci5jb29raWVzKClbJ2Nvb2tpZTI9YmFyO2JheiddKS50b0VxdWFsKCd2YWw9dWUnKTsKICAgICAgfSk7CgoKICAgICAgaXQoJ3Nob3VsZCBwcmVzZXJ2ZSBsZWFkaW5nICYgdHJhaWxpbmcgc3BhY2VzIGluIG5hbWVzIGFuZCB2YWx1ZXMnLCBmdW5jdGlvbigpIHsKICAgICAgICBicm93c2VyLmNvb2tpZXMoJyBjb29raWUgbmFtZSAnLCAnIGNvb2tpZSB2YWx1ZSAnKTsKICAgICAgICBleHBlY3QoYnJvd3Nlci5jb29raWVzKClbJyBjb29raWUgbmFtZSAnXSkudG9FcXVhbCgnIGNvb2tpZSB2YWx1ZSAnKTsKICAgICAgICBleHBlY3QoYnJvd3Nlci5jb29raWVzKClbJ2Nvb2tpZSBuYW1lJ10pLm5vdC50b0JlRGVmaW5lZCgpOwogICAgICB9KTsKICAgIH0pOwoKCiAgICBkZXNjcmliZSgnZ2V0QWxsIHZpYSBjb29raWVzKCknLCBmdW5jdGlvbigpIHsKCiAgICAgIGl0KCdzaG91bGQgcmV0dXJuIGNvb2tpZXMgYXMgaGFzaCcsIGZ1bmN0aW9uKCkgewogICAgICAgIGRvY3VtZW50LmNvb2tpZSA9ICJmb28xPWJhcjE7cGF0aD0vIjsKICAgICAgICBkb2N1bWVudC5jb29raWUgPSAiZm9vMj1iYXIyO3BhdGg9LyI7CiAgICAgICAgZXhwZWN0KGJyb3dzZXIuY29va2llcygpKS50b0VxdWFsKHsnZm9vMSc6J2JhcjEnLCAnZm9vMic6J2JhcjInfSk7CiAgICAgIH0pOwoKCiAgICAgIGl0KCdzaG91bGQgcmV0dXJuIGVtcHR5IGhhc2ggaWYgbm8gY29va2llcyBleGlzdCcsIGZ1bmN0aW9uKCkgewogICAgICAgIGV4cGVjdChicm93c2VyLmNvb2tpZXMoKSkudG9FcXVhbCh7fSk7CiAgICAgIH0pOwogICAgfSk7CgoKICAgIGl0KCdzaG91bGQgcGljayB1cCBleHRlcm5hbCBjaGFuZ2VzIG1hZGUgdG8gYnJvd3NlciBjb29raWVzJywgZnVuY3Rpb24oKSB7CiAgICAgIGJyb3dzZXIuY29va2llcygnb2F0bWVhbENvb2tpZScsICdkcm9vbCcpOwogICAgICBleHBlY3QoYnJvd3Nlci5jb29raWVzKCkpLnRvRXF1YWwoeydvYXRtZWFsQ29va2llJzonZHJvb2wnfSk7CgogICAgICBkb2N1bWVudC5jb29raWUgPSAnb2F0bWVhbENvb2tpZT1jaGFuZ2VkO3BhdGg9Lyc7CiAgICAgIGV4cGVjdChicm93c2VyLmNvb2tpZXMoKS5vYXRtZWFsQ29va2llKS50b0VxdWFsKCdjaGFuZ2VkJyk7CiAgICB9KTsKCgogICAgaXQoJ3Nob3VsZCBpbml0aWFsaXplIGNvb2tpZSBjYWNoZSB3aXRoIGV4aXN0aW5nIGNvb2tpZXMnLCBmdW5jdGlvbigpIHsKICAgICAgZG9jdW1lbnQuY29va2llID0gImV4aXN0aW5nQ29va2llPWV4aXN0aW5nVmFsdWU7cGF0aD0vIjsKICAgICAgZXhwZWN0KGJyb3dzZXIuY29va2llcygpKS50b0VxdWFsKHsnZXhpc3RpbmdDb29raWUnOidleGlzdGluZ1ZhbHVlJ30pOwogICAgfSk7CgogIH0pOwoKICBkZXNjcmliZSgncG9sbGVyJywgZnVuY3Rpb24oKSB7CgogICAgaXQoJ3Nob3VsZCBjYWxsIGZ1bmN0aW9ucyBpbiBwb2xsRm5zIGluIHJlZ3VsYXIgaW50ZXJ2YWxzJywgZnVuY3Rpb24oKSB7CiAgICAgIHZhciBsb2cgPSAnJzsKICAgICAgYnJvd3Nlci5hZGRQb2xsRm4oZnVuY3Rpb24oKSB7bG9nKz0nYSc7fSk7CiAgICAgIGJyb3dzZXIuYWRkUG9sbEZuKGZ1bmN0aW9uKCkge2xvZys9J2InO30pOwogICAgICBleHBlY3QobG9nKS50b0VxdWFsKCcnKTsKICAgICAgZmFrZVdpbmRvdy5zZXRUaW1lb3V0LmZsdXNoKCk7CiAgICAgIGV4cGVjdChsb2cpLnRvRXF1YWwoJ2FiJyk7CiAgICAgIGZha2VXaW5kb3cuc2V0VGltZW91dC5mbHVzaCgpOwogICAgICBleHBlY3QobG9nKS50b0VxdWFsKCdhYmFiJyk7CiAgICB9KTsKCiAgICBpdCgnc2hvdWxkIHN0YXJ0UG9sbGVyJywgZnVuY3Rpb24oKSB7CiAgICAgIGV4cGVjdChmYWtlV2luZG93LnRpbWVvdXRzLmxlbmd0aCkudG9FcXVhbCgwKTsKCiAgICAgIGJyb3dzZXIuYWRkUG9sbEZuKGZ1bmN0aW9uKCkge30pOwogICAgICBleHBlY3QoZmFrZVdpbmRvdy50aW1lb3V0cy5sZW5ndGgpLnRvRXF1YWwoMSk7CgogICAgICAvL3Nob3VsZCByZW1haW4gMSBhcyBpdCBpcyB0aGUgY2hlY2sgZm4KICAgICAgYnJvd3Nlci5hZGRQb2xsRm4oZnVuY3Rpb24oKSB7fSk7CiAgICAgIGV4cGVjdChmYWtlV2luZG93LnRpbWVvdXRzLmxlbmd0aCkudG9FcXVhbCgxKTsKICAgIH0pOwoKICAgIGl0KCdzaG91bGQgcmV0dXJuIGZuIHRoYXQgd2FzIHBhc3NlZCBpbnRvIGFkZFBvbGxGbicsIGZ1bmN0aW9uKCkgewogICAgICB2YXIgZm4gPSBmdW5jdGlvbigpIHsgcmV0dXJuIDE7IH07CiAgICAgIHZhciByZXR1cm5lZEZuID0gYnJvd3Nlci5hZGRQb2xsRm4oZm4pOwogICAgICBleHBlY3QocmV0dXJuZWRGbikudG9CZShmbik7CiAgICB9KTsKICB9KTsKCiAgZGVzY3JpYmUoJ3VybCcsIGZ1bmN0aW9uKCkgewogICAgdmFyIHB1c2hTdGF0ZSwgcmVwbGFjZVN0YXRlLCBsb2NhdGlvblJlcGxhY2U7CgogICAgYmVmb3JlRWFjaChmdW5jdGlvbigpIHsKICAgICAgcHVzaFN0YXRlID0gc3B5T24oZmFrZVdpbmRvdy5oaXN0b3J5LCAncHVzaFN0YXRlJyk7CiAgICAgIHJlcGxhY2VTdGF0ZSA9IHNweU9uKGZha2VXaW5kb3cuaGlzdG9yeSwgJ3JlcGxhY2VTdGF0ZScpOwogICAgICBsb2NhdGlvblJlcGxhY2UgPSBzcHlPbihmYWtlV2luZG93LmxvY2F0aW9uLCAncmVwbGFjZScpOwogICAgfSk7CgogICAgaXQoJ3Nob3VsZCByZXR1cm4gY3VycmVudCBsb2NhdGlvbi5ocmVmJywgZnVuY3Rpb24oKSB7CiAgICAgIGZha2VXaW5kb3cubG9jYXRpb24uaHJlZiA9ICdodHRwOi8vdGVzdC5jb20nOwogICAgICBleHBlY3QoYnJvd3Nlci51cmwoKSkudG9FcXVhbCgnaHR0cDovL3Rlc3QuY29tJyk7CgogICAgICBmYWtlV2luZG93LmxvY2F0aW9uLmhyZWYgPSAnaHR0cHM6Ly9hbm90aGVyLmNvbSc7CiAgICAgIGV4cGVjdChicm93c2VyLnVybCgpKS50b0VxdWFsKCdodHRwczovL2Fub3RoZXIuY29tJyk7CiAgICB9KTsKCiAgICBpdCgnc2hvdWxkIHVzZSBoaXN0b3J5LnB1c2hTdGF0ZSB3aGVuIGF2YWlsYWJsZScsIGZ1bmN0aW9uKCkgewogICAgICBzbmlmZmVyLmhpc3RvcnkgPSB0cnVlOwogICAgICBicm93c2VyLnVybCgnaHR0cDovL25ldy5vcmcnKTsKCiAgICAgIGV4cGVjdChwdXNoU3RhdGUpLnRvSGF2ZUJlZW5DYWxsZWRPbmNlKCk7CiAgICAgIGV4cGVjdChwdXNoU3RhdGUuYXJnc0ZvckNhbGxbMF1bMl0pLnRvRXF1YWwoJ2h0dHA6Ly9uZXcub3JnJyk7CgogICAgICBleHBlY3QocmVwbGFjZVN0YXRlKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpOwogICAgICBleHBlY3QobG9jYXRpb25SZXBsYWNlKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpOwogICAgICBleHBlY3QoZmFrZVdpbmRvdy5sb2NhdGlvbi5ocmVmKS50b0VxdWFsKCdodHRwOi8vc2VydmVyJyk7CiAgICB9KTsKCiAgICBpdCgnc2hvdWxkIHVzZSBoaXN0b3J5LnJlcGxhY2VTdGF0ZSB3aGVuIGF2YWlsYWJsZScsIGZ1bmN0aW9uKCkgewogICAgICBzbmlmZmVyLmhpc3RvcnkgPSB0cnVlOwogICAgICBicm93c2VyLnVybCgnaHR0cDovL25ldy5vcmcnLCB0cnVlKTsKCiAgICAgIGV4cGVjdChyZXBsYWNlU3RhdGUpLnRvSGF2ZUJlZW5DYWxsZWRPbmNlKCk7CiAgICAgIGV4cGVjdChyZXBsYWNlU3RhdGUuYXJnc0ZvckNhbGxbMF1bMl0pLnRvRXF1YWwoJ2h0dHA6Ly9uZXcub3JnJyk7CgogICAgICBleHBlY3QocHVzaFN0YXRlKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpOwogICAgICBleHBlY3QobG9jYXRpb25SZXBsYWNlKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpOwogICAgICBleHBlY3QoZmFrZVdpbmRvdy5sb2NhdGlvbi5ocmVmKS50b0VxdWFsKCdodHRwOi8vc2VydmVyJyk7CiAgICB9KTsKCiAgICBpdCgnc2hvdWxkIHNldCBsb2NhdGlvbi5ocmVmIHdoZW4gcHVzaFN0YXRlIG5vdCBhdmFpbGFibGUnLCBmdW5jdGlvbigpIHsKICAgICAgc25pZmZlci5oaXN0b3J5ID0gZmFsc2U7CiAgICAgIGJyb3dzZXIudXJsKCdodHRwOi8vbmV3Lm9yZycpOwoKICAgICAgZXhwZWN0KGZha2VXaW5kb3cubG9jYXRpb24uaHJlZikudG9FcXVhbCgnaHR0cDovL25ldy5vcmcnKTsKCiAgICAgIGV4cGVjdChwdXNoU3RhdGUpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7CiAgICAgIGV4cGVjdChyZXBsYWNlU3RhdGUpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7CiAgICAgIGV4cGVjdChsb2NhdGlvblJlcGxhY2UpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7CiAgICB9KTsKCiAgICBpdCgnc2hvdWxkIHVzZSBsb2NhdGlvbi5yZXBsYWNlIHdoZW4gaGlzdG9yeS5yZXBsYWNlU3RhdGUgbm90IGF2YWlsYWJsZScsIGZ1bmN0aW9uKCkgewogICAgICBzbmlmZmVyLmhpc3RvcnkgPSBmYWxzZTsKICAgICAgYnJvd3Nlci51cmwoJ2h0dHA6Ly9uZXcub3JnJywgdHJ1ZSk7CgogICAgICBleHBlY3QobG9jYXRpb25SZXBsYWNlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnaHR0cDovL25ldy5vcmcnKTsKCiAgICAgIGV4cGVjdChwdXNoU3RhdGUpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7CiAgICAgIGV4cGVjdChyZXBsYWNlU3RhdGUpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7CiAgICAgIGV4cGVjdChmYWtlV2luZG93LmxvY2F0aW9uLmhyZWYpLnRvRXF1YWwoJ2h0dHA6Ly9zZXJ2ZXInKTsKICAgIH0pOwoKICAgIGl0KCdzaG91bGQgcmV0dXJuICRicm93c2VyIHRvIGFsbG93IGNoYWluaW5nJywgZnVuY3Rpb24oKSB7CiAgICAgIGV4cGVjdChicm93c2VyLnVybCgnaHR0cDovL2FueS5jb20nKSkudG9CZShicm93c2VyKTsKICAgIH0pOwoKCiAgICBpdCgnc2hvdWxkIGRlY29kZSBzaW5nbGUgcXVvdGVzIHRvIHdvcmsgYXJvdW5kIEZGIGJ1ZyA0MDcyNzMnLCBmdW5jdGlvbigpIHsKICAgICAgZmFrZVdpbmRvdy5sb2NhdGlvbi5ocmVmID0gImh0dHA6Ly9mZi1idWcvP3NpbmdsZSUyN3F1b3RlIjsKICAgICAgZXhwZWN0KGJyb3dzZXIudXJsKCkpLnRvQmUoImh0dHA6Ly9mZi1idWcvP3NpbmdsZSdxdW90ZSIpOwogICAgfSk7CgogICAgaXQoJ3Nob3VsZCBub3Qgc2V0IFVSTCB3aGVuIHRoZSBVUkwgaXMgYWxyZWFkeSBzZXQnLCBmdW5jdGlvbigpIHsKICAgICAgdmFyIGN1cnJlbnQgPSBmYWtlV2luZG93LmxvY2F0aW9uLmhyZWY7CiAgICAgIHNuaWZmZXIuaGlzdG9yeSA9IGZhbHNlOwogICAgICBmYWtlV2luZG93LmxvY2F0aW9uLmhyZWYgPSAnZG9udGNoYW5nZSc7CiAgICAgIGJyb3dzZXIudXJsKGN1cnJlbnQpOwogICAgICBleHBlY3QoZmFrZVdpbmRvdy5sb2NhdGlvbi5ocmVmKS50b0JlKCdkb250Y2hhbmdlJyk7CiAgICB9KTsKICB9KTsKCiAgZGVzY3JpYmUoJ3VybENoYW5nZScsIGZ1bmN0aW9uKCkgewogICAgdmFyIGNhbGxiYWNrOwoKICAgIGJlZm9yZUVhY2goZnVuY3Rpb24oKSB7CiAgICAgIGNhbGxiYWNrID0gamFzbWluZS5jcmVhdGVTcHkoJ29uVXJsQ2hhbmdlJyk7CiAgICB9KTsKCiAgICBhZnRlckVhY2goZnVuY3Rpb24oKSB7CiAgICAgIGlmICghalF1ZXJ5KSBqcUxpdGUoZmFrZVdpbmRvdykuZGVhbG9jKCk7CiAgICB9KTsKCiAgICBpdCgnc2hvdWxkIHJldHVybiByZWdpc3RlcmVkIGNhbGxiYWNrJywgZnVuY3Rpb24oKSB7CiAgICAgIGV4cGVjdChicm93c2VyLm9uVXJsQ2hhbmdlKGNhbGxiYWNrKSkudG9CZShjYWxsYmFjayk7CiAgICB9KTsKCiAgICBpdCgnc2hvdWxkIGZvcndhcmQgcG9wc3RhdGUgZXZlbnQgd2l0aCBuZXcgdXJsIHdoZW4gaGlzdG9yeSBzdXBwb3J0ZWQnLCBmdW5jdGlvbigpIHsKICAgICAgc25pZmZlci5oaXN0b3J5ID0gdHJ1ZTsKICAgICAgYnJvd3Nlci5vblVybENoYW5nZShjYWxsYmFjayk7CiAgICAgIGZha2VXaW5kb3cubG9jYXRpb24uaHJlZiA9ICdodHRwOi8vc2VydmVyL25ldyc7CgogICAgICBmYWtlV2luZG93LmZpcmUoJ3BvcHN0YXRlJyk7CiAgICAgIGV4cGVjdChjYWxsYmFjaykudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2h0dHA6Ly9zZXJ2ZXIvbmV3Jyk7CgogICAgICBmYWtlV2luZG93LmZpcmUoJ2hhc2hjaGFuZ2UnKTsKICAgICAgZmFrZVdpbmRvdy5zZXRUaW1lb3V0LmZsdXNoKCk7CiAgICAgIGV4cGVjdChjYWxsYmFjaykudG9IYXZlQmVlbkNhbGxlZE9uY2UoKTsKICAgIH0pOwoKICAgIGl0KCdzaG91bGQgZm9yd2FyZCBvbmx5IHBvcHN0YXRlIGV2ZW50IHdoZW4gYm90aCBoaXN0b3J5IGFuZCBoYXNoY2hhbmdlIHN1cHBvcnRlZCcsIGZ1bmN0aW9uKCkgewogICAgICBzbmlmZmVyLmhpc3RvcnkgPSB0cnVlOwogICAgICBzbmlmZmVyLmhhc2hjaGFuZ2UgPSB0cnVlOwogICAgICBicm93c2VyLm9uVXJsQ2hhbmdlKGNhbGxiYWNrKTsKICAgICAgZmFrZVdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJ2h0dHA6Ly9zZXJ2ZXIvbmV3JzsKCiAgICAgIGZha2VXaW5kb3cuZmlyZSgncG9wc3RhdGUnKTsKICAgICAgZXhwZWN0KGNhbGxiYWNrKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnaHR0cDovL3NlcnZlci9uZXcnKTsKCiAgICAgIGZha2VXaW5kb3cuZmlyZSgnaGFzaGNoYW5nZScpOwogICAgICBmYWtlV2luZG93LnNldFRpbWVvdXQuZmx1c2goKTsKICAgICAgZXhwZWN0KGNhbGxiYWNrKS50b0hhdmVCZWVuQ2FsbGVkT25jZSgpOwogICAgfSk7CgogICAgaXQoJ3Nob3VsZCBmb3J3YXJkIGhhc2hjaGFuZ2UgZXZlbnQgd2l0aCBuZXcgdXJsIHdoZW4gb25seSBoYXNoY2hhbmdlIHN1cHBvcnRlZCcsIGZ1bmN0aW9uKCkgewogICAgICBzbmlmZmVyLmhpc3RvcnkgPSBmYWxzZTsKICAgICAgc25pZmZlci5oYXNoY2hhbmdlID0gdHJ1ZTsKICAgICAgYnJvd3Nlci5vblVybENoYW5nZShjYWxsYmFjayk7CiAgICAgIGZha2VXaW5kb3cubG9jYXRpb24uaHJlZiA9ICdodHRwOi8vc2VydmVyL25ldyc7CgogICAgICBmYWtlV2luZG93LmZpcmUoJ2hhc2hjaGFuZ2UnKTsKICAgICAgZXhwZWN0KGNhbGxiYWNrKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnaHR0cDovL3NlcnZlci9uZXcnKTsKCiAgICAgIGZha2VXaW5kb3cuZmlyZSgncG9wc3RhdGUnKTsKICAgICAgZmFrZVdpbmRvdy5zZXRUaW1lb3V0LmZsdXNoKCk7CiAgICAgIGV4cGVjdChjYWxsYmFjaykudG9IYXZlQmVlbkNhbGxlZE9uY2UoKTsKICAgIH0pOwoKICAgIGl0KCdzaG91bGQgdXNlIHBvbGxpbmcgd2hlbiBuZWl0aGVyIGhpc3Rvcnkgbm9yIGhhc2hjaGFuZ2Ugc3VwcG9ydGVkJywgZnVuY3Rpb24oKSB7CiAgICAgIHNuaWZmZXIuaGlzdG9yeSA9IGZhbHNlOwogICAgICBzbmlmZmVyLmhhc2hjaGFuZ2UgPSBmYWxzZTsKICAgICAgYnJvd3Nlci5vblVybENoYW5nZShjYWxsYmFjayk7CgogICAgICBmYWtlV2luZG93LmxvY2F0aW9uLmhyZWYgPSAnaHR0cDovL3NlcnZlci5uZXcnOwogICAgICBmYWtlV2luZG93LnNldFRpbWVvdXQuZmx1c2goKTsKICAgICAgZXhwZWN0KGNhbGxiYWNrKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnaHR0cDovL3NlcnZlci5uZXcnKTsKCiAgICAgIGNhbGxiYWNrLnJlc2V0KCk7CgogICAgICBmYWtlV2luZG93LmZpcmUoJ3BvcHN0YXRlJyk7CiAgICAgIGZha2VXaW5kb3cuZmlyZSgnaGFzaGNoYW5nZScpOwogICAgICBleHBlY3QoY2FsbGJhY2spLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7CiAgICB9KTsKCiAgICBkZXNjcmliZSgnYWZ0ZXIgYW4gaW5pdGlhbCBsb2NhdGlvbiBjaGFuZ2UgYnkgYnJvd3Nlci51cmwgbWV0aG9kIHdoZW4gbmVpdGhlciBoaXN0b3J5IG5vciBoYXNoY2hhbmdlIHN1cHBvcnRlZCcsIGZ1bmN0aW9uKCkgewogICAgICBiZWZvcmVFYWNoKGZ1bmN0aW9uKCkgewogICAgICAgIHNuaWZmZXIuaGlzdG9yeSA9IGZhbHNlOwogICAgICAgIHNuaWZmZXIuaGFzaGNoYW5nZSA9IGZhbHNlOwogICAgICAgIGJyb3dzZXIudXJsKCJodHRwOi8vc2VydmVyLmN1cnJlbnQiKTsKICAgICAgfSk7CgogICAgICBpdCgnc2hvdWxkIGZpcmUgY2FsbGJhY2sgd2l0aCB0aGUgY29ycmVjdCBVUkwgb24gbG9jYXRpb24gY2hhbmdlIG91dHNpZGUgb2YgYW5ndWxhcicsIGZ1bmN0aW9uKCkgewogICAgICAgIGJyb3dzZXIub25VcmxDaGFuZ2UoY2FsbGJhY2spOwoKICAgICAgICBmYWtlV2luZG93LmxvY2F0aW9uLmhyZWYgPSAnaHR0cDovL3NlcnZlci5uZXcnOwogICAgICAgIGZha2VXaW5kb3cuc2V0VGltZW91dC5mbHVzaCgpOwogICAgICAgIGV4cGVjdChjYWxsYmFjaykudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2h0dHA6Ly9zZXJ2ZXIubmV3Jyk7CgogICAgICAgIGZha2VXaW5kb3cuZmlyZSgncG9wc3RhdGUnKTsKICAgICAgICBmYWtlV2luZG93LmZpcmUoJ2hhc2hjaGFuZ2UnKTsKICAgICAgICBleHBlY3QoY2FsbGJhY2spLnRvSGF2ZUJlZW5DYWxsZWRPbmNlKCk7CiAgICAgIH0pOwoKICAgIH0pOwoKICAgIGl0KCdzaG91bGQgbm90IGZpcmUgdXJsQ2hhbmdlIGlmIGNoYW5nZWQgYnkgYnJvd3Nlci51cmwgbWV0aG9kIChwb2xsaW5nKScsIGZ1bmN0aW9uKCkgewogICAgICBzbmlmZmVyLmhpc3RvcnkgPSBmYWxzZTsKICAgICAgc25pZmZlci5oYXNoY2hhbmdlID0gZmFsc2U7CiAgICAgIGJyb3dzZXIub25VcmxDaGFuZ2UoY2FsbGJhY2spOwogICAgICBicm93c2VyLnVybCgnaHR0cDovL25ldy5jb20nKTsKCiAgICAgIGZha2VXaW5kb3cuc2V0VGltZW91dC5mbHVzaCgpOwogICAgICBleHBlY3QoY2FsbGJhY2spLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7CiAgICB9KTsKCiAgICBpdCgnc2hvdWxkIG5vdCBmaXJlIHVybENoYW5nZSBpZiBjaGFuZ2VkIGJ5IGJyb3dzZXIudXJsIG1ldGhvZCAoaGFzaGNoYW5nZSknLCBmdW5jdGlvbigpIHsKICAgICAgc25pZmZlci5oaXN0b3J5ID0gZmFsc2U7CiAgICAgIHNuaWZmZXIuaGFzaGNoYW5nZSA9IHRydWU7CiAgICAgIGJyb3dzZXIub25VcmxDaGFuZ2UoY2FsbGJhY2spOwogICAgICBicm93c2VyLnVybCgnaHR0cDovL25ldy5jb20nKTsKCiAgICAgIGZha2VXaW5kb3cuZmlyZSgnaGFzaGNoYW5nZScpOwogICAgICBleHBlY3QoY2FsbGJhY2spLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7CiAgICB9KTsKICB9KTsKCgogIGRlc2NyaWJlKCdiYXNlSHJlZicsIGZ1bmN0aW9uKCkgewogICAgdmFyIGpxRG9jSGVhZDsKCiAgICBiZWZvcmVFYWNoKGZ1bmN0aW9uKCkgewogICAgICBqcURvY0hlYWQgPSBqcUxpdGUoZG9jdW1lbnQpLmZpbmQoJ2hlYWQnKTsKICAgIH0pOwoKICAgIGl0KCdzaG91bGQgcmV0dXJuIHZhbHVlIGZyb20gPGJhc2UgaHJlZj4nLCBmdW5jdGlvbigpIHsKICAgICAgZmFrZURvY3VtZW50LmJhc2VQYXRoID0gJy9iYXNlL3BhdGgvJzsKICAgICAgZXhwZWN0KGJyb3dzZXIuYmFzZUhyZWYoKSkudG9FcXVhbCgnL2Jhc2UvcGF0aC8nKTsKICAgIH0pOwoKICAgIGl0KCdzaG91bGQgcmV0dXJuIFwnXCcgKGVtcHR5IHN0cmluZykgaWYgbm8gPGJhc2UgaHJlZj4nLCBmdW5jdGlvbigpIHsKICAgICAgZmFrZURvY3VtZW50LmJhc2VQYXRoID0gdW5kZWZpbmVkOwogICAgICBleHBlY3QoYnJvd3Nlci5iYXNlSHJlZigpKS50b0VxdWFsKCcnKTsKICAgIH0pOwoKICAgIGl0KCdzaG91bGQgcmVtb3ZlIGRvbWFpbiBmcm9tIDxiYXNlIGhyZWY+JywgZnVuY3Rpb24oKSB7CiAgICAgIGZha2VEb2N1bWVudC5iYXNlUGF0aCA9ICdodHRwOi8vaG9zdC5jb20vYmFzZS9wYXRoLyc7CiAgICAgIGV4cGVjdChicm93c2VyLmJhc2VIcmVmKCkpLnRvRXF1YWwoJy9iYXNlL3BhdGgvJyk7CgogICAgICBmYWtlRG9jdW1lbnQuYmFzZVBhdGggPSAnaHR0cDovL2hvc3QuY29tL2Jhc2UvcGF0aC9pbmRleC5odG1sJzsKICAgICAgZXhwZWN0KGJyb3dzZXIuYmFzZUhyZWYoKSkudG9FcXVhbCgnL2Jhc2UvcGF0aC9pbmRleC5odG1sJyk7CiAgICB9KTsKCiAgICBpdCgnc2hvdWxkIHJlbW92ZSBkb21haW4gZnJvbSA8YmFzZSBocmVmPiBiZWdpbm5pbmcgd2l0aCBcJy8vXCcnLCBmdW5jdGlvbigpIHsKICAgICAgZmFrZURvY3VtZW50LmJhc2VQYXRoID0gJy8vZ29vZ2xlLmNvbS9iYXNlL3BhdGgvJzsKICAgICAgZXhwZWN0KGJyb3dzZXIuYmFzZUhyZWYoKSkudG9FcXVhbCgnL2Jhc2UvcGF0aC8nKTsKICAgIH0pOwogIH0pOwp9KTsK",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Thu, 06 Nov 2014 07:53:38 GMT",
                    "Content-Length": "19818",
                    "Date": "Thu, 06 Nov 2014 07:53:40 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}