{
    "url": "http://localhost:9999/ariya/phantomjs/src/qt/qtwebkit/Tools/BuildSlaveSupport/build.webkit.org-config/public_html/LeaksViewer/LeaksViewer.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Link manipulation (DOM-based)",
    "issueType": 5246976,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based link manipulation vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this to a navigation target within the current page, such as a clickable link or the submission URL of a form. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will modify the target of links within the response. An attacker may be able to leverage this to perform various attacks, including:<ul><li>Causing the user to redirect to an arbitrary external URL, to facilitate a phishing attack.</li><li>Causing the user to submit sensitive form data to a server controlled by the attacker.</li><li>Causing the user to perform an unintended action within the application, by changing the file or query string associated with a link.</li><li>Bypassing browser anti-XSS defenses by injecting on-site links containing XSS exploits, since browser anti-XSS defenses typically do not operate on on-site links.</li></ul>",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based link manipulation vulnerabilities is not to dynamically set the target URLs of links or forms using data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing an arbitrary URL as a link target. In general, this is best achieved by using a whitelist of URLs that are permitted link targets, and strictly validating the target against this list before setting the link target.",
    "issueDetail": "The application may be vulnerable to DOM-based link manipulation. Data is read from <b>document.location.href</b> and written to <b>the 'href' property of a DOM element</b> via the following statement:<ul><li>link.href = document.location.href + \"?url=\" + encodeURIComponent(build.url);</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/ariya/phantomjs/src/qt/qtwebkit/Tools/BuildSlaveSupport/build.webkit.org-config/public_html/LeaksViewer/LeaksViewer.js",
                "path": "/ariya/phantomjs/src/qt/qtwebkit/Tools/BuildSlaveSupport/build.webkit.org-config/public_html/LeaksViewer/LeaksViewer.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9hcml5YS9waGFudG9tanMvc3JjL3F0L3F0d2Via2l0L1Rvb2xzL0J1aWxkU2xhdmVTdXBwb3J0L2J1aWxkLndlYmtpdC5vcmctY29uZmlnL3B1YmxpY19odG1sL0xlYWtzVmlld2VyL0xlYWtzVmlld2VyLmpzIEhUVFAvMS4xDQpIb3N0OiBsb2NhbGhvc3Q6OTk5OQ0KDQo=",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogNzAyMg0KQWNjZXB0LVJhbmdlczogYnl0ZXMNCkNvbnRlbnQtVHlwZTogYXBwbGljYXRpb24vamF2YXNjcmlwdA0KRGF0ZTogRnJpLCAwNyBOb3YgMjAxNCAyMTo1MToxMSBHTVQNCkxhc3QtTW9kaWZpZWQ6IEZyaSwgMDcgTm92IDIwMTQgMjE6NTA6MDAgR01UDQoNCi8qCiAqIENvcHlyaWdodCAoQykgMjAxMSBBcHBsZSBJbmMuIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqCiAqIFJlZGlzdHJpYnV0aW9uIGFuZCB1c2UgaW4gc291cmNlIGFuZCBiaW5hcnkgZm9ybXMsIHdpdGggb3Igd2l0aG91dAogKiBtb2RpZmljYXRpb24sIGFyZSBwZXJtaXR0ZWQgcHJvdmlkZWQgdGhhdCB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnMKICogYXJlIG1ldDoKICogMS4gUmVkaXN0cmlidXRpb25zIG9mIHNvdXJjZSBjb2RlIG11c3QgcmV0YWluIHRoZSBhYm92ZSBjb3B5cmlnaHQKICogICAgbm90aWNlLCB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyLgogKiAyLiBSZWRpc3RyaWJ1dGlvbnMgaW4gYmluYXJ5IGZvcm0gbXVzdCByZXByb2R1Y2UgdGhlIGFib3ZlIGNvcHlyaWdodAogKiAgICBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIgaW4gdGhlCiAqICAgIGRvY3VtZW50YXRpb24gYW5kL29yIG90aGVyIG1hdGVyaWFscyBwcm92aWRlZCB3aXRoIHRoZSBkaXN0cmlidXRpb24uCiAqCiAqIFRISVMgU09GVFdBUkUgSVMgUFJPVklERUQgQlkgQVBQTEUgSU5DLiBBTkQgSVRTIENPTlRSSUJVVE9SUyBgYEFTIElTJycKICogQU5EIEFOWSBFWFBSRVNTIE9SIElNUExJRUQgV0FSUkFOVElFUywgSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sCiAqIFRIRSBJTVBMSUVEIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZIEFORCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIKICogUFVSUE9TRSBBUkUgRElTQ0xBSU1FRC4gSU4gTk8gRVZFTlQgU0hBTEwgQVBQTEUgSU5DLiBPUiBJVFMgQ09OVFJJQlVUT1JTCiAqIEJFIExJQUJMRSBGT1IgQU5ZIERJUkVDVCwgSU5ESVJFQ1QsIElOQ0lERU5UQUwsIFNQRUNJQUwsIEVYRU1QTEFSWSwgT1IKICogQ09OU0VRVUVOVElBTCBEQU1BR0VTIChJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgUFJPQ1VSRU1FTlQgT0YKICogU1VCU1RJVFVURSBHT09EUyBPUiBTRVJWSUNFUzsgTE9TUyBPRiBVU0UsIERBVEEsIE9SIFBST0ZJVFM7IE9SIEJVU0lORVNTCiAqIElOVEVSUlVQVElPTikgSE9XRVZFUiBDQVVTRUQgQU5EIE9OIEFOWSBUSEVPUlkgT0YgTElBQklMSVRZLCBXSEVUSEVSIElOCiAqIENPTlRSQUNULCBTVFJJQ1QgTElBQklMSVRZLCBPUiBUT1JUIChJTkNMVURJTkcgTkVHTElHRU5DRSBPUiBPVEhFUldJU0UpCiAqIEFSSVNJTkcgSU4gQU5ZIFdBWSBPVVQgT0YgVEhFIFVTRSBPRiBUSElTIFNPRlRXQVJFLCBFVkVOIElGIEFEVklTRUQgT0YKICogVEhFIFBPU1NJQklMSVRZIE9GIFNVQ0ggREFNQUdFLgogKi8KCnZhciBMZWFrc1ZpZXdlciA9IHsKICAgIGxvYWRlZDogZnVuY3Rpb24oKSB7CiAgICAgICAgdGhpcy5fbG9hZGVyID0gbmV3IExlYWtzTG9hZGVyKHRoaXMuX2RpZENvdW50TGVha3NGaWxlcy5iaW5kKHRoaXMpLCB0aGlzLl9kaWRMb2FkTGVha3NGaWxlLmJpbmQodGhpcykpOwogICAgICAgIHRoaXMuX3BhcnNlciA9IG5ldyBMZWFrc1BhcnNlcih0aGlzLl9kaWRQYXJzZUxlYWtzRmlsZS5iaW5kKHRoaXMpKTsKCiAgICAgICAgdGhpcy5fbG9hZGluZ0luZGljYXRvciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsb2FkaW5nLWluZGljYXRvciIpOwogICAgICAgIHRoaXMuX2xvYWRpbmdJbmRpY2F0b3JMYWJlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsb2FkaW5nLWluZGljYXRvci1sYWJlbCIpOwoKICAgICAgICB0aGlzLl9wcm9maWxlVmlldyA9IG5ldyBXZWJJbnNwZWN0b3IuQ1BVUHJvZmlsZVZpZXcoe30pOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJtYWluLXBhbmVscyIpLmFwcGVuZENoaWxkKHRoaXMuX3Byb2ZpbGVWaWV3LmVsZW1lbnQpOwogICAgICAgIHRoaXMuX3Byb2ZpbGVWaWV3LnNob3coKTsKCiAgICAgICAgLy8gRnJvbSBXZWJJbnNwZWN0b3IuUGFuZWwucHJvdG90eXBlLnNob3cKICAgICAgICB2YXIgc3RhdHVzQmFySXRlbXMgPSB0aGlzLl9wcm9maWxlVmlldy5zdGF0dXNCYXJJdGVtczsKICAgICAgICBpZiAoc3RhdHVzQmFySXRlbXMpIHsKICAgICAgICAgICAgdGhpcy5fc3RhdHVzQmFySXRlbUNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHN0YXR1c0Jhckl0ZW1zLmxlbmd0aDsgKytpKQogICAgICAgICAgICAgICAgdGhpcy5fc3RhdHVzQmFySXRlbUNvbnRhaW5lci5hcHBlbmRDaGlsZChzdGF0dXNCYXJJdGVtc1tpXSk7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJtYWluLXN0YXR1cy1iYXIiKS5hcHBlbmRDaGlsZCh0aGlzLl9zdGF0dXNCYXJJdGVtQ29udGFpbmVyKTsKICAgICAgICB9CgogICAgICAgIHZhciB1cmw7CiAgICAgICAgdmFyIG1hdGNoID0gL3VybD0oW14mXSspLy5leGVjKGxvY2F0aW9uLnNlYXJjaCk7CiAgICAgICAgaWYgKG1hdGNoKQogICAgICAgICAgICB1cmwgPSBkZWNvZGVVUklDb21wb25lbnQobWF0Y2hbMV0pOwoKICAgICAgICBpZiAodXJsKQogICAgICAgICAgICB0aGlzLl9sb2FkTGVha3NGcm9tVVJMKHVybCkKICAgICAgICBlbHNlCiAgICAgICAgICAgIHRoaXMuX2Rpc3BsYXlVUkxQcm9tcHQoKTsKICAgIH0sCgogICAgZ2V0IGZpbGVzTGVmdFRvUGFyc2UoKSB7CiAgICAgICAgaWYgKCEoJ19maWxlc0xlZnRUb1BhcnNlJyBpbiB0aGlzKSkKICAgICAgICAgICAgdGhpcy5fZmlsZXNMZWZ0VG9QYXJzZSA9IDA7CiAgICAgICAgcmV0dXJuIHRoaXMuX2ZpbGVzTGVmdFRvUGFyc2U7CiAgICB9LAoKICAgIHNldCBmaWxlc0xlZnRUb1BhcnNlKHgpIHsKICAgICAgICBpZiAodGhpcy5fZmlsZXNMZWZ0VG9QYXJzZSA9PT0geCkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIHRoaXMuX2ZpbGVzTGVmdFRvUGFyc2UgPSB4OwogICAgICAgIHRoaXMuX2xvYWRpbmdTdGF0dXNDaGFuZ2VkKCk7CiAgICB9LAoKICAgIGdldCBsb2FkaW5nKCkgewogICAgICAgIHJldHVybiB0aGlzLl9pc0xvYWRpbmc7CiAgICB9LAoKICAgIHNldCBsb2FkaW5nKHgpIHsKICAgICAgICBpZiAodGhpcy5faXNMb2FkaW5nID09PSB4KQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgdGhpcy5faXNMb2FkaW5nID0geDsKICAgICAgICB0aGlzLl9sb2FkaW5nU3RhdHVzQ2hhbmdlZCgpOwogICAgfSwKCiAgICBnZXQgdXJsKCkgewogICAgICAgIHJldHVybiB0aGlzLl91cmw7CiAgICB9LAoKICAgIHNldCB1cmwoeCkgewogICAgICAgIGlmICh0aGlzLl91cmwgPT09IHgpCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgdGhpcy5fdXJsID0geDsKICAgICAgICB0aGlzLl91cGRhdGVUaXRsZSgpOwogICAgfSwKCiAgICB1cmxQcm9tcHRCdXR0b25DbGlja2VkOiBmdW5jdGlvbihlKSB7CiAgICAgICAgdGhpcy5fdXJsQ2hvc2VuRnJvbVByb21wdChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidXJsIikudmFsdWUpOwogICAgfSwKCiAgICBfZGlkQ291bnRMZWFrc0ZpbGVzOiBmdW5jdGlvbihmaWxlQ291bnQpIHsKICAgICAgICB0aGlzLl9maWxlQ291bnQgPSBmaWxlQ291bnQ7CiAgICAgICAgdGhpcy5maWxlc0xlZnRUb1BhcnNlID0gZmlsZUNvdW50OwogICAgfSwKCiAgICBfZGlkTG9hZExlYWtzRmlsZTogZnVuY3Rpb24obGVha3NUZXh0KSB7CiAgICAgICAgdGhpcy5fcGFyc2VyLmFkZExlYWtzRmlsZShsZWFrc1RleHQpOwogICAgfSwKCiAgICBfZGlkTG9hZFJlY2VudEJ1aWxkczogZnVuY3Rpb24oYnVpbGRzKSB7CiAgICAgICAgdGhpcy5fcmVjZW50QnVpbGRzID0gYnVpbGRzOwogICAgICAgIHRoaXMuX3VwZGF0ZVVSTFByb21wdCgpOwogICAgfSwKCiAgICBfZGlkUGFyc2VMZWFrc0ZpbGU6IGZ1bmN0aW9uKHByb2ZpbGUpIHsKICAgICAgICBpZiAoLS10aGlzLmZpbGVzTGVmdFRvUGFyc2UpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBQcm9maWxlckFnZW50LnByb2ZpbGVSZWFkeShwcm9maWxlKTsKICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTsKICAgIH0sCgogICAgX2Rpc3BsYXlVUkxQcm9tcHQ6IGZ1bmN0aW9uKCkgewogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ1cmwtcHJvbXB0LWNvbnRhaW5lciIpLnJlbW92ZVN0eWxlQ2xhc3MoImhpZGRlbiIpOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ1cmwiKS5mb2N1cygpOwogICAgICAgIHZhciBsb2FkZXIgPSBuZXcgUmVjZW50QnVpbGRzTG9hZGVyKHRoaXMuX2RpZExvYWRSZWNlbnRCdWlsZHMuYmluZCh0aGlzKSk7CiAgICAgICAgbG9hZGVyLnN0YXJ0KCJMaW9uIExlYWtzIiwgdGhpcy5fbnVtYmVyT2ZSZWNlbnRCdWlsZHNUb0xvYWQpOwogICAgfSwKCiAgICBfbG9hZExlYWtzRnJvbVVSTDogZnVuY3Rpb24odXJsKSB7CiAgICAgICAgdGhpcy51cmwgPSB1cmw7CiAgICAgICAgdGhpcy5sb2FkaW5nID0gdHJ1ZTsKCiAgICAgICAgdGhpcy5fbG9hZGVyLnN0YXJ0KHRoaXMudXJsKTsKICAgIH0sCgogICAgX2xvYWRpbmdJbmRpY2F0b3JUZXh0OiBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgdGV4dCA9ICJMb2FkaW5nIjsKICAgICAgICBpZiAodGhpcy5maWxlc0xlZnRUb1BhcnNlKQogICAgICAgICAgICB0ZXh0ICs9ICIgIiArICh0aGlzLl9maWxlQ291bnQgLSB0aGlzLmZpbGVzTGVmdFRvUGFyc2UgKyAxKSArICIvIiArIHRoaXMuX2ZpbGVDb3VudCArICIgZmlsZXMiOwogICAgICAgIHRleHQgKz0gIlx1MjAyNiI7CiAgICAgICAgcmV0dXJuIHRleHQ7CiAgICB9LAoKICAgIF9sb2FkaW5nU3RhdHVzQ2hhbmdlZDogZnVuY3Rpb24oKSB7CiAgICAgICAgdGhpcy5fc2V0TG9hZGluZ0luZGljYXRvckhpZGRlbighdGhpcy5sb2FkaW5nKTsKICAgICAgICB0aGlzLl91cGRhdGVMb2FkaW5nSW5kaWNhdG9yTGFiZWwoKTsKICAgICAgICB0aGlzLl91cGRhdGVUaXRsZSgpOwogICAgfSwKCiAgICBfbnVtYmVyT2ZSZWNlbnRCdWlsZHNUb0xvYWQ6IDEwLAoKICAgIF9zZXRMb2FkaW5nSW5kaWNhdG9ySGlkZGVuOiBmdW5jdGlvbihoaWRkZW4pIHsKICAgICAgICBpZiAoaGlkZGVuKQogICAgICAgICAgICB0aGlzLl9sb2FkaW5nSW5kaWNhdG9yLmFkZFN0eWxlQ2xhc3MoImhpZGRlbiIpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgdGhpcy5fbG9hZGluZ0luZGljYXRvci5yZW1vdmVTdHlsZUNsYXNzKCJoaWRkZW4iKTsKICAgIH0sCgogICAgX3VwZGF0ZUxvYWRpbmdJbmRpY2F0b3JMYWJlbDogZnVuY3Rpb24oKSB7CiAgICAgICAgdGhpcy5fbG9hZGluZ0luZGljYXRvckxhYmVsLmlubmVyVGV4dCA9IHRoaXMuX2xvYWRpbmdJbmRpY2F0b3JUZXh0KCk7CiAgICB9LAoKICAgIF91cGRhdGVUaXRsZTogZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIHRpdGxlID0gIkxlYWtzIFZpZXdlciBcdTIwMTQgIjsKICAgICAgICBpZiAodGhpcy5sb2FkaW5nKQogICAgICAgICAgICB0aXRsZSArPSAiKCIgKyB0aGlzLl9sb2FkaW5nSW5kaWNhdG9yVGV4dCgpICsgIikgIjsKICAgICAgICB0aXRsZSArPSB0aGlzLnVybDsKICAgICAgICBkb2N1bWVudC50aXRsZSA9IHRpdGxlOwogICAgfSwKCiAgICBfdXBkYXRlVVJMUHJvbXB0OiBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgcmVjZW50QnVpbGRzQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInJlY2VudC1idWlsZHMtY29udGFpbmVyIik7CiAgICAgICAgcmVjZW50QnVpbGRzQ29udGFpbmVyLnJlbW92ZUNoaWxkcmVuKCk7CiAgICAgICAgaWYgKHRoaXMuX3JlY2VudEJ1aWxkcyAmJiB0aGlzLl9yZWNlbnRCdWlsZHMubGVuZ3RoKSB7CiAgICAgICAgICAgIHZhciBsaXN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgib2wiKTsKICAgICAgICAgICAgbGlzdC5pZCA9ICJyZWNlbnQtYnVpbGRzLWxpc3QiOwoKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICB0aGlzLl9yZWNlbnRCdWlsZHMuZm9yRWFjaChmdW5jdGlvbihidWlsZCkgewogICAgICAgICAgICAgICAgdmFyIGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJhIik7CiAgICAgICAgICAgICAgICBsaW5rLmhyZWYgPSBkb2N1bWVudC5sb2NhdGlvbi5ocmVmICsgIj91cmw9IiArIGVuY29kZVVSSUNvbXBvbmVudChidWlsZC51cmwpOwogICAgICAgICAgICAgICAgbGluay5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICAgICAgICBzZWxmLl91cmxDaG9zZW5Gcm9tUHJvbXB0KGJ1aWxkLnVybCk7CiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBsaW5rLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCJyIiArIGJ1aWxkLnJldmlzaW9uICsgIjogIiArIGJ1aWxkLmxlYWtDb3VudCArICIgbGVha3MiKSk7CiAgICAgICAgICAgICAgICB2YXIgaXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImxpIik7CiAgICAgICAgICAgICAgICBpdGVtLmFwcGVuZENoaWxkKGxpbmspOwoKICAgICAgICAgICAgICAgIGxpc3QuYXBwZW5kQ2hpbGQoaXRlbSk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgcmVjZW50QnVpbGRzQ29udGFpbmVyLmFwcGVuZENoaWxkKGxpc3QpOwogICAgICAgIH0gZWxzZQogICAgICAgICAgICByZWNlbnRCdWlsZHNDb250YWluZXIuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoIk5vIHJlY2VudCBsZWFreSBidWlsZHMgZm91bmQuIikpOwogICAgfSwKCiAgICBfdXJsQ2hvc2VuRnJvbVByb21wdDogZnVuY3Rpb24odXJsKSB7CiAgICAgICAgdGhpcy5fbG9hZExlYWtzRnJvbVVSTCh1cmwpOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ1cmwtcHJvbXB0LWNvbnRhaW5lciIpLmFkZFN0eWxlQ2xhc3MoImhpZGRlbiIpOwogICAgfSwKCn07CgphZGRFdmVudExpc3RlbmVyKCJsb2FkIiwgTGVha3NWaWV3ZXIubG9hZGVkLmJpbmQoTGVha3NWaWV3ZXIpKTsK",
                "body": "LyoKICogQ29weXJpZ2h0IChDKSAyMDExIEFwcGxlIEluYy4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KICoKICogUmVkaXN0cmlidXRpb24gYW5kIHVzZSBpbiBzb3VyY2UgYW5kIGJpbmFyeSBmb3Jtcywgd2l0aCBvciB3aXRob3V0CiAqIG1vZGlmaWNhdGlvbiwgYXJlIHBlcm1pdHRlZCBwcm92aWRlZCB0aGF0IHRoZSBmb2xsb3dpbmcgY29uZGl0aW9ucwogKiBhcmUgbWV0OgogKiAxLiBSZWRpc3RyaWJ1dGlvbnMgb2Ygc291cmNlIGNvZGUgbXVzdCByZXRhaW4gdGhlIGFib3ZlIGNvcHlyaWdodAogKiAgICBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIuCiAqIDIuIFJlZGlzdHJpYnV0aW9ucyBpbiBiaW5hcnkgZm9ybSBtdXN0IHJlcHJvZHVjZSB0aGUgYWJvdmUgY29weXJpZ2h0CiAqICAgIG5vdGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lciBpbiB0aGUKICogICAgZG9jdW1lbnRhdGlvbiBhbmQvb3Igb3RoZXIgbWF0ZXJpYWxzIHByb3ZpZGVkIHdpdGggdGhlIGRpc3RyaWJ1dGlvbi4KICoKICogVEhJUyBTT0ZUV0FSRSBJUyBQUk9WSURFRCBCWSBBUFBMRSBJTkMuIEFORCBJVFMgQ09OVFJJQlVUT1JTIGBgQVMgSVMnJwogKiBBTkQgQU5ZIEVYUFJFU1MgT1IgSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywKICogVEhFIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkgQU5EIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUgogKiBQVVJQT1NFIEFSRSBESVNDTEFJTUVELiBJTiBOTyBFVkVOVCBTSEFMTCBBUFBMRSBJTkMuIE9SIElUUyBDT05UUklCVVRPUlMKICogQkUgTElBQkxFIEZPUiBBTlkgRElSRUNULCBJTkRJUkVDVCwgSU5DSURFTlRBTCwgU1BFQ0lBTCwgRVhFTVBMQVJZLCBPUgogKiBDT05TRVFVRU5USUFMIERBTUFHRVMgKElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBQUk9DVVJFTUVOVCBPRgogKiBTVUJTVElUVVRFIEdPT0RTIE9SIFNFUlZJQ0VTOyBMT1NTIE9GIFVTRSwgREFUQSwgT1IgUFJPRklUUzsgT1IgQlVTSU5FU1MKICogSU5URVJSVVBUSU9OKSBIT1dFVkVSIENBVVNFRCBBTkQgT04gQU5ZIFRIRU9SWSBPRiBMSUFCSUxJVFksIFdIRVRIRVIgSU4KICogQ09OVFJBQ1QsIFNUUklDVCBMSUFCSUxJVFksIE9SIFRPUlQgKElOQ0xVRElORyBORUdMSUdFTkNFIE9SIE9USEVSV0lTRSkKICogQVJJU0lORyBJTiBBTlkgV0FZIE9VVCBPRiBUSEUgVVNFIE9GIFRISVMgU09GVFdBUkUsIEVWRU4gSUYgQURWSVNFRCBPRgogKiBUSEUgUE9TU0lCSUxJVFkgT0YgU1VDSCBEQU1BR0UuCiAqLwoKdmFyIExlYWtzVmlld2VyID0gewogICAgbG9hZGVkOiBmdW5jdGlvbigpIHsKICAgICAgICB0aGlzLl9sb2FkZXIgPSBuZXcgTGVha3NMb2FkZXIodGhpcy5fZGlkQ291bnRMZWFrc0ZpbGVzLmJpbmQodGhpcyksIHRoaXMuX2RpZExvYWRMZWFrc0ZpbGUuYmluZCh0aGlzKSk7CiAgICAgICAgdGhpcy5fcGFyc2VyID0gbmV3IExlYWtzUGFyc2VyKHRoaXMuX2RpZFBhcnNlTGVha3NGaWxlLmJpbmQodGhpcykpOwoKICAgICAgICB0aGlzLl9sb2FkaW5nSW5kaWNhdG9yID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImxvYWRpbmctaW5kaWNhdG9yIik7CiAgICAgICAgdGhpcy5fbG9hZGluZ0luZGljYXRvckxhYmVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImxvYWRpbmctaW5kaWNhdG9yLWxhYmVsIik7CgogICAgICAgIHRoaXMuX3Byb2ZpbGVWaWV3ID0gbmV3IFdlYkluc3BlY3Rvci5DUFVQcm9maWxlVmlldyh7fSk7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1haW4tcGFuZWxzIikuYXBwZW5kQ2hpbGQodGhpcy5fcHJvZmlsZVZpZXcuZWxlbWVudCk7CiAgICAgICAgdGhpcy5fcHJvZmlsZVZpZXcuc2hvdygpOwoKICAgICAgICAvLyBGcm9tIFdlYkluc3BlY3Rvci5QYW5lbC5wcm90b3R5cGUuc2hvdwogICAgICAgIHZhciBzdGF0dXNCYXJJdGVtcyA9IHRoaXMuX3Byb2ZpbGVWaWV3LnN0YXR1c0Jhckl0ZW1zOwogICAgICAgIGlmIChzdGF0dXNCYXJJdGVtcykgewogICAgICAgICAgICB0aGlzLl9zdGF0dXNCYXJJdGVtQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc3RhdHVzQmFySXRlbXMubGVuZ3RoOyArK2kpCiAgICAgICAgICAgICAgICB0aGlzLl9zdGF0dXNCYXJJdGVtQ29udGFpbmVyLmFwcGVuZENoaWxkKHN0YXR1c0Jhckl0ZW1zW2ldKTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1haW4tc3RhdHVzLWJhciIpLmFwcGVuZENoaWxkKHRoaXMuX3N0YXR1c0Jhckl0ZW1Db250YWluZXIpOwogICAgICAgIH0KCiAgICAgICAgdmFyIHVybDsKICAgICAgICB2YXIgbWF0Y2ggPSAvdXJsPShbXiZdKykvLmV4ZWMobG9jYXRpb24uc2VhcmNoKTsKICAgICAgICBpZiAobWF0Y2gpCiAgICAgICAgICAgIHVybCA9IGRlY29kZVVSSUNvbXBvbmVudChtYXRjaFsxXSk7CgogICAgICAgIGlmICh1cmwpCiAgICAgICAgICAgIHRoaXMuX2xvYWRMZWFrc0Zyb21VUkwodXJsKQogICAgICAgIGVsc2UKICAgICAgICAgICAgdGhpcy5fZGlzcGxheVVSTFByb21wdCgpOwogICAgfSwKCiAgICBnZXQgZmlsZXNMZWZ0VG9QYXJzZSgpIHsKICAgICAgICBpZiAoISgnX2ZpbGVzTGVmdFRvUGFyc2UnIGluIHRoaXMpKQogICAgICAgICAgICB0aGlzLl9maWxlc0xlZnRUb1BhcnNlID0gMDsKICAgICAgICByZXR1cm4gdGhpcy5fZmlsZXNMZWZ0VG9QYXJzZTsKICAgIH0sCgogICAgc2V0IGZpbGVzTGVmdFRvUGFyc2UoeCkgewogICAgICAgIGlmICh0aGlzLl9maWxlc0xlZnRUb1BhcnNlID09PSB4KQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgdGhpcy5fZmlsZXNMZWZ0VG9QYXJzZSA9IHg7CiAgICAgICAgdGhpcy5fbG9hZGluZ1N0YXR1c0NoYW5nZWQoKTsKICAgIH0sCgogICAgZ2V0IGxvYWRpbmcoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2lzTG9hZGluZzsKICAgIH0sCgogICAgc2V0IGxvYWRpbmcoeCkgewogICAgICAgIGlmICh0aGlzLl9pc0xvYWRpbmcgPT09IHgpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB0aGlzLl9pc0xvYWRpbmcgPSB4OwogICAgICAgIHRoaXMuX2xvYWRpbmdTdGF0dXNDaGFuZ2VkKCk7CiAgICB9LAoKICAgIGdldCB1cmwoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3VybDsKICAgIH0sCgogICAgc2V0IHVybCh4KSB7CiAgICAgICAgaWYgKHRoaXMuX3VybCA9PT0geCkKICAgICAgICAgICAgcmV0dXJuOwoKICAgICAgICB0aGlzLl91cmwgPSB4OwogICAgICAgIHRoaXMuX3VwZGF0ZVRpdGxlKCk7CiAgICB9LAoKICAgIHVybFByb21wdEJ1dHRvbkNsaWNrZWQ6IGZ1bmN0aW9uKGUpIHsKICAgICAgICB0aGlzLl91cmxDaG9zZW5Gcm9tUHJvbXB0KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ1cmwiKS52YWx1ZSk7CiAgICB9LAoKICAgIF9kaWRDb3VudExlYWtzRmlsZXM6IGZ1bmN0aW9uKGZpbGVDb3VudCkgewogICAgICAgIHRoaXMuX2ZpbGVDb3VudCA9IGZpbGVDb3VudDsKICAgICAgICB0aGlzLmZpbGVzTGVmdFRvUGFyc2UgPSBmaWxlQ291bnQ7CiAgICB9LAoKICAgIF9kaWRMb2FkTGVha3NGaWxlOiBmdW5jdGlvbihsZWFrc1RleHQpIHsKICAgICAgICB0aGlzLl9wYXJzZXIuYWRkTGVha3NGaWxlKGxlYWtzVGV4dCk7CiAgICB9LAoKICAgIF9kaWRMb2FkUmVjZW50QnVpbGRzOiBmdW5jdGlvbihidWlsZHMpIHsKICAgICAgICB0aGlzLl9yZWNlbnRCdWlsZHMgPSBidWlsZHM7CiAgICAgICAgdGhpcy5fdXBkYXRlVVJMUHJvbXB0KCk7CiAgICB9LAoKICAgIF9kaWRQYXJzZUxlYWtzRmlsZTogZnVuY3Rpb24ocHJvZmlsZSkgewogICAgICAgIGlmICgtLXRoaXMuZmlsZXNMZWZ0VG9QYXJzZSkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIFByb2ZpbGVyQWdlbnQucHJvZmlsZVJlYWR5KHByb2ZpbGUpOwogICAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlOwogICAgfSwKCiAgICBfZGlzcGxheVVSTFByb21wdDogZnVuY3Rpb24oKSB7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInVybC1wcm9tcHQtY29udGFpbmVyIikucmVtb3ZlU3R5bGVDbGFzcygiaGlkZGVuIik7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInVybCIpLmZvY3VzKCk7CiAgICAgICAgdmFyIGxvYWRlciA9IG5ldyBSZWNlbnRCdWlsZHNMb2FkZXIodGhpcy5fZGlkTG9hZFJlY2VudEJ1aWxkcy5iaW5kKHRoaXMpKTsKICAgICAgICBsb2FkZXIuc3RhcnQoIkxpb24gTGVha3MiLCB0aGlzLl9udW1iZXJPZlJlY2VudEJ1aWxkc1RvTG9hZCk7CiAgICB9LAoKICAgIF9sb2FkTGVha3NGcm9tVVJMOiBmdW5jdGlvbih1cmwpIHsKICAgICAgICB0aGlzLnVybCA9IHVybDsKICAgICAgICB0aGlzLmxvYWRpbmcgPSB0cnVlOwoKICAgICAgICB0aGlzLl9sb2FkZXIuc3RhcnQodGhpcy51cmwpOwogICAgfSwKCiAgICBfbG9hZGluZ0luZGljYXRvclRleHQ6IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciB0ZXh0ID0gIkxvYWRpbmciOwogICAgICAgIGlmICh0aGlzLmZpbGVzTGVmdFRvUGFyc2UpCiAgICAgICAgICAgIHRleHQgKz0gIiAiICsgKHRoaXMuX2ZpbGVDb3VudCAtIHRoaXMuZmlsZXNMZWZ0VG9QYXJzZSArIDEpICsgIi8iICsgdGhpcy5fZmlsZUNvdW50ICsgIiBmaWxlcyI7CiAgICAgICAgdGV4dCArPSAiXHUyMDI2IjsKICAgICAgICByZXR1cm4gdGV4dDsKICAgIH0sCgogICAgX2xvYWRpbmdTdGF0dXNDaGFuZ2VkOiBmdW5jdGlvbigpIHsKICAgICAgICB0aGlzLl9zZXRMb2FkaW5nSW5kaWNhdG9ySGlkZGVuKCF0aGlzLmxvYWRpbmcpOwogICAgICAgIHRoaXMuX3VwZGF0ZUxvYWRpbmdJbmRpY2F0b3JMYWJlbCgpOwogICAgICAgIHRoaXMuX3VwZGF0ZVRpdGxlKCk7CiAgICB9LAoKICAgIF9udW1iZXJPZlJlY2VudEJ1aWxkc1RvTG9hZDogMTAsCgogICAgX3NldExvYWRpbmdJbmRpY2F0b3JIaWRkZW46IGZ1bmN0aW9uKGhpZGRlbikgewogICAgICAgIGlmIChoaWRkZW4pCiAgICAgICAgICAgIHRoaXMuX2xvYWRpbmdJbmRpY2F0b3IuYWRkU3R5bGVDbGFzcygiaGlkZGVuIik7CiAgICAgICAgZWxzZQogICAgICAgICAgICB0aGlzLl9sb2FkaW5nSW5kaWNhdG9yLnJlbW92ZVN0eWxlQ2xhc3MoImhpZGRlbiIpOwogICAgfSwKCiAgICBfdXBkYXRlTG9hZGluZ0luZGljYXRvckxhYmVsOiBmdW5jdGlvbigpIHsKICAgICAgICB0aGlzLl9sb2FkaW5nSW5kaWNhdG9yTGFiZWwuaW5uZXJUZXh0ID0gdGhpcy5fbG9hZGluZ0luZGljYXRvclRleHQoKTsKICAgIH0sCgogICAgX3VwZGF0ZVRpdGxlOiBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgdGl0bGUgPSAiTGVha3MgVmlld2VyIFx1MjAxNCAiOwogICAgICAgIGlmICh0aGlzLmxvYWRpbmcpCiAgICAgICAgICAgIHRpdGxlICs9ICIoIiArIHRoaXMuX2xvYWRpbmdJbmRpY2F0b3JUZXh0KCkgKyAiKSAiOwogICAgICAgIHRpdGxlICs9IHRoaXMudXJsOwogICAgICAgIGRvY3VtZW50LnRpdGxlID0gdGl0bGU7CiAgICB9LAoKICAgIF91cGRhdGVVUkxQcm9tcHQ6IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciByZWNlbnRCdWlsZHNDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicmVjZW50LWJ1aWxkcy1jb250YWluZXIiKTsKICAgICAgICByZWNlbnRCdWlsZHNDb250YWluZXIucmVtb3ZlQ2hpbGRyZW4oKTsKICAgICAgICBpZiAodGhpcy5fcmVjZW50QnVpbGRzICYmIHRoaXMuX3JlY2VudEJ1aWxkcy5sZW5ndGgpIHsKICAgICAgICAgICAgdmFyIGxpc3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJvbCIpOwogICAgICAgICAgICBsaXN0LmlkID0gInJlY2VudC1idWlsZHMtbGlzdCI7CgogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHRoaXMuX3JlY2VudEJ1aWxkcy5mb3JFYWNoKGZ1bmN0aW9uKGJ1aWxkKSB7CiAgICAgICAgICAgICAgICB2YXIgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImEiKTsKICAgICAgICAgICAgICAgIGxpbmsuaHJlZiA9IGRvY3VtZW50LmxvY2F0aW9uLmhyZWYgKyAiP3VybD0iICsgZW5jb2RlVVJJQ29tcG9uZW50KGJ1aWxkLnVybCk7CiAgICAgICAgICAgICAgICBsaW5rLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgICAgIHNlbGYuX3VybENob3NlbkZyb21Qcm9tcHQoYnVpbGQudXJsKTsKICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGxpbmsuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoInIiICsgYnVpbGQucmV2aXNpb24gKyAiOiAiICsgYnVpbGQubGVha0NvdW50ICsgIiBsZWFrcyIpKTsKICAgICAgICAgICAgICAgIHZhciBpdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgibGkiKTsKICAgICAgICAgICAgICAgIGl0ZW0uYXBwZW5kQ2hpbGQobGluayk7CgogICAgICAgICAgICAgICAgbGlzdC5hcHBlbmRDaGlsZChpdGVtKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICByZWNlbnRCdWlsZHNDb250YWluZXIuYXBwZW5kQ2hpbGQobGlzdCk7CiAgICAgICAgfSBlbHNlCiAgICAgICAgICAgIHJlY2VudEJ1aWxkc0NvbnRhaW5lci5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgiTm8gcmVjZW50IGxlYWt5IGJ1aWxkcyBmb3VuZC4iKSk7CiAgICB9LAoKICAgIF91cmxDaG9zZW5Gcm9tUHJvbXB0OiBmdW5jdGlvbih1cmwpIHsKICAgICAgICB0aGlzLl9sb2FkTGVha3NGcm9tVVJMKHVybCk7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInVybC1wcm9tcHQtY29udGFpbmVyIikuYWRkU3R5bGVDbGFzcygiaGlkZGVuIik7CiAgICB9LAoKfTsKCmFkZEV2ZW50TGlzdGVuZXIoImxvYWQiLCBMZWFrc1ZpZXdlci5sb2FkZWQuYmluZChMZWFrc1ZpZXdlcikpOwo=",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Fri, 07 Nov 2014 21:50:00 GMT",
                    "Content-Length": "7022",
                    "Date": "Fri, 07 Nov 2014 21:51:11 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}