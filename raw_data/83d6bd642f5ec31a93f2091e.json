{
    "url": "http://localhost:9999/kogmbh/WebODF/programs/editor/pullboxeditor.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "DOM data manipulation (DOM-based)",
    "issueType": 5247488,
    "severity": "Information",
    "confidence": "Firm",
    "issueBackground": "DOM-based DOM data manipulation vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this to a data field within the DOM that is used within the visible UI or client-side application logic. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will modify the appearance or behavior of the client-side UI. An attacker may be able to leverage this to perform virtual defacement of the application, or possibly to induce the user to perform unintended actions.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based DOM data manipulation vulnerabilities is not to dynamically write to DOM data fields any data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from being stored. In general, this is best achieved by using a whitelist of permitted values.",
    "issueDetail": "The application may be vulnerable to DOM-based DOM data manipulation. Data is read from <b>location</b> and written to <b>history.replaceState()</b> via the following statements:<ul><li>location = location + '#' + sessionId;</li><li>location = location.substr(0, pos);</li><li>history.replaceState( {}, \"\", location);</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/kogmbh/WebODF/programs/editor/pullboxeditor.js",
                "path": "/kogmbh/WebODF/programs/editor/pullboxeditor.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9rb2dtYmgvV2ViT0RGL3Byb2dyYW1zL2VkaXRvci9wdWxsYm94ZWRpdG9yLmpzIEhUVFAvMS4xDQpIb3N0OiBsb2NhbGhvc3Q6OTk5OQ0KDQo=",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogOTQxNg0KQWNjZXB0LVJhbmdlczogYnl0ZXMNCkNvbnRlbnQtVHlwZTogYXBwbGljYXRpb24vamF2YXNjcmlwdA0KRGF0ZTogU3VuLCAwOSBOb3YgMjAxNCAwMjozOTo1NiBHTVQNCkxhc3QtTW9kaWZpZWQ6IFN1biwgMDkgTm92IDIwMTQgMDI6Mzk6NTUgR01UDQoNCi8qKgogKiBDb3B5cmlnaHQgKEMpIDIwMTQgS08gR21iSCA8Y29weXJpZ2h0QGtvZ21iaC5jb20+CiAqCiAqIEBsaWNzdGFydAogKiBUaGlzIGZpbGUgaXMgcGFydCBvZiBXZWJPREYuCiAqCiAqIFdlYk9ERiBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5IGl0CiAqIHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIChHTlUgQUdQTCkKICogYXMgcHVibGlzaGVkIGJ5IHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YKICogdGhlIExpY2Vuc2UsIG9yIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uCiAqCiAqIFdlYk9ERiBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLCBidXQKICogV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZgogKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlCiAqIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgogKgogKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2UKICogYWxvbmcgd2l0aCBXZWJPREYuICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uCiAqIEBsaWNlbmQKICoKICogQHNvdXJjZTogaHR0cDovL3d3dy53ZWJvZGYub3JnLwogKiBAc291cmNlOiBodHRwczovL2dpdGh1Yi5jb20va29nbWJoL1dlYk9ERi8KICovCgpmdW5jdGlvbiBjcmVhdGVFZGl0b3IoKSB7CiAgICAidXNlIHN0cmljdCI7CgogICAgdmFyIGVkaXRvciA9IG51bGwsCiAgICAgICAgc2VydmVyRmFjdG9yeSA9IG51bGwsCiAgICAgICAgc2VydmVyID0gbnVsbCwKICAgICAgICBlZGl0b3JPcHRpb25zID0gewogICAgICAgICAgICBhbGxGZWF0dXJlc0VuYWJsZWQ6IHRydWUsCiAgICAgICAgICAgIGNvbGxhYkVkaXRpbmdFbmFibGVkOiB0cnVlCiAgICAgICAgfSwKICAgICAgICBjdXJyZW50UGFnZUlkID0gbnVsbCwKICAgICAgICBzYXZpbmdPdmVybGF5LCBkaXNjb25uZWN0ZWRPdmVybGF5LCBoYXNMb2NhbFVuc3luY2VkT3BzT3ZlcmxheSwKICAgICAgICBzZXNzaW9uTGlzdCwKICAgICAgICB1c2VySWQsIHRva2VuLAogICAgICAgIGN1cnJlbnRTZXNzaW9uSWQsIGN1cnJlbnRNZW1iZXJJZDsKCiAgICAvLyBUT0RPOiBqdXN0IHNvbWUgcXVpY2sgaGFjayBkb25lIGZvciB0ZXN0aW5nLCBtYWtlIG5pY2UgKGUuZy4gdGhlIHBvc2l0aW9uIGNhbGN1bGF0aW9uIGlzIGZyYWdpbGUpCiAgICBmdW5jdGlvbiBhZGRTdGF0dXNPdmVybGF5KHBhcmVudEVsZW1lbnQsIHN5bWJvbEZpbGVOYW1lLCBwb3NpdGlvbikgewogICAgICAgIHZhciBodG1sbnMgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQubmFtZXNwYWNlVVJJLAogICAgICAgICAgICBpbWFnZUVsZW1lbnQsIG92ZXJsYXk7CgogICAgICAgIHJ1bnRpbWUuYXNzZXJ0KHBhcmVudEVsZW1lbnQsICJoZXlhLCBubyBzdWNoIHBhcmVudGVsZW1lbnQiKTsKCiAgICAgICAgb3ZlcmxheSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhodG1sbnMsICJkaXYiKTsKICAgICAgICBpbWFnZUVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoaHRtbG5zLCAiaW1nIik7CiAgICAgICAgaW1hZ2VFbGVtZW50LnNyYyA9IHN5bWJvbEZpbGVOYW1lOwogICAgICAgIG92ZXJsYXkuYXBwZW5kQ2hpbGQoaW1hZ2VFbGVtZW50KTsKICAgICAgICBvdmVybGF5LnN0eWxlLnBvc2l0aW9uID0gImFic29sdXRlIjsKICAgICAgICBvdmVybGF5LnN0eWxlLnRvcCA9ICAyNCpwb3NpdGlvbiArICJweCI7CiAgICAgICAgb3ZlcmxheS5zdHlsZS5vcGFjaXR5ID0gIjAuOCI7CiAgICAgICAgb3ZlcmxheS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICAgIHBhcmVudEVsZW1lbnQuYXBwZW5kQ2hpbGQob3ZlcmxheSk7CiAgICAgICAgcmV0dXJuIG92ZXJsYXk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTd2l0Y2hlcyB0aGUgcGFnZXMgYnkgaGlkaW5nIHRoZSBvbGQgb25lIGFuZCB1bmhpZGluZyB0aGUgbmV3CiAgICAgKiBAcGFyYW0geyFzdHJpbmd9IHBhZ2VJZAogICAgICogQHJldHVybiB7dW5kZWZpbmVkfQogICAgICovCiAgICBmdW5jdGlvbiBzd2l0Y2hUb1BhZ2UocGFnZUlkKSB7CiAgICAgICAgaWYgKGN1cnJlbnRQYWdlSWQpIHsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY3VycmVudFBhZ2VJZCkuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICAgICAgICB9CiAgICAgICAgY3VycmVudFBhZ2VJZCA9IHBhZ2VJZDsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChwYWdlSWQpLnN0eWxlLmRpc3BsYXkgPSAiIjsKICAgIH0KCiAgICAvKioKICAgICAqIEBwYXJhbSB7IXN0cmluZ30KICAgICAqIEByZXR1cm4ge3VuZGVmaW5lZH0KICAgICAqLwogICAgZnVuY3Rpb24gdXBkYXRlTG9jYXRpb25XaXRoU2Vzc2lvbklkKHNlc3Npb25JZCkgewogICAgICAgIHZhciBsb2NhdGlvbiA9IFN0cmluZyhkb2N1bWVudC5sb2NhdGlvbiksCiAgICAgICAgICAgIHBvcyA9IGxvY2F0aW9uLmluZGV4T2YoJyMnKTsKICAgICAgICBpZiAocG9zICE9IC0xKSB7CiAgICAgICAgICAgIGxvY2F0aW9uID0gbG9jYXRpb24uc3Vic3RyKDAsIHBvcyk7CiAgICAgICAgfQogICAgICAgIGlmIChzZXNzaW9uSWQpIHsKICAgICAgICAgICAgbG9jYXRpb24gPSBsb2NhdGlvbiArICcjJyArIHNlc3Npb25JZDsKICAgICAgICB9CiAgICAgICAgaGlzdG9yeS5yZXBsYWNlU3RhdGUoIHt9LCAiIiwgbG9jYXRpb24pOwogICAgfQoKICAgIC8qKgogICAgICogQHJldHVybiB7dW5kZWZpbmVkfQogICAgICovCiAgICBmdW5jdGlvbiBvbkVkaXRpbmdTdGFydGVkKCkgewogICAgICAgIC8vIG5vdGhpbmcgdG8gZG8gcmlnaHQgbm93CiAgICB9CgogICAgLyoqCiAgICAgKiBAcGFyYW0geyFib29sZWFuPX0gaWdub3JlRXJyb3IKICAgICAqIEByZXR1cm4ge3VuZGVmaW5lZH0KICAgICAqLwogICAgZnVuY3Rpb24gY2xvc2VFZGl0aW5nKGlnbm9yZUVycm9yKSB7CiAgICAgICAgZWRpdG9yLmxlYXZlU2Vzc2lvbihmdW5jdGlvbigpIHsKICAgICAgICAgICAgc2VydmVyLmxlYXZlU2Vzc2lvbihjdXJyZW50U2Vzc2lvbklkLCBjdXJyZW50TWVtYmVySWQsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgc2hvd1Nlc3Npb25zKCk7CiAgICAgICAgICAgIH0sIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgaWYgKGlnbm9yZUVycm9yKSB7CiAgICAgICAgICAgICAgICAgICAgc2hvd1Nlc3Npb25zKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBUT0RPOiBlbHNlIHJlcG9ydCBwcm9ibGVtCiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgfQoKICAgIC8qKgogICAgICogQHJldHVybiB7dW5kZWZpbmVkfQogICAgICovCiAgICBmdW5jdGlvbiBoYW5kbGVFZGl0aW5nRXJyb3IoZXJyb3IpIHsKICAgICAgICBhbGVydCgiU29tZXRoaW5nIHdlbnQgd3Jvbmc6XG4iK2Vycm9yKTsKICAgICAgICBjbG9zZUVkaXRpbmcodHJ1ZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAcmV0dXJuIHt1bmRlZmluZWR9CiAgICAgKi8KICAgIGZ1bmN0aW9uIHNob3dTZXNzaW9ucygpIHsKICAgICAgICBzd2l0Y2hUb1BhZ2UoInNlc3Npb25MaXN0Q29udGFpbmVyIik7CgogICAgICAgIHNlc3Npb25MaXN0LnNldFVwZGF0ZXNFbmFibGVkKHRydWUpOwoKICAgICAgICB1cGRhdGVMb2NhdGlvbldpdGhTZXNzaW9uSWQoIiIpOwogICAgfQoKICAgIC8qKgogICAgICogQHBhcmFtIHshc3RyaW5nfSBzZXNzaW9uSWQKICAgICAqIEByZXR1cm4ge3VuZGVmaW5lZH0KICAgICAqLwogICAgZnVuY3Rpb24gam9pblNlc3Npb24oc2Vzc2lvbklkKSB7CiAgICAgICAgc3dpdGNoVG9QYWdlKCJlZGl0b3JDb250YWluZXIiKTsKCiAgICAgICAgc2Vzc2lvbkxpc3Quc2V0VXBkYXRlc0VuYWJsZWQoZmFsc2UpOwoKICAgICAgICB1cGRhdGVMb2NhdGlvbldpdGhTZXNzaW9uSWQoc2Vzc2lvbklkKTsKCiAgICAgICAgY3VycmVudFNlc3Npb25JZCA9IHNlc3Npb25JZDsKICAgICAgICBzZXJ2ZXIuam9pblNlc3Npb24odXNlcklkLCBzZXNzaW9uSWQsIGZ1bmN0aW9uKG1lbWJlcklkKSB7CiAgICAgICAgICAgIGN1cnJlbnRNZW1iZXJJZCA9IG1lbWJlcklkOwoKICAgICAgICAgICAgaWYgKCFlZGl0b3IpIHsKICAgICAgICAgICAgICAgIGVkaXRvck9wdGlvbnMubmV0d29ya1NlY3VyaXR5VG9rZW4gPSB0b2tlbjsKICAgICAgICAgICAgICAgIGVkaXRvck9wdGlvbnMuY2xvc2VDYWxsYmFjayA9IGNsb3NlRWRpdGluZzsKICAgICAgICAgICAgICAgIFdvZG8uY3JlYXRlQ29sbGFiVGV4dEVkaXRvcignZWRpdG9yQ29udGFpbmVyJywgZWRpdG9yT3B0aW9ucywgZnVuY3Rpb24oZXJyLCBlKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGNhbnZhc0NvbnRhaW5lckVsZW1lbnQ7CgogICAgICAgICAgICAgICAgICAgIGVkaXRvciA9IGU7CgogICAgICAgICAgICAgICAgICAgIGNhbnZhc0NvbnRhaW5lckVsZW1lbnQgPSBlZGl0b3IuZ2V0Q2FudmFzQ29udGFpbmVyRWxlbWVudCgpOwogICAgICAgICAgICAgICAgICAgIHNhdmluZ092ZXJsYXkgPSBhZGRTdGF0dXNPdmVybGF5KGNhbnZhc0NvbnRhaW5lckVsZW1lbnQsICJkb2N1bWVudC1zYXZlLnBuZyIsIDApOwogICAgICAgICAgICAgICAgICAgIGhhc0xvY2FsVW5zeW5jZWRPcHNPdmVybGF5ID0gYWRkU3RhdHVzT3ZlcmxheShjYW52YXNDb250YWluZXJFbGVtZW50LCAidmNzLWxvY2FsbHktbW9kaWZpZWQucG5nIiwgMCk7CiAgICAgICAgICAgICAgICAgICAgZGlzY29ubmVjdGVkT3ZlcmxheSA9IGFkZFN0YXR1c092ZXJsYXkoY2FudmFzQ29udGFpbmVyRWxlbWVudCwgIm5ldHdvcmstZGlzY29ubmVjdC5wbmciLCAxKTsKCiAgICAgICAgICAgICAgICAgICAgZWRpdG9yLmFkZEV2ZW50TGlzdGVuZXIoV29kby5FVkVOVF9CRUZPUkVTQVZFVE9GSUxFLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2F2aW5nT3ZlcmxheS5zdHlsZS5kaXNwbGF5ID0gIiI7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgZWRpdG9yLmFkZEV2ZW50TGlzdGVuZXIoV29kby5FVkVOVF9TQVZFRFRPRklMRSwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNhdmluZ092ZXJsYXkuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBlZGl0b3IuYWRkRXZlbnRMaXN0ZW5lcihXb2RvLkVWRU5UX0hBU0xPQ0FMVU5TWU5DRURPUEVSQVRJT05TQ0hBTkdFRCwgZnVuY3Rpb24oaGFzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGhhc0xvY2FsVW5zeW5jZWRPcHNPdmVybGF5LnN0eWxlLmRpc3BsYXkgPSBoYXMgPyAiIiA6ICJub25lIjsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBlZGl0b3IuYWRkRXZlbnRMaXN0ZW5lcihXb2RvLkVWRU5UX0hBU1NFU1NJT05IT1NUQ09OTkVDVElPTkNIQU5HRUQsIGZ1bmN0aW9uKGhhcykgewogICAgICAgICAgICAgICAgICAgICAgICBkaXNjb25uZWN0ZWRPdmVybGF5LnN0eWxlLmRpc3BsYXkgPSBoYXMgPyAibm9uZSIgOiAiIjsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBlZGl0b3IuYWRkRXZlbnRMaXN0ZW5lcihXb2RvLkVWRU5UX1VOS05PV05FUlJPUiwgaGFuZGxlRWRpdGluZ0Vycm9yKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gbG9hZCB0aGUgZG9jdW1lbnQgYW5kIGdldCBjYWxsZWQgYmFjayB3aGVuIGl0J3MgbGl2ZQogICAgICAgICAgICAgICAgICAgIGVkaXRvci5qb2luU2Vzc2lvbihzZXJ2ZXJGYWN0b3J5LmNyZWF0ZVNlc3Npb25CYWNrZW5kKHNlc3Npb25JZCwgbWVtYmVySWQsIHNlcnZlciksIG9uRWRpdGluZ1N0YXJ0ZWQpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBlZGl0b3Iuam9pblNlc3Npb24oc2VydmVyRmFjdG9yeS5jcmVhdGVTZXNzaW9uQmFja2VuZChzZXNzaW9uSWQsIG1lbWJlcklkLCBzZXJ2ZXIpLCBvbkVkaXRpbmdTdGFydGVkKTsKICAgICAgICAgICAgfQogICAgICAgIH0sIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAvLyBUT0RPOiBoYW5kbGUgZXJyb3IKICAgICAgICB9KTsKICAgIH0KCiAgICAvKioKICAgICAqIGV4dHJhY3Qgc2Vzc2lvbiBpZCBmcm9tIHRoZSB1cmwtZnJhZ21lbnQKICAgICAqCiAgICAgKiBAcmV0dXJuIHs/c3RyaW5nfQogICAgICovCiAgICBmdW5jdGlvbiBleHRyYWN0U2Vzc2lvbklkKCkgewogICAgICAgIHZhciBzZXNzaW9uSWQgPSBTdHJpbmcoZG9jdW1lbnQubG9jYXRpb24pLAogICAgICAgICAgICBwb3MgPSBzZXNzaW9uSWQuaW5kZXhPZignIycpOwogICAgICAgIHJldHVybiAocG9zICE9PSAtMSkgPyBzZXNzaW9uSWQuc3Vic3RyKHBvcyArIDEpIDogbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIHN0YXJ0IHRoZSBsb2dpbiBwcm9jZXNzIGJ5IG9mZmVyaW5nIGEgbG9naW4vcGFzc3dvcmQgcHJvbXB0LgogICAgICogb24gc3VjY2VzcyBhIGxpc3Qgb2Ygc2Vzc2lvbnMgaXMgb2ZmZXJlZC4KICAgICAqIHdoZW4gdGhlIHVzZXIgc2VsZWN0cyBhIHNlc3Npb24gdGhlIGNhbGxiYWNrIGlzIGNhbGxlZAogICAgICogd2l0aCB0aGUgc2Vzc2lvbklkIGFzIHBhcmFtZXRlcgogICAgICoKICAgICAqIEBwYXJhbSB7IWZ1bmN0aW9uKCFzdHJpbmcsICFzdHJpbmcsID9zdHJpbmcpfSBjYWxsYmFjawogICAgICogQHJldHVybiB7dW5kZWZpbmVkfQogICAgICovCiAgICBmdW5jdGlvbiBzdGFydExvZ2luUHJvY2VzcyhjYWxsYmFjaykgewogICAgICAgIHJ1bnRpbWUuYXNzZXJ0KGVkaXRvciA9PT0gbnVsbCwgImNhbm5vdCBib290IHdpdGggaW5zdGFudGlhdGVkIGVkaXRvciIpOwoKICAgICAgICBmdW5jdGlvbiBsb2dpblN1Y2Nlc3ModXNlckRhdGEpIHsKICAgICAgICAgICAgcmVxdWlyZShbIndlYm9kZi9lZGl0b3IvU2Vzc2lvbkxpc3RWaWV3Il0sCiAgICAgICAgICAgICAgICBmdW5jdGlvbiAoU2Vzc2lvbkxpc3RWaWV3KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHNlc3Npb25MaXN0RGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInNlc3Npb25MaXN0IiksCiAgICAgICAgICAgICAgICAgICAgICAgIHNlc3Npb25JZCA9IGV4dHJhY3RTZXNzaW9uSWQoKSwKICAgICAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbkxpc3RWaWV3OwoKICAgICAgICAgICAgICAgICAgICBydW50aW1lLmxvZygiY29ubmVjdGVkOiIgKyB1c2VyRGF0YS5mdWxsX25hbWUpOwogICAgICAgICAgICAgICAgICAgIHVzZXJJZCA9IHVzZXJEYXRhLnVpZDsKICAgICAgICAgICAgICAgICAgICB0b2tlbiA9IHVzZXJEYXRhLnNlY3VyaXR5VG9rZW4gfHwgbnVsbDsKCiAgICAgICAgICAgICAgICAgICAgLy8gYWRkIHNlc3Npb24gbGlzdGluZwogICAgICAgICAgICAgICAgICAgIHNlc3Npb25MaXN0ID0gbmV3IHNlcnZlckZhY3RvcnkuY3JlYXRlU2Vzc2lvbkxpc3Qoc2VydmVyKTsKICAgICAgICAgICAgICAgICAgICBzZXNzaW9uTGlzdFZpZXcgPSBuZXcgU2Vzc2lvbkxpc3RWaWV3KHNlc3Npb25MaXN0LCBzZXNzaW9uTGlzdERpdiwgam9pblNlc3Npb24pOwoKICAgICAgICAgICAgICAgICAgICBpZiAoc2Vzc2lvbklkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRPRE86IGNoZWNrIGlmIHNlc3Npb24gZXhpc3RzCiAgICAgICAgICAgICAgICAgICAgICAgIGpvaW5TZXNzaW9uKHNlc3Npb25JZCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoVG9QYWdlKCJzZXNzaW9uTGlzdENvbnRhaW5lciIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGxvZ2luRmFpbChyZXN1bHQpIHsKICAgICAgICAgICAgYWxlcnQoIkxvZ2luIGZhaWxlZDogIiArIHJlc3VsdCk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBAcmV0dXJuIHshYm9vbGVhbn0KICAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiBvbkxvZ2luU3VibWl0KCkgewogICAgICAgICAgICBzZXJ2ZXIubG9naW4oZG9jdW1lbnQubG9naW5Gb3JtLmxvZ2luLnZhbHVlLCBkb2N1bWVudC5sb2dpbkZvcm0ucGFzc3dvcmQudmFsdWUsIGxvZ2luU3VjY2VzcywgbG9naW5GYWlsKTsKCiAgICAgICAgICAgIC8vIGJsb2NrIHRoZSBzdWJtaXQgYnV0dG9uLCB3ZSBhbHJlYWR5IGRlYWx0IHdpdGggdGhlIGlucHV0CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIC8vIGJyaW5nIHVwIHRoZSBsb2dpbiBmb3JtCiAgICAgICAgZG9jdW1lbnQubG9naW5Gb3JtLlN1Ym1pdC5vbmNsaWNrID0gb25Mb2dpblN1Ym1pdDsKICAgICAgICBzd2l0Y2hUb1BhZ2UoImxvZ2luQ29udGFpbmVyIik7CiAgICAgICAgZG9jdW1lbnQubG9naW5Gb3JtLmxvZ2luLmZvY3VzKCk7CiAgICB9CgogICAgLy8gc3RhcnQgdGhlIGVkaXRvciB3aXRoIG5ldHdvcmsKICAgIHJ1bnRpbWUubG9nKCJzdGFydGluZyBjb2xsYWJvcmF0aXZlIGVkaXRvciBmb3IgW3B1bGxib3hdLiIpOwogICAgcmVxdWlyZShbIndlYm9kZi9lZGl0b3IvYmFja2VuZC9wdWxsYm94L1NlcnZlckZhY3RvcnkiXSwgZnVuY3Rpb24gKFNlcnZlckZhY3RvcnkpIHsKICAgICAgICBzZXJ2ZXJGYWN0b3J5ID0gbmV3IFNlcnZlckZhY3RvcnkoKTsKICAgICAgICBzZXJ2ZXIgPSBzZXJ2ZXJGYWN0b3J5LmNyZWF0ZVNlcnZlcigpOwogICAgICAgIC8vIHdhaXQgZm9yIGEgbmV0d29yayBjb25uZWN0aW9uIHRvIGVzdGFibGlzaC4KICAgICAgICAvLyBjYWxsIHRoZSBjYWxsYmFjayB3aGVuIGRvbmUsIHdoZW4gZmluYWxseSBmYWlsZWQsIG9yCiAgICAgICAgLy8gd2hlbiBhIHRpbWVvdXQgcmVhY2hlZC4KICAgICAgICAvLyB0aGUgcGFyYW1ldGVyIHRvIHRoZSBjYWxsYmFjayBpcyBhIHN0cmluZyB3aXRoIHRoZSBwb3NzaWJsZQogICAgICAgIC8vIHZhbHVlczogInVuYXZhaWxhYmxlIiwgInRpbWVvdXQiLCAicmVhZHkiCiAgICAgICAgc2VydmVyLmNvbm5lY3QoODAwMCwgZnVuY3Rpb24gKHN0YXRlKSB7CiAgICAgICAgICAgIGlmIChzdGF0ZSA9PT0gInJlYWR5IikgewogICAgICAgICAgICAgICAgc3RhcnRMb2dpblByb2Nlc3MoKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfSk7Cn0K",
                "body": "LyoqCiAqIENvcHlyaWdodCAoQykgMjAxNCBLTyBHbWJIIDxjb3B5cmlnaHRAa29nbWJoLmNvbT4KICoKICogQGxpY3N0YXJ0CiAqIFRoaXMgZmlsZSBpcyBwYXJ0IG9mIFdlYk9ERi4KICoKICogV2ViT0RGIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkgaXQKICogdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgKEdOVSBBR1BMKQogKiBhcyBwdWJsaXNoZWQgYnkgdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZgogKiB0aGUgTGljZW5zZSwgb3IgKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4KICoKICogV2ViT0RGIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsIGJ1dAogKiBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCiAqIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGUKICogR05VIEFmZmVybyBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuCiAqCiAqIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBBZmZlcm8gR2VuZXJhbCBQdWJsaWMgTGljZW5zZQogKiBhbG9uZyB3aXRoIFdlYk9ERi4gIElmIG5vdCwgc2VlIDxodHRwOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi4KICogQGxpY2VuZAogKgogKiBAc291cmNlOiBodHRwOi8vd3d3LndlYm9kZi5vcmcvCiAqIEBzb3VyY2U6IGh0dHBzOi8vZ2l0aHViLmNvbS9rb2dtYmgvV2ViT0RGLwogKi8KCmZ1bmN0aW9uIGNyZWF0ZUVkaXRvcigpIHsKICAgICJ1c2Ugc3RyaWN0IjsKCiAgICB2YXIgZWRpdG9yID0gbnVsbCwKICAgICAgICBzZXJ2ZXJGYWN0b3J5ID0gbnVsbCwKICAgICAgICBzZXJ2ZXIgPSBudWxsLAogICAgICAgIGVkaXRvck9wdGlvbnMgPSB7CiAgICAgICAgICAgIGFsbEZlYXR1cmVzRW5hYmxlZDogdHJ1ZSwKICAgICAgICAgICAgY29sbGFiRWRpdGluZ0VuYWJsZWQ6IHRydWUKICAgICAgICB9LAogICAgICAgIGN1cnJlbnRQYWdlSWQgPSBudWxsLAogICAgICAgIHNhdmluZ092ZXJsYXksIGRpc2Nvbm5lY3RlZE92ZXJsYXksIGhhc0xvY2FsVW5zeW5jZWRPcHNPdmVybGF5LAogICAgICAgIHNlc3Npb25MaXN0LAogICAgICAgIHVzZXJJZCwgdG9rZW4sCiAgICAgICAgY3VycmVudFNlc3Npb25JZCwgY3VycmVudE1lbWJlcklkOwoKICAgIC8vIFRPRE86IGp1c3Qgc29tZSBxdWljayBoYWNrIGRvbmUgZm9yIHRlc3RpbmcsIG1ha2UgbmljZSAoZS5nLiB0aGUgcG9zaXRpb24gY2FsY3VsYXRpb24gaXMgZnJhZ2lsZSkKICAgIGZ1bmN0aW9uIGFkZFN0YXR1c092ZXJsYXkocGFyZW50RWxlbWVudCwgc3ltYm9sRmlsZU5hbWUsIHBvc2l0aW9uKSB7CiAgICAgICAgdmFyIGh0bWxucyA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5uYW1lc3BhY2VVUkksCiAgICAgICAgICAgIGltYWdlRWxlbWVudCwgb3ZlcmxheTsKCiAgICAgICAgcnVudGltZS5hc3NlcnQocGFyZW50RWxlbWVudCwgImhleWEsIG5vIHN1Y2ggcGFyZW50ZWxlbWVudCIpOwoKICAgICAgICBvdmVybGF5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKGh0bWxucywgImRpdiIpOwogICAgICAgIGltYWdlRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhodG1sbnMsICJpbWciKTsKICAgICAgICBpbWFnZUVsZW1lbnQuc3JjID0gc3ltYm9sRmlsZU5hbWU7CiAgICAgICAgb3ZlcmxheS5hcHBlbmRDaGlsZChpbWFnZUVsZW1lbnQpOwogICAgICAgIG92ZXJsYXkuc3R5bGUucG9zaXRpb24gPSAiYWJzb2x1dGUiOwogICAgICAgIG92ZXJsYXkuc3R5bGUudG9wID0gIDI0KnBvc2l0aW9uICsgInB4IjsKICAgICAgICBvdmVybGF5LnN0eWxlLm9wYWNpdHkgPSAiMC44IjsKICAgICAgICBvdmVybGF5LnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgICAgICAgcGFyZW50RWxlbWVudC5hcHBlbmRDaGlsZChvdmVybGF5KTsKICAgICAgICByZXR1cm4gb3ZlcmxheTsKICAgIH0KCiAgICAvKioKICAgICAqIFN3aXRjaGVzIHRoZSBwYWdlcyBieSBoaWRpbmcgdGhlIG9sZCBvbmUgYW5kIHVuaGlkaW5nIHRoZSBuZXcKICAgICAqIEBwYXJhbSB7IXN0cmluZ30gcGFnZUlkCiAgICAgKiBAcmV0dXJuIHt1bmRlZmluZWR9CiAgICAgKi8KICAgIGZ1bmN0aW9uIHN3aXRjaFRvUGFnZShwYWdlSWQpIHsKICAgICAgICBpZiAoY3VycmVudFBhZ2VJZCkgewogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjdXJyZW50UGFnZUlkKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICAgIH0KICAgICAgICBjdXJyZW50UGFnZUlkID0gcGFnZUlkOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHBhZ2VJZCkuc3R5bGUuZGlzcGxheSA9ICIiOwogICAgfQoKICAgIC8qKgogICAgICogQHBhcmFtIHshc3RyaW5nfQogICAgICogQHJldHVybiB7dW5kZWZpbmVkfQogICAgICovCiAgICBmdW5jdGlvbiB1cGRhdGVMb2NhdGlvbldpdGhTZXNzaW9uSWQoc2Vzc2lvbklkKSB7CiAgICAgICAgdmFyIGxvY2F0aW9uID0gU3RyaW5nKGRvY3VtZW50LmxvY2F0aW9uKSwKICAgICAgICAgICAgcG9zID0gbG9jYXRpb24uaW5kZXhPZignIycpOwogICAgICAgIGlmIChwb3MgIT0gLTEpIHsKICAgICAgICAgICAgbG9jYXRpb24gPSBsb2NhdGlvbi5zdWJzdHIoMCwgcG9zKTsKICAgICAgICB9CiAgICAgICAgaWYgKHNlc3Npb25JZCkgewogICAgICAgICAgICBsb2NhdGlvbiA9IGxvY2F0aW9uICsgJyMnICsgc2Vzc2lvbklkOwogICAgICAgIH0KICAgICAgICBoaXN0b3J5LnJlcGxhY2VTdGF0ZSgge30sICIiLCBsb2NhdGlvbik7CiAgICB9CgogICAgLyoqCiAgICAgKiBAcmV0dXJuIHt1bmRlZmluZWR9CiAgICAgKi8KICAgIGZ1bmN0aW9uIG9uRWRpdGluZ1N0YXJ0ZWQoKSB7CiAgICAgICAgLy8gbm90aGluZyB0byBkbyByaWdodCBub3cKICAgIH0KCiAgICAvKioKICAgICAqIEBwYXJhbSB7IWJvb2xlYW49fSBpZ25vcmVFcnJvcgogICAgICogQHJldHVybiB7dW5kZWZpbmVkfQogICAgICovCiAgICBmdW5jdGlvbiBjbG9zZUVkaXRpbmcoaWdub3JlRXJyb3IpIHsKICAgICAgICBlZGl0b3IubGVhdmVTZXNzaW9uKGZ1bmN0aW9uKCkgewogICAgICAgICAgICBzZXJ2ZXIubGVhdmVTZXNzaW9uKGN1cnJlbnRTZXNzaW9uSWQsIGN1cnJlbnRNZW1iZXJJZCwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBzaG93U2Vzc2lvbnMoKTsKICAgICAgICAgICAgfSwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBpZiAoaWdub3JlRXJyb3IpIHsKICAgICAgICAgICAgICAgICAgICBzaG93U2Vzc2lvbnMoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vIFRPRE86IGVsc2UgcmVwb3J0IHByb2JsZW0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAcmV0dXJuIHt1bmRlZmluZWR9CiAgICAgKi8KICAgIGZ1bmN0aW9uIGhhbmRsZUVkaXRpbmdFcnJvcihlcnJvcikgewogICAgICAgIGFsZXJ0KCJTb21ldGhpbmcgd2VudCB3cm9uZzpcbiIrZXJyb3IpOwogICAgICAgIGNsb3NlRWRpdGluZyh0cnVlKTsKICAgIH0KCiAgICAvKioKICAgICAqIEByZXR1cm4ge3VuZGVmaW5lZH0KICAgICAqLwogICAgZnVuY3Rpb24gc2hvd1Nlc3Npb25zKCkgewogICAgICAgIHN3aXRjaFRvUGFnZSgic2Vzc2lvbkxpc3RDb250YWluZXIiKTsKCiAgICAgICAgc2Vzc2lvbkxpc3Quc2V0VXBkYXRlc0VuYWJsZWQodHJ1ZSk7CgogICAgICAgIHVwZGF0ZUxvY2F0aW9uV2l0aFNlc3Npb25JZCgiIik7CiAgICB9CgogICAgLyoqCiAgICAgKiBAcGFyYW0geyFzdHJpbmd9IHNlc3Npb25JZAogICAgICogQHJldHVybiB7dW5kZWZpbmVkfQogICAgICovCiAgICBmdW5jdGlvbiBqb2luU2Vzc2lvbihzZXNzaW9uSWQpIHsKICAgICAgICBzd2l0Y2hUb1BhZ2UoImVkaXRvckNvbnRhaW5lciIpOwoKICAgICAgICBzZXNzaW9uTGlzdC5zZXRVcGRhdGVzRW5hYmxlZChmYWxzZSk7CgogICAgICAgIHVwZGF0ZUxvY2F0aW9uV2l0aFNlc3Npb25JZChzZXNzaW9uSWQpOwoKICAgICAgICBjdXJyZW50U2Vzc2lvbklkID0gc2Vzc2lvbklkOwogICAgICAgIHNlcnZlci5qb2luU2Vzc2lvbih1c2VySWQsIHNlc3Npb25JZCwgZnVuY3Rpb24obWVtYmVySWQpIHsKICAgICAgICAgICAgY3VycmVudE1lbWJlcklkID0gbWVtYmVySWQ7CgogICAgICAgICAgICBpZiAoIWVkaXRvcikgewogICAgICAgICAgICAgICAgZWRpdG9yT3B0aW9ucy5uZXR3b3JrU2VjdXJpdHlUb2tlbiA9IHRva2VuOwogICAgICAgICAgICAgICAgZWRpdG9yT3B0aW9ucy5jbG9zZUNhbGxiYWNrID0gY2xvc2VFZGl0aW5nOwogICAgICAgICAgICAgICAgV29kby5jcmVhdGVDb2xsYWJUZXh0RWRpdG9yKCdlZGl0b3JDb250YWluZXInLCBlZGl0b3JPcHRpb25zLCBmdW5jdGlvbihlcnIsIGUpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgY2FudmFzQ29udGFpbmVyRWxlbWVudDsKCiAgICAgICAgICAgICAgICAgICAgZWRpdG9yID0gZTsKCiAgICAgICAgICAgICAgICAgICAgY2FudmFzQ29udGFpbmVyRWxlbWVudCA9IGVkaXRvci5nZXRDYW52YXNDb250YWluZXJFbGVtZW50KCk7CiAgICAgICAgICAgICAgICAgICAgc2F2aW5nT3ZlcmxheSA9IGFkZFN0YXR1c092ZXJsYXkoY2FudmFzQ29udGFpbmVyRWxlbWVudCwgImRvY3VtZW50LXNhdmUucG5nIiwgMCk7CiAgICAgICAgICAgICAgICAgICAgaGFzTG9jYWxVbnN5bmNlZE9wc092ZXJsYXkgPSBhZGRTdGF0dXNPdmVybGF5KGNhbnZhc0NvbnRhaW5lckVsZW1lbnQsICJ2Y3MtbG9jYWxseS1tb2RpZmllZC5wbmciLCAwKTsKICAgICAgICAgICAgICAgICAgICBkaXNjb25uZWN0ZWRPdmVybGF5ID0gYWRkU3RhdHVzT3ZlcmxheShjYW52YXNDb250YWluZXJFbGVtZW50LCAibmV0d29yay1kaXNjb25uZWN0LnBuZyIsIDEpOwoKICAgICAgICAgICAgICAgICAgICBlZGl0b3IuYWRkRXZlbnRMaXN0ZW5lcihXb2RvLkVWRU5UX0JFRk9SRVNBVkVUT0ZJTEUsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBzYXZpbmdPdmVybGF5LnN0eWxlLmRpc3BsYXkgPSAiIjsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBlZGl0b3IuYWRkRXZlbnRMaXN0ZW5lcihXb2RvLkVWRU5UX1NBVkVEVE9GSUxFLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2F2aW5nT3ZlcmxheS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGVkaXRvci5hZGRFdmVudExpc3RlbmVyKFdvZG8uRVZFTlRfSEFTTE9DQUxVTlNZTkNFRE9QRVJBVElPTlNDSEFOR0VELCBmdW5jdGlvbihoYXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaGFzTG9jYWxVbnN5bmNlZE9wc092ZXJsYXkuc3R5bGUuZGlzcGxheSA9IGhhcyA/ICIiIDogIm5vbmUiOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGVkaXRvci5hZGRFdmVudExpc3RlbmVyKFdvZG8uRVZFTlRfSEFTU0VTU0lPTkhPU1RDT05ORUNUSU9OQ0hBTkdFRCwgZnVuY3Rpb24oaGFzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRpc2Nvbm5lY3RlZE92ZXJsYXkuc3R5bGUuZGlzcGxheSA9IGhhcyA/ICJub25lIiA6ICIiOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGVkaXRvci5hZGRFdmVudExpc3RlbmVyKFdvZG8uRVZFTlRfVU5LTk9XTkVSUk9SLCBoYW5kbGVFZGl0aW5nRXJyb3IpOwoKICAgICAgICAgICAgICAgICAgICAvLyBsb2FkIHRoZSBkb2N1bWVudCBhbmQgZ2V0IGNhbGxlZCBiYWNrIHdoZW4gaXQncyBsaXZlCiAgICAgICAgICAgICAgICAgICAgZWRpdG9yLmpvaW5TZXNzaW9uKHNlcnZlckZhY3RvcnkuY3JlYXRlU2Vzc2lvbkJhY2tlbmQoc2Vzc2lvbklkLCBtZW1iZXJJZCwgc2VydmVyKSwgb25FZGl0aW5nU3RhcnRlZCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGVkaXRvci5qb2luU2Vzc2lvbihzZXJ2ZXJGYWN0b3J5LmNyZWF0ZVNlc3Npb25CYWNrZW5kKHNlc3Npb25JZCwgbWVtYmVySWQsIHNlcnZlciksIG9uRWRpdGluZ1N0YXJ0ZWQpOwogICAgICAgICAgICB9CiAgICAgICAgfSwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIC8vIFRPRE86IGhhbmRsZSBlcnJvcgogICAgICAgIH0pOwogICAgfQoKICAgIC8qKgogICAgICogZXh0cmFjdCBzZXNzaW9uIGlkIGZyb20gdGhlIHVybC1mcmFnbWVudAogICAgICoKICAgICAqIEByZXR1cm4gez9zdHJpbmd9CiAgICAgKi8KICAgIGZ1bmN0aW9uIGV4dHJhY3RTZXNzaW9uSWQoKSB7CiAgICAgICAgdmFyIHNlc3Npb25JZCA9IFN0cmluZyhkb2N1bWVudC5sb2NhdGlvbiksCiAgICAgICAgICAgIHBvcyA9IHNlc3Npb25JZC5pbmRleE9mKCcjJyk7CiAgICAgICAgcmV0dXJuIChwb3MgIT09IC0xKSA/IHNlc3Npb25JZC5zdWJzdHIocG9zICsgMSkgOiBudWxsOwogICAgfQoKICAgIC8qKgogICAgICogc3RhcnQgdGhlIGxvZ2luIHByb2Nlc3MgYnkgb2ZmZXJpbmcgYSBsb2dpbi9wYXNzd29yZCBwcm9tcHQuCiAgICAgKiBvbiBzdWNjZXNzIGEgbGlzdCBvZiBzZXNzaW9ucyBpcyBvZmZlcmVkLgogICAgICogd2hlbiB0aGUgdXNlciBzZWxlY3RzIGEgc2Vzc2lvbiB0aGUgY2FsbGJhY2sgaXMgY2FsbGVkCiAgICAgKiB3aXRoIHRoZSBzZXNzaW9uSWQgYXMgcGFyYW1ldGVyCiAgICAgKgogICAgICogQHBhcmFtIHshZnVuY3Rpb24oIXN0cmluZywgIXN0cmluZywgP3N0cmluZyl9IGNhbGxiYWNrCiAgICAgKiBAcmV0dXJuIHt1bmRlZmluZWR9CiAgICAgKi8KICAgIGZ1bmN0aW9uIHN0YXJ0TG9naW5Qcm9jZXNzKGNhbGxiYWNrKSB7CiAgICAgICAgcnVudGltZS5hc3NlcnQoZWRpdG9yID09PSBudWxsLCAiY2Fubm90IGJvb3Qgd2l0aCBpbnN0YW50aWF0ZWQgZWRpdG9yIik7CgogICAgICAgIGZ1bmN0aW9uIGxvZ2luU3VjY2Vzcyh1c2VyRGF0YSkgewogICAgICAgICAgICByZXF1aXJlKFsid2Vib2RmL2VkaXRvci9TZXNzaW9uTGlzdFZpZXciXSwKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChTZXNzaW9uTGlzdFZpZXcpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgc2Vzc2lvbkxpc3REaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic2Vzc2lvbkxpc3QiKSwKICAgICAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbklkID0gZXh0cmFjdFNlc3Npb25JZCgpLAogICAgICAgICAgICAgICAgICAgICAgICBzZXNzaW9uTGlzdFZpZXc7CgogICAgICAgICAgICAgICAgICAgIHJ1bnRpbWUubG9nKCJjb25uZWN0ZWQ6IiArIHVzZXJEYXRhLmZ1bGxfbmFtZSk7CiAgICAgICAgICAgICAgICAgICAgdXNlcklkID0gdXNlckRhdGEudWlkOwogICAgICAgICAgICAgICAgICAgIHRva2VuID0gdXNlckRhdGEuc2VjdXJpdHlUb2tlbiB8fCBudWxsOwoKICAgICAgICAgICAgICAgICAgICAvLyBhZGQgc2Vzc2lvbiBsaXN0aW5nCiAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbkxpc3QgPSBuZXcgc2VydmVyRmFjdG9yeS5jcmVhdGVTZXNzaW9uTGlzdChzZXJ2ZXIpOwogICAgICAgICAgICAgICAgICAgIHNlc3Npb25MaXN0VmlldyA9IG5ldyBTZXNzaW9uTGlzdFZpZXcoc2Vzc2lvbkxpc3QsIHNlc3Npb25MaXN0RGl2LCBqb2luU2Vzc2lvbik7CgogICAgICAgICAgICAgICAgICAgIGlmIChzZXNzaW9uSWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gVE9ETzogY2hlY2sgaWYgc2Vzc2lvbiBleGlzdHMKICAgICAgICAgICAgICAgICAgICAgICAgam9pblNlc3Npb24oc2Vzc2lvbklkKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2hUb1BhZ2UoInNlc3Npb25MaXN0Q29udGFpbmVyIik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gbG9naW5GYWlsKHJlc3VsdCkgewogICAgICAgICAgICBhbGVydCgiTG9naW4gZmFpbGVkOiAiICsgcmVzdWx0KTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIEByZXR1cm4geyFib29sZWFufQogICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIG9uTG9naW5TdWJtaXQoKSB7CiAgICAgICAgICAgIHNlcnZlci5sb2dpbihkb2N1bWVudC5sb2dpbkZvcm0ubG9naW4udmFsdWUsIGRvY3VtZW50LmxvZ2luRm9ybS5wYXNzd29yZC52YWx1ZSwgbG9naW5TdWNjZXNzLCBsb2dpbkZhaWwpOwoKICAgICAgICAgICAgLy8gYmxvY2sgdGhlIHN1Ym1pdCBidXR0b24sIHdlIGFscmVhZHkgZGVhbHQgd2l0aCB0aGUgaW5wdXQKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgLy8gYnJpbmcgdXAgdGhlIGxvZ2luIGZvcm0KICAgICAgICBkb2N1bWVudC5sb2dpbkZvcm0uU3VibWl0Lm9uY2xpY2sgPSBvbkxvZ2luU3VibWl0OwogICAgICAgIHN3aXRjaFRvUGFnZSgibG9naW5Db250YWluZXIiKTsKICAgICAgICBkb2N1bWVudC5sb2dpbkZvcm0ubG9naW4uZm9jdXMoKTsKICAgIH0KCiAgICAvLyBzdGFydCB0aGUgZWRpdG9yIHdpdGggbmV0d29yawogICAgcnVudGltZS5sb2coInN0YXJ0aW5nIGNvbGxhYm9yYXRpdmUgZWRpdG9yIGZvciBbcHVsbGJveF0uIik7CiAgICByZXF1aXJlKFsid2Vib2RmL2VkaXRvci9iYWNrZW5kL3B1bGxib3gvU2VydmVyRmFjdG9yeSJdLCBmdW5jdGlvbiAoU2VydmVyRmFjdG9yeSkgewogICAgICAgIHNlcnZlckZhY3RvcnkgPSBuZXcgU2VydmVyRmFjdG9yeSgpOwogICAgICAgIHNlcnZlciA9IHNlcnZlckZhY3RvcnkuY3JlYXRlU2VydmVyKCk7CiAgICAgICAgLy8gd2FpdCBmb3IgYSBuZXR3b3JrIGNvbm5lY3Rpb24gdG8gZXN0YWJsaXNoLgogICAgICAgIC8vIGNhbGwgdGhlIGNhbGxiYWNrIHdoZW4gZG9uZSwgd2hlbiBmaW5hbGx5IGZhaWxlZCwgb3IKICAgICAgICAvLyB3aGVuIGEgdGltZW91dCByZWFjaGVkLgogICAgICAgIC8vIHRoZSBwYXJhbWV0ZXIgdG8gdGhlIGNhbGxiYWNrIGlzIGEgc3RyaW5nIHdpdGggdGhlIHBvc3NpYmxlCiAgICAgICAgLy8gdmFsdWVzOiAidW5hdmFpbGFibGUiLCAidGltZW91dCIsICJyZWFkeSIKICAgICAgICBzZXJ2ZXIuY29ubmVjdCg4MDAwLCBmdW5jdGlvbiAoc3RhdGUpIHsKICAgICAgICAgICAgaWYgKHN0YXRlID09PSAicmVhZHkiKSB7CiAgICAgICAgICAgICAgICBzdGFydExvZ2luUHJvY2VzcygpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9KTsKfQo=",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Sun, 09 Nov 2014 02:39:55 GMT",
                    "Content-Length": "9416",
                    "Date": "Sun, 09 Nov 2014 02:39:56 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}