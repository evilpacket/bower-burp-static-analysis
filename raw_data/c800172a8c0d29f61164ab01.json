{
    "url": "http://localhost:9999/uninett-simen/strophejs/tests/testrunner.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Open redirection (DOM-based)",
    "issueType": 5243152,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based open redirection vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the target of a redirection in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause a redirection to an arbitrary external domain. This behavior can be leveraged to facilitate phishing attacks against users of the application. The ability to use an authentic application URL, targeting the correct domain with a valid SSL certificate (if SSL is used) lends credibility to the phishing attack because many users, even if they verify these features, will not notice the subsequent redirection to a different domain.<br><br><b>Note:</b> If an attacker is able to control the start of the string that is passed to the redirection API, then it may be possible to escalate this vulnerability into a JavaScript injection attack, by using a URL with the javascript: pseudo-protocol to execute arbitrary script code when the URL is processed by the browser.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based open redirection vulnerabilities is not to dynamically set redirection targets using data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing an arbitrary URL as a redirection target. In general, this is best achieved by using a whitelist of URLs that are permitted redirection targets, and strictly validating the target against this list before performing the redirection.",
    "issueDetail": "The application may be vulnerable to DOM-based open redirection. Data is read from <b>location.href</b> and written to <b>location.href</b> via the following statement:<ul><li>location.href = location.href.match(/^(.+?)(\\?.*)?$/)[1] + \"?\" + encodeURIComponent($.trim(target.text()));</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/uninett-simen/strophejs/tests/testrunner.js",
                "path": "/uninett-simen/strophejs/tests/testrunner.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC91bmluZXR0LXNpbWVuL3N0cm9waGVqcy90ZXN0cy90ZXN0cnVubmVyLmpzIEhUVFAvMS4xDQpIb3N0OiBsb2NhbGhvc3Q6OTk5OQ0KDQo=",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMjA2NjINCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IFNhdCwgMDggTm92IDIwMTQgMTQ6NTc6MDQgR01UDQpMYXN0LU1vZGlmaWVkOiBTYXQsIDA4IE5vdiAyMDE0IDE0OjU3OjA0IEdNVA0KDQovKgogKiBRVW5pdCAtIGpRdWVyeSB1bml0IHRlc3RydW5uZXIKICogCiAqIGh0dHA6Ly9kb2NzLmpxdWVyeS5jb20vUVVuaXQKICoKICogQ29weXJpZ2h0IChjKSAyMDA4IEpvaG4gUmVzaWcsIErDtnJuIFphZWZmZXJlcgogKiBEdWFsIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgKE1JVC1MSUNFTlNFLnR4dCkKICogYW5kIEdQTCAoR1BMLUxJQ0VOU0UudHh0KSBsaWNlbnNlcy4KICoKICogJElkJAogKi8KCihmdW5jdGlvbigkKSB7CgovLyBUZXN0cyBmb3IgZXF1YWxpdHkgYW55IEphdmFTY3JpcHQgdHlwZSBhbmQgc3RydWN0dXJlIHdpdGhvdXQgdW5leHBlY3RlZCByZXN1bHRzLgovLyBEaXNjdXNzaW9ucyBhbmQgcmVmZXJlbmNlOiBodHRwOi8vcGhpbHJhdGhlLmNvbS9hcnRpY2xlcy9lcXVpdgovLyBUZXN0IHN1aXRlczogaHR0cDovL3BoaWxyYXRoZS5jb20vdGVzdHMvZXF1aXYKLy8gQXV0aG9yOiBQaGlsaXBwZSBSYXRow6kgPHByYXRoZUBnbWFpbC5jb20+CnZhciBlcXVpdiA9IGZ1bmN0aW9uICgpIHsKCiAgICB2YXIgaW5uZXJFcXVpdjsgLy8gdGhlIHJlYWwgZXF1aXYgZnVuY3Rpb24KICAgIHZhciBjYWxsZXJzID0gW107IC8vIHN0YWNrIHRvIGRlY2lkZSBiZXR3ZWVuIHNraXAvYWJvcnQgZnVuY3Rpb25zCgogICAgLy8gRGV0ZXJtaW5lIHdoYXQgaXMgby4KICAgIGZ1bmN0aW9uIGhvb3ppdChvKSB7CiAgICAgICAgaWYgKHR5cGVvZiBvID09PSAic3RyaW5nIikgewogICAgICAgICAgICByZXR1cm4gInN0cmluZyI7CgogICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIG8gPT09ICJib29sZWFuIikgewogICAgICAgICAgICByZXR1cm4gImJvb2xlYW4iOwoKICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBvID09PSAibnVtYmVyIikgewoKICAgICAgICAgICAgaWYgKGlzTmFOKG8pKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gIm5hbiI7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gIm51bWJlciI7CiAgICAgICAgICAgIH0KCiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgbyA9PT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgcmV0dXJuICJ1bmRlZmluZWQiOwoKICAgICAgICAvLyBjb25zaWRlcjogdHlwZW9mIG51bGwgPT09IG9iamVjdAogICAgICAgIH0gZWxzZSBpZiAobyA9PT0gbnVsbCkgewogICAgICAgICAgICByZXR1cm4gIm51bGwiOwoKICAgICAgICAvLyBjb25zaWRlcjogdHlwZW9mIFtdID09PSBvYmplY3QKICAgICAgICB9IGVsc2UgaWYgKG8gaW5zdGFuY2VvZiBBcnJheSkgewogICAgICAgICAgICByZXR1cm4gImFycmF5IjsKICAgICAgICAKICAgICAgICAvLyBjb25zaWRlcjogdHlwZW9mIG5ldyBEYXRlKCkgPT09IG9iamVjdAogICAgICAgIH0gZWxzZSBpZiAobyBpbnN0YW5jZW9mIERhdGUpIHsKICAgICAgICAgICAgcmV0dXJuICJkYXRlIjsKCiAgICAgICAgLy8gY29uc2lkZXI6IC8uLyBpbnN0YW5jZW9mIE9iamVjdDsKICAgICAgICAvLyAgICAgICAgICAgLy4vIGluc3RhbmNlb2YgUmVnRXhwOwogICAgICAgIC8vICAgICAgICAgIHR5cGVvZiAvLi8gPT09ICJmdW5jdGlvbiI7IC8vID0+IGZhbHNlIGluIElFIGFuZCBPcGVyYSwKICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRydWUgaW4gRkYgYW5kIFNhZmFyaQogICAgICAgIH0gZWxzZSBpZiAobyBpbnN0YW5jZW9mIFJlZ0V4cCkgewogICAgICAgICAgICByZXR1cm4gInJlZ2V4cCI7CgogICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIG8gPT09ICJvYmplY3QiKSB7CiAgICAgICAgICAgIHJldHVybiAib2JqZWN0IjsKCiAgICAgICAgfSBlbHNlIGlmIChvIGluc3RhbmNlb2YgRnVuY3Rpb24pIHsKICAgICAgICAgICAgcmV0dXJuICJmdW5jdGlvbiI7CiAgICAgICAgfQogICAgfQoKICAgIC8vIENhbGwgdGhlIG8gcmVsYXRlZCBjYWxsYmFjayB3aXRoIHRoZSBnaXZlbiBhcmd1bWVudHMuCiAgICBmdW5jdGlvbiBiaW5kQ2FsbGJhY2tzKG8sIGNhbGxiYWNrcywgYXJncykgewogICAgICAgIHZhciBwcm9wID0gaG9veml0KG8pOwogICAgICAgIGlmIChwcm9wKSB7CiAgICAgICAgICAgIGlmIChob296aXQoY2FsbGJhY2tzW3Byb3BdKSA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrc1twcm9wXS5hcHBseShjYWxsYmFja3MsIGFyZ3MpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrc1twcm9wXTsgLy8gb3IgdW5kZWZpbmVkCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgdmFyIGNhbGxiYWNrcyA9IGZ1bmN0aW9uICgpIHsKCiAgICAgICAgLy8gZm9yIHN0cmluZywgYm9vbGVhbiwgbnVtYmVyIGFuZCBudWxsCiAgICAgICAgZnVuY3Rpb24gdXNlU3RyaWN0RXF1YWxpdHkoYiwgYSkgewogICAgICAgICAgICByZXR1cm4gYSA9PT0gYjsKICAgICAgICB9CgogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICJzdHJpbmciOiB1c2VTdHJpY3RFcXVhbGl0eSwKICAgICAgICAgICAgImJvb2xlYW4iOiB1c2VTdHJpY3RFcXVhbGl0eSwKICAgICAgICAgICAgIm51bWJlciI6IHVzZVN0cmljdEVxdWFsaXR5LAogICAgICAgICAgICAibnVsbCI6IHVzZVN0cmljdEVxdWFsaXR5LAogICAgICAgICAgICAidW5kZWZpbmVkIjogdXNlU3RyaWN0RXF1YWxpdHksCgogICAgICAgICAgICAibmFuIjogZnVuY3Rpb24gKGIpIHsKICAgICAgICAgICAgICAgIHJldHVybiBpc05hTihiKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICJkYXRlIjogZnVuY3Rpb24gKGIsIGEpIHsKICAgICAgICAgICAgICAgIHJldHVybiBob296aXQoYikgPT09ICJkYXRlIiAmJiBhLnZhbHVlT2YoKSA9PT0gYi52YWx1ZU9mKCk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICAicmVnZXhwIjogZnVuY3Rpb24gKGIsIGEpIHsKICAgICAgICAgICAgICAgIHJldHVybiBob296aXQoYikgPT09ICJyZWdleHAiICYmCiAgICAgICAgICAgICAgICAgICAgYS5zb3VyY2UgPT09IGIuc291cmNlICYmIC8vIHRoZSByZWdleCBpdHNlbGYKICAgICAgICAgICAgICAgICAgICBhLmdsb2JhbCA9PT0gYi5nbG9iYWwgJiYgLy8gYW5kIGl0cyBtb2RpZmVycyAoZ21pKSAuLi4KICAgICAgICAgICAgICAgICAgICBhLmlnbm9yZUNhc2UgPT09IGIuaWdub3JlQ2FzZSAmJgogICAgICAgICAgICAgICAgICAgIGEubXVsdGlsaW5lID09PSBiLm11bHRpbGluZTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIC8vIC0gc2tpcCB3aGVuIHRoZSBwcm9wZXJ0eSBpcyBhIG1ldGhvZCBvZiBhbiBpbnN0YW5jZSAoT09QKQogICAgICAgICAgICAvLyAtIGFib3J0IG90aGVyd2lzZSwKICAgICAgICAgICAgLy8gICBpbml0aWFsID09PSB3b3VsZCBoYXZlIGNhdGNoIGlkZW50aWNhbCByZWZlcmVuY2VzIGFueXdheQogICAgICAgICAgICAiZnVuY3Rpb24iOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB2YXIgY2FsbGVyID0gY2FsbGVyc1tjYWxsZXJzLmxlbmd0aCAtIDFdOwogICAgICAgICAgICAgICAgcmV0dXJuIGNhbGxlciAhPT0gT2JqZWN0ICYmCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVvZiBjYWxsZXIgIT09ICJ1bmRlZmluZWQiOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgImFycmF5IjogZnVuY3Rpb24gKGIsIGEpIHsKICAgICAgICAgICAgICAgIHZhciBpOwogICAgICAgICAgICAgICAgdmFyIGxlbjsKCiAgICAgICAgICAgICAgICAvLyBiIGNvdWxkIGJlIGFuIG9iamVjdCBsaXRlcmFsIGhlcmUKICAgICAgICAgICAgICAgIGlmICggISAoaG9veml0KGIpID09PSAiYXJyYXkiKSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBsZW4gPSBhLmxlbmd0aDsKICAgICAgICAgICAgICAgIGlmIChsZW4gIT09IGIubGVuZ3RoKSB7IC8vIHNhZmUgYW5kIGZhc3RlcgogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgICAgICAgICAgIGlmKCAhIGlubmVyRXF1aXYoYVtpXSwgYltpXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgIm9iamVjdCI6IGZ1bmN0aW9uIChiLCBhKSB7CiAgICAgICAgICAgICAgICB2YXIgaTsKICAgICAgICAgICAgICAgIHZhciBlcSA9IHRydWU7IC8vIHVubGVzcyB3ZSBjYW4gcHJvb3ZlIGl0CiAgICAgICAgICAgICAgICB2YXIgYVByb3BlcnRpZXMgPSBbXSwgYlByb3BlcnRpZXMgPSBbXTsgLy8gY29sbGVjdGlvbiBvZiBzdHJpbmdzCgogICAgICAgICAgICAgICAgLy8gY29tcGFyaW5nIGNvbnN0cnVjdG9ycyBpcyBtb3JlIHN0cmljdCB0aGFuIHVzaW5nIGluc3RhbmNlb2YKICAgICAgICAgICAgICAgIGlmICggYS5jb25zdHJ1Y3RvciAhPT0gYi5jb25zdHJ1Y3RvcikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBzdGFjayBjb25zdHJ1Y3RvciBiZWZvcmUgdHJhdmVyc2luZyBwcm9wZXJ0aWVzCiAgICAgICAgICAgICAgICBjYWxsZXJzLnB1c2goYS5jb25zdHJ1Y3Rvcik7CgogICAgICAgICAgICAgICAgZm9yIChpIGluIGEpIHsgLy8gYmUgc3RyaWN0OiBkb24ndCBlbnN1cmVzIGhhc093blByb3BlcnR5IGFuZCBnbyBkZWVwCgogICAgICAgICAgICAgICAgICAgIGFQcm9wZXJ0aWVzLnB1c2goaSk7IC8vIGNvbGxlY3QgYSdzIHByb3BlcnRpZXMKCiAgICAgICAgICAgICAgICAgICAgaWYgKCAhIGlubmVyRXF1aXYoYVtpXSwgYltpXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZXEgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgY2FsbGVycy5wb3AoKTsgLy8gdW5zdGFjaywgd2UgYXJlIGRvbmUKCiAgICAgICAgICAgICAgICBmb3IgKGkgaW4gYikgewogICAgICAgICAgICAgICAgICAgIGJQcm9wZXJ0aWVzLnB1c2goaSk7IC8vIGNvbGxlY3QgYidzIHByb3BlcnRpZXMKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBFbnN1cmVzIGlkZW50aWNhbCBwcm9wZXJ0aWVzIG5hbWUKICAgICAgICAgICAgICAgIHJldHVybiBlcSAmJiBpbm5lckVxdWl2KGFQcm9wZXJ0aWVzLnNvcnQoKSwgYlByb3BlcnRpZXMuc29ydCgpKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICB9KCk7CgogICAgaW5uZXJFcXVpdiA9IGZ1bmN0aW9uICgpIHsgLy8gY2FuIHRha2UgbXVsdGlwbGUgYXJndW1lbnRzCiAgICAgICAgdmFyIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuYXBwbHkoYXJndW1lbnRzKTsKICAgICAgICBpZiAoYXJncy5sZW5ndGggPCAyKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOyAvLyBlbmQgdHJhbnNpdGlvbgogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIChmdW5jdGlvbiAoYSwgYikgewogICAgICAgICAgICBpZiAoYSA9PT0gYikgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7IC8vIGNhdGNoIHRoZSBtb3N0IHlvdSBjYW4KCiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGEgIT09IHR5cGVvZiBiIHx8IGEgPT09IG51bGwgfHwgYiA9PT0gbnVsbCB8fCB0eXBlb2YgYSA9PT0gInVuZGVmaW5lZCIgfHwgdHlwZW9mIGIgPT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7IC8vIGRvbid0IGxvc2UgdGltZSB3aXRoIGVycm9yIHByb25lIGNhc2VzCgogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIGJpbmRDYWxsYmFja3MoYSwgY2FsbGJhY2tzLCBbYiwgYV0pOwogICAgICAgICAgICB9CgogICAgICAgIC8vIGFwcGx5IHRyYW5zaXRpb24gd2l0aCAoMS4ubikgYXJndW1lbnRzCiAgICAgICAgfSkoYXJnc1swXSwgYXJnc1sxXSkgJiYgYXJndW1lbnRzLmNhbGxlZS5hcHBseSh0aGlzLCBhcmdzLnNwbGljZSgxLCBhcmdzLmxlbmd0aCAtMSkpOwogICAgfTsKCiAgICByZXR1cm4gaW5uZXJFcXVpdjsKfSgpOyAvLyBlcXVpdgoJCnZhciBjb25maWcgPSB7CglzdGF0czogewoJCWFsbDogMCwKCQliYWQ6IDAKCX0sCglxdWV1ZTogW10sCgkvLyBibG9jayB1bnRpbCBkb2N1bWVudCByZWFkeQoJYmxvY2tpbmc6IHRydWUsCgkvL3Jlc3RyaWN0IG1vZHVsZXMvdGVzdHMgYnkgZ2V0IHBhcmFtZXRlcnMKCWZpbHRlcnM6IGxvY2F0aW9uLnNlYXJjaC5sZW5ndGggPiAxICYmICQubWFwKCBsb2NhdGlvbi5zZWFyY2guc2xpY2UoMSkuc3BsaXQoJyYnKSwgZGVjb2RlVVJJQ29tcG9uZW50ICksCglpc0xvY2FsOiAhISh3aW5kb3cubG9jYXRpb24ucHJvdG9jb2wgPT0gJ2ZpbGU6JykKfTsKCi8vIHB1YmxpYyBBUEkgYXMgZ2xvYmFsIG1ldGhvZHMKJC5leHRlbmQod2luZG93LCB7Cgl0ZXN0OiB0ZXN0LAoJbW9kdWxlOiBtb2R1bGUsCglleHBlY3Q6IGV4cGVjdCwKCW9rOiBvaywKCWVxdWFsczogZXF1YWxzLAoJc3RhcnQ6IHN0YXJ0LAoJc3RvcDogc3RvcCwKCXJlc2V0OiByZXNldCwKCWlzTG9jYWw6IGNvbmZpZy5pc0xvY2FsLAoJc2FtZTogZnVuY3Rpb24oYSwgYiwgbWVzc2FnZSkgewoJCXB1c2goZXF1aXYoYSwgYiksIGEsIGIsIG1lc3NhZ2UpOwoJfSwKCVFVbml0OiB7CgkJZXF1aXY6IGVxdWl2Cgl9LAoJLy8gbGVnYWN5IG1ldGhvZHMgYmVsb3cKCWlzU2V0OiBpc1NldCwKCWlzT2JqOiBpc09iaiwKCWNvbXBhcmU6IGZ1bmN0aW9uKCkgewoJCXRocm93ICJjb21wYXJlIGlzIGRlcHJlY2F0ZWQgLSB1c2Ugc2FtZSgpIGluc3RlYWQiOwoJfSwKCWNvbXBhcmUyOiBmdW5jdGlvbigpIHsKCQl0aHJvdyAiY29tcGFyZTIgaXMgZGVwcmVjYXRlZCAtIHVzZSBzYW1lKCkgaW5zdGVhZCI7Cgl9LAoJc2VyaWFsQXJyYXk6IGZ1bmN0aW9uKCkgewoJCXRocm93ICJzZXJpYWxBcnJheSBpcyBkZXByZWNhdGVkIC0gdXNlIGpzRHVtcC5wYXJzZSgpIGluc3RlYWQiOwoJfSwKCXE6IHEsCgl0OiB0LAoJdXJsOiB1cmwsCgl0cmlnZ2VyRXZlbnQ6IHRyaWdnZXJFdmVudAp9KTsKCiQod2luZG93KS5sb2FkKGZ1bmN0aW9uKCkgewoJJCgnI3VzZXJBZ2VudCcpLmh0bWwobmF2aWdhdG9yLnVzZXJBZ2VudCk7Cgl2YXIgaGVhZCA9ICQoJzxkaXYgY2xhc3M9InRlc3RydW5uZXItdG9vbGJhciI+PGxhYmVsIGZvcj0iZmlsdGVyIj5IaWRlIHBhc3NlZCB0ZXN0czwvbGFiZWw+PC9kaXY+JykuaW5zZXJ0QWZ0ZXIoIiN1c2VyQWdlbnQiKTsKCSQoJzxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9ImZpbHRlciIgLz4nKS5hdHRyKCJkaXNhYmxlZCIsIHRydWUpLnByZXBlbmRUbyhoZWFkKS5jbGljayhmdW5jdGlvbigpIHsKCQkkKCdsaS5wYXNzJylbdGhpcy5jaGVja2VkID8gJ2hpZGUnIDogJ3Nob3cnXSgpOwoJfSk7CglydW5UZXN0KCk7CQp9KTsKCmZ1bmN0aW9uIHN5bmNocm9uaXplKGNhbGxiYWNrKSB7Cgljb25maWcucXVldWUucHVzaChjYWxsYmFjayk7CglpZighY29uZmlnLmJsb2NraW5nKSB7CgkJcHJvY2VzcygpOwoJfQp9CgpmdW5jdGlvbiBwcm9jZXNzKCkgewoJd2hpbGUoY29uZmlnLnF1ZXVlLmxlbmd0aCAmJiAhY29uZmlnLmJsb2NraW5nKSB7CgkJY29uZmlnLnF1ZXVlLnNoaWZ0KCkoKTsKCX0KfQoKZnVuY3Rpb24gc3RvcCh0aW1lb3V0KSB7Cgljb25maWcuYmxvY2tpbmcgPSB0cnVlOwoJaWYgKHRpbWVvdXQpCgkJY29uZmlnLnRpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewoJCQlvayggZmFsc2UsICJUZXN0IHRpbWVkIG91dCIgKTsKCQkJc3RhcnQoKTsKCQl9LCB0aW1lb3V0KTsKfQpmdW5jdGlvbiBzdGFydCgpIHsKCS8vIEEgc2xpZ2h0IGRlbGF5LCB0byBhdm9pZCBhbnkgY3VycmVudCBjYWxsYmFja3MKCXNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CgkJaWYoY29uZmlnLnRpbWVvdXQpCgkJCWNsZWFyVGltZW91dChjb25maWcudGltZW91dCk7CgkJY29uZmlnLmJsb2NraW5nID0gZmFsc2U7CgkJcHJvY2VzcygpOwoJfSwgMTMpOwp9CgpmdW5jdGlvbiB2YWxpZFRlc3QoIG5hbWUgKSB7Cgl2YXIgZmlsdGVycyA9IGNvbmZpZy5maWx0ZXJzOwoJaWYoICFmaWx0ZXJzICkKCQlyZXR1cm4gdHJ1ZTsKCgl2YXIgaSA9IGZpbHRlcnMubGVuZ3RoLAoJCXJ1biA9IGZhbHNlOwoJd2hpbGUoIGktLSApewoJCXZhciBmaWx0ZXIgPSBmaWx0ZXJzW2ldLAoJCQlub3QgPSBmaWx0ZXIuY2hhckF0KDApID09ICchJzsKCQlpZiggbm90ICkgCgkJCWZpbHRlciA9IGZpbHRlci5zbGljZSgxKTsKCQlpZiggbmFtZS5pbmRleE9mKGZpbHRlcikgIT0gLTEgKQoJCQlyZXR1cm4gIW5vdDsKCQlpZiggbm90ICkKCQkJcnVuID0gdHJ1ZTsKCX0KCXJldHVybiBydW47Cn0KCmZ1bmN0aW9uIHJ1blRlc3QoKSB7Cgljb25maWcuYmxvY2tpbmcgPSBmYWxzZTsKCXZhciBzdGFydGVkID0gK25ldyBEYXRlOwoJY29uZmlnLmZpeHR1cmUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFpbicpLmlubmVySFRNTDsKCWNvbmZpZy5hamF4U2V0dGluZ3MgPSAkLmFqYXhTZXR0aW5nczsKCXN5bmNocm9uaXplKGZ1bmN0aW9uKCkgewoJCSQoJzxwIGlkPSJ0ZXN0cmVzdWx0IiBjbGFzcz0icmVzdWx0Ij4nKS5odG1sKFsnVGVzdHMgY29tcGxldGVkIGluICcsCgkJCStuZXcgRGF0ZSAtIHN0YXJ0ZWQsICcgbWlsbGlzZWNvbmRzLjxici8+JywKCQkJJzxzcGFuIGNsYXNzPSJiYWQiPicsIGNvbmZpZy5zdGF0cy5iYWQsICc8L3NwYW4+IHRlc3RzIG9mIDxzcGFuIGNsYXNzPSJhbGwiPicsIGNvbmZpZy5zdGF0cy5hbGwsICc8L3NwYW4+IGZhaWxlZC48L3A+J10KCQkJLmpvaW4oJycpKQoJCQkuYXBwZW5kVG8oImJvZHkiKTsKCQkkKCIjYmFubmVyIikuYWRkQ2xhc3MoY29uZmlnLnN0YXRzLmJhZCA/ICJmYWlsIiA6ICJwYXNzIik7Cgl9KTsKfQoKZnVuY3Rpb24gdGVzdChuYW1lLCBjYWxsYmFjaykgewoJaWYoY29uZmlnLmN1cnJlbnRNb2R1bGUpCgkJbmFtZSA9IGNvbmZpZy5jdXJyZW50TW9kdWxlICsgIiBtb2R1bGU6ICIgKyBuYW1lOwoJdmFyIGxpZmVjeWNsZSA9ICQuZXh0ZW5kKHsKCQlzZXR1cDogZnVuY3Rpb24oKSB7fSwKCQl0ZWFyZG93bjogZnVuY3Rpb24oKSB7fQoJfSwgY29uZmlnLm1vZHVsZUxpZmVjeWNsZSk7CgkKCWlmICggIXZhbGlkVGVzdChuYW1lKSApCgkJcmV0dXJuOwoJCQoJc3luY2hyb25pemUoZnVuY3Rpb24oKSB7CgkJY29uZmlnLmFzc2VydGlvbnMgPSBbXTsKCQljb25maWcuZXhwZWN0ZWQgPSBudWxsOwoJCXRyeSB7CgkJCWxpZmVjeWNsZS5zZXR1cCgpOwoJCQljYWxsYmFjaygpOwoJCQlsaWZlY3ljbGUudGVhcmRvd24oKTsKCQl9IGNhdGNoKGUpIHsKCQkJaWYoIHR5cGVvZiBjb25zb2xlICE9ICJ1bmRlZmluZWQiICYmIGNvbnNvbGUuZXJyb3IgJiYgY29uc29sZS53YXJuICkgewoJCQkJY29uc29sZS5lcnJvcigiVGVzdCAiICsgbmFtZSArICIgZGllZCwgZXhjZXB0aW9uIGFuZCB0ZXN0IGZvbGxvd3MiKTsKCQkJCWNvbnNvbGUuZXJyb3IoZSk7CgkJCQljb25zb2xlLndhcm4oY2FsbGJhY2sudG9TdHJpbmcoKSk7CgkJCX0KCQkJY29uZmlnLmFzc2VydGlvbnMucHVzaCggewoJCQkJcmVzdWx0OiBmYWxzZSwKCQkJCW1lc3NhZ2U6ICJEaWVkIG9uIHRlc3QgIyIgKyAoY29uZmlnLmFzc2VydGlvbnMubGVuZ3RoICsgMSkgKyAiOiAiICsgZS5tZXNzYWdlCgkJCX0pOwoJCX0KCX0pOwoJc3luY2hyb25pemUoZnVuY3Rpb24oKSB7CgkJdHJ5IHsKCQkJcmVzZXQoKTsKCQl9IGNhdGNoKGUpIHsKCQkJaWYoIHR5cGVvZiBjb25zb2xlICE9ICJ1bmRlZmluZWQiICYmIGNvbnNvbGUuZXJyb3IgJiYgY29uc29sZS53YXJuICkgewoJCQkJY29uc29sZS5lcnJvcigicmVzZXQoKSBmYWlsZWQsIGZvbGxvd2luZyBUZXN0ICIgKyBuYW1lICsgIiwgZXhjZXB0aW9uIGFuZCByZXNldCBmbiBmb2xsb3dzIik7CgkJCQljb25zb2xlLmVycm9yKGUpOwoJCQkJY29uc29sZS53YXJuKHJlc2V0LnRvU3RyaW5nKCkpOwoJCQl9CgkJfQoJCQoJCWlmKGNvbmZpZy5leHBlY3RlZCAmJiBjb25maWcuZXhwZWN0ZWQgIT0gY29uZmlnLmFzc2VydGlvbnMubGVuZ3RoKSB7CgkJCWNvbmZpZy5hc3NlcnRpb25zLnB1c2goewoJCQkJcmVzdWx0OiBmYWxzZSwKCQkJCW1lc3NhZ2U6ICJFeHBlY3RlZCAiICsgY29uZmlnLmV4cGVjdGVkICsgIiBhc3NlcnRpb25zLCBidXQgIiArIGNvbmZpZy5hc3NlcnRpb25zLmxlbmd0aCArICIgd2VyZSBydW4iCgkJCX0pOwoJCX0KCQkKCQl2YXIgZ29vZCA9IDAsIGJhZCA9IDA7CgkJdmFyIG9sICA9ICQoIjxvbC8+IikuaGlkZSgpOwoJCWNvbmZpZy5zdGF0cy5hbGwgKz0gY29uZmlnLmFzc2VydGlvbnMubGVuZ3RoOwoJCWZvciAoIHZhciBpID0gMDsgaSA8IGNvbmZpZy5hc3NlcnRpb25zLmxlbmd0aDsgaSsrICkgewoJCQl2YXIgYXNzZXJ0aW9uID0gY29uZmlnLmFzc2VydGlvbnNbaV07CgkJCSQoIjxsaS8+IikuYWRkQ2xhc3MoYXNzZXJ0aW9uLnJlc3VsdCA/ICJwYXNzIiA6ICJmYWlsIikudGV4dChhc3NlcnRpb24ubWVzc2FnZSB8fCAiKG5vIG1lc3NhZ2UpIikuYXBwZW5kVG8ob2wpOwoJCQlhc3NlcnRpb24ucmVzdWx0ID8gZ29vZCsrIDogYmFkKys7CgkJfQoJCWNvbmZpZy5zdGF0cy5iYWQgKz0gYmFkOwoJCgkJdmFyIGIgPSAkKCI8c3Ryb25nLz4iKS5odG1sKG5hbWUgKyAiIDxiIHN0eWxlPSdjb2xvcjpibGFjazsnPig8YiBjbGFzcz0nZmFpbCc+IiArIGJhZCArICI8L2I+LCA8YiBjbGFzcz0ncGFzcyc+IiArIGdvb2QgKyAiPC9iPiwgIiArIGNvbmZpZy5hc3NlcnRpb25zLmxlbmd0aCArICIpPC9iPiIpCgkJLmNsaWNrKGZ1bmN0aW9uKCl7CgkJCSQodGhpcykubmV4dCgpLnRvZ2dsZSgpOwoJCX0pCgkJLmRibGNsaWNrKGZ1bmN0aW9uKGV2ZW50KSB7CgkJCXZhciB0YXJnZXQgPSAkKGV2ZW50LnRhcmdldCkuZmlsdGVyKCJzdHJvbmciKS5jbG9uZSgpOwoJCQlpZiAoIHRhcmdldC5sZW5ndGggKSB7CgkJCQl0YXJnZXQuY2hpbGRyZW4oKS5yZW1vdmUoKTsKCQkJCWxvY2F0aW9uLmhyZWYgPSBsb2NhdGlvbi5ocmVmLm1hdGNoKC9eKC4rPykoXD8uKik/JC8pWzFdICsgIj8iICsgZW5jb2RlVVJJQ29tcG9uZW50KCQudHJpbSh0YXJnZXQudGV4dCgpKSk7CgkJCX0KCQl9KTsKCQkKCQkkKCI8bGkvPiIpLmFkZENsYXNzKGJhZCA/ICJmYWlsIiA6ICJwYXNzIikuYXBwZW5kKGIpLmFwcGVuZChvbCkuYXBwZW5kVG8oIiN0ZXN0cyIpOwoJCgkJaWYoYmFkKSB7CgkJCSQoIiNmaWx0ZXIiKS5hdHRyKCJkaXNhYmxlZCIsIG51bGwpOwoJCX0KCX0pOwp9CgovLyBjYWxsIG9uIHN0YXJ0IG9mIG1vZHVsZSB0ZXN0IHRvIHByZXBlbmQgbmFtZSB0byBhbGwgdGVzdHMKZnVuY3Rpb24gbW9kdWxlKG5hbWUsIGxpZmVjeWNsZSkgewoJY29uZmlnLmN1cnJlbnRNb2R1bGUgPSBuYW1lOwoJY29uZmlnLm1vZHVsZUxpZmVjeWNsZSA9IGxpZmVjeWNsZTsKfQoKLyoqCiAqIFNwZWNpZnkgdGhlIG51bWJlciBvZiBleHBlY3RlZCBhc3NlcnRpb25zIHRvIGd1cmFudGVlIHRoYXQgZmFpbGVkIHRlc3QgKG5vIGFzc2VydGlvbnMgYXJlIHJ1biBhdCBhbGwpIGRvbid0IHNsaXAgdGhyb3VnaC4KICovCmZ1bmN0aW9uIGV4cGVjdChhc3NlcnRzKSB7Cgljb25maWcuZXhwZWN0ZWQgPSBhc3NlcnRzOwp9CgovKioKICogUmVzZXRzIHRoZSB0ZXN0IHNldHVwLiBVc2VmdWwgZm9yIHRlc3RzIHRoYXQgbW9kaWZ5IHRoZSBET00uCiAqLwpmdW5jdGlvbiByZXNldCgpIHsKCSQoIiNtYWluIikuaHRtbCggY29uZmlnLmZpeHR1cmUgKTsKCSQuZXZlbnQuZ2xvYmFsID0ge307CgkkLmFqYXhTZXR0aW5ncyA9ICQuZXh0ZW5kKHt9LCBjb25maWcuYWpheFNldHRpbmdzKTsKfQoKLyoqCiAqIEFzc2VydHMgdHJ1ZS4KICogQGV4YW1wbGUgb2soICQoImEiKS5zaXplKCkgPiA1LCAiVGhlcmUgbXVzdCBiZSBhdCBsZWFzdCA1IGFuY2hvcnMiICk7CiAqLwpmdW5jdGlvbiBvayhhLCBtc2cpIHsKCWNvbmZpZy5hc3NlcnRpb25zLnB1c2goewoJCXJlc3VsdDogISFhLAoJCW1lc3NhZ2U6IG1zZwoJfSk7Cn0KCi8qKgogKiBBc3NlcnRzIHRoYXQgdHdvIGFycmF5cyBhcmUgdGhlIHNhbWUKICovCmZ1bmN0aW9uIGlzU2V0KGEsIGIsIG1zZykgewoJZnVuY3Rpb24gc2VyaWFsQXJyYXkoIGEgKSB7CgkJdmFyIHIgPSBbXTsKCQkKCQlpZiAoIGEgJiYgYS5sZW5ndGggKQoJICAgICAgICBmb3IgKCB2YXIgaSA9IDA7IGkgPCBhLmxlbmd0aDsgaSsrICkgewoJICAgICAgICAgICAgdmFyIHN0ciA9IGFbaV0ubm9kZU5hbWU7CgkgICAgICAgICAgICBpZiAoIHN0ciApIHsKCSAgICAgICAgICAgICAgICBzdHIgPSBzdHIudG9Mb3dlckNhc2UoKTsKCSAgICAgICAgICAgICAgICBpZiAoIGFbaV0uaWQgKQoJICAgICAgICAgICAgICAgICAgICBzdHIgKz0gIiMiICsgYVtpXS5pZDsKCSAgICAgICAgICAgIH0gZWxzZQoJICAgICAgICAgICAgICAgIHN0ciA9IGFbaV07CgkgICAgICAgICAgICByLnB1c2goIHN0ciApOwoJICAgICAgICB9CgkKCQlyZXR1cm4gIlsgIiArIHIuam9pbigiLCAiKSArICIgXSI7Cgl9Cgl2YXIgcmV0ID0gdHJ1ZTsKCWlmICggYSAmJiBiICYmIGEubGVuZ3RoICE9IHVuZGVmaW5lZCAmJiBhLmxlbmd0aCA9PSBiLmxlbmd0aCApIHsKCQlmb3IgKCB2YXIgaSA9IDA7IGkgPCBhLmxlbmd0aDsgaSsrICkKCQkJaWYgKCBhW2ldICE9IGJbaV0gKQoJCQkJcmV0ID0gZmFsc2U7Cgl9IGVsc2UKCQlyZXQgPSBmYWxzZTsKCWNvbmZpZy5hc3NlcnRpb25zLnB1c2goewoJCXJlc3VsdDogcmV0LAoJCW1lc3NhZ2U6ICFyZXQgPyAobXNnICsgIiBleHBlY3RlZDogIiArIHNlcmlhbEFycmF5KGIpICsgIiByZXN1bHQ6ICIgKyBzZXJpYWxBcnJheShhKSkgOiBtc2cKCX0pOwp9CgovKioKICogQXNzZXJ0cyB0aGF0IHR3byBvYmplY3RzIGFyZSBlcXVpdmFsZW50CiAqLwpmdW5jdGlvbiBpc09iaihhLCBiLCBtc2cpIHsKCXZhciByZXQgPSB0cnVlOwoJCglpZiAoIGEgJiYgYiApIHsKCQlmb3IgKCB2YXIgaSBpbiBhICkKCQkJaWYgKCBhW2ldICE9IGJbaV0gKQoJCQkJcmV0ID0gZmFsc2U7CgoJCWZvciAoIGkgaW4gYiApCgkJCWlmICggYVtpXSAhPSBiW2ldICkKCQkJCXJldCA9IGZhbHNlOwoJfSBlbHNlCgkJcmV0ID0gZmFsc2U7CgogICAgY29uZmlnLmFzc2VydGlvbnMucHVzaCh7CgkJcmVzdWx0OiByZXQsCgkJbWVzc2FnZTogbXNnCgl9KTsKfQoKLyoqCiAqIFJldHVybnMgYW4gYXJyYXkgb2YgZWxlbWVudHMgd2l0aCB0aGUgZ2l2ZW4gSURzLCBlZy4KICogQGV4YW1wbGUgcSgibWFpbiIsICJmb28iLCAiYmFyIikKICogQHJlc3VsdCBbPGRpdiBpZD0ibWFpbiI+LCA8c3BhbiBpZD0iZm9vIj4sIDxpbnB1dCBpZD0iYmFyIj5dCiAqLwpmdW5jdGlvbiBxKCkgewoJdmFyIHIgPSBbXTsKCWZvciAoIHZhciBpID0gMDsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKyApCgkJci5wdXNoKCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCggYXJndW1lbnRzW2ldICkgKTsKCXJldHVybiByOwp9CgovKioKICogQXNzZXJ0cyB0aGF0IGEgc2VsZWN0IG1hdGNoZXMgdGhlIGdpdmVuIElEcwogKiBAZXhhbXBsZSB0KCJDaGVjayBmb3Igc29tZXRoaW5nIiwgIi8vW2FdIiwgWyJmb28iLCAiYmFhciJdKTsKICogQHJlc3VsdCByZXR1cm5zIHRydWUgaWYgIi8vW2FdIiByZXR1cm4gdHdvIGVsZW1lbnRzIHdpdGggdGhlIElEcyAnZm9vJyBhbmQgJ2JhYXInCiAqLwpmdW5jdGlvbiB0KGEsYixjKSB7Cgl2YXIgZiA9ICQoYik7Cgl2YXIgcyA9ICIiOwoJZm9yICggdmFyIGkgPSAwOyBpIDwgZi5sZW5ndGg7IGkrKyApCgkJcyArPSAocyAmJiAiLCIpICsgJyInICsgZltpXS5pZCArICciJzsKCWlzU2V0KGYsIHEuYXBwbHkocSxjKSwgYSArICIgKCIgKyBiICsgIikiKTsKfQoKLyoqCiAqIEFkZCByYW5kb20gbnVtYmVyIHRvIHVybCB0byBzdG9wIElFIGZyb20gY2FjaGluZwogKgogKiBAZXhhbXBsZSB1cmwoImRhdGEvdGVzdC5odG1sIikKICogQHJlc3VsdCAiZGF0YS90ZXN0Lmh0bWw/MTA1MzgzNTg0Mjg5NDMiCiAqCiAqIEBleGFtcGxlIHVybCgiZGF0YS90ZXN0LnBocD9mb289YmFyIikKICogQHJlc3VsdCAiZGF0YS90ZXN0LnBocD9mb289YmFyJjEwNTM4MzU4MzQ1NTU0IgogKi8KZnVuY3Rpb24gdXJsKHZhbHVlKSB7CglyZXR1cm4gdmFsdWUgKyAoL1w/Ly50ZXN0KHZhbHVlKSA/ICImIiA6ICI/IikgKyBuZXcgRGF0ZSgpLmdldFRpbWUoKSArICIiICsgcGFyc2VJbnQoTWF0aC5yYW5kb20oKSoxMDAwMDApOwp9CgovKioKICogQ2hlY2tzIHRoYXQgdGhlIGZpcnN0IHR3byBhcmd1bWVudHMgYXJlIGVxdWFsLCB3aXRoIGFuIG9wdGlvbmFsIG1lc3NhZ2UuCiAqIFByaW50cyBvdXQgYm90aCBhY3R1YWwgYW5kIGV4cGVjdGVkIHZhbHVlcy4KICoKICogUHJlZmVyZWQgdG8gb2soIGFjdHVhbCA9PSBleHBlY3RlZCwgbWVzc2FnZSApCiAqCiAqIEBleGFtcGxlIGVxdWFscyggJC5mb3JtYXQoIlJlY2VpdmVkIHswfSBieXRlcy4iLCAyKSwgIlJlY2VpdmVkIDIgYnl0ZXMuIiApOwogKgogKiBAcGFyYW0gT2JqZWN0IGFjdHVhbAogKiBAcGFyYW0gT2JqZWN0IGV4cGVjdGVkCiAqIEBwYXJhbSBTdHJpbmcgbWVzc2FnZSAob3B0aW9uYWwpCiAqLwpmdW5jdGlvbiBlcXVhbHMoYWN0dWFsLCBleHBlY3RlZCwgbWVzc2FnZSkgewoJcHVzaChleHBlY3RlZCA9PSBhY3R1YWwsIGFjdHVhbCwgZXhwZWN0ZWQsIG1lc3NhZ2UpOwp9CgpmdW5jdGlvbiBwdXNoKHJlc3VsdCwgYWN0dWFsLCBleHBlY3RlZCwgbWVzc2FnZSkgewoJbWVzc2FnZSA9IG1lc3NhZ2UgfHwgKHJlc3VsdCA/ICJva2F5IiA6ICJmYWlsZWQiKTsKCWNvbmZpZy5hc3NlcnRpb25zLnB1c2goewoJCXJlc3VsdDogcmVzdWx0LAoJCW1lc3NhZ2U6IHJlc3VsdCA/IG1lc3NhZ2UgKyAiOiAiICsgZXhwZWN0ZWQgOiBtZXNzYWdlICsgIiwgZXhwZWN0ZWQ6ICIgKyBqc0R1bXAucGFyc2UoZXhwZWN0ZWQpICsgIiByZXN1bHQ6ICIgKyBqc0R1bXAucGFyc2UoYWN0dWFsKQoJfSk7Cn0KCi8qKgogKiBUcmlnZ2VyIGFuIGV2ZW50IG9uIGFuIGVsZW1lbnQuCiAqCiAqIEBleGFtcGxlIHRyaWdnZXJFdmVudCggZG9jdW1lbnQuYm9keSwgImNsaWNrIiApOwogKgogKiBAcGFyYW0gRE9NRWxlbWVudCBlbGVtCiAqIEBwYXJhbSBTdHJpbmcgdHlwZQogKi8KZnVuY3Rpb24gdHJpZ2dlckV2ZW50KCBlbGVtLCB0eXBlLCBldmVudCApIHsKCWlmICggJC5icm93c2VyLm1vemlsbGEgfHwgJC5icm93c2VyLm9wZXJhICkgewoJCWV2ZW50ID0gZG9jdW1lbnQuY3JlYXRlRXZlbnQoIk1vdXNlRXZlbnRzIik7CgkJZXZlbnQuaW5pdE1vdXNlRXZlbnQodHlwZSwgdHJ1ZSwgdHJ1ZSwgZWxlbS5vd25lckRvY3VtZW50LmRlZmF1bHRWaWV3LAoJCQkwLCAwLCAwLCAwLCAwLCBmYWxzZSwgZmFsc2UsIGZhbHNlLCBmYWxzZSwgMCwgbnVsbCk7CgkJZWxlbS5kaXNwYXRjaEV2ZW50KCBldmVudCApOwoJfSBlbHNlIGlmICggJC5icm93c2VyLm1zaWUgKSB7CgkJZWxlbS5maXJlRXZlbnQoIm9uIit0eXBlKTsKCX0KfQoKfSkoalF1ZXJ5KTsKCi8qKgogKiBqc0R1bXAKICogQ29weXJpZ2h0IChjKSAyMDA4IEFyaWVsIEZsZXNsZXIgLSBhZmxlc2xlcihhdClnbWFpbChkb3QpY29tIHwgaHR0cDovL2ZsZXNsZXIuYmxvZ3Nwb3QuY29tCiAqIExpY2Vuc2VkIHVuZGVyIEJTRCAoaHR0cDovL3d3dy5vcGVuc291cmNlLm9yZy9saWNlbnNlcy9ic2QtbGljZW5zZS5waHApCiAqIERhdGU6IDUvMTUvMjAwOAogKiBAcHJvamVjdERlc2NyaXB0aW9uIEFkdmFuY2VkIGFuZCBleHRlbnNpYmxlIGRhdGEgZHVtcGluZyBmb3IgSmF2YXNjcmlwdC4KICogQHZlcnNpb24gMS4wLjAKICogQGF1dGhvciBBcmllbCBGbGVzbGVyCiAqIEBsaW5rIHtodHRwOi8vZmxlc2xlci5ibG9nc3BvdC5jb20vMjAwOC8wNS9qc2R1bXAtcHJldHR5LWR1bXAtb2YtYW55LWphdmFzY3JpcHQuaHRtbH0KICovCihmdW5jdGlvbigpewoJZnVuY3Rpb24gcXVvdGUoIHN0ciApewoJCXJldHVybiAnIicgKyBzdHIudG9TdHJpbmcoKS5yZXBsYWNlKC8iL2csICdcXCInKSArICciJzsKCX07CglmdW5jdGlvbiBsaXRlcmFsKCBvICl7CgkJcmV0dXJuIG8gKyAnJzsJCgl9OwoJZnVuY3Rpb24gam9pbiggcHJlLCBhcnIsIHBvc3QgKXsKCQl2YXIgcyA9IGpzRHVtcC5zZXBhcmF0b3IoKSwKCQkJYmFzZSA9IGpzRHVtcC5pbmRlbnQoKTsKCQkJaW5uZXIgPSBqc0R1bXAuaW5kZW50KDEpOwoJCWlmKCBhcnIuam9pbiApCgkJCWFyciA9IGFyci5qb2luKCAnLCcgKyBzICsgaW5uZXIgKTsKCQlpZiggIWFyciApCgkJCXJldHVybiBwcmUgKyBwb3N0OwoJCXJldHVybiBbIHByZSwgaW5uZXIgKyBhcnIsIGJhc2UgKyBwb3N0IF0uam9pbihzKTsKCX07CglmdW5jdGlvbiBhcnJheSggYXJyICl7CgkJdmFyIGkgPSBhcnIubGVuZ3RoLAlyZXQgPSBBcnJheShpKTsJCQkJCQoJCXRoaXMudXAoKTsKCQl3aGlsZSggaS0tICkKCQkJcmV0W2ldID0gdGhpcy5wYXJzZSggYXJyW2ldICk7CQkJCQoJCXRoaXMuZG93bigpOwoJCXJldHVybiBqb2luKCAnWycsIHJldCwgJ10nICk7Cgl9OwoJCgl2YXIgcmVOYW1lID0gL15mdW5jdGlvbiAoXHcrKS87CgkKCXZhciBqc0R1bXAgPSB3aW5kb3cuanNEdW1wID0gewoJCXBhcnNlOmZ1bmN0aW9uKCBvYmosIHR5cGUgKXsvL3R5cGUgaXMgdXNlZCBtb3N0bHkgaW50ZXJuYWxseSwgeW91IGNhbiBmaXggYSAoY3VzdG9tKXR5cGUgaW4gYWR2YW5jZQoJCQl2YXIJcGFyc2VyID0gdGhpcy5wYXJzZXJzWyB0eXBlIHx8IHRoaXMudHlwZU9mKG9iaikgXTsKCQkJdHlwZSA9IHR5cGVvZiBwYXJzZXI7CQkJCgkJCQoJCQlyZXR1cm4gdHlwZSA9PSAnZnVuY3Rpb24nID8gcGFyc2VyLmNhbGwoIHRoaXMsIG9iaiApIDoKCQkJCSAgIHR5cGUgPT0gJ3N0cmluZycgPyBwYXJzZXIgOgoJCQkJICAgdGhpcy5wYXJzZXJzLmVycm9yOwoJCX0sCgkJdHlwZU9mOmZ1bmN0aW9uKCBvYmogKXsKCQkJdmFyIHR5cGUgPSB0eXBlb2Ygb2JqLAoJCQkJZiA9ICdmdW5jdGlvbic7Ly93ZSdsbCB1c2UgaXQgMyB0aW1lcywgc2F2ZSBpdAoJCQlyZXR1cm4gdHlwZSAhPSAnb2JqZWN0JyAmJiB0eXBlICE9IGYgPyB0eXBlIDoKCQkJCSFvYmogPyAnbnVsbCcgOgoJCQkJb2JqLmV4ZWMgPyAncmVnZXhwJyA6Ly8gc29tZSBicm93c2VycyAoRkYpIGNvbnNpZGVyIHJlZ2V4cHMgZnVuY3Rpb25zCgkJCQlvYmouZ2V0SG91cnMgPyAnZGF0ZScgOgoJCQkJb2JqLnNjcm9sbEJ5ID8gICd3aW5kb3cnIDoKCQkJCW9iai5ub2RlTmFtZSA9PSAnI2RvY3VtZW50JyA/ICdkb2N1bWVudCcgOgoJCQkJb2JqLm5vZGVOYW1lID8gJ25vZGUnIDoKCQkJCW9iai5pdGVtID8gJ25vZGVsaXN0JyA6IC8vIFNhZmFyaSByZXBvcnRzIG5vZGVsaXN0cyBhcyBmdW5jdGlvbnMKCQkJCW9iai5jYWxsZWUgPyAnYXJndW1lbnRzJyA6CgkJCQlvYmouY2FsbCB8fCBvYmouY29uc3RydWN0b3IgIT0gQXJyYXkgJiYgLy9hbiBhcnJheSB3b3VsZCBhbHNvIGZhbGwgb24gdGhpcyBoYWNrCgkJCQkJKG9iaisnJykuaW5kZXhPZihmKSAhPSAtMSA/IGYgOiAvL0lFIHJlcG9ydHMgZnVuY3Rpb25zIGxpa2UgYWxlcnQsIGFzIG9iamVjdHMKCQkJCSdsZW5ndGgnIGluIG9iaiA/ICdhcnJheScgOgoJCQkJdHlwZTsKCQl9LAoJCXNlcGFyYXRvcjpmdW5jdGlvbigpewoJCQlyZXR1cm4gdGhpcy5tdWx0aWxpbmUgPwl0aGlzLkhUTUwgPyAnPGJyIC8+JyA6ICdcbicgOiB0aGlzLkhUTUwgPyAnJm5ic3A7JyA6ICcgJzsKCQl9LAoJCWluZGVudDpmdW5jdGlvbiggZXh0cmEgKXsvLyBleHRyYSBjYW4gYmUgYSBudW1iZXIsIHNob3J0Y3V0IGZvciBpbmNyZWFzaW5nLWNhbGxpbmctZGVjcmVhc2luZwoJCQlpZiggIXRoaXMubXVsdGlsaW5lICkKCQkJCXJldHVybiAnJzsKCQkJdmFyIGNociA9IHRoaXMuaW5kZW50Q2hhcjsKCQkJaWYoIHRoaXMuSFRNTCApCgkJCQljaHIgPSBjaHIucmVwbGFjZSgvXHQvZywnICAgJykucmVwbGFjZSgvIC9nLCcmbmJzcDsnKTsKCQkJcmV0dXJuIEFycmF5KCB0aGlzLl9kZXB0aF8gKyAoZXh0cmF8fDApICkuam9pbihjaHIpOwoJCX0sCgkJdXA6ZnVuY3Rpb24oIGEgKXsKCQkJdGhpcy5fZGVwdGhfICs9IGEgfHwgMTsKCQl9LAoJCWRvd246ZnVuY3Rpb24oIGEgKXsKCQkJdGhpcy5fZGVwdGhfIC09IGEgfHwgMTsKCQl9LAoJCXNldFBhcnNlcjpmdW5jdGlvbiggbmFtZSwgcGFyc2VyICl7CgkJCXRoaXMucGFyc2Vyc1tuYW1lXSA9IHBhcnNlcjsKCQl9LAoJCS8vIFRoZSBuZXh0IDMgYXJlIGV4cG9zZWQgc28geW91IGNhbiB1c2UgdGhlbQoJCXF1b3RlOnF1b3RlLCAKCQlsaXRlcmFsOmxpdGVyYWwsCgkJam9pbjpqb2luLAoJCS8vCgkJX2RlcHRoXzogMSwKCQkvLyBUaGlzIGlzIHRoZSBsaXN0IG9mIHBhcnNlcnMsIHRvIG1vZGlmeSB0aGVtLCB1c2UganNEdW1wLnNldFBhcnNlcgoJCXBhcnNlcnM6ewoJCQl3aW5kb3c6ICdbV2luZG93XScsCgkJCWRvY3VtZW50OiAnW0RvY3VtZW50XScsCgkJCWVycm9yOidbRVJST1JdJywgLy93aGVuIG5vIHBhcnNlciBpcyBmb3VuZCwgc2hvdWxkbid0IGhhcHBlbgoJCQl1bmtub3duOiAnW1Vua25vd25dJywKCQkJJ251bGwnOidudWxsJywKCQkJdW5kZWZpbmVkOid1bmRlZmluZWQnLAoJCQknZnVuY3Rpb24nOmZ1bmN0aW9uKCBmbiApewoJCQkJdmFyIHJldCA9ICdmdW5jdGlvbicsCgkJCQkJbmFtZSA9ICduYW1lJyBpbiBmbiA/IGZuLm5hbWUgOiAocmVOYW1lLmV4ZWMoZm4pfHxbXSlbMV07Ly9mdW5jdGlvbnMgbmV2ZXIgaGF2ZSBuYW1lIGluIElFCgkJCQlpZiggbmFtZSApCgkJCQkJcmV0ICs9ICcgJyArIG5hbWU7CgkJCQlyZXQgKz0gJygnOwoJCQkJCgkJCQlyZXQgPSBbIHJldCwgdGhpcy5wYXJzZSggZm4sICdmdW5jdGlvbkFyZ3MnICksICcpeyddLmpvaW4oJycpOwoJCQkJcmV0dXJuIGpvaW4oIHJldCwgdGhpcy5wYXJzZShmbiwnZnVuY3Rpb25Db2RlJyksICd9JyApOwoJCQl9LAoJCQlhcnJheTogYXJyYXksCgkJCW5vZGVsaXN0OiBhcnJheSwKCQkJYXJndW1lbnRzOiBhcnJheSwKCQkJb2JqZWN0OmZ1bmN0aW9uKCBtYXAgKXsKCQkJCXZhciByZXQgPSBbIF07CgkJCQl0aGlzLnVwKCk7CgkJCQlmb3IoIHZhciBrZXkgaW4gbWFwICkKCQkJCQlyZXQucHVzaCggdGhpcy5wYXJzZShrZXksJ2tleScpICsgJzogJyArIHRoaXMucGFyc2UobWFwW2tleV0pICk7CgkJCQl0aGlzLmRvd24oKTsKCQkJCXJldHVybiBqb2luKCAneycsIHJldCwgJ30nICk7CgkJCX0sCgkJCW5vZGU6ZnVuY3Rpb24oIG5vZGUgKXsKCQkJCXZhciBvcGVuID0gdGhpcy5IVE1MID8gJyZsdDsnIDogJzwnLAoJCQkJCWNsb3NlID0gdGhpcy5IVE1MID8gJyZndDsnIDogJz4nOwoJCQkJCQoJCQkJdmFyIHRhZyA9IG5vZGUubm9kZU5hbWUudG9Mb3dlckNhc2UoKSwKCQkJCQlyZXQgPSBvcGVuICsgdGFnOwoJCQkJCQoJCQkJZm9yKCB2YXIgYSBpbiB0aGlzLkRPTUF0dHJzICl7CgkJCQkJdmFyIHZhbCA9IG5vZGVbdGhpcy5ET01BdHRyc1thXV07CgkJCQkJaWYoIHZhbCApCgkJCQkJCXJldCArPSAnICcgKyBhICsgJz0nICsgdGhpcy5wYXJzZSggdmFsLCAnYXR0cmlidXRlJyApOwoJCQkJfQoJCQkJcmV0dXJuIHJldCArIGNsb3NlICsgb3BlbiArICcvJyArIHRhZyArIGNsb3NlOwoJCQl9LAoJCQlmdW5jdGlvbkFyZ3M6ZnVuY3Rpb24oIGZuICl7Ly9mdW5jdGlvbiBjYWxscyBpdCBpbnRlcm5hbGx5LCBpdCdzIHRoZSBhcmd1bWVudHMgcGFydCBvZiB0aGUgZnVuY3Rpb24KCQkJCXZhciBsID0gZm4ubGVuZ3RoOwoJCQkJaWYoICFsICkgcmV0dXJuICcnOwkJCQkKCQkJCQoJCQkJdmFyIGFyZ3MgPSBBcnJheShsKTsKCQkJCXdoaWxlKCBsLS0gKQoJCQkJCWFyZ3NbbF0gPSBTdHJpbmcuZnJvbUNoYXJDb2RlKDk3K2wpOy8vOTcgaXMgJ2EnCgkJCQlyZXR1cm4gJyAnICsgYXJncy5qb2luKCcsICcpICsgJyAnOwoJCQl9LAoJCQlrZXk6cXVvdGUsIC8vb2JqZWN0IGNhbGxzIGl0IGludGVybmFsbHksIHRoZSBrZXkgcGFydCBvZiBhbiBpdGVtIGluIGEgbWFwCgkJCWZ1bmN0aW9uQ29kZTonW2NvZGVdJywgLy9mdW5jdGlvbiBjYWxscyBpdCBpbnRlcm5hbGx5LCBpdCdzIHRoZSBjb250ZW50IG9mIHRoZSBmdW5jdGlvbgoJCQlhdHRyaWJ1dGU6cXVvdGUsIC8vbm9kZSBjYWxscyBpdCBpbnRlcm5hbGx5LCBpdCdzIGFuIGh0bWwgYXR0cmlidXRlIHZhbHVlCgkJCXN0cmluZzpxdW90ZSwKCQkJZGF0ZTpxdW90ZSwKCQkJcmVnZXhwOmxpdGVyYWwsIC8vcmVnZXgKCQkJbnVtYmVyOmxpdGVyYWwsCgkJCSdib29sZWFuJzpsaXRlcmFsCgkJfSwKCQlET01BdHRyczp7Ly9hdHRyaWJ1dGVzIHRvIGR1bXAgZnJvbSBub2RlcywgbmFtZT0+cmVhbE5hbWUKCQkJaWQ6J2lkJywKCQkJbmFtZTonbmFtZScsCgkJCSdjbGFzcyc6J2NsYXNzTmFtZScKCQl9LAoJCUhUTUw6ZmFsc2UsLy9pZiB0cnVlLCBlbnRpdGllcyBhcmUgZXNjYXBlZCAoIDwsID4sIFx0LCBzcGFjZSBhbmQgXG4gKQoJCWluZGVudENoYXI6JyAgICcsLy9pbmRlbnRhdGlvbiB1bml0CgkJbXVsdGlsaW5lOnRydWUgLy9pZiB0cnVlLCBpdGVtcyBpbiBhIGNvbGxlY3Rpb24sIGFyZSBzZXBhcmF0ZWQgYnkgYSBcbiwgZWxzZSBqdXN0IGEgc3BhY2UuCgl9OwoKfSkoKTsK",
                "body": "LyoKICogUVVuaXQgLSBqUXVlcnkgdW5pdCB0ZXN0cnVubmVyCiAqIAogKiBodHRwOi8vZG9jcy5qcXVlcnkuY29tL1FVbml0CiAqCiAqIENvcHlyaWdodCAoYykgMjAwOCBKb2huIFJlc2lnLCBKw7ZybiBaYWVmZmVyZXIKICogRHVhbCBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIChNSVQtTElDRU5TRS50eHQpCiAqIGFuZCBHUEwgKEdQTC1MSUNFTlNFLnR4dCkgbGljZW5zZXMuCiAqCiAqICRJZCQKICovCgooZnVuY3Rpb24oJCkgewoKLy8gVGVzdHMgZm9yIGVxdWFsaXR5IGFueSBKYXZhU2NyaXB0IHR5cGUgYW5kIHN0cnVjdHVyZSB3aXRob3V0IHVuZXhwZWN0ZWQgcmVzdWx0cy4KLy8gRGlzY3Vzc2lvbnMgYW5kIHJlZmVyZW5jZTogaHR0cDovL3BoaWxyYXRoZS5jb20vYXJ0aWNsZXMvZXF1aXYKLy8gVGVzdCBzdWl0ZXM6IGh0dHA6Ly9waGlscmF0aGUuY29tL3Rlc3RzL2VxdWl2Ci8vIEF1dGhvcjogUGhpbGlwcGUgUmF0aMOpIDxwcmF0aGVAZ21haWwuY29tPgp2YXIgZXF1aXYgPSBmdW5jdGlvbiAoKSB7CgogICAgdmFyIGlubmVyRXF1aXY7IC8vIHRoZSByZWFsIGVxdWl2IGZ1bmN0aW9uCiAgICB2YXIgY2FsbGVycyA9IFtdOyAvLyBzdGFjayB0byBkZWNpZGUgYmV0d2VlbiBza2lwL2Fib3J0IGZ1bmN0aW9ucwoKICAgIC8vIERldGVybWluZSB3aGF0IGlzIG8uCiAgICBmdW5jdGlvbiBob296aXQobykgewogICAgICAgIGlmICh0eXBlb2YgbyA9PT0gInN0cmluZyIpIHsKICAgICAgICAgICAgcmV0dXJuICJzdHJpbmciOwoKICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBvID09PSAiYm9vbGVhbiIpIHsKICAgICAgICAgICAgcmV0dXJuICJib29sZWFuIjsKCiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgbyA9PT0gIm51bWJlciIpIHsKCiAgICAgICAgICAgIGlmIChpc05hTihvKSkgewogICAgICAgICAgICAgICAgcmV0dXJuICJuYW4iOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuICJudW1iZXIiOwogICAgICAgICAgICB9CgogICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIG8gPT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgIHJldHVybiAidW5kZWZpbmVkIjsKCiAgICAgICAgLy8gY29uc2lkZXI6IHR5cGVvZiBudWxsID09PSBvYmplY3QKICAgICAgICB9IGVsc2UgaWYgKG8gPT09IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuICJudWxsIjsKCiAgICAgICAgLy8gY29uc2lkZXI6IHR5cGVvZiBbXSA9PT0gb2JqZWN0CiAgICAgICAgfSBlbHNlIGlmIChvIGluc3RhbmNlb2YgQXJyYXkpIHsKICAgICAgICAgICAgcmV0dXJuICJhcnJheSI7CiAgICAgICAgCiAgICAgICAgLy8gY29uc2lkZXI6IHR5cGVvZiBuZXcgRGF0ZSgpID09PSBvYmplY3QKICAgICAgICB9IGVsc2UgaWYgKG8gaW5zdGFuY2VvZiBEYXRlKSB7CiAgICAgICAgICAgIHJldHVybiAiZGF0ZSI7CgogICAgICAgIC8vIGNvbnNpZGVyOiAvLi8gaW5zdGFuY2VvZiBPYmplY3Q7CiAgICAgICAgLy8gICAgICAgICAgIC8uLyBpbnN0YW5jZW9mIFJlZ0V4cDsKICAgICAgICAvLyAgICAgICAgICB0eXBlb2YgLy4vID09PSAiZnVuY3Rpb24iOyAvLyA9PiBmYWxzZSBpbiBJRSBhbmQgT3BlcmEsCiAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnVlIGluIEZGIGFuZCBTYWZhcmkKICAgICAgICB9IGVsc2UgaWYgKG8gaW5zdGFuY2VvZiBSZWdFeHApIHsKICAgICAgICAgICAgcmV0dXJuICJyZWdleHAiOwoKICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBvID09PSAib2JqZWN0IikgewogICAgICAgICAgICByZXR1cm4gIm9iamVjdCI7CgogICAgICAgIH0gZWxzZSBpZiAobyBpbnN0YW5jZW9mIEZ1bmN0aW9uKSB7CiAgICAgICAgICAgIHJldHVybiAiZnVuY3Rpb24iOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBDYWxsIHRoZSBvIHJlbGF0ZWQgY2FsbGJhY2sgd2l0aCB0aGUgZ2l2ZW4gYXJndW1lbnRzLgogICAgZnVuY3Rpb24gYmluZENhbGxiYWNrcyhvLCBjYWxsYmFja3MsIGFyZ3MpIHsKICAgICAgICB2YXIgcHJvcCA9IGhvb3ppdChvKTsKICAgICAgICBpZiAocHJvcCkgewogICAgICAgICAgICBpZiAoaG9veml0KGNhbGxiYWNrc1twcm9wXSkgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFja3NbcHJvcF0uYXBwbHkoY2FsbGJhY2tzLCBhcmdzKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFja3NbcHJvcF07IC8vIG9yIHVuZGVmaW5lZAogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHZhciBjYWxsYmFja3MgPSBmdW5jdGlvbiAoKSB7CgogICAgICAgIC8vIGZvciBzdHJpbmcsIGJvb2xlYW4sIG51bWJlciBhbmQgbnVsbAogICAgICAgIGZ1bmN0aW9uIHVzZVN0cmljdEVxdWFsaXR5KGIsIGEpIHsKICAgICAgICAgICAgcmV0dXJuIGEgPT09IGI7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gewogICAgICAgICAgICAic3RyaW5nIjogdXNlU3RyaWN0RXF1YWxpdHksCiAgICAgICAgICAgICJib29sZWFuIjogdXNlU3RyaWN0RXF1YWxpdHksCiAgICAgICAgICAgICJudW1iZXIiOiB1c2VTdHJpY3RFcXVhbGl0eSwKICAgICAgICAgICAgIm51bGwiOiB1c2VTdHJpY3RFcXVhbGl0eSwKICAgICAgICAgICAgInVuZGVmaW5lZCI6IHVzZVN0cmljdEVxdWFsaXR5LAoKICAgICAgICAgICAgIm5hbiI6IGZ1bmN0aW9uIChiKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gaXNOYU4oYik7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICAiZGF0ZSI6IGZ1bmN0aW9uIChiLCBhKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gaG9veml0KGIpID09PSAiZGF0ZSIgJiYgYS52YWx1ZU9mKCkgPT09IGIudmFsdWVPZigpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgInJlZ2V4cCI6IGZ1bmN0aW9uIChiLCBhKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gaG9veml0KGIpID09PSAicmVnZXhwIiAmJgogICAgICAgICAgICAgICAgICAgIGEuc291cmNlID09PSBiLnNvdXJjZSAmJiAvLyB0aGUgcmVnZXggaXRzZWxmCiAgICAgICAgICAgICAgICAgICAgYS5nbG9iYWwgPT09IGIuZ2xvYmFsICYmIC8vIGFuZCBpdHMgbW9kaWZlcnMgKGdtaSkgLi4uCiAgICAgICAgICAgICAgICAgICAgYS5pZ25vcmVDYXNlID09PSBiLmlnbm9yZUNhc2UgJiYKICAgICAgICAgICAgICAgICAgICBhLm11bHRpbGluZSA9PT0gYi5tdWx0aWxpbmU7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICAvLyAtIHNraXAgd2hlbiB0aGUgcHJvcGVydHkgaXMgYSBtZXRob2Qgb2YgYW4gaW5zdGFuY2UgKE9PUCkKICAgICAgICAgICAgLy8gLSBhYm9ydCBvdGhlcndpc2UsCiAgICAgICAgICAgIC8vICAgaW5pdGlhbCA9PT0gd291bGQgaGF2ZSBjYXRjaCBpZGVudGljYWwgcmVmZXJlbmNlcyBhbnl3YXkKICAgICAgICAgICAgImZ1bmN0aW9uIjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIGNhbGxlciA9IGNhbGxlcnNbY2FsbGVycy5sZW5ndGggLSAxXTsKICAgICAgICAgICAgICAgIHJldHVybiBjYWxsZXIgIT09IE9iamVjdCAmJgogICAgICAgICAgICAgICAgICAgICAgICB0eXBlb2YgY2FsbGVyICE9PSAidW5kZWZpbmVkIjsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICJhcnJheSI6IGZ1bmN0aW9uIChiLCBhKSB7CiAgICAgICAgICAgICAgICB2YXIgaTsKICAgICAgICAgICAgICAgIHZhciBsZW47CgogICAgICAgICAgICAgICAgLy8gYiBjb3VsZCBiZSBhbiBvYmplY3QgbGl0ZXJhbCBoZXJlCiAgICAgICAgICAgICAgICBpZiAoICEgKGhvb3ppdChiKSA9PT0gImFycmF5IikpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbGVuID0gYS5sZW5ndGg7CiAgICAgICAgICAgICAgICBpZiAobGVuICE9PSBiLmxlbmd0aCkgeyAvLyBzYWZlIGFuZCBmYXN0ZXIKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBpZiggISBpbm5lckVxdWl2KGFbaV0sIGJbaV0pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICJvYmplY3QiOiBmdW5jdGlvbiAoYiwgYSkgewogICAgICAgICAgICAgICAgdmFyIGk7CiAgICAgICAgICAgICAgICB2YXIgZXEgPSB0cnVlOyAvLyB1bmxlc3Mgd2UgY2FuIHByb292ZSBpdAogICAgICAgICAgICAgICAgdmFyIGFQcm9wZXJ0aWVzID0gW10sIGJQcm9wZXJ0aWVzID0gW107IC8vIGNvbGxlY3Rpb24gb2Ygc3RyaW5ncwoKICAgICAgICAgICAgICAgIC8vIGNvbXBhcmluZyBjb25zdHJ1Y3RvcnMgaXMgbW9yZSBzdHJpY3QgdGhhbiB1c2luZyBpbnN0YW5jZW9mCiAgICAgICAgICAgICAgICBpZiAoIGEuY29uc3RydWN0b3IgIT09IGIuY29uc3RydWN0b3IpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gc3RhY2sgY29uc3RydWN0b3IgYmVmb3JlIHRyYXZlcnNpbmcgcHJvcGVydGllcwogICAgICAgICAgICAgICAgY2FsbGVycy5wdXNoKGEuY29uc3RydWN0b3IpOwoKICAgICAgICAgICAgICAgIGZvciAoaSBpbiBhKSB7IC8vIGJlIHN0cmljdDogZG9uJ3QgZW5zdXJlcyBoYXNPd25Qcm9wZXJ0eSBhbmQgZ28gZGVlcAoKICAgICAgICAgICAgICAgICAgICBhUHJvcGVydGllcy5wdXNoKGkpOyAvLyBjb2xsZWN0IGEncyBwcm9wZXJ0aWVzCgogICAgICAgICAgICAgICAgICAgIGlmICggISBpbm5lckVxdWl2KGFbaV0sIGJbaV0pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGVxID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGNhbGxlcnMucG9wKCk7IC8vIHVuc3RhY2ssIHdlIGFyZSBkb25lCgogICAgICAgICAgICAgICAgZm9yIChpIGluIGIpIHsKICAgICAgICAgICAgICAgICAgICBiUHJvcGVydGllcy5wdXNoKGkpOyAvLyBjb2xsZWN0IGIncyBwcm9wZXJ0aWVzCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gRW5zdXJlcyBpZGVudGljYWwgcHJvcGVydGllcyBuYW1lCiAgICAgICAgICAgICAgICByZXR1cm4gZXEgJiYgaW5uZXJFcXVpdihhUHJvcGVydGllcy5zb3J0KCksIGJQcm9wZXJ0aWVzLnNvcnQoKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgfSgpOwoKICAgIGlubmVyRXF1aXYgPSBmdW5jdGlvbiAoKSB7IC8vIGNhbiB0YWtlIG11bHRpcGxlIGFyZ3VtZW50cwogICAgICAgIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmFwcGx5KGFyZ3VtZW50cyk7CiAgICAgICAgaWYgKGFyZ3MubGVuZ3RoIDwgMikgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsgLy8gZW5kIHRyYW5zaXRpb24KICAgICAgICB9CgogICAgICAgIHJldHVybiAoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgICAgaWYgKGEgPT09IGIpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOyAvLyBjYXRjaCB0aGUgbW9zdCB5b3UgY2FuCgogICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBhICE9PSB0eXBlb2YgYiB8fCBhID09PSBudWxsIHx8IGIgPT09IG51bGwgfHwgdHlwZW9mIGEgPT09ICJ1bmRlZmluZWQiIHx8IHR5cGVvZiBiID09PSAidW5kZWZpbmVkIikgewogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOyAvLyBkb24ndCBsb3NlIHRpbWUgd2l0aCBlcnJvciBwcm9uZSBjYXNlcwoKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBiaW5kQ2FsbGJhY2tzKGEsIGNhbGxiYWNrcywgW2IsIGFdKTsKICAgICAgICAgICAgfQoKICAgICAgICAvLyBhcHBseSB0cmFuc2l0aW9uIHdpdGggKDEuLm4pIGFyZ3VtZW50cwogICAgICAgIH0pKGFyZ3NbMF0sIGFyZ3NbMV0pICYmIGFyZ3VtZW50cy5jYWxsZWUuYXBwbHkodGhpcywgYXJncy5zcGxpY2UoMSwgYXJncy5sZW5ndGggLTEpKTsKICAgIH07CgogICAgcmV0dXJuIGlubmVyRXF1aXY7Cn0oKTsgLy8gZXF1aXYKCQp2YXIgY29uZmlnID0gewoJc3RhdHM6IHsKCQlhbGw6IDAsCgkJYmFkOiAwCgl9LAoJcXVldWU6IFtdLAoJLy8gYmxvY2sgdW50aWwgZG9jdW1lbnQgcmVhZHkKCWJsb2NraW5nOiB0cnVlLAoJLy9yZXN0cmljdCBtb2R1bGVzL3Rlc3RzIGJ5IGdldCBwYXJhbWV0ZXJzCglmaWx0ZXJzOiBsb2NhdGlvbi5zZWFyY2gubGVuZ3RoID4gMSAmJiAkLm1hcCggbG9jYXRpb24uc2VhcmNoLnNsaWNlKDEpLnNwbGl0KCcmJyksIGRlY29kZVVSSUNvbXBvbmVudCApLAoJaXNMb2NhbDogISEod2luZG93LmxvY2F0aW9uLnByb3RvY29sID09ICdmaWxlOicpCn07CgovLyBwdWJsaWMgQVBJIGFzIGdsb2JhbCBtZXRob2RzCiQuZXh0ZW5kKHdpbmRvdywgewoJdGVzdDogdGVzdCwKCW1vZHVsZTogbW9kdWxlLAoJZXhwZWN0OiBleHBlY3QsCglvazogb2ssCgllcXVhbHM6IGVxdWFscywKCXN0YXJ0OiBzdGFydCwKCXN0b3A6IHN0b3AsCglyZXNldDogcmVzZXQsCglpc0xvY2FsOiBjb25maWcuaXNMb2NhbCwKCXNhbWU6IGZ1bmN0aW9uKGEsIGIsIG1lc3NhZ2UpIHsKCQlwdXNoKGVxdWl2KGEsIGIpLCBhLCBiLCBtZXNzYWdlKTsKCX0sCglRVW5pdDogewoJCWVxdWl2OiBlcXVpdgoJfSwKCS8vIGxlZ2FjeSBtZXRob2RzIGJlbG93Cglpc1NldDogaXNTZXQsCglpc09iajogaXNPYmosCgljb21wYXJlOiBmdW5jdGlvbigpIHsKCQl0aHJvdyAiY29tcGFyZSBpcyBkZXByZWNhdGVkIC0gdXNlIHNhbWUoKSBpbnN0ZWFkIjsKCX0sCgljb21wYXJlMjogZnVuY3Rpb24oKSB7CgkJdGhyb3cgImNvbXBhcmUyIGlzIGRlcHJlY2F0ZWQgLSB1c2Ugc2FtZSgpIGluc3RlYWQiOwoJfSwKCXNlcmlhbEFycmF5OiBmdW5jdGlvbigpIHsKCQl0aHJvdyAic2VyaWFsQXJyYXkgaXMgZGVwcmVjYXRlZCAtIHVzZSBqc0R1bXAucGFyc2UoKSBpbnN0ZWFkIjsKCX0sCglxOiBxLAoJdDogdCwKCXVybDogdXJsLAoJdHJpZ2dlckV2ZW50OiB0cmlnZ2VyRXZlbnQKfSk7CgokKHdpbmRvdykubG9hZChmdW5jdGlvbigpIHsKCSQoJyN1c2VyQWdlbnQnKS5odG1sKG5hdmlnYXRvci51c2VyQWdlbnQpOwoJdmFyIGhlYWQgPSAkKCc8ZGl2IGNsYXNzPSJ0ZXN0cnVubmVyLXRvb2xiYXIiPjxsYWJlbCBmb3I9ImZpbHRlciI+SGlkZSBwYXNzZWQgdGVzdHM8L2xhYmVsPjwvZGl2PicpLmluc2VydEFmdGVyKCIjdXNlckFnZW50Iik7CgkkKCc8aW5wdXQgdHlwZT0iY2hlY2tib3giIGlkPSJmaWx0ZXIiIC8+JykuYXR0cigiZGlzYWJsZWQiLCB0cnVlKS5wcmVwZW5kVG8oaGVhZCkuY2xpY2soZnVuY3Rpb24oKSB7CgkJJCgnbGkucGFzcycpW3RoaXMuY2hlY2tlZCA/ICdoaWRlJyA6ICdzaG93J10oKTsKCX0pOwoJcnVuVGVzdCgpOwkKfSk7CgpmdW5jdGlvbiBzeW5jaHJvbml6ZShjYWxsYmFjaykgewoJY29uZmlnLnF1ZXVlLnB1c2goY2FsbGJhY2spOwoJaWYoIWNvbmZpZy5ibG9ja2luZykgewoJCXByb2Nlc3MoKTsKCX0KfQoKZnVuY3Rpb24gcHJvY2VzcygpIHsKCXdoaWxlKGNvbmZpZy5xdWV1ZS5sZW5ndGggJiYgIWNvbmZpZy5ibG9ja2luZykgewoJCWNvbmZpZy5xdWV1ZS5zaGlmdCgpKCk7Cgl9Cn0KCmZ1bmN0aW9uIHN0b3AodGltZW91dCkgewoJY29uZmlnLmJsb2NraW5nID0gdHJ1ZTsKCWlmICh0aW1lb3V0KQoJCWNvbmZpZy50aW1lb3V0ID0gc2V0VGltZW91dChmdW5jdGlvbigpIHsKCQkJb2soIGZhbHNlLCAiVGVzdCB0aW1lZCBvdXQiICk7CgkJCXN0YXJ0KCk7CgkJfSwgdGltZW91dCk7Cn0KZnVuY3Rpb24gc3RhcnQoKSB7CgkvLyBBIHNsaWdodCBkZWxheSwgdG8gYXZvaWQgYW55IGN1cnJlbnQgY2FsbGJhY2tzCglzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewoJCWlmKGNvbmZpZy50aW1lb3V0KQoJCQljbGVhclRpbWVvdXQoY29uZmlnLnRpbWVvdXQpOwoJCWNvbmZpZy5ibG9ja2luZyA9IGZhbHNlOwoJCXByb2Nlc3MoKTsKCX0sIDEzKTsKfQoKZnVuY3Rpb24gdmFsaWRUZXN0KCBuYW1lICkgewoJdmFyIGZpbHRlcnMgPSBjb25maWcuZmlsdGVyczsKCWlmKCAhZmlsdGVycyApCgkJcmV0dXJuIHRydWU7CgoJdmFyIGkgPSBmaWx0ZXJzLmxlbmd0aCwKCQlydW4gPSBmYWxzZTsKCXdoaWxlKCBpLS0gKXsKCQl2YXIgZmlsdGVyID0gZmlsdGVyc1tpXSwKCQkJbm90ID0gZmlsdGVyLmNoYXJBdCgwKSA9PSAnISc7CgkJaWYoIG5vdCApIAoJCQlmaWx0ZXIgPSBmaWx0ZXIuc2xpY2UoMSk7CgkJaWYoIG5hbWUuaW5kZXhPZihmaWx0ZXIpICE9IC0xICkKCQkJcmV0dXJuICFub3Q7CgkJaWYoIG5vdCApCgkJCXJ1biA9IHRydWU7Cgl9CglyZXR1cm4gcnVuOwp9CgpmdW5jdGlvbiBydW5UZXN0KCkgewoJY29uZmlnLmJsb2NraW5nID0gZmFsc2U7Cgl2YXIgc3RhcnRlZCA9ICtuZXcgRGF0ZTsKCWNvbmZpZy5maXh0dXJlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21haW4nKS5pbm5lckhUTUw7Cgljb25maWcuYWpheFNldHRpbmdzID0gJC5hamF4U2V0dGluZ3M7CglzeW5jaHJvbml6ZShmdW5jdGlvbigpIHsKCQkkKCc8cCBpZD0idGVzdHJlc3VsdCIgY2xhc3M9InJlc3VsdCI+JykuaHRtbChbJ1Rlc3RzIGNvbXBsZXRlZCBpbiAnLAoJCQkrbmV3IERhdGUgLSBzdGFydGVkLCAnIG1pbGxpc2Vjb25kcy48YnIvPicsCgkJCSc8c3BhbiBjbGFzcz0iYmFkIj4nLCBjb25maWcuc3RhdHMuYmFkLCAnPC9zcGFuPiB0ZXN0cyBvZiA8c3BhbiBjbGFzcz0iYWxsIj4nLCBjb25maWcuc3RhdHMuYWxsLCAnPC9zcGFuPiBmYWlsZWQuPC9wPiddCgkJCS5qb2luKCcnKSkKCQkJLmFwcGVuZFRvKCJib2R5Iik7CgkJJCgiI2Jhbm5lciIpLmFkZENsYXNzKGNvbmZpZy5zdGF0cy5iYWQgPyAiZmFpbCIgOiAicGFzcyIpOwoJfSk7Cn0KCmZ1bmN0aW9uIHRlc3QobmFtZSwgY2FsbGJhY2spIHsKCWlmKGNvbmZpZy5jdXJyZW50TW9kdWxlKQoJCW5hbWUgPSBjb25maWcuY3VycmVudE1vZHVsZSArICIgbW9kdWxlOiAiICsgbmFtZTsKCXZhciBsaWZlY3ljbGUgPSAkLmV4dGVuZCh7CgkJc2V0dXA6IGZ1bmN0aW9uKCkge30sCgkJdGVhcmRvd246IGZ1bmN0aW9uKCkge30KCX0sIGNvbmZpZy5tb2R1bGVMaWZlY3ljbGUpOwoJCglpZiAoICF2YWxpZFRlc3QobmFtZSkgKQoJCXJldHVybjsKCQkKCXN5bmNocm9uaXplKGZ1bmN0aW9uKCkgewoJCWNvbmZpZy5hc3NlcnRpb25zID0gW107CgkJY29uZmlnLmV4cGVjdGVkID0gbnVsbDsKCQl0cnkgewoJCQlsaWZlY3ljbGUuc2V0dXAoKTsKCQkJY2FsbGJhY2soKTsKCQkJbGlmZWN5Y2xlLnRlYXJkb3duKCk7CgkJfSBjYXRjaChlKSB7CgkJCWlmKCB0eXBlb2YgY29uc29sZSAhPSAidW5kZWZpbmVkIiAmJiBjb25zb2xlLmVycm9yICYmIGNvbnNvbGUud2FybiApIHsKCQkJCWNvbnNvbGUuZXJyb3IoIlRlc3QgIiArIG5hbWUgKyAiIGRpZWQsIGV4Y2VwdGlvbiBhbmQgdGVzdCBmb2xsb3dzIik7CgkJCQljb25zb2xlLmVycm9yKGUpOwoJCQkJY29uc29sZS53YXJuKGNhbGxiYWNrLnRvU3RyaW5nKCkpOwoJCQl9CgkJCWNvbmZpZy5hc3NlcnRpb25zLnB1c2goIHsKCQkJCXJlc3VsdDogZmFsc2UsCgkJCQltZXNzYWdlOiAiRGllZCBvbiB0ZXN0ICMiICsgKGNvbmZpZy5hc3NlcnRpb25zLmxlbmd0aCArIDEpICsgIjogIiArIGUubWVzc2FnZQoJCQl9KTsKCQl9Cgl9KTsKCXN5bmNocm9uaXplKGZ1bmN0aW9uKCkgewoJCXRyeSB7CgkJCXJlc2V0KCk7CgkJfSBjYXRjaChlKSB7CgkJCWlmKCB0eXBlb2YgY29uc29sZSAhPSAidW5kZWZpbmVkIiAmJiBjb25zb2xlLmVycm9yICYmIGNvbnNvbGUud2FybiApIHsKCQkJCWNvbnNvbGUuZXJyb3IoInJlc2V0KCkgZmFpbGVkLCBmb2xsb3dpbmcgVGVzdCAiICsgbmFtZSArICIsIGV4Y2VwdGlvbiBhbmQgcmVzZXQgZm4gZm9sbG93cyIpOwoJCQkJY29uc29sZS5lcnJvcihlKTsKCQkJCWNvbnNvbGUud2FybihyZXNldC50b1N0cmluZygpKTsKCQkJfQoJCX0KCQkKCQlpZihjb25maWcuZXhwZWN0ZWQgJiYgY29uZmlnLmV4cGVjdGVkICE9IGNvbmZpZy5hc3NlcnRpb25zLmxlbmd0aCkgewoJCQljb25maWcuYXNzZXJ0aW9ucy5wdXNoKHsKCQkJCXJlc3VsdDogZmFsc2UsCgkJCQltZXNzYWdlOiAiRXhwZWN0ZWQgIiArIGNvbmZpZy5leHBlY3RlZCArICIgYXNzZXJ0aW9ucywgYnV0ICIgKyBjb25maWcuYXNzZXJ0aW9ucy5sZW5ndGggKyAiIHdlcmUgcnVuIgoJCQl9KTsKCQl9CgkJCgkJdmFyIGdvb2QgPSAwLCBiYWQgPSAwOwoJCXZhciBvbCAgPSAkKCI8b2wvPiIpLmhpZGUoKTsKCQljb25maWcuc3RhdHMuYWxsICs9IGNvbmZpZy5hc3NlcnRpb25zLmxlbmd0aDsKCQlmb3IgKCB2YXIgaSA9IDA7IGkgPCBjb25maWcuYXNzZXJ0aW9ucy5sZW5ndGg7IGkrKyApIHsKCQkJdmFyIGFzc2VydGlvbiA9IGNvbmZpZy5hc3NlcnRpb25zW2ldOwoJCQkkKCI8bGkvPiIpLmFkZENsYXNzKGFzc2VydGlvbi5yZXN1bHQgPyAicGFzcyIgOiAiZmFpbCIpLnRleHQoYXNzZXJ0aW9uLm1lc3NhZ2UgfHwgIihubyBtZXNzYWdlKSIpLmFwcGVuZFRvKG9sKTsKCQkJYXNzZXJ0aW9uLnJlc3VsdCA/IGdvb2QrKyA6IGJhZCsrOwoJCX0KCQljb25maWcuc3RhdHMuYmFkICs9IGJhZDsKCQoJCXZhciBiID0gJCgiPHN0cm9uZy8+IikuaHRtbChuYW1lICsgIiA8YiBzdHlsZT0nY29sb3I6YmxhY2s7Jz4oPGIgY2xhc3M9J2ZhaWwnPiIgKyBiYWQgKyAiPC9iPiwgPGIgY2xhc3M9J3Bhc3MnPiIgKyBnb29kICsgIjwvYj4sICIgKyBjb25maWcuYXNzZXJ0aW9ucy5sZW5ndGggKyAiKTwvYj4iKQoJCS5jbGljayhmdW5jdGlvbigpewoJCQkkKHRoaXMpLm5leHQoKS50b2dnbGUoKTsKCQl9KQoJCS5kYmxjbGljayhmdW5jdGlvbihldmVudCkgewoJCQl2YXIgdGFyZ2V0ID0gJChldmVudC50YXJnZXQpLmZpbHRlcigic3Ryb25nIikuY2xvbmUoKTsKCQkJaWYgKCB0YXJnZXQubGVuZ3RoICkgewoJCQkJdGFyZ2V0LmNoaWxkcmVuKCkucmVtb3ZlKCk7CgkJCQlsb2NhdGlvbi5ocmVmID0gbG9jYXRpb24uaHJlZi5tYXRjaCgvXiguKz8pKFw/LiopPyQvKVsxXSArICI/IiArIGVuY29kZVVSSUNvbXBvbmVudCgkLnRyaW0odGFyZ2V0LnRleHQoKSkpOwoJCQl9CgkJfSk7CgkJCgkJJCgiPGxpLz4iKS5hZGRDbGFzcyhiYWQgPyAiZmFpbCIgOiAicGFzcyIpLmFwcGVuZChiKS5hcHBlbmQob2wpLmFwcGVuZFRvKCIjdGVzdHMiKTsKCQoJCWlmKGJhZCkgewoJCQkkKCIjZmlsdGVyIikuYXR0cigiZGlzYWJsZWQiLCBudWxsKTsKCQl9Cgl9KTsKfQoKLy8gY2FsbCBvbiBzdGFydCBvZiBtb2R1bGUgdGVzdCB0byBwcmVwZW5kIG5hbWUgdG8gYWxsIHRlc3RzCmZ1bmN0aW9uIG1vZHVsZShuYW1lLCBsaWZlY3ljbGUpIHsKCWNvbmZpZy5jdXJyZW50TW9kdWxlID0gbmFtZTsKCWNvbmZpZy5tb2R1bGVMaWZlY3ljbGUgPSBsaWZlY3ljbGU7Cn0KCi8qKgogKiBTcGVjaWZ5IHRoZSBudW1iZXIgb2YgZXhwZWN0ZWQgYXNzZXJ0aW9ucyB0byBndXJhbnRlZSB0aGF0IGZhaWxlZCB0ZXN0IChubyBhc3NlcnRpb25zIGFyZSBydW4gYXQgYWxsKSBkb24ndCBzbGlwIHRocm91Z2guCiAqLwpmdW5jdGlvbiBleHBlY3QoYXNzZXJ0cykgewoJY29uZmlnLmV4cGVjdGVkID0gYXNzZXJ0czsKfQoKLyoqCiAqIFJlc2V0cyB0aGUgdGVzdCBzZXR1cC4gVXNlZnVsIGZvciB0ZXN0cyB0aGF0IG1vZGlmeSB0aGUgRE9NLgogKi8KZnVuY3Rpb24gcmVzZXQoKSB7CgkkKCIjbWFpbiIpLmh0bWwoIGNvbmZpZy5maXh0dXJlICk7CgkkLmV2ZW50Lmdsb2JhbCA9IHt9OwoJJC5hamF4U2V0dGluZ3MgPSAkLmV4dGVuZCh7fSwgY29uZmlnLmFqYXhTZXR0aW5ncyk7Cn0KCi8qKgogKiBBc3NlcnRzIHRydWUuCiAqIEBleGFtcGxlIG9rKCAkKCJhIikuc2l6ZSgpID4gNSwgIlRoZXJlIG11c3QgYmUgYXQgbGVhc3QgNSBhbmNob3JzIiApOwogKi8KZnVuY3Rpb24gb2soYSwgbXNnKSB7Cgljb25maWcuYXNzZXJ0aW9ucy5wdXNoKHsKCQlyZXN1bHQ6ICEhYSwKCQltZXNzYWdlOiBtc2cKCX0pOwp9CgovKioKICogQXNzZXJ0cyB0aGF0IHR3byBhcnJheXMgYXJlIHRoZSBzYW1lCiAqLwpmdW5jdGlvbiBpc1NldChhLCBiLCBtc2cpIHsKCWZ1bmN0aW9uIHNlcmlhbEFycmF5KCBhICkgewoJCXZhciByID0gW107CgkJCgkJaWYgKCBhICYmIGEubGVuZ3RoICkKCSAgICAgICAgZm9yICggdmFyIGkgPSAwOyBpIDwgYS5sZW5ndGg7IGkrKyApIHsKCSAgICAgICAgICAgIHZhciBzdHIgPSBhW2ldLm5vZGVOYW1lOwoJICAgICAgICAgICAgaWYgKCBzdHIgKSB7CgkgICAgICAgICAgICAgICAgc3RyID0gc3RyLnRvTG93ZXJDYXNlKCk7CgkgICAgICAgICAgICAgICAgaWYgKCBhW2ldLmlkICkKCSAgICAgICAgICAgICAgICAgICAgc3RyICs9ICIjIiArIGFbaV0uaWQ7CgkgICAgICAgICAgICB9IGVsc2UKCSAgICAgICAgICAgICAgICBzdHIgPSBhW2ldOwoJICAgICAgICAgICAgci5wdXNoKCBzdHIgKTsKCSAgICAgICAgfQoJCgkJcmV0dXJuICJbICIgKyByLmpvaW4oIiwgIikgKyAiIF0iOwoJfQoJdmFyIHJldCA9IHRydWU7CglpZiAoIGEgJiYgYiAmJiBhLmxlbmd0aCAhPSB1bmRlZmluZWQgJiYgYS5sZW5ndGggPT0gYi5sZW5ndGggKSB7CgkJZm9yICggdmFyIGkgPSAwOyBpIDwgYS5sZW5ndGg7IGkrKyApCgkJCWlmICggYVtpXSAhPSBiW2ldICkKCQkJCXJldCA9IGZhbHNlOwoJfSBlbHNlCgkJcmV0ID0gZmFsc2U7Cgljb25maWcuYXNzZXJ0aW9ucy5wdXNoKHsKCQlyZXN1bHQ6IHJldCwKCQltZXNzYWdlOiAhcmV0ID8gKG1zZyArICIgZXhwZWN0ZWQ6ICIgKyBzZXJpYWxBcnJheShiKSArICIgcmVzdWx0OiAiICsgc2VyaWFsQXJyYXkoYSkpIDogbXNnCgl9KTsKfQoKLyoqCiAqIEFzc2VydHMgdGhhdCB0d28gb2JqZWN0cyBhcmUgZXF1aXZhbGVudAogKi8KZnVuY3Rpb24gaXNPYmooYSwgYiwgbXNnKSB7Cgl2YXIgcmV0ID0gdHJ1ZTsKCQoJaWYgKCBhICYmIGIgKSB7CgkJZm9yICggdmFyIGkgaW4gYSApCgkJCWlmICggYVtpXSAhPSBiW2ldICkKCQkJCXJldCA9IGZhbHNlOwoKCQlmb3IgKCBpIGluIGIgKQoJCQlpZiAoIGFbaV0gIT0gYltpXSApCgkJCQlyZXQgPSBmYWxzZTsKCX0gZWxzZQoJCXJldCA9IGZhbHNlOwoKICAgIGNvbmZpZy5hc3NlcnRpb25zLnB1c2goewoJCXJlc3VsdDogcmV0LAoJCW1lc3NhZ2U6IG1zZwoJfSk7Cn0KCi8qKgogKiBSZXR1cm5zIGFuIGFycmF5IG9mIGVsZW1lbnRzIHdpdGggdGhlIGdpdmVuIElEcywgZWcuCiAqIEBleGFtcGxlIHEoIm1haW4iLCAiZm9vIiwgImJhciIpCiAqIEByZXN1bHQgWzxkaXYgaWQ9Im1haW4iPiwgPHNwYW4gaWQ9ImZvbyI+LCA8aW5wdXQgaWQ9ImJhciI+XQogKi8KZnVuY3Rpb24gcSgpIHsKCXZhciByID0gW107Cglmb3IgKCB2YXIgaSA9IDA7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKysgKQoJCXIucHVzaCggZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIGFyZ3VtZW50c1tpXSApICk7CglyZXR1cm4gcjsKfQoKLyoqCiAqIEFzc2VydHMgdGhhdCBhIHNlbGVjdCBtYXRjaGVzIHRoZSBnaXZlbiBJRHMKICogQGV4YW1wbGUgdCgiQ2hlY2sgZm9yIHNvbWV0aGluZyIsICIvL1thXSIsIFsiZm9vIiwgImJhYXIiXSk7CiAqIEByZXN1bHQgcmV0dXJucyB0cnVlIGlmICIvL1thXSIgcmV0dXJuIHR3byBlbGVtZW50cyB3aXRoIHRoZSBJRHMgJ2ZvbycgYW5kICdiYWFyJwogKi8KZnVuY3Rpb24gdChhLGIsYykgewoJdmFyIGYgPSAkKGIpOwoJdmFyIHMgPSAiIjsKCWZvciAoIHZhciBpID0gMDsgaSA8IGYubGVuZ3RoOyBpKysgKQoJCXMgKz0gKHMgJiYgIiwiKSArICciJyArIGZbaV0uaWQgKyAnIic7Cglpc1NldChmLCBxLmFwcGx5KHEsYyksIGEgKyAiICgiICsgYiArICIpIik7Cn0KCi8qKgogKiBBZGQgcmFuZG9tIG51bWJlciB0byB1cmwgdG8gc3RvcCBJRSBmcm9tIGNhY2hpbmcKICoKICogQGV4YW1wbGUgdXJsKCJkYXRhL3Rlc3QuaHRtbCIpCiAqIEByZXN1bHQgImRhdGEvdGVzdC5odG1sPzEwNTM4MzU4NDI4OTQzIgogKgogKiBAZXhhbXBsZSB1cmwoImRhdGEvdGVzdC5waHA/Zm9vPWJhciIpCiAqIEByZXN1bHQgImRhdGEvdGVzdC5waHA/Zm9vPWJhciYxMDUzODM1ODM0NTU1NCIKICovCmZ1bmN0aW9uIHVybCh2YWx1ZSkgewoJcmV0dXJuIHZhbHVlICsgKC9cPy8udGVzdCh2YWx1ZSkgPyAiJiIgOiAiPyIpICsgbmV3IERhdGUoKS5nZXRUaW1lKCkgKyAiIiArIHBhcnNlSW50KE1hdGgucmFuZG9tKCkqMTAwMDAwKTsKfQoKLyoqCiAqIENoZWNrcyB0aGF0IHRoZSBmaXJzdCB0d28gYXJndW1lbnRzIGFyZSBlcXVhbCwgd2l0aCBhbiBvcHRpb25hbCBtZXNzYWdlLgogKiBQcmludHMgb3V0IGJvdGggYWN0dWFsIGFuZCBleHBlY3RlZCB2YWx1ZXMuCiAqCiAqIFByZWZlcmVkIHRvIG9rKCBhY3R1YWwgPT0gZXhwZWN0ZWQsIG1lc3NhZ2UgKQogKgogKiBAZXhhbXBsZSBlcXVhbHMoICQuZm9ybWF0KCJSZWNlaXZlZCB7MH0gYnl0ZXMuIiwgMiksICJSZWNlaXZlZCAyIGJ5dGVzLiIgKTsKICoKICogQHBhcmFtIE9iamVjdCBhY3R1YWwKICogQHBhcmFtIE9iamVjdCBleHBlY3RlZAogKiBAcGFyYW0gU3RyaW5nIG1lc3NhZ2UgKG9wdGlvbmFsKQogKi8KZnVuY3Rpb24gZXF1YWxzKGFjdHVhbCwgZXhwZWN0ZWQsIG1lc3NhZ2UpIHsKCXB1c2goZXhwZWN0ZWQgPT0gYWN0dWFsLCBhY3R1YWwsIGV4cGVjdGVkLCBtZXNzYWdlKTsKfQoKZnVuY3Rpb24gcHVzaChyZXN1bHQsIGFjdHVhbCwgZXhwZWN0ZWQsIG1lc3NhZ2UpIHsKCW1lc3NhZ2UgPSBtZXNzYWdlIHx8IChyZXN1bHQgPyAib2theSIgOiAiZmFpbGVkIik7Cgljb25maWcuYXNzZXJ0aW9ucy5wdXNoKHsKCQlyZXN1bHQ6IHJlc3VsdCwKCQltZXNzYWdlOiByZXN1bHQgPyBtZXNzYWdlICsgIjogIiArIGV4cGVjdGVkIDogbWVzc2FnZSArICIsIGV4cGVjdGVkOiAiICsganNEdW1wLnBhcnNlKGV4cGVjdGVkKSArICIgcmVzdWx0OiAiICsganNEdW1wLnBhcnNlKGFjdHVhbCkKCX0pOwp9CgovKioKICogVHJpZ2dlciBhbiBldmVudCBvbiBhbiBlbGVtZW50LgogKgogKiBAZXhhbXBsZSB0cmlnZ2VyRXZlbnQoIGRvY3VtZW50LmJvZHksICJjbGljayIgKTsKICoKICogQHBhcmFtIERPTUVsZW1lbnQgZWxlbQogKiBAcGFyYW0gU3RyaW5nIHR5cGUKICovCmZ1bmN0aW9uIHRyaWdnZXJFdmVudCggZWxlbSwgdHlwZSwgZXZlbnQgKSB7CglpZiAoICQuYnJvd3Nlci5tb3ppbGxhIHx8ICQuYnJvd3Nlci5vcGVyYSApIHsKCQlldmVudCA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KCJNb3VzZUV2ZW50cyIpOwoJCWV2ZW50LmluaXRNb3VzZUV2ZW50KHR5cGUsIHRydWUsIHRydWUsIGVsZW0ub3duZXJEb2N1bWVudC5kZWZhdWx0VmlldywKCQkJMCwgMCwgMCwgMCwgMCwgZmFsc2UsIGZhbHNlLCBmYWxzZSwgZmFsc2UsIDAsIG51bGwpOwoJCWVsZW0uZGlzcGF0Y2hFdmVudCggZXZlbnQgKTsKCX0gZWxzZSBpZiAoICQuYnJvd3Nlci5tc2llICkgewoJCWVsZW0uZmlyZUV2ZW50KCJvbiIrdHlwZSk7Cgl9Cn0KCn0pKGpRdWVyeSk7CgovKioKICoganNEdW1wCiAqIENvcHlyaWdodCAoYykgMjAwOCBBcmllbCBGbGVzbGVyIC0gYWZsZXNsZXIoYXQpZ21haWwoZG90KWNvbSB8IGh0dHA6Ly9mbGVzbGVyLmJsb2dzcG90LmNvbQogKiBMaWNlbnNlZCB1bmRlciBCU0QgKGh0dHA6Ly93d3cub3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvYnNkLWxpY2Vuc2UucGhwKQogKiBEYXRlOiA1LzE1LzIwMDgKICogQHByb2plY3REZXNjcmlwdGlvbiBBZHZhbmNlZCBhbmQgZXh0ZW5zaWJsZSBkYXRhIGR1bXBpbmcgZm9yIEphdmFzY3JpcHQuCiAqIEB2ZXJzaW9uIDEuMC4wCiAqIEBhdXRob3IgQXJpZWwgRmxlc2xlcgogKiBAbGluayB7aHR0cDovL2ZsZXNsZXIuYmxvZ3Nwb3QuY29tLzIwMDgvMDUvanNkdW1wLXByZXR0eS1kdW1wLW9mLWFueS1qYXZhc2NyaXB0Lmh0bWx9CiAqLwooZnVuY3Rpb24oKXsKCWZ1bmN0aW9uIHF1b3RlKCBzdHIgKXsKCQlyZXR1cm4gJyInICsgc3RyLnRvU3RyaW5nKCkucmVwbGFjZSgvIi9nLCAnXFwiJykgKyAnIic7Cgl9OwoJZnVuY3Rpb24gbGl0ZXJhbCggbyApewoJCXJldHVybiBvICsgJyc7CQoJfTsKCWZ1bmN0aW9uIGpvaW4oIHByZSwgYXJyLCBwb3N0ICl7CgkJdmFyIHMgPSBqc0R1bXAuc2VwYXJhdG9yKCksCgkJCWJhc2UgPSBqc0R1bXAuaW5kZW50KCk7CgkJCWlubmVyID0ganNEdW1wLmluZGVudCgxKTsKCQlpZiggYXJyLmpvaW4gKQoJCQlhcnIgPSBhcnIuam9pbiggJywnICsgcyArIGlubmVyICk7CgkJaWYoICFhcnIgKQoJCQlyZXR1cm4gcHJlICsgcG9zdDsKCQlyZXR1cm4gWyBwcmUsIGlubmVyICsgYXJyLCBiYXNlICsgcG9zdCBdLmpvaW4ocyk7Cgl9OwoJZnVuY3Rpb24gYXJyYXkoIGFyciApewoJCXZhciBpID0gYXJyLmxlbmd0aCwJcmV0ID0gQXJyYXkoaSk7CQkJCQkKCQl0aGlzLnVwKCk7CgkJd2hpbGUoIGktLSApCgkJCXJldFtpXSA9IHRoaXMucGFyc2UoIGFycltpXSApOwkJCQkKCQl0aGlzLmRvd24oKTsKCQlyZXR1cm4gam9pbiggJ1snLCByZXQsICddJyApOwoJfTsKCQoJdmFyIHJlTmFtZSA9IC9eZnVuY3Rpb24gKFx3KykvOwoJCgl2YXIganNEdW1wID0gd2luZG93LmpzRHVtcCA9IHsKCQlwYXJzZTpmdW5jdGlvbiggb2JqLCB0eXBlICl7Ly90eXBlIGlzIHVzZWQgbW9zdGx5IGludGVybmFsbHksIHlvdSBjYW4gZml4IGEgKGN1c3RvbSl0eXBlIGluIGFkdmFuY2UKCQkJdmFyCXBhcnNlciA9IHRoaXMucGFyc2Vyc1sgdHlwZSB8fCB0aGlzLnR5cGVPZihvYmopIF07CgkJCXR5cGUgPSB0eXBlb2YgcGFyc2VyOwkJCQoJCQkKCQkJcmV0dXJuIHR5cGUgPT0gJ2Z1bmN0aW9uJyA/IHBhcnNlci5jYWxsKCB0aGlzLCBvYmogKSA6CgkJCQkgICB0eXBlID09ICdzdHJpbmcnID8gcGFyc2VyIDoKCQkJCSAgIHRoaXMucGFyc2Vycy5lcnJvcjsKCQl9LAoJCXR5cGVPZjpmdW5jdGlvbiggb2JqICl7CgkJCXZhciB0eXBlID0gdHlwZW9mIG9iaiwKCQkJCWYgPSAnZnVuY3Rpb24nOy8vd2UnbGwgdXNlIGl0IDMgdGltZXMsIHNhdmUgaXQKCQkJcmV0dXJuIHR5cGUgIT0gJ29iamVjdCcgJiYgdHlwZSAhPSBmID8gdHlwZSA6CgkJCQkhb2JqID8gJ251bGwnIDoKCQkJCW9iai5leGVjID8gJ3JlZ2V4cCcgOi8vIHNvbWUgYnJvd3NlcnMgKEZGKSBjb25zaWRlciByZWdleHBzIGZ1bmN0aW9ucwoJCQkJb2JqLmdldEhvdXJzID8gJ2RhdGUnIDoKCQkJCW9iai5zY3JvbGxCeSA/ICAnd2luZG93JyA6CgkJCQlvYmoubm9kZU5hbWUgPT0gJyNkb2N1bWVudCcgPyAnZG9jdW1lbnQnIDoKCQkJCW9iai5ub2RlTmFtZSA/ICdub2RlJyA6CgkJCQlvYmouaXRlbSA/ICdub2RlbGlzdCcgOiAvLyBTYWZhcmkgcmVwb3J0cyBub2RlbGlzdHMgYXMgZnVuY3Rpb25zCgkJCQlvYmouY2FsbGVlID8gJ2FyZ3VtZW50cycgOgoJCQkJb2JqLmNhbGwgfHwgb2JqLmNvbnN0cnVjdG9yICE9IEFycmF5ICYmIC8vYW4gYXJyYXkgd291bGQgYWxzbyBmYWxsIG9uIHRoaXMgaGFjawoJCQkJCShvYmorJycpLmluZGV4T2YoZikgIT0gLTEgPyBmIDogLy9JRSByZXBvcnRzIGZ1bmN0aW9ucyBsaWtlIGFsZXJ0LCBhcyBvYmplY3RzCgkJCQknbGVuZ3RoJyBpbiBvYmogPyAnYXJyYXknIDoKCQkJCXR5cGU7CgkJfSwKCQlzZXBhcmF0b3I6ZnVuY3Rpb24oKXsKCQkJcmV0dXJuIHRoaXMubXVsdGlsaW5lID8JdGhpcy5IVE1MID8gJzxiciAvPicgOiAnXG4nIDogdGhpcy5IVE1MID8gJyZuYnNwOycgOiAnICc7CgkJfSwKCQlpbmRlbnQ6ZnVuY3Rpb24oIGV4dHJhICl7Ly8gZXh0cmEgY2FuIGJlIGEgbnVtYmVyLCBzaG9ydGN1dCBmb3IgaW5jcmVhc2luZy1jYWxsaW5nLWRlY3JlYXNpbmcKCQkJaWYoICF0aGlzLm11bHRpbGluZSApCgkJCQlyZXR1cm4gJyc7CgkJCXZhciBjaHIgPSB0aGlzLmluZGVudENoYXI7CgkJCWlmKCB0aGlzLkhUTUwgKQoJCQkJY2hyID0gY2hyLnJlcGxhY2UoL1x0L2csJyAgICcpLnJlcGxhY2UoLyAvZywnJm5ic3A7Jyk7CgkJCXJldHVybiBBcnJheSggdGhpcy5fZGVwdGhfICsgKGV4dHJhfHwwKSApLmpvaW4oY2hyKTsKCQl9LAoJCXVwOmZ1bmN0aW9uKCBhICl7CgkJCXRoaXMuX2RlcHRoXyArPSBhIHx8IDE7CgkJfSwKCQlkb3duOmZ1bmN0aW9uKCBhICl7CgkJCXRoaXMuX2RlcHRoXyAtPSBhIHx8IDE7CgkJfSwKCQlzZXRQYXJzZXI6ZnVuY3Rpb24oIG5hbWUsIHBhcnNlciApewoJCQl0aGlzLnBhcnNlcnNbbmFtZV0gPSBwYXJzZXI7CgkJfSwKCQkvLyBUaGUgbmV4dCAzIGFyZSBleHBvc2VkIHNvIHlvdSBjYW4gdXNlIHRoZW0KCQlxdW90ZTpxdW90ZSwgCgkJbGl0ZXJhbDpsaXRlcmFsLAoJCWpvaW46am9pbiwKCQkvLwoJCV9kZXB0aF86IDEsCgkJLy8gVGhpcyBpcyB0aGUgbGlzdCBvZiBwYXJzZXJzLCB0byBtb2RpZnkgdGhlbSwgdXNlIGpzRHVtcC5zZXRQYXJzZXIKCQlwYXJzZXJzOnsKCQkJd2luZG93OiAnW1dpbmRvd10nLAoJCQlkb2N1bWVudDogJ1tEb2N1bWVudF0nLAoJCQllcnJvcjonW0VSUk9SXScsIC8vd2hlbiBubyBwYXJzZXIgaXMgZm91bmQsIHNob3VsZG4ndCBoYXBwZW4KCQkJdW5rbm93bjogJ1tVbmtub3duXScsCgkJCSdudWxsJzonbnVsbCcsCgkJCXVuZGVmaW5lZDondW5kZWZpbmVkJywKCQkJJ2Z1bmN0aW9uJzpmdW5jdGlvbiggZm4gKXsKCQkJCXZhciByZXQgPSAnZnVuY3Rpb24nLAoJCQkJCW5hbWUgPSAnbmFtZScgaW4gZm4gPyBmbi5uYW1lIDogKHJlTmFtZS5leGVjKGZuKXx8W10pWzFdOy8vZnVuY3Rpb25zIG5ldmVyIGhhdmUgbmFtZSBpbiBJRQoJCQkJaWYoIG5hbWUgKQoJCQkJCXJldCArPSAnICcgKyBuYW1lOwoJCQkJcmV0ICs9ICcoJzsKCQkJCQoJCQkJcmV0ID0gWyByZXQsIHRoaXMucGFyc2UoIGZuLCAnZnVuY3Rpb25BcmdzJyApLCAnKXsnXS5qb2luKCcnKTsKCQkJCXJldHVybiBqb2luKCByZXQsIHRoaXMucGFyc2UoZm4sJ2Z1bmN0aW9uQ29kZScpLCAnfScgKTsKCQkJfSwKCQkJYXJyYXk6IGFycmF5LAoJCQlub2RlbGlzdDogYXJyYXksCgkJCWFyZ3VtZW50czogYXJyYXksCgkJCW9iamVjdDpmdW5jdGlvbiggbWFwICl7CgkJCQl2YXIgcmV0ID0gWyBdOwoJCQkJdGhpcy51cCgpOwoJCQkJZm9yKCB2YXIga2V5IGluIG1hcCApCgkJCQkJcmV0LnB1c2goIHRoaXMucGFyc2Uoa2V5LCdrZXknKSArICc6ICcgKyB0aGlzLnBhcnNlKG1hcFtrZXldKSApOwoJCQkJdGhpcy5kb3duKCk7CgkJCQlyZXR1cm4gam9pbiggJ3snLCByZXQsICd9JyApOwoJCQl9LAoJCQlub2RlOmZ1bmN0aW9uKCBub2RlICl7CgkJCQl2YXIgb3BlbiA9IHRoaXMuSFRNTCA/ICcmbHQ7JyA6ICc8JywKCQkJCQljbG9zZSA9IHRoaXMuSFRNTCA/ICcmZ3Q7JyA6ICc+JzsKCQkJCQkKCQkJCXZhciB0YWcgPSBub2RlLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCksCgkJCQkJcmV0ID0gb3BlbiArIHRhZzsKCQkJCQkKCQkJCWZvciggdmFyIGEgaW4gdGhpcy5ET01BdHRycyApewoJCQkJCXZhciB2YWwgPSBub2RlW3RoaXMuRE9NQXR0cnNbYV1dOwoJCQkJCWlmKCB2YWwgKQoJCQkJCQlyZXQgKz0gJyAnICsgYSArICc9JyArIHRoaXMucGFyc2UoIHZhbCwgJ2F0dHJpYnV0ZScgKTsKCQkJCX0KCQkJCXJldHVybiByZXQgKyBjbG9zZSArIG9wZW4gKyAnLycgKyB0YWcgKyBjbG9zZTsKCQkJfSwKCQkJZnVuY3Rpb25BcmdzOmZ1bmN0aW9uKCBmbiApey8vZnVuY3Rpb24gY2FsbHMgaXQgaW50ZXJuYWxseSwgaXQncyB0aGUgYXJndW1lbnRzIHBhcnQgb2YgdGhlIGZ1bmN0aW9uCgkJCQl2YXIgbCA9IGZuLmxlbmd0aDsKCQkJCWlmKCAhbCApIHJldHVybiAnJzsJCQkJCgkJCQkKCQkJCXZhciBhcmdzID0gQXJyYXkobCk7CgkJCQl3aGlsZSggbC0tICkKCQkJCQlhcmdzW2xdID0gU3RyaW5nLmZyb21DaGFyQ29kZSg5NytsKTsvLzk3IGlzICdhJwoJCQkJcmV0dXJuICcgJyArIGFyZ3Muam9pbignLCAnKSArICcgJzsKCQkJfSwKCQkJa2V5OnF1b3RlLCAvL29iamVjdCBjYWxscyBpdCBpbnRlcm5hbGx5LCB0aGUga2V5IHBhcnQgb2YgYW4gaXRlbSBpbiBhIG1hcAoJCQlmdW5jdGlvbkNvZGU6J1tjb2RlXScsIC8vZnVuY3Rpb24gY2FsbHMgaXQgaW50ZXJuYWxseSwgaXQncyB0aGUgY29udGVudCBvZiB0aGUgZnVuY3Rpb24KCQkJYXR0cmlidXRlOnF1b3RlLCAvL25vZGUgY2FsbHMgaXQgaW50ZXJuYWxseSwgaXQncyBhbiBodG1sIGF0dHJpYnV0ZSB2YWx1ZQoJCQlzdHJpbmc6cXVvdGUsCgkJCWRhdGU6cXVvdGUsCgkJCXJlZ2V4cDpsaXRlcmFsLCAvL3JlZ2V4CgkJCW51bWJlcjpsaXRlcmFsLAoJCQknYm9vbGVhbic6bGl0ZXJhbAoJCX0sCgkJRE9NQXR0cnM6ey8vYXR0cmlidXRlcyB0byBkdW1wIGZyb20gbm9kZXMsIG5hbWU9PnJlYWxOYW1lCgkJCWlkOidpZCcsCgkJCW5hbWU6J25hbWUnLAoJCQknY2xhc3MnOidjbGFzc05hbWUnCgkJfSwKCQlIVE1MOmZhbHNlLC8vaWYgdHJ1ZSwgZW50aXRpZXMgYXJlIGVzY2FwZWQgKCA8LCA+LCBcdCwgc3BhY2UgYW5kIFxuICkKCQlpbmRlbnRDaGFyOicgICAnLC8vaW5kZW50YXRpb24gdW5pdAoJCW11bHRpbGluZTp0cnVlIC8vaWYgdHJ1ZSwgaXRlbXMgaW4gYSBjb2xsZWN0aW9uLCBhcmUgc2VwYXJhdGVkIGJ5IGEgXG4sIGVsc2UganVzdCBhIHNwYWNlLgoJfTsKCn0pKCk7Cg==",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Sat, 08 Nov 2014 14:57:04 GMT",
                    "Content-Length": "20662",
                    "Date": "Sat, 08 Nov 2014 14:57:04 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}