{
    "url": "http://localhost:9999/esbie/jasmine-bootstrap/src/jasmine-bootstrap.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Open redirection (DOM-based)",
    "issueType": 5243152,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based open redirection vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the target of a redirection in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause a redirection to an arbitrary external domain. This behavior can be leveraged to facilitate phishing attacks against users of the application. The ability to use an authentic application URL, targeting the correct domain with a valid SSL certificate (if SSL is used) lends credibility to the phishing attack because many users, even if they verify these features, will not notice the subsequent redirection to a different domain.<br><br><b>Note:</b> If an attacker is able to control the start of the string that is passed to the redirection API, then it may be possible to escalate this vulnerability into a JavaScript injection attack, by using a URL with the javascript: pseudo-protocol to execute arbitrary script code when the URL is processed by the browser.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based open redirection vulnerabilities is not to dynamically set redirection targets using data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing an arbitrary URL as a redirection target. In general, this is best achieved by using a whitelist of URLs that are permitted redirection targets, and strictly validating the target against this list before performing the redirection.",
    "issueDetail": "The application may be vulnerable to DOM-based open redirection. Data is read from <b>window.location.href</b> and written to <b>window.location</b> via the following statement:<ul><li>window.location = window.location.href.replace(/&amp;?showSkipped=true|\\?showSkipped=true$/, '');</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/esbie/jasmine-bootstrap/src/jasmine-bootstrap.js",
                "path": "/esbie/jasmine-bootstrap/src/jasmine-bootstrap.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9lc2JpZS9qYXNtaW5lLWJvb3RzdHJhcC9zcmMvamFzbWluZS1ib290c3RyYXAuanMgSFRUUC8xLjENCkhvc3Q6IGxvY2FsaG9zdDo5OTk5DQoNCg==",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogODQ0Mg0KQWNjZXB0LVJhbmdlczogYnl0ZXMNCkNvbnRlbnQtVHlwZTogYXBwbGljYXRpb24vamF2YXNjcmlwdA0KRGF0ZTogRnJpLCAwNyBOb3YgMjAxNCAwNToyNjozMyBHTVQNCkxhc3QtTW9kaWZpZWQ6IEZyaSwgMDcgTm92IDIwMTQgMDU6MjY6MzMgR01UDQoNCmphc21pbmUuQm9vdHN0cmFwUmVwb3J0ZXIgPSBmdW5jdGlvbihkb2MpIHsKICB0aGlzLmRvY3VtZW50ID0gZG9jIHx8IGRvY3VtZW50OwogIHRoaXMuc3VpdGVEaXZzID0ge307CiAgdGhpcy5sb2dSdW5uaW5nU3BlY3MgPSBmYWxzZTsKICB2YXIgc2VsZiA9IHRoaXM7CiAgLy9hdXRvbWF0aWNhbGx5IHVzZSB0aGUgc3BlYyBmaWx0ZXIgc3VwcGxpZWQgYnkgdGhlIHJlcG9ydGVyCiAgamFzbWluZS5nZXRFbnYoKS5zcGVjRmlsdGVyID0gZnVuY3Rpb24oKXtyZXR1cm4gc2VsZi5zcGVjRmlsdGVyLmFwcGx5KHNlbGYsIGFyZ3VtZW50cyk7fTsKfTsKCmphc21pbmUuQm9vdHN0cmFwUmVwb3J0ZXIucHJvdG90eXBlLmNyZWF0ZURvbSA9IGZ1bmN0aW9uKHR5cGUsIGF0dHJzLCBjaGlsZHJlblZhckFyZ3MpIHsKICB2YXIgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KHR5cGUpOwoKICBmb3IgKHZhciBpID0gMjsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgewogICAgdmFyIGNoaWxkID0gYXJndW1lbnRzW2ldOwoKICAgIGlmICh0eXBlb2YgY2hpbGQgPT09ICdzdHJpbmcnKSB7CiAgICAgIGVsLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGNoaWxkKSk7CiAgICB9IGVsc2UgewogICAgICBpZiAoY2hpbGQpIHsgZWwuYXBwZW5kQ2hpbGQoY2hpbGQpOyB9CiAgICB9CiAgfQoKICBmb3IgKHZhciBhdHRyIGluIGF0dHJzKSB7CiAgICBpZiAoYXR0ciA9PSAiY2xhc3NOYW1lIikgewogICAgICBlbFthdHRyXSA9IGF0dHJzW2F0dHJdOwogICAgfSBlbHNlIHsKICAgICAgZWwuc2V0QXR0cmlidXRlKGF0dHIsIGF0dHJzW2F0dHJdKTsKICAgIH0KICB9CgogIHJldHVybiBlbDsKfTsKCmphc21pbmUuQm9vdHN0cmFwUmVwb3J0ZXIucHJvdG90eXBlLnJlcG9ydFJ1bm5lclN0YXJ0aW5nID0gZnVuY3Rpb24ocnVubmVyKSB7CiAgdmFyIHNob3dQYXNzZWQsIHNob3dTa2lwcGVkOwogIHRoaXMuY2hlY2tQYXNzZWQgPSAhIXRoaXMuZ2V0TG9jYXRpb24oKS5zZWFyY2gubWF0Y2goInNob3dQYXNzZWQ9dHJ1ZSIpOwogIHRoaXMuY2hlY2tTa2lwcGVkID0gISF0aGlzLmdldExvY2F0aW9uKCkuc2VhcmNoLm1hdGNoKCJzaG93U2tpcHBlZD10cnVlIik7CgogIHRoaXMub3V0ZXJEaXYgPSB0aGlzLmNyZWF0ZURvbSgnZGl2JywgeyBjbGFzc05hbWU6ICdqYXNtaW5lX3JlcG9ydGVyIGNvbnRhaW5lcicgfSwKICAgICAgdGhpcy5jcmVhdGVEb20oJ2gxJywgeyBjbGFzc05hbWU6ICdiYW5uZXIgd2VsbCcgfSwKICAgICAgICB0aGlzLmNyZWF0ZURvbSgnc3BhbicsIHsgY2xhc3NOYW1lOiAnbG9nbycgfSwKICAgICAgICAgICAgdGhpcy5jcmVhdGVEb20oJ3NwYW4nLCB7IGNsYXNzTmFtZTogJ3RpdGxlJyB9LCAiSmFzbWluZSIpLAogICAgICAgICAgICB0aGlzLmNyZWF0ZURvbSgnc21hbGwnLCB7IGNsYXNzTmFtZTogJ3ZlcnNpb24nIH0sIHJ1bm5lci5lbnYudmVyc2lvblN0cmluZygpKSksCiAgICAgICAgdGhpcy5jcmVhdGVEb20oJ3NwYW4nLCB7IGNsYXNzTmFtZTogJ29wdGlvbnMgZm9ybS1pbmxpbmUnIH0sCiAgICAgICAgICAgIHRoaXMuY3JlYXRlRG9tKCdsYWJlbCcsIHsgY2xhc3NOYW1lOiAnY2hlY2tib3gnIH0sCiAgICAgICAgICAgICAgICBzaG93UGFzc2VkID0gdGhpcy5jcmVhdGVEb20oJ2lucHV0JywgdGhpcy5jaGVja1Bhc3NlZCA/IHsgdHlwZTogJ2NoZWNrYm94JywgY2hlY2tlZDogJ3RydWUnIH0gOiB7IHR5cGU6ICdjaGVja2JveCcgfSksCiAgICAgICAgICAgICAgICB0aGlzLmNyZWF0ZURvbSgnc3BhbicsIHt9LCAiIHNob3cgcGFzc2VkICIpKSwKICAgICAgICAgICAgCiAgICAgICAgICAgIHRoaXMuY3JlYXRlRG9tKCdsYWJlbCcsIHsgY2xhc3NOYW1lOiAnY2hlY2tib3gnIH0sCiAgICAgICAgICAgICAgICBzaG93U2tpcHBlZCA9IHRoaXMuY3JlYXRlRG9tKCdpbnB1dCcsIHRoaXMuY2hlY2tTa2lwcGVkID8geyB0eXBlOiAnY2hlY2tib3gnLCBjaGVja2VkOiAndHJ1ZScgfSA6IHsgdHlwZTogJ2NoZWNrYm94JyB9KSwKICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlRG9tKCdzcGFuJywge30sICIgc2hvdyBza2lwcGVkIikpCiAgICAgICAgKQogICAgICApLAoKICAgICAgdGhpcy5ydW5uZXJEaXYgPSB0aGlzLmNyZWF0ZURvbSgnZGl2JywgeyBjbGFzc05hbWU6ICdhbGVydCB3YXJuaW5nIHJ1bm5lciBydW5uaW5nJyB9LAogICAgICAgICAgdGhpcy5jcmVhdGVEb20oJ2EnLCB7IGNsYXNzTmFtZTogJ3J1bl9zcGVjIGJ0biBidG4teHMgYnRuLW1pbmkgYnRuLWluZm8nLCBocmVmOiAnPycgfSwgInJ1biBhbGwiKSwKICAgICAgICAgIHRoaXMucnVubmVyTWVzc2FnZVNwYW4gPSB0aGlzLmNyZWF0ZURvbSgnc3BhbicsIHt9LCAiUnVubmluZy4uLiIpLAogICAgICAgICAgdGhpcy5maW5pc2hlZEF0U3BhbiA9IHRoaXMuY3JlYXRlRG9tKCdzcGFuJywgeyBjbGFzc05hbWU6ICdmaW5pc2hlZC1hdCcgfSwgIiIpKQogICAgICApOwoKICB0aGlzLmRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGhpcy5vdXRlckRpdik7CgogIHZhciBzdWl0ZXMgPSBydW5uZXIuc3VpdGVzKCk7CiAgZm9yICh2YXIgaSA9IDA7IGkgPCBzdWl0ZXMubGVuZ3RoOyBpKyspIHsKICAgIHZhciBzdWl0ZSA9IHN1aXRlc1tpXTsKICAgIHZhciBzdWl0ZURpdiA9IHRoaXMuY3JlYXRlRG9tKCdkaXYnLCB7IGNsYXNzTmFtZTogJ3N1aXRlIGFsZXJ0IGFsZXJ0LWJsb2NrJyB9LAogICAgICAgIHRoaXMuY3JlYXRlRG9tKCdhJywgeyBjbGFzc05hbWU6ICdydW5fc3BlYyBidG4gYnRuLXhzIGJ0bi1taW5pIGJ0bi1pbmZvJywgaHJlZjogdGhpcy5zcGVjSHJlZihzdWl0ZSkgfSwgInJ1biIpLAogICAgICAgIHRoaXMuY3JlYXRlRG9tKCdhJywgeyBjbGFzc05hbWU6ICdkZXNjcmlwdGlvbicsIGhyZWY6IHRoaXMuc3BlY0hyZWYoc3VpdGUpIH0sIHN1aXRlLmRlc2NyaXB0aW9uKSk7CiAgICB0aGlzLnN1aXRlRGl2c1tzdWl0ZS5pZF0gPSBzdWl0ZURpdjsKICAgIHZhciBwYXJlbnREaXYgPSB0aGlzLm91dGVyRGl2OwogICAgaWYgKHN1aXRlLnBhcmVudFN1aXRlKSB7CiAgICAgIHBhcmVudERpdiA9IHRoaXMuc3VpdGVEaXZzW3N1aXRlLnBhcmVudFN1aXRlLmlkXTsKICAgIH0KICAgIHBhcmVudERpdi5hcHBlbmRDaGlsZChzdWl0ZURpdik7CiAgfQoKICB0aGlzLnN0YXJ0ZWRBdCA9IG5ldyBEYXRlKCk7CgogIGlmICh0aGlzLmNoZWNrUGFzc2VkKSB7CiAgICB0aGlzLm91dGVyRGl2LmNsYXNzTmFtZSArPSAnIHNob3ctcGFzc2VkJzsKICB9CiAgaWYgKHRoaXMuY2hlY2tTa2lwcGVkKSB7CiAgICB0aGlzLm91dGVyRGl2LmNsYXNzTmFtZSArPSAnIHNob3ctc2tpcHBlZCc7CiAgfQoKICB2YXIgc2VsZiA9IHRoaXM7CiAgc2hvd1Bhc3NlZC5vbmNsaWNrID0gZnVuY3Rpb24oZXZ0KSB7CiAgICBpZiAoc2hvd1Bhc3NlZC5jaGVja2VkKSB7CiAgICAgIHdpbmRvdy5sb2NhdGlvbiA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmLnJlcGxhY2UoL1w/JC8sICcnKSArIChzZWxmLmRvY3VtZW50LmxvY2F0aW9uLnNlYXJjaC5sZW5ndGggPyAiJnNob3dQYXNzZWQ9dHJ1ZSIgOiAiP3Nob3dQYXNzZWQ9dHJ1ZSIpOwogICAgfSBlbHNlIHsKICAgICAgd2luZG93LmxvY2F0aW9uID0gd2luZG93LmxvY2F0aW9uLmhyZWYucmVwbGFjZSgvJj9zaG93UGFzc2VkPXRydWV8XD9zaG93UGFzc2VkPXRydWUkLywgJycpOwogICAgfQogIH07CgogIHNob3dTa2lwcGVkLm9uY2xpY2sgPSBmdW5jdGlvbihldnQpIHsKICAgIGlmIChzaG93U2tpcHBlZC5jaGVja2VkKSB7CiAgICAgIHdpbmRvdy5sb2NhdGlvbiA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmLnJlcGxhY2UoL1w/JC8sICcnKSArIChzZWxmLmRvY3VtZW50LmxvY2F0aW9uLnNlYXJjaC5sZW5ndGggPyAiJnNob3dTa2lwcGVkPXRydWUiIDogIj9zaG93U2tpcHBlZD10cnVlIik7CiAgICB9IGVsc2UgewogICAgICB3aW5kb3cubG9jYXRpb24gPSB3aW5kb3cubG9jYXRpb24uaHJlZi5yZXBsYWNlKC8mP3Nob3dTa2lwcGVkPXRydWV8XD9zaG93U2tpcHBlZD10cnVlJC8sICcnKTsgICAgICAKICAgIH0KICB9Owp9OwoKamFzbWluZS5Cb290c3RyYXBSZXBvcnRlci5wcm90b3R5cGUucmVwb3J0UnVubmVyUmVzdWx0cyA9IGZ1bmN0aW9uKHJ1bm5lcikgewogIHZhciByZXN1bHRzID0gcnVubmVyLnJlc3VsdHMoKTsKICB2YXIgY2xhc3NOYW1lID0gKHJlc3VsdHMuZmFpbGVkQ291bnQgPiAwKSA/ICJhbGVydCBhbGVydC1lcnJvciBydW5uZXIgZmFpbGVkIiA6ICJhbGVydCBhbGVydC1zdWNjZXNzIHJ1bm5lciBwYXNzZWQiOwogIHRoaXMucnVubmVyRGl2LnNldEF0dHJpYnV0ZSgiY2xhc3MiLCBjbGFzc05hbWUpOwogIC8vZG8gaXQgdHdpY2UgZm9yIElFCiAgdGhpcy5ydW5uZXJEaXYuc2V0QXR0cmlidXRlKCJjbGFzc05hbWUiLCBjbGFzc05hbWUpOwogIHZhciBzcGVjcyA9IHJ1bm5lci5zcGVjcygpOwogIHZhciBzcGVjQ291bnQgPSAwOwogIGZvciAodmFyIGkgPSAwOyBpIDwgc3BlY3MubGVuZ3RoOyBpKyspIHsKICAgIGlmICh0aGlzLnNwZWNGaWx0ZXIoc3BlY3NbaV0pKSB7CiAgICAgIHNwZWNDb3VudCsrOwogICAgfQogIH0KICB2YXIgbWVzc2FnZSA9ICIiICsgc3BlY0NvdW50ICsgIiBzcGVjIiArIChzcGVjQ291bnQgPT0gMSA/ICIiIDogInMiICkgKyAiLCAiICsgcmVzdWx0cy5mYWlsZWRDb3VudCArICIgZmFpbHVyZSIgKyAoKHJlc3VsdHMuZmFpbGVkQ291bnQgPT0gMSkgPyAiIiA6ICJzIik7CiAgbWVzc2FnZSArPSAiIGluICIgKyAoKG5ldyBEYXRlKCkuZ2V0VGltZSgpIC0gdGhpcy5zdGFydGVkQXQuZ2V0VGltZSgpKSAvIDEwMDApICsgInMiOwogIHRoaXMucnVubmVyTWVzc2FnZVNwYW4ucmVwbGFjZUNoaWxkKHRoaXMuY3JlYXRlRG9tKCdhJywgeyBjbGFzc05hbWU6ICdkZXNjcmlwdGlvbicsIGhyZWY6ICc/J30sIG1lc3NhZ2UpLCB0aGlzLnJ1bm5lck1lc3NhZ2VTcGFuLmZpcnN0Q2hpbGQpOwoKICB0aGlzLmZpbmlzaGVkQXRTcGFuLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCJGaW5pc2hlZCBhdCAiICsgbmV3IERhdGUoKS50b1N0cmluZygpKSk7Cn07CgpqYXNtaW5lLkJvb3RzdHJhcFJlcG9ydGVyLnByb3RvdHlwZS5yZXBvcnRTdWl0ZVJlc3VsdHMgPSBmdW5jdGlvbihzdWl0ZSkgewogIHZhciByZXN1bHRzID0gc3VpdGUucmVzdWx0cygpOwogIHZhciBzdGF0dXMgPSByZXN1bHRzLnBhc3NlZCgpID8gJ3Bhc3NlZCBhbGVydC1zdWNjZXNzJyA6ICdmYWlsZWQgYWxlcnQtZGFuZ2VyJzsKICBpZiAocmVzdWx0cy50b3RhbENvdW50ID09PSAwKSB7IC8vIHRvZG86IGNoYW5nZSB0aGlzIHRvIGNoZWNrIHJlc3VsdHMuc2tpcHBlZAogICAgc3RhdHVzID0gJ3NraXBwZWQgYWxlcnQtaW5mbyc7CiAgfQogIHRoaXMuc3VpdGVEaXZzW3N1aXRlLmlkXS5jbGFzc05hbWUgKz0gIiAiICsgc3RhdHVzOwp9OwoKamFzbWluZS5Cb290c3RyYXBSZXBvcnRlci5wcm90b3R5cGUucmVwb3J0U3BlY1N0YXJ0aW5nID0gZnVuY3Rpb24oc3BlYykgewogIGlmICh0aGlzLmxvZ1J1bm5pbmdTcGVjcykgewogICAgdGhpcy5sb2coJz4+IEphc21pbmUgUnVubmluZyAnICsgc3BlYy5zdWl0ZS5kZXNjcmlwdGlvbiArICcgJyArIHNwZWMuZGVzY3JpcHRpb24gKyAnLi4uJyk7CiAgfQp9OwoKamFzbWluZS5Cb290c3RyYXBSZXBvcnRlci5wcm90b3R5cGUucmVwb3J0U3BlY1Jlc3VsdHMgPSBmdW5jdGlvbihzcGVjKSB7CiAgdmFyIHJlc3VsdHMgPSBzcGVjLnJlc3VsdHMoKTsKICB2YXIgc3RhdHVzID0gcmVzdWx0cy5wYXNzZWQoKSA/ICdwYXNzZWQgYWxlcnQtc3VjY2VzcycgOiAnZmFpbGVkIGFsZXJ0LWVycm9yJzsKICBpZiAocmVzdWx0cy5za2lwcGVkKSB7CiAgICBzdGF0dXMgPSAnc2tpcHBlZCBhbGVydC1pbmZvJzsKICB9CiAgdmFyIHNwZWNEaXYgPSB0aGlzLmNyZWF0ZURvbSgnZGl2JywgeyBjbGFzc05hbWU6ICdzcGVjIGFsZXJ0ICcgICsgc3RhdHVzIH0sCiAgICAgIHRoaXMuY3JlYXRlRG9tKCdhJywgeyBjbGFzc05hbWU6ICdydW5fc3BlYyBidG4gYnRuLXhzIGJ0bi1taW5pIGJ0bi1pbmZvJywgaHJlZjogdGhpcy5zcGVjSHJlZihzcGVjKSB9LCAicnVuIiksCiAgICAgIHRoaXMuY3JlYXRlRG9tKCdhJywgewogICAgICAgIGNsYXNzTmFtZTogJ2Rlc2NyaXB0aW9uJywKICAgICAgICBocmVmOiB0aGlzLnNwZWNIcmVmKHNwZWMpLAogICAgICAgIHRpdGxlOiBzcGVjLmdldEZ1bGxOYW1lKCkKICAgICAgfSwgc3BlYy5kZXNjcmlwdGlvbikpOwoKCiAgdmFyIHJlc3VsdEl0ZW1zID0gcmVzdWx0cy5nZXRJdGVtcygpOwogIHZhciBtZXNzYWdlc0RpdiA9IHRoaXMuY3JlYXRlRG9tKCdkaXYnLCB7IGNsYXNzTmFtZTogJ21lc3NhZ2VzJyB9KTsKICBmb3IgKHZhciBpID0gMDsgaSA8IHJlc3VsdEl0ZW1zLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgcmVzdWx0ID0gcmVzdWx0SXRlbXNbaV07CgogICAgaWYgKHJlc3VsdC50eXBlID09ICdsb2cnKSB7CiAgICAgIG1lc3NhZ2VzRGl2LmFwcGVuZENoaWxkKHRoaXMuY3JlYXRlRG9tKCdkaXYnLCB7Y2xhc3NOYW1lOiAncmVzdWx0TWVzc2FnZSBsb2cnfSwgcmVzdWx0LnRvU3RyaW5nKCkpKTsKICAgIH0gZWxzZSBpZiAocmVzdWx0LnR5cGUgPT0gJ2V4cGVjdCcgJiYgcmVzdWx0LnBhc3NlZCAmJiAhcmVzdWx0LnBhc3NlZCgpKSB7CiAgICAgIG1lc3NhZ2VzRGl2LmFwcGVuZENoaWxkKHRoaXMuY3JlYXRlRG9tKCdkaXYnLCB7Y2xhc3NOYW1lOiAncmVzdWx0TWVzc2FnZSBmYWlsJ30sIHJlc3VsdC5tZXNzYWdlKSk7CgogICAgICBpZiAocmVzdWx0LnRyYWNlLnN0YWNrKSB7CiAgICAgICAgbWVzc2FnZXNEaXYuYXBwZW5kQ2hpbGQodGhpcy5jcmVhdGVEb20oJ3ByZScsIHtjbGFzc05hbWU6ICdzdGFja1RyYWNlJ30sIHJlc3VsdC50cmFjZS5zdGFjaykpOwogICAgICB9CiAgICB9CiAgfQoKICBpZiAobWVzc2FnZXNEaXYuY2hpbGROb2Rlcy5sZW5ndGggPiAwKSB7CiAgICBzcGVjRGl2LmFwcGVuZENoaWxkKG1lc3NhZ2VzRGl2KTsKICB9CgogIHRoaXMuc3VpdGVEaXZzW3NwZWMuc3VpdGUuaWRdLmFwcGVuZENoaWxkKHNwZWNEaXYpOwp9OwoKamFzbWluZS5Cb290c3RyYXBSZXBvcnRlci5wcm90b3R5cGUubG9nID0gZnVuY3Rpb24oKSB7CiAgdmFyIGNvbnNvbGUgPSBqYXNtaW5lLmdldEdsb2JhbCgpLmNvbnNvbGU7CiAgaWYgKGNvbnNvbGUgJiYgY29uc29sZS5sb2cpIHsKICAgIGlmIChjb25zb2xlLmxvZy5hcHBseSkgewogICAgICBjb25zb2xlLmxvZy5hcHBseShjb25zb2xlLCBhcmd1bWVudHMpOwogICAgfSBlbHNlIHsKICAgICAgY29uc29sZS5sb2coYXJndW1lbnRzKTsgLy8gaWUgZml4OiBjb25zb2xlLmxvZy5hcHBseSBkb2Vzbid0IGV4aXN0IG9uIGllCiAgICB9CiAgfQp9OwoKamFzbWluZS5Cb290c3RyYXBSZXBvcnRlci5wcm90b3R5cGUuc3BlY0hyZWYgPSBmdW5jdGlvbihzcGVjKSB7CiAgcmV0dXJuICc/c3BlYz0nICsgZW5jb2RlVVJJQ29tcG9uZW50KHNwZWMuZ2V0RnVsbE5hbWUoKSkgKyAodGhpcy5jaGVja1Bhc3NlZCA/ICcmc2hvd1Bhc3NlZD10cnVlJzogJycpICsgKHRoaXMuY2hlY2tTa2lwcGVkID8gJyZzaG93U2tpcHBlZD10cnVlJyA6ICcnKTsKfQoKamFzbWluZS5Cb290c3RyYXBSZXBvcnRlci5wcm90b3R5cGUuZ2V0TG9jYXRpb24gPSBmdW5jdGlvbigpIHsKICByZXR1cm4gdGhpcy5kb2N1bWVudC5sb2NhdGlvbjsKfTsKCmphc21pbmUuQm9vdHN0cmFwUmVwb3J0ZXIucHJvdG90eXBlLmdldFBhcmFtTWFwID0gZnVuY3Rpb24oKSB7CiAgdmFyIHBhcmFtTWFwID0ge307CiAgdmFyIHBhcmFtcyA9IHRoaXMuZ2V0TG9jYXRpb24oKS5zZWFyY2guc3Vic3RyaW5nKDEpLnNwbGl0KCcmJyk7CiAgZm9yICh2YXIgaSA9IDA7IGkgPCBwYXJhbXMubGVuZ3RoOyBpKyspIHsKICAgIHZhciBwID0gcGFyYW1zW2ldLnNwbGl0KCc9Jyk7CiAgICBwYXJhbU1hcFtkZWNvZGVVUklDb21wb25lbnQocFswXSldID0gZGVjb2RlVVJJQ29tcG9uZW50KHBbMV0pOwogIH0KICByZXR1cm4gcGFyYW1NYXA7Cn0KCmphc21pbmUuQm9vdHN0cmFwUmVwb3J0ZXIucHJvdG90eXBlLnNwZWNGaWx0ZXIgPSBmdW5jdGlvbihzcGVjKSB7CiAgdmFyIHBhcmFtTWFwID0gdGhpcy5nZXRQYXJhbU1hcCgpOwoKICBpZiAocGFyYW1NYXAuc3BlYykgewogICAgcmV0dXJuIHNwZWMuZ2V0RnVsbE5hbWUoKS5pbmRleE9mKHBhcmFtTWFwLnNwZWMpID09PSAwOwogIH0gZWxzZSBpZiAocGFyYW1NYXAuc3BlY19tYXRjaGluZykgewogICAgaWYgKCF0aGlzLnNwZWNNYXRjaGluZ1JlZ2V4KSB7CiAgICAgIHRoaXMuc3BlY01hdGNoaW5nUmVnZXggPSBuZXcgUmVnRXhwKHBhcmFtTWFwLnNwZWNfbWF0Y2hpbmcpOwogICAgfQogICAgcmV0dXJuIHRoaXMuc3BlY01hdGNoaW5nUmVnZXgudGVzdChzcGVjLmdldEZ1bGxOYW1lKCkpOwogIH0gZWxzZSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cn07Cg==",
                "body": "amFzbWluZS5Cb290c3RyYXBSZXBvcnRlciA9IGZ1bmN0aW9uKGRvYykgewogIHRoaXMuZG9jdW1lbnQgPSBkb2MgfHwgZG9jdW1lbnQ7CiAgdGhpcy5zdWl0ZURpdnMgPSB7fTsKICB0aGlzLmxvZ1J1bm5pbmdTcGVjcyA9IGZhbHNlOwogIHZhciBzZWxmID0gdGhpczsKICAvL2F1dG9tYXRpY2FsbHkgdXNlIHRoZSBzcGVjIGZpbHRlciBzdXBwbGllZCBieSB0aGUgcmVwb3J0ZXIKICBqYXNtaW5lLmdldEVudigpLnNwZWNGaWx0ZXIgPSBmdW5jdGlvbigpe3JldHVybiBzZWxmLnNwZWNGaWx0ZXIuYXBwbHkoc2VsZiwgYXJndW1lbnRzKTt9Owp9OwoKamFzbWluZS5Cb290c3RyYXBSZXBvcnRlci5wcm90b3R5cGUuY3JlYXRlRG9tID0gZnVuY3Rpb24odHlwZSwgYXR0cnMsIGNoaWxkcmVuVmFyQXJncykgewogIHZhciBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodHlwZSk7CgogIGZvciAodmFyIGkgPSAyOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgY2hpbGQgPSBhcmd1bWVudHNbaV07CgogICAgaWYgKHR5cGVvZiBjaGlsZCA9PT0gJ3N0cmluZycpIHsKICAgICAgZWwuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoY2hpbGQpKTsKICAgIH0gZWxzZSB7CiAgICAgIGlmIChjaGlsZCkgeyBlbC5hcHBlbmRDaGlsZChjaGlsZCk7IH0KICAgIH0KICB9CgogIGZvciAodmFyIGF0dHIgaW4gYXR0cnMpIHsKICAgIGlmIChhdHRyID09ICJjbGFzc05hbWUiKSB7CiAgICAgIGVsW2F0dHJdID0gYXR0cnNbYXR0cl07CiAgICB9IGVsc2UgewogICAgICBlbC5zZXRBdHRyaWJ1dGUoYXR0ciwgYXR0cnNbYXR0cl0pOwogICAgfQogIH0KCiAgcmV0dXJuIGVsOwp9OwoKamFzbWluZS5Cb290c3RyYXBSZXBvcnRlci5wcm90b3R5cGUucmVwb3J0UnVubmVyU3RhcnRpbmcgPSBmdW5jdGlvbihydW5uZXIpIHsKICB2YXIgc2hvd1Bhc3NlZCwgc2hvd1NraXBwZWQ7CiAgdGhpcy5jaGVja1Bhc3NlZCA9ICEhdGhpcy5nZXRMb2NhdGlvbigpLnNlYXJjaC5tYXRjaCgic2hvd1Bhc3NlZD10cnVlIik7CiAgdGhpcy5jaGVja1NraXBwZWQgPSAhIXRoaXMuZ2V0TG9jYXRpb24oKS5zZWFyY2gubWF0Y2goInNob3dTa2lwcGVkPXRydWUiKTsKCiAgdGhpcy5vdXRlckRpdiA9IHRoaXMuY3JlYXRlRG9tKCdkaXYnLCB7IGNsYXNzTmFtZTogJ2phc21pbmVfcmVwb3J0ZXIgY29udGFpbmVyJyB9LAogICAgICB0aGlzLmNyZWF0ZURvbSgnaDEnLCB7IGNsYXNzTmFtZTogJ2Jhbm5lciB3ZWxsJyB9LAogICAgICAgIHRoaXMuY3JlYXRlRG9tKCdzcGFuJywgeyBjbGFzc05hbWU6ICdsb2dvJyB9LAogICAgICAgICAgICB0aGlzLmNyZWF0ZURvbSgnc3BhbicsIHsgY2xhc3NOYW1lOiAndGl0bGUnIH0sICJKYXNtaW5lIiksCiAgICAgICAgICAgIHRoaXMuY3JlYXRlRG9tKCdzbWFsbCcsIHsgY2xhc3NOYW1lOiAndmVyc2lvbicgfSwgcnVubmVyLmVudi52ZXJzaW9uU3RyaW5nKCkpKSwKICAgICAgICB0aGlzLmNyZWF0ZURvbSgnc3BhbicsIHsgY2xhc3NOYW1lOiAnb3B0aW9ucyBmb3JtLWlubGluZScgfSwKICAgICAgICAgICAgdGhpcy5jcmVhdGVEb20oJ2xhYmVsJywgeyBjbGFzc05hbWU6ICdjaGVja2JveCcgfSwKICAgICAgICAgICAgICAgIHNob3dQYXNzZWQgPSB0aGlzLmNyZWF0ZURvbSgnaW5wdXQnLCB0aGlzLmNoZWNrUGFzc2VkID8geyB0eXBlOiAnY2hlY2tib3gnLCBjaGVja2VkOiAndHJ1ZScgfSA6IHsgdHlwZTogJ2NoZWNrYm94JyB9KSwKICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlRG9tKCdzcGFuJywge30sICIgc2hvdyBwYXNzZWQgIikpLAogICAgICAgICAgICAKICAgICAgICAgICAgdGhpcy5jcmVhdGVEb20oJ2xhYmVsJywgeyBjbGFzc05hbWU6ICdjaGVja2JveCcgfSwKICAgICAgICAgICAgICAgIHNob3dTa2lwcGVkID0gdGhpcy5jcmVhdGVEb20oJ2lucHV0JywgdGhpcy5jaGVja1NraXBwZWQgPyB7IHR5cGU6ICdjaGVja2JveCcsIGNoZWNrZWQ6ICd0cnVlJyB9IDogeyB0eXBlOiAnY2hlY2tib3gnIH0pLAogICAgICAgICAgICAgICAgdGhpcy5jcmVhdGVEb20oJ3NwYW4nLCB7fSwgIiBzaG93IHNraXBwZWQiKSkKICAgICAgICApCiAgICAgICksCgogICAgICB0aGlzLnJ1bm5lckRpdiA9IHRoaXMuY3JlYXRlRG9tKCdkaXYnLCB7IGNsYXNzTmFtZTogJ2FsZXJ0IHdhcm5pbmcgcnVubmVyIHJ1bm5pbmcnIH0sCiAgICAgICAgICB0aGlzLmNyZWF0ZURvbSgnYScsIHsgY2xhc3NOYW1lOiAncnVuX3NwZWMgYnRuIGJ0bi14cyBidG4tbWluaSBidG4taW5mbycsIGhyZWY6ICc/JyB9LCAicnVuIGFsbCIpLAogICAgICAgICAgdGhpcy5ydW5uZXJNZXNzYWdlU3BhbiA9IHRoaXMuY3JlYXRlRG9tKCdzcGFuJywge30sICJSdW5uaW5nLi4uIiksCiAgICAgICAgICB0aGlzLmZpbmlzaGVkQXRTcGFuID0gdGhpcy5jcmVhdGVEb20oJ3NwYW4nLCB7IGNsYXNzTmFtZTogJ2ZpbmlzaGVkLWF0JyB9LCAiIikpCiAgICAgICk7CgogIHRoaXMuZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0aGlzLm91dGVyRGl2KTsKCiAgdmFyIHN1aXRlcyA9IHJ1bm5lci5zdWl0ZXMoKTsKICBmb3IgKHZhciBpID0gMDsgaSA8IHN1aXRlcy5sZW5ndGg7IGkrKykgewogICAgdmFyIHN1aXRlID0gc3VpdGVzW2ldOwogICAgdmFyIHN1aXRlRGl2ID0gdGhpcy5jcmVhdGVEb20oJ2RpdicsIHsgY2xhc3NOYW1lOiAnc3VpdGUgYWxlcnQgYWxlcnQtYmxvY2snIH0sCiAgICAgICAgdGhpcy5jcmVhdGVEb20oJ2EnLCB7IGNsYXNzTmFtZTogJ3J1bl9zcGVjIGJ0biBidG4teHMgYnRuLW1pbmkgYnRuLWluZm8nLCBocmVmOiB0aGlzLnNwZWNIcmVmKHN1aXRlKSB9LCAicnVuIiksCiAgICAgICAgdGhpcy5jcmVhdGVEb20oJ2EnLCB7IGNsYXNzTmFtZTogJ2Rlc2NyaXB0aW9uJywgaHJlZjogdGhpcy5zcGVjSHJlZihzdWl0ZSkgfSwgc3VpdGUuZGVzY3JpcHRpb24pKTsKICAgIHRoaXMuc3VpdGVEaXZzW3N1aXRlLmlkXSA9IHN1aXRlRGl2OwogICAgdmFyIHBhcmVudERpdiA9IHRoaXMub3V0ZXJEaXY7CiAgICBpZiAoc3VpdGUucGFyZW50U3VpdGUpIHsKICAgICAgcGFyZW50RGl2ID0gdGhpcy5zdWl0ZURpdnNbc3VpdGUucGFyZW50U3VpdGUuaWRdOwogICAgfQogICAgcGFyZW50RGl2LmFwcGVuZENoaWxkKHN1aXRlRGl2KTsKICB9CgogIHRoaXMuc3RhcnRlZEF0ID0gbmV3IERhdGUoKTsKCiAgaWYgKHRoaXMuY2hlY2tQYXNzZWQpIHsKICAgIHRoaXMub3V0ZXJEaXYuY2xhc3NOYW1lICs9ICcgc2hvdy1wYXNzZWQnOwogIH0KICBpZiAodGhpcy5jaGVja1NraXBwZWQpIHsKICAgIHRoaXMub3V0ZXJEaXYuY2xhc3NOYW1lICs9ICcgc2hvdy1za2lwcGVkJzsKICB9CgogIHZhciBzZWxmID0gdGhpczsKICBzaG93UGFzc2VkLm9uY2xpY2sgPSBmdW5jdGlvbihldnQpIHsKICAgIGlmIChzaG93UGFzc2VkLmNoZWNrZWQpIHsKICAgICAgd2luZG93LmxvY2F0aW9uID0gd2luZG93LmxvY2F0aW9uLmhyZWYucmVwbGFjZSgvXD8kLywgJycpICsgKHNlbGYuZG9jdW1lbnQubG9jYXRpb24uc2VhcmNoLmxlbmd0aCA/ICImc2hvd1Bhc3NlZD10cnVlIiA6ICI/c2hvd1Bhc3NlZD10cnVlIik7CiAgICB9IGVsc2UgewogICAgICB3aW5kb3cubG9jYXRpb24gPSB3aW5kb3cubG9jYXRpb24uaHJlZi5yZXBsYWNlKC8mP3Nob3dQYXNzZWQ9dHJ1ZXxcP3Nob3dQYXNzZWQ9dHJ1ZSQvLCAnJyk7CiAgICB9CiAgfTsKCiAgc2hvd1NraXBwZWQub25jbGljayA9IGZ1bmN0aW9uKGV2dCkgewogICAgaWYgKHNob3dTa2lwcGVkLmNoZWNrZWQpIHsKICAgICAgd2luZG93LmxvY2F0aW9uID0gd2luZG93LmxvY2F0aW9uLmhyZWYucmVwbGFjZSgvXD8kLywgJycpICsgKHNlbGYuZG9jdW1lbnQubG9jYXRpb24uc2VhcmNoLmxlbmd0aCA/ICImc2hvd1NraXBwZWQ9dHJ1ZSIgOiAiP3Nob3dTa2lwcGVkPXRydWUiKTsKICAgIH0gZWxzZSB7CiAgICAgIHdpbmRvdy5sb2NhdGlvbiA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmLnJlcGxhY2UoLyY/c2hvd1NraXBwZWQ9dHJ1ZXxcP3Nob3dTa2lwcGVkPXRydWUkLywgJycpOyAgICAgIAogICAgfQogIH07Cn07CgpqYXNtaW5lLkJvb3RzdHJhcFJlcG9ydGVyLnByb3RvdHlwZS5yZXBvcnRSdW5uZXJSZXN1bHRzID0gZnVuY3Rpb24ocnVubmVyKSB7CiAgdmFyIHJlc3VsdHMgPSBydW5uZXIucmVzdWx0cygpOwogIHZhciBjbGFzc05hbWUgPSAocmVzdWx0cy5mYWlsZWRDb3VudCA+IDApID8gImFsZXJ0IGFsZXJ0LWVycm9yIHJ1bm5lciBmYWlsZWQiIDogImFsZXJ0IGFsZXJ0LXN1Y2Nlc3MgcnVubmVyIHBhc3NlZCI7CiAgdGhpcy5ydW5uZXJEaXYuc2V0QXR0cmlidXRlKCJjbGFzcyIsIGNsYXNzTmFtZSk7CiAgLy9kbyBpdCB0d2ljZSBmb3IgSUUKICB0aGlzLnJ1bm5lckRpdi5zZXRBdHRyaWJ1dGUoImNsYXNzTmFtZSIsIGNsYXNzTmFtZSk7CiAgdmFyIHNwZWNzID0gcnVubmVyLnNwZWNzKCk7CiAgdmFyIHNwZWNDb3VudCA9IDA7CiAgZm9yICh2YXIgaSA9IDA7IGkgPCBzcGVjcy5sZW5ndGg7IGkrKykgewogICAgaWYgKHRoaXMuc3BlY0ZpbHRlcihzcGVjc1tpXSkpIHsKICAgICAgc3BlY0NvdW50Kys7CiAgICB9CiAgfQogIHZhciBtZXNzYWdlID0gIiIgKyBzcGVjQ291bnQgKyAiIHNwZWMiICsgKHNwZWNDb3VudCA9PSAxID8gIiIgOiAicyIgKSArICIsICIgKyByZXN1bHRzLmZhaWxlZENvdW50ICsgIiBmYWlsdXJlIiArICgocmVzdWx0cy5mYWlsZWRDb3VudCA9PSAxKSA/ICIiIDogInMiKTsKICBtZXNzYWdlICs9ICIgaW4gIiArICgobmV3IERhdGUoKS5nZXRUaW1lKCkgLSB0aGlzLnN0YXJ0ZWRBdC5nZXRUaW1lKCkpIC8gMTAwMCkgKyAicyI7CiAgdGhpcy5ydW5uZXJNZXNzYWdlU3Bhbi5yZXBsYWNlQ2hpbGQodGhpcy5jcmVhdGVEb20oJ2EnLCB7IGNsYXNzTmFtZTogJ2Rlc2NyaXB0aW9uJywgaHJlZjogJz8nfSwgbWVzc2FnZSksIHRoaXMucnVubmVyTWVzc2FnZVNwYW4uZmlyc3RDaGlsZCk7CgogIHRoaXMuZmluaXNoZWRBdFNwYW4uYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoIkZpbmlzaGVkIGF0ICIgKyBuZXcgRGF0ZSgpLnRvU3RyaW5nKCkpKTsKfTsKCmphc21pbmUuQm9vdHN0cmFwUmVwb3J0ZXIucHJvdG90eXBlLnJlcG9ydFN1aXRlUmVzdWx0cyA9IGZ1bmN0aW9uKHN1aXRlKSB7CiAgdmFyIHJlc3VsdHMgPSBzdWl0ZS5yZXN1bHRzKCk7CiAgdmFyIHN0YXR1cyA9IHJlc3VsdHMucGFzc2VkKCkgPyAncGFzc2VkIGFsZXJ0LXN1Y2Nlc3MnIDogJ2ZhaWxlZCBhbGVydC1kYW5nZXInOwogIGlmIChyZXN1bHRzLnRvdGFsQ291bnQgPT09IDApIHsgLy8gdG9kbzogY2hhbmdlIHRoaXMgdG8gY2hlY2sgcmVzdWx0cy5za2lwcGVkCiAgICBzdGF0dXMgPSAnc2tpcHBlZCBhbGVydC1pbmZvJzsKICB9CiAgdGhpcy5zdWl0ZURpdnNbc3VpdGUuaWRdLmNsYXNzTmFtZSArPSAiICIgKyBzdGF0dXM7Cn07CgpqYXNtaW5lLkJvb3RzdHJhcFJlcG9ydGVyLnByb3RvdHlwZS5yZXBvcnRTcGVjU3RhcnRpbmcgPSBmdW5jdGlvbihzcGVjKSB7CiAgaWYgKHRoaXMubG9nUnVubmluZ1NwZWNzKSB7CiAgICB0aGlzLmxvZygnPj4gSmFzbWluZSBSdW5uaW5nICcgKyBzcGVjLnN1aXRlLmRlc2NyaXB0aW9uICsgJyAnICsgc3BlYy5kZXNjcmlwdGlvbiArICcuLi4nKTsKICB9Cn07CgpqYXNtaW5lLkJvb3RzdHJhcFJlcG9ydGVyLnByb3RvdHlwZS5yZXBvcnRTcGVjUmVzdWx0cyA9IGZ1bmN0aW9uKHNwZWMpIHsKICB2YXIgcmVzdWx0cyA9IHNwZWMucmVzdWx0cygpOwogIHZhciBzdGF0dXMgPSByZXN1bHRzLnBhc3NlZCgpID8gJ3Bhc3NlZCBhbGVydC1zdWNjZXNzJyA6ICdmYWlsZWQgYWxlcnQtZXJyb3InOwogIGlmIChyZXN1bHRzLnNraXBwZWQpIHsKICAgIHN0YXR1cyA9ICdza2lwcGVkIGFsZXJ0LWluZm8nOwogIH0KICB2YXIgc3BlY0RpdiA9IHRoaXMuY3JlYXRlRG9tKCdkaXYnLCB7IGNsYXNzTmFtZTogJ3NwZWMgYWxlcnQgJyAgKyBzdGF0dXMgfSwKICAgICAgdGhpcy5jcmVhdGVEb20oJ2EnLCB7IGNsYXNzTmFtZTogJ3J1bl9zcGVjIGJ0biBidG4teHMgYnRuLW1pbmkgYnRuLWluZm8nLCBocmVmOiB0aGlzLnNwZWNIcmVmKHNwZWMpIH0sICJydW4iKSwKICAgICAgdGhpcy5jcmVhdGVEb20oJ2EnLCB7CiAgICAgICAgY2xhc3NOYW1lOiAnZGVzY3JpcHRpb24nLAogICAgICAgIGhyZWY6IHRoaXMuc3BlY0hyZWYoc3BlYyksCiAgICAgICAgdGl0bGU6IHNwZWMuZ2V0RnVsbE5hbWUoKQogICAgICB9LCBzcGVjLmRlc2NyaXB0aW9uKSk7CgoKICB2YXIgcmVzdWx0SXRlbXMgPSByZXN1bHRzLmdldEl0ZW1zKCk7CiAgdmFyIG1lc3NhZ2VzRGl2ID0gdGhpcy5jcmVhdGVEb20oJ2RpdicsIHsgY2xhc3NOYW1lOiAnbWVzc2FnZXMnIH0pOwogIGZvciAodmFyIGkgPSAwOyBpIDwgcmVzdWx0SXRlbXMubGVuZ3RoOyBpKyspIHsKICAgIHZhciByZXN1bHQgPSByZXN1bHRJdGVtc1tpXTsKCiAgICBpZiAocmVzdWx0LnR5cGUgPT0gJ2xvZycpIHsKICAgICAgbWVzc2FnZXNEaXYuYXBwZW5kQ2hpbGQodGhpcy5jcmVhdGVEb20oJ2RpdicsIHtjbGFzc05hbWU6ICdyZXN1bHRNZXNzYWdlIGxvZyd9LCByZXN1bHQudG9TdHJpbmcoKSkpOwogICAgfSBlbHNlIGlmIChyZXN1bHQudHlwZSA9PSAnZXhwZWN0JyAmJiByZXN1bHQucGFzc2VkICYmICFyZXN1bHQucGFzc2VkKCkpIHsKICAgICAgbWVzc2FnZXNEaXYuYXBwZW5kQ2hpbGQodGhpcy5jcmVhdGVEb20oJ2RpdicsIHtjbGFzc05hbWU6ICdyZXN1bHRNZXNzYWdlIGZhaWwnfSwgcmVzdWx0Lm1lc3NhZ2UpKTsKCiAgICAgIGlmIChyZXN1bHQudHJhY2Uuc3RhY2spIHsKICAgICAgICBtZXNzYWdlc0Rpdi5hcHBlbmRDaGlsZCh0aGlzLmNyZWF0ZURvbSgncHJlJywge2NsYXNzTmFtZTogJ3N0YWNrVHJhY2UnfSwgcmVzdWx0LnRyYWNlLnN0YWNrKSk7CiAgICAgIH0KICAgIH0KICB9CgogIGlmIChtZXNzYWdlc0Rpdi5jaGlsZE5vZGVzLmxlbmd0aCA+IDApIHsKICAgIHNwZWNEaXYuYXBwZW5kQ2hpbGQobWVzc2FnZXNEaXYpOwogIH0KCiAgdGhpcy5zdWl0ZURpdnNbc3BlYy5zdWl0ZS5pZF0uYXBwZW5kQ2hpbGQoc3BlY0Rpdik7Cn07CgpqYXNtaW5lLkJvb3RzdHJhcFJlcG9ydGVyLnByb3RvdHlwZS5sb2cgPSBmdW5jdGlvbigpIHsKICB2YXIgY29uc29sZSA9IGphc21pbmUuZ2V0R2xvYmFsKCkuY29uc29sZTsKICBpZiAoY29uc29sZSAmJiBjb25zb2xlLmxvZykgewogICAgaWYgKGNvbnNvbGUubG9nLmFwcGx5KSB7CiAgICAgIGNvbnNvbGUubG9nLmFwcGx5KGNvbnNvbGUsIGFyZ3VtZW50cyk7CiAgICB9IGVsc2UgewogICAgICBjb25zb2xlLmxvZyhhcmd1bWVudHMpOyAvLyBpZSBmaXg6IGNvbnNvbGUubG9nLmFwcGx5IGRvZXNuJ3QgZXhpc3Qgb24gaWUKICAgIH0KICB9Cn07CgpqYXNtaW5lLkJvb3RzdHJhcFJlcG9ydGVyLnByb3RvdHlwZS5zcGVjSHJlZiA9IGZ1bmN0aW9uKHNwZWMpIHsKICByZXR1cm4gJz9zcGVjPScgKyBlbmNvZGVVUklDb21wb25lbnQoc3BlYy5nZXRGdWxsTmFtZSgpKSArICh0aGlzLmNoZWNrUGFzc2VkID8gJyZzaG93UGFzc2VkPXRydWUnOiAnJykgKyAodGhpcy5jaGVja1NraXBwZWQgPyAnJnNob3dTa2lwcGVkPXRydWUnIDogJycpOwp9CgpqYXNtaW5lLkJvb3RzdHJhcFJlcG9ydGVyLnByb3RvdHlwZS5nZXRMb2NhdGlvbiA9IGZ1bmN0aW9uKCkgewogIHJldHVybiB0aGlzLmRvY3VtZW50LmxvY2F0aW9uOwp9OwoKamFzbWluZS5Cb290c3RyYXBSZXBvcnRlci5wcm90b3R5cGUuZ2V0UGFyYW1NYXAgPSBmdW5jdGlvbigpIHsKICB2YXIgcGFyYW1NYXAgPSB7fTsKICB2YXIgcGFyYW1zID0gdGhpcy5nZXRMb2NhdGlvbigpLnNlYXJjaC5zdWJzdHJpbmcoMSkuc3BsaXQoJyYnKTsKICBmb3IgKHZhciBpID0gMDsgaSA8IHBhcmFtcy5sZW5ndGg7IGkrKykgewogICAgdmFyIHAgPSBwYXJhbXNbaV0uc3BsaXQoJz0nKTsKICAgIHBhcmFtTWFwW2RlY29kZVVSSUNvbXBvbmVudChwWzBdKV0gPSBkZWNvZGVVUklDb21wb25lbnQocFsxXSk7CiAgfQogIHJldHVybiBwYXJhbU1hcDsKfQoKamFzbWluZS5Cb290c3RyYXBSZXBvcnRlci5wcm90b3R5cGUuc3BlY0ZpbHRlciA9IGZ1bmN0aW9uKHNwZWMpIHsKICB2YXIgcGFyYW1NYXAgPSB0aGlzLmdldFBhcmFtTWFwKCk7CgogIGlmIChwYXJhbU1hcC5zcGVjKSB7CiAgICByZXR1cm4gc3BlYy5nZXRGdWxsTmFtZSgpLmluZGV4T2YocGFyYW1NYXAuc3BlYykgPT09IDA7CiAgfSBlbHNlIGlmIChwYXJhbU1hcC5zcGVjX21hdGNoaW5nKSB7CiAgICBpZiAoIXRoaXMuc3BlY01hdGNoaW5nUmVnZXgpIHsKICAgICAgdGhpcy5zcGVjTWF0Y2hpbmdSZWdleCA9IG5ldyBSZWdFeHAocGFyYW1NYXAuc3BlY19tYXRjaGluZyk7CiAgICB9CiAgICByZXR1cm4gdGhpcy5zcGVjTWF0Y2hpbmdSZWdleC50ZXN0KHNwZWMuZ2V0RnVsbE5hbWUoKSk7CiAgfSBlbHNlIHsKICAgIHJldHVybiB0cnVlOwogIH0KfTsK",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Fri, 07 Nov 2014 05:26:33 GMT",
                    "Content-Length": "8442",
                    "Date": "Fri, 07 Nov 2014 05:26:33 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}