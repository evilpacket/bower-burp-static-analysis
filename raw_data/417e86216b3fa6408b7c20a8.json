{
    "url": "http://localhost:9999/iandotkelly/angular-basicauth/angular-basicauth.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Link manipulation (DOM-based)",
    "issueType": 5246976,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based link manipulation vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this to a navigation target within the current page, such as a clickable link or the submission URL of a form. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will modify the target of links within the response. An attacker may be able to leverage this to perform various attacks, including:<ul><li>Causing the user to redirect to an arbitrary external URL, to facilitate a phishing attack.</li><li>Causing the user to submit sensitive form data to a server controlled by the attacker.</li><li>Causing the user to perform an unintended action within the application, by changing the file or query string associated with a link.</li><li>Bypassing browser anti-XSS defenses by injecting on-site links containing XSS exploits, since browser anti-XSS defenses typically do not operate on on-site links.</li></ul>",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based link manipulation vulnerabilities is not to dynamically set the target URLs of links or forms using data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing an arbitrary URL as a link target. In general, this is best achieved by using a whitelist of URLs that are permitted link targets, and strictly validating the target against this list before setting the link target.",
    "issueDetail": "The application may be vulnerable to DOM-based link manipulation. Data is read from <b>window.location</b> and written to <b>the 'href' property of a DOM element</b> via the following statements:<ul><li>endpoint = endpoint || window.location;</li><li>urlParser.href = endpoint;</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/iandotkelly/angular-basicauth/angular-basicauth.js",
                "path": "/iandotkelly/angular-basicauth/angular-basicauth.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9pYW5kb3RrZWxseS9hbmd1bGFyLWJhc2ljYXV0aC9hbmd1bGFyLWJhc2ljYXV0aC5qcyBIVFRQLzEuMQ0KSG9zdDogbG9jYWxob3N0Ojk5OTkNCg0K",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogODk1MQ0KQWNjZXB0LVJhbmdlczogYnl0ZXMNCkNvbnRlbnQtVHlwZTogYXBwbGljYXRpb24vamF2YXNjcmlwdA0KRGF0ZTogVGh1LCAwNiBOb3YgMjAxNCAwNzoxMDozNyBHTVQNCkxhc3QtTW9kaWZpZWQ6IFRodSwgMDYgTm92IDIwMTQgMDc6MTA6MzYgR01UDQoNCi8qKgogKiBCYXNpYyBBdXRoZW50aWNhdGlvbiBNb2R1bGUgZm9yIEFuZ3VsYXJKcwogKgogKiBDb3B5cmlnaHQgKEMpIElhbiBLZWxseQogKiBMaWNlbnNlOiBNSVQKICovCgondXNlIHN0cmljdCc7CgooZnVuY3Rpb24oKSB7CgoJdmFyIGFuZ3VsYXJCYXNpY0F1dGggPSBhbmd1bGFyLm1vZHVsZSgKCQknYW5ndWxhckJhc2ljQXV0aCcsCgkJWwoJCQknTG9jYWxTdG9yYWdlTW9kdWxlJywKCQkJJ2Jhc2U2NCcKCQldKTsKCgkvLyBDb25zdGFudHMKCXZhciBNU19QRVJfTUlOVVRFID0gMTAwMCAqIDYwOwoKCS8qKgoJKiBEaWZmZXJlbmNlIGJldHdlZW4gdHdvIGRhdGVzIGluIGhvdXJzCgkqCgkqIEBwYXJhbSB7RGF0ZX0gYSBGaXJzdCBkYXRlCgkqIEBwYXJhbSB7RGF0ZX0gYiBTZWNvbmQgZGF0ZQoJKi8KCWZ1bmN0aW9uIGRhdGVEaWZmSW5NaW51dGVzKGVhcmxpZXIsIGxhdGVyKSB7CgkJcmV0dXJuIChsYXRlci5nZXRUaW1lKCkgLSBlYXJsaWVyLmdldFRpbWUoKSkgLyBNU19QRVJfTUlOVVRFOwoJfQoKCS8qKgoJICogQ29uc3RhbnRzCgkgKi8KCWFuZ3VsYXJCYXNpY0F1dGguY29uc3RhbnQoJ01PRFVMRV9WRVJTSU9OJywgJzAuMC4wJyk7CgoJLyoqCgkgKiBEZWZhdWx0cwoJICovCglhbmd1bGFyQmFzaWNBdXRoLnZhbHVlKCdhdXRoRGVmYXVsdHMnLCB7CgkJYXV0aGVudGljYXRlVXJsOiAnL2FwaS9hdXRoZW50aWNhdGUnLAoJCXNlc3Npb25NaW51dGVzOiAxODAKCX0pOwoKCS8qKgoJKiBIVFRQIEludGVyY2VwdG9yIHRvIGFkZCBBdXRob3JpemF0aW9uIGhlYWRlcnMgdG8gYWxsIHJlcXVlc3RzIGlmIHRoZQoJKiBhdXRoIGxvY2FsIHN0b3JhZ2UgcHJvcGVydHkgaGFzIGJlZW4gc2V0CgkqLwoJYW5ndWxhckJhc2ljQXV0aC5mYWN0b3J5KCdhdXRoSW50ZXJjZXB0b3InLAoJCVsKCQkJJyRxJywKCQkJJ2F1dGhTZXJ2aWNlJywKCQkJZnVuY3Rpb24gKCRxLCBhdXRoU2VydmljZSkgewoKCQkJCXZhciBpc0VuZHBvaW50ID0gYXV0aFNlcnZpY2UuaXNFbmRwb2ludDsKCgkJCQl2YXIgYXV0aEludGVyY2VwdG9yID0gewoKCQkJCQkvKioKCQkJCQkqIFJlcXVlc3QgSW50ZXJjZXB0b3IKCQkJCQkqCgkJCQkJKiBBZGRzIGFuIGF1dGhvcml6YXRpb24gaGVhZGVyLCBpZiBhbmQgb25seSBpZiB0aGVyZQoJCQkJCSogaXMgb25lIGZvdW5kIGluIHRoZSBsb2NhbCBzdG9yYWdlCgkJCQkJKi8KCQkJCQlyZXF1ZXN0OiBmdW5jdGlvbihjb25maWcpIHsKCQkJCQkJaWYgKGlzRW5kcG9pbnQoY29uZmlnLnVybCkpIHsKCQkJCQkJCXZhciBhdXRoID0gYXV0aFNlcnZpY2UuZ2V0QXV0aCgpOwoJCQkJCQkJdmFyIGhlYWRlcnMgPSBhdXRoU2VydmljZS5oZWFkZXJzOwoJCQkJCQkJaWYgKGF1dGgpIHsKCQkJCQkJCQljb25maWcuaGVhZGVycy5BdXRob3JpemF0aW9uID0gYXV0aDsKCQkJCQkJCQlmb3IgKHZhciBrZXkgaW4gaGVhZGVycykgewoJCQkJCQkJCQlpZiAoaGVhZGVycy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7CgkJCQkJCQkJCQljb25maWcuaGVhZGVyc1trZXldID0gaGVhZGVyc1trZXldOwoJCQkJCQkJCQl9CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJCXJldHVybiBjb25maWc7CgkJCQkJfSwKCgkJCQkJLyoqCgkJCQkJKiBFcnJvciBJbnRlcmNlcHRvcgoJCQkJCSoKCQkJCQkqIFVzZWQgdG8gdHJhcCBhbiBhdXRoZW50aWNhdGlvbiBlcnJvcgoJCQkJCSovCgkJCQkJcmVzcG9uc2VFcnJvcjogZnVuY3Rpb24ocmVqZWN0aW9uKSB7CgkJCQkJCS8vIHRoaXMgaXMgYSBmYWlsdXJlIHRvIGF1dGhlbnRpY2F0ZQoJCQkJCQkvLyBzbyBpbmZvcm0gdGhlIGF1dGhlbnRpY2F0b24gc2VydmljZQoJCQkJCQlpZiAocmVqZWN0aW9uLnN0YXR1cyA9PT0gNDAxKSB7CgkJCQkJCQlhdXRoU2VydmljZS5oYW5kbGVBdXRoRmFpbHVyZSgpOwoJCQkJCQl9CgoJCQkJCQlyZXR1cm4gJHEucmVqZWN0KHJlamVjdGlvbik7CgkJCQkJfQoJCQkJfTsKCgkJCQlyZXR1cm4gYXV0aEludGVyY2VwdG9yOwoJCQl9CgkJXSk7CgoJLyoqCgkqIFNlcnZpY2UgdG8gaGFuZGxlIHVzZXIgYXV0aGVudGljYXRpb24KCSoKCSogVGhpcyBpcyBhIHNpbmdsZXRvbiBzZXJ2aWNlLCBzbyB3ZSB3aWxsIGluc3RhbnRpYXRlIHRoaXMgb25jZSBpbiBhbiBpaWZlCgkqLwoJKGZ1bmN0aW9uKCkgewoJCWFuZ3VsYXJCYXNpY0F1dGguZmFjdG9yeSgnYXV0aFNlcnZpY2UnLAoJCQlbCgkJCQknJGxvZycsCgkJCQknbG9jYWxTdG9yYWdlU2VydmljZScsCgkJCQknJGJhc2U2NCcsCgkJCQknJHEnLAoJCQkJJyRyb290U2NvcGUnLAoJCQkJJyRpbnRlcnZhbCcsCgkJCQknYXV0aERlZmF1bHRzJywKCQkJCWZ1bmN0aW9uICgkbG9nLCBsb2NhbFN0b3JhZ2UsICRiYXNlNjQsICRxLCAkcm9vdFNjb3BlLCAkaW50ZXJ2YWwsIGF1dGhEZWZhdWx0cykgewoKCQkJCQkkbG9nLmRlYnVnKCdhdXRoU2VydmljZSBjb25zdHJ1Y3RlZCcpOwoKCQkJCQl2YXIgTFNfVVNFUk5BTUUgPSAndXNlcm5hbWUnOwoJCQkJCXZhciBMU19BVVRIRU5USUNBVElPTiA9ICdhdXRoJzsKCQkJCQl2YXIgTFNfTEFTVEFDVElWSVRZID0gJ2xhc3QtYWN0aXZpdHknOwoKCQkJCQkvLyBhcnJheSB0byBzdG9yZSBwcm90ZWN0ZWQgZW5kcG9pbnRzCgkJCQkJdmFyIGVuZHBvaW50cyA9IFtdOwoJCQkJCS8vIHVzZSBhbiBhbmNob3IgZWxlbWVudCB0byBwYXJzZSB1cmxzCgkJCQkJdmFyIHVybFBhcnNlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsKCgkJCQkJLyoqCgkJCQkJICogV2hldGhlciBhIGhvc3RuYW1lIGlzIGluIHRoZSBlbmRwb2ludCBjb2xsZWN0aW9uCgkJCQkJICogQHBhcmFtIHtTdHJpbmd9IGhvc3RuYW1lICBUaGUgaG9zdG5hbWUgb2YgYSBVUkwsIGUuZy4gd3d3Lmdvb2dsZS5jb20KCQkJCQkgKi8KCQkJCQlmdW5jdGlvbiBpbkVuZHBvaW50cyhob3N0bmFtZSkgewoJCQkJCQlmb3IgKHZhciBpbmRleCA9IDAsIGxlbiA9IGVuZHBvaW50cy5sZW5ndGg7IGluZGV4IDwgbGVuOyBpbmRleCsrKSB7CgkJCQkJCQlpZiAoaG9zdG5hbWUgPT09IGVuZHBvaW50c1tpbmRleF0pIHsKCQkJCQkJCQlyZXR1cm4gdHJ1ZTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQkJfQoKCQkJCQkvKioKCQkJCQkqIExvZ291dCBhbmQgd2lwZSB0aGUgbG9jYWwgc3RvcmFnZQoJCQkJCSovCgkJCQkJZnVuY3Rpb24gbG9nb3V0KCkgewoJCQkJCQkkbG9nLmRlYnVnKCdsb2dvdXQgZXZlbnQnKTsKCQkJCQkJbG9jYWxTdG9yYWdlLnJlbW92ZShMU19BVVRIRU5USUNBVElPTik7CgkJCQkJCWxvY2FsU3RvcmFnZS5yZW1vdmUoTFNfTEFTVEFDVElWSVRZKTsKCQkJCQkJbG9jYWxTdG9yYWdlLnJlbW92ZShMU19VU0VSTkFNRSk7CgkJCQkJCSRyb290U2NvcGUuJGVtaXQoJ2xvZ291dCcpOwoJCQkJCX0KCgkJCQkJLyoqCgkJCQkJKiBTZXQgdGhlIHVzZXIgY3JlZGVudGlhbHMKCQkJCQkqCgkJCQkJKiBAcGFyYW0ge1N0cmluZ30gdXNlcm5hbWUgVXNlcm5hbWUKCQkJCQkqIEBwYXJhbSB7U3RyaW5nfSBwYXNzd29yZCBVbmVuY3J5cGVkIHBhc3N3b3JkCgkJCQkJKi8KCQkJCQlmdW5jdGlvbiBzZXRDcmVkZW50aWFscyh1c2VybmFtZSwgcGFzc3dvcmQpIHsKCQkJCQkJJGxvZy5kZWJ1ZygnU2V0dGluZyBjcmVkZW50aWFscyBmb3IgdXNlcjogJyArIHVzZXJuYW1lKTsKCgkJCQkJCWxvY2FsU3RvcmFnZS5zZXQoTFNfVVNFUk5BTUUsIHVzZXJuYW1lKTsKCgkJCQkJCS8vIHNldCB0aGUgdmFsdWUgb2YgdGhlIGF1dGgtaGVhZGVyCgkJCQkJCWxvY2FsU3RvcmFnZS5zZXQoTFNfQVVUSEVOVElDQVRJT04sCgkJCQkJCQknQmFzaWMgJyArICRiYXNlNjQuZW5jb2RlKHVzZXJuYW1lICsgJzonICsgcGFzc3dvcmQpKTsKCgkJCQkJCXJlY29yZEFjdGl2aXR5KCk7CgkJCQkJfQoKCQkJCQkvKioKCQkJCQkqIFJlY29yZCBhY2NvdW50IGFjdGl2aXR5CgkJCQkJKi8KCQkJCQlmdW5jdGlvbiByZWNvcmRBY3Rpdml0eSgpIHsKCQkJCQkJbG9jYWxTdG9yYWdlLnNldChMU19MQVNUQUNUSVZJVFksIChuZXcgRGF0ZSgpKS50b1N0cmluZygpKTsKCQkJCQl9CgoJCQkJCS8qKgoJCQkJCSogSXMgdGhlIGxvZ2luIGN1cnJlbnQKCQkJCQkqLwoJCQkJCWZ1bmN0aW9uIGlzQ3VycmVudCgpIHsKCQkJCQkJLy8gcmV0cmlldmUgdGhlIGxhc3QgYWN0aXZpdHkgb2YgdGhlIGFjY291bnQKCQkJCQkJdmFyIGxhc3RBY3Rpdml0eSA9IGxvY2FsU3RvcmFnZS5nZXQoTFNfTEFTVEFDVElWSVRZKSB8fCAnJzsKCgkJCQkJCWlmIChsYXN0QWN0aXZpdHkgPT09ICcnKSB7CgkJCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQkJCX0KCgkJCQkJCXJldHVybiAoZGF0ZURpZmZJbk1pbnV0ZXMobmV3IERhdGUobGFzdEFjdGl2aXR5KSwgbmV3IERhdGUoKSkgPCBhdXRoRGVmYXVsdHMuc2Vzc2lvbk1pbnV0ZXMpOwoJCQkJCX0KCgkJCQkJLyoqCgkJCQkJKiBDb25maXJtIHRoZSBhY2NvdW50IGlzIGN1cnJlbnQKCQkJCQkqLwoJCQkJCWZ1bmN0aW9uIGNvbmZpcm1DdXJyZW50KCkgewoJCQkJCQlpZiAoIWlzQ3VycmVudCgpKSB7CgkJCQkJCQkkbG9nLmRlYnVnKCdBdXRoZW50aWNhdGlvbiBjcmVkZW50aWFscyBtaXNzaW5nIG9yIG91dCBvZiBkYXRlJyk7CgkJCQkJCQlsb2dvdXQoKTsKCQkJCQkJfQoJCQkJCX0KCgkJCQkJLyoqCgkJCQkJKiBSZXR1cm5zIHRoZSBjdXJyZW50IGF1dGhlbnRpY2F0aW9uIGhlYWRlcgoJCQkJCSovCgkJCQkJZnVuY3Rpb24gZ2V0QXV0aCgpIHsKCQkJCQkJcmV0dXJuIGxvY2FsU3RvcmFnZS5nZXQoTFNfQVVUSEVOVElDQVRJT04pOwoJCQkJCX0KCgkJCQkJLy8gd2Ugc2hvdWxkIHdvcmsgb3V0IHdoZXRoZXIgd2UgYXJlIGN1cnJlbnQgb3Igbm90CgkJCQkJY29uZmlybUN1cnJlbnQoKTsKCgkJCQkJLy8gc2V0IGFuIGludGV2YWwgdG8gZG8gdGhpcyByZWd1bGFybHkKCQkJCQkkaW50ZXJ2YWwoY29uZmlybUN1cnJlbnQsIDYwMDAwKTsKCgkJCQkJcmV0dXJuIHsKCQkJCQkJLyoqCgkJCQkJCSogR2V0IGFueSBjdXJyZW50IGF1dGhlbnRpY2F0aW9uIGhlYWRlcgoJCQkJCQkqLwoJCQkJCQlnZXRBdXRoOiBnZXRBdXRoLAoKCQkJCQkJLyoqCgkJCQkJCSogSGFuZGxlcyBsb2dvdXQKCQkJCQkJKi8KCQkJCQkJbG9nb3V0OiBsb2dvdXQsCgoJCQkJCQkvKioKCQkJCQkJKiBSZWNvcmQgYWN0aXZpdHkKCQkJCQkJKi8KCQkJCQkJYWN0aXZpdHk6IHJlY29yZEFjdGl2aXR5LAoKCQkJCQkJLyoqCgkJCQkJCSAqIEFkZCBhbiBlbmRwb2ludAoJCQkJCQkgKgoJCQkJCQkgKiBAcGFyYW0ge1N0cmluZ30gZW5kcG9pbnQgIFRoZSBVUkwgb2YgYW4gZW5kcG9pbnQsIG9yIHVuZGVmaW5lZCBpZiBjdXJyZW50IGxvY2F0aW9uCgkJCQkJCSAqLwoJCQkJCQlhZGRFbmRwb2ludDogZnVuY3Rpb24oZW5kcG9pbnQpIHsKCQkJCQkJCWVuZHBvaW50ID0gZW5kcG9pbnQgfHwgd2luZG93LmxvY2F0aW9uOwoJCQkJCQkJdXJsUGFyc2VyLmhyZWYgPSBlbmRwb2ludDsKCQkJCQkJCXZhciBob3N0bmFtZSA9IHVybFBhcnNlci5ob3N0bmFtZTsKCQkJCQkJCWlmIChpbkVuZHBvaW50cyhob3N0bmFtZSkpIHsKCQkJCQkJCQlyZXR1cm47CgkJCQkJCQl9CgkJCQkJCQllbmRwb2ludHMucHVzaChob3N0bmFtZSk7CgkJCQkJCX0sCgoJCQkJCQkvKioKCQkJCQkJICogQWRkaXRpb25hbCBoZWFkZXJzIHRvIGFkZCB0byBhdXRoZW50aWNhdGVkCgkJCQkJCSAqIHJlcXVlc3RzLgoJCQkJCQkgKi8KCQkJCQkJaGVhZGVyczoge30sCgoJCQkJCQkvKioKCQkJCQkJICogSXMgYW4gVVJMIGEgZGVmaW5lZCBlbmRwb2ludCByZXF1aXJpbmcgYXV0aGVudGljYXRpb24KCQkJCQkJICoKCQkJCQkJICogQHBhcmFtIHtTdHJpbmd9IHVybCBUaGUgVVJMIG9mIGEgcG90ZW50aWFsIGVuZHBvaW50CgkJCQkJCSAqLwoJCQkJCQlpc0VuZHBvaW50OiBmdW5jdGlvbih1cmwpIHsKCQkJCQkJCXVybFBhcnNlci5ocmVmID0gdXJsOwoJCQkJCQkJdmFyIGhvc3RuYW1lID0gdXJsUGFyc2VyLmhvc3RuYW1lOwoJCQkJCQkJcmV0dXJuIGluRW5kcG9pbnRzKGhvc3RuYW1lKTsKCQkJCQkJfSwKCgkJCQkJCS8qKgoJCQkJCQkqIFRoZSBjdXJyZW50IHVzZXJuYW1lCgkJCQkJCSoKCQkJCQkJKiBAcmV0dXJuIHtTdHJpbmd9IFRoZSBjdXJyZW50IHVzZXJuYW1lCgkJCQkJCSovCgkJCQkJCXVzZXJuYW1lOiBmdW5jdGlvbigpIHsKCQkJCQkJCWNvbmZpcm1DdXJyZW50KCk7CgkJCQkJCQlyZXR1cm4gbG9jYWxTdG9yYWdlLmdldChMU19VU0VSTkFNRSk7CgkJCQkJCX0sCgoJCQkJCQkvKioKCQkJCQkJKiBIYW5kbGUgYW4gYXV0aGVudGljYXRpb24gZmFpbHVyZQoJCQkJCQkqLwoJCQkJCQloYW5kbGVBdXRoRmFpbHVyZTogZnVuY3Rpb24oKSB7CgkJCQkJCQlsb2dvdXQoKTsKCQkJCQkJCSRyb290U2NvcGUuJGVtaXQoJ2F1dGhlbnRpY2F0aW9uLWZhaWx1cmUnKTsKCQkJCQkJfSwKCgkJCQkJCS8qKgoJCQkJCQkqIEhhbmRsZXMgbG9naW4gdG8gdGhlIGFwcGxpY2F0aW9uCgkJCQkJCSoKCQkJCQkJKiBAcGFyYW0gIHtTdHJpbmd9IHVzZXJuYW1lIFRoZSB1c2VybmFtZQoJCQkJCQkqIEBwYXJhbSAge1N0cmluZ30gcGFzc3dvcmQgVGhlIHBhc3N3b3JkCgkJCQkJCSogQHJldHVybiB7T2JqZWN0fSAgICAgICAgICBQcm9taXNlIGZvciB0aGUgdHJhbnNhY3Rpb24KCQkJCQkJKi8KCQkJCQkJbG9naW46IGZ1bmN0aW9uKHVzZXJuYW1lLCBwYXNzd29yZCwgaGVhZGVycykgewoJCQkJCQkJJGxvZy5kZWJ1ZygnbG9naW4gZXZlbnQnKTsKCgkJCQkJCQkvLyByZWNvcmQgdGhlIGNyZWRlbnRpYWxzCgkJCQkJCQlzZXRDcmVkZW50aWFscyh1c2VybmFtZSwgcGFzc3dvcmQpOwoKCQkJCQkJCXZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7CgoJCQkJCQkJLyoqCgkJCQkJCQkqIFByb2Nlc3MgdGhlIHJlc3BvbnNlLCBhbmQgaWYgdGhlcmUgYXJlIGFueSBpc3N1ZXMKCQkJCQkJCSogdGhlIHJlamVjdCB0aGUgcHJvbWlzZQoJCQkJCQkJKi8KCQkJCQkJCWZ1bmN0aW9uIHByb2Nlc3NSZXNwb25zZSgpIHsKCQkJCQkJCQkvKiBqc2hpbnQgdmFsaWR0aGlzOiB0cnVlICovCgkJCQkJCQkJaWYgKHRoaXMuc3RhdHVzICE9PSAyMDApIHsKCQkJCQkJCQkJZGVmZXJyZWQucmVqZWN0KCk7CgkJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkJZGVmZXJyZWQucmVzb2x2ZSgpOwoJCQkJCQkJCX0KCQkJCQkJCX0KCgkJCQkJCQkvLyBkb24ndCB1c2UgJGh0dHAgdG8gYXZvaWQgY2lyY3VsYXIgcmVmZXJlbmNlLCBzbwoJCQkJCQkJLy8gZGlyZWN0bHkgdXNlIFhNTEh0dHBSZXF1ZXN0IGFuZCAkcQoJCQkJCQkJdmFyIHByb21pc2UgPSBkZWZlcnJlZC5wcm9taXNlOwoJCQkJCQkJdmFyIHJlcXVlc3QgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKCQkJCQkJCXJlcXVlc3Qub25sb2FkID0gcHJvY2Vzc1Jlc3BvbnNlOwoJCQkJCQkJcmVxdWVzdC5vcGVuKCdHRVQnLCBhdXRoRGVmYXVsdHMuYXV0aGVudGljYXRlVXJsKTsKCQkJCQkJCXJlcXVlc3Quc2V0UmVxdWVzdEhlYWRlcignQWNjZXB0JywgJ2FwcGxpY2F0aW9uL2pzb24nKTsKCQkJCQkJCXJlcXVlc3Quc2V0UmVxdWVzdEhlYWRlcignQXV0aG9yaXphdGlvbicsIGdldEF1dGgoKSk7CgkJCQkJCQlmb3IgKHZhciBrZXkgaW4gdGhpcy5oZWFkZXJzKSB7CgkJCQkJCQkgIGlmICh0aGlzLmhlYWRlcnMuaGFzT3duUHJvcGVydHkoa2V5KSkgewoJCQkJCQkJCQlyZXF1ZXN0LnNldFJlcXVlc3RIZWFkZXIoa2V5LCB0aGlzLmhlYWRlcnNba2V5XSk7CgkJCQkJCQkgIH0KCQkJCQkJCX0KCQkJCQkJCXJlcXVlc3Quc2VuZChudWxsKTsKCgkJCQkJCQkvKioKCQkJCQkJCSogQWxsb3cgc3Vic2NyaWJlcnMgdG8gdGhlIHByb21pc2UgdG8gYWRkIGEKCQkJCQkJCSogc3VjY2VzcyBmdW5jdGlvbiB0byB0aGUgbG9naW4gZXZlbnQKCQkJCQkJCSovCgkJCQkJCQlwcm9taXNlLnN1Y2Nlc3MgPSBmdW5jdGlvbihmbikgewoJCQkJCQkJCXByb21pc2UudGhlbihmdW5jdGlvbigpIHsKCQkJCQkJCQkJZm4oKTsKCQkJCQkJCQl9KTsKCQkJCQkJCQlyZXR1cm4gcHJvbWlzZTsKCQkJCQkJCX07CgoJCQkJCQkJLyoqCgkJCQkJCQkqIEFsbG93IHN1YnNjcmliZXJzIHRvIHRoZSBwcm9taXNlIHRvIGFkZAoJCQkJCQkJKiBhbiBlcnJvciBmdW5jdGlvbiB0byB0aGUgbG9naW4gZXZlbnQKCQkJCQkJCSovCgkJCQkJCQlwcm9taXNlLmVycm9yID0gZnVuY3Rpb24oZm4pIHsKCQkJCQkJCQlwcm9taXNlLnRoZW4obnVsbCwgZnVuY3Rpb24oKSB7CgkJCQkJCQkJCWZuKCk7CgkJCQkJCQkJfSk7CgkJCQkJCQkJcmV0dXJuIHByb21pc2U7CgkJCQkJCQl9OwoKCQkJCQkJCS8qKgoJCQkJCQkJKiBIYW5kbGUgdGhlIHByb21pc2UgYmVpbmcgcmVqZWN0ZWQgb3IgcmVzb2x2ZWQKCQkJCQkJCSovCgkJCQkJCQlwcm9taXNlLnRoZW4oZnVuY3Rpb24gKCkgewoJCQkJCQkJCS8vIHdlJ3ZlIGNvbmZpcm1lZCBjcmVkZW50aWFscyBtYXRjaCBhIHVzZXIKCQkJCQkJCQkkbG9nLmRlYnVnKCdTdWNjZXNzZnVsbHkgYXV0aGVudGljYXRlZCcpOwoJCQkJCQkJCSRyb290U2NvcGUuJGJyb2FkY2FzdCgnbG9naW4nLCB1c2VybmFtZSk7CgkJCQkJCQl9LCBmdW5jdGlvbiAoKSB7CgkJCQkJCQkJLy8gc29tZSBlcnJvciBpbiBjcmVkZW50aWFsIGNoZWNrCgkJCQkJCQkJJGxvZy5kZWJ1ZygnVGVzdCBhdXRoZW50aWNhdGlvbiBmYWlsZWQnKTsKCQkJCQkJCQlsb2dvdXQoKTsKCQkJCQkJCQkkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2F1dGhlbnRpY2F0aW9uLWZhaWxlZCcsIHVzZXJuYW1lKTsKCQkJCQkJCX0pOwoKCQkJCQkJCXJldHVybiBwcm9taXNlOwoJCQkJCQl9CgkJCQkJfTsKCQkJCX0KCQkJXQoJCSk7Cgl9KSgpOwoKCS8vIGFkZCB0aGUgaW50ZXJjZXB0b3IgdG8gdGhlIGh0dHAgc2VydmljZQoJYW5ndWxhckJhc2ljQXV0aC5jb25maWcoWyckaHR0cFByb3ZpZGVyJywgZnVuY3Rpb24oJGh0dHBQcm92aWRlcikgewoJCSRodHRwUHJvdmlkZXIuaW50ZXJjZXB0b3JzLnB1c2goJ2F1dGhJbnRlcmNlcHRvcicpOwoJfV0pOwoKfSkoKTsK",
                "body": "LyoqCiAqIEJhc2ljIEF1dGhlbnRpY2F0aW9uIE1vZHVsZSBmb3IgQW5ndWxhckpzCiAqCiAqIENvcHlyaWdodCAoQykgSWFuIEtlbGx5CiAqIExpY2Vuc2U6IE1JVAogKi8KCid1c2Ugc3RyaWN0JzsKCihmdW5jdGlvbigpIHsKCgl2YXIgYW5ndWxhckJhc2ljQXV0aCA9IGFuZ3VsYXIubW9kdWxlKAoJCSdhbmd1bGFyQmFzaWNBdXRoJywKCQlbCgkJCSdMb2NhbFN0b3JhZ2VNb2R1bGUnLAoJCQknYmFzZTY0JwoJCV0pOwoKCS8vIENvbnN0YW50cwoJdmFyIE1TX1BFUl9NSU5VVEUgPSAxMDAwICogNjA7CgoJLyoqCgkqIERpZmZlcmVuY2UgYmV0d2VlbiB0d28gZGF0ZXMgaW4gaG91cnMKCSoKCSogQHBhcmFtIHtEYXRlfSBhIEZpcnN0IGRhdGUKCSogQHBhcmFtIHtEYXRlfSBiIFNlY29uZCBkYXRlCgkqLwoJZnVuY3Rpb24gZGF0ZURpZmZJbk1pbnV0ZXMoZWFybGllciwgbGF0ZXIpIHsKCQlyZXR1cm4gKGxhdGVyLmdldFRpbWUoKSAtIGVhcmxpZXIuZ2V0VGltZSgpKSAvIE1TX1BFUl9NSU5VVEU7Cgl9CgoJLyoqCgkgKiBDb25zdGFudHMKCSAqLwoJYW5ndWxhckJhc2ljQXV0aC5jb25zdGFudCgnTU9EVUxFX1ZFUlNJT04nLCAnMC4wLjAnKTsKCgkvKioKCSAqIERlZmF1bHRzCgkgKi8KCWFuZ3VsYXJCYXNpY0F1dGgudmFsdWUoJ2F1dGhEZWZhdWx0cycsIHsKCQlhdXRoZW50aWNhdGVVcmw6ICcvYXBpL2F1dGhlbnRpY2F0ZScsCgkJc2Vzc2lvbk1pbnV0ZXM6IDE4MAoJfSk7CgoJLyoqCgkqIEhUVFAgSW50ZXJjZXB0b3IgdG8gYWRkIEF1dGhvcml6YXRpb24gaGVhZGVycyB0byBhbGwgcmVxdWVzdHMgaWYgdGhlCgkqIGF1dGggbG9jYWwgc3RvcmFnZSBwcm9wZXJ0eSBoYXMgYmVlbiBzZXQKCSovCglhbmd1bGFyQmFzaWNBdXRoLmZhY3RvcnkoJ2F1dGhJbnRlcmNlcHRvcicsCgkJWwoJCQknJHEnLAoJCQknYXV0aFNlcnZpY2UnLAoJCQlmdW5jdGlvbiAoJHEsIGF1dGhTZXJ2aWNlKSB7CgoJCQkJdmFyIGlzRW5kcG9pbnQgPSBhdXRoU2VydmljZS5pc0VuZHBvaW50OwoKCQkJCXZhciBhdXRoSW50ZXJjZXB0b3IgPSB7CgoJCQkJCS8qKgoJCQkJCSogUmVxdWVzdCBJbnRlcmNlcHRvcgoJCQkJCSoKCQkJCQkqIEFkZHMgYW4gYXV0aG9yaXphdGlvbiBoZWFkZXIsIGlmIGFuZCBvbmx5IGlmIHRoZXJlCgkJCQkJKiBpcyBvbmUgZm91bmQgaW4gdGhlIGxvY2FsIHN0b3JhZ2UKCQkJCQkqLwoJCQkJCXJlcXVlc3Q6IGZ1bmN0aW9uKGNvbmZpZykgewoJCQkJCQlpZiAoaXNFbmRwb2ludChjb25maWcudXJsKSkgewoJCQkJCQkJdmFyIGF1dGggPSBhdXRoU2VydmljZS5nZXRBdXRoKCk7CgkJCQkJCQl2YXIgaGVhZGVycyA9IGF1dGhTZXJ2aWNlLmhlYWRlcnM7CgkJCQkJCQlpZiAoYXV0aCkgewoJCQkJCQkJCWNvbmZpZy5oZWFkZXJzLkF1dGhvcml6YXRpb24gPSBhdXRoOwoJCQkJCQkJCWZvciAodmFyIGtleSBpbiBoZWFkZXJzKSB7CgkJCQkJCQkJCWlmIChoZWFkZXJzLmhhc093blByb3BlcnR5KGtleSkpIHsKCQkJCQkJCQkJCWNvbmZpZy5oZWFkZXJzW2tleV0gPSBoZWFkZXJzW2tleV07CgkJCQkJCQkJCX0KCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJcmV0dXJuIGNvbmZpZzsKCQkJCQl9LAoKCQkJCQkvKioKCQkJCQkqIEVycm9yIEludGVyY2VwdG9yCgkJCQkJKgoJCQkJCSogVXNlZCB0byB0cmFwIGFuIGF1dGhlbnRpY2F0aW9uIGVycm9yCgkJCQkJKi8KCQkJCQlyZXNwb25zZUVycm9yOiBmdW5jdGlvbihyZWplY3Rpb24pIHsKCQkJCQkJLy8gdGhpcyBpcyBhIGZhaWx1cmUgdG8gYXV0aGVudGljYXRlCgkJCQkJCS8vIHNvIGluZm9ybSB0aGUgYXV0aGVudGljYXRvbiBzZXJ2aWNlCgkJCQkJCWlmIChyZWplY3Rpb24uc3RhdHVzID09PSA0MDEpIHsKCQkJCQkJCWF1dGhTZXJ2aWNlLmhhbmRsZUF1dGhGYWlsdXJlKCk7CgkJCQkJCX0KCgkJCQkJCXJldHVybiAkcS5yZWplY3QocmVqZWN0aW9uKTsKCQkJCQl9CgkJCQl9OwoKCQkJCXJldHVybiBhdXRoSW50ZXJjZXB0b3I7CgkJCX0KCQldKTsKCgkvKioKCSogU2VydmljZSB0byBoYW5kbGUgdXNlciBhdXRoZW50aWNhdGlvbgoJKgoJKiBUaGlzIGlzIGEgc2luZ2xldG9uIHNlcnZpY2UsIHNvIHdlIHdpbGwgaW5zdGFudGlhdGUgdGhpcyBvbmNlIGluIGFuIGlpZmUKCSovCgkoZnVuY3Rpb24oKSB7CgkJYW5ndWxhckJhc2ljQXV0aC5mYWN0b3J5KCdhdXRoU2VydmljZScsCgkJCVsKCQkJCSckbG9nJywKCQkJCSdsb2NhbFN0b3JhZ2VTZXJ2aWNlJywKCQkJCSckYmFzZTY0JywKCQkJCSckcScsCgkJCQknJHJvb3RTY29wZScsCgkJCQknJGludGVydmFsJywKCQkJCSdhdXRoRGVmYXVsdHMnLAoJCQkJZnVuY3Rpb24gKCRsb2csIGxvY2FsU3RvcmFnZSwgJGJhc2U2NCwgJHEsICRyb290U2NvcGUsICRpbnRlcnZhbCwgYXV0aERlZmF1bHRzKSB7CgoJCQkJCSRsb2cuZGVidWcoJ2F1dGhTZXJ2aWNlIGNvbnN0cnVjdGVkJyk7CgoJCQkJCXZhciBMU19VU0VSTkFNRSA9ICd1c2VybmFtZSc7CgkJCQkJdmFyIExTX0FVVEhFTlRJQ0FUSU9OID0gJ2F1dGgnOwoJCQkJCXZhciBMU19MQVNUQUNUSVZJVFkgPSAnbGFzdC1hY3Rpdml0eSc7CgoJCQkJCS8vIGFycmF5IHRvIHN0b3JlIHByb3RlY3RlZCBlbmRwb2ludHMKCQkJCQl2YXIgZW5kcG9pbnRzID0gW107CgkJCQkJLy8gdXNlIGFuIGFuY2hvciBlbGVtZW50IHRvIHBhcnNlIHVybHMKCQkJCQl2YXIgdXJsUGFyc2VyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwoKCQkJCQkvKioKCQkJCQkgKiBXaGV0aGVyIGEgaG9zdG5hbWUgaXMgaW4gdGhlIGVuZHBvaW50IGNvbGxlY3Rpb24KCQkJCQkgKiBAcGFyYW0ge1N0cmluZ30gaG9zdG5hbWUgIFRoZSBob3N0bmFtZSBvZiBhIFVSTCwgZS5nLiB3d3cuZ29vZ2xlLmNvbQoJCQkJCSAqLwoJCQkJCWZ1bmN0aW9uIGluRW5kcG9pbnRzKGhvc3RuYW1lKSB7CgkJCQkJCWZvciAodmFyIGluZGV4ID0gMCwgbGVuID0gZW5kcG9pbnRzLmxlbmd0aDsgaW5kZXggPCBsZW47IGluZGV4KyspIHsKCQkJCQkJCWlmIChob3N0bmFtZSA9PT0gZW5kcG9pbnRzW2luZGV4XSkgewoJCQkJCQkJCXJldHVybiB0cnVlOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJCXJldHVybiBmYWxzZTsKCQkJCQl9CgoJCQkJCS8qKgoJCQkJCSogTG9nb3V0IGFuZCB3aXBlIHRoZSBsb2NhbCBzdG9yYWdlCgkJCQkJKi8KCQkJCQlmdW5jdGlvbiBsb2dvdXQoKSB7CgkJCQkJCSRsb2cuZGVidWcoJ2xvZ291dCBldmVudCcpOwoJCQkJCQlsb2NhbFN0b3JhZ2UucmVtb3ZlKExTX0FVVEhFTlRJQ0FUSU9OKTsKCQkJCQkJbG9jYWxTdG9yYWdlLnJlbW92ZShMU19MQVNUQUNUSVZJVFkpOwoJCQkJCQlsb2NhbFN0b3JhZ2UucmVtb3ZlKExTX1VTRVJOQU1FKTsKCQkJCQkJJHJvb3RTY29wZS4kZW1pdCgnbG9nb3V0Jyk7CgkJCQkJfQoKCQkJCQkvKioKCQkJCQkqIFNldCB0aGUgdXNlciBjcmVkZW50aWFscwoJCQkJCSoKCQkJCQkqIEBwYXJhbSB7U3RyaW5nfSB1c2VybmFtZSBVc2VybmFtZQoJCQkJCSogQHBhcmFtIHtTdHJpbmd9IHBhc3N3b3JkIFVuZW5jcnlwZWQgcGFzc3dvcmQKCQkJCQkqLwoJCQkJCWZ1bmN0aW9uIHNldENyZWRlbnRpYWxzKHVzZXJuYW1lLCBwYXNzd29yZCkgewoJCQkJCQkkbG9nLmRlYnVnKCdTZXR0aW5nIGNyZWRlbnRpYWxzIGZvciB1c2VyOiAnICsgdXNlcm5hbWUpOwoKCQkJCQkJbG9jYWxTdG9yYWdlLnNldChMU19VU0VSTkFNRSwgdXNlcm5hbWUpOwoKCQkJCQkJLy8gc2V0IHRoZSB2YWx1ZSBvZiB0aGUgYXV0aC1oZWFkZXIKCQkJCQkJbG9jYWxTdG9yYWdlLnNldChMU19BVVRIRU5USUNBVElPTiwKCQkJCQkJCSdCYXNpYyAnICsgJGJhc2U2NC5lbmNvZGUodXNlcm5hbWUgKyAnOicgKyBwYXNzd29yZCkpOwoKCQkJCQkJcmVjb3JkQWN0aXZpdHkoKTsKCQkJCQl9CgoJCQkJCS8qKgoJCQkJCSogUmVjb3JkIGFjY291bnQgYWN0aXZpdHkKCQkJCQkqLwoJCQkJCWZ1bmN0aW9uIHJlY29yZEFjdGl2aXR5KCkgewoJCQkJCQlsb2NhbFN0b3JhZ2Uuc2V0KExTX0xBU1RBQ1RJVklUWSwgKG5ldyBEYXRlKCkpLnRvU3RyaW5nKCkpOwoJCQkJCX0KCgkJCQkJLyoqCgkJCQkJKiBJcyB0aGUgbG9naW4gY3VycmVudAoJCQkJCSovCgkJCQkJZnVuY3Rpb24gaXNDdXJyZW50KCkgewoJCQkJCQkvLyByZXRyaWV2ZSB0aGUgbGFzdCBhY3Rpdml0eSBvZiB0aGUgYWNjb3VudAoJCQkJCQl2YXIgbGFzdEFjdGl2aXR5ID0gbG9jYWxTdG9yYWdlLmdldChMU19MQVNUQUNUSVZJVFkpIHx8ICcnOwoKCQkJCQkJaWYgKGxhc3RBY3Rpdml0eSA9PT0gJycpIHsKCQkJCQkJCXJldHVybiBmYWxzZTsKCQkJCQkJfQoKCQkJCQkJcmV0dXJuIChkYXRlRGlmZkluTWludXRlcyhuZXcgRGF0ZShsYXN0QWN0aXZpdHkpLCBuZXcgRGF0ZSgpKSA8IGF1dGhEZWZhdWx0cy5zZXNzaW9uTWludXRlcyk7CgkJCQkJfQoKCQkJCQkvKioKCQkJCQkqIENvbmZpcm0gdGhlIGFjY291bnQgaXMgY3VycmVudAoJCQkJCSovCgkJCQkJZnVuY3Rpb24gY29uZmlybUN1cnJlbnQoKSB7CgkJCQkJCWlmICghaXNDdXJyZW50KCkpIHsKCQkJCQkJCSRsb2cuZGVidWcoJ0F1dGhlbnRpY2F0aW9uIGNyZWRlbnRpYWxzIG1pc3Npbmcgb3Igb3V0IG9mIGRhdGUnKTsKCQkJCQkJCWxvZ291dCgpOwoJCQkJCQl9CgkJCQkJfQoKCQkJCQkvKioKCQkJCQkqIFJldHVybnMgdGhlIGN1cnJlbnQgYXV0aGVudGljYXRpb24gaGVhZGVyCgkJCQkJKi8KCQkJCQlmdW5jdGlvbiBnZXRBdXRoKCkgewoJCQkJCQlyZXR1cm4gbG9jYWxTdG9yYWdlLmdldChMU19BVVRIRU5USUNBVElPTik7CgkJCQkJfQoKCQkJCQkvLyB3ZSBzaG91bGQgd29yayBvdXQgd2hldGhlciB3ZSBhcmUgY3VycmVudCBvciBub3QKCQkJCQljb25maXJtQ3VycmVudCgpOwoKCQkJCQkvLyBzZXQgYW4gaW50ZXZhbCB0byBkbyB0aGlzIHJlZ3VsYXJseQoJCQkJCSRpbnRlcnZhbChjb25maXJtQ3VycmVudCwgNjAwMDApOwoKCQkJCQlyZXR1cm4gewoJCQkJCQkvKioKCQkJCQkJKiBHZXQgYW55IGN1cnJlbnQgYXV0aGVudGljYXRpb24gaGVhZGVyCgkJCQkJCSovCgkJCQkJCWdldEF1dGg6IGdldEF1dGgsCgoJCQkJCQkvKioKCQkJCQkJKiBIYW5kbGVzIGxvZ291dAoJCQkJCQkqLwoJCQkJCQlsb2dvdXQ6IGxvZ291dCwKCgkJCQkJCS8qKgoJCQkJCQkqIFJlY29yZCBhY3Rpdml0eQoJCQkJCQkqLwoJCQkJCQlhY3Rpdml0eTogcmVjb3JkQWN0aXZpdHksCgoJCQkJCQkvKioKCQkJCQkJICogQWRkIGFuIGVuZHBvaW50CgkJCQkJCSAqCgkJCQkJCSAqIEBwYXJhbSB7U3RyaW5nfSBlbmRwb2ludCAgVGhlIFVSTCBvZiBhbiBlbmRwb2ludCwgb3IgdW5kZWZpbmVkIGlmIGN1cnJlbnQgbG9jYXRpb24KCQkJCQkJICovCgkJCQkJCWFkZEVuZHBvaW50OiBmdW5jdGlvbihlbmRwb2ludCkgewoJCQkJCQkJZW5kcG9pbnQgPSBlbmRwb2ludCB8fCB3aW5kb3cubG9jYXRpb247CgkJCQkJCQl1cmxQYXJzZXIuaHJlZiA9IGVuZHBvaW50OwoJCQkJCQkJdmFyIGhvc3RuYW1lID0gdXJsUGFyc2VyLmhvc3RuYW1lOwoJCQkJCQkJaWYgKGluRW5kcG9pbnRzKGhvc3RuYW1lKSkgewoJCQkJCQkJCXJldHVybjsKCQkJCQkJCX0KCQkJCQkJCWVuZHBvaW50cy5wdXNoKGhvc3RuYW1lKTsKCQkJCQkJfSwKCgkJCQkJCS8qKgoJCQkJCQkgKiBBZGRpdGlvbmFsIGhlYWRlcnMgdG8gYWRkIHRvIGF1dGhlbnRpY2F0ZWQKCQkJCQkJICogcmVxdWVzdHMuCgkJCQkJCSAqLwoJCQkJCQloZWFkZXJzOiB7fSwKCgkJCQkJCS8qKgoJCQkJCQkgKiBJcyBhbiBVUkwgYSBkZWZpbmVkIGVuZHBvaW50IHJlcXVpcmluZyBhdXRoZW50aWNhdGlvbgoJCQkJCQkgKgoJCQkJCQkgKiBAcGFyYW0ge1N0cmluZ30gdXJsIFRoZSBVUkwgb2YgYSBwb3RlbnRpYWwgZW5kcG9pbnQKCQkJCQkJICovCgkJCQkJCWlzRW5kcG9pbnQ6IGZ1bmN0aW9uKHVybCkgewoJCQkJCQkJdXJsUGFyc2VyLmhyZWYgPSB1cmw7CgkJCQkJCQl2YXIgaG9zdG5hbWUgPSB1cmxQYXJzZXIuaG9zdG5hbWU7CgkJCQkJCQlyZXR1cm4gaW5FbmRwb2ludHMoaG9zdG5hbWUpOwoJCQkJCQl9LAoKCQkJCQkJLyoqCgkJCQkJCSogVGhlIGN1cnJlbnQgdXNlcm5hbWUKCQkJCQkJKgoJCQkJCQkqIEByZXR1cm4ge1N0cmluZ30gVGhlIGN1cnJlbnQgdXNlcm5hbWUKCQkJCQkJKi8KCQkJCQkJdXNlcm5hbWU6IGZ1bmN0aW9uKCkgewoJCQkJCQkJY29uZmlybUN1cnJlbnQoKTsKCQkJCQkJCXJldHVybiBsb2NhbFN0b3JhZ2UuZ2V0KExTX1VTRVJOQU1FKTsKCQkJCQkJfSwKCgkJCQkJCS8qKgoJCQkJCQkqIEhhbmRsZSBhbiBhdXRoZW50aWNhdGlvbiBmYWlsdXJlCgkJCQkJCSovCgkJCQkJCWhhbmRsZUF1dGhGYWlsdXJlOiBmdW5jdGlvbigpIHsKCQkJCQkJCWxvZ291dCgpOwoJCQkJCQkJJHJvb3RTY29wZS4kZW1pdCgnYXV0aGVudGljYXRpb24tZmFpbHVyZScpOwoJCQkJCQl9LAoKCQkJCQkJLyoqCgkJCQkJCSogSGFuZGxlcyBsb2dpbiB0byB0aGUgYXBwbGljYXRpb24KCQkJCQkJKgoJCQkJCQkqIEBwYXJhbSAge1N0cmluZ30gdXNlcm5hbWUgVGhlIHVzZXJuYW1lCgkJCQkJCSogQHBhcmFtICB7U3RyaW5nfSBwYXNzd29yZCBUaGUgcGFzc3dvcmQKCQkJCQkJKiBAcmV0dXJuIHtPYmplY3R9ICAgICAgICAgIFByb21pc2UgZm9yIHRoZSB0cmFuc2FjdGlvbgoJCQkJCQkqLwoJCQkJCQlsb2dpbjogZnVuY3Rpb24odXNlcm5hbWUsIHBhc3N3b3JkLCBoZWFkZXJzKSB7CgkJCQkJCQkkbG9nLmRlYnVnKCdsb2dpbiBldmVudCcpOwoKCQkJCQkJCS8vIHJlY29yZCB0aGUgY3JlZGVudGlhbHMKCQkJCQkJCXNldENyZWRlbnRpYWxzKHVzZXJuYW1lLCBwYXNzd29yZCk7CgoJCQkJCQkJdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTsKCgkJCQkJCQkvKioKCQkJCQkJCSogUHJvY2VzcyB0aGUgcmVzcG9uc2UsIGFuZCBpZiB0aGVyZSBhcmUgYW55IGlzc3VlcwoJCQkJCQkJKiB0aGUgcmVqZWN0IHRoZSBwcm9taXNlCgkJCQkJCQkqLwoJCQkJCQkJZnVuY3Rpb24gcHJvY2Vzc1Jlc3BvbnNlKCkgewoJCQkJCQkJCS8qIGpzaGludCB2YWxpZHRoaXM6IHRydWUgKi8KCQkJCQkJCQlpZiAodGhpcy5zdGF0dXMgIT09IDIwMCkgewoJCQkJCQkJCQlkZWZlcnJlZC5yZWplY3QoKTsKCQkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCQlkZWZlcnJlZC5yZXNvbHZlKCk7CgkJCQkJCQkJfQoJCQkJCQkJfQoKCQkJCQkJCS8vIGRvbid0IHVzZSAkaHR0cCB0byBhdm9pZCBjaXJjdWxhciByZWZlcmVuY2UsIHNvCgkJCQkJCQkvLyBkaXJlY3RseSB1c2UgWE1MSHR0cFJlcXVlc3QgYW5kICRxCgkJCQkJCQl2YXIgcHJvbWlzZSA9IGRlZmVycmVkLnByb21pc2U7CgkJCQkJCQl2YXIgcmVxdWVzdCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOwoJCQkJCQkJcmVxdWVzdC5vbmxvYWQgPSBwcm9jZXNzUmVzcG9uc2U7CgkJCQkJCQlyZXF1ZXN0Lm9wZW4oJ0dFVCcsIGF1dGhEZWZhdWx0cy5hdXRoZW50aWNhdGVVcmwpOwoJCQkJCQkJcmVxdWVzdC5zZXRSZXF1ZXN0SGVhZGVyKCdBY2NlcHQnLCAnYXBwbGljYXRpb24vanNvbicpOwoJCQkJCQkJcmVxdWVzdC5zZXRSZXF1ZXN0SGVhZGVyKCdBdXRob3JpemF0aW9uJywgZ2V0QXV0aCgpKTsKCQkJCQkJCWZvciAodmFyIGtleSBpbiB0aGlzLmhlYWRlcnMpIHsKCQkJCQkJCSAgaWYgKHRoaXMuaGVhZGVycy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7CgkJCQkJCQkJCXJlcXVlc3Quc2V0UmVxdWVzdEhlYWRlcihrZXksIHRoaXMuaGVhZGVyc1trZXldKTsKCQkJCQkJCSAgfQoJCQkJCQkJfQoJCQkJCQkJcmVxdWVzdC5zZW5kKG51bGwpOwoKCQkJCQkJCS8qKgoJCQkJCQkJKiBBbGxvdyBzdWJzY3JpYmVycyB0byB0aGUgcHJvbWlzZSB0byBhZGQgYQoJCQkJCQkJKiBzdWNjZXNzIGZ1bmN0aW9uIHRvIHRoZSBsb2dpbiBldmVudAoJCQkJCQkJKi8KCQkJCQkJCXByb21pc2Uuc3VjY2VzcyA9IGZ1bmN0aW9uKGZuKSB7CgkJCQkJCQkJcHJvbWlzZS50aGVuKGZ1bmN0aW9uKCkgewoJCQkJCQkJCQlmbigpOwoJCQkJCQkJCX0pOwoJCQkJCQkJCXJldHVybiBwcm9taXNlOwoJCQkJCQkJfTsKCgkJCQkJCQkvKioKCQkJCQkJCSogQWxsb3cgc3Vic2NyaWJlcnMgdG8gdGhlIHByb21pc2UgdG8gYWRkCgkJCQkJCQkqIGFuIGVycm9yIGZ1bmN0aW9uIHRvIHRoZSBsb2dpbiBldmVudAoJCQkJCQkJKi8KCQkJCQkJCXByb21pc2UuZXJyb3IgPSBmdW5jdGlvbihmbikgewoJCQkJCQkJCXByb21pc2UudGhlbihudWxsLCBmdW5jdGlvbigpIHsKCQkJCQkJCQkJZm4oKTsKCQkJCQkJCQl9KTsKCQkJCQkJCQlyZXR1cm4gcHJvbWlzZTsKCQkJCQkJCX07CgoJCQkJCQkJLyoqCgkJCQkJCQkqIEhhbmRsZSB0aGUgcHJvbWlzZSBiZWluZyByZWplY3RlZCBvciByZXNvbHZlZAoJCQkJCQkJKi8KCQkJCQkJCXByb21pc2UudGhlbihmdW5jdGlvbiAoKSB7CgkJCQkJCQkJLy8gd2UndmUgY29uZmlybWVkIGNyZWRlbnRpYWxzIG1hdGNoIGEgdXNlcgoJCQkJCQkJCSRsb2cuZGVidWcoJ1N1Y2Nlc3NmdWxseSBhdXRoZW50aWNhdGVkJyk7CgkJCQkJCQkJJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdsb2dpbicsIHVzZXJuYW1lKTsKCQkJCQkJCX0sIGZ1bmN0aW9uICgpIHsKCQkJCQkJCQkvLyBzb21lIGVycm9yIGluIGNyZWRlbnRpYWwgY2hlY2sKCQkJCQkJCQkkbG9nLmRlYnVnKCdUZXN0IGF1dGhlbnRpY2F0aW9uIGZhaWxlZCcpOwoJCQkJCQkJCWxvZ291dCgpOwoJCQkJCQkJCSRyb290U2NvcGUuJGJyb2FkY2FzdCgnYXV0aGVudGljYXRpb24tZmFpbGVkJywgdXNlcm5hbWUpOwoJCQkJCQkJfSk7CgoJCQkJCQkJcmV0dXJuIHByb21pc2U7CgkJCQkJCX0KCQkJCQl9OwoJCQkJfQoJCQldCgkJKTsKCX0pKCk7CgoJLy8gYWRkIHRoZSBpbnRlcmNlcHRvciB0byB0aGUgaHR0cCBzZXJ2aWNlCglhbmd1bGFyQmFzaWNBdXRoLmNvbmZpZyhbJyRodHRwUHJvdmlkZXInLCBmdW5jdGlvbigkaHR0cFByb3ZpZGVyKSB7CgkJJGh0dHBQcm92aWRlci5pbnRlcmNlcHRvcnMucHVzaCgnYXV0aEludGVyY2VwdG9yJyk7Cgl9XSk7Cgp9KSgpOwo=",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Thu, 06 Nov 2014 07:10:36 GMT",
                    "Content-Length": "8951",
                    "Date": "Thu, 06 Nov 2014 07:10:37 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}