{
    "url": "http://localhost:9999/rpflorence/snack/builds/snack.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Open redirection (DOM-based)",
    "issueType": 5243152,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based open redirection vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the target of a redirection in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause a redirection to an arbitrary external domain. This behavior can be leveraged to facilitate phishing attacks against users of the application. The ability to use an authentic application URL, targeting the correct domain with a valid SSL certificate (if SSL is used) lends credibility to the phishing attack because many users, even if they verify these features, will not notice the subsequent redirection to a different domain.<br><br><b>Note:</b> If an attacker is able to control the start of the string that is passed to the redirection API, then it may be possible to escalate this vulnerability into a JavaScript injection attack, by using a URL with the javascript: pseudo-protocol to execute arbitrary script code when the URL is processed by the browser.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based open redirection vulnerabilities is not to dynamically set redirection targets using data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing an arbitrary URL as a redirection target. In general, this is best achieved by using a whitelist of URLs that are permitted redirection targets, and strictly validating the target against this list before performing the redirection.",
    "issueDetail": "The application may be vulnerable to DOM-based open redirection. Data is read from <b>document.location.pathname</b> and written to <b>the 'open()' function of an XMLHttpRequest object</b> via the following statements:<ul><li>url = document.location.pathname</li><li>url = url.substr(0, trimPosition)</li><li>xhr.open(method.toUpperCase(), url, open.async, options.user, options.password)</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/rpflorence/snack/builds/snack.js",
                "path": "/rpflorence/snack/builds/snack.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9ycGZsb3JlbmNlL3NuYWNrL2J1aWxkcy9zbmFjay5qcyBIVFRQLzEuMQ0KSG9zdDogbG9jYWxob3N0Ojk5OTkNCg0K",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMTYzNTcNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IFNhdCwgMDggTm92IDIwMTQgMDQ6NTY6MzkgR01UDQpMYXN0LU1vZGlmaWVkOiBTYXQsIDA4IE5vdiAyMDE0IDA0OjU2OjM5IEdNVA0KDQovKiEKICAqIHNuYWNrLmpzIChjKSBSeWFuIEZsb3JlbmNlCiAgKiBodHRwczovL2dpdGh1Yi5jb20vcnBmbG9yZW5jZS9zbmFjawogICogTUlUIExpY2Vuc2UKICAqIEluc3BpcmF0aW9uIGFuZCBjb2RlIGFkYXB0ZWQgZnJvbQogICogIE1vb1Rvb2xzICAgICAgKGMpIFZhbGVyaW8gUHJvaWV0dGkgICBNSVQgbGljZW5zZQogICogIGpRdWVyeSAgICAgICAgKGMpIEpvaG4gUmVzaWcgICAgICAgICBEdWFsIGxpY2Vuc2UgTUlUIG9yIEdQTCBWZXJzaW9uIDIKICAqICBjb250ZW50TG9hZGVkIChjKSBEaWVnbyBQZXJpbmkgICAgICAgTUlUIExpY2Vuc2UKICAqICBaZXB0by5qcyAgICAgIChjKSBUaG9tYXMgRnVjaHMgICAgICAgTUlUIExpY2Vuc2UKKi8KCmlmICh0eXBlb2YgT2JqZWN0LmNyZWF0ZSAhPSAnZnVuY3Rpb24nKXsKICAvLyBFUzUgT2JlamVjdC5jcmVhdGUKICBPYmplY3QuY3JlYXRlID0gZnVuY3Rpb24gKG8pewogICAgZnVuY3Rpb24gRigpIHt9CiAgICBGLnByb3RvdHlwZSA9IG8KICAgIHJldHVybiBuZXcgRgogIH0KfQoKIWZ1bmN0aW9uKHdpbmRvdyl7CiAgdmFyIHNuYWNrID0gd2luZG93LnNuYWNrID0ge30KICAgICwgZ3VpZCA9IDAKICAgICwgdG9TdHJpbmcgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nCiAgICAsIGluZGV4T2YgPSBbXS5pbmRleE9mCiAgICAsIHB1c2ggPSBbXS5wdXNoCgogIHNuYWNrLmV4dGVuZCA9IGZ1bmN0aW9uICgpewogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT0gMSkKICAgICAgcmV0dXJuIHNuYWNrLmV4dGVuZChzbmFjaywgYXJndW1lbnRzWzBdKQoKICAgIHZhciB0YXJnZXQgPSBhcmd1bWVudHNbMF0KCiAgICBmb3IgKHZhciBrZXksIGkgPSAxLCBsID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IGw7IGkrKykKICAgICAgZm9yIChrZXkgaW4gYXJndW1lbnRzW2ldKQogICAgICAgIHRhcmdldFtrZXldID0gYXJndW1lbnRzW2ldW2tleV0KCiAgICByZXR1cm4gdGFyZ2V0CiAgfQoKICBzbmFjay5leHRlbmQoewogICAgdjogJzEuMi4zJywKCiAgICBiaW5kOiBmdW5jdGlvbiAoZm4sIGNvbnRleHQsIGFyZ3MpIHsKICAgICAgYXJncyA9IGFyZ3MgfHwgW107CiAgICAgIHJldHVybiBmdW5jdGlvbiAoKXsKICAgICAgICBwdXNoLmFwcGx5KGFyZ3MsIGFyZ3VtZW50cyk7CiAgICAgICAgcmV0dXJuIGZuLmFwcGx5KGNvbnRleHQsIGFyZ3MpCiAgICAgIH0KICAgIH0sCgogICAgcHVuY2g6IGZ1bmN0aW9uIChvYmosIG1ldGhvZCwgZm4sIGF1dG8pewogICAgICB2YXIgb2xkID0gb2JqW21ldGhvZF0KICAgICAgb2JqW21ldGhvZF0gPSBhdXRvID8gZnVuY3Rpb24gKCl7CiAgICAgICAgb2xkLmFwcGx5KG9iaiwgYXJndW1lbnRzKQogICAgICAgIHJldHVybiBmbi5hcHBseShvYmosIGFyZ3VtZW50cykKICAgICAgfSA6IGZ1bmN0aW9uICgpewogICAgICAgIHZhciBhcmdzID0gW10uc2xpY2UuY2FsbChhcmd1bWVudHMsIDApCiAgICAgICAgYXJncy51bnNoaWZ0KHNuYWNrLmJpbmQob2xkLCBvYmopKQogICAgICAgIHJldHVybiBmbi5hcHBseShvYmosIGFyZ3MpCiAgICAgIH0KICAgIH0sCgogICAgY3JlYXRlOiBmdW5jdGlvbiAocHJvdG8sIGV4dCl7CiAgICAgIHZhciBvYmogPSBPYmplY3QuY3JlYXRlKHByb3RvKQogICAgICBpZiAoIWV4dCkKICAgICAgICByZXR1cm4gb2JqCgogICAgICBmb3IgKHZhciBpIGluIGV4dCkgewogICAgICAgIGlmICghZXh0Lmhhc093blByb3BlcnR5KGkpKQogICAgICAgICAgY29udGludWUKCiAgICAgICAgaWYgKCFwcm90b1tpXSB8fCB0eXBlb2YgZXh0W2ldICE9ICdmdW5jdGlvbicpewogICAgICAgICAgb2JqW2ldID0gZXh0W2ldCiAgICAgICAgICBjb250aW51ZQogICAgICAgIH0KCiAgICAgICAgc25hY2sucHVuY2gob2JqLCBpLCBleHRbaV0pCiAgICAgIH0KCiAgICAgIHJldHVybiBvYmoKICAgIH0sCgogICAgaWQ6IGZ1bmN0aW9uICgpewogICAgICByZXR1cm4gKytndWlkCiAgICB9LAoKICAgIGVhY2g6IGZ1bmN0aW9uIChvYmosIGZuLCBjb250ZXh0KXsKICAgICAgaWYgKG9iai5sZW5ndGggPT09IHZvaWQrMCl7IC8vIGxvb3NlIGNoZWNrIGZvciBvYmplY3QsIHdlIHdhbnQgYXJyYXktbGlrZSBvYmplY3RzIHRvIGJlIHRyZWF0ZWQgYXMgYXJyYXlzCiAgICAgICAgZm9yICh2YXIga2V5IGluIG9iaikKICAgICAgICAgIGlmIChvYmouaGFzT3duUHJvcGVydHkoa2V5KSkKICAgICAgICAgICAgZm4uY2FsbChjb250ZXh0LCBvYmpba2V5XSwga2V5LCBvYmopOwogICAgICAgIHJldHVybiBvYmoKICAgICAgfQoKICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSBvYmoubGVuZ3RoOyBpIDwgbDsgaSsrKQogICAgICAgIGZuLmNhbGwoY29udGV4dCwgb2JqW2ldLCBpLCBvYmopCiAgICAgIHJldHVybiBvYmoKICAgIH0sCgogICAgcGFyc2VKU09OOiBmdW5jdGlvbihqc29uKSB7CiAgICAgIC8vIGFkYXB0ZWQgZnJvbSBqUXVlcnkKICAgICAgaWYgKHR5cGVvZiBqc29uICE9ICdzdHJpbmcnKQogICAgICAgIHJldHVybgoKICAgICAganNvbiA9IGpzb24ucmVwbGFjZSgvXlxzK3xccyskL2csICcnKQoKICAgICAgdmFyIGlzVmFsaWQgPSAvXltcXSw6e31cc10qJC8udGVzdChqc29uLnJlcGxhY2UoL1xcKD86WyJcXFwvYmZucnRdfHVbMC05YS1mQS1GXXs0fSkvZywgIkAiKQogICAgICAgIC5yZXBsYWNlKC8iW14iXFxcblxyXSoifHRydWV8ZmFsc2V8bnVsbHwtP1xkKyg/OlwuXGQqKT8oPzpbZUVdWytcLV0/XGQrKT8vZywgIl0iKQogICAgICAgIC5yZXBsYWNlKC8oPzpefDp8LCkoPzpccypcWykrL2csICIiKSkKCiAgICAgIGlmICghaXNWYWxpZCkKICAgICAgICB0aHJvdyAiSW52YWxpZCBKU09OIgogICAgICAKICAgICAgdmFyIEpTT04gPSB3aW5kb3cuSlNPTiAvLyBzYXZlcyBhIGNvdXBsZSBieXRlcwogICAgICByZXR1cm4gSlNPTiAmJiBKU09OLnBhcnNlID8gSlNPTi5wYXJzZShqc29uKSA6IChuZXcgRnVuY3Rpb24oInJldHVybiAiICsganNvbikpKCkKICAgIH0sCgogICAgaXNBcnJheTogZnVuY3Rpb24gKG9iail7CiAgICAgIHJldHVybiBvYmogaW5zdGFuY2VvZiBBcnJheSB8fCB0b1N0cmluZy5jYWxsKG9iaikgPT0gIltvYmplY3QgQXJyYXldIgogICAgfSwKCiAgICBpbmRleE9mOiBpbmRleE9mID8gZnVuY3Rpb24oaXRlbSwgYXJyYXkpewogICAgICAgIHJldHVybiBpbmRleE9mLmNhbGwoYXJyYXksIGl0ZW0pCiAgICAgIH0gOiBmdW5jdGlvbiAoaXRlbSwgYXJyYXkpewogICAgICBmb3IgKHZhciBpID0gMCwgbCA9IGFycmF5Lmxlbmd0aDsgaSA8IGw7IGkrKykKICAgICAgICBpZiAoYXJyYXlbaV0gPT09IGl0ZW0pCiAgICAgICAgICByZXR1cm4gaQoKICAgICAgcmV0dXJuIC0xCiAgICB9CiAgfSkKfSh3aW5kb3cpOwohZnVuY3Rpb24gKHNuYWNrLCBkb2N1bWVudCl7CiAgdmFyIHByb3RvID0ge30KICAgICwgcXVlcnkKCiAgc25hY2sud3JhcCA9IGZ1bmN0aW9uIChub2RlcywgY29udGV4dCl7CiAgICAvLyBwYXNzZWQgaW4gYSBDU1Mgc2VsZWN0b3IKICAgIGlmICh0eXBlb2Ygbm9kZXMgPT0gJ3N0cmluZycpCiAgICAgIG5vZGVzID0gcXVlcnkobm9kZXMsIGNvbnRleHQpCgogICAgLy8gcGFzc2VkIGluIHNpbmdsZSBub2RlCiAgICBpZiAoIW5vZGVzLmxlbmd0aCkKICAgICAgbm9kZXMgPSBbbm9kZXNdCgogICAgdmFyIHdyYXBwZXIgPSBPYmplY3QuY3JlYXRlKHByb3RvKQogICAgICAsIGkgPSAwCiAgICAgICwgbCA9IG5vZGVzLmxlbmd0aAoKICAgIGZvciAoOyBpIDwgbDsgaSsrKQogICAgICB3cmFwcGVyW2ldID0gbm9kZXNbaV0KCiAgICB3cmFwcGVyLmxlbmd0aCA9IGwKICAgIHdyYXBwZXIuaWQgPSBzbmFjay5pZCgpCiAgICByZXR1cm4gd3JhcHBlcgogIH0KCiAgc25hY2suZXh0ZW5kKHNuYWNrLndyYXAsIHsKICAgIGRlZmluZTogZnVuY3Rpb24obmFtZSwgZm4pewogICAgICBpZiAodHlwZW9mIG5hbWUgIT0gJ3N0cmluZycpewogICAgICAgIGZvciAodmFyIGkgaW4gbmFtZSkKICAgICAgICAgIHNuYWNrLndyYXAuZGVmaW5lKGksIG5hbWVbaV0pCiAgICAgICAgcmV0dXJuCiAgICAgIH0KICAgICAgcHJvdG9bbmFtZV0gPSBmbgogICAgfSwKCiAgICBkZWZpbmVFbmdpbmU6IGZ1bmN0aW9uIChmbil7CiAgICAgIHF1ZXJ5ID0gZm4KICAgIH0KICB9KQoKICAvLyBRU0EgZGVmYXVsdCBzZWxlY3RvciBlbmdpbmUsIHN1cHBvcnRzIHJlYWwgYnJvd3NlcnMgYW5kIElFOCsKICBzbmFjay53cmFwLmRlZmluZUVuZ2luZShmdW5jdGlvbiAoc2VsZWN0b3IsIGNvbnRleHQpewogICAgaWYgKHR5cGVvZiBjb250ZXh0ID09ICdzdHJpbmcnKQogICAgICBjb250ZXh0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihjb250ZXh0KQoKICAgIHJldHVybiAoY29udGV4dCB8fCBkb2N1bWVudCkucXVlcnlTZWxlY3RvckFsbChzZWxlY3RvcikKICB9KQp9KHNuYWNrLCBkb2N1bWVudCkKIWZ1bmN0aW9uIChzbmFjaywgd2luZG93LCBkb2N1bWVudCl7CiAgdmFyIGFkZCAgICAgICAgICAgID0gZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lciA/ICdhZGRFdmVudExpc3RlbmVyJyA6ICdhdHRhY2hFdmVudCcKICAgICwgcmVtb3ZlICAgICAgICAgPSBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyID8gJ3JlbW92ZUV2ZW50TGlzdGVuZXInIDogJ2RldGFjaEV2ZW50JwogICAgLCBwcmVmaXggICAgICAgICA9IGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIgPyAnJyA6ICdvbicKICAgICwgcmVhZHkgICAgICAgICAgPSBmYWxzZQogICAgLCB0b3AgICAgICAgICAgICA9IHRydWUKICAgICwgcm9vdCAgICAgICAgICAgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQKICAgICwgcmVhZHlIYW5kbGVycyAgPSBbXQoKICBzbmFjay5leHRlbmQoewogICAgc3RvcFByb3BhZ2F0aW9uOiBmdW5jdGlvbiAoZXZlbnQpewogICAgICBpZiAoZXZlbnQuc3RvcFByb3BhZ2F0aW9uKQogICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpCiAgICAgIGVsc2UKICAgICAgICBldmVudC5jYW5jZWxCdWJibGUgPSB0cnVlCiAgICB9LAoKICAgIHByZXZlbnREZWZhdWx0OiBmdW5jdGlvbiAoZXZlbnQpewogICAgICBpZiAoZXZlbnQucHJldmVudERlZmF1bHQpCiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKQogICAgICBlbHNlCiAgICAgICAgZXZlbnQucmV0dXJuVmFsdWUgPSBmYWxzZQogICAgfQogIH0pCgogIHNuYWNrLmxpc3RlbmVyID0gZnVuY3Rpb24gKHBhcmFtcywgaGFuZGxlcil7CiAgICBpZiAocGFyYW1zLmRlbGVnYXRlKXsKICAgICAgcGFyYW1zLmNhcHR1cmUgPSB0cnVlCiAgICAgIF9oYW5kbGVyID0gaGFuZGxlcgogICAgICBoYW5kbGVyID0gZnVuY3Rpb24gKGV2ZW50KXsKICAgICAgICAvLyBhZGFwdGVkIGZyb20gWmVwdG8KICAgICAgICB2YXIgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0IHx8IGV2ZW50LnNyY0VsZW1lbnQKICAgICAgICAgICwgbm9kZXMgPSB0eXBlb2YgcGFyYW1zLmRlbGVnYXRlID09ICdzdHJpbmcnCiAgICAgICAgICAgID8gc25hY2sud3JhcChwYXJhbXMuZGVsZWdhdGUsIHBhcmFtcy5ub2RlKQogICAgICAgICAgICA6IHBhcmFtcy5kZWxlZ2F0ZShwYXJhbXMubm9kZSkKCiAgICAgICAgd2hpbGUgKHRhcmdldCAmJiBzbmFjay5pbmRleE9mKHRhcmdldCwgbm9kZXMpID09IC0xICkKICAgICAgICAgIHRhcmdldCA9IHRhcmdldC5wYXJlbnROb2RlCgogICAgICAgIGlmICh0YXJnZXQgJiYgISh0YXJnZXQgPT09IHRoaXMpICYmICEodGFyZ2V0ID09PSBkb2N1bWVudCkpCiAgICAgICAgICBfaGFuZGxlci5jYWxsKHRhcmdldCwgZXZlbnQsIHRhcmdldCkKICAgICAgfQogICAgfQoKICAgIGlmIChwYXJhbXMuY29udGV4dCkKICAgICAgaGFuZGxlciA9IHNuYWNrLmJpbmQoaGFuZGxlciwgcGFyYW1zLmNvbnRleHQpCgogICAgdmFyIG1ldGhvZHMgPSB7CiAgICAgIGF0dGFjaDogZnVuY3Rpb24gKCl7CiAgICAgICAgcGFyYW1zLm5vZGVbYWRkXSgKICAgICAgICAgIHByZWZpeCArIHBhcmFtcy5ldmVudCwKICAgICAgICAgIGhhbmRsZXIsCiAgICAgICAgICBwYXJhbXMuY2FwdHVyZQogICAgICAgICkKICAgICAgfSwKCiAgICAgIGRldGFjaDogZnVuY3Rpb24gKCl7CiAgICAgICAgcGFyYW1zLm5vZGVbcmVtb3ZlXSgKICAgICAgICAgIHByZWZpeCArIHBhcmFtcy5ldmVudCwKICAgICAgICAgIGhhbmRsZXIsCiAgICAgICAgICBwYXJhbXMuY2FwdHVyZQogICAgICAgICkKICAgICAgfSwKCiAgICAgIGZpcmU6IGZ1bmN0aW9uICgpewogICAgICAgIGhhbmRsZXIuYXBwbHkocGFyYW1zLm5vZGUsIGFyZ3VtZW50cykKICAgICAgfQogICAgfQoKICAgIG1ldGhvZHMuYXR0YWNoKCkKCiAgICByZXR1cm4gbWV0aG9kcwogIH0KCgoKCiAgc25hY2sucmVhZHkgPSBmdW5jdGlvbiAoaGFuZGxlcil7CiAgICBpZiAocmVhZHkpewogICAgICBoYW5kbGVyLmFwcGx5KGRvY3VtZW50KQogICAgICByZXR1cm4KICAgIH0KICAgIHJlYWR5SGFuZGxlcnMucHVzaChoYW5kbGVyKQogIH0KCiAgLy8gYWRhcHRlZCBmcm9tIGNvbnRlbnRsb2FkZWQKICBmdW5jdGlvbiBpbml0KGUpIHsKICAgIGlmIChlLnR5cGUgPT0gJ3JlYWR5c3RhdGVjaGFuZ2UnICYmIGRvY3VtZW50LnJlYWR5U3RhdGUgIT0gJ2NvbXBsZXRlJykKICAgICAgcmV0dXJuCgogICAgKGUudHlwZSA9PSAnbG9hZCcgPyB3aW5kb3cgOiBkb2N1bWVudClbcmVtb3ZlXShwcmVmaXggKyBlLnR5cGUsIGluaXQsIGZhbHNlKQoKICAgIGlmICghcmVhZHkgJiYgKHJlYWR5ID0gdHJ1ZSkpCiAgICAgIHNuYWNrLmVhY2gocmVhZHlIYW5kbGVycywgZnVuY3Rpb24gKGhhbmRsZXIpewogICAgICAgIGhhbmRsZXIuYXBwbHkoZG9jdW1lbnQpCiAgICAgIH0pCiAgfQoKICBmdW5jdGlvbiBwb2xsKCkgewogICAgdHJ5IHsKICAgICAgcm9vdC5kb1Njcm9sbCgnbGVmdCcpCiAgICB9IGNhdGNoKGUpIHsgCiAgICAgIHNldFRpbWVvdXQocG9sbCwgNTApCiAgICAgIHJldHVybgogICAgfQogICAgaW5pdCgncG9sbCcpCiAgfQoKICBpZiAoZG9jdW1lbnQuY3JlYXRlRXZlbnRPYmplY3QgJiYgcm9vdC5kb1Njcm9sbCkgewogICAgdHJ5IHsKICAgICAgdG9wID0gIXdpbmRvdy5mcmFtZUVsZW1lbnQKICAgIH0gY2F0Y2goZSkge30KICAgIGlmICh0b3ApCiAgICAgIHBvbGwoKTsKICB9CgogIGRvY3VtZW50W2FkZF0ocHJlZml4ICsgJ0RPTUNvbnRlbnRMb2FkZWQnLCBpbml0LCBmYWxzZSkKICBkb2N1bWVudFthZGRdKHByZWZpeCArICdyZWFkeXN0YXRlY2hhbmdlJywgaW5pdCwgZmFsc2UpCiAgd2luZG93W2FkZF0ocHJlZml4ICsgJ2xvYWQnLCBpbml0LCBmYWxzZSkKfShzbmFjaywgd2luZG93LCBkb2N1bWVudCk7CiFmdW5jdGlvbiAoc25hY2spewogIHNuYWNrLnB1Ymxpc2hlciA9IGZ1bmN0aW9uIChvYmopewogICAgdmFyIGNoYW5uZWxzID0ge30KICAgIG9iaiA9IG9iaiB8fCB7fQoKICAgIHNuYWNrLmV4dGVuZChvYmosIHsKICAgICAgc3Vic2NyaWJlOiBmdW5jdGlvbiAoY2hhbm5lbCwgaGFuZGxlciwgY29udGV4dCl7CiAgICAgICAgdmFyIHN1YnNjcmlwdGlvbiA9IHsKICAgICAgICAgIGZuOiBoYW5kbGVyLAogICAgICAgICAgY3R4dDogKGNvbnRleHQgfHwge30pCiAgICAgICAgfQoKICAgICAgICBpZiAoIWNoYW5uZWxzW2NoYW5uZWxdKQogICAgICAgICAgY2hhbm5lbHNbY2hhbm5lbF0gPSBbXQoKICAgICAgICB2YXIgcHVibGlrID0gewogICAgICAgICAgYXR0YWNoOiBmdW5jdGlvbiAoKXsKICAgICAgICAgICAgY2hhbm5lbHNbY2hhbm5lbF0ucHVzaChzdWJzY3JpcHRpb24pCiAgICAgICAgICB9LAogICAgICAgICAgZGV0YWNoOiBmdW5jdGlvbiAoKXsKICAgICAgICAgICAgY2hhbm5lbHNbY2hhbm5lbF0uc3BsaWNlKHNuYWNrLmluZGV4T2YoaGFuZGxlciwgY2hhbm5lbHNbY2hhbm5lbF0pLCAxKQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBwdWJsaWsuYXR0YWNoKCkKICAgICAgICByZXR1cm4gcHVibGlrCiAgICAgIH0sCgogICAgICBwdWJsaXNoOiBmdW5jdGlvbiAoY2hhbm5lbCwgYXJnc0FycmF5KXsKICAgICAgICBpZiAoIWNoYW5uZWxzW2NoYW5uZWxdKQogICAgICAgICAgcmV0dXJuIGZhbHNlCgogICAgICAgIHNuYWNrLmVhY2goY2hhbm5lbHNbY2hhbm5lbF0sIGZ1bmN0aW9uIChzdWJzY3JpcHRpb24pewogICAgICAgICAgc3Vic2NyaXB0aW9uLmZuLmFwcGx5KHN1YnNjcmlwdGlvbi5jdHh0LCBhcmdzQXJyYXkgfHwgW10pCiAgICAgICAgfSkKCiAgICAgICAgcmV0dXJuIGNoYW5uZWxzW2NoYW5uZWxdLmxlbmd0aAogICAgICB9CiAgICB9KQoKICAgIHJldHVybiBvYmoKICB9CgogIHNuYWNrLnB1Ymxpc2hlcihzbmFjaykKfShzbmFjayk7CiFmdW5jdGlvbihzbmFjaywgd2luZG93LCBkb2N1bWVudCl7CiAgc25hY2suSlNPTlAgPSBmdW5jdGlvbihwYXJhbXMsIGNhbGxiYWNrKXsKICAgIC8vIGFkYXB0ZWQgZnJvbSBaZXB0bwogICAgdmFyIGpzb25wU3RyaW5nID0gJ2pzb25wJyArIHNuYWNrLmlkKCkKICAgICAgLCBzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKQogICAgICAsIHJ1bm5pbmcgPSBmYWxzZQoKICAgICAgc25hY2suSlNPTlBbanNvbnBTdHJpbmddID0gZnVuY3Rpb24oZGF0YSl7CiAgICAgICAgcnVubmluZyA9IGZhbHNlCiAgICAgICAgZGVsZXRlIHNuYWNrLkpTT05QW2pzb25wU3RyaW5nXQogICAgICAgIGNhbGxiYWNrKGRhdGEpCiAgICAgIH0KCiAgICAgIGlmICh0eXBlb2YgcGFyYW1zLmRhdGEgPT0gJ29iamVjdCcpCiAgICAgICAgcGFyYW1zLmRhdGEgPSBzbmFjay50b1F1ZXJ5U3RyaW5nKHBhcmFtcy5kYXRhKQoKICAgIHZhciBwdWJsaWsgPSB7CiAgICAgIHNlbmQ6IGZ1bmN0aW9uICgpewogICAgICAgIHJ1bm5pbmcgPSB0cnVlCiAgICAgICAgc2NyaXB0LnNyYyA9IHBhcmFtcy51cmwgKyAnPycgKyBwYXJhbXMua2V5ICsgJz1zbmFjay5KU09OUC4nICsganNvbnBTdHJpbmcgKyAnJicgKyBwYXJhbXMuZGF0YQogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdoZWFkJylbMF0uYXBwZW5kQ2hpbGQoc2NyaXB0KQogICAgICB9LAoKICAgICAgY2FuY2VsOiBmdW5jdGlvbiAoKXsKICAgICAgICBydW5uaW5nICYmIHNjcmlwdC5wYXJlbnROb2RlICYmIHNjcmlwdC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHNjcmlwdCkKICAgICAgICBydW5uaW5nID0gZmFsc2UKICAgICAgICBzbmFjay5KU09OUFtqc29ucFN0cmluZ10gPSBmdW5jdGlvbiAoKXsKICAgICAgICAgIGRlbGV0ZSBzbmFjay5KU09OUFtqc29ucFN0cmluZ10KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBpZiAocGFyYW1zLm5vdyAhPT0gZmFsc2UpCiAgICAgIHB1Ymxpay5zZW5kKCkKCiAgICByZXR1cm4gcHVibGlrCiAgfQoKICBzbmFjay50b1F1ZXJ5U3RyaW5nID0gZnVuY3Rpb24ob2JqZWN0LCBiYXNlKXsKICAgIC8vIGFkYXB0ZWQgZnJvbSBNb29Ub29scwogICAgdmFyIHF1ZXJ5U3RyaW5nID0gW10KCiAgICBzbmFjay5lYWNoKG9iamVjdCwgZnVuY3Rpb24odmFsdWUsIGtleSl7CiAgICAgIGlmIChiYXNlKQogICAgICAgIGtleSA9IGJhc2UgKyAnWycgKyBrZXkgKyAnXScKCiAgICAgIHZhciByZXN1bHQKCiAgICAgIGlmIChzbmFjay5pc0FycmF5KHZhbHVlKSl7CiAgICAgICAgdmFyIHFzID0ge30KICAgICAgICBzbmFjay5lYWNoKHZhbHVlLCBmdW5jdGlvbih2YWwsIGkpewogICAgICAgICAgcXNbaV0gPSB2YWwKICAgICAgICB9KQogICAgICAgIHJlc3VsdCA9IHNuYWNrLnRvUXVlcnlTdHJpbmcocXMsIGtleSkKICAgICAgfQogICAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT0gJ29iamVjdCcpCiAgICAgICAgcmVzdWx0ID0gc25hY2sudG9RdWVyeVN0cmluZyh2YWx1ZSwga2V5KQogICAgICBlbHNlCiAgICAgICAgcmVzdWx0ID0ga2V5ICsgJz0nICsgZW5jb2RlVVJJQ29tcG9uZW50KHZhbHVlKQoKICAgICAgaWYgKHZhbHVlICE9PSBudWxsKQogICAgICAgIHF1ZXJ5U3RyaW5nLnB1c2gocmVzdWx0KQogICAgfSkKCiAgICByZXR1cm4gcXVlcnlTdHJpbmcuam9pbignJicpCiAgfQoKICB2YXIgeGhyT2JqZWN0ID0gKGZ1bmN0aW9uKCl7CiAgICAvLyBhZGFwdGVkIGZyb20gTW9vVG9vbHMKICAgIHZhciBYTUxIVFRQID0gZnVuY3Rpb24oKXsKICAgICAgcmV0dXJuIG5ldyBYTUxIdHRwUmVxdWVzdCgpOwogICAgfQoKICAgIHZhciBNU1hNTDIgPSBmdW5jdGlvbigpewogICAgICByZXR1cm4gbmV3IEFjdGl2ZVhPYmplY3QoJ01TWE1MMi5YTUxIVFRQJyk7CiAgICB9CgogICAgdmFyIE1TWE1MID0gZnVuY3Rpb24oKXsKICAgICAgcmV0dXJuIG5ldyBBY3RpdmVYT2JqZWN0KCdNaWNyb3NvZnQuWE1MSFRUUCcpOwogICAgfQoKICAgIHRyeSB7CiAgICAgIFhNTEhUVFAoKQogICAgICByZXR1cm4gWE1MSFRUUAogICAgfSBjYXRjaCAoZSl7CiAgICAgIHRyeSB7CiAgICAgICAgTVNYTUwyKCkKICAgICAgICByZXR1cm4gTVNYTUwyCiAgICAgIH0gY2F0Y2ggKGUpewogICAgICAgIE1TWE1MKCkKICAgICAgICByZXR1cm4gTVNYTUwKICAgICAgfQogICAgfQogIH0pKCk7CgogIGZ1bmN0aW9uIGVtcHR5KCl7fQoKICBzbmFjay5yZXF1ZXN0ID0gZnVuY3Rpb24gKG9wdGlvbnMsIGNhbGxiYWNrKXsKICAgIC8vIGFkYXB0ZWQgZnJvbSBNb29Ub29scwogICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIHNuYWNrLnJlcXVlc3QpKQogICAgICByZXR1cm4gbmV3IHNuYWNrLnJlcXVlc3Qob3B0aW9ucywgY2FsbGJhY2spCgogICAgdmFyIHNlbGYgPSB0aGlzCiAgICBzZWxmLm9wdGlvbnMgPSBzbmFjay5leHRlbmQoe30sIHNlbGYub3B0aW9ucywgb3B0aW9ucykKICAgIHNlbGYuY2FsbGJhY2sgPSBjYWxsYmFjawogICAgc2VsZi54aHIgPSBuZXcgeGhyT2JqZWN0CiAgICBzZWxmLmhlYWRlcnMgPSBzZWxmLm9wdGlvbnMuaGVhZGVycwogICAgaWYgKHNlbGYub3B0aW9ucy5ub3cgIT09IGZhbHNlKQogICAgICBzZWxmLnNlbmQoKQogIH0KCiAgc25hY2sucmVxdWVzdC5wcm90b3R5cGUgPSB7CgogICAgb3B0aW9uczogey8qCiAgICAgIHVzZXI6ICcnLAogICAgICBwYXNzd29yZDogJycsKi8KICAgICAgZXhjZXB0aW9uOiBlbXB0eSwKICAgICAgdXJsOiAnJywKICAgICAgZGF0YTogJycsCiAgICAgIG1ldGhvZDogJ2dldCcsCiAgICAgIG5vdzogdHJ1ZSwKICAgICAgaGVhZGVyczogewogICAgICAgICdYLVJlcXVlc3RlZC1XaXRoJzogJ1hNTEh0dHBSZXF1ZXN0JywKICAgICAgICAnQWNjZXB0JzogJ3RleHQvamF2YXNjcmlwdCwgdGV4dC9odG1sLCBhcHBsaWNhdGlvbi94bWwsIHRleHQveG1sLCAqLyonCiAgICAgIH0sCiAgICAgIGFzeW5jOiB0cnVlLAogICAgICBlbXVsYXRpb246IHRydWUsCiAgICAgIHVybEVuY29kZWQ6IHRydWUsCiAgICAgIGVuY29kaW5nOiAndXRmLTgnCiAgICB9LAoKICAgIG9uU3RhdGVDaGFuZ2U6IGZ1bmN0aW9uKCl7CiAgICAgIHZhciBzZWxmID0gdGhpcwogICAgICAgICwgeGhyID0gc2VsZi54aHIKCiAgICAgIGlmICh4aHIucmVhZHlTdGF0ZSAhPSA0IHx8ICFzZWxmLnJ1bm5pbmcpIHJldHVybgogICAgICBzZWxmLnJ1bm5pbmcgPSBmYWxzZQogICAgICBzZWxmLnN0YXR1cyA9IDAKCiAgICAgIHRyeXsKICAgICAgICB2YXIgc3RhdHVzID0geGhyLnN0YXR1cwogICAgICAgIHNlbGYuc3RhdHVzID0gKHN0YXR1cyA9PSAxMjIzKSA/IDIwNCA6IHN0YXR1cwogICAgICB9IGNhdGNoKGUpIHt9CgogICAgICB4aHIub25yZWFkeXN0YXRlY2hhbmdlID0gZW1wdHk7CgogICAgICB2YXIgYXJncyA9IHNlbGYuc3RhdHVzID49IDIwMCAmJiBzZWxmLnN0YXR1cyA8IDMwMAogICAgICAgID8gW2ZhbHNlLCBzZWxmLnhoci5yZXNwb25zZVRleHQgfHwgJycsIHNlbGYueGhyLnJlc3BvbnNlWE1MXQogICAgICAgIDogW3NlbGYuc3RhdHVzXQoKICAgICAgc2VsZi5jYWxsYmFjay5hcHBseShzZWxmLCBhcmdzKQogICAgfSwKICAKICAgIHNldEhlYWRlcjogZnVuY3Rpb24obmFtZSwgdmFsdWUpewogICAgICB0aGlzLmhlYWRlcnNbbmFtZV0gPSB2YWx1ZTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAoKICAgIGdldEhlYWRlcjogZnVuY3Rpb24obmFtZSl7CiAgICAgIHRyeSB7CiAgICAgICAgcmV0dXJuIHRoaXMueGhyLmdldFJlc3BvbnNlSGVhZGVyKG5hbWUpCiAgICAgIH0gY2F0Y2goZSkgewogICAgICAgIHJldHVybiBudWxsCiAgICAgIH0KICAgIH0sCiAgCiAgICBzZW5kOiBmdW5jdGlvbigpewogICAgICB2YXIgc2VsZiA9IHRoaXMKICAgICAgICAsIG9wdGlvbnMgPSBzZWxmLm9wdGlvbnMKCiAgICAgIGlmIChzZWxmLnJ1bm5pbmcpIHJldHVybiBzZWxmOwoKICAgICAgc2VsZi5ydW5uaW5nID0gdHJ1ZTsKCiAgICAgIHZhciBkYXRhID0gb3B0aW9ucy5kYXRhIHx8ICcnCiAgICAgICAgLCB1cmwgPSBTdHJpbmcob3B0aW9ucy51cmwpCiAgICAgICAgLCBtZXRob2QgPSBvcHRpb25zLm1ldGhvZC50b0xvd2VyQ2FzZSgpCgogICAgICBpZiAodHlwZW9mIGRhdGEgIT0gJ3N0cmluZycpCiAgICAgICAgZGF0YSA9IHNuYWNrLnRvUXVlcnlTdHJpbmcoZGF0YSkKCiAgICAgIGlmIChvcHRpb25zLmVtdWxhdGlvbiAmJiBzbmFjay5pbmRleE9mKG1ldGhvZCwgWydnZXQnLCAncG9zdCddKSA8IDApewogICAgICAgIHZhciBfbWV0aG9kID0gJ19tZXRob2Q9JyArIG1ldGhvZAogICAgICAgIGRhdGEgPSAoZGF0YSkgPyBfbWV0aG9kICsgJyYnICsgZGF0YSA6IF9tZXRob2QKICAgICAgICBtZXRob2QgPSAncG9zdCcKICAgICAgfQoKICAgICAgaWYgKG9wdGlvbnMudXJsRW5jb2RlZCAmJiBzbmFjay5pbmRleE9mKG1ldGhvZCwgWydwb3N0JywgJ3B1dCddKSA+IC0xKXsKICAgICAgICB2YXIgZW5jb2RpbmcgPSAob3B0aW9ucy5lbmNvZGluZykgPyAnOyBjaGFyc2V0PScgKyBvcHRpb25zLmVuY29kaW5nIDogJycKICAgICAgICBzZWxmLmhlYWRlcnNbJ0NvbnRlbnQtdHlwZSddID0gJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCcgKyBlbmNvZGluZwogICAgICB9CgogICAgICBpZiAoIXVybCkKICAgICAgICB1cmwgPSBkb2N1bWVudC5sb2NhdGlvbi5wYXRobmFtZQoKICAgICAgdmFyIHRyaW1Qb3NpdGlvbiA9IHVybC5sYXN0SW5kZXhPZignLycpCiAgICAgIGlmICh0cmltUG9zaXRpb24gPiAtMSAmJiAodHJpbVBvc2l0aW9uID0gdXJsLmluZGV4T2YoJyMnKSkgPiAtMSkKICAgICAgICB1cmwgPSB1cmwuc3Vic3RyKDAsIHRyaW1Qb3NpdGlvbikKCiAgICAgIGlmIChkYXRhICYmIG1ldGhvZCA9PSAnZ2V0Jyl7CiAgICAgICAgdXJsICs9ICh1cmwuaW5kZXhPZignPycpID4gLTEgPyAnJicgOiAnPycpICsgZGF0YQogICAgICAgIGRhdGEgPSBudWxsCiAgICAgIH0KCiAgICAgIHZhciB4aHIgPSBzZWxmLnhocgoKICAgICAgeGhyLm9wZW4obWV0aG9kLnRvVXBwZXJDYXNlKCksIHVybCwgb3Blbi5hc3luYywgb3B0aW9ucy51c2VyLCBvcHRpb25zLnBhc3N3b3JkKQogICAgICBpZiAob3B0aW9ucy51c2VyICYmICd3aXRoQ3JlZGVudGlhbHMnIGluIHhocikgeGhyLndpdGhDcmVkZW50aWFscyA9IHRydWUKICAgIAogICAgICB4aHIub25yZWFkeXN0YXRlY2hhbmdlID0gc25hY2suYmluZChzZWxmLm9uU3RhdGVDaGFuZ2UsIHNlbGYpCgogICAgICBmb3IgKHZhciBpIGluIHNlbGYuaGVhZGVycyl7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKGksIHNlbGYuaGVhZGVyc1tpXSkKICAgICAgICB9IGNhdGNoIChlKXsKICAgICAgICAgIG9wdGlvbnMuZXhjZXB0aW9uLmFwcGx5KHNlbGYsIFtpLCBzZWxmLmhlYWRlcnNbaV1dKQogICAgICAgIH0KICAgICAgfQoKICAgICAgeGhyLnNlbmQoZGF0YSkKICAgICAgaWYgKCFvcHRpb25zLmFzeW5jKSBzZWxmLm9uU3RhdGVDaGFuZ2UoKQogICAgCiAgICAgIHJldHVybiBzZWxmCiAgICB9LAoKICAgIGNhbmNlbDogZnVuY3Rpb24oKXsKICAgICAgdmFyIHNlbGYgPSB0aGlzCgogICAgICBpZiAoIXNlbGYucnVubmluZykKICAgICAgICByZXR1cm4gc2VsZgoKICAgICAgc2VsZi5ydW5uaW5nID0gZmFsc2UKCiAgICAgIHZhciB4aHIgPSBzZWxmLnhocgogICAgICB4aHIuYWJvcnQoKQoKICAgICAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGVtcHR5CgogICAgICBzZWxmLnhociA9IG5ldyB4aHJPYmplY3QoKQogICAgICByZXR1cm4gc2VsZgogICAgfQogIH0KfShzbmFjaywgd2luZG93LCBkb2N1bWVudCkKIWZ1bmN0aW9uKHNuYWNrLCBkb2N1bWVudCl7CiAgc25hY2sud3JhcC5kZWZpbmUoewogICAgZGF0YTogZnVuY3Rpb24gKCl7CiAgICAgIC8vIEFQSSBpbnNwaXJlZCBieSBqUXVlcnkKICAgICAgdmFyIHN0b3JhZ2UgPSB7fQoKICAgICAgcmV0dXJuIGZ1bmN0aW9uIChrZXksIHZhbHVlKXsKICAgICAgICB2YXIgZGF0YSA9IHN0b3JhZ2VbdGhpcy5pZF0KCiAgICAgICAgaWYgKCFkYXRhKQogICAgICAgICAgZGF0YSA9IHN0b3JhZ2VbdGhpcy5pZF0gPSB7fQoKICAgICAgICBpZiAodmFsdWUgPT09IHZvaWQrMSkKICAgICAgICAgIHJldHVybiBkYXRhW2tleV0KCiAgICAgICAgcmV0dXJuIGRhdGFba2V5XSA9IHZhbHVlCiAgICAgIH0gIAogICAgfSgpLAoKICAgIGVhY2g6IGZ1bmN0aW9uIChmbiwgY29udGV4dCl7CiAgICAgIHJldHVybiBzbmFjay5lYWNoKHRoaXMsIGZuLCBjb250ZXh0KQogICAgfSwKICAKICAgIGFkZENsYXNzOiBmdW5jdGlvbiAoY2xhc3NOYW1lKXsKICAgICAgLy8gYWRhcHRlZCBmcm9tIE1vb1Rvb2xzCiAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKGVsZW1lbnQpewogICAgICAgIGlmIChjbGVhbihlbGVtZW50LmNsYXNzTmFtZSkuaW5kZXhPZihjbGFzc05hbWUpID4gLTEpCiAgICAgICAgICByZXR1cm4KICAgICAgICBlbGVtZW50LmNsYXNzTmFtZSA9IGNsZWFuKGVsZW1lbnQuY2xhc3NOYW1lICsgJyAnICsgY2xhc3NOYW1lKQogICAgICB9KQogICAgfSwKCiAgICByZW1vdmVDbGFzczogZnVuY3Rpb24gKGNsYXNzTmFtZSl7CiAgICAgIC8vIGFkYXB0ZWQgZnJvbSBNb29Ub29scwogICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uIChlbGVtZW50KXsKICAgICAgICBlbGVtZW50LmNsYXNzTmFtZSA9IGVsZW1lbnQuY2xhc3NOYW1lLnJlcGxhY2UobmV3IFJlZ0V4cCgnKF58XFxzKScgKyBjbGFzc05hbWUgKyAnKD86XFxzfCQpJyksICckMScpCiAgICAgIH0pCiAgICB9LAoKICAgIGF0dGFjaDogZnVuY3Rpb24gKGV2ZW50LCBoYW5kbGVyLCAvKiBpbnRlcm5hbCAqLyBkZWxlZ2F0aW9uKXsKICAgICAgdmFyIHNwbGl0ID0gZXZlbnQuc3BsaXQoJy4nKQogICAgICAgICwgbGlzdGVuZXJzID0gW10KCiAgICAgIGlmIChzcGxpdFsxXSkKICAgICAgICBsaXN0ZW5lcnMgPSB0aGlzLmRhdGEoc3BsaXRbMV0pIHx8IFtdCgogICAgICB0aGlzLmVhY2goZnVuY3Rpb24obm9kZSl7CiAgICAgICAgdmFyIHBhcmFtcyA9IHsKICAgICAgICAgIG5vZGU6IG5vZGUsCiAgICAgICAgICBldmVudDogc3BsaXRbMF0KICAgICAgICB9CgogICAgICAgIGlmIChkZWxlZ2F0aW9uKQogICAgICAgICAgcGFyYW1zLmRlbGVnYXRlID0gZGVsZWdhdGlvbgoKICAgICAgICBsaXN0ZW5lcnMucHVzaChzbmFjay5saXN0ZW5lcihwYXJhbXMsIGhhbmRsZXIpKQogICAgICB9KQoKICAgICAgaWYgKHNwbGl0WzFdKQogICAgICAgIHRoaXMuZGF0YShzcGxpdFsxXSwgbGlzdGVuZXJzKQoKICAgICAgcmV0dXJuIHRoaXMKICAgIH0sCgogICAgZGV0YWNoOiBmdW5jdGlvbiAobmFtZXNwYWNlKXsKICAgICAgbGlzdGVuZXJNZXRob2QodGhpcywgJ2RldGFjaCcsIG5hbWVzcGFjZSwgbnVsbCwgdHJ1ZSkKICAgICAgdGhpcy5kYXRhKG5hbWVzcGFjZSwgbnVsbCkKICAgICAgcmV0dXJuIHRoaXMKICAgIH0sCgogICAgZmlyZTogZnVuY3Rpb24gKG5hbWVzcGFjZSwgYXJncyl7CiAgICAgIHJldHVybiBsaXN0ZW5lck1ldGhvZCh0aGlzLCAnZmlyZScsIG5hbWVzcGFjZSwgYXJncykKICAgIH0sCgogICAgZGVsZWdhdGU6IGZ1bmN0aW9uIChldmVudCwgZGVsZWdhdGlvbiwgaGFuZGxlcil7CiAgICAgIHJldHVybiB0aGlzLmF0dGFjaChldmVudCwgaGFuZGxlciwgZGVsZWdhdGlvbikKICAgIH0KICB9KQoKICBmdW5jdGlvbiBjbGVhbihzdHIpewogICAgcmV0dXJuIHN0ci5yZXBsYWNlKC9ccysvZywgJyAnKS5yZXBsYWNlKC9eXHMrfFxzKyQvZywgJycpCiAgfQoKICBmdW5jdGlvbiBsaXN0ZW5lck1ldGhvZCh3cmFwcGVyLCBtZXRob2QsIG5hbWVzcGFjZSwgYXJncyl7CiAgICB2YXIgZGF0YSA9IHdyYXBwZXIuZGF0YShuYW1lc3BhY2UpCgogICAgaWYgKGRhdGEpCiAgICAgIHNuYWNrLmVhY2goZGF0YSwgZnVuY3Rpb24gKGxpc3RlbmVyKXsKICAgICAgICBsaXN0ZW5lclttZXRob2RdLmFwcGx5KHdyYXBwZXIsIGFyZ3MpCiAgICAgIH0pCgogICAgcmV0dXJuIHdyYXBwZXIKICB9Cn0oc25hY2ssIGRvY3VtZW50KTsK",
                "body": "LyohCiAgKiBzbmFjay5qcyAoYykgUnlhbiBGbG9yZW5jZQogICogaHR0cHM6Ly9naXRodWIuY29tL3JwZmxvcmVuY2Uvc25hY2sKICAqIE1JVCBMaWNlbnNlCiAgKiBJbnNwaXJhdGlvbiBhbmQgY29kZSBhZGFwdGVkIGZyb20KICAqICBNb29Ub29scyAgICAgIChjKSBWYWxlcmlvIFByb2lldHRpICAgTUlUIGxpY2Vuc2UKICAqICBqUXVlcnkgICAgICAgIChjKSBKb2huIFJlc2lnICAgICAgICAgRHVhbCBsaWNlbnNlIE1JVCBvciBHUEwgVmVyc2lvbiAyCiAgKiAgY29udGVudExvYWRlZCAoYykgRGllZ28gUGVyaW5pICAgICAgIE1JVCBMaWNlbnNlCiAgKiAgWmVwdG8uanMgICAgICAoYykgVGhvbWFzIEZ1Y2hzICAgICAgIE1JVCBMaWNlbnNlCiovCgppZiAodHlwZW9mIE9iamVjdC5jcmVhdGUgIT0gJ2Z1bmN0aW9uJyl7CiAgLy8gRVM1IE9iZWplY3QuY3JlYXRlCiAgT2JqZWN0LmNyZWF0ZSA9IGZ1bmN0aW9uIChvKXsKICAgIGZ1bmN0aW9uIEYoKSB7fQogICAgRi5wcm90b3R5cGUgPSBvCiAgICByZXR1cm4gbmV3IEYKICB9Cn0KCiFmdW5jdGlvbih3aW5kb3cpewogIHZhciBzbmFjayA9IHdpbmRvdy5zbmFjayA9IHt9CiAgICAsIGd1aWQgPSAwCiAgICAsIHRvU3RyaW5nID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZwogICAgLCBpbmRleE9mID0gW10uaW5kZXhPZgogICAgLCBwdXNoID0gW10ucHVzaAoKICBzbmFjay5leHRlbmQgPSBmdW5jdGlvbiAoKXsKICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09IDEpCiAgICAgIHJldHVybiBzbmFjay5leHRlbmQoc25hY2ssIGFyZ3VtZW50c1swXSkKCiAgICB2YXIgdGFyZ2V0ID0gYXJndW1lbnRzWzBdCgogICAgZm9yICh2YXIga2V5LCBpID0gMSwgbCA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBsOyBpKyspCiAgICAgIGZvciAoa2V5IGluIGFyZ3VtZW50c1tpXSkKICAgICAgICB0YXJnZXRba2V5XSA9IGFyZ3VtZW50c1tpXVtrZXldCgogICAgcmV0dXJuIHRhcmdldAogIH0KCiAgc25hY2suZXh0ZW5kKHsKICAgIHY6ICcxLjIuMycsCgogICAgYmluZDogZnVuY3Rpb24gKGZuLCBjb250ZXh0LCBhcmdzKSB7CiAgICAgIGFyZ3MgPSBhcmdzIHx8IFtdOwogICAgICByZXR1cm4gZnVuY3Rpb24gKCl7CiAgICAgICAgcHVzaC5hcHBseShhcmdzLCBhcmd1bWVudHMpOwogICAgICAgIHJldHVybiBmbi5hcHBseShjb250ZXh0LCBhcmdzKQogICAgICB9CiAgICB9LAoKICAgIHB1bmNoOiBmdW5jdGlvbiAob2JqLCBtZXRob2QsIGZuLCBhdXRvKXsKICAgICAgdmFyIG9sZCA9IG9ialttZXRob2RdCiAgICAgIG9ialttZXRob2RdID0gYXV0byA/IGZ1bmN0aW9uICgpewogICAgICAgIG9sZC5hcHBseShvYmosIGFyZ3VtZW50cykKICAgICAgICByZXR1cm4gZm4uYXBwbHkob2JqLCBhcmd1bWVudHMpCiAgICAgIH0gOiBmdW5jdGlvbiAoKXsKICAgICAgICB2YXIgYXJncyA9IFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAwKQogICAgICAgIGFyZ3MudW5zaGlmdChzbmFjay5iaW5kKG9sZCwgb2JqKSkKICAgICAgICByZXR1cm4gZm4uYXBwbHkob2JqLCBhcmdzKQogICAgICB9CiAgICB9LAoKICAgIGNyZWF0ZTogZnVuY3Rpb24gKHByb3RvLCBleHQpewogICAgICB2YXIgb2JqID0gT2JqZWN0LmNyZWF0ZShwcm90bykKICAgICAgaWYgKCFleHQpCiAgICAgICAgcmV0dXJuIG9iagoKICAgICAgZm9yICh2YXIgaSBpbiBleHQpIHsKICAgICAgICBpZiAoIWV4dC5oYXNPd25Qcm9wZXJ0eShpKSkKICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgIGlmICghcHJvdG9baV0gfHwgdHlwZW9mIGV4dFtpXSAhPSAnZnVuY3Rpb24nKXsKICAgICAgICAgIG9ialtpXSA9IGV4dFtpXQogICAgICAgICAgY29udGludWUKICAgICAgICB9CgogICAgICAgIHNuYWNrLnB1bmNoKG9iaiwgaSwgZXh0W2ldKQogICAgICB9CgogICAgICByZXR1cm4gb2JqCiAgICB9LAoKICAgIGlkOiBmdW5jdGlvbiAoKXsKICAgICAgcmV0dXJuICsrZ3VpZAogICAgfSwKCiAgICBlYWNoOiBmdW5jdGlvbiAob2JqLCBmbiwgY29udGV4dCl7CiAgICAgIGlmIChvYmoubGVuZ3RoID09PSB2b2lkKzApeyAvLyBsb29zZSBjaGVjayBmb3Igb2JqZWN0LCB3ZSB3YW50IGFycmF5LWxpa2Ugb2JqZWN0cyB0byBiZSB0cmVhdGVkIGFzIGFycmF5cwogICAgICAgIGZvciAodmFyIGtleSBpbiBvYmopCiAgICAgICAgICBpZiAob2JqLmhhc093blByb3BlcnR5KGtleSkpCiAgICAgICAgICAgIGZuLmNhbGwoY29udGV4dCwgb2JqW2tleV0sIGtleSwgb2JqKTsKICAgICAgICByZXR1cm4gb2JqCiAgICAgIH0KCiAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gb2JqLmxlbmd0aDsgaSA8IGw7IGkrKykKICAgICAgICBmbi5jYWxsKGNvbnRleHQsIG9ialtpXSwgaSwgb2JqKQogICAgICByZXR1cm4gb2JqCiAgICB9LAoKICAgIHBhcnNlSlNPTjogZnVuY3Rpb24oanNvbikgewogICAgICAvLyBhZGFwdGVkIGZyb20galF1ZXJ5CiAgICAgIGlmICh0eXBlb2YganNvbiAhPSAnc3RyaW5nJykKICAgICAgICByZXR1cm4KCiAgICAgIGpzb24gPSBqc29uLnJlcGxhY2UoL15ccyt8XHMrJC9nLCAnJykKCiAgICAgIHZhciBpc1ZhbGlkID0gL15bXF0sOnt9XHNdKiQvLnRlc3QoanNvbi5yZXBsYWNlKC9cXCg/OlsiXFxcL2JmbnJ0XXx1WzAtOWEtZkEtRl17NH0pL2csICJAIikKICAgICAgICAucmVwbGFjZSgvIlteIlxcXG5ccl0qInx0cnVlfGZhbHNlfG51bGx8LT9cZCsoPzpcLlxkKik/KD86W2VFXVsrXC1dP1xkKyk/L2csICJdIikKICAgICAgICAucmVwbGFjZSgvKD86Xnw6fCwpKD86XHMqXFspKy9nLCAiIikpCgogICAgICBpZiAoIWlzVmFsaWQpCiAgICAgICAgdGhyb3cgIkludmFsaWQgSlNPTiIKICAgICAgCiAgICAgIHZhciBKU09OID0gd2luZG93LkpTT04gLy8gc2F2ZXMgYSBjb3VwbGUgYnl0ZXMKICAgICAgcmV0dXJuIEpTT04gJiYgSlNPTi5wYXJzZSA/IEpTT04ucGFyc2UoanNvbikgOiAobmV3IEZ1bmN0aW9uKCJyZXR1cm4gIiArIGpzb24pKSgpCiAgICB9LAoKICAgIGlzQXJyYXk6IGZ1bmN0aW9uIChvYmopewogICAgICByZXR1cm4gb2JqIGluc3RhbmNlb2YgQXJyYXkgfHwgdG9TdHJpbmcuY2FsbChvYmopID09ICJbb2JqZWN0IEFycmF5XSIKICAgIH0sCgogICAgaW5kZXhPZjogaW5kZXhPZiA/IGZ1bmN0aW9uKGl0ZW0sIGFycmF5KXsKICAgICAgICByZXR1cm4gaW5kZXhPZi5jYWxsKGFycmF5LCBpdGVtKQogICAgICB9IDogZnVuY3Rpb24gKGl0ZW0sIGFycmF5KXsKICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSBhcnJheS5sZW5ndGg7IGkgPCBsOyBpKyspCiAgICAgICAgaWYgKGFycmF5W2ldID09PSBpdGVtKQogICAgICAgICAgcmV0dXJuIGkKCiAgICAgIHJldHVybiAtMQogICAgfQogIH0pCn0od2luZG93KTsKIWZ1bmN0aW9uIChzbmFjaywgZG9jdW1lbnQpewogIHZhciBwcm90byA9IHt9CiAgICAsIHF1ZXJ5CgogIHNuYWNrLndyYXAgPSBmdW5jdGlvbiAobm9kZXMsIGNvbnRleHQpewogICAgLy8gcGFzc2VkIGluIGEgQ1NTIHNlbGVjdG9yCiAgICBpZiAodHlwZW9mIG5vZGVzID09ICdzdHJpbmcnKQogICAgICBub2RlcyA9IHF1ZXJ5KG5vZGVzLCBjb250ZXh0KQoKICAgIC8vIHBhc3NlZCBpbiBzaW5nbGUgbm9kZQogICAgaWYgKCFub2Rlcy5sZW5ndGgpCiAgICAgIG5vZGVzID0gW25vZGVzXQoKICAgIHZhciB3cmFwcGVyID0gT2JqZWN0LmNyZWF0ZShwcm90bykKICAgICAgLCBpID0gMAogICAgICAsIGwgPSBub2Rlcy5sZW5ndGgKCiAgICBmb3IgKDsgaSA8IGw7IGkrKykKICAgICAgd3JhcHBlcltpXSA9IG5vZGVzW2ldCgogICAgd3JhcHBlci5sZW5ndGggPSBsCiAgICB3cmFwcGVyLmlkID0gc25hY2suaWQoKQogICAgcmV0dXJuIHdyYXBwZXIKICB9CgogIHNuYWNrLmV4dGVuZChzbmFjay53cmFwLCB7CiAgICBkZWZpbmU6IGZ1bmN0aW9uKG5hbWUsIGZuKXsKICAgICAgaWYgKHR5cGVvZiBuYW1lICE9ICdzdHJpbmcnKXsKICAgICAgICBmb3IgKHZhciBpIGluIG5hbWUpCiAgICAgICAgICBzbmFjay53cmFwLmRlZmluZShpLCBuYW1lW2ldKQogICAgICAgIHJldHVybgogICAgICB9CiAgICAgIHByb3RvW25hbWVdID0gZm4KICAgIH0sCgogICAgZGVmaW5lRW5naW5lOiBmdW5jdGlvbiAoZm4pewogICAgICBxdWVyeSA9IGZuCiAgICB9CiAgfSkKCiAgLy8gUVNBIGRlZmF1bHQgc2VsZWN0b3IgZW5naW5lLCBzdXBwb3J0cyByZWFsIGJyb3dzZXJzIGFuZCBJRTgrCiAgc25hY2sud3JhcC5kZWZpbmVFbmdpbmUoZnVuY3Rpb24gKHNlbGVjdG9yLCBjb250ZXh0KXsKICAgIGlmICh0eXBlb2YgY29udGV4dCA9PSAnc3RyaW5nJykKICAgICAgY29udGV4dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoY29udGV4dCkKCiAgICByZXR1cm4gKGNvbnRleHQgfHwgZG9jdW1lbnQpLnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IpCiAgfSkKfShzbmFjaywgZG9jdW1lbnQpCiFmdW5jdGlvbiAoc25hY2ssIHdpbmRvdywgZG9jdW1lbnQpewogIHZhciBhZGQgICAgICAgICAgICA9IGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIgPyAnYWRkRXZlbnRMaXN0ZW5lcicgOiAnYXR0YWNoRXZlbnQnCiAgICAsIHJlbW92ZSAgICAgICAgID0gZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lciA/ICdyZW1vdmVFdmVudExpc3RlbmVyJyA6ICdkZXRhY2hFdmVudCcKICAgICwgcHJlZml4ICAgICAgICAgPSBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyID8gJycgOiAnb24nCiAgICAsIHJlYWR5ICAgICAgICAgID0gZmFsc2UKICAgICwgdG9wICAgICAgICAgICAgPSB0cnVlCiAgICAsIHJvb3QgICAgICAgICAgID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50CiAgICAsIHJlYWR5SGFuZGxlcnMgID0gW10KCiAgc25hY2suZXh0ZW5kKHsKICAgIHN0b3BQcm9wYWdhdGlvbjogZnVuY3Rpb24gKGV2ZW50KXsKICAgICAgaWYgKGV2ZW50LnN0b3BQcm9wYWdhdGlvbikKICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKQogICAgICBlbHNlCiAgICAgICAgZXZlbnQuY2FuY2VsQnViYmxlID0gdHJ1ZQogICAgfSwKCiAgICBwcmV2ZW50RGVmYXVsdDogZnVuY3Rpb24gKGV2ZW50KXsKICAgICAgaWYgKGV2ZW50LnByZXZlbnREZWZhdWx0KQogICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCkKICAgICAgZWxzZQogICAgICAgIGV2ZW50LnJldHVyblZhbHVlID0gZmFsc2UKICAgIH0KICB9KQoKICBzbmFjay5saXN0ZW5lciA9IGZ1bmN0aW9uIChwYXJhbXMsIGhhbmRsZXIpewogICAgaWYgKHBhcmFtcy5kZWxlZ2F0ZSl7CiAgICAgIHBhcmFtcy5jYXB0dXJlID0gdHJ1ZQogICAgICBfaGFuZGxlciA9IGhhbmRsZXIKICAgICAgaGFuZGxlciA9IGZ1bmN0aW9uIChldmVudCl7CiAgICAgICAgLy8gYWRhcHRlZCBmcm9tIFplcHRvCiAgICAgICAgdmFyIHRhcmdldCA9IGV2ZW50LnRhcmdldCB8fCBldmVudC5zcmNFbGVtZW50CiAgICAgICAgICAsIG5vZGVzID0gdHlwZW9mIHBhcmFtcy5kZWxlZ2F0ZSA9PSAnc3RyaW5nJwogICAgICAgICAgICA/IHNuYWNrLndyYXAocGFyYW1zLmRlbGVnYXRlLCBwYXJhbXMubm9kZSkKICAgICAgICAgICAgOiBwYXJhbXMuZGVsZWdhdGUocGFyYW1zLm5vZGUpCgogICAgICAgIHdoaWxlICh0YXJnZXQgJiYgc25hY2suaW5kZXhPZih0YXJnZXQsIG5vZGVzKSA9PSAtMSApCiAgICAgICAgICB0YXJnZXQgPSB0YXJnZXQucGFyZW50Tm9kZQoKICAgICAgICBpZiAodGFyZ2V0ICYmICEodGFyZ2V0ID09PSB0aGlzKSAmJiAhKHRhcmdldCA9PT0gZG9jdW1lbnQpKQogICAgICAgICAgX2hhbmRsZXIuY2FsbCh0YXJnZXQsIGV2ZW50LCB0YXJnZXQpCiAgICAgIH0KICAgIH0KCiAgICBpZiAocGFyYW1zLmNvbnRleHQpCiAgICAgIGhhbmRsZXIgPSBzbmFjay5iaW5kKGhhbmRsZXIsIHBhcmFtcy5jb250ZXh0KQoKICAgIHZhciBtZXRob2RzID0gewogICAgICBhdHRhY2g6IGZ1bmN0aW9uICgpewogICAgICAgIHBhcmFtcy5ub2RlW2FkZF0oCiAgICAgICAgICBwcmVmaXggKyBwYXJhbXMuZXZlbnQsCiAgICAgICAgICBoYW5kbGVyLAogICAgICAgICAgcGFyYW1zLmNhcHR1cmUKICAgICAgICApCiAgICAgIH0sCgogICAgICBkZXRhY2g6IGZ1bmN0aW9uICgpewogICAgICAgIHBhcmFtcy5ub2RlW3JlbW92ZV0oCiAgICAgICAgICBwcmVmaXggKyBwYXJhbXMuZXZlbnQsCiAgICAgICAgICBoYW5kbGVyLAogICAgICAgICAgcGFyYW1zLmNhcHR1cmUKICAgICAgICApCiAgICAgIH0sCgogICAgICBmaXJlOiBmdW5jdGlvbiAoKXsKICAgICAgICBoYW5kbGVyLmFwcGx5KHBhcmFtcy5ub2RlLCBhcmd1bWVudHMpCiAgICAgIH0KICAgIH0KCiAgICBtZXRob2RzLmF0dGFjaCgpCgogICAgcmV0dXJuIG1ldGhvZHMKICB9CgoKCgogIHNuYWNrLnJlYWR5ID0gZnVuY3Rpb24gKGhhbmRsZXIpewogICAgaWYgKHJlYWR5KXsKICAgICAgaGFuZGxlci5hcHBseShkb2N1bWVudCkKICAgICAgcmV0dXJuCiAgICB9CiAgICByZWFkeUhhbmRsZXJzLnB1c2goaGFuZGxlcikKICB9CgogIC8vIGFkYXB0ZWQgZnJvbSBjb250ZW50bG9hZGVkCiAgZnVuY3Rpb24gaW5pdChlKSB7CiAgICBpZiAoZS50eXBlID09ICdyZWFkeXN0YXRlY2hhbmdlJyAmJiBkb2N1bWVudC5yZWFkeVN0YXRlICE9ICdjb21wbGV0ZScpCiAgICAgIHJldHVybgoKICAgIChlLnR5cGUgPT0gJ2xvYWQnID8gd2luZG93IDogZG9jdW1lbnQpW3JlbW92ZV0ocHJlZml4ICsgZS50eXBlLCBpbml0LCBmYWxzZSkKCiAgICBpZiAoIXJlYWR5ICYmIChyZWFkeSA9IHRydWUpKQogICAgICBzbmFjay5lYWNoKHJlYWR5SGFuZGxlcnMsIGZ1bmN0aW9uIChoYW5kbGVyKXsKICAgICAgICBoYW5kbGVyLmFwcGx5KGRvY3VtZW50KQogICAgICB9KQogIH0KCiAgZnVuY3Rpb24gcG9sbCgpIHsKICAgIHRyeSB7CiAgICAgIHJvb3QuZG9TY3JvbGwoJ2xlZnQnKQogICAgfSBjYXRjaChlKSB7IAogICAgICBzZXRUaW1lb3V0KHBvbGwsIDUwKQogICAgICByZXR1cm4KICAgIH0KICAgIGluaXQoJ3BvbGwnKQogIH0KCiAgaWYgKGRvY3VtZW50LmNyZWF0ZUV2ZW50T2JqZWN0ICYmIHJvb3QuZG9TY3JvbGwpIHsKICAgIHRyeSB7CiAgICAgIHRvcCA9ICF3aW5kb3cuZnJhbWVFbGVtZW50CiAgICB9IGNhdGNoKGUpIHt9CiAgICBpZiAodG9wKQogICAgICBwb2xsKCk7CiAgfQoKICBkb2N1bWVudFthZGRdKHByZWZpeCArICdET01Db250ZW50TG9hZGVkJywgaW5pdCwgZmFsc2UpCiAgZG9jdW1lbnRbYWRkXShwcmVmaXggKyAncmVhZHlzdGF0ZWNoYW5nZScsIGluaXQsIGZhbHNlKQogIHdpbmRvd1thZGRdKHByZWZpeCArICdsb2FkJywgaW5pdCwgZmFsc2UpCn0oc25hY2ssIHdpbmRvdywgZG9jdW1lbnQpOwohZnVuY3Rpb24gKHNuYWNrKXsKICBzbmFjay5wdWJsaXNoZXIgPSBmdW5jdGlvbiAob2JqKXsKICAgIHZhciBjaGFubmVscyA9IHt9CiAgICBvYmogPSBvYmogfHwge30KCiAgICBzbmFjay5leHRlbmQob2JqLCB7CiAgICAgIHN1YnNjcmliZTogZnVuY3Rpb24gKGNoYW5uZWwsIGhhbmRsZXIsIGNvbnRleHQpewogICAgICAgIHZhciBzdWJzY3JpcHRpb24gPSB7CiAgICAgICAgICBmbjogaGFuZGxlciwKICAgICAgICAgIGN0eHQ6IChjb250ZXh0IHx8IHt9KQogICAgICAgIH0KCiAgICAgICAgaWYgKCFjaGFubmVsc1tjaGFubmVsXSkKICAgICAgICAgIGNoYW5uZWxzW2NoYW5uZWxdID0gW10KCiAgICAgICAgdmFyIHB1YmxpayA9IHsKICAgICAgICAgIGF0dGFjaDogZnVuY3Rpb24gKCl7CiAgICAgICAgICAgIGNoYW5uZWxzW2NoYW5uZWxdLnB1c2goc3Vic2NyaXB0aW9uKQogICAgICAgICAgfSwKICAgICAgICAgIGRldGFjaDogZnVuY3Rpb24gKCl7CiAgICAgICAgICAgIGNoYW5uZWxzW2NoYW5uZWxdLnNwbGljZShzbmFjay5pbmRleE9mKGhhbmRsZXIsIGNoYW5uZWxzW2NoYW5uZWxdKSwgMSkKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcHVibGlrLmF0dGFjaCgpCiAgICAgICAgcmV0dXJuIHB1YmxpawogICAgICB9LAoKICAgICAgcHVibGlzaDogZnVuY3Rpb24gKGNoYW5uZWwsIGFyZ3NBcnJheSl7CiAgICAgICAgaWYgKCFjaGFubmVsc1tjaGFubmVsXSkKICAgICAgICAgIHJldHVybiBmYWxzZQoKICAgICAgICBzbmFjay5lYWNoKGNoYW5uZWxzW2NoYW5uZWxdLCBmdW5jdGlvbiAoc3Vic2NyaXB0aW9uKXsKICAgICAgICAgIHN1YnNjcmlwdGlvbi5mbi5hcHBseShzdWJzY3JpcHRpb24uY3R4dCwgYXJnc0FycmF5IHx8IFtdKQogICAgICAgIH0pCgogICAgICAgIHJldHVybiBjaGFubmVsc1tjaGFubmVsXS5sZW5ndGgKICAgICAgfQogICAgfSkKCiAgICByZXR1cm4gb2JqCiAgfQoKICBzbmFjay5wdWJsaXNoZXIoc25hY2spCn0oc25hY2spOwohZnVuY3Rpb24oc25hY2ssIHdpbmRvdywgZG9jdW1lbnQpewogIHNuYWNrLkpTT05QID0gZnVuY3Rpb24ocGFyYW1zLCBjYWxsYmFjayl7CiAgICAvLyBhZGFwdGVkIGZyb20gWmVwdG8KICAgIHZhciBqc29ucFN0cmluZyA9ICdqc29ucCcgKyBzbmFjay5pZCgpCiAgICAgICwgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0JykKICAgICAgLCBydW5uaW5nID0gZmFsc2UKCiAgICAgIHNuYWNrLkpTT05QW2pzb25wU3RyaW5nXSA9IGZ1bmN0aW9uKGRhdGEpewogICAgICAgIHJ1bm5pbmcgPSBmYWxzZQogICAgICAgIGRlbGV0ZSBzbmFjay5KU09OUFtqc29ucFN0cmluZ10KICAgICAgICBjYWxsYmFjayhkYXRhKQogICAgICB9CgogICAgICBpZiAodHlwZW9mIHBhcmFtcy5kYXRhID09ICdvYmplY3QnKQogICAgICAgIHBhcmFtcy5kYXRhID0gc25hY2sudG9RdWVyeVN0cmluZyhwYXJhbXMuZGF0YSkKCiAgICB2YXIgcHVibGlrID0gewogICAgICBzZW5kOiBmdW5jdGlvbiAoKXsKICAgICAgICBydW5uaW5nID0gdHJ1ZQogICAgICAgIHNjcmlwdC5zcmMgPSBwYXJhbXMudXJsICsgJz8nICsgcGFyYW1zLmtleSArICc9c25hY2suSlNPTlAuJyArIGpzb25wU3RyaW5nICsgJyYnICsgcGFyYW1zLmRhdGEKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaGVhZCcpWzBdLmFwcGVuZENoaWxkKHNjcmlwdCkKICAgICAgfSwKCiAgICAgIGNhbmNlbDogZnVuY3Rpb24gKCl7CiAgICAgICAgcnVubmluZyAmJiBzY3JpcHQucGFyZW50Tm9kZSAmJiBzY3JpcHQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChzY3JpcHQpCiAgICAgICAgcnVubmluZyA9IGZhbHNlCiAgICAgICAgc25hY2suSlNPTlBbanNvbnBTdHJpbmddID0gZnVuY3Rpb24gKCl7CiAgICAgICAgICBkZWxldGUgc25hY2suSlNPTlBbanNvbnBTdHJpbmddCiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgaWYgKHBhcmFtcy5ub3cgIT09IGZhbHNlKQogICAgICBwdWJsaWsuc2VuZCgpCgogICAgcmV0dXJuIHB1YmxpawogIH0KCiAgc25hY2sudG9RdWVyeVN0cmluZyA9IGZ1bmN0aW9uKG9iamVjdCwgYmFzZSl7CiAgICAvLyBhZGFwdGVkIGZyb20gTW9vVG9vbHMKICAgIHZhciBxdWVyeVN0cmluZyA9IFtdCgogICAgc25hY2suZWFjaChvYmplY3QsIGZ1bmN0aW9uKHZhbHVlLCBrZXkpewogICAgICBpZiAoYmFzZSkKICAgICAgICBrZXkgPSBiYXNlICsgJ1snICsga2V5ICsgJ10nCgogICAgICB2YXIgcmVzdWx0CgogICAgICBpZiAoc25hY2suaXNBcnJheSh2YWx1ZSkpewogICAgICAgIHZhciBxcyA9IHt9CiAgICAgICAgc25hY2suZWFjaCh2YWx1ZSwgZnVuY3Rpb24odmFsLCBpKXsKICAgICAgICAgIHFzW2ldID0gdmFsCiAgICAgICAgfSkKICAgICAgICByZXN1bHQgPSBzbmFjay50b1F1ZXJ5U3RyaW5nKHFzLCBrZXkpCiAgICAgIH0KICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09ICdvYmplY3QnKQogICAgICAgIHJlc3VsdCA9IHNuYWNrLnRvUXVlcnlTdHJpbmcodmFsdWUsIGtleSkKICAgICAgZWxzZQogICAgICAgIHJlc3VsdCA9IGtleSArICc9JyArIGVuY29kZVVSSUNvbXBvbmVudCh2YWx1ZSkKCiAgICAgIGlmICh2YWx1ZSAhPT0gbnVsbCkKICAgICAgICBxdWVyeVN0cmluZy5wdXNoKHJlc3VsdCkKICAgIH0pCgogICAgcmV0dXJuIHF1ZXJ5U3RyaW5nLmpvaW4oJyYnKQogIH0KCiAgdmFyIHhock9iamVjdCA9IChmdW5jdGlvbigpewogICAgLy8gYWRhcHRlZCBmcm9tIE1vb1Rvb2xzCiAgICB2YXIgWE1MSFRUUCA9IGZ1bmN0aW9uKCl7CiAgICAgIHJldHVybiBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKICAgIH0KCiAgICB2YXIgTVNYTUwyID0gZnVuY3Rpb24oKXsKICAgICAgcmV0dXJuIG5ldyBBY3RpdmVYT2JqZWN0KCdNU1hNTDIuWE1MSFRUUCcpOwogICAgfQoKICAgIHZhciBNU1hNTCA9IGZ1bmN0aW9uKCl7CiAgICAgIHJldHVybiBuZXcgQWN0aXZlWE9iamVjdCgnTWljcm9zb2Z0LlhNTEhUVFAnKTsKICAgIH0KCiAgICB0cnkgewogICAgICBYTUxIVFRQKCkKICAgICAgcmV0dXJuIFhNTEhUVFAKICAgIH0gY2F0Y2ggKGUpewogICAgICB0cnkgewogICAgICAgIE1TWE1MMigpCiAgICAgICAgcmV0dXJuIE1TWE1MMgogICAgICB9IGNhdGNoIChlKXsKICAgICAgICBNU1hNTCgpCiAgICAgICAgcmV0dXJuIE1TWE1MCiAgICAgIH0KICAgIH0KICB9KSgpOwoKICBmdW5jdGlvbiBlbXB0eSgpe30KCiAgc25hY2sucmVxdWVzdCA9IGZ1bmN0aW9uIChvcHRpb25zLCBjYWxsYmFjayl7CiAgICAvLyBhZGFwdGVkIGZyb20gTW9vVG9vbHMKICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBzbmFjay5yZXF1ZXN0KSkKICAgICAgcmV0dXJuIG5ldyBzbmFjay5yZXF1ZXN0KG9wdGlvbnMsIGNhbGxiYWNrKQoKICAgIHZhciBzZWxmID0gdGhpcwogICAgc2VsZi5vcHRpb25zID0gc25hY2suZXh0ZW5kKHt9LCBzZWxmLm9wdGlvbnMsIG9wdGlvbnMpCiAgICBzZWxmLmNhbGxiYWNrID0gY2FsbGJhY2sKICAgIHNlbGYueGhyID0gbmV3IHhock9iamVjdAogICAgc2VsZi5oZWFkZXJzID0gc2VsZi5vcHRpb25zLmhlYWRlcnMKICAgIGlmIChzZWxmLm9wdGlvbnMubm93ICE9PSBmYWxzZSkKICAgICAgc2VsZi5zZW5kKCkKICB9CgogIHNuYWNrLnJlcXVlc3QucHJvdG90eXBlID0gewoKICAgIG9wdGlvbnM6IHsvKgogICAgICB1c2VyOiAnJywKICAgICAgcGFzc3dvcmQ6ICcnLCovCiAgICAgIGV4Y2VwdGlvbjogZW1wdHksCiAgICAgIHVybDogJycsCiAgICAgIGRhdGE6ICcnLAogICAgICBtZXRob2Q6ICdnZXQnLAogICAgICBub3c6IHRydWUsCiAgICAgIGhlYWRlcnM6IHsKICAgICAgICAnWC1SZXF1ZXN0ZWQtV2l0aCc6ICdYTUxIdHRwUmVxdWVzdCcsCiAgICAgICAgJ0FjY2VwdCc6ICd0ZXh0L2phdmFzY3JpcHQsIHRleHQvaHRtbCwgYXBwbGljYXRpb24veG1sLCB0ZXh0L3htbCwgKi8qJwogICAgICB9LAogICAgICBhc3luYzogdHJ1ZSwKICAgICAgZW11bGF0aW9uOiB0cnVlLAogICAgICB1cmxFbmNvZGVkOiB0cnVlLAogICAgICBlbmNvZGluZzogJ3V0Zi04JwogICAgfSwKCiAgICBvblN0YXRlQ2hhbmdlOiBmdW5jdGlvbigpewogICAgICB2YXIgc2VsZiA9IHRoaXMKICAgICAgICAsIHhociA9IHNlbGYueGhyCgogICAgICBpZiAoeGhyLnJlYWR5U3RhdGUgIT0gNCB8fCAhc2VsZi5ydW5uaW5nKSByZXR1cm4KICAgICAgc2VsZi5ydW5uaW5nID0gZmFsc2UKICAgICAgc2VsZi5zdGF0dXMgPSAwCgogICAgICB0cnl7CiAgICAgICAgdmFyIHN0YXR1cyA9IHhoci5zdGF0dXMKICAgICAgICBzZWxmLnN0YXR1cyA9IChzdGF0dXMgPT0gMTIyMykgPyAyMDQgOiBzdGF0dXMKICAgICAgfSBjYXRjaChlKSB7fQoKICAgICAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGVtcHR5OwoKICAgICAgdmFyIGFyZ3MgPSBzZWxmLnN0YXR1cyA+PSAyMDAgJiYgc2VsZi5zdGF0dXMgPCAzMDAKICAgICAgICA/IFtmYWxzZSwgc2VsZi54aHIucmVzcG9uc2VUZXh0IHx8ICcnLCBzZWxmLnhoci5yZXNwb25zZVhNTF0KICAgICAgICA6IFtzZWxmLnN0YXR1c10KCiAgICAgIHNlbGYuY2FsbGJhY2suYXBwbHkoc2VsZiwgYXJncykKICAgIH0sCiAgCiAgICBzZXRIZWFkZXI6IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKXsKICAgICAgdGhpcy5oZWFkZXJzW25hbWVdID0gdmFsdWU7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICBnZXRIZWFkZXI6IGZ1bmN0aW9uKG5hbWUpewogICAgICB0cnkgewogICAgICAgIHJldHVybiB0aGlzLnhoci5nZXRSZXNwb25zZUhlYWRlcihuYW1lKQogICAgICB9IGNhdGNoKGUpIHsKICAgICAgICByZXR1cm4gbnVsbAogICAgICB9CiAgICB9LAogIAogICAgc2VuZDogZnVuY3Rpb24oKXsKICAgICAgdmFyIHNlbGYgPSB0aGlzCiAgICAgICAgLCBvcHRpb25zID0gc2VsZi5vcHRpb25zCgogICAgICBpZiAoc2VsZi5ydW5uaW5nKSByZXR1cm4gc2VsZjsKCiAgICAgIHNlbGYucnVubmluZyA9IHRydWU7CgogICAgICB2YXIgZGF0YSA9IG9wdGlvbnMuZGF0YSB8fCAnJwogICAgICAgICwgdXJsID0gU3RyaW5nKG9wdGlvbnMudXJsKQogICAgICAgICwgbWV0aG9kID0gb3B0aW9ucy5tZXRob2QudG9Mb3dlckNhc2UoKQoKICAgICAgaWYgKHR5cGVvZiBkYXRhICE9ICdzdHJpbmcnKQogICAgICAgIGRhdGEgPSBzbmFjay50b1F1ZXJ5U3RyaW5nKGRhdGEpCgogICAgICBpZiAob3B0aW9ucy5lbXVsYXRpb24gJiYgc25hY2suaW5kZXhPZihtZXRob2QsIFsnZ2V0JywgJ3Bvc3QnXSkgPCAwKXsKICAgICAgICB2YXIgX21ldGhvZCA9ICdfbWV0aG9kPScgKyBtZXRob2QKICAgICAgICBkYXRhID0gKGRhdGEpID8gX21ldGhvZCArICcmJyArIGRhdGEgOiBfbWV0aG9kCiAgICAgICAgbWV0aG9kID0gJ3Bvc3QnCiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLnVybEVuY29kZWQgJiYgc25hY2suaW5kZXhPZihtZXRob2QsIFsncG9zdCcsICdwdXQnXSkgPiAtMSl7CiAgICAgICAgdmFyIGVuY29kaW5nID0gKG9wdGlvbnMuZW5jb2RpbmcpID8gJzsgY2hhcnNldD0nICsgb3B0aW9ucy5lbmNvZGluZyA6ICcnCiAgICAgICAgc2VsZi5oZWFkZXJzWydDb250ZW50LXR5cGUnXSA9ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnICsgZW5jb2RpbmcKICAgICAgfQoKICAgICAgaWYgKCF1cmwpCiAgICAgICAgdXJsID0gZG9jdW1lbnQubG9jYXRpb24ucGF0aG5hbWUKCiAgICAgIHZhciB0cmltUG9zaXRpb24gPSB1cmwubGFzdEluZGV4T2YoJy8nKQogICAgICBpZiAodHJpbVBvc2l0aW9uID4gLTEgJiYgKHRyaW1Qb3NpdGlvbiA9IHVybC5pbmRleE9mKCcjJykpID4gLTEpCiAgICAgICAgdXJsID0gdXJsLnN1YnN0cigwLCB0cmltUG9zaXRpb24pCgogICAgICBpZiAoZGF0YSAmJiBtZXRob2QgPT0gJ2dldCcpewogICAgICAgIHVybCArPSAodXJsLmluZGV4T2YoJz8nKSA+IC0xID8gJyYnIDogJz8nKSArIGRhdGEKICAgICAgICBkYXRhID0gbnVsbAogICAgICB9CgogICAgICB2YXIgeGhyID0gc2VsZi54aHIKCiAgICAgIHhoci5vcGVuKG1ldGhvZC50b1VwcGVyQ2FzZSgpLCB1cmwsIG9wZW4uYXN5bmMsIG9wdGlvbnMudXNlciwgb3B0aW9ucy5wYXNzd29yZCkKICAgICAgaWYgKG9wdGlvbnMudXNlciAmJiAnd2l0aENyZWRlbnRpYWxzJyBpbiB4aHIpIHhoci53aXRoQ3JlZGVudGlhbHMgPSB0cnVlCiAgICAKICAgICAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IHNuYWNrLmJpbmQoc2VsZi5vblN0YXRlQ2hhbmdlLCBzZWxmKQoKICAgICAgZm9yICh2YXIgaSBpbiBzZWxmLmhlYWRlcnMpewogICAgICAgIHRyeSB7CiAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihpLCBzZWxmLmhlYWRlcnNbaV0pCiAgICAgICAgfSBjYXRjaCAoZSl7CiAgICAgICAgICBvcHRpb25zLmV4Y2VwdGlvbi5hcHBseShzZWxmLCBbaSwgc2VsZi5oZWFkZXJzW2ldXSkKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHhoci5zZW5kKGRhdGEpCiAgICAgIGlmICghb3B0aW9ucy5hc3luYykgc2VsZi5vblN0YXRlQ2hhbmdlKCkKICAgIAogICAgICByZXR1cm4gc2VsZgogICAgfSwKCiAgICBjYW5jZWw6IGZ1bmN0aW9uKCl7CiAgICAgIHZhciBzZWxmID0gdGhpcwoKICAgICAgaWYgKCFzZWxmLnJ1bm5pbmcpCiAgICAgICAgcmV0dXJuIHNlbGYKCiAgICAgIHNlbGYucnVubmluZyA9IGZhbHNlCgogICAgICB2YXIgeGhyID0gc2VsZi54aHIKICAgICAgeGhyLmFib3J0KCkKCiAgICAgIHhoci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBlbXB0eQoKICAgICAgc2VsZi54aHIgPSBuZXcgeGhyT2JqZWN0KCkKICAgICAgcmV0dXJuIHNlbGYKICAgIH0KICB9Cn0oc25hY2ssIHdpbmRvdywgZG9jdW1lbnQpCiFmdW5jdGlvbihzbmFjaywgZG9jdW1lbnQpewogIHNuYWNrLndyYXAuZGVmaW5lKHsKICAgIGRhdGE6IGZ1bmN0aW9uICgpewogICAgICAvLyBBUEkgaW5zcGlyZWQgYnkgalF1ZXJ5CiAgICAgIHZhciBzdG9yYWdlID0ge30KCiAgICAgIHJldHVybiBmdW5jdGlvbiAoa2V5LCB2YWx1ZSl7CiAgICAgICAgdmFyIGRhdGEgPSBzdG9yYWdlW3RoaXMuaWRdCgogICAgICAgIGlmICghZGF0YSkKICAgICAgICAgIGRhdGEgPSBzdG9yYWdlW3RoaXMuaWRdID0ge30KCiAgICAgICAgaWYgKHZhbHVlID09PSB2b2lkKzEpCiAgICAgICAgICByZXR1cm4gZGF0YVtrZXldCgogICAgICAgIHJldHVybiBkYXRhW2tleV0gPSB2YWx1ZQogICAgICB9ICAKICAgIH0oKSwKCiAgICBlYWNoOiBmdW5jdGlvbiAoZm4sIGNvbnRleHQpewogICAgICByZXR1cm4gc25hY2suZWFjaCh0aGlzLCBmbiwgY29udGV4dCkKICAgIH0sCiAgCiAgICBhZGRDbGFzczogZnVuY3Rpb24gKGNsYXNzTmFtZSl7CiAgICAgIC8vIGFkYXB0ZWQgZnJvbSBNb29Ub29scwogICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uIChlbGVtZW50KXsKICAgICAgICBpZiAoY2xlYW4oZWxlbWVudC5jbGFzc05hbWUpLmluZGV4T2YoY2xhc3NOYW1lKSA+IC0xKQogICAgICAgICAgcmV0dXJuCiAgICAgICAgZWxlbWVudC5jbGFzc05hbWUgPSBjbGVhbihlbGVtZW50LmNsYXNzTmFtZSArICcgJyArIGNsYXNzTmFtZSkKICAgICAgfSkKICAgIH0sCgogICAgcmVtb3ZlQ2xhc3M6IGZ1bmN0aW9uIChjbGFzc05hbWUpewogICAgICAvLyBhZGFwdGVkIGZyb20gTW9vVG9vbHMKICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoZWxlbWVudCl7CiAgICAgICAgZWxlbWVudC5jbGFzc05hbWUgPSBlbGVtZW50LmNsYXNzTmFtZS5yZXBsYWNlKG5ldyBSZWdFeHAoJyhefFxccyknICsgY2xhc3NOYW1lICsgJyg/Olxcc3wkKScpLCAnJDEnKQogICAgICB9KQogICAgfSwKCiAgICBhdHRhY2g6IGZ1bmN0aW9uIChldmVudCwgaGFuZGxlciwgLyogaW50ZXJuYWwgKi8gZGVsZWdhdGlvbil7CiAgICAgIHZhciBzcGxpdCA9IGV2ZW50LnNwbGl0KCcuJykKICAgICAgICAsIGxpc3RlbmVycyA9IFtdCgogICAgICBpZiAoc3BsaXRbMV0pCiAgICAgICAgbGlzdGVuZXJzID0gdGhpcy5kYXRhKHNwbGl0WzFdKSB8fCBbXQoKICAgICAgdGhpcy5lYWNoKGZ1bmN0aW9uKG5vZGUpewogICAgICAgIHZhciBwYXJhbXMgPSB7CiAgICAgICAgICBub2RlOiBub2RlLAogICAgICAgICAgZXZlbnQ6IHNwbGl0WzBdCiAgICAgICAgfQoKICAgICAgICBpZiAoZGVsZWdhdGlvbikKICAgICAgICAgIHBhcmFtcy5kZWxlZ2F0ZSA9IGRlbGVnYXRpb24KCiAgICAgICAgbGlzdGVuZXJzLnB1c2goc25hY2subGlzdGVuZXIocGFyYW1zLCBoYW5kbGVyKSkKICAgICAgfSkKCiAgICAgIGlmIChzcGxpdFsxXSkKICAgICAgICB0aGlzLmRhdGEoc3BsaXRbMV0sIGxpc3RlbmVycykKCiAgICAgIHJldHVybiB0aGlzCiAgICB9LAoKICAgIGRldGFjaDogZnVuY3Rpb24gKG5hbWVzcGFjZSl7CiAgICAgIGxpc3RlbmVyTWV0aG9kKHRoaXMsICdkZXRhY2gnLCBuYW1lc3BhY2UsIG51bGwsIHRydWUpCiAgICAgIHRoaXMuZGF0YShuYW1lc3BhY2UsIG51bGwpCiAgICAgIHJldHVybiB0aGlzCiAgICB9LAoKICAgIGZpcmU6IGZ1bmN0aW9uIChuYW1lc3BhY2UsIGFyZ3MpewogICAgICByZXR1cm4gbGlzdGVuZXJNZXRob2QodGhpcywgJ2ZpcmUnLCBuYW1lc3BhY2UsIGFyZ3MpCiAgICB9LAoKICAgIGRlbGVnYXRlOiBmdW5jdGlvbiAoZXZlbnQsIGRlbGVnYXRpb24sIGhhbmRsZXIpewogICAgICByZXR1cm4gdGhpcy5hdHRhY2goZXZlbnQsIGhhbmRsZXIsIGRlbGVnYXRpb24pCiAgICB9CiAgfSkKCiAgZnVuY3Rpb24gY2xlYW4oc3RyKXsKICAgIHJldHVybiBzdHIucmVwbGFjZSgvXHMrL2csICcgJykucmVwbGFjZSgvXlxzK3xccyskL2csICcnKQogIH0KCiAgZnVuY3Rpb24gbGlzdGVuZXJNZXRob2Qod3JhcHBlciwgbWV0aG9kLCBuYW1lc3BhY2UsIGFyZ3MpewogICAgdmFyIGRhdGEgPSB3cmFwcGVyLmRhdGEobmFtZXNwYWNlKQoKICAgIGlmIChkYXRhKQogICAgICBzbmFjay5lYWNoKGRhdGEsIGZ1bmN0aW9uIChsaXN0ZW5lcil7CiAgICAgICAgbGlzdGVuZXJbbWV0aG9kXS5hcHBseSh3cmFwcGVyLCBhcmdzKQogICAgICB9KQoKICAgIHJldHVybiB3cmFwcGVyCiAgfQp9KHNuYWNrLCBkb2N1bWVudCk7Cg==",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Sat, 08 Nov 2014 04:56:39 GMT",
                    "Content-Length": "16357",
                    "Date": "Sat, 08 Nov 2014 04:56:39 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}