{
    "url": "http://localhost:9999/tscheibl/angular-ie7.js/docs/src/ngdoc.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "DOM data manipulation (DOM-based)",
    "issueType": 5247488,
    "severity": "Information",
    "confidence": "Firm",
    "issueBackground": "DOM-based DOM data manipulation vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this to a data field within the DOM that is used within the visible UI or client-side application logic. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will modify the appearance or behavior of the client-side UI. An attacker may be able to leverage this to perform virtual defacement of the application, or possibly to induce the user to perform unintended actions.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based DOM data manipulation vulnerabilities is not to dynamically write to DOM data fields any data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from being stored. In general, this is best achieved by using a whitelist of permitted values.",
    "issueDetail": "The application may be vulnerable to DOM-based DOM data manipulation. Data is read from <b>self.name</b> and written to <b>the 'text()' function of JQuery</b> via the following statement:<ul><li>dom.text(self.name);</li></ul><b>Note:</b> The name of the current window is a valid attack vector for DOM-based vulnerabilities. An attacker can directly control the name of the targeted application's window by using code on their own domain to load the targeted page using either window.open() or an iframe tag, and specifying the desired window name. ",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/tscheibl/angular-ie7.js/docs/src/ngdoc.js",
                "path": "/tscheibl/angular-ie7.js/docs/src/ngdoc.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC90c2NoZWlibC9hbmd1bGFyLWllNy5qcy9kb2NzL3NyYy9uZ2RvYy5qcyBIVFRQLzEuMQ0KSG9zdDogbG9jYWxob3N0Ojk5OTkNCg0K",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogNDM1NzUNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IFRodSwgMDYgTm92IDIwMTQgMDc6NTM6MzkgR01UDQpMYXN0LU1vZGlmaWVkOiBUaHUsIDA2IE5vdiAyMDE0IDA3OjUzOjM4IEdNVA0KDQovKioKICogQWxsIHBhcnNpbmcvdHJhbnNmb3JtYXRpb24gY29kZSBnb2VzIGhlcmUuIEFsbCBjb2RlIGhlcmUgc2hvdWxkIGJlIHN5bmMgdG8gZWFzZSB0ZXN0aW5nLgogKi8KdmFyIERPTSA9IHJlcXVpcmUoJy4vZG9tLmpzJykuRE9NOwp2YXIgaHRtbEVzY2FwZSA9IHJlcXVpcmUoJy4vZG9tLmpzJykuaHRtbEVzY2FwZTsKdmFyIEV4YW1wbGUgPSByZXF1aXJlKCcuL2V4YW1wbGUuanMnKS5FeGFtcGxlOwp2YXIgTkVXX0xJTkUgPSAvXG5ccj8vOwp2YXIgZ2xvYmFsSUQgPSAwOwp2YXIgZnMgPSByZXF1aXJlKCdmcycpOwp2YXIgZnNwYXRoID0gcmVxdWlyZSgncGF0aCcpOwp2YXIgc2hlbGwgPSByZXF1aXJlKCdzaGVsbGpzJyk7CnZhciBncnVudFV0aWwgPSByZXF1aXJlKCcuLi8uLi9saWIvZ3J1bnQvdXRpbHMuanMnKTsKdmFyIGVycm9yc0pzb247CnZhciBtYXJrZWQgPSByZXF1aXJlKCdtYXJrZWQnKTsKbWFya2VkLnNldE9wdGlvbnMoewogIGdmbTogdHJ1ZSwKICB0YWJsZXM6IHRydWUKfSk7Cgp2YXIgbG9va3VwTWluZXJyTXNnID0gZnVuY3Rpb24gKGRvYykgewogIHZhciBjb2RlLCBuYW1lc3BhY2U7CgogIGlmIChlcnJvcnNKc29uID09PSB1bmRlZmluZWQpIHsKICAgIGVycm9yc0pzb24gPSByZXF1aXJlKCcuLi8uLi9idWlsZC9lcnJvcnMuanNvbicpLmVycm9yczsKICB9CgogIG5hbWVzcGFjZSA9IGRvYy5nZXRNaW5lcnJOYW1lc3BhY2UoKTsKICBjb2RlID0gZG9jLmdldE1pbmVyckNvZGUoKTsKICBpZiAobmFtZXNwYWNlID09PSB1bmRlZmluZWQpIHsKICAgIHJldHVybiBlcnJvcnNKc29uW2NvZGVdOwogIH0KICByZXR1cm4gZXJyb3JzSnNvbltuYW1lc3BhY2VdW2NvZGVdOwp9OwoKZXhwb3J0cy50cmltID0gdHJpbTsKZXhwb3J0cy5tZXRhZGF0YSA9IG1ldGFkYXRhOwpleHBvcnRzLnNjZW5hcmlvcyA9IHNjZW5hcmlvczsKZXhwb3J0cy5tZXJnZSA9IG1lcmdlOwpleHBvcnRzLmNoZWNrQnJva2VuTGlua3MgPSBjaGVja0Jyb2tlbkxpbmtzOwpleHBvcnRzLkRvYyA9IERvYzsKCmV4cG9ydHMubmdWZXJzaW9ucyA9IGZ1bmN0aW9uKCkgewogIHZhciB2ZXJzaW9ucyA9IFtdLCByZWdleCA9IC9edihbMS05XVxkKig/OlwuXGQrXFMrKSspJC87IC8vb25seSBmZXRjaCA+PSAxLjAuMCB2ZXJzaW9ucwogIHNoZWxsLmV4ZWMoJ2dpdCB0YWcnLCB7c2lsZW50OiB0cnVlfSkub3V0cHV0LnNwbGl0KC9ccypcblxzKi8pCiAgICAuZm9yRWFjaChmdW5jdGlvbihsaW5lKSB7CiAgICAgIHZhciBtYXRjaGVzID0gcmVnZXguZXhlYyhsaW5lKTsKICAgICAgaWYobWF0Y2hlcyAmJiBtYXRjaGVzLmxlbmd0aCA+IDApIHsKICAgICAgICB2ZXJzaW9ucy5wdXNoKG1hdGNoZXNbMV0pOwogICAgICB9CiAgICB9KTsKCiAgLy9tYXRjaCB0aGUgZnV0dXJlIHZlcnNpb24gb2YgQW5ndWxhckpTIHRoYXQgaXMgc2V0IGluIHRoZSBwYWNrYWdlLmpzb24gZmlsZQogIHJldHVybiBleHBhbmRWZXJzaW9ucyhzb3J0VmVyc2lvbnNOYXRydWFsbHkodmVyc2lvbnMpLCBleHBvcnRzLm5nQ3VycmVudFZlcnNpb24oKS5mdWxsKTsKCiAgZnVuY3Rpb24gZXhwYW5kVmVyc2lvbnModmVyc2lvbnMsIGxhdGVzdFZlcnNpb24pIHsKICAgIHZhciBSQ19WRVJTSU9OID0gL3JjXGQvOwogICAgLy9jb3B5IHRoZSBhcnJheSB0byBhdm9pZCBjaGFuZ2luZyB0aGUgdmVyc2lvbnMgcGFyYW0gZGF0YQogICAgLy90aGUgbGF0ZXN0IHZlcnNpb24gaXMgbm90IG9uIHRoZSBnaXQgdGFncyBsaXN0LCBidXQKICAgIC8vZG9jcy5hbmd1bGFyanMub3JnIHdpbGwgYWx3YXlzIHBvaW50IHRvIG1hc3RlciBhcyBvZiAxLjIKICAgIHZlcnNpb25zID0gdmVyc2lvbnMuY29uY2F0KFtsYXRlc3RWZXJzaW9uXSk7CgogICAgdmFyIGZpcnN0VW5zdGFibGUsIGV4cGFuZGVkID0gW107CiAgICBmb3IodmFyIGk9dmVyc2lvbnMubGVuZ3RoLTE7aT49MDtpLS0pIHsKICAgICAgdmFyIHZlcnNpb24gPSB2ZXJzaW9uc1tpXSwKICAgICAgICAgIHNwbGl0ID0gdmVyc2lvbi5zcGxpdCgnLicpLAogICAgICAgICAgaXNNYXN0ZXIgPSB2ZXJzaW9uID09IGxhdGVzdFZlcnNpb24sCiAgICAgICAgICBpc1N0YWJsZSA9IHNwbGl0WzFdICUgMiA9PT0gMCAmJiAhUkNfVkVSU0lPTi50ZXN0KHZlcnNpb24pOwoKICAgICAgdmFyIHRpdGxlID0gJ0FuZ3VsYXJKUyAtIHYnICsgdmVyc2lvbjsKCiAgICAgIHZhciBkb2NzUGF0aCA9IHZlcnNpb24gPCAnMS4wLjInID8gICdkb2NzLScgKyB2ZXJzaW9uIDogJ2RvY3MnOwoKICAgICAgdmFyIHVybCA9IGlzTWFzdGVyID8KICAgICAgICAnaHR0cDovL2RvY3MuYW5ndWxhcmpzLm9yZycgOgogICAgICAgICdodHRwOi8vY29kZS5hbmd1bGFyanMub3JnLycgKyB2ZXJzaW9uICsgJy8nICsgZG9jc1BhdGg7CgogICAgICBleHBhbmRlZC5wdXNoKHsKICAgICAgICB2ZXJzaW9uIDogdmVyc2lvbiwKICAgICAgICBzdGFibGUgOiBpc1N0YWJsZSwKICAgICAgICB0aXRsZSA6IHRpdGxlLAogICAgICAgIGdyb3VwIDogKGlzU3RhYmxlID8gJ1N0YWJsZScgOiAnVW5zdGFibGUnKSwKICAgICAgICB1cmwgOiB1cmwKICAgICAgfSk7CiAgICB9OwoKICAgIHJldHVybiBleHBhbmRlZDsKICB9OwoKICBmdW5jdGlvbiBzb3J0VmVyc2lvbnNOYXRydWFsbHkodmVyc2lvbnMpIHsKICAgIHZhciB2ZXJzaW9uTWFwID0ge30sCiAgICAgICAgTk9OX1JDX1JFTEVBU0VfTlVNQkVSID0gOTk5OwogICAgZm9yKHZhciBpID0gdmVyc2lvbnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgdmFyIHZlcnNpb24gPSB2ZXJzaW9uc1tpXTsKICAgICAgdmFyIHNwbGl0ID0gdmVyc2lvbi5zcGxpdCgvXC58cmMvKTsKICAgICAgIHZhciBiYXNlVmVyc2lvbiA9IHNwbGl0WzBdICsgJy4nICsgc3BsaXRbMV0gKyAnLicgKyBzcGxpdFsyXTsKCiAgICAgIC8vY3JlYXRlIGEgbWFwIG9mIFJDIHZlcnNpb25zIGZvciBlYWNoIHZlcnNpb24KICAgICAgLy90aGlzIHdheSBlYWNoIFJDIHZlcnNpb24gY2FuIGJlIHNvcnRlZCBpbiAibmF0dXJhbCIgb3JkZXIKICAgICAgdmVyc2lvbk1hcFtiYXNlVmVyc2lvbl0gPSB2ZXJzaW9uTWFwW2Jhc2VWZXJzaW9uXSB8fCBbXTsKCiAgICAgIC8vTk9OX1JDX1JFTEVBU0VfTlVNQkVSIGlzIHVzZWQgdG8gc2lnbmFsIHRoZSBub24tUkMgdmVyc2lvbiBmb3IgdGhlIHJlbGVhc2UgYW5kCiAgICAgIC8vaXQgd2lsbCBhbHdheXMgYXBwZWFyIGF0IHRoZSB0b3Agb2YgdGhlIGxpc3Qgc2luY2UgdGhlIG51bWJlciBpcyBzbyBoaWdoIQogICAgICB2ZXJzaW9uTWFwW2Jhc2VWZXJzaW9uXS5wdXNoKAogICAgICAgIHZlcnNpb24gPT0gYmFzZVZlcnNpb24gPyBOT05fUkNfUkVMRUFTRV9OVU1CRVIgOiBwYXJzZUludCh2ZXJzaW9uLm1hdGNoKC9yY1wuPyhcZCspLylbMV0pKTsKICAgIH07CgogICAgLy9mbGF0dGVuIHRoZSBtYXAgc28gdGhhdCB0aGUgUkMgdmVyc2lvbnMgb2NjdXIgaW4gYSBuYXR1cmFsIHNvcnRlZCBvcmRlcgogICAgLy9hbmQgdGhlIG9mZmljaWFsIG5vbi1SQyB2ZXJzaW9uIHNob3dzIHVwIGF0IHRoZSB0b3Agb2YgdGhlIGxpc3Qgb2Ygc29ydGVkCiAgICAvL1JDIHZlcnNpb25zIQogICAgdmFyIGFuZ3VsYXJWZXJzaW9ucyA9IFtdOwogICAgc29ydGVkS2V5cyh2ZXJzaW9uTWFwKS5mb3JFYWNoKGZ1bmN0aW9uKGtleSkgewogICAgICB2YXIgdmVyc2lvbnMgPSB2ZXJzaW9uTWFwW2tleV07CgogICAgICAvL2Jhc2ljIG51bWVyaWNhbCBzb3J0CiAgICAgIHZlcnNpb25zLnNvcnQoZnVuY3Rpb24oYSxiKSB7CiAgICAgICAgcmV0dXJuIGEgLSBiOwogICAgICB9KTsKCiAgICAgIHZlcnNpb25zLmZvckVhY2goZnVuY3Rpb24odikgewogICAgICAgIGFuZ3VsYXJWZXJzaW9ucy5wdXNoKHYgPT0gTk9OX1JDX1JFTEVBU0VfTlVNQkVSID8ga2V5IDoga2V5ICsgJ3JjJyArIHYpOwogICAgICB9KTsKICAgIH0pOwoKICAgIHJldHVybiBhbmd1bGFyVmVyc2lvbnM7CiAgfTsKCiAgZnVuY3Rpb24gc29ydGVkS2V5cyhvYmopIHsKICAgIHZhciBrZXlzID0gW107CiAgICBmb3IodmFyIGtleSBpbiBvYmopIHsKICAgICAga2V5cy5wdXNoKGtleSk7CiAgICB9OwogICAga2V5cy5zb3J0KHRydWUpOwogICAgcmV0dXJuIGtleXM7CiAgfTsKfTsKCmV4cG9ydHMubmdDdXJyZW50VmVyc2lvbiA9IGZ1bmN0aW9uKCkgewogIHJldHVybiBncnVudFV0aWwuZ2V0VmVyc2lvbigpOwp9OwoKdmFyIEJPT0xFQU5fQVRUUiA9IHt9OwpbJ211bHRpcGxlJywgJ3NlbGVjdGVkJywgJ2NoZWNrZWQnLCAnZGlzYWJsZWQnLCAncmVhZE9ubHknLCAncmVxdWlyZWQnXS5mb3JFYWNoKGZ1bmN0aW9uKHZhbHVlKSB7CiAgQk9PTEVBTl9BVFRSW3ZhbHVlXSA9IHRydWU7Cn0pOwoKLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwpmdW5jdGlvbiBEb2ModGV4dCwgZmlsZSwgbGluZSkgewogIGlmICh0eXBlb2YgdGV4dCA9PSAnb2JqZWN0JykgewogICAgZm9yICggdmFyIGtleSBpbiB0ZXh0KSB7CiAgICAgIHRoaXNba2V5XSA9IHRleHRba2V5XTsKICAgIH0KICB9IGVsc2UgewogICAgdGhpcy50ZXh0ID0gdGV4dDsKICAgIHRoaXMuZmlsZSA9IGZpbGU7CiAgICB0aGlzLmxpbmUgPSBsaW5lOwogIH0KICB0aGlzLnNjZW5hcmlvcyA9IHRoaXMuc2NlbmFyaW9zIHx8IFtdOwogIHRoaXMucmVxdWlyZXMgPSB0aGlzLnJlcXVpcmVzIHx8IFtdOwogIHRoaXMucGFyYW0gPSB0aGlzLnBhcmFtIHx8IFtdOwogIHRoaXMucHJvcGVydGllcyA9IHRoaXMucHJvcGVydGllcyB8fCBbXTsKICB0aGlzLm1ldGhvZHMgPSB0aGlzLm1ldGhvZHMgfHwgW107CiAgdGhpcy5ldmVudHMgPSB0aGlzLmV2ZW50cyB8fCBbXTsKICB0aGlzLmxpbmtzID0gdGhpcy5saW5rcyB8fCBbXTsKICB0aGlzLmFuY2hvcnMgPSB0aGlzLmFuY2hvcnMgfHwgW107Cn0KRG9jLk1FVEFEQVRBX0lHTk9SRSA9IChmdW5jdGlvbigpIHsKICB2YXIgd29yZHMgPSBmcy5yZWFkRmlsZVN5bmMoX19kaXJuYW1lICsgJy9pZ25vcmUud29yZHMnLCAndXRmOCcpOwogIHJldHVybiB3b3Jkcy50b1N0cmluZygpLnNwbGl0KC9bLFxzXG5ccl0rL2dtKTsKfSkoKTsKCgpEb2MucHJvdG90eXBlID0gewogIGtleXdvcmRzOiBmdW5jdGlvbiBrZXl3b3JkcygpIHsKICAgIHZhciBrZXl3b3JkcyA9IHt9OwogICAgdmFyIHdvcmRzID0gW107CiAgICBEb2MuTUVUQURBVEFfSUdOT1JFLmZvckVhY2goZnVuY3Rpb24oaWdub3JlKXsga2V5d29yZHNbaWdub3JlXSA9IHRydWU7IH0pOwoKICAgIGZ1bmN0aW9uIGV4dHJhY3RXb3Jkcyh0ZXh0KSB7CiAgICAgIHZhciB0b2tlbnMgPSB0ZXh0LnRvTG93ZXJDYXNlKCkuc3BsaXQoL1tcLlxzLGAnIiNdKy9tZyk7CiAgICAgIHRva2Vucy5mb3JFYWNoKGZ1bmN0aW9uKGtleSl7CiAgICAgICAgdmFyIG1hdGNoID0ga2V5Lm1hdGNoKC9eKChuZzp8W1wkX2Etel0pW1x3XC1fXSspLyk7CiAgICAgICAgaWYgKG1hdGNoKXsKICAgICAgICAgIGtleSA9IG1hdGNoWzFdOwogICAgICAgICAgaWYgKCFrZXl3b3Jkc1trZXldKSB7CiAgICAgICAgICAgIGtleXdvcmRzW2tleV0gPSB0cnVlOwogICAgICAgICAgICB3b3Jkcy5wdXNoKGtleSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KCiAgICBleHRyYWN0V29yZHModGhpcy50ZXh0KTsKICAgIHRoaXMucHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKHByb3ApIHsKICAgICAgZXh0cmFjdFdvcmRzKHByb3AudGV4dCB8fCBwcm9wLmRlc2NyaXB0aW9uIHx8ICcnKTsKICAgIH0pOwogICAgdGhpcy5tZXRob2RzLmZvckVhY2goZnVuY3Rpb24obWV0aG9kKSB7CiAgICAgIGV4dHJhY3RXb3JkcyhtZXRob2QudGV4dCB8fCBtZXRob2QuZGVzY3JpcHRpb24gfHwgJycpOwogICAgfSk7CiAgICBpZiAodGhpcy5uZ2RvYyA9PT0gJ2Vycm9yJykgewogICAgICB3b3Jkcy5wdXNoKHRoaXMuZ2V0TWluZXJyTmFtZXNwYWNlKCkpOwogICAgICB3b3Jkcy5wdXNoKHRoaXMuZ2V0TWluZXJyQ29kZSgpKTsKICAgIH0KICAgIHdvcmRzLnNvcnQoKTsKICAgIHJldHVybiB3b3Jkcy5qb2luKCcgJyk7CiAgfSwKCiAgc2hvcnREZXNjcmlwdGlvbiA6IGZ1bmN0aW9uKCkgewogICAgaWYgKCF0aGlzLmRlc2NyaXB0aW9uKSByZXR1cm4gdGhpcy5kZXNjcmlwdGlvbjsKICAgIHZhciB0ZXh0ID0gdGhpcy5kZXNjcmlwdGlvbi5zcGxpdCgiXG4iKVswXTsKICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoLzwuKz9cLz8+L2csICcnKTsKICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoL3svZywnJiMxMjM7Jyk7CiAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC99L2csJyYjMTI1OycpOwogICAgcmV0dXJuIHRleHQ7CiAgfSwKCiAgZ2V0TWluZXJyTmFtZXNwYWNlOiBmdW5jdGlvbiAoKSB7CiAgICBpZiAodGhpcy5uZ2RvYyAhPT0gJ2Vycm9yJykgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RyaWVkIHRvIGdldCB0aGUgbWluRXJyIG5hbWVzcGFjZSwgYnV0IEBuZ2RvYyAnICsKICAgICAgICB0aGlzLm5nZG9jICsgJyB3YXMgc3VwcGxpZWQuIEl0IHNob3VsZCBiZSBAbmdkb2MgZXJyb3InKTsKICAgIH0KICAgIHJldHVybiB0aGlzLm5hbWUuc3BsaXQoJzonKVswXTsKICB9LAoKICBnZXRNaW5lcnJDb2RlOiBmdW5jdGlvbiAoKSB7CiAgICBpZiAodGhpcy5uZ2RvYyAhPT0gJ2Vycm9yJykgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RyaWVkIHRvIGdldCB0aGUgbWluRXJyIGVycm9yIGNvZGUsIGJ1dCBAbmdkb2MgJyArCiAgICAgICAgdGhpcy5uZ2RvYyArICcgd2FzIHN1cHBsaWVkLiBJdCBzaG91bGQgYmUgQG5nZG9jIGVycm9yJyk7CiAgICB9CiAgICByZXR1cm4gdGhpcy5uYW1lLnNwbGl0KCc6JylbMV07CiAgfSwKCiAgLyoqCiAgICogQ29udmVydHMgcmVsYXRpdmUgdXJscyAod2l0aG91dCBzZWN0aW9uKSBpbnRvIGFic29sdXRlCiAgICogQWJzb2x1dGUgdXJsIG1lYW5zIHVybCB3aXRoIHNlY3Rpb24KICAgKgogICAqIEBleGFtcGxlCiAgICogLSBpZiB0aGUgbGluayBpcyBpbnNpZGUgYW55IGFwaSBkb2M6CiAgICogYW5ndWxhci53aWRnZXQgLT4gYXBpL2FuZ3VsYXIud2lkZ2V0CiAgICoKICAgKiAtIGlmIHRoZSBsaW5rIGlzIGluc2lkZSBhbnkgZ3VpZCBkb2M6CiAgICogaW50cm8gLT4gZ3VpZGUvaW50cm8KICAgKgogICAqIEBwYXJhbSB7c3RyaW5nfSB1cmwgQWJzb2x1dGUgb3IgcmVsYXRpdmUgdXJsCiAgICogQHJldHVybnMge3N0cmluZ30gQWJzb2x1dGUgdXJsCiAgICovCiAgY29udmVydFVybFRvQWJzb2x1dGU6IGZ1bmN0aW9uKHVybCkgewogICAgdmFyIGhhc2hJZHggPSB1cmwuaW5kZXhPZignIycpOwoKICAgIC8vIExvd2VyY2FzZSBoYXNoIHBhcnRzIG9mIHRoZSBsaW5rcywKICAgIC8vIHNvIHRoYXQgd2UgY2FuIGtlZXAgY29ycmVjdCBBUEkgbmFtZXMgZXZlbiB3aGVuIHRoZSB1cmxzIGFyZSBsb3dlcmNhc2VkLgogICAgaWYgKGhhc2hJZHggIT09IC0xKSB7CiAgICAgIHVybCA9IHVybC5zdWJzdHIoMCwgaGFzaElkeCkgKyB1cmwuc3Vic3RyKGhhc2hJZHgpLnRvTG93ZXJDYXNlKCk7CiAgICB9CgogICAgaWYgKHVybC5zdWJzdHIoLTEpID09ICcvJykgcmV0dXJuIHVybCArICdpbmRleCc7CiAgICBpZiAodXJsLm1hdGNoKC9cLy8pKSByZXR1cm4gdXJsOwogICAgcmV0dXJuIHRoaXMuc2VjdGlvbiArICcvJyArIHVybDsKICB9LAoKICBtYXJrZG93bjogZnVuY3Rpb24odGV4dCkgewogICAgaWYgKCF0ZXh0KSByZXR1cm4gdGV4dDsKCiAgICB2YXIgc2VsZiA9IHRoaXMsCiAgICAgIElTX1VSTCA9IC9eKGh0dHBzPzpcL1wvfGZ0cHM/OlwvXC98bWFpbHRvOnxcLnxcLykvLAogICAgICBJU19BTkdVTEFSID0gL14oYXBpXC8pPyhhbmd1bGFyfG5nfEFVVE8pXC4vLAogICAgICBJU19IQVNIID0gL14jLywKICAgICAgcGFydHMgPSB0cmltKHRleHQpLnNwbGl0KC8oPHByZS4qPz5bXHNcU10qPzxcL3ByZT58PGRvYzpleGFtcGxlKFxTKikuKj8+W1xzXFNdKj88XC9kb2M6ZXhhbXBsZT58PGV4YW1wbGVbXj5dKj5bXHNcU10qPzxcL2V4YW1wbGU+KS8pLAogICAgICBzZXEgPSAwLAogICAgICBwbGFjZWhvbGRlck1hcCA9IHt9OwoKICAgIGZ1bmN0aW9uIHBsYWNlaG9sZGVyKHRleHQpIHsKICAgICAgdmFyIGlkID0gJ1JFUExBQ0VNRScgKyAoc2VxKyspOwogICAgICBwbGFjZWhvbGRlck1hcFtpZF0gPSB0ZXh0OwogICAgICByZXR1cm4gaWQ7CiAgICB9CgogICAgZnVuY3Rpb24gZXh0cmFjdElubGluZURvY0NvZGUodGV4dCwgdGFnKSB7CiAgICAgIGlmKHRhZyA9PSAnYWxsJykgewogICAgICAgIC8vdXNlIGEgZ3JlZWR5IG9wZXJhdG9yIHRvIG1hdGNoIHRoZSBsYXN0IDwvZG9jcz4gdGFnCiAgICAgICAgcmVnZXggPSAvXC9cLzxkb2NzLio/PihbLlxzXFNdKylcL1wvPFwvZG9jcz4vaW07CiAgICAgIH0KICAgICAgZWxzZSB7CiAgICAgICAgLy91c2UgYSBub24tZ3JlZWR5IG9wZXJhdG9yIHRvIG1hdGNoIHRoZSBuZXh0IDwvZG9jcz4gdGFnCiAgICAgICAgcmVnZXggPSBuZXcgUmVnRXhwKCJcL1wvPGRvY3NcXHMqdGFnPVwiIiArIHRhZyArICJcIi4qPz4oWy5cXHNcXFNdKz8pXC9cLzxcL2RvY3M+IiwiaW0iKTsKICAgICAgfQogICAgICB2YXIgbWF0Y2hlcyA9IHJlZ2V4LmV4ZWModGV4dC50b1N0cmluZygpKTsKICAgICAgcmV0dXJuIG1hdGNoZXMgJiYgbWF0Y2hlcy5sZW5ndGggPiAxID8gbWF0Y2hlc1sxXSA6ICIiOwogICAgfQoKICAgIHBhcnRzLmZvckVhY2goZnVuY3Rpb24odGV4dCwgaSkgewogICAgICBwYXJ0c1tpXSA9ICh0ZXh0IHx8ICcnKS4KICAgICAgICByZXBsYWNlKC88ZXhhbXBsZSg/OlxzK21vZHVsZT0iKFteIl0qKSIpPyg/OlxzK2RlcHM9IihbXiJdKikiKT8oXHMrYW5pbWF0aW9ucz0idHJ1ZSIpPz4oW1xzXFNdKj8pPFwvZXhhbXBsZT4vZ21pLAogICAgICAgICAgZnVuY3Rpb24oXywgbW9kdWxlLCBkZXBzLCBhbmltYXRpb25zLCBjb250ZW50KSB7CgogICAgICAgICAgdmFyIGV4YW1wbGUgPSBuZXcgRXhhbXBsZShzZWxmLnNjZW5hcmlvcyk7CiAgICAgICAgICBpZihhbmltYXRpb25zKSB7CiAgICAgICAgICAgIGV4YW1wbGUuZW5hYmxlQW5pbWF0aW9ucygpOwogICAgICAgICAgICBleGFtcGxlLmFkZERlcHMoJ2FuZ3VsYXItYW5pbWF0ZS5qcycpOwogICAgICAgICAgfQoKICAgICAgICAgIGV4YW1wbGUuc2V0TW9kdWxlKG1vZHVsZSk7CiAgICAgICAgICBleGFtcGxlLmFkZERlcHMoZGVwcyk7CiAgICAgICAgICBjb250ZW50LnJlcGxhY2UoLzxmaWxlXHMrbmFtZT0iKFteIl0qKSJccyo+KFtcc1xTXSo/KTxcL2ZpbGU+L2dtaSwgZnVuY3Rpb24oXywgbmFtZSwgY29udGVudCkgewogICAgICAgICAgICBleGFtcGxlLmFkZFNvdXJjZShuYW1lLCBjb250ZW50KTsKICAgICAgICAgIH0pOwogICAgICAgICAgY29udGVudC5yZXBsYWNlKC88ZmlsZVxzK3NyYz0iKFteIl0rKSIoPzpccyt0YWc9IihbXiJdKykiKT8oPzpccytuYW1lPSIoW14iXSspIik/XHMqXC8/Pi9nbWksIGZ1bmN0aW9uKF8sIGZpbGUsIHRhZywgbmFtZSkgewogICAgICAgICAgICBpZihmcy5leGlzdHNTeW5jKGZpbGUpKSB7CiAgICAgICAgICAgICAgdmFyIGNvbnRlbnQgPSBmcy5yZWFkRmlsZVN5bmMoZmlsZSwgJ3V0ZjgnKTsKICAgICAgICAgICAgICBpZihjb250ZW50ICYmIGNvbnRlbnQubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgaWYodGFnICYmIHRhZy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgIGNvbnRlbnQgPSBleHRyYWN0SW5saW5lRG9jQ29kZShjb250ZW50LCB0YWcpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbmFtZSA9IG5hbWUgJiYgbmFtZS5sZW5ndGggPiAwID8gbmFtZSA6IGZzcGF0aC5iYXNlbmFtZShmaWxlKTsKICAgICAgICAgICAgICAgIGV4YW1wbGUuYWRkU291cmNlKG5hbWUsIGNvbnRlbnQpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gJyc7CiAgICAgICAgICB9KQogICAgICAgICAgcmV0dXJuIHBsYWNlaG9sZGVyKGV4YW1wbGUudG9IdG1sKCkpOwogICAgICAgIH0pLgogICAgICAgIHJlcGxhY2UoLyg/OlwqXHMrKT88ZmlsZS4rP3NyYz0iKFteIl0rKSIoPzpccyt0YWc9IihbXiJdKykiKT9ccypcLz8+L2ksIGZ1bmN0aW9uKF8sIGZpbGUsIHRhZykgewogICAgICAgICAgaWYoZnMuZXhpc3RzU3luYyhmaWxlKSkgewogICAgICAgICAgICB2YXIgY29udGVudCA9IGZzLnJlYWRGaWxlU3luYyhmaWxlLCAndXRmOCcpOwogICAgICAgICAgICBpZih0YWcgJiYgdGFnLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICBjb250ZW50ID0gZXh0cmFjdElubGluZURvY0NvZGUoY29udGVudCwgdGFnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gY29udGVudDsKICAgICAgICAgIH0KICAgICAgICB9KS4KICAgICAgICByZXBsYWNlKC9ePGRvYzpleGFtcGxlKFxzK1tePl0qKT8+KFtcc1xTXSopPFwvZG9jOmV4YW1wbGU+L21pLCBmdW5jdGlvbihfLCBhdHRycywgY29udGVudCkgewogICAgICAgICAgdmFyIGh0bWwsIHNjcmlwdCwgc2NlbmFyaW8sCiAgICAgICAgICAgIGV4YW1wbGUgPSBuZXcgRXhhbXBsZShzZWxmLnNjZW5hcmlvcyk7CgogICAgICAgICAgZXhhbXBsZS5zZXRNb2R1bGUoKGF0dHJzfHwnbW9kdWxlPSIiJykubWF0Y2goL15ccyptb2R1bGU9WyInXSguKilbIiddXHMqJC8pWzFdKTsKICAgICAgICAgIGNvbnRlbnQuCiAgICAgICAgICAgIHJlcGxhY2UoLzxkb2M6c291cmNlKFxzK1tePl0qKT8+KFtcc1xTXSopPFwvZG9jOnNvdXJjZT4vbWksIGZ1bmN0aW9uKF8sIGF0dHJzLCBjb250ZW50KSB7CiAgICAgICAgICAgICAgZXhhbXBsZS5hZGRTb3VyY2UoJ2luZGV4Lmh0bWwnLCBjb250ZW50LgogICAgICAgICAgICAgICAgcmVwbGFjZSgvPHNjcmlwdD4oW1xzXFNdKik8XC9zY3JpcHQ+L21pLCBmdW5jdGlvbihfLCBzY3JpcHQpIHsKICAgICAgICAgICAgICAgICAgZXhhbXBsZS5hZGRTb3VyY2UoJ3NjcmlwdC5qcycsIHNjcmlwdCk7CiAgICAgICAgICAgICAgICAgIHJldHVybiAnJzsKICAgICAgICAgICAgICAgIH0pLgogICAgICAgICAgICAgICAgcmVwbGFjZSgvPHN0eWxlPihbXHNcU10qKTxcL3N0eWxlPi9taSwgZnVuY3Rpb24oXywgc3R5bGUpIHsKICAgICAgICAgICAgICAgICAgZXhhbXBsZS5hZGRTb3VyY2UoJ3N0eWxlLmNzcycsIHN0eWxlKTsKICAgICAgICAgICAgICAgICAgcmV0dXJuICcnOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICApOwogICAgICAgICAgICB9KS4KICAgICAgICAgICAgcmVwbGFjZSgvKDxkb2M6c2NlbmFyaW8+KShbXHNcU10qKSg8XC9kb2M6c2NlbmFyaW8+KS9taSwgZnVuY3Rpb24oXywgYmVmb3JlLCBjb250ZW50KXsKICAgICAgICAgICAgICBleGFtcGxlLmFkZFNvdXJjZSgnc2NlbmFyaW8uanMnLCBjb250ZW50KTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgcmV0dXJuIHBsYWNlaG9sZGVyKGV4YW1wbGUudG9IdG1sKCkpOwogICAgICAgIH0pLgogICAgICAgIHJlcGxhY2UoL148cHJlKC4qPyk+KFtcc1xTXSo/KTxcL3ByZT4vbWksIGZ1bmN0aW9uKF8sIGF0dHJzLCBjb250ZW50KXsKICAgICAgICAgIHJldHVybiBwbGFjZWhvbGRlcigKICAgICAgICAgICAgJzxwcmUnK2F0dHJzKycgY2xhc3M9InByZXR0eXByaW50IGxpbmVudW1zIj4nICsKICAgICAgICAgICAgICBjb250ZW50LnJlcGxhY2UoLzwvZywgJyZsdDsnKS5yZXBsYWNlKC8+L2csICcmZ3Q7JykgKwogICAgICAgICAgICAgICc8L3ByZT4nKTsKICAgICAgICB9KS4KICAgICAgICByZXBsYWNlKC88ZGl2KFtePl0qKT48XC9kaXY+LywgJzxkaXYkMT5cbjxcL2Rpdj4nKS4KICAgICAgICByZXBsYWNlKC97QGxpbmtccysoW15cc31dKylccyooW159XSo/KVxzKn0vZywgZnVuY3Rpb24oX2FsbCwgdXJsLCB0aXRsZSl7CiAgICAgICAgICB2YXIgaXNGdWxsVXJsID0gdXJsLm1hdGNoKElTX1VSTCksCiAgICAgICAgICAgIGlzQW5ndWxhciA9IHVybC5tYXRjaChJU19BTkdVTEFSKSwKICAgICAgICAgICAgaXNIYXNoID0gdXJsLm1hdGNoKElTX0hBU0gpLAogICAgICAgICAgICBhYnNVcmwgPSBpc0hhc2gKICAgICAgICAgICAgICA/IHVybAogICAgICAgICAgICAgIDogKGlzRnVsbFVybCA/IHVybCA6IHNlbGYuY29udmVydFVybFRvQWJzb2x1dGUodXJsKSk7CgogICAgICAgICAgaWYgKCFpc0Z1bGxVcmwpIHNlbGYubGlua3MucHVzaChhYnNVcmwpOwoKICAgICAgICAgIHJldHVybiAnPGEgaHJlZj0iJyArIGFic1VybCArICciPicgKwogICAgICAgICAgICAoaXNBbmd1bGFyID8gJzxjb2RlPicgOiAnJykgKwogICAgICAgICAgICAodGl0bGUgfHwgdXJsKS5yZXBsYWNlKC9eIy9nLCAnJykucmVwbGFjZSgvXG4vZywgJyAnKSArCiAgICAgICAgICAgIChpc0FuZ3VsYXIgPyAnPC9jb2RlPicgOiAnJykgKwogICAgICAgICAgICAnPC9hPic7CiAgICAgICAgfSkuCiAgICAgICAgcmVwbGFjZSgve0B0eXBlXHMrKFxTKykoPzpccysoXFMrKSk/fS9nLCBmdW5jdGlvbihfLCB0eXBlLCB1cmwpIHsKICAgICAgICAgIHVybCA9IHVybCB8fCAnIyc7CiAgICAgICAgICByZXR1cm4gJzxhIGhyZWY9IicgKyB1cmwgKyAnIiBjbGFzcz0iJyArIHNlbGYucHJlcGFyZV90eXBlX2hpbnRfY2xhc3NfbmFtZSh0eXBlKSArICciPicgKyB0eXBlICsgJzwvYT4nOwogICAgICAgIH0pLgogICAgICAgIHJlcGxhY2UoL3tAaW5zdGFsbE1vZHVsZVxzKyhcUyspP30vZywgZnVuY3Rpb24oXywgbW9kdWxlKSB7CiAgICAgICAgICByZXR1cm4gZXhwbGFpbk1vZHVsZUluc3RhbGxhdGlvbihtb2R1bGUpOwogICAgICAgIH0pOwogICAgfSk7CiAgICB0ZXh0ID0gcGFydHMuam9pbignJyk7CgogICAgZnVuY3Rpb24gcHJlcGFyZUNsYXNzTmFtZSh0ZXh0KSB7CiAgICAgIHJldHVybiB0ZXh0LnRvTG93ZXJDYXNlKCkucmVwbGFjZSgvW19cV10rL2csICctJyk7CiAgICB9OwoKICAgIHZhciBwYWdlQ2xhc3NOYW1lLCBzdWZmaXggPSAnLXBhZ2UnOwogICAgaWYodGhpcy5uYW1lKSB7CiAgICAgIHZhciBzcGxpdCA9IHRoaXMubmFtZS5tYXRjaCgvXlxzKiguKz8pXHMqOlxzKiguKykvKTsKICAgICAgaWYoc3BsaXQgJiYgc3BsaXQubGVuZ3RoID4gMSkgewogICAgICAgIHZhciBiZWZvcmUgPSBwcmVwYXJlQ2xhc3NOYW1lKHNwbGl0WzFdKTsKICAgICAgICB2YXIgYWZ0ZXIgPSBwcmVwYXJlQ2xhc3NOYW1lKHNwbGl0WzJdKTsKICAgICAgICBwYWdlQ2xhc3NOYW1lID0gYmVmb3JlICsgc3VmZml4ICsgJyAnICsgYmVmb3JlICsgJy0nICsgYWZ0ZXIgKyBzdWZmaXg7CiAgICAgIH0KICAgIH0KICAgIHBhZ2VDbGFzc05hbWUgPSBwYWdlQ2xhc3NOYW1lIHx8IHByZXBhcmVDbGFzc05hbWUodGhpcy5uYW1lIHx8ICdkb2NzJykgKyBzdWZmaXg7CgogICAgdGV4dCA9ICc8ZGl2IGNsYXNzPSInICsgcGFnZUNsYXNzTmFtZSArICciPicgKwogICAgICAgICAgICAgbWFya2VkKHRleHQpICsKICAgICAgICAgICAnPC9kaXY+JzsKICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoLyg/OjxwPik/KFJFUExBQ0VNRVxkKykoPzo8XC9wPik/L2csIGZ1bmN0aW9uKF8sIGlkKSB7CiAgICAgIHJldHVybiBwbGFjZWhvbGRlck1hcFtpZF07CiAgICB9KTsKCiAgICAvLyFhbm5vdGF0ZSBDT05URU5UCiAgICAvLyFhbm5vdGF0ZT0iUkVHRVgiIENPTlRFTlQKICAgIC8vIWFubm90YXRlPSJSRUdFWCIgVElUTEV8Q09OVEVOVAogICAgdGV4dCA9IHRleHQucmVwbGFjZSgvXG4/XC9cLyFhbm5vdGF0ZVxzKig/Oj1ccypbJyJdKC4rPylbJyJdKT9ccysoLis/KVxuXHMqKC4rP1xuKS9pbWcsCiAgICAgIGZ1bmN0aW9uKF8sIHBhdHRlcm4sIGNvbnRlbnQsIGxpbmUpIHsKICAgICAgICB2YXIgcGF0dGVybiA9IG5ldyBSZWdFeHAocGF0dGVybiB8fCAnLisnKTsKICAgICAgICB2YXIgdGl0bGUsIHRleHQsIHNwbGl0ID0gY29udGVudC5zcGxpdCgvXHwvKTsKICAgICAgICBpZihzcGxpdC5sZW5ndGggPiAxKSB7CiAgICAgICAgICB0ZXh0ID0gc3BsaXRbMV07CiAgICAgICAgICB0aXRsZSA9IHNwbGl0WzBdOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgIHRpdGxlID0gJ0luZm8nOwogICAgICAgICAgdGV4dCA9IGNvbnRlbnQ7CiAgICAgICAgfQogICAgICAgIHJldHVybiAiXG4iICsgbGluZS5yZXBsYWNlKHBhdHRlcm4sIGZ1bmN0aW9uKG1hdGNoKSB7CiAgICAgICAgICByZXR1cm4gJzxkaXYgY2xhc3M9Im5vY29kZSBub2NvZGUtY29udGVudCIgZGF0YS1wb3BvdmVyICcgKwogICAgICAgICAgICAgICAgICAgJ2RhdGEtY29udGVudD0iJyArIHRleHQgKyAnIiAnICsKICAgICAgICAgICAgICAgICAgICdkYXRhLXRpdGxlPSInICsgdGl0bGUgKyAnIj4nICsKICAgICAgICAgICAgICAgICAgICAgIG1hdGNoICsKICAgICAgICAgICAgICAgICAnPC9kaXY+JzsKICAgICAgICB9KTsKICAgICAgfQogICAgKTsKCiAgICAvLyFkZXRhaWxzIC9wYXRoL3RvL2xvY2FsL2RvY3MvZmlsZS5odG1sCiAgICAvLyFkZXRhaWxzPSJSRUdFWCIgL3BhdGgvdG8vbG9jYWwvZG9jcy9maWxlLmh0bWwKICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoL1wvXC8hZGV0YWlsc1xzKig/Oj1ccypbJyJdKC4rPylbJyJdKT9ccysoLis/KVxuXHMqKC4rP1xuKS9pbWcsCiAgICAgIGZ1bmN0aW9uKF8sIHBhdHRlcm4sIHVybCwgbGluZSkgewogICAgICAgIHVybCA9ICcvbm90ZXMvJyArIHVybDsKICAgICAgICB2YXIgcGF0dGVybiA9IG5ldyBSZWdFeHAocGF0dGVybiB8fCAnLisnKTsKICAgICAgICByZXR1cm4gbGluZS5yZXBsYWNlKHBhdHRlcm4sIGZ1bmN0aW9uKG1hdGNoKSB7CiAgICAgICAgICByZXR1cm4gJzxkaXYgY2xhc3M9Im5vY29kZSBub2NvZGUtY29udGVudCIgZGF0YS1mb2xkb3V0IGRhdGEtdXJsPSInICsgdXJsICsgJyI+JyArIG1hdGNoICsgJzwvZGl2Pic7CiAgICAgICAgfSk7CiAgICAgIH0KICAgICk7CgogICAgcmV0dXJuIHRleHQ7CiAgfSwKCiAgcGFyc2U6IGZ1bmN0aW9uKCkgewogICAgdmFyIGF0TmFtZTsKICAgIHZhciBhdFRleHQ7CiAgICB2YXIgbWF0Y2g7CiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICBzZWxmLnRleHQuc3BsaXQoTkVXX0xJTkUpLmZvckVhY2goZnVuY3Rpb24obGluZSl7CiAgICAgIGlmICgobWF0Y2ggPSBsaW5lLm1hdGNoKC9eXHMqQChcdyspKFxzKyguKikpPy8pKSkgewogICAgICAgIC8vIHdlIGZvdW5kIEBuYW1lIC4uLgogICAgICAgIC8vIGlmIHdlIGhhdmUgZXhpc3RpbmcgbmFtZQogICAgICAgIGZsdXNoKCk7CiAgICAgICAgYXROYW1lID0gbWF0Y2hbMV07CiAgICAgICAgYXRUZXh0ID0gW107CiAgICAgICAgaWYobWF0Y2hbM10pIGF0VGV4dC5wdXNoKG1hdGNoWzNdKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoYXROYW1lKSB7CiAgICAgICAgICBhdFRleHQucHVzaChsaW5lKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogICAgZmx1c2goKTsKICAgIHRoaXMuc2hvcnROYW1lID0gdGhpcy5uYW1lLnNwbGl0KC9bXC46I10vKS5wb3AoKS50cmltKCk7CiAgICB0aGlzLmlkID0gdGhpcy5pZCB8fCAvLyBpZiB3ZSBoYXZlIGFuIGlkIGp1c3QgdXNlIGl0CiAgICAgICh0aGlzLm5nZG9jID09PSAnZXJyb3InID8gdGhpcy5uYW1lIDogJycpIHx8CiAgICAgICgoKHRoaXMuZmlsZXx8JycpLm1hdGNoKC8uKihcL3xcXCkoW14oXC98XFwpXSopXC5uZ2RvYy8pfHx7fSlbMl0pIHx8IC8vIHRyeSB0byBleHRyYWN0IGl0IGZyb20gZmlsZSBuYW1lCiAgICAgIHRoaXMubmFtZTsgLy8gZGVmYXVsdCB0byBuYW1lCiAgICB0aGlzLm1vZHVsZU5hbWUgPSBwYXJzZU1vZHVsZU5hbWUodGhpcy5pZCk7CiAgICB0aGlzLmRlc2NyaXB0aW9uID0gdGhpcy5tYXJrZG93bih0aGlzLmRlc2NyaXB0aW9uKTsKICAgIHRoaXMuZXhhbXBsZSA9IHRoaXMubWFya2Rvd24odGhpcy5leGFtcGxlKTsKICAgIHRoaXNbJ3RoaXMnXSA9IHRoaXMubWFya2Rvd24odGhpc1sndGhpcyddKTsKICAgIHJldHVybiB0aGlzOwoKICAgIGZ1bmN0aW9uIHBhcnNlTW9kdWxlTmFtZShpZCkgewogICAgICB2YXIgbW9kdWxlID0gaWQuc3BsaXQoJy4nKVswXTsKICAgICAgaWYobW9kdWxlID09ICdhbmd1bGFyJykgewogICAgICAgIG1vZHVsZSA9ICduZyc7CiAgICAgIH0KICAgICAgcmV0dXJuIG1vZHVsZTsKICAgIH0KCiAgICBmdW5jdGlvbiBmbHVzaCgpIHsKICAgICAgaWYgKGF0TmFtZSkgewogICAgICAgIHZhciB0ZXh0ID0gdHJpbShhdFRleHQuam9pbignXG4nKSksIG1hdGNoOwogICAgICAgIGlmIChhdE5hbWUgPT0gJ3BhcmFtJykgewogICAgICAgICAgbWF0Y2ggPSB0ZXh0Lm1hdGNoKC9eXHsoW159XSspXH1ccysoKFteXHM9XSspfFxbKFxTKyk9KFteXF1dKylcXSlccysoLiopLyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gIDEgICAgICAxICAgIDIzICAgICAgIDMgICA0ICAgNCA1ICAgICAgNSAgMiAgIDYgIDYKICAgICAgICAgIGlmICghbWF0Y2gpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJOb3QgYSB2YWxpZCAncGFyYW0nIGZvcm1hdDogIiArIHRleHQgKyAnIChmb3VuZCBpbjogJyArIHNlbGYuZmlsZSArICc6JyArIHNlbGYubGluZSArICcpJyk7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIG9wdGlvbmFsID0gKG1hdGNoWzFdLnNsaWNlKC0xKSA9PT0gJz0nKTsKICAgICAgICAgIHZhciBwYXJhbSA9IHsKICAgICAgICAgICAgbmFtZTogbWF0Y2hbNF0gfHwgbWF0Y2hbM10sCiAgICAgICAgICAgIGRlc2NyaXB0aW9uOnNlbGYubWFya2Rvd24odGV4dC5yZXBsYWNlKG1hdGNoWzBdLCBtYXRjaFs2XSkpLAogICAgICAgICAgICB0eXBlOiBvcHRpb25hbCA/IG1hdGNoWzFdLnN1YnN0cmluZygwLCBtYXRjaFsxXS5sZW5ndGgtMSkgOiBtYXRjaFsxXSwKICAgICAgICAgICAgb3B0aW9uYWw6IG9wdGlvbmFsLAogICAgICAgICAgICBkZWZhdWx0OiBtYXRjaFs1XQogICAgICAgICAgfTsKICAgICAgICAgIHNlbGYucGFyYW0ucHVzaChwYXJhbSk7CiAgICAgICAgfSBlbHNlIGlmIChhdE5hbWUgPT0gJ3JldHVybnMnIHx8IGF0TmFtZSA9PSAncmV0dXJuJykgewogICAgICAgICAgbWF0Y2ggPSB0ZXh0Lm1hdGNoKC9eXHsoW159XSspXH1ccysoLiopLyk7CiAgICAgICAgICBpZiAoIW1hdGNoKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiTm90IGEgdmFsaWQgJ3JldHVybnMnIGZvcm1hdDogIiArIHRleHQgKyAnIChmb3VuZCBpbjogJyArIHNlbGYuZmlsZSArICc6JyArIHNlbGYubGluZSArICcpJyk7CiAgICAgICAgICB9CiAgICAgICAgICBzZWxmLnJldHVybnMgPSB7CiAgICAgICAgICAgIHR5cGU6IG1hdGNoWzFdLAogICAgICAgICAgICBkZXNjcmlwdGlvbjogc2VsZi5tYXJrZG93bih0ZXh0LnJlcGxhY2UobWF0Y2hbMF0sIG1hdGNoWzJdKSkKICAgICAgICAgIH07CiAgICAgICAgfSBlbHNlIGlmKGF0TmFtZSA9PSAncmVxdWlyZXMnKSB7CiAgICAgICAgICBtYXRjaCA9IHRleHQubWF0Y2goL14oW15cc10qKVxzKihbXFNcc10qKS8pOwogICAgICAgICAgc2VsZi5yZXF1aXJlcy5wdXNoKHsKICAgICAgICAgICAgbmFtZTogbWF0Y2hbMV0sCiAgICAgICAgICAgIHRleHQ6IHNlbGYubWFya2Rvd24obWF0Y2hbMl0pCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgaWYoYXROYW1lID09ICdwcm9wZXJ0eScpIHsKICAgICAgICAgIG1hdGNoID0gdGV4dC5tYXRjaCgvXlx7KFxTKylcfVxzKyhcUyspKFxzKyguKikpPy8pOwogICAgICAgICAgaWYgKCFtYXRjaCkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIk5vdCBhIHZhbGlkICdwcm9wZXJ0eScgZm9ybWF0OiAiICsgdGV4dCArICcgKGZvdW5kIGluOiAnICsgc2VsZi5maWxlICsgJzonICsgc2VsZi5saW5lICsgJyknKTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBwcm9wZXJ0eSA9IG5ldyBEb2MoewogICAgICAgICAgICB0eXBlOiBtYXRjaFsxXSwKICAgICAgICAgICAgbmFtZTogbWF0Y2hbMl0sCiAgICAgICAgICAgIHNob3J0TmFtZTogbWF0Y2hbMl0sCiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBzZWxmLm1hcmtkb3duKHRleHQucmVwbGFjZShtYXRjaFswXSwgbWF0Y2hbNF0pKQogICAgICAgICAgfSk7CiAgICAgICAgICBzZWxmLnByb3BlcnRpZXMucHVzaChwcm9wZXJ0eSk7CiAgICAgICAgfSBlbHNlIGlmKGF0TmFtZSA9PSAnZXZlbnRUeXBlJykgewogICAgICAgICAgbWF0Y2ggPSB0ZXh0Lm1hdGNoKC9eKFteXHNdKilccytvblxzKyhbXFNcc10qKS8pOwogICAgICAgICAgc2VsZi50eXBlID0gbWF0Y2hbMV07CiAgICAgICAgICBzZWxmLnRhcmdldCA9IG1hdGNoWzJdOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzZWxmW2F0TmFtZV0gPSB0ZXh0OwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0sCgogIGh0bWw6IGZ1bmN0aW9uKCkgewogICAgdmFyIGRvbSA9IG5ldyBET00oKSwKICAgICAgc2VsZiA9IHRoaXMsCiAgICAgIG1pbmVyck1zZzsKCiAgICB2YXIgZ2l0VGFnRnJvbUZ1bGxWZXJzaW9uID0gZnVuY3Rpb24odmVyc2lvbikgewogICAgICB2YXIgbWF0Y2ggPSB2ZXJzaW9uLm1hdGNoKC8tKFx3ezd9KS8pOwoKICAgICAgaWYgKG1hdGNoKSB7CiAgICAgICAgLy8gZ2l0IHNoYQogICAgICAgIHJldHVybiBtYXRjaFsxXTsKICAgICAgfQoKICAgICAgLy8gZ2l0IHRhZwogICAgICByZXR1cm4gJ3YnICsgdmVyc2lvbjsKICAgIH07CgogICAgaWYgKHRoaXMuc2VjdGlvbiA9PT0gJ2FwaScpIHsKICAgICAgZG9tLnRhZygnYScsIHsKICAgICAgICAgIGhyZWY6ICdodHRwOi8vZ2l0aHViLmNvbS9hbmd1bGFyL2FuZ3VsYXIuanMvdHJlZS8nICsKICAgICAgICAgICAgZ2l0VGFnRnJvbUZ1bGxWZXJzaW9uKGdydW50VXRpbC5nZXRWZXJzaW9uKCkuZnVsbCkgKyAnLycgKyBzZWxmLmZpbGUgKyAnI0wnICsgc2VsZi5saW5lLAogICAgICAgICAgY2xhc3M6ICd2aWV3LXNvdXJjZSBidG4gYnRuLWFjdGlvbicgfSwgZnVuY3Rpb24oZG9tKSB7CiAgICAgICAgZG9tLnRhZygnaScsIHtjbGFzczonaWNvbi16b29tLWluJ30sICcgJyk7CiAgICAgICAgZG9tLnRleHQoJyBWaWV3IHNvdXJjZScpOwogICAgICB9KTsKICAgIH0KICAgIGRvbS50YWcoJ2EnLCB7CiAgICAgICAgaHJlZjogJ2h0dHA6Ly9naXRodWIuY29tL2FuZ3VsYXIvYW5ndWxhci5qcy9lZGl0L21hc3Rlci8nICsgc2VsZi5maWxlLAogICAgICAgIGNsYXNzOiAnaW1wcm92ZS1kb2NzIGJ0biBidG4tcHJpbWFyeScgfSwgZnVuY3Rpb24oZG9tKSB7CiAgICAgIGRvbS50YWcoJ2knLCB7Y2xhc3M6J2ljb24tZWRpdCd9LCAnICcpOwogICAgICBkb20udGV4dCgnIEltcHJvdmUgdGhpcyBkb2MnKTsKICAgIH0pOwogICAgZG9tLmgodGl0bGUodGhpcyksIGZ1bmN0aW9uKCkgewogICAgICBub3RpY2UoJ2RlcHJlY2F0ZWQnLCAnRGVwcmVjYXRlZCBBUEknLCBzZWxmLmRlcHJlY2F0ZWQpOwogICAgICBpZiAoc2VsZi5uZ2RvYyA9PT0gJ2Vycm9yJykgewogICAgICAgIG1pbmVyck1zZyA9IGxvb2t1cE1pbmVyck1zZyhzZWxmKTsKICAgICAgICBkb20udGFnKCdwcmUnLCB7CiAgICAgICAgICBjbGFzczonbWluZXJyLWVycm1zZycsCiAgICAgICAgICAnZXJyb3ItZGlzcGxheSc6IG1pbmVyck1zZy5yZXBsYWNlKC8iL2csICcmcXVvdDsnKQogICAgICAgIH0sIG1pbmVyck1zZyk7CiAgICAgIH0KICAgICAgaWYgKHNlbGYubmdkb2MgIT0gJ292ZXJ2aWV3JykgewogICAgICAgIGRvbS5oKCdEZXNjcmlwdGlvbicsIHNlbGYuZGVzY3JpcHRpb24sIGRvbS5odG1sKTsKICAgICAgfQogICAgICBkb20uaCgnRGVwZW5kZW5jaWVzJywgc2VsZi5yZXF1aXJlcywgZnVuY3Rpb24ocmVxdWlyZSl7CiAgICAgICAgZG9tLnRhZygnY29kZScsIGZ1bmN0aW9uKCkgewogICAgICAgICAgZG9tLnRhZygnYScsIHtocmVmOiAnYXBpL25nLicgKyByZXF1aXJlLm5hbWV9LCByZXF1aXJlLm5hbWUpOwogICAgICAgIH0pOwogICAgICAgIGRvbS5odG1sKHJlcXVpcmUudGV4dCk7CiAgICAgIH0pOwoKICAgICAgKHNlbGZbJ2h0bWxfdXNhZ2VfJyArIHNlbGYubmdkb2NdIHx8IGZ1bmN0aW9uKCkgewogICAgICAgIHRocm93IG5ldyBFcnJvcigiRG9uJ3Qga25vdyBob3cgdG8gZm9ybWF0IEBuZ2RvYzogIiArIHNlbGYubmdkb2MpOwogICAgICB9KS5jYWxsKHNlbGYsIGRvbSk7CgogICAgICBkb20uaCgnRXhhbXBsZScsIHNlbGYuZXhhbXBsZSwgZG9tLmh0bWwpOwogICAgfSk7CgogICAgc2VsZi5hbmNob3JzID0gZG9tLmFuY2hvcnM7CgogICAgcmV0dXJuIGRvbS50b1N0cmluZygpOwoKICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgZnVuY3Rpb24gbm90aWNlKG5hbWUsIGxlZ2VuZCwgbXNnKXsKICAgICAgaWYgKHNlbGZbbmFtZV0gPT09IHVuZGVmaW5lZCkgcmV0dXJuOwogICAgICBkb20udGFnKCdmaWVsZHNldCcsIHsnY2xhc3MnOm5hbWV9LCBmdW5jdGlvbihkb20pewogICAgICAgIGRvbS50YWcoJ2xlZ2VuZCcsIGxlZ2VuZCk7CiAgICAgICAgZG9tLnRleHQobXNnKTsKICAgICAgfSk7CiAgICB9CgogIH0sCgogIHByZXBhcmVfdHlwZV9oaW50X2NsYXNzX25hbWUgOiBmdW5jdGlvbih0eXBlKSB7CiAgICB2YXIgdHlwZUNsYXNzID0gdHlwZS50b0xvd2VyQ2FzZSgpLm1hdGNoKC9eWy1cd10rLykgfHwgW107CiAgICB0eXBlQ2xhc3MgPSB0eXBlQ2xhc3NbMF0gPyB0eXBlQ2xhc3NbMF0gOiAnb2JqZWN0JzsKICAgIHJldHVybiAnbGFiZWwgdHlwZS1oaW50IHR5cGUtaGludC0nICsgdHlwZUNsYXNzOwogIH0sCgogIGh0bWxfdXNhZ2VfcGFyYW1ldGVyczogZnVuY3Rpb24oZG9tKSB7CiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICB2YXIgcGFyYW1zID0gdGhpcy5wYXJhbSA/IHRoaXMucGFyYW0gOiBbXTsKICAgIGlmKHRoaXMuYW5pbWF0aW9ucykgewogICAgICBkb20uaCgnQW5pbWF0aW9ucycsIHRoaXMuYW5pbWF0aW9ucywgZnVuY3Rpb24oYW5pbWF0aW9ucyl7CiAgICAgICAgZG9tLmh0bWwoJzx1bD4nKTsKICAgICAgICB2YXIgYW5pbWF0aW9ucyA9IGFuaW1hdGlvbnMuc3BsaXQoIlxuIik7CiAgICAgICAgYW5pbWF0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uKGFuaSkgewogICAgICAgICAgZG9tLmh0bWwoJzxsaT4nKTsKICAgICAgICAgIGRvbS50ZXh0KGFuaSk7CiAgICAgICAgICBkb20uaHRtbCgnPC9saT4nKTsKICAgICAgICB9KTsKICAgICAgICBkb20uaHRtbCgnPC91bD4nKTsKICAgICAgfSk7CiAgICAgIGRvbS5odG1sKCc8YSBocmVmPSJhcGkvbmdBbmltYXRlLiRhbmltYXRlIj5DbGljayBoZXJlPC9hPiB0byBsZWFybiBtb3JlIGFib3V0IHRoZSBzdGVwcyBpbnZvbHZlZCBpbiB0aGUgYW5pbWF0aW9uLicpOwogICAgfQogICAgaWYocGFyYW1zLmxlbmd0aCA+IDApIHsKICAgICAgZG9tLmh0bWwoJzxoMj5QYXJhbWV0ZXJzPC9oMj4nKTsKICAgICAgZG9tLmh0bWwoJzx0YWJsZSBjbGFzcz0idmFyaWFibGVzLW1hdHJpeCB0YWJsZSB0YWJsZS1ib3JkZXJlZCB0YWJsZS1zdHJpcGVkIj4nKTsKICAgICAgZG9tLmh0bWwoJzx0aGVhZD4nKTsKICAgICAgZG9tLmh0bWwoJzx0cj4nKTsKICAgICAgZG9tLmh0bWwoJzx0aD5QYXJhbTwvdGg+Jyk7CiAgICAgIGRvbS5odG1sKCc8dGg+VHlwZTwvdGg+Jyk7CiAgICAgIGRvbS5odG1sKCc8dGg+RGV0YWlsczwvdGg+Jyk7CiAgICAgIGRvbS5odG1sKCc8L3RyPicpOwogICAgICBkb20uaHRtbCgnPC90aGVhZD4nKTsKICAgICAgZG9tLmh0bWwoJzx0Ym9keT4nKTsKICAgICAgZm9yKHZhciBpPTA7aTxwYXJhbXMubGVuZ3RoO2krKykgewogICAgICAgIHBhcmFtID0gcGFyYW1zW2ldOwogICAgICAgIHZhciBuYW1lID0gcGFyYW0ubmFtZTsKICAgICAgICB2YXIgdHlwZXMgPSBwYXJhbS50eXBlOwogICAgICAgIGlmKHR5cGVzWzBdPT0nKCcpIHsKICAgICAgICAgIHR5cGVzID0gdHlwZXMuc3Vic3RyKDEpOwogICAgICAgIH0KCiAgICAgICAgdmFyIGxpbWl0ID0gdHlwZXMubGVuZ3RoIC0gMTsKICAgICAgICBpZih0eXBlcy5jaGFyQXQobGltaXQpID09ICcpJyAmJiB0eXBlcy5jaGFyQXQobGltaXQtMSkgIT0gJygnKSB7CiAgICAgICAgICB0eXBlcyA9IHR5cGVzLnN1YnN0cigwLGxpbWl0KTsKICAgICAgICB9CiAgICAgICAgdHlwZXMgPSB0eXBlcy5zcGxpdCgvXHwoPyFbXChcKVx3XHxcc10rPikvKTsKICAgICAgICBpZiAocGFyYW0ub3B0aW9uYWwpIHsKICAgICAgICAgIG5hbWUgKz0gJyA8ZGl2PjxlbT4ob3B0aW9uYWwpPC9lbT48L2Rpdj4nOwogICAgICAgIH0KICAgICAgICBkb20uaHRtbCgnPHRyPicpOwogICAgICAgIGRvbS5odG1sKCc8dGQ+JyArIG5hbWUgKyAnPC90ZD4nKTsKICAgICAgICBkb20uaHRtbCgnPHRkPicpOwogICAgICAgIGZvcih2YXIgaj0wO2o8dHlwZXMubGVuZ3RoO2orKykgewogICAgICAgICAgdmFyIHR5cGUgPSB0eXBlc1tqXTsKICAgICAgICAgIGRvbS5odG1sKCc8YSBocmVmPSIiIGNsYXNzPSInICsgc2VsZi5wcmVwYXJlX3R5cGVfaGludF9jbGFzc19uYW1lKHR5cGUpICsgJyI+Jyk7CiAgICAgICAgICBkb20udGV4dCh0eXBlKTsKICAgICAgICAgIGRvbS5odG1sKCc8L2E+Jyk7CiAgICAgICAgfQoKICAgICAgICBkb20uaHRtbCgnPC90ZD4nKTsKICAgICAgICB2YXIgZGVzY3JpcHRpb24gPSAnPHRkPic7CiAgICAgICAgZGVzY3JpcHRpb24gKz0gcGFyYW0uZGVzY3JpcHRpb247CiAgICAgICAgaWYgKHBhcmFtLmRlZmF1bHQpIHsKICAgICAgICAgIGRlc2NyaXB0aW9uICs9ICcgPHA+PGVtPihkZWZhdWx0OiAnICsgcGFyYW0uZGVmYXVsdCArICcpPC9lbT48L3A+JzsKICAgICAgICB9CiAgICAgICAgZGVzY3JpcHRpb24gKz0gJzwvdGQ+JzsKICAgICAgICBkb20uaHRtbChkZXNjcmlwdGlvbik7CiAgICAgICAgZG9tLmh0bWwoJzwvdHI+Jyk7CiAgICAgIH07CiAgICAgIGRvbS5odG1sKCc8L3Rib2R5PicpOwogICAgICBkb20uaHRtbCgnPC90YWJsZT4nKTsKICAgIH0KICB9LAoKICBodG1sX3VzYWdlX3JldHVybnM6IGZ1bmN0aW9uKGRvbSkgewogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgaWYgKHNlbGYucmV0dXJucykgewogICAgICBkb20uaHRtbCgnPGgyPlJldHVybnM8L2gyPicpOwogICAgICBkb20uaHRtbCgnPHRhYmxlIGNsYXNzPSJ2YXJpYWJsZXMtbWF0cml4Ij4nKTsKICAgICAgZG9tLmh0bWwoJzx0cj4nKTsKICAgICAgZG9tLmh0bWwoJzx0ZD4nKTsKICAgICAgZG9tLmh0bWwoJzxhIGhyZWY9IiIgY2xhc3M9IicgKyBzZWxmLnByZXBhcmVfdHlwZV9oaW50X2NsYXNzX25hbWUoc2VsZi5yZXR1cm5zLnR5cGUpICsgJyI+Jyk7CiAgICAgIGRvbS50ZXh0KHNlbGYucmV0dXJucy50eXBlKTsKICAgICAgZG9tLmh0bWwoJzwvYT4nKTsKICAgICAgZG9tLmh0bWwoJzwvdGQ+Jyk7CiAgICAgIGRvbS5odG1sKCc8dGQ+Jyk7CiAgICAgIGRvbS5odG1sKHNlbGYucmV0dXJucy5kZXNjcmlwdGlvbik7CiAgICAgIGRvbS5odG1sKCc8L3RkPicpOwogICAgICBkb20uaHRtbCgnPC90cj4nKTsKICAgICAgZG9tLmh0bWwoJzwvdGFibGU+Jyk7CiAgICB9CiAgfSwKCiAgaHRtbF91c2FnZV90aGlzOiBmdW5jdGlvbihkb20pIHsKICAgIHZhciBzZWxmID0gdGhpczsKICAgIGlmIChzZWxmWyd0aGlzJ10pIHsKICAgICAgZG9tLmgoZnVuY3Rpb24oZG9tKXsKICAgICAgICBkb20uaHRtbCgiTWV0aG9kJ3MgPGNvZGU+dGhpczwvY29kZT4iKTsKICAgICAgfSwgZnVuY3Rpb24oZG9tKXsKICAgICAgICBkb20uaHRtbChzZWxmWyd0aGlzJ10pOwogICAgICB9KTsKICAgIH0KICB9LAoKICBodG1sX3VzYWdlX2Z1bmN0aW9uOiBmdW5jdGlvbihkb20pewogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgdmFyIG5hbWUgPSBzZWxmLm5hbWUubWF0Y2goL15hbmd1bGFyKFwubW9jayk/XC4oXHcrKSQvKSA/IHNlbGYubmFtZSA6IHNlbGYubmFtZS5zcGxpdCgvXC4vKS5wb3AoKQoKICAgIGRvbS5oKCdVc2FnZScsIGZ1bmN0aW9uKCkgewogICAgICBkb20uY29kZShmdW5jdGlvbigpIHsKICAgICAgICBkb20udGV4dChuYW1lKTsKICAgICAgICBkb20udGV4dCgnKCcpOwogICAgICAgIHNlbGYucGFyYW1ldGVycyhkb20sICcsICcpOwogICAgICAgIGRvbS50ZXh0KCcpOycpOwogICAgICB9KTsKCiAgICAgIHNlbGYuaHRtbF91c2FnZV9wYXJhbWV0ZXJzKGRvbSk7CiAgICAgIHNlbGYuaHRtbF91c2FnZV90aGlzKGRvbSk7CiAgICAgIHNlbGYuaHRtbF91c2FnZV9yZXR1cm5zKGRvbSk7CiAgICB9KTsKICAgIHRoaXMubWV0aG9kX3Byb3BlcnRpZXNfZXZlbnRzKGRvbSk7CiAgfSwKCiAgaHRtbF91c2FnZV9wcm9wZXJ0eTogZnVuY3Rpb24oZG9tKXsKICAgIHZhciBzZWxmID0gdGhpczsKICAgIGRvbS5oKCdVc2FnZScsIGZ1bmN0aW9uKCkgewogICAgICBkb20uY29kZShmdW5jdGlvbigpIHsKICAgICAgICBkb20udGV4dChzZWxmLm5hbWUpOwogICAgICB9KTsKCiAgICAgIHNlbGYuaHRtbF91c2FnZV9yZXR1cm5zKGRvbSk7CiAgICB9KTsKICB9LAoKICBodG1sX3VzYWdlX2RpcmVjdGl2ZTogZnVuY3Rpb24oZG9tKXsKICAgIHZhciBzZWxmID0gdGhpczsKICAgIGRvbS5oKCdVc2FnZScsIGZ1bmN0aW9uKCkgewogICAgICB2YXIgcmVzdHJpY3QgPSBzZWxmLnJlc3RyaWN0IHx8ICdBJzsKCiAgICAgIGlmIChyZXN0cmljdC5tYXRjaCgvRS8pKSB7CiAgICAgICAgZG9tLmh0bWwoJzxwPicpOwogICAgICAgIGRvbS50ZXh0KCdUaGlzIGRpcmVjdGl2ZSBjYW4gYmUgdXNlZCBhcyBjdXN0b20gZWxlbWVudCwgYnV0IGJlIGF3YXJlIG9mICcpOwogICAgICAgIGRvbS50YWcoJ2EnLCB7aHJlZjonZ3VpZGUvaWUnfSwgJ0lFIHJlc3RyaWN0aW9ucycpOwogICAgICAgIGRvbS50ZXh0KCcuJyk7CiAgICAgICAgZG9tLmh0bWwoJzwvcD4nKTsKICAgICAgfQoKICAgICAgaWYgKHNlbGYudXNhZ2UpIHsKICAgICAgICBkb20udGFnKCdwcmUnLCBmdW5jdGlvbigpIHsKICAgICAgICAgIGRvbS50YWcoJ2NvZGUnLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgZG9tLnRleHQoc2VsZi51c2FnZSk7CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAocmVzdHJpY3QubWF0Y2goL0UvKSkgewogICAgICAgICAgZG9tLnRleHQoJ2FzIGVsZW1lbnQ6Jyk7CiAgICAgICAgICBkb20uY29kZShmdW5jdGlvbigpIHsKICAgICAgICAgICAgZG9tLnRleHQoJzwnKTsKICAgICAgICAgICAgZG9tLnRleHQoZGFzaENhc2Uoc2VsZi5zaG9ydE5hbWUpKTsKICAgICAgICAgICAgcmVuZGVyUGFyYW1zKCdcbiAgICAgICAnLCAnPSInLCAnIicpOwogICAgICAgICAgICBkb20udGV4dCgnPlxuPC8nKTsKICAgICAgICAgICAgZG9tLnRleHQoZGFzaENhc2Uoc2VsZi5zaG9ydE5hbWUpKTsKICAgICAgICAgICAgZG9tLnRleHQoJz4nKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBpZiAocmVzdHJpY3QubWF0Y2goL0EvKSkgewogICAgICAgICAgdmFyIGVsZW1lbnQgPSBzZWxmLmVsZW1lbnQgfHwgJ0FOWSc7CiAgICAgICAgICBkb20udGV4dCgnYXMgYXR0cmlidXRlJyk7CiAgICAgICAgICBkb20uY29kZShmdW5jdGlvbigpIHsKICAgICAgICAgICAgZG9tLnRleHQoJzwnICsgZWxlbWVudCArICcgJyk7CiAgICAgICAgICAgIGRvbS50ZXh0KGRhc2hDYXNlKHNlbGYuc2hvcnROYW1lKSk7CiAgICAgICAgICAgIHJlbmRlclBhcmFtcygnXG4gICAgICcsICc9IicsICciJywgdHJ1ZSk7CiAgICAgICAgICAgIGRvbS50ZXh0KCc+XG4gICAuLi5cbicpOwogICAgICAgICAgICBkb20udGV4dCgnPC8nICsgZWxlbWVudCArICc+Jyk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgaWYgKHJlc3RyaWN0Lm1hdGNoKC9DLykpIHsKICAgICAgICAgIGRvbS50ZXh0KCdhcyBjbGFzcycpOwogICAgICAgICAgdmFyIGVsZW1lbnQgPSBzZWxmLmVsZW1lbnQgfHwgJ0FOWSc7CiAgICAgICAgICBkb20uY29kZShmdW5jdGlvbigpIHsKICAgICAgICAgICAgZG9tLnRleHQoJzwnICsgZWxlbWVudCArICcgY2xhc3M9IicpOwogICAgICAgICAgICBkb20udGV4dChkYXNoQ2FzZShzZWxmLnNob3J0TmFtZSkpOwogICAgICAgICAgICByZW5kZXJQYXJhbXMoJyAnLCAnOiAnLCAnOycsIHRydWUpOwogICAgICAgICAgICBkb20udGV4dCgnIj5cbiAgIC4uLlxuJyk7CiAgICAgICAgICAgIGRvbS50ZXh0KCc8LycgKyBlbGVtZW50ICsgJz4nKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgICBzZWxmLmh0bWxfdXNhZ2VfZGlyZWN0aXZlSW5mbyhkb20pOwogICAgICBzZWxmLmh0bWxfdXNhZ2VfcGFyYW1ldGVycyhkb20pOwogICAgfSk7CgogICAgc2VsZi5tZXRob2RfcHJvcGVydGllc19ldmVudHMoZG9tKTsKCiAgICBmdW5jdGlvbiByZW5kZXJQYXJhbXMocHJlZml4LCBpbmZpeCwgc3VmZml4LCBza2lwU2VsZikgewogICAgICAoc2VsZi5wYXJhbXx8W10pLmZvckVhY2goZnVuY3Rpb24ocGFyYW0pIHsKICAgICAgICB2YXIgc2tpcCA9IHNraXBTZWxmICYmIChwYXJhbS5uYW1lID09IHNlbGYuc2hvcnROYW1lIHx8IHBhcmFtLm5hbWUuaW5kZXhPZihzZWxmLnNob3J0TmFtZSArICd8JykgPT0gMCk7CiAgICAgICAgaWYgKCFza2lwKSB7CiAgICAgICAgICBkb20udGV4dChwcmVmaXgpOwogICAgICAgICAgZG9tLnRleHQocGFyYW0ub3B0aW9uYWwgPyAnWycgOiAnJyk7CiAgICAgICAgICB2YXIgcGFydHMgPSBwYXJhbS5uYW1lLnNwbGl0KCd8Jyk7CiAgICAgICAgICBkb20udGV4dChkYXNoQ2FzZShwYXJ0c1tza2lwU2VsZiA/IDAgOiAxXSB8fCBwYXJ0c1swXSkpOwogICAgICAgIH0KICAgICAgICBpZiAoQk9PTEVBTl9BVFRSW3BhcmFtLm5hbWVdKSB7CiAgICAgICAgICBkb20udGV4dChwYXJhbS5vcHRpb25hbCA/ICddJyA6ICcnKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZG9tLnRleHQoQk9PTEVBTl9BVFRSW3BhcmFtLm5hbWVdID8gJycgOiBpbmZpeCApOwogICAgICAgICAgZG9tLnRleHQoKCd7JyArIHBhcmFtLnR5cGUgKyAnfScpLnJlcGxhY2UoL15ce1wnKC4qKVwnXH0kLywgJyQxJykpOwogICAgICAgICAgZG9tLnRleHQoc3VmZml4KTsKICAgICAgICAgIGRvbS50ZXh0KHBhcmFtLm9wdGlvbmFsICYmICFza2lwID8gJ10nIDogJycpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CgogIH0sCgogIGh0bWxfdXNhZ2VfZmlsdGVyOiBmdW5jdGlvbihkb20pewogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgZG9tLmgoJ1VzYWdlJywgZnVuY3Rpb24oKSB7CiAgICAgIGRvbS5oKCdJbiBIVE1MIFRlbXBsYXRlIEJpbmRpbmcnLCBmdW5jdGlvbigpIHsKICAgICAgICBkb20udGFnKCdjb2RlJywgZnVuY3Rpb24oKSB7CiAgICAgICAgICBpZiAoc2VsZi51c2FnZSkgewogICAgICAgICAgICBkb20udGV4dChzZWxmLnVzYWdlKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGRvbS50ZXh0KCd7eyAnKTsKICAgICAgICAgICAgZG9tLnRleHQoc2VsZi5zaG9ydE5hbWUpOwogICAgICAgICAgICBkb20udGV4dCgnX2V4cHJlc3Npb24gfCAnKTsKICAgICAgICAgICAgZG9tLnRleHQoc2VsZi5zaG9ydE5hbWUpOwogICAgICAgICAgICBzZWxmLnBhcmFtZXRlcnMoZG9tLCAnOicsIHRydWUpOwogICAgICAgICAgICBkb20udGV4dCgnIH19Jyk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0pOwoKICAgICAgZG9tLmgoJ0luIEphdmFTY3JpcHQnLCBmdW5jdGlvbigpIHsKICAgICAgICBkb20udGFnKCdjb2RlJywgZnVuY3Rpb24oKSB7CiAgICAgICAgICBkb20udGV4dCgnJGZpbHRlcihcJycpOwogICAgICAgICAgZG9tLnRleHQoc2VsZi5zaG9ydE5hbWUpOwogICAgICAgICAgZG9tLnRleHQoJ1wnKSgnKTsKICAgICAgICAgIHNlbGYucGFyYW1ldGVycyhkb20sICcsICcpOwogICAgICAgICAgZG9tLnRleHQoJyknKTsKICAgICAgICB9KTsKICAgICAgfSk7CgogICAgICBzZWxmLmh0bWxfdXNhZ2VfcGFyYW1ldGVycyhkb20pOwogICAgICBzZWxmLmh0bWxfdXNhZ2VfdGhpcyhkb20pOwogICAgICBzZWxmLmh0bWxfdXNhZ2VfcmV0dXJucyhkb20pOwogICAgfSk7CiAgfSwKCiAgaHRtbF91c2FnZV9pbnB1dFR5cGU6IGZ1bmN0aW9uKGRvbSl7CiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICBkb20uaCgnVXNhZ2UnLCBmdW5jdGlvbigpIHsKICAgICAgZG9tLmNvZGUoZnVuY3Rpb24oKSB7CiAgICAgICAgZG9tLnRleHQoJzxpbnB1dCB0eXBlPSInICsgc2VsZi5zaG9ydE5hbWUgKyAnIicpOwogICAgICAgIChzZWxmLnBhcmFtfHxbXSkuZm9yRWFjaChmdW5jdGlvbihwYXJhbSl7CiAgICAgICAgICBkb20udGV4dCgnXG4gICAgICAnKTsKICAgICAgICAgIGRvbS50ZXh0KHBhcmFtLm9wdGlvbmFsID8gJyBbJyA6ICcgJyk7CiAgICAgICAgICBkb20udGV4dChkYXNoQ2FzZShwYXJhbS5uYW1lKSk7CiAgICAgICAgICBkb20udGV4dChCT09MRUFOX0FUVFJbcGFyYW0ubmFtZV0gPyAnJyA6ICc9InsnICsgcGFyYW0udHlwZSArICd9IicpOwogICAgICAgICAgZG9tLnRleHQocGFyYW0ub3B0aW9uYWwgPyAnXScgOiAnJyk7CiAgICAgICAgfSk7CiAgICAgICAgZG9tLnRleHQoJz4nKTsKICAgICAgfSk7CiAgICAgIHNlbGYuaHRtbF91c2FnZV9wYXJhbWV0ZXJzKGRvbSk7CiAgICB9KTsKICB9LAoKICBodG1sX3VzYWdlX2RpcmVjdGl2ZUluZm86IGZ1bmN0aW9uKGRvbSkgewogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgdmFyIGxpc3QgPSBbXTsKCgogICAgaWYgKHNlbGYuc2NvcGUgIT09IHVuZGVmaW5lZCkgewogICAgICBsaXN0LnB1c2goJ1RoaXMgZGlyZWN0aXZlIGNyZWF0ZXMgbmV3IHNjb3BlLicpOwogICAgfQogICAgaWYgKHNlbGYucHJpb3JpdHkgIT09IHVuZGVmaW5lZCkgewogICAgICBsaXN0LnB1c2goJ1RoaXMgZGlyZWN0aXZlIGV4ZWN1dGVzIGF0IHByaW9yaXR5IGxldmVsICcgKyBzZWxmLnByaW9yaXR5ICsgJy4nKTsKICAgIH0KCiAgICBpZiAobGlzdC5sZW5ndGgpIHsKICAgICAgZG9tLmgoJ0RpcmVjdGl2ZSBpbmZvJywgZnVuY3Rpb24oKSB7CiAgICAgICAgZG9tLnVsKGxpc3QpOwogICAgICB9KTsKICAgIH0KICB9LAoKICBodG1sX3VzYWdlX292ZXJ2aWV3OiBmdW5jdGlvbihkb20pewogICAgZG9tLmh0bWwodGhpcy5kZXNjcmlwdGlvbik7CiAgfSwKCiAgaHRtbF91c2FnZV9lcnJvcjogZnVuY3Rpb24gKGRvbSkgewogICAgZG9tLmh0bWwoKTsKICB9LAoKICBodG1sX3VzYWdlX2ludGVyZmFjZTogZnVuY3Rpb24oZG9tKXsKICAgIHZhciBzZWxmID0gdGhpczsKCiAgICBpZiAodGhpcy5wYXJhbS5sZW5ndGgpIHsKICAgICAgZG9tLmgoJ1VzYWdlJywgZnVuY3Rpb24oKSB7CiAgICAgICAgZG9tLmNvZGUoZnVuY3Rpb24oKSB7CiAgICAgICAgICBkb20udGV4dChzZWxmLm5hbWUuc3BsaXQoJy4nKS5wb3AoKSk7CiAgICAgICAgICBkb20udGV4dCgnKCcpOwogICAgICAgICAgc2VsZi5wYXJhbWV0ZXJzKGRvbSwgJywgJyk7CiAgICAgICAgICBkb20udGV4dCgnKTsnKTsKICAgICAgICB9KTsKCiAgICAgICAgc2VsZi5odG1sX3VzYWdlX3BhcmFtZXRlcnMoZG9tKTsKICAgICAgICBzZWxmLmh0bWxfdXNhZ2VfdGhpcyhkb20pOwogICAgICAgIHNlbGYuaHRtbF91c2FnZV9yZXR1cm5zKGRvbSk7CiAgICAgIH0pOwogICAgfQogICAgdGhpcy5tZXRob2RfcHJvcGVydGllc19ldmVudHMoZG9tKTsKICB9LAoKICBodG1sX3VzYWdlX3NlcnZpY2U6IGZ1bmN0aW9uKGRvbSkgewogICAgdGhpcy5odG1sX3VzYWdlX2ludGVyZmFjZShkb20pCiAgfSwKCiAgaHRtbF91c2FnZV9vYmplY3Q6IGZ1bmN0aW9uKGRvbSkgewogICAgdGhpcy5odG1sX3VzYWdlX2ludGVyZmFjZShkb20pCiAgfSwKCiAgbWV0aG9kX3Byb3BlcnRpZXNfZXZlbnRzOiBmdW5jdGlvbihkb20pIHsKICAgIHZhciBzZWxmID0gdGhpczsKICAgIGlmIChzZWxmLm1ldGhvZHMubGVuZ3RoKSB7CiAgICAgIGRvbS5kaXYoe2NsYXNzOidtZW1iZXIgbWV0aG9kJ30sIGZ1bmN0aW9uKCl7CiAgICAgICAgZG9tLmgoJ01ldGhvZHMnLCBzZWxmLm1ldGhvZHMsIGZ1bmN0aW9uKG1ldGhvZCl7CiAgICAgICAgICB2YXIgc2lnbmF0dXJlID0gKG1ldGhvZC5wYXJhbSB8fCBbXSkubWFwKHByb3BlcnR5KCduYW1lJykpOwogICAgICAgICAgZG9tLmgobWV0aG9kLnNob3J0TmFtZSArICcoJyArIHNpZ25hdHVyZS5qb2luKCcsICcpICsgJyknLCBtZXRob2QsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICBkb20uaHRtbChtZXRob2QuZGVzY3JpcHRpb24pOwogICAgICAgICAgICBtZXRob2QuaHRtbF91c2FnZV9wYXJhbWV0ZXJzKGRvbSk7CiAgICAgICAgICAgIHNlbGYuaHRtbF91c2FnZV90aGlzKGRvbSk7CiAgICAgICAgICAgIG1ldGhvZC5odG1sX3VzYWdlX3JldHVybnMoZG9tKTsKCiAgICAgICAgICAgIGRvbS5oKCdFeGFtcGxlJywgbWV0aG9kLmV4YW1wbGUsIGRvbS5odG1sKTsKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KICAgIGlmIChzZWxmLnByb3BlcnRpZXMubGVuZ3RoKSB7CiAgICAgIGRvbS5kaXYoe2NsYXNzOidtZW1iZXIgcHJvcGVydHknfSwgZnVuY3Rpb24oKXsKICAgICAgICBkb20uaCgnUHJvcGVydGllcycsIHNlbGYucHJvcGVydGllcywgZnVuY3Rpb24ocHJvcGVydHkpewogICAgICAgICAgZG9tLmgocHJvcGVydHkuc2hvcnROYW1lLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgZG9tLmh0bWwocHJvcGVydHkuZGVzY3JpcHRpb24pOwogICAgICAgICAgICBpZiAoIXByb3BlcnR5Lmh0bWxfdXNhZ2VfcmV0dXJucykgewogICAgICAgICAgICAgIGNvbnNvbGUubG9nKHByb3BlcnR5KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBwcm9wZXJ0eS5odG1sX3VzYWdlX3JldHVybnMoZG9tKTsKICAgICAgICAgICAgZG9tLmgoJ0V4YW1wbGUnLCBwcm9wZXJ0eS5leGFtcGxlLCBkb20uaHRtbCk7CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CiAgICBpZiAoc2VsZi5ldmVudHMubGVuZ3RoKSB7CiAgICAgIGRvbS5kaXYoe2NsYXNzOidtZW1iZXIgZXZlbnQnfSwgZnVuY3Rpb24oKXsKICAgICAgICBkb20uaCgnRXZlbnRzJywgc2VsZi5ldmVudHMsIGZ1bmN0aW9uKGV2ZW50KXsKICAgICAgICAgIGRvbS5oKGV2ZW50LnNob3J0TmFtZSwgZXZlbnQsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICBkb20uaHRtbChldmVudC5kZXNjcmlwdGlvbik7CiAgICAgICAgICAgIGlmIChldmVudC50eXBlID09ICdsaXN0ZW4nKSB7CiAgICAgICAgICAgICAgZG9tLnRhZygnZGl2Jywge2NsYXNzOidpbmxpbmUnfSwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBkb20uaCgnTGlzdGVuIG9uOicsIGV2ZW50LnRhcmdldCk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgZG9tLnRhZygnZGl2Jywge2NsYXNzOidpbmxpbmUnfSwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBkb20uaCgnVHlwZTonLCBldmVudC50eXBlKTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBkb20udGFnKCdkaXYnLCB7Y2xhc3M6J2lubGluZSd9LCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGRvbS5oKCdUYXJnZXQ6JywgZXZlbnQudGFyZ2V0KTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBldmVudC5odG1sX3VzYWdlX3BhcmFtZXRlcnMoZG9tKTsKICAgICAgICAgICAgc2VsZi5odG1sX3VzYWdlX3RoaXMoZG9tKTsKCiAgICAgICAgICAgIGRvbS5oKCdFeGFtcGxlJywgZXZlbnQuZXhhbXBsZSwgZG9tLmh0bWwpOwogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogIH0sCgogIHBhcmFtZXRlcnM6IGZ1bmN0aW9uKGRvbSwgc2VwYXJhdG9yLCBza2lwRmlyc3QsIHByZWZpeCkgewogICAgdmFyIHNlcCA9IHByZWZpeCA/IHNlcGFyYXRvciA6ICcnOwogICAgKHRoaXMucGFyYW18fFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHBhcmFtLCBpKXsKICAgICAgaWYgKCEoc2tpcEZpcnN0ICYmIGk9PTApKSB7CiAgICAgICAgaWYgKHBhcmFtLm9wdGlvbmFsKSB7CiAgICAgICAgICBkb20udGV4dCgnWycgKyBzZXAgKyBwYXJhbS5uYW1lICsgJ10nKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZG9tLnRleHQoc2VwICsgcGFyYW0ubmFtZSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHNlcCA9IHNlcGFyYXRvcjsKICAgIH0pOwogIH0KCn07Ci8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCgovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCnZhciBHTE9CQUxTID0gL15hbmd1bGFyXC4oW15cLl0rKSQvLAogICAgTU9EVUxFID0gL14oKD86KD8hXmFuZ3VsYXJcLilbXlwuXSkrKSQvLAogICAgTU9EVUxFX01PQ0sgPSAvXmFuZ3VsYXJcLm1vY2tcLihbXlwuXSspJC8sCiAgICBNT0RVTEVfRElSRUNUSVZFID0gL14oKD86KD8hXmFuZ3VsYXJcLilbXlwuXSkrKVwuZGlyZWN0aXZlOihbXlwuXSspJC8sCiAgICBNT0RVTEVfRElSRUNUSVZFX0lOUFVUID0gL14oKD86KD8hXmFuZ3VsYXJcLilbXlwuXSkrKVwuZGlyZWN0aXZlOmlucHV0XC4oW15cLl0rKSQvLAogICAgTU9EVUxFX0ZJTFRFUiA9IC9eKCg/Oig/IV5hbmd1bGFyXC4pW15cLl0pKylcLmZpbHRlcjooW15cLl0rKSQvLAogICAgTU9EVUxFX1NFUlZJQ0UgPSAvXigoPzooPyFeYW5ndWxhclwuKVteXC5dKSspXC4oW15cLl0rPykoUHJvdmlkZXIpPyQvLAogICAgTU9EVUxFX1RZUEUgPSAvXigoPzooPyFeYW5ndWxhclwuKVteXC5dKSspXC4uK1wuKFtBLVpdW15cLl0rKSQvOwoKCmZ1bmN0aW9uIHRpdGxlKGRvYykgewogIGlmICghZG9jLm5hbWUpIHJldHVybiBkb2MubmFtZTsKICB2YXIgbWF0Y2gsCiAgICB0ZXh0ID0gZG9jLm5hbWU7CgogIHZhciBtYWtlVGl0bGUgPSBmdW5jdGlvbiAobmFtZSwgdHlwZSwgY29tcG9uZW50VHlwZSwgY29tcG9uZW50KSB7CiAgICAvLyBNYWtlcyB0aXRsZSBtYXJrdXAuCiAgICAvLyBtYWtlVGl0bGUoJ0ZvbycsICdkaXJlY3RpdmUnLCAnbW9kdWxlJywgJ25nJykgLT4KICAgIC8vICAgIEZvbyBpcyBhIGRpcmVjdGl2ZSBpbiBtb2R1bGUgbmcKICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgIHRoaXMudGFnKCdjb2RlJywgbmFtZSk7CiAgICAgIHRoaXMudGFnKCdkaXYnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhpcy50YWcoJ3NwYW4nLCB7Y2xhc3M6ICdoaW50J30sIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGlmICh0eXBlICYmIGNvbXBvbmVudCkgewogICAgICAgICAgICB0aGlzLnRleHQodHlwZSArICcgaW4gJyArIGNvbXBvbmVudFR5cGUgKyAnICcpOwogICAgICAgICAgICB0aGlzLnRhZygnY29kZScsIGNvbXBvbmVudCk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfTsKICB9OwoKICBpZiAoZG9jLm5nZG9jID09PSAnZXJyb3InKSB7CiAgICByZXR1cm4gbWFrZVRpdGxlKGRvYy5mdWxsTmFtZSwgJ2Vycm9yJywgJ2NvbXBvbmVudCcsIGRvYy5nZXRNaW5lcnJOYW1lc3BhY2UoKSk7CiAgfSBlbHNlIGlmICh0ZXh0ID09ICdhbmd1bGFyLk1vZHVsZScpIHsKICAgIHJldHVybiBtYWtlVGl0bGUoJ01vZHVsZScsICdUeXBlJywgJ21vZHVsZScsICduZycpOwogIH0gZWxzZSBpZiAobWF0Y2ggPSB0ZXh0Lm1hdGNoKEdMT0JBTFMpKSB7CiAgICByZXR1cm4gbWFrZVRpdGxlKCdhbmd1bGFyLicgKyBtYXRjaFsxXSwgJ0FQSScsICdtb2R1bGUnLCAnbmcnKTsKICB9IGVsc2UgaWYgKG1hdGNoID0gdGV4dC5tYXRjaChNT0RVTEUpKSB7CiAgICByZXR1cm4gbWFrZVRpdGxlKCcnLCAnJywgJ21vZHVsZScsIG1hdGNoWzFdKTsKICB9IGVsc2UgaWYgKG1hdGNoID0gdGV4dC5tYXRjaChNT0RVTEVfTU9DSykpIHsKICAgIHJldHVybiBtYWtlVGl0bGUoJ2FuZ3VsYXIubW9jay4nICsgbWF0Y2hbMV0sICdBUEknLCAnbW9kdWxlJywgJ25nJyk7CiAgfSBlbHNlIGlmIChtYXRjaCA9IHRleHQubWF0Y2goTU9EVUxFX0RJUkVDVElWRSkpIHsKICAgIHJldHVybiBtYWtlVGl0bGUobWF0Y2hbMl0sICdkaXJlY3RpdmUnLCAnbW9kdWxlJywgbWF0Y2hbMV0pOwogIH0gZWxzZSBpZiAobWF0Y2ggPSB0ZXh0Lm1hdGNoKE1PRFVMRV9ESVJFQ1RJVkVfSU5QVVQpKSB7CiAgICByZXR1cm4gbWFrZVRpdGxlKCdpbnB1dCBbJyArIG1hdGNoWzJdICsgJ10nLCAnZGlyZWN0aXZlJywgJ21vZHVsZScsIG1hdGNoWzFdKTsKICB9IGVsc2UgaWYgKG1hdGNoID0gdGV4dC5tYXRjaChNT0RVTEVfRklMVEVSKSkgewogICAgcmV0dXJuIG1ha2VUaXRsZShtYXRjaFsyXSwgJ2ZpbHRlcicsICdtb2R1bGUnLCBtYXRjaFsxXSk7CiAgfSBlbHNlIGlmIChtYXRjaCA9IHRleHQubWF0Y2goTU9EVUxFX1NFUlZJQ0UpKSB7CiAgICByZXR1cm4gbWFrZVRpdGxlKG1hdGNoWzJdICsgKG1hdGNoWzNdIHx8ICcnKSwgJ3NlcnZpY2UnLCAnbW9kdWxlJywgbWF0Y2hbMV0pOwogIH0gZWxzZSBpZiAobWF0Y2ggPSB0ZXh0Lm1hdGNoKE1PRFVMRV9UWVBFKSkgewogICAgcmV0dXJuIG1ha2VUaXRsZShtYXRjaFsyXSwgJ3R5cGUnLCAnbW9kdWxlJywgbWF0Y2hbMV0pOwogIH0KICByZXR1cm4gdGV4dDsKfQoKCmZ1bmN0aW9uIHNjZW5hcmlvcyhkb2NzKXsKICB2YXIgc3BlY3MgPSBbXTsKCiAgc3BlY3MucHVzaCgnZGVzY3JpYmUoImFuZ3VsYXIranFsaXRlIiwgZnVuY3Rpb24oKSB7Jyk7CiAgYXBwZW5kU3BlY3MoJ2luZGV4LW5vY2FjaGUuaHRtbCMhLycpOwogIHNwZWNzLnB1c2goJ30pOycpOwoKICBzcGVjcy5wdXNoKCcnKTsKICBzcGVjcy5wdXNoKCcnKTsKCiAgc3BlY3MucHVzaCgnZGVzY3JpYmUoImFuZ3VsYXIranF1ZXJ5IiwgZnVuY3Rpb24oKSB7Jyk7CiAgYXBwZW5kU3BlY3MoJ2luZGV4LWpxLW5vY2FjaGUuaHRtbCMhLycpOwogIHNwZWNzLnB1c2goJ30pOycpOwoKICByZXR1cm4gc3BlY3Muam9pbignXG4nKTsKCiAgZnVuY3Rpb24gYXBwZW5kU3BlY3ModXJsUHJlZml4KSB7CiAgICBkb2NzLmZvckVhY2goZnVuY3Rpb24oZG9jKXsKICAgICAgc3BlY3MucHVzaCgnICBkZXNjcmliZSgiJyArIGRvYy5zZWN0aW9uICsgJy8nICsgZG9jLmlkICsgJyIsIGZ1bmN0aW9uKCkgeycpOwogICAgICBzcGVjcy5wdXNoKCcgICAgYmVmb3JlRWFjaChmdW5jdGlvbigpIHsnKTsKICAgICAgc3BlY3MucHVzaCgnICAgICAgYnJvd3NlcigpLm5hdmlnYXRlVG8oIicgKyB1cmxQcmVmaXggKyBkb2Muc2VjdGlvbiArICcvJyArIGRvYy5pZCArICciKTsnKTsKICAgICAgc3BlY3MucHVzaCgnICAgIH0pOycpOwogICAgICBzcGVjcy5wdXNoKCcgICcpOwogICAgICBkb2Muc2NlbmFyaW9zLmZvckVhY2goZnVuY3Rpb24oc2NlbmFyaW8pewogICAgICAgIHNwZWNzLnB1c2goaW5kZW50Q29kZSh0cmltKHNjZW5hcmlvKSwgNCkpOwogICAgICAgIHNwZWNzLnB1c2goJycpOwogICAgICB9KTsKICAgICAgc3BlY3MucHVzaCgnfSk7Jyk7CiAgICAgIHNwZWNzLnB1c2goJycpOwogICAgfSk7CiAgfQp9CgoKLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwpmdW5jdGlvbiBtZXRhZGF0YShkb2NzKXsKICB2YXIgcGFnZXMgPSBbXTsKICBkb2NzLmZvckVhY2goZnVuY3Rpb24oZG9jKXsKICAgIHZhciBwYXRoID0gKGRvYy5uYW1lIHx8ICcnKS5zcGxpdCgvKFw6XHMqKS8pOwogICAgZm9yICggdmFyIGkgPSAxOyBpIDwgcGF0aC5sZW5ndGg7IGkrKykgewogICAgICBwYXRoLnNwbGljZShpLCAxKTsKICAgIH0KICAgIHZhciBzaG9ydE5hbWUgPSBwYXRoLnBvcCgpLnRyaW0oKTsKCiAgICBpZiAocGF0aC5wb3AoKSA9PSAnaW5wdXQnKSB7CiAgICAgIHNob3J0TmFtZSA9ICdpbnB1dCBbJyArIHNob3J0TmFtZSArICddJzsKICAgIH0KCiAgICBwYWdlcy5wdXNoKHsKICAgICAgc2VjdGlvbjogZG9jLnNlY3Rpb24sCiAgICAgIGlkOiBkb2MuaWQsCiAgICAgIG5hbWU6IHRpdGxlKGRvYyksCiAgICAgIHNob3J0TmFtZTogc2hvcnROYW1lLAogICAgICB0eXBlOiBkb2Mubmdkb2MsCiAgICAgIG1vZHVsZU5hbWU6IGRvYy5tb2R1bGVOYW1lLAogICAgICBzaG9ydERlc2NyaXB0aW9uOiBkb2Muc2hvcnREZXNjcmlwdGlvbigpLAogICAgICBrZXl3b3JkczogZG9jLmtleXdvcmRzKCkKICAgIH0pOwogIH0pOwogIHBhZ2VzLnNvcnQoc2lkZWJhclNvcnQpOwogIHJldHVybiBwYWdlczsKfQoKdmFyIEtFWVdPUkRfUFJJT1JJVFkgPSB7CiAgJy5pbmRleCc6IDEsCiAgJy5vdmVydmlldyc6IDEsCiAgJy5ib290c3RyYXAnOiAyLAogICcubXZjJzogMywKICAnLnNjb3Blcyc6IDQsCiAgJy5jb21waWxlcic6IDUsCiAgJy50ZW1wbGF0ZXMnOiA2LAogICcuc2VydmljZXMnOiA3LAogICcuZGknOiA4LAogICcudW5pdC10ZXN0aW5nJzogOSwKICAnLmRldl9ndWlkZSc6IDksCiAgJy5kZXZfZ3VpZGUub3ZlcnZpZXcnOiAxLAogICcuZGV2X2d1aWRlLmJvb3RzdHJhcCc6IDIsCiAgJy5kZXZfZ3VpZGUuYm9vdHN0cmFwLmF1dG9fYm9vdHN0cmFwJzogMSwKICAnLmRldl9ndWlkZS5ib290c3RyYXAubWFudWFsX2Jvb3RzdHJhcCc6IDIsCiAgJy5kZXZfZ3VpZGUubXZjJzogMywKICAnLmRldl9ndWlkZS5tdmMudW5kZXJzdGFuZGluZ19tb2RlbCc6IDEsCiAgJy5kZXZfZ3VpZGUubXZjLnVuZGVyc3RhbmRpbmdfY29udHJvbGxlcic6IDIsCiAgJy5kZXZfZ3VpZGUubXZjLnVuZGVyc3RhbmRpbmdfdmlldyc6IDMsCiAgJy5kZXZfZ3VpZGUuc2NvcGVzJzogNCwKICAnLmRldl9ndWlkZS5zY29wZXMudW5kZXJzdGFuZGluZ19zY29wZXMnOiAxLAogICcuZGV2X2d1aWRlLnNjb3Blcy5pbnRlcm5hbHMnOiAyLAogICcuZGV2X2d1aWRlLmNvbXBpbGVyJzogNSwKICAnLmRldl9ndWlkZS50ZW1wbGF0ZXMnOiA2LAogICcuZGV2X2d1aWRlLnNlcnZpY2VzJzogNywKICAnLmRldl9ndWlkZS5kaSc6IDgsCiAgJy5kZXZfZ3VpZGUudW5pdC10ZXN0aW5nJzogOQp9OwoKdmFyIEdVSURFX1BSSU9SSVRZID0gWwogICdpbnRyb2R1Y3Rpb24nLAogICdvdmVydmlldycsCiAgJ2NvbmNlcHRzJywKICAnZGV2X2d1aWRlLm12YycsCgogICdkZXZfZ3VpZGUubXZjLnVuZGVyc3RhbmRpbmdfY29udHJvbGxlcicsCiAgJ2Rldl9ndWlkZS5tdmMudW5kZXJzdGFuZGluZ19tb2RlbCcsCiAgJ2Rldl9ndWlkZS5tdmMudW5kZXJzdGFuZGluZ192aWV3JywKCiAgJ2Rldl9ndWlkZS5zZXJ2aWNlcy51bmRlcnN0YW5kaW5nX3NlcnZpY2VzJywKICAnZGV2X2d1aWRlLnNlcnZpY2VzLm1hbmFnaW5nX2RlcGVuZGVuY2llcycsCiAgJ2Rldl9ndWlkZS5zZXJ2aWNlcy5jcmVhdGluZ19zZXJ2aWNlcycsCiAgJ2Rldl9ndWlkZS5zZXJ2aWNlcy5pbmplY3RpbmdfY29udHJvbGxlcnMnLAogICdkZXZfZ3VpZGUuc2VydmljZXMudGVzdGluZ19zZXJ2aWNlcycsCiAgJ2Rldl9ndWlkZS5zZXJ2aWNlcy4kbG9jYXRpb24nLAogICdkZXZfZ3VpZGUuc2VydmljZXMnLAoKICAnZGF0YWJpbmRpbmcnLAogICdkZXZfZ3VpZGUudGVtcGxhdGVzLmNzcy1zdHlsaW5nJywKICAnZGV2X2d1aWRlLnRlbXBsYXRlcy5maWx0ZXJzLmNyZWF0aW5nX2ZpbHRlcnMnLAogICdkZXZfZ3VpZGUudGVtcGxhdGVzLmZpbHRlcnMnLAogICdkZXZfZ3VpZGUudGVtcGxhdGVzLmZpbHRlcnMudXNpbmdfZmlsdGVycycsCiAgJ2Rldl9ndWlkZS50ZW1wbGF0ZXMnLAoKICAnZGknLAogICdwcm92aWRlcnMnLAogICdtb2R1bGUnLAogICdzY29wZScsCiAgJ2V4cHJlc3Npb24nLAogICdib290c3RyYXAnLAogICdkaXJlY3RpdmUnLAogICdjb21waWxlcicsCgogICdmb3JtcycsCiAgJ2FuaW1hdGlvbnMnLAoKICAnZGV2X2d1aWRlLmUyZS10ZXN0aW5nJywKICAnZGV2X2d1aWRlLnVuaXQtdGVzdGluZycsCgogICdpMThuJywKICAnaWUnLAogICdtaWdyYXRpb24nLApdOwoKZnVuY3Rpb24gc2lkZWJhclNvcnQoYSwgYil7CiAgcHJpb3JpdHlBID0gR1VJREVfUFJJT1JJVFkuaW5kZXhPZihhLmlkKTsKICBwcmlvcml0eUIgPSBHVUlERV9QUklPUklUWS5pbmRleE9mKGIuaWQpOwoKICBpZiAocHJpb3JpdHlBID4gLTEgfHwgcHJpb3JpdHlCID4gLTEpIHsKICAgIHJldHVybiBwcmlvcml0eUEgPCBwcmlvcml0eUIgPyAtMSA6IChwcmlvcml0eUEgPiBwcmlvcml0eUIgPyAxIDogMCk7CiAgfQoKICBmdW5jdGlvbiBtYW5nbGVOYW1lKGRvYykgewogICAgdmFyIHBhdGggPSBkb2MuaWQuc3BsaXQoL1wuLyk7CiAgICB2YXIgbWFuZ2xlZCA9IFtdOwogICAgdmFyIHBhcnRpYWxOYW1lID0gJyc7CiAgICBwYXRoLmZvckVhY2goZnVuY3Rpb24obmFtZSl7CiAgICAgIHBhcnRpYWxOYW1lICs9ICcuJyArIG5hbWU7CiAgICAgIG1hbmdsZWQucHVzaChLRVlXT1JEX1BSSU9SSVRZW3BhcnRpYWxOYW1lXSB8fCA1KTsKICAgICAgbWFuZ2xlZC5wdXNoKG5hbWUpOwogICAgfSk7CiAgICByZXR1cm4gKGRvYy5zZWN0aW9uICsgJy8nICsgbWFuZ2xlZC5qb2luKCcuJykpLnRvTG93ZXJDYXNlKCk7CiAgfQogIHZhciBuYW1lQSA9IG1hbmdsZU5hbWUoYSk7CiAgdmFyIG5hbWVCID0gbWFuZ2xlTmFtZShiKTsKICByZXR1cm4gbmFtZUEgPCBuYW1lQiA/IC0xIDogKG5hbWVBID4gbmFtZUIgPyAxIDogMCk7Cn0KCgovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCmZ1bmN0aW9uIHRyaW0odGV4dCkgewogIHZhciBNQVhfSU5ERU5UID0gOTk5OTsKICB2YXIgZW1wdHkgPSBSZWdFeHAucHJvdG90eXBlLnRlc3QuYmluZCgvXlxzKiQvKTsKICB2YXIgbGluZXMgPSB0ZXh0LnNwbGl0KCdcbicpOwogIHZhciBtaW5JbmRlbnQgPSBNQVhfSU5ERU5UOwogIHZhciBpbmRlbnRSZWdFeHA7CiAgdmFyIGlnbm9yZUxpbmUgPSAobGluZXNbMF1bMF0gIT0gJyAnICAmJiBsaW5lcy5sZW5ndGggPiAxKTsKICAvLyBpZ25vcmUgZmlyc3QgbGluZSBpZiBpdCBoYXMgbm8gaW5kZW50YXRpb24gYW5kIHRoZXJlIGlzIG1vcmUgdGhhbiBvbmUgbGluZQoKICBsaW5lcy5mb3JFYWNoKGZ1bmN0aW9uKGxpbmUpewogICAgaWYgKGlnbm9yZUxpbmUpIHsKICAgICAgaWdub3JlTGluZSA9IGZhbHNlOwogICAgICByZXR1cm47CiAgICB9CgogICAgdmFyIGluZGVudCA9IGxpbmUubWF0Y2goL15ccyovKVswXS5sZW5ndGg7CiAgICBpZiAoaW5kZW50ID4gMCB8fCBtaW5JbmRlbnQgPT0gTUFYX0lOREVOVCkgewogICAgICBtaW5JbmRlbnQgPSBNYXRoLm1pbihtaW5JbmRlbnQsIGluZGVudCk7CiAgICB9CiAgfSk7CgogIGluZGVudFJlZ0V4cCA9IG5ldyBSZWdFeHAoJ15cXHN7MCwnICsgbWluSW5kZW50ICsgJ30nKTsKCiAgZm9yICggdmFyIGkgPSAwOyBpIDwgbGluZXMubGVuZ3RoOyBpKyspIHsKICAgIGxpbmVzW2ldID0gbGluZXNbaV0ucmVwbGFjZShpbmRlbnRSZWdFeHAsICcnKTsKICB9CgogIC8vIHJlbW92ZSBsZWFkaW5nIGxpbmVzCiAgd2hpbGUgKGVtcHR5KGxpbmVzWzBdKSkgewogICAgbGluZXMuc2hpZnQoKTsKICB9CgogIC8vIHJlbW92ZSB0cmFpbGluZwogIHdoaWxlIChlbXB0eShsaW5lc1tsaW5lcy5sZW5ndGggLSAxXSkpIHsKICAgIGxpbmVzLnBvcCgpOwogIH0KICByZXR1cm4gbGluZXMuam9pbignXG4nKTsKfQoKZnVuY3Rpb24gaW5kZW50Q29kZSh0ZXh0LCBzcGFjZUNvdW50KSB7CiAgdmFyIGxpbmVzID0gdGV4dC5zcGxpdCgnXG4nKSwKICAgIGluZGVudCA9ICcnLAogICAgZml4ZWRMaW5lcyA9IFtdOwoKICB3aGlsZShzcGFjZUNvdW50LS0pIGluZGVudCArPSAnICc7CgogIGxpbmVzLmZvckVhY2goZnVuY3Rpb24obGluZSkgewogICAgZml4ZWRMaW5lcy5wdXNoKGluZGVudCArIGxpbmUpOwogIH0pOwoKICByZXR1cm4gZml4ZWRMaW5lcy5qb2luKCdcbicpOwp9CgovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCmZ1bmN0aW9uIG1lcmdlKGRvY3MpewogIHZhciBieUZ1bGxJZCA9IHt9OwoKICBkb2NzLmZvckVhY2goZnVuY3Rpb24oZG9jKSB7CiAgICBieUZ1bGxJZFtkb2Muc2VjdGlvbiArICcvJyArIGRvYy5pZF0gPSBkb2M7CiAgfSk7CgogIGZvcih2YXIgaSA9IDA7IGkgPCBkb2NzLmxlbmd0aDspIHsKICAgIGlmIChmaW5kUGFyZW50KGRvY3NbaV0sICdtZXRob2QnKSB8fCBmaW5kUGFyZW50KGRvY3NbaV0sICdwcm9wZXJ0eScpIHx8IGZpbmRQYXJlbnQoZG9jc1tpXSwgJ2V2ZW50JykpIHsKICAgICAgZG9jcy5zcGxpY2UoaSwgMSk7CiAgICB9IGVsc2UgewogICAgICBpKys7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBmaW5kUGFyZW50KGRvYywgbmFtZSkgewogICAgdmFyIHBhcmVudE5hbWUgPSBkb2NbbmFtZSArICdPZiddOwogICAgaWYgKCFwYXJlbnROYW1lKSByZXR1cm4gZmFsc2U7CgogICAgdmFyIHBhcmVudCA9IGJ5RnVsbElkWydhcGkvJyArIHBhcmVudE5hbWVdOwogICAgaWYgKCFwYXJlbnQpCiAgICAgIHRocm93IG5ldyBFcnJvcigiTm8gcGFyZW50IG5hbWVkICciICsgcGFyZW50TmFtZSArICInIGZvciAnIiArCiAgICAgICAgZG9jLm5hbWUgKyAiJyBpbiBAIiArIG5hbWUgKyAiT2YuIik7CgogICAgdmFyIGxpc3ROYW1lID0gKG5hbWUgKyAncycpLnJlcGxhY2UoL3lzJC8sICdpZXMnKTsKICAgIHZhciBsaXN0ID0gcGFyZW50W2xpc3ROYW1lXSA9IChwYXJlbnRbbGlzdE5hbWVdIHx8IFtdKTsKICAgIGxpc3QucHVzaChkb2MpOwogICAgbGlzdC5zb3J0KG9yZGVyQnlOYW1lKTsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgZnVuY3Rpb24gb3JkZXJCeU5hbWUoYSwgYil7CiAgICByZXR1cm4gYS5uYW1lIDwgYi5uYW1lID8gLTEgOiAoYS5uYW1lID4gYi5uYW1lID8gMSA6IDApOwogIH0KfQovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgoKZnVuY3Rpb24gY2hlY2tCcm9rZW5MaW5rcyhkb2NzKSB7CiAgdmFyIGJ5RnVsbElkID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKCiAgZG9jcy5mb3JFYWNoKGZ1bmN0aW9uKGRvYykgewogICAgYnlGdWxsSWRbZG9jLnNlY3Rpb24gKyAnLycgKyBkb2MuaWRdID0gZG9jOwogICAgaWYgKGRvYy5zZWN0aW9uID09PSAnYXBpJykgewogICAgICBkb2MuYW5jaG9ycy5wdXNoKCdkaXJlY3RpdmUnLCAnc2VydmljZScsICdmaWx0ZXInLCAnZnVuY3Rpb24nKTsKICAgIH0KICB9KTsKCiAgZG9jcy5mb3JFYWNoKGZ1bmN0aW9uKGRvYykgewogICAgZG9jLmxpbmtzLmZvckVhY2goZnVuY3Rpb24obGluaykgewogICAgICAvLyBjb252ZXJ0ICNpZCB0byBwYXRoI2lkCiAgICAgIGlmIChsaW5rWzBdID09ICcjJykgewogICAgICAgIGxpbmsgPSBkb2Muc2VjdGlvbiArICcvJyArIGRvYy5pZC5zcGxpdCgnIycpLnNoaWZ0KCkgKyBsaW5rOwogICAgICB9CgogICAgICB2YXIgcGFydHMgPSBsaW5rLnNwbGl0KCcjJyk7CiAgICAgIHZhciBwYWdlTGluayA9IHBhcnRzWzBdOwogICAgICB2YXIgYW5jaG9yTGluayA9IHBhcnRzWzFdOwogICAgICB2YXIgbGlua2VkUGFnZSA9IGJ5RnVsbElkW3BhZ2VMaW5rXTsKCiAgICAgIGlmICghbGlua2VkUGFnZSkgewogICAgICAgIGNvbnNvbGUubG9nKCdXQVJOSU5HOiAnICsgZG9jLnNlY3Rpb24gKyAnLycgKyBkb2MuaWQgKyAnIChkZWZpbmVkIGluICcgKyBkb2MuZmlsZSArICcpIHBvaW50cyB0byBhIG5vbiBleGlzdGluZyBwYWdlICInICsgbGluayArICciIScpOwogICAgICB9IGVsc2UgaWYgKGFuY2hvckxpbmsgJiYgbGlua2VkUGFnZS5hbmNob3JzLmluZGV4T2YoYW5jaG9yTGluaykgPT09IC0xKSB7CiAgICAgICAgY29uc29sZS5sb2coJ1dBUk5JTkc6ICcgKyBkb2Muc2VjdGlvbiArICcvJyArIGRvYy5pZCArICcgKGRlZmluZWQgaW4gJyArIGRvYy5maWxlICsgJykgcG9pbnRzIHRvIGEgbm9uIGV4aXN0aW5nIGFuY2hvciAiJyArIGxpbmsgKyAnIiEnKTsKICAgICAgfQogICAgfSk7CiAgfSk7Cn0KCgpmdW5jdGlvbiBwcm9wZXJ0eShuYW1lKSB7CiAgcmV0dXJuIGZ1bmN0aW9uKHZhbHVlKXsKICAgIHJldHVybiB2YWx1ZVtuYW1lXTsKICB9Owp9CgoKdmFyIERBU0hfQ0FTRV9SRUdFWFAgPSAvW0EtWl0vZzsKZnVuY3Rpb24gZGFzaENhc2UobmFtZSl7CiAgcmV0dXJuIG5hbWUucmVwbGFjZShEQVNIX0NBU0VfUkVHRVhQLCBmdW5jdGlvbihsZXR0ZXIsIHBvcykgewogICAgcmV0dXJuIChwb3MgPyAnLScgOiAnJykgKyBsZXR0ZXIudG9Mb3dlckNhc2UoKTsKICB9KTsKfQovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgpmdW5jdGlvbiBleHBsYWluTW9kdWxlSW5zdGFsbGF0aW9uKG1vZHVsZU5hbWUpewogIHZhciBuZ01vZCA9IG5nTW9kdWxlKG1vZHVsZU5hbWUpLAogICAgbW9kdWxlUGFja2FnZSA9ICdhbmd1bGFyLScgKyBtb2R1bGVOYW1lLAogICAgbW9kdWxlUGFja2FnZUZpbGUgPSBtb2R1bGVQYWNrYWdlICsgJy5qcyc7CgogIHJldHVybiAnPGgxPkluc3RhbGxhdGlvbjwvaDE+JyArCiAgICAnPHA+Rmlyc3QgaW5jbHVkZSA8Y29kZT4nICsgbW9kdWxlUGFja2FnZUZpbGUgKyc8L2NvZGU+IGluIHlvdXIgSFRNTDo8L3A+PHByZT48Y29kZT4nICsKICAgICcgICAgJmx0O3NjcmlwdCBzcmM9JnF1b3Q7YW5ndWxhci5qcyZxdW90OyZndDtcbicgKwogICAgJyAgICAmbHQ7c2NyaXB0IHNyYz0mcXVvdDsnICsgbW9kdWxlUGFja2FnZUZpbGUgKyAnJnF1b3Q7Jmd0OzwvcHJlPjwvY29kZT4nICsKCiAgICAnPHA+WW91IGNhbiBkb3dubG9hZCB0aGlzIGZpbGUgZnJvbSB0aGUgZm9sbG93aW5nIHBsYWNlczo8L3A+JyArCiAgICAnPHVsPicgKwogICAgICAnPGxpPltHb29nbGUgQ0ROXShodHRwczovL2RldmVsb3BlcnMuZ29vZ2xlLmNvbS9zcGVlZC9saWJyYXJpZXMvZGV2Z3VpZGUjYW5ndWxhcmpzKTxicj4nICsKICAgICAgICAnZS5nLiA8Y29kZT4iLy9hamF4Lmdvb2dsZWFwaXMuY29tL2FqYXgvbGlicy9hbmd1bGFyanMvWC5ZLlovJyArIG1vZHVsZVBhY2thZ2VGaWxlICsgJyI8L2NvZGU+PC9saT4nICsKICAgICAgJzxsaT5bQm93ZXJdKGh0dHA6Ly9ib3dlci5pbyk8YnI+JyArCiAgICAgICAnZS5nLiA8Y29kZT5ib3dlciBpbnN0YWxsICcgKyBtb2R1bGVQYWNrYWdlICsgJ0BYLlkuWjwvY29kZT48L2xpPicgKwogICAgICAnPGxpPjxhIGhyZWY9Imh0dHA6Ly9jb2RlLmFuZ3VsYXJqcy5vcmcvIj5jb2RlLmFuZ3VsYXJqcy5vcmc8L2E+PGJyPicgKwogICAgICAgICdlLmcuIDxjb2RlPiIvL2NvZGUuYW5ndWxhcmpzLm9yZy9YLlkuWi8nICsgbW9kdWxlUGFja2FnZUZpbGUgKyAnIjwvY29kZT48L2xpPicgKwogICAgJzwvdWw+JyArCiAgICAnPHA+d2hlcmUgWC5ZLlogaXMgdGhlIEFuZ3VsYXJKUyB2ZXJzaW9uIHlvdSBhcmUgcnVubmluZy48L3A+JyArCiAgICAnPHA+VGhlbiBsb2FkIHRoZSBtb2R1bGUgaW4geW91ciBhcHBsaWNhdGlvbiBieSBhZGRpbmcgaXQgYXMgYSBkZXBlbmRlbnQgbW9kdWxlOjwvcD48cHJlPjxjb2RlPicgKwogICAgJyAgICBhbmd1bGFyLm1vZHVsZShcJ2FwcFwnLCBbXCcnICsgbmdNb2QgKyAnXCddKTs8L3ByZT48L2NvZGU+JyArCgogICAgJzxwPldpdGggdGhhdCB5b3VcJ3JlIHJlYWR5IHRvIGdldCBzdGFydGVkITwvcD4nOwp9CgpmdW5jdGlvbiBuZ01vZHVsZShtb2R1bGVOYW1lKSB7CiAgcmV0dXJuICduZycgKyBtb2R1bGVOYW1lWzBdLnRvVXBwZXJDYXNlKCkgKyBtb2R1bGVOYW1lLnN1YnN0cigxKTsKfQo=",
                "body": "LyoqCiAqIEFsbCBwYXJzaW5nL3RyYW5zZm9ybWF0aW9uIGNvZGUgZ29lcyBoZXJlLiBBbGwgY29kZSBoZXJlIHNob3VsZCBiZSBzeW5jIHRvIGVhc2UgdGVzdGluZy4KICovCnZhciBET00gPSByZXF1aXJlKCcuL2RvbS5qcycpLkRPTTsKdmFyIGh0bWxFc2NhcGUgPSByZXF1aXJlKCcuL2RvbS5qcycpLmh0bWxFc2NhcGU7CnZhciBFeGFtcGxlID0gcmVxdWlyZSgnLi9leGFtcGxlLmpzJykuRXhhbXBsZTsKdmFyIE5FV19MSU5FID0gL1xuXHI/LzsKdmFyIGdsb2JhbElEID0gMDsKdmFyIGZzID0gcmVxdWlyZSgnZnMnKTsKdmFyIGZzcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKTsKdmFyIHNoZWxsID0gcmVxdWlyZSgnc2hlbGxqcycpOwp2YXIgZ3J1bnRVdGlsID0gcmVxdWlyZSgnLi4vLi4vbGliL2dydW50L3V0aWxzLmpzJyk7CnZhciBlcnJvcnNKc29uOwp2YXIgbWFya2VkID0gcmVxdWlyZSgnbWFya2VkJyk7Cm1hcmtlZC5zZXRPcHRpb25zKHsKICBnZm06IHRydWUsCiAgdGFibGVzOiB0cnVlCn0pOwoKdmFyIGxvb2t1cE1pbmVyck1zZyA9IGZ1bmN0aW9uIChkb2MpIHsKICB2YXIgY29kZSwgbmFtZXNwYWNlOwoKICBpZiAoZXJyb3JzSnNvbiA9PT0gdW5kZWZpbmVkKSB7CiAgICBlcnJvcnNKc29uID0gcmVxdWlyZSgnLi4vLi4vYnVpbGQvZXJyb3JzLmpzb24nKS5lcnJvcnM7CiAgfQoKICBuYW1lc3BhY2UgPSBkb2MuZ2V0TWluZXJyTmFtZXNwYWNlKCk7CiAgY29kZSA9IGRvYy5nZXRNaW5lcnJDb2RlKCk7CiAgaWYgKG5hbWVzcGFjZSA9PT0gdW5kZWZpbmVkKSB7CiAgICByZXR1cm4gZXJyb3JzSnNvbltjb2RlXTsKICB9CiAgcmV0dXJuIGVycm9yc0pzb25bbmFtZXNwYWNlXVtjb2RlXTsKfTsKCmV4cG9ydHMudHJpbSA9IHRyaW07CmV4cG9ydHMubWV0YWRhdGEgPSBtZXRhZGF0YTsKZXhwb3J0cy5zY2VuYXJpb3MgPSBzY2VuYXJpb3M7CmV4cG9ydHMubWVyZ2UgPSBtZXJnZTsKZXhwb3J0cy5jaGVja0Jyb2tlbkxpbmtzID0gY2hlY2tCcm9rZW5MaW5rczsKZXhwb3J0cy5Eb2MgPSBEb2M7CgpleHBvcnRzLm5nVmVyc2lvbnMgPSBmdW5jdGlvbigpIHsKICB2YXIgdmVyc2lvbnMgPSBbXSwgcmVnZXggPSAvXnYoWzEtOV1cZCooPzpcLlxkK1xTKykrKSQvOyAvL29ubHkgZmV0Y2ggPj0gMS4wLjAgdmVyc2lvbnMKICBzaGVsbC5leGVjKCdnaXQgdGFnJywge3NpbGVudDogdHJ1ZX0pLm91dHB1dC5zcGxpdCgvXHMqXG5ccyovKQogICAgLmZvckVhY2goZnVuY3Rpb24obGluZSkgewogICAgICB2YXIgbWF0Y2hlcyA9IHJlZ2V4LmV4ZWMobGluZSk7CiAgICAgIGlmKG1hdGNoZXMgJiYgbWF0Y2hlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgdmVyc2lvbnMucHVzaChtYXRjaGVzWzFdKTsKICAgICAgfQogICAgfSk7CgogIC8vbWF0Y2ggdGhlIGZ1dHVyZSB2ZXJzaW9uIG9mIEFuZ3VsYXJKUyB0aGF0IGlzIHNldCBpbiB0aGUgcGFja2FnZS5qc29uIGZpbGUKICByZXR1cm4gZXhwYW5kVmVyc2lvbnMoc29ydFZlcnNpb25zTmF0cnVhbGx5KHZlcnNpb25zKSwgZXhwb3J0cy5uZ0N1cnJlbnRWZXJzaW9uKCkuZnVsbCk7CgogIGZ1bmN0aW9uIGV4cGFuZFZlcnNpb25zKHZlcnNpb25zLCBsYXRlc3RWZXJzaW9uKSB7CiAgICB2YXIgUkNfVkVSU0lPTiA9IC9yY1xkLzsKICAgIC8vY29weSB0aGUgYXJyYXkgdG8gYXZvaWQgY2hhbmdpbmcgdGhlIHZlcnNpb25zIHBhcmFtIGRhdGEKICAgIC8vdGhlIGxhdGVzdCB2ZXJzaW9uIGlzIG5vdCBvbiB0aGUgZ2l0IHRhZ3MgbGlzdCwgYnV0CiAgICAvL2RvY3MuYW5ndWxhcmpzLm9yZyB3aWxsIGFsd2F5cyBwb2ludCB0byBtYXN0ZXIgYXMgb2YgMS4yCiAgICB2ZXJzaW9ucyA9IHZlcnNpb25zLmNvbmNhdChbbGF0ZXN0VmVyc2lvbl0pOwoKICAgIHZhciBmaXJzdFVuc3RhYmxlLCBleHBhbmRlZCA9IFtdOwogICAgZm9yKHZhciBpPXZlcnNpb25zLmxlbmd0aC0xO2k+PTA7aS0tKSB7CiAgICAgIHZhciB2ZXJzaW9uID0gdmVyc2lvbnNbaV0sCiAgICAgICAgICBzcGxpdCA9IHZlcnNpb24uc3BsaXQoJy4nKSwKICAgICAgICAgIGlzTWFzdGVyID0gdmVyc2lvbiA9PSBsYXRlc3RWZXJzaW9uLAogICAgICAgICAgaXNTdGFibGUgPSBzcGxpdFsxXSAlIDIgPT09IDAgJiYgIVJDX1ZFUlNJT04udGVzdCh2ZXJzaW9uKTsKCiAgICAgIHZhciB0aXRsZSA9ICdBbmd1bGFySlMgLSB2JyArIHZlcnNpb247CgogICAgICB2YXIgZG9jc1BhdGggPSB2ZXJzaW9uIDwgJzEuMC4yJyA/ICAnZG9jcy0nICsgdmVyc2lvbiA6ICdkb2NzJzsKCiAgICAgIHZhciB1cmwgPSBpc01hc3RlciA/CiAgICAgICAgJ2h0dHA6Ly9kb2NzLmFuZ3VsYXJqcy5vcmcnIDoKICAgICAgICAnaHR0cDovL2NvZGUuYW5ndWxhcmpzLm9yZy8nICsgdmVyc2lvbiArICcvJyArIGRvY3NQYXRoOwoKICAgICAgZXhwYW5kZWQucHVzaCh7CiAgICAgICAgdmVyc2lvbiA6IHZlcnNpb24sCiAgICAgICAgc3RhYmxlIDogaXNTdGFibGUsCiAgICAgICAgdGl0bGUgOiB0aXRsZSwKICAgICAgICBncm91cCA6IChpc1N0YWJsZSA/ICdTdGFibGUnIDogJ1Vuc3RhYmxlJyksCiAgICAgICAgdXJsIDogdXJsCiAgICAgIH0pOwogICAgfTsKCiAgICByZXR1cm4gZXhwYW5kZWQ7CiAgfTsKCiAgZnVuY3Rpb24gc29ydFZlcnNpb25zTmF0cnVhbGx5KHZlcnNpb25zKSB7CiAgICB2YXIgdmVyc2lvbk1hcCA9IHt9LAogICAgICAgIE5PTl9SQ19SRUxFQVNFX05VTUJFUiA9IDk5OTsKICAgIGZvcih2YXIgaSA9IHZlcnNpb25zLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgIHZhciB2ZXJzaW9uID0gdmVyc2lvbnNbaV07CiAgICAgIHZhciBzcGxpdCA9IHZlcnNpb24uc3BsaXQoL1wufHJjLyk7CiAgICAgICB2YXIgYmFzZVZlcnNpb24gPSBzcGxpdFswXSArICcuJyArIHNwbGl0WzFdICsgJy4nICsgc3BsaXRbMl07CgogICAgICAvL2NyZWF0ZSBhIG1hcCBvZiBSQyB2ZXJzaW9ucyBmb3IgZWFjaCB2ZXJzaW9uCiAgICAgIC8vdGhpcyB3YXkgZWFjaCBSQyB2ZXJzaW9uIGNhbiBiZSBzb3J0ZWQgaW4gIm5hdHVyYWwiIG9yZGVyCiAgICAgIHZlcnNpb25NYXBbYmFzZVZlcnNpb25dID0gdmVyc2lvbk1hcFtiYXNlVmVyc2lvbl0gfHwgW107CgogICAgICAvL05PTl9SQ19SRUxFQVNFX05VTUJFUiBpcyB1c2VkIHRvIHNpZ25hbCB0aGUgbm9uLVJDIHZlcnNpb24gZm9yIHRoZSByZWxlYXNlIGFuZAogICAgICAvL2l0IHdpbGwgYWx3YXlzIGFwcGVhciBhdCB0aGUgdG9wIG9mIHRoZSBsaXN0IHNpbmNlIHRoZSBudW1iZXIgaXMgc28gaGlnaCEKICAgICAgdmVyc2lvbk1hcFtiYXNlVmVyc2lvbl0ucHVzaCgKICAgICAgICB2ZXJzaW9uID09IGJhc2VWZXJzaW9uID8gTk9OX1JDX1JFTEVBU0VfTlVNQkVSIDogcGFyc2VJbnQodmVyc2lvbi5tYXRjaCgvcmNcLj8oXGQrKS8pWzFdKSk7CiAgICB9OwoKICAgIC8vZmxhdHRlbiB0aGUgbWFwIHNvIHRoYXQgdGhlIFJDIHZlcnNpb25zIG9jY3VyIGluIGEgbmF0dXJhbCBzb3J0ZWQgb3JkZXIKICAgIC8vYW5kIHRoZSBvZmZpY2lhbCBub24tUkMgdmVyc2lvbiBzaG93cyB1cCBhdCB0aGUgdG9wIG9mIHRoZSBsaXN0IG9mIHNvcnRlZAogICAgLy9SQyB2ZXJzaW9ucyEKICAgIHZhciBhbmd1bGFyVmVyc2lvbnMgPSBbXTsKICAgIHNvcnRlZEtleXModmVyc2lvbk1hcCkuZm9yRWFjaChmdW5jdGlvbihrZXkpIHsKICAgICAgdmFyIHZlcnNpb25zID0gdmVyc2lvbk1hcFtrZXldOwoKICAgICAgLy9iYXNpYyBudW1lcmljYWwgc29ydAogICAgICB2ZXJzaW9ucy5zb3J0KGZ1bmN0aW9uKGEsYikgewogICAgICAgIHJldHVybiBhIC0gYjsKICAgICAgfSk7CgogICAgICB2ZXJzaW9ucy5mb3JFYWNoKGZ1bmN0aW9uKHYpIHsKICAgICAgICBhbmd1bGFyVmVyc2lvbnMucHVzaCh2ID09IE5PTl9SQ19SRUxFQVNFX05VTUJFUiA/IGtleSA6IGtleSArICdyYycgKyB2KTsKICAgICAgfSk7CiAgICB9KTsKCiAgICByZXR1cm4gYW5ndWxhclZlcnNpb25zOwogIH07CgogIGZ1bmN0aW9uIHNvcnRlZEtleXMob2JqKSB7CiAgICB2YXIga2V5cyA9IFtdOwogICAgZm9yKHZhciBrZXkgaW4gb2JqKSB7CiAgICAgIGtleXMucHVzaChrZXkpOwogICAgfTsKICAgIGtleXMuc29ydCh0cnVlKTsKICAgIHJldHVybiBrZXlzOwogIH07Cn07CgpleHBvcnRzLm5nQ3VycmVudFZlcnNpb24gPSBmdW5jdGlvbigpIHsKICByZXR1cm4gZ3J1bnRVdGlsLmdldFZlcnNpb24oKTsKfTsKCnZhciBCT09MRUFOX0FUVFIgPSB7fTsKWydtdWx0aXBsZScsICdzZWxlY3RlZCcsICdjaGVja2VkJywgJ2Rpc2FibGVkJywgJ3JlYWRPbmx5JywgJ3JlcXVpcmVkJ10uZm9yRWFjaChmdW5jdGlvbih2YWx1ZSkgewogIEJPT0xFQU5fQVRUUlt2YWx1ZV0gPSB0cnVlOwp9KTsKCi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KZnVuY3Rpb24gRG9jKHRleHQsIGZpbGUsIGxpbmUpIHsKICBpZiAodHlwZW9mIHRleHQgPT0gJ29iamVjdCcpIHsKICAgIGZvciAoIHZhciBrZXkgaW4gdGV4dCkgewogICAgICB0aGlzW2tleV0gPSB0ZXh0W2tleV07CiAgICB9CiAgfSBlbHNlIHsKICAgIHRoaXMudGV4dCA9IHRleHQ7CiAgICB0aGlzLmZpbGUgPSBmaWxlOwogICAgdGhpcy5saW5lID0gbGluZTsKICB9CiAgdGhpcy5zY2VuYXJpb3MgPSB0aGlzLnNjZW5hcmlvcyB8fCBbXTsKICB0aGlzLnJlcXVpcmVzID0gdGhpcy5yZXF1aXJlcyB8fCBbXTsKICB0aGlzLnBhcmFtID0gdGhpcy5wYXJhbSB8fCBbXTsKICB0aGlzLnByb3BlcnRpZXMgPSB0aGlzLnByb3BlcnRpZXMgfHwgW107CiAgdGhpcy5tZXRob2RzID0gdGhpcy5tZXRob2RzIHx8IFtdOwogIHRoaXMuZXZlbnRzID0gdGhpcy5ldmVudHMgfHwgW107CiAgdGhpcy5saW5rcyA9IHRoaXMubGlua3MgfHwgW107CiAgdGhpcy5hbmNob3JzID0gdGhpcy5hbmNob3JzIHx8IFtdOwp9CkRvYy5NRVRBREFUQV9JR05PUkUgPSAoZnVuY3Rpb24oKSB7CiAgdmFyIHdvcmRzID0gZnMucmVhZEZpbGVTeW5jKF9fZGlybmFtZSArICcvaWdub3JlLndvcmRzJywgJ3V0ZjgnKTsKICByZXR1cm4gd29yZHMudG9TdHJpbmcoKS5zcGxpdCgvWyxcc1xuXHJdKy9nbSk7Cn0pKCk7CgoKRG9jLnByb3RvdHlwZSA9IHsKICBrZXl3b3JkczogZnVuY3Rpb24ga2V5d29yZHMoKSB7CiAgICB2YXIga2V5d29yZHMgPSB7fTsKICAgIHZhciB3b3JkcyA9IFtdOwogICAgRG9jLk1FVEFEQVRBX0lHTk9SRS5mb3JFYWNoKGZ1bmN0aW9uKGlnbm9yZSl7IGtleXdvcmRzW2lnbm9yZV0gPSB0cnVlOyB9KTsKCiAgICBmdW5jdGlvbiBleHRyYWN0V29yZHModGV4dCkgewogICAgICB2YXIgdG9rZW5zID0gdGV4dC50b0xvd2VyQ2FzZSgpLnNwbGl0KC9bXC5ccyxgJyIjXSsvbWcpOwogICAgICB0b2tlbnMuZm9yRWFjaChmdW5jdGlvbihrZXkpewogICAgICAgIHZhciBtYXRjaCA9IGtleS5tYXRjaCgvXigobmc6fFtcJF9hLXpdKVtcd1wtX10rKS8pOwogICAgICAgIGlmIChtYXRjaCl7CiAgICAgICAgICBrZXkgPSBtYXRjaFsxXTsKICAgICAgICAgIGlmICgha2V5d29yZHNba2V5XSkgewogICAgICAgICAgICBrZXl3b3Jkc1trZXldID0gdHJ1ZTsKICAgICAgICAgICAgd29yZHMucHVzaChrZXkpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9CgogICAgZXh0cmFjdFdvcmRzKHRoaXMudGV4dCk7CiAgICB0aGlzLnByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7CiAgICAgIGV4dHJhY3RXb3Jkcyhwcm9wLnRleHQgfHwgcHJvcC5kZXNjcmlwdGlvbiB8fCAnJyk7CiAgICB9KTsKICAgIHRoaXMubWV0aG9kcy5mb3JFYWNoKGZ1bmN0aW9uKG1ldGhvZCkgewogICAgICBleHRyYWN0V29yZHMobWV0aG9kLnRleHQgfHwgbWV0aG9kLmRlc2NyaXB0aW9uIHx8ICcnKTsKICAgIH0pOwogICAgaWYgKHRoaXMubmdkb2MgPT09ICdlcnJvcicpIHsKICAgICAgd29yZHMucHVzaCh0aGlzLmdldE1pbmVyck5hbWVzcGFjZSgpKTsKICAgICAgd29yZHMucHVzaCh0aGlzLmdldE1pbmVyckNvZGUoKSk7CiAgICB9CiAgICB3b3Jkcy5zb3J0KCk7CiAgICByZXR1cm4gd29yZHMuam9pbignICcpOwogIH0sCgogIHNob3J0RGVzY3JpcHRpb24gOiBmdW5jdGlvbigpIHsKICAgIGlmICghdGhpcy5kZXNjcmlwdGlvbikgcmV0dXJuIHRoaXMuZGVzY3JpcHRpb247CiAgICB2YXIgdGV4dCA9IHRoaXMuZGVzY3JpcHRpb24uc3BsaXQoIlxuIilbMF07CiAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC88Lis/XC8/Pi9nLCAnJyk7CiAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC97L2csJyYjMTIzOycpOwogICAgdGV4dCA9IHRleHQucmVwbGFjZSgvfS9nLCcmIzEyNTsnKTsKICAgIHJldHVybiB0ZXh0OwogIH0sCgogIGdldE1pbmVyck5hbWVzcGFjZTogZnVuY3Rpb24gKCkgewogICAgaWYgKHRoaXMubmdkb2MgIT09ICdlcnJvcicpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdUcmllZCB0byBnZXQgdGhlIG1pbkVyciBuYW1lc3BhY2UsIGJ1dCBAbmdkb2MgJyArCiAgICAgICAgdGhpcy5uZ2RvYyArICcgd2FzIHN1cHBsaWVkLiBJdCBzaG91bGQgYmUgQG5nZG9jIGVycm9yJyk7CiAgICB9CiAgICByZXR1cm4gdGhpcy5uYW1lLnNwbGl0KCc6JylbMF07CiAgfSwKCiAgZ2V0TWluZXJyQ29kZTogZnVuY3Rpb24gKCkgewogICAgaWYgKHRoaXMubmdkb2MgIT09ICdlcnJvcicpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdUcmllZCB0byBnZXQgdGhlIG1pbkVyciBlcnJvciBjb2RlLCBidXQgQG5nZG9jICcgKwogICAgICAgIHRoaXMubmdkb2MgKyAnIHdhcyBzdXBwbGllZC4gSXQgc2hvdWxkIGJlIEBuZ2RvYyBlcnJvcicpOwogICAgfQogICAgcmV0dXJuIHRoaXMubmFtZS5zcGxpdCgnOicpWzFdOwogIH0sCgogIC8qKgogICAqIENvbnZlcnRzIHJlbGF0aXZlIHVybHMgKHdpdGhvdXQgc2VjdGlvbikgaW50byBhYnNvbHV0ZQogICAqIEFic29sdXRlIHVybCBtZWFucyB1cmwgd2l0aCBzZWN0aW9uCiAgICoKICAgKiBAZXhhbXBsZQogICAqIC0gaWYgdGhlIGxpbmsgaXMgaW5zaWRlIGFueSBhcGkgZG9jOgogICAqIGFuZ3VsYXIud2lkZ2V0IC0+IGFwaS9hbmd1bGFyLndpZGdldAogICAqCiAgICogLSBpZiB0aGUgbGluayBpcyBpbnNpZGUgYW55IGd1aWQgZG9jOgogICAqIGludHJvIC0+IGd1aWRlL2ludHJvCiAgICoKICAgKiBAcGFyYW0ge3N0cmluZ30gdXJsIEFic29sdXRlIG9yIHJlbGF0aXZlIHVybAogICAqIEByZXR1cm5zIHtzdHJpbmd9IEFic29sdXRlIHVybAogICAqLwogIGNvbnZlcnRVcmxUb0Fic29sdXRlOiBmdW5jdGlvbih1cmwpIHsKICAgIHZhciBoYXNoSWR4ID0gdXJsLmluZGV4T2YoJyMnKTsKCiAgICAvLyBMb3dlcmNhc2UgaGFzaCBwYXJ0cyBvZiB0aGUgbGlua3MsCiAgICAvLyBzbyB0aGF0IHdlIGNhbiBrZWVwIGNvcnJlY3QgQVBJIG5hbWVzIGV2ZW4gd2hlbiB0aGUgdXJscyBhcmUgbG93ZXJjYXNlZC4KICAgIGlmIChoYXNoSWR4ICE9PSAtMSkgewogICAgICB1cmwgPSB1cmwuc3Vic3RyKDAsIGhhc2hJZHgpICsgdXJsLnN1YnN0cihoYXNoSWR4KS50b0xvd2VyQ2FzZSgpOwogICAgfQoKICAgIGlmICh1cmwuc3Vic3RyKC0xKSA9PSAnLycpIHJldHVybiB1cmwgKyAnaW5kZXgnOwogICAgaWYgKHVybC5tYXRjaCgvXC8vKSkgcmV0dXJuIHVybDsKICAgIHJldHVybiB0aGlzLnNlY3Rpb24gKyAnLycgKyB1cmw7CiAgfSwKCiAgbWFya2Rvd246IGZ1bmN0aW9uKHRleHQpIHsKICAgIGlmICghdGV4dCkgcmV0dXJuIHRleHQ7CgogICAgdmFyIHNlbGYgPSB0aGlzLAogICAgICBJU19VUkwgPSAvXihodHRwcz86XC9cL3xmdHBzPzpcL1wvfG1haWx0bzp8XC58XC8pLywKICAgICAgSVNfQU5HVUxBUiA9IC9eKGFwaVwvKT8oYW5ndWxhcnxuZ3xBVVRPKVwuLywKICAgICAgSVNfSEFTSCA9IC9eIy8sCiAgICAgIHBhcnRzID0gdHJpbSh0ZXh0KS5zcGxpdCgvKDxwcmUuKj8+W1xzXFNdKj88XC9wcmU+fDxkb2M6ZXhhbXBsZShcUyopLio/Pltcc1xTXSo/PFwvZG9jOmV4YW1wbGU+fDxleGFtcGxlW14+XSo+W1xzXFNdKj88XC9leGFtcGxlPikvKSwKICAgICAgc2VxID0gMCwKICAgICAgcGxhY2Vob2xkZXJNYXAgPSB7fTsKCiAgICBmdW5jdGlvbiBwbGFjZWhvbGRlcih0ZXh0KSB7CiAgICAgIHZhciBpZCA9ICdSRVBMQUNFTUUnICsgKHNlcSsrKTsKICAgICAgcGxhY2Vob2xkZXJNYXBbaWRdID0gdGV4dDsKICAgICAgcmV0dXJuIGlkOwogICAgfQoKICAgIGZ1bmN0aW9uIGV4dHJhY3RJbmxpbmVEb2NDb2RlKHRleHQsIHRhZykgewogICAgICBpZih0YWcgPT0gJ2FsbCcpIHsKICAgICAgICAvL3VzZSBhIGdyZWVkeSBvcGVyYXRvciB0byBtYXRjaCB0aGUgbGFzdCA8L2RvY3M+IHRhZwogICAgICAgIHJlZ2V4ID0gL1wvXC88ZG9jcy4qPz4oWy5cc1xTXSspXC9cLzxcL2RvY3M+L2ltOwogICAgICB9CiAgICAgIGVsc2UgewogICAgICAgIC8vdXNlIGEgbm9uLWdyZWVkeSBvcGVyYXRvciB0byBtYXRjaCB0aGUgbmV4dCA8L2RvY3M+IHRhZwogICAgICAgIHJlZ2V4ID0gbmV3IFJlZ0V4cCgiXC9cLzxkb2NzXFxzKnRhZz1cIiIgKyB0YWcgKyAiXCIuKj8+KFsuXFxzXFxTXSs/KVwvXC88XC9kb2NzPiIsImltIik7CiAgICAgIH0KICAgICAgdmFyIG1hdGNoZXMgPSByZWdleC5leGVjKHRleHQudG9TdHJpbmcoKSk7CiAgICAgIHJldHVybiBtYXRjaGVzICYmIG1hdGNoZXMubGVuZ3RoID4gMSA/IG1hdGNoZXNbMV0gOiAiIjsKICAgIH0KCiAgICBwYXJ0cy5mb3JFYWNoKGZ1bmN0aW9uKHRleHQsIGkpIHsKICAgICAgcGFydHNbaV0gPSAodGV4dCB8fCAnJykuCiAgICAgICAgcmVwbGFjZSgvPGV4YW1wbGUoPzpccyttb2R1bGU9IihbXiJdKikiKT8oPzpccytkZXBzPSIoW14iXSopIik/KFxzK2FuaW1hdGlvbnM9InRydWUiKT8+KFtcc1xTXSo/KTxcL2V4YW1wbGU+L2dtaSwKICAgICAgICAgIGZ1bmN0aW9uKF8sIG1vZHVsZSwgZGVwcywgYW5pbWF0aW9ucywgY29udGVudCkgewoKICAgICAgICAgIHZhciBleGFtcGxlID0gbmV3IEV4YW1wbGUoc2VsZi5zY2VuYXJpb3MpOwogICAgICAgICAgaWYoYW5pbWF0aW9ucykgewogICAgICAgICAgICBleGFtcGxlLmVuYWJsZUFuaW1hdGlvbnMoKTsKICAgICAgICAgICAgZXhhbXBsZS5hZGREZXBzKCdhbmd1bGFyLWFuaW1hdGUuanMnKTsKICAgICAgICAgIH0KCiAgICAgICAgICBleGFtcGxlLnNldE1vZHVsZShtb2R1bGUpOwogICAgICAgICAgZXhhbXBsZS5hZGREZXBzKGRlcHMpOwogICAgICAgICAgY29udGVudC5yZXBsYWNlKC88ZmlsZVxzK25hbWU9IihbXiJdKikiXHMqPihbXHNcU10qPyk8XC9maWxlPi9nbWksIGZ1bmN0aW9uKF8sIG5hbWUsIGNvbnRlbnQpIHsKICAgICAgICAgICAgZXhhbXBsZS5hZGRTb3VyY2UobmFtZSwgY29udGVudCk7CiAgICAgICAgICB9KTsKICAgICAgICAgIGNvbnRlbnQucmVwbGFjZSgvPGZpbGVccytzcmM9IihbXiJdKykiKD86XHMrdGFnPSIoW14iXSspIik/KD86XHMrbmFtZT0iKFteIl0rKSIpP1xzKlwvPz4vZ21pLCBmdW5jdGlvbihfLCBmaWxlLCB0YWcsIG5hbWUpIHsKICAgICAgICAgICAgaWYoZnMuZXhpc3RzU3luYyhmaWxlKSkgewogICAgICAgICAgICAgIHZhciBjb250ZW50ID0gZnMucmVhZEZpbGVTeW5jKGZpbGUsICd1dGY4Jyk7CiAgICAgICAgICAgICAgaWYoY29udGVudCAmJiBjb250ZW50Lmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIGlmKHRhZyAmJiB0YWcubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICBjb250ZW50ID0gZXh0cmFjdElubGluZURvY0NvZGUoY29udGVudCwgdGFnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIG5hbWUgPSBuYW1lICYmIG5hbWUubGVuZ3RoID4gMCA/IG5hbWUgOiBmc3BhdGguYmFzZW5hbWUoZmlsZSk7CiAgICAgICAgICAgICAgICBleGFtcGxlLmFkZFNvdXJjZShuYW1lLCBjb250ZW50KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuICcnOwogICAgICAgICAgfSkKICAgICAgICAgIHJldHVybiBwbGFjZWhvbGRlcihleGFtcGxlLnRvSHRtbCgpKTsKICAgICAgICB9KS4KICAgICAgICByZXBsYWNlKC8oPzpcKlxzKyk/PGZpbGUuKz9zcmM9IihbXiJdKykiKD86XHMrdGFnPSIoW14iXSspIik/XHMqXC8/Pi9pLCBmdW5jdGlvbihfLCBmaWxlLCB0YWcpIHsKICAgICAgICAgIGlmKGZzLmV4aXN0c1N5bmMoZmlsZSkpIHsKICAgICAgICAgICAgdmFyIGNvbnRlbnQgPSBmcy5yZWFkRmlsZVN5bmMoZmlsZSwgJ3V0ZjgnKTsKICAgICAgICAgICAgaWYodGFnICYmIHRhZy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgY29udGVudCA9IGV4dHJhY3RJbmxpbmVEb2NDb2RlKGNvbnRlbnQsIHRhZyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGNvbnRlbnQ7CiAgICAgICAgICB9CiAgICAgICAgfSkuCiAgICAgICAgcmVwbGFjZSgvXjxkb2M6ZXhhbXBsZShccytbXj5dKik/PihbXHNcU10qKTxcL2RvYzpleGFtcGxlPi9taSwgZnVuY3Rpb24oXywgYXR0cnMsIGNvbnRlbnQpIHsKICAgICAgICAgIHZhciBodG1sLCBzY3JpcHQsIHNjZW5hcmlvLAogICAgICAgICAgICBleGFtcGxlID0gbmV3IEV4YW1wbGUoc2VsZi5zY2VuYXJpb3MpOwoKICAgICAgICAgIGV4YW1wbGUuc2V0TW9kdWxlKChhdHRyc3x8J21vZHVsZT0iIicpLm1hdGNoKC9eXHMqbW9kdWxlPVsiJ10oLiopWyInXVxzKiQvKVsxXSk7CiAgICAgICAgICBjb250ZW50LgogICAgICAgICAgICByZXBsYWNlKC88ZG9jOnNvdXJjZShccytbXj5dKik/PihbXHNcU10qKTxcL2RvYzpzb3VyY2U+L21pLCBmdW5jdGlvbihfLCBhdHRycywgY29udGVudCkgewogICAgICAgICAgICAgIGV4YW1wbGUuYWRkU291cmNlKCdpbmRleC5odG1sJywgY29udGVudC4KICAgICAgICAgICAgICAgIHJlcGxhY2UoLzxzY3JpcHQ+KFtcc1xTXSopPFwvc2NyaXB0Pi9taSwgZnVuY3Rpb24oXywgc2NyaXB0KSB7CiAgICAgICAgICAgICAgICAgIGV4YW1wbGUuYWRkU291cmNlKCdzY3JpcHQuanMnLCBzY3JpcHQpOwogICAgICAgICAgICAgICAgICByZXR1cm4gJyc7CiAgICAgICAgICAgICAgICB9KS4KICAgICAgICAgICAgICAgIHJlcGxhY2UoLzxzdHlsZT4oW1xzXFNdKik8XC9zdHlsZT4vbWksIGZ1bmN0aW9uKF8sIHN0eWxlKSB7CiAgICAgICAgICAgICAgICAgIGV4YW1wbGUuYWRkU291cmNlKCdzdHlsZS5jc3MnLCBzdHlsZSk7CiAgICAgICAgICAgICAgICAgIHJldHVybiAnJzsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfSkuCiAgICAgICAgICAgIHJlcGxhY2UoLyg8ZG9jOnNjZW5hcmlvPikoW1xzXFNdKikoPFwvZG9jOnNjZW5hcmlvPikvbWksIGZ1bmN0aW9uKF8sIGJlZm9yZSwgY29udGVudCl7CiAgICAgICAgICAgICAgZXhhbXBsZS5hZGRTb3VyY2UoJ3NjZW5hcmlvLmpzJywgY29udGVudCk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgIHJldHVybiBwbGFjZWhvbGRlcihleGFtcGxlLnRvSHRtbCgpKTsKICAgICAgICB9KS4KICAgICAgICByZXBsYWNlKC9ePHByZSguKj8pPihbXHNcU10qPyk8XC9wcmU+L21pLCBmdW5jdGlvbihfLCBhdHRycywgY29udGVudCl7CiAgICAgICAgICByZXR1cm4gcGxhY2Vob2xkZXIoCiAgICAgICAgICAgICc8cHJlJythdHRycysnIGNsYXNzPSJwcmV0dHlwcmludCBsaW5lbnVtcyI+JyArCiAgICAgICAgICAgICAgY29udGVudC5yZXBsYWNlKC88L2csICcmbHQ7JykucmVwbGFjZSgvPi9nLCAnJmd0OycpICsKICAgICAgICAgICAgICAnPC9wcmU+Jyk7CiAgICAgICAgfSkuCiAgICAgICAgcmVwbGFjZSgvPGRpdihbXj5dKik+PFwvZGl2Pi8sICc8ZGl2JDE+XG48XC9kaXY+JykuCiAgICAgICAgcmVwbGFjZSgve0BsaW5rXHMrKFteXHN9XSspXHMqKFtefV0qPylccyp9L2csIGZ1bmN0aW9uKF9hbGwsIHVybCwgdGl0bGUpewogICAgICAgICAgdmFyIGlzRnVsbFVybCA9IHVybC5tYXRjaChJU19VUkwpLAogICAgICAgICAgICBpc0FuZ3VsYXIgPSB1cmwubWF0Y2goSVNfQU5HVUxBUiksCiAgICAgICAgICAgIGlzSGFzaCA9IHVybC5tYXRjaChJU19IQVNIKSwKICAgICAgICAgICAgYWJzVXJsID0gaXNIYXNoCiAgICAgICAgICAgICAgPyB1cmwKICAgICAgICAgICAgICA6IChpc0Z1bGxVcmwgPyB1cmwgOiBzZWxmLmNvbnZlcnRVcmxUb0Fic29sdXRlKHVybCkpOwoKICAgICAgICAgIGlmICghaXNGdWxsVXJsKSBzZWxmLmxpbmtzLnB1c2goYWJzVXJsKTsKCiAgICAgICAgICByZXR1cm4gJzxhIGhyZWY9IicgKyBhYnNVcmwgKyAnIj4nICsKICAgICAgICAgICAgKGlzQW5ndWxhciA/ICc8Y29kZT4nIDogJycpICsKICAgICAgICAgICAgKHRpdGxlIHx8IHVybCkucmVwbGFjZSgvXiMvZywgJycpLnJlcGxhY2UoL1xuL2csICcgJykgKwogICAgICAgICAgICAoaXNBbmd1bGFyID8gJzwvY29kZT4nIDogJycpICsKICAgICAgICAgICAgJzwvYT4nOwogICAgICAgIH0pLgogICAgICAgIHJlcGxhY2UoL3tAdHlwZVxzKyhcUyspKD86XHMrKFxTKykpP30vZywgZnVuY3Rpb24oXywgdHlwZSwgdXJsKSB7CiAgICAgICAgICB1cmwgPSB1cmwgfHwgJyMnOwogICAgICAgICAgcmV0dXJuICc8YSBocmVmPSInICsgdXJsICsgJyIgY2xhc3M9IicgKyBzZWxmLnByZXBhcmVfdHlwZV9oaW50X2NsYXNzX25hbWUodHlwZSkgKyAnIj4nICsgdHlwZSArICc8L2E+JzsKICAgICAgICB9KS4KICAgICAgICByZXBsYWNlKC97QGluc3RhbGxNb2R1bGVccysoXFMrKT99L2csIGZ1bmN0aW9uKF8sIG1vZHVsZSkgewogICAgICAgICAgcmV0dXJuIGV4cGxhaW5Nb2R1bGVJbnN0YWxsYXRpb24obW9kdWxlKTsKICAgICAgICB9KTsKICAgIH0pOwogICAgdGV4dCA9IHBhcnRzLmpvaW4oJycpOwoKICAgIGZ1bmN0aW9uIHByZXBhcmVDbGFzc05hbWUodGV4dCkgewogICAgICByZXR1cm4gdGV4dC50b0xvd2VyQ2FzZSgpLnJlcGxhY2UoL1tfXFddKy9nLCAnLScpOwogICAgfTsKCiAgICB2YXIgcGFnZUNsYXNzTmFtZSwgc3VmZml4ID0gJy1wYWdlJzsKICAgIGlmKHRoaXMubmFtZSkgewogICAgICB2YXIgc3BsaXQgPSB0aGlzLm5hbWUubWF0Y2goL15ccyooLis/KVxzKjpccyooLispLyk7CiAgICAgIGlmKHNwbGl0ICYmIHNwbGl0Lmxlbmd0aCA+IDEpIHsKICAgICAgICB2YXIgYmVmb3JlID0gcHJlcGFyZUNsYXNzTmFtZShzcGxpdFsxXSk7CiAgICAgICAgdmFyIGFmdGVyID0gcHJlcGFyZUNsYXNzTmFtZShzcGxpdFsyXSk7CiAgICAgICAgcGFnZUNsYXNzTmFtZSA9IGJlZm9yZSArIHN1ZmZpeCArICcgJyArIGJlZm9yZSArICctJyArIGFmdGVyICsgc3VmZml4OwogICAgICB9CiAgICB9CiAgICBwYWdlQ2xhc3NOYW1lID0gcGFnZUNsYXNzTmFtZSB8fCBwcmVwYXJlQ2xhc3NOYW1lKHRoaXMubmFtZSB8fCAnZG9jcycpICsgc3VmZml4OwoKICAgIHRleHQgPSAnPGRpdiBjbGFzcz0iJyArIHBhZ2VDbGFzc05hbWUgKyAnIj4nICsKICAgICAgICAgICAgIG1hcmtlZCh0ZXh0KSArCiAgICAgICAgICAgJzwvZGl2Pic7CiAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC8oPzo8cD4pPyhSRVBMQUNFTUVcZCspKD86PFwvcD4pPy9nLCBmdW5jdGlvbihfLCBpZCkgewogICAgICByZXR1cm4gcGxhY2Vob2xkZXJNYXBbaWRdOwogICAgfSk7CgogICAgLy8hYW5ub3RhdGUgQ09OVEVOVAogICAgLy8hYW5ub3RhdGU9IlJFR0VYIiBDT05URU5UCiAgICAvLyFhbm5vdGF0ZT0iUkVHRVgiIFRJVExFfENPTlRFTlQKICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoL1xuP1wvXC8hYW5ub3RhdGVccyooPzo9XHMqWyciXSguKz8pWyciXSk/XHMrKC4rPylcblxzKiguKz9cbikvaW1nLAogICAgICBmdW5jdGlvbihfLCBwYXR0ZXJuLCBjb250ZW50LCBsaW5lKSB7CiAgICAgICAgdmFyIHBhdHRlcm4gPSBuZXcgUmVnRXhwKHBhdHRlcm4gfHwgJy4rJyk7CiAgICAgICAgdmFyIHRpdGxlLCB0ZXh0LCBzcGxpdCA9IGNvbnRlbnQuc3BsaXQoL1x8Lyk7CiAgICAgICAgaWYoc3BsaXQubGVuZ3RoID4gMSkgewogICAgICAgICAgdGV4dCA9IHNwbGl0WzFdOwogICAgICAgICAgdGl0bGUgPSBzcGxpdFswXTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICB0aXRsZSA9ICdJbmZvJzsKICAgICAgICAgIHRleHQgPSBjb250ZW50OwogICAgICAgIH0KICAgICAgICByZXR1cm4gIlxuIiArIGxpbmUucmVwbGFjZShwYXR0ZXJuLCBmdW5jdGlvbihtYXRjaCkgewogICAgICAgICAgcmV0dXJuICc8ZGl2IGNsYXNzPSJub2NvZGUgbm9jb2RlLWNvbnRlbnQiIGRhdGEtcG9wb3ZlciAnICsKICAgICAgICAgICAgICAgICAgICdkYXRhLWNvbnRlbnQ9IicgKyB0ZXh0ICsgJyIgJyArCiAgICAgICAgICAgICAgICAgICAnZGF0YS10aXRsZT0iJyArIHRpdGxlICsgJyI+JyArCiAgICAgICAgICAgICAgICAgICAgICBtYXRjaCArCiAgICAgICAgICAgICAgICAgJzwvZGl2Pic7CiAgICAgICAgfSk7CiAgICAgIH0KICAgICk7CgogICAgLy8hZGV0YWlscyAvcGF0aC90by9sb2NhbC9kb2NzL2ZpbGUuaHRtbAogICAgLy8hZGV0YWlscz0iUkVHRVgiIC9wYXRoL3RvL2xvY2FsL2RvY3MvZmlsZS5odG1sCiAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC9cL1wvIWRldGFpbHNccyooPzo9XHMqWyciXSguKz8pWyciXSk/XHMrKC4rPylcblxzKiguKz9cbikvaW1nLAogICAgICBmdW5jdGlvbihfLCBwYXR0ZXJuLCB1cmwsIGxpbmUpIHsKICAgICAgICB1cmwgPSAnL25vdGVzLycgKyB1cmw7CiAgICAgICAgdmFyIHBhdHRlcm4gPSBuZXcgUmVnRXhwKHBhdHRlcm4gfHwgJy4rJyk7CiAgICAgICAgcmV0dXJuIGxpbmUucmVwbGFjZShwYXR0ZXJuLCBmdW5jdGlvbihtYXRjaCkgewogICAgICAgICAgcmV0dXJuICc8ZGl2IGNsYXNzPSJub2NvZGUgbm9jb2RlLWNvbnRlbnQiIGRhdGEtZm9sZG91dCBkYXRhLXVybD0iJyArIHVybCArICciPicgKyBtYXRjaCArICc8L2Rpdj4nOwogICAgICAgIH0pOwogICAgICB9CiAgICApOwoKICAgIHJldHVybiB0ZXh0OwogIH0sCgogIHBhcnNlOiBmdW5jdGlvbigpIHsKICAgIHZhciBhdE5hbWU7CiAgICB2YXIgYXRUZXh0OwogICAgdmFyIG1hdGNoOwogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgc2VsZi50ZXh0LnNwbGl0KE5FV19MSU5FKS5mb3JFYWNoKGZ1bmN0aW9uKGxpbmUpewogICAgICBpZiAoKG1hdGNoID0gbGluZS5tYXRjaCgvXlxzKkAoXHcrKShccysoLiopKT8vKSkpIHsKICAgICAgICAvLyB3ZSBmb3VuZCBAbmFtZSAuLi4KICAgICAgICAvLyBpZiB3ZSBoYXZlIGV4aXN0aW5nIG5hbWUKICAgICAgICBmbHVzaCgpOwogICAgICAgIGF0TmFtZSA9IG1hdGNoWzFdOwogICAgICAgIGF0VGV4dCA9IFtdOwogICAgICAgIGlmKG1hdGNoWzNdKSBhdFRleHQucHVzaChtYXRjaFszXSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKGF0TmFtZSkgewogICAgICAgICAgYXRUZXh0LnB1c2gobGluZSk7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKICAgIGZsdXNoKCk7CiAgICB0aGlzLnNob3J0TmFtZSA9IHRoaXMubmFtZS5zcGxpdCgvW1wuOiNdLykucG9wKCkudHJpbSgpOwogICAgdGhpcy5pZCA9IHRoaXMuaWQgfHwgLy8gaWYgd2UgaGF2ZSBhbiBpZCBqdXN0IHVzZSBpdAogICAgICAodGhpcy5uZ2RvYyA9PT0gJ2Vycm9yJyA/IHRoaXMubmFtZSA6ICcnKSB8fAogICAgICAoKCh0aGlzLmZpbGV8fCcnKS5tYXRjaCgvLiooXC98XFwpKFteKFwvfFxcKV0qKVwubmdkb2MvKXx8e30pWzJdKSB8fCAvLyB0cnkgdG8gZXh0cmFjdCBpdCBmcm9tIGZpbGUgbmFtZQogICAgICB0aGlzLm5hbWU7IC8vIGRlZmF1bHQgdG8gbmFtZQogICAgdGhpcy5tb2R1bGVOYW1lID0gcGFyc2VNb2R1bGVOYW1lKHRoaXMuaWQpOwogICAgdGhpcy5kZXNjcmlwdGlvbiA9IHRoaXMubWFya2Rvd24odGhpcy5kZXNjcmlwdGlvbik7CiAgICB0aGlzLmV4YW1wbGUgPSB0aGlzLm1hcmtkb3duKHRoaXMuZXhhbXBsZSk7CiAgICB0aGlzWyd0aGlzJ10gPSB0aGlzLm1hcmtkb3duKHRoaXNbJ3RoaXMnXSk7CiAgICByZXR1cm4gdGhpczsKCiAgICBmdW5jdGlvbiBwYXJzZU1vZHVsZU5hbWUoaWQpIHsKICAgICAgdmFyIG1vZHVsZSA9IGlkLnNwbGl0KCcuJylbMF07CiAgICAgIGlmKG1vZHVsZSA9PSAnYW5ndWxhcicpIHsKICAgICAgICBtb2R1bGUgPSAnbmcnOwogICAgICB9CiAgICAgIHJldHVybiBtb2R1bGU7CiAgICB9CgogICAgZnVuY3Rpb24gZmx1c2goKSB7CiAgICAgIGlmIChhdE5hbWUpIHsKICAgICAgICB2YXIgdGV4dCA9IHRyaW0oYXRUZXh0LmpvaW4oJ1xuJykpLCBtYXRjaDsKICAgICAgICBpZiAoYXROYW1lID09ICdwYXJhbScpIHsKICAgICAgICAgIG1hdGNoID0gdGV4dC5tYXRjaCgvXlx7KFtefV0rKVx9XHMrKChbXlxzPV0rKXxcWyhcUyspPShbXlxdXSspXF0pXHMrKC4qKS8pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICAxICAgICAgMSAgICAyMyAgICAgICAzICAgNCAgIDQgNSAgICAgIDUgIDIgICA2ICA2CiAgICAgICAgICBpZiAoIW1hdGNoKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiTm90IGEgdmFsaWQgJ3BhcmFtJyBmb3JtYXQ6ICIgKyB0ZXh0ICsgJyAoZm91bmQgaW46ICcgKyBzZWxmLmZpbGUgKyAnOicgKyBzZWxmLmxpbmUgKyAnKScpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBvcHRpb25hbCA9IChtYXRjaFsxXS5zbGljZSgtMSkgPT09ICc9Jyk7CiAgICAgICAgICB2YXIgcGFyYW0gPSB7CiAgICAgICAgICAgIG5hbWU6IG1hdGNoWzRdIHx8IG1hdGNoWzNdLAogICAgICAgICAgICBkZXNjcmlwdGlvbjpzZWxmLm1hcmtkb3duKHRleHQucmVwbGFjZShtYXRjaFswXSwgbWF0Y2hbNl0pKSwKICAgICAgICAgICAgdHlwZTogb3B0aW9uYWwgPyBtYXRjaFsxXS5zdWJzdHJpbmcoMCwgbWF0Y2hbMV0ubGVuZ3RoLTEpIDogbWF0Y2hbMV0sCiAgICAgICAgICAgIG9wdGlvbmFsOiBvcHRpb25hbCwKICAgICAgICAgICAgZGVmYXVsdDogbWF0Y2hbNV0KICAgICAgICAgIH07CiAgICAgICAgICBzZWxmLnBhcmFtLnB1c2gocGFyYW0pOwogICAgICAgIH0gZWxzZSBpZiAoYXROYW1lID09ICdyZXR1cm5zJyB8fCBhdE5hbWUgPT0gJ3JldHVybicpIHsKICAgICAgICAgIG1hdGNoID0gdGV4dC5tYXRjaCgvXlx7KFtefV0rKVx9XHMrKC4qKS8pOwogICAgICAgICAgaWYgKCFtYXRjaCkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIk5vdCBhIHZhbGlkICdyZXR1cm5zJyBmb3JtYXQ6ICIgKyB0ZXh0ICsgJyAoZm91bmQgaW46ICcgKyBzZWxmLmZpbGUgKyAnOicgKyBzZWxmLmxpbmUgKyAnKScpOwogICAgICAgICAgfQogICAgICAgICAgc2VsZi5yZXR1cm5zID0gewogICAgICAgICAgICB0eXBlOiBtYXRjaFsxXSwKICAgICAgICAgICAgZGVzY3JpcHRpb246IHNlbGYubWFya2Rvd24odGV4dC5yZXBsYWNlKG1hdGNoWzBdLCBtYXRjaFsyXSkpCiAgICAgICAgICB9OwogICAgICAgIH0gZWxzZSBpZihhdE5hbWUgPT0gJ3JlcXVpcmVzJykgewogICAgICAgICAgbWF0Y2ggPSB0ZXh0Lm1hdGNoKC9eKFteXHNdKilccyooW1xTXHNdKikvKTsKICAgICAgICAgIHNlbGYucmVxdWlyZXMucHVzaCh7CiAgICAgICAgICAgIG5hbWU6IG1hdGNoWzFdLAogICAgICAgICAgICB0ZXh0OiBzZWxmLm1hcmtkb3duKG1hdGNoWzJdKQogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIGlmKGF0TmFtZSA9PSAncHJvcGVydHknKSB7CiAgICAgICAgICBtYXRjaCA9IHRleHQubWF0Y2goL15ceyhcUyspXH1ccysoXFMrKShccysoLiopKT8vKTsKICAgICAgICAgIGlmICghbWF0Y2gpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJOb3QgYSB2YWxpZCAncHJvcGVydHknIGZvcm1hdDogIiArIHRleHQgKyAnIChmb3VuZCBpbjogJyArIHNlbGYuZmlsZSArICc6JyArIHNlbGYubGluZSArICcpJyk7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgcHJvcGVydHkgPSBuZXcgRG9jKHsKICAgICAgICAgICAgdHlwZTogbWF0Y2hbMV0sCiAgICAgICAgICAgIG5hbWU6IG1hdGNoWzJdLAogICAgICAgICAgICBzaG9ydE5hbWU6IG1hdGNoWzJdLAogICAgICAgICAgICBkZXNjcmlwdGlvbjogc2VsZi5tYXJrZG93bih0ZXh0LnJlcGxhY2UobWF0Y2hbMF0sIG1hdGNoWzRdKSkKICAgICAgICAgIH0pOwogICAgICAgICAgc2VsZi5wcm9wZXJ0aWVzLnB1c2gocHJvcGVydHkpOwogICAgICAgIH0gZWxzZSBpZihhdE5hbWUgPT0gJ2V2ZW50VHlwZScpIHsKICAgICAgICAgIG1hdGNoID0gdGV4dC5tYXRjaCgvXihbXlxzXSopXHMrb25ccysoW1xTXHNdKikvKTsKICAgICAgICAgIHNlbGYudHlwZSA9IG1hdGNoWzFdOwogICAgICAgICAgc2VsZi50YXJnZXQgPSBtYXRjaFsyXTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc2VsZlthdE5hbWVdID0gdGV4dDsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9LAoKICBodG1sOiBmdW5jdGlvbigpIHsKICAgIHZhciBkb20gPSBuZXcgRE9NKCksCiAgICAgIHNlbGYgPSB0aGlzLAogICAgICBtaW5lcnJNc2c7CgogICAgdmFyIGdpdFRhZ0Zyb21GdWxsVmVyc2lvbiA9IGZ1bmN0aW9uKHZlcnNpb24pIHsKICAgICAgdmFyIG1hdGNoID0gdmVyc2lvbi5tYXRjaCgvLShcd3s3fSkvKTsKCiAgICAgIGlmIChtYXRjaCkgewogICAgICAgIC8vIGdpdCBzaGEKICAgICAgICByZXR1cm4gbWF0Y2hbMV07CiAgICAgIH0KCiAgICAgIC8vIGdpdCB0YWcKICAgICAgcmV0dXJuICd2JyArIHZlcnNpb247CiAgICB9OwoKICAgIGlmICh0aGlzLnNlY3Rpb24gPT09ICdhcGknKSB7CiAgICAgIGRvbS50YWcoJ2EnLCB7CiAgICAgICAgICBocmVmOiAnaHR0cDovL2dpdGh1Yi5jb20vYW5ndWxhci9hbmd1bGFyLmpzL3RyZWUvJyArCiAgICAgICAgICAgIGdpdFRhZ0Zyb21GdWxsVmVyc2lvbihncnVudFV0aWwuZ2V0VmVyc2lvbigpLmZ1bGwpICsgJy8nICsgc2VsZi5maWxlICsgJyNMJyArIHNlbGYubGluZSwKICAgICAgICAgIGNsYXNzOiAndmlldy1zb3VyY2UgYnRuIGJ0bi1hY3Rpb24nIH0sIGZ1bmN0aW9uKGRvbSkgewogICAgICAgIGRvbS50YWcoJ2knLCB7Y2xhc3M6J2ljb24tem9vbS1pbid9LCAnICcpOwogICAgICAgIGRvbS50ZXh0KCcgVmlldyBzb3VyY2UnKTsKICAgICAgfSk7CiAgICB9CiAgICBkb20udGFnKCdhJywgewogICAgICAgIGhyZWY6ICdodHRwOi8vZ2l0aHViLmNvbS9hbmd1bGFyL2FuZ3VsYXIuanMvZWRpdC9tYXN0ZXIvJyArIHNlbGYuZmlsZSwKICAgICAgICBjbGFzczogJ2ltcHJvdmUtZG9jcyBidG4gYnRuLXByaW1hcnknIH0sIGZ1bmN0aW9uKGRvbSkgewogICAgICBkb20udGFnKCdpJywge2NsYXNzOidpY29uLWVkaXQnfSwgJyAnKTsKICAgICAgZG9tLnRleHQoJyBJbXByb3ZlIHRoaXMgZG9jJyk7CiAgICB9KTsKICAgIGRvbS5oKHRpdGxlKHRoaXMpLCBmdW5jdGlvbigpIHsKICAgICAgbm90aWNlKCdkZXByZWNhdGVkJywgJ0RlcHJlY2F0ZWQgQVBJJywgc2VsZi5kZXByZWNhdGVkKTsKICAgICAgaWYgKHNlbGYubmdkb2MgPT09ICdlcnJvcicpIHsKICAgICAgICBtaW5lcnJNc2cgPSBsb29rdXBNaW5lcnJNc2coc2VsZik7CiAgICAgICAgZG9tLnRhZygncHJlJywgewogICAgICAgICAgY2xhc3M6J21pbmVyci1lcnJtc2cnLAogICAgICAgICAgJ2Vycm9yLWRpc3BsYXknOiBtaW5lcnJNc2cucmVwbGFjZSgvIi9nLCAnJnF1b3Q7JykKICAgICAgICB9LCBtaW5lcnJNc2cpOwogICAgICB9CiAgICAgIGlmIChzZWxmLm5nZG9jICE9ICdvdmVydmlldycpIHsKICAgICAgICBkb20uaCgnRGVzY3JpcHRpb24nLCBzZWxmLmRlc2NyaXB0aW9uLCBkb20uaHRtbCk7CiAgICAgIH0KICAgICAgZG9tLmgoJ0RlcGVuZGVuY2llcycsIHNlbGYucmVxdWlyZXMsIGZ1bmN0aW9uKHJlcXVpcmUpewogICAgICAgIGRvbS50YWcoJ2NvZGUnLCBmdW5jdGlvbigpIHsKICAgICAgICAgIGRvbS50YWcoJ2EnLCB7aHJlZjogJ2FwaS9uZy4nICsgcmVxdWlyZS5uYW1lfSwgcmVxdWlyZS5uYW1lKTsKICAgICAgICB9KTsKICAgICAgICBkb20uaHRtbChyZXF1aXJlLnRleHQpOwogICAgICB9KTsKCiAgICAgIChzZWxmWydodG1sX3VzYWdlXycgKyBzZWxmLm5nZG9jXSB8fCBmdW5jdGlvbigpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkRvbid0IGtub3cgaG93IHRvIGZvcm1hdCBAbmdkb2M6ICIgKyBzZWxmLm5nZG9jKTsKICAgICAgfSkuY2FsbChzZWxmLCBkb20pOwoKICAgICAgZG9tLmgoJ0V4YW1wbGUnLCBzZWxmLmV4YW1wbGUsIGRvbS5odG1sKTsKICAgIH0pOwoKICAgIHNlbGYuYW5jaG9ycyA9IGRvbS5hbmNob3JzOwoKICAgIHJldHVybiBkb20udG9TdHJpbmcoKTsKCiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgIGZ1bmN0aW9uIG5vdGljZShuYW1lLCBsZWdlbmQsIG1zZyl7CiAgICAgIGlmIChzZWxmW25hbWVdID09PSB1bmRlZmluZWQpIHJldHVybjsKICAgICAgZG9tLnRhZygnZmllbGRzZXQnLCB7J2NsYXNzJzpuYW1lfSwgZnVuY3Rpb24oZG9tKXsKICAgICAgICBkb20udGFnKCdsZWdlbmQnLCBsZWdlbmQpOwogICAgICAgIGRvbS50ZXh0KG1zZyk7CiAgICAgIH0pOwogICAgfQoKICB9LAoKICBwcmVwYXJlX3R5cGVfaGludF9jbGFzc19uYW1lIDogZnVuY3Rpb24odHlwZSkgewogICAgdmFyIHR5cGVDbGFzcyA9IHR5cGUudG9Mb3dlckNhc2UoKS5tYXRjaCgvXlstXHddKy8pIHx8IFtdOwogICAgdHlwZUNsYXNzID0gdHlwZUNsYXNzWzBdID8gdHlwZUNsYXNzWzBdIDogJ29iamVjdCc7CiAgICByZXR1cm4gJ2xhYmVsIHR5cGUtaGludCB0eXBlLWhpbnQtJyArIHR5cGVDbGFzczsKICB9LAoKICBodG1sX3VzYWdlX3BhcmFtZXRlcnM6IGZ1bmN0aW9uKGRvbSkgewogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgdmFyIHBhcmFtcyA9IHRoaXMucGFyYW0gPyB0aGlzLnBhcmFtIDogW107CiAgICBpZih0aGlzLmFuaW1hdGlvbnMpIHsKICAgICAgZG9tLmgoJ0FuaW1hdGlvbnMnLCB0aGlzLmFuaW1hdGlvbnMsIGZ1bmN0aW9uKGFuaW1hdGlvbnMpewogICAgICAgIGRvbS5odG1sKCc8dWw+Jyk7CiAgICAgICAgdmFyIGFuaW1hdGlvbnMgPSBhbmltYXRpb25zLnNwbGl0KCJcbiIpOwogICAgICAgIGFuaW1hdGlvbnMuZm9yRWFjaChmdW5jdGlvbihhbmkpIHsKICAgICAgICAgIGRvbS5odG1sKCc8bGk+Jyk7CiAgICAgICAgICBkb20udGV4dChhbmkpOwogICAgICAgICAgZG9tLmh0bWwoJzwvbGk+Jyk7CiAgICAgICAgfSk7CiAgICAgICAgZG9tLmh0bWwoJzwvdWw+Jyk7CiAgICAgIH0pOwogICAgICBkb20uaHRtbCgnPGEgaHJlZj0iYXBpL25nQW5pbWF0ZS4kYW5pbWF0ZSI+Q2xpY2sgaGVyZTwvYT4gdG8gbGVhcm4gbW9yZSBhYm91dCB0aGUgc3RlcHMgaW52b2x2ZWQgaW4gdGhlIGFuaW1hdGlvbi4nKTsKICAgIH0KICAgIGlmKHBhcmFtcy5sZW5ndGggPiAwKSB7CiAgICAgIGRvbS5odG1sKCc8aDI+UGFyYW1ldGVyczwvaDI+Jyk7CiAgICAgIGRvbS5odG1sKCc8dGFibGUgY2xhc3M9InZhcmlhYmxlcy1tYXRyaXggdGFibGUgdGFibGUtYm9yZGVyZWQgdGFibGUtc3RyaXBlZCI+Jyk7CiAgICAgIGRvbS5odG1sKCc8dGhlYWQ+Jyk7CiAgICAgIGRvbS5odG1sKCc8dHI+Jyk7CiAgICAgIGRvbS5odG1sKCc8dGg+UGFyYW08L3RoPicpOwogICAgICBkb20uaHRtbCgnPHRoPlR5cGU8L3RoPicpOwogICAgICBkb20uaHRtbCgnPHRoPkRldGFpbHM8L3RoPicpOwogICAgICBkb20uaHRtbCgnPC90cj4nKTsKICAgICAgZG9tLmh0bWwoJzwvdGhlYWQ+Jyk7CiAgICAgIGRvbS5odG1sKCc8dGJvZHk+Jyk7CiAgICAgIGZvcih2YXIgaT0wO2k8cGFyYW1zLmxlbmd0aDtpKyspIHsKICAgICAgICBwYXJhbSA9IHBhcmFtc1tpXTsKICAgICAgICB2YXIgbmFtZSA9IHBhcmFtLm5hbWU7CiAgICAgICAgdmFyIHR5cGVzID0gcGFyYW0udHlwZTsKICAgICAgICBpZih0eXBlc1swXT09JygnKSB7CiAgICAgICAgICB0eXBlcyA9IHR5cGVzLnN1YnN0cigxKTsKICAgICAgICB9CgogICAgICAgIHZhciBsaW1pdCA9IHR5cGVzLmxlbmd0aCAtIDE7CiAgICAgICAgaWYodHlwZXMuY2hhckF0KGxpbWl0KSA9PSAnKScgJiYgdHlwZXMuY2hhckF0KGxpbWl0LTEpICE9ICcoJykgewogICAgICAgICAgdHlwZXMgPSB0eXBlcy5zdWJzdHIoMCxsaW1pdCk7CiAgICAgICAgfQogICAgICAgIHR5cGVzID0gdHlwZXMuc3BsaXQoL1x8KD8hW1woXClcd1x8XHNdKz4pLyk7CiAgICAgICAgaWYgKHBhcmFtLm9wdGlvbmFsKSB7CiAgICAgICAgICBuYW1lICs9ICcgPGRpdj48ZW0+KG9wdGlvbmFsKTwvZW0+PC9kaXY+JzsKICAgICAgICB9CiAgICAgICAgZG9tLmh0bWwoJzx0cj4nKTsKICAgICAgICBkb20uaHRtbCgnPHRkPicgKyBuYW1lICsgJzwvdGQ+Jyk7CiAgICAgICAgZG9tLmh0bWwoJzx0ZD4nKTsKICAgICAgICBmb3IodmFyIGo9MDtqPHR5cGVzLmxlbmd0aDtqKyspIHsKICAgICAgICAgIHZhciB0eXBlID0gdHlwZXNbal07CiAgICAgICAgICBkb20uaHRtbCgnPGEgaHJlZj0iIiBjbGFzcz0iJyArIHNlbGYucHJlcGFyZV90eXBlX2hpbnRfY2xhc3NfbmFtZSh0eXBlKSArICciPicpOwogICAgICAgICAgZG9tLnRleHQodHlwZSk7CiAgICAgICAgICBkb20uaHRtbCgnPC9hPicpOwogICAgICAgIH0KCiAgICAgICAgZG9tLmh0bWwoJzwvdGQ+Jyk7CiAgICAgICAgdmFyIGRlc2NyaXB0aW9uID0gJzx0ZD4nOwogICAgICAgIGRlc2NyaXB0aW9uICs9IHBhcmFtLmRlc2NyaXB0aW9uOwogICAgICAgIGlmIChwYXJhbS5kZWZhdWx0KSB7CiAgICAgICAgICBkZXNjcmlwdGlvbiArPSAnIDxwPjxlbT4oZGVmYXVsdDogJyArIHBhcmFtLmRlZmF1bHQgKyAnKTwvZW0+PC9wPic7CiAgICAgICAgfQogICAgICAgIGRlc2NyaXB0aW9uICs9ICc8L3RkPic7CiAgICAgICAgZG9tLmh0bWwoZGVzY3JpcHRpb24pOwogICAgICAgIGRvbS5odG1sKCc8L3RyPicpOwogICAgICB9OwogICAgICBkb20uaHRtbCgnPC90Ym9keT4nKTsKICAgICAgZG9tLmh0bWwoJzwvdGFibGU+Jyk7CiAgICB9CiAgfSwKCiAgaHRtbF91c2FnZV9yZXR1cm5zOiBmdW5jdGlvbihkb20pIHsKICAgIHZhciBzZWxmID0gdGhpczsKICAgIGlmIChzZWxmLnJldHVybnMpIHsKICAgICAgZG9tLmh0bWwoJzxoMj5SZXR1cm5zPC9oMj4nKTsKICAgICAgZG9tLmh0bWwoJzx0YWJsZSBjbGFzcz0idmFyaWFibGVzLW1hdHJpeCI+Jyk7CiAgICAgIGRvbS5odG1sKCc8dHI+Jyk7CiAgICAgIGRvbS5odG1sKCc8dGQ+Jyk7CiAgICAgIGRvbS5odG1sKCc8YSBocmVmPSIiIGNsYXNzPSInICsgc2VsZi5wcmVwYXJlX3R5cGVfaGludF9jbGFzc19uYW1lKHNlbGYucmV0dXJucy50eXBlKSArICciPicpOwogICAgICBkb20udGV4dChzZWxmLnJldHVybnMudHlwZSk7CiAgICAgIGRvbS5odG1sKCc8L2E+Jyk7CiAgICAgIGRvbS5odG1sKCc8L3RkPicpOwogICAgICBkb20uaHRtbCgnPHRkPicpOwogICAgICBkb20uaHRtbChzZWxmLnJldHVybnMuZGVzY3JpcHRpb24pOwogICAgICBkb20uaHRtbCgnPC90ZD4nKTsKICAgICAgZG9tLmh0bWwoJzwvdHI+Jyk7CiAgICAgIGRvbS5odG1sKCc8L3RhYmxlPicpOwogICAgfQogIH0sCgogIGh0bWxfdXNhZ2VfdGhpczogZnVuY3Rpb24oZG9tKSB7CiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICBpZiAoc2VsZlsndGhpcyddKSB7CiAgICAgIGRvbS5oKGZ1bmN0aW9uKGRvbSl7CiAgICAgICAgZG9tLmh0bWwoIk1ldGhvZCdzIDxjb2RlPnRoaXM8L2NvZGU+Iik7CiAgICAgIH0sIGZ1bmN0aW9uKGRvbSl7CiAgICAgICAgZG9tLmh0bWwoc2VsZlsndGhpcyddKTsKICAgICAgfSk7CiAgICB9CiAgfSwKCiAgaHRtbF91c2FnZV9mdW5jdGlvbjogZnVuY3Rpb24oZG9tKXsKICAgIHZhciBzZWxmID0gdGhpczsKICAgIHZhciBuYW1lID0gc2VsZi5uYW1lLm1hdGNoKC9eYW5ndWxhcihcLm1vY2spP1wuKFx3KykkLykgPyBzZWxmLm5hbWUgOiBzZWxmLm5hbWUuc3BsaXQoL1wuLykucG9wKCkKCiAgICBkb20uaCgnVXNhZ2UnLCBmdW5jdGlvbigpIHsKICAgICAgZG9tLmNvZGUoZnVuY3Rpb24oKSB7CiAgICAgICAgZG9tLnRleHQobmFtZSk7CiAgICAgICAgZG9tLnRleHQoJygnKTsKICAgICAgICBzZWxmLnBhcmFtZXRlcnMoZG9tLCAnLCAnKTsKICAgICAgICBkb20udGV4dCgnKTsnKTsKICAgICAgfSk7CgogICAgICBzZWxmLmh0bWxfdXNhZ2VfcGFyYW1ldGVycyhkb20pOwogICAgICBzZWxmLmh0bWxfdXNhZ2VfdGhpcyhkb20pOwogICAgICBzZWxmLmh0bWxfdXNhZ2VfcmV0dXJucyhkb20pOwogICAgfSk7CiAgICB0aGlzLm1ldGhvZF9wcm9wZXJ0aWVzX2V2ZW50cyhkb20pOwogIH0sCgogIGh0bWxfdXNhZ2VfcHJvcGVydHk6IGZ1bmN0aW9uKGRvbSl7CiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICBkb20uaCgnVXNhZ2UnLCBmdW5jdGlvbigpIHsKICAgICAgZG9tLmNvZGUoZnVuY3Rpb24oKSB7CiAgICAgICAgZG9tLnRleHQoc2VsZi5uYW1lKTsKICAgICAgfSk7CgogICAgICBzZWxmLmh0bWxfdXNhZ2VfcmV0dXJucyhkb20pOwogICAgfSk7CiAgfSwKCiAgaHRtbF91c2FnZV9kaXJlY3RpdmU6IGZ1bmN0aW9uKGRvbSl7CiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICBkb20uaCgnVXNhZ2UnLCBmdW5jdGlvbigpIHsKICAgICAgdmFyIHJlc3RyaWN0ID0gc2VsZi5yZXN0cmljdCB8fCAnQSc7CgogICAgICBpZiAocmVzdHJpY3QubWF0Y2goL0UvKSkgewogICAgICAgIGRvbS5odG1sKCc8cD4nKTsKICAgICAgICBkb20udGV4dCgnVGhpcyBkaXJlY3RpdmUgY2FuIGJlIHVzZWQgYXMgY3VzdG9tIGVsZW1lbnQsIGJ1dCBiZSBhd2FyZSBvZiAnKTsKICAgICAgICBkb20udGFnKCdhJywge2hyZWY6J2d1aWRlL2llJ30sICdJRSByZXN0cmljdGlvbnMnKTsKICAgICAgICBkb20udGV4dCgnLicpOwogICAgICAgIGRvbS5odG1sKCc8L3A+Jyk7CiAgICAgIH0KCiAgICAgIGlmIChzZWxmLnVzYWdlKSB7CiAgICAgICAgZG9tLnRhZygncHJlJywgZnVuY3Rpb24oKSB7CiAgICAgICAgICBkb20udGFnKCdjb2RlJywgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGRvbS50ZXh0KHNlbGYudXNhZ2UpOwogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKHJlc3RyaWN0Lm1hdGNoKC9FLykpIHsKICAgICAgICAgIGRvbS50ZXh0KCdhcyBlbGVtZW50OicpOwogICAgICAgICAgZG9tLmNvZGUoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGRvbS50ZXh0KCc8Jyk7CiAgICAgICAgICAgIGRvbS50ZXh0KGRhc2hDYXNlKHNlbGYuc2hvcnROYW1lKSk7CiAgICAgICAgICAgIHJlbmRlclBhcmFtcygnXG4gICAgICAgJywgJz0iJywgJyInKTsKICAgICAgICAgICAgZG9tLnRleHQoJz5cbjwvJyk7CiAgICAgICAgICAgIGRvbS50ZXh0KGRhc2hDYXNlKHNlbGYuc2hvcnROYW1lKSk7CiAgICAgICAgICAgIGRvbS50ZXh0KCc+Jyk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgaWYgKHJlc3RyaWN0Lm1hdGNoKC9BLykpIHsKICAgICAgICAgIHZhciBlbGVtZW50ID0gc2VsZi5lbGVtZW50IHx8ICdBTlknOwogICAgICAgICAgZG9tLnRleHQoJ2FzIGF0dHJpYnV0ZScpOwogICAgICAgICAgZG9tLmNvZGUoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGRvbS50ZXh0KCc8JyArIGVsZW1lbnQgKyAnICcpOwogICAgICAgICAgICBkb20udGV4dChkYXNoQ2FzZShzZWxmLnNob3J0TmFtZSkpOwogICAgICAgICAgICByZW5kZXJQYXJhbXMoJ1xuICAgICAnLCAnPSInLCAnIicsIHRydWUpOwogICAgICAgICAgICBkb20udGV4dCgnPlxuICAgLi4uXG4nKTsKICAgICAgICAgICAgZG9tLnRleHQoJzwvJyArIGVsZW1lbnQgKyAnPicpOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGlmIChyZXN0cmljdC5tYXRjaCgvQy8pKSB7CiAgICAgICAgICBkb20udGV4dCgnYXMgY2xhc3MnKTsKICAgICAgICAgIHZhciBlbGVtZW50ID0gc2VsZi5lbGVtZW50IHx8ICdBTlknOwogICAgICAgICAgZG9tLmNvZGUoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGRvbS50ZXh0KCc8JyArIGVsZW1lbnQgKyAnIGNsYXNzPSInKTsKICAgICAgICAgICAgZG9tLnRleHQoZGFzaENhc2Uoc2VsZi5zaG9ydE5hbWUpKTsKICAgICAgICAgICAgcmVuZGVyUGFyYW1zKCcgJywgJzogJywgJzsnLCB0cnVlKTsKICAgICAgICAgICAgZG9tLnRleHQoJyI+XG4gICAuLi5cbicpOwogICAgICAgICAgICBkb20udGV4dCgnPC8nICsgZWxlbWVudCArICc+Jyk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgICAgc2VsZi5odG1sX3VzYWdlX2RpcmVjdGl2ZUluZm8oZG9tKTsKICAgICAgc2VsZi5odG1sX3VzYWdlX3BhcmFtZXRlcnMoZG9tKTsKICAgIH0pOwoKICAgIHNlbGYubWV0aG9kX3Byb3BlcnRpZXNfZXZlbnRzKGRvbSk7CgogICAgZnVuY3Rpb24gcmVuZGVyUGFyYW1zKHByZWZpeCwgaW5maXgsIHN1ZmZpeCwgc2tpcFNlbGYpIHsKICAgICAgKHNlbGYucGFyYW18fFtdKS5mb3JFYWNoKGZ1bmN0aW9uKHBhcmFtKSB7CiAgICAgICAgdmFyIHNraXAgPSBza2lwU2VsZiAmJiAocGFyYW0ubmFtZSA9PSBzZWxmLnNob3J0TmFtZSB8fCBwYXJhbS5uYW1lLmluZGV4T2Yoc2VsZi5zaG9ydE5hbWUgKyAnfCcpID09IDApOwogICAgICAgIGlmICghc2tpcCkgewogICAgICAgICAgZG9tLnRleHQocHJlZml4KTsKICAgICAgICAgIGRvbS50ZXh0KHBhcmFtLm9wdGlvbmFsID8gJ1snIDogJycpOwogICAgICAgICAgdmFyIHBhcnRzID0gcGFyYW0ubmFtZS5zcGxpdCgnfCcpOwogICAgICAgICAgZG9tLnRleHQoZGFzaENhc2UocGFydHNbc2tpcFNlbGYgPyAwIDogMV0gfHwgcGFydHNbMF0pKTsKICAgICAgICB9CiAgICAgICAgaWYgKEJPT0xFQU5fQVRUUltwYXJhbS5uYW1lXSkgewogICAgICAgICAgZG9tLnRleHQocGFyYW0ub3B0aW9uYWwgPyAnXScgOiAnJyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGRvbS50ZXh0KEJPT0xFQU5fQVRUUltwYXJhbS5uYW1lXSA/ICcnIDogaW5maXggKTsKICAgICAgICAgIGRvbS50ZXh0KCgneycgKyBwYXJhbS50eXBlICsgJ30nKS5yZXBsYWNlKC9eXHtcJyguKilcJ1x9JC8sICckMScpKTsKICAgICAgICAgIGRvbS50ZXh0KHN1ZmZpeCk7CiAgICAgICAgICBkb20udGV4dChwYXJhbS5vcHRpb25hbCAmJiAhc2tpcCA/ICddJyA6ICcnKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQoKICB9LAoKICBodG1sX3VzYWdlX2ZpbHRlcjogZnVuY3Rpb24oZG9tKXsKICAgIHZhciBzZWxmID0gdGhpczsKICAgIGRvbS5oKCdVc2FnZScsIGZ1bmN0aW9uKCkgewogICAgICBkb20uaCgnSW4gSFRNTCBUZW1wbGF0ZSBCaW5kaW5nJywgZnVuY3Rpb24oKSB7CiAgICAgICAgZG9tLnRhZygnY29kZScsIGZ1bmN0aW9uKCkgewogICAgICAgICAgaWYgKHNlbGYudXNhZ2UpIHsKICAgICAgICAgICAgZG9tLnRleHQoc2VsZi51c2FnZSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBkb20udGV4dCgne3sgJyk7CiAgICAgICAgICAgIGRvbS50ZXh0KHNlbGYuc2hvcnROYW1lKTsKICAgICAgICAgICAgZG9tLnRleHQoJ19leHByZXNzaW9uIHwgJyk7CiAgICAgICAgICAgIGRvbS50ZXh0KHNlbGYuc2hvcnROYW1lKTsKICAgICAgICAgICAgc2VsZi5wYXJhbWV0ZXJzKGRvbSwgJzonLCB0cnVlKTsKICAgICAgICAgICAgZG9tLnRleHQoJyB9fScpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9KTsKCiAgICAgIGRvbS5oKCdJbiBKYXZhU2NyaXB0JywgZnVuY3Rpb24oKSB7CiAgICAgICAgZG9tLnRhZygnY29kZScsIGZ1bmN0aW9uKCkgewogICAgICAgICAgZG9tLnRleHQoJyRmaWx0ZXIoXCcnKTsKICAgICAgICAgIGRvbS50ZXh0KHNlbGYuc2hvcnROYW1lKTsKICAgICAgICAgIGRvbS50ZXh0KCdcJykoJyk7CiAgICAgICAgICBzZWxmLnBhcmFtZXRlcnMoZG9tLCAnLCAnKTsKICAgICAgICAgIGRvbS50ZXh0KCcpJyk7CiAgICAgICAgfSk7CiAgICAgIH0pOwoKICAgICAgc2VsZi5odG1sX3VzYWdlX3BhcmFtZXRlcnMoZG9tKTsKICAgICAgc2VsZi5odG1sX3VzYWdlX3RoaXMoZG9tKTsKICAgICAgc2VsZi5odG1sX3VzYWdlX3JldHVybnMoZG9tKTsKICAgIH0pOwogIH0sCgogIGh0bWxfdXNhZ2VfaW5wdXRUeXBlOiBmdW5jdGlvbihkb20pewogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgZG9tLmgoJ1VzYWdlJywgZnVuY3Rpb24oKSB7CiAgICAgIGRvbS5jb2RlKGZ1bmN0aW9uKCkgewogICAgICAgIGRvbS50ZXh0KCc8aW5wdXQgdHlwZT0iJyArIHNlbGYuc2hvcnROYW1lICsgJyInKTsKICAgICAgICAoc2VsZi5wYXJhbXx8W10pLmZvckVhY2goZnVuY3Rpb24ocGFyYW0pewogICAgICAgICAgZG9tLnRleHQoJ1xuICAgICAgJyk7CiAgICAgICAgICBkb20udGV4dChwYXJhbS5vcHRpb25hbCA/ICcgWycgOiAnICcpOwogICAgICAgICAgZG9tLnRleHQoZGFzaENhc2UocGFyYW0ubmFtZSkpOwogICAgICAgICAgZG9tLnRleHQoQk9PTEVBTl9BVFRSW3BhcmFtLm5hbWVdID8gJycgOiAnPSJ7JyArIHBhcmFtLnR5cGUgKyAnfSInKTsKICAgICAgICAgIGRvbS50ZXh0KHBhcmFtLm9wdGlvbmFsID8gJ10nIDogJycpOwogICAgICAgIH0pOwogICAgICAgIGRvbS50ZXh0KCc+Jyk7CiAgICAgIH0pOwogICAgICBzZWxmLmh0bWxfdXNhZ2VfcGFyYW1ldGVycyhkb20pOwogICAgfSk7CiAgfSwKCiAgaHRtbF91c2FnZV9kaXJlY3RpdmVJbmZvOiBmdW5jdGlvbihkb20pIHsKICAgIHZhciBzZWxmID0gdGhpczsKICAgIHZhciBsaXN0ID0gW107CgoKICAgIGlmIChzZWxmLnNjb3BlICE9PSB1bmRlZmluZWQpIHsKICAgICAgbGlzdC5wdXNoKCdUaGlzIGRpcmVjdGl2ZSBjcmVhdGVzIG5ldyBzY29wZS4nKTsKICAgIH0KICAgIGlmIChzZWxmLnByaW9yaXR5ICE9PSB1bmRlZmluZWQpIHsKICAgICAgbGlzdC5wdXNoKCdUaGlzIGRpcmVjdGl2ZSBleGVjdXRlcyBhdCBwcmlvcml0eSBsZXZlbCAnICsgc2VsZi5wcmlvcml0eSArICcuJyk7CiAgICB9CgogICAgaWYgKGxpc3QubGVuZ3RoKSB7CiAgICAgIGRvbS5oKCdEaXJlY3RpdmUgaW5mbycsIGZ1bmN0aW9uKCkgewogICAgICAgIGRvbS51bChsaXN0KTsKICAgICAgfSk7CiAgICB9CiAgfSwKCiAgaHRtbF91c2FnZV9vdmVydmlldzogZnVuY3Rpb24oZG9tKXsKICAgIGRvbS5odG1sKHRoaXMuZGVzY3JpcHRpb24pOwogIH0sCgogIGh0bWxfdXNhZ2VfZXJyb3I6IGZ1bmN0aW9uIChkb20pIHsKICAgIGRvbS5odG1sKCk7CiAgfSwKCiAgaHRtbF91c2FnZV9pbnRlcmZhY2U6IGZ1bmN0aW9uKGRvbSl7CiAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgaWYgKHRoaXMucGFyYW0ubGVuZ3RoKSB7CiAgICAgIGRvbS5oKCdVc2FnZScsIGZ1bmN0aW9uKCkgewogICAgICAgIGRvbS5jb2RlKGZ1bmN0aW9uKCkgewogICAgICAgICAgZG9tLnRleHQoc2VsZi5uYW1lLnNwbGl0KCcuJykucG9wKCkpOwogICAgICAgICAgZG9tLnRleHQoJygnKTsKICAgICAgICAgIHNlbGYucGFyYW1ldGVycyhkb20sICcsICcpOwogICAgICAgICAgZG9tLnRleHQoJyk7Jyk7CiAgICAgICAgfSk7CgogICAgICAgIHNlbGYuaHRtbF91c2FnZV9wYXJhbWV0ZXJzKGRvbSk7CiAgICAgICAgc2VsZi5odG1sX3VzYWdlX3RoaXMoZG9tKTsKICAgICAgICBzZWxmLmh0bWxfdXNhZ2VfcmV0dXJucyhkb20pOwogICAgICB9KTsKICAgIH0KICAgIHRoaXMubWV0aG9kX3Byb3BlcnRpZXNfZXZlbnRzKGRvbSk7CiAgfSwKCiAgaHRtbF91c2FnZV9zZXJ2aWNlOiBmdW5jdGlvbihkb20pIHsKICAgIHRoaXMuaHRtbF91c2FnZV9pbnRlcmZhY2UoZG9tKQogIH0sCgogIGh0bWxfdXNhZ2Vfb2JqZWN0OiBmdW5jdGlvbihkb20pIHsKICAgIHRoaXMuaHRtbF91c2FnZV9pbnRlcmZhY2UoZG9tKQogIH0sCgogIG1ldGhvZF9wcm9wZXJ0aWVzX2V2ZW50czogZnVuY3Rpb24oZG9tKSB7CiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICBpZiAoc2VsZi5tZXRob2RzLmxlbmd0aCkgewogICAgICBkb20uZGl2KHtjbGFzczonbWVtYmVyIG1ldGhvZCd9LCBmdW5jdGlvbigpewogICAgICAgIGRvbS5oKCdNZXRob2RzJywgc2VsZi5tZXRob2RzLCBmdW5jdGlvbihtZXRob2QpewogICAgICAgICAgdmFyIHNpZ25hdHVyZSA9IChtZXRob2QucGFyYW0gfHwgW10pLm1hcChwcm9wZXJ0eSgnbmFtZScpKTsKICAgICAgICAgIGRvbS5oKG1ldGhvZC5zaG9ydE5hbWUgKyAnKCcgKyBzaWduYXR1cmUuam9pbignLCAnKSArICcpJywgbWV0aG9kLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgZG9tLmh0bWwobWV0aG9kLmRlc2NyaXB0aW9uKTsKICAgICAgICAgICAgbWV0aG9kLmh0bWxfdXNhZ2VfcGFyYW1ldGVycyhkb20pOwogICAgICAgICAgICBzZWxmLmh0bWxfdXNhZ2VfdGhpcyhkb20pOwogICAgICAgICAgICBtZXRob2QuaHRtbF91c2FnZV9yZXR1cm5zKGRvbSk7CgogICAgICAgICAgICBkb20uaCgnRXhhbXBsZScsIG1ldGhvZC5leGFtcGxlLCBkb20uaHRtbCk7CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CiAgICBpZiAoc2VsZi5wcm9wZXJ0aWVzLmxlbmd0aCkgewogICAgICBkb20uZGl2KHtjbGFzczonbWVtYmVyIHByb3BlcnR5J30sIGZ1bmN0aW9uKCl7CiAgICAgICAgZG9tLmgoJ1Byb3BlcnRpZXMnLCBzZWxmLnByb3BlcnRpZXMsIGZ1bmN0aW9uKHByb3BlcnR5KXsKICAgICAgICAgIGRvbS5oKHByb3BlcnR5LnNob3J0TmFtZSwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGRvbS5odG1sKHByb3BlcnR5LmRlc2NyaXB0aW9uKTsKICAgICAgICAgICAgaWYgKCFwcm9wZXJ0eS5odG1sX3VzYWdlX3JldHVybnMpIHsKICAgICAgICAgICAgICBjb25zb2xlLmxvZyhwcm9wZXJ0eSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcHJvcGVydHkuaHRtbF91c2FnZV9yZXR1cm5zKGRvbSk7CiAgICAgICAgICAgIGRvbS5oKCdFeGFtcGxlJywgcHJvcGVydHkuZXhhbXBsZSwgZG9tLmh0bWwpOwogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogICAgaWYgKHNlbGYuZXZlbnRzLmxlbmd0aCkgewogICAgICBkb20uZGl2KHtjbGFzczonbWVtYmVyIGV2ZW50J30sIGZ1bmN0aW9uKCl7CiAgICAgICAgZG9tLmgoJ0V2ZW50cycsIHNlbGYuZXZlbnRzLCBmdW5jdGlvbihldmVudCl7CiAgICAgICAgICBkb20uaChldmVudC5zaG9ydE5hbWUsIGV2ZW50LCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgZG9tLmh0bWwoZXZlbnQuZGVzY3JpcHRpb24pOwogICAgICAgICAgICBpZiAoZXZlbnQudHlwZSA9PSAnbGlzdGVuJykgewogICAgICAgICAgICAgIGRvbS50YWcoJ2RpdicsIHtjbGFzczonaW5saW5lJ30sIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgZG9tLmgoJ0xpc3RlbiBvbjonLCBldmVudC50YXJnZXQpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGRvbS50YWcoJ2RpdicsIHtjbGFzczonaW5saW5lJ30sIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgZG9tLmgoJ1R5cGU6JywgZXZlbnQudHlwZSk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgZG9tLnRhZygnZGl2Jywge2NsYXNzOidpbmxpbmUnfSwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBkb20uaCgnVGFyZ2V0OicsIGV2ZW50LnRhcmdldCk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZXZlbnQuaHRtbF91c2FnZV9wYXJhbWV0ZXJzKGRvbSk7CiAgICAgICAgICAgIHNlbGYuaHRtbF91c2FnZV90aGlzKGRvbSk7CgogICAgICAgICAgICBkb20uaCgnRXhhbXBsZScsIGV2ZW50LmV4YW1wbGUsIGRvbS5odG1sKTsKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KICB9LAoKICBwYXJhbWV0ZXJzOiBmdW5jdGlvbihkb20sIHNlcGFyYXRvciwgc2tpcEZpcnN0LCBwcmVmaXgpIHsKICAgIHZhciBzZXAgPSBwcmVmaXggPyBzZXBhcmF0b3IgOiAnJzsKICAgICh0aGlzLnBhcmFtfHxbXSkuZm9yRWFjaChmdW5jdGlvbihwYXJhbSwgaSl7CiAgICAgIGlmICghKHNraXBGaXJzdCAmJiBpPT0wKSkgewogICAgICAgIGlmIChwYXJhbS5vcHRpb25hbCkgewogICAgICAgICAgZG9tLnRleHQoJ1snICsgc2VwICsgcGFyYW0ubmFtZSArICddJyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGRvbS50ZXh0KHNlcCArIHBhcmFtLm5hbWUpOwogICAgICAgIH0KICAgICAgfQogICAgICBzZXAgPSBzZXBhcmF0b3I7CiAgICB9KTsKICB9Cgp9OwovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgoKLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwp2YXIgR0xPQkFMUyA9IC9eYW5ndWxhclwuKFteXC5dKykkLywKICAgIE1PRFVMRSA9IC9eKCg/Oig/IV5hbmd1bGFyXC4pW15cLl0pKykkLywKICAgIE1PRFVMRV9NT0NLID0gL15hbmd1bGFyXC5tb2NrXC4oW15cLl0rKSQvLAogICAgTU9EVUxFX0RJUkVDVElWRSA9IC9eKCg/Oig/IV5hbmd1bGFyXC4pW15cLl0pKylcLmRpcmVjdGl2ZTooW15cLl0rKSQvLAogICAgTU9EVUxFX0RJUkVDVElWRV9JTlBVVCA9IC9eKCg/Oig/IV5hbmd1bGFyXC4pW15cLl0pKylcLmRpcmVjdGl2ZTppbnB1dFwuKFteXC5dKykkLywKICAgIE1PRFVMRV9GSUxURVIgPSAvXigoPzooPyFeYW5ndWxhclwuKVteXC5dKSspXC5maWx0ZXI6KFteXC5dKykkLywKICAgIE1PRFVMRV9TRVJWSUNFID0gL14oKD86KD8hXmFuZ3VsYXJcLilbXlwuXSkrKVwuKFteXC5dKz8pKFByb3ZpZGVyKT8kLywKICAgIE1PRFVMRV9UWVBFID0gL14oKD86KD8hXmFuZ3VsYXJcLilbXlwuXSkrKVwuLitcLihbQS1aXVteXC5dKykkLzsKCgpmdW5jdGlvbiB0aXRsZShkb2MpIHsKICBpZiAoIWRvYy5uYW1lKSByZXR1cm4gZG9jLm5hbWU7CiAgdmFyIG1hdGNoLAogICAgdGV4dCA9IGRvYy5uYW1lOwoKICB2YXIgbWFrZVRpdGxlID0gZnVuY3Rpb24gKG5hbWUsIHR5cGUsIGNvbXBvbmVudFR5cGUsIGNvbXBvbmVudCkgewogICAgLy8gTWFrZXMgdGl0bGUgbWFya3VwLgogICAgLy8gbWFrZVRpdGxlKCdGb28nLCAnZGlyZWN0aXZlJywgJ21vZHVsZScsICduZycpIC0+CiAgICAvLyAgICBGb28gaXMgYSBkaXJlY3RpdmUgaW4gbW9kdWxlIG5nCiAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICB0aGlzLnRhZygnY29kZScsIG5hbWUpOwogICAgICB0aGlzLnRhZygnZGl2JywgZnVuY3Rpb24gKCkgewogICAgICAgIHRoaXMudGFnKCdzcGFuJywge2NsYXNzOiAnaGludCd9LCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBpZiAodHlwZSAmJiBjb21wb25lbnQpIHsKICAgICAgICAgICAgdGhpcy50ZXh0KHR5cGUgKyAnIGluICcgKyBjb21wb25lbnRUeXBlICsgJyAnKTsKICAgICAgICAgICAgdGhpcy50YWcoJ2NvZGUnLCBjb21wb25lbnQpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9KTsKICAgIH07CiAgfTsKCiAgaWYgKGRvYy5uZ2RvYyA9PT0gJ2Vycm9yJykgewogICAgcmV0dXJuIG1ha2VUaXRsZShkb2MuZnVsbE5hbWUsICdlcnJvcicsICdjb21wb25lbnQnLCBkb2MuZ2V0TWluZXJyTmFtZXNwYWNlKCkpOwogIH0gZWxzZSBpZiAodGV4dCA9PSAnYW5ndWxhci5Nb2R1bGUnKSB7CiAgICByZXR1cm4gbWFrZVRpdGxlKCdNb2R1bGUnLCAnVHlwZScsICdtb2R1bGUnLCAnbmcnKTsKICB9IGVsc2UgaWYgKG1hdGNoID0gdGV4dC5tYXRjaChHTE9CQUxTKSkgewogICAgcmV0dXJuIG1ha2VUaXRsZSgnYW5ndWxhci4nICsgbWF0Y2hbMV0sICdBUEknLCAnbW9kdWxlJywgJ25nJyk7CiAgfSBlbHNlIGlmIChtYXRjaCA9IHRleHQubWF0Y2goTU9EVUxFKSkgewogICAgcmV0dXJuIG1ha2VUaXRsZSgnJywgJycsICdtb2R1bGUnLCBtYXRjaFsxXSk7CiAgfSBlbHNlIGlmIChtYXRjaCA9IHRleHQubWF0Y2goTU9EVUxFX01PQ0spKSB7CiAgICByZXR1cm4gbWFrZVRpdGxlKCdhbmd1bGFyLm1vY2suJyArIG1hdGNoWzFdLCAnQVBJJywgJ21vZHVsZScsICduZycpOwogIH0gZWxzZSBpZiAobWF0Y2ggPSB0ZXh0Lm1hdGNoKE1PRFVMRV9ESVJFQ1RJVkUpKSB7CiAgICByZXR1cm4gbWFrZVRpdGxlKG1hdGNoWzJdLCAnZGlyZWN0aXZlJywgJ21vZHVsZScsIG1hdGNoWzFdKTsKICB9IGVsc2UgaWYgKG1hdGNoID0gdGV4dC5tYXRjaChNT0RVTEVfRElSRUNUSVZFX0lOUFVUKSkgewogICAgcmV0dXJuIG1ha2VUaXRsZSgnaW5wdXQgWycgKyBtYXRjaFsyXSArICddJywgJ2RpcmVjdGl2ZScsICdtb2R1bGUnLCBtYXRjaFsxXSk7CiAgfSBlbHNlIGlmIChtYXRjaCA9IHRleHQubWF0Y2goTU9EVUxFX0ZJTFRFUikpIHsKICAgIHJldHVybiBtYWtlVGl0bGUobWF0Y2hbMl0sICdmaWx0ZXInLCAnbW9kdWxlJywgbWF0Y2hbMV0pOwogIH0gZWxzZSBpZiAobWF0Y2ggPSB0ZXh0Lm1hdGNoKE1PRFVMRV9TRVJWSUNFKSkgewogICAgcmV0dXJuIG1ha2VUaXRsZShtYXRjaFsyXSArIChtYXRjaFszXSB8fCAnJyksICdzZXJ2aWNlJywgJ21vZHVsZScsIG1hdGNoWzFdKTsKICB9IGVsc2UgaWYgKG1hdGNoID0gdGV4dC5tYXRjaChNT0RVTEVfVFlQRSkpIHsKICAgIHJldHVybiBtYWtlVGl0bGUobWF0Y2hbMl0sICd0eXBlJywgJ21vZHVsZScsIG1hdGNoWzFdKTsKICB9CiAgcmV0dXJuIHRleHQ7Cn0KCgpmdW5jdGlvbiBzY2VuYXJpb3MoZG9jcyl7CiAgdmFyIHNwZWNzID0gW107CgogIHNwZWNzLnB1c2goJ2Rlc2NyaWJlKCJhbmd1bGFyK2pxbGl0ZSIsIGZ1bmN0aW9uKCkgeycpOwogIGFwcGVuZFNwZWNzKCdpbmRleC1ub2NhY2hlLmh0bWwjIS8nKTsKICBzcGVjcy5wdXNoKCd9KTsnKTsKCiAgc3BlY3MucHVzaCgnJyk7CiAgc3BlY3MucHVzaCgnJyk7CgogIHNwZWNzLnB1c2goJ2Rlc2NyaWJlKCJhbmd1bGFyK2pxdWVyeSIsIGZ1bmN0aW9uKCkgeycpOwogIGFwcGVuZFNwZWNzKCdpbmRleC1qcS1ub2NhY2hlLmh0bWwjIS8nKTsKICBzcGVjcy5wdXNoKCd9KTsnKTsKCiAgcmV0dXJuIHNwZWNzLmpvaW4oJ1xuJyk7CgogIGZ1bmN0aW9uIGFwcGVuZFNwZWNzKHVybFByZWZpeCkgewogICAgZG9jcy5mb3JFYWNoKGZ1bmN0aW9uKGRvYyl7CiAgICAgIHNwZWNzLnB1c2goJyAgZGVzY3JpYmUoIicgKyBkb2Muc2VjdGlvbiArICcvJyArIGRvYy5pZCArICciLCBmdW5jdGlvbigpIHsnKTsKICAgICAgc3BlY3MucHVzaCgnICAgIGJlZm9yZUVhY2goZnVuY3Rpb24oKSB7Jyk7CiAgICAgIHNwZWNzLnB1c2goJyAgICAgIGJyb3dzZXIoKS5uYXZpZ2F0ZVRvKCInICsgdXJsUHJlZml4ICsgZG9jLnNlY3Rpb24gKyAnLycgKyBkb2MuaWQgKyAnIik7Jyk7CiAgICAgIHNwZWNzLnB1c2goJyAgICB9KTsnKTsKICAgICAgc3BlY3MucHVzaCgnICAnKTsKICAgICAgZG9jLnNjZW5hcmlvcy5mb3JFYWNoKGZ1bmN0aW9uKHNjZW5hcmlvKXsKICAgICAgICBzcGVjcy5wdXNoKGluZGVudENvZGUodHJpbShzY2VuYXJpbyksIDQpKTsKICAgICAgICBzcGVjcy5wdXNoKCcnKTsKICAgICAgfSk7CiAgICAgIHNwZWNzLnB1c2goJ30pOycpOwogICAgICBzcGVjcy5wdXNoKCcnKTsKICAgIH0pOwogIH0KfQoKCi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KZnVuY3Rpb24gbWV0YWRhdGEoZG9jcyl7CiAgdmFyIHBhZ2VzID0gW107CiAgZG9jcy5mb3JFYWNoKGZ1bmN0aW9uKGRvYyl7CiAgICB2YXIgcGF0aCA9IChkb2MubmFtZSB8fCAnJykuc3BsaXQoLyhcOlxzKikvKTsKICAgIGZvciAoIHZhciBpID0gMTsgaSA8IHBhdGgubGVuZ3RoOyBpKyspIHsKICAgICAgcGF0aC5zcGxpY2UoaSwgMSk7CiAgICB9CiAgICB2YXIgc2hvcnROYW1lID0gcGF0aC5wb3AoKS50cmltKCk7CgogICAgaWYgKHBhdGgucG9wKCkgPT0gJ2lucHV0JykgewogICAgICBzaG9ydE5hbWUgPSAnaW5wdXQgWycgKyBzaG9ydE5hbWUgKyAnXSc7CiAgICB9CgogICAgcGFnZXMucHVzaCh7CiAgICAgIHNlY3Rpb246IGRvYy5zZWN0aW9uLAogICAgICBpZDogZG9jLmlkLAogICAgICBuYW1lOiB0aXRsZShkb2MpLAogICAgICBzaG9ydE5hbWU6IHNob3J0TmFtZSwKICAgICAgdHlwZTogZG9jLm5nZG9jLAogICAgICBtb2R1bGVOYW1lOiBkb2MubW9kdWxlTmFtZSwKICAgICAgc2hvcnREZXNjcmlwdGlvbjogZG9jLnNob3J0RGVzY3JpcHRpb24oKSwKICAgICAga2V5d29yZHM6IGRvYy5rZXl3b3JkcygpCiAgICB9KTsKICB9KTsKICBwYWdlcy5zb3J0KHNpZGViYXJTb3J0KTsKICByZXR1cm4gcGFnZXM7Cn0KCnZhciBLRVlXT1JEX1BSSU9SSVRZID0gewogICcuaW5kZXgnOiAxLAogICcub3ZlcnZpZXcnOiAxLAogICcuYm9vdHN0cmFwJzogMiwKICAnLm12Yyc6IDMsCiAgJy5zY29wZXMnOiA0LAogICcuY29tcGlsZXInOiA1LAogICcudGVtcGxhdGVzJzogNiwKICAnLnNlcnZpY2VzJzogNywKICAnLmRpJzogOCwKICAnLnVuaXQtdGVzdGluZyc6IDksCiAgJy5kZXZfZ3VpZGUnOiA5LAogICcuZGV2X2d1aWRlLm92ZXJ2aWV3JzogMSwKICAnLmRldl9ndWlkZS5ib290c3RyYXAnOiAyLAogICcuZGV2X2d1aWRlLmJvb3RzdHJhcC5hdXRvX2Jvb3RzdHJhcCc6IDEsCiAgJy5kZXZfZ3VpZGUuYm9vdHN0cmFwLm1hbnVhbF9ib290c3RyYXAnOiAyLAogICcuZGV2X2d1aWRlLm12Yyc6IDMsCiAgJy5kZXZfZ3VpZGUubXZjLnVuZGVyc3RhbmRpbmdfbW9kZWwnOiAxLAogICcuZGV2X2d1aWRlLm12Yy51bmRlcnN0YW5kaW5nX2NvbnRyb2xsZXInOiAyLAogICcuZGV2X2d1aWRlLm12Yy51bmRlcnN0YW5kaW5nX3ZpZXcnOiAzLAogICcuZGV2X2d1aWRlLnNjb3Blcyc6IDQsCiAgJy5kZXZfZ3VpZGUuc2NvcGVzLnVuZGVyc3RhbmRpbmdfc2NvcGVzJzogMSwKICAnLmRldl9ndWlkZS5zY29wZXMuaW50ZXJuYWxzJzogMiwKICAnLmRldl9ndWlkZS5jb21waWxlcic6IDUsCiAgJy5kZXZfZ3VpZGUudGVtcGxhdGVzJzogNiwKICAnLmRldl9ndWlkZS5zZXJ2aWNlcyc6IDcsCiAgJy5kZXZfZ3VpZGUuZGknOiA4LAogICcuZGV2X2d1aWRlLnVuaXQtdGVzdGluZyc6IDkKfTsKCnZhciBHVUlERV9QUklPUklUWSA9IFsKICAnaW50cm9kdWN0aW9uJywKICAnb3ZlcnZpZXcnLAogICdjb25jZXB0cycsCiAgJ2Rldl9ndWlkZS5tdmMnLAoKICAnZGV2X2d1aWRlLm12Yy51bmRlcnN0YW5kaW5nX2NvbnRyb2xsZXInLAogICdkZXZfZ3VpZGUubXZjLnVuZGVyc3RhbmRpbmdfbW9kZWwnLAogICdkZXZfZ3VpZGUubXZjLnVuZGVyc3RhbmRpbmdfdmlldycsCgogICdkZXZfZ3VpZGUuc2VydmljZXMudW5kZXJzdGFuZGluZ19zZXJ2aWNlcycsCiAgJ2Rldl9ndWlkZS5zZXJ2aWNlcy5tYW5hZ2luZ19kZXBlbmRlbmNpZXMnLAogICdkZXZfZ3VpZGUuc2VydmljZXMuY3JlYXRpbmdfc2VydmljZXMnLAogICdkZXZfZ3VpZGUuc2VydmljZXMuaW5qZWN0aW5nX2NvbnRyb2xsZXJzJywKICAnZGV2X2d1aWRlLnNlcnZpY2VzLnRlc3Rpbmdfc2VydmljZXMnLAogICdkZXZfZ3VpZGUuc2VydmljZXMuJGxvY2F0aW9uJywKICAnZGV2X2d1aWRlLnNlcnZpY2VzJywKCiAgJ2RhdGFiaW5kaW5nJywKICAnZGV2X2d1aWRlLnRlbXBsYXRlcy5jc3Mtc3R5bGluZycsCiAgJ2Rldl9ndWlkZS50ZW1wbGF0ZXMuZmlsdGVycy5jcmVhdGluZ19maWx0ZXJzJywKICAnZGV2X2d1aWRlLnRlbXBsYXRlcy5maWx0ZXJzJywKICAnZGV2X2d1aWRlLnRlbXBsYXRlcy5maWx0ZXJzLnVzaW5nX2ZpbHRlcnMnLAogICdkZXZfZ3VpZGUudGVtcGxhdGVzJywKCiAgJ2RpJywKICAncHJvdmlkZXJzJywKICAnbW9kdWxlJywKICAnc2NvcGUnLAogICdleHByZXNzaW9uJywKICAnYm9vdHN0cmFwJywKICAnZGlyZWN0aXZlJywKICAnY29tcGlsZXInLAoKICAnZm9ybXMnLAogICdhbmltYXRpb25zJywKCiAgJ2Rldl9ndWlkZS5lMmUtdGVzdGluZycsCiAgJ2Rldl9ndWlkZS51bml0LXRlc3RpbmcnLAoKICAnaTE4bicsCiAgJ2llJywKICAnbWlncmF0aW9uJywKXTsKCmZ1bmN0aW9uIHNpZGViYXJTb3J0KGEsIGIpewogIHByaW9yaXR5QSA9IEdVSURFX1BSSU9SSVRZLmluZGV4T2YoYS5pZCk7CiAgcHJpb3JpdHlCID0gR1VJREVfUFJJT1JJVFkuaW5kZXhPZihiLmlkKTsKCiAgaWYgKHByaW9yaXR5QSA+IC0xIHx8IHByaW9yaXR5QiA+IC0xKSB7CiAgICByZXR1cm4gcHJpb3JpdHlBIDwgcHJpb3JpdHlCID8gLTEgOiAocHJpb3JpdHlBID4gcHJpb3JpdHlCID8gMSA6IDApOwogIH0KCiAgZnVuY3Rpb24gbWFuZ2xlTmFtZShkb2MpIHsKICAgIHZhciBwYXRoID0gZG9jLmlkLnNwbGl0KC9cLi8pOwogICAgdmFyIG1hbmdsZWQgPSBbXTsKICAgIHZhciBwYXJ0aWFsTmFtZSA9ICcnOwogICAgcGF0aC5mb3JFYWNoKGZ1bmN0aW9uKG5hbWUpewogICAgICBwYXJ0aWFsTmFtZSArPSAnLicgKyBuYW1lOwogICAgICBtYW5nbGVkLnB1c2goS0VZV09SRF9QUklPUklUWVtwYXJ0aWFsTmFtZV0gfHwgNSk7CiAgICAgIG1hbmdsZWQucHVzaChuYW1lKTsKICAgIH0pOwogICAgcmV0dXJuIChkb2Muc2VjdGlvbiArICcvJyArIG1hbmdsZWQuam9pbignLicpKS50b0xvd2VyQ2FzZSgpOwogIH0KICB2YXIgbmFtZUEgPSBtYW5nbGVOYW1lKGEpOwogIHZhciBuYW1lQiA9IG1hbmdsZU5hbWUoYik7CiAgcmV0dXJuIG5hbWVBIDwgbmFtZUIgPyAtMSA6IChuYW1lQSA+IG5hbWVCID8gMSA6IDApOwp9CgoKLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwpmdW5jdGlvbiB0cmltKHRleHQpIHsKICB2YXIgTUFYX0lOREVOVCA9IDk5OTk7CiAgdmFyIGVtcHR5ID0gUmVnRXhwLnByb3RvdHlwZS50ZXN0LmJpbmQoL15ccyokLyk7CiAgdmFyIGxpbmVzID0gdGV4dC5zcGxpdCgnXG4nKTsKICB2YXIgbWluSW5kZW50ID0gTUFYX0lOREVOVDsKICB2YXIgaW5kZW50UmVnRXhwOwogIHZhciBpZ25vcmVMaW5lID0gKGxpbmVzWzBdWzBdICE9ICcgJyAgJiYgbGluZXMubGVuZ3RoID4gMSk7CiAgLy8gaWdub3JlIGZpcnN0IGxpbmUgaWYgaXQgaGFzIG5vIGluZGVudGF0aW9uIGFuZCB0aGVyZSBpcyBtb3JlIHRoYW4gb25lIGxpbmUKCiAgbGluZXMuZm9yRWFjaChmdW5jdGlvbihsaW5lKXsKICAgIGlmIChpZ25vcmVMaW5lKSB7CiAgICAgIGlnbm9yZUxpbmUgPSBmYWxzZTsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHZhciBpbmRlbnQgPSBsaW5lLm1hdGNoKC9eXHMqLylbMF0ubGVuZ3RoOwogICAgaWYgKGluZGVudCA+IDAgfHwgbWluSW5kZW50ID09IE1BWF9JTkRFTlQpIHsKICAgICAgbWluSW5kZW50ID0gTWF0aC5taW4obWluSW5kZW50LCBpbmRlbnQpOwogICAgfQogIH0pOwoKICBpbmRlbnRSZWdFeHAgPSBuZXcgUmVnRXhwKCdeXFxzezAsJyArIG1pbkluZGVudCArICd9Jyk7CgogIGZvciAoIHZhciBpID0gMDsgaSA8IGxpbmVzLmxlbmd0aDsgaSsrKSB7CiAgICBsaW5lc1tpXSA9IGxpbmVzW2ldLnJlcGxhY2UoaW5kZW50UmVnRXhwLCAnJyk7CiAgfQoKICAvLyByZW1vdmUgbGVhZGluZyBsaW5lcwogIHdoaWxlIChlbXB0eShsaW5lc1swXSkpIHsKICAgIGxpbmVzLnNoaWZ0KCk7CiAgfQoKICAvLyByZW1vdmUgdHJhaWxpbmcKICB3aGlsZSAoZW1wdHkobGluZXNbbGluZXMubGVuZ3RoIC0gMV0pKSB7CiAgICBsaW5lcy5wb3AoKTsKICB9CiAgcmV0dXJuIGxpbmVzLmpvaW4oJ1xuJyk7Cn0KCmZ1bmN0aW9uIGluZGVudENvZGUodGV4dCwgc3BhY2VDb3VudCkgewogIHZhciBsaW5lcyA9IHRleHQuc3BsaXQoJ1xuJyksCiAgICBpbmRlbnQgPSAnJywKICAgIGZpeGVkTGluZXMgPSBbXTsKCiAgd2hpbGUoc3BhY2VDb3VudC0tKSBpbmRlbnQgKz0gJyAnOwoKICBsaW5lcy5mb3JFYWNoKGZ1bmN0aW9uKGxpbmUpIHsKICAgIGZpeGVkTGluZXMucHVzaChpbmRlbnQgKyBsaW5lKTsKICB9KTsKCiAgcmV0dXJuIGZpeGVkTGluZXMuam9pbignXG4nKTsKfQoKLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwpmdW5jdGlvbiBtZXJnZShkb2NzKXsKICB2YXIgYnlGdWxsSWQgPSB7fTsKCiAgZG9jcy5mb3JFYWNoKGZ1bmN0aW9uKGRvYykgewogICAgYnlGdWxsSWRbZG9jLnNlY3Rpb24gKyAnLycgKyBkb2MuaWRdID0gZG9jOwogIH0pOwoKICBmb3IodmFyIGkgPSAwOyBpIDwgZG9jcy5sZW5ndGg7KSB7CiAgICBpZiAoZmluZFBhcmVudChkb2NzW2ldLCAnbWV0aG9kJykgfHwgZmluZFBhcmVudChkb2NzW2ldLCAncHJvcGVydHknKSB8fCBmaW5kUGFyZW50KGRvY3NbaV0sICdldmVudCcpKSB7CiAgICAgIGRvY3Muc3BsaWNlKGksIDEpOwogICAgfSBlbHNlIHsKICAgICAgaSsrOwogICAgfQogIH0KCiAgZnVuY3Rpb24gZmluZFBhcmVudChkb2MsIG5hbWUpIHsKICAgIHZhciBwYXJlbnROYW1lID0gZG9jW25hbWUgKyAnT2YnXTsKICAgIGlmICghcGFyZW50TmFtZSkgcmV0dXJuIGZhbHNlOwoKICAgIHZhciBwYXJlbnQgPSBieUZ1bGxJZFsnYXBpLycgKyBwYXJlbnROYW1lXTsKICAgIGlmICghcGFyZW50KQogICAgICB0aHJvdyBuZXcgRXJyb3IoIk5vIHBhcmVudCBuYW1lZCAnIiArIHBhcmVudE5hbWUgKyAiJyBmb3IgJyIgKwogICAgICAgIGRvYy5uYW1lICsgIicgaW4gQCIgKyBuYW1lICsgIk9mLiIpOwoKICAgIHZhciBsaXN0TmFtZSA9IChuYW1lICsgJ3MnKS5yZXBsYWNlKC95cyQvLCAnaWVzJyk7CiAgICB2YXIgbGlzdCA9IHBhcmVudFtsaXN0TmFtZV0gPSAocGFyZW50W2xpc3ROYW1lXSB8fCBbXSk7CiAgICBsaXN0LnB1c2goZG9jKTsKICAgIGxpc3Quc29ydChvcmRlckJ5TmFtZSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIGZ1bmN0aW9uIG9yZGVyQnlOYW1lKGEsIGIpewogICAgcmV0dXJuIGEubmFtZSA8IGIubmFtZSA/IC0xIDogKGEubmFtZSA+IGIubmFtZSA/IDEgOiAwKTsKICB9Cn0KLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKCmZ1bmN0aW9uIGNoZWNrQnJva2VuTGlua3MoZG9jcykgewogIHZhciBieUZ1bGxJZCA9IE9iamVjdC5jcmVhdGUobnVsbCk7CgogIGRvY3MuZm9yRWFjaChmdW5jdGlvbihkb2MpIHsKICAgIGJ5RnVsbElkW2RvYy5zZWN0aW9uICsgJy8nICsgZG9jLmlkXSA9IGRvYzsKICAgIGlmIChkb2Muc2VjdGlvbiA9PT0gJ2FwaScpIHsKICAgICAgZG9jLmFuY2hvcnMucHVzaCgnZGlyZWN0aXZlJywgJ3NlcnZpY2UnLCAnZmlsdGVyJywgJ2Z1bmN0aW9uJyk7CiAgICB9CiAgfSk7CgogIGRvY3MuZm9yRWFjaChmdW5jdGlvbihkb2MpIHsKICAgIGRvYy5saW5rcy5mb3JFYWNoKGZ1bmN0aW9uKGxpbmspIHsKICAgICAgLy8gY29udmVydCAjaWQgdG8gcGF0aCNpZAogICAgICBpZiAobGlua1swXSA9PSAnIycpIHsKICAgICAgICBsaW5rID0gZG9jLnNlY3Rpb24gKyAnLycgKyBkb2MuaWQuc3BsaXQoJyMnKS5zaGlmdCgpICsgbGluazsKICAgICAgfQoKICAgICAgdmFyIHBhcnRzID0gbGluay5zcGxpdCgnIycpOwogICAgICB2YXIgcGFnZUxpbmsgPSBwYXJ0c1swXTsKICAgICAgdmFyIGFuY2hvckxpbmsgPSBwYXJ0c1sxXTsKICAgICAgdmFyIGxpbmtlZFBhZ2UgPSBieUZ1bGxJZFtwYWdlTGlua107CgogICAgICBpZiAoIWxpbmtlZFBhZ2UpIHsKICAgICAgICBjb25zb2xlLmxvZygnV0FSTklORzogJyArIGRvYy5zZWN0aW9uICsgJy8nICsgZG9jLmlkICsgJyAoZGVmaW5lZCBpbiAnICsgZG9jLmZpbGUgKyAnKSBwb2ludHMgdG8gYSBub24gZXhpc3RpbmcgcGFnZSAiJyArIGxpbmsgKyAnIiEnKTsKICAgICAgfSBlbHNlIGlmIChhbmNob3JMaW5rICYmIGxpbmtlZFBhZ2UuYW5jaG9ycy5pbmRleE9mKGFuY2hvckxpbmspID09PSAtMSkgewogICAgICAgIGNvbnNvbGUubG9nKCdXQVJOSU5HOiAnICsgZG9jLnNlY3Rpb24gKyAnLycgKyBkb2MuaWQgKyAnIChkZWZpbmVkIGluICcgKyBkb2MuZmlsZSArICcpIHBvaW50cyB0byBhIG5vbiBleGlzdGluZyBhbmNob3IgIicgKyBsaW5rICsgJyIhJyk7CiAgICAgIH0KICAgIH0pOwogIH0pOwp9CgoKZnVuY3Rpb24gcHJvcGVydHkobmFtZSkgewogIHJldHVybiBmdW5jdGlvbih2YWx1ZSl7CiAgICByZXR1cm4gdmFsdWVbbmFtZV07CiAgfTsKfQoKCnZhciBEQVNIX0NBU0VfUkVHRVhQID0gL1tBLVpdL2c7CmZ1bmN0aW9uIGRhc2hDYXNlKG5hbWUpewogIHJldHVybiBuYW1lLnJlcGxhY2UoREFTSF9DQVNFX1JFR0VYUCwgZnVuY3Rpb24obGV0dGVyLCBwb3MpIHsKICAgIHJldHVybiAocG9zID8gJy0nIDogJycpICsgbGV0dGVyLnRvTG93ZXJDYXNlKCk7CiAgfSk7Cn0KLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKZnVuY3Rpb24gZXhwbGFpbk1vZHVsZUluc3RhbGxhdGlvbihtb2R1bGVOYW1lKXsKICB2YXIgbmdNb2QgPSBuZ01vZHVsZShtb2R1bGVOYW1lKSwKICAgIG1vZHVsZVBhY2thZ2UgPSAnYW5ndWxhci0nICsgbW9kdWxlTmFtZSwKICAgIG1vZHVsZVBhY2thZ2VGaWxlID0gbW9kdWxlUGFja2FnZSArICcuanMnOwoKICByZXR1cm4gJzxoMT5JbnN0YWxsYXRpb248L2gxPicgKwogICAgJzxwPkZpcnN0IGluY2x1ZGUgPGNvZGU+JyArIG1vZHVsZVBhY2thZ2VGaWxlICsnPC9jb2RlPiBpbiB5b3VyIEhUTUw6PC9wPjxwcmU+PGNvZGU+JyArCiAgICAnICAgICZsdDtzY3JpcHQgc3JjPSZxdW90O2FuZ3VsYXIuanMmcXVvdDsmZ3Q7XG4nICsKICAgICcgICAgJmx0O3NjcmlwdCBzcmM9JnF1b3Q7JyArIG1vZHVsZVBhY2thZ2VGaWxlICsgJyZxdW90OyZndDs8L3ByZT48L2NvZGU+JyArCgogICAgJzxwPllvdSBjYW4gZG93bmxvYWQgdGhpcyBmaWxlIGZyb20gdGhlIGZvbGxvd2luZyBwbGFjZXM6PC9wPicgKwogICAgJzx1bD4nICsKICAgICAgJzxsaT5bR29vZ2xlIENETl0oaHR0cHM6Ly9kZXZlbG9wZXJzLmdvb2dsZS5jb20vc3BlZWQvbGlicmFyaWVzL2Rldmd1aWRlI2FuZ3VsYXJqcyk8YnI+JyArCiAgICAgICAgJ2UuZy4gPGNvZGU+Ii8vYWpheC5nb29nbGVhcGlzLmNvbS9hamF4L2xpYnMvYW5ndWxhcmpzL1guWS5aLycgKyBtb2R1bGVQYWNrYWdlRmlsZSArICciPC9jb2RlPjwvbGk+JyArCiAgICAgICc8bGk+W0Jvd2VyXShodHRwOi8vYm93ZXIuaW8pPGJyPicgKwogICAgICAgJ2UuZy4gPGNvZGU+Ym93ZXIgaW5zdGFsbCAnICsgbW9kdWxlUGFja2FnZSArICdAWC5ZLlo8L2NvZGU+PC9saT4nICsKICAgICAgJzxsaT48YSBocmVmPSJodHRwOi8vY29kZS5hbmd1bGFyanMub3JnLyI+Y29kZS5hbmd1bGFyanMub3JnPC9hPjxicj4nICsKICAgICAgICAnZS5nLiA8Y29kZT4iLy9jb2RlLmFuZ3VsYXJqcy5vcmcvWC5ZLlovJyArIG1vZHVsZVBhY2thZ2VGaWxlICsgJyI8L2NvZGU+PC9saT4nICsKICAgICc8L3VsPicgKwogICAgJzxwPndoZXJlIFguWS5aIGlzIHRoZSBBbmd1bGFySlMgdmVyc2lvbiB5b3UgYXJlIHJ1bm5pbmcuPC9wPicgKwogICAgJzxwPlRoZW4gbG9hZCB0aGUgbW9kdWxlIGluIHlvdXIgYXBwbGljYXRpb24gYnkgYWRkaW5nIGl0IGFzIGEgZGVwZW5kZW50IG1vZHVsZTo8L3A+PHByZT48Y29kZT4nICsKICAgICcgICAgYW5ndWxhci5tb2R1bGUoXCdhcHBcJywgW1wnJyArIG5nTW9kICsgJ1wnXSk7PC9wcmU+PC9jb2RlPicgKwoKICAgICc8cD5XaXRoIHRoYXQgeW91XCdyZSByZWFkeSB0byBnZXQgc3RhcnRlZCE8L3A+JzsKfQoKZnVuY3Rpb24gbmdNb2R1bGUobW9kdWxlTmFtZSkgewogIHJldHVybiAnbmcnICsgbW9kdWxlTmFtZVswXS50b1VwcGVyQ2FzZSgpICsgbW9kdWxlTmFtZS5zdWJzdHIoMSk7Cn0K",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Thu, 06 Nov 2014 07:53:38 GMT",
                    "Content-Length": "43575",
                    "Date": "Thu, 06 Nov 2014 07:53:39 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}