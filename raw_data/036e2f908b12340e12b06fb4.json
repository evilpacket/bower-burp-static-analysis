{
    "url": "http://localhost:9999/CreateJS/PreloadJS/lib/preloadjs-0.4.1.combined.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Link manipulation (DOM-based)",
    "issueType": 5246976,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based link manipulation vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this to a navigation target within the current page, such as a clickable link or the submission URL of a form. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will modify the target of links within the response. An attacker may be able to leverage this to perform various attacks, including:<ul><li>Causing the user to redirect to an arbitrary external URL, to facilitate a phishing attack.</li><li>Causing the user to submit sensitive form data to a server controlled by the attacker.</li><li>Causing the user to perform an unintended action within the application, by changing the file or query string associated with a link.</li><li>Bypassing browser anti-XSS defenses by injecting on-site links containing XSS exploits, since browser anti-XSS defenses typically do not operate on on-site links.</li></ul>",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based link manipulation vulnerabilities is not to dynamically set the target URLs of links or forms using data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing an arbitrary URL as a link target. In general, this is best achieved by using a whitelist of URLs that are permitted link targets, and strictly validating the target against this list before setting the link target.",
    "issueDetail": "The application may be vulnerable to DOM-based link manipulation. Data is read from <b>location.href</b> and written to <b>the 'href' property of a DOM element</b> via the following statement:<ul><li>host.href = location.href;</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/CreateJS/PreloadJS/lib/preloadjs-0.4.1.combined.js",
                "path": "/CreateJS/PreloadJS/lib/preloadjs-0.4.1.combined.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9DcmVhdGVKUy9QcmVsb2FkSlMvbGliL3ByZWxvYWRqcy0wLjQuMS5jb21iaW5lZC5qcyBIVFRQLzEuMQ0KSG9zdDogbG9jYWxob3N0Ojk5OTkNCg0K",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMTU1MjQ4DQpBY2NlcHQtUmFuZ2VzOiBieXRlcw0KQ29udGVudC1UeXBlOiBhcHBsaWNhdGlvbi9qYXZhc2NyaXB0DQpEYXRlOiBUaHUsIDA2IE5vdiAyMDE0IDE5OjM2OjU1IEdNVA0KTGFzdC1Nb2RpZmllZDogVGh1LCAwNiBOb3YgMjAxNCAxOTozNjo1NCBHTVQNCg0KdGhpcy5jcmVhdGVqcyA9IHRoaXMuY3JlYXRlanN8fHt9OwoKKGZ1bmN0aW9uKCkgewoJInVzZSBzdHJpY3QiOwoKCS8qKgoJICogU3RhdGljIGNsYXNzIGhvbGRpbmcgbGlicmFyeSBzcGVjaWZpYyBpbmZvcm1hdGlvbiBzdWNoIGFzIHRoZSB2ZXJzaW9uIGFuZCBidWlsZERhdGUgb2YKCSAqIHRoZSBsaWJyYXJ5LgoJICoKCSAqIFRoZSBvbGQgUHJlbG9hZEpTIGNsYXNzIGhhcyBiZWVuIHJlbmFtZWQgdG8gTG9hZFF1ZXVlLiBQbGVhc2Ugc2VlIHRoZSB7eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZSJ9fXt7L2Nyb3NzTGlua319CgkgKiBjbGFzcyBmb3IgaW5mb3JtYXRpb24gb24gbG9hZGluZyBmaWxlcy4KCSAqIEBjbGFzcyBQcmVsb2FkSlMKCSAqKi8KCXZhciBzID0gY3JlYXRlanMuUHJlbG9hZEpTID0gY3JlYXRlanMuUHJlbG9hZEpTIHx8IHt9OwoKCS8qKgoJICogVGhlIHZlcnNpb24gc3RyaW5nIGZvciB0aGlzIHJlbGVhc2UuCgkgKiBAcHJvcGVydHkgdmVyc2lvbgoJICogQHR5cGUgU3RyaW5nCgkgKiBAc3RhdGljCgkgKiovCglzLnZlcnNpb24gPSAvKnZlcnNpb24qLyIwLjQuMSI7IC8vIGluamVjdGVkIGJ5IGJ1aWxkIHByb2Nlc3MKCgkvKioKCSAqIFRoZSBidWlsZCBkYXRlIGZvciB0aGlzIHJlbGVhc2UgaW4gVVRDIGZvcm1hdC4KCSAqIEBwcm9wZXJ0eSBidWlsZERhdGUKCSAqIEB0eXBlIFN0cmluZwoJICogQHN0YXRpYwoJICoqLwoJcy5idWlsZERhdGUgPSAvKmRhdGUqLyJUdWUsIDA0IE1hciAyMDE0IDIzOjQ0OjA4IEdNVCI7IC8vIGluamVjdGVkIGJ5IGJ1aWxkIHByb2Nlc3MKCn0pKCk7Ci8qCiogRXZlbnQKKiBWaXNpdCBodHRwOi8vY3JlYXRlanMuY29tLyBmb3IgZG9jdW1lbnRhdGlvbiwgdXBkYXRlcyBhbmQgZXhhbXBsZXMuCioKKiBDb3B5cmlnaHQgKGMpIDIwMTAgZ3NraW5uZXIuY29tLCBpbmMuCioKKiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbgoqIG9idGFpbmluZyBhIGNvcHkgb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uCiogZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8gZGVhbCBpbiB0aGUgU29mdHdhcmUgd2l0aG91dAoqIHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMgdG8gdXNlLAoqIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsCiogY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlCiogU29mdHdhcmUgaXMgZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcKKiBjb25kaXRpb25zOgoqCiogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUKKiBpbmNsdWRlZCBpbiBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KKgoqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELAoqIEVYUFJFU1MgT1IgSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUwoqIE9GIE1FUkNIQU5UQUJJTElUWSwgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5ECiogTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SUyBPUiBDT1BZUklHSFQKKiBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSIExJQUJJTElUWSwKKiBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcKKiBGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SCiogT1RIRVIgREVBTElOR1MgSU4gVEhFIFNPRlRXQVJFLgoqLwoKLyoqCiAqIEEgY29sbGVjdGlvbiBvZiBDbGFzc2VzIHRoYXQgYXJlIHNoYXJlZCBhY3Jvc3MgYWxsIHRoZSBDcmVhdGVKUyBsaWJyYXJpZXMuICBUaGUgY2xhc3NlcyBhcmUgaW5jbHVkZWQgaW4gdGhlIG1pbmlmaWVkCiAqIGZpbGVzIG9mIGVhY2ggbGlicmFyeSBhbmQgYXJlIGF2YWlsYWJsZSBvbiB0aGUgY3JlYXRlc2pzIG5hbWVzcGFjZSBkaXJlY3RseS4KICoKICogPGg0PkV4YW1wbGU8L2g0PgogKiAgICAgIG15T2JqZWN0LmFkZEV2ZW50TGlzdGVuZXIoImNoYW5nZSIsIGNyZWF0ZWpzLnByb3h5KG15TWV0aG9kLCBzY29wZSkpOwogKgogKiBAbW9kdWxlIENyZWF0ZUpTCiAqIEBtYWluIENyZWF0ZUpTCiAqLwoKLy8gbmFtZXNwYWNlOgp0aGlzLmNyZWF0ZWpzID0gdGhpcy5jcmVhdGVqc3x8e307CgooZnVuY3Rpb24oKSB7CgkidXNlIHN0cmljdCI7CgovKioKICogQ29udGFpbnMgcHJvcGVydGllcyBhbmQgbWV0aG9kcyBzaGFyZWQgYnkgYWxsIGV2ZW50cyBmb3IgdXNlIHdpdGgKICoge3sjY3Jvc3NMaW5rICJFdmVudERpc3BhdGNoZXIifX17ey9jcm9zc0xpbmt9fS4KICogCiAqIE5vdGUgdGhhdCBFdmVudCBvYmplY3RzIGFyZSBvZnRlbiByZXVzZWQsIHNvIHlvdSBzaG91bGQgbmV2ZXIKICogcmVseSBvbiBhbiBldmVudCBvYmplY3QncyBzdGF0ZSBvdXRzaWRlIG9mIHRoZSBjYWxsIHN0YWNrIGl0IHdhcyByZWNlaXZlZCBpbi4KICogQGNsYXNzIEV2ZW50CiAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlIFRoZSBldmVudCB0eXBlLgogKiBAcGFyYW0ge0Jvb2xlYW59IGJ1YmJsZXMgSW5kaWNhdGVzIHdoZXRoZXIgdGhlIGV2ZW50IHdpbGwgYnViYmxlIHRocm91Z2ggdGhlIGRpc3BsYXkgbGlzdC4KICogQHBhcmFtIHtCb29sZWFufSBjYW5jZWxhYmxlIEluZGljYXRlcyB3aGV0aGVyIHRoZSBkZWZhdWx0IGJlaGF2aW91ciBvZiB0aGlzIGV2ZW50IGNhbiBiZSBjYW5jZWxsZWQuCiAqIEBjb25zdHJ1Y3RvcgogKiovCnZhciBFdmVudCA9IGZ1bmN0aW9uKHR5cGUsIGJ1YmJsZXMsIGNhbmNlbGFibGUpIHsKICB0aGlzLmluaXRpYWxpemUodHlwZSwgYnViYmxlcywgY2FuY2VsYWJsZSk7Cn07CnZhciBwID0gRXZlbnQucHJvdG90eXBlOwoKLy8gZXZlbnRzOgoKLy8gcHVibGljIHByb3BlcnRpZXM6CgoJLyoqCgkgKiBUaGUgdHlwZSBvZiBldmVudC4KCSAqIEBwcm9wZXJ0eSB0eXBlCgkgKiBAdHlwZSBTdHJpbmcKCSAqKi8KCXAudHlwZSA9IG51bGw7CgoJLyoqCgkgKiBUaGUgb2JqZWN0IHRoYXQgZ2VuZXJhdGVkIGFuIGV2ZW50LgoJICogQHByb3BlcnR5IHRhcmdldAoJICogQHR5cGUgT2JqZWN0CgkgKiBAZGVmYXVsdCBudWxsCgkgKiBAcmVhZG9ubHkKCSovCglwLnRhcmdldCA9IG51bGw7CgoJLyoqCgkgKiBUaGUgY3VycmVudCB0YXJnZXQgdGhhdCBhIGJ1YmJsaW5nIGV2ZW50IGlzIGJlaW5nIGRpc3BhdGNoZWQgZnJvbS4gRm9yIG5vbi1idWJibGluZyBldmVudHMsIHRoaXMgd2lsbAoJICogYWx3YXlzIGJlIHRoZSBzYW1lIGFzIHRhcmdldC4gRm9yIGV4YW1wbGUsIGlmIGNoaWxkT2JqLnBhcmVudCA9IHBhcmVudE9iaiwgYW5kIGEgYnViYmxpbmcgZXZlbnQKCSAqIGlzIGdlbmVyYXRlZCBmcm9tIGNoaWxkT2JqLCB0aGVuIGEgbGlzdGVuZXIgb24gcGFyZW50T2JqIHdvdWxkIHJlY2VpdmUgdGhlIGV2ZW50IHdpdGgKCSAqIHRhcmdldD1jaGlsZE9iaiAodGhlIG9yaWdpbmFsIHRhcmdldCkgYW5kIGN1cnJlbnRUYXJnZXQ9cGFyZW50T2JqICh3aGVyZSB0aGUgbGlzdGVuZXIgd2FzIGFkZGVkKS4KCSAqIEBwcm9wZXJ0eSBjdXJyZW50VGFyZ2V0CgkgKiBAdHlwZSBPYmplY3QKCSAqIEBkZWZhdWx0IG51bGwKCSAqIEByZWFkb25seQoJKi8KCXAuY3VycmVudFRhcmdldCA9IG51bGw7CgoJLyoqCgkgKiBGb3IgYnViYmxpbmcgZXZlbnRzLCB0aGlzIGluZGljYXRlcyB0aGUgY3VycmVudCBldmVudCBwaGFzZTo8T0w+CgkgKiAJPExJPiBjYXB0dXJlIHBoYXNlOiBzdGFydGluZyBmcm9tIHRoZSB0b3AgcGFyZW50IHRvIHRoZSB0YXJnZXQ8L0xJPgoJICogCTxMST4gYXQgdGFyZ2V0IHBoYXNlOiBjdXJyZW50bHkgYmVpbmcgZGlzcGF0Y2hlZCBmcm9tIHRoZSB0YXJnZXQ8L0xJPgoJICogCTxMST4gYnViYmxpbmcgcGhhc2U6IGZyb20gdGhlIHRhcmdldCB0byB0aGUgdG9wIHBhcmVudDwvTEk+CgkgKiA8L09MPgoJICogQHByb3BlcnR5IGV2ZW50UGhhc2UKCSAqIEB0eXBlIE51bWJlcgoJICogQGRlZmF1bHQgMAoJICogQHJlYWRvbmx5CgkqLwoJcC5ldmVudFBoYXNlID0gMDsKCgkvKioKCSAqIEluZGljYXRlcyB3aGV0aGVyIHRoZSBldmVudCB3aWxsIGJ1YmJsZSB0aHJvdWdoIHRoZSBkaXNwbGF5IGxpc3QuCgkgKiBAcHJvcGVydHkgYnViYmxlcwoJICogQHR5cGUgQm9vbGVhbgoJICogQGRlZmF1bHQgZmFsc2UKCSAqIEByZWFkb25seQoJKi8KCXAuYnViYmxlcyA9IGZhbHNlOwoKCS8qKgoJICogSW5kaWNhdGVzIHdoZXRoZXIgdGhlIGRlZmF1bHQgYmVoYXZpb3VyIG9mIHRoaXMgZXZlbnQgY2FuIGJlIGNhbmNlbGxlZCB2aWEKCSAqIHt7I2Nyb3NzTGluayAiRXZlbnQvcHJldmVudERlZmF1bHQifX17ey9jcm9zc0xpbmt9fS4gVGhpcyBpcyBzZXQgdmlhIHRoZSBFdmVudCBjb25zdHJ1Y3Rvci4KCSAqIEBwcm9wZXJ0eSBjYW5jZWxhYmxlCgkgKiBAdHlwZSBCb29sZWFuCgkgKiBAZGVmYXVsdCBmYWxzZQoJICogQHJlYWRvbmx5CgkqLwoJcC5jYW5jZWxhYmxlID0gZmFsc2U7CgoJLyoqCgkgKiBUaGUgZXBvY2ggdGltZSBhdCB3aGljaCB0aGlzIGV2ZW50IHdhcyBjcmVhdGVkLgoJICogQHByb3BlcnR5IHRpbWVTdGFtcAoJICogQHR5cGUgTnVtYmVyCgkgKiBAZGVmYXVsdCAwCgkgKiBAcmVhZG9ubHkKCSovCglwLnRpbWVTdGFtcCA9IDA7CgoJLyoqCgkgKiBJbmRpY2F0ZXMgaWYge3sjY3Jvc3NMaW5rICJFdmVudC9wcmV2ZW50RGVmYXVsdCJ9fXt7L2Nyb3NzTGlua319IGhhcyBiZWVuIGNhbGxlZAoJICogb24gdGhpcyBldmVudC4KCSAqIEBwcm9wZXJ0eSBkZWZhdWx0UHJldmVudGVkCgkgKiBAdHlwZSBCb29sZWFuCgkgKiBAZGVmYXVsdCBmYWxzZQoJICogQHJlYWRvbmx5CgkqLwoJcC5kZWZhdWx0UHJldmVudGVkID0gZmFsc2U7CgoJLyoqCgkgKiBJbmRpY2F0ZXMgaWYge3sjY3Jvc3NMaW5rICJFdmVudC9zdG9wUHJvcGFnYXRpb24ifX17ey9jcm9zc0xpbmt9fSBvcgoJICoge3sjY3Jvc3NMaW5rICJFdmVudC9zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24ifX17ey9jcm9zc0xpbmt9fSBoYXMgYmVlbiBjYWxsZWQgb24gdGhpcyBldmVudC4KCSAqIEBwcm9wZXJ0eSBwcm9wYWdhdGlvblN0b3BwZWQKCSAqIEB0eXBlIEJvb2xlYW4KCSAqIEBkZWZhdWx0IGZhbHNlCgkgKiBAcmVhZG9ubHkKCSovCglwLnByb3BhZ2F0aW9uU3RvcHBlZCA9IGZhbHNlOwoKCS8qKgoJICogSW5kaWNhdGVzIGlmIHt7I2Nyb3NzTGluayAiRXZlbnQvc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uIn19e3svY3Jvc3NMaW5rfX0gaGFzIGJlZW4gY2FsbGVkCgkgKiBvbiB0aGlzIGV2ZW50LgoJICogQHByb3BlcnR5IGltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZAoJICogQHR5cGUgQm9vbGVhbgoJICogQGRlZmF1bHQgZmFsc2UKCSAqIEByZWFkb25seQoJKi8KCXAuaW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkID0gZmFsc2U7CgkKCS8qKgoJICogSW5kaWNhdGVzIGlmIHt7I2Nyb3NzTGluayAiRXZlbnQvcmVtb3ZlIn19e3svY3Jvc3NMaW5rfX0gaGFzIGJlZW4gY2FsbGVkIG9uIHRoaXMgZXZlbnQuCgkgKiBAcHJvcGVydHkgcmVtb3ZlZAoJICogQHR5cGUgQm9vbGVhbgoJICogQGRlZmF1bHQgZmFsc2UKCSAqIEByZWFkb25seQoJKi8KCXAucmVtb3ZlZCA9IGZhbHNlOwoKLy8gY29uc3RydWN0b3I6CgkvKioKCSAqIEluaXRpYWxpemF0aW9uIG1ldGhvZC4KCSAqIEBtZXRob2QgaW5pdGlhbGl6ZQoJICogQHBhcmFtIHtTdHJpbmd9IHR5cGUgVGhlIGV2ZW50IHR5cGUuCgkgKiBAcGFyYW0ge0Jvb2xlYW59IGJ1YmJsZXMgSW5kaWNhdGVzIHdoZXRoZXIgdGhlIGV2ZW50IHdpbGwgYnViYmxlIHRocm91Z2ggdGhlIGRpc3BsYXkgbGlzdC4KCSAqIEBwYXJhbSB7Qm9vbGVhbn0gY2FuY2VsYWJsZSBJbmRpY2F0ZXMgd2hldGhlciB0aGUgZGVmYXVsdCBiZWhhdmlvdXIgb2YgdGhpcyBldmVudCBjYW4gYmUgY2FuY2VsbGVkLgoJICogQHByb3RlY3RlZAoJICoqLwoJcC5pbml0aWFsaXplID0gZnVuY3Rpb24odHlwZSwgYnViYmxlcywgY2FuY2VsYWJsZSkgewoJCXRoaXMudHlwZSA9IHR5cGU7CgkJdGhpcy5idWJibGVzID0gYnViYmxlczsKCQl0aGlzLmNhbmNlbGFibGUgPSBjYW5jZWxhYmxlOwoJCXRoaXMudGltZVN0YW1wID0gKG5ldyBEYXRlKCkpLmdldFRpbWUoKTsKCX07CgovLyBwdWJsaWMgbWV0aG9kczoKCgkvKioKCSAqIFNldHMge3sjY3Jvc3NMaW5rICJFdmVudC9kZWZhdWx0UHJldmVudGVkIn19e3svY3Jvc3NMaW5rfX0gdG8gdHJ1ZS4KCSAqIE1pcnJvcnMgdGhlIERPTSBldmVudCBzdGFuZGFyZC4KCSAqIEBtZXRob2QgcHJldmVudERlZmF1bHQKCSAqKi8KCXAucHJldmVudERlZmF1bHQgPSBmdW5jdGlvbigpIHsKCQl0aGlzLmRlZmF1bHRQcmV2ZW50ZWQgPSB0cnVlOwoJfTsKCgkvKioKCSAqIFNldHMge3sjY3Jvc3NMaW5rICJFdmVudC9wcm9wYWdhdGlvblN0b3BwZWQifX17ey9jcm9zc0xpbmt9fSB0byB0cnVlLgoJICogTWlycm9ycyB0aGUgRE9NIGV2ZW50IHN0YW5kYXJkLgoJICogQG1ldGhvZCBzdG9wUHJvcGFnYXRpb24KCSAqKi8KCXAuc3RvcFByb3BhZ2F0aW9uID0gZnVuY3Rpb24oKSB7CgkJdGhpcy5wcm9wYWdhdGlvblN0b3BwZWQgPSB0cnVlOwoJfTsKCgkvKioKCSAqIFNldHMge3sjY3Jvc3NMaW5rICJFdmVudC9wcm9wYWdhdGlvblN0b3BwZWQifX17ey9jcm9zc0xpbmt9fSBhbmQKCSAqIHt7I2Nyb3NzTGluayAiRXZlbnQvaW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkIn19e3svY3Jvc3NMaW5rfX0gdG8gdHJ1ZS4KCSAqIE1pcnJvcnMgdGhlIERPTSBldmVudCBzdGFuZGFyZC4KCSAqIEBtZXRob2Qgc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uCgkgKiovCglwLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbiA9IGZ1bmN0aW9uKCkgewoJCXRoaXMuaW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkID0gdGhpcy5wcm9wYWdhdGlvblN0b3BwZWQgPSB0cnVlOwoJfTsKCQoJLyoqCgkgKiBDYXVzZXMgdGhlIGFjdGl2ZSBsaXN0ZW5lciB0byBiZSByZW1vdmVkIHZpYSByZW1vdmVFdmVudExpc3RlbmVyKCk7CgkgKiAKCSAqIAkJbXlCdG4uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBmdW5jdGlvbihldnQpIHsKCSAqIAkJCS8vIGRvIHN0dWZmLi4uCgkgKiAJCQlldnQucmVtb3ZlKCk7IC8vIHJlbW92ZXMgdGhpcyBsaXN0ZW5lci4KCSAqIAkJfSk7CgkgKiAKCSAqIEBtZXRob2QgcmVtb3ZlCgkgKiovCglwLnJlbW92ZSA9IGZ1bmN0aW9uKCkgewoJCXRoaXMucmVtb3ZlZCA9IHRydWU7Cgl9OwoJCgkvKioKCSAqIFJldHVybnMgYSBjbG9uZSBvZiB0aGUgRXZlbnQgaW5zdGFuY2UuCgkgKiBAbWV0aG9kIGNsb25lCgkgKiBAcmV0dXJuIHtFdmVudH0gYSBjbG9uZSBvZiB0aGUgRXZlbnQgaW5zdGFuY2UuCgkgKiovCglwLmNsb25lID0gZnVuY3Rpb24oKSB7CgkJcmV0dXJuIG5ldyBFdmVudCh0aGlzLnR5cGUsIHRoaXMuYnViYmxlcywgdGhpcy5jYW5jZWxhYmxlKTsKCX07CgoJLyoqCgkgKiBSZXR1cm5zIGEgc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIHRoaXMgb2JqZWN0LgoJICogQG1ldGhvZCB0b1N0cmluZwoJICogQHJldHVybiB7U3RyaW5nfSBhIHN0cmluZyByZXByZXNlbnRhdGlvbiBvZiB0aGUgaW5zdGFuY2UuCgkgKiovCglwLnRvU3RyaW5nID0gZnVuY3Rpb24oKSB7CgkJcmV0dXJuICJbRXZlbnQgKHR5cGU9Iit0aGlzLnR5cGUrIildIjsKCX07CgpjcmVhdGVqcy5FdmVudCA9IEV2ZW50Owp9KCkpOwovKg0KKiBFdmVudERpc3BhdGNoZXINCiogVmlzaXQgaHR0cDovL2NyZWF0ZWpzLmNvbS8gZm9yIGRvY3VtZW50YXRpb24sIHVwZGF0ZXMgYW5kIGV4YW1wbGVzLg0KKg0KKiBDb3B5cmlnaHQgKGMpIDIwMTAgZ3NraW5uZXIuY29tLCBpbmMuDQoqDQoqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uDQoqIG9idGFpbmluZyBhIGNvcHkgb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uDQoqIGZpbGVzICh0aGUgIlNvZnR3YXJlIiksIHRvIGRlYWwgaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQNCiogcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0cyB0byB1c2UsDQoqIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsDQoqIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZQ0KKiBTb2Z0d2FyZSBpcyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZw0KKiBjb25kaXRpb25zOg0KKg0KKiBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZQ0KKiBpbmNsdWRlZCBpbiBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4NCioNCiogVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsDQoqIEVYUFJFU1MgT1IgSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUw0KKiBPRiBNRVJDSEFOVEFCSUxJVFksIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORA0KKiBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBBVVRIT1JTIE9SIENPUFlSSUdIVA0KKiBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSIExJQUJJTElUWSwNCiogV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HDQoqIEZST00sIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1INCiogT1RIRVIgREVBTElOR1MgSU4gVEhFIFNPRlRXQVJFLg0KKi8NCg0KLyoqDQogKiBAbW9kdWxlIENyZWF0ZUpTDQogKi8NCg0KLy8gbmFtZXNwYWNlOg0KdGhpcy5jcmVhdGVqcyA9IHRoaXMuY3JlYXRlanN8fHt9Ow0KDQooZnVuY3Rpb24oKSB7DQoJInVzZSBzdHJpY3QiOw0KDQovKioNCiAqIEV2ZW50RGlzcGF0Y2hlciBwcm92aWRlcyBtZXRob2RzIGZvciBtYW5hZ2luZyBxdWV1ZXMgb2YgZXZlbnQgbGlzdGVuZXJzIGFuZCBkaXNwYXRjaGluZyBldmVudHMuDQogKg0KICogWW91IGNhbiBlaXRoZXIgZXh0ZW5kIEV2ZW50RGlzcGF0Y2hlciBvciBtaXggaXRzIG1ldGhvZHMgaW50byBhbiBleGlzdGluZyBwcm90b3R5cGUgb3IgaW5zdGFuY2UgYnkgdXNpbmcgdGhlDQogKiBFdmVudERpc3BhdGNoZXIge3sjY3Jvc3NMaW5rICJFdmVudERpc3BhdGNoZXIvaW5pdGlhbGl6ZSJ9fXt7L2Nyb3NzTGlua319IG1ldGhvZC4NCiAqIA0KICogVG9nZXRoZXIgd2l0aCB0aGUgQ3JlYXRlSlMgRXZlbnQgY2xhc3MsIEV2ZW50RGlzcGF0Y2hlciBwcm92aWRlcyBhbiBleHRlbmRlZCBldmVudCBtb2RlbCB0aGF0IGlzIGJhc2VkIG9uIHRoZQ0KICogRE9NIExldmVsIDIgZXZlbnQgbW9kZWwsIGluY2x1ZGluZyBhZGRFdmVudExpc3RlbmVyLCByZW1vdmVFdmVudExpc3RlbmVyLCBhbmQgZGlzcGF0Y2hFdmVudC4gSXQgc3VwcG9ydHMNCiAqIGJ1YmJsaW5nIC8gY2FwdHVyZSwgcHJldmVudERlZmF1bHQsIHN0b3BQcm9wYWdhdGlvbiwgc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uLCBhbmQgaGFuZGxlRXZlbnQuDQogKiANCiAqIEV2ZW50RGlzcGF0Y2hlciBhbHNvIGV4cG9zZXMgYSB7eyNjcm9zc0xpbmsgIkV2ZW50RGlzcGF0Y2hlci9vbiJ9fXt7L2Nyb3NzTGlua319IG1ldGhvZCwgd2hpY2ggbWFrZXMgaXQgZWFzaWVyDQogKiB0byBjcmVhdGUgc2NvcGVkIGxpc3RlbmVycywgbGlzdGVuZXJzIHRoYXQgb25seSBydW4gb25jZSwgYW5kIGxpc3RlbmVycyB3aXRoIGFzc29jaWF0ZWQgYXJiaXRyYXJ5IGRhdGEuIFRoZSANCiAqIHt7I2Nyb3NzTGluayAiRXZlbnREaXNwYXRjaGVyL29mZiJ9fXt7L2Nyb3NzTGlua319IG1ldGhvZCBpcyBtZXJlbHkgYW4gYWxpYXMgdG8NCiAqIHt7I2Nyb3NzTGluayAiRXZlbnREaXNwYXRjaGVyL3JlbW92ZUV2ZW50TGlzdGVuZXIifX17ey9jcm9zc0xpbmt9fS4NCiAqIA0KICogQW5vdGhlciBhZGRpdGlvbiB0byB0aGUgRE9NIExldmVsIDIgbW9kZWwgaXMgdGhlIHt7I2Nyb3NzTGluayAiRXZlbnREaXNwYXRjaGVyL3JlbW92ZUFsbEV2ZW50TGlzdGVuZXJzIn19e3svY3Jvc3NMaW5rfX0NCiAqIG1ldGhvZCwgd2hpY2ggY2FuIGJlIHVzZWQgdG8gbGlzdGVuZXJzIGZvciBhbGwgZXZlbnRzLCBvciBsaXN0ZW5lcnMgZm9yIGEgc3BlY2lmaWMgZXZlbnQuIFRoZSBFdmVudCBvYmplY3QgYWxzbyANCiAqIGluY2x1ZGVzIGEge3sjY3Jvc3NMaW5rICJFdmVudC9yZW1vdmUifX17ey9jcm9zc0xpbmt9fSBtZXRob2Qgd2hpY2ggcmVtb3ZlcyB0aGUgYWN0aXZlIGxpc3RlbmVyLg0KICoNCiAqIDxoND5FeGFtcGxlPC9oND4NCiAqIEFkZCBFdmVudERpc3BhdGNoZXIgY2FwYWJpbGl0aWVzIHRvIHRoZSAiTXlDbGFzcyIgY2xhc3MuDQogKg0KICogICAgICBFdmVudERpc3BhdGNoZXIuaW5pdGlhbGl6ZShNeUNsYXNzLnByb3RvdHlwZSk7DQogKg0KICogQWRkIGFuIGV2ZW50IChzZWUge3sjY3Jvc3NMaW5rICJFdmVudERpc3BhdGNoZXIvYWRkRXZlbnRMaXN0ZW5lciJ9fXt7L2Nyb3NzTGlua319KS4NCiAqDQogKiAgICAgIGluc3RhbmNlLmFkZEV2ZW50TGlzdGVuZXIoImV2ZW50TmFtZSIsIGhhbmRsZXJNZXRob2QpOw0KICogICAgICBmdW5jdGlvbiBoYW5kbGVyTWV0aG9kKGV2ZW50KSB7DQogKiAgICAgICAgICBjb25zb2xlLmxvZyhldmVudC50YXJnZXQgKyAiIFdhcyBDbGlja2VkIik7DQogKiAgICAgIH0NCiAqDQogKiA8Yj5NYWludGFpbmluZyBwcm9wZXIgc2NvcGU8L2I+PGJyIC8+DQogKiBTY29wZSAoaWUuICJ0aGlzIikgY2FuIGJlIGJlIGEgY2hhbGxlbmdlIHdpdGggZXZlbnRzLiBVc2luZyB0aGUge3sjY3Jvc3NMaW5rICJFdmVudERpc3BhdGNoZXIvb24ifX17ey9jcm9zc0xpbmt9fQ0KICogbWV0aG9kIHRvIHN1YnNjcmliZSB0byBldmVudHMgc2ltcGxpZmllcyB0aGlzLg0KICoNCiAqICAgICAgaW5zdGFuY2UuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBmdW5jdGlvbihldmVudCkgew0KICogICAgICAgICAgY29uc29sZS5sb2coaW5zdGFuY2UgPT0gdGhpcyk7IC8vIGZhbHNlLCBzY29wZSBpcyBhbWJpZ3VvdXMuDQogKiAgICAgIH0pOw0KICogICAgICANCiAqICAgICAgaW5zdGFuY2Uub24oImNsaWNrIiwgZnVuY3Rpb24oZXZlbnQpIHsNCiAqICAgICAgICAgIGNvbnNvbGUubG9nKGluc3RhbmNlID09IHRoaXMpOyAvLyB0cnVlLCAib24iIHVzZXMgZGlzcGF0Y2hlciBzY29wZSBieSBkZWZhdWx0Lg0KICogICAgICB9KTsNCiAqIA0KICogSWYgeW91IHdhbnQgdG8gdXNlIGFkZEV2ZW50TGlzdGVuZXIgaW5zdGVhZCwgeW91IG1heSB3YW50IHRvIHVzZSBmdW5jdGlvbi5iaW5kKCkgb3IgYSBzaW1pbGFyIHByb3h5IHRvIG1hbmFnZSBzY29wZS4NCiAqICAgICAgDQogKg0KICogQGNsYXNzIEV2ZW50RGlzcGF0Y2hlcg0KICogQGNvbnN0cnVjdG9yDQogKiovDQp2YXIgRXZlbnREaXNwYXRjaGVyID0gZnVuY3Rpb24oKSB7DQovKgl0aGlzLmluaXRpYWxpemUoKTsgKi8gLy8gbm90IG5lZWRlZC4NCn07DQp2YXIgcCA9IEV2ZW50RGlzcGF0Y2hlci5wcm90b3R5cGU7DQoNCg0KCS8qKg0KCSAqIFN0YXRpYyBpbml0aWFsaXplciB0byBtaXggRXZlbnREaXNwYXRjaGVyIG1ldGhvZHMgaW50byBhIHRhcmdldCBvYmplY3Qgb3IgcHJvdG90eXBlLg0KCSAqIA0KCSAqIAkJRXZlbnREaXNwYXRjaGVyLmluaXRpYWxpemUoTXlDbGFzcy5wcm90b3R5cGUpOyAvLyBhZGQgdG8gdGhlIHByb3RvdHlwZSBvZiB0aGUgY2xhc3MNCgkgKiAJCUV2ZW50RGlzcGF0Y2hlci5pbml0aWFsaXplKG15T2JqZWN0KTsgLy8gYWRkIHRvIGEgc3BlY2lmaWMgaW5zdGFuY2UNCgkgKiANCgkgKiBAbWV0aG9kIGluaXRpYWxpemUNCgkgKiBAc3RhdGljDQoJICogQHBhcmFtIHtPYmplY3R9IHRhcmdldCBUaGUgdGFyZ2V0IG9iamVjdCB0byBpbmplY3QgRXZlbnREaXNwYXRjaGVyIG1ldGhvZHMgaW50by4gVGhpcyBjYW4gYmUgYW4gaW5zdGFuY2Ugb3IgYQ0KCSAqIHByb3RvdHlwZS4NCgkgKiovDQoJRXZlbnREaXNwYXRjaGVyLmluaXRpYWxpemUgPSBmdW5jdGlvbih0YXJnZXQpIHsNCgkJdGFyZ2V0LmFkZEV2ZW50TGlzdGVuZXIgPSBwLmFkZEV2ZW50TGlzdGVuZXI7DQoJCXRhcmdldC5vbiA9IHAub247DQoJCXRhcmdldC5yZW1vdmVFdmVudExpc3RlbmVyID0gdGFyZ2V0Lm9mZiA9ICBwLnJlbW92ZUV2ZW50TGlzdGVuZXI7DQoJCXRhcmdldC5yZW1vdmVBbGxFdmVudExpc3RlbmVycyA9IHAucmVtb3ZlQWxsRXZlbnRMaXN0ZW5lcnM7DQoJCXRhcmdldC5oYXNFdmVudExpc3RlbmVyID0gcC5oYXNFdmVudExpc3RlbmVyOw0KCQl0YXJnZXQuZGlzcGF0Y2hFdmVudCA9IHAuZGlzcGF0Y2hFdmVudDsNCgkJdGFyZ2V0Ll9kaXNwYXRjaEV2ZW50ID0gcC5fZGlzcGF0Y2hFdmVudDsNCgkJdGFyZ2V0LndpbGxUcmlnZ2VyID0gcC53aWxsVHJpZ2dlcjsNCgl9Ow0KCQ0KLy8gY29uc3RydWN0b3I6DQoNCi8vIHByaXZhdGUgcHJvcGVydGllczoNCgkvKioNCgkgKiBAcHJvdGVjdGVkDQoJICogQHByb3BlcnR5IF9saXN0ZW5lcnMNCgkgKiBAdHlwZSBPYmplY3QNCgkgKiovDQoJcC5fbGlzdGVuZXJzID0gbnVsbDsNCg0KCS8qKg0KCSAqIEBwcm90ZWN0ZWQNCgkgKiBAcHJvcGVydHkgX2NhcHR1cmVMaXN0ZW5lcnMNCgkgKiBAdHlwZSBPYmplY3QNCgkgKiovDQoJcC5fY2FwdHVyZUxpc3RlbmVycyA9IG51bGw7DQoNCi8vIGNvbnN0cnVjdG9yOg0KCS8qKg0KCSAqIEluaXRpYWxpemF0aW9uIG1ldGhvZC4NCgkgKiBAbWV0aG9kIGluaXRpYWxpemUNCgkgKiBAcHJvdGVjdGVkDQoJICoqLw0KCXAuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uKCkge307DQoNCi8vIHB1YmxpYyBtZXRob2RzOg0KCS8qKg0KCSAqIEFkZHMgdGhlIHNwZWNpZmllZCBldmVudCBsaXN0ZW5lci4gTm90ZSB0aGF0IGFkZGluZyBtdWx0aXBsZSBsaXN0ZW5lcnMgdG8gdGhlIHNhbWUgZnVuY3Rpb24gd2lsbCByZXN1bHQgaW4NCgkgKiBtdWx0aXBsZSBjYWxsYmFja3MgZ2V0dGluZyBmaXJlZC4NCgkgKg0KCSAqIDxoND5FeGFtcGxlPC9oND4NCgkgKg0KCSAqICAgICAgZGlzcGxheU9iamVjdC5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGhhbmRsZUNsaWNrKTsNCgkgKiAgICAgIGZ1bmN0aW9uIGhhbmRsZUNsaWNrKGV2ZW50KSB7DQoJICogICAgICAgICAvLyBDbGljayBoYXBwZW5lZC4NCgkgKiAgICAgIH0NCgkgKg0KCSAqIEBtZXRob2QgYWRkRXZlbnRMaXN0ZW5lcg0KCSAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlIFRoZSBzdHJpbmcgdHlwZSBvZiB0aGUgZXZlbnQuDQoJICogQHBhcmFtIHtGdW5jdGlvbiB8IE9iamVjdH0gbGlzdGVuZXIgQW4gb2JqZWN0IHdpdGggYSBoYW5kbGVFdmVudCBtZXRob2QsIG9yIGEgZnVuY3Rpb24gdGhhdCB3aWxsIGJlIGNhbGxlZCB3aGVuDQoJICogdGhlIGV2ZW50IGlzIGRpc3BhdGNoZWQuDQoJICogQHBhcmFtIHtCb29sZWFufSBbdXNlQ2FwdHVyZV0gRm9yIGV2ZW50cyB0aGF0IGJ1YmJsZSwgaW5kaWNhdGVzIHdoZXRoZXIgdG8gbGlzdGVuIGZvciB0aGUgZXZlbnQgaW4gdGhlIGNhcHR1cmUgb3IgYnViYmxpbmcvdGFyZ2V0IHBoYXNlLg0KCSAqIEByZXR1cm4ge0Z1bmN0aW9uIHwgT2JqZWN0fSBSZXR1cm5zIHRoZSBsaXN0ZW5lciBmb3IgY2hhaW5pbmcgb3IgYXNzaWdubWVudC4NCgkgKiovDQoJcC5hZGRFdmVudExpc3RlbmVyID0gZnVuY3Rpb24odHlwZSwgbGlzdGVuZXIsIHVzZUNhcHR1cmUpIHsNCgkJdmFyIGxpc3RlbmVyczsNCgkJaWYgKHVzZUNhcHR1cmUpIHsNCgkJCWxpc3RlbmVycyA9IHRoaXMuX2NhcHR1cmVMaXN0ZW5lcnMgPSB0aGlzLl9jYXB0dXJlTGlzdGVuZXJzfHx7fTsNCgkJfSBlbHNlIHsNCgkJCWxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVyc3x8e307DQoJCX0NCgkJdmFyIGFyciA9IGxpc3RlbmVyc1t0eXBlXTsNCgkJaWYgKGFycikgeyB0aGlzLnJlbW92ZUV2ZW50TGlzdGVuZXIodHlwZSwgbGlzdGVuZXIsIHVzZUNhcHR1cmUpOyB9DQoJCWFyciA9IGxpc3RlbmVyc1t0eXBlXTsgLy8gcmVtb3ZlIG1heSBoYXZlIGRlbGV0ZWQgdGhlIGFycmF5DQoJCWlmICghYXJyKSB7IGxpc3RlbmVyc1t0eXBlXSA9IFtsaXN0ZW5lcl07ICB9DQoJCWVsc2UgeyBhcnIucHVzaChsaXN0ZW5lcik7IH0NCgkJcmV0dXJuIGxpc3RlbmVyOw0KCX07DQoJDQoJLyoqDQoJICogQSBzaG9ydGN1dCBtZXRob2QgZm9yIHVzaW5nIGFkZEV2ZW50TGlzdGVuZXIgdGhhdCBtYWtlcyBpdCBlYXNpZXIgdG8gc3BlY2lmeSBhbiBleGVjdXRpb24gc2NvcGUsIGhhdmUgYSBsaXN0ZW5lcg0KCSAqIG9ubHkgcnVuIG9uY2UsIGFzc29jaWF0ZSBhcmJpdHJhcnkgZGF0YSB3aXRoIHRoZSBsaXN0ZW5lciwgYW5kIHJlbW92ZSB0aGUgbGlzdGVuZXIuDQoJICogDQoJICogVGhpcyBtZXRob2Qgd29ya3MgYnkgY3JlYXRpbmcgYW4gYW5vbnltb3VzIHdyYXBwZXIgZnVuY3Rpb24gYW5kIHN1YnNjcmliaW5nIGl0IHdpdGggYWRkRXZlbnRMaXN0ZW5lci4NCgkgKiBUaGUgY3JlYXRlZCBhbm9ueW1vdXMgZnVuY3Rpb24gaXMgcmV0dXJuZWQgZm9yIHVzZSB3aXRoIC5yZW1vdmVFdmVudExpc3RlbmVyIChvciAub2ZmKS4NCgkgKiANCgkgKiA8aDQ+RXhhbXBsZTwvaDQ+DQoJICogDQoJICogCQl2YXIgbGlzdGVuZXIgPSBteUJ0bi5vbigiY2xpY2siLCBoYW5kbGVDbGljaywgbnVsbCwgZmFsc2UsIHtjb3VudDozfSk7DQoJICogCQlmdW5jdGlvbiBoYW5kbGVDbGljayhldnQsIGRhdGEpIHsNCgkgKiAJCQlkYXRhLmNvdW50IC09IDE7DQoJICogCQkJY29uc29sZS5sb2codGhpcyA9PSBteUJ0bik7IC8vIHRydWUgLSBzY29wZSBkZWZhdWx0cyB0byB0aGUgZGlzcGF0Y2hlcg0KCSAqIAkJCWlmIChkYXRhLmNvdW50ID09IDApIHsNCgkgKiAJCQkJYWxlcnQoImNsaWNrZWQgMyB0aW1lcyEiKTsNCgkgKiAJCQkJbXlCdG4ub2ZmKCJjbGljayIsIGxpc3RlbmVyKTsNCgkgKiAJCQkJLy8gYWx0ZXJuYXRlbHk6IGV2dC5yZW1vdmUoKTsNCgkgKiAJCQl9DQoJICogCQl9DQoJICogDQoJICogQG1ldGhvZCBvbg0KCSAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlIFRoZSBzdHJpbmcgdHlwZSBvZiB0aGUgZXZlbnQuDQoJICogQHBhcmFtIHtGdW5jdGlvbiB8IE9iamVjdH0gbGlzdGVuZXIgQW4gb2JqZWN0IHdpdGggYSBoYW5kbGVFdmVudCBtZXRob2QsIG9yIGEgZnVuY3Rpb24gdGhhdCB3aWxsIGJlIGNhbGxlZCB3aGVuDQoJICogdGhlIGV2ZW50IGlzIGRpc3BhdGNoZWQuDQoJICogQHBhcmFtIHtPYmplY3R9IFtzY29wZV0gVGhlIHNjb3BlIHRvIGV4ZWN1dGUgdGhlIGxpc3RlbmVyIGluLiBEZWZhdWx0cyB0byB0aGUgZGlzcGF0Y2hlci9jdXJyZW50VGFyZ2V0IGZvciBmdW5jdGlvbiBsaXN0ZW5lcnMsIGFuZCB0byB0aGUgbGlzdGVuZXIgaXRzZWxmIGZvciBvYmplY3QgbGlzdGVuZXJzIChpZS4gdXNpbmcgaGFuZGxlRXZlbnQpLg0KCSAqIEBwYXJhbSB7Qm9vbGVhbn0gW29uY2U9ZmFsc2VdIElmIHRydWUsIHRoZSBsaXN0ZW5lciB3aWxsIHJlbW92ZSBpdHNlbGYgYWZ0ZXIgdGhlIGZpcnN0IHRpbWUgaXQgaXMgdHJpZ2dlcmVkLg0KCSAqIEBwYXJhbSB7Kn0gW2RhdGFdIEFyYml0cmFyeSBkYXRhIHRoYXQgd2lsbCBiZSBpbmNsdWRlZCBhcyB0aGUgc2Vjb25kIHBhcmFtZXRlciB3aGVuIHRoZSBsaXN0ZW5lciBpcyBjYWxsZWQuDQoJICogQHBhcmFtIHtCb29sZWFufSBbdXNlQ2FwdHVyZT1mYWxzZV0gRm9yIGV2ZW50cyB0aGF0IGJ1YmJsZSwgaW5kaWNhdGVzIHdoZXRoZXIgdG8gbGlzdGVuIGZvciB0aGUgZXZlbnQgaW4gdGhlIGNhcHR1cmUgb3IgYnViYmxpbmcvdGFyZ2V0IHBoYXNlLg0KCSAqIEByZXR1cm4ge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBhbm9ueW1vdXMgZnVuY3Rpb24gdGhhdCB3YXMgY3JlYXRlZCBhbmQgYXNzaWduZWQgYXMgdGhlIGxpc3RlbmVyLiBUaGlzIGlzIG5lZWRlZCB0byByZW1vdmUgdGhlIGxpc3RlbmVyIGxhdGVyIHVzaW5nIC5yZW1vdmVFdmVudExpc3RlbmVyLg0KCSAqKi8NCglwLm9uID0gZnVuY3Rpb24odHlwZSwgbGlzdGVuZXIsIHNjb3BlLCBvbmNlLCBkYXRhLCB1c2VDYXB0dXJlKSB7DQoJCWlmIChsaXN0ZW5lci5oYW5kbGVFdmVudCkgew0KCQkJc2NvcGUgPSBzY29wZXx8bGlzdGVuZXI7DQoJCQlsaXN0ZW5lciA9IGxpc3RlbmVyLmhhbmRsZUV2ZW50Ow0KCQl9DQoJCXNjb3BlID0gc2NvcGV8fHRoaXM7DQoJCXJldHVybiB0aGlzLmFkZEV2ZW50TGlzdGVuZXIodHlwZSwgZnVuY3Rpb24oZXZ0KSB7DQoJCQkJbGlzdGVuZXIuY2FsbChzY29wZSwgZXZ0LCBkYXRhKTsNCgkJCQlvbmNlJiZldnQucmVtb3ZlKCk7DQoJCQl9LCB1c2VDYXB0dXJlKTsNCgl9Ow0KDQoJLyoqDQoJICogUmVtb3ZlcyB0aGUgc3BlY2lmaWVkIGV2ZW50IGxpc3RlbmVyLg0KCSAqDQoJICogPGI+SW1wb3J0YW50IE5vdGU6PC9iPiB0aGF0IHlvdSBtdXN0IHBhc3MgdGhlIGV4YWN0IGZ1bmN0aW9uIHJlZmVyZW5jZSB1c2VkIHdoZW4gdGhlIGV2ZW50IHdhcyBhZGRlZC4gSWYgYSBwcm94eQ0KCSAqIGZ1bmN0aW9uLCBvciBmdW5jdGlvbiBjbG9zdXJlIGlzIHVzZWQgYXMgdGhlIGNhbGxiYWNrLCB0aGUgcHJveHkvY2xvc3VyZSByZWZlcmVuY2UgbXVzdCBiZSB1c2VkIC0gYSBuZXcgcHJveHkgb3INCgkgKiBjbG9zdXJlIHdpbGwgbm90IHdvcmsuDQoJICoNCgkgKiA8aDQ+RXhhbXBsZTwvaDQ+DQoJICoNCgkgKiAgICAgIGRpc3BsYXlPYmplY3QucmVtb3ZlRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBoYW5kbGVDbGljayk7DQoJICoNCgkgKiBAbWV0aG9kIHJlbW92ZUV2ZW50TGlzdGVuZXINCgkgKiBAcGFyYW0ge1N0cmluZ30gdHlwZSBUaGUgc3RyaW5nIHR5cGUgb2YgdGhlIGV2ZW50Lg0KCSAqIEBwYXJhbSB7RnVuY3Rpb24gfCBPYmplY3R9IGxpc3RlbmVyIFRoZSBsaXN0ZW5lciBmdW5jdGlvbiBvciBvYmplY3QuDQoJICogQHBhcmFtIHtCb29sZWFufSBbdXNlQ2FwdHVyZV0gRm9yIGV2ZW50cyB0aGF0IGJ1YmJsZSwgaW5kaWNhdGVzIHdoZXRoZXIgdG8gbGlzdGVuIGZvciB0aGUgZXZlbnQgaW4gdGhlIGNhcHR1cmUgb3IgYnViYmxpbmcvdGFyZ2V0IHBoYXNlLg0KCSAqKi8NCglwLnJlbW92ZUV2ZW50TGlzdGVuZXIgPSBmdW5jdGlvbih0eXBlLCBsaXN0ZW5lciwgdXNlQ2FwdHVyZSkgew0KCQl2YXIgbGlzdGVuZXJzID0gdXNlQ2FwdHVyZSA/IHRoaXMuX2NhcHR1cmVMaXN0ZW5lcnMgOiB0aGlzLl9saXN0ZW5lcnM7DQoJCWlmICghbGlzdGVuZXJzKSB7IHJldHVybjsgfQ0KCQl2YXIgYXJyID0gbGlzdGVuZXJzW3R5cGVdOw0KCQlpZiAoIWFycikgeyByZXR1cm47IH0NCgkJZm9yICh2YXIgaT0wLGw9YXJyLmxlbmd0aDsgaTxsOyBpKyspIHsNCgkJCWlmIChhcnJbaV0gPT0gbGlzdGVuZXIpIHsNCgkJCQlpZiAobD09MSkgeyBkZWxldGUobGlzdGVuZXJzW3R5cGVdKTsgfSAvLyBhbGxvd3MgZm9yIGZhc3RlciBjaGVja3MuDQoJCQkJZWxzZSB7IGFyci5zcGxpY2UoaSwxKTsgfQ0KCQkJCWJyZWFrOw0KCQkJfQ0KCQl9DQoJfTsNCgkNCgkvKioNCgkgKiBBIHNob3J0Y3V0IHRvIHRoZSByZW1vdmVFdmVudExpc3RlbmVyIG1ldGhvZCwgd2l0aCB0aGUgc2FtZSBwYXJhbWV0ZXJzIGFuZCByZXR1cm4gdmFsdWUuIFRoaXMgaXMgYSBjb21wYW5pb24gdG8gdGhlDQoJICogLm9uIG1ldGhvZC4NCgkgKg0KCSAqIEBtZXRob2Qgb2ZmDQoJICogQHBhcmFtIHtTdHJpbmd9IHR5cGUgVGhlIHN0cmluZyB0eXBlIG9mIHRoZSBldmVudC4NCgkgKiBAcGFyYW0ge0Z1bmN0aW9uIHwgT2JqZWN0fSBsaXN0ZW5lciBUaGUgbGlzdGVuZXIgZnVuY3Rpb24gb3Igb2JqZWN0Lg0KCSAqIEBwYXJhbSB7Qm9vbGVhbn0gW3VzZUNhcHR1cmVdIEZvciBldmVudHMgdGhhdCBidWJibGUsIGluZGljYXRlcyB3aGV0aGVyIHRvIGxpc3RlbiBmb3IgdGhlIGV2ZW50IGluIHRoZSBjYXB0dXJlIG9yIGJ1YmJsaW5nL3RhcmdldCBwaGFzZS4NCgkgKiovDQoJcC5vZmYgPSBwLnJlbW92ZUV2ZW50TGlzdGVuZXI7DQoNCgkvKioNCgkgKiBSZW1vdmVzIGFsbCBsaXN0ZW5lcnMgZm9yIHRoZSBzcGVjaWZpZWQgdHlwZSwgb3IgYWxsIGxpc3RlbmVycyBvZiBhbGwgdHlwZXMuDQoJICoNCgkgKiA8aDQ+RXhhbXBsZTwvaDQ+DQoJICoNCgkgKiAgICAgIC8vIFJlbW92ZSBhbGwgbGlzdGVuZXJzDQoJICogICAgICBkaXNwbGF5T2JqZWN0LnJlbW92ZUFsbEV2ZW50TGlzdGVuZXJzKCk7DQoJICoNCgkgKiAgICAgIC8vIFJlbW92ZSBhbGwgY2xpY2sgbGlzdGVuZXJzDQoJICogICAgICBkaXNwbGF5T2JqZWN0LnJlbW92ZUFsbEV2ZW50TGlzdGVuZXJzKCJjbGljayIpOw0KCSAqDQoJICogQG1ldGhvZCByZW1vdmVBbGxFdmVudExpc3RlbmVycw0KCSAqIEBwYXJhbSB7U3RyaW5nfSBbdHlwZV0gVGhlIHN0cmluZyB0eXBlIG9mIHRoZSBldmVudC4gSWYgb21pdHRlZCwgYWxsIGxpc3RlbmVycyBmb3IgYWxsIHR5cGVzIHdpbGwgYmUgcmVtb3ZlZC4NCgkgKiovDQoJcC5yZW1vdmVBbGxFdmVudExpc3RlbmVycyA9IGZ1bmN0aW9uKHR5cGUpIHsNCgkJaWYgKCF0eXBlKSB7IHRoaXMuX2xpc3RlbmVycyA9IHRoaXMuX2NhcHR1cmVMaXN0ZW5lcnMgPSBudWxsOyB9DQoJCWVsc2Ugew0KCQkJaWYgKHRoaXMuX2xpc3RlbmVycykgeyBkZWxldGUodGhpcy5fbGlzdGVuZXJzW3R5cGVdKTsgfQ0KCQkJaWYgKHRoaXMuX2NhcHR1cmVMaXN0ZW5lcnMpIHsgZGVsZXRlKHRoaXMuX2NhcHR1cmVMaXN0ZW5lcnNbdHlwZV0pOyB9DQoJCX0NCgl9Ow0KDQoJLyoqDQoJICogRGlzcGF0Y2hlcyB0aGUgc3BlY2lmaWVkIGV2ZW50IHRvIGFsbCBsaXN0ZW5lcnMuDQoJICoNCgkgKiA8aDQ+RXhhbXBsZTwvaDQ+DQoJICoNCgkgKiAgICAgIC8vIFVzZSBhIHN0cmluZyBldmVudA0KCSAqICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KCJjb21wbGV0ZSIpOw0KCSAqDQoJICogICAgICAvLyBVc2UgYW4gRXZlbnQgaW5zdGFuY2UNCgkgKiAgICAgIHZhciBldmVudCA9IG5ldyBjcmVhdGVqcy5FdmVudCgicHJvZ3Jlc3MiKTsNCgkgKiAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChldmVudCk7DQoJICoNCgkgKiBAbWV0aG9kIGRpc3BhdGNoRXZlbnQNCgkgKiBAcGFyYW0ge09iamVjdCB8IFN0cmluZyB8IEV2ZW50fSBldmVudE9iaiBBbiBvYmplY3Qgd2l0aCBhICJ0eXBlIiBwcm9wZXJ0eSwgb3IgYSBzdHJpbmcgdHlwZS4NCgkgKiBXaGlsZSBhIGdlbmVyaWMgb2JqZWN0IHdpbGwgd29yaywgaXQgaXMgcmVjb21tZW5kZWQgdG8gdXNlIGEgQ3JlYXRlSlMgRXZlbnQgaW5zdGFuY2UuIElmIGEgc3RyaW5nIGlzIHVzZWQsDQoJICogZGlzcGF0Y2hFdmVudCB3aWxsIGNvbnN0cnVjdCBhbiBFdmVudCBpbnN0YW5jZSB3aXRoIHRoZSBzcGVjaWZpZWQgdHlwZS4NCgkgKiBAcGFyYW0ge09iamVjdH0gW3RhcmdldF0gVGhlIG9iamVjdCB0byB1c2UgYXMgdGhlIHRhcmdldCBwcm9wZXJ0eSBvZiB0aGUgZXZlbnQgb2JqZWN0LiBUaGlzIHdpbGwgZGVmYXVsdCB0byB0aGUNCgkgKiBkaXNwYXRjaGluZyBvYmplY3QuIDxiPlRoaXMgcGFyYW1ldGVyIGlzIGRlcHJlY2F0ZWQgYW5kIHdpbGwgYmUgcmVtb3ZlZC48L2I+DQoJICogQHJldHVybiB7Qm9vbGVhbn0gUmV0dXJucyB0aGUgdmFsdWUgb2YgZXZlbnRPYmouZGVmYXVsdFByZXZlbnRlZC4NCgkgKiovDQoJcC5kaXNwYXRjaEV2ZW50ID0gZnVuY3Rpb24oZXZlbnRPYmosIHRhcmdldCkgew0KCQlpZiAodHlwZW9mIGV2ZW50T2JqID09ICJzdHJpbmciKSB7DQoJCQkvLyB3b24ndCBidWJibGUsIHNvIHNraXAgZXZlcnl0aGluZyBpZiB0aGVyZSdzIG5vIGxpc3RlbmVyczoNCgkJCXZhciBsaXN0ZW5lcnMgPSB0aGlzLl9saXN0ZW5lcnM7DQoJCQlpZiAoIWxpc3RlbmVycyB8fCAhbGlzdGVuZXJzW2V2ZW50T2JqXSkgeyByZXR1cm4gZmFsc2U7IH0NCgkJCWV2ZW50T2JqID0gbmV3IGNyZWF0ZWpzLkV2ZW50KGV2ZW50T2JqKTsNCgkJfQ0KCQkvLyBUT0RPOiBkZXByZWNhdGVkLiBUYXJnZXQgcGFyYW0gaXMgZGVwcmVjYXRlZCwgb25seSB1c2UgY2FzZSBpcyBNb3VzZUV2ZW50L21vdXNlbW92ZSwgcmVtb3ZlLg0KCQlldmVudE9iai50YXJnZXQgPSB0YXJnZXR8fHRoaXM7DQoNCgkJaWYgKCFldmVudE9iai5idWJibGVzIHx8ICF0aGlzLnBhcmVudCkgew0KCQkJdGhpcy5fZGlzcGF0Y2hFdmVudChldmVudE9iaiwgMik7DQoJCX0gZWxzZSB7DQoJCQl2YXIgdG9wPXRoaXMsIGxpc3Q9W3RvcF07DQoJCQl3aGlsZSAodG9wLnBhcmVudCkgeyBsaXN0LnB1c2godG9wID0gdG9wLnBhcmVudCk7IH0NCgkJCXZhciBpLCBsPWxpc3QubGVuZ3RoOw0KDQoJCQkvLyBjYXB0dXJlICYgYXRUYXJnZXQNCgkJCWZvciAoaT1sLTE7IGk+PTAgJiYgIWV2ZW50T2JqLnByb3BhZ2F0aW9uU3RvcHBlZDsgaS0tKSB7DQoJCQkJbGlzdFtpXS5fZGlzcGF0Y2hFdmVudChldmVudE9iaiwgMSsoaT09MCkpOw0KCQkJfQ0KCQkJLy8gYnViYmxpbmcNCgkJCWZvciAoaT0xOyBpPGwgJiYgIWV2ZW50T2JqLnByb3BhZ2F0aW9uU3RvcHBlZDsgaSsrKSB7DQoJCQkJbGlzdFtpXS5fZGlzcGF0Y2hFdmVudChldmVudE9iaiwgMyk7DQoJCQl9DQoJCX0NCgkJcmV0dXJuIGV2ZW50T2JqLmRlZmF1bHRQcmV2ZW50ZWQ7DQoJfTsNCg0KCS8qKg0KCSAqIEluZGljYXRlcyB3aGV0aGVyIHRoZXJlIGlzIGF0IGxlYXN0IG9uZSBsaXN0ZW5lciBmb3IgdGhlIHNwZWNpZmllZCBldmVudCB0eXBlLg0KCSAqIEBtZXRob2QgaGFzRXZlbnRMaXN0ZW5lcg0KCSAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlIFRoZSBzdHJpbmcgdHlwZSBvZiB0aGUgZXZlbnQuDQoJICogQHJldHVybiB7Qm9vbGVhbn0gUmV0dXJucyB0cnVlIGlmIHRoZXJlIGlzIGF0IGxlYXN0IG9uZSBsaXN0ZW5lciBmb3IgdGhlIHNwZWNpZmllZCBldmVudC4NCgkgKiovDQoJcC5oYXNFdmVudExpc3RlbmVyID0gZnVuY3Rpb24odHlwZSkgew0KCQl2YXIgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzLCBjYXB0dXJlTGlzdGVuZXJzID0gdGhpcy5fY2FwdHVyZUxpc3RlbmVyczsNCgkJcmV0dXJuICEhKChsaXN0ZW5lcnMgJiYgbGlzdGVuZXJzW3R5cGVdKSB8fCAoY2FwdHVyZUxpc3RlbmVycyAmJiBjYXB0dXJlTGlzdGVuZXJzW3R5cGVdKSk7DQoJfTsNCgkNCgkvKioNCgkgKiBJbmRpY2F0ZXMgd2hldGhlciB0aGVyZSBpcyBhdCBsZWFzdCBvbmUgbGlzdGVuZXIgZm9yIHRoZSBzcGVjaWZpZWQgZXZlbnQgdHlwZSBvbiB0aGlzIG9iamVjdCBvciBhbnkgb2YgaXRzDQoJICogYW5jZXN0b3JzIChwYXJlbnQsIHBhcmVudCdzIHBhcmVudCwgZXRjKS4gQSByZXR1cm4gdmFsdWUgb2YgdHJ1ZSBpbmRpY2F0ZXMgdGhhdCBpZiBhIGJ1YmJsaW5nIGV2ZW50IG9mIHRoZQ0KCSAqIHNwZWNpZmllZCB0eXBlIGlzIGRpc3BhdGNoZWQgZnJvbSB0aGlzIG9iamVjdCwgaXQgd2lsbCB0cmlnZ2VyIGF0IGxlYXN0IG9uZSBsaXN0ZW5lci4NCgkgKiANCgkgKiBUaGlzIGlzIHNpbWlsYXIgdG8ge3sjY3Jvc3NMaW5rICJFdmVudERpc3BhdGNoZXIvaGFzRXZlbnRMaXN0ZW5lciJ9fXt7L2Nyb3NzTGlua319LCBidXQgaXQgc2VhcmNoZXMgdGhlIGVudGlyZQ0KCSAqIGV2ZW50IGZsb3cgZm9yIGEgbGlzdGVuZXIsIG5vdCBqdXN0IHRoaXMgb2JqZWN0Lg0KCSAqIEBtZXRob2Qgd2lsbFRyaWdnZXINCgkgKiBAcGFyYW0ge1N0cmluZ30gdHlwZSBUaGUgc3RyaW5nIHR5cGUgb2YgdGhlIGV2ZW50Lg0KCSAqIEByZXR1cm4ge0Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIHRoZXJlIGlzIGF0IGxlYXN0IG9uZSBsaXN0ZW5lciBmb3IgdGhlIHNwZWNpZmllZCBldmVudC4NCgkgKiovDQoJcC53aWxsVHJpZ2dlciA9IGZ1bmN0aW9uKHR5cGUpIHsNCgkJdmFyIG8gPSB0aGlzOw0KCQl3aGlsZSAobykgew0KCQkJaWYgKG8uaGFzRXZlbnRMaXN0ZW5lcih0eXBlKSkgeyByZXR1cm4gdHJ1ZTsgfQ0KCQkJbyA9IG8ucGFyZW50Ow0KCQl9DQoJCXJldHVybiBmYWxzZTsNCgl9Ow0KDQoJLyoqDQoJICogQG1ldGhvZCB0b1N0cmluZw0KCSAqIEByZXR1cm4ge1N0cmluZ30gYSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIGluc3RhbmNlLg0KCSAqKi8NCglwLnRvU3RyaW5nID0gZnVuY3Rpb24oKSB7DQoJCXJldHVybiAiW0V2ZW50RGlzcGF0Y2hlcl0iOw0KCX07DQoNCi8vIHByaXZhdGUgbWV0aG9kczoNCgkvKioNCgkgKiBAbWV0aG9kIF9kaXNwYXRjaEV2ZW50DQoJICogQHBhcmFtIHtPYmplY3QgfCBTdHJpbmcgfCBFdmVudH0gZXZlbnRPYmoNCgkgKiBAcGFyYW0ge09iamVjdH0gZXZlbnRQaGFzZQ0KCSAqIEBwcm90ZWN0ZWQNCgkgKiovDQoJcC5fZGlzcGF0Y2hFdmVudCA9IGZ1bmN0aW9uKGV2ZW50T2JqLCBldmVudFBoYXNlKSB7DQoJCXZhciBsLCBsaXN0ZW5lcnMgPSAoZXZlbnRQaGFzZT09MSkgPyB0aGlzLl9jYXB0dXJlTGlzdGVuZXJzIDogdGhpcy5fbGlzdGVuZXJzOw0KCQlpZiAoZXZlbnRPYmogJiYgbGlzdGVuZXJzKSB7DQoJCQl2YXIgYXJyID0gbGlzdGVuZXJzW2V2ZW50T2JqLnR5cGVdOw0KCQkJaWYgKCFhcnJ8fCEobD1hcnIubGVuZ3RoKSkgeyByZXR1cm47IH0NCgkJCWV2ZW50T2JqLmN1cnJlbnRUYXJnZXQgPSB0aGlzOw0KCQkJZXZlbnRPYmouZXZlbnRQaGFzZSA9IGV2ZW50UGhhc2U7DQoJCQlldmVudE9iai5yZW1vdmVkID0gZmFsc2U7DQoJCQlhcnIgPSBhcnIuc2xpY2UoKTsgLy8gdG8gYXZvaWQgaXNzdWVzIHdpdGggaXRlbXMgYmVpbmcgcmVtb3ZlZCBvciBhZGRlZCBkdXJpbmcgdGhlIGRpc3BhdGNoDQoJCQlmb3IgKHZhciBpPTA7IGk8bCAmJiAhZXZlbnRPYmouaW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkOyBpKyspIHsNCgkJCQl2YXIgbyA9IGFycltpXTsNCgkJCQlpZiAoby5oYW5kbGVFdmVudCkgeyBvLmhhbmRsZUV2ZW50KGV2ZW50T2JqKTsgfQ0KCQkJCWVsc2UgeyBvKGV2ZW50T2JqKTsgfQ0KCQkJCWlmIChldmVudE9iai5yZW1vdmVkKSB7DQoJCQkJCXRoaXMub2ZmKGV2ZW50T2JqLnR5cGUsIG8sIGV2ZW50UGhhc2U9PTEpOw0KCQkJCQlldmVudE9iai5yZW1vdmVkID0gZmFsc2U7DQoJCQkJfQ0KCQkJfQ0KCQl9DQoJfTsNCg0KDQpjcmVhdGVqcy5FdmVudERpc3BhdGNoZXIgPSBFdmVudERpc3BhdGNoZXI7DQp9KCkpOw0KLyoKKiBJbmRleE9mCiogVmlzaXQgaHR0cDovL2NyZWF0ZWpzLmNvbS8gZm9yIGRvY3VtZW50YXRpb24sIHVwZGF0ZXMgYW5kIGV4YW1wbGVzLgoqCiogQ29weXJpZ2h0IChjKSAyMDEwIGdza2lubmVyLmNvbSwgaW5jLgoqIAoqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uCiogb2J0YWluaW5nIGEgY29weSBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24KKiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0CiogcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0cyB0byB1c2UsCiogY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwKKiBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUKKiBTb2Z0d2FyZSBpcyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZwoqIGNvbmRpdGlvbnM6CiogCiogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUKKiBpbmNsdWRlZCBpbiBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KKiAKKiBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwKKiBFWFBSRVNTIE9SIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMKKiBPRiBNRVJDSEFOVEFCSUxJVFksIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORAoqIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUlMgT1IgQ09QWVJJR0hUCiogSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUiBMSUFCSUxJVFksCiogV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HCiogRlJPTSwgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUgoqIE9USEVSIERFQUxJTkdTIElOIFRIRSBTT0ZUV0FSRS4KKi8KCi8qKgogICogQG1vZHVsZSBDcmVhdGVKUwogKi8KCi8vIG5hbWVzcGFjZToKdGhpcy5jcmVhdGVqcyA9IHRoaXMuY3JlYXRlanN8fHt9OwoKLyoqCiAqIEBjbGFzcyBVdGlsaXR5IE1ldGhvZHMKICovCihmdW5jdGlvbigpIHsKCSJ1c2Ugc3RyaWN0IjsKCgkvKgoJICogRW1wbG95cyBEdWZmJ3MgRGV2aWNlIHRvIG1ha2UgYSBtb3JlIHBlcmZvcm1hbnQgaW1wbGVtZW50YXRpb24gb2YgaW5kZXhPZi4KCSAqIHNlZSBodHRwOi8vanNwZXJmLmNvbS9kdWZmcy1pbmRleG9mLzIKCSAqICNtZXRob2QgaW5kZXhPZgoJICogQHBhcmFtIHtBcnJheX0gYXJyYXkgQXJyYXkgdG8gc2VhcmNoIGZvciBzZWFyY2hFbGVtZW50CgkgKiBAcGFyYW0gc2VhcmNoRWxlbWVudCBFbGVtZW50IHRvIHNlYXJjaCBhcnJheSBmb3IuCgkgKiBAcmV0dXJuIHtOdW1iZXJ9IFRoZSBwb3NpdGlvbiBvZiB0aGUgZmlyc3Qgb2NjdXJyZW5jZSBvZiBhIHNwZWNpZmllZCB2YWx1ZSBzZWFyY2hFbGVtZW50IGluIHRoZSBwYXNzZWQgaW4gYXJyYXkgYXIuCgkgKiBAY29uc3RydWN0b3IKCSAqLwoJLyogcmVwbGFjZWQgd2l0aCBzaW1wbGUgZm9yIGxvb3AgZm9yIG5vdywgcGVyaGFwcyB3aWxsIGJlIHJlc2VhcmNoZWQgZnVydGhlcgoJY3JlYXRlanMuaW5kZXhPZiA9IGZ1bmN0aW9uIChhciwgc2VhcmNoRWxlbWVudCkgewoJCXZhciBsID0gYXIubGVuZ3RoOwoKCQl2YXIgbiA9IChsICogMC4xMjUpIF4gMDsJLy8gMC4xMjUgPT0gMS84LCB1c2luZyBtdWx0aXBsaWNhdGlvbiBiZWNhdXNlIGl0J3MgZmFzdGVyIGluIHNvbWUgYnJvd3NlcnMJLy8gXjAgZmxvb3JzIHJlc3VsdAoJCWZvciAodmFyIGkgPSAwOyBpIDwgbjsgaSsrKSB7CgkJCWlmKHNlYXJjaEVsZW1lbnQgPT09IGFyW2kqOF0pICAgeyByZXR1cm4gKGkqOCk7fQoJCQlpZihzZWFyY2hFbGVtZW50ID09PSBhcltpKjgrMV0pIHsgcmV0dXJuIChpKjgrMSk7fQoJCQlpZihzZWFyY2hFbGVtZW50ID09PSBhcltpKjgrMl0pIHsgcmV0dXJuIChpKjgrMik7fQoJCQlpZihzZWFyY2hFbGVtZW50ID09PSBhcltpKjgrM10pIHsgcmV0dXJuIChpKjgrMyk7fQoJCQlpZihzZWFyY2hFbGVtZW50ID09PSBhcltpKjgrNF0pIHsgcmV0dXJuIChpKjgrNCk7fQoJCQlpZihzZWFyY2hFbGVtZW50ID09PSBhcltpKjgrNV0pIHsgcmV0dXJuIChpKjgrNSk7fQoJCQlpZihzZWFyY2hFbGVtZW50ID09PSBhcltpKjgrNl0pIHsgcmV0dXJuIChpKjgrNik7fQoJCQlpZihzZWFyY2hFbGVtZW50ID09PSBhcltpKjgrN10pIHsgcmV0dXJuIChpKjgrNyk7fQoJCX0KCgkJdmFyIG4gPSBsICUgODsKCQlmb3IgKHZhciBpID0gMDsgaSA8IG47IGkrKykgewoJCQlpZiAoc2VhcmNoRWxlbWVudCA9PT0gYXJbbC1uK2ldKSB7CgkJCQlyZXR1cm4gbC1uK2k7CgkJCX0KCQl9CgoJCXJldHVybiAtMTsKCX0KCSovCgoJLyoqCgkgKiBGaW5kcyB0aGUgZmlyc3Qgb2NjdXJyZW5jZSBvZiBhIHNwZWNpZmllZCB2YWx1ZSBzZWFyY2hFbGVtZW50IGluIHRoZSBwYXNzZWQgaW4gYXJyYXksIGFuZCByZXR1cm5zIHRoZSBpbmRleCBvZgoJICogdGhhdCB2YWx1ZS4gIFJldHVybnMgLTEgaWYgdmFsdWUgaXMgbm90IGZvdW5kLgoJICoKCSAqICAgICAgdmFyIGkgPSBjcmVhdGVqcy5pbmRleE9mKG15QXJyYXksIG15RWxlbWVudFRvRmluZCk7CgkgKgoJICogQG1ldGhvZCBpbmRleE9mCgkgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBBcnJheSB0byBzZWFyY2ggZm9yIHNlYXJjaEVsZW1lbnQKCSAqIEBwYXJhbSBzZWFyY2hFbGVtZW50IEVsZW1lbnQgdG8gZmluZCBpbiBhcnJheS4KCSAqIEByZXR1cm4ge051bWJlcn0gVGhlIGZpcnN0IGluZGV4IG9mIHNlYXJjaEVsZW1lbnQgaW4gYXJyYXkuCgkgKi8KCWNyZWF0ZWpzLmluZGV4T2YgPSBmdW5jdGlvbiAoYXJyYXksIHNlYXJjaEVsZW1lbnQpewoJCWZvciAodmFyIGkgPSAwLGw9YXJyYXkubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CgkJCWlmIChzZWFyY2hFbGVtZW50ID09PSBhcnJheVtpXSkgewoJCQkJcmV0dXJuIGk7CgkJCX0KCQl9CgkJcmV0dXJuIC0xOwoJfQoKfSgpKTsvKgoqIFByb3h5CiogVmlzaXQgaHR0cDovL2NyZWF0ZWpzLmNvbS8gZm9yIGRvY3VtZW50YXRpb24sIHVwZGF0ZXMgYW5kIGV4YW1wbGVzLgoqCiogQ29weXJpZ2h0IChjKSAyMDEwIGdza2lubmVyLmNvbSwgaW5jLgoqIAoqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uCiogb2J0YWluaW5nIGEgY29weSBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24KKiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0CiogcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0cyB0byB1c2UsCiogY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwKKiBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUKKiBTb2Z0d2FyZSBpcyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZwoqIGNvbmRpdGlvbnM6CiogCiogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUKKiBpbmNsdWRlZCBpbiBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KKiAKKiBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwKKiBFWFBSRVNTIE9SIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMKKiBPRiBNRVJDSEFOVEFCSUxJVFksIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORAoqIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUlMgT1IgQ09QWVJJR0hUCiogSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUiBMSUFCSUxJVFksCiogV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HCiogRlJPTSwgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUgoqIE9USEVSIERFQUxJTkdTIElOIFRIRSBTT0ZUV0FSRS4KKi8KCi8qKgogKiBAbW9kdWxlIENyZWF0ZUpTCiAqLwoKLy8gbmFtZXNwYWNlOgp0aGlzLmNyZWF0ZWpzID0gdGhpcy5jcmVhdGVqc3x8e307CgovKioKICogVmFyaW91cyB1dGlsaXRpZXMgdGhhdCB0aGUgQ3JlYXRlSlMgU3VpdGUgdXNlcy4gVXRpbGl0aWVzIGFyZSBjcmVhdGVkIGFzIHNlcGFyYXRlIGZpbGVzLCBhbmQgd2lsbCBiZSBhdmFpbGFibGUgb24gdGhlCiAqIGNyZWF0ZWpzIG5hbWVzcGFjZSBkaXJlY3RseToKICoKICogPGg0PkV4YW1wbGU8L2g0PgogKiAgICAgIG15T2JqZWN0LmFkZEV2ZW50TGlzdGVuZXIoImNoYW5nZSIsIGNyZWF0ZWpzLnByb3h5KG15TWV0aG9kLCBzY29wZSkpOwogKgogKiBAY2xhc3MgVXRpbGl0eSBNZXRob2RzCiAqIEBtYWluIFV0aWxpdHkgTWV0aG9kcwogKi8KCihmdW5jdGlvbigpIHsKCSJ1c2Ugc3RyaWN0IjsKCgkvKioKCSAqIEEgZnVuY3Rpb24gcHJveHkgZm9yIG1ldGhvZHMuIEJ5IGRlZmF1bHQsIEphdmFTY3JpcHQgbWV0aG9kcyBkbyBub3QgbWFpbnRhaW4gc2NvcGUsIHNvIHBhc3NpbmcgYSBtZXRob2QgYXMgYQoJICogY2FsbGJhY2sgd2lsbCByZXN1bHQgaW4gdGhlIG1ldGhvZCBnZXR0aW5nIGNhbGxlZCBpbiB0aGUgc2NvcGUgb2YgdGhlIGNhbGxlci4gVXNpbmcgYSBwcm94eSBlbnN1cmVzIHRoYXQgdGhlCgkgKiBtZXRob2QgZ2V0cyBjYWxsZWQgaW4gdGhlIGNvcnJlY3Qgc2NvcGUuCgkgKgoJICogQWRkaXRpb25hbCBhcmd1bWVudHMgY2FuIGJlIHBhc3NlZCB0aGF0IHdpbGwgYmUgYXBwbGllZCB0byB0aGUgZnVuY3Rpb24gd2hlbiBpdCBpcyBjYWxsZWQuCgkgKgoJICogPGg0PkV4YW1wbGU8L2g0PgoJICogICAgICBteU9iamVjdC5hZGRFdmVudExpc3RlbmVyKCJldmVudCIsIGNyZWF0ZWpzLnByb3h5KG15SGFuZGxlciwgdGhpcywgYXJnMSwgYXJnMikpOwoJICoKCSAqICAgICAgZnVuY3Rpb24gbXlIYW5kbGVyKGFyZzEsIGFyZzIpIHsKCSAqICAgICAgICAgICAvLyBUaGlzIGdldHMgY2FsbGVkIHdoZW4gbXlPYmplY3QubXlDYWxsYmFjayBpcyBleGVjdXRlZC4KCSAqICAgICAgfQoJICoKCSAqIEBtZXRob2QgcHJveHkKCSAqIEBwYXJhbSB7RnVuY3Rpb259IG1ldGhvZCBUaGUgZnVuY3Rpb24gdG8gY2FsbAoJICogQHBhcmFtIHtPYmplY3R9IHNjb3BlIFRoZSBzY29wZSB0byBjYWxsIHRoZSBtZXRob2QgbmFtZSBvbgoJICogQHBhcmFtIHttaXhlZH0gW2FyZ10gKiBBcmd1bWVudHMgdGhhdCBhcmUgYXBwZW5kZWQgdG8gdGhlIGNhbGxiYWNrIGZvciBhZGRpdGlvbmFsIHBhcmFtcy4KCSAqIEBwdWJsaWMKCSAqIEBzdGF0aWMKCSAqLwoJY3JlYXRlanMucHJveHkgPSBmdW5jdGlvbiAobWV0aG9kLCBzY29wZSkgewoJCXZhciBhQXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMik7CgkJcmV0dXJuIGZ1bmN0aW9uICgpIHsKCQkJcmV0dXJuIG1ldGhvZC5hcHBseShzY29wZSwgQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAwKS5jb25jYXQoYUFyZ3MpKTsKCQl9OwoJfQoKfSgpKTsvKgoqIEFic3RyYWN0TG9hZGVyCiogVmlzaXQgaHR0cDovL2NyZWF0ZWpzLmNvbS8gZm9yIGRvY3VtZW50YXRpb24sIHVwZGF0ZXMgYW5kIGV4YW1wbGVzLgoqCioKKiBDb3B5cmlnaHQgKGMpIDIwMTIgZ3NraW5uZXIuY29tLCBpbmMuCioKKiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbgoqIG9idGFpbmluZyBhIGNvcHkgb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uCiogZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8gZGVhbCBpbiB0aGUgU29mdHdhcmUgd2l0aG91dAoqIHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMgdG8gdXNlLAoqIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsCiogY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlCiogU29mdHdhcmUgaXMgZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcKKiBjb25kaXRpb25zOgoqCiogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUKKiBpbmNsdWRlZCBpbiBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KKgoqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELAoqIEVYUFJFU1MgT1IgSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUwoqIE9GIE1FUkNIQU5UQUJJTElUWSwgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5ECiogTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SUyBPUiBDT1BZUklHSFQKKiBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSIExJQUJJTElUWSwKKiBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcKKiBGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SCiogT1RIRVIgREVBTElOR1MgSU4gVEhFIFNPRlRXQVJFLgoqLwoKLyoqCiAqIEBtb2R1bGUgUHJlbG9hZEpTCiAqLwoKLy8gbmFtZXNwYWNlOgp0aGlzLmNyZWF0ZWpzID0gdGhpcy5jcmVhdGVqc3x8e307CgooZnVuY3Rpb24oKSB7CgkidXNlIHN0cmljdCI7CgkvKioKCSAqIFRoZSBiYXNlIGxvYWRlciwgd2hpY2ggZGVmaW5lcyBhbGwgdGhlIGdlbmVyaWMgY2FsbGJhY2tzIGFuZCBldmVudHMuIEFsbCBsb2FkZXJzIGV4dGVuZCB0aGlzIGNsYXNzLCBpbmNsdWRpbmcgdGhlCgkgKiB7eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZSJ9fXt7L2Nyb3NzTGlua319LgoJICogQGNsYXNzIEFic3RyYWN0TG9hZGVyCgkgKiBAZXh0ZW5kcyBFdmVudERpc3BhdGNoZXIKCSAqLwoJdmFyIEFic3RyYWN0TG9hZGVyID0gZnVuY3Rpb24gKCkgewoJCXRoaXMuaW5pdCgpOwoJfTsKCglBYnN0cmFjdExvYWRlci5wcm90b3R5cGUgPSBuZXcgY3JlYXRlanMuRXZlbnREaXNwYXRjaGVyKCk7IC8vVE9ETzogVEVTVCEKCXZhciBwID0gQWJzdHJhY3RMb2FkZXIucHJvdG90eXBlOwoJdmFyIHMgPSBBYnN0cmFjdExvYWRlcjsKCgkvKioKCSAqIFRoZSBSZWdFeHAgcGF0dGVybiB0byB1c2UgdG8gcGFyc2UgZmlsZSBVUklzLiBUaGlzIHN1cHBvcnRzIHNpbXBsZSBmaWxlIG5hbWVzLCBhcyB3ZWxsIGFzIGZ1bGwgZG9tYWluIFVSSXMgd2l0aAoJICogcXVlcnkgc3RyaW5ncy4gVGhlIHJlc3VsdGluZyBtYXRjaCBpczogcHJvdG9jb2w6JDEgZG9tYWluOiQyIHJlbGF0aXZlUGF0aDokMyBwYXRoOiQ0IGZpbGU6JDUgZXh0ZW5zaW9uOiQ2IHF1ZXJ5OiQ3LgoJICogQHByb3BlcnR5IEZJTEVfUEFUVEVSTgoJICogQHR5cGUge1JlZ0V4cH0KCSAqIEBzdGF0aWMKCSAqIEBwcm90ZWN0ZWQKCSAqLwoJcy5GSUxFX1BBVFRFUk4gPSAvXig/Oihcdys6KVwvezJ9KFx3Kyg/OlwuXHcrKSpcLz8pfCguezAsMn1cL3sxfSkpPyhbLy5dKj8oPzpbXj9dKyk/XC8pPygoPzpbXi8/XSspXC4oXHcrKSkoPzpcPyhcUyspPyk/JC87CgoJLyoqCgkgKiBUaGUgUmVnRXhwIHBhdHRlcm4gdG8gdXNlIHRvIHBhcnNlIHBhdGggVVJJcy4gVGhpcyBzdXBwb3J0cyBwcm90b2NvbHMsIHJlbGF0aXZlIGZpbGVzLCBhbmQgcGF0aHMuIFRoZSByZXN1bHRpbmcKCSAqIG1hdGNoIGlzOiBwcm90b2NvbDokMSByZWxhdGl2ZVBhdGg6JDIgcGF0aCQzLgoJICogQHByb3BlcnR5IFBBVEhfUEFUVEVSTgoJICogQHR5cGUge1JlZ0V4cH0KCSAqIEBzdGF0aWMKCSAqIEBwcm90ZWN0ZWQKCSAqLwoJcy5QQVRIX1BBVFRFUk4gPSAvXig/Oihcdys6KVwvezJ9KXwoLnswLDJ9XC97MX0pPyhbLy5dKj8oPzpbXj9dKyk/XC8/KT8kLzsKCgkvKioKCSAqIElmIHRoZSBsb2FkZXIgaGFzIGNvbXBsZXRlZCBsb2FkaW5nLiBUaGlzIHByb3ZpZGVzIGEgcXVpY2sgY2hlY2ssIGJ1dCBhbHNvIGVuc3VyZXMgdGhhdCB0aGUgZGlmZmVyZW50IGFwcHJvYWNoZXMKCSAqIHVzZWQgZm9yIGxvYWRpbmcgZG8gbm90IHBpbGUgdXAgcmVzdWx0aW5nIGluIG1vcmUgdGhhbiBvbmUgPGNvZGU+Y29tcGxldGU8L2NvZGU+IGV2ZW50LgoJICogQHByb3BlcnR5IGxvYWRlZAoJICogQHR5cGUge0Jvb2xlYW59CgkgKiBAZGVmYXVsdCBmYWxzZQoJICovCglwLmxvYWRlZCA9IGZhbHNlOwoKCS8qKgoJICogRGV0ZXJtaW5lIGlmIHRoZSBsb2FkZXIgd2FzIGNhbmNlbGVkLiBDYW5jZWxlZCBsb2FkcyB3aWxsIG5vdCBmaXJlIGNvbXBsZXRlIGV2ZW50cy4gTm90ZSB0aGF0CgkgKiB7eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZSJ9fXt7L2Nyb3NzTGlua319IHF1ZXVlcyBzaG91bGQgYmUgY2xvc2VkIHVzaW5nIHt7I2Nyb3NzTGluayAiQWJzdHJhY3RMb2FkZXIvY2xvc2UifX17ey9jcm9zc0xpbmt9fQoJICogaW5zdGVhZCBvZiBzZXR0aW5nIHRoaXMgcHJvcGVydHkuCgkgKiBAcHJvcGVydHkgY2FuY2VsZWQKCSAqIEB0eXBlIHtCb29sZWFufQoJICogQGRlZmF1bHQgZmFsc2UKCSAqLwoJcC5jYW5jZWxlZCA9IGZhbHNlOwoKCS8qKgoJICogVGhlIGN1cnJlbnQgbG9hZCBwcm9ncmVzcyAocGVyY2VudGFnZSkgZm9yIHRoaXMgaXRlbS4gVGhpcyB3aWxsIGJlIGEgbnVtYmVyIGJldHdlZW4gMCBhbmQgMS4KCSAqCgkgKiA8aDQ+RXhhbXBsZTwvaDQ+CgkgKgoJICogICAgIHZhciBxdWV1ZSA9IG5ldyBjcmVhdGVqcy5Mb2FkUXVldWUoKTsKCSAqICAgICBxdWV1ZS5sb2FkRmlsZSgibGFyZ2VJbWFnZS5wbmciKTsKCSAqICAgICBxdWV1ZS5vbigicHJvZ3Jlc3MiLCBmdW5jdGlvbigpIHsKCSAqICAgICAgICAgY29uc29sZS5sb2coIlByb2dyZXNzOiIsIHF1ZXVlLnByb2dyZXNzLCBldmVudC5wcm9ncmVzcyk7CgkgKiAgICAgfSk7CgkgKgoJICogQHByb3BlcnR5IHByb2dyZXNzCgkgKiBAdHlwZSB7TnVtYmVyfQoJICogQGRlZmF1bHQgMAoJICovCglwLnByb2dyZXNzID0gMDsKCgkvKioKCSAqIFRoZSBpdGVtIHRoaXMgbG9hZGVyIHJlcHJlc2VudHMuIE5vdGUgdGhhdCB0aGlzIGlzIG51bGwgaW4gYSB7eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZSJ9fXt7L2Nyb3NzTGlua319LCBidXQgd2lsbAoJICogYmUgYXZhaWxhYmxlIG9uIGxvYWRlcnMgc3VjaCBhcyB7eyNjcm9zc0xpbmsgIlhIUkxvYWRlciJ9fXt7L2Nyb3NzTGlua319IGFuZCB7eyNjcm9zc0xpbmsgIlRhZ0xvYWRlciJ9fXt7L2Nyb3NzTGlua319LgoJICogQHByb3BlcnR5IF9pdGVtCgkgKiBAdHlwZSB7T2JqZWN0fQoJICogQHByaXZhdGUKCSAqLwoJcC5faXRlbSA9IG51bGw7CgovLyBFdmVudHMKCS8qKgoJICogVGhlIGV2ZW50IHRoYXQgaXMgZmlyZWQgd2hlbiB0aGUgb3ZlcmFsbCBwcm9ncmVzcyBjaGFuZ2VzLgoJICogQGV2ZW50IHByb2dyZXNzCgkgKiBAcGFyYW0ge09iamVjdH0gdGFyZ2V0IFRoZSBvYmplY3QgdGhhdCBkaXNwYXRjaGVkIHRoZSBldmVudC4KCSAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlIFRoZSBldmVudCB0eXBlLgoJICogQHBhcmFtIHtOdW1iZXJ9IGxvYWRlZCBUaGUgYW1vdW50IHRoYXQgaGFzIGJlZW4gbG9hZGVkIHNvIGZhci4gTm90ZSB0aGF0IHRoaXMgaXMgbWF5IGp1c3QgYmUgYSBwZXJjZW50YWdlIG9mIDEsCgkgKiBzaW5jZSBmaWxlIHNpemVzIGNhbiBub3QgYmUgZGV0ZXJtaW5lZCBiZWZvcmUgYSBsb2FkIGlzIGtpY2tlZCBvZmYsIGlmIGF0IGFsbC4KCSAqIEBwYXJhbSB7TnVtYmVyfSB0b3RhbCBUaGUgdG90YWwgbnVtYmVyIG9mIGJ5dGVzLiBOb3RlIHRoYXQgdGhpcyBtYXkganVzdCBiZSAxLgoJICogQHBhcmFtIHtOdW1iZXJ9IHByb2dyZXNzIFRoZSByYXRpbyB0aGF0IGhhcyBiZWVuIGxvYWRlZCBiZXR3ZWVuIDAgYW5kIDEuCgkgKiBAc2luY2UgMC4zLjAKCSAqLwoKCS8qKgoJICogVGhlIGV2ZW50IHRoYXQgaXMgZmlyZWQgd2hlbiBhIGxvYWQgc3RhcnRzLgoJICogQGV2ZW50IGxvYWRzdGFydAoJICogQHBhcmFtIHtPYmplY3R9IHRhcmdldCBUaGUgb2JqZWN0IHRoYXQgZGlzcGF0Y2hlZCB0aGUgZXZlbnQuCgkgKiBAcGFyYW0ge1N0cmluZ30gdHlwZSBUaGUgZXZlbnQgdHlwZS4KCSAqIEBzaW5jZSAwLjMuMQoJICovCgoJLyoqCgkgKiBUaGUgZXZlbnQgdGhhdCBpcyBmaXJlZCB3aGVuIHRoZSBlbnRpcmUgcXVldWUgaGFzIGJlZW4gbG9hZGVkLgoJICogQGV2ZW50IGNvbXBsZXRlCgkgKiBAcGFyYW0ge09iamVjdH0gdGFyZ2V0IFRoZSBvYmplY3QgdGhhdCBkaXNwYXRjaGVkIHRoZSBldmVudC4KCSAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlIFRoZSBldmVudCB0eXBlLgoJICogQHNpbmNlIDAuMy4wCgkgKi8KCgkvKioKCSAqIFRoZSBldmVudCB0aGF0IGlzIGZpcmVkIHdoZW4gdGhlIGxvYWRlciBlbmNvdW50ZXJzIGFuIGVycm9yLiBJZiB0aGUgZXJyb3Igd2FzIGVuY291bnRlcmVkIGJ5IGEgZmlsZSwgdGhlIGV2ZW50IHdpbGwKCSAqIGNvbnRhaW4gdGhlIGl0ZW0gdGhhdCBjYXVzZWQgdGhlIGVycm9yLiBUaGVyZSBtYXkgYmUgYWRkaXRpb25hbCBwcm9wZXJ0aWVzIHN1Y2ggYXMgdGhlIGVycm9yIHJlYXNvbiBvbiBldmVudAoJICogb2JqZWN0cy4KCSAqIEBldmVudCBlcnJvcgoJICogQHBhcmFtIHtPYmplY3R9IHRhcmdldCBUaGUgb2JqZWN0IHRoYXQgZGlzcGF0Y2hlZCB0aGUgZXZlbnQuCgkgKiBAcGFyYW0ge1N0cmluZ30gdHlwZSBUaGUgZXZlbnQgdHlwZS4KCSAqIEBwYXJhbSB7T2JqZWN0fSBbaXRlbV0gVGhlIGl0ZW0gdGhhdCB3YXMgYmVpbmcgbG9hZGVkIHRoYXQgY2F1c2VkIHRoZSBlcnJvci4gVGhlIGl0ZW0gd2FzIHNwZWNpZmllZCBpbgoJICogdGhlIHt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlL2xvYWRGaWxlIn19e3svY3Jvc3NMaW5rfX0gb3Ige3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvbG9hZE1hbmlmZXN0In19e3svY3Jvc3NMaW5rfX0KCSAqIGNhbGwuIElmIG9ubHkgYSBzdHJpbmcgcGF0aCBvciB0YWcgd2FzIHNwZWNpZmllZCwgdGhlIG9iamVjdCB3aWxsIGNvbnRhaW4gdGhhdCB2YWx1ZSBhcyBhIGBzcmNgIHByb3BlcnR5LgoJICogQHBhcmFtIHtTdHJpbmd9IFtlcnJvcl0gVGhlIGVycm9yIG9iamVjdCBvciB0ZXh0LgoJICogQHNpbmNlIDAuMy4wCgkgKi8KCgkvL1RPRE86IERlcHJlY2F0ZWQKCS8qKgoJICogUkVNT1ZFRC4gVXNlIHt7I2Nyb3NzTGluayAiRXZlbnREaXNwYXRjaGVyL2FkZEV2ZW50TGlzdGVuZXIifX17ey9jcm9zc0xpbmt9fSBhbmQgdGhlIHt7I2Nyb3NzTGluayAiQWJzdHJhY3RMb2FkZXIvcHJvZ3Jlc3M6ZXZlbnQifX17ey9jcm9zc0xpbmt9fQoJICogZXZlbnQuCgkgKiBAcHJvcGVydHkgb25Qcm9ncmVzcwoJICogQHR5cGUge0Z1bmN0aW9ufQoJICogQGRlcHJlY2F0ZWQgVXNlIGFkZEV2ZW50TGlzdGVuZXIgYW5kIHRoZSAicHJvZ3Jlc3MiIGV2ZW50LgoJICovCgkvKioKCSAqIFJFTU9WRUQuIFVzZSB7eyNjcm9zc0xpbmsgIkV2ZW50RGlzcGF0Y2hlci9hZGRFdmVudExpc3RlbmVyIn19e3svY3Jvc3NMaW5rfX0gYW5kIHRoZSB7eyNjcm9zc0xpbmsgIkFic3RyYWN0TG9hZGVyL2xvYWRzdGFydDpldmVudCJ9fXt7L2Nyb3NzTGlua319CgkgKiBldmVudC4KCSAqIEBwcm9wZXJ0eSBvbkxvYWRTdGFydAoJICogQHR5cGUge0Z1bmN0aW9ufQoJICogQGRlcHJlY2F0ZWQgVXNlIGFkZEV2ZW50TGlzdGVuZXIgYW5kIHRoZSAibG9hZHN0YXJ0IiBldmVudC4KCSAqLwoJLyoqCgkgKiBSRU1PVkVELiBVc2Uge3sjY3Jvc3NMaW5rICJFdmVudERpc3BhdGNoZXIvYWRkRXZlbnRMaXN0ZW5lciJ9fXt7L2Nyb3NzTGlua319IGFuZCB0aGUge3sjY3Jvc3NMaW5rICJBYnN0cmFjdExvYWRlci9jb21wbGV0ZTpldmVudCJ9fXt7L2Nyb3NzTGlua319CgkgKiBldmVudC4KCSAqIEBwcm9wZXJ0eSBvbkNvbXBsZXRlCgkgKiBAdHlwZSB7RnVuY3Rpb259CgkgKiBAZGVwcmVjYXRlZCBVc2UgYWRkRXZlbnRMaXN0ZW5lciBhbmQgdGhlICJjb21wbGV0ZSIgZXZlbnQuCgkgKi8KCS8qKgoJICogUkVNT1ZFRC4gVXNlIHt7I2Nyb3NzTGluayAiRXZlbnREaXNwYXRjaGVyL2FkZEV2ZW50TGlzdGVuZXIifX17ey9jcm9zc0xpbmt9fSBhbmQgdGhlIHt7I2Nyb3NzTGluayAiQWJzdHJhY3RMb2FkZXIvZXJyb3I6ZXZlbnQifX17ey9jcm9zc0xpbmt9fQoJICogZXZlbnQuCgkgKiBAcHJvcGVydHkgb25FcnJvcgoJICogQHR5cGUge0Z1bmN0aW9ufQoJICogQGRlcHJlY2F0ZWQgVXNlIGFkZEV2ZW50TGlzdGVuZXIgYW5kIHRoZSAiZXJyb3IiIGV2ZW50LgoJICovCgoJLyoqCgkgKiBHZXQgYSByZWZlcmVuY2UgdG8gdGhlIG1hbmlmZXN0IGl0ZW0gdGhhdCBpcyBsb2FkZWQgYnkgdGhpcyBsb2FkZXIuIEluIG1vc3QgY2FzZXMgdGhpcyB3aWxsIGJlIHRoZSB2YWx1ZSB0aGF0IHdhcwoJICogcGFzc2VkIGludG8ge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUifX17ey9jcm9zc0xpbmt9fSB1c2luZyB7eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZS9sb2FkRmlsZSJ9fXt7L2Nyb3NzTGlua319IG9yCgkgKiB7eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZS9sb2FkTWFuaWZlc3QifX17ey9jcm9zc0xpbmt9fS4gSG93ZXZlciBpZiBvbmx5IGEgU3RyaW5nIHBhdGggd2FzIHBhc3NlZCBpbiwgdGhlbiBpdCB3aWxsCgkgKiBiZSBhbiBPYmplY3QgY3JlYXRlZCBieSB0aGUgTG9hZFF1ZXVlLgoJICogQHJldHVybiB7T2JqZWN0fSBUaGUgbWFuaWZlc3QgaXRlbSB0aGF0IHRoaXMgbG9hZGVyIGlzIHJlc3BvbnNpYmxlIGZvciBsb2FkaW5nLgoJICovCglwLmdldEl0ZW0gPSBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5faXRlbTsKCX07CgoJLyoqCgkgKiBJbml0aWFsaXplIHRoZSBsb2FkZXIuIFRoaXMgaXMgY2FsbGVkIGJ5IHRoZSBjb25zdHJ1Y3Rvci4KCSAqIEBtZXRob2QgaW5pdAoJICogQHByaXZhdGUKCSAqLwoJcC5pbml0ID0gZnVuY3Rpb24gKCkge307CgoJLyoqCgkgKiBCZWdpbiBsb2FkaW5nIHRoZSBxdWV1ZWQgaXRlbXMuIFRoaXMgbWV0aG9kIGNhbiBiZSBjYWxsZWQgd2hlbiBhIHt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlIn19e3svY3Jvc3NMaW5rfX0gaXMgc2V0CgkgKiB1cCBidXQgbm90IHN0YXJ0ZWQgaW1tZWRpYXRlbHkuCgkgKiBAZXhhbXBsZQoJICogICAgICB2YXIgcXVldWUgPSBuZXcgY3JlYXRlanMuTG9hZFF1ZXVlKCk7CgkgKiAgICAgIHF1ZXVlLmFkZEV2ZW50TGlzdGVuZXIoImNvbXBsZXRlIiwgaGFuZGxlQ29tcGxldGUpOwoJICogICAgICBxdWV1ZS5sb2FkTWFuaWZlc3QoZmlsZUFycmF5LCBmYWxzZSk7IC8vIE5vdGUgdGhlIDJuZCBhcmd1bWVudCB0aGF0IHRlbGxzIHRoZSBxdWV1ZSBub3QgdG8gc3RhcnQgbG9hZGluZyB5ZXQKCSAqICAgICAgcXVldWUubG9hZCgpOwoJICogQG1ldGhvZCBsb2FkCgkgKi8KCXAubG9hZCA9IGZ1bmN0aW9uKCkge307CgoJLyoqCgkgKiBDbG9zZSB0aGUgYWN0aXZlIHF1ZXVlLiBDbG9zaW5nIGEgcXVldWUgY29tcGxldGVseSBlbXB0aWVzIHRoZSBxdWV1ZSwgYW5kIHByZXZlbnRzIGFueSByZW1haW5pbmcgaXRlbXMgZnJvbQoJICogc3RhcnRpbmcgdG8gZG93bmxvYWQuIE5vdGUgdGhhdCBjdXJyZW50bHkgYW55IGFjdGl2ZSBsb2FkcyB3aWxsIHJlbWFpbiBvcGVuLCBhbmQgZXZlbnRzIG1heSBiZSBwcm9jZXNzZWQuCgkgKgoJICogVG8gc3RvcCBhbmQgcmVzdGFydCBhIHF1ZXVlLCB1c2UgdGhlIHt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlL3NldFBhdXNlZCJ9fXt7L2Nyb3NzTGlua319IG1ldGhvZCBpbnN0ZWFkLgoJICogQG1ldGhvZCBjbG9zZQoJICovCglwLmNsb3NlID0gZnVuY3Rpb24oKSB7fTsKCgovL0NhbGxiYWNrIHByb3hpZXMKCS8qKgoJICogRGlzcGF0Y2ggYSBsb2Fkc3RhcnQgZXZlbnQuIFBsZWFzZSBzZWUgdGhlIHt7I2Nyb3NzTGluayAiQWJzdHJhY3RMb2FkZXIvbG9hZHN0YXJ0OmV2ZW50In19e3svY3Jvc3NMaW5rfX0gZXZlbnQKCSAqIGZvciBkZXRhaWxzIG9uIHRoZSBldmVudCBwYXlsb2FkLgoJICogQG1ldGhvZCBfc2VuZExvYWRTdGFydAoJICogQHByb3RlY3RlZAoJICovCglwLl9zZW5kTG9hZFN0YXJ0ID0gZnVuY3Rpb24oKSB7CgkJaWYgKHRoaXMuX2lzQ2FuY2VsZWQoKSkgeyByZXR1cm47IH0KCQl0aGlzLmRpc3BhdGNoRXZlbnQoImxvYWRzdGFydCIpOwoJfTsKCgkvKioKCSAqIERpc3BhdGNoIGEgcHJvZ3Jlc3MgZXZlbnQuIFBsZWFzZSBzZWUgdGhlIHt7I2Nyb3NzTGluayAiQWJzdHJhY3RMb2FkZXIvcHJvZ3Jlc3M6ZXZlbnQifX17ey9jcm9zc0xpbmt9fSBldmVudCBmb3IKCSAqIGRldGFpbHMgb24gdGhlIGV2ZW50IHBheWxvYWQuCgkgKiBAbWV0aG9kIF9zZW5kUHJvZ3Jlc3MKCSAqIEBwYXJhbSB7TnVtYmVyIHwgT2JqZWN0fSB2YWx1ZSBUaGUgcHJvZ3Jlc3Mgb2YgdGhlIGxvYWRlZCBpdGVtLCBvciBhbiBvYmplY3QgY29udGFpbmluZyA8Y29kZT5sb2FkZWQ8L2NvZGU+CgkgKiBhbmQgPGNvZGU+dG90YWw8L2NvZGU+IHByb3BlcnRpZXMuCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXAuX3NlbmRQcm9ncmVzcyA9IGZ1bmN0aW9uKHZhbHVlKSB7CgkJaWYgKHRoaXMuX2lzQ2FuY2VsZWQoKSkgeyByZXR1cm47IH0KCQl2YXIgZXZlbnQgPSBudWxsOwoJCWlmICh0eXBlb2YodmFsdWUpID09ICJudW1iZXIiKSB7CgkJCXRoaXMucHJvZ3Jlc3MgPSB2YWx1ZTsKCQkJZXZlbnQgPSBuZXcgY3JlYXRlanMuRXZlbnQoInByb2dyZXNzIik7CgkJCWV2ZW50LmxvYWRlZCA9IHRoaXMucHJvZ3Jlc3M7CgkJCWV2ZW50LnRvdGFsID0gMTsKCQl9IGVsc2UgewoJCQlldmVudCA9IHZhbHVlOwoJCQl0aGlzLnByb2dyZXNzID0gdmFsdWUubG9hZGVkIC8gdmFsdWUudG90YWw7CgkJCWlmIChpc05hTih0aGlzLnByb2dyZXNzKSB8fCB0aGlzLnByb2dyZXNzID09IEluZmluaXR5KSB7IHRoaXMucHJvZ3Jlc3MgPSAwOyB9CgkJfQoJCWV2ZW50LnByb2dyZXNzID0gdGhpcy5wcm9ncmVzczsKCQl0aGlzLmhhc0V2ZW50TGlzdGVuZXIoInByb2dyZXNzIikgJiYgdGhpcy5kaXNwYXRjaEV2ZW50KGV2ZW50KTsKCX07CgoJLyoqCgkgKiBEaXNwYXRjaCBhIGNvbXBsZXRlIGV2ZW50LiBQbGVhc2Ugc2VlIHRoZSB7eyNjcm9zc0xpbmsgIkFic3RyYWN0TG9hZGVyL2NvbXBsZXRlOmV2ZW50In19e3svY3Jvc3NMaW5rfX0gZXZlbnQKCSAqIGZvciBkZXRhaWxzIG9uIHRoZSBldmVudCBwYXlsb2FkLgoJICogQG1ldGhvZCBfc2VuZENvbXBsZXRlCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXAuX3NlbmRDb21wbGV0ZSA9IGZ1bmN0aW9uKCkgewoJCWlmICh0aGlzLl9pc0NhbmNlbGVkKCkpIHsgcmV0dXJuOyB9CgkJdGhpcy5kaXNwYXRjaEV2ZW50KCJjb21wbGV0ZSIpOwoJfTsKCgkvKioKCSAqIERpc3BhdGNoIGFuIGVycm9yIGV2ZW50LiBQbGVhc2Ugc2VlIHRoZSB7eyNjcm9zc0xpbmsgIkFic3RyYWN0TG9hZGVyL2Vycm9yOmV2ZW50In19e3svY3Jvc3NMaW5rfX0gZXZlbnQgZm9yCgkgKiBkZXRhaWxzIG9uIHRoZSBldmVudCBwYXlsb2FkLgoJICogQG1ldGhvZCBfc2VuZEVycm9yCgkgKiBAcGFyYW0ge09iamVjdH0gZXZlbnQgVGhlIGV2ZW50IG9iamVjdCBjb250YWluaW5nIHNwZWNpZmljIGVycm9yIHByb3BlcnRpZXMuCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXAuX3NlbmRFcnJvciA9IGZ1bmN0aW9uKGV2ZW50KSB7CgkJaWYgKHRoaXMuX2lzQ2FuY2VsZWQoKSB8fCAhdGhpcy5oYXNFdmVudExpc3RlbmVyKCJlcnJvciIpKSB7IHJldHVybjsgfQoJCWlmIChldmVudCA9PSBudWxsKSB7CgkJCWV2ZW50ID0gbmV3IGNyZWF0ZWpzLkV2ZW50KCJlcnJvciIpOwoJCX0KCQl0aGlzLmRpc3BhdGNoRXZlbnQoZXZlbnQpOwoJfTsKCgkvKioKCSAqIERldGVybWluZSBpZiB0aGUgbG9hZCBoYXMgYmVlbiBjYW5jZWxlZC4gVGhpcyBpcyBpbXBvcnRhbnQgdG8gZW5zdXJlIHRoYXQgbWV0aG9kIGNhbGxzIG9yIGFzeW5jaHJvbm91cyBldmVudHMKCSAqIGRvIG5vdCBjYXVzZSBpc3N1ZXMgYWZ0ZXIgdGhlIHF1ZXVlIGhhcyBiZWVuIGNsZWFuZWQgdXAuCgkgKiBAbWV0aG9kIF9pc0NhbmNlbGVkCgkgKiBAcmV0dXJuIHtCb29sZWFufSBJZiB0aGUgbG9hZGVyIGhhcyBiZWVuIGNhbmNlbGVkLgoJICogQHByb3RlY3RlZAoJICovCglwLl9pc0NhbmNlbGVkID0gZnVuY3Rpb24oKSB7CgkJaWYgKHdpbmRvdy5jcmVhdGVqcyA9PSBudWxsIHx8IHRoaXMuY2FuY2VsZWQpIHsKCQkJcmV0dXJuIHRydWU7CgkJfQoJCXJldHVybiBmYWxzZTsKCX07CgoJLyoqCgkgKiBQYXJzZSBhIGZpbGUgVVJJIHVzaW5nIHRoZSB7eyNjcm9zc0xpbmsgIkFic3RyYWN0TG9hZGVyL0ZJTEVfUEFUVEVSTjpwcm9wZXJ0eSJ9fXt7L2Nyb3NzTGlua319IFJlZ0V4cCBwYXR0ZXJuLgoJICogQG1ldGhvZCBfcGFyc2VVUkkKCSAqIEBwYXJhbSB7U3RyaW5nfSBwYXRoIFRoZSBmaWxlIHBhdGggdG8gcGFyc2UuCgkgKiBAcmV0dXJuIHtBcnJheX0gVGhlIG1hdGNoZWQgZmlsZSBjb250ZW50cy4gUGxlYXNlIHNlZSB0aGUgRklMRV9QQVRURVJOIHByb3BlcnR5IGZvciBkZXRhaWxzIG9uIHRoZSByZXR1cm4gdmFsdWUuCgkgKiBUaGlzIHdpbGwgcmV0dXJuIG51bGwgaWYgaXQgZG9lcyBub3QgbWF0Y2guCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXAuX3BhcnNlVVJJID0gZnVuY3Rpb24ocGF0aCkgewoJCWlmICghcGF0aCkgeyByZXR1cm4gbnVsbDsgfQoJCXJldHVybiBwYXRoLm1hdGNoKHMuRklMRV9QQVRURVJOKTsKCX07CgoJLyoqCgkgKiBQYXJzZSBhIGZpbGUgVVJJIHVzaW5nIHRoZSB7eyNjcm9zc0xpbmsgIkFic3RyYWN0TG9hZGVyL1BBVEhfUEFUVEVSTiJ9fXt7L2Nyb3NzTGlua319IFJlZ0V4cCBwYXR0ZXJuLgoJICogQG1ldGhvZCBfcGFyc2VQYXRoCgkgKiBAcGFyYW0ge1N0cmluZ30gcGF0aCBUaGUgZmlsZSBwYXRoIHRvIHBhcnNlLgoJICogQHJldHVybiB7QXJyYXl9IFRoZSBtYXRjaGVkIHBhdGggY29udGVudHMuIFBsZWFzZSBzZWUgdGhlIFBBVEhfUEFUVEVSTiBwcm9wZXJ0eSBmb3IgZGV0YWlscyBvbiB0aGUgcmV0dXJuIHZhbHVlLgoJICogVGhpcyB3aWxsIHJldHVybiBudWxsIGlmIGl0IGRvZXMgbm90IG1hdGNoLgoJICogQHByb3RlY3RlZAoJICovCglwLl9wYXJzZVBhdGggPSBmdW5jdGlvbihwYXRoKSB7CgkJaWYgKCFwYXRoKSB7IHJldHVybiBudWxsOyB9CgkJcmV0dXJuIHBhdGgubWF0Y2gocy5QQVRIX1BBVFRFUk4pOwoJfTsKCgkvKioKCSAqIEZvcm1hdHMgYW4gb2JqZWN0IGludG8gYSBxdWVyeSBzdHJpbmcgZm9yIGVpdGhlciBhIFBPU1Qgb3IgR0VUIHJlcXVlc3QuCgkgKiBAbWV0aG9kIF9mb3JtYXRRdWVyeVN0cmluZwoJICogQHBhcmFtIHtPYmplY3R9IGRhdGEgVGhlIGRhdGEgdG8gY29udmVydCB0byBhIHF1ZXJ5IHN0cmluZy4KCSAqIEBwYXJhbSB7QXJyYXl9IFtxdWVyeV0gRXhpc3RpbmcgbmFtZS92YWx1ZSBwYWlycyB0byBhcHBlbmQgb24gdG8gdGhpcyBxdWVyeS4KCSAqIEBwcml2YXRlCgkgKi8KCXAuX2Zvcm1hdFF1ZXJ5U3RyaW5nID0gZnVuY3Rpb24oZGF0YSwgcXVlcnkpIHsKCQlpZiAoZGF0YSA9PSBudWxsKSB7CgkJCXRocm93IG5ldyBFcnJvcignWW91IG11c3Qgc3BlY2lmeSBkYXRhLicpOwoJCX0KCQl2YXIgcGFyYW1zID0gW107CgkJZm9yICh2YXIgbiBpbiBkYXRhKSB7CgkJCXBhcmFtcy5wdXNoKG4rJz0nK2VzY2FwZShkYXRhW25dKSk7CgkJfQoJCWlmIChxdWVyeSkgewoJCQlwYXJhbXMgPSBwYXJhbXMuY29uY2F0KHF1ZXJ5KTsKCQl9CgkJcmV0dXJuIHBhcmFtcy5qb2luKCcmJyk7Cgl9OwoKCS8qKgoJICogQSB1dGlsaXR5IG1ldGhvZCB0aGF0IGJ1aWxkcyBhIGZpbGUgcGF0aCB1c2luZyBhIHNvdXJjZSBhbmQgYSBkYXRhIG9iamVjdCwgYW5kIGZvcm1hdHMgaXQgaW50byBhIG5ldyBwYXRoLiBBbGwKCSAqIG9mIHRoZSBsb2FkZXJzIGluIFByZWxvYWRKUyB1c2UgdGhpcyBtZXRob2QgdG8gY29tcGlsZSBwYXRocyB3aGVuIGxvYWRpbmcuCgkgKiBAbWV0aG9kIGJ1aWxkUGF0aAoJICogQHBhcmFtIHtTdHJpbmd9IHNyYyBUaGUgc291cmNlIHBhdGggdG8gYWRkIHZhbHVlcyB0by4KCSAqIEBwYXJhbSB7T2JqZWN0fSBbZGF0YV0gT2JqZWN0IHVzZWQgdG8gYXBwZW5kIHZhbHVlcyB0byB0aGlzIHJlcXVlc3QgYXMgYSBxdWVyeSBzdHJpbmcuIEV4aXN0aW5nIHBhcmFtZXRlcnMgb24gdGhlCgkgKiBwYXRoIHdpbGwgYmUgcHJlc2VydmVkLgoJICogQHJldHVybnMge3N0cmluZ30gQSBmb3JtYXR0ZWQgc3RyaW5nIHRoYXQgY29udGFpbnMgdGhlIHBhdGggYW5kIHRoZSBzdXBwbGllZCBwYXJhbWV0ZXJzLgoJICogQHNpbmNlIDAuMy4xCgkgKi8KCXAuYnVpbGRQYXRoID0gZnVuY3Rpb24oc3JjLCBkYXRhKSB7CgkJaWYgKGRhdGEgPT0gbnVsbCkgewoJCQlyZXR1cm4gc3JjOwoJCX0KCgkJdmFyIHF1ZXJ5ID0gW107CgkJdmFyIGlkeCA9IHNyYy5pbmRleE9mKCc/Jyk7CgoJCWlmIChpZHggIT0gLTEpIHsKCQkJdmFyIHEgPSBzcmMuc2xpY2UoaWR4KzEpOwoJCQlxdWVyeSA9IHF1ZXJ5LmNvbmNhdChxLnNwbGl0KCcmJykpOwoJCX0KCgkJaWYgKGlkeCAhPSAtMSkgewoJCQlyZXR1cm4gc3JjLnNsaWNlKDAsIGlkeCkgKyAnPycgKyB0aGlzLl9mb3JtYXRRdWVyeVN0cmluZyhkYXRhLCBxdWVyeSk7CgkJfSBlbHNlIHsKCQkJcmV0dXJuIHNyYyArICc/JyArIHRoaXMuX2Zvcm1hdFF1ZXJ5U3RyaW5nKGRhdGEsIHF1ZXJ5KTsKCQl9Cgl9OwoKCS8qKgoJICogQG1ldGhvZCBfaXNDcm9zc0RvbWFpbgoJICogQHBhcmFtIHtPYmplY3R9IGl0ZW0gQSBsb2FkIGl0ZW0gd2l0aCBhIGBzcmNgIHByb3BlcnR5CgkgKiBAcmV0dXJuIHtCb29sZWFufSBJZiB0aGUgbG9hZCBpdGVtIGlzIGxvYWRpbmcgZnJvbSBhIGRpZmZlcmVudCBkb21haW4gdGhhbiB0aGUgY3VycmVudCBsb2NhdGlvbi4KCSAqIEBwcml2YXRlCgkgKi8KCXAuX2lzQ3Jvc3NEb21haW4gPSBmdW5jdGlvbihpdGVtKSB7CgkJdmFyIHRhcmdldCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImEiKTsKCQl0YXJnZXQuaHJlZiA9IGl0ZW0uc3JjOwoKCQl2YXIgaG9zdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImEiKTsKCQlob3N0LmhyZWYgPSBsb2NhdGlvbi5ocmVmOwoKCQl2YXIgY3Jvc3Nkb21haW4gPSAodGFyZ2V0Lmhvc3RuYW1lICE9ICIiKSAmJgoJCQkJKHRhcmdldC5wb3J0ICE9IGhvc3QucG9ydCB8fAoJCQkJCQl0YXJnZXQucHJvdG9jb2wgIT0gaG9zdC5wcm90b2NvbCB8fAoJCQkJCQl0YXJnZXQuaG9zdG5hbWUgIT0gaG9zdC5ob3N0bmFtZSk7CgkJcmV0dXJuIGNyb3NzZG9tYWluOwoJfQoKCS8qKgoJICogQG1ldGhvZCBfaXNMb2NhbAoJICogQHBhcmFtIHtPYmplY3R9IGl0ZW0gQSBsb2FkIGl0ZW0gd2l0aCBhIGBzcmNgIHByb3BlcnR5CgkgKiBAcmV0dXJuIHtCb29sZWFufSBJZiB0aGUgbG9hZCBpdGVtIGlzIGxvYWRpbmcgZnJvbSB0aGUgImZpbGU6IiBwcm90b2NvbC4gQXNzdW1lIHRoYXQgdGhlIGhvc3QgbXVzdCBiZSBsb2NhbCBhcwoJICogd2VsbC4KCSAqIEBwcml2YXRlCgkgKi8KCXAuX2lzTG9jYWwgPSBmdW5jdGlvbihpdGVtKSB7CgkJdmFyIHRhcmdldCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImEiKTsKCQl0YXJnZXQuaHJlZiA9IGl0ZW0uc3JjOwoJCXJldHVybiB0YXJnZXQuaG9zdG5hbWUgPT0gIiIgJiYgdGFyZ2V0LnByb3RvY29sID09ICJmaWxlOiI7Cgl9OwoKCS8qKgoJICogQG1ldGhvZCB0b1N0cmluZwoJICogQHJldHVybiB7U3RyaW5nfSBhIHN0cmluZyByZXByZXNlbnRhdGlvbiBvZiB0aGUgaW5zdGFuY2UuCgkgKi8KCXAudG9TdHJpbmcgPSBmdW5jdGlvbigpIHsKCQlyZXR1cm4gIltQcmVsb2FkSlMgQWJzdHJhY3RMb2FkZXJdIjsKCX07CgoJY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIgPSBBYnN0cmFjdExvYWRlcjsKCn0oKSk7Ci8qCiogTG9hZFF1ZXVlCiogVmlzaXQgaHR0cDovL2NyZWF0ZWpzLmNvbS8gZm9yIGRvY3VtZW50YXRpb24sIHVwZGF0ZXMgYW5kIGV4YW1wbGVzLgoqCioKKiBDb3B5cmlnaHQgKGMpIDIwMTIgZ3NraW5uZXIuY29tLCBpbmMuCioKKiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbgoqIG9idGFpbmluZyBhIGNvcHkgb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uCiogZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8gZGVhbCBpbiB0aGUgU29mdHdhcmUgd2l0aG91dAoqIHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMgdG8gdXNlLAoqIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsCiogY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlCiogU29mdHdhcmUgaXMgZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcKKiBjb25kaXRpb25zOgoqCiogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUKKiBpbmNsdWRlZCBpbiBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KKgoqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELAoqIEVYUFJFU1MgT1IgSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUwoqIE9GIE1FUkNIQU5UQUJJTElUWSwgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5ECiogTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SUyBPUiBDT1BZUklHSFQKKiBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSIExJQUJJTElUWSwKKiBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcKKiBGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SCiogT1RIRVIgREVBTElOR1MgSU4gVEhFIFNPRlRXQVJFLgoqLwovKioKICogUHJlbG9hZEpTIHByb3ZpZGVzIGEgY29uc2lzdGVudCB3YXkgdG8gcHJlbG9hZCBjb250ZW50IGZvciB1c2UgaW4gSFRNTCBhcHBsaWNhdGlvbnMuIFByZWxvYWRpbmcgY2FuIGJlIGRvbmUgdXNpbmcKICogSFRNTCB0YWdzLCBhcyB3ZWxsIGFzIFhIUi4KICoKICogQnkgZGVmYXVsdCwgUHJlbG9hZEpTIHdpbGwgdHJ5IGFuZCBsb2FkIGNvbnRlbnQgdXNpbmcgWEhSLCBzaW5jZSBpdCBwcm92aWRlcyBiZXR0ZXIgc3VwcG9ydCBmb3IgcHJvZ3Jlc3MgYW5kCiAqIGNvbXBsZXRpb24gZXZlbnRzLCA8Yj5ob3dldmVyIGR1ZSB0byBjcm9zcy1kb21haW4gaXNzdWVzLCBpdCBtYXkgc3RpbGwgYmUgcHJlZmVyYWJsZSB0byB1c2UgdGFnLWJhc2VkIGxvYWRpbmcKICogaW5zdGVhZDwvYj4uIE5vdGUgdGhhdCBzb21lIGNvbnRlbnQgcmVxdWlyZXMgWEhSIHRvIHdvcmsgKHBsYWluIHRleHQsIHdlYiBhdWRpbyksIGFuZCBzb21lIHJlcXVpcmVzIHRhZ3MgKEhUTUwgYXVkaW8pLgogKiBOb3RlIHRoaXMgaXMgaGFuZGxlZCBhdXRvbWF0aWNhbGx5IHdoZXJlIHBvc3NpYmxlLgogKgogKiBQcmVsb2FkSlMgY3VycmVudGx5IHN1cHBvcnRzIGFsbCBtb2Rlcm4gYnJvd3NlcnMsIGFuZCB3ZSBoYXZlIGRvbmUgb3VyIGJlc3QgdG8gaW5jbHVkZSBzdXBwb3J0IGZvciBtb3N0IG9sZGVyCiAqIGJyb3dzZXJzLiBJZiB5b3UgZmluZCBhbiBpc3N1ZSB3aXRoIGFueSBzcGVjaWZpYyBPUy9icm93c2VyIGNvbWJpbmF0aW9uLCBwbGVhc2UgdmlzaXQgaHR0cDovL2NvbW11bml0eS5jcmVhdGVqcy5jb20vCiAqIGFuZCByZXBvcnQgaXQuCiAqCiAqIDxoND5HZXR0aW5nIFN0YXJ0ZWQ8L2g0PgogKiBUbyBnZXQgc3RhcnRlZCwgY2hlY2sgb3V0IHRoZSB7eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZSJ9fXt7L2Nyb3NzTGlua319IGNsYXNzLCB3aGljaCBpbmNsdWRlcyBhIHF1aWNrIG92ZXJ2aWV3IG9mIGhvdwogKiB0byBsb2FkIGZpbGVzIGFuZCBwcm9jZXNzIHJlc3VsdHMuCiAqCiAqIDxoND5FeGFtcGxlPC9oND4KICoKICogICAgICB2YXIgcXVldWUgPSBuZXcgY3JlYXRlanMuTG9hZFF1ZXVlKCk7CiAqICAgICAgcXVldWUuaW5zdGFsbFBsdWdpbihjcmVhdGVqcy5Tb3VuZCk7CiAqICAgICAgcXVldWUub24oImNvbXBsZXRlIiwgaGFuZGxlQ29tcGxldGUsIHRoaXMpOwogKiAgICAgIHF1ZXVlLmxvYWRGaWxlKHtpZDoic291bmQiLCBzcmM6Imh0dHA6Ly9wYXRoL3RvL3NvdW5kLm1wMyJ9KTsKICogICAgICBxdWV1ZS5sb2FkTWFuaWZlc3QoWwogKiAgICAgICAgICB7aWQ6ICJteUltYWdlIiwgc3JjOiJwYXRoL3RvL215SW1hZ2UuanBnIn0KICogICAgICBdKTsKICogICAgICBmdW5jdGlvbiBoYW5kbGVDb21wbGV0ZSgpIHsKICogICAgICAgICAgY3JlYXRlanMuU291bmQucGxheSgic291bmQiKTsKICogICAgICAgICAgdmFyIGltYWdlID0gcXVldWUuZ2V0UmVzdWx0KCJteUltYWdlIik7CiAqICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoaW1hZ2UpOwogKiAgICAgIH0KICoKICogPGI+SW1wb3J0YW50IG5vdGUgb24gcGx1Z2luczo8L2I+IFBsdWdpbnMgbXVzdCBiZSBpbnN0YWxsZWQgPGk+YmVmb3JlPC9pPiBpdGVtcyBhcmUgYWRkZWQgdG8gdGhlIHF1ZXVlLCBvdGhlcndpc2UKICogdGhleSB3aWxsIG5vdCBiZSBwcm9jZXNzZWQsIGV2ZW4gaWYgdGhlIGxvYWQgaGFzIG5vdCBhY3R1YWxseSBraWNrZWQgb2ZmIHlldC4gUGx1Z2luIGZ1bmN0aW9uYWxpdHkgaXMgaGFuZGxlZCB3aGVuCiAqIHRoZSBpdGVtcyBhcmUgYWRkZWQgdG8gdGhlIExvYWRRdWV1ZS4KICoKICogPGg0PkJyb3dzZXIgU3VwcG9ydDwvaDQ+CiAqIFByZWxvYWRKUyBpcyBwYXJ0aWFsbHkgc3VwcG9ydGVkIGluIGFsbCBicm93c2VycywgYW5kIGZ1bGx5IHN1cHBvcnRlZCBpbiBhbGwgbW9kZXJuIGJyb3dzZXJzLiBLbm93biBleGNlcHRpb25zOgogKiA8dWw+PGxpPlhIUiBsb2FkaW5nIG9mIGFueSBjb250ZW50IHdpbGwgbm90IHdvcmsgaW4gbWFueSBvbGRlciBicm93c2VycyAoU2VlIGEgbWF0cml4IGhlcmU6IDxhIGhyZWY9Imh0dHA6Ly9jYW5pdXNlLmNvbS94aHIyIiB0YXJnZXQ9Il9ibGFuayI+aHR0cDovL2Nhbml1c2UuY29tL3hocjI8L2E+KS4KICogICAgICBJbiBtYW55IGNhc2VzLCB5b3UgY2FuIGZhbGwgYmFjayBvbiB0YWcgbG9hZGluZyAoaW1hZ2VzLCBhdWRpbywgQ1NTLCBzY3JpcHRzLCBTVkcsIGFuZCBKU09OUCkuIFRleHQgYW5kCiAqICAgICAgV2ViQXVkaW8gd2lsbCBvbmx5IHdvcmsgd2l0aCBYSFIuPC9saT4KICogICAgICA8bGk+U29tZSBmb3JtYXRzIGhhdmUgcG9vciBzdXBwb3J0IGZvciBjb21wbGV0ZSBldmVudHMgaW4gSUUgNiwgNywgYW5kIDggKFNWRywgdGFnIGxvYWRpbmcgb2Ygc2NyaXB0cywgWE1ML0pTT04pPC9saT4KICogICAgICA8bGk+T3BlcmEgaGFzIHBvb3Igc3VwcG9ydCBmb3IgU1ZHIGxvYWRpbmcgd2l0aCBYSFI8L2xpPgogKiAgICAgIDxsaT5DU1MgbG9hZGluZyBpbiBBbmRyb2lkIGFuZCBTYWZhcmkgd2lsbCBub3Qgd29yayB3aXRoIHRhZ3MgKGN1cnJlbnRseSwgYSB3b3JrYXJvdW5kIGlzIGluIHByb2dyZXNzKTwvbGk+CiAqICAgICAgPGxpPkxvY2FsIGxvYWRpbmcgaXMgbm90IHBlcm1pdHRlZCB3aXRoIFhIUiwgd2hpY2ggaXMgcmVxdWlyZWQgYnkgc29tZSBmaWxlIGZvcm1hdHMuIFdoZW4gdGVzdGluZyBsb2NhbCBjb250ZW50CiAqICAgICAgdXNlIGVpdGhlciBhIGxvY2FsIHNlcnZlciwgb3IgZW5hYmxlIHRhZyBsb2FkaW5nLCB3aGljaCBpcyBzdXBwb3J0ZWQgZm9yIG1vc3QgZm9ybWF0cy4gU2VlIHt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlL3NldFVzZVhIUiJ9fXt7L2Nyb3NzTGlua319CiAqICAgICAgZm9yIG1vcmUgaW5mb3JtYXRpb24uPC9saT4KICogPC91bD4KICoKICogPGg0PkNyb3NzLWRvbWFpbiBMb2FkaW5nPC9oND4KICogTW9zdCBjb250ZW50IHR5cGVzIGNhbiBiZSBsb2FkZWQgY3Jvc3MtZG9tYWluLCBhcyBsb25nIGFzIHRoZSBzZXJ2ZXIgc3VwcG9ydHMgQ09SUy4gUHJlbG9hZEpTIGFsc28gaGFzIGludGVybmFsCiAqIHN1cHBvcnQgZm9yIGltYWdlcyBzZXJ2ZWQgZnJvbSBhIENPUlMtZW5hYmxlZCBzZXJ2ZXIsIHZpYSB0aGUgYGNyb3NzT3JpZ2luYCBhcmd1bWVudCBvbiB0aGUge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUifX17ey9jcm9zc0xpbmt9fQogKiBjb25zdHJ1Y3Rvci4gSWYgc2V0IHRvIGEgc3RyaW5nIHZhbHVlIChzdWNoIGFzICJBbm9ueW1vdXMiKSwgdGhlICJjcm9zc09yaWdpbiIgcHJvcGVydHkgb2YgaW1hZ2VzIGdlbmVyYXRlZCBieQogKiBQcmVsb2FkSlMgaXMgc2V0IHRvIHRoYXQgdmFsdWUuIFBsZWFzZSBub3RlIHRoYXQgc2V0dGluZyBhIGBjcm9zc09yaWdpbmAgdmFsdWUgb24gYW4gaW1hZ2UgdGhhdCBpcyBzZXJ2ZWQgZnJvbSBhCiAqIHNlcnZlciB3aXRob3V0IENPUlMgd2lsbCBjYXVzZSBvdGhlciBlcnJvcnMuIEZvciBtb3JlIGluZm8gb24gQ09SUywgdmlzaXQgaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvQ3Jvc3Mtb3JpZ2luX3Jlc291cmNlX3NoYXJpbmcuCiAqCiAqIEBtb2R1bGUgUHJlbG9hZEpTCiAqIEBtYWluIFByZWxvYWRKUwogKi8KCi8vIG5hbWVzcGFjZToKdGhpcy5jcmVhdGVqcyA9IHRoaXMuY3JlYXRlanN8fHt9OwoKLyoKVE9ETzogV0lORE9XUyBJU1NVRVMKCSogTm8gZXJyb3IgZm9yIEhUTUwgYXVkaW8gaW4gSUUgNjc4CgkqIFNWRyBubyBmYWlsdXJlIGVycm9yIGluIElFIDY3IChtYXliZSA4KSBUQUdTIEFORCBYSFIKCSogTm8gc2NyaXB0IGNvbXBsZXRlIGhhbmRsZXIgaW4gSUUgNjcgVEFHUyAoWEhSIGlzIGZpbmUpCgkqIE5vIFhNTC9KU09OIGluIElFNiBUQUdTCgkqIE5lZWQgdG8gaGlkZSBsb2FkaW5nIFNWRyBpbiBPcGVyYSBUQUdTCgkqIE5vIENTUyBvbmxvYWQvcmVhZHlzdGF0ZWNoYW5nZSBpbiBTYWZhcmkgb3IgQW5kcm9pZCBUQUdTIChyZXF1aXJlcyBydWxlIGNoZWNraW5nKQoJKiBTVkcgbm8gbG9hZCBvciBmYWlsdXJlIGluIE9wZXJhIFhIUgoJKiBSZXBvcnRlZCBpc3N1ZXMgd2l0aCBJRTcvOAogKi8KCihmdW5jdGlvbigpIHsKCSJ1c2Ugc3RyaWN0IjsKCgkvKioKCSAqIFRoZSBMb2FkUXVldWUgY2xhc3MgaXMgdGhlIG1haW4gQVBJIGZvciBwcmVsb2FkaW5nIGNvbnRlbnQuIExvYWRRdWV1ZSBpcyBhIGxvYWQgbWFuYWdlciwgd2hpY2ggY2FuIHByZWxvYWQgZWl0aGVyCgkgKiBhIHNpbmdsZSBmaWxlLCBvciBxdWV1ZSBvZiBmaWxlcy4KCSAqCgkgKiA8Yj5DcmVhdGluZyBhIFF1ZXVlPC9iPjxiciAvPgoJICogVG8gdXNlIExvYWRRdWV1ZSwgY3JlYXRlIGEgTG9hZFF1ZXVlIGluc3RhbmNlLiBJZiB5b3Ugd2FudCB0byBmb3JjZSB0YWcgbG9hZGluZyB3aGVyZSBwb3NzaWJsZSwgc2V0IHRoZSB1c2VYSFIKCSAqIGFyZ3VtZW50IHRvIGZhbHNlLgoJICoKCSAqICAgICAgdmFyIHF1ZXVlID0gbmV3IGNyZWF0ZWpzLkxvYWRRdWV1ZSh0cnVlKTsKCSAqCgkgKiA8Yj5MaXN0ZW5pbmcgZm9yIEV2ZW50czwvYj48YnIgLz4KCSAqIEFkZCBhbnkgbGlzdGVuZXJzIHlvdSB3YW50IHRvIHRoZSBxdWV1ZS4gU2luY2UgUHJlbG9hZEpTIDAuMy4wLCB0aGUge3sjY3Jvc3NMaW5rICJFdmVudERpc3BhdGNoZXIifX17ey9jcm9zc0xpbmt9fQoJICogbGV0cyB5b3UgYWRkIGFzIG1hbnkgbGlzdGVuZXJzIGFzIHlvdSB3YW50IGZvciBldmVudHMuIFlvdSBjYW4gc3Vic2NyaWJlIHRvIHRoZSBmb2xsb3dpbmcgZXZlbnRzOjx1bD4KCSAqICAgICA8bGk+e3sjY3Jvc3NMaW5rICJBYnN0cmFjdExvYWRlci9jb21wbGV0ZTpldmVudCJ9fXt7L2Nyb3NzTGlua319OiBmaXJlZCB3aGVuIGEgcXVldWUgY29tcGxldGVzIGxvYWRpbmcgYWxsCgkgKiAgICAgZmlsZXM8L2xpPgoJICogICAgIDxsaT57eyNjcm9zc0xpbmsgIkFic3RyYWN0TG9hZGVyL2Vycm9yOmV2ZW50In19e3svY3Jvc3NMaW5rfX06IGZpcmVkIHdoZW4gdGhlIHF1ZXVlIGVuY291bnRlcnMgYW4gZXJyb3Igd2l0aAoJICogICAgIGFueSBmaWxlLjwvbGk+CgkgKiAgICAgPGxpPnt7I2Nyb3NzTGluayAiQWJzdHJhY3RMb2FkZXIvcHJvZ3Jlc3M6ZXZlbnQifX17ey9jcm9zc0xpbmt9fTogUHJvZ3Jlc3MgZm9yIHRoZSBlbnRpcmUgcXVldWUgaGFzCgkgKiAgICAgY2hhbmdlZC48L2xpPgoJICogICAgIDxsaT57eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZS9maWxlbG9hZDpldmVudCJ9fXt7L2Nyb3NzTGlua319OiBBIHNpbmdsZSBmaWxlIGhhcyBjb21wbGV0ZWQgbG9hZGluZy48L2xpPgoJICogICAgIDxsaT57eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZS9maWxlcHJvZ3Jlc3M6ZXZlbnQifX17ey9jcm9zc0xpbmt9fTogUHJvZ3Jlc3MgZm9yIGEgc2luZ2xlIGZpbGUgaGFzIGNoYW5nZXMuIE5vdGUKCSAqICAgICB0aGF0IG9ubHkgZmlsZXMgbG9hZGVkIHdpdGggWEhSIChvciBwb3NzaWJseSBieSBwbHVnaW5zKSB3aWxsIGZpcmUgcHJvZ3Jlc3MgZXZlbnRzIG90aGVyIHRoYW4gMCBvciAxMDAlLjwvbGk+CgkgKiA8L3VsPgoJICoKCSAqICAgICAgcXVldWUub24oImZpbGVsb2FkIiwgaGFuZGxlRmlsZUxvYWQsIHRoaXMpOwoJICogICAgICBxdWV1ZS5vbigiY29tcGxldGUiLCBoYW5kbGVDb21wbGV0ZSwgdGhpcyk7CgkgKgoJICogPGI+QWRkaW5nIGZpbGVzIGFuZCBtYW5pZmVzdHM8L2I+PGJyIC8+CgkgKiBBZGQgZmlsZXMgeW91IHdhbnQgdG8gbG9hZCB1c2luZyB7eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZS9sb2FkRmlsZSJ9fXt7L2Nyb3NzTGlua319IG9yIGFkZCBtdWx0aXBsZSBmaWxlcyBhdCBhCgkgKiB0aW1lIHVzaW5nIGEgbGlzdCBvciBhIG1hbmlmZXN0IGRlZmluaXRpb24gdXNpbmcge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvbG9hZE1hbmlmZXN0In19e3svY3Jvc3NMaW5rfX0uIEZpbGVzIGFyZQoJICogYXBwZW5kZWQgdG8gdGhlIGVuZCBvZiB0aGUgYWN0aXZlIHF1ZXVlLCBzbyB5b3UgY2FuIHVzZSB0aGVzZSBtZXRob2RzIGFzIG1hbnkgdGltZXMgYXMgeW91IGxpa2UsIHdoZW5ldmVyIHlvdQoJICogbGlrZS4KCSAqCgkgKiAgICAgIHF1ZXVlLmxvYWRGaWxlKCJmaWxlUGF0aC9maWxlLmpwZyIpOwoJICogICAgICBxdWV1ZS5sb2FkRmlsZSh7aWQ6ImltYWdlIiwgc3JjOiJmaWxlUGF0aC9maWxlLmpwZyJ9KTsKCSAqICAgICAgcXVldWUubG9hZE1hbmlmZXN0KFsiZmlsZVBhdGgvZmlsZS5qcGciLCB7aWQ6ImltYWdlIiwgc3JjOiJmaWxlUGF0aC9maWxlLmpwZyJ9XTsKCSAqCgkgKiBJZiB5b3UgcGFzcyBgZmFsc2VgIGFzIHRoZSBgbG9hZE5vd2AgcGFyYW1ldGVyLCB0aGUgcXVldWUgd2lsbCBub3Qga2ljayBvZiB0aGUgbG9hZCBvZiB0aGUgZmlsZXMsIGJ1dCBpdCB3aWxsIG5vdAoJICogc3RvcCBpZiBpdCBoYXMgYWxyZWFkeSBiZWVuIHN0YXJ0ZWQuIENhbGwgdGhlIHt7I2Nyb3NzTGluayAiQWJzdHJhY3RMb2FkZXIvbG9hZCJ9fXt7L2Nyb3NzTGlua319IG1ldGhvZCB0byBiZWdpbgoJICogYSBwYXVzZWQgcXVldWUuIE5vdGUgdGhhdCBhIHBhdXNlZCBxdWV1ZSB3aWxsIGF1dG9tYXRpY2FsbHkgcmVzdW1lIHdoZW4gbmV3IGZpbGVzIGFyZSBhZGRlZCB0byBpdCB3aXRoIGEKCSAqIGBsb2FkTm93YCBhcmd1bWVudCBvZiBgdHJ1ZWAuCgkgKgoJICogICAgICBxdWV1ZS5sb2FkKCk7CgkgKgoJICogPGI+RmlsZSBUeXBlczwvYj48YnIgLz4KCSAqIFRoZSBmaWxlIHR5cGUgb2YgYSBtYW5pZmVzdCBpdGVtIGlzIGF1dG8tZGV0ZXJtaW5lZCBieSB0aGUgZmlsZSBleHRlbnNpb24uIFRoZSBwYXR0ZXJuIG1hdGNoaW5nIGluIFByZWxvYWRKUwoJICogc2hvdWxkIGhhbmRsZSB0aGUgbWFqb3JpdHkgb2Ygc3RhbmRhcmQgZmlsZSBhbmQgdXJsIGZvcm1hdHMsIGFuZCB3b3JrcyB3aXRoIGNvbW1vbiBmaWxlIGV4dGVuc2lvbnMuIElmIHlvdSBoYXZlCgkgKiBlaXRoZXIgYSBub24tc3RhbmRhcmQgZmlsZSBleHRlbnNpb24sIG9yIGFyZSBzZXJ2aW5nIHRoZSBmaWxlIHVzaW5nIGEgcHJveHkgc2NyaXB0LCB0aGVuIHlvdSBjYW4gcGFzcyBpbiBhCgkgKiA8Y29kZT50eXBlPC9jb2RlPiBwcm9wZXJ0eSB3aXRoIGFueSBtYW5pZmVzdCBpdGVtLgoJICoKCSAqICAgICAgcXVldWUubG9hZEZpbGUoe3NyYzoicGF0aC90by9teUZpbGUubXAzeCIsIHR5cGU6Y3JlYXRlanMuTG9hZFF1ZXVlLlNPVU5EfSk7CgkgKgoJICogICAgICAvLyBOb3RlIHRoYXQgUHJlbG9hZEpTIHdpbGwgbm90IHJlYWQgYSBmaWxlIGV4dGVuc2lvbiBmcm9tIHRoZSBxdWVyeSBzdHJpbmcKCSAqICAgICAgcXVldWUubG9hZEZpbGUoe3NyYzoiaHR0cDovL3NlcnZlci5jb20vcHJveHk/ZmlsZT1pbWFnZS5qcGcifSwgdHlwZTpjcmVhdGVqcy5Mb2FkUXVldWUuSU1BR0V9KTsKCSAqCgkgKiBTdXBwb3J0ZWQgdHlwZXMgYXJlIGRlZmluZWQgb24gdGhlIExvYWRRdWV1ZSBjbGFzcywgYW5kIGluY2x1ZGU6CgkgKiA8dWw+CgkgKiAgICAgPGxpPnt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlL0JJTkFSWTpwcm9wZXJ0eSJ9fXt7L2Nyb3NzTGlua319OiBSYXcgYmluYXJ5IGRhdGEgdmlhIFhIUjwvbGk+CgkgKiAgICAgPGxpPnt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlL0NTUzpwcm9wZXJ0eSJ9fXt7L2Nyb3NzTGlua319OiBDU1MgZmlsZXM8L2xpPgoJICogICAgIDxsaT57eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZS9JTUFHRTpwcm9wZXJ0eSJ9fXt7L2Nyb3NzTGlua319OiBDb21tb24gaW1hZ2UgZm9ybWF0czwvbGk+CgkgKiAgICAgPGxpPnt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlL0pBVkFTQ1JJUFQ6cHJvcGVydHkifX17ey9jcm9zc0xpbmt9fTogSmF2YVNjcmlwdCBmaWxlczwvbGk+CgkgKiAgICAgPGxpPnt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlL0pTT046cHJvcGVydHkifX17ey9jcm9zc0xpbmt9fTogSlNPTiBkYXRhPC9saT4KCSAqICAgICA8bGk+e3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvSlNPTlA6cHJvcGVydHkifX17ey9jcm9zc0xpbmt9fTogSlNPTiBmaWxlcyBjcm9zcy1kb21haW48L2xpPgoJICogICAgIDxsaT57eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZS9NQU5JRkVTVDpwcm9wZXJ0eSJ9fXt7L2Nyb3NzTGlua319OiBBIGxpc3Qgb2YgZmlsZXMgdG8gbG9hZCBpbiBKU09OIGZvcm1hdCwgc2VlCgkgKiAgICAge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvbG9hZE1hbmlmZXN0In19e3svY3Jvc3NMaW5rfX08L2xpPgoJICogICAgIDxsaT57eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZS9TT1VORDpwcm9wZXJ0eSJ9fXt7L2Nyb3NzTGlua319OiBBdWRpbyBmaWxlIGZvcm1hdHM8L2xpPgoJICogICAgIDxsaT57eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZS9TVkc6cHJvcGVydHkifX17ey9jcm9zc0xpbmt9fTogU1ZHIGZpbGVzPC9saT4KCSAqICAgICA8bGk+e3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvVEVYVDpwcm9wZXJ0eSJ9fXt7L2Nyb3NzTGlua319OiBUZXh0IGZpbGVzIC0gWEhSIG9ubHk8L2xpPgoJICogICAgIDxsaT57eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZS9YTUw6cHJvcGVydHkifX17ey9jcm9zc0xpbmt9fTogWE1MIGRhdGE8L2xpPgoJICogPC91bD4KCSAqCgkgKiA8Yj5IYW5kbGluZyBSZXN1bHRzPC9iPjxiciAvPgoJICogV2hlbiBhIGZpbGUgaXMgZmluaXNoZWQgZG93bmxvYWRpbmcsIGEge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvZmlsZWxvYWQ6ZXZlbnQifX17ey9jcm9zc0xpbmt9fSBldmVudCBpcwoJICogZGlzcGF0Y2hlZC4gSW4gYW4gZXhhbXBsZSBhYm92ZSwgdGhlcmUgaXMgYW4gZXZlbnQgbGlzdGVuZXIgc25pcHBldCBmb3IgZmlsZWxvYWQuIExvYWRlZCBmaWxlcyBhcmUgdXN1YWxseSBhCgkgKiByZXNvbHZlZCBvYmplY3QgdGhhdCBjYW4gYmUgdXNlZCBpbW1lZGlhdGVseSwgaW5jbHVkaW5nOgoJICogPHVsPgoJICogICAgIDxsaT5JbWFnZTogQW4gJmx0O2ltZyAvJmd0OyB0YWc8L2xpPgoJICogICAgIDxsaT5BdWRpbzogQW4gJmx0O2F1ZGlvIC8mZ3Q7IHRhZzwvYT4KCSAqICAgICA8bGk+SmF2YVNjcmlwdDogQSAmbHQ7c2NyaXB0IC8mZ3Q7IHRhZzwvbGk+CgkgKiAgICAgPGxpPkNTUzogQSAmbHQ7bGluayAvJmd0OyB0YWc8L2xpPgoJICogICAgIDxsaT5YTUw6IEFuIFhNTCBET00gbm9kZTwvbGk+CgkgKiAgICAgPGxpPlNWRzogQW4gJmx0O29iamVjdCAvJmd0OyB0YWc8L2xpPgoJICogICAgIDxsaT5KU09OOiBBIGZvcm1hdHRlZCBKYXZhU2NyaXB0IE9iamVjdDwvbGk+CgkgKiAgICAgPGxpPlRleHQ6IFJhdyB0ZXh0PC9saT4KCSAqICAgICA8bGk+QmluYXJ5OiBUaGUgYmluYXJ5IGxvYWRlZCByZXN1bHQ8L2xpPgoJICogPC91bD4KCSAqCgkgKiAgICAgIGZ1bmN0aW9uIGhhbmRsZUZpbGVMb2FkKGV2ZW50KSB7CgkgKiAgICAgICAgICB2YXIgaXRlbSA9IGV2ZW50Lml0ZW07IC8vIEEgcmVmZXJlbmNlIHRvIHRoZSBpdGVtIHRoYXQgd2FzIHBhc3NlZCBpbiB0byB0aGUgTG9hZFF1ZXVlCgkgKiAgICAgICAgICB2YXIgdHlwZSA9IGl0ZW0udHlwZTsKCSAqCgkgKiAgICAgICAgICAvLyBBZGQgYW55IGltYWdlcyB0byB0aGUgcGFnZSBib2R5LgoJICogICAgICAgICAgaWYgKHR5cGUgPT0gY3JlYXRlanMuTG9hZFF1ZXVlLklNQUdFKSB7CgkgKiAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChldmVudC5yZXN1bHQpOwoJICogICAgICAgICAgfQoJICogICAgICB9CgkgKgoJICogQXQgYW55IHRpbWUgYWZ0ZXIgdGhlIGZpbGUgaGFzIGJlZW4gbG9hZGVkICh1c3VhbGx5IGFmdGVyIHRoZSBxdWV1ZSBoYXMgY29tcGxldGVkKSwgYW55IHJlc3VsdCBjYW4gYmUgbG9va2VkIHVwCgkgKiB2aWEgaXRzICJpZCIgdXNpbmcge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvZ2V0UmVzdWx0In19e3svY3Jvc3NMaW5rfX0uIElmIG5vIGlkIHdhcyBwcm92aWRlZCwgdGhlbiB0aGUgInNyYyIgb3IKCSAqIGZpbGUgcGF0aCBjYW4gYmUgdXNlZCBpbnN0ZWFkLCBpbmNsdWRpbmcgdGhlIGBwYXRoYCBkZWZpbmVkIGJ5IGEgbWFuaWZlc3QsIGJ1dCA8c3Ryb25nPm5vdCBpbmNsdWRpbmc8L3N0cm9uZz4gYQoJICogYmFzZSBwYXRoIGRlZmluZWQgb24gdGhlIExvYWRRdWV1ZS4gSXQgaXMgcmVjb21tZW5kZWQgdG8gYWx3YXlzIHBhc3MgYW4gaWQuCgkgKgoJICogICAgICB2YXIgaW1hZ2UgPSBxdWV1ZS5nZXRSZXN1bHQoImltYWdlIik7CgkgKiAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoaW1hZ2UpOwoJICoKCSAqIFJhdyBsb2FkZWQgY29udGVudCBjYW4gYmUgYWNjZXNzZWQgdXNpbmcgdGhlIDxjb2RlPnJhd1Jlc3VsdDwvY29kZT4gcHJvcGVydHkgb2YgdGhlIHt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlL2ZpbGVsb2FkOmV2ZW50In19e3svY3Jvc3NMaW5rfX0KCSAqIGV2ZW50LCBvciBjYW4gYmUgbG9va2VkIHVwIHVzaW5nIHt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlL2dldFJlc3VsdCJ9fXt7L2Nyb3NzTGlua319LCBwYXNzaW5nIGB0cnVlYCBhcyB0aGUgMm5kCgkgKiBhcmd1bWVudC4gVGhpcyBpcyBvbmx5IGFwcGxpY2FibGUgZm9yIGNvbnRlbnQgdGhhdCBoYXMgYmVlbiBwYXJzZWQgZm9yIHRoZSBicm93c2VyLCBzcGVjaWZpY2FsbHk6IEphdmFTY3JpcHQsCgkgKiBDU1MsIFhNTCwgU1ZHLCBhbmQgSlNPTiBvYmplY3RzLCBvciBhbnl0aGluZyBsb2FkZWQgd2l0aCBYSFIuCgkgKgoJICogICAgICB2YXIgaW1hZ2UgPSBxdWV1ZS5nZXRSZXN1bHQoImltYWdlIiwgdHJ1ZSk7IC8vIGxvYWQgdGhlIGJpbmFyeSBpbWFnZSBkYXRhIGxvYWRlZCB3aXRoIFhIUi4KCSAqCgkgKiA8Yj5QbHVnaW5zPC9iPjxiciAvPgoJICogTG9hZFF1ZXVlIGhhcyBhIHNpbXBsZSBwbHVnaW4gYXJjaGl0ZWN0dXJlIHRvIGhlbHAgcHJvY2VzcyBhbmQgcHJlbG9hZCBjb250ZW50LiBGb3IgZXhhbXBsZSwgdG8gcHJlbG9hZCBhdWRpbywKCSAqIG1ha2Ugc3VyZSB0byBpbnN0YWxsIHRoZSA8YSBocmVmPSJodHRwOi8vc291bmRqcy5jb20iPlNvdW5kSlM8L2E+IFNvdW5kIGNsYXNzLCB3aGljaCB3aWxsIGhlbHAgbG9hZCBIVE1MIGF1ZGlvLAoJICogRmxhc2ggYXVkaW8sIGFuZCBXZWJBdWRpbyBmaWxlcy4gVGhpcyBzaG91bGQgYmUgaW5zdGFsbGVkIDxzdHJvbmc+YmVmb3JlPC9zdHJvbmc+IGxvYWRpbmcgYW55IGF1ZGlvIGZpbGVzLgoJICoKCSAqICAgICAgcXVldWUuaW5zdGFsbFBsdWdpbihjcmVhdGVqcy5Tb3VuZCk7CgkgKgoJICogPGg0Pktub3duIEJyb3dzZXIgSXNzdWVzPC9oND4KCSAqIDx1bD4KCSAqICAgICA8bGk+QnJvd3NlcnMgd2l0aG91dCBhdWRpbyBzdXBwb3J0IGNhbiBub3QgbG9hZCBhdWRpbyBmaWxlcy48L2xpPgoJICogICAgIDxsaT5TYWZhcmkgb24gTWFjIE9TIFggY2FuIG9ubHkgcGxheSBIVE1MIGF1ZGlvIGlmIFF1aWNrVGltZSBpcyBpbnN0YWxsZWQ8L2xpPgoJICogICAgIDxsaT5IVE1MIEF1ZGlvIHRhZ3Mgd2lsbCBvbmx5IGRvd25sb2FkIHVudGlsIHRoZWlyIDxjb2RlPmNhblBsYXlUaHJvdWdoPC9jb2RlPiBldmVudCBpcyBmaXJlZC4gQnJvd3NlcnMgb3RoZXIKCSAqICAgICB0aGFuIENocm9tZSB3aWxsIGNvbnRpbnVlIHRvIGRvd25sb2FkIGluIHRoZSBiYWNrZ3JvdW5kLjwvbGk+CgkgKiAgICAgPGxpPldoZW4gbG9hZGluZyBzY3JpcHRzIHVzaW5nIHRhZ3MsIHRoZXkgYXJlIGF1dG9tYXRpY2FsbHkgYWRkZWQgdG8gdGhlIGRvY3VtZW50LjwvbGk+CgkgKiAgICAgPGxpPlNjcmlwdHMgbG9hZGVkIHZpYSBYSFIgbWF5IG5vdCBiZSBwcm9wZXJseSBpbnNwZWN0YWJsZSB3aXRoIGJyb3dzZXIgdG9vbHMuPC9saT4KCSAqICAgICA8bGk+SUU2IGFuZCBJRTcgKGFuZCBzb21lIG90aGVyIGJyb3dzZXJzKSBtYXkgbm90IGJlIGFibGUgdG8gbG9hZCBYTUwsIFRleHQsIG9yIEpTT04sIHNpbmNlIHRoZXkgcmVxdWlyZQoJICogICAgIFhIUiB0byB3b3JrLjwvbGk+CgkgKiAgICAgPGxpPkNvbnRlbnQgbG9hZGVkIHZpYSB0YWdzIHdpbGwgbm90IHNob3cgcHJvZ3Jlc3MsIGFuZCB3aWxsIGNvbnRpbnVlIHRvIGRvd25sb2FkIGluIHRoZSBiYWNrZ3JvdW5kIHdoZW4KCSAqICAgICBjYW5jZWxlZCwgYWx0aG91Z2ggbm8gZXZlbnRzIHdpbGwgYmUgZGlzcGF0Y2hlZC48L2xpPgoJICogPC91bD4KCSAqCgkgKiBAY2xhc3MgTG9hZFF1ZXVlCgkgKiBAcGFyYW0ge0Jvb2xlYW59IFt1c2VYSFI9dHJ1ZV0gRGV0ZXJtaW5lcyB3aGV0aGVyIHRoZSBwcmVsb2FkIGluc3RhbmNlIHdpbGwgZmF2b3IgbG9hZGluZyB3aXRoIFhIUiAoWE1MIEhUVFAKCSAqIFJlcXVlc3RzKSwgb3IgSFRNTCB0YWdzLiBXaGVuIHRoaXMgaXMgYGZhbHNlYCwgdGhlIHF1ZXVlIHdpbGwgdXNlIHRhZyBsb2FkaW5nIHdoZW4gcG9zc2libGUsIGFuZCBmYWxsIGJhY2sgb24gWEhSCgkgKiB3aGVuIG5lY2Vzc2FyeS4KCSAqIEBwYXJhbSB7U3RyaW5nfSBbYmFzZVBhdGg9IiJdIEEgcGF0aCB0aGF0IHdpbGwgYmUgcHJlcGVuZGVkIG9uIHRvIHRoZSBzb3VyY2UgcGFyYW1ldGVyIG9mIGFsbCBpdGVtcyBpbiB0aGUgcXVldWUKCSAqIGJlZm9yZSB0aGV5IGFyZSBsb2FkZWQuICBTb3VyY2VzIGJlZ2lubmluZyB3aXRoIGEgcHJvdG9jb2wgc3VjaCBhcyBgaHR0cDovL2Agb3IgYSByZWxhdGl2ZSBwYXRoIHN1Y2ggYXMgYC4uL2AKCSAqIHdpbGwgbm90IHJlY2VpdmUgYSBiYXNlIHBhdGguCgkgKiBAcGFyYW0ge1N0cmluZ3xCb29sZWFufSBbY3Jvc3NPcmlnaW49IiJdIEFuIG9wdGlvbmFsIGZsYWcgdG8gc3VwcG9ydCBpbWFnZXMgbG9hZGVkIGZyb20gYSBDT1JTLWVuYWJsZWQgc2VydmVyLiBUbwoJICogdXNlIGl0LCBzZXQgdGhpcyB2YWx1ZSB0byBgdHJ1ZWAsIHdoaWNoIHdpbGwgZGVmYXVsdCB0aGUgY3Jvc3NPcmlnaW4gcHJvcGVydHkgb24gaW1hZ2VzIHRvICJBbm9ueW1vdXMiLiBBbnkKCSAqIHN0cmluZyB2YWx1ZSB3aWxsIGJlIHBhc3NlZCB0aHJvdWdoLCBidXQgb25seSAiIiBhbmQgIkFub255bW91cyIgYXJlIHJlY29tbWVuZGVkLgoJICogQGNvbnN0cnVjdG9yCgkgKiBAZXh0ZW5kcyBBYnN0cmFjdExvYWRlcgoJICovCgl2YXIgTG9hZFF1ZXVlID0gZnVuY3Rpb24odXNlWEhSLCBiYXNlUGF0aCwgY3Jvc3NPcmlnaW4pIHsKCQl0aGlzLmluaXQodXNlWEhSLCBiYXNlUGF0aCwgY3Jvc3NPcmlnaW4pOwoJfTsKCgl2YXIgcCA9IExvYWRRdWV1ZS5wcm90b3R5cGUgPSBuZXcgY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIoKTsKCXZhciBzID0gTG9hZFF1ZXVlOwoKCS8qKgoJICogVGltZSBpbiBtaWxsaXNlY29uZHMgdG8gYXNzdW1lIGEgbG9hZCBoYXMgZmFpbGVkLiBBbiB7eyNjcm9zc0xpbmsgIkFic3RyYWN0TG9hZGVyL2Vycm9yOmV2ZW50In19e3svY3Jvc3NMaW5rfX0KCSAqIGV2ZW50IGlzIGRpc3BhdGNoZWQgaWYgdGhlIHRpbWVvdXQgaXMgcmVhY2hlZCBiZWZvcmUgYW55IGRhdGEgaXMgcmVjZWl2ZWQuCgkgKiBAcHJvcGVydHkgbG9hZFRpbWVvdXQKCSAqIEB0eXBlIHtOdW1iZXJ9CgkgKiBAZGVmYXVsdCA4MDAwCgkgKiBAc3RhdGljCgkgKiBAc2luY2UgMC40LjEKCSAqLwoJcy5sb2FkVGltZW91dCA9IDgwMDA7CgoJLyoqCgkgKiBUaW1lIGluIG1pbGxpc2Vjb25kcyB0byBhc3N1bWUgYSBsb2FkIGhhcyBmYWlsZWQuCgkgKiBAdHlwZSB7TnVtYmVyfQoJICogQGRlcHJlY2F0ZWQgaW4gZmF2b3Igb2YgdGhlIHt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlL2xvYWRUaW1lb3V0OnByb3BlcnR5In19e3svY3Jvc3NMaW5rfX0gcHJvcGVydHkuCgkgKi8KCXMuTE9BRF9USU1FT1VUID0gMDsKCi8vIFByZWxvYWQgVHlwZXMKCS8qKgoJICogVGhlIHByZWxvYWQgdHlwZSBmb3IgZ2VuZXJpYyBiaW5hcnkgdHlwZXMuIE5vdGUgdGhhdCBpbWFnZXMgYXJlIGxvYWRlZCBhcyBiaW5hcnkgZmlsZXMgd2hlbiB1c2luZyBYSFIuCgkgKiBAcHJvcGVydHkgQklOQVJZCgkgKiBAdHlwZSB7U3RyaW5nfQoJICogQGRlZmF1bHQgYmluYXJ5CgkgKiBAc3RhdGljCgkgKi8KCXMuQklOQVJZID0gImJpbmFyeSI7CgoJLyoqCgkgKiBUaGUgcHJlbG9hZCB0eXBlIGZvciBjc3MgZmlsZXMuIENTUyBmaWxlcyBhcmUgbG9hZGVkIHVzaW5nIGEgJmx0O2xpbmsmZ3Q7IHdoZW4gbG9hZGVkIHdpdGggWEhSLCBvciBhCgkgKiAmbHQ7c3R5bGUmZ3Q7IHRhZyB3aGVuIGxvYWRlZCB3aXRoIHRhZ3MuCgkgKiBAcHJvcGVydHkgQ1NTCgkgKiBAdHlwZSB7U3RyaW5nfQoJICogQGRlZmF1bHQgY3NzCgkgKiBAc3RhdGljCgkgKi8KCXMuQ1NTID0gImNzcyI7CgoJLyoqCgkgKiBUaGUgcHJlbG9hZCB0eXBlIGZvciBpbWFnZSBmaWxlcywgdXN1YWxseSBwbmcsIGdpZiwgb3IganBnL2pwZWcuIEltYWdlcyBhcmUgbG9hZGVkIGludG8gYW4gJmx0O2ltYWdlJmd0OyB0YWcuCgkgKiBAcHJvcGVydHkgSU1BR0UKCSAqIEB0eXBlIHtTdHJpbmd9CgkgKiBAZGVmYXVsdCBpbWFnZQoJICogQHN0YXRpYwoJICovCglzLklNQUdFID0gImltYWdlIjsKCgkvKioKCSAqIFRoZSBwcmVsb2FkIHR5cGUgZm9yIGphdmFzY3JpcHQgZmlsZXMsIHVzdWFsbHkgd2l0aCB0aGUgImpzIiBmaWxlIGV4dGVuc2lvbi4gSmF2YVNjcmlwdCBmaWxlcyBhcmUgbG9hZGVkIGludG8gYQoJICogJmx0O3NjcmlwdCZndDsgdGFnLgoJICoKCSAqIFNpbmNlIHZlcnNpb24gMC40LjErLCBkdWUgdG8gaG93IHRhZy1sb2FkZWQgc2NyaXB0cyB3b3JrLCBhbGwgSmF2YVNjcmlwdCBmaWxlcyBhcmUgYXV0b21hdGljYWxseSBpbmplY3RlZCBpbnRvCgkgKiB0aGUgYm9keSBvZiB0aGUgZG9jdW1lbnQgdG8gbWFpbnRhaW4gcGFyaXR5IGJldHdlZW4gWEhSIGFuZCB0YWctbG9hZGVkIHNjcmlwdHMuIEluIHZlcnNpb24gMC40LjAgYW5kIGVhcmxpZXIsCgkgKiBvbmx5IHRhZy1sb2FkZWQgc2NyaXB0cyBhcmUgaW5qZWN0ZWQuCgkgKiBAcHJvcGVydHkgSkFWQVNDUklQVAoJICogQHR5cGUge1N0cmluZ30KCSAqIEBkZWZhdWx0IGphdmFzY3JpcHQKCSAqIEBzdGF0aWMKCSAqLwoJcy5KQVZBU0NSSVBUID0gImphdmFzY3JpcHQiOwoKCS8qKgoJICogVGhlIHByZWxvYWQgdHlwZSBmb3IganNvbiBmaWxlcywgdXN1YWxseSB3aXRoIHRoZSAianNvbiIgZmlsZSBleHRlbnNpb24uIEpTT04gZGF0YSBpcyBsb2FkZWQgYW5kIHBhcnNlZCBpbnRvIGEKCSAqIEphdmFTY3JpcHQgb2JqZWN0LiBOb3RlIHRoYXQgaWYgYSBgY2FsbGJhY2tgIGlzIHByZXNlbnQgb24gdGhlIGxvYWQgaXRlbSwgdGhlIGZpbGUgd2lsbCBiZSBsb2FkZWQgd2l0aCBKU09OUCwKCSAqIG5vIG1hdHRlciB3aGF0IHRoZSB7eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZS91c2VYSFI6cHJvcGVydHkifX17ey9jcm9zc0xpbmt9fSBwcm9wZXJ0eSBpcyBzZXQgdG8sIGFuZCB0aGUgSlNPTgoJICogbXVzdCBjb250YWluIGEgbWF0Y2hpbmcgd3JhcHBlciBmdW5jdGlvbi4KCSAqIEBwcm9wZXJ0eSBKU09OCgkgKiBAdHlwZSB7U3RyaW5nfQoJICogQGRlZmF1bHQganNvbgoJICogQHN0YXRpYwoJICovCglzLkpTT04gPSAianNvbiI7CgoJLyoqCgkgKiBUaGUgcHJlbG9hZCB0eXBlIGZvciBqc29ucCBmaWxlcywgdXN1YWxseSB3aXRoIHRoZSAianNvbiIgZmlsZSBleHRlbnNpb24uIEpTT04gZGF0YSBpcyBsb2FkZWQgYW5kIHBhcnNlZCBpbnRvIGEKCSAqIEphdmFTY3JpcHQgb2JqZWN0LiBZb3UgYXJlIHJlcXVpcmVkIHRvIHBhc3MgYSBjYWxsYmFjayBwYXJhbWV0ZXIgdGhhdCBtYXRjaGVzIHRoZSBmdW5jdGlvbiB3cmFwcGVyIGluIHRoZSBKU09OLgoJICogTm90ZSB0aGF0IEpTT05QIHdpbGwgYWx3YXlzIGJlIHVzZWQgaWYgdGhlcmUgaXMgYSBjYWxsYmFjayBwcmVzZW50LCBubyBtYXR0ZXIgd2hhdCB0aGUge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvdXNlWEhSOnByb3BlcnR5In19e3svY3Jvc3NMaW5rfX0KCSAqIHByb3BlcnR5IGlzIHNldCB0by4KCSAqIEBwcm9wZXJ0eSBKU09OUAoJICogQHR5cGUge1N0cmluZ30KCSAqIEBkZWZhdWx0IGpzb25wCgkgKiBAc3RhdGljCgkgKi8KCXMuSlNPTlAgPSAianNvbnAiOwoKCS8qKgoJICogVGhlIHByZWxvYWQgdHlwZSBmb3IganNvbi1iYXNlZCBtYW5pZmVzdCBmaWxlcywgdXN1YWxseSB3aXRoIHRoZSAianNvbiIgZmlsZSBleHRlbnNpb24uIFRoZSBKU09OIGRhdGEgaXMgbG9hZGVkCgkgKiBhbmQgcGFyc2VkIGludG8gYSBKYXZhU2NyaXB0IG9iamVjdC4gUHJlbG9hZEpTIHdpbGwgdGhlbiBsb29rIGZvciBhICJtYW5pZmVzdCIgcHJvcGVydHkgaW4gdGhlIEpTT04sIHdoaWNoIGlzIGFuCgkgKiBBcnJheSBvZiBmaWxlcyB0byBsb2FkLCBmb2xsb3dpbmcgdGhlIHNhbWUgZm9ybWF0IGFzIHRoZSB7eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZS9sb2FkTWFuaWZlc3QifX17ey9jcm9zc0xpbmt9fQoJICogbWV0aG9kLiBJZiBhICJjYWxsYmFjayIgaXMgc3BlY2lmaWVkIG9uIHRoZSBtYW5pZmVzdCBvYmplY3QsIHRoZW4gaXQgd2lsbCBiZSBsb2FkZWQgdXNpbmcgSlNPTlAgaW5zdGVhZCwKCSAqIHJlZ2FyZGxlc3Mgb2Ygd2hhdCB0aGUge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvdXNlWEhSOnByb3BlcnR5In19e3svY3Jvc3NMaW5rfX0gcHJvcGVydHkgaXMgc2V0IHRvLgoJICogQHByb3BlcnR5IE1BTklGRVNUCgkgKiBAdHlwZSB7U3RyaW5nfQoJICogQGRlZmF1bHQgbWFuaWZlc3QKCSAqIEBzdGF0aWMKCSAqIEBzaW5jZSAwLjQuMQoJICovCglzLk1BTklGRVNUID0gIm1hbmlmZXN0IjsKCgkvKioKCSAqIFRoZSBwcmVsb2FkIHR5cGUgZm9yIHNvdW5kIGZpbGVzLCB1c3VhbGx5IG1wMywgb2dnLCBvciB3YXYuIFdoZW4gbG9hZGluZyB2aWEgdGFncywgYXVkaW8gaXMgbG9hZGVkIGludG8gYW4KCSAqICZsdDthdWRpbyZndDsgdGFnLgoJICogQHByb3BlcnR5IFNPVU5ECgkgKiBAdHlwZSB7U3RyaW5nfQoJICogQGRlZmF1bHQgc291bmQKCSAqIEBzdGF0aWMKCSAqLwoJcy5TT1VORCA9ICJzb3VuZCI7CgoJLyoqCiAgICAgKiBUaGUgcHJlbG9hZCB0eXBlIGZvciBTVkcgZmlsZXMuCgkgKiBAcHJvcGVydHkgU1ZHCgkgKiBAdHlwZSB7U3RyaW5nfQoJICogQGRlZmF1bHQgc3ZnCgkgKiBAc3RhdGljCgkgKi8KCXMuU1ZHID0gInN2ZyI7CgoJLyoqCgkgKiBUaGUgcHJlbG9hZCB0eXBlIGZvciB0ZXh0IGZpbGVzLCB3aGljaCBpcyBhbHNvIHRoZSBkZWZhdWx0IGZpbGUgdHlwZSBpZiB0aGUgdHlwZSBjYW4gbm90IGJlIGRldGVybWluZWQuIFRleHQgaXMKCSAqIGxvYWRlZCBhcyByYXcgdGV4dC4KCSAqIEBwcm9wZXJ0eSBURVhUCgkgKiBAdHlwZSB7U3RyaW5nfQoJICogQGRlZmF1bHQgdGV4dAoJICogQHN0YXRpYwoJICovCglzLlRFWFQgPSAidGV4dCI7CgoJLyoqCgkgKiBUaGUgcHJlbG9hZCB0eXBlIGZvciB4bWwgZmlsZXMuIFhNTCBpcyBsb2FkZWQgaW50byBhbiBYTUwgZG9jdW1lbnQuCgkgKiBAcHJvcGVydHkgWE1MCgkgKiBAdHlwZSB7U3RyaW5nfQoJICogQGRlZmF1bHQgeG1sCgkgKiBAc3RhdGljCgkgKi8KCXMuWE1MID0gInhtbCI7CgoJLyoqCgkgKiBEZWZpbmVzIGEgUE9TVCByZXF1ZXN0LCB1c2UgZm9yIGEgbWV0aG9kIHZhbHVlIHdoZW4gbG9hZGluZyBkYXRhLgoJICoKCSAqIEB0eXBlIHtzdHJpbmd9CgkgKi8KCXMuUE9TVCA9ICdQT1NUJzsKCgkvKioKCSAqIERlZmluZXMgYSBHRVQgcmVxdWVzdCwgdXNlIGZvciBhIG1ldGhvZCB2YWx1ZSB3aGVuIGxvYWRpbmcgZGF0YS4KCSAqCgkgKiBAdHlwZSB7c3RyaW5nfQoJICovCglzLkdFVCA9ICdHRVQnOwoKCi8vIFByb3RvdHlwZQoJLyoqCgkgKiBBIHBhdGggdGhhdCB3aWxsIGJlIHByZXBlbmRlZCBvbiB0byB0aGUgaXRlbSdzIGBzcmNgLiBUaGUgYF9iYXNlUGF0aGAgcHJvcGVydHkgd2lsbCBvbmx5IGJlIHVzZWQgaWYgYW4gaXRlbSdzCgkgKiBzb3VyY2UgaXMgcmVsYXRpdmUsIGFuZCBkb2VzIG5vdCBpbmNsdWRlIGEgcHJvdG9jb2wgc3VjaCBhcyBgaHR0cDovL2AsIG9yIGEgcmVsYXRpdmUgcGF0aCBzdWNoIGFzIGAuLi9gLgoJICogQHByb3BlcnR5IF9iYXNlUGF0aAoJICogQHR5cGUge1N0cmluZ30KCSAqIEBwcml2YXRlCgkgKiBAc2luY2UgMC4zLjEKCSAqLwoJcC5fYmFzZVBhdGggPSBudWxsOwoKCS8qKgoJICogQW4gb3B0aW9uYWwgZmxhZyB0byBzZXQgb24gaW1hZ2VzIHRoYXQgYXJlIGxvYWRlZCB1c2luZyBQcmVsb2FkSlMsIHdoaWNoIGVuYWJsZXMgQ09SUyBzdXBwb3J0LiBJbWFnZXMgbG9hZGVkCgkgKiBjcm9zcy1kb21haW4gYnkgc2VydmVycyB0aGF0IHN1cHBvcnQgQ09SUyByZXF1aXJlIHRoZSBjcm9zc09yaWdpbiBmbGFnIHRvIGJlIGxvYWRlZCBhbmQgaW50ZXJhY3RlZCB3aXRoIGJ5CgkgKiBhIGNhbnZhcy4gV2hlbiBsb2FkaW5nIGxvY2FsbHksIG9yIHdpdGggYSBzZXJ2ZXIgd2l0aCBubyBDT1JTIHN1cHBvcnQsIHRoaXMgZmxhZyBjYW4gY2F1c2Ugb3RoZXIgc2VjdXJpdHkgaXNzdWVzLAoJICogc28gaXQgaXMgcmVjb21tZW5kZWQgdG8gb25seSBzZXQgaXQgaWYgeW91IGFyZSBzdXJlIHRoZSBzZXJ2ZXIgc3VwcG9ydHMgaXQuIEN1cnJlbnRseSwgc3VwcG9ydGVkIHZhbHVlcyBhcmUgIiIKCSAqIGFuZCAiQW5vbnltb3VzIi4KCSAqIEBwcm9wZXJ0eSBfY3Jvc3NPcmlnaW4KCSAqIEB0eXBlIHtTdHJpbmd9CgkgKiBAZGVmYXVsdFZhbHVlICIiCgkgKiBAcHJpdmF0ZQoJICogQHNpbmNlIDAuNC4xCgkgKi8KCXAuX2Nyb3NzT3JpZ2luID0gIiI7CgoJLyoqCgkgKiBVc2UgWE1MSHR0cFJlcXVlc3QgKFhIUikgd2hlbiBwb3NzaWJsZS4gTm90ZSB0aGF0IExvYWRRdWV1ZSB3aWxsIGRlZmF1bHQgdG8gdGFnIGxvYWRpbmcgb3IgWEhSIGxvYWRpbmcgZGVwZW5kaW5nCgkgKiBvbiB0aGUgcmVxdWlyZW1lbnRzIGZvciBhIG1lZGlhIHR5cGUuIEZvciBleGFtcGxlLCBIVE1MIGF1ZGlvIGNhbiBub3QgYmUgbG9hZGVkIHdpdGggWEhSLCBhbmQgV2ViQXVkaW8gY2FuIG5vdCBiZQoJICogbG9hZGVkIHdpdGggdGFncywgc28gaXQgd2lsbCBkZWZhdWx0IHRoZSB0aGUgY29ycmVjdCB0eXBlIGluc3RlYWQgb2YgdXNpbmcgdGhlIHVzZXItZGVmaW5lZCB0eXBlLgoJICoKCSAqIDxiPk5vdGU6IFRoaXMgcHJvcGVydHkgaXMgcmVhZC1vbmx5LjwvYj4gVG8gY2hhbmdlIGl0LCBwbGVhc2UgdXNlIHRoZSB7eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZS9zZXRVc2VYSFIifX17ey9jcm9zc0xpbmt9fQoJICogbWV0aG9kLCBvciBzcGVjaWZ5IHRoZSBgdXNlWEhSYCBhcmd1bWVudCBpbiB0aGUgTG9hZFF1ZXVlIGNvbnN0cnVjdG9yLgoJICoKCSAqIEBwcm9wZXJ0eSB1c2VYSFIKCSAqIEB0eXBlIHtCb29sZWFufQoJICogQHJlYWRPbmx5CgkgKiBAZGVmYXVsdCB0cnVlCgkgKi8KCXAudXNlWEhSID0gdHJ1ZTsKCgkvKioKCSAqIERldGVybWluZXMgaWYgdGhlIExvYWRRdWV1ZSB3aWxsIHN0b3AgcHJvY2Vzc2luZyB0aGUgY3VycmVudCBxdWV1ZSB3aGVuIGFuIGVycm9yIGlzIGVuY291bnRlcmVkLgoJICogQHByb3BlcnR5IHN0b3BPbkVycm9yCgkgKiBAdHlwZSB7Qm9vbGVhbn0KCSAqIEBkZWZhdWx0IGZhbHNlCgkgKi8KCXAuc3RvcE9uRXJyb3IgPSBmYWxzZTsKCgkvKioKCSAqIEVuc3VyZSBsb2FkZWQgc2NyaXB0cyAiY29tcGxldGUiIGluIHRoZSBvcmRlciB0aGV5IGFyZSBzcGVjaWZpZWQuIExvYWRlZCBzY3JpcHRzIGFyZSBhZGRlZCB0byB0aGUgZG9jdW1lbnQgaGVhZAoJICogb25jZSB0aGV5IGFyZSBsb2FkZWQuIE5vdGUgdGhhdCBzY3JpcHRzIGxvYWRlZCB2aWEgdGFncyB3aWxsIGxvYWQgb25lLWF0LWEtdGltZSB3aGVuIHRoaXMgcHJvcGVydHkgaXMgYHRydWVgLgoJICogbG9hZCBvbmUgYXQgYSB0aW1lCgkgKiBAcHJvcGVydHkgbWFpbnRhaW5TY3JpcHRPcmRlcgoJICogQHR5cGUge0Jvb2xlYW59CgkgKiBAZGVmYXVsdCB0cnVlCgkgKi8KCXAubWFpbnRhaW5TY3JpcHRPcmRlciA9IHRydWU7CgoJLyoqCgkgKiBUaGUgbmV4dCBwcmVsb2FkIHF1ZXVlIHRvIHByb2Nlc3Mgd2hlbiB0aGlzIG9uZSBpcyBjb21wbGV0ZS4gSWYgYW4gZXJyb3IgaXMgdGhyb3duIGluIHRoZSBjdXJyZW50IHF1ZXVlLCBhbmQKCSAqIHt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlL3N0b3BPbkVycm9yOnByb3BlcnR5In19e3svY3Jvc3NMaW5rfX0gaXMgYHRydWVgLCB0aGUgbmV4dCBxdWV1ZSB3aWxsIG5vdCBiZSBwcm9jZXNzZWQuCgkgKiBAcHJvcGVydHkgbmV4dAoJICogQHR5cGUge0xvYWRRdWV1ZX0KCSAqIEBkZWZhdWx0IG51bGwKCSAqLwoJcC5uZXh0ID0gbnVsbDsKCi8vIEV2ZW50cwoJLyoqCgkgKiBUaGlzIGV2ZW50IGlzIGZpcmVkIHdoZW4gYW4gaW5kaXZpZHVhbCBmaWxlIGhhcyBsb2FkZWQsIGFuZCBiZWVuIHByb2Nlc3NlZC4KCSAqIEBldmVudCBmaWxlbG9hZAoJICogQHBhcmFtIHtPYmplY3R9IHRhcmdldCBUaGUgb2JqZWN0IHRoYXQgZGlzcGF0Y2hlZCB0aGUgZXZlbnQuCgkgKiBAcGFyYW0ge1N0cmluZ30gdHlwZSBUaGUgZXZlbnQgdHlwZS4KCSAqIEBwYXJhbSB7T2JqZWN0fSBpdGVtIFRoZSBmaWxlIGl0ZW0gd2hpY2ggd2FzIHNwZWNpZmllZCBpbiB0aGUge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvbG9hZEZpbGUifX17ey9jcm9zc0xpbmt9fQoJICogb3Ige3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvbG9hZE1hbmlmZXN0In19e3svY3Jvc3NMaW5rfX0gY2FsbC4gSWYgb25seSBhIHN0cmluZyBwYXRoIG9yIHRhZyB3YXMgc3BlY2lmaWVkLCB0aGUKCSAqIG9iamVjdCB3aWxsIGNvbnRhaW4gdGhhdCB2YWx1ZSBhcyBhIGBzcmNgIHByb3BlcnR5LgoJICogQHBhcmFtIHtPYmplY3R9IHJlc3VsdCBUaGUgSFRNTCB0YWcgb3IgcGFyc2VkIHJlc3VsdCBvZiB0aGUgbG9hZGVkIGl0ZW0uCgkgKiBAcGFyYW0ge09iamVjdH0gcmF3UmVzdWx0IFRoZSB1bnByb2Nlc3NlZCByZXN1bHQsIHVzdWFsbHkgdGhlIHJhdyB0ZXh0IG9yIGJpbmFyeSBkYXRhIGJlZm9yZSBpdCBpcyBjb252ZXJ0ZWQKCSAqIHRvIGEgdXNhYmxlIG9iamVjdC4KCSAqIEBzaW5jZSAwLjMuMAoJICovCgoJLyoqCgkgKiBUaGlzIGV2ZW50IGlzIGZpcmVkIHdoZW4gYW4gYW4gaW5kaXZpZHVhbCBmaWxlIHByb2dyZXNzIGNoYW5nZXMuCgkgKiBAZXZlbnQgZmlsZXByb2dyZXNzCgkgKiBAcGFyYW0ge09iamVjdH0gVGhlIG9iamVjdCB0aGF0IGRpc3BhdGNoZWQgdGhlIGV2ZW50LgoJICogQHBhcmFtIHtTdHJpbmd9IHR5cGUgVGhlIGV2ZW50IHR5cGUuCgkgKiBAcGFyYW0ge09iamVjdH0gaXRlbSBUaGUgZmlsZSBpdGVtIHdoaWNoIHdhcyBzcGVjaWZpZWQgaW4gdGhlIHt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlL2xvYWRGaWxlIn19e3svY3Jvc3NMaW5rfX0KCSAqIG9yIHt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlL2xvYWRNYW5pZmVzdCJ9fXt7L2Nyb3NzTGlua319IGNhbGwuIElmIG9ubHkgYSBzdHJpbmcgcGF0aCBvciB0YWcgd2FzIHNwZWNpZmllZCwgdGhlCgkgKiBvYmplY3Qgd2lsbCBjb250YWluIHRoYXQgdmFsdWUgYXMgYSBgc3JjYCBwcm9wZXJ0eS4KCSAqIEBwYXJhbSB7TnVtYmVyfSBsb2FkZWQgVGhlIG51bWJlciBvZiBieXRlcyB0aGF0IGhhdmUgYmVlbiBsb2FkZWQuIE5vdGUgdGhhdCB0aGlzIG1heSBqdXN0IGJlIGEgcGVyY2VudGFnZSBvZiAxLgoJICogQHBhcmFtIHtOdW1iZXJ9IHRvdGFsIFRoZSB0b3RhbCBudW1iZXIgb2YgYnl0ZXMuIElmIGl0IGlzIHVua25vd24sIHRoZSB2YWx1ZSBpcyAxLgoJICogQHBhcmFtIHtOdW1iZXJ9IHByb2dyZXNzIFRoZSBhbW91bnQgdGhhdCBoYXMgYmVlbiBsb2FkZWQgYmV0d2VlbiAwIGFuZCAxLgoJICogQHNpbmNlIDAuMy4wCgkgKi8KCgkvKioKCSAqIFRoaXMgZXZlbnQgaXMgZmlyZWQgd2hlbiBhbiBpbmRpdmlkdWFsIGZpbGUgc3RhcnRzIHRvIGxvYWQuCgkgKiBAZXZlbnQgZmlsZXN0YXJ0CgkgKiBAcGFyYW0ge09iamVjdH0gVGhlIG9iamVjdCB0aGF0IGRpc3BhdGNoZWQgdGhlIGV2ZW50LgoJICogQHBhcmFtIHtTdHJpbmd9IHR5cGUgVGhlIGV2ZW50IHR5cGUuCgkgKiBAcGFyYW0ge09iamVjdH0gaXRlbSBUaGUgZmlsZSBpdGVtIHdoaWNoIHdhcyBzcGVjaWZpZWQgaW4gdGhlIHt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlL2xvYWRGaWxlIn19e3svY3Jvc3NMaW5rfX0KCSAqIG9yIHt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlL2xvYWRNYW5pZmVzdCJ9fXt7L2Nyb3NzTGlua319IGNhbGwuIElmIG9ubHkgYSBzdHJpbmcgcGF0aCBvciB0YWcgd2FzIHNwZWNpZmllZCwgdGhlCgkgKiBvYmplY3Qgd2lsbCBjb250YWluIHRoYXQgdmFsdWUgYXMgYSBwcm9wZXJ0eS4KCSAqLwoKCS8vVE9ETzogRGVwcmVjYXRlZAoJLyoqCgkgKiBSRU1PVkVELiBVc2Uge3sjY3Jvc3NMaW5rICJFdmVudERpc3BhdGNoZXIvYWRkRXZlbnRMaXN0ZW5lciJ9fXt7L2Nyb3NzTGlua319IGFuZCB0aGUge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvZmlsZWxvYWQ6ZXZlbnQifX17ey9jcm9zc0xpbmt9fQoJICogZXZlbnQuCgkgKiBAcHJvcGVydHkgb25GaWxlTG9hZAoJICogQHR5cGUge0Z1bmN0aW9ufQoJICogQGRlcHJlY2F0ZWQgVXNlIGFkZEV2ZW50TGlzdGVuZXIgYW5kIHRoZSAiZmlsZWxvYWQiIGV2ZW50LgoJICovCgkvKioKCSAqIFJFTU9WRUQuIFVzZSB7eyNjcm9zc0xpbmsgIkV2ZW50RGlzcGF0Y2hlci9hZGRFdmVudExpc3RlbmVyIn19e3svY3Jvc3NMaW5rfX0gYW5kIHRoZSB7eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZS9maWxlcHJvZ3Jlc3M6ZXZlbnQifX17ey9jcm9zc0xpbmt9fQoJICogZXZlbnQuCgkgKiBAcHJvcGVydHkgb25GaWxlUHJvZ3Jlc3MKCSAqIEB0eXBlIHtGdW5jdGlvbn0KCSAqIEBkZXByZWNhdGVkIFVzZSBhZGRFdmVudExpc3RlbmVyIGFuZCB0aGUgImZpbGVwcm9ncmVzcyIgZXZlbnQuCgkgKi8KCgovLyBQcm90ZWN0ZWQKCS8qKgoJICogQW4gb2JqZWN0IGhhc2ggb2YgY2FsbGJhY2tzIHRoYXQgYXJlIGZpcmVkIGZvciBlYWNoIGZpbGUgdHlwZSBiZWZvcmUgdGhlIGZpbGUgaXMgbG9hZGVkLCBnaXZpbmcgcGx1Z2lucyB0aGUKCSAqIGFiaWxpdHkgdG8gb3ZlcnJpZGUgcHJvcGVydGllcyBvZiB0aGUgbG9hZC4gUGxlYXNlIHNlZSB0aGUge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvaW5zdGFsbFBsdWdpbiJ9fXt7L2Nyb3NzTGlua319CgkgKiBtZXRob2QgZm9yIG1vcmUgaW5mb3JtYXRpb24uCgkgKiBAcHJvcGVydHkgX3R5cGVDYWxsYmFja3MKCSAqIEB0eXBlIHtPYmplY3R9CgkgKiBAcHJpdmF0ZQoJICovCglwLl90eXBlQ2FsbGJhY2tzID0gbnVsbDsKCgkvKioKCSAqIEFuIG9iamVjdCBoYXNoIG9mIGNhbGxiYWNrcyB0aGF0IGFyZSBmaXJlZCBmb3IgZWFjaCBmaWxlIGV4dGVuc2lvbiBiZWZvcmUgdGhlIGZpbGUgaXMgbG9hZGVkLCBnaXZpbmcgcGx1Z2lucyB0aGUKCSAqIGFiaWxpdHkgdG8gb3ZlcnJpZGUgcHJvcGVydGllcyBvZiB0aGUgbG9hZC4gUGxlYXNlIHNlZSB0aGUge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvaW5zdGFsbFBsdWdpbiJ9fXt7L2Nyb3NzTGlua319CgkgKiBtZXRob2QgZm9yIG1vcmUgaW5mb3JtYXRpb24uCgkgKiBAcHJvcGVydHkgX2V4dGVuc2lvbkNhbGxiYWNrcwoJICogQHR5cGUge251bGx9CgkgKiBAcHJpdmF0ZQoJICovCglwLl9leHRlbnNpb25DYWxsYmFja3MgPSBudWxsOwoKCS8qKgoJICogRGV0ZXJtaW5lcyBpZiB0aGUgbG9hZFN0YXJ0IGV2ZW50IHdhcyBkaXNwYXRjaGVkIGFscmVhZHkuIFRoaXMgZXZlbnQgaXMgb25seSBmaXJlZCBvbmUgdGltZSwgd2hlbiB0aGUgZmlyc3QKCSAqIGZpbGUgaXMgcmVxdWVzdGVkLgoJICogQHByb3BlcnR5IF9sb2FkU3RhcnRXYXNEaXNwYXRjaGVkCgkgKiBAdHlwZSB7Qm9vbGVhbn0KCSAqIEBkZWZhdWx0IGZhbHNlCgkgKiBAcHJpdmF0ZQoJICovCglwLl9sb2FkU3RhcnRXYXNEaXNwYXRjaGVkID0gZmFsc2U7CgoJLyoqCgkgKiBUaGUgbnVtYmVyIG9mIG1heGltdW0gb3BlbiBjb25uZWN0aW9ucyB0aGF0IGEgbG9hZFF1ZXVlIHRyaWVzIHRvIG1haW50YWluLiBQbGVhc2Ugc2VlCgkgKiB7eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZS9zZXRNYXhDb25uZWN0aW9ucyJ9fXt7L2Nyb3NzTGlua319IGZvciBtb3JlIGluZm9ybWF0aW9uLgoJICogQHByb3BlcnR5IF9tYXhDb25uZWN0aW9ucwoJICogQHR5cGUge051bWJlcn0KCSAqIEBkZWZhdWx0IDEKCSAqIEBwcml2YXRlCgkgKi8KCXAuX21heENvbm5lY3Rpb25zID0gMTsKCgkvKioKCSAqIERldGVybWluZXMgaWYgdGhlcmUgaXMgY3VycmVudGx5IGEgc2NyaXB0IGxvYWRpbmcuIFRoaXMgaGVscHMgZW5zdXJlIHRoYXQgb25seSBhIHNpbmdsZSBzY3JpcHQgbG9hZHMgYXQgb25jZSB3aGVuCgkgKiB1c2luZyBhIHNjcmlwdCB0YWcgdG8gZG8gcHJlbG9hZGluZy4KCSAqIEBwcm9wZXJ0eSBfY3VycmVudGx5TG9hZGluZ1NjcmlwdAoJICogQHR5cGUge0Jvb2xlYW59CgkgKiBAcHJpdmF0ZQoJICovCglwLl9jdXJyZW50bHlMb2FkaW5nU2NyaXB0ID0gbnVsbDsKCgkvKioKCSAqIEFuIGFycmF5IGNvbnRhaW5pbmcgdGhlIGN1cnJlbnRseSBkb3dubG9hZGluZyBmaWxlcy4KCSAqIEBwcm9wZXJ0eSBfY3VycmVudExvYWRzCgkgKiBAdHlwZSB7QXJyYXl9CgkgKiBAcHJpdmF0ZQoJICovCglwLl9jdXJyZW50TG9hZHMgPSBudWxsOwoKCS8qKgoJICogQW4gYXJyYXkgY29udGFpbmluZyB0aGUgcXVldWVkIGl0ZW1zIHRoYXQgaGF2ZSBub3QgeWV0IHN0YXJ0ZWQgZG93bmxvYWRpbmcuCgkgKiBAcHJvcGVydHkgX2xvYWRRdWV1ZQoJICogQHR5cGUge0FycmF5fQoJICogQHByaXZhdGUKCSAqLwoJcC5fbG9hZFF1ZXVlID0gbnVsbDsKCgkvKioKCSAqIEFuIGFycmF5IGNvbnRhaW5pbmcgZG93bmxvYWRzIHRoYXQgaGF2ZSBub3QgY29tcGxldGVkLCBzbyB0aGF0IHRoZSBMb2FkUXVldWUgY2FuIGJlIHByb3Blcmx5IHJlc2V0LgoJICogQHByb3BlcnR5IF9sb2FkUXVldWVCYWNrdXAKCSAqIEB0eXBlIHtBcnJheX0KCSAqIEBwcml2YXRlCgkgKi8KCXAuX2xvYWRRdWV1ZUJhY2t1cCA9IG51bGw7CgoJLyoqCgkgKiBBbiBvYmplY3QgaGFzaCBvZiBpdGVtcyB0aGF0IGhhdmUgZmluaXNoZWQgZG93bmxvYWRpbmcsIGluZGV4ZWQgYnkgaXRlbSBJRHMuCgkgKiBAcHJvcGVydHkgX2xvYWRJdGVtc0J5SWQKCSAqIEB0eXBlIHtPYmplY3R9CgkgKiBAcHJpdmF0ZQoJICovCglwLl9sb2FkSXRlbXNCeUlkID0gbnVsbDsKCgkvKioKCSAqIEFuIG9iamVjdCBoYXNoIG9mIGl0ZW1zIHRoYXQgaGF2ZSBmaW5pc2hlZCBkb3dubG9hZGluZywgaW5kZXhlZCBieSBpdGVtIHNvdXJjZS4KCSAqIEBwcm9wZXJ0eSBfbG9hZEl0ZW1zQnlTcmMKCSAqIEB0eXBlIHtPYmplY3R9CgkgKiBAcHJpdmF0ZQoJICovCglwLl9sb2FkSXRlbXNCeVNyYyA9IG51bGw7CgoJLyoqCgkgKiBBbiBvYmplY3QgaGFzaCBvZiBsb2FkZWQgaXRlbXMsIGluZGV4ZWQgYnkgdGhlIElEIG9mIHRoZSBsb2FkIGl0ZW0uCgkgKiBAcHJvcGVydHkgX2xvYWRlZFJlc3VsdHMKCSAqIEB0eXBlIHtPYmplY3R9CgkgKiBAcHJpdmF0ZQoJICovCglwLl9sb2FkZWRSZXN1bHRzID0gbnVsbDsKCgkvKioKCSAqIEFuIG9iamVjdCBoYXNoIG9mIHVuLXBhcnNlZCBsb2FkZWQgaXRlbXMsIGluZGV4ZWQgYnkgdGhlIElEIG9mIHRoZSBsb2FkIGl0ZW0uCgkgKiBAcHJvcGVydHkgX2xvYWRlZFJhd1Jlc3VsdHMKCSAqIEB0eXBlIHtPYmplY3R9CgkgKiBAcHJpdmF0ZQoJICovCglwLl9sb2FkZWRSYXdSZXN1bHRzID0gbnVsbDsKCgkvKioKCSAqIFRoZSBudW1iZXIgb2YgaXRlbXMgdGhhdCBoYXZlIGJlZW4gcmVxdWVzdGVkLiBUaGlzIGhlbHBzIG1hbmFnZSBhbiBvdmVyYWxsIHByb2dyZXNzIHdpdGhvdXQga25vd2luZyBob3cgbGFyZ2UKCSAqIHRoZSBmaWxlcyBhcmUgYmVmb3JlIHRoZXkgYXJlIGRvd25sb2FkZWQuCgkgKiBAcHJvcGVydHkgX251bUl0ZW1zCgkgKiBAdHlwZSB7TnVtYmVyfQoJICogQGRlZmF1bHQgMAoJICogQHByaXZhdGUKCSAqLwoJcC5fbnVtSXRlbXMgPSAwOwoKCS8qKgoJICogVGhlIG51bWJlciBvZiBpdGVtcyB0aGF0IGhhdmUgY29tcGxldGVkIGxvYWRlZC4gVGhpcyBoZWxwcyBtYW5hZ2UgYW4gb3ZlcmFsbCBwcm9ncmVzcyB3aXRob3V0IGtub3dpbmcgaG93IGxhcmdlCgkgKiB0aGUgZmlsZXMgYXJlIGJlZm9yZSB0aGV5IGFyZSBkb3dubG9hZGVkLgoJICogQHByb3BlcnR5IF9udW1JdGVtc0xvYWRlZAoJICogQHR5cGUge051bWJlcn0KCSAqIEBkZWZhdWx0IDAKCSAqIEBwcml2YXRlCgkgKi8KCXAuX251bUl0ZW1zTG9hZGVkID0gMDsKCgkvKioKCSAqIEEgbGlzdCBvZiBzY3JpcHRzIGluIHRoZSBvcmRlciB0aGV5IHdlcmUgcmVxdWVzdGVkLiBUaGlzIGhlbHBzIGVuc3VyZSB0aGF0IHNjcmlwdHMgYXJlICJjb21wbGV0ZWQiIGluIHRoZSByaWdodAoJICogb3JkZXIuCgkgKiBAcHJvcGVydHkgX3NjcmlwdE9yZGVyCgkgKiBAdHlwZSB7QXJyYXl9CgkgKiBAcHJpdmF0ZQoJICovCglwLl9zY3JpcHRPcmRlciA9IG51bGw7CgoJLyoqCgkgKiBBIGxpc3Qgb2Ygc2NyaXB0cyB0aGF0IGhhdmUgYmVlbiBsb2FkZWQuIEl0ZW1zIGFyZSBhZGRlZCB0byB0aGlzIGxpc3QgYXMgPGNvZGU+bnVsbDwvY29kZT4gd2hlbiB0aGV5IGFyZQoJICogcmVxdWVzdGVkLCBjb250YWluIHRoZSBsb2FkZWQgaXRlbSBpZiBpdCBoYXMgY29tcGxldGVkLCBidXQgbm90IGJlZW4gZGlzcGF0Y2hlZCB0byB0aGUgdXNlciwgYW5kIDxjb2RlPnRydWU8L3RydWU+CgkgKiBvbmNlIHRoZXkgYXJlIGNvbXBsZXRlIGFuZCBoYXZlIGJlZW4gZGlzcGF0Y2hlZC4KCSAqIEBwcm9wZXJ0eSBfbG9hZGVkU2NyaXB0cwoJICogQHR5cGUge0FycmF5fQoJICogQHByaXZhdGUKCSAqLwoJcC5fbG9hZGVkU2NyaXB0cyA9IG51bGw7CgoJLy8gT3ZlcnJpZGVzIGFic3RyYWN0IG1ldGhvZCBpbiBBYnN0cmFjdExvYWRlcgoJcC5pbml0ID0gZnVuY3Rpb24odXNlWEhSLCBiYXNlUGF0aCwgY3Jvc3NPcmlnaW4pIHsKCQl0aGlzLl9udW1JdGVtcyA9IHRoaXMuX251bUl0ZW1zTG9hZGVkID0gMDsKCQl0aGlzLl9wYXVzZWQgPSBmYWxzZTsKCQl0aGlzLl9sb2FkU3RhcnRXYXNEaXNwYXRjaGVkID0gZmFsc2U7CgoJCXRoaXMuX2N1cnJlbnRMb2FkcyA9IFtdOwoJCXRoaXMuX2xvYWRRdWV1ZSA9IFtdOwoJCXRoaXMuX2xvYWRRdWV1ZUJhY2t1cCA9IFtdOwoJCXRoaXMuX3NjcmlwdE9yZGVyID0gW107CgkJdGhpcy5fbG9hZGVkU2NyaXB0cyA9IFtdOwoJCXRoaXMuX2xvYWRJdGVtc0J5SWQgPSB7fTsKCQl0aGlzLl9sb2FkSXRlbXNCeVNyYyA9IHt9OwoJCXRoaXMuX2xvYWRlZFJlc3VsdHMgPSB7fTsKCQl0aGlzLl9sb2FkZWRSYXdSZXN1bHRzID0ge307CgoJCS8vIENhbGxiYWNrcyBmb3IgcGx1Z2lucwoJCXRoaXMuX3R5cGVDYWxsYmFja3MgPSB7fTsKCQl0aGlzLl9leHRlbnNpb25DYWxsYmFja3MgPSB7fTsKCgkJdGhpcy5fYmFzZVBhdGggPSBiYXNlUGF0aDsKCQl0aGlzLnNldFVzZVhIUih1c2VYSFIpOwoJCXRoaXMuX2Nyb3NzT3JpZ2luID0gKGNyb3NzT3JpZ2luID09PSB0cnVlKQoJCQkJPyAiQW5vbnltb3VzIiA6IChjcm9zc09yaWdpbiA9PT0gZmFsc2UgfHwgY3Jvc3NPcmlnaW4gPT0gbnVsbCkKCQkJCT8gIiIgOiBjcm9zc09yaWdpbjsKCX07CgoJLyoqCgkgKiBDaGFuZ2UgdGhlIHVzWEhSIHZhbHVlLiBOb3RlIHRoYXQgaWYgdGhpcyBpcyBzZXQgdG8gdHJ1ZSwgaXQgbWF5IGZhaWwgZGVwZW5kaW5nIG9uIHRoZSBicm93c2VyJ3MgY2FwYWJpbGl0aWVzLgoJICogQWRkaXRpb25hbGx5LCBzb21lIGZpbGVzIHJlcXVpcmUgWEhSIGluIG9yZGVyIHRvIGxvYWQsIHN1Y2ggYXMgSlNPTiAod2l0aG91dCBKU09OUCksIFRleHQsIGFuZCBYTUwsIHNvIFhIUiB3aWxsCgkgKiBiZSB1c2VkIHJlZ2FyZGxlc3Mgb2Ygd2hhdCBpcyBwYXNzZWQgdG8gdGhpcyBtZXRob2QuCgkgKiBAbWV0aG9kIHNldFVzZVhIUgoJICogQHBhcmFtIHtCb29sZWFufSB2YWx1ZSBUaGUgbmV3IHVzZVhIUiB2YWx1ZSB0byBzZXQuCgkgKiBAcmV0dXJuIHtCb29sZWFufSBUaGUgbmV3IHVzZVhIUiB2YWx1ZS4gSWYgWEhSIGlzIG5vdCBzdXBwb3J0ZWQgYnkgdGhlIGJyb3dzZXIsIHRoaXMgd2lsbCByZXR1cm4gZmFsc2UsIGV2ZW4gaWYKCSAqIHRoZSBwcm92aWRlZCB2YWx1ZSBhcmd1bWVudCB3YXMgdHJ1ZS4KCSAqIEBzaW5jZSAwLjMuMAoJICovCglwLnNldFVzZVhIUiA9IGZ1bmN0aW9uKHZhbHVlKSB7CgkJLy8gRGV0ZXJtaW5lIGlmIHdlIGNhbiB1c2UgWEhSLiBYSFIgZGVmYXVsdHMgdG8gVFJVRSwgYnV0IHRoZSBicm93c2VyIG1heSBub3Qgc3VwcG9ydCBpdC4KCQkvL1RPRE86IFNob3VsZCB3ZSBiZSBjaGVja2luZyBmb3IgdGhlIG90aGVyIFhIUiB0eXBlcz8gTWlnaHQgaGF2ZSB0byBkbyBhIHRyeS9jYXRjaCBvbiB0aGUgZGlmZmVyZW50IHR5cGVzIHNpbWlsYXIgdG8gY3JlYXRlWEhSLgoJCXRoaXMudXNlWEhSID0gKHZhbHVlICE9IGZhbHNlICYmIHdpbmRvdy5YTUxIdHRwUmVxdWVzdCAhPSBudWxsKTsKCQlyZXR1cm4gdGhpcy51c2VYSFI7Cgl9OwoKCS8qKgoJICogU3RvcHMgYWxsIHF1ZXVlZCBhbmQgbG9hZGluZyBpdGVtcywgYW5kIGNsZWFycyB0aGUgcXVldWUuIFRoaXMgYWxzbyByZW1vdmVzIGFsbCBpbnRlcm5hbCByZWZlcmVuY2VzIHRvIGxvYWRlZAoJICogY29udGVudCwgYW5kIGFsbG93cyB0aGUgcXVldWUgdG8gYmUgdXNlZCBhZ2Fpbi4KCSAqIEBtZXRob2QgcmVtb3ZlQWxsCgkgKiBAc2luY2UgMC4zLjAKCSAqLwoJcC5yZW1vdmVBbGwgPSBmdW5jdGlvbigpIHsKCQl0aGlzLnJlbW92ZSgpOwoJfTsKCgkvKioKCSAqIFN0b3BzIGFuIGl0ZW0gZnJvbSBiZWluZyBsb2FkZWQsIGFuZCByZW1vdmVzIGl0IGZyb20gdGhlIHF1ZXVlLiBJZiBub3RoaW5nIGlzIHBhc3NlZCwgYWxsIGl0ZW1zIGFyZSByZW1vdmVkLgoJICogVGhpcyBhbHNvIHJlbW92ZXMgaW50ZXJuYWwgcmVmZXJlbmNlcyB0byBsb2FkZWQgaXRlbShzKS4KCSAqCgkgKiA8aDQ+RXhhbXBsZTwvaDQ+CgkgKgoJICogICAgICBxdWV1ZS5sb2FkTWFuaWZlc3QoWwoJICogICAgICAgICAge3NyYzoidGVzdC5wbmciLCBpZDoicG5nIn0sCgkgKiAgICAgICAgICB7c3JjOiJ0ZXN0LmpwZyIsIGlkOiJqcGcifSwKCSAqICAgICAgICAgIHtzcmM6InRlc3QubXAzIiwgaWQ6Im1wMyJ9CgkgKiAgICAgIF0pOwoJICogICAgICBxdWV1ZS5yZW1vdmUoInBuZyIpOyAvLyBTaW5nbGUgaXRlbSBieSBJRAoJICogICAgICBxdWV1ZS5yZW1vdmUoInBuZyIsICJ0ZXN0LmpwZyIpOyAvLyBJdGVtcyBhcyBhcmd1bWVudHMuIE1peGVkIGlkIGFuZCBzcmMuCgkgKiAgICAgIHF1ZXVlLnJlbW92ZShbInRlc3QucG5nIiwgImpwZyJdKTsgLy8gSXRlbXMgaW4gYW4gQXJyYXkuIE1peGVkIGlkIGFuZCBzcmMuCgkgKgoJICogQG1ldGhvZCByZW1vdmUKCSAqIEBwYXJhbSB7U3RyaW5nIHwgQXJyYXl9IGlkc09yVXJscyogVGhlIGlkIG9yIGlkcyB0byByZW1vdmUgZnJvbSB0aGlzIHF1ZXVlLiBZb3UgY2FuIHBhc3MgYW4gaXRlbSwgYW4gYXJyYXkgb2YKCSAqIGl0ZW1zLCBvciBtdWx0aXBsZSBpdGVtcyBhcyBhcmd1bWVudHMuCgkgKiBAc2luY2UgMC4zLjAKCSAqLwoJcC5yZW1vdmUgPSBmdW5jdGlvbihpZHNPclVybHMpIHsKCQl2YXIgYXJncyA9IG51bGw7CgoJCWlmIChpZHNPclVybHMgJiYgIShpZHNPclVybHMgaW5zdGFuY2VvZiBBcnJheSkpIHsKCQkJYXJncyA9IFtpZHNPclVybHNdOwoJCX0gZWxzZSBpZiAoaWRzT3JVcmxzKSB7CgkJCWFyZ3MgPSBpZHNPclVybHM7CgkJfSBlbHNlIGlmIChhcmd1bWVudHMubGVuZ3RoID4gMCkgewoJCQlyZXR1cm47CgkJfQoKCQl2YXIgaXRlbXNXZXJlUmVtb3ZlZCA9IGZhbHNlOwoKCQkvLyBEZXN0cm95IGV2ZXJ5dGhpbmcKCQlpZiAoIWFyZ3MpIHsKCQkJdGhpcy5jbG9zZSgpOwoJCQlmb3IgKHZhciBuIGluIHRoaXMuX2xvYWRJdGVtc0J5SWQpIHsKCQkJCXRoaXMuX2Rpc3Bvc2VJdGVtKHRoaXMuX2xvYWRJdGVtc0J5SWRbbl0pOwoJCQl9CgkJCXRoaXMuaW5pdCh0aGlzLnVzZVhIUik7CgoJCS8vIFJlbW92ZSBzcGVjaWZpYyBpdGVtcwoJCX0gZWxzZSB7CgkJCXdoaWxlIChhcmdzLmxlbmd0aCkgewoJCQkJdmFyIGl0ZW0gPSBhcmdzLnBvcCgpOwoJCQkJdmFyIHIgPSB0aGlzLmdldFJlc3VsdChpdGVtKTsKCgkJCQkvL1JlbW92ZSBmcm9tIHRoZSBtYWluIGxvYWQgUXVldWUKCQkJCWZvciAoaSA9IHRoaXMuX2xvYWRRdWV1ZS5sZW5ndGgtMTtpPj0wO2ktLSkgewoJCQkJCWxvYWRJdGVtID0gdGhpcy5fbG9hZFF1ZXVlW2ldLmdldEl0ZW0oKTsKCQkJCQlpZiAobG9hZEl0ZW0uaWQgPT0gaXRlbSB8fCBsb2FkSXRlbS5zcmMgPT0gaXRlbSkgewoJCQkJCQl0aGlzLl9sb2FkUXVldWUuc3BsaWNlKGksMSlbMF0uY2FuY2VsKCk7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCQkJCX0KCgkJCQkvL1JlbW92ZSBmcm9tIHRoZSBiYWNrdXAgcXVldWUKCQkJCWZvciAoaSA9IHRoaXMuX2xvYWRRdWV1ZUJhY2t1cC5sZW5ndGgtMTtpPj0wO2ktLSkgewoJCQkJCWxvYWRJdGVtID0gdGhpcy5fbG9hZFF1ZXVlQmFja3VwW2ldLmdldEl0ZW0oKTsKCQkJCQlpZiAobG9hZEl0ZW0uaWQgPT0gaXRlbSB8fCBsb2FkSXRlbS5zcmMgPT0gaXRlbSkgewoJCQkJCQl0aGlzLl9sb2FkUXVldWVCYWNrdXAuc3BsaWNlKGksMSlbMF0uY2FuY2VsKCk7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCQkJCX0KCgkJCQlpZiAocikgewoJCQkJCWRlbGV0ZSB0aGlzLl9sb2FkSXRlbXNCeUlkW3IuaWRdOwoJCQkJCWRlbGV0ZSB0aGlzLl9sb2FkSXRlbXNCeVNyY1tyLnNyY107CgkJCQkJdGhpcy5fZGlzcG9zZUl0ZW0ocik7CgkJCQl9IGVsc2UgewoJCQkJCWZvciAodmFyIGk9dGhpcy5fY3VycmVudExvYWRzLmxlbmd0aC0xO2k+PTA7aS0tKSB7CgkJCQkJCXZhciBsb2FkSXRlbSA9IHRoaXMuX2N1cnJlbnRMb2Fkc1tpXS5nZXRJdGVtKCk7CgkJCQkJCWlmIChsb2FkSXRlbS5pZCA9PSBpdGVtIHx8IGxvYWRJdGVtLnNyYyA9PSBpdGVtKSB7CgkJCQkJCQl0aGlzLl9jdXJyZW50TG9hZHMuc3BsaWNlKGksMSlbMF0uY2FuY2VsKCk7CgkJCQkJCQlpdGVtc1dlcmVSZW1vdmVkID0gdHJ1ZTsKCQkJCQkJCWJyZWFrOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgoJCQkvLyBJZiB0aGlzIHdhcyBjYWxsZWQgZHVyaW5nIGEgbG9hZCwgdHJ5IHRvIGxvYWQgdGhlIG5leHQgaXRlbS4KCQkJaWYgKGl0ZW1zV2VyZVJlbW92ZWQpIHsKCQkJCXRoaXMuX2xvYWROZXh0KCk7CgkJCX0KCQl9Cgl9OwoKCS8qKgoJICogU3RvcHMgYWxsIG9wZW4gbG9hZHMsIGRlc3Ryb3lzIGFueSBsb2FkZWQgaXRlbXMsIGFuZCByZXNldHMgdGhlIHF1ZXVlLCBzbyBhbGwgaXRlbXMgY2FuCgkgKiBiZSByZWxvYWRlZCBhZ2FpbiBieSBjYWxsaW5nIHt7I2Nyb3NzTGluayAiQWJzdHJhY3RMb2FkZXIvbG9hZCJ9fXt7L2Nyb3NzTGlua319LiBJdGVtcyBhcmUgbm90IHJlbW92ZWQgZnJvbSB0aGUKCSAqIHF1ZXVlLiBUbyByZW1vdmUgaXRlbXMgdXNlIHRoZSB7eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZS9yZW1vdmUifX17ey9jcm9zc0xpbmt9fSBvcgoJICoge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvcmVtb3ZlQWxsIn19e3svY3Jvc3NMaW5rfX0gbWV0aG9kLgoJICogQG1ldGhvZCByZXNldAoJICogQHNpbmNlIDAuMy4wCgkgKi8KCXAucmVzZXQgPSBmdW5jdGlvbigpIHsKCQl0aGlzLmNsb3NlKCk7CgkJZm9yICh2YXIgbiBpbiB0aGlzLl9sb2FkSXRlbXNCeUlkKSB7CgkJCXRoaXMuX2Rpc3Bvc2VJdGVtKHRoaXMuX2xvYWRJdGVtc0J5SWRbbl0pOwoJCX0KCgkJLy9SZXNldCB0aGUgcXVldWUgdG8gaXRzIHN0YXJ0IHN0YXRlCgkJdmFyIGEgPSBbXTsKCQlmb3IgKHZhciBpPTAsIGw9dGhpcy5fbG9hZFF1ZXVlQmFja3VwLmxlbmd0aDsgaTxsOyBpKyspIHsKCQkJYS5wdXNoKHRoaXMuX2xvYWRRdWV1ZUJhY2t1cFtpXS5nZXRJdGVtKCkpOwoJCX0KCgkJdGhpcy5sb2FkTWFuaWZlc3QoYSwgZmFsc2UpOwoJfTsKCgkvKioKCSAqIERldGVybWluZSBpZiBhIHNwZWNpZmljIHR5cGUgc2hvdWxkIGJlIGxvYWRlZCBhcyBhIGJpbmFyeSBmaWxlLiBDdXJyZW50bHksIG9ubHkgaW1hZ2VzIGFuZCBpdGVtcyBtYXJrZWQKCSAqIHNwZWNpZmljYWxseSBhcyAiYmluYXJ5IiBhcmUgbG9hZGVkIGFzIGJpbmFyeS4gTm90ZSB0aGF0IGF1ZGlvIGlzIDxiPm5vdDwvYj4gYSBiaW5hcnkgdHlwZSwgYXMgd2UgY2FuIG5vdCBwbGF5CgkgKiBiYWNrIHVzaW5nIGFuIGF1ZGlvIHRhZyBpZiBpdCBpcyBsb2FkZWQgYXMgYmluYXJ5LiBQbHVnaW5zIGNhbiBjaGFuZ2UgdGhlIGl0ZW0gdHlwZSB0byBiaW5hcnkgdG8gZW5zdXJlIHRoZXkgZ2V0CgkgKiBhIGJpbmFyeSByZXN1bHQgdG8gd29yayB3aXRoLiBCaW5hcnkgZmlsZXMgYXJlIGxvYWRlZCB1c2luZyBYSFIyLgoJICogQG1ldGhvZCBpc0JpbmFyeQoJICogQHBhcmFtIHtTdHJpbmd9IHR5cGUgVGhlIGl0ZW0gdHlwZS4KCSAqIEByZXR1cm4ge0Jvb2xlYW59IElmIHRoZSBzcGVjaWZpZWQgdHlwZSBpcyBiaW5hcnkuCgkgKiBAcHJpdmF0ZQoJICovCglzLmlzQmluYXJ5ID0gZnVuY3Rpb24odHlwZSkgewoJCXN3aXRjaCAodHlwZSkgewoJCQljYXNlIGNyZWF0ZWpzLkxvYWRRdWV1ZS5JTUFHRToKCQkJY2FzZSBjcmVhdGVqcy5Mb2FkUXVldWUuQklOQVJZOgoJCQkJcmV0dXJuIHRydWU7CgkJCWRlZmF1bHQ6CgkJCQlyZXR1cm4gZmFsc2U7CgkJfQoJfTsKCgoJLyoqCgkgKiBEZXRlcm1pbmUgaWYgYSBzcGVjaWZpYyB0eXBlIGlzIGEgdGV4dCBiYXNlZCBhc3NldCwgYW5kIHNob3VsZCBiZSBsb2FkZWQgYXMgVVRGLTguCgkgKiBAbWV0aG9kIGlzVGV4dAoJICogQHBhcmFtIHtTdHJpbmd9IHR5cGUgVGhlIGl0ZW0gdHlwZS4KCSAqIEByZXR1cm4ge0Jvb2xlYW59IElmIHRoZSBzcGVjaWZpZWQgdHlwZSBpcyB0ZXh0LgoJICogQHByaXZhdGUKCSAqLwoJcy5pc1RleHQgPSBmdW5jdGlvbih0eXBlKSB7CgkJc3dpdGNoICh0eXBlKSB7CgkJCWNhc2UgY3JlYXRlanMuTG9hZFF1ZXVlLlRFWFQ6CgkJCWNhc2UgY3JlYXRlanMuTG9hZFF1ZXVlLkpTT046CgkJCWNhc2UgY3JlYXRlanMuTG9hZFF1ZXVlLk1BTklGRVNUOgoJCQljYXNlIGNyZWF0ZWpzLkxvYWRRdWV1ZS5YTUw6CgkJCWNhc2UgY3JlYXRlanMuTG9hZFF1ZXVlLkhUTUw6CgkJCWNhc2UgY3JlYXRlanMuTG9hZFF1ZXVlLkNTUzoKCQkJY2FzZSBjcmVhdGVqcy5Mb2FkUXVldWUuU1ZHOgoJCQljYXNlIGNyZWF0ZWpzLkxvYWRRdWV1ZS5KQVZBU0NSSVBUOgoJCQkJcmV0dXJuIHRydWU7CgkJCWRlZmF1bHQ6CgkJCQlyZXR1cm4gZmFsc2U7CgkJfQoJfTsKCgkvKioKCSAqIFJlZ2lzdGVyIGEgcGx1Z2luLiBQbHVnaW5zIGNhbiBtYXAgdG8gbG9hZCB0eXBlcyAoc291bmQsIGltYWdlLCBldGMpLCBvciBzcGVjaWZpYyBleHRlbnNpb25zIChwbmcsIG1wMywgZXRjKS4KCSAqIEN1cnJlbnRseSwgb25seSBvbmUgcGx1Z2luIGNhbiBleGlzdCBwZXIgdHlwZS9leHRlbnNpb24uCgkgKgoJICogV2hlbiBhIHBsdWdpbiBpcyBpbnN0YWxsZWQsIGEgPGNvZGU+Z2V0UHJlbG9hZEhhbmRsZXJzKCk8L2NvZGU+IG1ldGhvZCB3aWxsIGJlIGNhbGxlZCBvbiBpdC4gRm9yIG1vcmUgaW5mb3JtYXRpb24KCSAqIG9uIHRoaXMgbWV0aG9kLCBjaGVjayBvdXQgdGhlIHt7I2Nyb3NzTGluayAiU2FtcGxlUGx1Z2luL2dldFByZWxvYWRIYW5kbGVycyJ9fXt7L2Nyb3NzTGlua319IG1ldGhvZCBpbiB0aGUKCSAqIHt7I2Nyb3NzTGluayAiU2FtcGxlUGx1Z2luIn19e3svY3Jvc3NMaW5rfX0gY2xhc3MuCgkgKgoJICogQmVmb3JlIGEgZmlsZSBpcyBsb2FkZWQsIGEgbWF0Y2hpbmcgcGx1Z2luIGhhcyBhbiBvcHBvcnR1bml0eSB0byBtb2RpZnkgdGhlIGxvYWQuIElmIGEgYGNhbGxiYWNrYCBpcyByZXR1cm5lZAoJICogZnJvbSB0aGUge3sjY3Jvc3NMaW5rICJTYW1wbGVQbHVnaW4vZ2V0UHJlbG9hZEhhbmRsZXJzIn19e3svY3Jvc3NMaW5rfX0gbWV0aG9kLCBpdCB3aWxsIGJlIGludm9rZWQgZmlyc3QsIGFuZCBpdHMKCSAqIHJlc3VsdCBtYXkgY2FuY2VsIG9yIG1vZGlmeSB0aGUgaXRlbS4gVGhlIGNhbGxiYWNrIG1ldGhvZCBjYW4gYWxzbyByZXR1cm4gYSBgY29tcGxldGVIYW5kbGVyYCB0byBiZSBmaXJlZCB3aGVuCgkgKiB0aGUgZmlsZSBpcyBsb2FkZWQsIG9yIGEgYHRhZ2Agb2JqZWN0LCB3aGljaCB3aWxsIG1hbmFnZSB0aGUgYWN0dWFsIGRvd25sb2FkLiBGb3IgbW9yZSBpbmZvcm1hdGlvbiBvbiB0aGVzZQoJICogbWV0aG9kcywgY2hlY2sgb3V0IHRoZSB7eyNjcm9zc0xpbmsgIlNhbXBsZVBsdWdpbi9wcmVsb2FkSGFuZGxlciJ9fXt7L2Nyb3NzTGlua319IGFuZCB7eyNjcm9zc0xpbmsgIlNhbXBsZVBsdWdpbi9maWxlTG9hZEhhbmRsZXIifX17ey9jcm9zc0xpbmt9fQoJICogbWV0aG9kcyBvbiB0aGUge3sjY3Jvc3NMaW5rICJTYW1wbGVQbHVnaW4ifX17ey9jcm9zc0xpbmt9fS4KCSAqCgkgKiBAbWV0aG9kIGluc3RhbGxQbHVnaW4KCSAqIEBwYXJhbSB7RnVuY3Rpb259IHBsdWdpbiBUaGUgcGx1Z2luIGNsYXNzIHRvIGluc3RhbGwuCgkgKi8KCXAuaW5zdGFsbFBsdWdpbiA9IGZ1bmN0aW9uKHBsdWdpbikgewoJCWlmIChwbHVnaW4gPT0gbnVsbCB8fCBwbHVnaW4uZ2V0UHJlbG9hZEhhbmRsZXJzID09IG51bGwpIHsgcmV0dXJuOyB9CgkJdmFyIG1hcCA9IHBsdWdpbi5nZXRQcmVsb2FkSGFuZGxlcnMoKTsKCQltYXAuc2NvcGUgPSBwbHVnaW47CgoJCWlmIChtYXAudHlwZXMgIT0gbnVsbCkgewoJCQlmb3IgKHZhciBpPTAsIGw9bWFwLnR5cGVzLmxlbmd0aDsgaTxsOyBpKyspIHsKCQkJCXRoaXMuX3R5cGVDYWxsYmFja3NbbWFwLnR5cGVzW2ldXSA9IG1hcDsKCQkJfQoJCX0KCQlpZiAobWFwLmV4dGVuc2lvbnMgIT0gbnVsbCkgewoJCQlmb3IgKGk9MCwgbD1tYXAuZXh0ZW5zaW9ucy5sZW5ndGg7IGk8bDsgaSsrKSB7CgkJCQl0aGlzLl9leHRlbnNpb25DYWxsYmFja3NbbWFwLmV4dGVuc2lvbnNbaV1dID0gbWFwOwoJCQl9CgkJfQoJfTsKCgkvKioKCSAqIFNldCB0aGUgbWF4aW11bSBudW1iZXIgb2YgY29uY3VycmVudCBjb25uZWN0aW9ucy4gTm90ZSB0aGF0IGJyb3dzZXJzIGFuZCBzZXJ2ZXJzIG1heSBoYXZlIGEgYnVpbHQtaW4gbWF4aW11bQoJICogbnVtYmVyIG9mIG9wZW4gY29ubmVjdGlvbnMsIHNvIGFueSBhZGRpdGlvbmFsIGNvbm5lY3Rpb25zIG1heSByZW1haW4gaW4gYSBwZW5kaW5nIHN0YXRlIHVudGlsIHRoZSBicm93c2VyCgkgKiBvcGVucyB0aGUgY29ubmVjdGlvbi4gV2hlbiBsb2FkaW5nIHNjcmlwdHMgdXNpbmcgdGFncywgYW5kIHdoZW4ge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvbWFpbnRhaW5TY3JpcHRPcmRlcjpwcm9wZXJ0eSJ9fXt7L2Nyb3NzTGlua319CgkgKiBpcyBgdHJ1ZWAsIG9ubHkgb25lIHNjcmlwdCBpcyBsb2FkZWQgYXQgYSB0aW1lIGR1ZSB0byBicm93c2VyIGxpbWl0YXRpb25zLgoJICoKCSAqIDxoND5FeGFtcGxlPC9oND4KCSAqCgkgKiAgICAgIHZhciBxdWV1ZSA9IG5ldyBjcmVhdGVqcy5Mb2FkUXVldWUoKTsKCSAqICAgICAgcXVldWUuc2V0TWF4Q29ubmVjdGlvbnMoMTApOyAvLyBBbGxvdyAxMCBjb25jdXJyZW50IGxvYWRzCgkgKgoJICogQG1ldGhvZCBzZXRNYXhDb25uZWN0aW9ucwoJICogQHBhcmFtIHtOdW1iZXJ9IHZhbHVlIFRoZSBudW1iZXIgb2YgY29uY3VycmVudCBsb2FkcyB0byBhbGxvdy4gQnkgZGVmYXVsdCwgb25seSBhIHNpbmdsZSBjb25uZWN0aW9uIHBlciBMb2FkUXVldWUKCSAqIGlzIG9wZW4gYXQgYW55IHRpbWUuCgkgKi8KCXAuc2V0TWF4Q29ubmVjdGlvbnMgPSBmdW5jdGlvbiAodmFsdWUpIHsKCQl0aGlzLl9tYXhDb25uZWN0aW9ucyA9IHZhbHVlOwoJCWlmICghdGhpcy5fcGF1c2VkICYmIHRoaXMuX2xvYWRRdWV1ZS5sZW5ndGggPiAwKSB7CgkJCXRoaXMuX2xvYWROZXh0KCk7CgkJfQoJfTsKCgkvKioKCSAqIExvYWQgYSBzaW5nbGUgZmlsZS4gVG8gYWRkIG11bHRpcGxlIGZpbGVzIGF0IG9uY2UsIHVzZSB0aGUge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvbG9hZE1hbmlmZXN0In19e3svY3Jvc3NMaW5rfX0KCSAqIG1ldGhvZC4KCSAqCgkgKiBGaWxlcyBhcmUgYWx3YXlzIGFwcGVuZGVkIHRvIHRoZSBjdXJyZW50IHF1ZXVlLCBzbyB0aGlzIG1ldGhvZCBjYW4gYmUgdXNlZCBtdWx0aXBsZSB0aW1lcyB0byBhZGQgZmlsZXMuCgkgKiBUbyBjbGVhciB0aGUgcXVldWUgZmlyc3QsIHVzZSB0aGUge3sjY3Jvc3NMaW5rICJBYnN0cmFjdExvYWRlci9jbG9zZSJ9fXt7L2Nyb3NzTGlua319IG1ldGhvZC4KCSAqIEBtZXRob2QgbG9hZEZpbGUKCSAqIEBwYXJhbSB7T2JqZWN0IHwgU3RyaW5nfSBmaWxlIFRoZSBmaWxlIG9iamVjdCBvciBwYXRoIHRvIGxvYWQuIEEgZmlsZSBjYW4gYmUgZWl0aGVyCiAgICAgKiA8dWw+CiAgICAgKiAgICAgPGxpPkEgc3RyaW5nIHBhdGggdG8gYSByZXNvdXJjZS4gTm90ZSB0aGF0IHRoaXMga2luZCBvZiBsb2FkIGl0ZW0gd2lsbCBiZSBjb252ZXJ0ZWQgdG8gYW4gb2JqZWN0IChzZWUgYmVsb3cpCgkgKiAgICAgaW4gdGhlIGJhY2tncm91bmQuPC9saT4KICAgICAqICAgICA8bGk+T1IgYW4gb2JqZWN0IHRoYXQgY29udGFpbnM6PHVsPgogICAgICogICAgICAgICA8bGk+c3JjOiBUaGUgc291cmNlIG9mIHRoZSBmaWxlIHRoYXQgaXMgYmVpbmcgbG9hZGVkLiBUaGlzIHByb3BlcnR5IGlzIDxiPnJlcXVpcmVkPC9iPi4gVGhlIHNvdXJjZSBjYW4KCSAqICAgICAgICAgZWl0aGVyIGJlIGEgc3RyaW5nIChyZWNvbW1lbmRlZCksIG9yIGFuIEhUTUwgdGFnLjwvbGk+CiAgICAgKiAgICAgICAgIDxsaT50eXBlOiBUaGUgdHlwZSBvZiBmaWxlIHRoYXQgd2lsbCBiZSBsb2FkZWQgKGltYWdlLCBzb3VuZCwganNvbiwgZXRjKS4gUHJlbG9hZEpTIGRvZXMgYXV0by1kZXRlY3Rpb24KCSAqICAgICAgICAgb2YgdHlwZXMgdXNpbmcgdGhlIGV4dGVuc2lvbi4gU3VwcG9ydGVkIHR5cGVzIGFyZSBkZWZpbmVkIG9uIExvYWRRdWV1ZSwgc3VjaCBhcyA8Y29kZT5Mb2FkUXVldWUuSU1BR0U8L2NvZGU+LgoJICogICAgICAgICBJdCBpcyByZWNvbW1lbmRlZCB0aGF0IGEgdHlwZSBpcyBzcGVjaWZpZWQgd2hlbiBhIG5vbi1zdGFuZGFyZCBmaWxlIFVSSSAoc3VjaCBhcyBhIHBocCBzY3JpcHQpIHVzIHVzZWQuPC9saT4KICAgICAqICAgICAgICAgPGxpPmlkOiBBIHN0cmluZyBpZGVudGlmaWVyIHdoaWNoIGNhbiBiZSB1c2VkIHRvIHJlZmVyZW5jZSB0aGUgbG9hZGVkIG9iamVjdC48L2xpPgoJICogICAgICAgICA8bGk+Y2FsbGJhY2s6IE9wdGlvbmFsLCB1c2VkIGZvciBKU09OUCByZXF1ZXN0cywgdG8gZGVmaW5lIHdoYXQgbWV0aG9kIHRvIGNhbGwgd2hlbiB0aGUgSlNPTlAgaXMgbG9hZGVkLjwvbGk+CiAgICAgKiAgICAgICAgIDxsaT5kYXRhOiBBbiBhcmJpdHJhcnkgZGF0YSBvYmplY3QsIHdoaWNoIGlzIGluY2x1ZGVkIHdpdGggdGhlIGxvYWRlZCBvYmplY3Q8L2xpPgoJICogICAgICAgICA8bGk+bWV0aG9kOiB1c2VkIHRvIGRlZmluZSBpZiB0aGlzIHJlcXVlc3QgdXNlcyBHRVQgb3IgUE9TVCB3aGVuIHNlbmRpbmcgZGF0YSB0byB0aGUgc2VydmVyLiBUaGUgZGVmYXVsdAoJICogICAgICAgICB2YWx1ZSBpcyAiR0VUIjwvbGk+CgkgKiAgICAgICAgIDxsaT52YWx1ZXM6IE9wdGlvbmFsIG9iamVjdCBvZiBuYW1lL3ZhbHVlIHBhaXJzIHRvIHNlbmQgdG8gdGhlIHNlcnZlci48L2xpPgogICAgICogICAgIDwvdWw+CiAgICAgKiA8L3VsPgoJICogQHBhcmFtIHtCb29sZWFufSBbbG9hZE5vdz10cnVlXSBLaWNrIG9mZiBhbiBpbW1lZGlhdGUgbG9hZCAodHJ1ZSkgb3Igd2FpdCBmb3IgYSBsb2FkIGNhbGwgKGZhbHNlKS4gVGhlIGRlZmF1bHQKCSAqIHZhbHVlIGlzIHRydWUuIElmIHRoZSBxdWV1ZSBpcyBwYXVzZWQgdXNpbmcge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvc2V0UGF1c2VkIn19e3svY3Jvc3NMaW5rfX0sIGFuZCB0aGUgdmFsdWUgaXMKCSAqIGB0cnVlYCwgdGhlIHF1ZXVlIHdpbGwgcmVzdW1lIGF1dG9tYXRpY2FsbHkuCgkgKiBAcGFyYW0ge1N0cmluZ30gW2Jhc2VQYXRoXSBBIGJhc2UgcGF0aCB0aGF0IHdpbGwgYmUgcHJlcGVuZGVkIHRvIGVhY2ggZmlsZS4gVGhlIGJhc2VQYXRoIGFyZ3VtZW50IG92ZXJyaWRlcyB0aGUKCSAqIHBhdGggc3BlY2lmaWVkIGluIHRoZSBjb25zdHJ1Y3Rvci4gTm90ZSB0aGF0IGlmIHlvdSBsb2FkIGEgbWFuaWZlc3QgdXNpbmcgYSBmaWxlIG9mIHR5cGUge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvTUFOSUZFU1Q6cHJvcGVydHkifX17ey9jcm9zc0xpbmt9fSwKCSAqIGl0cyBmaWxlcyB3aWxsIDxzdHJvbmc+Tk9UPC9zdHJvbmc+IHVzZSB0aGUgYmFzZVBhdGggcGFyYW1ldGVyLiA8c3Ryb25nPlRoZSBiYXNlUGF0aCBwYXJhbWV0ZXIgaXMgZGVwcmVjYXRlZC48L3N0cm9uZz4KCSAqIFRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgcmVtb3ZlZCBpbiBhIGZ1dHVyZSB2ZXJzaW9uLiBQbGVhc2UgZWl0aGVyIHVzZSB0aGUgYGJhc2VQYXRoYCBwYXJhbWV0ZXIgaW4gdGhlIExvYWRRdWV1ZQoJICogY29uc3RydWN0b3IsIG9yIGEgYHBhdGhgIHByb3BlcnR5IGluIGEgbWFuaWZlc3QgZGVmaW5pdGlvbi4KCSAqLwoJcC5sb2FkRmlsZSA9IGZ1bmN0aW9uKGZpbGUsIGxvYWROb3csIGJhc2VQYXRoKSB7CgkJaWYgKGZpbGUgPT0gbnVsbCkgewoJCQl2YXIgZXZlbnQgPSBuZXcgY3JlYXRlanMuRXZlbnQoImVycm9yIik7CgkJCWV2ZW50LnRleHQgPSAiUFJFTE9BRF9OT19GSUxFIjsKCQkJdGhpcy5fc2VuZEVycm9yKGV2ZW50KTsKCQkJcmV0dXJuOwoJCX0KCQl0aGlzLl9hZGRJdGVtKGZpbGUsIG51bGwsIGJhc2VQYXRoKTsKCgkJaWYgKGxvYWROb3cgIT09IGZhbHNlKSB7CgkJCXRoaXMuc2V0UGF1c2VkKGZhbHNlKTsKCQl9IGVsc2UgewoJCQl0aGlzLnNldFBhdXNlZCh0cnVlKTsKCQl9Cgl9OwoKCS8qKgoJICogTG9hZCBhbiBhcnJheSBvZiBmaWxlcy4gVG8gbG9hZCBhIHNpbmdsZSBmaWxlLCB1c2UgdGhlIHt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlL2xvYWRGaWxlIn19e3svY3Jvc3NMaW5rfX0gbWV0aG9kLgoJICogVGhlIGZpbGVzIGluIHRoZSBtYW5pZmVzdCBhcmUgcmVxdWVzdGVkIGluIHRoZSBzYW1lIG9yZGVyLCBidXQgbWF5IGNvbXBsZXRlIGluIGEgZGlmZmVyZW50IG9yZGVyIGlmIHRoZSBtYXgKCSAqIGNvbm5lY3Rpb25zIGFyZSBzZXQgYWJvdmUgMSB1c2luZyB7eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZS9zZXRNYXhDb25uZWN0aW9ucyJ9fXt7L2Nyb3NzTGlua319LiBTY3JpcHRzIHdpbGwgbG9hZAoJICogaW4gdGhlIHJpZ2h0IG9yZGVyIGFzIGxvbmcgYXMge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvbWFpbnRhaW5TY3JpcHRPcmRlciJ9fXt7L2Nyb3NzTGlua319IGlzIHRydWUgKHdoaWNoIGlzCgkgKiBkZWZhdWx0KS4KCSAqCgkgKiBGaWxlcyBhcmUgYWx3YXlzIGFwcGVuZGVkIHRvIHRoZSBjdXJyZW50IHF1ZXVlLCBzbyB0aGlzIG1ldGhvZCBjYW4gYmUgdXNlZCBtdWx0aXBsZSB0aW1lcyB0byBhZGQgZmlsZXMuCgkgKiBUbyBjbGVhciB0aGUgcXVldWUgZmlyc3QsIHVzZSB0aGUge3sjY3Jvc3NMaW5rICJBYnN0cmFjdExvYWRlci9jbG9zZSJ9fXt7L2Nyb3NzTGlua319IG1ldGhvZC4KCSAqIEBtZXRob2QgbG9hZE1hbmlmZXN0CgkgKiBAcGFyYW0ge0FycmF5fFN0cmluZ3xPYmplY3R9IG1hbmlmZXN0IEFuIGxpc3Qgb2YgZmlsZXMgdG8gbG9hZC4gVGhlIGxvYWRNYW5pZmVzdCBjYWxsIHN1cHBvcnRzIGZvdXIgdHlwZXMgb2YKCSAqIG1hbmlmZXN0czoKCSAqIDxvbD4KCSAqICAgICA8bGk+QSBzdHJpbmcgcGF0aCwgd2hpY2ggcG9pbnRzIHRvIGEgbWFuaWZlc3QgZmlsZSwgd2hpY2ggaXMgYSBKU09OIGZpbGUgdGhhdCBjb250YWlucyBhICJtYW5pZmVzdCIgcHJvcGVydHksCgkgKiAgICAgd2hpY2ggZGVmaW5lcyB0aGUgbGlzdCBvZiBmaWxlcyB0byBsb2FkLCBhbmQgY2FuIG9wdGlvbmFsbHkgY29udGFpbiBhICJwYXRoIiBwcm9wZXJ0eSwgd2hpY2ggd2lsbCBiZQoJICogICAgIHByZXBlbmRlZCB0byBlYWNoIGZpbGUgaW4gdGhlIGxpc3QuPC9saT4KCSAqICAgICA8bGk+QW4gb2JqZWN0IHdoaWNoIGRlZmluZXMgYSAic3JjIiwgd2hpY2ggaXMgYSBKU09OIG9yIEpTT05QIGZpbGUuIEEgImNhbGxiYWNrIiBjYW4gYmUgZGVmaW5lZCBmb3IgSlNPTlAKCSAqICAgICBmaWxlLiBUaGUgSlNPTi9KU09OUCBmaWxlIHNob3VsZCBjb250YWluIGEgIm1hbmlmZXN0IiBwcm9wZXJ0eSwgd2hpY2ggZGVmaW5lcyB0aGUgbGlzdCBvZiBmaWxlcyB0byBsb2FkLAoJICogICAgIGFuZCBjYW4gb3B0aW9uYWxseSBjb250YWluIGEgInBhdGgiIHByb3BlcnR5LCB3aGljaCB3aWxsIGJlIHByZXBlbmRlZCB0byBlYWNoIGZpbGUgaW4gdGhlIGxpc3QuPC9saT4KCSAqICAgICA8bGk+QW4gb2JqZWN0IHdoaWNoIGNvbnRhaW5zIGEgIm1hbmlmZXN0IiBwcm9wZXJ0eSwgd2hpY2ggZGVmaW5lcyB0aGUgbGlzdCBvZiBmaWxlcyB0byBsb2FkLCBhbmQgY2FuCgkgKiAgICAgb3B0aW9uYWxseSBjb250YWluIGEgInBhdGgiIHByb3BlcnR5LCB3aGljaCB3aWxsIGJlIHByZXBlbmRlZCB0byBlYWNoIGZpbGUgaW4gdGhlIGxpc3QuPC9saT4KCSAqICAgICA8bGk+QW4gQXJyYXkgb2YgZmlsZXMgdG8gbG9hZC48L2xpPgoJICogPC9vbD4KCSAqCgkgKiBFYWNoICJmaWxlIiBpbiBhIG1hbmlmZXN0IGNhbiBiZSBlaXRoZXI6CgkgKiA8dWw+CgkgKiAgICAgPGxpPkEgc3RyaW5nIHBhdGggdG8gYSByZXNvdXJjZSAoc3RyaW5nKS4gTm90ZSB0aGF0IHRoaXMga2luZCBvZiBsb2FkIGl0ZW0gd2lsbCBiZSBjb252ZXJ0ZWQgdG8gYW4gb2JqZWN0CgkgKiAgICAgKHNlZSBiZWxvdykgaW4gdGhlIGJhY2tncm91bmQuPC9saT4KCSAqICAgICAgPGxpPk9SIGFuIG9iamVjdCB0aGF0IGNvbnRhaW5zOjx1bD4KCSAqICAgICAgICAgPGxpPnNyYzogVGhlIHNvdXJjZSBvZiB0aGUgZmlsZSB0aGF0IGlzIGJlaW5nIGxvYWRlZC4gVGhpcyBwcm9wZXJ0eSBpcyA8Yj5yZXF1aXJlZDwvYj4uIFRoZSBzb3VyY2UgY2FuCgkgKiAgICAgICAgIGVpdGhlciBiZSBhIHN0cmluZyAocmVjb21tZW5kZWQpLCBvciBhbiBIVE1MIHRhZy48L2xpPgoJICogICAgICAgICA8bGk+dHlwZTogVGhlIHR5cGUgb2YgZmlsZSB0aGF0IHdpbGwgYmUgbG9hZGVkIChpbWFnZSwgc291bmQsIGpzb24sIGV0YykuIFByZWxvYWRKUyBkb2VzIGF1dG8tZGV0ZWN0aW9uCgkgKiAgICAgICAgIG9mIHR5cGVzIHVzaW5nIHRoZSBleHRlbnNpb24uIFN1cHBvcnRlZCB0eXBlcyBhcmUgZGVmaW5lZCBvbiBMb2FkUXVldWUsIHN1Y2ggYXMgPGNvZGU+TG9hZFF1ZXVlLklNQUdFPC9jb2RlPi4KCSAqICAgICAgICAgSXQgaXMgcmVjb21tZW5kZWQgdGhhdCBhIHR5cGUgaXMgc3BlY2lmaWVkIHdoZW4gYSBub24tc3RhbmRhcmQgZmlsZSBVUkkgKHN1Y2ggYXMgYSBwaHAgc2NyaXB0KSB1cyB1c2VkLjwvbGk+CgkgKiAgICAgICAgIDxsaT5pZDogQSBzdHJpbmcgaWRlbnRpZmllciB3aGljaCBjYW4gYmUgdXNlZCB0byByZWZlcmVuY2UgdGhlIGxvYWRlZCBvYmplY3QuPC9saT4KCSAqICAgICAgICAgPGxpPmNhbGxiYWNrOiBPcHRpb25hbCwgdXNlZCBmb3IgSlNPTlAgcmVxdWVzdHMsIHRvIGRlZmluZSB3aGF0IG1ldGhvZCB0byBjYWxsIHdoZW4gdGhlIEpTT05QIGlzIGxvYWRlZC48L2xpPgoJICogICAgICAgICA8bGk+ZGF0YTogQW4gYXJiaXRyYXJ5IGRhdGEgb2JqZWN0LCB3aGljaCBpcyBpbmNsdWRlZCB3aXRoIHRoZSBsb2FkZWQgb2JqZWN0PC9saT4KCSAqICAgICAgICAgPGxpPm1ldGhvZDogdXNlZCB0byBkZWZpbmUgaWYgdGhpcyByZXF1ZXN0IHVzZXMgR0VUIG9yIFBPU1Qgd2hlbiBzZW5kaW5nIGRhdGEgdG8gdGhlIHNlcnZlci4gVGhlIGRlZmF1bHQKCSAqICAgICAgICAgdmFsdWUgaXMgIkdFVCI8L2xpPgoJICogICAgICAgICA8bGk+dmFsdWVzOiBPcHRpb25hbCBvYmplY3Qgb2YgbmFtZS92YWx1ZSBwYWlycyB0byBzZW5kIHRvIHRoZSBzZXJ2ZXIuPC9saT4KCSAqICAgICA8L3VsPgoJICogPC91bD4KCSAqIEBwYXJhbSB7Qm9vbGVhbn0gW2xvYWROb3c9dHJ1ZV0gS2ljayBvZmYgYW4gaW1tZWRpYXRlIGxvYWQgKHRydWUpIG9yIHdhaXQgZm9yIGEgbG9hZCBjYWxsIChmYWxzZSkuIFRoZSBkZWZhdWx0CgkgKiB2YWx1ZSBpcyB0cnVlLiBJZiB0aGUgcXVldWUgaXMgcGF1c2VkIHVzaW5nIHt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlL3NldFBhdXNlZCJ9fXt7L2Nyb3NzTGlua319IGFuZCB0aGlzIHZhbHVlIGlzCgkgKiBgdHJ1ZWAsIHRoZSBxdWV1ZSB3aWxsIHJlc3VtZSBhdXRvbWF0aWNhbGx5LgoJICogQHBhcmFtIHtTdHJpbmd9IFtiYXNlUGF0aF0gQSBiYXNlIHBhdGggdGhhdCB3aWxsIGJlIHByZXBlbmRlZCB0byBlYWNoIGZpbGUuIFRoZSBiYXNlUGF0aCBhcmd1bWVudCBvdmVycmlkZXMgdGhlCgkgKiBwYXRoIHNwZWNpZmllZCBpbiB0aGUgY29uc3RydWN0b3IuIE5vdGUgdGhhdCBpZiB5b3UgbG9hZCBhIG1hbmlmZXN0IHVzaW5nIGEgZmlsZSBvZiB0eXBlIHt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlL01BTklGRVNUOnByb3BlcnR5In19e3svY3Jvc3NMaW5rfX0sCgkgKiBpdHMgZmlsZXMgd2lsbCA8c3Ryb25nPk5PVDwvc3Ryb25nPiB1c2UgdGhlIGJhc2VQYXRoIHBhcmFtZXRlci4gPHN0cm9uZz5UaGUgYmFzZVBhdGggcGFyYW1ldGVyIGlzIGRlcHJlY2F0ZWQuPC9zdHJvbmc+CgkgKiBUaGlzIHBhcmFtZXRlciB3aWxsIGJlIHJlbW92ZWQgaW4gYSBmdXR1cmUgdmVyc2lvbi4gUGxlYXNlIGVpdGhlciB1c2UgdGhlIGBiYXNlUGF0aGAgcGFyYW1ldGVyIGluIHRoZSBMb2FkUXVldWUKCSAqIGNvbnN0cnVjdG9yLCBvciBhIGBwYXRoYCBwcm9wZXJ0eSBpbiBhIG1hbmlmZXN0IGRlZmluaXRpb24uCgkgKi8KCXAubG9hZE1hbmlmZXN0ID0gZnVuY3Rpb24obWFuaWZlc3QsIGxvYWROb3csIGJhc2VQYXRoKSB7CgkJdmFyIGZpbGVMaXN0ID0gbnVsbDsKCQl2YXIgcGF0aCA9IG51bGw7CgoJCS8vIEFycmF5LWJhc2VkIGxpc3Qgb2YgaXRlbXMKCQlpZiAobWFuaWZlc3QgaW5zdGFuY2VvZiBBcnJheSkgewoJCQlpZiAobWFuaWZlc3QubGVuZ3RoID09IDApIHsKCQkJCXZhciBldmVudCA9IG5ldyBjcmVhdGVqcy5FdmVudCgiZXJyb3IiKTsKCQkJCWV2ZW50LnRleHQgPSAiUFJFTE9BRF9NQU5JRkVTVF9FTVBUWSI7CgkJCQl0aGlzLl9zZW5kRXJyb3IoZXZlbnQpOwoJCQkJcmV0dXJuOwoJCQl9CgkJCWZpbGVMaXN0ID0gbWFuaWZlc3Q7CgoJCS8vIFN0cmluZy1iYXNlZC4gT25seSBmaWxlIG1hbmlmZXN0cyBjYW4gYmUgc3BlY2lmaWVkIHRoaXMgd2F5LiBBbnkgb3RoZXIgdHlwZXMgd2lsbCBjYXVzZSBhbiBlcnJvciB3aGVuIGxvYWRlZC4KCQl9IGVsc2UgaWYgKHR5cGVvZihtYW5pZmVzdCkgPT09ICJzdHJpbmciKSB7CgkJCWZpbGVMaXN0ID0gW3sKCQkJCXNyYzogbWFuaWZlc3QsCgkJCQl0eXBlOiBzLk1BTklGRVNUCgkJCX1dOwoKCQl9IGVsc2UgaWYgKHR5cGVvZihtYW5pZmVzdCkgPT0gIm9iamVjdCIpIHsKCgkJCS8vIEFuIG9iamVjdCB0aGF0IGRlZmluZXMgYSBtYW5pZmVzdCBwYXRoCgkJCWlmIChtYW5pZmVzdC5zcmMgIT09IHVuZGVmaW5lZCkgewoJCQkJaWYgKG1hbmlmZXN0LnR5cGUgPT0gbnVsbCkgewoJCQkJCW1hbmlmZXN0LnR5cGUgPSBzLk1BTklGRVNUOwoJCQkJfSBlbHNlIGlmIChtYW5pZmVzdC50eXBlICE9IHMuTUFOSUZFU1QpIHsKCQkJCQl2YXIgZXZlbnQgPSBuZXcgY3JlYXRlanMuRXZlbnQoImVycm9yIik7CgkJCQkJZXZlbnQudGV4dCA9ICJQUkVMT0FEX01BTklGRVNUX0VSUk9SIjsKCQkJCQl0aGlzLl9zZW5kRXJyb3IoZXZlbnQpOwoJCQkJfQoJCQkJZmlsZUxpc3QgPSBbbWFuaWZlc3RdOwoKCQkJLy8gQW4gb2JqZWN0IHRoYXQgZGVmaW5lcyBhIG1hbmlmZXN0CgkJCX0gZWxzZSBpZiAobWFuaWZlc3QubWFuaWZlc3QgIT09IHVuZGVmaW5lZCkgewoJCQkJZmlsZUxpc3QgPSBtYW5pZmVzdC5tYW5pZmVzdDsKCQkJCXBhdGggPSBtYW5pZmVzdC5wYXRoOwoJCQl9CgoJCS8vIFVuc3VwcG9ydGVkLiBUaGlzIHdpbGwgdGhyb3cgYW4gZXJyb3IuCgkJfSBlbHNlIHsKCQkJdmFyIGV2ZW50ID0gbmV3IGNyZWF0ZWpzLkV2ZW50KCJlcnJvciIpOwoJCQlldmVudC50ZXh0ID0gIlBSRUxPQURfTUFOSUZFU1RfTlVMTCI7CgkJCXRoaXMuX3NlbmRFcnJvcihldmVudCk7CgkJCXJldHVybjsKCQl9CgoJCWZvciAodmFyIGk9MCwgbD1maWxlTGlzdC5sZW5ndGg7IGk8bDsgaSsrKSB7CgkJCXRoaXMuX2FkZEl0ZW0oZmlsZUxpc3RbaV0sIHBhdGgsIGJhc2VQYXRoKTsKCQl9CgoJCWlmIChsb2FkTm93ICE9PSBmYWxzZSkgewoJCQl0aGlzLnNldFBhdXNlZChmYWxzZSk7CgkJfSBlbHNlIHsKCQkJdGhpcy5zZXRQYXVzZWQodHJ1ZSk7CgkJfQoKCX07CgoJLy8gT3ZlcnJpZGVzIGFic3RyYWN0IG1ldGhvZCBpbiBBYnN0cmFjdExvYWRlcgoJcC5sb2FkID0gZnVuY3Rpb24oKSB7CgkJdGhpcy5zZXRQYXVzZWQoZmFsc2UpOwoJfTsKCgkvKioKCSAqIExvb2sgdXAgYSBsb2FkIGl0ZW0gdXNpbmcgZWl0aGVyIHRoZSAiaWQiIG9yICJzcmMiIHRoYXQgd2FzIHNwZWNpZmllZCB3aGVuIGxvYWRpbmcgaXQuIE5vdGUgdGhhdCBpZiBubyAiaWQiIHdhcwoJICogc3VwcGxpZWQgd2l0aCB0aGUgbG9hZCBpdGVtLCB0aGUgSUQgd2lsbCBiZSB0aGUgInNyYyIsIGluY2x1ZGluZyBhIGBwYXRoYCBwcm9wZXJ0eSBkZWZpbmVkIGJ5IGEgbWFuaWZlc3QuIFRoZQoJICogYGJhc2VQYXRoYCB3aWxsIG5vdCBiZSBwYXJ0IG9mIHRoZSBJRC4KCSAqIEBtZXRob2QgZ2V0SXRlbQoJICogQHBhcmFtIHtTdHJpbmd9IHZhbHVlIFRoZSA8Y29kZT5pZDwvY29kZT4gb3IgPGNvZGU+c3JjPC9jb2RlPiBvZiB0aGUgbG9hZCBpdGVtLgoJICogQHJldHVybiB7T2JqZWN0fSBUaGUgbG9hZCBpdGVtIHRoYXQgd2FzIGluaXRpYWxseSByZXF1ZXN0ZWQgdXNpbmcge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvbG9hZEZpbGUifX17ey9jcm9zc0xpbmt9fQoJICogb3Ige3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvbG9hZE1hbmlmZXN0In19e3svY3Jvc3NMaW5rfX0uIFRoaXMgb2JqZWN0IGlzIGFsc28gcmV0dXJuZWQgdmlhIHRoZSB7eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZS9maWxlbG9hZDpldmVudCJ9fXt7L2Nyb3NzTGlua319CgkgKiBldmVudCBhcyB0aGUgYGl0ZW1gIHBhcmFtZXRlci4KCSAqLwoJcC5nZXRJdGVtID0gZnVuY3Rpb24odmFsdWUpIHsKCQlyZXR1cm4gdGhpcy5fbG9hZEl0ZW1zQnlJZFt2YWx1ZV0gfHwgdGhpcy5fbG9hZEl0ZW1zQnlTcmNbdmFsdWVdOwoJfTsKCgkvKioKCSAqIExvb2sgdXAgYSBsb2FkZWQgcmVzdWx0IHVzaW5nIGVpdGhlciB0aGUgImlkIiBvciAic3JjIiB0aGF0IHdhcyBzcGVjaWZpZWQgd2hlbiBsb2FkaW5nIGl0LiBOb3RlIHRoYXQgaWYgbm8gImlkIgoJICogd2FzIHN1cHBsaWVkIHdpdGggdGhlIGxvYWQgaXRlbSwgdGhlIElEIHdpbGwgYmUgdGhlICJzcmMiLCBpbmNsdWRpbmcgYSBgcGF0aGAgcHJvcGVydHkgZGVmaW5lZCBieSBhIG1hbmlmZXN0LiBUaGUKCSAqIGBiYXNlUGF0aGAgd2lsbCBub3QgYmUgcGFydCBvZiB0aGUgSUQuCgkgKiBAbWV0aG9kIGdldFJlc3VsdAoJICogQHBhcmFtIHtTdHJpbmd9IHZhbHVlIFRoZSA8Y29kZT5pZDwvY29kZT4gb3IgPGNvZGU+c3JjPC9jb2RlPiBvZiB0aGUgbG9hZCBpdGVtLgoJICogQHBhcmFtIHtCb29sZWFufSBbcmF3UmVzdWx0PWZhbHNlXSBSZXR1cm4gYSByYXcgcmVzdWx0IGluc3RlYWQgb2YgYSBmb3JtYXR0ZWQgcmVzdWx0LiBUaGlzIGFwcGxpZXMgdG8gY29udGVudAoJICogbG9hZGVkIHZpYSBYSFIgc3VjaCBhcyBzY3JpcHRzLCBYTUwsIENTUywgYW5kIEltYWdlcy4gSWYgdGhlcmUgaXMgbm8gcmF3IHJlc3VsdCwgdGhlIGZvcm1hdHRlZCByZXN1bHQgd2lsbCBiZQoJICogcmV0dXJuZWQgaW5zdGVhZC4KCSAqIEByZXR1cm4ge09iamVjdH0gQSByZXN1bHQgb2JqZWN0IGNvbnRhaW5pbmcgdGhlIGNvbnRlbnQgdGhhdCB3YXMgbG9hZGVkLCBzdWNoIGFzOgogICAgICogPHVsPgoJICogICAgICA8bGk+QW4gaW1hZ2UgdGFnICgmbHQ7aW1hZ2UgLyZndDspIGZvciBpbWFnZXM8L2xpPgoJICogICAgICA8bGk+QSBzY3JpcHQgdGFnIGZvciBKYXZhU2NyaXB0ICgmbHQ7c2NyaXB0IC8mZ3Q7KS4gTm90ZSB0aGF0IHNjcmlwdHMgYXJlIGF1dG9tYXRpY2FsbHkgYWRkZWQgdG8gdGhlIEhUTUwKCSAqICAgICAgRE9NLjwvbGk+CgkgKiAgICAgIDxsaT5BIHN0eWxlIHRhZyBmb3IgQ1NTICgmbHQ7c3R5bGUgLyZndDsgb3IgJmx0O2xpbmsgJmd0Oyk8L2xpPgoJICogICAgICA8bGk+UmF3IHRleHQgZm9yIFRFWFQ8L2xpPgoJICogICAgICA8bGk+QSBmb3JtYXR0ZWQgSmF2YVNjcmlwdCBvYmplY3QgZGVmaW5lZCBieSBKU09OPC9saT4KCSAqICAgICAgPGxpPkFuIFhNTCBkb2N1bWVudDwvbGk+CgkgKiAgICAgIDxsaT5BIGJpbmFyeSBhcnJheWJ1ZmZlciBsb2FkZWQgYnkgWEhSPC9saT4KCSAqICAgICAgPGxpPkFuIGF1ZGlvIHRhZyAoJmx0O2F1ZGlvICZndDspIGZvciBIVE1MIGF1ZGlvLiBOb3RlIHRoYXQgaXQgaXMgcmVjb21tZW5kZWQgdG8gdXNlIFNvdW5kSlMgQVBJcyB0byBwbGF5CgkgKiAgICAgIGxvYWRlZCBhdWRpby4gU3BlY2lmaWNhbGx5LCBhdWRpbyBsb2FkZWQgYnkgRmxhc2ggYW5kIFdlYkF1ZGlvIHdpbGwgcmV0dXJuIGEgbG9hZGVyIG9iamVjdCB1c2luZyB0aGlzIG1ldGhvZAoJICogICAgICB3aGljaCBjYW4gbm90IGJlIHVzZWQgdG8gcGxheSBhdWRpbyBiYWNrLjwvbGk+CgkgKiA8L3VsPgogICAgICogVGhpcyBvYmplY3QgaXMgYWxzbyByZXR1cm5lZCB2aWEgdGhlIHt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlL2ZpbGVsb2FkOmV2ZW50In19e3svY3Jvc3NMaW5rfX0gIGV2ZW50IGFzIHRoZSAnaXRlbWAKCSAqIHBhcmFtZXRlci4gTm90ZSB0aGF0IGlmIGEgcmF3IHJlc3VsdCBpcyByZXF1ZXN0ZWQsIGJ1dCBub3QgZm91bmQsIHRoZSByZXN1bHQgd2lsbCBiZSByZXR1cm5lZCBpbnN0ZWFkLgoJICovCglwLmdldFJlc3VsdCA9IGZ1bmN0aW9uKHZhbHVlLCByYXdSZXN1bHQpIHsKCQl2YXIgaXRlbSA9IHRoaXMuX2xvYWRJdGVtc0J5SWRbdmFsdWVdIHx8IHRoaXMuX2xvYWRJdGVtc0J5U3JjW3ZhbHVlXTsKCQlpZiAoaXRlbSA9PSBudWxsKSB7IHJldHVybiBudWxsOyB9CgkJdmFyIGlkID0gaXRlbS5pZDsKCQlpZiAocmF3UmVzdWx0ICYmIHRoaXMuX2xvYWRlZFJhd1Jlc3VsdHNbaWRdKSB7CgkJCXJldHVybiB0aGlzLl9sb2FkZWRSYXdSZXN1bHRzW2lkXTsKCQl9CgkJcmV0dXJuIHRoaXMuX2xvYWRlZFJlc3VsdHNbaWRdOwoJfTsKCgkvKioKCSAqIFBhdXNlIG9yIHJlc3VtZSB0aGUgY3VycmVudCBsb2FkLiBBY3RpdmUgbG9hZHMgd2lsbCBub3QgYmUgY2FuY2VsbGVkLCBidXQgdGhlIG5leHQgaXRlbXMgaW4gdGhlIHF1ZXVlIHdpbGwgbm90CgkgKiBiZSBwcm9jZXNzZWQgd2hlbiBhY3RpdmUgbG9hZHMgY29tcGxldGUuIExvYWRRdWV1ZXMgYXJlIG5vdCBwYXVzZWQgYnkgZGVmYXVsdC4KCSAqCgkgKiBOb3RlIHRoYXQgaWYgbmV3IGl0ZW1zIGFyZSBhZGRlZCB0byB0aGUgcXVldWUgdXNpbmcge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvbG9hZEZpbGUifX17ey9jcm9zc0xpbmt9fSBvciB7eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZS9sb2FkTWFuaWZlc3QifX17ey9jcm9zc0xpbmt9fSwKCSAqIGEgcGF1c2VkIHF1ZXVlIHdpbGwgYmUgcmVzdW1lZCwgdW5sZXNzIHRoZSBgbG9hZE5vd2AgYXJndW1lbnQgaXMgYGZhbHNlYC4KCSAqIEBtZXRob2Qgc2V0UGF1c2VkCgkgKiBAcGFyYW0ge0Jvb2xlYW59IHZhbHVlIFdoZXRoZXIgdGhlIHF1ZXVlIHNob3VsZCBiZSBwYXVzZWQgb3Igbm90LgoJICovCglwLnNldFBhdXNlZCA9IGZ1bmN0aW9uKHZhbHVlKSB7CgkJdGhpcy5fcGF1c2VkID0gdmFsdWU7CgkJaWYgKCF0aGlzLl9wYXVzZWQpIHsKCQkJdGhpcy5fbG9hZE5leHQoKTsKCQl9Cgl9OwoKCS8vIE92ZXJyaWRlcyBhYnN0cmFjdCBtZXRob2QgaW4gQWJzdHJhY3RMb2FkZXIKCXAuY2xvc2UgPSBmdW5jdGlvbigpIHsKCQl3aGlsZSAodGhpcy5fY3VycmVudExvYWRzLmxlbmd0aCkgewoJCQl0aGlzLl9jdXJyZW50TG9hZHMucG9wKCkuY2FuY2VsKCk7CgkJfQoJCXRoaXMuX3NjcmlwdE9yZGVyLmxlbmd0aCA9IDA7CgkJdGhpcy5fbG9hZGVkU2NyaXB0cy5sZW5ndGggPSAwOwoJCXRoaXMubG9hZFN0YXJ0V2FzRGlzcGF0Y2hlZCA9IGZhbHNlOwoJfTsKCgovL1Byb3RlY3RlZCBNZXRob2RzCgkvKioKCSAqIEFkZCBhbiBpdGVtIHRvIHRoZSBxdWV1ZS4gSXRlbXMgYXJlIGZvcm1hdHRlZCBpbnRvIGEgdXNhYmxlIG9iamVjdCBjb250YWluaW5nIGFsbCB0aGUgcHJvcGVydGllcyBuZWNlc3NhcnkgdG8KCSAqIGxvYWQgdGhlIGNvbnRlbnQuIFRoZSBsb2FkIHF1ZXVlIGlzIHBvcHVsYXRlZCB3aXRoIHRoZSBsb2FkZXIgaW5zdGFuY2UgdGhhdCBoYW5kbGVzIHByZWxvYWRpbmcsIGFuZCBub3QgdGhlIGxvYWQKCSAqIGl0ZW0gdGhhdCB3YXMgcGFzc2VkIGluIGJ5IHRoZSB1c2VyLiBUbyBsb29rIHVwIHRoZSBsb2FkIGl0ZW0gYnkgaWQgb3Igc3JjLCB1c2UgdGhlIHt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlLmdldEl0ZW0ifX17ey9jcm9zc0xpbmt9fQoJICogbWV0aG9kLgoJICogQG1ldGhvZCBfYWRkSXRlbQoJICogQHBhcmFtIHtTdHJpbmd8T2JqZWN0fSB2YWx1ZSBUaGUgaXRlbSB0byBhZGQgdG8gdGhlIHF1ZXVlLgoJICogQHBhcmFtIHtTdHJpbmd9IFtwYXRoXSBBbiBvcHRpb25hbCBwYXRoIHByZXBlbmRlZCB0byB0aGUgYHNyY2AuIFRoZSBwYXRoIHdpbGwgb25seSBiZSBwcmVwZW5kZWQgaWYgdGhlIHNyYyBpcwoJICogcmVsYXRpdmUsIGFuZCBkb2VzIG5vdCBzdGFydCB3aXRoIGEgcHJvdG9jb2wgc3VjaCBhcyBgaHR0cDovL2AsIG9yIGEgcGF0aCBsaWtlIGAuLi9gLiBJZiB0aGUgTG9hZFF1ZXVlIHdhcwoJICogcHJvdmlkZWQgYSB7eyNjcm9zc0xpbmsgIl9iYXNlUGF0aCJ9fXt7L2Nyb3NzTGlua319LCB0aGVuIGl0IHdpbGwgb3B0aW9uYWxseSBiZSBwcmVwZW5kZWQgYWZ0ZXIuCgkgKiBAcGFyYW0ge1N0cmluZ30gW2Jhc2VQYXRoXSA8c3Ryb25nPkRlcHJlY2F0ZWQ8L3N0cm9uZz5BbiBvcHRpb25hbCBiYXNlUGF0aCBwYXNzZWQgaW50byBhIHt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlL2xvYWRNYW5pZmVzdCJ9fXt7L2Nyb3NzTGlua319CgkgKiBvciB7eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZS9sb2FkRmlsZSJ9fXt7L2Nyb3NzTGlua319IGNhbGwuIFRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgcmVtb3ZlZCBpbiBhIGZ1dHVyZSB0YWdnZWQKCSAqIHZlcnNpb24uCgkgKiBAcHJpdmF0ZQoJICovCglwLl9hZGRJdGVtID0gZnVuY3Rpb24odmFsdWUsIHBhdGgsIGJhc2VQYXRoKSB7CgkJdmFyIGl0ZW0gPSB0aGlzLl9jcmVhdGVMb2FkSXRlbSh2YWx1ZSwgcGF0aCwgYmFzZVBhdGgpOyAvLyBiYXNlUGF0aCBhbmQgbWFuaWZlc3QgcGF0aCBhcmUgYWRkZWQgdG8gdGhlIHNyYy4KCQlpZiAoaXRlbSA9PSBudWxsKSB7IHJldHVybjsgfSAvLyBTb21ldGltZXMgcGx1Z2lucyBvciB0eXBlcyBzaG91bGQgYmUgc2tpcHBlZC4KCQl2YXIgbG9hZGVyID0gdGhpcy5fY3JlYXRlTG9hZGVyKGl0ZW0pOwoJCWlmIChsb2FkZXIgIT0gbnVsbCkgewoJCQl0aGlzLl9sb2FkUXVldWUucHVzaChsb2FkZXIpOwoJCQl0aGlzLl9sb2FkUXVldWVCYWNrdXAucHVzaChsb2FkZXIpOwoKCQkJdGhpcy5fbnVtSXRlbXMrKzsKCQkJdGhpcy5fdXBkYXRlUHJvZ3Jlc3MoKTsKCgkJCS8vIE9ubHkgd29ycnkgYWJvdXQgc2NyaXB0IG9yZGVyIHdoZW4gdXNpbmcgWEhSIHRvIGxvYWQgc2NyaXB0cy4gVGFncyBhcmUgb25seSBsb2FkaW5nIG9uZSBhdCBhIHRpbWUuCgkJCWlmICh0aGlzLm1haW50YWluU2NyaXB0T3JkZXIKCQkJCQkmJiBpdGVtLnR5cGUgPT0gY3JlYXRlanMuTG9hZFF1ZXVlLkpBVkFTQ1JJUFQKCQkJCQkmJiBsb2FkZXIgaW5zdGFuY2VvZiBjcmVhdGVqcy5YSFJMb2FkZXIpIHsKCQkJCXRoaXMuX3NjcmlwdE9yZGVyLnB1c2goaXRlbSk7CgkJCQl0aGlzLl9sb2FkZWRTY3JpcHRzLnB1c2gobnVsbCk7CgkJCX0KCQl9Cgl9OwoKCS8qKgoJICogQ3JlYXRlIGEgcmVmaW5lZCBsb2FkIGl0ZW0sIHdoaWNoIGNvbnRhaW5zIGFsbCB0aGUgcmVxdWlyZWQgcHJvcGVydGllcyAoc3JjLCB0eXBlLCBleHRlbnNpb24sIHRhZykuIFRoZSB0eXBlIG9mCgkgKiBpdGVtIGlzIGRldGVybWluZWQgYnkgYnJvd3NlciBzdXBwb3J0LCByZXF1aXJlbWVudHMgYmFzZWQgb24gdGhlIGZpbGUgdHlwZSwgYW5kIGRldmVsb3BlciBzZXR0aW5ncy4gRm9yIGV4YW1wbGUsCgkgKiBYSFIgaXMgb25seSB1c2VkIGZvciBmaWxlIHR5cGVzIHRoYXQgc3VwcG9ydCBpdCBpbiBuZXcgYnJvd3NlcnMuCgkgKgoJICogQmVmb3JlIHRoZSBpdGVtIGlzIHJldHVybmVkLCBhbnkgcGx1Z2lucyByZWdpc3RlcmVkIHRvIGhhbmRsZSB0aGUgdHlwZSBvciBleHRlbnNpb24gd2lsbCBiZSBmaXJlZCwgd2hpY2ggbWF5CgkgKiBhbHRlciB0aGUgbG9hZCBpdGVtLgoJICogQG1ldGhvZCBfY3JlYXRlTG9hZEl0ZW0KCSAqIEBwYXJhbSB7U3RyaW5nIHwgT2JqZWN0IHwgSFRNTEF1ZGlvRWxlbWVudCB8IEhUTUxJbWFnZUVsZW1lbnR9IHZhbHVlIFRoZSBpdGVtIHRoYXQgbmVlZHMgdG8gYmUgcHJlbG9hZGVkLgogCSAqIEBwYXJhbSB7U3RyaW5nfSBbcGF0aF0gQSBwYXRoIHRvIHByZXBlbmQgdG8gdGhlIGl0ZW0ncyBzb3VyY2UuIFNvdXJjZXMgYmVnaW5uaW5nIHdpdGggaHR0cDovLyBvciBzaW1pbGFyIHdpbGwKCSAqIG5vdCByZWNlaXZlIGEgcGF0aC4gU2luY2UgUHJlbG9hZEpTIDAuNC4xLCB0aGUgc3JjIHdpbGwgYmUgbW9kaWZpZWQgdG8gaW5jbHVkZSB0aGUgYHBhdGhgIGFuZCB7eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZS9fYmFzZVBhdGg6cHJvcGVydHkifX17ey9jcm9zc0xpbmt9fQoJICogd2hlbiBpdCBpcyBhZGRlZC4KCSAqIEBwYXJhbSB7U3RyaW5nfSBbYmFzZVBhdGhdIDxzdHJvbmc+RGVwcmVjdGF0ZWQ8L3N0cm9uZz4gQSBiYXNlIHBhdGggdG8gcHJlcGVuZCB0byB0aGUgaXRlbXMgc291cmNlIGluIGFkZGl0aW9uIHRvCgkgKiB0aGUgcGF0aCBhcmd1bWVudC4KCSAqIEByZXR1cm4ge09iamVjdH0gVGhlIGxvYWRlciBpbnN0YW5jZSB0aGF0IHdpbGwgYmUgdXNlZC4KCSAqIEBwcml2YXRlCgkgKi8KCXAuX2NyZWF0ZUxvYWRJdGVtID0gZnVuY3Rpb24odmFsdWUsIHBhdGgsIGJhc2VQYXRoKSB7CgkJdmFyIGl0ZW0gPSBudWxsOwoKCQkvLyBDcmVhdGUvbW9kaWZ5IGEgbG9hZCBpdGVtCgkJc3dpdGNoKHR5cGVvZih2YWx1ZSkpIHsKCQkJY2FzZSAic3RyaW5nIjoKCQkJCWl0ZW0gPSB7CgkJCQkJc3JjOiB2YWx1ZQoJCQkJfTsgYnJlYWs7CgkJCWNhc2UgIm9iamVjdCI6CgkJCQlpZiAod2luZG93LkhUTUxBdWRpb0VsZW1lbnQgJiYgdmFsdWUgaW5zdGFuY2VvZiB3aW5kb3cuSFRNTEF1ZGlvRWxlbWVudCkgewoJCQkJCWl0ZW0gPSB7CgkJCQkJCXRhZzogdmFsdWUsCgkJCQkJCXNyYzogaXRlbS50YWcuc3JjLAoJCQkJCQl0eXBlOiBjcmVhdGVqcy5Mb2FkUXVldWUuU09VTkQKCQkJCQl9OwoJCQkJfSBlbHNlIHsKCQkJCQlpdGVtID0gdmFsdWU7CgkJCQl9CgkJCQlicmVhazsKCQkJZGVmYXVsdDoKCQkJCXJldHVybiBudWxsOwoJCX0KCgkJLy8gRGV0ZXJtaW5lIEV4dGVuc2lvbiwgZXRjLgoJCXZhciBtYXRjaCA9IHRoaXMuX3BhcnNlVVJJKGl0ZW0uc3JjKTsKCQlpZiAobWF0Y2ggIT0gbnVsbCkgeyBpdGVtLmV4dCA9IG1hdGNoWzZdOyB9CgkJaWYgKGl0ZW0udHlwZSA9PSBudWxsKSB7CgkJCWl0ZW0udHlwZSA9IHRoaXMuX2dldFR5cGVCeUV4dGVuc2lvbihpdGVtLmV4dCk7CgkJfQoKCQkvLyBJbmplY3QgcGF0aCAmIGJhc2VQYXRoCgkJdmFyIGJwID0gIiI7IC8vIFN0b3JlIHRoZSBnZW5lcmF0ZWQgYmFzZVBhdGgKCQl2YXIgdXNlQmFzZVBhdGggPSBiYXNlUGF0aCB8fCB0aGlzLl9iYXNlUGF0aDsKCQl2YXIgYXV0b0lkID0gaXRlbS5zcmM7CgkJaWYgKG1hdGNoICYmIG1hdGNoWzFdID09IG51bGwgJiYgbWF0Y2hbM10gPT0gbnVsbCkgewoJCQlpZiAocGF0aCkgewoJCQkJYnAgPSBwYXRoOwoJCQkJdmFyIHBhdGhNYXRjaCA9IHRoaXMuX3BhcnNlUGF0aChwYXRoKTsKCQkJCWF1dG9JZCA9IHBhdGggKyBhdXRvSWQ7CgkJCQkvLyBBbHNvIGFwcGVuZCBiYXNlUGF0aAoJCQkJaWYgKHVzZUJhc2VQYXRoICE9IG51bGwgJiYgcGF0aE1hdGNoICYmIHBhdGhNYXRjaFsxXSA9PSBudWxsICYmIHBhdGhNYXRjaFsyXSA9PSBudWxsKSB7CgkJCQkJYnAgPSB1c2VCYXNlUGF0aCArIGJwOwoJCQkJfQoJCQl9IGVsc2UgaWYgKHVzZUJhc2VQYXRoICE9IG51bGwpIHsKCQkJCWJwID0gdXNlQmFzZVBhdGg7CgkJCX0KCQl9CgkJaXRlbS5zcmMgPSBicCArIGl0ZW0uc3JjOwoJCWl0ZW0ucGF0aCA9IGJwOwoKCQlpZiAoaXRlbS50eXBlID09IGNyZWF0ZWpzLkxvYWRRdWV1ZS5KU09OIHx8IGl0ZW0udHlwZSA9PSBjcmVhdGVqcy5Mb2FkUXVldWUuTUFOSUZFU1QpIHsKCQkJaXRlbS5fbG9hZEFzSlNPTlAgPSAoaXRlbS5jYWxsYmFjayAhPSBudWxsKTsKCQl9CgoJCWlmIChpdGVtLnR5cGUgPT0gY3JlYXRlanMuTG9hZFF1ZXVlLkpTT05QICYmIGl0ZW0uY2FsbGJhY2sgPT0gbnVsbCkgewoJCQl0aHJvdyBuZXcgRXJyb3IoJ2NhbGxiYWNrIGlzIHJlcXVpcmVkIGZvciBsb2FkaW5nIEpTT05QIHJlcXVlc3RzLicpOwoJCX0KCgkJLy8gQ3JlYXRlIGEgdGFnIGZvciB0aGUgaXRlbS4gVGhpcyBlbnN1cmVzIHRoZXJlIGlzIHNvbWV0aGluZyB0byBlaXRoZXIgbG9hZCB3aXRoIG9yIHBvcHVsYXRlIHdoZW4gZmluaXNoZWQuCgkJaWYgKGl0ZW0udGFnID09PSB1bmRlZmluZWQgfHwgaXRlbS50YWcgPT09IG51bGwpIHsKCQkJaXRlbS50YWcgPSB0aGlzLl9jcmVhdGVUYWcoaXRlbSk7CgkJfQoKCQkvLyBJZiB0aGVyZSdzIG5vIGlkLCBzZXQgb25lIG5vdy4KCQlpZiAoaXRlbS5pZCA9PT0gdW5kZWZpbmVkIHx8IGl0ZW0uaWQgPT09IG51bGwgfHwgaXRlbS5pZCA9PT0gIiIpIHsKICAgICAgICAgICAgaXRlbS5pZCA9IGF1dG9JZDsKCQl9CgoJCS8vIEdpdmUgcGx1Z2lucyBhIGNoYW5jZSB0byBtb2RpZnkgdGhlIGxvYWRJdGVtOgoJCXZhciBjdXN0b21IYW5kbGVyID0gdGhpcy5fdHlwZUNhbGxiYWNrc1tpdGVtLnR5cGVdIHx8IHRoaXMuX2V4dGVuc2lvbkNhbGxiYWNrc1tpdGVtLmV4dF07CgkJaWYgKGN1c3RvbUhhbmRsZXIpIHsKCQkJLy8gUGx1Z2lucyBhcmUgbm93IHBhc3NlZCBib3RoIHRoZSBmdWxsIHNvdXJjZSwgYXMgd2VsbCBhcyBhIGNvbWJpbmVkIHBhdGgrYmFzZVBhdGggKGFwcHJvcHJpYXRlbHkpCgkJCXZhciByZXN1bHQgPSBjdXN0b21IYW5kbGVyLmNhbGxiYWNrLmNhbGwoY3VzdG9tSGFuZGxlci5zY29wZSwgaXRlbS5zcmMsIGl0ZW0udHlwZSwgaXRlbS5pZCwgaXRlbS5kYXRhLAoJCQkJCWJwLCB0aGlzKTsKCQkJLy8gTk9URTogQmFzZVBhdGggYXJndW1lbnQgaXMgZGVwcmVjYXRlZC4gV2UgcGFzcyBpdCB0byBwbHVnaW5zLmFsbG93IFNvdW5kSlMgdG8gbW9kaWZ5IHRoZSBmaWxlLiB0byBzYW55bW9yZS4gVGhlIGZ1bGwgcGF0aCBpcyBzZW50IHRvIHRoZSBwbHVnaW4KCgkJCS8vIFRoZSBwbHVnaW4gd2lsbCBoYW5kbGUgdGhlIGxvYWQsIG9yIGhhcyBjYW5jZWxlZCBpdC4gSWdub3JlIGl0LgoJCQlpZiAocmVzdWx0ID09PSBmYWxzZSkgewoJCQkJcmV0dXJuIG51bGw7CgoJCQkvLyBMb2FkIGFzIG5vcm1hbDoKCQkJfSBlbHNlIGlmIChyZXN1bHQgPT09IHRydWUpIHsKCQkJCS8vIERvIE5vdGhpbmcKCgkJCS8vIFJlc3VsdCBpcyBhIGxvYWRlciBjbGFzczoKCQkJfSBlbHNlIHsKCQkJCWlmIChyZXN1bHQuc3JjICE9IG51bGwpIHsgaXRlbS5zcmMgPSByZXN1bHQuc3JjOyB9CgkJCQlpZiAocmVzdWx0LmlkICE9IG51bGwpIHsgaXRlbS5pZCA9IHJlc3VsdC5pZDsgfSAvLyBUT0RPOiBFdmFsdWF0ZSB0aGlzLiBBbiBvdmVycmlkZGVuIElEIGNvdWxkIGJlIHByb2JsZW1hdGljCgkJCQlpZiAocmVzdWx0LnRhZyAhPSBudWxsKSB7IC8vIEFzc3VtZXMgdGhhdCB0aGUgcmV0dXJuZWQgdGFnIGVpdGhlciBoYXMgYSBsb2FkIG1ldGhvZCBvciBhIHNyYyBzZXR0ZXIuCgkJCQkJaXRlbS50YWcgPSByZXN1bHQudGFnOwoJCQkJfQogICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5jb21wbGV0ZUhhbmRsZXIgIT0gbnVsbCkgeyBpdGVtLmNvbXBsZXRlSGFuZGxlciA9IHJlc3VsdC5jb21wbGV0ZUhhbmRsZXI7IH0KCgkJCQkvLyBBbGxvdyB0eXBlIG92ZXJyaWRpbmc6CgkJCQlpZiAocmVzdWx0LnR5cGUpIHsgaXRlbS50eXBlID0gcmVzdWx0LnR5cGU7IH0KCgkJCQkvLyBVcGRhdGUgdGhlIGV4dGVuc2lvbiBpbiBjYXNlIHRoZSB0eXBlIGNoYW5nZWQ6CgkJCQltYXRjaCA9IHRoaXMuX3BhcnNlVVJJKGl0ZW0uc3JjKTsKCQkJCWlmIChtYXRjaCAhPSBudWxsICYmIG1hdGNoWzZdICE9IG51bGwpIHsKCQkJCQlpdGVtLmV4dCA9IG1hdGNoWzZdLnRvTG93ZXJDYXNlKCk7CgkJCQl9CgkJCX0KCQl9CgoJCS8vIFN0b3JlIHRoZSBpdGVtIGZvciBsb29rdXAuIFRoaXMgYWxzbyBoZWxwcyBjbGVhbi11cCBsYXRlci4KCQl0aGlzLl9sb2FkSXRlbXNCeUlkW2l0ZW0uaWRdID0gaXRlbTsKCQl0aGlzLl9sb2FkSXRlbXNCeVNyY1tpdGVtLnNyY10gPSBpdGVtOwoKCQlyZXR1cm4gaXRlbTsKCX07CgoJLyoqCgkgKiBDcmVhdGUgYSBsb2FkZXIgZm9yIGEgbG9hZCBpdGVtLgoJICogQG1ldGhvZCBfY3JlYXRlTG9hZGVyCgkgKiBAcGFyYW0ge09iamVjdH0gaXRlbSBBIGZvcm1hdHRlZCBsb2FkIGl0ZW0gdGhhdCBjYW4gYmUgdXNlZCB0byBnZW5lcmF0ZSBhIGxvYWRlci4KCSAqIEByZXR1cm4ge0Fic3RyYWN0TG9hZGVyfSBBIGxvYWRlciB0aGF0IGNhbiBiZSB1c2VkIHRvIGxvYWQgY29udGVudC4KCSAqIEBwcml2YXRlCgkgKi8KCXAuX2NyZWF0ZUxvYWRlciA9IGZ1bmN0aW9uKGl0ZW0pIHsKCQkvLyBJbml0aWFsbHksIHRyeSBhbmQgdXNlIHRoZSBwcm92aWRlZC9zdXBwb3J0ZWQgWEhSIG1vZGU6CgkJdmFyIHVzZVhIUiA9IHRoaXMudXNlWEhSOwoKCQkvLyBEZXRlcm1pbmUgdGhlIFhIUiB1c2FnZSBvdmVycmlkZXM6CgkJc3dpdGNoIChpdGVtLnR5cGUpIHsKCQkJY2FzZSBjcmVhdGVqcy5Mb2FkUXVldWUuSlNPTjoKCQkJY2FzZSBjcmVhdGVqcy5Mb2FkUXVldWUuTUFOSUZFU1Q6CgkJCQl1c2VYSFIgPSAhaXRlbS5fbG9hZEFzSlNPTlA7CgkJCQlicmVhazsKCQkJY2FzZSBjcmVhdGVqcy5Mb2FkUXVldWUuWE1MOgoJCQljYXNlIGNyZWF0ZWpzLkxvYWRRdWV1ZS5URVhUOgoJCQkJdXNlWEhSID0gdHJ1ZTsgLy8gQWx3YXlzIHVzZSBYSFIyIHdpdGggdGV4dC9YTUwKCQkJCWJyZWFrOwoJCQljYXNlIGNyZWF0ZWpzLkxvYWRRdWV1ZS5TT1VORDoKCQkJY2FzZSBjcmVhdGVqcy5Mb2FkUXVldWUuSlNPTlA6CgkJCQl1c2VYSFIgPSBmYWxzZTsgLy8gTmV2ZXIgbG9hZCBhdWRpbyB1c2luZyBYSFIuIFdlYkF1ZGlvIHdpbGwgcHJvdmlkZSBpdHMgb3duIGxvYWRlci4KCQkJCWJyZWFrOwoJCQljYXNlIG51bGw6CgkJCQlyZXR1cm4gbnVsbDsKCQkJLy8gTm90ZTogSU1BR0UsIENTUywgU0NSSVBULCBTVkcgY2FuIGFsbCB1c2UgVEFHUyBvciBYSFIuCgkJfQoKCQlpZiAodXNlWEhSKSB7CgkJCXJldHVybiBuZXcgY3JlYXRlanMuWEhSTG9hZGVyKGl0ZW0sIHRoaXMuX2Nyb3NzT3JpZ2luKTsKCQl9IGVsc2UgewoJCQlyZXR1cm4gbmV3IGNyZWF0ZWpzLlRhZ0xvYWRlcihpdGVtKTsKCQl9Cgl9OwoKCgkvKioKCSAqIExvYWQgdGhlIG5leHQgaXRlbSBpbiB0aGUgcXVldWUuIElmIHRoZSBxdWV1ZSBpcyBlbXB0eSAoYWxsIGl0ZW1zIGhhdmUgYmVlbiBsb2FkZWQpLCB0aGVuIHRoZSBjb21wbGV0ZSBldmVudAoJICogaXMgcHJvY2Vzc2VkLiBUaGUgcXVldWUgd2lsbCAiZmlsbCB1cCIgYW55IGVtcHR5IHNsb3RzLCB1cCB0byB0aGUgbWF4IGNvbm5lY3Rpb24gc3BlY2lmaWVkIHVzaW5nCgkgKiB7eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZS5zZXRNYXhDb25uZWN0aW9ucyJ9fXt7L2Nyb3NzTGlua319IG1ldGhvZC4gVGhlIG9ubHkgZXhjZXB0aW9uIGlzIHNjcmlwdHMgdGhhdCBhcmUgbG9hZGVkCgkgKiB1c2luZyB0YWdzLCB3aGljaCBoYXZlIHRvIGJlIGxvYWRlZCBvbmUgYXQgYSB0aW1lIHRvIG1haW50YWluIGxvYWQgb3JkZXIuCgkgKiBAbWV0aG9kIF9sb2FkTmV4dAoJICogQHByaXZhdGUKCSAqLwoJcC5fbG9hZE5leHQgPSBmdW5jdGlvbigpIHsKCQlpZiAodGhpcy5fcGF1c2VkKSB7IHJldHVybjsgfQoKCQkvLyBPbmx5IGRpc3BhdGNoIGxvYWRzdGFydCBldmVudCB3aGVuIHRoZSBmaXJzdCBmaWxlIGlzIGxvYWRlZC4KCQlpZiAoIXRoaXMuX2xvYWRTdGFydFdhc0Rpc3BhdGNoZWQpIHsKCQkJdGhpcy5fc2VuZExvYWRTdGFydCgpOwoJCQl0aGlzLl9sb2FkU3RhcnRXYXNEaXNwYXRjaGVkID0gdHJ1ZTsKCQl9CgoJCS8vIFRoZSBxdWV1ZSBoYXMgY29tcGxldGVkLgoJCWlmICh0aGlzLl9udW1JdGVtcyA9PSB0aGlzLl9udW1JdGVtc0xvYWRlZCkgewoJCQl0aGlzLmxvYWRlZCA9IHRydWU7CgkJCXRoaXMuX3NlbmRDb21wbGV0ZSgpOwoKCQkJLy8gTG9hZCB0aGUgbmV4dCBxdWV1ZSwgaWYgaXQgaGFzIGJlZW4gZGVmaW5lZC4KCQkJaWYgKHRoaXMubmV4dCAmJiB0aGlzLm5leHQubG9hZCkgewoJCQkJdGhpcy5uZXh0LmxvYWQoKTsKCQkJfQoJCX0gZWxzZSB7CgkJCXRoaXMubG9hZGVkID0gZmFsc2U7CgkJfQoKCQkvLyBNdXN0IGl0ZXJhdGUgZm9yd2FyZHMgdG8gbG9hZCBpbiB0aGUgcmlnaHQgb3JkZXIuCgkJZm9yICh2YXIgaT0wOyBpPHRoaXMuX2xvYWRRdWV1ZS5sZW5ndGg7IGkrKykgewoJCQlpZiAodGhpcy5fY3VycmVudExvYWRzLmxlbmd0aCA+PSB0aGlzLl9tYXhDb25uZWN0aW9ucykgeyBicmVhazsgfQoJCQl2YXIgbG9hZGVyID0gdGhpcy5fbG9hZFF1ZXVlW2ldOwoKCQkJLy8gRGV0ZXJtaW5lIGlmIHdlIHNob3VsZCBiZSBvbmx5IGxvYWRpbmcgb25lIGF0IGEgdGltZToKCQkJaWYgKHRoaXMubWFpbnRhaW5TY3JpcHRPcmRlcgoJCQkJCSYmIGxvYWRlciBpbnN0YW5jZW9mIGNyZWF0ZWpzLlRhZ0xvYWRlcgoJCQkJCSYmIGxvYWRlci5nZXRJdGVtKCkudHlwZSA9PSBjcmVhdGVqcy5Mb2FkUXVldWUuSkFWQVNDUklQVCkgewoJCQkJaWYgKHRoaXMuX2N1cnJlbnRseUxvYWRpbmdTY3JpcHQpIHsgY29udGludWU7IH0gLy8gTGF0ZXIgaXRlbXMgaW4gdGhlIHF1ZXVlIG1pZ2h0IG5vdCBiZSBzY3JpcHRzLgoJCQkJdGhpcy5fY3VycmVudGx5TG9hZGluZ1NjcmlwdCA9IHRydWU7CgkJCX0KCQkJdGhpcy5fbG9hZFF1ZXVlLnNwbGljZShpLCAxKTsKICAJCQlpLS07CiAgICAgICAgICAgIHRoaXMuX2xvYWRJdGVtKGxvYWRlcik7CgkJfQoJfTsKCgkvKioKCSAqIEJlZ2luIGxvYWRpbmcgYW4gaXRlbS4gRXZlbnRzIGFyZSBub3QgYWRkZWQgdG8gdGhlIGxvYWRlcnMgdW50aWwgdGhlIGxvYWQgc3RhcnRzLgoJICogQG1ldGhvZCBfbG9hZEl0ZW0KCSAqIEBwYXJhbSB7QWJzdHJhY3RMb2FkZXJ9IGxvYWRlciBUaGUgbG9hZGVyIGluc3RhbmNlIHRvIHN0YXJ0LiBDdXJyZW50bHksIHRoaXMgd2lsbCBiZSBhbiBYSFJMb2FkZXIgb3IgVGFnTG9hZGVyLgoJICogQHByaXZhdGUKCSAqLwoJcC5fbG9hZEl0ZW0gPSBmdW5jdGlvbihsb2FkZXIpIHsKCQlsb2FkZXIub24oInByb2dyZXNzIiwgdGhpcy5faGFuZGxlUHJvZ3Jlc3MsIHRoaXMpOwoJCWxvYWRlci5vbigiY29tcGxldGUiLCB0aGlzLl9oYW5kbGVGaWxlQ29tcGxldGUsIHRoaXMpOwoJCWxvYWRlci5vbigiZXJyb3IiLCB0aGlzLl9oYW5kbGVGaWxlRXJyb3IsIHRoaXMpOwoJCXRoaXMuX2N1cnJlbnRMb2Fkcy5wdXNoKGxvYWRlcik7CgkJdGhpcy5fc2VuZEZpbGVTdGFydChsb2FkZXIuZ2V0SXRlbSgpKTsKCQlsb2FkZXIubG9hZCgpOwoJfTsKCgkvKioKCSAqIFRoZSBjYWxsYmFjayB0aGF0IGlzIGZpcmVkIHdoZW4gYSBsb2FkZXIgZW5jb3VudGVycyBhbiBlcnJvci4gVGhlIHF1ZXVlIHdpbGwgY29udGludWUgbG9hZGluZyB1bmxlc3Mge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvc3RvcE9uRXJyb3I6cHJvcGVydHkifX17ey9jcm9zc0xpbmt9fQoJICogaXMgc2V0IHRvIGB0cnVlYC4KCSAqIEBtZXRob2QgX2hhbmRsZUZpbGVFcnJvcgoJICogQHBhcmFtIHtPYmplY3R9IGV2ZW50IFRoZSBlcnJvciBldmVudCwgY29udGFpbmluZyByZWxldmFudCBlcnJvciBpbmZvcm1hdGlvbi4KCSAqIEBwcml2YXRlCgkgKi8KCXAuX2hhbmRsZUZpbGVFcnJvciA9IGZ1bmN0aW9uKGV2ZW50KSB7CgkJdmFyIGxvYWRlciA9IGV2ZW50LnRhcmdldDsKCQl0aGlzLl9udW1JdGVtc0xvYWRlZCsrOwoJCXRoaXMuX3VwZGF0ZVByb2dyZXNzKCk7CgoJCXZhciBuZXdFdmVudCA9IG5ldyBjcmVhdGVqcy5FdmVudCgiZXJyb3IiKTsKCQluZXdFdmVudC50ZXh0ID0gIkZJTEVfTE9BRF9FUlJPUiI7CgkJbmV3RXZlbnQuaXRlbSA9IGxvYWRlci5nZXRJdGVtKCk7CgkJLy8gVE9ETzogUHJvcGFnYXRlIGFjdHVhbCBlcnJvciBtZXNzYWdlLgoKCQl0aGlzLl9zZW5kRXJyb3IobmV3RXZlbnQpOwoKCQlpZiAoIXRoaXMuc3RvcE9uRXJyb3IpIHsKCQkJdGhpcy5fcmVtb3ZlTG9hZEl0ZW0obG9hZGVyKTsKCQkJdGhpcy5fbG9hZE5leHQoKTsKCQl9Cgl9OwoKCS8qKgoJICogQW4gaXRlbSBoYXMgZmluaXNoZWQgbG9hZGluZy4gV2UgY2FuIGFzc3VtZSB0aGF0IGl0IGlzIHRvdGFsbHkgbG9hZGVkLCBoYXMgYmVlbiBwYXJzZWQgZm9yIGltbWVkaWF0ZSB1c2UsIGFuZAoJICogaXMgYXZhaWxhYmxlIGFzIHRoZSAicmVzdWx0IiBwcm9wZXJ0eSBvbiB0aGUgbG9hZCBpdGVtLiBUaGUgcmF3IHRleHQgcmVzdWx0IGZvciBhIHBhcnNlZCBpdGVtIChzdWNoIGFzIEpTT04sIFhNTCwKCSAqIENTUywgSmF2YVNjcmlwdCwgZXRjKSBpcyBhdmFpbGFibGUgYXMgdGhlICJyYXdSZXN1bHQiIGV2ZW50LCBhbmQgY2FuIGFsc28gYmUgbG9va2VkIHVwIHVzaW5nIHt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlL2dldFJlc3VsdCJ9fXt7L2Nyb3NzTGlua319LgoJICogQG1ldGhvZCBfaGFuZGxlRmlsZUNvbXBsZXRlCgkgKiBAcGFyYW0ge09iamVjdH0gZXZlbnQgVGhlIGV2ZW50IG9iamVjdCBmcm9tIHRoZSBsb2FkZXIuCgkgKiBAcHJpdmF0ZQoJICovCglwLl9oYW5kbGVGaWxlQ29tcGxldGUgPSBmdW5jdGlvbihldmVudCkgewoJCXZhciBsb2FkZXIgPSBldmVudC50YXJnZXQ7CgkJdmFyIGl0ZW0gPSBsb2FkZXIuZ2V0SXRlbSgpOwoKCQl0aGlzLl9sb2FkZWRSZXN1bHRzW2l0ZW0uaWRdID0gbG9hZGVyLmdldFJlc3VsdCgpOwoJCWlmIChsb2FkZXIgaW5zdGFuY2VvZiBjcmVhdGVqcy5YSFJMb2FkZXIpIHsKCQkJdGhpcy5fbG9hZGVkUmF3UmVzdWx0c1tpdGVtLmlkXSA9IGxvYWRlci5nZXRSZXN1bHQodHJ1ZSk7CgkJfQoKCQl0aGlzLl9yZW1vdmVMb2FkSXRlbShsb2FkZXIpOwoKCQkvLyBFbnN1cmUgdGhhdCBzY3JpcHQgbG9hZGluZyBoYXBwZW5zIGluIHRoZSByaWdodCBvcmRlci4KCQlpZiAodGhpcy5tYWludGFpblNjcmlwdE9yZGVyICYmIGl0ZW0udHlwZSA9PSBjcmVhdGVqcy5Mb2FkUXVldWUuSkFWQVNDUklQVCkgewoJCQlpZiAobG9hZGVyIGluc3RhbmNlb2YgY3JlYXRlanMuVGFnTG9hZGVyKSB7CgkJCQl0aGlzLl9jdXJyZW50bHlMb2FkaW5nU2NyaXB0ID0gZmFsc2U7CgkJCX0gZWxzZSB7CgkJCQl0aGlzLl9sb2FkZWRTY3JpcHRzW2NyZWF0ZWpzLmluZGV4T2YodGhpcy5fc2NyaXB0T3JkZXIsIGl0ZW0pXSA9IGl0ZW07CgkJCQl0aGlzLl9jaGVja1NjcmlwdExvYWRPcmRlcihsb2FkZXIpOwoJCQkJcmV0dXJuOwoJCQl9CgkJfQoKCQkvLyBDbGVhbiB1cCB0aGUgbG9hZCBpdGVtCgkJZGVsZXRlIGl0ZW0uX2xvYWRBc0pTT05QOwoKCQkvLyBJZiB0aGUgaXRlbSB3YXMgYSBtYW5pZmVzdCwgdGhlbgoJCWlmIChpdGVtLnR5cGUgPT0gY3JlYXRlanMuTG9hZFF1ZXVlLk1BTklGRVNUKSB7CgkJCXZhciByZXN1bHQgPSBsb2FkZXIuZ2V0UmVzdWx0KCk7CgkJCWlmIChyZXN1bHQgIT0gbnVsbCAmJiByZXN1bHQubWFuaWZlc3QgIT09IHVuZGVmaW5lZCkgewoJCQkJdGhpcy5sb2FkTWFuaWZlc3QocmVzdWx0LCB0cnVlKTsKCQkJfQoJCX0KCgkJdGhpcy5fcHJvY2Vzc0ZpbmlzaGVkTG9hZChpdGVtLCBsb2FkZXIpOwoJfTsKCgkvKioKCSAqIEBtZXRob2QgX3Byb2Nlc3NGaW5pc2hlZExvYWQKCSAqIEBwYXJhbSB7T2JqZWN0fSBpdGVtCgkgKiBAcGFyYW0ge0Fic3RyYWN0TG9hZGVyfSBsb2FkZXIKCSAqIEBwcm90ZWN0ZWQKCSAqLwoJcC5fcHJvY2Vzc0ZpbmlzaGVkTG9hZCA9IGZ1bmN0aW9uKGl0ZW0sIGxvYWRlcikgewoJCS8vIE9sZCBoYW5kbGVGaWxlVGFnQ29tcGxldGUgZm9sbG93cyBoZXJlLgoJCXRoaXMuX251bUl0ZW1zTG9hZGVkKys7CgoJCXRoaXMuX3VwZGF0ZVByb2dyZXNzKCk7CgkJdGhpcy5fc2VuZEZpbGVDb21wbGV0ZShpdGVtLCBsb2FkZXIpOwoKCQl0aGlzLl9sb2FkTmV4dCgpOwoJfTsKCgkvKioKCSAqIEVuc3VyZSB0aGUgc2NyaXB0cyBsb2FkIGFuZCBkaXNwYXRjaCBpbiB0aGUgY29ycmVjdCBvcmRlci4gV2hlbiB1c2luZyBYSFIsIHNjcmlwdHMgYXJlIHN0b3JlZCBpbiBhbiBhcnJheSBpbiB0aGUKCSAqIG9yZGVyIHRoZXkgd2VyZSBhZGRlZCwgYnV0IHdpdGggYSAibnVsbCIgdmFsdWUuIFdoZW4gdGhleSBhcmUgY29tcGxldGVkLCB0aGUgdmFsdWUgaXMgc2V0IHRvIHRoZSBsb2FkIGl0ZW0sCgkgKiBhbmQgdGhlbiB3aGVuIHRoZXkgYXJlIHByb2Nlc3NlZCBhbmQgZGlzcGF0Y2hlZCwgdGhlIHZhbHVlIGlzIHNldCB0byA8Y29kZT50cnVlPC9jb2RlPi4gVGhpcyBtZXRob2Qgc2ltcGx5CgkgKiBpdGVyYXRlcyB0aGUgYXJyYXksIGFuZCBlbnN1cmVzIHRoYXQgYW55IGxvYWRlZCBpdGVtcyB0aGF0IGFyZSBub3QgcHJlY2VkZWQgYnkgYSA8Y29kZT5udWxsPC9jb2RlPiB2YWx1ZSBhcmUKCSAqIGRpc3BhdGNoZWQuCgkgKiBAbWV0aG9kIF9jaGVja1NjcmlwdExvYWRPcmRlcgoJICogQHByaXZhdGUKCSAqLwoJcC5fY2hlY2tTY3JpcHRMb2FkT3JkZXIgPSBmdW5jdGlvbiAoKSB7CgkJdmFyIGwgPSB0aGlzLl9sb2FkZWRTY3JpcHRzLmxlbmd0aDsKCgkJZm9yICh2YXIgaT0wO2k8bDtpKyspIHsKCQkJdmFyIGl0ZW0gPSB0aGlzLl9sb2FkZWRTY3JpcHRzW2ldOwoJCQlpZiAoaXRlbSA9PT0gbnVsbCkgeyBicmVhazsgfSAvLyBUaGlzIGlzIHN0aWxsIGxvYWRpbmcuIERvIG5vdCBwcm9jZXNzIGZ1cnRoZXIuCgkJCWlmIChpdGVtID09PSB0cnVlKSB7IGNvbnRpbnVlOyB9IC8vIFRoaXMgaGFzIGNvbXBsZXRlZCwgYW5kIGJlZW4gcHJvY2Vzc2VkLiBNb3ZlIG9uLgoKCQkJLy8gQXBwZW5kIHNjcmlwdCB0YWdzIHRvIHRoZSBoZWFkIGF1dG9tYXRpY2FsbHkuIFRhZ3MgZG8gdGhpcyBpbiB0aGUgbG9hZGVyLCBidXQgWEhSIHNjcmlwdHMgaGF2ZSB0byBtYWludGFpbiBvcmRlci4KCQkJdmFyIGxvYWRJdGVtID0gdGhpcy5fbG9hZGVkUmVzdWx0c1tpdGVtLmlkXTsKCQkJKGRvY3VtZW50LmJvZHkgfHwgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImJvZHkiKVswXSkuYXBwZW5kQ2hpbGQobG9hZEl0ZW0pOwoKCQkJdGhpcy5fcHJvY2Vzc0ZpbmlzaGVkTG9hZChpdGVtKTsKCQkJdGhpcy5fbG9hZGVkU2NyaXB0c1tpXSA9IHRydWU7CgkJfQoJfTsKCgkvKioKCSAqIEEgbG9hZCBpdGVtIGlzIGNvbXBsZXRlZCBvciB3YXMgY2FuY2VsZWQsIGFuZCBuZWVkcyB0byBiZSByZW1vdmVkIGZyb20gdGhlIExvYWRRdWV1ZS4KCSAqIEBtZXRob2QgX3JlbW92ZUxvYWRJdGVtCgkgKiBAcGFyYW0ge0Fic3RyYWN0TG9hZGVyfSBsb2FkZXIgQSBsb2FkZXIgaW5zdGFuY2UgdG8gcmVtb3ZlLgoJICogQHByaXZhdGUKCSAqLwoJcC5fcmVtb3ZlTG9hZEl0ZW0gPSBmdW5jdGlvbihsb2FkZXIpIHsKCQl2YXIgbCA9IHRoaXMuX2N1cnJlbnRMb2Fkcy5sZW5ndGg7CgkJZm9yICh2YXIgaT0wO2k8bDtpKyspIHsKCQkJaWYgKHRoaXMuX2N1cnJlbnRMb2Fkc1tpXSA9PSBsb2FkZXIpIHsKCQkJCXRoaXMuX2N1cnJlbnRMb2Fkcy5zcGxpY2UoaSwxKTsgYnJlYWs7CgkJCX0KCQl9Cgl9OwoKCS8qKgoJICogQW4gaXRlbSBoYXMgZGlzcGF0Y2hlZCBwcm9ncmVzcy4gUHJvcGFnYXRlIHRoYXQgcHJvZ3Jlc3MsIGFuZCB1cGRhdGUgdGhlIExvYWRRdWV1ZSBvdmVyYWxsIHByb2dyZXNzLgoJICogQG1ldGhvZCBfaGFuZGxlUHJvZ3Jlc3MKCSAqIEBwYXJhbSB7T2JqZWN0fSBldmVudCBUaGUgcHJvZ3Jlc3MgZXZlbnQgZnJvbSB0aGUgaXRlbS4KCSAqIEBwcml2YXRlCgkgKi8KCXAuX2hhbmRsZVByb2dyZXNzID0gZnVuY3Rpb24oZXZlbnQpIHsKCQl2YXIgbG9hZGVyID0gZXZlbnQudGFyZ2V0OwoJCXRoaXMuX3NlbmRGaWxlUHJvZ3Jlc3MobG9hZGVyLmdldEl0ZW0oKSwgbG9hZGVyLnByb2dyZXNzKTsKCQl0aGlzLl91cGRhdGVQcm9ncmVzcygpOwoJfTsKCgkvKioKCSAqIE92ZXJhbGwgcHJvZ3Jlc3MgaGFzIGNoYW5nZWQsIHNvIGRldGVybWluZSB0aGUgbmV3IHByb2dyZXNzIGFtb3VudCBhbmQgZGlzcGF0Y2ggaXQuIFRoaXMgY2hhbmdlcyBhbnkgdGltZSBhbgoJICogaXRlbSBkaXNwYXRjaGVzIHByb2dyZXNzIG9yIGNvbXBsZXRlcy4gTm90ZSB0aGF0IHNpbmNlIHdlIGRvbid0IGtub3cgdGhlIGFjdHVhbCBmaWxlc2l6ZSBvZiBpdGVtcyBiZWZvcmUgdGhleSBhcmUKCSAqIGxvYWRlZCwgYW5kIGV2ZW4gdGhlbiB3ZSBjYW4gb25seSBnZXQgdGhlIHNpemUgb2YgaXRlbXMgbG9hZGVkIHdpdGggWEhSLiBJbiB0aGlzIGNhc2UsIHdlIGRlZmluZSBhICJzbG90IiBmb3IKCSAqIGVhY2ggaXRlbSAoMSBpdGVtIGluIDEwIHdvdWxkIGdldCAxMCUpLCBhbmQgdGhlbiBhcHBlbmQgbG9hZGVkIHByb2dyZXNzIG9uIHRvcCBvZiB0aGUgYWxyZWFkeS1sb2FkZWQgaXRlbXMuCgkgKgoJICogRm9yIGV4YW1wbGUsIGlmIDUvMTAgaXRlbXMgaGF2ZSBsb2FkZWQsIGFuZCBpdGVtIDYgaXMgMjAlIGxvYWRlZCwgdGhlIHRvdGFsIHByb2dyZXNzIHdvdWxkIGJlOjx1bD4KCSAqICAgICAgPGxpPjUvMTAgb2YgdGhlIGl0ZW1zIGluIHRoZSBxdWV1ZSAoNTAlKTwvbGk+CgkgKiAgICAgIDxsaT5wbHVzIDIwJSBvZiBpdGVtIDYncyBzbG90ICgyJSk8L2xpPgoJICogICAgICA8bGk+ZXF1YWxzIDUyJTwvbGk+PC91bD4KCSAqIEBtZXRob2QgX3VwZGF0ZVByb2dyZXNzCgkgKiBAcHJpdmF0ZQoJICovCglwLl91cGRhdGVQcm9ncmVzcyA9IGZ1bmN0aW9uICgpIHsKCQl2YXIgbG9hZGVkID0gdGhpcy5fbnVtSXRlbXNMb2FkZWQgLyB0aGlzLl9udW1JdGVtczsgLy8gRnVsbHkgTG9hZGVkIFByb2dyZXNzCgkJdmFyIHJlbWFpbmluZyA9IHRoaXMuX251bUl0ZW1zLXRoaXMuX251bUl0ZW1zTG9hZGVkOwoJCWlmIChyZW1haW5pbmcgPiAwKSB7CgkJCXZhciBjaHVuayA9IDA7CgkJCWZvciAodmFyIGk9MCwgbD10aGlzLl9jdXJyZW50TG9hZHMubGVuZ3RoOyBpPGw7IGkrKykgewoJCQkJY2h1bmsgKz0gdGhpcy5fY3VycmVudExvYWRzW2ldLnByb2dyZXNzOwoJCQl9CgkJCWxvYWRlZCArPSAoY2h1bmsgLyByZW1haW5pbmcpICogKHJlbWFpbmluZy90aGlzLl9udW1JdGVtcyk7CgkJfQoJCXRoaXMuX3NlbmRQcm9ncmVzcyhsb2FkZWQpOwoJfTsKCgkvKioKCSAqIENsZWFuIG91dCBpdGVtIHJlc3VsdHMsIHRvIGZyZWUgdGhlbSBmcm9tIG1lbW9yeS4gTWFpbmx5LCB0aGUgbG9hZGVkIGl0ZW0gYW5kIHJlc3VsdHMgYXJlIGNsZWFyZWQgZnJvbSBpbnRlcm5hbAoJICogaGFzaGVzLgoJICogQG1ldGhvZCBfZGlzcG9zZUl0ZW0KCSAqIEBwYXJhbSB7T2JqZWN0fSBpdGVtIFRoZSBpdGVtIHRoYXQgd2FzIHBhc3NlZCBpbiBmb3IgcHJlbG9hZGluZy4KCSAqIEBwcml2YXRlCgkgKi8KCXAuX2Rpc3Bvc2VJdGVtID0gZnVuY3Rpb24oaXRlbSkgewoJCWRlbGV0ZSB0aGlzLl9sb2FkZWRSZXN1bHRzW2l0ZW0uaWRdOwoJCWRlbGV0ZSB0aGlzLl9sb2FkZWRSYXdSZXN1bHRzW2l0ZW0uaWRdOwoJCWRlbGV0ZSB0aGlzLl9sb2FkSXRlbXNCeUlkW2l0ZW0uaWRdOwoJCWRlbGV0ZSB0aGlzLl9sb2FkSXRlbXNCeVNyY1tpdGVtLnNyY107Cgl9OwoKCgkvKioKCSAqIENyZWF0ZSBhbiBIVE1MIHRhZy4gVGhpcyBpcyBpbiBMb2FkUXVldWUgaW5zdGVhZCBvZiB7eyNjcm9zc0xpbmsgIlRhZ0xvYWRlciJ9fXt7L2Nyb3NzTGlua319IGJlY2F1c2Ugbm8gbWF0dGVyCgkgKiBob3cgd2UgbG9hZCB0aGUgZGF0YSwgd2UgbWF5IG5lZWQgdG8gcmV0dXJuIGl0IGluIGEgdGFnLgoJICogQG1ldGhvZCBfY3JlYXRlVGFnCgkgKiBAcGFyYW0ge1N0cmluZ30gdHlwZSBUaGUgaXRlbSB0eXBlLiBJdGVtcyBhcmUgcGFzc2VkIGluIGJ5IHRoZSBkZXZlbG9wZXIsIG9yIGRldGVyZW1pbmVkIGJ5IHRoZSBleHRlbnNpb24uCgkgKiBAcmV0dXJuIHtIVE1MSW1hZ2VFbGVtZW50fEhUTUxBdWRpb0VsZW1lbnR8SFRNTFNjcmlwdEVsZW1lbnR8SFRNTExpbmtFbGVtZW50fE9iamVjdH0gVGhlIHRhZyB0aGF0IGlzIGNyZWF0ZWQuCgkgKiBOb3RlIHRoYXQgdGFncyBhcmUgbm90IGFwcGVuZGVkIHRvIHRoZSBIVE1MIGJvZHkuCgkgKiBAcHJpdmF0ZQoJICovCglwLl9jcmVhdGVUYWcgPSBmdW5jdGlvbihpdGVtKSB7CgkJdmFyIHRhZyA9IG51bGw7CgkJc3dpdGNoIChpdGVtLnR5cGUpIHsKCQkJY2FzZSBjcmVhdGVqcy5Mb2FkUXVldWUuSU1BR0U6CgkJCQl0YWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbWciKTsKCQkJCWlmICh0aGlzLl9jcm9zc09yaWdpbiAhPSAiIiAmJiAhdGhpcy5faXNMb2NhbChpdGVtKSkgeyB0YWcuY3Jvc3NPcmlnaW4gPSB0aGlzLl9jcm9zc09yaWdpbjsgfQoJCQkJcmV0dXJuIHRhZzsKCQkJY2FzZSBjcmVhdGVqcy5Mb2FkUXVldWUuU09VTkQ6CgkJCQl0YWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJhdWRpbyIpOwoJCQkJdGFnLmF1dG9wbGF5ID0gZmFsc2U7CgkJCQkvLyBOb3RlOiBUaGUgdHlwZSBwcm9wZXJ0eSBkb2Vzbid0IHNlZW0gbmVjZXNzYXJ5LgoJCQkJcmV0dXJuIHRhZzsKCQkJY2FzZSBjcmVhdGVqcy5Mb2FkUXVldWUuSlNPTjoKCQkJY2FzZSBjcmVhdGVqcy5Mb2FkUXVldWUuSlNPTlA6CgkJCWNhc2UgY3JlYXRlanMuTG9hZFF1ZXVlLkpBVkFTQ1JJUFQ6CgkJCWNhc2UgY3JlYXRlanMuTG9hZFF1ZXVlLk1BTklGRVNUOgoJCQkJdGFnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic2NyaXB0Iik7CgkJCQl0YWcudHlwZSA9ICJ0ZXh0L2phdmFzY3JpcHQiOwoJCQkJcmV0dXJuIHRhZzsKCQkJY2FzZSBjcmVhdGVqcy5Mb2FkUXVldWUuQ1NTOgoJCQkJaWYgKHRoaXMudXNlWEhSKSB7CgkJCQkJdGFnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic3R5bGUiKTsKCQkJCX0gZWxzZSB7CgkJCQkJdGFnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgibGluayIpOwoJCQkJfQoJCQkJdGFnLnJlbCAgPSAic3R5bGVzaGVldCI7CgkJCQl0YWcudHlwZSA9ICJ0ZXh0L2NzcyI7CgkJCQlyZXR1cm4gdGFnOwoJCQljYXNlIGNyZWF0ZWpzLkxvYWRRdWV1ZS5TVkc6CgkJCQlpZiAodGhpcy51c2VYSFIpIHsKCQkJCQl0YWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzdmciKTsKCQkJCX0gZWxzZSB7CgkJCQkJdGFnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgib2JqZWN0Iik7CgkJCQkJdGFnLnR5cGUgPSAiaW1hZ2Uvc3ZnK3htbCI7CgkJCQl9CgkJCQlyZXR1cm4gdGFnOwoJCX0KCQlyZXR1cm4gbnVsbDsKCX07CgoJLyoqCgkgKiBEZXRlcm1pbmUgdGhlIHR5cGUgb2YgdGhlIG9iamVjdCB1c2luZyBjb21tb24gZXh0ZW5zaW9ucy4gTm90ZSB0aGF0IHRoZSB0eXBlIGNhbiBiZSBwYXNzZWQgaW4gd2l0aCB0aGUgbG9hZCBpdGVtCgkgKiBpZiBpdCBpcyBhbiB1bnVzdWFsIGV4dGVuc2lvbi4KCSAqIEBwYXJhbSB7U3RyaW5nfSBleHRlbnNpb24gVGhlIGZpbGUgZXh0ZW5zaW9uIHRvIHVzZSB0byBkZXRlcm1pbmUgdGhlIGxvYWQgdHlwZS4KCSAqIEByZXR1cm4ge1N0cmluZ30gVGhlIGRldGVybWluZWQgbG9hZCB0eXBlIChmb3IgZXhhbXBsZSwgPGNvZGU+TG9hZFF1ZXVlLklNQUdFPC9jb2RlPiBvciBudWxsIGlmIGl0IGNhbiBub3QgYmUKCSAqIGRldGVybWluZWQgYnkgdGhlIGV4dGVuc2lvbi4KCSAqIEBwcml2YXRlCgkgKi8KCXAuX2dldFR5cGVCeUV4dGVuc2lvbiA9IGZ1bmN0aW9uKGV4dGVuc2lvbikgewoJCWlmIChleHRlbnNpb24gPT0gbnVsbCkgewoJCQlyZXR1cm4gY3JlYXRlanMuTG9hZFF1ZXVlLlRFWFQ7CgkJfQoJCXN3aXRjaCAoZXh0ZW5zaW9uLnRvTG93ZXJDYXNlKCkpIHsKCQkJY2FzZSAianBlZyI6CgkJCWNhc2UgImpwZyI6CgkJCWNhc2UgImdpZiI6CgkJCWNhc2UgInBuZyI6CgkJCWNhc2UgIndlYnAiOgoJCQljYXNlICJibXAiOgoJCQkJcmV0dXJuIGNyZWF0ZWpzLkxvYWRRdWV1ZS5JTUFHRTsKCQkJY2FzZSAib2dnIjoKCQkJY2FzZSAibXAzIjoKCQkJY2FzZSAid2F2IjoKCQkJCXJldHVybiBjcmVhdGVqcy5Mb2FkUXVldWUuU09VTkQ7CgkJCWNhc2UgImpzb24iOgoJCQkJcmV0dXJuIGNyZWF0ZWpzLkxvYWRRdWV1ZS5KU09OOwoJCQljYXNlICJ4bWwiOgoJCQkJcmV0dXJuIGNyZWF0ZWpzLkxvYWRRdWV1ZS5YTUw7CgkJCWNhc2UgImNzcyI6CgkJCQlyZXR1cm4gY3JlYXRlanMuTG9hZFF1ZXVlLkNTUzsKCQkJY2FzZSAianMiOgoJCQkJcmV0dXJuIGNyZWF0ZWpzLkxvYWRRdWV1ZS5KQVZBU0NSSVBUOwoJCQljYXNlICdzdmcnOgoJCQkJcmV0dXJuIGNyZWF0ZWpzLkxvYWRRdWV1ZS5TVkc7CgkJCWRlZmF1bHQ6CgkJCQlyZXR1cm4gY3JlYXRlanMuTG9hZFF1ZXVlLlRFWFQ7CgkJfQoJfTsKCgkvKioKCSAqIERpc3BhdGNoIGEgZmlsZXByb2dyZXNzIGV2ZW50IChhbmQgb25GaWxlUHJvZ3Jlc3MgY2FsbGJhY2spLiBQbGVhc2Ugc2VlIHRoZSA8Y29kZT5Mb2FkUXVldWUuZmlsZXByb2dyZXNzPC9jb2RlPgoJICogZXZlbnQgZm9yIGRldGFpbHMgb24gdGhlIGV2ZW50IHBheWxvYWQuCgkgKiBAbWV0aG9kIF9zZW5kRmlsZVByb2dyZXNzCgkgKiBAcGFyYW0ge09iamVjdH0gaXRlbSBUaGUgaXRlbSB0aGF0IGlzIGJlaW5nIGxvYWRlZC4KCSAqIEBwYXJhbSB7TnVtYmVyfSBwcm9ncmVzcyBUaGUgYW1vdW50IHRoZSBpdGVtIGhhcyBiZWVuIGxvYWRlZCAoYmV0d2VlbiAwIGFuZCAxKS4KCSAqIEBwcm90ZWN0ZWQKCSAqLwoJcC5fc2VuZEZpbGVQcm9ncmVzcyA9IGZ1bmN0aW9uKGl0ZW0sIHByb2dyZXNzKSB7CgkJaWYgKHRoaXMuX2lzQ2FuY2VsZWQoKSkgewoJCQl0aGlzLl9jbGVhblVwKCk7CgkJCXJldHVybjsKCQl9CgkJaWYgKCF0aGlzLmhhc0V2ZW50TGlzdGVuZXIoImZpbGVwcm9ncmVzcyIpKSB7IHJldHVybjsgfQoKCQl2YXIgZXZlbnQgPSBuZXcgY3JlYXRlanMuRXZlbnQoImZpbGVwcm9ncmVzcyIpOwoJCWV2ZW50LnByb2dyZXNzID0gcHJvZ3Jlc3M7CgkJZXZlbnQubG9hZGVkID0gcHJvZ3Jlc3M7CgkJZXZlbnQudG90YWwgPSAxOwoJCWV2ZW50Lml0ZW0gPSBpdGVtOwoKCQl0aGlzLmRpc3BhdGNoRXZlbnQoZXZlbnQpOwoJfTsKCgkvKioKCSAqIERpc3BhdGNoIGEgZmlsZWxvYWQgZXZlbnQuIFBsZWFzZSBzZWUgdGhlIHt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlL2ZpbGVsb2FkOmV2ZW50In19e3svY3Jvc3NMaW5rfX0gZXZlbnQgZm9yCgkgKiBkZXRhaWxzIG9uIHRoZSBldmVudCBwYXlsb2FkLgoJICogQG1ldGhvZCBfc2VuZEZpbGVDb21wbGV0ZQoJICogQHBhcmFtIHtPYmplY3R9IGl0ZW0gVGhlIGl0ZW0gdGhhdCBpcyBiZWluZyBsb2FkZWQuCgkgKiBAcGFyYW0ge1RhZ0xvYWRlciB8IFhIUkxvYWRlcn0gbG9hZGVyCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXAuX3NlbmRGaWxlQ29tcGxldGUgPSBmdW5jdGlvbihpdGVtLCBsb2FkZXIpIHsKCQlpZiAodGhpcy5faXNDYW5jZWxlZCgpKSB7IHJldHVybjsgfQoKCQl2YXIgZXZlbnQgPSBuZXcgY3JlYXRlanMuRXZlbnQoImZpbGVsb2FkIik7CgkJZXZlbnQubG9hZGVyID0gbG9hZGVyOwoJCWV2ZW50Lml0ZW0gPSBpdGVtOwoJCWV2ZW50LnJlc3VsdCA9IHRoaXMuX2xvYWRlZFJlc3VsdHNbaXRlbS5pZF07CgkJZXZlbnQucmF3UmVzdWx0ID0gdGhpcy5fbG9hZGVkUmF3UmVzdWx0c1tpdGVtLmlkXTsKCiAgICAgICAgLy8gVGhpcyBjYWxscyBhIGhhbmRsZXIgc3BlY2lmaWVkIG9uIHRoZSBhY3R1YWwgbG9hZCBpdGVtLiBDdXJyZW50bHksIHRoZSBTb3VuZEpTIHBsdWdpbiB1c2VzIHRoaXMuCiAgICAgICAgaWYgKGl0ZW0uY29tcGxldGVIYW5kbGVyKSB7CiAgICAgICAgICAgIGl0ZW0uY29tcGxldGVIYW5kbGVyKGV2ZW50KTsKICAgICAgICB9CgoJCXRoaXMuaGFzRXZlbnRMaXN0ZW5lcigiZmlsZWxvYWQiKSAmJiB0aGlzLmRpc3BhdGNoRXZlbnQoZXZlbnQpCgl9OwoKCS8qKgoJICogRGlzcGF0Y2ggYSBmaWxlc3RhcnQgZXZlbnQgaW1tZWRpYXRlbHkgYmVmb3JlIGEgZmlsZSBzdGFydHMgdG8gbG9hZC4gUGxlYXNlIHNlZSB0aGUge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvZmlsZXN0YXJ0OmV2ZW50In19e3svY3Jvc3NMaW5rfX0KCSAqIGV2ZW50IGZvciBkZXRhaWxzIG9uIHRoZSBldmVudCBwYXlsb2FkLgoJICogQG1ldGhvZCBfc2VuZEZpbGVTdGFydAoJICogQHBhcmFtIHtPYmplY3R9IGl0ZW0gVGhlIGl0ZW0gdGhhdCBpcyBiZWluZyBsb2FkZWQuCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXAuX3NlbmRGaWxlU3RhcnQgPSBmdW5jdGlvbihpdGVtKSB7CgkJdmFyIGV2ZW50ID0gbmV3IGNyZWF0ZWpzLkV2ZW50KCJmaWxlc3RhcnQiKTsKCQlldmVudC5pdGVtID0gaXRlbTsKCQl0aGlzLmhhc0V2ZW50TGlzdGVuZXIoImZpbGVzdGFydCIpICYmIHRoaXMuZGlzcGF0Y2hFdmVudChldmVudCk7Cgl9OwoKCS8qKgoJICogUkVNT1ZFRC4gIFVzZSBjcmVhdGVqcy5wcm94eSBpbnN0ZWFkCgkgKiBAbWV0aG9kIHByb3h5CgkgKiBAcGFyYW0ge0Z1bmN0aW9ufSBtZXRob2QgVGhlIGZ1bmN0aW9uIHRvIGNhbGwKCSAqIEBwYXJhbSB7T2JqZWN0fSBzY29wZSBUaGUgc2NvcGUgdG8gY2FsbCB0aGUgbWV0aG9kIG5hbWUgb24KCSAqIEBzdGF0aWMKCSAqIEBwcml2YXRlCgkgKiBAZGVwcmVjYXRlZCBJbiBmYXZvdXIgb2YgdGhlIGNyZWF0ZWpzLnByb3h5IG1ldGhvZCAoc2VlIExvYWRRdWV1ZSBzb3VyY2UpLgoJICovCgoJcC50b1N0cmluZyA9IGZ1bmN0aW9uKCkgewoJCXJldHVybiAiW1ByZWxvYWRKUyBMb2FkUXVldWVdIjsKCX07CgoJY3JlYXRlanMuTG9hZFF1ZXVlID0gTG9hZFF1ZXVlOwoKCi8vIEhlbHBlciBtZXRob2RzCgoJLy8gQW4gYWRkaXRpb25hbCBtb2R1bGUgdG8gZGV0ZXJtaW5lIHRoZSBjdXJyZW50IGJyb3dzZXIsIHZlcnNpb24sIG9wZXJhdGluZyBzeXN0ZW0sIGFuZCBvdGhlciBlbnZpcm9ubWVudGFsIHZhcmlhYmxlcy4KCXZhciBCcm93c2VyRGV0ZWN0ID0gZnVuY3Rpb24oKSB7fQoKCUJyb3dzZXJEZXRlY3QuaW5pdCA9IGZ1bmN0aW9uKCkgewoJCXZhciBhZ2VudCA9IG5hdmlnYXRvci51c2VyQWdlbnQ7CgkJQnJvd3NlckRldGVjdC5pc0ZpcmVmb3ggPSAoYWdlbnQuaW5kZXhPZigiRmlyZWZveCIpID4gLTEpOwoJCUJyb3dzZXJEZXRlY3QuaXNPcGVyYSA9ICh3aW5kb3cub3BlcmEgIT0gbnVsbCk7CgkJQnJvd3NlckRldGVjdC5pc0Nocm9tZSA9IChhZ2VudC5pbmRleE9mKCJDaHJvbWUiKSA+IC0xKTsKCQlCcm93c2VyRGV0ZWN0LmlzSU9TID0gYWdlbnQuaW5kZXhPZigiaVBvZCIpID4gLTEgfHwgYWdlbnQuaW5kZXhPZigiaVBob25lIikgPiAtMSB8fCBhZ2VudC5pbmRleE9mKCJpUGFkIikgPiAtMTsKCX07CgoJQnJvd3NlckRldGVjdC5pbml0KCk7CgoJY3JlYXRlanMuTG9hZFF1ZXVlLkJyb3dzZXJEZXRlY3QgPSBCcm93c2VyRGV0ZWN0OwoKfSgpKTsKLyoKKiBUYWdMb2FkZXIKKiBWaXNpdCBodHRwOi8vY3JlYXRlanMuY29tLyBmb3IgZG9jdW1lbnRhdGlvbiwgdXBkYXRlcyBhbmQgZXhhbXBsZXMuCioKKgoqIENvcHlyaWdodCAoYykgMjAxMiBnc2tpbm5lci5jb20sIGluYy4KKgoqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uCiogb2J0YWluaW5nIGEgY29weSBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24KKiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0CiogcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0cyB0byB1c2UsCiogY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwKKiBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUKKiBTb2Z0d2FyZSBpcyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZwoqIGNvbmRpdGlvbnM6CioKKiBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZQoqIGluY2x1ZGVkIGluIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLgoqCiogVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsCiogRVhQUkVTUyBPUiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTCiogT0YgTUVSQ0hBTlRBQklMSVRZLCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQKKiBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBBVVRIT1JTIE9SIENPUFlSSUdIVAoqIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVIgTElBQklMSVRZLAoqIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORwoqIEZST00sIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IKKiBPVEhFUiBERUFMSU5HUyBJTiBUSEUgU09GVFdBUkUuCiovCgovKioKICogQG1vZHVsZSBQcmVsb2FkSlMKICovCgovLyBuYW1lc3BhY2U6CnRoaXMuY3JlYXRlanMgPSB0aGlzLmNyZWF0ZWpzfHx7fTsKCihmdW5jdGlvbigpIHsKCSJ1c2Ugc3RyaWN0IjsKCS8qKgoJICogQSBwcmVsb2FkZXIgdGhhdCBsb2FkcyBpdGVtcyB1c2luZyBhIHRhZy1iYXNlZCBhcHByb2FjaC4gSFRNTCBhdWRpbyBhbmQgaW1hZ2VzIGNhbiB1c2UgdGhpcyBsb2FkZXIgdG8gbG9hZAoJICogY29udGVudCBjcm9zcy1kb21haW4gd2l0aG91dCBzZWN1cml0eSBlcnJvcnMsIHdoZXJlYXMgYW55dGhpbmcgbG9hZGVkIHdpdGggWEhSIGhhcyBwb3RlbnRpYWwgaXNzdWVzIHdpdGggY3Jvc3MtCgkgKiBkb21haW4gcmVxdWVzdHMuCgkgKgoJICogTm90ZSBmb3IgYXVkaW8gdGFncywgVGFnTG9hZGVyIHJlbGllcyBvbiB0aGUgPGNvZGU+Y2FuUGxheVRocm91Z2g8L2NvZGU+IGV2ZW50LCB3aGljaCBmaXJlcyB3aGVuIHRoZSBidWZmZXIKCSAqIGlzIGZ1bGwgZW5vdWdoIHRvIHBsYXkgdGhlIGF1ZGlvIGFsbCB0aGUgd2F5IHRocm91Z2ggYXQgdGhlIGN1cnJlbnQgZG93bmxvYWQgc3BlZWQuIFRoaXMgY29tcGxldGVseSBwcmVsb2FkcyBtb3N0CgkgKiBzb3VuZCBlZmZlY3RzLCBob3dldmVyIGxvbmdlciB0cmFja3MgbGlrZSBiYWNrZ3JvdW5kIGF1ZGlvIHdpbGwgb25seSBsb2FkIGEgcG9ydGlvbiBiZWZvcmUgdGhlIGV2ZW50IGlzIGZpcmVkLgoJICogTW9zdCBicm93c2VycyAoYWxsIGV4Y2x1ZGluZyBDaHJvbWUpIHdpbGwgY29udGludWUgdG8gcHJlbG9hZCBvbmNlIHRoaXMgaXMgZmlyZWQsIHNvIHRoaXMgaXMgY29uc2lkZXJlZCBnb29kCgkgKiBlbm91Z2ggZm9yIG1vc3QgY2FzZXMuCgkgKiBAY2xhc3MgVGFnTG9hZGVyCgkgKiBAY29uc3RydWN0b3IKCSAqIEBleHRlbmRzIEFic3RyYWN0TG9hZGVyCgkgKiBAcGFyYW0ge09iamVjdH0gaXRlbSBUaGUgaXRlbSB0byBsb2FkLiBQbGVhc2Ugc2VlIHt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlL2xvYWRGaWxlIn19e3svY3Jvc3NMaW5rfX0gZm9yCgkgKiBpbmZvcm1hdGlvbiBvbiBsb2FkIGl0ZW1zLgoJICovCgl2YXIgVGFnTG9hZGVyID0gZnVuY3Rpb24gKGl0ZW0pIHsKCQl0aGlzLmluaXQoaXRlbSk7Cgl9OwoKCXZhciBwID0gVGFnTG9hZGVyLnByb3RvdHlwZSA9IG5ldyBjcmVhdGVqcy5BYnN0cmFjdExvYWRlcigpOwoKLy8gUHJvdGVjdGVkCgoJLyoqCgkgKiBUaGUgdGltZW91dCB0aGF0IGlzIGZpcmVkIGlmIG5vdGhpbmcgaXMgbG9hZGVkIGFmdGVyIGEgY2VydGFpbiBkZWxheS4gU2VlIHRoZSA8Y29kZT5Mb2FkUXVldWUuTE9BRF9USU1FT1VUPC9jb2RlPgoJICogZm9yIHRoZSB0aW1lb3V0IGR1cmF0aW9uLgoJICogQHByb3BlcnR5IF9sb2FkVGltZW91dAoJICogQHR5cGUge051bWJlcn0KCSAqIEBwcml2YXRlCgkgKi8KCXAuX2xvYWRUaW1lb3V0ID0gbnVsbDsKCgkvKioKCSAqIEEgcmVmZXJlbmNlIHRvIGEgYm91bmQgZnVuY3Rpb24sIHdoaWNoIHdlIG5lZWQgaW4gb3JkZXIgdG8gcHJvcGVybHkgcmVtb3ZlIHRoZSBldmVudCBoYW5kbGVyIHdoZW4gdGhlIGxvYWQKCSAqIGNvbXBsZXRlcy4KCSAqIEBwcm9wZXJ0eSBfdGFnQ29tcGxldGVQcm94eQoJICogQHR5cGUge0Z1bmN0aW9ufQoJICogQHByaXZhdGUKCSAqLwoJcC5fdGFnQ29tcGxldGVQcm94eSA9IG51bGw7CgoJLyoqCgkgKiBEZXRlcm1pbmVzIGlmIHRoZSBsb2FkIGl0ZW0gaXMgYW4gYXVkaW8gdGFnLCBzaW5jZSB3ZSB0YWtlIHNvbWUgc3BlY2lmaWMgYXBwcm9hY2hlcyB0byBwcm9wZXJseSBsb2FkIGF1ZGlvLgoJICogQHByb3BlcnR5IF9pc0F1ZGlvCgkgKiBAdHlwZSB7Qm9vbGVhbn0KCSAqIEBkZWZhdWx0IGZhbHNlCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXAuX2lzQXVkaW8gPSBmYWxzZTsKCgkvKioKCSAqIFRoZSBIVE1MIHRhZyBvciBKYXZhU2NyaXB0IG9iamVjdCB0aGlzIGxvYWRlciB1c2VzIHRvIHByZWxvYWQgY29udGVudC4gTm90ZSB0aGF0IGEgdGFnIG1heSBiZSBhIGN1c3RvbSBvYmplY3QKCSAqIHRoYXQgbWF0Y2hlcyB0aGUgQVBJIG9mIGFuIEhUTUwgdGFnIChsb2FkIG1ldGhvZCwgb25sb2FkIGNhbGxiYWNrKS4gRm9yIGV4YW1wbGUsIGZsYXNoIGF1ZGlvIGZyb20gU291bmRKUyBwYXNzZXMKCSAqIGluIGEgY3VzdG9tIG9iamVjdCB0byBoYW5kbGUgcHJlbG9hZGluZyBmb3IgRmxhc2ggYXVkaW8gYW5kIFdlYkF1ZGlvLgoJICogQHByb3BlcnR5IF90YWcKCSAqIEB0eXBlIHtIVE1MQXVkaW9FbGVtZW50IHwgT2JqZWN0fQoJICogQHByaXZhdGUKCSAqLwoJcC5fdGFnID0gbnVsbDsKCgkvKioKCSAqIFdoZW4gbG9hZGluZyBhIEpTT05QIHJlcXVlc3QgdGhpcyB3aWxsIGJlIHRoZSBwYXJzZWQgSlNPTiByZXN1bHQuCgkgKgoJICogQHR5cGUge09iamVjdH0KCSAqIEBwcml2YXRlCgkgKi8KCXAuX2pzb25SZXN1bHQgPSBudWxsOwoKCS8vIE92ZXJyaWRlcyBhYnN0cmFjdCBtZXRob2QgaW4gQWJzdHJhY3RMb2FkZXIKCXAuaW5pdCA9IGZ1bmN0aW9uIChpdGVtKSB7CgkJdGhpcy5faXRlbSA9IGl0ZW07CgkJdGhpcy5fdGFnID0gaXRlbS50YWc7CgkJdGhpcy5faXNBdWRpbyA9ICh3aW5kb3cuSFRNTEF1ZGlvRWxlbWVudCAmJiBpdGVtLnRhZyBpbnN0YW5jZW9mIHdpbmRvdy5IVE1MQXVkaW9FbGVtZW50KTsKCQl0aGlzLl90YWdDb21wbGV0ZVByb3h5ID0gY3JlYXRlanMucHJveHkodGhpcy5faGFuZGxlTG9hZCwgdGhpcyk7Cgl9OwoKCS8qKgoJICogR2V0IHRoZSBsb2FkZWQgY29udGVudC4gVGhpcyBpcyB1c3VhbGx5IGFuIEhUTUwgdGFnIG9yIG90aGVyIHRhZy1zdHlsZSBvYmplY3QgdGhhdCBoYXMgYmVlbiBmdWxseSBsb2FkZWQuIElmIHRoZQoJICogbG9hZGVyIGlzIG5vdCBjb21wbGV0ZSwgdGhpcyB3aWxsIGJlIG51bGwuCgkgKiBAbWV0aG9kIGdldFJlc3VsdAoJICogQHJldHVybiB7SFRNTEltYWdlRWxlbWVudCB8IEhUTUxBdWRpb0VsZW1lbnQgfCBPYmplY3R9IFRoZSBsb2FkZWQgYW5kIHBhcnNlZCBjb250ZW50LgoJICovCglwLmdldFJlc3VsdCA9IGZ1bmN0aW9uKCkgewoJCWlmICh0aGlzLl9pdGVtLnR5cGUgPT0gY3JlYXRlanMuTG9hZFF1ZXVlLkpTT05QIHx8IHRoaXMuX2l0ZW0udHlwZSA9PSBjcmVhdGVqcy5Mb2FkUXVldWUuTUFOSUZFU1QpIHsKCQkJcmV0dXJuIHRoaXMuX2pzb25SZXN1bHQ7CgkJfSBlbHNlIHsKCQkJcmV0dXJuIHRoaXMuX3RhZzsKCQl9Cgl9OwoKCS8vIE92ZXJyaWRlcyBhYnN0cmFjdCBtZXRob2QgaW4gQWJzdHJhY3RMb2FkZXIKCXAuY2FuY2VsID0gZnVuY3Rpb24oKSB7CgkJdGhpcy5jYW5jZWxlZCA9IHRydWU7CgkJdGhpcy5fY2xlYW4oKTsKCX07CgoJLy8gT3ZlcnJpZGVzIGFic3RyYWN0IG1ldGhvZCBpbiBBYnN0cmFjdExvYWRlcgoJcC5sb2FkID0gZnVuY3Rpb24oKSB7CgkJdmFyIGl0ZW0gPSB0aGlzLl9pdGVtOwoJCXZhciB0YWcgPSB0aGlzLl90YWc7CgoJCWNsZWFyVGltZW91dCh0aGlzLl9sb2FkVGltZW91dCk7IC8vIENsZWFyIG91dCBhbnkgZXhpc3RpbmcgdGltZW91dAoJCXZhciBkdXJhdGlvbiA9IGNyZWF0ZWpzLkxvYWRRdWV1ZS5MT0FEX1RJTUVPVVQ7CgkJaWYgKGR1cmF0aW9uID09IDApIHsgZHVyYXRpb24gPSBjcmVhdGVqcy5Mb2FkUXVldWUubG9hZFRpbWVvdXQ7IH0KCQl0aGlzLl9sb2FkVGltZW91dCA9IHNldFRpbWVvdXQoY3JlYXRlanMucHJveHkodGhpcy5faGFuZGxlVGltZW91dCwgdGhpcyksIGR1cmF0aW9uKTsKCgkJaWYgKHRoaXMuX2lzQXVkaW8pIHsKCQkJdGFnLnNyYyA9IG51bGw7IC8vIFVuc2V0IHRoZSBzb3VyY2Ugc28gd2UgY2FuIHNldCB0aGUgcHJlbG9hZCB0eXBlIHRvICJhdXRvIiB3aXRob3V0IGtpY2tpbmcgb2ZmIGEgbG9hZC4gVGhpcyBpcyBvbmx5IG5lY2Vzc2FyeSBmb3IgYXVkaW8gdGFncyBwYXNzZWQgaW4gYnkgdGhlIGRldmVsb3Blci4KCQkJdGFnLnByZWxvYWQgPSAiYXV0byI7CgkJfQoKCQkvLyBIYW5kbGVycyBmb3IgYWxsIHRhZ3MKCQl0YWcub25lcnJvciA9IGNyZWF0ZWpzLnByb3h5KHRoaXMuX2hhbmRsZUVycm9yLCAgdGhpcyk7CgkJLy8gTm90ZTogV2Ugb25seSBnZXQgcHJvZ3Jlc3MgZXZlbnRzIGluIENocm9tZSwgYnV0IGRvIG5vdCBmdWxseSBsb2FkIHRhZ3MgaW4gQ2hyb21lIGR1ZSB0byBpdHMgYmVoYXZpb3VyLCBzbyB3ZSBpZ25vcmUgcHJvZ3Jlc3MuCgoJCWlmICh0aGlzLl9pc0F1ZGlvKSB7CgkJCXRhZy5vbnN0YWxsZWQgPSBjcmVhdGVqcy5wcm94eSh0aGlzLl9oYW5kbGVTdGFsbGVkLCAgdGhpcyk7CgkJCS8vIFRoaXMgd2lsbCB0ZWxsIHVzIHdoZW4gYXVkaW8gaXMgYnVmZmVyZWQgZW5vdWdoIHRvIHBsYXkgdGhyb3VnaCwgYnV0IG5vdCB3aGVuIGl0cyBsb2FkZWQuCgkJCS8vIFRoZSB0YWcgZG9lc24ndCBrZWVwIGxvYWRpbmcgaW4gQ2hyb21lIG9uY2UgZW5vdWdoIGhhcyBidWZmZXJlZCwgYW5kIHdlIGhhdmUgZGVjaWRlZCB0aGF0IGJlaGF2aW91ciBpcyBzdWZmaWNpZW50LgoJCQl0YWcuYWRkRXZlbnRMaXN0ZW5lcigiY2FucGxheXRocm91Z2giLCB0aGlzLl90YWdDb21wbGV0ZVByb3h5LCBmYWxzZSk7IC8vIGNhbnBsYXl0aHJvdWdoIGNhbGxiYWNrIGRvZXNuJ3Qgd29yayBpbiBDaHJvbWUsIHNvIHdlIHVzZSBhbiBldmVudC4KCQl9IGVsc2UgewoJCQl0YWcub25sb2FkID0gY3JlYXRlanMucHJveHkodGhpcy5faGFuZGxlTG9hZCwgIHRoaXMpOwoJCQl0YWcub25yZWFkeXN0YXRlY2hhbmdlID0gY3JlYXRlanMucHJveHkodGhpcy5faGFuZGxlUmVhZHlTdGF0ZUNoYW5nZSwgIHRoaXMpOwoJCX0KCgkJdmFyIHNyYyA9IHRoaXMuYnVpbGRQYXRoKGl0ZW0uc3JjLCBpdGVtLnZhbHVlcyk7CgoJCS8vIFNldCB0aGUgc3JjIGFmdGVyIHRoZSBldmVudHMgYXJlIGFsbCBhZGRlZC4KCQlzd2l0Y2goaXRlbS50eXBlKSB7CgkJCWNhc2UgY3JlYXRlanMuTG9hZFF1ZXVlLkNTUzoKCQkJCXRhZy5ocmVmID0gc3JjOwoJCQkJYnJlYWs7CgkJCWNhc2UgY3JlYXRlanMuTG9hZFF1ZXVlLlNWRzoKCQkJCXRhZy5kYXRhID0gc3JjOwoJCQkJYnJlYWs7CgkJCWRlZmF1bHQ6CgkJCQl0YWcuc3JjID0gc3JjOwoJCX0KCgkJLy8gSWYgd2UncmUgbG9hZGluZyBKU09OUCwgd2UgbmVlZCB0byBhZGQgb3VyIGNhbGxiYWNrIG5vdy4KCQlpZiAoaXRlbS50eXBlID09IGNyZWF0ZWpzLkxvYWRRdWV1ZS5KU09OUAoJCQkJfHwgaXRlbS50eXBlID09IGNyZWF0ZWpzLkxvYWRRdWV1ZS5KU09OCgkJCQl8fCBpdGVtLnR5cGUgPT0gY3JlYXRlanMuTG9hZFF1ZXVlLk1BTklGRVNUKSB7CgkJCWlmIChpdGVtLmNhbGxiYWNrID09IG51bGwpIHsKCQkJCXRocm93IG5ldyBFcnJvcignY2FsbGJhY2sgaXMgcmVxdWlyZWQgZm9yIGxvYWRpbmcgSlNPTlAgcmVxdWVzdHMuJyk7CgkJCX0KCgkJCWlmICh3aW5kb3dbaXRlbS5jYWxsYmFja10gIT0gbnVsbCkgewoJCQkJdGhyb3cgbmV3IEVycm9yKCdKU09OUCBjYWxsYmFjayAiJyArIGl0ZW0uY2FsbGJhY2sgKyAnIiBhbHJlYWR5IGV4aXN0cyBvbiB3aW5kb3cuIFlvdSBuZWVkIHRvIHNwZWNpZnkgYSBkaWZmZXJlbnQgY2FsbGJhY2suIE9yIHJlLW5hbWUgdGhlIGN1cnJlbnQgb25lLicpOwoJCQl9CgoJCQl3aW5kb3dbaXRlbS5jYWxsYmFja10gPSBjcmVhdGVqcy5wcm94eSh0aGlzLl9oYW5kbGVKU09OUExvYWQsIHRoaXMpOwoJCX0KCgkJLy8gSWYgaXRzIFNWRywgaXQgbmVlZHMgdG8gYmUgb24gdGhlIERPTSB0byBsb2FkICh3ZSByZW1vdmUgaXQgYmVmb3JlIHNlbmRpbmcgY29tcGxldGUpLgoJCS8vIEl0IGlzIGltcG9ydGFudCB0aGF0IHRoaXMgaGFwcGVucyBBRlRFUiBzZXR0aW5nIHRoZSBzcmMvZGF0YS4KCQlpZiAoaXRlbS50eXBlID09IGNyZWF0ZWpzLkxvYWRRdWV1ZS5TVkcgfHwKCQkJaXRlbS50eXBlID09IGNyZWF0ZWpzLkxvYWRRdWV1ZS5KU09OUCB8fAoJCQlpdGVtLnR5cGUgPT0gY3JlYXRlanMuTG9hZFF1ZXVlLkpTT04gfHwKCQkJaXRlbS50eXBlID09IGNyZWF0ZWpzLkxvYWRRdWV1ZS5NQU5JRkVTVCB8fAoJCQlpdGVtLnR5cGUgPT0gY3JlYXRlanMuTG9hZFF1ZXVlLkpBVkFTQ1JJUFQgfHwKCQkJaXRlbS50eXBlID09IGNyZWF0ZWpzLkxvYWRRdWV1ZS5DU1MpIHsKCQkJCXRoaXMuX3N0YXJ0VGFnVmlzaWJpbGl0eSA9IHRhZy5zdHlsZS52aXNpYmlsaXR5OwoJCQkJdGFnLnN0eWxlLnZpc2liaWxpdHkgPSAiaGlkZGVuIjsKCQkJCShkb2N1bWVudC5ib2R5IHx8IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJib2R5IilbMF0pLmFwcGVuZENoaWxkKHRhZyk7CgkJfQoKCQkvLyBOb3RlOiBQcmV2aW91cyB2ZXJzaW9ucyBkaWRuJ3Qgc2VlbSB0byB3b3JrIHdoZW4gd2UgY2FsbGVkIGxvYWQoKSBmb3IgT0dHIHRhZ3MgaW4gRmlyZWZveC4gU2VlbXMgZml4ZWQgaW4gMTUuMC4xCgkJaWYgKHRhZy5sb2FkICE9IG51bGwpIHsKCQkJdGFnLmxvYWQoKTsKCQl9Cgl9OwoKCXAuX2hhbmRsZUpTT05QTG9hZCA9IGZ1bmN0aW9uKGRhdGEpIHsKCQl0aGlzLl9qc29uUmVzdWx0ID0gZGF0YTsKCX07CgoJLyoqCgkgKiBIYW5kbGUgYW4gYXVkaW8gdGltZW91dC4gTmV3ZXIgYnJvd3NlcnMgZ2V0IGEgY2FsbGJhY2sgZnJvbSB0aGUgdGFncywgYnV0IG9sZGVyIG9uZXMgbWF5IHJlcXVpcmUgYSBzZXRUaW1lb3V0CgkgKiB0byBoYW5kbGUgaXQuIFRoZSBzZXRUaW1lb3V0IGlzIGFsd2F5cyBydW5uaW5nIHVudGlsIGEgcmVzcG9uc2UgaXMgaGFuZGxlZCBieSB0aGUgYnJvd3Nlci4KCSAqIEBtZXRob2QgX2hhbmRsZVRpbWVvdXQKCSAqIEBwcml2YXRlCgkgKi8KCXAuX2hhbmRsZVRpbWVvdXQgPSBmdW5jdGlvbigpIHsKCQl0aGlzLl9jbGVhbigpOwoJCXZhciBldmVudCA9IG5ldyBjcmVhdGVqcy5FdmVudCgiZXJyb3IiKTsKCQlldmVudC50ZXh0ID0gIlBSRUxPQURfVElNRU9VVCI7CgkJdGhpcy5fc2VuZEVycm9yKGV2ZW50KTsKCX07CgoJLyoqCgkgKiBIYW5kbGUgYSBzdGFsbGVkIGF1ZGlvIGV2ZW50LiBUaGUgbWFpbiBwbGFjZSB3ZSBzZWVtIHRvIGdldCB0aGVzZSBpcyB3aXRoIEhUTUxBdWRpbyBpbiBDaHJvbWUgd2hlbiB3ZSB0cnkgYW5kCgkgKiBwbGF5YmFjayBhdWRpbyB0aGF0IGlzIGFscmVhZHkgaW4gYSBsb2FkLCBidXQgbm90IGNvbXBsZXRlLgoJICogQG1ldGhvZCBfaGFuZGxlU3RhbGxlZAoJICogQHByaXZhdGUKCSAqLwoJcC5faGFuZGxlU3RhbGxlZCA9IGZ1bmN0aW9uKCkgewoJCS8vSWdub3JlLCBsZXQgdGhlIHRpbWVvdXQgdGFrZSBjYXJlIG9mIGl0LiBTb21ldGltZXMgaXRzIG5vdCByZWFsbHkgc3RvcHBlZC4KCX07CgoJLyoqCgkgKiBIYW5kbGUgYW4gZXJyb3IgZXZlbnQgZ2VuZXJhdGVkIGJ5IHRoZSB0YWcuCgkgKiBAbWV0aG9kIF9oYW5kbGVFcnJvcgoJICogQHByaXZhdGUKCSAqLwoJcC5faGFuZGxlRXJyb3IgPSBmdW5jdGlvbihldmVudCkgewoJCXRoaXMuX2NsZWFuKCk7CgoJCXZhciBuZXdFdmVudCA9IG5ldyBjcmVhdGVqcy5FdmVudCgiZXJyb3IiKTsKCQkvL1RPRE86IFByb3BhZ2F0ZSBhY3R1YWwgZXZlbnQgZXJyb3I/CgkJdGhpcy5fc2VuZEVycm9yKG5ld0V2ZW50KTsKCX07CgoJLyoqCgkgKiBIYW5kbGUgdGhlIHJlYWR5U3RhdGVDaGFuZ2UgZXZlbnQgZnJvbSBhIHRhZy4gV2Ugc29tZXRpbWVzIG5lZWQgdGhpcyBpbiBwbGFjZSBvZiB0aGUgb25sb2FkIGV2ZW50IChtYWlubHkgU0NSSVBUCgkgKiBhbmQgTElOSyB0YWdzKSwgYnV0IG90aGVyIGNhc2VzIG1heSBleGlzdC4KCSAqIEBtZXRob2QgX2hhbmRsZVJlYWR5U3RhdGVDaGFuZ2UKCSAqIEBwcml2YXRlCgkgKi8KCXAuX2hhbmRsZVJlYWR5U3RhdGVDaGFuZ2UgPSBmdW5jdGlvbigpIHsKCQljbGVhclRpbWVvdXQodGhpcy5fbG9hZFRpbWVvdXQpOwoJCS8vIFRoaXMgaXMgc3RyaWN0bHkgZm9yIHRhZ3MgaW4gYnJvd3NlcnMgdGhhdCBkbyBub3Qgc3VwcG9ydCBvbmxvYWQuCgkJdmFyIHRhZyA9IHRoaXMuZ2V0SXRlbSgpLnRhZzsKCgkJLy8gQ29tcGxldGUgaXMgZm9yIG9sZCBJRSBzdXBwb3J0LgoJCWlmICh0YWcucmVhZHlTdGF0ZSA9PSAibG9hZGVkIiB8fCB0YWcucmVhZHlTdGF0ZSA9PSAiY29tcGxldGUiKSB7CgkJCXRoaXMuX2hhbmRsZUxvYWQoKTsKCQl9Cgl9OwoKCS8qKgoJICogSGFuZGxlIGEgbG9hZCAoY29tcGxldGUpIGV2ZW50LiBUaGlzIGlzIGNhbGxlZCBieSB0YWcgY2FsbGJhY2tzLCBidXQgYWxzbyBieSByZWFkeVN0YXRlQ2hhbmdlIGFuZCBjYW5QbGF5VGhyb3VnaAoJICogZXZlbnRzLiBPbmNlIGxvYWRlZCwgdGhlIGl0ZW0gaXMgZGlzcGF0Y2hlZCB0byB0aGUge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUifX17ey9jcm9zc0xpbmt9fS4KCSAqIEBtZXRob2QgX2hhbmRsZUxvYWQKCSAqIEBwYXJhbSB7T2JqZWN0fSBbZXZlbnRdIEEgbG9hZCBldmVudCBmcm9tIGEgdGFnLiBUaGlzIGlzIHNvbWV0aW1lcyBjYWxsZWQgZnJvbSBvdGhlciBoYW5kbGVycyB3aXRob3V0IGFuIGV2ZW50LgoJICogQHByaXZhdGUKCSAqLwoJcC5faGFuZGxlTG9hZCA9IGZ1bmN0aW9uKGV2ZW50KSB7CgkJaWYgKHRoaXMuX2lzQ2FuY2VsZWQoKSkgeyByZXR1cm47IH0KCgkJdmFyIGl0ZW0gPSB0aGlzLmdldEl0ZW0oKTsKCQl2YXIgdGFnID0gaXRlbS50YWc7CgoJCWlmICh0aGlzLmxvYWRlZCB8fCB0aGlzLl9pc0F1ZGlvICYmIHRhZy5yZWFkeVN0YXRlICE9PSA0KSB7IHJldHVybjsgfSAvL0xNOiBOb3Qgc3VyZSBpZiB3ZSBzdGlsbCBuZWVkIHRoZSBhdWRpbyBjaGVjay4KCQl0aGlzLmxvYWRlZCA9IHRydWU7CgoJCS8vIFJlbW92ZSBmcm9tIHRoZSBET00KCQlzd2l0Y2ggKGl0ZW0udHlwZSkgewoJCQljYXNlIGNyZWF0ZWpzLkxvYWRRdWV1ZS5TVkc6CgkJCWNhc2UgY3JlYXRlanMuTG9hZFF1ZXVlLkpTT046CgkJCWNhc2UgY3JlYXRlanMuTG9hZFF1ZXVlLkpTT05QOiAvLyBOb3RlOiBSZW1vdmluZyBzY3JpcHQgdGFncyBpcyBhIGZvb2wncyBlcnJhbmQuCgkJCWNhc2UgY3JlYXRlanMuTG9hZFF1ZXVlLk1BTklGRVNUOgoJCQljYXNlIGNyZWF0ZWpzLkxvYWRRdWV1ZS5DU1M6CgkJCQkvLyBjYXNlIGNyZWF0ZWpzLkxvYWRRdWV1ZS5DU1M6CgkJCQkvL0xNOiBXZSBtYXkgbmVlZCB0byByZW1vdmUgQ1NTIHRhZ3MgbG9hZGVkIHVzaW5nIGEgTElOSwoJCQkJdGFnLnN0eWxlLnZpc2liaWxpdHkgPSB0aGlzLl9zdGFydFRhZ1Zpc2liaWxpdHk7CgkJCQkoZG9jdW1lbnQuYm9keSB8fCBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiYm9keSIpWzBdKS5yZW1vdmVDaGlsZCh0YWcpOwoJCQlicmVhazsKCQkJZGVmYXVsdDoKCQl9CgoJCXRoaXMuX2NsZWFuKCk7CgkJdGhpcy5fc2VuZENvbXBsZXRlKCk7Cgl9OwoKCS8qKgoJICogQ2xlYW4gdXAgdGhlIGxvYWRlci4KCSAqIFRoaXMgc3RvcHMgYW55IHRpbWVycyBhbmQgcmVtb3ZlcyByZWZlcmVuY2VzIHRvIHByZXZlbnQgZXJyYW50IGNhbGxiYWNrcyBhbmQgY2xlYW4gdXAgbWVtb3J5LgoJICogQG1ldGhvZCBfY2xlYW4KCSAqIEBwcml2YXRlCgkgKi8KCXAuX2NsZWFuID0gZnVuY3Rpb24oKSB7CgkJY2xlYXJUaW1lb3V0KHRoaXMuX2xvYWRUaW1lb3V0KTsKCgkJLy8gRGVsZXRlIGhhbmRsZXJzLgoJCXZhciBpdGVtID0gdGhpcy5nZXRJdGVtKCk7CgkJdmFyIHRhZyA9IGl0ZW0udGFnOwoJCWlmICh0YWcgIT0gbnVsbCkgewoJCQl0YWcub25sb2FkID0gbnVsbDsKCQkJdGFnLnJlbW92ZUV2ZW50TGlzdGVuZXIgJiYgdGFnLnJlbW92ZUV2ZW50TGlzdGVuZXIoImNhbnBsYXl0aHJvdWdoIiwgdGhpcy5fdGFnQ29tcGxldGVQcm94eSwgZmFsc2UpOwoJCQl0YWcub25zdGFsbGVkID0gbnVsbDsKCQkJdGFnLm9ucHJvZ3Jlc3MgPSBudWxsOwoJCQl0YWcub25lcnJvciA9IG51bGw7CgoJCQkvL1RPRE86IFRlc3QgdGhpcwoJCQlpZiAodGFnLnBhcmVudE5vZGUgIT0gbnVsbAoJCQkJCSYmIGl0ZW0udHlwZSA9PSBjcmVhdGVqcy5Mb2FkUXVldWUuU1ZHCgkJCQkJJiYgaXRlbS50eXBlID09IGNyZWF0ZWpzLkxvYWRRdWV1ZS5KU09OCgkJCQkJJiYgaXRlbS50eXBlID09IGNyZWF0ZWpzLkxvYWRRdWV1ZS5NQU5JRkVTVAoJCQkJCSYmIGl0ZW0udHlwZSA9PSBjcmVhdGVqcy5Mb2FkUXVldWUuQ1NTCgkJCQkJJiYgaXRlbS50eXBlID09IGNyZWF0ZWpzLkxvYWRRdWV1ZS5KU09OUCkgewoJCQkJIC8vIE5vdGU6IFJlbW92aW5nIHNjcmlwdCB0YWdzIGlzIGEgZm9vbCdzIGVycmFuZC4KCQkJCXRhZy5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRhZyk7CgkJCX0KCQl9CgoJCXZhciBpdGVtID0gdGhpcy5nZXRJdGVtKCk7CgkJaWYgKGl0ZW0udHlwZSA9PSBjcmVhdGVqcy5Mb2FkUXVldWUuSlNPTlAKCQkJfHwgaXRlbS50eXBlID09IGNyZWF0ZWpzLkxvYWRRdWV1ZS5NQU5JRkVTVCkgewoJCQl3aW5kb3dbaXRlbS5jYWxsYmFja10gPSBudWxsOwoJCX0KCX07CgoJcC50b1N0cmluZyA9IGZ1bmN0aW9uKCkgewoJCXJldHVybiAiW1ByZWxvYWRKUyBUYWdMb2FkZXJdIjsKCX07CgoJY3JlYXRlanMuVGFnTG9hZGVyID0gVGFnTG9hZGVyOwoKfSgpKTsKLyoKICogWEhSTG9hZGVyCiAqIFZpc2l0IGh0dHA6Ly9jcmVhdGVqcy5jb20vIGZvciBkb2N1bWVudGF0aW9uLCB1cGRhdGVzIGFuZCBleGFtcGxlcy4KICoKICoKICogQ29weXJpZ2h0IChjKSAyMDEyIGdza2lubmVyLmNvbSwgaW5jLgogKgogKiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbgogKiBvYnRhaW5pbmcgYSBjb3B5IG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbgogKiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0CiAqIHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMgdG8gdXNlLAogKiBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbAogKiBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUKICogU29mdHdhcmUgaXMgZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcKICogY29uZGl0aW9uczoKICoKICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUKICogaW5jbHVkZWQgaW4gYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuCiAqCiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELAogKiBFWFBSRVNTIE9SIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMKICogT0YgTUVSQ0hBTlRBQklMSVRZLCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQKICogTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SUyBPUiBDT1BZUklHSFQKICogSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUiBMSUFCSUxJVFksCiAqIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORwogKiBGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SCiAqIE9USEVSIERFQUxJTkdTIElOIFRIRSBTT0ZUV0FSRS4KICovCgovKioKICogQG1vZHVsZSBQcmVsb2FkSlMKICovCgovLyBuYW1lc3BhY2U6CnRoaXMuY3JlYXRlanMgPSB0aGlzLmNyZWF0ZWpzIHx8IHt9OwoKKGZ1bmN0aW9uICgpIHsKCSJ1c2Ugc3RyaWN0IjsKCgkvKioKCSAqIEEgcHJlbG9hZGVyIHRoYXQgbG9hZHMgaXRlbXMgdXNpbmcgWEhSIHJlcXVlc3RzLCB1c3VhbGx5IFhNTEh0dHBSZXF1ZXN0LiBIb3dldmVyIFhEb21haW5SZXF1ZXN0cyB3aWxsIGJlIHVzZWQKCSAqIGZvciBjcm9zcy1kb21haW4gcmVxdWVzdHMgaWYgcG9zc2libGUsIGFuZCBvbGRlciB2ZXJzaW9ucyBvZiBJRSBmYWxsIGJhY2sgb24gdG8gQWN0aXZlWCBvYmplY3RzIHdoZW4gbmVjZXNzYXJ5LgoJICogWEhSIHJlcXVlc3RzIGxvYWQgdGhlIGNvbnRlbnQgYXMgdGV4dCBvciBiaW5hcnkgZGF0YSwgcHJvdmlkZSBwcm9ncmVzcyBhbmQgY29uc2lzdGVudCBjb21wbGV0aW9uIGV2ZW50cywgYW5kCgkgKiBjYW4gYmUgY2FuY2VsZWQgZHVyaW5nIGxvYWQuIE5vdGUgdGhhdCBYSFIgaXMgbm90IHN1cHBvcnRlZCBpbiBJRSA2IG9yIGVhcmxpZXIsIGFuZCBpcyBub3QgcmVjb21tZW5kZWQgZm9yCgkgKiBjcm9zcy1kb21haW4gbG9hZGluZy4KCSAqIEBjbGFzcyBYSFJMb2FkZXIKCSAqIEBjb25zdHJ1Y3RvcgoJICogQHBhcmFtIHtPYmplY3R9IGl0ZW0gVGhlIG9iamVjdCB0aGF0IGRlZmluZXMgdGhlIGZpbGUgdG8gbG9hZC4gUGxlYXNlIHNlZSB0aGUge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvbG9hZEZpbGUifX17ey9jcm9zc0xpbmt9fQoJICogZm9yIGFuIG92ZXJ2aWV3IG9mIHN1cHBvcnRlZCBmaWxlIHByb3BlcnRpZXMuCgkgKiBAcGFyYW0ge1N0cmluZ30gW2Nyb3NzT3JpZ2luXSBBbiBvcHRpb25hbCBmbGFnIHRvIHN1cHBvcnQgaW1hZ2VzIGxvYWRlZCBmcm9tIGEgQ09SUy1lbmFibGVkIHNlcnZlci4gUGxlYXNlIHNlZQoJICoge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvX2Nyb3NzT3JpZ2luOnByb3BlcnR5In19e3svY3Jvc3NMaW5rfX0gZm9yIG1vcmUgaW5mby4KCSAqIEBleHRlbmRzIEFic3RyYWN0TG9hZGVyCgkgKi8KCXZhciBYSFJMb2FkZXIgPSBmdW5jdGlvbiAoaXRlbSwgY3Jvc3NPcmlnaW4pIHsKCQl0aGlzLmluaXQoaXRlbSwgY3Jvc3NPcmlnaW4pOwoJfTsKCgl2YXIgcCA9IFhIUkxvYWRlci5wcm90b3R5cGUgPSBuZXcgY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIoKTsKCgkvL1Byb3RlY3RlZAoJLyoqCgkgKiBBIHJlZmVyZW5jZSB0byB0aGUgWEhSIHJlcXVlc3QgdXNlZCB0byBsb2FkIHRoZSBjb250ZW50LgoJICogQHByb3BlcnR5IF9yZXF1ZXN0CgkgKiBAdHlwZSB7WE1MSHR0cFJlcXVlc3QgfCBYRG9tYWluUmVxdWVzdCB8IEFjdGl2ZVguWE1MSFRUUH0KCSAqIEBwcml2YXRlCgkgKi8KCXAuX3JlcXVlc3QgPSBudWxsOwoKCS8qKgoJICogQSBtYW51YWwgbG9hZCB0aW1lb3V0IHRoYXQgaXMgdXNlZCBmb3IgYnJvd3NlcnMgdGhhdCBkbyBub3Qgc3VwcG9ydCB0aGUgb25UaW1lb3V0IGV2ZW50IG9uIFhIUiAoWEhSIGxldmVsIDEsCgkgKiB0eXBpY2FsbHkgSUU5KS4KCSAqIEBwcm9wZXJ0eSBfbG9hZFRpbWVvdXQKCSAqIEB0eXBlIHtOdW1iZXJ9CgkgKiBAcHJpdmF0ZQoJICovCglwLl9sb2FkVGltZW91dCA9IG51bGw7CgoJLyoqCgkgKiBUaGUgYnJvd3NlcidzIFhIUiAoWE1MSFRUUFJlcXVlc3QpIHZlcnNpb24uIFN1cHBvcnRlZCB2ZXJzaW9ucyBhcmUgMSBhbmQgMi4gVGhlcmUgaXMgbm8gb2ZmaWNpYWwgd2F5IHRvIGRldGVjdAoJICogdGhlIHZlcnNpb24sIHNvIHdlIHVzZSBjYXBhYmlsaXRpZXMgdG8gbWFrZSBhIGJlc3QgZ3Vlc3MuCgkgKiBAcHJvcGVydHkgX3hockxldmVsCgkgKiBAdHlwZSB7TnVtYmVyfQoJICogQGRlZmF1bHQgMQoJICogQHByaXZhdGUKCSAqLwoJcC5feGhyTGV2ZWwgPSAxOwoKCS8qKgoJICogVGhlIHJlc3BvbnNlIG9mIGEgbG9hZGVkIGZpbGUuIFRoaXMgaXMgc2V0IGJlY2F1c2UgaXQgaXMgZXhwZW5zaXZlIHRvIGxvb2sgdXAgY29uc3RhbnRseS4gVGhpcyBwcm9wZXJ0eSB3aWxsIGJlCgkgKiBudWxsIHVudGlsIHRoZSBmaWxlIGlzIGxvYWRlZC4KCSAqIEBwcm9wZXJ0eSBfcmVzcG9uc2UKCSAqIEB0eXBlIHttaXhlZH0KCSAqIEBwcml2YXRlCgkgKi8KCXAuX3Jlc3BvbnNlID0gbnVsbDsKCgkvKioKCSAqIFRoZSByZXNwb25zZSBvZiB0aGUgbG9hZGVkIGZpbGUgYmVmb3JlIGl0IGlzIG1vZGlmaWVkLiBJbiBtb3N0IGNhc2VzLCBjb250ZW50IGlzIGNvbnZlcnRlZCBmcm9tIHJhdyB0ZXh0IHRvCgkgKiBhbiBIVE1MIHRhZyBvciBhIGZvcm1hdHRlZCBvYmplY3Qgd2hpY2ggaXMgc2V0IHRvIHRoZSA8Y29kZT5yZXN1bHQ8L2NvZGU+IHByb3BlcnR5LCBidXQgdGhlIGRldmVsb3BlciBtYXkgc3RpbGwKCSAqIHdhbnQgdG8gYWNjZXNzIHRoZSByYXcgY29udGVudCBhcyBpdCB3YXMgbG9hZGVkLgoJICogQHByb3BlcnR5IF9yYXdSZXNwb25zZQoJICogQHR5cGUge1N0cmluZ3xPYmplY3R9CgkgKiBAcHJpdmF0ZQoJICovCglwLl9yYXdSZXNwb25zZSA9IG51bGw7CgoJLyoqCgkgKiBTZWUge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvX2Nyb3NzT3JpZ2luOnByb3BlcnR5In19e3svY3Jvc3NMaW5rfX0KCSAqIEBwcm9wZXJ0eSBfY3Jvc3NPcmlnaW4KCSAqIEB0eXBlIHtTdHJpbmd9CgkgKiBAZGVmYXVsdFZhbHVlICIiCgkgKiBAcHJpdmF0ZQoJICovCglwLl9jcm9zc09yaWdpbiA9ICIiOwoKCS8vIE92ZXJyaWRlcyBhYnN0cmFjdCBtZXRob2QgaW4gQWJzdHJhY3RMb2FkZXIKCXAuaW5pdCA9IGZ1bmN0aW9uIChpdGVtLCBjcm9zc09yaWdpbikgewoJCXRoaXMuX2l0ZW0gPSBpdGVtOwoJCXRoaXMuX2Nyb3NzT3JpZ2luID0gY3Jvc3NPcmlnaW47CgkJaWYgKCF0aGlzLl9jcmVhdGVYSFIoaXRlbSkpIHsKCQkJLy9UT0RPOiBUaHJvdyBlcnJvcj8KCQl9Cgl9OwoKCS8qKgoJICogTG9vayB1cCB0aGUgbG9hZGVkIHJlc3VsdC4KCSAqIEBtZXRob2QgZ2V0UmVzdWx0CgkgKiBAcGFyYW0ge0Jvb2xlYW59IFtyYXdSZXN1bHQ9ZmFsc2VdIFJldHVybiBhIHJhdyByZXN1bHQgaW5zdGVhZCBvZiBhIGZvcm1hdHRlZCByZXN1bHQuIFRoaXMgYXBwbGllcyB0byBjb250ZW50CgkgKiBsb2FkZWQgdmlhIFhIUiBzdWNoIGFzIHNjcmlwdHMsIFhNTCwgQ1NTLCBhbmQgSW1hZ2VzLiBJZiB0aGVyZSBpcyBubyByYXcgcmVzdWx0LCB0aGUgZm9ybWF0dGVkIHJlc3VsdCB3aWxsIGJlCgkgKiByZXR1cm5lZCBpbnN0ZWFkLgoJICogQHJldHVybiB7T2JqZWN0fSBBIHJlc3VsdCBvYmplY3QgY29udGFpbmluZyB0aGUgY29udGVudCB0aGF0IHdhcyBsb2FkZWQsIHN1Y2ggYXM6CgkgKiA8dWw+CgkgKiAgICAgIDxsaT5BbiBpbWFnZSB0YWcgKCZsdDtpbWFnZSAvJmd0OykgZm9yIGltYWdlczwvbGk+CgkgKiAgICAgIDxsaT5BIHNjcmlwdCB0YWcgZm9yIEphdmFTY3JpcHQgKCZsdDtzY3JpcHQgLyZndDspLiBOb3RlIHRoYXQgc2NyaXB0cyBsb2FkZWQgd2l0aCB0YWdzIG1heSBiZSBhZGRlZCB0byB0aGUKCSAqICAgICAgSFRNTCBoZWFkLjwvbGk+CgkgKiAgICAgIDxsaT5BIHN0eWxlIHRhZyBmb3IgQ1NTICgmbHQ7c3R5bGUgLyZndDspPC9saT4KCSAqICAgICAgPGxpPlJhdyB0ZXh0IGZvciBURVhUPC9saT4KCSAqICAgICAgPGxpPkEgZm9ybWF0dGVkIEphdmFTY3JpcHQgb2JqZWN0IGRlZmluZWQgYnkgSlNPTjwvbGk+CgkgKiAgICAgIDxsaT5BbiBYTUwgZG9jdW1lbnQ8L2xpPgoJICogICAgICA8bGk+QW4gYmluYXJ5IGFycmF5YnVmZmVyIGxvYWRlZCBieSBYSFI8L2xpPgoJICogPC91bD4KCSAqIE5vdGUgdGhhdCBpZiBhIHJhdyByZXN1bHQgaXMgcmVxdWVzdGVkLCBidXQgbm90IGZvdW5kLCB0aGUgcmVzdWx0IHdpbGwgYmUgcmV0dXJuZWQgaW5zdGVhZC4KCSAqLwoJcC5nZXRSZXN1bHQgPSBmdW5jdGlvbiAocmF3UmVzdWx0KSB7CgkJaWYgKHJhd1Jlc3VsdCAmJiB0aGlzLl9yYXdSZXNwb25zZSkgewoJCQlyZXR1cm4gdGhpcy5fcmF3UmVzcG9uc2U7CgkJfQoJCXJldHVybiB0aGlzLl9yZXNwb25zZTsKCX07CgoJLy8gT3ZlcnJpZGVzIGFic3RyYWN0IG1ldGhvZCBpbiBBYnN0cmFjdExvYWRlcgoJcC5jYW5jZWwgPSBmdW5jdGlvbiAoKSB7CgkJdGhpcy5jYW5jZWxlZCA9IHRydWU7CgkJdGhpcy5fY2xlYW4oKTsKCQl0aGlzLl9yZXF1ZXN0LmFib3J0KCk7Cgl9OwoKCS8vIE92ZXJyaWRlcyBhYnN0cmFjdCBtZXRob2QgaW4gQWJzdHJhY3RMb2FkZXIKCXAubG9hZCA9IGZ1bmN0aW9uICgpIHsKCQlpZiAodGhpcy5fcmVxdWVzdCA9PSBudWxsKSB7CgkJCXRoaXMuX2hhbmRsZUVycm9yKCk7CgkJCXJldHVybjsKCQl9CgoJCS8vRXZlbnRzCgkJdGhpcy5fcmVxdWVzdC5vbmxvYWRzdGFydCA9IGNyZWF0ZWpzLnByb3h5KHRoaXMuX2hhbmRsZUxvYWRTdGFydCwgdGhpcyk7CgkJdGhpcy5fcmVxdWVzdC5vbnByb2dyZXNzID0gY3JlYXRlanMucHJveHkodGhpcy5faGFuZGxlUHJvZ3Jlc3MsIHRoaXMpOwoJCXRoaXMuX3JlcXVlc3Qub25hYm9ydCA9IGNyZWF0ZWpzLnByb3h5KHRoaXMuX2hhbmRsZUFib3J0LCB0aGlzKTsKCQl0aGlzLl9yZXF1ZXN0Lm9uZXJyb3IgPSBjcmVhdGVqcy5wcm94eSh0aGlzLl9oYW5kbGVFcnJvciwgdGhpcyk7CgkJdGhpcy5fcmVxdWVzdC5vbnRpbWVvdXQgPSBjcmVhdGVqcy5wcm94eSh0aGlzLl9oYW5kbGVUaW1lb3V0LCB0aGlzKTsKCQkvLyBTZXQgdXAgYSB0aW1lb3V0IGlmIHdlIGRvbid0IGhhdmUgWEhSMgoJCWlmICh0aGlzLl94aHJMZXZlbCA9PSAxKSB7CgkJCXZhciBkdXJhdGlvbiA9IGNyZWF0ZWpzLkxvYWRRdWV1ZS5MT0FEX1RJTUVPVVQ7CgkJCWlmIChkdXJhdGlvbiA9PSAwKSB7CgkJCQlkdXJhdGlvbiA9IGNyZWF0ZWpzLkxvYWRRdWV1ZS5sb2FkVGltZW91dDsKCQkJfSBlbHNlIHsKCQkJCXRyeSB7IGNvbnNvbGUud2FybigiTG9hZFF1ZXVlLkxPQURfVElNRU9VVCBoYXMgYmVlbiBkZXByZWNhdGVkIGluIGZhdm9yIG9mIExvYWRRdWV1ZS5sb2FkVGltZW91dCIpO30gY2F0Y2goZSkge30KCQkJfQoJCQl0aGlzLl9sb2FkVGltZW91dCA9IHNldFRpbWVvdXQoY3JlYXRlanMucHJveHkodGhpcy5faGFuZGxlVGltZW91dCwgdGhpcyksIGR1cmF0aW9uKTsKCQl9CgoJCS8vIE5vdGU6IFdlIGRvbid0IGdldCBvbmxvYWQgaW4gYWxsIGJyb3dzZXJzIChlYXJsaWVyIEZGIGFuZCBJRSkuIG9uUmVhZHlTdGF0ZUNoYW5nZSBoYW5kbGVzIHRoZXNlLgoJCXRoaXMuX3JlcXVlc3Qub25sb2FkID0gY3JlYXRlanMucHJveHkodGhpcy5faGFuZGxlTG9hZCwgdGhpcyk7CgoJCXRoaXMuX3JlcXVlc3Qub25yZWFkeXN0YXRlY2hhbmdlID0gY3JlYXRlanMucHJveHkodGhpcy5faGFuZGxlUmVhZHlTdGF0ZUNoYW5nZSwgdGhpcyk7CgoJCS8vIFNvbWV0aW1lcyB3ZSBnZXQgYmFjayA0MDRzIGltbWVkaWF0ZWx5LCBwYXJ0aWN1bGFybHkgd2hlbiB0aGVyZSBpcyBhIGNyb3NzIG9yaWdpbiByZXF1ZXN0LiAgLy8gbm90ZSB0aGlzIGRvZXMgbm90IGNhdGNoIGluIENocm9tZQoJCXRyeSB7CgkJCWlmICghdGhpcy5faXRlbS52YWx1ZXMgfHwgdGhpcy5faXRlbS5tZXRob2QgPT0gY3JlYXRlanMuTG9hZFF1ZXVlLkdFVCkgewoJCQkJdGhpcy5fcmVxdWVzdC5zZW5kKCk7CgkJCX0gZWxzZSBpZiAodGhpcy5faXRlbS5tZXRob2QgPT0gY3JlYXRlanMuTG9hZFF1ZXVlLlBPU1QpIHsKCQkJCXRoaXMuX3JlcXVlc3Quc2VuZCh0aGlzLl9mb3JtYXRRdWVyeVN0cmluZyh0aGlzLl9pdGVtLnZhbHVlcykpOwoJCQl9CgkJfSBjYXRjaCAoZXJyb3IpIHsKCQkJdmFyIGV2ZW50ID0gbmV3IGNyZWF0ZWpzLkV2ZW50KCJlcnJvciIpOwoJCQlldmVudC5lcnJvciA9IGVycm9yOwoJCQl0aGlzLl9zZW5kRXJyb3IoZXZlbnQpOwoJCX0KCX07CgoJLyoqCgkgKiBHZXQgYWxsIHRoZSByZXNwb25zZSBoZWFkZXJzIGZyb20gdGhlIFhtbEh0dHBSZXF1ZXN0LgoJICoKCSAqIDxzdHJvbmc+RnJvbSB0aGUgZG9jczo8L3N0cm9uZz4gUmV0dXJuIGFsbCB0aGUgSFRUUCBoZWFkZXJzLCBleGNsdWRpbmcgaGVhZGVycyB0aGF0IGFyZSBhIGNhc2UtaW5zZW5zaXRpdmUgbWF0Y2gKCSAqIGZvciBTZXQtQ29va2llIG9yIFNldC1Db29raWUyLCBhcyBhIHNpbmdsZSBzdHJpbmcsIHdpdGggZWFjaCBoZWFkZXIgbGluZSBzZXBhcmF0ZWQgYnkgYSBVKzAwMEQgQ1IgVSswMDBBIExGIHBhaXIsCgkgKiBleGNsdWRpbmcgdGhlIHN0YXR1cyBsaW5lLCBhbmQgd2l0aCBlYWNoIGhlYWRlciBuYW1lIGFuZCBoZWFkZXIgdmFsdWUgc2VwYXJhdGVkIGJ5IGEgVSswMDNBIENPTE9OIFUrMDAyMCBTUEFDRQoJICogcGFpci4KCSAqIEBtZXRob2QgZ2V0QWxsUmVzcG9uc2VIZWFkZXJzCgkgKiBAcmV0dXJuIHtTdHJpbmd9CgkgKiBAc2luY2UgMC40LjEKCSAqLwoJcC5nZXRBbGxSZXNwb25zZUhlYWRlcnMgPSBmdW5jdGlvbiAoKSB7CgkJaWYgICh0aGlzLl9yZXF1ZXN0LmdldEFsbFJlc3BvbnNlSGVhZGVycyBpbnN0YW5jZW9mIEZ1bmN0aW9uKSB7CgkJCXJldHVybiB0aGlzLl9yZXF1ZXN0LmdldEFsbFJlc3BvbnNlSGVhZGVycygpOwoJCX0gZWxzZSB7CgkJCXJldHVybiBudWxsOwoJCX0KCX07CgoJLyoqCgkgKiBHZXQgYSBzcGVjaWZpYyByZXNwb25zZSBoZWFkZXIgZnJvbSB0aGUgWG1sSHR0cFJlcXVlc3QuCgkgKgoJICogPHN0cm9uZz5Gcm9tIHRoZSBkb2NzOjwvc3Ryb25nPiBSZXR1cm5zIHRoZSBoZWFkZXIgZmllbGQgdmFsdWUgZnJvbSB0aGUgcmVzcG9uc2Ugb2Ygd2hpY2ggdGhlIGZpZWxkIG5hbWUgbWF0Y2hlcwoJICogaGVhZGVyLCB1bmxlc3MgdGhlIGZpZWxkIG5hbWUgaXMgU2V0LUNvb2tpZSBvciBTZXQtQ29va2llMi4KCSAqIEBtZXRob2QgZ2V0UmVzcG9uc2VIZWFkZXIKCSAqIEBwYXJhbSB7U3RyaW5nfSBoZWFkZXIgVGhlIGhlYWRlciBuYW1lIHRvIHJldHJpZXZlLgoJICogQHJldHVybiB7U3RyaW5nfQoJICogQHNpbmNlIDAuNC4xCgkgKi8KCXAuZ2V0UmVzcG9uc2VIZWFkZXIgPSBmdW5jdGlvbiAoaGVhZGVyKSB7CgkJaWYgKHRoaXMuX3JlcXVlc3QuZ2V0UmVzcG9uc2VIZWFkZXIgaW5zdGFuY2VvZiBGdW5jdGlvbikgewoJCQlyZXR1cm4gdGhpcy5fcmVxdWVzdC5nZXRSZXNwb25zZUhlYWRlcihoZWFkZXIpOwoJCX0gZWxzZSB7CgkJCXJldHVybiBudWxsOwoJCX0KCX07CgoJLyoqCgkgKiBUaGUgWEhSIHJlcXVlc3QgaGFzIHJlcG9ydGVkIHByb2dyZXNzLgoJICogQG1ldGhvZCBfaGFuZGxlUHJvZ3Jlc3MKCSAqIEBwYXJhbSB7T2JqZWN0fSBldmVudCBUaGUgWEhSIHByb2dyZXNzIGV2ZW50LgoJICogQHByaXZhdGUKCSAqLwoJcC5faGFuZGxlUHJvZ3Jlc3MgPSBmdW5jdGlvbiAoZXZlbnQpIHsKCQlpZiAoIWV2ZW50IHx8IGV2ZW50LmxvYWRlZCA+IDAgJiYgZXZlbnQudG90YWwgPT0gMCkgewoJCQlyZXR1cm47IC8vIFNvbWV0aW1lcyB3ZSBnZXQgbm8gInRvdGFsIiwgc28ganVzdCBpZ25vcmUgdGhlIHByb2dyZXNzIGV2ZW50LgoJCX0KCgkJdmFyIG5ld0V2ZW50ID0gbmV3IGNyZWF0ZWpzLkV2ZW50KCJwcm9ncmVzcyIpOwoJCW5ld0V2ZW50LmxvYWRlZCA9IGV2ZW50LmxvYWRlZDsKCQluZXdFdmVudC50b3RhbCA9IGV2ZW50LnRvdGFsOwoJCXRoaXMuX3NlbmRQcm9ncmVzcyhuZXdFdmVudCk7Cgl9OwoKCS8qKgoJICogVGhlIFhIUiByZXF1ZXN0IGhhcyByZXBvcnRlZCBhIGxvYWQgc3RhcnQuCgkgKiBAbWV0aG9kIF9oYW5kbGVMb2FkU3RhcnQKCSAqIEBwYXJhbSB7T2JqZWN0fSBldmVudCBUaGUgWEhSIGxvYWRTdGFydCBldmVudC4KCSAqIEBwcml2YXRlCgkgKi8KCXAuX2hhbmRsZUxvYWRTdGFydCA9IGZ1bmN0aW9uIChldmVudCkgewoJCWNsZWFyVGltZW91dCh0aGlzLl9sb2FkVGltZW91dCk7CgkJdGhpcy5fc2VuZExvYWRTdGFydCgpOwoJfTsKCgkvKioKCSAqIFRoZSBYSFIgcmVxdWVzdCBoYXMgcmVwb3J0ZWQgYW4gYWJvcnQgZXZlbnQuCgkgKiBAbWV0aG9kIGhhbmRsZUFib3J0CgkgKiBAcGFyYW0ge09iamVjdH0gZXZlbnQgVGhlIFhIUiBhYm9ydCBldmVudC4KCSAqIEBwcml2YXRlCgkgKi8KCXAuX2hhbmRsZUFib3J0ID0gZnVuY3Rpb24gKGV2ZW50KSB7CgkJdGhpcy5fY2xlYW4oKTsKCQl2YXIgbmV3RXZlbnQgPSBuZXcgY3JlYXRlanMuRXZlbnQoImVycm9yIik7CgkJbmV3RXZlbnQudGV4dCA9ICJYSFJfQUJPUlRFRCI7CgkJdGhpcy5fc2VuZEVycm9yKG5ld0V2ZW50KTsKCX07CgoJLyoqCgkgKiBUaGUgWEhSIHJlcXVlc3QgaGFzIHJlcG9ydGVkIGFuIGVycm9yIGV2ZW50LgoJICogQG1ldGhvZCBfaGFuZGxlRXJyb3IKCSAqIEBwYXJhbSB7T2JqZWN0fSBldmVudCBUaGUgWEhSIGVycm9yIGV2ZW50LgoJICogQHByaXZhdGUKCSAqLwoJcC5faGFuZGxlRXJyb3IgPSBmdW5jdGlvbiAoZXZlbnQpIHsKCQl0aGlzLl9jbGVhbigpOwoJCXZhciBuZXdFdmVudCA9IG5ldyBjcmVhdGVqcy5FdmVudCgiZXJyb3IiKTsKCQkvL1RPRE86IFByb3BhZ2F0ZSBldmVudCBlcnJvcgoJCXRoaXMuX3NlbmRFcnJvcihuZXdFdmVudCk7Cgl9OwoKCS8qKgoJICogVGhlIFhIUiByZXF1ZXN0IGhhcyByZXBvcnRlZCBhIHJlYWR5U3RhdGUgY2hhbmdlLiBOb3RlIHRoYXQgb2xkZXIgYnJvd3NlcnMgKElFIDcgJiA4KSBkbyBub3QgcHJvdmlkZSBhbiBvbmxvYWQKCSAqIGV2ZW50LCBzbyB3ZSBtdXN0IG1vbml0b3IgdGhlIHJlYWR5U3RhdGVDaGFuZ2UgdG8gZGV0ZXJtaW5lIGlmIHRoZSBmaWxlIGlzIGxvYWRlZC4KCSAqIEBtZXRob2QgX2hhbmRsZVJlYWR5U3RhdGVDaGFuZ2UKCSAqIEBwYXJhbSB7T2JqZWN0fSBldmVudCBUaGUgWEhSIHJlYWR5U3RhdGVDaGFuZ2UgZXZlbnQuCgkgKiBAcHJpdmF0ZQoJICovCglwLl9oYW5kbGVSZWFkeVN0YXRlQ2hhbmdlID0gZnVuY3Rpb24gKGV2ZW50KSB7CgkJaWYgKHRoaXMuX3JlcXVlc3QucmVhZHlTdGF0ZSA9PSA0KSB7CgkJCXRoaXMuX2hhbmRsZUxvYWQoKTsKCQl9Cgl9OwoKCS8qKgoJICogVGhlIFhIUiByZXF1ZXN0IGhhcyBjb21wbGV0ZWQuIFRoaXMgaXMgY2FsbGVkIGJ5IHRoZSBYSFIgcmVxdWVzdCBkaXJlY3RseSwgb3IgYnkgYSByZWFkeVN0YXRlQ2hhbmdlIHRoYXQgaGFzCgkgKiA8Y29kZT5yZXF1ZXN0LnJlYWR5U3RhdGUgPT0gNDwvY29kZT4uIE9ubHkgdGhlIGZpcnN0IGNhbGwgdG8gdGhpcyBtZXRob2Qgd2lsbCBiZSBwcm9jZXNzZWQuCgkgKiBAbWV0aG9kIF9oYW5kbGVMb2FkCgkgKiBAcGFyYW0ge09iamVjdH0gZXZlbnQgVGhlIFhIUiBsb2FkIGV2ZW50LgoJICogQHByaXZhdGUKCSAqLwoJcC5faGFuZGxlTG9hZCA9IGZ1bmN0aW9uIChldmVudCkgewoJCWlmICh0aGlzLmxvYWRlZCkgewoJCQlyZXR1cm47CgkJfQoJCXRoaXMubG9hZGVkID0gdHJ1ZTsKCgkJaWYgKCF0aGlzLl9jaGVja0Vycm9yKCkpIHsKCQkJdGhpcy5faGFuZGxlRXJyb3IoKTsKCQkJcmV0dXJuOwoJCX0KCgkJdGhpcy5fcmVzcG9uc2UgPSB0aGlzLl9nZXRSZXNwb25zZSgpOwoJCXRoaXMuX2NsZWFuKCk7CgkJdmFyIGlzQ29tcGxldGUgPSB0aGlzLl9nZW5lcmF0ZVRhZygpOwoJCWlmIChpc0NvbXBsZXRlKSB7CgkJCXRoaXMuX3NlbmRDb21wbGV0ZSgpOwoJCX0KCX07CgoJLyoqCgkgKiBUaGUgWEhSIHJlcXVlc3QgaGFzIHRpbWVkIG91dC4gVGhpcyBpcyBjYWxsZWQgYnkgdGhlIFhIUiByZXF1ZXN0IGRpcmVjdGx5LCBvciB2aWEgYSA8Y29kZT5zZXRUaW1lb3V0PC9jb2RlPgoJICogY2FsbGJhY2suCgkgKiBAbWV0aG9kIF9oYW5kbGVUaW1lb3V0CgkgKiBAcGFyYW0ge09iamVjdH0gW2V2ZW50XSBUaGUgWEhSIHRpbWVvdXQgZXZlbnQuIFRoaXMgaXMgb2NjYXNpb25hbGx5IG51bGwgd2hlbiBjYWxsZWQgYnkgdGhlIGJhY2t1cCBzZXRUaW1lb3V0LgoJICogQHByaXZhdGUKCSAqLwoJcC5faGFuZGxlVGltZW91dCA9IGZ1bmN0aW9uIChldmVudCkgewoJCXRoaXMuX2NsZWFuKCk7CgkJdmFyIG5ld0V2ZW50ID0gbmV3IGNyZWF0ZWpzLkV2ZW50KCJlcnJvciIpOwoJCW5ld0V2ZW50LnRleHQgPSAiUFJFTE9BRF9USU1FT1VUIjsKCQkvL1RPRE86IFByb3BhZ2F0ZSBhY3R1YWwgZXZlbnQgZXJyb3IKCQl0aGlzLl9zZW5kRXJyb3IoZXZlbnQpOwoJfTsKCgovLyBQcm90ZWN0ZWQKCS8qKgoJICogRGV0ZXJtaW5lIGlmIHRoZXJlIGlzIGFuIGVycm9yIGluIHRoZSBjdXJyZW50IGxvYWQuIFRoaXMgY2hlY2tzIHRoZSBzdGF0dXMgb2YgdGhlIHJlcXVlc3QgZm9yIHByb2JsZW0gY29kZXMuIE5vdGUKCSAqIHRoYXQgdGhpcyBkb2VzIG5vdCBjaGVjayBmb3IgYW4gYWN0dWFsIHJlc3BvbnNlLiBDdXJyZW50bHksIGl0IG9ubHkgY2hlY2tzIGZvciA0MDQgb3IgMCBlcnJvciBjb2RlLgoJICogQG1ldGhvZCBfY2hlY2tFcnJvcgoJICogQHJldHVybiB7Qm9vbGVhbn0gSWYgdGhlIHJlcXVlc3Qgc3RhdHVzIHJldHVybnMgYW4gZXJyb3IgY29kZS4KCSAqIEBwcml2YXRlCgkgKi8KCXAuX2NoZWNrRXJyb3IgPSBmdW5jdGlvbiAoKSB7CgkJLy9MTTogUHJvYmFibHkgbmVlZCBhZGRpdGlvbmFsIGhhbmRsZXJzIGhlcmUsIG1heWJlIDUwMQoJCXZhciBzdGF0dXMgPSBwYXJzZUludCh0aGlzLl9yZXF1ZXN0LnN0YXR1cyk7CgoJCXN3aXRjaCAoc3RhdHVzKSB7CgkJCWNhc2UgNDA0OiAgIC8vIE5vdCBGb3VuZAoJCQljYXNlIDA6ICAgICAvLyBOb3QgTG9hZGVkCgkJCQlyZXR1cm4gZmFsc2U7CgkJfQoJCXJldHVybiB0cnVlOwoJfTsKCgkvKioKCSAqIFZhbGlkYXRlIHRoZSByZXNwb25zZS4gRGlmZmVyZW50IGJyb3dzZXJzIGhhdmUgZGlmZmVyZW50IGFwcHJvYWNoZXMsIHNvbWUgb2Ygd2hpY2ggdGhyb3cgZXJyb3JzIHdoZW4gYWNjZXNzZWQKCSAqIGluIG90aGVyIGJyb3dzZXJzLiBJZiB0aGVyZSBpcyBubyByZXNwb25zZSwgdGhlIDxjb2RlPl9yZXNwb25zZTwvY29kZT4gcHJvcGVydHkgd2lsbCByZW1haW4gbnVsbC4KCSAqIEBtZXRob2QgX2dldFJlc3BvbnNlCgkgKiBAcHJpdmF0ZQoJICovCglwLl9nZXRSZXNwb25zZSA9IGZ1bmN0aW9uICgpIHsKCQlpZiAodGhpcy5fcmVzcG9uc2UgIT0gbnVsbCkgewoJCQlyZXR1cm4gdGhpcy5fcmVzcG9uc2U7CgkJfQoKCQlpZiAodGhpcy5fcmVxdWVzdC5yZXNwb25zZSAhPSBudWxsKSB7CgkJCXJldHVybiB0aGlzLl9yZXF1ZXN0LnJlc3BvbnNlOwoJCX0KCgkJLy8gQW5kcm9pZCAyLjIgdXNlcyAucmVzcG9uc2VUZXh0CgkJdHJ5IHsKCQkJaWYgKHRoaXMuX3JlcXVlc3QucmVzcG9uc2VUZXh0ICE9IG51bGwpIHsKCQkJCXJldHVybiB0aGlzLl9yZXF1ZXN0LnJlc3BvbnNlVGV4dDsKCQkJfQoJCX0gY2F0Y2ggKGUpIHsKCQl9CgoJCS8vIFdoZW4gbG9hZGluZyBYTUwsIElFOSBkb2VzIG5vdCByZXR1cm4gLnJlc3BvbnNlLCBpbnN0ZWFkIGl0IHJldHVybnMgcmVzcG9uc2VYTUwueG1sCgkJLy9UT0RPOiBURVNUCgkJdHJ5IHsKCQkJaWYgKHRoaXMuX3JlcXVlc3QucmVzcG9uc2VYTUwgIT0gbnVsbCkgewoJCQkJcmV0dXJuIHRoaXMuX3JlcXVlc3QucmVzcG9uc2VYTUw7CgkJCX0KCQl9IGNhdGNoIChlKSB7CgkJfQoJCXJldHVybiBudWxsOwoJfTsKCgkvKioKCSAqIENyZWF0ZSBhbiBYSFIgcmVxdWVzdC4gRGVwZW5kaW5nIG9uIGEgbnVtYmVyIG9mIGZhY3RvcnMsIHdlIGdldCB0b3RhbGx5IGRpZmZlcmVudCByZXN1bHRzLgoJICogPG9sPjxsaT5Tb21lIGJyb3dzZXJzIGdldCBhbiA8Y29kZT5YRG9tYWluUmVxdWVzdDwvY29kZT4gd2hlbiBsb2FkaW5nIGNyb3NzLWRvbWFpbi48L2xpPgoJICogICAgICA8bGk+WE1MSHR0cFJlcXVlc3QgYXJlIGNyZWF0ZWQgd2hlbiBhdmFpbGFibGUuPC9saT4KCSAqICAgICAgPGxpPkFjdGl2ZVguWE1MSFRUUCBvYmplY3RzIGFyZSB1c2VkIGluIG9sZGVyIElFIGJyb3dzZXJzLjwvbGk+CgkgKiAgICAgIDxsaT5UZXh0IHJlcXVlc3RzIG92ZXJyaWRlIHRoZSBtaW1lIHR5cGUgaWYgcG9zc2libGU8L2xpPgoJICogICAgICA8bGk+T3JpZ2luIGhlYWRlcnMgYXJlIHNlbnQgZm9yIGNyb3NzZG9tYWluIHJlcXVlc3RzIGluIHNvbWUgYnJvd3NlcnMuPC9saT4KCSAqICAgICAgPGxpPkJpbmFyeSBsb2FkcyBzZXQgdGhlIHJlc3BvbnNlIHR5cGUgdG8gImFycmF5YnVmZmVyIjwvbGk+PC9vbD4KCSAqIEBtZXRob2QgX2NyZWF0ZVhIUgoJICogQHBhcmFtIHtPYmplY3R9IGl0ZW0gVGhlIHJlcXVlc3RlZCBpdGVtIHRoYXQgaXMgYmVpbmcgbG9hZGVkLgoJICogQHJldHVybiB7Qm9vbGVhbn0gSWYgYW4gWEhSIHJlcXVlc3Qgb3IgZXF1aXZhbGVudCB3YXMgc3VjY2Vzc2Z1bGx5IGNyZWF0ZWQuCgkgKiBAcHJpdmF0ZQoJICovCglwLl9jcmVhdGVYSFIgPSBmdW5jdGlvbiAoaXRlbSkgewoJCS8vIENoZWNrIGZvciBjcm9zcy1kb21haW4gbG9hZHMuIFdlIGNhbid0IGZ1bGx5IHN1cHBvcnQgdGhlbSwgYnV0IHdlIGNhbiB0cnkuCgkJdmFyIGNyb3NzZG9tYWluID0gdGhpcy5faXNDcm9zc0RvbWFpbihpdGVtKTsKCgkJLy8gQ3JlYXRlIHRoZSByZXF1ZXN0LiBGYWxsIGJhY2sgdG8gd2hhdGV2ZXIgc3VwcG9ydCB3ZSBoYXZlLgoJCXZhciByZXEgPSBudWxsOwoJCWlmIChjcm9zc2RvbWFpbiAmJiB3aW5kb3cuWERvbWFpblJlcXVlc3QpIHsKCQkJcmVxID0gbmV3IFhEb21haW5SZXF1ZXN0KCk7IC8vIE5vdGU6IElFOSB3aWxsIGZhaWwgaWYgdGhpcyBpcyBub3QgYWN0dWFsbHkgY3Jvc3MtZG9tYWluLgoJCX0gZWxzZSBpZiAod2luZG93LlhNTEh0dHBSZXF1ZXN0KSB7IC8vIE9sZCBJRSB2ZXJzaW9ucyB1c2UgYSBkaWZmZXJlbnQgYXBwcm9hY2gKCQkJcmVxID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7CgkJfSBlbHNlIHsKCQkJdHJ5IHsKCQkJCXJlcSA9IG5ldyBBY3RpdmVYT2JqZWN0KCJNc3htbDIuWE1MSFRUUC42LjAiKTsKCQkJfSBjYXRjaCAoZSkgewoJCQkJdHJ5IHsKCQkJCQlyZXEgPSBuZXcgQWN0aXZlWE9iamVjdCgiTXN4bWwyLlhNTEhUVFAuMy4wIik7CgkJCQl9IGNhdGNoIChlKSB7CgkJCQkJdHJ5IHsKCQkJCQkJcmVxID0gbmV3IEFjdGl2ZVhPYmplY3QoIk1zeG1sMi5YTUxIVFRQIik7CgkJCQkJfSBjYXRjaCAoZSkgewoJCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoKCQkvLyBJRTkgZG9lc24ndCBzdXBwb3J0IG92ZXJyaWRlTWltZVR5cGUoKSwgc28gd2UgbmVlZCB0byBjaGVjayBmb3IgaXQuCgkJaWYgKGNyZWF0ZWpzLkxvYWRRdWV1ZS5pc1RleHQoaXRlbS50eXBlKSAmJiByZXEub3ZlcnJpZGVNaW1lVHlwZSkgewoJCQlyZXEub3ZlcnJpZGVNaW1lVHlwZSgidGV4dC9wbGFpbjsgY2hhcnNldD11dGYtOCIpOwoJCX0KCgkJLy8gRGV0ZXJtaW5lIHRoZSBYSFIgbGV2ZWwKCQl0aGlzLl94aHJMZXZlbCA9ICh0eXBlb2YgcmVxLnJlc3BvbnNlVHlwZSA9PT0gInN0cmluZyIpID8gMiA6IDE7CgoJCXZhciBzcmMgPSBudWxsOwoJCWlmIChpdGVtLm1ldGhvZCA9PSBjcmVhdGVqcy5Mb2FkUXVldWUuR0VUKSB7CgkJCXNyYyA9IHRoaXMuYnVpbGRQYXRoKGl0ZW0uc3JjLCBpdGVtLnZhbHVlcyk7CgkJfSBlbHNlIHsKCQkJc3JjID0gaXRlbS5zcmM7CgkJfQoKCQkvLyBPcGVuIHRoZSByZXF1ZXN0LiAgU2V0IGNyb3NzLWRvbWFpbiBmbGFncyBpZiBpdCBpcyBzdXBwb3J0ZWQgKFhIUiBsZXZlbCAxIG9ubHkpCgkJcmVxLm9wZW4oaXRlbS5tZXRob2QgfHwgY3JlYXRlanMuTG9hZFF1ZXVlLkdFVCwgc3JjLCB0cnVlKTsKCgkJaWYgKGNyb3NzZG9tYWluICYmIHJlcSBpbnN0YW5jZW9mIFhNTEh0dHBSZXF1ZXN0ICYmIHRoaXMuX3hockxldmVsID09IDEpIHsKCQkJcmVxLnNldFJlcXVlc3RIZWFkZXIoIk9yaWdpbiIsIGxvY2F0aW9uLm9yaWdpbik7CgkJfQoKICAgICAgICAvKlRPRE86IFRlc3QgYW5kIGltcGxlbWVudC4KICAgICAgICBpZiAoY3Jvc3NEb21haW4gJiYgIWhlYWRlcnNbIlgtUmVxdWVzdGVkLVdpdGgiXSApIHsKICAgICAgICAgICAgICAgIGhlYWRlcnNbIlgtUmVxdWVzdGVkLVdpdGgiXSA9ICJYTUxIdHRwUmVxdWVzdCI7CiAgICAgICAgfSovCgoJCS8vIFRvIHNlbmQgZGF0YSB3ZSBuZWVkIHRvIHNldCB0aGUgQ29udGVudC10eXBlIGhlYWRlcikKCQkgaWYgKGl0ZW0udmFsdWVzICYmIGl0ZW0ubWV0aG9kID09IGNyZWF0ZWpzLkxvYWRRdWV1ZS5QT1NUKSB7CgkJCXJlcS5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkJyk7CgkJIH0KCgkJLy8gQmluYXJ5IGZpbGVzIGFyZSBsb2FkZWQgZGlmZmVyZW50bHkuCgkJaWYgKGNyZWF0ZWpzLkxvYWRRdWV1ZS5pc0JpbmFyeShpdGVtLnR5cGUpKSB7CgkJCXJlcS5yZXNwb25zZVR5cGUgPSAiYXJyYXlidWZmZXIiOwoJCX0KCgkJdGhpcy5fcmVxdWVzdCA9IHJlcTsKCQlyZXR1cm4gdHJ1ZTsKCX07CgoJLyoqCgkgKiBBIHJlcXVlc3QgaGFzIGNvbXBsZXRlZCAob3IgZmFpbGVkIG9yIGNhbmNlbGVkKSwgYW5kIG5lZWRzIHRvIGJlIGRpc3Bvc2VkLgoJICogQG1ldGhvZCBfY2xlYW4KCSAqIEBwcml2YXRlCgkgKi8KCXAuX2NsZWFuID0gZnVuY3Rpb24gKCkgewoJCWNsZWFyVGltZW91dCh0aGlzLl9sb2FkVGltZW91dCk7CgoJCXZhciByZXEgPSB0aGlzLl9yZXF1ZXN0OwoJCXJlcS5vbmxvYWRzdGFydCA9IG51bGw7CgkJcmVxLm9ucHJvZ3Jlc3MgPSBudWxsOwoJCXJlcS5vbmFib3J0ID0gbnVsbDsKCQlyZXEub25lcnJvciA9IG51bGw7CgkJcmVxLm9ubG9hZCA9IG51bGw7CgkJcmVxLm9udGltZW91dCA9IG51bGw7CgkJcmVxLm9ubG9hZGVuZCA9IG51bGw7CgkJcmVxLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IG51bGw7Cgl9OwoKCS8qKgoJICogR2VuZXJhdGUgYSB0YWcgZm9yIGl0ZW1zIHRoYXQgY2FuIGJlIHJlcHJlc2VudGVkIGFzIHRhZ3MuIEZvciBleGFtcGxlLCBJTUFHRSwgU0NSSVBULCBhbmQgTElOSy4gVGhpcyBhbHNvIGhhbmRsZXMKCSAqIFhNTCBhbmQgU1ZHIG9iamVjdHMuCgkgKiBAbWV0aG9kIF9nZW5lcmF0ZVRhZwoJICogQHJldHVybiB7Qm9vbGVhbn0gSWYgYSB0YWcgd2FzIGdlbmVyYXRlZCBhbmQgaXMgcmVhZHkgZm9yIGluc3RhbnRpYXRpb24uIElmIGl0IHN0aWxsIG5lZWRzIHByb2Nlc3NpbmcsIHRoaXMKCSAqIG1ldGhvZCByZXR1cm5zIGZhbHNlLgoJICogQHByaXZhdGUKCSAqLwoJcC5fZ2VuZXJhdGVUYWcgPSBmdW5jdGlvbiAoKSB7CgkJdmFyIHR5cGUgPSB0aGlzLl9pdGVtLnR5cGU7CgkJdmFyIHRhZyA9IHRoaXMuX2l0ZW0udGFnOwoKCQlzd2l0Y2ggKHR5cGUpIHsKCQkJLy8gTm90ZTogSW1hZ2VzIG5lZWQgdG8gd2FpdCBmb3Igb25sb2FkLCBidXQgZG8gdXNlIHRoZSBjYWNoZS4KCQkJY2FzZSBjcmVhdGVqcy5Mb2FkUXVldWUuSU1BR0U6CgkJCQl0YWcub25sb2FkID0gY3JlYXRlanMucHJveHkodGhpcy5faGFuZGxlVGFnUmVhZHksIHRoaXMpOwoJCQkJaWYgKHRoaXMuX2Nyb3NzT3JpZ2luICE9ICIiKSB7IHRhZy5jcm9zc09yaWdpbiA9ICJBbm9ueW1vdXMiOyB9Ly8gV2UgY2FuIGFzc3VtZSB0aGlzLCBzaW5jZSBYSFIgaW1hZ2VzIGFyZSBhbHdheXMgbG9hZGVkIG9uIGEgc2VydmVyLgoJCQkJdGFnLnNyYyA9IHRoaXMuYnVpbGRQYXRoKHRoaXMuX2l0ZW0uc3JjLCB0aGlzLl9pdGVtLnZhbHVlcyk7CgoJCQkJdGhpcy5fcmF3UmVzcG9uc2UgPSB0aGlzLl9yZXNwb25zZTsKCQkJCXRoaXMuX3Jlc3BvbnNlID0gdGFnOwoJCQkJcmV0dXJuIGZhbHNlOyAvLyBJbWFnZXMgbmVlZCB0byBnZXQgYW4gb25sb2FkIGV2ZW50IGZpcnN0CgoJCQljYXNlIGNyZWF0ZWpzLkxvYWRRdWV1ZS5KQVZBU0NSSVBUOgoJCQkJdGFnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic2NyaXB0Iik7CgkJCQl0YWcudGV4dCA9IHRoaXMuX3Jlc3BvbnNlOwoKCQkJCXRoaXMuX3Jhd1Jlc3BvbnNlID0gdGhpcy5fcmVzcG9uc2U7CgkJCQl0aGlzLl9yZXNwb25zZSA9IHRhZzsKCQkJCXJldHVybiB0cnVlOwoKCQkJY2FzZSBjcmVhdGVqcy5Mb2FkUXVldWUuQ1NTOgoJCQkJLy8gTWF5YmUgZG8gdGhpcyBjb25kaXRpb25hbGx5PwoJCQkJdmFyIGhlYWQgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaGVhZCIpWzBdOyAvL05vdGU6IFRoaXMgaXMgdW5hdm9pZGFibGUgaW4gSUU2NzgKCQkJCWhlYWQuYXBwZW5kQ2hpbGQodGFnKTsKCgkJCQlpZiAodGFnLnN0eWxlU2hlZXQpIHsgLy8gSUUKCQkJCQl0YWcuc3R5bGVTaGVldC5jc3NUZXh0ID0gdGhpcy5fcmVzcG9uc2U7CgkJCQl9IGVsc2UgewoJCQkJCXZhciB0ZXh0Tm9kZSA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHRoaXMuX3Jlc3BvbnNlKTsKCQkJCQl0YWcuYXBwZW5kQ2hpbGQodGV4dE5vZGUpOwoJCQkJfQoKCQkJCXRoaXMuX3Jhd1Jlc3BvbnNlID0gdGhpcy5fcmVzcG9uc2U7CgkJCQl0aGlzLl9yZXNwb25zZSA9IHRhZzsKCQkJCXJldHVybiB0cnVlOwoKCQkJY2FzZSBjcmVhdGVqcy5Mb2FkUXVldWUuWE1MOgoJCQkJdmFyIHhtbCA9IHRoaXMuX3BhcnNlWE1MKHRoaXMuX3Jlc3BvbnNlLCAidGV4dC94bWwiKTsKCQkJCXRoaXMuX3Jhd1Jlc3BvbnNlID0gdGhpcy5fcmVzcG9uc2U7CgkJCQl0aGlzLl9yZXNwb25zZSA9IHhtbDsKCQkJCXJldHVybiB0cnVlOwoKCQkJY2FzZSBjcmVhdGVqcy5Mb2FkUXVldWUuU1ZHOgoJCQkJdmFyIHhtbCA9IHRoaXMuX3BhcnNlWE1MKHRoaXMuX3Jlc3BvbnNlLCAiaW1hZ2Uvc3ZnK3htbCIpOwoJCQkJdGhpcy5fcmF3UmVzcG9uc2UgPSB0aGlzLl9yZXNwb25zZTsKCQkJCWlmICh4bWwuZG9jdW1lbnRFbGVtZW50ICE9IG51bGwpIHsKCQkJCQl0YWcuYXBwZW5kQ2hpbGQoeG1sLmRvY3VtZW50RWxlbWVudCk7CgkJCQkJdGhpcy5fcmVzcG9uc2UgPSB0YWc7CgkJCQl9IGVsc2UgeyAvLyBGb3IgYnJvd3NlcnMgdGhhdCBkb24ndCBzdXBwb3J0IFNWRywganVzdCBnaXZlIHRoZW0gdGhlIFhNTC4gKElFIDktOCkKCQkJCQl0aGlzLl9yZXNwb25zZSA9IHhtbDsKCQkJCX0KCQkJCXJldHVybiB0cnVlOwoKCQkJY2FzZSBjcmVhdGVqcy5Mb2FkUXVldWUuSlNPTjoKCQkJY2FzZSBjcmVhdGVqcy5Mb2FkUXVldWUuTUFOSUZFU1Q6CgkJCQl2YXIganNvbiA9IHt9OwoJCQkJdHJ5IHsKCQkJCQlqc29uID0gSlNPTi5wYXJzZSh0aGlzLl9yZXNwb25zZSk7CgkJCQl9IGNhdGNoIChlcnJvcikgewoJCQkJCWpzb24gPSBlcnJvcjsKCQkJCX0KCgkJCQl0aGlzLl9yYXdSZXNwb25zZSA9IHRoaXMuX3Jlc3BvbnNlOwoJCQkJdGhpcy5fcmVzcG9uc2UgPSBqc29uOwoJCQkJcmV0dXJuIHRydWU7CgoJCX0KCQlyZXR1cm4gdHJ1ZTsKCX07CgoJLyoqCgkgKiBQYXJzZSBYTUwgdXNpbmcgdGhlIERPTS4gVGhpcyBpcyByZXF1aXJlZCB3aGVuIHByZWxvYWRpbmcgWE1MIG9yIFNWRy4KCSAqIEBtZXRob2QgX3BhcnNlWE1MCgkgKiBAcGFyYW0ge1N0cmluZ30gdGV4dCBUaGUgcmF3IHRleHQgb3IgWE1MIHRoYXQgaXMgbG9hZGVkIGJ5IFhIUi4KCSAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlIFRoZSBtaW1lIHR5cGUgb2YgdGhlIFhNTC4KCSAqIEByZXR1cm4ge1hNTH0gQW4gWE1MIGRvY3VtZW50LgoJICogQHByaXZhdGUKCSAqLwoJcC5fcGFyc2VYTUwgPSBmdW5jdGlvbiAodGV4dCwgdHlwZSkgewoJCXZhciB4bWwgPSBudWxsOwoJCXRyeSB7CgkJCS8vIENvY29vbkpTIGRvZXMgbm90IHN1cHBvcnQgWE1MIHBhcnNpbmcgd2l0aCBlaXRoZXIgbWV0aG9kLgoJCQkvLyBXaW5kb3dzICg/KSBPcGVyYSBET01QYXJzZXIgdGhyb3dzIERPTUV4Y2VwdGlvbjogTk9UX1NVUFBPUlRFRF9FUlIgIC8vIHBvdGVudGlhbCBzb2x1dGlvbiBodHRwczovL2dpc3QuZ2l0aHViLmNvbS8xMTI5MDMxCgkJCWlmICh3aW5kb3cuRE9NUGFyc2VyKSB7CgkJCQl2YXIgcGFyc2VyID0gbmV3IERPTVBhcnNlcigpOwoJCQkJeG1sID0gcGFyc2VyLnBhcnNlRnJvbVN0cmluZyh0ZXh0LCB0eXBlKTsKCQkJfSBlbHNlIHsgLy8gSUUKCQkJCXhtbCA9IG5ldyBBY3RpdmVYT2JqZWN0KCJNaWNyb3NvZnQuWE1MRE9NIik7CgkJCQl4bWwuYXN5bmMgPSBmYWxzZTsKCQkJCXhtbC5sb2FkWE1MKHRleHQpOwoJCQl9CgkJfSBjYXRjaCAoZSkge30KCQlyZXR1cm4geG1sOwoJfTsKCgkvKioKCSAqIEEgZ2VuZXJhdGVkIHRhZyBpcyBub3cgcmVhZHkgZm9yIHVzZS4KCSAqIEBtZXRob2QgX2hhbmRsZVRhZ1JlYWR5CgkgKiBAcHJpdmF0ZQoJICovCglwLl9oYW5kbGVUYWdSZWFkeSA9IGZ1bmN0aW9uICgpIHsKCQl0aGlzLl9zZW5kQ29tcGxldGUoKTsKCX07CgoJcC50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHsKCQlyZXR1cm4gIltQcmVsb2FkSlMgWEhSTG9hZGVyXSI7Cgl9OwoKCWNyZWF0ZWpzLlhIUkxvYWRlciA9IFhIUkxvYWRlcjsKCn0oKSk7CgovKioKICogSW5jbHVkZSBqc29uMiBoZXJlLCB0byBjb3JyZWN0bHkgcGFyc2UganNvbi4KICogVXNlZCBvbiBicm93c2VycyB0aGF0IGRvbid0IGhhdmUgYSBuYXRpdmUgSlNPTiBvYmplY3QuCiAqCiAqLwovKgoganNvbjIuanMKIDIwMTItMTAtMDgKCiBQdWJsaWMgRG9tYWluLgoKIE5PIFdBUlJBTlRZIEVYUFJFU1NFRCBPUiBJTVBMSUVELiBVU0UgQVQgWU9VUiBPV04gUklTSy4KCiBTZWUgaHR0cDovL3d3dy5KU09OLm9yZy9qcy5odG1sCgoKIFRoaXMgY29kZSBzaG91bGQgYmUgbWluaWZpZWQgYmVmb3JlIGRlcGxveW1lbnQuCiBTZWUgaHR0cDovL2phdmFzY3JpcHQuY3JvY2tmb3JkLmNvbS9qc21pbi5odG1sCgogVVNFIFlPVVIgT1dOIENPUFkuIElUIElTIEVYVFJFTUVMWSBVTldJU0UgVE8gTE9BRCBDT0RFIEZST00gU0VSVkVSUyBZT1UgRE8KIE5PVCBDT05UUk9MLgogKi8KCgovLyBDcmVhdGUgYSBKU09OIG9iamVjdCBvbmx5IGlmIG9uZSBkb2VzIG5vdCBhbHJlYWR5IGV4aXN0LiBXZSBjcmVhdGUgdGhlCi8vIG1ldGhvZHMgaW4gYSBjbG9zdXJlIHRvIGF2b2lkIGNyZWF0aW5nIGdsb2JhbCB2YXJpYWJsZXMuCgppZiAodHlwZW9mIEpTT04gIT09ICdvYmplY3QnKSB7CglKU09OID0ge307Cn0KCihmdW5jdGlvbiAoKSB7CgkndXNlIHN0cmljdCc7CgoJZnVuY3Rpb24gZihuKSB7CgkJLy8gRm9ybWF0IGludGVnZXJzIHRvIGhhdmUgYXQgbGVhc3QgdHdvIGRpZ2l0cy4KCQlyZXR1cm4gbiA8IDEwID8gJzAnICsgbiA6IG47Cgl9CgoJaWYgKHR5cGVvZiBEYXRlLnByb3RvdHlwZS50b0pTT04gIT09ICdmdW5jdGlvbicpIHsKCgkJRGF0ZS5wcm90b3R5cGUudG9KU09OID0gZnVuY3Rpb24gKGtleSkgewoKCQkJcmV0dXJuIGlzRmluaXRlKHRoaXMudmFsdWVPZigpKQoJCQkJCT8gdGhpcy5nZXRVVENGdWxsWWVhcigpICsgJy0nICsKCQkJCQlmKHRoaXMuZ2V0VVRDTW9udGgoKSArIDEpICsgJy0nICsKCQkJCQlmKHRoaXMuZ2V0VVRDRGF0ZSgpKSArICdUJyArCgkJCQkJZih0aGlzLmdldFVUQ0hvdXJzKCkpICsgJzonICsKCQkJCQlmKHRoaXMuZ2V0VVRDTWludXRlcygpKSArICc6JyArCgkJCQkJZih0aGlzLmdldFVUQ1NlY29uZHMoKSkgKyAnWicKCQkJCQk6IG51bGw7CgkJfTsKCgkJU3RyaW5nLnByb3RvdHlwZS50b0pTT04gPQoJCQkJTnVtYmVyLnByb3RvdHlwZS50b0pTT04gPQoJCQkJCQlCb29sZWFuLnByb3RvdHlwZS50b0pTT04gPSBmdW5jdGlvbiAoa2V5KSB7CgkJCQkJCQlyZXR1cm4gdGhpcy52YWx1ZU9mKCk7CgkJCQkJCX07Cgl9CgoJdmFyIGN4ID0gL1tcdTAwMDBcdTAwYWRcdTA2MDAtXHUwNjA0XHUwNzBmXHUxN2I0XHUxN2I1XHUyMDBjLVx1MjAwZlx1MjAyOC1cdTIwMmZcdTIwNjAtXHUyMDZmXHVmZWZmXHVmZmYwLVx1ZmZmZl0vZywKCQkJZXNjYXBhYmxlID0gL1tcXFwiXHgwMC1ceDFmXHg3Zi1ceDlmXHUwMGFkXHUwNjAwLVx1MDYwNFx1MDcwZlx1MTdiNFx1MTdiNVx1MjAwYy1cdTIwMGZcdTIwMjgtXHUyMDJmXHUyMDYwLVx1MjA2Zlx1ZmVmZlx1ZmZmMC1cdWZmZmZdL2csCgkJCWdhcCwKCQkJaW5kZW50LAoJCQltZXRhID0geyAgICAvLyB0YWJsZSBvZiBjaGFyYWN0ZXIgc3Vic3RpdHV0aW9ucwoJCQkJJ1xiJzonXFxiJywKCQkJCSdcdCc6J1xcdCcsCgkJCQknXG4nOidcXG4nLAoJCQkJJ1xmJzonXFxmJywKCQkJCSdccic6J1xccicsCgkJCQknIic6J1xcIicsCgkJCQknXFwnOidcXFxcJwoJCQl9LAoJCQlyZXA7CgoKCWZ1bmN0aW9uIHF1b3RlKHN0cmluZykgewoKLy8gSWYgdGhlIHN0cmluZyBjb250YWlucyBubyBjb250cm9sIGNoYXJhY3RlcnMsIG5vIHF1b3RlIGNoYXJhY3RlcnMsIGFuZCBubwovLyBiYWNrc2xhc2ggY2hhcmFjdGVycywgdGhlbiB3ZSBjYW4gc2FmZWx5IHNsYXAgc29tZSBxdW90ZXMgYXJvdW5kIGl0LgovLyBPdGhlcndpc2Ugd2UgbXVzdCBhbHNvIHJlcGxhY2UgdGhlIG9mZmVuZGluZyBjaGFyYWN0ZXJzIHdpdGggc2FmZSBlc2NhcGUKLy8gc2VxdWVuY2VzLgoKCQllc2NhcGFibGUubGFzdEluZGV4ID0gMDsKCQlyZXR1cm4gZXNjYXBhYmxlLnRlc3Qoc3RyaW5nKSA/ICciJyArIHN0cmluZy5yZXBsYWNlKGVzY2FwYWJsZSwgZnVuY3Rpb24gKGEpIHsKCQkJdmFyIGMgPSBtZXRhW2FdOwoJCQlyZXR1cm4gdHlwZW9mIGMgPT09ICdzdHJpbmcnCgkJCQkJPyBjCgkJCQkJOiAnXFx1JyArICgnMDAwMCcgKyBhLmNoYXJDb2RlQXQoMCkudG9TdHJpbmcoMTYpKS5zbGljZSgtNCk7CgkJfSkgKyAnIicgOiAnIicgKyBzdHJpbmcgKyAnIic7Cgl9CgoKCWZ1bmN0aW9uIHN0cihrZXksIGhvbGRlcikgewoKLy8gUHJvZHVjZSBhIHN0cmluZyBmcm9tIGhvbGRlcltrZXldLgoKCQl2YXIgaSwgLy8gVGhlIGxvb3AgY291bnRlci4KCQkJCWssIC8vIFRoZSBtZW1iZXIga2V5LgoJCQkJdiwgLy8gVGhlIG1lbWJlciB2YWx1ZS4KCQkJCWxlbmd0aCwKCQkJCW1pbmQgPSBnYXAsCgkJCQlwYXJ0aWFsLAoJCQkJdmFsdWUgPSBob2xkZXJba2V5XTsKCi8vIElmIHRoZSB2YWx1ZSBoYXMgYSB0b0pTT04gbWV0aG9kLCBjYWxsIGl0IHRvIG9idGFpbiBhIHJlcGxhY2VtZW50IHZhbHVlLgoKCQlpZiAodmFsdWUgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJgoJCQkJdHlwZW9mIHZhbHVlLnRvSlNPTiA9PT0gJ2Z1bmN0aW9uJykgewoJCQl2YWx1ZSA9IHZhbHVlLnRvSlNPTihrZXkpOwoJCX0KCi8vIElmIHdlIHdlcmUgY2FsbGVkIHdpdGggYSByZXBsYWNlciBmdW5jdGlvbiwgdGhlbiBjYWxsIHRoZSByZXBsYWNlciB0bwovLyBvYnRhaW4gYSByZXBsYWNlbWVudCB2YWx1ZS4KCgkJaWYgKHR5cGVvZiByZXAgPT09ICdmdW5jdGlvbicpIHsKCQkJdmFsdWUgPSByZXAuY2FsbChob2xkZXIsIGtleSwgdmFsdWUpOwoJCX0KCi8vIFdoYXQgaGFwcGVucyBuZXh0IGRlcGVuZHMgb24gdGhlIHZhbHVlJ3MgdHlwZS4KCgkJc3dpdGNoICh0eXBlb2YgdmFsdWUpIHsKCQkJY2FzZSAnc3RyaW5nJzoKCQkJCXJldHVybiBxdW90ZSh2YWx1ZSk7CgoJCQljYXNlICdudW1iZXInOgoKLy8gSlNPTiBudW1iZXJzIG11c3QgYmUgZmluaXRlLiBFbmNvZGUgbm9uLWZpbml0ZSBudW1iZXJzIGFzIG51bGwuCgoJCQkJcmV0dXJuIGlzRmluaXRlKHZhbHVlKSA/IFN0cmluZyh2YWx1ZSkgOiAnbnVsbCc7CgoJCQljYXNlICdib29sZWFuJzoKCQkJY2FzZSAnbnVsbCc6CgovLyBJZiB0aGUgdmFsdWUgaXMgYSBib29sZWFuIG9yIG51bGwsIGNvbnZlcnQgaXQgdG8gYSBzdHJpbmcuIE5vdGU6Ci8vIHR5cGVvZiBudWxsIGRvZXMgbm90IHByb2R1Y2UgJ251bGwnLiBUaGUgY2FzZSBpcyBpbmNsdWRlZCBoZXJlIGluCi8vIHRoZSByZW1vdGUgY2hhbmNlIHRoYXQgdGhpcyBnZXRzIGZpeGVkIHNvbWVkYXkuCgoJCQkJcmV0dXJuIFN0cmluZyh2YWx1ZSk7CgovLyBJZiB0aGUgdHlwZSBpcyAnb2JqZWN0Jywgd2UgbWlnaHQgYmUgZGVhbGluZyB3aXRoIGFuIG9iamVjdCBvciBhbiBhcnJheSBvcgovLyBudWxsLgoKCQkJY2FzZSAnb2JqZWN0JzoKCi8vIER1ZSB0byBhIHNwZWNpZmljYXRpb24gYmx1bmRlciBpbiBFQ01BU2NyaXB0LCB0eXBlb2YgbnVsbCBpcyAnb2JqZWN0JywKLy8gc28gd2F0Y2ggb3V0IGZvciB0aGF0IGNhc2UuCgoJCQkJaWYgKCF2YWx1ZSkgewoJCQkJCXJldHVybiAnbnVsbCc7CgkJCQl9CgovLyBNYWtlIGFuIGFycmF5IHRvIGhvbGQgdGhlIHBhcnRpYWwgcmVzdWx0cyBvZiBzdHJpbmdpZnlpbmcgdGhpcyBvYmplY3QgdmFsdWUuCgoJCQkJZ2FwICs9IGluZGVudDsKCQkJCXBhcnRpYWwgPSBbXTsKCi8vIElzIHRoZSB2YWx1ZSBhbiBhcnJheT8KCgkJCQlpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5hcHBseSh2YWx1ZSkgPT09ICdbb2JqZWN0IEFycmF5XScpIHsKCi8vIFRoZSB2YWx1ZSBpcyBhbiBhcnJheS4gU3RyaW5naWZ5IGV2ZXJ5IGVsZW1lbnQuIFVzZSBudWxsIGFzIGEgcGxhY2Vob2xkZXIKLy8gZm9yIG5vbi1KU09OIHZhbHVlcy4KCgkJCQkJbGVuZ3RoID0gdmFsdWUubGVuZ3RoOwoJCQkJCWZvciAoaSA9IDA7IGkgPCBsZW5ndGg7IGkgKz0gMSkgewoJCQkJCQlwYXJ0aWFsW2ldID0gc3RyKGksIHZhbHVlKSB8fCAnbnVsbCc7CgkJCQkJfQoKLy8gSm9pbiBhbGwgb2YgdGhlIGVsZW1lbnRzIHRvZ2V0aGVyLCBzZXBhcmF0ZWQgd2l0aCBjb21tYXMsIGFuZCB3cmFwIHRoZW0gaW4KLy8gYnJhY2tldHMuCgoJCQkJCXYgPSBwYXJ0aWFsLmxlbmd0aCA9PT0gMAoJCQkJCQkJPyAnW10nCgkJCQkJCQk6IGdhcAoJCQkJCQkJPyAnW1xuJyArIGdhcCArIHBhcnRpYWwuam9pbignLFxuJyArIGdhcCkgKyAnXG4nICsgbWluZCArICddJwoJCQkJCQkJOiAnWycgKyBwYXJ0aWFsLmpvaW4oJywnKSArICddJzsKCQkJCQlnYXAgPSBtaW5kOwoJCQkJCXJldHVybiB2OwoJCQkJfQoKLy8gSWYgdGhlIHJlcGxhY2VyIGlzIGFuIGFycmF5LCB1c2UgaXQgdG8gc2VsZWN0IHRoZSBtZW1iZXJzIHRvIGJlIHN0cmluZ2lmaWVkLgoKCQkJCWlmIChyZXAgJiYgdHlwZW9mIHJlcCA9PT0gJ29iamVjdCcpIHsKCQkJCQlsZW5ndGggPSByZXAubGVuZ3RoOwoJCQkJCWZvciAoaSA9IDA7IGkgPCBsZW5ndGg7IGkgKz0gMSkgewoJCQkJCQlpZiAodHlwZW9mIHJlcFtpXSA9PT0gJ3N0cmluZycpIHsKCQkJCQkJCWsgPSByZXBbaV07CgkJCQkJCQl2ID0gc3RyKGssIHZhbHVlKTsKCQkJCQkJCWlmICh2KSB7CgkJCQkJCQkJcGFydGlhbC5wdXNoKHF1b3RlKGspICsgKGdhcCA/ICc6ICcgOiAnOicpICsgdik7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9CgkJCQl9IGVsc2UgewoKLy8gT3RoZXJ3aXNlLCBpdGVyYXRlIHRocm91Z2ggYWxsIG9mIHRoZSBrZXlzIGluIHRoZSBvYmplY3QuCgoJCQkJCWZvciAoayBpbiB2YWx1ZSkgewoJCQkJCQlpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHZhbHVlLCBrKSkgewoJCQkJCQkJdiA9IHN0cihrLCB2YWx1ZSk7CgkJCQkJCQlpZiAodikgewoJCQkJCQkJCXBhcnRpYWwucHVzaChxdW90ZShrKSArIChnYXAgPyAnOiAnIDogJzonKSArIHYpOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoJCQkJfQoKLy8gSm9pbiBhbGwgb2YgdGhlIG1lbWJlciB0ZXh0cyB0b2dldGhlciwgc2VwYXJhdGVkIHdpdGggY29tbWFzLAovLyBhbmQgd3JhcCB0aGVtIGluIGJyYWNlcy4KCgkJCQl2ID0gcGFydGlhbC5sZW5ndGggPT09IDAKCQkJCQkJPyAne30nCgkJCQkJCTogZ2FwCgkJCQkJCT8gJ3tcbicgKyBnYXAgKyBwYXJ0aWFsLmpvaW4oJyxcbicgKyBnYXApICsgJ1xuJyArIG1pbmQgKyAnfScKCQkJCQkJOiAneycgKyBwYXJ0aWFsLmpvaW4oJywnKSArICd9JzsKCQkJCWdhcCA9IG1pbmQ7CgkJCQlyZXR1cm4gdjsKCQl9Cgl9CgovLyBJZiB0aGUgSlNPTiBvYmplY3QgZG9lcyBub3QgeWV0IGhhdmUgYSBzdHJpbmdpZnkgbWV0aG9kLCBnaXZlIGl0IG9uZS4KCglpZiAodHlwZW9mIEpTT04uc3RyaW5naWZ5ICE9PSAnZnVuY3Rpb24nKSB7CgkJSlNPTi5zdHJpbmdpZnkgPSBmdW5jdGlvbiAodmFsdWUsIHJlcGxhY2VyLCBzcGFjZSkgewoKLy8gVGhlIHN0cmluZ2lmeSBtZXRob2QgdGFrZXMgYSB2YWx1ZSBhbmQgYW4gb3B0aW9uYWwgcmVwbGFjZXIsIGFuZCBhbiBvcHRpb25hbAovLyBzcGFjZSBwYXJhbWV0ZXIsIGFuZCByZXR1cm5zIGEgSlNPTiB0ZXh0LiBUaGUgcmVwbGFjZXIgY2FuIGJlIGEgZnVuY3Rpb24KLy8gdGhhdCBjYW4gcmVwbGFjZSB2YWx1ZXMsIG9yIGFuIGFycmF5IG9mIHN0cmluZ3MgdGhhdCB3aWxsIHNlbGVjdCB0aGUga2V5cy4KLy8gQSBkZWZhdWx0IHJlcGxhY2VyIG1ldGhvZCBjYW4gYmUgcHJvdmlkZWQuIFVzZSBvZiB0aGUgc3BhY2UgcGFyYW1ldGVyIGNhbgovLyBwcm9kdWNlIHRleHQgdGhhdCBpcyBtb3JlIGVhc2lseSByZWFkYWJsZS4KCgkJCXZhciBpOwoJCQlnYXAgPSAnJzsKCQkJaW5kZW50ID0gJyc7CgovLyBJZiB0aGUgc3BhY2UgcGFyYW1ldGVyIGlzIGEgbnVtYmVyLCBtYWtlIGFuIGluZGVudCBzdHJpbmcgY29udGFpbmluZyB0aGF0Ci8vIG1hbnkgc3BhY2VzLgoKCQkJaWYgKHR5cGVvZiBzcGFjZSA9PT0gJ251bWJlcicpIHsKCQkJCWZvciAoaSA9IDA7IGkgPCBzcGFjZTsgaSArPSAxKSB7CgkJCQkJaW5kZW50ICs9ICcgJzsKCQkJCX0KCi8vIElmIHRoZSBzcGFjZSBwYXJhbWV0ZXIgaXMgYSBzdHJpbmcsIGl0IHdpbGwgYmUgdXNlZCBhcyB0aGUgaW5kZW50IHN0cmluZy4KCgkJCX0gZWxzZSBpZiAodHlwZW9mIHNwYWNlID09PSAnc3RyaW5nJykgewoJCQkJaW5kZW50ID0gc3BhY2U7CgkJCX0KCi8vIElmIHRoZXJlIGlzIGEgcmVwbGFjZXIsIGl0IG11c3QgYmUgYSBmdW5jdGlvbiBvciBhbiBhcnJheS4KLy8gT3RoZXJ3aXNlLCB0aHJvdyBhbiBlcnJvci4KCgkJCXJlcCA9IHJlcGxhY2VyOwoJCQlpZiAocmVwbGFjZXIgJiYgdHlwZW9mIHJlcGxhY2VyICE9PSAnZnVuY3Rpb24nICYmCgkJCQkJKHR5cGVvZiByZXBsYWNlciAhPT0gJ29iamVjdCcgfHwKCQkJCQkJCXR5cGVvZiByZXBsYWNlci5sZW5ndGggIT09ICdudW1iZXInKSkgewoJCQkJdGhyb3cgbmV3IEVycm9yKCdKU09OLnN0cmluZ2lmeScpOwoJCQl9CgovLyBNYWtlIGEgZmFrZSByb290IG9iamVjdCBjb250YWluaW5nIG91ciB2YWx1ZSB1bmRlciB0aGUga2V5IG9mICcnLgovLyBSZXR1cm4gdGhlIHJlc3VsdCBvZiBzdHJpbmdpZnlpbmcgdGhlIHZhbHVlLgoKCQkJcmV0dXJuIHN0cignJywgeycnOnZhbHVlfSk7CgkJfTsKCX0KCgovLyBJZiB0aGUgSlNPTiBvYmplY3QgZG9lcyBub3QgeWV0IGhhdmUgYSBwYXJzZSBtZXRob2QsIGdpdmUgaXQgb25lLgoKCWlmICh0eXBlb2YgSlNPTi5wYXJzZSAhPT0gJ2Z1bmN0aW9uJykgewoJCUpTT04ucGFyc2UgPSBmdW5jdGlvbiAodGV4dCwgcmV2aXZlcikgewoKLy8gVGhlIHBhcnNlIG1ldGhvZCB0YWtlcyBhIHRleHQgYW5kIGFuIG9wdGlvbmFsIHJldml2ZXIgZnVuY3Rpb24sIGFuZCByZXR1cm5zCi8vIGEgSmF2YVNjcmlwdCB2YWx1ZSBpZiB0aGUgdGV4dCBpcyBhIHZhbGlkIEpTT04gdGV4dC4KCgkJCXZhciBqOwoKCQkJZnVuY3Rpb24gd2Fsayhob2xkZXIsIGtleSkgewoKLy8gVGhlIHdhbGsgbWV0aG9kIGlzIHVzZWQgdG8gcmVjdXJzaXZlbHkgd2FsayB0aGUgcmVzdWx0aW5nIHN0cnVjdHVyZSBzbwovLyB0aGF0IG1vZGlmaWNhdGlvbnMgY2FuIGJlIG1hZGUuCgoJCQkJdmFyIGssIHYsIHZhbHVlID0gaG9sZGVyW2tleV07CgkJCQlpZiAodmFsdWUgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JykgewoJCQkJCWZvciAoayBpbiB2YWx1ZSkgewoJCQkJCQlpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHZhbHVlLCBrKSkgewoJCQkJCQkJdiA9IHdhbGsodmFsdWUsIGspOwoJCQkJCQkJaWYgKHYgIT09IHVuZGVmaW5lZCkgewoJCQkJCQkJCXZhbHVlW2tdID0gdjsKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJZGVsZXRlIHZhbHVlW2tdOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQkJcmV0dXJuIHJldml2ZXIuY2FsbChob2xkZXIsIGtleSwgdmFsdWUpOwoJCQl9CgoKLy8gUGFyc2luZyBoYXBwZW5zIGluIGZvdXIgc3RhZ2VzLiBJbiB0aGUgZmlyc3Qgc3RhZ2UsIHdlIHJlcGxhY2UgY2VydGFpbgovLyBVbmljb2RlIGNoYXJhY3RlcnMgd2l0aCBlc2NhcGUgc2VxdWVuY2VzLiBKYXZhU2NyaXB0IGhhbmRsZXMgbWFueSBjaGFyYWN0ZXJzCi8vIGluY29ycmVjdGx5LCBlaXRoZXIgc2lsZW50bHkgZGVsZXRpbmcgdGhlbSwgb3IgdHJlYXRpbmcgdGhlbSBhcyBsaW5lIGVuZGluZ3MuCgoJCQl0ZXh0ID0gU3RyaW5nKHRleHQpOwoJCQljeC5sYXN0SW5kZXggPSAwOwoJCQlpZiAoY3gudGVzdCh0ZXh0KSkgewoJCQkJdGV4dCA9IHRleHQucmVwbGFjZShjeCwgZnVuY3Rpb24gKGEpIHsKCQkJCQlyZXR1cm4gJ1xcdScgKwoJCQkJCQkJKCcwMDAwJyArIGEuY2hhckNvZGVBdCgwKS50b1N0cmluZygxNikpLnNsaWNlKC00KTsKCQkJCX0pOwoJCQl9CgovLyBJbiB0aGUgc2Vjb25kIHN0YWdlLCB3ZSBydW4gdGhlIHRleHQgYWdhaW5zdCByZWd1bGFyIGV4cHJlc3Npb25zIHRoYXQgbG9vawovLyBmb3Igbm9uLUpTT04gcGF0dGVybnMuIFdlIGFyZSBlc3BlY2lhbGx5IGNvbmNlcm5lZCB3aXRoICcoKScgYW5kICduZXcnCi8vIGJlY2F1c2UgdGhleSBjYW4gY2F1c2UgaW52b2NhdGlvbiwgYW5kICc9JyBiZWNhdXNlIGl0IGNhbiBjYXVzZSBtdXRhdGlvbi4KLy8gQnV0IGp1c3QgdG8gYmUgc2FmZSwgd2Ugd2FudCB0byByZWplY3QgYWxsIHVuZXhwZWN0ZWQgZm9ybXMuCgovLyBXZSBzcGxpdCB0aGUgc2Vjb25kIHN0YWdlIGludG8gNCByZWdleHAgb3BlcmF0aW9ucyBpbiBvcmRlciB0byB3b3JrIGFyb3VuZAovLyBjcmlwcGxpbmcgaW5lZmZpY2llbmNpZXMgaW4gSUUncyBhbmQgU2FmYXJpJ3MgcmVnZXhwIGVuZ2luZXMuIEZpcnN0IHdlCi8vIHJlcGxhY2UgdGhlIEpTT04gYmFja3NsYXNoIHBhaXJzIHdpdGggJ0AnIChhIG5vbi1KU09OIGNoYXJhY3RlcikuIFNlY29uZCwgd2UKLy8gcmVwbGFjZSBhbGwgc2ltcGxlIHZhbHVlIHRva2VucyB3aXRoICddJyBjaGFyYWN0ZXJzLiBUaGlyZCwgd2UgZGVsZXRlIGFsbAovLyBvcGVuIGJyYWNrZXRzIHRoYXQgZm9sbG93IGEgY29sb24gb3IgY29tbWEgb3IgdGhhdCBiZWdpbiB0aGUgdGV4dC4gRmluYWxseSwKLy8gd2UgbG9vayB0byBzZWUgdGhhdCB0aGUgcmVtYWluaW5nIGNoYXJhY3RlcnMgYXJlIG9ubHkgd2hpdGVzcGFjZSBvciAnXScgb3IKLy8gJywnIG9yICc6JyBvciAneycgb3IgJ30nLiBJZiB0aGF0IGlzIHNvLCB0aGVuIHRoZSB0ZXh0IGlzIHNhZmUgZm9yIGV2YWwuCgoJCQlpZiAoL15bXF0sOnt9XHNdKiQvCgkJCQkJLnRlc3QodGV4dC5yZXBsYWNlKC9cXCg/OlsiXFxcL2JmbnJ0XXx1WzAtOWEtZkEtRl17NH0pL2csICdAJykKCQkJCQkJCQkgIC5yZXBsYWNlKC8iW14iXFxcblxyXSoifHRydWV8ZmFsc2V8bnVsbHwtP1xkKyg/OlwuXGQqKT8oPzpbZUVdWytcLV0/XGQrKT8vZywgJ10nKQoJCQkJCQkJCSAgLnJlcGxhY2UoLyg/Ol58OnwsKSg/OlxzKlxbKSsvZywgJycpKSkgewoKLy8gSW4gdGhlIHRoaXJkIHN0YWdlIHdlIHVzZSB0aGUgZXZhbCBmdW5jdGlvbiB0byBjb21waWxlIHRoZSB0ZXh0IGludG8gYQovLyBKYXZhU2NyaXB0IHN0cnVjdHVyZS4gVGhlICd7JyBvcGVyYXRvciBpcyBzdWJqZWN0IHRvIGEgc3ludGFjdGljIGFtYmlndWl0eQovLyBpbiBKYXZhU2NyaXB0OiBpdCBjYW4gYmVnaW4gYSBibG9jayBvciBhbiBvYmplY3QgbGl0ZXJhbC4gV2Ugd3JhcCB0aGUgdGV4dAovLyBpbiBwYXJlbnMgdG8gZWxpbWluYXRlIHRoZSBhbWJpZ3VpdHkuCgoJCQkJaiA9IGV2YWwoJygnICsgdGV4dCArICcpJyk7CgovLyBJbiB0aGUgb3B0aW9uYWwgZm91cnRoIHN0YWdlLCB3ZSByZWN1cnNpdmVseSB3YWxrIHRoZSBuZXcgc3RydWN0dXJlLCBwYXNzaW5nCi8vIGVhY2ggbmFtZS92YWx1ZSBwYWlyIHRvIGEgcmV2aXZlciBmdW5jdGlvbiBmb3IgcG9zc2libGUgdHJhbnNmb3JtYXRpb24uCgoJCQkJcmV0dXJuIHR5cGVvZiByZXZpdmVyID09PSAnZnVuY3Rpb24nCgkJCQkJCT8gd2Fsayh7Jyc6an0sICcnKQoJCQkJCQk6IGo7CgkJCX0KCi8vIElmIHRoZSB0ZXh0IGlzIG5vdCBKU09OIHBhcnNlYWJsZSwgdGhlbiBhIFN5bnRheEVycm9yIGlzIHRocm93bi4KCgkJCXRocm93IG5ldyBTeW50YXhFcnJvcignSlNPTi5wYXJzZScpOwoJCX07Cgl9Cn0oKSk7Cg==",
                "body": "dGhpcy5jcmVhdGVqcyA9IHRoaXMuY3JlYXRlanN8fHt9OwoKKGZ1bmN0aW9uKCkgewoJInVzZSBzdHJpY3QiOwoKCS8qKgoJICogU3RhdGljIGNsYXNzIGhvbGRpbmcgbGlicmFyeSBzcGVjaWZpYyBpbmZvcm1hdGlvbiBzdWNoIGFzIHRoZSB2ZXJzaW9uIGFuZCBidWlsZERhdGUgb2YKCSAqIHRoZSBsaWJyYXJ5LgoJICoKCSAqIFRoZSBvbGQgUHJlbG9hZEpTIGNsYXNzIGhhcyBiZWVuIHJlbmFtZWQgdG8gTG9hZFF1ZXVlLiBQbGVhc2Ugc2VlIHRoZSB7eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZSJ9fXt7L2Nyb3NzTGlua319CgkgKiBjbGFzcyBmb3IgaW5mb3JtYXRpb24gb24gbG9hZGluZyBmaWxlcy4KCSAqIEBjbGFzcyBQcmVsb2FkSlMKCSAqKi8KCXZhciBzID0gY3JlYXRlanMuUHJlbG9hZEpTID0gY3JlYXRlanMuUHJlbG9hZEpTIHx8IHt9OwoKCS8qKgoJICogVGhlIHZlcnNpb24gc3RyaW5nIGZvciB0aGlzIHJlbGVhc2UuCgkgKiBAcHJvcGVydHkgdmVyc2lvbgoJICogQHR5cGUgU3RyaW5nCgkgKiBAc3RhdGljCgkgKiovCglzLnZlcnNpb24gPSAvKnZlcnNpb24qLyIwLjQuMSI7IC8vIGluamVjdGVkIGJ5IGJ1aWxkIHByb2Nlc3MKCgkvKioKCSAqIFRoZSBidWlsZCBkYXRlIGZvciB0aGlzIHJlbGVhc2UgaW4gVVRDIGZvcm1hdC4KCSAqIEBwcm9wZXJ0eSBidWlsZERhdGUKCSAqIEB0eXBlIFN0cmluZwoJICogQHN0YXRpYwoJICoqLwoJcy5idWlsZERhdGUgPSAvKmRhdGUqLyJUdWUsIDA0IE1hciAyMDE0IDIzOjQ0OjA4IEdNVCI7IC8vIGluamVjdGVkIGJ5IGJ1aWxkIHByb2Nlc3MKCn0pKCk7Ci8qCiogRXZlbnQKKiBWaXNpdCBodHRwOi8vY3JlYXRlanMuY29tLyBmb3IgZG9jdW1lbnRhdGlvbiwgdXBkYXRlcyBhbmQgZXhhbXBsZXMuCioKKiBDb3B5cmlnaHQgKGMpIDIwMTAgZ3NraW5uZXIuY29tLCBpbmMuCioKKiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbgoqIG9idGFpbmluZyBhIGNvcHkgb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uCiogZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8gZGVhbCBpbiB0aGUgU29mdHdhcmUgd2l0aG91dAoqIHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMgdG8gdXNlLAoqIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsCiogY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlCiogU29mdHdhcmUgaXMgZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcKKiBjb25kaXRpb25zOgoqCiogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUKKiBpbmNsdWRlZCBpbiBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KKgoqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELAoqIEVYUFJFU1MgT1IgSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUwoqIE9GIE1FUkNIQU5UQUJJTElUWSwgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5ECiogTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SUyBPUiBDT1BZUklHSFQKKiBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSIExJQUJJTElUWSwKKiBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcKKiBGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SCiogT1RIRVIgREVBTElOR1MgSU4gVEhFIFNPRlRXQVJFLgoqLwoKLyoqCiAqIEEgY29sbGVjdGlvbiBvZiBDbGFzc2VzIHRoYXQgYXJlIHNoYXJlZCBhY3Jvc3MgYWxsIHRoZSBDcmVhdGVKUyBsaWJyYXJpZXMuICBUaGUgY2xhc3NlcyBhcmUgaW5jbHVkZWQgaW4gdGhlIG1pbmlmaWVkCiAqIGZpbGVzIG9mIGVhY2ggbGlicmFyeSBhbmQgYXJlIGF2YWlsYWJsZSBvbiB0aGUgY3JlYXRlc2pzIG5hbWVzcGFjZSBkaXJlY3RseS4KICoKICogPGg0PkV4YW1wbGU8L2g0PgogKiAgICAgIG15T2JqZWN0LmFkZEV2ZW50TGlzdGVuZXIoImNoYW5nZSIsIGNyZWF0ZWpzLnByb3h5KG15TWV0aG9kLCBzY29wZSkpOwogKgogKiBAbW9kdWxlIENyZWF0ZUpTCiAqIEBtYWluIENyZWF0ZUpTCiAqLwoKLy8gbmFtZXNwYWNlOgp0aGlzLmNyZWF0ZWpzID0gdGhpcy5jcmVhdGVqc3x8e307CgooZnVuY3Rpb24oKSB7CgkidXNlIHN0cmljdCI7CgovKioKICogQ29udGFpbnMgcHJvcGVydGllcyBhbmQgbWV0aG9kcyBzaGFyZWQgYnkgYWxsIGV2ZW50cyBmb3IgdXNlIHdpdGgKICoge3sjY3Jvc3NMaW5rICJFdmVudERpc3BhdGNoZXIifX17ey9jcm9zc0xpbmt9fS4KICogCiAqIE5vdGUgdGhhdCBFdmVudCBvYmplY3RzIGFyZSBvZnRlbiByZXVzZWQsIHNvIHlvdSBzaG91bGQgbmV2ZXIKICogcmVseSBvbiBhbiBldmVudCBvYmplY3QncyBzdGF0ZSBvdXRzaWRlIG9mIHRoZSBjYWxsIHN0YWNrIGl0IHdhcyByZWNlaXZlZCBpbi4KICogQGNsYXNzIEV2ZW50CiAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlIFRoZSBldmVudCB0eXBlLgogKiBAcGFyYW0ge0Jvb2xlYW59IGJ1YmJsZXMgSW5kaWNhdGVzIHdoZXRoZXIgdGhlIGV2ZW50IHdpbGwgYnViYmxlIHRocm91Z2ggdGhlIGRpc3BsYXkgbGlzdC4KICogQHBhcmFtIHtCb29sZWFufSBjYW5jZWxhYmxlIEluZGljYXRlcyB3aGV0aGVyIHRoZSBkZWZhdWx0IGJlaGF2aW91ciBvZiB0aGlzIGV2ZW50IGNhbiBiZSBjYW5jZWxsZWQuCiAqIEBjb25zdHJ1Y3RvcgogKiovCnZhciBFdmVudCA9IGZ1bmN0aW9uKHR5cGUsIGJ1YmJsZXMsIGNhbmNlbGFibGUpIHsKICB0aGlzLmluaXRpYWxpemUodHlwZSwgYnViYmxlcywgY2FuY2VsYWJsZSk7Cn07CnZhciBwID0gRXZlbnQucHJvdG90eXBlOwoKLy8gZXZlbnRzOgoKLy8gcHVibGljIHByb3BlcnRpZXM6CgoJLyoqCgkgKiBUaGUgdHlwZSBvZiBldmVudC4KCSAqIEBwcm9wZXJ0eSB0eXBlCgkgKiBAdHlwZSBTdHJpbmcKCSAqKi8KCXAudHlwZSA9IG51bGw7CgoJLyoqCgkgKiBUaGUgb2JqZWN0IHRoYXQgZ2VuZXJhdGVkIGFuIGV2ZW50LgoJICogQHByb3BlcnR5IHRhcmdldAoJICogQHR5cGUgT2JqZWN0CgkgKiBAZGVmYXVsdCBudWxsCgkgKiBAcmVhZG9ubHkKCSovCglwLnRhcmdldCA9IG51bGw7CgoJLyoqCgkgKiBUaGUgY3VycmVudCB0YXJnZXQgdGhhdCBhIGJ1YmJsaW5nIGV2ZW50IGlzIGJlaW5nIGRpc3BhdGNoZWQgZnJvbS4gRm9yIG5vbi1idWJibGluZyBldmVudHMsIHRoaXMgd2lsbAoJICogYWx3YXlzIGJlIHRoZSBzYW1lIGFzIHRhcmdldC4gRm9yIGV4YW1wbGUsIGlmIGNoaWxkT2JqLnBhcmVudCA9IHBhcmVudE9iaiwgYW5kIGEgYnViYmxpbmcgZXZlbnQKCSAqIGlzIGdlbmVyYXRlZCBmcm9tIGNoaWxkT2JqLCB0aGVuIGEgbGlzdGVuZXIgb24gcGFyZW50T2JqIHdvdWxkIHJlY2VpdmUgdGhlIGV2ZW50IHdpdGgKCSAqIHRhcmdldD1jaGlsZE9iaiAodGhlIG9yaWdpbmFsIHRhcmdldCkgYW5kIGN1cnJlbnRUYXJnZXQ9cGFyZW50T2JqICh3aGVyZSB0aGUgbGlzdGVuZXIgd2FzIGFkZGVkKS4KCSAqIEBwcm9wZXJ0eSBjdXJyZW50VGFyZ2V0CgkgKiBAdHlwZSBPYmplY3QKCSAqIEBkZWZhdWx0IG51bGwKCSAqIEByZWFkb25seQoJKi8KCXAuY3VycmVudFRhcmdldCA9IG51bGw7CgoJLyoqCgkgKiBGb3IgYnViYmxpbmcgZXZlbnRzLCB0aGlzIGluZGljYXRlcyB0aGUgY3VycmVudCBldmVudCBwaGFzZTo8T0w+CgkgKiAJPExJPiBjYXB0dXJlIHBoYXNlOiBzdGFydGluZyBmcm9tIHRoZSB0b3AgcGFyZW50IHRvIHRoZSB0YXJnZXQ8L0xJPgoJICogCTxMST4gYXQgdGFyZ2V0IHBoYXNlOiBjdXJyZW50bHkgYmVpbmcgZGlzcGF0Y2hlZCBmcm9tIHRoZSB0YXJnZXQ8L0xJPgoJICogCTxMST4gYnViYmxpbmcgcGhhc2U6IGZyb20gdGhlIHRhcmdldCB0byB0aGUgdG9wIHBhcmVudDwvTEk+CgkgKiA8L09MPgoJICogQHByb3BlcnR5IGV2ZW50UGhhc2UKCSAqIEB0eXBlIE51bWJlcgoJICogQGRlZmF1bHQgMAoJICogQHJlYWRvbmx5CgkqLwoJcC5ldmVudFBoYXNlID0gMDsKCgkvKioKCSAqIEluZGljYXRlcyB3aGV0aGVyIHRoZSBldmVudCB3aWxsIGJ1YmJsZSB0aHJvdWdoIHRoZSBkaXNwbGF5IGxpc3QuCgkgKiBAcHJvcGVydHkgYnViYmxlcwoJICogQHR5cGUgQm9vbGVhbgoJICogQGRlZmF1bHQgZmFsc2UKCSAqIEByZWFkb25seQoJKi8KCXAuYnViYmxlcyA9IGZhbHNlOwoKCS8qKgoJICogSW5kaWNhdGVzIHdoZXRoZXIgdGhlIGRlZmF1bHQgYmVoYXZpb3VyIG9mIHRoaXMgZXZlbnQgY2FuIGJlIGNhbmNlbGxlZCB2aWEKCSAqIHt7I2Nyb3NzTGluayAiRXZlbnQvcHJldmVudERlZmF1bHQifX17ey9jcm9zc0xpbmt9fS4gVGhpcyBpcyBzZXQgdmlhIHRoZSBFdmVudCBjb25zdHJ1Y3Rvci4KCSAqIEBwcm9wZXJ0eSBjYW5jZWxhYmxlCgkgKiBAdHlwZSBCb29sZWFuCgkgKiBAZGVmYXVsdCBmYWxzZQoJICogQHJlYWRvbmx5CgkqLwoJcC5jYW5jZWxhYmxlID0gZmFsc2U7CgoJLyoqCgkgKiBUaGUgZXBvY2ggdGltZSBhdCB3aGljaCB0aGlzIGV2ZW50IHdhcyBjcmVhdGVkLgoJICogQHByb3BlcnR5IHRpbWVTdGFtcAoJICogQHR5cGUgTnVtYmVyCgkgKiBAZGVmYXVsdCAwCgkgKiBAcmVhZG9ubHkKCSovCglwLnRpbWVTdGFtcCA9IDA7CgoJLyoqCgkgKiBJbmRpY2F0ZXMgaWYge3sjY3Jvc3NMaW5rICJFdmVudC9wcmV2ZW50RGVmYXVsdCJ9fXt7L2Nyb3NzTGlua319IGhhcyBiZWVuIGNhbGxlZAoJICogb24gdGhpcyBldmVudC4KCSAqIEBwcm9wZXJ0eSBkZWZhdWx0UHJldmVudGVkCgkgKiBAdHlwZSBCb29sZWFuCgkgKiBAZGVmYXVsdCBmYWxzZQoJICogQHJlYWRvbmx5CgkqLwoJcC5kZWZhdWx0UHJldmVudGVkID0gZmFsc2U7CgoJLyoqCgkgKiBJbmRpY2F0ZXMgaWYge3sjY3Jvc3NMaW5rICJFdmVudC9zdG9wUHJvcGFnYXRpb24ifX17ey9jcm9zc0xpbmt9fSBvcgoJICoge3sjY3Jvc3NMaW5rICJFdmVudC9zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24ifX17ey9jcm9zc0xpbmt9fSBoYXMgYmVlbiBjYWxsZWQgb24gdGhpcyBldmVudC4KCSAqIEBwcm9wZXJ0eSBwcm9wYWdhdGlvblN0b3BwZWQKCSAqIEB0eXBlIEJvb2xlYW4KCSAqIEBkZWZhdWx0IGZhbHNlCgkgKiBAcmVhZG9ubHkKCSovCglwLnByb3BhZ2F0aW9uU3RvcHBlZCA9IGZhbHNlOwoKCS8qKgoJICogSW5kaWNhdGVzIGlmIHt7I2Nyb3NzTGluayAiRXZlbnQvc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uIn19e3svY3Jvc3NMaW5rfX0gaGFzIGJlZW4gY2FsbGVkCgkgKiBvbiB0aGlzIGV2ZW50LgoJICogQHByb3BlcnR5IGltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZAoJICogQHR5cGUgQm9vbGVhbgoJICogQGRlZmF1bHQgZmFsc2UKCSAqIEByZWFkb25seQoJKi8KCXAuaW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkID0gZmFsc2U7CgkKCS8qKgoJICogSW5kaWNhdGVzIGlmIHt7I2Nyb3NzTGluayAiRXZlbnQvcmVtb3ZlIn19e3svY3Jvc3NMaW5rfX0gaGFzIGJlZW4gY2FsbGVkIG9uIHRoaXMgZXZlbnQuCgkgKiBAcHJvcGVydHkgcmVtb3ZlZAoJICogQHR5cGUgQm9vbGVhbgoJICogQGRlZmF1bHQgZmFsc2UKCSAqIEByZWFkb25seQoJKi8KCXAucmVtb3ZlZCA9IGZhbHNlOwoKLy8gY29uc3RydWN0b3I6CgkvKioKCSAqIEluaXRpYWxpemF0aW9uIG1ldGhvZC4KCSAqIEBtZXRob2QgaW5pdGlhbGl6ZQoJICogQHBhcmFtIHtTdHJpbmd9IHR5cGUgVGhlIGV2ZW50IHR5cGUuCgkgKiBAcGFyYW0ge0Jvb2xlYW59IGJ1YmJsZXMgSW5kaWNhdGVzIHdoZXRoZXIgdGhlIGV2ZW50IHdpbGwgYnViYmxlIHRocm91Z2ggdGhlIGRpc3BsYXkgbGlzdC4KCSAqIEBwYXJhbSB7Qm9vbGVhbn0gY2FuY2VsYWJsZSBJbmRpY2F0ZXMgd2hldGhlciB0aGUgZGVmYXVsdCBiZWhhdmlvdXIgb2YgdGhpcyBldmVudCBjYW4gYmUgY2FuY2VsbGVkLgoJICogQHByb3RlY3RlZAoJICoqLwoJcC5pbml0aWFsaXplID0gZnVuY3Rpb24odHlwZSwgYnViYmxlcywgY2FuY2VsYWJsZSkgewoJCXRoaXMudHlwZSA9IHR5cGU7CgkJdGhpcy5idWJibGVzID0gYnViYmxlczsKCQl0aGlzLmNhbmNlbGFibGUgPSBjYW5jZWxhYmxlOwoJCXRoaXMudGltZVN0YW1wID0gKG5ldyBEYXRlKCkpLmdldFRpbWUoKTsKCX07CgovLyBwdWJsaWMgbWV0aG9kczoKCgkvKioKCSAqIFNldHMge3sjY3Jvc3NMaW5rICJFdmVudC9kZWZhdWx0UHJldmVudGVkIn19e3svY3Jvc3NMaW5rfX0gdG8gdHJ1ZS4KCSAqIE1pcnJvcnMgdGhlIERPTSBldmVudCBzdGFuZGFyZC4KCSAqIEBtZXRob2QgcHJldmVudERlZmF1bHQKCSAqKi8KCXAucHJldmVudERlZmF1bHQgPSBmdW5jdGlvbigpIHsKCQl0aGlzLmRlZmF1bHRQcmV2ZW50ZWQgPSB0cnVlOwoJfTsKCgkvKioKCSAqIFNldHMge3sjY3Jvc3NMaW5rICJFdmVudC9wcm9wYWdhdGlvblN0b3BwZWQifX17ey9jcm9zc0xpbmt9fSB0byB0cnVlLgoJICogTWlycm9ycyB0aGUgRE9NIGV2ZW50IHN0YW5kYXJkLgoJICogQG1ldGhvZCBzdG9wUHJvcGFnYXRpb24KCSAqKi8KCXAuc3RvcFByb3BhZ2F0aW9uID0gZnVuY3Rpb24oKSB7CgkJdGhpcy5wcm9wYWdhdGlvblN0b3BwZWQgPSB0cnVlOwoJfTsKCgkvKioKCSAqIFNldHMge3sjY3Jvc3NMaW5rICJFdmVudC9wcm9wYWdhdGlvblN0b3BwZWQifX17ey9jcm9zc0xpbmt9fSBhbmQKCSAqIHt7I2Nyb3NzTGluayAiRXZlbnQvaW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkIn19e3svY3Jvc3NMaW5rfX0gdG8gdHJ1ZS4KCSAqIE1pcnJvcnMgdGhlIERPTSBldmVudCBzdGFuZGFyZC4KCSAqIEBtZXRob2Qgc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uCgkgKiovCglwLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbiA9IGZ1bmN0aW9uKCkgewoJCXRoaXMuaW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkID0gdGhpcy5wcm9wYWdhdGlvblN0b3BwZWQgPSB0cnVlOwoJfTsKCQoJLyoqCgkgKiBDYXVzZXMgdGhlIGFjdGl2ZSBsaXN0ZW5lciB0byBiZSByZW1vdmVkIHZpYSByZW1vdmVFdmVudExpc3RlbmVyKCk7CgkgKiAKCSAqIAkJbXlCdG4uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBmdW5jdGlvbihldnQpIHsKCSAqIAkJCS8vIGRvIHN0dWZmLi4uCgkgKiAJCQlldnQucmVtb3ZlKCk7IC8vIHJlbW92ZXMgdGhpcyBsaXN0ZW5lci4KCSAqIAkJfSk7CgkgKiAKCSAqIEBtZXRob2QgcmVtb3ZlCgkgKiovCglwLnJlbW92ZSA9IGZ1bmN0aW9uKCkgewoJCXRoaXMucmVtb3ZlZCA9IHRydWU7Cgl9OwoJCgkvKioKCSAqIFJldHVybnMgYSBjbG9uZSBvZiB0aGUgRXZlbnQgaW5zdGFuY2UuCgkgKiBAbWV0aG9kIGNsb25lCgkgKiBAcmV0dXJuIHtFdmVudH0gYSBjbG9uZSBvZiB0aGUgRXZlbnQgaW5zdGFuY2UuCgkgKiovCglwLmNsb25lID0gZnVuY3Rpb24oKSB7CgkJcmV0dXJuIG5ldyBFdmVudCh0aGlzLnR5cGUsIHRoaXMuYnViYmxlcywgdGhpcy5jYW5jZWxhYmxlKTsKCX07CgoJLyoqCgkgKiBSZXR1cm5zIGEgc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIHRoaXMgb2JqZWN0LgoJICogQG1ldGhvZCB0b1N0cmluZwoJICogQHJldHVybiB7U3RyaW5nfSBhIHN0cmluZyByZXByZXNlbnRhdGlvbiBvZiB0aGUgaW5zdGFuY2UuCgkgKiovCglwLnRvU3RyaW5nID0gZnVuY3Rpb24oKSB7CgkJcmV0dXJuICJbRXZlbnQgKHR5cGU9Iit0aGlzLnR5cGUrIildIjsKCX07CgpjcmVhdGVqcy5FdmVudCA9IEV2ZW50Owp9KCkpOwovKg0KKiBFdmVudERpc3BhdGNoZXINCiogVmlzaXQgaHR0cDovL2NyZWF0ZWpzLmNvbS8gZm9yIGRvY3VtZW50YXRpb24sIHVwZGF0ZXMgYW5kIGV4YW1wbGVzLg0KKg0KKiBDb3B5cmlnaHQgKGMpIDIwMTAgZ3NraW5uZXIuY29tLCBpbmMuDQoqDQoqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uDQoqIG9idGFpbmluZyBhIGNvcHkgb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uDQoqIGZpbGVzICh0aGUgIlNvZnR3YXJlIiksIHRvIGRlYWwgaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQNCiogcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0cyB0byB1c2UsDQoqIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsDQoqIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZQ0KKiBTb2Z0d2FyZSBpcyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZw0KKiBjb25kaXRpb25zOg0KKg0KKiBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZQ0KKiBpbmNsdWRlZCBpbiBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4NCioNCiogVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsDQoqIEVYUFJFU1MgT1IgSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUw0KKiBPRiBNRVJDSEFOVEFCSUxJVFksIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORA0KKiBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBBVVRIT1JTIE9SIENPUFlSSUdIVA0KKiBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSIExJQUJJTElUWSwNCiogV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HDQoqIEZST00sIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1INCiogT1RIRVIgREVBTElOR1MgSU4gVEhFIFNPRlRXQVJFLg0KKi8NCg0KLyoqDQogKiBAbW9kdWxlIENyZWF0ZUpTDQogKi8NCg0KLy8gbmFtZXNwYWNlOg0KdGhpcy5jcmVhdGVqcyA9IHRoaXMuY3JlYXRlanN8fHt9Ow0KDQooZnVuY3Rpb24oKSB7DQoJInVzZSBzdHJpY3QiOw0KDQovKioNCiAqIEV2ZW50RGlzcGF0Y2hlciBwcm92aWRlcyBtZXRob2RzIGZvciBtYW5hZ2luZyBxdWV1ZXMgb2YgZXZlbnQgbGlzdGVuZXJzIGFuZCBkaXNwYXRjaGluZyBldmVudHMuDQogKg0KICogWW91IGNhbiBlaXRoZXIgZXh0ZW5kIEV2ZW50RGlzcGF0Y2hlciBvciBtaXggaXRzIG1ldGhvZHMgaW50byBhbiBleGlzdGluZyBwcm90b3R5cGUgb3IgaW5zdGFuY2UgYnkgdXNpbmcgdGhlDQogKiBFdmVudERpc3BhdGNoZXIge3sjY3Jvc3NMaW5rICJFdmVudERpc3BhdGNoZXIvaW5pdGlhbGl6ZSJ9fXt7L2Nyb3NzTGlua319IG1ldGhvZC4NCiAqIA0KICogVG9nZXRoZXIgd2l0aCB0aGUgQ3JlYXRlSlMgRXZlbnQgY2xhc3MsIEV2ZW50RGlzcGF0Y2hlciBwcm92aWRlcyBhbiBleHRlbmRlZCBldmVudCBtb2RlbCB0aGF0IGlzIGJhc2VkIG9uIHRoZQ0KICogRE9NIExldmVsIDIgZXZlbnQgbW9kZWwsIGluY2x1ZGluZyBhZGRFdmVudExpc3RlbmVyLCByZW1vdmVFdmVudExpc3RlbmVyLCBhbmQgZGlzcGF0Y2hFdmVudC4gSXQgc3VwcG9ydHMNCiAqIGJ1YmJsaW5nIC8gY2FwdHVyZSwgcHJldmVudERlZmF1bHQsIHN0b3BQcm9wYWdhdGlvbiwgc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uLCBhbmQgaGFuZGxlRXZlbnQuDQogKiANCiAqIEV2ZW50RGlzcGF0Y2hlciBhbHNvIGV4cG9zZXMgYSB7eyNjcm9zc0xpbmsgIkV2ZW50RGlzcGF0Y2hlci9vbiJ9fXt7L2Nyb3NzTGlua319IG1ldGhvZCwgd2hpY2ggbWFrZXMgaXQgZWFzaWVyDQogKiB0byBjcmVhdGUgc2NvcGVkIGxpc3RlbmVycywgbGlzdGVuZXJzIHRoYXQgb25seSBydW4gb25jZSwgYW5kIGxpc3RlbmVycyB3aXRoIGFzc29jaWF0ZWQgYXJiaXRyYXJ5IGRhdGEuIFRoZSANCiAqIHt7I2Nyb3NzTGluayAiRXZlbnREaXNwYXRjaGVyL29mZiJ9fXt7L2Nyb3NzTGlua319IG1ldGhvZCBpcyBtZXJlbHkgYW4gYWxpYXMgdG8NCiAqIHt7I2Nyb3NzTGluayAiRXZlbnREaXNwYXRjaGVyL3JlbW92ZUV2ZW50TGlzdGVuZXIifX17ey9jcm9zc0xpbmt9fS4NCiAqIA0KICogQW5vdGhlciBhZGRpdGlvbiB0byB0aGUgRE9NIExldmVsIDIgbW9kZWwgaXMgdGhlIHt7I2Nyb3NzTGluayAiRXZlbnREaXNwYXRjaGVyL3JlbW92ZUFsbEV2ZW50TGlzdGVuZXJzIn19e3svY3Jvc3NMaW5rfX0NCiAqIG1ldGhvZCwgd2hpY2ggY2FuIGJlIHVzZWQgdG8gbGlzdGVuZXJzIGZvciBhbGwgZXZlbnRzLCBvciBsaXN0ZW5lcnMgZm9yIGEgc3BlY2lmaWMgZXZlbnQuIFRoZSBFdmVudCBvYmplY3QgYWxzbyANCiAqIGluY2x1ZGVzIGEge3sjY3Jvc3NMaW5rICJFdmVudC9yZW1vdmUifX17ey9jcm9zc0xpbmt9fSBtZXRob2Qgd2hpY2ggcmVtb3ZlcyB0aGUgYWN0aXZlIGxpc3RlbmVyLg0KICoNCiAqIDxoND5FeGFtcGxlPC9oND4NCiAqIEFkZCBFdmVudERpc3BhdGNoZXIgY2FwYWJpbGl0aWVzIHRvIHRoZSAiTXlDbGFzcyIgY2xhc3MuDQogKg0KICogICAgICBFdmVudERpc3BhdGNoZXIuaW5pdGlhbGl6ZShNeUNsYXNzLnByb3RvdHlwZSk7DQogKg0KICogQWRkIGFuIGV2ZW50IChzZWUge3sjY3Jvc3NMaW5rICJFdmVudERpc3BhdGNoZXIvYWRkRXZlbnRMaXN0ZW5lciJ9fXt7L2Nyb3NzTGlua319KS4NCiAqDQogKiAgICAgIGluc3RhbmNlLmFkZEV2ZW50TGlzdGVuZXIoImV2ZW50TmFtZSIsIGhhbmRsZXJNZXRob2QpOw0KICogICAgICBmdW5jdGlvbiBoYW5kbGVyTWV0aG9kKGV2ZW50KSB7DQogKiAgICAgICAgICBjb25zb2xlLmxvZyhldmVudC50YXJnZXQgKyAiIFdhcyBDbGlja2VkIik7DQogKiAgICAgIH0NCiAqDQogKiA8Yj5NYWludGFpbmluZyBwcm9wZXIgc2NvcGU8L2I+PGJyIC8+DQogKiBTY29wZSAoaWUuICJ0aGlzIikgY2FuIGJlIGJlIGEgY2hhbGxlbmdlIHdpdGggZXZlbnRzLiBVc2luZyB0aGUge3sjY3Jvc3NMaW5rICJFdmVudERpc3BhdGNoZXIvb24ifX17ey9jcm9zc0xpbmt9fQ0KICogbWV0aG9kIHRvIHN1YnNjcmliZSB0byBldmVudHMgc2ltcGxpZmllcyB0aGlzLg0KICoNCiAqICAgICAgaW5zdGFuY2UuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBmdW5jdGlvbihldmVudCkgew0KICogICAgICAgICAgY29uc29sZS5sb2coaW5zdGFuY2UgPT0gdGhpcyk7IC8vIGZhbHNlLCBzY29wZSBpcyBhbWJpZ3VvdXMuDQogKiAgICAgIH0pOw0KICogICAgICANCiAqICAgICAgaW5zdGFuY2Uub24oImNsaWNrIiwgZnVuY3Rpb24oZXZlbnQpIHsNCiAqICAgICAgICAgIGNvbnNvbGUubG9nKGluc3RhbmNlID09IHRoaXMpOyAvLyB0cnVlLCAib24iIHVzZXMgZGlzcGF0Y2hlciBzY29wZSBieSBkZWZhdWx0Lg0KICogICAgICB9KTsNCiAqIA0KICogSWYgeW91IHdhbnQgdG8gdXNlIGFkZEV2ZW50TGlzdGVuZXIgaW5zdGVhZCwgeW91IG1heSB3YW50IHRvIHVzZSBmdW5jdGlvbi5iaW5kKCkgb3IgYSBzaW1pbGFyIHByb3h5IHRvIG1hbmFnZSBzY29wZS4NCiAqICAgICAgDQogKg0KICogQGNsYXNzIEV2ZW50RGlzcGF0Y2hlcg0KICogQGNvbnN0cnVjdG9yDQogKiovDQp2YXIgRXZlbnREaXNwYXRjaGVyID0gZnVuY3Rpb24oKSB7DQovKgl0aGlzLmluaXRpYWxpemUoKTsgKi8gLy8gbm90IG5lZWRlZC4NCn07DQp2YXIgcCA9IEV2ZW50RGlzcGF0Y2hlci5wcm90b3R5cGU7DQoNCg0KCS8qKg0KCSAqIFN0YXRpYyBpbml0aWFsaXplciB0byBtaXggRXZlbnREaXNwYXRjaGVyIG1ldGhvZHMgaW50byBhIHRhcmdldCBvYmplY3Qgb3IgcHJvdG90eXBlLg0KCSAqIA0KCSAqIAkJRXZlbnREaXNwYXRjaGVyLmluaXRpYWxpemUoTXlDbGFzcy5wcm90b3R5cGUpOyAvLyBhZGQgdG8gdGhlIHByb3RvdHlwZSBvZiB0aGUgY2xhc3MNCgkgKiAJCUV2ZW50RGlzcGF0Y2hlci5pbml0aWFsaXplKG15T2JqZWN0KTsgLy8gYWRkIHRvIGEgc3BlY2lmaWMgaW5zdGFuY2UNCgkgKiANCgkgKiBAbWV0aG9kIGluaXRpYWxpemUNCgkgKiBAc3RhdGljDQoJICogQHBhcmFtIHtPYmplY3R9IHRhcmdldCBUaGUgdGFyZ2V0IG9iamVjdCB0byBpbmplY3QgRXZlbnREaXNwYXRjaGVyIG1ldGhvZHMgaW50by4gVGhpcyBjYW4gYmUgYW4gaW5zdGFuY2Ugb3IgYQ0KCSAqIHByb3RvdHlwZS4NCgkgKiovDQoJRXZlbnREaXNwYXRjaGVyLmluaXRpYWxpemUgPSBmdW5jdGlvbih0YXJnZXQpIHsNCgkJdGFyZ2V0LmFkZEV2ZW50TGlzdGVuZXIgPSBwLmFkZEV2ZW50TGlzdGVuZXI7DQoJCXRhcmdldC5vbiA9IHAub247DQoJCXRhcmdldC5yZW1vdmVFdmVudExpc3RlbmVyID0gdGFyZ2V0Lm9mZiA9ICBwLnJlbW92ZUV2ZW50TGlzdGVuZXI7DQoJCXRhcmdldC5yZW1vdmVBbGxFdmVudExpc3RlbmVycyA9IHAucmVtb3ZlQWxsRXZlbnRMaXN0ZW5lcnM7DQoJCXRhcmdldC5oYXNFdmVudExpc3RlbmVyID0gcC5oYXNFdmVudExpc3RlbmVyOw0KCQl0YXJnZXQuZGlzcGF0Y2hFdmVudCA9IHAuZGlzcGF0Y2hFdmVudDsNCgkJdGFyZ2V0Ll9kaXNwYXRjaEV2ZW50ID0gcC5fZGlzcGF0Y2hFdmVudDsNCgkJdGFyZ2V0LndpbGxUcmlnZ2VyID0gcC53aWxsVHJpZ2dlcjsNCgl9Ow0KCQ0KLy8gY29uc3RydWN0b3I6DQoNCi8vIHByaXZhdGUgcHJvcGVydGllczoNCgkvKioNCgkgKiBAcHJvdGVjdGVkDQoJICogQHByb3BlcnR5IF9saXN0ZW5lcnMNCgkgKiBAdHlwZSBPYmplY3QNCgkgKiovDQoJcC5fbGlzdGVuZXJzID0gbnVsbDsNCg0KCS8qKg0KCSAqIEBwcm90ZWN0ZWQNCgkgKiBAcHJvcGVydHkgX2NhcHR1cmVMaXN0ZW5lcnMNCgkgKiBAdHlwZSBPYmplY3QNCgkgKiovDQoJcC5fY2FwdHVyZUxpc3RlbmVycyA9IG51bGw7DQoNCi8vIGNvbnN0cnVjdG9yOg0KCS8qKg0KCSAqIEluaXRpYWxpemF0aW9uIG1ldGhvZC4NCgkgKiBAbWV0aG9kIGluaXRpYWxpemUNCgkgKiBAcHJvdGVjdGVkDQoJICoqLw0KCXAuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uKCkge307DQoNCi8vIHB1YmxpYyBtZXRob2RzOg0KCS8qKg0KCSAqIEFkZHMgdGhlIHNwZWNpZmllZCBldmVudCBsaXN0ZW5lci4gTm90ZSB0aGF0IGFkZGluZyBtdWx0aXBsZSBsaXN0ZW5lcnMgdG8gdGhlIHNhbWUgZnVuY3Rpb24gd2lsbCByZXN1bHQgaW4NCgkgKiBtdWx0aXBsZSBjYWxsYmFja3MgZ2V0dGluZyBmaXJlZC4NCgkgKg0KCSAqIDxoND5FeGFtcGxlPC9oND4NCgkgKg0KCSAqICAgICAgZGlzcGxheU9iamVjdC5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGhhbmRsZUNsaWNrKTsNCgkgKiAgICAgIGZ1bmN0aW9uIGhhbmRsZUNsaWNrKGV2ZW50KSB7DQoJICogICAgICAgICAvLyBDbGljayBoYXBwZW5lZC4NCgkgKiAgICAgIH0NCgkgKg0KCSAqIEBtZXRob2QgYWRkRXZlbnRMaXN0ZW5lcg0KCSAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlIFRoZSBzdHJpbmcgdHlwZSBvZiB0aGUgZXZlbnQuDQoJICogQHBhcmFtIHtGdW5jdGlvbiB8IE9iamVjdH0gbGlzdGVuZXIgQW4gb2JqZWN0IHdpdGggYSBoYW5kbGVFdmVudCBtZXRob2QsIG9yIGEgZnVuY3Rpb24gdGhhdCB3aWxsIGJlIGNhbGxlZCB3aGVuDQoJICogdGhlIGV2ZW50IGlzIGRpc3BhdGNoZWQuDQoJICogQHBhcmFtIHtCb29sZWFufSBbdXNlQ2FwdHVyZV0gRm9yIGV2ZW50cyB0aGF0IGJ1YmJsZSwgaW5kaWNhdGVzIHdoZXRoZXIgdG8gbGlzdGVuIGZvciB0aGUgZXZlbnQgaW4gdGhlIGNhcHR1cmUgb3IgYnViYmxpbmcvdGFyZ2V0IHBoYXNlLg0KCSAqIEByZXR1cm4ge0Z1bmN0aW9uIHwgT2JqZWN0fSBSZXR1cm5zIHRoZSBsaXN0ZW5lciBmb3IgY2hhaW5pbmcgb3IgYXNzaWdubWVudC4NCgkgKiovDQoJcC5hZGRFdmVudExpc3RlbmVyID0gZnVuY3Rpb24odHlwZSwgbGlzdGVuZXIsIHVzZUNhcHR1cmUpIHsNCgkJdmFyIGxpc3RlbmVyczsNCgkJaWYgKHVzZUNhcHR1cmUpIHsNCgkJCWxpc3RlbmVycyA9IHRoaXMuX2NhcHR1cmVMaXN0ZW5lcnMgPSB0aGlzLl9jYXB0dXJlTGlzdGVuZXJzfHx7fTsNCgkJfSBlbHNlIHsNCgkJCWxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVyc3x8e307DQoJCX0NCgkJdmFyIGFyciA9IGxpc3RlbmVyc1t0eXBlXTsNCgkJaWYgKGFycikgeyB0aGlzLnJlbW92ZUV2ZW50TGlzdGVuZXIodHlwZSwgbGlzdGVuZXIsIHVzZUNhcHR1cmUpOyB9DQoJCWFyciA9IGxpc3RlbmVyc1t0eXBlXTsgLy8gcmVtb3ZlIG1heSBoYXZlIGRlbGV0ZWQgdGhlIGFycmF5DQoJCWlmICghYXJyKSB7IGxpc3RlbmVyc1t0eXBlXSA9IFtsaXN0ZW5lcl07ICB9DQoJCWVsc2UgeyBhcnIucHVzaChsaXN0ZW5lcik7IH0NCgkJcmV0dXJuIGxpc3RlbmVyOw0KCX07DQoJDQoJLyoqDQoJICogQSBzaG9ydGN1dCBtZXRob2QgZm9yIHVzaW5nIGFkZEV2ZW50TGlzdGVuZXIgdGhhdCBtYWtlcyBpdCBlYXNpZXIgdG8gc3BlY2lmeSBhbiBleGVjdXRpb24gc2NvcGUsIGhhdmUgYSBsaXN0ZW5lcg0KCSAqIG9ubHkgcnVuIG9uY2UsIGFzc29jaWF0ZSBhcmJpdHJhcnkgZGF0YSB3aXRoIHRoZSBsaXN0ZW5lciwgYW5kIHJlbW92ZSB0aGUgbGlzdGVuZXIuDQoJICogDQoJICogVGhpcyBtZXRob2Qgd29ya3MgYnkgY3JlYXRpbmcgYW4gYW5vbnltb3VzIHdyYXBwZXIgZnVuY3Rpb24gYW5kIHN1YnNjcmliaW5nIGl0IHdpdGggYWRkRXZlbnRMaXN0ZW5lci4NCgkgKiBUaGUgY3JlYXRlZCBhbm9ueW1vdXMgZnVuY3Rpb24gaXMgcmV0dXJuZWQgZm9yIHVzZSB3aXRoIC5yZW1vdmVFdmVudExpc3RlbmVyIChvciAub2ZmKS4NCgkgKiANCgkgKiA8aDQ+RXhhbXBsZTwvaDQ+DQoJICogDQoJICogCQl2YXIgbGlzdGVuZXIgPSBteUJ0bi5vbigiY2xpY2siLCBoYW5kbGVDbGljaywgbnVsbCwgZmFsc2UsIHtjb3VudDozfSk7DQoJICogCQlmdW5jdGlvbiBoYW5kbGVDbGljayhldnQsIGRhdGEpIHsNCgkgKiAJCQlkYXRhLmNvdW50IC09IDE7DQoJICogCQkJY29uc29sZS5sb2codGhpcyA9PSBteUJ0bik7IC8vIHRydWUgLSBzY29wZSBkZWZhdWx0cyB0byB0aGUgZGlzcGF0Y2hlcg0KCSAqIAkJCWlmIChkYXRhLmNvdW50ID09IDApIHsNCgkgKiAJCQkJYWxlcnQoImNsaWNrZWQgMyB0aW1lcyEiKTsNCgkgKiAJCQkJbXlCdG4ub2ZmKCJjbGljayIsIGxpc3RlbmVyKTsNCgkgKiAJCQkJLy8gYWx0ZXJuYXRlbHk6IGV2dC5yZW1vdmUoKTsNCgkgKiAJCQl9DQoJICogCQl9DQoJICogDQoJICogQG1ldGhvZCBvbg0KCSAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlIFRoZSBzdHJpbmcgdHlwZSBvZiB0aGUgZXZlbnQuDQoJICogQHBhcmFtIHtGdW5jdGlvbiB8IE9iamVjdH0gbGlzdGVuZXIgQW4gb2JqZWN0IHdpdGggYSBoYW5kbGVFdmVudCBtZXRob2QsIG9yIGEgZnVuY3Rpb24gdGhhdCB3aWxsIGJlIGNhbGxlZCB3aGVuDQoJICogdGhlIGV2ZW50IGlzIGRpc3BhdGNoZWQuDQoJICogQHBhcmFtIHtPYmplY3R9IFtzY29wZV0gVGhlIHNjb3BlIHRvIGV4ZWN1dGUgdGhlIGxpc3RlbmVyIGluLiBEZWZhdWx0cyB0byB0aGUgZGlzcGF0Y2hlci9jdXJyZW50VGFyZ2V0IGZvciBmdW5jdGlvbiBsaXN0ZW5lcnMsIGFuZCB0byB0aGUgbGlzdGVuZXIgaXRzZWxmIGZvciBvYmplY3QgbGlzdGVuZXJzIChpZS4gdXNpbmcgaGFuZGxlRXZlbnQpLg0KCSAqIEBwYXJhbSB7Qm9vbGVhbn0gW29uY2U9ZmFsc2VdIElmIHRydWUsIHRoZSBsaXN0ZW5lciB3aWxsIHJlbW92ZSBpdHNlbGYgYWZ0ZXIgdGhlIGZpcnN0IHRpbWUgaXQgaXMgdHJpZ2dlcmVkLg0KCSAqIEBwYXJhbSB7Kn0gW2RhdGFdIEFyYml0cmFyeSBkYXRhIHRoYXQgd2lsbCBiZSBpbmNsdWRlZCBhcyB0aGUgc2Vjb25kIHBhcmFtZXRlciB3aGVuIHRoZSBsaXN0ZW5lciBpcyBjYWxsZWQuDQoJICogQHBhcmFtIHtCb29sZWFufSBbdXNlQ2FwdHVyZT1mYWxzZV0gRm9yIGV2ZW50cyB0aGF0IGJ1YmJsZSwgaW5kaWNhdGVzIHdoZXRoZXIgdG8gbGlzdGVuIGZvciB0aGUgZXZlbnQgaW4gdGhlIGNhcHR1cmUgb3IgYnViYmxpbmcvdGFyZ2V0IHBoYXNlLg0KCSAqIEByZXR1cm4ge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBhbm9ueW1vdXMgZnVuY3Rpb24gdGhhdCB3YXMgY3JlYXRlZCBhbmQgYXNzaWduZWQgYXMgdGhlIGxpc3RlbmVyLiBUaGlzIGlzIG5lZWRlZCB0byByZW1vdmUgdGhlIGxpc3RlbmVyIGxhdGVyIHVzaW5nIC5yZW1vdmVFdmVudExpc3RlbmVyLg0KCSAqKi8NCglwLm9uID0gZnVuY3Rpb24odHlwZSwgbGlzdGVuZXIsIHNjb3BlLCBvbmNlLCBkYXRhLCB1c2VDYXB0dXJlKSB7DQoJCWlmIChsaXN0ZW5lci5oYW5kbGVFdmVudCkgew0KCQkJc2NvcGUgPSBzY29wZXx8bGlzdGVuZXI7DQoJCQlsaXN0ZW5lciA9IGxpc3RlbmVyLmhhbmRsZUV2ZW50Ow0KCQl9DQoJCXNjb3BlID0gc2NvcGV8fHRoaXM7DQoJCXJldHVybiB0aGlzLmFkZEV2ZW50TGlzdGVuZXIodHlwZSwgZnVuY3Rpb24oZXZ0KSB7DQoJCQkJbGlzdGVuZXIuY2FsbChzY29wZSwgZXZ0LCBkYXRhKTsNCgkJCQlvbmNlJiZldnQucmVtb3ZlKCk7DQoJCQl9LCB1c2VDYXB0dXJlKTsNCgl9Ow0KDQoJLyoqDQoJICogUmVtb3ZlcyB0aGUgc3BlY2lmaWVkIGV2ZW50IGxpc3RlbmVyLg0KCSAqDQoJICogPGI+SW1wb3J0YW50IE5vdGU6PC9iPiB0aGF0IHlvdSBtdXN0IHBhc3MgdGhlIGV4YWN0IGZ1bmN0aW9uIHJlZmVyZW5jZSB1c2VkIHdoZW4gdGhlIGV2ZW50IHdhcyBhZGRlZC4gSWYgYSBwcm94eQ0KCSAqIGZ1bmN0aW9uLCBvciBmdW5jdGlvbiBjbG9zdXJlIGlzIHVzZWQgYXMgdGhlIGNhbGxiYWNrLCB0aGUgcHJveHkvY2xvc3VyZSByZWZlcmVuY2UgbXVzdCBiZSB1c2VkIC0gYSBuZXcgcHJveHkgb3INCgkgKiBjbG9zdXJlIHdpbGwgbm90IHdvcmsuDQoJICoNCgkgKiA8aDQ+RXhhbXBsZTwvaDQ+DQoJICoNCgkgKiAgICAgIGRpc3BsYXlPYmplY3QucmVtb3ZlRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBoYW5kbGVDbGljayk7DQoJICoNCgkgKiBAbWV0aG9kIHJlbW92ZUV2ZW50TGlzdGVuZXINCgkgKiBAcGFyYW0ge1N0cmluZ30gdHlwZSBUaGUgc3RyaW5nIHR5cGUgb2YgdGhlIGV2ZW50Lg0KCSAqIEBwYXJhbSB7RnVuY3Rpb24gfCBPYmplY3R9IGxpc3RlbmVyIFRoZSBsaXN0ZW5lciBmdW5jdGlvbiBvciBvYmplY3QuDQoJICogQHBhcmFtIHtCb29sZWFufSBbdXNlQ2FwdHVyZV0gRm9yIGV2ZW50cyB0aGF0IGJ1YmJsZSwgaW5kaWNhdGVzIHdoZXRoZXIgdG8gbGlzdGVuIGZvciB0aGUgZXZlbnQgaW4gdGhlIGNhcHR1cmUgb3IgYnViYmxpbmcvdGFyZ2V0IHBoYXNlLg0KCSAqKi8NCglwLnJlbW92ZUV2ZW50TGlzdGVuZXIgPSBmdW5jdGlvbih0eXBlLCBsaXN0ZW5lciwgdXNlQ2FwdHVyZSkgew0KCQl2YXIgbGlzdGVuZXJzID0gdXNlQ2FwdHVyZSA/IHRoaXMuX2NhcHR1cmVMaXN0ZW5lcnMgOiB0aGlzLl9saXN0ZW5lcnM7DQoJCWlmICghbGlzdGVuZXJzKSB7IHJldHVybjsgfQ0KCQl2YXIgYXJyID0gbGlzdGVuZXJzW3R5cGVdOw0KCQlpZiAoIWFycikgeyByZXR1cm47IH0NCgkJZm9yICh2YXIgaT0wLGw9YXJyLmxlbmd0aDsgaTxsOyBpKyspIHsNCgkJCWlmIChhcnJbaV0gPT0gbGlzdGVuZXIpIHsNCgkJCQlpZiAobD09MSkgeyBkZWxldGUobGlzdGVuZXJzW3R5cGVdKTsgfSAvLyBhbGxvd3MgZm9yIGZhc3RlciBjaGVja3MuDQoJCQkJZWxzZSB7IGFyci5zcGxpY2UoaSwxKTsgfQ0KCQkJCWJyZWFrOw0KCQkJfQ0KCQl9DQoJfTsNCgkNCgkvKioNCgkgKiBBIHNob3J0Y3V0IHRvIHRoZSByZW1vdmVFdmVudExpc3RlbmVyIG1ldGhvZCwgd2l0aCB0aGUgc2FtZSBwYXJhbWV0ZXJzIGFuZCByZXR1cm4gdmFsdWUuIFRoaXMgaXMgYSBjb21wYW5pb24gdG8gdGhlDQoJICogLm9uIG1ldGhvZC4NCgkgKg0KCSAqIEBtZXRob2Qgb2ZmDQoJICogQHBhcmFtIHtTdHJpbmd9IHR5cGUgVGhlIHN0cmluZyB0eXBlIG9mIHRoZSBldmVudC4NCgkgKiBAcGFyYW0ge0Z1bmN0aW9uIHwgT2JqZWN0fSBsaXN0ZW5lciBUaGUgbGlzdGVuZXIgZnVuY3Rpb24gb3Igb2JqZWN0Lg0KCSAqIEBwYXJhbSB7Qm9vbGVhbn0gW3VzZUNhcHR1cmVdIEZvciBldmVudHMgdGhhdCBidWJibGUsIGluZGljYXRlcyB3aGV0aGVyIHRvIGxpc3RlbiBmb3IgdGhlIGV2ZW50IGluIHRoZSBjYXB0dXJlIG9yIGJ1YmJsaW5nL3RhcmdldCBwaGFzZS4NCgkgKiovDQoJcC5vZmYgPSBwLnJlbW92ZUV2ZW50TGlzdGVuZXI7DQoNCgkvKioNCgkgKiBSZW1vdmVzIGFsbCBsaXN0ZW5lcnMgZm9yIHRoZSBzcGVjaWZpZWQgdHlwZSwgb3IgYWxsIGxpc3RlbmVycyBvZiBhbGwgdHlwZXMuDQoJICoNCgkgKiA8aDQ+RXhhbXBsZTwvaDQ+DQoJICoNCgkgKiAgICAgIC8vIFJlbW92ZSBhbGwgbGlzdGVuZXJzDQoJICogICAgICBkaXNwbGF5T2JqZWN0LnJlbW92ZUFsbEV2ZW50TGlzdGVuZXJzKCk7DQoJICoNCgkgKiAgICAgIC8vIFJlbW92ZSBhbGwgY2xpY2sgbGlzdGVuZXJzDQoJICogICAgICBkaXNwbGF5T2JqZWN0LnJlbW92ZUFsbEV2ZW50TGlzdGVuZXJzKCJjbGljayIpOw0KCSAqDQoJICogQG1ldGhvZCByZW1vdmVBbGxFdmVudExpc3RlbmVycw0KCSAqIEBwYXJhbSB7U3RyaW5nfSBbdHlwZV0gVGhlIHN0cmluZyB0eXBlIG9mIHRoZSBldmVudC4gSWYgb21pdHRlZCwgYWxsIGxpc3RlbmVycyBmb3IgYWxsIHR5cGVzIHdpbGwgYmUgcmVtb3ZlZC4NCgkgKiovDQoJcC5yZW1vdmVBbGxFdmVudExpc3RlbmVycyA9IGZ1bmN0aW9uKHR5cGUpIHsNCgkJaWYgKCF0eXBlKSB7IHRoaXMuX2xpc3RlbmVycyA9IHRoaXMuX2NhcHR1cmVMaXN0ZW5lcnMgPSBudWxsOyB9DQoJCWVsc2Ugew0KCQkJaWYgKHRoaXMuX2xpc3RlbmVycykgeyBkZWxldGUodGhpcy5fbGlzdGVuZXJzW3R5cGVdKTsgfQ0KCQkJaWYgKHRoaXMuX2NhcHR1cmVMaXN0ZW5lcnMpIHsgZGVsZXRlKHRoaXMuX2NhcHR1cmVMaXN0ZW5lcnNbdHlwZV0pOyB9DQoJCX0NCgl9Ow0KDQoJLyoqDQoJICogRGlzcGF0Y2hlcyB0aGUgc3BlY2lmaWVkIGV2ZW50IHRvIGFsbCBsaXN0ZW5lcnMuDQoJICoNCgkgKiA8aDQ+RXhhbXBsZTwvaDQ+DQoJICoNCgkgKiAgICAgIC8vIFVzZSBhIHN0cmluZyBldmVudA0KCSAqICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KCJjb21wbGV0ZSIpOw0KCSAqDQoJICogICAgICAvLyBVc2UgYW4gRXZlbnQgaW5zdGFuY2UNCgkgKiAgICAgIHZhciBldmVudCA9IG5ldyBjcmVhdGVqcy5FdmVudCgicHJvZ3Jlc3MiKTsNCgkgKiAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChldmVudCk7DQoJICoNCgkgKiBAbWV0aG9kIGRpc3BhdGNoRXZlbnQNCgkgKiBAcGFyYW0ge09iamVjdCB8IFN0cmluZyB8IEV2ZW50fSBldmVudE9iaiBBbiBvYmplY3Qgd2l0aCBhICJ0eXBlIiBwcm9wZXJ0eSwgb3IgYSBzdHJpbmcgdHlwZS4NCgkgKiBXaGlsZSBhIGdlbmVyaWMgb2JqZWN0IHdpbGwgd29yaywgaXQgaXMgcmVjb21tZW5kZWQgdG8gdXNlIGEgQ3JlYXRlSlMgRXZlbnQgaW5zdGFuY2UuIElmIGEgc3RyaW5nIGlzIHVzZWQsDQoJICogZGlzcGF0Y2hFdmVudCB3aWxsIGNvbnN0cnVjdCBhbiBFdmVudCBpbnN0YW5jZSB3aXRoIHRoZSBzcGVjaWZpZWQgdHlwZS4NCgkgKiBAcGFyYW0ge09iamVjdH0gW3RhcmdldF0gVGhlIG9iamVjdCB0byB1c2UgYXMgdGhlIHRhcmdldCBwcm9wZXJ0eSBvZiB0aGUgZXZlbnQgb2JqZWN0LiBUaGlzIHdpbGwgZGVmYXVsdCB0byB0aGUNCgkgKiBkaXNwYXRjaGluZyBvYmplY3QuIDxiPlRoaXMgcGFyYW1ldGVyIGlzIGRlcHJlY2F0ZWQgYW5kIHdpbGwgYmUgcmVtb3ZlZC48L2I+DQoJICogQHJldHVybiB7Qm9vbGVhbn0gUmV0dXJucyB0aGUgdmFsdWUgb2YgZXZlbnRPYmouZGVmYXVsdFByZXZlbnRlZC4NCgkgKiovDQoJcC5kaXNwYXRjaEV2ZW50ID0gZnVuY3Rpb24oZXZlbnRPYmosIHRhcmdldCkgew0KCQlpZiAodHlwZW9mIGV2ZW50T2JqID09ICJzdHJpbmciKSB7DQoJCQkvLyB3b24ndCBidWJibGUsIHNvIHNraXAgZXZlcnl0aGluZyBpZiB0aGVyZSdzIG5vIGxpc3RlbmVyczoNCgkJCXZhciBsaXN0ZW5lcnMgPSB0aGlzLl9saXN0ZW5lcnM7DQoJCQlpZiAoIWxpc3RlbmVycyB8fCAhbGlzdGVuZXJzW2V2ZW50T2JqXSkgeyByZXR1cm4gZmFsc2U7IH0NCgkJCWV2ZW50T2JqID0gbmV3IGNyZWF0ZWpzLkV2ZW50KGV2ZW50T2JqKTsNCgkJfQ0KCQkvLyBUT0RPOiBkZXByZWNhdGVkLiBUYXJnZXQgcGFyYW0gaXMgZGVwcmVjYXRlZCwgb25seSB1c2UgY2FzZSBpcyBNb3VzZUV2ZW50L21vdXNlbW92ZSwgcmVtb3ZlLg0KCQlldmVudE9iai50YXJnZXQgPSB0YXJnZXR8fHRoaXM7DQoNCgkJaWYgKCFldmVudE9iai5idWJibGVzIHx8ICF0aGlzLnBhcmVudCkgew0KCQkJdGhpcy5fZGlzcGF0Y2hFdmVudChldmVudE9iaiwgMik7DQoJCX0gZWxzZSB7DQoJCQl2YXIgdG9wPXRoaXMsIGxpc3Q9W3RvcF07DQoJCQl3aGlsZSAodG9wLnBhcmVudCkgeyBsaXN0LnB1c2godG9wID0gdG9wLnBhcmVudCk7IH0NCgkJCXZhciBpLCBsPWxpc3QubGVuZ3RoOw0KDQoJCQkvLyBjYXB0dXJlICYgYXRUYXJnZXQNCgkJCWZvciAoaT1sLTE7IGk+PTAgJiYgIWV2ZW50T2JqLnByb3BhZ2F0aW9uU3RvcHBlZDsgaS0tKSB7DQoJCQkJbGlzdFtpXS5fZGlzcGF0Y2hFdmVudChldmVudE9iaiwgMSsoaT09MCkpOw0KCQkJfQ0KCQkJLy8gYnViYmxpbmcNCgkJCWZvciAoaT0xOyBpPGwgJiYgIWV2ZW50T2JqLnByb3BhZ2F0aW9uU3RvcHBlZDsgaSsrKSB7DQoJCQkJbGlzdFtpXS5fZGlzcGF0Y2hFdmVudChldmVudE9iaiwgMyk7DQoJCQl9DQoJCX0NCgkJcmV0dXJuIGV2ZW50T2JqLmRlZmF1bHRQcmV2ZW50ZWQ7DQoJfTsNCg0KCS8qKg0KCSAqIEluZGljYXRlcyB3aGV0aGVyIHRoZXJlIGlzIGF0IGxlYXN0IG9uZSBsaXN0ZW5lciBmb3IgdGhlIHNwZWNpZmllZCBldmVudCB0eXBlLg0KCSAqIEBtZXRob2QgaGFzRXZlbnRMaXN0ZW5lcg0KCSAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlIFRoZSBzdHJpbmcgdHlwZSBvZiB0aGUgZXZlbnQuDQoJICogQHJldHVybiB7Qm9vbGVhbn0gUmV0dXJucyB0cnVlIGlmIHRoZXJlIGlzIGF0IGxlYXN0IG9uZSBsaXN0ZW5lciBmb3IgdGhlIHNwZWNpZmllZCBldmVudC4NCgkgKiovDQoJcC5oYXNFdmVudExpc3RlbmVyID0gZnVuY3Rpb24odHlwZSkgew0KCQl2YXIgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzLCBjYXB0dXJlTGlzdGVuZXJzID0gdGhpcy5fY2FwdHVyZUxpc3RlbmVyczsNCgkJcmV0dXJuICEhKChsaXN0ZW5lcnMgJiYgbGlzdGVuZXJzW3R5cGVdKSB8fCAoY2FwdHVyZUxpc3RlbmVycyAmJiBjYXB0dXJlTGlzdGVuZXJzW3R5cGVdKSk7DQoJfTsNCgkNCgkvKioNCgkgKiBJbmRpY2F0ZXMgd2hldGhlciB0aGVyZSBpcyBhdCBsZWFzdCBvbmUgbGlzdGVuZXIgZm9yIHRoZSBzcGVjaWZpZWQgZXZlbnQgdHlwZSBvbiB0aGlzIG9iamVjdCBvciBhbnkgb2YgaXRzDQoJICogYW5jZXN0b3JzIChwYXJlbnQsIHBhcmVudCdzIHBhcmVudCwgZXRjKS4gQSByZXR1cm4gdmFsdWUgb2YgdHJ1ZSBpbmRpY2F0ZXMgdGhhdCBpZiBhIGJ1YmJsaW5nIGV2ZW50IG9mIHRoZQ0KCSAqIHNwZWNpZmllZCB0eXBlIGlzIGRpc3BhdGNoZWQgZnJvbSB0aGlzIG9iamVjdCwgaXQgd2lsbCB0cmlnZ2VyIGF0IGxlYXN0IG9uZSBsaXN0ZW5lci4NCgkgKiANCgkgKiBUaGlzIGlzIHNpbWlsYXIgdG8ge3sjY3Jvc3NMaW5rICJFdmVudERpc3BhdGNoZXIvaGFzRXZlbnRMaXN0ZW5lciJ9fXt7L2Nyb3NzTGlua319LCBidXQgaXQgc2VhcmNoZXMgdGhlIGVudGlyZQ0KCSAqIGV2ZW50IGZsb3cgZm9yIGEgbGlzdGVuZXIsIG5vdCBqdXN0IHRoaXMgb2JqZWN0Lg0KCSAqIEBtZXRob2Qgd2lsbFRyaWdnZXINCgkgKiBAcGFyYW0ge1N0cmluZ30gdHlwZSBUaGUgc3RyaW5nIHR5cGUgb2YgdGhlIGV2ZW50Lg0KCSAqIEByZXR1cm4ge0Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIHRoZXJlIGlzIGF0IGxlYXN0IG9uZSBsaXN0ZW5lciBmb3IgdGhlIHNwZWNpZmllZCBldmVudC4NCgkgKiovDQoJcC53aWxsVHJpZ2dlciA9IGZ1bmN0aW9uKHR5cGUpIHsNCgkJdmFyIG8gPSB0aGlzOw0KCQl3aGlsZSAobykgew0KCQkJaWYgKG8uaGFzRXZlbnRMaXN0ZW5lcih0eXBlKSkgeyByZXR1cm4gdHJ1ZTsgfQ0KCQkJbyA9IG8ucGFyZW50Ow0KCQl9DQoJCXJldHVybiBmYWxzZTsNCgl9Ow0KDQoJLyoqDQoJICogQG1ldGhvZCB0b1N0cmluZw0KCSAqIEByZXR1cm4ge1N0cmluZ30gYSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIGluc3RhbmNlLg0KCSAqKi8NCglwLnRvU3RyaW5nID0gZnVuY3Rpb24oKSB7DQoJCXJldHVybiAiW0V2ZW50RGlzcGF0Y2hlcl0iOw0KCX07DQoNCi8vIHByaXZhdGUgbWV0aG9kczoNCgkvKioNCgkgKiBAbWV0aG9kIF9kaXNwYXRjaEV2ZW50DQoJICogQHBhcmFtIHtPYmplY3QgfCBTdHJpbmcgfCBFdmVudH0gZXZlbnRPYmoNCgkgKiBAcGFyYW0ge09iamVjdH0gZXZlbnRQaGFzZQ0KCSAqIEBwcm90ZWN0ZWQNCgkgKiovDQoJcC5fZGlzcGF0Y2hFdmVudCA9IGZ1bmN0aW9uKGV2ZW50T2JqLCBldmVudFBoYXNlKSB7DQoJCXZhciBsLCBsaXN0ZW5lcnMgPSAoZXZlbnRQaGFzZT09MSkgPyB0aGlzLl9jYXB0dXJlTGlzdGVuZXJzIDogdGhpcy5fbGlzdGVuZXJzOw0KCQlpZiAoZXZlbnRPYmogJiYgbGlzdGVuZXJzKSB7DQoJCQl2YXIgYXJyID0gbGlzdGVuZXJzW2V2ZW50T2JqLnR5cGVdOw0KCQkJaWYgKCFhcnJ8fCEobD1hcnIubGVuZ3RoKSkgeyByZXR1cm47IH0NCgkJCWV2ZW50T2JqLmN1cnJlbnRUYXJnZXQgPSB0aGlzOw0KCQkJZXZlbnRPYmouZXZlbnRQaGFzZSA9IGV2ZW50UGhhc2U7DQoJCQlldmVudE9iai5yZW1vdmVkID0gZmFsc2U7DQoJCQlhcnIgPSBhcnIuc2xpY2UoKTsgLy8gdG8gYXZvaWQgaXNzdWVzIHdpdGggaXRlbXMgYmVpbmcgcmVtb3ZlZCBvciBhZGRlZCBkdXJpbmcgdGhlIGRpc3BhdGNoDQoJCQlmb3IgKHZhciBpPTA7IGk8bCAmJiAhZXZlbnRPYmouaW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkOyBpKyspIHsNCgkJCQl2YXIgbyA9IGFycltpXTsNCgkJCQlpZiAoby5oYW5kbGVFdmVudCkgeyBvLmhhbmRsZUV2ZW50KGV2ZW50T2JqKTsgfQ0KCQkJCWVsc2UgeyBvKGV2ZW50T2JqKTsgfQ0KCQkJCWlmIChldmVudE9iai5yZW1vdmVkKSB7DQoJCQkJCXRoaXMub2ZmKGV2ZW50T2JqLnR5cGUsIG8sIGV2ZW50UGhhc2U9PTEpOw0KCQkJCQlldmVudE9iai5yZW1vdmVkID0gZmFsc2U7DQoJCQkJfQ0KCQkJfQ0KCQl9DQoJfTsNCg0KDQpjcmVhdGVqcy5FdmVudERpc3BhdGNoZXIgPSBFdmVudERpc3BhdGNoZXI7DQp9KCkpOw0KLyoKKiBJbmRleE9mCiogVmlzaXQgaHR0cDovL2NyZWF0ZWpzLmNvbS8gZm9yIGRvY3VtZW50YXRpb24sIHVwZGF0ZXMgYW5kIGV4YW1wbGVzLgoqCiogQ29weXJpZ2h0IChjKSAyMDEwIGdza2lubmVyLmNvbSwgaW5jLgoqIAoqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uCiogb2J0YWluaW5nIGEgY29weSBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24KKiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0CiogcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0cyB0byB1c2UsCiogY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwKKiBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUKKiBTb2Z0d2FyZSBpcyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZwoqIGNvbmRpdGlvbnM6CiogCiogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUKKiBpbmNsdWRlZCBpbiBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KKiAKKiBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwKKiBFWFBSRVNTIE9SIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMKKiBPRiBNRVJDSEFOVEFCSUxJVFksIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORAoqIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUlMgT1IgQ09QWVJJR0hUCiogSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUiBMSUFCSUxJVFksCiogV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HCiogRlJPTSwgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUgoqIE9USEVSIERFQUxJTkdTIElOIFRIRSBTT0ZUV0FSRS4KKi8KCi8qKgogICogQG1vZHVsZSBDcmVhdGVKUwogKi8KCi8vIG5hbWVzcGFjZToKdGhpcy5jcmVhdGVqcyA9IHRoaXMuY3JlYXRlanN8fHt9OwoKLyoqCiAqIEBjbGFzcyBVdGlsaXR5IE1ldGhvZHMKICovCihmdW5jdGlvbigpIHsKCSJ1c2Ugc3RyaWN0IjsKCgkvKgoJICogRW1wbG95cyBEdWZmJ3MgRGV2aWNlIHRvIG1ha2UgYSBtb3JlIHBlcmZvcm1hbnQgaW1wbGVtZW50YXRpb24gb2YgaW5kZXhPZi4KCSAqIHNlZSBodHRwOi8vanNwZXJmLmNvbS9kdWZmcy1pbmRleG9mLzIKCSAqICNtZXRob2QgaW5kZXhPZgoJICogQHBhcmFtIHtBcnJheX0gYXJyYXkgQXJyYXkgdG8gc2VhcmNoIGZvciBzZWFyY2hFbGVtZW50CgkgKiBAcGFyYW0gc2VhcmNoRWxlbWVudCBFbGVtZW50IHRvIHNlYXJjaCBhcnJheSBmb3IuCgkgKiBAcmV0dXJuIHtOdW1iZXJ9IFRoZSBwb3NpdGlvbiBvZiB0aGUgZmlyc3Qgb2NjdXJyZW5jZSBvZiBhIHNwZWNpZmllZCB2YWx1ZSBzZWFyY2hFbGVtZW50IGluIHRoZSBwYXNzZWQgaW4gYXJyYXkgYXIuCgkgKiBAY29uc3RydWN0b3IKCSAqLwoJLyogcmVwbGFjZWQgd2l0aCBzaW1wbGUgZm9yIGxvb3AgZm9yIG5vdywgcGVyaGFwcyB3aWxsIGJlIHJlc2VhcmNoZWQgZnVydGhlcgoJY3JlYXRlanMuaW5kZXhPZiA9IGZ1bmN0aW9uIChhciwgc2VhcmNoRWxlbWVudCkgewoJCXZhciBsID0gYXIubGVuZ3RoOwoKCQl2YXIgbiA9IChsICogMC4xMjUpIF4gMDsJLy8gMC4xMjUgPT0gMS84LCB1c2luZyBtdWx0aXBsaWNhdGlvbiBiZWNhdXNlIGl0J3MgZmFzdGVyIGluIHNvbWUgYnJvd3NlcnMJLy8gXjAgZmxvb3JzIHJlc3VsdAoJCWZvciAodmFyIGkgPSAwOyBpIDwgbjsgaSsrKSB7CgkJCWlmKHNlYXJjaEVsZW1lbnQgPT09IGFyW2kqOF0pICAgeyByZXR1cm4gKGkqOCk7fQoJCQlpZihzZWFyY2hFbGVtZW50ID09PSBhcltpKjgrMV0pIHsgcmV0dXJuIChpKjgrMSk7fQoJCQlpZihzZWFyY2hFbGVtZW50ID09PSBhcltpKjgrMl0pIHsgcmV0dXJuIChpKjgrMik7fQoJCQlpZihzZWFyY2hFbGVtZW50ID09PSBhcltpKjgrM10pIHsgcmV0dXJuIChpKjgrMyk7fQoJCQlpZihzZWFyY2hFbGVtZW50ID09PSBhcltpKjgrNF0pIHsgcmV0dXJuIChpKjgrNCk7fQoJCQlpZihzZWFyY2hFbGVtZW50ID09PSBhcltpKjgrNV0pIHsgcmV0dXJuIChpKjgrNSk7fQoJCQlpZihzZWFyY2hFbGVtZW50ID09PSBhcltpKjgrNl0pIHsgcmV0dXJuIChpKjgrNik7fQoJCQlpZihzZWFyY2hFbGVtZW50ID09PSBhcltpKjgrN10pIHsgcmV0dXJuIChpKjgrNyk7fQoJCX0KCgkJdmFyIG4gPSBsICUgODsKCQlmb3IgKHZhciBpID0gMDsgaSA8IG47IGkrKykgewoJCQlpZiAoc2VhcmNoRWxlbWVudCA9PT0gYXJbbC1uK2ldKSB7CgkJCQlyZXR1cm4gbC1uK2k7CgkJCX0KCQl9CgoJCXJldHVybiAtMTsKCX0KCSovCgoJLyoqCgkgKiBGaW5kcyB0aGUgZmlyc3Qgb2NjdXJyZW5jZSBvZiBhIHNwZWNpZmllZCB2YWx1ZSBzZWFyY2hFbGVtZW50IGluIHRoZSBwYXNzZWQgaW4gYXJyYXksIGFuZCByZXR1cm5zIHRoZSBpbmRleCBvZgoJICogdGhhdCB2YWx1ZS4gIFJldHVybnMgLTEgaWYgdmFsdWUgaXMgbm90IGZvdW5kLgoJICoKCSAqICAgICAgdmFyIGkgPSBjcmVhdGVqcy5pbmRleE9mKG15QXJyYXksIG15RWxlbWVudFRvRmluZCk7CgkgKgoJICogQG1ldGhvZCBpbmRleE9mCgkgKiBAcGFyYW0ge0FycmF5fSBhcnJheSBBcnJheSB0byBzZWFyY2ggZm9yIHNlYXJjaEVsZW1lbnQKCSAqIEBwYXJhbSBzZWFyY2hFbGVtZW50IEVsZW1lbnQgdG8gZmluZCBpbiBhcnJheS4KCSAqIEByZXR1cm4ge051bWJlcn0gVGhlIGZpcnN0IGluZGV4IG9mIHNlYXJjaEVsZW1lbnQgaW4gYXJyYXkuCgkgKi8KCWNyZWF0ZWpzLmluZGV4T2YgPSBmdW5jdGlvbiAoYXJyYXksIHNlYXJjaEVsZW1lbnQpewoJCWZvciAodmFyIGkgPSAwLGw9YXJyYXkubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CgkJCWlmIChzZWFyY2hFbGVtZW50ID09PSBhcnJheVtpXSkgewoJCQkJcmV0dXJuIGk7CgkJCX0KCQl9CgkJcmV0dXJuIC0xOwoJfQoKfSgpKTsvKgoqIFByb3h5CiogVmlzaXQgaHR0cDovL2NyZWF0ZWpzLmNvbS8gZm9yIGRvY3VtZW50YXRpb24sIHVwZGF0ZXMgYW5kIGV4YW1wbGVzLgoqCiogQ29weXJpZ2h0IChjKSAyMDEwIGdza2lubmVyLmNvbSwgaW5jLgoqIAoqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uCiogb2J0YWluaW5nIGEgY29weSBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24KKiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0CiogcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0cyB0byB1c2UsCiogY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwKKiBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUKKiBTb2Z0d2FyZSBpcyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZwoqIGNvbmRpdGlvbnM6CiogCiogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUKKiBpbmNsdWRlZCBpbiBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KKiAKKiBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwKKiBFWFBSRVNTIE9SIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMKKiBPRiBNRVJDSEFOVEFCSUxJVFksIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORAoqIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUlMgT1IgQ09QWVJJR0hUCiogSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUiBMSUFCSUxJVFksCiogV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HCiogRlJPTSwgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUgoqIE9USEVSIERFQUxJTkdTIElOIFRIRSBTT0ZUV0FSRS4KKi8KCi8qKgogKiBAbW9kdWxlIENyZWF0ZUpTCiAqLwoKLy8gbmFtZXNwYWNlOgp0aGlzLmNyZWF0ZWpzID0gdGhpcy5jcmVhdGVqc3x8e307CgovKioKICogVmFyaW91cyB1dGlsaXRpZXMgdGhhdCB0aGUgQ3JlYXRlSlMgU3VpdGUgdXNlcy4gVXRpbGl0aWVzIGFyZSBjcmVhdGVkIGFzIHNlcGFyYXRlIGZpbGVzLCBhbmQgd2lsbCBiZSBhdmFpbGFibGUgb24gdGhlCiAqIGNyZWF0ZWpzIG5hbWVzcGFjZSBkaXJlY3RseToKICoKICogPGg0PkV4YW1wbGU8L2g0PgogKiAgICAgIG15T2JqZWN0LmFkZEV2ZW50TGlzdGVuZXIoImNoYW5nZSIsIGNyZWF0ZWpzLnByb3h5KG15TWV0aG9kLCBzY29wZSkpOwogKgogKiBAY2xhc3MgVXRpbGl0eSBNZXRob2RzCiAqIEBtYWluIFV0aWxpdHkgTWV0aG9kcwogKi8KCihmdW5jdGlvbigpIHsKCSJ1c2Ugc3RyaWN0IjsKCgkvKioKCSAqIEEgZnVuY3Rpb24gcHJveHkgZm9yIG1ldGhvZHMuIEJ5IGRlZmF1bHQsIEphdmFTY3JpcHQgbWV0aG9kcyBkbyBub3QgbWFpbnRhaW4gc2NvcGUsIHNvIHBhc3NpbmcgYSBtZXRob2QgYXMgYQoJICogY2FsbGJhY2sgd2lsbCByZXN1bHQgaW4gdGhlIG1ldGhvZCBnZXR0aW5nIGNhbGxlZCBpbiB0aGUgc2NvcGUgb2YgdGhlIGNhbGxlci4gVXNpbmcgYSBwcm94eSBlbnN1cmVzIHRoYXQgdGhlCgkgKiBtZXRob2QgZ2V0cyBjYWxsZWQgaW4gdGhlIGNvcnJlY3Qgc2NvcGUuCgkgKgoJICogQWRkaXRpb25hbCBhcmd1bWVudHMgY2FuIGJlIHBhc3NlZCB0aGF0IHdpbGwgYmUgYXBwbGllZCB0byB0aGUgZnVuY3Rpb24gd2hlbiBpdCBpcyBjYWxsZWQuCgkgKgoJICogPGg0PkV4YW1wbGU8L2g0PgoJICogICAgICBteU9iamVjdC5hZGRFdmVudExpc3RlbmVyKCJldmVudCIsIGNyZWF0ZWpzLnByb3h5KG15SGFuZGxlciwgdGhpcywgYXJnMSwgYXJnMikpOwoJICoKCSAqICAgICAgZnVuY3Rpb24gbXlIYW5kbGVyKGFyZzEsIGFyZzIpIHsKCSAqICAgICAgICAgICAvLyBUaGlzIGdldHMgY2FsbGVkIHdoZW4gbXlPYmplY3QubXlDYWxsYmFjayBpcyBleGVjdXRlZC4KCSAqICAgICAgfQoJICoKCSAqIEBtZXRob2QgcHJveHkKCSAqIEBwYXJhbSB7RnVuY3Rpb259IG1ldGhvZCBUaGUgZnVuY3Rpb24gdG8gY2FsbAoJICogQHBhcmFtIHtPYmplY3R9IHNjb3BlIFRoZSBzY29wZSB0byBjYWxsIHRoZSBtZXRob2QgbmFtZSBvbgoJICogQHBhcmFtIHttaXhlZH0gW2FyZ10gKiBBcmd1bWVudHMgdGhhdCBhcmUgYXBwZW5kZWQgdG8gdGhlIGNhbGxiYWNrIGZvciBhZGRpdGlvbmFsIHBhcmFtcy4KCSAqIEBwdWJsaWMKCSAqIEBzdGF0aWMKCSAqLwoJY3JlYXRlanMucHJveHkgPSBmdW5jdGlvbiAobWV0aG9kLCBzY29wZSkgewoJCXZhciBhQXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMik7CgkJcmV0dXJuIGZ1bmN0aW9uICgpIHsKCQkJcmV0dXJuIG1ldGhvZC5hcHBseShzY29wZSwgQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAwKS5jb25jYXQoYUFyZ3MpKTsKCQl9OwoJfQoKfSgpKTsvKgoqIEFic3RyYWN0TG9hZGVyCiogVmlzaXQgaHR0cDovL2NyZWF0ZWpzLmNvbS8gZm9yIGRvY3VtZW50YXRpb24sIHVwZGF0ZXMgYW5kIGV4YW1wbGVzLgoqCioKKiBDb3B5cmlnaHQgKGMpIDIwMTIgZ3NraW5uZXIuY29tLCBpbmMuCioKKiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbgoqIG9idGFpbmluZyBhIGNvcHkgb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uCiogZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8gZGVhbCBpbiB0aGUgU29mdHdhcmUgd2l0aG91dAoqIHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMgdG8gdXNlLAoqIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsCiogY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlCiogU29mdHdhcmUgaXMgZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcKKiBjb25kaXRpb25zOgoqCiogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUKKiBpbmNsdWRlZCBpbiBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KKgoqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELAoqIEVYUFJFU1MgT1IgSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUwoqIE9GIE1FUkNIQU5UQUJJTElUWSwgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5ECiogTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SUyBPUiBDT1BZUklHSFQKKiBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSIExJQUJJTElUWSwKKiBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcKKiBGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SCiogT1RIRVIgREVBTElOR1MgSU4gVEhFIFNPRlRXQVJFLgoqLwoKLyoqCiAqIEBtb2R1bGUgUHJlbG9hZEpTCiAqLwoKLy8gbmFtZXNwYWNlOgp0aGlzLmNyZWF0ZWpzID0gdGhpcy5jcmVhdGVqc3x8e307CgooZnVuY3Rpb24oKSB7CgkidXNlIHN0cmljdCI7CgkvKioKCSAqIFRoZSBiYXNlIGxvYWRlciwgd2hpY2ggZGVmaW5lcyBhbGwgdGhlIGdlbmVyaWMgY2FsbGJhY2tzIGFuZCBldmVudHMuIEFsbCBsb2FkZXJzIGV4dGVuZCB0aGlzIGNsYXNzLCBpbmNsdWRpbmcgdGhlCgkgKiB7eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZSJ9fXt7L2Nyb3NzTGlua319LgoJICogQGNsYXNzIEFic3RyYWN0TG9hZGVyCgkgKiBAZXh0ZW5kcyBFdmVudERpc3BhdGNoZXIKCSAqLwoJdmFyIEFic3RyYWN0TG9hZGVyID0gZnVuY3Rpb24gKCkgewoJCXRoaXMuaW5pdCgpOwoJfTsKCglBYnN0cmFjdExvYWRlci5wcm90b3R5cGUgPSBuZXcgY3JlYXRlanMuRXZlbnREaXNwYXRjaGVyKCk7IC8vVE9ETzogVEVTVCEKCXZhciBwID0gQWJzdHJhY3RMb2FkZXIucHJvdG90eXBlOwoJdmFyIHMgPSBBYnN0cmFjdExvYWRlcjsKCgkvKioKCSAqIFRoZSBSZWdFeHAgcGF0dGVybiB0byB1c2UgdG8gcGFyc2UgZmlsZSBVUklzLiBUaGlzIHN1cHBvcnRzIHNpbXBsZSBmaWxlIG5hbWVzLCBhcyB3ZWxsIGFzIGZ1bGwgZG9tYWluIFVSSXMgd2l0aAoJICogcXVlcnkgc3RyaW5ncy4gVGhlIHJlc3VsdGluZyBtYXRjaCBpczogcHJvdG9jb2w6JDEgZG9tYWluOiQyIHJlbGF0aXZlUGF0aDokMyBwYXRoOiQ0IGZpbGU6JDUgZXh0ZW5zaW9uOiQ2IHF1ZXJ5OiQ3LgoJICogQHByb3BlcnR5IEZJTEVfUEFUVEVSTgoJICogQHR5cGUge1JlZ0V4cH0KCSAqIEBzdGF0aWMKCSAqIEBwcm90ZWN0ZWQKCSAqLwoJcy5GSUxFX1BBVFRFUk4gPSAvXig/Oihcdys6KVwvezJ9KFx3Kyg/OlwuXHcrKSpcLz8pfCguezAsMn1cL3sxfSkpPyhbLy5dKj8oPzpbXj9dKyk/XC8pPygoPzpbXi8/XSspXC4oXHcrKSkoPzpcPyhcUyspPyk/JC87CgoJLyoqCgkgKiBUaGUgUmVnRXhwIHBhdHRlcm4gdG8gdXNlIHRvIHBhcnNlIHBhdGggVVJJcy4gVGhpcyBzdXBwb3J0cyBwcm90b2NvbHMsIHJlbGF0aXZlIGZpbGVzLCBhbmQgcGF0aHMuIFRoZSByZXN1bHRpbmcKCSAqIG1hdGNoIGlzOiBwcm90b2NvbDokMSByZWxhdGl2ZVBhdGg6JDIgcGF0aCQzLgoJICogQHByb3BlcnR5IFBBVEhfUEFUVEVSTgoJICogQHR5cGUge1JlZ0V4cH0KCSAqIEBzdGF0aWMKCSAqIEBwcm90ZWN0ZWQKCSAqLwoJcy5QQVRIX1BBVFRFUk4gPSAvXig/Oihcdys6KVwvezJ9KXwoLnswLDJ9XC97MX0pPyhbLy5dKj8oPzpbXj9dKyk/XC8/KT8kLzsKCgkvKioKCSAqIElmIHRoZSBsb2FkZXIgaGFzIGNvbXBsZXRlZCBsb2FkaW5nLiBUaGlzIHByb3ZpZGVzIGEgcXVpY2sgY2hlY2ssIGJ1dCBhbHNvIGVuc3VyZXMgdGhhdCB0aGUgZGlmZmVyZW50IGFwcHJvYWNoZXMKCSAqIHVzZWQgZm9yIGxvYWRpbmcgZG8gbm90IHBpbGUgdXAgcmVzdWx0aW5nIGluIG1vcmUgdGhhbiBvbmUgPGNvZGU+Y29tcGxldGU8L2NvZGU+IGV2ZW50LgoJICogQHByb3BlcnR5IGxvYWRlZAoJICogQHR5cGUge0Jvb2xlYW59CgkgKiBAZGVmYXVsdCBmYWxzZQoJICovCglwLmxvYWRlZCA9IGZhbHNlOwoKCS8qKgoJICogRGV0ZXJtaW5lIGlmIHRoZSBsb2FkZXIgd2FzIGNhbmNlbGVkLiBDYW5jZWxlZCBsb2FkcyB3aWxsIG5vdCBmaXJlIGNvbXBsZXRlIGV2ZW50cy4gTm90ZSB0aGF0CgkgKiB7eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZSJ9fXt7L2Nyb3NzTGlua319IHF1ZXVlcyBzaG91bGQgYmUgY2xvc2VkIHVzaW5nIHt7I2Nyb3NzTGluayAiQWJzdHJhY3RMb2FkZXIvY2xvc2UifX17ey9jcm9zc0xpbmt9fQoJICogaW5zdGVhZCBvZiBzZXR0aW5nIHRoaXMgcHJvcGVydHkuCgkgKiBAcHJvcGVydHkgY2FuY2VsZWQKCSAqIEB0eXBlIHtCb29sZWFufQoJICogQGRlZmF1bHQgZmFsc2UKCSAqLwoJcC5jYW5jZWxlZCA9IGZhbHNlOwoKCS8qKgoJICogVGhlIGN1cnJlbnQgbG9hZCBwcm9ncmVzcyAocGVyY2VudGFnZSkgZm9yIHRoaXMgaXRlbS4gVGhpcyB3aWxsIGJlIGEgbnVtYmVyIGJldHdlZW4gMCBhbmQgMS4KCSAqCgkgKiA8aDQ+RXhhbXBsZTwvaDQ+CgkgKgoJICogICAgIHZhciBxdWV1ZSA9IG5ldyBjcmVhdGVqcy5Mb2FkUXVldWUoKTsKCSAqICAgICBxdWV1ZS5sb2FkRmlsZSgibGFyZ2VJbWFnZS5wbmciKTsKCSAqICAgICBxdWV1ZS5vbigicHJvZ3Jlc3MiLCBmdW5jdGlvbigpIHsKCSAqICAgICAgICAgY29uc29sZS5sb2coIlByb2dyZXNzOiIsIHF1ZXVlLnByb2dyZXNzLCBldmVudC5wcm9ncmVzcyk7CgkgKiAgICAgfSk7CgkgKgoJICogQHByb3BlcnR5IHByb2dyZXNzCgkgKiBAdHlwZSB7TnVtYmVyfQoJICogQGRlZmF1bHQgMAoJICovCglwLnByb2dyZXNzID0gMDsKCgkvKioKCSAqIFRoZSBpdGVtIHRoaXMgbG9hZGVyIHJlcHJlc2VudHMuIE5vdGUgdGhhdCB0aGlzIGlzIG51bGwgaW4gYSB7eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZSJ9fXt7L2Nyb3NzTGlua319LCBidXQgd2lsbAoJICogYmUgYXZhaWxhYmxlIG9uIGxvYWRlcnMgc3VjaCBhcyB7eyNjcm9zc0xpbmsgIlhIUkxvYWRlciJ9fXt7L2Nyb3NzTGlua319IGFuZCB7eyNjcm9zc0xpbmsgIlRhZ0xvYWRlciJ9fXt7L2Nyb3NzTGlua319LgoJICogQHByb3BlcnR5IF9pdGVtCgkgKiBAdHlwZSB7T2JqZWN0fQoJICogQHByaXZhdGUKCSAqLwoJcC5faXRlbSA9IG51bGw7CgovLyBFdmVudHMKCS8qKgoJICogVGhlIGV2ZW50IHRoYXQgaXMgZmlyZWQgd2hlbiB0aGUgb3ZlcmFsbCBwcm9ncmVzcyBjaGFuZ2VzLgoJICogQGV2ZW50IHByb2dyZXNzCgkgKiBAcGFyYW0ge09iamVjdH0gdGFyZ2V0IFRoZSBvYmplY3QgdGhhdCBkaXNwYXRjaGVkIHRoZSBldmVudC4KCSAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlIFRoZSBldmVudCB0eXBlLgoJICogQHBhcmFtIHtOdW1iZXJ9IGxvYWRlZCBUaGUgYW1vdW50IHRoYXQgaGFzIGJlZW4gbG9hZGVkIHNvIGZhci4gTm90ZSB0aGF0IHRoaXMgaXMgbWF5IGp1c3QgYmUgYSBwZXJjZW50YWdlIG9mIDEsCgkgKiBzaW5jZSBmaWxlIHNpemVzIGNhbiBub3QgYmUgZGV0ZXJtaW5lZCBiZWZvcmUgYSBsb2FkIGlzIGtpY2tlZCBvZmYsIGlmIGF0IGFsbC4KCSAqIEBwYXJhbSB7TnVtYmVyfSB0b3RhbCBUaGUgdG90YWwgbnVtYmVyIG9mIGJ5dGVzLiBOb3RlIHRoYXQgdGhpcyBtYXkganVzdCBiZSAxLgoJICogQHBhcmFtIHtOdW1iZXJ9IHByb2dyZXNzIFRoZSByYXRpbyB0aGF0IGhhcyBiZWVuIGxvYWRlZCBiZXR3ZWVuIDAgYW5kIDEuCgkgKiBAc2luY2UgMC4zLjAKCSAqLwoKCS8qKgoJICogVGhlIGV2ZW50IHRoYXQgaXMgZmlyZWQgd2hlbiBhIGxvYWQgc3RhcnRzLgoJICogQGV2ZW50IGxvYWRzdGFydAoJICogQHBhcmFtIHtPYmplY3R9IHRhcmdldCBUaGUgb2JqZWN0IHRoYXQgZGlzcGF0Y2hlZCB0aGUgZXZlbnQuCgkgKiBAcGFyYW0ge1N0cmluZ30gdHlwZSBUaGUgZXZlbnQgdHlwZS4KCSAqIEBzaW5jZSAwLjMuMQoJICovCgoJLyoqCgkgKiBUaGUgZXZlbnQgdGhhdCBpcyBmaXJlZCB3aGVuIHRoZSBlbnRpcmUgcXVldWUgaGFzIGJlZW4gbG9hZGVkLgoJICogQGV2ZW50IGNvbXBsZXRlCgkgKiBAcGFyYW0ge09iamVjdH0gdGFyZ2V0IFRoZSBvYmplY3QgdGhhdCBkaXNwYXRjaGVkIHRoZSBldmVudC4KCSAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlIFRoZSBldmVudCB0eXBlLgoJICogQHNpbmNlIDAuMy4wCgkgKi8KCgkvKioKCSAqIFRoZSBldmVudCB0aGF0IGlzIGZpcmVkIHdoZW4gdGhlIGxvYWRlciBlbmNvdW50ZXJzIGFuIGVycm9yLiBJZiB0aGUgZXJyb3Igd2FzIGVuY291bnRlcmVkIGJ5IGEgZmlsZSwgdGhlIGV2ZW50IHdpbGwKCSAqIGNvbnRhaW4gdGhlIGl0ZW0gdGhhdCBjYXVzZWQgdGhlIGVycm9yLiBUaGVyZSBtYXkgYmUgYWRkaXRpb25hbCBwcm9wZXJ0aWVzIHN1Y2ggYXMgdGhlIGVycm9yIHJlYXNvbiBvbiBldmVudAoJICogb2JqZWN0cy4KCSAqIEBldmVudCBlcnJvcgoJICogQHBhcmFtIHtPYmplY3R9IHRhcmdldCBUaGUgb2JqZWN0IHRoYXQgZGlzcGF0Y2hlZCB0aGUgZXZlbnQuCgkgKiBAcGFyYW0ge1N0cmluZ30gdHlwZSBUaGUgZXZlbnQgdHlwZS4KCSAqIEBwYXJhbSB7T2JqZWN0fSBbaXRlbV0gVGhlIGl0ZW0gdGhhdCB3YXMgYmVpbmcgbG9hZGVkIHRoYXQgY2F1c2VkIHRoZSBlcnJvci4gVGhlIGl0ZW0gd2FzIHNwZWNpZmllZCBpbgoJICogdGhlIHt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlL2xvYWRGaWxlIn19e3svY3Jvc3NMaW5rfX0gb3Ige3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvbG9hZE1hbmlmZXN0In19e3svY3Jvc3NMaW5rfX0KCSAqIGNhbGwuIElmIG9ubHkgYSBzdHJpbmcgcGF0aCBvciB0YWcgd2FzIHNwZWNpZmllZCwgdGhlIG9iamVjdCB3aWxsIGNvbnRhaW4gdGhhdCB2YWx1ZSBhcyBhIGBzcmNgIHByb3BlcnR5LgoJICogQHBhcmFtIHtTdHJpbmd9IFtlcnJvcl0gVGhlIGVycm9yIG9iamVjdCBvciB0ZXh0LgoJICogQHNpbmNlIDAuMy4wCgkgKi8KCgkvL1RPRE86IERlcHJlY2F0ZWQKCS8qKgoJICogUkVNT1ZFRC4gVXNlIHt7I2Nyb3NzTGluayAiRXZlbnREaXNwYXRjaGVyL2FkZEV2ZW50TGlzdGVuZXIifX17ey9jcm9zc0xpbmt9fSBhbmQgdGhlIHt7I2Nyb3NzTGluayAiQWJzdHJhY3RMb2FkZXIvcHJvZ3Jlc3M6ZXZlbnQifX17ey9jcm9zc0xpbmt9fQoJICogZXZlbnQuCgkgKiBAcHJvcGVydHkgb25Qcm9ncmVzcwoJICogQHR5cGUge0Z1bmN0aW9ufQoJICogQGRlcHJlY2F0ZWQgVXNlIGFkZEV2ZW50TGlzdGVuZXIgYW5kIHRoZSAicHJvZ3Jlc3MiIGV2ZW50LgoJICovCgkvKioKCSAqIFJFTU9WRUQuIFVzZSB7eyNjcm9zc0xpbmsgIkV2ZW50RGlzcGF0Y2hlci9hZGRFdmVudExpc3RlbmVyIn19e3svY3Jvc3NMaW5rfX0gYW5kIHRoZSB7eyNjcm9zc0xpbmsgIkFic3RyYWN0TG9hZGVyL2xvYWRzdGFydDpldmVudCJ9fXt7L2Nyb3NzTGlua319CgkgKiBldmVudC4KCSAqIEBwcm9wZXJ0eSBvbkxvYWRTdGFydAoJICogQHR5cGUge0Z1bmN0aW9ufQoJICogQGRlcHJlY2F0ZWQgVXNlIGFkZEV2ZW50TGlzdGVuZXIgYW5kIHRoZSAibG9hZHN0YXJ0IiBldmVudC4KCSAqLwoJLyoqCgkgKiBSRU1PVkVELiBVc2Uge3sjY3Jvc3NMaW5rICJFdmVudERpc3BhdGNoZXIvYWRkRXZlbnRMaXN0ZW5lciJ9fXt7L2Nyb3NzTGlua319IGFuZCB0aGUge3sjY3Jvc3NMaW5rICJBYnN0cmFjdExvYWRlci9jb21wbGV0ZTpldmVudCJ9fXt7L2Nyb3NzTGlua319CgkgKiBldmVudC4KCSAqIEBwcm9wZXJ0eSBvbkNvbXBsZXRlCgkgKiBAdHlwZSB7RnVuY3Rpb259CgkgKiBAZGVwcmVjYXRlZCBVc2UgYWRkRXZlbnRMaXN0ZW5lciBhbmQgdGhlICJjb21wbGV0ZSIgZXZlbnQuCgkgKi8KCS8qKgoJICogUkVNT1ZFRC4gVXNlIHt7I2Nyb3NzTGluayAiRXZlbnREaXNwYXRjaGVyL2FkZEV2ZW50TGlzdGVuZXIifX17ey9jcm9zc0xpbmt9fSBhbmQgdGhlIHt7I2Nyb3NzTGluayAiQWJzdHJhY3RMb2FkZXIvZXJyb3I6ZXZlbnQifX17ey9jcm9zc0xpbmt9fQoJICogZXZlbnQuCgkgKiBAcHJvcGVydHkgb25FcnJvcgoJICogQHR5cGUge0Z1bmN0aW9ufQoJICogQGRlcHJlY2F0ZWQgVXNlIGFkZEV2ZW50TGlzdGVuZXIgYW5kIHRoZSAiZXJyb3IiIGV2ZW50LgoJICovCgoJLyoqCgkgKiBHZXQgYSByZWZlcmVuY2UgdG8gdGhlIG1hbmlmZXN0IGl0ZW0gdGhhdCBpcyBsb2FkZWQgYnkgdGhpcyBsb2FkZXIuIEluIG1vc3QgY2FzZXMgdGhpcyB3aWxsIGJlIHRoZSB2YWx1ZSB0aGF0IHdhcwoJICogcGFzc2VkIGludG8ge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUifX17ey9jcm9zc0xpbmt9fSB1c2luZyB7eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZS9sb2FkRmlsZSJ9fXt7L2Nyb3NzTGlua319IG9yCgkgKiB7eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZS9sb2FkTWFuaWZlc3QifX17ey9jcm9zc0xpbmt9fS4gSG93ZXZlciBpZiBvbmx5IGEgU3RyaW5nIHBhdGggd2FzIHBhc3NlZCBpbiwgdGhlbiBpdCB3aWxsCgkgKiBiZSBhbiBPYmplY3QgY3JlYXRlZCBieSB0aGUgTG9hZFF1ZXVlLgoJICogQHJldHVybiB7T2JqZWN0fSBUaGUgbWFuaWZlc3QgaXRlbSB0aGF0IHRoaXMgbG9hZGVyIGlzIHJlc3BvbnNpYmxlIGZvciBsb2FkaW5nLgoJICovCglwLmdldEl0ZW0gPSBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5faXRlbTsKCX07CgoJLyoqCgkgKiBJbml0aWFsaXplIHRoZSBsb2FkZXIuIFRoaXMgaXMgY2FsbGVkIGJ5IHRoZSBjb25zdHJ1Y3Rvci4KCSAqIEBtZXRob2QgaW5pdAoJICogQHByaXZhdGUKCSAqLwoJcC5pbml0ID0gZnVuY3Rpb24gKCkge307CgoJLyoqCgkgKiBCZWdpbiBsb2FkaW5nIHRoZSBxdWV1ZWQgaXRlbXMuIFRoaXMgbWV0aG9kIGNhbiBiZSBjYWxsZWQgd2hlbiBhIHt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlIn19e3svY3Jvc3NMaW5rfX0gaXMgc2V0CgkgKiB1cCBidXQgbm90IHN0YXJ0ZWQgaW1tZWRpYXRlbHkuCgkgKiBAZXhhbXBsZQoJICogICAgICB2YXIgcXVldWUgPSBuZXcgY3JlYXRlanMuTG9hZFF1ZXVlKCk7CgkgKiAgICAgIHF1ZXVlLmFkZEV2ZW50TGlzdGVuZXIoImNvbXBsZXRlIiwgaGFuZGxlQ29tcGxldGUpOwoJICogICAgICBxdWV1ZS5sb2FkTWFuaWZlc3QoZmlsZUFycmF5LCBmYWxzZSk7IC8vIE5vdGUgdGhlIDJuZCBhcmd1bWVudCB0aGF0IHRlbGxzIHRoZSBxdWV1ZSBub3QgdG8gc3RhcnQgbG9hZGluZyB5ZXQKCSAqICAgICAgcXVldWUubG9hZCgpOwoJICogQG1ldGhvZCBsb2FkCgkgKi8KCXAubG9hZCA9IGZ1bmN0aW9uKCkge307CgoJLyoqCgkgKiBDbG9zZSB0aGUgYWN0aXZlIHF1ZXVlLiBDbG9zaW5nIGEgcXVldWUgY29tcGxldGVseSBlbXB0aWVzIHRoZSBxdWV1ZSwgYW5kIHByZXZlbnRzIGFueSByZW1haW5pbmcgaXRlbXMgZnJvbQoJICogc3RhcnRpbmcgdG8gZG93bmxvYWQuIE5vdGUgdGhhdCBjdXJyZW50bHkgYW55IGFjdGl2ZSBsb2FkcyB3aWxsIHJlbWFpbiBvcGVuLCBhbmQgZXZlbnRzIG1heSBiZSBwcm9jZXNzZWQuCgkgKgoJICogVG8gc3RvcCBhbmQgcmVzdGFydCBhIHF1ZXVlLCB1c2UgdGhlIHt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlL3NldFBhdXNlZCJ9fXt7L2Nyb3NzTGlua319IG1ldGhvZCBpbnN0ZWFkLgoJICogQG1ldGhvZCBjbG9zZQoJICovCglwLmNsb3NlID0gZnVuY3Rpb24oKSB7fTsKCgovL0NhbGxiYWNrIHByb3hpZXMKCS8qKgoJICogRGlzcGF0Y2ggYSBsb2Fkc3RhcnQgZXZlbnQuIFBsZWFzZSBzZWUgdGhlIHt7I2Nyb3NzTGluayAiQWJzdHJhY3RMb2FkZXIvbG9hZHN0YXJ0OmV2ZW50In19e3svY3Jvc3NMaW5rfX0gZXZlbnQKCSAqIGZvciBkZXRhaWxzIG9uIHRoZSBldmVudCBwYXlsb2FkLgoJICogQG1ldGhvZCBfc2VuZExvYWRTdGFydAoJICogQHByb3RlY3RlZAoJICovCglwLl9zZW5kTG9hZFN0YXJ0ID0gZnVuY3Rpb24oKSB7CgkJaWYgKHRoaXMuX2lzQ2FuY2VsZWQoKSkgeyByZXR1cm47IH0KCQl0aGlzLmRpc3BhdGNoRXZlbnQoImxvYWRzdGFydCIpOwoJfTsKCgkvKioKCSAqIERpc3BhdGNoIGEgcHJvZ3Jlc3MgZXZlbnQuIFBsZWFzZSBzZWUgdGhlIHt7I2Nyb3NzTGluayAiQWJzdHJhY3RMb2FkZXIvcHJvZ3Jlc3M6ZXZlbnQifX17ey9jcm9zc0xpbmt9fSBldmVudCBmb3IKCSAqIGRldGFpbHMgb24gdGhlIGV2ZW50IHBheWxvYWQuCgkgKiBAbWV0aG9kIF9zZW5kUHJvZ3Jlc3MKCSAqIEBwYXJhbSB7TnVtYmVyIHwgT2JqZWN0fSB2YWx1ZSBUaGUgcHJvZ3Jlc3Mgb2YgdGhlIGxvYWRlZCBpdGVtLCBvciBhbiBvYmplY3QgY29udGFpbmluZyA8Y29kZT5sb2FkZWQ8L2NvZGU+CgkgKiBhbmQgPGNvZGU+dG90YWw8L2NvZGU+IHByb3BlcnRpZXMuCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXAuX3NlbmRQcm9ncmVzcyA9IGZ1bmN0aW9uKHZhbHVlKSB7CgkJaWYgKHRoaXMuX2lzQ2FuY2VsZWQoKSkgeyByZXR1cm47IH0KCQl2YXIgZXZlbnQgPSBudWxsOwoJCWlmICh0eXBlb2YodmFsdWUpID09ICJudW1iZXIiKSB7CgkJCXRoaXMucHJvZ3Jlc3MgPSB2YWx1ZTsKCQkJZXZlbnQgPSBuZXcgY3JlYXRlanMuRXZlbnQoInByb2dyZXNzIik7CgkJCWV2ZW50LmxvYWRlZCA9IHRoaXMucHJvZ3Jlc3M7CgkJCWV2ZW50LnRvdGFsID0gMTsKCQl9IGVsc2UgewoJCQlldmVudCA9IHZhbHVlOwoJCQl0aGlzLnByb2dyZXNzID0gdmFsdWUubG9hZGVkIC8gdmFsdWUudG90YWw7CgkJCWlmIChpc05hTih0aGlzLnByb2dyZXNzKSB8fCB0aGlzLnByb2dyZXNzID09IEluZmluaXR5KSB7IHRoaXMucHJvZ3Jlc3MgPSAwOyB9CgkJfQoJCWV2ZW50LnByb2dyZXNzID0gdGhpcy5wcm9ncmVzczsKCQl0aGlzLmhhc0V2ZW50TGlzdGVuZXIoInByb2dyZXNzIikgJiYgdGhpcy5kaXNwYXRjaEV2ZW50KGV2ZW50KTsKCX07CgoJLyoqCgkgKiBEaXNwYXRjaCBhIGNvbXBsZXRlIGV2ZW50LiBQbGVhc2Ugc2VlIHRoZSB7eyNjcm9zc0xpbmsgIkFic3RyYWN0TG9hZGVyL2NvbXBsZXRlOmV2ZW50In19e3svY3Jvc3NMaW5rfX0gZXZlbnQKCSAqIGZvciBkZXRhaWxzIG9uIHRoZSBldmVudCBwYXlsb2FkLgoJICogQG1ldGhvZCBfc2VuZENvbXBsZXRlCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXAuX3NlbmRDb21wbGV0ZSA9IGZ1bmN0aW9uKCkgewoJCWlmICh0aGlzLl9pc0NhbmNlbGVkKCkpIHsgcmV0dXJuOyB9CgkJdGhpcy5kaXNwYXRjaEV2ZW50KCJjb21wbGV0ZSIpOwoJfTsKCgkvKioKCSAqIERpc3BhdGNoIGFuIGVycm9yIGV2ZW50LiBQbGVhc2Ugc2VlIHRoZSB7eyNjcm9zc0xpbmsgIkFic3RyYWN0TG9hZGVyL2Vycm9yOmV2ZW50In19e3svY3Jvc3NMaW5rfX0gZXZlbnQgZm9yCgkgKiBkZXRhaWxzIG9uIHRoZSBldmVudCBwYXlsb2FkLgoJICogQG1ldGhvZCBfc2VuZEVycm9yCgkgKiBAcGFyYW0ge09iamVjdH0gZXZlbnQgVGhlIGV2ZW50IG9iamVjdCBjb250YWluaW5nIHNwZWNpZmljIGVycm9yIHByb3BlcnRpZXMuCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXAuX3NlbmRFcnJvciA9IGZ1bmN0aW9uKGV2ZW50KSB7CgkJaWYgKHRoaXMuX2lzQ2FuY2VsZWQoKSB8fCAhdGhpcy5oYXNFdmVudExpc3RlbmVyKCJlcnJvciIpKSB7IHJldHVybjsgfQoJCWlmIChldmVudCA9PSBudWxsKSB7CgkJCWV2ZW50ID0gbmV3IGNyZWF0ZWpzLkV2ZW50KCJlcnJvciIpOwoJCX0KCQl0aGlzLmRpc3BhdGNoRXZlbnQoZXZlbnQpOwoJfTsKCgkvKioKCSAqIERldGVybWluZSBpZiB0aGUgbG9hZCBoYXMgYmVlbiBjYW5jZWxlZC4gVGhpcyBpcyBpbXBvcnRhbnQgdG8gZW5zdXJlIHRoYXQgbWV0aG9kIGNhbGxzIG9yIGFzeW5jaHJvbm91cyBldmVudHMKCSAqIGRvIG5vdCBjYXVzZSBpc3N1ZXMgYWZ0ZXIgdGhlIHF1ZXVlIGhhcyBiZWVuIGNsZWFuZWQgdXAuCgkgKiBAbWV0aG9kIF9pc0NhbmNlbGVkCgkgKiBAcmV0dXJuIHtCb29sZWFufSBJZiB0aGUgbG9hZGVyIGhhcyBiZWVuIGNhbmNlbGVkLgoJICogQHByb3RlY3RlZAoJICovCglwLl9pc0NhbmNlbGVkID0gZnVuY3Rpb24oKSB7CgkJaWYgKHdpbmRvdy5jcmVhdGVqcyA9PSBudWxsIHx8IHRoaXMuY2FuY2VsZWQpIHsKCQkJcmV0dXJuIHRydWU7CgkJfQoJCXJldHVybiBmYWxzZTsKCX07CgoJLyoqCgkgKiBQYXJzZSBhIGZpbGUgVVJJIHVzaW5nIHRoZSB7eyNjcm9zc0xpbmsgIkFic3RyYWN0TG9hZGVyL0ZJTEVfUEFUVEVSTjpwcm9wZXJ0eSJ9fXt7L2Nyb3NzTGlua319IFJlZ0V4cCBwYXR0ZXJuLgoJICogQG1ldGhvZCBfcGFyc2VVUkkKCSAqIEBwYXJhbSB7U3RyaW5nfSBwYXRoIFRoZSBmaWxlIHBhdGggdG8gcGFyc2UuCgkgKiBAcmV0dXJuIHtBcnJheX0gVGhlIG1hdGNoZWQgZmlsZSBjb250ZW50cy4gUGxlYXNlIHNlZSB0aGUgRklMRV9QQVRURVJOIHByb3BlcnR5IGZvciBkZXRhaWxzIG9uIHRoZSByZXR1cm4gdmFsdWUuCgkgKiBUaGlzIHdpbGwgcmV0dXJuIG51bGwgaWYgaXQgZG9lcyBub3QgbWF0Y2guCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXAuX3BhcnNlVVJJID0gZnVuY3Rpb24ocGF0aCkgewoJCWlmICghcGF0aCkgeyByZXR1cm4gbnVsbDsgfQoJCXJldHVybiBwYXRoLm1hdGNoKHMuRklMRV9QQVRURVJOKTsKCX07CgoJLyoqCgkgKiBQYXJzZSBhIGZpbGUgVVJJIHVzaW5nIHRoZSB7eyNjcm9zc0xpbmsgIkFic3RyYWN0TG9hZGVyL1BBVEhfUEFUVEVSTiJ9fXt7L2Nyb3NzTGlua319IFJlZ0V4cCBwYXR0ZXJuLgoJICogQG1ldGhvZCBfcGFyc2VQYXRoCgkgKiBAcGFyYW0ge1N0cmluZ30gcGF0aCBUaGUgZmlsZSBwYXRoIHRvIHBhcnNlLgoJICogQHJldHVybiB7QXJyYXl9IFRoZSBtYXRjaGVkIHBhdGggY29udGVudHMuIFBsZWFzZSBzZWUgdGhlIFBBVEhfUEFUVEVSTiBwcm9wZXJ0eSBmb3IgZGV0YWlscyBvbiB0aGUgcmV0dXJuIHZhbHVlLgoJICogVGhpcyB3aWxsIHJldHVybiBudWxsIGlmIGl0IGRvZXMgbm90IG1hdGNoLgoJICogQHByb3RlY3RlZAoJICovCglwLl9wYXJzZVBhdGggPSBmdW5jdGlvbihwYXRoKSB7CgkJaWYgKCFwYXRoKSB7IHJldHVybiBudWxsOyB9CgkJcmV0dXJuIHBhdGgubWF0Y2gocy5QQVRIX1BBVFRFUk4pOwoJfTsKCgkvKioKCSAqIEZvcm1hdHMgYW4gb2JqZWN0IGludG8gYSBxdWVyeSBzdHJpbmcgZm9yIGVpdGhlciBhIFBPU1Qgb3IgR0VUIHJlcXVlc3QuCgkgKiBAbWV0aG9kIF9mb3JtYXRRdWVyeVN0cmluZwoJICogQHBhcmFtIHtPYmplY3R9IGRhdGEgVGhlIGRhdGEgdG8gY29udmVydCB0byBhIHF1ZXJ5IHN0cmluZy4KCSAqIEBwYXJhbSB7QXJyYXl9IFtxdWVyeV0gRXhpc3RpbmcgbmFtZS92YWx1ZSBwYWlycyB0byBhcHBlbmQgb24gdG8gdGhpcyBxdWVyeS4KCSAqIEBwcml2YXRlCgkgKi8KCXAuX2Zvcm1hdFF1ZXJ5U3RyaW5nID0gZnVuY3Rpb24oZGF0YSwgcXVlcnkpIHsKCQlpZiAoZGF0YSA9PSBudWxsKSB7CgkJCXRocm93IG5ldyBFcnJvcignWW91IG11c3Qgc3BlY2lmeSBkYXRhLicpOwoJCX0KCQl2YXIgcGFyYW1zID0gW107CgkJZm9yICh2YXIgbiBpbiBkYXRhKSB7CgkJCXBhcmFtcy5wdXNoKG4rJz0nK2VzY2FwZShkYXRhW25dKSk7CgkJfQoJCWlmIChxdWVyeSkgewoJCQlwYXJhbXMgPSBwYXJhbXMuY29uY2F0KHF1ZXJ5KTsKCQl9CgkJcmV0dXJuIHBhcmFtcy5qb2luKCcmJyk7Cgl9OwoKCS8qKgoJICogQSB1dGlsaXR5IG1ldGhvZCB0aGF0IGJ1aWxkcyBhIGZpbGUgcGF0aCB1c2luZyBhIHNvdXJjZSBhbmQgYSBkYXRhIG9iamVjdCwgYW5kIGZvcm1hdHMgaXQgaW50byBhIG5ldyBwYXRoLiBBbGwKCSAqIG9mIHRoZSBsb2FkZXJzIGluIFByZWxvYWRKUyB1c2UgdGhpcyBtZXRob2QgdG8gY29tcGlsZSBwYXRocyB3aGVuIGxvYWRpbmcuCgkgKiBAbWV0aG9kIGJ1aWxkUGF0aAoJICogQHBhcmFtIHtTdHJpbmd9IHNyYyBUaGUgc291cmNlIHBhdGggdG8gYWRkIHZhbHVlcyB0by4KCSAqIEBwYXJhbSB7T2JqZWN0fSBbZGF0YV0gT2JqZWN0IHVzZWQgdG8gYXBwZW5kIHZhbHVlcyB0byB0aGlzIHJlcXVlc3QgYXMgYSBxdWVyeSBzdHJpbmcuIEV4aXN0aW5nIHBhcmFtZXRlcnMgb24gdGhlCgkgKiBwYXRoIHdpbGwgYmUgcHJlc2VydmVkLgoJICogQHJldHVybnMge3N0cmluZ30gQSBmb3JtYXR0ZWQgc3RyaW5nIHRoYXQgY29udGFpbnMgdGhlIHBhdGggYW5kIHRoZSBzdXBwbGllZCBwYXJhbWV0ZXJzLgoJICogQHNpbmNlIDAuMy4xCgkgKi8KCXAuYnVpbGRQYXRoID0gZnVuY3Rpb24oc3JjLCBkYXRhKSB7CgkJaWYgKGRhdGEgPT0gbnVsbCkgewoJCQlyZXR1cm4gc3JjOwoJCX0KCgkJdmFyIHF1ZXJ5ID0gW107CgkJdmFyIGlkeCA9IHNyYy5pbmRleE9mKCc/Jyk7CgoJCWlmIChpZHggIT0gLTEpIHsKCQkJdmFyIHEgPSBzcmMuc2xpY2UoaWR4KzEpOwoJCQlxdWVyeSA9IHF1ZXJ5LmNvbmNhdChxLnNwbGl0KCcmJykpOwoJCX0KCgkJaWYgKGlkeCAhPSAtMSkgewoJCQlyZXR1cm4gc3JjLnNsaWNlKDAsIGlkeCkgKyAnPycgKyB0aGlzLl9mb3JtYXRRdWVyeVN0cmluZyhkYXRhLCBxdWVyeSk7CgkJfSBlbHNlIHsKCQkJcmV0dXJuIHNyYyArICc/JyArIHRoaXMuX2Zvcm1hdFF1ZXJ5U3RyaW5nKGRhdGEsIHF1ZXJ5KTsKCQl9Cgl9OwoKCS8qKgoJICogQG1ldGhvZCBfaXNDcm9zc0RvbWFpbgoJICogQHBhcmFtIHtPYmplY3R9IGl0ZW0gQSBsb2FkIGl0ZW0gd2l0aCBhIGBzcmNgIHByb3BlcnR5CgkgKiBAcmV0dXJuIHtCb29sZWFufSBJZiB0aGUgbG9hZCBpdGVtIGlzIGxvYWRpbmcgZnJvbSBhIGRpZmZlcmVudCBkb21haW4gdGhhbiB0aGUgY3VycmVudCBsb2NhdGlvbi4KCSAqIEBwcml2YXRlCgkgKi8KCXAuX2lzQ3Jvc3NEb21haW4gPSBmdW5jdGlvbihpdGVtKSB7CgkJdmFyIHRhcmdldCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImEiKTsKCQl0YXJnZXQuaHJlZiA9IGl0ZW0uc3JjOwoKCQl2YXIgaG9zdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImEiKTsKCQlob3N0LmhyZWYgPSBsb2NhdGlvbi5ocmVmOwoKCQl2YXIgY3Jvc3Nkb21haW4gPSAodGFyZ2V0Lmhvc3RuYW1lICE9ICIiKSAmJgoJCQkJKHRhcmdldC5wb3J0ICE9IGhvc3QucG9ydCB8fAoJCQkJCQl0YXJnZXQucHJvdG9jb2wgIT0gaG9zdC5wcm90b2NvbCB8fAoJCQkJCQl0YXJnZXQuaG9zdG5hbWUgIT0gaG9zdC5ob3N0bmFtZSk7CgkJcmV0dXJuIGNyb3NzZG9tYWluOwoJfQoKCS8qKgoJICogQG1ldGhvZCBfaXNMb2NhbAoJICogQHBhcmFtIHtPYmplY3R9IGl0ZW0gQSBsb2FkIGl0ZW0gd2l0aCBhIGBzcmNgIHByb3BlcnR5CgkgKiBAcmV0dXJuIHtCb29sZWFufSBJZiB0aGUgbG9hZCBpdGVtIGlzIGxvYWRpbmcgZnJvbSB0aGUgImZpbGU6IiBwcm90b2NvbC4gQXNzdW1lIHRoYXQgdGhlIGhvc3QgbXVzdCBiZSBsb2NhbCBhcwoJICogd2VsbC4KCSAqIEBwcml2YXRlCgkgKi8KCXAuX2lzTG9jYWwgPSBmdW5jdGlvbihpdGVtKSB7CgkJdmFyIHRhcmdldCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImEiKTsKCQl0YXJnZXQuaHJlZiA9IGl0ZW0uc3JjOwoJCXJldHVybiB0YXJnZXQuaG9zdG5hbWUgPT0gIiIgJiYgdGFyZ2V0LnByb3RvY29sID09ICJmaWxlOiI7Cgl9OwoKCS8qKgoJICogQG1ldGhvZCB0b1N0cmluZwoJICogQHJldHVybiB7U3RyaW5nfSBhIHN0cmluZyByZXByZXNlbnRhdGlvbiBvZiB0aGUgaW5zdGFuY2UuCgkgKi8KCXAudG9TdHJpbmcgPSBmdW5jdGlvbigpIHsKCQlyZXR1cm4gIltQcmVsb2FkSlMgQWJzdHJhY3RMb2FkZXJdIjsKCX07CgoJY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIgPSBBYnN0cmFjdExvYWRlcjsKCn0oKSk7Ci8qCiogTG9hZFF1ZXVlCiogVmlzaXQgaHR0cDovL2NyZWF0ZWpzLmNvbS8gZm9yIGRvY3VtZW50YXRpb24sIHVwZGF0ZXMgYW5kIGV4YW1wbGVzLgoqCioKKiBDb3B5cmlnaHQgKGMpIDIwMTIgZ3NraW5uZXIuY29tLCBpbmMuCioKKiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbgoqIG9idGFpbmluZyBhIGNvcHkgb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uCiogZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8gZGVhbCBpbiB0aGUgU29mdHdhcmUgd2l0aG91dAoqIHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMgdG8gdXNlLAoqIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsCiogY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlCiogU29mdHdhcmUgaXMgZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcKKiBjb25kaXRpb25zOgoqCiogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUKKiBpbmNsdWRlZCBpbiBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KKgoqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELAoqIEVYUFJFU1MgT1IgSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUwoqIE9GIE1FUkNIQU5UQUJJTElUWSwgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5ECiogTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SUyBPUiBDT1BZUklHSFQKKiBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSIExJQUJJTElUWSwKKiBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcKKiBGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SCiogT1RIRVIgREVBTElOR1MgSU4gVEhFIFNPRlRXQVJFLgoqLwovKioKICogUHJlbG9hZEpTIHByb3ZpZGVzIGEgY29uc2lzdGVudCB3YXkgdG8gcHJlbG9hZCBjb250ZW50IGZvciB1c2UgaW4gSFRNTCBhcHBsaWNhdGlvbnMuIFByZWxvYWRpbmcgY2FuIGJlIGRvbmUgdXNpbmcKICogSFRNTCB0YWdzLCBhcyB3ZWxsIGFzIFhIUi4KICoKICogQnkgZGVmYXVsdCwgUHJlbG9hZEpTIHdpbGwgdHJ5IGFuZCBsb2FkIGNvbnRlbnQgdXNpbmcgWEhSLCBzaW5jZSBpdCBwcm92aWRlcyBiZXR0ZXIgc3VwcG9ydCBmb3IgcHJvZ3Jlc3MgYW5kCiAqIGNvbXBsZXRpb24gZXZlbnRzLCA8Yj5ob3dldmVyIGR1ZSB0byBjcm9zcy1kb21haW4gaXNzdWVzLCBpdCBtYXkgc3RpbGwgYmUgcHJlZmVyYWJsZSB0byB1c2UgdGFnLWJhc2VkIGxvYWRpbmcKICogaW5zdGVhZDwvYj4uIE5vdGUgdGhhdCBzb21lIGNvbnRlbnQgcmVxdWlyZXMgWEhSIHRvIHdvcmsgKHBsYWluIHRleHQsIHdlYiBhdWRpbyksIGFuZCBzb21lIHJlcXVpcmVzIHRhZ3MgKEhUTUwgYXVkaW8pLgogKiBOb3RlIHRoaXMgaXMgaGFuZGxlZCBhdXRvbWF0aWNhbGx5IHdoZXJlIHBvc3NpYmxlLgogKgogKiBQcmVsb2FkSlMgY3VycmVudGx5IHN1cHBvcnRzIGFsbCBtb2Rlcm4gYnJvd3NlcnMsIGFuZCB3ZSBoYXZlIGRvbmUgb3VyIGJlc3QgdG8gaW5jbHVkZSBzdXBwb3J0IGZvciBtb3N0IG9sZGVyCiAqIGJyb3dzZXJzLiBJZiB5b3UgZmluZCBhbiBpc3N1ZSB3aXRoIGFueSBzcGVjaWZpYyBPUy9icm93c2VyIGNvbWJpbmF0aW9uLCBwbGVhc2UgdmlzaXQgaHR0cDovL2NvbW11bml0eS5jcmVhdGVqcy5jb20vCiAqIGFuZCByZXBvcnQgaXQuCiAqCiAqIDxoND5HZXR0aW5nIFN0YXJ0ZWQ8L2g0PgogKiBUbyBnZXQgc3RhcnRlZCwgY2hlY2sgb3V0IHRoZSB7eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZSJ9fXt7L2Nyb3NzTGlua319IGNsYXNzLCB3aGljaCBpbmNsdWRlcyBhIHF1aWNrIG92ZXJ2aWV3IG9mIGhvdwogKiB0byBsb2FkIGZpbGVzIGFuZCBwcm9jZXNzIHJlc3VsdHMuCiAqCiAqIDxoND5FeGFtcGxlPC9oND4KICoKICogICAgICB2YXIgcXVldWUgPSBuZXcgY3JlYXRlanMuTG9hZFF1ZXVlKCk7CiAqICAgICAgcXVldWUuaW5zdGFsbFBsdWdpbihjcmVhdGVqcy5Tb3VuZCk7CiAqICAgICAgcXVldWUub24oImNvbXBsZXRlIiwgaGFuZGxlQ29tcGxldGUsIHRoaXMpOwogKiAgICAgIHF1ZXVlLmxvYWRGaWxlKHtpZDoic291bmQiLCBzcmM6Imh0dHA6Ly9wYXRoL3RvL3NvdW5kLm1wMyJ9KTsKICogICAgICBxdWV1ZS5sb2FkTWFuaWZlc3QoWwogKiAgICAgICAgICB7aWQ6ICJteUltYWdlIiwgc3JjOiJwYXRoL3RvL215SW1hZ2UuanBnIn0KICogICAgICBdKTsKICogICAgICBmdW5jdGlvbiBoYW5kbGVDb21wbGV0ZSgpIHsKICogICAgICAgICAgY3JlYXRlanMuU291bmQucGxheSgic291bmQiKTsKICogICAgICAgICAgdmFyIGltYWdlID0gcXVldWUuZ2V0UmVzdWx0KCJteUltYWdlIik7CiAqICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoaW1hZ2UpOwogKiAgICAgIH0KICoKICogPGI+SW1wb3J0YW50IG5vdGUgb24gcGx1Z2luczo8L2I+IFBsdWdpbnMgbXVzdCBiZSBpbnN0YWxsZWQgPGk+YmVmb3JlPC9pPiBpdGVtcyBhcmUgYWRkZWQgdG8gdGhlIHF1ZXVlLCBvdGhlcndpc2UKICogdGhleSB3aWxsIG5vdCBiZSBwcm9jZXNzZWQsIGV2ZW4gaWYgdGhlIGxvYWQgaGFzIG5vdCBhY3R1YWxseSBraWNrZWQgb2ZmIHlldC4gUGx1Z2luIGZ1bmN0aW9uYWxpdHkgaXMgaGFuZGxlZCB3aGVuCiAqIHRoZSBpdGVtcyBhcmUgYWRkZWQgdG8gdGhlIExvYWRRdWV1ZS4KICoKICogPGg0PkJyb3dzZXIgU3VwcG9ydDwvaDQ+CiAqIFByZWxvYWRKUyBpcyBwYXJ0aWFsbHkgc3VwcG9ydGVkIGluIGFsbCBicm93c2VycywgYW5kIGZ1bGx5IHN1cHBvcnRlZCBpbiBhbGwgbW9kZXJuIGJyb3dzZXJzLiBLbm93biBleGNlcHRpb25zOgogKiA8dWw+PGxpPlhIUiBsb2FkaW5nIG9mIGFueSBjb250ZW50IHdpbGwgbm90IHdvcmsgaW4gbWFueSBvbGRlciBicm93c2VycyAoU2VlIGEgbWF0cml4IGhlcmU6IDxhIGhyZWY9Imh0dHA6Ly9jYW5pdXNlLmNvbS94aHIyIiB0YXJnZXQ9Il9ibGFuayI+aHR0cDovL2Nhbml1c2UuY29tL3hocjI8L2E+KS4KICogICAgICBJbiBtYW55IGNhc2VzLCB5b3UgY2FuIGZhbGwgYmFjayBvbiB0YWcgbG9hZGluZyAoaW1hZ2VzLCBhdWRpbywgQ1NTLCBzY3JpcHRzLCBTVkcsIGFuZCBKU09OUCkuIFRleHQgYW5kCiAqICAgICAgV2ViQXVkaW8gd2lsbCBvbmx5IHdvcmsgd2l0aCBYSFIuPC9saT4KICogICAgICA8bGk+U29tZSBmb3JtYXRzIGhhdmUgcG9vciBzdXBwb3J0IGZvciBjb21wbGV0ZSBldmVudHMgaW4gSUUgNiwgNywgYW5kIDggKFNWRywgdGFnIGxvYWRpbmcgb2Ygc2NyaXB0cywgWE1ML0pTT04pPC9saT4KICogICAgICA8bGk+T3BlcmEgaGFzIHBvb3Igc3VwcG9ydCBmb3IgU1ZHIGxvYWRpbmcgd2l0aCBYSFI8L2xpPgogKiAgICAgIDxsaT5DU1MgbG9hZGluZyBpbiBBbmRyb2lkIGFuZCBTYWZhcmkgd2lsbCBub3Qgd29yayB3aXRoIHRhZ3MgKGN1cnJlbnRseSwgYSB3b3JrYXJvdW5kIGlzIGluIHByb2dyZXNzKTwvbGk+CiAqICAgICAgPGxpPkxvY2FsIGxvYWRpbmcgaXMgbm90IHBlcm1pdHRlZCB3aXRoIFhIUiwgd2hpY2ggaXMgcmVxdWlyZWQgYnkgc29tZSBmaWxlIGZvcm1hdHMuIFdoZW4gdGVzdGluZyBsb2NhbCBjb250ZW50CiAqICAgICAgdXNlIGVpdGhlciBhIGxvY2FsIHNlcnZlciwgb3IgZW5hYmxlIHRhZyBsb2FkaW5nLCB3aGljaCBpcyBzdXBwb3J0ZWQgZm9yIG1vc3QgZm9ybWF0cy4gU2VlIHt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlL3NldFVzZVhIUiJ9fXt7L2Nyb3NzTGlua319CiAqICAgICAgZm9yIG1vcmUgaW5mb3JtYXRpb24uPC9saT4KICogPC91bD4KICoKICogPGg0PkNyb3NzLWRvbWFpbiBMb2FkaW5nPC9oND4KICogTW9zdCBjb250ZW50IHR5cGVzIGNhbiBiZSBsb2FkZWQgY3Jvc3MtZG9tYWluLCBhcyBsb25nIGFzIHRoZSBzZXJ2ZXIgc3VwcG9ydHMgQ09SUy4gUHJlbG9hZEpTIGFsc28gaGFzIGludGVybmFsCiAqIHN1cHBvcnQgZm9yIGltYWdlcyBzZXJ2ZWQgZnJvbSBhIENPUlMtZW5hYmxlZCBzZXJ2ZXIsIHZpYSB0aGUgYGNyb3NzT3JpZ2luYCBhcmd1bWVudCBvbiB0aGUge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUifX17ey9jcm9zc0xpbmt9fQogKiBjb25zdHJ1Y3Rvci4gSWYgc2V0IHRvIGEgc3RyaW5nIHZhbHVlIChzdWNoIGFzICJBbm9ueW1vdXMiKSwgdGhlICJjcm9zc09yaWdpbiIgcHJvcGVydHkgb2YgaW1hZ2VzIGdlbmVyYXRlZCBieQogKiBQcmVsb2FkSlMgaXMgc2V0IHRvIHRoYXQgdmFsdWUuIFBsZWFzZSBub3RlIHRoYXQgc2V0dGluZyBhIGBjcm9zc09yaWdpbmAgdmFsdWUgb24gYW4gaW1hZ2UgdGhhdCBpcyBzZXJ2ZWQgZnJvbSBhCiAqIHNlcnZlciB3aXRob3V0IENPUlMgd2lsbCBjYXVzZSBvdGhlciBlcnJvcnMuIEZvciBtb3JlIGluZm8gb24gQ09SUywgdmlzaXQgaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvQ3Jvc3Mtb3JpZ2luX3Jlc291cmNlX3NoYXJpbmcuCiAqCiAqIEBtb2R1bGUgUHJlbG9hZEpTCiAqIEBtYWluIFByZWxvYWRKUwogKi8KCi8vIG5hbWVzcGFjZToKdGhpcy5jcmVhdGVqcyA9IHRoaXMuY3JlYXRlanN8fHt9OwoKLyoKVE9ETzogV0lORE9XUyBJU1NVRVMKCSogTm8gZXJyb3IgZm9yIEhUTUwgYXVkaW8gaW4gSUUgNjc4CgkqIFNWRyBubyBmYWlsdXJlIGVycm9yIGluIElFIDY3IChtYXliZSA4KSBUQUdTIEFORCBYSFIKCSogTm8gc2NyaXB0IGNvbXBsZXRlIGhhbmRsZXIgaW4gSUUgNjcgVEFHUyAoWEhSIGlzIGZpbmUpCgkqIE5vIFhNTC9KU09OIGluIElFNiBUQUdTCgkqIE5lZWQgdG8gaGlkZSBsb2FkaW5nIFNWRyBpbiBPcGVyYSBUQUdTCgkqIE5vIENTUyBvbmxvYWQvcmVhZHlzdGF0ZWNoYW5nZSBpbiBTYWZhcmkgb3IgQW5kcm9pZCBUQUdTIChyZXF1aXJlcyBydWxlIGNoZWNraW5nKQoJKiBTVkcgbm8gbG9hZCBvciBmYWlsdXJlIGluIE9wZXJhIFhIUgoJKiBSZXBvcnRlZCBpc3N1ZXMgd2l0aCBJRTcvOAogKi8KCihmdW5jdGlvbigpIHsKCSJ1c2Ugc3RyaWN0IjsKCgkvKioKCSAqIFRoZSBMb2FkUXVldWUgY2xhc3MgaXMgdGhlIG1haW4gQVBJIGZvciBwcmVsb2FkaW5nIGNvbnRlbnQuIExvYWRRdWV1ZSBpcyBhIGxvYWQgbWFuYWdlciwgd2hpY2ggY2FuIHByZWxvYWQgZWl0aGVyCgkgKiBhIHNpbmdsZSBmaWxlLCBvciBxdWV1ZSBvZiBmaWxlcy4KCSAqCgkgKiA8Yj5DcmVhdGluZyBhIFF1ZXVlPC9iPjxiciAvPgoJICogVG8gdXNlIExvYWRRdWV1ZSwgY3JlYXRlIGEgTG9hZFF1ZXVlIGluc3RhbmNlLiBJZiB5b3Ugd2FudCB0byBmb3JjZSB0YWcgbG9hZGluZyB3aGVyZSBwb3NzaWJsZSwgc2V0IHRoZSB1c2VYSFIKCSAqIGFyZ3VtZW50IHRvIGZhbHNlLgoJICoKCSAqICAgICAgdmFyIHF1ZXVlID0gbmV3IGNyZWF0ZWpzLkxvYWRRdWV1ZSh0cnVlKTsKCSAqCgkgKiA8Yj5MaXN0ZW5pbmcgZm9yIEV2ZW50czwvYj48YnIgLz4KCSAqIEFkZCBhbnkgbGlzdGVuZXJzIHlvdSB3YW50IHRvIHRoZSBxdWV1ZS4gU2luY2UgUHJlbG9hZEpTIDAuMy4wLCB0aGUge3sjY3Jvc3NMaW5rICJFdmVudERpc3BhdGNoZXIifX17ey9jcm9zc0xpbmt9fQoJICogbGV0cyB5b3UgYWRkIGFzIG1hbnkgbGlzdGVuZXJzIGFzIHlvdSB3YW50IGZvciBldmVudHMuIFlvdSBjYW4gc3Vic2NyaWJlIHRvIHRoZSBmb2xsb3dpbmcgZXZlbnRzOjx1bD4KCSAqICAgICA8bGk+e3sjY3Jvc3NMaW5rICJBYnN0cmFjdExvYWRlci9jb21wbGV0ZTpldmVudCJ9fXt7L2Nyb3NzTGlua319OiBmaXJlZCB3aGVuIGEgcXVldWUgY29tcGxldGVzIGxvYWRpbmcgYWxsCgkgKiAgICAgZmlsZXM8L2xpPgoJICogICAgIDxsaT57eyNjcm9zc0xpbmsgIkFic3RyYWN0TG9hZGVyL2Vycm9yOmV2ZW50In19e3svY3Jvc3NMaW5rfX06IGZpcmVkIHdoZW4gdGhlIHF1ZXVlIGVuY291bnRlcnMgYW4gZXJyb3Igd2l0aAoJICogICAgIGFueSBmaWxlLjwvbGk+CgkgKiAgICAgPGxpPnt7I2Nyb3NzTGluayAiQWJzdHJhY3RMb2FkZXIvcHJvZ3Jlc3M6ZXZlbnQifX17ey9jcm9zc0xpbmt9fTogUHJvZ3Jlc3MgZm9yIHRoZSBlbnRpcmUgcXVldWUgaGFzCgkgKiAgICAgY2hhbmdlZC48L2xpPgoJICogICAgIDxsaT57eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZS9maWxlbG9hZDpldmVudCJ9fXt7L2Nyb3NzTGlua319OiBBIHNpbmdsZSBmaWxlIGhhcyBjb21wbGV0ZWQgbG9hZGluZy48L2xpPgoJICogICAgIDxsaT57eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZS9maWxlcHJvZ3Jlc3M6ZXZlbnQifX17ey9jcm9zc0xpbmt9fTogUHJvZ3Jlc3MgZm9yIGEgc2luZ2xlIGZpbGUgaGFzIGNoYW5nZXMuIE5vdGUKCSAqICAgICB0aGF0IG9ubHkgZmlsZXMgbG9hZGVkIHdpdGggWEhSIChvciBwb3NzaWJseSBieSBwbHVnaW5zKSB3aWxsIGZpcmUgcHJvZ3Jlc3MgZXZlbnRzIG90aGVyIHRoYW4gMCBvciAxMDAlLjwvbGk+CgkgKiA8L3VsPgoJICoKCSAqICAgICAgcXVldWUub24oImZpbGVsb2FkIiwgaGFuZGxlRmlsZUxvYWQsIHRoaXMpOwoJICogICAgICBxdWV1ZS5vbigiY29tcGxldGUiLCBoYW5kbGVDb21wbGV0ZSwgdGhpcyk7CgkgKgoJICogPGI+QWRkaW5nIGZpbGVzIGFuZCBtYW5pZmVzdHM8L2I+PGJyIC8+CgkgKiBBZGQgZmlsZXMgeW91IHdhbnQgdG8gbG9hZCB1c2luZyB7eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZS9sb2FkRmlsZSJ9fXt7L2Nyb3NzTGlua319IG9yIGFkZCBtdWx0aXBsZSBmaWxlcyBhdCBhCgkgKiB0aW1lIHVzaW5nIGEgbGlzdCBvciBhIG1hbmlmZXN0IGRlZmluaXRpb24gdXNpbmcge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvbG9hZE1hbmlmZXN0In19e3svY3Jvc3NMaW5rfX0uIEZpbGVzIGFyZQoJICogYXBwZW5kZWQgdG8gdGhlIGVuZCBvZiB0aGUgYWN0aXZlIHF1ZXVlLCBzbyB5b3UgY2FuIHVzZSB0aGVzZSBtZXRob2RzIGFzIG1hbnkgdGltZXMgYXMgeW91IGxpa2UsIHdoZW5ldmVyIHlvdQoJICogbGlrZS4KCSAqCgkgKiAgICAgIHF1ZXVlLmxvYWRGaWxlKCJmaWxlUGF0aC9maWxlLmpwZyIpOwoJICogICAgICBxdWV1ZS5sb2FkRmlsZSh7aWQ6ImltYWdlIiwgc3JjOiJmaWxlUGF0aC9maWxlLmpwZyJ9KTsKCSAqICAgICAgcXVldWUubG9hZE1hbmlmZXN0KFsiZmlsZVBhdGgvZmlsZS5qcGciLCB7aWQ6ImltYWdlIiwgc3JjOiJmaWxlUGF0aC9maWxlLmpwZyJ9XTsKCSAqCgkgKiBJZiB5b3UgcGFzcyBgZmFsc2VgIGFzIHRoZSBgbG9hZE5vd2AgcGFyYW1ldGVyLCB0aGUgcXVldWUgd2lsbCBub3Qga2ljayBvZiB0aGUgbG9hZCBvZiB0aGUgZmlsZXMsIGJ1dCBpdCB3aWxsIG5vdAoJICogc3RvcCBpZiBpdCBoYXMgYWxyZWFkeSBiZWVuIHN0YXJ0ZWQuIENhbGwgdGhlIHt7I2Nyb3NzTGluayAiQWJzdHJhY3RMb2FkZXIvbG9hZCJ9fXt7L2Nyb3NzTGlua319IG1ldGhvZCB0byBiZWdpbgoJICogYSBwYXVzZWQgcXVldWUuIE5vdGUgdGhhdCBhIHBhdXNlZCBxdWV1ZSB3aWxsIGF1dG9tYXRpY2FsbHkgcmVzdW1lIHdoZW4gbmV3IGZpbGVzIGFyZSBhZGRlZCB0byBpdCB3aXRoIGEKCSAqIGBsb2FkTm93YCBhcmd1bWVudCBvZiBgdHJ1ZWAuCgkgKgoJICogICAgICBxdWV1ZS5sb2FkKCk7CgkgKgoJICogPGI+RmlsZSBUeXBlczwvYj48YnIgLz4KCSAqIFRoZSBmaWxlIHR5cGUgb2YgYSBtYW5pZmVzdCBpdGVtIGlzIGF1dG8tZGV0ZXJtaW5lZCBieSB0aGUgZmlsZSBleHRlbnNpb24uIFRoZSBwYXR0ZXJuIG1hdGNoaW5nIGluIFByZWxvYWRKUwoJICogc2hvdWxkIGhhbmRsZSB0aGUgbWFqb3JpdHkgb2Ygc3RhbmRhcmQgZmlsZSBhbmQgdXJsIGZvcm1hdHMsIGFuZCB3b3JrcyB3aXRoIGNvbW1vbiBmaWxlIGV4dGVuc2lvbnMuIElmIHlvdSBoYXZlCgkgKiBlaXRoZXIgYSBub24tc3RhbmRhcmQgZmlsZSBleHRlbnNpb24sIG9yIGFyZSBzZXJ2aW5nIHRoZSBmaWxlIHVzaW5nIGEgcHJveHkgc2NyaXB0LCB0aGVuIHlvdSBjYW4gcGFzcyBpbiBhCgkgKiA8Y29kZT50eXBlPC9jb2RlPiBwcm9wZXJ0eSB3aXRoIGFueSBtYW5pZmVzdCBpdGVtLgoJICoKCSAqICAgICAgcXVldWUubG9hZEZpbGUoe3NyYzoicGF0aC90by9teUZpbGUubXAzeCIsIHR5cGU6Y3JlYXRlanMuTG9hZFF1ZXVlLlNPVU5EfSk7CgkgKgoJICogICAgICAvLyBOb3RlIHRoYXQgUHJlbG9hZEpTIHdpbGwgbm90IHJlYWQgYSBmaWxlIGV4dGVuc2lvbiBmcm9tIHRoZSBxdWVyeSBzdHJpbmcKCSAqICAgICAgcXVldWUubG9hZEZpbGUoe3NyYzoiaHR0cDovL3NlcnZlci5jb20vcHJveHk/ZmlsZT1pbWFnZS5qcGcifSwgdHlwZTpjcmVhdGVqcy5Mb2FkUXVldWUuSU1BR0V9KTsKCSAqCgkgKiBTdXBwb3J0ZWQgdHlwZXMgYXJlIGRlZmluZWQgb24gdGhlIExvYWRRdWV1ZSBjbGFzcywgYW5kIGluY2x1ZGU6CgkgKiA8dWw+CgkgKiAgICAgPGxpPnt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlL0JJTkFSWTpwcm9wZXJ0eSJ9fXt7L2Nyb3NzTGlua319OiBSYXcgYmluYXJ5IGRhdGEgdmlhIFhIUjwvbGk+CgkgKiAgICAgPGxpPnt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlL0NTUzpwcm9wZXJ0eSJ9fXt7L2Nyb3NzTGlua319OiBDU1MgZmlsZXM8L2xpPgoJICogICAgIDxsaT57eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZS9JTUFHRTpwcm9wZXJ0eSJ9fXt7L2Nyb3NzTGlua319OiBDb21tb24gaW1hZ2UgZm9ybWF0czwvbGk+CgkgKiAgICAgPGxpPnt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlL0pBVkFTQ1JJUFQ6cHJvcGVydHkifX17ey9jcm9zc0xpbmt9fTogSmF2YVNjcmlwdCBmaWxlczwvbGk+CgkgKiAgICAgPGxpPnt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlL0pTT046cHJvcGVydHkifX17ey9jcm9zc0xpbmt9fTogSlNPTiBkYXRhPC9saT4KCSAqICAgICA8bGk+e3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvSlNPTlA6cHJvcGVydHkifX17ey9jcm9zc0xpbmt9fTogSlNPTiBmaWxlcyBjcm9zcy1kb21haW48L2xpPgoJICogICAgIDxsaT57eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZS9NQU5JRkVTVDpwcm9wZXJ0eSJ9fXt7L2Nyb3NzTGlua319OiBBIGxpc3Qgb2YgZmlsZXMgdG8gbG9hZCBpbiBKU09OIGZvcm1hdCwgc2VlCgkgKiAgICAge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvbG9hZE1hbmlmZXN0In19e3svY3Jvc3NMaW5rfX08L2xpPgoJICogICAgIDxsaT57eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZS9TT1VORDpwcm9wZXJ0eSJ9fXt7L2Nyb3NzTGlua319OiBBdWRpbyBmaWxlIGZvcm1hdHM8L2xpPgoJICogICAgIDxsaT57eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZS9TVkc6cHJvcGVydHkifX17ey9jcm9zc0xpbmt9fTogU1ZHIGZpbGVzPC9saT4KCSAqICAgICA8bGk+e3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvVEVYVDpwcm9wZXJ0eSJ9fXt7L2Nyb3NzTGlua319OiBUZXh0IGZpbGVzIC0gWEhSIG9ubHk8L2xpPgoJICogICAgIDxsaT57eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZS9YTUw6cHJvcGVydHkifX17ey9jcm9zc0xpbmt9fTogWE1MIGRhdGE8L2xpPgoJICogPC91bD4KCSAqCgkgKiA8Yj5IYW5kbGluZyBSZXN1bHRzPC9iPjxiciAvPgoJICogV2hlbiBhIGZpbGUgaXMgZmluaXNoZWQgZG93bmxvYWRpbmcsIGEge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvZmlsZWxvYWQ6ZXZlbnQifX17ey9jcm9zc0xpbmt9fSBldmVudCBpcwoJICogZGlzcGF0Y2hlZC4gSW4gYW4gZXhhbXBsZSBhYm92ZSwgdGhlcmUgaXMgYW4gZXZlbnQgbGlzdGVuZXIgc25pcHBldCBmb3IgZmlsZWxvYWQuIExvYWRlZCBmaWxlcyBhcmUgdXN1YWxseSBhCgkgKiByZXNvbHZlZCBvYmplY3QgdGhhdCBjYW4gYmUgdXNlZCBpbW1lZGlhdGVseSwgaW5jbHVkaW5nOgoJICogPHVsPgoJICogICAgIDxsaT5JbWFnZTogQW4gJmx0O2ltZyAvJmd0OyB0YWc8L2xpPgoJICogICAgIDxsaT5BdWRpbzogQW4gJmx0O2F1ZGlvIC8mZ3Q7IHRhZzwvYT4KCSAqICAgICA8bGk+SmF2YVNjcmlwdDogQSAmbHQ7c2NyaXB0IC8mZ3Q7IHRhZzwvbGk+CgkgKiAgICAgPGxpPkNTUzogQSAmbHQ7bGluayAvJmd0OyB0YWc8L2xpPgoJICogICAgIDxsaT5YTUw6IEFuIFhNTCBET00gbm9kZTwvbGk+CgkgKiAgICAgPGxpPlNWRzogQW4gJmx0O29iamVjdCAvJmd0OyB0YWc8L2xpPgoJICogICAgIDxsaT5KU09OOiBBIGZvcm1hdHRlZCBKYXZhU2NyaXB0IE9iamVjdDwvbGk+CgkgKiAgICAgPGxpPlRleHQ6IFJhdyB0ZXh0PC9saT4KCSAqICAgICA8bGk+QmluYXJ5OiBUaGUgYmluYXJ5IGxvYWRlZCByZXN1bHQ8L2xpPgoJICogPC91bD4KCSAqCgkgKiAgICAgIGZ1bmN0aW9uIGhhbmRsZUZpbGVMb2FkKGV2ZW50KSB7CgkgKiAgICAgICAgICB2YXIgaXRlbSA9IGV2ZW50Lml0ZW07IC8vIEEgcmVmZXJlbmNlIHRvIHRoZSBpdGVtIHRoYXQgd2FzIHBhc3NlZCBpbiB0byB0aGUgTG9hZFF1ZXVlCgkgKiAgICAgICAgICB2YXIgdHlwZSA9IGl0ZW0udHlwZTsKCSAqCgkgKiAgICAgICAgICAvLyBBZGQgYW55IGltYWdlcyB0byB0aGUgcGFnZSBib2R5LgoJICogICAgICAgICAgaWYgKHR5cGUgPT0gY3JlYXRlanMuTG9hZFF1ZXVlLklNQUdFKSB7CgkgKiAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChldmVudC5yZXN1bHQpOwoJICogICAgICAgICAgfQoJICogICAgICB9CgkgKgoJICogQXQgYW55IHRpbWUgYWZ0ZXIgdGhlIGZpbGUgaGFzIGJlZW4gbG9hZGVkICh1c3VhbGx5IGFmdGVyIHRoZSBxdWV1ZSBoYXMgY29tcGxldGVkKSwgYW55IHJlc3VsdCBjYW4gYmUgbG9va2VkIHVwCgkgKiB2aWEgaXRzICJpZCIgdXNpbmcge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvZ2V0UmVzdWx0In19e3svY3Jvc3NMaW5rfX0uIElmIG5vIGlkIHdhcyBwcm92aWRlZCwgdGhlbiB0aGUgInNyYyIgb3IKCSAqIGZpbGUgcGF0aCBjYW4gYmUgdXNlZCBpbnN0ZWFkLCBpbmNsdWRpbmcgdGhlIGBwYXRoYCBkZWZpbmVkIGJ5IGEgbWFuaWZlc3QsIGJ1dCA8c3Ryb25nPm5vdCBpbmNsdWRpbmc8L3N0cm9uZz4gYQoJICogYmFzZSBwYXRoIGRlZmluZWQgb24gdGhlIExvYWRRdWV1ZS4gSXQgaXMgcmVjb21tZW5kZWQgdG8gYWx3YXlzIHBhc3MgYW4gaWQuCgkgKgoJICogICAgICB2YXIgaW1hZ2UgPSBxdWV1ZS5nZXRSZXN1bHQoImltYWdlIik7CgkgKiAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoaW1hZ2UpOwoJICoKCSAqIFJhdyBsb2FkZWQgY29udGVudCBjYW4gYmUgYWNjZXNzZWQgdXNpbmcgdGhlIDxjb2RlPnJhd1Jlc3VsdDwvY29kZT4gcHJvcGVydHkgb2YgdGhlIHt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlL2ZpbGVsb2FkOmV2ZW50In19e3svY3Jvc3NMaW5rfX0KCSAqIGV2ZW50LCBvciBjYW4gYmUgbG9va2VkIHVwIHVzaW5nIHt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlL2dldFJlc3VsdCJ9fXt7L2Nyb3NzTGlua319LCBwYXNzaW5nIGB0cnVlYCBhcyB0aGUgMm5kCgkgKiBhcmd1bWVudC4gVGhpcyBpcyBvbmx5IGFwcGxpY2FibGUgZm9yIGNvbnRlbnQgdGhhdCBoYXMgYmVlbiBwYXJzZWQgZm9yIHRoZSBicm93c2VyLCBzcGVjaWZpY2FsbHk6IEphdmFTY3JpcHQsCgkgKiBDU1MsIFhNTCwgU1ZHLCBhbmQgSlNPTiBvYmplY3RzLCBvciBhbnl0aGluZyBsb2FkZWQgd2l0aCBYSFIuCgkgKgoJICogICAgICB2YXIgaW1hZ2UgPSBxdWV1ZS5nZXRSZXN1bHQoImltYWdlIiwgdHJ1ZSk7IC8vIGxvYWQgdGhlIGJpbmFyeSBpbWFnZSBkYXRhIGxvYWRlZCB3aXRoIFhIUi4KCSAqCgkgKiA8Yj5QbHVnaW5zPC9iPjxiciAvPgoJICogTG9hZFF1ZXVlIGhhcyBhIHNpbXBsZSBwbHVnaW4gYXJjaGl0ZWN0dXJlIHRvIGhlbHAgcHJvY2VzcyBhbmQgcHJlbG9hZCBjb250ZW50LiBGb3IgZXhhbXBsZSwgdG8gcHJlbG9hZCBhdWRpbywKCSAqIG1ha2Ugc3VyZSB0byBpbnN0YWxsIHRoZSA8YSBocmVmPSJodHRwOi8vc291bmRqcy5jb20iPlNvdW5kSlM8L2E+IFNvdW5kIGNsYXNzLCB3aGljaCB3aWxsIGhlbHAgbG9hZCBIVE1MIGF1ZGlvLAoJICogRmxhc2ggYXVkaW8sIGFuZCBXZWJBdWRpbyBmaWxlcy4gVGhpcyBzaG91bGQgYmUgaW5zdGFsbGVkIDxzdHJvbmc+YmVmb3JlPC9zdHJvbmc+IGxvYWRpbmcgYW55IGF1ZGlvIGZpbGVzLgoJICoKCSAqICAgICAgcXVldWUuaW5zdGFsbFBsdWdpbihjcmVhdGVqcy5Tb3VuZCk7CgkgKgoJICogPGg0Pktub3duIEJyb3dzZXIgSXNzdWVzPC9oND4KCSAqIDx1bD4KCSAqICAgICA8bGk+QnJvd3NlcnMgd2l0aG91dCBhdWRpbyBzdXBwb3J0IGNhbiBub3QgbG9hZCBhdWRpbyBmaWxlcy48L2xpPgoJICogICAgIDxsaT5TYWZhcmkgb24gTWFjIE9TIFggY2FuIG9ubHkgcGxheSBIVE1MIGF1ZGlvIGlmIFF1aWNrVGltZSBpcyBpbnN0YWxsZWQ8L2xpPgoJICogICAgIDxsaT5IVE1MIEF1ZGlvIHRhZ3Mgd2lsbCBvbmx5IGRvd25sb2FkIHVudGlsIHRoZWlyIDxjb2RlPmNhblBsYXlUaHJvdWdoPC9jb2RlPiBldmVudCBpcyBmaXJlZC4gQnJvd3NlcnMgb3RoZXIKCSAqICAgICB0aGFuIENocm9tZSB3aWxsIGNvbnRpbnVlIHRvIGRvd25sb2FkIGluIHRoZSBiYWNrZ3JvdW5kLjwvbGk+CgkgKiAgICAgPGxpPldoZW4gbG9hZGluZyBzY3JpcHRzIHVzaW5nIHRhZ3MsIHRoZXkgYXJlIGF1dG9tYXRpY2FsbHkgYWRkZWQgdG8gdGhlIGRvY3VtZW50LjwvbGk+CgkgKiAgICAgPGxpPlNjcmlwdHMgbG9hZGVkIHZpYSBYSFIgbWF5IG5vdCBiZSBwcm9wZXJseSBpbnNwZWN0YWJsZSB3aXRoIGJyb3dzZXIgdG9vbHMuPC9saT4KCSAqICAgICA8bGk+SUU2IGFuZCBJRTcgKGFuZCBzb21lIG90aGVyIGJyb3dzZXJzKSBtYXkgbm90IGJlIGFibGUgdG8gbG9hZCBYTUwsIFRleHQsIG9yIEpTT04sIHNpbmNlIHRoZXkgcmVxdWlyZQoJICogICAgIFhIUiB0byB3b3JrLjwvbGk+CgkgKiAgICAgPGxpPkNvbnRlbnQgbG9hZGVkIHZpYSB0YWdzIHdpbGwgbm90IHNob3cgcHJvZ3Jlc3MsIGFuZCB3aWxsIGNvbnRpbnVlIHRvIGRvd25sb2FkIGluIHRoZSBiYWNrZ3JvdW5kIHdoZW4KCSAqICAgICBjYW5jZWxlZCwgYWx0aG91Z2ggbm8gZXZlbnRzIHdpbGwgYmUgZGlzcGF0Y2hlZC48L2xpPgoJICogPC91bD4KCSAqCgkgKiBAY2xhc3MgTG9hZFF1ZXVlCgkgKiBAcGFyYW0ge0Jvb2xlYW59IFt1c2VYSFI9dHJ1ZV0gRGV0ZXJtaW5lcyB3aGV0aGVyIHRoZSBwcmVsb2FkIGluc3RhbmNlIHdpbGwgZmF2b3IgbG9hZGluZyB3aXRoIFhIUiAoWE1MIEhUVFAKCSAqIFJlcXVlc3RzKSwgb3IgSFRNTCB0YWdzLiBXaGVuIHRoaXMgaXMgYGZhbHNlYCwgdGhlIHF1ZXVlIHdpbGwgdXNlIHRhZyBsb2FkaW5nIHdoZW4gcG9zc2libGUsIGFuZCBmYWxsIGJhY2sgb24gWEhSCgkgKiB3aGVuIG5lY2Vzc2FyeS4KCSAqIEBwYXJhbSB7U3RyaW5nfSBbYmFzZVBhdGg9IiJdIEEgcGF0aCB0aGF0IHdpbGwgYmUgcHJlcGVuZGVkIG9uIHRvIHRoZSBzb3VyY2UgcGFyYW1ldGVyIG9mIGFsbCBpdGVtcyBpbiB0aGUgcXVldWUKCSAqIGJlZm9yZSB0aGV5IGFyZSBsb2FkZWQuICBTb3VyY2VzIGJlZ2lubmluZyB3aXRoIGEgcHJvdG9jb2wgc3VjaCBhcyBgaHR0cDovL2Agb3IgYSByZWxhdGl2ZSBwYXRoIHN1Y2ggYXMgYC4uL2AKCSAqIHdpbGwgbm90IHJlY2VpdmUgYSBiYXNlIHBhdGguCgkgKiBAcGFyYW0ge1N0cmluZ3xCb29sZWFufSBbY3Jvc3NPcmlnaW49IiJdIEFuIG9wdGlvbmFsIGZsYWcgdG8gc3VwcG9ydCBpbWFnZXMgbG9hZGVkIGZyb20gYSBDT1JTLWVuYWJsZWQgc2VydmVyLiBUbwoJICogdXNlIGl0LCBzZXQgdGhpcyB2YWx1ZSB0byBgdHJ1ZWAsIHdoaWNoIHdpbGwgZGVmYXVsdCB0aGUgY3Jvc3NPcmlnaW4gcHJvcGVydHkgb24gaW1hZ2VzIHRvICJBbm9ueW1vdXMiLiBBbnkKCSAqIHN0cmluZyB2YWx1ZSB3aWxsIGJlIHBhc3NlZCB0aHJvdWdoLCBidXQgb25seSAiIiBhbmQgIkFub255bW91cyIgYXJlIHJlY29tbWVuZGVkLgoJICogQGNvbnN0cnVjdG9yCgkgKiBAZXh0ZW5kcyBBYnN0cmFjdExvYWRlcgoJICovCgl2YXIgTG9hZFF1ZXVlID0gZnVuY3Rpb24odXNlWEhSLCBiYXNlUGF0aCwgY3Jvc3NPcmlnaW4pIHsKCQl0aGlzLmluaXQodXNlWEhSLCBiYXNlUGF0aCwgY3Jvc3NPcmlnaW4pOwoJfTsKCgl2YXIgcCA9IExvYWRRdWV1ZS5wcm90b3R5cGUgPSBuZXcgY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIoKTsKCXZhciBzID0gTG9hZFF1ZXVlOwoKCS8qKgoJICogVGltZSBpbiBtaWxsaXNlY29uZHMgdG8gYXNzdW1lIGEgbG9hZCBoYXMgZmFpbGVkLiBBbiB7eyNjcm9zc0xpbmsgIkFic3RyYWN0TG9hZGVyL2Vycm9yOmV2ZW50In19e3svY3Jvc3NMaW5rfX0KCSAqIGV2ZW50IGlzIGRpc3BhdGNoZWQgaWYgdGhlIHRpbWVvdXQgaXMgcmVhY2hlZCBiZWZvcmUgYW55IGRhdGEgaXMgcmVjZWl2ZWQuCgkgKiBAcHJvcGVydHkgbG9hZFRpbWVvdXQKCSAqIEB0eXBlIHtOdW1iZXJ9CgkgKiBAZGVmYXVsdCA4MDAwCgkgKiBAc3RhdGljCgkgKiBAc2luY2UgMC40LjEKCSAqLwoJcy5sb2FkVGltZW91dCA9IDgwMDA7CgoJLyoqCgkgKiBUaW1lIGluIG1pbGxpc2Vjb25kcyB0byBhc3N1bWUgYSBsb2FkIGhhcyBmYWlsZWQuCgkgKiBAdHlwZSB7TnVtYmVyfQoJICogQGRlcHJlY2F0ZWQgaW4gZmF2b3Igb2YgdGhlIHt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlL2xvYWRUaW1lb3V0OnByb3BlcnR5In19e3svY3Jvc3NMaW5rfX0gcHJvcGVydHkuCgkgKi8KCXMuTE9BRF9USU1FT1VUID0gMDsKCi8vIFByZWxvYWQgVHlwZXMKCS8qKgoJICogVGhlIHByZWxvYWQgdHlwZSBmb3IgZ2VuZXJpYyBiaW5hcnkgdHlwZXMuIE5vdGUgdGhhdCBpbWFnZXMgYXJlIGxvYWRlZCBhcyBiaW5hcnkgZmlsZXMgd2hlbiB1c2luZyBYSFIuCgkgKiBAcHJvcGVydHkgQklOQVJZCgkgKiBAdHlwZSB7U3RyaW5nfQoJICogQGRlZmF1bHQgYmluYXJ5CgkgKiBAc3RhdGljCgkgKi8KCXMuQklOQVJZID0gImJpbmFyeSI7CgoJLyoqCgkgKiBUaGUgcHJlbG9hZCB0eXBlIGZvciBjc3MgZmlsZXMuIENTUyBmaWxlcyBhcmUgbG9hZGVkIHVzaW5nIGEgJmx0O2xpbmsmZ3Q7IHdoZW4gbG9hZGVkIHdpdGggWEhSLCBvciBhCgkgKiAmbHQ7c3R5bGUmZ3Q7IHRhZyB3aGVuIGxvYWRlZCB3aXRoIHRhZ3MuCgkgKiBAcHJvcGVydHkgQ1NTCgkgKiBAdHlwZSB7U3RyaW5nfQoJICogQGRlZmF1bHQgY3NzCgkgKiBAc3RhdGljCgkgKi8KCXMuQ1NTID0gImNzcyI7CgoJLyoqCgkgKiBUaGUgcHJlbG9hZCB0eXBlIGZvciBpbWFnZSBmaWxlcywgdXN1YWxseSBwbmcsIGdpZiwgb3IganBnL2pwZWcuIEltYWdlcyBhcmUgbG9hZGVkIGludG8gYW4gJmx0O2ltYWdlJmd0OyB0YWcuCgkgKiBAcHJvcGVydHkgSU1BR0UKCSAqIEB0eXBlIHtTdHJpbmd9CgkgKiBAZGVmYXVsdCBpbWFnZQoJICogQHN0YXRpYwoJICovCglzLklNQUdFID0gImltYWdlIjsKCgkvKioKCSAqIFRoZSBwcmVsb2FkIHR5cGUgZm9yIGphdmFzY3JpcHQgZmlsZXMsIHVzdWFsbHkgd2l0aCB0aGUgImpzIiBmaWxlIGV4dGVuc2lvbi4gSmF2YVNjcmlwdCBmaWxlcyBhcmUgbG9hZGVkIGludG8gYQoJICogJmx0O3NjcmlwdCZndDsgdGFnLgoJICoKCSAqIFNpbmNlIHZlcnNpb24gMC40LjErLCBkdWUgdG8gaG93IHRhZy1sb2FkZWQgc2NyaXB0cyB3b3JrLCBhbGwgSmF2YVNjcmlwdCBmaWxlcyBhcmUgYXV0b21hdGljYWxseSBpbmplY3RlZCBpbnRvCgkgKiB0aGUgYm9keSBvZiB0aGUgZG9jdW1lbnQgdG8gbWFpbnRhaW4gcGFyaXR5IGJldHdlZW4gWEhSIGFuZCB0YWctbG9hZGVkIHNjcmlwdHMuIEluIHZlcnNpb24gMC40LjAgYW5kIGVhcmxpZXIsCgkgKiBvbmx5IHRhZy1sb2FkZWQgc2NyaXB0cyBhcmUgaW5qZWN0ZWQuCgkgKiBAcHJvcGVydHkgSkFWQVNDUklQVAoJICogQHR5cGUge1N0cmluZ30KCSAqIEBkZWZhdWx0IGphdmFzY3JpcHQKCSAqIEBzdGF0aWMKCSAqLwoJcy5KQVZBU0NSSVBUID0gImphdmFzY3JpcHQiOwoKCS8qKgoJICogVGhlIHByZWxvYWQgdHlwZSBmb3IganNvbiBmaWxlcywgdXN1YWxseSB3aXRoIHRoZSAianNvbiIgZmlsZSBleHRlbnNpb24uIEpTT04gZGF0YSBpcyBsb2FkZWQgYW5kIHBhcnNlZCBpbnRvIGEKCSAqIEphdmFTY3JpcHQgb2JqZWN0LiBOb3RlIHRoYXQgaWYgYSBgY2FsbGJhY2tgIGlzIHByZXNlbnQgb24gdGhlIGxvYWQgaXRlbSwgdGhlIGZpbGUgd2lsbCBiZSBsb2FkZWQgd2l0aCBKU09OUCwKCSAqIG5vIG1hdHRlciB3aGF0IHRoZSB7eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZS91c2VYSFI6cHJvcGVydHkifX17ey9jcm9zc0xpbmt9fSBwcm9wZXJ0eSBpcyBzZXQgdG8sIGFuZCB0aGUgSlNPTgoJICogbXVzdCBjb250YWluIGEgbWF0Y2hpbmcgd3JhcHBlciBmdW5jdGlvbi4KCSAqIEBwcm9wZXJ0eSBKU09OCgkgKiBAdHlwZSB7U3RyaW5nfQoJICogQGRlZmF1bHQganNvbgoJICogQHN0YXRpYwoJICovCglzLkpTT04gPSAianNvbiI7CgoJLyoqCgkgKiBUaGUgcHJlbG9hZCB0eXBlIGZvciBqc29ucCBmaWxlcywgdXN1YWxseSB3aXRoIHRoZSAianNvbiIgZmlsZSBleHRlbnNpb24uIEpTT04gZGF0YSBpcyBsb2FkZWQgYW5kIHBhcnNlZCBpbnRvIGEKCSAqIEphdmFTY3JpcHQgb2JqZWN0LiBZb3UgYXJlIHJlcXVpcmVkIHRvIHBhc3MgYSBjYWxsYmFjayBwYXJhbWV0ZXIgdGhhdCBtYXRjaGVzIHRoZSBmdW5jdGlvbiB3cmFwcGVyIGluIHRoZSBKU09OLgoJICogTm90ZSB0aGF0IEpTT05QIHdpbGwgYWx3YXlzIGJlIHVzZWQgaWYgdGhlcmUgaXMgYSBjYWxsYmFjayBwcmVzZW50LCBubyBtYXR0ZXIgd2hhdCB0aGUge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvdXNlWEhSOnByb3BlcnR5In19e3svY3Jvc3NMaW5rfX0KCSAqIHByb3BlcnR5IGlzIHNldCB0by4KCSAqIEBwcm9wZXJ0eSBKU09OUAoJICogQHR5cGUge1N0cmluZ30KCSAqIEBkZWZhdWx0IGpzb25wCgkgKiBAc3RhdGljCgkgKi8KCXMuSlNPTlAgPSAianNvbnAiOwoKCS8qKgoJICogVGhlIHByZWxvYWQgdHlwZSBmb3IganNvbi1iYXNlZCBtYW5pZmVzdCBmaWxlcywgdXN1YWxseSB3aXRoIHRoZSAianNvbiIgZmlsZSBleHRlbnNpb24uIFRoZSBKU09OIGRhdGEgaXMgbG9hZGVkCgkgKiBhbmQgcGFyc2VkIGludG8gYSBKYXZhU2NyaXB0IG9iamVjdC4gUHJlbG9hZEpTIHdpbGwgdGhlbiBsb29rIGZvciBhICJtYW5pZmVzdCIgcHJvcGVydHkgaW4gdGhlIEpTT04sIHdoaWNoIGlzIGFuCgkgKiBBcnJheSBvZiBmaWxlcyB0byBsb2FkLCBmb2xsb3dpbmcgdGhlIHNhbWUgZm9ybWF0IGFzIHRoZSB7eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZS9sb2FkTWFuaWZlc3QifX17ey9jcm9zc0xpbmt9fQoJICogbWV0aG9kLiBJZiBhICJjYWxsYmFjayIgaXMgc3BlY2lmaWVkIG9uIHRoZSBtYW5pZmVzdCBvYmplY3QsIHRoZW4gaXQgd2lsbCBiZSBsb2FkZWQgdXNpbmcgSlNPTlAgaW5zdGVhZCwKCSAqIHJlZ2FyZGxlc3Mgb2Ygd2hhdCB0aGUge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvdXNlWEhSOnByb3BlcnR5In19e3svY3Jvc3NMaW5rfX0gcHJvcGVydHkgaXMgc2V0IHRvLgoJICogQHByb3BlcnR5IE1BTklGRVNUCgkgKiBAdHlwZSB7U3RyaW5nfQoJICogQGRlZmF1bHQgbWFuaWZlc3QKCSAqIEBzdGF0aWMKCSAqIEBzaW5jZSAwLjQuMQoJICovCglzLk1BTklGRVNUID0gIm1hbmlmZXN0IjsKCgkvKioKCSAqIFRoZSBwcmVsb2FkIHR5cGUgZm9yIHNvdW5kIGZpbGVzLCB1c3VhbGx5IG1wMywgb2dnLCBvciB3YXYuIFdoZW4gbG9hZGluZyB2aWEgdGFncywgYXVkaW8gaXMgbG9hZGVkIGludG8gYW4KCSAqICZsdDthdWRpbyZndDsgdGFnLgoJICogQHByb3BlcnR5IFNPVU5ECgkgKiBAdHlwZSB7U3RyaW5nfQoJICogQGRlZmF1bHQgc291bmQKCSAqIEBzdGF0aWMKCSAqLwoJcy5TT1VORCA9ICJzb3VuZCI7CgoJLyoqCiAgICAgKiBUaGUgcHJlbG9hZCB0eXBlIGZvciBTVkcgZmlsZXMuCgkgKiBAcHJvcGVydHkgU1ZHCgkgKiBAdHlwZSB7U3RyaW5nfQoJICogQGRlZmF1bHQgc3ZnCgkgKiBAc3RhdGljCgkgKi8KCXMuU1ZHID0gInN2ZyI7CgoJLyoqCgkgKiBUaGUgcHJlbG9hZCB0eXBlIGZvciB0ZXh0IGZpbGVzLCB3aGljaCBpcyBhbHNvIHRoZSBkZWZhdWx0IGZpbGUgdHlwZSBpZiB0aGUgdHlwZSBjYW4gbm90IGJlIGRldGVybWluZWQuIFRleHQgaXMKCSAqIGxvYWRlZCBhcyByYXcgdGV4dC4KCSAqIEBwcm9wZXJ0eSBURVhUCgkgKiBAdHlwZSB7U3RyaW5nfQoJICogQGRlZmF1bHQgdGV4dAoJICogQHN0YXRpYwoJICovCglzLlRFWFQgPSAidGV4dCI7CgoJLyoqCgkgKiBUaGUgcHJlbG9hZCB0eXBlIGZvciB4bWwgZmlsZXMuIFhNTCBpcyBsb2FkZWQgaW50byBhbiBYTUwgZG9jdW1lbnQuCgkgKiBAcHJvcGVydHkgWE1MCgkgKiBAdHlwZSB7U3RyaW5nfQoJICogQGRlZmF1bHQgeG1sCgkgKiBAc3RhdGljCgkgKi8KCXMuWE1MID0gInhtbCI7CgoJLyoqCgkgKiBEZWZpbmVzIGEgUE9TVCByZXF1ZXN0LCB1c2UgZm9yIGEgbWV0aG9kIHZhbHVlIHdoZW4gbG9hZGluZyBkYXRhLgoJICoKCSAqIEB0eXBlIHtzdHJpbmd9CgkgKi8KCXMuUE9TVCA9ICdQT1NUJzsKCgkvKioKCSAqIERlZmluZXMgYSBHRVQgcmVxdWVzdCwgdXNlIGZvciBhIG1ldGhvZCB2YWx1ZSB3aGVuIGxvYWRpbmcgZGF0YS4KCSAqCgkgKiBAdHlwZSB7c3RyaW5nfQoJICovCglzLkdFVCA9ICdHRVQnOwoKCi8vIFByb3RvdHlwZQoJLyoqCgkgKiBBIHBhdGggdGhhdCB3aWxsIGJlIHByZXBlbmRlZCBvbiB0byB0aGUgaXRlbSdzIGBzcmNgLiBUaGUgYF9iYXNlUGF0aGAgcHJvcGVydHkgd2lsbCBvbmx5IGJlIHVzZWQgaWYgYW4gaXRlbSdzCgkgKiBzb3VyY2UgaXMgcmVsYXRpdmUsIGFuZCBkb2VzIG5vdCBpbmNsdWRlIGEgcHJvdG9jb2wgc3VjaCBhcyBgaHR0cDovL2AsIG9yIGEgcmVsYXRpdmUgcGF0aCBzdWNoIGFzIGAuLi9gLgoJICogQHByb3BlcnR5IF9iYXNlUGF0aAoJICogQHR5cGUge1N0cmluZ30KCSAqIEBwcml2YXRlCgkgKiBAc2luY2UgMC4zLjEKCSAqLwoJcC5fYmFzZVBhdGggPSBudWxsOwoKCS8qKgoJICogQW4gb3B0aW9uYWwgZmxhZyB0byBzZXQgb24gaW1hZ2VzIHRoYXQgYXJlIGxvYWRlZCB1c2luZyBQcmVsb2FkSlMsIHdoaWNoIGVuYWJsZXMgQ09SUyBzdXBwb3J0LiBJbWFnZXMgbG9hZGVkCgkgKiBjcm9zcy1kb21haW4gYnkgc2VydmVycyB0aGF0IHN1cHBvcnQgQ09SUyByZXF1aXJlIHRoZSBjcm9zc09yaWdpbiBmbGFnIHRvIGJlIGxvYWRlZCBhbmQgaW50ZXJhY3RlZCB3aXRoIGJ5CgkgKiBhIGNhbnZhcy4gV2hlbiBsb2FkaW5nIGxvY2FsbHksIG9yIHdpdGggYSBzZXJ2ZXIgd2l0aCBubyBDT1JTIHN1cHBvcnQsIHRoaXMgZmxhZyBjYW4gY2F1c2Ugb3RoZXIgc2VjdXJpdHkgaXNzdWVzLAoJICogc28gaXQgaXMgcmVjb21tZW5kZWQgdG8gb25seSBzZXQgaXQgaWYgeW91IGFyZSBzdXJlIHRoZSBzZXJ2ZXIgc3VwcG9ydHMgaXQuIEN1cnJlbnRseSwgc3VwcG9ydGVkIHZhbHVlcyBhcmUgIiIKCSAqIGFuZCAiQW5vbnltb3VzIi4KCSAqIEBwcm9wZXJ0eSBfY3Jvc3NPcmlnaW4KCSAqIEB0eXBlIHtTdHJpbmd9CgkgKiBAZGVmYXVsdFZhbHVlICIiCgkgKiBAcHJpdmF0ZQoJICogQHNpbmNlIDAuNC4xCgkgKi8KCXAuX2Nyb3NzT3JpZ2luID0gIiI7CgoJLyoqCgkgKiBVc2UgWE1MSHR0cFJlcXVlc3QgKFhIUikgd2hlbiBwb3NzaWJsZS4gTm90ZSB0aGF0IExvYWRRdWV1ZSB3aWxsIGRlZmF1bHQgdG8gdGFnIGxvYWRpbmcgb3IgWEhSIGxvYWRpbmcgZGVwZW5kaW5nCgkgKiBvbiB0aGUgcmVxdWlyZW1lbnRzIGZvciBhIG1lZGlhIHR5cGUuIEZvciBleGFtcGxlLCBIVE1MIGF1ZGlvIGNhbiBub3QgYmUgbG9hZGVkIHdpdGggWEhSLCBhbmQgV2ViQXVkaW8gY2FuIG5vdCBiZQoJICogbG9hZGVkIHdpdGggdGFncywgc28gaXQgd2lsbCBkZWZhdWx0IHRoZSB0aGUgY29ycmVjdCB0eXBlIGluc3RlYWQgb2YgdXNpbmcgdGhlIHVzZXItZGVmaW5lZCB0eXBlLgoJICoKCSAqIDxiPk5vdGU6IFRoaXMgcHJvcGVydHkgaXMgcmVhZC1vbmx5LjwvYj4gVG8gY2hhbmdlIGl0LCBwbGVhc2UgdXNlIHRoZSB7eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZS9zZXRVc2VYSFIifX17ey9jcm9zc0xpbmt9fQoJICogbWV0aG9kLCBvciBzcGVjaWZ5IHRoZSBgdXNlWEhSYCBhcmd1bWVudCBpbiB0aGUgTG9hZFF1ZXVlIGNvbnN0cnVjdG9yLgoJICoKCSAqIEBwcm9wZXJ0eSB1c2VYSFIKCSAqIEB0eXBlIHtCb29sZWFufQoJICogQHJlYWRPbmx5CgkgKiBAZGVmYXVsdCB0cnVlCgkgKi8KCXAudXNlWEhSID0gdHJ1ZTsKCgkvKioKCSAqIERldGVybWluZXMgaWYgdGhlIExvYWRRdWV1ZSB3aWxsIHN0b3AgcHJvY2Vzc2luZyB0aGUgY3VycmVudCBxdWV1ZSB3aGVuIGFuIGVycm9yIGlzIGVuY291bnRlcmVkLgoJICogQHByb3BlcnR5IHN0b3BPbkVycm9yCgkgKiBAdHlwZSB7Qm9vbGVhbn0KCSAqIEBkZWZhdWx0IGZhbHNlCgkgKi8KCXAuc3RvcE9uRXJyb3IgPSBmYWxzZTsKCgkvKioKCSAqIEVuc3VyZSBsb2FkZWQgc2NyaXB0cyAiY29tcGxldGUiIGluIHRoZSBvcmRlciB0aGV5IGFyZSBzcGVjaWZpZWQuIExvYWRlZCBzY3JpcHRzIGFyZSBhZGRlZCB0byB0aGUgZG9jdW1lbnQgaGVhZAoJICogb25jZSB0aGV5IGFyZSBsb2FkZWQuIE5vdGUgdGhhdCBzY3JpcHRzIGxvYWRlZCB2aWEgdGFncyB3aWxsIGxvYWQgb25lLWF0LWEtdGltZSB3aGVuIHRoaXMgcHJvcGVydHkgaXMgYHRydWVgLgoJICogbG9hZCBvbmUgYXQgYSB0aW1lCgkgKiBAcHJvcGVydHkgbWFpbnRhaW5TY3JpcHRPcmRlcgoJICogQHR5cGUge0Jvb2xlYW59CgkgKiBAZGVmYXVsdCB0cnVlCgkgKi8KCXAubWFpbnRhaW5TY3JpcHRPcmRlciA9IHRydWU7CgoJLyoqCgkgKiBUaGUgbmV4dCBwcmVsb2FkIHF1ZXVlIHRvIHByb2Nlc3Mgd2hlbiB0aGlzIG9uZSBpcyBjb21wbGV0ZS4gSWYgYW4gZXJyb3IgaXMgdGhyb3duIGluIHRoZSBjdXJyZW50IHF1ZXVlLCBhbmQKCSAqIHt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlL3N0b3BPbkVycm9yOnByb3BlcnR5In19e3svY3Jvc3NMaW5rfX0gaXMgYHRydWVgLCB0aGUgbmV4dCBxdWV1ZSB3aWxsIG5vdCBiZSBwcm9jZXNzZWQuCgkgKiBAcHJvcGVydHkgbmV4dAoJICogQHR5cGUge0xvYWRRdWV1ZX0KCSAqIEBkZWZhdWx0IG51bGwKCSAqLwoJcC5uZXh0ID0gbnVsbDsKCi8vIEV2ZW50cwoJLyoqCgkgKiBUaGlzIGV2ZW50IGlzIGZpcmVkIHdoZW4gYW4gaW5kaXZpZHVhbCBmaWxlIGhhcyBsb2FkZWQsIGFuZCBiZWVuIHByb2Nlc3NlZC4KCSAqIEBldmVudCBmaWxlbG9hZAoJICogQHBhcmFtIHtPYmplY3R9IHRhcmdldCBUaGUgb2JqZWN0IHRoYXQgZGlzcGF0Y2hlZCB0aGUgZXZlbnQuCgkgKiBAcGFyYW0ge1N0cmluZ30gdHlwZSBUaGUgZXZlbnQgdHlwZS4KCSAqIEBwYXJhbSB7T2JqZWN0fSBpdGVtIFRoZSBmaWxlIGl0ZW0gd2hpY2ggd2FzIHNwZWNpZmllZCBpbiB0aGUge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvbG9hZEZpbGUifX17ey9jcm9zc0xpbmt9fQoJICogb3Ige3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvbG9hZE1hbmlmZXN0In19e3svY3Jvc3NMaW5rfX0gY2FsbC4gSWYgb25seSBhIHN0cmluZyBwYXRoIG9yIHRhZyB3YXMgc3BlY2lmaWVkLCB0aGUKCSAqIG9iamVjdCB3aWxsIGNvbnRhaW4gdGhhdCB2YWx1ZSBhcyBhIGBzcmNgIHByb3BlcnR5LgoJICogQHBhcmFtIHtPYmplY3R9IHJlc3VsdCBUaGUgSFRNTCB0YWcgb3IgcGFyc2VkIHJlc3VsdCBvZiB0aGUgbG9hZGVkIGl0ZW0uCgkgKiBAcGFyYW0ge09iamVjdH0gcmF3UmVzdWx0IFRoZSB1bnByb2Nlc3NlZCByZXN1bHQsIHVzdWFsbHkgdGhlIHJhdyB0ZXh0IG9yIGJpbmFyeSBkYXRhIGJlZm9yZSBpdCBpcyBjb252ZXJ0ZWQKCSAqIHRvIGEgdXNhYmxlIG9iamVjdC4KCSAqIEBzaW5jZSAwLjMuMAoJICovCgoJLyoqCgkgKiBUaGlzIGV2ZW50IGlzIGZpcmVkIHdoZW4gYW4gYW4gaW5kaXZpZHVhbCBmaWxlIHByb2dyZXNzIGNoYW5nZXMuCgkgKiBAZXZlbnQgZmlsZXByb2dyZXNzCgkgKiBAcGFyYW0ge09iamVjdH0gVGhlIG9iamVjdCB0aGF0IGRpc3BhdGNoZWQgdGhlIGV2ZW50LgoJICogQHBhcmFtIHtTdHJpbmd9IHR5cGUgVGhlIGV2ZW50IHR5cGUuCgkgKiBAcGFyYW0ge09iamVjdH0gaXRlbSBUaGUgZmlsZSBpdGVtIHdoaWNoIHdhcyBzcGVjaWZpZWQgaW4gdGhlIHt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlL2xvYWRGaWxlIn19e3svY3Jvc3NMaW5rfX0KCSAqIG9yIHt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlL2xvYWRNYW5pZmVzdCJ9fXt7L2Nyb3NzTGlua319IGNhbGwuIElmIG9ubHkgYSBzdHJpbmcgcGF0aCBvciB0YWcgd2FzIHNwZWNpZmllZCwgdGhlCgkgKiBvYmplY3Qgd2lsbCBjb250YWluIHRoYXQgdmFsdWUgYXMgYSBgc3JjYCBwcm9wZXJ0eS4KCSAqIEBwYXJhbSB7TnVtYmVyfSBsb2FkZWQgVGhlIG51bWJlciBvZiBieXRlcyB0aGF0IGhhdmUgYmVlbiBsb2FkZWQuIE5vdGUgdGhhdCB0aGlzIG1heSBqdXN0IGJlIGEgcGVyY2VudGFnZSBvZiAxLgoJICogQHBhcmFtIHtOdW1iZXJ9IHRvdGFsIFRoZSB0b3RhbCBudW1iZXIgb2YgYnl0ZXMuIElmIGl0IGlzIHVua25vd24sIHRoZSB2YWx1ZSBpcyAxLgoJICogQHBhcmFtIHtOdW1iZXJ9IHByb2dyZXNzIFRoZSBhbW91bnQgdGhhdCBoYXMgYmVlbiBsb2FkZWQgYmV0d2VlbiAwIGFuZCAxLgoJICogQHNpbmNlIDAuMy4wCgkgKi8KCgkvKioKCSAqIFRoaXMgZXZlbnQgaXMgZmlyZWQgd2hlbiBhbiBpbmRpdmlkdWFsIGZpbGUgc3RhcnRzIHRvIGxvYWQuCgkgKiBAZXZlbnQgZmlsZXN0YXJ0CgkgKiBAcGFyYW0ge09iamVjdH0gVGhlIG9iamVjdCB0aGF0IGRpc3BhdGNoZWQgdGhlIGV2ZW50LgoJICogQHBhcmFtIHtTdHJpbmd9IHR5cGUgVGhlIGV2ZW50IHR5cGUuCgkgKiBAcGFyYW0ge09iamVjdH0gaXRlbSBUaGUgZmlsZSBpdGVtIHdoaWNoIHdhcyBzcGVjaWZpZWQgaW4gdGhlIHt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlL2xvYWRGaWxlIn19e3svY3Jvc3NMaW5rfX0KCSAqIG9yIHt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlL2xvYWRNYW5pZmVzdCJ9fXt7L2Nyb3NzTGlua319IGNhbGwuIElmIG9ubHkgYSBzdHJpbmcgcGF0aCBvciB0YWcgd2FzIHNwZWNpZmllZCwgdGhlCgkgKiBvYmplY3Qgd2lsbCBjb250YWluIHRoYXQgdmFsdWUgYXMgYSBwcm9wZXJ0eS4KCSAqLwoKCS8vVE9ETzogRGVwcmVjYXRlZAoJLyoqCgkgKiBSRU1PVkVELiBVc2Uge3sjY3Jvc3NMaW5rICJFdmVudERpc3BhdGNoZXIvYWRkRXZlbnRMaXN0ZW5lciJ9fXt7L2Nyb3NzTGlua319IGFuZCB0aGUge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvZmlsZWxvYWQ6ZXZlbnQifX17ey9jcm9zc0xpbmt9fQoJICogZXZlbnQuCgkgKiBAcHJvcGVydHkgb25GaWxlTG9hZAoJICogQHR5cGUge0Z1bmN0aW9ufQoJICogQGRlcHJlY2F0ZWQgVXNlIGFkZEV2ZW50TGlzdGVuZXIgYW5kIHRoZSAiZmlsZWxvYWQiIGV2ZW50LgoJICovCgkvKioKCSAqIFJFTU9WRUQuIFVzZSB7eyNjcm9zc0xpbmsgIkV2ZW50RGlzcGF0Y2hlci9hZGRFdmVudExpc3RlbmVyIn19e3svY3Jvc3NMaW5rfX0gYW5kIHRoZSB7eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZS9maWxlcHJvZ3Jlc3M6ZXZlbnQifX17ey9jcm9zc0xpbmt9fQoJICogZXZlbnQuCgkgKiBAcHJvcGVydHkgb25GaWxlUHJvZ3Jlc3MKCSAqIEB0eXBlIHtGdW5jdGlvbn0KCSAqIEBkZXByZWNhdGVkIFVzZSBhZGRFdmVudExpc3RlbmVyIGFuZCB0aGUgImZpbGVwcm9ncmVzcyIgZXZlbnQuCgkgKi8KCgovLyBQcm90ZWN0ZWQKCS8qKgoJICogQW4gb2JqZWN0IGhhc2ggb2YgY2FsbGJhY2tzIHRoYXQgYXJlIGZpcmVkIGZvciBlYWNoIGZpbGUgdHlwZSBiZWZvcmUgdGhlIGZpbGUgaXMgbG9hZGVkLCBnaXZpbmcgcGx1Z2lucyB0aGUKCSAqIGFiaWxpdHkgdG8gb3ZlcnJpZGUgcHJvcGVydGllcyBvZiB0aGUgbG9hZC4gUGxlYXNlIHNlZSB0aGUge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvaW5zdGFsbFBsdWdpbiJ9fXt7L2Nyb3NzTGlua319CgkgKiBtZXRob2QgZm9yIG1vcmUgaW5mb3JtYXRpb24uCgkgKiBAcHJvcGVydHkgX3R5cGVDYWxsYmFja3MKCSAqIEB0eXBlIHtPYmplY3R9CgkgKiBAcHJpdmF0ZQoJICovCglwLl90eXBlQ2FsbGJhY2tzID0gbnVsbDsKCgkvKioKCSAqIEFuIG9iamVjdCBoYXNoIG9mIGNhbGxiYWNrcyB0aGF0IGFyZSBmaXJlZCBmb3IgZWFjaCBmaWxlIGV4dGVuc2lvbiBiZWZvcmUgdGhlIGZpbGUgaXMgbG9hZGVkLCBnaXZpbmcgcGx1Z2lucyB0aGUKCSAqIGFiaWxpdHkgdG8gb3ZlcnJpZGUgcHJvcGVydGllcyBvZiB0aGUgbG9hZC4gUGxlYXNlIHNlZSB0aGUge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvaW5zdGFsbFBsdWdpbiJ9fXt7L2Nyb3NzTGlua319CgkgKiBtZXRob2QgZm9yIG1vcmUgaW5mb3JtYXRpb24uCgkgKiBAcHJvcGVydHkgX2V4dGVuc2lvbkNhbGxiYWNrcwoJICogQHR5cGUge251bGx9CgkgKiBAcHJpdmF0ZQoJICovCglwLl9leHRlbnNpb25DYWxsYmFja3MgPSBudWxsOwoKCS8qKgoJICogRGV0ZXJtaW5lcyBpZiB0aGUgbG9hZFN0YXJ0IGV2ZW50IHdhcyBkaXNwYXRjaGVkIGFscmVhZHkuIFRoaXMgZXZlbnQgaXMgb25seSBmaXJlZCBvbmUgdGltZSwgd2hlbiB0aGUgZmlyc3QKCSAqIGZpbGUgaXMgcmVxdWVzdGVkLgoJICogQHByb3BlcnR5IF9sb2FkU3RhcnRXYXNEaXNwYXRjaGVkCgkgKiBAdHlwZSB7Qm9vbGVhbn0KCSAqIEBkZWZhdWx0IGZhbHNlCgkgKiBAcHJpdmF0ZQoJICovCglwLl9sb2FkU3RhcnRXYXNEaXNwYXRjaGVkID0gZmFsc2U7CgoJLyoqCgkgKiBUaGUgbnVtYmVyIG9mIG1heGltdW0gb3BlbiBjb25uZWN0aW9ucyB0aGF0IGEgbG9hZFF1ZXVlIHRyaWVzIHRvIG1haW50YWluLiBQbGVhc2Ugc2VlCgkgKiB7eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZS9zZXRNYXhDb25uZWN0aW9ucyJ9fXt7L2Nyb3NzTGlua319IGZvciBtb3JlIGluZm9ybWF0aW9uLgoJICogQHByb3BlcnR5IF9tYXhDb25uZWN0aW9ucwoJICogQHR5cGUge051bWJlcn0KCSAqIEBkZWZhdWx0IDEKCSAqIEBwcml2YXRlCgkgKi8KCXAuX21heENvbm5lY3Rpb25zID0gMTsKCgkvKioKCSAqIERldGVybWluZXMgaWYgdGhlcmUgaXMgY3VycmVudGx5IGEgc2NyaXB0IGxvYWRpbmcuIFRoaXMgaGVscHMgZW5zdXJlIHRoYXQgb25seSBhIHNpbmdsZSBzY3JpcHQgbG9hZHMgYXQgb25jZSB3aGVuCgkgKiB1c2luZyBhIHNjcmlwdCB0YWcgdG8gZG8gcHJlbG9hZGluZy4KCSAqIEBwcm9wZXJ0eSBfY3VycmVudGx5TG9hZGluZ1NjcmlwdAoJICogQHR5cGUge0Jvb2xlYW59CgkgKiBAcHJpdmF0ZQoJICovCglwLl9jdXJyZW50bHlMb2FkaW5nU2NyaXB0ID0gbnVsbDsKCgkvKioKCSAqIEFuIGFycmF5IGNvbnRhaW5pbmcgdGhlIGN1cnJlbnRseSBkb3dubG9hZGluZyBmaWxlcy4KCSAqIEBwcm9wZXJ0eSBfY3VycmVudExvYWRzCgkgKiBAdHlwZSB7QXJyYXl9CgkgKiBAcHJpdmF0ZQoJICovCglwLl9jdXJyZW50TG9hZHMgPSBudWxsOwoKCS8qKgoJICogQW4gYXJyYXkgY29udGFpbmluZyB0aGUgcXVldWVkIGl0ZW1zIHRoYXQgaGF2ZSBub3QgeWV0IHN0YXJ0ZWQgZG93bmxvYWRpbmcuCgkgKiBAcHJvcGVydHkgX2xvYWRRdWV1ZQoJICogQHR5cGUge0FycmF5fQoJICogQHByaXZhdGUKCSAqLwoJcC5fbG9hZFF1ZXVlID0gbnVsbDsKCgkvKioKCSAqIEFuIGFycmF5IGNvbnRhaW5pbmcgZG93bmxvYWRzIHRoYXQgaGF2ZSBub3QgY29tcGxldGVkLCBzbyB0aGF0IHRoZSBMb2FkUXVldWUgY2FuIGJlIHByb3Blcmx5IHJlc2V0LgoJICogQHByb3BlcnR5IF9sb2FkUXVldWVCYWNrdXAKCSAqIEB0eXBlIHtBcnJheX0KCSAqIEBwcml2YXRlCgkgKi8KCXAuX2xvYWRRdWV1ZUJhY2t1cCA9IG51bGw7CgoJLyoqCgkgKiBBbiBvYmplY3QgaGFzaCBvZiBpdGVtcyB0aGF0IGhhdmUgZmluaXNoZWQgZG93bmxvYWRpbmcsIGluZGV4ZWQgYnkgaXRlbSBJRHMuCgkgKiBAcHJvcGVydHkgX2xvYWRJdGVtc0J5SWQKCSAqIEB0eXBlIHtPYmplY3R9CgkgKiBAcHJpdmF0ZQoJICovCglwLl9sb2FkSXRlbXNCeUlkID0gbnVsbDsKCgkvKioKCSAqIEFuIG9iamVjdCBoYXNoIG9mIGl0ZW1zIHRoYXQgaGF2ZSBmaW5pc2hlZCBkb3dubG9hZGluZywgaW5kZXhlZCBieSBpdGVtIHNvdXJjZS4KCSAqIEBwcm9wZXJ0eSBfbG9hZEl0ZW1zQnlTcmMKCSAqIEB0eXBlIHtPYmplY3R9CgkgKiBAcHJpdmF0ZQoJICovCglwLl9sb2FkSXRlbXNCeVNyYyA9IG51bGw7CgoJLyoqCgkgKiBBbiBvYmplY3QgaGFzaCBvZiBsb2FkZWQgaXRlbXMsIGluZGV4ZWQgYnkgdGhlIElEIG9mIHRoZSBsb2FkIGl0ZW0uCgkgKiBAcHJvcGVydHkgX2xvYWRlZFJlc3VsdHMKCSAqIEB0eXBlIHtPYmplY3R9CgkgKiBAcHJpdmF0ZQoJICovCglwLl9sb2FkZWRSZXN1bHRzID0gbnVsbDsKCgkvKioKCSAqIEFuIG9iamVjdCBoYXNoIG9mIHVuLXBhcnNlZCBsb2FkZWQgaXRlbXMsIGluZGV4ZWQgYnkgdGhlIElEIG9mIHRoZSBsb2FkIGl0ZW0uCgkgKiBAcHJvcGVydHkgX2xvYWRlZFJhd1Jlc3VsdHMKCSAqIEB0eXBlIHtPYmplY3R9CgkgKiBAcHJpdmF0ZQoJICovCglwLl9sb2FkZWRSYXdSZXN1bHRzID0gbnVsbDsKCgkvKioKCSAqIFRoZSBudW1iZXIgb2YgaXRlbXMgdGhhdCBoYXZlIGJlZW4gcmVxdWVzdGVkLiBUaGlzIGhlbHBzIG1hbmFnZSBhbiBvdmVyYWxsIHByb2dyZXNzIHdpdGhvdXQga25vd2luZyBob3cgbGFyZ2UKCSAqIHRoZSBmaWxlcyBhcmUgYmVmb3JlIHRoZXkgYXJlIGRvd25sb2FkZWQuCgkgKiBAcHJvcGVydHkgX251bUl0ZW1zCgkgKiBAdHlwZSB7TnVtYmVyfQoJICogQGRlZmF1bHQgMAoJICogQHByaXZhdGUKCSAqLwoJcC5fbnVtSXRlbXMgPSAwOwoKCS8qKgoJICogVGhlIG51bWJlciBvZiBpdGVtcyB0aGF0IGhhdmUgY29tcGxldGVkIGxvYWRlZC4gVGhpcyBoZWxwcyBtYW5hZ2UgYW4gb3ZlcmFsbCBwcm9ncmVzcyB3aXRob3V0IGtub3dpbmcgaG93IGxhcmdlCgkgKiB0aGUgZmlsZXMgYXJlIGJlZm9yZSB0aGV5IGFyZSBkb3dubG9hZGVkLgoJICogQHByb3BlcnR5IF9udW1JdGVtc0xvYWRlZAoJICogQHR5cGUge051bWJlcn0KCSAqIEBkZWZhdWx0IDAKCSAqIEBwcml2YXRlCgkgKi8KCXAuX251bUl0ZW1zTG9hZGVkID0gMDsKCgkvKioKCSAqIEEgbGlzdCBvZiBzY3JpcHRzIGluIHRoZSBvcmRlciB0aGV5IHdlcmUgcmVxdWVzdGVkLiBUaGlzIGhlbHBzIGVuc3VyZSB0aGF0IHNjcmlwdHMgYXJlICJjb21wbGV0ZWQiIGluIHRoZSByaWdodAoJICogb3JkZXIuCgkgKiBAcHJvcGVydHkgX3NjcmlwdE9yZGVyCgkgKiBAdHlwZSB7QXJyYXl9CgkgKiBAcHJpdmF0ZQoJICovCglwLl9zY3JpcHRPcmRlciA9IG51bGw7CgoJLyoqCgkgKiBBIGxpc3Qgb2Ygc2NyaXB0cyB0aGF0IGhhdmUgYmVlbiBsb2FkZWQuIEl0ZW1zIGFyZSBhZGRlZCB0byB0aGlzIGxpc3QgYXMgPGNvZGU+bnVsbDwvY29kZT4gd2hlbiB0aGV5IGFyZQoJICogcmVxdWVzdGVkLCBjb250YWluIHRoZSBsb2FkZWQgaXRlbSBpZiBpdCBoYXMgY29tcGxldGVkLCBidXQgbm90IGJlZW4gZGlzcGF0Y2hlZCB0byB0aGUgdXNlciwgYW5kIDxjb2RlPnRydWU8L3RydWU+CgkgKiBvbmNlIHRoZXkgYXJlIGNvbXBsZXRlIGFuZCBoYXZlIGJlZW4gZGlzcGF0Y2hlZC4KCSAqIEBwcm9wZXJ0eSBfbG9hZGVkU2NyaXB0cwoJICogQHR5cGUge0FycmF5fQoJICogQHByaXZhdGUKCSAqLwoJcC5fbG9hZGVkU2NyaXB0cyA9IG51bGw7CgoJLy8gT3ZlcnJpZGVzIGFic3RyYWN0IG1ldGhvZCBpbiBBYnN0cmFjdExvYWRlcgoJcC5pbml0ID0gZnVuY3Rpb24odXNlWEhSLCBiYXNlUGF0aCwgY3Jvc3NPcmlnaW4pIHsKCQl0aGlzLl9udW1JdGVtcyA9IHRoaXMuX251bUl0ZW1zTG9hZGVkID0gMDsKCQl0aGlzLl9wYXVzZWQgPSBmYWxzZTsKCQl0aGlzLl9sb2FkU3RhcnRXYXNEaXNwYXRjaGVkID0gZmFsc2U7CgoJCXRoaXMuX2N1cnJlbnRMb2FkcyA9IFtdOwoJCXRoaXMuX2xvYWRRdWV1ZSA9IFtdOwoJCXRoaXMuX2xvYWRRdWV1ZUJhY2t1cCA9IFtdOwoJCXRoaXMuX3NjcmlwdE9yZGVyID0gW107CgkJdGhpcy5fbG9hZGVkU2NyaXB0cyA9IFtdOwoJCXRoaXMuX2xvYWRJdGVtc0J5SWQgPSB7fTsKCQl0aGlzLl9sb2FkSXRlbXNCeVNyYyA9IHt9OwoJCXRoaXMuX2xvYWRlZFJlc3VsdHMgPSB7fTsKCQl0aGlzLl9sb2FkZWRSYXdSZXN1bHRzID0ge307CgoJCS8vIENhbGxiYWNrcyBmb3IgcGx1Z2lucwoJCXRoaXMuX3R5cGVDYWxsYmFja3MgPSB7fTsKCQl0aGlzLl9leHRlbnNpb25DYWxsYmFja3MgPSB7fTsKCgkJdGhpcy5fYmFzZVBhdGggPSBiYXNlUGF0aDsKCQl0aGlzLnNldFVzZVhIUih1c2VYSFIpOwoJCXRoaXMuX2Nyb3NzT3JpZ2luID0gKGNyb3NzT3JpZ2luID09PSB0cnVlKQoJCQkJPyAiQW5vbnltb3VzIiA6IChjcm9zc09yaWdpbiA9PT0gZmFsc2UgfHwgY3Jvc3NPcmlnaW4gPT0gbnVsbCkKCQkJCT8gIiIgOiBjcm9zc09yaWdpbjsKCX07CgoJLyoqCgkgKiBDaGFuZ2UgdGhlIHVzWEhSIHZhbHVlLiBOb3RlIHRoYXQgaWYgdGhpcyBpcyBzZXQgdG8gdHJ1ZSwgaXQgbWF5IGZhaWwgZGVwZW5kaW5nIG9uIHRoZSBicm93c2VyJ3MgY2FwYWJpbGl0aWVzLgoJICogQWRkaXRpb25hbGx5LCBzb21lIGZpbGVzIHJlcXVpcmUgWEhSIGluIG9yZGVyIHRvIGxvYWQsIHN1Y2ggYXMgSlNPTiAod2l0aG91dCBKU09OUCksIFRleHQsIGFuZCBYTUwsIHNvIFhIUiB3aWxsCgkgKiBiZSB1c2VkIHJlZ2FyZGxlc3Mgb2Ygd2hhdCBpcyBwYXNzZWQgdG8gdGhpcyBtZXRob2QuCgkgKiBAbWV0aG9kIHNldFVzZVhIUgoJICogQHBhcmFtIHtCb29sZWFufSB2YWx1ZSBUaGUgbmV3IHVzZVhIUiB2YWx1ZSB0byBzZXQuCgkgKiBAcmV0dXJuIHtCb29sZWFufSBUaGUgbmV3IHVzZVhIUiB2YWx1ZS4gSWYgWEhSIGlzIG5vdCBzdXBwb3J0ZWQgYnkgdGhlIGJyb3dzZXIsIHRoaXMgd2lsbCByZXR1cm4gZmFsc2UsIGV2ZW4gaWYKCSAqIHRoZSBwcm92aWRlZCB2YWx1ZSBhcmd1bWVudCB3YXMgdHJ1ZS4KCSAqIEBzaW5jZSAwLjMuMAoJICovCglwLnNldFVzZVhIUiA9IGZ1bmN0aW9uKHZhbHVlKSB7CgkJLy8gRGV0ZXJtaW5lIGlmIHdlIGNhbiB1c2UgWEhSLiBYSFIgZGVmYXVsdHMgdG8gVFJVRSwgYnV0IHRoZSBicm93c2VyIG1heSBub3Qgc3VwcG9ydCBpdC4KCQkvL1RPRE86IFNob3VsZCB3ZSBiZSBjaGVja2luZyBmb3IgdGhlIG90aGVyIFhIUiB0eXBlcz8gTWlnaHQgaGF2ZSB0byBkbyBhIHRyeS9jYXRjaCBvbiB0aGUgZGlmZmVyZW50IHR5cGVzIHNpbWlsYXIgdG8gY3JlYXRlWEhSLgoJCXRoaXMudXNlWEhSID0gKHZhbHVlICE9IGZhbHNlICYmIHdpbmRvdy5YTUxIdHRwUmVxdWVzdCAhPSBudWxsKTsKCQlyZXR1cm4gdGhpcy51c2VYSFI7Cgl9OwoKCS8qKgoJICogU3RvcHMgYWxsIHF1ZXVlZCBhbmQgbG9hZGluZyBpdGVtcywgYW5kIGNsZWFycyB0aGUgcXVldWUuIFRoaXMgYWxzbyByZW1vdmVzIGFsbCBpbnRlcm5hbCByZWZlcmVuY2VzIHRvIGxvYWRlZAoJICogY29udGVudCwgYW5kIGFsbG93cyB0aGUgcXVldWUgdG8gYmUgdXNlZCBhZ2Fpbi4KCSAqIEBtZXRob2QgcmVtb3ZlQWxsCgkgKiBAc2luY2UgMC4zLjAKCSAqLwoJcC5yZW1vdmVBbGwgPSBmdW5jdGlvbigpIHsKCQl0aGlzLnJlbW92ZSgpOwoJfTsKCgkvKioKCSAqIFN0b3BzIGFuIGl0ZW0gZnJvbSBiZWluZyBsb2FkZWQsIGFuZCByZW1vdmVzIGl0IGZyb20gdGhlIHF1ZXVlLiBJZiBub3RoaW5nIGlzIHBhc3NlZCwgYWxsIGl0ZW1zIGFyZSByZW1vdmVkLgoJICogVGhpcyBhbHNvIHJlbW92ZXMgaW50ZXJuYWwgcmVmZXJlbmNlcyB0byBsb2FkZWQgaXRlbShzKS4KCSAqCgkgKiA8aDQ+RXhhbXBsZTwvaDQ+CgkgKgoJICogICAgICBxdWV1ZS5sb2FkTWFuaWZlc3QoWwoJICogICAgICAgICAge3NyYzoidGVzdC5wbmciLCBpZDoicG5nIn0sCgkgKiAgICAgICAgICB7c3JjOiJ0ZXN0LmpwZyIsIGlkOiJqcGcifSwKCSAqICAgICAgICAgIHtzcmM6InRlc3QubXAzIiwgaWQ6Im1wMyJ9CgkgKiAgICAgIF0pOwoJICogICAgICBxdWV1ZS5yZW1vdmUoInBuZyIpOyAvLyBTaW5nbGUgaXRlbSBieSBJRAoJICogICAgICBxdWV1ZS5yZW1vdmUoInBuZyIsICJ0ZXN0LmpwZyIpOyAvLyBJdGVtcyBhcyBhcmd1bWVudHMuIE1peGVkIGlkIGFuZCBzcmMuCgkgKiAgICAgIHF1ZXVlLnJlbW92ZShbInRlc3QucG5nIiwgImpwZyJdKTsgLy8gSXRlbXMgaW4gYW4gQXJyYXkuIE1peGVkIGlkIGFuZCBzcmMuCgkgKgoJICogQG1ldGhvZCByZW1vdmUKCSAqIEBwYXJhbSB7U3RyaW5nIHwgQXJyYXl9IGlkc09yVXJscyogVGhlIGlkIG9yIGlkcyB0byByZW1vdmUgZnJvbSB0aGlzIHF1ZXVlLiBZb3UgY2FuIHBhc3MgYW4gaXRlbSwgYW4gYXJyYXkgb2YKCSAqIGl0ZW1zLCBvciBtdWx0aXBsZSBpdGVtcyBhcyBhcmd1bWVudHMuCgkgKiBAc2luY2UgMC4zLjAKCSAqLwoJcC5yZW1vdmUgPSBmdW5jdGlvbihpZHNPclVybHMpIHsKCQl2YXIgYXJncyA9IG51bGw7CgoJCWlmIChpZHNPclVybHMgJiYgIShpZHNPclVybHMgaW5zdGFuY2VvZiBBcnJheSkpIHsKCQkJYXJncyA9IFtpZHNPclVybHNdOwoJCX0gZWxzZSBpZiAoaWRzT3JVcmxzKSB7CgkJCWFyZ3MgPSBpZHNPclVybHM7CgkJfSBlbHNlIGlmIChhcmd1bWVudHMubGVuZ3RoID4gMCkgewoJCQlyZXR1cm47CgkJfQoKCQl2YXIgaXRlbXNXZXJlUmVtb3ZlZCA9IGZhbHNlOwoKCQkvLyBEZXN0cm95IGV2ZXJ5dGhpbmcKCQlpZiAoIWFyZ3MpIHsKCQkJdGhpcy5jbG9zZSgpOwoJCQlmb3IgKHZhciBuIGluIHRoaXMuX2xvYWRJdGVtc0J5SWQpIHsKCQkJCXRoaXMuX2Rpc3Bvc2VJdGVtKHRoaXMuX2xvYWRJdGVtc0J5SWRbbl0pOwoJCQl9CgkJCXRoaXMuaW5pdCh0aGlzLnVzZVhIUik7CgoJCS8vIFJlbW92ZSBzcGVjaWZpYyBpdGVtcwoJCX0gZWxzZSB7CgkJCXdoaWxlIChhcmdzLmxlbmd0aCkgewoJCQkJdmFyIGl0ZW0gPSBhcmdzLnBvcCgpOwoJCQkJdmFyIHIgPSB0aGlzLmdldFJlc3VsdChpdGVtKTsKCgkJCQkvL1JlbW92ZSBmcm9tIHRoZSBtYWluIGxvYWQgUXVldWUKCQkJCWZvciAoaSA9IHRoaXMuX2xvYWRRdWV1ZS5sZW5ndGgtMTtpPj0wO2ktLSkgewoJCQkJCWxvYWRJdGVtID0gdGhpcy5fbG9hZFF1ZXVlW2ldLmdldEl0ZW0oKTsKCQkJCQlpZiAobG9hZEl0ZW0uaWQgPT0gaXRlbSB8fCBsb2FkSXRlbS5zcmMgPT0gaXRlbSkgewoJCQkJCQl0aGlzLl9sb2FkUXVldWUuc3BsaWNlKGksMSlbMF0uY2FuY2VsKCk7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCQkJCX0KCgkJCQkvL1JlbW92ZSBmcm9tIHRoZSBiYWNrdXAgcXVldWUKCQkJCWZvciAoaSA9IHRoaXMuX2xvYWRRdWV1ZUJhY2t1cC5sZW5ndGgtMTtpPj0wO2ktLSkgewoJCQkJCWxvYWRJdGVtID0gdGhpcy5fbG9hZFF1ZXVlQmFja3VwW2ldLmdldEl0ZW0oKTsKCQkJCQlpZiAobG9hZEl0ZW0uaWQgPT0gaXRlbSB8fCBsb2FkSXRlbS5zcmMgPT0gaXRlbSkgewoJCQkJCQl0aGlzLl9sb2FkUXVldWVCYWNrdXAuc3BsaWNlKGksMSlbMF0uY2FuY2VsKCk7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCQkJCX0KCgkJCQlpZiAocikgewoJCQkJCWRlbGV0ZSB0aGlzLl9sb2FkSXRlbXNCeUlkW3IuaWRdOwoJCQkJCWRlbGV0ZSB0aGlzLl9sb2FkSXRlbXNCeVNyY1tyLnNyY107CgkJCQkJdGhpcy5fZGlzcG9zZUl0ZW0ocik7CgkJCQl9IGVsc2UgewoJCQkJCWZvciAodmFyIGk9dGhpcy5fY3VycmVudExvYWRzLmxlbmd0aC0xO2k+PTA7aS0tKSB7CgkJCQkJCXZhciBsb2FkSXRlbSA9IHRoaXMuX2N1cnJlbnRMb2Fkc1tpXS5nZXRJdGVtKCk7CgkJCQkJCWlmIChsb2FkSXRlbS5pZCA9PSBpdGVtIHx8IGxvYWRJdGVtLnNyYyA9PSBpdGVtKSB7CgkJCQkJCQl0aGlzLl9jdXJyZW50TG9hZHMuc3BsaWNlKGksMSlbMF0uY2FuY2VsKCk7CgkJCQkJCQlpdGVtc1dlcmVSZW1vdmVkID0gdHJ1ZTsKCQkJCQkJCWJyZWFrOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgoJCQkvLyBJZiB0aGlzIHdhcyBjYWxsZWQgZHVyaW5nIGEgbG9hZCwgdHJ5IHRvIGxvYWQgdGhlIG5leHQgaXRlbS4KCQkJaWYgKGl0ZW1zV2VyZVJlbW92ZWQpIHsKCQkJCXRoaXMuX2xvYWROZXh0KCk7CgkJCX0KCQl9Cgl9OwoKCS8qKgoJICogU3RvcHMgYWxsIG9wZW4gbG9hZHMsIGRlc3Ryb3lzIGFueSBsb2FkZWQgaXRlbXMsIGFuZCByZXNldHMgdGhlIHF1ZXVlLCBzbyBhbGwgaXRlbXMgY2FuCgkgKiBiZSByZWxvYWRlZCBhZ2FpbiBieSBjYWxsaW5nIHt7I2Nyb3NzTGluayAiQWJzdHJhY3RMb2FkZXIvbG9hZCJ9fXt7L2Nyb3NzTGlua319LiBJdGVtcyBhcmUgbm90IHJlbW92ZWQgZnJvbSB0aGUKCSAqIHF1ZXVlLiBUbyByZW1vdmUgaXRlbXMgdXNlIHRoZSB7eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZS9yZW1vdmUifX17ey9jcm9zc0xpbmt9fSBvcgoJICoge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvcmVtb3ZlQWxsIn19e3svY3Jvc3NMaW5rfX0gbWV0aG9kLgoJICogQG1ldGhvZCByZXNldAoJICogQHNpbmNlIDAuMy4wCgkgKi8KCXAucmVzZXQgPSBmdW5jdGlvbigpIHsKCQl0aGlzLmNsb3NlKCk7CgkJZm9yICh2YXIgbiBpbiB0aGlzLl9sb2FkSXRlbXNCeUlkKSB7CgkJCXRoaXMuX2Rpc3Bvc2VJdGVtKHRoaXMuX2xvYWRJdGVtc0J5SWRbbl0pOwoJCX0KCgkJLy9SZXNldCB0aGUgcXVldWUgdG8gaXRzIHN0YXJ0IHN0YXRlCgkJdmFyIGEgPSBbXTsKCQlmb3IgKHZhciBpPTAsIGw9dGhpcy5fbG9hZFF1ZXVlQmFja3VwLmxlbmd0aDsgaTxsOyBpKyspIHsKCQkJYS5wdXNoKHRoaXMuX2xvYWRRdWV1ZUJhY2t1cFtpXS5nZXRJdGVtKCkpOwoJCX0KCgkJdGhpcy5sb2FkTWFuaWZlc3QoYSwgZmFsc2UpOwoJfTsKCgkvKioKCSAqIERldGVybWluZSBpZiBhIHNwZWNpZmljIHR5cGUgc2hvdWxkIGJlIGxvYWRlZCBhcyBhIGJpbmFyeSBmaWxlLiBDdXJyZW50bHksIG9ubHkgaW1hZ2VzIGFuZCBpdGVtcyBtYXJrZWQKCSAqIHNwZWNpZmljYWxseSBhcyAiYmluYXJ5IiBhcmUgbG9hZGVkIGFzIGJpbmFyeS4gTm90ZSB0aGF0IGF1ZGlvIGlzIDxiPm5vdDwvYj4gYSBiaW5hcnkgdHlwZSwgYXMgd2UgY2FuIG5vdCBwbGF5CgkgKiBiYWNrIHVzaW5nIGFuIGF1ZGlvIHRhZyBpZiBpdCBpcyBsb2FkZWQgYXMgYmluYXJ5LiBQbHVnaW5zIGNhbiBjaGFuZ2UgdGhlIGl0ZW0gdHlwZSB0byBiaW5hcnkgdG8gZW5zdXJlIHRoZXkgZ2V0CgkgKiBhIGJpbmFyeSByZXN1bHQgdG8gd29yayB3aXRoLiBCaW5hcnkgZmlsZXMgYXJlIGxvYWRlZCB1c2luZyBYSFIyLgoJICogQG1ldGhvZCBpc0JpbmFyeQoJICogQHBhcmFtIHtTdHJpbmd9IHR5cGUgVGhlIGl0ZW0gdHlwZS4KCSAqIEByZXR1cm4ge0Jvb2xlYW59IElmIHRoZSBzcGVjaWZpZWQgdHlwZSBpcyBiaW5hcnkuCgkgKiBAcHJpdmF0ZQoJICovCglzLmlzQmluYXJ5ID0gZnVuY3Rpb24odHlwZSkgewoJCXN3aXRjaCAodHlwZSkgewoJCQljYXNlIGNyZWF0ZWpzLkxvYWRRdWV1ZS5JTUFHRToKCQkJY2FzZSBjcmVhdGVqcy5Mb2FkUXVldWUuQklOQVJZOgoJCQkJcmV0dXJuIHRydWU7CgkJCWRlZmF1bHQ6CgkJCQlyZXR1cm4gZmFsc2U7CgkJfQoJfTsKCgoJLyoqCgkgKiBEZXRlcm1pbmUgaWYgYSBzcGVjaWZpYyB0eXBlIGlzIGEgdGV4dCBiYXNlZCBhc3NldCwgYW5kIHNob3VsZCBiZSBsb2FkZWQgYXMgVVRGLTguCgkgKiBAbWV0aG9kIGlzVGV4dAoJICogQHBhcmFtIHtTdHJpbmd9IHR5cGUgVGhlIGl0ZW0gdHlwZS4KCSAqIEByZXR1cm4ge0Jvb2xlYW59IElmIHRoZSBzcGVjaWZpZWQgdHlwZSBpcyB0ZXh0LgoJICogQHByaXZhdGUKCSAqLwoJcy5pc1RleHQgPSBmdW5jdGlvbih0eXBlKSB7CgkJc3dpdGNoICh0eXBlKSB7CgkJCWNhc2UgY3JlYXRlanMuTG9hZFF1ZXVlLlRFWFQ6CgkJCWNhc2UgY3JlYXRlanMuTG9hZFF1ZXVlLkpTT046CgkJCWNhc2UgY3JlYXRlanMuTG9hZFF1ZXVlLk1BTklGRVNUOgoJCQljYXNlIGNyZWF0ZWpzLkxvYWRRdWV1ZS5YTUw6CgkJCWNhc2UgY3JlYXRlanMuTG9hZFF1ZXVlLkhUTUw6CgkJCWNhc2UgY3JlYXRlanMuTG9hZFF1ZXVlLkNTUzoKCQkJY2FzZSBjcmVhdGVqcy5Mb2FkUXVldWUuU1ZHOgoJCQljYXNlIGNyZWF0ZWpzLkxvYWRRdWV1ZS5KQVZBU0NSSVBUOgoJCQkJcmV0dXJuIHRydWU7CgkJCWRlZmF1bHQ6CgkJCQlyZXR1cm4gZmFsc2U7CgkJfQoJfTsKCgkvKioKCSAqIFJlZ2lzdGVyIGEgcGx1Z2luLiBQbHVnaW5zIGNhbiBtYXAgdG8gbG9hZCB0eXBlcyAoc291bmQsIGltYWdlLCBldGMpLCBvciBzcGVjaWZpYyBleHRlbnNpb25zIChwbmcsIG1wMywgZXRjKS4KCSAqIEN1cnJlbnRseSwgb25seSBvbmUgcGx1Z2luIGNhbiBleGlzdCBwZXIgdHlwZS9leHRlbnNpb24uCgkgKgoJICogV2hlbiBhIHBsdWdpbiBpcyBpbnN0YWxsZWQsIGEgPGNvZGU+Z2V0UHJlbG9hZEhhbmRsZXJzKCk8L2NvZGU+IG1ldGhvZCB3aWxsIGJlIGNhbGxlZCBvbiBpdC4gRm9yIG1vcmUgaW5mb3JtYXRpb24KCSAqIG9uIHRoaXMgbWV0aG9kLCBjaGVjayBvdXQgdGhlIHt7I2Nyb3NzTGluayAiU2FtcGxlUGx1Z2luL2dldFByZWxvYWRIYW5kbGVycyJ9fXt7L2Nyb3NzTGlua319IG1ldGhvZCBpbiB0aGUKCSAqIHt7I2Nyb3NzTGluayAiU2FtcGxlUGx1Z2luIn19e3svY3Jvc3NMaW5rfX0gY2xhc3MuCgkgKgoJICogQmVmb3JlIGEgZmlsZSBpcyBsb2FkZWQsIGEgbWF0Y2hpbmcgcGx1Z2luIGhhcyBhbiBvcHBvcnR1bml0eSB0byBtb2RpZnkgdGhlIGxvYWQuIElmIGEgYGNhbGxiYWNrYCBpcyByZXR1cm5lZAoJICogZnJvbSB0aGUge3sjY3Jvc3NMaW5rICJTYW1wbGVQbHVnaW4vZ2V0UHJlbG9hZEhhbmRsZXJzIn19e3svY3Jvc3NMaW5rfX0gbWV0aG9kLCBpdCB3aWxsIGJlIGludm9rZWQgZmlyc3QsIGFuZCBpdHMKCSAqIHJlc3VsdCBtYXkgY2FuY2VsIG9yIG1vZGlmeSB0aGUgaXRlbS4gVGhlIGNhbGxiYWNrIG1ldGhvZCBjYW4gYWxzbyByZXR1cm4gYSBgY29tcGxldGVIYW5kbGVyYCB0byBiZSBmaXJlZCB3aGVuCgkgKiB0aGUgZmlsZSBpcyBsb2FkZWQsIG9yIGEgYHRhZ2Agb2JqZWN0LCB3aGljaCB3aWxsIG1hbmFnZSB0aGUgYWN0dWFsIGRvd25sb2FkLiBGb3IgbW9yZSBpbmZvcm1hdGlvbiBvbiB0aGVzZQoJICogbWV0aG9kcywgY2hlY2sgb3V0IHRoZSB7eyNjcm9zc0xpbmsgIlNhbXBsZVBsdWdpbi9wcmVsb2FkSGFuZGxlciJ9fXt7L2Nyb3NzTGlua319IGFuZCB7eyNjcm9zc0xpbmsgIlNhbXBsZVBsdWdpbi9maWxlTG9hZEhhbmRsZXIifX17ey9jcm9zc0xpbmt9fQoJICogbWV0aG9kcyBvbiB0aGUge3sjY3Jvc3NMaW5rICJTYW1wbGVQbHVnaW4ifX17ey9jcm9zc0xpbmt9fS4KCSAqCgkgKiBAbWV0aG9kIGluc3RhbGxQbHVnaW4KCSAqIEBwYXJhbSB7RnVuY3Rpb259IHBsdWdpbiBUaGUgcGx1Z2luIGNsYXNzIHRvIGluc3RhbGwuCgkgKi8KCXAuaW5zdGFsbFBsdWdpbiA9IGZ1bmN0aW9uKHBsdWdpbikgewoJCWlmIChwbHVnaW4gPT0gbnVsbCB8fCBwbHVnaW4uZ2V0UHJlbG9hZEhhbmRsZXJzID09IG51bGwpIHsgcmV0dXJuOyB9CgkJdmFyIG1hcCA9IHBsdWdpbi5nZXRQcmVsb2FkSGFuZGxlcnMoKTsKCQltYXAuc2NvcGUgPSBwbHVnaW47CgoJCWlmIChtYXAudHlwZXMgIT0gbnVsbCkgewoJCQlmb3IgKHZhciBpPTAsIGw9bWFwLnR5cGVzLmxlbmd0aDsgaTxsOyBpKyspIHsKCQkJCXRoaXMuX3R5cGVDYWxsYmFja3NbbWFwLnR5cGVzW2ldXSA9IG1hcDsKCQkJfQoJCX0KCQlpZiAobWFwLmV4dGVuc2lvbnMgIT0gbnVsbCkgewoJCQlmb3IgKGk9MCwgbD1tYXAuZXh0ZW5zaW9ucy5sZW5ndGg7IGk8bDsgaSsrKSB7CgkJCQl0aGlzLl9leHRlbnNpb25DYWxsYmFja3NbbWFwLmV4dGVuc2lvbnNbaV1dID0gbWFwOwoJCQl9CgkJfQoJfTsKCgkvKioKCSAqIFNldCB0aGUgbWF4aW11bSBudW1iZXIgb2YgY29uY3VycmVudCBjb25uZWN0aW9ucy4gTm90ZSB0aGF0IGJyb3dzZXJzIGFuZCBzZXJ2ZXJzIG1heSBoYXZlIGEgYnVpbHQtaW4gbWF4aW11bQoJICogbnVtYmVyIG9mIG9wZW4gY29ubmVjdGlvbnMsIHNvIGFueSBhZGRpdGlvbmFsIGNvbm5lY3Rpb25zIG1heSByZW1haW4gaW4gYSBwZW5kaW5nIHN0YXRlIHVudGlsIHRoZSBicm93c2VyCgkgKiBvcGVucyB0aGUgY29ubmVjdGlvbi4gV2hlbiBsb2FkaW5nIHNjcmlwdHMgdXNpbmcgdGFncywgYW5kIHdoZW4ge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvbWFpbnRhaW5TY3JpcHRPcmRlcjpwcm9wZXJ0eSJ9fXt7L2Nyb3NzTGlua319CgkgKiBpcyBgdHJ1ZWAsIG9ubHkgb25lIHNjcmlwdCBpcyBsb2FkZWQgYXQgYSB0aW1lIGR1ZSB0byBicm93c2VyIGxpbWl0YXRpb25zLgoJICoKCSAqIDxoND5FeGFtcGxlPC9oND4KCSAqCgkgKiAgICAgIHZhciBxdWV1ZSA9IG5ldyBjcmVhdGVqcy5Mb2FkUXVldWUoKTsKCSAqICAgICAgcXVldWUuc2V0TWF4Q29ubmVjdGlvbnMoMTApOyAvLyBBbGxvdyAxMCBjb25jdXJyZW50IGxvYWRzCgkgKgoJICogQG1ldGhvZCBzZXRNYXhDb25uZWN0aW9ucwoJICogQHBhcmFtIHtOdW1iZXJ9IHZhbHVlIFRoZSBudW1iZXIgb2YgY29uY3VycmVudCBsb2FkcyB0byBhbGxvdy4gQnkgZGVmYXVsdCwgb25seSBhIHNpbmdsZSBjb25uZWN0aW9uIHBlciBMb2FkUXVldWUKCSAqIGlzIG9wZW4gYXQgYW55IHRpbWUuCgkgKi8KCXAuc2V0TWF4Q29ubmVjdGlvbnMgPSBmdW5jdGlvbiAodmFsdWUpIHsKCQl0aGlzLl9tYXhDb25uZWN0aW9ucyA9IHZhbHVlOwoJCWlmICghdGhpcy5fcGF1c2VkICYmIHRoaXMuX2xvYWRRdWV1ZS5sZW5ndGggPiAwKSB7CgkJCXRoaXMuX2xvYWROZXh0KCk7CgkJfQoJfTsKCgkvKioKCSAqIExvYWQgYSBzaW5nbGUgZmlsZS4gVG8gYWRkIG11bHRpcGxlIGZpbGVzIGF0IG9uY2UsIHVzZSB0aGUge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvbG9hZE1hbmlmZXN0In19e3svY3Jvc3NMaW5rfX0KCSAqIG1ldGhvZC4KCSAqCgkgKiBGaWxlcyBhcmUgYWx3YXlzIGFwcGVuZGVkIHRvIHRoZSBjdXJyZW50IHF1ZXVlLCBzbyB0aGlzIG1ldGhvZCBjYW4gYmUgdXNlZCBtdWx0aXBsZSB0aW1lcyB0byBhZGQgZmlsZXMuCgkgKiBUbyBjbGVhciB0aGUgcXVldWUgZmlyc3QsIHVzZSB0aGUge3sjY3Jvc3NMaW5rICJBYnN0cmFjdExvYWRlci9jbG9zZSJ9fXt7L2Nyb3NzTGlua319IG1ldGhvZC4KCSAqIEBtZXRob2QgbG9hZEZpbGUKCSAqIEBwYXJhbSB7T2JqZWN0IHwgU3RyaW5nfSBmaWxlIFRoZSBmaWxlIG9iamVjdCBvciBwYXRoIHRvIGxvYWQuIEEgZmlsZSBjYW4gYmUgZWl0aGVyCiAgICAgKiA8dWw+CiAgICAgKiAgICAgPGxpPkEgc3RyaW5nIHBhdGggdG8gYSByZXNvdXJjZS4gTm90ZSB0aGF0IHRoaXMga2luZCBvZiBsb2FkIGl0ZW0gd2lsbCBiZSBjb252ZXJ0ZWQgdG8gYW4gb2JqZWN0IChzZWUgYmVsb3cpCgkgKiAgICAgaW4gdGhlIGJhY2tncm91bmQuPC9saT4KICAgICAqICAgICA8bGk+T1IgYW4gb2JqZWN0IHRoYXQgY29udGFpbnM6PHVsPgogICAgICogICAgICAgICA8bGk+c3JjOiBUaGUgc291cmNlIG9mIHRoZSBmaWxlIHRoYXQgaXMgYmVpbmcgbG9hZGVkLiBUaGlzIHByb3BlcnR5IGlzIDxiPnJlcXVpcmVkPC9iPi4gVGhlIHNvdXJjZSBjYW4KCSAqICAgICAgICAgZWl0aGVyIGJlIGEgc3RyaW5nIChyZWNvbW1lbmRlZCksIG9yIGFuIEhUTUwgdGFnLjwvbGk+CiAgICAgKiAgICAgICAgIDxsaT50eXBlOiBUaGUgdHlwZSBvZiBmaWxlIHRoYXQgd2lsbCBiZSBsb2FkZWQgKGltYWdlLCBzb3VuZCwganNvbiwgZXRjKS4gUHJlbG9hZEpTIGRvZXMgYXV0by1kZXRlY3Rpb24KCSAqICAgICAgICAgb2YgdHlwZXMgdXNpbmcgdGhlIGV4dGVuc2lvbi4gU3VwcG9ydGVkIHR5cGVzIGFyZSBkZWZpbmVkIG9uIExvYWRRdWV1ZSwgc3VjaCBhcyA8Y29kZT5Mb2FkUXVldWUuSU1BR0U8L2NvZGU+LgoJICogICAgICAgICBJdCBpcyByZWNvbW1lbmRlZCB0aGF0IGEgdHlwZSBpcyBzcGVjaWZpZWQgd2hlbiBhIG5vbi1zdGFuZGFyZCBmaWxlIFVSSSAoc3VjaCBhcyBhIHBocCBzY3JpcHQpIHVzIHVzZWQuPC9saT4KICAgICAqICAgICAgICAgPGxpPmlkOiBBIHN0cmluZyBpZGVudGlmaWVyIHdoaWNoIGNhbiBiZSB1c2VkIHRvIHJlZmVyZW5jZSB0aGUgbG9hZGVkIG9iamVjdC48L2xpPgoJICogICAgICAgICA8bGk+Y2FsbGJhY2s6IE9wdGlvbmFsLCB1c2VkIGZvciBKU09OUCByZXF1ZXN0cywgdG8gZGVmaW5lIHdoYXQgbWV0aG9kIHRvIGNhbGwgd2hlbiB0aGUgSlNPTlAgaXMgbG9hZGVkLjwvbGk+CiAgICAgKiAgICAgICAgIDxsaT5kYXRhOiBBbiBhcmJpdHJhcnkgZGF0YSBvYmplY3QsIHdoaWNoIGlzIGluY2x1ZGVkIHdpdGggdGhlIGxvYWRlZCBvYmplY3Q8L2xpPgoJICogICAgICAgICA8bGk+bWV0aG9kOiB1c2VkIHRvIGRlZmluZSBpZiB0aGlzIHJlcXVlc3QgdXNlcyBHRVQgb3IgUE9TVCB3aGVuIHNlbmRpbmcgZGF0YSB0byB0aGUgc2VydmVyLiBUaGUgZGVmYXVsdAoJICogICAgICAgICB2YWx1ZSBpcyAiR0VUIjwvbGk+CgkgKiAgICAgICAgIDxsaT52YWx1ZXM6IE9wdGlvbmFsIG9iamVjdCBvZiBuYW1lL3ZhbHVlIHBhaXJzIHRvIHNlbmQgdG8gdGhlIHNlcnZlci48L2xpPgogICAgICogICAgIDwvdWw+CiAgICAgKiA8L3VsPgoJICogQHBhcmFtIHtCb29sZWFufSBbbG9hZE5vdz10cnVlXSBLaWNrIG9mZiBhbiBpbW1lZGlhdGUgbG9hZCAodHJ1ZSkgb3Igd2FpdCBmb3IgYSBsb2FkIGNhbGwgKGZhbHNlKS4gVGhlIGRlZmF1bHQKCSAqIHZhbHVlIGlzIHRydWUuIElmIHRoZSBxdWV1ZSBpcyBwYXVzZWQgdXNpbmcge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvc2V0UGF1c2VkIn19e3svY3Jvc3NMaW5rfX0sIGFuZCB0aGUgdmFsdWUgaXMKCSAqIGB0cnVlYCwgdGhlIHF1ZXVlIHdpbGwgcmVzdW1lIGF1dG9tYXRpY2FsbHkuCgkgKiBAcGFyYW0ge1N0cmluZ30gW2Jhc2VQYXRoXSBBIGJhc2UgcGF0aCB0aGF0IHdpbGwgYmUgcHJlcGVuZGVkIHRvIGVhY2ggZmlsZS4gVGhlIGJhc2VQYXRoIGFyZ3VtZW50IG92ZXJyaWRlcyB0aGUKCSAqIHBhdGggc3BlY2lmaWVkIGluIHRoZSBjb25zdHJ1Y3Rvci4gTm90ZSB0aGF0IGlmIHlvdSBsb2FkIGEgbWFuaWZlc3QgdXNpbmcgYSBmaWxlIG9mIHR5cGUge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvTUFOSUZFU1Q6cHJvcGVydHkifX17ey9jcm9zc0xpbmt9fSwKCSAqIGl0cyBmaWxlcyB3aWxsIDxzdHJvbmc+Tk9UPC9zdHJvbmc+IHVzZSB0aGUgYmFzZVBhdGggcGFyYW1ldGVyLiA8c3Ryb25nPlRoZSBiYXNlUGF0aCBwYXJhbWV0ZXIgaXMgZGVwcmVjYXRlZC48L3N0cm9uZz4KCSAqIFRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgcmVtb3ZlZCBpbiBhIGZ1dHVyZSB2ZXJzaW9uLiBQbGVhc2UgZWl0aGVyIHVzZSB0aGUgYGJhc2VQYXRoYCBwYXJhbWV0ZXIgaW4gdGhlIExvYWRRdWV1ZQoJICogY29uc3RydWN0b3IsIG9yIGEgYHBhdGhgIHByb3BlcnR5IGluIGEgbWFuaWZlc3QgZGVmaW5pdGlvbi4KCSAqLwoJcC5sb2FkRmlsZSA9IGZ1bmN0aW9uKGZpbGUsIGxvYWROb3csIGJhc2VQYXRoKSB7CgkJaWYgKGZpbGUgPT0gbnVsbCkgewoJCQl2YXIgZXZlbnQgPSBuZXcgY3JlYXRlanMuRXZlbnQoImVycm9yIik7CgkJCWV2ZW50LnRleHQgPSAiUFJFTE9BRF9OT19GSUxFIjsKCQkJdGhpcy5fc2VuZEVycm9yKGV2ZW50KTsKCQkJcmV0dXJuOwoJCX0KCQl0aGlzLl9hZGRJdGVtKGZpbGUsIG51bGwsIGJhc2VQYXRoKTsKCgkJaWYgKGxvYWROb3cgIT09IGZhbHNlKSB7CgkJCXRoaXMuc2V0UGF1c2VkKGZhbHNlKTsKCQl9IGVsc2UgewoJCQl0aGlzLnNldFBhdXNlZCh0cnVlKTsKCQl9Cgl9OwoKCS8qKgoJICogTG9hZCBhbiBhcnJheSBvZiBmaWxlcy4gVG8gbG9hZCBhIHNpbmdsZSBmaWxlLCB1c2UgdGhlIHt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlL2xvYWRGaWxlIn19e3svY3Jvc3NMaW5rfX0gbWV0aG9kLgoJICogVGhlIGZpbGVzIGluIHRoZSBtYW5pZmVzdCBhcmUgcmVxdWVzdGVkIGluIHRoZSBzYW1lIG9yZGVyLCBidXQgbWF5IGNvbXBsZXRlIGluIGEgZGlmZmVyZW50IG9yZGVyIGlmIHRoZSBtYXgKCSAqIGNvbm5lY3Rpb25zIGFyZSBzZXQgYWJvdmUgMSB1c2luZyB7eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZS9zZXRNYXhDb25uZWN0aW9ucyJ9fXt7L2Nyb3NzTGlua319LiBTY3JpcHRzIHdpbGwgbG9hZAoJICogaW4gdGhlIHJpZ2h0IG9yZGVyIGFzIGxvbmcgYXMge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvbWFpbnRhaW5TY3JpcHRPcmRlciJ9fXt7L2Nyb3NzTGlua319IGlzIHRydWUgKHdoaWNoIGlzCgkgKiBkZWZhdWx0KS4KCSAqCgkgKiBGaWxlcyBhcmUgYWx3YXlzIGFwcGVuZGVkIHRvIHRoZSBjdXJyZW50IHF1ZXVlLCBzbyB0aGlzIG1ldGhvZCBjYW4gYmUgdXNlZCBtdWx0aXBsZSB0aW1lcyB0byBhZGQgZmlsZXMuCgkgKiBUbyBjbGVhciB0aGUgcXVldWUgZmlyc3QsIHVzZSB0aGUge3sjY3Jvc3NMaW5rICJBYnN0cmFjdExvYWRlci9jbG9zZSJ9fXt7L2Nyb3NzTGlua319IG1ldGhvZC4KCSAqIEBtZXRob2QgbG9hZE1hbmlmZXN0CgkgKiBAcGFyYW0ge0FycmF5fFN0cmluZ3xPYmplY3R9IG1hbmlmZXN0IEFuIGxpc3Qgb2YgZmlsZXMgdG8gbG9hZC4gVGhlIGxvYWRNYW5pZmVzdCBjYWxsIHN1cHBvcnRzIGZvdXIgdHlwZXMgb2YKCSAqIG1hbmlmZXN0czoKCSAqIDxvbD4KCSAqICAgICA8bGk+QSBzdHJpbmcgcGF0aCwgd2hpY2ggcG9pbnRzIHRvIGEgbWFuaWZlc3QgZmlsZSwgd2hpY2ggaXMgYSBKU09OIGZpbGUgdGhhdCBjb250YWlucyBhICJtYW5pZmVzdCIgcHJvcGVydHksCgkgKiAgICAgd2hpY2ggZGVmaW5lcyB0aGUgbGlzdCBvZiBmaWxlcyB0byBsb2FkLCBhbmQgY2FuIG9wdGlvbmFsbHkgY29udGFpbiBhICJwYXRoIiBwcm9wZXJ0eSwgd2hpY2ggd2lsbCBiZQoJICogICAgIHByZXBlbmRlZCB0byBlYWNoIGZpbGUgaW4gdGhlIGxpc3QuPC9saT4KCSAqICAgICA8bGk+QW4gb2JqZWN0IHdoaWNoIGRlZmluZXMgYSAic3JjIiwgd2hpY2ggaXMgYSBKU09OIG9yIEpTT05QIGZpbGUuIEEgImNhbGxiYWNrIiBjYW4gYmUgZGVmaW5lZCBmb3IgSlNPTlAKCSAqICAgICBmaWxlLiBUaGUgSlNPTi9KU09OUCBmaWxlIHNob3VsZCBjb250YWluIGEgIm1hbmlmZXN0IiBwcm9wZXJ0eSwgd2hpY2ggZGVmaW5lcyB0aGUgbGlzdCBvZiBmaWxlcyB0byBsb2FkLAoJICogICAgIGFuZCBjYW4gb3B0aW9uYWxseSBjb250YWluIGEgInBhdGgiIHByb3BlcnR5LCB3aGljaCB3aWxsIGJlIHByZXBlbmRlZCB0byBlYWNoIGZpbGUgaW4gdGhlIGxpc3QuPC9saT4KCSAqICAgICA8bGk+QW4gb2JqZWN0IHdoaWNoIGNvbnRhaW5zIGEgIm1hbmlmZXN0IiBwcm9wZXJ0eSwgd2hpY2ggZGVmaW5lcyB0aGUgbGlzdCBvZiBmaWxlcyB0byBsb2FkLCBhbmQgY2FuCgkgKiAgICAgb3B0aW9uYWxseSBjb250YWluIGEgInBhdGgiIHByb3BlcnR5LCB3aGljaCB3aWxsIGJlIHByZXBlbmRlZCB0byBlYWNoIGZpbGUgaW4gdGhlIGxpc3QuPC9saT4KCSAqICAgICA8bGk+QW4gQXJyYXkgb2YgZmlsZXMgdG8gbG9hZC48L2xpPgoJICogPC9vbD4KCSAqCgkgKiBFYWNoICJmaWxlIiBpbiBhIG1hbmlmZXN0IGNhbiBiZSBlaXRoZXI6CgkgKiA8dWw+CgkgKiAgICAgPGxpPkEgc3RyaW5nIHBhdGggdG8gYSByZXNvdXJjZSAoc3RyaW5nKS4gTm90ZSB0aGF0IHRoaXMga2luZCBvZiBsb2FkIGl0ZW0gd2lsbCBiZSBjb252ZXJ0ZWQgdG8gYW4gb2JqZWN0CgkgKiAgICAgKHNlZSBiZWxvdykgaW4gdGhlIGJhY2tncm91bmQuPC9saT4KCSAqICAgICAgPGxpPk9SIGFuIG9iamVjdCB0aGF0IGNvbnRhaW5zOjx1bD4KCSAqICAgICAgICAgPGxpPnNyYzogVGhlIHNvdXJjZSBvZiB0aGUgZmlsZSB0aGF0IGlzIGJlaW5nIGxvYWRlZC4gVGhpcyBwcm9wZXJ0eSBpcyA8Yj5yZXF1aXJlZDwvYj4uIFRoZSBzb3VyY2UgY2FuCgkgKiAgICAgICAgIGVpdGhlciBiZSBhIHN0cmluZyAocmVjb21tZW5kZWQpLCBvciBhbiBIVE1MIHRhZy48L2xpPgoJICogICAgICAgICA8bGk+dHlwZTogVGhlIHR5cGUgb2YgZmlsZSB0aGF0IHdpbGwgYmUgbG9hZGVkIChpbWFnZSwgc291bmQsIGpzb24sIGV0YykuIFByZWxvYWRKUyBkb2VzIGF1dG8tZGV0ZWN0aW9uCgkgKiAgICAgICAgIG9mIHR5cGVzIHVzaW5nIHRoZSBleHRlbnNpb24uIFN1cHBvcnRlZCB0eXBlcyBhcmUgZGVmaW5lZCBvbiBMb2FkUXVldWUsIHN1Y2ggYXMgPGNvZGU+TG9hZFF1ZXVlLklNQUdFPC9jb2RlPi4KCSAqICAgICAgICAgSXQgaXMgcmVjb21tZW5kZWQgdGhhdCBhIHR5cGUgaXMgc3BlY2lmaWVkIHdoZW4gYSBub24tc3RhbmRhcmQgZmlsZSBVUkkgKHN1Y2ggYXMgYSBwaHAgc2NyaXB0KSB1cyB1c2VkLjwvbGk+CgkgKiAgICAgICAgIDxsaT5pZDogQSBzdHJpbmcgaWRlbnRpZmllciB3aGljaCBjYW4gYmUgdXNlZCB0byByZWZlcmVuY2UgdGhlIGxvYWRlZCBvYmplY3QuPC9saT4KCSAqICAgICAgICAgPGxpPmNhbGxiYWNrOiBPcHRpb25hbCwgdXNlZCBmb3IgSlNPTlAgcmVxdWVzdHMsIHRvIGRlZmluZSB3aGF0IG1ldGhvZCB0byBjYWxsIHdoZW4gdGhlIEpTT05QIGlzIGxvYWRlZC48L2xpPgoJICogICAgICAgICA8bGk+ZGF0YTogQW4gYXJiaXRyYXJ5IGRhdGEgb2JqZWN0LCB3aGljaCBpcyBpbmNsdWRlZCB3aXRoIHRoZSBsb2FkZWQgb2JqZWN0PC9saT4KCSAqICAgICAgICAgPGxpPm1ldGhvZDogdXNlZCB0byBkZWZpbmUgaWYgdGhpcyByZXF1ZXN0IHVzZXMgR0VUIG9yIFBPU1Qgd2hlbiBzZW5kaW5nIGRhdGEgdG8gdGhlIHNlcnZlci4gVGhlIGRlZmF1bHQKCSAqICAgICAgICAgdmFsdWUgaXMgIkdFVCI8L2xpPgoJICogICAgICAgICA8bGk+dmFsdWVzOiBPcHRpb25hbCBvYmplY3Qgb2YgbmFtZS92YWx1ZSBwYWlycyB0byBzZW5kIHRvIHRoZSBzZXJ2ZXIuPC9saT4KCSAqICAgICA8L3VsPgoJICogPC91bD4KCSAqIEBwYXJhbSB7Qm9vbGVhbn0gW2xvYWROb3c9dHJ1ZV0gS2ljayBvZmYgYW4gaW1tZWRpYXRlIGxvYWQgKHRydWUpIG9yIHdhaXQgZm9yIGEgbG9hZCBjYWxsIChmYWxzZSkuIFRoZSBkZWZhdWx0CgkgKiB2YWx1ZSBpcyB0cnVlLiBJZiB0aGUgcXVldWUgaXMgcGF1c2VkIHVzaW5nIHt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlL3NldFBhdXNlZCJ9fXt7L2Nyb3NzTGlua319IGFuZCB0aGlzIHZhbHVlIGlzCgkgKiBgdHJ1ZWAsIHRoZSBxdWV1ZSB3aWxsIHJlc3VtZSBhdXRvbWF0aWNhbGx5LgoJICogQHBhcmFtIHtTdHJpbmd9IFtiYXNlUGF0aF0gQSBiYXNlIHBhdGggdGhhdCB3aWxsIGJlIHByZXBlbmRlZCB0byBlYWNoIGZpbGUuIFRoZSBiYXNlUGF0aCBhcmd1bWVudCBvdmVycmlkZXMgdGhlCgkgKiBwYXRoIHNwZWNpZmllZCBpbiB0aGUgY29uc3RydWN0b3IuIE5vdGUgdGhhdCBpZiB5b3UgbG9hZCBhIG1hbmlmZXN0IHVzaW5nIGEgZmlsZSBvZiB0eXBlIHt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlL01BTklGRVNUOnByb3BlcnR5In19e3svY3Jvc3NMaW5rfX0sCgkgKiBpdHMgZmlsZXMgd2lsbCA8c3Ryb25nPk5PVDwvc3Ryb25nPiB1c2UgdGhlIGJhc2VQYXRoIHBhcmFtZXRlci4gPHN0cm9uZz5UaGUgYmFzZVBhdGggcGFyYW1ldGVyIGlzIGRlcHJlY2F0ZWQuPC9zdHJvbmc+CgkgKiBUaGlzIHBhcmFtZXRlciB3aWxsIGJlIHJlbW92ZWQgaW4gYSBmdXR1cmUgdmVyc2lvbi4gUGxlYXNlIGVpdGhlciB1c2UgdGhlIGBiYXNlUGF0aGAgcGFyYW1ldGVyIGluIHRoZSBMb2FkUXVldWUKCSAqIGNvbnN0cnVjdG9yLCBvciBhIGBwYXRoYCBwcm9wZXJ0eSBpbiBhIG1hbmlmZXN0IGRlZmluaXRpb24uCgkgKi8KCXAubG9hZE1hbmlmZXN0ID0gZnVuY3Rpb24obWFuaWZlc3QsIGxvYWROb3csIGJhc2VQYXRoKSB7CgkJdmFyIGZpbGVMaXN0ID0gbnVsbDsKCQl2YXIgcGF0aCA9IG51bGw7CgoJCS8vIEFycmF5LWJhc2VkIGxpc3Qgb2YgaXRlbXMKCQlpZiAobWFuaWZlc3QgaW5zdGFuY2VvZiBBcnJheSkgewoJCQlpZiAobWFuaWZlc3QubGVuZ3RoID09IDApIHsKCQkJCXZhciBldmVudCA9IG5ldyBjcmVhdGVqcy5FdmVudCgiZXJyb3IiKTsKCQkJCWV2ZW50LnRleHQgPSAiUFJFTE9BRF9NQU5JRkVTVF9FTVBUWSI7CgkJCQl0aGlzLl9zZW5kRXJyb3IoZXZlbnQpOwoJCQkJcmV0dXJuOwoJCQl9CgkJCWZpbGVMaXN0ID0gbWFuaWZlc3Q7CgoJCS8vIFN0cmluZy1iYXNlZC4gT25seSBmaWxlIG1hbmlmZXN0cyBjYW4gYmUgc3BlY2lmaWVkIHRoaXMgd2F5LiBBbnkgb3RoZXIgdHlwZXMgd2lsbCBjYXVzZSBhbiBlcnJvciB3aGVuIGxvYWRlZC4KCQl9IGVsc2UgaWYgKHR5cGVvZihtYW5pZmVzdCkgPT09ICJzdHJpbmciKSB7CgkJCWZpbGVMaXN0ID0gW3sKCQkJCXNyYzogbWFuaWZlc3QsCgkJCQl0eXBlOiBzLk1BTklGRVNUCgkJCX1dOwoKCQl9IGVsc2UgaWYgKHR5cGVvZihtYW5pZmVzdCkgPT0gIm9iamVjdCIpIHsKCgkJCS8vIEFuIG9iamVjdCB0aGF0IGRlZmluZXMgYSBtYW5pZmVzdCBwYXRoCgkJCWlmIChtYW5pZmVzdC5zcmMgIT09IHVuZGVmaW5lZCkgewoJCQkJaWYgKG1hbmlmZXN0LnR5cGUgPT0gbnVsbCkgewoJCQkJCW1hbmlmZXN0LnR5cGUgPSBzLk1BTklGRVNUOwoJCQkJfSBlbHNlIGlmIChtYW5pZmVzdC50eXBlICE9IHMuTUFOSUZFU1QpIHsKCQkJCQl2YXIgZXZlbnQgPSBuZXcgY3JlYXRlanMuRXZlbnQoImVycm9yIik7CgkJCQkJZXZlbnQudGV4dCA9ICJQUkVMT0FEX01BTklGRVNUX0VSUk9SIjsKCQkJCQl0aGlzLl9zZW5kRXJyb3IoZXZlbnQpOwoJCQkJfQoJCQkJZmlsZUxpc3QgPSBbbWFuaWZlc3RdOwoKCQkJLy8gQW4gb2JqZWN0IHRoYXQgZGVmaW5lcyBhIG1hbmlmZXN0CgkJCX0gZWxzZSBpZiAobWFuaWZlc3QubWFuaWZlc3QgIT09IHVuZGVmaW5lZCkgewoJCQkJZmlsZUxpc3QgPSBtYW5pZmVzdC5tYW5pZmVzdDsKCQkJCXBhdGggPSBtYW5pZmVzdC5wYXRoOwoJCQl9CgoJCS8vIFVuc3VwcG9ydGVkLiBUaGlzIHdpbGwgdGhyb3cgYW4gZXJyb3IuCgkJfSBlbHNlIHsKCQkJdmFyIGV2ZW50ID0gbmV3IGNyZWF0ZWpzLkV2ZW50KCJlcnJvciIpOwoJCQlldmVudC50ZXh0ID0gIlBSRUxPQURfTUFOSUZFU1RfTlVMTCI7CgkJCXRoaXMuX3NlbmRFcnJvcihldmVudCk7CgkJCXJldHVybjsKCQl9CgoJCWZvciAodmFyIGk9MCwgbD1maWxlTGlzdC5sZW5ndGg7IGk8bDsgaSsrKSB7CgkJCXRoaXMuX2FkZEl0ZW0oZmlsZUxpc3RbaV0sIHBhdGgsIGJhc2VQYXRoKTsKCQl9CgoJCWlmIChsb2FkTm93ICE9PSBmYWxzZSkgewoJCQl0aGlzLnNldFBhdXNlZChmYWxzZSk7CgkJfSBlbHNlIHsKCQkJdGhpcy5zZXRQYXVzZWQodHJ1ZSk7CgkJfQoKCX07CgoJLy8gT3ZlcnJpZGVzIGFic3RyYWN0IG1ldGhvZCBpbiBBYnN0cmFjdExvYWRlcgoJcC5sb2FkID0gZnVuY3Rpb24oKSB7CgkJdGhpcy5zZXRQYXVzZWQoZmFsc2UpOwoJfTsKCgkvKioKCSAqIExvb2sgdXAgYSBsb2FkIGl0ZW0gdXNpbmcgZWl0aGVyIHRoZSAiaWQiIG9yICJzcmMiIHRoYXQgd2FzIHNwZWNpZmllZCB3aGVuIGxvYWRpbmcgaXQuIE5vdGUgdGhhdCBpZiBubyAiaWQiIHdhcwoJICogc3VwcGxpZWQgd2l0aCB0aGUgbG9hZCBpdGVtLCB0aGUgSUQgd2lsbCBiZSB0aGUgInNyYyIsIGluY2x1ZGluZyBhIGBwYXRoYCBwcm9wZXJ0eSBkZWZpbmVkIGJ5IGEgbWFuaWZlc3QuIFRoZQoJICogYGJhc2VQYXRoYCB3aWxsIG5vdCBiZSBwYXJ0IG9mIHRoZSBJRC4KCSAqIEBtZXRob2QgZ2V0SXRlbQoJICogQHBhcmFtIHtTdHJpbmd9IHZhbHVlIFRoZSA8Y29kZT5pZDwvY29kZT4gb3IgPGNvZGU+c3JjPC9jb2RlPiBvZiB0aGUgbG9hZCBpdGVtLgoJICogQHJldHVybiB7T2JqZWN0fSBUaGUgbG9hZCBpdGVtIHRoYXQgd2FzIGluaXRpYWxseSByZXF1ZXN0ZWQgdXNpbmcge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvbG9hZEZpbGUifX17ey9jcm9zc0xpbmt9fQoJICogb3Ige3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvbG9hZE1hbmlmZXN0In19e3svY3Jvc3NMaW5rfX0uIFRoaXMgb2JqZWN0IGlzIGFsc28gcmV0dXJuZWQgdmlhIHRoZSB7eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZS9maWxlbG9hZDpldmVudCJ9fXt7L2Nyb3NzTGlua319CgkgKiBldmVudCBhcyB0aGUgYGl0ZW1gIHBhcmFtZXRlci4KCSAqLwoJcC5nZXRJdGVtID0gZnVuY3Rpb24odmFsdWUpIHsKCQlyZXR1cm4gdGhpcy5fbG9hZEl0ZW1zQnlJZFt2YWx1ZV0gfHwgdGhpcy5fbG9hZEl0ZW1zQnlTcmNbdmFsdWVdOwoJfTsKCgkvKioKCSAqIExvb2sgdXAgYSBsb2FkZWQgcmVzdWx0IHVzaW5nIGVpdGhlciB0aGUgImlkIiBvciAic3JjIiB0aGF0IHdhcyBzcGVjaWZpZWQgd2hlbiBsb2FkaW5nIGl0LiBOb3RlIHRoYXQgaWYgbm8gImlkIgoJICogd2FzIHN1cHBsaWVkIHdpdGggdGhlIGxvYWQgaXRlbSwgdGhlIElEIHdpbGwgYmUgdGhlICJzcmMiLCBpbmNsdWRpbmcgYSBgcGF0aGAgcHJvcGVydHkgZGVmaW5lZCBieSBhIG1hbmlmZXN0LiBUaGUKCSAqIGBiYXNlUGF0aGAgd2lsbCBub3QgYmUgcGFydCBvZiB0aGUgSUQuCgkgKiBAbWV0aG9kIGdldFJlc3VsdAoJICogQHBhcmFtIHtTdHJpbmd9IHZhbHVlIFRoZSA8Y29kZT5pZDwvY29kZT4gb3IgPGNvZGU+c3JjPC9jb2RlPiBvZiB0aGUgbG9hZCBpdGVtLgoJICogQHBhcmFtIHtCb29sZWFufSBbcmF3UmVzdWx0PWZhbHNlXSBSZXR1cm4gYSByYXcgcmVzdWx0IGluc3RlYWQgb2YgYSBmb3JtYXR0ZWQgcmVzdWx0LiBUaGlzIGFwcGxpZXMgdG8gY29udGVudAoJICogbG9hZGVkIHZpYSBYSFIgc3VjaCBhcyBzY3JpcHRzLCBYTUwsIENTUywgYW5kIEltYWdlcy4gSWYgdGhlcmUgaXMgbm8gcmF3IHJlc3VsdCwgdGhlIGZvcm1hdHRlZCByZXN1bHQgd2lsbCBiZQoJICogcmV0dXJuZWQgaW5zdGVhZC4KCSAqIEByZXR1cm4ge09iamVjdH0gQSByZXN1bHQgb2JqZWN0IGNvbnRhaW5pbmcgdGhlIGNvbnRlbnQgdGhhdCB3YXMgbG9hZGVkLCBzdWNoIGFzOgogICAgICogPHVsPgoJICogICAgICA8bGk+QW4gaW1hZ2UgdGFnICgmbHQ7aW1hZ2UgLyZndDspIGZvciBpbWFnZXM8L2xpPgoJICogICAgICA8bGk+QSBzY3JpcHQgdGFnIGZvciBKYXZhU2NyaXB0ICgmbHQ7c2NyaXB0IC8mZ3Q7KS4gTm90ZSB0aGF0IHNjcmlwdHMgYXJlIGF1dG9tYXRpY2FsbHkgYWRkZWQgdG8gdGhlIEhUTUwKCSAqICAgICAgRE9NLjwvbGk+CgkgKiAgICAgIDxsaT5BIHN0eWxlIHRhZyBmb3IgQ1NTICgmbHQ7c3R5bGUgLyZndDsgb3IgJmx0O2xpbmsgJmd0Oyk8L2xpPgoJICogICAgICA8bGk+UmF3IHRleHQgZm9yIFRFWFQ8L2xpPgoJICogICAgICA8bGk+QSBmb3JtYXR0ZWQgSmF2YVNjcmlwdCBvYmplY3QgZGVmaW5lZCBieSBKU09OPC9saT4KCSAqICAgICAgPGxpPkFuIFhNTCBkb2N1bWVudDwvbGk+CgkgKiAgICAgIDxsaT5BIGJpbmFyeSBhcnJheWJ1ZmZlciBsb2FkZWQgYnkgWEhSPC9saT4KCSAqICAgICAgPGxpPkFuIGF1ZGlvIHRhZyAoJmx0O2F1ZGlvICZndDspIGZvciBIVE1MIGF1ZGlvLiBOb3RlIHRoYXQgaXQgaXMgcmVjb21tZW5kZWQgdG8gdXNlIFNvdW5kSlMgQVBJcyB0byBwbGF5CgkgKiAgICAgIGxvYWRlZCBhdWRpby4gU3BlY2lmaWNhbGx5LCBhdWRpbyBsb2FkZWQgYnkgRmxhc2ggYW5kIFdlYkF1ZGlvIHdpbGwgcmV0dXJuIGEgbG9hZGVyIG9iamVjdCB1c2luZyB0aGlzIG1ldGhvZAoJICogICAgICB3aGljaCBjYW4gbm90IGJlIHVzZWQgdG8gcGxheSBhdWRpbyBiYWNrLjwvbGk+CgkgKiA8L3VsPgogICAgICogVGhpcyBvYmplY3QgaXMgYWxzbyByZXR1cm5lZCB2aWEgdGhlIHt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlL2ZpbGVsb2FkOmV2ZW50In19e3svY3Jvc3NMaW5rfX0gIGV2ZW50IGFzIHRoZSAnaXRlbWAKCSAqIHBhcmFtZXRlci4gTm90ZSB0aGF0IGlmIGEgcmF3IHJlc3VsdCBpcyByZXF1ZXN0ZWQsIGJ1dCBub3QgZm91bmQsIHRoZSByZXN1bHQgd2lsbCBiZSByZXR1cm5lZCBpbnN0ZWFkLgoJICovCglwLmdldFJlc3VsdCA9IGZ1bmN0aW9uKHZhbHVlLCByYXdSZXN1bHQpIHsKCQl2YXIgaXRlbSA9IHRoaXMuX2xvYWRJdGVtc0J5SWRbdmFsdWVdIHx8IHRoaXMuX2xvYWRJdGVtc0J5U3JjW3ZhbHVlXTsKCQlpZiAoaXRlbSA9PSBudWxsKSB7IHJldHVybiBudWxsOyB9CgkJdmFyIGlkID0gaXRlbS5pZDsKCQlpZiAocmF3UmVzdWx0ICYmIHRoaXMuX2xvYWRlZFJhd1Jlc3VsdHNbaWRdKSB7CgkJCXJldHVybiB0aGlzLl9sb2FkZWRSYXdSZXN1bHRzW2lkXTsKCQl9CgkJcmV0dXJuIHRoaXMuX2xvYWRlZFJlc3VsdHNbaWRdOwoJfTsKCgkvKioKCSAqIFBhdXNlIG9yIHJlc3VtZSB0aGUgY3VycmVudCBsb2FkLiBBY3RpdmUgbG9hZHMgd2lsbCBub3QgYmUgY2FuY2VsbGVkLCBidXQgdGhlIG5leHQgaXRlbXMgaW4gdGhlIHF1ZXVlIHdpbGwgbm90CgkgKiBiZSBwcm9jZXNzZWQgd2hlbiBhY3RpdmUgbG9hZHMgY29tcGxldGUuIExvYWRRdWV1ZXMgYXJlIG5vdCBwYXVzZWQgYnkgZGVmYXVsdC4KCSAqCgkgKiBOb3RlIHRoYXQgaWYgbmV3IGl0ZW1zIGFyZSBhZGRlZCB0byB0aGUgcXVldWUgdXNpbmcge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvbG9hZEZpbGUifX17ey9jcm9zc0xpbmt9fSBvciB7eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZS9sb2FkTWFuaWZlc3QifX17ey9jcm9zc0xpbmt9fSwKCSAqIGEgcGF1c2VkIHF1ZXVlIHdpbGwgYmUgcmVzdW1lZCwgdW5sZXNzIHRoZSBgbG9hZE5vd2AgYXJndW1lbnQgaXMgYGZhbHNlYC4KCSAqIEBtZXRob2Qgc2V0UGF1c2VkCgkgKiBAcGFyYW0ge0Jvb2xlYW59IHZhbHVlIFdoZXRoZXIgdGhlIHF1ZXVlIHNob3VsZCBiZSBwYXVzZWQgb3Igbm90LgoJICovCglwLnNldFBhdXNlZCA9IGZ1bmN0aW9uKHZhbHVlKSB7CgkJdGhpcy5fcGF1c2VkID0gdmFsdWU7CgkJaWYgKCF0aGlzLl9wYXVzZWQpIHsKCQkJdGhpcy5fbG9hZE5leHQoKTsKCQl9Cgl9OwoKCS8vIE92ZXJyaWRlcyBhYnN0cmFjdCBtZXRob2QgaW4gQWJzdHJhY3RMb2FkZXIKCXAuY2xvc2UgPSBmdW5jdGlvbigpIHsKCQl3aGlsZSAodGhpcy5fY3VycmVudExvYWRzLmxlbmd0aCkgewoJCQl0aGlzLl9jdXJyZW50TG9hZHMucG9wKCkuY2FuY2VsKCk7CgkJfQoJCXRoaXMuX3NjcmlwdE9yZGVyLmxlbmd0aCA9IDA7CgkJdGhpcy5fbG9hZGVkU2NyaXB0cy5sZW5ndGggPSAwOwoJCXRoaXMubG9hZFN0YXJ0V2FzRGlzcGF0Y2hlZCA9IGZhbHNlOwoJfTsKCgovL1Byb3RlY3RlZCBNZXRob2RzCgkvKioKCSAqIEFkZCBhbiBpdGVtIHRvIHRoZSBxdWV1ZS4gSXRlbXMgYXJlIGZvcm1hdHRlZCBpbnRvIGEgdXNhYmxlIG9iamVjdCBjb250YWluaW5nIGFsbCB0aGUgcHJvcGVydGllcyBuZWNlc3NhcnkgdG8KCSAqIGxvYWQgdGhlIGNvbnRlbnQuIFRoZSBsb2FkIHF1ZXVlIGlzIHBvcHVsYXRlZCB3aXRoIHRoZSBsb2FkZXIgaW5zdGFuY2UgdGhhdCBoYW5kbGVzIHByZWxvYWRpbmcsIGFuZCBub3QgdGhlIGxvYWQKCSAqIGl0ZW0gdGhhdCB3YXMgcGFzc2VkIGluIGJ5IHRoZSB1c2VyLiBUbyBsb29rIHVwIHRoZSBsb2FkIGl0ZW0gYnkgaWQgb3Igc3JjLCB1c2UgdGhlIHt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlLmdldEl0ZW0ifX17ey9jcm9zc0xpbmt9fQoJICogbWV0aG9kLgoJICogQG1ldGhvZCBfYWRkSXRlbQoJICogQHBhcmFtIHtTdHJpbmd8T2JqZWN0fSB2YWx1ZSBUaGUgaXRlbSB0byBhZGQgdG8gdGhlIHF1ZXVlLgoJICogQHBhcmFtIHtTdHJpbmd9IFtwYXRoXSBBbiBvcHRpb25hbCBwYXRoIHByZXBlbmRlZCB0byB0aGUgYHNyY2AuIFRoZSBwYXRoIHdpbGwgb25seSBiZSBwcmVwZW5kZWQgaWYgdGhlIHNyYyBpcwoJICogcmVsYXRpdmUsIGFuZCBkb2VzIG5vdCBzdGFydCB3aXRoIGEgcHJvdG9jb2wgc3VjaCBhcyBgaHR0cDovL2AsIG9yIGEgcGF0aCBsaWtlIGAuLi9gLiBJZiB0aGUgTG9hZFF1ZXVlIHdhcwoJICogcHJvdmlkZWQgYSB7eyNjcm9zc0xpbmsgIl9iYXNlUGF0aCJ9fXt7L2Nyb3NzTGlua319LCB0aGVuIGl0IHdpbGwgb3B0aW9uYWxseSBiZSBwcmVwZW5kZWQgYWZ0ZXIuCgkgKiBAcGFyYW0ge1N0cmluZ30gW2Jhc2VQYXRoXSA8c3Ryb25nPkRlcHJlY2F0ZWQ8L3N0cm9uZz5BbiBvcHRpb25hbCBiYXNlUGF0aCBwYXNzZWQgaW50byBhIHt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlL2xvYWRNYW5pZmVzdCJ9fXt7L2Nyb3NzTGlua319CgkgKiBvciB7eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZS9sb2FkRmlsZSJ9fXt7L2Nyb3NzTGlua319IGNhbGwuIFRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgcmVtb3ZlZCBpbiBhIGZ1dHVyZSB0YWdnZWQKCSAqIHZlcnNpb24uCgkgKiBAcHJpdmF0ZQoJICovCglwLl9hZGRJdGVtID0gZnVuY3Rpb24odmFsdWUsIHBhdGgsIGJhc2VQYXRoKSB7CgkJdmFyIGl0ZW0gPSB0aGlzLl9jcmVhdGVMb2FkSXRlbSh2YWx1ZSwgcGF0aCwgYmFzZVBhdGgpOyAvLyBiYXNlUGF0aCBhbmQgbWFuaWZlc3QgcGF0aCBhcmUgYWRkZWQgdG8gdGhlIHNyYy4KCQlpZiAoaXRlbSA9PSBudWxsKSB7IHJldHVybjsgfSAvLyBTb21ldGltZXMgcGx1Z2lucyBvciB0eXBlcyBzaG91bGQgYmUgc2tpcHBlZC4KCQl2YXIgbG9hZGVyID0gdGhpcy5fY3JlYXRlTG9hZGVyKGl0ZW0pOwoJCWlmIChsb2FkZXIgIT0gbnVsbCkgewoJCQl0aGlzLl9sb2FkUXVldWUucHVzaChsb2FkZXIpOwoJCQl0aGlzLl9sb2FkUXVldWVCYWNrdXAucHVzaChsb2FkZXIpOwoKCQkJdGhpcy5fbnVtSXRlbXMrKzsKCQkJdGhpcy5fdXBkYXRlUHJvZ3Jlc3MoKTsKCgkJCS8vIE9ubHkgd29ycnkgYWJvdXQgc2NyaXB0IG9yZGVyIHdoZW4gdXNpbmcgWEhSIHRvIGxvYWQgc2NyaXB0cy4gVGFncyBhcmUgb25seSBsb2FkaW5nIG9uZSBhdCBhIHRpbWUuCgkJCWlmICh0aGlzLm1haW50YWluU2NyaXB0T3JkZXIKCQkJCQkmJiBpdGVtLnR5cGUgPT0gY3JlYXRlanMuTG9hZFF1ZXVlLkpBVkFTQ1JJUFQKCQkJCQkmJiBsb2FkZXIgaW5zdGFuY2VvZiBjcmVhdGVqcy5YSFJMb2FkZXIpIHsKCQkJCXRoaXMuX3NjcmlwdE9yZGVyLnB1c2goaXRlbSk7CgkJCQl0aGlzLl9sb2FkZWRTY3JpcHRzLnB1c2gobnVsbCk7CgkJCX0KCQl9Cgl9OwoKCS8qKgoJICogQ3JlYXRlIGEgcmVmaW5lZCBsb2FkIGl0ZW0sIHdoaWNoIGNvbnRhaW5zIGFsbCB0aGUgcmVxdWlyZWQgcHJvcGVydGllcyAoc3JjLCB0eXBlLCBleHRlbnNpb24sIHRhZykuIFRoZSB0eXBlIG9mCgkgKiBpdGVtIGlzIGRldGVybWluZWQgYnkgYnJvd3NlciBzdXBwb3J0LCByZXF1aXJlbWVudHMgYmFzZWQgb24gdGhlIGZpbGUgdHlwZSwgYW5kIGRldmVsb3BlciBzZXR0aW5ncy4gRm9yIGV4YW1wbGUsCgkgKiBYSFIgaXMgb25seSB1c2VkIGZvciBmaWxlIHR5cGVzIHRoYXQgc3VwcG9ydCBpdCBpbiBuZXcgYnJvd3NlcnMuCgkgKgoJICogQmVmb3JlIHRoZSBpdGVtIGlzIHJldHVybmVkLCBhbnkgcGx1Z2lucyByZWdpc3RlcmVkIHRvIGhhbmRsZSB0aGUgdHlwZSBvciBleHRlbnNpb24gd2lsbCBiZSBmaXJlZCwgd2hpY2ggbWF5CgkgKiBhbHRlciB0aGUgbG9hZCBpdGVtLgoJICogQG1ldGhvZCBfY3JlYXRlTG9hZEl0ZW0KCSAqIEBwYXJhbSB7U3RyaW5nIHwgT2JqZWN0IHwgSFRNTEF1ZGlvRWxlbWVudCB8IEhUTUxJbWFnZUVsZW1lbnR9IHZhbHVlIFRoZSBpdGVtIHRoYXQgbmVlZHMgdG8gYmUgcHJlbG9hZGVkLgogCSAqIEBwYXJhbSB7U3RyaW5nfSBbcGF0aF0gQSBwYXRoIHRvIHByZXBlbmQgdG8gdGhlIGl0ZW0ncyBzb3VyY2UuIFNvdXJjZXMgYmVnaW5uaW5nIHdpdGggaHR0cDovLyBvciBzaW1pbGFyIHdpbGwKCSAqIG5vdCByZWNlaXZlIGEgcGF0aC4gU2luY2UgUHJlbG9hZEpTIDAuNC4xLCB0aGUgc3JjIHdpbGwgYmUgbW9kaWZpZWQgdG8gaW5jbHVkZSB0aGUgYHBhdGhgIGFuZCB7eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZS9fYmFzZVBhdGg6cHJvcGVydHkifX17ey9jcm9zc0xpbmt9fQoJICogd2hlbiBpdCBpcyBhZGRlZC4KCSAqIEBwYXJhbSB7U3RyaW5nfSBbYmFzZVBhdGhdIDxzdHJvbmc+RGVwcmVjdGF0ZWQ8L3N0cm9uZz4gQSBiYXNlIHBhdGggdG8gcHJlcGVuZCB0byB0aGUgaXRlbXMgc291cmNlIGluIGFkZGl0aW9uIHRvCgkgKiB0aGUgcGF0aCBhcmd1bWVudC4KCSAqIEByZXR1cm4ge09iamVjdH0gVGhlIGxvYWRlciBpbnN0YW5jZSB0aGF0IHdpbGwgYmUgdXNlZC4KCSAqIEBwcml2YXRlCgkgKi8KCXAuX2NyZWF0ZUxvYWRJdGVtID0gZnVuY3Rpb24odmFsdWUsIHBhdGgsIGJhc2VQYXRoKSB7CgkJdmFyIGl0ZW0gPSBudWxsOwoKCQkvLyBDcmVhdGUvbW9kaWZ5IGEgbG9hZCBpdGVtCgkJc3dpdGNoKHR5cGVvZih2YWx1ZSkpIHsKCQkJY2FzZSAic3RyaW5nIjoKCQkJCWl0ZW0gPSB7CgkJCQkJc3JjOiB2YWx1ZQoJCQkJfTsgYnJlYWs7CgkJCWNhc2UgIm9iamVjdCI6CgkJCQlpZiAod2luZG93LkhUTUxBdWRpb0VsZW1lbnQgJiYgdmFsdWUgaW5zdGFuY2VvZiB3aW5kb3cuSFRNTEF1ZGlvRWxlbWVudCkgewoJCQkJCWl0ZW0gPSB7CgkJCQkJCXRhZzogdmFsdWUsCgkJCQkJCXNyYzogaXRlbS50YWcuc3JjLAoJCQkJCQl0eXBlOiBjcmVhdGVqcy5Mb2FkUXVldWUuU09VTkQKCQkJCQl9OwoJCQkJfSBlbHNlIHsKCQkJCQlpdGVtID0gdmFsdWU7CgkJCQl9CgkJCQlicmVhazsKCQkJZGVmYXVsdDoKCQkJCXJldHVybiBudWxsOwoJCX0KCgkJLy8gRGV0ZXJtaW5lIEV4dGVuc2lvbiwgZXRjLgoJCXZhciBtYXRjaCA9IHRoaXMuX3BhcnNlVVJJKGl0ZW0uc3JjKTsKCQlpZiAobWF0Y2ggIT0gbnVsbCkgeyBpdGVtLmV4dCA9IG1hdGNoWzZdOyB9CgkJaWYgKGl0ZW0udHlwZSA9PSBudWxsKSB7CgkJCWl0ZW0udHlwZSA9IHRoaXMuX2dldFR5cGVCeUV4dGVuc2lvbihpdGVtLmV4dCk7CgkJfQoKCQkvLyBJbmplY3QgcGF0aCAmIGJhc2VQYXRoCgkJdmFyIGJwID0gIiI7IC8vIFN0b3JlIHRoZSBnZW5lcmF0ZWQgYmFzZVBhdGgKCQl2YXIgdXNlQmFzZVBhdGggPSBiYXNlUGF0aCB8fCB0aGlzLl9iYXNlUGF0aDsKCQl2YXIgYXV0b0lkID0gaXRlbS5zcmM7CgkJaWYgKG1hdGNoICYmIG1hdGNoWzFdID09IG51bGwgJiYgbWF0Y2hbM10gPT0gbnVsbCkgewoJCQlpZiAocGF0aCkgewoJCQkJYnAgPSBwYXRoOwoJCQkJdmFyIHBhdGhNYXRjaCA9IHRoaXMuX3BhcnNlUGF0aChwYXRoKTsKCQkJCWF1dG9JZCA9IHBhdGggKyBhdXRvSWQ7CgkJCQkvLyBBbHNvIGFwcGVuZCBiYXNlUGF0aAoJCQkJaWYgKHVzZUJhc2VQYXRoICE9IG51bGwgJiYgcGF0aE1hdGNoICYmIHBhdGhNYXRjaFsxXSA9PSBudWxsICYmIHBhdGhNYXRjaFsyXSA9PSBudWxsKSB7CgkJCQkJYnAgPSB1c2VCYXNlUGF0aCArIGJwOwoJCQkJfQoJCQl9IGVsc2UgaWYgKHVzZUJhc2VQYXRoICE9IG51bGwpIHsKCQkJCWJwID0gdXNlQmFzZVBhdGg7CgkJCX0KCQl9CgkJaXRlbS5zcmMgPSBicCArIGl0ZW0uc3JjOwoJCWl0ZW0ucGF0aCA9IGJwOwoKCQlpZiAoaXRlbS50eXBlID09IGNyZWF0ZWpzLkxvYWRRdWV1ZS5KU09OIHx8IGl0ZW0udHlwZSA9PSBjcmVhdGVqcy5Mb2FkUXVldWUuTUFOSUZFU1QpIHsKCQkJaXRlbS5fbG9hZEFzSlNPTlAgPSAoaXRlbS5jYWxsYmFjayAhPSBudWxsKTsKCQl9CgoJCWlmIChpdGVtLnR5cGUgPT0gY3JlYXRlanMuTG9hZFF1ZXVlLkpTT05QICYmIGl0ZW0uY2FsbGJhY2sgPT0gbnVsbCkgewoJCQl0aHJvdyBuZXcgRXJyb3IoJ2NhbGxiYWNrIGlzIHJlcXVpcmVkIGZvciBsb2FkaW5nIEpTT05QIHJlcXVlc3RzLicpOwoJCX0KCgkJLy8gQ3JlYXRlIGEgdGFnIGZvciB0aGUgaXRlbS4gVGhpcyBlbnN1cmVzIHRoZXJlIGlzIHNvbWV0aGluZyB0byBlaXRoZXIgbG9hZCB3aXRoIG9yIHBvcHVsYXRlIHdoZW4gZmluaXNoZWQuCgkJaWYgKGl0ZW0udGFnID09PSB1bmRlZmluZWQgfHwgaXRlbS50YWcgPT09IG51bGwpIHsKCQkJaXRlbS50YWcgPSB0aGlzLl9jcmVhdGVUYWcoaXRlbSk7CgkJfQoKCQkvLyBJZiB0aGVyZSdzIG5vIGlkLCBzZXQgb25lIG5vdy4KCQlpZiAoaXRlbS5pZCA9PT0gdW5kZWZpbmVkIHx8IGl0ZW0uaWQgPT09IG51bGwgfHwgaXRlbS5pZCA9PT0gIiIpIHsKICAgICAgICAgICAgaXRlbS5pZCA9IGF1dG9JZDsKCQl9CgoJCS8vIEdpdmUgcGx1Z2lucyBhIGNoYW5jZSB0byBtb2RpZnkgdGhlIGxvYWRJdGVtOgoJCXZhciBjdXN0b21IYW5kbGVyID0gdGhpcy5fdHlwZUNhbGxiYWNrc1tpdGVtLnR5cGVdIHx8IHRoaXMuX2V4dGVuc2lvbkNhbGxiYWNrc1tpdGVtLmV4dF07CgkJaWYgKGN1c3RvbUhhbmRsZXIpIHsKCQkJLy8gUGx1Z2lucyBhcmUgbm93IHBhc3NlZCBib3RoIHRoZSBmdWxsIHNvdXJjZSwgYXMgd2VsbCBhcyBhIGNvbWJpbmVkIHBhdGgrYmFzZVBhdGggKGFwcHJvcHJpYXRlbHkpCgkJCXZhciByZXN1bHQgPSBjdXN0b21IYW5kbGVyLmNhbGxiYWNrLmNhbGwoY3VzdG9tSGFuZGxlci5zY29wZSwgaXRlbS5zcmMsIGl0ZW0udHlwZSwgaXRlbS5pZCwgaXRlbS5kYXRhLAoJCQkJCWJwLCB0aGlzKTsKCQkJLy8gTk9URTogQmFzZVBhdGggYXJndW1lbnQgaXMgZGVwcmVjYXRlZC4gV2UgcGFzcyBpdCB0byBwbHVnaW5zLmFsbG93IFNvdW5kSlMgdG8gbW9kaWZ5IHRoZSBmaWxlLiB0byBzYW55bW9yZS4gVGhlIGZ1bGwgcGF0aCBpcyBzZW50IHRvIHRoZSBwbHVnaW4KCgkJCS8vIFRoZSBwbHVnaW4gd2lsbCBoYW5kbGUgdGhlIGxvYWQsIG9yIGhhcyBjYW5jZWxlZCBpdC4gSWdub3JlIGl0LgoJCQlpZiAocmVzdWx0ID09PSBmYWxzZSkgewoJCQkJcmV0dXJuIG51bGw7CgoJCQkvLyBMb2FkIGFzIG5vcm1hbDoKCQkJfSBlbHNlIGlmIChyZXN1bHQgPT09IHRydWUpIHsKCQkJCS8vIERvIE5vdGhpbmcKCgkJCS8vIFJlc3VsdCBpcyBhIGxvYWRlciBjbGFzczoKCQkJfSBlbHNlIHsKCQkJCWlmIChyZXN1bHQuc3JjICE9IG51bGwpIHsgaXRlbS5zcmMgPSByZXN1bHQuc3JjOyB9CgkJCQlpZiAocmVzdWx0LmlkICE9IG51bGwpIHsgaXRlbS5pZCA9IHJlc3VsdC5pZDsgfSAvLyBUT0RPOiBFdmFsdWF0ZSB0aGlzLiBBbiBvdmVycmlkZGVuIElEIGNvdWxkIGJlIHByb2JsZW1hdGljCgkJCQlpZiAocmVzdWx0LnRhZyAhPSBudWxsKSB7IC8vIEFzc3VtZXMgdGhhdCB0aGUgcmV0dXJuZWQgdGFnIGVpdGhlciBoYXMgYSBsb2FkIG1ldGhvZCBvciBhIHNyYyBzZXR0ZXIuCgkJCQkJaXRlbS50YWcgPSByZXN1bHQudGFnOwoJCQkJfQogICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5jb21wbGV0ZUhhbmRsZXIgIT0gbnVsbCkgeyBpdGVtLmNvbXBsZXRlSGFuZGxlciA9IHJlc3VsdC5jb21wbGV0ZUhhbmRsZXI7IH0KCgkJCQkvLyBBbGxvdyB0eXBlIG92ZXJyaWRpbmc6CgkJCQlpZiAocmVzdWx0LnR5cGUpIHsgaXRlbS50eXBlID0gcmVzdWx0LnR5cGU7IH0KCgkJCQkvLyBVcGRhdGUgdGhlIGV4dGVuc2lvbiBpbiBjYXNlIHRoZSB0eXBlIGNoYW5nZWQ6CgkJCQltYXRjaCA9IHRoaXMuX3BhcnNlVVJJKGl0ZW0uc3JjKTsKCQkJCWlmIChtYXRjaCAhPSBudWxsICYmIG1hdGNoWzZdICE9IG51bGwpIHsKCQkJCQlpdGVtLmV4dCA9IG1hdGNoWzZdLnRvTG93ZXJDYXNlKCk7CgkJCQl9CgkJCX0KCQl9CgoJCS8vIFN0b3JlIHRoZSBpdGVtIGZvciBsb29rdXAuIFRoaXMgYWxzbyBoZWxwcyBjbGVhbi11cCBsYXRlci4KCQl0aGlzLl9sb2FkSXRlbXNCeUlkW2l0ZW0uaWRdID0gaXRlbTsKCQl0aGlzLl9sb2FkSXRlbXNCeVNyY1tpdGVtLnNyY10gPSBpdGVtOwoKCQlyZXR1cm4gaXRlbTsKCX07CgoJLyoqCgkgKiBDcmVhdGUgYSBsb2FkZXIgZm9yIGEgbG9hZCBpdGVtLgoJICogQG1ldGhvZCBfY3JlYXRlTG9hZGVyCgkgKiBAcGFyYW0ge09iamVjdH0gaXRlbSBBIGZvcm1hdHRlZCBsb2FkIGl0ZW0gdGhhdCBjYW4gYmUgdXNlZCB0byBnZW5lcmF0ZSBhIGxvYWRlci4KCSAqIEByZXR1cm4ge0Fic3RyYWN0TG9hZGVyfSBBIGxvYWRlciB0aGF0IGNhbiBiZSB1c2VkIHRvIGxvYWQgY29udGVudC4KCSAqIEBwcml2YXRlCgkgKi8KCXAuX2NyZWF0ZUxvYWRlciA9IGZ1bmN0aW9uKGl0ZW0pIHsKCQkvLyBJbml0aWFsbHksIHRyeSBhbmQgdXNlIHRoZSBwcm92aWRlZC9zdXBwb3J0ZWQgWEhSIG1vZGU6CgkJdmFyIHVzZVhIUiA9IHRoaXMudXNlWEhSOwoKCQkvLyBEZXRlcm1pbmUgdGhlIFhIUiB1c2FnZSBvdmVycmlkZXM6CgkJc3dpdGNoIChpdGVtLnR5cGUpIHsKCQkJY2FzZSBjcmVhdGVqcy5Mb2FkUXVldWUuSlNPTjoKCQkJY2FzZSBjcmVhdGVqcy5Mb2FkUXVldWUuTUFOSUZFU1Q6CgkJCQl1c2VYSFIgPSAhaXRlbS5fbG9hZEFzSlNPTlA7CgkJCQlicmVhazsKCQkJY2FzZSBjcmVhdGVqcy5Mb2FkUXVldWUuWE1MOgoJCQljYXNlIGNyZWF0ZWpzLkxvYWRRdWV1ZS5URVhUOgoJCQkJdXNlWEhSID0gdHJ1ZTsgLy8gQWx3YXlzIHVzZSBYSFIyIHdpdGggdGV4dC9YTUwKCQkJCWJyZWFrOwoJCQljYXNlIGNyZWF0ZWpzLkxvYWRRdWV1ZS5TT1VORDoKCQkJY2FzZSBjcmVhdGVqcy5Mb2FkUXVldWUuSlNPTlA6CgkJCQl1c2VYSFIgPSBmYWxzZTsgLy8gTmV2ZXIgbG9hZCBhdWRpbyB1c2luZyBYSFIuIFdlYkF1ZGlvIHdpbGwgcHJvdmlkZSBpdHMgb3duIGxvYWRlci4KCQkJCWJyZWFrOwoJCQljYXNlIG51bGw6CgkJCQlyZXR1cm4gbnVsbDsKCQkJLy8gTm90ZTogSU1BR0UsIENTUywgU0NSSVBULCBTVkcgY2FuIGFsbCB1c2UgVEFHUyBvciBYSFIuCgkJfQoKCQlpZiAodXNlWEhSKSB7CgkJCXJldHVybiBuZXcgY3JlYXRlanMuWEhSTG9hZGVyKGl0ZW0sIHRoaXMuX2Nyb3NzT3JpZ2luKTsKCQl9IGVsc2UgewoJCQlyZXR1cm4gbmV3IGNyZWF0ZWpzLlRhZ0xvYWRlcihpdGVtKTsKCQl9Cgl9OwoKCgkvKioKCSAqIExvYWQgdGhlIG5leHQgaXRlbSBpbiB0aGUgcXVldWUuIElmIHRoZSBxdWV1ZSBpcyBlbXB0eSAoYWxsIGl0ZW1zIGhhdmUgYmVlbiBsb2FkZWQpLCB0aGVuIHRoZSBjb21wbGV0ZSBldmVudAoJICogaXMgcHJvY2Vzc2VkLiBUaGUgcXVldWUgd2lsbCAiZmlsbCB1cCIgYW55IGVtcHR5IHNsb3RzLCB1cCB0byB0aGUgbWF4IGNvbm5lY3Rpb24gc3BlY2lmaWVkIHVzaW5nCgkgKiB7eyNjcm9zc0xpbmsgIkxvYWRRdWV1ZS5zZXRNYXhDb25uZWN0aW9ucyJ9fXt7L2Nyb3NzTGlua319IG1ldGhvZC4gVGhlIG9ubHkgZXhjZXB0aW9uIGlzIHNjcmlwdHMgdGhhdCBhcmUgbG9hZGVkCgkgKiB1c2luZyB0YWdzLCB3aGljaCBoYXZlIHRvIGJlIGxvYWRlZCBvbmUgYXQgYSB0aW1lIHRvIG1haW50YWluIGxvYWQgb3JkZXIuCgkgKiBAbWV0aG9kIF9sb2FkTmV4dAoJICogQHByaXZhdGUKCSAqLwoJcC5fbG9hZE5leHQgPSBmdW5jdGlvbigpIHsKCQlpZiAodGhpcy5fcGF1c2VkKSB7IHJldHVybjsgfQoKCQkvLyBPbmx5IGRpc3BhdGNoIGxvYWRzdGFydCBldmVudCB3aGVuIHRoZSBmaXJzdCBmaWxlIGlzIGxvYWRlZC4KCQlpZiAoIXRoaXMuX2xvYWRTdGFydFdhc0Rpc3BhdGNoZWQpIHsKCQkJdGhpcy5fc2VuZExvYWRTdGFydCgpOwoJCQl0aGlzLl9sb2FkU3RhcnRXYXNEaXNwYXRjaGVkID0gdHJ1ZTsKCQl9CgoJCS8vIFRoZSBxdWV1ZSBoYXMgY29tcGxldGVkLgoJCWlmICh0aGlzLl9udW1JdGVtcyA9PSB0aGlzLl9udW1JdGVtc0xvYWRlZCkgewoJCQl0aGlzLmxvYWRlZCA9IHRydWU7CgkJCXRoaXMuX3NlbmRDb21wbGV0ZSgpOwoKCQkJLy8gTG9hZCB0aGUgbmV4dCBxdWV1ZSwgaWYgaXQgaGFzIGJlZW4gZGVmaW5lZC4KCQkJaWYgKHRoaXMubmV4dCAmJiB0aGlzLm5leHQubG9hZCkgewoJCQkJdGhpcy5uZXh0LmxvYWQoKTsKCQkJfQoJCX0gZWxzZSB7CgkJCXRoaXMubG9hZGVkID0gZmFsc2U7CgkJfQoKCQkvLyBNdXN0IGl0ZXJhdGUgZm9yd2FyZHMgdG8gbG9hZCBpbiB0aGUgcmlnaHQgb3JkZXIuCgkJZm9yICh2YXIgaT0wOyBpPHRoaXMuX2xvYWRRdWV1ZS5sZW5ndGg7IGkrKykgewoJCQlpZiAodGhpcy5fY3VycmVudExvYWRzLmxlbmd0aCA+PSB0aGlzLl9tYXhDb25uZWN0aW9ucykgeyBicmVhazsgfQoJCQl2YXIgbG9hZGVyID0gdGhpcy5fbG9hZFF1ZXVlW2ldOwoKCQkJLy8gRGV0ZXJtaW5lIGlmIHdlIHNob3VsZCBiZSBvbmx5IGxvYWRpbmcgb25lIGF0IGEgdGltZToKCQkJaWYgKHRoaXMubWFpbnRhaW5TY3JpcHRPcmRlcgoJCQkJCSYmIGxvYWRlciBpbnN0YW5jZW9mIGNyZWF0ZWpzLlRhZ0xvYWRlcgoJCQkJCSYmIGxvYWRlci5nZXRJdGVtKCkudHlwZSA9PSBjcmVhdGVqcy5Mb2FkUXVldWUuSkFWQVNDUklQVCkgewoJCQkJaWYgKHRoaXMuX2N1cnJlbnRseUxvYWRpbmdTY3JpcHQpIHsgY29udGludWU7IH0gLy8gTGF0ZXIgaXRlbXMgaW4gdGhlIHF1ZXVlIG1pZ2h0IG5vdCBiZSBzY3JpcHRzLgoJCQkJdGhpcy5fY3VycmVudGx5TG9hZGluZ1NjcmlwdCA9IHRydWU7CgkJCX0KCQkJdGhpcy5fbG9hZFF1ZXVlLnNwbGljZShpLCAxKTsKICAJCQlpLS07CiAgICAgICAgICAgIHRoaXMuX2xvYWRJdGVtKGxvYWRlcik7CgkJfQoJfTsKCgkvKioKCSAqIEJlZ2luIGxvYWRpbmcgYW4gaXRlbS4gRXZlbnRzIGFyZSBub3QgYWRkZWQgdG8gdGhlIGxvYWRlcnMgdW50aWwgdGhlIGxvYWQgc3RhcnRzLgoJICogQG1ldGhvZCBfbG9hZEl0ZW0KCSAqIEBwYXJhbSB7QWJzdHJhY3RMb2FkZXJ9IGxvYWRlciBUaGUgbG9hZGVyIGluc3RhbmNlIHRvIHN0YXJ0LiBDdXJyZW50bHksIHRoaXMgd2lsbCBiZSBhbiBYSFJMb2FkZXIgb3IgVGFnTG9hZGVyLgoJICogQHByaXZhdGUKCSAqLwoJcC5fbG9hZEl0ZW0gPSBmdW5jdGlvbihsb2FkZXIpIHsKCQlsb2FkZXIub24oInByb2dyZXNzIiwgdGhpcy5faGFuZGxlUHJvZ3Jlc3MsIHRoaXMpOwoJCWxvYWRlci5vbigiY29tcGxldGUiLCB0aGlzLl9oYW5kbGVGaWxlQ29tcGxldGUsIHRoaXMpOwoJCWxvYWRlci5vbigiZXJyb3IiLCB0aGlzLl9oYW5kbGVGaWxlRXJyb3IsIHRoaXMpOwoJCXRoaXMuX2N1cnJlbnRMb2Fkcy5wdXNoKGxvYWRlcik7CgkJdGhpcy5fc2VuZEZpbGVTdGFydChsb2FkZXIuZ2V0SXRlbSgpKTsKCQlsb2FkZXIubG9hZCgpOwoJfTsKCgkvKioKCSAqIFRoZSBjYWxsYmFjayB0aGF0IGlzIGZpcmVkIHdoZW4gYSBsb2FkZXIgZW5jb3VudGVycyBhbiBlcnJvci4gVGhlIHF1ZXVlIHdpbGwgY29udGludWUgbG9hZGluZyB1bmxlc3Mge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvc3RvcE9uRXJyb3I6cHJvcGVydHkifX17ey9jcm9zc0xpbmt9fQoJICogaXMgc2V0IHRvIGB0cnVlYC4KCSAqIEBtZXRob2QgX2hhbmRsZUZpbGVFcnJvcgoJICogQHBhcmFtIHtPYmplY3R9IGV2ZW50IFRoZSBlcnJvciBldmVudCwgY29udGFpbmluZyByZWxldmFudCBlcnJvciBpbmZvcm1hdGlvbi4KCSAqIEBwcml2YXRlCgkgKi8KCXAuX2hhbmRsZUZpbGVFcnJvciA9IGZ1bmN0aW9uKGV2ZW50KSB7CgkJdmFyIGxvYWRlciA9IGV2ZW50LnRhcmdldDsKCQl0aGlzLl9udW1JdGVtc0xvYWRlZCsrOwoJCXRoaXMuX3VwZGF0ZVByb2dyZXNzKCk7CgoJCXZhciBuZXdFdmVudCA9IG5ldyBjcmVhdGVqcy5FdmVudCgiZXJyb3IiKTsKCQluZXdFdmVudC50ZXh0ID0gIkZJTEVfTE9BRF9FUlJPUiI7CgkJbmV3RXZlbnQuaXRlbSA9IGxvYWRlci5nZXRJdGVtKCk7CgkJLy8gVE9ETzogUHJvcGFnYXRlIGFjdHVhbCBlcnJvciBtZXNzYWdlLgoKCQl0aGlzLl9zZW5kRXJyb3IobmV3RXZlbnQpOwoKCQlpZiAoIXRoaXMuc3RvcE9uRXJyb3IpIHsKCQkJdGhpcy5fcmVtb3ZlTG9hZEl0ZW0obG9hZGVyKTsKCQkJdGhpcy5fbG9hZE5leHQoKTsKCQl9Cgl9OwoKCS8qKgoJICogQW4gaXRlbSBoYXMgZmluaXNoZWQgbG9hZGluZy4gV2UgY2FuIGFzc3VtZSB0aGF0IGl0IGlzIHRvdGFsbHkgbG9hZGVkLCBoYXMgYmVlbiBwYXJzZWQgZm9yIGltbWVkaWF0ZSB1c2UsIGFuZAoJICogaXMgYXZhaWxhYmxlIGFzIHRoZSAicmVzdWx0IiBwcm9wZXJ0eSBvbiB0aGUgbG9hZCBpdGVtLiBUaGUgcmF3IHRleHQgcmVzdWx0IGZvciBhIHBhcnNlZCBpdGVtIChzdWNoIGFzIEpTT04sIFhNTCwKCSAqIENTUywgSmF2YVNjcmlwdCwgZXRjKSBpcyBhdmFpbGFibGUgYXMgdGhlICJyYXdSZXN1bHQiIGV2ZW50LCBhbmQgY2FuIGFsc28gYmUgbG9va2VkIHVwIHVzaW5nIHt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlL2dldFJlc3VsdCJ9fXt7L2Nyb3NzTGlua319LgoJICogQG1ldGhvZCBfaGFuZGxlRmlsZUNvbXBsZXRlCgkgKiBAcGFyYW0ge09iamVjdH0gZXZlbnQgVGhlIGV2ZW50IG9iamVjdCBmcm9tIHRoZSBsb2FkZXIuCgkgKiBAcHJpdmF0ZQoJICovCglwLl9oYW5kbGVGaWxlQ29tcGxldGUgPSBmdW5jdGlvbihldmVudCkgewoJCXZhciBsb2FkZXIgPSBldmVudC50YXJnZXQ7CgkJdmFyIGl0ZW0gPSBsb2FkZXIuZ2V0SXRlbSgpOwoKCQl0aGlzLl9sb2FkZWRSZXN1bHRzW2l0ZW0uaWRdID0gbG9hZGVyLmdldFJlc3VsdCgpOwoJCWlmIChsb2FkZXIgaW5zdGFuY2VvZiBjcmVhdGVqcy5YSFJMb2FkZXIpIHsKCQkJdGhpcy5fbG9hZGVkUmF3UmVzdWx0c1tpdGVtLmlkXSA9IGxvYWRlci5nZXRSZXN1bHQodHJ1ZSk7CgkJfQoKCQl0aGlzLl9yZW1vdmVMb2FkSXRlbShsb2FkZXIpOwoKCQkvLyBFbnN1cmUgdGhhdCBzY3JpcHQgbG9hZGluZyBoYXBwZW5zIGluIHRoZSByaWdodCBvcmRlci4KCQlpZiAodGhpcy5tYWludGFpblNjcmlwdE9yZGVyICYmIGl0ZW0udHlwZSA9PSBjcmVhdGVqcy5Mb2FkUXVldWUuSkFWQVNDUklQVCkgewoJCQlpZiAobG9hZGVyIGluc3RhbmNlb2YgY3JlYXRlanMuVGFnTG9hZGVyKSB7CgkJCQl0aGlzLl9jdXJyZW50bHlMb2FkaW5nU2NyaXB0ID0gZmFsc2U7CgkJCX0gZWxzZSB7CgkJCQl0aGlzLl9sb2FkZWRTY3JpcHRzW2NyZWF0ZWpzLmluZGV4T2YodGhpcy5fc2NyaXB0T3JkZXIsIGl0ZW0pXSA9IGl0ZW07CgkJCQl0aGlzLl9jaGVja1NjcmlwdExvYWRPcmRlcihsb2FkZXIpOwoJCQkJcmV0dXJuOwoJCQl9CgkJfQoKCQkvLyBDbGVhbiB1cCB0aGUgbG9hZCBpdGVtCgkJZGVsZXRlIGl0ZW0uX2xvYWRBc0pTT05QOwoKCQkvLyBJZiB0aGUgaXRlbSB3YXMgYSBtYW5pZmVzdCwgdGhlbgoJCWlmIChpdGVtLnR5cGUgPT0gY3JlYXRlanMuTG9hZFF1ZXVlLk1BTklGRVNUKSB7CgkJCXZhciByZXN1bHQgPSBsb2FkZXIuZ2V0UmVzdWx0KCk7CgkJCWlmIChyZXN1bHQgIT0gbnVsbCAmJiByZXN1bHQubWFuaWZlc3QgIT09IHVuZGVmaW5lZCkgewoJCQkJdGhpcy5sb2FkTWFuaWZlc3QocmVzdWx0LCB0cnVlKTsKCQkJfQoJCX0KCgkJdGhpcy5fcHJvY2Vzc0ZpbmlzaGVkTG9hZChpdGVtLCBsb2FkZXIpOwoJfTsKCgkvKioKCSAqIEBtZXRob2QgX3Byb2Nlc3NGaW5pc2hlZExvYWQKCSAqIEBwYXJhbSB7T2JqZWN0fSBpdGVtCgkgKiBAcGFyYW0ge0Fic3RyYWN0TG9hZGVyfSBsb2FkZXIKCSAqIEBwcm90ZWN0ZWQKCSAqLwoJcC5fcHJvY2Vzc0ZpbmlzaGVkTG9hZCA9IGZ1bmN0aW9uKGl0ZW0sIGxvYWRlcikgewoJCS8vIE9sZCBoYW5kbGVGaWxlVGFnQ29tcGxldGUgZm9sbG93cyBoZXJlLgoJCXRoaXMuX251bUl0ZW1zTG9hZGVkKys7CgoJCXRoaXMuX3VwZGF0ZVByb2dyZXNzKCk7CgkJdGhpcy5fc2VuZEZpbGVDb21wbGV0ZShpdGVtLCBsb2FkZXIpOwoKCQl0aGlzLl9sb2FkTmV4dCgpOwoJfTsKCgkvKioKCSAqIEVuc3VyZSB0aGUgc2NyaXB0cyBsb2FkIGFuZCBkaXNwYXRjaCBpbiB0aGUgY29ycmVjdCBvcmRlci4gV2hlbiB1c2luZyBYSFIsIHNjcmlwdHMgYXJlIHN0b3JlZCBpbiBhbiBhcnJheSBpbiB0aGUKCSAqIG9yZGVyIHRoZXkgd2VyZSBhZGRlZCwgYnV0IHdpdGggYSAibnVsbCIgdmFsdWUuIFdoZW4gdGhleSBhcmUgY29tcGxldGVkLCB0aGUgdmFsdWUgaXMgc2V0IHRvIHRoZSBsb2FkIGl0ZW0sCgkgKiBhbmQgdGhlbiB3aGVuIHRoZXkgYXJlIHByb2Nlc3NlZCBhbmQgZGlzcGF0Y2hlZCwgdGhlIHZhbHVlIGlzIHNldCB0byA8Y29kZT50cnVlPC9jb2RlPi4gVGhpcyBtZXRob2Qgc2ltcGx5CgkgKiBpdGVyYXRlcyB0aGUgYXJyYXksIGFuZCBlbnN1cmVzIHRoYXQgYW55IGxvYWRlZCBpdGVtcyB0aGF0IGFyZSBub3QgcHJlY2VkZWQgYnkgYSA8Y29kZT5udWxsPC9jb2RlPiB2YWx1ZSBhcmUKCSAqIGRpc3BhdGNoZWQuCgkgKiBAbWV0aG9kIF9jaGVja1NjcmlwdExvYWRPcmRlcgoJICogQHByaXZhdGUKCSAqLwoJcC5fY2hlY2tTY3JpcHRMb2FkT3JkZXIgPSBmdW5jdGlvbiAoKSB7CgkJdmFyIGwgPSB0aGlzLl9sb2FkZWRTY3JpcHRzLmxlbmd0aDsKCgkJZm9yICh2YXIgaT0wO2k8bDtpKyspIHsKCQkJdmFyIGl0ZW0gPSB0aGlzLl9sb2FkZWRTY3JpcHRzW2ldOwoJCQlpZiAoaXRlbSA9PT0gbnVsbCkgeyBicmVhazsgfSAvLyBUaGlzIGlzIHN0aWxsIGxvYWRpbmcuIERvIG5vdCBwcm9jZXNzIGZ1cnRoZXIuCgkJCWlmIChpdGVtID09PSB0cnVlKSB7IGNvbnRpbnVlOyB9IC8vIFRoaXMgaGFzIGNvbXBsZXRlZCwgYW5kIGJlZW4gcHJvY2Vzc2VkLiBNb3ZlIG9uLgoKCQkJLy8gQXBwZW5kIHNjcmlwdCB0YWdzIHRvIHRoZSBoZWFkIGF1dG9tYXRpY2FsbHkuIFRhZ3MgZG8gdGhpcyBpbiB0aGUgbG9hZGVyLCBidXQgWEhSIHNjcmlwdHMgaGF2ZSB0byBtYWludGFpbiBvcmRlci4KCQkJdmFyIGxvYWRJdGVtID0gdGhpcy5fbG9hZGVkUmVzdWx0c1tpdGVtLmlkXTsKCQkJKGRvY3VtZW50LmJvZHkgfHwgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImJvZHkiKVswXSkuYXBwZW5kQ2hpbGQobG9hZEl0ZW0pOwoKCQkJdGhpcy5fcHJvY2Vzc0ZpbmlzaGVkTG9hZChpdGVtKTsKCQkJdGhpcy5fbG9hZGVkU2NyaXB0c1tpXSA9IHRydWU7CgkJfQoJfTsKCgkvKioKCSAqIEEgbG9hZCBpdGVtIGlzIGNvbXBsZXRlZCBvciB3YXMgY2FuY2VsZWQsIGFuZCBuZWVkcyB0byBiZSByZW1vdmVkIGZyb20gdGhlIExvYWRRdWV1ZS4KCSAqIEBtZXRob2QgX3JlbW92ZUxvYWRJdGVtCgkgKiBAcGFyYW0ge0Fic3RyYWN0TG9hZGVyfSBsb2FkZXIgQSBsb2FkZXIgaW5zdGFuY2UgdG8gcmVtb3ZlLgoJICogQHByaXZhdGUKCSAqLwoJcC5fcmVtb3ZlTG9hZEl0ZW0gPSBmdW5jdGlvbihsb2FkZXIpIHsKCQl2YXIgbCA9IHRoaXMuX2N1cnJlbnRMb2Fkcy5sZW5ndGg7CgkJZm9yICh2YXIgaT0wO2k8bDtpKyspIHsKCQkJaWYgKHRoaXMuX2N1cnJlbnRMb2Fkc1tpXSA9PSBsb2FkZXIpIHsKCQkJCXRoaXMuX2N1cnJlbnRMb2Fkcy5zcGxpY2UoaSwxKTsgYnJlYWs7CgkJCX0KCQl9Cgl9OwoKCS8qKgoJICogQW4gaXRlbSBoYXMgZGlzcGF0Y2hlZCBwcm9ncmVzcy4gUHJvcGFnYXRlIHRoYXQgcHJvZ3Jlc3MsIGFuZCB1cGRhdGUgdGhlIExvYWRRdWV1ZSBvdmVyYWxsIHByb2dyZXNzLgoJICogQG1ldGhvZCBfaGFuZGxlUHJvZ3Jlc3MKCSAqIEBwYXJhbSB7T2JqZWN0fSBldmVudCBUaGUgcHJvZ3Jlc3MgZXZlbnQgZnJvbSB0aGUgaXRlbS4KCSAqIEBwcml2YXRlCgkgKi8KCXAuX2hhbmRsZVByb2dyZXNzID0gZnVuY3Rpb24oZXZlbnQpIHsKCQl2YXIgbG9hZGVyID0gZXZlbnQudGFyZ2V0OwoJCXRoaXMuX3NlbmRGaWxlUHJvZ3Jlc3MobG9hZGVyLmdldEl0ZW0oKSwgbG9hZGVyLnByb2dyZXNzKTsKCQl0aGlzLl91cGRhdGVQcm9ncmVzcygpOwoJfTsKCgkvKioKCSAqIE92ZXJhbGwgcHJvZ3Jlc3MgaGFzIGNoYW5nZWQsIHNvIGRldGVybWluZSB0aGUgbmV3IHByb2dyZXNzIGFtb3VudCBhbmQgZGlzcGF0Y2ggaXQuIFRoaXMgY2hhbmdlcyBhbnkgdGltZSBhbgoJICogaXRlbSBkaXNwYXRjaGVzIHByb2dyZXNzIG9yIGNvbXBsZXRlcy4gTm90ZSB0aGF0IHNpbmNlIHdlIGRvbid0IGtub3cgdGhlIGFjdHVhbCBmaWxlc2l6ZSBvZiBpdGVtcyBiZWZvcmUgdGhleSBhcmUKCSAqIGxvYWRlZCwgYW5kIGV2ZW4gdGhlbiB3ZSBjYW4gb25seSBnZXQgdGhlIHNpemUgb2YgaXRlbXMgbG9hZGVkIHdpdGggWEhSLiBJbiB0aGlzIGNhc2UsIHdlIGRlZmluZSBhICJzbG90IiBmb3IKCSAqIGVhY2ggaXRlbSAoMSBpdGVtIGluIDEwIHdvdWxkIGdldCAxMCUpLCBhbmQgdGhlbiBhcHBlbmQgbG9hZGVkIHByb2dyZXNzIG9uIHRvcCBvZiB0aGUgYWxyZWFkeS1sb2FkZWQgaXRlbXMuCgkgKgoJICogRm9yIGV4YW1wbGUsIGlmIDUvMTAgaXRlbXMgaGF2ZSBsb2FkZWQsIGFuZCBpdGVtIDYgaXMgMjAlIGxvYWRlZCwgdGhlIHRvdGFsIHByb2dyZXNzIHdvdWxkIGJlOjx1bD4KCSAqICAgICAgPGxpPjUvMTAgb2YgdGhlIGl0ZW1zIGluIHRoZSBxdWV1ZSAoNTAlKTwvbGk+CgkgKiAgICAgIDxsaT5wbHVzIDIwJSBvZiBpdGVtIDYncyBzbG90ICgyJSk8L2xpPgoJICogICAgICA8bGk+ZXF1YWxzIDUyJTwvbGk+PC91bD4KCSAqIEBtZXRob2QgX3VwZGF0ZVByb2dyZXNzCgkgKiBAcHJpdmF0ZQoJICovCglwLl91cGRhdGVQcm9ncmVzcyA9IGZ1bmN0aW9uICgpIHsKCQl2YXIgbG9hZGVkID0gdGhpcy5fbnVtSXRlbXNMb2FkZWQgLyB0aGlzLl9udW1JdGVtczsgLy8gRnVsbHkgTG9hZGVkIFByb2dyZXNzCgkJdmFyIHJlbWFpbmluZyA9IHRoaXMuX251bUl0ZW1zLXRoaXMuX251bUl0ZW1zTG9hZGVkOwoJCWlmIChyZW1haW5pbmcgPiAwKSB7CgkJCXZhciBjaHVuayA9IDA7CgkJCWZvciAodmFyIGk9MCwgbD10aGlzLl9jdXJyZW50TG9hZHMubGVuZ3RoOyBpPGw7IGkrKykgewoJCQkJY2h1bmsgKz0gdGhpcy5fY3VycmVudExvYWRzW2ldLnByb2dyZXNzOwoJCQl9CgkJCWxvYWRlZCArPSAoY2h1bmsgLyByZW1haW5pbmcpICogKHJlbWFpbmluZy90aGlzLl9udW1JdGVtcyk7CgkJfQoJCXRoaXMuX3NlbmRQcm9ncmVzcyhsb2FkZWQpOwoJfTsKCgkvKioKCSAqIENsZWFuIG91dCBpdGVtIHJlc3VsdHMsIHRvIGZyZWUgdGhlbSBmcm9tIG1lbW9yeS4gTWFpbmx5LCB0aGUgbG9hZGVkIGl0ZW0gYW5kIHJlc3VsdHMgYXJlIGNsZWFyZWQgZnJvbSBpbnRlcm5hbAoJICogaGFzaGVzLgoJICogQG1ldGhvZCBfZGlzcG9zZUl0ZW0KCSAqIEBwYXJhbSB7T2JqZWN0fSBpdGVtIFRoZSBpdGVtIHRoYXQgd2FzIHBhc3NlZCBpbiBmb3IgcHJlbG9hZGluZy4KCSAqIEBwcml2YXRlCgkgKi8KCXAuX2Rpc3Bvc2VJdGVtID0gZnVuY3Rpb24oaXRlbSkgewoJCWRlbGV0ZSB0aGlzLl9sb2FkZWRSZXN1bHRzW2l0ZW0uaWRdOwoJCWRlbGV0ZSB0aGlzLl9sb2FkZWRSYXdSZXN1bHRzW2l0ZW0uaWRdOwoJCWRlbGV0ZSB0aGlzLl9sb2FkSXRlbXNCeUlkW2l0ZW0uaWRdOwoJCWRlbGV0ZSB0aGlzLl9sb2FkSXRlbXNCeVNyY1tpdGVtLnNyY107Cgl9OwoKCgkvKioKCSAqIENyZWF0ZSBhbiBIVE1MIHRhZy4gVGhpcyBpcyBpbiBMb2FkUXVldWUgaW5zdGVhZCBvZiB7eyNjcm9zc0xpbmsgIlRhZ0xvYWRlciJ9fXt7L2Nyb3NzTGlua319IGJlY2F1c2Ugbm8gbWF0dGVyCgkgKiBob3cgd2UgbG9hZCB0aGUgZGF0YSwgd2UgbWF5IG5lZWQgdG8gcmV0dXJuIGl0IGluIGEgdGFnLgoJICogQG1ldGhvZCBfY3JlYXRlVGFnCgkgKiBAcGFyYW0ge1N0cmluZ30gdHlwZSBUaGUgaXRlbSB0eXBlLiBJdGVtcyBhcmUgcGFzc2VkIGluIGJ5IHRoZSBkZXZlbG9wZXIsIG9yIGRldGVyZW1pbmVkIGJ5IHRoZSBleHRlbnNpb24uCgkgKiBAcmV0dXJuIHtIVE1MSW1hZ2VFbGVtZW50fEhUTUxBdWRpb0VsZW1lbnR8SFRNTFNjcmlwdEVsZW1lbnR8SFRNTExpbmtFbGVtZW50fE9iamVjdH0gVGhlIHRhZyB0aGF0IGlzIGNyZWF0ZWQuCgkgKiBOb3RlIHRoYXQgdGFncyBhcmUgbm90IGFwcGVuZGVkIHRvIHRoZSBIVE1MIGJvZHkuCgkgKiBAcHJpdmF0ZQoJICovCglwLl9jcmVhdGVUYWcgPSBmdW5jdGlvbihpdGVtKSB7CgkJdmFyIHRhZyA9IG51bGw7CgkJc3dpdGNoIChpdGVtLnR5cGUpIHsKCQkJY2FzZSBjcmVhdGVqcy5Mb2FkUXVldWUuSU1BR0U6CgkJCQl0YWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbWciKTsKCQkJCWlmICh0aGlzLl9jcm9zc09yaWdpbiAhPSAiIiAmJiAhdGhpcy5faXNMb2NhbChpdGVtKSkgeyB0YWcuY3Jvc3NPcmlnaW4gPSB0aGlzLl9jcm9zc09yaWdpbjsgfQoJCQkJcmV0dXJuIHRhZzsKCQkJY2FzZSBjcmVhdGVqcy5Mb2FkUXVldWUuU09VTkQ6CgkJCQl0YWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJhdWRpbyIpOwoJCQkJdGFnLmF1dG9wbGF5ID0gZmFsc2U7CgkJCQkvLyBOb3RlOiBUaGUgdHlwZSBwcm9wZXJ0eSBkb2Vzbid0IHNlZW0gbmVjZXNzYXJ5LgoJCQkJcmV0dXJuIHRhZzsKCQkJY2FzZSBjcmVhdGVqcy5Mb2FkUXVldWUuSlNPTjoKCQkJY2FzZSBjcmVhdGVqcy5Mb2FkUXVldWUuSlNPTlA6CgkJCWNhc2UgY3JlYXRlanMuTG9hZFF1ZXVlLkpBVkFTQ1JJUFQ6CgkJCWNhc2UgY3JlYXRlanMuTG9hZFF1ZXVlLk1BTklGRVNUOgoJCQkJdGFnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic2NyaXB0Iik7CgkJCQl0YWcudHlwZSA9ICJ0ZXh0L2phdmFzY3JpcHQiOwoJCQkJcmV0dXJuIHRhZzsKCQkJY2FzZSBjcmVhdGVqcy5Mb2FkUXVldWUuQ1NTOgoJCQkJaWYgKHRoaXMudXNlWEhSKSB7CgkJCQkJdGFnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic3R5bGUiKTsKCQkJCX0gZWxzZSB7CgkJCQkJdGFnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgibGluayIpOwoJCQkJfQoJCQkJdGFnLnJlbCAgPSAic3R5bGVzaGVldCI7CgkJCQl0YWcudHlwZSA9ICJ0ZXh0L2NzcyI7CgkJCQlyZXR1cm4gdGFnOwoJCQljYXNlIGNyZWF0ZWpzLkxvYWRRdWV1ZS5TVkc6CgkJCQlpZiAodGhpcy51c2VYSFIpIHsKCQkJCQl0YWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzdmciKTsKCQkJCX0gZWxzZSB7CgkJCQkJdGFnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgib2JqZWN0Iik7CgkJCQkJdGFnLnR5cGUgPSAiaW1hZ2Uvc3ZnK3htbCI7CgkJCQl9CgkJCQlyZXR1cm4gdGFnOwoJCX0KCQlyZXR1cm4gbnVsbDsKCX07CgoJLyoqCgkgKiBEZXRlcm1pbmUgdGhlIHR5cGUgb2YgdGhlIG9iamVjdCB1c2luZyBjb21tb24gZXh0ZW5zaW9ucy4gTm90ZSB0aGF0IHRoZSB0eXBlIGNhbiBiZSBwYXNzZWQgaW4gd2l0aCB0aGUgbG9hZCBpdGVtCgkgKiBpZiBpdCBpcyBhbiB1bnVzdWFsIGV4dGVuc2lvbi4KCSAqIEBwYXJhbSB7U3RyaW5nfSBleHRlbnNpb24gVGhlIGZpbGUgZXh0ZW5zaW9uIHRvIHVzZSB0byBkZXRlcm1pbmUgdGhlIGxvYWQgdHlwZS4KCSAqIEByZXR1cm4ge1N0cmluZ30gVGhlIGRldGVybWluZWQgbG9hZCB0eXBlIChmb3IgZXhhbXBsZSwgPGNvZGU+TG9hZFF1ZXVlLklNQUdFPC9jb2RlPiBvciBudWxsIGlmIGl0IGNhbiBub3QgYmUKCSAqIGRldGVybWluZWQgYnkgdGhlIGV4dGVuc2lvbi4KCSAqIEBwcml2YXRlCgkgKi8KCXAuX2dldFR5cGVCeUV4dGVuc2lvbiA9IGZ1bmN0aW9uKGV4dGVuc2lvbikgewoJCWlmIChleHRlbnNpb24gPT0gbnVsbCkgewoJCQlyZXR1cm4gY3JlYXRlanMuTG9hZFF1ZXVlLlRFWFQ7CgkJfQoJCXN3aXRjaCAoZXh0ZW5zaW9uLnRvTG93ZXJDYXNlKCkpIHsKCQkJY2FzZSAianBlZyI6CgkJCWNhc2UgImpwZyI6CgkJCWNhc2UgImdpZiI6CgkJCWNhc2UgInBuZyI6CgkJCWNhc2UgIndlYnAiOgoJCQljYXNlICJibXAiOgoJCQkJcmV0dXJuIGNyZWF0ZWpzLkxvYWRRdWV1ZS5JTUFHRTsKCQkJY2FzZSAib2dnIjoKCQkJY2FzZSAibXAzIjoKCQkJY2FzZSAid2F2IjoKCQkJCXJldHVybiBjcmVhdGVqcy5Mb2FkUXVldWUuU09VTkQ7CgkJCWNhc2UgImpzb24iOgoJCQkJcmV0dXJuIGNyZWF0ZWpzLkxvYWRRdWV1ZS5KU09OOwoJCQljYXNlICJ4bWwiOgoJCQkJcmV0dXJuIGNyZWF0ZWpzLkxvYWRRdWV1ZS5YTUw7CgkJCWNhc2UgImNzcyI6CgkJCQlyZXR1cm4gY3JlYXRlanMuTG9hZFF1ZXVlLkNTUzsKCQkJY2FzZSAianMiOgoJCQkJcmV0dXJuIGNyZWF0ZWpzLkxvYWRRdWV1ZS5KQVZBU0NSSVBUOwoJCQljYXNlICdzdmcnOgoJCQkJcmV0dXJuIGNyZWF0ZWpzLkxvYWRRdWV1ZS5TVkc7CgkJCWRlZmF1bHQ6CgkJCQlyZXR1cm4gY3JlYXRlanMuTG9hZFF1ZXVlLlRFWFQ7CgkJfQoJfTsKCgkvKioKCSAqIERpc3BhdGNoIGEgZmlsZXByb2dyZXNzIGV2ZW50IChhbmQgb25GaWxlUHJvZ3Jlc3MgY2FsbGJhY2spLiBQbGVhc2Ugc2VlIHRoZSA8Y29kZT5Mb2FkUXVldWUuZmlsZXByb2dyZXNzPC9jb2RlPgoJICogZXZlbnQgZm9yIGRldGFpbHMgb24gdGhlIGV2ZW50IHBheWxvYWQuCgkgKiBAbWV0aG9kIF9zZW5kRmlsZVByb2dyZXNzCgkgKiBAcGFyYW0ge09iamVjdH0gaXRlbSBUaGUgaXRlbSB0aGF0IGlzIGJlaW5nIGxvYWRlZC4KCSAqIEBwYXJhbSB7TnVtYmVyfSBwcm9ncmVzcyBUaGUgYW1vdW50IHRoZSBpdGVtIGhhcyBiZWVuIGxvYWRlZCAoYmV0d2VlbiAwIGFuZCAxKS4KCSAqIEBwcm90ZWN0ZWQKCSAqLwoJcC5fc2VuZEZpbGVQcm9ncmVzcyA9IGZ1bmN0aW9uKGl0ZW0sIHByb2dyZXNzKSB7CgkJaWYgKHRoaXMuX2lzQ2FuY2VsZWQoKSkgewoJCQl0aGlzLl9jbGVhblVwKCk7CgkJCXJldHVybjsKCQl9CgkJaWYgKCF0aGlzLmhhc0V2ZW50TGlzdGVuZXIoImZpbGVwcm9ncmVzcyIpKSB7IHJldHVybjsgfQoKCQl2YXIgZXZlbnQgPSBuZXcgY3JlYXRlanMuRXZlbnQoImZpbGVwcm9ncmVzcyIpOwoJCWV2ZW50LnByb2dyZXNzID0gcHJvZ3Jlc3M7CgkJZXZlbnQubG9hZGVkID0gcHJvZ3Jlc3M7CgkJZXZlbnQudG90YWwgPSAxOwoJCWV2ZW50Lml0ZW0gPSBpdGVtOwoKCQl0aGlzLmRpc3BhdGNoRXZlbnQoZXZlbnQpOwoJfTsKCgkvKioKCSAqIERpc3BhdGNoIGEgZmlsZWxvYWQgZXZlbnQuIFBsZWFzZSBzZWUgdGhlIHt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlL2ZpbGVsb2FkOmV2ZW50In19e3svY3Jvc3NMaW5rfX0gZXZlbnQgZm9yCgkgKiBkZXRhaWxzIG9uIHRoZSBldmVudCBwYXlsb2FkLgoJICogQG1ldGhvZCBfc2VuZEZpbGVDb21wbGV0ZQoJICogQHBhcmFtIHtPYmplY3R9IGl0ZW0gVGhlIGl0ZW0gdGhhdCBpcyBiZWluZyBsb2FkZWQuCgkgKiBAcGFyYW0ge1RhZ0xvYWRlciB8IFhIUkxvYWRlcn0gbG9hZGVyCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXAuX3NlbmRGaWxlQ29tcGxldGUgPSBmdW5jdGlvbihpdGVtLCBsb2FkZXIpIHsKCQlpZiAodGhpcy5faXNDYW5jZWxlZCgpKSB7IHJldHVybjsgfQoKCQl2YXIgZXZlbnQgPSBuZXcgY3JlYXRlanMuRXZlbnQoImZpbGVsb2FkIik7CgkJZXZlbnQubG9hZGVyID0gbG9hZGVyOwoJCWV2ZW50Lml0ZW0gPSBpdGVtOwoJCWV2ZW50LnJlc3VsdCA9IHRoaXMuX2xvYWRlZFJlc3VsdHNbaXRlbS5pZF07CgkJZXZlbnQucmF3UmVzdWx0ID0gdGhpcy5fbG9hZGVkUmF3UmVzdWx0c1tpdGVtLmlkXTsKCiAgICAgICAgLy8gVGhpcyBjYWxscyBhIGhhbmRsZXIgc3BlY2lmaWVkIG9uIHRoZSBhY3R1YWwgbG9hZCBpdGVtLiBDdXJyZW50bHksIHRoZSBTb3VuZEpTIHBsdWdpbiB1c2VzIHRoaXMuCiAgICAgICAgaWYgKGl0ZW0uY29tcGxldGVIYW5kbGVyKSB7CiAgICAgICAgICAgIGl0ZW0uY29tcGxldGVIYW5kbGVyKGV2ZW50KTsKICAgICAgICB9CgoJCXRoaXMuaGFzRXZlbnRMaXN0ZW5lcigiZmlsZWxvYWQiKSAmJiB0aGlzLmRpc3BhdGNoRXZlbnQoZXZlbnQpCgl9OwoKCS8qKgoJICogRGlzcGF0Y2ggYSBmaWxlc3RhcnQgZXZlbnQgaW1tZWRpYXRlbHkgYmVmb3JlIGEgZmlsZSBzdGFydHMgdG8gbG9hZC4gUGxlYXNlIHNlZSB0aGUge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvZmlsZXN0YXJ0OmV2ZW50In19e3svY3Jvc3NMaW5rfX0KCSAqIGV2ZW50IGZvciBkZXRhaWxzIG9uIHRoZSBldmVudCBwYXlsb2FkLgoJICogQG1ldGhvZCBfc2VuZEZpbGVTdGFydAoJICogQHBhcmFtIHtPYmplY3R9IGl0ZW0gVGhlIGl0ZW0gdGhhdCBpcyBiZWluZyBsb2FkZWQuCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXAuX3NlbmRGaWxlU3RhcnQgPSBmdW5jdGlvbihpdGVtKSB7CgkJdmFyIGV2ZW50ID0gbmV3IGNyZWF0ZWpzLkV2ZW50KCJmaWxlc3RhcnQiKTsKCQlldmVudC5pdGVtID0gaXRlbTsKCQl0aGlzLmhhc0V2ZW50TGlzdGVuZXIoImZpbGVzdGFydCIpICYmIHRoaXMuZGlzcGF0Y2hFdmVudChldmVudCk7Cgl9OwoKCS8qKgoJICogUkVNT1ZFRC4gIFVzZSBjcmVhdGVqcy5wcm94eSBpbnN0ZWFkCgkgKiBAbWV0aG9kIHByb3h5CgkgKiBAcGFyYW0ge0Z1bmN0aW9ufSBtZXRob2QgVGhlIGZ1bmN0aW9uIHRvIGNhbGwKCSAqIEBwYXJhbSB7T2JqZWN0fSBzY29wZSBUaGUgc2NvcGUgdG8gY2FsbCB0aGUgbWV0aG9kIG5hbWUgb24KCSAqIEBzdGF0aWMKCSAqIEBwcml2YXRlCgkgKiBAZGVwcmVjYXRlZCBJbiBmYXZvdXIgb2YgdGhlIGNyZWF0ZWpzLnByb3h5IG1ldGhvZCAoc2VlIExvYWRRdWV1ZSBzb3VyY2UpLgoJICovCgoJcC50b1N0cmluZyA9IGZ1bmN0aW9uKCkgewoJCXJldHVybiAiW1ByZWxvYWRKUyBMb2FkUXVldWVdIjsKCX07CgoJY3JlYXRlanMuTG9hZFF1ZXVlID0gTG9hZFF1ZXVlOwoKCi8vIEhlbHBlciBtZXRob2RzCgoJLy8gQW4gYWRkaXRpb25hbCBtb2R1bGUgdG8gZGV0ZXJtaW5lIHRoZSBjdXJyZW50IGJyb3dzZXIsIHZlcnNpb24sIG9wZXJhdGluZyBzeXN0ZW0sIGFuZCBvdGhlciBlbnZpcm9ubWVudGFsIHZhcmlhYmxlcy4KCXZhciBCcm93c2VyRGV0ZWN0ID0gZnVuY3Rpb24oKSB7fQoKCUJyb3dzZXJEZXRlY3QuaW5pdCA9IGZ1bmN0aW9uKCkgewoJCXZhciBhZ2VudCA9IG5hdmlnYXRvci51c2VyQWdlbnQ7CgkJQnJvd3NlckRldGVjdC5pc0ZpcmVmb3ggPSAoYWdlbnQuaW5kZXhPZigiRmlyZWZveCIpID4gLTEpOwoJCUJyb3dzZXJEZXRlY3QuaXNPcGVyYSA9ICh3aW5kb3cub3BlcmEgIT0gbnVsbCk7CgkJQnJvd3NlckRldGVjdC5pc0Nocm9tZSA9IChhZ2VudC5pbmRleE9mKCJDaHJvbWUiKSA+IC0xKTsKCQlCcm93c2VyRGV0ZWN0LmlzSU9TID0gYWdlbnQuaW5kZXhPZigiaVBvZCIpID4gLTEgfHwgYWdlbnQuaW5kZXhPZigiaVBob25lIikgPiAtMSB8fCBhZ2VudC5pbmRleE9mKCJpUGFkIikgPiAtMTsKCX07CgoJQnJvd3NlckRldGVjdC5pbml0KCk7CgoJY3JlYXRlanMuTG9hZFF1ZXVlLkJyb3dzZXJEZXRlY3QgPSBCcm93c2VyRGV0ZWN0OwoKfSgpKTsKLyoKKiBUYWdMb2FkZXIKKiBWaXNpdCBodHRwOi8vY3JlYXRlanMuY29tLyBmb3IgZG9jdW1lbnRhdGlvbiwgdXBkYXRlcyBhbmQgZXhhbXBsZXMuCioKKgoqIENvcHlyaWdodCAoYykgMjAxMiBnc2tpbm5lci5jb20sIGluYy4KKgoqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uCiogb2J0YWluaW5nIGEgY29weSBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24KKiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0CiogcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0cyB0byB1c2UsCiogY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwKKiBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUKKiBTb2Z0d2FyZSBpcyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZwoqIGNvbmRpdGlvbnM6CioKKiBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZQoqIGluY2x1ZGVkIGluIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLgoqCiogVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsCiogRVhQUkVTUyBPUiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTCiogT0YgTUVSQ0hBTlRBQklMSVRZLCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQKKiBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBBVVRIT1JTIE9SIENPUFlSSUdIVAoqIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVIgTElBQklMSVRZLAoqIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORwoqIEZST00sIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IKKiBPVEhFUiBERUFMSU5HUyBJTiBUSEUgU09GVFdBUkUuCiovCgovKioKICogQG1vZHVsZSBQcmVsb2FkSlMKICovCgovLyBuYW1lc3BhY2U6CnRoaXMuY3JlYXRlanMgPSB0aGlzLmNyZWF0ZWpzfHx7fTsKCihmdW5jdGlvbigpIHsKCSJ1c2Ugc3RyaWN0IjsKCS8qKgoJICogQSBwcmVsb2FkZXIgdGhhdCBsb2FkcyBpdGVtcyB1c2luZyBhIHRhZy1iYXNlZCBhcHByb2FjaC4gSFRNTCBhdWRpbyBhbmQgaW1hZ2VzIGNhbiB1c2UgdGhpcyBsb2FkZXIgdG8gbG9hZAoJICogY29udGVudCBjcm9zcy1kb21haW4gd2l0aG91dCBzZWN1cml0eSBlcnJvcnMsIHdoZXJlYXMgYW55dGhpbmcgbG9hZGVkIHdpdGggWEhSIGhhcyBwb3RlbnRpYWwgaXNzdWVzIHdpdGggY3Jvc3MtCgkgKiBkb21haW4gcmVxdWVzdHMuCgkgKgoJICogTm90ZSBmb3IgYXVkaW8gdGFncywgVGFnTG9hZGVyIHJlbGllcyBvbiB0aGUgPGNvZGU+Y2FuUGxheVRocm91Z2g8L2NvZGU+IGV2ZW50LCB3aGljaCBmaXJlcyB3aGVuIHRoZSBidWZmZXIKCSAqIGlzIGZ1bGwgZW5vdWdoIHRvIHBsYXkgdGhlIGF1ZGlvIGFsbCB0aGUgd2F5IHRocm91Z2ggYXQgdGhlIGN1cnJlbnQgZG93bmxvYWQgc3BlZWQuIFRoaXMgY29tcGxldGVseSBwcmVsb2FkcyBtb3N0CgkgKiBzb3VuZCBlZmZlY3RzLCBob3dldmVyIGxvbmdlciB0cmFja3MgbGlrZSBiYWNrZ3JvdW5kIGF1ZGlvIHdpbGwgb25seSBsb2FkIGEgcG9ydGlvbiBiZWZvcmUgdGhlIGV2ZW50IGlzIGZpcmVkLgoJICogTW9zdCBicm93c2VycyAoYWxsIGV4Y2x1ZGluZyBDaHJvbWUpIHdpbGwgY29udGludWUgdG8gcHJlbG9hZCBvbmNlIHRoaXMgaXMgZmlyZWQsIHNvIHRoaXMgaXMgY29uc2lkZXJlZCBnb29kCgkgKiBlbm91Z2ggZm9yIG1vc3QgY2FzZXMuCgkgKiBAY2xhc3MgVGFnTG9hZGVyCgkgKiBAY29uc3RydWN0b3IKCSAqIEBleHRlbmRzIEFic3RyYWN0TG9hZGVyCgkgKiBAcGFyYW0ge09iamVjdH0gaXRlbSBUaGUgaXRlbSB0byBsb2FkLiBQbGVhc2Ugc2VlIHt7I2Nyb3NzTGluayAiTG9hZFF1ZXVlL2xvYWRGaWxlIn19e3svY3Jvc3NMaW5rfX0gZm9yCgkgKiBpbmZvcm1hdGlvbiBvbiBsb2FkIGl0ZW1zLgoJICovCgl2YXIgVGFnTG9hZGVyID0gZnVuY3Rpb24gKGl0ZW0pIHsKCQl0aGlzLmluaXQoaXRlbSk7Cgl9OwoKCXZhciBwID0gVGFnTG9hZGVyLnByb3RvdHlwZSA9IG5ldyBjcmVhdGVqcy5BYnN0cmFjdExvYWRlcigpOwoKLy8gUHJvdGVjdGVkCgoJLyoqCgkgKiBUaGUgdGltZW91dCB0aGF0IGlzIGZpcmVkIGlmIG5vdGhpbmcgaXMgbG9hZGVkIGFmdGVyIGEgY2VydGFpbiBkZWxheS4gU2VlIHRoZSA8Y29kZT5Mb2FkUXVldWUuTE9BRF9USU1FT1VUPC9jb2RlPgoJICogZm9yIHRoZSB0aW1lb3V0IGR1cmF0aW9uLgoJICogQHByb3BlcnR5IF9sb2FkVGltZW91dAoJICogQHR5cGUge051bWJlcn0KCSAqIEBwcml2YXRlCgkgKi8KCXAuX2xvYWRUaW1lb3V0ID0gbnVsbDsKCgkvKioKCSAqIEEgcmVmZXJlbmNlIHRvIGEgYm91bmQgZnVuY3Rpb24sIHdoaWNoIHdlIG5lZWQgaW4gb3JkZXIgdG8gcHJvcGVybHkgcmVtb3ZlIHRoZSBldmVudCBoYW5kbGVyIHdoZW4gdGhlIGxvYWQKCSAqIGNvbXBsZXRlcy4KCSAqIEBwcm9wZXJ0eSBfdGFnQ29tcGxldGVQcm94eQoJICogQHR5cGUge0Z1bmN0aW9ufQoJICogQHByaXZhdGUKCSAqLwoJcC5fdGFnQ29tcGxldGVQcm94eSA9IG51bGw7CgoJLyoqCgkgKiBEZXRlcm1pbmVzIGlmIHRoZSBsb2FkIGl0ZW0gaXMgYW4gYXVkaW8gdGFnLCBzaW5jZSB3ZSB0YWtlIHNvbWUgc3BlY2lmaWMgYXBwcm9hY2hlcyB0byBwcm9wZXJseSBsb2FkIGF1ZGlvLgoJICogQHByb3BlcnR5IF9pc0F1ZGlvCgkgKiBAdHlwZSB7Qm9vbGVhbn0KCSAqIEBkZWZhdWx0IGZhbHNlCgkgKiBAcHJvdGVjdGVkCgkgKi8KCXAuX2lzQXVkaW8gPSBmYWxzZTsKCgkvKioKCSAqIFRoZSBIVE1MIHRhZyBvciBKYXZhU2NyaXB0IG9iamVjdCB0aGlzIGxvYWRlciB1c2VzIHRvIHByZWxvYWQgY29udGVudC4gTm90ZSB0aGF0IGEgdGFnIG1heSBiZSBhIGN1c3RvbSBvYmplY3QKCSAqIHRoYXQgbWF0Y2hlcyB0aGUgQVBJIG9mIGFuIEhUTUwgdGFnIChsb2FkIG1ldGhvZCwgb25sb2FkIGNhbGxiYWNrKS4gRm9yIGV4YW1wbGUsIGZsYXNoIGF1ZGlvIGZyb20gU291bmRKUyBwYXNzZXMKCSAqIGluIGEgY3VzdG9tIG9iamVjdCB0byBoYW5kbGUgcHJlbG9hZGluZyBmb3IgRmxhc2ggYXVkaW8gYW5kIFdlYkF1ZGlvLgoJICogQHByb3BlcnR5IF90YWcKCSAqIEB0eXBlIHtIVE1MQXVkaW9FbGVtZW50IHwgT2JqZWN0fQoJICogQHByaXZhdGUKCSAqLwoJcC5fdGFnID0gbnVsbDsKCgkvKioKCSAqIFdoZW4gbG9hZGluZyBhIEpTT05QIHJlcXVlc3QgdGhpcyB3aWxsIGJlIHRoZSBwYXJzZWQgSlNPTiByZXN1bHQuCgkgKgoJICogQHR5cGUge09iamVjdH0KCSAqIEBwcml2YXRlCgkgKi8KCXAuX2pzb25SZXN1bHQgPSBudWxsOwoKCS8vIE92ZXJyaWRlcyBhYnN0cmFjdCBtZXRob2QgaW4gQWJzdHJhY3RMb2FkZXIKCXAuaW5pdCA9IGZ1bmN0aW9uIChpdGVtKSB7CgkJdGhpcy5faXRlbSA9IGl0ZW07CgkJdGhpcy5fdGFnID0gaXRlbS50YWc7CgkJdGhpcy5faXNBdWRpbyA9ICh3aW5kb3cuSFRNTEF1ZGlvRWxlbWVudCAmJiBpdGVtLnRhZyBpbnN0YW5jZW9mIHdpbmRvdy5IVE1MQXVkaW9FbGVtZW50KTsKCQl0aGlzLl90YWdDb21wbGV0ZVByb3h5ID0gY3JlYXRlanMucHJveHkodGhpcy5faGFuZGxlTG9hZCwgdGhpcyk7Cgl9OwoKCS8qKgoJICogR2V0IHRoZSBsb2FkZWQgY29udGVudC4gVGhpcyBpcyB1c3VhbGx5IGFuIEhUTUwgdGFnIG9yIG90aGVyIHRhZy1zdHlsZSBvYmplY3QgdGhhdCBoYXMgYmVlbiBmdWxseSBsb2FkZWQuIElmIHRoZQoJICogbG9hZGVyIGlzIG5vdCBjb21wbGV0ZSwgdGhpcyB3aWxsIGJlIG51bGwuCgkgKiBAbWV0aG9kIGdldFJlc3VsdAoJICogQHJldHVybiB7SFRNTEltYWdlRWxlbWVudCB8IEhUTUxBdWRpb0VsZW1lbnQgfCBPYmplY3R9IFRoZSBsb2FkZWQgYW5kIHBhcnNlZCBjb250ZW50LgoJICovCglwLmdldFJlc3VsdCA9IGZ1bmN0aW9uKCkgewoJCWlmICh0aGlzLl9pdGVtLnR5cGUgPT0gY3JlYXRlanMuTG9hZFF1ZXVlLkpTT05QIHx8IHRoaXMuX2l0ZW0udHlwZSA9PSBjcmVhdGVqcy5Mb2FkUXVldWUuTUFOSUZFU1QpIHsKCQkJcmV0dXJuIHRoaXMuX2pzb25SZXN1bHQ7CgkJfSBlbHNlIHsKCQkJcmV0dXJuIHRoaXMuX3RhZzsKCQl9Cgl9OwoKCS8vIE92ZXJyaWRlcyBhYnN0cmFjdCBtZXRob2QgaW4gQWJzdHJhY3RMb2FkZXIKCXAuY2FuY2VsID0gZnVuY3Rpb24oKSB7CgkJdGhpcy5jYW5jZWxlZCA9IHRydWU7CgkJdGhpcy5fY2xlYW4oKTsKCX07CgoJLy8gT3ZlcnJpZGVzIGFic3RyYWN0IG1ldGhvZCBpbiBBYnN0cmFjdExvYWRlcgoJcC5sb2FkID0gZnVuY3Rpb24oKSB7CgkJdmFyIGl0ZW0gPSB0aGlzLl9pdGVtOwoJCXZhciB0YWcgPSB0aGlzLl90YWc7CgoJCWNsZWFyVGltZW91dCh0aGlzLl9sb2FkVGltZW91dCk7IC8vIENsZWFyIG91dCBhbnkgZXhpc3RpbmcgdGltZW91dAoJCXZhciBkdXJhdGlvbiA9IGNyZWF0ZWpzLkxvYWRRdWV1ZS5MT0FEX1RJTUVPVVQ7CgkJaWYgKGR1cmF0aW9uID09IDApIHsgZHVyYXRpb24gPSBjcmVhdGVqcy5Mb2FkUXVldWUubG9hZFRpbWVvdXQ7IH0KCQl0aGlzLl9sb2FkVGltZW91dCA9IHNldFRpbWVvdXQoY3JlYXRlanMucHJveHkodGhpcy5faGFuZGxlVGltZW91dCwgdGhpcyksIGR1cmF0aW9uKTsKCgkJaWYgKHRoaXMuX2lzQXVkaW8pIHsKCQkJdGFnLnNyYyA9IG51bGw7IC8vIFVuc2V0IHRoZSBzb3VyY2Ugc28gd2UgY2FuIHNldCB0aGUgcHJlbG9hZCB0eXBlIHRvICJhdXRvIiB3aXRob3V0IGtpY2tpbmcgb2ZmIGEgbG9hZC4gVGhpcyBpcyBvbmx5IG5lY2Vzc2FyeSBmb3IgYXVkaW8gdGFncyBwYXNzZWQgaW4gYnkgdGhlIGRldmVsb3Blci4KCQkJdGFnLnByZWxvYWQgPSAiYXV0byI7CgkJfQoKCQkvLyBIYW5kbGVycyBmb3IgYWxsIHRhZ3MKCQl0YWcub25lcnJvciA9IGNyZWF0ZWpzLnByb3h5KHRoaXMuX2hhbmRsZUVycm9yLCAgdGhpcyk7CgkJLy8gTm90ZTogV2Ugb25seSBnZXQgcHJvZ3Jlc3MgZXZlbnRzIGluIENocm9tZSwgYnV0IGRvIG5vdCBmdWxseSBsb2FkIHRhZ3MgaW4gQ2hyb21lIGR1ZSB0byBpdHMgYmVoYXZpb3VyLCBzbyB3ZSBpZ25vcmUgcHJvZ3Jlc3MuCgoJCWlmICh0aGlzLl9pc0F1ZGlvKSB7CgkJCXRhZy5vbnN0YWxsZWQgPSBjcmVhdGVqcy5wcm94eSh0aGlzLl9oYW5kbGVTdGFsbGVkLCAgdGhpcyk7CgkJCS8vIFRoaXMgd2lsbCB0ZWxsIHVzIHdoZW4gYXVkaW8gaXMgYnVmZmVyZWQgZW5vdWdoIHRvIHBsYXkgdGhyb3VnaCwgYnV0IG5vdCB3aGVuIGl0cyBsb2FkZWQuCgkJCS8vIFRoZSB0YWcgZG9lc24ndCBrZWVwIGxvYWRpbmcgaW4gQ2hyb21lIG9uY2UgZW5vdWdoIGhhcyBidWZmZXJlZCwgYW5kIHdlIGhhdmUgZGVjaWRlZCB0aGF0IGJlaGF2aW91ciBpcyBzdWZmaWNpZW50LgoJCQl0YWcuYWRkRXZlbnRMaXN0ZW5lcigiY2FucGxheXRocm91Z2giLCB0aGlzLl90YWdDb21wbGV0ZVByb3h5LCBmYWxzZSk7IC8vIGNhbnBsYXl0aHJvdWdoIGNhbGxiYWNrIGRvZXNuJ3Qgd29yayBpbiBDaHJvbWUsIHNvIHdlIHVzZSBhbiBldmVudC4KCQl9IGVsc2UgewoJCQl0YWcub25sb2FkID0gY3JlYXRlanMucHJveHkodGhpcy5faGFuZGxlTG9hZCwgIHRoaXMpOwoJCQl0YWcub25yZWFkeXN0YXRlY2hhbmdlID0gY3JlYXRlanMucHJveHkodGhpcy5faGFuZGxlUmVhZHlTdGF0ZUNoYW5nZSwgIHRoaXMpOwoJCX0KCgkJdmFyIHNyYyA9IHRoaXMuYnVpbGRQYXRoKGl0ZW0uc3JjLCBpdGVtLnZhbHVlcyk7CgoJCS8vIFNldCB0aGUgc3JjIGFmdGVyIHRoZSBldmVudHMgYXJlIGFsbCBhZGRlZC4KCQlzd2l0Y2goaXRlbS50eXBlKSB7CgkJCWNhc2UgY3JlYXRlanMuTG9hZFF1ZXVlLkNTUzoKCQkJCXRhZy5ocmVmID0gc3JjOwoJCQkJYnJlYWs7CgkJCWNhc2UgY3JlYXRlanMuTG9hZFF1ZXVlLlNWRzoKCQkJCXRhZy5kYXRhID0gc3JjOwoJCQkJYnJlYWs7CgkJCWRlZmF1bHQ6CgkJCQl0YWcuc3JjID0gc3JjOwoJCX0KCgkJLy8gSWYgd2UncmUgbG9hZGluZyBKU09OUCwgd2UgbmVlZCB0byBhZGQgb3VyIGNhbGxiYWNrIG5vdy4KCQlpZiAoaXRlbS50eXBlID09IGNyZWF0ZWpzLkxvYWRRdWV1ZS5KU09OUAoJCQkJfHwgaXRlbS50eXBlID09IGNyZWF0ZWpzLkxvYWRRdWV1ZS5KU09OCgkJCQl8fCBpdGVtLnR5cGUgPT0gY3JlYXRlanMuTG9hZFF1ZXVlLk1BTklGRVNUKSB7CgkJCWlmIChpdGVtLmNhbGxiYWNrID09IG51bGwpIHsKCQkJCXRocm93IG5ldyBFcnJvcignY2FsbGJhY2sgaXMgcmVxdWlyZWQgZm9yIGxvYWRpbmcgSlNPTlAgcmVxdWVzdHMuJyk7CgkJCX0KCgkJCWlmICh3aW5kb3dbaXRlbS5jYWxsYmFja10gIT0gbnVsbCkgewoJCQkJdGhyb3cgbmV3IEVycm9yKCdKU09OUCBjYWxsYmFjayAiJyArIGl0ZW0uY2FsbGJhY2sgKyAnIiBhbHJlYWR5IGV4aXN0cyBvbiB3aW5kb3cuIFlvdSBuZWVkIHRvIHNwZWNpZnkgYSBkaWZmZXJlbnQgY2FsbGJhY2suIE9yIHJlLW5hbWUgdGhlIGN1cnJlbnQgb25lLicpOwoJCQl9CgoJCQl3aW5kb3dbaXRlbS5jYWxsYmFja10gPSBjcmVhdGVqcy5wcm94eSh0aGlzLl9oYW5kbGVKU09OUExvYWQsIHRoaXMpOwoJCX0KCgkJLy8gSWYgaXRzIFNWRywgaXQgbmVlZHMgdG8gYmUgb24gdGhlIERPTSB0byBsb2FkICh3ZSByZW1vdmUgaXQgYmVmb3JlIHNlbmRpbmcgY29tcGxldGUpLgoJCS8vIEl0IGlzIGltcG9ydGFudCB0aGF0IHRoaXMgaGFwcGVucyBBRlRFUiBzZXR0aW5nIHRoZSBzcmMvZGF0YS4KCQlpZiAoaXRlbS50eXBlID09IGNyZWF0ZWpzLkxvYWRRdWV1ZS5TVkcgfHwKCQkJaXRlbS50eXBlID09IGNyZWF0ZWpzLkxvYWRRdWV1ZS5KU09OUCB8fAoJCQlpdGVtLnR5cGUgPT0gY3JlYXRlanMuTG9hZFF1ZXVlLkpTT04gfHwKCQkJaXRlbS50eXBlID09IGNyZWF0ZWpzLkxvYWRRdWV1ZS5NQU5JRkVTVCB8fAoJCQlpdGVtLnR5cGUgPT0gY3JlYXRlanMuTG9hZFF1ZXVlLkpBVkFTQ1JJUFQgfHwKCQkJaXRlbS50eXBlID09IGNyZWF0ZWpzLkxvYWRRdWV1ZS5DU1MpIHsKCQkJCXRoaXMuX3N0YXJ0VGFnVmlzaWJpbGl0eSA9IHRhZy5zdHlsZS52aXNpYmlsaXR5OwoJCQkJdGFnLnN0eWxlLnZpc2liaWxpdHkgPSAiaGlkZGVuIjsKCQkJCShkb2N1bWVudC5ib2R5IHx8IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJib2R5IilbMF0pLmFwcGVuZENoaWxkKHRhZyk7CgkJfQoKCQkvLyBOb3RlOiBQcmV2aW91cyB2ZXJzaW9ucyBkaWRuJ3Qgc2VlbSB0byB3b3JrIHdoZW4gd2UgY2FsbGVkIGxvYWQoKSBmb3IgT0dHIHRhZ3MgaW4gRmlyZWZveC4gU2VlbXMgZml4ZWQgaW4gMTUuMC4xCgkJaWYgKHRhZy5sb2FkICE9IG51bGwpIHsKCQkJdGFnLmxvYWQoKTsKCQl9Cgl9OwoKCXAuX2hhbmRsZUpTT05QTG9hZCA9IGZ1bmN0aW9uKGRhdGEpIHsKCQl0aGlzLl9qc29uUmVzdWx0ID0gZGF0YTsKCX07CgoJLyoqCgkgKiBIYW5kbGUgYW4gYXVkaW8gdGltZW91dC4gTmV3ZXIgYnJvd3NlcnMgZ2V0IGEgY2FsbGJhY2sgZnJvbSB0aGUgdGFncywgYnV0IG9sZGVyIG9uZXMgbWF5IHJlcXVpcmUgYSBzZXRUaW1lb3V0CgkgKiB0byBoYW5kbGUgaXQuIFRoZSBzZXRUaW1lb3V0IGlzIGFsd2F5cyBydW5uaW5nIHVudGlsIGEgcmVzcG9uc2UgaXMgaGFuZGxlZCBieSB0aGUgYnJvd3Nlci4KCSAqIEBtZXRob2QgX2hhbmRsZVRpbWVvdXQKCSAqIEBwcml2YXRlCgkgKi8KCXAuX2hhbmRsZVRpbWVvdXQgPSBmdW5jdGlvbigpIHsKCQl0aGlzLl9jbGVhbigpOwoJCXZhciBldmVudCA9IG5ldyBjcmVhdGVqcy5FdmVudCgiZXJyb3IiKTsKCQlldmVudC50ZXh0ID0gIlBSRUxPQURfVElNRU9VVCI7CgkJdGhpcy5fc2VuZEVycm9yKGV2ZW50KTsKCX07CgoJLyoqCgkgKiBIYW5kbGUgYSBzdGFsbGVkIGF1ZGlvIGV2ZW50LiBUaGUgbWFpbiBwbGFjZSB3ZSBzZWVtIHRvIGdldCB0aGVzZSBpcyB3aXRoIEhUTUxBdWRpbyBpbiBDaHJvbWUgd2hlbiB3ZSB0cnkgYW5kCgkgKiBwbGF5YmFjayBhdWRpbyB0aGF0IGlzIGFscmVhZHkgaW4gYSBsb2FkLCBidXQgbm90IGNvbXBsZXRlLgoJICogQG1ldGhvZCBfaGFuZGxlU3RhbGxlZAoJICogQHByaXZhdGUKCSAqLwoJcC5faGFuZGxlU3RhbGxlZCA9IGZ1bmN0aW9uKCkgewoJCS8vSWdub3JlLCBsZXQgdGhlIHRpbWVvdXQgdGFrZSBjYXJlIG9mIGl0LiBTb21ldGltZXMgaXRzIG5vdCByZWFsbHkgc3RvcHBlZC4KCX07CgoJLyoqCgkgKiBIYW5kbGUgYW4gZXJyb3IgZXZlbnQgZ2VuZXJhdGVkIGJ5IHRoZSB0YWcuCgkgKiBAbWV0aG9kIF9oYW5kbGVFcnJvcgoJICogQHByaXZhdGUKCSAqLwoJcC5faGFuZGxlRXJyb3IgPSBmdW5jdGlvbihldmVudCkgewoJCXRoaXMuX2NsZWFuKCk7CgoJCXZhciBuZXdFdmVudCA9IG5ldyBjcmVhdGVqcy5FdmVudCgiZXJyb3IiKTsKCQkvL1RPRE86IFByb3BhZ2F0ZSBhY3R1YWwgZXZlbnQgZXJyb3I/CgkJdGhpcy5fc2VuZEVycm9yKG5ld0V2ZW50KTsKCX07CgoJLyoqCgkgKiBIYW5kbGUgdGhlIHJlYWR5U3RhdGVDaGFuZ2UgZXZlbnQgZnJvbSBhIHRhZy4gV2Ugc29tZXRpbWVzIG5lZWQgdGhpcyBpbiBwbGFjZSBvZiB0aGUgb25sb2FkIGV2ZW50IChtYWlubHkgU0NSSVBUCgkgKiBhbmQgTElOSyB0YWdzKSwgYnV0IG90aGVyIGNhc2VzIG1heSBleGlzdC4KCSAqIEBtZXRob2QgX2hhbmRsZVJlYWR5U3RhdGVDaGFuZ2UKCSAqIEBwcml2YXRlCgkgKi8KCXAuX2hhbmRsZVJlYWR5U3RhdGVDaGFuZ2UgPSBmdW5jdGlvbigpIHsKCQljbGVhclRpbWVvdXQodGhpcy5fbG9hZFRpbWVvdXQpOwoJCS8vIFRoaXMgaXMgc3RyaWN0bHkgZm9yIHRhZ3MgaW4gYnJvd3NlcnMgdGhhdCBkbyBub3Qgc3VwcG9ydCBvbmxvYWQuCgkJdmFyIHRhZyA9IHRoaXMuZ2V0SXRlbSgpLnRhZzsKCgkJLy8gQ29tcGxldGUgaXMgZm9yIG9sZCBJRSBzdXBwb3J0LgoJCWlmICh0YWcucmVhZHlTdGF0ZSA9PSAibG9hZGVkIiB8fCB0YWcucmVhZHlTdGF0ZSA9PSAiY29tcGxldGUiKSB7CgkJCXRoaXMuX2hhbmRsZUxvYWQoKTsKCQl9Cgl9OwoKCS8qKgoJICogSGFuZGxlIGEgbG9hZCAoY29tcGxldGUpIGV2ZW50LiBUaGlzIGlzIGNhbGxlZCBieSB0YWcgY2FsbGJhY2tzLCBidXQgYWxzbyBieSByZWFkeVN0YXRlQ2hhbmdlIGFuZCBjYW5QbGF5VGhyb3VnaAoJICogZXZlbnRzLiBPbmNlIGxvYWRlZCwgdGhlIGl0ZW0gaXMgZGlzcGF0Y2hlZCB0byB0aGUge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUifX17ey9jcm9zc0xpbmt9fS4KCSAqIEBtZXRob2QgX2hhbmRsZUxvYWQKCSAqIEBwYXJhbSB7T2JqZWN0fSBbZXZlbnRdIEEgbG9hZCBldmVudCBmcm9tIGEgdGFnLiBUaGlzIGlzIHNvbWV0aW1lcyBjYWxsZWQgZnJvbSBvdGhlciBoYW5kbGVycyB3aXRob3V0IGFuIGV2ZW50LgoJICogQHByaXZhdGUKCSAqLwoJcC5faGFuZGxlTG9hZCA9IGZ1bmN0aW9uKGV2ZW50KSB7CgkJaWYgKHRoaXMuX2lzQ2FuY2VsZWQoKSkgeyByZXR1cm47IH0KCgkJdmFyIGl0ZW0gPSB0aGlzLmdldEl0ZW0oKTsKCQl2YXIgdGFnID0gaXRlbS50YWc7CgoJCWlmICh0aGlzLmxvYWRlZCB8fCB0aGlzLl9pc0F1ZGlvICYmIHRhZy5yZWFkeVN0YXRlICE9PSA0KSB7IHJldHVybjsgfSAvL0xNOiBOb3Qgc3VyZSBpZiB3ZSBzdGlsbCBuZWVkIHRoZSBhdWRpbyBjaGVjay4KCQl0aGlzLmxvYWRlZCA9IHRydWU7CgoJCS8vIFJlbW92ZSBmcm9tIHRoZSBET00KCQlzd2l0Y2ggKGl0ZW0udHlwZSkgewoJCQljYXNlIGNyZWF0ZWpzLkxvYWRRdWV1ZS5TVkc6CgkJCWNhc2UgY3JlYXRlanMuTG9hZFF1ZXVlLkpTT046CgkJCWNhc2UgY3JlYXRlanMuTG9hZFF1ZXVlLkpTT05QOiAvLyBOb3RlOiBSZW1vdmluZyBzY3JpcHQgdGFncyBpcyBhIGZvb2wncyBlcnJhbmQuCgkJCWNhc2UgY3JlYXRlanMuTG9hZFF1ZXVlLk1BTklGRVNUOgoJCQljYXNlIGNyZWF0ZWpzLkxvYWRRdWV1ZS5DU1M6CgkJCQkvLyBjYXNlIGNyZWF0ZWpzLkxvYWRRdWV1ZS5DU1M6CgkJCQkvL0xNOiBXZSBtYXkgbmVlZCB0byByZW1vdmUgQ1NTIHRhZ3MgbG9hZGVkIHVzaW5nIGEgTElOSwoJCQkJdGFnLnN0eWxlLnZpc2liaWxpdHkgPSB0aGlzLl9zdGFydFRhZ1Zpc2liaWxpdHk7CgkJCQkoZG9jdW1lbnQuYm9keSB8fCBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiYm9keSIpWzBdKS5yZW1vdmVDaGlsZCh0YWcpOwoJCQlicmVhazsKCQkJZGVmYXVsdDoKCQl9CgoJCXRoaXMuX2NsZWFuKCk7CgkJdGhpcy5fc2VuZENvbXBsZXRlKCk7Cgl9OwoKCS8qKgoJICogQ2xlYW4gdXAgdGhlIGxvYWRlci4KCSAqIFRoaXMgc3RvcHMgYW55IHRpbWVycyBhbmQgcmVtb3ZlcyByZWZlcmVuY2VzIHRvIHByZXZlbnQgZXJyYW50IGNhbGxiYWNrcyBhbmQgY2xlYW4gdXAgbWVtb3J5LgoJICogQG1ldGhvZCBfY2xlYW4KCSAqIEBwcml2YXRlCgkgKi8KCXAuX2NsZWFuID0gZnVuY3Rpb24oKSB7CgkJY2xlYXJUaW1lb3V0KHRoaXMuX2xvYWRUaW1lb3V0KTsKCgkJLy8gRGVsZXRlIGhhbmRsZXJzLgoJCXZhciBpdGVtID0gdGhpcy5nZXRJdGVtKCk7CgkJdmFyIHRhZyA9IGl0ZW0udGFnOwoJCWlmICh0YWcgIT0gbnVsbCkgewoJCQl0YWcub25sb2FkID0gbnVsbDsKCQkJdGFnLnJlbW92ZUV2ZW50TGlzdGVuZXIgJiYgdGFnLnJlbW92ZUV2ZW50TGlzdGVuZXIoImNhbnBsYXl0aHJvdWdoIiwgdGhpcy5fdGFnQ29tcGxldGVQcm94eSwgZmFsc2UpOwoJCQl0YWcub25zdGFsbGVkID0gbnVsbDsKCQkJdGFnLm9ucHJvZ3Jlc3MgPSBudWxsOwoJCQl0YWcub25lcnJvciA9IG51bGw7CgoJCQkvL1RPRE86IFRlc3QgdGhpcwoJCQlpZiAodGFnLnBhcmVudE5vZGUgIT0gbnVsbAoJCQkJCSYmIGl0ZW0udHlwZSA9PSBjcmVhdGVqcy5Mb2FkUXVldWUuU1ZHCgkJCQkJJiYgaXRlbS50eXBlID09IGNyZWF0ZWpzLkxvYWRRdWV1ZS5KU09OCgkJCQkJJiYgaXRlbS50eXBlID09IGNyZWF0ZWpzLkxvYWRRdWV1ZS5NQU5JRkVTVAoJCQkJCSYmIGl0ZW0udHlwZSA9PSBjcmVhdGVqcy5Mb2FkUXVldWUuQ1NTCgkJCQkJJiYgaXRlbS50eXBlID09IGNyZWF0ZWpzLkxvYWRRdWV1ZS5KU09OUCkgewoJCQkJIC8vIE5vdGU6IFJlbW92aW5nIHNjcmlwdCB0YWdzIGlzIGEgZm9vbCdzIGVycmFuZC4KCQkJCXRhZy5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRhZyk7CgkJCX0KCQl9CgoJCXZhciBpdGVtID0gdGhpcy5nZXRJdGVtKCk7CgkJaWYgKGl0ZW0udHlwZSA9PSBjcmVhdGVqcy5Mb2FkUXVldWUuSlNPTlAKCQkJfHwgaXRlbS50eXBlID09IGNyZWF0ZWpzLkxvYWRRdWV1ZS5NQU5JRkVTVCkgewoJCQl3aW5kb3dbaXRlbS5jYWxsYmFja10gPSBudWxsOwoJCX0KCX07CgoJcC50b1N0cmluZyA9IGZ1bmN0aW9uKCkgewoJCXJldHVybiAiW1ByZWxvYWRKUyBUYWdMb2FkZXJdIjsKCX07CgoJY3JlYXRlanMuVGFnTG9hZGVyID0gVGFnTG9hZGVyOwoKfSgpKTsKLyoKICogWEhSTG9hZGVyCiAqIFZpc2l0IGh0dHA6Ly9jcmVhdGVqcy5jb20vIGZvciBkb2N1bWVudGF0aW9uLCB1cGRhdGVzIGFuZCBleGFtcGxlcy4KICoKICoKICogQ29weXJpZ2h0IChjKSAyMDEyIGdza2lubmVyLmNvbSwgaW5jLgogKgogKiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbgogKiBvYnRhaW5pbmcgYSBjb3B5IG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbgogKiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0CiAqIHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMgdG8gdXNlLAogKiBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbAogKiBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUKICogU29mdHdhcmUgaXMgZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcKICogY29uZGl0aW9uczoKICoKICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUKICogaW5jbHVkZWQgaW4gYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuCiAqCiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELAogKiBFWFBSRVNTIE9SIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMKICogT0YgTUVSQ0hBTlRBQklMSVRZLCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQKICogTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SUyBPUiBDT1BZUklHSFQKICogSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUiBMSUFCSUxJVFksCiAqIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORwogKiBGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SCiAqIE9USEVSIERFQUxJTkdTIElOIFRIRSBTT0ZUV0FSRS4KICovCgovKioKICogQG1vZHVsZSBQcmVsb2FkSlMKICovCgovLyBuYW1lc3BhY2U6CnRoaXMuY3JlYXRlanMgPSB0aGlzLmNyZWF0ZWpzIHx8IHt9OwoKKGZ1bmN0aW9uICgpIHsKCSJ1c2Ugc3RyaWN0IjsKCgkvKioKCSAqIEEgcHJlbG9hZGVyIHRoYXQgbG9hZHMgaXRlbXMgdXNpbmcgWEhSIHJlcXVlc3RzLCB1c3VhbGx5IFhNTEh0dHBSZXF1ZXN0LiBIb3dldmVyIFhEb21haW5SZXF1ZXN0cyB3aWxsIGJlIHVzZWQKCSAqIGZvciBjcm9zcy1kb21haW4gcmVxdWVzdHMgaWYgcG9zc2libGUsIGFuZCBvbGRlciB2ZXJzaW9ucyBvZiBJRSBmYWxsIGJhY2sgb24gdG8gQWN0aXZlWCBvYmplY3RzIHdoZW4gbmVjZXNzYXJ5LgoJICogWEhSIHJlcXVlc3RzIGxvYWQgdGhlIGNvbnRlbnQgYXMgdGV4dCBvciBiaW5hcnkgZGF0YSwgcHJvdmlkZSBwcm9ncmVzcyBhbmQgY29uc2lzdGVudCBjb21wbGV0aW9uIGV2ZW50cywgYW5kCgkgKiBjYW4gYmUgY2FuY2VsZWQgZHVyaW5nIGxvYWQuIE5vdGUgdGhhdCBYSFIgaXMgbm90IHN1cHBvcnRlZCBpbiBJRSA2IG9yIGVhcmxpZXIsIGFuZCBpcyBub3QgcmVjb21tZW5kZWQgZm9yCgkgKiBjcm9zcy1kb21haW4gbG9hZGluZy4KCSAqIEBjbGFzcyBYSFJMb2FkZXIKCSAqIEBjb25zdHJ1Y3RvcgoJICogQHBhcmFtIHtPYmplY3R9IGl0ZW0gVGhlIG9iamVjdCB0aGF0IGRlZmluZXMgdGhlIGZpbGUgdG8gbG9hZC4gUGxlYXNlIHNlZSB0aGUge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvbG9hZEZpbGUifX17ey9jcm9zc0xpbmt9fQoJICogZm9yIGFuIG92ZXJ2aWV3IG9mIHN1cHBvcnRlZCBmaWxlIHByb3BlcnRpZXMuCgkgKiBAcGFyYW0ge1N0cmluZ30gW2Nyb3NzT3JpZ2luXSBBbiBvcHRpb25hbCBmbGFnIHRvIHN1cHBvcnQgaW1hZ2VzIGxvYWRlZCBmcm9tIGEgQ09SUy1lbmFibGVkIHNlcnZlci4gUGxlYXNlIHNlZQoJICoge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvX2Nyb3NzT3JpZ2luOnByb3BlcnR5In19e3svY3Jvc3NMaW5rfX0gZm9yIG1vcmUgaW5mby4KCSAqIEBleHRlbmRzIEFic3RyYWN0TG9hZGVyCgkgKi8KCXZhciBYSFJMb2FkZXIgPSBmdW5jdGlvbiAoaXRlbSwgY3Jvc3NPcmlnaW4pIHsKCQl0aGlzLmluaXQoaXRlbSwgY3Jvc3NPcmlnaW4pOwoJfTsKCgl2YXIgcCA9IFhIUkxvYWRlci5wcm90b3R5cGUgPSBuZXcgY3JlYXRlanMuQWJzdHJhY3RMb2FkZXIoKTsKCgkvL1Byb3RlY3RlZAoJLyoqCgkgKiBBIHJlZmVyZW5jZSB0byB0aGUgWEhSIHJlcXVlc3QgdXNlZCB0byBsb2FkIHRoZSBjb250ZW50LgoJICogQHByb3BlcnR5IF9yZXF1ZXN0CgkgKiBAdHlwZSB7WE1MSHR0cFJlcXVlc3QgfCBYRG9tYWluUmVxdWVzdCB8IEFjdGl2ZVguWE1MSFRUUH0KCSAqIEBwcml2YXRlCgkgKi8KCXAuX3JlcXVlc3QgPSBudWxsOwoKCS8qKgoJICogQSBtYW51YWwgbG9hZCB0aW1lb3V0IHRoYXQgaXMgdXNlZCBmb3IgYnJvd3NlcnMgdGhhdCBkbyBub3Qgc3VwcG9ydCB0aGUgb25UaW1lb3V0IGV2ZW50IG9uIFhIUiAoWEhSIGxldmVsIDEsCgkgKiB0eXBpY2FsbHkgSUU5KS4KCSAqIEBwcm9wZXJ0eSBfbG9hZFRpbWVvdXQKCSAqIEB0eXBlIHtOdW1iZXJ9CgkgKiBAcHJpdmF0ZQoJICovCglwLl9sb2FkVGltZW91dCA9IG51bGw7CgoJLyoqCgkgKiBUaGUgYnJvd3NlcidzIFhIUiAoWE1MSFRUUFJlcXVlc3QpIHZlcnNpb24uIFN1cHBvcnRlZCB2ZXJzaW9ucyBhcmUgMSBhbmQgMi4gVGhlcmUgaXMgbm8gb2ZmaWNpYWwgd2F5IHRvIGRldGVjdAoJICogdGhlIHZlcnNpb24sIHNvIHdlIHVzZSBjYXBhYmlsaXRpZXMgdG8gbWFrZSBhIGJlc3QgZ3Vlc3MuCgkgKiBAcHJvcGVydHkgX3hockxldmVsCgkgKiBAdHlwZSB7TnVtYmVyfQoJICogQGRlZmF1bHQgMQoJICogQHByaXZhdGUKCSAqLwoJcC5feGhyTGV2ZWwgPSAxOwoKCS8qKgoJICogVGhlIHJlc3BvbnNlIG9mIGEgbG9hZGVkIGZpbGUuIFRoaXMgaXMgc2V0IGJlY2F1c2UgaXQgaXMgZXhwZW5zaXZlIHRvIGxvb2sgdXAgY29uc3RhbnRseS4gVGhpcyBwcm9wZXJ0eSB3aWxsIGJlCgkgKiBudWxsIHVudGlsIHRoZSBmaWxlIGlzIGxvYWRlZC4KCSAqIEBwcm9wZXJ0eSBfcmVzcG9uc2UKCSAqIEB0eXBlIHttaXhlZH0KCSAqIEBwcml2YXRlCgkgKi8KCXAuX3Jlc3BvbnNlID0gbnVsbDsKCgkvKioKCSAqIFRoZSByZXNwb25zZSBvZiB0aGUgbG9hZGVkIGZpbGUgYmVmb3JlIGl0IGlzIG1vZGlmaWVkLiBJbiBtb3N0IGNhc2VzLCBjb250ZW50IGlzIGNvbnZlcnRlZCBmcm9tIHJhdyB0ZXh0IHRvCgkgKiBhbiBIVE1MIHRhZyBvciBhIGZvcm1hdHRlZCBvYmplY3Qgd2hpY2ggaXMgc2V0IHRvIHRoZSA8Y29kZT5yZXN1bHQ8L2NvZGU+IHByb3BlcnR5LCBidXQgdGhlIGRldmVsb3BlciBtYXkgc3RpbGwKCSAqIHdhbnQgdG8gYWNjZXNzIHRoZSByYXcgY29udGVudCBhcyBpdCB3YXMgbG9hZGVkLgoJICogQHByb3BlcnR5IF9yYXdSZXNwb25zZQoJICogQHR5cGUge1N0cmluZ3xPYmplY3R9CgkgKiBAcHJpdmF0ZQoJICovCglwLl9yYXdSZXNwb25zZSA9IG51bGw7CgoJLyoqCgkgKiBTZWUge3sjY3Jvc3NMaW5rICJMb2FkUXVldWUvX2Nyb3NzT3JpZ2luOnByb3BlcnR5In19e3svY3Jvc3NMaW5rfX0KCSAqIEBwcm9wZXJ0eSBfY3Jvc3NPcmlnaW4KCSAqIEB0eXBlIHtTdHJpbmd9CgkgKiBAZGVmYXVsdFZhbHVlICIiCgkgKiBAcHJpdmF0ZQoJICovCglwLl9jcm9zc09yaWdpbiA9ICIiOwoKCS8vIE92ZXJyaWRlcyBhYnN0cmFjdCBtZXRob2QgaW4gQWJzdHJhY3RMb2FkZXIKCXAuaW5pdCA9IGZ1bmN0aW9uIChpdGVtLCBjcm9zc09yaWdpbikgewoJCXRoaXMuX2l0ZW0gPSBpdGVtOwoJCXRoaXMuX2Nyb3NzT3JpZ2luID0gY3Jvc3NPcmlnaW47CgkJaWYgKCF0aGlzLl9jcmVhdGVYSFIoaXRlbSkpIHsKCQkJLy9UT0RPOiBUaHJvdyBlcnJvcj8KCQl9Cgl9OwoKCS8qKgoJICogTG9vayB1cCB0aGUgbG9hZGVkIHJlc3VsdC4KCSAqIEBtZXRob2QgZ2V0UmVzdWx0CgkgKiBAcGFyYW0ge0Jvb2xlYW59IFtyYXdSZXN1bHQ9ZmFsc2VdIFJldHVybiBhIHJhdyByZXN1bHQgaW5zdGVhZCBvZiBhIGZvcm1hdHRlZCByZXN1bHQuIFRoaXMgYXBwbGllcyB0byBjb250ZW50CgkgKiBsb2FkZWQgdmlhIFhIUiBzdWNoIGFzIHNjcmlwdHMsIFhNTCwgQ1NTLCBhbmQgSW1hZ2VzLiBJZiB0aGVyZSBpcyBubyByYXcgcmVzdWx0LCB0aGUgZm9ybWF0dGVkIHJlc3VsdCB3aWxsIGJlCgkgKiByZXR1cm5lZCBpbnN0ZWFkLgoJICogQHJldHVybiB7T2JqZWN0fSBBIHJlc3VsdCBvYmplY3QgY29udGFpbmluZyB0aGUgY29udGVudCB0aGF0IHdhcyBsb2FkZWQsIHN1Y2ggYXM6CgkgKiA8dWw+CgkgKiAgICAgIDxsaT5BbiBpbWFnZSB0YWcgKCZsdDtpbWFnZSAvJmd0OykgZm9yIGltYWdlczwvbGk+CgkgKiAgICAgIDxsaT5BIHNjcmlwdCB0YWcgZm9yIEphdmFTY3JpcHQgKCZsdDtzY3JpcHQgLyZndDspLiBOb3RlIHRoYXQgc2NyaXB0cyBsb2FkZWQgd2l0aCB0YWdzIG1heSBiZSBhZGRlZCB0byB0aGUKCSAqICAgICAgSFRNTCBoZWFkLjwvbGk+CgkgKiAgICAgIDxsaT5BIHN0eWxlIHRhZyBmb3IgQ1NTICgmbHQ7c3R5bGUgLyZndDspPC9saT4KCSAqICAgICAgPGxpPlJhdyB0ZXh0IGZvciBURVhUPC9saT4KCSAqICAgICAgPGxpPkEgZm9ybWF0dGVkIEphdmFTY3JpcHQgb2JqZWN0IGRlZmluZWQgYnkgSlNPTjwvbGk+CgkgKiAgICAgIDxsaT5BbiBYTUwgZG9jdW1lbnQ8L2xpPgoJICogICAgICA8bGk+QW4gYmluYXJ5IGFycmF5YnVmZmVyIGxvYWRlZCBieSBYSFI8L2xpPgoJICogPC91bD4KCSAqIE5vdGUgdGhhdCBpZiBhIHJhdyByZXN1bHQgaXMgcmVxdWVzdGVkLCBidXQgbm90IGZvdW5kLCB0aGUgcmVzdWx0IHdpbGwgYmUgcmV0dXJuZWQgaW5zdGVhZC4KCSAqLwoJcC5nZXRSZXN1bHQgPSBmdW5jdGlvbiAocmF3UmVzdWx0KSB7CgkJaWYgKHJhd1Jlc3VsdCAmJiB0aGlzLl9yYXdSZXNwb25zZSkgewoJCQlyZXR1cm4gdGhpcy5fcmF3UmVzcG9uc2U7CgkJfQoJCXJldHVybiB0aGlzLl9yZXNwb25zZTsKCX07CgoJLy8gT3ZlcnJpZGVzIGFic3RyYWN0IG1ldGhvZCBpbiBBYnN0cmFjdExvYWRlcgoJcC5jYW5jZWwgPSBmdW5jdGlvbiAoKSB7CgkJdGhpcy5jYW5jZWxlZCA9IHRydWU7CgkJdGhpcy5fY2xlYW4oKTsKCQl0aGlzLl9yZXF1ZXN0LmFib3J0KCk7Cgl9OwoKCS8vIE92ZXJyaWRlcyBhYnN0cmFjdCBtZXRob2QgaW4gQWJzdHJhY3RMb2FkZXIKCXAubG9hZCA9IGZ1bmN0aW9uICgpIHsKCQlpZiAodGhpcy5fcmVxdWVzdCA9PSBudWxsKSB7CgkJCXRoaXMuX2hhbmRsZUVycm9yKCk7CgkJCXJldHVybjsKCQl9CgoJCS8vRXZlbnRzCgkJdGhpcy5fcmVxdWVzdC5vbmxvYWRzdGFydCA9IGNyZWF0ZWpzLnByb3h5KHRoaXMuX2hhbmRsZUxvYWRTdGFydCwgdGhpcyk7CgkJdGhpcy5fcmVxdWVzdC5vbnByb2dyZXNzID0gY3JlYXRlanMucHJveHkodGhpcy5faGFuZGxlUHJvZ3Jlc3MsIHRoaXMpOwoJCXRoaXMuX3JlcXVlc3Qub25hYm9ydCA9IGNyZWF0ZWpzLnByb3h5KHRoaXMuX2hhbmRsZUFib3J0LCB0aGlzKTsKCQl0aGlzLl9yZXF1ZXN0Lm9uZXJyb3IgPSBjcmVhdGVqcy5wcm94eSh0aGlzLl9oYW5kbGVFcnJvciwgdGhpcyk7CgkJdGhpcy5fcmVxdWVzdC5vbnRpbWVvdXQgPSBjcmVhdGVqcy5wcm94eSh0aGlzLl9oYW5kbGVUaW1lb3V0LCB0aGlzKTsKCQkvLyBTZXQgdXAgYSB0aW1lb3V0IGlmIHdlIGRvbid0IGhhdmUgWEhSMgoJCWlmICh0aGlzLl94aHJMZXZlbCA9PSAxKSB7CgkJCXZhciBkdXJhdGlvbiA9IGNyZWF0ZWpzLkxvYWRRdWV1ZS5MT0FEX1RJTUVPVVQ7CgkJCWlmIChkdXJhdGlvbiA9PSAwKSB7CgkJCQlkdXJhdGlvbiA9IGNyZWF0ZWpzLkxvYWRRdWV1ZS5sb2FkVGltZW91dDsKCQkJfSBlbHNlIHsKCQkJCXRyeSB7IGNvbnNvbGUud2FybigiTG9hZFF1ZXVlLkxPQURfVElNRU9VVCBoYXMgYmVlbiBkZXByZWNhdGVkIGluIGZhdm9yIG9mIExvYWRRdWV1ZS5sb2FkVGltZW91dCIpO30gY2F0Y2goZSkge30KCQkJfQoJCQl0aGlzLl9sb2FkVGltZW91dCA9IHNldFRpbWVvdXQoY3JlYXRlanMucHJveHkodGhpcy5faGFuZGxlVGltZW91dCwgdGhpcyksIGR1cmF0aW9uKTsKCQl9CgoJCS8vIE5vdGU6IFdlIGRvbid0IGdldCBvbmxvYWQgaW4gYWxsIGJyb3dzZXJzIChlYXJsaWVyIEZGIGFuZCBJRSkuIG9uUmVhZHlTdGF0ZUNoYW5nZSBoYW5kbGVzIHRoZXNlLgoJCXRoaXMuX3JlcXVlc3Qub25sb2FkID0gY3JlYXRlanMucHJveHkodGhpcy5faGFuZGxlTG9hZCwgdGhpcyk7CgoJCXRoaXMuX3JlcXVlc3Qub25yZWFkeXN0YXRlY2hhbmdlID0gY3JlYXRlanMucHJveHkodGhpcy5faGFuZGxlUmVhZHlTdGF0ZUNoYW5nZSwgdGhpcyk7CgoJCS8vIFNvbWV0aW1lcyB3ZSBnZXQgYmFjayA0MDRzIGltbWVkaWF0ZWx5LCBwYXJ0aWN1bGFybHkgd2hlbiB0aGVyZSBpcyBhIGNyb3NzIG9yaWdpbiByZXF1ZXN0LiAgLy8gbm90ZSB0aGlzIGRvZXMgbm90IGNhdGNoIGluIENocm9tZQoJCXRyeSB7CgkJCWlmICghdGhpcy5faXRlbS52YWx1ZXMgfHwgdGhpcy5faXRlbS5tZXRob2QgPT0gY3JlYXRlanMuTG9hZFF1ZXVlLkdFVCkgewoJCQkJdGhpcy5fcmVxdWVzdC5zZW5kKCk7CgkJCX0gZWxzZSBpZiAodGhpcy5faXRlbS5tZXRob2QgPT0gY3JlYXRlanMuTG9hZFF1ZXVlLlBPU1QpIHsKCQkJCXRoaXMuX3JlcXVlc3Quc2VuZCh0aGlzLl9mb3JtYXRRdWVyeVN0cmluZyh0aGlzLl9pdGVtLnZhbHVlcykpOwoJCQl9CgkJfSBjYXRjaCAoZXJyb3IpIHsKCQkJdmFyIGV2ZW50ID0gbmV3IGNyZWF0ZWpzLkV2ZW50KCJlcnJvciIpOwoJCQlldmVudC5lcnJvciA9IGVycm9yOwoJCQl0aGlzLl9zZW5kRXJyb3IoZXZlbnQpOwoJCX0KCX07CgoJLyoqCgkgKiBHZXQgYWxsIHRoZSByZXNwb25zZSBoZWFkZXJzIGZyb20gdGhlIFhtbEh0dHBSZXF1ZXN0LgoJICoKCSAqIDxzdHJvbmc+RnJvbSB0aGUgZG9jczo8L3N0cm9uZz4gUmV0dXJuIGFsbCB0aGUgSFRUUCBoZWFkZXJzLCBleGNsdWRpbmcgaGVhZGVycyB0aGF0IGFyZSBhIGNhc2UtaW5zZW5zaXRpdmUgbWF0Y2gKCSAqIGZvciBTZXQtQ29va2llIG9yIFNldC1Db29raWUyLCBhcyBhIHNpbmdsZSBzdHJpbmcsIHdpdGggZWFjaCBoZWFkZXIgbGluZSBzZXBhcmF0ZWQgYnkgYSBVKzAwMEQgQ1IgVSswMDBBIExGIHBhaXIsCgkgKiBleGNsdWRpbmcgdGhlIHN0YXR1cyBsaW5lLCBhbmQgd2l0aCBlYWNoIGhlYWRlciBuYW1lIGFuZCBoZWFkZXIgdmFsdWUgc2VwYXJhdGVkIGJ5IGEgVSswMDNBIENPTE9OIFUrMDAyMCBTUEFDRQoJICogcGFpci4KCSAqIEBtZXRob2QgZ2V0QWxsUmVzcG9uc2VIZWFkZXJzCgkgKiBAcmV0dXJuIHtTdHJpbmd9CgkgKiBAc2luY2UgMC40LjEKCSAqLwoJcC5nZXRBbGxSZXNwb25zZUhlYWRlcnMgPSBmdW5jdGlvbiAoKSB7CgkJaWYgICh0aGlzLl9yZXF1ZXN0LmdldEFsbFJlc3BvbnNlSGVhZGVycyBpbnN0YW5jZW9mIEZ1bmN0aW9uKSB7CgkJCXJldHVybiB0aGlzLl9yZXF1ZXN0LmdldEFsbFJlc3BvbnNlSGVhZGVycygpOwoJCX0gZWxzZSB7CgkJCXJldHVybiBudWxsOwoJCX0KCX07CgoJLyoqCgkgKiBHZXQgYSBzcGVjaWZpYyByZXNwb25zZSBoZWFkZXIgZnJvbSB0aGUgWG1sSHR0cFJlcXVlc3QuCgkgKgoJICogPHN0cm9uZz5Gcm9tIHRoZSBkb2NzOjwvc3Ryb25nPiBSZXR1cm5zIHRoZSBoZWFkZXIgZmllbGQgdmFsdWUgZnJvbSB0aGUgcmVzcG9uc2Ugb2Ygd2hpY2ggdGhlIGZpZWxkIG5hbWUgbWF0Y2hlcwoJICogaGVhZGVyLCB1bmxlc3MgdGhlIGZpZWxkIG5hbWUgaXMgU2V0LUNvb2tpZSBvciBTZXQtQ29va2llMi4KCSAqIEBtZXRob2QgZ2V0UmVzcG9uc2VIZWFkZXIKCSAqIEBwYXJhbSB7U3RyaW5nfSBoZWFkZXIgVGhlIGhlYWRlciBuYW1lIHRvIHJldHJpZXZlLgoJICogQHJldHVybiB7U3RyaW5nfQoJICogQHNpbmNlIDAuNC4xCgkgKi8KCXAuZ2V0UmVzcG9uc2VIZWFkZXIgPSBmdW5jdGlvbiAoaGVhZGVyKSB7CgkJaWYgKHRoaXMuX3JlcXVlc3QuZ2V0UmVzcG9uc2VIZWFkZXIgaW5zdGFuY2VvZiBGdW5jdGlvbikgewoJCQlyZXR1cm4gdGhpcy5fcmVxdWVzdC5nZXRSZXNwb25zZUhlYWRlcihoZWFkZXIpOwoJCX0gZWxzZSB7CgkJCXJldHVybiBudWxsOwoJCX0KCX07CgoJLyoqCgkgKiBUaGUgWEhSIHJlcXVlc3QgaGFzIHJlcG9ydGVkIHByb2dyZXNzLgoJICogQG1ldGhvZCBfaGFuZGxlUHJvZ3Jlc3MKCSAqIEBwYXJhbSB7T2JqZWN0fSBldmVudCBUaGUgWEhSIHByb2dyZXNzIGV2ZW50LgoJICogQHByaXZhdGUKCSAqLwoJcC5faGFuZGxlUHJvZ3Jlc3MgPSBmdW5jdGlvbiAoZXZlbnQpIHsKCQlpZiAoIWV2ZW50IHx8IGV2ZW50LmxvYWRlZCA+IDAgJiYgZXZlbnQudG90YWwgPT0gMCkgewoJCQlyZXR1cm47IC8vIFNvbWV0aW1lcyB3ZSBnZXQgbm8gInRvdGFsIiwgc28ganVzdCBpZ25vcmUgdGhlIHByb2dyZXNzIGV2ZW50LgoJCX0KCgkJdmFyIG5ld0V2ZW50ID0gbmV3IGNyZWF0ZWpzLkV2ZW50KCJwcm9ncmVzcyIpOwoJCW5ld0V2ZW50LmxvYWRlZCA9IGV2ZW50LmxvYWRlZDsKCQluZXdFdmVudC50b3RhbCA9IGV2ZW50LnRvdGFsOwoJCXRoaXMuX3NlbmRQcm9ncmVzcyhuZXdFdmVudCk7Cgl9OwoKCS8qKgoJICogVGhlIFhIUiByZXF1ZXN0IGhhcyByZXBvcnRlZCBhIGxvYWQgc3RhcnQuCgkgKiBAbWV0aG9kIF9oYW5kbGVMb2FkU3RhcnQKCSAqIEBwYXJhbSB7T2JqZWN0fSBldmVudCBUaGUgWEhSIGxvYWRTdGFydCBldmVudC4KCSAqIEBwcml2YXRlCgkgKi8KCXAuX2hhbmRsZUxvYWRTdGFydCA9IGZ1bmN0aW9uIChldmVudCkgewoJCWNsZWFyVGltZW91dCh0aGlzLl9sb2FkVGltZW91dCk7CgkJdGhpcy5fc2VuZExvYWRTdGFydCgpOwoJfTsKCgkvKioKCSAqIFRoZSBYSFIgcmVxdWVzdCBoYXMgcmVwb3J0ZWQgYW4gYWJvcnQgZXZlbnQuCgkgKiBAbWV0aG9kIGhhbmRsZUFib3J0CgkgKiBAcGFyYW0ge09iamVjdH0gZXZlbnQgVGhlIFhIUiBhYm9ydCBldmVudC4KCSAqIEBwcml2YXRlCgkgKi8KCXAuX2hhbmRsZUFib3J0ID0gZnVuY3Rpb24gKGV2ZW50KSB7CgkJdGhpcy5fY2xlYW4oKTsKCQl2YXIgbmV3RXZlbnQgPSBuZXcgY3JlYXRlanMuRXZlbnQoImVycm9yIik7CgkJbmV3RXZlbnQudGV4dCA9ICJYSFJfQUJPUlRFRCI7CgkJdGhpcy5fc2VuZEVycm9yKG5ld0V2ZW50KTsKCX07CgoJLyoqCgkgKiBUaGUgWEhSIHJlcXVlc3QgaGFzIHJlcG9ydGVkIGFuIGVycm9yIGV2ZW50LgoJICogQG1ldGhvZCBfaGFuZGxlRXJyb3IKCSAqIEBwYXJhbSB7T2JqZWN0fSBldmVudCBUaGUgWEhSIGVycm9yIGV2ZW50LgoJICogQHByaXZhdGUKCSAqLwoJcC5faGFuZGxlRXJyb3IgPSBmdW5jdGlvbiAoZXZlbnQpIHsKCQl0aGlzLl9jbGVhbigpOwoJCXZhciBuZXdFdmVudCA9IG5ldyBjcmVhdGVqcy5FdmVudCgiZXJyb3IiKTsKCQkvL1RPRE86IFByb3BhZ2F0ZSBldmVudCBlcnJvcgoJCXRoaXMuX3NlbmRFcnJvcihuZXdFdmVudCk7Cgl9OwoKCS8qKgoJICogVGhlIFhIUiByZXF1ZXN0IGhhcyByZXBvcnRlZCBhIHJlYWR5U3RhdGUgY2hhbmdlLiBOb3RlIHRoYXQgb2xkZXIgYnJvd3NlcnMgKElFIDcgJiA4KSBkbyBub3QgcHJvdmlkZSBhbiBvbmxvYWQKCSAqIGV2ZW50LCBzbyB3ZSBtdXN0IG1vbml0b3IgdGhlIHJlYWR5U3RhdGVDaGFuZ2UgdG8gZGV0ZXJtaW5lIGlmIHRoZSBmaWxlIGlzIGxvYWRlZC4KCSAqIEBtZXRob2QgX2hhbmRsZVJlYWR5U3RhdGVDaGFuZ2UKCSAqIEBwYXJhbSB7T2JqZWN0fSBldmVudCBUaGUgWEhSIHJlYWR5U3RhdGVDaGFuZ2UgZXZlbnQuCgkgKiBAcHJpdmF0ZQoJICovCglwLl9oYW5kbGVSZWFkeVN0YXRlQ2hhbmdlID0gZnVuY3Rpb24gKGV2ZW50KSB7CgkJaWYgKHRoaXMuX3JlcXVlc3QucmVhZHlTdGF0ZSA9PSA0KSB7CgkJCXRoaXMuX2hhbmRsZUxvYWQoKTsKCQl9Cgl9OwoKCS8qKgoJICogVGhlIFhIUiByZXF1ZXN0IGhhcyBjb21wbGV0ZWQuIFRoaXMgaXMgY2FsbGVkIGJ5IHRoZSBYSFIgcmVxdWVzdCBkaXJlY3RseSwgb3IgYnkgYSByZWFkeVN0YXRlQ2hhbmdlIHRoYXQgaGFzCgkgKiA8Y29kZT5yZXF1ZXN0LnJlYWR5U3RhdGUgPT0gNDwvY29kZT4uIE9ubHkgdGhlIGZpcnN0IGNhbGwgdG8gdGhpcyBtZXRob2Qgd2lsbCBiZSBwcm9jZXNzZWQuCgkgKiBAbWV0aG9kIF9oYW5kbGVMb2FkCgkgKiBAcGFyYW0ge09iamVjdH0gZXZlbnQgVGhlIFhIUiBsb2FkIGV2ZW50LgoJICogQHByaXZhdGUKCSAqLwoJcC5faGFuZGxlTG9hZCA9IGZ1bmN0aW9uIChldmVudCkgewoJCWlmICh0aGlzLmxvYWRlZCkgewoJCQlyZXR1cm47CgkJfQoJCXRoaXMubG9hZGVkID0gdHJ1ZTsKCgkJaWYgKCF0aGlzLl9jaGVja0Vycm9yKCkpIHsKCQkJdGhpcy5faGFuZGxlRXJyb3IoKTsKCQkJcmV0dXJuOwoJCX0KCgkJdGhpcy5fcmVzcG9uc2UgPSB0aGlzLl9nZXRSZXNwb25zZSgpOwoJCXRoaXMuX2NsZWFuKCk7CgkJdmFyIGlzQ29tcGxldGUgPSB0aGlzLl9nZW5lcmF0ZVRhZygpOwoJCWlmIChpc0NvbXBsZXRlKSB7CgkJCXRoaXMuX3NlbmRDb21wbGV0ZSgpOwoJCX0KCX07CgoJLyoqCgkgKiBUaGUgWEhSIHJlcXVlc3QgaGFzIHRpbWVkIG91dC4gVGhpcyBpcyBjYWxsZWQgYnkgdGhlIFhIUiByZXF1ZXN0IGRpcmVjdGx5LCBvciB2aWEgYSA8Y29kZT5zZXRUaW1lb3V0PC9jb2RlPgoJICogY2FsbGJhY2suCgkgKiBAbWV0aG9kIF9oYW5kbGVUaW1lb3V0CgkgKiBAcGFyYW0ge09iamVjdH0gW2V2ZW50XSBUaGUgWEhSIHRpbWVvdXQgZXZlbnQuIFRoaXMgaXMgb2NjYXNpb25hbGx5IG51bGwgd2hlbiBjYWxsZWQgYnkgdGhlIGJhY2t1cCBzZXRUaW1lb3V0LgoJICogQHByaXZhdGUKCSAqLwoJcC5faGFuZGxlVGltZW91dCA9IGZ1bmN0aW9uIChldmVudCkgewoJCXRoaXMuX2NsZWFuKCk7CgkJdmFyIG5ld0V2ZW50ID0gbmV3IGNyZWF0ZWpzLkV2ZW50KCJlcnJvciIpOwoJCW5ld0V2ZW50LnRleHQgPSAiUFJFTE9BRF9USU1FT1VUIjsKCQkvL1RPRE86IFByb3BhZ2F0ZSBhY3R1YWwgZXZlbnQgZXJyb3IKCQl0aGlzLl9zZW5kRXJyb3IoZXZlbnQpOwoJfTsKCgovLyBQcm90ZWN0ZWQKCS8qKgoJICogRGV0ZXJtaW5lIGlmIHRoZXJlIGlzIGFuIGVycm9yIGluIHRoZSBjdXJyZW50IGxvYWQuIFRoaXMgY2hlY2tzIHRoZSBzdGF0dXMgb2YgdGhlIHJlcXVlc3QgZm9yIHByb2JsZW0gY29kZXMuIE5vdGUKCSAqIHRoYXQgdGhpcyBkb2VzIG5vdCBjaGVjayBmb3IgYW4gYWN0dWFsIHJlc3BvbnNlLiBDdXJyZW50bHksIGl0IG9ubHkgY2hlY2tzIGZvciA0MDQgb3IgMCBlcnJvciBjb2RlLgoJICogQG1ldGhvZCBfY2hlY2tFcnJvcgoJICogQHJldHVybiB7Qm9vbGVhbn0gSWYgdGhlIHJlcXVlc3Qgc3RhdHVzIHJldHVybnMgYW4gZXJyb3IgY29kZS4KCSAqIEBwcml2YXRlCgkgKi8KCXAuX2NoZWNrRXJyb3IgPSBmdW5jdGlvbiAoKSB7CgkJLy9MTTogUHJvYmFibHkgbmVlZCBhZGRpdGlvbmFsIGhhbmRsZXJzIGhlcmUsIG1heWJlIDUwMQoJCXZhciBzdGF0dXMgPSBwYXJzZUludCh0aGlzLl9yZXF1ZXN0LnN0YXR1cyk7CgoJCXN3aXRjaCAoc3RhdHVzKSB7CgkJCWNhc2UgNDA0OiAgIC8vIE5vdCBGb3VuZAoJCQljYXNlIDA6ICAgICAvLyBOb3QgTG9hZGVkCgkJCQlyZXR1cm4gZmFsc2U7CgkJfQoJCXJldHVybiB0cnVlOwoJfTsKCgkvKioKCSAqIFZhbGlkYXRlIHRoZSByZXNwb25zZS4gRGlmZmVyZW50IGJyb3dzZXJzIGhhdmUgZGlmZmVyZW50IGFwcHJvYWNoZXMsIHNvbWUgb2Ygd2hpY2ggdGhyb3cgZXJyb3JzIHdoZW4gYWNjZXNzZWQKCSAqIGluIG90aGVyIGJyb3dzZXJzLiBJZiB0aGVyZSBpcyBubyByZXNwb25zZSwgdGhlIDxjb2RlPl9yZXNwb25zZTwvY29kZT4gcHJvcGVydHkgd2lsbCByZW1haW4gbnVsbC4KCSAqIEBtZXRob2QgX2dldFJlc3BvbnNlCgkgKiBAcHJpdmF0ZQoJICovCglwLl9nZXRSZXNwb25zZSA9IGZ1bmN0aW9uICgpIHsKCQlpZiAodGhpcy5fcmVzcG9uc2UgIT0gbnVsbCkgewoJCQlyZXR1cm4gdGhpcy5fcmVzcG9uc2U7CgkJfQoKCQlpZiAodGhpcy5fcmVxdWVzdC5yZXNwb25zZSAhPSBudWxsKSB7CgkJCXJldHVybiB0aGlzLl9yZXF1ZXN0LnJlc3BvbnNlOwoJCX0KCgkJLy8gQW5kcm9pZCAyLjIgdXNlcyAucmVzcG9uc2VUZXh0CgkJdHJ5IHsKCQkJaWYgKHRoaXMuX3JlcXVlc3QucmVzcG9uc2VUZXh0ICE9IG51bGwpIHsKCQkJCXJldHVybiB0aGlzLl9yZXF1ZXN0LnJlc3BvbnNlVGV4dDsKCQkJfQoJCX0gY2F0Y2ggKGUpIHsKCQl9CgoJCS8vIFdoZW4gbG9hZGluZyBYTUwsIElFOSBkb2VzIG5vdCByZXR1cm4gLnJlc3BvbnNlLCBpbnN0ZWFkIGl0IHJldHVybnMgcmVzcG9uc2VYTUwueG1sCgkJLy9UT0RPOiBURVNUCgkJdHJ5IHsKCQkJaWYgKHRoaXMuX3JlcXVlc3QucmVzcG9uc2VYTUwgIT0gbnVsbCkgewoJCQkJcmV0dXJuIHRoaXMuX3JlcXVlc3QucmVzcG9uc2VYTUw7CgkJCX0KCQl9IGNhdGNoIChlKSB7CgkJfQoJCXJldHVybiBudWxsOwoJfTsKCgkvKioKCSAqIENyZWF0ZSBhbiBYSFIgcmVxdWVzdC4gRGVwZW5kaW5nIG9uIGEgbnVtYmVyIG9mIGZhY3RvcnMsIHdlIGdldCB0b3RhbGx5IGRpZmZlcmVudCByZXN1bHRzLgoJICogPG9sPjxsaT5Tb21lIGJyb3dzZXJzIGdldCBhbiA8Y29kZT5YRG9tYWluUmVxdWVzdDwvY29kZT4gd2hlbiBsb2FkaW5nIGNyb3NzLWRvbWFpbi48L2xpPgoJICogICAgICA8bGk+WE1MSHR0cFJlcXVlc3QgYXJlIGNyZWF0ZWQgd2hlbiBhdmFpbGFibGUuPC9saT4KCSAqICAgICAgPGxpPkFjdGl2ZVguWE1MSFRUUCBvYmplY3RzIGFyZSB1c2VkIGluIG9sZGVyIElFIGJyb3dzZXJzLjwvbGk+CgkgKiAgICAgIDxsaT5UZXh0IHJlcXVlc3RzIG92ZXJyaWRlIHRoZSBtaW1lIHR5cGUgaWYgcG9zc2libGU8L2xpPgoJICogICAgICA8bGk+T3JpZ2luIGhlYWRlcnMgYXJlIHNlbnQgZm9yIGNyb3NzZG9tYWluIHJlcXVlc3RzIGluIHNvbWUgYnJvd3NlcnMuPC9saT4KCSAqICAgICAgPGxpPkJpbmFyeSBsb2FkcyBzZXQgdGhlIHJlc3BvbnNlIHR5cGUgdG8gImFycmF5YnVmZmVyIjwvbGk+PC9vbD4KCSAqIEBtZXRob2QgX2NyZWF0ZVhIUgoJICogQHBhcmFtIHtPYmplY3R9IGl0ZW0gVGhlIHJlcXVlc3RlZCBpdGVtIHRoYXQgaXMgYmVpbmcgbG9hZGVkLgoJICogQHJldHVybiB7Qm9vbGVhbn0gSWYgYW4gWEhSIHJlcXVlc3Qgb3IgZXF1aXZhbGVudCB3YXMgc3VjY2Vzc2Z1bGx5IGNyZWF0ZWQuCgkgKiBAcHJpdmF0ZQoJICovCglwLl9jcmVhdGVYSFIgPSBmdW5jdGlvbiAoaXRlbSkgewoJCS8vIENoZWNrIGZvciBjcm9zcy1kb21haW4gbG9hZHMuIFdlIGNhbid0IGZ1bGx5IHN1cHBvcnQgdGhlbSwgYnV0IHdlIGNhbiB0cnkuCgkJdmFyIGNyb3NzZG9tYWluID0gdGhpcy5faXNDcm9zc0RvbWFpbihpdGVtKTsKCgkJLy8gQ3JlYXRlIHRoZSByZXF1ZXN0LiBGYWxsIGJhY2sgdG8gd2hhdGV2ZXIgc3VwcG9ydCB3ZSBoYXZlLgoJCXZhciByZXEgPSBudWxsOwoJCWlmIChjcm9zc2RvbWFpbiAmJiB3aW5kb3cuWERvbWFpblJlcXVlc3QpIHsKCQkJcmVxID0gbmV3IFhEb21haW5SZXF1ZXN0KCk7IC8vIE5vdGU6IElFOSB3aWxsIGZhaWwgaWYgdGhpcyBpcyBub3QgYWN0dWFsbHkgY3Jvc3MtZG9tYWluLgoJCX0gZWxzZSBpZiAod2luZG93LlhNTEh0dHBSZXF1ZXN0KSB7IC8vIE9sZCBJRSB2ZXJzaW9ucyB1c2UgYSBkaWZmZXJlbnQgYXBwcm9hY2gKCQkJcmVxID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7CgkJfSBlbHNlIHsKCQkJdHJ5IHsKCQkJCXJlcSA9IG5ldyBBY3RpdmVYT2JqZWN0KCJNc3htbDIuWE1MSFRUUC42LjAiKTsKCQkJfSBjYXRjaCAoZSkgewoJCQkJdHJ5IHsKCQkJCQlyZXEgPSBuZXcgQWN0aXZlWE9iamVjdCgiTXN4bWwyLlhNTEhUVFAuMy4wIik7CgkJCQl9IGNhdGNoIChlKSB7CgkJCQkJdHJ5IHsKCQkJCQkJcmVxID0gbmV3IEFjdGl2ZVhPYmplY3QoIk1zeG1sMi5YTUxIVFRQIik7CgkJCQkJfSBjYXRjaCAoZSkgewoJCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoKCQkvLyBJRTkgZG9lc24ndCBzdXBwb3J0IG92ZXJyaWRlTWltZVR5cGUoKSwgc28gd2UgbmVlZCB0byBjaGVjayBmb3IgaXQuCgkJaWYgKGNyZWF0ZWpzLkxvYWRRdWV1ZS5pc1RleHQoaXRlbS50eXBlKSAmJiByZXEub3ZlcnJpZGVNaW1lVHlwZSkgewoJCQlyZXEub3ZlcnJpZGVNaW1lVHlwZSgidGV4dC9wbGFpbjsgY2hhcnNldD11dGYtOCIpOwoJCX0KCgkJLy8gRGV0ZXJtaW5lIHRoZSBYSFIgbGV2ZWwKCQl0aGlzLl94aHJMZXZlbCA9ICh0eXBlb2YgcmVxLnJlc3BvbnNlVHlwZSA9PT0gInN0cmluZyIpID8gMiA6IDE7CgoJCXZhciBzcmMgPSBudWxsOwoJCWlmIChpdGVtLm1ldGhvZCA9PSBjcmVhdGVqcy5Mb2FkUXVldWUuR0VUKSB7CgkJCXNyYyA9IHRoaXMuYnVpbGRQYXRoKGl0ZW0uc3JjLCBpdGVtLnZhbHVlcyk7CgkJfSBlbHNlIHsKCQkJc3JjID0gaXRlbS5zcmM7CgkJfQoKCQkvLyBPcGVuIHRoZSByZXF1ZXN0LiAgU2V0IGNyb3NzLWRvbWFpbiBmbGFncyBpZiBpdCBpcyBzdXBwb3J0ZWQgKFhIUiBsZXZlbCAxIG9ubHkpCgkJcmVxLm9wZW4oaXRlbS5tZXRob2QgfHwgY3JlYXRlanMuTG9hZFF1ZXVlLkdFVCwgc3JjLCB0cnVlKTsKCgkJaWYgKGNyb3NzZG9tYWluICYmIHJlcSBpbnN0YW5jZW9mIFhNTEh0dHBSZXF1ZXN0ICYmIHRoaXMuX3hockxldmVsID09IDEpIHsKCQkJcmVxLnNldFJlcXVlc3RIZWFkZXIoIk9yaWdpbiIsIGxvY2F0aW9uLm9yaWdpbik7CgkJfQoKICAgICAgICAvKlRPRE86IFRlc3QgYW5kIGltcGxlbWVudC4KICAgICAgICBpZiAoY3Jvc3NEb21haW4gJiYgIWhlYWRlcnNbIlgtUmVxdWVzdGVkLVdpdGgiXSApIHsKICAgICAgICAgICAgICAgIGhlYWRlcnNbIlgtUmVxdWVzdGVkLVdpdGgiXSA9ICJYTUxIdHRwUmVxdWVzdCI7CiAgICAgICAgfSovCgoJCS8vIFRvIHNlbmQgZGF0YSB3ZSBuZWVkIHRvIHNldCB0aGUgQ29udGVudC10eXBlIGhlYWRlcikKCQkgaWYgKGl0ZW0udmFsdWVzICYmIGl0ZW0ubWV0aG9kID09IGNyZWF0ZWpzLkxvYWRRdWV1ZS5QT1NUKSB7CgkJCXJlcS5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkJyk7CgkJIH0KCgkJLy8gQmluYXJ5IGZpbGVzIGFyZSBsb2FkZWQgZGlmZmVyZW50bHkuCgkJaWYgKGNyZWF0ZWpzLkxvYWRRdWV1ZS5pc0JpbmFyeShpdGVtLnR5cGUpKSB7CgkJCXJlcS5yZXNwb25zZVR5cGUgPSAiYXJyYXlidWZmZXIiOwoJCX0KCgkJdGhpcy5fcmVxdWVzdCA9IHJlcTsKCQlyZXR1cm4gdHJ1ZTsKCX07CgoJLyoqCgkgKiBBIHJlcXVlc3QgaGFzIGNvbXBsZXRlZCAob3IgZmFpbGVkIG9yIGNhbmNlbGVkKSwgYW5kIG5lZWRzIHRvIGJlIGRpc3Bvc2VkLgoJICogQG1ldGhvZCBfY2xlYW4KCSAqIEBwcml2YXRlCgkgKi8KCXAuX2NsZWFuID0gZnVuY3Rpb24gKCkgewoJCWNsZWFyVGltZW91dCh0aGlzLl9sb2FkVGltZW91dCk7CgoJCXZhciByZXEgPSB0aGlzLl9yZXF1ZXN0OwoJCXJlcS5vbmxvYWRzdGFydCA9IG51bGw7CgkJcmVxLm9ucHJvZ3Jlc3MgPSBudWxsOwoJCXJlcS5vbmFib3J0ID0gbnVsbDsKCQlyZXEub25lcnJvciA9IG51bGw7CgkJcmVxLm9ubG9hZCA9IG51bGw7CgkJcmVxLm9udGltZW91dCA9IG51bGw7CgkJcmVxLm9ubG9hZGVuZCA9IG51bGw7CgkJcmVxLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IG51bGw7Cgl9OwoKCS8qKgoJICogR2VuZXJhdGUgYSB0YWcgZm9yIGl0ZW1zIHRoYXQgY2FuIGJlIHJlcHJlc2VudGVkIGFzIHRhZ3MuIEZvciBleGFtcGxlLCBJTUFHRSwgU0NSSVBULCBhbmQgTElOSy4gVGhpcyBhbHNvIGhhbmRsZXMKCSAqIFhNTCBhbmQgU1ZHIG9iamVjdHMuCgkgKiBAbWV0aG9kIF9nZW5lcmF0ZVRhZwoJICogQHJldHVybiB7Qm9vbGVhbn0gSWYgYSB0YWcgd2FzIGdlbmVyYXRlZCBhbmQgaXMgcmVhZHkgZm9yIGluc3RhbnRpYXRpb24uIElmIGl0IHN0aWxsIG5lZWRzIHByb2Nlc3NpbmcsIHRoaXMKCSAqIG1ldGhvZCByZXR1cm5zIGZhbHNlLgoJICogQHByaXZhdGUKCSAqLwoJcC5fZ2VuZXJhdGVUYWcgPSBmdW5jdGlvbiAoKSB7CgkJdmFyIHR5cGUgPSB0aGlzLl9pdGVtLnR5cGU7CgkJdmFyIHRhZyA9IHRoaXMuX2l0ZW0udGFnOwoKCQlzd2l0Y2ggKHR5cGUpIHsKCQkJLy8gTm90ZTogSW1hZ2VzIG5lZWQgdG8gd2FpdCBmb3Igb25sb2FkLCBidXQgZG8gdXNlIHRoZSBjYWNoZS4KCQkJY2FzZSBjcmVhdGVqcy5Mb2FkUXVldWUuSU1BR0U6CgkJCQl0YWcub25sb2FkID0gY3JlYXRlanMucHJveHkodGhpcy5faGFuZGxlVGFnUmVhZHksIHRoaXMpOwoJCQkJaWYgKHRoaXMuX2Nyb3NzT3JpZ2luICE9ICIiKSB7IHRhZy5jcm9zc09yaWdpbiA9ICJBbm9ueW1vdXMiOyB9Ly8gV2UgY2FuIGFzc3VtZSB0aGlzLCBzaW5jZSBYSFIgaW1hZ2VzIGFyZSBhbHdheXMgbG9hZGVkIG9uIGEgc2VydmVyLgoJCQkJdGFnLnNyYyA9IHRoaXMuYnVpbGRQYXRoKHRoaXMuX2l0ZW0uc3JjLCB0aGlzLl9pdGVtLnZhbHVlcyk7CgoJCQkJdGhpcy5fcmF3UmVzcG9uc2UgPSB0aGlzLl9yZXNwb25zZTsKCQkJCXRoaXMuX3Jlc3BvbnNlID0gdGFnOwoJCQkJcmV0dXJuIGZhbHNlOyAvLyBJbWFnZXMgbmVlZCB0byBnZXQgYW4gb25sb2FkIGV2ZW50IGZpcnN0CgoJCQljYXNlIGNyZWF0ZWpzLkxvYWRRdWV1ZS5KQVZBU0NSSVBUOgoJCQkJdGFnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic2NyaXB0Iik7CgkJCQl0YWcudGV4dCA9IHRoaXMuX3Jlc3BvbnNlOwoKCQkJCXRoaXMuX3Jhd1Jlc3BvbnNlID0gdGhpcy5fcmVzcG9uc2U7CgkJCQl0aGlzLl9yZXNwb25zZSA9IHRhZzsKCQkJCXJldHVybiB0cnVlOwoKCQkJY2FzZSBjcmVhdGVqcy5Mb2FkUXVldWUuQ1NTOgoJCQkJLy8gTWF5YmUgZG8gdGhpcyBjb25kaXRpb25hbGx5PwoJCQkJdmFyIGhlYWQgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaGVhZCIpWzBdOyAvL05vdGU6IFRoaXMgaXMgdW5hdm9pZGFibGUgaW4gSUU2NzgKCQkJCWhlYWQuYXBwZW5kQ2hpbGQodGFnKTsKCgkJCQlpZiAodGFnLnN0eWxlU2hlZXQpIHsgLy8gSUUKCQkJCQl0YWcuc3R5bGVTaGVldC5jc3NUZXh0ID0gdGhpcy5fcmVzcG9uc2U7CgkJCQl9IGVsc2UgewoJCQkJCXZhciB0ZXh0Tm9kZSA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHRoaXMuX3Jlc3BvbnNlKTsKCQkJCQl0YWcuYXBwZW5kQ2hpbGQodGV4dE5vZGUpOwoJCQkJfQoKCQkJCXRoaXMuX3Jhd1Jlc3BvbnNlID0gdGhpcy5fcmVzcG9uc2U7CgkJCQl0aGlzLl9yZXNwb25zZSA9IHRhZzsKCQkJCXJldHVybiB0cnVlOwoKCQkJY2FzZSBjcmVhdGVqcy5Mb2FkUXVldWUuWE1MOgoJCQkJdmFyIHhtbCA9IHRoaXMuX3BhcnNlWE1MKHRoaXMuX3Jlc3BvbnNlLCAidGV4dC94bWwiKTsKCQkJCXRoaXMuX3Jhd1Jlc3BvbnNlID0gdGhpcy5fcmVzcG9uc2U7CgkJCQl0aGlzLl9yZXNwb25zZSA9IHhtbDsKCQkJCXJldHVybiB0cnVlOwoKCQkJY2FzZSBjcmVhdGVqcy5Mb2FkUXVldWUuU1ZHOgoJCQkJdmFyIHhtbCA9IHRoaXMuX3BhcnNlWE1MKHRoaXMuX3Jlc3BvbnNlLCAiaW1hZ2Uvc3ZnK3htbCIpOwoJCQkJdGhpcy5fcmF3UmVzcG9uc2UgPSB0aGlzLl9yZXNwb25zZTsKCQkJCWlmICh4bWwuZG9jdW1lbnRFbGVtZW50ICE9IG51bGwpIHsKCQkJCQl0YWcuYXBwZW5kQ2hpbGQoeG1sLmRvY3VtZW50RWxlbWVudCk7CgkJCQkJdGhpcy5fcmVzcG9uc2UgPSB0YWc7CgkJCQl9IGVsc2UgeyAvLyBGb3IgYnJvd3NlcnMgdGhhdCBkb24ndCBzdXBwb3J0IFNWRywganVzdCBnaXZlIHRoZW0gdGhlIFhNTC4gKElFIDktOCkKCQkJCQl0aGlzLl9yZXNwb25zZSA9IHhtbDsKCQkJCX0KCQkJCXJldHVybiB0cnVlOwoKCQkJY2FzZSBjcmVhdGVqcy5Mb2FkUXVldWUuSlNPTjoKCQkJY2FzZSBjcmVhdGVqcy5Mb2FkUXVldWUuTUFOSUZFU1Q6CgkJCQl2YXIganNvbiA9IHt9OwoJCQkJdHJ5IHsKCQkJCQlqc29uID0gSlNPTi5wYXJzZSh0aGlzLl9yZXNwb25zZSk7CgkJCQl9IGNhdGNoIChlcnJvcikgewoJCQkJCWpzb24gPSBlcnJvcjsKCQkJCX0KCgkJCQl0aGlzLl9yYXdSZXNwb25zZSA9IHRoaXMuX3Jlc3BvbnNlOwoJCQkJdGhpcy5fcmVzcG9uc2UgPSBqc29uOwoJCQkJcmV0dXJuIHRydWU7CgoJCX0KCQlyZXR1cm4gdHJ1ZTsKCX07CgoJLyoqCgkgKiBQYXJzZSBYTUwgdXNpbmcgdGhlIERPTS4gVGhpcyBpcyByZXF1aXJlZCB3aGVuIHByZWxvYWRpbmcgWE1MIG9yIFNWRy4KCSAqIEBtZXRob2QgX3BhcnNlWE1MCgkgKiBAcGFyYW0ge1N0cmluZ30gdGV4dCBUaGUgcmF3IHRleHQgb3IgWE1MIHRoYXQgaXMgbG9hZGVkIGJ5IFhIUi4KCSAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlIFRoZSBtaW1lIHR5cGUgb2YgdGhlIFhNTC4KCSAqIEByZXR1cm4ge1hNTH0gQW4gWE1MIGRvY3VtZW50LgoJICogQHByaXZhdGUKCSAqLwoJcC5fcGFyc2VYTUwgPSBmdW5jdGlvbiAodGV4dCwgdHlwZSkgewoJCXZhciB4bWwgPSBudWxsOwoJCXRyeSB7CgkJCS8vIENvY29vbkpTIGRvZXMgbm90IHN1cHBvcnQgWE1MIHBhcnNpbmcgd2l0aCBlaXRoZXIgbWV0aG9kLgoJCQkvLyBXaW5kb3dzICg/KSBPcGVyYSBET01QYXJzZXIgdGhyb3dzIERPTUV4Y2VwdGlvbjogTk9UX1NVUFBPUlRFRF9FUlIgIC8vIHBvdGVudGlhbCBzb2x1dGlvbiBodHRwczovL2dpc3QuZ2l0aHViLmNvbS8xMTI5MDMxCgkJCWlmICh3aW5kb3cuRE9NUGFyc2VyKSB7CgkJCQl2YXIgcGFyc2VyID0gbmV3IERPTVBhcnNlcigpOwoJCQkJeG1sID0gcGFyc2VyLnBhcnNlRnJvbVN0cmluZyh0ZXh0LCB0eXBlKTsKCQkJfSBlbHNlIHsgLy8gSUUKCQkJCXhtbCA9IG5ldyBBY3RpdmVYT2JqZWN0KCJNaWNyb3NvZnQuWE1MRE9NIik7CgkJCQl4bWwuYXN5bmMgPSBmYWxzZTsKCQkJCXhtbC5sb2FkWE1MKHRleHQpOwoJCQl9CgkJfSBjYXRjaCAoZSkge30KCQlyZXR1cm4geG1sOwoJfTsKCgkvKioKCSAqIEEgZ2VuZXJhdGVkIHRhZyBpcyBub3cgcmVhZHkgZm9yIHVzZS4KCSAqIEBtZXRob2QgX2hhbmRsZVRhZ1JlYWR5CgkgKiBAcHJpdmF0ZQoJICovCglwLl9oYW5kbGVUYWdSZWFkeSA9IGZ1bmN0aW9uICgpIHsKCQl0aGlzLl9zZW5kQ29tcGxldGUoKTsKCX07CgoJcC50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHsKCQlyZXR1cm4gIltQcmVsb2FkSlMgWEhSTG9hZGVyXSI7Cgl9OwoKCWNyZWF0ZWpzLlhIUkxvYWRlciA9IFhIUkxvYWRlcjsKCn0oKSk7CgovKioKICogSW5jbHVkZSBqc29uMiBoZXJlLCB0byBjb3JyZWN0bHkgcGFyc2UganNvbi4KICogVXNlZCBvbiBicm93c2VycyB0aGF0IGRvbid0IGhhdmUgYSBuYXRpdmUgSlNPTiBvYmplY3QuCiAqCiAqLwovKgoganNvbjIuanMKIDIwMTItMTAtMDgKCiBQdWJsaWMgRG9tYWluLgoKIE5PIFdBUlJBTlRZIEVYUFJFU1NFRCBPUiBJTVBMSUVELiBVU0UgQVQgWU9VUiBPV04gUklTSy4KCiBTZWUgaHR0cDovL3d3dy5KU09OLm9yZy9qcy5odG1sCgoKIFRoaXMgY29kZSBzaG91bGQgYmUgbWluaWZpZWQgYmVmb3JlIGRlcGxveW1lbnQuCiBTZWUgaHR0cDovL2phdmFzY3JpcHQuY3JvY2tmb3JkLmNvbS9qc21pbi5odG1sCgogVVNFIFlPVVIgT1dOIENPUFkuIElUIElTIEVYVFJFTUVMWSBVTldJU0UgVE8gTE9BRCBDT0RFIEZST00gU0VSVkVSUyBZT1UgRE8KIE5PVCBDT05UUk9MLgogKi8KCgovLyBDcmVhdGUgYSBKU09OIG9iamVjdCBvbmx5IGlmIG9uZSBkb2VzIG5vdCBhbHJlYWR5IGV4aXN0LiBXZSBjcmVhdGUgdGhlCi8vIG1ldGhvZHMgaW4gYSBjbG9zdXJlIHRvIGF2b2lkIGNyZWF0aW5nIGdsb2JhbCB2YXJpYWJsZXMuCgppZiAodHlwZW9mIEpTT04gIT09ICdvYmplY3QnKSB7CglKU09OID0ge307Cn0KCihmdW5jdGlvbiAoKSB7CgkndXNlIHN0cmljdCc7CgoJZnVuY3Rpb24gZihuKSB7CgkJLy8gRm9ybWF0IGludGVnZXJzIHRvIGhhdmUgYXQgbGVhc3QgdHdvIGRpZ2l0cy4KCQlyZXR1cm4gbiA8IDEwID8gJzAnICsgbiA6IG47Cgl9CgoJaWYgKHR5cGVvZiBEYXRlLnByb3RvdHlwZS50b0pTT04gIT09ICdmdW5jdGlvbicpIHsKCgkJRGF0ZS5wcm90b3R5cGUudG9KU09OID0gZnVuY3Rpb24gKGtleSkgewoKCQkJcmV0dXJuIGlzRmluaXRlKHRoaXMudmFsdWVPZigpKQoJCQkJCT8gdGhpcy5nZXRVVENGdWxsWWVhcigpICsgJy0nICsKCQkJCQlmKHRoaXMuZ2V0VVRDTW9udGgoKSArIDEpICsgJy0nICsKCQkJCQlmKHRoaXMuZ2V0VVRDRGF0ZSgpKSArICdUJyArCgkJCQkJZih0aGlzLmdldFVUQ0hvdXJzKCkpICsgJzonICsKCQkJCQlmKHRoaXMuZ2V0VVRDTWludXRlcygpKSArICc6JyArCgkJCQkJZih0aGlzLmdldFVUQ1NlY29uZHMoKSkgKyAnWicKCQkJCQk6IG51bGw7CgkJfTsKCgkJU3RyaW5nLnByb3RvdHlwZS50b0pTT04gPQoJCQkJTnVtYmVyLnByb3RvdHlwZS50b0pTT04gPQoJCQkJCQlCb29sZWFuLnByb3RvdHlwZS50b0pTT04gPSBmdW5jdGlvbiAoa2V5KSB7CgkJCQkJCQlyZXR1cm4gdGhpcy52YWx1ZU9mKCk7CgkJCQkJCX07Cgl9CgoJdmFyIGN4ID0gL1tcdTAwMDBcdTAwYWRcdTA2MDAtXHUwNjA0XHUwNzBmXHUxN2I0XHUxN2I1XHUyMDBjLVx1MjAwZlx1MjAyOC1cdTIwMmZcdTIwNjAtXHUyMDZmXHVmZWZmXHVmZmYwLVx1ZmZmZl0vZywKCQkJZXNjYXBhYmxlID0gL1tcXFwiXHgwMC1ceDFmXHg3Zi1ceDlmXHUwMGFkXHUwNjAwLVx1MDYwNFx1MDcwZlx1MTdiNFx1MTdiNVx1MjAwYy1cdTIwMGZcdTIwMjgtXHUyMDJmXHUyMDYwLVx1MjA2Zlx1ZmVmZlx1ZmZmMC1cdWZmZmZdL2csCgkJCWdhcCwKCQkJaW5kZW50LAoJCQltZXRhID0geyAgICAvLyB0YWJsZSBvZiBjaGFyYWN0ZXIgc3Vic3RpdHV0aW9ucwoJCQkJJ1xiJzonXFxiJywKCQkJCSdcdCc6J1xcdCcsCgkJCQknXG4nOidcXG4nLAoJCQkJJ1xmJzonXFxmJywKCQkJCSdccic6J1xccicsCgkJCQknIic6J1xcIicsCgkJCQknXFwnOidcXFxcJwoJCQl9LAoJCQlyZXA7CgoKCWZ1bmN0aW9uIHF1b3RlKHN0cmluZykgewoKLy8gSWYgdGhlIHN0cmluZyBjb250YWlucyBubyBjb250cm9sIGNoYXJhY3RlcnMsIG5vIHF1b3RlIGNoYXJhY3RlcnMsIGFuZCBubwovLyBiYWNrc2xhc2ggY2hhcmFjdGVycywgdGhlbiB3ZSBjYW4gc2FmZWx5IHNsYXAgc29tZSBxdW90ZXMgYXJvdW5kIGl0LgovLyBPdGhlcndpc2Ugd2UgbXVzdCBhbHNvIHJlcGxhY2UgdGhlIG9mZmVuZGluZyBjaGFyYWN0ZXJzIHdpdGggc2FmZSBlc2NhcGUKLy8gc2VxdWVuY2VzLgoKCQllc2NhcGFibGUubGFzdEluZGV4ID0gMDsKCQlyZXR1cm4gZXNjYXBhYmxlLnRlc3Qoc3RyaW5nKSA/ICciJyArIHN0cmluZy5yZXBsYWNlKGVzY2FwYWJsZSwgZnVuY3Rpb24gKGEpIHsKCQkJdmFyIGMgPSBtZXRhW2FdOwoJCQlyZXR1cm4gdHlwZW9mIGMgPT09ICdzdHJpbmcnCgkJCQkJPyBjCgkJCQkJOiAnXFx1JyArICgnMDAwMCcgKyBhLmNoYXJDb2RlQXQoMCkudG9TdHJpbmcoMTYpKS5zbGljZSgtNCk7CgkJfSkgKyAnIicgOiAnIicgKyBzdHJpbmcgKyAnIic7Cgl9CgoKCWZ1bmN0aW9uIHN0cihrZXksIGhvbGRlcikgewoKLy8gUHJvZHVjZSBhIHN0cmluZyBmcm9tIGhvbGRlcltrZXldLgoKCQl2YXIgaSwgLy8gVGhlIGxvb3AgY291bnRlci4KCQkJCWssIC8vIFRoZSBtZW1iZXIga2V5LgoJCQkJdiwgLy8gVGhlIG1lbWJlciB2YWx1ZS4KCQkJCWxlbmd0aCwKCQkJCW1pbmQgPSBnYXAsCgkJCQlwYXJ0aWFsLAoJCQkJdmFsdWUgPSBob2xkZXJba2V5XTsKCi8vIElmIHRoZSB2YWx1ZSBoYXMgYSB0b0pTT04gbWV0aG9kLCBjYWxsIGl0IHRvIG9idGFpbiBhIHJlcGxhY2VtZW50IHZhbHVlLgoKCQlpZiAodmFsdWUgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJgoJCQkJdHlwZW9mIHZhbHVlLnRvSlNPTiA9PT0gJ2Z1bmN0aW9uJykgewoJCQl2YWx1ZSA9IHZhbHVlLnRvSlNPTihrZXkpOwoJCX0KCi8vIElmIHdlIHdlcmUgY2FsbGVkIHdpdGggYSByZXBsYWNlciBmdW5jdGlvbiwgdGhlbiBjYWxsIHRoZSByZXBsYWNlciB0bwovLyBvYnRhaW4gYSByZXBsYWNlbWVudCB2YWx1ZS4KCgkJaWYgKHR5cGVvZiByZXAgPT09ICdmdW5jdGlvbicpIHsKCQkJdmFsdWUgPSByZXAuY2FsbChob2xkZXIsIGtleSwgdmFsdWUpOwoJCX0KCi8vIFdoYXQgaGFwcGVucyBuZXh0IGRlcGVuZHMgb24gdGhlIHZhbHVlJ3MgdHlwZS4KCgkJc3dpdGNoICh0eXBlb2YgdmFsdWUpIHsKCQkJY2FzZSAnc3RyaW5nJzoKCQkJCXJldHVybiBxdW90ZSh2YWx1ZSk7CgoJCQljYXNlICdudW1iZXInOgoKLy8gSlNPTiBudW1iZXJzIG11c3QgYmUgZmluaXRlLiBFbmNvZGUgbm9uLWZpbml0ZSBudW1iZXJzIGFzIG51bGwuCgoJCQkJcmV0dXJuIGlzRmluaXRlKHZhbHVlKSA/IFN0cmluZyh2YWx1ZSkgOiAnbnVsbCc7CgoJCQljYXNlICdib29sZWFuJzoKCQkJY2FzZSAnbnVsbCc6CgovLyBJZiB0aGUgdmFsdWUgaXMgYSBib29sZWFuIG9yIG51bGwsIGNvbnZlcnQgaXQgdG8gYSBzdHJpbmcuIE5vdGU6Ci8vIHR5cGVvZiBudWxsIGRvZXMgbm90IHByb2R1Y2UgJ251bGwnLiBUaGUgY2FzZSBpcyBpbmNsdWRlZCBoZXJlIGluCi8vIHRoZSByZW1vdGUgY2hhbmNlIHRoYXQgdGhpcyBnZXRzIGZpeGVkIHNvbWVkYXkuCgoJCQkJcmV0dXJuIFN0cmluZyh2YWx1ZSk7CgovLyBJZiB0aGUgdHlwZSBpcyAnb2JqZWN0Jywgd2UgbWlnaHQgYmUgZGVhbGluZyB3aXRoIGFuIG9iamVjdCBvciBhbiBhcnJheSBvcgovLyBudWxsLgoKCQkJY2FzZSAnb2JqZWN0JzoKCi8vIER1ZSB0byBhIHNwZWNpZmljYXRpb24gYmx1bmRlciBpbiBFQ01BU2NyaXB0LCB0eXBlb2YgbnVsbCBpcyAnb2JqZWN0JywKLy8gc28gd2F0Y2ggb3V0IGZvciB0aGF0IGNhc2UuCgoJCQkJaWYgKCF2YWx1ZSkgewoJCQkJCXJldHVybiAnbnVsbCc7CgkJCQl9CgovLyBNYWtlIGFuIGFycmF5IHRvIGhvbGQgdGhlIHBhcnRpYWwgcmVzdWx0cyBvZiBzdHJpbmdpZnlpbmcgdGhpcyBvYmplY3QgdmFsdWUuCgoJCQkJZ2FwICs9IGluZGVudDsKCQkJCXBhcnRpYWwgPSBbXTsKCi8vIElzIHRoZSB2YWx1ZSBhbiBhcnJheT8KCgkJCQlpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5hcHBseSh2YWx1ZSkgPT09ICdbb2JqZWN0IEFycmF5XScpIHsKCi8vIFRoZSB2YWx1ZSBpcyBhbiBhcnJheS4gU3RyaW5naWZ5IGV2ZXJ5IGVsZW1lbnQuIFVzZSBudWxsIGFzIGEgcGxhY2Vob2xkZXIKLy8gZm9yIG5vbi1KU09OIHZhbHVlcy4KCgkJCQkJbGVuZ3RoID0gdmFsdWUubGVuZ3RoOwoJCQkJCWZvciAoaSA9IDA7IGkgPCBsZW5ndGg7IGkgKz0gMSkgewoJCQkJCQlwYXJ0aWFsW2ldID0gc3RyKGksIHZhbHVlKSB8fCAnbnVsbCc7CgkJCQkJfQoKLy8gSm9pbiBhbGwgb2YgdGhlIGVsZW1lbnRzIHRvZ2V0aGVyLCBzZXBhcmF0ZWQgd2l0aCBjb21tYXMsIGFuZCB3cmFwIHRoZW0gaW4KLy8gYnJhY2tldHMuCgoJCQkJCXYgPSBwYXJ0aWFsLmxlbmd0aCA9PT0gMAoJCQkJCQkJPyAnW10nCgkJCQkJCQk6IGdhcAoJCQkJCQkJPyAnW1xuJyArIGdhcCArIHBhcnRpYWwuam9pbignLFxuJyArIGdhcCkgKyAnXG4nICsgbWluZCArICddJwoJCQkJCQkJOiAnWycgKyBwYXJ0aWFsLmpvaW4oJywnKSArICddJzsKCQkJCQlnYXAgPSBtaW5kOwoJCQkJCXJldHVybiB2OwoJCQkJfQoKLy8gSWYgdGhlIHJlcGxhY2VyIGlzIGFuIGFycmF5LCB1c2UgaXQgdG8gc2VsZWN0IHRoZSBtZW1iZXJzIHRvIGJlIHN0cmluZ2lmaWVkLgoKCQkJCWlmIChyZXAgJiYgdHlwZW9mIHJlcCA9PT0gJ29iamVjdCcpIHsKCQkJCQlsZW5ndGggPSByZXAubGVuZ3RoOwoJCQkJCWZvciAoaSA9IDA7IGkgPCBsZW5ndGg7IGkgKz0gMSkgewoJCQkJCQlpZiAodHlwZW9mIHJlcFtpXSA9PT0gJ3N0cmluZycpIHsKCQkJCQkJCWsgPSByZXBbaV07CgkJCQkJCQl2ID0gc3RyKGssIHZhbHVlKTsKCQkJCQkJCWlmICh2KSB7CgkJCQkJCQkJcGFydGlhbC5wdXNoKHF1b3RlKGspICsgKGdhcCA/ICc6ICcgOiAnOicpICsgdik7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9CgkJCQl9IGVsc2UgewoKLy8gT3RoZXJ3aXNlLCBpdGVyYXRlIHRocm91Z2ggYWxsIG9mIHRoZSBrZXlzIGluIHRoZSBvYmplY3QuCgoJCQkJCWZvciAoayBpbiB2YWx1ZSkgewoJCQkJCQlpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHZhbHVlLCBrKSkgewoJCQkJCQkJdiA9IHN0cihrLCB2YWx1ZSk7CgkJCQkJCQlpZiAodikgewoJCQkJCQkJCXBhcnRpYWwucHVzaChxdW90ZShrKSArIChnYXAgPyAnOiAnIDogJzonKSArIHYpOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoJCQkJfQoKLy8gSm9pbiBhbGwgb2YgdGhlIG1lbWJlciB0ZXh0cyB0b2dldGhlciwgc2VwYXJhdGVkIHdpdGggY29tbWFzLAovLyBhbmQgd3JhcCB0aGVtIGluIGJyYWNlcy4KCgkJCQl2ID0gcGFydGlhbC5sZW5ndGggPT09IDAKCQkJCQkJPyAne30nCgkJCQkJCTogZ2FwCgkJCQkJCT8gJ3tcbicgKyBnYXAgKyBwYXJ0aWFsLmpvaW4oJyxcbicgKyBnYXApICsgJ1xuJyArIG1pbmQgKyAnfScKCQkJCQkJOiAneycgKyBwYXJ0aWFsLmpvaW4oJywnKSArICd9JzsKCQkJCWdhcCA9IG1pbmQ7CgkJCQlyZXR1cm4gdjsKCQl9Cgl9CgovLyBJZiB0aGUgSlNPTiBvYmplY3QgZG9lcyBub3QgeWV0IGhhdmUgYSBzdHJpbmdpZnkgbWV0aG9kLCBnaXZlIGl0IG9uZS4KCglpZiAodHlwZW9mIEpTT04uc3RyaW5naWZ5ICE9PSAnZnVuY3Rpb24nKSB7CgkJSlNPTi5zdHJpbmdpZnkgPSBmdW5jdGlvbiAodmFsdWUsIHJlcGxhY2VyLCBzcGFjZSkgewoKLy8gVGhlIHN0cmluZ2lmeSBtZXRob2QgdGFrZXMgYSB2YWx1ZSBhbmQgYW4gb3B0aW9uYWwgcmVwbGFjZXIsIGFuZCBhbiBvcHRpb25hbAovLyBzcGFjZSBwYXJhbWV0ZXIsIGFuZCByZXR1cm5zIGEgSlNPTiB0ZXh0LiBUaGUgcmVwbGFjZXIgY2FuIGJlIGEgZnVuY3Rpb24KLy8gdGhhdCBjYW4gcmVwbGFjZSB2YWx1ZXMsIG9yIGFuIGFycmF5IG9mIHN0cmluZ3MgdGhhdCB3aWxsIHNlbGVjdCB0aGUga2V5cy4KLy8gQSBkZWZhdWx0IHJlcGxhY2VyIG1ldGhvZCBjYW4gYmUgcHJvdmlkZWQuIFVzZSBvZiB0aGUgc3BhY2UgcGFyYW1ldGVyIGNhbgovLyBwcm9kdWNlIHRleHQgdGhhdCBpcyBtb3JlIGVhc2lseSByZWFkYWJsZS4KCgkJCXZhciBpOwoJCQlnYXAgPSAnJzsKCQkJaW5kZW50ID0gJyc7CgovLyBJZiB0aGUgc3BhY2UgcGFyYW1ldGVyIGlzIGEgbnVtYmVyLCBtYWtlIGFuIGluZGVudCBzdHJpbmcgY29udGFpbmluZyB0aGF0Ci8vIG1hbnkgc3BhY2VzLgoKCQkJaWYgKHR5cGVvZiBzcGFjZSA9PT0gJ251bWJlcicpIHsKCQkJCWZvciAoaSA9IDA7IGkgPCBzcGFjZTsgaSArPSAxKSB7CgkJCQkJaW5kZW50ICs9ICcgJzsKCQkJCX0KCi8vIElmIHRoZSBzcGFjZSBwYXJhbWV0ZXIgaXMgYSBzdHJpbmcsIGl0IHdpbGwgYmUgdXNlZCBhcyB0aGUgaW5kZW50IHN0cmluZy4KCgkJCX0gZWxzZSBpZiAodHlwZW9mIHNwYWNlID09PSAnc3RyaW5nJykgewoJCQkJaW5kZW50ID0gc3BhY2U7CgkJCX0KCi8vIElmIHRoZXJlIGlzIGEgcmVwbGFjZXIsIGl0IG11c3QgYmUgYSBmdW5jdGlvbiBvciBhbiBhcnJheS4KLy8gT3RoZXJ3aXNlLCB0aHJvdyBhbiBlcnJvci4KCgkJCXJlcCA9IHJlcGxhY2VyOwoJCQlpZiAocmVwbGFjZXIgJiYgdHlwZW9mIHJlcGxhY2VyICE9PSAnZnVuY3Rpb24nICYmCgkJCQkJKHR5cGVvZiByZXBsYWNlciAhPT0gJ29iamVjdCcgfHwKCQkJCQkJCXR5cGVvZiByZXBsYWNlci5sZW5ndGggIT09ICdudW1iZXInKSkgewoJCQkJdGhyb3cgbmV3IEVycm9yKCdKU09OLnN0cmluZ2lmeScpOwoJCQl9CgovLyBNYWtlIGEgZmFrZSByb290IG9iamVjdCBjb250YWluaW5nIG91ciB2YWx1ZSB1bmRlciB0aGUga2V5IG9mICcnLgovLyBSZXR1cm4gdGhlIHJlc3VsdCBvZiBzdHJpbmdpZnlpbmcgdGhlIHZhbHVlLgoKCQkJcmV0dXJuIHN0cignJywgeycnOnZhbHVlfSk7CgkJfTsKCX0KCgovLyBJZiB0aGUgSlNPTiBvYmplY3QgZG9lcyBub3QgeWV0IGhhdmUgYSBwYXJzZSBtZXRob2QsIGdpdmUgaXQgb25lLgoKCWlmICh0eXBlb2YgSlNPTi5wYXJzZSAhPT0gJ2Z1bmN0aW9uJykgewoJCUpTT04ucGFyc2UgPSBmdW5jdGlvbiAodGV4dCwgcmV2aXZlcikgewoKLy8gVGhlIHBhcnNlIG1ldGhvZCB0YWtlcyBhIHRleHQgYW5kIGFuIG9wdGlvbmFsIHJldml2ZXIgZnVuY3Rpb24sIGFuZCByZXR1cm5zCi8vIGEgSmF2YVNjcmlwdCB2YWx1ZSBpZiB0aGUgdGV4dCBpcyBhIHZhbGlkIEpTT04gdGV4dC4KCgkJCXZhciBqOwoKCQkJZnVuY3Rpb24gd2Fsayhob2xkZXIsIGtleSkgewoKLy8gVGhlIHdhbGsgbWV0aG9kIGlzIHVzZWQgdG8gcmVjdXJzaXZlbHkgd2FsayB0aGUgcmVzdWx0aW5nIHN0cnVjdHVyZSBzbwovLyB0aGF0IG1vZGlmaWNhdGlvbnMgY2FuIGJlIG1hZGUuCgoJCQkJdmFyIGssIHYsIHZhbHVlID0gaG9sZGVyW2tleV07CgkJCQlpZiAodmFsdWUgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JykgewoJCQkJCWZvciAoayBpbiB2YWx1ZSkgewoJCQkJCQlpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHZhbHVlLCBrKSkgewoJCQkJCQkJdiA9IHdhbGsodmFsdWUsIGspOwoJCQkJCQkJaWYgKHYgIT09IHVuZGVmaW5lZCkgewoJCQkJCQkJCXZhbHVlW2tdID0gdjsKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJZGVsZXRlIHZhbHVlW2tdOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQkJcmV0dXJuIHJldml2ZXIuY2FsbChob2xkZXIsIGtleSwgdmFsdWUpOwoJCQl9CgoKLy8gUGFyc2luZyBoYXBwZW5zIGluIGZvdXIgc3RhZ2VzLiBJbiB0aGUgZmlyc3Qgc3RhZ2UsIHdlIHJlcGxhY2UgY2VydGFpbgovLyBVbmljb2RlIGNoYXJhY3RlcnMgd2l0aCBlc2NhcGUgc2VxdWVuY2VzLiBKYXZhU2NyaXB0IGhhbmRsZXMgbWFueSBjaGFyYWN0ZXJzCi8vIGluY29ycmVjdGx5LCBlaXRoZXIgc2lsZW50bHkgZGVsZXRpbmcgdGhlbSwgb3IgdHJlYXRpbmcgdGhlbSBhcyBsaW5lIGVuZGluZ3MuCgoJCQl0ZXh0ID0gU3RyaW5nKHRleHQpOwoJCQljeC5sYXN0SW5kZXggPSAwOwoJCQlpZiAoY3gudGVzdCh0ZXh0KSkgewoJCQkJdGV4dCA9IHRleHQucmVwbGFjZShjeCwgZnVuY3Rpb24gKGEpIHsKCQkJCQlyZXR1cm4gJ1xcdScgKwoJCQkJCQkJKCcwMDAwJyArIGEuY2hhckNvZGVBdCgwKS50b1N0cmluZygxNikpLnNsaWNlKC00KTsKCQkJCX0pOwoJCQl9CgovLyBJbiB0aGUgc2Vjb25kIHN0YWdlLCB3ZSBydW4gdGhlIHRleHQgYWdhaW5zdCByZWd1bGFyIGV4cHJlc3Npb25zIHRoYXQgbG9vawovLyBmb3Igbm9uLUpTT04gcGF0dGVybnMuIFdlIGFyZSBlc3BlY2lhbGx5IGNvbmNlcm5lZCB3aXRoICcoKScgYW5kICduZXcnCi8vIGJlY2F1c2UgdGhleSBjYW4gY2F1c2UgaW52b2NhdGlvbiwgYW5kICc9JyBiZWNhdXNlIGl0IGNhbiBjYXVzZSBtdXRhdGlvbi4KLy8gQnV0IGp1c3QgdG8gYmUgc2FmZSwgd2Ugd2FudCB0byByZWplY3QgYWxsIHVuZXhwZWN0ZWQgZm9ybXMuCgovLyBXZSBzcGxpdCB0aGUgc2Vjb25kIHN0YWdlIGludG8gNCByZWdleHAgb3BlcmF0aW9ucyBpbiBvcmRlciB0byB3b3JrIGFyb3VuZAovLyBjcmlwcGxpbmcgaW5lZmZpY2llbmNpZXMgaW4gSUUncyBhbmQgU2FmYXJpJ3MgcmVnZXhwIGVuZ2luZXMuIEZpcnN0IHdlCi8vIHJlcGxhY2UgdGhlIEpTT04gYmFja3NsYXNoIHBhaXJzIHdpdGggJ0AnIChhIG5vbi1KU09OIGNoYXJhY3RlcikuIFNlY29uZCwgd2UKLy8gcmVwbGFjZSBhbGwgc2ltcGxlIHZhbHVlIHRva2VucyB3aXRoICddJyBjaGFyYWN0ZXJzLiBUaGlyZCwgd2UgZGVsZXRlIGFsbAovLyBvcGVuIGJyYWNrZXRzIHRoYXQgZm9sbG93IGEgY29sb24gb3IgY29tbWEgb3IgdGhhdCBiZWdpbiB0aGUgdGV4dC4gRmluYWxseSwKLy8gd2UgbG9vayB0byBzZWUgdGhhdCB0aGUgcmVtYWluaW5nIGNoYXJhY3RlcnMgYXJlIG9ubHkgd2hpdGVzcGFjZSBvciAnXScgb3IKLy8gJywnIG9yICc6JyBvciAneycgb3IgJ30nLiBJZiB0aGF0IGlzIHNvLCB0aGVuIHRoZSB0ZXh0IGlzIHNhZmUgZm9yIGV2YWwuCgoJCQlpZiAoL15bXF0sOnt9XHNdKiQvCgkJCQkJLnRlc3QodGV4dC5yZXBsYWNlKC9cXCg/OlsiXFxcL2JmbnJ0XXx1WzAtOWEtZkEtRl17NH0pL2csICdAJykKCQkJCQkJCQkgIC5yZXBsYWNlKC8iW14iXFxcblxyXSoifHRydWV8ZmFsc2V8bnVsbHwtP1xkKyg/OlwuXGQqKT8oPzpbZUVdWytcLV0/XGQrKT8vZywgJ10nKQoJCQkJCQkJCSAgLnJlcGxhY2UoLyg/Ol58OnwsKSg/OlxzKlxbKSsvZywgJycpKSkgewoKLy8gSW4gdGhlIHRoaXJkIHN0YWdlIHdlIHVzZSB0aGUgZXZhbCBmdW5jdGlvbiB0byBjb21waWxlIHRoZSB0ZXh0IGludG8gYQovLyBKYXZhU2NyaXB0IHN0cnVjdHVyZS4gVGhlICd7JyBvcGVyYXRvciBpcyBzdWJqZWN0IHRvIGEgc3ludGFjdGljIGFtYmlndWl0eQovLyBpbiBKYXZhU2NyaXB0OiBpdCBjYW4gYmVnaW4gYSBibG9jayBvciBhbiBvYmplY3QgbGl0ZXJhbC4gV2Ugd3JhcCB0aGUgdGV4dAovLyBpbiBwYXJlbnMgdG8gZWxpbWluYXRlIHRoZSBhbWJpZ3VpdHkuCgoJCQkJaiA9IGV2YWwoJygnICsgdGV4dCArICcpJyk7CgovLyBJbiB0aGUgb3B0aW9uYWwgZm91cnRoIHN0YWdlLCB3ZSByZWN1cnNpdmVseSB3YWxrIHRoZSBuZXcgc3RydWN0dXJlLCBwYXNzaW5nCi8vIGVhY2ggbmFtZS92YWx1ZSBwYWlyIHRvIGEgcmV2aXZlciBmdW5jdGlvbiBmb3IgcG9zc2libGUgdHJhbnNmb3JtYXRpb24uCgoJCQkJcmV0dXJuIHR5cGVvZiByZXZpdmVyID09PSAnZnVuY3Rpb24nCgkJCQkJCT8gd2Fsayh7Jyc6an0sICcnKQoJCQkJCQk6IGo7CgkJCX0KCi8vIElmIHRoZSB0ZXh0IGlzIG5vdCBKU09OIHBhcnNlYWJsZSwgdGhlbiBhIFN5bnRheEVycm9yIGlzIHRocm93bi4KCgkJCXRocm93IG5ldyBTeW50YXhFcnJvcignSlNPTi5wYXJzZScpOwoJCX07Cgl9Cn0oKSk7Cg==",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Thu, 06 Nov 2014 19:36:54 GMT",
                    "Content-Length": "155248",
                    "Date": "Thu, 06 Nov 2014 19:36:55 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}