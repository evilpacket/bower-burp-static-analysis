{
    "url": "http://localhost:9999/lbovet/docson/docson.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Open redirection (DOM-based)",
    "issueType": 5243152,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based open redirection vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the target of a redirection in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause a redirection to an arbitrary external domain. This behavior can be leveraged to facilitate phishing attacks against users of the application. The ability to use an authentic application URL, targeting the correct domain with a valid SSL certificate (if SSL is used) lends credibility to the phishing attack because many users, even if they verify these features, will not notice the subsequent redirection to a different domain.<br><br><b>Note:</b> If an attacker is able to control the start of the string that is passed to the redirection API, then it may be possible to escalate this vulnerability into a JavaScript injection attack, by using a URL with the javascript: pseudo-protocol to execute arbitrary script code when the URL is processed by the browser.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based open redirection vulnerabilities is not to dynamically set redirection targets using data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing an arbitrary URL as a redirection target. In general, this is best achieved by using a whitelist of URLs that are permitted redirection targets, and strictly validating the target against this list before performing the redirection.",
    "issueDetail": "The application may be vulnerable to DOM-based open redirection. Data is read from <b>window.location.href</b> and written to <b>window.open()</b> via the following statements:<ul><li>var url = window.location.href+\"$$expand\";</li><li>url = url.replace(/(docson\\/index.html#[^\\$]*).*/, \"$1$\"+ref+\"$$expand\");</li><li>w = window.open(url, \"_blank\");</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/lbovet/docson/docson.js",
                "path": "/lbovet/docson/docson.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9sYm92ZXQvZG9jc29uL2RvY3Nvbi5qcyBIVFRQLzEuMQ0KSG9zdDogbG9jYWxob3N0Ojk5OTkNCg0K",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMTY3OTMNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IFRodSwgMDYgTm92IDIwMTQgMjE6NDk6MjIgR01UDQpMYXN0LU1vZGlmaWVkOiBUaHUsIDA2IE5vdiAyMDE0IDIxOjQ5OjIyIEdNVA0KDQovKgogKiBDb3B5cmlnaHQgMjAxMyBMYXVyZW50IEJvdmV0IDxsYXVyZW50LmJvdmV0QHdpbmRtYXN0ZXIuY2g+CiAqCiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwogKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KCnZhciBkb2Nzb24gPSBkb2Nzb24gfHwge307Cgpkb2Nzb24udGVtcGxhdGVCYXNlVXJsPSJ0ZW1wbGF0ZXMiOwoKZGVmaW5lKFsibGliL2pxdWVyeSIsICJsaWIvaGFuZGxlYmFycyIsICJsaWIvaGlnaGxpZ2h0IiwgImxpYi9qc29ucG9pbnRlciIsICJsaWIvbWFya2VkIiwgImxpYi90cmF2ZXJzZSJdLCBmdW5jdGlvbihqcXVlcnksIGhhbmRsZWJhcnMsIGhpZ2hsaWdodCwganNvbnBvaW50ZXIsIG1hcmtlZCkgewoKICAgIHZhciByZWFkeSA9ICQuRGVmZXJyZWQoKTsKICAgIHZhciBib3hUZW1wbGF0ZTsKICAgIHZhciBzaWduYXR1cmVUZW1wbGF0ZTsKICAgIHZhciBzb3VyY2U7CiAgICB2YXIgc3RhY2sgPSBbXTsKICAgIHZhciBib3hlcz1bXTsKCiAgICBIYW5kbGViYXJzLnJlZ2lzdGVySGVscGVyKCdzY29wZScsIGZ1bmN0aW9uKHNjaGVtYSwgb3B0aW9ucykgewogICAgICAgIHZhciByZXN1bHQ7CiAgICAgICAgYm94ZXMucHVzaChbXSk7CiAgICAgICAgaWYoc2NoZW1hICYmIChzY2hlbWEuaWQgfHwgc2NoZW1hLnJvb3QpKSB7CiAgICAgICAgICAgIHN0YWNrLnB1c2goIHNjaGVtYSApOwogICAgICAgICAgICByZXN1bHQgPSBvcHRpb25zLmZuKHRoaXMpOwogICAgICAgICAgICBzdGFjay5wb3AoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXN1bHQgPSBvcHRpb25zLmZuKHRoaXMpOwogICAgICAgIH0KICAgICAgICBib3hlcy5wb3AoKTsKICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgfSk7CgogICAgSGFuZGxlYmFycy5yZWdpc3RlckhlbHBlcignc291cmNlJywgZnVuY3Rpb24oc2NoZW1hKSB7CiAgICAgICAgZGVsZXRlIHNjaGVtYS5yb290OwogICAgICAgIGRlbGV0ZSBzY2hlbWEuX19ib3hJZDsKICAgICAgICBkZWxldGUgc2NoZW1hLl9fbmFtZTsKICAgICAgICBkZWxldGUgc2NoZW1hLl9fcmVmOwogICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShzY2hlbWEsIG51bGwsIDIpOwogICAgfSk7CgogICAgSGFuZGxlYmFycy5yZWdpc3RlckhlbHBlcignZGVzYycsIGZ1bmN0aW9uKHNjaGVtYSkgewogICAgICAgIHZhciBkZXNjcmlwdGlvbiA9IHNjaGVtYS5kZXNjcmlwdGlvbjsKCiAgICAgICAgaWYoICFkZXNjcmlwdGlvbiApIHJldHVybiAiIjsKICAgICAgICB2YXIgdGV4dCA9IGRlc2NyaXB0aW9uOwogICAgICAgIGlmKG1hcmtlZCkgewogICAgICAgICAgICBtYXJrZWQuc2V0T3B0aW9ucyh7Z2ZtOiB0cnVlLCBicmVha3M6IHRydWV9KQogICAgICAgICAgICByZXR1cm4gbmV3IEhhbmRsZWJhcnMuU2FmZVN0cmluZyhtYXJrZWQodGV4dCkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiB0ZXh0OwogICAgICAgIH0KICAgIH0pOwoKICAgIEhhbmRsZWJhcnMucmVnaXN0ZXJIZWxwZXIoJ2VxdWFscycsIGZ1bmN0aW9uKGx2YWx1ZSwgcnZhbHVlLCBvcHRpb25zKSB7CiAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPCAzKQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkhhbmRsZWJhcnMgSGVscGVyIGVxdWFscyBuZWVkcyAyIHBhcmFtZXRlcnMiKTsKICAgICAgICBpZiggbHZhbHVlIT1ydmFsdWUgKSB7CiAgICAgICAgICAgIHJldHVybiBvcHRpb25zLmludmVyc2UodGhpcyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIG9wdGlvbnMuZm4odGhpcyk7CiAgICAgICAgfQogICAgfSk7CgogICAgSGFuZGxlYmFycy5yZWdpc3RlckhlbHBlcignY29udGFpbnMnLCBmdW5jdGlvbihhcnIsIGl0ZW0sIG9wdGlvbnMpIHs7CiAgICAgICAgaWYoYXJyICYmIGFyci5pbmRleE9mKGl0ZW0pICE9IC0xKSB7CiAgICAgICAgICAgIHJldHVybiBvcHRpb25zLmZuKHRoaXMpOwogICAgICAgIH0KICAgIH0pOwoKICAgIEhhbmRsZWJhcnMucmVnaXN0ZXJIZWxwZXIoJ3ByaW1pdGl2ZScsIGZ1bmN0aW9uKHNjaGVtYSwgb3B0aW9ucykgewogICAgICAgIGlmKHNjaGVtYS50eXBlICYmIHNjaGVtYS50eXBlICE9ICJvYmplY3QiICYmIHNjaGVtYS50eXBlICE9ICJhcnJheSIgfHwgc2NoZW1hLmVudW0pIHsKICAgICAgICAgICAgcmV0dXJuIHdpdGhUeXBlKHRoaXMsIG9wdGlvbnMsIHRydWUpCiAgICAgICAgfQogICAgfSk7CgogICAgSGFuZGxlYmFycy5yZWdpc3RlckhlbHBlcignZXhpc3RzJywgZnVuY3Rpb24odmFsdWUsIG9wdGlvbnMpIHsKICAgICAgICBpZih2YWx1ZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHZhbHVlID0gdmFsdWUgPT09IG51bGwgPyAibnVsbCI6IHZhbHVlOwogICAgICAgICAgICB2YWx1ZSA9IHZhbHVlID09PSB0cnVlID8gInRydWUiOiB2YWx1ZTsKICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZSA9PT0gZmFsc2UgPyAiZmFsc2UiOiB2YWx1ZTsKICAgICAgICAgICAgdmFsdWUgPSB0eXBlb2YgdmFsdWUgPT09ICJvYmplY3QiID8gSlNPTi5zdHJpbmdpZnkodmFsdWUpOiB2YWx1ZTsKICAgICAgICAgICAgdGhpcy5fX2RlZmF1bHQgPSB2YWx1ZTsKICAgICAgICAgICAgdmFyIHJlc3VsdCA9IG9wdGlvbnMuZm4odGhpcyk7CiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLl9fZGVmYXVsdDsKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CiAgICB9KTsKCiAgICBIYW5kbGViYXJzLnJlZ2lzdGVySGVscGVyKCdyYW5nZScsIGZ1bmN0aW9uKGZyb20sIHRvLCByZXBsRnJvbSwgcmVwbFRvLCBleGNsRnJvbSwgZXhjbFRvLCBzZXApIHsKICAgICAgICB2YXIgcmVzdWx0ID0gIiI7CiAgICAgICAgaWYoZnJvbSAhPT0gdW5kZWZpbmVkIHx8IHRvICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgcmVzdWx0ICs9IGV4Y2xGcm9tID8gIl0iIDogIlsiOwogICAgICAgICAgICByZXN1bHQgKz0gZnJvbSAhPT0gdW5kZWZpbmVkID8gZnJvbSA6IHJlcGxGcm9tOwogICAgICAgICAgICBpZiggKGZyb20gfHwgcmVwbEZyb20pICE9PSAodG8gfHwgcmVwbFRvKSkgewogICAgICAgICAgICAgICAgcmVzdWx0ICs9IChmcm9tICE9PSB1bmRlZmluZWQgfHwgcmVwbEZyb20gIT09IG51bGwpICYmICh0byAhPT0gdW5kZWZpbmVkIHx8IHJlcGxUbyAhPT0gbnVsbCkgPyBzZXAgOiAiIjsKICAgICAgICAgICAgICAgIHJlc3VsdCArPSB0byAhPT0gdW5kZWZpbmVkID8gdG8gOiByZXBsVG87CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmVzdWx0ICs9IGV4Y2xUbyA/ICJbIiA6ICJdIjsKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CiAgICB9KTsKCiAgICB2YXIgc3ViID0gZnVuY3Rpb24oc2NoZW1hKSB7CiAgICAgICAgcmV0dXJuIHNjaGVtYS50eXBlID09ICJhcnJheSIgfHwgc2NoZW1hLmFsbE9mIHx8IHNjaGVtYS5hbnlPZiB8fCBzY2hlbWEub25lT2YgfHwgc2NoZW1hLm5vdCB8fCBzY2hlbWEuYWRkaXRpb25hbFByb3BlcnRpZXM7CiAgICB9CgogICAgSGFuZGxlYmFycy5yZWdpc3RlckhlbHBlcignc3ViJywgZnVuY3Rpb24oc2NoZW1hLCBvcHRpb25zKSB7CiAgICAgICAgaWYoc3ViKHNjaGVtYSkgfHwgKHNjaGVtYS50eXBlICYmIHNjaGVtYS50eXBlICE9ICJvYmplY3QiICYmIHNjaGVtYS50eXBlICE9ICJhcnJheSIpIHx8IHNjaGVtYS5lbnVtKSB7CiAgICAgICAgICAgIHJldHVybiBvcHRpb25zLmZuKHRoaXMpOwogICAgICAgIH0KICAgIH0pOwoKICAgIEhhbmRsZWJhcnMucmVnaXN0ZXJIZWxwZXIoJ21haW4nLCBmdW5jdGlvbihzY2hlbWEsIG9wdGlvbnMpIHsKICAgICAgICBpZighc3ViKHNjaGVtYSkpIHsKICAgICAgICAgICAgcmV0dXJuIG9wdGlvbnMuZm4odGhpcyk7CiAgICAgICAgfQogICAgfSk7CgogICAgdmFyIHNpbXBsZVNjaGVtYSA9IGZ1bmN0aW9uKHNjaGVtYSkgewogICAgICAgIHZhciByZXN1bHQgPSBzY2hlbWEuZGVzY3JpcHRpb249PT11bmRlZmluZWQgJiYgc2NoZW1hLnRpdGxlPT09dW5kZWZpbmVkICYmIHNjaGVtYS5pZD09PXVuZGVmaW5lZDsKICAgICAgICByZXN1bHQgJj0gc2NoZW1hLnByb3BlcnRpZXM9PT11bmRlZmluZWQ7CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH07CgogICAgSGFuZGxlYmFycy5yZWdpc3RlckhlbHBlcignc2ltcGxlJywgZnVuY3Rpb24oc2NoZW1hLCBvcHRpb25zKSB7CiAgICAgICAgaWYoc2ltcGxlU2NoZW1hKHNjaGVtYSkgJiYgIXNjaGVtYS4kcmVmKSB7CiAgICAgICAgICAgIHJldHVybiB3aXRoVHlwZShzY2hlbWEsIG9wdGlvbnMsIHRydWUpOwogICAgICAgIH0KICAgIH0pOwoKICAgIHZhciB3aXRoVHlwZSA9IGZ1bmN0aW9uKHNjaGVtYSwgb3B0aW9ucywgaGlkZUFueSkgewogICAgICAgIHNjaGVtYS5fX3R5cGUgPSBzY2hlbWEudHlwZTsKICAgICAgICBpZighc2NoZW1hLnR5cGUgJiYgIWhpZGVBbnkpIHsKICAgICAgICAgICAgc2NoZW1hLl9fdHlwZT0iYW55IjsKICAgICAgICB9CiAgICAgICAgaWYoc2NoZW1hLmZvcm1hdCkgewogICAgICAgICAgICBzY2hlbWEuX190eXBlPXNjaGVtYS5mb3JtYXQ7CiAgICAgICAgfQogICAgICAgIGlmKCAoc2NoZW1hLl9fdHlwZSA9PSAiYW55IiB8fCBzY2hlbWEuX190eXBlID09ICJvYmplY3QiKSAmJiBzY2hlbWEudGl0bGUpIHsKICAgICAgICAgICAgc2NoZW1hLl9fdHlwZSA9IHNjaGVtYS50aXRsZTsKICAgICAgICB9CiAgICAgICAgdmFyIHJlc3VsdCA9IG9wdGlvbnMuZm4oc2NoZW1hKTsKICAgICAgICBkZWxldGUgc2NoZW1hLl9fdHlwZTsKICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgfQoKICAgIEhhbmRsZWJhcnMucmVnaXN0ZXJIZWxwZXIoJ2NvbXBsZXgnLCBmdW5jdGlvbihzY2hlbWEsIG9wdGlvbnMpIHsKICAgICAgICBpZighc2ltcGxlU2NoZW1hKHNjaGVtYSkgJiYgIXNjaGVtYS4kcmVmIHx8IHNjaGVtYS5wcm9wZXJ0aWVzKSB7CiAgICAgICAgICAgIHJldHVybiB3aXRoVHlwZShzY2hlbWEsIG9wdGlvbnMpOwogICAgICAgIH0KICAgIH0pOwoKICAgIEhhbmRsZWJhcnMucmVnaXN0ZXJIZWxwZXIoJ2VudW0nLCBmdW5jdGlvbihzY2hlbWEpIHsKICAgICAgICBpZihzY2hlbWEuZW51bSkgewogICAgICAgICAgICByZXR1cm4gKHNjaGVtYS5lbnVtLmxlbmd0aCA+IDEpID8gImVudW0iOiAiY29uc3RhbnQiOwogICAgICAgIH0KICAgIH0pOwoKICAgIEhhbmRsZWJhcnMucmVnaXN0ZXJIZWxwZXIoJ29iaicsIGZ1bmN0aW9uKHNjaGVtYSwgb3B0aW9ucykgewogICAgICAgIGlmKHNjaGVtYS5wcm9wZXJ0aWVzIHx8IHNjaGVtYS50eXBlID09ICJvYmplY3QiKSB7CiAgICAgICAgICAgIHJldHVybiB3aXRoVHlwZShzY2hlbWEsIG9wdGlvbnMpOwogICAgICAgIH0KICAgIH0pOwoKICAgIHZhciBwdXNoQm94ID0gZnVuY3Rpb24oc2NoZW1hKSB7CiAgICAgICAgYm94ZXNbYm94ZXMubGVuZ3RoLTFdLnB1c2goc2NoZW1hKTsKICAgIH0KCiAgICBIYW5kbGViYXJzLnJlZ2lzdGVySGVscGVyKCdib3gnLCBmdW5jdGlvbihzY2hlbWEsIG9wdGlvbnMpIHsKICAgICAgICBpZihzY2hlbWEpIHsKICAgICAgICAgICAgcHVzaEJveChzY2hlbWEpOwogICAgICAgICAgICByZXR1cm4gb3B0aW9ucy5mbihzY2hlbWEpOwogICAgICAgIH0KICAgIH0pOwoKICAgIEhhbmRsZWJhcnMucmVnaXN0ZXJIZWxwZXIoJ2JveElkJywgZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIGJveGVzW2JveGVzLmxlbmd0aC0xXS5sZW5ndGgKICAgIH0pOwoKICAgIEhhbmRsZWJhcnMucmVnaXN0ZXJIZWxwZXIoJ2JveGVzJywgZnVuY3Rpb24ob3B0aW9ucykgewogICAgICAgIHZhciByZXN1bHQ9IiI7CiAgICAgICAgJC5lYWNoKGJveGVzW2JveGVzLmxlbmd0aC0xXSwgZnVuY3Rpb24oaywgYm94KSB7CiAgICAgICAgICAgIGJveC5fX2JveElkID0gaysxOwogICAgICAgICAgICByZXN1bHQ9cmVzdWx0K29wdGlvbnMuZm4oYm94KTsKICAgICAgICB9KTsKICAgICAgICBib3hlc1tib3hlcy5sZW5ndGgtMV0gPSBbXQogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9KTsKCiAgICB2YXIgcmVzb2x2ZUlkUmVmID0gZnVuY3Rpb24ocmVmKSB7CiAgICAgICAgaWYoc3RhY2spIHsKICAgICAgICAgICAgdmFyIGk7CiAgICAgICAgICAgIGZvcihpPXN0YWNrLmxlbmd0aC0xOyBpPj0wOyBpLS0pIHsKICAgICAgICAgICAgICAgIGlmKHN0YWNrW2ldW3JlZl0pIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3RhY2tbaV1bcmVmXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICB2YXIgcmVzb2x2ZVBvaW50ZXJSZWYgPSBmdW5jdGlvbihyZWYpIHsKICAgICAgICB2YXIgcm9vdCA9IHN0YWNrWzFdOwogICAgICAgIGlmKHJlZj09IiMiKSB7CiAgICAgICAgICAgIHJldHVybiByb290OwogICAgICAgIH0KICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4ganNvbnBvaW50ZXIuZ2V0KHN0YWNrWzFdLCByZWYpOwogICAgICAgIH0gY2F0Y2goZSkgewogICAgICAgICAgICBjb25zb2xlLmxvZyhlKTsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgfQoKICAgIHZhciByZXNvbHZlUmVmID0gZnVuY3Rpb24ocmVmKSB7CiAgICAgICAgaWYocmVmLmluZGV4T2YoIiMiKSA9PSAwKSB7CiAgICAgICAgICAgIHJldHVybiByZXNvbHZlUG9pbnRlclJlZihyZWYpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiByZXNvbHZlSWRSZWYocmVmKTsKICAgICAgICB9CiAgICB9CgogICAgdmFyIGdldE5hbWUgPSBmdW5jdGlvbihzY2hlbWEpIHsKICAgICAgICBpZighc2NoZW1hKSB7CiAgICAgICAgICAgIHJldHVybiAiPGVycm9yPiI7CiAgICAgICAgfQogICAgICAgIHZhciBuYW1lID0gc2NoZW1hLnRpdGxlOwogICAgICAgIG5hbWUgPSAhbmFtZSAmJiBzY2hlbWEuaWQgPyBzY2hlbWEuaWQ6IG5hbWU7CiAgICAgICAgbmFtZSA9ICFuYW1lID8gc2NoZW1hLl9fbmFtZTogbmFtZTsKICAgICAgICByZXR1cm4gbmFtZTsKICAgIH0KCiAgICBIYW5kbGViYXJzLnJlZ2lzdGVySGVscGVyKCduYW1lJywgZnVuY3Rpb24oc2NoZW1hLCBvcHRpb25zKSB7CiAgICAgICAgc2NoZW1hLl9fbmFtZSA9IGdldE5hbWUoc2NoZW1hKTsKICAgICAgICBpZihzY2hlbWEuX19uYW1lKSB7CiAgICAgICAgICAgIHJldHVybiBvcHRpb25zLmZuKHNjaGVtYSk7CiAgICAgICAgfQogICAgfSk7CgogICAgdmFyIHJlZk5hbWUgPSBmdW5jdGlvbihyZWYpIHsKICAgICAgICB2YXIgbmFtZSA9IGdldE5hbWUocmVzb2x2ZVJlZihyZWYpKTsKICAgICAgICBpZighbmFtZSkgewogICAgICAgICAgICBpZihyZWYgPT0gIiMiKSB7CiAgICAgICAgICAgICAgICBuYW1lID0gIjxyb290PiI7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBuYW1lID0gcmVmLnJlcGxhY2UoIiMiLCAiLyIpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdmFyIHNlZ21lbnRzID0gbmFtZS5zcGxpdCgiLyIpOwogICAgICAgIG5hbWUgPSBzZWdtZW50c1tzZWdtZW50cy5sZW5ndGgtMV07CiAgICAgICAgcmV0dXJuIG5hbWU7CiAgICB9CgogICAgZnVuY3Rpb24gcmVuZGVyU2NoZW1hKHNjaGVtYSkgewogICAgICAgIGlmKHN0YWNrLmluZGV4T2Yoc2NoZW1hKSA9PSAtMSkgeyAvLyBhdm9pZCByZWN1cnNpb24KICAgICAgICAgICAgcmV0dXJuIG5ldyBIYW5kbGViYXJzLlNhZmVTdHJpbmcoYm94VGVtcGxhdGUoc2NoZW1hKSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBIYW5kbGViYXJzLlNhZmVTdHJpbmcoYm94VGVtcGxhdGUoeyJkZXNjcmlwdGlvbiI6ICJfY2lyY3VsYXIgcmVmZXJlbmNlXyJ9KSk7CiAgICAgICAgfQogICAgfQoKICAgIEhhbmRsZWJhcnMucmVnaXN0ZXJIZWxwZXIoJ3JlZicsIGZ1bmN0aW9uKHNjaGVtYSwgb3B0aW9ucykgewogICAgICAgIGlmKHNjaGVtYS4kcmVmKSB7CiAgICAgICAgICAgIHZhciB0YXJnZXQgPSByZXNvbHZlUmVmKHNjaGVtYS4kcmVmKTsKICAgICAgICAgICAgaWYodGFyZ2V0KSB7CiAgICAgICAgICAgICAgICB0YXJnZXQuX19uYW1lID0gcmVmTmFtZShzY2hlbWEuJHJlZik7CiAgICAgICAgICAgICAgICB0YXJnZXQuX19yZWYgPSBzY2hlbWEuJHJlZi5yZXBsYWNlKCIjIiwgIiIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciByZXN1bHQ7CiAgICAgICAgICAgIGlmKHRhcmdldCkgewogICAgICAgICAgICAgICAgcmVzdWx0ID0gb3B0aW9ucy5mbih0YXJnZXQpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmVzdWx0ID0gbmV3IEhhbmRsZWJhcnMuU2FmZVN0cmluZygiPHNwYW4gY2xhc3M9J3NpZ25hdHVyZS10eXBlLXJlZic+IitzY2hlbWEuJHJlZisiPC9zcGFuPiIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKHRhcmdldCkgewogICAgICAgICAgICAgICAgZGVsZXRlIHRhcmdldC5fX3JlZjsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0KICAgIH0pOwoKICAgIEhhbmRsZWJhcnMucmVnaXN0ZXJIZWxwZXIoJ3NjaGVtYScsIGZ1bmN0aW9uKHNjaGVtYSkgewogICAgICAgIHJldHVybiByZW5kZXJTY2hlbWEoc2NoZW1hKTsKICAgIH0pOwoKICAgIEhhbmRsZWJhcnMucmVnaXN0ZXJIZWxwZXIoJ3NpZ25hdHVyZScsIGZ1bmN0aW9uKHNjaGVtYSwga2V5d29yZCwgc2NoZW1hcykgewogICAgICAgIGlmKCFzY2hlbWFzKSB7CiAgICAgICAgICAgIHNjaGVtYXMgPSBbXQogICAgICAgIH0KICAgICAgICBzY2hlbWFzID0gc2NoZW1hcyBpbnN0YW5jZW9mIEFycmF5ID8gc2NoZW1hcyA6IFtzY2hlbWFzXTsKICAgICAgICByZXR1cm4gbmV3IEhhbmRsZWJhcnMuU2FmZVN0cmluZyhzaWduYXR1cmVUZW1wbGF0ZSh7IHNjaGVtYTogc2NoZW1hLCBrZXl3b3JkOiBrZXl3b3JkLCBzY2hlbWFzOiBzY2hlbWFzfSkpOwogICAgfSk7CgogICAgSGFuZGxlYmFycy5yZWdpc3RlckhlbHBlcignbCcsIGZ1bmN0aW9uKGNvbnRleHQpIHsKICAgICAgICBjb25zb2xlLmxvZyhjb250ZXh0KTsKICAgIH0pOwoKICAgIGZ1bmN0aW9uIGluaXQoKSB7CiAgICAgICAgJC53aGVuKCAkLmdldChkb2Nzb24udGVtcGxhdGVCYXNlVXJsKyIvYm94Lmh0bWwiKS5kb25lKGZ1bmN0aW9uKGNvbnRlbnQpIHsKICAgICAgICAgICAgc291cmNlID0gY29udGVudAogICAgICAgICAgICBib3hUZW1wbGF0ZSA9IEhhbmRsZWJhcnMuY29tcGlsZShzb3VyY2UpOwogICAgICAgIH0pLCAkLmdldChkb2Nzb24udGVtcGxhdGVCYXNlVXJsKyIvc2lnbmF0dXJlLmh0bWwiKS5kb25lKGZ1bmN0aW9uKGNvbnRlbnQpIHsKICAgICAgICAgICAgc291cmNlID0gY29udGVudAogICAgICAgICAgICBzaWduYXR1cmVUZW1wbGF0ZSA9IEhhbmRsZWJhcnMuY29tcGlsZShzb3VyY2UpOwogICAgICAgIH0pKS5hbHdheXMoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJlYWR5LnJlc29sdmUoKTsKICAgICAgICB9KTsKICAgIH07CgogICAgZG9jc29uLmRvYyA9IGZ1bmN0aW9uKGVsZW1lbnQsIHNjaGVtYSwgcmVmKSB7CiAgICAgICAgdmFyIGQgPSAkLkRlZmVycmVkKCk7CiAgICAgICAgaW5pdCgpOwogICAgICAgIHJlYWR5LmRvbmUoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGlmKHR5cGVvZiBlbGVtZW50ID09ICJzdHJpbmciKSB7CiAgICAgICAgICAgICAgICBlbGVtZW50ID0gJCgiIyIrZWxlbWVudCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYodHlwZW9mIHNjaGVtYSA9PSAic3RyaW5nIikgewogICAgICAgICAgICAgICAgc2NoZW1hID0gSlNPTi5wYXJzZShzY2hlbWEpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgcmVmc1Byb21pc2UgPSAkLkRlZmVycmVkKCkucmVzb2x2ZSgpLnByb21pc2UoKTsKICAgICAgICAgICAgdmFyIHJlZnMgPSB7fTsKCiAgICAgICAgICAgIHRyYXZlcnNlKHNjaGVtYSkuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7CiAgICAgICAgICAgICAgICAvLyBGaXggU3dhZ2dlciB3ZWlyZCBnZW5lcmF0aW9uIGZvciBhcnJheS4KICAgICAgICAgICAgICAgIGlmKGl0ZW0gJiYgaXRlbS4kcmVmID09ICJhcnJheSIpIHsKICAgICAgICAgICAgICAgICAgICBkZWxldGUgaXRlbS4kcmVmOwogICAgICAgICAgICAgICAgICAgIGl0ZW0udHlwZSA9ImFycmF5IjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBGZXRjaCBleHRlcm5hbCBzY2hlbWEKICAgICAgICAgICAgICAgIGlmKHRoaXMua2V5ID09PSAiJHJlZiIpIHsKICAgICAgICAgICAgICAgICAgICBpZigoL15odHRwcz86XC9cLy8pLnRlc3QoaXRlbSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNlZ21lbnRzID0gaXRlbS5zcGxpdCgiIyIpOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgcCA9ICQuZ2V0KHNlZ21lbnRzWzBdKS50aGVuKGZ1bmN0aW9uKGNvbnRlbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHR5cGVvZiBjb250ZW50ICE9ICJvYmplY3QiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudCA9IEpTT04ucGFyc2UoY29udGVudCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaChlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIlVuYWJsZSB0byBwYXJzZSAiK3NlZ21lbnRzWzBdLCBlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihjb250ZW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmc1tpdGVtXSA9IGNvbnRlbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICByZWZzUHJvbWlzZSA9IHAudGhlbihyZWZzUHJvbWlzZSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgcmVmc1Byb21pc2UuZG9uZShmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHN0YWNrLnB1c2gocmVmcyk7CiAgICAgICAgICAgICAgICB2YXIgdGFyZ2V0ID0gc2NoZW1hOwogICAgICAgICAgICAgICAgaWYocmVmKSB7CiAgICAgICAgICAgICAgICAgICAgcmVmID0gcmVmWzBdICE9PSAnLycgPyAnLycrcmVmIDogcmVmOwogICAgICAgICAgICAgICAgICAgIHRhcmdldCA9IGpzb25wb2ludGVyLmdldChzY2hlbWEsIHJlZik7CiAgICAgICAgICAgICAgICAgICAgc3RhY2sucHVzaCggc2NoZW1hICk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGFyZ2V0LnJvb3QgPSB0cnVlOwogICAgICAgICAgICAgICAgdGFyZ2V0Ll9fcmVmID0gIjxyb290PiI7CiAgICAgICAgICAgICAgICB2YXIgaHRtbCA9IGJveFRlbXBsYXRlKHRhcmdldCk7CgogICAgICAgICAgICAgICAgaWYocmVmKSB7CiAgICAgICAgICAgICAgICAgICAgc3RhY2sucG9wKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzdGFjay5wb3AoKTsKCiAgICAgICAgICAgICAgICBlbGVtZW50LmFkZENsYXNzKCJkb2Nzb24iKS5odG1sKGh0bWwpOwoKICAgICAgICAgICAgICAgIHZhciByZXNpemVIYW5kbGVyID0gZWxlbWVudC5nZXQoMCkub25yZXNpemU7CiAgICAgICAgICAgICAgICBmdW5jdGlvbiByZXNpemVkKCkgewogICAgICAgICAgICAgICAgICAgIGlmKHJlc2l6ZUhhbmRsZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGJveCA9IGVsZW1lbnQuZmluZCgiLmJveCIpLmZpcnN0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuZ2V0KDApLm9ucmVzaXplKGJveC5vdXRlcldpZHRoKCksIGJveC5vdXRlckhlaWdodCgpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbGVtZW50LmdldCgwKS5yZXNpemVkID0gcmVzaXplZDsKICAgICAgICAgICAgICAgIHJlc2l6ZWQoKTsKCiAgICAgICAgICAgICAgICBpZihoaWdobGlnaHQpIHsKICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmZpbmQoIi5qc29uLXNjaGVtYSIpLmVhY2goZnVuY3Rpb24oaywgc2NoZW1hRWxlbWVudCkgewogICAgICAgICAgICAgICAgICAgICAgICBoaWdobGlnaHQuaGlnaGxpZ2h0U2NoZW1hKHNjaGVtYUVsZW1lbnQpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxlbWVudC5maW5kKCIuYm94LXRpdGxlIikuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgIHZhciByZWYgPSAkKHRoaXMpLmF0dHIoInJlZiIpOwogICAgICAgICAgICAgICAgICAgaWYocmVmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgaWYod2luZG93LmxvY2F0aW9uLmhyZWYuaW5kZXhPZigiZG9jc29uL2luZGV4Lmh0bWwiKSA+IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykuZmluZCgiLmJveC1uYW1lIikuY3NzKCJjdXJzb3IiLCAicG9pbnRlciIpLmF0dHIoInRpdGxlIiwgIk9wZW4gaW4gbmV3IHdpbmRvdyIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgIC5ob3ZlcigKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKCl7ICQodGhpcykuYWRkQ2xhc3MoJ2xpbmsnKSB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oKXsgJCh0aGlzKS5yZW1vdmVDbGFzcygnbGluaycpIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jbGljayhmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdXJsID0gd2luZG93LmxvY2F0aW9uLmhyZWYrIiQkZXhwYW5kIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihyZWYgIT09Ijxyb290PiIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwgPSB1cmwucmVwbGFjZSgvKGRvY3NvblwvaW5kZXguaHRtbCNbXlwkXSopLiovLCAiJDEkIityZWYrIiQkZXhwYW5kIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB3OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHJlY2VpdmVNZXNzYWdlKGV2ZW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50LmRhdGEuaWQgJiYgZXZlbnQuZGF0YS5pZCA9PSAiZG9jc29uIiAmJiBldmVudC5kYXRhLmFjdGlvbiA9PSAicmVhZHkiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHcucG9zdE1lc3NhZ2UoeyBpZDogImRvY3NvbiIsIGFjdGlvbjogImxvYWQiLCBkZWZpbml0aW9uczogc2NoZW1hLCB0eXBlOiBldmVudC5kYXRhLnVybC5zcGxpdCgiJCIpWzFdLCBleHBhbmQ6IHRydWV9LCAiKiIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLCByZWNlaXZlTWVzc2FnZSwgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHcgPSB3aW5kb3cub3Blbih1cmwsICJfYmxhbmsiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBlbGVtZW50LmZpbmQoIi5ib3giKS5tb3VzZWVudGVyKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICQodGhpcykuY2hpbGRyZW4oIi5zb3VyY2UtYnV0dG9uIikuZmFkZUluKDMwMCk7CiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5jaGlsZHJlbigiLmJveC1ib2R5IikuY2hpbGRyZW4oIi5leHBhbmQtYnV0dG9uIikuZmFkZUluKDMwMCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGVsZW1lbnQuZmluZCgiLmJveCIpLm1vdXNlbGVhdmUoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5jaGlsZHJlbigiLnNvdXJjZS1idXR0b24iKS5mYWRlT3V0KDMwMCk7CiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5jaGlsZHJlbigiLmJveC1ib2R5IikuY2hpbGRyZW4oIi5leHBhbmQtYnV0dG9uIikuZmFkZU91dCgzMDApOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBlbGVtZW50LmZpbmQoIi5zaWduYXR1cmUtdHlwZS1leHBhbmRhYmxlIikuY2xpY2soZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGJveElkID0gJCh0aGlzKS5hdHRyKCJib3hpZCIpOwogICAgICAgICAgICAgICAgICAgICQodGhpcykudG9nZ2xlQ2xhc3MoInNpZ25hdHVyZS10eXBlLWV4cGFuZGVkIik7CiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5wYXJlbnQoKS5wYXJlbnQoKS5wYXJlbnQoKS5jaGlsZHJlbigiLnNpZ25hdHVyZS1ib3gtY29udGFpbmVyIikuCiAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkcmVuKCJbYm94aWQ9JyIrYm94SWQrIiddIikudG9nZ2xlKHJlc2l6ZUhhbmRsZXIgPyAwIDogMzAwKTsKICAgICAgICAgICAgICAgICAgICByZXNpemVkKCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGVsZW1lbnQuZmluZCgiLmV4cGFuZC1idXR0b24iKS5jbGljayhmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICBpZigkKHRoaXMpLmF0dHIoImV4cGFuZGVkIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5wYXJlbnQoKS5wYXJlbnQoKS5maW5kKCIuZXhwYW5kLWJ1dHRvbiIpLmh0bWwoIiArICIpLmF0dHIoInRpdGxlIiwgIkV4cGFuZCBhbGwiKTsKICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5wYXJlbnQoKS5wYXJlbnQoKS5maW5kKCIuc2lnbmF0dXJlLXR5cGUtZXhwYW5kYWJsZSIpLnJlbW92ZUNsYXNzKCJzaWduYXR1cmUtdHlwZS1leHBhbmRlZCIpOwogICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnBhcmVudCgpLnBhcmVudCgpLmZpbmQoIi5ib3gtY29udGFpbmVyIikuaGlkZSggcmVzaXplSGFuZGxlciA/IDAgOiAzMDApOwogICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnBhcmVudCgpLnBhcmVudCgpLmZpbmQoIi5leHBhbmQtYnV0dG9uIikucmVtb3ZlQXR0cigiZXhwYW5kZWQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmVzaXplZCgpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykucGFyZW50KCkucGFyZW50KCkuZmluZCgiLmV4cGFuZC1idXR0b24iKS5odG1sKCIgLSAiKS5hdHRyKCJ0aXRsZSIsICJDb2xsYXBzZSBhbGwiKTsKICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5wYXJlbnQoKS5wYXJlbnQoKS5maW5kKCIuc2lnbmF0dXJlLXR5cGUtZXhwYW5kYWJsZSIpLmFkZENsYXNzKCJzaWduYXR1cmUtdHlwZS1leHBhbmRlZCIpOwogICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnBhcmVudCgpLnBhcmVudCgpLmZpbmQoIi5ib3gtY29udGFpbmVyIikuc2hvdyhyZXNpemVIYW5kbGVyID8gMCA6IDMwMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykucGFyZW50KCkucGFyZW50KCkuZmluZCgiLmV4cGFuZC1idXR0b24iKS5hdHRyKCJleHBhbmRlZCIsIHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICByZXNpemVkKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBlbGVtZW50LmZpbmQoIi5zb3VyY2UtYnV0dG9uIikuY2xpY2soZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5wYXJlbnQoKS5jaGlsZHJlbigiLmJveC1ib2R5IikudG9nZ2xlKCk7CiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5wYXJlbnQoKS5jaGlsZHJlbigiLnNvdXJjZSIpLnRvZ2dsZSgpOwogICAgICAgICAgICAgICAgICAgIHJlc2l6ZWQoKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgZC5yZXNvbHZlKCk7CiAgICAgICAgfSkKICAgICAgICByZXR1cm4gZC5wcm9taXNlKCk7CiAgICB9CgogICAgcmV0dXJuIGRvY3NvbjsKfSk7Cg==",
                "body": "LyoKICogQ29weXJpZ2h0IDIwMTMgTGF1cmVudCBCb3ZldCA8bGF1cmVudC5ib3ZldEB3aW5kbWFzdGVyLmNoPgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAogKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAogKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KICovCgp2YXIgZG9jc29uID0gZG9jc29uIHx8IHt9OwoKZG9jc29uLnRlbXBsYXRlQmFzZVVybD0idGVtcGxhdGVzIjsKCmRlZmluZShbImxpYi9qcXVlcnkiLCAibGliL2hhbmRsZWJhcnMiLCAibGliL2hpZ2hsaWdodCIsICJsaWIvanNvbnBvaW50ZXIiLCAibGliL21hcmtlZCIsICJsaWIvdHJhdmVyc2UiXSwgZnVuY3Rpb24oanF1ZXJ5LCBoYW5kbGViYXJzLCBoaWdobGlnaHQsIGpzb25wb2ludGVyLCBtYXJrZWQpIHsKCiAgICB2YXIgcmVhZHkgPSAkLkRlZmVycmVkKCk7CiAgICB2YXIgYm94VGVtcGxhdGU7CiAgICB2YXIgc2lnbmF0dXJlVGVtcGxhdGU7CiAgICB2YXIgc291cmNlOwogICAgdmFyIHN0YWNrID0gW107CiAgICB2YXIgYm94ZXM9W107CgogICAgSGFuZGxlYmFycy5yZWdpc3RlckhlbHBlcignc2NvcGUnLCBmdW5jdGlvbihzY2hlbWEsIG9wdGlvbnMpIHsKICAgICAgICB2YXIgcmVzdWx0OwogICAgICAgIGJveGVzLnB1c2goW10pOwogICAgICAgIGlmKHNjaGVtYSAmJiAoc2NoZW1hLmlkIHx8IHNjaGVtYS5yb290KSkgewogICAgICAgICAgICBzdGFjay5wdXNoKCBzY2hlbWEgKTsKICAgICAgICAgICAgcmVzdWx0ID0gb3B0aW9ucy5mbih0aGlzKTsKICAgICAgICAgICAgc3RhY2sucG9wKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmVzdWx0ID0gb3B0aW9ucy5mbih0aGlzKTsKICAgICAgICB9CiAgICAgICAgYm94ZXMucG9wKCk7CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0pOwoKICAgIEhhbmRsZWJhcnMucmVnaXN0ZXJIZWxwZXIoJ3NvdXJjZScsIGZ1bmN0aW9uKHNjaGVtYSkgewogICAgICAgIGRlbGV0ZSBzY2hlbWEucm9vdDsKICAgICAgICBkZWxldGUgc2NoZW1hLl9fYm94SWQ7CiAgICAgICAgZGVsZXRlIHNjaGVtYS5fX25hbWU7CiAgICAgICAgZGVsZXRlIHNjaGVtYS5fX3JlZjsKICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoc2NoZW1hLCBudWxsLCAyKTsKICAgIH0pOwoKICAgIEhhbmRsZWJhcnMucmVnaXN0ZXJIZWxwZXIoJ2Rlc2MnLCBmdW5jdGlvbihzY2hlbWEpIHsKICAgICAgICB2YXIgZGVzY3JpcHRpb24gPSBzY2hlbWEuZGVzY3JpcHRpb247CgogICAgICAgIGlmKCAhZGVzY3JpcHRpb24gKSByZXR1cm4gIiI7CiAgICAgICAgdmFyIHRleHQgPSBkZXNjcmlwdGlvbjsKICAgICAgICBpZihtYXJrZWQpIHsKICAgICAgICAgICAgbWFya2VkLnNldE9wdGlvbnMoe2dmbTogdHJ1ZSwgYnJlYWtzOiB0cnVlfSkKICAgICAgICAgICAgcmV0dXJuIG5ldyBIYW5kbGViYXJzLlNhZmVTdHJpbmcobWFya2VkKHRleHQpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gdGV4dDsKICAgICAgICB9CiAgICB9KTsKCiAgICBIYW5kbGViYXJzLnJlZ2lzdGVySGVscGVyKCdlcXVhbHMnLCBmdW5jdGlvbihsdmFsdWUsIHJ2YWx1ZSwgb3B0aW9ucykgewogICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgMykKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJIYW5kbGViYXJzIEhlbHBlciBlcXVhbHMgbmVlZHMgMiBwYXJhbWV0ZXJzIik7CiAgICAgICAgaWYoIGx2YWx1ZSE9cnZhbHVlICkgewogICAgICAgICAgICByZXR1cm4gb3B0aW9ucy5pbnZlcnNlKHRoaXMpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBvcHRpb25zLmZuKHRoaXMpOwogICAgICAgIH0KICAgIH0pOwoKICAgIEhhbmRsZWJhcnMucmVnaXN0ZXJIZWxwZXIoJ2NvbnRhaW5zJywgZnVuY3Rpb24oYXJyLCBpdGVtLCBvcHRpb25zKSB7OwogICAgICAgIGlmKGFyciAmJiBhcnIuaW5kZXhPZihpdGVtKSAhPSAtMSkgewogICAgICAgICAgICByZXR1cm4gb3B0aW9ucy5mbih0aGlzKTsKICAgICAgICB9CiAgICB9KTsKCiAgICBIYW5kbGViYXJzLnJlZ2lzdGVySGVscGVyKCdwcmltaXRpdmUnLCBmdW5jdGlvbihzY2hlbWEsIG9wdGlvbnMpIHsKICAgICAgICBpZihzY2hlbWEudHlwZSAmJiBzY2hlbWEudHlwZSAhPSAib2JqZWN0IiAmJiBzY2hlbWEudHlwZSAhPSAiYXJyYXkiIHx8IHNjaGVtYS5lbnVtKSB7CiAgICAgICAgICAgIHJldHVybiB3aXRoVHlwZSh0aGlzLCBvcHRpb25zLCB0cnVlKQogICAgICAgIH0KICAgIH0pOwoKICAgIEhhbmRsZWJhcnMucmVnaXN0ZXJIZWxwZXIoJ2V4aXN0cycsIGZ1bmN0aW9uKHZhbHVlLCBvcHRpb25zKSB7CiAgICAgICAgaWYodmFsdWUgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICB2YWx1ZSA9IHZhbHVlID09PSBudWxsID8gIm51bGwiOiB2YWx1ZTsKICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZSA9PT0gdHJ1ZSA/ICJ0cnVlIjogdmFsdWU7CiAgICAgICAgICAgIHZhbHVlID0gdmFsdWUgPT09IGZhbHNlID8gImZhbHNlIjogdmFsdWU7CiAgICAgICAgICAgIHZhbHVlID0gdHlwZW9mIHZhbHVlID09PSAib2JqZWN0IiA/IEpTT04uc3RyaW5naWZ5KHZhbHVlKTogdmFsdWU7CiAgICAgICAgICAgIHRoaXMuX19kZWZhdWx0ID0gdmFsdWU7CiAgICAgICAgICAgIHZhciByZXN1bHQgPSBvcHRpb25zLmZuKHRoaXMpOwogICAgICAgICAgICBkZWxldGUgdGhpcy5fX2RlZmF1bHQ7CiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQogICAgfSk7CgogICAgSGFuZGxlYmFycy5yZWdpc3RlckhlbHBlcigncmFuZ2UnLCBmdW5jdGlvbihmcm9tLCB0bywgcmVwbEZyb20sIHJlcGxUbywgZXhjbEZyb20sIGV4Y2xUbywgc2VwKSB7CiAgICAgICAgdmFyIHJlc3VsdCA9ICIiOwogICAgICAgIGlmKGZyb20gIT09IHVuZGVmaW5lZCB8fCB0byAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHJlc3VsdCArPSBleGNsRnJvbSA/ICJdIiA6ICJbIjsKICAgICAgICAgICAgcmVzdWx0ICs9IGZyb20gIT09IHVuZGVmaW5lZCA/IGZyb20gOiByZXBsRnJvbTsKICAgICAgICAgICAgaWYoIChmcm9tIHx8IHJlcGxGcm9tKSAhPT0gKHRvIHx8IHJlcGxUbykpIHsKICAgICAgICAgICAgICAgIHJlc3VsdCArPSAoZnJvbSAhPT0gdW5kZWZpbmVkIHx8IHJlcGxGcm9tICE9PSBudWxsKSAmJiAodG8gIT09IHVuZGVmaW5lZCB8fCByZXBsVG8gIT09IG51bGwpID8gc2VwIDogIiI7CiAgICAgICAgICAgICAgICByZXN1bHQgKz0gdG8gIT09IHVuZGVmaW5lZCA/IHRvIDogcmVwbFRvOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJlc3VsdCArPSBleGNsVG8gPyAiWyIgOiAiXSI7CiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQogICAgfSk7CgogICAgdmFyIHN1YiA9IGZ1bmN0aW9uKHNjaGVtYSkgewogICAgICAgIHJldHVybiBzY2hlbWEudHlwZSA9PSAiYXJyYXkiIHx8IHNjaGVtYS5hbGxPZiB8fCBzY2hlbWEuYW55T2YgfHwgc2NoZW1hLm9uZU9mIHx8IHNjaGVtYS5ub3QgfHwgc2NoZW1hLmFkZGl0aW9uYWxQcm9wZXJ0aWVzOwogICAgfQoKICAgIEhhbmRsZWJhcnMucmVnaXN0ZXJIZWxwZXIoJ3N1YicsIGZ1bmN0aW9uKHNjaGVtYSwgb3B0aW9ucykgewogICAgICAgIGlmKHN1YihzY2hlbWEpIHx8IChzY2hlbWEudHlwZSAmJiBzY2hlbWEudHlwZSAhPSAib2JqZWN0IiAmJiBzY2hlbWEudHlwZSAhPSAiYXJyYXkiKSB8fCBzY2hlbWEuZW51bSkgewogICAgICAgICAgICByZXR1cm4gb3B0aW9ucy5mbih0aGlzKTsKICAgICAgICB9CiAgICB9KTsKCiAgICBIYW5kbGViYXJzLnJlZ2lzdGVySGVscGVyKCdtYWluJywgZnVuY3Rpb24oc2NoZW1hLCBvcHRpb25zKSB7CiAgICAgICAgaWYoIXN1YihzY2hlbWEpKSB7CiAgICAgICAgICAgIHJldHVybiBvcHRpb25zLmZuKHRoaXMpOwogICAgICAgIH0KICAgIH0pOwoKICAgIHZhciBzaW1wbGVTY2hlbWEgPSBmdW5jdGlvbihzY2hlbWEpIHsKICAgICAgICB2YXIgcmVzdWx0ID0gc2NoZW1hLmRlc2NyaXB0aW9uPT09dW5kZWZpbmVkICYmIHNjaGVtYS50aXRsZT09PXVuZGVmaW5lZCAmJiBzY2hlbWEuaWQ9PT11bmRlZmluZWQ7CiAgICAgICAgcmVzdWx0ICY9IHNjaGVtYS5wcm9wZXJ0aWVzPT09dW5kZWZpbmVkOwogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9OwoKICAgIEhhbmRsZWJhcnMucmVnaXN0ZXJIZWxwZXIoJ3NpbXBsZScsIGZ1bmN0aW9uKHNjaGVtYSwgb3B0aW9ucykgewogICAgICAgIGlmKHNpbXBsZVNjaGVtYShzY2hlbWEpICYmICFzY2hlbWEuJHJlZikgewogICAgICAgICAgICByZXR1cm4gd2l0aFR5cGUoc2NoZW1hLCBvcHRpb25zLCB0cnVlKTsKICAgICAgICB9CiAgICB9KTsKCiAgICB2YXIgd2l0aFR5cGUgPSBmdW5jdGlvbihzY2hlbWEsIG9wdGlvbnMsIGhpZGVBbnkpIHsKICAgICAgICBzY2hlbWEuX190eXBlID0gc2NoZW1hLnR5cGU7CiAgICAgICAgaWYoIXNjaGVtYS50eXBlICYmICFoaWRlQW55KSB7CiAgICAgICAgICAgIHNjaGVtYS5fX3R5cGU9ImFueSI7CiAgICAgICAgfQogICAgICAgIGlmKHNjaGVtYS5mb3JtYXQpIHsKICAgICAgICAgICAgc2NoZW1hLl9fdHlwZT1zY2hlbWEuZm9ybWF0OwogICAgICAgIH0KICAgICAgICBpZiggKHNjaGVtYS5fX3R5cGUgPT0gImFueSIgfHwgc2NoZW1hLl9fdHlwZSA9PSAib2JqZWN0IikgJiYgc2NoZW1hLnRpdGxlKSB7CiAgICAgICAgICAgIHNjaGVtYS5fX3R5cGUgPSBzY2hlbWEudGl0bGU7CiAgICAgICAgfQogICAgICAgIHZhciByZXN1bHQgPSBvcHRpb25zLmZuKHNjaGVtYSk7CiAgICAgICAgZGVsZXRlIHNjaGVtYS5fX3R5cGU7CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KCiAgICBIYW5kbGViYXJzLnJlZ2lzdGVySGVscGVyKCdjb21wbGV4JywgZnVuY3Rpb24oc2NoZW1hLCBvcHRpb25zKSB7CiAgICAgICAgaWYoIXNpbXBsZVNjaGVtYShzY2hlbWEpICYmICFzY2hlbWEuJHJlZiB8fCBzY2hlbWEucHJvcGVydGllcykgewogICAgICAgICAgICByZXR1cm4gd2l0aFR5cGUoc2NoZW1hLCBvcHRpb25zKTsKICAgICAgICB9CiAgICB9KTsKCiAgICBIYW5kbGViYXJzLnJlZ2lzdGVySGVscGVyKCdlbnVtJywgZnVuY3Rpb24oc2NoZW1hKSB7CiAgICAgICAgaWYoc2NoZW1hLmVudW0pIHsKICAgICAgICAgICAgcmV0dXJuIChzY2hlbWEuZW51bS5sZW5ndGggPiAxKSA/ICJlbnVtIjogImNvbnN0YW50IjsKICAgICAgICB9CiAgICB9KTsKCiAgICBIYW5kbGViYXJzLnJlZ2lzdGVySGVscGVyKCdvYmonLCBmdW5jdGlvbihzY2hlbWEsIG9wdGlvbnMpIHsKICAgICAgICBpZihzY2hlbWEucHJvcGVydGllcyB8fCBzY2hlbWEudHlwZSA9PSAib2JqZWN0IikgewogICAgICAgICAgICByZXR1cm4gd2l0aFR5cGUoc2NoZW1hLCBvcHRpb25zKTsKICAgICAgICB9CiAgICB9KTsKCiAgICB2YXIgcHVzaEJveCA9IGZ1bmN0aW9uKHNjaGVtYSkgewogICAgICAgIGJveGVzW2JveGVzLmxlbmd0aC0xXS5wdXNoKHNjaGVtYSk7CiAgICB9CgogICAgSGFuZGxlYmFycy5yZWdpc3RlckhlbHBlcignYm94JywgZnVuY3Rpb24oc2NoZW1hLCBvcHRpb25zKSB7CiAgICAgICAgaWYoc2NoZW1hKSB7CiAgICAgICAgICAgIHB1c2hCb3goc2NoZW1hKTsKICAgICAgICAgICAgcmV0dXJuIG9wdGlvbnMuZm4oc2NoZW1hKTsKICAgICAgICB9CiAgICB9KTsKCiAgICBIYW5kbGViYXJzLnJlZ2lzdGVySGVscGVyKCdib3hJZCcsIGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBib3hlc1tib3hlcy5sZW5ndGgtMV0ubGVuZ3RoCiAgICB9KTsKCiAgICBIYW5kbGViYXJzLnJlZ2lzdGVySGVscGVyKCdib3hlcycsIGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgICB2YXIgcmVzdWx0PSIiOwogICAgICAgICQuZWFjaChib3hlc1tib3hlcy5sZW5ndGgtMV0sIGZ1bmN0aW9uKGssIGJveCkgewogICAgICAgICAgICBib3guX19ib3hJZCA9IGsrMTsKICAgICAgICAgICAgcmVzdWx0PXJlc3VsdCtvcHRpb25zLmZuKGJveCk7CiAgICAgICAgfSk7CiAgICAgICAgYm94ZXNbYm94ZXMubGVuZ3RoLTFdID0gW10KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgfSk7CgogICAgdmFyIHJlc29sdmVJZFJlZiA9IGZ1bmN0aW9uKHJlZikgewogICAgICAgIGlmKHN0YWNrKSB7CiAgICAgICAgICAgIHZhciBpOwogICAgICAgICAgICBmb3IoaT1zdGFjay5sZW5ndGgtMTsgaT49MDsgaS0tKSB7CiAgICAgICAgICAgICAgICBpZihzdGFja1tpXVtyZWZdKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN0YWNrW2ldW3JlZl07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgdmFyIHJlc29sdmVQb2ludGVyUmVmID0gZnVuY3Rpb24ocmVmKSB7CiAgICAgICAgdmFyIHJvb3QgPSBzdGFja1sxXTsKICAgICAgICBpZihyZWY9PSIjIikgewogICAgICAgICAgICByZXR1cm4gcm9vdDsKICAgICAgICB9CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIGpzb25wb2ludGVyLmdldChzdGFja1sxXSwgcmVmKTsKICAgICAgICB9IGNhdGNoKGUpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coZSk7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgIH0KCiAgICB2YXIgcmVzb2x2ZVJlZiA9IGZ1bmN0aW9uKHJlZikgewogICAgICAgIGlmKHJlZi5pbmRleE9mKCIjIikgPT0gMCkgewogICAgICAgICAgICByZXR1cm4gcmVzb2x2ZVBvaW50ZXJSZWYocmVmKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gcmVzb2x2ZUlkUmVmKHJlZik7CiAgICAgICAgfQogICAgfQoKICAgIHZhciBnZXROYW1lID0gZnVuY3Rpb24oc2NoZW1hKSB7CiAgICAgICAgaWYoIXNjaGVtYSkgewogICAgICAgICAgICByZXR1cm4gIjxlcnJvcj4iOwogICAgICAgIH0KICAgICAgICB2YXIgbmFtZSA9IHNjaGVtYS50aXRsZTsKICAgICAgICBuYW1lID0gIW5hbWUgJiYgc2NoZW1hLmlkID8gc2NoZW1hLmlkOiBuYW1lOwogICAgICAgIG5hbWUgPSAhbmFtZSA/IHNjaGVtYS5fX25hbWU6IG5hbWU7CiAgICAgICAgcmV0dXJuIG5hbWU7CiAgICB9CgogICAgSGFuZGxlYmFycy5yZWdpc3RlckhlbHBlcignbmFtZScsIGZ1bmN0aW9uKHNjaGVtYSwgb3B0aW9ucykgewogICAgICAgIHNjaGVtYS5fX25hbWUgPSBnZXROYW1lKHNjaGVtYSk7CiAgICAgICAgaWYoc2NoZW1hLl9fbmFtZSkgewogICAgICAgICAgICByZXR1cm4gb3B0aW9ucy5mbihzY2hlbWEpOwogICAgICAgIH0KICAgIH0pOwoKICAgIHZhciByZWZOYW1lID0gZnVuY3Rpb24ocmVmKSB7CiAgICAgICAgdmFyIG5hbWUgPSBnZXROYW1lKHJlc29sdmVSZWYocmVmKSk7CiAgICAgICAgaWYoIW5hbWUpIHsKICAgICAgICAgICAgaWYocmVmID09ICIjIikgewogICAgICAgICAgICAgICAgbmFtZSA9ICI8cm9vdD4iOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbmFtZSA9IHJlZi5yZXBsYWNlKCIjIiwgIi8iKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHZhciBzZWdtZW50cyA9IG5hbWUuc3BsaXQoIi8iKTsKICAgICAgICBuYW1lID0gc2VnbWVudHNbc2VnbWVudHMubGVuZ3RoLTFdOwogICAgICAgIHJldHVybiBuYW1lOwogICAgfQoKICAgIGZ1bmN0aW9uIHJlbmRlclNjaGVtYShzY2hlbWEpIHsKICAgICAgICBpZihzdGFjay5pbmRleE9mKHNjaGVtYSkgPT0gLTEpIHsgLy8gYXZvaWQgcmVjdXJzaW9uCiAgICAgICAgICAgIHJldHVybiBuZXcgSGFuZGxlYmFycy5TYWZlU3RyaW5nKGJveFRlbXBsYXRlKHNjaGVtYSkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgSGFuZGxlYmFycy5TYWZlU3RyaW5nKGJveFRlbXBsYXRlKHsiZGVzY3JpcHRpb24iOiAiX2NpcmN1bGFyIHJlZmVyZW5jZV8ifSkpOwogICAgICAgIH0KICAgIH0KCiAgICBIYW5kbGViYXJzLnJlZ2lzdGVySGVscGVyKCdyZWYnLCBmdW5jdGlvbihzY2hlbWEsIG9wdGlvbnMpIHsKICAgICAgICBpZihzY2hlbWEuJHJlZikgewogICAgICAgICAgICB2YXIgdGFyZ2V0ID0gcmVzb2x2ZVJlZihzY2hlbWEuJHJlZik7CiAgICAgICAgICAgIGlmKHRhcmdldCkgewogICAgICAgICAgICAgICAgdGFyZ2V0Ll9fbmFtZSA9IHJlZk5hbWUoc2NoZW1hLiRyZWYpOwogICAgICAgICAgICAgICAgdGFyZ2V0Ll9fcmVmID0gc2NoZW1hLiRyZWYucmVwbGFjZSgiIyIsICIiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgcmVzdWx0OwogICAgICAgICAgICBpZih0YXJnZXQpIHsKICAgICAgICAgICAgICAgIHJlc3VsdCA9IG9wdGlvbnMuZm4odGFyZ2V0KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJlc3VsdCA9IG5ldyBIYW5kbGViYXJzLlNhZmVTdHJpbmcoIjxzcGFuIGNsYXNzPSdzaWduYXR1cmUtdHlwZS1yZWYnPiIrc2NoZW1hLiRyZWYrIjwvc3Bhbj4iKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZih0YXJnZXQpIHsKICAgICAgICAgICAgICAgIGRlbGV0ZSB0YXJnZXQuX19yZWY7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CiAgICB9KTsKCiAgICBIYW5kbGViYXJzLnJlZ2lzdGVySGVscGVyKCdzY2hlbWEnLCBmdW5jdGlvbihzY2hlbWEpIHsKICAgICAgICByZXR1cm4gcmVuZGVyU2NoZW1hKHNjaGVtYSk7CiAgICB9KTsKCiAgICBIYW5kbGViYXJzLnJlZ2lzdGVySGVscGVyKCdzaWduYXR1cmUnLCBmdW5jdGlvbihzY2hlbWEsIGtleXdvcmQsIHNjaGVtYXMpIHsKICAgICAgICBpZighc2NoZW1hcykgewogICAgICAgICAgICBzY2hlbWFzID0gW10KICAgICAgICB9CiAgICAgICAgc2NoZW1hcyA9IHNjaGVtYXMgaW5zdGFuY2VvZiBBcnJheSA/IHNjaGVtYXMgOiBbc2NoZW1hc107CiAgICAgICAgcmV0dXJuIG5ldyBIYW5kbGViYXJzLlNhZmVTdHJpbmcoc2lnbmF0dXJlVGVtcGxhdGUoeyBzY2hlbWE6IHNjaGVtYSwga2V5d29yZDoga2V5d29yZCwgc2NoZW1hczogc2NoZW1hc30pKTsKICAgIH0pOwoKICAgIEhhbmRsZWJhcnMucmVnaXN0ZXJIZWxwZXIoJ2wnLCBmdW5jdGlvbihjb250ZXh0KSB7CiAgICAgICAgY29uc29sZS5sb2coY29udGV4dCk7CiAgICB9KTsKCiAgICBmdW5jdGlvbiBpbml0KCkgewogICAgICAgICQud2hlbiggJC5nZXQoZG9jc29uLnRlbXBsYXRlQmFzZVVybCsiL2JveC5odG1sIikuZG9uZShmdW5jdGlvbihjb250ZW50KSB7CiAgICAgICAgICAgIHNvdXJjZSA9IGNvbnRlbnQKICAgICAgICAgICAgYm94VGVtcGxhdGUgPSBIYW5kbGViYXJzLmNvbXBpbGUoc291cmNlKTsKICAgICAgICB9KSwgJC5nZXQoZG9jc29uLnRlbXBsYXRlQmFzZVVybCsiL3NpZ25hdHVyZS5odG1sIikuZG9uZShmdW5jdGlvbihjb250ZW50KSB7CiAgICAgICAgICAgIHNvdXJjZSA9IGNvbnRlbnQKICAgICAgICAgICAgc2lnbmF0dXJlVGVtcGxhdGUgPSBIYW5kbGViYXJzLmNvbXBpbGUoc291cmNlKTsKICAgICAgICB9KSkuYWx3YXlzKGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZWFkeS5yZXNvbHZlKCk7CiAgICAgICAgfSk7CiAgICB9OwoKICAgIGRvY3Nvbi5kb2MgPSBmdW5jdGlvbihlbGVtZW50LCBzY2hlbWEsIHJlZikgewogICAgICAgIHZhciBkID0gJC5EZWZlcnJlZCgpOwogICAgICAgIGluaXQoKTsKICAgICAgICByZWFkeS5kb25lKGZ1bmN0aW9uKCkgewogICAgICAgICAgICBpZih0eXBlb2YgZWxlbWVudCA9PSAic3RyaW5nIikgewogICAgICAgICAgICAgICAgZWxlbWVudCA9ICQoIiMiK2VsZW1lbnQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKHR5cGVvZiBzY2hlbWEgPT0gInN0cmluZyIpIHsKICAgICAgICAgICAgICAgIHNjaGVtYSA9IEpTT04ucGFyc2Uoc2NoZW1hKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHJlZnNQcm9taXNlID0gJC5EZWZlcnJlZCgpLnJlc29sdmUoKS5wcm9taXNlKCk7CiAgICAgICAgICAgIHZhciByZWZzID0ge307CgogICAgICAgICAgICB0cmF2ZXJzZShzY2hlbWEpLmZvckVhY2goZnVuY3Rpb24oaXRlbSkgewogICAgICAgICAgICAgICAgLy8gRml4IFN3YWdnZXIgd2VpcmQgZ2VuZXJhdGlvbiBmb3IgYXJyYXkuCiAgICAgICAgICAgICAgICBpZihpdGVtICYmIGl0ZW0uJHJlZiA9PSAiYXJyYXkiKSB7CiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGl0ZW0uJHJlZjsKICAgICAgICAgICAgICAgICAgICBpdGVtLnR5cGUgPSJhcnJheSI7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gRmV0Y2ggZXh0ZXJuYWwgc2NoZW1hCiAgICAgICAgICAgICAgICBpZih0aGlzLmtleSA9PT0gIiRyZWYiKSB7CiAgICAgICAgICAgICAgICAgICAgaWYoKC9eaHR0cHM/OlwvXC8vKS50ZXN0KGl0ZW0pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzZWdtZW50cyA9IGl0ZW0uc3BsaXQoIiMiKTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHAgPSAkLmdldChzZWdtZW50c1swXSkudGhlbihmdW5jdGlvbihjb250ZW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZih0eXBlb2YgY29udGVudCAhPSAib2JqZWN0IikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQgPSBKU09OLnBhcnNlKGNvbnRlbnQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2goZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCJVbmFibGUgdG8gcGFyc2UgIitzZWdtZW50c1swXSwgZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoY29udGVudCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZnNbaXRlbV0gPSBjb250ZW50OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgcmVmc1Byb21pc2UgPSBwLnRoZW4ocmVmc1Byb21pc2UpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHJlZnNQcm9taXNlLmRvbmUoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBzdGFjay5wdXNoKHJlZnMpOwogICAgICAgICAgICAgICAgdmFyIHRhcmdldCA9IHNjaGVtYTsKICAgICAgICAgICAgICAgIGlmKHJlZikgewogICAgICAgICAgICAgICAgICAgIHJlZiA9IHJlZlswXSAhPT0gJy8nID8gJy8nK3JlZiA6IHJlZjsKICAgICAgICAgICAgICAgICAgICB0YXJnZXQgPSBqc29ucG9pbnRlci5nZXQoc2NoZW1hLCByZWYpOwogICAgICAgICAgICAgICAgICAgIHN0YWNrLnB1c2goIHNjaGVtYSApOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRhcmdldC5yb290ID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHRhcmdldC5fX3JlZiA9ICI8cm9vdD4iOwogICAgICAgICAgICAgICAgdmFyIGh0bWwgPSBib3hUZW1wbGF0ZSh0YXJnZXQpOwoKICAgICAgICAgICAgICAgIGlmKHJlZikgewogICAgICAgICAgICAgICAgICAgIHN0YWNrLnBvcCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc3RhY2sucG9wKCk7CgogICAgICAgICAgICAgICAgZWxlbWVudC5hZGRDbGFzcygiZG9jc29uIikuaHRtbChodG1sKTsKCiAgICAgICAgICAgICAgICB2YXIgcmVzaXplSGFuZGxlciA9IGVsZW1lbnQuZ2V0KDApLm9ucmVzaXplOwogICAgICAgICAgICAgICAgZnVuY3Rpb24gcmVzaXplZCgpIHsKICAgICAgICAgICAgICAgICAgICBpZihyZXNpemVIYW5kbGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBib3ggPSBlbGVtZW50LmZpbmQoIi5ib3giKS5maXJzdCgpOwogICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmdldCgwKS5vbnJlc2l6ZShib3gub3V0ZXJXaWR0aCgpLCBib3gub3V0ZXJIZWlnaHQoKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxlbWVudC5nZXQoMCkucmVzaXplZCA9IHJlc2l6ZWQ7CiAgICAgICAgICAgICAgICByZXNpemVkKCk7CgogICAgICAgICAgICAgICAgaWYoaGlnaGxpZ2h0KSB7CiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5maW5kKCIuanNvbi1zY2hlbWEiKS5lYWNoKGZ1bmN0aW9uKGssIHNjaGVtYUVsZW1lbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaGlnaGxpZ2h0LmhpZ2hsaWdodFNjaGVtYShzY2hlbWFFbGVtZW50KTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsZW1lbnQuZmluZCgiLmJveC10aXRsZSIpLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICB2YXIgcmVmID0gJCh0aGlzKS5hdHRyKCJyZWYiKTsKICAgICAgICAgICAgICAgICAgIGlmKHJlZikgewogICAgICAgICAgICAgICAgICAgICAgIGlmKHdpbmRvdy5sb2NhdGlvbi5ocmVmLmluZGV4T2YoImRvY3Nvbi9pbmRleC5odG1sIikgPiAtMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmZpbmQoIi5ib3gtbmFtZSIpLmNzcygiY3Vyc29yIiwgInBvaW50ZXIiKS5hdHRyKCJ0aXRsZSIsICJPcGVuIGluIG5ldyB3aW5kb3ciKQogICAgICAgICAgICAgICAgICAgICAgICAgICAuaG92ZXIoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbigpeyAkKHRoaXMpLmFkZENsYXNzKCdsaW5rJykgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKCl7ICQodGhpcykucmVtb3ZlQ2xhc3MoJ2xpbmsnKSB9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAuY2xpY2soZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHVybCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmKyIkJGV4cGFuZCI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYocmVmICE9PSI8cm9vdD4iKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsID0gdXJsLnJlcGxhY2UoLyhkb2Nzb25cL2luZGV4Lmh0bWwjW15cJF0qKS4qLywgIiQxJCIrcmVmKyIkJGV4cGFuZCIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiByZWNlaXZlTWVzc2FnZShldmVudCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChldmVudC5kYXRhLmlkICYmIGV2ZW50LmRhdGEuaWQgPT0gImRvY3NvbiIgJiYgZXZlbnQuZGF0YS5hY3Rpb24gPT0gInJlYWR5IikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3LnBvc3RNZXNzYWdlKHsgaWQ6ICJkb2Nzb24iLCBhY3Rpb246ICJsb2FkIiwgZGVmaW5pdGlvbnM6IHNjaGVtYSwgdHlwZTogZXZlbnQuZGF0YS51cmwuc3BsaXQoIiQiKVsxXSwgZXhwYW5kOiB0cnVlfSwgIioiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJtZXNzYWdlIiwgcmVjZWl2ZU1lc3NhZ2UsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3ID0gd2luZG93Lm9wZW4odXJsLCAiX2JsYW5rIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgZWxlbWVudC5maW5kKCIuYm94IikubW91c2VlbnRlcihmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmNoaWxkcmVuKCIuc291cmNlLWJ1dHRvbiIpLmZhZGVJbigzMDApOwogICAgICAgICAgICAgICAgICAgICQodGhpcykuY2hpbGRyZW4oIi5ib3gtYm9keSIpLmNoaWxkcmVuKCIuZXhwYW5kLWJ1dHRvbiIpLmZhZGVJbigzMDApOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBlbGVtZW50LmZpbmQoIi5ib3giKS5tb3VzZWxlYXZlKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICQodGhpcykuY2hpbGRyZW4oIi5zb3VyY2UtYnV0dG9uIikuZmFkZU91dCgzMDApOwogICAgICAgICAgICAgICAgICAgICQodGhpcykuY2hpbGRyZW4oIi5ib3gtYm9keSIpLmNoaWxkcmVuKCIuZXhwYW5kLWJ1dHRvbiIpLmZhZGVPdXQoMzAwKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgZWxlbWVudC5maW5kKCIuc2lnbmF0dXJlLXR5cGUtZXhwYW5kYWJsZSIpLmNsaWNrKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBib3hJZCA9ICQodGhpcykuYXR0cigiYm94aWQiKTsKICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnRvZ2dsZUNsYXNzKCJzaWduYXR1cmUtdHlwZS1leHBhbmRlZCIpOwogICAgICAgICAgICAgICAgICAgICQodGhpcykucGFyZW50KCkucGFyZW50KCkucGFyZW50KCkuY2hpbGRyZW4oIi5zaWduYXR1cmUtYm94LWNvbnRhaW5lciIpLgogICAgICAgICAgICAgICAgICAgICAgICBjaGlsZHJlbigiW2JveGlkPSciK2JveElkKyInXSIpLnRvZ2dsZShyZXNpemVIYW5kbGVyID8gMCA6IDMwMCk7CiAgICAgICAgICAgICAgICAgICAgcmVzaXplZCgpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBlbGVtZW50LmZpbmQoIi5leHBhbmQtYnV0dG9uIikuY2xpY2soZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgaWYoJCh0aGlzKS5hdHRyKCJleHBhbmRlZCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykucGFyZW50KCkucGFyZW50KCkuZmluZCgiLmV4cGFuZC1idXR0b24iKS5odG1sKCIgKyAiKS5hdHRyKCJ0aXRsZSIsICJFeHBhbmQgYWxsIik7CiAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykucGFyZW50KCkucGFyZW50KCkuZmluZCgiLnNpZ25hdHVyZS10eXBlLWV4cGFuZGFibGUiKS5yZW1vdmVDbGFzcygic2lnbmF0dXJlLXR5cGUtZXhwYW5kZWQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5wYXJlbnQoKS5wYXJlbnQoKS5maW5kKCIuYm94LWNvbnRhaW5lciIpLmhpZGUoIHJlc2l6ZUhhbmRsZXIgPyAwIDogMzAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5wYXJlbnQoKS5wYXJlbnQoKS5maW5kKCIuZXhwYW5kLWJ1dHRvbiIpLnJlbW92ZUF0dHIoImV4cGFuZGVkIik7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc2l6ZWQoKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnBhcmVudCgpLnBhcmVudCgpLmZpbmQoIi5leHBhbmQtYnV0dG9uIikuaHRtbCgiIC0gIikuYXR0cigidGl0bGUiLCAiQ29sbGFwc2UgYWxsIik7CiAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykucGFyZW50KCkucGFyZW50KCkuZmluZCgiLnNpZ25hdHVyZS10eXBlLWV4cGFuZGFibGUiKS5hZGRDbGFzcygic2lnbmF0dXJlLXR5cGUtZXhwYW5kZWQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5wYXJlbnQoKS5wYXJlbnQoKS5maW5kKCIuYm94LWNvbnRhaW5lciIpLnNob3cocmVzaXplSGFuZGxlciA/IDAgOiAzMDApOwogICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnBhcmVudCgpLnBhcmVudCgpLmZpbmQoIi5leHBhbmQtYnV0dG9uIikuYXR0cigiZXhwYW5kZWQiLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmVzaXplZCgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgZWxlbWVudC5maW5kKCIuc291cmNlLWJ1dHRvbiIpLmNsaWNrKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICQodGhpcykucGFyZW50KCkuY2hpbGRyZW4oIi5ib3gtYm9keSIpLnRvZ2dsZSgpOwogICAgICAgICAgICAgICAgICAgICQodGhpcykucGFyZW50KCkuY2hpbGRyZW4oIi5zb3VyY2UiKS50b2dnbGUoKTsKICAgICAgICAgICAgICAgICAgICByZXNpemVkKCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGQucmVzb2x2ZSgpOwogICAgICAgIH0pCiAgICAgICAgcmV0dXJuIGQucHJvbWlzZSgpOwogICAgfQoKICAgIHJldHVybiBkb2Nzb247Cn0pOwo=",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Thu, 06 Nov 2014 21:49:22 GMT",
                    "Content-Length": "16793",
                    "Date": "Thu, 06 Nov 2014 21:49:22 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}