{
    "url": "http://localhost:9999/Genentech/fishtones-js/dist/fishtones-js-bundle-min.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Open redirection (DOM-based)",
    "issueType": 5243152,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based open redirection vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the target of a redirection in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause a redirection to an arbitrary external domain. This behavior can be leveraged to facilitate phishing attacks against users of the application. The ability to use an authentic application URL, targeting the correct domain with a valid SSL certificate (if SSL is used) lends credibility to the phishing attack because many users, even if they verify these features, will not notice the subsequent redirection to a different domain.<br><br><b>Note:</b> If an attacker is able to control the start of the string that is passed to the redirection API, then it may be possible to escalate this vulnerability into a JavaScript injection attack, by using a URL with the javascript: pseudo-protocol to execute arbitrary script code when the URL is processed by the browser.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based open redirection vulnerabilities is not to dynamically set redirection targets using data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing an arbitrary URL as a redirection target. In general, this is best achieved by using a whitelist of URLs that are permitted redirection targets, and strictly validating the target against this list before performing the redirection.",
    "issueDetail": "The application may be vulnerable to DOM-based open redirection. Data is read from <b>location.href</b> and written to <b>location.replace()</b> via the following statements:<ul><li>var href = location.href.replace(/(javascript:|#).*$/, '');</li><li>location.replace(href + '#' + fragment);</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/Genentech/fishtones-js/dist/fishtones-js-bundle-min.js",
                "path": "/Genentech/fishtones-js/dist/fishtones-js-bundle-min.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9HZW5lbnRlY2gvZmlzaHRvbmVzLWpzL2Rpc3QvZmlzaHRvbmVzLWpzLWJ1bmRsZS1taW4uanMgSFRUUC8xLjENCkhvc3Q6IGxvY2FsaG9zdDo5OTk5DQoNCg==",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogODk4NzMxDQpBY2NlcHQtUmFuZ2VzOiBieXRlcw0KQ29udGVudC1UeXBlOiBhcHBsaWNhdGlvbi9qYXZhc2NyaXB0DQpEYXRlOiBGcmksIDA3IE5vdiAyMDE0IDAwOjIxOjI1IEdNVA0KTGFzdC1Nb2RpZmllZDogRnJpLCAwNyBOb3YgMjAxNCAwMDoyMToyNCBHTVQNCg0KLyoqCiAqIHBWaXogYWxsIGJ1bmRsZWQgZmlsZSwgd2l0aCBkZXBlbmRlbmNpZXMKCgogKiBqUXVlcnkgdjEuOC4zIGpxdWVyeS5jb20gfCBqcXVlcnkub3JnL2xpY2Vuc2UKICogYm9vdHN0cmFwIDMuMCBUaGUgTUlUICBMaWNlbnNlIChNSVQpIENvcHlyaWdodCAoYykgMjAxMyBUd2l0dGVyLCBJbmMKICogZDMudjMuanMgQ29weXJpZ2h0IChjKSAyMDEzLCBNaWNoYWVsIEJvc3RvY2sgQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogYmFja2JvbmVqcy5vcmcgQ29weXJpZ2h0IChjKSAyMDEwLTIwMTMgSmVyZW15IEFzaGtlbmFzLCBEb2N1bWVudENsb3VkCiAqIHVuZGVyc2NvcmUuanMgQ29weXJpZ2h0IChjKSAyMDA5LTIwMTMgSmVyZW15IEFzaGtlbmFzLCBEb2N1bWVudENsb3VkIGFuZCBJbnZlc3RpZ2F0aXZlIFJlcG9ydGVycyAmIEVkaXRvcnMKIAogKiBmaXNodG9uZXMtanMKICogQ29weXJpZ2h0IChjKSAyMDEzLCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAgCiAgUmVkaXN0cmlidXRpb24gYW5kIHVzZSBpbiBzb3VyY2UgYW5kIGJpbmFyeSBmb3JtcyBhcmUgcGVybWl0dGVkCnByb3ZpZGVkIHRoYXQgdGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGFyYWdyYXBoIGFyZQkKZHVwbGljYXRlZCBpbiBhbGwgc3VjaCBmb3JtcyBhbmQgdGhhdCBhbnkgZG9jdW1lbnRhdGlvbiwKYWR2ZXJ0aXNpbmcgbWF0ZXJpYWxzLCBhbmQgb3RoZXIgbWF0ZXJpYWxzIHJlbGF0ZWQgdG8gc3VjaApkaXN0cmlidXRpb24gYW5kIHVzZSBhY2tub3dsZWRnZSB0aGF0IHRoZSBzb2Z0d2FyZSB3YXMgZGV2ZWxvcGVkCmJ5IHRoZSBCaW9pbmZvcm1hdGljcyBhbmQgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaCBJbmMuICBUaGUgbmFtZSBvZgpHZW5lbnRlY2ggbWF5IG5vdCBiZSB1c2VkIHRvIGVuZG9yc2Ugb3IgcHJvbW90ZSBwcm9kdWN0cyBkZXJpdmVkCmZyb20gdGhpcyBzb2Z0d2FyZSB3aXRob3V0IHNwZWNpZmljIHByaW9yIHdyaXR0ZW4gcGVybWlzc2lvbi4KVEhJUyBTT0ZUV0FSRSBJUyBQUk9WSURFRCBgYEFTIElTJycgQU5EIFdJVEhPVVQgQU5ZIEVYUFJFU1MgT1IKSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIFdJVEhPVVQgTElNSVRBVElPTiwgVEhFIElNUExJRUQKV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkgQU5EIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLgoKICovCgoKKGZ1bmN0aW9uIChyb290LCBmYWN0b3J5KSB7CiAgICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7CiAgIAogICAgICAgIGRlZmluZShmYWN0b3J5KTsKICAgIH0gZWxzZSB7CiAgICAgICAgLy9Ccm93c2VyIGdsb2JhbHMgY2FzZS4gSnVzdCBhc3NpZ24gdGhlCiAgICAgICAgLy9yZXN1bHQgdG8gYSBwcm9wZXJ0eSBvbiB0aGUgZ2xvYmFsLgogICAgICAgIHJvb3QuZmlzaHRvbmVzID0gZmFjdG9yeSgpOwogICAgfQp9KHRoaXMsIGZ1bmN0aW9uICgpIHsKICAgIC8vYWxtb25kLCBhbmQgeW91ciBtb2R1bGVzIHdpbGwgYmUgaW5saW5lZCBoZXJlCiAgICAKLyoqCiAqIGFsbW9uZCAwLjIuNSBDb3B5cmlnaHQgKGMpIDIwMTEtMjAxMiwgVGhlIERvam8gRm91bmRhdGlvbiBBbGwgUmlnaHRzIFJlc2VydmVkLgogKiBBdmFpbGFibGUgdmlhIHRoZSBNSVQgb3IgbmV3IEJTRCBsaWNlbnNlLgogKiBzZWU6IGh0dHA6Ly9naXRodWIuY29tL2pyYnVya2UvYWxtb25kIGZvciBkZXRhaWxzCiAqLwovL0dvaW5nIHNsb3BweSB0byBhdm9pZCAndXNlIHN0cmljdCcgc3RyaW5nIGNvc3QsIGJ1dCBzdHJpY3QgcHJhY3RpY2VzIHNob3VsZAovL2JlIGZvbGxvd2VkLgovKmpzbGludCBzbG9wcHk6IHRydWUgKi8KLypnbG9iYWwgc2V0VGltZW91dDogZmFsc2UgKi8KCnZhciByZXF1aXJlanMsIHJlcXVpcmUsIGRlZmluZTsKKGZ1bmN0aW9uICh1bmRlZikgewogICAgdmFyIG1haW4sIHJlcSwgbWFrZU1hcCwgaGFuZGxlcnMsCiAgICAgICAgZGVmaW5lZCA9IHt9LAogICAgICAgIHdhaXRpbmcgPSB7fSwKICAgICAgICBjb25maWcgPSB7fSwKICAgICAgICBkZWZpbmluZyA9IHt9LAogICAgICAgIGhhc093biA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHksCiAgICAgICAgYXBzID0gW10uc2xpY2U7CgogICAgZnVuY3Rpb24gaGFzUHJvcChvYmosIHByb3ApIHsKICAgICAgICByZXR1cm4gaGFzT3duLmNhbGwob2JqLCBwcm9wKTsKICAgIH0KCiAgICAvKioKICAgICAqIEdpdmVuIGEgcmVsYXRpdmUgbW9kdWxlIG5hbWUsIGxpa2UgLi9zb21ldGhpbmcsIG5vcm1hbGl6ZSBpdCB0bwogICAgICogYSByZWFsIG5hbWUgdGhhdCBjYW4gYmUgbWFwcGVkIHRvIGEgcGF0aC4KICAgICAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lIHRoZSByZWxhdGl2ZSBuYW1lCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gYmFzZU5hbWUgYSByZWFsIG5hbWUgdGhhdCB0aGUgbmFtZSBhcmcgaXMgcmVsYXRpdmUKICAgICAqIHRvLgogICAgICogQHJldHVybnMge1N0cmluZ30gbm9ybWFsaXplZCBuYW1lCiAgICAgKi8KICAgIGZ1bmN0aW9uIG5vcm1hbGl6ZShuYW1lLCBiYXNlTmFtZSkgewogICAgICAgIHZhciBuYW1lUGFydHMsIG5hbWVTZWdtZW50LCBtYXBWYWx1ZSwgZm91bmRNYXAsCiAgICAgICAgICAgIGZvdW5kSSwgZm91bmRTdGFyTWFwLCBzdGFySSwgaSwgaiwgcGFydCwKICAgICAgICAgICAgYmFzZVBhcnRzID0gYmFzZU5hbWUgJiYgYmFzZU5hbWUuc3BsaXQoIi8iKSwKICAgICAgICAgICAgbWFwID0gY29uZmlnLm1hcCwKICAgICAgICAgICAgc3Rhck1hcCA9IChtYXAgJiYgbWFwWycqJ10pIHx8IHt9OwoKICAgICAgICAvL0FkanVzdCBhbnkgcmVsYXRpdmUgcGF0aHMuCiAgICAgICAgaWYgKG5hbWUgJiYgbmFtZS5jaGFyQXQoMCkgPT09ICIuIikgewogICAgICAgICAgICAvL0lmIGhhdmUgYSBiYXNlIG5hbWUsIHRyeSB0byBub3JtYWxpemUgYWdhaW5zdCBpdCwKICAgICAgICAgICAgLy9vdGhlcndpc2UsIGFzc3VtZSBpdCBpcyBhIHRvcC1sZXZlbCByZXF1aXJlIHRoYXQgd2lsbAogICAgICAgICAgICAvL2JlIHJlbGF0aXZlIHRvIGJhc2VVcmwgaW4gdGhlIGVuZC4KICAgICAgICAgICAgaWYgKGJhc2VOYW1lKSB7CiAgICAgICAgICAgICAgICAvL0NvbnZlcnQgYmFzZU5hbWUgdG8gYXJyYXksIGFuZCBsb3Agb2ZmIHRoZSBsYXN0IHBhcnQsCiAgICAgICAgICAgICAgICAvL3NvIHRoYXQgLiBtYXRjaGVzIHRoYXQgImRpcmVjdG9yeSIgYW5kIG5vdCBuYW1lIG9mIHRoZSBiYXNlTmFtZSdzCiAgICAgICAgICAgICAgICAvL21vZHVsZS4gRm9yIGluc3RhbmNlLCBiYXNlTmFtZSBvZiAib25lL3R3by90aHJlZSIsIG1hcHMgdG8KICAgICAgICAgICAgICAgIC8vIm9uZS90d28vdGhyZWUuanMiLCBidXQgd2Ugd2FudCB0aGUgZGlyZWN0b3J5LCAib25lL3R3byIgZm9yCiAgICAgICAgICAgICAgICAvL3RoaXMgbm9ybWFsaXphdGlvbi4KICAgICAgICAgICAgICAgIGJhc2VQYXJ0cyA9IGJhc2VQYXJ0cy5zbGljZSgwLCBiYXNlUGFydHMubGVuZ3RoIC0gMSk7CgogICAgICAgICAgICAgICAgbmFtZSA9IGJhc2VQYXJ0cy5jb25jYXQobmFtZS5zcGxpdCgiLyIpKTsKCiAgICAgICAgICAgICAgICAvL3N0YXJ0IHRyaW1Eb3RzCiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbmFtZS5sZW5ndGg7IGkgKz0gMSkgewogICAgICAgICAgICAgICAgICAgIHBhcnQgPSBuYW1lW2ldOwogICAgICAgICAgICAgICAgICAgIGlmIChwYXJ0ID09PSAiLiIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZS5zcGxpY2UoaSwgMSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGkgLT0gMTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHBhcnQgPT09ICIuLiIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGkgPT09IDEgJiYgKG5hbWVbMl0gPT09ICcuLicgfHwgbmFtZVswXSA9PT0gJy4uJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vRW5kIG9mIHRoZSBsaW5lLiBLZWVwIGF0IGxlYXN0IG9uZSBub24tZG90CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3BhdGggc2VnbWVudCBhdCB0aGUgZnJvbnQgc28gaXQgY2FuIGJlIG1hcHBlZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9jb3JyZWN0bHkgdG8gZGlzay4gT3RoZXJ3aXNlLCB0aGVyZSBpcyBsaWtlbHkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vbm8gcGF0aCBtYXBwaW5nIGZvciBhIHBhdGggc3RhcnRpbmcgd2l0aCAnLi4nLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9UaGlzIGNhbiBzdGlsbCBmYWlsLCBidXQgY2F0Y2hlcyB0aGUgbW9zdCByZWFzb25hYmxlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3VzZXMgb2YgLi4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGkgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lLnNwbGljZShpIC0gMSwgMik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpIC09IDI7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvL2VuZCB0cmltRG90cwoKICAgICAgICAgICAgICAgIG5hbWUgPSBuYW1lLmpvaW4oIi8iKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChuYW1lLmluZGV4T2YoJy4vJykgPT09IDApIHsKICAgICAgICAgICAgICAgIC8vIE5vIGJhc2VOYW1lLCBzbyB0aGlzIGlzIElEIGlzIHJlc29sdmVkIHJlbGF0aXZlCiAgICAgICAgICAgICAgICAvLyB0byBiYXNlVXJsLCBwdWxsIG9mZiB0aGUgbGVhZGluZyBkb3QuCiAgICAgICAgICAgICAgICBuYW1lID0gbmFtZS5zdWJzdHJpbmcoMik7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vQXBwbHkgbWFwIGNvbmZpZyBpZiBhdmFpbGFibGUuCiAgICAgICAgaWYgKChiYXNlUGFydHMgfHwgc3Rhck1hcCkgJiYgbWFwKSB7CiAgICAgICAgICAgIG5hbWVQYXJ0cyA9IG5hbWUuc3BsaXQoJy8nKTsKCiAgICAgICAgICAgIGZvciAoaSA9IG5hbWVQYXJ0cy5sZW5ndGg7IGkgPiAwOyBpIC09IDEpIHsKICAgICAgICAgICAgICAgIG5hbWVTZWdtZW50ID0gbmFtZVBhcnRzLnNsaWNlKDAsIGkpLmpvaW4oIi8iKTsKCiAgICAgICAgICAgICAgICBpZiAoYmFzZVBhcnRzKSB7CiAgICAgICAgICAgICAgICAgICAgLy9GaW5kIHRoZSBsb25nZXN0IGJhc2VOYW1lIHNlZ21lbnQgbWF0Y2ggaW4gdGhlIGNvbmZpZy4KICAgICAgICAgICAgICAgICAgICAvL1NvLCBkbyBqb2lucyBvbiB0aGUgYmlnZ2VzdCB0byBzbWFsbGVzdCBsZW5ndGhzIG9mIGJhc2VQYXJ0cy4KICAgICAgICAgICAgICAgICAgICBmb3IgKGogPSBiYXNlUGFydHMubGVuZ3RoOyBqID4gMDsgaiAtPSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG1hcFZhbHVlID0gbWFwW2Jhc2VQYXJ0cy5zbGljZSgwLCBqKS5qb2luKCcvJyldOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy9iYXNlTmFtZSBzZWdtZW50IGhhcyAgY29uZmlnLCBmaW5kIGlmIGl0IGhhcyBvbmUgZm9yCiAgICAgICAgICAgICAgICAgICAgICAgIC8vdGhpcyBuYW1lLgogICAgICAgICAgICAgICAgICAgICAgICBpZiAobWFwVmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcFZhbHVlID0gbWFwVmFsdWVbbmFtZVNlZ21lbnRdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1hcFZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9NYXRjaCwgdXBkYXRlIG5hbWUgdG8gdGhlIG5ldyB2YWx1ZS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3VuZE1hcCA9IG1hcFZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvdW5kSSA9IGk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKGZvdW5kTWFwKSB7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy9DaGVjayBmb3IgYSBzdGFyIG1hcCBtYXRjaCwgYnV0IGp1c3QgaG9sZCBvbiB0byBpdCwKICAgICAgICAgICAgICAgIC8vaWYgdGhlcmUgaXMgYSBzaG9ydGVyIHNlZ21lbnQgbWF0Y2ggbGF0ZXIgaW4gYSBtYXRjaGluZwogICAgICAgICAgICAgICAgLy9jb25maWcsIHRoZW4gZmF2b3Igb3ZlciB0aGlzIHN0YXIgbWFwLgogICAgICAgICAgICAgICAgaWYgKCFmb3VuZFN0YXJNYXAgJiYgc3Rhck1hcCAmJiBzdGFyTWFwW25hbWVTZWdtZW50XSkgewogICAgICAgICAgICAgICAgICAgIGZvdW5kU3Rhck1hcCA9IHN0YXJNYXBbbmFtZVNlZ21lbnRdOwogICAgICAgICAgICAgICAgICAgIHN0YXJJID0gaTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCFmb3VuZE1hcCAmJiBmb3VuZFN0YXJNYXApIHsKICAgICAgICAgICAgICAgIGZvdW5kTWFwID0gZm91bmRTdGFyTWFwOwogICAgICAgICAgICAgICAgZm91bmRJID0gc3Rhckk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChmb3VuZE1hcCkgewogICAgICAgICAgICAgICAgbmFtZVBhcnRzLnNwbGljZSgwLCBmb3VuZEksIGZvdW5kTWFwKTsKICAgICAgICAgICAgICAgIG5hbWUgPSBuYW1lUGFydHMuam9pbignLycpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbmFtZTsKICAgIH0KCiAgICBmdW5jdGlvbiBtYWtlUmVxdWlyZShyZWxOYW1lLCBmb3JjZVN5bmMpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAvL0EgdmVyc2lvbiBvZiBhIHJlcXVpcmUgZnVuY3Rpb24gdGhhdCBwYXNzZXMgYSBtb2R1bGVOYW1lCiAgICAgICAgICAgIC8vdmFsdWUgZm9yIGl0ZW1zIHRoYXQgbWF5IG5lZWQgdG8KICAgICAgICAgICAgLy9sb29rIHVwIHBhdGhzIHJlbGF0aXZlIHRvIHRoZSBtb2R1bGVOYW1lCiAgICAgICAgICAgIHJldHVybiByZXEuYXBwbHkodW5kZWYsIGFwcy5jYWxsKGFyZ3VtZW50cywgMCkuY29uY2F0KFtyZWxOYW1lLCBmb3JjZVN5bmNdKSk7CiAgICAgICAgfTsKICAgIH0KCiAgICBmdW5jdGlvbiBtYWtlTm9ybWFsaXplKHJlbE5hbWUpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKG5hbWUpIHsKICAgICAgICAgICAgcmV0dXJuIG5vcm1hbGl6ZShuYW1lLCByZWxOYW1lKTsKICAgICAgICB9OwogICAgfQoKICAgIGZ1bmN0aW9uIG1ha2VMb2FkKGRlcE5hbWUpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgICAgIGRlZmluZWRbZGVwTmFtZV0gPSB2YWx1ZTsKICAgICAgICB9OwogICAgfQoKICAgIGZ1bmN0aW9uIGNhbGxEZXAobmFtZSkgewogICAgICAgIGlmIChoYXNQcm9wKHdhaXRpbmcsIG5hbWUpKSB7CiAgICAgICAgICAgIHZhciBhcmdzID0gd2FpdGluZ1tuYW1lXTsKICAgICAgICAgICAgZGVsZXRlIHdhaXRpbmdbbmFtZV07CiAgICAgICAgICAgIGRlZmluaW5nW25hbWVdID0gdHJ1ZTsKICAgICAgICAgICAgbWFpbi5hcHBseSh1bmRlZiwgYXJncyk7CiAgICAgICAgfQoKICAgICAgICBpZiAoIWhhc1Byb3AoZGVmaW5lZCwgbmFtZSkgJiYgIWhhc1Byb3AoZGVmaW5pbmcsIG5hbWUpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTm8gJyArIG5hbWUpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZGVmaW5lZFtuYW1lXTsKICAgIH0KCiAgICAvL1R1cm5zIGEgcGx1Z2luIXJlc291cmNlIHRvIFtwbHVnaW4sIHJlc291cmNlXQogICAgLy93aXRoIHRoZSBwbHVnaW4gYmVpbmcgdW5kZWZpbmVkIGlmIHRoZSBuYW1lCiAgICAvL2RpZCBub3QgaGF2ZSBhIHBsdWdpbiBwcmVmaXguCiAgICBmdW5jdGlvbiBzcGxpdFByZWZpeChuYW1lKSB7CiAgICAgICAgdmFyIHByZWZpeCwKICAgICAgICAgICAgaW5kZXggPSBuYW1lID8gbmFtZS5pbmRleE9mKCchJykgOiAtMTsKICAgICAgICBpZiAoaW5kZXggPiAtMSkgewogICAgICAgICAgICBwcmVmaXggPSBuYW1lLnN1YnN0cmluZygwLCBpbmRleCk7CiAgICAgICAgICAgIG5hbWUgPSBuYW1lLnN1YnN0cmluZyhpbmRleCArIDEsIG5hbWUubGVuZ3RoKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIFtwcmVmaXgsIG5hbWVdOwogICAgfQoKICAgIC8qKgogICAgICogTWFrZXMgYSBuYW1lIG1hcCwgbm9ybWFsaXppbmcgdGhlIG5hbWUsIGFuZCB1c2luZyBhIHBsdWdpbgogICAgICogZm9yIG5vcm1hbGl6YXRpb24gaWYgbmVjZXNzYXJ5LiBHcmFicyBhIHJlZiB0byBwbHVnaW4KICAgICAqIHRvbywgYXMgYW4gb3B0aW1pemF0aW9uLgogICAgICovCiAgICBtYWtlTWFwID0gZnVuY3Rpb24gKG5hbWUsIHJlbE5hbWUpIHsKICAgICAgICB2YXIgcGx1Z2luLAogICAgICAgICAgICBwYXJ0cyA9IHNwbGl0UHJlZml4KG5hbWUpLAogICAgICAgICAgICBwcmVmaXggPSBwYXJ0c1swXTsKCiAgICAgICAgbmFtZSA9IHBhcnRzWzFdOwoKICAgICAgICBpZiAocHJlZml4KSB7CiAgICAgICAgICAgIHByZWZpeCA9IG5vcm1hbGl6ZShwcmVmaXgsIHJlbE5hbWUpOwogICAgICAgICAgICBwbHVnaW4gPSBjYWxsRGVwKHByZWZpeCk7CiAgICAgICAgfQoKICAgICAgICAvL05vcm1hbGl6ZSBhY2NvcmRpbmcKICAgICAgICBpZiAocHJlZml4KSB7CiAgICAgICAgICAgIGlmIChwbHVnaW4gJiYgcGx1Z2luLm5vcm1hbGl6ZSkgewogICAgICAgICAgICAgICAgbmFtZSA9IHBsdWdpbi5ub3JtYWxpemUobmFtZSwgbWFrZU5vcm1hbGl6ZShyZWxOYW1lKSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBuYW1lID0gbm9ybWFsaXplKG5hbWUsIHJlbE5hbWUpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbmFtZSA9IG5vcm1hbGl6ZShuYW1lLCByZWxOYW1lKTsKICAgICAgICAgICAgcGFydHMgPSBzcGxpdFByZWZpeChuYW1lKTsKICAgICAgICAgICAgcHJlZml4ID0gcGFydHNbMF07CiAgICAgICAgICAgIG5hbWUgPSBwYXJ0c1sxXTsKICAgICAgICAgICAgaWYgKHByZWZpeCkgewogICAgICAgICAgICAgICAgcGx1Z2luID0gY2FsbERlcChwcmVmaXgpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvL1VzaW5nIHJpZGljdWxvdXMgcHJvcGVydHkgbmFtZXMgZm9yIHNwYWNlIHJlYXNvbnMKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBmOiBwcmVmaXggPyBwcmVmaXggKyAnIScgKyBuYW1lIDogbmFtZSwgLy9mdWxsTmFtZQogICAgICAgICAgICBuOiBuYW1lLAogICAgICAgICAgICBwcjogcHJlZml4LAogICAgICAgICAgICBwOiBwbHVnaW4KICAgICAgICB9OwogICAgfTsKCiAgICBmdW5jdGlvbiBtYWtlQ29uZmlnKG5hbWUpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gKGNvbmZpZyAmJiBjb25maWcuY29uZmlnICYmIGNvbmZpZy5jb25maWdbbmFtZV0pIHx8IHt9OwogICAgICAgIH07CiAgICB9CgogICAgaGFuZGxlcnMgPSB7CiAgICAgICAgcmVxdWlyZTogZnVuY3Rpb24gKG5hbWUpIHsKICAgICAgICAgICAgcmV0dXJuIG1ha2VSZXF1aXJlKG5hbWUpOwogICAgICAgIH0sCiAgICAgICAgZXhwb3J0czogZnVuY3Rpb24gKG5hbWUpIHsKICAgICAgICAgICAgdmFyIGUgPSBkZWZpbmVkW25hbWVdOwogICAgICAgICAgICBpZiAodHlwZW9mIGUgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiAoZGVmaW5lZFtuYW1lXSA9IHt9KTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgbW9kdWxlOiBmdW5jdGlvbiAobmFtZSkgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgaWQ6IG5hbWUsCiAgICAgICAgICAgICAgICB1cmk6ICcnLAogICAgICAgICAgICAgICAgZXhwb3J0czogZGVmaW5lZFtuYW1lXSwKICAgICAgICAgICAgICAgIGNvbmZpZzogbWFrZUNvbmZpZyhuYW1lKQogICAgICAgICAgICB9OwogICAgICAgIH0KICAgIH07CgogICAgbWFpbiA9IGZ1bmN0aW9uIChuYW1lLCBkZXBzLCBjYWxsYmFjaywgcmVsTmFtZSkgewogICAgICAgIHZhciBjanNNb2R1bGUsIGRlcE5hbWUsIHJldCwgbWFwLCBpLAogICAgICAgICAgICBhcmdzID0gW10sCiAgICAgICAgICAgIHVzaW5nRXhwb3J0czsKCiAgICAgICAgLy9Vc2UgbmFtZSBpZiBubyByZWxOYW1lCiAgICAgICAgcmVsTmFtZSA9IHJlbE5hbWUgfHwgbmFtZTsKCiAgICAgICAgLy9DYWxsIHRoZSBjYWxsYmFjayB0byBkZWZpbmUgdGhlIG1vZHVsZSwgaWYgbmVjZXNzYXJ5LgogICAgICAgIGlmICh0eXBlb2YgY2FsbGJhY2sgPT09ICdmdW5jdGlvbicpIHsKCiAgICAgICAgICAgIC8vUHVsbCBvdXQgdGhlIGRlZmluZWQgZGVwZW5kZW5jaWVzIGFuZCBwYXNzIHRoZSBvcmRlcmVkCiAgICAgICAgICAgIC8vdmFsdWVzIHRvIHRoZSBjYWxsYmFjay4KICAgICAgICAgICAgLy9EZWZhdWx0IHRvIFtyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGVdIGlmIG5vIGRlcHMKICAgICAgICAgICAgZGVwcyA9ICFkZXBzLmxlbmd0aCAmJiBjYWxsYmFjay5sZW5ndGggPyBbJ3JlcXVpcmUnLCAnZXhwb3J0cycsICdtb2R1bGUnXSA6IGRlcHM7CiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBkZXBzLmxlbmd0aDsgaSArPSAxKSB7CiAgICAgICAgICAgICAgICBtYXAgPSBtYWtlTWFwKGRlcHNbaV0sIHJlbE5hbWUpOwogICAgICAgICAgICAgICAgZGVwTmFtZSA9IG1hcC5mOwoKICAgICAgICAgICAgICAgIC8vRmFzdCBwYXRoIENvbW1vbkpTIHN0YW5kYXJkIGRlcGVuZGVuY2llcy4KICAgICAgICAgICAgICAgIGlmIChkZXBOYW1lID09PSAicmVxdWlyZSIpIHsKICAgICAgICAgICAgICAgICAgICBhcmdzW2ldID0gaGFuZGxlcnMucmVxdWlyZShuYW1lKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZGVwTmFtZSA9PT0gImV4cG9ydHMiKSB7CiAgICAgICAgICAgICAgICAgICAgLy9Db21tb25KUyBtb2R1bGUgc3BlYyAxLjEKICAgICAgICAgICAgICAgICAgICBhcmdzW2ldID0gaGFuZGxlcnMuZXhwb3J0cyhuYW1lKTsKICAgICAgICAgICAgICAgICAgICB1c2luZ0V4cG9ydHMgPSB0cnVlOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChkZXBOYW1lID09PSAibW9kdWxlIikgewogICAgICAgICAgICAgICAgICAgIC8vQ29tbW9uSlMgbW9kdWxlIHNwZWMgMS4xCiAgICAgICAgICAgICAgICAgICAgY2pzTW9kdWxlID0gYXJnc1tpXSA9IGhhbmRsZXJzLm1vZHVsZShuYW1lKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaGFzUHJvcChkZWZpbmVkLCBkZXBOYW1lKSB8fAogICAgICAgICAgICAgICAgICAgICAgICAgICBoYXNQcm9wKHdhaXRpbmcsIGRlcE5hbWUpIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhc1Byb3AoZGVmaW5pbmcsIGRlcE5hbWUpKSB7CiAgICAgICAgICAgICAgICAgICAgYXJnc1tpXSA9IGNhbGxEZXAoZGVwTmFtZSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG1hcC5wKSB7CiAgICAgICAgICAgICAgICAgICAgbWFwLnAubG9hZChtYXAubiwgbWFrZVJlcXVpcmUocmVsTmFtZSwgdHJ1ZSksIG1ha2VMb2FkKGRlcE5hbWUpLCB7fSk7CiAgICAgICAgICAgICAgICAgICAgYXJnc1tpXSA9IGRlZmluZWRbZGVwTmFtZV07CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihuYW1lICsgJyBtaXNzaW5nICcgKyBkZXBOYW1lKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0ID0gY2FsbGJhY2suYXBwbHkoZGVmaW5lZFtuYW1lXSwgYXJncyk7CgogICAgICAgICAgICBpZiAobmFtZSkgewogICAgICAgICAgICAgICAgLy9JZiBzZXR0aW5nIGV4cG9ydHMgdmlhICJtb2R1bGUiIGlzIGluIHBsYXksCiAgICAgICAgICAgICAgICAvL2Zhdm9yIHRoYXQgb3ZlciByZXR1cm4gdmFsdWUgYW5kIGV4cG9ydHMuIEFmdGVyIHRoYXQsCiAgICAgICAgICAgICAgICAvL2Zhdm9yIGEgbm9uLXVuZGVmaW5lZCByZXR1cm4gdmFsdWUgb3ZlciBleHBvcnRzIHVzZS4KICAgICAgICAgICAgICAgIGlmIChjanNNb2R1bGUgJiYgY2pzTW9kdWxlLmV4cG9ydHMgIT09IHVuZGVmICYmCiAgICAgICAgICAgICAgICAgICAgICAgIGNqc01vZHVsZS5leHBvcnRzICE9PSBkZWZpbmVkW25hbWVdKSB7CiAgICAgICAgICAgICAgICAgICAgZGVmaW5lZFtuYW1lXSA9IGNqc01vZHVsZS5leHBvcnRzOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXQgIT09IHVuZGVmIHx8ICF1c2luZ0V4cG9ydHMpIHsKICAgICAgICAgICAgICAgICAgICAvL1VzZSB0aGUgcmV0dXJuIHZhbHVlIGZyb20gdGhlIGZ1bmN0aW9uLgogICAgICAgICAgICAgICAgICAgIGRlZmluZWRbbmFtZV0gPSByZXQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKG5hbWUpIHsKICAgICAgICAgICAgLy9NYXkganVzdCBiZSBhbiBvYmplY3QgZGVmaW5pdGlvbiBmb3IgdGhlIG1vZHVsZS4gT25seQogICAgICAgICAgICAvL3dvcnJ5IGFib3V0IGRlZmluaW5nIGlmIGhhdmUgYSBtb2R1bGUgbmFtZS4KICAgICAgICAgICAgZGVmaW5lZFtuYW1lXSA9IGNhbGxiYWNrOwogICAgICAgIH0KICAgIH07CgogICAgcmVxdWlyZWpzID0gcmVxdWlyZSA9IHJlcSA9IGZ1bmN0aW9uIChkZXBzLCBjYWxsYmFjaywgcmVsTmFtZSwgZm9yY2VTeW5jLCBhbHQpIHsKICAgICAgICBpZiAodHlwZW9mIGRlcHMgPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgIGlmIChoYW5kbGVyc1tkZXBzXSkgewogICAgICAgICAgICAgICAgLy9jYWxsYmFjayBpbiB0aGlzIGNhc2UgaXMgcmVhbGx5IHJlbE5hbWUKICAgICAgICAgICAgICAgIHJldHVybiBoYW5kbGVyc1tkZXBzXShjYWxsYmFjayk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy9KdXN0IHJldHVybiB0aGUgbW9kdWxlIHdhbnRlZC4gSW4gdGhpcyBzY2VuYXJpbywgdGhlCiAgICAgICAgICAgIC8vZGVwcyBhcmcgaXMgdGhlIG1vZHVsZSBuYW1lLCBhbmQgc2Vjb25kIGFyZyAoaWYgcGFzc2VkKQogICAgICAgICAgICAvL2lzIGp1c3QgdGhlIHJlbE5hbWUuCiAgICAgICAgICAgIC8vTm9ybWFsaXplIG1vZHVsZSBuYW1lLCBpZiBpdCBjb250YWlucyAuIG9yIC4uCiAgICAgICAgICAgIHJldHVybiBjYWxsRGVwKG1ha2VNYXAoZGVwcywgY2FsbGJhY2spLmYpOwogICAgICAgIH0gZWxzZSBpZiAoIWRlcHMuc3BsaWNlKSB7CiAgICAgICAgICAgIC8vZGVwcyBpcyBhIGNvbmZpZyBvYmplY3QsIG5vdCBhbiBhcnJheS4KICAgICAgICAgICAgY29uZmlnID0gZGVwczsKICAgICAgICAgICAgaWYgKGNhbGxiYWNrLnNwbGljZSkgewogICAgICAgICAgICAgICAgLy9jYWxsYmFjayBpcyBhbiBhcnJheSwgd2hpY2ggbWVhbnMgaXQgaXMgYSBkZXBlbmRlbmN5IGxpc3QuCiAgICAgICAgICAgICAgICAvL0FkanVzdCBhcmdzIGlmIHRoZXJlIGFyZSBkZXBlbmRlbmNpZXMKICAgICAgICAgICAgICAgIGRlcHMgPSBjYWxsYmFjazsKICAgICAgICAgICAgICAgIGNhbGxiYWNrID0gcmVsTmFtZTsKICAgICAgICAgICAgICAgIHJlbE5hbWUgPSBudWxsOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZGVwcyA9IHVuZGVmOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvL1N1cHBvcnQgcmVxdWlyZShbJ2EnXSkKICAgICAgICBjYWxsYmFjayA9IGNhbGxiYWNrIHx8IGZ1bmN0aW9uICgpIHt9OwoKICAgICAgICAvL0lmIHJlbE5hbWUgaXMgYSBmdW5jdGlvbiwgaXQgaXMgYW4gZXJyYmFjayBoYW5kbGVyLAogICAgICAgIC8vc28gcmVtb3ZlIGl0LgogICAgICAgIGlmICh0eXBlb2YgcmVsTmFtZSA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICByZWxOYW1lID0gZm9yY2VTeW5jOwogICAgICAgICAgICBmb3JjZVN5bmMgPSBhbHQ7CiAgICAgICAgfQoKICAgICAgICAvL1NpbXVsYXRlIGFzeW5jIGNhbGxiYWNrOwogICAgICAgIGlmIChmb3JjZVN5bmMpIHsKICAgICAgICAgICAgbWFpbih1bmRlZiwgZGVwcywgY2FsbGJhY2ssIHJlbE5hbWUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vVXNpbmcgYSBub24temVybyB2YWx1ZSBiZWNhdXNlIG9mIGNvbmNlcm4gZm9yIHdoYXQgb2xkIGJyb3dzZXJzCiAgICAgICAgICAgIC8vZG8sIGFuZCBsYXRlc3QgYnJvd3NlcnMgInVwZ3JhZGUiIHRvIDQgaWYgbG93ZXIgdmFsdWUgaXMgdXNlZDoKICAgICAgICAgICAgLy9odHRwOi8vd3d3LndoYXR3Zy5vcmcvc3BlY3Mvd2ViLWFwcHMvY3VycmVudC13b3JrL211bHRpcGFnZS90aW1lcnMuaHRtbCNkb20td2luZG93dGltZXJzLXNldHRpbWVvdXQ6CiAgICAgICAgICAgIC8vSWYgd2FudCBhIHZhbHVlIGltbWVkaWF0ZWx5LCB1c2UgcmVxdWlyZSgnaWQnKSBpbnN0ZWFkIC0tIHNvbWV0aGluZwogICAgICAgICAgICAvL3RoYXQgd29ya3MgaW4gYWxtb25kIG9uIHRoZSBnbG9iYWwgbGV2ZWwsIGJ1dCBub3QgZ3VhcmFudGVlZCBhbmQKICAgICAgICAgICAgLy91bmxpa2VseSB0byB3b3JrIGluIG90aGVyIEFNRCBpbXBsZW1lbnRhdGlvbnMuCiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgbWFpbih1bmRlZiwgZGVwcywgY2FsbGJhY2ssIHJlbE5hbWUpOwogICAgICAgICAgICB9LCA0KTsKICAgICAgICB9CgogICAgICAgIHJldHVybiByZXE7CiAgICB9OwoKICAgIC8qKgogICAgICogSnVzdCBkcm9wcyB0aGUgY29uZmlnIG9uIHRoZSBmbG9vciwgYnV0IHJldHVybnMgcmVxIGluIGNhc2UKICAgICAqIHRoZSBjb25maWcgcmV0dXJuIHZhbHVlIGlzIHVzZWQuCiAgICAgKi8KICAgIHJlcS5jb25maWcgPSBmdW5jdGlvbiAoY2ZnKSB7CiAgICAgICAgY29uZmlnID0gY2ZnOwogICAgICAgIGlmIChjb25maWcuZGVwcykgewogICAgICAgICAgICByZXEoY29uZmlnLmRlcHMsIGNvbmZpZy5jYWxsYmFjayk7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXE7CiAgICB9OwoKICAgIGRlZmluZSA9IGZ1bmN0aW9uIChuYW1lLCBkZXBzLCBjYWxsYmFjaykgewoKICAgICAgICAvL1RoaXMgbW9kdWxlIG1heSBub3QgaGF2ZSBkZXBlbmRlbmNpZXMKICAgICAgICBpZiAoIWRlcHMuc3BsaWNlKSB7CiAgICAgICAgICAgIC8vZGVwcyBpcyBub3QgYW4gYXJyYXksIHNvIHByb2JhYmx5IG1lYW5zCiAgICAgICAgICAgIC8vYW4gb2JqZWN0IGxpdGVyYWwgb3IgZmFjdG9yeSBmdW5jdGlvbiBmb3IKICAgICAgICAgICAgLy90aGUgdmFsdWUuIEFkanVzdCBhcmdzLgogICAgICAgICAgICBjYWxsYmFjayA9IGRlcHM7CiAgICAgICAgICAgIGRlcHMgPSBbXTsKICAgICAgICB9CgogICAgICAgIGlmICghaGFzUHJvcChkZWZpbmVkLCBuYW1lKSAmJiAhaGFzUHJvcCh3YWl0aW5nLCBuYW1lKSkgewogICAgICAgICAgICB3YWl0aW5nW25hbWVdID0gW25hbWUsIGRlcHMsIGNhbGxiYWNrXTsKICAgICAgICB9CiAgICB9OwoKICAgIGRlZmluZS5hbWQgPSB7CiAgICAgICAgalF1ZXJ5OiB0cnVlCiAgICB9Owp9KCkpOwpkZWZpbmUoIi4uLy4uL2J1aWxkLXV0aWxzL2FsbW9uZCIsIGZ1bmN0aW9uKCl7fSk7CgovKiEKICogalF1ZXJ5IEphdmFTY3JpcHQgTGlicmFyeSB2MS45LjEKICogaHR0cDovL2pxdWVyeS5jb20vCiAqCiAqIEluY2x1ZGVzIFNpenpsZS5qcwogKiBodHRwOi8vc2l6emxlanMuY29tLwogKgogKiBDb3B5cmlnaHQgMjAwNSwgMjAxMiBqUXVlcnkgRm91bmRhdGlvbiwgSW5jLiBhbmQgb3RoZXIgY29udHJpYnV0b3JzCiAqIFJlbGVhc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZQogKiBodHRwOi8vanF1ZXJ5Lm9yZy9saWNlbnNlCiAqCiAqIERhdGU6IDIwMTMtMi00CiAqLwooZnVuY3Rpb24oIHdpbmRvdywgdW5kZWZpbmVkICkgewoKLy8gQ2FuJ3QgZG8gdGhpcyBiZWNhdXNlIHNldmVyYWwgYXBwcyBpbmNsdWRpbmcgQVNQLk5FVCB0cmFjZQovLyB0aGUgc3RhY2sgdmlhIGFyZ3VtZW50cy5jYWxsZXIuY2FsbGVlIGFuZCBGaXJlZm94IGRpZXMgaWYKLy8geW91IHRyeSB0byB0cmFjZSB0aHJvdWdoICJ1c2Ugc3RyaWN0IiBjYWxsIGNoYWlucy4gKCMxMzMzNSkKLy8gU3VwcG9ydDogRmlyZWZveCAxOCsKLy8KdmFyCgkvLyBUaGUgZGVmZXJyZWQgdXNlZCBvbiBET00gcmVhZHkKCXJlYWR5TGlzdCwKCgkvLyBBIGNlbnRyYWwgcmVmZXJlbmNlIHRvIHRoZSByb290IGpRdWVyeShkb2N1bWVudCkKCXJvb3RqUXVlcnksCgoJLy8gU3VwcG9ydDogSUU8OQoJLy8gRm9yIGB0eXBlb2Ygbm9kZS5tZXRob2RgIGluc3RlYWQgb2YgYG5vZGUubWV0aG9kICE9PSB1bmRlZmluZWRgCgljb3JlX3N0cnVuZGVmaW5lZCA9IHR5cGVvZiB1bmRlZmluZWQsCgoJLy8gVXNlIHRoZSBjb3JyZWN0IGRvY3VtZW50IGFjY29yZGluZ2x5IHdpdGggd2luZG93IGFyZ3VtZW50IChzYW5kYm94KQoJZG9jdW1lbnQgPSB3aW5kb3cuZG9jdW1lbnQsCglsb2NhdGlvbiA9IHdpbmRvdy5sb2NhdGlvbiwKCgkvLyBNYXAgb3ZlciBqUXVlcnkgaW4gY2FzZSBvZiBvdmVyd3JpdGUKCV9qUXVlcnkgPSB3aW5kb3cualF1ZXJ5LAoKCS8vIE1hcCBvdmVyIHRoZSAkIGluIGNhc2Ugb2Ygb3ZlcndyaXRlCglfJCA9IHdpbmRvdy4kLAoKCS8vIFtbQ2xhc3NdXSAtPiB0eXBlIHBhaXJzCgljbGFzczJ0eXBlID0ge30sCgoJLy8gTGlzdCBvZiBkZWxldGVkIGRhdGEgY2FjaGUgaWRzLCBzbyB3ZSBjYW4gcmV1c2UgdGhlbQoJY29yZV9kZWxldGVkSWRzID0gW10sCgoJY29yZV92ZXJzaW9uID0gIjEuOS4xIiwKCgkvLyBTYXZlIGEgcmVmZXJlbmNlIHRvIHNvbWUgY29yZSBtZXRob2RzCgljb3JlX2NvbmNhdCA9IGNvcmVfZGVsZXRlZElkcy5jb25jYXQsCgljb3JlX3B1c2ggPSBjb3JlX2RlbGV0ZWRJZHMucHVzaCwKCWNvcmVfc2xpY2UgPSBjb3JlX2RlbGV0ZWRJZHMuc2xpY2UsCgljb3JlX2luZGV4T2YgPSBjb3JlX2RlbGV0ZWRJZHMuaW5kZXhPZiwKCWNvcmVfdG9TdHJpbmcgPSBjbGFzczJ0eXBlLnRvU3RyaW5nLAoJY29yZV9oYXNPd24gPSBjbGFzczJ0eXBlLmhhc093blByb3BlcnR5LAoJY29yZV90cmltID0gY29yZV92ZXJzaW9uLnRyaW0sCgoJLy8gRGVmaW5lIGEgbG9jYWwgY29weSBvZiBqUXVlcnkKCWpRdWVyeSA9IGZ1bmN0aW9uKCBzZWxlY3RvciwgY29udGV4dCApIHsKCQkvLyBUaGUgalF1ZXJ5IG9iamVjdCBpcyBhY3R1YWxseSBqdXN0IHRoZSBpbml0IGNvbnN0cnVjdG9yICdlbmhhbmNlZCcKCQlyZXR1cm4gbmV3IGpRdWVyeS5mbi5pbml0KCBzZWxlY3RvciwgY29udGV4dCwgcm9vdGpRdWVyeSApOwoJfSwKCgkvLyBVc2VkIGZvciBtYXRjaGluZyBudW1iZXJzCgljb3JlX3BudW0gPSAvWystXT8oPzpcZCpcLnwpXGQrKD86W2VFXVsrLV0/XGQrfCkvLnNvdXJjZSwKCgkvLyBVc2VkIGZvciBzcGxpdHRpbmcgb24gd2hpdGVzcGFjZQoJY29yZV9ybm90d2hpdGUgPSAvXFMrL2csCgoJLy8gTWFrZSBzdXJlIHdlIHRyaW0gQk9NIGFuZCBOQlNQIChoZXJlJ3MgbG9va2luZyBhdCB5b3UsIFNhZmFyaSA1LjAgYW5kIElFKQoJcnRyaW0gPSAvXltcc1x1RkVGRlx4QTBdK3xbXHNcdUZFRkZceEEwXSskL2csCgoJLy8gQSBzaW1wbGUgd2F5IHRvIGNoZWNrIGZvciBIVE1MIHN0cmluZ3MKCS8vIFByaW9yaXRpemUgI2lkIG92ZXIgPHRhZz4gdG8gYXZvaWQgWFNTIHZpYSBsb2NhdGlvbi5oYXNoICgjOTUyMSkKCS8vIFN0cmljdCBIVE1MIHJlY29nbml0aW9uICgjMTEyOTA6IG11c3Qgc3RhcnQgd2l0aCA8KQoJcnF1aWNrRXhwciA9IC9eKD86KDxbXHdcV10rPilbXj5dKnwjKFtcdy1dKikpJC8sCgoJLy8gTWF0Y2ggYSBzdGFuZGFsb25lIHRhZwoJcnNpbmdsZVRhZyA9IC9ePChcdyspXHMqXC8/Pig/OjxcL1wxPnwpJC8sCgoJLy8gSlNPTiBSZWdFeHAKCXJ2YWxpZGNoYXJzID0gL15bXF0sOnt9XHNdKiQvLAoJcnZhbGlkYnJhY2VzID0gLyg/Ol58OnwsKSg/OlxzKlxbKSsvZywKCXJ2YWxpZGVzY2FwZSA9IC9cXCg/OlsiXFxcL2JmbnJ0XXx1W1xkYS1mQS1GXXs0fSkvZywKCXJ2YWxpZHRva2VucyA9IC8iW14iXFxcclxuXSoifHRydWV8ZmFsc2V8bnVsbHwtPyg/OlxkK1wufClcZCsoPzpbZUVdWystXT9cZCt8KS9nLAoKCS8vIE1hdGNoZXMgZGFzaGVkIHN0cmluZyBmb3IgY2FtZWxpemluZwoJcm1zUHJlZml4ID0gL14tbXMtLywKCXJkYXNoQWxwaGEgPSAvLShbXGRhLXpdKS9naSwKCgkvLyBVc2VkIGJ5IGpRdWVyeS5jYW1lbENhc2UgYXMgY2FsbGJhY2sgdG8gcmVwbGFjZSgpCglmY2FtZWxDYXNlID0gZnVuY3Rpb24oIGFsbCwgbGV0dGVyICkgewoJCXJldHVybiBsZXR0ZXIudG9VcHBlckNhc2UoKTsKCX0sCgoJLy8gVGhlIHJlYWR5IGV2ZW50IGhhbmRsZXIKCWNvbXBsZXRlZCA9IGZ1bmN0aW9uKCBldmVudCApIHsKCgkJLy8gcmVhZHlTdGF0ZSA9PT0gImNvbXBsZXRlIiBpcyBnb29kIGVub3VnaCBmb3IgdXMgdG8gY2FsbCB0aGUgZG9tIHJlYWR5IGluIG9sZElFCgkJaWYgKCBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyIHx8IGV2ZW50LnR5cGUgPT09ICJsb2FkIiB8fCBkb2N1bWVudC5yZWFkeVN0YXRlID09PSAiY29tcGxldGUiICkgewoJCQlkZXRhY2goKTsKCQkJalF1ZXJ5LnJlYWR5KCk7CgkJfQoJfSwKCS8vIENsZWFuLXVwIG1ldGhvZCBmb3IgZG9tIHJlYWR5IGV2ZW50cwoJZGV0YWNoID0gZnVuY3Rpb24oKSB7CgkJaWYgKCBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyICkgewoJCQlkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCAiRE9NQ29udGVudExvYWRlZCIsIGNvbXBsZXRlZCwgZmFsc2UgKTsKCQkJd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoICJsb2FkIiwgY29tcGxldGVkLCBmYWxzZSApOwoKCQl9IGVsc2UgewoJCQlkb2N1bWVudC5kZXRhY2hFdmVudCggIm9ucmVhZHlzdGF0ZWNoYW5nZSIsIGNvbXBsZXRlZCApOwoJCQl3aW5kb3cuZGV0YWNoRXZlbnQoICJvbmxvYWQiLCBjb21wbGV0ZWQgKTsKCQl9Cgl9OwoKalF1ZXJ5LmZuID0galF1ZXJ5LnByb3RvdHlwZSA9IHsKCS8vIFRoZSBjdXJyZW50IHZlcnNpb24gb2YgalF1ZXJ5IGJlaW5nIHVzZWQKCWpxdWVyeTogY29yZV92ZXJzaW9uLAoKCWNvbnN0cnVjdG9yOiBqUXVlcnksCglpbml0OiBmdW5jdGlvbiggc2VsZWN0b3IsIGNvbnRleHQsIHJvb3RqUXVlcnkgKSB7CgkJdmFyIG1hdGNoLCBlbGVtOwoKCQkvLyBIQU5ETEU6ICQoIiIpLCAkKG51bGwpLCAkKHVuZGVmaW5lZCksICQoZmFsc2UpCgkJaWYgKCAhc2VsZWN0b3IgKSB7CgkJCXJldHVybiB0aGlzOwoJCX0KCgkJLy8gSGFuZGxlIEhUTUwgc3RyaW5ncwoJCWlmICggdHlwZW9mIHNlbGVjdG9yID09PSAic3RyaW5nIiApIHsKCQkJaWYgKCBzZWxlY3Rvci5jaGFyQXQoMCkgPT09ICI8IiAmJiBzZWxlY3Rvci5jaGFyQXQoIHNlbGVjdG9yLmxlbmd0aCAtIDEgKSA9PT0gIj4iICYmIHNlbGVjdG9yLmxlbmd0aCA+PSAzICkgewoJCQkJLy8gQXNzdW1lIHRoYXQgc3RyaW5ncyB0aGF0IHN0YXJ0IGFuZCBlbmQgd2l0aCA8PiBhcmUgSFRNTCBhbmQgc2tpcCB0aGUgcmVnZXggY2hlY2sKCQkJCW1hdGNoID0gWyBudWxsLCBzZWxlY3RvciwgbnVsbCBdOwoKCQkJfSBlbHNlIHsKCQkJCW1hdGNoID0gcnF1aWNrRXhwci5leGVjKCBzZWxlY3RvciApOwoJCQl9CgoJCQkvLyBNYXRjaCBodG1sIG9yIG1ha2Ugc3VyZSBubyBjb250ZXh0IGlzIHNwZWNpZmllZCBmb3IgI2lkCgkJCWlmICggbWF0Y2ggJiYgKG1hdGNoWzFdIHx8ICFjb250ZXh0KSApIHsKCgkJCQkvLyBIQU5ETEU6ICQoaHRtbCkgLT4gJChhcnJheSkKCQkJCWlmICggbWF0Y2hbMV0gKSB7CgkJCQkJY29udGV4dCA9IGNvbnRleHQgaW5zdGFuY2VvZiBqUXVlcnkgPyBjb250ZXh0WzBdIDogY29udGV4dDsKCgkJCQkJLy8gc2NyaXB0cyBpcyB0cnVlIGZvciBiYWNrLWNvbXBhdAoJCQkJCWpRdWVyeS5tZXJnZSggdGhpcywgalF1ZXJ5LnBhcnNlSFRNTCgKCQkJCQkJbWF0Y2hbMV0sCgkJCQkJCWNvbnRleHQgJiYgY29udGV4dC5ub2RlVHlwZSA/IGNvbnRleHQub3duZXJEb2N1bWVudCB8fCBjb250ZXh0IDogZG9jdW1lbnQsCgkJCQkJCXRydWUKCQkJCQkpICk7CgoJCQkJCS8vIEhBTkRMRTogJChodG1sLCBwcm9wcykKCQkJCQlpZiAoIHJzaW5nbGVUYWcudGVzdCggbWF0Y2hbMV0gKSAmJiBqUXVlcnkuaXNQbGFpbk9iamVjdCggY29udGV4dCApICkgewoJCQkJCQlmb3IgKCBtYXRjaCBpbiBjb250ZXh0ICkgewoJCQkJCQkJLy8gUHJvcGVydGllcyBvZiBjb250ZXh0IGFyZSBjYWxsZWQgYXMgbWV0aG9kcyBpZiBwb3NzaWJsZQoJCQkJCQkJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggdGhpc1sgbWF0Y2ggXSApICkgewoJCQkJCQkJCXRoaXNbIG1hdGNoIF0oIGNvbnRleHRbIG1hdGNoIF0gKTsKCgkJCQkJCQkvLyAuLi5hbmQgb3RoZXJ3aXNlIHNldCBhcyBhdHRyaWJ1dGVzCgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCXRoaXMuYXR0ciggbWF0Y2gsIGNvbnRleHRbIG1hdGNoIF0gKTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCgkJCQkJcmV0dXJuIHRoaXM7CgoJCQkJLy8gSEFORExFOiAkKCNpZCkKCQkJCX0gZWxzZSB7CgkJCQkJZWxlbSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCBtYXRjaFsyXSApOwoKCQkJCQkvLyBDaGVjayBwYXJlbnROb2RlIHRvIGNhdGNoIHdoZW4gQmxhY2tiZXJyeSA0LjYgcmV0dXJucwoJCQkJCS8vIG5vZGVzIHRoYXQgYXJlIG5vIGxvbmdlciBpbiB0aGUgZG9jdW1lbnQgIzY5NjMKCQkJCQlpZiAoIGVsZW0gJiYgZWxlbS5wYXJlbnROb2RlICkgewoJCQkJCQkvLyBIYW5kbGUgdGhlIGNhc2Ugd2hlcmUgSUUgYW5kIE9wZXJhIHJldHVybiBpdGVtcwoJCQkJCQkvLyBieSBuYW1lIGluc3RlYWQgb2YgSUQKCQkJCQkJaWYgKCBlbGVtLmlkICE9PSBtYXRjaFsyXSApIHsKCQkJCQkJCXJldHVybiByb290alF1ZXJ5LmZpbmQoIHNlbGVjdG9yICk7CgkJCQkJCX0KCgkJCQkJCS8vIE90aGVyd2lzZSwgd2UgaW5qZWN0IHRoZSBlbGVtZW50IGRpcmVjdGx5IGludG8gdGhlIGpRdWVyeSBvYmplY3QKCQkJCQkJdGhpcy5sZW5ndGggPSAxOwoJCQkJCQl0aGlzWzBdID0gZWxlbTsKCQkJCQl9CgoJCQkJCXRoaXMuY29udGV4dCA9IGRvY3VtZW50OwoJCQkJCXRoaXMuc2VsZWN0b3IgPSBzZWxlY3RvcjsKCQkJCQlyZXR1cm4gdGhpczsKCQkJCX0KCgkJCS8vIEhBTkRMRTogJChleHByLCAkKC4uLikpCgkJCX0gZWxzZSBpZiAoICFjb250ZXh0IHx8IGNvbnRleHQuanF1ZXJ5ICkgewoJCQkJcmV0dXJuICggY29udGV4dCB8fCByb290alF1ZXJ5ICkuZmluZCggc2VsZWN0b3IgKTsKCgkJCS8vIEhBTkRMRTogJChleHByLCBjb250ZXh0KQoJCQkvLyAod2hpY2ggaXMganVzdCBlcXVpdmFsZW50IHRvOiAkKGNvbnRleHQpLmZpbmQoZXhwcikKCQkJfSBlbHNlIHsKCQkJCXJldHVybiB0aGlzLmNvbnN0cnVjdG9yKCBjb250ZXh0ICkuZmluZCggc2VsZWN0b3IgKTsKCQkJfQoKCQkvLyBIQU5ETEU6ICQoRE9NRWxlbWVudCkKCQl9IGVsc2UgaWYgKCBzZWxlY3Rvci5ub2RlVHlwZSApIHsKCQkJdGhpcy5jb250ZXh0ID0gdGhpc1swXSA9IHNlbGVjdG9yOwoJCQl0aGlzLmxlbmd0aCA9IDE7CgkJCXJldHVybiB0aGlzOwoKCQkvLyBIQU5ETEU6ICQoZnVuY3Rpb24pCgkJLy8gU2hvcnRjdXQgZm9yIGRvY3VtZW50IHJlYWR5CgkJfSBlbHNlIGlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIHNlbGVjdG9yICkgKSB7CgkJCXJldHVybiByb290alF1ZXJ5LnJlYWR5KCBzZWxlY3RvciApOwoJCX0KCgkJaWYgKCBzZWxlY3Rvci5zZWxlY3RvciAhPT0gdW5kZWZpbmVkICkgewoJCQl0aGlzLnNlbGVjdG9yID0gc2VsZWN0b3Iuc2VsZWN0b3I7CgkJCXRoaXMuY29udGV4dCA9IHNlbGVjdG9yLmNvbnRleHQ7CgkJfQoKCQlyZXR1cm4galF1ZXJ5Lm1ha2VBcnJheSggc2VsZWN0b3IsIHRoaXMgKTsKCX0sCgoJLy8gU3RhcnQgd2l0aCBhbiBlbXB0eSBzZWxlY3RvcgoJc2VsZWN0b3I6ICIiLAoKCS8vIFRoZSBkZWZhdWx0IGxlbmd0aCBvZiBhIGpRdWVyeSBvYmplY3QgaXMgMAoJbGVuZ3RoOiAwLAoKCS8vIFRoZSBudW1iZXIgb2YgZWxlbWVudHMgY29udGFpbmVkIGluIHRoZSBtYXRjaGVkIGVsZW1lbnQgc2V0CglzaXplOiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5sZW5ndGg7Cgl9LAoKCXRvQXJyYXk6IGZ1bmN0aW9uKCkgewoJCXJldHVybiBjb3JlX3NsaWNlLmNhbGwoIHRoaXMgKTsKCX0sCgoJLy8gR2V0IHRoZSBOdGggZWxlbWVudCBpbiB0aGUgbWF0Y2hlZCBlbGVtZW50IHNldCBPUgoJLy8gR2V0IHRoZSB3aG9sZSBtYXRjaGVkIGVsZW1lbnQgc2V0IGFzIGEgY2xlYW4gYXJyYXkKCWdldDogZnVuY3Rpb24oIG51bSApIHsKCQlyZXR1cm4gbnVtID09IG51bGwgPwoKCQkJLy8gUmV0dXJuIGEgJ2NsZWFuJyBhcnJheQoJCQl0aGlzLnRvQXJyYXkoKSA6CgoJCQkvLyBSZXR1cm4ganVzdCB0aGUgb2JqZWN0CgkJCSggbnVtIDwgMCA/IHRoaXNbIHRoaXMubGVuZ3RoICsgbnVtIF0gOiB0aGlzWyBudW0gXSApOwoJfSwKCgkvLyBUYWtlIGFuIGFycmF5IG9mIGVsZW1lbnRzIGFuZCBwdXNoIGl0IG9udG8gdGhlIHN0YWNrCgkvLyAocmV0dXJuaW5nIHRoZSBuZXcgbWF0Y2hlZCBlbGVtZW50IHNldCkKCXB1c2hTdGFjazogZnVuY3Rpb24oIGVsZW1zICkgewoKCQkvLyBCdWlsZCBhIG5ldyBqUXVlcnkgbWF0Y2hlZCBlbGVtZW50IHNldAoJCXZhciByZXQgPSBqUXVlcnkubWVyZ2UoIHRoaXMuY29uc3RydWN0b3IoKSwgZWxlbXMgKTsKCgkJLy8gQWRkIHRoZSBvbGQgb2JqZWN0IG9udG8gdGhlIHN0YWNrIChhcyBhIHJlZmVyZW5jZSkKCQlyZXQucHJldk9iamVjdCA9IHRoaXM7CgkJcmV0LmNvbnRleHQgPSB0aGlzLmNvbnRleHQ7CgoJCS8vIFJldHVybiB0aGUgbmV3bHktZm9ybWVkIGVsZW1lbnQgc2V0CgkJcmV0dXJuIHJldDsKCX0sCgoJLy8gRXhlY3V0ZSBhIGNhbGxiYWNrIGZvciBldmVyeSBlbGVtZW50IGluIHRoZSBtYXRjaGVkIHNldC4KCS8vIChZb3UgY2FuIHNlZWQgdGhlIGFyZ3VtZW50cyB3aXRoIGFuIGFycmF5IG9mIGFyZ3MsIGJ1dCB0aGlzIGlzCgkvLyBvbmx5IHVzZWQgaW50ZXJuYWxseS4pCgllYWNoOiBmdW5jdGlvbiggY2FsbGJhY2ssIGFyZ3MgKSB7CgkJcmV0dXJuIGpRdWVyeS5lYWNoKCB0aGlzLCBjYWxsYmFjaywgYXJncyApOwoJfSwKCglyZWFkeTogZnVuY3Rpb24oIGZuICkgewoJCS8vIEFkZCB0aGUgY2FsbGJhY2sKCQlqUXVlcnkucmVhZHkucHJvbWlzZSgpLmRvbmUoIGZuICk7CgoJCXJldHVybiB0aGlzOwoJfSwKCglzbGljZTogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMucHVzaFN0YWNrKCBjb3JlX3NsaWNlLmFwcGx5KCB0aGlzLCBhcmd1bWVudHMgKSApOwoJfSwKCglmaXJzdDogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMuZXEoIDAgKTsKCX0sCgoJbGFzdDogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMuZXEoIC0xICk7Cgl9LAoKCWVxOiBmdW5jdGlvbiggaSApIHsKCQl2YXIgbGVuID0gdGhpcy5sZW5ndGgsCgkJCWogPSAraSArICggaSA8IDAgPyBsZW4gOiAwICk7CgkJcmV0dXJuIHRoaXMucHVzaFN0YWNrKCBqID49IDAgJiYgaiA8IGxlbiA/IFsgdGhpc1tqXSBdIDogW10gKTsKCX0sCgoJbWFwOiBmdW5jdGlvbiggY2FsbGJhY2sgKSB7CgkJcmV0dXJuIHRoaXMucHVzaFN0YWNrKCBqUXVlcnkubWFwKHRoaXMsIGZ1bmN0aW9uKCBlbGVtLCBpICkgewoJCQlyZXR1cm4gY2FsbGJhY2suY2FsbCggZWxlbSwgaSwgZWxlbSApOwoJCX0pKTsKCX0sCgoJZW5kOiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5wcmV2T2JqZWN0IHx8IHRoaXMuY29uc3RydWN0b3IobnVsbCk7Cgl9LAoKCS8vIEZvciBpbnRlcm5hbCB1c2Ugb25seS4KCS8vIEJlaGF2ZXMgbGlrZSBhbiBBcnJheSdzIG1ldGhvZCwgbm90IGxpa2UgYSBqUXVlcnkgbWV0aG9kLgoJcHVzaDogY29yZV9wdXNoLAoJc29ydDogW10uc29ydCwKCXNwbGljZTogW10uc3BsaWNlCn07CgovLyBHaXZlIHRoZSBpbml0IGZ1bmN0aW9uIHRoZSBqUXVlcnkgcHJvdG90eXBlIGZvciBsYXRlciBpbnN0YW50aWF0aW9uCmpRdWVyeS5mbi5pbml0LnByb3RvdHlwZSA9IGpRdWVyeS5mbjsKCmpRdWVyeS5leHRlbmQgPSBqUXVlcnkuZm4uZXh0ZW5kID0gZnVuY3Rpb24oKSB7Cgl2YXIgc3JjLCBjb3B5SXNBcnJheSwgY29weSwgbmFtZSwgb3B0aW9ucywgY2xvbmUsCgkJdGFyZ2V0ID0gYXJndW1lbnRzWzBdIHx8IHt9LAoJCWkgPSAxLAoJCWxlbmd0aCA9IGFyZ3VtZW50cy5sZW5ndGgsCgkJZGVlcCA9IGZhbHNlOwoKCS8vIEhhbmRsZSBhIGRlZXAgY29weSBzaXR1YXRpb24KCWlmICggdHlwZW9mIHRhcmdldCA9PT0gImJvb2xlYW4iICkgewoJCWRlZXAgPSB0YXJnZXQ7CgkJdGFyZ2V0ID0gYXJndW1lbnRzWzFdIHx8IHt9OwoJCS8vIHNraXAgdGhlIGJvb2xlYW4gYW5kIHRoZSB0YXJnZXQKCQlpID0gMjsKCX0KCgkvLyBIYW5kbGUgY2FzZSB3aGVuIHRhcmdldCBpcyBhIHN0cmluZyBvciBzb21ldGhpbmcgKHBvc3NpYmxlIGluIGRlZXAgY29weSkKCWlmICggdHlwZW9mIHRhcmdldCAhPT0gIm9iamVjdCIgJiYgIWpRdWVyeS5pc0Z1bmN0aW9uKHRhcmdldCkgKSB7CgkJdGFyZ2V0ID0ge307Cgl9CgoJLy8gZXh0ZW5kIGpRdWVyeSBpdHNlbGYgaWYgb25seSBvbmUgYXJndW1lbnQgaXMgcGFzc2VkCglpZiAoIGxlbmd0aCA9PT0gaSApIHsKCQl0YXJnZXQgPSB0aGlzOwoJCS0taTsKCX0KCglmb3IgKCA7IGkgPCBsZW5ndGg7IGkrKyApIHsKCQkvLyBPbmx5IGRlYWwgd2l0aCBub24tbnVsbC91bmRlZmluZWQgdmFsdWVzCgkJaWYgKCAob3B0aW9ucyA9IGFyZ3VtZW50c1sgaSBdKSAhPSBudWxsICkgewoJCQkvLyBFeHRlbmQgdGhlIGJhc2Ugb2JqZWN0CgkJCWZvciAoIG5hbWUgaW4gb3B0aW9ucyApIHsKCQkJCXNyYyA9IHRhcmdldFsgbmFtZSBdOwoJCQkJY29weSA9IG9wdGlvbnNbIG5hbWUgXTsKCgkJCQkvLyBQcmV2ZW50IG5ldmVyLWVuZGluZyBsb29wCgkJCQlpZiAoIHRhcmdldCA9PT0gY29weSApIHsKCQkJCQljb250aW51ZTsKCQkJCX0KCgkJCQkvLyBSZWN1cnNlIGlmIHdlJ3JlIG1lcmdpbmcgcGxhaW4gb2JqZWN0cyBvciBhcnJheXMKCQkJCWlmICggZGVlcCAmJiBjb3B5ICYmICggalF1ZXJ5LmlzUGxhaW5PYmplY3QoY29weSkgfHwgKGNvcHlJc0FycmF5ID0galF1ZXJ5LmlzQXJyYXkoY29weSkpICkgKSB7CgkJCQkJaWYgKCBjb3B5SXNBcnJheSApIHsKCQkJCQkJY29weUlzQXJyYXkgPSBmYWxzZTsKCQkJCQkJY2xvbmUgPSBzcmMgJiYgalF1ZXJ5LmlzQXJyYXkoc3JjKSA/IHNyYyA6IFtdOwoKCQkJCQl9IGVsc2UgewoJCQkJCQljbG9uZSA9IHNyYyAmJiBqUXVlcnkuaXNQbGFpbk9iamVjdChzcmMpID8gc3JjIDoge307CgkJCQkJfQoKCQkJCQkvLyBOZXZlciBtb3ZlIG9yaWdpbmFsIG9iamVjdHMsIGNsb25lIHRoZW0KCQkJCQl0YXJnZXRbIG5hbWUgXSA9IGpRdWVyeS5leHRlbmQoIGRlZXAsIGNsb25lLCBjb3B5ICk7CgoJCQkJLy8gRG9uJ3QgYnJpbmcgaW4gdW5kZWZpbmVkIHZhbHVlcwoJCQkJfSBlbHNlIGlmICggY29weSAhPT0gdW5kZWZpbmVkICkgewoJCQkJCXRhcmdldFsgbmFtZSBdID0gY29weTsKCQkJCX0KCQkJfQoJCX0KCX0KCgkvLyBSZXR1cm4gdGhlIG1vZGlmaWVkIG9iamVjdAoJcmV0dXJuIHRhcmdldDsKfTsKCmpRdWVyeS5leHRlbmQoewoJbm9Db25mbGljdDogZnVuY3Rpb24oIGRlZXAgKSB7CgkJaWYgKCB3aW5kb3cuJCA9PT0galF1ZXJ5ICkgewoJCQl3aW5kb3cuJCA9IF8kOwoJCX0KCgkJaWYgKCBkZWVwICYmIHdpbmRvdy5qUXVlcnkgPT09IGpRdWVyeSApIHsKCQkJd2luZG93LmpRdWVyeSA9IF9qUXVlcnk7CgkJfQoKCQlyZXR1cm4galF1ZXJ5OwoJfSwKCgkvLyBJcyB0aGUgRE9NIHJlYWR5IHRvIGJlIHVzZWQ/IFNldCB0byB0cnVlIG9uY2UgaXQgb2NjdXJzLgoJaXNSZWFkeTogZmFsc2UsCgoJLy8gQSBjb3VudGVyIHRvIHRyYWNrIGhvdyBtYW55IGl0ZW1zIHRvIHdhaXQgZm9yIGJlZm9yZQoJLy8gdGhlIHJlYWR5IGV2ZW50IGZpcmVzLiBTZWUgIzY3ODEKCXJlYWR5V2FpdDogMSwKCgkvLyBIb2xkIChvciByZWxlYXNlKSB0aGUgcmVhZHkgZXZlbnQKCWhvbGRSZWFkeTogZnVuY3Rpb24oIGhvbGQgKSB7CgkJaWYgKCBob2xkICkgewoJCQlqUXVlcnkucmVhZHlXYWl0Kys7CgkJfSBlbHNlIHsKCQkJalF1ZXJ5LnJlYWR5KCB0cnVlICk7CgkJfQoJfSwKCgkvLyBIYW5kbGUgd2hlbiB0aGUgRE9NIGlzIHJlYWR5CglyZWFkeTogZnVuY3Rpb24oIHdhaXQgKSB7CgoJCS8vIEFib3J0IGlmIHRoZXJlIGFyZSBwZW5kaW5nIGhvbGRzIG9yIHdlJ3JlIGFscmVhZHkgcmVhZHkKCQlpZiAoIHdhaXQgPT09IHRydWUgPyAtLWpRdWVyeS5yZWFkeVdhaXQgOiBqUXVlcnkuaXNSZWFkeSApIHsKCQkJcmV0dXJuOwoJCX0KCgkJLy8gTWFrZSBzdXJlIGJvZHkgZXhpc3RzLCBhdCBsZWFzdCwgaW4gY2FzZSBJRSBnZXRzIGEgbGl0dGxlIG92ZXJ6ZWFsb3VzICh0aWNrZXQgIzU0NDMpLgoJCWlmICggIWRvY3VtZW50LmJvZHkgKSB7CgkJCXJldHVybiBzZXRUaW1lb3V0KCBqUXVlcnkucmVhZHkgKTsKCQl9CgoJCS8vIFJlbWVtYmVyIHRoYXQgdGhlIERPTSBpcyByZWFkeQoJCWpRdWVyeS5pc1JlYWR5ID0gdHJ1ZTsKCgkJLy8gSWYgYSBub3JtYWwgRE9NIFJlYWR5IGV2ZW50IGZpcmVkLCBkZWNyZW1lbnQsIGFuZCB3YWl0IGlmIG5lZWQgYmUKCQlpZiAoIHdhaXQgIT09IHRydWUgJiYgLS1qUXVlcnkucmVhZHlXYWl0ID4gMCApIHsKCQkJcmV0dXJuOwoJCX0KCgkJLy8gSWYgdGhlcmUgYXJlIGZ1bmN0aW9ucyBib3VuZCwgdG8gZXhlY3V0ZQoJCXJlYWR5TGlzdC5yZXNvbHZlV2l0aCggZG9jdW1lbnQsIFsgalF1ZXJ5IF0gKTsKCgkJLy8gVHJpZ2dlciBhbnkgYm91bmQgcmVhZHkgZXZlbnRzCgkJaWYgKCBqUXVlcnkuZm4udHJpZ2dlciApIHsKCQkJalF1ZXJ5KCBkb2N1bWVudCApLnRyaWdnZXIoInJlYWR5Iikub2ZmKCJyZWFkeSIpOwoJCX0KCX0sCgoJLy8gU2VlIHRlc3QvdW5pdC9jb3JlLmpzIGZvciBkZXRhaWxzIGNvbmNlcm5pbmcgaXNGdW5jdGlvbi4KCS8vIFNpbmNlIHZlcnNpb24gMS4zLCBET00gbWV0aG9kcyBhbmQgZnVuY3Rpb25zIGxpa2UgYWxlcnQKCS8vIGFyZW4ndCBzdXBwb3J0ZWQuIFRoZXkgcmV0dXJuIGZhbHNlIG9uIElFICgjMjk2OCkuCglpc0Z1bmN0aW9uOiBmdW5jdGlvbiggb2JqICkgewoJCXJldHVybiBqUXVlcnkudHlwZShvYmopID09PSAiZnVuY3Rpb24iOwoJfSwKCglpc0FycmF5OiBBcnJheS5pc0FycmF5IHx8IGZ1bmN0aW9uKCBvYmogKSB7CgkJcmV0dXJuIGpRdWVyeS50eXBlKG9iaikgPT09ICJhcnJheSI7Cgl9LAoKCWlzV2luZG93OiBmdW5jdGlvbiggb2JqICkgewoJCXJldHVybiBvYmogIT0gbnVsbCAmJiBvYmogPT0gb2JqLndpbmRvdzsKCX0sCgoJaXNOdW1lcmljOiBmdW5jdGlvbiggb2JqICkgewoJCXJldHVybiAhaXNOYU4oIHBhcnNlRmxvYXQob2JqKSApICYmIGlzRmluaXRlKCBvYmogKTsKCX0sCgoJdHlwZTogZnVuY3Rpb24oIG9iaiApIHsKCQlpZiAoIG9iaiA9PSBudWxsICkgewoJCQlyZXR1cm4gU3RyaW5nKCBvYmogKTsKCQl9CgkJcmV0dXJuIHR5cGVvZiBvYmogPT09ICJvYmplY3QiIHx8IHR5cGVvZiBvYmogPT09ICJmdW5jdGlvbiIgPwoJCQljbGFzczJ0eXBlWyBjb3JlX3RvU3RyaW5nLmNhbGwob2JqKSBdIHx8ICJvYmplY3QiIDoKCQkJdHlwZW9mIG9iajsKCX0sCgoJaXNQbGFpbk9iamVjdDogZnVuY3Rpb24oIG9iaiApIHsKCQkvLyBNdXN0IGJlIGFuIE9iamVjdC4KCQkvLyBCZWNhdXNlIG9mIElFLCB3ZSBhbHNvIGhhdmUgdG8gY2hlY2sgdGhlIHByZXNlbmNlIG9mIHRoZSBjb25zdHJ1Y3RvciBwcm9wZXJ0eS4KCQkvLyBNYWtlIHN1cmUgdGhhdCBET00gbm9kZXMgYW5kIHdpbmRvdyBvYmplY3RzIGRvbid0IHBhc3MgdGhyb3VnaCwgYXMgd2VsbAoJCWlmICggIW9iaiB8fCBqUXVlcnkudHlwZShvYmopICE9PSAib2JqZWN0IiB8fCBvYmoubm9kZVR5cGUgfHwgalF1ZXJ5LmlzV2luZG93KCBvYmogKSApIHsKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCgkJdHJ5IHsKCQkJLy8gTm90IG93biBjb25zdHJ1Y3RvciBwcm9wZXJ0eSBtdXN0IGJlIE9iamVjdAoJCQlpZiAoIG9iai5jb25zdHJ1Y3RvciAmJgoJCQkJIWNvcmVfaGFzT3duLmNhbGwob2JqLCAiY29uc3RydWN0b3IiKSAmJgoJCQkJIWNvcmVfaGFzT3duLmNhbGwob2JqLmNvbnN0cnVjdG9yLnByb3RvdHlwZSwgImlzUHJvdG90eXBlT2YiKSApIHsKCQkJCXJldHVybiBmYWxzZTsKCQkJfQoJCX0gY2F0Y2ggKCBlICkgewoJCQkvLyBJRTgsOSBXaWxsIHRocm93IGV4Y2VwdGlvbnMgb24gY2VydGFpbiBob3N0IG9iamVjdHMgIzk4OTcKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCgkJLy8gT3duIHByb3BlcnRpZXMgYXJlIGVudW1lcmF0ZWQgZmlyc3RseSwgc28gdG8gc3BlZWQgdXAsCgkJLy8gaWYgbGFzdCBvbmUgaXMgb3duLCB0aGVuIGFsbCBwcm9wZXJ0aWVzIGFyZSBvd24uCgoJCXZhciBrZXk7CgkJZm9yICgga2V5IGluIG9iaiApIHt9CgoJCXJldHVybiBrZXkgPT09IHVuZGVmaW5lZCB8fCBjb3JlX2hhc093bi5jYWxsKCBvYmosIGtleSApOwoJfSwKCglpc0VtcHR5T2JqZWN0OiBmdW5jdGlvbiggb2JqICkgewoJCXZhciBuYW1lOwoJCWZvciAoIG5hbWUgaW4gb2JqICkgewoJCQlyZXR1cm4gZmFsc2U7CgkJfQoJCXJldHVybiB0cnVlOwoJfSwKCgllcnJvcjogZnVuY3Rpb24oIG1zZyApIHsKCQl0aHJvdyBuZXcgRXJyb3IoIG1zZyApOwoJfSwKCgkvLyBkYXRhOiBzdHJpbmcgb2YgaHRtbAoJLy8gY29udGV4dCAob3B0aW9uYWwpOiBJZiBzcGVjaWZpZWQsIHRoZSBmcmFnbWVudCB3aWxsIGJlIGNyZWF0ZWQgaW4gdGhpcyBjb250ZXh0LCBkZWZhdWx0cyB0byBkb2N1bWVudAoJLy8ga2VlcFNjcmlwdHMgKG9wdGlvbmFsKTogSWYgdHJ1ZSwgd2lsbCBpbmNsdWRlIHNjcmlwdHMgcGFzc2VkIGluIHRoZSBodG1sIHN0cmluZwoJcGFyc2VIVE1MOiBmdW5jdGlvbiggZGF0YSwgY29udGV4dCwga2VlcFNjcmlwdHMgKSB7CgkJaWYgKCAhZGF0YSB8fCB0eXBlb2YgZGF0YSAhPT0gInN0cmluZyIgKSB7CgkJCXJldHVybiBudWxsOwoJCX0KCQlpZiAoIHR5cGVvZiBjb250ZXh0ID09PSAiYm9vbGVhbiIgKSB7CgkJCWtlZXBTY3JpcHRzID0gY29udGV4dDsKCQkJY29udGV4dCA9IGZhbHNlOwoJCX0KCQljb250ZXh0ID0gY29udGV4dCB8fCBkb2N1bWVudDsKCgkJdmFyIHBhcnNlZCA9IHJzaW5nbGVUYWcuZXhlYyggZGF0YSApLAoJCQlzY3JpcHRzID0gIWtlZXBTY3JpcHRzICYmIFtdOwoKCQkvLyBTaW5nbGUgdGFnCgkJaWYgKCBwYXJzZWQgKSB7CgkJCXJldHVybiBbIGNvbnRleHQuY3JlYXRlRWxlbWVudCggcGFyc2VkWzFdICkgXTsKCQl9CgoJCXBhcnNlZCA9IGpRdWVyeS5idWlsZEZyYWdtZW50KCBbIGRhdGEgXSwgY29udGV4dCwgc2NyaXB0cyApOwoJCWlmICggc2NyaXB0cyApIHsKCQkJalF1ZXJ5KCBzY3JpcHRzICkucmVtb3ZlKCk7CgkJfQoJCXJldHVybiBqUXVlcnkubWVyZ2UoIFtdLCBwYXJzZWQuY2hpbGROb2RlcyApOwoJfSwKCglwYXJzZUpTT046IGZ1bmN0aW9uKCBkYXRhICkgewoJCS8vIEF0dGVtcHQgdG8gcGFyc2UgdXNpbmcgdGhlIG5hdGl2ZSBKU09OIHBhcnNlciBmaXJzdAoJCWlmICggd2luZG93LkpTT04gJiYgd2luZG93LkpTT04ucGFyc2UgKSB7CgkJCXJldHVybiB3aW5kb3cuSlNPTi5wYXJzZSggZGF0YSApOwoJCX0KCgkJaWYgKCBkYXRhID09PSBudWxsICkgewoJCQlyZXR1cm4gZGF0YTsKCQl9CgoJCWlmICggdHlwZW9mIGRhdGEgPT09ICJzdHJpbmciICkgewoKCQkJLy8gTWFrZSBzdXJlIGxlYWRpbmcvdHJhaWxpbmcgd2hpdGVzcGFjZSBpcyByZW1vdmVkIChJRSBjYW4ndCBoYW5kbGUgaXQpCgkJCWRhdGEgPSBqUXVlcnkudHJpbSggZGF0YSApOwoKCQkJaWYgKCBkYXRhICkgewoJCQkJLy8gTWFrZSBzdXJlIHRoZSBpbmNvbWluZyBkYXRhIGlzIGFjdHVhbCBKU09OCgkJCQkvLyBMb2dpYyBib3Jyb3dlZCBmcm9tIGh0dHA6Ly9qc29uLm9yZy9qc29uMi5qcwoJCQkJaWYgKCBydmFsaWRjaGFycy50ZXN0KCBkYXRhLnJlcGxhY2UoIHJ2YWxpZGVzY2FwZSwgIkAiICkKCQkJCQkucmVwbGFjZSggcnZhbGlkdG9rZW5zLCAiXSIgKQoJCQkJCS5yZXBsYWNlKCBydmFsaWRicmFjZXMsICIiKSkgKSB7CgoJCQkJCXJldHVybiAoIG5ldyBGdW5jdGlvbiggInJldHVybiAiICsgZGF0YSApICkoKTsKCQkJCX0KCQkJfQoJCX0KCgkJalF1ZXJ5LmVycm9yKCAiSW52YWxpZCBKU09OOiAiICsgZGF0YSApOwoJfSwKCgkvLyBDcm9zcy1icm93c2VyIHhtbCBwYXJzaW5nCglwYXJzZVhNTDogZnVuY3Rpb24oIGRhdGEgKSB7CgkJdmFyIHhtbCwgdG1wOwoJCWlmICggIWRhdGEgfHwgdHlwZW9mIGRhdGEgIT09ICJzdHJpbmciICkgewoJCQlyZXR1cm4gbnVsbDsKCQl9CgkJdHJ5IHsKCQkJaWYgKCB3aW5kb3cuRE9NUGFyc2VyICkgeyAvLyBTdGFuZGFyZAoJCQkJdG1wID0gbmV3IERPTVBhcnNlcigpOwoJCQkJeG1sID0gdG1wLnBhcnNlRnJvbVN0cmluZyggZGF0YSAsICJ0ZXh0L3htbCIgKTsKCQkJfSBlbHNlIHsgLy8gSUUKCQkJCXhtbCA9IG5ldyBBY3RpdmVYT2JqZWN0KCAiTWljcm9zb2Z0LlhNTERPTSIgKTsKCQkJCXhtbC5hc3luYyA9ICJmYWxzZSI7CgkJCQl4bWwubG9hZFhNTCggZGF0YSApOwoJCQl9CgkJfSBjYXRjaCggZSApIHsKCQkJeG1sID0gdW5kZWZpbmVkOwoJCX0KCQlpZiAoICF4bWwgfHwgIXhtbC5kb2N1bWVudEVsZW1lbnQgfHwgeG1sLmdldEVsZW1lbnRzQnlUYWdOYW1lKCAicGFyc2VyZXJyb3IiICkubGVuZ3RoICkgewoJCQlqUXVlcnkuZXJyb3IoICJJbnZhbGlkIFhNTDogIiArIGRhdGEgKTsKCQl9CgkJcmV0dXJuIHhtbDsKCX0sCgoJbm9vcDogZnVuY3Rpb24oKSB7fSwKCgkvLyBFdmFsdWF0ZXMgYSBzY3JpcHQgaW4gYSBnbG9iYWwgY29udGV4dAoJLy8gV29ya2Fyb3VuZHMgYmFzZWQgb24gZmluZGluZ3MgYnkgSmltIERyaXNjb2xsCgkvLyBodHRwOi8vd2VibG9ncy5qYXZhLm5ldC9ibG9nL2RyaXNjb2xsL2FyY2hpdmUvMjAwOS8wOS8wOC9ldmFsLWphdmFzY3JpcHQtZ2xvYmFsLWNvbnRleHQKCWdsb2JhbEV2YWw6IGZ1bmN0aW9uKCBkYXRhICkgewoJCWlmICggZGF0YSAmJiBqUXVlcnkudHJpbSggZGF0YSApICkgewoJCQkvLyBXZSB1c2UgZXhlY1NjcmlwdCBvbiBJbnRlcm5ldCBFeHBsb3JlcgoJCQkvLyBXZSB1c2UgYW4gYW5vbnltb3VzIGZ1bmN0aW9uIHNvIHRoYXQgY29udGV4dCBpcyB3aW5kb3cKCQkJLy8gcmF0aGVyIHRoYW4galF1ZXJ5IGluIEZpcmVmb3gKCQkJKCB3aW5kb3cuZXhlY1NjcmlwdCB8fCBmdW5jdGlvbiggZGF0YSApIHsKCQkJCXdpbmRvd1sgImV2YWwiIF0uY2FsbCggd2luZG93LCBkYXRhICk7CgkJCX0gKSggZGF0YSApOwoJCX0KCX0sCgoJLy8gQ29udmVydCBkYXNoZWQgdG8gY2FtZWxDYXNlOyB1c2VkIGJ5IHRoZSBjc3MgYW5kIGRhdGEgbW9kdWxlcwoJLy8gTWljcm9zb2Z0IGZvcmdvdCB0byBodW1wIHRoZWlyIHZlbmRvciBwcmVmaXggKCM5NTcyKQoJY2FtZWxDYXNlOiBmdW5jdGlvbiggc3RyaW5nICkgewoJCXJldHVybiBzdHJpbmcucmVwbGFjZSggcm1zUHJlZml4LCAibXMtIiApLnJlcGxhY2UoIHJkYXNoQWxwaGEsIGZjYW1lbENhc2UgKTsKCX0sCgoJbm9kZU5hbWU6IGZ1bmN0aW9uKCBlbGVtLCBuYW1lICkgewoJCXJldHVybiBlbGVtLm5vZGVOYW1lICYmIGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gbmFtZS50b0xvd2VyQ2FzZSgpOwoJfSwKCgkvLyBhcmdzIGlzIGZvciBpbnRlcm5hbCB1c2FnZSBvbmx5CgllYWNoOiBmdW5jdGlvbiggb2JqLCBjYWxsYmFjaywgYXJncyApIHsKCQl2YXIgdmFsdWUsCgkJCWkgPSAwLAoJCQlsZW5ndGggPSBvYmoubGVuZ3RoLAoJCQlpc0FycmF5ID0gaXNBcnJheWxpa2UoIG9iaiApOwoKCQlpZiAoIGFyZ3MgKSB7CgkJCWlmICggaXNBcnJheSApIHsKCQkJCWZvciAoIDsgaSA8IGxlbmd0aDsgaSsrICkgewoJCQkJCXZhbHVlID0gY2FsbGJhY2suYXBwbHkoIG9ialsgaSBdLCBhcmdzICk7CgoJCQkJCWlmICggdmFsdWUgPT09IGZhbHNlICkgewoJCQkJCQlicmVhazsKCQkJCQl9CgkJCQl9CgkJCX0gZWxzZSB7CgkJCQlmb3IgKCBpIGluIG9iaiApIHsKCQkJCQl2YWx1ZSA9IGNhbGxiYWNrLmFwcGx5KCBvYmpbIGkgXSwgYXJncyApOwoKCQkJCQlpZiAoIHZhbHVlID09PSBmYWxzZSApIHsKCQkJCQkJYnJlYWs7CgkJCQkJfQoJCQkJfQoJCQl9CgoJCS8vIEEgc3BlY2lhbCwgZmFzdCwgY2FzZSBmb3IgdGhlIG1vc3QgY29tbW9uIHVzZSBvZiBlYWNoCgkJfSBlbHNlIHsKCQkJaWYgKCBpc0FycmF5ICkgewoJCQkJZm9yICggOyBpIDwgbGVuZ3RoOyBpKysgKSB7CgkJCQkJdmFsdWUgPSBjYWxsYmFjay5jYWxsKCBvYmpbIGkgXSwgaSwgb2JqWyBpIF0gKTsKCgkJCQkJaWYgKCB2YWx1ZSA9PT0gZmFsc2UgKSB7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCQkJCX0KCQkJfSBlbHNlIHsKCQkJCWZvciAoIGkgaW4gb2JqICkgewoJCQkJCXZhbHVlID0gY2FsbGJhY2suY2FsbCggb2JqWyBpIF0sIGksIG9ialsgaSBdICk7CgoJCQkJCWlmICggdmFsdWUgPT09IGZhbHNlICkgewoJCQkJCQlicmVhazsKCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgoJCXJldHVybiBvYmo7Cgl9LAoKCS8vIFVzZSBuYXRpdmUgU3RyaW5nLnRyaW0gZnVuY3Rpb24gd2hlcmV2ZXIgcG9zc2libGUKCXRyaW06IGNvcmVfdHJpbSAmJiAhY29yZV90cmltLmNhbGwoIlx1RkVGRlx4QTAiKSA/CgkJZnVuY3Rpb24oIHRleHQgKSB7CgkJCXJldHVybiB0ZXh0ID09IG51bGwgPwoJCQkJIiIgOgoJCQkJY29yZV90cmltLmNhbGwoIHRleHQgKTsKCQl9IDoKCgkJLy8gT3RoZXJ3aXNlIHVzZSBvdXIgb3duIHRyaW1taW5nIGZ1bmN0aW9uYWxpdHkKCQlmdW5jdGlvbiggdGV4dCApIHsKCQkJcmV0dXJuIHRleHQgPT0gbnVsbCA/CgkJCQkiIiA6CgkJCQkoIHRleHQgKyAiIiApLnJlcGxhY2UoIHJ0cmltLCAiIiApOwoJCX0sCgoJLy8gcmVzdWx0cyBpcyBmb3IgaW50ZXJuYWwgdXNhZ2Ugb25seQoJbWFrZUFycmF5OiBmdW5jdGlvbiggYXJyLCByZXN1bHRzICkgewoJCXZhciByZXQgPSByZXN1bHRzIHx8IFtdOwoKCQlpZiAoIGFyciAhPSBudWxsICkgewoJCQlpZiAoIGlzQXJyYXlsaWtlKCBPYmplY3QoYXJyKSApICkgewoJCQkJalF1ZXJ5Lm1lcmdlKCByZXQsCgkJCQkJdHlwZW9mIGFyciA9PT0gInN0cmluZyIgPwoJCQkJCVsgYXJyIF0gOiBhcnIKCQkJCSk7CgkJCX0gZWxzZSB7CgkJCQljb3JlX3B1c2guY2FsbCggcmV0LCBhcnIgKTsKCQkJfQoJCX0KCgkJcmV0dXJuIHJldDsKCX0sCgoJaW5BcnJheTogZnVuY3Rpb24oIGVsZW0sIGFyciwgaSApIHsKCQl2YXIgbGVuOwoKCQlpZiAoIGFyciApIHsKCQkJaWYgKCBjb3JlX2luZGV4T2YgKSB7CgkJCQlyZXR1cm4gY29yZV9pbmRleE9mLmNhbGwoIGFyciwgZWxlbSwgaSApOwoJCQl9CgoJCQlsZW4gPSBhcnIubGVuZ3RoOwoJCQlpID0gaSA/IGkgPCAwID8gTWF0aC5tYXgoIDAsIGxlbiArIGkgKSA6IGkgOiAwOwoKCQkJZm9yICggOyBpIDwgbGVuOyBpKysgKSB7CgkJCQkvLyBTa2lwIGFjY2Vzc2luZyBpbiBzcGFyc2UgYXJyYXlzCgkJCQlpZiAoIGkgaW4gYXJyICYmIGFyclsgaSBdID09PSBlbGVtICkgewoJCQkJCXJldHVybiBpOwoJCQkJfQoJCQl9CgkJfQoKCQlyZXR1cm4gLTE7Cgl9LAoKCW1lcmdlOiBmdW5jdGlvbiggZmlyc3QsIHNlY29uZCApIHsKCQl2YXIgbCA9IHNlY29uZC5sZW5ndGgsCgkJCWkgPSBmaXJzdC5sZW5ndGgsCgkJCWogPSAwOwoKCQlpZiAoIHR5cGVvZiBsID09PSAibnVtYmVyIiApIHsKCQkJZm9yICggOyBqIDwgbDsgaisrICkgewoJCQkJZmlyc3RbIGkrKyBdID0gc2Vjb25kWyBqIF07CgkJCX0KCQl9IGVsc2UgewoJCQl3aGlsZSAoIHNlY29uZFtqXSAhPT0gdW5kZWZpbmVkICkgewoJCQkJZmlyc3RbIGkrKyBdID0gc2Vjb25kWyBqKysgXTsKCQkJfQoJCX0KCgkJZmlyc3QubGVuZ3RoID0gaTsKCgkJcmV0dXJuIGZpcnN0OwoJfSwKCglncmVwOiBmdW5jdGlvbiggZWxlbXMsIGNhbGxiYWNrLCBpbnYgKSB7CgkJdmFyIHJldFZhbCwKCQkJcmV0ID0gW10sCgkJCWkgPSAwLAoJCQlsZW5ndGggPSBlbGVtcy5sZW5ndGg7CgkJaW52ID0gISFpbnY7CgoJCS8vIEdvIHRocm91Z2ggdGhlIGFycmF5LCBvbmx5IHNhdmluZyB0aGUgaXRlbXMKCQkvLyB0aGF0IHBhc3MgdGhlIHZhbGlkYXRvciBmdW5jdGlvbgoJCWZvciAoIDsgaSA8IGxlbmd0aDsgaSsrICkgewoJCQlyZXRWYWwgPSAhIWNhbGxiYWNrKCBlbGVtc1sgaSBdLCBpICk7CgkJCWlmICggaW52ICE9PSByZXRWYWwgKSB7CgkJCQlyZXQucHVzaCggZWxlbXNbIGkgXSApOwoJCQl9CgkJfQoKCQlyZXR1cm4gcmV0OwoJfSwKCgkvLyBhcmcgaXMgZm9yIGludGVybmFsIHVzYWdlIG9ubHkKCW1hcDogZnVuY3Rpb24oIGVsZW1zLCBjYWxsYmFjaywgYXJnICkgewoJCXZhciB2YWx1ZSwKCQkJaSA9IDAsCgkJCWxlbmd0aCA9IGVsZW1zLmxlbmd0aCwKCQkJaXNBcnJheSA9IGlzQXJyYXlsaWtlKCBlbGVtcyApLAoJCQlyZXQgPSBbXTsKCgkJLy8gR28gdGhyb3VnaCB0aGUgYXJyYXksIHRyYW5zbGF0aW5nIGVhY2ggb2YgdGhlIGl0ZW1zIHRvIHRoZWlyCgkJaWYgKCBpc0FycmF5ICkgewoJCQlmb3IgKCA7IGkgPCBsZW5ndGg7IGkrKyApIHsKCQkJCXZhbHVlID0gY2FsbGJhY2soIGVsZW1zWyBpIF0sIGksIGFyZyApOwoKCQkJCWlmICggdmFsdWUgIT0gbnVsbCApIHsKCQkJCQlyZXRbIHJldC5sZW5ndGggXSA9IHZhbHVlOwoJCQkJfQoJCQl9CgoJCS8vIEdvIHRocm91Z2ggZXZlcnkga2V5IG9uIHRoZSBvYmplY3QsCgkJfSBlbHNlIHsKCQkJZm9yICggaSBpbiBlbGVtcyApIHsKCQkJCXZhbHVlID0gY2FsbGJhY2soIGVsZW1zWyBpIF0sIGksIGFyZyApOwoKCQkJCWlmICggdmFsdWUgIT0gbnVsbCApIHsKCQkJCQlyZXRbIHJldC5sZW5ndGggXSA9IHZhbHVlOwoJCQkJfQoJCQl9CgkJfQoKCQkvLyBGbGF0dGVuIGFueSBuZXN0ZWQgYXJyYXlzCgkJcmV0dXJuIGNvcmVfY29uY2F0LmFwcGx5KCBbXSwgcmV0ICk7Cgl9LAoKCS8vIEEgZ2xvYmFsIEdVSUQgY291bnRlciBmb3Igb2JqZWN0cwoJZ3VpZDogMSwKCgkvLyBCaW5kIGEgZnVuY3Rpb24gdG8gYSBjb250ZXh0LCBvcHRpb25hbGx5IHBhcnRpYWxseSBhcHBseWluZyBhbnkKCS8vIGFyZ3VtZW50cy4KCXByb3h5OiBmdW5jdGlvbiggZm4sIGNvbnRleHQgKSB7CgkJdmFyIGFyZ3MsIHByb3h5LCB0bXA7CgoJCWlmICggdHlwZW9mIGNvbnRleHQgPT09ICJzdHJpbmciICkgewoJCQl0bXAgPSBmblsgY29udGV4dCBdOwoJCQljb250ZXh0ID0gZm47CgkJCWZuID0gdG1wOwoJCX0KCgkJLy8gUXVpY2sgY2hlY2sgdG8gZGV0ZXJtaW5lIGlmIHRhcmdldCBpcyBjYWxsYWJsZSwgaW4gdGhlIHNwZWMKCQkvLyB0aGlzIHRocm93cyBhIFR5cGVFcnJvciwgYnV0IHdlIHdpbGwganVzdCByZXR1cm4gdW5kZWZpbmVkLgoJCWlmICggIWpRdWVyeS5pc0Z1bmN0aW9uKCBmbiApICkgewoJCQlyZXR1cm4gdW5kZWZpbmVkOwoJCX0KCgkJLy8gU2ltdWxhdGVkIGJpbmQKCQlhcmdzID0gY29yZV9zbGljZS5jYWxsKCBhcmd1bWVudHMsIDIgKTsKCQlwcm94eSA9IGZ1bmN0aW9uKCkgewoJCQlyZXR1cm4gZm4uYXBwbHkoIGNvbnRleHQgfHwgdGhpcywgYXJncy5jb25jYXQoIGNvcmVfc2xpY2UuY2FsbCggYXJndW1lbnRzICkgKSApOwoJCX07CgoJCS8vIFNldCB0aGUgZ3VpZCBvZiB1bmlxdWUgaGFuZGxlciB0byB0aGUgc2FtZSBvZiBvcmlnaW5hbCBoYW5kbGVyLCBzbyBpdCBjYW4gYmUgcmVtb3ZlZAoJCXByb3h5Lmd1aWQgPSBmbi5ndWlkID0gZm4uZ3VpZCB8fCBqUXVlcnkuZ3VpZCsrOwoKCQlyZXR1cm4gcHJveHk7Cgl9LAoKCS8vIE11bHRpZnVuY3Rpb25hbCBtZXRob2QgdG8gZ2V0IGFuZCBzZXQgdmFsdWVzIG9mIGEgY29sbGVjdGlvbgoJLy8gVGhlIHZhbHVlL3MgY2FuIG9wdGlvbmFsbHkgYmUgZXhlY3V0ZWQgaWYgaXQncyBhIGZ1bmN0aW9uCglhY2Nlc3M6IGZ1bmN0aW9uKCBlbGVtcywgZm4sIGtleSwgdmFsdWUsIGNoYWluYWJsZSwgZW1wdHlHZXQsIHJhdyApIHsKCQl2YXIgaSA9IDAsCgkJCWxlbmd0aCA9IGVsZW1zLmxlbmd0aCwKCQkJYnVsayA9IGtleSA9PSBudWxsOwoKCQkvLyBTZXRzIG1hbnkgdmFsdWVzCgkJaWYgKCBqUXVlcnkudHlwZSgga2V5ICkgPT09ICJvYmplY3QiICkgewoJCQljaGFpbmFibGUgPSB0cnVlOwoJCQlmb3IgKCBpIGluIGtleSApIHsKCQkJCWpRdWVyeS5hY2Nlc3MoIGVsZW1zLCBmbiwgaSwga2V5W2ldLCB0cnVlLCBlbXB0eUdldCwgcmF3ICk7CgkJCX0KCgkJLy8gU2V0cyBvbmUgdmFsdWUKCQl9IGVsc2UgaWYgKCB2YWx1ZSAhPT0gdW5kZWZpbmVkICkgewoJCQljaGFpbmFibGUgPSB0cnVlOwoKCQkJaWYgKCAhalF1ZXJ5LmlzRnVuY3Rpb24oIHZhbHVlICkgKSB7CgkJCQlyYXcgPSB0cnVlOwoJCQl9CgoJCQlpZiAoIGJ1bGsgKSB7CgkJCQkvLyBCdWxrIG9wZXJhdGlvbnMgcnVuIGFnYWluc3QgdGhlIGVudGlyZSBzZXQKCQkJCWlmICggcmF3ICkgewoJCQkJCWZuLmNhbGwoIGVsZW1zLCB2YWx1ZSApOwoJCQkJCWZuID0gbnVsbDsKCgkJCQkvLyAuLi5leGNlcHQgd2hlbiBleGVjdXRpbmcgZnVuY3Rpb24gdmFsdWVzCgkJCQl9IGVsc2UgewoJCQkJCWJ1bGsgPSBmbjsKCQkJCQlmbiA9IGZ1bmN0aW9uKCBlbGVtLCBrZXksIHZhbHVlICkgewoJCQkJCQlyZXR1cm4gYnVsay5jYWxsKCBqUXVlcnkoIGVsZW0gKSwgdmFsdWUgKTsKCQkJCQl9OwoJCQkJfQoJCQl9CgoJCQlpZiAoIGZuICkgewoJCQkJZm9yICggOyBpIDwgbGVuZ3RoOyBpKysgKSB7CgkJCQkJZm4oIGVsZW1zW2ldLCBrZXksIHJhdyA/IHZhbHVlIDogdmFsdWUuY2FsbCggZWxlbXNbaV0sIGksIGZuKCBlbGVtc1tpXSwga2V5ICkgKSApOwoJCQkJfQoJCQl9CgkJfQoKCQlyZXR1cm4gY2hhaW5hYmxlID8KCQkJZWxlbXMgOgoKCQkJLy8gR2V0cwoJCQlidWxrID8KCQkJCWZuLmNhbGwoIGVsZW1zICkgOgoJCQkJbGVuZ3RoID8gZm4oIGVsZW1zWzBdLCBrZXkgKSA6IGVtcHR5R2V0OwoJfSwKCglub3c6IGZ1bmN0aW9uKCkgewoJCXJldHVybiAoIG5ldyBEYXRlKCkgKS5nZXRUaW1lKCk7Cgl9Cn0pOwoKalF1ZXJ5LnJlYWR5LnByb21pc2UgPSBmdW5jdGlvbiggb2JqICkgewoJaWYgKCAhcmVhZHlMaXN0ICkgewoKCQlyZWFkeUxpc3QgPSBqUXVlcnkuRGVmZXJyZWQoKTsKCgkJLy8gQ2F0Y2ggY2FzZXMgd2hlcmUgJChkb2N1bWVudCkucmVhZHkoKSBpcyBjYWxsZWQgYWZ0ZXIgdGhlIGJyb3dzZXIgZXZlbnQgaGFzIGFscmVhZHkgb2NjdXJyZWQuCgkJLy8gd2Ugb25jZSB0cmllZCB0byB1c2UgcmVhZHlTdGF0ZSAiaW50ZXJhY3RpdmUiIGhlcmUsIGJ1dCBpdCBjYXVzZWQgaXNzdWVzIGxpa2UgdGhlIG9uZQoJCS8vIGRpc2NvdmVyZWQgYnkgQ2hyaXNTIGhlcmU6IGh0dHA6Ly9idWdzLmpxdWVyeS5jb20vdGlja2V0LzEyMjgyI2NvbW1lbnQ6MTUKCQlpZiAoIGRvY3VtZW50LnJlYWR5U3RhdGUgPT09ICJjb21wbGV0ZSIgKSB7CgkJCS8vIEhhbmRsZSBpdCBhc3luY2hyb25vdXNseSB0byBhbGxvdyBzY3JpcHRzIHRoZSBvcHBvcnR1bml0eSB0byBkZWxheSByZWFkeQoJCQlzZXRUaW1lb3V0KCBqUXVlcnkucmVhZHkgKTsKCgkJLy8gU3RhbmRhcmRzLWJhc2VkIGJyb3dzZXJzIHN1cHBvcnQgRE9NQ29udGVudExvYWRlZAoJCX0gZWxzZSBpZiAoIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIgKSB7CgkJCS8vIFVzZSB0aGUgaGFuZHkgZXZlbnQgY2FsbGJhY2sKCQkJZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lciggIkRPTUNvbnRlbnRMb2FkZWQiLCBjb21wbGV0ZWQsIGZhbHNlICk7CgoJCQkvLyBBIGZhbGxiYWNrIHRvIHdpbmRvdy5vbmxvYWQsIHRoYXQgd2lsbCBhbHdheXMgd29yawoJCQl3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lciggImxvYWQiLCBjb21wbGV0ZWQsIGZhbHNlICk7CgoJCS8vIElmIElFIGV2ZW50IG1vZGVsIGlzIHVzZWQKCQl9IGVsc2UgewoJCQkvLyBFbnN1cmUgZmlyaW5nIGJlZm9yZSBvbmxvYWQsIG1heWJlIGxhdGUgYnV0IHNhZmUgYWxzbyBmb3IgaWZyYW1lcwoJCQlkb2N1bWVudC5hdHRhY2hFdmVudCggIm9ucmVhZHlzdGF0ZWNoYW5nZSIsIGNvbXBsZXRlZCApOwoKCQkJLy8gQSBmYWxsYmFjayB0byB3aW5kb3cub25sb2FkLCB0aGF0IHdpbGwgYWx3YXlzIHdvcmsKCQkJd2luZG93LmF0dGFjaEV2ZW50KCAib25sb2FkIiwgY29tcGxldGVkICk7CgoJCQkvLyBJZiBJRSBhbmQgbm90IGEgZnJhbWUKCQkJLy8gY29udGludWFsbHkgY2hlY2sgdG8gc2VlIGlmIHRoZSBkb2N1bWVudCBpcyByZWFkeQoJCQl2YXIgdG9wID0gZmFsc2U7CgoJCQl0cnkgewoJCQkJdG9wID0gd2luZG93LmZyYW1lRWxlbWVudCA9PSBudWxsICYmIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDsKCQkJfSBjYXRjaChlKSB7fQoKCQkJaWYgKCB0b3AgJiYgdG9wLmRvU2Nyb2xsICkgewoJCQkJKGZ1bmN0aW9uIGRvU2Nyb2xsQ2hlY2soKSB7CgkJCQkJaWYgKCAhalF1ZXJ5LmlzUmVhZHkgKSB7CgoJCQkJCQl0cnkgewoJCQkJCQkJLy8gVXNlIHRoZSB0cmljayBieSBEaWVnbyBQZXJpbmkKCQkJCQkJCS8vIGh0dHA6Ly9qYXZhc2NyaXB0Lm53Ym94LmNvbS9JRUNvbnRlbnRMb2FkZWQvCgkJCQkJCQl0b3AuZG9TY3JvbGwoImxlZnQiKTsKCQkJCQkJfSBjYXRjaChlKSB7CgkJCQkJCQlyZXR1cm4gc2V0VGltZW91dCggZG9TY3JvbGxDaGVjaywgNTAgKTsKCQkJCQkJfQoKCQkJCQkJLy8gZGV0YWNoIGFsbCBkb20gcmVhZHkgZXZlbnRzCgkJCQkJCWRldGFjaCgpOwoKCQkJCQkJLy8gYW5kIGV4ZWN1dGUgYW55IHdhaXRpbmcgZnVuY3Rpb25zCgkJCQkJCWpRdWVyeS5yZWFkeSgpOwoJCQkJCX0KCQkJCX0pKCk7CgkJCX0KCQl9Cgl9CglyZXR1cm4gcmVhZHlMaXN0LnByb21pc2UoIG9iaiApOwp9OwoKLy8gUG9wdWxhdGUgdGhlIGNsYXNzMnR5cGUgbWFwCmpRdWVyeS5lYWNoKCJCb29sZWFuIE51bWJlciBTdHJpbmcgRnVuY3Rpb24gQXJyYXkgRGF0ZSBSZWdFeHAgT2JqZWN0IEVycm9yIi5zcGxpdCgiICIpLCBmdW5jdGlvbihpLCBuYW1lKSB7CgljbGFzczJ0eXBlWyAiW29iamVjdCAiICsgbmFtZSArICJdIiBdID0gbmFtZS50b0xvd2VyQ2FzZSgpOwp9KTsKCmZ1bmN0aW9uIGlzQXJyYXlsaWtlKCBvYmogKSB7Cgl2YXIgbGVuZ3RoID0gb2JqLmxlbmd0aCwKCQl0eXBlID0galF1ZXJ5LnR5cGUoIG9iaiApOwoKCWlmICggalF1ZXJ5LmlzV2luZG93KCBvYmogKSApIHsKCQlyZXR1cm4gZmFsc2U7Cgl9CgoJaWYgKCBvYmoubm9kZVR5cGUgPT09IDEgJiYgbGVuZ3RoICkgewoJCXJldHVybiB0cnVlOwoJfQoKCXJldHVybiB0eXBlID09PSAiYXJyYXkiIHx8IHR5cGUgIT09ICJmdW5jdGlvbiIgJiYKCQkoIGxlbmd0aCA9PT0gMCB8fAoJCXR5cGVvZiBsZW5ndGggPT09ICJudW1iZXIiICYmIGxlbmd0aCA+IDAgJiYgKCBsZW5ndGggLSAxICkgaW4gb2JqICk7Cn0KCi8vIEFsbCBqUXVlcnkgb2JqZWN0cyBzaG91bGQgcG9pbnQgYmFjayB0byB0aGVzZQpyb290alF1ZXJ5ID0galF1ZXJ5KGRvY3VtZW50KTsKLy8gU3RyaW5nIHRvIE9iamVjdCBvcHRpb25zIGZvcm1hdCBjYWNoZQp2YXIgb3B0aW9uc0NhY2hlID0ge307CgovLyBDb252ZXJ0IFN0cmluZy1mb3JtYXR0ZWQgb3B0aW9ucyBpbnRvIE9iamVjdC1mb3JtYXR0ZWQgb25lcyBhbmQgc3RvcmUgaW4gY2FjaGUKZnVuY3Rpb24gY3JlYXRlT3B0aW9ucyggb3B0aW9ucyApIHsKCXZhciBvYmplY3QgPSBvcHRpb25zQ2FjaGVbIG9wdGlvbnMgXSA9IHt9OwoJalF1ZXJ5LmVhY2goIG9wdGlvbnMubWF0Y2goIGNvcmVfcm5vdHdoaXRlICkgfHwgW10sIGZ1bmN0aW9uKCBfLCBmbGFnICkgewoJCW9iamVjdFsgZmxhZyBdID0gdHJ1ZTsKCX0pOwoJcmV0dXJuIG9iamVjdDsKfQoKLyoKICogQ3JlYXRlIGEgY2FsbGJhY2sgbGlzdCB1c2luZyB0aGUgZm9sbG93aW5nIHBhcmFtZXRlcnM6CiAqCiAqCW9wdGlvbnM6IGFuIG9wdGlvbmFsIGxpc3Qgb2Ygc3BhY2Utc2VwYXJhdGVkIG9wdGlvbnMgdGhhdCB3aWxsIGNoYW5nZSBob3cKICoJCQl0aGUgY2FsbGJhY2sgbGlzdCBiZWhhdmVzIG9yIGEgbW9yZSB0cmFkaXRpb25hbCBvcHRpb24gb2JqZWN0CiAqCiAqIEJ5IGRlZmF1bHQgYSBjYWxsYmFjayBsaXN0IHdpbGwgYWN0IGxpa2UgYW4gZXZlbnQgY2FsbGJhY2sgbGlzdCBhbmQgY2FuIGJlCiAqICJmaXJlZCIgbXVsdGlwbGUgdGltZXMuCiAqCiAqIFBvc3NpYmxlIG9wdGlvbnM6CiAqCiAqCW9uY2U6CQkJd2lsbCBlbnN1cmUgdGhlIGNhbGxiYWNrIGxpc3QgY2FuIG9ubHkgYmUgZmlyZWQgb25jZSAobGlrZSBhIERlZmVycmVkKQogKgogKgltZW1vcnk6CQkJd2lsbCBrZWVwIHRyYWNrIG9mIHByZXZpb3VzIHZhbHVlcyBhbmQgd2lsbCBjYWxsIGFueSBjYWxsYmFjayBhZGRlZAogKgkJCQkJYWZ0ZXIgdGhlIGxpc3QgaGFzIGJlZW4gZmlyZWQgcmlnaHQgYXdheSB3aXRoIHRoZSBsYXRlc3QgIm1lbW9yaXplZCIKICoJCQkJCXZhbHVlcyAobGlrZSBhIERlZmVycmVkKQogKgogKgl1bmlxdWU6CQkJd2lsbCBlbnN1cmUgYSBjYWxsYmFjayBjYW4gb25seSBiZSBhZGRlZCBvbmNlIChubyBkdXBsaWNhdGUgaW4gdGhlIGxpc3QpCiAqCiAqCXN0b3BPbkZhbHNlOglpbnRlcnJ1cHQgY2FsbGluZ3Mgd2hlbiBhIGNhbGxiYWNrIHJldHVybnMgZmFsc2UKICoKICovCmpRdWVyeS5DYWxsYmFja3MgPSBmdW5jdGlvbiggb3B0aW9ucyApIHsKCgkvLyBDb252ZXJ0IG9wdGlvbnMgZnJvbSBTdHJpbmctZm9ybWF0dGVkIHRvIE9iamVjdC1mb3JtYXR0ZWQgaWYgbmVlZGVkCgkvLyAod2UgY2hlY2sgaW4gY2FjaGUgZmlyc3QpCglvcHRpb25zID0gdHlwZW9mIG9wdGlvbnMgPT09ICJzdHJpbmciID8KCQkoIG9wdGlvbnNDYWNoZVsgb3B0aW9ucyBdIHx8IGNyZWF0ZU9wdGlvbnMoIG9wdGlvbnMgKSApIDoKCQlqUXVlcnkuZXh0ZW5kKCB7fSwgb3B0aW9ucyApOwoKCXZhciAvLyBGbGFnIHRvIGtub3cgaWYgbGlzdCBpcyBjdXJyZW50bHkgZmlyaW5nCgkJZmlyaW5nLAoJCS8vIExhc3QgZmlyZSB2YWx1ZSAoZm9yIG5vbi1mb3JnZXR0YWJsZSBsaXN0cykKCQltZW1vcnksCgkJLy8gRmxhZyB0byBrbm93IGlmIGxpc3Qgd2FzIGFscmVhZHkgZmlyZWQKCQlmaXJlZCwKCQkvLyBFbmQgb2YgdGhlIGxvb3Agd2hlbiBmaXJpbmcKCQlmaXJpbmdMZW5ndGgsCgkJLy8gSW5kZXggb2YgY3VycmVudGx5IGZpcmluZyBjYWxsYmFjayAobW9kaWZpZWQgYnkgcmVtb3ZlIGlmIG5lZWRlZCkKCQlmaXJpbmdJbmRleCwKCQkvLyBGaXJzdCBjYWxsYmFjayB0byBmaXJlICh1c2VkIGludGVybmFsbHkgYnkgYWRkIGFuZCBmaXJlV2l0aCkKCQlmaXJpbmdTdGFydCwKCQkvLyBBY3R1YWwgY2FsbGJhY2sgbGlzdAoJCWxpc3QgPSBbXSwKCQkvLyBTdGFjayBvZiBmaXJlIGNhbGxzIGZvciByZXBlYXRhYmxlIGxpc3RzCgkJc3RhY2sgPSAhb3B0aW9ucy5vbmNlICYmIFtdLAoJCS8vIEZpcmUgY2FsbGJhY2tzCgkJZmlyZSA9IGZ1bmN0aW9uKCBkYXRhICkgewoJCQltZW1vcnkgPSBvcHRpb25zLm1lbW9yeSAmJiBkYXRhOwoJCQlmaXJlZCA9IHRydWU7CgkJCWZpcmluZ0luZGV4ID0gZmlyaW5nU3RhcnQgfHwgMDsKCQkJZmlyaW5nU3RhcnQgPSAwOwoJCQlmaXJpbmdMZW5ndGggPSBsaXN0Lmxlbmd0aDsKCQkJZmlyaW5nID0gdHJ1ZTsKCQkJZm9yICggOyBsaXN0ICYmIGZpcmluZ0luZGV4IDwgZmlyaW5nTGVuZ3RoOyBmaXJpbmdJbmRleCsrICkgewoJCQkJaWYgKCBsaXN0WyBmaXJpbmdJbmRleCBdLmFwcGx5KCBkYXRhWyAwIF0sIGRhdGFbIDEgXSApID09PSBmYWxzZSAmJiBvcHRpb25zLnN0b3BPbkZhbHNlICkgewoJCQkJCW1lbW9yeSA9IGZhbHNlOyAvLyBUbyBwcmV2ZW50IGZ1cnRoZXIgY2FsbHMgdXNpbmcgYWRkCgkJCQkJYnJlYWs7CgkJCQl9CgkJCX0KCQkJZmlyaW5nID0gZmFsc2U7CgkJCWlmICggbGlzdCApIHsKCQkJCWlmICggc3RhY2sgKSB7CgkJCQkJaWYgKCBzdGFjay5sZW5ndGggKSB7CgkJCQkJCWZpcmUoIHN0YWNrLnNoaWZ0KCkgKTsKCQkJCQl9CgkJCQl9IGVsc2UgaWYgKCBtZW1vcnkgKSB7CgkJCQkJbGlzdCA9IFtdOwoJCQkJfSBlbHNlIHsKCQkJCQlzZWxmLmRpc2FibGUoKTsKCQkJCX0KCQkJfQoJCX0sCgkJLy8gQWN0dWFsIENhbGxiYWNrcyBvYmplY3QKCQlzZWxmID0gewoJCQkvLyBBZGQgYSBjYWxsYmFjayBvciBhIGNvbGxlY3Rpb24gb2YgY2FsbGJhY2tzIHRvIHRoZSBsaXN0CgkJCWFkZDogZnVuY3Rpb24oKSB7CgkJCQlpZiAoIGxpc3QgKSB7CgkJCQkJLy8gRmlyc3QsIHdlIHNhdmUgdGhlIGN1cnJlbnQgbGVuZ3RoCgkJCQkJdmFyIHN0YXJ0ID0gbGlzdC5sZW5ndGg7CgkJCQkJKGZ1bmN0aW9uIGFkZCggYXJncyApIHsKCQkJCQkJalF1ZXJ5LmVhY2goIGFyZ3MsIGZ1bmN0aW9uKCBfLCBhcmcgKSB7CgkJCQkJCQl2YXIgdHlwZSA9IGpRdWVyeS50eXBlKCBhcmcgKTsKCQkJCQkJCWlmICggdHlwZSA9PT0gImZ1bmN0aW9uIiApIHsKCQkJCQkJCQlpZiAoICFvcHRpb25zLnVuaXF1ZSB8fCAhc2VsZi5oYXMoIGFyZyApICkgewoJCQkJCQkJCQlsaXN0LnB1c2goIGFyZyApOwoJCQkJCQkJCX0KCQkJCQkJCX0gZWxzZSBpZiAoIGFyZyAmJiBhcmcubGVuZ3RoICYmIHR5cGUgIT09ICJzdHJpbmciICkgewoJCQkJCQkJCS8vIEluc3BlY3QgcmVjdXJzaXZlbHkKCQkJCQkJCQlhZGQoIGFyZyApOwoJCQkJCQkJfQoJCQkJCQl9KTsKCQkJCQl9KSggYXJndW1lbnRzICk7CgkJCQkJLy8gRG8gd2UgbmVlZCB0byBhZGQgdGhlIGNhbGxiYWNrcyB0byB0aGUKCQkJCQkvLyBjdXJyZW50IGZpcmluZyBiYXRjaD8KCQkJCQlpZiAoIGZpcmluZyApIHsKCQkJCQkJZmlyaW5nTGVuZ3RoID0gbGlzdC5sZW5ndGg7CgkJCQkJLy8gV2l0aCBtZW1vcnksIGlmIHdlJ3JlIG5vdCBmaXJpbmcgdGhlbgoJCQkJCS8vIHdlIHNob3VsZCBjYWxsIHJpZ2h0IGF3YXkKCQkJCQl9IGVsc2UgaWYgKCBtZW1vcnkgKSB7CgkJCQkJCWZpcmluZ1N0YXJ0ID0gc3RhcnQ7CgkJCQkJCWZpcmUoIG1lbW9yeSApOwoJCQkJCX0KCQkJCX0KCQkJCXJldHVybiB0aGlzOwoJCQl9LAoJCQkvLyBSZW1vdmUgYSBjYWxsYmFjayBmcm9tIHRoZSBsaXN0CgkJCXJlbW92ZTogZnVuY3Rpb24oKSB7CgkJCQlpZiAoIGxpc3QgKSB7CgkJCQkJalF1ZXJ5LmVhY2goIGFyZ3VtZW50cywgZnVuY3Rpb24oIF8sIGFyZyApIHsKCQkJCQkJdmFyIGluZGV4OwoJCQkJCQl3aGlsZSggKCBpbmRleCA9IGpRdWVyeS5pbkFycmF5KCBhcmcsIGxpc3QsIGluZGV4ICkgKSA+IC0xICkgewoJCQkJCQkJbGlzdC5zcGxpY2UoIGluZGV4LCAxICk7CgkJCQkJCQkvLyBIYW5kbGUgZmlyaW5nIGluZGV4ZXMKCQkJCQkJCWlmICggZmlyaW5nICkgewoJCQkJCQkJCWlmICggaW5kZXggPD0gZmlyaW5nTGVuZ3RoICkgewoJCQkJCQkJCQlmaXJpbmdMZW5ndGgtLTsKCQkJCQkJCQl9CgkJCQkJCQkJaWYgKCBpbmRleCA8PSBmaXJpbmdJbmRleCApIHsKCQkJCQkJCQkJZmlyaW5nSW5kZXgtLTsKCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9KTsKCQkJCX0KCQkJCXJldHVybiB0aGlzOwoJCQl9LAoJCQkvLyBDaGVjayBpZiBhIGdpdmVuIGNhbGxiYWNrIGlzIGluIHRoZSBsaXN0LgoJCQkvLyBJZiBubyBhcmd1bWVudCBpcyBnaXZlbiwgcmV0dXJuIHdoZXRoZXIgb3Igbm90IGxpc3QgaGFzIGNhbGxiYWNrcyBhdHRhY2hlZC4KCQkJaGFzOiBmdW5jdGlvbiggZm4gKSB7CgkJCQlyZXR1cm4gZm4gPyBqUXVlcnkuaW5BcnJheSggZm4sIGxpc3QgKSA+IC0xIDogISEoIGxpc3QgJiYgbGlzdC5sZW5ndGggKTsKCQkJfSwKCQkJLy8gUmVtb3ZlIGFsbCBjYWxsYmFja3MgZnJvbSB0aGUgbGlzdAoJCQllbXB0eTogZnVuY3Rpb24oKSB7CgkJCQlsaXN0ID0gW107CgkJCQlyZXR1cm4gdGhpczsKCQkJfSwKCQkJLy8gSGF2ZSB0aGUgbGlzdCBkbyBub3RoaW5nIGFueW1vcmUKCQkJZGlzYWJsZTogZnVuY3Rpb24oKSB7CgkJCQlsaXN0ID0gc3RhY2sgPSBtZW1vcnkgPSB1bmRlZmluZWQ7CgkJCQlyZXR1cm4gdGhpczsKCQkJfSwKCQkJLy8gSXMgaXQgZGlzYWJsZWQ/CgkJCWRpc2FibGVkOiBmdW5jdGlvbigpIHsKCQkJCXJldHVybiAhbGlzdDsKCQkJfSwKCQkJLy8gTG9jayB0aGUgbGlzdCBpbiBpdHMgY3VycmVudCBzdGF0ZQoJCQlsb2NrOiBmdW5jdGlvbigpIHsKCQkJCXN0YWNrID0gdW5kZWZpbmVkOwoJCQkJaWYgKCAhbWVtb3J5ICkgewoJCQkJCXNlbGYuZGlzYWJsZSgpOwoJCQkJfQoJCQkJcmV0dXJuIHRoaXM7CgkJCX0sCgkJCS8vIElzIGl0IGxvY2tlZD8KCQkJbG9ja2VkOiBmdW5jdGlvbigpIHsKCQkJCXJldHVybiAhc3RhY2s7CgkJCX0sCgkJCS8vIENhbGwgYWxsIGNhbGxiYWNrcyB3aXRoIHRoZSBnaXZlbiBjb250ZXh0IGFuZCBhcmd1bWVudHMKCQkJZmlyZVdpdGg6IGZ1bmN0aW9uKCBjb250ZXh0LCBhcmdzICkgewoJCQkJYXJncyA9IGFyZ3MgfHwgW107CgkJCQlhcmdzID0gWyBjb250ZXh0LCBhcmdzLnNsaWNlID8gYXJncy5zbGljZSgpIDogYXJncyBdOwoJCQkJaWYgKCBsaXN0ICYmICggIWZpcmVkIHx8IHN0YWNrICkgKSB7CgkJCQkJaWYgKCBmaXJpbmcgKSB7CgkJCQkJCXN0YWNrLnB1c2goIGFyZ3MgKTsKCQkJCQl9IGVsc2UgewoJCQkJCQlmaXJlKCBhcmdzICk7CgkJCQkJfQoJCQkJfQoJCQkJcmV0dXJuIHRoaXM7CgkJCX0sCgkJCS8vIENhbGwgYWxsIHRoZSBjYWxsYmFja3Mgd2l0aCB0aGUgZ2l2ZW4gYXJndW1lbnRzCgkJCWZpcmU6IGZ1bmN0aW9uKCkgewoJCQkJc2VsZi5maXJlV2l0aCggdGhpcywgYXJndW1lbnRzICk7CgkJCQlyZXR1cm4gdGhpczsKCQkJfSwKCQkJLy8gVG8ga25vdyBpZiB0aGUgY2FsbGJhY2tzIGhhdmUgYWxyZWFkeSBiZWVuIGNhbGxlZCBhdCBsZWFzdCBvbmNlCgkJCWZpcmVkOiBmdW5jdGlvbigpIHsKCQkJCXJldHVybiAhIWZpcmVkOwoJCQl9CgkJfTsKCglyZXR1cm4gc2VsZjsKfTsKalF1ZXJ5LmV4dGVuZCh7CgoJRGVmZXJyZWQ6IGZ1bmN0aW9uKCBmdW5jICkgewoJCXZhciB0dXBsZXMgPSBbCgkJCQkvLyBhY3Rpb24sIGFkZCBsaXN0ZW5lciwgbGlzdGVuZXIgbGlzdCwgZmluYWwgc3RhdGUKCQkJCVsgInJlc29sdmUiLCAiZG9uZSIsIGpRdWVyeS5DYWxsYmFja3MoIm9uY2UgbWVtb3J5IiksICJyZXNvbHZlZCIgXSwKCQkJCVsgInJlamVjdCIsICJmYWlsIiwgalF1ZXJ5LkNhbGxiYWNrcygib25jZSBtZW1vcnkiKSwgInJlamVjdGVkIiBdLAoJCQkJWyAibm90aWZ5IiwgInByb2dyZXNzIiwgalF1ZXJ5LkNhbGxiYWNrcygibWVtb3J5IikgXQoJCQldLAoJCQlzdGF0ZSA9ICJwZW5kaW5nIiwKCQkJcHJvbWlzZSA9IHsKCQkJCXN0YXRlOiBmdW5jdGlvbigpIHsKCQkJCQlyZXR1cm4gc3RhdGU7CgkJCQl9LAoJCQkJYWx3YXlzOiBmdW5jdGlvbigpIHsKCQkJCQlkZWZlcnJlZC5kb25lKCBhcmd1bWVudHMgKS5mYWlsKCBhcmd1bWVudHMgKTsKCQkJCQlyZXR1cm4gdGhpczsKCQkJCX0sCgkJCQl0aGVuOiBmdW5jdGlvbiggLyogZm5Eb25lLCBmbkZhaWwsIGZuUHJvZ3Jlc3MgKi8gKSB7CgkJCQkJdmFyIGZucyA9IGFyZ3VtZW50czsKCQkJCQlyZXR1cm4galF1ZXJ5LkRlZmVycmVkKGZ1bmN0aW9uKCBuZXdEZWZlciApIHsKCQkJCQkJalF1ZXJ5LmVhY2goIHR1cGxlcywgZnVuY3Rpb24oIGksIHR1cGxlICkgewoJCQkJCQkJdmFyIGFjdGlvbiA9IHR1cGxlWyAwIF0sCgkJCQkJCQkJZm4gPSBqUXVlcnkuaXNGdW5jdGlvbiggZm5zWyBpIF0gKSAmJiBmbnNbIGkgXTsKCQkJCQkJCS8vIGRlZmVycmVkWyBkb25lIHwgZmFpbCB8IHByb2dyZXNzIF0gZm9yIGZvcndhcmRpbmcgYWN0aW9ucyB0byBuZXdEZWZlcgoJCQkJCQkJZGVmZXJyZWRbIHR1cGxlWzFdIF0oZnVuY3Rpb24oKSB7CgkJCQkJCQkJdmFyIHJldHVybmVkID0gZm4gJiYgZm4uYXBwbHkoIHRoaXMsIGFyZ3VtZW50cyApOwoJCQkJCQkJCWlmICggcmV0dXJuZWQgJiYgalF1ZXJ5LmlzRnVuY3Rpb24oIHJldHVybmVkLnByb21pc2UgKSApIHsKCQkJCQkJCQkJcmV0dXJuZWQucHJvbWlzZSgpCgkJCQkJCQkJCQkuZG9uZSggbmV3RGVmZXIucmVzb2x2ZSApCgkJCQkJCQkJCQkuZmFpbCggbmV3RGVmZXIucmVqZWN0ICkKCQkJCQkJCQkJCS5wcm9ncmVzcyggbmV3RGVmZXIubm90aWZ5ICk7CgkJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkJbmV3RGVmZXJbIGFjdGlvbiArICJXaXRoIiBdKCB0aGlzID09PSBwcm9taXNlID8gbmV3RGVmZXIucHJvbWlzZSgpIDogdGhpcywgZm4gPyBbIHJldHVybmVkIF0gOiBhcmd1bWVudHMgKTsKCQkJCQkJCQl9CgkJCQkJCQl9KTsKCQkJCQkJfSk7CgkJCQkJCWZucyA9IG51bGw7CgkJCQkJfSkucHJvbWlzZSgpOwoJCQkJfSwKCQkJCS8vIEdldCBhIHByb21pc2UgZm9yIHRoaXMgZGVmZXJyZWQKCQkJCS8vIElmIG9iaiBpcyBwcm92aWRlZCwgdGhlIHByb21pc2UgYXNwZWN0IGlzIGFkZGVkIHRvIHRoZSBvYmplY3QKCQkJCXByb21pc2U6IGZ1bmN0aW9uKCBvYmogKSB7CgkJCQkJcmV0dXJuIG9iaiAhPSBudWxsID8galF1ZXJ5LmV4dGVuZCggb2JqLCBwcm9taXNlICkgOiBwcm9taXNlOwoJCQkJfQoJCQl9LAoJCQlkZWZlcnJlZCA9IHt9OwoKCQkvLyBLZWVwIHBpcGUgZm9yIGJhY2stY29tcGF0CgkJcHJvbWlzZS5waXBlID0gcHJvbWlzZS50aGVuOwoKCQkvLyBBZGQgbGlzdC1zcGVjaWZpYyBtZXRob2RzCgkJalF1ZXJ5LmVhY2goIHR1cGxlcywgZnVuY3Rpb24oIGksIHR1cGxlICkgewoJCQl2YXIgbGlzdCA9IHR1cGxlWyAyIF0sCgkJCQlzdGF0ZVN0cmluZyA9IHR1cGxlWyAzIF07CgoJCQkvLyBwcm9taXNlWyBkb25lIHwgZmFpbCB8IHByb2dyZXNzIF0gPSBsaXN0LmFkZAoJCQlwcm9taXNlWyB0dXBsZVsxXSBdID0gbGlzdC5hZGQ7CgoJCQkvLyBIYW5kbGUgc3RhdGUKCQkJaWYgKCBzdGF0ZVN0cmluZyApIHsKCQkJCWxpc3QuYWRkKGZ1bmN0aW9uKCkgewoJCQkJCS8vIHN0YXRlID0gWyByZXNvbHZlZCB8IHJlamVjdGVkIF0KCQkJCQlzdGF0ZSA9IHN0YXRlU3RyaW5nOwoKCQkJCS8vIFsgcmVqZWN0X2xpc3QgfCByZXNvbHZlX2xpc3QgXS5kaXNhYmxlOyBwcm9ncmVzc19saXN0LmxvY2sKCQkJCX0sIHR1cGxlc1sgaSBeIDEgXVsgMiBdLmRpc2FibGUsIHR1cGxlc1sgMiBdWyAyIF0ubG9jayApOwoJCQl9CgoJCQkvLyBkZWZlcnJlZFsgcmVzb2x2ZSB8IHJlamVjdCB8IG5vdGlmeSBdCgkJCWRlZmVycmVkWyB0dXBsZVswXSBdID0gZnVuY3Rpb24oKSB7CgkJCQlkZWZlcnJlZFsgdHVwbGVbMF0gKyAiV2l0aCIgXSggdGhpcyA9PT0gZGVmZXJyZWQgPyBwcm9taXNlIDogdGhpcywgYXJndW1lbnRzICk7CgkJCQlyZXR1cm4gdGhpczsKCQkJfTsKCQkJZGVmZXJyZWRbIHR1cGxlWzBdICsgIldpdGgiIF0gPSBsaXN0LmZpcmVXaXRoOwoJCX0pOwoKCQkvLyBNYWtlIHRoZSBkZWZlcnJlZCBhIHByb21pc2UKCQlwcm9taXNlLnByb21pc2UoIGRlZmVycmVkICk7CgoJCS8vIENhbGwgZ2l2ZW4gZnVuYyBpZiBhbnkKCQlpZiAoIGZ1bmMgKSB7CgkJCWZ1bmMuY2FsbCggZGVmZXJyZWQsIGRlZmVycmVkICk7CgkJfQoKCQkvLyBBbGwgZG9uZSEKCQlyZXR1cm4gZGVmZXJyZWQ7Cgl9LAoKCS8vIERlZmVycmVkIGhlbHBlcgoJd2hlbjogZnVuY3Rpb24oIHN1Ym9yZGluYXRlIC8qICwgLi4uLCBzdWJvcmRpbmF0ZU4gKi8gKSB7CgkJdmFyIGkgPSAwLAoJCQlyZXNvbHZlVmFsdWVzID0gY29yZV9zbGljZS5jYWxsKCBhcmd1bWVudHMgKSwKCQkJbGVuZ3RoID0gcmVzb2x2ZVZhbHVlcy5sZW5ndGgsCgoJCQkvLyB0aGUgY291bnQgb2YgdW5jb21wbGV0ZWQgc3Vib3JkaW5hdGVzCgkJCXJlbWFpbmluZyA9IGxlbmd0aCAhPT0gMSB8fCAoIHN1Ym9yZGluYXRlICYmIGpRdWVyeS5pc0Z1bmN0aW9uKCBzdWJvcmRpbmF0ZS5wcm9taXNlICkgKSA/IGxlbmd0aCA6IDAsCgoJCQkvLyB0aGUgbWFzdGVyIERlZmVycmVkLiBJZiByZXNvbHZlVmFsdWVzIGNvbnNpc3Qgb2Ygb25seSBhIHNpbmdsZSBEZWZlcnJlZCwganVzdCB1c2UgdGhhdC4KCQkJZGVmZXJyZWQgPSByZW1haW5pbmcgPT09IDEgPyBzdWJvcmRpbmF0ZSA6IGpRdWVyeS5EZWZlcnJlZCgpLAoKCQkJLy8gVXBkYXRlIGZ1bmN0aW9uIGZvciBib3RoIHJlc29sdmUgYW5kIHByb2dyZXNzIHZhbHVlcwoJCQl1cGRhdGVGdW5jID0gZnVuY3Rpb24oIGksIGNvbnRleHRzLCB2YWx1ZXMgKSB7CgkJCQlyZXR1cm4gZnVuY3Rpb24oIHZhbHVlICkgewoJCQkJCWNvbnRleHRzWyBpIF0gPSB0aGlzOwoJCQkJCXZhbHVlc1sgaSBdID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBjb3JlX3NsaWNlLmNhbGwoIGFyZ3VtZW50cyApIDogdmFsdWU7CgkJCQkJaWYoIHZhbHVlcyA9PT0gcHJvZ3Jlc3NWYWx1ZXMgKSB7CgkJCQkJCWRlZmVycmVkLm5vdGlmeVdpdGgoIGNvbnRleHRzLCB2YWx1ZXMgKTsKCQkJCQl9IGVsc2UgaWYgKCAhKCAtLXJlbWFpbmluZyApICkgewoJCQkJCQlkZWZlcnJlZC5yZXNvbHZlV2l0aCggY29udGV4dHMsIHZhbHVlcyApOwoJCQkJCX0KCQkJCX07CgkJCX0sCgoJCQlwcm9ncmVzc1ZhbHVlcywgcHJvZ3Jlc3NDb250ZXh0cywgcmVzb2x2ZUNvbnRleHRzOwoKCQkvLyBhZGQgbGlzdGVuZXJzIHRvIERlZmVycmVkIHN1Ym9yZGluYXRlczsgdHJlYXQgb3RoZXJzIGFzIHJlc29sdmVkCgkJaWYgKCBsZW5ndGggPiAxICkgewoJCQlwcm9ncmVzc1ZhbHVlcyA9IG5ldyBBcnJheSggbGVuZ3RoICk7CgkJCXByb2dyZXNzQ29udGV4dHMgPSBuZXcgQXJyYXkoIGxlbmd0aCApOwoJCQlyZXNvbHZlQ29udGV4dHMgPSBuZXcgQXJyYXkoIGxlbmd0aCApOwoJCQlmb3IgKCA7IGkgPCBsZW5ndGg7IGkrKyApIHsKCQkJCWlmICggcmVzb2x2ZVZhbHVlc1sgaSBdICYmIGpRdWVyeS5pc0Z1bmN0aW9uKCByZXNvbHZlVmFsdWVzWyBpIF0ucHJvbWlzZSApICkgewoJCQkJCXJlc29sdmVWYWx1ZXNbIGkgXS5wcm9taXNlKCkKCQkJCQkJLmRvbmUoIHVwZGF0ZUZ1bmMoIGksIHJlc29sdmVDb250ZXh0cywgcmVzb2x2ZVZhbHVlcyApICkKCQkJCQkJLmZhaWwoIGRlZmVycmVkLnJlamVjdCApCgkJCQkJCS5wcm9ncmVzcyggdXBkYXRlRnVuYyggaSwgcHJvZ3Jlc3NDb250ZXh0cywgcHJvZ3Jlc3NWYWx1ZXMgKSApOwoJCQkJfSBlbHNlIHsKCQkJCQktLXJlbWFpbmluZzsKCQkJCX0KCQkJfQoJCX0KCgkJLy8gaWYgd2UncmUgbm90IHdhaXRpbmcgb24gYW55dGhpbmcsIHJlc29sdmUgdGhlIG1hc3RlcgoJCWlmICggIXJlbWFpbmluZyApIHsKCQkJZGVmZXJyZWQucmVzb2x2ZVdpdGgoIHJlc29sdmVDb250ZXh0cywgcmVzb2x2ZVZhbHVlcyApOwoJCX0KCgkJcmV0dXJuIGRlZmVycmVkLnByb21pc2UoKTsKCX0KfSk7CmpRdWVyeS5zdXBwb3J0ID0gKGZ1bmN0aW9uKCkgewoKCXZhciBzdXBwb3J0LCBhbGwsIGEsCgkJaW5wdXQsIHNlbGVjdCwgZnJhZ21lbnQsCgkJb3B0LCBldmVudE5hbWUsIGlzU3VwcG9ydGVkLCBpLAoJCWRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwoKCS8vIFNldHVwCglkaXYuc2V0QXR0cmlidXRlKCAiY2xhc3NOYW1lIiwgInQiICk7CglkaXYuaW5uZXJIVE1MID0gIiAgPGxpbmsvPjx0YWJsZT48L3RhYmxlPjxhIGhyZWY9Jy9hJz5hPC9hPjxpbnB1dCB0eXBlPSdjaGVja2JveCcvPiI7CgoJLy8gU3VwcG9ydCB0ZXN0cyB3b24ndCBydW4gaW4gc29tZSBsaW1pdGVkIG9yIG5vbi1icm93c2VyIGVudmlyb25tZW50cwoJYWxsID0gZGl2LmdldEVsZW1lbnRzQnlUYWdOYW1lKCIqIik7CglhID0gZGl2LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJhIilbIDAgXTsKCWlmICggIWFsbCB8fCAhYSB8fCAhYWxsLmxlbmd0aCApIHsKCQlyZXR1cm4ge307Cgl9CgoJLy8gRmlyc3QgYmF0Y2ggb2YgdGVzdHMKCXNlbGVjdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNlbGVjdCIpOwoJb3B0ID0gc2VsZWN0LmFwcGVuZENoaWxkKCBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJvcHRpb24iKSApOwoJaW5wdXQgPSBkaXYuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImlucHV0IilbIDAgXTsKCglhLnN0eWxlLmNzc1RleHQgPSAidG9wOjFweDtmbG9hdDpsZWZ0O29wYWNpdHk6LjUiOwoJc3VwcG9ydCA9IHsKCQkvLyBUZXN0IHNldEF0dHJpYnV0ZSBvbiBjYW1lbENhc2UgY2xhc3MuIElmIGl0IHdvcmtzLCB3ZSBuZWVkIGF0dHJGaXhlcyB3aGVuIGRvaW5nIGdldC9zZXRBdHRyaWJ1dGUgKGllNi83KQoJCWdldFNldEF0dHJpYnV0ZTogZGl2LmNsYXNzTmFtZSAhPT0gInQiLAoKCQkvLyBJRSBzdHJpcHMgbGVhZGluZyB3aGl0ZXNwYWNlIHdoZW4gLmlubmVySFRNTCBpcyB1c2VkCgkJbGVhZGluZ1doaXRlc3BhY2U6IGRpdi5maXJzdENoaWxkLm5vZGVUeXBlID09PSAzLAoKCQkvLyBNYWtlIHN1cmUgdGhhdCB0Ym9keSBlbGVtZW50cyBhcmVuJ3QgYXV0b21hdGljYWxseSBpbnNlcnRlZAoJCS8vIElFIHdpbGwgaW5zZXJ0IHRoZW0gaW50byBlbXB0eSB0YWJsZXMKCQl0Ym9keTogIWRpdi5nZXRFbGVtZW50c0J5VGFnTmFtZSgidGJvZHkiKS5sZW5ndGgsCgoJCS8vIE1ha2Ugc3VyZSB0aGF0IGxpbmsgZWxlbWVudHMgZ2V0IHNlcmlhbGl6ZWQgY29ycmVjdGx5IGJ5IGlubmVySFRNTAoJCS8vIFRoaXMgcmVxdWlyZXMgYSB3cmFwcGVyIGVsZW1lbnQgaW4gSUUKCQlodG1sU2VyaWFsaXplOiAhIWRpdi5nZXRFbGVtZW50c0J5VGFnTmFtZSgibGluayIpLmxlbmd0aCwKCgkJLy8gR2V0IHRoZSBzdHlsZSBpbmZvcm1hdGlvbiBmcm9tIGdldEF0dHJpYnV0ZQoJCS8vIChJRSB1c2VzIC5jc3NUZXh0IGluc3RlYWQpCgkJc3R5bGU6IC90b3AvLnRlc3QoIGEuZ2V0QXR0cmlidXRlKCJzdHlsZSIpICksCgoJCS8vIE1ha2Ugc3VyZSB0aGF0IFVSTHMgYXJlbid0IG1hbmlwdWxhdGVkCgkJLy8gKElFIG5vcm1hbGl6ZXMgaXQgYnkgZGVmYXVsdCkKCQlocmVmTm9ybWFsaXplZDogYS5nZXRBdHRyaWJ1dGUoImhyZWYiKSA9PT0gIi9hIiwKCgkJLy8gTWFrZSBzdXJlIHRoYXQgZWxlbWVudCBvcGFjaXR5IGV4aXN0cwoJCS8vIChJRSB1c2VzIGZpbHRlciBpbnN0ZWFkKQoJCS8vIFVzZSBhIHJlZ2V4IHRvIHdvcmsgYXJvdW5kIGEgV2ViS2l0IGlzc3VlLiBTZWUgIzUxNDUKCQlvcGFjaXR5OiAvXjAuNS8udGVzdCggYS5zdHlsZS5vcGFjaXR5ICksCgoJCS8vIFZlcmlmeSBzdHlsZSBmbG9hdCBleGlzdGVuY2UKCQkvLyAoSUUgdXNlcyBzdHlsZUZsb2F0IGluc3RlYWQgb2YgY3NzRmxvYXQpCgkJY3NzRmxvYXQ6ICEhYS5zdHlsZS5jc3NGbG9hdCwKCgkJLy8gQ2hlY2sgdGhlIGRlZmF1bHQgY2hlY2tib3gvcmFkaW8gdmFsdWUgKCIiIG9uIFdlYktpdDsgIm9uIiBlbHNld2hlcmUpCgkJY2hlY2tPbjogISFpbnB1dC52YWx1ZSwKCgkJLy8gTWFrZSBzdXJlIHRoYXQgYSBzZWxlY3RlZC1ieS1kZWZhdWx0IG9wdGlvbiBoYXMgYSB3b3JraW5nIHNlbGVjdGVkIHByb3BlcnR5LgoJCS8vIChXZWJLaXQgZGVmYXVsdHMgdG8gZmFsc2UgaW5zdGVhZCBvZiB0cnVlLCBJRSB0b28sIGlmIGl0J3MgaW4gYW4gb3B0Z3JvdXApCgkJb3B0U2VsZWN0ZWQ6IG9wdC5zZWxlY3RlZCwKCgkJLy8gVGVzdHMgZm9yIGVuY3R5cGUgc3VwcG9ydCBvbiBhIGZvcm0gKCM2NzQzKQoJCWVuY3R5cGU6ICEhZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZm9ybSIpLmVuY3R5cGUsCgoJCS8vIE1ha2VzIHN1cmUgY2xvbmluZyBhbiBodG1sNSBlbGVtZW50IGRvZXMgbm90IGNhdXNlIHByb2JsZW1zCgkJLy8gV2hlcmUgb3V0ZXJIVE1MIGlzIHVuZGVmaW5lZCwgdGhpcyBzdGlsbCB3b3JrcwoJCWh0bWw1Q2xvbmU6IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIm5hdiIpLmNsb25lTm9kZSggdHJ1ZSApLm91dGVySFRNTCAhPT0gIjw6bmF2PjwvOm5hdj4iLAoKCQkvLyBqUXVlcnkuc3VwcG9ydC5ib3hNb2RlbCBERVBSRUNBVEVEIGluIDEuOCBzaW5jZSB3ZSBkb24ndCBzdXBwb3J0IFF1aXJrcyBNb2RlCgkJYm94TW9kZWw6IGRvY3VtZW50LmNvbXBhdE1vZGUgPT09ICJDU1MxQ29tcGF0IiwKCgkJLy8gV2lsbCBiZSBkZWZpbmVkIGxhdGVyCgkJZGVsZXRlRXhwYW5kbzogdHJ1ZSwKCQlub0Nsb25lRXZlbnQ6IHRydWUsCgkJaW5saW5lQmxvY2tOZWVkc0xheW91dDogZmFsc2UsCgkJc2hyaW5rV3JhcEJsb2NrczogZmFsc2UsCgkJcmVsaWFibGVNYXJnaW5SaWdodDogdHJ1ZSwKCQlib3hTaXppbmdSZWxpYWJsZTogdHJ1ZSwKCQlwaXhlbFBvc2l0aW9uOiBmYWxzZQoJfTsKCgkvLyBNYWtlIHN1cmUgY2hlY2tlZCBzdGF0dXMgaXMgcHJvcGVybHkgY2xvbmVkCglpbnB1dC5jaGVja2VkID0gdHJ1ZTsKCXN1cHBvcnQubm9DbG9uZUNoZWNrZWQgPSBpbnB1dC5jbG9uZU5vZGUoIHRydWUgKS5jaGVja2VkOwoKCS8vIE1ha2Ugc3VyZSB0aGF0IHRoZSBvcHRpb25zIGluc2lkZSBkaXNhYmxlZCBzZWxlY3RzIGFyZW4ndCBtYXJrZWQgYXMgZGlzYWJsZWQKCS8vIChXZWJLaXQgbWFya3MgdGhlbSBhcyBkaXNhYmxlZCkKCXNlbGVjdC5kaXNhYmxlZCA9IHRydWU7CglzdXBwb3J0Lm9wdERpc2FibGVkID0gIW9wdC5kaXNhYmxlZDsKCgkvLyBTdXBwb3J0OiBJRTw5Cgl0cnkgewoJCWRlbGV0ZSBkaXYudGVzdDsKCX0gY2F0Y2goIGUgKSB7CgkJc3VwcG9ydC5kZWxldGVFeHBhbmRvID0gZmFsc2U7Cgl9CgoJLy8gQ2hlY2sgaWYgd2UgY2FuIHRydXN0IGdldEF0dHJpYnV0ZSgidmFsdWUiKQoJaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbnB1dCIpOwoJaW5wdXQuc2V0QXR0cmlidXRlKCAidmFsdWUiLCAiIiApOwoJc3VwcG9ydC5pbnB1dCA9IGlucHV0LmdldEF0dHJpYnV0ZSggInZhbHVlIiApID09PSAiIjsKCgkvLyBDaGVjayBpZiBhbiBpbnB1dCBtYWludGFpbnMgaXRzIHZhbHVlIGFmdGVyIGJlY29taW5nIGEgcmFkaW8KCWlucHV0LnZhbHVlID0gInQiOwoJaW5wdXQuc2V0QXR0cmlidXRlKCAidHlwZSIsICJyYWRpbyIgKTsKCXN1cHBvcnQucmFkaW9WYWx1ZSA9IGlucHV0LnZhbHVlID09PSAidCI7CgoJLy8gIzExMjE3IC0gV2ViS2l0IGxvc2VzIGNoZWNrIHdoZW4gdGhlIG5hbWUgaXMgYWZ0ZXIgdGhlIGNoZWNrZWQgYXR0cmlidXRlCglpbnB1dC5zZXRBdHRyaWJ1dGUoICJjaGVja2VkIiwgInQiICk7CglpbnB1dC5zZXRBdHRyaWJ1dGUoICJuYW1lIiwgInQiICk7CgoJZnJhZ21lbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7CglmcmFnbWVudC5hcHBlbmRDaGlsZCggaW5wdXQgKTsKCgkvLyBDaGVjayBpZiBhIGRpc2Nvbm5lY3RlZCBjaGVja2JveCB3aWxsIHJldGFpbiBpdHMgY2hlY2tlZAoJLy8gdmFsdWUgb2YgdHJ1ZSBhZnRlciBhcHBlbmRlZCB0byB0aGUgRE9NIChJRTYvNykKCXN1cHBvcnQuYXBwZW5kQ2hlY2tlZCA9IGlucHV0LmNoZWNrZWQ7CgoJLy8gV2ViS2l0IGRvZXNuJ3QgY2xvbmUgY2hlY2tlZCBzdGF0ZSBjb3JyZWN0bHkgaW4gZnJhZ21lbnRzCglzdXBwb3J0LmNoZWNrQ2xvbmUgPSBmcmFnbWVudC5jbG9uZU5vZGUoIHRydWUgKS5jbG9uZU5vZGUoIHRydWUgKS5sYXN0Q2hpbGQuY2hlY2tlZDsKCgkvLyBTdXBwb3J0OiBJRTw5CgkvLyBPcGVyYSBkb2VzIG5vdCBjbG9uZSBldmVudHMgKGFuZCB0eXBlb2YgZGl2LmF0dGFjaEV2ZW50ID09PSB1bmRlZmluZWQpLgoJLy8gSUU5LTEwIGNsb25lcyBldmVudHMgYm91bmQgdmlhIGF0dGFjaEV2ZW50LCBidXQgdGhleSBkb24ndCB0cmlnZ2VyIHdpdGggLmNsaWNrKCkKCWlmICggZGl2LmF0dGFjaEV2ZW50ICkgewoJCWRpdi5hdHRhY2hFdmVudCggIm9uY2xpY2siLCBmdW5jdGlvbigpIHsKCQkJc3VwcG9ydC5ub0Nsb25lRXZlbnQgPSBmYWxzZTsKCQl9KTsKCgkJZGl2LmNsb25lTm9kZSggdHJ1ZSApLmNsaWNrKCk7Cgl9CgoJLy8gU3VwcG9ydDogSUU8OSAobGFjayBzdWJtaXQvY2hhbmdlIGJ1YmJsZSksIEZpcmVmb3ggMTcrIChsYWNrIGZvY3VzaW4gZXZlbnQpCgkvLyBCZXdhcmUgb2YgQ1NQIHJlc3RyaWN0aW9ucyAoaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4vU2VjdXJpdHkvQ1NQKSwgdGVzdC9jc3AucGhwCglmb3IgKCBpIGluIHsgc3VibWl0OiB0cnVlLCBjaGFuZ2U6IHRydWUsIGZvY3VzaW46IHRydWUgfSkgewoJCWRpdi5zZXRBdHRyaWJ1dGUoIGV2ZW50TmFtZSA9ICJvbiIgKyBpLCAidCIgKTsKCgkJc3VwcG9ydFsgaSArICJCdWJibGVzIiBdID0gZXZlbnROYW1lIGluIHdpbmRvdyB8fCBkaXYuYXR0cmlidXRlc1sgZXZlbnROYW1lIF0uZXhwYW5kbyA9PT0gZmFsc2U7Cgl9CgoJZGl2LnN0eWxlLmJhY2tncm91bmRDbGlwID0gImNvbnRlbnQtYm94IjsKCWRpdi5jbG9uZU5vZGUoIHRydWUgKS5zdHlsZS5iYWNrZ3JvdW5kQ2xpcCA9ICIiOwoJc3VwcG9ydC5jbGVhckNsb25lU3R5bGUgPSBkaXYuc3R5bGUuYmFja2dyb3VuZENsaXAgPT09ICJjb250ZW50LWJveCI7CgoJLy8gUnVuIHRlc3RzIHRoYXQgbmVlZCBhIGJvZHkgYXQgZG9jIHJlYWR5CglqUXVlcnkoZnVuY3Rpb24oKSB7CgkJdmFyIGNvbnRhaW5lciwgbWFyZ2luRGl2LCB0ZHMsCgkJCWRpdlJlc2V0ID0gInBhZGRpbmc6MDttYXJnaW46MDtib3JkZXI6MDtkaXNwbGF5OmJsb2NrO2JveC1zaXppbmc6Y29udGVudC1ib3g7LW1vei1ib3gtc2l6aW5nOmNvbnRlbnQtYm94Oy13ZWJraXQtYm94LXNpemluZzpjb250ZW50LWJveDsiLAoJCQlib2R5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImJvZHkiKVswXTsKCgkJaWYgKCAhYm9keSApIHsKCQkJLy8gUmV0dXJuIGZvciBmcmFtZXNldCBkb2NzIHRoYXQgZG9uJ3QgaGF2ZSBhIGJvZHkKCQkJcmV0dXJuOwoJCX0KCgkJY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CgkJY29udGFpbmVyLnN0eWxlLmNzc1RleHQgPSAiYm9yZGVyOjA7d2lkdGg6MDtoZWlnaHQ6MDtwb3NpdGlvbjphYnNvbHV0ZTt0b3A6MDtsZWZ0Oi05OTk5cHg7bWFyZ2luLXRvcDoxcHgiOwoKCQlib2R5LmFwcGVuZENoaWxkKCBjb250YWluZXIgKS5hcHBlbmRDaGlsZCggZGl2ICk7CgoJCS8vIFN1cHBvcnQ6IElFOAoJCS8vIENoZWNrIGlmIHRhYmxlIGNlbGxzIHN0aWxsIGhhdmUgb2Zmc2V0V2lkdGgvSGVpZ2h0IHdoZW4gdGhleSBhcmUgc2V0CgkJLy8gdG8gZGlzcGxheTpub25lIGFuZCB0aGVyZSBhcmUgc3RpbGwgb3RoZXIgdmlzaWJsZSB0YWJsZSBjZWxscyBpbiBhCgkJLy8gdGFibGUgcm93OyBpZiBzbywgb2Zmc2V0V2lkdGgvSGVpZ2h0IGFyZSBub3QgcmVsaWFibGUgZm9yIHVzZSB3aGVuCgkJLy8gZGV0ZXJtaW5pbmcgaWYgYW4gZWxlbWVudCBoYXMgYmVlbiBoaWRkZW4gZGlyZWN0bHkgdXNpbmcKCQkvLyBkaXNwbGF5Om5vbmUgKGl0IGlzIHN0aWxsIHNhZmUgdG8gdXNlIG9mZnNldHMgaWYgYSBwYXJlbnQgZWxlbWVudCBpcwoJCS8vIGhpZGRlbjsgZG9uIHNhZmV0eSBnb2dnbGVzIGFuZCBzZWUgYnVnICM0NTEyIGZvciBtb3JlIGluZm9ybWF0aW9uKS4KCQlkaXYuaW5uZXJIVE1MID0gIjx0YWJsZT48dHI+PHRkPjwvdGQ+PHRkPnQ8L3RkPjwvdHI+PC90YWJsZT4iOwoJCXRkcyA9IGRpdi5nZXRFbGVtZW50c0J5VGFnTmFtZSgidGQiKTsKCQl0ZHNbIDAgXS5zdHlsZS5jc3NUZXh0ID0gInBhZGRpbmc6MDttYXJnaW46MDtib3JkZXI6MDtkaXNwbGF5Om5vbmUiOwoJCWlzU3VwcG9ydGVkID0gKCB0ZHNbIDAgXS5vZmZzZXRIZWlnaHQgPT09IDAgKTsKCgkJdGRzWyAwIF0uc3R5bGUuZGlzcGxheSA9ICIiOwoJCXRkc1sgMSBdLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgoJCS8vIFN1cHBvcnQ6IElFOAoJCS8vIENoZWNrIGlmIGVtcHR5IHRhYmxlIGNlbGxzIHN0aWxsIGhhdmUgb2Zmc2V0V2lkdGgvSGVpZ2h0CgkJc3VwcG9ydC5yZWxpYWJsZUhpZGRlbk9mZnNldHMgPSBpc1N1cHBvcnRlZCAmJiAoIHRkc1sgMCBdLm9mZnNldEhlaWdodCA9PT0gMCApOwoKCQkvLyBDaGVjayBib3gtc2l6aW5nIGFuZCBtYXJnaW4gYmVoYXZpb3IKCQlkaXYuaW5uZXJIVE1MID0gIiI7CgkJZGl2LnN0eWxlLmNzc1RleHQgPSAiYm94LXNpemluZzpib3JkZXItYm94Oy1tb3otYm94LXNpemluZzpib3JkZXItYm94Oy13ZWJraXQtYm94LXNpemluZzpib3JkZXItYm94O3BhZGRpbmc6MXB4O2JvcmRlcjoxcHg7ZGlzcGxheTpibG9jazt3aWR0aDo0cHg7bWFyZ2luLXRvcDoxJTtwb3NpdGlvbjphYnNvbHV0ZTt0b3A6MSU7IjsKCQlzdXBwb3J0LmJveFNpemluZyA9ICggZGl2Lm9mZnNldFdpZHRoID09PSA0ICk7CgkJc3VwcG9ydC5kb2VzTm90SW5jbHVkZU1hcmdpbkluQm9keU9mZnNldCA9ICggYm9keS5vZmZzZXRUb3AgIT09IDEgKTsKCgkJLy8gVXNlIHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlIGJlY2F1c2UganNkb20gb24gbm9kZS5qcyB3aWxsIGJyZWFrIHdpdGhvdXQgaXQuCgkJaWYgKCB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSApIHsKCQkJc3VwcG9ydC5waXhlbFBvc2l0aW9uID0gKCB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSggZGl2LCBudWxsICkgfHwge30gKS50b3AgIT09ICIxJSI7CgkJCXN1cHBvcnQuYm94U2l6aW5nUmVsaWFibGUgPSAoIHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKCBkaXYsIG51bGwgKSB8fCB7IHdpZHRoOiAiNHB4IiB9ICkud2lkdGggPT09ICI0cHgiOwoKCQkJLy8gQ2hlY2sgaWYgZGl2IHdpdGggZXhwbGljaXQgd2lkdGggYW5kIG5vIG1hcmdpbi1yaWdodCBpbmNvcnJlY3RseQoJCQkvLyBnZXRzIGNvbXB1dGVkIG1hcmdpbi1yaWdodCBiYXNlZCBvbiB3aWR0aCBvZiBjb250YWluZXIuICgjMzMzMykKCQkJLy8gRmFpbHMgaW4gV2ViS2l0IGJlZm9yZSBGZWIgMjAxMSBuaWdodGxpZXMKCQkJLy8gV2ViS2l0IEJ1ZyAxMzM0MyAtIGdldENvbXB1dGVkU3R5bGUgcmV0dXJucyB3cm9uZyB2YWx1ZSBmb3IgbWFyZ2luLXJpZ2h0CgkJCW1hcmdpbkRpdiA9IGRpdi5hcHBlbmRDaGlsZCggZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikgKTsKCQkJbWFyZ2luRGl2LnN0eWxlLmNzc1RleHQgPSBkaXYuc3R5bGUuY3NzVGV4dCA9IGRpdlJlc2V0OwoJCQltYXJnaW5EaXYuc3R5bGUubWFyZ2luUmlnaHQgPSBtYXJnaW5EaXYuc3R5bGUud2lkdGggPSAiMCI7CgkJCWRpdi5zdHlsZS53aWR0aCA9ICIxcHgiOwoKCQkJc3VwcG9ydC5yZWxpYWJsZU1hcmdpblJpZ2h0ID0KCQkJCSFwYXJzZUZsb2F0KCAoIHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKCBtYXJnaW5EaXYsIG51bGwgKSB8fCB7fSApLm1hcmdpblJpZ2h0ICk7CgkJfQoKCQlpZiAoIHR5cGVvZiBkaXYuc3R5bGUuem9vbSAhPT0gY29yZV9zdHJ1bmRlZmluZWQgKSB7CgkJCS8vIFN1cHBvcnQ6IElFPDgKCQkJLy8gQ2hlY2sgaWYgbmF0aXZlbHkgYmxvY2stbGV2ZWwgZWxlbWVudHMgYWN0IGxpa2UgaW5saW5lLWJsb2NrCgkJCS8vIGVsZW1lbnRzIHdoZW4gc2V0dGluZyB0aGVpciBkaXNwbGF5IHRvICdpbmxpbmUnIGFuZCBnaXZpbmcKCQkJLy8gdGhlbSBsYXlvdXQKCQkJZGl2LmlubmVySFRNTCA9ICIiOwoJCQlkaXYuc3R5bGUuY3NzVGV4dCA9IGRpdlJlc2V0ICsgIndpZHRoOjFweDtwYWRkaW5nOjFweDtkaXNwbGF5OmlubGluZTt6b29tOjEiOwoJCQlzdXBwb3J0LmlubGluZUJsb2NrTmVlZHNMYXlvdXQgPSAoIGRpdi5vZmZzZXRXaWR0aCA9PT0gMyApOwoKCQkJLy8gU3VwcG9ydDogSUU2CgkJCS8vIENoZWNrIGlmIGVsZW1lbnRzIHdpdGggbGF5b3V0IHNocmluay13cmFwIHRoZWlyIGNoaWxkcmVuCgkJCWRpdi5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKCQkJZGl2LmlubmVySFRNTCA9ICI8ZGl2PjwvZGl2PiI7CgkJCWRpdi5maXJzdENoaWxkLnN0eWxlLndpZHRoID0gIjVweCI7CgkJCXN1cHBvcnQuc2hyaW5rV3JhcEJsb2NrcyA9ICggZGl2Lm9mZnNldFdpZHRoICE9PSAzICk7CgoJCQlpZiAoIHN1cHBvcnQuaW5saW5lQmxvY2tOZWVkc0xheW91dCApIHsKCQkJCS8vIFByZXZlbnQgSUUgNiBmcm9tIGFmZmVjdGluZyBsYXlvdXQgZm9yIHBvc2l0aW9uZWQgZWxlbWVudHMgIzExMDQ4CgkJCQkvLyBQcmV2ZW50IElFIGZyb20gc2hyaW5raW5nIHRoZSBib2R5IGluIElFIDcgbW9kZSAjMTI4NjkKCQkJCS8vIFN1cHBvcnQ6IElFPDgKCQkJCWJvZHkuc3R5bGUuem9vbSA9IDE7CgkJCX0KCQl9CgoJCWJvZHkucmVtb3ZlQ2hpbGQoIGNvbnRhaW5lciApOwoKCQkvLyBOdWxsIGVsZW1lbnRzIHRvIGF2b2lkIGxlYWtzIGluIElFCgkJY29udGFpbmVyID0gZGl2ID0gdGRzID0gbWFyZ2luRGl2ID0gbnVsbDsKCX0pOwoKCS8vIE51bGwgZWxlbWVudHMgdG8gYXZvaWQgbGVha3MgaW4gSUUKCWFsbCA9IHNlbGVjdCA9IGZyYWdtZW50ID0gb3B0ID0gYSA9IGlucHV0ID0gbnVsbDsKCglyZXR1cm4gc3VwcG9ydDsKfSkoKTsKCnZhciByYnJhY2UgPSAvKD86XHtbXHNcU10qXH18XFtbXHNcU10qXF0pJC8sCglybXVsdGlEYXNoID0gLyhbQS1aXSkvZzsKCmZ1bmN0aW9uIGludGVybmFsRGF0YSggZWxlbSwgbmFtZSwgZGF0YSwgcHZ0IC8qIEludGVybmFsIFVzZSBPbmx5ICovICl7CglpZiAoICFqUXVlcnkuYWNjZXB0RGF0YSggZWxlbSApICkgewoJCXJldHVybjsKCX0KCgl2YXIgdGhpc0NhY2hlLCByZXQsCgkJaW50ZXJuYWxLZXkgPSBqUXVlcnkuZXhwYW5kbywKCQlnZXRCeU5hbWUgPSB0eXBlb2YgbmFtZSA9PT0gInN0cmluZyIsCgoJCS8vIFdlIGhhdmUgdG8gaGFuZGxlIERPTSBub2RlcyBhbmQgSlMgb2JqZWN0cyBkaWZmZXJlbnRseSBiZWNhdXNlIElFNi03CgkJLy8gY2FuJ3QgR0Mgb2JqZWN0IHJlZmVyZW5jZXMgcHJvcGVybHkgYWNyb3NzIHRoZSBET00tSlMgYm91bmRhcnkKCQlpc05vZGUgPSBlbGVtLm5vZGVUeXBlLAoKCQkvLyBPbmx5IERPTSBub2RlcyBuZWVkIHRoZSBnbG9iYWwgalF1ZXJ5IGNhY2hlOyBKUyBvYmplY3QgZGF0YSBpcwoJCS8vIGF0dGFjaGVkIGRpcmVjdGx5IHRvIHRoZSBvYmplY3Qgc28gR0MgY2FuIG9jY3VyIGF1dG9tYXRpY2FsbHkKCQljYWNoZSA9IGlzTm9kZSA/IGpRdWVyeS5jYWNoZSA6IGVsZW0sCgoJCS8vIE9ubHkgZGVmaW5pbmcgYW4gSUQgZm9yIEpTIG9iamVjdHMgaWYgaXRzIGNhY2hlIGFscmVhZHkgZXhpc3RzIGFsbG93cwoJCS8vIHRoZSBjb2RlIHRvIHNob3J0Y3V0IG9uIHRoZSBzYW1lIHBhdGggYXMgYSBET00gbm9kZSB3aXRoIG5vIGNhY2hlCgkJaWQgPSBpc05vZGUgPyBlbGVtWyBpbnRlcm5hbEtleSBdIDogZWxlbVsgaW50ZXJuYWxLZXkgXSAmJiBpbnRlcm5hbEtleTsKCgkvLyBBdm9pZCBkb2luZyBhbnkgbW9yZSB3b3JrIHRoYW4gd2UgbmVlZCB0byB3aGVuIHRyeWluZyB0byBnZXQgZGF0YSBvbiBhbgoJLy8gb2JqZWN0IHRoYXQgaGFzIG5vIGRhdGEgYXQgYWxsCglpZiAoICghaWQgfHwgIWNhY2hlW2lkXSB8fCAoIXB2dCAmJiAhY2FjaGVbaWRdLmRhdGEpKSAmJiBnZXRCeU5hbWUgJiYgZGF0YSA9PT0gdW5kZWZpbmVkICkgewoJCXJldHVybjsKCX0KCglpZiAoICFpZCApIHsKCQkvLyBPbmx5IERPTSBub2RlcyBuZWVkIGEgbmV3IHVuaXF1ZSBJRCBmb3IgZWFjaCBlbGVtZW50IHNpbmNlIHRoZWlyIGRhdGEKCQkvLyBlbmRzIHVwIGluIHRoZSBnbG9iYWwgY2FjaGUKCQlpZiAoIGlzTm9kZSApIHsKCQkJZWxlbVsgaW50ZXJuYWxLZXkgXSA9IGlkID0gY29yZV9kZWxldGVkSWRzLnBvcCgpIHx8IGpRdWVyeS5ndWlkKys7CgkJfSBlbHNlIHsKCQkJaWQgPSBpbnRlcm5hbEtleTsKCQl9Cgl9CgoJaWYgKCAhY2FjaGVbIGlkIF0gKSB7CgkJY2FjaGVbIGlkIF0gPSB7fTsKCgkJLy8gQXZvaWRzIGV4cG9zaW5nIGpRdWVyeSBtZXRhZGF0YSBvbiBwbGFpbiBKUyBvYmplY3RzIHdoZW4gdGhlIG9iamVjdAoJCS8vIGlzIHNlcmlhbGl6ZWQgdXNpbmcgSlNPTi5zdHJpbmdpZnkKCQlpZiAoICFpc05vZGUgKSB7CgkJCWNhY2hlWyBpZCBdLnRvSlNPTiA9IGpRdWVyeS5ub29wOwoJCX0KCX0KCgkvLyBBbiBvYmplY3QgY2FuIGJlIHBhc3NlZCB0byBqUXVlcnkuZGF0YSBpbnN0ZWFkIG9mIGEga2V5L3ZhbHVlIHBhaXI7IHRoaXMgZ2V0cwoJLy8gc2hhbGxvdyBjb3BpZWQgb3ZlciBvbnRvIHRoZSBleGlzdGluZyBjYWNoZQoJaWYgKCB0eXBlb2YgbmFtZSA9PT0gIm9iamVjdCIgfHwgdHlwZW9mIG5hbWUgPT09ICJmdW5jdGlvbiIgKSB7CgkJaWYgKCBwdnQgKSB7CgkJCWNhY2hlWyBpZCBdID0galF1ZXJ5LmV4dGVuZCggY2FjaGVbIGlkIF0sIG5hbWUgKTsKCQl9IGVsc2UgewoJCQljYWNoZVsgaWQgXS5kYXRhID0galF1ZXJ5LmV4dGVuZCggY2FjaGVbIGlkIF0uZGF0YSwgbmFtZSApOwoJCX0KCX0KCgl0aGlzQ2FjaGUgPSBjYWNoZVsgaWQgXTsKCgkvLyBqUXVlcnkgZGF0YSgpIGlzIHN0b3JlZCBpbiBhIHNlcGFyYXRlIG9iamVjdCBpbnNpZGUgdGhlIG9iamVjdCdzIGludGVybmFsIGRhdGEKCS8vIGNhY2hlIGluIG9yZGVyIHRvIGF2b2lkIGtleSBjb2xsaXNpb25zIGJldHdlZW4gaW50ZXJuYWwgZGF0YSBhbmQgdXNlci1kZWZpbmVkCgkvLyBkYXRhLgoJaWYgKCAhcHZ0ICkgewoJCWlmICggIXRoaXNDYWNoZS5kYXRhICkgewoJCQl0aGlzQ2FjaGUuZGF0YSA9IHt9OwoJCX0KCgkJdGhpc0NhY2hlID0gdGhpc0NhY2hlLmRhdGE7Cgl9CgoJaWYgKCBkYXRhICE9PSB1bmRlZmluZWQgKSB7CgkJdGhpc0NhY2hlWyBqUXVlcnkuY2FtZWxDYXNlKCBuYW1lICkgXSA9IGRhdGE7Cgl9CgoJLy8gQ2hlY2sgZm9yIGJvdGggY29udmVydGVkLXRvLWNhbWVsIGFuZCBub24tY29udmVydGVkIGRhdGEgcHJvcGVydHkgbmFtZXMKCS8vIElmIGEgZGF0YSBwcm9wZXJ0eSB3YXMgc3BlY2lmaWVkCglpZiAoIGdldEJ5TmFtZSApIHsKCgkJLy8gRmlyc3QgVHJ5IHRvIGZpbmQgYXMtaXMgcHJvcGVydHkgZGF0YQoJCXJldCA9IHRoaXNDYWNoZVsgbmFtZSBdOwoKCQkvLyBUZXN0IGZvciBudWxsfHVuZGVmaW5lZCBwcm9wZXJ0eSBkYXRhCgkJaWYgKCByZXQgPT0gbnVsbCApIHsKCgkJCS8vIFRyeSB0byBmaW5kIHRoZSBjYW1lbENhc2VkIHByb3BlcnR5CgkJCXJldCA9IHRoaXNDYWNoZVsgalF1ZXJ5LmNhbWVsQ2FzZSggbmFtZSApIF07CgkJfQoJfSBlbHNlIHsKCQlyZXQgPSB0aGlzQ2FjaGU7Cgl9CgoJcmV0dXJuIHJldDsKfQoKZnVuY3Rpb24gaW50ZXJuYWxSZW1vdmVEYXRhKCBlbGVtLCBuYW1lLCBwdnQgKSB7CglpZiAoICFqUXVlcnkuYWNjZXB0RGF0YSggZWxlbSApICkgewoJCXJldHVybjsKCX0KCgl2YXIgaSwgbCwgdGhpc0NhY2hlLAoJCWlzTm9kZSA9IGVsZW0ubm9kZVR5cGUsCgoJCS8vIFNlZSBqUXVlcnkuZGF0YSBmb3IgbW9yZSBpbmZvcm1hdGlvbgoJCWNhY2hlID0gaXNOb2RlID8galF1ZXJ5LmNhY2hlIDogZWxlbSwKCQlpZCA9IGlzTm9kZSA/IGVsZW1bIGpRdWVyeS5leHBhbmRvIF0gOiBqUXVlcnkuZXhwYW5kbzsKCgkvLyBJZiB0aGVyZSBpcyBhbHJlYWR5IG5vIGNhY2hlIGVudHJ5IGZvciB0aGlzIG9iamVjdCwgdGhlcmUgaXMgbm8KCS8vIHB1cnBvc2UgaW4gY29udGludWluZwoJaWYgKCAhY2FjaGVbIGlkIF0gKSB7CgkJcmV0dXJuOwoJfQoKCWlmICggbmFtZSApIHsKCgkJdGhpc0NhY2hlID0gcHZ0ID8gY2FjaGVbIGlkIF0gOiBjYWNoZVsgaWQgXS5kYXRhOwoKCQlpZiAoIHRoaXNDYWNoZSApIHsKCgkJCS8vIFN1cHBvcnQgYXJyYXkgb3Igc3BhY2Ugc2VwYXJhdGVkIHN0cmluZyBuYW1lcyBmb3IgZGF0YSBrZXlzCgkJCWlmICggIWpRdWVyeS5pc0FycmF5KCBuYW1lICkgKSB7CgoJCQkJLy8gdHJ5IHRoZSBzdHJpbmcgYXMgYSBrZXkgYmVmb3JlIGFueSBtYW5pcHVsYXRpb24KCQkJCWlmICggbmFtZSBpbiB0aGlzQ2FjaGUgKSB7CgkJCQkJbmFtZSA9IFsgbmFtZSBdOwoJCQkJfSBlbHNlIHsKCgkJCQkJLy8gc3BsaXQgdGhlIGNhbWVsIGNhc2VkIHZlcnNpb24gYnkgc3BhY2VzIHVubGVzcyBhIGtleSB3aXRoIHRoZSBzcGFjZXMgZXhpc3RzCgkJCQkJbmFtZSA9IGpRdWVyeS5jYW1lbENhc2UoIG5hbWUgKTsKCQkJCQlpZiAoIG5hbWUgaW4gdGhpc0NhY2hlICkgewoJCQkJCQluYW1lID0gWyBuYW1lIF07CgkJCQkJfSBlbHNlIHsKCQkJCQkJbmFtZSA9IG5hbWUuc3BsaXQoIiAiKTsKCQkJCQl9CgkJCQl9CgkJCX0gZWxzZSB7CgkJCQkvLyBJZiAibmFtZSIgaXMgYW4gYXJyYXkgb2Yga2V5cy4uLgoJCQkJLy8gV2hlbiBkYXRhIGlzIGluaXRpYWxseSBjcmVhdGVkLCB2aWEgKCJrZXkiLCAidmFsIikgc2lnbmF0dXJlLAoJCQkJLy8ga2V5cyB3aWxsIGJlIGNvbnZlcnRlZCB0byBjYW1lbENhc2UuCgkJCQkvLyBTaW5jZSB0aGVyZSBpcyBubyB3YXkgdG8gdGVsbCBfaG93XyBhIGtleSB3YXMgYWRkZWQsIHJlbW92ZQoJCQkJLy8gYm90aCBwbGFpbiBrZXkgYW5kIGNhbWVsQ2FzZSBrZXkuICMxMjc4NgoJCQkJLy8gVGhpcyB3aWxsIG9ubHkgcGVuYWxpemUgdGhlIGFycmF5IGFyZ3VtZW50IHBhdGguCgkJCQluYW1lID0gbmFtZS5jb25jYXQoIGpRdWVyeS5tYXAoIG5hbWUsIGpRdWVyeS5jYW1lbENhc2UgKSApOwoJCQl9CgoJCQlmb3IgKCBpID0gMCwgbCA9IG5hbWUubGVuZ3RoOyBpIDwgbDsgaSsrICkgewoJCQkJZGVsZXRlIHRoaXNDYWNoZVsgbmFtZVtpXSBdOwoJCQl9CgoJCQkvLyBJZiB0aGVyZSBpcyBubyBkYXRhIGxlZnQgaW4gdGhlIGNhY2hlLCB3ZSB3YW50IHRvIGNvbnRpbnVlCgkJCS8vIGFuZCBsZXQgdGhlIGNhY2hlIG9iamVjdCBpdHNlbGYgZ2V0IGRlc3Ryb3llZAoJCQlpZiAoICEoIHB2dCA/IGlzRW1wdHlEYXRhT2JqZWN0IDogalF1ZXJ5LmlzRW1wdHlPYmplY3QgKSggdGhpc0NhY2hlICkgKSB7CgkJCQlyZXR1cm47CgkJCX0KCQl9Cgl9CgoJLy8gU2VlIGpRdWVyeS5kYXRhIGZvciBtb3JlIGluZm9ybWF0aW9uCglpZiAoICFwdnQgKSB7CgkJZGVsZXRlIGNhY2hlWyBpZCBdLmRhdGE7CgoJCS8vIERvbid0IGRlc3Ryb3kgdGhlIHBhcmVudCBjYWNoZSB1bmxlc3MgdGhlIGludGVybmFsIGRhdGEgb2JqZWN0CgkJLy8gaGFkIGJlZW4gdGhlIG9ubHkgdGhpbmcgbGVmdCBpbiBpdAoJCWlmICggIWlzRW1wdHlEYXRhT2JqZWN0KCBjYWNoZVsgaWQgXSApICkgewoJCQlyZXR1cm47CgkJfQoJfQoKCS8vIERlc3Ryb3kgdGhlIGNhY2hlCglpZiAoIGlzTm9kZSApIHsKCQlqUXVlcnkuY2xlYW5EYXRhKCBbIGVsZW0gXSwgdHJ1ZSApOwoKCS8vIFVzZSBkZWxldGUgd2hlbiBzdXBwb3J0ZWQgZm9yIGV4cGFuZG9zIG9yIGBjYWNoZWAgaXMgbm90IGEgd2luZG93IHBlciBpc1dpbmRvdyAoIzEwMDgwKQoJfSBlbHNlIGlmICggalF1ZXJ5LnN1cHBvcnQuZGVsZXRlRXhwYW5kbyB8fCBjYWNoZSAhPSBjYWNoZS53aW5kb3cgKSB7CgkJZGVsZXRlIGNhY2hlWyBpZCBdOwoKCS8vIFdoZW4gYWxsIGVsc2UgZmFpbHMsIG51bGwKCX0gZWxzZSB7CgkJY2FjaGVbIGlkIF0gPSBudWxsOwoJfQp9CgpqUXVlcnkuZXh0ZW5kKHsKCWNhY2hlOiB7fSwKCgkvLyBVbmlxdWUgZm9yIGVhY2ggY29weSBvZiBqUXVlcnkgb24gdGhlIHBhZ2UKCS8vIE5vbi1kaWdpdHMgcmVtb3ZlZCB0byBtYXRjaCByaW5saW5lalF1ZXJ5CglleHBhbmRvOiAialF1ZXJ5IiArICggY29yZV92ZXJzaW9uICsgTWF0aC5yYW5kb20oKSApLnJlcGxhY2UoIC9cRC9nLCAiIiApLAoKCS8vIFRoZSBmb2xsb3dpbmcgZWxlbWVudHMgdGhyb3cgdW5jYXRjaGFibGUgZXhjZXB0aW9ucyBpZiB5b3UKCS8vIGF0dGVtcHQgdG8gYWRkIGV4cGFuZG8gcHJvcGVydGllcyB0byB0aGVtLgoJbm9EYXRhOiB7CgkJImVtYmVkIjogdHJ1ZSwKCQkvLyBCYW4gYWxsIG9iamVjdHMgZXhjZXB0IGZvciBGbGFzaCAod2hpY2ggaGFuZGxlIGV4cGFuZG9zKQoJCSJvYmplY3QiOiAiY2xzaWQ6RDI3Q0RCNkUtQUU2RC0xMWNmLTk2QjgtNDQ0NTUzNTQwMDAwIiwKCQkiYXBwbGV0IjogdHJ1ZQoJfSwKCgloYXNEYXRhOiBmdW5jdGlvbiggZWxlbSApIHsKCQllbGVtID0gZWxlbS5ub2RlVHlwZSA/IGpRdWVyeS5jYWNoZVsgZWxlbVtqUXVlcnkuZXhwYW5kb10gXSA6IGVsZW1bIGpRdWVyeS5leHBhbmRvIF07CgkJcmV0dXJuICEhZWxlbSAmJiAhaXNFbXB0eURhdGFPYmplY3QoIGVsZW0gKTsKCX0sCgoJZGF0YTogZnVuY3Rpb24oIGVsZW0sIG5hbWUsIGRhdGEgKSB7CgkJcmV0dXJuIGludGVybmFsRGF0YSggZWxlbSwgbmFtZSwgZGF0YSApOwoJfSwKCglyZW1vdmVEYXRhOiBmdW5jdGlvbiggZWxlbSwgbmFtZSApIHsKCQlyZXR1cm4gaW50ZXJuYWxSZW1vdmVEYXRhKCBlbGVtLCBuYW1lICk7Cgl9LAoKCS8vIEZvciBpbnRlcm5hbCB1c2Ugb25seS4KCV9kYXRhOiBmdW5jdGlvbiggZWxlbSwgbmFtZSwgZGF0YSApIHsKCQlyZXR1cm4gaW50ZXJuYWxEYXRhKCBlbGVtLCBuYW1lLCBkYXRhLCB0cnVlICk7Cgl9LAoKCV9yZW1vdmVEYXRhOiBmdW5jdGlvbiggZWxlbSwgbmFtZSApIHsKCQlyZXR1cm4gaW50ZXJuYWxSZW1vdmVEYXRhKCBlbGVtLCBuYW1lLCB0cnVlICk7Cgl9LAoKCS8vIEEgbWV0aG9kIGZvciBkZXRlcm1pbmluZyBpZiBhIERPTSBub2RlIGNhbiBoYW5kbGUgdGhlIGRhdGEgZXhwYW5kbwoJYWNjZXB0RGF0YTogZnVuY3Rpb24oIGVsZW0gKSB7CgkJLy8gRG8gbm90IHNldCBkYXRhIG9uIG5vbi1lbGVtZW50IGJlY2F1c2UgaXQgd2lsbCBub3QgYmUgY2xlYXJlZCAoIzgzMzUpLgoJCWlmICggZWxlbS5ub2RlVHlwZSAmJiBlbGVtLm5vZGVUeXBlICE9PSAxICYmIGVsZW0ubm9kZVR5cGUgIT09IDkgKSB7CgkJCXJldHVybiBmYWxzZTsKCQl9CgoJCXZhciBub0RhdGEgPSBlbGVtLm5vZGVOYW1lICYmIGpRdWVyeS5ub0RhdGFbIGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSBdOwoKCQkvLyBub2RlcyBhY2NlcHQgZGF0YSB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZDsgcmVqZWN0aW9uIGNhbiBiZSBjb25kaXRpb25hbAoJCXJldHVybiAhbm9EYXRhIHx8IG5vRGF0YSAhPT0gdHJ1ZSAmJiBlbGVtLmdldEF0dHJpYnV0ZSgiY2xhc3NpZCIpID09PSBub0RhdGE7Cgl9Cn0pOwoKalF1ZXJ5LmZuLmV4dGVuZCh7CglkYXRhOiBmdW5jdGlvbigga2V5LCB2YWx1ZSApIHsKCQl2YXIgYXR0cnMsIG5hbWUsCgkJCWVsZW0gPSB0aGlzWzBdLAoJCQlpID0gMCwKCQkJZGF0YSA9IG51bGw7CgoJCS8vIEdldHMgYWxsIHZhbHVlcwoJCWlmICgga2V5ID09PSB1bmRlZmluZWQgKSB7CgkJCWlmICggdGhpcy5sZW5ndGggKSB7CgkJCQlkYXRhID0galF1ZXJ5LmRhdGEoIGVsZW0gKTsKCgkJCQlpZiAoIGVsZW0ubm9kZVR5cGUgPT09IDEgJiYgIWpRdWVyeS5fZGF0YSggZWxlbSwgInBhcnNlZEF0dHJzIiApICkgewoJCQkJCWF0dHJzID0gZWxlbS5hdHRyaWJ1dGVzOwoJCQkJCWZvciAoIDsgaSA8IGF0dHJzLmxlbmd0aDsgaSsrICkgewoJCQkJCQluYW1lID0gYXR0cnNbaV0ubmFtZTsKCgkJCQkJCWlmICggIW5hbWUuaW5kZXhPZiggImRhdGEtIiApICkgewoJCQkJCQkJbmFtZSA9IGpRdWVyeS5jYW1lbENhc2UoIG5hbWUuc2xpY2UoNSkgKTsKCgkJCQkJCQlkYXRhQXR0ciggZWxlbSwgbmFtZSwgZGF0YVsgbmFtZSBdICk7CgkJCQkJCX0KCQkJCQl9CgkJCQkJalF1ZXJ5Ll9kYXRhKCBlbGVtLCAicGFyc2VkQXR0cnMiLCB0cnVlICk7CgkJCQl9CgkJCX0KCgkJCXJldHVybiBkYXRhOwoJCX0KCgkJLy8gU2V0cyBtdWx0aXBsZSB2YWx1ZXMKCQlpZiAoIHR5cGVvZiBrZXkgPT09ICJvYmplY3QiICkgewoJCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCQkJalF1ZXJ5LmRhdGEoIHRoaXMsIGtleSApOwoJCQl9KTsKCQl9CgoJCXJldHVybiBqUXVlcnkuYWNjZXNzKCB0aGlzLCBmdW5jdGlvbiggdmFsdWUgKSB7CgoJCQlpZiAoIHZhbHVlID09PSB1bmRlZmluZWQgKSB7CgkJCQkvLyBUcnkgdG8gZmV0Y2ggYW55IGludGVybmFsbHkgc3RvcmVkIGRhdGEgZmlyc3QKCQkJCXJldHVybiBlbGVtID8gZGF0YUF0dHIoIGVsZW0sIGtleSwgalF1ZXJ5LmRhdGEoIGVsZW0sIGtleSApICkgOiBudWxsOwoJCQl9CgoJCQl0aGlzLmVhY2goZnVuY3Rpb24oKSB7CgkJCQlqUXVlcnkuZGF0YSggdGhpcywga2V5LCB2YWx1ZSApOwoJCQl9KTsKCQl9LCBudWxsLCB2YWx1ZSwgYXJndW1lbnRzLmxlbmd0aCA+IDEsIG51bGwsIHRydWUgKTsKCX0sCgoJcmVtb3ZlRGF0YTogZnVuY3Rpb24oIGtleSApIHsKCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCQlqUXVlcnkucmVtb3ZlRGF0YSggdGhpcywga2V5ICk7CgkJfSk7Cgl9Cn0pOwoKZnVuY3Rpb24gZGF0YUF0dHIoIGVsZW0sIGtleSwgZGF0YSApIHsKCS8vIElmIG5vdGhpbmcgd2FzIGZvdW5kIGludGVybmFsbHksIHRyeSB0byBmZXRjaCBhbnkKCS8vIGRhdGEgZnJvbSB0aGUgSFRNTDUgZGF0YS0qIGF0dHJpYnV0ZQoJaWYgKCBkYXRhID09PSB1bmRlZmluZWQgJiYgZWxlbS5ub2RlVHlwZSA9PT0gMSApIHsKCgkJdmFyIG5hbWUgPSAiZGF0YS0iICsga2V5LnJlcGxhY2UoIHJtdWx0aURhc2gsICItJDEiICkudG9Mb3dlckNhc2UoKTsKCgkJZGF0YSA9IGVsZW0uZ2V0QXR0cmlidXRlKCBuYW1lICk7CgoJCWlmICggdHlwZW9mIGRhdGEgPT09ICJzdHJpbmciICkgewoJCQl0cnkgewoJCQkJZGF0YSA9IGRhdGEgPT09ICJ0cnVlIiA/IHRydWUgOgoJCQkJCWRhdGEgPT09ICJmYWxzZSIgPyBmYWxzZSA6CgkJCQkJZGF0YSA9PT0gIm51bGwiID8gbnVsbCA6CgkJCQkJLy8gT25seSBjb252ZXJ0IHRvIGEgbnVtYmVyIGlmIGl0IGRvZXNuJ3QgY2hhbmdlIHRoZSBzdHJpbmcKCQkJCQkrZGF0YSArICIiID09PSBkYXRhID8gK2RhdGEgOgoJCQkJCXJicmFjZS50ZXN0KCBkYXRhICkgPyBqUXVlcnkucGFyc2VKU09OKCBkYXRhICkgOgoJCQkJCQlkYXRhOwoJCQl9IGNhdGNoKCBlICkge30KCgkJCS8vIE1ha2Ugc3VyZSB3ZSBzZXQgdGhlIGRhdGEgc28gaXQgaXNuJ3QgY2hhbmdlZCBsYXRlcgoJCQlqUXVlcnkuZGF0YSggZWxlbSwga2V5LCBkYXRhICk7CgoJCX0gZWxzZSB7CgkJCWRhdGEgPSB1bmRlZmluZWQ7CgkJfQoJfQoKCXJldHVybiBkYXRhOwp9CgovLyBjaGVja3MgYSBjYWNoZSBvYmplY3QgZm9yIGVtcHRpbmVzcwpmdW5jdGlvbiBpc0VtcHR5RGF0YU9iamVjdCggb2JqICkgewoJdmFyIG5hbWU7Cglmb3IgKCBuYW1lIGluIG9iaiApIHsKCgkJLy8gaWYgdGhlIHB1YmxpYyBkYXRhIG9iamVjdCBpcyBlbXB0eSwgdGhlIHByaXZhdGUgaXMgc3RpbGwgZW1wdHkKCQlpZiAoIG5hbWUgPT09ICJkYXRhIiAmJiBqUXVlcnkuaXNFbXB0eU9iamVjdCggb2JqW25hbWVdICkgKSB7CgkJCWNvbnRpbnVlOwoJCX0KCQlpZiAoIG5hbWUgIT09ICJ0b0pTT04iICkgewoJCQlyZXR1cm4gZmFsc2U7CgkJfQoJfQoKCXJldHVybiB0cnVlOwp9CmpRdWVyeS5leHRlbmQoewoJcXVldWU6IGZ1bmN0aW9uKCBlbGVtLCB0eXBlLCBkYXRhICkgewoJCXZhciBxdWV1ZTsKCgkJaWYgKCBlbGVtICkgewoJCQl0eXBlID0gKCB0eXBlIHx8ICJmeCIgKSArICJxdWV1ZSI7CgkJCXF1ZXVlID0galF1ZXJ5Ll9kYXRhKCBlbGVtLCB0eXBlICk7CgoJCQkvLyBTcGVlZCB1cCBkZXF1ZXVlIGJ5IGdldHRpbmcgb3V0IHF1aWNrbHkgaWYgdGhpcyBpcyBqdXN0IGEgbG9va3VwCgkJCWlmICggZGF0YSApIHsKCQkJCWlmICggIXF1ZXVlIHx8IGpRdWVyeS5pc0FycmF5KGRhdGEpICkgewoJCQkJCXF1ZXVlID0galF1ZXJ5Ll9kYXRhKCBlbGVtLCB0eXBlLCBqUXVlcnkubWFrZUFycmF5KGRhdGEpICk7CgkJCQl9IGVsc2UgewoJCQkJCXF1ZXVlLnB1c2goIGRhdGEgKTsKCQkJCX0KCQkJfQoJCQlyZXR1cm4gcXVldWUgfHwgW107CgkJfQoJfSwKCglkZXF1ZXVlOiBmdW5jdGlvbiggZWxlbSwgdHlwZSApIHsKCQl0eXBlID0gdHlwZSB8fCAiZngiOwoKCQl2YXIgcXVldWUgPSBqUXVlcnkucXVldWUoIGVsZW0sIHR5cGUgKSwKCQkJc3RhcnRMZW5ndGggPSBxdWV1ZS5sZW5ndGgsCgkJCWZuID0gcXVldWUuc2hpZnQoKSwKCQkJaG9va3MgPSBqUXVlcnkuX3F1ZXVlSG9va3MoIGVsZW0sIHR5cGUgKSwKCQkJbmV4dCA9IGZ1bmN0aW9uKCkgewoJCQkJalF1ZXJ5LmRlcXVldWUoIGVsZW0sIHR5cGUgKTsKCQkJfTsKCgkJLy8gSWYgdGhlIGZ4IHF1ZXVlIGlzIGRlcXVldWVkLCBhbHdheXMgcmVtb3ZlIHRoZSBwcm9ncmVzcyBzZW50aW5lbAoJCWlmICggZm4gPT09ICJpbnByb2dyZXNzIiApIHsKCQkJZm4gPSBxdWV1ZS5zaGlmdCgpOwoJCQlzdGFydExlbmd0aC0tOwoJCX0KCgkJaG9va3MuY3VyID0gZm47CgkJaWYgKCBmbiApIHsKCgkJCS8vIEFkZCBhIHByb2dyZXNzIHNlbnRpbmVsIHRvIHByZXZlbnQgdGhlIGZ4IHF1ZXVlIGZyb20gYmVpbmcKCQkJLy8gYXV0b21hdGljYWxseSBkZXF1ZXVlZAoJCQlpZiAoIHR5cGUgPT09ICJmeCIgKSB7CgkJCQlxdWV1ZS51bnNoaWZ0KCAiaW5wcm9ncmVzcyIgKTsKCQkJfQoKCQkJLy8gY2xlYXIgdXAgdGhlIGxhc3QgcXVldWUgc3RvcCBmdW5jdGlvbgoJCQlkZWxldGUgaG9va3Muc3RvcDsKCQkJZm4uY2FsbCggZWxlbSwgbmV4dCwgaG9va3MgKTsKCQl9CgoJCWlmICggIXN0YXJ0TGVuZ3RoICYmIGhvb2tzICkgewoJCQlob29rcy5lbXB0eS5maXJlKCk7CgkJfQoJfSwKCgkvLyBub3QgaW50ZW5kZWQgZm9yIHB1YmxpYyBjb25zdW1wdGlvbiAtIGdlbmVyYXRlcyBhIHF1ZXVlSG9va3Mgb2JqZWN0LCBvciByZXR1cm5zIHRoZSBjdXJyZW50IG9uZQoJX3F1ZXVlSG9va3M6IGZ1bmN0aW9uKCBlbGVtLCB0eXBlICkgewoJCXZhciBrZXkgPSB0eXBlICsgInF1ZXVlSG9va3MiOwoJCXJldHVybiBqUXVlcnkuX2RhdGEoIGVsZW0sIGtleSApIHx8IGpRdWVyeS5fZGF0YSggZWxlbSwga2V5LCB7CgkJCWVtcHR5OiBqUXVlcnkuQ2FsbGJhY2tzKCJvbmNlIG1lbW9yeSIpLmFkZChmdW5jdGlvbigpIHsKCQkJCWpRdWVyeS5fcmVtb3ZlRGF0YSggZWxlbSwgdHlwZSArICJxdWV1ZSIgKTsKCQkJCWpRdWVyeS5fcmVtb3ZlRGF0YSggZWxlbSwga2V5ICk7CgkJCX0pCgkJfSk7Cgl9Cn0pOwoKalF1ZXJ5LmZuLmV4dGVuZCh7CglxdWV1ZTogZnVuY3Rpb24oIHR5cGUsIGRhdGEgKSB7CgkJdmFyIHNldHRlciA9IDI7CgoJCWlmICggdHlwZW9mIHR5cGUgIT09ICJzdHJpbmciICkgewoJCQlkYXRhID0gdHlwZTsKCQkJdHlwZSA9ICJmeCI7CgkJCXNldHRlci0tOwoJCX0KCgkJaWYgKCBhcmd1bWVudHMubGVuZ3RoIDwgc2V0dGVyICkgewoJCQlyZXR1cm4galF1ZXJ5LnF1ZXVlKCB0aGlzWzBdLCB0eXBlICk7CgkJfQoKCQlyZXR1cm4gZGF0YSA9PT0gdW5kZWZpbmVkID8KCQkJdGhpcyA6CgkJCXRoaXMuZWFjaChmdW5jdGlvbigpIHsKCQkJCXZhciBxdWV1ZSA9IGpRdWVyeS5xdWV1ZSggdGhpcywgdHlwZSwgZGF0YSApOwoKCQkJCS8vIGVuc3VyZSBhIGhvb2tzIGZvciB0aGlzIHF1ZXVlCgkJCQlqUXVlcnkuX3F1ZXVlSG9va3MoIHRoaXMsIHR5cGUgKTsKCgkJCQlpZiAoIHR5cGUgPT09ICJmeCIgJiYgcXVldWVbMF0gIT09ICJpbnByb2dyZXNzIiApIHsKCQkJCQlqUXVlcnkuZGVxdWV1ZSggdGhpcywgdHlwZSApOwoJCQkJfQoJCQl9KTsKCX0sCglkZXF1ZXVlOiBmdW5jdGlvbiggdHlwZSApIHsKCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCQlqUXVlcnkuZGVxdWV1ZSggdGhpcywgdHlwZSApOwoJCX0pOwoJfSwKCS8vIEJhc2VkIG9mZiBvZiB0aGUgcGx1Z2luIGJ5IENsaW50IEhlbGZlcnMsIHdpdGggcGVybWlzc2lvbi4KCS8vIGh0dHA6Ly9ibGluZHNpZ25hbHMuY29tL2luZGV4LnBocC8yMDA5LzA3L2pxdWVyeS1kZWxheS8KCWRlbGF5OiBmdW5jdGlvbiggdGltZSwgdHlwZSApIHsKCQl0aW1lID0galF1ZXJ5LmZ4ID8galF1ZXJ5LmZ4LnNwZWVkc1sgdGltZSBdIHx8IHRpbWUgOiB0aW1lOwoJCXR5cGUgPSB0eXBlIHx8ICJmeCI7CgoJCXJldHVybiB0aGlzLnF1ZXVlKCB0eXBlLCBmdW5jdGlvbiggbmV4dCwgaG9va3MgKSB7CgkJCXZhciB0aW1lb3V0ID0gc2V0VGltZW91dCggbmV4dCwgdGltZSApOwoJCQlob29rcy5zdG9wID0gZnVuY3Rpb24oKSB7CgkJCQljbGVhclRpbWVvdXQoIHRpbWVvdXQgKTsKCQkJfTsKCQl9KTsKCX0sCgljbGVhclF1ZXVlOiBmdW5jdGlvbiggdHlwZSApIHsKCQlyZXR1cm4gdGhpcy5xdWV1ZSggdHlwZSB8fCAiZngiLCBbXSApOwoJfSwKCS8vIEdldCBhIHByb21pc2UgcmVzb2x2ZWQgd2hlbiBxdWV1ZXMgb2YgYSBjZXJ0YWluIHR5cGUKCS8vIGFyZSBlbXB0aWVkIChmeCBpcyB0aGUgdHlwZSBieSBkZWZhdWx0KQoJcHJvbWlzZTogZnVuY3Rpb24oIHR5cGUsIG9iaiApIHsKCQl2YXIgdG1wLAoJCQljb3VudCA9IDEsCgkJCWRlZmVyID0galF1ZXJ5LkRlZmVycmVkKCksCgkJCWVsZW1lbnRzID0gdGhpcywKCQkJaSA9IHRoaXMubGVuZ3RoLAoJCQlyZXNvbHZlID0gZnVuY3Rpb24oKSB7CgkJCQlpZiAoICEoIC0tY291bnQgKSApIHsKCQkJCQlkZWZlci5yZXNvbHZlV2l0aCggZWxlbWVudHMsIFsgZWxlbWVudHMgXSApOwoJCQkJfQoJCQl9OwoKCQlpZiAoIHR5cGVvZiB0eXBlICE9PSAic3RyaW5nIiApIHsKCQkJb2JqID0gdHlwZTsKCQkJdHlwZSA9IHVuZGVmaW5lZDsKCQl9CgkJdHlwZSA9IHR5cGUgfHwgImZ4IjsKCgkJd2hpbGUoIGktLSApIHsKCQkJdG1wID0galF1ZXJ5Ll9kYXRhKCBlbGVtZW50c1sgaSBdLCB0eXBlICsgInF1ZXVlSG9va3MiICk7CgkJCWlmICggdG1wICYmIHRtcC5lbXB0eSApIHsKCQkJCWNvdW50Kys7CgkJCQl0bXAuZW1wdHkuYWRkKCByZXNvbHZlICk7CgkJCX0KCQl9CgkJcmVzb2x2ZSgpOwoJCXJldHVybiBkZWZlci5wcm9taXNlKCBvYmogKTsKCX0KfSk7CnZhciBub2RlSG9vaywgYm9vbEhvb2ssCglyY2xhc3MgPSAvW1x0XHJcbl0vZywKCXJyZXR1cm4gPSAvXHIvZywKCXJmb2N1c2FibGUgPSAvXig/OmlucHV0fHNlbGVjdHx0ZXh0YXJlYXxidXR0b258b2JqZWN0KSQvaSwKCXJjbGlja2FibGUgPSAvXig/OmF8YXJlYSkkL2ksCglyYm9vbGVhbiA9IC9eKD86Y2hlY2tlZHxzZWxlY3RlZHxhdXRvZm9jdXN8YXV0b3BsYXl8YXN5bmN8Y29udHJvbHN8ZGVmZXJ8ZGlzYWJsZWR8aGlkZGVufGxvb3B8bXVsdGlwbGV8b3BlbnxyZWFkb25seXxyZXF1aXJlZHxzY29wZWQpJC9pLAoJcnVzZURlZmF1bHQgPSAvXig/OmNoZWNrZWR8c2VsZWN0ZWQpJC9pLAoJZ2V0U2V0QXR0cmlidXRlID0galF1ZXJ5LnN1cHBvcnQuZ2V0U2V0QXR0cmlidXRlLAoJZ2V0U2V0SW5wdXQgPSBqUXVlcnkuc3VwcG9ydC5pbnB1dDsKCmpRdWVyeS5mbi5leHRlbmQoewoJYXR0cjogZnVuY3Rpb24oIG5hbWUsIHZhbHVlICkgewoJCXJldHVybiBqUXVlcnkuYWNjZXNzKCB0aGlzLCBqUXVlcnkuYXR0ciwgbmFtZSwgdmFsdWUsIGFyZ3VtZW50cy5sZW5ndGggPiAxICk7Cgl9LAoKCXJlbW92ZUF0dHI6IGZ1bmN0aW9uKCBuYW1lICkgewoJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CgkJCWpRdWVyeS5yZW1vdmVBdHRyKCB0aGlzLCBuYW1lICk7CgkJfSk7Cgl9LAoKCXByb3A6IGZ1bmN0aW9uKCBuYW1lLCB2YWx1ZSApIHsKCQlyZXR1cm4galF1ZXJ5LmFjY2VzcyggdGhpcywgalF1ZXJ5LnByb3AsIG5hbWUsIHZhbHVlLCBhcmd1bWVudHMubGVuZ3RoID4gMSApOwoJfSwKCglyZW1vdmVQcm9wOiBmdW5jdGlvbiggbmFtZSApIHsKCQluYW1lID0galF1ZXJ5LnByb3BGaXhbIG5hbWUgXSB8fCBuYW1lOwoJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CgkJCS8vIHRyeS9jYXRjaCBoYW5kbGVzIGNhc2VzIHdoZXJlIElFIGJhbGtzIChzdWNoIGFzIHJlbW92aW5nIGEgcHJvcGVydHkgb24gd2luZG93KQoJCQl0cnkgewoJCQkJdGhpc1sgbmFtZSBdID0gdW5kZWZpbmVkOwoJCQkJZGVsZXRlIHRoaXNbIG5hbWUgXTsKCQkJfSBjYXRjaCggZSApIHt9CgkJfSk7Cgl9LAoKCWFkZENsYXNzOiBmdW5jdGlvbiggdmFsdWUgKSB7CgkJdmFyIGNsYXNzZXMsIGVsZW0sIGN1ciwgY2xhenosIGosCgkJCWkgPSAwLAoJCQlsZW4gPSB0aGlzLmxlbmd0aCwKCQkJcHJvY2VlZCA9IHR5cGVvZiB2YWx1ZSA9PT0gInN0cmluZyIgJiYgdmFsdWU7CgoJCWlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIHZhbHVlICkgKSB7CgkJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oIGogKSB7CgkJCQlqUXVlcnkoIHRoaXMgKS5hZGRDbGFzcyggdmFsdWUuY2FsbCggdGhpcywgaiwgdGhpcy5jbGFzc05hbWUgKSApOwoJCQl9KTsKCQl9CgoJCWlmICggcHJvY2VlZCApIHsKCQkJLy8gVGhlIGRpc2p1bmN0aW9uIGhlcmUgaXMgZm9yIGJldHRlciBjb21wcmVzc2liaWxpdHkgKHNlZSByZW1vdmVDbGFzcykKCQkJY2xhc3NlcyA9ICggdmFsdWUgfHwgIiIgKS5tYXRjaCggY29yZV9ybm90d2hpdGUgKSB8fCBbXTsKCgkJCWZvciAoIDsgaSA8IGxlbjsgaSsrICkgewoJCQkJZWxlbSA9IHRoaXNbIGkgXTsKCQkJCWN1ciA9IGVsZW0ubm9kZVR5cGUgPT09IDEgJiYgKCBlbGVtLmNsYXNzTmFtZSA/CgkJCQkJKCAiICIgKyBlbGVtLmNsYXNzTmFtZSArICIgIiApLnJlcGxhY2UoIHJjbGFzcywgIiAiICkgOgoJCQkJCSIgIgoJCQkJKTsKCgkJCQlpZiAoIGN1ciApIHsKCQkJCQlqID0gMDsKCQkJCQl3aGlsZSAoIChjbGF6eiA9IGNsYXNzZXNbaisrXSkgKSB7CgkJCQkJCWlmICggY3VyLmluZGV4T2YoICIgIiArIGNsYXp6ICsgIiAiICkgPCAwICkgewoJCQkJCQkJY3VyICs9IGNsYXp6ICsgIiAiOwoJCQkJCQl9CgkJCQkJfQoJCQkJCWVsZW0uY2xhc3NOYW1lID0galF1ZXJ5LnRyaW0oIGN1ciApOwoKCQkJCX0KCQkJfQoJCX0KCgkJcmV0dXJuIHRoaXM7Cgl9LAoKCXJlbW92ZUNsYXNzOiBmdW5jdGlvbiggdmFsdWUgKSB7CgkJdmFyIGNsYXNzZXMsIGVsZW0sIGN1ciwgY2xhenosIGosCgkJCWkgPSAwLAoJCQlsZW4gPSB0aGlzLmxlbmd0aCwKCQkJcHJvY2VlZCA9IGFyZ3VtZW50cy5sZW5ndGggPT09IDAgfHwgdHlwZW9mIHZhbHVlID09PSAic3RyaW5nIiAmJiB2YWx1ZTsKCgkJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggdmFsdWUgKSApIHsKCQkJcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiggaiApIHsKCQkJCWpRdWVyeSggdGhpcyApLnJlbW92ZUNsYXNzKCB2YWx1ZS5jYWxsKCB0aGlzLCBqLCB0aGlzLmNsYXNzTmFtZSApICk7CgkJCX0pOwoJCX0KCQlpZiAoIHByb2NlZWQgKSB7CgkJCWNsYXNzZXMgPSAoIHZhbHVlIHx8ICIiICkubWF0Y2goIGNvcmVfcm5vdHdoaXRlICkgfHwgW107CgoJCQlmb3IgKCA7IGkgPCBsZW47IGkrKyApIHsKCQkJCWVsZW0gPSB0aGlzWyBpIF07CgkJCQkvLyBUaGlzIGV4cHJlc3Npb24gaXMgaGVyZSBmb3IgYmV0dGVyIGNvbXByZXNzaWJpbGl0eSAoc2VlIGFkZENsYXNzKQoJCQkJY3VyID0gZWxlbS5ub2RlVHlwZSA9PT0gMSAmJiAoIGVsZW0uY2xhc3NOYW1lID8KCQkJCQkoICIgIiArIGVsZW0uY2xhc3NOYW1lICsgIiAiICkucmVwbGFjZSggcmNsYXNzLCAiICIgKSA6CgkJCQkJIiIKCQkJCSk7CgoJCQkJaWYgKCBjdXIgKSB7CgkJCQkJaiA9IDA7CgkJCQkJd2hpbGUgKCAoY2xhenogPSBjbGFzc2VzW2orK10pICkgewoJCQkJCQkvLyBSZW1vdmUgKmFsbCogaW5zdGFuY2VzCgkJCQkJCXdoaWxlICggY3VyLmluZGV4T2YoICIgIiArIGNsYXp6ICsgIiAiICkgPj0gMCApIHsKCQkJCQkJCWN1ciA9IGN1ci5yZXBsYWNlKCAiICIgKyBjbGF6eiArICIgIiwgIiAiICk7CgkJCQkJCX0KCQkJCQl9CgkJCQkJZWxlbS5jbGFzc05hbWUgPSB2YWx1ZSA/IGpRdWVyeS50cmltKCBjdXIgKSA6ICIiOwoJCQkJfQoJCQl9CgkJfQoKCQlyZXR1cm4gdGhpczsKCX0sCgoJdG9nZ2xlQ2xhc3M6IGZ1bmN0aW9uKCB2YWx1ZSwgc3RhdGVWYWwgKSB7CgkJdmFyIHR5cGUgPSB0eXBlb2YgdmFsdWUsCgkJCWlzQm9vbCA9IHR5cGVvZiBzdGF0ZVZhbCA9PT0gImJvb2xlYW4iOwoKCQlpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCB2YWx1ZSApICkgewoJCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCBpICkgewoJCQkJalF1ZXJ5KCB0aGlzICkudG9nZ2xlQ2xhc3MoIHZhbHVlLmNhbGwodGhpcywgaSwgdGhpcy5jbGFzc05hbWUsIHN0YXRlVmFsKSwgc3RhdGVWYWwgKTsKCQkJfSk7CgkJfQoKCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCQlpZiAoIHR5cGUgPT09ICJzdHJpbmciICkgewoJCQkJLy8gdG9nZ2xlIGluZGl2aWR1YWwgY2xhc3MgbmFtZXMKCQkJCXZhciBjbGFzc05hbWUsCgkJCQkJaSA9IDAsCgkJCQkJc2VsZiA9IGpRdWVyeSggdGhpcyApLAoJCQkJCXN0YXRlID0gc3RhdGVWYWwsCgkJCQkJY2xhc3NOYW1lcyA9IHZhbHVlLm1hdGNoKCBjb3JlX3Jub3R3aGl0ZSApIHx8IFtdOwoKCQkJCXdoaWxlICggKGNsYXNzTmFtZSA9IGNsYXNzTmFtZXNbIGkrKyBdKSApIHsKCQkJCQkvLyBjaGVjayBlYWNoIGNsYXNzTmFtZSBnaXZlbiwgc3BhY2Ugc2VwYXJhdGVkIGxpc3QKCQkJCQlzdGF0ZSA9IGlzQm9vbCA/IHN0YXRlIDogIXNlbGYuaGFzQ2xhc3MoIGNsYXNzTmFtZSApOwoJCQkJCXNlbGZbIHN0YXRlID8gImFkZENsYXNzIiA6ICJyZW1vdmVDbGFzcyIgXSggY2xhc3NOYW1lICk7CgkJCQl9CgoJCQkvLyBUb2dnbGUgd2hvbGUgY2xhc3MgbmFtZQoJCQl9IGVsc2UgaWYgKCB0eXBlID09PSBjb3JlX3N0cnVuZGVmaW5lZCB8fCB0eXBlID09PSAiYm9vbGVhbiIgKSB7CgkJCQlpZiAoIHRoaXMuY2xhc3NOYW1lICkgewoJCQkJCS8vIHN0b3JlIGNsYXNzTmFtZSBpZiBzZXQKCQkJCQlqUXVlcnkuX2RhdGEoIHRoaXMsICJfX2NsYXNzTmFtZV9fIiwgdGhpcy5jbGFzc05hbWUgKTsKCQkJCX0KCgkJCQkvLyBJZiB0aGUgZWxlbWVudCBoYXMgYSBjbGFzcyBuYW1lIG9yIGlmIHdlJ3JlIHBhc3NlZCAiZmFsc2UiLAoJCQkJLy8gdGhlbiByZW1vdmUgdGhlIHdob2xlIGNsYXNzbmFtZSAoaWYgdGhlcmUgd2FzIG9uZSwgdGhlIGFib3ZlIHNhdmVkIGl0KS4KCQkJCS8vIE90aGVyd2lzZSBicmluZyBiYWNrIHdoYXRldmVyIHdhcyBwcmV2aW91c2x5IHNhdmVkIChpZiBhbnl0aGluZyksCgkJCQkvLyBmYWxsaW5nIGJhY2sgdG8gdGhlIGVtcHR5IHN0cmluZyBpZiBub3RoaW5nIHdhcyBzdG9yZWQuCgkJCQl0aGlzLmNsYXNzTmFtZSA9IHRoaXMuY2xhc3NOYW1lIHx8IHZhbHVlID09PSBmYWxzZSA/ICIiIDogalF1ZXJ5Ll9kYXRhKCB0aGlzLCAiX19jbGFzc05hbWVfXyIgKSB8fCAiIjsKCQkJfQoJCX0pOwoJfSwKCgloYXNDbGFzczogZnVuY3Rpb24oIHNlbGVjdG9yICkgewoJCXZhciBjbGFzc05hbWUgPSAiICIgKyBzZWxlY3RvciArICIgIiwKCQkJaSA9IDAsCgkJCWwgPSB0aGlzLmxlbmd0aDsKCQlmb3IgKCA7IGkgPCBsOyBpKysgKSB7CgkJCWlmICggdGhpc1tpXS5ub2RlVHlwZSA9PT0gMSAmJiAoIiAiICsgdGhpc1tpXS5jbGFzc05hbWUgKyAiICIpLnJlcGxhY2UocmNsYXNzLCAiICIpLmluZGV4T2YoIGNsYXNzTmFtZSApID49IDAgKSB7CgkJCQlyZXR1cm4gdHJ1ZTsKCQkJfQoJCX0KCgkJcmV0dXJuIGZhbHNlOwoJfSwKCgl2YWw6IGZ1bmN0aW9uKCB2YWx1ZSApIHsKCQl2YXIgcmV0LCBob29rcywgaXNGdW5jdGlvbiwKCQkJZWxlbSA9IHRoaXNbMF07CgoJCWlmICggIWFyZ3VtZW50cy5sZW5ndGggKSB7CgkJCWlmICggZWxlbSApIHsKCQkJCWhvb2tzID0galF1ZXJ5LnZhbEhvb2tzWyBlbGVtLnR5cGUgXSB8fCBqUXVlcnkudmFsSG9va3NbIGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSBdOwoKCQkJCWlmICggaG9va3MgJiYgImdldCIgaW4gaG9va3MgJiYgKHJldCA9IGhvb2tzLmdldCggZWxlbSwgInZhbHVlIiApKSAhPT0gdW5kZWZpbmVkICkgewoJCQkJCXJldHVybiByZXQ7CgkJCQl9CgoJCQkJcmV0ID0gZWxlbS52YWx1ZTsKCgkJCQlyZXR1cm4gdHlwZW9mIHJldCA9PT0gInN0cmluZyIgPwoJCQkJCS8vIGhhbmRsZSBtb3N0IGNvbW1vbiBzdHJpbmcgY2FzZXMKCQkJCQlyZXQucmVwbGFjZShycmV0dXJuLCAiIikgOgoJCQkJCS8vIGhhbmRsZSBjYXNlcyB3aGVyZSB2YWx1ZSBpcyBudWxsL3VuZGVmIG9yIG51bWJlcgoJCQkJCXJldCA9PSBudWxsID8gIiIgOiByZXQ7CgkJCX0KCgkJCXJldHVybjsKCQl9CgoJCWlzRnVuY3Rpb24gPSBqUXVlcnkuaXNGdW5jdGlvbiggdmFsdWUgKTsKCgkJcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiggaSApIHsKCQkJdmFyIHZhbCwKCQkJCXNlbGYgPSBqUXVlcnkodGhpcyk7CgoJCQlpZiAoIHRoaXMubm9kZVR5cGUgIT09IDEgKSB7CgkJCQlyZXR1cm47CgkJCX0KCgkJCWlmICggaXNGdW5jdGlvbiApIHsKCQkJCXZhbCA9IHZhbHVlLmNhbGwoIHRoaXMsIGksIHNlbGYudmFsKCkgKTsKCQkJfSBlbHNlIHsKCQkJCXZhbCA9IHZhbHVlOwoJCQl9CgoJCQkvLyBUcmVhdCBudWxsL3VuZGVmaW5lZCBhcyAiIjsgY29udmVydCBudW1iZXJzIHRvIHN0cmluZwoJCQlpZiAoIHZhbCA9PSBudWxsICkgewoJCQkJdmFsID0gIiI7CgkJCX0gZWxzZSBpZiAoIHR5cGVvZiB2YWwgPT09ICJudW1iZXIiICkgewoJCQkJdmFsICs9ICIiOwoJCQl9IGVsc2UgaWYgKCBqUXVlcnkuaXNBcnJheSggdmFsICkgKSB7CgkJCQl2YWwgPSBqUXVlcnkubWFwKHZhbCwgZnVuY3Rpb24gKCB2YWx1ZSApIHsKCQkJCQlyZXR1cm4gdmFsdWUgPT0gbnVsbCA/ICIiIDogdmFsdWUgKyAiIjsKCQkJCX0pOwoJCQl9CgoJCQlob29rcyA9IGpRdWVyeS52YWxIb29rc1sgdGhpcy50eXBlIF0gfHwgalF1ZXJ5LnZhbEhvb2tzWyB0aGlzLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgXTsKCgkJCS8vIElmIHNldCByZXR1cm5zIHVuZGVmaW5lZCwgZmFsbCBiYWNrIHRvIG5vcm1hbCBzZXR0aW5nCgkJCWlmICggIWhvb2tzIHx8ICEoInNldCIgaW4gaG9va3MpIHx8IGhvb2tzLnNldCggdGhpcywgdmFsLCAidmFsdWUiICkgPT09IHVuZGVmaW5lZCApIHsKCQkJCXRoaXMudmFsdWUgPSB2YWw7CgkJCX0KCQl9KTsKCX0KfSk7CgpqUXVlcnkuZXh0ZW5kKHsKCXZhbEhvb2tzOiB7CgkJb3B0aW9uOiB7CgkJCWdldDogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCQkvLyBhdHRyaWJ1dGVzLnZhbHVlIGlzIHVuZGVmaW5lZCBpbiBCbGFja2JlcnJ5IDQuNyBidXQKCQkJCS8vIHVzZXMgLnZhbHVlLiBTZWUgIzY5MzIKCQkJCXZhciB2YWwgPSBlbGVtLmF0dHJpYnV0ZXMudmFsdWU7CgkJCQlyZXR1cm4gIXZhbCB8fCB2YWwuc3BlY2lmaWVkID8gZWxlbS52YWx1ZSA6IGVsZW0udGV4dDsKCQkJfQoJCX0sCgkJc2VsZWN0OiB7CgkJCWdldDogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCQl2YXIgdmFsdWUsIG9wdGlvbiwKCQkJCQlvcHRpb25zID0gZWxlbS5vcHRpb25zLAoJCQkJCWluZGV4ID0gZWxlbS5zZWxlY3RlZEluZGV4LAoJCQkJCW9uZSA9IGVsZW0udHlwZSA9PT0gInNlbGVjdC1vbmUiIHx8IGluZGV4IDwgMCwKCQkJCQl2YWx1ZXMgPSBvbmUgPyBudWxsIDogW10sCgkJCQkJbWF4ID0gb25lID8gaW5kZXggKyAxIDogb3B0aW9ucy5sZW5ndGgsCgkJCQkJaSA9IGluZGV4IDwgMCA/CgkJCQkJCW1heCA6CgkJCQkJCW9uZSA/IGluZGV4IDogMDsKCgkJCQkvLyBMb29wIHRocm91Z2ggYWxsIHRoZSBzZWxlY3RlZCBvcHRpb25zCgkJCQlmb3IgKCA7IGkgPCBtYXg7IGkrKyApIHsKCQkJCQlvcHRpb24gPSBvcHRpb25zWyBpIF07CgoJCQkJCS8vIG9sZElFIGRvZXNuJ3QgdXBkYXRlIHNlbGVjdGVkIGFmdGVyIGZvcm0gcmVzZXQgKCMyNTUxKQoJCQkJCWlmICggKCBvcHRpb24uc2VsZWN0ZWQgfHwgaSA9PT0gaW5kZXggKSAmJgoJCQkJCQkJLy8gRG9uJ3QgcmV0dXJuIG9wdGlvbnMgdGhhdCBhcmUgZGlzYWJsZWQgb3IgaW4gYSBkaXNhYmxlZCBvcHRncm91cAoJCQkJCQkJKCBqUXVlcnkuc3VwcG9ydC5vcHREaXNhYmxlZCA/ICFvcHRpb24uZGlzYWJsZWQgOiBvcHRpb24uZ2V0QXR0cmlidXRlKCJkaXNhYmxlZCIpID09PSBudWxsICkgJiYKCQkJCQkJCSggIW9wdGlvbi5wYXJlbnROb2RlLmRpc2FibGVkIHx8ICFqUXVlcnkubm9kZU5hbWUoIG9wdGlvbi5wYXJlbnROb2RlLCAib3B0Z3JvdXAiICkgKSApIHsKCgkJCQkJCS8vIEdldCB0aGUgc3BlY2lmaWMgdmFsdWUgZm9yIHRoZSBvcHRpb24KCQkJCQkJdmFsdWUgPSBqUXVlcnkoIG9wdGlvbiApLnZhbCgpOwoKCQkJCQkJLy8gV2UgZG9uJ3QgbmVlZCBhbiBhcnJheSBmb3Igb25lIHNlbGVjdHMKCQkJCQkJaWYgKCBvbmUgKSB7CgkJCQkJCQlyZXR1cm4gdmFsdWU7CgkJCQkJCX0KCgkJCQkJCS8vIE11bHRpLVNlbGVjdHMgcmV0dXJuIGFuIGFycmF5CgkJCQkJCXZhbHVlcy5wdXNoKCB2YWx1ZSApOwoJCQkJCX0KCQkJCX0KCgkJCQlyZXR1cm4gdmFsdWVzOwoJCQl9LAoKCQkJc2V0OiBmdW5jdGlvbiggZWxlbSwgdmFsdWUgKSB7CgkJCQl2YXIgdmFsdWVzID0galF1ZXJ5Lm1ha2VBcnJheSggdmFsdWUgKTsKCgkJCQlqUXVlcnkoZWxlbSkuZmluZCgib3B0aW9uIikuZWFjaChmdW5jdGlvbigpIHsKCQkJCQl0aGlzLnNlbGVjdGVkID0galF1ZXJ5LmluQXJyYXkoIGpRdWVyeSh0aGlzKS52YWwoKSwgdmFsdWVzICkgPj0gMDsKCQkJCX0pOwoKCQkJCWlmICggIXZhbHVlcy5sZW5ndGggKSB7CgkJCQkJZWxlbS5zZWxlY3RlZEluZGV4ID0gLTE7CgkJCQl9CgkJCQlyZXR1cm4gdmFsdWVzOwoJCQl9CgkJfQoJfSwKCglhdHRyOiBmdW5jdGlvbiggZWxlbSwgbmFtZSwgdmFsdWUgKSB7CgkJdmFyIGhvb2tzLCBub3R4bWwsIHJldCwKCQkJblR5cGUgPSBlbGVtLm5vZGVUeXBlOwoKCQkvLyBkb24ndCBnZXQvc2V0IGF0dHJpYnV0ZXMgb24gdGV4dCwgY29tbWVudCBhbmQgYXR0cmlidXRlIG5vZGVzCgkJaWYgKCAhZWxlbSB8fCBuVHlwZSA9PT0gMyB8fCBuVHlwZSA9PT0gOCB8fCBuVHlwZSA9PT0gMiApIHsKCQkJcmV0dXJuOwoJCX0KCgkJLy8gRmFsbGJhY2sgdG8gcHJvcCB3aGVuIGF0dHJpYnV0ZXMgYXJlIG5vdCBzdXBwb3J0ZWQKCQlpZiAoIHR5cGVvZiBlbGVtLmdldEF0dHJpYnV0ZSA9PT0gY29yZV9zdHJ1bmRlZmluZWQgKSB7CgkJCXJldHVybiBqUXVlcnkucHJvcCggZWxlbSwgbmFtZSwgdmFsdWUgKTsKCQl9CgoJCW5vdHhtbCA9IG5UeXBlICE9PSAxIHx8ICFqUXVlcnkuaXNYTUxEb2MoIGVsZW0gKTsKCgkJLy8gQWxsIGF0dHJpYnV0ZXMgYXJlIGxvd2VyY2FzZQoJCS8vIEdyYWIgbmVjZXNzYXJ5IGhvb2sgaWYgb25lIGlzIGRlZmluZWQKCQlpZiAoIG5vdHhtbCApIHsKCQkJbmFtZSA9IG5hbWUudG9Mb3dlckNhc2UoKTsKCQkJaG9va3MgPSBqUXVlcnkuYXR0ckhvb2tzWyBuYW1lIF0gfHwgKCByYm9vbGVhbi50ZXN0KCBuYW1lICkgPyBib29sSG9vayA6IG5vZGVIb29rICk7CgkJfQoKCQlpZiAoIHZhbHVlICE9PSB1bmRlZmluZWQgKSB7CgoJCQlpZiAoIHZhbHVlID09PSBudWxsICkgewoJCQkJalF1ZXJ5LnJlbW92ZUF0dHIoIGVsZW0sIG5hbWUgKTsKCgkJCX0gZWxzZSBpZiAoIGhvb2tzICYmIG5vdHhtbCAmJiAic2V0IiBpbiBob29rcyAmJiAocmV0ID0gaG9va3Muc2V0KCBlbGVtLCB2YWx1ZSwgbmFtZSApKSAhPT0gdW5kZWZpbmVkICkgewoJCQkJcmV0dXJuIHJldDsKCgkJCX0gZWxzZSB7CgkJCQllbGVtLnNldEF0dHJpYnV0ZSggbmFtZSwgdmFsdWUgKyAiIiApOwoJCQkJcmV0dXJuIHZhbHVlOwoJCQl9CgoJCX0gZWxzZSBpZiAoIGhvb2tzICYmIG5vdHhtbCAmJiAiZ2V0IiBpbiBob29rcyAmJiAocmV0ID0gaG9va3MuZ2V0KCBlbGVtLCBuYW1lICkpICE9PSBudWxsICkgewoJCQlyZXR1cm4gcmV0OwoKCQl9IGVsc2UgewoKCQkJLy8gSW4gSUU5KywgRmxhc2ggb2JqZWN0cyBkb24ndCBoYXZlIC5nZXRBdHRyaWJ1dGUgKCMxMjk0NSkKCQkJLy8gU3VwcG9ydDogSUU5KwoJCQlpZiAoIHR5cGVvZiBlbGVtLmdldEF0dHJpYnV0ZSAhPT0gY29yZV9zdHJ1bmRlZmluZWQgKSB7CgkJCQlyZXQgPSAgZWxlbS5nZXRBdHRyaWJ1dGUoIG5hbWUgKTsKCQkJfQoKCQkJLy8gTm9uLWV4aXN0ZW50IGF0dHJpYnV0ZXMgcmV0dXJuIG51bGwsIHdlIG5vcm1hbGl6ZSB0byB1bmRlZmluZWQKCQkJcmV0dXJuIHJldCA9PSBudWxsID8KCQkJCXVuZGVmaW5lZCA6CgkJCQlyZXQ7CgkJfQoJfSwKCglyZW1vdmVBdHRyOiBmdW5jdGlvbiggZWxlbSwgdmFsdWUgKSB7CgkJdmFyIG5hbWUsIHByb3BOYW1lLAoJCQlpID0gMCwKCQkJYXR0ck5hbWVzID0gdmFsdWUgJiYgdmFsdWUubWF0Y2goIGNvcmVfcm5vdHdoaXRlICk7CgoJCWlmICggYXR0ck5hbWVzICYmIGVsZW0ubm9kZVR5cGUgPT09IDEgKSB7CgkJCXdoaWxlICggKG5hbWUgPSBhdHRyTmFtZXNbaSsrXSkgKSB7CgkJCQlwcm9wTmFtZSA9IGpRdWVyeS5wcm9wRml4WyBuYW1lIF0gfHwgbmFtZTsKCgkJCQkvLyBCb29sZWFuIGF0dHJpYnV0ZXMgZ2V0IHNwZWNpYWwgdHJlYXRtZW50ICgjMTA4NzApCgkJCQlpZiAoIHJib29sZWFuLnRlc3QoIG5hbWUgKSApIHsKCQkJCQkvLyBTZXQgY29ycmVzcG9uZGluZyBwcm9wZXJ0eSB0byBmYWxzZSBmb3IgYm9vbGVhbiBhdHRyaWJ1dGVzCgkJCQkJLy8gQWxzbyBjbGVhciBkZWZhdWx0Q2hlY2tlZC9kZWZhdWx0U2VsZWN0ZWQgKGlmIGFwcHJvcHJpYXRlKSBmb3IgSUU8OAoJCQkJCWlmICggIWdldFNldEF0dHJpYnV0ZSAmJiBydXNlRGVmYXVsdC50ZXN0KCBuYW1lICkgKSB7CgkJCQkJCWVsZW1bIGpRdWVyeS5jYW1lbENhc2UoICJkZWZhdWx0LSIgKyBuYW1lICkgXSA9CgkJCQkJCQllbGVtWyBwcm9wTmFtZSBdID0gZmFsc2U7CgkJCQkJfSBlbHNlIHsKCQkJCQkJZWxlbVsgcHJvcE5hbWUgXSA9IGZhbHNlOwoJCQkJCX0KCgkJCQkvLyBTZWUgIzk2OTkgZm9yIGV4cGxhbmF0aW9uIG9mIHRoaXMgYXBwcm9hY2ggKHNldHRpbmcgZmlyc3QsIHRoZW4gcmVtb3ZhbCkKCQkJCX0gZWxzZSB7CgkJCQkJalF1ZXJ5LmF0dHIoIGVsZW0sIG5hbWUsICIiICk7CgkJCQl9CgoJCQkJZWxlbS5yZW1vdmVBdHRyaWJ1dGUoIGdldFNldEF0dHJpYnV0ZSA/IG5hbWUgOiBwcm9wTmFtZSApOwoJCQl9CgkJfQoJfSwKCglhdHRySG9va3M6IHsKCQl0eXBlOiB7CgkJCXNldDogZnVuY3Rpb24oIGVsZW0sIHZhbHVlICkgewoJCQkJaWYgKCAhalF1ZXJ5LnN1cHBvcnQucmFkaW9WYWx1ZSAmJiB2YWx1ZSA9PT0gInJhZGlvIiAmJiBqUXVlcnkubm9kZU5hbWUoZWxlbSwgImlucHV0IikgKSB7CgkJCQkJLy8gU2V0dGluZyB0aGUgdHlwZSBvbiBhIHJhZGlvIGJ1dHRvbiBhZnRlciB0aGUgdmFsdWUgcmVzZXRzIHRoZSB2YWx1ZSBpbiBJRTYtOQoJCQkJCS8vIFJlc2V0IHZhbHVlIHRvIGRlZmF1bHQgaW4gY2FzZSB0eXBlIGlzIHNldCBhZnRlciB2YWx1ZSBkdXJpbmcgY3JlYXRpb24KCQkJCQl2YXIgdmFsID0gZWxlbS52YWx1ZTsKCQkJCQllbGVtLnNldEF0dHJpYnV0ZSggInR5cGUiLCB2YWx1ZSApOwoJCQkJCWlmICggdmFsICkgewoJCQkJCQllbGVtLnZhbHVlID0gdmFsOwoJCQkJCX0KCQkJCQlyZXR1cm4gdmFsdWU7CgkJCQl9CgkJCX0KCQl9Cgl9LAoKCXByb3BGaXg6IHsKCQl0YWJpbmRleDogInRhYkluZGV4IiwKCQlyZWFkb25seTogInJlYWRPbmx5IiwKCQkiZm9yIjogImh0bWxGb3IiLAoJCSJjbGFzcyI6ICJjbGFzc05hbWUiLAoJCW1heGxlbmd0aDogIm1heExlbmd0aCIsCgkJY2VsbHNwYWNpbmc6ICJjZWxsU3BhY2luZyIsCgkJY2VsbHBhZGRpbmc6ICJjZWxsUGFkZGluZyIsCgkJcm93c3BhbjogInJvd1NwYW4iLAoJCWNvbHNwYW46ICJjb2xTcGFuIiwKCQl1c2VtYXA6ICJ1c2VNYXAiLAoJCWZyYW1lYm9yZGVyOiAiZnJhbWVCb3JkZXIiLAoJCWNvbnRlbnRlZGl0YWJsZTogImNvbnRlbnRFZGl0YWJsZSIKCX0sCgoJcHJvcDogZnVuY3Rpb24oIGVsZW0sIG5hbWUsIHZhbHVlICkgewoJCXZhciByZXQsIGhvb2tzLCBub3R4bWwsCgkJCW5UeXBlID0gZWxlbS5ub2RlVHlwZTsKCgkJLy8gZG9uJ3QgZ2V0L3NldCBwcm9wZXJ0aWVzIG9uIHRleHQsIGNvbW1lbnQgYW5kIGF0dHJpYnV0ZSBub2RlcwoJCWlmICggIWVsZW0gfHwgblR5cGUgPT09IDMgfHwgblR5cGUgPT09IDggfHwgblR5cGUgPT09IDIgKSB7CgkJCXJldHVybjsKCQl9CgoJCW5vdHhtbCA9IG5UeXBlICE9PSAxIHx8ICFqUXVlcnkuaXNYTUxEb2MoIGVsZW0gKTsKCgkJaWYgKCBub3R4bWwgKSB7CgkJCS8vIEZpeCBuYW1lIGFuZCBhdHRhY2ggaG9va3MKCQkJbmFtZSA9IGpRdWVyeS5wcm9wRml4WyBuYW1lIF0gfHwgbmFtZTsKCQkJaG9va3MgPSBqUXVlcnkucHJvcEhvb2tzWyBuYW1lIF07CgkJfQoKCQlpZiAoIHZhbHVlICE9PSB1bmRlZmluZWQgKSB7CgkJCWlmICggaG9va3MgJiYgInNldCIgaW4gaG9va3MgJiYgKHJldCA9IGhvb2tzLnNldCggZWxlbSwgdmFsdWUsIG5hbWUgKSkgIT09IHVuZGVmaW5lZCApIHsKCQkJCXJldHVybiByZXQ7CgoJCQl9IGVsc2UgewoJCQkJcmV0dXJuICggZWxlbVsgbmFtZSBdID0gdmFsdWUgKTsKCQkJfQoKCQl9IGVsc2UgewoJCQlpZiAoIGhvb2tzICYmICJnZXQiIGluIGhvb2tzICYmIChyZXQgPSBob29rcy5nZXQoIGVsZW0sIG5hbWUgKSkgIT09IG51bGwgKSB7CgkJCQlyZXR1cm4gcmV0OwoKCQkJfSBlbHNlIHsKCQkJCXJldHVybiBlbGVtWyBuYW1lIF07CgkJCX0KCQl9Cgl9LAoKCXByb3BIb29rczogewoJCXRhYkluZGV4OiB7CgkJCWdldDogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCQkvLyBlbGVtLnRhYkluZGV4IGRvZXNuJ3QgYWx3YXlzIHJldHVybiB0aGUgY29ycmVjdCB2YWx1ZSB3aGVuIGl0IGhhc24ndCBiZWVuIGV4cGxpY2l0bHkgc2V0CgkJCQkvLyBodHRwOi8vZmx1aWRwcm9qZWN0Lm9yZy9ibG9nLzIwMDgvMDEvMDkvZ2V0dGluZy1zZXR0aW5nLWFuZC1yZW1vdmluZy10YWJpbmRleC12YWx1ZXMtd2l0aC1qYXZhc2NyaXB0LwoJCQkJdmFyIGF0dHJpYnV0ZU5vZGUgPSBlbGVtLmdldEF0dHJpYnV0ZU5vZGUoInRhYmluZGV4Iik7CgoJCQkJcmV0dXJuIGF0dHJpYnV0ZU5vZGUgJiYgYXR0cmlidXRlTm9kZS5zcGVjaWZpZWQgPwoJCQkJCXBhcnNlSW50KCBhdHRyaWJ1dGVOb2RlLnZhbHVlLCAxMCApIDoKCQkJCQlyZm9jdXNhYmxlLnRlc3QoIGVsZW0ubm9kZU5hbWUgKSB8fCByY2xpY2thYmxlLnRlc3QoIGVsZW0ubm9kZU5hbWUgKSAmJiBlbGVtLmhyZWYgPwoJCQkJCQkwIDoKCQkJCQkJdW5kZWZpbmVkOwoJCQl9CgkJfQoJfQp9KTsKCi8vIEhvb2sgZm9yIGJvb2xlYW4gYXR0cmlidXRlcwpib29sSG9vayA9IHsKCWdldDogZnVuY3Rpb24oIGVsZW0sIG5hbWUgKSB7CgkJdmFyCgkJCS8vIFVzZSAucHJvcCB0byBkZXRlcm1pbmUgaWYgdGhpcyBhdHRyaWJ1dGUgaXMgdW5kZXJzdG9vZCBhcyBib29sZWFuCgkJCXByb3AgPSBqUXVlcnkucHJvcCggZWxlbSwgbmFtZSApLAoKCQkJLy8gRmV0Y2ggaXQgYWNjb3JkaW5nbHkKCQkJYXR0ciA9IHR5cGVvZiBwcm9wID09PSAiYm9vbGVhbiIgJiYgZWxlbS5nZXRBdHRyaWJ1dGUoIG5hbWUgKSwKCQkJZGV0YWlsID0gdHlwZW9mIHByb3AgPT09ICJib29sZWFuIiA/CgoJCQkJZ2V0U2V0SW5wdXQgJiYgZ2V0U2V0QXR0cmlidXRlID8KCQkJCQlhdHRyICE9IG51bGwgOgoJCQkJCS8vIG9sZElFIGZhYnJpY2F0ZXMgYW4gZW1wdHkgc3RyaW5nIGZvciBtaXNzaW5nIGJvb2xlYW4gYXR0cmlidXRlcwoJCQkJCS8vIGFuZCBjb25mbGF0ZXMgY2hlY2tlZC9zZWxlY3RlZCBpbnRvIGF0dHJvcGVydGllcwoJCQkJCXJ1c2VEZWZhdWx0LnRlc3QoIG5hbWUgKSA/CgkJCQkJCWVsZW1bIGpRdWVyeS5jYW1lbENhc2UoICJkZWZhdWx0LSIgKyBuYW1lICkgXSA6CgkJCQkJCSEhYXR0ciA6CgoJCQkJLy8gZmV0Y2ggYW4gYXR0cmlidXRlIG5vZGUgZm9yIHByb3BlcnRpZXMgbm90IHJlY29nbml6ZWQgYXMgYm9vbGVhbgoJCQkJZWxlbS5nZXRBdHRyaWJ1dGVOb2RlKCBuYW1lICk7CgoJCXJldHVybiBkZXRhaWwgJiYgZGV0YWlsLnZhbHVlICE9PSBmYWxzZSA/CgkJCW5hbWUudG9Mb3dlckNhc2UoKSA6CgkJCXVuZGVmaW5lZDsKCX0sCglzZXQ6IGZ1bmN0aW9uKCBlbGVtLCB2YWx1ZSwgbmFtZSApIHsKCQlpZiAoIHZhbHVlID09PSBmYWxzZSApIHsKCQkJLy8gUmVtb3ZlIGJvb2xlYW4gYXR0cmlidXRlcyB3aGVuIHNldCB0byBmYWxzZQoJCQlqUXVlcnkucmVtb3ZlQXR0ciggZWxlbSwgbmFtZSApOwoJCX0gZWxzZSBpZiAoIGdldFNldElucHV0ICYmIGdldFNldEF0dHJpYnV0ZSB8fCAhcnVzZURlZmF1bHQudGVzdCggbmFtZSApICkgewoJCQkvLyBJRTw4IG5lZWRzIHRoZSAqcHJvcGVydHkqIG5hbWUKCQkJZWxlbS5zZXRBdHRyaWJ1dGUoICFnZXRTZXRBdHRyaWJ1dGUgJiYgalF1ZXJ5LnByb3BGaXhbIG5hbWUgXSB8fCBuYW1lLCBuYW1lICk7CgoJCS8vIFVzZSBkZWZhdWx0Q2hlY2tlZCBhbmQgZGVmYXVsdFNlbGVjdGVkIGZvciBvbGRJRQoJCX0gZWxzZSB7CgkJCWVsZW1bIGpRdWVyeS5jYW1lbENhc2UoICJkZWZhdWx0LSIgKyBuYW1lICkgXSA9IGVsZW1bIG5hbWUgXSA9IHRydWU7CgkJfQoKCQlyZXR1cm4gbmFtZTsKCX0KfTsKCi8vIGZpeCBvbGRJRSB2YWx1ZSBhdHRyb3BlcnR5CmlmICggIWdldFNldElucHV0IHx8ICFnZXRTZXRBdHRyaWJ1dGUgKSB7CglqUXVlcnkuYXR0ckhvb2tzLnZhbHVlID0gewoJCWdldDogZnVuY3Rpb24oIGVsZW0sIG5hbWUgKSB7CgkJCXZhciByZXQgPSBlbGVtLmdldEF0dHJpYnV0ZU5vZGUoIG5hbWUgKTsKCQkJcmV0dXJuIGpRdWVyeS5ub2RlTmFtZSggZWxlbSwgImlucHV0IiApID8KCgkJCQkvLyBJZ25vcmUgdGhlIHZhbHVlICpwcm9wZXJ0eSogYnkgdXNpbmcgZGVmYXVsdFZhbHVlCgkJCQllbGVtLmRlZmF1bHRWYWx1ZSA6CgoJCQkJcmV0ICYmIHJldC5zcGVjaWZpZWQgPyByZXQudmFsdWUgOiB1bmRlZmluZWQ7CgkJfSwKCQlzZXQ6IGZ1bmN0aW9uKCBlbGVtLCB2YWx1ZSwgbmFtZSApIHsKCQkJaWYgKCBqUXVlcnkubm9kZU5hbWUoIGVsZW0sICJpbnB1dCIgKSApIHsKCQkJCS8vIERvZXMgbm90IHJldHVybiBzbyB0aGF0IHNldEF0dHJpYnV0ZSBpcyBhbHNvIHVzZWQKCQkJCWVsZW0uZGVmYXVsdFZhbHVlID0gdmFsdWU7CgkJCX0gZWxzZSB7CgkJCQkvLyBVc2Ugbm9kZUhvb2sgaWYgZGVmaW5lZCAoIzE5NTQpOyBvdGhlcndpc2Ugc2V0QXR0cmlidXRlIGlzIGZpbmUKCQkJCXJldHVybiBub2RlSG9vayAmJiBub2RlSG9vay5zZXQoIGVsZW0sIHZhbHVlLCBuYW1lICk7CgkJCX0KCQl9Cgl9Owp9CgovLyBJRTYvNyBkbyBub3Qgc3VwcG9ydCBnZXR0aW5nL3NldHRpbmcgc29tZSBhdHRyaWJ1dGVzIHdpdGggZ2V0L3NldEF0dHJpYnV0ZQppZiAoICFnZXRTZXRBdHRyaWJ1dGUgKSB7CgoJLy8gVXNlIHRoaXMgZm9yIGFueSBhdHRyaWJ1dGUgaW4gSUU2LzcKCS8vIFRoaXMgZml4ZXMgYWxtb3N0IGV2ZXJ5IElFNi83IGlzc3VlCglub2RlSG9vayA9IGpRdWVyeS52YWxIb29rcy5idXR0b24gPSB7CgkJZ2V0OiBmdW5jdGlvbiggZWxlbSwgbmFtZSApIHsKCQkJdmFyIHJldCA9IGVsZW0uZ2V0QXR0cmlidXRlTm9kZSggbmFtZSApOwoJCQlyZXR1cm4gcmV0ICYmICggbmFtZSA9PT0gImlkIiB8fCBuYW1lID09PSAibmFtZSIgfHwgbmFtZSA9PT0gImNvb3JkcyIgPyByZXQudmFsdWUgIT09ICIiIDogcmV0LnNwZWNpZmllZCApID8KCQkJCXJldC52YWx1ZSA6CgkJCQl1bmRlZmluZWQ7CgkJfSwKCQlzZXQ6IGZ1bmN0aW9uKCBlbGVtLCB2YWx1ZSwgbmFtZSApIHsKCQkJLy8gU2V0IHRoZSBleGlzdGluZyBvciBjcmVhdGUgYSBuZXcgYXR0cmlidXRlIG5vZGUKCQkJdmFyIHJldCA9IGVsZW0uZ2V0QXR0cmlidXRlTm9kZSggbmFtZSApOwoJCQlpZiAoICFyZXQgKSB7CgkJCQllbGVtLnNldEF0dHJpYnV0ZU5vZGUoCgkJCQkJKHJldCA9IGVsZW0ub3duZXJEb2N1bWVudC5jcmVhdGVBdHRyaWJ1dGUoIG5hbWUgKSkKCQkJCSk7CgkJCX0KCgkJCXJldC52YWx1ZSA9IHZhbHVlICs9ICIiOwoKCQkJLy8gQnJlYWsgYXNzb2NpYXRpb24gd2l0aCBjbG9uZWQgZWxlbWVudHMgYnkgYWxzbyB1c2luZyBzZXRBdHRyaWJ1dGUgKCM5NjQ2KQoJCQlyZXR1cm4gbmFtZSA9PT0gInZhbHVlIiB8fCB2YWx1ZSA9PT0gZWxlbS5nZXRBdHRyaWJ1dGUoIG5hbWUgKSA/CgkJCQl2YWx1ZSA6CgkJCQl1bmRlZmluZWQ7CgkJfQoJfTsKCgkvLyBTZXQgY29udGVudGVkaXRhYmxlIHRvIGZhbHNlIG9uIHJlbW92YWxzKCMxMDQyOSkKCS8vIFNldHRpbmcgdG8gZW1wdHkgc3RyaW5nIHRocm93cyBhbiBlcnJvciBhcyBhbiBpbnZhbGlkIHZhbHVlCglqUXVlcnkuYXR0ckhvb2tzLmNvbnRlbnRlZGl0YWJsZSA9IHsKCQlnZXQ6IG5vZGVIb29rLmdldCwKCQlzZXQ6IGZ1bmN0aW9uKCBlbGVtLCB2YWx1ZSwgbmFtZSApIHsKCQkJbm9kZUhvb2suc2V0KCBlbGVtLCB2YWx1ZSA9PT0gIiIgPyBmYWxzZSA6IHZhbHVlLCBuYW1lICk7CgkJfQoJfTsKCgkvLyBTZXQgd2lkdGggYW5kIGhlaWdodCB0byBhdXRvIGluc3RlYWQgb2YgMCBvbiBlbXB0eSBzdHJpbmcoIEJ1ZyAjODE1MCApCgkvLyBUaGlzIGlzIGZvciByZW1vdmFscwoJalF1ZXJ5LmVhY2goWyAid2lkdGgiLCAiaGVpZ2h0IiBdLCBmdW5jdGlvbiggaSwgbmFtZSApIHsKCQlqUXVlcnkuYXR0ckhvb2tzWyBuYW1lIF0gPSBqUXVlcnkuZXh0ZW5kKCBqUXVlcnkuYXR0ckhvb2tzWyBuYW1lIF0sIHsKCQkJc2V0OiBmdW5jdGlvbiggZWxlbSwgdmFsdWUgKSB7CgkJCQlpZiAoIHZhbHVlID09PSAiIiApIHsKCQkJCQllbGVtLnNldEF0dHJpYnV0ZSggbmFtZSwgImF1dG8iICk7CgkJCQkJcmV0dXJuIHZhbHVlOwoJCQkJfQoJCQl9CgkJfSk7Cgl9KTsKfQoKCi8vIFNvbWUgYXR0cmlidXRlcyByZXF1aXJlIGEgc3BlY2lhbCBjYWxsIG9uIElFCi8vIGh0dHA6Ly9tc2RuLm1pY3Jvc29mdC5jb20vZW4tdXMvbGlicmFyeS9tczUzNjQyOSUyOFZTLjg1JTI5LmFzcHgKaWYgKCAhalF1ZXJ5LnN1cHBvcnQuaHJlZk5vcm1hbGl6ZWQgKSB7CglqUXVlcnkuZWFjaChbICJocmVmIiwgInNyYyIsICJ3aWR0aCIsICJoZWlnaHQiIF0sIGZ1bmN0aW9uKCBpLCBuYW1lICkgewoJCWpRdWVyeS5hdHRySG9va3NbIG5hbWUgXSA9IGpRdWVyeS5leHRlbmQoIGpRdWVyeS5hdHRySG9va3NbIG5hbWUgXSwgewoJCQlnZXQ6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJdmFyIHJldCA9IGVsZW0uZ2V0QXR0cmlidXRlKCBuYW1lLCAyICk7CgkJCQlyZXR1cm4gcmV0ID09IG51bGwgPyB1bmRlZmluZWQgOiByZXQ7CgkJCX0KCQl9KTsKCX0pOwoKCS8vIGhyZWYvc3JjIHByb3BlcnR5IHNob3VsZCBnZXQgdGhlIGZ1bGwgbm9ybWFsaXplZCBVUkwgKCMxMDI5OS8jMTI5MTUpCglqUXVlcnkuZWFjaChbICJocmVmIiwgInNyYyIgXSwgZnVuY3Rpb24oIGksIG5hbWUgKSB7CgkJalF1ZXJ5LnByb3BIb29rc1sgbmFtZSBdID0gewoJCQlnZXQ6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJcmV0dXJuIGVsZW0uZ2V0QXR0cmlidXRlKCBuYW1lLCA0ICk7CgkJCX0KCQl9OwoJfSk7Cn0KCmlmICggIWpRdWVyeS5zdXBwb3J0LnN0eWxlICkgewoJalF1ZXJ5LmF0dHJIb29rcy5zdHlsZSA9IHsKCQlnZXQ6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQkvLyBSZXR1cm4gdW5kZWZpbmVkIGluIHRoZSBjYXNlIG9mIGVtcHR5IHN0cmluZwoJCQkvLyBOb3RlOiBJRSB1cHBlcmNhc2VzIGNzcyBwcm9wZXJ0eSBuYW1lcywgYnV0IGlmIHdlIHdlcmUgdG8gLnRvTG93ZXJDYXNlKCkKCQkJLy8gLmNzc1RleHQsIHRoYXQgd291bGQgZGVzdHJveSBjYXNlIHNlbnN0aXRpdml0eSBpbiBVUkwncywgbGlrZSBpbiAiYmFja2dyb3VuZCIKCQkJcmV0dXJuIGVsZW0uc3R5bGUuY3NzVGV4dCB8fCB1bmRlZmluZWQ7CgkJfSwKCQlzZXQ6IGZ1bmN0aW9uKCBlbGVtLCB2YWx1ZSApIHsKCQkJcmV0dXJuICggZWxlbS5zdHlsZS5jc3NUZXh0ID0gdmFsdWUgKyAiIiApOwoJCX0KCX07Cn0KCi8vIFNhZmFyaSBtaXMtcmVwb3J0cyB0aGUgZGVmYXVsdCBzZWxlY3RlZCBwcm9wZXJ0eSBvZiBhbiBvcHRpb24KLy8gQWNjZXNzaW5nIHRoZSBwYXJlbnQncyBzZWxlY3RlZEluZGV4IHByb3BlcnR5IGZpeGVzIGl0CmlmICggIWpRdWVyeS5zdXBwb3J0Lm9wdFNlbGVjdGVkICkgewoJalF1ZXJ5LnByb3BIb29rcy5zZWxlY3RlZCA9IGpRdWVyeS5leHRlbmQoIGpRdWVyeS5wcm9wSG9va3Muc2VsZWN0ZWQsIHsKCQlnZXQ6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQl2YXIgcGFyZW50ID0gZWxlbS5wYXJlbnROb2RlOwoKCQkJaWYgKCBwYXJlbnQgKSB7CgkJCQlwYXJlbnQuc2VsZWN0ZWRJbmRleDsKCgkJCQkvLyBNYWtlIHN1cmUgdGhhdCBpdCBhbHNvIHdvcmtzIHdpdGggb3B0Z3JvdXBzLCBzZWUgIzU3MDEKCQkJCWlmICggcGFyZW50LnBhcmVudE5vZGUgKSB7CgkJCQkJcGFyZW50LnBhcmVudE5vZGUuc2VsZWN0ZWRJbmRleDsKCQkJCX0KCQkJfQoJCQlyZXR1cm4gbnVsbDsKCQl9Cgl9KTsKfQoKLy8gSUU2LzcgY2FsbCBlbmN0eXBlIGVuY29kaW5nCmlmICggIWpRdWVyeS5zdXBwb3J0LmVuY3R5cGUgKSB7CglqUXVlcnkucHJvcEZpeC5lbmN0eXBlID0gImVuY29kaW5nIjsKfQoKLy8gUmFkaW9zIGFuZCBjaGVja2JveGVzIGdldHRlci9zZXR0ZXIKaWYgKCAhalF1ZXJ5LnN1cHBvcnQuY2hlY2tPbiApIHsKCWpRdWVyeS5lYWNoKFsgInJhZGlvIiwgImNoZWNrYm94IiBdLCBmdW5jdGlvbigpIHsKCQlqUXVlcnkudmFsSG9va3NbIHRoaXMgXSA9IHsKCQkJZ2V0OiBmdW5jdGlvbiggZWxlbSApIHsKCQkJCS8vIEhhbmRsZSB0aGUgY2FzZSB3aGVyZSBpbiBXZWJraXQgIiIgaXMgcmV0dXJuZWQgaW5zdGVhZCBvZiAib24iIGlmIGEgdmFsdWUgaXNuJ3Qgc3BlY2lmaWVkCgkJCQlyZXR1cm4gZWxlbS5nZXRBdHRyaWJ1dGUoInZhbHVlIikgPT09IG51bGwgPyAib24iIDogZWxlbS52YWx1ZTsKCQkJfQoJCX07Cgl9KTsKfQpqUXVlcnkuZWFjaChbICJyYWRpbyIsICJjaGVja2JveCIgXSwgZnVuY3Rpb24oKSB7CglqUXVlcnkudmFsSG9va3NbIHRoaXMgXSA9IGpRdWVyeS5leHRlbmQoIGpRdWVyeS52YWxIb29rc1sgdGhpcyBdLCB7CgkJc2V0OiBmdW5jdGlvbiggZWxlbSwgdmFsdWUgKSB7CgkJCWlmICggalF1ZXJ5LmlzQXJyYXkoIHZhbHVlICkgKSB7CgkJCQlyZXR1cm4gKCBlbGVtLmNoZWNrZWQgPSBqUXVlcnkuaW5BcnJheSggalF1ZXJ5KGVsZW0pLnZhbCgpLCB2YWx1ZSApID49IDAgKTsKCQkJfQoJCX0KCX0pOwp9KTsKdmFyIHJmb3JtRWxlbXMgPSAvXig/OmlucHV0fHNlbGVjdHx0ZXh0YXJlYSkkL2ksCglya2V5RXZlbnQgPSAvXmtleS8sCglybW91c2VFdmVudCA9IC9eKD86bW91c2V8Y29udGV4dG1lbnUpfGNsaWNrLywKCXJmb2N1c01vcnBoID0gL14oPzpmb2N1c2luZm9jdXN8Zm9jdXNvdXRibHVyKSQvLAoJcnR5cGVuYW1lc3BhY2UgPSAvXihbXi5dKikoPzpcLiguKyl8KSQvOwoKZnVuY3Rpb24gcmV0dXJuVHJ1ZSgpIHsKCXJldHVybiB0cnVlOwp9CgpmdW5jdGlvbiByZXR1cm5GYWxzZSgpIHsKCXJldHVybiBmYWxzZTsKfQoKLyoKICogSGVscGVyIGZ1bmN0aW9ucyBmb3IgbWFuYWdpbmcgZXZlbnRzIC0tIG5vdCBwYXJ0IG9mIHRoZSBwdWJsaWMgaW50ZXJmYWNlLgogKiBQcm9wcyB0byBEZWFuIEVkd2FyZHMnIGFkZEV2ZW50IGxpYnJhcnkgZm9yIG1hbnkgb2YgdGhlIGlkZWFzLgogKi8KalF1ZXJ5LmV2ZW50ID0gewoKCWdsb2JhbDoge30sCgoJYWRkOiBmdW5jdGlvbiggZWxlbSwgdHlwZXMsIGhhbmRsZXIsIGRhdGEsIHNlbGVjdG9yICkgewoJCXZhciB0bXAsIGV2ZW50cywgdCwgaGFuZGxlT2JqSW4sCgkJCXNwZWNpYWwsIGV2ZW50SGFuZGxlLCBoYW5kbGVPYmosCgkJCWhhbmRsZXJzLCB0eXBlLCBuYW1lc3BhY2VzLCBvcmlnVHlwZSwKCQkJZWxlbURhdGEgPSBqUXVlcnkuX2RhdGEoIGVsZW0gKTsKCgkJLy8gRG9uJ3QgYXR0YWNoIGV2ZW50cyB0byBub0RhdGEgb3IgdGV4dC9jb21tZW50IG5vZGVzIChidXQgYWxsb3cgcGxhaW4gb2JqZWN0cykKCQlpZiAoICFlbGVtRGF0YSApIHsKCQkJcmV0dXJuOwoJCX0KCgkJLy8gQ2FsbGVyIGNhbiBwYXNzIGluIGFuIG9iamVjdCBvZiBjdXN0b20gZGF0YSBpbiBsaWV1IG9mIHRoZSBoYW5kbGVyCgkJaWYgKCBoYW5kbGVyLmhhbmRsZXIgKSB7CgkJCWhhbmRsZU9iakluID0gaGFuZGxlcjsKCQkJaGFuZGxlciA9IGhhbmRsZU9iakluLmhhbmRsZXI7CgkJCXNlbGVjdG9yID0gaGFuZGxlT2JqSW4uc2VsZWN0b3I7CgkJfQoKCQkvLyBNYWtlIHN1cmUgdGhhdCB0aGUgaGFuZGxlciBoYXMgYSB1bmlxdWUgSUQsIHVzZWQgdG8gZmluZC9yZW1vdmUgaXQgbGF0ZXIKCQlpZiAoICFoYW5kbGVyLmd1aWQgKSB7CgkJCWhhbmRsZXIuZ3VpZCA9IGpRdWVyeS5ndWlkKys7CgkJfQoKCQkvLyBJbml0IHRoZSBlbGVtZW50J3MgZXZlbnQgc3RydWN0dXJlIGFuZCBtYWluIGhhbmRsZXIsIGlmIHRoaXMgaXMgdGhlIGZpcnN0CgkJaWYgKCAhKGV2ZW50cyA9IGVsZW1EYXRhLmV2ZW50cykgKSB7CgkJCWV2ZW50cyA9IGVsZW1EYXRhLmV2ZW50cyA9IHt9OwoJCX0KCQlpZiAoICEoZXZlbnRIYW5kbGUgPSBlbGVtRGF0YS5oYW5kbGUpICkgewoJCQlldmVudEhhbmRsZSA9IGVsZW1EYXRhLmhhbmRsZSA9IGZ1bmN0aW9uKCBlICkgewoJCQkJLy8gRGlzY2FyZCB0aGUgc2Vjb25kIGV2ZW50IG9mIGEgalF1ZXJ5LmV2ZW50LnRyaWdnZXIoKSBhbmQKCQkJCS8vIHdoZW4gYW4gZXZlbnQgaXMgY2FsbGVkIGFmdGVyIGEgcGFnZSBoYXMgdW5sb2FkZWQKCQkJCXJldHVybiB0eXBlb2YgalF1ZXJ5ICE9PSBjb3JlX3N0cnVuZGVmaW5lZCAmJiAoIWUgfHwgalF1ZXJ5LmV2ZW50LnRyaWdnZXJlZCAhPT0gZS50eXBlKSA/CgkJCQkJalF1ZXJ5LmV2ZW50LmRpc3BhdGNoLmFwcGx5KCBldmVudEhhbmRsZS5lbGVtLCBhcmd1bWVudHMgKSA6CgkJCQkJdW5kZWZpbmVkOwoJCQl9OwoJCQkvLyBBZGQgZWxlbSBhcyBhIHByb3BlcnR5IG9mIHRoZSBoYW5kbGUgZm4gdG8gcHJldmVudCBhIG1lbW9yeSBsZWFrIHdpdGggSUUgbm9uLW5hdGl2ZSBldmVudHMKCQkJZXZlbnRIYW5kbGUuZWxlbSA9IGVsZW07CgkJfQoKCQkvLyBIYW5kbGUgbXVsdGlwbGUgZXZlbnRzIHNlcGFyYXRlZCBieSBhIHNwYWNlCgkJLy8galF1ZXJ5KC4uLikuYmluZCgibW91c2VvdmVyIG1vdXNlb3V0IiwgZm4pOwoJCXR5cGVzID0gKCB0eXBlcyB8fCAiIiApLm1hdGNoKCBjb3JlX3Jub3R3aGl0ZSApIHx8IFsiIl07CgkJdCA9IHR5cGVzLmxlbmd0aDsKCQl3aGlsZSAoIHQtLSApIHsKCQkJdG1wID0gcnR5cGVuYW1lc3BhY2UuZXhlYyggdHlwZXNbdF0gKSB8fCBbXTsKCQkJdHlwZSA9IG9yaWdUeXBlID0gdG1wWzFdOwoJCQluYW1lc3BhY2VzID0gKCB0bXBbMl0gfHwgIiIgKS5zcGxpdCggIi4iICkuc29ydCgpOwoKCQkJLy8gSWYgZXZlbnQgY2hhbmdlcyBpdHMgdHlwZSwgdXNlIHRoZSBzcGVjaWFsIGV2ZW50IGhhbmRsZXJzIGZvciB0aGUgY2hhbmdlZCB0eXBlCgkJCXNwZWNpYWwgPSBqUXVlcnkuZXZlbnQuc3BlY2lhbFsgdHlwZSBdIHx8IHt9OwoKCQkJLy8gSWYgc2VsZWN0b3IgZGVmaW5lZCwgZGV0ZXJtaW5lIHNwZWNpYWwgZXZlbnQgYXBpIHR5cGUsIG90aGVyd2lzZSBnaXZlbiB0eXBlCgkJCXR5cGUgPSAoIHNlbGVjdG9yID8gc3BlY2lhbC5kZWxlZ2F0ZVR5cGUgOiBzcGVjaWFsLmJpbmRUeXBlICkgfHwgdHlwZTsKCgkJCS8vIFVwZGF0ZSBzcGVjaWFsIGJhc2VkIG9uIG5ld2x5IHJlc2V0IHR5cGUKCQkJc3BlY2lhbCA9IGpRdWVyeS5ldmVudC5zcGVjaWFsWyB0eXBlIF0gfHwge307CgoJCQkvLyBoYW5kbGVPYmogaXMgcGFzc2VkIHRvIGFsbCBldmVudCBoYW5kbGVycwoJCQloYW5kbGVPYmogPSBqUXVlcnkuZXh0ZW5kKHsKCQkJCXR5cGU6IHR5cGUsCgkJCQlvcmlnVHlwZTogb3JpZ1R5cGUsCgkJCQlkYXRhOiBkYXRhLAoJCQkJaGFuZGxlcjogaGFuZGxlciwKCQkJCWd1aWQ6IGhhbmRsZXIuZ3VpZCwKCQkJCXNlbGVjdG9yOiBzZWxlY3RvciwKCQkJCW5lZWRzQ29udGV4dDogc2VsZWN0b3IgJiYgalF1ZXJ5LmV4cHIubWF0Y2gubmVlZHNDb250ZXh0LnRlc3QoIHNlbGVjdG9yICksCgkJCQluYW1lc3BhY2U6IG5hbWVzcGFjZXMuam9pbigiLiIpCgkJCX0sIGhhbmRsZU9iakluICk7CgoJCQkvLyBJbml0IHRoZSBldmVudCBoYW5kbGVyIHF1ZXVlIGlmIHdlJ3JlIHRoZSBmaXJzdAoJCQlpZiAoICEoaGFuZGxlcnMgPSBldmVudHNbIHR5cGUgXSkgKSB7CgkJCQloYW5kbGVycyA9IGV2ZW50c1sgdHlwZSBdID0gW107CgkJCQloYW5kbGVycy5kZWxlZ2F0ZUNvdW50ID0gMDsKCgkJCQkvLyBPbmx5IHVzZSBhZGRFdmVudExpc3RlbmVyL2F0dGFjaEV2ZW50IGlmIHRoZSBzcGVjaWFsIGV2ZW50cyBoYW5kbGVyIHJldHVybnMgZmFsc2UKCQkJCWlmICggIXNwZWNpYWwuc2V0dXAgfHwgc3BlY2lhbC5zZXR1cC5jYWxsKCBlbGVtLCBkYXRhLCBuYW1lc3BhY2VzLCBldmVudEhhbmRsZSApID09PSBmYWxzZSApIHsKCQkJCQkvLyBCaW5kIHRoZSBnbG9iYWwgZXZlbnQgaGFuZGxlciB0byB0aGUgZWxlbWVudAoJCQkJCWlmICggZWxlbS5hZGRFdmVudExpc3RlbmVyICkgewoJCQkJCQllbGVtLmFkZEV2ZW50TGlzdGVuZXIoIHR5cGUsIGV2ZW50SGFuZGxlLCBmYWxzZSApOwoKCQkJCQl9IGVsc2UgaWYgKCBlbGVtLmF0dGFjaEV2ZW50ICkgewoJCQkJCQllbGVtLmF0dGFjaEV2ZW50KCAib24iICsgdHlwZSwgZXZlbnRIYW5kbGUgKTsKCQkJCQl9CgkJCQl9CgkJCX0KCgkJCWlmICggc3BlY2lhbC5hZGQgKSB7CgkJCQlzcGVjaWFsLmFkZC5jYWxsKCBlbGVtLCBoYW5kbGVPYmogKTsKCgkJCQlpZiAoICFoYW5kbGVPYmouaGFuZGxlci5ndWlkICkgewoJCQkJCWhhbmRsZU9iai5oYW5kbGVyLmd1aWQgPSBoYW5kbGVyLmd1aWQ7CgkJCQl9CgkJCX0KCgkJCS8vIEFkZCB0byB0aGUgZWxlbWVudCdzIGhhbmRsZXIgbGlzdCwgZGVsZWdhdGVzIGluIGZyb250CgkJCWlmICggc2VsZWN0b3IgKSB7CgkJCQloYW5kbGVycy5zcGxpY2UoIGhhbmRsZXJzLmRlbGVnYXRlQ291bnQrKywgMCwgaGFuZGxlT2JqICk7CgkJCX0gZWxzZSB7CgkJCQloYW5kbGVycy5wdXNoKCBoYW5kbGVPYmogKTsKCQkJfQoKCQkJLy8gS2VlcCB0cmFjayBvZiB3aGljaCBldmVudHMgaGF2ZSBldmVyIGJlZW4gdXNlZCwgZm9yIGV2ZW50IG9wdGltaXphdGlvbgoJCQlqUXVlcnkuZXZlbnQuZ2xvYmFsWyB0eXBlIF0gPSB0cnVlOwoJCX0KCgkJLy8gTnVsbGlmeSBlbGVtIHRvIHByZXZlbnQgbWVtb3J5IGxlYWtzIGluIElFCgkJZWxlbSA9IG51bGw7Cgl9LAoKCS8vIERldGFjaCBhbiBldmVudCBvciBzZXQgb2YgZXZlbnRzIGZyb20gYW4gZWxlbWVudAoJcmVtb3ZlOiBmdW5jdGlvbiggZWxlbSwgdHlwZXMsIGhhbmRsZXIsIHNlbGVjdG9yLCBtYXBwZWRUeXBlcyApIHsKCQl2YXIgaiwgaGFuZGxlT2JqLCB0bXAsCgkJCW9yaWdDb3VudCwgdCwgZXZlbnRzLAoJCQlzcGVjaWFsLCBoYW5kbGVycywgdHlwZSwKCQkJbmFtZXNwYWNlcywgb3JpZ1R5cGUsCgkJCWVsZW1EYXRhID0galF1ZXJ5Lmhhc0RhdGEoIGVsZW0gKSAmJiBqUXVlcnkuX2RhdGEoIGVsZW0gKTsKCgkJaWYgKCAhZWxlbURhdGEgfHwgIShldmVudHMgPSBlbGVtRGF0YS5ldmVudHMpICkgewoJCQlyZXR1cm47CgkJfQoKCQkvLyBPbmNlIGZvciBlYWNoIHR5cGUubmFtZXNwYWNlIGluIHR5cGVzOyB0eXBlIG1heSBiZSBvbWl0dGVkCgkJdHlwZXMgPSAoIHR5cGVzIHx8ICIiICkubWF0Y2goIGNvcmVfcm5vdHdoaXRlICkgfHwgWyIiXTsKCQl0ID0gdHlwZXMubGVuZ3RoOwoJCXdoaWxlICggdC0tICkgewoJCQl0bXAgPSBydHlwZW5hbWVzcGFjZS5leGVjKCB0eXBlc1t0XSApIHx8IFtdOwoJCQl0eXBlID0gb3JpZ1R5cGUgPSB0bXBbMV07CgkJCW5hbWVzcGFjZXMgPSAoIHRtcFsyXSB8fCAiIiApLnNwbGl0KCAiLiIgKS5zb3J0KCk7CgoJCQkvLyBVbmJpbmQgYWxsIGV2ZW50cyAob24gdGhpcyBuYW1lc3BhY2UsIGlmIHByb3ZpZGVkKSBmb3IgdGhlIGVsZW1lbnQKCQkJaWYgKCAhdHlwZSApIHsKCQkJCWZvciAoIHR5cGUgaW4gZXZlbnRzICkgewoJCQkJCWpRdWVyeS5ldmVudC5yZW1vdmUoIGVsZW0sIHR5cGUgKyB0eXBlc1sgdCBdLCBoYW5kbGVyLCBzZWxlY3RvciwgdHJ1ZSApOwoJCQkJfQoJCQkJY29udGludWU7CgkJCX0KCgkJCXNwZWNpYWwgPSBqUXVlcnkuZXZlbnQuc3BlY2lhbFsgdHlwZSBdIHx8IHt9OwoJCQl0eXBlID0gKCBzZWxlY3RvciA/IHNwZWNpYWwuZGVsZWdhdGVUeXBlIDogc3BlY2lhbC5iaW5kVHlwZSApIHx8IHR5cGU7CgkJCWhhbmRsZXJzID0gZXZlbnRzWyB0eXBlIF0gfHwgW107CgkJCXRtcCA9IHRtcFsyXSAmJiBuZXcgUmVnRXhwKCAiKF58XFwuKSIgKyBuYW1lc3BhY2VzLmpvaW4oIlxcLig/Oi4qXFwufCkiKSArICIoXFwufCQpIiApOwoKCQkJLy8gUmVtb3ZlIG1hdGNoaW5nIGV2ZW50cwoJCQlvcmlnQ291bnQgPSBqID0gaGFuZGxlcnMubGVuZ3RoOwoJCQl3aGlsZSAoIGotLSApIHsKCQkJCWhhbmRsZU9iaiA9IGhhbmRsZXJzWyBqIF07CgoJCQkJaWYgKCAoIG1hcHBlZFR5cGVzIHx8IG9yaWdUeXBlID09PSBoYW5kbGVPYmoub3JpZ1R5cGUgKSAmJgoJCQkJCSggIWhhbmRsZXIgfHwgaGFuZGxlci5ndWlkID09PSBoYW5kbGVPYmouZ3VpZCApICYmCgkJCQkJKCAhdG1wIHx8IHRtcC50ZXN0KCBoYW5kbGVPYmoubmFtZXNwYWNlICkgKSAmJgoJCQkJCSggIXNlbGVjdG9yIHx8IHNlbGVjdG9yID09PSBoYW5kbGVPYmouc2VsZWN0b3IgfHwgc2VsZWN0b3IgPT09ICIqKiIgJiYgaGFuZGxlT2JqLnNlbGVjdG9yICkgKSB7CgkJCQkJaGFuZGxlcnMuc3BsaWNlKCBqLCAxICk7CgoJCQkJCWlmICggaGFuZGxlT2JqLnNlbGVjdG9yICkgewoJCQkJCQloYW5kbGVycy5kZWxlZ2F0ZUNvdW50LS07CgkJCQkJfQoJCQkJCWlmICggc3BlY2lhbC5yZW1vdmUgKSB7CgkJCQkJCXNwZWNpYWwucmVtb3ZlLmNhbGwoIGVsZW0sIGhhbmRsZU9iaiApOwoJCQkJCX0KCQkJCX0KCQkJfQoKCQkJLy8gUmVtb3ZlIGdlbmVyaWMgZXZlbnQgaGFuZGxlciBpZiB3ZSByZW1vdmVkIHNvbWV0aGluZyBhbmQgbm8gbW9yZSBoYW5kbGVycyBleGlzdAoJCQkvLyAoYXZvaWRzIHBvdGVudGlhbCBmb3IgZW5kbGVzcyByZWN1cnNpb24gZHVyaW5nIHJlbW92YWwgb2Ygc3BlY2lhbCBldmVudCBoYW5kbGVycykKCQkJaWYgKCBvcmlnQ291bnQgJiYgIWhhbmRsZXJzLmxlbmd0aCApIHsKCQkJCWlmICggIXNwZWNpYWwudGVhcmRvd24gfHwgc3BlY2lhbC50ZWFyZG93bi5jYWxsKCBlbGVtLCBuYW1lc3BhY2VzLCBlbGVtRGF0YS5oYW5kbGUgKSA9PT0gZmFsc2UgKSB7CgkJCQkJalF1ZXJ5LnJlbW92ZUV2ZW50KCBlbGVtLCB0eXBlLCBlbGVtRGF0YS5oYW5kbGUgKTsKCQkJCX0KCgkJCQlkZWxldGUgZXZlbnRzWyB0eXBlIF07CgkJCX0KCQl9CgoJCS8vIFJlbW92ZSB0aGUgZXhwYW5kbyBpZiBpdCdzIG5vIGxvbmdlciB1c2VkCgkJaWYgKCBqUXVlcnkuaXNFbXB0eU9iamVjdCggZXZlbnRzICkgKSB7CgkJCWRlbGV0ZSBlbGVtRGF0YS5oYW5kbGU7CgoJCQkvLyByZW1vdmVEYXRhIGFsc28gY2hlY2tzIGZvciBlbXB0aW5lc3MgYW5kIGNsZWFycyB0aGUgZXhwYW5kbyBpZiBlbXB0eQoJCQkvLyBzbyB1c2UgaXQgaW5zdGVhZCBvZiBkZWxldGUKCQkJalF1ZXJ5Ll9yZW1vdmVEYXRhKCBlbGVtLCAiZXZlbnRzIiApOwoJCX0KCX0sCgoJdHJpZ2dlcjogZnVuY3Rpb24oIGV2ZW50LCBkYXRhLCBlbGVtLCBvbmx5SGFuZGxlcnMgKSB7CgkJdmFyIGhhbmRsZSwgb250eXBlLCBjdXIsCgkJCWJ1YmJsZVR5cGUsIHNwZWNpYWwsIHRtcCwgaSwKCQkJZXZlbnRQYXRoID0gWyBlbGVtIHx8IGRvY3VtZW50IF0sCgkJCXR5cGUgPSBjb3JlX2hhc093bi5jYWxsKCBldmVudCwgInR5cGUiICkgPyBldmVudC50eXBlIDogZXZlbnQsCgkJCW5hbWVzcGFjZXMgPSBjb3JlX2hhc093bi5jYWxsKCBldmVudCwgIm5hbWVzcGFjZSIgKSA/IGV2ZW50Lm5hbWVzcGFjZS5zcGxpdCgiLiIpIDogW107CgoJCWN1ciA9IHRtcCA9IGVsZW0gPSBlbGVtIHx8IGRvY3VtZW50OwoKCQkvLyBEb24ndCBkbyBldmVudHMgb24gdGV4dCBhbmQgY29tbWVudCBub2RlcwoJCWlmICggZWxlbS5ub2RlVHlwZSA9PT0gMyB8fCBlbGVtLm5vZGVUeXBlID09PSA4ICkgewoJCQlyZXR1cm47CgkJfQoKCQkvLyBmb2N1cy9ibHVyIG1vcnBocyB0byBmb2N1c2luL291dDsgZW5zdXJlIHdlJ3JlIG5vdCBmaXJpbmcgdGhlbSByaWdodCBub3cKCQlpZiAoIHJmb2N1c01vcnBoLnRlc3QoIHR5cGUgKyBqUXVlcnkuZXZlbnQudHJpZ2dlcmVkICkgKSB7CgkJCXJldHVybjsKCQl9CgoJCWlmICggdHlwZS5pbmRleE9mKCIuIikgPj0gMCApIHsKCQkJLy8gTmFtZXNwYWNlZCB0cmlnZ2VyOyBjcmVhdGUgYSByZWdleHAgdG8gbWF0Y2ggZXZlbnQgdHlwZSBpbiBoYW5kbGUoKQoJCQluYW1lc3BhY2VzID0gdHlwZS5zcGxpdCgiLiIpOwoJCQl0eXBlID0gbmFtZXNwYWNlcy5zaGlmdCgpOwoJCQluYW1lc3BhY2VzLnNvcnQoKTsKCQl9CgkJb250eXBlID0gdHlwZS5pbmRleE9mKCI6IikgPCAwICYmICJvbiIgKyB0eXBlOwoKCQkvLyBDYWxsZXIgY2FuIHBhc3MgaW4gYSBqUXVlcnkuRXZlbnQgb2JqZWN0LCBPYmplY3QsIG9yIGp1c3QgYW4gZXZlbnQgdHlwZSBzdHJpbmcKCQlldmVudCA9IGV2ZW50WyBqUXVlcnkuZXhwYW5kbyBdID8KCQkJZXZlbnQgOgoJCQluZXcgalF1ZXJ5LkV2ZW50KCB0eXBlLCB0eXBlb2YgZXZlbnQgPT09ICJvYmplY3QiICYmIGV2ZW50ICk7CgoJCWV2ZW50LmlzVHJpZ2dlciA9IHRydWU7CgkJZXZlbnQubmFtZXNwYWNlID0gbmFtZXNwYWNlcy5qb2luKCIuIik7CgkJZXZlbnQubmFtZXNwYWNlX3JlID0gZXZlbnQubmFtZXNwYWNlID8KCQkJbmV3IFJlZ0V4cCggIihefFxcLikiICsgbmFtZXNwYWNlcy5qb2luKCJcXC4oPzouKlxcLnwpIikgKyAiKFxcLnwkKSIgKSA6CgkJCW51bGw7CgoJCS8vIENsZWFuIHVwIHRoZSBldmVudCBpbiBjYXNlIGl0IGlzIGJlaW5nIHJldXNlZAoJCWV2ZW50LnJlc3VsdCA9IHVuZGVmaW5lZDsKCQlpZiAoICFldmVudC50YXJnZXQgKSB7CgkJCWV2ZW50LnRhcmdldCA9IGVsZW07CgkJfQoKCQkvLyBDbG9uZSBhbnkgaW5jb21pbmcgZGF0YSBhbmQgcHJlcGVuZCB0aGUgZXZlbnQsIGNyZWF0aW5nIHRoZSBoYW5kbGVyIGFyZyBsaXN0CgkJZGF0YSA9IGRhdGEgPT0gbnVsbCA/CgkJCVsgZXZlbnQgXSA6CgkJCWpRdWVyeS5tYWtlQXJyYXkoIGRhdGEsIFsgZXZlbnQgXSApOwoKCQkvLyBBbGxvdyBzcGVjaWFsIGV2ZW50cyB0byBkcmF3IG91dHNpZGUgdGhlIGxpbmVzCgkJc3BlY2lhbCA9IGpRdWVyeS5ldmVudC5zcGVjaWFsWyB0eXBlIF0gfHwge307CgkJaWYgKCAhb25seUhhbmRsZXJzICYmIHNwZWNpYWwudHJpZ2dlciAmJiBzcGVjaWFsLnRyaWdnZXIuYXBwbHkoIGVsZW0sIGRhdGEgKSA9PT0gZmFsc2UgKSB7CgkJCXJldHVybjsKCQl9CgoJCS8vIERldGVybWluZSBldmVudCBwcm9wYWdhdGlvbiBwYXRoIGluIGFkdmFuY2UsIHBlciBXM0MgZXZlbnRzIHNwZWMgKCM5OTUxKQoJCS8vIEJ1YmJsZSB1cCB0byBkb2N1bWVudCwgdGhlbiB0byB3aW5kb3c7IHdhdGNoIGZvciBhIGdsb2JhbCBvd25lckRvY3VtZW50IHZhciAoIzk3MjQpCgkJaWYgKCAhb25seUhhbmRsZXJzICYmICFzcGVjaWFsLm5vQnViYmxlICYmICFqUXVlcnkuaXNXaW5kb3coIGVsZW0gKSApIHsKCgkJCWJ1YmJsZVR5cGUgPSBzcGVjaWFsLmRlbGVnYXRlVHlwZSB8fCB0eXBlOwoJCQlpZiAoICFyZm9jdXNNb3JwaC50ZXN0KCBidWJibGVUeXBlICsgdHlwZSApICkgewoJCQkJY3VyID0gY3VyLnBhcmVudE5vZGU7CgkJCX0KCQkJZm9yICggOyBjdXI7IGN1ciA9IGN1ci5wYXJlbnROb2RlICkgewoJCQkJZXZlbnRQYXRoLnB1c2goIGN1ciApOwoJCQkJdG1wID0gY3VyOwoJCQl9CgoJCQkvLyBPbmx5IGFkZCB3aW5kb3cgaWYgd2UgZ290IHRvIGRvY3VtZW50IChlLmcuLCBub3QgcGxhaW4gb2JqIG9yIGRldGFjaGVkIERPTSkKCQkJaWYgKCB0bXAgPT09IChlbGVtLm93bmVyRG9jdW1lbnQgfHwgZG9jdW1lbnQpICkgewoJCQkJZXZlbnRQYXRoLnB1c2goIHRtcC5kZWZhdWx0VmlldyB8fCB0bXAucGFyZW50V2luZG93IHx8IHdpbmRvdyApOwoJCQl9CgkJfQoKCQkvLyBGaXJlIGhhbmRsZXJzIG9uIHRoZSBldmVudCBwYXRoCgkJaSA9IDA7CgkJd2hpbGUgKCAoY3VyID0gZXZlbnRQYXRoW2krK10pICYmICFldmVudC5pc1Byb3BhZ2F0aW9uU3RvcHBlZCgpICkgewoKCQkJZXZlbnQudHlwZSA9IGkgPiAxID8KCQkJCWJ1YmJsZVR5cGUgOgoJCQkJc3BlY2lhbC5iaW5kVHlwZSB8fCB0eXBlOwoKCQkJLy8galF1ZXJ5IGhhbmRsZXIKCQkJaGFuZGxlID0gKCBqUXVlcnkuX2RhdGEoIGN1ciwgImV2ZW50cyIgKSB8fCB7fSApWyBldmVudC50eXBlIF0gJiYgalF1ZXJ5Ll9kYXRhKCBjdXIsICJoYW5kbGUiICk7CgkJCWlmICggaGFuZGxlICkgewoJCQkJaGFuZGxlLmFwcGx5KCBjdXIsIGRhdGEgKTsKCQkJfQoKCQkJLy8gTmF0aXZlIGhhbmRsZXIKCQkJaGFuZGxlID0gb250eXBlICYmIGN1clsgb250eXBlIF07CgkJCWlmICggaGFuZGxlICYmIGpRdWVyeS5hY2NlcHREYXRhKCBjdXIgKSAmJiBoYW5kbGUuYXBwbHkgJiYgaGFuZGxlLmFwcGx5KCBjdXIsIGRhdGEgKSA9PT0gZmFsc2UgKSB7CgkJCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoJCQl9CgkJfQoJCWV2ZW50LnR5cGUgPSB0eXBlOwoKCQkvLyBJZiBub2JvZHkgcHJldmVudGVkIHRoZSBkZWZhdWx0IGFjdGlvbiwgZG8gaXQgbm93CgkJaWYgKCAhb25seUhhbmRsZXJzICYmICFldmVudC5pc0RlZmF1bHRQcmV2ZW50ZWQoKSApIHsKCgkJCWlmICggKCFzcGVjaWFsLl9kZWZhdWx0IHx8IHNwZWNpYWwuX2RlZmF1bHQuYXBwbHkoIGVsZW0ub3duZXJEb2N1bWVudCwgZGF0YSApID09PSBmYWxzZSkgJiYKCQkJCSEodHlwZSA9PT0gImNsaWNrIiAmJiBqUXVlcnkubm9kZU5hbWUoIGVsZW0sICJhIiApKSAmJiBqUXVlcnkuYWNjZXB0RGF0YSggZWxlbSApICkgewoKCQkJCS8vIENhbGwgYSBuYXRpdmUgRE9NIG1ldGhvZCBvbiB0aGUgdGFyZ2V0IHdpdGggdGhlIHNhbWUgbmFtZSBuYW1lIGFzIHRoZSBldmVudC4KCQkJCS8vIENhbid0IHVzZSBhbiAuaXNGdW5jdGlvbigpIGNoZWNrIGhlcmUgYmVjYXVzZSBJRTYvNyBmYWlscyB0aGF0IHRlc3QuCgkJCQkvLyBEb24ndCBkbyBkZWZhdWx0IGFjdGlvbnMgb24gd2luZG93LCB0aGF0J3Mgd2hlcmUgZ2xvYmFsIHZhcmlhYmxlcyBiZSAoIzYxNzApCgkJCQlpZiAoIG9udHlwZSAmJiBlbGVtWyB0eXBlIF0gJiYgIWpRdWVyeS5pc1dpbmRvdyggZWxlbSApICkgewoKCQkJCQkvLyBEb24ndCByZS10cmlnZ2VyIGFuIG9uRk9PIGV2ZW50IHdoZW4gd2UgY2FsbCBpdHMgRk9PKCkgbWV0aG9kCgkJCQkJdG1wID0gZWxlbVsgb250eXBlIF07CgoJCQkJCWlmICggdG1wICkgewoJCQkJCQllbGVtWyBvbnR5cGUgXSA9IG51bGw7CgkJCQkJfQoKCQkJCQkvLyBQcmV2ZW50IHJlLXRyaWdnZXJpbmcgb2YgdGhlIHNhbWUgZXZlbnQsIHNpbmNlIHdlIGFscmVhZHkgYnViYmxlZCBpdCBhYm92ZQoJCQkJCWpRdWVyeS5ldmVudC50cmlnZ2VyZWQgPSB0eXBlOwoJCQkJCXRyeSB7CgkJCQkJCWVsZW1bIHR5cGUgXSgpOwoJCQkJCX0gY2F0Y2ggKCBlICkgewoJCQkJCQkvLyBJRTw5IGRpZXMgb24gZm9jdXMvYmx1ciB0byBoaWRkZW4gZWxlbWVudCAoIzE0ODYsIzEyNTE4KQoJCQkJCQkvLyBvbmx5IHJlcHJvZHVjaWJsZSBvbiB3aW5YUCBJRTggbmF0aXZlLCBub3QgSUU5IGluIElFOCBtb2RlCgkJCQkJfQoJCQkJCWpRdWVyeS5ldmVudC50cmlnZ2VyZWQgPSB1bmRlZmluZWQ7CgoJCQkJCWlmICggdG1wICkgewoJCQkJCQllbGVtWyBvbnR5cGUgXSA9IHRtcDsKCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgoJCXJldHVybiBldmVudC5yZXN1bHQ7Cgl9LAoKCWRpc3BhdGNoOiBmdW5jdGlvbiggZXZlbnQgKSB7CgoJCS8vIE1ha2UgYSB3cml0YWJsZSBqUXVlcnkuRXZlbnQgZnJvbSB0aGUgbmF0aXZlIGV2ZW50IG9iamVjdAoJCWV2ZW50ID0galF1ZXJ5LmV2ZW50LmZpeCggZXZlbnQgKTsKCgkJdmFyIGksIHJldCwgaGFuZGxlT2JqLCBtYXRjaGVkLCBqLAoJCQloYW5kbGVyUXVldWUgPSBbXSwKCQkJYXJncyA9IGNvcmVfc2xpY2UuY2FsbCggYXJndW1lbnRzICksCgkJCWhhbmRsZXJzID0gKCBqUXVlcnkuX2RhdGEoIHRoaXMsICJldmVudHMiICkgfHwge30gKVsgZXZlbnQudHlwZSBdIHx8IFtdLAoJCQlzcGVjaWFsID0galF1ZXJ5LmV2ZW50LnNwZWNpYWxbIGV2ZW50LnR5cGUgXSB8fCB7fTsKCgkJLy8gVXNlIHRoZSBmaXgtZWQgalF1ZXJ5LkV2ZW50IHJhdGhlciB0aGFuIHRoZSAocmVhZC1vbmx5KSBuYXRpdmUgZXZlbnQKCQlhcmdzWzBdID0gZXZlbnQ7CgkJZXZlbnQuZGVsZWdhdGVUYXJnZXQgPSB0aGlzOwoKCQkvLyBDYWxsIHRoZSBwcmVEaXNwYXRjaCBob29rIGZvciB0aGUgbWFwcGVkIHR5cGUsIGFuZCBsZXQgaXQgYmFpbCBpZiBkZXNpcmVkCgkJaWYgKCBzcGVjaWFsLnByZURpc3BhdGNoICYmIHNwZWNpYWwucHJlRGlzcGF0Y2guY2FsbCggdGhpcywgZXZlbnQgKSA9PT0gZmFsc2UgKSB7CgkJCXJldHVybjsKCQl9CgoJCS8vIERldGVybWluZSBoYW5kbGVycwoJCWhhbmRsZXJRdWV1ZSA9IGpRdWVyeS5ldmVudC5oYW5kbGVycy5jYWxsKCB0aGlzLCBldmVudCwgaGFuZGxlcnMgKTsKCgkJLy8gUnVuIGRlbGVnYXRlcyBmaXJzdDsgdGhleSBtYXkgd2FudCB0byBzdG9wIHByb3BhZ2F0aW9uIGJlbmVhdGggdXMKCQlpID0gMDsKCQl3aGlsZSAoIChtYXRjaGVkID0gaGFuZGxlclF1ZXVlWyBpKysgXSkgJiYgIWV2ZW50LmlzUHJvcGFnYXRpb25TdG9wcGVkKCkgKSB7CgkJCWV2ZW50LmN1cnJlbnRUYXJnZXQgPSBtYXRjaGVkLmVsZW07CgoJCQlqID0gMDsKCQkJd2hpbGUgKCAoaGFuZGxlT2JqID0gbWF0Y2hlZC5oYW5kbGVyc1sgaisrIF0pICYmICFldmVudC5pc0ltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZCgpICkgewoKCQkJCS8vIFRyaWdnZXJlZCBldmVudCBtdXN0IGVpdGhlciAxKSBoYXZlIG5vIG5hbWVzcGFjZSwgb3IKCQkJCS8vIDIpIGhhdmUgbmFtZXNwYWNlKHMpIGEgc3Vic2V0IG9yIGVxdWFsIHRvIHRob3NlIGluIHRoZSBib3VuZCBldmVudCAoYm90aCBjYW4gaGF2ZSBubyBuYW1lc3BhY2UpLgoJCQkJaWYgKCAhZXZlbnQubmFtZXNwYWNlX3JlIHx8IGV2ZW50Lm5hbWVzcGFjZV9yZS50ZXN0KCBoYW5kbGVPYmoubmFtZXNwYWNlICkgKSB7CgoJCQkJCWV2ZW50LmhhbmRsZU9iaiA9IGhhbmRsZU9iajsKCQkJCQlldmVudC5kYXRhID0gaGFuZGxlT2JqLmRhdGE7CgoJCQkJCXJldCA9ICggKGpRdWVyeS5ldmVudC5zcGVjaWFsWyBoYW5kbGVPYmoub3JpZ1R5cGUgXSB8fCB7fSkuaGFuZGxlIHx8IGhhbmRsZU9iai5oYW5kbGVyICkKCQkJCQkJCS5hcHBseSggbWF0Y2hlZC5lbGVtLCBhcmdzICk7CgoJCQkJCWlmICggcmV0ICE9PSB1bmRlZmluZWQgKSB7CgkJCQkJCWlmICggKGV2ZW50LnJlc3VsdCA9IHJldCkgPT09IGZhbHNlICkgewoJCQkJCQkJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCQkJCQkJCWV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoKCQkvLyBDYWxsIHRoZSBwb3N0RGlzcGF0Y2ggaG9vayBmb3IgdGhlIG1hcHBlZCB0eXBlCgkJaWYgKCBzcGVjaWFsLnBvc3REaXNwYXRjaCApIHsKCQkJc3BlY2lhbC5wb3N0RGlzcGF0Y2guY2FsbCggdGhpcywgZXZlbnQgKTsKCQl9CgoJCXJldHVybiBldmVudC5yZXN1bHQ7Cgl9LAoKCWhhbmRsZXJzOiBmdW5jdGlvbiggZXZlbnQsIGhhbmRsZXJzICkgewoJCXZhciBzZWwsIGhhbmRsZU9iaiwgbWF0Y2hlcywgaSwKCQkJaGFuZGxlclF1ZXVlID0gW10sCgkJCWRlbGVnYXRlQ291bnQgPSBoYW5kbGVycy5kZWxlZ2F0ZUNvdW50LAoJCQljdXIgPSBldmVudC50YXJnZXQ7CgoJCS8vIEZpbmQgZGVsZWdhdGUgaGFuZGxlcnMKCQkvLyBCbGFjay1ob2xlIFNWRyA8dXNlPiBpbnN0YW5jZSB0cmVlcyAoIzEzMTgwKQoJCS8vIEF2b2lkIG5vbi1sZWZ0LWNsaWNrIGJ1YmJsaW5nIGluIEZpcmVmb3ggKCMzODYxKQoJCWlmICggZGVsZWdhdGVDb3VudCAmJiBjdXIubm9kZVR5cGUgJiYgKCFldmVudC5idXR0b24gfHwgZXZlbnQudHlwZSAhPT0gImNsaWNrIikgKSB7CgoJCQlmb3IgKCA7IGN1ciAhPSB0aGlzOyBjdXIgPSBjdXIucGFyZW50Tm9kZSB8fCB0aGlzICkgewoKCQkJCS8vIERvbid0IGNoZWNrIG5vbi1lbGVtZW50cyAoIzEzMjA4KQoJCQkJLy8gRG9uJ3QgcHJvY2VzcyBjbGlja3Mgb24gZGlzYWJsZWQgZWxlbWVudHMgKCM2OTExLCAjODE2NSwgIzExMzgyLCAjMTE3NjQpCgkJCQlpZiAoIGN1ci5ub2RlVHlwZSA9PT0gMSAmJiAoY3VyLmRpc2FibGVkICE9PSB0cnVlIHx8IGV2ZW50LnR5cGUgIT09ICJjbGljayIpICkgewoJCQkJCW1hdGNoZXMgPSBbXTsKCQkJCQlmb3IgKCBpID0gMDsgaSA8IGRlbGVnYXRlQ291bnQ7IGkrKyApIHsKCQkJCQkJaGFuZGxlT2JqID0gaGFuZGxlcnNbIGkgXTsKCgkJCQkJCS8vIERvbid0IGNvbmZsaWN0IHdpdGggT2JqZWN0LnByb3RvdHlwZSBwcm9wZXJ0aWVzICgjMTMyMDMpCgkJCQkJCXNlbCA9IGhhbmRsZU9iai5zZWxlY3RvciArICIgIjsKCgkJCQkJCWlmICggbWF0Y2hlc1sgc2VsIF0gPT09IHVuZGVmaW5lZCApIHsKCQkJCQkJCW1hdGNoZXNbIHNlbCBdID0gaGFuZGxlT2JqLm5lZWRzQ29udGV4dCA/CgkJCQkJCQkJalF1ZXJ5KCBzZWwsIHRoaXMgKS5pbmRleCggY3VyICkgPj0gMCA6CgkJCQkJCQkJalF1ZXJ5LmZpbmQoIHNlbCwgdGhpcywgbnVsbCwgWyBjdXIgXSApLmxlbmd0aDsKCQkJCQkJfQoJCQkJCQlpZiAoIG1hdGNoZXNbIHNlbCBdICkgewoJCQkJCQkJbWF0Y2hlcy5wdXNoKCBoYW5kbGVPYmogKTsKCQkJCQkJfQoJCQkJCX0KCQkJCQlpZiAoIG1hdGNoZXMubGVuZ3RoICkgewoJCQkJCQloYW5kbGVyUXVldWUucHVzaCh7IGVsZW06IGN1ciwgaGFuZGxlcnM6IG1hdGNoZXMgfSk7CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoKCQkvLyBBZGQgdGhlIHJlbWFpbmluZyAoZGlyZWN0bHktYm91bmQpIGhhbmRsZXJzCgkJaWYgKCBkZWxlZ2F0ZUNvdW50IDwgaGFuZGxlcnMubGVuZ3RoICkgewoJCQloYW5kbGVyUXVldWUucHVzaCh7IGVsZW06IHRoaXMsIGhhbmRsZXJzOiBoYW5kbGVycy5zbGljZSggZGVsZWdhdGVDb3VudCApIH0pOwoJCX0KCgkJcmV0dXJuIGhhbmRsZXJRdWV1ZTsKCX0sCgoJZml4OiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJaWYgKCBldmVudFsgalF1ZXJ5LmV4cGFuZG8gXSApIHsKCQkJcmV0dXJuIGV2ZW50OwoJCX0KCgkJLy8gQ3JlYXRlIGEgd3JpdGFibGUgY29weSBvZiB0aGUgZXZlbnQgb2JqZWN0IGFuZCBub3JtYWxpemUgc29tZSBwcm9wZXJ0aWVzCgkJdmFyIGksIHByb3AsIGNvcHksCgkJCXR5cGUgPSBldmVudC50eXBlLAoJCQlvcmlnaW5hbEV2ZW50ID0gZXZlbnQsCgkJCWZpeEhvb2sgPSB0aGlzLmZpeEhvb2tzWyB0eXBlIF07CgoJCWlmICggIWZpeEhvb2sgKSB7CgkJCXRoaXMuZml4SG9va3NbIHR5cGUgXSA9IGZpeEhvb2sgPQoJCQkJcm1vdXNlRXZlbnQudGVzdCggdHlwZSApID8gdGhpcy5tb3VzZUhvb2tzIDoKCQkJCXJrZXlFdmVudC50ZXN0KCB0eXBlICkgPyB0aGlzLmtleUhvb2tzIDoKCQkJCXt9OwoJCX0KCQljb3B5ID0gZml4SG9vay5wcm9wcyA/IHRoaXMucHJvcHMuY29uY2F0KCBmaXhIb29rLnByb3BzICkgOiB0aGlzLnByb3BzOwoKCQlldmVudCA9IG5ldyBqUXVlcnkuRXZlbnQoIG9yaWdpbmFsRXZlbnQgKTsKCgkJaSA9IGNvcHkubGVuZ3RoOwoJCXdoaWxlICggaS0tICkgewoJCQlwcm9wID0gY29weVsgaSBdOwoJCQlldmVudFsgcHJvcCBdID0gb3JpZ2luYWxFdmVudFsgcHJvcCBdOwoJCX0KCgkJLy8gU3VwcG9ydDogSUU8OQoJCS8vIEZpeCB0YXJnZXQgcHJvcGVydHkgKCMxOTI1KQoJCWlmICggIWV2ZW50LnRhcmdldCApIHsKCQkJZXZlbnQudGFyZ2V0ID0gb3JpZ2luYWxFdmVudC5zcmNFbGVtZW50IHx8IGRvY3VtZW50OwoJCX0KCgkJLy8gU3VwcG9ydDogQ2hyb21lIDIzKywgU2FmYXJpPwoJCS8vIFRhcmdldCBzaG91bGQgbm90IGJlIGEgdGV4dCBub2RlICgjNTA0LCAjMTMxNDMpCgkJaWYgKCBldmVudC50YXJnZXQubm9kZVR5cGUgPT09IDMgKSB7CgkJCWV2ZW50LnRhcmdldCA9IGV2ZW50LnRhcmdldC5wYXJlbnROb2RlOwoJCX0KCgkJLy8gU3VwcG9ydDogSUU8OQoJCS8vIEZvciBtb3VzZS9rZXkgZXZlbnRzLCBtZXRhS2V5PT1mYWxzZSBpZiBpdCdzIHVuZGVmaW5lZCAoIzMzNjgsICMxMTMyOCkKCQlldmVudC5tZXRhS2V5ID0gISFldmVudC5tZXRhS2V5OwoKCQlyZXR1cm4gZml4SG9vay5maWx0ZXIgPyBmaXhIb29rLmZpbHRlciggZXZlbnQsIG9yaWdpbmFsRXZlbnQgKSA6IGV2ZW50OwoJfSwKCgkvLyBJbmNsdWRlcyBzb21lIGV2ZW50IHByb3BzIHNoYXJlZCBieSBLZXlFdmVudCBhbmQgTW91c2VFdmVudAoJcHJvcHM6ICJhbHRLZXkgYnViYmxlcyBjYW5jZWxhYmxlIGN0cmxLZXkgY3VycmVudFRhcmdldCBldmVudFBoYXNlIG1ldGFLZXkgcmVsYXRlZFRhcmdldCBzaGlmdEtleSB0YXJnZXQgdGltZVN0YW1wIHZpZXcgd2hpY2giLnNwbGl0KCIgIiksCgoJZml4SG9va3M6IHt9LAoKCWtleUhvb2tzOiB7CgkJcHJvcHM6ICJjaGFyIGNoYXJDb2RlIGtleSBrZXlDb2RlIi5zcGxpdCgiICIpLAoJCWZpbHRlcjogZnVuY3Rpb24oIGV2ZW50LCBvcmlnaW5hbCApIHsKCgkJCS8vIEFkZCB3aGljaCBmb3Iga2V5IGV2ZW50cwoJCQlpZiAoIGV2ZW50LndoaWNoID09IG51bGwgKSB7CgkJCQlldmVudC53aGljaCA9IG9yaWdpbmFsLmNoYXJDb2RlICE9IG51bGwgPyBvcmlnaW5hbC5jaGFyQ29kZSA6IG9yaWdpbmFsLmtleUNvZGU7CgkJCX0KCgkJCXJldHVybiBldmVudDsKCQl9Cgl9LAoKCW1vdXNlSG9va3M6IHsKCQlwcm9wczogImJ1dHRvbiBidXR0b25zIGNsaWVudFggY2xpZW50WSBmcm9tRWxlbWVudCBvZmZzZXRYIG9mZnNldFkgcGFnZVggcGFnZVkgc2NyZWVuWCBzY3JlZW5ZIHRvRWxlbWVudCIuc3BsaXQoIiAiKSwKCQlmaWx0ZXI6IGZ1bmN0aW9uKCBldmVudCwgb3JpZ2luYWwgKSB7CgkJCXZhciBib2R5LCBldmVudERvYywgZG9jLAoJCQkJYnV0dG9uID0gb3JpZ2luYWwuYnV0dG9uLAoJCQkJZnJvbUVsZW1lbnQgPSBvcmlnaW5hbC5mcm9tRWxlbWVudDsKCgkJCS8vIENhbGN1bGF0ZSBwYWdlWC9ZIGlmIG1pc3NpbmcgYW5kIGNsaWVudFgvWSBhdmFpbGFibGUKCQkJaWYgKCBldmVudC5wYWdlWCA9PSBudWxsICYmIG9yaWdpbmFsLmNsaWVudFggIT0gbnVsbCApIHsKCQkJCWV2ZW50RG9jID0gZXZlbnQudGFyZ2V0Lm93bmVyRG9jdW1lbnQgfHwgZG9jdW1lbnQ7CgkJCQlkb2MgPSBldmVudERvYy5kb2N1bWVudEVsZW1lbnQ7CgkJCQlib2R5ID0gZXZlbnREb2MuYm9keTsKCgkJCQlldmVudC5wYWdlWCA9IG9yaWdpbmFsLmNsaWVudFggKyAoIGRvYyAmJiBkb2Muc2Nyb2xsTGVmdCB8fCBib2R5ICYmIGJvZHkuc2Nyb2xsTGVmdCB8fCAwICkgLSAoIGRvYyAmJiBkb2MuY2xpZW50TGVmdCB8fCBib2R5ICYmIGJvZHkuY2xpZW50TGVmdCB8fCAwICk7CgkJCQlldmVudC5wYWdlWSA9IG9yaWdpbmFsLmNsaWVudFkgKyAoIGRvYyAmJiBkb2Muc2Nyb2xsVG9wICB8fCBib2R5ICYmIGJvZHkuc2Nyb2xsVG9wICB8fCAwICkgLSAoIGRvYyAmJiBkb2MuY2xpZW50VG9wICB8fCBib2R5ICYmIGJvZHkuY2xpZW50VG9wICB8fCAwICk7CgkJCX0KCgkJCS8vIEFkZCByZWxhdGVkVGFyZ2V0LCBpZiBuZWNlc3NhcnkKCQkJaWYgKCAhZXZlbnQucmVsYXRlZFRhcmdldCAmJiBmcm9tRWxlbWVudCApIHsKCQkJCWV2ZW50LnJlbGF0ZWRUYXJnZXQgPSBmcm9tRWxlbWVudCA9PT0gZXZlbnQudGFyZ2V0ID8gb3JpZ2luYWwudG9FbGVtZW50IDogZnJvbUVsZW1lbnQ7CgkJCX0KCgkJCS8vIEFkZCB3aGljaCBmb3IgY2xpY2s6IDEgPT09IGxlZnQ7IDIgPT09IG1pZGRsZTsgMyA9PT0gcmlnaHQKCQkJLy8gTm90ZTogYnV0dG9uIGlzIG5vdCBub3JtYWxpemVkLCBzbyBkb24ndCB1c2UgaXQKCQkJaWYgKCAhZXZlbnQud2hpY2ggJiYgYnV0dG9uICE9PSB1bmRlZmluZWQgKSB7CgkJCQlldmVudC53aGljaCA9ICggYnV0dG9uICYgMSA/IDEgOiAoIGJ1dHRvbiAmIDIgPyAzIDogKCBidXR0b24gJiA0ID8gMiA6IDAgKSApICk7CgkJCX0KCgkJCXJldHVybiBldmVudDsKCQl9Cgl9LAoKCXNwZWNpYWw6IHsKCQlsb2FkOiB7CgkJCS8vIFByZXZlbnQgdHJpZ2dlcmVkIGltYWdlLmxvYWQgZXZlbnRzIGZyb20gYnViYmxpbmcgdG8gd2luZG93LmxvYWQKCQkJbm9CdWJibGU6IHRydWUKCQl9LAoJCWNsaWNrOiB7CgkJCS8vIEZvciBjaGVja2JveCwgZmlyZSBuYXRpdmUgZXZlbnQgc28gY2hlY2tlZCBzdGF0ZSB3aWxsIGJlIHJpZ2h0CgkJCXRyaWdnZXI6IGZ1bmN0aW9uKCkgewoJCQkJaWYgKCBqUXVlcnkubm9kZU5hbWUoIHRoaXMsICJpbnB1dCIgKSAmJiB0aGlzLnR5cGUgPT09ICJjaGVja2JveCIgJiYgdGhpcy5jbGljayApIHsKCQkJCQl0aGlzLmNsaWNrKCk7CgkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJfQoJCQl9CgkJfSwKCQlmb2N1czogewoJCQkvLyBGaXJlIG5hdGl2ZSBldmVudCBpZiBwb3NzaWJsZSBzbyBibHVyL2ZvY3VzIHNlcXVlbmNlIGlzIGNvcnJlY3QKCQkJdHJpZ2dlcjogZnVuY3Rpb24oKSB7CgkJCQlpZiAoIHRoaXMgIT09IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgJiYgdGhpcy5mb2N1cyApIHsKCQkJCQl0cnkgewoJCQkJCQl0aGlzLmZvY3VzKCk7CgkJCQkJCXJldHVybiBmYWxzZTsKCQkJCQl9IGNhdGNoICggZSApIHsKCQkJCQkJLy8gU3VwcG9ydDogSUU8OQoJCQkJCQkvLyBJZiB3ZSBlcnJvciBvbiBmb2N1cyB0byBoaWRkZW4gZWxlbWVudCAoIzE0ODYsICMxMjUxOCksCgkJCQkJCS8vIGxldCAudHJpZ2dlcigpIHJ1biB0aGUgaGFuZGxlcnMKCQkJCQl9CgkJCQl9CgkJCX0sCgkJCWRlbGVnYXRlVHlwZTogImZvY3VzaW4iCgkJfSwKCQlibHVyOiB7CgkJCXRyaWdnZXI6IGZ1bmN0aW9uKCkgewoJCQkJaWYgKCB0aGlzID09PSBkb2N1bWVudC5hY3RpdmVFbGVtZW50ICYmIHRoaXMuYmx1ciApIHsKCQkJCQl0aGlzLmJsdXIoKTsKCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQl9CgkJCX0sCgkJCWRlbGVnYXRlVHlwZTogImZvY3Vzb3V0IgoJCX0sCgoJCWJlZm9yZXVubG9hZDogewoJCQlwb3N0RGlzcGF0Y2g6IGZ1bmN0aW9uKCBldmVudCApIHsKCgkJCQkvLyBFdmVuIHdoZW4gcmV0dXJuVmFsdWUgZXF1YWxzIHRvIHVuZGVmaW5lZCBGaXJlZm94IHdpbGwgc3RpbGwgc2hvdyBhbGVydAoJCQkJaWYgKCBldmVudC5yZXN1bHQgIT09IHVuZGVmaW5lZCApIHsKCQkJCQlldmVudC5vcmlnaW5hbEV2ZW50LnJldHVyblZhbHVlID0gZXZlbnQucmVzdWx0OwoJCQkJfQoJCQl9CgkJfQoJfSwKCglzaW11bGF0ZTogZnVuY3Rpb24oIHR5cGUsIGVsZW0sIGV2ZW50LCBidWJibGUgKSB7CgkJLy8gUGlnZ3liYWNrIG9uIGEgZG9ub3IgZXZlbnQgdG8gc2ltdWxhdGUgYSBkaWZmZXJlbnQgb25lLgoJCS8vIEZha2Ugb3JpZ2luYWxFdmVudCB0byBhdm9pZCBkb25vcidzIHN0b3BQcm9wYWdhdGlvbiwgYnV0IGlmIHRoZQoJCS8vIHNpbXVsYXRlZCBldmVudCBwcmV2ZW50cyBkZWZhdWx0IHRoZW4gd2UgZG8gdGhlIHNhbWUgb24gdGhlIGRvbm9yLgoJCXZhciBlID0galF1ZXJ5LmV4dGVuZCgKCQkJbmV3IGpRdWVyeS5FdmVudCgpLAoJCQlldmVudCwKCQkJeyB0eXBlOiB0eXBlLAoJCQkJaXNTaW11bGF0ZWQ6IHRydWUsCgkJCQlvcmlnaW5hbEV2ZW50OiB7fQoJCQl9CgkJKTsKCQlpZiAoIGJ1YmJsZSApIHsKCQkJalF1ZXJ5LmV2ZW50LnRyaWdnZXIoIGUsIG51bGwsIGVsZW0gKTsKCQl9IGVsc2UgewoJCQlqUXVlcnkuZXZlbnQuZGlzcGF0Y2guY2FsbCggZWxlbSwgZSApOwoJCX0KCQlpZiAoIGUuaXNEZWZhdWx0UHJldmVudGVkKCkgKSB7CgkJCWV2ZW50LnByZXZlbnREZWZhdWx0KCk7CgkJfQoJfQp9OwoKalF1ZXJ5LnJlbW92ZUV2ZW50ID0gZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lciA/CglmdW5jdGlvbiggZWxlbSwgdHlwZSwgaGFuZGxlICkgewoJCWlmICggZWxlbS5yZW1vdmVFdmVudExpc3RlbmVyICkgewoJCQllbGVtLnJlbW92ZUV2ZW50TGlzdGVuZXIoIHR5cGUsIGhhbmRsZSwgZmFsc2UgKTsKCQl9Cgl9IDoKCWZ1bmN0aW9uKCBlbGVtLCB0eXBlLCBoYW5kbGUgKSB7CgkJdmFyIG5hbWUgPSAib24iICsgdHlwZTsKCgkJaWYgKCBlbGVtLmRldGFjaEV2ZW50ICkgewoKCQkJLy8gIzg1NDUsICM3MDU0LCBwcmV2ZW50aW5nIG1lbW9yeSBsZWFrcyBmb3IgY3VzdG9tIGV2ZW50cyBpbiBJRTYtOAoJCQkvLyBkZXRhY2hFdmVudCBuZWVkZWQgcHJvcGVydHkgb24gZWxlbWVudCwgYnkgbmFtZSBvZiB0aGF0IGV2ZW50LCB0byBwcm9wZXJseSBleHBvc2UgaXQgdG8gR0MKCQkJaWYgKCB0eXBlb2YgZWxlbVsgbmFtZSBdID09PSBjb3JlX3N0cnVuZGVmaW5lZCApIHsKCQkJCWVsZW1bIG5hbWUgXSA9IG51bGw7CgkJCX0KCgkJCWVsZW0uZGV0YWNoRXZlbnQoIG5hbWUsIGhhbmRsZSApOwoJCX0KCX07CgpqUXVlcnkuRXZlbnQgPSBmdW5jdGlvbiggc3JjLCBwcm9wcyApIHsKCS8vIEFsbG93IGluc3RhbnRpYXRpb24gd2l0aG91dCB0aGUgJ25ldycga2V5d29yZAoJaWYgKCAhKHRoaXMgaW5zdGFuY2VvZiBqUXVlcnkuRXZlbnQpICkgewoJCXJldHVybiBuZXcgalF1ZXJ5LkV2ZW50KCBzcmMsIHByb3BzICk7Cgl9CgoJLy8gRXZlbnQgb2JqZWN0CglpZiAoIHNyYyAmJiBzcmMudHlwZSApIHsKCQl0aGlzLm9yaWdpbmFsRXZlbnQgPSBzcmM7CgkJdGhpcy50eXBlID0gc3JjLnR5cGU7CgoJCS8vIEV2ZW50cyBidWJibGluZyB1cCB0aGUgZG9jdW1lbnQgbWF5IGhhdmUgYmVlbiBtYXJrZWQgYXMgcHJldmVudGVkCgkJLy8gYnkgYSBoYW5kbGVyIGxvd2VyIGRvd24gdGhlIHRyZWU7IHJlZmxlY3QgdGhlIGNvcnJlY3QgdmFsdWUuCgkJdGhpcy5pc0RlZmF1bHRQcmV2ZW50ZWQgPSAoIHNyYy5kZWZhdWx0UHJldmVudGVkIHx8IHNyYy5yZXR1cm5WYWx1ZSA9PT0gZmFsc2UgfHwKCQkJc3JjLmdldFByZXZlbnREZWZhdWx0ICYmIHNyYy5nZXRQcmV2ZW50RGVmYXVsdCgpICkgPyByZXR1cm5UcnVlIDogcmV0dXJuRmFsc2U7CgoJLy8gRXZlbnQgdHlwZQoJfSBlbHNlIHsKCQl0aGlzLnR5cGUgPSBzcmM7Cgl9CgoJLy8gUHV0IGV4cGxpY2l0bHkgcHJvdmlkZWQgcHJvcGVydGllcyBvbnRvIHRoZSBldmVudCBvYmplY3QKCWlmICggcHJvcHMgKSB7CgkJalF1ZXJ5LmV4dGVuZCggdGhpcywgcHJvcHMgKTsKCX0KCgkvLyBDcmVhdGUgYSB0aW1lc3RhbXAgaWYgaW5jb21pbmcgZXZlbnQgZG9lc24ndCBoYXZlIG9uZQoJdGhpcy50aW1lU3RhbXAgPSBzcmMgJiYgc3JjLnRpbWVTdGFtcCB8fCBqUXVlcnkubm93KCk7CgoJLy8gTWFyayBpdCBhcyBmaXhlZAoJdGhpc1sgalF1ZXJ5LmV4cGFuZG8gXSA9IHRydWU7Cn07CgovLyBqUXVlcnkuRXZlbnQgaXMgYmFzZWQgb24gRE9NMyBFdmVudHMgYXMgc3BlY2lmaWVkIGJ5IHRoZSBFQ01BU2NyaXB0IExhbmd1YWdlIEJpbmRpbmcKLy8gaHR0cDovL3d3dy53My5vcmcvVFIvMjAwMy9XRC1ET00tTGV2ZWwtMy1FdmVudHMtMjAwMzAzMzEvZWNtYS1zY3JpcHQtYmluZGluZy5odG1sCmpRdWVyeS5FdmVudC5wcm90b3R5cGUgPSB7Cglpc0RlZmF1bHRQcmV2ZW50ZWQ6IHJldHVybkZhbHNlLAoJaXNQcm9wYWdhdGlvblN0b3BwZWQ6IHJldHVybkZhbHNlLAoJaXNJbW1lZGlhdGVQcm9wYWdhdGlvblN0b3BwZWQ6IHJldHVybkZhbHNlLAoKCXByZXZlbnREZWZhdWx0OiBmdW5jdGlvbigpIHsKCQl2YXIgZSA9IHRoaXMub3JpZ2luYWxFdmVudDsKCgkJdGhpcy5pc0RlZmF1bHRQcmV2ZW50ZWQgPSByZXR1cm5UcnVlOwoJCWlmICggIWUgKSB7CgkJCXJldHVybjsKCQl9CgoJCS8vIElmIHByZXZlbnREZWZhdWx0IGV4aXN0cywgcnVuIGl0IG9uIHRoZSBvcmlnaW5hbCBldmVudAoJCWlmICggZS5wcmV2ZW50RGVmYXVsdCApIHsKCQkJZS5wcmV2ZW50RGVmYXVsdCgpOwoKCQkvLyBTdXBwb3J0OiBJRQoJCS8vIE90aGVyd2lzZSBzZXQgdGhlIHJldHVyblZhbHVlIHByb3BlcnR5IG9mIHRoZSBvcmlnaW5hbCBldmVudCB0byBmYWxzZQoJCX0gZWxzZSB7CgkJCWUucmV0dXJuVmFsdWUgPSBmYWxzZTsKCQl9Cgl9LAoJc3RvcFByb3BhZ2F0aW9uOiBmdW5jdGlvbigpIHsKCQl2YXIgZSA9IHRoaXMub3JpZ2luYWxFdmVudDsKCgkJdGhpcy5pc1Byb3BhZ2F0aW9uU3RvcHBlZCA9IHJldHVyblRydWU7CgkJaWYgKCAhZSApIHsKCQkJcmV0dXJuOwoJCX0KCQkvLyBJZiBzdG9wUHJvcGFnYXRpb24gZXhpc3RzLCBydW4gaXQgb24gdGhlIG9yaWdpbmFsIGV2ZW50CgkJaWYgKCBlLnN0b3BQcm9wYWdhdGlvbiApIHsKCQkJZS5zdG9wUHJvcGFnYXRpb24oKTsKCQl9CgoJCS8vIFN1cHBvcnQ6IElFCgkJLy8gU2V0IHRoZSBjYW5jZWxCdWJibGUgcHJvcGVydHkgb2YgdGhlIG9yaWdpbmFsIGV2ZW50IHRvIHRydWUKCQllLmNhbmNlbEJ1YmJsZSA9IHRydWU7Cgl9LAoJc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uOiBmdW5jdGlvbigpIHsKCQl0aGlzLmlzSW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkID0gcmV0dXJuVHJ1ZTsKCQl0aGlzLnN0b3BQcm9wYWdhdGlvbigpOwoJfQp9OwoKLy8gQ3JlYXRlIG1vdXNlZW50ZXIvbGVhdmUgZXZlbnRzIHVzaW5nIG1vdXNlb3Zlci9vdXQgYW5kIGV2ZW50LXRpbWUgY2hlY2tzCmpRdWVyeS5lYWNoKHsKCW1vdXNlZW50ZXI6ICJtb3VzZW92ZXIiLAoJbW91c2VsZWF2ZTogIm1vdXNlb3V0Igp9LCBmdW5jdGlvbiggb3JpZywgZml4ICkgewoJalF1ZXJ5LmV2ZW50LnNwZWNpYWxbIG9yaWcgXSA9IHsKCQlkZWxlZ2F0ZVR5cGU6IGZpeCwKCQliaW5kVHlwZTogZml4LAoKCQloYW5kbGU6IGZ1bmN0aW9uKCBldmVudCApIHsKCQkJdmFyIHJldCwKCQkJCXRhcmdldCA9IHRoaXMsCgkJCQlyZWxhdGVkID0gZXZlbnQucmVsYXRlZFRhcmdldCwKCQkJCWhhbmRsZU9iaiA9IGV2ZW50LmhhbmRsZU9iajsKCgkJCS8vIEZvciBtb3VzZW50ZXIvbGVhdmUgY2FsbCB0aGUgaGFuZGxlciBpZiByZWxhdGVkIGlzIG91dHNpZGUgdGhlIHRhcmdldC4KCQkJLy8gTkI6IE5vIHJlbGF0ZWRUYXJnZXQgaWYgdGhlIG1vdXNlIGxlZnQvZW50ZXJlZCB0aGUgYnJvd3NlciB3aW5kb3cKCQkJaWYgKCAhcmVsYXRlZCB8fCAocmVsYXRlZCAhPT0gdGFyZ2V0ICYmICFqUXVlcnkuY29udGFpbnMoIHRhcmdldCwgcmVsYXRlZCApKSApIHsKCQkJCWV2ZW50LnR5cGUgPSBoYW5kbGVPYmoub3JpZ1R5cGU7CgkJCQlyZXQgPSBoYW5kbGVPYmouaGFuZGxlci5hcHBseSggdGhpcywgYXJndW1lbnRzICk7CgkJCQlldmVudC50eXBlID0gZml4OwoJCQl9CgkJCXJldHVybiByZXQ7CgkJfQoJfTsKfSk7CgovLyBJRSBzdWJtaXQgZGVsZWdhdGlvbgppZiAoICFqUXVlcnkuc3VwcG9ydC5zdWJtaXRCdWJibGVzICkgewoKCWpRdWVyeS5ldmVudC5zcGVjaWFsLnN1Ym1pdCA9IHsKCQlzZXR1cDogZnVuY3Rpb24oKSB7CgkJCS8vIE9ubHkgbmVlZCB0aGlzIGZvciBkZWxlZ2F0ZWQgZm9ybSBzdWJtaXQgZXZlbnRzCgkJCWlmICggalF1ZXJ5Lm5vZGVOYW1lKCB0aGlzLCAiZm9ybSIgKSApIHsKCQkJCXJldHVybiBmYWxzZTsKCQkJfQoKCQkJLy8gTGF6eS1hZGQgYSBzdWJtaXQgaGFuZGxlciB3aGVuIGEgZGVzY2VuZGFudCBmb3JtIG1heSBwb3RlbnRpYWxseSBiZSBzdWJtaXR0ZWQKCQkJalF1ZXJ5LmV2ZW50LmFkZCggdGhpcywgImNsaWNrLl9zdWJtaXQga2V5cHJlc3MuX3N1Ym1pdCIsIGZ1bmN0aW9uKCBlICkgewoJCQkJLy8gTm9kZSBuYW1lIGNoZWNrIGF2b2lkcyBhIFZNTC1yZWxhdGVkIGNyYXNoIGluIElFICgjOTgwNykKCQkJCXZhciBlbGVtID0gZS50YXJnZXQsCgkJCQkJZm9ybSA9IGpRdWVyeS5ub2RlTmFtZSggZWxlbSwgImlucHV0IiApIHx8IGpRdWVyeS5ub2RlTmFtZSggZWxlbSwgImJ1dHRvbiIgKSA/IGVsZW0uZm9ybSA6IHVuZGVmaW5lZDsKCQkJCWlmICggZm9ybSAmJiAhalF1ZXJ5Ll9kYXRhKCBmb3JtLCAic3VibWl0QnViYmxlcyIgKSApIHsKCQkJCQlqUXVlcnkuZXZlbnQuYWRkKCBmb3JtLCAic3VibWl0Ll9zdWJtaXQiLCBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCQkJCWV2ZW50Ll9zdWJtaXRfYnViYmxlID0gdHJ1ZTsKCQkJCQl9KTsKCQkJCQlqUXVlcnkuX2RhdGEoIGZvcm0sICJzdWJtaXRCdWJibGVzIiwgdHJ1ZSApOwoJCQkJfQoJCQl9KTsKCQkJLy8gcmV0dXJuIHVuZGVmaW5lZCBzaW5jZSB3ZSBkb24ndCBuZWVkIGFuIGV2ZW50IGxpc3RlbmVyCgkJfSwKCgkJcG9zdERpc3BhdGNoOiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCS8vIElmIGZvcm0gd2FzIHN1Ym1pdHRlZCBieSB0aGUgdXNlciwgYnViYmxlIHRoZSBldmVudCB1cCB0aGUgdHJlZQoJCQlpZiAoIGV2ZW50Ll9zdWJtaXRfYnViYmxlICkgewoJCQkJZGVsZXRlIGV2ZW50Ll9zdWJtaXRfYnViYmxlOwoJCQkJaWYgKCB0aGlzLnBhcmVudE5vZGUgJiYgIWV2ZW50LmlzVHJpZ2dlciApIHsKCQkJCQlqUXVlcnkuZXZlbnQuc2ltdWxhdGUoICJzdWJtaXQiLCB0aGlzLnBhcmVudE5vZGUsIGV2ZW50LCB0cnVlICk7CgkJCQl9CgkJCX0KCQl9LAoKCQl0ZWFyZG93bjogZnVuY3Rpb24oKSB7CgkJCS8vIE9ubHkgbmVlZCB0aGlzIGZvciBkZWxlZ2F0ZWQgZm9ybSBzdWJtaXQgZXZlbnRzCgkJCWlmICggalF1ZXJ5Lm5vZGVOYW1lKCB0aGlzLCAiZm9ybSIgKSApIHsKCQkJCXJldHVybiBmYWxzZTsKCQkJfQoKCQkJLy8gUmVtb3ZlIGRlbGVnYXRlZCBoYW5kbGVyczsgY2xlYW5EYXRhIGV2ZW50dWFsbHkgcmVhcHMgc3VibWl0IGhhbmRsZXJzIGF0dGFjaGVkIGFib3ZlCgkJCWpRdWVyeS5ldmVudC5yZW1vdmUoIHRoaXMsICIuX3N1Ym1pdCIgKTsKCQl9Cgl9Owp9CgovLyBJRSBjaGFuZ2UgZGVsZWdhdGlvbiBhbmQgY2hlY2tib3gvcmFkaW8gZml4CmlmICggIWpRdWVyeS5zdXBwb3J0LmNoYW5nZUJ1YmJsZXMgKSB7CgoJalF1ZXJ5LmV2ZW50LnNwZWNpYWwuY2hhbmdlID0gewoKCQlzZXR1cDogZnVuY3Rpb24oKSB7CgoJCQlpZiAoIHJmb3JtRWxlbXMudGVzdCggdGhpcy5ub2RlTmFtZSApICkgewoJCQkJLy8gSUUgZG9lc24ndCBmaXJlIGNoYW5nZSBvbiBhIGNoZWNrL3JhZGlvIHVudGlsIGJsdXI7IHRyaWdnZXIgaXQgb24gY2xpY2sKCQkJCS8vIGFmdGVyIGEgcHJvcGVydHljaGFuZ2UuIEVhdCB0aGUgYmx1ci1jaGFuZ2UgaW4gc3BlY2lhbC5jaGFuZ2UuaGFuZGxlLgoJCQkJLy8gVGhpcyBzdGlsbCBmaXJlcyBvbmNoYW5nZSBhIHNlY29uZCB0aW1lIGZvciBjaGVjay9yYWRpbyBhZnRlciBibHVyLgoJCQkJaWYgKCB0aGlzLnR5cGUgPT09ICJjaGVja2JveCIgfHwgdGhpcy50eXBlID09PSAicmFkaW8iICkgewoJCQkJCWpRdWVyeS5ldmVudC5hZGQoIHRoaXMsICJwcm9wZXJ0eWNoYW5nZS5fY2hhbmdlIiwgZnVuY3Rpb24oIGV2ZW50ICkgewoJCQkJCQlpZiAoIGV2ZW50Lm9yaWdpbmFsRXZlbnQucHJvcGVydHlOYW1lID09PSAiY2hlY2tlZCIgKSB7CgkJCQkJCQl0aGlzLl9qdXN0X2NoYW5nZWQgPSB0cnVlOwoJCQkJCQl9CgkJCQkJfSk7CgkJCQkJalF1ZXJ5LmV2ZW50LmFkZCggdGhpcywgImNsaWNrLl9jaGFuZ2UiLCBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCQkJCWlmICggdGhpcy5fanVzdF9jaGFuZ2VkICYmICFldmVudC5pc1RyaWdnZXIgKSB7CgkJCQkJCQl0aGlzLl9qdXN0X2NoYW5nZWQgPSBmYWxzZTsKCQkJCQkJfQoJCQkJCQkvLyBBbGxvdyB0cmlnZ2VyZWQsIHNpbXVsYXRlZCBjaGFuZ2UgZXZlbnRzICgjMTE1MDApCgkJCQkJCWpRdWVyeS5ldmVudC5zaW11bGF0ZSggImNoYW5nZSIsIHRoaXMsIGV2ZW50LCB0cnVlICk7CgkJCQkJfSk7CgkJCQl9CgkJCQlyZXR1cm4gZmFsc2U7CgkJCX0KCQkJLy8gRGVsZWdhdGVkIGV2ZW50OyBsYXp5LWFkZCBhIGNoYW5nZSBoYW5kbGVyIG9uIGRlc2NlbmRhbnQgaW5wdXRzCgkJCWpRdWVyeS5ldmVudC5hZGQoIHRoaXMsICJiZWZvcmVhY3RpdmF0ZS5fY2hhbmdlIiwgZnVuY3Rpb24oIGUgKSB7CgkJCQl2YXIgZWxlbSA9IGUudGFyZ2V0OwoKCQkJCWlmICggcmZvcm1FbGVtcy50ZXN0KCBlbGVtLm5vZGVOYW1lICkgJiYgIWpRdWVyeS5fZGF0YSggZWxlbSwgImNoYW5nZUJ1YmJsZXMiICkgKSB7CgkJCQkJalF1ZXJ5LmV2ZW50LmFkZCggZWxlbSwgImNoYW5nZS5fY2hhbmdlIiwgZnVuY3Rpb24oIGV2ZW50ICkgewoJCQkJCQlpZiAoIHRoaXMucGFyZW50Tm9kZSAmJiAhZXZlbnQuaXNTaW11bGF0ZWQgJiYgIWV2ZW50LmlzVHJpZ2dlciApIHsKCQkJCQkJCWpRdWVyeS5ldmVudC5zaW11bGF0ZSggImNoYW5nZSIsIHRoaXMucGFyZW50Tm9kZSwgZXZlbnQsIHRydWUgKTsKCQkJCQkJfQoJCQkJCX0pOwoJCQkJCWpRdWVyeS5fZGF0YSggZWxlbSwgImNoYW5nZUJ1YmJsZXMiLCB0cnVlICk7CgkJCQl9CgkJCX0pOwoJCX0sCgoJCWhhbmRsZTogZnVuY3Rpb24oIGV2ZW50ICkgewoJCQl2YXIgZWxlbSA9IGV2ZW50LnRhcmdldDsKCgkJCS8vIFN3YWxsb3cgbmF0aXZlIGNoYW5nZSBldmVudHMgZnJvbSBjaGVja2JveC9yYWRpbywgd2UgYWxyZWFkeSB0cmlnZ2VyZWQgdGhlbSBhYm92ZQoJCQlpZiAoIHRoaXMgIT09IGVsZW0gfHwgZXZlbnQuaXNTaW11bGF0ZWQgfHwgZXZlbnQuaXNUcmlnZ2VyIHx8IChlbGVtLnR5cGUgIT09ICJyYWRpbyIgJiYgZWxlbS50eXBlICE9PSAiY2hlY2tib3giKSApIHsKCQkJCXJldHVybiBldmVudC5oYW5kbGVPYmouaGFuZGxlci5hcHBseSggdGhpcywgYXJndW1lbnRzICk7CgkJCX0KCQl9LAoKCQl0ZWFyZG93bjogZnVuY3Rpb24oKSB7CgkJCWpRdWVyeS5ldmVudC5yZW1vdmUoIHRoaXMsICIuX2NoYW5nZSIgKTsKCgkJCXJldHVybiAhcmZvcm1FbGVtcy50ZXN0KCB0aGlzLm5vZGVOYW1lICk7CgkJfQoJfTsKfQoKLy8gQ3JlYXRlICJidWJibGluZyIgZm9jdXMgYW5kIGJsdXIgZXZlbnRzCmlmICggIWpRdWVyeS5zdXBwb3J0LmZvY3VzaW5CdWJibGVzICkgewoJalF1ZXJ5LmVhY2goeyBmb2N1czogImZvY3VzaW4iLCBibHVyOiAiZm9jdXNvdXQiIH0sIGZ1bmN0aW9uKCBvcmlnLCBmaXggKSB7CgoJCS8vIEF0dGFjaCBhIHNpbmdsZSBjYXB0dXJpbmcgaGFuZGxlciB3aGlsZSBzb21lb25lIHdhbnRzIGZvY3VzaW4vZm9jdXNvdXQKCQl2YXIgYXR0YWNoZXMgPSAwLAoJCQloYW5kbGVyID0gZnVuY3Rpb24oIGV2ZW50ICkgewoJCQkJalF1ZXJ5LmV2ZW50LnNpbXVsYXRlKCBmaXgsIGV2ZW50LnRhcmdldCwgalF1ZXJ5LmV2ZW50LmZpeCggZXZlbnQgKSwgdHJ1ZSApOwoJCQl9OwoKCQlqUXVlcnkuZXZlbnQuc3BlY2lhbFsgZml4IF0gPSB7CgkJCXNldHVwOiBmdW5jdGlvbigpIHsKCQkJCWlmICggYXR0YWNoZXMrKyA9PT0gMCApIHsKCQkJCQlkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCBvcmlnLCBoYW5kbGVyLCB0cnVlICk7CgkJCQl9CgkJCX0sCgkJCXRlYXJkb3duOiBmdW5jdGlvbigpIHsKCQkJCWlmICggLS1hdHRhY2hlcyA9PT0gMCApIHsKCQkJCQlkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCBvcmlnLCBoYW5kbGVyLCB0cnVlICk7CgkJCQl9CgkJCX0KCQl9OwoJfSk7Cn0KCmpRdWVyeS5mbi5leHRlbmQoewoKCW9uOiBmdW5jdGlvbiggdHlwZXMsIHNlbGVjdG9yLCBkYXRhLCBmbiwgLypJTlRFUk5BTCovIG9uZSApIHsKCQl2YXIgdHlwZSwgb3JpZ0ZuOwoKCQkvLyBUeXBlcyBjYW4gYmUgYSBtYXAgb2YgdHlwZXMvaGFuZGxlcnMKCQlpZiAoIHR5cGVvZiB0eXBlcyA9PT0gIm9iamVjdCIgKSB7CgkJCS8vICggdHlwZXMtT2JqZWN0LCBzZWxlY3RvciwgZGF0YSApCgkJCWlmICggdHlwZW9mIHNlbGVjdG9yICE9PSAic3RyaW5nIiApIHsKCQkJCS8vICggdHlwZXMtT2JqZWN0LCBkYXRhICkKCQkJCWRhdGEgPSBkYXRhIHx8IHNlbGVjdG9yOwoJCQkJc2VsZWN0b3IgPSB1bmRlZmluZWQ7CgkJCX0KCQkJZm9yICggdHlwZSBpbiB0eXBlcyApIHsKCQkJCXRoaXMub24oIHR5cGUsIHNlbGVjdG9yLCBkYXRhLCB0eXBlc1sgdHlwZSBdLCBvbmUgKTsKCQkJfQoJCQlyZXR1cm4gdGhpczsKCQl9CgoJCWlmICggZGF0YSA9PSBudWxsICYmIGZuID09IG51bGwgKSB7CgkJCS8vICggdHlwZXMsIGZuICkKCQkJZm4gPSBzZWxlY3RvcjsKCQkJZGF0YSA9IHNlbGVjdG9yID0gdW5kZWZpbmVkOwoJCX0gZWxzZSBpZiAoIGZuID09IG51bGwgKSB7CgkJCWlmICggdHlwZW9mIHNlbGVjdG9yID09PSAic3RyaW5nIiApIHsKCQkJCS8vICggdHlwZXMsIHNlbGVjdG9yLCBmbiApCgkJCQlmbiA9IGRhdGE7CgkJCQlkYXRhID0gdW5kZWZpbmVkOwoJCQl9IGVsc2UgewoJCQkJLy8gKCB0eXBlcywgZGF0YSwgZm4gKQoJCQkJZm4gPSBkYXRhOwoJCQkJZGF0YSA9IHNlbGVjdG9yOwoJCQkJc2VsZWN0b3IgPSB1bmRlZmluZWQ7CgkJCX0KCQl9CgkJaWYgKCBmbiA9PT0gZmFsc2UgKSB7CgkJCWZuID0gcmV0dXJuRmFsc2U7CgkJfSBlbHNlIGlmICggIWZuICkgewoJCQlyZXR1cm4gdGhpczsKCQl9CgoJCWlmICggb25lID09PSAxICkgewoJCQlvcmlnRm4gPSBmbjsKCQkJZm4gPSBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCQkvLyBDYW4gdXNlIGFuIGVtcHR5IHNldCwgc2luY2UgZXZlbnQgY29udGFpbnMgdGhlIGluZm8KCQkJCWpRdWVyeSgpLm9mZiggZXZlbnQgKTsKCQkJCXJldHVybiBvcmlnRm4uYXBwbHkoIHRoaXMsIGFyZ3VtZW50cyApOwoJCQl9OwoJCQkvLyBVc2Ugc2FtZSBndWlkIHNvIGNhbGxlciBjYW4gcmVtb3ZlIHVzaW5nIG9yaWdGbgoJCQlmbi5ndWlkID0gb3JpZ0ZuLmd1aWQgfHwgKCBvcmlnRm4uZ3VpZCA9IGpRdWVyeS5ndWlkKysgKTsKCQl9CgkJcmV0dXJuIHRoaXMuZWFjaCggZnVuY3Rpb24oKSB7CgkJCWpRdWVyeS5ldmVudC5hZGQoIHRoaXMsIHR5cGVzLCBmbiwgZGF0YSwgc2VsZWN0b3IgKTsKCQl9KTsKCX0sCglvbmU6IGZ1bmN0aW9uKCB0eXBlcywgc2VsZWN0b3IsIGRhdGEsIGZuICkgewoJCXJldHVybiB0aGlzLm9uKCB0eXBlcywgc2VsZWN0b3IsIGRhdGEsIGZuLCAxICk7Cgl9LAoJb2ZmOiBmdW5jdGlvbiggdHlwZXMsIHNlbGVjdG9yLCBmbiApIHsKCQl2YXIgaGFuZGxlT2JqLCB0eXBlOwoJCWlmICggdHlwZXMgJiYgdHlwZXMucHJldmVudERlZmF1bHQgJiYgdHlwZXMuaGFuZGxlT2JqICkgewoJCQkvLyAoIGV2ZW50ICkgIGRpc3BhdGNoZWQgalF1ZXJ5LkV2ZW50CgkJCWhhbmRsZU9iaiA9IHR5cGVzLmhhbmRsZU9iajsKCQkJalF1ZXJ5KCB0eXBlcy5kZWxlZ2F0ZVRhcmdldCApLm9mZigKCQkJCWhhbmRsZU9iai5uYW1lc3BhY2UgPyBoYW5kbGVPYmoub3JpZ1R5cGUgKyAiLiIgKyBoYW5kbGVPYmoubmFtZXNwYWNlIDogaGFuZGxlT2JqLm9yaWdUeXBlLAoJCQkJaGFuZGxlT2JqLnNlbGVjdG9yLAoJCQkJaGFuZGxlT2JqLmhhbmRsZXIKCQkJKTsKCQkJcmV0dXJuIHRoaXM7CgkJfQoJCWlmICggdHlwZW9mIHR5cGVzID09PSAib2JqZWN0IiApIHsKCQkJLy8gKCB0eXBlcy1vYmplY3QgWywgc2VsZWN0b3JdICkKCQkJZm9yICggdHlwZSBpbiB0eXBlcyApIHsKCQkJCXRoaXMub2ZmKCB0eXBlLCBzZWxlY3RvciwgdHlwZXNbIHR5cGUgXSApOwoJCQl9CgkJCXJldHVybiB0aGlzOwoJCX0KCQlpZiAoIHNlbGVjdG9yID09PSBmYWxzZSB8fCB0eXBlb2Ygc2VsZWN0b3IgPT09ICJmdW5jdGlvbiIgKSB7CgkJCS8vICggdHlwZXMgWywgZm5dICkKCQkJZm4gPSBzZWxlY3RvcjsKCQkJc2VsZWN0b3IgPSB1bmRlZmluZWQ7CgkJfQoJCWlmICggZm4gPT09IGZhbHNlICkgewoJCQlmbiA9IHJldHVybkZhbHNlOwoJCX0KCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCQlqUXVlcnkuZXZlbnQucmVtb3ZlKCB0aGlzLCB0eXBlcywgZm4sIHNlbGVjdG9yICk7CgkJfSk7Cgl9LAoKCWJpbmQ6IGZ1bmN0aW9uKCB0eXBlcywgZGF0YSwgZm4gKSB7CgkJcmV0dXJuIHRoaXMub24oIHR5cGVzLCBudWxsLCBkYXRhLCBmbiApOwoJfSwKCXVuYmluZDogZnVuY3Rpb24oIHR5cGVzLCBmbiApIHsKCQlyZXR1cm4gdGhpcy5vZmYoIHR5cGVzLCBudWxsLCBmbiApOwoJfSwKCglkZWxlZ2F0ZTogZnVuY3Rpb24oIHNlbGVjdG9yLCB0eXBlcywgZGF0YSwgZm4gKSB7CgkJcmV0dXJuIHRoaXMub24oIHR5cGVzLCBzZWxlY3RvciwgZGF0YSwgZm4gKTsKCX0sCgl1bmRlbGVnYXRlOiBmdW5jdGlvbiggc2VsZWN0b3IsIHR5cGVzLCBmbiApIHsKCQkvLyAoIG5hbWVzcGFjZSApIG9yICggc2VsZWN0b3IsIHR5cGVzIFssIGZuXSApCgkJcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPT09IDEgPyB0aGlzLm9mZiggc2VsZWN0b3IsICIqKiIgKSA6IHRoaXMub2ZmKCB0eXBlcywgc2VsZWN0b3IgfHwgIioqIiwgZm4gKTsKCX0sCgoJdHJpZ2dlcjogZnVuY3Rpb24oIHR5cGUsIGRhdGEgKSB7CgkJcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKCQkJalF1ZXJ5LmV2ZW50LnRyaWdnZXIoIHR5cGUsIGRhdGEsIHRoaXMgKTsKCQl9KTsKCX0sCgl0cmlnZ2VySGFuZGxlcjogZnVuY3Rpb24oIHR5cGUsIGRhdGEgKSB7CgkJdmFyIGVsZW0gPSB0aGlzWzBdOwoJCWlmICggZWxlbSApIHsKCQkJcmV0dXJuIGpRdWVyeS5ldmVudC50cmlnZ2VyKCB0eXBlLCBkYXRhLCBlbGVtLCB0cnVlICk7CgkJfQoJfQp9KTsKLyohCiAqIFNpenpsZSBDU1MgU2VsZWN0b3IgRW5naW5lCiAqIENvcHlyaWdodCAyMDEyIGpRdWVyeSBGb3VuZGF0aW9uIGFuZCBvdGhlciBjb250cmlidXRvcnMKICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlCiAqIGh0dHA6Ly9zaXp6bGVqcy5jb20vCiAqLwooZnVuY3Rpb24oIHdpbmRvdywgdW5kZWZpbmVkICkgewoKdmFyIGksCgljYWNoZWRydW5zLAoJRXhwciwKCWdldFRleHQsCglpc1hNTCwKCWNvbXBpbGUsCgloYXNEdXBsaWNhdGUsCglvdXRlcm1vc3RDb250ZXh0LAoKCS8vIExvY2FsIGRvY3VtZW50IHZhcnMKCXNldERvY3VtZW50LAoJZG9jdW1lbnQsCglkb2NFbGVtLAoJZG9jdW1lbnRJc1hNTCwKCXJidWdneVFTQSwKCXJidWdneU1hdGNoZXMsCgltYXRjaGVzLAoJY29udGFpbnMsCglzb3J0T3JkZXIsCgoJLy8gSW5zdGFuY2Utc3BlY2lmaWMgZGF0YQoJZXhwYW5kbyA9ICJzaXp6bGUiICsgLShuZXcgRGF0ZSgpKSwKCXByZWZlcnJlZERvYyA9IHdpbmRvdy5kb2N1bWVudCwKCXN1cHBvcnQgPSB7fSwKCWRpcnJ1bnMgPSAwLAoJZG9uZSA9IDAsCgljbGFzc0NhY2hlID0gY3JlYXRlQ2FjaGUoKSwKCXRva2VuQ2FjaGUgPSBjcmVhdGVDYWNoZSgpLAoJY29tcGlsZXJDYWNoZSA9IGNyZWF0ZUNhY2hlKCksCgoJLy8gR2VuZXJhbC1wdXJwb3NlIGNvbnN0YW50cwoJc3RydW5kZWZpbmVkID0gdHlwZW9mIHVuZGVmaW5lZCwKCU1BWF9ORUdBVElWRSA9IDEgPDwgMzEsCgoJLy8gQXJyYXkgbWV0aG9kcwoJYXJyID0gW10sCglwb3AgPSBhcnIucG9wLAoJcHVzaCA9IGFyci5wdXNoLAoJc2xpY2UgPSBhcnIuc2xpY2UsCgkvLyBVc2UgYSBzdHJpcHBlZC1kb3duIGluZGV4T2YgaWYgd2UgY2FuJ3QgdXNlIGEgbmF0aXZlIG9uZQoJaW5kZXhPZiA9IGFyci5pbmRleE9mIHx8IGZ1bmN0aW9uKCBlbGVtICkgewoJCXZhciBpID0gMCwKCQkJbGVuID0gdGhpcy5sZW5ndGg7CgkJZm9yICggOyBpIDwgbGVuOyBpKysgKSB7CgkJCWlmICggdGhpc1tpXSA9PT0gZWxlbSApIHsKCQkJCXJldHVybiBpOwoJCQl9CgkJfQoJCXJldHVybiAtMTsKCX0sCgoKCS8vIFJlZ3VsYXIgZXhwcmVzc2lvbnMKCgkvLyBXaGl0ZXNwYWNlIGNoYXJhY3RlcnMgaHR0cDovL3d3dy53My5vcmcvVFIvY3NzMy1zZWxlY3RvcnMvI3doaXRlc3BhY2UKCXdoaXRlc3BhY2UgPSAiW1xceDIwXFx0XFxyXFxuXFxmXSIsCgkvLyBodHRwOi8vd3d3LnczLm9yZy9UUi9jc3MzLXN5bnRheC8jY2hhcmFjdGVycwoJY2hhcmFjdGVyRW5jb2RpbmcgPSAiKD86XFxcXC58W1xcdy1dfFteXFx4MDAtXFx4YTBdKSsiLAoKCS8vIExvb3NlbHkgbW9kZWxlZCBvbiBDU1MgaWRlbnRpZmllciBjaGFyYWN0ZXJzCgkvLyBBbiB1bnF1b3RlZCB2YWx1ZSBzaG91bGQgYmUgYSBDU1MgaWRlbnRpZmllciBodHRwOi8vd3d3LnczLm9yZy9UUi9jc3MzLXNlbGVjdG9ycy8jYXR0cmlidXRlLXNlbGVjdG9ycwoJLy8gUHJvcGVyIHN5bnRheDogaHR0cDovL3d3dy53My5vcmcvVFIvQ1NTMjEvc3luZGF0YS5odG1sI3ZhbHVlLWRlZi1pZGVudGlmaWVyCglpZGVudGlmaWVyID0gY2hhcmFjdGVyRW5jb2RpbmcucmVwbGFjZSggInciLCAidyMiICksCgoJLy8gQWNjZXB0YWJsZSBvcGVyYXRvcnMgaHR0cDovL3d3dy53My5vcmcvVFIvc2VsZWN0b3JzLyNhdHRyaWJ1dGUtc2VsZWN0b3JzCglvcGVyYXRvcnMgPSAiKFsqXiR8IX5dPz0pIiwKCWF0dHJpYnV0ZXMgPSAiXFxbIiArIHdoaXRlc3BhY2UgKyAiKigiICsgY2hhcmFjdGVyRW5jb2RpbmcgKyAiKSIgKyB3aGl0ZXNwYWNlICsKCQkiKig/OiIgKyBvcGVyYXRvcnMgKyB3aGl0ZXNwYWNlICsgIiooPzooWydcIl0pKCg/OlxcXFwufFteXFxcXF0pKj8pXFwzfCgiICsgaWRlbnRpZmllciArICIpfCl8KSIgKyB3aGl0ZXNwYWNlICsgIipcXF0iLAoKCS8vIFByZWZlciBhcmd1bWVudHMgcXVvdGVkLAoJLy8gICB0aGVuIG5vdCBjb250YWluaW5nIHBzZXVkb3MvYnJhY2tldHMsCgkvLyAgIHRoZW4gYXR0cmlidXRlIHNlbGVjdG9ycy9ub24tcGFyZW50aGV0aWNhbCBleHByZXNzaW9ucywKCS8vICAgdGhlbiBhbnl0aGluZyBlbHNlCgkvLyBUaGVzZSBwcmVmZXJlbmNlcyBhcmUgaGVyZSB0byByZWR1Y2UgdGhlIG51bWJlciBvZiBzZWxlY3RvcnMKCS8vICAgbmVlZGluZyB0b2tlbml6ZSBpbiB0aGUgUFNFVURPIHByZUZpbHRlcgoJcHNldWRvcyA9ICI6KCIgKyBjaGFyYWN0ZXJFbmNvZGluZyArICIpKD86XFwoKChbJ1wiXSkoKD86XFxcXC58W15cXFxcXSkqPylcXDN8KCg/OlxcXFwufFteXFxcXCgpW1xcXV18IiArIGF0dHJpYnV0ZXMucmVwbGFjZSggMywgOCApICsgIikqKXwuKilcXCl8KSIsCgoJLy8gTGVhZGluZyBhbmQgbm9uLWVzY2FwZWQgdHJhaWxpbmcgd2hpdGVzcGFjZSwgY2FwdHVyaW5nIHNvbWUgbm9uLXdoaXRlc3BhY2UgY2hhcmFjdGVycyBwcmVjZWRpbmcgdGhlIGxhdHRlcgoJcnRyaW0gPSBuZXcgUmVnRXhwKCAiXiIgKyB3aGl0ZXNwYWNlICsgIit8KCg/Ol58W15cXFxcXSkoPzpcXFxcLikqKSIgKyB3aGl0ZXNwYWNlICsgIiskIiwgImciICksCgoJcmNvbW1hID0gbmV3IFJlZ0V4cCggIl4iICsgd2hpdGVzcGFjZSArICIqLCIgKyB3aGl0ZXNwYWNlICsgIioiICksCglyY29tYmluYXRvcnMgPSBuZXcgUmVnRXhwKCAiXiIgKyB3aGl0ZXNwYWNlICsgIiooW1xceDIwXFx0XFxyXFxuXFxmPit+XSkiICsgd2hpdGVzcGFjZSArICIqIiApLAoJcnBzZXVkbyA9IG5ldyBSZWdFeHAoIHBzZXVkb3MgKSwKCXJpZGVudGlmaWVyID0gbmV3IFJlZ0V4cCggIl4iICsgaWRlbnRpZmllciArICIkIiApLAoKCW1hdGNoRXhwciA9IHsKCQkiSUQiOiBuZXcgUmVnRXhwKCAiXiMoIiArIGNoYXJhY3RlckVuY29kaW5nICsgIikiICksCgkJIkNMQVNTIjogbmV3IFJlZ0V4cCggIl5cXC4oIiArIGNoYXJhY3RlckVuY29kaW5nICsgIikiICksCgkJIk5BTUUiOiBuZXcgUmVnRXhwKCAiXlxcW25hbWU9WydcIl0/KCIgKyBjaGFyYWN0ZXJFbmNvZGluZyArICIpWydcIl0/XFxdIiApLAoJCSJUQUciOiBuZXcgUmVnRXhwKCAiXigiICsgY2hhcmFjdGVyRW5jb2RpbmcucmVwbGFjZSggInciLCAidyoiICkgKyAiKSIgKSwKCQkiQVRUUiI6IG5ldyBSZWdFeHAoICJeIiArIGF0dHJpYnV0ZXMgKSwKCQkiUFNFVURPIjogbmV3IFJlZ0V4cCggIl4iICsgcHNldWRvcyApLAoJCSJDSElMRCI6IG5ldyBSZWdFeHAoICJeOihvbmx5fGZpcnN0fGxhc3R8bnRofG50aC1sYXN0KS0oY2hpbGR8b2YtdHlwZSkoPzpcXCgiICsgd2hpdGVzcGFjZSArCgkJCSIqKGV2ZW58b2RkfCgoWystXXwpKFxcZCopbnwpIiArIHdoaXRlc3BhY2UgKyAiKig/OihbKy1dfCkiICsgd2hpdGVzcGFjZSArCgkJCSIqKFxcZCspfCkpIiArIHdoaXRlc3BhY2UgKyAiKlxcKXwpIiwgImkiICksCgkJLy8gRm9yIHVzZSBpbiBsaWJyYXJpZXMgaW1wbGVtZW50aW5nIC5pcygpCgkJLy8gV2UgdXNlIHRoaXMgZm9yIFBPUyBtYXRjaGluZyBpbiBgc2VsZWN0YAoJCSJuZWVkc0NvbnRleHQiOiBuZXcgUmVnRXhwKCAiXiIgKyB3aGl0ZXNwYWNlICsgIipbPit+XXw6KGV2ZW58b2RkfGVxfGd0fGx0fG50aHxmaXJzdHxsYXN0KSg/OlxcKCIgKwoJCQl3aGl0ZXNwYWNlICsgIiooKD86LVxcZCk/XFxkKikiICsgd2hpdGVzcGFjZSArICIqXFwpfCkoPz1bXi1dfCQpIiwgImkiICkKCX0sCgoJcnNpYmxpbmcgPSAvW1x4MjBcdFxyXG5cZl0qWyt+XS8sCgoJcm5hdGl2ZSA9IC9eW157XStce1xzKlxbbmF0aXZlIGNvZGUvLAoKCS8vIEVhc2lseS1wYXJzZWFibGUvcmV0cmlldmFibGUgSUQgb3IgVEFHIG9yIENMQVNTIHNlbGVjdG9ycwoJcnF1aWNrRXhwciA9IC9eKD86IyhbXHctXSspfChcdyspfFwuKFtcdy1dKykpJC8sCgoJcmlucHV0cyA9IC9eKD86aW5wdXR8c2VsZWN0fHRleHRhcmVhfGJ1dHRvbikkL2ksCglyaGVhZGVyID0gL15oXGQkL2ksCgoJcmVzY2FwZSA9IC8nfFxcL2csCglyYXR0cmlidXRlUXVvdGVzID0gL1w9W1x4MjBcdFxyXG5cZl0qKFteJyJcXV0qKVtceDIwXHRcclxuXGZdKlxdL2csCgoJLy8gQ1NTIGVzY2FwZXMgaHR0cDovL3d3dy53My5vcmcvVFIvQ1NTMjEvc3luZGF0YS5odG1sI2VzY2FwZWQtY2hhcmFjdGVycwoJcnVuZXNjYXBlID0gL1xcKFtcZGEtZkEtRl17MSw2fVtceDIwXHRcclxuXGZdP3wuKS9nLAoJZnVuZXNjYXBlID0gZnVuY3Rpb24oIF8sIGVzY2FwZWQgKSB7CgkJdmFyIGhpZ2ggPSAiMHgiICsgZXNjYXBlZCAtIDB4MTAwMDA7CgkJLy8gTmFOIG1lYW5zIG5vbi1jb2RlcG9pbnQKCQlyZXR1cm4gaGlnaCAhPT0gaGlnaCA/CgkJCWVzY2FwZWQgOgoJCQkvLyBCTVAgY29kZXBvaW50CgkJCWhpZ2ggPCAwID8KCQkJCVN0cmluZy5mcm9tQ2hhckNvZGUoIGhpZ2ggKyAweDEwMDAwICkgOgoJCQkJLy8gU3VwcGxlbWVudGFsIFBsYW5lIGNvZGVwb2ludCAoc3Vycm9nYXRlIHBhaXIpCgkJCQlTdHJpbmcuZnJvbUNoYXJDb2RlKCBoaWdoID4+IDEwIHwgMHhEODAwLCBoaWdoICYgMHgzRkYgfCAweERDMDAgKTsKCX07CgovLyBVc2UgYSBzdHJpcHBlZC1kb3duIHNsaWNlIGlmIHdlIGNhbid0IHVzZSBhIG5hdGl2ZSBvbmUKdHJ5IHsKCXNsaWNlLmNhbGwoIHByZWZlcnJlZERvYy5kb2N1bWVudEVsZW1lbnQuY2hpbGROb2RlcywgMCApWzBdLm5vZGVUeXBlOwp9IGNhdGNoICggZSApIHsKCXNsaWNlID0gZnVuY3Rpb24oIGkgKSB7CgkJdmFyIGVsZW0sCgkJCXJlc3VsdHMgPSBbXTsKCQl3aGlsZSAoIChlbGVtID0gdGhpc1tpKytdKSApIHsKCQkJcmVzdWx0cy5wdXNoKCBlbGVtICk7CgkJfQoJCXJldHVybiByZXN1bHRzOwoJfTsKfQoKLyoqCiAqIEZvciBmZWF0dXJlIGRldGVjdGlvbgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbiBUaGUgZnVuY3Rpb24gdG8gdGVzdCBmb3IgbmF0aXZlIHN1cHBvcnQKICovCmZ1bmN0aW9uIGlzTmF0aXZlKCBmbiApIHsKCXJldHVybiBybmF0aXZlLnRlc3QoIGZuICsgIiIgKTsKfQoKLyoqCiAqIENyZWF0ZSBrZXktdmFsdWUgY2FjaGVzIG9mIGxpbWl0ZWQgc2l6ZQogKiBAcmV0dXJucyB7RnVuY3Rpb24oc3RyaW5nLCBPYmplY3QpfSBSZXR1cm5zIHRoZSBPYmplY3QgZGF0YSBhZnRlciBzdG9yaW5nIGl0IG9uIGl0c2VsZiB3aXRoCiAqCXByb3BlcnR5IG5hbWUgdGhlIChzcGFjZS1zdWZmaXhlZCkgc3RyaW5nIGFuZCAoaWYgdGhlIGNhY2hlIGlzIGxhcmdlciB0aGFuIEV4cHIuY2FjaGVMZW5ndGgpCiAqCWRlbGV0aW5nIHRoZSBvbGRlc3QgZW50cnkKICovCmZ1bmN0aW9uIGNyZWF0ZUNhY2hlKCkgewoJdmFyIGNhY2hlLAoJCWtleXMgPSBbXTsKCglyZXR1cm4gKGNhY2hlID0gZnVuY3Rpb24oIGtleSwgdmFsdWUgKSB7CgkJLy8gVXNlIChrZXkgKyAiICIpIHRvIGF2b2lkIGNvbGxpc2lvbiB3aXRoIG5hdGl2ZSBwcm90b3R5cGUgcHJvcGVydGllcyAoc2VlIElzc3VlICMxNTcpCgkJaWYgKCBrZXlzLnB1c2goIGtleSArPSAiICIgKSA+IEV4cHIuY2FjaGVMZW5ndGggKSB7CgkJCS8vIE9ubHkga2VlcCB0aGUgbW9zdCByZWNlbnQgZW50cmllcwoJCQlkZWxldGUgY2FjaGVbIGtleXMuc2hpZnQoKSBdOwoJCX0KCQlyZXR1cm4gKGNhY2hlWyBrZXkgXSA9IHZhbHVlKTsKCX0pOwp9CgovKioKICogTWFyayBhIGZ1bmN0aW9uIGZvciBzcGVjaWFsIHVzZSBieSBTaXp6bGUKICogQHBhcmFtIHtGdW5jdGlvbn0gZm4gVGhlIGZ1bmN0aW9uIHRvIG1hcmsKICovCmZ1bmN0aW9uIG1hcmtGdW5jdGlvbiggZm4gKSB7CglmblsgZXhwYW5kbyBdID0gdHJ1ZTsKCXJldHVybiBmbjsKfQoKLyoqCiAqIFN1cHBvcnQgdGVzdGluZyB1c2luZyBhbiBlbGVtZW50CiAqIEBwYXJhbSB7RnVuY3Rpb259IGZuIFBhc3NlZCB0aGUgY3JlYXRlZCBkaXYgYW5kIGV4cGVjdHMgYSBib29sZWFuIHJlc3VsdAogKi8KZnVuY3Rpb24gYXNzZXJ0KCBmbiApIHsKCXZhciBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKCgl0cnkgewoJCXJldHVybiBmbiggZGl2ICk7Cgl9IGNhdGNoIChlKSB7CgkJcmV0dXJuIGZhbHNlOwoJfSBmaW5hbGx5IHsKCQkvLyByZWxlYXNlIG1lbW9yeSBpbiBJRQoJCWRpdiA9IG51bGw7Cgl9Cn0KCmZ1bmN0aW9uIFNpenpsZSggc2VsZWN0b3IsIGNvbnRleHQsIHJlc3VsdHMsIHNlZWQgKSB7Cgl2YXIgbWF0Y2gsIGVsZW0sIG0sIG5vZGVUeXBlLAoJCS8vIFFTQSB2YXJzCgkJaSwgZ3JvdXBzLCBvbGQsIG5pZCwgbmV3Q29udGV4dCwgbmV3U2VsZWN0b3I7CgoJaWYgKCAoIGNvbnRleHQgPyBjb250ZXh0Lm93bmVyRG9jdW1lbnQgfHwgY29udGV4dCA6IHByZWZlcnJlZERvYyApICE9PSBkb2N1bWVudCApIHsKCQlzZXREb2N1bWVudCggY29udGV4dCApOwoJfQoKCWNvbnRleHQgPSBjb250ZXh0IHx8IGRvY3VtZW50OwoJcmVzdWx0cyA9IHJlc3VsdHMgfHwgW107CgoJaWYgKCAhc2VsZWN0b3IgfHwgdHlwZW9mIHNlbGVjdG9yICE9PSAic3RyaW5nIiApIHsKCQlyZXR1cm4gcmVzdWx0czsKCX0KCglpZiAoIChub2RlVHlwZSA9IGNvbnRleHQubm9kZVR5cGUpICE9PSAxICYmIG5vZGVUeXBlICE9PSA5ICkgewoJCXJldHVybiBbXTsKCX0KCglpZiAoICFkb2N1bWVudElzWE1MICYmICFzZWVkICkgewoKCQkvLyBTaG9ydGN1dHMKCQlpZiAoIChtYXRjaCA9IHJxdWlja0V4cHIuZXhlYyggc2VsZWN0b3IgKSkgKSB7CgkJCS8vIFNwZWVkLXVwOiBTaXp6bGUoIiNJRCIpCgkJCWlmICggKG0gPSBtYXRjaFsxXSkgKSB7CgkJCQlpZiAoIG5vZGVUeXBlID09PSA5ICkgewoJCQkJCWVsZW0gPSBjb250ZXh0LmdldEVsZW1lbnRCeUlkKCBtICk7CgkJCQkJLy8gQ2hlY2sgcGFyZW50Tm9kZSB0byBjYXRjaCB3aGVuIEJsYWNrYmVycnkgNC42IHJldHVybnMKCQkJCQkvLyBub2RlcyB0aGF0IGFyZSBubyBsb25nZXIgaW4gdGhlIGRvY3VtZW50ICM2OTYzCgkJCQkJaWYgKCBlbGVtICYmIGVsZW0ucGFyZW50Tm9kZSApIHsKCQkJCQkJLy8gSGFuZGxlIHRoZSBjYXNlIHdoZXJlIElFLCBPcGVyYSwgYW5kIFdlYmtpdCByZXR1cm4gaXRlbXMKCQkJCQkJLy8gYnkgbmFtZSBpbnN0ZWFkIG9mIElECgkJCQkJCWlmICggZWxlbS5pZCA9PT0gbSApIHsKCQkJCQkJCXJlc3VsdHMucHVzaCggZWxlbSApOwoJCQkJCQkJcmV0dXJuIHJlc3VsdHM7CgkJCQkJCX0KCQkJCQl9IGVsc2UgewoJCQkJCQlyZXR1cm4gcmVzdWx0czsKCQkJCQl9CgkJCQl9IGVsc2UgewoJCQkJCS8vIENvbnRleHQgaXMgbm90IGEgZG9jdW1lbnQKCQkJCQlpZiAoIGNvbnRleHQub3duZXJEb2N1bWVudCAmJiAoZWxlbSA9IGNvbnRleHQub3duZXJEb2N1bWVudC5nZXRFbGVtZW50QnlJZCggbSApKSAmJgoJCQkJCQljb250YWlucyggY29udGV4dCwgZWxlbSApICYmIGVsZW0uaWQgPT09IG0gKSB7CgkJCQkJCXJlc3VsdHMucHVzaCggZWxlbSApOwoJCQkJCQlyZXR1cm4gcmVzdWx0czsKCQkJCQl9CgkJCQl9CgoJCQkvLyBTcGVlZC11cDogU2l6emxlKCJUQUciKQoJCQl9IGVsc2UgaWYgKCBtYXRjaFsyXSApIHsKCQkJCXB1c2guYXBwbHkoIHJlc3VsdHMsIHNsaWNlLmNhbGwoY29udGV4dC5nZXRFbGVtZW50c0J5VGFnTmFtZSggc2VsZWN0b3IgKSwgMCkgKTsKCQkJCXJldHVybiByZXN1bHRzOwoKCQkJLy8gU3BlZWQtdXA6IFNpenpsZSgiLkNMQVNTIikKCQkJfSBlbHNlIGlmICggKG0gPSBtYXRjaFszXSkgJiYgc3VwcG9ydC5nZXRCeUNsYXNzTmFtZSAmJiBjb250ZXh0LmdldEVsZW1lbnRzQnlDbGFzc05hbWUgKSB7CgkJCQlwdXNoLmFwcGx5KCByZXN1bHRzLCBzbGljZS5jYWxsKGNvbnRleHQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSggbSApLCAwKSApOwoJCQkJcmV0dXJuIHJlc3VsdHM7CgkJCX0KCQl9CgoJCS8vIFFTQSBwYXRoCgkJaWYgKCBzdXBwb3J0LnFzYSAmJiAhcmJ1Z2d5UVNBLnRlc3Qoc2VsZWN0b3IpICkgewoJCQlvbGQgPSB0cnVlOwoJCQluaWQgPSBleHBhbmRvOwoJCQluZXdDb250ZXh0ID0gY29udGV4dDsKCQkJbmV3U2VsZWN0b3IgPSBub2RlVHlwZSA9PT0gOSAmJiBzZWxlY3RvcjsKCgkJCS8vIHFTQSB3b3JrcyBzdHJhbmdlbHkgb24gRWxlbWVudC1yb290ZWQgcXVlcmllcwoJCQkvLyBXZSBjYW4gd29yayBhcm91bmQgdGhpcyBieSBzcGVjaWZ5aW5nIGFuIGV4dHJhIElEIG9uIHRoZSByb290CgkJCS8vIGFuZCB3b3JraW5nIHVwIGZyb20gdGhlcmUgKFRoYW5rcyB0byBBbmRyZXcgRHVwb250IGZvciB0aGUgdGVjaG5pcXVlKQoJCQkvLyBJRSA4IGRvZXNuJ3Qgd29yayBvbiBvYmplY3QgZWxlbWVudHMKCQkJaWYgKCBub2RlVHlwZSA9PT0gMSAmJiBjb250ZXh0Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgIT09ICJvYmplY3QiICkgewoJCQkJZ3JvdXBzID0gdG9rZW5pemUoIHNlbGVjdG9yICk7CgoJCQkJaWYgKCAob2xkID0gY29udGV4dC5nZXRBdHRyaWJ1dGUoImlkIikpICkgewoJCQkJCW5pZCA9IG9sZC5yZXBsYWNlKCByZXNjYXBlLCAiXFwkJiIgKTsKCQkJCX0gZWxzZSB7CgkJCQkJY29udGV4dC5zZXRBdHRyaWJ1dGUoICJpZCIsIG5pZCApOwoJCQkJfQoJCQkJbmlkID0gIltpZD0nIiArIG5pZCArICInXSAiOwoKCQkJCWkgPSBncm91cHMubGVuZ3RoOwoJCQkJd2hpbGUgKCBpLS0gKSB7CgkJCQkJZ3JvdXBzW2ldID0gbmlkICsgdG9TZWxlY3RvciggZ3JvdXBzW2ldICk7CgkJCQl9CgkJCQluZXdDb250ZXh0ID0gcnNpYmxpbmcudGVzdCggc2VsZWN0b3IgKSAmJiBjb250ZXh0LnBhcmVudE5vZGUgfHwgY29udGV4dDsKCQkJCW5ld1NlbGVjdG9yID0gZ3JvdXBzLmpvaW4oIiwiKTsKCQkJfQoKCQkJaWYgKCBuZXdTZWxlY3RvciApIHsKCQkJCXRyeSB7CgkJCQkJcHVzaC5hcHBseSggcmVzdWx0cywgc2xpY2UuY2FsbCggbmV3Q29udGV4dC5xdWVyeVNlbGVjdG9yQWxsKAoJCQkJCQluZXdTZWxlY3RvcgoJCQkJCSksIDAgKSApOwoJCQkJCXJldHVybiByZXN1bHRzOwoJCQkJfSBjYXRjaChxc2FFcnJvcikgewoJCQkJfSBmaW5hbGx5IHsKCQkJCQlpZiAoICFvbGQgKSB7CgkJCQkJCWNvbnRleHQucmVtb3ZlQXR0cmlidXRlKCJpZCIpOwoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCX0KCgkvLyBBbGwgb3RoZXJzCglyZXR1cm4gc2VsZWN0KCBzZWxlY3Rvci5yZXBsYWNlKCBydHJpbSwgIiQxIiApLCBjb250ZXh0LCByZXN1bHRzLCBzZWVkICk7Cn0KCi8qKgogKiBEZXRlY3QgeG1sCiAqIEBwYXJhbSB7RWxlbWVudHxPYmplY3R9IGVsZW0gQW4gZWxlbWVudCBvciBhIGRvY3VtZW50CiAqLwppc1hNTCA9IFNpenpsZS5pc1hNTCA9IGZ1bmN0aW9uKCBlbGVtICkgewoJLy8gZG9jdW1lbnRFbGVtZW50IGlzIHZlcmlmaWVkIGZvciBjYXNlcyB3aGVyZSBpdCBkb2Vzbid0IHlldCBleGlzdAoJLy8gKHN1Y2ggYXMgbG9hZGluZyBpZnJhbWVzIGluIElFIC0gIzQ4MzMpCgl2YXIgZG9jdW1lbnRFbGVtZW50ID0gZWxlbSAmJiAoZWxlbS5vd25lckRvY3VtZW50IHx8IGVsZW0pLmRvY3VtZW50RWxlbWVudDsKCXJldHVybiBkb2N1bWVudEVsZW1lbnQgPyBkb2N1bWVudEVsZW1lbnQubm9kZU5hbWUgIT09ICJIVE1MIiA6IGZhbHNlOwp9OwoKLyoqCiAqIFNldHMgZG9jdW1lbnQtcmVsYXRlZCB2YXJpYWJsZXMgb25jZSBiYXNlZCBvbiB0aGUgY3VycmVudCBkb2N1bWVudAogKiBAcGFyYW0ge0VsZW1lbnR8T2JqZWN0fSBbZG9jXSBBbiBlbGVtZW50IG9yIGRvY3VtZW50IG9iamVjdCB0byB1c2UgdG8gc2V0IHRoZSBkb2N1bWVudAogKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBjdXJyZW50IGRvY3VtZW50CiAqLwpzZXREb2N1bWVudCA9IFNpenpsZS5zZXREb2N1bWVudCA9IGZ1bmN0aW9uKCBub2RlICkgewoJdmFyIGRvYyA9IG5vZGUgPyBub2RlLm93bmVyRG9jdW1lbnQgfHwgbm9kZSA6IHByZWZlcnJlZERvYzsKCgkvLyBJZiBubyBkb2N1bWVudCBhbmQgZG9jdW1lbnRFbGVtZW50IGlzIGF2YWlsYWJsZSwgcmV0dXJuCglpZiAoIGRvYyA9PT0gZG9jdW1lbnQgfHwgZG9jLm5vZGVUeXBlICE9PSA5IHx8ICFkb2MuZG9jdW1lbnRFbGVtZW50ICkgewoJCXJldHVybiBkb2N1bWVudDsKCX0KCgkvLyBTZXQgb3VyIGRvY3VtZW50Cglkb2N1bWVudCA9IGRvYzsKCWRvY0VsZW0gPSBkb2MuZG9jdW1lbnRFbGVtZW50OwoKCS8vIFN1cHBvcnQgdGVzdHMKCWRvY3VtZW50SXNYTUwgPSBpc1hNTCggZG9jICk7CgoJLy8gQ2hlY2sgaWYgZ2V0RWxlbWVudHNCeVRhZ05hbWUoIioiKSByZXR1cm5zIG9ubHkgZWxlbWVudHMKCXN1cHBvcnQudGFnTmFtZU5vQ29tbWVudHMgPSBhc3NlcnQoZnVuY3Rpb24oIGRpdiApIHsKCQlkaXYuYXBwZW5kQ2hpbGQoIGRvYy5jcmVhdGVDb21tZW50KCIiKSApOwoJCXJldHVybiAhZGl2LmdldEVsZW1lbnRzQnlUYWdOYW1lKCIqIikubGVuZ3RoOwoJfSk7CgoJLy8gQ2hlY2sgaWYgYXR0cmlidXRlcyBzaG91bGQgYmUgcmV0cmlldmVkIGJ5IGF0dHJpYnV0ZSBub2RlcwoJc3VwcG9ydC5hdHRyaWJ1dGVzID0gYXNzZXJ0KGZ1bmN0aW9uKCBkaXYgKSB7CgkJZGl2LmlubmVySFRNTCA9ICI8c2VsZWN0Pjwvc2VsZWN0PiI7CgkJdmFyIHR5cGUgPSB0eXBlb2YgZGl2Lmxhc3RDaGlsZC5nZXRBdHRyaWJ1dGUoIm11bHRpcGxlIik7CgkJLy8gSUU4IHJldHVybnMgYSBzdHJpbmcgZm9yIHNvbWUgYXR0cmlidXRlcyBldmVuIHdoZW4gbm90IHByZXNlbnQKCQlyZXR1cm4gdHlwZSAhPT0gImJvb2xlYW4iICYmIHR5cGUgIT09ICJzdHJpbmciOwoJfSk7CgoJLy8gQ2hlY2sgaWYgZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSBjYW4gYmUgdHJ1c3RlZAoJc3VwcG9ydC5nZXRCeUNsYXNzTmFtZSA9IGFzc2VydChmdW5jdGlvbiggZGl2ICkgewoJCS8vIE9wZXJhIGNhbid0IGZpbmQgYSBzZWNvbmQgY2xhc3NuYW1lIChpbiA5LjYpCgkJZGl2LmlubmVySFRNTCA9ICI8ZGl2IGNsYXNzPSdoaWRkZW4gZSc+PC9kaXY+PGRpdiBjbGFzcz0naGlkZGVuJz48L2Rpdj4iOwoJCWlmICggIWRpdi5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lIHx8ICFkaXYuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgiZSIpLmxlbmd0aCApIHsKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCgkJLy8gU2FmYXJpIDMuMiBjYWNoZXMgY2xhc3MgYXR0cmlidXRlcyBhbmQgZG9lc24ndCBjYXRjaCBjaGFuZ2VzCgkJZGl2Lmxhc3RDaGlsZC5jbGFzc05hbWUgPSAiZSI7CgkJcmV0dXJuIGRpdi5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCJlIikubGVuZ3RoID09PSAyOwoJfSk7CgoJLy8gQ2hlY2sgaWYgZ2V0RWxlbWVudEJ5SWQgcmV0dXJucyBlbGVtZW50cyBieSBuYW1lCgkvLyBDaGVjayBpZiBnZXRFbGVtZW50c0J5TmFtZSBwcml2aWxlZ2VzIGZvcm0gY29udHJvbHMgb3IgcmV0dXJucyBlbGVtZW50cyBieSBJRAoJc3VwcG9ydC5nZXRCeU5hbWUgPSBhc3NlcnQoZnVuY3Rpb24oIGRpdiApIHsKCQkvLyBJbmplY3QgY29udGVudAoJCWRpdi5pZCA9IGV4cGFuZG8gKyAwOwoJCWRpdi5pbm5lckhUTUwgPSAiPGEgbmFtZT0nIiArIGV4cGFuZG8gKyAiJz48L2E+PGRpdiBuYW1lPSciICsgZXhwYW5kbyArICInPjwvZGl2PiI7CgkJZG9jRWxlbS5pbnNlcnRCZWZvcmUoIGRpdiwgZG9jRWxlbS5maXJzdENoaWxkICk7CgoJCS8vIFRlc3QKCQl2YXIgcGFzcyA9IGRvYy5nZXRFbGVtZW50c0J5TmFtZSAmJgoJCQkvLyBidWdneSBicm93c2VycyB3aWxsIHJldHVybiBmZXdlciB0aGFuIHRoZSBjb3JyZWN0IDIKCQkJZG9jLmdldEVsZW1lbnRzQnlOYW1lKCBleHBhbmRvICkubGVuZ3RoID09PSAyICsKCQkJLy8gYnVnZ3kgYnJvd3NlcnMgd2lsbCByZXR1cm4gbW9yZSB0aGFuIHRoZSBjb3JyZWN0IDAKCQkJZG9jLmdldEVsZW1lbnRzQnlOYW1lKCBleHBhbmRvICsgMCApLmxlbmd0aDsKCQlzdXBwb3J0LmdldElkTm90TmFtZSA9ICFkb2MuZ2V0RWxlbWVudEJ5SWQoIGV4cGFuZG8gKTsKCgkJLy8gQ2xlYW51cAoJCWRvY0VsZW0ucmVtb3ZlQ2hpbGQoIGRpdiApOwoKCQlyZXR1cm4gcGFzczsKCX0pOwoKCS8vIElFNi83IHJldHVybiBtb2RpZmllZCBhdHRyaWJ1dGVzCglFeHByLmF0dHJIYW5kbGUgPSBhc3NlcnQoZnVuY3Rpb24oIGRpdiApIHsKCQlkaXYuaW5uZXJIVE1MID0gIjxhIGhyZWY9JyMnPjwvYT4iOwoJCXJldHVybiBkaXYuZmlyc3RDaGlsZCAmJiB0eXBlb2YgZGl2LmZpcnN0Q2hpbGQuZ2V0QXR0cmlidXRlICE9PSBzdHJ1bmRlZmluZWQgJiYKCQkJZGl2LmZpcnN0Q2hpbGQuZ2V0QXR0cmlidXRlKCJocmVmIikgPT09ICIjIjsKCX0pID8KCQl7fSA6CgkJewoJCQkiaHJlZiI6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJcmV0dXJuIGVsZW0uZ2V0QXR0cmlidXRlKCAiaHJlZiIsIDIgKTsKCQkJfSwKCQkJInR5cGUiOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJCXJldHVybiBlbGVtLmdldEF0dHJpYnV0ZSgidHlwZSIpOwoJCQl9CgkJfTsKCgkvLyBJRCBmaW5kIGFuZCBmaWx0ZXIKCWlmICggc3VwcG9ydC5nZXRJZE5vdE5hbWUgKSB7CgkJRXhwci5maW5kWyJJRCJdID0gZnVuY3Rpb24oIGlkLCBjb250ZXh0ICkgewoJCQlpZiAoIHR5cGVvZiBjb250ZXh0LmdldEVsZW1lbnRCeUlkICE9PSBzdHJ1bmRlZmluZWQgJiYgIWRvY3VtZW50SXNYTUwgKSB7CgkJCQl2YXIgbSA9IGNvbnRleHQuZ2V0RWxlbWVudEJ5SWQoIGlkICk7CgkJCQkvLyBDaGVjayBwYXJlbnROb2RlIHRvIGNhdGNoIHdoZW4gQmxhY2tiZXJyeSA0LjYgcmV0dXJucwoJCQkJLy8gbm9kZXMgdGhhdCBhcmUgbm8gbG9uZ2VyIGluIHRoZSBkb2N1bWVudCAjNjk2MwoJCQkJcmV0dXJuIG0gJiYgbS5wYXJlbnROb2RlID8gW21dIDogW107CgkJCX0KCQl9OwoJCUV4cHIuZmlsdGVyWyJJRCJdID0gZnVuY3Rpb24oIGlkICkgewoJCQl2YXIgYXR0cklkID0gaWQucmVwbGFjZSggcnVuZXNjYXBlLCBmdW5lc2NhcGUgKTsKCQkJcmV0dXJuIGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJcmV0dXJuIGVsZW0uZ2V0QXR0cmlidXRlKCJpZCIpID09PSBhdHRySWQ7CgkJCX07CgkJfTsKCX0gZWxzZSB7CgkJRXhwci5maW5kWyJJRCJdID0gZnVuY3Rpb24oIGlkLCBjb250ZXh0ICkgewoJCQlpZiAoIHR5cGVvZiBjb250ZXh0LmdldEVsZW1lbnRCeUlkICE9PSBzdHJ1bmRlZmluZWQgJiYgIWRvY3VtZW50SXNYTUwgKSB7CgkJCQl2YXIgbSA9IGNvbnRleHQuZ2V0RWxlbWVudEJ5SWQoIGlkICk7CgoJCQkJcmV0dXJuIG0gPwoJCQkJCW0uaWQgPT09IGlkIHx8IHR5cGVvZiBtLmdldEF0dHJpYnV0ZU5vZGUgIT09IHN0cnVuZGVmaW5lZCAmJiBtLmdldEF0dHJpYnV0ZU5vZGUoImlkIikudmFsdWUgPT09IGlkID8KCQkJCQkJW21dIDoKCQkJCQkJdW5kZWZpbmVkIDoKCQkJCQlbXTsKCQkJfQoJCX07CgkJRXhwci5maWx0ZXJbIklEIl0gPSAgZnVuY3Rpb24oIGlkICkgewoJCQl2YXIgYXR0cklkID0gaWQucmVwbGFjZSggcnVuZXNjYXBlLCBmdW5lc2NhcGUgKTsKCQkJcmV0dXJuIGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJdmFyIG5vZGUgPSB0eXBlb2YgZWxlbS5nZXRBdHRyaWJ1dGVOb2RlICE9PSBzdHJ1bmRlZmluZWQgJiYgZWxlbS5nZXRBdHRyaWJ1dGVOb2RlKCJpZCIpOwoJCQkJcmV0dXJuIG5vZGUgJiYgbm9kZS52YWx1ZSA9PT0gYXR0cklkOwoJCQl9OwoJCX07Cgl9CgoJLy8gVGFnCglFeHByLmZpbmRbIlRBRyJdID0gc3VwcG9ydC50YWdOYW1lTm9Db21tZW50cyA/CgkJZnVuY3Rpb24oIHRhZywgY29udGV4dCApIHsKCQkJaWYgKCB0eXBlb2YgY29udGV4dC5nZXRFbGVtZW50c0J5VGFnTmFtZSAhPT0gc3RydW5kZWZpbmVkICkgewoJCQkJcmV0dXJuIGNvbnRleHQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoIHRhZyApOwoJCQl9CgkJfSA6CgkJZnVuY3Rpb24oIHRhZywgY29udGV4dCApIHsKCQkJdmFyIGVsZW0sCgkJCQl0bXAgPSBbXSwKCQkJCWkgPSAwLAoJCQkJcmVzdWx0cyA9IGNvbnRleHQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoIHRhZyApOwoKCQkJLy8gRmlsdGVyIG91dCBwb3NzaWJsZSBjb21tZW50cwoJCQlpZiAoIHRhZyA9PT0gIioiICkgewoJCQkJd2hpbGUgKCAoZWxlbSA9IHJlc3VsdHNbaSsrXSkgKSB7CgkJCQkJaWYgKCBlbGVtLm5vZGVUeXBlID09PSAxICkgewoJCQkJCQl0bXAucHVzaCggZWxlbSApOwoJCQkJCX0KCQkJCX0KCgkJCQlyZXR1cm4gdG1wOwoJCQl9CgkJCXJldHVybiByZXN1bHRzOwoJCX07CgoJLy8gTmFtZQoJRXhwci5maW5kWyJOQU1FIl0gPSBzdXBwb3J0LmdldEJ5TmFtZSAmJiBmdW5jdGlvbiggdGFnLCBjb250ZXh0ICkgewoJCWlmICggdHlwZW9mIGNvbnRleHQuZ2V0RWxlbWVudHNCeU5hbWUgIT09IHN0cnVuZGVmaW5lZCApIHsKCQkJcmV0dXJuIGNvbnRleHQuZ2V0RWxlbWVudHNCeU5hbWUoIG5hbWUgKTsKCQl9Cgl9OwoKCS8vIENsYXNzCglFeHByLmZpbmRbIkNMQVNTIl0gPSBzdXBwb3J0LmdldEJ5Q2xhc3NOYW1lICYmIGZ1bmN0aW9uKCBjbGFzc05hbWUsIGNvbnRleHQgKSB7CgkJaWYgKCB0eXBlb2YgY29udGV4dC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lICE9PSBzdHJ1bmRlZmluZWQgJiYgIWRvY3VtZW50SXNYTUwgKSB7CgkJCXJldHVybiBjb250ZXh0LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoIGNsYXNzTmFtZSApOwoJCX0KCX07CgoJLy8gUVNBIGFuZCBtYXRjaGVzU2VsZWN0b3Igc3VwcG9ydAoKCS8vIG1hdGNoZXNTZWxlY3Rvcig6YWN0aXZlKSByZXBvcnRzIGZhbHNlIHdoZW4gdHJ1ZSAoSUU5L09wZXJhIDExLjUpCglyYnVnZ3lNYXRjaGVzID0gW107CgoJLy8gcVNhKDpmb2N1cykgcmVwb3J0cyBmYWxzZSB3aGVuIHRydWUgKENocm9tZSAyMSksCgkvLyBubyBuZWVkIHRvIGFsc28gYWRkIHRvIGJ1Z2d5TWF0Y2hlcyBzaW5jZSBtYXRjaGVzIGNoZWNrcyBidWdneVFTQQoJLy8gQSBzdXBwb3J0IHRlc3Qgd291bGQgcmVxdWlyZSB0b28gbXVjaCBjb2RlICh3b3VsZCBpbmNsdWRlIGRvY3VtZW50IHJlYWR5KQoJcmJ1Z2d5UVNBID0gWyAiOmZvY3VzIiBdOwoKCWlmICggKHN1cHBvcnQucXNhID0gaXNOYXRpdmUoZG9jLnF1ZXJ5U2VsZWN0b3JBbGwpKSApIHsKCQkvLyBCdWlsZCBRU0EgcmVnZXgKCQkvLyBSZWdleCBzdHJhdGVneSBhZG9wdGVkIGZyb20gRGllZ28gUGVyaW5pCgkJYXNzZXJ0KGZ1bmN0aW9uKCBkaXYgKSB7CgkJCS8vIFNlbGVjdCBpcyBzZXQgdG8gZW1wdHkgc3RyaW5nIG9uIHB1cnBvc2UKCQkJLy8gVGhpcyBpcyB0byB0ZXN0IElFJ3MgdHJlYXRtZW50IG9mIG5vdCBleHBsaWN0bHkKCQkJLy8gc2V0dGluZyBhIGJvb2xlYW4gY29udGVudCBhdHRyaWJ1dGUsCgkJCS8vIHNpbmNlIGl0cyBwcmVzZW5jZSBzaG91bGQgYmUgZW5vdWdoCgkJCS8vIGh0dHA6Ly9idWdzLmpxdWVyeS5jb20vdGlja2V0LzEyMzU5CgkJCWRpdi5pbm5lckhUTUwgPSAiPHNlbGVjdD48b3B0aW9uIHNlbGVjdGVkPScnPjwvb3B0aW9uPjwvc2VsZWN0PiI7CgoJCQkvLyBJRTggLSBTb21lIGJvb2xlYW4gYXR0cmlidXRlcyBhcmUgbm90IHRyZWF0ZWQgY29ycmVjdGx5CgkJCWlmICggIWRpdi5xdWVyeVNlbGVjdG9yQWxsKCJbc2VsZWN0ZWRdIikubGVuZ3RoICkgewoJCQkJcmJ1Z2d5UVNBLnB1c2goICJcXFsiICsgd2hpdGVzcGFjZSArICIqKD86Y2hlY2tlZHxkaXNhYmxlZHxpc21hcHxtdWx0aXBsZXxyZWFkb25seXxzZWxlY3RlZHx2YWx1ZSkiICk7CgkJCX0KCgkJCS8vIFdlYmtpdC9PcGVyYSAtIDpjaGVja2VkIHNob3VsZCByZXR1cm4gc2VsZWN0ZWQgb3B0aW9uIGVsZW1lbnRzCgkJCS8vIGh0dHA6Ly93d3cudzMub3JnL1RSLzIwMTEvUkVDLWNzczMtc2VsZWN0b3JzLTIwMTEwOTI5LyNjaGVja2VkCgkJCS8vIElFOCB0aHJvd3MgZXJyb3IgaGVyZSBhbmQgd2lsbCBub3Qgc2VlIGxhdGVyIHRlc3RzCgkJCWlmICggIWRpdi5xdWVyeVNlbGVjdG9yQWxsKCI6Y2hlY2tlZCIpLmxlbmd0aCApIHsKCQkJCXJidWdneVFTQS5wdXNoKCI6Y2hlY2tlZCIpOwoJCQl9CgkJfSk7CgoJCWFzc2VydChmdW5jdGlvbiggZGl2ICkgewoKCQkJLy8gT3BlcmEgMTAtMTIvSUU4IC0gXj0gJD0gKj0gYW5kIGVtcHR5IHZhbHVlcwoJCQkvLyBTaG91bGQgbm90IHNlbGVjdCBhbnl0aGluZwoJCQlkaXYuaW5uZXJIVE1MID0gIjxpbnB1dCB0eXBlPSdoaWRkZW4nIGk9JycvPiI7CgkJCWlmICggZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoIltpXj0nJ10iKS5sZW5ndGggKSB7CgkJCQlyYnVnZ3lRU0EucHVzaCggIlsqXiRdPSIgKyB3aGl0ZXNwYWNlICsgIiooPzpcIlwifCcnKSIgKTsKCQkJfQoKCQkJLy8gRkYgMy41IC0gOmVuYWJsZWQvOmRpc2FibGVkIGFuZCBoaWRkZW4gZWxlbWVudHMgKGhpZGRlbiBlbGVtZW50cyBhcmUgc3RpbGwgZW5hYmxlZCkKCQkJLy8gSUU4IHRocm93cyBlcnJvciBoZXJlIGFuZCB3aWxsIG5vdCBzZWUgbGF0ZXIgdGVzdHMKCQkJaWYgKCAhZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoIjplbmFibGVkIikubGVuZ3RoICkgewoJCQkJcmJ1Z2d5UVNBLnB1c2goICI6ZW5hYmxlZCIsICI6ZGlzYWJsZWQiICk7CgkJCX0KCgkJCS8vIE9wZXJhIDEwLTExIGRvZXMgbm90IHRocm93IG9uIHBvc3QtY29tbWEgaW52YWxpZCBwc2V1ZG9zCgkJCWRpdi5xdWVyeVNlbGVjdG9yQWxsKCIqLDp4Iik7CgkJCXJidWdneVFTQS5wdXNoKCIsLio6Iik7CgkJfSk7Cgl9CgoJaWYgKCAoc3VwcG9ydC5tYXRjaGVzU2VsZWN0b3IgPSBpc05hdGl2ZSggKG1hdGNoZXMgPSBkb2NFbGVtLm1hdGNoZXNTZWxlY3RvciB8fAoJCWRvY0VsZW0ubW96TWF0Y2hlc1NlbGVjdG9yIHx8CgkJZG9jRWxlbS53ZWJraXRNYXRjaGVzU2VsZWN0b3IgfHwKCQlkb2NFbGVtLm9NYXRjaGVzU2VsZWN0b3IgfHwKCQlkb2NFbGVtLm1zTWF0Y2hlc1NlbGVjdG9yKSApKSApIHsKCgkJYXNzZXJ0KGZ1bmN0aW9uKCBkaXYgKSB7CgkJCS8vIENoZWNrIHRvIHNlZSBpZiBpdCdzIHBvc3NpYmxlIHRvIGRvIG1hdGNoZXNTZWxlY3RvcgoJCQkvLyBvbiBhIGRpc2Nvbm5lY3RlZCBub2RlIChJRSA5KQoJCQlzdXBwb3J0LmRpc2Nvbm5lY3RlZE1hdGNoID0gbWF0Y2hlcy5jYWxsKCBkaXYsICJkaXYiICk7CgoJCQkvLyBUaGlzIHNob3VsZCBmYWlsIHdpdGggYW4gZXhjZXB0aW9uCgkJCS8vIEdlY2tvIGRvZXMgbm90IGVycm9yLCByZXR1cm5zIGZhbHNlIGluc3RlYWQKCQkJbWF0Y2hlcy5jYWxsKCBkaXYsICJbcyE9JyddOngiICk7CgkJCXJidWdneU1hdGNoZXMucHVzaCggIiE9IiwgcHNldWRvcyApOwoJCX0pOwoJfQoKCXJidWdneVFTQSA9IG5ldyBSZWdFeHAoIHJidWdneVFTQS5qb2luKCJ8IikgKTsKCXJidWdneU1hdGNoZXMgPSBuZXcgUmVnRXhwKCByYnVnZ3lNYXRjaGVzLmpvaW4oInwiKSApOwoKCS8vIEVsZW1lbnQgY29udGFpbnMgYW5vdGhlcgoJLy8gUHVycG9zZWZ1bGx5IGRvZXMgbm90IGltcGxlbWVudCBpbmNsdXNpdmUgZGVzY2VuZGVudAoJLy8gQXMgaW4sIGFuIGVsZW1lbnQgZG9lcyBub3QgY29udGFpbiBpdHNlbGYKCWNvbnRhaW5zID0gaXNOYXRpdmUoZG9jRWxlbS5jb250YWlucykgfHwgZG9jRWxlbS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiA/CgkJZnVuY3Rpb24oIGEsIGIgKSB7CgkJCXZhciBhZG93biA9IGEubm9kZVR5cGUgPT09IDkgPyBhLmRvY3VtZW50RWxlbWVudCA6IGEsCgkJCQlidXAgPSBiICYmIGIucGFyZW50Tm9kZTsKCQkJcmV0dXJuIGEgPT09IGJ1cCB8fCAhISggYnVwICYmIGJ1cC5ub2RlVHlwZSA9PT0gMSAmJiAoCgkJCQlhZG93bi5jb250YWlucyA/CgkJCQkJYWRvd24uY29udGFpbnMoIGJ1cCApIDoKCQkJCQlhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uICYmIGEuY29tcGFyZURvY3VtZW50UG9zaXRpb24oIGJ1cCApICYgMTYKCQkJKSk7CgkJfSA6CgkJZnVuY3Rpb24oIGEsIGIgKSB7CgkJCWlmICggYiApIHsKCQkJCXdoaWxlICggKGIgPSBiLnBhcmVudE5vZGUpICkgewoJCQkJCWlmICggYiA9PT0gYSApIHsKCQkJCQkJcmV0dXJuIHRydWU7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCXJldHVybiBmYWxzZTsKCQl9OwoKCS8vIERvY3VtZW50IG9yZGVyIHNvcnRpbmcKCXNvcnRPcmRlciA9IGRvY0VsZW0uY29tcGFyZURvY3VtZW50UG9zaXRpb24gPwoJZnVuY3Rpb24oIGEsIGIgKSB7CgkJdmFyIGNvbXBhcmU7CgoJCWlmICggYSA9PT0gYiApIHsKCQkJaGFzRHVwbGljYXRlID0gdHJ1ZTsKCQkJcmV0dXJuIDA7CgkJfQoKCQlpZiAoIChjb21wYXJlID0gYi5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiAmJiBhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uICYmIGEuY29tcGFyZURvY3VtZW50UG9zaXRpb24oIGIgKSkgKSB7CgkJCWlmICggY29tcGFyZSAmIDEgfHwgYS5wYXJlbnROb2RlICYmIGEucGFyZW50Tm9kZS5ub2RlVHlwZSA9PT0gMTEgKSB7CgkJCQlpZiAoIGEgPT09IGRvYyB8fCBjb250YWlucyggcHJlZmVycmVkRG9jLCBhICkgKSB7CgkJCQkJcmV0dXJuIC0xOwoJCQkJfQoJCQkJaWYgKCBiID09PSBkb2MgfHwgY29udGFpbnMoIHByZWZlcnJlZERvYywgYiApICkgewoJCQkJCXJldHVybiAxOwoJCQkJfQoJCQkJcmV0dXJuIDA7CgkJCX0KCQkJcmV0dXJuIGNvbXBhcmUgJiA0ID8gLTEgOiAxOwoJCX0KCgkJcmV0dXJuIGEuY29tcGFyZURvY3VtZW50UG9zaXRpb24gPyAtMSA6IDE7Cgl9IDoKCWZ1bmN0aW9uKCBhLCBiICkgewoJCXZhciBjdXIsCgkJCWkgPSAwLAoJCQlhdXAgPSBhLnBhcmVudE5vZGUsCgkJCWJ1cCA9IGIucGFyZW50Tm9kZSwKCQkJYXAgPSBbIGEgXSwKCQkJYnAgPSBbIGIgXTsKCgkJLy8gRXhpdCBlYXJseSBpZiB0aGUgbm9kZXMgYXJlIGlkZW50aWNhbAoJCWlmICggYSA9PT0gYiApIHsKCQkJaGFzRHVwbGljYXRlID0gdHJ1ZTsKCQkJcmV0dXJuIDA7CgoJCS8vIFBhcmVudGxlc3Mgbm9kZXMgYXJlIGVpdGhlciBkb2N1bWVudHMgb3IgZGlzY29ubmVjdGVkCgkJfSBlbHNlIGlmICggIWF1cCB8fCAhYnVwICkgewoJCQlyZXR1cm4gYSA9PT0gZG9jID8gLTEgOgoJCQkJYiA9PT0gZG9jID8gMSA6CgkJCQlhdXAgPyAtMSA6CgkJCQlidXAgPyAxIDoKCQkJCTA7CgoJCS8vIElmIHRoZSBub2RlcyBhcmUgc2libGluZ3MsIHdlIGNhbiBkbyBhIHF1aWNrIGNoZWNrCgkJfSBlbHNlIGlmICggYXVwID09PSBidXAgKSB7CgkJCXJldHVybiBzaWJsaW5nQ2hlY2soIGEsIGIgKTsKCQl9CgoJCS8vIE90aGVyd2lzZSB3ZSBuZWVkIGZ1bGwgbGlzdHMgb2YgdGhlaXIgYW5jZXN0b3JzIGZvciBjb21wYXJpc29uCgkJY3VyID0gYTsKCQl3aGlsZSAoIChjdXIgPSBjdXIucGFyZW50Tm9kZSkgKSB7CgkJCWFwLnVuc2hpZnQoIGN1ciApOwoJCX0KCQljdXIgPSBiOwoJCXdoaWxlICggKGN1ciA9IGN1ci5wYXJlbnROb2RlKSApIHsKCQkJYnAudW5zaGlmdCggY3VyICk7CgkJfQoKCQkvLyBXYWxrIGRvd24gdGhlIHRyZWUgbG9va2luZyBmb3IgYSBkaXNjcmVwYW5jeQoJCXdoaWxlICggYXBbaV0gPT09IGJwW2ldICkgewoJCQlpKys7CgkJfQoKCQlyZXR1cm4gaSA/CgkJCS8vIERvIGEgc2libGluZyBjaGVjayBpZiB0aGUgbm9kZXMgaGF2ZSBhIGNvbW1vbiBhbmNlc3RvcgoJCQlzaWJsaW5nQ2hlY2soIGFwW2ldLCBicFtpXSApIDoKCgkJCS8vIE90aGVyd2lzZSBub2RlcyBpbiBvdXIgZG9jdW1lbnQgc29ydCBmaXJzdAoJCQlhcFtpXSA9PT0gcHJlZmVycmVkRG9jID8gLTEgOgoJCQlicFtpXSA9PT0gcHJlZmVycmVkRG9jID8gMSA6CgkJCTA7Cgl9OwoKCS8vIEFsd2F5cyBhc3N1bWUgdGhlIHByZXNlbmNlIG9mIGR1cGxpY2F0ZXMgaWYgc29ydCBkb2Vzbid0CgkvLyBwYXNzIHRoZW0gdG8gb3VyIGNvbXBhcmlzb24gZnVuY3Rpb24gKGFzIGluIEdvb2dsZSBDaHJvbWUpLgoJaGFzRHVwbGljYXRlID0gZmFsc2U7CglbMCwgMF0uc29ydCggc29ydE9yZGVyICk7CglzdXBwb3J0LmRldGVjdER1cGxpY2F0ZXMgPSBoYXNEdXBsaWNhdGU7CgoJcmV0dXJuIGRvY3VtZW50Owp9OwoKU2l6emxlLm1hdGNoZXMgPSBmdW5jdGlvbiggZXhwciwgZWxlbWVudHMgKSB7CglyZXR1cm4gU2l6emxlKCBleHByLCBudWxsLCBudWxsLCBlbGVtZW50cyApOwp9OwoKU2l6emxlLm1hdGNoZXNTZWxlY3RvciA9IGZ1bmN0aW9uKCBlbGVtLCBleHByICkgewoJLy8gU2V0IGRvY3VtZW50IHZhcnMgaWYgbmVlZGVkCglpZiAoICggZWxlbS5vd25lckRvY3VtZW50IHx8IGVsZW0gKSAhPT0gZG9jdW1lbnQgKSB7CgkJc2V0RG9jdW1lbnQoIGVsZW0gKTsKCX0KCgkvLyBNYWtlIHN1cmUgdGhhdCBhdHRyaWJ1dGUgc2VsZWN0b3JzIGFyZSBxdW90ZWQKCWV4cHIgPSBleHByLnJlcGxhY2UoIHJhdHRyaWJ1dGVRdW90ZXMsICI9JyQxJ10iICk7CgoJLy8gcmJ1Z2d5UVNBIGFsd2F5cyBjb250YWlucyA6Zm9jdXMsIHNvIG5vIG5lZWQgZm9yIGFuIGV4aXN0ZW5jZSBjaGVjawoJaWYgKCBzdXBwb3J0Lm1hdGNoZXNTZWxlY3RvciAmJiAhZG9jdW1lbnRJc1hNTCAmJiAoIXJidWdneU1hdGNoZXMgfHwgIXJidWdneU1hdGNoZXMudGVzdChleHByKSkgJiYgIXJidWdneVFTQS50ZXN0KGV4cHIpICkgewoJCXRyeSB7CgkJCXZhciByZXQgPSBtYXRjaGVzLmNhbGwoIGVsZW0sIGV4cHIgKTsKCgkJCS8vIElFIDkncyBtYXRjaGVzU2VsZWN0b3IgcmV0dXJucyBmYWxzZSBvbiBkaXNjb25uZWN0ZWQgbm9kZXMKCQkJaWYgKCByZXQgfHwgc3VwcG9ydC5kaXNjb25uZWN0ZWRNYXRjaCB8fAoJCQkJCS8vIEFzIHdlbGwsIGRpc2Nvbm5lY3RlZCBub2RlcyBhcmUgc2FpZCB0byBiZSBpbiBhIGRvY3VtZW50CgkJCQkJLy8gZnJhZ21lbnQgaW4gSUUgOQoJCQkJCWVsZW0uZG9jdW1lbnQgJiYgZWxlbS5kb2N1bWVudC5ub2RlVHlwZSAhPT0gMTEgKSB7CgkJCQlyZXR1cm4gcmV0OwoJCQl9CgkJfSBjYXRjaChlKSB7fQoJfQoKCXJldHVybiBTaXp6bGUoIGV4cHIsIGRvY3VtZW50LCBudWxsLCBbZWxlbV0gKS5sZW5ndGggPiAwOwp9OwoKU2l6emxlLmNvbnRhaW5zID0gZnVuY3Rpb24oIGNvbnRleHQsIGVsZW0gKSB7CgkvLyBTZXQgZG9jdW1lbnQgdmFycyBpZiBuZWVkZWQKCWlmICggKCBjb250ZXh0Lm93bmVyRG9jdW1lbnQgfHwgY29udGV4dCApICE9PSBkb2N1bWVudCApIHsKCQlzZXREb2N1bWVudCggY29udGV4dCApOwoJfQoJcmV0dXJuIGNvbnRhaW5zKCBjb250ZXh0LCBlbGVtICk7Cn07CgpTaXp6bGUuYXR0ciA9IGZ1bmN0aW9uKCBlbGVtLCBuYW1lICkgewoJdmFyIHZhbDsKCgkvLyBTZXQgZG9jdW1lbnQgdmFycyBpZiBuZWVkZWQKCWlmICggKCBlbGVtLm93bmVyRG9jdW1lbnQgfHwgZWxlbSApICE9PSBkb2N1bWVudCApIHsKCQlzZXREb2N1bWVudCggZWxlbSApOwoJfQoKCWlmICggIWRvY3VtZW50SXNYTUwgKSB7CgkJbmFtZSA9IG5hbWUudG9Mb3dlckNhc2UoKTsKCX0KCWlmICggKHZhbCA9IEV4cHIuYXR0ckhhbmRsZVsgbmFtZSBdKSApIHsKCQlyZXR1cm4gdmFsKCBlbGVtICk7Cgl9CglpZiAoIGRvY3VtZW50SXNYTUwgfHwgc3VwcG9ydC5hdHRyaWJ1dGVzICkgewoJCXJldHVybiBlbGVtLmdldEF0dHJpYnV0ZSggbmFtZSApOwoJfQoJcmV0dXJuICggKHZhbCA9IGVsZW0uZ2V0QXR0cmlidXRlTm9kZSggbmFtZSApKSB8fCBlbGVtLmdldEF0dHJpYnV0ZSggbmFtZSApICkgJiYgZWxlbVsgbmFtZSBdID09PSB0cnVlID8KCQluYW1lIDoKCQl2YWwgJiYgdmFsLnNwZWNpZmllZCA/IHZhbC52YWx1ZSA6IG51bGw7Cn07CgpTaXp6bGUuZXJyb3IgPSBmdW5jdGlvbiggbXNnICkgewoJdGhyb3cgbmV3IEVycm9yKCAiU3ludGF4IGVycm9yLCB1bnJlY29nbml6ZWQgZXhwcmVzc2lvbjogIiArIG1zZyApOwp9OwoKLy8gRG9jdW1lbnQgc29ydGluZyBhbmQgcmVtb3ZpbmcgZHVwbGljYXRlcwpTaXp6bGUudW5pcXVlU29ydCA9IGZ1bmN0aW9uKCByZXN1bHRzICkgewoJdmFyIGVsZW0sCgkJZHVwbGljYXRlcyA9IFtdLAoJCWkgPSAxLAoJCWogPSAwOwoKCS8vIFVubGVzcyB3ZSAqa25vdyogd2UgY2FuIGRldGVjdCBkdXBsaWNhdGVzLCBhc3N1bWUgdGhlaXIgcHJlc2VuY2UKCWhhc0R1cGxpY2F0ZSA9ICFzdXBwb3J0LmRldGVjdER1cGxpY2F0ZXM7CglyZXN1bHRzLnNvcnQoIHNvcnRPcmRlciApOwoKCWlmICggaGFzRHVwbGljYXRlICkgewoJCWZvciAoIDsgKGVsZW0gPSByZXN1bHRzW2ldKTsgaSsrICkgewoJCQlpZiAoIGVsZW0gPT09IHJlc3VsdHNbIGkgLSAxIF0gKSB7CgkJCQlqID0gZHVwbGljYXRlcy5wdXNoKCBpICk7CgkJCX0KCQl9CgkJd2hpbGUgKCBqLS0gKSB7CgkJCXJlc3VsdHMuc3BsaWNlKCBkdXBsaWNhdGVzWyBqIF0sIDEgKTsKCQl9Cgl9CgoJcmV0dXJuIHJlc3VsdHM7Cn07CgpmdW5jdGlvbiBzaWJsaW5nQ2hlY2soIGEsIGIgKSB7Cgl2YXIgY3VyID0gYiAmJiBhLAoJCWRpZmYgPSBjdXIgJiYgKCB+Yi5zb3VyY2VJbmRleCB8fCBNQVhfTkVHQVRJVkUgKSAtICggfmEuc291cmNlSW5kZXggfHwgTUFYX05FR0FUSVZFICk7CgoJLy8gVXNlIElFIHNvdXJjZUluZGV4IGlmIGF2YWlsYWJsZSBvbiBib3RoIG5vZGVzCglpZiAoIGRpZmYgKSB7CgkJcmV0dXJuIGRpZmY7Cgl9CgoJLy8gQ2hlY2sgaWYgYiBmb2xsb3dzIGEKCWlmICggY3VyICkgewoJCXdoaWxlICggKGN1ciA9IGN1ci5uZXh0U2libGluZykgKSB7CgkJCWlmICggY3VyID09PSBiICkgewoJCQkJcmV0dXJuIC0xOwoJCQl9CgkJfQoJfQoKCXJldHVybiBhID8gMSA6IC0xOwp9CgovLyBSZXR1cm5zIGEgZnVuY3Rpb24gdG8gdXNlIGluIHBzZXVkb3MgZm9yIGlucHV0IHR5cGVzCmZ1bmN0aW9uIGNyZWF0ZUlucHV0UHNldWRvKCB0eXBlICkgewoJcmV0dXJuIGZ1bmN0aW9uKCBlbGVtICkgewoJCXZhciBuYW1lID0gZWxlbS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpOwoJCXJldHVybiBuYW1lID09PSAiaW5wdXQiICYmIGVsZW0udHlwZSA9PT0gdHlwZTsKCX07Cn0KCi8vIFJldHVybnMgYSBmdW5jdGlvbiB0byB1c2UgaW4gcHNldWRvcyBmb3IgYnV0dG9ucwpmdW5jdGlvbiBjcmVhdGVCdXR0b25Qc2V1ZG8oIHR5cGUgKSB7CglyZXR1cm4gZnVuY3Rpb24oIGVsZW0gKSB7CgkJdmFyIG5hbWUgPSBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7CgkJcmV0dXJuIChuYW1lID09PSAiaW5wdXQiIHx8IG5hbWUgPT09ICJidXR0b24iKSAmJiBlbGVtLnR5cGUgPT09IHR5cGU7Cgl9Owp9CgovLyBSZXR1cm5zIGEgZnVuY3Rpb24gdG8gdXNlIGluIHBzZXVkb3MgZm9yIHBvc2l0aW9uYWxzCmZ1bmN0aW9uIGNyZWF0ZVBvc2l0aW9uYWxQc2V1ZG8oIGZuICkgewoJcmV0dXJuIG1hcmtGdW5jdGlvbihmdW5jdGlvbiggYXJndW1lbnQgKSB7CgkJYXJndW1lbnQgPSArYXJndW1lbnQ7CgkJcmV0dXJuIG1hcmtGdW5jdGlvbihmdW5jdGlvbiggc2VlZCwgbWF0Y2hlcyApIHsKCQkJdmFyIGosCgkJCQltYXRjaEluZGV4ZXMgPSBmbiggW10sIHNlZWQubGVuZ3RoLCBhcmd1bWVudCApLAoJCQkJaSA9IG1hdGNoSW5kZXhlcy5sZW5ndGg7CgoJCQkvLyBNYXRjaCBlbGVtZW50cyBmb3VuZCBhdCB0aGUgc3BlY2lmaWVkIGluZGV4ZXMKCQkJd2hpbGUgKCBpLS0gKSB7CgkJCQlpZiAoIHNlZWRbIChqID0gbWF0Y2hJbmRleGVzW2ldKSBdICkgewoJCQkJCXNlZWRbal0gPSAhKG1hdGNoZXNbal0gPSBzZWVkW2pdKTsKCQkJCX0KCQkJfQoJCX0pOwoJfSk7Cn0KCi8qKgogKiBVdGlsaXR5IGZ1bmN0aW9uIGZvciByZXRyaWV2aW5nIHRoZSB0ZXh0IHZhbHVlIG9mIGFuIGFycmF5IG9mIERPTSBub2RlcwogKiBAcGFyYW0ge0FycmF5fEVsZW1lbnR9IGVsZW0KICovCmdldFRleHQgPSBTaXp6bGUuZ2V0VGV4dCA9IGZ1bmN0aW9uKCBlbGVtICkgewoJdmFyIG5vZGUsCgkJcmV0ID0gIiIsCgkJaSA9IDAsCgkJbm9kZVR5cGUgPSBlbGVtLm5vZGVUeXBlOwoKCWlmICggIW5vZGVUeXBlICkgewoJCS8vIElmIG5vIG5vZGVUeXBlLCB0aGlzIGlzIGV4cGVjdGVkIHRvIGJlIGFuIGFycmF5CgkJZm9yICggOyAobm9kZSA9IGVsZW1baV0pOyBpKysgKSB7CgkJCS8vIERvIG5vdCB0cmF2ZXJzZSBjb21tZW50IG5vZGVzCgkJCXJldCArPSBnZXRUZXh0KCBub2RlICk7CgkJfQoJfSBlbHNlIGlmICggbm9kZVR5cGUgPT09IDEgfHwgbm9kZVR5cGUgPT09IDkgfHwgbm9kZVR5cGUgPT09IDExICkgewoJCS8vIFVzZSB0ZXh0Q29udGVudCBmb3IgZWxlbWVudHMKCQkvLyBpbm5lclRleHQgdXNhZ2UgcmVtb3ZlZCBmb3IgY29uc2lzdGVuY3kgb2YgbmV3IGxpbmVzIChzZWUgIzExMTUzKQoJCWlmICggdHlwZW9mIGVsZW0udGV4dENvbnRlbnQgPT09ICJzdHJpbmciICkgewoJCQlyZXR1cm4gZWxlbS50ZXh0Q29udGVudDsKCQl9IGVsc2UgewoJCQkvLyBUcmF2ZXJzZSBpdHMgY2hpbGRyZW4KCQkJZm9yICggZWxlbSA9IGVsZW0uZmlyc3RDaGlsZDsgZWxlbTsgZWxlbSA9IGVsZW0ubmV4dFNpYmxpbmcgKSB7CgkJCQlyZXQgKz0gZ2V0VGV4dCggZWxlbSApOwoJCQl9CgkJfQoJfSBlbHNlIGlmICggbm9kZVR5cGUgPT09IDMgfHwgbm9kZVR5cGUgPT09IDQgKSB7CgkJcmV0dXJuIGVsZW0ubm9kZVZhbHVlOwoJfQoJLy8gRG8gbm90IGluY2x1ZGUgY29tbWVudCBvciBwcm9jZXNzaW5nIGluc3RydWN0aW9uIG5vZGVzCgoJcmV0dXJuIHJldDsKfTsKCkV4cHIgPSBTaXp6bGUuc2VsZWN0b3JzID0gewoKCS8vIENhbiBiZSBhZGp1c3RlZCBieSB0aGUgdXNlcgoJY2FjaGVMZW5ndGg6IDUwLAoKCWNyZWF0ZVBzZXVkbzogbWFya0Z1bmN0aW9uLAoKCW1hdGNoOiBtYXRjaEV4cHIsCgoJZmluZDoge30sCgoJcmVsYXRpdmU6IHsKCQkiPiI6IHsgZGlyOiAicGFyZW50Tm9kZSIsIGZpcnN0OiB0cnVlIH0sCgkJIiAiOiB7IGRpcjogInBhcmVudE5vZGUiIH0sCgkJIisiOiB7IGRpcjogInByZXZpb3VzU2libGluZyIsIGZpcnN0OiB0cnVlIH0sCgkJIn4iOiB7IGRpcjogInByZXZpb3VzU2libGluZyIgfQoJfSwKCglwcmVGaWx0ZXI6IHsKCQkiQVRUUiI6IGZ1bmN0aW9uKCBtYXRjaCApIHsKCQkJbWF0Y2hbMV0gPSBtYXRjaFsxXS5yZXBsYWNlKCBydW5lc2NhcGUsIGZ1bmVzY2FwZSApOwoKCQkJLy8gTW92ZSB0aGUgZ2l2ZW4gdmFsdWUgdG8gbWF0Y2hbM10gd2hldGhlciBxdW90ZWQgb3IgdW5xdW90ZWQKCQkJbWF0Y2hbM10gPSAoIG1hdGNoWzRdIHx8IG1hdGNoWzVdIHx8ICIiICkucmVwbGFjZSggcnVuZXNjYXBlLCBmdW5lc2NhcGUgKTsKCgkJCWlmICggbWF0Y2hbMl0gPT09ICJ+PSIgKSB7CgkJCQltYXRjaFszXSA9ICIgIiArIG1hdGNoWzNdICsgIiAiOwoJCQl9CgoJCQlyZXR1cm4gbWF0Y2guc2xpY2UoIDAsIDQgKTsKCQl9LAoKCQkiQ0hJTEQiOiBmdW5jdGlvbiggbWF0Y2ggKSB7CgkJCS8qIG1hdGNoZXMgZnJvbSBtYXRjaEV4cHJbIkNISUxEIl0KCQkJCTEgdHlwZSAob25seXxudGh8Li4uKQoJCQkJMiB3aGF0IChjaGlsZHxvZi10eXBlKQoJCQkJMyBhcmd1bWVudCAoZXZlbnxvZGR8XGQqfFxkKm4oWystXVxkKyk/fC4uLikKCQkJCTQgeG4tY29tcG9uZW50IG9mIHhuK3kgYXJndW1lbnQgKFsrLV0/XGQqbnwpCgkJCQk1IHNpZ24gb2YgeG4tY29tcG9uZW50CgkJCQk2IHggb2YgeG4tY29tcG9uZW50CgkJCQk3IHNpZ24gb2YgeS1jb21wb25lbnQKCQkJCTggeSBvZiB5LWNvbXBvbmVudAoJCQkqLwoJCQltYXRjaFsxXSA9IG1hdGNoWzFdLnRvTG93ZXJDYXNlKCk7CgoJCQlpZiAoIG1hdGNoWzFdLnNsaWNlKCAwLCAzICkgPT09ICJudGgiICkgewoJCQkJLy8gbnRoLSogcmVxdWlyZXMgYXJndW1lbnQKCQkJCWlmICggIW1hdGNoWzNdICkgewoJCQkJCVNpenpsZS5lcnJvciggbWF0Y2hbMF0gKTsKCQkJCX0KCgkJCQkvLyBudW1lcmljIHggYW5kIHkgcGFyYW1ldGVycyBmb3IgRXhwci5maWx0ZXIuQ0hJTEQKCQkJCS8vIHJlbWVtYmVyIHRoYXQgZmFsc2UvdHJ1ZSBjYXN0IHJlc3BlY3RpdmVseSB0byAwLzEKCQkJCW1hdGNoWzRdID0gKyggbWF0Y2hbNF0gPyBtYXRjaFs1XSArIChtYXRjaFs2XSB8fCAxKSA6IDIgKiAoIG1hdGNoWzNdID09PSAiZXZlbiIgfHwgbWF0Y2hbM10gPT09ICJvZGQiICkgKTsKCQkJCW1hdGNoWzVdID0gKyggKCBtYXRjaFs3XSArIG1hdGNoWzhdICkgfHwgbWF0Y2hbM10gPT09ICJvZGQiICk7CgoJCQkvLyBvdGhlciB0eXBlcyBwcm9oaWJpdCBhcmd1bWVudHMKCQkJfSBlbHNlIGlmICggbWF0Y2hbM10gKSB7CgkJCQlTaXp6bGUuZXJyb3IoIG1hdGNoWzBdICk7CgkJCX0KCgkJCXJldHVybiBtYXRjaDsKCQl9LAoKCQkiUFNFVURPIjogZnVuY3Rpb24oIG1hdGNoICkgewoJCQl2YXIgZXhjZXNzLAoJCQkJdW5xdW90ZWQgPSAhbWF0Y2hbNV0gJiYgbWF0Y2hbMl07CgoJCQlpZiAoIG1hdGNoRXhwclsiQ0hJTEQiXS50ZXN0KCBtYXRjaFswXSApICkgewoJCQkJcmV0dXJuIG51bGw7CgkJCX0KCgkJCS8vIEFjY2VwdCBxdW90ZWQgYXJndW1lbnRzIGFzLWlzCgkJCWlmICggbWF0Y2hbNF0gKSB7CgkJCQltYXRjaFsyXSA9IG1hdGNoWzRdOwoKCQkJLy8gU3RyaXAgZXhjZXNzIGNoYXJhY3RlcnMgZnJvbSB1bnF1b3RlZCBhcmd1bWVudHMKCQkJfSBlbHNlIGlmICggdW5xdW90ZWQgJiYgcnBzZXVkby50ZXN0KCB1bnF1b3RlZCApICYmCgkJCQkvLyBHZXQgZXhjZXNzIGZyb20gdG9rZW5pemUgKHJlY3Vyc2l2ZWx5KQoJCQkJKGV4Y2VzcyA9IHRva2VuaXplKCB1bnF1b3RlZCwgdHJ1ZSApKSAmJgoJCQkJLy8gYWR2YW5jZSB0byB0aGUgbmV4dCBjbG9zaW5nIHBhcmVudGhlc2lzCgkJCQkoZXhjZXNzID0gdW5xdW90ZWQuaW5kZXhPZiggIikiLCB1bnF1b3RlZC5sZW5ndGggLSBleGNlc3MgKSAtIHVucXVvdGVkLmxlbmd0aCkgKSB7CgoJCQkJLy8gZXhjZXNzIGlzIGEgbmVnYXRpdmUgaW5kZXgKCQkJCW1hdGNoWzBdID0gbWF0Y2hbMF0uc2xpY2UoIDAsIGV4Y2VzcyApOwoJCQkJbWF0Y2hbMl0gPSB1bnF1b3RlZC5zbGljZSggMCwgZXhjZXNzICk7CgkJCX0KCgkJCS8vIFJldHVybiBvbmx5IGNhcHR1cmVzIG5lZWRlZCBieSB0aGUgcHNldWRvIGZpbHRlciBtZXRob2QgKHR5cGUgYW5kIGFyZ3VtZW50KQoJCQlyZXR1cm4gbWF0Y2guc2xpY2UoIDAsIDMgKTsKCQl9Cgl9LAoKCWZpbHRlcjogewoKCQkiVEFHIjogZnVuY3Rpb24oIG5vZGVOYW1lICkgewoJCQlpZiAoIG5vZGVOYW1lID09PSAiKiIgKSB7CgkJCQlyZXR1cm4gZnVuY3Rpb24oKSB7IHJldHVybiB0cnVlOyB9OwoJCQl9CgoJCQlub2RlTmFtZSA9IG5vZGVOYW1lLnJlcGxhY2UoIHJ1bmVzY2FwZSwgZnVuZXNjYXBlICkudG9Mb3dlckNhc2UoKTsKCQkJcmV0dXJuIGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJcmV0dXJuIGVsZW0ubm9kZU5hbWUgJiYgZWxlbS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSBub2RlTmFtZTsKCQkJfTsKCQl9LAoKCQkiQ0xBU1MiOiBmdW5jdGlvbiggY2xhc3NOYW1lICkgewoJCQl2YXIgcGF0dGVybiA9IGNsYXNzQ2FjaGVbIGNsYXNzTmFtZSArICIgIiBdOwoKCQkJcmV0dXJuIHBhdHRlcm4gfHwKCQkJCShwYXR0ZXJuID0gbmV3IFJlZ0V4cCggIihefCIgKyB3aGl0ZXNwYWNlICsgIikiICsgY2xhc3NOYW1lICsgIigiICsgd2hpdGVzcGFjZSArICJ8JCkiICkpICYmCgkJCQljbGFzc0NhY2hlKCBjbGFzc05hbWUsIGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJCXJldHVybiBwYXR0ZXJuLnRlc3QoIGVsZW0uY2xhc3NOYW1lIHx8ICh0eXBlb2YgZWxlbS5nZXRBdHRyaWJ1dGUgIT09IHN0cnVuZGVmaW5lZCAmJiBlbGVtLmdldEF0dHJpYnV0ZSgiY2xhc3MiKSkgfHwgIiIgKTsKCQkJCX0pOwoJCX0sCgoJCSJBVFRSIjogZnVuY3Rpb24oIG5hbWUsIG9wZXJhdG9yLCBjaGVjayApIHsKCQkJcmV0dXJuIGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJdmFyIHJlc3VsdCA9IFNpenpsZS5hdHRyKCBlbGVtLCBuYW1lICk7CgoJCQkJaWYgKCByZXN1bHQgPT0gbnVsbCApIHsKCQkJCQlyZXR1cm4gb3BlcmF0b3IgPT09ICIhPSI7CgkJCQl9CgkJCQlpZiAoICFvcGVyYXRvciApIHsKCQkJCQlyZXR1cm4gdHJ1ZTsKCQkJCX0KCgkJCQlyZXN1bHQgKz0gIiI7CgoJCQkJcmV0dXJuIG9wZXJhdG9yID09PSAiPSIgPyByZXN1bHQgPT09IGNoZWNrIDoKCQkJCQlvcGVyYXRvciA9PT0gIiE9IiA/IHJlc3VsdCAhPT0gY2hlY2sgOgoJCQkJCW9wZXJhdG9yID09PSAiXj0iID8gY2hlY2sgJiYgcmVzdWx0LmluZGV4T2YoIGNoZWNrICkgPT09IDAgOgoJCQkJCW9wZXJhdG9yID09PSAiKj0iID8gY2hlY2sgJiYgcmVzdWx0LmluZGV4T2YoIGNoZWNrICkgPiAtMSA6CgkJCQkJb3BlcmF0b3IgPT09ICIkPSIgPyBjaGVjayAmJiByZXN1bHQuc2xpY2UoIC1jaGVjay5sZW5ndGggKSA9PT0gY2hlY2sgOgoJCQkJCW9wZXJhdG9yID09PSAifj0iID8gKCAiICIgKyByZXN1bHQgKyAiICIgKS5pbmRleE9mKCBjaGVjayApID4gLTEgOgoJCQkJCW9wZXJhdG9yID09PSAifD0iID8gcmVzdWx0ID09PSBjaGVjayB8fCByZXN1bHQuc2xpY2UoIDAsIGNoZWNrLmxlbmd0aCArIDEgKSA9PT0gY2hlY2sgKyAiLSIgOgoJCQkJCWZhbHNlOwoJCQl9OwoJCX0sCgoJCSJDSElMRCI6IGZ1bmN0aW9uKCB0eXBlLCB3aGF0LCBhcmd1bWVudCwgZmlyc3QsIGxhc3QgKSB7CgkJCXZhciBzaW1wbGUgPSB0eXBlLnNsaWNlKCAwLCAzICkgIT09ICJudGgiLAoJCQkJZm9yd2FyZCA9IHR5cGUuc2xpY2UoIC00ICkgIT09ICJsYXN0IiwKCQkJCW9mVHlwZSA9IHdoYXQgPT09ICJvZi10eXBlIjsKCgkJCXJldHVybiBmaXJzdCA9PT0gMSAmJiBsYXN0ID09PSAwID8KCgkJCQkvLyBTaG9ydGN1dCBmb3IgOm50aC0qKG4pCgkJCQlmdW5jdGlvbiggZWxlbSApIHsKCQkJCQlyZXR1cm4gISFlbGVtLnBhcmVudE5vZGU7CgkJCQl9IDoKCgkJCQlmdW5jdGlvbiggZWxlbSwgY29udGV4dCwgeG1sICkgewoJCQkJCXZhciBjYWNoZSwgb3V0ZXJDYWNoZSwgbm9kZSwgZGlmZiwgbm9kZUluZGV4LCBzdGFydCwKCQkJCQkJZGlyID0gc2ltcGxlICE9PSBmb3J3YXJkID8gIm5leHRTaWJsaW5nIiA6ICJwcmV2aW91c1NpYmxpbmciLAoJCQkJCQlwYXJlbnQgPSBlbGVtLnBhcmVudE5vZGUsCgkJCQkJCW5hbWUgPSBvZlR5cGUgJiYgZWxlbS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpLAoJCQkJCQl1c2VDYWNoZSA9ICF4bWwgJiYgIW9mVHlwZTsKCgkJCQkJaWYgKCBwYXJlbnQgKSB7CgoJCQkJCQkvLyA6KGZpcnN0fGxhc3R8b25seSktKGNoaWxkfG9mLXR5cGUpCgkJCQkJCWlmICggc2ltcGxlICkgewoJCQkJCQkJd2hpbGUgKCBkaXIgKSB7CgkJCQkJCQkJbm9kZSA9IGVsZW07CgkJCQkJCQkJd2hpbGUgKCAobm9kZSA9IG5vZGVbIGRpciBdKSApIHsKCQkJCQkJCQkJaWYgKCBvZlR5cGUgPyBub2RlLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09IG5hbWUgOiBub2RlLm5vZGVUeXBlID09PSAxICkgewoJCQkJCQkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJCQkJCQl9CgkJCQkJCQkJfQoJCQkJCQkJCS8vIFJldmVyc2UgZGlyZWN0aW9uIGZvciA6b25seS0qIChpZiB3ZSBoYXZlbid0IHlldCBkb25lIHNvKQoJCQkJCQkJCXN0YXJ0ID0gZGlyID0gdHlwZSA9PT0gIm9ubHkiICYmICFzdGFydCAmJiAibmV4dFNpYmxpbmciOwoJCQkJCQkJfQoJCQkJCQkJcmV0dXJuIHRydWU7CgkJCQkJCX0KCgkJCQkJCXN0YXJ0ID0gWyBmb3J3YXJkID8gcGFyZW50LmZpcnN0Q2hpbGQgOiBwYXJlbnQubGFzdENoaWxkIF07CgoJCQkJCQkvLyBub24teG1sIDpudGgtY2hpbGQoLi4uKSBzdG9yZXMgY2FjaGUgZGF0YSBvbiBgcGFyZW50YAoJCQkJCQlpZiAoIGZvcndhcmQgJiYgdXNlQ2FjaGUgKSB7CgkJCQkJCQkvLyBTZWVrIGBlbGVtYCBmcm9tIGEgcHJldmlvdXNseS1jYWNoZWQgaW5kZXgKCQkJCQkJCW91dGVyQ2FjaGUgPSBwYXJlbnRbIGV4cGFuZG8gXSB8fCAocGFyZW50WyBleHBhbmRvIF0gPSB7fSk7CgkJCQkJCQljYWNoZSA9IG91dGVyQ2FjaGVbIHR5cGUgXSB8fCBbXTsKCQkJCQkJCW5vZGVJbmRleCA9IGNhY2hlWzBdID09PSBkaXJydW5zICYmIGNhY2hlWzFdOwoJCQkJCQkJZGlmZiA9IGNhY2hlWzBdID09PSBkaXJydW5zICYmIGNhY2hlWzJdOwoJCQkJCQkJbm9kZSA9IG5vZGVJbmRleCAmJiBwYXJlbnQuY2hpbGROb2Rlc1sgbm9kZUluZGV4IF07CgoJCQkJCQkJd2hpbGUgKCAobm9kZSA9ICsrbm9kZUluZGV4ICYmIG5vZGUgJiYgbm9kZVsgZGlyIF0gfHwKCgkJCQkJCQkJLy8gRmFsbGJhY2sgdG8gc2Vla2luZyBgZWxlbWAgZnJvbSB0aGUgc3RhcnQKCQkJCQkJCQkoZGlmZiA9IG5vZGVJbmRleCA9IDApIHx8IHN0YXJ0LnBvcCgpKSApIHsKCgkJCQkJCQkJLy8gV2hlbiBmb3VuZCwgY2FjaGUgaW5kZXhlcyBvbiBgcGFyZW50YCBhbmQgYnJlYWsKCQkJCQkJCQlpZiAoIG5vZGUubm9kZVR5cGUgPT09IDEgJiYgKytkaWZmICYmIG5vZGUgPT09IGVsZW0gKSB7CgkJCQkJCQkJCW91dGVyQ2FjaGVbIHR5cGUgXSA9IFsgZGlycnVucywgbm9kZUluZGV4LCBkaWZmIF07CgkJCQkJCQkJCWJyZWFrOwoJCQkJCQkJCX0KCQkJCQkJCX0KCgkJCQkJCS8vIFVzZSBwcmV2aW91c2x5LWNhY2hlZCBlbGVtZW50IGluZGV4IGlmIGF2YWlsYWJsZQoJCQkJCQl9IGVsc2UgaWYgKCB1c2VDYWNoZSAmJiAoY2FjaGUgPSAoZWxlbVsgZXhwYW5kbyBdIHx8IChlbGVtWyBleHBhbmRvIF0gPSB7fSkpWyB0eXBlIF0pICYmIGNhY2hlWzBdID09PSBkaXJydW5zICkgewoJCQkJCQkJZGlmZiA9IGNhY2hlWzFdOwoKCQkJCQkJLy8geG1sIDpudGgtY2hpbGQoLi4uKSBvciA6bnRoLWxhc3QtY2hpbGQoLi4uKSBvciA6bnRoKC1sYXN0KT8tb2YtdHlwZSguLi4pCgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkvLyBVc2UgdGhlIHNhbWUgbG9vcCBhcyBhYm92ZSB0byBzZWVrIGBlbGVtYCBmcm9tIHRoZSBzdGFydAoJCQkJCQkJd2hpbGUgKCAobm9kZSA9ICsrbm9kZUluZGV4ICYmIG5vZGUgJiYgbm9kZVsgZGlyIF0gfHwKCQkJCQkJCQkoZGlmZiA9IG5vZGVJbmRleCA9IDApIHx8IHN0YXJ0LnBvcCgpKSApIHsKCgkJCQkJCQkJaWYgKCAoIG9mVHlwZSA/IG5vZGUubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gbmFtZSA6IG5vZGUubm9kZVR5cGUgPT09IDEgKSAmJiArK2RpZmYgKSB7CgkJCQkJCQkJCS8vIENhY2hlIHRoZSBpbmRleCBvZiBlYWNoIGVuY291bnRlcmVkIGVsZW1lbnQKCQkJCQkJCQkJaWYgKCB1c2VDYWNoZSApIHsKCQkJCQkJCQkJCShub2RlWyBleHBhbmRvIF0gfHwgKG5vZGVbIGV4cGFuZG8gXSA9IHt9KSlbIHR5cGUgXSA9IFsgZGlycnVucywgZGlmZiBdOwoJCQkJCQkJCQl9CgoJCQkJCQkJCQlpZiAoIG5vZGUgPT09IGVsZW0gKSB7CgkJCQkJCQkJCQlicmVhazsKCQkJCQkJCQkJfQoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJfQoKCQkJCQkJLy8gSW5jb3Jwb3JhdGUgdGhlIG9mZnNldCwgdGhlbiBjaGVjayBhZ2FpbnN0IGN5Y2xlIHNpemUKCQkJCQkJZGlmZiAtPSBsYXN0OwoJCQkJCQlyZXR1cm4gZGlmZiA9PT0gZmlyc3QgfHwgKCBkaWZmICUgZmlyc3QgPT09IDAgJiYgZGlmZiAvIGZpcnN0ID49IDAgKTsKCQkJCQl9CgkJCQl9OwoJCX0sCgoJCSJQU0VVRE8iOiBmdW5jdGlvbiggcHNldWRvLCBhcmd1bWVudCApIHsKCQkJLy8gcHNldWRvLWNsYXNzIG5hbWVzIGFyZSBjYXNlLWluc2Vuc2l0aXZlCgkJCS8vIGh0dHA6Ly93d3cudzMub3JnL1RSL3NlbGVjdG9ycy8jcHNldWRvLWNsYXNzZXMKCQkJLy8gUHJpb3JpdGl6ZSBieSBjYXNlIHNlbnNpdGl2aXR5IGluIGNhc2UgY3VzdG9tIHBzZXVkb3MgYXJlIGFkZGVkIHdpdGggdXBwZXJjYXNlIGxldHRlcnMKCQkJLy8gUmVtZW1iZXIgdGhhdCBzZXRGaWx0ZXJzIGluaGVyaXRzIGZyb20gcHNldWRvcwoJCQl2YXIgYXJncywKCQkJCWZuID0gRXhwci5wc2V1ZG9zWyBwc2V1ZG8gXSB8fCBFeHByLnNldEZpbHRlcnNbIHBzZXVkby50b0xvd2VyQ2FzZSgpIF0gfHwKCQkJCQlTaXp6bGUuZXJyb3IoICJ1bnN1cHBvcnRlZCBwc2V1ZG86ICIgKyBwc2V1ZG8gKTsKCgkJCS8vIFRoZSB1c2VyIG1heSB1c2UgY3JlYXRlUHNldWRvIHRvIGluZGljYXRlIHRoYXQKCQkJLy8gYXJndW1lbnRzIGFyZSBuZWVkZWQgdG8gY3JlYXRlIHRoZSBmaWx0ZXIgZnVuY3Rpb24KCQkJLy8ganVzdCBhcyBTaXp6bGUgZG9lcwoJCQlpZiAoIGZuWyBleHBhbmRvIF0gKSB7CgkJCQlyZXR1cm4gZm4oIGFyZ3VtZW50ICk7CgkJCX0KCgkJCS8vIEJ1dCBtYWludGFpbiBzdXBwb3J0IGZvciBvbGQgc2lnbmF0dXJlcwoJCQlpZiAoIGZuLmxlbmd0aCA+IDEgKSB7CgkJCQlhcmdzID0gWyBwc2V1ZG8sIHBzZXVkbywgIiIsIGFyZ3VtZW50IF07CgkJCQlyZXR1cm4gRXhwci5zZXRGaWx0ZXJzLmhhc093blByb3BlcnR5KCBwc2V1ZG8udG9Mb3dlckNhc2UoKSApID8KCQkJCQltYXJrRnVuY3Rpb24oZnVuY3Rpb24oIHNlZWQsIG1hdGNoZXMgKSB7CgkJCQkJCXZhciBpZHgsCgkJCQkJCQltYXRjaGVkID0gZm4oIHNlZWQsIGFyZ3VtZW50ICksCgkJCQkJCQlpID0gbWF0Y2hlZC5sZW5ndGg7CgkJCQkJCXdoaWxlICggaS0tICkgewoJCQkJCQkJaWR4ID0gaW5kZXhPZi5jYWxsKCBzZWVkLCBtYXRjaGVkW2ldICk7CgkJCQkJCQlzZWVkWyBpZHggXSA9ICEoIG1hdGNoZXNbIGlkeCBdID0gbWF0Y2hlZFtpXSApOwoJCQkJCQl9CgkJCQkJfSkgOgoJCQkJCWZ1bmN0aW9uKCBlbGVtICkgewoJCQkJCQlyZXR1cm4gZm4oIGVsZW0sIDAsIGFyZ3MgKTsKCQkJCQl9OwoJCQl9CgoJCQlyZXR1cm4gZm47CgkJfQoJfSwKCglwc2V1ZG9zOiB7CgkJLy8gUG90ZW50aWFsbHkgY29tcGxleCBwc2V1ZG9zCgkJIm5vdCI6IG1hcmtGdW5jdGlvbihmdW5jdGlvbiggc2VsZWN0b3IgKSB7CgkJCS8vIFRyaW0gdGhlIHNlbGVjdG9yIHBhc3NlZCB0byBjb21waWxlCgkJCS8vIHRvIGF2b2lkIHRyZWF0aW5nIGxlYWRpbmcgYW5kIHRyYWlsaW5nCgkJCS8vIHNwYWNlcyBhcyBjb21iaW5hdG9ycwoJCQl2YXIgaW5wdXQgPSBbXSwKCQkJCXJlc3VsdHMgPSBbXSwKCQkJCW1hdGNoZXIgPSBjb21waWxlKCBzZWxlY3Rvci5yZXBsYWNlKCBydHJpbSwgIiQxIiApICk7CgoJCQlyZXR1cm4gbWF0Y2hlclsgZXhwYW5kbyBdID8KCQkJCW1hcmtGdW5jdGlvbihmdW5jdGlvbiggc2VlZCwgbWF0Y2hlcywgY29udGV4dCwgeG1sICkgewoJCQkJCXZhciBlbGVtLAoJCQkJCQl1bm1hdGNoZWQgPSBtYXRjaGVyKCBzZWVkLCBudWxsLCB4bWwsIFtdICksCgkJCQkJCWkgPSBzZWVkLmxlbmd0aDsKCgkJCQkJLy8gTWF0Y2ggZWxlbWVudHMgdW5tYXRjaGVkIGJ5IGBtYXRjaGVyYAoJCQkJCXdoaWxlICggaS0tICkgewoJCQkJCQlpZiAoIChlbGVtID0gdW5tYXRjaGVkW2ldKSApIHsKCQkJCQkJCXNlZWRbaV0gPSAhKG1hdGNoZXNbaV0gPSBlbGVtKTsKCQkJCQkJfQoJCQkJCX0KCQkJCX0pIDoKCQkJCWZ1bmN0aW9uKCBlbGVtLCBjb250ZXh0LCB4bWwgKSB7CgkJCQkJaW5wdXRbMF0gPSBlbGVtOwoJCQkJCW1hdGNoZXIoIGlucHV0LCBudWxsLCB4bWwsIHJlc3VsdHMgKTsKCQkJCQlyZXR1cm4gIXJlc3VsdHMucG9wKCk7CgkJCQl9OwoJCX0pLAoKCQkiaGFzIjogbWFya0Z1bmN0aW9uKGZ1bmN0aW9uKCBzZWxlY3RvciApIHsKCQkJcmV0dXJuIGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJcmV0dXJuIFNpenpsZSggc2VsZWN0b3IsIGVsZW0gKS5sZW5ndGggPiAwOwoJCQl9OwoJCX0pLAoKCQkiY29udGFpbnMiOiBtYXJrRnVuY3Rpb24oZnVuY3Rpb24oIHRleHQgKSB7CgkJCXJldHVybiBmdW5jdGlvbiggZWxlbSApIHsKCQkJCXJldHVybiAoIGVsZW0udGV4dENvbnRlbnQgfHwgZWxlbS5pbm5lclRleHQgfHwgZ2V0VGV4dCggZWxlbSApICkuaW5kZXhPZiggdGV4dCApID4gLTE7CgkJCX07CgkJfSksCgoJCS8vICJXaGV0aGVyIGFuIGVsZW1lbnQgaXMgcmVwcmVzZW50ZWQgYnkgYSA6bGFuZygpIHNlbGVjdG9yCgkJLy8gaXMgYmFzZWQgc29sZWx5IG9uIHRoZSBlbGVtZW50J3MgbGFuZ3VhZ2UgdmFsdWUKCQkvLyBiZWluZyBlcXVhbCB0byB0aGUgaWRlbnRpZmllciBDLAoJCS8vIG9yIGJlZ2lubmluZyB3aXRoIHRoZSBpZGVudGlmaWVyIEMgaW1tZWRpYXRlbHkgZm9sbG93ZWQgYnkgIi0iLgoJCS8vIFRoZSBtYXRjaGluZyBvZiBDIGFnYWluc3QgdGhlIGVsZW1lbnQncyBsYW5ndWFnZSB2YWx1ZSBpcyBwZXJmb3JtZWQgY2FzZS1pbnNlbnNpdGl2ZWx5LgoJCS8vIFRoZSBpZGVudGlmaWVyIEMgZG9lcyBub3QgaGF2ZSB0byBiZSBhIHZhbGlkIGxhbmd1YWdlIG5hbWUuIgoJCS8vIGh0dHA6Ly93d3cudzMub3JnL1RSL3NlbGVjdG9ycy8jbGFuZy1wc2V1ZG8KCQkibGFuZyI6IG1hcmtGdW5jdGlvbiggZnVuY3Rpb24oIGxhbmcgKSB7CgkJCS8vIGxhbmcgdmFsdWUgbXVzdCBiZSBhIHZhbGlkIGlkZW50aWZpZGVyCgkJCWlmICggIXJpZGVudGlmaWVyLnRlc3QobGFuZyB8fCAiIikgKSB7CgkJCQlTaXp6bGUuZXJyb3IoICJ1bnN1cHBvcnRlZCBsYW5nOiAiICsgbGFuZyApOwoJCQl9CgkJCWxhbmcgPSBsYW5nLnJlcGxhY2UoIHJ1bmVzY2FwZSwgZnVuZXNjYXBlICkudG9Mb3dlckNhc2UoKTsKCQkJcmV0dXJuIGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJdmFyIGVsZW1MYW5nOwoJCQkJZG8gewoJCQkJCWlmICggKGVsZW1MYW5nID0gZG9jdW1lbnRJc1hNTCA/CgkJCQkJCWVsZW0uZ2V0QXR0cmlidXRlKCJ4bWw6bGFuZyIpIHx8IGVsZW0uZ2V0QXR0cmlidXRlKCJsYW5nIikgOgoJCQkJCQllbGVtLmxhbmcpICkgewoKCQkJCQkJZWxlbUxhbmcgPSBlbGVtTGFuZy50b0xvd2VyQ2FzZSgpOwoJCQkJCQlyZXR1cm4gZWxlbUxhbmcgPT09IGxhbmcgfHwgZWxlbUxhbmcuaW5kZXhPZiggbGFuZyArICItIiApID09PSAwOwoJCQkJCX0KCQkJCX0gd2hpbGUgKCAoZWxlbSA9IGVsZW0ucGFyZW50Tm9kZSkgJiYgZWxlbS5ub2RlVHlwZSA9PT0gMSApOwoJCQkJcmV0dXJuIGZhbHNlOwoJCQl9OwoJCX0pLAoKCQkvLyBNaXNjZWxsYW5lb3VzCgkJInRhcmdldCI6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQl2YXIgaGFzaCA9IHdpbmRvdy5sb2NhdGlvbiAmJiB3aW5kb3cubG9jYXRpb24uaGFzaDsKCQkJcmV0dXJuIGhhc2ggJiYgaGFzaC5zbGljZSggMSApID09PSBlbGVtLmlkOwoJCX0sCgoJCSJyb290IjogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCXJldHVybiBlbGVtID09PSBkb2NFbGVtOwoJCX0sCgoJCSJmb2N1cyI6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQlyZXR1cm4gZWxlbSA9PT0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudCAmJiAoIWRvY3VtZW50Lmhhc0ZvY3VzIHx8IGRvY3VtZW50Lmhhc0ZvY3VzKCkpICYmICEhKGVsZW0udHlwZSB8fCBlbGVtLmhyZWYgfHwgfmVsZW0udGFiSW5kZXgpOwoJCX0sCgoJCS8vIEJvb2xlYW4gcHJvcGVydGllcwoJCSJlbmFibGVkIjogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCXJldHVybiBlbGVtLmRpc2FibGVkID09PSBmYWxzZTsKCQl9LAoKCQkiZGlzYWJsZWQiOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJcmV0dXJuIGVsZW0uZGlzYWJsZWQgPT09IHRydWU7CgkJfSwKCgkJImNoZWNrZWQiOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJLy8gSW4gQ1NTMywgOmNoZWNrZWQgc2hvdWxkIHJldHVybiBib3RoIGNoZWNrZWQgYW5kIHNlbGVjdGVkIGVsZW1lbnRzCgkJCS8vIGh0dHA6Ly93d3cudzMub3JnL1RSLzIwMTEvUkVDLWNzczMtc2VsZWN0b3JzLTIwMTEwOTI5LyNjaGVja2VkCgkJCXZhciBub2RlTmFtZSA9IGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKTsKCQkJcmV0dXJuIChub2RlTmFtZSA9PT0gImlucHV0IiAmJiAhIWVsZW0uY2hlY2tlZCkgfHwgKG5vZGVOYW1lID09PSAib3B0aW9uIiAmJiAhIWVsZW0uc2VsZWN0ZWQpOwoJCX0sCgoJCSJzZWxlY3RlZCI6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQkvLyBBY2Nlc3NpbmcgdGhpcyBwcm9wZXJ0eSBtYWtlcyBzZWxlY3RlZC1ieS1kZWZhdWx0CgkJCS8vIG9wdGlvbnMgaW4gU2FmYXJpIHdvcmsgcHJvcGVybHkKCQkJaWYgKCBlbGVtLnBhcmVudE5vZGUgKSB7CgkJCQllbGVtLnBhcmVudE5vZGUuc2VsZWN0ZWRJbmRleDsKCQkJfQoKCQkJcmV0dXJuIGVsZW0uc2VsZWN0ZWQgPT09IHRydWU7CgkJfSwKCgkJLy8gQ29udGVudHMKCQkiZW1wdHkiOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJLy8gaHR0cDovL3d3dy53My5vcmcvVFIvc2VsZWN0b3JzLyNlbXB0eS1wc2V1ZG8KCQkJLy8gOmVtcHR5IGlzIG9ubHkgYWZmZWN0ZWQgYnkgZWxlbWVudCBub2RlcyBhbmQgY29udGVudCBub2RlcyhpbmNsdWRpbmcgdGV4dCgzKSwgY2RhdGEoNCkpLAoJCQkvLyAgIG5vdCBjb21tZW50LCBwcm9jZXNzaW5nIGluc3RydWN0aW9ucywgb3Igb3RoZXJzCgkJCS8vIFRoYW5rcyB0byBEaWVnbyBQZXJpbmkgZm9yIHRoZSBub2RlTmFtZSBzaG9ydGN1dAoJCQkvLyAgIEdyZWF0ZXIgdGhhbiAiQCIgbWVhbnMgYWxwaGEgY2hhcmFjdGVycyAoc3BlY2lmaWNhbGx5IG5vdCBzdGFydGluZyB3aXRoICIjIiBvciAiPyIpCgkJCWZvciAoIGVsZW0gPSBlbGVtLmZpcnN0Q2hpbGQ7IGVsZW07IGVsZW0gPSBlbGVtLm5leHRTaWJsaW5nICkgewoJCQkJaWYgKCBlbGVtLm5vZGVOYW1lID4gIkAiIHx8IGVsZW0ubm9kZVR5cGUgPT09IDMgfHwgZWxlbS5ub2RlVHlwZSA9PT0gNCApIHsKCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQl9CgkJCX0KCQkJcmV0dXJuIHRydWU7CgkJfSwKCgkJInBhcmVudCI6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQlyZXR1cm4gIUV4cHIucHNldWRvc1siZW1wdHkiXSggZWxlbSApOwoJCX0sCgoJCS8vIEVsZW1lbnQvaW5wdXQgdHlwZXMKCQkiaGVhZGVyIjogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCXJldHVybiByaGVhZGVyLnRlc3QoIGVsZW0ubm9kZU5hbWUgKTsKCQl9LAoKCQkiaW5wdXQiOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJcmV0dXJuIHJpbnB1dHMudGVzdCggZWxlbS5ub2RlTmFtZSApOwoJCX0sCgoJCSJidXR0b24iOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJdmFyIG5hbWUgPSBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7CgkJCXJldHVybiBuYW1lID09PSAiaW5wdXQiICYmIGVsZW0udHlwZSA9PT0gImJ1dHRvbiIgfHwgbmFtZSA9PT0gImJ1dHRvbiI7CgkJfSwKCgkJInRleHQiOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJdmFyIGF0dHI7CgkJCS8vIElFNiBhbmQgNyB3aWxsIG1hcCBlbGVtLnR5cGUgdG8gJ3RleHQnIGZvciBuZXcgSFRNTDUgdHlwZXMgKHNlYXJjaCwgZXRjKQoJCQkvLyB1c2UgZ2V0QXR0cmlidXRlIGluc3RlYWQgdG8gdGVzdCB0aGlzIGNhc2UKCQkJcmV0dXJuIGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gImlucHV0IiAmJgoJCQkJZWxlbS50eXBlID09PSAidGV4dCIgJiYKCQkJCSggKGF0dHIgPSBlbGVtLmdldEF0dHJpYnV0ZSgidHlwZSIpKSA9PSBudWxsIHx8IGF0dHIudG9Mb3dlckNhc2UoKSA9PT0gZWxlbS50eXBlICk7CgkJfSwKCgkJLy8gUG9zaXRpb24taW4tY29sbGVjdGlvbgoJCSJmaXJzdCI6IGNyZWF0ZVBvc2l0aW9uYWxQc2V1ZG8oZnVuY3Rpb24oKSB7CgkJCXJldHVybiBbIDAgXTsKCQl9KSwKCgkJImxhc3QiOiBjcmVhdGVQb3NpdGlvbmFsUHNldWRvKGZ1bmN0aW9uKCBtYXRjaEluZGV4ZXMsIGxlbmd0aCApIHsKCQkJcmV0dXJuIFsgbGVuZ3RoIC0gMSBdOwoJCX0pLAoKCQkiZXEiOiBjcmVhdGVQb3NpdGlvbmFsUHNldWRvKGZ1bmN0aW9uKCBtYXRjaEluZGV4ZXMsIGxlbmd0aCwgYXJndW1lbnQgKSB7CgkJCXJldHVybiBbIGFyZ3VtZW50IDwgMCA/IGFyZ3VtZW50ICsgbGVuZ3RoIDogYXJndW1lbnQgXTsKCQl9KSwKCgkJImV2ZW4iOiBjcmVhdGVQb3NpdGlvbmFsUHNldWRvKGZ1bmN0aW9uKCBtYXRjaEluZGV4ZXMsIGxlbmd0aCApIHsKCQkJdmFyIGkgPSAwOwoJCQlmb3IgKCA7IGkgPCBsZW5ndGg7IGkgKz0gMiApIHsKCQkJCW1hdGNoSW5kZXhlcy5wdXNoKCBpICk7CgkJCX0KCQkJcmV0dXJuIG1hdGNoSW5kZXhlczsKCQl9KSwKCgkJIm9kZCI6IGNyZWF0ZVBvc2l0aW9uYWxQc2V1ZG8oZnVuY3Rpb24oIG1hdGNoSW5kZXhlcywgbGVuZ3RoICkgewoJCQl2YXIgaSA9IDE7CgkJCWZvciAoIDsgaSA8IGxlbmd0aDsgaSArPSAyICkgewoJCQkJbWF0Y2hJbmRleGVzLnB1c2goIGkgKTsKCQkJfQoJCQlyZXR1cm4gbWF0Y2hJbmRleGVzOwoJCX0pLAoKCQkibHQiOiBjcmVhdGVQb3NpdGlvbmFsUHNldWRvKGZ1bmN0aW9uKCBtYXRjaEluZGV4ZXMsIGxlbmd0aCwgYXJndW1lbnQgKSB7CgkJCXZhciBpID0gYXJndW1lbnQgPCAwID8gYXJndW1lbnQgKyBsZW5ndGggOiBhcmd1bWVudDsKCQkJZm9yICggOyAtLWkgPj0gMDsgKSB7CgkJCQltYXRjaEluZGV4ZXMucHVzaCggaSApOwoJCQl9CgkJCXJldHVybiBtYXRjaEluZGV4ZXM7CgkJfSksCgoJCSJndCI6IGNyZWF0ZVBvc2l0aW9uYWxQc2V1ZG8oZnVuY3Rpb24oIG1hdGNoSW5kZXhlcywgbGVuZ3RoLCBhcmd1bWVudCApIHsKCQkJdmFyIGkgPSBhcmd1bWVudCA8IDAgPyBhcmd1bWVudCArIGxlbmd0aCA6IGFyZ3VtZW50OwoJCQlmb3IgKCA7ICsraSA8IGxlbmd0aDsgKSB7CgkJCQltYXRjaEluZGV4ZXMucHVzaCggaSApOwoJCQl9CgkJCXJldHVybiBtYXRjaEluZGV4ZXM7CgkJfSkKCX0KfTsKCi8vIEFkZCBidXR0b24vaW5wdXQgdHlwZSBwc2V1ZG9zCmZvciAoIGkgaW4geyByYWRpbzogdHJ1ZSwgY2hlY2tib3g6IHRydWUsIGZpbGU6IHRydWUsIHBhc3N3b3JkOiB0cnVlLCBpbWFnZTogdHJ1ZSB9ICkgewoJRXhwci5wc2V1ZG9zWyBpIF0gPSBjcmVhdGVJbnB1dFBzZXVkbyggaSApOwp9CmZvciAoIGkgaW4geyBzdWJtaXQ6IHRydWUsIHJlc2V0OiB0cnVlIH0gKSB7CglFeHByLnBzZXVkb3NbIGkgXSA9IGNyZWF0ZUJ1dHRvblBzZXVkbyggaSApOwp9CgpmdW5jdGlvbiB0b2tlbml6ZSggc2VsZWN0b3IsIHBhcnNlT25seSApIHsKCXZhciBtYXRjaGVkLCBtYXRjaCwgdG9rZW5zLCB0eXBlLAoJCXNvRmFyLCBncm91cHMsIHByZUZpbHRlcnMsCgkJY2FjaGVkID0gdG9rZW5DYWNoZVsgc2VsZWN0b3IgKyAiICIgXTsKCglpZiAoIGNhY2hlZCApIHsKCQlyZXR1cm4gcGFyc2VPbmx5ID8gMCA6IGNhY2hlZC5zbGljZSggMCApOwoJfQoKCXNvRmFyID0gc2VsZWN0b3I7Cglncm91cHMgPSBbXTsKCXByZUZpbHRlcnMgPSBFeHByLnByZUZpbHRlcjsKCgl3aGlsZSAoIHNvRmFyICkgewoKCQkvLyBDb21tYSBhbmQgZmlyc3QgcnVuCgkJaWYgKCAhbWF0Y2hlZCB8fCAobWF0Y2ggPSByY29tbWEuZXhlYyggc29GYXIgKSkgKSB7CgkJCWlmICggbWF0Y2ggKSB7CgkJCQkvLyBEb24ndCBjb25zdW1lIHRyYWlsaW5nIGNvbW1hcyBhcyB2YWxpZAoJCQkJc29GYXIgPSBzb0Zhci5zbGljZSggbWF0Y2hbMF0ubGVuZ3RoICkgfHwgc29GYXI7CgkJCX0KCQkJZ3JvdXBzLnB1c2goIHRva2VucyA9IFtdICk7CgkJfQoKCQltYXRjaGVkID0gZmFsc2U7CgoJCS8vIENvbWJpbmF0b3JzCgkJaWYgKCAobWF0Y2ggPSByY29tYmluYXRvcnMuZXhlYyggc29GYXIgKSkgKSB7CgkJCW1hdGNoZWQgPSBtYXRjaC5zaGlmdCgpOwoJCQl0b2tlbnMucHVzaCggewoJCQkJdmFsdWU6IG1hdGNoZWQsCgkJCQkvLyBDYXN0IGRlc2NlbmRhbnQgY29tYmluYXRvcnMgdG8gc3BhY2UKCQkJCXR5cGU6IG1hdGNoWzBdLnJlcGxhY2UoIHJ0cmltLCAiICIgKQoJCQl9ICk7CgkJCXNvRmFyID0gc29GYXIuc2xpY2UoIG1hdGNoZWQubGVuZ3RoICk7CgkJfQoKCQkvLyBGaWx0ZXJzCgkJZm9yICggdHlwZSBpbiBFeHByLmZpbHRlciApIHsKCQkJaWYgKCAobWF0Y2ggPSBtYXRjaEV4cHJbIHR5cGUgXS5leGVjKCBzb0ZhciApKSAmJiAoIXByZUZpbHRlcnNbIHR5cGUgXSB8fAoJCQkJKG1hdGNoID0gcHJlRmlsdGVyc1sgdHlwZSBdKCBtYXRjaCApKSkgKSB7CgkJCQltYXRjaGVkID0gbWF0Y2guc2hpZnQoKTsKCQkJCXRva2Vucy5wdXNoKCB7CgkJCQkJdmFsdWU6IG1hdGNoZWQsCgkJCQkJdHlwZTogdHlwZSwKCQkJCQltYXRjaGVzOiBtYXRjaAoJCQkJfSApOwoJCQkJc29GYXIgPSBzb0Zhci5zbGljZSggbWF0Y2hlZC5sZW5ndGggKTsKCQkJfQoJCX0KCgkJaWYgKCAhbWF0Y2hlZCApIHsKCQkJYnJlYWs7CgkJfQoJfQoKCS8vIFJldHVybiB0aGUgbGVuZ3RoIG9mIHRoZSBpbnZhbGlkIGV4Y2VzcwoJLy8gaWYgd2UncmUganVzdCBwYXJzaW5nCgkvLyBPdGhlcndpc2UsIHRocm93IGFuIGVycm9yIG9yIHJldHVybiB0b2tlbnMKCXJldHVybiBwYXJzZU9ubHkgPwoJCXNvRmFyLmxlbmd0aCA6CgkJc29GYXIgPwoJCQlTaXp6bGUuZXJyb3IoIHNlbGVjdG9yICkgOgoJCQkvLyBDYWNoZSB0aGUgdG9rZW5zCgkJCXRva2VuQ2FjaGUoIHNlbGVjdG9yLCBncm91cHMgKS5zbGljZSggMCApOwp9CgpmdW5jdGlvbiB0b1NlbGVjdG9yKCB0b2tlbnMgKSB7Cgl2YXIgaSA9IDAsCgkJbGVuID0gdG9rZW5zLmxlbmd0aCwKCQlzZWxlY3RvciA9ICIiOwoJZm9yICggOyBpIDwgbGVuOyBpKysgKSB7CgkJc2VsZWN0b3IgKz0gdG9rZW5zW2ldLnZhbHVlOwoJfQoJcmV0dXJuIHNlbGVjdG9yOwp9CgpmdW5jdGlvbiBhZGRDb21iaW5hdG9yKCBtYXRjaGVyLCBjb21iaW5hdG9yLCBiYXNlICkgewoJdmFyIGRpciA9IGNvbWJpbmF0b3IuZGlyLAoJCWNoZWNrTm9uRWxlbWVudHMgPSBiYXNlICYmIGRpciA9PT0gInBhcmVudE5vZGUiLAoJCWRvbmVOYW1lID0gZG9uZSsrOwoKCXJldHVybiBjb21iaW5hdG9yLmZpcnN0ID8KCQkvLyBDaGVjayBhZ2FpbnN0IGNsb3Nlc3QgYW5jZXN0b3IvcHJlY2VkaW5nIGVsZW1lbnQKCQlmdW5jdGlvbiggZWxlbSwgY29udGV4dCwgeG1sICkgewoJCQl3aGlsZSAoIChlbGVtID0gZWxlbVsgZGlyIF0pICkgewoJCQkJaWYgKCBlbGVtLm5vZGVUeXBlID09PSAxIHx8IGNoZWNrTm9uRWxlbWVudHMgKSB7CgkJCQkJcmV0dXJuIG1hdGNoZXIoIGVsZW0sIGNvbnRleHQsIHhtbCApOwoJCQkJfQoJCQl9CgkJfSA6CgoJCS8vIENoZWNrIGFnYWluc3QgYWxsIGFuY2VzdG9yL3ByZWNlZGluZyBlbGVtZW50cwoJCWZ1bmN0aW9uKCBlbGVtLCBjb250ZXh0LCB4bWwgKSB7CgkJCXZhciBkYXRhLCBjYWNoZSwgb3V0ZXJDYWNoZSwKCQkJCWRpcmtleSA9IGRpcnJ1bnMgKyAiICIgKyBkb25lTmFtZTsKCgkJCS8vIFdlIGNhbid0IHNldCBhcmJpdHJhcnkgZGF0YSBvbiBYTUwgbm9kZXMsIHNvIHRoZXkgZG9uJ3QgYmVuZWZpdCBmcm9tIGRpciBjYWNoaW5nCgkJCWlmICggeG1sICkgewoJCQkJd2hpbGUgKCAoZWxlbSA9IGVsZW1bIGRpciBdKSApIHsKCQkJCQlpZiAoIGVsZW0ubm9kZVR5cGUgPT09IDEgfHwgY2hlY2tOb25FbGVtZW50cyApIHsKCQkJCQkJaWYgKCBtYXRjaGVyKCBlbGVtLCBjb250ZXh0LCB4bWwgKSApIHsKCQkJCQkJCXJldHVybiB0cnVlOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9IGVsc2UgewoJCQkJd2hpbGUgKCAoZWxlbSA9IGVsZW1bIGRpciBdKSApIHsKCQkJCQlpZiAoIGVsZW0ubm9kZVR5cGUgPT09IDEgfHwgY2hlY2tOb25FbGVtZW50cyApIHsKCQkJCQkJb3V0ZXJDYWNoZSA9IGVsZW1bIGV4cGFuZG8gXSB8fCAoZWxlbVsgZXhwYW5kbyBdID0ge30pOwoJCQkJCQlpZiAoIChjYWNoZSA9IG91dGVyQ2FjaGVbIGRpciBdKSAmJiBjYWNoZVswXSA9PT0gZGlya2V5ICkgewoJCQkJCQkJaWYgKCAoZGF0YSA9IGNhY2hlWzFdKSA9PT0gdHJ1ZSB8fCBkYXRhID09PSBjYWNoZWRydW5zICkgewoJCQkJCQkJCXJldHVybiBkYXRhID09PSB0cnVlOwoJCQkJCQkJfQoJCQkJCQl9IGVsc2UgewoJCQkJCQkJY2FjaGUgPSBvdXRlckNhY2hlWyBkaXIgXSA9IFsgZGlya2V5IF07CgkJCQkJCQljYWNoZVsxXSA9IG1hdGNoZXIoIGVsZW0sIGNvbnRleHQsIHhtbCApIHx8IGNhY2hlZHJ1bnM7CgkJCQkJCQlpZiAoIGNhY2hlWzFdID09PSB0cnVlICkgewoJCQkJCQkJCXJldHVybiB0cnVlOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJfTsKfQoKZnVuY3Rpb24gZWxlbWVudE1hdGNoZXIoIG1hdGNoZXJzICkgewoJcmV0dXJuIG1hdGNoZXJzLmxlbmd0aCA+IDEgPwoJCWZ1bmN0aW9uKCBlbGVtLCBjb250ZXh0LCB4bWwgKSB7CgkJCXZhciBpID0gbWF0Y2hlcnMubGVuZ3RoOwoJCQl3aGlsZSAoIGktLSApIHsKCQkJCWlmICggIW1hdGNoZXJzW2ldKCBlbGVtLCBjb250ZXh0LCB4bWwgKSApIHsKCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQl9CgkJCX0KCQkJcmV0dXJuIHRydWU7CgkJfSA6CgkJbWF0Y2hlcnNbMF07Cn0KCmZ1bmN0aW9uIGNvbmRlbnNlKCB1bm1hdGNoZWQsIG1hcCwgZmlsdGVyLCBjb250ZXh0LCB4bWwgKSB7Cgl2YXIgZWxlbSwKCQluZXdVbm1hdGNoZWQgPSBbXSwKCQlpID0gMCwKCQlsZW4gPSB1bm1hdGNoZWQubGVuZ3RoLAoJCW1hcHBlZCA9IG1hcCAhPSBudWxsOwoKCWZvciAoIDsgaSA8IGxlbjsgaSsrICkgewoJCWlmICggKGVsZW0gPSB1bm1hdGNoZWRbaV0pICkgewoJCQlpZiAoICFmaWx0ZXIgfHwgZmlsdGVyKCBlbGVtLCBjb250ZXh0LCB4bWwgKSApIHsKCQkJCW5ld1VubWF0Y2hlZC5wdXNoKCBlbGVtICk7CgkJCQlpZiAoIG1hcHBlZCApIHsKCQkJCQltYXAucHVzaCggaSApOwoJCQkJfQoJCQl9CgkJfQoJfQoKCXJldHVybiBuZXdVbm1hdGNoZWQ7Cn0KCmZ1bmN0aW9uIHNldE1hdGNoZXIoIHByZUZpbHRlciwgc2VsZWN0b3IsIG1hdGNoZXIsIHBvc3RGaWx0ZXIsIHBvc3RGaW5kZXIsIHBvc3RTZWxlY3RvciApIHsKCWlmICggcG9zdEZpbHRlciAmJiAhcG9zdEZpbHRlclsgZXhwYW5kbyBdICkgewoJCXBvc3RGaWx0ZXIgPSBzZXRNYXRjaGVyKCBwb3N0RmlsdGVyICk7Cgl9CglpZiAoIHBvc3RGaW5kZXIgJiYgIXBvc3RGaW5kZXJbIGV4cGFuZG8gXSApIHsKCQlwb3N0RmluZGVyID0gc2V0TWF0Y2hlciggcG9zdEZpbmRlciwgcG9zdFNlbGVjdG9yICk7Cgl9CglyZXR1cm4gbWFya0Z1bmN0aW9uKGZ1bmN0aW9uKCBzZWVkLCByZXN1bHRzLCBjb250ZXh0LCB4bWwgKSB7CgkJdmFyIHRlbXAsIGksIGVsZW0sCgkJCXByZU1hcCA9IFtdLAoJCQlwb3N0TWFwID0gW10sCgkJCXByZWV4aXN0aW5nID0gcmVzdWx0cy5sZW5ndGgsCgoJCQkvLyBHZXQgaW5pdGlhbCBlbGVtZW50cyBmcm9tIHNlZWQgb3IgY29udGV4dAoJCQllbGVtcyA9IHNlZWQgfHwgbXVsdGlwbGVDb250ZXh0cyggc2VsZWN0b3IgfHwgIioiLCBjb250ZXh0Lm5vZGVUeXBlID8gWyBjb250ZXh0IF0gOiBjb250ZXh0LCBbXSApLAoKCQkJLy8gUHJlZmlsdGVyIHRvIGdldCBtYXRjaGVyIGlucHV0LCBwcmVzZXJ2aW5nIGEgbWFwIGZvciBzZWVkLXJlc3VsdHMgc3luY2hyb25pemF0aW9uCgkJCW1hdGNoZXJJbiA9IHByZUZpbHRlciAmJiAoIHNlZWQgfHwgIXNlbGVjdG9yICkgPwoJCQkJY29uZGVuc2UoIGVsZW1zLCBwcmVNYXAsIHByZUZpbHRlciwgY29udGV4dCwgeG1sICkgOgoJCQkJZWxlbXMsCgoJCQltYXRjaGVyT3V0ID0gbWF0Y2hlciA/CgkJCQkvLyBJZiB3ZSBoYXZlIGEgcG9zdEZpbmRlciwgb3IgZmlsdGVyZWQgc2VlZCwgb3Igbm9uLXNlZWQgcG9zdEZpbHRlciBvciBwcmVleGlzdGluZyByZXN1bHRzLAoJCQkJcG9zdEZpbmRlciB8fCAoIHNlZWQgPyBwcmVGaWx0ZXIgOiBwcmVleGlzdGluZyB8fCBwb3N0RmlsdGVyICkgPwoKCQkJCQkvLyAuLi5pbnRlcm1lZGlhdGUgcHJvY2Vzc2luZyBpcyBuZWNlc3NhcnkKCQkJCQlbXSA6CgoJCQkJCS8vIC4uLm90aGVyd2lzZSB1c2UgcmVzdWx0cyBkaXJlY3RseQoJCQkJCXJlc3VsdHMgOgoJCQkJbWF0Y2hlckluOwoKCQkvLyBGaW5kIHByaW1hcnkgbWF0Y2hlcwoJCWlmICggbWF0Y2hlciApIHsKCQkJbWF0Y2hlciggbWF0Y2hlckluLCBtYXRjaGVyT3V0LCBjb250ZXh0LCB4bWwgKTsKCQl9CgoJCS8vIEFwcGx5IHBvc3RGaWx0ZXIKCQlpZiAoIHBvc3RGaWx0ZXIgKSB7CgkJCXRlbXAgPSBjb25kZW5zZSggbWF0Y2hlck91dCwgcG9zdE1hcCApOwoJCQlwb3N0RmlsdGVyKCB0ZW1wLCBbXSwgY29udGV4dCwgeG1sICk7CgoJCQkvLyBVbi1tYXRjaCBmYWlsaW5nIGVsZW1lbnRzIGJ5IG1vdmluZyB0aGVtIGJhY2sgdG8gbWF0Y2hlckluCgkJCWkgPSB0ZW1wLmxlbmd0aDsKCQkJd2hpbGUgKCBpLS0gKSB7CgkJCQlpZiAoIChlbGVtID0gdGVtcFtpXSkgKSB7CgkJCQkJbWF0Y2hlck91dFsgcG9zdE1hcFtpXSBdID0gIShtYXRjaGVySW5bIHBvc3RNYXBbaV0gXSA9IGVsZW0pOwoJCQkJfQoJCQl9CgkJfQoKCQlpZiAoIHNlZWQgKSB7CgkJCWlmICggcG9zdEZpbmRlciB8fCBwcmVGaWx0ZXIgKSB7CgkJCQlpZiAoIHBvc3RGaW5kZXIgKSB7CgkJCQkJLy8gR2V0IHRoZSBmaW5hbCBtYXRjaGVyT3V0IGJ5IGNvbmRlbnNpbmcgdGhpcyBpbnRlcm1lZGlhdGUgaW50byBwb3N0RmluZGVyIGNvbnRleHRzCgkJCQkJdGVtcCA9IFtdOwoJCQkJCWkgPSBtYXRjaGVyT3V0Lmxlbmd0aDsKCQkJCQl3aGlsZSAoIGktLSApIHsKCQkJCQkJaWYgKCAoZWxlbSA9IG1hdGNoZXJPdXRbaV0pICkgewoJCQkJCQkJLy8gUmVzdG9yZSBtYXRjaGVySW4gc2luY2UgZWxlbSBpcyBub3QgeWV0IGEgZmluYWwgbWF0Y2gKCQkJCQkJCXRlbXAucHVzaCggKG1hdGNoZXJJbltpXSA9IGVsZW0pICk7CgkJCQkJCX0KCQkJCQl9CgkJCQkJcG9zdEZpbmRlciggbnVsbCwgKG1hdGNoZXJPdXQgPSBbXSksIHRlbXAsIHhtbCApOwoJCQkJfQoKCQkJCS8vIE1vdmUgbWF0Y2hlZCBlbGVtZW50cyBmcm9tIHNlZWQgdG8gcmVzdWx0cyB0byBrZWVwIHRoZW0gc3luY2hyb25pemVkCgkJCQlpID0gbWF0Y2hlck91dC5sZW5ndGg7CgkJCQl3aGlsZSAoIGktLSApIHsKCQkJCQlpZiAoIChlbGVtID0gbWF0Y2hlck91dFtpXSkgJiYKCQkJCQkJKHRlbXAgPSBwb3N0RmluZGVyID8gaW5kZXhPZi5jYWxsKCBzZWVkLCBlbGVtICkgOiBwcmVNYXBbaV0pID4gLTEgKSB7CgoJCQkJCQlzZWVkW3RlbXBdID0gIShyZXN1bHRzW3RlbXBdID0gZWxlbSk7CgkJCQkJfQoJCQkJfQoJCQl9CgoJCS8vIEFkZCBlbGVtZW50cyB0byByZXN1bHRzLCB0aHJvdWdoIHBvc3RGaW5kZXIgaWYgZGVmaW5lZAoJCX0gZWxzZSB7CgkJCW1hdGNoZXJPdXQgPSBjb25kZW5zZSgKCQkJCW1hdGNoZXJPdXQgPT09IHJlc3VsdHMgPwoJCQkJCW1hdGNoZXJPdXQuc3BsaWNlKCBwcmVleGlzdGluZywgbWF0Y2hlck91dC5sZW5ndGggKSA6CgkJCQkJbWF0Y2hlck91dAoJCQkpOwoJCQlpZiAoIHBvc3RGaW5kZXIgKSB7CgkJCQlwb3N0RmluZGVyKCBudWxsLCByZXN1bHRzLCBtYXRjaGVyT3V0LCB4bWwgKTsKCQkJfSBlbHNlIHsKCQkJCXB1c2guYXBwbHkoIHJlc3VsdHMsIG1hdGNoZXJPdXQgKTsKCQkJfQoJCX0KCX0pOwp9CgpmdW5jdGlvbiBtYXRjaGVyRnJvbVRva2VucyggdG9rZW5zICkgewoJdmFyIGNoZWNrQ29udGV4dCwgbWF0Y2hlciwgaiwKCQlsZW4gPSB0b2tlbnMubGVuZ3RoLAoJCWxlYWRpbmdSZWxhdGl2ZSA9IEV4cHIucmVsYXRpdmVbIHRva2Vuc1swXS50eXBlIF0sCgkJaW1wbGljaXRSZWxhdGl2ZSA9IGxlYWRpbmdSZWxhdGl2ZSB8fCBFeHByLnJlbGF0aXZlWyIgIl0sCgkJaSA9IGxlYWRpbmdSZWxhdGl2ZSA/IDEgOiAwLAoKCQkvLyBUaGUgZm91bmRhdGlvbmFsIG1hdGNoZXIgZW5zdXJlcyB0aGF0IGVsZW1lbnRzIGFyZSByZWFjaGFibGUgZnJvbSB0b3AtbGV2ZWwgY29udGV4dChzKQoJCW1hdGNoQ29udGV4dCA9IGFkZENvbWJpbmF0b3IoIGZ1bmN0aW9uKCBlbGVtICkgewoJCQlyZXR1cm4gZWxlbSA9PT0gY2hlY2tDb250ZXh0OwoJCX0sIGltcGxpY2l0UmVsYXRpdmUsIHRydWUgKSwKCQltYXRjaEFueUNvbnRleHQgPSBhZGRDb21iaW5hdG9yKCBmdW5jdGlvbiggZWxlbSApIHsKCQkJcmV0dXJuIGluZGV4T2YuY2FsbCggY2hlY2tDb250ZXh0LCBlbGVtICkgPiAtMTsKCQl9LCBpbXBsaWNpdFJlbGF0aXZlLCB0cnVlICksCgkJbWF0Y2hlcnMgPSBbIGZ1bmN0aW9uKCBlbGVtLCBjb250ZXh0LCB4bWwgKSB7CgkJCXJldHVybiAoICFsZWFkaW5nUmVsYXRpdmUgJiYgKCB4bWwgfHwgY29udGV4dCAhPT0gb3V0ZXJtb3N0Q29udGV4dCApICkgfHwgKAoJCQkJKGNoZWNrQ29udGV4dCA9IGNvbnRleHQpLm5vZGVUeXBlID8KCQkJCQltYXRjaENvbnRleHQoIGVsZW0sIGNvbnRleHQsIHhtbCApIDoKCQkJCQltYXRjaEFueUNvbnRleHQoIGVsZW0sIGNvbnRleHQsIHhtbCApICk7CgkJfSBdOwoKCWZvciAoIDsgaSA8IGxlbjsgaSsrICkgewoJCWlmICggKG1hdGNoZXIgPSBFeHByLnJlbGF0aXZlWyB0b2tlbnNbaV0udHlwZSBdKSApIHsKCQkJbWF0Y2hlcnMgPSBbIGFkZENvbWJpbmF0b3IoZWxlbWVudE1hdGNoZXIoIG1hdGNoZXJzICksIG1hdGNoZXIpIF07CgkJfSBlbHNlIHsKCQkJbWF0Y2hlciA9IEV4cHIuZmlsdGVyWyB0b2tlbnNbaV0udHlwZSBdLmFwcGx5KCBudWxsLCB0b2tlbnNbaV0ubWF0Y2hlcyApOwoKCQkJLy8gUmV0dXJuIHNwZWNpYWwgdXBvbiBzZWVpbmcgYSBwb3NpdGlvbmFsIG1hdGNoZXIKCQkJaWYgKCBtYXRjaGVyWyBleHBhbmRvIF0gKSB7CgkJCQkvLyBGaW5kIHRoZSBuZXh0IHJlbGF0aXZlIG9wZXJhdG9yIChpZiBhbnkpIGZvciBwcm9wZXIgaGFuZGxpbmcKCQkJCWogPSArK2k7CgkJCQlmb3IgKCA7IGogPCBsZW47IGorKyApIHsKCQkJCQlpZiAoIEV4cHIucmVsYXRpdmVbIHRva2Vuc1tqXS50eXBlIF0gKSB7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCQkJCX0KCQkJCXJldHVybiBzZXRNYXRjaGVyKAoJCQkJCWkgPiAxICYmIGVsZW1lbnRNYXRjaGVyKCBtYXRjaGVycyApLAoJCQkJCWkgPiAxICYmIHRvU2VsZWN0b3IoIHRva2Vucy5zbGljZSggMCwgaSAtIDEgKSApLnJlcGxhY2UoIHJ0cmltLCAiJDEiICksCgkJCQkJbWF0Y2hlciwKCQkJCQlpIDwgaiAmJiBtYXRjaGVyRnJvbVRva2VucyggdG9rZW5zLnNsaWNlKCBpLCBqICkgKSwKCQkJCQlqIDwgbGVuICYmIG1hdGNoZXJGcm9tVG9rZW5zKCAodG9rZW5zID0gdG9rZW5zLnNsaWNlKCBqICkpICksCgkJCQkJaiA8IGxlbiAmJiB0b1NlbGVjdG9yKCB0b2tlbnMgKQoJCQkJKTsKCQkJfQoJCQltYXRjaGVycy5wdXNoKCBtYXRjaGVyICk7CgkJfQoJfQoKCXJldHVybiBlbGVtZW50TWF0Y2hlciggbWF0Y2hlcnMgKTsKfQoKZnVuY3Rpb24gbWF0Y2hlckZyb21Hcm91cE1hdGNoZXJzKCBlbGVtZW50TWF0Y2hlcnMsIHNldE1hdGNoZXJzICkgewoJLy8gQSBjb3VudGVyIHRvIHNwZWNpZnkgd2hpY2ggZWxlbWVudCBpcyBjdXJyZW50bHkgYmVpbmcgbWF0Y2hlZAoJdmFyIG1hdGNoZXJDYWNoZWRSdW5zID0gMCwKCQlieVNldCA9IHNldE1hdGNoZXJzLmxlbmd0aCA+IDAsCgkJYnlFbGVtZW50ID0gZWxlbWVudE1hdGNoZXJzLmxlbmd0aCA+IDAsCgkJc3VwZXJNYXRjaGVyID0gZnVuY3Rpb24oIHNlZWQsIGNvbnRleHQsIHhtbCwgcmVzdWx0cywgZXhwYW5kQ29udGV4dCApIHsKCQkJdmFyIGVsZW0sIGosIG1hdGNoZXIsCgkJCQlzZXRNYXRjaGVkID0gW10sCgkJCQltYXRjaGVkQ291bnQgPSAwLAoJCQkJaSA9ICIwIiwKCQkJCXVubWF0Y2hlZCA9IHNlZWQgJiYgW10sCgkJCQlvdXRlcm1vc3QgPSBleHBhbmRDb250ZXh0ICE9IG51bGwsCgkJCQljb250ZXh0QmFja3VwID0gb3V0ZXJtb3N0Q29udGV4dCwKCQkJCS8vIFdlIG11c3QgYWx3YXlzIGhhdmUgZWl0aGVyIHNlZWQgZWxlbWVudHMgb3IgY29udGV4dAoJCQkJZWxlbXMgPSBzZWVkIHx8IGJ5RWxlbWVudCAmJiBFeHByLmZpbmRbIlRBRyJdKCAiKiIsIGV4cGFuZENvbnRleHQgJiYgY29udGV4dC5wYXJlbnROb2RlIHx8IGNvbnRleHQgKSwKCQkJCS8vIFVzZSBpbnRlZ2VyIGRpcnJ1bnMgaWZmIHRoaXMgaXMgdGhlIG91dGVybW9zdCBtYXRjaGVyCgkJCQlkaXJydW5zVW5pcXVlID0gKGRpcnJ1bnMgKz0gY29udGV4dEJhY2t1cCA9PSBudWxsID8gMSA6IE1hdGgucmFuZG9tKCkgfHwgMC4xKTsKCgkJCWlmICggb3V0ZXJtb3N0ICkgewoJCQkJb3V0ZXJtb3N0Q29udGV4dCA9IGNvbnRleHQgIT09IGRvY3VtZW50ICYmIGNvbnRleHQ7CgkJCQljYWNoZWRydW5zID0gbWF0Y2hlckNhY2hlZFJ1bnM7CgkJCX0KCgkJCS8vIEFkZCBlbGVtZW50cyBwYXNzaW5nIGVsZW1lbnRNYXRjaGVycyBkaXJlY3RseSB0byByZXN1bHRzCgkJCS8vIEtlZXAgYGlgIGEgc3RyaW5nIGlmIHRoZXJlIGFyZSBubyBlbGVtZW50cyBzbyBgbWF0Y2hlZENvdW50YCB3aWxsIGJlICIwMCIgYmVsb3cKCQkJZm9yICggOyAoZWxlbSA9IGVsZW1zW2ldKSAhPSBudWxsOyBpKysgKSB7CgkJCQlpZiAoIGJ5RWxlbWVudCAmJiBlbGVtICkgewoJCQkJCWogPSAwOwoJCQkJCXdoaWxlICggKG1hdGNoZXIgPSBlbGVtZW50TWF0Y2hlcnNbaisrXSkgKSB7CgkJCQkJCWlmICggbWF0Y2hlciggZWxlbSwgY29udGV4dCwgeG1sICkgKSB7CgkJCQkJCQlyZXN1bHRzLnB1c2goIGVsZW0gKTsKCQkJCQkJCWJyZWFrOwoJCQkJCQl9CgkJCQkJfQoJCQkJCWlmICggb3V0ZXJtb3N0ICkgewoJCQkJCQlkaXJydW5zID0gZGlycnVuc1VuaXF1ZTsKCQkJCQkJY2FjaGVkcnVucyA9ICsrbWF0Y2hlckNhY2hlZFJ1bnM7CgkJCQkJfQoJCQkJfQoKCQkJCS8vIFRyYWNrIHVubWF0Y2hlZCBlbGVtZW50cyBmb3Igc2V0IGZpbHRlcnMKCQkJCWlmICggYnlTZXQgKSB7CgkJCQkJLy8gVGhleSB3aWxsIGhhdmUgZ29uZSB0aHJvdWdoIGFsbCBwb3NzaWJsZSBtYXRjaGVycwoJCQkJCWlmICggKGVsZW0gPSAhbWF0Y2hlciAmJiBlbGVtKSApIHsKCQkJCQkJbWF0Y2hlZENvdW50LS07CgkJCQkJfQoKCQkJCQkvLyBMZW5ndGhlbiB0aGUgYXJyYXkgZm9yIGV2ZXJ5IGVsZW1lbnQsIG1hdGNoZWQgb3Igbm90CgkJCQkJaWYgKCBzZWVkICkgewoJCQkJCQl1bm1hdGNoZWQucHVzaCggZWxlbSApOwoJCQkJCX0KCQkJCX0KCQkJfQoKCQkJLy8gQXBwbHkgc2V0IGZpbHRlcnMgdG8gdW5tYXRjaGVkIGVsZW1lbnRzCgkJCW1hdGNoZWRDb3VudCArPSBpOwoJCQlpZiAoIGJ5U2V0ICYmIGkgIT09IG1hdGNoZWRDb3VudCApIHsKCQkJCWogPSAwOwoJCQkJd2hpbGUgKCAobWF0Y2hlciA9IHNldE1hdGNoZXJzW2orK10pICkgewoJCQkJCW1hdGNoZXIoIHVubWF0Y2hlZCwgc2V0TWF0Y2hlZCwgY29udGV4dCwgeG1sICk7CgkJCQl9CgoJCQkJaWYgKCBzZWVkICkgewoJCQkJCS8vIFJlaW50ZWdyYXRlIGVsZW1lbnQgbWF0Y2hlcyB0byBlbGltaW5hdGUgdGhlIG5lZWQgZm9yIHNvcnRpbmcKCQkJCQlpZiAoIG1hdGNoZWRDb3VudCA+IDAgKSB7CgkJCQkJCXdoaWxlICggaS0tICkgewoJCQkJCQkJaWYgKCAhKHVubWF0Y2hlZFtpXSB8fCBzZXRNYXRjaGVkW2ldKSApIHsKCQkJCQkJCQlzZXRNYXRjaGVkW2ldID0gcG9wLmNhbGwoIHJlc3VsdHMgKTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCgkJCQkJLy8gRGlzY2FyZCBpbmRleCBwbGFjZWhvbGRlciB2YWx1ZXMgdG8gZ2V0IG9ubHkgYWN0dWFsIG1hdGNoZXMKCQkJCQlzZXRNYXRjaGVkID0gY29uZGVuc2UoIHNldE1hdGNoZWQgKTsKCQkJCX0KCgkJCQkvLyBBZGQgbWF0Y2hlcyB0byByZXN1bHRzCgkJCQlwdXNoLmFwcGx5KCByZXN1bHRzLCBzZXRNYXRjaGVkICk7CgoJCQkJLy8gU2VlZGxlc3Mgc2V0IG1hdGNoZXMgc3VjY2VlZGluZyBtdWx0aXBsZSBzdWNjZXNzZnVsIG1hdGNoZXJzIHN0aXB1bGF0ZSBzb3J0aW5nCgkJCQlpZiAoIG91dGVybW9zdCAmJiAhc2VlZCAmJiBzZXRNYXRjaGVkLmxlbmd0aCA+IDAgJiYKCQkJCQkoIG1hdGNoZWRDb3VudCArIHNldE1hdGNoZXJzLmxlbmd0aCApID4gMSApIHsKCgkJCQkJU2l6emxlLnVuaXF1ZVNvcnQoIHJlc3VsdHMgKTsKCQkJCX0KCQkJfQoKCQkJLy8gT3ZlcnJpZGUgbWFuaXB1bGF0aW9uIG9mIGdsb2JhbHMgYnkgbmVzdGVkIG1hdGNoZXJzCgkJCWlmICggb3V0ZXJtb3N0ICkgewoJCQkJZGlycnVucyA9IGRpcnJ1bnNVbmlxdWU7CgkJCQlvdXRlcm1vc3RDb250ZXh0ID0gY29udGV4dEJhY2t1cDsKCQkJfQoKCQkJcmV0dXJuIHVubWF0Y2hlZDsKCQl9OwoKCXJldHVybiBieVNldCA/CgkJbWFya0Z1bmN0aW9uKCBzdXBlck1hdGNoZXIgKSA6CgkJc3VwZXJNYXRjaGVyOwp9Cgpjb21waWxlID0gU2l6emxlLmNvbXBpbGUgPSBmdW5jdGlvbiggc2VsZWN0b3IsIGdyb3VwIC8qIEludGVybmFsIFVzZSBPbmx5ICovICkgewoJdmFyIGksCgkJc2V0TWF0Y2hlcnMgPSBbXSwKCQllbGVtZW50TWF0Y2hlcnMgPSBbXSwKCQljYWNoZWQgPSBjb21waWxlckNhY2hlWyBzZWxlY3RvciArICIgIiBdOwoKCWlmICggIWNhY2hlZCApIHsKCQkvLyBHZW5lcmF0ZSBhIGZ1bmN0aW9uIG9mIHJlY3Vyc2l2ZSBmdW5jdGlvbnMgdGhhdCBjYW4gYmUgdXNlZCB0byBjaGVjayBlYWNoIGVsZW1lbnQKCQlpZiAoICFncm91cCApIHsKCQkJZ3JvdXAgPSB0b2tlbml6ZSggc2VsZWN0b3IgKTsKCQl9CgkJaSA9IGdyb3VwLmxlbmd0aDsKCQl3aGlsZSAoIGktLSApIHsKCQkJY2FjaGVkID0gbWF0Y2hlckZyb21Ub2tlbnMoIGdyb3VwW2ldICk7CgkJCWlmICggY2FjaGVkWyBleHBhbmRvIF0gKSB7CgkJCQlzZXRNYXRjaGVycy5wdXNoKCBjYWNoZWQgKTsKCQkJfSBlbHNlIHsKCQkJCWVsZW1lbnRNYXRjaGVycy5wdXNoKCBjYWNoZWQgKTsKCQkJfQoJCX0KCgkJLy8gQ2FjaGUgdGhlIGNvbXBpbGVkIGZ1bmN0aW9uCgkJY2FjaGVkID0gY29tcGlsZXJDYWNoZSggc2VsZWN0b3IsIG1hdGNoZXJGcm9tR3JvdXBNYXRjaGVycyggZWxlbWVudE1hdGNoZXJzLCBzZXRNYXRjaGVycyApICk7Cgl9CglyZXR1cm4gY2FjaGVkOwp9OwoKZnVuY3Rpb24gbXVsdGlwbGVDb250ZXh0cyggc2VsZWN0b3IsIGNvbnRleHRzLCByZXN1bHRzICkgewoJdmFyIGkgPSAwLAoJCWxlbiA9IGNvbnRleHRzLmxlbmd0aDsKCWZvciAoIDsgaSA8IGxlbjsgaSsrICkgewoJCVNpenpsZSggc2VsZWN0b3IsIGNvbnRleHRzW2ldLCByZXN1bHRzICk7Cgl9CglyZXR1cm4gcmVzdWx0czsKfQoKZnVuY3Rpb24gc2VsZWN0KCBzZWxlY3RvciwgY29udGV4dCwgcmVzdWx0cywgc2VlZCApIHsKCXZhciBpLCB0b2tlbnMsIHRva2VuLCB0eXBlLCBmaW5kLAoJCW1hdGNoID0gdG9rZW5pemUoIHNlbGVjdG9yICk7CgoJaWYgKCAhc2VlZCApIHsKCQkvLyBUcnkgdG8gbWluaW1pemUgb3BlcmF0aW9ucyBpZiB0aGVyZSBpcyBvbmx5IG9uZSBncm91cAoJCWlmICggbWF0Y2gubGVuZ3RoID09PSAxICkgewoKCQkJLy8gVGFrZSBhIHNob3J0Y3V0IGFuZCBzZXQgdGhlIGNvbnRleHQgaWYgdGhlIHJvb3Qgc2VsZWN0b3IgaXMgYW4gSUQKCQkJdG9rZW5zID0gbWF0Y2hbMF0gPSBtYXRjaFswXS5zbGljZSggMCApOwoJCQlpZiAoIHRva2Vucy5sZW5ndGggPiAyICYmICh0b2tlbiA9IHRva2Vuc1swXSkudHlwZSA9PT0gIklEIiAmJgoJCQkJCWNvbnRleHQubm9kZVR5cGUgPT09IDkgJiYgIWRvY3VtZW50SXNYTUwgJiYKCQkJCQlFeHByLnJlbGF0aXZlWyB0b2tlbnNbMV0udHlwZSBdICkgewoKCQkJCWNvbnRleHQgPSBFeHByLmZpbmRbIklEIl0oIHRva2VuLm1hdGNoZXNbMF0ucmVwbGFjZSggcnVuZXNjYXBlLCBmdW5lc2NhcGUgKSwgY29udGV4dCApWzBdOwoJCQkJaWYgKCAhY29udGV4dCApIHsKCQkJCQlyZXR1cm4gcmVzdWx0czsKCQkJCX0KCgkJCQlzZWxlY3RvciA9IHNlbGVjdG9yLnNsaWNlKCB0b2tlbnMuc2hpZnQoKS52YWx1ZS5sZW5ndGggKTsKCQkJfQoKCQkJLy8gRmV0Y2ggYSBzZWVkIHNldCBmb3IgcmlnaHQtdG8tbGVmdCBtYXRjaGluZwoJCQlpID0gbWF0Y2hFeHByWyJuZWVkc0NvbnRleHQiXS50ZXN0KCBzZWxlY3RvciApID8gMCA6IHRva2Vucy5sZW5ndGg7CgkJCXdoaWxlICggaS0tICkgewoJCQkJdG9rZW4gPSB0b2tlbnNbaV07CgoJCQkJLy8gQWJvcnQgaWYgd2UgaGl0IGEgY29tYmluYXRvcgoJCQkJaWYgKCBFeHByLnJlbGF0aXZlWyAodHlwZSA9IHRva2VuLnR5cGUpIF0gKSB7CgkJCQkJYnJlYWs7CgkJCQl9CgkJCQlpZiAoIChmaW5kID0gRXhwci5maW5kWyB0eXBlIF0pICkgewoJCQkJCS8vIFNlYXJjaCwgZXhwYW5kaW5nIGNvbnRleHQgZm9yIGxlYWRpbmcgc2libGluZyBjb21iaW5hdG9ycwoJCQkJCWlmICggKHNlZWQgPSBmaW5kKAoJCQkJCQl0b2tlbi5tYXRjaGVzWzBdLnJlcGxhY2UoIHJ1bmVzY2FwZSwgZnVuZXNjYXBlICksCgkJCQkJCXJzaWJsaW5nLnRlc3QoIHRva2Vuc1swXS50eXBlICkgJiYgY29udGV4dC5wYXJlbnROb2RlIHx8IGNvbnRleHQKCQkJCQkpKSApIHsKCgkJCQkJCS8vIElmIHNlZWQgaXMgZW1wdHkgb3Igbm8gdG9rZW5zIHJlbWFpbiwgd2UgY2FuIHJldHVybiBlYXJseQoJCQkJCQl0b2tlbnMuc3BsaWNlKCBpLCAxICk7CgkJCQkJCXNlbGVjdG9yID0gc2VlZC5sZW5ndGggJiYgdG9TZWxlY3RvciggdG9rZW5zICk7CgkJCQkJCWlmICggIXNlbGVjdG9yICkgewoJCQkJCQkJcHVzaC5hcHBseSggcmVzdWx0cywgc2xpY2UuY2FsbCggc2VlZCwgMCApICk7CgkJCQkJCQlyZXR1cm4gcmVzdWx0czsKCQkJCQkJfQoKCQkJCQkJYnJlYWs7CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoJfQoKCS8vIENvbXBpbGUgYW5kIGV4ZWN1dGUgYSBmaWx0ZXJpbmcgZnVuY3Rpb24KCS8vIFByb3ZpZGUgYG1hdGNoYCB0byBhdm9pZCByZXRva2VuaXphdGlvbiBpZiB3ZSBtb2RpZmllZCB0aGUgc2VsZWN0b3IgYWJvdmUKCWNvbXBpbGUoIHNlbGVjdG9yLCBtYXRjaCApKAoJCXNlZWQsCgkJY29udGV4dCwKCQlkb2N1bWVudElzWE1MLAoJCXJlc3VsdHMsCgkJcnNpYmxpbmcudGVzdCggc2VsZWN0b3IgKQoJKTsKCXJldHVybiByZXN1bHRzOwp9CgovLyBEZXByZWNhdGVkCkV4cHIucHNldWRvc1sibnRoIl0gPSBFeHByLnBzZXVkb3NbImVxIl07CgovLyBFYXN5IEFQSSBmb3IgY3JlYXRpbmcgbmV3IHNldEZpbHRlcnMKZnVuY3Rpb24gc2V0RmlsdGVycygpIHt9CkV4cHIuZmlsdGVycyA9IHNldEZpbHRlcnMucHJvdG90eXBlID0gRXhwci5wc2V1ZG9zOwpFeHByLnNldEZpbHRlcnMgPSBuZXcgc2V0RmlsdGVycygpOwoKLy8gSW5pdGlhbGl6ZSB3aXRoIHRoZSBkZWZhdWx0IGRvY3VtZW50CnNldERvY3VtZW50KCk7CgovLyBPdmVycmlkZSBzaXp6bGUgYXR0cmlidXRlIHJldHJpZXZhbApTaXp6bGUuYXR0ciA9IGpRdWVyeS5hdHRyOwpqUXVlcnkuZmluZCA9IFNpenpsZTsKalF1ZXJ5LmV4cHIgPSBTaXp6bGUuc2VsZWN0b3JzOwpqUXVlcnkuZXhwclsiOiJdID0galF1ZXJ5LmV4cHIucHNldWRvczsKalF1ZXJ5LnVuaXF1ZSA9IFNpenpsZS51bmlxdWVTb3J0OwpqUXVlcnkudGV4dCA9IFNpenpsZS5nZXRUZXh0OwpqUXVlcnkuaXNYTUxEb2MgPSBTaXp6bGUuaXNYTUw7CmpRdWVyeS5jb250YWlucyA9IFNpenpsZS5jb250YWluczsKCgp9KSggd2luZG93ICk7CnZhciBydW50aWwgPSAvVW50aWwkLywKCXJwYXJlbnRzcHJldiA9IC9eKD86cGFyZW50c3xwcmV2KD86VW50aWx8QWxsKSkvLAoJaXNTaW1wbGUgPSAvXi5bXjojXFtcLixdKiQvLAoJcm5lZWRzQ29udGV4dCA9IGpRdWVyeS5leHByLm1hdGNoLm5lZWRzQ29udGV4dCwKCS8vIG1ldGhvZHMgZ3VhcmFudGVlZCB0byBwcm9kdWNlIGEgdW5pcXVlIHNldCB3aGVuIHN0YXJ0aW5nIGZyb20gYSB1bmlxdWUgc2V0CglndWFyYW50ZWVkVW5pcXVlID0gewoJCWNoaWxkcmVuOiB0cnVlLAoJCWNvbnRlbnRzOiB0cnVlLAoJCW5leHQ6IHRydWUsCgkJcHJldjogdHJ1ZQoJfTsKCmpRdWVyeS5mbi5leHRlbmQoewoJZmluZDogZnVuY3Rpb24oIHNlbGVjdG9yICkgewoJCXZhciBpLCByZXQsIHNlbGYsCgkJCWxlbiA9IHRoaXMubGVuZ3RoOwoKCQlpZiAoIHR5cGVvZiBzZWxlY3RvciAhPT0gInN0cmluZyIgKSB7CgkJCXNlbGYgPSB0aGlzOwoJCQlyZXR1cm4gdGhpcy5wdXNoU3RhY2soIGpRdWVyeSggc2VsZWN0b3IgKS5maWx0ZXIoZnVuY3Rpb24oKSB7CgkJCQlmb3IgKCBpID0gMDsgaSA8IGxlbjsgaSsrICkgewoJCQkJCWlmICggalF1ZXJ5LmNvbnRhaW5zKCBzZWxmWyBpIF0sIHRoaXMgKSApIHsKCQkJCQkJcmV0dXJuIHRydWU7CgkJCQkJfQoJCQkJfQoJCQl9KSApOwoJCX0KCgkJcmV0ID0gW107CgkJZm9yICggaSA9IDA7IGkgPCBsZW47IGkrKyApIHsKCQkJalF1ZXJ5LmZpbmQoIHNlbGVjdG9yLCB0aGlzWyBpIF0sIHJldCApOwoJCX0KCgkJLy8gTmVlZGVkIGJlY2F1c2UgJCggc2VsZWN0b3IsIGNvbnRleHQgKSBiZWNvbWVzICQoIGNvbnRleHQgKS5maW5kKCBzZWxlY3RvciApCgkJcmV0ID0gdGhpcy5wdXNoU3RhY2soIGxlbiA+IDEgPyBqUXVlcnkudW5pcXVlKCByZXQgKSA6IHJldCApOwoJCXJldC5zZWxlY3RvciA9ICggdGhpcy5zZWxlY3RvciA/IHRoaXMuc2VsZWN0b3IgKyAiICIgOiAiIiApICsgc2VsZWN0b3I7CgkJcmV0dXJuIHJldDsKCX0sCgoJaGFzOiBmdW5jdGlvbiggdGFyZ2V0ICkgewoJCXZhciBpLAoJCQl0YXJnZXRzID0galF1ZXJ5KCB0YXJnZXQsIHRoaXMgKSwKCQkJbGVuID0gdGFyZ2V0cy5sZW5ndGg7CgoJCXJldHVybiB0aGlzLmZpbHRlcihmdW5jdGlvbigpIHsKCQkJZm9yICggaSA9IDA7IGkgPCBsZW47IGkrKyApIHsKCQkJCWlmICggalF1ZXJ5LmNvbnRhaW5zKCB0aGlzLCB0YXJnZXRzW2ldICkgKSB7CgkJCQkJcmV0dXJuIHRydWU7CgkJCQl9CgkJCX0KCQl9KTsKCX0sCgoJbm90OiBmdW5jdGlvbiggc2VsZWN0b3IgKSB7CgkJcmV0dXJuIHRoaXMucHVzaFN0YWNrKCB3aW5ub3codGhpcywgc2VsZWN0b3IsIGZhbHNlKSApOwoJfSwKCglmaWx0ZXI6IGZ1bmN0aW9uKCBzZWxlY3RvciApIHsKCQlyZXR1cm4gdGhpcy5wdXNoU3RhY2soIHdpbm5vdyh0aGlzLCBzZWxlY3RvciwgdHJ1ZSkgKTsKCX0sCgoJaXM6IGZ1bmN0aW9uKCBzZWxlY3RvciApIHsKCQlyZXR1cm4gISFzZWxlY3RvciAmJiAoCgkJCXR5cGVvZiBzZWxlY3RvciA9PT0gInN0cmluZyIgPwoJCQkJLy8gSWYgdGhpcyBpcyBhIHBvc2l0aW9uYWwvcmVsYXRpdmUgc2VsZWN0b3IsIGNoZWNrIG1lbWJlcnNoaXAgaW4gdGhlIHJldHVybmVkIHNldAoJCQkJLy8gc28gJCgicDpmaXJzdCIpLmlzKCJwOmxhc3QiKSB3b24ndCByZXR1cm4gdHJ1ZSBmb3IgYSBkb2Mgd2l0aCB0d28gInAiLgoJCQkJcm5lZWRzQ29udGV4dC50ZXN0KCBzZWxlY3RvciApID8KCQkJCQlqUXVlcnkoIHNlbGVjdG9yLCB0aGlzLmNvbnRleHQgKS5pbmRleCggdGhpc1swXSApID49IDAgOgoJCQkJCWpRdWVyeS5maWx0ZXIoIHNlbGVjdG9yLCB0aGlzICkubGVuZ3RoID4gMCA6CgkJCQl0aGlzLmZpbHRlciggc2VsZWN0b3IgKS5sZW5ndGggPiAwICk7Cgl9LAoKCWNsb3Nlc3Q6IGZ1bmN0aW9uKCBzZWxlY3RvcnMsIGNvbnRleHQgKSB7CgkJdmFyIGN1ciwKCQkJaSA9IDAsCgkJCWwgPSB0aGlzLmxlbmd0aCwKCQkJcmV0ID0gW10sCgkJCXBvcyA9IHJuZWVkc0NvbnRleHQudGVzdCggc2VsZWN0b3JzICkgfHwgdHlwZW9mIHNlbGVjdG9ycyAhPT0gInN0cmluZyIgPwoJCQkJalF1ZXJ5KCBzZWxlY3RvcnMsIGNvbnRleHQgfHwgdGhpcy5jb250ZXh0ICkgOgoJCQkJMDsKCgkJZm9yICggOyBpIDwgbDsgaSsrICkgewoJCQljdXIgPSB0aGlzW2ldOwoKCQkJd2hpbGUgKCBjdXIgJiYgY3VyLm93bmVyRG9jdW1lbnQgJiYgY3VyICE9PSBjb250ZXh0ICYmIGN1ci5ub2RlVHlwZSAhPT0gMTEgKSB7CgkJCQlpZiAoIHBvcyA/IHBvcy5pbmRleChjdXIpID4gLTEgOiBqUXVlcnkuZmluZC5tYXRjaGVzU2VsZWN0b3IoY3VyLCBzZWxlY3RvcnMpICkgewoJCQkJCXJldC5wdXNoKCBjdXIgKTsKCQkJCQlicmVhazsKCQkJCX0KCQkJCWN1ciA9IGN1ci5wYXJlbnROb2RlOwoJCQl9CgkJfQoKCQlyZXR1cm4gdGhpcy5wdXNoU3RhY2soIHJldC5sZW5ndGggPiAxID8galF1ZXJ5LnVuaXF1ZSggcmV0ICkgOiByZXQgKTsKCX0sCgoJLy8gRGV0ZXJtaW5lIHRoZSBwb3NpdGlvbiBvZiBhbiBlbGVtZW50IHdpdGhpbgoJLy8gdGhlIG1hdGNoZWQgc2V0IG9mIGVsZW1lbnRzCglpbmRleDogZnVuY3Rpb24oIGVsZW0gKSB7CgoJCS8vIE5vIGFyZ3VtZW50LCByZXR1cm4gaW5kZXggaW4gcGFyZW50CgkJaWYgKCAhZWxlbSApIHsKCQkJcmV0dXJuICggdGhpc1swXSAmJiB0aGlzWzBdLnBhcmVudE5vZGUgKSA/IHRoaXMuZmlyc3QoKS5wcmV2QWxsKCkubGVuZ3RoIDogLTE7CgkJfQoKCQkvLyBpbmRleCBpbiBzZWxlY3RvcgoJCWlmICggdHlwZW9mIGVsZW0gPT09ICJzdHJpbmciICkgewoJCQlyZXR1cm4galF1ZXJ5LmluQXJyYXkoIHRoaXNbMF0sIGpRdWVyeSggZWxlbSApICk7CgkJfQoKCQkvLyBMb2NhdGUgdGhlIHBvc2l0aW9uIG9mIHRoZSBkZXNpcmVkIGVsZW1lbnQKCQlyZXR1cm4galF1ZXJ5LmluQXJyYXkoCgkJCS8vIElmIGl0IHJlY2VpdmVzIGEgalF1ZXJ5IG9iamVjdCwgdGhlIGZpcnN0IGVsZW1lbnQgaXMgdXNlZAoJCQllbGVtLmpxdWVyeSA/IGVsZW1bMF0gOiBlbGVtLCB0aGlzICk7Cgl9LAoKCWFkZDogZnVuY3Rpb24oIHNlbGVjdG9yLCBjb250ZXh0ICkgewoJCXZhciBzZXQgPSB0eXBlb2Ygc2VsZWN0b3IgPT09ICJzdHJpbmciID8KCQkJCWpRdWVyeSggc2VsZWN0b3IsIGNvbnRleHQgKSA6CgkJCQlqUXVlcnkubWFrZUFycmF5KCBzZWxlY3RvciAmJiBzZWxlY3Rvci5ub2RlVHlwZSA/IFsgc2VsZWN0b3IgXSA6IHNlbGVjdG9yICksCgkJCWFsbCA9IGpRdWVyeS5tZXJnZSggdGhpcy5nZXQoKSwgc2V0ICk7CgoJCXJldHVybiB0aGlzLnB1c2hTdGFjayggalF1ZXJ5LnVuaXF1ZShhbGwpICk7Cgl9LAoKCWFkZEJhY2s6IGZ1bmN0aW9uKCBzZWxlY3RvciApIHsKCQlyZXR1cm4gdGhpcy5hZGQoIHNlbGVjdG9yID09IG51bGwgPwoJCQl0aGlzLnByZXZPYmplY3QgOiB0aGlzLnByZXZPYmplY3QuZmlsdGVyKHNlbGVjdG9yKQoJCSk7Cgl9Cn0pOwoKalF1ZXJ5LmZuLmFuZFNlbGYgPSBqUXVlcnkuZm4uYWRkQmFjazsKCmZ1bmN0aW9uIHNpYmxpbmcoIGN1ciwgZGlyICkgewoJZG8gewoJCWN1ciA9IGN1clsgZGlyIF07Cgl9IHdoaWxlICggY3VyICYmIGN1ci5ub2RlVHlwZSAhPT0gMSApOwoKCXJldHVybiBjdXI7Cn0KCmpRdWVyeS5lYWNoKHsKCXBhcmVudDogZnVuY3Rpb24oIGVsZW0gKSB7CgkJdmFyIHBhcmVudCA9IGVsZW0ucGFyZW50Tm9kZTsKCQlyZXR1cm4gcGFyZW50ICYmIHBhcmVudC5ub2RlVHlwZSAhPT0gMTEgPyBwYXJlbnQgOiBudWxsOwoJfSwKCXBhcmVudHM6IGZ1bmN0aW9uKCBlbGVtICkgewoJCXJldHVybiBqUXVlcnkuZGlyKCBlbGVtLCAicGFyZW50Tm9kZSIgKTsKCX0sCglwYXJlbnRzVW50aWw6IGZ1bmN0aW9uKCBlbGVtLCBpLCB1bnRpbCApIHsKCQlyZXR1cm4galF1ZXJ5LmRpciggZWxlbSwgInBhcmVudE5vZGUiLCB1bnRpbCApOwoJfSwKCW5leHQ6IGZ1bmN0aW9uKCBlbGVtICkgewoJCXJldHVybiBzaWJsaW5nKCBlbGVtLCAibmV4dFNpYmxpbmciICk7Cgl9LAoJcHJldjogZnVuY3Rpb24oIGVsZW0gKSB7CgkJcmV0dXJuIHNpYmxpbmcoIGVsZW0sICJwcmV2aW91c1NpYmxpbmciICk7Cgl9LAoJbmV4dEFsbDogZnVuY3Rpb24oIGVsZW0gKSB7CgkJcmV0dXJuIGpRdWVyeS5kaXIoIGVsZW0sICJuZXh0U2libGluZyIgKTsKCX0sCglwcmV2QWxsOiBmdW5jdGlvbiggZWxlbSApIHsKCQlyZXR1cm4galF1ZXJ5LmRpciggZWxlbSwgInByZXZpb3VzU2libGluZyIgKTsKCX0sCgluZXh0VW50aWw6IGZ1bmN0aW9uKCBlbGVtLCBpLCB1bnRpbCApIHsKCQlyZXR1cm4galF1ZXJ5LmRpciggZWxlbSwgIm5leHRTaWJsaW5nIiwgdW50aWwgKTsKCX0sCglwcmV2VW50aWw6IGZ1bmN0aW9uKCBlbGVtLCBpLCB1bnRpbCApIHsKCQlyZXR1cm4galF1ZXJ5LmRpciggZWxlbSwgInByZXZpb3VzU2libGluZyIsIHVudGlsICk7Cgl9LAoJc2libGluZ3M6IGZ1bmN0aW9uKCBlbGVtICkgewoJCXJldHVybiBqUXVlcnkuc2libGluZyggKCBlbGVtLnBhcmVudE5vZGUgfHwge30gKS5maXJzdENoaWxkLCBlbGVtICk7Cgl9LAoJY2hpbGRyZW46IGZ1bmN0aW9uKCBlbGVtICkgewoJCXJldHVybiBqUXVlcnkuc2libGluZyggZWxlbS5maXJzdENoaWxkICk7Cgl9LAoJY29udGVudHM6IGZ1bmN0aW9uKCBlbGVtICkgewoJCXJldHVybiBqUXVlcnkubm9kZU5hbWUoIGVsZW0sICJpZnJhbWUiICkgPwoJCQllbGVtLmNvbnRlbnREb2N1bWVudCB8fCBlbGVtLmNvbnRlbnRXaW5kb3cuZG9jdW1lbnQgOgoJCQlqUXVlcnkubWVyZ2UoIFtdLCBlbGVtLmNoaWxkTm9kZXMgKTsKCX0KfSwgZnVuY3Rpb24oIG5hbWUsIGZuICkgewoJalF1ZXJ5LmZuWyBuYW1lIF0gPSBmdW5jdGlvbiggdW50aWwsIHNlbGVjdG9yICkgewoJCXZhciByZXQgPSBqUXVlcnkubWFwKCB0aGlzLCBmbiwgdW50aWwgKTsKCgkJaWYgKCAhcnVudGlsLnRlc3QoIG5hbWUgKSApIHsKCQkJc2VsZWN0b3IgPSB1bnRpbDsKCQl9CgoJCWlmICggc2VsZWN0b3IgJiYgdHlwZW9mIHNlbGVjdG9yID09PSAic3RyaW5nIiApIHsKCQkJcmV0ID0galF1ZXJ5LmZpbHRlciggc2VsZWN0b3IsIHJldCApOwoJCX0KCgkJcmV0ID0gdGhpcy5sZW5ndGggPiAxICYmICFndWFyYW50ZWVkVW5pcXVlWyBuYW1lIF0gPyBqUXVlcnkudW5pcXVlKCByZXQgKSA6IHJldDsKCgkJaWYgKCB0aGlzLmxlbmd0aCA+IDEgJiYgcnBhcmVudHNwcmV2LnRlc3QoIG5hbWUgKSApIHsKCQkJcmV0ID0gcmV0LnJldmVyc2UoKTsKCQl9CgoJCXJldHVybiB0aGlzLnB1c2hTdGFjayggcmV0ICk7Cgl9Owp9KTsKCmpRdWVyeS5leHRlbmQoewoJZmlsdGVyOiBmdW5jdGlvbiggZXhwciwgZWxlbXMsIG5vdCApIHsKCQlpZiAoIG5vdCApIHsKCQkJZXhwciA9ICI6bm90KCIgKyBleHByICsgIikiOwoJCX0KCgkJcmV0dXJuIGVsZW1zLmxlbmd0aCA9PT0gMSA/CgkJCWpRdWVyeS5maW5kLm1hdGNoZXNTZWxlY3RvcihlbGVtc1swXSwgZXhwcikgPyBbIGVsZW1zWzBdIF0gOiBbXSA6CgkJCWpRdWVyeS5maW5kLm1hdGNoZXMoZXhwciwgZWxlbXMpOwoJfSwKCglkaXI6IGZ1bmN0aW9uKCBlbGVtLCBkaXIsIHVudGlsICkgewoJCXZhciBtYXRjaGVkID0gW10sCgkJCWN1ciA9IGVsZW1bIGRpciBdOwoKCQl3aGlsZSAoIGN1ciAmJiBjdXIubm9kZVR5cGUgIT09IDkgJiYgKHVudGlsID09PSB1bmRlZmluZWQgfHwgY3VyLm5vZGVUeXBlICE9PSAxIHx8ICFqUXVlcnkoIGN1ciApLmlzKCB1bnRpbCApKSApIHsKCQkJaWYgKCBjdXIubm9kZVR5cGUgPT09IDEgKSB7CgkJCQltYXRjaGVkLnB1c2goIGN1ciApOwoJCQl9CgkJCWN1ciA9IGN1cltkaXJdOwoJCX0KCQlyZXR1cm4gbWF0Y2hlZDsKCX0sCgoJc2libGluZzogZnVuY3Rpb24oIG4sIGVsZW0gKSB7CgkJdmFyIHIgPSBbXTsKCgkJZm9yICggOyBuOyBuID0gbi5uZXh0U2libGluZyApIHsKCQkJaWYgKCBuLm5vZGVUeXBlID09PSAxICYmIG4gIT09IGVsZW0gKSB7CgkJCQlyLnB1c2goIG4gKTsKCQkJfQoJCX0KCgkJcmV0dXJuIHI7Cgl9Cn0pOwoKLy8gSW1wbGVtZW50IHRoZSBpZGVudGljYWwgZnVuY3Rpb25hbGl0eSBmb3IgZmlsdGVyIGFuZCBub3QKZnVuY3Rpb24gd2lubm93KCBlbGVtZW50cywgcXVhbGlmaWVyLCBrZWVwICkgewoKCS8vIENhbid0IHBhc3MgbnVsbCBvciB1bmRlZmluZWQgdG8gaW5kZXhPZiBpbiBGaXJlZm94IDQKCS8vIFNldCB0byAwIHRvIHNraXAgc3RyaW5nIGNoZWNrCglxdWFsaWZpZXIgPSBxdWFsaWZpZXIgfHwgMDsKCglpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCBxdWFsaWZpZXIgKSApIHsKCQlyZXR1cm4galF1ZXJ5LmdyZXAoZWxlbWVudHMsIGZ1bmN0aW9uKCBlbGVtLCBpICkgewoJCQl2YXIgcmV0VmFsID0gISFxdWFsaWZpZXIuY2FsbCggZWxlbSwgaSwgZWxlbSApOwoJCQlyZXR1cm4gcmV0VmFsID09PSBrZWVwOwoJCX0pOwoKCX0gZWxzZSBpZiAoIHF1YWxpZmllci5ub2RlVHlwZSApIHsKCQlyZXR1cm4galF1ZXJ5LmdyZXAoZWxlbWVudHMsIGZ1bmN0aW9uKCBlbGVtICkgewoJCQlyZXR1cm4gKCBlbGVtID09PSBxdWFsaWZpZXIgKSA9PT0ga2VlcDsKCQl9KTsKCgl9IGVsc2UgaWYgKCB0eXBlb2YgcXVhbGlmaWVyID09PSAic3RyaW5nIiApIHsKCQl2YXIgZmlsdGVyZWQgPSBqUXVlcnkuZ3JlcChlbGVtZW50cywgZnVuY3Rpb24oIGVsZW0gKSB7CgkJCXJldHVybiBlbGVtLm5vZGVUeXBlID09PSAxOwoJCX0pOwoKCQlpZiAoIGlzU2ltcGxlLnRlc3QoIHF1YWxpZmllciApICkgewoJCQlyZXR1cm4galF1ZXJ5LmZpbHRlcihxdWFsaWZpZXIsIGZpbHRlcmVkLCAha2VlcCk7CgkJfSBlbHNlIHsKCQkJcXVhbGlmaWVyID0galF1ZXJ5LmZpbHRlciggcXVhbGlmaWVyLCBmaWx0ZXJlZCApOwoJCX0KCX0KCglyZXR1cm4galF1ZXJ5LmdyZXAoZWxlbWVudHMsIGZ1bmN0aW9uKCBlbGVtICkgewoJCXJldHVybiAoIGpRdWVyeS5pbkFycmF5KCBlbGVtLCBxdWFsaWZpZXIgKSA+PSAwICkgPT09IGtlZXA7Cgl9KTsKfQpmdW5jdGlvbiBjcmVhdGVTYWZlRnJhZ21lbnQoIGRvY3VtZW50ICkgewoJdmFyIGxpc3QgPSBub2RlTmFtZXMuc3BsaXQoICJ8IiApLAoJCXNhZmVGcmFnID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpOwoKCWlmICggc2FmZUZyYWcuY3JlYXRlRWxlbWVudCApIHsKCQl3aGlsZSAoIGxpc3QubGVuZ3RoICkgewoJCQlzYWZlRnJhZy5jcmVhdGVFbGVtZW50KAoJCQkJbGlzdC5wb3AoKQoJCQkpOwoJCX0KCX0KCXJldHVybiBzYWZlRnJhZzsKfQoKdmFyIG5vZGVOYW1lcyA9ICJhYmJyfGFydGljbGV8YXNpZGV8YXVkaW98YmRpfGNhbnZhc3xkYXRhfGRhdGFsaXN0fGRldGFpbHN8ZmlnY2FwdGlvbnxmaWd1cmV8Zm9vdGVyfCIgKwoJCSJoZWFkZXJ8aGdyb3VwfG1hcmt8bWV0ZXJ8bmF2fG91dHB1dHxwcm9ncmVzc3xzZWN0aW9ufHN1bW1hcnl8dGltZXx2aWRlbyIsCglyaW5saW5lalF1ZXJ5ID0gLyBqUXVlcnlcZCs9Iig/Om51bGx8XGQrKSIvZywKCXJub3NoaW1jYWNoZSA9IG5ldyBSZWdFeHAoIjwoPzoiICsgbm9kZU5hbWVzICsgIilbXFxzLz5dIiwgImkiKSwKCXJsZWFkaW5nV2hpdGVzcGFjZSA9IC9eXHMrLywKCXJ4aHRtbFRhZyA9IC88KD8hYXJlYXxicnxjb2x8ZW1iZWR8aHJ8aW1nfGlucHV0fGxpbmt8bWV0YXxwYXJhbSkoKFtcdzpdKylbXj5dKilcLz4vZ2ksCglydGFnTmFtZSA9IC88KFtcdzpdKykvLAoJcnRib2R5ID0gLzx0Ym9keS9pLAoJcmh0bWwgPSAvPHwmIz9cdys7LywKCXJub0lubmVyaHRtbCA9IC88KD86c2NyaXB0fHN0eWxlfGxpbmspL2ksCgltYW5pcHVsYXRpb25fcmNoZWNrYWJsZVR5cGUgPSAvXig/OmNoZWNrYm94fHJhZGlvKSQvaSwKCS8vIGNoZWNrZWQ9ImNoZWNrZWQiIG9yIGNoZWNrZWQKCXJjaGVja2VkID0gL2NoZWNrZWRccyooPzpbXj1dfD1ccyouY2hlY2tlZC4pL2ksCglyc2NyaXB0VHlwZSA9IC9eJHxcLyg/OmphdmF8ZWNtYSlzY3JpcHQvaSwKCXJzY3JpcHRUeXBlTWFza2VkID0gL150cnVlXC8oLiopLywKCXJjbGVhblNjcmlwdCA9IC9eXHMqPCEoPzpcW0NEQVRBXFt8LS0pfCg/OlxdXF18LS0pPlxzKiQvZywKCgkvLyBXZSBoYXZlIHRvIGNsb3NlIHRoZXNlIHRhZ3MgdG8gc3VwcG9ydCBYSFRNTCAoIzEzMjAwKQoJd3JhcE1hcCA9IHsKCQlvcHRpb246IFsgMSwgIjxzZWxlY3QgbXVsdGlwbGU9J211bHRpcGxlJz4iLCAiPC9zZWxlY3Q+IiBdLAoJCWxlZ2VuZDogWyAxLCAiPGZpZWxkc2V0PiIsICI8L2ZpZWxkc2V0PiIgXSwKCQlhcmVhOiBbIDEsICI8bWFwPiIsICI8L21hcD4iIF0sCgkJcGFyYW06IFsgMSwgIjxvYmplY3Q+IiwgIjwvb2JqZWN0PiIgXSwKCQl0aGVhZDogWyAxLCAiPHRhYmxlPiIsICI8L3RhYmxlPiIgXSwKCQl0cjogWyAyLCAiPHRhYmxlPjx0Ym9keT4iLCAiPC90Ym9keT48L3RhYmxlPiIgXSwKCQljb2w6IFsgMiwgIjx0YWJsZT48dGJvZHk+PC90Ym9keT48Y29sZ3JvdXA+IiwgIjwvY29sZ3JvdXA+PC90YWJsZT4iIF0sCgkJdGQ6IFsgMywgIjx0YWJsZT48dGJvZHk+PHRyPiIsICI8L3RyPjwvdGJvZHk+PC90YWJsZT4iIF0sCgoJCS8vIElFNi04IGNhbid0IHNlcmlhbGl6ZSBsaW5rLCBzY3JpcHQsIHN0eWxlLCBvciBhbnkgaHRtbDUgKE5vU2NvcGUpIHRhZ3MsCgkJLy8gdW5sZXNzIHdyYXBwZWQgaW4gYSBkaXYgd2l0aCBub24tYnJlYWtpbmcgY2hhcmFjdGVycyBpbiBmcm9udCBvZiBpdC4KCQlfZGVmYXVsdDogalF1ZXJ5LnN1cHBvcnQuaHRtbFNlcmlhbGl6ZSA/IFsgMCwgIiIsICIiIF0gOiBbIDEsICJYPGRpdj4iLCAiPC9kaXY+IiAgXQoJfSwKCXNhZmVGcmFnbWVudCA9IGNyZWF0ZVNhZmVGcmFnbWVudCggZG9jdW1lbnQgKSwKCWZyYWdtZW50RGl2ID0gc2FmZUZyYWdtZW50LmFwcGVuZENoaWxkKCBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKSApOwoKd3JhcE1hcC5vcHRncm91cCA9IHdyYXBNYXAub3B0aW9uOwp3cmFwTWFwLnRib2R5ID0gd3JhcE1hcC50Zm9vdCA9IHdyYXBNYXAuY29sZ3JvdXAgPSB3cmFwTWFwLmNhcHRpb24gPSB3cmFwTWFwLnRoZWFkOwp3cmFwTWFwLnRoID0gd3JhcE1hcC50ZDsKCmpRdWVyeS5mbi5leHRlbmQoewoJdGV4dDogZnVuY3Rpb24oIHZhbHVlICkgewoJCXJldHVybiBqUXVlcnkuYWNjZXNzKCB0aGlzLCBmdW5jdGlvbiggdmFsdWUgKSB7CgkJCXJldHVybiB2YWx1ZSA9PT0gdW5kZWZpbmVkID8KCQkJCWpRdWVyeS50ZXh0KCB0aGlzICkgOgoJCQkJdGhpcy5lbXB0eSgpLmFwcGVuZCggKCB0aGlzWzBdICYmIHRoaXNbMF0ub3duZXJEb2N1bWVudCB8fCBkb2N1bWVudCApLmNyZWF0ZVRleHROb2RlKCB2YWx1ZSApICk7CgkJfSwgbnVsbCwgdmFsdWUsIGFyZ3VtZW50cy5sZW5ndGggKTsKCX0sCgoJd3JhcEFsbDogZnVuY3Rpb24oIGh0bWwgKSB7CgkJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggaHRtbCApICkgewoJCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKGkpIHsKCQkJCWpRdWVyeSh0aGlzKS53cmFwQWxsKCBodG1sLmNhbGwodGhpcywgaSkgKTsKCQkJfSk7CgkJfQoKCQlpZiAoIHRoaXNbMF0gKSB7CgkJCS8vIFRoZSBlbGVtZW50cyB0byB3cmFwIHRoZSB0YXJnZXQgYXJvdW5kCgkJCXZhciB3cmFwID0galF1ZXJ5KCBodG1sLCB0aGlzWzBdLm93bmVyRG9jdW1lbnQgKS5lcSgwKS5jbG9uZSh0cnVlKTsKCgkJCWlmICggdGhpc1swXS5wYXJlbnROb2RlICkgewoJCQkJd3JhcC5pbnNlcnRCZWZvcmUoIHRoaXNbMF0gKTsKCQkJfQoKCQkJd3JhcC5tYXAoZnVuY3Rpb24oKSB7CgkJCQl2YXIgZWxlbSA9IHRoaXM7CgoJCQkJd2hpbGUgKCBlbGVtLmZpcnN0Q2hpbGQgJiYgZWxlbS5maXJzdENoaWxkLm5vZGVUeXBlID09PSAxICkgewoJCQkJCWVsZW0gPSBlbGVtLmZpcnN0Q2hpbGQ7CgkJCQl9CgoJCQkJcmV0dXJuIGVsZW07CgkJCX0pLmFwcGVuZCggdGhpcyApOwoJCX0KCgkJcmV0dXJuIHRoaXM7Cgl9LAoKCXdyYXBJbm5lcjogZnVuY3Rpb24oIGh0bWwgKSB7CgkJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggaHRtbCApICkgewoJCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKGkpIHsKCQkJCWpRdWVyeSh0aGlzKS53cmFwSW5uZXIoIGh0bWwuY2FsbCh0aGlzLCBpKSApOwoJCQl9KTsKCQl9CgoJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CgkJCXZhciBzZWxmID0galF1ZXJ5KCB0aGlzICksCgkJCQljb250ZW50cyA9IHNlbGYuY29udGVudHMoKTsKCgkJCWlmICggY29udGVudHMubGVuZ3RoICkgewoJCQkJY29udGVudHMud3JhcEFsbCggaHRtbCApOwoKCQkJfSBlbHNlIHsKCQkJCXNlbGYuYXBwZW5kKCBodG1sICk7CgkJCX0KCQl9KTsKCX0sCgoJd3JhcDogZnVuY3Rpb24oIGh0bWwgKSB7CgkJdmFyIGlzRnVuY3Rpb24gPSBqUXVlcnkuaXNGdW5jdGlvbiggaHRtbCApOwoKCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKGkpIHsKCQkJalF1ZXJ5KCB0aGlzICkud3JhcEFsbCggaXNGdW5jdGlvbiA/IGh0bWwuY2FsbCh0aGlzLCBpKSA6IGh0bWwgKTsKCQl9KTsKCX0sCgoJdW53cmFwOiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5wYXJlbnQoKS5lYWNoKGZ1bmN0aW9uKCkgewoJCQlpZiAoICFqUXVlcnkubm9kZU5hbWUoIHRoaXMsICJib2R5IiApICkgewoJCQkJalF1ZXJ5KCB0aGlzICkucmVwbGFjZVdpdGgoIHRoaXMuY2hpbGROb2RlcyApOwoJCQl9CgkJfSkuZW5kKCk7Cgl9LAoKCWFwcGVuZDogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMuZG9tTWFuaXAoYXJndW1lbnRzLCB0cnVlLCBmdW5jdGlvbiggZWxlbSApIHsKCQkJaWYgKCB0aGlzLm5vZGVUeXBlID09PSAxIHx8IHRoaXMubm9kZVR5cGUgPT09IDExIHx8IHRoaXMubm9kZVR5cGUgPT09IDkgKSB7CgkJCQl0aGlzLmFwcGVuZENoaWxkKCBlbGVtICk7CgkJCX0KCQl9KTsKCX0sCgoJcHJlcGVuZDogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMuZG9tTWFuaXAoYXJndW1lbnRzLCB0cnVlLCBmdW5jdGlvbiggZWxlbSApIHsKCQkJaWYgKCB0aGlzLm5vZGVUeXBlID09PSAxIHx8IHRoaXMubm9kZVR5cGUgPT09IDExIHx8IHRoaXMubm9kZVR5cGUgPT09IDkgKSB7CgkJCQl0aGlzLmluc2VydEJlZm9yZSggZWxlbSwgdGhpcy5maXJzdENoaWxkICk7CgkJCX0KCQl9KTsKCX0sCgoJYmVmb3JlOiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5kb21NYW5pcCggYXJndW1lbnRzLCBmYWxzZSwgZnVuY3Rpb24oIGVsZW0gKSB7CgkJCWlmICggdGhpcy5wYXJlbnROb2RlICkgewoJCQkJdGhpcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZSggZWxlbSwgdGhpcyApOwoJCQl9CgkJfSk7Cgl9LAoKCWFmdGVyOiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5kb21NYW5pcCggYXJndW1lbnRzLCBmYWxzZSwgZnVuY3Rpb24oIGVsZW0gKSB7CgkJCWlmICggdGhpcy5wYXJlbnROb2RlICkgewoJCQkJdGhpcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZSggZWxlbSwgdGhpcy5uZXh0U2libGluZyApOwoJCQl9CgkJfSk7Cgl9LAoKCS8vIGtlZXBEYXRhIGlzIGZvciBpbnRlcm5hbCB1c2Ugb25seS0tZG8gbm90IGRvY3VtZW50CglyZW1vdmU6IGZ1bmN0aW9uKCBzZWxlY3Rvciwga2VlcERhdGEgKSB7CgkJdmFyIGVsZW0sCgkJCWkgPSAwOwoKCQlmb3IgKCA7IChlbGVtID0gdGhpc1tpXSkgIT0gbnVsbDsgaSsrICkgewoJCQlpZiAoICFzZWxlY3RvciB8fCBqUXVlcnkuZmlsdGVyKCBzZWxlY3RvciwgWyBlbGVtIF0gKS5sZW5ndGggPiAwICkgewoJCQkJaWYgKCAha2VlcERhdGEgJiYgZWxlbS5ub2RlVHlwZSA9PT0gMSApIHsKCQkJCQlqUXVlcnkuY2xlYW5EYXRhKCBnZXRBbGwoIGVsZW0gKSApOwoJCQkJfQoKCQkJCWlmICggZWxlbS5wYXJlbnROb2RlICkgewoJCQkJCWlmICgga2VlcERhdGEgJiYgalF1ZXJ5LmNvbnRhaW5zKCBlbGVtLm93bmVyRG9jdW1lbnQsIGVsZW0gKSApIHsKCQkJCQkJc2V0R2xvYmFsRXZhbCggZ2V0QWxsKCBlbGVtLCAic2NyaXB0IiApICk7CgkJCQkJfQoJCQkJCWVsZW0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCggZWxlbSApOwoJCQkJfQoJCQl9CgkJfQoKCQlyZXR1cm4gdGhpczsKCX0sCgoJZW1wdHk6IGZ1bmN0aW9uKCkgewoJCXZhciBlbGVtLAoJCQlpID0gMDsKCgkJZm9yICggOyAoZWxlbSA9IHRoaXNbaV0pICE9IG51bGw7IGkrKyApIHsKCQkJLy8gUmVtb3ZlIGVsZW1lbnQgbm9kZXMgYW5kIHByZXZlbnQgbWVtb3J5IGxlYWtzCgkJCWlmICggZWxlbS5ub2RlVHlwZSA9PT0gMSApIHsKCQkJCWpRdWVyeS5jbGVhbkRhdGEoIGdldEFsbCggZWxlbSwgZmFsc2UgKSApOwoJCQl9CgoJCQkvLyBSZW1vdmUgYW55IHJlbWFpbmluZyBub2RlcwoJCQl3aGlsZSAoIGVsZW0uZmlyc3RDaGlsZCApIHsKCQkJCWVsZW0ucmVtb3ZlQ2hpbGQoIGVsZW0uZmlyc3RDaGlsZCApOwoJCQl9CgoJCQkvLyBJZiB0aGlzIGlzIGEgc2VsZWN0LCBlbnN1cmUgdGhhdCBpdCBkaXNwbGF5cyBlbXB0eSAoIzEyMzM2KQoJCQkvLyBTdXBwb3J0OiBJRTw5CgkJCWlmICggZWxlbS5vcHRpb25zICYmIGpRdWVyeS5ub2RlTmFtZSggZWxlbSwgInNlbGVjdCIgKSApIHsKCQkJCWVsZW0ub3B0aW9ucy5sZW5ndGggPSAwOwoJCQl9CgkJfQoKCQlyZXR1cm4gdGhpczsKCX0sCgoJY2xvbmU6IGZ1bmN0aW9uKCBkYXRhQW5kRXZlbnRzLCBkZWVwRGF0YUFuZEV2ZW50cyApIHsKCQlkYXRhQW5kRXZlbnRzID0gZGF0YUFuZEV2ZW50cyA9PSBudWxsID8gZmFsc2UgOiBkYXRhQW5kRXZlbnRzOwoJCWRlZXBEYXRhQW5kRXZlbnRzID0gZGVlcERhdGFBbmRFdmVudHMgPT0gbnVsbCA/IGRhdGFBbmRFdmVudHMgOiBkZWVwRGF0YUFuZEV2ZW50czsKCgkJcmV0dXJuIHRoaXMubWFwKCBmdW5jdGlvbiAoKSB7CgkJCXJldHVybiBqUXVlcnkuY2xvbmUoIHRoaXMsIGRhdGFBbmRFdmVudHMsIGRlZXBEYXRhQW5kRXZlbnRzICk7CgkJfSk7Cgl9LAoKCWh0bWw6IGZ1bmN0aW9uKCB2YWx1ZSApIHsKCQlyZXR1cm4galF1ZXJ5LmFjY2VzcyggdGhpcywgZnVuY3Rpb24oIHZhbHVlICkgewoJCQl2YXIgZWxlbSA9IHRoaXNbMF0gfHwge30sCgkJCQlpID0gMCwKCQkJCWwgPSB0aGlzLmxlbmd0aDsKCgkJCWlmICggdmFsdWUgPT09IHVuZGVmaW5lZCApIHsKCQkJCXJldHVybiBlbGVtLm5vZGVUeXBlID09PSAxID8KCQkJCQllbGVtLmlubmVySFRNTC5yZXBsYWNlKCByaW5saW5lalF1ZXJ5LCAiIiApIDoKCQkJCQl1bmRlZmluZWQ7CgkJCX0KCgkJCS8vIFNlZSBpZiB3ZSBjYW4gdGFrZSBhIHNob3J0Y3V0IGFuZCBqdXN0IHVzZSBpbm5lckhUTUwKCQkJaWYgKCB0eXBlb2YgdmFsdWUgPT09ICJzdHJpbmciICYmICFybm9Jbm5lcmh0bWwudGVzdCggdmFsdWUgKSAmJgoJCQkJKCBqUXVlcnkuc3VwcG9ydC5odG1sU2VyaWFsaXplIHx8ICFybm9zaGltY2FjaGUudGVzdCggdmFsdWUgKSAgKSAmJgoJCQkJKCBqUXVlcnkuc3VwcG9ydC5sZWFkaW5nV2hpdGVzcGFjZSB8fCAhcmxlYWRpbmdXaGl0ZXNwYWNlLnRlc3QoIHZhbHVlICkgKSAmJgoJCQkJIXdyYXBNYXBbICggcnRhZ05hbWUuZXhlYyggdmFsdWUgKSB8fCBbIiIsICIiXSApWzFdLnRvTG93ZXJDYXNlKCkgXSApIHsKCgkJCQl2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoIHJ4aHRtbFRhZywgIjwkMT48LyQyPiIgKTsKCgkJCQl0cnkgewoJCQkJCWZvciAoOyBpIDwgbDsgaSsrICkgewoJCQkJCQkvLyBSZW1vdmUgZWxlbWVudCBub2RlcyBhbmQgcHJldmVudCBtZW1vcnkgbGVha3MKCQkJCQkJZWxlbSA9IHRoaXNbaV0gfHwge307CgkJCQkJCWlmICggZWxlbS5ub2RlVHlwZSA9PT0gMSApIHsKCQkJCQkJCWpRdWVyeS5jbGVhbkRhdGEoIGdldEFsbCggZWxlbSwgZmFsc2UgKSApOwoJCQkJCQkJZWxlbS5pbm5lckhUTUwgPSB2YWx1ZTsKCQkJCQkJfQoJCQkJCX0KCgkJCQkJZWxlbSA9IDA7CgoJCQkJLy8gSWYgdXNpbmcgaW5uZXJIVE1MIHRocm93cyBhbiBleGNlcHRpb24sIHVzZSB0aGUgZmFsbGJhY2sgbWV0aG9kCgkJCQl9IGNhdGNoKGUpIHt9CgkJCX0KCgkJCWlmICggZWxlbSApIHsKCQkJCXRoaXMuZW1wdHkoKS5hcHBlbmQoIHZhbHVlICk7CgkJCX0KCQl9LCBudWxsLCB2YWx1ZSwgYXJndW1lbnRzLmxlbmd0aCApOwoJfSwKCglyZXBsYWNlV2l0aDogZnVuY3Rpb24oIHZhbHVlICkgewoJCXZhciBpc0Z1bmMgPSBqUXVlcnkuaXNGdW5jdGlvbiggdmFsdWUgKTsKCgkJLy8gTWFrZSBzdXJlIHRoYXQgdGhlIGVsZW1lbnRzIGFyZSByZW1vdmVkIGZyb20gdGhlIERPTSBiZWZvcmUgdGhleSBhcmUgaW5zZXJ0ZWQKCQkvLyB0aGlzIGNhbiBoZWxwIGZpeCByZXBsYWNpbmcgYSBwYXJlbnQgd2l0aCBjaGlsZCBlbGVtZW50cwoJCWlmICggIWlzRnVuYyAmJiB0eXBlb2YgdmFsdWUgIT09ICJzdHJpbmciICkgewoJCQl2YWx1ZSA9IGpRdWVyeSggdmFsdWUgKS5ub3QoIHRoaXMgKS5kZXRhY2goKTsKCQl9CgoJCXJldHVybiB0aGlzLmRvbU1hbmlwKCBbIHZhbHVlIF0sIHRydWUsIGZ1bmN0aW9uKCBlbGVtICkgewoJCQl2YXIgbmV4dCA9IHRoaXMubmV4dFNpYmxpbmcsCgkJCQlwYXJlbnQgPSB0aGlzLnBhcmVudE5vZGU7CgoJCQlpZiAoIHBhcmVudCApIHsKCQkJCWpRdWVyeSggdGhpcyApLnJlbW92ZSgpOwoJCQkJcGFyZW50Lmluc2VydEJlZm9yZSggZWxlbSwgbmV4dCApOwoJCQl9CgkJfSk7Cgl9LAoKCWRldGFjaDogZnVuY3Rpb24oIHNlbGVjdG9yICkgewoJCXJldHVybiB0aGlzLnJlbW92ZSggc2VsZWN0b3IsIHRydWUgKTsKCX0sCgoJZG9tTWFuaXA6IGZ1bmN0aW9uKCBhcmdzLCB0YWJsZSwgY2FsbGJhY2sgKSB7CgoJCS8vIEZsYXR0ZW4gYW55IG5lc3RlZCBhcnJheXMKCQlhcmdzID0gY29yZV9jb25jYXQuYXBwbHkoIFtdLCBhcmdzICk7CgoJCXZhciBmaXJzdCwgbm9kZSwgaGFzU2NyaXB0cywKCQkJc2NyaXB0cywgZG9jLCBmcmFnbWVudCwKCQkJaSA9IDAsCgkJCWwgPSB0aGlzLmxlbmd0aCwKCQkJc2V0ID0gdGhpcywKCQkJaU5vQ2xvbmUgPSBsIC0gMSwKCQkJdmFsdWUgPSBhcmdzWzBdLAoJCQlpc0Z1bmN0aW9uID0galF1ZXJ5LmlzRnVuY3Rpb24oIHZhbHVlICk7CgoJCS8vIFdlIGNhbid0IGNsb25lTm9kZSBmcmFnbWVudHMgdGhhdCBjb250YWluIGNoZWNrZWQsIGluIFdlYktpdAoJCWlmICggaXNGdW5jdGlvbiB8fCAhKCBsIDw9IDEgfHwgdHlwZW9mIHZhbHVlICE9PSAic3RyaW5nIiB8fCBqUXVlcnkuc3VwcG9ydC5jaGVja0Nsb25lIHx8ICFyY2hlY2tlZC50ZXN0KCB2YWx1ZSApICkgKSB7CgkJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oIGluZGV4ICkgewoJCQkJdmFyIHNlbGYgPSBzZXQuZXEoIGluZGV4ICk7CgkJCQlpZiAoIGlzRnVuY3Rpb24gKSB7CgkJCQkJYXJnc1swXSA9IHZhbHVlLmNhbGwoIHRoaXMsIGluZGV4LCB0YWJsZSA/IHNlbGYuaHRtbCgpIDogdW5kZWZpbmVkICk7CgkJCQl9CgkJCQlzZWxmLmRvbU1hbmlwKCBhcmdzLCB0YWJsZSwgY2FsbGJhY2sgKTsKCQkJfSk7CgkJfQoKCQlpZiAoIGwgKSB7CgkJCWZyYWdtZW50ID0galF1ZXJ5LmJ1aWxkRnJhZ21lbnQoIGFyZ3MsIHRoaXNbIDAgXS5vd25lckRvY3VtZW50LCBmYWxzZSwgdGhpcyApOwoJCQlmaXJzdCA9IGZyYWdtZW50LmZpcnN0Q2hpbGQ7CgoJCQlpZiAoIGZyYWdtZW50LmNoaWxkTm9kZXMubGVuZ3RoID09PSAxICkgewoJCQkJZnJhZ21lbnQgPSBmaXJzdDsKCQkJfQoKCQkJaWYgKCBmaXJzdCApIHsKCQkJCXRhYmxlID0gdGFibGUgJiYgalF1ZXJ5Lm5vZGVOYW1lKCBmaXJzdCwgInRyIiApOwoJCQkJc2NyaXB0cyA9IGpRdWVyeS5tYXAoIGdldEFsbCggZnJhZ21lbnQsICJzY3JpcHQiICksIGRpc2FibGVTY3JpcHQgKTsKCQkJCWhhc1NjcmlwdHMgPSBzY3JpcHRzLmxlbmd0aDsKCgkJCQkvLyBVc2UgdGhlIG9yaWdpbmFsIGZyYWdtZW50IGZvciB0aGUgbGFzdCBpdGVtIGluc3RlYWQgb2YgdGhlIGZpcnN0IGJlY2F1c2UgaXQgY2FuIGVuZCB1cAoJCQkJLy8gYmVpbmcgZW1wdGllZCBpbmNvcnJlY3RseSBpbiBjZXJ0YWluIHNpdHVhdGlvbnMgKCM4MDcwKS4KCQkJCWZvciAoIDsgaSA8IGw7IGkrKyApIHsKCQkJCQlub2RlID0gZnJhZ21lbnQ7CgoJCQkJCWlmICggaSAhPT0gaU5vQ2xvbmUgKSB7CgkJCQkJCW5vZGUgPSBqUXVlcnkuY2xvbmUoIG5vZGUsIHRydWUsIHRydWUgKTsKCgkJCQkJCS8vIEtlZXAgcmVmZXJlbmNlcyB0byBjbG9uZWQgc2NyaXB0cyBmb3IgbGF0ZXIgcmVzdG9yYXRpb24KCQkJCQkJaWYgKCBoYXNTY3JpcHRzICkgewoJCQkJCQkJalF1ZXJ5Lm1lcmdlKCBzY3JpcHRzLCBnZXRBbGwoIG5vZGUsICJzY3JpcHQiICkgKTsKCQkJCQkJfQoJCQkJCX0KCgkJCQkJY2FsbGJhY2suY2FsbCgKCQkJCQkJdGFibGUgJiYgalF1ZXJ5Lm5vZGVOYW1lKCB0aGlzW2ldLCAidGFibGUiICkgPwoJCQkJCQkJZmluZE9yQXBwZW5kKCB0aGlzW2ldLCAidGJvZHkiICkgOgoJCQkJCQkJdGhpc1tpXSwKCQkJCQkJbm9kZSwKCQkJCQkJaQoJCQkJCSk7CgkJCQl9CgoJCQkJaWYgKCBoYXNTY3JpcHRzICkgewoJCQkJCWRvYyA9IHNjcmlwdHNbIHNjcmlwdHMubGVuZ3RoIC0gMSBdLm93bmVyRG9jdW1lbnQ7CgoJCQkJCS8vIFJlZW5hYmxlIHNjcmlwdHMKCQkJCQlqUXVlcnkubWFwKCBzY3JpcHRzLCByZXN0b3JlU2NyaXB0ICk7CgoJCQkJCS8vIEV2YWx1YXRlIGV4ZWN1dGFibGUgc2NyaXB0cyBvbiBmaXJzdCBkb2N1bWVudCBpbnNlcnRpb24KCQkJCQlmb3IgKCBpID0gMDsgaSA8IGhhc1NjcmlwdHM7IGkrKyApIHsKCQkJCQkJbm9kZSA9IHNjcmlwdHNbIGkgXTsKCQkJCQkJaWYgKCByc2NyaXB0VHlwZS50ZXN0KCBub2RlLnR5cGUgfHwgIiIgKSAmJgoJCQkJCQkJIWpRdWVyeS5fZGF0YSggbm9kZSwgImdsb2JhbEV2YWwiICkgJiYgalF1ZXJ5LmNvbnRhaW5zKCBkb2MsIG5vZGUgKSApIHsKCgkJCQkJCQlpZiAoIG5vZGUuc3JjICkgewoJCQkJCQkJCS8vIEhvcGUgYWpheCBpcyBhdmFpbGFibGUuLi4KCQkJCQkJCQlqUXVlcnkuYWpheCh7CgkJCQkJCQkJCXVybDogbm9kZS5zcmMsCgkJCQkJCQkJCXR5cGU6ICJHRVQiLAoJCQkJCQkJCQlkYXRhVHlwZTogInNjcmlwdCIsCgkJCQkJCQkJCWFzeW5jOiBmYWxzZSwKCQkJCQkJCQkJZ2xvYmFsOiBmYWxzZSwKCQkJCQkJCQkJInRocm93cyI6IHRydWUKCQkJCQkJCQl9KTsKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJalF1ZXJ5Lmdsb2JhbEV2YWwoICggbm9kZS50ZXh0IHx8IG5vZGUudGV4dENvbnRlbnQgfHwgbm9kZS5pbm5lckhUTUwgfHwgIiIgKS5yZXBsYWNlKCByY2xlYW5TY3JpcHQsICIiICkgKTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCQkJCX0KCgkJCQkvLyBGaXggIzExODA5OiBBdm9pZCBsZWFraW5nIG1lbW9yeQoJCQkJZnJhZ21lbnQgPSBmaXJzdCA9IG51bGw7CgkJCX0KCQl9CgoJCXJldHVybiB0aGlzOwoJfQp9KTsKCmZ1bmN0aW9uIGZpbmRPckFwcGVuZCggZWxlbSwgdGFnICkgewoJcmV0dXJuIGVsZW0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoIHRhZyApWzBdIHx8IGVsZW0uYXBwZW5kQ2hpbGQoIGVsZW0ub3duZXJEb2N1bWVudC5jcmVhdGVFbGVtZW50KCB0YWcgKSApOwp9CgovLyBSZXBsYWNlL3Jlc3RvcmUgdGhlIHR5cGUgYXR0cmlidXRlIG9mIHNjcmlwdCBlbGVtZW50cyBmb3Igc2FmZSBET00gbWFuaXB1bGF0aW9uCmZ1bmN0aW9uIGRpc2FibGVTY3JpcHQoIGVsZW0gKSB7Cgl2YXIgYXR0ciA9IGVsZW0uZ2V0QXR0cmlidXRlTm9kZSgidHlwZSIpOwoJZWxlbS50eXBlID0gKCBhdHRyICYmIGF0dHIuc3BlY2lmaWVkICkgKyAiLyIgKyBlbGVtLnR5cGU7CglyZXR1cm4gZWxlbTsKfQpmdW5jdGlvbiByZXN0b3JlU2NyaXB0KCBlbGVtICkgewoJdmFyIG1hdGNoID0gcnNjcmlwdFR5cGVNYXNrZWQuZXhlYyggZWxlbS50eXBlICk7CglpZiAoIG1hdGNoICkgewoJCWVsZW0udHlwZSA9IG1hdGNoWzFdOwoJfSBlbHNlIHsKCQllbGVtLnJlbW92ZUF0dHJpYnV0ZSgidHlwZSIpOwoJfQoJcmV0dXJuIGVsZW07Cn0KCi8vIE1hcmsgc2NyaXB0cyBhcyBoYXZpbmcgYWxyZWFkeSBiZWVuIGV2YWx1YXRlZApmdW5jdGlvbiBzZXRHbG9iYWxFdmFsKCBlbGVtcywgcmVmRWxlbWVudHMgKSB7Cgl2YXIgZWxlbSwKCQlpID0gMDsKCWZvciAoIDsgKGVsZW0gPSBlbGVtc1tpXSkgIT0gbnVsbDsgaSsrICkgewoJCWpRdWVyeS5fZGF0YSggZWxlbSwgImdsb2JhbEV2YWwiLCAhcmVmRWxlbWVudHMgfHwgalF1ZXJ5Ll9kYXRhKCByZWZFbGVtZW50c1tpXSwgImdsb2JhbEV2YWwiICkgKTsKCX0KfQoKZnVuY3Rpb24gY2xvbmVDb3B5RXZlbnQoIHNyYywgZGVzdCApIHsKCglpZiAoIGRlc3Qubm9kZVR5cGUgIT09IDEgfHwgIWpRdWVyeS5oYXNEYXRhKCBzcmMgKSApIHsKCQlyZXR1cm47Cgl9CgoJdmFyIHR5cGUsIGksIGwsCgkJb2xkRGF0YSA9IGpRdWVyeS5fZGF0YSggc3JjICksCgkJY3VyRGF0YSA9IGpRdWVyeS5fZGF0YSggZGVzdCwgb2xkRGF0YSApLAoJCWV2ZW50cyA9IG9sZERhdGEuZXZlbnRzOwoKCWlmICggZXZlbnRzICkgewoJCWRlbGV0ZSBjdXJEYXRhLmhhbmRsZTsKCQljdXJEYXRhLmV2ZW50cyA9IHt9OwoKCQlmb3IgKCB0eXBlIGluIGV2ZW50cyApIHsKCQkJZm9yICggaSA9IDAsIGwgPSBldmVudHNbIHR5cGUgXS5sZW5ndGg7IGkgPCBsOyBpKysgKSB7CgkJCQlqUXVlcnkuZXZlbnQuYWRkKCBkZXN0LCB0eXBlLCBldmVudHNbIHR5cGUgXVsgaSBdICk7CgkJCX0KCQl9Cgl9CgoJLy8gbWFrZSB0aGUgY2xvbmVkIHB1YmxpYyBkYXRhIG9iamVjdCBhIGNvcHkgZnJvbSB0aGUgb3JpZ2luYWwKCWlmICggY3VyRGF0YS5kYXRhICkgewoJCWN1ckRhdGEuZGF0YSA9IGpRdWVyeS5leHRlbmQoIHt9LCBjdXJEYXRhLmRhdGEgKTsKCX0KfQoKZnVuY3Rpb24gZml4Q2xvbmVOb2RlSXNzdWVzKCBzcmMsIGRlc3QgKSB7Cgl2YXIgbm9kZU5hbWUsIGUsIGRhdGE7CgoJLy8gV2UgZG8gbm90IG5lZWQgdG8gZG8gYW55dGhpbmcgZm9yIG5vbi1FbGVtZW50cwoJaWYgKCBkZXN0Lm5vZGVUeXBlICE9PSAxICkgewoJCXJldHVybjsKCX0KCglub2RlTmFtZSA9IGRlc3Qubm9kZU5hbWUudG9Mb3dlckNhc2UoKTsKCgkvLyBJRTYtOCBjb3BpZXMgZXZlbnRzIGJvdW5kIHZpYSBhdHRhY2hFdmVudCB3aGVuIHVzaW5nIGNsb25lTm9kZS4KCWlmICggIWpRdWVyeS5zdXBwb3J0Lm5vQ2xvbmVFdmVudCAmJiBkZXN0WyBqUXVlcnkuZXhwYW5kbyBdICkgewoJCWRhdGEgPSBqUXVlcnkuX2RhdGEoIGRlc3QgKTsKCgkJZm9yICggZSBpbiBkYXRhLmV2ZW50cyApIHsKCQkJalF1ZXJ5LnJlbW92ZUV2ZW50KCBkZXN0LCBlLCBkYXRhLmhhbmRsZSApOwoJCX0KCgkJLy8gRXZlbnQgZGF0YSBnZXRzIHJlZmVyZW5jZWQgaW5zdGVhZCBvZiBjb3BpZWQgaWYgdGhlIGV4cGFuZG8gZ2V0cyBjb3BpZWQgdG9vCgkJZGVzdC5yZW1vdmVBdHRyaWJ1dGUoIGpRdWVyeS5leHBhbmRvICk7Cgl9CgoJLy8gSUUgYmxhbmtzIGNvbnRlbnRzIHdoZW4gY2xvbmluZyBzY3JpcHRzLCBhbmQgdHJpZXMgdG8gZXZhbHVhdGUgbmV3bHktc2V0IHRleHQKCWlmICggbm9kZU5hbWUgPT09ICJzY3JpcHQiICYmIGRlc3QudGV4dCAhPT0gc3JjLnRleHQgKSB7CgkJZGlzYWJsZVNjcmlwdCggZGVzdCApLnRleHQgPSBzcmMudGV4dDsKCQlyZXN0b3JlU2NyaXB0KCBkZXN0ICk7CgoJLy8gSUU2LTEwIGltcHJvcGVybHkgY2xvbmVzIGNoaWxkcmVuIG9mIG9iamVjdCBlbGVtZW50cyB1c2luZyBjbGFzc2lkLgoJLy8gSUUxMCB0aHJvd3MgTm9Nb2RpZmljYXRpb25BbGxvd2VkRXJyb3IgaWYgcGFyZW50IGlzIG51bGwsICMxMjEzMi4KCX0gZWxzZSBpZiAoIG5vZGVOYW1lID09PSAib2JqZWN0IiApIHsKCQlpZiAoIGRlc3QucGFyZW50Tm9kZSApIHsKCQkJZGVzdC5vdXRlckhUTUwgPSBzcmMub3V0ZXJIVE1MOwoJCX0KCgkJLy8gVGhpcyBwYXRoIGFwcGVhcnMgdW5hdm9pZGFibGUgZm9yIElFOS4gV2hlbiBjbG9uaW5nIGFuIG9iamVjdAoJCS8vIGVsZW1lbnQgaW4gSUU5LCB0aGUgb3V0ZXJIVE1MIHN0cmF0ZWd5IGFib3ZlIGlzIG5vdCBzdWZmaWNpZW50LgoJCS8vIElmIHRoZSBzcmMgaGFzIGlubmVySFRNTCBhbmQgdGhlIGRlc3RpbmF0aW9uIGRvZXMgbm90LAoJCS8vIGNvcHkgdGhlIHNyYy5pbm5lckhUTUwgaW50byB0aGUgZGVzdC5pbm5lckhUTUwuICMxMDMyNAoJCWlmICggalF1ZXJ5LnN1cHBvcnQuaHRtbDVDbG9uZSAmJiAoIHNyYy5pbm5lckhUTUwgJiYgIWpRdWVyeS50cmltKGRlc3QuaW5uZXJIVE1MKSApICkgewoJCQlkZXN0LmlubmVySFRNTCA9IHNyYy5pbm5lckhUTUw7CgkJfQoKCX0gZWxzZSBpZiAoIG5vZGVOYW1lID09PSAiaW5wdXQiICYmIG1hbmlwdWxhdGlvbl9yY2hlY2thYmxlVHlwZS50ZXN0KCBzcmMudHlwZSApICkgewoJCS8vIElFNi04IGZhaWxzIHRvIHBlcnNpc3QgdGhlIGNoZWNrZWQgc3RhdGUgb2YgYSBjbG9uZWQgY2hlY2tib3gKCQkvLyBvciByYWRpbyBidXR0b24uIFdvcnNlLCBJRTYtNyBmYWlsIHRvIGdpdmUgdGhlIGNsb25lZCBlbGVtZW50CgkJLy8gYSBjaGVja2VkIGFwcGVhcmFuY2UgaWYgdGhlIGRlZmF1bHRDaGVja2VkIHZhbHVlIGlzbid0IGFsc28gc2V0CgoJCWRlc3QuZGVmYXVsdENoZWNrZWQgPSBkZXN0LmNoZWNrZWQgPSBzcmMuY2hlY2tlZDsKCgkJLy8gSUU2LTcgZ2V0IGNvbmZ1c2VkIGFuZCBlbmQgdXAgc2V0dGluZyB0aGUgdmFsdWUgb2YgYSBjbG9uZWQKCQkvLyBjaGVja2JveC9yYWRpbyBidXR0b24gdG8gYW4gZW1wdHkgc3RyaW5nIGluc3RlYWQgb2YgIm9uIgoJCWlmICggZGVzdC52YWx1ZSAhPT0gc3JjLnZhbHVlICkgewoJCQlkZXN0LnZhbHVlID0gc3JjLnZhbHVlOwoJCX0KCgkvLyBJRTYtOCBmYWlscyB0byByZXR1cm4gdGhlIHNlbGVjdGVkIG9wdGlvbiB0byB0aGUgZGVmYXVsdCBzZWxlY3RlZAoJLy8gc3RhdGUgd2hlbiBjbG9uaW5nIG9wdGlvbnMKCX0gZWxzZSBpZiAoIG5vZGVOYW1lID09PSAib3B0aW9uIiApIHsKCQlkZXN0LmRlZmF1bHRTZWxlY3RlZCA9IGRlc3Quc2VsZWN0ZWQgPSBzcmMuZGVmYXVsdFNlbGVjdGVkOwoKCS8vIElFNi04IGZhaWxzIHRvIHNldCB0aGUgZGVmYXVsdFZhbHVlIHRvIHRoZSBjb3JyZWN0IHZhbHVlIHdoZW4KCS8vIGNsb25pbmcgb3RoZXIgdHlwZXMgb2YgaW5wdXQgZmllbGRzCgl9IGVsc2UgaWYgKCBub2RlTmFtZSA9PT0gImlucHV0IiB8fCBub2RlTmFtZSA9PT0gInRleHRhcmVhIiApIHsKCQlkZXN0LmRlZmF1bHRWYWx1ZSA9IHNyYy5kZWZhdWx0VmFsdWU7Cgl9Cn0KCmpRdWVyeS5lYWNoKHsKCWFwcGVuZFRvOiAiYXBwZW5kIiwKCXByZXBlbmRUbzogInByZXBlbmQiLAoJaW5zZXJ0QmVmb3JlOiAiYmVmb3JlIiwKCWluc2VydEFmdGVyOiAiYWZ0ZXIiLAoJcmVwbGFjZUFsbDogInJlcGxhY2VXaXRoIgp9LCBmdW5jdGlvbiggbmFtZSwgb3JpZ2luYWwgKSB7CglqUXVlcnkuZm5bIG5hbWUgXSA9IGZ1bmN0aW9uKCBzZWxlY3RvciApIHsKCQl2YXIgZWxlbXMsCgkJCWkgPSAwLAoJCQlyZXQgPSBbXSwKCQkJaW5zZXJ0ID0galF1ZXJ5KCBzZWxlY3RvciApLAoJCQlsYXN0ID0gaW5zZXJ0Lmxlbmd0aCAtIDE7CgoJCWZvciAoIDsgaSA8PSBsYXN0OyBpKysgKSB7CgkJCWVsZW1zID0gaSA9PT0gbGFzdCA/IHRoaXMgOiB0aGlzLmNsb25lKHRydWUpOwoJCQlqUXVlcnkoIGluc2VydFtpXSApWyBvcmlnaW5hbCBdKCBlbGVtcyApOwoKCQkJLy8gTW9kZXJuIGJyb3dzZXJzIGNhbiBhcHBseSBqUXVlcnkgY29sbGVjdGlvbnMgYXMgYXJyYXlzLCBidXQgb2xkSUUgbmVlZHMgYSAuZ2V0KCkKCQkJY29yZV9wdXNoLmFwcGx5KCByZXQsIGVsZW1zLmdldCgpICk7CgkJfQoKCQlyZXR1cm4gdGhpcy5wdXNoU3RhY2soIHJldCApOwoJfTsKfSk7CgpmdW5jdGlvbiBnZXRBbGwoIGNvbnRleHQsIHRhZyApIHsKCXZhciBlbGVtcywgZWxlbSwKCQlpID0gMCwKCQlmb3VuZCA9IHR5cGVvZiBjb250ZXh0LmdldEVsZW1lbnRzQnlUYWdOYW1lICE9PSBjb3JlX3N0cnVuZGVmaW5lZCA/IGNvbnRleHQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoIHRhZyB8fCAiKiIgKSA6CgkJCXR5cGVvZiBjb250ZXh0LnF1ZXJ5U2VsZWN0b3JBbGwgIT09IGNvcmVfc3RydW5kZWZpbmVkID8gY29udGV4dC5xdWVyeVNlbGVjdG9yQWxsKCB0YWcgfHwgIioiICkgOgoJCQl1bmRlZmluZWQ7CgoJaWYgKCAhZm91bmQgKSB7CgkJZm9yICggZm91bmQgPSBbXSwgZWxlbXMgPSBjb250ZXh0LmNoaWxkTm9kZXMgfHwgY29udGV4dDsgKGVsZW0gPSBlbGVtc1tpXSkgIT0gbnVsbDsgaSsrICkgewoJCQlpZiAoICF0YWcgfHwgalF1ZXJ5Lm5vZGVOYW1lKCBlbGVtLCB0YWcgKSApIHsKCQkJCWZvdW5kLnB1c2goIGVsZW0gKTsKCQkJfSBlbHNlIHsKCQkJCWpRdWVyeS5tZXJnZSggZm91bmQsIGdldEFsbCggZWxlbSwgdGFnICkgKTsKCQkJfQoJCX0KCX0KCglyZXR1cm4gdGFnID09PSB1bmRlZmluZWQgfHwgdGFnICYmIGpRdWVyeS5ub2RlTmFtZSggY29udGV4dCwgdGFnICkgPwoJCWpRdWVyeS5tZXJnZSggWyBjb250ZXh0IF0sIGZvdW5kICkgOgoJCWZvdW5kOwp9CgovLyBVc2VkIGluIGJ1aWxkRnJhZ21lbnQsIGZpeGVzIHRoZSBkZWZhdWx0Q2hlY2tlZCBwcm9wZXJ0eQpmdW5jdGlvbiBmaXhEZWZhdWx0Q2hlY2tlZCggZWxlbSApIHsKCWlmICggbWFuaXB1bGF0aW9uX3JjaGVja2FibGVUeXBlLnRlc3QoIGVsZW0udHlwZSApICkgewoJCWVsZW0uZGVmYXVsdENoZWNrZWQgPSBlbGVtLmNoZWNrZWQ7Cgl9Cn0KCmpRdWVyeS5leHRlbmQoewoJY2xvbmU6IGZ1bmN0aW9uKCBlbGVtLCBkYXRhQW5kRXZlbnRzLCBkZWVwRGF0YUFuZEV2ZW50cyApIHsKCQl2YXIgZGVzdEVsZW1lbnRzLCBub2RlLCBjbG9uZSwgaSwgc3JjRWxlbWVudHMsCgkJCWluUGFnZSA9IGpRdWVyeS5jb250YWlucyggZWxlbS5vd25lckRvY3VtZW50LCBlbGVtICk7CgoJCWlmICggalF1ZXJ5LnN1cHBvcnQuaHRtbDVDbG9uZSB8fCBqUXVlcnkuaXNYTUxEb2MoZWxlbSkgfHwgIXJub3NoaW1jYWNoZS50ZXN0KCAiPCIgKyBlbGVtLm5vZGVOYW1lICsgIj4iICkgKSB7CgkJCWNsb25lID0gZWxlbS5jbG9uZU5vZGUoIHRydWUgKTsKCgkJLy8gSUU8PTggZG9lcyBub3QgcHJvcGVybHkgY2xvbmUgZGV0YWNoZWQsIHVua25vd24gZWxlbWVudCBub2RlcwoJCX0gZWxzZSB7CgkJCWZyYWdtZW50RGl2LmlubmVySFRNTCA9IGVsZW0ub3V0ZXJIVE1MOwoJCQlmcmFnbWVudERpdi5yZW1vdmVDaGlsZCggY2xvbmUgPSBmcmFnbWVudERpdi5maXJzdENoaWxkICk7CgkJfQoKCQlpZiAoICghalF1ZXJ5LnN1cHBvcnQubm9DbG9uZUV2ZW50IHx8ICFqUXVlcnkuc3VwcG9ydC5ub0Nsb25lQ2hlY2tlZCkgJiYKCQkJCShlbGVtLm5vZGVUeXBlID09PSAxIHx8IGVsZW0ubm9kZVR5cGUgPT09IDExKSAmJiAhalF1ZXJ5LmlzWE1MRG9jKGVsZW0pICkgewoKCQkJLy8gV2UgZXNjaGV3IFNpenpsZSBoZXJlIGZvciBwZXJmb3JtYW5jZSByZWFzb25zOiBodHRwOi8vanNwZXJmLmNvbS9nZXRhbGwtdnMtc2l6emxlLzIKCQkJZGVzdEVsZW1lbnRzID0gZ2V0QWxsKCBjbG9uZSApOwoJCQlzcmNFbGVtZW50cyA9IGdldEFsbCggZWxlbSApOwoKCQkJLy8gRml4IGFsbCBJRSBjbG9uaW5nIGlzc3VlcwoJCQlmb3IgKCBpID0gMDsgKG5vZGUgPSBzcmNFbGVtZW50c1tpXSkgIT0gbnVsbDsgKytpICkgewoJCQkJLy8gRW5zdXJlIHRoYXQgdGhlIGRlc3RpbmF0aW9uIG5vZGUgaXMgbm90IG51bGw7IEZpeGVzICM5NTg3CgkJCQlpZiAoIGRlc3RFbGVtZW50c1tpXSApIHsKCQkJCQlmaXhDbG9uZU5vZGVJc3N1ZXMoIG5vZGUsIGRlc3RFbGVtZW50c1tpXSApOwoJCQkJfQoJCQl9CgkJfQoKCQkvLyBDb3B5IHRoZSBldmVudHMgZnJvbSB0aGUgb3JpZ2luYWwgdG8gdGhlIGNsb25lCgkJaWYgKCBkYXRhQW5kRXZlbnRzICkgewoJCQlpZiAoIGRlZXBEYXRhQW5kRXZlbnRzICkgewoJCQkJc3JjRWxlbWVudHMgPSBzcmNFbGVtZW50cyB8fCBnZXRBbGwoIGVsZW0gKTsKCQkJCWRlc3RFbGVtZW50cyA9IGRlc3RFbGVtZW50cyB8fCBnZXRBbGwoIGNsb25lICk7CgoJCQkJZm9yICggaSA9IDA7IChub2RlID0gc3JjRWxlbWVudHNbaV0pICE9IG51bGw7IGkrKyApIHsKCQkJCQljbG9uZUNvcHlFdmVudCggbm9kZSwgZGVzdEVsZW1lbnRzW2ldICk7CgkJCQl9CgkJCX0gZWxzZSB7CgkJCQljbG9uZUNvcHlFdmVudCggZWxlbSwgY2xvbmUgKTsKCQkJfQoJCX0KCgkJLy8gUHJlc2VydmUgc2NyaXB0IGV2YWx1YXRpb24gaGlzdG9yeQoJCWRlc3RFbGVtZW50cyA9IGdldEFsbCggY2xvbmUsICJzY3JpcHQiICk7CgkJaWYgKCBkZXN0RWxlbWVudHMubGVuZ3RoID4gMCApIHsKCQkJc2V0R2xvYmFsRXZhbCggZGVzdEVsZW1lbnRzLCAhaW5QYWdlICYmIGdldEFsbCggZWxlbSwgInNjcmlwdCIgKSApOwoJCX0KCgkJZGVzdEVsZW1lbnRzID0gc3JjRWxlbWVudHMgPSBub2RlID0gbnVsbDsKCgkJLy8gUmV0dXJuIHRoZSBjbG9uZWQgc2V0CgkJcmV0dXJuIGNsb25lOwoJfSwKCglidWlsZEZyYWdtZW50OiBmdW5jdGlvbiggZWxlbXMsIGNvbnRleHQsIHNjcmlwdHMsIHNlbGVjdGlvbiApIHsKCQl2YXIgaiwgZWxlbSwgY29udGFpbnMsCgkJCXRtcCwgdGFnLCB0Ym9keSwgd3JhcCwKCQkJbCA9IGVsZW1zLmxlbmd0aCwKCgkJCS8vIEVuc3VyZSBhIHNhZmUgZnJhZ21lbnQKCQkJc2FmZSA9IGNyZWF0ZVNhZmVGcmFnbWVudCggY29udGV4dCApLAoKCQkJbm9kZXMgPSBbXSwKCQkJaSA9IDA7CgoJCWZvciAoIDsgaSA8IGw7IGkrKyApIHsKCQkJZWxlbSA9IGVsZW1zWyBpIF07CgoJCQlpZiAoIGVsZW0gfHwgZWxlbSA9PT0gMCApIHsKCgkJCQkvLyBBZGQgbm9kZXMgZGlyZWN0bHkKCQkJCWlmICggalF1ZXJ5LnR5cGUoIGVsZW0gKSA9PT0gIm9iamVjdCIgKSB7CgkJCQkJalF1ZXJ5Lm1lcmdlKCBub2RlcywgZWxlbS5ub2RlVHlwZSA/IFsgZWxlbSBdIDogZWxlbSApOwoKCQkJCS8vIENvbnZlcnQgbm9uLWh0bWwgaW50byBhIHRleHQgbm9kZQoJCQkJfSBlbHNlIGlmICggIXJodG1sLnRlc3QoIGVsZW0gKSApIHsKCQkJCQlub2Rlcy5wdXNoKCBjb250ZXh0LmNyZWF0ZVRleHROb2RlKCBlbGVtICkgKTsKCgkJCQkvLyBDb252ZXJ0IGh0bWwgaW50byBET00gbm9kZXMKCQkJCX0gZWxzZSB7CgkJCQkJdG1wID0gdG1wIHx8IHNhZmUuYXBwZW5kQ2hpbGQoIGNvbnRleHQuY3JlYXRlRWxlbWVudCgiZGl2IikgKTsKCgkJCQkJLy8gRGVzZXJpYWxpemUgYSBzdGFuZGFyZCByZXByZXNlbnRhdGlvbgoJCQkJCXRhZyA9ICggcnRhZ05hbWUuZXhlYyggZWxlbSApIHx8IFsiIiwgIiJdIClbMV0udG9Mb3dlckNhc2UoKTsKCQkJCQl3cmFwID0gd3JhcE1hcFsgdGFnIF0gfHwgd3JhcE1hcC5fZGVmYXVsdDsKCgkJCQkJdG1wLmlubmVySFRNTCA9IHdyYXBbMV0gKyBlbGVtLnJlcGxhY2UoIHJ4aHRtbFRhZywgIjwkMT48LyQyPiIgKSArIHdyYXBbMl07CgoJCQkJCS8vIERlc2NlbmQgdGhyb3VnaCB3cmFwcGVycyB0byB0aGUgcmlnaHQgY29udGVudAoJCQkJCWogPSB3cmFwWzBdOwoJCQkJCXdoaWxlICggai0tICkgewoJCQkJCQl0bXAgPSB0bXAubGFzdENoaWxkOwoJCQkJCX0KCgkJCQkJLy8gTWFudWFsbHkgYWRkIGxlYWRpbmcgd2hpdGVzcGFjZSByZW1vdmVkIGJ5IElFCgkJCQkJaWYgKCAhalF1ZXJ5LnN1cHBvcnQubGVhZGluZ1doaXRlc3BhY2UgJiYgcmxlYWRpbmdXaGl0ZXNwYWNlLnRlc3QoIGVsZW0gKSApIHsKCQkJCQkJbm9kZXMucHVzaCggY29udGV4dC5jcmVhdGVUZXh0Tm9kZSggcmxlYWRpbmdXaGl0ZXNwYWNlLmV4ZWMoIGVsZW0gKVswXSApICk7CgkJCQkJfQoKCQkJCQkvLyBSZW1vdmUgSUUncyBhdXRvaW5zZXJ0ZWQgPHRib2R5PiBmcm9tIHRhYmxlIGZyYWdtZW50cwoJCQkJCWlmICggIWpRdWVyeS5zdXBwb3J0LnRib2R5ICkgewoKCQkJCQkJLy8gU3RyaW5nIHdhcyBhIDx0YWJsZT4sICptYXkqIGhhdmUgc3B1cmlvdXMgPHRib2R5PgoJCQkJCQllbGVtID0gdGFnID09PSAidGFibGUiICYmICFydGJvZHkudGVzdCggZWxlbSApID8KCQkJCQkJCXRtcC5maXJzdENoaWxkIDoKCgkJCQkJCQkvLyBTdHJpbmcgd2FzIGEgYmFyZSA8dGhlYWQ+IG9yIDx0Zm9vdD4KCQkJCQkJCXdyYXBbMV0gPT09ICI8dGFibGU+IiAmJiAhcnRib2R5LnRlc3QoIGVsZW0gKSA/CgkJCQkJCQkJdG1wIDoKCQkJCQkJCQkwOwoKCQkJCQkJaiA9IGVsZW0gJiYgZWxlbS5jaGlsZE5vZGVzLmxlbmd0aDsKCQkJCQkJd2hpbGUgKCBqLS0gKSB7CgkJCQkJCQlpZiAoIGpRdWVyeS5ub2RlTmFtZSggKHRib2R5ID0gZWxlbS5jaGlsZE5vZGVzW2pdKSwgInRib2R5IiApICYmICF0Ym9keS5jaGlsZE5vZGVzLmxlbmd0aCApIHsKCQkJCQkJCQllbGVtLnJlbW92ZUNoaWxkKCB0Ym9keSApOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoKCQkJCQlqUXVlcnkubWVyZ2UoIG5vZGVzLCB0bXAuY2hpbGROb2RlcyApOwoKCQkJCQkvLyBGaXggIzEyMzkyIGZvciBXZWJLaXQgYW5kIElFID4gOQoJCQkJCXRtcC50ZXh0Q29udGVudCA9ICIiOwoKCQkJCQkvLyBGaXggIzEyMzkyIGZvciBvbGRJRQoJCQkJCXdoaWxlICggdG1wLmZpcnN0Q2hpbGQgKSB7CgkJCQkJCXRtcC5yZW1vdmVDaGlsZCggdG1wLmZpcnN0Q2hpbGQgKTsKCQkJCQl9CgoJCQkJCS8vIFJlbWVtYmVyIHRoZSB0b3AtbGV2ZWwgY29udGFpbmVyIGZvciBwcm9wZXIgY2xlYW51cAoJCQkJCXRtcCA9IHNhZmUubGFzdENoaWxkOwoJCQkJfQoJCQl9CgkJfQoKCQkvLyBGaXggIzExMzU2OiBDbGVhciBlbGVtZW50cyBmcm9tIGZyYWdtZW50CgkJaWYgKCB0bXAgKSB7CgkJCXNhZmUucmVtb3ZlQ2hpbGQoIHRtcCApOwoJCX0KCgkJLy8gUmVzZXQgZGVmYXVsdENoZWNrZWQgZm9yIGFueSByYWRpb3MgYW5kIGNoZWNrYm94ZXMKCQkvLyBhYm91dCB0byBiZSBhcHBlbmRlZCB0byB0aGUgRE9NIGluIElFIDYvNyAoIzgwNjApCgkJaWYgKCAhalF1ZXJ5LnN1cHBvcnQuYXBwZW5kQ2hlY2tlZCApIHsKCQkJalF1ZXJ5LmdyZXAoIGdldEFsbCggbm9kZXMsICJpbnB1dCIgKSwgZml4RGVmYXVsdENoZWNrZWQgKTsKCQl9CgoJCWkgPSAwOwoJCXdoaWxlICggKGVsZW0gPSBub2Rlc1sgaSsrIF0pICkgewoKCQkJLy8gIzQwODcgLSBJZiBvcmlnaW4gYW5kIGRlc3RpbmF0aW9uIGVsZW1lbnRzIGFyZSB0aGUgc2FtZSwgYW5kIHRoaXMgaXMKCQkJLy8gdGhhdCBlbGVtZW50LCBkbyBub3QgZG8gYW55dGhpbmcKCQkJaWYgKCBzZWxlY3Rpb24gJiYgalF1ZXJ5LmluQXJyYXkoIGVsZW0sIHNlbGVjdGlvbiApICE9PSAtMSApIHsKCQkJCWNvbnRpbnVlOwoJCQl9CgoJCQljb250YWlucyA9IGpRdWVyeS5jb250YWlucyggZWxlbS5vd25lckRvY3VtZW50LCBlbGVtICk7CgoJCQkvLyBBcHBlbmQgdG8gZnJhZ21lbnQKCQkJdG1wID0gZ2V0QWxsKCBzYWZlLmFwcGVuZENoaWxkKCBlbGVtICksICJzY3JpcHQiICk7CgoJCQkvLyBQcmVzZXJ2ZSBzY3JpcHQgZXZhbHVhdGlvbiBoaXN0b3J5CgkJCWlmICggY29udGFpbnMgKSB7CgkJCQlzZXRHbG9iYWxFdmFsKCB0bXAgKTsKCQkJfQoKCQkJLy8gQ2FwdHVyZSBleGVjdXRhYmxlcwoJCQlpZiAoIHNjcmlwdHMgKSB7CgkJCQlqID0gMDsKCQkJCXdoaWxlICggKGVsZW0gPSB0bXBbIGorKyBdKSApIHsKCQkJCQlpZiAoIHJzY3JpcHRUeXBlLnRlc3QoIGVsZW0udHlwZSB8fCAiIiApICkgewoJCQkJCQlzY3JpcHRzLnB1c2goIGVsZW0gKTsKCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgoJCXRtcCA9IG51bGw7CgoJCXJldHVybiBzYWZlOwoJfSwKCgljbGVhbkRhdGE6IGZ1bmN0aW9uKCBlbGVtcywgLyogaW50ZXJuYWwgKi8gYWNjZXB0RGF0YSApIHsKCQl2YXIgZWxlbSwgdHlwZSwgaWQsIGRhdGEsCgkJCWkgPSAwLAoJCQlpbnRlcm5hbEtleSA9IGpRdWVyeS5leHBhbmRvLAoJCQljYWNoZSA9IGpRdWVyeS5jYWNoZSwKCQkJZGVsZXRlRXhwYW5kbyA9IGpRdWVyeS5zdXBwb3J0LmRlbGV0ZUV4cGFuZG8sCgkJCXNwZWNpYWwgPSBqUXVlcnkuZXZlbnQuc3BlY2lhbDsKCgkJZm9yICggOyAoZWxlbSA9IGVsZW1zW2ldKSAhPSBudWxsOyBpKysgKSB7CgoJCQlpZiAoIGFjY2VwdERhdGEgfHwgalF1ZXJ5LmFjY2VwdERhdGEoIGVsZW0gKSApIHsKCgkJCQlpZCA9IGVsZW1bIGludGVybmFsS2V5IF07CgkJCQlkYXRhID0gaWQgJiYgY2FjaGVbIGlkIF07CgoJCQkJaWYgKCBkYXRhICkgewoJCQkJCWlmICggZGF0YS5ldmVudHMgKSB7CgkJCQkJCWZvciAoIHR5cGUgaW4gZGF0YS5ldmVudHMgKSB7CgkJCQkJCQlpZiAoIHNwZWNpYWxbIHR5cGUgXSApIHsKCQkJCQkJCQlqUXVlcnkuZXZlbnQucmVtb3ZlKCBlbGVtLCB0eXBlICk7CgoJCQkJCQkJLy8gVGhpcyBpcyBhIHNob3J0Y3V0IHRvIGF2b2lkIGpRdWVyeS5ldmVudC5yZW1vdmUncyBvdmVyaGVhZAoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQlqUXVlcnkucmVtb3ZlRXZlbnQoIGVsZW0sIHR5cGUsIGRhdGEuaGFuZGxlICk7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9CgoJCQkJCS8vIFJlbW92ZSBjYWNoZSBvbmx5IGlmIGl0IHdhcyBub3QgYWxyZWFkeSByZW1vdmVkIGJ5IGpRdWVyeS5ldmVudC5yZW1vdmUKCQkJCQlpZiAoIGNhY2hlWyBpZCBdICkgewoKCQkJCQkJZGVsZXRlIGNhY2hlWyBpZCBdOwoKCQkJCQkJLy8gSUUgZG9lcyBub3QgYWxsb3cgdXMgdG8gZGVsZXRlIGV4cGFuZG8gcHJvcGVydGllcyBmcm9tIG5vZGVzLAoJCQkJCQkvLyBub3IgZG9lcyBpdCBoYXZlIGEgcmVtb3ZlQXR0cmlidXRlIGZ1bmN0aW9uIG9uIERvY3VtZW50IG5vZGVzOwoJCQkJCQkvLyB3ZSBtdXN0IGhhbmRsZSBhbGwgb2YgdGhlc2UgY2FzZXMKCQkJCQkJaWYgKCBkZWxldGVFeHBhbmRvICkgewoJCQkJCQkJZGVsZXRlIGVsZW1bIGludGVybmFsS2V5IF07CgoJCQkJCQl9IGVsc2UgaWYgKCB0eXBlb2YgZWxlbS5yZW1vdmVBdHRyaWJ1dGUgIT09IGNvcmVfc3RydW5kZWZpbmVkICkgewoJCQkJCQkJZWxlbS5yZW1vdmVBdHRyaWJ1dGUoIGludGVybmFsS2V5ICk7CgoJCQkJCQl9IGVsc2UgewoJCQkJCQkJZWxlbVsgaW50ZXJuYWxLZXkgXSA9IG51bGw7CgkJCQkJCX0KCgkJCQkJCWNvcmVfZGVsZXRlZElkcy5wdXNoKCBpZCApOwoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCX0KfSk7CnZhciBpZnJhbWUsIGdldFN0eWxlcywgY3VyQ1NTLAoJcmFscGhhID0gL2FscGhhXChbXildKlwpL2ksCglyb3BhY2l0eSA9IC9vcGFjaXR5XHMqPVxzKihbXildKikvLAoJcnBvc2l0aW9uID0gL14odG9wfHJpZ2h0fGJvdHRvbXxsZWZ0KSQvLAoJLy8gc3dhcHBhYmxlIGlmIGRpc3BsYXkgaXMgbm9uZSBvciBzdGFydHMgd2l0aCB0YWJsZSBleGNlcHQgInRhYmxlIiwgInRhYmxlLWNlbGwiLCBvciAidGFibGUtY2FwdGlvbiIKCS8vIHNlZSBoZXJlIGZvciBkaXNwbGF5IHZhbHVlczogaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9DU1MvZGlzcGxheQoJcmRpc3BsYXlzd2FwID0gL14obm9uZXx0YWJsZSg/IS1jW2VhXSkuKykvLAoJcm1hcmdpbiA9IC9ebWFyZ2luLywKCXJudW1zcGxpdCA9IG5ldyBSZWdFeHAoICJeKCIgKyBjb3JlX3BudW0gKyAiKSguKikkIiwgImkiICksCglybnVtbm9ucHggPSBuZXcgUmVnRXhwKCAiXigiICsgY29yZV9wbnVtICsgIikoPyFweClbYS16JV0rJCIsICJpIiApLAoJcnJlbE51bSA9IG5ldyBSZWdFeHAoICJeKFsrLV0pPSgiICsgY29yZV9wbnVtICsgIikiLCAiaSIgKSwKCWVsZW1kaXNwbGF5ID0geyBCT0RZOiAiYmxvY2siIH0sCgoJY3NzU2hvdyA9IHsgcG9zaXRpb246ICJhYnNvbHV0ZSIsIHZpc2liaWxpdHk6ICJoaWRkZW4iLCBkaXNwbGF5OiAiYmxvY2siIH0sCgljc3NOb3JtYWxUcmFuc2Zvcm0gPSB7CgkJbGV0dGVyU3BhY2luZzogMCwKCQlmb250V2VpZ2h0OiA0MDAKCX0sCgoJY3NzRXhwYW5kID0gWyAiVG9wIiwgIlJpZ2h0IiwgIkJvdHRvbSIsICJMZWZ0IiBdLAoJY3NzUHJlZml4ZXMgPSBbICJXZWJraXQiLCAiTyIsICJNb3oiLCAibXMiIF07CgovLyByZXR1cm4gYSBjc3MgcHJvcGVydHkgbWFwcGVkIHRvIGEgcG90ZW50aWFsbHkgdmVuZG9yIHByZWZpeGVkIHByb3BlcnR5CmZ1bmN0aW9uIHZlbmRvclByb3BOYW1lKCBzdHlsZSwgbmFtZSApIHsKCgkvLyBzaG9ydGN1dCBmb3IgbmFtZXMgdGhhdCBhcmUgbm90IHZlbmRvciBwcmVmaXhlZAoJaWYgKCBuYW1lIGluIHN0eWxlICkgewoJCXJldHVybiBuYW1lOwoJfQoKCS8vIGNoZWNrIGZvciB2ZW5kb3IgcHJlZml4ZWQgbmFtZXMKCXZhciBjYXBOYW1lID0gbmFtZS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIG5hbWUuc2xpY2UoMSksCgkJb3JpZ05hbWUgPSBuYW1lLAoJCWkgPSBjc3NQcmVmaXhlcy5sZW5ndGg7CgoJd2hpbGUgKCBpLS0gKSB7CgkJbmFtZSA9IGNzc1ByZWZpeGVzWyBpIF0gKyBjYXBOYW1lOwoJCWlmICggbmFtZSBpbiBzdHlsZSApIHsKCQkJcmV0dXJuIG5hbWU7CgkJfQoJfQoKCXJldHVybiBvcmlnTmFtZTsKfQoKZnVuY3Rpb24gaXNIaWRkZW4oIGVsZW0sIGVsICkgewoJLy8gaXNIaWRkZW4gbWlnaHQgYmUgY2FsbGVkIGZyb20galF1ZXJ5I2ZpbHRlciBmdW5jdGlvbjsKCS8vIGluIHRoYXQgY2FzZSwgZWxlbWVudCB3aWxsIGJlIHNlY29uZCBhcmd1bWVudAoJZWxlbSA9IGVsIHx8IGVsZW07CglyZXR1cm4galF1ZXJ5LmNzcyggZWxlbSwgImRpc3BsYXkiICkgPT09ICJub25lIiB8fCAhalF1ZXJ5LmNvbnRhaW5zKCBlbGVtLm93bmVyRG9jdW1lbnQsIGVsZW0gKTsKfQoKZnVuY3Rpb24gc2hvd0hpZGUoIGVsZW1lbnRzLCBzaG93ICkgewoJdmFyIGRpc3BsYXksIGVsZW0sIGhpZGRlbiwKCQl2YWx1ZXMgPSBbXSwKCQlpbmRleCA9IDAsCgkJbGVuZ3RoID0gZWxlbWVudHMubGVuZ3RoOwoKCWZvciAoIDsgaW5kZXggPCBsZW5ndGg7IGluZGV4KysgKSB7CgkJZWxlbSA9IGVsZW1lbnRzWyBpbmRleCBdOwoJCWlmICggIWVsZW0uc3R5bGUgKSB7CgkJCWNvbnRpbnVlOwoJCX0KCgkJdmFsdWVzWyBpbmRleCBdID0galF1ZXJ5Ll9kYXRhKCBlbGVtLCAib2xkZGlzcGxheSIgKTsKCQlkaXNwbGF5ID0gZWxlbS5zdHlsZS5kaXNwbGF5OwoJCWlmICggc2hvdyApIHsKCQkJLy8gUmVzZXQgdGhlIGlubGluZSBkaXNwbGF5IG9mIHRoaXMgZWxlbWVudCB0byBsZWFybiBpZiBpdCBpcwoJCQkvLyBiZWluZyBoaWRkZW4gYnkgY2FzY2FkZWQgcnVsZXMgb3Igbm90CgkJCWlmICggIXZhbHVlc1sgaW5kZXggXSAmJiBkaXNwbGF5ID09PSAibm9uZSIgKSB7CgkJCQllbGVtLnN0eWxlLmRpc3BsYXkgPSAiIjsKCQkJfQoKCQkJLy8gU2V0IGVsZW1lbnRzIHdoaWNoIGhhdmUgYmVlbiBvdmVycmlkZGVuIHdpdGggZGlzcGxheTogbm9uZQoJCQkvLyBpbiBhIHN0eWxlc2hlZXQgdG8gd2hhdGV2ZXIgdGhlIGRlZmF1bHQgYnJvd3NlciBzdHlsZSBpcwoJCQkvLyBmb3Igc3VjaCBhbiBlbGVtZW50CgkJCWlmICggZWxlbS5zdHlsZS5kaXNwbGF5ID09PSAiIiAmJiBpc0hpZGRlbiggZWxlbSApICkgewoJCQkJdmFsdWVzWyBpbmRleCBdID0galF1ZXJ5Ll9kYXRhKCBlbGVtLCAib2xkZGlzcGxheSIsIGNzc19kZWZhdWx0RGlzcGxheShlbGVtLm5vZGVOYW1lKSApOwoJCQl9CgkJfSBlbHNlIHsKCgkJCWlmICggIXZhbHVlc1sgaW5kZXggXSApIHsKCQkJCWhpZGRlbiA9IGlzSGlkZGVuKCBlbGVtICk7CgoJCQkJaWYgKCBkaXNwbGF5ICYmIGRpc3BsYXkgIT09ICJub25lIiB8fCAhaGlkZGVuICkgewoJCQkJCWpRdWVyeS5fZGF0YSggZWxlbSwgIm9sZGRpc3BsYXkiLCBoaWRkZW4gPyBkaXNwbGF5IDogalF1ZXJ5LmNzcyggZWxlbSwgImRpc3BsYXkiICkgKTsKCQkJCX0KCQkJfQoJCX0KCX0KCgkvLyBTZXQgdGhlIGRpc3BsYXkgb2YgbW9zdCBvZiB0aGUgZWxlbWVudHMgaW4gYSBzZWNvbmQgbG9vcAoJLy8gdG8gYXZvaWQgdGhlIGNvbnN0YW50IHJlZmxvdwoJZm9yICggaW5kZXggPSAwOyBpbmRleCA8IGxlbmd0aDsgaW5kZXgrKyApIHsKCQllbGVtID0gZWxlbWVudHNbIGluZGV4IF07CgkJaWYgKCAhZWxlbS5zdHlsZSApIHsKCQkJY29udGludWU7CgkJfQoJCWlmICggIXNob3cgfHwgZWxlbS5zdHlsZS5kaXNwbGF5ID09PSAibm9uZSIgfHwgZWxlbS5zdHlsZS5kaXNwbGF5ID09PSAiIiApIHsKCQkJZWxlbS5zdHlsZS5kaXNwbGF5ID0gc2hvdyA/IHZhbHVlc1sgaW5kZXggXSB8fCAiIiA6ICJub25lIjsKCQl9Cgl9CgoJcmV0dXJuIGVsZW1lbnRzOwp9CgpqUXVlcnkuZm4uZXh0ZW5kKHsKCWNzczogZnVuY3Rpb24oIG5hbWUsIHZhbHVlICkgewoJCXJldHVybiBqUXVlcnkuYWNjZXNzKCB0aGlzLCBmdW5jdGlvbiggZWxlbSwgbmFtZSwgdmFsdWUgKSB7CgkJCXZhciBsZW4sIHN0eWxlcywKCQkJCW1hcCA9IHt9LAoJCQkJaSA9IDA7CgoJCQlpZiAoIGpRdWVyeS5pc0FycmF5KCBuYW1lICkgKSB7CgkJCQlzdHlsZXMgPSBnZXRTdHlsZXMoIGVsZW0gKTsKCQkJCWxlbiA9IG5hbWUubGVuZ3RoOwoKCQkJCWZvciAoIDsgaSA8IGxlbjsgaSsrICkgewoJCQkJCW1hcFsgbmFtZVsgaSBdIF0gPSBqUXVlcnkuY3NzKCBlbGVtLCBuYW1lWyBpIF0sIGZhbHNlLCBzdHlsZXMgKTsKCQkJCX0KCgkJCQlyZXR1cm4gbWFwOwoJCQl9CgoJCQlyZXR1cm4gdmFsdWUgIT09IHVuZGVmaW5lZCA/CgkJCQlqUXVlcnkuc3R5bGUoIGVsZW0sIG5hbWUsIHZhbHVlICkgOgoJCQkJalF1ZXJ5LmNzcyggZWxlbSwgbmFtZSApOwoJCX0sIG5hbWUsIHZhbHVlLCBhcmd1bWVudHMubGVuZ3RoID4gMSApOwoJfSwKCXNob3c6IGZ1bmN0aW9uKCkgewoJCXJldHVybiBzaG93SGlkZSggdGhpcywgdHJ1ZSApOwoJfSwKCWhpZGU6IGZ1bmN0aW9uKCkgewoJCXJldHVybiBzaG93SGlkZSggdGhpcyApOwoJfSwKCXRvZ2dsZTogZnVuY3Rpb24oIHN0YXRlICkgewoJCXZhciBib29sID0gdHlwZW9mIHN0YXRlID09PSAiYm9vbGVhbiI7CgoJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CgkJCWlmICggYm9vbCA/IHN0YXRlIDogaXNIaWRkZW4oIHRoaXMgKSApIHsKCQkJCWpRdWVyeSggdGhpcyApLnNob3coKTsKCQkJfSBlbHNlIHsKCQkJCWpRdWVyeSggdGhpcyApLmhpZGUoKTsKCQkJfQoJCX0pOwoJfQp9KTsKCmpRdWVyeS5leHRlbmQoewoJLy8gQWRkIGluIHN0eWxlIHByb3BlcnR5IGhvb2tzIGZvciBvdmVycmlkaW5nIHRoZSBkZWZhdWx0CgkvLyBiZWhhdmlvciBvZiBnZXR0aW5nIGFuZCBzZXR0aW5nIGEgc3R5bGUgcHJvcGVydHkKCWNzc0hvb2tzOiB7CgkJb3BhY2l0eTogewoJCQlnZXQ6IGZ1bmN0aW9uKCBlbGVtLCBjb21wdXRlZCApIHsKCQkJCWlmICggY29tcHV0ZWQgKSB7CgkJCQkJLy8gV2Ugc2hvdWxkIGFsd2F5cyBnZXQgYSBudW1iZXIgYmFjayBmcm9tIG9wYWNpdHkKCQkJCQl2YXIgcmV0ID0gY3VyQ1NTKCBlbGVtLCAib3BhY2l0eSIgKTsKCQkJCQlyZXR1cm4gcmV0ID09PSAiIiA/ICIxIiA6IHJldDsKCQkJCX0KCQkJfQoJCX0KCX0sCgoJLy8gRXhjbHVkZSB0aGUgZm9sbG93aW5nIGNzcyBwcm9wZXJ0aWVzIHRvIGFkZCBweAoJY3NzTnVtYmVyOiB7CgkJImNvbHVtbkNvdW50IjogdHJ1ZSwKCQkiZmlsbE9wYWNpdHkiOiB0cnVlLAoJCSJmb250V2VpZ2h0IjogdHJ1ZSwKCQkibGluZUhlaWdodCI6IHRydWUsCgkJIm9wYWNpdHkiOiB0cnVlLAoJCSJvcnBoYW5zIjogdHJ1ZSwKCQkid2lkb3dzIjogdHJ1ZSwKCQkiekluZGV4IjogdHJ1ZSwKCQkiem9vbSI6IHRydWUKCX0sCgoJLy8gQWRkIGluIHByb3BlcnRpZXMgd2hvc2UgbmFtZXMgeW91IHdpc2ggdG8gZml4IGJlZm9yZQoJLy8gc2V0dGluZyBvciBnZXR0aW5nIHRoZSB2YWx1ZQoJY3NzUHJvcHM6IHsKCQkvLyBub3JtYWxpemUgZmxvYXQgY3NzIHByb3BlcnR5CgkJImZsb2F0IjogalF1ZXJ5LnN1cHBvcnQuY3NzRmxvYXQgPyAiY3NzRmxvYXQiIDogInN0eWxlRmxvYXQiCgl9LAoKCS8vIEdldCBhbmQgc2V0IHRoZSBzdHlsZSBwcm9wZXJ0eSBvbiBhIERPTSBOb2RlCglzdHlsZTogZnVuY3Rpb24oIGVsZW0sIG5hbWUsIHZhbHVlLCBleHRyYSApIHsKCQkvLyBEb24ndCBzZXQgc3R5bGVzIG9uIHRleHQgYW5kIGNvbW1lbnQgbm9kZXMKCQlpZiAoICFlbGVtIHx8IGVsZW0ubm9kZVR5cGUgPT09IDMgfHwgZWxlbS5ub2RlVHlwZSA9PT0gOCB8fCAhZWxlbS5zdHlsZSApIHsKCQkJcmV0dXJuOwoJCX0KCgkJLy8gTWFrZSBzdXJlIHRoYXQgd2UncmUgd29ya2luZyB3aXRoIHRoZSByaWdodCBuYW1lCgkJdmFyIHJldCwgdHlwZSwgaG9va3MsCgkJCW9yaWdOYW1lID0galF1ZXJ5LmNhbWVsQ2FzZSggbmFtZSApLAoJCQlzdHlsZSA9IGVsZW0uc3R5bGU7CgoJCW5hbWUgPSBqUXVlcnkuY3NzUHJvcHNbIG9yaWdOYW1lIF0gfHwgKCBqUXVlcnkuY3NzUHJvcHNbIG9yaWdOYW1lIF0gPSB2ZW5kb3JQcm9wTmFtZSggc3R5bGUsIG9yaWdOYW1lICkgKTsKCgkJLy8gZ2V0cyBob29rIGZvciB0aGUgcHJlZml4ZWQgdmVyc2lvbgoJCS8vIGZvbGxvd2VkIGJ5IHRoZSB1bnByZWZpeGVkIHZlcnNpb24KCQlob29rcyA9IGpRdWVyeS5jc3NIb29rc1sgbmFtZSBdIHx8IGpRdWVyeS5jc3NIb29rc1sgb3JpZ05hbWUgXTsKCgkJLy8gQ2hlY2sgaWYgd2UncmUgc2V0dGluZyBhIHZhbHVlCgkJaWYgKCB2YWx1ZSAhPT0gdW5kZWZpbmVkICkgewoJCQl0eXBlID0gdHlwZW9mIHZhbHVlOwoKCQkJLy8gY29udmVydCByZWxhdGl2ZSBudW1iZXIgc3RyaW5ncyAoKz0gb3IgLT0pIHRvIHJlbGF0aXZlIG51bWJlcnMuICM3MzQ1CgkJCWlmICggdHlwZSA9PT0gInN0cmluZyIgJiYgKHJldCA9IHJyZWxOdW0uZXhlYyggdmFsdWUgKSkgKSB7CgkJCQl2YWx1ZSA9ICggcmV0WzFdICsgMSApICogcmV0WzJdICsgcGFyc2VGbG9hdCggalF1ZXJ5LmNzcyggZWxlbSwgbmFtZSApICk7CgkJCQkvLyBGaXhlcyBidWcgIzkyMzcKCQkJCXR5cGUgPSAibnVtYmVyIjsKCQkJfQoKCQkJLy8gTWFrZSBzdXJlIHRoYXQgTmFOIGFuZCBudWxsIHZhbHVlcyBhcmVuJ3Qgc2V0LiBTZWU6ICM3MTE2CgkJCWlmICggdmFsdWUgPT0gbnVsbCB8fCB0eXBlID09PSAibnVtYmVyIiAmJiBpc05hTiggdmFsdWUgKSApIHsKCQkJCXJldHVybjsKCQkJfQoKCQkJLy8gSWYgYSBudW1iZXIgd2FzIHBhc3NlZCBpbiwgYWRkICdweCcgdG8gdGhlIChleGNlcHQgZm9yIGNlcnRhaW4gQ1NTIHByb3BlcnRpZXMpCgkJCWlmICggdHlwZSA9PT0gIm51bWJlciIgJiYgIWpRdWVyeS5jc3NOdW1iZXJbIG9yaWdOYW1lIF0gKSB7CgkJCQl2YWx1ZSArPSAicHgiOwoJCQl9CgoJCQkvLyBGaXhlcyAjODkwOCwgaXQgY2FuIGJlIGRvbmUgbW9yZSBjb3JyZWN0bHkgYnkgc3BlY2lmaW5nIHNldHRlcnMgaW4gY3NzSG9va3MsCgkJCS8vIGJ1dCBpdCB3b3VsZCBtZWFuIHRvIGRlZmluZSBlaWdodCAoZm9yIGV2ZXJ5IHByb2JsZW1hdGljIHByb3BlcnR5KSBpZGVudGljYWwgZnVuY3Rpb25zCgkJCWlmICggIWpRdWVyeS5zdXBwb3J0LmNsZWFyQ2xvbmVTdHlsZSAmJiB2YWx1ZSA9PT0gIiIgJiYgbmFtZS5pbmRleE9mKCJiYWNrZ3JvdW5kIikgPT09IDAgKSB7CgkJCQlzdHlsZVsgbmFtZSBdID0gImluaGVyaXQiOwoJCQl9CgoJCQkvLyBJZiBhIGhvb2sgd2FzIHByb3ZpZGVkLCB1c2UgdGhhdCB2YWx1ZSwgb3RoZXJ3aXNlIGp1c3Qgc2V0IHRoZSBzcGVjaWZpZWQgdmFsdWUKCQkJaWYgKCAhaG9va3MgfHwgISgic2V0IiBpbiBob29rcykgfHwgKHZhbHVlID0gaG9va3Muc2V0KCBlbGVtLCB2YWx1ZSwgZXh0cmEgKSkgIT09IHVuZGVmaW5lZCApIHsKCgkJCQkvLyBXcmFwcGVkIHRvIHByZXZlbnQgSUUgZnJvbSB0aHJvd2luZyBlcnJvcnMgd2hlbiAnaW52YWxpZCcgdmFsdWVzIGFyZSBwcm92aWRlZAoJCQkJLy8gRml4ZXMgYnVnICM1NTA5CgkJCQl0cnkgewoJCQkJCXN0eWxlWyBuYW1lIF0gPSB2YWx1ZTsKCQkJCX0gY2F0Y2goZSkge30KCQkJfQoKCQl9IGVsc2UgewoJCQkvLyBJZiBhIGhvb2sgd2FzIHByb3ZpZGVkIGdldCB0aGUgbm9uLWNvbXB1dGVkIHZhbHVlIGZyb20gdGhlcmUKCQkJaWYgKCBob29rcyAmJiAiZ2V0IiBpbiBob29rcyAmJiAocmV0ID0gaG9va3MuZ2V0KCBlbGVtLCBmYWxzZSwgZXh0cmEgKSkgIT09IHVuZGVmaW5lZCApIHsKCQkJCXJldHVybiByZXQ7CgkJCX0KCgkJCS8vIE90aGVyd2lzZSBqdXN0IGdldCB0aGUgdmFsdWUgZnJvbSB0aGUgc3R5bGUgb2JqZWN0CgkJCXJldHVybiBzdHlsZVsgbmFtZSBdOwoJCX0KCX0sCgoJY3NzOiBmdW5jdGlvbiggZWxlbSwgbmFtZSwgZXh0cmEsIHN0eWxlcyApIHsKCQl2YXIgbnVtLCB2YWwsIGhvb2tzLAoJCQlvcmlnTmFtZSA9IGpRdWVyeS5jYW1lbENhc2UoIG5hbWUgKTsKCgkJLy8gTWFrZSBzdXJlIHRoYXQgd2UncmUgd29ya2luZyB3aXRoIHRoZSByaWdodCBuYW1lCgkJbmFtZSA9IGpRdWVyeS5jc3NQcm9wc1sgb3JpZ05hbWUgXSB8fCAoIGpRdWVyeS5jc3NQcm9wc1sgb3JpZ05hbWUgXSA9IHZlbmRvclByb3BOYW1lKCBlbGVtLnN0eWxlLCBvcmlnTmFtZSApICk7CgoJCS8vIGdldHMgaG9vayBmb3IgdGhlIHByZWZpeGVkIHZlcnNpb24KCQkvLyBmb2xsb3dlZCBieSB0aGUgdW5wcmVmaXhlZCB2ZXJzaW9uCgkJaG9va3MgPSBqUXVlcnkuY3NzSG9va3NbIG5hbWUgXSB8fCBqUXVlcnkuY3NzSG9va3NbIG9yaWdOYW1lIF07CgoJCS8vIElmIGEgaG9vayB3YXMgcHJvdmlkZWQgZ2V0IHRoZSBjb21wdXRlZCB2YWx1ZSBmcm9tIHRoZXJlCgkJaWYgKCBob29rcyAmJiAiZ2V0IiBpbiBob29rcyApIHsKCQkJdmFsID0gaG9va3MuZ2V0KCBlbGVtLCB0cnVlLCBleHRyYSApOwoJCX0KCgkJLy8gT3RoZXJ3aXNlLCBpZiBhIHdheSB0byBnZXQgdGhlIGNvbXB1dGVkIHZhbHVlIGV4aXN0cywgdXNlIHRoYXQKCQlpZiAoIHZhbCA9PT0gdW5kZWZpbmVkICkgewoJCQl2YWwgPSBjdXJDU1MoIGVsZW0sIG5hbWUsIHN0eWxlcyApOwoJCX0KCgkJLy9jb252ZXJ0ICJub3JtYWwiIHRvIGNvbXB1dGVkIHZhbHVlCgkJaWYgKCB2YWwgPT09ICJub3JtYWwiICYmIG5hbWUgaW4gY3NzTm9ybWFsVHJhbnNmb3JtICkgewoJCQl2YWwgPSBjc3NOb3JtYWxUcmFuc2Zvcm1bIG5hbWUgXTsKCQl9CgoJCS8vIFJldHVybiwgY29udmVydGluZyB0byBudW1iZXIgaWYgZm9yY2VkIG9yIGEgcXVhbGlmaWVyIHdhcyBwcm92aWRlZCBhbmQgdmFsIGxvb2tzIG51bWVyaWMKCQlpZiAoIGV4dHJhID09PSAiIiB8fCBleHRyYSApIHsKCQkJbnVtID0gcGFyc2VGbG9hdCggdmFsICk7CgkJCXJldHVybiBleHRyYSA9PT0gdHJ1ZSB8fCBqUXVlcnkuaXNOdW1lcmljKCBudW0gKSA/IG51bSB8fCAwIDogdmFsOwoJCX0KCQlyZXR1cm4gdmFsOwoJfSwKCgkvLyBBIG1ldGhvZCBmb3IgcXVpY2tseSBzd2FwcGluZyBpbi9vdXQgQ1NTIHByb3BlcnRpZXMgdG8gZ2V0IGNvcnJlY3QgY2FsY3VsYXRpb25zCglzd2FwOiBmdW5jdGlvbiggZWxlbSwgb3B0aW9ucywgY2FsbGJhY2ssIGFyZ3MgKSB7CgkJdmFyIHJldCwgbmFtZSwKCQkJb2xkID0ge307CgoJCS8vIFJlbWVtYmVyIHRoZSBvbGQgdmFsdWVzLCBhbmQgaW5zZXJ0IHRoZSBuZXcgb25lcwoJCWZvciAoIG5hbWUgaW4gb3B0aW9ucyApIHsKCQkJb2xkWyBuYW1lIF0gPSBlbGVtLnN0eWxlWyBuYW1lIF07CgkJCWVsZW0uc3R5bGVbIG5hbWUgXSA9IG9wdGlvbnNbIG5hbWUgXTsKCQl9CgoJCXJldCA9IGNhbGxiYWNrLmFwcGx5KCBlbGVtLCBhcmdzIHx8IFtdICk7CgoJCS8vIFJldmVydCB0aGUgb2xkIHZhbHVlcwoJCWZvciAoIG5hbWUgaW4gb3B0aW9ucyApIHsKCQkJZWxlbS5zdHlsZVsgbmFtZSBdID0gb2xkWyBuYW1lIF07CgkJfQoKCQlyZXR1cm4gcmV0OwoJfQp9KTsKCi8vIE5PVEU6IHdlJ3ZlIGluY2x1ZGVkIHRoZSAid2luZG93IiBpbiB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZQovLyBiZWNhdXNlIGpzZG9tIG9uIG5vZGUuanMgd2lsbCBicmVhayB3aXRob3V0IGl0LgppZiAoIHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlICkgewoJZ2V0U3R5bGVzID0gZnVuY3Rpb24oIGVsZW0gKSB7CgkJcmV0dXJuIHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKCBlbGVtLCBudWxsICk7Cgl9OwoKCWN1ckNTUyA9IGZ1bmN0aW9uKCBlbGVtLCBuYW1lLCBfY29tcHV0ZWQgKSB7CgkJdmFyIHdpZHRoLCBtaW5XaWR0aCwgbWF4V2lkdGgsCgkJCWNvbXB1dGVkID0gX2NvbXB1dGVkIHx8IGdldFN0eWxlcyggZWxlbSApLAoKCQkJLy8gZ2V0UHJvcGVydHlWYWx1ZSBpcyBvbmx5IG5lZWRlZCBmb3IgLmNzcygnZmlsdGVyJykgaW4gSUU5LCBzZWUgIzEyNTM3CgkJCXJldCA9IGNvbXB1dGVkID8gY29tcHV0ZWQuZ2V0UHJvcGVydHlWYWx1ZSggbmFtZSApIHx8IGNvbXB1dGVkWyBuYW1lIF0gOiB1bmRlZmluZWQsCgkJCXN0eWxlID0gZWxlbS5zdHlsZTsKCgkJaWYgKCBjb21wdXRlZCApIHsKCgkJCWlmICggcmV0ID09PSAiIiAmJiAhalF1ZXJ5LmNvbnRhaW5zKCBlbGVtLm93bmVyRG9jdW1lbnQsIGVsZW0gKSApIHsKCQkJCXJldCA9IGpRdWVyeS5zdHlsZSggZWxlbSwgbmFtZSApOwoJCQl9CgoJCQkvLyBBIHRyaWJ1dGUgdG8gdGhlICJhd2Vzb21lIGhhY2sgYnkgRGVhbiBFZHdhcmRzIgoJCQkvLyBDaHJvbWUgPCAxNyBhbmQgU2FmYXJpIDUuMCB1c2VzICJjb21wdXRlZCB2YWx1ZSIgaW5zdGVhZCBvZiAidXNlZCB2YWx1ZSIgZm9yIG1hcmdpbi1yaWdodAoJCQkvLyBTYWZhcmkgNS4xLjcgKGF0IGxlYXN0KSByZXR1cm5zIHBlcmNlbnRhZ2UgZm9yIGEgbGFyZ2VyIHNldCBvZiB2YWx1ZXMsIGJ1dCB3aWR0aCBzZWVtcyB0byBiZSByZWxpYWJseSBwaXhlbHMKCQkJLy8gdGhpcyBpcyBhZ2FpbnN0IHRoZSBDU1NPTSBkcmFmdCBzcGVjOiBodHRwOi8vZGV2LnczLm9yZy9jc3N3Zy9jc3NvbS8jcmVzb2x2ZWQtdmFsdWVzCgkJCWlmICggcm51bW5vbnB4LnRlc3QoIHJldCApICYmIHJtYXJnaW4udGVzdCggbmFtZSApICkgewoKCQkJCS8vIFJlbWVtYmVyIHRoZSBvcmlnaW5hbCB2YWx1ZXMKCQkJCXdpZHRoID0gc3R5bGUud2lkdGg7CgkJCQltaW5XaWR0aCA9IHN0eWxlLm1pbldpZHRoOwoJCQkJbWF4V2lkdGggPSBzdHlsZS5tYXhXaWR0aDsKCgkJCQkvLyBQdXQgaW4gdGhlIG5ldyB2YWx1ZXMgdG8gZ2V0IGEgY29tcHV0ZWQgdmFsdWUgb3V0CgkJCQlzdHlsZS5taW5XaWR0aCA9IHN0eWxlLm1heFdpZHRoID0gc3R5bGUud2lkdGggPSByZXQ7CgkJCQlyZXQgPSBjb21wdXRlZC53aWR0aDsKCgkJCQkvLyBSZXZlcnQgdGhlIGNoYW5nZWQgdmFsdWVzCgkJCQlzdHlsZS53aWR0aCA9IHdpZHRoOwoJCQkJc3R5bGUubWluV2lkdGggPSBtaW5XaWR0aDsKCQkJCXN0eWxlLm1heFdpZHRoID0gbWF4V2lkdGg7CgkJCX0KCQl9CgoJCXJldHVybiByZXQ7Cgl9Owp9IGVsc2UgaWYgKCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY3VycmVudFN0eWxlICkgewoJZ2V0U3R5bGVzID0gZnVuY3Rpb24oIGVsZW0gKSB7CgkJcmV0dXJuIGVsZW0uY3VycmVudFN0eWxlOwoJfTsKCgljdXJDU1MgPSBmdW5jdGlvbiggZWxlbSwgbmFtZSwgX2NvbXB1dGVkICkgewoJCXZhciBsZWZ0LCBycywgcnNMZWZ0LAoJCQljb21wdXRlZCA9IF9jb21wdXRlZCB8fCBnZXRTdHlsZXMoIGVsZW0gKSwKCQkJcmV0ID0gY29tcHV0ZWQgPyBjb21wdXRlZFsgbmFtZSBdIDogdW5kZWZpbmVkLAoJCQlzdHlsZSA9IGVsZW0uc3R5bGU7CgoJCS8vIEF2b2lkIHNldHRpbmcgcmV0IHRvIGVtcHR5IHN0cmluZyBoZXJlCgkJLy8gc28gd2UgZG9uJ3QgZGVmYXVsdCB0byBhdXRvCgkJaWYgKCByZXQgPT0gbnVsbCAmJiBzdHlsZSAmJiBzdHlsZVsgbmFtZSBdICkgewoJCQlyZXQgPSBzdHlsZVsgbmFtZSBdOwoJCX0KCgkJLy8gRnJvbSB0aGUgYXdlc29tZSBoYWNrIGJ5IERlYW4gRWR3YXJkcwoJCS8vIGh0dHA6Ly9lcmlrLmVhZS5uZXQvYXJjaGl2ZXMvMjAwNy8wNy8yNy8xOC41NC4xNS8jY29tbWVudC0xMDIyOTEKCgkJLy8gSWYgd2UncmUgbm90IGRlYWxpbmcgd2l0aCBhIHJlZ3VsYXIgcGl4ZWwgbnVtYmVyCgkJLy8gYnV0IGEgbnVtYmVyIHRoYXQgaGFzIGEgd2VpcmQgZW5kaW5nLCB3ZSBuZWVkIHRvIGNvbnZlcnQgaXQgdG8gcGl4ZWxzCgkJLy8gYnV0IG5vdCBwb3NpdGlvbiBjc3MgYXR0cmlidXRlcywgYXMgdGhvc2UgYXJlIHByb3BvcnRpb25hbCB0byB0aGUgcGFyZW50IGVsZW1lbnQgaW5zdGVhZAoJCS8vIGFuZCB3ZSBjYW4ndCBtZWFzdXJlIHRoZSBwYXJlbnQgaW5zdGVhZCBiZWNhdXNlIGl0IG1pZ2h0IHRyaWdnZXIgYSAic3RhY2tpbmcgZG9sbHMiIHByb2JsZW0KCQlpZiAoIHJudW1ub25weC50ZXN0KCByZXQgKSAmJiAhcnBvc2l0aW9uLnRlc3QoIG5hbWUgKSApIHsKCgkJCS8vIFJlbWVtYmVyIHRoZSBvcmlnaW5hbCB2YWx1ZXMKCQkJbGVmdCA9IHN0eWxlLmxlZnQ7CgkJCXJzID0gZWxlbS5ydW50aW1lU3R5bGU7CgkJCXJzTGVmdCA9IHJzICYmIHJzLmxlZnQ7CgoJCQkvLyBQdXQgaW4gdGhlIG5ldyB2YWx1ZXMgdG8gZ2V0IGEgY29tcHV0ZWQgdmFsdWUgb3V0CgkJCWlmICggcnNMZWZ0ICkgewoJCQkJcnMubGVmdCA9IGVsZW0uY3VycmVudFN0eWxlLmxlZnQ7CgkJCX0KCQkJc3R5bGUubGVmdCA9IG5hbWUgPT09ICJmb250U2l6ZSIgPyAiMWVtIiA6IHJldDsKCQkJcmV0ID0gc3R5bGUucGl4ZWxMZWZ0ICsgInB4IjsKCgkJCS8vIFJldmVydCB0aGUgY2hhbmdlZCB2YWx1ZXMKCQkJc3R5bGUubGVmdCA9IGxlZnQ7CgkJCWlmICggcnNMZWZ0ICkgewoJCQkJcnMubGVmdCA9IHJzTGVmdDsKCQkJfQoJCX0KCgkJcmV0dXJuIHJldCA9PT0gIiIgPyAiYXV0byIgOiByZXQ7Cgl9Owp9CgpmdW5jdGlvbiBzZXRQb3NpdGl2ZU51bWJlciggZWxlbSwgdmFsdWUsIHN1YnRyYWN0ICkgewoJdmFyIG1hdGNoZXMgPSBybnVtc3BsaXQuZXhlYyggdmFsdWUgKTsKCXJldHVybiBtYXRjaGVzID8KCQkvLyBHdWFyZCBhZ2FpbnN0IHVuZGVmaW5lZCAic3VidHJhY3QiLCBlLmcuLCB3aGVuIHVzZWQgYXMgaW4gY3NzSG9va3MKCQlNYXRoLm1heCggMCwgbWF0Y2hlc1sgMSBdIC0gKCBzdWJ0cmFjdCB8fCAwICkgKSArICggbWF0Y2hlc1sgMiBdIHx8ICJweCIgKSA6CgkJdmFsdWU7Cn0KCmZ1bmN0aW9uIGF1Z21lbnRXaWR0aE9ySGVpZ2h0KCBlbGVtLCBuYW1lLCBleHRyYSwgaXNCb3JkZXJCb3gsIHN0eWxlcyApIHsKCXZhciBpID0gZXh0cmEgPT09ICggaXNCb3JkZXJCb3ggPyAiYm9yZGVyIiA6ICJjb250ZW50IiApID8KCQkvLyBJZiB3ZSBhbHJlYWR5IGhhdmUgdGhlIHJpZ2h0IG1lYXN1cmVtZW50LCBhdm9pZCBhdWdtZW50YXRpb24KCQk0IDoKCQkvLyBPdGhlcndpc2UgaW5pdGlhbGl6ZSBmb3IgaG9yaXpvbnRhbCBvciB2ZXJ0aWNhbCBwcm9wZXJ0aWVzCgkJbmFtZSA9PT0gIndpZHRoIiA/IDEgOiAwLAoKCQl2YWwgPSAwOwoKCWZvciAoIDsgaSA8IDQ7IGkgKz0gMiApIHsKCQkvLyBib3RoIGJveCBtb2RlbHMgZXhjbHVkZSBtYXJnaW4sIHNvIGFkZCBpdCBpZiB3ZSB3YW50IGl0CgkJaWYgKCBleHRyYSA9PT0gIm1hcmdpbiIgKSB7CgkJCXZhbCArPSBqUXVlcnkuY3NzKCBlbGVtLCBleHRyYSArIGNzc0V4cGFuZFsgaSBdLCB0cnVlLCBzdHlsZXMgKTsKCQl9CgoJCWlmICggaXNCb3JkZXJCb3ggKSB7CgkJCS8vIGJvcmRlci1ib3ggaW5jbHVkZXMgcGFkZGluZywgc28gcmVtb3ZlIGl0IGlmIHdlIHdhbnQgY29udGVudAoJCQlpZiAoIGV4dHJhID09PSAiY29udGVudCIgKSB7CgkJCQl2YWwgLT0galF1ZXJ5LmNzcyggZWxlbSwgInBhZGRpbmciICsgY3NzRXhwYW5kWyBpIF0sIHRydWUsIHN0eWxlcyApOwoJCQl9CgoJCQkvLyBhdCB0aGlzIHBvaW50LCBleHRyYSBpc24ndCBib3JkZXIgbm9yIG1hcmdpbiwgc28gcmVtb3ZlIGJvcmRlcgoJCQlpZiAoIGV4dHJhICE9PSAibWFyZ2luIiApIHsKCQkJCXZhbCAtPSBqUXVlcnkuY3NzKCBlbGVtLCAiYm9yZGVyIiArIGNzc0V4cGFuZFsgaSBdICsgIldpZHRoIiwgdHJ1ZSwgc3R5bGVzICk7CgkJCX0KCQl9IGVsc2UgewoJCQkvLyBhdCB0aGlzIHBvaW50LCBleHRyYSBpc24ndCBjb250ZW50LCBzbyBhZGQgcGFkZGluZwoJCQl2YWwgKz0galF1ZXJ5LmNzcyggZWxlbSwgInBhZGRpbmciICsgY3NzRXhwYW5kWyBpIF0sIHRydWUsIHN0eWxlcyApOwoKCQkJLy8gYXQgdGhpcyBwb2ludCwgZXh0cmEgaXNuJ3QgY29udGVudCBub3IgcGFkZGluZywgc28gYWRkIGJvcmRlcgoJCQlpZiAoIGV4dHJhICE9PSAicGFkZGluZyIgKSB7CgkJCQl2YWwgKz0galF1ZXJ5LmNzcyggZWxlbSwgImJvcmRlciIgKyBjc3NFeHBhbmRbIGkgXSArICJXaWR0aCIsIHRydWUsIHN0eWxlcyApOwoJCQl9CgkJfQoJfQoKCXJldHVybiB2YWw7Cn0KCmZ1bmN0aW9uIGdldFdpZHRoT3JIZWlnaHQoIGVsZW0sIG5hbWUsIGV4dHJhICkgewoKCS8vIFN0YXJ0IHdpdGggb2Zmc2V0IHByb3BlcnR5LCB3aGljaCBpcyBlcXVpdmFsZW50IHRvIHRoZSBib3JkZXItYm94IHZhbHVlCgl2YXIgdmFsdWVJc0JvcmRlckJveCA9IHRydWUsCgkJdmFsID0gbmFtZSA9PT0gIndpZHRoIiA/IGVsZW0ub2Zmc2V0V2lkdGggOiBlbGVtLm9mZnNldEhlaWdodCwKCQlzdHlsZXMgPSBnZXRTdHlsZXMoIGVsZW0gKSwKCQlpc0JvcmRlckJveCA9IGpRdWVyeS5zdXBwb3J0LmJveFNpemluZyAmJiBqUXVlcnkuY3NzKCBlbGVtLCAiYm94U2l6aW5nIiwgZmFsc2UsIHN0eWxlcyApID09PSAiYm9yZGVyLWJveCI7CgoJLy8gc29tZSBub24taHRtbCBlbGVtZW50cyByZXR1cm4gdW5kZWZpbmVkIGZvciBvZmZzZXRXaWR0aCwgc28gY2hlY2sgZm9yIG51bGwvdW5kZWZpbmVkCgkvLyBzdmcgLSBodHRwczovL2J1Z3ppbGxhLm1vemlsbGEub3JnL3Nob3dfYnVnLmNnaT9pZD02NDkyODUKCS8vIE1hdGhNTCAtIGh0dHBzOi8vYnVnemlsbGEubW96aWxsYS5vcmcvc2hvd19idWcuY2dpP2lkPTQ5MTY2OAoJaWYgKCB2YWwgPD0gMCB8fCB2YWwgPT0gbnVsbCApIHsKCQkvLyBGYWxsIGJhY2sgdG8gY29tcHV0ZWQgdGhlbiB1bmNvbXB1dGVkIGNzcyBpZiBuZWNlc3NhcnkKCQl2YWwgPSBjdXJDU1MoIGVsZW0sIG5hbWUsIHN0eWxlcyApOwoJCWlmICggdmFsIDwgMCB8fCB2YWwgPT0gbnVsbCApIHsKCQkJdmFsID0gZWxlbS5zdHlsZVsgbmFtZSBdOwoJCX0KCgkJLy8gQ29tcHV0ZWQgdW5pdCBpcyBub3QgcGl4ZWxzLiBTdG9wIGhlcmUgYW5kIHJldHVybi4KCQlpZiAoIHJudW1ub25weC50ZXN0KHZhbCkgKSB7CgkJCXJldHVybiB2YWw7CgkJfQoKCQkvLyB3ZSBuZWVkIHRoZSBjaGVjayBmb3Igc3R5bGUgaW4gY2FzZSBhIGJyb3dzZXIgd2hpY2ggcmV0dXJucyB1bnJlbGlhYmxlIHZhbHVlcwoJCS8vIGZvciBnZXRDb21wdXRlZFN0eWxlIHNpbGVudGx5IGZhbGxzIGJhY2sgdG8gdGhlIHJlbGlhYmxlIGVsZW0uc3R5bGUKCQl2YWx1ZUlzQm9yZGVyQm94ID0gaXNCb3JkZXJCb3ggJiYgKCBqUXVlcnkuc3VwcG9ydC5ib3hTaXppbmdSZWxpYWJsZSB8fCB2YWwgPT09IGVsZW0uc3R5bGVbIG5hbWUgXSApOwoKCQkvLyBOb3JtYWxpemUgIiIsIGF1dG8sIGFuZCBwcmVwYXJlIGZvciBleHRyYQoJCXZhbCA9IHBhcnNlRmxvYXQoIHZhbCApIHx8IDA7Cgl9CgoJLy8gdXNlIHRoZSBhY3RpdmUgYm94LXNpemluZyBtb2RlbCB0byBhZGQvc3VidHJhY3QgaXJyZWxldmFudCBzdHlsZXMKCXJldHVybiAoIHZhbCArCgkJYXVnbWVudFdpZHRoT3JIZWlnaHQoCgkJCWVsZW0sCgkJCW5hbWUsCgkJCWV4dHJhIHx8ICggaXNCb3JkZXJCb3ggPyAiYm9yZGVyIiA6ICJjb250ZW50IiApLAoJCQl2YWx1ZUlzQm9yZGVyQm94LAoJCQlzdHlsZXMKCQkpCgkpICsgInB4IjsKfQoKLy8gVHJ5IHRvIGRldGVybWluZSB0aGUgZGVmYXVsdCBkaXNwbGF5IHZhbHVlIG9mIGFuIGVsZW1lbnQKZnVuY3Rpb24gY3NzX2RlZmF1bHREaXNwbGF5KCBub2RlTmFtZSApIHsKCXZhciBkb2MgPSBkb2N1bWVudCwKCQlkaXNwbGF5ID0gZWxlbWRpc3BsYXlbIG5vZGVOYW1lIF07CgoJaWYgKCAhZGlzcGxheSApIHsKCQlkaXNwbGF5ID0gYWN0dWFsRGlzcGxheSggbm9kZU5hbWUsIGRvYyApOwoKCQkvLyBJZiB0aGUgc2ltcGxlIHdheSBmYWlscywgcmVhZCBmcm9tIGluc2lkZSBhbiBpZnJhbWUKCQlpZiAoIGRpc3BsYXkgPT09ICJub25lIiB8fCAhZGlzcGxheSApIHsKCQkJLy8gVXNlIHRoZSBhbHJlYWR5LWNyZWF0ZWQgaWZyYW1lIGlmIHBvc3NpYmxlCgkJCWlmcmFtZSA9ICggaWZyYW1lIHx8CgkJCQlqUXVlcnkoIjxpZnJhbWUgZnJhbWVib3JkZXI9JzAnIHdpZHRoPScwJyBoZWlnaHQ9JzAnLz4iKQoJCQkJLmNzcyggImNzc1RleHQiLCAiZGlzcGxheTpibG9jayAhaW1wb3J0YW50IiApCgkJCSkuYXBwZW5kVG8oIGRvYy5kb2N1bWVudEVsZW1lbnQgKTsKCgkJCS8vIEFsd2F5cyB3cml0ZSBhIG5ldyBIVE1MIHNrZWxldG9uIHNvIFdlYmtpdCBhbmQgRmlyZWZveCBkb24ndCBjaG9rZSBvbiByZXVzZQoJCQlkb2MgPSAoIGlmcmFtZVswXS5jb250ZW50V2luZG93IHx8IGlmcmFtZVswXS5jb250ZW50RG9jdW1lbnQgKS5kb2N1bWVudDsKCQkJZG9jLndyaXRlKCI8IWRvY3R5cGUgaHRtbD48aHRtbD48Ym9keT4iKTsKCQkJZG9jLmNsb3NlKCk7CgoJCQlkaXNwbGF5ID0gYWN0dWFsRGlzcGxheSggbm9kZU5hbWUsIGRvYyApOwoJCQlpZnJhbWUuZGV0YWNoKCk7CgkJfQoKCQkvLyBTdG9yZSB0aGUgY29ycmVjdCBkZWZhdWx0IGRpc3BsYXkKCQllbGVtZGlzcGxheVsgbm9kZU5hbWUgXSA9IGRpc3BsYXk7Cgl9CgoJcmV0dXJuIGRpc3BsYXk7Cn0KCi8vIENhbGxlZCBPTkxZIGZyb20gd2l0aGluIGNzc19kZWZhdWx0RGlzcGxheQpmdW5jdGlvbiBhY3R1YWxEaXNwbGF5KCBuYW1lLCBkb2MgKSB7Cgl2YXIgZWxlbSA9IGpRdWVyeSggZG9jLmNyZWF0ZUVsZW1lbnQoIG5hbWUgKSApLmFwcGVuZFRvKCBkb2MuYm9keSApLAoJCWRpc3BsYXkgPSBqUXVlcnkuY3NzKCBlbGVtWzBdLCAiZGlzcGxheSIgKTsKCWVsZW0ucmVtb3ZlKCk7CglyZXR1cm4gZGlzcGxheTsKfQoKalF1ZXJ5LmVhY2goWyAiaGVpZ2h0IiwgIndpZHRoIiBdLCBmdW5jdGlvbiggaSwgbmFtZSApIHsKCWpRdWVyeS5jc3NIb29rc1sgbmFtZSBdID0gewoJCWdldDogZnVuY3Rpb24oIGVsZW0sIGNvbXB1dGVkLCBleHRyYSApIHsKCQkJaWYgKCBjb21wdXRlZCApIHsKCQkJCS8vIGNlcnRhaW4gZWxlbWVudHMgY2FuIGhhdmUgZGltZW5zaW9uIGluZm8gaWYgd2UgaW52aXNpYmx5IHNob3cgdGhlbQoJCQkJLy8gaG93ZXZlciwgaXQgbXVzdCBoYXZlIGEgY3VycmVudCBkaXNwbGF5IHN0eWxlIHRoYXQgd291bGQgYmVuZWZpdCBmcm9tIHRoaXMKCQkJCXJldHVybiBlbGVtLm9mZnNldFdpZHRoID09PSAwICYmIHJkaXNwbGF5c3dhcC50ZXN0KCBqUXVlcnkuY3NzKCBlbGVtLCAiZGlzcGxheSIgKSApID8KCQkJCQlqUXVlcnkuc3dhcCggZWxlbSwgY3NzU2hvdywgZnVuY3Rpb24oKSB7CgkJCQkJCXJldHVybiBnZXRXaWR0aE9ySGVpZ2h0KCBlbGVtLCBuYW1lLCBleHRyYSApOwoJCQkJCX0pIDoKCQkJCQlnZXRXaWR0aE9ySGVpZ2h0KCBlbGVtLCBuYW1lLCBleHRyYSApOwoJCQl9CgkJfSwKCgkJc2V0OiBmdW5jdGlvbiggZWxlbSwgdmFsdWUsIGV4dHJhICkgewoJCQl2YXIgc3R5bGVzID0gZXh0cmEgJiYgZ2V0U3R5bGVzKCBlbGVtICk7CgkJCXJldHVybiBzZXRQb3NpdGl2ZU51bWJlciggZWxlbSwgdmFsdWUsIGV4dHJhID8KCQkJCWF1Z21lbnRXaWR0aE9ySGVpZ2h0KAoJCQkJCWVsZW0sCgkJCQkJbmFtZSwKCQkJCQlleHRyYSwKCQkJCQlqUXVlcnkuc3VwcG9ydC5ib3hTaXppbmcgJiYgalF1ZXJ5LmNzcyggZWxlbSwgImJveFNpemluZyIsIGZhbHNlLCBzdHlsZXMgKSA9PT0gImJvcmRlci1ib3giLAoJCQkJCXN0eWxlcwoJCQkJKSA6IDAKCQkJKTsKCQl9Cgl9Owp9KTsKCmlmICggIWpRdWVyeS5zdXBwb3J0Lm9wYWNpdHkgKSB7CglqUXVlcnkuY3NzSG9va3Mub3BhY2l0eSA9IHsKCQlnZXQ6IGZ1bmN0aW9uKCBlbGVtLCBjb21wdXRlZCApIHsKCQkJLy8gSUUgdXNlcyBmaWx0ZXJzIGZvciBvcGFjaXR5CgkJCXJldHVybiByb3BhY2l0eS50ZXN0KCAoY29tcHV0ZWQgJiYgZWxlbS5jdXJyZW50U3R5bGUgPyBlbGVtLmN1cnJlbnRTdHlsZS5maWx0ZXIgOiBlbGVtLnN0eWxlLmZpbHRlcikgfHwgIiIgKSA/CgkJCQkoIDAuMDEgKiBwYXJzZUZsb2F0KCBSZWdFeHAuJDEgKSApICsgIiIgOgoJCQkJY29tcHV0ZWQgPyAiMSIgOiAiIjsKCQl9LAoKCQlzZXQ6IGZ1bmN0aW9uKCBlbGVtLCB2YWx1ZSApIHsKCQkJdmFyIHN0eWxlID0gZWxlbS5zdHlsZSwKCQkJCWN1cnJlbnRTdHlsZSA9IGVsZW0uY3VycmVudFN0eWxlLAoJCQkJb3BhY2l0eSA9IGpRdWVyeS5pc051bWVyaWMoIHZhbHVlICkgPyAiYWxwaGEob3BhY2l0eT0iICsgdmFsdWUgKiAxMDAgKyAiKSIgOiAiIiwKCQkJCWZpbHRlciA9IGN1cnJlbnRTdHlsZSAmJiBjdXJyZW50U3R5bGUuZmlsdGVyIHx8IHN0eWxlLmZpbHRlciB8fCAiIjsKCgkJCS8vIElFIGhhcyB0cm91YmxlIHdpdGggb3BhY2l0eSBpZiBpdCBkb2VzIG5vdCBoYXZlIGxheW91dAoJCQkvLyBGb3JjZSBpdCBieSBzZXR0aW5nIHRoZSB6b29tIGxldmVsCgkJCXN0eWxlLnpvb20gPSAxOwoKCQkJLy8gaWYgc2V0dGluZyBvcGFjaXR5IHRvIDEsIGFuZCBubyBvdGhlciBmaWx0ZXJzIGV4aXN0IC0gYXR0ZW1wdCB0byByZW1vdmUgZmlsdGVyIGF0dHJpYnV0ZSAjNjY1MgoJCQkvLyBpZiB2YWx1ZSA9PT0gIiIsIHRoZW4gcmVtb3ZlIGlubGluZSBvcGFjaXR5ICMxMjY4NQoJCQlpZiAoICggdmFsdWUgPj0gMSB8fCB2YWx1ZSA9PT0gIiIgKSAmJgoJCQkJCWpRdWVyeS50cmltKCBmaWx0ZXIucmVwbGFjZSggcmFscGhhLCAiIiApICkgPT09ICIiICYmCgkJCQkJc3R5bGUucmVtb3ZlQXR0cmlidXRlICkgewoKCQkJCS8vIFNldHRpbmcgc3R5bGUuZmlsdGVyIHRvIG51bGwsICIiICYgIiAiIHN0aWxsIGxlYXZlICJmaWx0ZXI6IiBpbiB0aGUgY3NzVGV4dAoJCQkJLy8gaWYgImZpbHRlcjoiIGlzIHByZXNlbnQgYXQgYWxsLCBjbGVhclR5cGUgaXMgZGlzYWJsZWQsIHdlIHdhbnQgdG8gYXZvaWQgdGhpcwoJCQkJLy8gc3R5bGUucmVtb3ZlQXR0cmlidXRlIGlzIElFIE9ubHksIGJ1dCBzbyBhcHBhcmVudGx5IGlzIHRoaXMgY29kZSBwYXRoLi4uCgkJCQlzdHlsZS5yZW1vdmVBdHRyaWJ1dGUoICJmaWx0ZXIiICk7CgoJCQkJLy8gaWYgdGhlcmUgaXMgbm8gZmlsdGVyIHN0eWxlIGFwcGxpZWQgaW4gYSBjc3MgcnVsZSBvciB1bnNldCBpbmxpbmUgb3BhY2l0eSwgd2UgYXJlIGRvbmUKCQkJCWlmICggdmFsdWUgPT09ICIiIHx8IGN1cnJlbnRTdHlsZSAmJiAhY3VycmVudFN0eWxlLmZpbHRlciApIHsKCQkJCQlyZXR1cm47CgkJCQl9CgkJCX0KCgkJCS8vIG90aGVyd2lzZSwgc2V0IG5ldyBmaWx0ZXIgdmFsdWVzCgkJCXN0eWxlLmZpbHRlciA9IHJhbHBoYS50ZXN0KCBmaWx0ZXIgKSA/CgkJCQlmaWx0ZXIucmVwbGFjZSggcmFscGhhLCBvcGFjaXR5ICkgOgoJCQkJZmlsdGVyICsgIiAiICsgb3BhY2l0eTsKCQl9Cgl9Owp9CgovLyBUaGVzZSBob29rcyBjYW5ub3QgYmUgYWRkZWQgdW50aWwgRE9NIHJlYWR5IGJlY2F1c2UgdGhlIHN1cHBvcnQgdGVzdAovLyBmb3IgaXQgaXMgbm90IHJ1biB1bnRpbCBhZnRlciBET00gcmVhZHkKalF1ZXJ5KGZ1bmN0aW9uKCkgewoJaWYgKCAhalF1ZXJ5LnN1cHBvcnQucmVsaWFibGVNYXJnaW5SaWdodCApIHsKCQlqUXVlcnkuY3NzSG9va3MubWFyZ2luUmlnaHQgPSB7CgkJCWdldDogZnVuY3Rpb24oIGVsZW0sIGNvbXB1dGVkICkgewoJCQkJaWYgKCBjb21wdXRlZCApIHsKCQkJCQkvLyBXZWJLaXQgQnVnIDEzMzQzIC0gZ2V0Q29tcHV0ZWRTdHlsZSByZXR1cm5zIHdyb25nIHZhbHVlIGZvciBtYXJnaW4tcmlnaHQKCQkJCQkvLyBXb3JrIGFyb3VuZCBieSB0ZW1wb3JhcmlseSBzZXR0aW5nIGVsZW1lbnQgZGlzcGxheSB0byBpbmxpbmUtYmxvY2sKCQkJCQlyZXR1cm4galF1ZXJ5LnN3YXAoIGVsZW0sIHsgImRpc3BsYXkiOiAiaW5saW5lLWJsb2NrIiB9LAoJCQkJCQljdXJDU1MsIFsgZWxlbSwgIm1hcmdpblJpZ2h0IiBdICk7CgkJCQl9CgkJCX0KCQl9OwoJfQoKCS8vIFdlYmtpdCBidWc6IGh0dHBzOi8vYnVncy53ZWJraXQub3JnL3Nob3dfYnVnLmNnaT9pZD0yOTA4NAoJLy8gZ2V0Q29tcHV0ZWRTdHlsZSByZXR1cm5zIHBlcmNlbnQgd2hlbiBzcGVjaWZpZWQgZm9yIHRvcC9sZWZ0L2JvdHRvbS9yaWdodAoJLy8gcmF0aGVyIHRoYW4gbWFrZSB0aGUgY3NzIG1vZHVsZSBkZXBlbmQgb24gdGhlIG9mZnNldCBtb2R1bGUsIHdlIGp1c3QgY2hlY2sgZm9yIGl0IGhlcmUKCWlmICggIWpRdWVyeS5zdXBwb3J0LnBpeGVsUG9zaXRpb24gJiYgalF1ZXJ5LmZuLnBvc2l0aW9uICkgewoJCWpRdWVyeS5lYWNoKCBbICJ0b3AiLCAibGVmdCIgXSwgZnVuY3Rpb24oIGksIHByb3AgKSB7CgkJCWpRdWVyeS5jc3NIb29rc1sgcHJvcCBdID0gewoJCQkJZ2V0OiBmdW5jdGlvbiggZWxlbSwgY29tcHV0ZWQgKSB7CgkJCQkJaWYgKCBjb21wdXRlZCApIHsKCQkJCQkJY29tcHV0ZWQgPSBjdXJDU1MoIGVsZW0sIHByb3AgKTsKCQkJCQkJLy8gaWYgY3VyQ1NTIHJldHVybnMgcGVyY2VudGFnZSwgZmFsbGJhY2sgdG8gb2Zmc2V0CgkJCQkJCXJldHVybiBybnVtbm9ucHgudGVzdCggY29tcHV0ZWQgKSA/CgkJCQkJCQlqUXVlcnkoIGVsZW0gKS5wb3NpdGlvbigpWyBwcm9wIF0gKyAicHgiIDoKCQkJCQkJCWNvbXB1dGVkOwoJCQkJCX0KCQkJCX0KCQkJfTsKCQl9KTsKCX0KCn0pOwoKaWYgKCBqUXVlcnkuZXhwciAmJiBqUXVlcnkuZXhwci5maWx0ZXJzICkgewoJalF1ZXJ5LmV4cHIuZmlsdGVycy5oaWRkZW4gPSBmdW5jdGlvbiggZWxlbSApIHsKCQkvLyBTdXBwb3J0OiBPcGVyYSA8PSAxMi4xMgoJCS8vIE9wZXJhIHJlcG9ydHMgb2Zmc2V0V2lkdGhzIGFuZCBvZmZzZXRIZWlnaHRzIGxlc3MgdGhhbiB6ZXJvIG9uIHNvbWUgZWxlbWVudHMKCQlyZXR1cm4gZWxlbS5vZmZzZXRXaWR0aCA8PSAwICYmIGVsZW0ub2Zmc2V0SGVpZ2h0IDw9IDAgfHwKCQkJKCFqUXVlcnkuc3VwcG9ydC5yZWxpYWJsZUhpZGRlbk9mZnNldHMgJiYgKChlbGVtLnN0eWxlICYmIGVsZW0uc3R5bGUuZGlzcGxheSkgfHwgalF1ZXJ5LmNzcyggZWxlbSwgImRpc3BsYXkiICkpID09PSAibm9uZSIpOwoJfTsKCglqUXVlcnkuZXhwci5maWx0ZXJzLnZpc2libGUgPSBmdW5jdGlvbiggZWxlbSApIHsKCQlyZXR1cm4gIWpRdWVyeS5leHByLmZpbHRlcnMuaGlkZGVuKCBlbGVtICk7Cgl9Owp9CgovLyBUaGVzZSBob29rcyBhcmUgdXNlZCBieSBhbmltYXRlIHRvIGV4cGFuZCBwcm9wZXJ0aWVzCmpRdWVyeS5lYWNoKHsKCW1hcmdpbjogIiIsCglwYWRkaW5nOiAiIiwKCWJvcmRlcjogIldpZHRoIgp9LCBmdW5jdGlvbiggcHJlZml4LCBzdWZmaXggKSB7CglqUXVlcnkuY3NzSG9va3NbIHByZWZpeCArIHN1ZmZpeCBdID0gewoJCWV4cGFuZDogZnVuY3Rpb24oIHZhbHVlICkgewoJCQl2YXIgaSA9IDAsCgkJCQlleHBhbmRlZCA9IHt9LAoKCQkJCS8vIGFzc3VtZXMgYSBzaW5nbGUgbnVtYmVyIGlmIG5vdCBhIHN0cmluZwoJCQkJcGFydHMgPSB0eXBlb2YgdmFsdWUgPT09ICJzdHJpbmciID8gdmFsdWUuc3BsaXQoIiAiKSA6IFsgdmFsdWUgXTsKCgkJCWZvciAoIDsgaSA8IDQ7IGkrKyApIHsKCQkJCWV4cGFuZGVkWyBwcmVmaXggKyBjc3NFeHBhbmRbIGkgXSArIHN1ZmZpeCBdID0KCQkJCQlwYXJ0c1sgaSBdIHx8IHBhcnRzWyBpIC0gMiBdIHx8IHBhcnRzWyAwIF07CgkJCX0KCgkJCXJldHVybiBleHBhbmRlZDsKCQl9Cgl9OwoKCWlmICggIXJtYXJnaW4udGVzdCggcHJlZml4ICkgKSB7CgkJalF1ZXJ5LmNzc0hvb2tzWyBwcmVmaXggKyBzdWZmaXggXS5zZXQgPSBzZXRQb3NpdGl2ZU51bWJlcjsKCX0KfSk7CnZhciByMjAgPSAvJTIwL2csCglyYnJhY2tldCA9IC9cW1xdJC8sCglyQ1JMRiA9IC9ccj9cbi9nLAoJcnN1Ym1pdHRlclR5cGVzID0gL14oPzpzdWJtaXR8YnV0dG9ufGltYWdlfHJlc2V0fGZpbGUpJC9pLAoJcnN1Ym1pdHRhYmxlID0gL14oPzppbnB1dHxzZWxlY3R8dGV4dGFyZWF8a2V5Z2VuKS9pOwoKalF1ZXJ5LmZuLmV4dGVuZCh7CglzZXJpYWxpemU6IGZ1bmN0aW9uKCkgewoJCXJldHVybiBqUXVlcnkucGFyYW0oIHRoaXMuc2VyaWFsaXplQXJyYXkoKSApOwoJfSwKCXNlcmlhbGl6ZUFycmF5OiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5tYXAoZnVuY3Rpb24oKXsKCQkJLy8gQ2FuIGFkZCBwcm9wSG9vayBmb3IgImVsZW1lbnRzIiB0byBmaWx0ZXIgb3IgYWRkIGZvcm0gZWxlbWVudHMKCQkJdmFyIGVsZW1lbnRzID0galF1ZXJ5LnByb3AoIHRoaXMsICJlbGVtZW50cyIgKTsKCQkJcmV0dXJuIGVsZW1lbnRzID8galF1ZXJ5Lm1ha2VBcnJheSggZWxlbWVudHMgKSA6IHRoaXM7CgkJfSkKCQkuZmlsdGVyKGZ1bmN0aW9uKCl7CgkJCXZhciB0eXBlID0gdGhpcy50eXBlOwoJCQkvLyBVc2UgLmlzKCI6ZGlzYWJsZWQiKSBzbyB0aGF0IGZpZWxkc2V0W2Rpc2FibGVkXSB3b3JrcwoJCQlyZXR1cm4gdGhpcy5uYW1lICYmICFqUXVlcnkoIHRoaXMgKS5pcyggIjpkaXNhYmxlZCIgKSAmJgoJCQkJcnN1Ym1pdHRhYmxlLnRlc3QoIHRoaXMubm9kZU5hbWUgKSAmJiAhcnN1Ym1pdHRlclR5cGVzLnRlc3QoIHR5cGUgKSAmJgoJCQkJKCB0aGlzLmNoZWNrZWQgfHwgIW1hbmlwdWxhdGlvbl9yY2hlY2thYmxlVHlwZS50ZXN0KCB0eXBlICkgKTsKCQl9KQoJCS5tYXAoZnVuY3Rpb24oIGksIGVsZW0gKXsKCQkJdmFyIHZhbCA9IGpRdWVyeSggdGhpcyApLnZhbCgpOwoKCQkJcmV0dXJuIHZhbCA9PSBudWxsID8KCQkJCW51bGwgOgoJCQkJalF1ZXJ5LmlzQXJyYXkoIHZhbCApID8KCQkJCQlqUXVlcnkubWFwKCB2YWwsIGZ1bmN0aW9uKCB2YWwgKXsKCQkJCQkJcmV0dXJuIHsgbmFtZTogZWxlbS5uYW1lLCB2YWx1ZTogdmFsLnJlcGxhY2UoIHJDUkxGLCAiXHJcbiIgKSB9OwoJCQkJCX0pIDoKCQkJCQl7IG5hbWU6IGVsZW0ubmFtZSwgdmFsdWU6IHZhbC5yZXBsYWNlKCByQ1JMRiwgIlxyXG4iICkgfTsKCQl9KS5nZXQoKTsKCX0KfSk7CgovL1NlcmlhbGl6ZSBhbiBhcnJheSBvZiBmb3JtIGVsZW1lbnRzIG9yIGEgc2V0IG9mCi8va2V5L3ZhbHVlcyBpbnRvIGEgcXVlcnkgc3RyaW5nCmpRdWVyeS5wYXJhbSA9IGZ1bmN0aW9uKCBhLCB0cmFkaXRpb25hbCApIHsKCXZhciBwcmVmaXgsCgkJcyA9IFtdLAoJCWFkZCA9IGZ1bmN0aW9uKCBrZXksIHZhbHVlICkgewoJCQkvLyBJZiB2YWx1ZSBpcyBhIGZ1bmN0aW9uLCBpbnZva2UgaXQgYW5kIHJldHVybiBpdHMgdmFsdWUKCQkJdmFsdWUgPSBqUXVlcnkuaXNGdW5jdGlvbiggdmFsdWUgKSA/IHZhbHVlKCkgOiAoIHZhbHVlID09IG51bGwgPyAiIiA6IHZhbHVlICk7CgkJCXNbIHMubGVuZ3RoIF0gPSBlbmNvZGVVUklDb21wb25lbnQoIGtleSApICsgIj0iICsgZW5jb2RlVVJJQ29tcG9uZW50KCB2YWx1ZSApOwoJCX07CgoJLy8gU2V0IHRyYWRpdGlvbmFsIHRvIHRydWUgZm9yIGpRdWVyeSA8PSAxLjMuMiBiZWhhdmlvci4KCWlmICggdHJhZGl0aW9uYWwgPT09IHVuZGVmaW5lZCApIHsKCQl0cmFkaXRpb25hbCA9IGpRdWVyeS5hamF4U2V0dGluZ3MgJiYgalF1ZXJ5LmFqYXhTZXR0aW5ncy50cmFkaXRpb25hbDsKCX0KCgkvLyBJZiBhbiBhcnJheSB3YXMgcGFzc2VkIGluLCBhc3N1bWUgdGhhdCBpdCBpcyBhbiBhcnJheSBvZiBmb3JtIGVsZW1lbnRzLgoJaWYgKCBqUXVlcnkuaXNBcnJheSggYSApIHx8ICggYS5qcXVlcnkgJiYgIWpRdWVyeS5pc1BsYWluT2JqZWN0KCBhICkgKSApIHsKCQkvLyBTZXJpYWxpemUgdGhlIGZvcm0gZWxlbWVudHMKCQlqUXVlcnkuZWFjaCggYSwgZnVuY3Rpb24oKSB7CgkJCWFkZCggdGhpcy5uYW1lLCB0aGlzLnZhbHVlICk7CgkJfSk7CgoJfSBlbHNlIHsKCQkvLyBJZiB0cmFkaXRpb25hbCwgZW5jb2RlIHRoZSAib2xkIiB3YXkgKHRoZSB3YXkgMS4zLjIgb3Igb2xkZXIKCQkvLyBkaWQgaXQpLCBvdGhlcndpc2UgZW5jb2RlIHBhcmFtcyByZWN1cnNpdmVseS4KCQlmb3IgKCBwcmVmaXggaW4gYSApIHsKCQkJYnVpbGRQYXJhbXMoIHByZWZpeCwgYVsgcHJlZml4IF0sIHRyYWRpdGlvbmFsLCBhZGQgKTsKCQl9Cgl9CgoJLy8gUmV0dXJuIHRoZSByZXN1bHRpbmcgc2VyaWFsaXphdGlvbgoJcmV0dXJuIHMuam9pbiggIiYiICkucmVwbGFjZSggcjIwLCAiKyIgKTsKfTsKCmZ1bmN0aW9uIGJ1aWxkUGFyYW1zKCBwcmVmaXgsIG9iaiwgdHJhZGl0aW9uYWwsIGFkZCApIHsKCXZhciBuYW1lOwoKCWlmICggalF1ZXJ5LmlzQXJyYXkoIG9iaiApICkgewoJCS8vIFNlcmlhbGl6ZSBhcnJheSBpdGVtLgoJCWpRdWVyeS5lYWNoKCBvYmosIGZ1bmN0aW9uKCBpLCB2ICkgewoJCQlpZiAoIHRyYWRpdGlvbmFsIHx8IHJicmFja2V0LnRlc3QoIHByZWZpeCApICkgewoJCQkJLy8gVHJlYXQgZWFjaCBhcnJheSBpdGVtIGFzIGEgc2NhbGFyLgoJCQkJYWRkKCBwcmVmaXgsIHYgKTsKCgkJCX0gZWxzZSB7CgkJCQkvLyBJdGVtIGlzIG5vbi1zY2FsYXIgKGFycmF5IG9yIG9iamVjdCksIGVuY29kZSBpdHMgbnVtZXJpYyBpbmRleC4KCQkJCWJ1aWxkUGFyYW1zKCBwcmVmaXggKyAiWyIgKyAoIHR5cGVvZiB2ID09PSAib2JqZWN0IiA/IGkgOiAiIiApICsgIl0iLCB2LCB0cmFkaXRpb25hbCwgYWRkICk7CgkJCX0KCQl9KTsKCgl9IGVsc2UgaWYgKCAhdHJhZGl0aW9uYWwgJiYgalF1ZXJ5LnR5cGUoIG9iaiApID09PSAib2JqZWN0IiApIHsKCQkvLyBTZXJpYWxpemUgb2JqZWN0IGl0ZW0uCgkJZm9yICggbmFtZSBpbiBvYmogKSB7CgkJCWJ1aWxkUGFyYW1zKCBwcmVmaXggKyAiWyIgKyBuYW1lICsgIl0iLCBvYmpbIG5hbWUgXSwgdHJhZGl0aW9uYWwsIGFkZCApOwoJCX0KCgl9IGVsc2UgewoJCS8vIFNlcmlhbGl6ZSBzY2FsYXIgaXRlbS4KCQlhZGQoIHByZWZpeCwgb2JqICk7Cgl9Cn0KalF1ZXJ5LmVhY2goICgiYmx1ciBmb2N1cyBmb2N1c2luIGZvY3Vzb3V0IGxvYWQgcmVzaXplIHNjcm9sbCB1bmxvYWQgY2xpY2sgZGJsY2xpY2sgIiArCgkibW91c2Vkb3duIG1vdXNldXAgbW91c2Vtb3ZlIG1vdXNlb3ZlciBtb3VzZW91dCBtb3VzZWVudGVyIG1vdXNlbGVhdmUgIiArCgkiY2hhbmdlIHNlbGVjdCBzdWJtaXQga2V5ZG93biBrZXlwcmVzcyBrZXl1cCBlcnJvciBjb250ZXh0bWVudSIpLnNwbGl0KCIgIiksIGZ1bmN0aW9uKCBpLCBuYW1lICkgewoKCS8vIEhhbmRsZSBldmVudCBiaW5kaW5nCglqUXVlcnkuZm5bIG5hbWUgXSA9IGZ1bmN0aW9uKCBkYXRhLCBmbiApIHsKCQlyZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA+IDAgPwoJCQl0aGlzLm9uKCBuYW1lLCBudWxsLCBkYXRhLCBmbiApIDoKCQkJdGhpcy50cmlnZ2VyKCBuYW1lICk7Cgl9Owp9KTsKCmpRdWVyeS5mbi5ob3ZlciA9IGZ1bmN0aW9uKCBmbk92ZXIsIGZuT3V0ICkgewoJcmV0dXJuIHRoaXMubW91c2VlbnRlciggZm5PdmVyICkubW91c2VsZWF2ZSggZm5PdXQgfHwgZm5PdmVyICk7Cn07CnZhcgoJLy8gRG9jdW1lbnQgbG9jYXRpb24KCWFqYXhMb2NQYXJ0cywKCWFqYXhMb2NhdGlvbiwKCWFqYXhfbm9uY2UgPSBqUXVlcnkubm93KCksCgoJYWpheF9ycXVlcnkgPSAvXD8vLAoJcmhhc2ggPSAvIy4qJC8sCglydHMgPSAvKFs/Jl0pXz1bXiZdKi8sCglyaGVhZGVycyA9IC9eKC4qPyk6WyBcdF0qKFteXHJcbl0qKVxyPyQvbWcsIC8vIElFIGxlYXZlcyBhbiBcciBjaGFyYWN0ZXIgYXQgRU9MCgkvLyAjNzY1MywgIzgxMjUsICM4MTUyOiBsb2NhbCBwcm90b2NvbCBkZXRlY3Rpb24KCXJsb2NhbFByb3RvY29sID0gL14oPzphYm91dHxhcHB8YXBwLXN0b3JhZ2V8ListZXh0ZW5zaW9ufGZpbGV8cmVzfHdpZGdldCk6JC8sCglybm9Db250ZW50ID0gL14oPzpHRVR8SEVBRCkkLywKCXJwcm90b2NvbCA9IC9eXC9cLy8sCglydXJsID0gL14oW1x3ListXSs6KSg/OlwvXC8oW15cLz8jOl0qKSg/OjooXGQrKXwpfCkvLAoKCS8vIEtlZXAgYSBjb3B5IG9mIHRoZSBvbGQgbG9hZCBtZXRob2QKCV9sb2FkID0galF1ZXJ5LmZuLmxvYWQsCgoJLyogUHJlZmlsdGVycwoJICogMSkgVGhleSBhcmUgdXNlZnVsIHRvIGludHJvZHVjZSBjdXN0b20gZGF0YVR5cGVzIChzZWUgYWpheC9qc29ucC5qcyBmb3IgYW4gZXhhbXBsZSkKCSAqIDIpIFRoZXNlIGFyZSBjYWxsZWQ6CgkgKiAgICAtIEJFRk9SRSBhc2tpbmcgZm9yIGEgdHJhbnNwb3J0CgkgKiAgICAtIEFGVEVSIHBhcmFtIHNlcmlhbGl6YXRpb24gKHMuZGF0YSBpcyBhIHN0cmluZyBpZiBzLnByb2Nlc3NEYXRhIGlzIHRydWUpCgkgKiAzKSBrZXkgaXMgdGhlIGRhdGFUeXBlCgkgKiA0KSB0aGUgY2F0Y2hhbGwgc3ltYm9sICIqIiBjYW4gYmUgdXNlZAoJICogNSkgZXhlY3V0aW9uIHdpbGwgc3RhcnQgd2l0aCB0cmFuc3BvcnQgZGF0YVR5cGUgYW5kIFRIRU4gY29udGludWUgZG93biB0byAiKiIgaWYgbmVlZGVkCgkgKi8KCXByZWZpbHRlcnMgPSB7fSwKCgkvKiBUcmFuc3BvcnRzIGJpbmRpbmdzCgkgKiAxKSBrZXkgaXMgdGhlIGRhdGFUeXBlCgkgKiAyKSB0aGUgY2F0Y2hhbGwgc3ltYm9sICIqIiBjYW4gYmUgdXNlZAoJICogMykgc2VsZWN0aW9uIHdpbGwgc3RhcnQgd2l0aCB0cmFuc3BvcnQgZGF0YVR5cGUgYW5kIFRIRU4gZ28gdG8gIioiIGlmIG5lZWRlZAoJICovCgl0cmFuc3BvcnRzID0ge30sCgoJLy8gQXZvaWQgY29tbWVudC1wcm9sb2cgY2hhciBzZXF1ZW5jZSAoIzEwMDk4KTsgbXVzdCBhcHBlYXNlIGxpbnQgYW5kIGV2YWRlIGNvbXByZXNzaW9uCglhbGxUeXBlcyA9ICIqLyIuY29uY2F0KCIqIik7CgovLyAjODEzOCwgSUUgbWF5IHRocm93IGFuIGV4Y2VwdGlvbiB3aGVuIGFjY2Vzc2luZwovLyBhIGZpZWxkIGZyb20gd2luZG93LmxvY2F0aW9uIGlmIGRvY3VtZW50LmRvbWFpbiBoYXMgYmVlbiBzZXQKdHJ5IHsKCWFqYXhMb2NhdGlvbiA9IGxvY2F0aW9uLmhyZWY7Cn0gY2F0Y2goIGUgKSB7CgkvLyBVc2UgdGhlIGhyZWYgYXR0cmlidXRlIG9mIGFuIEEgZWxlbWVudAoJLy8gc2luY2UgSUUgd2lsbCBtb2RpZnkgaXQgZ2l2ZW4gZG9jdW1lbnQubG9jYXRpb24KCWFqYXhMb2NhdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICJhIiApOwoJYWpheExvY2F0aW9uLmhyZWYgPSAiIjsKCWFqYXhMb2NhdGlvbiA9IGFqYXhMb2NhdGlvbi5ocmVmOwp9CgovLyBTZWdtZW50IGxvY2F0aW9uIGludG8gcGFydHMKYWpheExvY1BhcnRzID0gcnVybC5leGVjKCBhamF4TG9jYXRpb24udG9Mb3dlckNhc2UoKSApIHx8IFtdOwoKLy8gQmFzZSAiY29uc3RydWN0b3IiIGZvciBqUXVlcnkuYWpheFByZWZpbHRlciBhbmQgalF1ZXJ5LmFqYXhUcmFuc3BvcnQKZnVuY3Rpb24gYWRkVG9QcmVmaWx0ZXJzT3JUcmFuc3BvcnRzKCBzdHJ1Y3R1cmUgKSB7CgoJLy8gZGF0YVR5cGVFeHByZXNzaW9uIGlzIG9wdGlvbmFsIGFuZCBkZWZhdWx0cyB0byAiKiIKCXJldHVybiBmdW5jdGlvbiggZGF0YVR5cGVFeHByZXNzaW9uLCBmdW5jICkgewoKCQlpZiAoIHR5cGVvZiBkYXRhVHlwZUV4cHJlc3Npb24gIT09ICJzdHJpbmciICkgewoJCQlmdW5jID0gZGF0YVR5cGVFeHByZXNzaW9uOwoJCQlkYXRhVHlwZUV4cHJlc3Npb24gPSAiKiI7CgkJfQoKCQl2YXIgZGF0YVR5cGUsCgkJCWkgPSAwLAoJCQlkYXRhVHlwZXMgPSBkYXRhVHlwZUV4cHJlc3Npb24udG9Mb3dlckNhc2UoKS5tYXRjaCggY29yZV9ybm90d2hpdGUgKSB8fCBbXTsKCgkJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggZnVuYyApICkgewoJCQkvLyBGb3IgZWFjaCBkYXRhVHlwZSBpbiB0aGUgZGF0YVR5cGVFeHByZXNzaW9uCgkJCXdoaWxlICggKGRhdGFUeXBlID0gZGF0YVR5cGVzW2krK10pICkgewoJCQkJLy8gUHJlcGVuZCBpZiByZXF1ZXN0ZWQKCQkJCWlmICggZGF0YVR5cGVbMF0gPT09ICIrIiApIHsKCQkJCQlkYXRhVHlwZSA9IGRhdGFUeXBlLnNsaWNlKCAxICkgfHwgIioiOwoJCQkJCShzdHJ1Y3R1cmVbIGRhdGFUeXBlIF0gPSBzdHJ1Y3R1cmVbIGRhdGFUeXBlIF0gfHwgW10pLnVuc2hpZnQoIGZ1bmMgKTsKCgkJCQkvLyBPdGhlcndpc2UgYXBwZW5kCgkJCQl9IGVsc2UgewoJCQkJCShzdHJ1Y3R1cmVbIGRhdGFUeXBlIF0gPSBzdHJ1Y3R1cmVbIGRhdGFUeXBlIF0gfHwgW10pLnB1c2goIGZ1bmMgKTsKCQkJCX0KCQkJfQoJCX0KCX07Cn0KCi8vIEJhc2UgaW5zcGVjdGlvbiBmdW5jdGlvbiBmb3IgcHJlZmlsdGVycyBhbmQgdHJhbnNwb3J0cwpmdW5jdGlvbiBpbnNwZWN0UHJlZmlsdGVyc09yVHJhbnNwb3J0cyggc3RydWN0dXJlLCBvcHRpb25zLCBvcmlnaW5hbE9wdGlvbnMsIGpxWEhSICkgewoKCXZhciBpbnNwZWN0ZWQgPSB7fSwKCQlzZWVraW5nVHJhbnNwb3J0ID0gKCBzdHJ1Y3R1cmUgPT09IHRyYW5zcG9ydHMgKTsKCglmdW5jdGlvbiBpbnNwZWN0KCBkYXRhVHlwZSApIHsKCQl2YXIgc2VsZWN0ZWQ7CgkJaW5zcGVjdGVkWyBkYXRhVHlwZSBdID0gdHJ1ZTsKCQlqUXVlcnkuZWFjaCggc3RydWN0dXJlWyBkYXRhVHlwZSBdIHx8IFtdLCBmdW5jdGlvbiggXywgcHJlZmlsdGVyT3JGYWN0b3J5ICkgewoJCQl2YXIgZGF0YVR5cGVPclRyYW5zcG9ydCA9IHByZWZpbHRlck9yRmFjdG9yeSggb3B0aW9ucywgb3JpZ2luYWxPcHRpb25zLCBqcVhIUiApOwoJCQlpZiggdHlwZW9mIGRhdGFUeXBlT3JUcmFuc3BvcnQgPT09ICJzdHJpbmciICYmICFzZWVraW5nVHJhbnNwb3J0ICYmICFpbnNwZWN0ZWRbIGRhdGFUeXBlT3JUcmFuc3BvcnQgXSApIHsKCQkJCW9wdGlvbnMuZGF0YVR5cGVzLnVuc2hpZnQoIGRhdGFUeXBlT3JUcmFuc3BvcnQgKTsKCQkJCWluc3BlY3QoIGRhdGFUeXBlT3JUcmFuc3BvcnQgKTsKCQkJCXJldHVybiBmYWxzZTsKCQkJfSBlbHNlIGlmICggc2Vla2luZ1RyYW5zcG9ydCApIHsKCQkJCXJldHVybiAhKCBzZWxlY3RlZCA9IGRhdGFUeXBlT3JUcmFuc3BvcnQgKTsKCQkJfQoJCX0pOwoJCXJldHVybiBzZWxlY3RlZDsKCX0KCglyZXR1cm4gaW5zcGVjdCggb3B0aW9ucy5kYXRhVHlwZXNbIDAgXSApIHx8ICFpbnNwZWN0ZWRbICIqIiBdICYmIGluc3BlY3QoICIqIiApOwp9CgovLyBBIHNwZWNpYWwgZXh0ZW5kIGZvciBhamF4IG9wdGlvbnMKLy8gdGhhdCB0YWtlcyAiZmxhdCIgb3B0aW9ucyAobm90IHRvIGJlIGRlZXAgZXh0ZW5kZWQpCi8vIEZpeGVzICM5ODg3CmZ1bmN0aW9uIGFqYXhFeHRlbmQoIHRhcmdldCwgc3JjICkgewoJdmFyIGRlZXAsIGtleSwKCQlmbGF0T3B0aW9ucyA9IGpRdWVyeS5hamF4U2V0dGluZ3MuZmxhdE9wdGlvbnMgfHwge307CgoJZm9yICgga2V5IGluIHNyYyApIHsKCQlpZiAoIHNyY1sga2V5IF0gIT09IHVuZGVmaW5lZCApIHsKCQkJKCBmbGF0T3B0aW9uc1sga2V5IF0gPyB0YXJnZXQgOiAoIGRlZXAgfHwgKGRlZXAgPSB7fSkgKSApWyBrZXkgXSA9IHNyY1sga2V5IF07CgkJfQoJfQoJaWYgKCBkZWVwICkgewoJCWpRdWVyeS5leHRlbmQoIHRydWUsIHRhcmdldCwgZGVlcCApOwoJfQoKCXJldHVybiB0YXJnZXQ7Cn0KCmpRdWVyeS5mbi5sb2FkID0gZnVuY3Rpb24oIHVybCwgcGFyYW1zLCBjYWxsYmFjayApIHsKCWlmICggdHlwZW9mIHVybCAhPT0gInN0cmluZyIgJiYgX2xvYWQgKSB7CgkJcmV0dXJuIF9sb2FkLmFwcGx5KCB0aGlzLCBhcmd1bWVudHMgKTsKCX0KCgl2YXIgc2VsZWN0b3IsIHJlc3BvbnNlLCB0eXBlLAoJCXNlbGYgPSB0aGlzLAoJCW9mZiA9IHVybC5pbmRleE9mKCIgIik7CgoJaWYgKCBvZmYgPj0gMCApIHsKCQlzZWxlY3RvciA9IHVybC5zbGljZSggb2ZmLCB1cmwubGVuZ3RoICk7CgkJdXJsID0gdXJsLnNsaWNlKCAwLCBvZmYgKTsKCX0KCgkvLyBJZiBpdCdzIGEgZnVuY3Rpb24KCWlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIHBhcmFtcyApICkgewoKCQkvLyBXZSBhc3N1bWUgdGhhdCBpdCdzIHRoZSBjYWxsYmFjawoJCWNhbGxiYWNrID0gcGFyYW1zOwoJCXBhcmFtcyA9IHVuZGVmaW5lZDsKCgkvLyBPdGhlcndpc2UsIGJ1aWxkIGEgcGFyYW0gc3RyaW5nCgl9IGVsc2UgaWYgKCBwYXJhbXMgJiYgdHlwZW9mIHBhcmFtcyA9PT0gIm9iamVjdCIgKSB7CgkJdHlwZSA9ICJQT1NUIjsKCX0KCgkvLyBJZiB3ZSBoYXZlIGVsZW1lbnRzIHRvIG1vZGlmeSwgbWFrZSB0aGUgcmVxdWVzdAoJaWYgKCBzZWxmLmxlbmd0aCA+IDAgKSB7CgkJalF1ZXJ5LmFqYXgoewoJCQl1cmw6IHVybCwKCgkJCS8vIGlmICJ0eXBlIiB2YXJpYWJsZSBpcyB1bmRlZmluZWQsIHRoZW4gIkdFVCIgbWV0aG9kIHdpbGwgYmUgdXNlZAoJCQl0eXBlOiB0eXBlLAoJCQlkYXRhVHlwZTogImh0bWwiLAoJCQlkYXRhOiBwYXJhbXMKCQl9KS5kb25lKGZ1bmN0aW9uKCByZXNwb25zZVRleHQgKSB7CgoJCQkvLyBTYXZlIHJlc3BvbnNlIGZvciB1c2UgaW4gY29tcGxldGUgY2FsbGJhY2sKCQkJcmVzcG9uc2UgPSBhcmd1bWVudHM7CgoJCQlzZWxmLmh0bWwoIHNlbGVjdG9yID8KCgkJCQkvLyBJZiBhIHNlbGVjdG9yIHdhcyBzcGVjaWZpZWQsIGxvY2F0ZSB0aGUgcmlnaHQgZWxlbWVudHMgaW4gYSBkdW1teSBkaXYKCQkJCS8vIEV4Y2x1ZGUgc2NyaXB0cyB0byBhdm9pZCBJRSAnUGVybWlzc2lvbiBEZW5pZWQnIGVycm9ycwoJCQkJalF1ZXJ5KCI8ZGl2PiIpLmFwcGVuZCggalF1ZXJ5LnBhcnNlSFRNTCggcmVzcG9uc2VUZXh0ICkgKS5maW5kKCBzZWxlY3RvciApIDoKCgkJCQkvLyBPdGhlcndpc2UgdXNlIHRoZSBmdWxsIHJlc3VsdAoJCQkJcmVzcG9uc2VUZXh0ICk7CgoJCX0pLmNvbXBsZXRlKCBjYWxsYmFjayAmJiBmdW5jdGlvbigganFYSFIsIHN0YXR1cyApIHsKCQkJc2VsZi5lYWNoKCBjYWxsYmFjaywgcmVzcG9uc2UgfHwgWyBqcVhIUi5yZXNwb25zZVRleHQsIHN0YXR1cywganFYSFIgXSApOwoJCX0pOwoJfQoKCXJldHVybiB0aGlzOwp9OwoKLy8gQXR0YWNoIGEgYnVuY2ggb2YgZnVuY3Rpb25zIGZvciBoYW5kbGluZyBjb21tb24gQUpBWCBldmVudHMKalF1ZXJ5LmVhY2goIFsgImFqYXhTdGFydCIsICJhamF4U3RvcCIsICJhamF4Q29tcGxldGUiLCAiYWpheEVycm9yIiwgImFqYXhTdWNjZXNzIiwgImFqYXhTZW5kIiBdLCBmdW5jdGlvbiggaSwgdHlwZSApewoJalF1ZXJ5LmZuWyB0eXBlIF0gPSBmdW5jdGlvbiggZm4gKXsKCQlyZXR1cm4gdGhpcy5vbiggdHlwZSwgZm4gKTsKCX07Cn0pOwoKalF1ZXJ5LmVhY2goIFsgImdldCIsICJwb3N0IiBdLCBmdW5jdGlvbiggaSwgbWV0aG9kICkgewoJalF1ZXJ5WyBtZXRob2QgXSA9IGZ1bmN0aW9uKCB1cmwsIGRhdGEsIGNhbGxiYWNrLCB0eXBlICkgewoJCS8vIHNoaWZ0IGFyZ3VtZW50cyBpZiBkYXRhIGFyZ3VtZW50IHdhcyBvbWl0dGVkCgkJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggZGF0YSApICkgewoJCQl0eXBlID0gdHlwZSB8fCBjYWxsYmFjazsKCQkJY2FsbGJhY2sgPSBkYXRhOwoJCQlkYXRhID0gdW5kZWZpbmVkOwoJCX0KCgkJcmV0dXJuIGpRdWVyeS5hamF4KHsKCQkJdXJsOiB1cmwsCgkJCXR5cGU6IG1ldGhvZCwKCQkJZGF0YVR5cGU6IHR5cGUsCgkJCWRhdGE6IGRhdGEsCgkJCXN1Y2Nlc3M6IGNhbGxiYWNrCgkJfSk7Cgl9Owp9KTsKCmpRdWVyeS5leHRlbmQoewoKCS8vIENvdW50ZXIgZm9yIGhvbGRpbmcgdGhlIG51bWJlciBvZiBhY3RpdmUgcXVlcmllcwoJYWN0aXZlOiAwLAoKCS8vIExhc3QtTW9kaWZpZWQgaGVhZGVyIGNhY2hlIGZvciBuZXh0IHJlcXVlc3QKCWxhc3RNb2RpZmllZDoge30sCglldGFnOiB7fSwKCglhamF4U2V0dGluZ3M6IHsKCQl1cmw6IGFqYXhMb2NhdGlvbiwKCQl0eXBlOiAiR0VUIiwKCQlpc0xvY2FsOiBybG9jYWxQcm90b2NvbC50ZXN0KCBhamF4TG9jUGFydHNbIDEgXSApLAoJCWdsb2JhbDogdHJ1ZSwKCQlwcm9jZXNzRGF0YTogdHJ1ZSwKCQlhc3luYzogdHJ1ZSwKCQljb250ZW50VHlwZTogImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZDsgY2hhcnNldD1VVEYtOCIsCgkJLyoKCQl0aW1lb3V0OiAwLAoJCWRhdGE6IG51bGwsCgkJZGF0YVR5cGU6IG51bGwsCgkJdXNlcm5hbWU6IG51bGwsCgkJcGFzc3dvcmQ6IG51bGwsCgkJY2FjaGU6IG51bGwsCgkJdGhyb3dzOiBmYWxzZSwKCQl0cmFkaXRpb25hbDogZmFsc2UsCgkJaGVhZGVyczoge30sCgkJKi8KCgkJYWNjZXB0czogewoJCQkiKiI6IGFsbFR5cGVzLAoJCQl0ZXh0OiAidGV4dC9wbGFpbiIsCgkJCWh0bWw6ICJ0ZXh0L2h0bWwiLAoJCQl4bWw6ICJhcHBsaWNhdGlvbi94bWwsIHRleHQveG1sIiwKCQkJanNvbjogImFwcGxpY2F0aW9uL2pzb24sIHRleHQvamF2YXNjcmlwdCIKCQl9LAoKCQljb250ZW50czogewoJCQl4bWw6IC94bWwvLAoJCQlodG1sOiAvaHRtbC8sCgkJCWpzb246IC9qc29uLwoJCX0sCgoJCXJlc3BvbnNlRmllbGRzOiB7CgkJCXhtbDogInJlc3BvbnNlWE1MIiwKCQkJdGV4dDogInJlc3BvbnNlVGV4dCIKCQl9LAoKCQkvLyBEYXRhIGNvbnZlcnRlcnMKCQkvLyBLZXlzIHNlcGFyYXRlIHNvdXJjZSAob3IgY2F0Y2hhbGwgIioiKSBhbmQgZGVzdGluYXRpb24gdHlwZXMgd2l0aCBhIHNpbmdsZSBzcGFjZQoJCWNvbnZlcnRlcnM6IHsKCgkJCS8vIENvbnZlcnQgYW55dGhpbmcgdG8gdGV4dAoJCQkiKiB0ZXh0Ijogd2luZG93LlN0cmluZywKCgkJCS8vIFRleHQgdG8gaHRtbCAodHJ1ZSA9IG5vIHRyYW5zZm9ybWF0aW9uKQoJCQkidGV4dCBodG1sIjogdHJ1ZSwKCgkJCS8vIEV2YWx1YXRlIHRleHQgYXMgYSBqc29uIGV4cHJlc3Npb24KCQkJInRleHQganNvbiI6IGpRdWVyeS5wYXJzZUpTT04sCgoJCQkvLyBQYXJzZSB0ZXh0IGFzIHhtbAoJCQkidGV4dCB4bWwiOiBqUXVlcnkucGFyc2VYTUwKCQl9LAoKCQkvLyBGb3Igb3B0aW9ucyB0aGF0IHNob3VsZG4ndCBiZSBkZWVwIGV4dGVuZGVkOgoJCS8vIHlvdSBjYW4gYWRkIHlvdXIgb3duIGN1c3RvbSBvcHRpb25zIGhlcmUgaWYKCQkvLyBhbmQgd2hlbiB5b3UgY3JlYXRlIG9uZSB0aGF0IHNob3VsZG4ndCBiZQoJCS8vIGRlZXAgZXh0ZW5kZWQgKHNlZSBhamF4RXh0ZW5kKQoJCWZsYXRPcHRpb25zOiB7CgkJCXVybDogdHJ1ZSwKCQkJY29udGV4dDogdHJ1ZQoJCX0KCX0sCgoJLy8gQ3JlYXRlcyBhIGZ1bGwgZmxlZGdlZCBzZXR0aW5ncyBvYmplY3QgaW50byB0YXJnZXQKCS8vIHdpdGggYm90aCBhamF4U2V0dGluZ3MgYW5kIHNldHRpbmdzIGZpZWxkcy4KCS8vIElmIHRhcmdldCBpcyBvbWl0dGVkLCB3cml0ZXMgaW50byBhamF4U2V0dGluZ3MuCglhamF4U2V0dXA6IGZ1bmN0aW9uKCB0YXJnZXQsIHNldHRpbmdzICkgewoJCXJldHVybiBzZXR0aW5ncyA/CgoJCQkvLyBCdWlsZGluZyBhIHNldHRpbmdzIG9iamVjdAoJCQlhamF4RXh0ZW5kKCBhamF4RXh0ZW5kKCB0YXJnZXQsIGpRdWVyeS5hamF4U2V0dGluZ3MgKSwgc2V0dGluZ3MgKSA6CgoJCQkvLyBFeHRlbmRpbmcgYWpheFNldHRpbmdzCgkJCWFqYXhFeHRlbmQoIGpRdWVyeS5hamF4U2V0dGluZ3MsIHRhcmdldCApOwoJfSwKCglhamF4UHJlZmlsdGVyOiBhZGRUb1ByZWZpbHRlcnNPclRyYW5zcG9ydHMoIHByZWZpbHRlcnMgKSwKCWFqYXhUcmFuc3BvcnQ6IGFkZFRvUHJlZmlsdGVyc09yVHJhbnNwb3J0cyggdHJhbnNwb3J0cyApLAoKCS8vIE1haW4gbWV0aG9kCglhamF4OiBmdW5jdGlvbiggdXJsLCBvcHRpb25zICkgewoKCQkvLyBJZiB1cmwgaXMgYW4gb2JqZWN0LCBzaW11bGF0ZSBwcmUtMS41IHNpZ25hdHVyZQoJCWlmICggdHlwZW9mIHVybCA9PT0gIm9iamVjdCIgKSB7CgkJCW9wdGlvbnMgPSB1cmw7CgkJCXVybCA9IHVuZGVmaW5lZDsKCQl9CgoJCS8vIEZvcmNlIG9wdGlvbnMgdG8gYmUgYW4gb2JqZWN0CgkJb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CgoJCXZhciAvLyBDcm9zcy1kb21haW4gZGV0ZWN0aW9uIHZhcnMKCQkJcGFydHMsCgkJCS8vIExvb3AgdmFyaWFibGUKCQkJaSwKCQkJLy8gVVJMIHdpdGhvdXQgYW50aS1jYWNoZSBwYXJhbQoJCQljYWNoZVVSTCwKCQkJLy8gUmVzcG9uc2UgaGVhZGVycyBhcyBzdHJpbmcKCQkJcmVzcG9uc2VIZWFkZXJzU3RyaW5nLAoJCQkvLyB0aW1lb3V0IGhhbmRsZQoJCQl0aW1lb3V0VGltZXIsCgoJCQkvLyBUbyBrbm93IGlmIGdsb2JhbCBldmVudHMgYXJlIHRvIGJlIGRpc3BhdGNoZWQKCQkJZmlyZUdsb2JhbHMsCgoJCQl0cmFuc3BvcnQsCgkJCS8vIFJlc3BvbnNlIGhlYWRlcnMKCQkJcmVzcG9uc2VIZWFkZXJzLAoJCQkvLyBDcmVhdGUgdGhlIGZpbmFsIG9wdGlvbnMgb2JqZWN0CgkJCXMgPSBqUXVlcnkuYWpheFNldHVwKCB7fSwgb3B0aW9ucyApLAoJCQkvLyBDYWxsYmFja3MgY29udGV4dAoJCQljYWxsYmFja0NvbnRleHQgPSBzLmNvbnRleHQgfHwgcywKCQkJLy8gQ29udGV4dCBmb3IgZ2xvYmFsIGV2ZW50cyBpcyBjYWxsYmFja0NvbnRleHQgaWYgaXQgaXMgYSBET00gbm9kZSBvciBqUXVlcnkgY29sbGVjdGlvbgoJCQlnbG9iYWxFdmVudENvbnRleHQgPSBzLmNvbnRleHQgJiYgKCBjYWxsYmFja0NvbnRleHQubm9kZVR5cGUgfHwgY2FsbGJhY2tDb250ZXh0LmpxdWVyeSApID8KCQkJCWpRdWVyeSggY2FsbGJhY2tDb250ZXh0ICkgOgoJCQkJalF1ZXJ5LmV2ZW50LAoJCQkvLyBEZWZlcnJlZHMKCQkJZGVmZXJyZWQgPSBqUXVlcnkuRGVmZXJyZWQoKSwKCQkJY29tcGxldGVEZWZlcnJlZCA9IGpRdWVyeS5DYWxsYmFja3MoIm9uY2UgbWVtb3J5IiksCgkJCS8vIFN0YXR1cy1kZXBlbmRlbnQgY2FsbGJhY2tzCgkJCXN0YXR1c0NvZGUgPSBzLnN0YXR1c0NvZGUgfHwge30sCgkJCS8vIEhlYWRlcnMgKHRoZXkgYXJlIHNlbnQgYWxsIGF0IG9uY2UpCgkJCXJlcXVlc3RIZWFkZXJzID0ge30sCgkJCXJlcXVlc3RIZWFkZXJzTmFtZXMgPSB7fSwKCQkJLy8gVGhlIGpxWEhSIHN0YXRlCgkJCXN0YXRlID0gMCwKCQkJLy8gRGVmYXVsdCBhYm9ydCBtZXNzYWdlCgkJCXN0ckFib3J0ID0gImNhbmNlbGVkIiwKCQkJLy8gRmFrZSB4aHIKCQkJanFYSFIgPSB7CgkJCQlyZWFkeVN0YXRlOiAwLAoKCQkJCS8vIEJ1aWxkcyBoZWFkZXJzIGhhc2h0YWJsZSBpZiBuZWVkZWQKCQkJCWdldFJlc3BvbnNlSGVhZGVyOiBmdW5jdGlvbigga2V5ICkgewoJCQkJCXZhciBtYXRjaDsKCQkJCQlpZiAoIHN0YXRlID09PSAyICkgewoJCQkJCQlpZiAoICFyZXNwb25zZUhlYWRlcnMgKSB7CgkJCQkJCQlyZXNwb25zZUhlYWRlcnMgPSB7fTsKCQkJCQkJCXdoaWxlICggKG1hdGNoID0gcmhlYWRlcnMuZXhlYyggcmVzcG9uc2VIZWFkZXJzU3RyaW5nICkpICkgewoJCQkJCQkJCXJlc3BvbnNlSGVhZGVyc1sgbWF0Y2hbMV0udG9Mb3dlckNhc2UoKSBdID0gbWF0Y2hbIDIgXTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQltYXRjaCA9IHJlc3BvbnNlSGVhZGVyc1sga2V5LnRvTG93ZXJDYXNlKCkgXTsKCQkJCQl9CgkJCQkJcmV0dXJuIG1hdGNoID09IG51bGwgPyBudWxsIDogbWF0Y2g7CgkJCQl9LAoKCQkJCS8vIFJhdyBzdHJpbmcKCQkJCWdldEFsbFJlc3BvbnNlSGVhZGVyczogZnVuY3Rpb24oKSB7CgkJCQkJcmV0dXJuIHN0YXRlID09PSAyID8gcmVzcG9uc2VIZWFkZXJzU3RyaW5nIDogbnVsbDsKCQkJCX0sCgoJCQkJLy8gQ2FjaGVzIHRoZSBoZWFkZXIKCQkJCXNldFJlcXVlc3RIZWFkZXI6IGZ1bmN0aW9uKCBuYW1lLCB2YWx1ZSApIHsKCQkJCQl2YXIgbG5hbWUgPSBuYW1lLnRvTG93ZXJDYXNlKCk7CgkJCQkJaWYgKCAhc3RhdGUgKSB7CgkJCQkJCW5hbWUgPSByZXF1ZXN0SGVhZGVyc05hbWVzWyBsbmFtZSBdID0gcmVxdWVzdEhlYWRlcnNOYW1lc1sgbG5hbWUgXSB8fCBuYW1lOwoJCQkJCQlyZXF1ZXN0SGVhZGVyc1sgbmFtZSBdID0gdmFsdWU7CgkJCQkJfQoJCQkJCXJldHVybiB0aGlzOwoJCQkJfSwKCgkJCQkvLyBPdmVycmlkZXMgcmVzcG9uc2UgY29udGVudC10eXBlIGhlYWRlcgoJCQkJb3ZlcnJpZGVNaW1lVHlwZTogZnVuY3Rpb24oIHR5cGUgKSB7CgkJCQkJaWYgKCAhc3RhdGUgKSB7CgkJCQkJCXMubWltZVR5cGUgPSB0eXBlOwoJCQkJCX0KCQkJCQlyZXR1cm4gdGhpczsKCQkJCX0sCgoJCQkJLy8gU3RhdHVzLWRlcGVuZGVudCBjYWxsYmFja3MKCQkJCXN0YXR1c0NvZGU6IGZ1bmN0aW9uKCBtYXAgKSB7CgkJCQkJdmFyIGNvZGU7CgkJCQkJaWYgKCBtYXAgKSB7CgkJCQkJCWlmICggc3RhdGUgPCAyICkgewoJCQkJCQkJZm9yICggY29kZSBpbiBtYXAgKSB7CgkJCQkJCQkJLy8gTGF6eS1hZGQgdGhlIG5ldyBjYWxsYmFjayBpbiBhIHdheSB0aGF0IHByZXNlcnZlcyBvbGQgb25lcwoJCQkJCQkJCXN0YXR1c0NvZGVbIGNvZGUgXSA9IFsgc3RhdHVzQ29kZVsgY29kZSBdLCBtYXBbIGNvZGUgXSBdOwoJCQkJCQkJfQoJCQkJCQl9IGVsc2UgewoJCQkJCQkJLy8gRXhlY3V0ZSB0aGUgYXBwcm9wcmlhdGUgY2FsbGJhY2tzCgkJCQkJCQlqcVhIUi5hbHdheXMoIG1hcFsganFYSFIuc3RhdHVzIF0gKTsKCQkJCQkJfQoJCQkJCX0KCQkJCQlyZXR1cm4gdGhpczsKCQkJCX0sCgoJCQkJLy8gQ2FuY2VsIHRoZSByZXF1ZXN0CgkJCQlhYm9ydDogZnVuY3Rpb24oIHN0YXR1c1RleHQgKSB7CgkJCQkJdmFyIGZpbmFsVGV4dCA9IHN0YXR1c1RleHQgfHwgc3RyQWJvcnQ7CgkJCQkJaWYgKCB0cmFuc3BvcnQgKSB7CgkJCQkJCXRyYW5zcG9ydC5hYm9ydCggZmluYWxUZXh0ICk7CgkJCQkJfQoJCQkJCWRvbmUoIDAsIGZpbmFsVGV4dCApOwoJCQkJCXJldHVybiB0aGlzOwoJCQkJfQoJCQl9OwoKCQkvLyBBdHRhY2ggZGVmZXJyZWRzCgkJZGVmZXJyZWQucHJvbWlzZSgganFYSFIgKS5jb21wbGV0ZSA9IGNvbXBsZXRlRGVmZXJyZWQuYWRkOwoJCWpxWEhSLnN1Y2Nlc3MgPSBqcVhIUi5kb25lOwoJCWpxWEhSLmVycm9yID0ganFYSFIuZmFpbDsKCgkJLy8gUmVtb3ZlIGhhc2ggY2hhcmFjdGVyICgjNzUzMTogYW5kIHN0cmluZyBwcm9tb3Rpb24pCgkJLy8gQWRkIHByb3RvY29sIGlmIG5vdCBwcm92aWRlZCAoIzU4NjY6IElFNyBpc3N1ZSB3aXRoIHByb3RvY29sLWxlc3MgdXJscykKCQkvLyBIYW5kbGUgZmFsc3kgdXJsIGluIHRoZSBzZXR0aW5ncyBvYmplY3QgKCMxMDA5MzogY29uc2lzdGVuY3kgd2l0aCBvbGQgc2lnbmF0dXJlKQoJCS8vIFdlIGFsc28gdXNlIHRoZSB1cmwgcGFyYW1ldGVyIGlmIGF2YWlsYWJsZQoJCXMudXJsID0gKCAoIHVybCB8fCBzLnVybCB8fCBhamF4TG9jYXRpb24gKSArICIiICkucmVwbGFjZSggcmhhc2gsICIiICkucmVwbGFjZSggcnByb3RvY29sLCBhamF4TG9jUGFydHNbIDEgXSArICIvLyIgKTsKCgkJLy8gQWxpYXMgbWV0aG9kIG9wdGlvbiB0byB0eXBlIGFzIHBlciB0aWNrZXQgIzEyMDA0CgkJcy50eXBlID0gb3B0aW9ucy5tZXRob2QgfHwgb3B0aW9ucy50eXBlIHx8IHMubWV0aG9kIHx8IHMudHlwZTsKCgkJLy8gRXh0cmFjdCBkYXRhVHlwZXMgbGlzdAoJCXMuZGF0YVR5cGVzID0galF1ZXJ5LnRyaW0oIHMuZGF0YVR5cGUgfHwgIioiICkudG9Mb3dlckNhc2UoKS5tYXRjaCggY29yZV9ybm90d2hpdGUgKSB8fCBbIiJdOwoKCQkvLyBBIGNyb3NzLWRvbWFpbiByZXF1ZXN0IGlzIGluIG9yZGVyIHdoZW4gd2UgaGF2ZSBhIHByb3RvY29sOmhvc3Q6cG9ydCBtaXNtYXRjaAoJCWlmICggcy5jcm9zc0RvbWFpbiA9PSBudWxsICkgewoJCQlwYXJ0cyA9IHJ1cmwuZXhlYyggcy51cmwudG9Mb3dlckNhc2UoKSApOwoJCQlzLmNyb3NzRG9tYWluID0gISEoIHBhcnRzICYmCgkJCQkoIHBhcnRzWyAxIF0gIT09IGFqYXhMb2NQYXJ0c1sgMSBdIHx8IHBhcnRzWyAyIF0gIT09IGFqYXhMb2NQYXJ0c1sgMiBdIHx8CgkJCQkJKCBwYXJ0c1sgMyBdIHx8ICggcGFydHNbIDEgXSA9PT0gImh0dHA6IiA/IDgwIDogNDQzICkgKSAhPQoJCQkJCQkoIGFqYXhMb2NQYXJ0c1sgMyBdIHx8ICggYWpheExvY1BhcnRzWyAxIF0gPT09ICJodHRwOiIgPyA4MCA6IDQ0MyApICkgKQoJCQkpOwoJCX0KCgkJLy8gQ29udmVydCBkYXRhIGlmIG5vdCBhbHJlYWR5IGEgc3RyaW5nCgkJaWYgKCBzLmRhdGEgJiYgcy5wcm9jZXNzRGF0YSAmJiB0eXBlb2Ygcy5kYXRhICE9PSAic3RyaW5nIiApIHsKCQkJcy5kYXRhID0galF1ZXJ5LnBhcmFtKCBzLmRhdGEsIHMudHJhZGl0aW9uYWwgKTsKCQl9CgoJCS8vIEFwcGx5IHByZWZpbHRlcnMKCQlpbnNwZWN0UHJlZmlsdGVyc09yVHJhbnNwb3J0cyggcHJlZmlsdGVycywgcywgb3B0aW9ucywganFYSFIgKTsKCgkJLy8gSWYgcmVxdWVzdCB3YXMgYWJvcnRlZCBpbnNpZGUgYSBwcmVmaWx0ZXIsIHN0b3AgdGhlcmUKCQlpZiAoIHN0YXRlID09PSAyICkgewoJCQlyZXR1cm4ganFYSFI7CgkJfQoKCQkvLyBXZSBjYW4gZmlyZSBnbG9iYWwgZXZlbnRzIGFzIG9mIG5vdyBpZiBhc2tlZCB0bwoJCWZpcmVHbG9iYWxzID0gcy5nbG9iYWw7CgoJCS8vIFdhdGNoIGZvciBhIG5ldyBzZXQgb2YgcmVxdWVzdHMKCQlpZiAoIGZpcmVHbG9iYWxzICYmIGpRdWVyeS5hY3RpdmUrKyA9PT0gMCApIHsKCQkJalF1ZXJ5LmV2ZW50LnRyaWdnZXIoImFqYXhTdGFydCIpOwoJCX0KCgkJLy8gVXBwZXJjYXNlIHRoZSB0eXBlCgkJcy50eXBlID0gcy50eXBlLnRvVXBwZXJDYXNlKCk7CgoJCS8vIERldGVybWluZSBpZiByZXF1ZXN0IGhhcyBjb250ZW50CgkJcy5oYXNDb250ZW50ID0gIXJub0NvbnRlbnQudGVzdCggcy50eXBlICk7CgoJCS8vIFNhdmUgdGhlIFVSTCBpbiBjYXNlIHdlJ3JlIHRveWluZyB3aXRoIHRoZSBJZi1Nb2RpZmllZC1TaW5jZQoJCS8vIGFuZC9vciBJZi1Ob25lLU1hdGNoIGhlYWRlciBsYXRlciBvbgoJCWNhY2hlVVJMID0gcy51cmw7CgoJCS8vIE1vcmUgb3B0aW9ucyBoYW5kbGluZyBmb3IgcmVxdWVzdHMgd2l0aCBubyBjb250ZW50CgkJaWYgKCAhcy5oYXNDb250ZW50ICkgewoKCQkJLy8gSWYgZGF0YSBpcyBhdmFpbGFibGUsIGFwcGVuZCBkYXRhIHRvIHVybAoJCQlpZiAoIHMuZGF0YSApIHsKCQkJCWNhY2hlVVJMID0gKCBzLnVybCArPSAoIGFqYXhfcnF1ZXJ5LnRlc3QoIGNhY2hlVVJMICkgPyAiJiIgOiAiPyIgKSArIHMuZGF0YSApOwoJCQkJLy8gIzk2ODI6IHJlbW92ZSBkYXRhIHNvIHRoYXQgaXQncyBub3QgdXNlZCBpbiBhbiBldmVudHVhbCByZXRyeQoJCQkJZGVsZXRlIHMuZGF0YTsKCQkJfQoKCQkJLy8gQWRkIGFudGktY2FjaGUgaW4gdXJsIGlmIG5lZWRlZAoJCQlpZiAoIHMuY2FjaGUgPT09IGZhbHNlICkgewoJCQkJcy51cmwgPSBydHMudGVzdCggY2FjaGVVUkwgKSA/CgoJCQkJCS8vIElmIHRoZXJlIGlzIGFscmVhZHkgYSAnXycgcGFyYW1ldGVyLCBzZXQgaXRzIHZhbHVlCgkJCQkJY2FjaGVVUkwucmVwbGFjZSggcnRzLCAiJDFfPSIgKyBhamF4X25vbmNlKysgKSA6CgoJCQkJCS8vIE90aGVyd2lzZSBhZGQgb25lIHRvIHRoZSBlbmQKCQkJCQljYWNoZVVSTCArICggYWpheF9ycXVlcnkudGVzdCggY2FjaGVVUkwgKSA/ICImIiA6ICI/IiApICsgIl89IiArIGFqYXhfbm9uY2UrKzsKCQkJfQoJCX0KCgkJLy8gU2V0IHRoZSBJZi1Nb2RpZmllZC1TaW5jZSBhbmQvb3IgSWYtTm9uZS1NYXRjaCBoZWFkZXIsIGlmIGluIGlmTW9kaWZpZWQgbW9kZS4KCQlpZiAoIHMuaWZNb2RpZmllZCApIHsKCQkJaWYgKCBqUXVlcnkubGFzdE1vZGlmaWVkWyBjYWNoZVVSTCBdICkgewoJCQkJanFYSFIuc2V0UmVxdWVzdEhlYWRlciggIklmLU1vZGlmaWVkLVNpbmNlIiwgalF1ZXJ5Lmxhc3RNb2RpZmllZFsgY2FjaGVVUkwgXSApOwoJCQl9CgkJCWlmICggalF1ZXJ5LmV0YWdbIGNhY2hlVVJMIF0gKSB7CgkJCQlqcVhIUi5zZXRSZXF1ZXN0SGVhZGVyKCAiSWYtTm9uZS1NYXRjaCIsIGpRdWVyeS5ldGFnWyBjYWNoZVVSTCBdICk7CgkJCX0KCQl9CgoJCS8vIFNldCB0aGUgY29ycmVjdCBoZWFkZXIsIGlmIGRhdGEgaXMgYmVpbmcgc2VudAoJCWlmICggcy5kYXRhICYmIHMuaGFzQ29udGVudCAmJiBzLmNvbnRlbnRUeXBlICE9PSBmYWxzZSB8fCBvcHRpb25zLmNvbnRlbnRUeXBlICkgewoJCQlqcVhIUi5zZXRSZXF1ZXN0SGVhZGVyKCAiQ29udGVudC1UeXBlIiwgcy5jb250ZW50VHlwZSApOwoJCX0KCgkJLy8gU2V0IHRoZSBBY2NlcHRzIGhlYWRlciBmb3IgdGhlIHNlcnZlciwgZGVwZW5kaW5nIG9uIHRoZSBkYXRhVHlwZQoJCWpxWEhSLnNldFJlcXVlc3RIZWFkZXIoCgkJCSJBY2NlcHQiLAoJCQlzLmRhdGFUeXBlc1sgMCBdICYmIHMuYWNjZXB0c1sgcy5kYXRhVHlwZXNbMF0gXSA/CgkJCQlzLmFjY2VwdHNbIHMuZGF0YVR5cGVzWzBdIF0gKyAoIHMuZGF0YVR5cGVzWyAwIF0gIT09ICIqIiA/ICIsICIgKyBhbGxUeXBlcyArICI7IHE9MC4wMSIgOiAiIiApIDoKCQkJCXMuYWNjZXB0c1sgIioiIF0KCQkpOwoKCQkvLyBDaGVjayBmb3IgaGVhZGVycyBvcHRpb24KCQlmb3IgKCBpIGluIHMuaGVhZGVycyApIHsKCQkJanFYSFIuc2V0UmVxdWVzdEhlYWRlciggaSwgcy5oZWFkZXJzWyBpIF0gKTsKCQl9CgoJCS8vIEFsbG93IGN1c3RvbSBoZWFkZXJzL21pbWV0eXBlcyBhbmQgZWFybHkgYWJvcnQKCQlpZiAoIHMuYmVmb3JlU2VuZCAmJiAoIHMuYmVmb3JlU2VuZC5jYWxsKCBjYWxsYmFja0NvbnRleHQsIGpxWEhSLCBzICkgPT09IGZhbHNlIHx8IHN0YXRlID09PSAyICkgKSB7CgkJCS8vIEFib3J0IGlmIG5vdCBkb25lIGFscmVhZHkgYW5kIHJldHVybgoJCQlyZXR1cm4ganFYSFIuYWJvcnQoKTsKCQl9CgoJCS8vIGFib3J0aW5nIGlzIG5vIGxvbmdlciBhIGNhbmNlbGxhdGlvbgoJCXN0ckFib3J0ID0gImFib3J0IjsKCgkJLy8gSW5zdGFsbCBjYWxsYmFja3Mgb24gZGVmZXJyZWRzCgkJZm9yICggaSBpbiB7IHN1Y2Nlc3M6IDEsIGVycm9yOiAxLCBjb21wbGV0ZTogMSB9ICkgewoJCQlqcVhIUlsgaSBdKCBzWyBpIF0gKTsKCQl9CgoJCS8vIEdldCB0cmFuc3BvcnQKCQl0cmFuc3BvcnQgPSBpbnNwZWN0UHJlZmlsdGVyc09yVHJhbnNwb3J0cyggdHJhbnNwb3J0cywgcywgb3B0aW9ucywganFYSFIgKTsKCgkJLy8gSWYgbm8gdHJhbnNwb3J0LCB3ZSBhdXRvLWFib3J0CgkJaWYgKCAhdHJhbnNwb3J0ICkgewoJCQlkb25lKCAtMSwgIk5vIFRyYW5zcG9ydCIgKTsKCQl9IGVsc2UgewoJCQlqcVhIUi5yZWFkeVN0YXRlID0gMTsKCgkJCS8vIFNlbmQgZ2xvYmFsIGV2ZW50CgkJCWlmICggZmlyZUdsb2JhbHMgKSB7CgkJCQlnbG9iYWxFdmVudENvbnRleHQudHJpZ2dlciggImFqYXhTZW5kIiwgWyBqcVhIUiwgcyBdICk7CgkJCX0KCQkJLy8gVGltZW91dAoJCQlpZiAoIHMuYXN5bmMgJiYgcy50aW1lb3V0ID4gMCApIHsKCQkJCXRpbWVvdXRUaW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CgkJCQkJanFYSFIuYWJvcnQoInRpbWVvdXQiKTsKCQkJCX0sIHMudGltZW91dCApOwoJCQl9CgoJCQl0cnkgewoJCQkJc3RhdGUgPSAxOwoJCQkJdHJhbnNwb3J0LnNlbmQoIHJlcXVlc3RIZWFkZXJzLCBkb25lICk7CgkJCX0gY2F0Y2ggKCBlICkgewoJCQkJLy8gUHJvcGFnYXRlIGV4Y2VwdGlvbiBhcyBlcnJvciBpZiBub3QgZG9uZQoJCQkJaWYgKCBzdGF0ZSA8IDIgKSB7CgkJCQkJZG9uZSggLTEsIGUgKTsKCQkJCS8vIFNpbXBseSByZXRocm93IG90aGVyd2lzZQoJCQkJfSBlbHNlIHsKCQkJCQl0aHJvdyBlOwoJCQkJfQoJCQl9CgkJfQoKCQkvLyBDYWxsYmFjayBmb3Igd2hlbiBldmVyeXRoaW5nIGlzIGRvbmUKCQlmdW5jdGlvbiBkb25lKCBzdGF0dXMsIG5hdGl2ZVN0YXR1c1RleHQsIHJlc3BvbnNlcywgaGVhZGVycyApIHsKCQkJdmFyIGlzU3VjY2Vzcywgc3VjY2VzcywgZXJyb3IsIHJlc3BvbnNlLCBtb2RpZmllZCwKCQkJCXN0YXR1c1RleHQgPSBuYXRpdmVTdGF0dXNUZXh0OwoKCQkJLy8gQ2FsbGVkIG9uY2UKCQkJaWYgKCBzdGF0ZSA9PT0gMiApIHsKCQkJCXJldHVybjsKCQkJfQoKCQkJLy8gU3RhdGUgaXMgImRvbmUiIG5vdwoJCQlzdGF0ZSA9IDI7CgoJCQkvLyBDbGVhciB0aW1lb3V0IGlmIGl0IGV4aXN0cwoJCQlpZiAoIHRpbWVvdXRUaW1lciApIHsKCQkJCWNsZWFyVGltZW91dCggdGltZW91dFRpbWVyICk7CgkJCX0KCgkJCS8vIERlcmVmZXJlbmNlIHRyYW5zcG9ydCBmb3IgZWFybHkgZ2FyYmFnZSBjb2xsZWN0aW9uCgkJCS8vIChubyBtYXR0ZXIgaG93IGxvbmcgdGhlIGpxWEhSIG9iamVjdCB3aWxsIGJlIHVzZWQpCgkJCXRyYW5zcG9ydCA9IHVuZGVmaW5lZDsKCgkJCS8vIENhY2hlIHJlc3BvbnNlIGhlYWRlcnMKCQkJcmVzcG9uc2VIZWFkZXJzU3RyaW5nID0gaGVhZGVycyB8fCAiIjsKCgkJCS8vIFNldCByZWFkeVN0YXRlCgkJCWpxWEhSLnJlYWR5U3RhdGUgPSBzdGF0dXMgPiAwID8gNCA6IDA7CgoJCQkvLyBHZXQgcmVzcG9uc2UgZGF0YQoJCQlpZiAoIHJlc3BvbnNlcyApIHsKCQkJCXJlc3BvbnNlID0gYWpheEhhbmRsZVJlc3BvbnNlcyggcywganFYSFIsIHJlc3BvbnNlcyApOwoJCQl9CgoJCQkvLyBJZiBzdWNjZXNzZnVsLCBoYW5kbGUgdHlwZSBjaGFpbmluZwoJCQlpZiAoIHN0YXR1cyA+PSAyMDAgJiYgc3RhdHVzIDwgMzAwIHx8IHN0YXR1cyA9PT0gMzA0ICkgewoKCQkJCS8vIFNldCB0aGUgSWYtTW9kaWZpZWQtU2luY2UgYW5kL29yIElmLU5vbmUtTWF0Y2ggaGVhZGVyLCBpZiBpbiBpZk1vZGlmaWVkIG1vZGUuCgkJCQlpZiAoIHMuaWZNb2RpZmllZCApIHsKCQkJCQltb2RpZmllZCA9IGpxWEhSLmdldFJlc3BvbnNlSGVhZGVyKCJMYXN0LU1vZGlmaWVkIik7CgkJCQkJaWYgKCBtb2RpZmllZCApIHsKCQkJCQkJalF1ZXJ5Lmxhc3RNb2RpZmllZFsgY2FjaGVVUkwgXSA9IG1vZGlmaWVkOwoJCQkJCX0KCQkJCQltb2RpZmllZCA9IGpxWEhSLmdldFJlc3BvbnNlSGVhZGVyKCJldGFnIik7CgkJCQkJaWYgKCBtb2RpZmllZCApIHsKCQkJCQkJalF1ZXJ5LmV0YWdbIGNhY2hlVVJMIF0gPSBtb2RpZmllZDsKCQkJCQl9CgkJCQl9CgoJCQkJLy8gaWYgbm8gY29udGVudAoJCQkJaWYgKCBzdGF0dXMgPT09IDIwNCApIHsKCQkJCQlpc1N1Y2Nlc3MgPSB0cnVlOwoJCQkJCXN0YXR1c1RleHQgPSAibm9jb250ZW50IjsKCgkJCQkvLyBpZiBub3QgbW9kaWZpZWQKCQkJCX0gZWxzZSBpZiAoIHN0YXR1cyA9PT0gMzA0ICkgewoJCQkJCWlzU3VjY2VzcyA9IHRydWU7CgkJCQkJc3RhdHVzVGV4dCA9ICJub3Rtb2RpZmllZCI7CgoJCQkJLy8gSWYgd2UgaGF2ZSBkYXRhLCBsZXQncyBjb252ZXJ0IGl0CgkJCQl9IGVsc2UgewoJCQkJCWlzU3VjY2VzcyA9IGFqYXhDb252ZXJ0KCBzLCByZXNwb25zZSApOwoJCQkJCXN0YXR1c1RleHQgPSBpc1N1Y2Nlc3Muc3RhdGU7CgkJCQkJc3VjY2VzcyA9IGlzU3VjY2Vzcy5kYXRhOwoJCQkJCWVycm9yID0gaXNTdWNjZXNzLmVycm9yOwoJCQkJCWlzU3VjY2VzcyA9ICFlcnJvcjsKCQkJCX0KCQkJfSBlbHNlIHsKCQkJCS8vIFdlIGV4dHJhY3QgZXJyb3IgZnJvbSBzdGF0dXNUZXh0CgkJCQkvLyB0aGVuIG5vcm1hbGl6ZSBzdGF0dXNUZXh0IGFuZCBzdGF0dXMgZm9yIG5vbi1hYm9ydHMKCQkJCWVycm9yID0gc3RhdHVzVGV4dDsKCQkJCWlmICggc3RhdHVzIHx8ICFzdGF0dXNUZXh0ICkgewoJCQkJCXN0YXR1c1RleHQgPSAiZXJyb3IiOwoJCQkJCWlmICggc3RhdHVzIDwgMCApIHsKCQkJCQkJc3RhdHVzID0gMDsKCQkJCQl9CgkJCQl9CgkJCX0KCgkJCS8vIFNldCBkYXRhIGZvciB0aGUgZmFrZSB4aHIgb2JqZWN0CgkJCWpxWEhSLnN0YXR1cyA9IHN0YXR1czsKCQkJanFYSFIuc3RhdHVzVGV4dCA9ICggbmF0aXZlU3RhdHVzVGV4dCB8fCBzdGF0dXNUZXh0ICkgKyAiIjsKCgkJCS8vIFN1Y2Nlc3MvRXJyb3IKCQkJaWYgKCBpc1N1Y2Nlc3MgKSB7CgkJCQlkZWZlcnJlZC5yZXNvbHZlV2l0aCggY2FsbGJhY2tDb250ZXh0LCBbIHN1Y2Nlc3MsIHN0YXR1c1RleHQsIGpxWEhSIF0gKTsKCQkJfSBlbHNlIHsKCQkJCWRlZmVycmVkLnJlamVjdFdpdGgoIGNhbGxiYWNrQ29udGV4dCwgWyBqcVhIUiwgc3RhdHVzVGV4dCwgZXJyb3IgXSApOwoJCQl9CgoJCQkvLyBTdGF0dXMtZGVwZW5kZW50IGNhbGxiYWNrcwoJCQlqcVhIUi5zdGF0dXNDb2RlKCBzdGF0dXNDb2RlICk7CgkJCXN0YXR1c0NvZGUgPSB1bmRlZmluZWQ7CgoJCQlpZiAoIGZpcmVHbG9iYWxzICkgewoJCQkJZ2xvYmFsRXZlbnRDb250ZXh0LnRyaWdnZXIoIGlzU3VjY2VzcyA/ICJhamF4U3VjY2VzcyIgOiAiYWpheEVycm9yIiwKCQkJCQlbIGpxWEhSLCBzLCBpc1N1Y2Nlc3MgPyBzdWNjZXNzIDogZXJyb3IgXSApOwoJCQl9CgoJCQkvLyBDb21wbGV0ZQoJCQljb21wbGV0ZURlZmVycmVkLmZpcmVXaXRoKCBjYWxsYmFja0NvbnRleHQsIFsganFYSFIsIHN0YXR1c1RleHQgXSApOwoKCQkJaWYgKCBmaXJlR2xvYmFscyApIHsKCQkJCWdsb2JhbEV2ZW50Q29udGV4dC50cmlnZ2VyKCAiYWpheENvbXBsZXRlIiwgWyBqcVhIUiwgcyBdICk7CgkJCQkvLyBIYW5kbGUgdGhlIGdsb2JhbCBBSkFYIGNvdW50ZXIKCQkJCWlmICggISggLS1qUXVlcnkuYWN0aXZlICkgKSB7CgkJCQkJalF1ZXJ5LmV2ZW50LnRyaWdnZXIoImFqYXhTdG9wIik7CgkJCQl9CgkJCX0KCQl9CgoJCXJldHVybiBqcVhIUjsKCX0sCgoJZ2V0U2NyaXB0OiBmdW5jdGlvbiggdXJsLCBjYWxsYmFjayApIHsKCQlyZXR1cm4galF1ZXJ5LmdldCggdXJsLCB1bmRlZmluZWQsIGNhbGxiYWNrLCAic2NyaXB0IiApOwoJfSwKCglnZXRKU09OOiBmdW5jdGlvbiggdXJsLCBkYXRhLCBjYWxsYmFjayApIHsKCQlyZXR1cm4galF1ZXJ5LmdldCggdXJsLCBkYXRhLCBjYWxsYmFjaywgImpzb24iICk7Cgl9Cn0pOwoKLyogSGFuZGxlcyByZXNwb25zZXMgdG8gYW4gYWpheCByZXF1ZXN0OgogKiAtIHNldHMgYWxsIHJlc3BvbnNlWFhYIGZpZWxkcyBhY2NvcmRpbmdseQogKiAtIGZpbmRzIHRoZSByaWdodCBkYXRhVHlwZSAobWVkaWF0ZXMgYmV0d2VlbiBjb250ZW50LXR5cGUgYW5kIGV4cGVjdGVkIGRhdGFUeXBlKQogKiAtIHJldHVybnMgdGhlIGNvcnJlc3BvbmRpbmcgcmVzcG9uc2UKICovCmZ1bmN0aW9uIGFqYXhIYW5kbGVSZXNwb25zZXMoIHMsIGpxWEhSLCByZXNwb25zZXMgKSB7Cgl2YXIgZmlyc3REYXRhVHlwZSwgY3QsIGZpbmFsRGF0YVR5cGUsIHR5cGUsCgkJY29udGVudHMgPSBzLmNvbnRlbnRzLAoJCWRhdGFUeXBlcyA9IHMuZGF0YVR5cGVzLAoJCXJlc3BvbnNlRmllbGRzID0gcy5yZXNwb25zZUZpZWxkczsKCgkvLyBGaWxsIHJlc3BvbnNlWFhYIGZpZWxkcwoJZm9yICggdHlwZSBpbiByZXNwb25zZUZpZWxkcyApIHsKCQlpZiAoIHR5cGUgaW4gcmVzcG9uc2VzICkgewoJCQlqcVhIUlsgcmVzcG9uc2VGaWVsZHNbdHlwZV0gXSA9IHJlc3BvbnNlc1sgdHlwZSBdOwoJCX0KCX0KCgkvLyBSZW1vdmUgYXV0byBkYXRhVHlwZSBhbmQgZ2V0IGNvbnRlbnQtdHlwZSBpbiB0aGUgcHJvY2VzcwoJd2hpbGUoIGRhdGFUeXBlc1sgMCBdID09PSAiKiIgKSB7CgkJZGF0YVR5cGVzLnNoaWZ0KCk7CgkJaWYgKCBjdCA9PT0gdW5kZWZpbmVkICkgewoJCQljdCA9IHMubWltZVR5cGUgfHwganFYSFIuZ2V0UmVzcG9uc2VIZWFkZXIoIkNvbnRlbnQtVHlwZSIpOwoJCX0KCX0KCgkvLyBDaGVjayBpZiB3ZSdyZSBkZWFsaW5nIHdpdGggYSBrbm93biBjb250ZW50LXR5cGUKCWlmICggY3QgKSB7CgkJZm9yICggdHlwZSBpbiBjb250ZW50cyApIHsKCQkJaWYgKCBjb250ZW50c1sgdHlwZSBdICYmIGNvbnRlbnRzWyB0eXBlIF0udGVzdCggY3QgKSApIHsKCQkJCWRhdGFUeXBlcy51bnNoaWZ0KCB0eXBlICk7CgkJCQlicmVhazsKCQkJfQoJCX0KCX0KCgkvLyBDaGVjayB0byBzZWUgaWYgd2UgaGF2ZSBhIHJlc3BvbnNlIGZvciB0aGUgZXhwZWN0ZWQgZGF0YVR5cGUKCWlmICggZGF0YVR5cGVzWyAwIF0gaW4gcmVzcG9uc2VzICkgewoJCWZpbmFsRGF0YVR5cGUgPSBkYXRhVHlwZXNbIDAgXTsKCX0gZWxzZSB7CgkJLy8gVHJ5IGNvbnZlcnRpYmxlIGRhdGFUeXBlcwoJCWZvciAoIHR5cGUgaW4gcmVzcG9uc2VzICkgewoJCQlpZiAoICFkYXRhVHlwZXNbIDAgXSB8fCBzLmNvbnZlcnRlcnNbIHR5cGUgKyAiICIgKyBkYXRhVHlwZXNbMF0gXSApIHsKCQkJCWZpbmFsRGF0YVR5cGUgPSB0eXBlOwoJCQkJYnJlYWs7CgkJCX0KCQkJaWYgKCAhZmlyc3REYXRhVHlwZSApIHsKCQkJCWZpcnN0RGF0YVR5cGUgPSB0eXBlOwoJCQl9CgkJfQoJCS8vIE9yIGp1c3QgdXNlIGZpcnN0IG9uZQoJCWZpbmFsRGF0YVR5cGUgPSBmaW5hbERhdGFUeXBlIHx8IGZpcnN0RGF0YVR5cGU7Cgl9CgoJLy8gSWYgd2UgZm91bmQgYSBkYXRhVHlwZQoJLy8gV2UgYWRkIHRoZSBkYXRhVHlwZSB0byB0aGUgbGlzdCBpZiBuZWVkZWQKCS8vIGFuZCByZXR1cm4gdGhlIGNvcnJlc3BvbmRpbmcgcmVzcG9uc2UKCWlmICggZmluYWxEYXRhVHlwZSApIHsKCQlpZiAoIGZpbmFsRGF0YVR5cGUgIT09IGRhdGFUeXBlc1sgMCBdICkgewoJCQlkYXRhVHlwZXMudW5zaGlmdCggZmluYWxEYXRhVHlwZSApOwoJCX0KCQlyZXR1cm4gcmVzcG9uc2VzWyBmaW5hbERhdGFUeXBlIF07Cgl9Cn0KCi8vIENoYWluIGNvbnZlcnNpb25zIGdpdmVuIHRoZSByZXF1ZXN0IGFuZCB0aGUgb3JpZ2luYWwgcmVzcG9uc2UKZnVuY3Rpb24gYWpheENvbnZlcnQoIHMsIHJlc3BvbnNlICkgewoJdmFyIGNvbnYyLCBjdXJyZW50LCBjb252LCB0bXAsCgkJY29udmVydGVycyA9IHt9LAoJCWkgPSAwLAoJCS8vIFdvcmsgd2l0aCBhIGNvcHkgb2YgZGF0YVR5cGVzIGluIGNhc2Ugd2UgbmVlZCB0byBtb2RpZnkgaXQgZm9yIGNvbnZlcnNpb24KCQlkYXRhVHlwZXMgPSBzLmRhdGFUeXBlcy5zbGljZSgpLAoJCXByZXYgPSBkYXRhVHlwZXNbIDAgXTsKCgkvLyBBcHBseSB0aGUgZGF0YUZpbHRlciBpZiBwcm92aWRlZAoJaWYgKCBzLmRhdGFGaWx0ZXIgKSB7CgkJcmVzcG9uc2UgPSBzLmRhdGFGaWx0ZXIoIHJlc3BvbnNlLCBzLmRhdGFUeXBlICk7Cgl9CgoJLy8gQ3JlYXRlIGNvbnZlcnRlcnMgbWFwIHdpdGggbG93ZXJjYXNlZCBrZXlzCglpZiAoIGRhdGFUeXBlc1sgMSBdICkgewoJCWZvciAoIGNvbnYgaW4gcy5jb252ZXJ0ZXJzICkgewoJCQljb252ZXJ0ZXJzWyBjb252LnRvTG93ZXJDYXNlKCkgXSA9IHMuY29udmVydGVyc1sgY29udiBdOwoJCX0KCX0KCgkvLyBDb252ZXJ0IHRvIGVhY2ggc2VxdWVudGlhbCBkYXRhVHlwZSwgdG9sZXJhdGluZyBsaXN0IG1vZGlmaWNhdGlvbgoJZm9yICggOyAoY3VycmVudCA9IGRhdGFUeXBlc1srK2ldKTsgKSB7CgoJCS8vIFRoZXJlJ3Mgb25seSB3b3JrIHRvIGRvIGlmIGN1cnJlbnQgZGF0YVR5cGUgaXMgbm9uLWF1dG8KCQlpZiAoIGN1cnJlbnQgIT09ICIqIiApIHsKCgkJCS8vIENvbnZlcnQgcmVzcG9uc2UgaWYgcHJldiBkYXRhVHlwZSBpcyBub24tYXV0byBhbmQgZGlmZmVycyBmcm9tIGN1cnJlbnQKCQkJaWYgKCBwcmV2ICE9PSAiKiIgJiYgcHJldiAhPT0gY3VycmVudCApIHsKCgkJCQkvLyBTZWVrIGEgZGlyZWN0IGNvbnZlcnRlcgoJCQkJY29udiA9IGNvbnZlcnRlcnNbIHByZXYgKyAiICIgKyBjdXJyZW50IF0gfHwgY29udmVydGVyc1sgIiogIiArIGN1cnJlbnQgXTsKCgkJCQkvLyBJZiBub25lIGZvdW5kLCBzZWVrIGEgcGFpcgoJCQkJaWYgKCAhY29udiApIHsKCQkJCQlmb3IgKCBjb252MiBpbiBjb252ZXJ0ZXJzICkgewoKCQkJCQkJLy8gSWYgY29udjIgb3V0cHV0cyBjdXJyZW50CgkJCQkJCXRtcCA9IGNvbnYyLnNwbGl0KCIgIik7CgkJCQkJCWlmICggdG1wWyAxIF0gPT09IGN1cnJlbnQgKSB7CgoJCQkJCQkJLy8gSWYgcHJldiBjYW4gYmUgY29udmVydGVkIHRvIGFjY2VwdGVkIGlucHV0CgkJCQkJCQljb252ID0gY29udmVydGVyc1sgcHJldiArICIgIiArIHRtcFsgMCBdIF0gfHwKCQkJCQkJCQljb252ZXJ0ZXJzWyAiKiAiICsgdG1wWyAwIF0gXTsKCQkJCQkJCWlmICggY29udiApIHsKCQkJCQkJCQkvLyBDb25kZW5zZSBlcXVpdmFsZW5jZSBjb252ZXJ0ZXJzCgkJCQkJCQkJaWYgKCBjb252ID09PSB0cnVlICkgewoJCQkJCQkJCQljb252ID0gY29udmVydGVyc1sgY29udjIgXTsKCgkJCQkJCQkJLy8gT3RoZXJ3aXNlLCBpbnNlcnQgdGhlIGludGVybWVkaWF0ZSBkYXRhVHlwZQoJCQkJCQkJCX0gZWxzZSBpZiAoIGNvbnZlcnRlcnNbIGNvbnYyIF0gIT09IHRydWUgKSB7CgkJCQkJCQkJCWN1cnJlbnQgPSB0bXBbIDAgXTsKCQkJCQkJCQkJZGF0YVR5cGVzLnNwbGljZSggaS0tLCAwLCBjdXJyZW50ICk7CgkJCQkJCQkJfQoKCQkJCQkJCQlicmVhazsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCQkJCX0KCgkJCQkvLyBBcHBseSBjb252ZXJ0ZXIgKGlmIG5vdCBhbiBlcXVpdmFsZW5jZSkKCQkJCWlmICggY29udiAhPT0gdHJ1ZSApIHsKCgkJCQkJLy8gVW5sZXNzIGVycm9ycyBhcmUgYWxsb3dlZCB0byBidWJibGUsIGNhdGNoIGFuZCByZXR1cm4gdGhlbQoJCQkJCWlmICggY29udiAmJiBzWyJ0aHJvd3MiXSApIHsKCQkJCQkJcmVzcG9uc2UgPSBjb252KCByZXNwb25zZSApOwoJCQkJCX0gZWxzZSB7CgkJCQkJCXRyeSB7CgkJCQkJCQlyZXNwb25zZSA9IGNvbnYoIHJlc3BvbnNlICk7CgkJCQkJCX0gY2F0Y2ggKCBlICkgewoJCQkJCQkJcmV0dXJuIHsgc3RhdGU6ICJwYXJzZXJlcnJvciIsIGVycm9yOiBjb252ID8gZSA6ICJObyBjb252ZXJzaW9uIGZyb20gIiArIHByZXYgKyAiIHRvICIgKyBjdXJyZW50IH07CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCX0KCgkJCS8vIFVwZGF0ZSBwcmV2IGZvciBuZXh0IGl0ZXJhdGlvbgoJCQlwcmV2ID0gY3VycmVudDsKCQl9Cgl9CgoJcmV0dXJuIHsgc3RhdGU6ICJzdWNjZXNzIiwgZGF0YTogcmVzcG9uc2UgfTsKfQovLyBJbnN0YWxsIHNjcmlwdCBkYXRhVHlwZQpqUXVlcnkuYWpheFNldHVwKHsKCWFjY2VwdHM6IHsKCQlzY3JpcHQ6ICJ0ZXh0L2phdmFzY3JpcHQsIGFwcGxpY2F0aW9uL2phdmFzY3JpcHQsIGFwcGxpY2F0aW9uL2VjbWFzY3JpcHQsIGFwcGxpY2F0aW9uL3gtZWNtYXNjcmlwdCIKCX0sCgljb250ZW50czogewoJCXNjcmlwdDogLyg/OmphdmF8ZWNtYSlzY3JpcHQvCgl9LAoJY29udmVydGVyczogewoJCSJ0ZXh0IHNjcmlwdCI6IGZ1bmN0aW9uKCB0ZXh0ICkgewoJCQlqUXVlcnkuZ2xvYmFsRXZhbCggdGV4dCApOwoJCQlyZXR1cm4gdGV4dDsKCQl9Cgl9Cn0pOwoKLy8gSGFuZGxlIGNhY2hlJ3Mgc3BlY2lhbCBjYXNlIGFuZCBnbG9iYWwKalF1ZXJ5LmFqYXhQcmVmaWx0ZXIoICJzY3JpcHQiLCBmdW5jdGlvbiggcyApIHsKCWlmICggcy5jYWNoZSA9PT0gdW5kZWZpbmVkICkgewoJCXMuY2FjaGUgPSBmYWxzZTsKCX0KCWlmICggcy5jcm9zc0RvbWFpbiApIHsKCQlzLnR5cGUgPSAiR0VUIjsKCQlzLmdsb2JhbCA9IGZhbHNlOwoJfQp9KTsKCi8vIEJpbmQgc2NyaXB0IHRhZyBoYWNrIHRyYW5zcG9ydApqUXVlcnkuYWpheFRyYW5zcG9ydCggInNjcmlwdCIsIGZ1bmN0aW9uKHMpIHsKCgkvLyBUaGlzIHRyYW5zcG9ydCBvbmx5IGRlYWxzIHdpdGggY3Jvc3MgZG9tYWluIHJlcXVlc3RzCglpZiAoIHMuY3Jvc3NEb21haW4gKSB7CgoJCXZhciBzY3JpcHQsCgkJCWhlYWQgPSBkb2N1bWVudC5oZWFkIHx8IGpRdWVyeSgiaGVhZCIpWzBdIHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDsKCgkJcmV0dXJuIHsKCgkJCXNlbmQ6IGZ1bmN0aW9uKCBfLCBjYWxsYmFjayApIHsKCgkJCQlzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzY3JpcHQiKTsKCgkJCQlzY3JpcHQuYXN5bmMgPSB0cnVlOwoKCQkJCWlmICggcy5zY3JpcHRDaGFyc2V0ICkgewoJCQkJCXNjcmlwdC5jaGFyc2V0ID0gcy5zY3JpcHRDaGFyc2V0OwoJCQkJfQoKCQkJCXNjcmlwdC5zcmMgPSBzLnVybDsKCgkJCQkvLyBBdHRhY2ggaGFuZGxlcnMgZm9yIGFsbCBicm93c2VycwoJCQkJc2NyaXB0Lm9ubG9hZCA9IHNjcmlwdC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbiggXywgaXNBYm9ydCApIHsKCgkJCQkJaWYgKCBpc0Fib3J0IHx8ICFzY3JpcHQucmVhZHlTdGF0ZSB8fCAvbG9hZGVkfGNvbXBsZXRlLy50ZXN0KCBzY3JpcHQucmVhZHlTdGF0ZSApICkgewoKCQkJCQkJLy8gSGFuZGxlIG1lbW9yeSBsZWFrIGluIElFCgkJCQkJCXNjcmlwdC5vbmxvYWQgPSBzY3JpcHQub25yZWFkeXN0YXRlY2hhbmdlID0gbnVsbDsKCgkJCQkJCS8vIFJlbW92ZSB0aGUgc2NyaXB0CgkJCQkJCWlmICggc2NyaXB0LnBhcmVudE5vZGUgKSB7CgkJCQkJCQlzY3JpcHQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCggc2NyaXB0ICk7CgkJCQkJCX0KCgkJCQkJCS8vIERlcmVmZXJlbmNlIHRoZSBzY3JpcHQKCQkJCQkJc2NyaXB0ID0gbnVsbDsKCgkJCQkJCS8vIENhbGxiYWNrIGlmIG5vdCBhYm9ydAoJCQkJCQlpZiAoICFpc0Fib3J0ICkgewoJCQkJCQkJY2FsbGJhY2soIDIwMCwgInN1Y2Nlc3MiICk7CgkJCQkJCX0KCQkJCQl9CgkJCQl9OwoKCQkJCS8vIENpcmN1bXZlbnQgSUU2IGJ1Z3Mgd2l0aCBiYXNlIGVsZW1lbnRzICgjMjcwOSBhbmQgIzQzNzgpIGJ5IHByZXBlbmRpbmcKCQkJCS8vIFVzZSBuYXRpdmUgRE9NIG1hbmlwdWxhdGlvbiB0byBhdm9pZCBvdXIgZG9tTWFuaXAgQUpBWCB0cmlja2VyeQoJCQkJaGVhZC5pbnNlcnRCZWZvcmUoIHNjcmlwdCwgaGVhZC5maXJzdENoaWxkICk7CgkJCX0sCgoJCQlhYm9ydDogZnVuY3Rpb24oKSB7CgkJCQlpZiAoIHNjcmlwdCApIHsKCQkJCQlzY3JpcHQub25sb2FkKCB1bmRlZmluZWQsIHRydWUgKTsKCQkJCX0KCQkJfQoJCX07Cgl9Cn0pOwp2YXIgb2xkQ2FsbGJhY2tzID0gW10sCglyanNvbnAgPSAvKD0pXD8oPz0mfCQpfFw/XD8vOwoKLy8gRGVmYXVsdCBqc29ucCBzZXR0aW5ncwpqUXVlcnkuYWpheFNldHVwKHsKCWpzb25wOiAiY2FsbGJhY2siLAoJanNvbnBDYWxsYmFjazogZnVuY3Rpb24oKSB7CgkJdmFyIGNhbGxiYWNrID0gb2xkQ2FsbGJhY2tzLnBvcCgpIHx8ICggalF1ZXJ5LmV4cGFuZG8gKyAiXyIgKyAoIGFqYXhfbm9uY2UrKyApICk7CgkJdGhpc1sgY2FsbGJhY2sgXSA9IHRydWU7CgkJcmV0dXJuIGNhbGxiYWNrOwoJfQp9KTsKCi8vIERldGVjdCwgbm9ybWFsaXplIG9wdGlvbnMgYW5kIGluc3RhbGwgY2FsbGJhY2tzIGZvciBqc29ucCByZXF1ZXN0cwpqUXVlcnkuYWpheFByZWZpbHRlciggImpzb24ganNvbnAiLCBmdW5jdGlvbiggcywgb3JpZ2luYWxTZXR0aW5ncywganFYSFIgKSB7CgoJdmFyIGNhbGxiYWNrTmFtZSwgb3ZlcndyaXR0ZW4sIHJlc3BvbnNlQ29udGFpbmVyLAoJCWpzb25Qcm9wID0gcy5qc29ucCAhPT0gZmFsc2UgJiYgKCByanNvbnAudGVzdCggcy51cmwgKSA/CgkJCSJ1cmwiIDoKCQkJdHlwZW9mIHMuZGF0YSA9PT0gInN0cmluZyIgJiYgISggcy5jb250ZW50VHlwZSB8fCAiIiApLmluZGV4T2YoImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCIpICYmIHJqc29ucC50ZXN0KCBzLmRhdGEgKSAmJiAiZGF0YSIKCQkpOwoKCS8vIEhhbmRsZSBpZmYgdGhlIGV4cGVjdGVkIGRhdGEgdHlwZSBpcyAianNvbnAiIG9yIHdlIGhhdmUgYSBwYXJhbWV0ZXIgdG8gc2V0CglpZiAoIGpzb25Qcm9wIHx8IHMuZGF0YVR5cGVzWyAwIF0gPT09ICJqc29ucCIgKSB7CgoJCS8vIEdldCBjYWxsYmFjayBuYW1lLCByZW1lbWJlcmluZyBwcmVleGlzdGluZyB2YWx1ZSBhc3NvY2lhdGVkIHdpdGggaXQKCQljYWxsYmFja05hbWUgPSBzLmpzb25wQ2FsbGJhY2sgPSBqUXVlcnkuaXNGdW5jdGlvbiggcy5qc29ucENhbGxiYWNrICkgPwoJCQlzLmpzb25wQ2FsbGJhY2soKSA6CgkJCXMuanNvbnBDYWxsYmFjazsKCgkJLy8gSW5zZXJ0IGNhbGxiYWNrIGludG8gdXJsIG9yIGZvcm0gZGF0YQoJCWlmICgganNvblByb3AgKSB7CgkJCXNbIGpzb25Qcm9wIF0gPSBzWyBqc29uUHJvcCBdLnJlcGxhY2UoIHJqc29ucCwgIiQxIiArIGNhbGxiYWNrTmFtZSApOwoJCX0gZWxzZSBpZiAoIHMuanNvbnAgIT09IGZhbHNlICkgewoJCQlzLnVybCArPSAoIGFqYXhfcnF1ZXJ5LnRlc3QoIHMudXJsICkgPyAiJiIgOiAiPyIgKSArIHMuanNvbnAgKyAiPSIgKyBjYWxsYmFja05hbWU7CgkJfQoKCQkvLyBVc2UgZGF0YSBjb252ZXJ0ZXIgdG8gcmV0cmlldmUganNvbiBhZnRlciBzY3JpcHQgZXhlY3V0aW9uCgkJcy5jb252ZXJ0ZXJzWyJzY3JpcHQganNvbiJdID0gZnVuY3Rpb24oKSB7CgkJCWlmICggIXJlc3BvbnNlQ29udGFpbmVyICkgewoJCQkJalF1ZXJ5LmVycm9yKCBjYWxsYmFja05hbWUgKyAiIHdhcyBub3QgY2FsbGVkIiApOwoJCQl9CgkJCXJldHVybiByZXNwb25zZUNvbnRhaW5lclsgMCBdOwoJCX07CgoJCS8vIGZvcmNlIGpzb24gZGF0YVR5cGUKCQlzLmRhdGFUeXBlc1sgMCBdID0gImpzb24iOwoKCQkvLyBJbnN0YWxsIGNhbGxiYWNrCgkJb3ZlcndyaXR0ZW4gPSB3aW5kb3dbIGNhbGxiYWNrTmFtZSBdOwoJCXdpbmRvd1sgY2FsbGJhY2tOYW1lIF0gPSBmdW5jdGlvbigpIHsKCQkJcmVzcG9uc2VDb250YWluZXIgPSBhcmd1bWVudHM7CgkJfTsKCgkJLy8gQ2xlYW4tdXAgZnVuY3Rpb24gKGZpcmVzIGFmdGVyIGNvbnZlcnRlcnMpCgkJanFYSFIuYWx3YXlzKGZ1bmN0aW9uKCkgewoJCQkvLyBSZXN0b3JlIHByZWV4aXN0aW5nIHZhbHVlCgkJCXdpbmRvd1sgY2FsbGJhY2tOYW1lIF0gPSBvdmVyd3JpdHRlbjsKCgkJCS8vIFNhdmUgYmFjayBhcyBmcmVlCgkJCWlmICggc1sgY2FsbGJhY2tOYW1lIF0gKSB7CgkJCQkvLyBtYWtlIHN1cmUgdGhhdCByZS11c2luZyB0aGUgb3B0aW9ucyBkb2Vzbid0IHNjcmV3IHRoaW5ncyBhcm91bmQKCQkJCXMuanNvbnBDYWxsYmFjayA9IG9yaWdpbmFsU2V0dGluZ3MuanNvbnBDYWxsYmFjazsKCgkJCQkvLyBzYXZlIHRoZSBjYWxsYmFjayBuYW1lIGZvciBmdXR1cmUgdXNlCgkJCQlvbGRDYWxsYmFja3MucHVzaCggY2FsbGJhY2tOYW1lICk7CgkJCX0KCgkJCS8vIENhbGwgaWYgaXQgd2FzIGEgZnVuY3Rpb24gYW5kIHdlIGhhdmUgYSByZXNwb25zZQoJCQlpZiAoIHJlc3BvbnNlQ29udGFpbmVyICYmIGpRdWVyeS5pc0Z1bmN0aW9uKCBvdmVyd3JpdHRlbiApICkgewoJCQkJb3ZlcndyaXR0ZW4oIHJlc3BvbnNlQ29udGFpbmVyWyAwIF0gKTsKCQkJfQoKCQkJcmVzcG9uc2VDb250YWluZXIgPSBvdmVyd3JpdHRlbiA9IHVuZGVmaW5lZDsKCQl9KTsKCgkJLy8gRGVsZWdhdGUgdG8gc2NyaXB0CgkJcmV0dXJuICJzY3JpcHQiOwoJfQp9KTsKdmFyIHhockNhbGxiYWNrcywgeGhyU3VwcG9ydGVkLAoJeGhySWQgPSAwLAoJLy8gIzUyODA6IEludGVybmV0IEV4cGxvcmVyIHdpbGwga2VlcCBjb25uZWN0aW9ucyBhbGl2ZSBpZiB3ZSBkb24ndCBhYm9ydCBvbiB1bmxvYWQKCXhock9uVW5sb2FkQWJvcnQgPSB3aW5kb3cuQWN0aXZlWE9iamVjdCAmJiBmdW5jdGlvbigpIHsKCQkvLyBBYm9ydCBhbGwgcGVuZGluZyByZXF1ZXN0cwoJCXZhciBrZXk7CgkJZm9yICgga2V5IGluIHhockNhbGxiYWNrcyApIHsKCQkJeGhyQ2FsbGJhY2tzWyBrZXkgXSggdW5kZWZpbmVkLCB0cnVlICk7CgkJfQoJfTsKCi8vIEZ1bmN0aW9ucyB0byBjcmVhdGUgeGhycwpmdW5jdGlvbiBjcmVhdGVTdGFuZGFyZFhIUigpIHsKCXRyeSB7CgkJcmV0dXJuIG5ldyB3aW5kb3cuWE1MSHR0cFJlcXVlc3QoKTsKCX0gY2F0Y2goIGUgKSB7fQp9CgpmdW5jdGlvbiBjcmVhdGVBY3RpdmVYSFIoKSB7Cgl0cnkgewoJCXJldHVybiBuZXcgd2luZG93LkFjdGl2ZVhPYmplY3QoIk1pY3Jvc29mdC5YTUxIVFRQIik7Cgl9IGNhdGNoKCBlICkge30KfQoKLy8gQ3JlYXRlIHRoZSByZXF1ZXN0IG9iamVjdAovLyAoVGhpcyBpcyBzdGlsbCBhdHRhY2hlZCB0byBhamF4U2V0dGluZ3MgZm9yIGJhY2t3YXJkIGNvbXBhdGliaWxpdHkpCmpRdWVyeS5hamF4U2V0dGluZ3MueGhyID0gd2luZG93LkFjdGl2ZVhPYmplY3QgPwoJLyogTWljcm9zb2Z0IGZhaWxlZCB0byBwcm9wZXJseQoJICogaW1wbGVtZW50IHRoZSBYTUxIdHRwUmVxdWVzdCBpbiBJRTcgKGNhbid0IHJlcXVlc3QgbG9jYWwgZmlsZXMpLAoJICogc28gd2UgdXNlIHRoZSBBY3RpdmVYT2JqZWN0IHdoZW4gaXQgaXMgYXZhaWxhYmxlCgkgKiBBZGRpdGlvbmFsbHkgWE1MSHR0cFJlcXVlc3QgY2FuIGJlIGRpc2FibGVkIGluIElFNy9JRTggc28KCSAqIHdlIG5lZWQgYSBmYWxsYmFjay4KCSAqLwoJZnVuY3Rpb24oKSB7CgkJcmV0dXJuICF0aGlzLmlzTG9jYWwgJiYgY3JlYXRlU3RhbmRhcmRYSFIoKSB8fCBjcmVhdGVBY3RpdmVYSFIoKTsKCX0gOgoJLy8gRm9yIGFsbCBvdGhlciBicm93c2VycywgdXNlIHRoZSBzdGFuZGFyZCBYTUxIdHRwUmVxdWVzdCBvYmplY3QKCWNyZWF0ZVN0YW5kYXJkWEhSOwoKLy8gRGV0ZXJtaW5lIHN1cHBvcnQgcHJvcGVydGllcwp4aHJTdXBwb3J0ZWQgPSBqUXVlcnkuYWpheFNldHRpbmdzLnhocigpOwpqUXVlcnkuc3VwcG9ydC5jb3JzID0gISF4aHJTdXBwb3J0ZWQgJiYgKCAid2l0aENyZWRlbnRpYWxzIiBpbiB4aHJTdXBwb3J0ZWQgKTsKeGhyU3VwcG9ydGVkID0galF1ZXJ5LnN1cHBvcnQuYWpheCA9ICEheGhyU3VwcG9ydGVkOwoKLy8gQ3JlYXRlIHRyYW5zcG9ydCBpZiB0aGUgYnJvd3NlciBjYW4gcHJvdmlkZSBhbiB4aHIKaWYgKCB4aHJTdXBwb3J0ZWQgKSB7CgoJalF1ZXJ5LmFqYXhUcmFuc3BvcnQoZnVuY3Rpb24oIHMgKSB7CgkJLy8gQ3Jvc3MgZG9tYWluIG9ubHkgYWxsb3dlZCBpZiBzdXBwb3J0ZWQgdGhyb3VnaCBYTUxIdHRwUmVxdWVzdAoJCWlmICggIXMuY3Jvc3NEb21haW4gfHwgalF1ZXJ5LnN1cHBvcnQuY29ycyApIHsKCgkJCXZhciBjYWxsYmFjazsKCgkJCXJldHVybiB7CgkJCQlzZW5kOiBmdW5jdGlvbiggaGVhZGVycywgY29tcGxldGUgKSB7CgoJCQkJCS8vIEdldCBhIG5ldyB4aHIKCQkJCQl2YXIgaGFuZGxlLCBpLAoJCQkJCQl4aHIgPSBzLnhocigpOwoKCQkJCQkvLyBPcGVuIHRoZSBzb2NrZXQKCQkJCQkvLyBQYXNzaW5nIG51bGwgdXNlcm5hbWUsIGdlbmVyYXRlcyBhIGxvZ2luIHBvcHVwIG9uIE9wZXJhICgjMjg2NSkKCQkJCQlpZiAoIHMudXNlcm5hbWUgKSB7CgkJCQkJCXhoci5vcGVuKCBzLnR5cGUsIHMudXJsLCBzLmFzeW5jLCBzLnVzZXJuYW1lLCBzLnBhc3N3b3JkICk7CgkJCQkJfSBlbHNlIHsKCQkJCQkJeGhyLm9wZW4oIHMudHlwZSwgcy51cmwsIHMuYXN5bmMgKTsKCQkJCQl9CgoJCQkJCS8vIEFwcGx5IGN1c3RvbSBmaWVsZHMgaWYgcHJvdmlkZWQKCQkJCQlpZiAoIHMueGhyRmllbGRzICkgewoJCQkJCQlmb3IgKCBpIGluIHMueGhyRmllbGRzICkgewoJCQkJCQkJeGhyWyBpIF0gPSBzLnhockZpZWxkc1sgaSBdOwoJCQkJCQl9CgkJCQkJfQoKCQkJCQkvLyBPdmVycmlkZSBtaW1lIHR5cGUgaWYgbmVlZGVkCgkJCQkJaWYgKCBzLm1pbWVUeXBlICYmIHhoci5vdmVycmlkZU1pbWVUeXBlICkgewoJCQkJCQl4aHIub3ZlcnJpZGVNaW1lVHlwZSggcy5taW1lVHlwZSApOwoJCQkJCX0KCgkJCQkJLy8gWC1SZXF1ZXN0ZWQtV2l0aCBoZWFkZXIKCQkJCQkvLyBGb3IgY3Jvc3MtZG9tYWluIHJlcXVlc3RzLCBzZWVpbmcgYXMgY29uZGl0aW9ucyBmb3IgYSBwcmVmbGlnaHQgYXJlCgkJCQkJLy8gYWtpbiB0byBhIGppZ3NhdyBwdXp6bGUsIHdlIHNpbXBseSBuZXZlciBzZXQgaXQgdG8gYmUgc3VyZS4KCQkJCQkvLyAoaXQgY2FuIGFsd2F5cyBiZSBzZXQgb24gYSBwZXItcmVxdWVzdCBiYXNpcyBvciBldmVuIHVzaW5nIGFqYXhTZXR1cCkKCQkJCQkvLyBGb3Igc2FtZS1kb21haW4gcmVxdWVzdHMsIHdvbid0IGNoYW5nZSBoZWFkZXIgaWYgYWxyZWFkeSBwcm92aWRlZC4KCQkJCQlpZiAoICFzLmNyb3NzRG9tYWluICYmICFoZWFkZXJzWyJYLVJlcXVlc3RlZC1XaXRoIl0gKSB7CgkJCQkJCWhlYWRlcnNbIlgtUmVxdWVzdGVkLVdpdGgiXSA9ICJYTUxIdHRwUmVxdWVzdCI7CgkJCQkJfQoKCQkJCQkvLyBOZWVkIGFuIGV4dHJhIHRyeS9jYXRjaCBmb3IgY3Jvc3MgZG9tYWluIHJlcXVlc3RzIGluIEZpcmVmb3ggMwoJCQkJCXRyeSB7CgkJCQkJCWZvciAoIGkgaW4gaGVhZGVycyApIHsKCQkJCQkJCXhoci5zZXRSZXF1ZXN0SGVhZGVyKCBpLCBoZWFkZXJzWyBpIF0gKTsKCQkJCQkJfQoJCQkJCX0gY2F0Y2goIGVyciApIHt9CgoJCQkJCS8vIERvIHNlbmQgdGhlIHJlcXVlc3QKCQkJCQkvLyBUaGlzIG1heSByYWlzZSBhbiBleGNlcHRpb24gd2hpY2ggaXMgYWN0dWFsbHkKCQkJCQkvLyBoYW5kbGVkIGluIGpRdWVyeS5hamF4IChzbyBubyB0cnkvY2F0Y2ggaGVyZSkKCQkJCQl4aHIuc2VuZCggKCBzLmhhc0NvbnRlbnQgJiYgcy5kYXRhICkgfHwgbnVsbCApOwoKCQkJCQkvLyBMaXN0ZW5lcgoJCQkJCWNhbGxiYWNrID0gZnVuY3Rpb24oIF8sIGlzQWJvcnQgKSB7CgkJCQkJCXZhciBzdGF0dXMsIHJlc3BvbnNlSGVhZGVycywgc3RhdHVzVGV4dCwgcmVzcG9uc2VzOwoKCQkJCQkJLy8gRmlyZWZveCB0aHJvd3MgZXhjZXB0aW9ucyB3aGVuIGFjY2Vzc2luZyBwcm9wZXJ0aWVzCgkJCQkJCS8vIG9mIGFuIHhociB3aGVuIGEgbmV0d29yayBlcnJvciBvY2N1cnJlZAoJCQkJCQkvLyBodHRwOi8vaGVscGZ1bC5rbm9icy1kaWFscy5jb20vaW5kZXgucGhwL0NvbXBvbmVudF9yZXR1cm5lZF9mYWlsdXJlX2NvZGU6XzB4ODAwNDAxMTFfKE5TX0VSUk9SX05PVF9BVkFJTEFCTEUpCgkJCQkJCXRyeSB7CgoJCQkJCQkJLy8gV2FzIG5ldmVyIGNhbGxlZCBhbmQgaXMgYWJvcnRlZCBvciBjb21wbGV0ZQoJCQkJCQkJaWYgKCBjYWxsYmFjayAmJiAoIGlzQWJvcnQgfHwgeGhyLnJlYWR5U3RhdGUgPT09IDQgKSApIHsKCgkJCQkJCQkJLy8gT25seSBjYWxsZWQgb25jZQoJCQkJCQkJCWNhbGxiYWNrID0gdW5kZWZpbmVkOwoKCQkJCQkJCQkvLyBEbyBub3Qga2VlcCBhcyBhY3RpdmUgYW55bW9yZQoJCQkJCQkJCWlmICggaGFuZGxlICkgewoJCQkJCQkJCQl4aHIub25yZWFkeXN0YXRlY2hhbmdlID0galF1ZXJ5Lm5vb3A7CgkJCQkJCQkJCWlmICggeGhyT25VbmxvYWRBYm9ydCApIHsKCQkJCQkJCQkJCWRlbGV0ZSB4aHJDYWxsYmFja3NbIGhhbmRsZSBdOwoJCQkJCQkJCQl9CgkJCQkJCQkJfQoKCQkJCQkJCQkvLyBJZiBpdCdzIGFuIGFib3J0CgkJCQkJCQkJaWYgKCBpc0Fib3J0ICkgewoJCQkJCQkJCQkvLyBBYm9ydCBpdCBtYW51YWxseSBpZiBuZWVkZWQKCQkJCQkJCQkJaWYgKCB4aHIucmVhZHlTdGF0ZSAhPT0gNCApIHsKCQkJCQkJCQkJCXhoci5hYm9ydCgpOwoJCQkJCQkJCQl9CgkJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkJcmVzcG9uc2VzID0ge307CgkJCQkJCQkJCXN0YXR1cyA9IHhoci5zdGF0dXM7CgkJCQkJCQkJCXJlc3BvbnNlSGVhZGVycyA9IHhoci5nZXRBbGxSZXNwb25zZUhlYWRlcnMoKTsKCgkJCQkJCQkJCS8vIFdoZW4gcmVxdWVzdGluZyBiaW5hcnkgZGF0YSwgSUU2LTkgd2lsbCB0aHJvdyBhbiBleGNlcHRpb24KCQkJCQkJCQkJLy8gb24gYW55IGF0dGVtcHQgdG8gYWNjZXNzIHJlc3BvbnNlVGV4dCAoIzExNDI2KQoJCQkJCQkJCQlpZiAoIHR5cGVvZiB4aHIucmVzcG9uc2VUZXh0ID09PSAic3RyaW5nIiApIHsKCQkJCQkJCQkJCXJlc3BvbnNlcy50ZXh0ID0geGhyLnJlc3BvbnNlVGV4dDsKCQkJCQkJCQkJfQoKCQkJCQkJCQkJLy8gRmlyZWZveCB0aHJvd3MgYW4gZXhjZXB0aW9uIHdoZW4gYWNjZXNzaW5nCgkJCQkJCQkJCS8vIHN0YXR1c1RleHQgZm9yIGZhdWx0eSBjcm9zcy1kb21haW4gcmVxdWVzdHMKCQkJCQkJCQkJdHJ5IHsKCQkJCQkJCQkJCXN0YXR1c1RleHQgPSB4aHIuc3RhdHVzVGV4dDsKCQkJCQkJCQkJfSBjYXRjaCggZSApIHsKCQkJCQkJCQkJCS8vIFdlIG5vcm1hbGl6ZSB3aXRoIFdlYmtpdCBnaXZpbmcgYW4gZW1wdHkgc3RhdHVzVGV4dAoJCQkJCQkJCQkJc3RhdHVzVGV4dCA9ICIiOwoJCQkJCQkJCQl9CgoJCQkJCQkJCQkvLyBGaWx0ZXIgc3RhdHVzIGZvciBub24gc3RhbmRhcmQgYmVoYXZpb3JzCgoJCQkJCQkJCQkvLyBJZiB0aGUgcmVxdWVzdCBpcyBsb2NhbCBhbmQgd2UgaGF2ZSBkYXRhOiBhc3N1bWUgYSBzdWNjZXNzCgkJCQkJCQkJCS8vIChzdWNjZXNzIHdpdGggbm8gZGF0YSB3b24ndCBnZXQgbm90aWZpZWQsIHRoYXQncyB0aGUgYmVzdCB3ZQoJCQkJCQkJCQkvLyBjYW4gZG8gZ2l2ZW4gY3VycmVudCBpbXBsZW1lbnRhdGlvbnMpCgkJCQkJCQkJCWlmICggIXN0YXR1cyAmJiBzLmlzTG9jYWwgJiYgIXMuY3Jvc3NEb21haW4gKSB7CgkJCQkJCQkJCQlzdGF0dXMgPSByZXNwb25zZXMudGV4dCA/IDIwMCA6IDQwNDsKCQkJCQkJCQkJLy8gSUUgLSAjMTQ1MDogc29tZXRpbWVzIHJldHVybnMgMTIyMyB3aGVuIGl0IHNob3VsZCBiZSAyMDQKCQkJCQkJCQkJfSBlbHNlIGlmICggc3RhdHVzID09PSAxMjIzICkgewoJCQkJCQkJCQkJc3RhdHVzID0gMjA0OwoJCQkJCQkJCQl9CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQl9IGNhdGNoKCBmaXJlZm94QWNjZXNzRXhjZXB0aW9uICkgewoJCQkJCQkJaWYgKCAhaXNBYm9ydCApIHsKCQkJCQkJCQljb21wbGV0ZSggLTEsIGZpcmVmb3hBY2Nlc3NFeGNlcHRpb24gKTsKCQkJCQkJCX0KCQkJCQkJfQoKCQkJCQkJLy8gQ2FsbCBjb21wbGV0ZSBpZiBuZWVkZWQKCQkJCQkJaWYgKCByZXNwb25zZXMgKSB7CgkJCQkJCQljb21wbGV0ZSggc3RhdHVzLCBzdGF0dXNUZXh0LCByZXNwb25zZXMsIHJlc3BvbnNlSGVhZGVycyApOwoJCQkJCQl9CgkJCQkJfTsKCgkJCQkJaWYgKCAhcy5hc3luYyApIHsKCQkJCQkJLy8gaWYgd2UncmUgaW4gc3luYyBtb2RlIHdlIGZpcmUgdGhlIGNhbGxiYWNrCgkJCQkJCWNhbGxiYWNrKCk7CgkJCQkJfSBlbHNlIGlmICggeGhyLnJlYWR5U3RhdGUgPT09IDQgKSB7CgkJCQkJCS8vIChJRTYgJiBJRTcpIGlmIGl0J3MgaW4gY2FjaGUgYW5kIGhhcyBiZWVuCgkJCQkJCS8vIHJldHJpZXZlZCBkaXJlY3RseSB3ZSBuZWVkIHRvIGZpcmUgdGhlIGNhbGxiYWNrCgkJCQkJCXNldFRpbWVvdXQoIGNhbGxiYWNrICk7CgkJCQkJfSBlbHNlIHsKCQkJCQkJaGFuZGxlID0gKyt4aHJJZDsKCQkJCQkJaWYgKCB4aHJPblVubG9hZEFib3J0ICkgewoJCQkJCQkJLy8gQ3JlYXRlIHRoZSBhY3RpdmUgeGhycyBjYWxsYmFja3MgbGlzdCBpZiBuZWVkZWQKCQkJCQkJCS8vIGFuZCBhdHRhY2ggdGhlIHVubG9hZCBoYW5kbGVyCgkJCQkJCQlpZiAoICF4aHJDYWxsYmFja3MgKSB7CgkJCQkJCQkJeGhyQ2FsbGJhY2tzID0ge307CgkJCQkJCQkJalF1ZXJ5KCB3aW5kb3cgKS51bmxvYWQoIHhock9uVW5sb2FkQWJvcnQgKTsKCQkJCQkJCX0KCQkJCQkJCS8vIEFkZCB0byBsaXN0IG9mIGFjdGl2ZSB4aHJzIGNhbGxiYWNrcwoJCQkJCQkJeGhyQ2FsbGJhY2tzWyBoYW5kbGUgXSA9IGNhbGxiYWNrOwoJCQkJCQl9CgkJCQkJCXhoci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBjYWxsYmFjazsKCQkJCQl9CgkJCQl9LAoKCQkJCWFib3J0OiBmdW5jdGlvbigpIHsKCQkJCQlpZiAoIGNhbGxiYWNrICkgewoJCQkJCQljYWxsYmFjayggdW5kZWZpbmVkLCB0cnVlICk7CgkJCQkJfQoJCQkJfQoJCQl9OwoJCX0KCX0pOwp9CnZhciBmeE5vdywgdGltZXJJZCwKCXJmeHR5cGVzID0gL14oPzp0b2dnbGV8c2hvd3xoaWRlKSQvLAoJcmZ4bnVtID0gbmV3IFJlZ0V4cCggIl4oPzooWystXSk9fCkoIiArIGNvcmVfcG51bSArICIpKFthLXolXSopJCIsICJpIiApLAoJcnJ1biA9IC9xdWV1ZUhvb2tzJC8sCglhbmltYXRpb25QcmVmaWx0ZXJzID0gWyBkZWZhdWx0UHJlZmlsdGVyIF0sCgl0d2VlbmVycyA9IHsKCQkiKiI6IFtmdW5jdGlvbiggcHJvcCwgdmFsdWUgKSB7CgkJCXZhciBlbmQsIHVuaXQsCgkJCQl0d2VlbiA9IHRoaXMuY3JlYXRlVHdlZW4oIHByb3AsIHZhbHVlICksCgkJCQlwYXJ0cyA9IHJmeG51bS5leGVjKCB2YWx1ZSApLAoJCQkJdGFyZ2V0ID0gdHdlZW4uY3VyKCksCgkJCQlzdGFydCA9ICt0YXJnZXQgfHwgMCwKCQkJCXNjYWxlID0gMSwKCQkJCW1heEl0ZXJhdGlvbnMgPSAyMDsKCgkJCWlmICggcGFydHMgKSB7CgkJCQllbmQgPSArcGFydHNbMl07CgkJCQl1bml0ID0gcGFydHNbM10gfHwgKCBqUXVlcnkuY3NzTnVtYmVyWyBwcm9wIF0gPyAiIiA6ICJweCIgKTsKCgkJCQkvLyBXZSBuZWVkIHRvIGNvbXB1dGUgc3RhcnRpbmcgdmFsdWUKCQkJCWlmICggdW5pdCAhPT0gInB4IiAmJiBzdGFydCApIHsKCQkJCQkvLyBJdGVyYXRpdmVseSBhcHByb3hpbWF0ZSBmcm9tIGEgbm9uemVybyBzdGFydGluZyBwb2ludAoJCQkJCS8vIFByZWZlciB0aGUgY3VycmVudCBwcm9wZXJ0eSwgYmVjYXVzZSB0aGlzIHByb2Nlc3Mgd2lsbCBiZSB0cml2aWFsIGlmIGl0IHVzZXMgdGhlIHNhbWUgdW5pdHMKCQkJCQkvLyBGYWxsYmFjayB0byBlbmQgb3IgYSBzaW1wbGUgY29uc3RhbnQKCQkJCQlzdGFydCA9IGpRdWVyeS5jc3MoIHR3ZWVuLmVsZW0sIHByb3AsIHRydWUgKSB8fCBlbmQgfHwgMTsKCgkJCQkJZG8gewoJCQkJCQkvLyBJZiBwcmV2aW91cyBpdGVyYXRpb24gemVyb2VkIG91dCwgZG91YmxlIHVudGlsIHdlIGdldCAqc29tZXRoaW5nKgoJCQkJCQkvLyBVc2UgYSBzdHJpbmcgZm9yIGRvdWJsaW5nIGZhY3RvciBzbyB3ZSBkb24ndCBhY2NpZGVudGFsbHkgc2VlIHNjYWxlIGFzIHVuY2hhbmdlZCBiZWxvdwoJCQkJCQlzY2FsZSA9IHNjYWxlIHx8ICIuNSI7CgoJCQkJCQkvLyBBZGp1c3QgYW5kIGFwcGx5CgkJCQkJCXN0YXJ0ID0gc3RhcnQgLyBzY2FsZTsKCQkJCQkJalF1ZXJ5LnN0eWxlKCB0d2Vlbi5lbGVtLCBwcm9wLCBzdGFydCArIHVuaXQgKTsKCgkJCQkJLy8gVXBkYXRlIHNjYWxlLCB0b2xlcmF0aW5nIHplcm8gb3IgTmFOIGZyb20gdHdlZW4uY3VyKCkKCQkJCQkvLyBBbmQgYnJlYWtpbmcgdGhlIGxvb3AgaWYgc2NhbGUgaXMgdW5jaGFuZ2VkIG9yIHBlcmZlY3QsIG9yIGlmIHdlJ3ZlIGp1c3QgaGFkIGVub3VnaAoJCQkJCX0gd2hpbGUgKCBzY2FsZSAhPT0gKHNjYWxlID0gdHdlZW4uY3VyKCkgLyB0YXJnZXQpICYmIHNjYWxlICE9PSAxICYmIC0tbWF4SXRlcmF0aW9ucyApOwoJCQkJfQoKCQkJCXR3ZWVuLnVuaXQgPSB1bml0OwoJCQkJdHdlZW4uc3RhcnQgPSBzdGFydDsKCQkJCS8vIElmIGEgKz0vLT0gdG9rZW4gd2FzIHByb3ZpZGVkLCB3ZSdyZSBkb2luZyBhIHJlbGF0aXZlIGFuaW1hdGlvbgoJCQkJdHdlZW4uZW5kID0gcGFydHNbMV0gPyBzdGFydCArICggcGFydHNbMV0gKyAxICkgKiBlbmQgOiBlbmQ7CgkJCX0KCQkJcmV0dXJuIHR3ZWVuOwoJCX1dCgl9OwoKLy8gQW5pbWF0aW9ucyBjcmVhdGVkIHN5bmNocm9ub3VzbHkgd2lsbCBydW4gc3luY2hyb25vdXNseQpmdW5jdGlvbiBjcmVhdGVGeE5vdygpIHsKCXNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CgkJZnhOb3cgPSB1bmRlZmluZWQ7Cgl9KTsKCXJldHVybiAoIGZ4Tm93ID0galF1ZXJ5Lm5vdygpICk7Cn0KCmZ1bmN0aW9uIGNyZWF0ZVR3ZWVucyggYW5pbWF0aW9uLCBwcm9wcyApIHsKCWpRdWVyeS5lYWNoKCBwcm9wcywgZnVuY3Rpb24oIHByb3AsIHZhbHVlICkgewoJCXZhciBjb2xsZWN0aW9uID0gKCB0d2VlbmVyc1sgcHJvcCBdIHx8IFtdICkuY29uY2F0KCB0d2VlbmVyc1sgIioiIF0gKSwKCQkJaW5kZXggPSAwLAoJCQlsZW5ndGggPSBjb2xsZWN0aW9uLmxlbmd0aDsKCQlmb3IgKCA7IGluZGV4IDwgbGVuZ3RoOyBpbmRleCsrICkgewoJCQlpZiAoIGNvbGxlY3Rpb25bIGluZGV4IF0uY2FsbCggYW5pbWF0aW9uLCBwcm9wLCB2YWx1ZSApICkgewoKCQkJCS8vIHdlJ3JlIGRvbmUgd2l0aCB0aGlzIHByb3BlcnR5CgkJCQlyZXR1cm47CgkJCX0KCQl9Cgl9KTsKfQoKZnVuY3Rpb24gQW5pbWF0aW9uKCBlbGVtLCBwcm9wZXJ0aWVzLCBvcHRpb25zICkgewoJdmFyIHJlc3VsdCwKCQlzdG9wcGVkLAoJCWluZGV4ID0gMCwKCQlsZW5ndGggPSBhbmltYXRpb25QcmVmaWx0ZXJzLmxlbmd0aCwKCQlkZWZlcnJlZCA9IGpRdWVyeS5EZWZlcnJlZCgpLmFsd2F5cyggZnVuY3Rpb24oKSB7CgkJCS8vIGRvbid0IG1hdGNoIGVsZW0gaW4gdGhlIDphbmltYXRlZCBzZWxlY3RvcgoJCQlkZWxldGUgdGljay5lbGVtOwoJCX0pLAoJCXRpY2sgPSBmdW5jdGlvbigpIHsKCQkJaWYgKCBzdG9wcGVkICkgewoJCQkJcmV0dXJuIGZhbHNlOwoJCQl9CgkJCXZhciBjdXJyZW50VGltZSA9IGZ4Tm93IHx8IGNyZWF0ZUZ4Tm93KCksCgkJCQlyZW1haW5pbmcgPSBNYXRoLm1heCggMCwgYW5pbWF0aW9uLnN0YXJ0VGltZSArIGFuaW1hdGlvbi5kdXJhdGlvbiAtIGN1cnJlbnRUaW1lICksCgkJCQkvLyBhcmNoYWljIGNyYXNoIGJ1ZyB3b24ndCBhbGxvdyB1cyB0byB1c2UgMSAtICggMC41IHx8IDAgKSAoIzEyNDk3KQoJCQkJdGVtcCA9IHJlbWFpbmluZyAvIGFuaW1hdGlvbi5kdXJhdGlvbiB8fCAwLAoJCQkJcGVyY2VudCA9IDEgLSB0ZW1wLAoJCQkJaW5kZXggPSAwLAoJCQkJbGVuZ3RoID0gYW5pbWF0aW9uLnR3ZWVucy5sZW5ndGg7CgoJCQlmb3IgKCA7IGluZGV4IDwgbGVuZ3RoIDsgaW5kZXgrKyApIHsKCQkJCWFuaW1hdGlvbi50d2VlbnNbIGluZGV4IF0ucnVuKCBwZXJjZW50ICk7CgkJCX0KCgkJCWRlZmVycmVkLm5vdGlmeVdpdGgoIGVsZW0sIFsgYW5pbWF0aW9uLCBwZXJjZW50LCByZW1haW5pbmcgXSk7CgoJCQlpZiAoIHBlcmNlbnQgPCAxICYmIGxlbmd0aCApIHsKCQkJCXJldHVybiByZW1haW5pbmc7CgkJCX0gZWxzZSB7CgkJCQlkZWZlcnJlZC5yZXNvbHZlV2l0aCggZWxlbSwgWyBhbmltYXRpb24gXSApOwoJCQkJcmV0dXJuIGZhbHNlOwoJCQl9CgkJfSwKCQlhbmltYXRpb24gPSBkZWZlcnJlZC5wcm9taXNlKHsKCQkJZWxlbTogZWxlbSwKCQkJcHJvcHM6IGpRdWVyeS5leHRlbmQoIHt9LCBwcm9wZXJ0aWVzICksCgkJCW9wdHM6IGpRdWVyeS5leHRlbmQoIHRydWUsIHsgc3BlY2lhbEVhc2luZzoge30gfSwgb3B0aW9ucyApLAoJCQlvcmlnaW5hbFByb3BlcnRpZXM6IHByb3BlcnRpZXMsCgkJCW9yaWdpbmFsT3B0aW9uczogb3B0aW9ucywKCQkJc3RhcnRUaW1lOiBmeE5vdyB8fCBjcmVhdGVGeE5vdygpLAoJCQlkdXJhdGlvbjogb3B0aW9ucy5kdXJhdGlvbiwKCQkJdHdlZW5zOiBbXSwKCQkJY3JlYXRlVHdlZW46IGZ1bmN0aW9uKCBwcm9wLCBlbmQgKSB7CgkJCQl2YXIgdHdlZW4gPSBqUXVlcnkuVHdlZW4oIGVsZW0sIGFuaW1hdGlvbi5vcHRzLCBwcm9wLCBlbmQsCgkJCQkJCWFuaW1hdGlvbi5vcHRzLnNwZWNpYWxFYXNpbmdbIHByb3AgXSB8fCBhbmltYXRpb24ub3B0cy5lYXNpbmcgKTsKCQkJCWFuaW1hdGlvbi50d2VlbnMucHVzaCggdHdlZW4gKTsKCQkJCXJldHVybiB0d2VlbjsKCQkJfSwKCQkJc3RvcDogZnVuY3Rpb24oIGdvdG9FbmQgKSB7CgkJCQl2YXIgaW5kZXggPSAwLAoJCQkJCS8vIGlmIHdlIGFyZSBnb2luZyB0byB0aGUgZW5kLCB3ZSB3YW50IHRvIHJ1biBhbGwgdGhlIHR3ZWVucwoJCQkJCS8vIG90aGVyd2lzZSB3ZSBza2lwIHRoaXMgcGFydAoJCQkJCWxlbmd0aCA9IGdvdG9FbmQgPyBhbmltYXRpb24udHdlZW5zLmxlbmd0aCA6IDA7CgkJCQlpZiAoIHN0b3BwZWQgKSB7CgkJCQkJcmV0dXJuIHRoaXM7CgkJCQl9CgkJCQlzdG9wcGVkID0gdHJ1ZTsKCQkJCWZvciAoIDsgaW5kZXggPCBsZW5ndGggOyBpbmRleCsrICkgewoJCQkJCWFuaW1hdGlvbi50d2VlbnNbIGluZGV4IF0ucnVuKCAxICk7CgkJCQl9CgoJCQkJLy8gcmVzb2x2ZSB3aGVuIHdlIHBsYXllZCB0aGUgbGFzdCBmcmFtZQoJCQkJLy8gb3RoZXJ3aXNlLCByZWplY3QKCQkJCWlmICggZ290b0VuZCApIHsKCQkJCQlkZWZlcnJlZC5yZXNvbHZlV2l0aCggZWxlbSwgWyBhbmltYXRpb24sIGdvdG9FbmQgXSApOwoJCQkJfSBlbHNlIHsKCQkJCQlkZWZlcnJlZC5yZWplY3RXaXRoKCBlbGVtLCBbIGFuaW1hdGlvbiwgZ290b0VuZCBdICk7CgkJCQl9CgkJCQlyZXR1cm4gdGhpczsKCQkJfQoJCX0pLAoJCXByb3BzID0gYW5pbWF0aW9uLnByb3BzOwoKCXByb3BGaWx0ZXIoIHByb3BzLCBhbmltYXRpb24ub3B0cy5zcGVjaWFsRWFzaW5nICk7CgoJZm9yICggOyBpbmRleCA8IGxlbmd0aCA7IGluZGV4KysgKSB7CgkJcmVzdWx0ID0gYW5pbWF0aW9uUHJlZmlsdGVyc1sgaW5kZXggXS5jYWxsKCBhbmltYXRpb24sIGVsZW0sIHByb3BzLCBhbmltYXRpb24ub3B0cyApOwoJCWlmICggcmVzdWx0ICkgewoJCQlyZXR1cm4gcmVzdWx0OwoJCX0KCX0KCgljcmVhdGVUd2VlbnMoIGFuaW1hdGlvbiwgcHJvcHMgKTsKCglpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCBhbmltYXRpb24ub3B0cy5zdGFydCApICkgewoJCWFuaW1hdGlvbi5vcHRzLnN0YXJ0LmNhbGwoIGVsZW0sIGFuaW1hdGlvbiApOwoJfQoKCWpRdWVyeS5meC50aW1lcigKCQlqUXVlcnkuZXh0ZW5kKCB0aWNrLCB7CgkJCWVsZW06IGVsZW0sCgkJCWFuaW06IGFuaW1hdGlvbiwKCQkJcXVldWU6IGFuaW1hdGlvbi5vcHRzLnF1ZXVlCgkJfSkKCSk7CgoJLy8gYXR0YWNoIGNhbGxiYWNrcyBmcm9tIG9wdGlvbnMKCXJldHVybiBhbmltYXRpb24ucHJvZ3Jlc3MoIGFuaW1hdGlvbi5vcHRzLnByb2dyZXNzICkKCQkuZG9uZSggYW5pbWF0aW9uLm9wdHMuZG9uZSwgYW5pbWF0aW9uLm9wdHMuY29tcGxldGUgKQoJCS5mYWlsKCBhbmltYXRpb24ub3B0cy5mYWlsICkKCQkuYWx3YXlzKCBhbmltYXRpb24ub3B0cy5hbHdheXMgKTsKfQoKZnVuY3Rpb24gcHJvcEZpbHRlciggcHJvcHMsIHNwZWNpYWxFYXNpbmcgKSB7Cgl2YXIgdmFsdWUsIG5hbWUsIGluZGV4LCBlYXNpbmcsIGhvb2tzOwoKCS8vIGNhbWVsQ2FzZSwgc3BlY2lhbEVhc2luZyBhbmQgZXhwYW5kIGNzc0hvb2sgcGFzcwoJZm9yICggaW5kZXggaW4gcHJvcHMgKSB7CgkJbmFtZSA9IGpRdWVyeS5jYW1lbENhc2UoIGluZGV4ICk7CgkJZWFzaW5nID0gc3BlY2lhbEVhc2luZ1sgbmFtZSBdOwoJCXZhbHVlID0gcHJvcHNbIGluZGV4IF07CgkJaWYgKCBqUXVlcnkuaXNBcnJheSggdmFsdWUgKSApIHsKCQkJZWFzaW5nID0gdmFsdWVbIDEgXTsKCQkJdmFsdWUgPSBwcm9wc1sgaW5kZXggXSA9IHZhbHVlWyAwIF07CgkJfQoKCQlpZiAoIGluZGV4ICE9PSBuYW1lICkgewoJCQlwcm9wc1sgbmFtZSBdID0gdmFsdWU7CgkJCWRlbGV0ZSBwcm9wc1sgaW5kZXggXTsKCQl9CgoJCWhvb2tzID0galF1ZXJ5LmNzc0hvb2tzWyBuYW1lIF07CgkJaWYgKCBob29rcyAmJiAiZXhwYW5kIiBpbiBob29rcyApIHsKCQkJdmFsdWUgPSBob29rcy5leHBhbmQoIHZhbHVlICk7CgkJCWRlbGV0ZSBwcm9wc1sgbmFtZSBdOwoKCQkJLy8gbm90IHF1aXRlICQuZXh0ZW5kLCB0aGlzIHdvbnQgb3ZlcndyaXRlIGtleXMgYWxyZWFkeSBwcmVzZW50LgoJCQkvLyBhbHNvIC0gcmV1c2luZyAnaW5kZXgnIGZyb20gYWJvdmUgYmVjYXVzZSB3ZSBoYXZlIHRoZSBjb3JyZWN0ICJuYW1lIgoJCQlmb3IgKCBpbmRleCBpbiB2YWx1ZSApIHsKCQkJCWlmICggISggaW5kZXggaW4gcHJvcHMgKSApIHsKCQkJCQlwcm9wc1sgaW5kZXggXSA9IHZhbHVlWyBpbmRleCBdOwoJCQkJCXNwZWNpYWxFYXNpbmdbIGluZGV4IF0gPSBlYXNpbmc7CgkJCQl9CgkJCX0KCQl9IGVsc2UgewoJCQlzcGVjaWFsRWFzaW5nWyBuYW1lIF0gPSBlYXNpbmc7CgkJfQoJfQp9CgpqUXVlcnkuQW5pbWF0aW9uID0galF1ZXJ5LmV4dGVuZCggQW5pbWF0aW9uLCB7CgoJdHdlZW5lcjogZnVuY3Rpb24oIHByb3BzLCBjYWxsYmFjayApIHsKCQlpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCBwcm9wcyApICkgewoJCQljYWxsYmFjayA9IHByb3BzOwoJCQlwcm9wcyA9IFsgIioiIF07CgkJfSBlbHNlIHsKCQkJcHJvcHMgPSBwcm9wcy5zcGxpdCgiICIpOwoJCX0KCgkJdmFyIHByb3AsCgkJCWluZGV4ID0gMCwKCQkJbGVuZ3RoID0gcHJvcHMubGVuZ3RoOwoKCQlmb3IgKCA7IGluZGV4IDwgbGVuZ3RoIDsgaW5kZXgrKyApIHsKCQkJcHJvcCA9IHByb3BzWyBpbmRleCBdOwoJCQl0d2VlbmVyc1sgcHJvcCBdID0gdHdlZW5lcnNbIHByb3AgXSB8fCBbXTsKCQkJdHdlZW5lcnNbIHByb3AgXS51bnNoaWZ0KCBjYWxsYmFjayApOwoJCX0KCX0sCgoJcHJlZmlsdGVyOiBmdW5jdGlvbiggY2FsbGJhY2ssIHByZXBlbmQgKSB7CgkJaWYgKCBwcmVwZW5kICkgewoJCQlhbmltYXRpb25QcmVmaWx0ZXJzLnVuc2hpZnQoIGNhbGxiYWNrICk7CgkJfSBlbHNlIHsKCQkJYW5pbWF0aW9uUHJlZmlsdGVycy5wdXNoKCBjYWxsYmFjayApOwoJCX0KCX0KfSk7CgpmdW5jdGlvbiBkZWZhdWx0UHJlZmlsdGVyKCBlbGVtLCBwcm9wcywgb3B0cyApIHsKCS8qanNoaW50IHZhbGlkdGhpczp0cnVlICovCgl2YXIgcHJvcCwgaW5kZXgsIGxlbmd0aCwKCQl2YWx1ZSwgZGF0YVNob3csIHRvZ2dsZSwKCQl0d2VlbiwgaG9va3MsIG9sZGZpcmUsCgkJYW5pbSA9IHRoaXMsCgkJc3R5bGUgPSBlbGVtLnN0eWxlLAoJCW9yaWcgPSB7fSwKCQloYW5kbGVkID0gW10sCgkJaGlkZGVuID0gZWxlbS5ub2RlVHlwZSAmJiBpc0hpZGRlbiggZWxlbSApOwoKCS8vIGhhbmRsZSBxdWV1ZTogZmFsc2UgcHJvbWlzZXMKCWlmICggIW9wdHMucXVldWUgKSB7CgkJaG9va3MgPSBqUXVlcnkuX3F1ZXVlSG9va3MoIGVsZW0sICJmeCIgKTsKCQlpZiAoIGhvb2tzLnVucXVldWVkID09IG51bGwgKSB7CgkJCWhvb2tzLnVucXVldWVkID0gMDsKCQkJb2xkZmlyZSA9IGhvb2tzLmVtcHR5LmZpcmU7CgkJCWhvb2tzLmVtcHR5LmZpcmUgPSBmdW5jdGlvbigpIHsKCQkJCWlmICggIWhvb2tzLnVucXVldWVkICkgewoJCQkJCW9sZGZpcmUoKTsKCQkJCX0KCQkJfTsKCQl9CgkJaG9va3MudW5xdWV1ZWQrKzsKCgkJYW5pbS5hbHdheXMoZnVuY3Rpb24oKSB7CgkJCS8vIGRvaW5nIHRoaXMgbWFrZXMgc3VyZSB0aGF0IHRoZSBjb21wbGV0ZSBoYW5kbGVyIHdpbGwgYmUgY2FsbGVkCgkJCS8vIGJlZm9yZSB0aGlzIGNvbXBsZXRlcwoJCQlhbmltLmFsd2F5cyhmdW5jdGlvbigpIHsKCQkJCWhvb2tzLnVucXVldWVkLS07CgkJCQlpZiAoICFqUXVlcnkucXVldWUoIGVsZW0sICJmeCIgKS5sZW5ndGggKSB7CgkJCQkJaG9va3MuZW1wdHkuZmlyZSgpOwoJCQkJfQoJCQl9KTsKCQl9KTsKCX0KCgkvLyBoZWlnaHQvd2lkdGggb3ZlcmZsb3cgcGFzcwoJaWYgKCBlbGVtLm5vZGVUeXBlID09PSAxICYmICggImhlaWdodCIgaW4gcHJvcHMgfHwgIndpZHRoIiBpbiBwcm9wcyApICkgewoJCS8vIE1ha2Ugc3VyZSB0aGF0IG5vdGhpbmcgc25lYWtzIG91dAoJCS8vIFJlY29yZCBhbGwgMyBvdmVyZmxvdyBhdHRyaWJ1dGVzIGJlY2F1c2UgSUUgZG9lcyBub3QKCQkvLyBjaGFuZ2UgdGhlIG92ZXJmbG93IGF0dHJpYnV0ZSB3aGVuIG92ZXJmbG93WCBhbmQKCQkvLyBvdmVyZmxvd1kgYXJlIHNldCB0byB0aGUgc2FtZSB2YWx1ZQoJCW9wdHMub3ZlcmZsb3cgPSBbIHN0eWxlLm92ZXJmbG93LCBzdHlsZS5vdmVyZmxvd1gsIHN0eWxlLm92ZXJmbG93WSBdOwoKCQkvLyBTZXQgZGlzcGxheSBwcm9wZXJ0eSB0byBpbmxpbmUtYmxvY2sgZm9yIGhlaWdodC93aWR0aAoJCS8vIGFuaW1hdGlvbnMgb24gaW5saW5lIGVsZW1lbnRzIHRoYXQgYXJlIGhhdmluZyB3aWR0aC9oZWlnaHQgYW5pbWF0ZWQKCQlpZiAoIGpRdWVyeS5jc3MoIGVsZW0sICJkaXNwbGF5IiApID09PSAiaW5saW5lIiAmJgoJCQkJalF1ZXJ5LmNzcyggZWxlbSwgImZsb2F0IiApID09PSAibm9uZSIgKSB7CgoJCQkvLyBpbmxpbmUtbGV2ZWwgZWxlbWVudHMgYWNjZXB0IGlubGluZS1ibG9jazsKCQkJLy8gYmxvY2stbGV2ZWwgZWxlbWVudHMgbmVlZCB0byBiZSBpbmxpbmUgd2l0aCBsYXlvdXQKCQkJaWYgKCAhalF1ZXJ5LnN1cHBvcnQuaW5saW5lQmxvY2tOZWVkc0xheW91dCB8fCBjc3NfZGVmYXVsdERpc3BsYXkoIGVsZW0ubm9kZU5hbWUgKSA9PT0gImlubGluZSIgKSB7CgkJCQlzdHlsZS5kaXNwbGF5ID0gImlubGluZS1ibG9jayI7CgoJCQl9IGVsc2UgewoJCQkJc3R5bGUuem9vbSA9IDE7CgkJCX0KCQl9Cgl9CgoJaWYgKCBvcHRzLm92ZXJmbG93ICkgewoJCXN0eWxlLm92ZXJmbG93ID0gImhpZGRlbiI7CgkJaWYgKCAhalF1ZXJ5LnN1cHBvcnQuc2hyaW5rV3JhcEJsb2NrcyApIHsKCQkJYW5pbS5hbHdheXMoZnVuY3Rpb24oKSB7CgkJCQlzdHlsZS5vdmVyZmxvdyA9IG9wdHMub3ZlcmZsb3dbIDAgXTsKCQkJCXN0eWxlLm92ZXJmbG93WCA9IG9wdHMub3ZlcmZsb3dbIDEgXTsKCQkJCXN0eWxlLm92ZXJmbG93WSA9IG9wdHMub3ZlcmZsb3dbIDIgXTsKCQkJfSk7CgkJfQoJfQoKCgkvLyBzaG93L2hpZGUgcGFzcwoJZm9yICggaW5kZXggaW4gcHJvcHMgKSB7CgkJdmFsdWUgPSBwcm9wc1sgaW5kZXggXTsKCQlpZiAoIHJmeHR5cGVzLmV4ZWMoIHZhbHVlICkgKSB7CgkJCWRlbGV0ZSBwcm9wc1sgaW5kZXggXTsKCQkJdG9nZ2xlID0gdG9nZ2xlIHx8IHZhbHVlID09PSAidG9nZ2xlIjsKCQkJaWYgKCB2YWx1ZSA9PT0gKCBoaWRkZW4gPyAiaGlkZSIgOiAic2hvdyIgKSApIHsKCQkJCWNvbnRpbnVlOwoJCQl9CgkJCWhhbmRsZWQucHVzaCggaW5kZXggKTsKCQl9Cgl9CgoJbGVuZ3RoID0gaGFuZGxlZC5sZW5ndGg7CglpZiAoIGxlbmd0aCApIHsKCQlkYXRhU2hvdyA9IGpRdWVyeS5fZGF0YSggZWxlbSwgImZ4c2hvdyIgKSB8fCBqUXVlcnkuX2RhdGEoIGVsZW0sICJmeHNob3ciLCB7fSApOwoJCWlmICggImhpZGRlbiIgaW4gZGF0YVNob3cgKSB7CgkJCWhpZGRlbiA9IGRhdGFTaG93LmhpZGRlbjsKCQl9CgoJCS8vIHN0b3JlIHN0YXRlIGlmIGl0cyB0b2dnbGUgLSBlbmFibGVzIC5zdG9wKCkudG9nZ2xlKCkgdG8gInJldmVyc2UiCgkJaWYgKCB0b2dnbGUgKSB7CgkJCWRhdGFTaG93LmhpZGRlbiA9ICFoaWRkZW47CgkJfQoJCWlmICggaGlkZGVuICkgewoJCQlqUXVlcnkoIGVsZW0gKS5zaG93KCk7CgkJfSBlbHNlIHsKCQkJYW5pbS5kb25lKGZ1bmN0aW9uKCkgewoJCQkJalF1ZXJ5KCBlbGVtICkuaGlkZSgpOwoJCQl9KTsKCQl9CgkJYW5pbS5kb25lKGZ1bmN0aW9uKCkgewoJCQl2YXIgcHJvcDsKCQkJalF1ZXJ5Ll9yZW1vdmVEYXRhKCBlbGVtLCAiZnhzaG93IiApOwoJCQlmb3IgKCBwcm9wIGluIG9yaWcgKSB7CgkJCQlqUXVlcnkuc3R5bGUoIGVsZW0sIHByb3AsIG9yaWdbIHByb3AgXSApOwoJCQl9CgkJfSk7CgkJZm9yICggaW5kZXggPSAwIDsgaW5kZXggPCBsZW5ndGggOyBpbmRleCsrICkgewoJCQlwcm9wID0gaGFuZGxlZFsgaW5kZXggXTsKCQkJdHdlZW4gPSBhbmltLmNyZWF0ZVR3ZWVuKCBwcm9wLCBoaWRkZW4gPyBkYXRhU2hvd1sgcHJvcCBdIDogMCApOwoJCQlvcmlnWyBwcm9wIF0gPSBkYXRhU2hvd1sgcHJvcCBdIHx8IGpRdWVyeS5zdHlsZSggZWxlbSwgcHJvcCApOwoKCQkJaWYgKCAhKCBwcm9wIGluIGRhdGFTaG93ICkgKSB7CgkJCQlkYXRhU2hvd1sgcHJvcCBdID0gdHdlZW4uc3RhcnQ7CgkJCQlpZiAoIGhpZGRlbiApIHsKCQkJCQl0d2Vlbi5lbmQgPSB0d2Vlbi5zdGFydDsKCQkJCQl0d2Vlbi5zdGFydCA9IHByb3AgPT09ICJ3aWR0aCIgfHwgcHJvcCA9PT0gImhlaWdodCIgPyAxIDogMDsKCQkJCX0KCQkJfQoJCX0KCX0KfQoKZnVuY3Rpb24gVHdlZW4oIGVsZW0sIG9wdGlvbnMsIHByb3AsIGVuZCwgZWFzaW5nICkgewoJcmV0dXJuIG5ldyBUd2Vlbi5wcm90b3R5cGUuaW5pdCggZWxlbSwgb3B0aW9ucywgcHJvcCwgZW5kLCBlYXNpbmcgKTsKfQpqUXVlcnkuVHdlZW4gPSBUd2VlbjsKClR3ZWVuLnByb3RvdHlwZSA9IHsKCWNvbnN0cnVjdG9yOiBUd2VlbiwKCWluaXQ6IGZ1bmN0aW9uKCBlbGVtLCBvcHRpb25zLCBwcm9wLCBlbmQsIGVhc2luZywgdW5pdCApIHsKCQl0aGlzLmVsZW0gPSBlbGVtOwoJCXRoaXMucHJvcCA9IHByb3A7CgkJdGhpcy5lYXNpbmcgPSBlYXNpbmcgfHwgInN3aW5nIjsKCQl0aGlzLm9wdGlvbnMgPSBvcHRpb25zOwoJCXRoaXMuc3RhcnQgPSB0aGlzLm5vdyA9IHRoaXMuY3VyKCk7CgkJdGhpcy5lbmQgPSBlbmQ7CgkJdGhpcy51bml0ID0gdW5pdCB8fCAoIGpRdWVyeS5jc3NOdW1iZXJbIHByb3AgXSA/ICIiIDogInB4IiApOwoJfSwKCWN1cjogZnVuY3Rpb24oKSB7CgkJdmFyIGhvb2tzID0gVHdlZW4ucHJvcEhvb2tzWyB0aGlzLnByb3AgXTsKCgkJcmV0dXJuIGhvb2tzICYmIGhvb2tzLmdldCA/CgkJCWhvb2tzLmdldCggdGhpcyApIDoKCQkJVHdlZW4ucHJvcEhvb2tzLl9kZWZhdWx0LmdldCggdGhpcyApOwoJfSwKCXJ1bjogZnVuY3Rpb24oIHBlcmNlbnQgKSB7CgkJdmFyIGVhc2VkLAoJCQlob29rcyA9IFR3ZWVuLnByb3BIb29rc1sgdGhpcy5wcm9wIF07CgoJCWlmICggdGhpcy5vcHRpb25zLmR1cmF0aW9uICkgewoJCQl0aGlzLnBvcyA9IGVhc2VkID0galF1ZXJ5LmVhc2luZ1sgdGhpcy5lYXNpbmcgXSgKCQkJCXBlcmNlbnQsIHRoaXMub3B0aW9ucy5kdXJhdGlvbiAqIHBlcmNlbnQsIDAsIDEsIHRoaXMub3B0aW9ucy5kdXJhdGlvbgoJCQkpOwoJCX0gZWxzZSB7CgkJCXRoaXMucG9zID0gZWFzZWQgPSBwZXJjZW50OwoJCX0KCQl0aGlzLm5vdyA9ICggdGhpcy5lbmQgLSB0aGlzLnN0YXJ0ICkgKiBlYXNlZCArIHRoaXMuc3RhcnQ7CgoJCWlmICggdGhpcy5vcHRpb25zLnN0ZXAgKSB7CgkJCXRoaXMub3B0aW9ucy5zdGVwLmNhbGwoIHRoaXMuZWxlbSwgdGhpcy5ub3csIHRoaXMgKTsKCQl9CgoJCWlmICggaG9va3MgJiYgaG9va3Muc2V0ICkgewoJCQlob29rcy5zZXQoIHRoaXMgKTsKCQl9IGVsc2UgewoJCQlUd2Vlbi5wcm9wSG9va3MuX2RlZmF1bHQuc2V0KCB0aGlzICk7CgkJfQoJCXJldHVybiB0aGlzOwoJfQp9OwoKVHdlZW4ucHJvdG90eXBlLmluaXQucHJvdG90eXBlID0gVHdlZW4ucHJvdG90eXBlOwoKVHdlZW4ucHJvcEhvb2tzID0gewoJX2RlZmF1bHQ6IHsKCQlnZXQ6IGZ1bmN0aW9uKCB0d2VlbiApIHsKCQkJdmFyIHJlc3VsdDsKCgkJCWlmICggdHdlZW4uZWxlbVsgdHdlZW4ucHJvcCBdICE9IG51bGwgJiYKCQkJCSghdHdlZW4uZWxlbS5zdHlsZSB8fCB0d2Vlbi5lbGVtLnN0eWxlWyB0d2Vlbi5wcm9wIF0gPT0gbnVsbCkgKSB7CgkJCQlyZXR1cm4gdHdlZW4uZWxlbVsgdHdlZW4ucHJvcCBdOwoJCQl9CgoJCQkvLyBwYXNzaW5nIGFuIGVtcHR5IHN0cmluZyBhcyBhIDNyZCBwYXJhbWV0ZXIgdG8gLmNzcyB3aWxsIGF1dG9tYXRpY2FsbHkKCQkJLy8gYXR0ZW1wdCBhIHBhcnNlRmxvYXQgYW5kIGZhbGxiYWNrIHRvIGEgc3RyaW5nIGlmIHRoZSBwYXJzZSBmYWlscwoJCQkvLyBzbywgc2ltcGxlIHZhbHVlcyBzdWNoIGFzICIxMHB4IiBhcmUgcGFyc2VkIHRvIEZsb2F0LgoJCQkvLyBjb21wbGV4IHZhbHVlcyBzdWNoIGFzICJyb3RhdGUoMXJhZCkiIGFyZSByZXR1cm5lZCBhcyBpcy4KCQkJcmVzdWx0ID0galF1ZXJ5LmNzcyggdHdlZW4uZWxlbSwgdHdlZW4ucHJvcCwgIiIgKTsKCQkJLy8gRW1wdHkgc3RyaW5ncywgbnVsbCwgdW5kZWZpbmVkIGFuZCAiYXV0byIgYXJlIGNvbnZlcnRlZCB0byAwLgoJCQlyZXR1cm4gIXJlc3VsdCB8fCByZXN1bHQgPT09ICJhdXRvIiA/IDAgOiByZXN1bHQ7CgkJfSwKCQlzZXQ6IGZ1bmN0aW9uKCB0d2VlbiApIHsKCQkJLy8gdXNlIHN0ZXAgaG9vayBmb3IgYmFjayBjb21wYXQgLSB1c2UgY3NzSG9vayBpZiBpdHMgdGhlcmUgLSB1c2UgLnN0eWxlIGlmIGl0cwoJCQkvLyBhdmFpbGFibGUgYW5kIHVzZSBwbGFpbiBwcm9wZXJ0aWVzIHdoZXJlIGF2YWlsYWJsZQoJCQlpZiAoIGpRdWVyeS5meC5zdGVwWyB0d2Vlbi5wcm9wIF0gKSB7CgkJCQlqUXVlcnkuZnguc3RlcFsgdHdlZW4ucHJvcCBdKCB0d2VlbiApOwoJCQl9IGVsc2UgaWYgKCB0d2Vlbi5lbGVtLnN0eWxlICYmICggdHdlZW4uZWxlbS5zdHlsZVsgalF1ZXJ5LmNzc1Byb3BzWyB0d2Vlbi5wcm9wIF0gXSAhPSBudWxsIHx8IGpRdWVyeS5jc3NIb29rc1sgdHdlZW4ucHJvcCBdICkgKSB7CgkJCQlqUXVlcnkuc3R5bGUoIHR3ZWVuLmVsZW0sIHR3ZWVuLnByb3AsIHR3ZWVuLm5vdyArIHR3ZWVuLnVuaXQgKTsKCQkJfSBlbHNlIHsKCQkJCXR3ZWVuLmVsZW1bIHR3ZWVuLnByb3AgXSA9IHR3ZWVuLm5vdzsKCQkJfQoJCX0KCX0KfTsKCi8vIFJlbW92ZSBpbiAyLjAgLSB0aGlzIHN1cHBvcnRzIElFOCdzIHBhbmljIGJhc2VkIGFwcHJvYWNoCi8vIHRvIHNldHRpbmcgdGhpbmdzIG9uIGRpc2Nvbm5lY3RlZCBub2RlcwoKVHdlZW4ucHJvcEhvb2tzLnNjcm9sbFRvcCA9IFR3ZWVuLnByb3BIb29rcy5zY3JvbGxMZWZ0ID0gewoJc2V0OiBmdW5jdGlvbiggdHdlZW4gKSB7CgkJaWYgKCB0d2Vlbi5lbGVtLm5vZGVUeXBlICYmIHR3ZWVuLmVsZW0ucGFyZW50Tm9kZSApIHsKCQkJdHdlZW4uZWxlbVsgdHdlZW4ucHJvcCBdID0gdHdlZW4ubm93OwoJCX0KCX0KfTsKCmpRdWVyeS5lYWNoKFsgInRvZ2dsZSIsICJzaG93IiwgImhpZGUiIF0sIGZ1bmN0aW9uKCBpLCBuYW1lICkgewoJdmFyIGNzc0ZuID0galF1ZXJ5LmZuWyBuYW1lIF07CglqUXVlcnkuZm5bIG5hbWUgXSA9IGZ1bmN0aW9uKCBzcGVlZCwgZWFzaW5nLCBjYWxsYmFjayApIHsKCQlyZXR1cm4gc3BlZWQgPT0gbnVsbCB8fCB0eXBlb2Ygc3BlZWQgPT09ICJib29sZWFuIiA/CgkJCWNzc0ZuLmFwcGx5KCB0aGlzLCBhcmd1bWVudHMgKSA6CgkJCXRoaXMuYW5pbWF0ZSggZ2VuRngoIG5hbWUsIHRydWUgKSwgc3BlZWQsIGVhc2luZywgY2FsbGJhY2sgKTsKCX07Cn0pOwoKalF1ZXJ5LmZuLmV4dGVuZCh7CglmYWRlVG86IGZ1bmN0aW9uKCBzcGVlZCwgdG8sIGVhc2luZywgY2FsbGJhY2sgKSB7CgoJCS8vIHNob3cgYW55IGhpZGRlbiBlbGVtZW50cyBhZnRlciBzZXR0aW5nIG9wYWNpdHkgdG8gMAoJCXJldHVybiB0aGlzLmZpbHRlciggaXNIaWRkZW4gKS5jc3MoICJvcGFjaXR5IiwgMCApLnNob3coKQoKCQkJLy8gYW5pbWF0ZSB0byB0aGUgdmFsdWUgc3BlY2lmaWVkCgkJCS5lbmQoKS5hbmltYXRlKHsgb3BhY2l0eTogdG8gfSwgc3BlZWQsIGVhc2luZywgY2FsbGJhY2sgKTsKCX0sCglhbmltYXRlOiBmdW5jdGlvbiggcHJvcCwgc3BlZWQsIGVhc2luZywgY2FsbGJhY2sgKSB7CgkJdmFyIGVtcHR5ID0galF1ZXJ5LmlzRW1wdHlPYmplY3QoIHByb3AgKSwKCQkJb3B0YWxsID0galF1ZXJ5LnNwZWVkKCBzcGVlZCwgZWFzaW5nLCBjYWxsYmFjayApLAoJCQlkb0FuaW1hdGlvbiA9IGZ1bmN0aW9uKCkgewoJCQkJLy8gT3BlcmF0ZSBvbiBhIGNvcHkgb2YgcHJvcCBzbyBwZXItcHJvcGVydHkgZWFzaW5nIHdvbid0IGJlIGxvc3QKCQkJCXZhciBhbmltID0gQW5pbWF0aW9uKCB0aGlzLCBqUXVlcnkuZXh0ZW5kKCB7fSwgcHJvcCApLCBvcHRhbGwgKTsKCQkJCWRvQW5pbWF0aW9uLmZpbmlzaCA9IGZ1bmN0aW9uKCkgewoJCQkJCWFuaW0uc3RvcCggdHJ1ZSApOwoJCQkJfTsKCQkJCS8vIEVtcHR5IGFuaW1hdGlvbnMsIG9yIGZpbmlzaGluZyByZXNvbHZlcyBpbW1lZGlhdGVseQoJCQkJaWYgKCBlbXB0eSB8fCBqUXVlcnkuX2RhdGEoIHRoaXMsICJmaW5pc2giICkgKSB7CgkJCQkJYW5pbS5zdG9wKCB0cnVlICk7CgkJCQl9CgkJCX07CgkJCWRvQW5pbWF0aW9uLmZpbmlzaCA9IGRvQW5pbWF0aW9uOwoKCQlyZXR1cm4gZW1wdHkgfHwgb3B0YWxsLnF1ZXVlID09PSBmYWxzZSA/CgkJCXRoaXMuZWFjaCggZG9BbmltYXRpb24gKSA6CgkJCXRoaXMucXVldWUoIG9wdGFsbC5xdWV1ZSwgZG9BbmltYXRpb24gKTsKCX0sCglzdG9wOiBmdW5jdGlvbiggdHlwZSwgY2xlYXJRdWV1ZSwgZ290b0VuZCApIHsKCQl2YXIgc3RvcFF1ZXVlID0gZnVuY3Rpb24oIGhvb2tzICkgewoJCQl2YXIgc3RvcCA9IGhvb2tzLnN0b3A7CgkJCWRlbGV0ZSBob29rcy5zdG9wOwoJCQlzdG9wKCBnb3RvRW5kICk7CgkJfTsKCgkJaWYgKCB0eXBlb2YgdHlwZSAhPT0gInN0cmluZyIgKSB7CgkJCWdvdG9FbmQgPSBjbGVhclF1ZXVlOwoJCQljbGVhclF1ZXVlID0gdHlwZTsKCQkJdHlwZSA9IHVuZGVmaW5lZDsKCQl9CgkJaWYgKCBjbGVhclF1ZXVlICYmIHR5cGUgIT09IGZhbHNlICkgewoJCQl0aGlzLnF1ZXVlKCB0eXBlIHx8ICJmeCIsIFtdICk7CgkJfQoKCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCQl2YXIgZGVxdWV1ZSA9IHRydWUsCgkJCQlpbmRleCA9IHR5cGUgIT0gbnVsbCAmJiB0eXBlICsgInF1ZXVlSG9va3MiLAoJCQkJdGltZXJzID0galF1ZXJ5LnRpbWVycywKCQkJCWRhdGEgPSBqUXVlcnkuX2RhdGEoIHRoaXMgKTsKCgkJCWlmICggaW5kZXggKSB7CgkJCQlpZiAoIGRhdGFbIGluZGV4IF0gJiYgZGF0YVsgaW5kZXggXS5zdG9wICkgewoJCQkJCXN0b3BRdWV1ZSggZGF0YVsgaW5kZXggXSApOwoJCQkJfQoJCQl9IGVsc2UgewoJCQkJZm9yICggaW5kZXggaW4gZGF0YSApIHsKCQkJCQlpZiAoIGRhdGFbIGluZGV4IF0gJiYgZGF0YVsgaW5kZXggXS5zdG9wICYmIHJydW4udGVzdCggaW5kZXggKSApIHsKCQkJCQkJc3RvcFF1ZXVlKCBkYXRhWyBpbmRleCBdICk7CgkJCQkJfQoJCQkJfQoJCQl9CgoJCQlmb3IgKCBpbmRleCA9IHRpbWVycy5sZW5ndGg7IGluZGV4LS07ICkgewoJCQkJaWYgKCB0aW1lcnNbIGluZGV4IF0uZWxlbSA9PT0gdGhpcyAmJiAodHlwZSA9PSBudWxsIHx8IHRpbWVyc1sgaW5kZXggXS5xdWV1ZSA9PT0gdHlwZSkgKSB7CgkJCQkJdGltZXJzWyBpbmRleCBdLmFuaW0uc3RvcCggZ290b0VuZCApOwoJCQkJCWRlcXVldWUgPSBmYWxzZTsKCQkJCQl0aW1lcnMuc3BsaWNlKCBpbmRleCwgMSApOwoJCQkJfQoJCQl9CgoJCQkvLyBzdGFydCB0aGUgbmV4dCBpbiB0aGUgcXVldWUgaWYgdGhlIGxhc3Qgc3RlcCB3YXNuJ3QgZm9yY2VkCgkJCS8vIHRpbWVycyBjdXJyZW50bHkgd2lsbCBjYWxsIHRoZWlyIGNvbXBsZXRlIGNhbGxiYWNrcywgd2hpY2ggd2lsbCBkZXF1ZXVlCgkJCS8vIGJ1dCBvbmx5IGlmIHRoZXkgd2VyZSBnb3RvRW5kCgkJCWlmICggZGVxdWV1ZSB8fCAhZ290b0VuZCApIHsKCQkJCWpRdWVyeS5kZXF1ZXVlKCB0aGlzLCB0eXBlICk7CgkJCX0KCQl9KTsKCX0sCglmaW5pc2g6IGZ1bmN0aW9uKCB0eXBlICkgewoJCWlmICggdHlwZSAhPT0gZmFsc2UgKSB7CgkJCXR5cGUgPSB0eXBlIHx8ICJmeCI7CgkJfQoJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CgkJCXZhciBpbmRleCwKCQkJCWRhdGEgPSBqUXVlcnkuX2RhdGEoIHRoaXMgKSwKCQkJCXF1ZXVlID0gZGF0YVsgdHlwZSArICJxdWV1ZSIgXSwKCQkJCWhvb2tzID0gZGF0YVsgdHlwZSArICJxdWV1ZUhvb2tzIiBdLAoJCQkJdGltZXJzID0galF1ZXJ5LnRpbWVycywKCQkJCWxlbmd0aCA9IHF1ZXVlID8gcXVldWUubGVuZ3RoIDogMDsKCgkJCS8vIGVuYWJsZSBmaW5pc2hpbmcgZmxhZyBvbiBwcml2YXRlIGRhdGEKCQkJZGF0YS5maW5pc2ggPSB0cnVlOwoKCQkJLy8gZW1wdHkgdGhlIHF1ZXVlIGZpcnN0CgkJCWpRdWVyeS5xdWV1ZSggdGhpcywgdHlwZSwgW10gKTsKCgkJCWlmICggaG9va3MgJiYgaG9va3MuY3VyICYmIGhvb2tzLmN1ci5maW5pc2ggKSB7CgkJCQlob29rcy5jdXIuZmluaXNoLmNhbGwoIHRoaXMgKTsKCQkJfQoKCQkJLy8gbG9vayBmb3IgYW55IGFjdGl2ZSBhbmltYXRpb25zLCBhbmQgZmluaXNoIHRoZW0KCQkJZm9yICggaW5kZXggPSB0aW1lcnMubGVuZ3RoOyBpbmRleC0tOyApIHsKCQkJCWlmICggdGltZXJzWyBpbmRleCBdLmVsZW0gPT09IHRoaXMgJiYgdGltZXJzWyBpbmRleCBdLnF1ZXVlID09PSB0eXBlICkgewoJCQkJCXRpbWVyc1sgaW5kZXggXS5hbmltLnN0b3AoIHRydWUgKTsKCQkJCQl0aW1lcnMuc3BsaWNlKCBpbmRleCwgMSApOwoJCQkJfQoJCQl9CgoJCQkvLyBsb29rIGZvciBhbnkgYW5pbWF0aW9ucyBpbiB0aGUgb2xkIHF1ZXVlIGFuZCBmaW5pc2ggdGhlbQoJCQlmb3IgKCBpbmRleCA9IDA7IGluZGV4IDwgbGVuZ3RoOyBpbmRleCsrICkgewoJCQkJaWYgKCBxdWV1ZVsgaW5kZXggXSAmJiBxdWV1ZVsgaW5kZXggXS5maW5pc2ggKSB7CgkJCQkJcXVldWVbIGluZGV4IF0uZmluaXNoLmNhbGwoIHRoaXMgKTsKCQkJCX0KCQkJfQoKCQkJLy8gdHVybiBvZmYgZmluaXNoaW5nIGZsYWcKCQkJZGVsZXRlIGRhdGEuZmluaXNoOwoJCX0pOwoJfQp9KTsKCi8vIEdlbmVyYXRlIHBhcmFtZXRlcnMgdG8gY3JlYXRlIGEgc3RhbmRhcmQgYW5pbWF0aW9uCmZ1bmN0aW9uIGdlbkZ4KCB0eXBlLCBpbmNsdWRlV2lkdGggKSB7Cgl2YXIgd2hpY2gsCgkJYXR0cnMgPSB7IGhlaWdodDogdHlwZSB9LAoJCWkgPSAwOwoKCS8vIGlmIHdlIGluY2x1ZGUgd2lkdGgsIHN0ZXAgdmFsdWUgaXMgMSB0byBkbyBhbGwgY3NzRXhwYW5kIHZhbHVlcywKCS8vIGlmIHdlIGRvbid0IGluY2x1ZGUgd2lkdGgsIHN0ZXAgdmFsdWUgaXMgMiB0byBza2lwIG92ZXIgTGVmdCBhbmQgUmlnaHQKCWluY2x1ZGVXaWR0aCA9IGluY2x1ZGVXaWR0aD8gMSA6IDA7Cglmb3IoIDsgaSA8IDQgOyBpICs9IDIgLSBpbmNsdWRlV2lkdGggKSB7CgkJd2hpY2ggPSBjc3NFeHBhbmRbIGkgXTsKCQlhdHRyc1sgIm1hcmdpbiIgKyB3aGljaCBdID0gYXR0cnNbICJwYWRkaW5nIiArIHdoaWNoIF0gPSB0eXBlOwoJfQoKCWlmICggaW5jbHVkZVdpZHRoICkgewoJCWF0dHJzLm9wYWNpdHkgPSBhdHRycy53aWR0aCA9IHR5cGU7Cgl9CgoJcmV0dXJuIGF0dHJzOwp9CgovLyBHZW5lcmF0ZSBzaG9ydGN1dHMgZm9yIGN1c3RvbSBhbmltYXRpb25zCmpRdWVyeS5lYWNoKHsKCXNsaWRlRG93bjogZ2VuRngoInNob3ciKSwKCXNsaWRlVXA6IGdlbkZ4KCJoaWRlIiksCglzbGlkZVRvZ2dsZTogZ2VuRngoInRvZ2dsZSIpLAoJZmFkZUluOiB7IG9wYWNpdHk6ICJzaG93IiB9LAoJZmFkZU91dDogeyBvcGFjaXR5OiAiaGlkZSIgfSwKCWZhZGVUb2dnbGU6IHsgb3BhY2l0eTogInRvZ2dsZSIgfQp9LCBmdW5jdGlvbiggbmFtZSwgcHJvcHMgKSB7CglqUXVlcnkuZm5bIG5hbWUgXSA9IGZ1bmN0aW9uKCBzcGVlZCwgZWFzaW5nLCBjYWxsYmFjayApIHsKCQlyZXR1cm4gdGhpcy5hbmltYXRlKCBwcm9wcywgc3BlZWQsIGVhc2luZywgY2FsbGJhY2sgKTsKCX07Cn0pOwoKalF1ZXJ5LnNwZWVkID0gZnVuY3Rpb24oIHNwZWVkLCBlYXNpbmcsIGZuICkgewoJdmFyIG9wdCA9IHNwZWVkICYmIHR5cGVvZiBzcGVlZCA9PT0gIm9iamVjdCIgPyBqUXVlcnkuZXh0ZW5kKCB7fSwgc3BlZWQgKSA6IHsKCQljb21wbGV0ZTogZm4gfHwgIWZuICYmIGVhc2luZyB8fAoJCQlqUXVlcnkuaXNGdW5jdGlvbiggc3BlZWQgKSAmJiBzcGVlZCwKCQlkdXJhdGlvbjogc3BlZWQsCgkJZWFzaW5nOiBmbiAmJiBlYXNpbmcgfHwgZWFzaW5nICYmICFqUXVlcnkuaXNGdW5jdGlvbiggZWFzaW5nICkgJiYgZWFzaW5nCgl9OwoKCW9wdC5kdXJhdGlvbiA9IGpRdWVyeS5meC5vZmYgPyAwIDogdHlwZW9mIG9wdC5kdXJhdGlvbiA9PT0gIm51bWJlciIgPyBvcHQuZHVyYXRpb24gOgoJCW9wdC5kdXJhdGlvbiBpbiBqUXVlcnkuZnguc3BlZWRzID8galF1ZXJ5LmZ4LnNwZWVkc1sgb3B0LmR1cmF0aW9uIF0gOiBqUXVlcnkuZnguc3BlZWRzLl9kZWZhdWx0OwoKCS8vIG5vcm1hbGl6ZSBvcHQucXVldWUgLSB0cnVlL3VuZGVmaW5lZC9udWxsIC0+ICJmeCIKCWlmICggb3B0LnF1ZXVlID09IG51bGwgfHwgb3B0LnF1ZXVlID09PSB0cnVlICkgewoJCW9wdC5xdWV1ZSA9ICJmeCI7Cgl9CgoJLy8gUXVldWVpbmcKCW9wdC5vbGQgPSBvcHQuY29tcGxldGU7CgoJb3B0LmNvbXBsZXRlID0gZnVuY3Rpb24oKSB7CgkJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggb3B0Lm9sZCApICkgewoJCQlvcHQub2xkLmNhbGwoIHRoaXMgKTsKCQl9CgoJCWlmICggb3B0LnF1ZXVlICkgewoJCQlqUXVlcnkuZGVxdWV1ZSggdGhpcywgb3B0LnF1ZXVlICk7CgkJfQoJfTsKCglyZXR1cm4gb3B0Owp9OwoKalF1ZXJ5LmVhc2luZyA9IHsKCWxpbmVhcjogZnVuY3Rpb24oIHAgKSB7CgkJcmV0dXJuIHA7Cgl9LAoJc3dpbmc6IGZ1bmN0aW9uKCBwICkgewoJCXJldHVybiAwLjUgLSBNYXRoLmNvcyggcCpNYXRoLlBJICkgLyAyOwoJfQp9OwoKalF1ZXJ5LnRpbWVycyA9IFtdOwpqUXVlcnkuZnggPSBUd2Vlbi5wcm90b3R5cGUuaW5pdDsKalF1ZXJ5LmZ4LnRpY2sgPSBmdW5jdGlvbigpIHsKCXZhciB0aW1lciwKCQl0aW1lcnMgPSBqUXVlcnkudGltZXJzLAoJCWkgPSAwOwoKCWZ4Tm93ID0galF1ZXJ5Lm5vdygpOwoKCWZvciAoIDsgaSA8IHRpbWVycy5sZW5ndGg7IGkrKyApIHsKCQl0aW1lciA9IHRpbWVyc1sgaSBdOwoJCS8vIENoZWNrcyB0aGUgdGltZXIgaGFzIG5vdCBhbHJlYWR5IGJlZW4gcmVtb3ZlZAoJCWlmICggIXRpbWVyKCkgJiYgdGltZXJzWyBpIF0gPT09IHRpbWVyICkgewoJCQl0aW1lcnMuc3BsaWNlKCBpLS0sIDEgKTsKCQl9Cgl9CgoJaWYgKCAhdGltZXJzLmxlbmd0aCApIHsKCQlqUXVlcnkuZnguc3RvcCgpOwoJfQoJZnhOb3cgPSB1bmRlZmluZWQ7Cn07CgpqUXVlcnkuZngudGltZXIgPSBmdW5jdGlvbiggdGltZXIgKSB7CglpZiAoIHRpbWVyKCkgJiYgalF1ZXJ5LnRpbWVycy5wdXNoKCB0aW1lciApICkgewoJCWpRdWVyeS5meC5zdGFydCgpOwoJfQp9OwoKalF1ZXJ5LmZ4LmludGVydmFsID0gMTM7CgpqUXVlcnkuZnguc3RhcnQgPSBmdW5jdGlvbigpIHsKCWlmICggIXRpbWVySWQgKSB7CgkJdGltZXJJZCA9IHNldEludGVydmFsKCBqUXVlcnkuZngudGljaywgalF1ZXJ5LmZ4LmludGVydmFsICk7Cgl9Cn07CgpqUXVlcnkuZnguc3RvcCA9IGZ1bmN0aW9uKCkgewoJY2xlYXJJbnRlcnZhbCggdGltZXJJZCApOwoJdGltZXJJZCA9IG51bGw7Cn07CgpqUXVlcnkuZnguc3BlZWRzID0gewoJc2xvdzogNjAwLAoJZmFzdDogMjAwLAoJLy8gRGVmYXVsdCBzcGVlZAoJX2RlZmF1bHQ6IDQwMAp9OwoKLy8gQmFjayBDb21wYXQgPDEuOCBleHRlbnNpb24gcG9pbnQKalF1ZXJ5LmZ4LnN0ZXAgPSB7fTsKCmlmICggalF1ZXJ5LmV4cHIgJiYgalF1ZXJ5LmV4cHIuZmlsdGVycyApIHsKCWpRdWVyeS5leHByLmZpbHRlcnMuYW5pbWF0ZWQgPSBmdW5jdGlvbiggZWxlbSApIHsKCQlyZXR1cm4galF1ZXJ5LmdyZXAoalF1ZXJ5LnRpbWVycywgZnVuY3Rpb24oIGZuICkgewoJCQlyZXR1cm4gZWxlbSA9PT0gZm4uZWxlbTsKCQl9KS5sZW5ndGg7Cgl9Owp9CmpRdWVyeS5mbi5vZmZzZXQgPSBmdW5jdGlvbiggb3B0aW9ucyApIHsKCWlmICggYXJndW1lbnRzLmxlbmd0aCApIHsKCQlyZXR1cm4gb3B0aW9ucyA9PT0gdW5kZWZpbmVkID8KCQkJdGhpcyA6CgkJCXRoaXMuZWFjaChmdW5jdGlvbiggaSApIHsKCQkJCWpRdWVyeS5vZmZzZXQuc2V0T2Zmc2V0KCB0aGlzLCBvcHRpb25zLCBpICk7CgkJCX0pOwoJfQoKCXZhciBkb2NFbGVtLCB3aW4sCgkJYm94ID0geyB0b3A6IDAsIGxlZnQ6IDAgfSwKCQllbGVtID0gdGhpc1sgMCBdLAoJCWRvYyA9IGVsZW0gJiYgZWxlbS5vd25lckRvY3VtZW50OwoKCWlmICggIWRvYyApIHsKCQlyZXR1cm47Cgl9CgoJZG9jRWxlbSA9IGRvYy5kb2N1bWVudEVsZW1lbnQ7CgoJLy8gTWFrZSBzdXJlIGl0J3Mgbm90IGEgZGlzY29ubmVjdGVkIERPTSBub2RlCglpZiAoICFqUXVlcnkuY29udGFpbnMoIGRvY0VsZW0sIGVsZW0gKSApIHsKCQlyZXR1cm4gYm94OwoJfQoKCS8vIElmIHdlIGRvbid0IGhhdmUgZ0JDUiwganVzdCB1c2UgMCwwIHJhdGhlciB0aGFuIGVycm9yCgkvLyBCbGFja0JlcnJ5IDUsIGlPUyAzIChvcmlnaW5hbCBpUGhvbmUpCglpZiAoIHR5cGVvZiBlbGVtLmdldEJvdW5kaW5nQ2xpZW50UmVjdCAhPT0gY29yZV9zdHJ1bmRlZmluZWQgKSB7CgkJYm94ID0gZWxlbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKCX0KCXdpbiA9IGdldFdpbmRvdyggZG9jICk7CglyZXR1cm4gewoJCXRvcDogYm94LnRvcCAgKyAoIHdpbi5wYWdlWU9mZnNldCB8fCBkb2NFbGVtLnNjcm9sbFRvcCApICAtICggZG9jRWxlbS5jbGllbnRUb3AgIHx8IDAgKSwKCQlsZWZ0OiBib3gubGVmdCArICggd2luLnBhZ2VYT2Zmc2V0IHx8IGRvY0VsZW0uc2Nyb2xsTGVmdCApIC0gKCBkb2NFbGVtLmNsaWVudExlZnQgfHwgMCApCgl9Owp9OwoKalF1ZXJ5Lm9mZnNldCA9IHsKCglzZXRPZmZzZXQ6IGZ1bmN0aW9uKCBlbGVtLCBvcHRpb25zLCBpICkgewoJCXZhciBwb3NpdGlvbiA9IGpRdWVyeS5jc3MoIGVsZW0sICJwb3NpdGlvbiIgKTsKCgkJLy8gc2V0IHBvc2l0aW9uIGZpcnN0LCBpbi1jYXNlIHRvcC9sZWZ0IGFyZSBzZXQgZXZlbiBvbiBzdGF0aWMgZWxlbQoJCWlmICggcG9zaXRpb24gPT09ICJzdGF0aWMiICkgewoJCQllbGVtLnN0eWxlLnBvc2l0aW9uID0gInJlbGF0aXZlIjsKCQl9CgoJCXZhciBjdXJFbGVtID0galF1ZXJ5KCBlbGVtICksCgkJCWN1ck9mZnNldCA9IGN1ckVsZW0ub2Zmc2V0KCksCgkJCWN1ckNTU1RvcCA9IGpRdWVyeS5jc3MoIGVsZW0sICJ0b3AiICksCgkJCWN1ckNTU0xlZnQgPSBqUXVlcnkuY3NzKCBlbGVtLCAibGVmdCIgKSwKCQkJY2FsY3VsYXRlUG9zaXRpb24gPSAoIHBvc2l0aW9uID09PSAiYWJzb2x1dGUiIHx8IHBvc2l0aW9uID09PSAiZml4ZWQiICkgJiYgalF1ZXJ5LmluQXJyYXkoImF1dG8iLCBbY3VyQ1NTVG9wLCBjdXJDU1NMZWZ0XSkgPiAtMSwKCQkJcHJvcHMgPSB7fSwgY3VyUG9zaXRpb24gPSB7fSwgY3VyVG9wLCBjdXJMZWZ0OwoKCQkvLyBuZWVkIHRvIGJlIGFibGUgdG8gY2FsY3VsYXRlIHBvc2l0aW9uIGlmIGVpdGhlciB0b3Agb3IgbGVmdCBpcyBhdXRvIGFuZCBwb3NpdGlvbiBpcyBlaXRoZXIgYWJzb2x1dGUgb3IgZml4ZWQKCQlpZiAoIGNhbGN1bGF0ZVBvc2l0aW9uICkgewoJCQljdXJQb3NpdGlvbiA9IGN1ckVsZW0ucG9zaXRpb24oKTsKCQkJY3VyVG9wID0gY3VyUG9zaXRpb24udG9wOwoJCQljdXJMZWZ0ID0gY3VyUG9zaXRpb24ubGVmdDsKCQl9IGVsc2UgewoJCQljdXJUb3AgPSBwYXJzZUZsb2F0KCBjdXJDU1NUb3AgKSB8fCAwOwoJCQljdXJMZWZ0ID0gcGFyc2VGbG9hdCggY3VyQ1NTTGVmdCApIHx8IDA7CgkJfQoKCQlpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCBvcHRpb25zICkgKSB7CgkJCW9wdGlvbnMgPSBvcHRpb25zLmNhbGwoIGVsZW0sIGksIGN1ck9mZnNldCApOwoJCX0KCgkJaWYgKCBvcHRpb25zLnRvcCAhPSBudWxsICkgewoJCQlwcm9wcy50b3AgPSAoIG9wdGlvbnMudG9wIC0gY3VyT2Zmc2V0LnRvcCApICsgY3VyVG9wOwoJCX0KCQlpZiAoIG9wdGlvbnMubGVmdCAhPSBudWxsICkgewoJCQlwcm9wcy5sZWZ0ID0gKCBvcHRpb25zLmxlZnQgLSBjdXJPZmZzZXQubGVmdCApICsgY3VyTGVmdDsKCQl9CgoJCWlmICggInVzaW5nIiBpbiBvcHRpb25zICkgewoJCQlvcHRpb25zLnVzaW5nLmNhbGwoIGVsZW0sIHByb3BzICk7CgkJfSBlbHNlIHsKCQkJY3VyRWxlbS5jc3MoIHByb3BzICk7CgkJfQoJfQp9OwoKCmpRdWVyeS5mbi5leHRlbmQoewoKCXBvc2l0aW9uOiBmdW5jdGlvbigpIHsKCQlpZiAoICF0aGlzWyAwIF0gKSB7CgkJCXJldHVybjsKCQl9CgoJCXZhciBvZmZzZXRQYXJlbnQsIG9mZnNldCwKCQkJcGFyZW50T2Zmc2V0ID0geyB0b3A6IDAsIGxlZnQ6IDAgfSwKCQkJZWxlbSA9IHRoaXNbIDAgXTsKCgkJLy8gZml4ZWQgZWxlbWVudHMgYXJlIG9mZnNldCBmcm9tIHdpbmRvdyAocGFyZW50T2Zmc2V0ID0ge3RvcDowLCBsZWZ0OiAwfSwgYmVjYXVzZSBpdCBpcyBpdCdzIG9ubHkgb2Zmc2V0IHBhcmVudAoJCWlmICggalF1ZXJ5LmNzcyggZWxlbSwgInBvc2l0aW9uIiApID09PSAiZml4ZWQiICkgewoJCQkvLyB3ZSBhc3N1bWUgdGhhdCBnZXRCb3VuZGluZ0NsaWVudFJlY3QgaXMgYXZhaWxhYmxlIHdoZW4gY29tcHV0ZWQgcG9zaXRpb24gaXMgZml4ZWQKCQkJb2Zmc2V0ID0gZWxlbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKCQl9IGVsc2UgewoJCQkvLyBHZXQgKnJlYWwqIG9mZnNldFBhcmVudAoJCQlvZmZzZXRQYXJlbnQgPSB0aGlzLm9mZnNldFBhcmVudCgpOwoKCQkJLy8gR2V0IGNvcnJlY3Qgb2Zmc2V0cwoJCQlvZmZzZXQgPSB0aGlzLm9mZnNldCgpOwoJCQlpZiAoICFqUXVlcnkubm9kZU5hbWUoIG9mZnNldFBhcmVudFsgMCBdLCAiaHRtbCIgKSApIHsKCQkJCXBhcmVudE9mZnNldCA9IG9mZnNldFBhcmVudC5vZmZzZXQoKTsKCQkJfQoKCQkJLy8gQWRkIG9mZnNldFBhcmVudCBib3JkZXJzCgkJCXBhcmVudE9mZnNldC50b3AgICs9IGpRdWVyeS5jc3MoIG9mZnNldFBhcmVudFsgMCBdLCAiYm9yZGVyVG9wV2lkdGgiLCB0cnVlICk7CgkJCXBhcmVudE9mZnNldC5sZWZ0ICs9IGpRdWVyeS5jc3MoIG9mZnNldFBhcmVudFsgMCBdLCAiYm9yZGVyTGVmdFdpZHRoIiwgdHJ1ZSApOwoJCX0KCgkJLy8gU3VidHJhY3QgcGFyZW50IG9mZnNldHMgYW5kIGVsZW1lbnQgbWFyZ2lucwoJCS8vIG5vdGU6IHdoZW4gYW4gZWxlbWVudCBoYXMgbWFyZ2luOiBhdXRvIHRoZSBvZmZzZXRMZWZ0IGFuZCBtYXJnaW5MZWZ0CgkJLy8gYXJlIHRoZSBzYW1lIGluIFNhZmFyaSBjYXVzaW5nIG9mZnNldC5sZWZ0IHRvIGluY29ycmVjdGx5IGJlIDAKCQlyZXR1cm4gewoJCQl0b3A6ICBvZmZzZXQudG9wICAtIHBhcmVudE9mZnNldC50b3AgLSBqUXVlcnkuY3NzKCBlbGVtLCAibWFyZ2luVG9wIiwgdHJ1ZSApLAoJCQlsZWZ0OiBvZmZzZXQubGVmdCAtIHBhcmVudE9mZnNldC5sZWZ0IC0galF1ZXJ5LmNzcyggZWxlbSwgIm1hcmdpbkxlZnQiLCB0cnVlKQoJCX07Cgl9LAoKCW9mZnNldFBhcmVudDogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMubWFwKGZ1bmN0aW9uKCkgewoJCQl2YXIgb2Zmc2V0UGFyZW50ID0gdGhpcy5vZmZzZXRQYXJlbnQgfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50OwoJCQl3aGlsZSAoIG9mZnNldFBhcmVudCAmJiAoICFqUXVlcnkubm9kZU5hbWUoIG9mZnNldFBhcmVudCwgImh0bWwiICkgJiYgalF1ZXJ5LmNzcyggb2Zmc2V0UGFyZW50LCAicG9zaXRpb24iKSA9PT0gInN0YXRpYyIgKSApIHsKCQkJCW9mZnNldFBhcmVudCA9IG9mZnNldFBhcmVudC5vZmZzZXRQYXJlbnQ7CgkJCX0KCQkJcmV0dXJuIG9mZnNldFBhcmVudCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7CgkJfSk7Cgl9Cn0pOwoKCi8vIENyZWF0ZSBzY3JvbGxMZWZ0IGFuZCBzY3JvbGxUb3AgbWV0aG9kcwpqUXVlcnkuZWFjaCgge3Njcm9sbExlZnQ6ICJwYWdlWE9mZnNldCIsIHNjcm9sbFRvcDogInBhZ2VZT2Zmc2V0In0sIGZ1bmN0aW9uKCBtZXRob2QsIHByb3AgKSB7Cgl2YXIgdG9wID0gL1kvLnRlc3QoIHByb3AgKTsKCglqUXVlcnkuZm5bIG1ldGhvZCBdID0gZnVuY3Rpb24oIHZhbCApIHsKCQlyZXR1cm4galF1ZXJ5LmFjY2VzcyggdGhpcywgZnVuY3Rpb24oIGVsZW0sIG1ldGhvZCwgdmFsICkgewoJCQl2YXIgd2luID0gZ2V0V2luZG93KCBlbGVtICk7CgoJCQlpZiAoIHZhbCA9PT0gdW5kZWZpbmVkICkgewoJCQkJcmV0dXJuIHdpbiA/IChwcm9wIGluIHdpbikgPyB3aW5bIHByb3AgXSA6CgkJCQkJd2luLmRvY3VtZW50LmRvY3VtZW50RWxlbWVudFsgbWV0aG9kIF0gOgoJCQkJCWVsZW1bIG1ldGhvZCBdOwoJCQl9CgoJCQlpZiAoIHdpbiApIHsKCQkJCXdpbi5zY3JvbGxUbygKCQkJCQkhdG9wID8gdmFsIDogalF1ZXJ5KCB3aW4gKS5zY3JvbGxMZWZ0KCksCgkJCQkJdG9wID8gdmFsIDogalF1ZXJ5KCB3aW4gKS5zY3JvbGxUb3AoKQoJCQkJKTsKCgkJCX0gZWxzZSB7CgkJCQllbGVtWyBtZXRob2QgXSA9IHZhbDsKCQkJfQoJCX0sIG1ldGhvZCwgdmFsLCBhcmd1bWVudHMubGVuZ3RoLCBudWxsICk7Cgl9Owp9KTsKCmZ1bmN0aW9uIGdldFdpbmRvdyggZWxlbSApIHsKCXJldHVybiBqUXVlcnkuaXNXaW5kb3coIGVsZW0gKSA/CgkJZWxlbSA6CgkJZWxlbS5ub2RlVHlwZSA9PT0gOSA/CgkJCWVsZW0uZGVmYXVsdFZpZXcgfHwgZWxlbS5wYXJlbnRXaW5kb3cgOgoJCQlmYWxzZTsKfQovLyBDcmVhdGUgaW5uZXJIZWlnaHQsIGlubmVyV2lkdGgsIGhlaWdodCwgd2lkdGgsIG91dGVySGVpZ2h0IGFuZCBvdXRlcldpZHRoIG1ldGhvZHMKalF1ZXJ5LmVhY2goIHsgSGVpZ2h0OiAiaGVpZ2h0IiwgV2lkdGg6ICJ3aWR0aCIgfSwgZnVuY3Rpb24oIG5hbWUsIHR5cGUgKSB7CglqUXVlcnkuZWFjaCggeyBwYWRkaW5nOiAiaW5uZXIiICsgbmFtZSwgY29udGVudDogdHlwZSwgIiI6ICJvdXRlciIgKyBuYW1lIH0sIGZ1bmN0aW9uKCBkZWZhdWx0RXh0cmEsIGZ1bmNOYW1lICkgewoJCS8vIG1hcmdpbiBpcyBvbmx5IGZvciBvdXRlckhlaWdodCwgb3V0ZXJXaWR0aAoJCWpRdWVyeS5mblsgZnVuY05hbWUgXSA9IGZ1bmN0aW9uKCBtYXJnaW4sIHZhbHVlICkgewoJCQl2YXIgY2hhaW5hYmxlID0gYXJndW1lbnRzLmxlbmd0aCAmJiAoIGRlZmF1bHRFeHRyYSB8fCB0eXBlb2YgbWFyZ2luICE9PSAiYm9vbGVhbiIgKSwKCQkJCWV4dHJhID0gZGVmYXVsdEV4dHJhIHx8ICggbWFyZ2luID09PSB0cnVlIHx8IHZhbHVlID09PSB0cnVlID8gIm1hcmdpbiIgOiAiYm9yZGVyIiApOwoKCQkJcmV0dXJuIGpRdWVyeS5hY2Nlc3MoIHRoaXMsIGZ1bmN0aW9uKCBlbGVtLCB0eXBlLCB2YWx1ZSApIHsKCQkJCXZhciBkb2M7CgoJCQkJaWYgKCBqUXVlcnkuaXNXaW5kb3coIGVsZW0gKSApIHsKCQkJCQkvLyBBcyBvZiA1LzgvMjAxMiB0aGlzIHdpbGwgeWllbGQgaW5jb3JyZWN0IHJlc3VsdHMgZm9yIE1vYmlsZSBTYWZhcmksIGJ1dCB0aGVyZQoJCQkJCS8vIGlzbid0IGEgd2hvbGUgbG90IHdlIGNhbiBkby4gU2VlIHB1bGwgcmVxdWVzdCBhdCB0aGlzIFVSTCBmb3IgZGlzY3Vzc2lvbjoKCQkJCQkvLyBodHRwczovL2dpdGh1Yi5jb20vanF1ZXJ5L2pxdWVyeS9wdWxsLzc2NAoJCQkJCXJldHVybiBlbGVtLmRvY3VtZW50LmRvY3VtZW50RWxlbWVudFsgImNsaWVudCIgKyBuYW1lIF07CgkJCQl9CgoJCQkJLy8gR2V0IGRvY3VtZW50IHdpZHRoIG9yIGhlaWdodAoJCQkJaWYgKCBlbGVtLm5vZGVUeXBlID09PSA5ICkgewoJCQkJCWRvYyA9IGVsZW0uZG9jdW1lbnRFbGVtZW50OwoKCQkJCQkvLyBFaXRoZXIgc2Nyb2xsW1dpZHRoL0hlaWdodF0gb3Igb2Zmc2V0W1dpZHRoL0hlaWdodF0gb3IgY2xpZW50W1dpZHRoL0hlaWdodF0sIHdoaWNoZXZlciBpcyBncmVhdGVzdAoJCQkJCS8vIHVuZm9ydHVuYXRlbHksIHRoaXMgY2F1c2VzIGJ1ZyAjMzgzOCBpbiBJRTYvOCBvbmx5LCBidXQgdGhlcmUgaXMgY3VycmVudGx5IG5vIGdvb2QsIHNtYWxsIHdheSB0byBmaXggaXQuCgkJCQkJcmV0dXJuIE1hdGgubWF4KAoJCQkJCQllbGVtLmJvZHlbICJzY3JvbGwiICsgbmFtZSBdLCBkb2NbICJzY3JvbGwiICsgbmFtZSBdLAoJCQkJCQllbGVtLmJvZHlbICJvZmZzZXQiICsgbmFtZSBdLCBkb2NbICJvZmZzZXQiICsgbmFtZSBdLAoJCQkJCQlkb2NbICJjbGllbnQiICsgbmFtZSBdCgkJCQkJKTsKCQkJCX0KCgkJCQlyZXR1cm4gdmFsdWUgPT09IHVuZGVmaW5lZCA/CgkJCQkJLy8gR2V0IHdpZHRoIG9yIGhlaWdodCBvbiB0aGUgZWxlbWVudCwgcmVxdWVzdGluZyBidXQgbm90IGZvcmNpbmcgcGFyc2VGbG9hdAoJCQkJCWpRdWVyeS5jc3MoIGVsZW0sIHR5cGUsIGV4dHJhICkgOgoKCQkJCQkvLyBTZXQgd2lkdGggb3IgaGVpZ2h0IG9uIHRoZSBlbGVtZW50CgkJCQkJalF1ZXJ5LnN0eWxlKCBlbGVtLCB0eXBlLCB2YWx1ZSwgZXh0cmEgKTsKCQkJfSwgdHlwZSwgY2hhaW5hYmxlID8gbWFyZ2luIDogdW5kZWZpbmVkLCBjaGFpbmFibGUsIG51bGwgKTsKCQl9OwoJfSk7Cn0pOwovLyBMaW1pdCBzY29wZSBwb2xsdXRpb24gZnJvbSBhbnkgZGVwcmVjYXRlZCBBUEkKLy8gKGZ1bmN0aW9uKCkgewoKLy8gfSkoKTsKLy8gRXhwb3NlIGpRdWVyeSB0byB0aGUgZ2xvYmFsIG9iamVjdAp3aW5kb3cualF1ZXJ5ID0gd2luZG93LiQgPSBqUXVlcnk7CgovLyBFeHBvc2UgalF1ZXJ5IGFzIGFuIEFNRCBtb2R1bGUsIGJ1dCBvbmx5IGZvciBBTUQgbG9hZGVycyB0aGF0Ci8vIHVuZGVyc3RhbmQgdGhlIGlzc3VlcyB3aXRoIGxvYWRpbmcgbXVsdGlwbGUgdmVyc2lvbnMgb2YgalF1ZXJ5Ci8vIGluIGEgcGFnZSB0aGF0IGFsbCBtaWdodCBjYWxsIGRlZmluZSgpLiBUaGUgbG9hZGVyIHdpbGwgaW5kaWNhdGUKLy8gdGhleSBoYXZlIHNwZWNpYWwgYWxsb3dhbmNlcyBmb3IgbXVsdGlwbGUgalF1ZXJ5IHZlcnNpb25zIGJ5Ci8vIHNwZWNpZnlpbmcgZGVmaW5lLmFtZC5qUXVlcnkgPSB0cnVlLiBSZWdpc3RlciBhcyBhIG5hbWVkIG1vZHVsZSwKLy8gc2luY2UgalF1ZXJ5IGNhbiBiZSBjb25jYXRlbmF0ZWQgd2l0aCBvdGhlciBmaWxlcyB0aGF0IG1heSB1c2UgZGVmaW5lLAovLyBidXQgbm90IHVzZSBhIHByb3BlciBjb25jYXRlbmF0aW9uIHNjcmlwdCB0aGF0IHVuZGVyc3RhbmRzIGFub255bW91cwovLyBBTUQgbW9kdWxlcy4gQSBuYW1lZCBBTUQgaXMgc2FmZXN0IGFuZCBtb3N0IHJvYnVzdCB3YXkgdG8gcmVnaXN0ZXIuCi8vIExvd2VyY2FzZSBqcXVlcnkgaXMgdXNlZCBiZWNhdXNlIEFNRCBtb2R1bGUgbmFtZXMgYXJlIGRlcml2ZWQgZnJvbQovLyBmaWxlIG5hbWVzLCBhbmQgalF1ZXJ5IGlzIG5vcm1hbGx5IGRlbGl2ZXJlZCBpbiBhIGxvd2VyY2FzZSBmaWxlIG5hbWUuCi8vIERvIHRoaXMgYWZ0ZXIgY3JlYXRpbmcgdGhlIGdsb2JhbCBzbyB0aGF0IGlmIGFuIEFNRCBtb2R1bGUgd2FudHMgdG8gY2FsbAovLyBub0NvbmZsaWN0IHRvIGhpZGUgdGhpcyB2ZXJzaW9uIG9mIGpRdWVyeSwgaXQgd2lsbCB3b3JrLgppZiAoIHR5cGVvZiBkZWZpbmUgPT09ICJmdW5jdGlvbiIgJiYgZGVmaW5lLmFtZCAmJiBkZWZpbmUuYW1kLmpRdWVyeSApIHsKCWRlZmluZSggImpxdWVyeSIsIFtdLCBmdW5jdGlvbiAoKSB7IHJldHVybiBqUXVlcnk7IH0gKTsKfQoKfSkoIHdpbmRvdyApOwovLyAgICAgVW5kZXJzY29yZS5qcyAxLjYuMAovLyAgICAgaHR0cDovL3VuZGVyc2NvcmVqcy5vcmcKLy8gICAgIChjKSAyMDA5LTIwMTQgSmVyZW15IEFzaGtlbmFzLCBEb2N1bWVudENsb3VkIGFuZCBJbnZlc3RpZ2F0aXZlIFJlcG9ydGVycyAmIEVkaXRvcnMKLy8gICAgIFVuZGVyc2NvcmUgbWF5IGJlIGZyZWVseSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UuCgooZnVuY3Rpb24oKSB7CgogIC8vIEJhc2VsaW5lIHNldHVwCiAgLy8gLS0tLS0tLS0tLS0tLS0KCiAgLy8gRXN0YWJsaXNoIHRoZSByb290IG9iamVjdCwgYHdpbmRvd2AgaW4gdGhlIGJyb3dzZXIsIG9yIGBleHBvcnRzYCBvbiB0aGUgc2VydmVyLgogIHZhciByb290ID0gdGhpczsKCiAgLy8gU2F2ZSB0aGUgcHJldmlvdXMgdmFsdWUgb2YgdGhlIGBfYCB2YXJpYWJsZS4KICB2YXIgcHJldmlvdXNVbmRlcnNjb3JlID0gcm9vdC5fOwoKICAvLyBFc3RhYmxpc2ggdGhlIG9iamVjdCB0aGF0IGdldHMgcmV0dXJuZWQgdG8gYnJlYWsgb3V0IG9mIGEgbG9vcCBpdGVyYXRpb24uCiAgdmFyIGJyZWFrZXIgPSB7fTsKCiAgLy8gU2F2ZSBieXRlcyBpbiB0aGUgbWluaWZpZWQgKGJ1dCBub3QgZ3ppcHBlZCkgdmVyc2lvbjoKICB2YXIgQXJyYXlQcm90byA9IEFycmF5LnByb3RvdHlwZSwgT2JqUHJvdG8gPSBPYmplY3QucHJvdG90eXBlLCBGdW5jUHJvdG8gPSBGdW5jdGlvbi5wcm90b3R5cGU7CgogIC8vIENyZWF0ZSBxdWljayByZWZlcmVuY2UgdmFyaWFibGVzIGZvciBzcGVlZCBhY2Nlc3MgdG8gY29yZSBwcm90b3R5cGVzLgogIHZhcgogICAgcHVzaCAgICAgICAgICAgICA9IEFycmF5UHJvdG8ucHVzaCwKICAgIHNsaWNlICAgICAgICAgICAgPSBBcnJheVByb3RvLnNsaWNlLAogICAgY29uY2F0ICAgICAgICAgICA9IEFycmF5UHJvdG8uY29uY2F0LAogICAgdG9TdHJpbmcgICAgICAgICA9IE9ialByb3RvLnRvU3RyaW5nLAogICAgaGFzT3duUHJvcGVydHkgICA9IE9ialByb3RvLmhhc093blByb3BlcnR5OwoKICAvLyBBbGwgKipFQ01BU2NyaXB0IDUqKiBuYXRpdmUgZnVuY3Rpb24gaW1wbGVtZW50YXRpb25zIHRoYXQgd2UgaG9wZSB0byB1c2UKICAvLyBhcmUgZGVjbGFyZWQgaGVyZS4KICB2YXIKICAgIG5hdGl2ZUZvckVhY2ggICAgICA9IEFycmF5UHJvdG8uZm9yRWFjaCwKICAgIG5hdGl2ZU1hcCAgICAgICAgICA9IEFycmF5UHJvdG8ubWFwLAogICAgbmF0aXZlUmVkdWNlICAgICAgID0gQXJyYXlQcm90by5yZWR1Y2UsCiAgICBuYXRpdmVSZWR1Y2VSaWdodCAgPSBBcnJheVByb3RvLnJlZHVjZVJpZ2h0LAogICAgbmF0aXZlRmlsdGVyICAgICAgID0gQXJyYXlQcm90by5maWx0ZXIsCiAgICBuYXRpdmVFdmVyeSAgICAgICAgPSBBcnJheVByb3RvLmV2ZXJ5LAogICAgbmF0aXZlU29tZSAgICAgICAgID0gQXJyYXlQcm90by5zb21lLAogICAgbmF0aXZlSW5kZXhPZiAgICAgID0gQXJyYXlQcm90by5pbmRleE9mLAogICAgbmF0aXZlTGFzdEluZGV4T2YgID0gQXJyYXlQcm90by5sYXN0SW5kZXhPZiwKICAgIG5hdGl2ZUlzQXJyYXkgICAgICA9IEFycmF5LmlzQXJyYXksCiAgICBuYXRpdmVLZXlzICAgICAgICAgPSBPYmplY3Qua2V5cywKICAgIG5hdGl2ZUJpbmQgICAgICAgICA9IEZ1bmNQcm90by5iaW5kOwoKICAvLyBDcmVhdGUgYSBzYWZlIHJlZmVyZW5jZSB0byB0aGUgVW5kZXJzY29yZSBvYmplY3QgZm9yIHVzZSBiZWxvdy4KICB2YXIgXyA9IGZ1bmN0aW9uKG9iaikgewogICAgaWYgKG9iaiBpbnN0YW5jZW9mIF8pIHJldHVybiBvYmo7CiAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgXykpIHJldHVybiBuZXcgXyhvYmopOwogICAgdGhpcy5fd3JhcHBlZCA9IG9iajsKICB9OwoKICAvLyBFeHBvcnQgdGhlIFVuZGVyc2NvcmUgb2JqZWN0IGZvciAqKk5vZGUuanMqKiwgd2l0aAogIC8vIGJhY2t3YXJkcy1jb21wYXRpYmlsaXR5IGZvciB0aGUgb2xkIGByZXF1aXJlKClgIEFQSS4gSWYgd2UncmUgaW4KICAvLyB0aGUgYnJvd3NlciwgYWRkIGBfYCBhcyBhIGdsb2JhbCBvYmplY3QgdmlhIGEgc3RyaW5nIGlkZW50aWZpZXIsCiAgLy8gZm9yIENsb3N1cmUgQ29tcGlsZXIgImFkdmFuY2VkIiBtb2RlLgogIGlmICh0eXBlb2YgZXhwb3J0cyAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgIGlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyAmJiBtb2R1bGUuZXhwb3J0cykgewogICAgICBleHBvcnRzID0gbW9kdWxlLmV4cG9ydHMgPSBfOwogICAgfQogICAgZXhwb3J0cy5fID0gXzsKICB9IGVsc2UgewogICAgcm9vdC5fID0gXzsKICB9CgogIC8vIEN1cnJlbnQgdmVyc2lvbi4KICBfLlZFUlNJT04gPSAnMS42LjAnOwoKICAvLyBDb2xsZWN0aW9uIEZ1bmN0aW9ucwogIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tCgogIC8vIFRoZSBjb3JuZXJzdG9uZSwgYW4gYGVhY2hgIGltcGxlbWVudGF0aW9uLCBha2EgYGZvckVhY2hgLgogIC8vIEhhbmRsZXMgb2JqZWN0cyB3aXRoIHRoZSBidWlsdC1pbiBgZm9yRWFjaGAsIGFycmF5cywgYW5kIHJhdyBvYmplY3RzLgogIC8vIERlbGVnYXRlcyB0byAqKkVDTUFTY3JpcHQgNSoqJ3MgbmF0aXZlIGBmb3JFYWNoYCBpZiBhdmFpbGFibGUuCiAgdmFyIGVhY2ggPSBfLmVhY2ggPSBfLmZvckVhY2ggPSBmdW5jdGlvbihvYmosIGl0ZXJhdG9yLCBjb250ZXh0KSB7CiAgICBpZiAob2JqID09IG51bGwpIHJldHVybiBvYmo7CiAgICBpZiAobmF0aXZlRm9yRWFjaCAmJiBvYmouZm9yRWFjaCA9PT0gbmF0aXZlRm9yRWFjaCkgewogICAgICBvYmouZm9yRWFjaChpdGVyYXRvciwgY29udGV4dCk7CiAgICB9IGVsc2UgaWYgKG9iai5sZW5ndGggPT09ICtvYmoubGVuZ3RoKSB7CiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBvYmoubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAoaXRlcmF0b3IuY2FsbChjb250ZXh0LCBvYmpbaV0sIGksIG9iaikgPT09IGJyZWFrZXIpIHJldHVybjsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgdmFyIGtleXMgPSBfLmtleXMob2JqKTsKICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IGtleXMubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAoaXRlcmF0b3IuY2FsbChjb250ZXh0LCBvYmpba2V5c1tpXV0sIGtleXNbaV0sIG9iaikgPT09IGJyZWFrZXIpIHJldHVybjsKICAgICAgfQogICAgfQogICAgcmV0dXJuIG9iajsKICB9OwoKICAvLyBSZXR1cm4gdGhlIHJlc3VsdHMgb2YgYXBwbHlpbmcgdGhlIGl0ZXJhdG9yIHRvIGVhY2ggZWxlbWVudC4KICAvLyBEZWxlZ2F0ZXMgdG8gKipFQ01BU2NyaXB0IDUqKidzIG5hdGl2ZSBgbWFwYCBpZiBhdmFpbGFibGUuCiAgXy5tYXAgPSBfLmNvbGxlY3QgPSBmdW5jdGlvbihvYmosIGl0ZXJhdG9yLCBjb250ZXh0KSB7CiAgICB2YXIgcmVzdWx0cyA9IFtdOwogICAgaWYgKG9iaiA9PSBudWxsKSByZXR1cm4gcmVzdWx0czsKICAgIGlmIChuYXRpdmVNYXAgJiYgb2JqLm1hcCA9PT0gbmF0aXZlTWFwKSByZXR1cm4gb2JqLm1hcChpdGVyYXRvciwgY29udGV4dCk7CiAgICBlYWNoKG9iaiwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBsaXN0KSB7CiAgICAgIHJlc3VsdHMucHVzaChpdGVyYXRvci5jYWxsKGNvbnRleHQsIHZhbHVlLCBpbmRleCwgbGlzdCkpOwogICAgfSk7CiAgICByZXR1cm4gcmVzdWx0czsKICB9OwoKICB2YXIgcmVkdWNlRXJyb3IgPSAnUmVkdWNlIG9mIGVtcHR5IGFycmF5IHdpdGggbm8gaW5pdGlhbCB2YWx1ZSc7CgogIC8vICoqUmVkdWNlKiogYnVpbGRzIHVwIGEgc2luZ2xlIHJlc3VsdCBmcm9tIGEgbGlzdCBvZiB2YWx1ZXMsIGFrYSBgaW5qZWN0YCwKICAvLyBvciBgZm9sZGxgLiBEZWxlZ2F0ZXMgdG8gKipFQ01BU2NyaXB0IDUqKidzIG5hdGl2ZSBgcmVkdWNlYCBpZiBhdmFpbGFibGUuCiAgXy5yZWR1Y2UgPSBfLmZvbGRsID0gXy5pbmplY3QgPSBmdW5jdGlvbihvYmosIGl0ZXJhdG9yLCBtZW1vLCBjb250ZXh0KSB7CiAgICB2YXIgaW5pdGlhbCA9IGFyZ3VtZW50cy5sZW5ndGggPiAyOwogICAgaWYgKG9iaiA9PSBudWxsKSBvYmogPSBbXTsKICAgIGlmIChuYXRpdmVSZWR1Y2UgJiYgb2JqLnJlZHVjZSA9PT0gbmF0aXZlUmVkdWNlKSB7CiAgICAgIGlmIChjb250ZXh0KSBpdGVyYXRvciA9IF8uYmluZChpdGVyYXRvciwgY29udGV4dCk7CiAgICAgIHJldHVybiBpbml0aWFsID8gb2JqLnJlZHVjZShpdGVyYXRvciwgbWVtbykgOiBvYmoucmVkdWNlKGl0ZXJhdG9yKTsKICAgIH0KICAgIGVhY2gob2JqLCBmdW5jdGlvbih2YWx1ZSwgaW5kZXgsIGxpc3QpIHsKICAgICAgaWYgKCFpbml0aWFsKSB7CiAgICAgICAgbWVtbyA9IHZhbHVlOwogICAgICAgIGluaXRpYWwgPSB0cnVlOwogICAgICB9IGVsc2UgewogICAgICAgIG1lbW8gPSBpdGVyYXRvci5jYWxsKGNvbnRleHQsIG1lbW8sIHZhbHVlLCBpbmRleCwgbGlzdCk7CiAgICAgIH0KICAgIH0pOwogICAgaWYgKCFpbml0aWFsKSB0aHJvdyBuZXcgVHlwZUVycm9yKHJlZHVjZUVycm9yKTsKICAgIHJldHVybiBtZW1vOwogIH07CgogIC8vIFRoZSByaWdodC1hc3NvY2lhdGl2ZSB2ZXJzaW9uIG9mIHJlZHVjZSwgYWxzbyBrbm93biBhcyBgZm9sZHJgLgogIC8vIERlbGVnYXRlcyB0byAqKkVDTUFTY3JpcHQgNSoqJ3MgbmF0aXZlIGByZWR1Y2VSaWdodGAgaWYgYXZhaWxhYmxlLgogIF8ucmVkdWNlUmlnaHQgPSBfLmZvbGRyID0gZnVuY3Rpb24ob2JqLCBpdGVyYXRvciwgbWVtbywgY29udGV4dCkgewogICAgdmFyIGluaXRpYWwgPSBhcmd1bWVudHMubGVuZ3RoID4gMjsKICAgIGlmIChvYmogPT0gbnVsbCkgb2JqID0gW107CiAgICBpZiAobmF0aXZlUmVkdWNlUmlnaHQgJiYgb2JqLnJlZHVjZVJpZ2h0ID09PSBuYXRpdmVSZWR1Y2VSaWdodCkgewogICAgICBpZiAoY29udGV4dCkgaXRlcmF0b3IgPSBfLmJpbmQoaXRlcmF0b3IsIGNvbnRleHQpOwogICAgICByZXR1cm4gaW5pdGlhbCA/IG9iai5yZWR1Y2VSaWdodChpdGVyYXRvciwgbWVtbykgOiBvYmoucmVkdWNlUmlnaHQoaXRlcmF0b3IpOwogICAgfQogICAgdmFyIGxlbmd0aCA9IG9iai5sZW5ndGg7CiAgICBpZiAobGVuZ3RoICE9PSArbGVuZ3RoKSB7CiAgICAgIHZhciBrZXlzID0gXy5rZXlzKG9iaik7CiAgICAgIGxlbmd0aCA9IGtleXMubGVuZ3RoOwogICAgfQogICAgZWFjaChvYmosIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCwgbGlzdCkgewogICAgICBpbmRleCA9IGtleXMgPyBrZXlzWy0tbGVuZ3RoXSA6IC0tbGVuZ3RoOwogICAgICBpZiAoIWluaXRpYWwpIHsKICAgICAgICBtZW1vID0gb2JqW2luZGV4XTsKICAgICAgICBpbml0aWFsID0gdHJ1ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBtZW1vID0gaXRlcmF0b3IuY2FsbChjb250ZXh0LCBtZW1vLCBvYmpbaW5kZXhdLCBpbmRleCwgbGlzdCk7CiAgICAgIH0KICAgIH0pOwogICAgaWYgKCFpbml0aWFsKSB0aHJvdyBuZXcgVHlwZUVycm9yKHJlZHVjZUVycm9yKTsKICAgIHJldHVybiBtZW1vOwogIH07CgogIC8vIFJldHVybiB0aGUgZmlyc3QgdmFsdWUgd2hpY2ggcGFzc2VzIGEgdHJ1dGggdGVzdC4gQWxpYXNlZCBhcyBgZGV0ZWN0YC4KICBfLmZpbmQgPSBfLmRldGVjdCA9IGZ1bmN0aW9uKG9iaiwgcHJlZGljYXRlLCBjb250ZXh0KSB7CiAgICB2YXIgcmVzdWx0OwogICAgYW55KG9iaiwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBsaXN0KSB7CiAgICAgIGlmIChwcmVkaWNhdGUuY2FsbChjb250ZXh0LCB2YWx1ZSwgaW5kZXgsIGxpc3QpKSB7CiAgICAgICAgcmVzdWx0ID0gdmFsdWU7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIHJlc3VsdDsKICB9OwoKICAvLyBSZXR1cm4gYWxsIHRoZSBlbGVtZW50cyB0aGF0IHBhc3MgYSB0cnV0aCB0ZXN0LgogIC8vIERlbGVnYXRlcyB0byAqKkVDTUFTY3JpcHQgNSoqJ3MgbmF0aXZlIGBmaWx0ZXJgIGlmIGF2YWlsYWJsZS4KICAvLyBBbGlhc2VkIGFzIGBzZWxlY3RgLgogIF8uZmlsdGVyID0gXy5zZWxlY3QgPSBmdW5jdGlvbihvYmosIHByZWRpY2F0ZSwgY29udGV4dCkgewogICAgdmFyIHJlc3VsdHMgPSBbXTsKICAgIGlmIChvYmogPT0gbnVsbCkgcmV0dXJuIHJlc3VsdHM7CiAgICBpZiAobmF0aXZlRmlsdGVyICYmIG9iai5maWx0ZXIgPT09IG5hdGl2ZUZpbHRlcikgcmV0dXJuIG9iai5maWx0ZXIocHJlZGljYXRlLCBjb250ZXh0KTsKICAgIGVhY2gob2JqLCBmdW5jdGlvbih2YWx1ZSwgaW5kZXgsIGxpc3QpIHsKICAgICAgaWYgKHByZWRpY2F0ZS5jYWxsKGNvbnRleHQsIHZhbHVlLCBpbmRleCwgbGlzdCkpIHJlc3VsdHMucHVzaCh2YWx1ZSk7CiAgICB9KTsKICAgIHJldHVybiByZXN1bHRzOwogIH07CgogIC8vIFJldHVybiBhbGwgdGhlIGVsZW1lbnRzIGZvciB3aGljaCBhIHRydXRoIHRlc3QgZmFpbHMuCiAgXy5yZWplY3QgPSBmdW5jdGlvbihvYmosIHByZWRpY2F0ZSwgY29udGV4dCkgewogICAgcmV0dXJuIF8uZmlsdGVyKG9iaiwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBsaXN0KSB7CiAgICAgIHJldHVybiAhcHJlZGljYXRlLmNhbGwoY29udGV4dCwgdmFsdWUsIGluZGV4LCBsaXN0KTsKICAgIH0sIGNvbnRleHQpOwogIH07CgogIC8vIERldGVybWluZSB3aGV0aGVyIGFsbCBvZiB0aGUgZWxlbWVudHMgbWF0Y2ggYSB0cnV0aCB0ZXN0LgogIC8vIERlbGVnYXRlcyB0byAqKkVDTUFTY3JpcHQgNSoqJ3MgbmF0aXZlIGBldmVyeWAgaWYgYXZhaWxhYmxlLgogIC8vIEFsaWFzZWQgYXMgYGFsbGAuCiAgXy5ldmVyeSA9IF8uYWxsID0gZnVuY3Rpb24ob2JqLCBwcmVkaWNhdGUsIGNvbnRleHQpIHsKICAgIHByZWRpY2F0ZSB8fCAocHJlZGljYXRlID0gXy5pZGVudGl0eSk7CiAgICB2YXIgcmVzdWx0ID0gdHJ1ZTsKICAgIGlmIChvYmogPT0gbnVsbCkgcmV0dXJuIHJlc3VsdDsKICAgIGlmIChuYXRpdmVFdmVyeSAmJiBvYmouZXZlcnkgPT09IG5hdGl2ZUV2ZXJ5KSByZXR1cm4gb2JqLmV2ZXJ5KHByZWRpY2F0ZSwgY29udGV4dCk7CiAgICBlYWNoKG9iaiwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBsaXN0KSB7CiAgICAgIGlmICghKHJlc3VsdCA9IHJlc3VsdCAmJiBwcmVkaWNhdGUuY2FsbChjb250ZXh0LCB2YWx1ZSwgaW5kZXgsIGxpc3QpKSkgcmV0dXJuIGJyZWFrZXI7CiAgICB9KTsKICAgIHJldHVybiAhIXJlc3VsdDsKICB9OwoKICAvLyBEZXRlcm1pbmUgaWYgYXQgbGVhc3Qgb25lIGVsZW1lbnQgaW4gdGhlIG9iamVjdCBtYXRjaGVzIGEgdHJ1dGggdGVzdC4KICAvLyBEZWxlZ2F0ZXMgdG8gKipFQ01BU2NyaXB0IDUqKidzIG5hdGl2ZSBgc29tZWAgaWYgYXZhaWxhYmxlLgogIC8vIEFsaWFzZWQgYXMgYGFueWAuCiAgdmFyIGFueSA9IF8uc29tZSA9IF8uYW55ID0gZnVuY3Rpb24ob2JqLCBwcmVkaWNhdGUsIGNvbnRleHQpIHsKICAgIHByZWRpY2F0ZSB8fCAocHJlZGljYXRlID0gXy5pZGVudGl0eSk7CiAgICB2YXIgcmVzdWx0ID0gZmFsc2U7CiAgICBpZiAob2JqID09IG51bGwpIHJldHVybiByZXN1bHQ7CiAgICBpZiAobmF0aXZlU29tZSAmJiBvYmouc29tZSA9PT0gbmF0aXZlU29tZSkgcmV0dXJuIG9iai5zb21lKHByZWRpY2F0ZSwgY29udGV4dCk7CiAgICBlYWNoKG9iaiwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBsaXN0KSB7CiAgICAgIGlmIChyZXN1bHQgfHwgKHJlc3VsdCA9IHByZWRpY2F0ZS5jYWxsKGNvbnRleHQsIHZhbHVlLCBpbmRleCwgbGlzdCkpKSByZXR1cm4gYnJlYWtlcjsKICAgIH0pOwogICAgcmV0dXJuICEhcmVzdWx0OwogIH07CgogIC8vIERldGVybWluZSBpZiB0aGUgYXJyYXkgb3Igb2JqZWN0IGNvbnRhaW5zIGEgZ2l2ZW4gdmFsdWUgKHVzaW5nIGA9PT1gKS4KICAvLyBBbGlhc2VkIGFzIGBpbmNsdWRlYC4KICBfLmNvbnRhaW5zID0gXy5pbmNsdWRlID0gZnVuY3Rpb24ob2JqLCB0YXJnZXQpIHsKICAgIGlmIChvYmogPT0gbnVsbCkgcmV0dXJuIGZhbHNlOwogICAgaWYgKG5hdGl2ZUluZGV4T2YgJiYgb2JqLmluZGV4T2YgPT09IG5hdGl2ZUluZGV4T2YpIHJldHVybiBvYmouaW5kZXhPZih0YXJnZXQpICE9IC0xOwogICAgcmV0dXJuIGFueShvYmosIGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgIHJldHVybiB2YWx1ZSA9PT0gdGFyZ2V0OwogICAgfSk7CiAgfTsKCiAgLy8gSW52b2tlIGEgbWV0aG9kICh3aXRoIGFyZ3VtZW50cykgb24gZXZlcnkgaXRlbSBpbiBhIGNvbGxlY3Rpb24uCiAgXy5pbnZva2UgPSBmdW5jdGlvbihvYmosIG1ldGhvZCkgewogICAgdmFyIGFyZ3MgPSBzbGljZS5jYWxsKGFyZ3VtZW50cywgMik7CiAgICB2YXIgaXNGdW5jID0gXy5pc0Z1bmN0aW9uKG1ldGhvZCk7CiAgICByZXR1cm4gXy5tYXAob2JqLCBmdW5jdGlvbih2YWx1ZSkgewogICAgICByZXR1cm4gKGlzRnVuYyA/IG1ldGhvZCA6IHZhbHVlW21ldGhvZF0pLmFwcGx5KHZhbHVlLCBhcmdzKTsKICAgIH0pOwogIH07CgogIC8vIENvbnZlbmllbmNlIHZlcnNpb24gb2YgYSBjb21tb24gdXNlIGNhc2Ugb2YgYG1hcGA6IGZldGNoaW5nIGEgcHJvcGVydHkuCiAgXy5wbHVjayA9IGZ1bmN0aW9uKG9iaiwga2V5KSB7CiAgICByZXR1cm4gXy5tYXAob2JqLCBfLnByb3BlcnR5KGtleSkpOwogIH07CgogIC8vIENvbnZlbmllbmNlIHZlcnNpb24gb2YgYSBjb21tb24gdXNlIGNhc2Ugb2YgYGZpbHRlcmA6IHNlbGVjdGluZyBvbmx5IG9iamVjdHMKICAvLyBjb250YWluaW5nIHNwZWNpZmljIGBrZXk6dmFsdWVgIHBhaXJzLgogIF8ud2hlcmUgPSBmdW5jdGlvbihvYmosIGF0dHJzKSB7CiAgICByZXR1cm4gXy5maWx0ZXIob2JqLCBfLm1hdGNoZXMoYXR0cnMpKTsKICB9OwoKICAvLyBDb252ZW5pZW5jZSB2ZXJzaW9uIG9mIGEgY29tbW9uIHVzZSBjYXNlIG9mIGBmaW5kYDogZ2V0dGluZyB0aGUgZmlyc3Qgb2JqZWN0CiAgLy8gY29udGFpbmluZyBzcGVjaWZpYyBga2V5OnZhbHVlYCBwYWlycy4KICBfLmZpbmRXaGVyZSA9IGZ1bmN0aW9uKG9iaiwgYXR0cnMpIHsKICAgIHJldHVybiBfLmZpbmQob2JqLCBfLm1hdGNoZXMoYXR0cnMpKTsKICB9OwoKICAvLyBSZXR1cm4gdGhlIG1heGltdW0gZWxlbWVudCBvciAoZWxlbWVudC1iYXNlZCBjb21wdXRhdGlvbikuCiAgLy8gQ2FuJ3Qgb3B0aW1pemUgYXJyYXlzIG9mIGludGVnZXJzIGxvbmdlciB0aGFuIDY1LDUzNSBlbGVtZW50cy4KICAvLyBTZWUgW1dlYktpdCBCdWcgODA3OTddKGh0dHBzOi8vYnVncy53ZWJraXQub3JnL3Nob3dfYnVnLmNnaT9pZD04MDc5NykKICBfLm1heCA9IGZ1bmN0aW9uKG9iaiwgaXRlcmF0b3IsIGNvbnRleHQpIHsKICAgIGlmICghaXRlcmF0b3IgJiYgXy5pc0FycmF5KG9iaikgJiYgb2JqWzBdID09PSArb2JqWzBdICYmIG9iai5sZW5ndGggPCA2NTUzNSkgewogICAgICByZXR1cm4gTWF0aC5tYXguYXBwbHkoTWF0aCwgb2JqKTsKICAgIH0KICAgIHZhciByZXN1bHQgPSAtSW5maW5pdHksIGxhc3RDb21wdXRlZCA9IC1JbmZpbml0eTsKICAgIGVhY2gob2JqLCBmdW5jdGlvbih2YWx1ZSwgaW5kZXgsIGxpc3QpIHsKICAgICAgdmFyIGNvbXB1dGVkID0gaXRlcmF0b3IgPyBpdGVyYXRvci5jYWxsKGNvbnRleHQsIHZhbHVlLCBpbmRleCwgbGlzdCkgOiB2YWx1ZTsKICAgICAgaWYgKGNvbXB1dGVkID4gbGFzdENvbXB1dGVkKSB7CiAgICAgICAgcmVzdWx0ID0gdmFsdWU7CiAgICAgICAgbGFzdENvbXB1dGVkID0gY29tcHV0ZWQ7CiAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIHJlc3VsdDsKICB9OwoKICAvLyBSZXR1cm4gdGhlIG1pbmltdW0gZWxlbWVudCAob3IgZWxlbWVudC1iYXNlZCBjb21wdXRhdGlvbikuCiAgXy5taW4gPSBmdW5jdGlvbihvYmosIGl0ZXJhdG9yLCBjb250ZXh0KSB7CiAgICBpZiAoIWl0ZXJhdG9yICYmIF8uaXNBcnJheShvYmopICYmIG9ialswXSA9PT0gK29ialswXSAmJiBvYmoubGVuZ3RoIDwgNjU1MzUpIHsKICAgICAgcmV0dXJuIE1hdGgubWluLmFwcGx5KE1hdGgsIG9iaik7CiAgICB9CiAgICB2YXIgcmVzdWx0ID0gSW5maW5pdHksIGxhc3RDb21wdXRlZCA9IEluZmluaXR5OwogICAgZWFjaChvYmosIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCwgbGlzdCkgewogICAgICB2YXIgY29tcHV0ZWQgPSBpdGVyYXRvciA/IGl0ZXJhdG9yLmNhbGwoY29udGV4dCwgdmFsdWUsIGluZGV4LCBsaXN0KSA6IHZhbHVlOwogICAgICBpZiAoY29tcHV0ZWQgPCBsYXN0Q29tcHV0ZWQpIHsKICAgICAgICByZXN1bHQgPSB2YWx1ZTsKICAgICAgICBsYXN0Q29tcHV0ZWQgPSBjb21wdXRlZDsKICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gcmVzdWx0OwogIH07CgogIC8vIFNodWZmbGUgYW4gYXJyYXksIHVzaW5nIHRoZSBtb2Rlcm4gdmVyc2lvbiBvZiB0aGUKICAvLyBbRmlzaGVyLVlhdGVzIHNodWZmbGVdKGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvRmlzaGVy4oCTWWF0ZXNfc2h1ZmZsZSkuCiAgXy5zaHVmZmxlID0gZnVuY3Rpb24ob2JqKSB7CiAgICB2YXIgcmFuZDsKICAgIHZhciBpbmRleCA9IDA7CiAgICB2YXIgc2h1ZmZsZWQgPSBbXTsKICAgIGVhY2gob2JqLCBmdW5jdGlvbih2YWx1ZSkgewogICAgICByYW5kID0gXy5yYW5kb20oaW5kZXgrKyk7CiAgICAgIHNodWZmbGVkW2luZGV4IC0gMV0gPSBzaHVmZmxlZFtyYW5kXTsKICAgICAgc2h1ZmZsZWRbcmFuZF0gPSB2YWx1ZTsKICAgIH0pOwogICAgcmV0dXJuIHNodWZmbGVkOwogIH07CgogIC8vIFNhbXBsZSAqKm4qKiByYW5kb20gdmFsdWVzIGZyb20gYSBjb2xsZWN0aW9uLgogIC8vIElmICoqbioqIGlzIG5vdCBzcGVjaWZpZWQsIHJldHVybnMgYSBzaW5nbGUgcmFuZG9tIGVsZW1lbnQuCiAgLy8gVGhlIGludGVybmFsIGBndWFyZGAgYXJndW1lbnQgYWxsb3dzIGl0IHRvIHdvcmsgd2l0aCBgbWFwYC4KICBfLnNhbXBsZSA9IGZ1bmN0aW9uKG9iaiwgbiwgZ3VhcmQpIHsKICAgIGlmIChuID09IG51bGwgfHwgZ3VhcmQpIHsKICAgICAgaWYgKG9iai5sZW5ndGggIT09ICtvYmoubGVuZ3RoKSBvYmogPSBfLnZhbHVlcyhvYmopOwogICAgICByZXR1cm4gb2JqW18ucmFuZG9tKG9iai5sZW5ndGggLSAxKV07CiAgICB9CiAgICByZXR1cm4gXy5zaHVmZmxlKG9iaikuc2xpY2UoMCwgTWF0aC5tYXgoMCwgbikpOwogIH07CgogIC8vIEFuIGludGVybmFsIGZ1bmN0aW9uIHRvIGdlbmVyYXRlIGxvb2t1cCBpdGVyYXRvcnMuCiAgdmFyIGxvb2t1cEl0ZXJhdG9yID0gZnVuY3Rpb24odmFsdWUpIHsKICAgIGlmICh2YWx1ZSA9PSBudWxsKSByZXR1cm4gXy5pZGVudGl0eTsKICAgIGlmIChfLmlzRnVuY3Rpb24odmFsdWUpKSByZXR1cm4gdmFsdWU7CiAgICByZXR1cm4gXy5wcm9wZXJ0eSh2YWx1ZSk7CiAgfTsKCiAgLy8gU29ydCB0aGUgb2JqZWN0J3MgdmFsdWVzIGJ5IGEgY3JpdGVyaW9uIHByb2R1Y2VkIGJ5IGFuIGl0ZXJhdG9yLgogIF8uc29ydEJ5ID0gZnVuY3Rpb24ob2JqLCBpdGVyYXRvciwgY29udGV4dCkgewogICAgaXRlcmF0b3IgPSBsb29rdXBJdGVyYXRvcihpdGVyYXRvcik7CiAgICByZXR1cm4gXy5wbHVjayhfLm1hcChvYmosIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCwgbGlzdCkgewogICAgICByZXR1cm4gewogICAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgICBpbmRleDogaW5kZXgsCiAgICAgICAgY3JpdGVyaWE6IGl0ZXJhdG9yLmNhbGwoY29udGV4dCwgdmFsdWUsIGluZGV4LCBsaXN0KQogICAgICB9OwogICAgfSkuc29ydChmdW5jdGlvbihsZWZ0LCByaWdodCkgewogICAgICB2YXIgYSA9IGxlZnQuY3JpdGVyaWE7CiAgICAgIHZhciBiID0gcmlnaHQuY3JpdGVyaWE7CiAgICAgIGlmIChhICE9PSBiKSB7CiAgICAgICAgaWYgKGEgPiBiIHx8IGEgPT09IHZvaWQgMCkgcmV0dXJuIDE7CiAgICAgICAgaWYgKGEgPCBiIHx8IGIgPT09IHZvaWQgMCkgcmV0dXJuIC0xOwogICAgICB9CiAgICAgIHJldHVybiBsZWZ0LmluZGV4IC0gcmlnaHQuaW5kZXg7CiAgICB9KSwgJ3ZhbHVlJyk7CiAgfTsKCiAgLy8gQW4gaW50ZXJuYWwgZnVuY3Rpb24gdXNlZCBmb3IgYWdncmVnYXRlICJncm91cCBieSIgb3BlcmF0aW9ucy4KICB2YXIgZ3JvdXAgPSBmdW5jdGlvbihiZWhhdmlvcikgewogICAgcmV0dXJuIGZ1bmN0aW9uKG9iaiwgaXRlcmF0b3IsIGNvbnRleHQpIHsKICAgICAgdmFyIHJlc3VsdCA9IHt9OwogICAgICBpdGVyYXRvciA9IGxvb2t1cEl0ZXJhdG9yKGl0ZXJhdG9yKTsKICAgICAgZWFjaChvYmosIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCkgewogICAgICAgIHZhciBrZXkgPSBpdGVyYXRvci5jYWxsKGNvbnRleHQsIHZhbHVlLCBpbmRleCwgb2JqKTsKICAgICAgICBiZWhhdmlvcihyZXN1bHQsIGtleSwgdmFsdWUpOwogICAgICB9KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH07CiAgfTsKCiAgLy8gR3JvdXBzIHRoZSBvYmplY3QncyB2YWx1ZXMgYnkgYSBjcml0ZXJpb24uIFBhc3MgZWl0aGVyIGEgc3RyaW5nIGF0dHJpYnV0ZQogIC8vIHRvIGdyb3VwIGJ5LCBvciBhIGZ1bmN0aW9uIHRoYXQgcmV0dXJucyB0aGUgY3JpdGVyaW9uLgogIF8uZ3JvdXBCeSA9IGdyb3VwKGZ1bmN0aW9uKHJlc3VsdCwga2V5LCB2YWx1ZSkgewogICAgXy5oYXMocmVzdWx0LCBrZXkpID8gcmVzdWx0W2tleV0ucHVzaCh2YWx1ZSkgOiByZXN1bHRba2V5XSA9IFt2YWx1ZV07CiAgfSk7CgogIC8vIEluZGV4ZXMgdGhlIG9iamVjdCdzIHZhbHVlcyBieSBhIGNyaXRlcmlvbiwgc2ltaWxhciB0byBgZ3JvdXBCeWAsIGJ1dCBmb3IKICAvLyB3aGVuIHlvdSBrbm93IHRoYXQgeW91ciBpbmRleCB2YWx1ZXMgd2lsbCBiZSB1bmlxdWUuCiAgXy5pbmRleEJ5ID0gZ3JvdXAoZnVuY3Rpb24ocmVzdWx0LCBrZXksIHZhbHVlKSB7CiAgICByZXN1bHRba2V5XSA9IHZhbHVlOwogIH0pOwoKICAvLyBDb3VudHMgaW5zdGFuY2VzIG9mIGFuIG9iamVjdCB0aGF0IGdyb3VwIGJ5IGEgY2VydGFpbiBjcml0ZXJpb24uIFBhc3MKICAvLyBlaXRoZXIgYSBzdHJpbmcgYXR0cmlidXRlIHRvIGNvdW50IGJ5LCBvciBhIGZ1bmN0aW9uIHRoYXQgcmV0dXJucyB0aGUKICAvLyBjcml0ZXJpb24uCiAgXy5jb3VudEJ5ID0gZ3JvdXAoZnVuY3Rpb24ocmVzdWx0LCBrZXkpIHsKICAgIF8uaGFzKHJlc3VsdCwga2V5KSA/IHJlc3VsdFtrZXldKysgOiByZXN1bHRba2V5XSA9IDE7CiAgfSk7CgogIC8vIFVzZSBhIGNvbXBhcmF0b3IgZnVuY3Rpb24gdG8gZmlndXJlIG91dCB0aGUgc21hbGxlc3QgaW5kZXggYXQgd2hpY2gKICAvLyBhbiBvYmplY3Qgc2hvdWxkIGJlIGluc2VydGVkIHNvIGFzIHRvIG1haW50YWluIG9yZGVyLiBVc2VzIGJpbmFyeSBzZWFyY2guCiAgXy5zb3J0ZWRJbmRleCA9IGZ1bmN0aW9uKGFycmF5LCBvYmosIGl0ZXJhdG9yLCBjb250ZXh0KSB7CiAgICBpdGVyYXRvciA9IGxvb2t1cEl0ZXJhdG9yKGl0ZXJhdG9yKTsKICAgIHZhciB2YWx1ZSA9IGl0ZXJhdG9yLmNhbGwoY29udGV4dCwgb2JqKTsKICAgIHZhciBsb3cgPSAwLCBoaWdoID0gYXJyYXkubGVuZ3RoOwogICAgd2hpbGUgKGxvdyA8IGhpZ2gpIHsKICAgICAgdmFyIG1pZCA9IChsb3cgKyBoaWdoKSA+Pj4gMTsKICAgICAgaXRlcmF0b3IuY2FsbChjb250ZXh0LCBhcnJheVttaWRdKSA8IHZhbHVlID8gbG93ID0gbWlkICsgMSA6IGhpZ2ggPSBtaWQ7CiAgICB9CiAgICByZXR1cm4gbG93OwogIH07CgogIC8vIFNhZmVseSBjcmVhdGUgYSByZWFsLCBsaXZlIGFycmF5IGZyb20gYW55dGhpbmcgaXRlcmFibGUuCiAgXy50b0FycmF5ID0gZnVuY3Rpb24ob2JqKSB7CiAgICBpZiAoIW9iaikgcmV0dXJuIFtdOwogICAgaWYgKF8uaXNBcnJheShvYmopKSByZXR1cm4gc2xpY2UuY2FsbChvYmopOwogICAgaWYgKG9iai5sZW5ndGggPT09ICtvYmoubGVuZ3RoKSByZXR1cm4gXy5tYXAob2JqLCBfLmlkZW50aXR5KTsKICAgIHJldHVybiBfLnZhbHVlcyhvYmopOwogIH07CgogIC8vIFJldHVybiB0aGUgbnVtYmVyIG9mIGVsZW1lbnRzIGluIGFuIG9iamVjdC4KICBfLnNpemUgPSBmdW5jdGlvbihvYmopIHsKICAgIGlmIChvYmogPT0gbnVsbCkgcmV0dXJuIDA7CiAgICByZXR1cm4gKG9iai5sZW5ndGggPT09ICtvYmoubGVuZ3RoKSA/IG9iai5sZW5ndGggOiBfLmtleXMob2JqKS5sZW5ndGg7CiAgfTsKCiAgLy8gQXJyYXkgRnVuY3Rpb25zCiAgLy8gLS0tLS0tLS0tLS0tLS0tCgogIC8vIEdldCB0aGUgZmlyc3QgZWxlbWVudCBvZiBhbiBhcnJheS4gUGFzc2luZyAqKm4qKiB3aWxsIHJldHVybiB0aGUgZmlyc3QgTgogIC8vIHZhbHVlcyBpbiB0aGUgYXJyYXkuIEFsaWFzZWQgYXMgYGhlYWRgIGFuZCBgdGFrZWAuIFRoZSAqKmd1YXJkKiogY2hlY2sKICAvLyBhbGxvd3MgaXQgdG8gd29yayB3aXRoIGBfLm1hcGAuCiAgXy5maXJzdCA9IF8uaGVhZCA9IF8udGFrZSA9IGZ1bmN0aW9uKGFycmF5LCBuLCBndWFyZCkgewogICAgaWYgKGFycmF5ID09IG51bGwpIHJldHVybiB2b2lkIDA7CiAgICBpZiAoKG4gPT0gbnVsbCkgfHwgZ3VhcmQpIHJldHVybiBhcnJheVswXTsKICAgIGlmIChuIDwgMCkgcmV0dXJuIFtdOwogICAgcmV0dXJuIHNsaWNlLmNhbGwoYXJyYXksIDAsIG4pOwogIH07CgogIC8vIFJldHVybnMgZXZlcnl0aGluZyBidXQgdGhlIGxhc3QgZW50cnkgb2YgdGhlIGFycmF5LiBFc3BlY2lhbGx5IHVzZWZ1bCBvbgogIC8vIHRoZSBhcmd1bWVudHMgb2JqZWN0LiBQYXNzaW5nICoqbioqIHdpbGwgcmV0dXJuIGFsbCB0aGUgdmFsdWVzIGluCiAgLy8gdGhlIGFycmF5LCBleGNsdWRpbmcgdGhlIGxhc3QgTi4gVGhlICoqZ3VhcmQqKiBjaGVjayBhbGxvd3MgaXQgdG8gd29yayB3aXRoCiAgLy8gYF8ubWFwYC4KICBfLmluaXRpYWwgPSBmdW5jdGlvbihhcnJheSwgbiwgZ3VhcmQpIHsKICAgIHJldHVybiBzbGljZS5jYWxsKGFycmF5LCAwLCBhcnJheS5sZW5ndGggLSAoKG4gPT0gbnVsbCkgfHwgZ3VhcmQgPyAxIDogbikpOwogIH07CgogIC8vIEdldCB0aGUgbGFzdCBlbGVtZW50IG9mIGFuIGFycmF5LiBQYXNzaW5nICoqbioqIHdpbGwgcmV0dXJuIHRoZSBsYXN0IE4KICAvLyB2YWx1ZXMgaW4gdGhlIGFycmF5LiBUaGUgKipndWFyZCoqIGNoZWNrIGFsbG93cyBpdCB0byB3b3JrIHdpdGggYF8ubWFwYC4KICBfLmxhc3QgPSBmdW5jdGlvbihhcnJheSwgbiwgZ3VhcmQpIHsKICAgIGlmIChhcnJheSA9PSBudWxsKSByZXR1cm4gdm9pZCAwOwogICAgaWYgKChuID09IG51bGwpIHx8IGd1YXJkKSByZXR1cm4gYXJyYXlbYXJyYXkubGVuZ3RoIC0gMV07CiAgICByZXR1cm4gc2xpY2UuY2FsbChhcnJheSwgTWF0aC5tYXgoYXJyYXkubGVuZ3RoIC0gbiwgMCkpOwogIH07CgogIC8vIFJldHVybnMgZXZlcnl0aGluZyBidXQgdGhlIGZpcnN0IGVudHJ5IG9mIHRoZSBhcnJheS4gQWxpYXNlZCBhcyBgdGFpbGAgYW5kIGBkcm9wYC4KICAvLyBFc3BlY2lhbGx5IHVzZWZ1bCBvbiB0aGUgYXJndW1lbnRzIG9iamVjdC4gUGFzc2luZyBhbiAqKm4qKiB3aWxsIHJldHVybgogIC8vIHRoZSByZXN0IE4gdmFsdWVzIGluIHRoZSBhcnJheS4gVGhlICoqZ3VhcmQqKgogIC8vIGNoZWNrIGFsbG93cyBpdCB0byB3b3JrIHdpdGggYF8ubWFwYC4KICBfLnJlc3QgPSBfLnRhaWwgPSBfLmRyb3AgPSBmdW5jdGlvbihhcnJheSwgbiwgZ3VhcmQpIHsKICAgIHJldHVybiBzbGljZS5jYWxsKGFycmF5LCAobiA9PSBudWxsKSB8fCBndWFyZCA/IDEgOiBuKTsKICB9OwoKICAvLyBUcmltIG91dCBhbGwgZmFsc3kgdmFsdWVzIGZyb20gYW4gYXJyYXkuCiAgXy5jb21wYWN0ID0gZnVuY3Rpb24oYXJyYXkpIHsKICAgIHJldHVybiBfLmZpbHRlcihhcnJheSwgXy5pZGVudGl0eSk7CiAgfTsKCiAgLy8gSW50ZXJuYWwgaW1wbGVtZW50YXRpb24gb2YgYSByZWN1cnNpdmUgYGZsYXR0ZW5gIGZ1bmN0aW9uLgogIHZhciBmbGF0dGVuID0gZnVuY3Rpb24oaW5wdXQsIHNoYWxsb3csIG91dHB1dCkgewogICAgaWYgKHNoYWxsb3cgJiYgXy5ldmVyeShpbnB1dCwgXy5pc0FycmF5KSkgewogICAgICByZXR1cm4gY29uY2F0LmFwcGx5KG91dHB1dCwgaW5wdXQpOwogICAgfQogICAgZWFjaChpbnB1dCwgZnVuY3Rpb24odmFsdWUpIHsKICAgICAgaWYgKF8uaXNBcnJheSh2YWx1ZSkgfHwgXy5pc0FyZ3VtZW50cyh2YWx1ZSkpIHsKICAgICAgICBzaGFsbG93ID8gcHVzaC5hcHBseShvdXRwdXQsIHZhbHVlKSA6IGZsYXR0ZW4odmFsdWUsIHNoYWxsb3csIG91dHB1dCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgb3V0cHV0LnB1c2godmFsdWUpOwogICAgICB9CiAgICB9KTsKICAgIHJldHVybiBvdXRwdXQ7CiAgfTsKCiAgLy8gRmxhdHRlbiBvdXQgYW4gYXJyYXksIGVpdGhlciByZWN1cnNpdmVseSAoYnkgZGVmYXVsdCksIG9yIGp1c3Qgb25lIGxldmVsLgogIF8uZmxhdHRlbiA9IGZ1bmN0aW9uKGFycmF5LCBzaGFsbG93KSB7CiAgICByZXR1cm4gZmxhdHRlbihhcnJheSwgc2hhbGxvdywgW10pOwogIH07CgogIC8vIFJldHVybiBhIHZlcnNpb24gb2YgdGhlIGFycmF5IHRoYXQgZG9lcyBub3QgY29udGFpbiB0aGUgc3BlY2lmaWVkIHZhbHVlKHMpLgogIF8ud2l0aG91dCA9IGZ1bmN0aW9uKGFycmF5KSB7CiAgICByZXR1cm4gXy5kaWZmZXJlbmNlKGFycmF5LCBzbGljZS5jYWxsKGFyZ3VtZW50cywgMSkpOwogIH07CgogIC8vIFNwbGl0IGFuIGFycmF5IGludG8gdHdvIGFycmF5czogb25lIHdob3NlIGVsZW1lbnRzIGFsbCBzYXRpc2Z5IHRoZSBnaXZlbgogIC8vIHByZWRpY2F0ZSwgYW5kIG9uZSB3aG9zZSBlbGVtZW50cyBhbGwgZG8gbm90IHNhdGlzZnkgdGhlIHByZWRpY2F0ZS4KICBfLnBhcnRpdGlvbiA9IGZ1bmN0aW9uKGFycmF5LCBwcmVkaWNhdGUpIHsKICAgIHZhciBwYXNzID0gW10sIGZhaWwgPSBbXTsKICAgIGVhY2goYXJyYXksIGZ1bmN0aW9uKGVsZW0pIHsKICAgICAgKHByZWRpY2F0ZShlbGVtKSA/IHBhc3MgOiBmYWlsKS5wdXNoKGVsZW0pOwogICAgfSk7CiAgICByZXR1cm4gW3Bhc3MsIGZhaWxdOwogIH07CgogIC8vIFByb2R1Y2UgYSBkdXBsaWNhdGUtZnJlZSB2ZXJzaW9uIG9mIHRoZSBhcnJheS4gSWYgdGhlIGFycmF5IGhhcyBhbHJlYWR5CiAgLy8gYmVlbiBzb3J0ZWQsIHlvdSBoYXZlIHRoZSBvcHRpb24gb2YgdXNpbmcgYSBmYXN0ZXIgYWxnb3JpdGhtLgogIC8vIEFsaWFzZWQgYXMgYHVuaXF1ZWAuCiAgXy51bmlxID0gXy51bmlxdWUgPSBmdW5jdGlvbihhcnJheSwgaXNTb3J0ZWQsIGl0ZXJhdG9yLCBjb250ZXh0KSB7CiAgICBpZiAoXy5pc0Z1bmN0aW9uKGlzU29ydGVkKSkgewogICAgICBjb250ZXh0ID0gaXRlcmF0b3I7CiAgICAgIGl0ZXJhdG9yID0gaXNTb3J0ZWQ7CiAgICAgIGlzU29ydGVkID0gZmFsc2U7CiAgICB9CiAgICB2YXIgaW5pdGlhbCA9IGl0ZXJhdG9yID8gXy5tYXAoYXJyYXksIGl0ZXJhdG9yLCBjb250ZXh0KSA6IGFycmF5OwogICAgdmFyIHJlc3VsdHMgPSBbXTsKICAgIHZhciBzZWVuID0gW107CiAgICBlYWNoKGluaXRpYWwsIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCkgewogICAgICBpZiAoaXNTb3J0ZWQgPyAoIWluZGV4IHx8IHNlZW5bc2Vlbi5sZW5ndGggLSAxXSAhPT0gdmFsdWUpIDogIV8uY29udGFpbnMoc2VlbiwgdmFsdWUpKSB7CiAgICAgICAgc2Vlbi5wdXNoKHZhbHVlKTsKICAgICAgICByZXN1bHRzLnB1c2goYXJyYXlbaW5kZXhdKTsKICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gcmVzdWx0czsKICB9OwoKICAvLyBQcm9kdWNlIGFuIGFycmF5IHRoYXQgY29udGFpbnMgdGhlIHVuaW9uOiBlYWNoIGRpc3RpbmN0IGVsZW1lbnQgZnJvbSBhbGwgb2YKICAvLyB0aGUgcGFzc2VkLWluIGFycmF5cy4KICBfLnVuaW9uID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gXy51bmlxKF8uZmxhdHRlbihhcmd1bWVudHMsIHRydWUpKTsKICB9OwoKICAvLyBQcm9kdWNlIGFuIGFycmF5IHRoYXQgY29udGFpbnMgZXZlcnkgaXRlbSBzaGFyZWQgYmV0d2VlbiBhbGwgdGhlCiAgLy8gcGFzc2VkLWluIGFycmF5cy4KICBfLmludGVyc2VjdGlvbiA9IGZ1bmN0aW9uKGFycmF5KSB7CiAgICB2YXIgcmVzdCA9IHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKICAgIHJldHVybiBfLmZpbHRlcihfLnVuaXEoYXJyYXkpLCBmdW5jdGlvbihpdGVtKSB7CiAgICAgIHJldHVybiBfLmV2ZXJ5KHJlc3QsIGZ1bmN0aW9uKG90aGVyKSB7CiAgICAgICAgcmV0dXJuIF8uY29udGFpbnMob3RoZXIsIGl0ZW0pOwogICAgICB9KTsKICAgIH0pOwogIH07CgogIC8vIFRha2UgdGhlIGRpZmZlcmVuY2UgYmV0d2VlbiBvbmUgYXJyYXkgYW5kIGEgbnVtYmVyIG9mIG90aGVyIGFycmF5cy4KICAvLyBPbmx5IHRoZSBlbGVtZW50cyBwcmVzZW50IGluIGp1c3QgdGhlIGZpcnN0IGFycmF5IHdpbGwgcmVtYWluLgogIF8uZGlmZmVyZW5jZSA9IGZ1bmN0aW9uKGFycmF5KSB7CiAgICB2YXIgcmVzdCA9IGNvbmNhdC5hcHBseShBcnJheVByb3RvLCBzbGljZS5jYWxsKGFyZ3VtZW50cywgMSkpOwogICAgcmV0dXJuIF8uZmlsdGVyKGFycmF5LCBmdW5jdGlvbih2YWx1ZSl7IHJldHVybiAhXy5jb250YWlucyhyZXN0LCB2YWx1ZSk7IH0pOwogIH07CgogIC8vIFppcCB0b2dldGhlciBtdWx0aXBsZSBsaXN0cyBpbnRvIGEgc2luZ2xlIGFycmF5IC0tIGVsZW1lbnRzIHRoYXQgc2hhcmUKICAvLyBhbiBpbmRleCBnbyB0b2dldGhlci4KICBfLnppcCA9IGZ1bmN0aW9uKCkgewogICAgdmFyIGxlbmd0aCA9IF8ubWF4KF8ucGx1Y2soYXJndW1lbnRzLCAnbGVuZ3RoJykuY29uY2F0KDApKTsKICAgIHZhciByZXN1bHRzID0gbmV3IEFycmF5KGxlbmd0aCk7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgIHJlc3VsdHNbaV0gPSBfLnBsdWNrKGFyZ3VtZW50cywgJycgKyBpKTsKICAgIH0KICAgIHJldHVybiByZXN1bHRzOwogIH07CgogIC8vIENvbnZlcnRzIGxpc3RzIGludG8gb2JqZWN0cy4gUGFzcyBlaXRoZXIgYSBzaW5nbGUgYXJyYXkgb2YgYFtrZXksIHZhbHVlXWAKICAvLyBwYWlycywgb3IgdHdvIHBhcmFsbGVsIGFycmF5cyBvZiB0aGUgc2FtZSBsZW5ndGggLS0gb25lIG9mIGtleXMsIGFuZCBvbmUgb2YKICAvLyB0aGUgY29ycmVzcG9uZGluZyB2YWx1ZXMuCiAgXy5vYmplY3QgPSBmdW5jdGlvbihsaXN0LCB2YWx1ZXMpIHsKICAgIGlmIChsaXN0ID09IG51bGwpIHJldHVybiB7fTsKICAgIHZhciByZXN1bHQgPSB7fTsKICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBsaXN0Lmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgIGlmICh2YWx1ZXMpIHsKICAgICAgICByZXN1bHRbbGlzdFtpXV0gPSB2YWx1ZXNbaV07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmVzdWx0W2xpc3RbaV1bMF1dID0gbGlzdFtpXVsxXTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9OwoKICAvLyBJZiB0aGUgYnJvd3NlciBkb2Vzbid0IHN1cHBseSB1cyB3aXRoIGluZGV4T2YgKEknbSBsb29raW5nIGF0IHlvdSwgKipNU0lFKiopLAogIC8vIHdlIG5lZWQgdGhpcyBmdW5jdGlvbi4gUmV0dXJuIHRoZSBwb3NpdGlvbiBvZiB0aGUgZmlyc3Qgb2NjdXJyZW5jZSBvZiBhbgogIC8vIGl0ZW0gaW4gYW4gYXJyYXksIG9yIC0xIGlmIHRoZSBpdGVtIGlzIG5vdCBpbmNsdWRlZCBpbiB0aGUgYXJyYXkuCiAgLy8gRGVsZWdhdGVzIHRvICoqRUNNQVNjcmlwdCA1KioncyBuYXRpdmUgYGluZGV4T2ZgIGlmIGF2YWlsYWJsZS4KICAvLyBJZiB0aGUgYXJyYXkgaXMgbGFyZ2UgYW5kIGFscmVhZHkgaW4gc29ydCBvcmRlciwgcGFzcyBgdHJ1ZWAKICAvLyBmb3IgKippc1NvcnRlZCoqIHRvIHVzZSBiaW5hcnkgc2VhcmNoLgogIF8uaW5kZXhPZiA9IGZ1bmN0aW9uKGFycmF5LCBpdGVtLCBpc1NvcnRlZCkgewogICAgaWYgKGFycmF5ID09IG51bGwpIHJldHVybiAtMTsKICAgIHZhciBpID0gMCwgbGVuZ3RoID0gYXJyYXkubGVuZ3RoOwogICAgaWYgKGlzU29ydGVkKSB7CiAgICAgIGlmICh0eXBlb2YgaXNTb3J0ZWQgPT0gJ251bWJlcicpIHsKICAgICAgICBpID0gKGlzU29ydGVkIDwgMCA/IE1hdGgubWF4KDAsIGxlbmd0aCArIGlzU29ydGVkKSA6IGlzU29ydGVkKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpID0gXy5zb3J0ZWRJbmRleChhcnJheSwgaXRlbSk7CiAgICAgICAgcmV0dXJuIGFycmF5W2ldID09PSBpdGVtID8gaSA6IC0xOwogICAgICB9CiAgICB9CiAgICBpZiAobmF0aXZlSW5kZXhPZiAmJiBhcnJheS5pbmRleE9mID09PSBuYXRpdmVJbmRleE9mKSByZXR1cm4gYXJyYXkuaW5kZXhPZihpdGVtLCBpc1NvcnRlZCk7CiAgICBmb3IgKDsgaSA8IGxlbmd0aDsgaSsrKSBpZiAoYXJyYXlbaV0gPT09IGl0ZW0pIHJldHVybiBpOwogICAgcmV0dXJuIC0xOwogIH07CgogIC8vIERlbGVnYXRlcyB0byAqKkVDTUFTY3JpcHQgNSoqJ3MgbmF0aXZlIGBsYXN0SW5kZXhPZmAgaWYgYXZhaWxhYmxlLgogIF8ubGFzdEluZGV4T2YgPSBmdW5jdGlvbihhcnJheSwgaXRlbSwgZnJvbSkgewogICAgaWYgKGFycmF5ID09IG51bGwpIHJldHVybiAtMTsKICAgIHZhciBoYXNJbmRleCA9IGZyb20gIT0gbnVsbDsKICAgIGlmIChuYXRpdmVMYXN0SW5kZXhPZiAmJiBhcnJheS5sYXN0SW5kZXhPZiA9PT0gbmF0aXZlTGFzdEluZGV4T2YpIHsKICAgICAgcmV0dXJuIGhhc0luZGV4ID8gYXJyYXkubGFzdEluZGV4T2YoaXRlbSwgZnJvbSkgOiBhcnJheS5sYXN0SW5kZXhPZihpdGVtKTsKICAgIH0KICAgIHZhciBpID0gKGhhc0luZGV4ID8gZnJvbSA6IGFycmF5Lmxlbmd0aCk7CiAgICB3aGlsZSAoaS0tKSBpZiAoYXJyYXlbaV0gPT09IGl0ZW0pIHJldHVybiBpOwogICAgcmV0dXJuIC0xOwogIH07CgogIC8vIEdlbmVyYXRlIGFuIGludGVnZXIgQXJyYXkgY29udGFpbmluZyBhbiBhcml0aG1ldGljIHByb2dyZXNzaW9uLiBBIHBvcnQgb2YKICAvLyB0aGUgbmF0aXZlIFB5dGhvbiBgcmFuZ2UoKWAgZnVuY3Rpb24uIFNlZQogIC8vIFt0aGUgUHl0aG9uIGRvY3VtZW50YXRpb25dKGh0dHA6Ly9kb2NzLnB5dGhvbi5vcmcvbGlicmFyeS9mdW5jdGlvbnMuaHRtbCNyYW5nZSkuCiAgXy5yYW5nZSA9IGZ1bmN0aW9uKHN0YXJ0LCBzdG9wLCBzdGVwKSB7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8PSAxKSB7CiAgICAgIHN0b3AgPSBzdGFydCB8fCAwOwogICAgICBzdGFydCA9IDA7CiAgICB9CiAgICBzdGVwID0gYXJndW1lbnRzWzJdIHx8IDE7CgogICAgdmFyIGxlbmd0aCA9IE1hdGgubWF4KE1hdGguY2VpbCgoc3RvcCAtIHN0YXJ0KSAvIHN0ZXApLCAwKTsKICAgIHZhciBpZHggPSAwOwogICAgdmFyIHJhbmdlID0gbmV3IEFycmF5KGxlbmd0aCk7CgogICAgd2hpbGUoaWR4IDwgbGVuZ3RoKSB7CiAgICAgIHJhbmdlW2lkeCsrXSA9IHN0YXJ0OwogICAgICBzdGFydCArPSBzdGVwOwogICAgfQoKICAgIHJldHVybiByYW5nZTsKICB9OwoKICAvLyBGdW5jdGlvbiAoYWhlbSkgRnVuY3Rpb25zCiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tCgogIC8vIFJldXNhYmxlIGNvbnN0cnVjdG9yIGZ1bmN0aW9uIGZvciBwcm90b3R5cGUgc2V0dGluZy4KICB2YXIgY3RvciA9IGZ1bmN0aW9uKCl7fTsKCiAgLy8gQ3JlYXRlIGEgZnVuY3Rpb24gYm91bmQgdG8gYSBnaXZlbiBvYmplY3QgKGFzc2lnbmluZyBgdGhpc2AsIGFuZCBhcmd1bWVudHMsCiAgLy8gb3B0aW9uYWxseSkuIERlbGVnYXRlcyB0byAqKkVDTUFTY3JpcHQgNSoqJ3MgbmF0aXZlIGBGdW5jdGlvbi5iaW5kYCBpZgogIC8vIGF2YWlsYWJsZS4KICBfLmJpbmQgPSBmdW5jdGlvbihmdW5jLCBjb250ZXh0KSB7CiAgICB2YXIgYXJncywgYm91bmQ7CiAgICBpZiAobmF0aXZlQmluZCAmJiBmdW5jLmJpbmQgPT09IG5hdGl2ZUJpbmQpIHJldHVybiBuYXRpdmVCaW5kLmFwcGx5KGZ1bmMsIHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSk7CiAgICBpZiAoIV8uaXNGdW5jdGlvbihmdW5jKSkgdGhyb3cgbmV3IFR5cGVFcnJvcjsKICAgIGFyZ3MgPSBzbGljZS5jYWxsKGFyZ3VtZW50cywgMik7CiAgICByZXR1cm4gYm91bmQgPSBmdW5jdGlvbigpIHsKICAgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIGJvdW5kKSkgcmV0dXJuIGZ1bmMuYXBwbHkoY29udGV4dCwgYXJncy5jb25jYXQoc2xpY2UuY2FsbChhcmd1bWVudHMpKSk7CiAgICAgIGN0b3IucHJvdG90eXBlID0gZnVuYy5wcm90b3R5cGU7CiAgICAgIHZhciBzZWxmID0gbmV3IGN0b3I7CiAgICAgIGN0b3IucHJvdG90eXBlID0gbnVsbDsKICAgICAgdmFyIHJlc3VsdCA9IGZ1bmMuYXBwbHkoc2VsZiwgYXJncy5jb25jYXQoc2xpY2UuY2FsbChhcmd1bWVudHMpKSk7CiAgICAgIGlmIChPYmplY3QocmVzdWx0KSA9PT0gcmVzdWx0KSByZXR1cm4gcmVzdWx0OwogICAgICByZXR1cm4gc2VsZjsKICAgIH07CiAgfTsKCiAgLy8gUGFydGlhbGx5IGFwcGx5IGEgZnVuY3Rpb24gYnkgY3JlYXRpbmcgYSB2ZXJzaW9uIHRoYXQgaGFzIGhhZCBzb21lIG9mIGl0cwogIC8vIGFyZ3VtZW50cyBwcmUtZmlsbGVkLCB3aXRob3V0IGNoYW5naW5nIGl0cyBkeW5hbWljIGB0aGlzYCBjb250ZXh0LiBfIGFjdHMKICAvLyBhcyBhIHBsYWNlaG9sZGVyLCBhbGxvd2luZyBhbnkgY29tYmluYXRpb24gb2YgYXJndW1lbnRzIHRvIGJlIHByZS1maWxsZWQuCiAgXy5wYXJ0aWFsID0gZnVuY3Rpb24oZnVuYykgewogICAgdmFyIGJvdW5kQXJncyA9IHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgdmFyIHBvc2l0aW9uID0gMDsKICAgICAgdmFyIGFyZ3MgPSBib3VuZEFyZ3Muc2xpY2UoKTsKICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IGFyZ3MubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAoYXJnc1tpXSA9PT0gXykgYXJnc1tpXSA9IGFyZ3VtZW50c1twb3NpdGlvbisrXTsKICAgICAgfQogICAgICB3aGlsZSAocG9zaXRpb24gPCBhcmd1bWVudHMubGVuZ3RoKSBhcmdzLnB1c2goYXJndW1lbnRzW3Bvc2l0aW9uKytdKTsKICAgICAgcmV0dXJuIGZ1bmMuYXBwbHkodGhpcywgYXJncyk7CiAgICB9OwogIH07CgogIC8vIEJpbmQgYSBudW1iZXIgb2YgYW4gb2JqZWN0J3MgbWV0aG9kcyB0byB0aGF0IG9iamVjdC4gUmVtYWluaW5nIGFyZ3VtZW50cwogIC8vIGFyZSB0aGUgbWV0aG9kIG5hbWVzIHRvIGJlIGJvdW5kLiBVc2VmdWwgZm9yIGVuc3VyaW5nIHRoYXQgYWxsIGNhbGxiYWNrcwogIC8vIGRlZmluZWQgb24gYW4gb2JqZWN0IGJlbG9uZyB0byBpdC4KICBfLmJpbmRBbGwgPSBmdW5jdGlvbihvYmopIHsKICAgIHZhciBmdW5jcyA9IHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKICAgIGlmIChmdW5jcy5sZW5ndGggPT09IDApIHRocm93IG5ldyBFcnJvcignYmluZEFsbCBtdXN0IGJlIHBhc3NlZCBmdW5jdGlvbiBuYW1lcycpOwogICAgZWFjaChmdW5jcywgZnVuY3Rpb24oZikgeyBvYmpbZl0gPSBfLmJpbmQob2JqW2ZdLCBvYmopOyB9KTsKICAgIHJldHVybiBvYmo7CiAgfTsKCiAgLy8gTWVtb2l6ZSBhbiBleHBlbnNpdmUgZnVuY3Rpb24gYnkgc3RvcmluZyBpdHMgcmVzdWx0cy4KICBfLm1lbW9pemUgPSBmdW5jdGlvbihmdW5jLCBoYXNoZXIpIHsKICAgIHZhciBtZW1vID0ge307CiAgICBoYXNoZXIgfHwgKGhhc2hlciA9IF8uaWRlbnRpdHkpOwogICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICB2YXIga2V5ID0gaGFzaGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIHJldHVybiBfLmhhcyhtZW1vLCBrZXkpID8gbWVtb1trZXldIDogKG1lbW9ba2V5XSA9IGZ1bmMuYXBwbHkodGhpcywgYXJndW1lbnRzKSk7CiAgICB9OwogIH07CgogIC8vIERlbGF5cyBhIGZ1bmN0aW9uIGZvciB0aGUgZ2l2ZW4gbnVtYmVyIG9mIG1pbGxpc2Vjb25kcywgYW5kIHRoZW4gY2FsbHMKICAvLyBpdCB3aXRoIHRoZSBhcmd1bWVudHMgc3VwcGxpZWQuCiAgXy5kZWxheSA9IGZ1bmN0aW9uKGZ1bmMsIHdhaXQpIHsKICAgIHZhciBhcmdzID0gc2xpY2UuY2FsbChhcmd1bWVudHMsIDIpOwogICAgcmV0dXJuIHNldFRpbWVvdXQoZnVuY3Rpb24oKXsgcmV0dXJuIGZ1bmMuYXBwbHkobnVsbCwgYXJncyk7IH0sIHdhaXQpOwogIH07CgogIC8vIERlZmVycyBhIGZ1bmN0aW9uLCBzY2hlZHVsaW5nIGl0IHRvIHJ1biBhZnRlciB0aGUgY3VycmVudCBjYWxsIHN0YWNrIGhhcwogIC8vIGNsZWFyZWQuCiAgXy5kZWZlciA9IGZ1bmN0aW9uKGZ1bmMpIHsKICAgIHJldHVybiBfLmRlbGF5LmFwcGx5KF8sIFtmdW5jLCAxXS5jb25jYXQoc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpKSk7CiAgfTsKCiAgLy8gUmV0dXJucyBhIGZ1bmN0aW9uLCB0aGF0LCB3aGVuIGludm9rZWQsIHdpbGwgb25seSBiZSB0cmlnZ2VyZWQgYXQgbW9zdCBvbmNlCiAgLy8gZHVyaW5nIGEgZ2l2ZW4gd2luZG93IG9mIHRpbWUuIE5vcm1hbGx5LCB0aGUgdGhyb3R0bGVkIGZ1bmN0aW9uIHdpbGwgcnVuCiAgLy8gYXMgbXVjaCBhcyBpdCBjYW4sIHdpdGhvdXQgZXZlciBnb2luZyBtb3JlIHRoYW4gb25jZSBwZXIgYHdhaXRgIGR1cmF0aW9uOwogIC8vIGJ1dCBpZiB5b3UnZCBsaWtlIHRvIGRpc2FibGUgdGhlIGV4ZWN1dGlvbiBvbiB0aGUgbGVhZGluZyBlZGdlLCBwYXNzCiAgLy8gYHtsZWFkaW5nOiBmYWxzZX1gLiBUbyBkaXNhYmxlIGV4ZWN1dGlvbiBvbiB0aGUgdHJhaWxpbmcgZWRnZSwgZGl0dG8uCiAgXy50aHJvdHRsZSA9IGZ1bmN0aW9uKGZ1bmMsIHdhaXQsIG9wdGlvbnMpIHsKICAgIHZhciBjb250ZXh0LCBhcmdzLCByZXN1bHQ7CiAgICB2YXIgdGltZW91dCA9IG51bGw7CiAgICB2YXIgcHJldmlvdXMgPSAwOwogICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTsKICAgIHZhciBsYXRlciA9IGZ1bmN0aW9uKCkgewogICAgICBwcmV2aW91cyA9IG9wdGlvbnMubGVhZGluZyA9PT0gZmFsc2UgPyAwIDogXy5ub3coKTsKICAgICAgdGltZW91dCA9IG51bGw7CiAgICAgIHJlc3VsdCA9IGZ1bmMuYXBwbHkoY29udGV4dCwgYXJncyk7CiAgICAgIGNvbnRleHQgPSBhcmdzID0gbnVsbDsKICAgIH07CiAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBub3cgPSBfLm5vdygpOwogICAgICBpZiAoIXByZXZpb3VzICYmIG9wdGlvbnMubGVhZGluZyA9PT0gZmFsc2UpIHByZXZpb3VzID0gbm93OwogICAgICB2YXIgcmVtYWluaW5nID0gd2FpdCAtIChub3cgLSBwcmV2aW91cyk7CiAgICAgIGNvbnRleHQgPSB0aGlzOwogICAgICBhcmdzID0gYXJndW1lbnRzOwogICAgICBpZiAocmVtYWluaW5nIDw9IDApIHsKICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dCk7CiAgICAgICAgdGltZW91dCA9IG51bGw7CiAgICAgICAgcHJldmlvdXMgPSBub3c7CiAgICAgICAgcmVzdWx0ID0gZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTsKICAgICAgICBjb250ZXh0ID0gYXJncyA9IG51bGw7CiAgICAgIH0gZWxzZSBpZiAoIXRpbWVvdXQgJiYgb3B0aW9ucy50cmFpbGluZyAhPT0gZmFsc2UpIHsKICAgICAgICB0aW1lb3V0ID0gc2V0VGltZW91dChsYXRlciwgcmVtYWluaW5nKTsKICAgICAgfQogICAgICByZXR1cm4gcmVzdWx0OwogICAgfTsKICB9OwoKICAvLyBSZXR1cm5zIGEgZnVuY3Rpb24sIHRoYXQsIGFzIGxvbmcgYXMgaXQgY29udGludWVzIHRvIGJlIGludm9rZWQsIHdpbGwgbm90CiAgLy8gYmUgdHJpZ2dlcmVkLiBUaGUgZnVuY3Rpb24gd2lsbCBiZSBjYWxsZWQgYWZ0ZXIgaXQgc3RvcHMgYmVpbmcgY2FsbGVkIGZvcgogIC8vIE4gbWlsbGlzZWNvbmRzLiBJZiBgaW1tZWRpYXRlYCBpcyBwYXNzZWQsIHRyaWdnZXIgdGhlIGZ1bmN0aW9uIG9uIHRoZQogIC8vIGxlYWRpbmcgZWRnZSwgaW5zdGVhZCBvZiB0aGUgdHJhaWxpbmcuCiAgXy5kZWJvdW5jZSA9IGZ1bmN0aW9uKGZ1bmMsIHdhaXQsIGltbWVkaWF0ZSkgewogICAgdmFyIHRpbWVvdXQsIGFyZ3MsIGNvbnRleHQsIHRpbWVzdGFtcCwgcmVzdWx0OwoKICAgIHZhciBsYXRlciA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgbGFzdCA9IF8ubm93KCkgLSB0aW1lc3RhbXA7CiAgICAgIGlmIChsYXN0IDwgd2FpdCkgewogICAgICAgIHRpbWVvdXQgPSBzZXRUaW1lb3V0KGxhdGVyLCB3YWl0IC0gbGFzdCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGltZW91dCA9IG51bGw7CiAgICAgICAgaWYgKCFpbW1lZGlhdGUpIHsKICAgICAgICAgIHJlc3VsdCA9IGZ1bmMuYXBwbHkoY29udGV4dCwgYXJncyk7CiAgICAgICAgICBjb250ZXh0ID0gYXJncyA9IG51bGw7CiAgICAgICAgfQogICAgICB9CiAgICB9OwoKICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgY29udGV4dCA9IHRoaXM7CiAgICAgIGFyZ3MgPSBhcmd1bWVudHM7CiAgICAgIHRpbWVzdGFtcCA9IF8ubm93KCk7CiAgICAgIHZhciBjYWxsTm93ID0gaW1tZWRpYXRlICYmICF0aW1lb3V0OwogICAgICBpZiAoIXRpbWVvdXQpIHsKICAgICAgICB0aW1lb3V0ID0gc2V0VGltZW91dChsYXRlciwgd2FpdCk7CiAgICAgIH0KICAgICAgaWYgKGNhbGxOb3cpIHsKICAgICAgICByZXN1bHQgPSBmdW5jLmFwcGx5KGNvbnRleHQsIGFyZ3MpOwogICAgICAgIGNvbnRleHQgPSBhcmdzID0gbnVsbDsKICAgICAgfQoKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH07CiAgfTsKCiAgLy8gUmV0dXJucyBhIGZ1bmN0aW9uIHRoYXQgd2lsbCBiZSBleGVjdXRlZCBhdCBtb3N0IG9uZSB0aW1lLCBubyBtYXR0ZXIgaG93CiAgLy8gb2Z0ZW4geW91IGNhbGwgaXQuIFVzZWZ1bCBmb3IgbGF6eSBpbml0aWFsaXphdGlvbi4KICBfLm9uY2UgPSBmdW5jdGlvbihmdW5jKSB7CiAgICB2YXIgcmFuID0gZmFsc2UsIG1lbW87CiAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgIGlmIChyYW4pIHJldHVybiBtZW1vOwogICAgICByYW4gPSB0cnVlOwogICAgICBtZW1vID0gZnVuYy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICBmdW5jID0gbnVsbDsKICAgICAgcmV0dXJuIG1lbW87CiAgICB9OwogIH07CgogIC8vIFJldHVybnMgdGhlIGZpcnN0IGZ1bmN0aW9uIHBhc3NlZCBhcyBhbiBhcmd1bWVudCB0byB0aGUgc2Vjb25kLAogIC8vIGFsbG93aW5nIHlvdSB0byBhZGp1c3QgYXJndW1lbnRzLCBydW4gY29kZSBiZWZvcmUgYW5kIGFmdGVyLCBhbmQKICAvLyBjb25kaXRpb25hbGx5IGV4ZWN1dGUgdGhlIG9yaWdpbmFsIGZ1bmN0aW9uLgogIF8ud3JhcCA9IGZ1bmN0aW9uKGZ1bmMsIHdyYXBwZXIpIHsKICAgIHJldHVybiBfLnBhcnRpYWwod3JhcHBlciwgZnVuYyk7CiAgfTsKCiAgLy8gUmV0dXJucyBhIGZ1bmN0aW9uIHRoYXQgaXMgdGhlIGNvbXBvc2l0aW9uIG9mIGEgbGlzdCBvZiBmdW5jdGlvbnMsIGVhY2gKICAvLyBjb25zdW1pbmcgdGhlIHJldHVybiB2YWx1ZSBvZiB0aGUgZnVuY3Rpb24gdGhhdCBmb2xsb3dzLgogIF8uY29tcG9zZSA9IGZ1bmN0aW9uKCkgewogICAgdmFyIGZ1bmNzID0gYXJndW1lbnRzOwogICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICB2YXIgYXJncyA9IGFyZ3VtZW50czsKICAgICAgZm9yICh2YXIgaSA9IGZ1bmNzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgYXJncyA9IFtmdW5jc1tpXS5hcHBseSh0aGlzLCBhcmdzKV07CiAgICAgIH0KICAgICAgcmV0dXJuIGFyZ3NbMF07CiAgICB9OwogIH07CgogIC8vIFJldHVybnMgYSBmdW5jdGlvbiB0aGF0IHdpbGwgb25seSBiZSBleGVjdXRlZCBhZnRlciBiZWluZyBjYWxsZWQgTiB0aW1lcy4KICBfLmFmdGVyID0gZnVuY3Rpb24odGltZXMsIGZ1bmMpIHsKICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgaWYgKC0tdGltZXMgPCAxKSB7CiAgICAgICAgcmV0dXJuIGZ1bmMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQogICAgfTsKICB9OwoKICAvLyBPYmplY3QgRnVuY3Rpb25zCiAgLy8gLS0tLS0tLS0tLS0tLS0tLQoKICAvLyBSZXRyaWV2ZSB0aGUgbmFtZXMgb2YgYW4gb2JqZWN0J3MgcHJvcGVydGllcy4KICAvLyBEZWxlZ2F0ZXMgdG8gKipFQ01BU2NyaXB0IDUqKidzIG5hdGl2ZSBgT2JqZWN0LmtleXNgCiAgXy5rZXlzID0gZnVuY3Rpb24ob2JqKSB7CiAgICBpZiAoIV8uaXNPYmplY3Qob2JqKSkgcmV0dXJuIFtdOwogICAgaWYgKG5hdGl2ZUtleXMpIHJldHVybiBuYXRpdmVLZXlzKG9iaik7CiAgICB2YXIga2V5cyA9IFtdOwogICAgZm9yICh2YXIga2V5IGluIG9iaikgaWYgKF8uaGFzKG9iaiwga2V5KSkga2V5cy5wdXNoKGtleSk7CiAgICByZXR1cm4ga2V5czsKICB9OwoKICAvLyBSZXRyaWV2ZSB0aGUgdmFsdWVzIG9mIGFuIG9iamVjdCdzIHByb3BlcnRpZXMuCiAgXy52YWx1ZXMgPSBmdW5jdGlvbihvYmopIHsKICAgIHZhciBrZXlzID0gXy5rZXlzKG9iaik7CiAgICB2YXIgbGVuZ3RoID0ga2V5cy5sZW5ndGg7CiAgICB2YXIgdmFsdWVzID0gbmV3IEFycmF5KGxlbmd0aCk7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgIHZhbHVlc1tpXSA9IG9ialtrZXlzW2ldXTsKICAgIH0KICAgIHJldHVybiB2YWx1ZXM7CiAgfTsKCiAgLy8gQ29udmVydCBhbiBvYmplY3QgaW50byBhIGxpc3Qgb2YgYFtrZXksIHZhbHVlXWAgcGFpcnMuCiAgXy5wYWlycyA9IGZ1bmN0aW9uKG9iaikgewogICAgdmFyIGtleXMgPSBfLmtleXMob2JqKTsKICAgIHZhciBsZW5ndGggPSBrZXlzLmxlbmd0aDsKICAgIHZhciBwYWlycyA9IG5ldyBBcnJheShsZW5ndGgpOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICBwYWlyc1tpXSA9IFtrZXlzW2ldLCBvYmpba2V5c1tpXV1dOwogICAgfQogICAgcmV0dXJuIHBhaXJzOwogIH07CgogIC8vIEludmVydCB0aGUga2V5cyBhbmQgdmFsdWVzIG9mIGFuIG9iamVjdC4gVGhlIHZhbHVlcyBtdXN0IGJlIHNlcmlhbGl6YWJsZS4KICBfLmludmVydCA9IGZ1bmN0aW9uKG9iaikgewogICAgdmFyIHJlc3VsdCA9IHt9OwogICAgdmFyIGtleXMgPSBfLmtleXMob2JqKTsKICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBrZXlzLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgIHJlc3VsdFtvYmpba2V5c1tpXV1dID0ga2V5c1tpXTsKICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfTsKCiAgLy8gUmV0dXJuIGEgc29ydGVkIGxpc3Qgb2YgdGhlIGZ1bmN0aW9uIG5hbWVzIGF2YWlsYWJsZSBvbiB0aGUgb2JqZWN0LgogIC8vIEFsaWFzZWQgYXMgYG1ldGhvZHNgCiAgXy5mdW5jdGlvbnMgPSBfLm1ldGhvZHMgPSBmdW5jdGlvbihvYmopIHsKICAgIHZhciBuYW1lcyA9IFtdOwogICAgZm9yICh2YXIga2V5IGluIG9iaikgewogICAgICBpZiAoXy5pc0Z1bmN0aW9uKG9ialtrZXldKSkgbmFtZXMucHVzaChrZXkpOwogICAgfQogICAgcmV0dXJuIG5hbWVzLnNvcnQoKTsKICB9OwoKICAvLyBFeHRlbmQgYSBnaXZlbiBvYmplY3Qgd2l0aCBhbGwgdGhlIHByb3BlcnRpZXMgaW4gcGFzc2VkLWluIG9iamVjdChzKS4KICBfLmV4dGVuZCA9IGZ1bmN0aW9uKG9iaikgewogICAgZWFjaChzbGljZS5jYWxsKGFyZ3VtZW50cywgMSksIGZ1bmN0aW9uKHNvdXJjZSkgewogICAgICBpZiAoc291cmNlKSB7CiAgICAgICAgZm9yICh2YXIgcHJvcCBpbiBzb3VyY2UpIHsKICAgICAgICAgIG9ialtwcm9wXSA9IHNvdXJjZVtwcm9wXTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIG9iajsKICB9OwoKICAvLyBSZXR1cm4gYSBjb3B5IG9mIHRoZSBvYmplY3Qgb25seSBjb250YWluaW5nIHRoZSB3aGl0ZWxpc3RlZCBwcm9wZXJ0aWVzLgogIF8ucGljayA9IGZ1bmN0aW9uKG9iaikgewogICAgdmFyIGNvcHkgPSB7fTsKICAgIHZhciBrZXlzID0gY29uY2F0LmFwcGx5KEFycmF5UHJvdG8sIHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSk7CiAgICBlYWNoKGtleXMsIGZ1bmN0aW9uKGtleSkgewogICAgICBpZiAoa2V5IGluIG9iaikgY29weVtrZXldID0gb2JqW2tleV07CiAgICB9KTsKICAgIHJldHVybiBjb3B5OwogIH07CgogICAvLyBSZXR1cm4gYSBjb3B5IG9mIHRoZSBvYmplY3Qgd2l0aG91dCB0aGUgYmxhY2tsaXN0ZWQgcHJvcGVydGllcy4KICBfLm9taXQgPSBmdW5jdGlvbihvYmopIHsKICAgIHZhciBjb3B5ID0ge307CiAgICB2YXIga2V5cyA9IGNvbmNhdC5hcHBseShBcnJheVByb3RvLCBzbGljZS5jYWxsKGFyZ3VtZW50cywgMSkpOwogICAgZm9yICh2YXIga2V5IGluIG9iaikgewogICAgICBpZiAoIV8uY29udGFpbnMoa2V5cywga2V5KSkgY29weVtrZXldID0gb2JqW2tleV07CiAgICB9CiAgICByZXR1cm4gY29weTsKICB9OwoKICAvLyBGaWxsIGluIGEgZ2l2ZW4gb2JqZWN0IHdpdGggZGVmYXVsdCBwcm9wZXJ0aWVzLgogIF8uZGVmYXVsdHMgPSBmdW5jdGlvbihvYmopIHsKICAgIGVhY2goc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpLCBmdW5jdGlvbihzb3VyY2UpIHsKICAgICAgaWYgKHNvdXJjZSkgewogICAgICAgIGZvciAodmFyIHByb3AgaW4gc291cmNlKSB7CiAgICAgICAgICBpZiAob2JqW3Byb3BdID09PSB2b2lkIDApIG9ialtwcm9wXSA9IHNvdXJjZVtwcm9wXTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIG9iajsKICB9OwoKICAvLyBDcmVhdGUgYSAoc2hhbGxvdy1jbG9uZWQpIGR1cGxpY2F0ZSBvZiBhbiBvYmplY3QuCiAgXy5jbG9uZSA9IGZ1bmN0aW9uKG9iaikgewogICAgaWYgKCFfLmlzT2JqZWN0KG9iaikpIHJldHVybiBvYmo7CiAgICByZXR1cm4gXy5pc0FycmF5KG9iaikgPyBvYmouc2xpY2UoKSA6IF8uZXh0ZW5kKHt9LCBvYmopOwogIH07CgogIC8vIEludm9rZXMgaW50ZXJjZXB0b3Igd2l0aCB0aGUgb2JqLCBhbmQgdGhlbiByZXR1cm5zIG9iai4KICAvLyBUaGUgcHJpbWFyeSBwdXJwb3NlIG9mIHRoaXMgbWV0aG9kIGlzIHRvICJ0YXAgaW50byIgYSBtZXRob2QgY2hhaW4sIGluCiAgLy8gb3JkZXIgdG8gcGVyZm9ybSBvcGVyYXRpb25zIG9uIGludGVybWVkaWF0ZSByZXN1bHRzIHdpdGhpbiB0aGUgY2hhaW4uCiAgXy50YXAgPSBmdW5jdGlvbihvYmosIGludGVyY2VwdG9yKSB7CiAgICBpbnRlcmNlcHRvcihvYmopOwogICAgcmV0dXJuIG9iajsKICB9OwoKICAvLyBJbnRlcm5hbCByZWN1cnNpdmUgY29tcGFyaXNvbiBmdW5jdGlvbiBmb3IgYGlzRXF1YWxgLgogIHZhciBlcSA9IGZ1bmN0aW9uKGEsIGIsIGFTdGFjaywgYlN0YWNrKSB7CiAgICAvLyBJZGVudGljYWwgb2JqZWN0cyBhcmUgZXF1YWwuIGAwID09PSAtMGAsIGJ1dCB0aGV5IGFyZW4ndCBpZGVudGljYWwuCiAgICAvLyBTZWUgdGhlIFtIYXJtb255IGBlZ2FsYCBwcm9wb3NhbF0oaHR0cDovL3dpa2kuZWNtYXNjcmlwdC5vcmcvZG9rdS5waHA/aWQ9aGFybW9ueTplZ2FsKS4KICAgIGlmIChhID09PSBiKSByZXR1cm4gYSAhPT0gMCB8fCAxIC8gYSA9PSAxIC8gYjsKICAgIC8vIEEgc3RyaWN0IGNvbXBhcmlzb24gaXMgbmVjZXNzYXJ5IGJlY2F1c2UgYG51bGwgPT0gdW5kZWZpbmVkYC4KICAgIGlmIChhID09IG51bGwgfHwgYiA9PSBudWxsKSByZXR1cm4gYSA9PT0gYjsKICAgIC8vIFVud3JhcCBhbnkgd3JhcHBlZCBvYmplY3RzLgogICAgaWYgKGEgaW5zdGFuY2VvZiBfKSBhID0gYS5fd3JhcHBlZDsKICAgIGlmIChiIGluc3RhbmNlb2YgXykgYiA9IGIuX3dyYXBwZWQ7CiAgICAvLyBDb21wYXJlIGBbW0NsYXNzXV1gIG5hbWVzLgogICAgdmFyIGNsYXNzTmFtZSA9IHRvU3RyaW5nLmNhbGwoYSk7CiAgICBpZiAoY2xhc3NOYW1lICE9IHRvU3RyaW5nLmNhbGwoYikpIHJldHVybiBmYWxzZTsKICAgIHN3aXRjaCAoY2xhc3NOYW1lKSB7CiAgICAgIC8vIFN0cmluZ3MsIG51bWJlcnMsIGRhdGVzLCBhbmQgYm9vbGVhbnMgYXJlIGNvbXBhcmVkIGJ5IHZhbHVlLgogICAgICBjYXNlICdbb2JqZWN0IFN0cmluZ10nOgogICAgICAgIC8vIFByaW1pdGl2ZXMgYW5kIHRoZWlyIGNvcnJlc3BvbmRpbmcgb2JqZWN0IHdyYXBwZXJzIGFyZSBlcXVpdmFsZW50OyB0aHVzLCBgIjUiYCBpcwogICAgICAgIC8vIGVxdWl2YWxlbnQgdG8gYG5ldyBTdHJpbmcoIjUiKWAuCiAgICAgICAgcmV0dXJuIGEgPT0gU3RyaW5nKGIpOwogICAgICBjYXNlICdbb2JqZWN0IE51bWJlcl0nOgogICAgICAgIC8vIGBOYU5gcyBhcmUgZXF1aXZhbGVudCwgYnV0IG5vbi1yZWZsZXhpdmUuIEFuIGBlZ2FsYCBjb21wYXJpc29uIGlzIHBlcmZvcm1lZCBmb3IKICAgICAgICAvLyBvdGhlciBudW1lcmljIHZhbHVlcy4KICAgICAgICByZXR1cm4gYSAhPSArYSA/IGIgIT0gK2IgOiAoYSA9PSAwID8gMSAvIGEgPT0gMSAvIGIgOiBhID09ICtiKTsKICAgICAgY2FzZSAnW29iamVjdCBEYXRlXSc6CiAgICAgIGNhc2UgJ1tvYmplY3QgQm9vbGVhbl0nOgogICAgICAgIC8vIENvZXJjZSBkYXRlcyBhbmQgYm9vbGVhbnMgdG8gbnVtZXJpYyBwcmltaXRpdmUgdmFsdWVzLiBEYXRlcyBhcmUgY29tcGFyZWQgYnkgdGhlaXIKICAgICAgICAvLyBtaWxsaXNlY29uZCByZXByZXNlbnRhdGlvbnMuIE5vdGUgdGhhdCBpbnZhbGlkIGRhdGVzIHdpdGggbWlsbGlzZWNvbmQgcmVwcmVzZW50YXRpb25zCiAgICAgICAgLy8gb2YgYE5hTmAgYXJlIG5vdCBlcXVpdmFsZW50LgogICAgICAgIHJldHVybiArYSA9PSArYjsKICAgICAgLy8gUmVnRXhwcyBhcmUgY29tcGFyZWQgYnkgdGhlaXIgc291cmNlIHBhdHRlcm5zIGFuZCBmbGFncy4KICAgICAgY2FzZSAnW29iamVjdCBSZWdFeHBdJzoKICAgICAgICByZXR1cm4gYS5zb3VyY2UgPT0gYi5zb3VyY2UgJiYKICAgICAgICAgICAgICAgYS5nbG9iYWwgPT0gYi5nbG9iYWwgJiYKICAgICAgICAgICAgICAgYS5tdWx0aWxpbmUgPT0gYi5tdWx0aWxpbmUgJiYKICAgICAgICAgICAgICAgYS5pZ25vcmVDYXNlID09IGIuaWdub3JlQ2FzZTsKICAgIH0KICAgIGlmICh0eXBlb2YgYSAhPSAnb2JqZWN0JyB8fCB0eXBlb2YgYiAhPSAnb2JqZWN0JykgcmV0dXJuIGZhbHNlOwogICAgLy8gQXNzdW1lIGVxdWFsaXR5IGZvciBjeWNsaWMgc3RydWN0dXJlcy4gVGhlIGFsZ29yaXRobSBmb3IgZGV0ZWN0aW5nIGN5Y2xpYwogICAgLy8gc3RydWN0dXJlcyBpcyBhZGFwdGVkIGZyb20gRVMgNS4xIHNlY3Rpb24gMTUuMTIuMywgYWJzdHJhY3Qgb3BlcmF0aW9uIGBKT2AuCiAgICB2YXIgbGVuZ3RoID0gYVN0YWNrLmxlbmd0aDsKICAgIHdoaWxlIChsZW5ndGgtLSkgewogICAgICAvLyBMaW5lYXIgc2VhcmNoLiBQZXJmb3JtYW5jZSBpcyBpbnZlcnNlbHkgcHJvcG9ydGlvbmFsIHRvIHRoZSBudW1iZXIgb2YKICAgICAgLy8gdW5pcXVlIG5lc3RlZCBzdHJ1Y3R1cmVzLgogICAgICBpZiAoYVN0YWNrW2xlbmd0aF0gPT0gYSkgcmV0dXJuIGJTdGFja1tsZW5ndGhdID09IGI7CiAgICB9CiAgICAvLyBPYmplY3RzIHdpdGggZGlmZmVyZW50IGNvbnN0cnVjdG9ycyBhcmUgbm90IGVxdWl2YWxlbnQsIGJ1dCBgT2JqZWN0YHMKICAgIC8vIGZyb20gZGlmZmVyZW50IGZyYW1lcyBhcmUuCiAgICB2YXIgYUN0b3IgPSBhLmNvbnN0cnVjdG9yLCBiQ3RvciA9IGIuY29uc3RydWN0b3I7CiAgICBpZiAoYUN0b3IgIT09IGJDdG9yICYmICEoXy5pc0Z1bmN0aW9uKGFDdG9yKSAmJiAoYUN0b3IgaW5zdGFuY2VvZiBhQ3RvcikgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfLmlzRnVuY3Rpb24oYkN0b3IpICYmIChiQ3RvciBpbnN0YW5jZW9mIGJDdG9yKSkKICAgICAgICAgICAgICAgICAgICAgICAgJiYgKCdjb25zdHJ1Y3RvcicgaW4gYSAmJiAnY29uc3RydWN0b3InIGluIGIpKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIC8vIEFkZCB0aGUgZmlyc3Qgb2JqZWN0IHRvIHRoZSBzdGFjayBvZiB0cmF2ZXJzZWQgb2JqZWN0cy4KICAgIGFTdGFjay5wdXNoKGEpOwogICAgYlN0YWNrLnB1c2goYik7CiAgICB2YXIgc2l6ZSA9IDAsIHJlc3VsdCA9IHRydWU7CiAgICAvLyBSZWN1cnNpdmVseSBjb21wYXJlIG9iamVjdHMgYW5kIGFycmF5cy4KICAgIGlmIChjbGFzc05hbWUgPT0gJ1tvYmplY3QgQXJyYXldJykgewogICAgICAvLyBDb21wYXJlIGFycmF5IGxlbmd0aHMgdG8gZGV0ZXJtaW5lIGlmIGEgZGVlcCBjb21wYXJpc29uIGlzIG5lY2Vzc2FyeS4KICAgICAgc2l6ZSA9IGEubGVuZ3RoOwogICAgICByZXN1bHQgPSBzaXplID09IGIubGVuZ3RoOwogICAgICBpZiAocmVzdWx0KSB7CiAgICAgICAgLy8gRGVlcCBjb21wYXJlIHRoZSBjb250ZW50cywgaWdub3Jpbmcgbm9uLW51bWVyaWMgcHJvcGVydGllcy4KICAgICAgICB3aGlsZSAoc2l6ZS0tKSB7CiAgICAgICAgICBpZiAoIShyZXN1bHQgPSBlcShhW3NpemVdLCBiW3NpemVdLCBhU3RhY2ssIGJTdGFjaykpKSBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIC8vIERlZXAgY29tcGFyZSBvYmplY3RzLgogICAgICBmb3IgKHZhciBrZXkgaW4gYSkgewogICAgICAgIGlmIChfLmhhcyhhLCBrZXkpKSB7CiAgICAgICAgICAvLyBDb3VudCB0aGUgZXhwZWN0ZWQgbnVtYmVyIG9mIHByb3BlcnRpZXMuCiAgICAgICAgICBzaXplKys7CiAgICAgICAgICAvLyBEZWVwIGNvbXBhcmUgZWFjaCBtZW1iZXIuCiAgICAgICAgICBpZiAoIShyZXN1bHQgPSBfLmhhcyhiLCBrZXkpICYmIGVxKGFba2V5XSwgYltrZXldLCBhU3RhY2ssIGJTdGFjaykpKSBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgICAgLy8gRW5zdXJlIHRoYXQgYm90aCBvYmplY3RzIGNvbnRhaW4gdGhlIHNhbWUgbnVtYmVyIG9mIHByb3BlcnRpZXMuCiAgICAgIGlmIChyZXN1bHQpIHsKICAgICAgICBmb3IgKGtleSBpbiBiKSB7CiAgICAgICAgICBpZiAoXy5oYXMoYiwga2V5KSAmJiAhKHNpemUtLSkpIGJyZWFrOwogICAgICAgIH0KICAgICAgICByZXN1bHQgPSAhc2l6ZTsKICAgICAgfQogICAgfQogICAgLy8gUmVtb3ZlIHRoZSBmaXJzdCBvYmplY3QgZnJvbSB0aGUgc3RhY2sgb2YgdHJhdmVyc2VkIG9iamVjdHMuCiAgICBhU3RhY2sucG9wKCk7CiAgICBiU3RhY2sucG9wKCk7CiAgICByZXR1cm4gcmVzdWx0OwogIH07CgogIC8vIFBlcmZvcm0gYSBkZWVwIGNvbXBhcmlzb24gdG8gY2hlY2sgaWYgdHdvIG9iamVjdHMgYXJlIGVxdWFsLgogIF8uaXNFcXVhbCA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgIHJldHVybiBlcShhLCBiLCBbXSwgW10pOwogIH07CgogIC8vIElzIGEgZ2l2ZW4gYXJyYXksIHN0cmluZywgb3Igb2JqZWN0IGVtcHR5PwogIC8vIEFuICJlbXB0eSIgb2JqZWN0IGhhcyBubyBlbnVtZXJhYmxlIG93bi1wcm9wZXJ0aWVzLgogIF8uaXNFbXB0eSA9IGZ1bmN0aW9uKG9iaikgewogICAgaWYgKG9iaiA9PSBudWxsKSByZXR1cm4gdHJ1ZTsKICAgIGlmIChfLmlzQXJyYXkob2JqKSB8fCBfLmlzU3RyaW5nKG9iaikpIHJldHVybiBvYmoubGVuZ3RoID09PSAwOwogICAgZm9yICh2YXIga2V5IGluIG9iaikgaWYgKF8uaGFzKG9iaiwga2V5KSkgcmV0dXJuIGZhbHNlOwogICAgcmV0dXJuIHRydWU7CiAgfTsKCiAgLy8gSXMgYSBnaXZlbiB2YWx1ZSBhIERPTSBlbGVtZW50PwogIF8uaXNFbGVtZW50ID0gZnVuY3Rpb24ob2JqKSB7CiAgICByZXR1cm4gISEob2JqICYmIG9iai5ub2RlVHlwZSA9PT0gMSk7CiAgfTsKCiAgLy8gSXMgYSBnaXZlbiB2YWx1ZSBhbiBhcnJheT8KICAvLyBEZWxlZ2F0ZXMgdG8gRUNNQTUncyBuYXRpdmUgQXJyYXkuaXNBcnJheQogIF8uaXNBcnJheSA9IG5hdGl2ZUlzQXJyYXkgfHwgZnVuY3Rpb24ob2JqKSB7CiAgICByZXR1cm4gdG9TdHJpbmcuY2FsbChvYmopID09ICdbb2JqZWN0IEFycmF5XSc7CiAgfTsKCiAgLy8gSXMgYSBnaXZlbiB2YXJpYWJsZSBhbiBvYmplY3Q/CiAgXy5pc09iamVjdCA9IGZ1bmN0aW9uKG9iaikgewogICAgcmV0dXJuIG9iaiA9PT0gT2JqZWN0KG9iaik7CiAgfTsKCiAgLy8gQWRkIHNvbWUgaXNUeXBlIG1ldGhvZHM6IGlzQXJndW1lbnRzLCBpc0Z1bmN0aW9uLCBpc1N0cmluZywgaXNOdW1iZXIsIGlzRGF0ZSwgaXNSZWdFeHAuCiAgZWFjaChbJ0FyZ3VtZW50cycsICdGdW5jdGlvbicsICdTdHJpbmcnLCAnTnVtYmVyJywgJ0RhdGUnLCAnUmVnRXhwJ10sIGZ1bmN0aW9uKG5hbWUpIHsKICAgIF9bJ2lzJyArIG5hbWVdID0gZnVuY3Rpb24ob2JqKSB7CiAgICAgIHJldHVybiB0b1N0cmluZy5jYWxsKG9iaikgPT0gJ1tvYmplY3QgJyArIG5hbWUgKyAnXSc7CiAgICB9OwogIH0pOwoKICAvLyBEZWZpbmUgYSBmYWxsYmFjayB2ZXJzaW9uIG9mIHRoZSBtZXRob2QgaW4gYnJvd3NlcnMgKGFoZW0sIElFKSwgd2hlcmUKICAvLyB0aGVyZSBpc24ndCBhbnkgaW5zcGVjdGFibGUgIkFyZ3VtZW50cyIgdHlwZS4KICBpZiAoIV8uaXNBcmd1bWVudHMoYXJndW1lbnRzKSkgewogICAgXy5pc0FyZ3VtZW50cyA9IGZ1bmN0aW9uKG9iaikgewogICAgICByZXR1cm4gISEob2JqICYmIF8uaGFzKG9iaiwgJ2NhbGxlZScpKTsKICAgIH07CiAgfQoKICAvLyBPcHRpbWl6ZSBgaXNGdW5jdGlvbmAgaWYgYXBwcm9wcmlhdGUuCiAgaWYgKHR5cGVvZiAoLy4vKSAhPT0gJ2Z1bmN0aW9uJykgewogICAgXy5pc0Z1bmN0aW9uID0gZnVuY3Rpb24ob2JqKSB7CiAgICAgIHJldHVybiB0eXBlb2Ygb2JqID09PSAnZnVuY3Rpb24nOwogICAgfTsKICB9CgogIC8vIElzIGEgZ2l2ZW4gb2JqZWN0IGEgZmluaXRlIG51bWJlcj8KICBfLmlzRmluaXRlID0gZnVuY3Rpb24ob2JqKSB7CiAgICByZXR1cm4gaXNGaW5pdGUob2JqKSAmJiAhaXNOYU4ocGFyc2VGbG9hdChvYmopKTsKICB9OwoKICAvLyBJcyB0aGUgZ2l2ZW4gdmFsdWUgYE5hTmA/IChOYU4gaXMgdGhlIG9ubHkgbnVtYmVyIHdoaWNoIGRvZXMgbm90IGVxdWFsIGl0c2VsZikuCiAgXy5pc05hTiA9IGZ1bmN0aW9uKG9iaikgewogICAgcmV0dXJuIF8uaXNOdW1iZXIob2JqKSAmJiBvYmogIT0gK29iajsKICB9OwoKICAvLyBJcyBhIGdpdmVuIHZhbHVlIGEgYm9vbGVhbj8KICBfLmlzQm9vbGVhbiA9IGZ1bmN0aW9uKG9iaikgewogICAgcmV0dXJuIG9iaiA9PT0gdHJ1ZSB8fCBvYmogPT09IGZhbHNlIHx8IHRvU3RyaW5nLmNhbGwob2JqKSA9PSAnW29iamVjdCBCb29sZWFuXSc7CiAgfTsKCiAgLy8gSXMgYSBnaXZlbiB2YWx1ZSBlcXVhbCB0byBudWxsPwogIF8uaXNOdWxsID0gZnVuY3Rpb24ob2JqKSB7CiAgICByZXR1cm4gb2JqID09PSBudWxsOwogIH07CgogIC8vIElzIGEgZ2l2ZW4gdmFyaWFibGUgdW5kZWZpbmVkPwogIF8uaXNVbmRlZmluZWQgPSBmdW5jdGlvbihvYmopIHsKICAgIHJldHVybiBvYmogPT09IHZvaWQgMDsKICB9OwoKICAvLyBTaG9ydGN1dCBmdW5jdGlvbiBmb3IgY2hlY2tpbmcgaWYgYW4gb2JqZWN0IGhhcyBhIGdpdmVuIHByb3BlcnR5IGRpcmVjdGx5CiAgLy8gb24gaXRzZWxmIChpbiBvdGhlciB3b3Jkcywgbm90IG9uIGEgcHJvdG90eXBlKS4KICBfLmhhcyA9IGZ1bmN0aW9uKG9iaiwga2V5KSB7CiAgICByZXR1cm4gaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSk7CiAgfTsKCiAgLy8gVXRpbGl0eSBGdW5jdGlvbnMKICAvLyAtLS0tLS0tLS0tLS0tLS0tLQoKICAvLyBSdW4gVW5kZXJzY29yZS5qcyBpbiAqbm9Db25mbGljdCogbW9kZSwgcmV0dXJuaW5nIHRoZSBgX2AgdmFyaWFibGUgdG8gaXRzCiAgLy8gcHJldmlvdXMgb3duZXIuIFJldHVybnMgYSByZWZlcmVuY2UgdG8gdGhlIFVuZGVyc2NvcmUgb2JqZWN0LgogIF8ubm9Db25mbGljdCA9IGZ1bmN0aW9uKCkgewogICAgcm9vdC5fID0gcHJldmlvdXNVbmRlcnNjb3JlOwogICAgcmV0dXJuIHRoaXM7CiAgfTsKCiAgLy8gS2VlcCB0aGUgaWRlbnRpdHkgZnVuY3Rpb24gYXJvdW5kIGZvciBkZWZhdWx0IGl0ZXJhdG9ycy4KICBfLmlkZW50aXR5ID0gZnVuY3Rpb24odmFsdWUpIHsKICAgIHJldHVybiB2YWx1ZTsKICB9OwoKICBfLmNvbnN0YW50ID0gZnVuY3Rpb24odmFsdWUpIHsKICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH07CiAgfTsKCiAgXy5wcm9wZXJ0eSA9IGZ1bmN0aW9uKGtleSkgewogICAgcmV0dXJuIGZ1bmN0aW9uKG9iaikgewogICAgICByZXR1cm4gb2JqW2tleV07CiAgICB9OwogIH07CgogIC8vIFJldHVybnMgYSBwcmVkaWNhdGUgZm9yIGNoZWNraW5nIHdoZXRoZXIgYW4gb2JqZWN0IGhhcyBhIGdpdmVuIHNldCBvZiBga2V5OnZhbHVlYCBwYWlycy4KICBfLm1hdGNoZXMgPSBmdW5jdGlvbihhdHRycykgewogICAgcmV0dXJuIGZ1bmN0aW9uKG9iaikgewogICAgICBpZiAob2JqID09PSBhdHRycykgcmV0dXJuIHRydWU7IC8vYXZvaWQgY29tcGFyaW5nIGFuIG9iamVjdCB0byBpdHNlbGYuCiAgICAgIGZvciAodmFyIGtleSBpbiBhdHRycykgewogICAgICAgIGlmIChhdHRyc1trZXldICE9PSBvYmpba2V5XSkKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICB9OwoKICAvLyBSdW4gYSBmdW5jdGlvbiAqKm4qKiB0aW1lcy4KICBfLnRpbWVzID0gZnVuY3Rpb24obiwgaXRlcmF0b3IsIGNvbnRleHQpIHsKICAgIHZhciBhY2N1bSA9IEFycmF5KE1hdGgubWF4KDAsIG4pKTsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbjsgaSsrKSBhY2N1bVtpXSA9IGl0ZXJhdG9yLmNhbGwoY29udGV4dCwgaSk7CiAgICByZXR1cm4gYWNjdW07CiAgfTsKCiAgLy8gUmV0dXJuIGEgcmFuZG9tIGludGVnZXIgYmV0d2VlbiBtaW4gYW5kIG1heCAoaW5jbHVzaXZlKS4KICBfLnJhbmRvbSA9IGZ1bmN0aW9uKG1pbiwgbWF4KSB7CiAgICBpZiAobWF4ID09IG51bGwpIHsKICAgICAgbWF4ID0gbWluOwogICAgICBtaW4gPSAwOwogICAgfQogICAgcmV0dXJuIG1pbiArIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChtYXggLSBtaW4gKyAxKSk7CiAgfTsKCiAgLy8gQSAocG9zc2libHkgZmFzdGVyKSB3YXkgdG8gZ2V0IHRoZSBjdXJyZW50IHRpbWVzdGFtcCBhcyBhbiBpbnRlZ2VyLgogIF8ubm93ID0gRGF0ZS5ub3cgfHwgZnVuY3Rpb24oKSB7IHJldHVybiBuZXcgRGF0ZSgpLmdldFRpbWUoKTsgfTsKCiAgLy8gTGlzdCBvZiBIVE1MIGVudGl0aWVzIGZvciBlc2NhcGluZy4KICB2YXIgZW50aXR5TWFwID0gewogICAgZXNjYXBlOiB7CiAgICAgICcmJzogJyZhbXA7JywKICAgICAgJzwnOiAnJmx0OycsCiAgICAgICc+JzogJyZndDsnLAogICAgICAnIic6ICcmcXVvdDsnLAogICAgICAiJyI6ICcmI3gyNzsnCiAgICB9CiAgfTsKICBlbnRpdHlNYXAudW5lc2NhcGUgPSBfLmludmVydChlbnRpdHlNYXAuZXNjYXBlKTsKCiAgLy8gUmVnZXhlcyBjb250YWluaW5nIHRoZSBrZXlzIGFuZCB2YWx1ZXMgbGlzdGVkIGltbWVkaWF0ZWx5IGFib3ZlLgogIHZhciBlbnRpdHlSZWdleGVzID0gewogICAgZXNjYXBlOiAgIG5ldyBSZWdFeHAoJ1snICsgXy5rZXlzKGVudGl0eU1hcC5lc2NhcGUpLmpvaW4oJycpICsgJ10nLCAnZycpLAogICAgdW5lc2NhcGU6IG5ldyBSZWdFeHAoJygnICsgXy5rZXlzKGVudGl0eU1hcC51bmVzY2FwZSkuam9pbignfCcpICsgJyknLCAnZycpCiAgfTsKCiAgLy8gRnVuY3Rpb25zIGZvciBlc2NhcGluZyBhbmQgdW5lc2NhcGluZyBzdHJpbmdzIHRvL2Zyb20gSFRNTCBpbnRlcnBvbGF0aW9uLgogIF8uZWFjaChbJ2VzY2FwZScsICd1bmVzY2FwZSddLCBmdW5jdGlvbihtZXRob2QpIHsKICAgIF9bbWV0aG9kXSA9IGZ1bmN0aW9uKHN0cmluZykgewogICAgICBpZiAoc3RyaW5nID09IG51bGwpIHJldHVybiAnJzsKICAgICAgcmV0dXJuICgnJyArIHN0cmluZykucmVwbGFjZShlbnRpdHlSZWdleGVzW21ldGhvZF0sIGZ1bmN0aW9uKG1hdGNoKSB7CiAgICAgICAgcmV0dXJuIGVudGl0eU1hcFttZXRob2RdW21hdGNoXTsKICAgICAgfSk7CiAgICB9OwogIH0pOwoKICAvLyBJZiB0aGUgdmFsdWUgb2YgdGhlIG5hbWVkIGBwcm9wZXJ0eWAgaXMgYSBmdW5jdGlvbiB0aGVuIGludm9rZSBpdCB3aXRoIHRoZQogIC8vIGBvYmplY3RgIGFzIGNvbnRleHQ7IG90aGVyd2lzZSwgcmV0dXJuIGl0LgogIF8ucmVzdWx0ID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgewogICAgaWYgKG9iamVjdCA9PSBudWxsKSByZXR1cm4gdm9pZCAwOwogICAgdmFyIHZhbHVlID0gb2JqZWN0W3Byb3BlcnR5XTsKICAgIHJldHVybiBfLmlzRnVuY3Rpb24odmFsdWUpID8gdmFsdWUuY2FsbChvYmplY3QpIDogdmFsdWU7CiAgfTsKCiAgLy8gQWRkIHlvdXIgb3duIGN1c3RvbSBmdW5jdGlvbnMgdG8gdGhlIFVuZGVyc2NvcmUgb2JqZWN0LgogIF8ubWl4aW4gPSBmdW5jdGlvbihvYmopIHsKICAgIGVhY2goXy5mdW5jdGlvbnMob2JqKSwgZnVuY3Rpb24obmFtZSkgewogICAgICB2YXIgZnVuYyA9IF9bbmFtZV0gPSBvYmpbbmFtZV07CiAgICAgIF8ucHJvdG90eXBlW25hbWVdID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGFyZ3MgPSBbdGhpcy5fd3JhcHBlZF07CiAgICAgICAgcHVzaC5hcHBseShhcmdzLCBhcmd1bWVudHMpOwogICAgICAgIHJldHVybiByZXN1bHQuY2FsbCh0aGlzLCBmdW5jLmFwcGx5KF8sIGFyZ3MpKTsKICAgICAgfTsKICAgIH0pOwogIH07CgogIC8vIEdlbmVyYXRlIGEgdW5pcXVlIGludGVnZXIgaWQgKHVuaXF1ZSB3aXRoaW4gdGhlIGVudGlyZSBjbGllbnQgc2Vzc2lvbikuCiAgLy8gVXNlZnVsIGZvciB0ZW1wb3JhcnkgRE9NIGlkcy4KICB2YXIgaWRDb3VudGVyID0gMDsKICBfLnVuaXF1ZUlkID0gZnVuY3Rpb24ocHJlZml4KSB7CiAgICB2YXIgaWQgPSArK2lkQ291bnRlciArICcnOwogICAgcmV0dXJuIHByZWZpeCA/IHByZWZpeCArIGlkIDogaWQ7CiAgfTsKCiAgLy8gQnkgZGVmYXVsdCwgVW5kZXJzY29yZSB1c2VzIEVSQi1zdHlsZSB0ZW1wbGF0ZSBkZWxpbWl0ZXJzLCBjaGFuZ2UgdGhlCiAgLy8gZm9sbG93aW5nIHRlbXBsYXRlIHNldHRpbmdzIHRvIHVzZSBhbHRlcm5hdGl2ZSBkZWxpbWl0ZXJzLgogIF8udGVtcGxhdGVTZXR0aW5ncyA9IHsKICAgIGV2YWx1YXRlICAgIDogLzwlKFtcc1xTXSs/KSU+L2csCiAgICBpbnRlcnBvbGF0ZSA6IC88JT0oW1xzXFNdKz8pJT4vZywKICAgIGVzY2FwZSAgICAgIDogLzwlLShbXHNcU10rPyklPi9nCiAgfTsKCiAgLy8gV2hlbiBjdXN0b21pemluZyBgdGVtcGxhdGVTZXR0aW5nc2AsIGlmIHlvdSBkb24ndCB3YW50IHRvIGRlZmluZSBhbgogIC8vIGludGVycG9sYXRpb24sIGV2YWx1YXRpb24gb3IgZXNjYXBpbmcgcmVnZXgsIHdlIG5lZWQgb25lIHRoYXQgaXMKICAvLyBndWFyYW50ZWVkIG5vdCB0byBtYXRjaC4KICB2YXIgbm9NYXRjaCA9IC8oLileLzsKCiAgLy8gQ2VydGFpbiBjaGFyYWN0ZXJzIG5lZWQgdG8gYmUgZXNjYXBlZCBzbyB0aGF0IHRoZXkgY2FuIGJlIHB1dCBpbnRvIGEKICAvLyBzdHJpbmcgbGl0ZXJhbC4KICB2YXIgZXNjYXBlcyA9IHsKICAgICInIjogICAgICAiJyIsCiAgICAnXFwnOiAgICAgJ1xcJywKICAgICdccic6ICAgICAncicsCiAgICAnXG4nOiAgICAgJ24nLAogICAgJ1x0JzogICAgICd0JywKICAgICdcdTIwMjgnOiAndTIwMjgnLAogICAgJ1x1MjAyOSc6ICd1MjAyOScKICB9OwoKICB2YXIgZXNjYXBlciA9IC9cXHwnfFxyfFxufFx0fFx1MjAyOHxcdTIwMjkvZzsKCiAgLy8gSmF2YVNjcmlwdCBtaWNyby10ZW1wbGF0aW5nLCBzaW1pbGFyIHRvIEpvaG4gUmVzaWcncyBpbXBsZW1lbnRhdGlvbi4KICAvLyBVbmRlcnNjb3JlIHRlbXBsYXRpbmcgaGFuZGxlcyBhcmJpdHJhcnkgZGVsaW1pdGVycywgcHJlc2VydmVzIHdoaXRlc3BhY2UsCiAgLy8gYW5kIGNvcnJlY3RseSBlc2NhcGVzIHF1b3RlcyB3aXRoaW4gaW50ZXJwb2xhdGVkIGNvZGUuCiAgXy50ZW1wbGF0ZSA9IGZ1bmN0aW9uKHRleHQsIGRhdGEsIHNldHRpbmdzKSB7CiAgICB2YXIgcmVuZGVyOwogICAgc2V0dGluZ3MgPSBfLmRlZmF1bHRzKHt9LCBzZXR0aW5ncywgXy50ZW1wbGF0ZVNldHRpbmdzKTsKCiAgICAvLyBDb21iaW5lIGRlbGltaXRlcnMgaW50byBvbmUgcmVndWxhciBleHByZXNzaW9uIHZpYSBhbHRlcm5hdGlvbi4KICAgIHZhciBtYXRjaGVyID0gbmV3IFJlZ0V4cChbCiAgICAgIChzZXR0aW5ncy5lc2NhcGUgfHwgbm9NYXRjaCkuc291cmNlLAogICAgICAoc2V0dGluZ3MuaW50ZXJwb2xhdGUgfHwgbm9NYXRjaCkuc291cmNlLAogICAgICAoc2V0dGluZ3MuZXZhbHVhdGUgfHwgbm9NYXRjaCkuc291cmNlCiAgICBdLmpvaW4oJ3wnKSArICd8JCcsICdnJyk7CgogICAgLy8gQ29tcGlsZSB0aGUgdGVtcGxhdGUgc291cmNlLCBlc2NhcGluZyBzdHJpbmcgbGl0ZXJhbHMgYXBwcm9wcmlhdGVseS4KICAgIHZhciBpbmRleCA9IDA7CiAgICB2YXIgc291cmNlID0gIl9fcCs9JyI7CiAgICB0ZXh0LnJlcGxhY2UobWF0Y2hlciwgZnVuY3Rpb24obWF0Y2gsIGVzY2FwZSwgaW50ZXJwb2xhdGUsIGV2YWx1YXRlLCBvZmZzZXQpIHsKICAgICAgc291cmNlICs9IHRleHQuc2xpY2UoaW5kZXgsIG9mZnNldCkKICAgICAgICAucmVwbGFjZShlc2NhcGVyLCBmdW5jdGlvbihtYXRjaCkgeyByZXR1cm4gJ1xcJyArIGVzY2FwZXNbbWF0Y2hdOyB9KTsKCiAgICAgIGlmIChlc2NhcGUpIHsKICAgICAgICBzb3VyY2UgKz0gIicrXG4oKF9fdD0oIiArIGVzY2FwZSArICIpKT09bnVsbD8nJzpfLmVzY2FwZShfX3QpKStcbiciOwogICAgICB9CiAgICAgIGlmIChpbnRlcnBvbGF0ZSkgewogICAgICAgIHNvdXJjZSArPSAiJytcbigoX190PSgiICsgaW50ZXJwb2xhdGUgKyAiKSk9PW51bGw/Jyc6X190KStcbiciOwogICAgICB9CiAgICAgIGlmIChldmFsdWF0ZSkgewogICAgICAgIHNvdXJjZSArPSAiJztcbiIgKyBldmFsdWF0ZSArICJcbl9fcCs9JyI7CiAgICAgIH0KICAgICAgaW5kZXggPSBvZmZzZXQgKyBtYXRjaC5sZW5ndGg7CiAgICAgIHJldHVybiBtYXRjaDsKICAgIH0pOwogICAgc291cmNlICs9ICInO1xuIjsKCiAgICAvLyBJZiBhIHZhcmlhYmxlIGlzIG5vdCBzcGVjaWZpZWQsIHBsYWNlIGRhdGEgdmFsdWVzIGluIGxvY2FsIHNjb3BlLgogICAgaWYgKCFzZXR0aW5ncy52YXJpYWJsZSkgc291cmNlID0gJ3dpdGgob2JqfHx7fSl7XG4nICsgc291cmNlICsgJ31cbic7CgogICAgc291cmNlID0gInZhciBfX3QsX19wPScnLF9faj1BcnJheS5wcm90b3R5cGUuam9pbiwiICsKICAgICAgInByaW50PWZ1bmN0aW9uKCl7X19wKz1fX2ouY2FsbChhcmd1bWVudHMsJycpO307XG4iICsKICAgICAgc291cmNlICsgInJldHVybiBfX3A7XG4iOwoKICAgIHRyeSB7CiAgICAgIHJlbmRlciA9IG5ldyBGdW5jdGlvbihzZXR0aW5ncy52YXJpYWJsZSB8fCAnb2JqJywgJ18nLCBzb3VyY2UpOwogICAgfSBjYXRjaCAoZSkgewogICAgICBlLnNvdXJjZSA9IHNvdXJjZTsKICAgICAgdGhyb3cgZTsKICAgIH0KCiAgICBpZiAoZGF0YSkgcmV0dXJuIHJlbmRlcihkYXRhLCBfKTsKICAgIHZhciB0ZW1wbGF0ZSA9IGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgcmV0dXJuIHJlbmRlci5jYWxsKHRoaXMsIGRhdGEsIF8pOwogICAgfTsKCiAgICAvLyBQcm92aWRlIHRoZSBjb21waWxlZCBmdW5jdGlvbiBzb3VyY2UgYXMgYSBjb252ZW5pZW5jZSBmb3IgcHJlY29tcGlsYXRpb24uCiAgICB0ZW1wbGF0ZS5zb3VyY2UgPSAnZnVuY3Rpb24oJyArIChzZXR0aW5ncy52YXJpYWJsZSB8fCAnb2JqJykgKyAnKXtcbicgKyBzb3VyY2UgKyAnfSc7CgogICAgcmV0dXJuIHRlbXBsYXRlOwogIH07CgogIC8vIEFkZCBhICJjaGFpbiIgZnVuY3Rpb24sIHdoaWNoIHdpbGwgZGVsZWdhdGUgdG8gdGhlIHdyYXBwZXIuCiAgXy5jaGFpbiA9IGZ1bmN0aW9uKG9iaikgewogICAgcmV0dXJuIF8ob2JqKS5jaGFpbigpOwogIH07CgogIC8vIE9PUAogIC8vIC0tLS0tLS0tLS0tLS0tLQogIC8vIElmIFVuZGVyc2NvcmUgaXMgY2FsbGVkIGFzIGEgZnVuY3Rpb24sIGl0IHJldHVybnMgYSB3cmFwcGVkIG9iamVjdCB0aGF0CiAgLy8gY2FuIGJlIHVzZWQgT08tc3R5bGUuIFRoaXMgd3JhcHBlciBob2xkcyBhbHRlcmVkIHZlcnNpb25zIG9mIGFsbCB0aGUKICAvLyB1bmRlcnNjb3JlIGZ1bmN0aW9ucy4gV3JhcHBlZCBvYmplY3RzIG1heSBiZSBjaGFpbmVkLgoKICAvLyBIZWxwZXIgZnVuY3Rpb24gdG8gY29udGludWUgY2hhaW5pbmcgaW50ZXJtZWRpYXRlIHJlc3VsdHMuCiAgdmFyIHJlc3VsdCA9IGZ1bmN0aW9uKG9iaikgewogICAgcmV0dXJuIHRoaXMuX2NoYWluID8gXyhvYmopLmNoYWluKCkgOiBvYmo7CiAgfTsKCiAgLy8gQWRkIGFsbCBvZiB0aGUgVW5kZXJzY29yZSBmdW5jdGlvbnMgdG8gdGhlIHdyYXBwZXIgb2JqZWN0LgogIF8ubWl4aW4oXyk7CgogIC8vIEFkZCBhbGwgbXV0YXRvciBBcnJheSBmdW5jdGlvbnMgdG8gdGhlIHdyYXBwZXIuCiAgZWFjaChbJ3BvcCcsICdwdXNoJywgJ3JldmVyc2UnLCAnc2hpZnQnLCAnc29ydCcsICdzcGxpY2UnLCAndW5zaGlmdCddLCBmdW5jdGlvbihuYW1lKSB7CiAgICB2YXIgbWV0aG9kID0gQXJyYXlQcm90b1tuYW1lXTsKICAgIF8ucHJvdG90eXBlW25hbWVdID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBvYmogPSB0aGlzLl93cmFwcGVkOwogICAgICBtZXRob2QuYXBwbHkob2JqLCBhcmd1bWVudHMpOwogICAgICBpZiAoKG5hbWUgPT0gJ3NoaWZ0JyB8fCBuYW1lID09ICdzcGxpY2UnKSAmJiBvYmoubGVuZ3RoID09PSAwKSBkZWxldGUgb2JqWzBdOwogICAgICByZXR1cm4gcmVzdWx0LmNhbGwodGhpcywgb2JqKTsKICAgIH07CiAgfSk7CgogIC8vIEFkZCBhbGwgYWNjZXNzb3IgQXJyYXkgZnVuY3Rpb25zIHRvIHRoZSB3cmFwcGVyLgogIGVhY2goWydjb25jYXQnLCAnam9pbicsICdzbGljZSddLCBmdW5jdGlvbihuYW1lKSB7CiAgICB2YXIgbWV0aG9kID0gQXJyYXlQcm90b1tuYW1lXTsKICAgIF8ucHJvdG90eXBlW25hbWVdID0gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiByZXN1bHQuY2FsbCh0aGlzLCBtZXRob2QuYXBwbHkodGhpcy5fd3JhcHBlZCwgYXJndW1lbnRzKSk7CiAgICB9OwogIH0pOwoKICBfLmV4dGVuZChfLnByb3RvdHlwZSwgewoKICAgIC8vIFN0YXJ0IGNoYWluaW5nIGEgd3JhcHBlZCBVbmRlcnNjb3JlIG9iamVjdC4KICAgIGNoYWluOiBmdW5jdGlvbigpIHsKICAgICAgdGhpcy5fY2hhaW4gPSB0cnVlOwogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLy8gRXh0cmFjdHMgdGhlIHJlc3VsdCBmcm9tIGEgd3JhcHBlZCBhbmQgY2hhaW5lZCBvYmplY3QuCiAgICB2YWx1ZTogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiB0aGlzLl93cmFwcGVkOwogICAgfQoKICB9KTsKCiAgLy8gQU1EIHJlZ2lzdHJhdGlvbiBoYXBwZW5zIGF0IHRoZSBlbmQgZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBBTUQgbG9hZGVycwogIC8vIHRoYXQgbWF5IG5vdCBlbmZvcmNlIG5leHQtdHVybiBzZW1hbnRpY3Mgb24gbW9kdWxlcy4gRXZlbiB0aG91Z2ggZ2VuZXJhbAogIC8vIHByYWN0aWNlIGZvciBBTUQgcmVnaXN0cmF0aW9uIGlzIHRvIGJlIGFub255bW91cywgdW5kZXJzY29yZSByZWdpc3RlcnMKICAvLyBhcyBhIG5hbWVkIG1vZHVsZSBiZWNhdXNlLCBsaWtlIGpRdWVyeSwgaXQgaXMgYSBiYXNlIGxpYnJhcnkgdGhhdCBpcwogIC8vIHBvcHVsYXIgZW5vdWdoIHRvIGJlIGJ1bmRsZWQgaW4gYSB0aGlyZCBwYXJ0eSBsaWIsIGJ1dCBub3QgYmUgcGFydCBvZgogIC8vIGFuIEFNRCBsb2FkIHJlcXVlc3QuIFRob3NlIGNhc2VzIGNvdWxkIGdlbmVyYXRlIGFuIGVycm9yIHdoZW4gYW4KICAvLyBhbm9ueW1vdXMgZGVmaW5lKCkgaXMgY2FsbGVkIG91dHNpZGUgb2YgYSBsb2FkZXIgcmVxdWVzdC4KICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7CiAgICBkZWZpbmUoJ3VuZGVyc2NvcmUnLCBbXSwgZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBfOwogICAgfSk7CiAgfQp9KS5jYWxsKHRoaXMpOwoKLyoqCiAqIGEgc2luZ2xldG9uIG9iamVjdCB0aGF0IHdpbGwgaGFuZGxlIGdsb2JhbCBzY29wZSBjb25maWd1cmF0aW9uIChwYXRoIHRvIHdldCBpbmZvIHJlc3Qgc2VydmljZSBldGMuLikKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCmRlZmluZSgnQ29uZmlnJyxbJ3VuZGVyc2NvcmUnXSwgZnVuY3Rpb24gKF8pIHsKICAgIF8udGVtcGxhdGVTZXR0aW5ncyA9IHsKICAgICAgICBpbnRlcnBvbGF0ZTogL1x7XHsoLis/KVx9XH0vZwogICAgfTsKCiAgICBDb25maWcgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgIHNlbGYuZGF0YSA9IHt9CiAgICB9CiAgICBDb25maWcucHJvdG90eXBlLnNldCA9IGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7CiAgICAgICAgdGhpcy5kYXRhW2tleV0gPSB2YWx1ZTsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIENvbmZpZy5wcm90b3R5cGUuZ2V0ID0gZnVuY3Rpb24gKGtleSkgewogICAgICAgIHJldHVybiB0aGlzLmRhdGFba2V5XTsKICAgIH0KCiAgICByZXR1cm4gbmV3IENvbmZpZygpOwp9KTsKCi8vICAgICBCYWNrYm9uZS5qcyAxLjEuMgoKLy8gICAgIChjKSAyMDEwLTIwMTQgSmVyZW15IEFzaGtlbmFzLCBEb2N1bWVudENsb3VkIGFuZCBJbnZlc3RpZ2F0aXZlIFJlcG9ydGVycyAmIEVkaXRvcnMKLy8gICAgIEJhY2tib25lIG1heSBiZSBmcmVlbHkgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlLgovLyAgICAgRm9yIGFsbCBkZXRhaWxzIGFuZCBkb2N1bWVudGF0aW9uOgovLyAgICAgaHR0cDovL2JhY2tib25lanMub3JnCgooZnVuY3Rpb24ocm9vdCwgZmFjdG9yeSkgewoKICAvLyBTZXQgdXAgQmFja2JvbmUgYXBwcm9wcmlhdGVseSBmb3IgdGhlIGVudmlyb25tZW50LiBTdGFydCB3aXRoIEFNRC4KICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7CiAgICBkZWZpbmUoJ0JhY2tib25lJyxbJ3VuZGVyc2NvcmUnLCAnanF1ZXJ5JywgJ2V4cG9ydHMnXSwgZnVuY3Rpb24oXywgJCwgZXhwb3J0cykgewogICAgICAvLyBFeHBvcnQgZ2xvYmFsIGV2ZW4gaW4gQU1EIGNhc2UgaW4gY2FzZSB0aGlzIHNjcmlwdCBpcyBsb2FkZWQgd2l0aAogICAgICAvLyBvdGhlcnMgdGhhdCBtYXkgc3RpbGwgZXhwZWN0IGEgZ2xvYmFsIEJhY2tib25lLgogICAgICByb290LkJhY2tib25lID0gZmFjdG9yeShyb290LCBleHBvcnRzLCBfLCAkKTsKICAgIH0pOwoKICAvLyBOZXh0IGZvciBOb2RlLmpzIG9yIENvbW1vbkpTLiBqUXVlcnkgbWF5IG5vdCBiZSBuZWVkZWQgYXMgYSBtb2R1bGUuCiAgfSBlbHNlIGlmICh0eXBlb2YgZXhwb3J0cyAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgIHZhciBfID0gcmVxdWlyZSgndW5kZXJzY29yZScpOwogICAgZmFjdG9yeShyb290LCBleHBvcnRzLCBfKTsKCiAgLy8gRmluYWxseSwgYXMgYSBicm93c2VyIGdsb2JhbC4KICB9IGVsc2UgewogICAgcm9vdC5CYWNrYm9uZSA9IGZhY3Rvcnkocm9vdCwge30sIHJvb3QuXywgKHJvb3QualF1ZXJ5IHx8IHJvb3QuWmVwdG8gfHwgcm9vdC5lbmRlciB8fCByb290LiQpKTsKICB9Cgp9KHRoaXMsIGZ1bmN0aW9uKHJvb3QsIEJhY2tib25lLCBfLCAkKSB7CgogIC8vIEluaXRpYWwgU2V0dXAKICAvLyAtLS0tLS0tLS0tLS0tCgogIC8vIFNhdmUgdGhlIHByZXZpb3VzIHZhbHVlIG9mIHRoZSBgQmFja2JvbmVgIHZhcmlhYmxlLCBzbyB0aGF0IGl0IGNhbiBiZQogIC8vIHJlc3RvcmVkIGxhdGVyIG9uLCBpZiBgbm9Db25mbGljdGAgaXMgdXNlZC4KICB2YXIgcHJldmlvdXNCYWNrYm9uZSA9IHJvb3QuQmFja2JvbmU7CgogIC8vIENyZWF0ZSBsb2NhbCByZWZlcmVuY2VzIHRvIGFycmF5IG1ldGhvZHMgd2UnbGwgd2FudCB0byB1c2UgbGF0ZXIuCiAgdmFyIGFycmF5ID0gW107CiAgdmFyIHB1c2ggPSBhcnJheS5wdXNoOwogIHZhciBzbGljZSA9IGFycmF5LnNsaWNlOwogIHZhciBzcGxpY2UgPSBhcnJheS5zcGxpY2U7CgogIC8vIEN1cnJlbnQgdmVyc2lvbiBvZiB0aGUgbGlicmFyeS4gS2VlcCBpbiBzeW5jIHdpdGggYHBhY2thZ2UuanNvbmAuCiAgQmFja2JvbmUuVkVSU0lPTiA9ICcxLjEuMic7CgogIC8vIEZvciBCYWNrYm9uZSdzIHB1cnBvc2VzLCBqUXVlcnksIFplcHRvLCBFbmRlciwgb3IgTXkgTGlicmFyeSAoa2lkZGluZykgb3ducwogIC8vIHRoZSBgJGAgdmFyaWFibGUuCiAgQmFja2JvbmUuJCA9ICQ7CgogIC8vIFJ1bnMgQmFja2JvbmUuanMgaW4gKm5vQ29uZmxpY3QqIG1vZGUsIHJldHVybmluZyB0aGUgYEJhY2tib25lYCB2YXJpYWJsZQogIC8vIHRvIGl0cyBwcmV2aW91cyBvd25lci4gUmV0dXJucyBhIHJlZmVyZW5jZSB0byB0aGlzIEJhY2tib25lIG9iamVjdC4KICBCYWNrYm9uZS5ub0NvbmZsaWN0ID0gZnVuY3Rpb24oKSB7CiAgICByb290LkJhY2tib25lID0gcHJldmlvdXNCYWNrYm9uZTsKICAgIHJldHVybiB0aGlzOwogIH07CgogIC8vIFR1cm4gb24gYGVtdWxhdGVIVFRQYCB0byBzdXBwb3J0IGxlZ2FjeSBIVFRQIHNlcnZlcnMuIFNldHRpbmcgdGhpcyBvcHRpb24KICAvLyB3aWxsIGZha2UgYCJQQVRDSCJgLCBgIlBVVCJgIGFuZCBgIkRFTEVURSJgIHJlcXVlc3RzIHZpYSB0aGUgYF9tZXRob2RgIHBhcmFtZXRlciBhbmQKICAvLyBzZXQgYSBgWC1IdHRwLU1ldGhvZC1PdmVycmlkZWAgaGVhZGVyLgogIEJhY2tib25lLmVtdWxhdGVIVFRQID0gZmFsc2U7CgogIC8vIFR1cm4gb24gYGVtdWxhdGVKU09OYCB0byBzdXBwb3J0IGxlZ2FjeSBzZXJ2ZXJzIHRoYXQgY2FuJ3QgZGVhbCB3aXRoIGRpcmVjdAogIC8vIGBhcHBsaWNhdGlvbi9qc29uYCByZXF1ZXN0cyAuLi4gd2lsbCBlbmNvZGUgdGhlIGJvZHkgYXMKICAvLyBgYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkYCBpbnN0ZWFkIGFuZCB3aWxsIHNlbmQgdGhlIG1vZGVsIGluIGEKICAvLyBmb3JtIHBhcmFtIG5hbWVkIGBtb2RlbGAuCiAgQmFja2JvbmUuZW11bGF0ZUpTT04gPSBmYWxzZTsKCiAgLy8gQmFja2JvbmUuRXZlbnRzCiAgLy8gLS0tLS0tLS0tLS0tLS0tCgogIC8vIEEgbW9kdWxlIHRoYXQgY2FuIGJlIG1peGVkIGluIHRvICphbnkgb2JqZWN0KiBpbiBvcmRlciB0byBwcm92aWRlIGl0IHdpdGgKICAvLyBjdXN0b20gZXZlbnRzLiBZb3UgbWF5IGJpbmQgd2l0aCBgb25gIG9yIHJlbW92ZSB3aXRoIGBvZmZgIGNhbGxiYWNrCiAgLy8gZnVuY3Rpb25zIHRvIGFuIGV2ZW50OyBgdHJpZ2dlcmAtaW5nIGFuIGV2ZW50IGZpcmVzIGFsbCBjYWxsYmFja3MgaW4KICAvLyBzdWNjZXNzaW9uLgogIC8vCiAgLy8gICAgIHZhciBvYmplY3QgPSB7fTsKICAvLyAgICAgXy5leHRlbmQob2JqZWN0LCBCYWNrYm9uZS5FdmVudHMpOwogIC8vICAgICBvYmplY3Qub24oJ2V4cGFuZCcsIGZ1bmN0aW9uKCl7IGFsZXJ0KCdleHBhbmRlZCcpOyB9KTsKICAvLyAgICAgb2JqZWN0LnRyaWdnZXIoJ2V4cGFuZCcpOwogIC8vCiAgdmFyIEV2ZW50cyA9IEJhY2tib25lLkV2ZW50cyA9IHsKCiAgICAvLyBCaW5kIGFuIGV2ZW50IHRvIGEgYGNhbGxiYWNrYCBmdW5jdGlvbi4gUGFzc2luZyBgImFsbCJgIHdpbGwgYmluZAogICAgLy8gdGhlIGNhbGxiYWNrIHRvIGFsbCBldmVudHMgZmlyZWQuCiAgICBvbjogZnVuY3Rpb24obmFtZSwgY2FsbGJhY2ssIGNvbnRleHQpIHsKICAgICAgaWYgKCFldmVudHNBcGkodGhpcywgJ29uJywgbmFtZSwgW2NhbGxiYWNrLCBjb250ZXh0XSkgfHwgIWNhbGxiYWNrKSByZXR1cm4gdGhpczsKICAgICAgdGhpcy5fZXZlbnRzIHx8ICh0aGlzLl9ldmVudHMgPSB7fSk7CiAgICAgIHZhciBldmVudHMgPSB0aGlzLl9ldmVudHNbbmFtZV0gfHwgKHRoaXMuX2V2ZW50c1tuYW1lXSA9IFtdKTsKICAgICAgZXZlbnRzLnB1c2goe2NhbGxiYWNrOiBjYWxsYmFjaywgY29udGV4dDogY29udGV4dCwgY3R4OiBjb250ZXh0IHx8IHRoaXN9KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAoKICAgIC8vIEJpbmQgYW4gZXZlbnQgdG8gb25seSBiZSB0cmlnZ2VyZWQgYSBzaW5nbGUgdGltZS4gQWZ0ZXIgdGhlIGZpcnN0IHRpbWUKICAgIC8vIHRoZSBjYWxsYmFjayBpcyBpbnZva2VkLCBpdCB3aWxsIGJlIHJlbW92ZWQuCiAgICBvbmNlOiBmdW5jdGlvbihuYW1lLCBjYWxsYmFjaywgY29udGV4dCkgewogICAgICBpZiAoIWV2ZW50c0FwaSh0aGlzLCAnb25jZScsIG5hbWUsIFtjYWxsYmFjaywgY29udGV4dF0pIHx8ICFjYWxsYmFjaykgcmV0dXJuIHRoaXM7CiAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgdmFyIG9uY2UgPSBfLm9uY2UoZnVuY3Rpb24oKSB7CiAgICAgICAgc2VsZi5vZmYobmFtZSwgb25jZSk7CiAgICAgICAgY2FsbGJhY2suYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfSk7CiAgICAgIG9uY2UuX2NhbGxiYWNrID0gY2FsbGJhY2s7CiAgICAgIHJldHVybiB0aGlzLm9uKG5hbWUsIG9uY2UsIGNvbnRleHQpOwogICAgfSwKCiAgICAvLyBSZW1vdmUgb25lIG9yIG1hbnkgY2FsbGJhY2tzLiBJZiBgY29udGV4dGAgaXMgbnVsbCwgcmVtb3ZlcyBhbGwKICAgIC8vIGNhbGxiYWNrcyB3aXRoIHRoYXQgZnVuY3Rpb24uIElmIGBjYWxsYmFja2AgaXMgbnVsbCwgcmVtb3ZlcyBhbGwKICAgIC8vIGNhbGxiYWNrcyBmb3IgdGhlIGV2ZW50LiBJZiBgbmFtZWAgaXMgbnVsbCwgcmVtb3ZlcyBhbGwgYm91bmQKICAgIC8vIGNhbGxiYWNrcyBmb3IgYWxsIGV2ZW50cy4KICAgIG9mZjogZnVuY3Rpb24obmFtZSwgY2FsbGJhY2ssIGNvbnRleHQpIHsKICAgICAgdmFyIHJldGFpbiwgZXYsIGV2ZW50cywgbmFtZXMsIGksIGwsIGosIGs7CiAgICAgIGlmICghdGhpcy5fZXZlbnRzIHx8ICFldmVudHNBcGkodGhpcywgJ29mZicsIG5hbWUsIFtjYWxsYmFjaywgY29udGV4dF0pKSByZXR1cm4gdGhpczsKICAgICAgaWYgKCFuYW1lICYmICFjYWxsYmFjayAmJiAhY29udGV4dCkgewogICAgICAgIHRoaXMuX2V2ZW50cyA9IHZvaWQgMDsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICBuYW1lcyA9IG5hbWUgPyBbbmFtZV0gOiBfLmtleXModGhpcy5fZXZlbnRzKTsKICAgICAgZm9yIChpID0gMCwgbCA9IG5hbWVzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIG5hbWUgPSBuYW1lc1tpXTsKICAgICAgICBpZiAoZXZlbnRzID0gdGhpcy5fZXZlbnRzW25hbWVdKSB7CiAgICAgICAgICB0aGlzLl9ldmVudHNbbmFtZV0gPSByZXRhaW4gPSBbXTsKICAgICAgICAgIGlmIChjYWxsYmFjayB8fCBjb250ZXh0KSB7CiAgICAgICAgICAgIGZvciAoaiA9IDAsIGsgPSBldmVudHMubGVuZ3RoOyBqIDwgazsgaisrKSB7CiAgICAgICAgICAgICAgZXYgPSBldmVudHNbal07CiAgICAgICAgICAgICAgaWYgKChjYWxsYmFjayAmJiBjYWxsYmFjayAhPT0gZXYuY2FsbGJhY2sgJiYgY2FsbGJhY2sgIT09IGV2LmNhbGxiYWNrLl9jYWxsYmFjaykgfHwKICAgICAgICAgICAgICAgICAgKGNvbnRleHQgJiYgY29udGV4dCAhPT0gZXYuY29udGV4dCkpIHsKICAgICAgICAgICAgICAgIHJldGFpbi5wdXNoKGV2KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGlmICghcmV0YWluLmxlbmd0aCkgZGVsZXRlIHRoaXMuX2V2ZW50c1tuYW1lXTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvLyBUcmlnZ2VyIG9uZSBvciBtYW55IGV2ZW50cywgZmlyaW5nIGFsbCBib3VuZCBjYWxsYmFja3MuIENhbGxiYWNrcyBhcmUKICAgIC8vIHBhc3NlZCB0aGUgc2FtZSBhcmd1bWVudHMgYXMgYHRyaWdnZXJgIGlzLCBhcGFydCBmcm9tIHRoZSBldmVudCBuYW1lCiAgICAvLyAodW5sZXNzIHlvdSdyZSBsaXN0ZW5pbmcgb24gYCJhbGwiYCwgd2hpY2ggd2lsbCBjYXVzZSB5b3VyIGNhbGxiYWNrIHRvCiAgICAvLyByZWNlaXZlIHRoZSB0cnVlIG5hbWUgb2YgdGhlIGV2ZW50IGFzIHRoZSBmaXJzdCBhcmd1bWVudCkuCiAgICB0cmlnZ2VyOiBmdW5jdGlvbihuYW1lKSB7CiAgICAgIGlmICghdGhpcy5fZXZlbnRzKSByZXR1cm4gdGhpczsKICAgICAgdmFyIGFyZ3MgPSBzbGljZS5jYWxsKGFyZ3VtZW50cywgMSk7CiAgICAgIGlmICghZXZlbnRzQXBpKHRoaXMsICd0cmlnZ2VyJywgbmFtZSwgYXJncykpIHJldHVybiB0aGlzOwogICAgICB2YXIgZXZlbnRzID0gdGhpcy5fZXZlbnRzW25hbWVdOwogICAgICB2YXIgYWxsRXZlbnRzID0gdGhpcy5fZXZlbnRzLmFsbDsKICAgICAgaWYgKGV2ZW50cykgdHJpZ2dlckV2ZW50cyhldmVudHMsIGFyZ3MpOwogICAgICBpZiAoYWxsRXZlbnRzKSB0cmlnZ2VyRXZlbnRzKGFsbEV2ZW50cywgYXJndW1lbnRzKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAoKICAgIC8vIFRlbGwgdGhpcyBvYmplY3QgdG8gc3RvcCBsaXN0ZW5pbmcgdG8gZWl0aGVyIHNwZWNpZmljIGV2ZW50cyAuLi4gb3IKICAgIC8vIHRvIGV2ZXJ5IG9iamVjdCBpdCdzIGN1cnJlbnRseSBsaXN0ZW5pbmcgdG8uCiAgICBzdG9wTGlzdGVuaW5nOiBmdW5jdGlvbihvYmosIG5hbWUsIGNhbGxiYWNrKSB7CiAgICAgIHZhciBsaXN0ZW5pbmdUbyA9IHRoaXMuX2xpc3RlbmluZ1RvOwogICAgICBpZiAoIWxpc3RlbmluZ1RvKSByZXR1cm4gdGhpczsKICAgICAgdmFyIHJlbW92ZSA9ICFuYW1lICYmICFjYWxsYmFjazsKICAgICAgaWYgKCFjYWxsYmFjayAmJiB0eXBlb2YgbmFtZSA9PT0gJ29iamVjdCcpIGNhbGxiYWNrID0gdGhpczsKICAgICAgaWYgKG9iaikgKGxpc3RlbmluZ1RvID0ge30pW29iai5fbGlzdGVuSWRdID0gb2JqOwogICAgICBmb3IgKHZhciBpZCBpbiBsaXN0ZW5pbmdUbykgewogICAgICAgIG9iaiA9IGxpc3RlbmluZ1RvW2lkXTsKICAgICAgICBvYmoub2ZmKG5hbWUsIGNhbGxiYWNrLCB0aGlzKTsKICAgICAgICBpZiAocmVtb3ZlIHx8IF8uaXNFbXB0eShvYmouX2V2ZW50cykpIGRlbGV0ZSB0aGlzLl9saXN0ZW5pbmdUb1tpZF07CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogIH07CgogIC8vIFJlZ3VsYXIgZXhwcmVzc2lvbiB1c2VkIHRvIHNwbGl0IGV2ZW50IHN0cmluZ3MuCiAgdmFyIGV2ZW50U3BsaXR0ZXIgPSAvXHMrLzsKCiAgLy8gSW1wbGVtZW50IGZhbmN5IGZlYXR1cmVzIG9mIHRoZSBFdmVudHMgQVBJIHN1Y2ggYXMgbXVsdGlwbGUgZXZlbnQKICAvLyBuYW1lcyBgImNoYW5nZSBibHVyImAgYW5kIGpRdWVyeS1zdHlsZSBldmVudCBtYXBzIGB7Y2hhbmdlOiBhY3Rpb259YAogIC8vIGluIHRlcm1zIG9mIHRoZSBleGlzdGluZyBBUEkuCiAgdmFyIGV2ZW50c0FwaSA9IGZ1bmN0aW9uKG9iaiwgYWN0aW9uLCBuYW1lLCByZXN0KSB7CiAgICBpZiAoIW5hbWUpIHJldHVybiB0cnVlOwoKICAgIC8vIEhhbmRsZSBldmVudCBtYXBzLgogICAgaWYgKHR5cGVvZiBuYW1lID09PSAnb2JqZWN0JykgewogICAgICBmb3IgKHZhciBrZXkgaW4gbmFtZSkgewogICAgICAgIG9ialthY3Rpb25dLmFwcGx5KG9iaiwgW2tleSwgbmFtZVtrZXldXS5jb25jYXQocmVzdCkpOwogICAgICB9CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvLyBIYW5kbGUgc3BhY2Ugc2VwYXJhdGVkIGV2ZW50IG5hbWVzLgogICAgaWYgKGV2ZW50U3BsaXR0ZXIudGVzdChuYW1lKSkgewogICAgICB2YXIgbmFtZXMgPSBuYW1lLnNwbGl0KGV2ZW50U3BsaXR0ZXIpOwogICAgICBmb3IgKHZhciBpID0gMCwgbCA9IG5hbWVzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIG9ialthY3Rpb25dLmFwcGx5KG9iaiwgW25hbWVzW2ldXS5jb25jYXQocmVzdCkpOwogICAgICB9CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICByZXR1cm4gdHJ1ZTsKICB9OwoKICAvLyBBIGRpZmZpY3VsdC10by1iZWxpZXZlLCBidXQgb3B0aW1pemVkIGludGVybmFsIGRpc3BhdGNoIGZ1bmN0aW9uIGZvcgogIC8vIHRyaWdnZXJpbmcgZXZlbnRzLiBUcmllcyB0byBrZWVwIHRoZSB1c3VhbCBjYXNlcyBzcGVlZHkgKG1vc3QgaW50ZXJuYWwKICAvLyBCYWNrYm9uZSBldmVudHMgaGF2ZSAzIGFyZ3VtZW50cykuCiAgdmFyIHRyaWdnZXJFdmVudHMgPSBmdW5jdGlvbihldmVudHMsIGFyZ3MpIHsKICAgIHZhciBldiwgaSA9IC0xLCBsID0gZXZlbnRzLmxlbmd0aCwgYTEgPSBhcmdzWzBdLCBhMiA9IGFyZ3NbMV0sIGEzID0gYXJnc1syXTsKICAgIHN3aXRjaCAoYXJncy5sZW5ndGgpIHsKICAgICAgY2FzZSAwOiB3aGlsZSAoKytpIDwgbCkgKGV2ID0gZXZlbnRzW2ldKS5jYWxsYmFjay5jYWxsKGV2LmN0eCk7IHJldHVybjsKICAgICAgY2FzZSAxOiB3aGlsZSAoKytpIDwgbCkgKGV2ID0gZXZlbnRzW2ldKS5jYWxsYmFjay5jYWxsKGV2LmN0eCwgYTEpOyByZXR1cm47CiAgICAgIGNhc2UgMjogd2hpbGUgKCsraSA8IGwpIChldiA9IGV2ZW50c1tpXSkuY2FsbGJhY2suY2FsbChldi5jdHgsIGExLCBhMik7IHJldHVybjsKICAgICAgY2FzZSAzOiB3aGlsZSAoKytpIDwgbCkgKGV2ID0gZXZlbnRzW2ldKS5jYWxsYmFjay5jYWxsKGV2LmN0eCwgYTEsIGEyLCBhMyk7IHJldHVybjsKICAgICAgZGVmYXVsdDogd2hpbGUgKCsraSA8IGwpIChldiA9IGV2ZW50c1tpXSkuY2FsbGJhY2suYXBwbHkoZXYuY3R4LCBhcmdzKTsgcmV0dXJuOwogICAgfQogIH07CgogIHZhciBsaXN0ZW5NZXRob2RzID0ge2xpc3RlblRvOiAnb24nLCBsaXN0ZW5Ub09uY2U6ICdvbmNlJ307CgogIC8vIEludmVyc2lvbi1vZi1jb250cm9sIHZlcnNpb25zIG9mIGBvbmAgYW5kIGBvbmNlYC4gVGVsbCAqdGhpcyogb2JqZWN0IHRvCiAgLy8gbGlzdGVuIHRvIGFuIGV2ZW50IGluIGFub3RoZXIgb2JqZWN0IC4uLiBrZWVwaW5nIHRyYWNrIG9mIHdoYXQgaXQncwogIC8vIGxpc3RlbmluZyB0by4KICBfLmVhY2gobGlzdGVuTWV0aG9kcywgZnVuY3Rpb24oaW1wbGVtZW50YXRpb24sIG1ldGhvZCkgewogICAgRXZlbnRzW21ldGhvZF0gPSBmdW5jdGlvbihvYmosIG5hbWUsIGNhbGxiYWNrKSB7CiAgICAgIHZhciBsaXN0ZW5pbmdUbyA9IHRoaXMuX2xpc3RlbmluZ1RvIHx8ICh0aGlzLl9saXN0ZW5pbmdUbyA9IHt9KTsKICAgICAgdmFyIGlkID0gb2JqLl9saXN0ZW5JZCB8fCAob2JqLl9saXN0ZW5JZCA9IF8udW5pcXVlSWQoJ2wnKSk7CiAgICAgIGxpc3RlbmluZ1RvW2lkXSA9IG9iajsKICAgICAgaWYgKCFjYWxsYmFjayAmJiB0eXBlb2YgbmFtZSA9PT0gJ29iamVjdCcpIGNhbGxiYWNrID0gdGhpczsKICAgICAgb2JqW2ltcGxlbWVudGF0aW9uXShuYW1lLCBjYWxsYmFjaywgdGhpcyk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfTsKICB9KTsKCiAgLy8gQWxpYXNlcyBmb3IgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkuCiAgRXZlbnRzLmJpbmQgICA9IEV2ZW50cy5vbjsKICBFdmVudHMudW5iaW5kID0gRXZlbnRzLm9mZjsKCiAgLy8gQWxsb3cgdGhlIGBCYWNrYm9uZWAgb2JqZWN0IHRvIHNlcnZlIGFzIGEgZ2xvYmFsIGV2ZW50IGJ1cywgZm9yIGZvbGtzIHdobwogIC8vIHdhbnQgZ2xvYmFsICJwdWJzdWIiIGluIGEgY29udmVuaWVudCBwbGFjZS4KICBfLmV4dGVuZChCYWNrYm9uZSwgRXZlbnRzKTsKCiAgLy8gQmFja2JvbmUuTW9kZWwKICAvLyAtLS0tLS0tLS0tLS0tLQoKICAvLyBCYWNrYm9uZSAqKk1vZGVscyoqIGFyZSB0aGUgYmFzaWMgZGF0YSBvYmplY3QgaW4gdGhlIGZyYW1ld29yayAtLQogIC8vIGZyZXF1ZW50bHkgcmVwcmVzZW50aW5nIGEgcm93IGluIGEgdGFibGUgaW4gYSBkYXRhYmFzZSBvbiB5b3VyIHNlcnZlci4KICAvLyBBIGRpc2NyZXRlIGNodW5rIG9mIGRhdGEgYW5kIGEgYnVuY2ggb2YgdXNlZnVsLCByZWxhdGVkIG1ldGhvZHMgZm9yCiAgLy8gcGVyZm9ybWluZyBjb21wdXRhdGlvbnMgYW5kIHRyYW5zZm9ybWF0aW9ucyBvbiB0aGF0IGRhdGEuCgogIC8vIENyZWF0ZSBhIG5ldyBtb2RlbCB3aXRoIHRoZSBzcGVjaWZpZWQgYXR0cmlidXRlcy4gQSBjbGllbnQgaWQgKGBjaWRgKQogIC8vIGlzIGF1dG9tYXRpY2FsbHkgZ2VuZXJhdGVkIGFuZCBhc3NpZ25lZCBmb3IgeW91LgogIHZhciBNb2RlbCA9IEJhY2tib25lLk1vZGVsID0gZnVuY3Rpb24oYXR0cmlidXRlcywgb3B0aW9ucykgewogICAgdmFyIGF0dHJzID0gYXR0cmlidXRlcyB8fCB7fTsKICAgIG9wdGlvbnMgfHwgKG9wdGlvbnMgPSB7fSk7CiAgICB0aGlzLmNpZCA9IF8udW5pcXVlSWQoJ2MnKTsKICAgIHRoaXMuYXR0cmlidXRlcyA9IHt9OwogICAgaWYgKG9wdGlvbnMuY29sbGVjdGlvbikgdGhpcy5jb2xsZWN0aW9uID0gb3B0aW9ucy5jb2xsZWN0aW9uOwogICAgaWYgKG9wdGlvbnMucGFyc2UpIGF0dHJzID0gdGhpcy5wYXJzZShhdHRycywgb3B0aW9ucykgfHwge307CiAgICBhdHRycyA9IF8uZGVmYXVsdHMoe30sIGF0dHJzLCBfLnJlc3VsdCh0aGlzLCAnZGVmYXVsdHMnKSk7CiAgICB0aGlzLnNldChhdHRycywgb3B0aW9ucyk7CiAgICB0aGlzLmNoYW5nZWQgPSB7fTsKICAgIHRoaXMuaW5pdGlhbGl6ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogIH07CgogIC8vIEF0dGFjaCBhbGwgaW5oZXJpdGFibGUgbWV0aG9kcyB0byB0aGUgTW9kZWwgcHJvdG90eXBlLgogIF8uZXh0ZW5kKE1vZGVsLnByb3RvdHlwZSwgRXZlbnRzLCB7CgogICAgLy8gQSBoYXNoIG9mIGF0dHJpYnV0ZXMgd2hvc2UgY3VycmVudCBhbmQgcHJldmlvdXMgdmFsdWUgZGlmZmVyLgogICAgY2hhbmdlZDogbnVsbCwKCiAgICAvLyBUaGUgdmFsdWUgcmV0dXJuZWQgZHVyaW5nIHRoZSBsYXN0IGZhaWxlZCB2YWxpZGF0aW9uLgogICAgdmFsaWRhdGlvbkVycm9yOiBudWxsLAoKICAgIC8vIFRoZSBkZWZhdWx0IG5hbWUgZm9yIHRoZSBKU09OIGBpZGAgYXR0cmlidXRlIGlzIGAiaWQiYC4gTW9uZ29EQiBhbmQKICAgIC8vIENvdWNoREIgdXNlcnMgbWF5IHdhbnQgdG8gc2V0IHRoaXMgdG8gYCJfaWQiYC4KICAgIGlkQXR0cmlidXRlOiAnaWQnLAoKICAgIC8vIEluaXRpYWxpemUgaXMgYW4gZW1wdHkgZnVuY3Rpb24gYnkgZGVmYXVsdC4gT3ZlcnJpZGUgaXQgd2l0aCB5b3VyIG93bgogICAgLy8gaW5pdGlhbGl6YXRpb24gbG9naWMuCiAgICBpbml0aWFsaXplOiBmdW5jdGlvbigpe30sCgogICAgLy8gUmV0dXJuIGEgY29weSBvZiB0aGUgbW9kZWwncyBgYXR0cmlidXRlc2Agb2JqZWN0LgogICAgdG9KU09OOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgIHJldHVybiBfLmNsb25lKHRoaXMuYXR0cmlidXRlcyk7CiAgICB9LAoKICAgIC8vIFByb3h5IGBCYWNrYm9uZS5zeW5jYCBieSBkZWZhdWx0IC0tIGJ1dCBvdmVycmlkZSB0aGlzIGlmIHlvdSBuZWVkCiAgICAvLyBjdXN0b20gc3luY2luZyBzZW1hbnRpY3MgZm9yICp0aGlzKiBwYXJ0aWN1bGFyIG1vZGVsLgogICAgc3luYzogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBCYWNrYm9uZS5zeW5jLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICB9LAoKICAgIC8vIEdldCB0aGUgdmFsdWUgb2YgYW4gYXR0cmlidXRlLgogICAgZ2V0OiBmdW5jdGlvbihhdHRyKSB7CiAgICAgIHJldHVybiB0aGlzLmF0dHJpYnV0ZXNbYXR0cl07CiAgICB9LAoKICAgIC8vIEdldCB0aGUgSFRNTC1lc2NhcGVkIHZhbHVlIG9mIGFuIGF0dHJpYnV0ZS4KICAgIGVzY2FwZTogZnVuY3Rpb24oYXR0cikgewogICAgICByZXR1cm4gXy5lc2NhcGUodGhpcy5nZXQoYXR0cikpOwogICAgfSwKCiAgICAvLyBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgYXR0cmlidXRlIGNvbnRhaW5zIGEgdmFsdWUgdGhhdCBpcyBub3QgbnVsbAogICAgLy8gb3IgdW5kZWZpbmVkLgogICAgaGFzOiBmdW5jdGlvbihhdHRyKSB7CiAgICAgIHJldHVybiB0aGlzLmdldChhdHRyKSAhPSBudWxsOwogICAgfSwKCiAgICAvLyBTZXQgYSBoYXNoIG9mIG1vZGVsIGF0dHJpYnV0ZXMgb24gdGhlIG9iamVjdCwgZmlyaW5nIGAiY2hhbmdlImAuIFRoaXMgaXMKICAgIC8vIHRoZSBjb3JlIHByaW1pdGl2ZSBvcGVyYXRpb24gb2YgYSBtb2RlbCwgdXBkYXRpbmcgdGhlIGRhdGEgYW5kIG5vdGlmeWluZwogICAgLy8gYW55b25lIHdobyBuZWVkcyB0byBrbm93IGFib3V0IHRoZSBjaGFuZ2UgaW4gc3RhdGUuIFRoZSBoZWFydCBvZiB0aGUgYmVhc3QuCiAgICBzZXQ6IGZ1bmN0aW9uKGtleSwgdmFsLCBvcHRpb25zKSB7CiAgICAgIHZhciBhdHRyLCBhdHRycywgdW5zZXQsIGNoYW5nZXMsIHNpbGVudCwgY2hhbmdpbmcsIHByZXYsIGN1cnJlbnQ7CiAgICAgIGlmIChrZXkgPT0gbnVsbCkgcmV0dXJuIHRoaXM7CgogICAgICAvLyBIYW5kbGUgYm90aCBgImtleSIsIHZhbHVlYCBhbmQgYHtrZXk6IHZhbHVlfWAgLXN0eWxlIGFyZ3VtZW50cy4KICAgICAgaWYgKHR5cGVvZiBrZXkgPT09ICdvYmplY3QnKSB7CiAgICAgICAgYXR0cnMgPSBrZXk7CiAgICAgICAgb3B0aW9ucyA9IHZhbDsKICAgICAgfSBlbHNlIHsKICAgICAgICAoYXR0cnMgPSB7fSlba2V5XSA9IHZhbDsKICAgICAgfQoKICAgICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTsKCiAgICAgIC8vIFJ1biB2YWxpZGF0aW9uLgogICAgICBpZiAoIXRoaXMuX3ZhbGlkYXRlKGF0dHJzLCBvcHRpb25zKSkgcmV0dXJuIGZhbHNlOwoKICAgICAgLy8gRXh0cmFjdCBhdHRyaWJ1dGVzIGFuZCBvcHRpb25zLgogICAgICB1bnNldCAgICAgICAgICAgPSBvcHRpb25zLnVuc2V0OwogICAgICBzaWxlbnQgICAgICAgICAgPSBvcHRpb25zLnNpbGVudDsKICAgICAgY2hhbmdlcyAgICAgICAgID0gW107CiAgICAgIGNoYW5naW5nICAgICAgICA9IHRoaXMuX2NoYW5naW5nOwogICAgICB0aGlzLl9jaGFuZ2luZyAgPSB0cnVlOwoKICAgICAgaWYgKCFjaGFuZ2luZykgewogICAgICAgIHRoaXMuX3ByZXZpb3VzQXR0cmlidXRlcyA9IF8uY2xvbmUodGhpcy5hdHRyaWJ1dGVzKTsKICAgICAgICB0aGlzLmNoYW5nZWQgPSB7fTsKICAgICAgfQogICAgICBjdXJyZW50ID0gdGhpcy5hdHRyaWJ1dGVzLCBwcmV2ID0gdGhpcy5fcHJldmlvdXNBdHRyaWJ1dGVzOwoKICAgICAgLy8gQ2hlY2sgZm9yIGNoYW5nZXMgb2YgYGlkYC4KICAgICAgaWYgKHRoaXMuaWRBdHRyaWJ1dGUgaW4gYXR0cnMpIHRoaXMuaWQgPSBhdHRyc1t0aGlzLmlkQXR0cmlidXRlXTsKCiAgICAgIC8vIEZvciBlYWNoIGBzZXRgIGF0dHJpYnV0ZSwgdXBkYXRlIG9yIGRlbGV0ZSB0aGUgY3VycmVudCB2YWx1ZS4KICAgICAgZm9yIChhdHRyIGluIGF0dHJzKSB7CiAgICAgICAgdmFsID0gYXR0cnNbYXR0cl07CiAgICAgICAgaWYgKCFfLmlzRXF1YWwoY3VycmVudFthdHRyXSwgdmFsKSkgY2hhbmdlcy5wdXNoKGF0dHIpOwogICAgICAgIGlmICghXy5pc0VxdWFsKHByZXZbYXR0cl0sIHZhbCkpIHsKICAgICAgICAgIHRoaXMuY2hhbmdlZFthdHRyXSA9IHZhbDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZGVsZXRlIHRoaXMuY2hhbmdlZFthdHRyXTsKICAgICAgICB9CiAgICAgICAgdW5zZXQgPyBkZWxldGUgY3VycmVudFthdHRyXSA6IGN1cnJlbnRbYXR0cl0gPSB2YWw7CiAgICAgIH0KCiAgICAgIC8vIFRyaWdnZXIgYWxsIHJlbGV2YW50IGF0dHJpYnV0ZSBjaGFuZ2VzLgogICAgICBpZiAoIXNpbGVudCkgewogICAgICAgIGlmIChjaGFuZ2VzLmxlbmd0aCkgdGhpcy5fcGVuZGluZyA9IG9wdGlvbnM7CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSBjaGFuZ2VzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgICAgdGhpcy50cmlnZ2VyKCdjaGFuZ2U6JyArIGNoYW5nZXNbaV0sIHRoaXMsIGN1cnJlbnRbY2hhbmdlc1tpXV0sIG9wdGlvbnMpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgLy8gWW91IG1pZ2h0IGJlIHdvbmRlcmluZyB3aHkgdGhlcmUncyBhIGB3aGlsZWAgbG9vcCBoZXJlLiBDaGFuZ2VzIGNhbgogICAgICAvLyBiZSByZWN1cnNpdmVseSBuZXN0ZWQgd2l0aGluIGAiY2hhbmdlImAgZXZlbnRzLgogICAgICBpZiAoY2hhbmdpbmcpIHJldHVybiB0aGlzOwogICAgICBpZiAoIXNpbGVudCkgewogICAgICAgIHdoaWxlICh0aGlzLl9wZW5kaW5nKSB7CiAgICAgICAgICBvcHRpb25zID0gdGhpcy5fcGVuZGluZzsKICAgICAgICAgIHRoaXMuX3BlbmRpbmcgPSBmYWxzZTsKICAgICAgICAgIHRoaXMudHJpZ2dlcignY2hhbmdlJywgdGhpcywgb3B0aW9ucyk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMuX3BlbmRpbmcgPSBmYWxzZTsKICAgICAgdGhpcy5fY2hhbmdpbmcgPSBmYWxzZTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAoKICAgIC8vIFJlbW92ZSBhbiBhdHRyaWJ1dGUgZnJvbSB0aGUgbW9kZWwsIGZpcmluZyBgImNoYW5nZSJgLiBgdW5zZXRgIGlzIGEgbm9vcAogICAgLy8gaWYgdGhlIGF0dHJpYnV0ZSBkb2Vzbid0IGV4aXN0LgogICAgdW5zZXQ6IGZ1bmN0aW9uKGF0dHIsIG9wdGlvbnMpIHsKICAgICAgcmV0dXJuIHRoaXMuc2V0KGF0dHIsIHZvaWQgMCwgXy5leHRlbmQoe30sIG9wdGlvbnMsIHt1bnNldDogdHJ1ZX0pKTsKICAgIH0sCgogICAgLy8gQ2xlYXIgYWxsIGF0dHJpYnV0ZXMgb24gdGhlIG1vZGVsLCBmaXJpbmcgYCJjaGFuZ2UiYC4KICAgIGNsZWFyOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgIHZhciBhdHRycyA9IHt9OwogICAgICBmb3IgKHZhciBrZXkgaW4gdGhpcy5hdHRyaWJ1dGVzKSBhdHRyc1trZXldID0gdm9pZCAwOwogICAgICByZXR1cm4gdGhpcy5zZXQoYXR0cnMsIF8uZXh0ZW5kKHt9LCBvcHRpb25zLCB7dW5zZXQ6IHRydWV9KSk7CiAgICB9LAoKICAgIC8vIERldGVybWluZSBpZiB0aGUgbW9kZWwgaGFzIGNoYW5nZWQgc2luY2UgdGhlIGxhc3QgYCJjaGFuZ2UiYCBldmVudC4KICAgIC8vIElmIHlvdSBzcGVjaWZ5IGFuIGF0dHJpYnV0ZSBuYW1lLCBkZXRlcm1pbmUgaWYgdGhhdCBhdHRyaWJ1dGUgaGFzIGNoYW5nZWQuCiAgICBoYXNDaGFuZ2VkOiBmdW5jdGlvbihhdHRyKSB7CiAgICAgIGlmIChhdHRyID09IG51bGwpIHJldHVybiAhXy5pc0VtcHR5KHRoaXMuY2hhbmdlZCk7CiAgICAgIHJldHVybiBfLmhhcyh0aGlzLmNoYW5nZWQsIGF0dHIpOwogICAgfSwKCiAgICAvLyBSZXR1cm4gYW4gb2JqZWN0IGNvbnRhaW5pbmcgYWxsIHRoZSBhdHRyaWJ1dGVzIHRoYXQgaGF2ZSBjaGFuZ2VkLCBvcgogICAgLy8gZmFsc2UgaWYgdGhlcmUgYXJlIG5vIGNoYW5nZWQgYXR0cmlidXRlcy4gVXNlZnVsIGZvciBkZXRlcm1pbmluZyB3aGF0CiAgICAvLyBwYXJ0cyBvZiBhIHZpZXcgbmVlZCB0byBiZSB1cGRhdGVkIGFuZC9vciB3aGF0IGF0dHJpYnV0ZXMgbmVlZCB0byBiZQogICAgLy8gcGVyc2lzdGVkIHRvIHRoZSBzZXJ2ZXIuIFVuc2V0IGF0dHJpYnV0ZXMgd2lsbCBiZSBzZXQgdG8gdW5kZWZpbmVkLgogICAgLy8gWW91IGNhbiBhbHNvIHBhc3MgYW4gYXR0cmlidXRlcyBvYmplY3QgdG8gZGlmZiBhZ2FpbnN0IHRoZSBtb2RlbCwKICAgIC8vIGRldGVybWluaW5nIGlmIHRoZXJlICp3b3VsZCBiZSogYSBjaGFuZ2UuCiAgICBjaGFuZ2VkQXR0cmlidXRlczogZnVuY3Rpb24oZGlmZikgewogICAgICBpZiAoIWRpZmYpIHJldHVybiB0aGlzLmhhc0NoYW5nZWQoKSA/IF8uY2xvbmUodGhpcy5jaGFuZ2VkKSA6IGZhbHNlOwogICAgICB2YXIgdmFsLCBjaGFuZ2VkID0gZmFsc2U7CiAgICAgIHZhciBvbGQgPSB0aGlzLl9jaGFuZ2luZyA/IHRoaXMuX3ByZXZpb3VzQXR0cmlidXRlcyA6IHRoaXMuYXR0cmlidXRlczsKICAgICAgZm9yICh2YXIgYXR0ciBpbiBkaWZmKSB7CiAgICAgICAgaWYgKF8uaXNFcXVhbChvbGRbYXR0cl0sICh2YWwgPSBkaWZmW2F0dHJdKSkpIGNvbnRpbnVlOwogICAgICAgIChjaGFuZ2VkIHx8IChjaGFuZ2VkID0ge30pKVthdHRyXSA9IHZhbDsKICAgICAgfQogICAgICByZXR1cm4gY2hhbmdlZDsKICAgIH0sCgogICAgLy8gR2V0IHRoZSBwcmV2aW91cyB2YWx1ZSBvZiBhbiBhdHRyaWJ1dGUsIHJlY29yZGVkIGF0IHRoZSB0aW1lIHRoZSBsYXN0CiAgICAvLyBgImNoYW5nZSJgIGV2ZW50IHdhcyBmaXJlZC4KICAgIHByZXZpb3VzOiBmdW5jdGlvbihhdHRyKSB7CiAgICAgIGlmIChhdHRyID09IG51bGwgfHwgIXRoaXMuX3ByZXZpb3VzQXR0cmlidXRlcykgcmV0dXJuIG51bGw7CiAgICAgIHJldHVybiB0aGlzLl9wcmV2aW91c0F0dHJpYnV0ZXNbYXR0cl07CiAgICB9LAoKICAgIC8vIEdldCBhbGwgb2YgdGhlIGF0dHJpYnV0ZXMgb2YgdGhlIG1vZGVsIGF0IHRoZSB0aW1lIG9mIHRoZSBwcmV2aW91cwogICAgLy8gYCJjaGFuZ2UiYCBldmVudC4KICAgIHByZXZpb3VzQXR0cmlidXRlczogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBfLmNsb25lKHRoaXMuX3ByZXZpb3VzQXR0cmlidXRlcyk7CiAgICB9LAoKICAgIC8vIEZldGNoIHRoZSBtb2RlbCBmcm9tIHRoZSBzZXJ2ZXIuIElmIHRoZSBzZXJ2ZXIncyByZXByZXNlbnRhdGlvbiBvZiB0aGUKICAgIC8vIG1vZGVsIGRpZmZlcnMgZnJvbSBpdHMgY3VycmVudCBhdHRyaWJ1dGVzLCB0aGV5IHdpbGwgYmUgb3ZlcnJpZGRlbiwKICAgIC8vIHRyaWdnZXJpbmcgYSBgImNoYW5nZSJgIGV2ZW50LgogICAgZmV0Y2g6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgPyBfLmNsb25lKG9wdGlvbnMpIDoge307CiAgICAgIGlmIChvcHRpb25zLnBhcnNlID09PSB2b2lkIDApIG9wdGlvbnMucGFyc2UgPSB0cnVlOwogICAgICB2YXIgbW9kZWwgPSB0aGlzOwogICAgICB2YXIgc3VjY2VzcyA9IG9wdGlvbnMuc3VjY2VzczsKICAgICAgb3B0aW9ucy5zdWNjZXNzID0gZnVuY3Rpb24ocmVzcCkgewogICAgICAgIGlmICghbW9kZWwuc2V0KG1vZGVsLnBhcnNlKHJlc3AsIG9wdGlvbnMpLCBvcHRpb25zKSkgcmV0dXJuIGZhbHNlOwogICAgICAgIGlmIChzdWNjZXNzKSBzdWNjZXNzKG1vZGVsLCByZXNwLCBvcHRpb25zKTsKICAgICAgICBtb2RlbC50cmlnZ2VyKCdzeW5jJywgbW9kZWwsIHJlc3AsIG9wdGlvbnMpOwogICAgICB9OwogICAgICB3cmFwRXJyb3IodGhpcywgb3B0aW9ucyk7CiAgICAgIHJldHVybiB0aGlzLnN5bmMoJ3JlYWQnLCB0aGlzLCBvcHRpb25zKTsKICAgIH0sCgogICAgLy8gU2V0IGEgaGFzaCBvZiBtb2RlbCBhdHRyaWJ1dGVzLCBhbmQgc3luYyB0aGUgbW9kZWwgdG8gdGhlIHNlcnZlci4KICAgIC8vIElmIHRoZSBzZXJ2ZXIgcmV0dXJucyBhbiBhdHRyaWJ1dGVzIGhhc2ggdGhhdCBkaWZmZXJzLCB0aGUgbW9kZWwncwogICAgLy8gc3RhdGUgd2lsbCBiZSBgc2V0YCBhZ2Fpbi4KICAgIHNhdmU6IGZ1bmN0aW9uKGtleSwgdmFsLCBvcHRpb25zKSB7CiAgICAgIHZhciBhdHRycywgbWV0aG9kLCB4aHIsIGF0dHJpYnV0ZXMgPSB0aGlzLmF0dHJpYnV0ZXM7CgogICAgICAvLyBIYW5kbGUgYm90aCBgImtleSIsIHZhbHVlYCBhbmQgYHtrZXk6IHZhbHVlfWAgLXN0eWxlIGFyZ3VtZW50cy4KICAgICAgaWYgKGtleSA9PSBudWxsIHx8IHR5cGVvZiBrZXkgPT09ICdvYmplY3QnKSB7CiAgICAgICAgYXR0cnMgPSBrZXk7CiAgICAgICAgb3B0aW9ucyA9IHZhbDsKICAgICAgfSBlbHNlIHsKICAgICAgICAoYXR0cnMgPSB7fSlba2V5XSA9IHZhbDsKICAgICAgfQoKICAgICAgb3B0aW9ucyA9IF8uZXh0ZW5kKHt2YWxpZGF0ZTogdHJ1ZX0sIG9wdGlvbnMpOwoKICAgICAgLy8gSWYgd2UncmUgbm90IHdhaXRpbmcgYW5kIGF0dHJpYnV0ZXMgZXhpc3QsIHNhdmUgYWN0cyBhcwogICAgICAvLyBgc2V0KGF0dHIpLnNhdmUobnVsbCwgb3B0cylgIHdpdGggdmFsaWRhdGlvbi4gT3RoZXJ3aXNlLCBjaGVjayBpZgogICAgICAvLyB0aGUgbW9kZWwgd2lsbCBiZSB2YWxpZCB3aGVuIHRoZSBhdHRyaWJ1dGVzLCBpZiBhbnksIGFyZSBzZXQuCiAgICAgIGlmIChhdHRycyAmJiAhb3B0aW9ucy53YWl0KSB7CiAgICAgICAgaWYgKCF0aGlzLnNldChhdHRycywgb3B0aW9ucykpIHJldHVybiBmYWxzZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoIXRoaXMuX3ZhbGlkYXRlKGF0dHJzLCBvcHRpb25zKSkgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICAvLyBTZXQgdGVtcG9yYXJ5IGF0dHJpYnV0ZXMgaWYgYHt3YWl0OiB0cnVlfWAuCiAgICAgIGlmIChhdHRycyAmJiBvcHRpb25zLndhaXQpIHsKICAgICAgICB0aGlzLmF0dHJpYnV0ZXMgPSBfLmV4dGVuZCh7fSwgYXR0cmlidXRlcywgYXR0cnMpOwogICAgICB9CgogICAgICAvLyBBZnRlciBhIHN1Y2Nlc3NmdWwgc2VydmVyLXNpZGUgc2F2ZSwgdGhlIGNsaWVudCBpcyAob3B0aW9uYWxseSkKICAgICAgLy8gdXBkYXRlZCB3aXRoIHRoZSBzZXJ2ZXItc2lkZSBzdGF0ZS4KICAgICAgaWYgKG9wdGlvbnMucGFyc2UgPT09IHZvaWQgMCkgb3B0aW9ucy5wYXJzZSA9IHRydWU7CiAgICAgIHZhciBtb2RlbCA9IHRoaXM7CiAgICAgIHZhciBzdWNjZXNzID0gb3B0aW9ucy5zdWNjZXNzOwogICAgICBvcHRpb25zLnN1Y2Nlc3MgPSBmdW5jdGlvbihyZXNwKSB7CiAgICAgICAgLy8gRW5zdXJlIGF0dHJpYnV0ZXMgYXJlIHJlc3RvcmVkIGR1cmluZyBzeW5jaHJvbm91cyBzYXZlcy4KICAgICAgICBtb2RlbC5hdHRyaWJ1dGVzID0gYXR0cmlidXRlczsKICAgICAgICB2YXIgc2VydmVyQXR0cnMgPSBtb2RlbC5wYXJzZShyZXNwLCBvcHRpb25zKTsKICAgICAgICBpZiAob3B0aW9ucy53YWl0KSBzZXJ2ZXJBdHRycyA9IF8uZXh0ZW5kKGF0dHJzIHx8IHt9LCBzZXJ2ZXJBdHRycyk7CiAgICAgICAgaWYgKF8uaXNPYmplY3Qoc2VydmVyQXR0cnMpICYmICFtb2RlbC5zZXQoc2VydmVyQXR0cnMsIG9wdGlvbnMpKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmIChzdWNjZXNzKSBzdWNjZXNzKG1vZGVsLCByZXNwLCBvcHRpb25zKTsKICAgICAgICBtb2RlbC50cmlnZ2VyKCdzeW5jJywgbW9kZWwsIHJlc3AsIG9wdGlvbnMpOwogICAgICB9OwogICAgICB3cmFwRXJyb3IodGhpcywgb3B0aW9ucyk7CgogICAgICBtZXRob2QgPSB0aGlzLmlzTmV3KCkgPyAnY3JlYXRlJyA6IChvcHRpb25zLnBhdGNoID8gJ3BhdGNoJyA6ICd1cGRhdGUnKTsKICAgICAgaWYgKG1ldGhvZCA9PT0gJ3BhdGNoJykgb3B0aW9ucy5hdHRycyA9IGF0dHJzOwogICAgICB4aHIgPSB0aGlzLnN5bmMobWV0aG9kLCB0aGlzLCBvcHRpb25zKTsKCiAgICAgIC8vIFJlc3RvcmUgYXR0cmlidXRlcy4KICAgICAgaWYgKGF0dHJzICYmIG9wdGlvbnMud2FpdCkgdGhpcy5hdHRyaWJ1dGVzID0gYXR0cmlidXRlczsKCiAgICAgIHJldHVybiB4aHI7CiAgICB9LAoKICAgIC8vIERlc3Ryb3kgdGhpcyBtb2RlbCBvbiB0aGUgc2VydmVyIGlmIGl0IHdhcyBhbHJlYWR5IHBlcnNpc3RlZC4KICAgIC8vIE9wdGltaXN0aWNhbGx5IHJlbW92ZXMgdGhlIG1vZGVsIGZyb20gaXRzIGNvbGxlY3Rpb24sIGlmIGl0IGhhcyBvbmUuCiAgICAvLyBJZiBgd2FpdDogdHJ1ZWAgaXMgcGFzc2VkLCB3YWl0cyBmb3IgdGhlIHNlcnZlciB0byByZXNwb25kIGJlZm9yZSByZW1vdmFsLgogICAgZGVzdHJveTogZnVuY3Rpb24ob3B0aW9ucykgewogICAgICBvcHRpb25zID0gb3B0aW9ucyA/IF8uY2xvbmUob3B0aW9ucykgOiB7fTsKICAgICAgdmFyIG1vZGVsID0gdGhpczsKICAgICAgdmFyIHN1Y2Nlc3MgPSBvcHRpb25zLnN1Y2Nlc3M7CgogICAgICB2YXIgZGVzdHJveSA9IGZ1bmN0aW9uKCkgewogICAgICAgIG1vZGVsLnRyaWdnZXIoJ2Rlc3Ryb3knLCBtb2RlbCwgbW9kZWwuY29sbGVjdGlvbiwgb3B0aW9ucyk7CiAgICAgIH07CgogICAgICBvcHRpb25zLnN1Y2Nlc3MgPSBmdW5jdGlvbihyZXNwKSB7CiAgICAgICAgaWYgKG9wdGlvbnMud2FpdCB8fCBtb2RlbC5pc05ldygpKSBkZXN0cm95KCk7CiAgICAgICAgaWYgKHN1Y2Nlc3MpIHN1Y2Nlc3MobW9kZWwsIHJlc3AsIG9wdGlvbnMpOwogICAgICAgIGlmICghbW9kZWwuaXNOZXcoKSkgbW9kZWwudHJpZ2dlcignc3luYycsIG1vZGVsLCByZXNwLCBvcHRpb25zKTsKICAgICAgfTsKCiAgICAgIGlmICh0aGlzLmlzTmV3KCkpIHsKICAgICAgICBvcHRpb25zLnN1Y2Nlc3MoKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgd3JhcEVycm9yKHRoaXMsIG9wdGlvbnMpOwoKICAgICAgdmFyIHhociA9IHRoaXMuc3luYygnZGVsZXRlJywgdGhpcywgb3B0aW9ucyk7CiAgICAgIGlmICghb3B0aW9ucy53YWl0KSBkZXN0cm95KCk7CiAgICAgIHJldHVybiB4aHI7CiAgICB9LAoKICAgIC8vIERlZmF1bHQgVVJMIGZvciB0aGUgbW9kZWwncyByZXByZXNlbnRhdGlvbiBvbiB0aGUgc2VydmVyIC0tIGlmIHlvdSdyZQogICAgLy8gdXNpbmcgQmFja2JvbmUncyByZXN0ZnVsIG1ldGhvZHMsIG92ZXJyaWRlIHRoaXMgdG8gY2hhbmdlIHRoZSBlbmRwb2ludAogICAgLy8gdGhhdCB3aWxsIGJlIGNhbGxlZC4KICAgIHVybDogZnVuY3Rpb24oKSB7CiAgICAgIHZhciBiYXNlID0KICAgICAgICBfLnJlc3VsdCh0aGlzLCAndXJsUm9vdCcpIHx8CiAgICAgICAgXy5yZXN1bHQodGhpcy5jb2xsZWN0aW9uLCAndXJsJykgfHwKICAgICAgICB1cmxFcnJvcigpOwogICAgICBpZiAodGhpcy5pc05ldygpKSByZXR1cm4gYmFzZTsKICAgICAgcmV0dXJuIGJhc2UucmVwbGFjZSgvKFteXC9dKSQvLCAnJDEvJykgKyBlbmNvZGVVUklDb21wb25lbnQodGhpcy5pZCk7CiAgICB9LAoKICAgIC8vICoqcGFyc2UqKiBjb252ZXJ0cyBhIHJlc3BvbnNlIGludG8gdGhlIGhhc2ggb2YgYXR0cmlidXRlcyB0byBiZSBgc2V0YCBvbgogICAgLy8gdGhlIG1vZGVsLiBUaGUgZGVmYXVsdCBpbXBsZW1lbnRhdGlvbiBpcyBqdXN0IHRvIHBhc3MgdGhlIHJlc3BvbnNlIGFsb25nLgogICAgcGFyc2U6IGZ1bmN0aW9uKHJlc3AsIG9wdGlvbnMpIHsKICAgICAgcmV0dXJuIHJlc3A7CiAgICB9LAoKICAgIC8vIENyZWF0ZSBhIG5ldyBtb2RlbCB3aXRoIGlkZW50aWNhbCBhdHRyaWJ1dGVzIHRvIHRoaXMgb25lLgogICAgY2xvbmU6IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IodGhpcy5hdHRyaWJ1dGVzKTsKICAgIH0sCgogICAgLy8gQSBtb2RlbCBpcyBuZXcgaWYgaXQgaGFzIG5ldmVyIGJlZW4gc2F2ZWQgdG8gdGhlIHNlcnZlciwgYW5kIGxhY2tzIGFuIGlkLgogICAgaXNOZXc6IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gIXRoaXMuaGFzKHRoaXMuaWRBdHRyaWJ1dGUpOwogICAgfSwKCiAgICAvLyBDaGVjayBpZiB0aGUgbW9kZWwgaXMgY3VycmVudGx5IGluIGEgdmFsaWQgc3RhdGUuCiAgICBpc1ZhbGlkOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgIHJldHVybiB0aGlzLl92YWxpZGF0ZSh7fSwgXy5leHRlbmQob3B0aW9ucyB8fCB7fSwgeyB2YWxpZGF0ZTogdHJ1ZSB9KSk7CiAgICB9LAoKICAgIC8vIFJ1biB2YWxpZGF0aW9uIGFnYWluc3QgdGhlIG5leHQgY29tcGxldGUgc2V0IG9mIG1vZGVsIGF0dHJpYnV0ZXMsCiAgICAvLyByZXR1cm5pbmcgYHRydWVgIGlmIGFsbCBpcyB3ZWxsLiBPdGhlcndpc2UsIGZpcmUgYW4gYCJpbnZhbGlkImAgZXZlbnQuCiAgICBfdmFsaWRhdGU6IGZ1bmN0aW9uKGF0dHJzLCBvcHRpb25zKSB7CiAgICAgIGlmICghb3B0aW9ucy52YWxpZGF0ZSB8fCAhdGhpcy52YWxpZGF0ZSkgcmV0dXJuIHRydWU7CiAgICAgIGF0dHJzID0gXy5leHRlbmQoe30sIHRoaXMuYXR0cmlidXRlcywgYXR0cnMpOwogICAgICB2YXIgZXJyb3IgPSB0aGlzLnZhbGlkYXRpb25FcnJvciA9IHRoaXMudmFsaWRhdGUoYXR0cnMsIG9wdGlvbnMpIHx8IG51bGw7CiAgICAgIGlmICghZXJyb3IpIHJldHVybiB0cnVlOwogICAgICB0aGlzLnRyaWdnZXIoJ2ludmFsaWQnLCB0aGlzLCBlcnJvciwgXy5leHRlbmQob3B0aW9ucywge3ZhbGlkYXRpb25FcnJvcjogZXJyb3J9KSk7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgfSk7CgogIC8vIFVuZGVyc2NvcmUgbWV0aG9kcyB0aGF0IHdlIHdhbnQgdG8gaW1wbGVtZW50IG9uIHRoZSBNb2RlbC4KICB2YXIgbW9kZWxNZXRob2RzID0gWydrZXlzJywgJ3ZhbHVlcycsICdwYWlycycsICdpbnZlcnQnLCAncGljaycsICdvbWl0J107CgogIC8vIE1peCBpbiBlYWNoIFVuZGVyc2NvcmUgbWV0aG9kIGFzIGEgcHJveHkgdG8gYE1vZGVsI2F0dHJpYnV0ZXNgLgogIF8uZWFjaChtb2RlbE1ldGhvZHMsIGZ1bmN0aW9uKG1ldGhvZCkgewogICAgTW9kZWwucHJvdG90eXBlW21ldGhvZF0gPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIGFyZ3MgPSBzbGljZS5jYWxsKGFyZ3VtZW50cyk7CiAgICAgIGFyZ3MudW5zaGlmdCh0aGlzLmF0dHJpYnV0ZXMpOwogICAgICByZXR1cm4gX1ttZXRob2RdLmFwcGx5KF8sIGFyZ3MpOwogICAgfTsKICB9KTsKCiAgLy8gQmFja2JvbmUuQ29sbGVjdGlvbgogIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgLy8gSWYgbW9kZWxzIHRlbmQgdG8gcmVwcmVzZW50IGEgc2luZ2xlIHJvdyBvZiBkYXRhLCBhIEJhY2tib25lIENvbGxlY3Rpb24gaXMKICAvLyBtb3JlIGFuYWxhZ291cyB0byBhIHRhYmxlIGZ1bGwgb2YgZGF0YSAuLi4gb3IgYSBzbWFsbCBzbGljZSBvciBwYWdlIG9mIHRoYXQKICAvLyB0YWJsZSwgb3IgYSBjb2xsZWN0aW9uIG9mIHJvd3MgdGhhdCBiZWxvbmcgdG9nZXRoZXIgZm9yIGEgcGFydGljdWxhciByZWFzb24KICAvLyAtLSBhbGwgb2YgdGhlIG1lc3NhZ2VzIGluIHRoaXMgcGFydGljdWxhciBmb2xkZXIsIGFsbCBvZiB0aGUgZG9jdW1lbnRzCiAgLy8gYmVsb25naW5nIHRvIHRoaXMgcGFydGljdWxhciBhdXRob3IsIGFuZCBzbyBvbi4gQ29sbGVjdGlvbnMgbWFpbnRhaW4KICAvLyBpbmRleGVzIG9mIHRoZWlyIG1vZGVscywgYm90aCBpbiBvcmRlciwgYW5kIGZvciBsb29rdXAgYnkgYGlkYC4KCiAgLy8gQ3JlYXRlIGEgbmV3ICoqQ29sbGVjdGlvbioqLCBwZXJoYXBzIHRvIGNvbnRhaW4gYSBzcGVjaWZpYyB0eXBlIG9mIGBtb2RlbGAuCiAgLy8gSWYgYSBgY29tcGFyYXRvcmAgaXMgc3BlY2lmaWVkLCB0aGUgQ29sbGVjdGlvbiB3aWxsIG1haW50YWluCiAgLy8gaXRzIG1vZGVscyBpbiBzb3J0IG9yZGVyLCBhcyB0aGV5J3JlIGFkZGVkIGFuZCByZW1vdmVkLgogIHZhciBDb2xsZWN0aW9uID0gQmFja2JvbmUuQ29sbGVjdGlvbiA9IGZ1bmN0aW9uKG1vZGVscywgb3B0aW9ucykgewogICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTsKICAgIGlmIChvcHRpb25zLm1vZGVsKSB0aGlzLm1vZGVsID0gb3B0aW9ucy5tb2RlbDsKICAgIGlmIChvcHRpb25zLmNvbXBhcmF0b3IgIT09IHZvaWQgMCkgdGhpcy5jb21wYXJhdG9yID0gb3B0aW9ucy5jb21wYXJhdG9yOwogICAgdGhpcy5fcmVzZXQoKTsKICAgIHRoaXMuaW5pdGlhbGl6ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgaWYgKG1vZGVscykgdGhpcy5yZXNldChtb2RlbHMsIF8uZXh0ZW5kKHtzaWxlbnQ6IHRydWV9LCBvcHRpb25zKSk7CiAgfTsKCiAgLy8gRGVmYXVsdCBvcHRpb25zIGZvciBgQ29sbGVjdGlvbiNzZXRgLgogIHZhciBzZXRPcHRpb25zID0ge2FkZDogdHJ1ZSwgcmVtb3ZlOiB0cnVlLCBtZXJnZTogdHJ1ZX07CiAgdmFyIGFkZE9wdGlvbnMgPSB7YWRkOiB0cnVlLCByZW1vdmU6IGZhbHNlfTsKCiAgLy8gRGVmaW5lIHRoZSBDb2xsZWN0aW9uJ3MgaW5oZXJpdGFibGUgbWV0aG9kcy4KICBfLmV4dGVuZChDb2xsZWN0aW9uLnByb3RvdHlwZSwgRXZlbnRzLCB7CgogICAgLy8gVGhlIGRlZmF1bHQgbW9kZWwgZm9yIGEgY29sbGVjdGlvbiBpcyBqdXN0IGEgKipCYWNrYm9uZS5Nb2RlbCoqLgogICAgLy8gVGhpcyBzaG91bGQgYmUgb3ZlcnJpZGRlbiBpbiBtb3N0IGNhc2VzLgogICAgbW9kZWw6IE1vZGVsLAoKICAgIC8vIEluaXRpYWxpemUgaXMgYW4gZW1wdHkgZnVuY3Rpb24gYnkgZGVmYXVsdC4gT3ZlcnJpZGUgaXQgd2l0aCB5b3VyIG93bgogICAgLy8gaW5pdGlhbGl6YXRpb24gbG9naWMuCiAgICBpbml0aWFsaXplOiBmdW5jdGlvbigpe30sCgogICAgLy8gVGhlIEpTT04gcmVwcmVzZW50YXRpb24gb2YgYSBDb2xsZWN0aW9uIGlzIGFuIGFycmF5IG9mIHRoZQogICAgLy8gbW9kZWxzJyBhdHRyaWJ1dGVzLgogICAgdG9KU09OOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgIHJldHVybiB0aGlzLm1hcChmdW5jdGlvbihtb2RlbCl7IHJldHVybiBtb2RlbC50b0pTT04ob3B0aW9ucyk7IH0pOwogICAgfSwKCiAgICAvLyBQcm94eSBgQmFja2JvbmUuc3luY2AgYnkgZGVmYXVsdC4KICAgIHN5bmM6IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gQmFja2JvbmUuc3luYy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgfSwKCiAgICAvLyBBZGQgYSBtb2RlbCwgb3IgbGlzdCBvZiBtb2RlbHMgdG8gdGhlIHNldC4KICAgIGFkZDogZnVuY3Rpb24obW9kZWxzLCBvcHRpb25zKSB7CiAgICAgIHJldHVybiB0aGlzLnNldChtb2RlbHMsIF8uZXh0ZW5kKHttZXJnZTogZmFsc2V9LCBvcHRpb25zLCBhZGRPcHRpb25zKSk7CiAgICB9LAoKICAgIC8vIFJlbW92ZSBhIG1vZGVsLCBvciBhIGxpc3Qgb2YgbW9kZWxzIGZyb20gdGhlIHNldC4KICAgIHJlbW92ZTogZnVuY3Rpb24obW9kZWxzLCBvcHRpb25zKSB7CiAgICAgIHZhciBzaW5ndWxhciA9ICFfLmlzQXJyYXkobW9kZWxzKTsKICAgICAgbW9kZWxzID0gc2luZ3VsYXIgPyBbbW9kZWxzXSA6IF8uY2xvbmUobW9kZWxzKTsKICAgICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTsKICAgICAgdmFyIGksIGwsIGluZGV4LCBtb2RlbDsKICAgICAgZm9yIChpID0gMCwgbCA9IG1vZGVscy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBtb2RlbCA9IG1vZGVsc1tpXSA9IHRoaXMuZ2V0KG1vZGVsc1tpXSk7CiAgICAgICAgaWYgKCFtb2RlbCkgY29udGludWU7CiAgICAgICAgZGVsZXRlIHRoaXMuX2J5SWRbbW9kZWwuaWRdOwogICAgICAgIGRlbGV0ZSB0aGlzLl9ieUlkW21vZGVsLmNpZF07CiAgICAgICAgaW5kZXggPSB0aGlzLmluZGV4T2YobW9kZWwpOwogICAgICAgIHRoaXMubW9kZWxzLnNwbGljZShpbmRleCwgMSk7CiAgICAgICAgdGhpcy5sZW5ndGgtLTsKICAgICAgICBpZiAoIW9wdGlvbnMuc2lsZW50KSB7CiAgICAgICAgICBvcHRpb25zLmluZGV4ID0gaW5kZXg7CiAgICAgICAgICBtb2RlbC50cmlnZ2VyKCdyZW1vdmUnLCBtb2RlbCwgdGhpcywgb3B0aW9ucyk7CiAgICAgICAgfQogICAgICAgIHRoaXMuX3JlbW92ZVJlZmVyZW5jZShtb2RlbCwgb3B0aW9ucyk7CiAgICAgIH0KICAgICAgcmV0dXJuIHNpbmd1bGFyID8gbW9kZWxzWzBdIDogbW9kZWxzOwogICAgfSwKCiAgICAvLyBVcGRhdGUgYSBjb2xsZWN0aW9uIGJ5IGBzZXRgLWluZyBhIG5ldyBsaXN0IG9mIG1vZGVscywgYWRkaW5nIG5ldyBvbmVzLAogICAgLy8gcmVtb3ZpbmcgbW9kZWxzIHRoYXQgYXJlIG5vIGxvbmdlciBwcmVzZW50LCBhbmQgbWVyZ2luZyBtb2RlbHMgdGhhdAogICAgLy8gYWxyZWFkeSBleGlzdCBpbiB0aGUgY29sbGVjdGlvbiwgYXMgbmVjZXNzYXJ5LiBTaW1pbGFyIHRvICoqTW9kZWwjc2V0KiosCiAgICAvLyB0aGUgY29yZSBvcGVyYXRpb24gZm9yIHVwZGF0aW5nIHRoZSBkYXRhIGNvbnRhaW5lZCBieSB0aGUgY29sbGVjdGlvbi4KICAgIHNldDogZnVuY3Rpb24obW9kZWxzLCBvcHRpb25zKSB7CiAgICAgIG9wdGlvbnMgPSBfLmRlZmF1bHRzKHt9LCBvcHRpb25zLCBzZXRPcHRpb25zKTsKICAgICAgaWYgKG9wdGlvbnMucGFyc2UpIG1vZGVscyA9IHRoaXMucGFyc2UobW9kZWxzLCBvcHRpb25zKTsKICAgICAgdmFyIHNpbmd1bGFyID0gIV8uaXNBcnJheShtb2RlbHMpOwogICAgICBtb2RlbHMgPSBzaW5ndWxhciA/IChtb2RlbHMgPyBbbW9kZWxzXSA6IFtdKSA6IF8uY2xvbmUobW9kZWxzKTsKICAgICAgdmFyIGksIGwsIGlkLCBtb2RlbCwgYXR0cnMsIGV4aXN0aW5nLCBzb3J0OwogICAgICB2YXIgYXQgPSBvcHRpb25zLmF0OwogICAgICB2YXIgdGFyZ2V0TW9kZWwgPSB0aGlzLm1vZGVsOwogICAgICB2YXIgc29ydGFibGUgPSB0aGlzLmNvbXBhcmF0b3IgJiYgKGF0ID09IG51bGwpICYmIG9wdGlvbnMuc29ydCAhPT0gZmFsc2U7CiAgICAgIHZhciBzb3J0QXR0ciA9IF8uaXNTdHJpbmcodGhpcy5jb21wYXJhdG9yKSA/IHRoaXMuY29tcGFyYXRvciA6IG51bGw7CiAgICAgIHZhciB0b0FkZCA9IFtdLCB0b1JlbW92ZSA9IFtdLCBtb2RlbE1hcCA9IHt9OwogICAgICB2YXIgYWRkID0gb3B0aW9ucy5hZGQsIG1lcmdlID0gb3B0aW9ucy5tZXJnZSwgcmVtb3ZlID0gb3B0aW9ucy5yZW1vdmU7CiAgICAgIHZhciBvcmRlciA9ICFzb3J0YWJsZSAmJiBhZGQgJiYgcmVtb3ZlID8gW10gOiBmYWxzZTsKCiAgICAgIC8vIFR1cm4gYmFyZSBvYmplY3RzIGludG8gbW9kZWwgcmVmZXJlbmNlcywgYW5kIHByZXZlbnQgaW52YWxpZCBtb2RlbHMKICAgICAgLy8gZnJvbSBiZWluZyBhZGRlZC4KICAgICAgZm9yIChpID0gMCwgbCA9IG1vZGVscy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBhdHRycyA9IG1vZGVsc1tpXSB8fCB7fTsKICAgICAgICBpZiAoYXR0cnMgaW5zdGFuY2VvZiBNb2RlbCkgewogICAgICAgICAgaWQgPSBtb2RlbCA9IGF0dHJzOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZCA9IGF0dHJzW3RhcmdldE1vZGVsLnByb3RvdHlwZS5pZEF0dHJpYnV0ZSB8fCAnaWQnXTsKICAgICAgICB9CgogICAgICAgIC8vIElmIGEgZHVwbGljYXRlIGlzIGZvdW5kLCBwcmV2ZW50IGl0IGZyb20gYmVpbmcgYWRkZWQgYW5kCiAgICAgICAgLy8gb3B0aW9uYWxseSBtZXJnZSBpdCBpbnRvIHRoZSBleGlzdGluZyBtb2RlbC4KICAgICAgICBpZiAoZXhpc3RpbmcgPSB0aGlzLmdldChpZCkpIHsKICAgICAgICAgIGlmIChyZW1vdmUpIG1vZGVsTWFwW2V4aXN0aW5nLmNpZF0gPSB0cnVlOwogICAgICAgICAgaWYgKG1lcmdlKSB7CiAgICAgICAgICAgIGF0dHJzID0gYXR0cnMgPT09IG1vZGVsID8gbW9kZWwuYXR0cmlidXRlcyA6IGF0dHJzOwogICAgICAgICAgICBpZiAob3B0aW9ucy5wYXJzZSkgYXR0cnMgPSBleGlzdGluZy5wYXJzZShhdHRycywgb3B0aW9ucyk7CiAgICAgICAgICAgIGV4aXN0aW5nLnNldChhdHRycywgb3B0aW9ucyk7CiAgICAgICAgICAgIGlmIChzb3J0YWJsZSAmJiAhc29ydCAmJiBleGlzdGluZy5oYXNDaGFuZ2VkKHNvcnRBdHRyKSkgc29ydCA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgICBtb2RlbHNbaV0gPSBleGlzdGluZzsKCiAgICAgICAgLy8gSWYgdGhpcyBpcyBhIG5ldywgdmFsaWQgbW9kZWwsIHB1c2ggaXQgdG8gdGhlIGB0b0FkZGAgbGlzdC4KICAgICAgICB9IGVsc2UgaWYgKGFkZCkgewogICAgICAgICAgbW9kZWwgPSBtb2RlbHNbaV0gPSB0aGlzLl9wcmVwYXJlTW9kZWwoYXR0cnMsIG9wdGlvbnMpOwogICAgICAgICAgaWYgKCFtb2RlbCkgY29udGludWU7CiAgICAgICAgICB0b0FkZC5wdXNoKG1vZGVsKTsKICAgICAgICAgIHRoaXMuX2FkZFJlZmVyZW5jZShtb2RlbCwgb3B0aW9ucyk7CiAgICAgICAgfQoKICAgICAgICAvLyBEbyBub3QgYWRkIG11bHRpcGxlIG1vZGVscyB3aXRoIHRoZSBzYW1lIGBpZGAuCiAgICAgICAgbW9kZWwgPSBleGlzdGluZyB8fCBtb2RlbDsKICAgICAgICBpZiAob3JkZXIgJiYgKG1vZGVsLmlzTmV3KCkgfHwgIW1vZGVsTWFwW21vZGVsLmlkXSkpIG9yZGVyLnB1c2gobW9kZWwpOwogICAgICAgIG1vZGVsTWFwW21vZGVsLmlkXSA9IHRydWU7CiAgICAgIH0KCiAgICAgIC8vIFJlbW92ZSBub25leGlzdGVudCBtb2RlbHMgaWYgYXBwcm9wcmlhdGUuCiAgICAgIGlmIChyZW1vdmUpIHsKICAgICAgICBmb3IgKGkgPSAwLCBsID0gdGhpcy5sZW5ndGg7IGkgPCBsOyArK2kpIHsKICAgICAgICAgIGlmICghbW9kZWxNYXBbKG1vZGVsID0gdGhpcy5tb2RlbHNbaV0pLmNpZF0pIHRvUmVtb3ZlLnB1c2gobW9kZWwpOwogICAgICAgIH0KICAgICAgICBpZiAodG9SZW1vdmUubGVuZ3RoKSB0aGlzLnJlbW92ZSh0b1JlbW92ZSwgb3B0aW9ucyk7CiAgICAgIH0KCiAgICAgIC8vIFNlZSBpZiBzb3J0aW5nIGlzIG5lZWRlZCwgdXBkYXRlIGBsZW5ndGhgIGFuZCBzcGxpY2UgaW4gbmV3IG1vZGVscy4KICAgICAgaWYgKHRvQWRkLmxlbmd0aCB8fCAob3JkZXIgJiYgb3JkZXIubGVuZ3RoKSkgewogICAgICAgIGlmIChzb3J0YWJsZSkgc29ydCA9IHRydWU7CiAgICAgICAgdGhpcy5sZW5ndGggKz0gdG9BZGQubGVuZ3RoOwogICAgICAgIGlmIChhdCAhPSBudWxsKSB7CiAgICAgICAgICBmb3IgKGkgPSAwLCBsID0gdG9BZGQubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICAgIHRoaXMubW9kZWxzLnNwbGljZShhdCArIGksIDAsIHRvQWRkW2ldKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKG9yZGVyKSB0aGlzLm1vZGVscy5sZW5ndGggPSAwOwogICAgICAgICAgdmFyIG9yZGVyZWRNb2RlbHMgPSBvcmRlciB8fCB0b0FkZDsKICAgICAgICAgIGZvciAoaSA9IDAsIGwgPSBvcmRlcmVkTW9kZWxzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgICAgICB0aGlzLm1vZGVscy5wdXNoKG9yZGVyZWRNb2RlbHNbaV0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgLy8gU2lsZW50bHkgc29ydCB0aGUgY29sbGVjdGlvbiBpZiBhcHByb3ByaWF0ZS4KICAgICAgaWYgKHNvcnQpIHRoaXMuc29ydCh7c2lsZW50OiB0cnVlfSk7CgogICAgICAvLyBVbmxlc3Mgc2lsZW5jZWQsIGl0J3MgdGltZSB0byBmaXJlIGFsbCBhcHByb3ByaWF0ZSBhZGQvc29ydCBldmVudHMuCiAgICAgIGlmICghb3B0aW9ucy5zaWxlbnQpIHsKICAgICAgICBmb3IgKGkgPSAwLCBsID0gdG9BZGQubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICAobW9kZWwgPSB0b0FkZFtpXSkudHJpZ2dlcignYWRkJywgbW9kZWwsIHRoaXMsIG9wdGlvbnMpOwogICAgICAgIH0KICAgICAgICBpZiAoc29ydCB8fCAob3JkZXIgJiYgb3JkZXIubGVuZ3RoKSkgdGhpcy50cmlnZ2VyKCdzb3J0JywgdGhpcywgb3B0aW9ucyk7CiAgICAgIH0KCiAgICAgIC8vIFJldHVybiB0aGUgYWRkZWQgKG9yIG1lcmdlZCkgbW9kZWwgKG9yIG1vZGVscykuCiAgICAgIHJldHVybiBzaW5ndWxhciA/IG1vZGVsc1swXSA6IG1vZGVsczsKICAgIH0sCgogICAgLy8gV2hlbiB5b3UgaGF2ZSBtb3JlIGl0ZW1zIHRoYW4geW91IHdhbnQgdG8gYWRkIG9yIHJlbW92ZSBpbmRpdmlkdWFsbHksCiAgICAvLyB5b3UgY2FuIHJlc2V0IHRoZSBlbnRpcmUgc2V0IHdpdGggYSBuZXcgbGlzdCBvZiBtb2RlbHMsIHdpdGhvdXQgZmlyaW5nCiAgICAvLyBhbnkgZ3JhbnVsYXIgYGFkZGAgb3IgYHJlbW92ZWAgZXZlbnRzLiBGaXJlcyBgcmVzZXRgIHdoZW4gZmluaXNoZWQuCiAgICAvLyBVc2VmdWwgZm9yIGJ1bGsgb3BlcmF0aW9ucyBhbmQgb3B0aW1pemF0aW9ucy4KICAgIHJlc2V0OiBmdW5jdGlvbihtb2RlbHMsIG9wdGlvbnMpIHsKICAgICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTsKICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSB0aGlzLm1vZGVscy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICB0aGlzLl9yZW1vdmVSZWZlcmVuY2UodGhpcy5tb2RlbHNbaV0sIG9wdGlvbnMpOwogICAgICB9CiAgICAgIG9wdGlvbnMucHJldmlvdXNNb2RlbHMgPSB0aGlzLm1vZGVsczsKICAgICAgdGhpcy5fcmVzZXQoKTsKICAgICAgbW9kZWxzID0gdGhpcy5hZGQobW9kZWxzLCBfLmV4dGVuZCh7c2lsZW50OiB0cnVlfSwgb3B0aW9ucykpOwogICAgICBpZiAoIW9wdGlvbnMuc2lsZW50KSB0aGlzLnRyaWdnZXIoJ3Jlc2V0JywgdGhpcywgb3B0aW9ucyk7CiAgICAgIHJldHVybiBtb2RlbHM7CiAgICB9LAoKICAgIC8vIEFkZCBhIG1vZGVsIHRvIHRoZSBlbmQgb2YgdGhlIGNvbGxlY3Rpb24uCiAgICBwdXNoOiBmdW5jdGlvbihtb2RlbCwgb3B0aW9ucykgewogICAgICByZXR1cm4gdGhpcy5hZGQobW9kZWwsIF8uZXh0ZW5kKHthdDogdGhpcy5sZW5ndGh9LCBvcHRpb25zKSk7CiAgICB9LAoKICAgIC8vIFJlbW92ZSBhIG1vZGVsIGZyb20gdGhlIGVuZCBvZiB0aGUgY29sbGVjdGlvbi4KICAgIHBvcDogZnVuY3Rpb24ob3B0aW9ucykgewogICAgICB2YXIgbW9kZWwgPSB0aGlzLmF0KHRoaXMubGVuZ3RoIC0gMSk7CiAgICAgIHRoaXMucmVtb3ZlKG1vZGVsLCBvcHRpb25zKTsKICAgICAgcmV0dXJuIG1vZGVsOwogICAgfSwKCiAgICAvLyBBZGQgYSBtb2RlbCB0byB0aGUgYmVnaW5uaW5nIG9mIHRoZSBjb2xsZWN0aW9uLgogICAgdW5zaGlmdDogZnVuY3Rpb24obW9kZWwsIG9wdGlvbnMpIHsKICAgICAgcmV0dXJuIHRoaXMuYWRkKG1vZGVsLCBfLmV4dGVuZCh7YXQ6IDB9LCBvcHRpb25zKSk7CiAgICB9LAoKICAgIC8vIFJlbW92ZSBhIG1vZGVsIGZyb20gdGhlIGJlZ2lubmluZyBvZiB0aGUgY29sbGVjdGlvbi4KICAgIHNoaWZ0OiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgIHZhciBtb2RlbCA9IHRoaXMuYXQoMCk7CiAgICAgIHRoaXMucmVtb3ZlKG1vZGVsLCBvcHRpb25zKTsKICAgICAgcmV0dXJuIG1vZGVsOwogICAgfSwKCiAgICAvLyBTbGljZSBvdXQgYSBzdWItYXJyYXkgb2YgbW9kZWxzIGZyb20gdGhlIGNvbGxlY3Rpb24uCiAgICBzbGljZTogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBzbGljZS5hcHBseSh0aGlzLm1vZGVscywgYXJndW1lbnRzKTsKICAgIH0sCgogICAgLy8gR2V0IGEgbW9kZWwgZnJvbSB0aGUgc2V0IGJ5IGlkLgogICAgZ2V0OiBmdW5jdGlvbihvYmopIHsKICAgICAgaWYgKG9iaiA9PSBudWxsKSByZXR1cm4gdm9pZCAwOwogICAgICByZXR1cm4gdGhpcy5fYnlJZFtvYmpdIHx8IHRoaXMuX2J5SWRbb2JqLmlkXSB8fCB0aGlzLl9ieUlkW29iai5jaWRdOwogICAgfSwKCiAgICAvLyBHZXQgdGhlIG1vZGVsIGF0IHRoZSBnaXZlbiBpbmRleC4KICAgIGF0OiBmdW5jdGlvbihpbmRleCkgewogICAgICByZXR1cm4gdGhpcy5tb2RlbHNbaW5kZXhdOwogICAgfSwKCiAgICAvLyBSZXR1cm4gbW9kZWxzIHdpdGggbWF0Y2hpbmcgYXR0cmlidXRlcy4gVXNlZnVsIGZvciBzaW1wbGUgY2FzZXMgb2YKICAgIC8vIGBmaWx0ZXJgLgogICAgd2hlcmU6IGZ1bmN0aW9uKGF0dHJzLCBmaXJzdCkgewogICAgICBpZiAoXy5pc0VtcHR5KGF0dHJzKSkgcmV0dXJuIGZpcnN0ID8gdm9pZCAwIDogW107CiAgICAgIHJldHVybiB0aGlzW2ZpcnN0ID8gJ2ZpbmQnIDogJ2ZpbHRlciddKGZ1bmN0aW9uKG1vZGVsKSB7CiAgICAgICAgZm9yICh2YXIga2V5IGluIGF0dHJzKSB7CiAgICAgICAgICBpZiAoYXR0cnNba2V5XSAhPT0gbW9kZWwuZ2V0KGtleSkpIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0pOwogICAgfSwKCiAgICAvLyBSZXR1cm4gdGhlIGZpcnN0IG1vZGVsIHdpdGggbWF0Y2hpbmcgYXR0cmlidXRlcy4gVXNlZnVsIGZvciBzaW1wbGUgY2FzZXMKICAgIC8vIG9mIGBmaW5kYC4KICAgIGZpbmRXaGVyZTogZnVuY3Rpb24oYXR0cnMpIHsKICAgICAgcmV0dXJuIHRoaXMud2hlcmUoYXR0cnMsIHRydWUpOwogICAgfSwKCiAgICAvLyBGb3JjZSB0aGUgY29sbGVjdGlvbiB0byByZS1zb3J0IGl0c2VsZi4gWW91IGRvbid0IG5lZWQgdG8gY2FsbCB0aGlzIHVuZGVyCiAgICAvLyBub3JtYWwgY2lyY3Vtc3RhbmNlcywgYXMgdGhlIHNldCB3aWxsIG1haW50YWluIHNvcnQgb3JkZXIgYXMgZWFjaCBpdGVtCiAgICAvLyBpcyBhZGRlZC4KICAgIHNvcnQ6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgaWYgKCF0aGlzLmNvbXBhcmF0b3IpIHRocm93IG5ldyBFcnJvcignQ2Fubm90IHNvcnQgYSBzZXQgd2l0aG91dCBhIGNvbXBhcmF0b3InKTsKICAgICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTsKCiAgICAgIC8vIFJ1biBzb3J0IGJhc2VkIG9uIHR5cGUgb2YgYGNvbXBhcmF0b3JgLgogICAgICBpZiAoXy5pc1N0cmluZyh0aGlzLmNvbXBhcmF0b3IpIHx8IHRoaXMuY29tcGFyYXRvci5sZW5ndGggPT09IDEpIHsKICAgICAgICB0aGlzLm1vZGVscyA9IHRoaXMuc29ydEJ5KHRoaXMuY29tcGFyYXRvciwgdGhpcyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5tb2RlbHMuc29ydChfLmJpbmQodGhpcy5jb21wYXJhdG9yLCB0aGlzKSk7CiAgICAgIH0KCiAgICAgIGlmICghb3B0aW9ucy5zaWxlbnQpIHRoaXMudHJpZ2dlcignc29ydCcsIHRoaXMsIG9wdGlvbnMpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLy8gUGx1Y2sgYW4gYXR0cmlidXRlIGZyb20gZWFjaCBtb2RlbCBpbiB0aGUgY29sbGVjdGlvbi4KICAgIHBsdWNrOiBmdW5jdGlvbihhdHRyKSB7CiAgICAgIHJldHVybiBfLmludm9rZSh0aGlzLm1vZGVscywgJ2dldCcsIGF0dHIpOwogICAgfSwKCiAgICAvLyBGZXRjaCB0aGUgZGVmYXVsdCBzZXQgb2YgbW9kZWxzIGZvciB0aGlzIGNvbGxlY3Rpb24sIHJlc2V0dGluZyB0aGUKICAgIC8vIGNvbGxlY3Rpb24gd2hlbiB0aGV5IGFycml2ZS4gSWYgYHJlc2V0OiB0cnVlYCBpcyBwYXNzZWQsIHRoZSByZXNwb25zZQogICAgLy8gZGF0YSB3aWxsIGJlIHBhc3NlZCB0aHJvdWdoIHRoZSBgcmVzZXRgIG1ldGhvZCBpbnN0ZWFkIG9mIGBzZXRgLgogICAgZmV0Y2g6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgPyBfLmNsb25lKG9wdGlvbnMpIDoge307CiAgICAgIGlmIChvcHRpb25zLnBhcnNlID09PSB2b2lkIDApIG9wdGlvbnMucGFyc2UgPSB0cnVlOwogICAgICB2YXIgc3VjY2VzcyA9IG9wdGlvbnMuc3VjY2VzczsKICAgICAgdmFyIGNvbGxlY3Rpb24gPSB0aGlzOwogICAgICBvcHRpb25zLnN1Y2Nlc3MgPSBmdW5jdGlvbihyZXNwKSB7CiAgICAgICAgdmFyIG1ldGhvZCA9IG9wdGlvbnMucmVzZXQgPyAncmVzZXQnIDogJ3NldCc7CiAgICAgICAgY29sbGVjdGlvblttZXRob2RdKHJlc3AsIG9wdGlvbnMpOwogICAgICAgIGlmIChzdWNjZXNzKSBzdWNjZXNzKGNvbGxlY3Rpb24sIHJlc3AsIG9wdGlvbnMpOwogICAgICAgIGNvbGxlY3Rpb24udHJpZ2dlcignc3luYycsIGNvbGxlY3Rpb24sIHJlc3AsIG9wdGlvbnMpOwogICAgICB9OwogICAgICB3cmFwRXJyb3IodGhpcywgb3B0aW9ucyk7CiAgICAgIHJldHVybiB0aGlzLnN5bmMoJ3JlYWQnLCB0aGlzLCBvcHRpb25zKTsKICAgIH0sCgogICAgLy8gQ3JlYXRlIGEgbmV3IGluc3RhbmNlIG9mIGEgbW9kZWwgaW4gdGhpcyBjb2xsZWN0aW9uLiBBZGQgdGhlIG1vZGVsIHRvIHRoZQogICAgLy8gY29sbGVjdGlvbiBpbW1lZGlhdGVseSwgdW5sZXNzIGB3YWl0OiB0cnVlYCBpcyBwYXNzZWQsIGluIHdoaWNoIGNhc2Ugd2UKICAgIC8vIHdhaXQgZm9yIHRoZSBzZXJ2ZXIgdG8gYWdyZWUuCiAgICBjcmVhdGU6IGZ1bmN0aW9uKG1vZGVsLCBvcHRpb25zKSB7CiAgICAgIG9wdGlvbnMgPSBvcHRpb25zID8gXy5jbG9uZShvcHRpb25zKSA6IHt9OwogICAgICBpZiAoIShtb2RlbCA9IHRoaXMuX3ByZXBhcmVNb2RlbChtb2RlbCwgb3B0aW9ucykpKSByZXR1cm4gZmFsc2U7CiAgICAgIGlmICghb3B0aW9ucy53YWl0KSB0aGlzLmFkZChtb2RlbCwgb3B0aW9ucyk7CiAgICAgIHZhciBjb2xsZWN0aW9uID0gdGhpczsKICAgICAgdmFyIHN1Y2Nlc3MgPSBvcHRpb25zLnN1Y2Nlc3M7CiAgICAgIG9wdGlvbnMuc3VjY2VzcyA9IGZ1bmN0aW9uKG1vZGVsLCByZXNwKSB7CiAgICAgICAgaWYgKG9wdGlvbnMud2FpdCkgY29sbGVjdGlvbi5hZGQobW9kZWwsIG9wdGlvbnMpOwogICAgICAgIGlmIChzdWNjZXNzKSBzdWNjZXNzKG1vZGVsLCByZXNwLCBvcHRpb25zKTsKICAgICAgfTsKICAgICAgbW9kZWwuc2F2ZShudWxsLCBvcHRpb25zKTsKICAgICAgcmV0dXJuIG1vZGVsOwogICAgfSwKCiAgICAvLyAqKnBhcnNlKiogY29udmVydHMgYSByZXNwb25zZSBpbnRvIGEgbGlzdCBvZiBtb2RlbHMgdG8gYmUgYWRkZWQgdG8gdGhlCiAgICAvLyBjb2xsZWN0aW9uLiBUaGUgZGVmYXVsdCBpbXBsZW1lbnRhdGlvbiBpcyBqdXN0IHRvIHBhc3MgaXQgdGhyb3VnaC4KICAgIHBhcnNlOiBmdW5jdGlvbihyZXNwLCBvcHRpb25zKSB7CiAgICAgIHJldHVybiByZXNwOwogICAgfSwKCiAgICAvLyBDcmVhdGUgYSBuZXcgY29sbGVjdGlvbiB3aXRoIGFuIGlkZW50aWNhbCBsaXN0IG9mIG1vZGVscyBhcyB0aGlzIG9uZS4KICAgIGNsb25lOiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKHRoaXMubW9kZWxzKTsKICAgIH0sCgogICAgLy8gUHJpdmF0ZSBtZXRob2QgdG8gcmVzZXQgYWxsIGludGVybmFsIHN0YXRlLiBDYWxsZWQgd2hlbiB0aGUgY29sbGVjdGlvbgogICAgLy8gaXMgZmlyc3QgaW5pdGlhbGl6ZWQgb3IgcmVzZXQuCiAgICBfcmVzZXQ6IGZ1bmN0aW9uKCkgewogICAgICB0aGlzLmxlbmd0aCA9IDA7CiAgICAgIHRoaXMubW9kZWxzID0gW107CiAgICAgIHRoaXMuX2J5SWQgID0ge307CiAgICB9LAoKICAgIC8vIFByZXBhcmUgYSBoYXNoIG9mIGF0dHJpYnV0ZXMgKG9yIG90aGVyIG1vZGVsKSB0byBiZSBhZGRlZCB0byB0aGlzCiAgICAvLyBjb2xsZWN0aW9uLgogICAgX3ByZXBhcmVNb2RlbDogZnVuY3Rpb24oYXR0cnMsIG9wdGlvbnMpIHsKICAgICAgaWYgKGF0dHJzIGluc3RhbmNlb2YgTW9kZWwpIHJldHVybiBhdHRyczsKICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgPyBfLmNsb25lKG9wdGlvbnMpIDoge307CiAgICAgIG9wdGlvbnMuY29sbGVjdGlvbiA9IHRoaXM7CiAgICAgIHZhciBtb2RlbCA9IG5ldyB0aGlzLm1vZGVsKGF0dHJzLCBvcHRpb25zKTsKICAgICAgaWYgKCFtb2RlbC52YWxpZGF0aW9uRXJyb3IpIHJldHVybiBtb2RlbDsKICAgICAgdGhpcy50cmlnZ2VyKCdpbnZhbGlkJywgdGhpcywgbW9kZWwudmFsaWRhdGlvbkVycm9yLCBvcHRpb25zKTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSwKCiAgICAvLyBJbnRlcm5hbCBtZXRob2QgdG8gY3JlYXRlIGEgbW9kZWwncyB0aWVzIHRvIGEgY29sbGVjdGlvbi4KICAgIF9hZGRSZWZlcmVuY2U6IGZ1bmN0aW9uKG1vZGVsLCBvcHRpb25zKSB7CiAgICAgIHRoaXMuX2J5SWRbbW9kZWwuY2lkXSA9IG1vZGVsOwogICAgICBpZiAobW9kZWwuaWQgIT0gbnVsbCkgdGhpcy5fYnlJZFttb2RlbC5pZF0gPSBtb2RlbDsKICAgICAgaWYgKCFtb2RlbC5jb2xsZWN0aW9uKSBtb2RlbC5jb2xsZWN0aW9uID0gdGhpczsKICAgICAgbW9kZWwub24oJ2FsbCcsIHRoaXMuX29uTW9kZWxFdmVudCwgdGhpcyk7CiAgICB9LAoKICAgIC8vIEludGVybmFsIG1ldGhvZCB0byBzZXZlciBhIG1vZGVsJ3MgdGllcyB0byBhIGNvbGxlY3Rpb24uCiAgICBfcmVtb3ZlUmVmZXJlbmNlOiBmdW5jdGlvbihtb2RlbCwgb3B0aW9ucykgewogICAgICBpZiAodGhpcyA9PT0gbW9kZWwuY29sbGVjdGlvbikgZGVsZXRlIG1vZGVsLmNvbGxlY3Rpb247CiAgICAgIG1vZGVsLm9mZignYWxsJywgdGhpcy5fb25Nb2RlbEV2ZW50LCB0aGlzKTsKICAgIH0sCgogICAgLy8gSW50ZXJuYWwgbWV0aG9kIGNhbGxlZCBldmVyeSB0aW1lIGEgbW9kZWwgaW4gdGhlIHNldCBmaXJlcyBhbiBldmVudC4KICAgIC8vIFNldHMgbmVlZCB0byB1cGRhdGUgdGhlaXIgaW5kZXhlcyB3aGVuIG1vZGVscyBjaGFuZ2UgaWRzLiBBbGwgb3RoZXIKICAgIC8vIGV2ZW50cyBzaW1wbHkgcHJveHkgdGhyb3VnaC4gImFkZCIgYW5kICJyZW1vdmUiIGV2ZW50cyB0aGF0IG9yaWdpbmF0ZQogICAgLy8gaW4gb3RoZXIgY29sbGVjdGlvbnMgYXJlIGlnbm9yZWQuCiAgICBfb25Nb2RlbEV2ZW50OiBmdW5jdGlvbihldmVudCwgbW9kZWwsIGNvbGxlY3Rpb24sIG9wdGlvbnMpIHsKICAgICAgaWYgKChldmVudCA9PT0gJ2FkZCcgfHwgZXZlbnQgPT09ICdyZW1vdmUnKSAmJiBjb2xsZWN0aW9uICE9PSB0aGlzKSByZXR1cm47CiAgICAgIGlmIChldmVudCA9PT0gJ2Rlc3Ryb3knKSB0aGlzLnJlbW92ZShtb2RlbCwgb3B0aW9ucyk7CiAgICAgIGlmIChtb2RlbCAmJiBldmVudCA9PT0gJ2NoYW5nZTonICsgbW9kZWwuaWRBdHRyaWJ1dGUpIHsKICAgICAgICBkZWxldGUgdGhpcy5fYnlJZFttb2RlbC5wcmV2aW91cyhtb2RlbC5pZEF0dHJpYnV0ZSldOwogICAgICAgIGlmIChtb2RlbC5pZCAhPSBudWxsKSB0aGlzLl9ieUlkW21vZGVsLmlkXSA9IG1vZGVsOwogICAgICB9CiAgICAgIHRoaXMudHJpZ2dlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgfQoKICB9KTsKCiAgLy8gVW5kZXJzY29yZSBtZXRob2RzIHRoYXQgd2Ugd2FudCB0byBpbXBsZW1lbnQgb24gdGhlIENvbGxlY3Rpb24uCiAgLy8gOTAlIG9mIHRoZSBjb3JlIHVzZWZ1bG5lc3Mgb2YgQmFja2JvbmUgQ29sbGVjdGlvbnMgaXMgYWN0dWFsbHkgaW1wbGVtZW50ZWQKICAvLyByaWdodCBoZXJlOgogIHZhciBtZXRob2RzID0gWydmb3JFYWNoJywgJ2VhY2gnLCAnbWFwJywgJ2NvbGxlY3QnLCAncmVkdWNlJywgJ2ZvbGRsJywKICAgICdpbmplY3QnLCAncmVkdWNlUmlnaHQnLCAnZm9sZHInLCAnZmluZCcsICdkZXRlY3QnLCAnZmlsdGVyJywgJ3NlbGVjdCcsCiAgICAncmVqZWN0JywgJ2V2ZXJ5JywgJ2FsbCcsICdzb21lJywgJ2FueScsICdpbmNsdWRlJywgJ2NvbnRhaW5zJywgJ2ludm9rZScsCiAgICAnbWF4JywgJ21pbicsICd0b0FycmF5JywgJ3NpemUnLCAnZmlyc3QnLCAnaGVhZCcsICd0YWtlJywgJ2luaXRpYWwnLCAncmVzdCcsCiAgICAndGFpbCcsICdkcm9wJywgJ2xhc3QnLCAnd2l0aG91dCcsICdkaWZmZXJlbmNlJywgJ2luZGV4T2YnLCAnc2h1ZmZsZScsCiAgICAnbGFzdEluZGV4T2YnLCAnaXNFbXB0eScsICdjaGFpbicsICdzYW1wbGUnXTsKCiAgLy8gTWl4IGluIGVhY2ggVW5kZXJzY29yZSBtZXRob2QgYXMgYSBwcm94eSB0byBgQ29sbGVjdGlvbiNtb2RlbHNgLgogIF8uZWFjaChtZXRob2RzLCBmdW5jdGlvbihtZXRob2QpIHsKICAgIENvbGxlY3Rpb24ucHJvdG90eXBlW21ldGhvZF0gPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIGFyZ3MgPSBzbGljZS5jYWxsKGFyZ3VtZW50cyk7CiAgICAgIGFyZ3MudW5zaGlmdCh0aGlzLm1vZGVscyk7CiAgICAgIHJldHVybiBfW21ldGhvZF0uYXBwbHkoXywgYXJncyk7CiAgICB9OwogIH0pOwoKICAvLyBVbmRlcnNjb3JlIG1ldGhvZHMgdGhhdCB0YWtlIGEgcHJvcGVydHkgbmFtZSBhcyBhbiBhcmd1bWVudC4KICB2YXIgYXR0cmlidXRlTWV0aG9kcyA9IFsnZ3JvdXBCeScsICdjb3VudEJ5JywgJ3NvcnRCeScsICdpbmRleEJ5J107CgogIC8vIFVzZSBhdHRyaWJ1dGVzIGluc3RlYWQgb2YgcHJvcGVydGllcy4KICBfLmVhY2goYXR0cmlidXRlTWV0aG9kcywgZnVuY3Rpb24obWV0aG9kKSB7CiAgICBDb2xsZWN0aW9uLnByb3RvdHlwZVttZXRob2RdID0gZnVuY3Rpb24odmFsdWUsIGNvbnRleHQpIHsKICAgICAgdmFyIGl0ZXJhdG9yID0gXy5pc0Z1bmN0aW9uKHZhbHVlKSA/IHZhbHVlIDogZnVuY3Rpb24obW9kZWwpIHsKICAgICAgICByZXR1cm4gbW9kZWwuZ2V0KHZhbHVlKTsKICAgICAgfTsKICAgICAgcmV0dXJuIF9bbWV0aG9kXSh0aGlzLm1vZGVscywgaXRlcmF0b3IsIGNvbnRleHQpOwogICAgfTsKICB9KTsKCiAgLy8gQmFja2JvbmUuVmlldwogIC8vIC0tLS0tLS0tLS0tLS0KCiAgLy8gQmFja2JvbmUgVmlld3MgYXJlIGFsbW9zdCBtb3JlIGNvbnZlbnRpb24gdGhhbiB0aGV5IGFyZSBhY3R1YWwgY29kZS4gQSBWaWV3CiAgLy8gaXMgc2ltcGx5IGEgSmF2YVNjcmlwdCBvYmplY3QgdGhhdCByZXByZXNlbnRzIGEgbG9naWNhbCBjaHVuayBvZiBVSSBpbiB0aGUKICAvLyBET00uIFRoaXMgbWlnaHQgYmUgYSBzaW5nbGUgaXRlbSwgYW4gZW50aXJlIGxpc3QsIGEgc2lkZWJhciBvciBwYW5lbCwgb3IKICAvLyBldmVuIHRoZSBzdXJyb3VuZGluZyBmcmFtZSB3aGljaCB3cmFwcyB5b3VyIHdob2xlIGFwcC4gRGVmaW5pbmcgYSBjaHVuayBvZgogIC8vIFVJIGFzIGEgKipWaWV3KiogYWxsb3dzIHlvdSB0byBkZWZpbmUgeW91ciBET00gZXZlbnRzIGRlY2xhcmF0aXZlbHksIHdpdGhvdXQKICAvLyBoYXZpbmcgdG8gd29ycnkgYWJvdXQgcmVuZGVyIG9yZGVyIC4uLiBhbmQgbWFrZXMgaXQgZWFzeSBmb3IgdGhlIHZpZXcgdG8KICAvLyByZWFjdCB0byBzcGVjaWZpYyBjaGFuZ2VzIGluIHRoZSBzdGF0ZSBvZiB5b3VyIG1vZGVscy4KCiAgLy8gQ3JlYXRpbmcgYSBCYWNrYm9uZS5WaWV3IGNyZWF0ZXMgaXRzIGluaXRpYWwgZWxlbWVudCBvdXRzaWRlIG9mIHRoZSBET00sCiAgLy8gaWYgYW4gZXhpc3RpbmcgZWxlbWVudCBpcyBub3QgcHJvdmlkZWQuLi4KICB2YXIgVmlldyA9IEJhY2tib25lLlZpZXcgPSBmdW5jdGlvbihvcHRpb25zKSB7CiAgICB0aGlzLmNpZCA9IF8udW5pcXVlSWQoJ3ZpZXcnKTsKICAgIG9wdGlvbnMgfHwgKG9wdGlvbnMgPSB7fSk7CiAgICBfLmV4dGVuZCh0aGlzLCBfLnBpY2sob3B0aW9ucywgdmlld09wdGlvbnMpKTsKICAgIHRoaXMuX2Vuc3VyZUVsZW1lbnQoKTsKICAgIHRoaXMuaW5pdGlhbGl6ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgdGhpcy5kZWxlZ2F0ZUV2ZW50cygpOwogIH07CgogIC8vIENhY2hlZCByZWdleCB0byBzcGxpdCBrZXlzIGZvciBgZGVsZWdhdGVgLgogIHZhciBkZWxlZ2F0ZUV2ZW50U3BsaXR0ZXIgPSAvXihcUyspXHMqKC4qKSQvOwoKICAvLyBMaXN0IG9mIHZpZXcgb3B0aW9ucyB0byBiZSBtZXJnZWQgYXMgcHJvcGVydGllcy4KICB2YXIgdmlld09wdGlvbnMgPSBbJ21vZGVsJywgJ2NvbGxlY3Rpb24nLCAnZWwnLCAnaWQnLCAnYXR0cmlidXRlcycsICdjbGFzc05hbWUnLCAndGFnTmFtZScsICdldmVudHMnXTsKCiAgLy8gU2V0IHVwIGFsbCBpbmhlcml0YWJsZSAqKkJhY2tib25lLlZpZXcqKiBwcm9wZXJ0aWVzIGFuZCBtZXRob2RzLgogIF8uZXh0ZW5kKFZpZXcucHJvdG90eXBlLCBFdmVudHMsIHsKCiAgICAvLyBUaGUgZGVmYXVsdCBgdGFnTmFtZWAgb2YgYSBWaWV3J3MgZWxlbWVudCBpcyBgImRpdiJgLgogICAgdGFnTmFtZTogJ2RpdicsCgogICAgLy8galF1ZXJ5IGRlbGVnYXRlIGZvciBlbGVtZW50IGxvb2t1cCwgc2NvcGVkIHRvIERPTSBlbGVtZW50cyB3aXRoaW4gdGhlCiAgICAvLyBjdXJyZW50IHZpZXcuIFRoaXMgc2hvdWxkIGJlIHByZWZlcnJlZCB0byBnbG9iYWwgbG9va3VwcyB3aGVyZSBwb3NzaWJsZS4KICAgICQ6IGZ1bmN0aW9uKHNlbGVjdG9yKSB7CiAgICAgIHJldHVybiB0aGlzLiRlbC5maW5kKHNlbGVjdG9yKTsKICAgIH0sCgogICAgLy8gSW5pdGlhbGl6ZSBpcyBhbiBlbXB0eSBmdW5jdGlvbiBieSBkZWZhdWx0LiBPdmVycmlkZSBpdCB3aXRoIHlvdXIgb3duCiAgICAvLyBpbml0aWFsaXphdGlvbiBsb2dpYy4KICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uKCl7fSwKCiAgICAvLyAqKnJlbmRlcioqIGlzIHRoZSBjb3JlIGZ1bmN0aW9uIHRoYXQgeW91ciB2aWV3IHNob3VsZCBvdmVycmlkZSwgaW4gb3JkZXIKICAgIC8vIHRvIHBvcHVsYXRlIGl0cyBlbGVtZW50IChgdGhpcy5lbGApLCB3aXRoIHRoZSBhcHByb3ByaWF0ZSBIVE1MLiBUaGUKICAgIC8vIGNvbnZlbnRpb24gaXMgZm9yICoqcmVuZGVyKiogdG8gYWx3YXlzIHJldHVybiBgdGhpc2AuCiAgICByZW5kZXI6IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLy8gUmVtb3ZlIHRoaXMgdmlldyBieSB0YWtpbmcgdGhlIGVsZW1lbnQgb3V0IG9mIHRoZSBET00sIGFuZCByZW1vdmluZyBhbnkKICAgIC8vIGFwcGxpY2FibGUgQmFja2JvbmUuRXZlbnRzIGxpc3RlbmVycy4KICAgIHJlbW92ZTogZnVuY3Rpb24oKSB7CiAgICAgIHRoaXMuJGVsLnJlbW92ZSgpOwogICAgICB0aGlzLnN0b3BMaXN0ZW5pbmcoKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAoKICAgIC8vIENoYW5nZSB0aGUgdmlldydzIGVsZW1lbnQgKGB0aGlzLmVsYCBwcm9wZXJ0eSksIGluY2x1ZGluZyBldmVudAogICAgLy8gcmUtZGVsZWdhdGlvbi4KICAgIHNldEVsZW1lbnQ6IGZ1bmN0aW9uKGVsZW1lbnQsIGRlbGVnYXRlKSB7CiAgICAgIGlmICh0aGlzLiRlbCkgdGhpcy51bmRlbGVnYXRlRXZlbnRzKCk7CiAgICAgIHRoaXMuJGVsID0gZWxlbWVudCBpbnN0YW5jZW9mIEJhY2tib25lLiQgPyBlbGVtZW50IDogQmFja2JvbmUuJChlbGVtZW50KTsKICAgICAgdGhpcy5lbCA9IHRoaXMuJGVsWzBdOwogICAgICBpZiAoZGVsZWdhdGUgIT09IGZhbHNlKSB0aGlzLmRlbGVnYXRlRXZlbnRzKCk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvLyBTZXQgY2FsbGJhY2tzLCB3aGVyZSBgdGhpcy5ldmVudHNgIGlzIGEgaGFzaCBvZgogICAgLy8KICAgIC8vICp7ImV2ZW50IHNlbGVjdG9yIjogImNhbGxiYWNrIn0qCiAgICAvLwogICAgLy8gICAgIHsKICAgIC8vICAgICAgICdtb3VzZWRvd24gLnRpdGxlJzogICdlZGl0JywKICAgIC8vICAgICAgICdjbGljayAuYnV0dG9uJzogICAgICdzYXZlJywKICAgIC8vICAgICAgICdjbGljayAub3Blbic6ICAgICAgIGZ1bmN0aW9uKGUpIHsgLi4uIH0KICAgIC8vICAgICB9CiAgICAvLwogICAgLy8gcGFpcnMuIENhbGxiYWNrcyB3aWxsIGJlIGJvdW5kIHRvIHRoZSB2aWV3LCB3aXRoIGB0aGlzYCBzZXQgcHJvcGVybHkuCiAgICAvLyBVc2VzIGV2ZW50IGRlbGVnYXRpb24gZm9yIGVmZmljaWVuY3kuCiAgICAvLyBPbWl0dGluZyB0aGUgc2VsZWN0b3IgYmluZHMgdGhlIGV2ZW50IHRvIGB0aGlzLmVsYC4KICAgIC8vIFRoaXMgb25seSB3b3JrcyBmb3IgZGVsZWdhdGUtYWJsZSBldmVudHM6IG5vdCBgZm9jdXNgLCBgYmx1cmAsIGFuZAogICAgLy8gbm90IGBjaGFuZ2VgLCBgc3VibWl0YCwgYW5kIGByZXNldGAgaW4gSW50ZXJuZXQgRXhwbG9yZXIuCiAgICBkZWxlZ2F0ZUV2ZW50czogZnVuY3Rpb24oZXZlbnRzKSB7CiAgICAgIGlmICghKGV2ZW50cyB8fCAoZXZlbnRzID0gXy5yZXN1bHQodGhpcywgJ2V2ZW50cycpKSkpIHJldHVybiB0aGlzOwogICAgICB0aGlzLnVuZGVsZWdhdGVFdmVudHMoKTsKICAgICAgZm9yICh2YXIga2V5IGluIGV2ZW50cykgewogICAgICAgIHZhciBtZXRob2QgPSBldmVudHNba2V5XTsKICAgICAgICBpZiAoIV8uaXNGdW5jdGlvbihtZXRob2QpKSBtZXRob2QgPSB0aGlzW2V2ZW50c1trZXldXTsKICAgICAgICBpZiAoIW1ldGhvZCkgY29udGludWU7CgogICAgICAgIHZhciBtYXRjaCA9IGtleS5tYXRjaChkZWxlZ2F0ZUV2ZW50U3BsaXR0ZXIpOwogICAgICAgIHZhciBldmVudE5hbWUgPSBtYXRjaFsxXSwgc2VsZWN0b3IgPSBtYXRjaFsyXTsKICAgICAgICBtZXRob2QgPSBfLmJpbmQobWV0aG9kLCB0aGlzKTsKICAgICAgICBldmVudE5hbWUgKz0gJy5kZWxlZ2F0ZUV2ZW50cycgKyB0aGlzLmNpZDsKICAgICAgICBpZiAoc2VsZWN0b3IgPT09ICcnKSB7CiAgICAgICAgICB0aGlzLiRlbC5vbihldmVudE5hbWUsIG1ldGhvZCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuJGVsLm9uKGV2ZW50TmFtZSwgc2VsZWN0b3IsIG1ldGhvZCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvLyBDbGVhcnMgYWxsIGNhbGxiYWNrcyBwcmV2aW91c2x5IGJvdW5kIHRvIHRoZSB2aWV3IHdpdGggYGRlbGVnYXRlRXZlbnRzYC4KICAgIC8vIFlvdSB1c3VhbGx5IGRvbid0IG5lZWQgdG8gdXNlIHRoaXMsIGJ1dCBtYXkgd2lzaCB0byBpZiB5b3UgaGF2ZSBtdWx0aXBsZQogICAgLy8gQmFja2JvbmUgdmlld3MgYXR0YWNoZWQgdG8gdGhlIHNhbWUgRE9NIGVsZW1lbnQuCiAgICB1bmRlbGVnYXRlRXZlbnRzOiBmdW5jdGlvbigpIHsKICAgICAgdGhpcy4kZWwub2ZmKCcuZGVsZWdhdGVFdmVudHMnICsgdGhpcy5jaWQpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLy8gRW5zdXJlIHRoYXQgdGhlIFZpZXcgaGFzIGEgRE9NIGVsZW1lbnQgdG8gcmVuZGVyIGludG8uCiAgICAvLyBJZiBgdGhpcy5lbGAgaXMgYSBzdHJpbmcsIHBhc3MgaXQgdGhyb3VnaCBgJCgpYCwgdGFrZSB0aGUgZmlyc3QKICAgIC8vIG1hdGNoaW5nIGVsZW1lbnQsIGFuZCByZS1hc3NpZ24gaXQgdG8gYGVsYC4gT3RoZXJ3aXNlLCBjcmVhdGUKICAgIC8vIGFuIGVsZW1lbnQgZnJvbSB0aGUgYGlkYCwgYGNsYXNzTmFtZWAgYW5kIGB0YWdOYW1lYCBwcm9wZXJ0aWVzLgogICAgX2Vuc3VyZUVsZW1lbnQ6IGZ1bmN0aW9uKCkgewogICAgICBpZiAoIXRoaXMuZWwpIHsKICAgICAgICB2YXIgYXR0cnMgPSBfLmV4dGVuZCh7fSwgXy5yZXN1bHQodGhpcywgJ2F0dHJpYnV0ZXMnKSk7CiAgICAgICAgaWYgKHRoaXMuaWQpIGF0dHJzLmlkID0gXy5yZXN1bHQodGhpcywgJ2lkJyk7CiAgICAgICAgaWYgKHRoaXMuY2xhc3NOYW1lKSBhdHRyc1snY2xhc3MnXSA9IF8ucmVzdWx0KHRoaXMsICdjbGFzc05hbWUnKTsKICAgICAgICB2YXIgJGVsID0gQmFja2JvbmUuJCgnPCcgKyBfLnJlc3VsdCh0aGlzLCAndGFnTmFtZScpICsgJz4nKS5hdHRyKGF0dHJzKTsKICAgICAgICB0aGlzLnNldEVsZW1lbnQoJGVsLCBmYWxzZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5zZXRFbGVtZW50KF8ucmVzdWx0KHRoaXMsICdlbCcpLCBmYWxzZSk7CiAgICAgIH0KICAgIH0KCiAgfSk7CgogIC8vIEJhY2tib25lLnN5bmMKICAvLyAtLS0tLS0tLS0tLS0tCgogIC8vIE92ZXJyaWRlIHRoaXMgZnVuY3Rpb24gdG8gY2hhbmdlIHRoZSBtYW5uZXIgaW4gd2hpY2ggQmFja2JvbmUgcGVyc2lzdHMKICAvLyBtb2RlbHMgdG8gdGhlIHNlcnZlci4gWW91IHdpbGwgYmUgcGFzc2VkIHRoZSB0eXBlIG9mIHJlcXVlc3QsIGFuZCB0aGUKICAvLyBtb2RlbCBpbiBxdWVzdGlvbi4gQnkgZGVmYXVsdCwgbWFrZXMgYSBSRVNUZnVsIEFqYXggcmVxdWVzdAogIC8vIHRvIHRoZSBtb2RlbCdzIGB1cmwoKWAuIFNvbWUgcG9zc2libGUgY3VzdG9taXphdGlvbnMgY291bGQgYmU6CiAgLy8KICAvLyAqIFVzZSBgc2V0VGltZW91dGAgdG8gYmF0Y2ggcmFwaWQtZmlyZSB1cGRhdGVzIGludG8gYSBzaW5nbGUgcmVxdWVzdC4KICAvLyAqIFNlbmQgdXAgdGhlIG1vZGVscyBhcyBYTUwgaW5zdGVhZCBvZiBKU09OLgogIC8vICogUGVyc2lzdCBtb2RlbHMgdmlhIFdlYlNvY2tldHMgaW5zdGVhZCBvZiBBamF4LgogIC8vCiAgLy8gVHVybiBvbiBgQmFja2JvbmUuZW11bGF0ZUhUVFBgIGluIG9yZGVyIHRvIHNlbmQgYFBVVGAgYW5kIGBERUxFVEVgIHJlcXVlc3RzCiAgLy8gYXMgYFBPU1RgLCB3aXRoIGEgYF9tZXRob2RgIHBhcmFtZXRlciBjb250YWluaW5nIHRoZSB0cnVlIEhUVFAgbWV0aG9kLAogIC8vIGFzIHdlbGwgYXMgYWxsIHJlcXVlc3RzIHdpdGggdGhlIGJvZHkgYXMgYGFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZGAKICAvLyBpbnN0ZWFkIG9mIGBhcHBsaWNhdGlvbi9qc29uYCB3aXRoIHRoZSBtb2RlbCBpbiBhIHBhcmFtIG5hbWVkIGBtb2RlbGAuCiAgLy8gVXNlZnVsIHdoZW4gaW50ZXJmYWNpbmcgd2l0aCBzZXJ2ZXItc2lkZSBsYW5ndWFnZXMgbGlrZSAqKlBIUCoqIHRoYXQgbWFrZQogIC8vIGl0IGRpZmZpY3VsdCB0byByZWFkIHRoZSBib2R5IG9mIGBQVVRgIHJlcXVlc3RzLgogIEJhY2tib25lLnN5bmMgPSBmdW5jdGlvbihtZXRob2QsIG1vZGVsLCBvcHRpb25zKSB7CiAgICB2YXIgdHlwZSA9IG1ldGhvZE1hcFttZXRob2RdOwoKICAgIC8vIERlZmF1bHQgb3B0aW9ucywgdW5sZXNzIHNwZWNpZmllZC4KICAgIF8uZGVmYXVsdHMob3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KSwgewogICAgICBlbXVsYXRlSFRUUDogQmFja2JvbmUuZW11bGF0ZUhUVFAsCiAgICAgIGVtdWxhdGVKU09OOiBCYWNrYm9uZS5lbXVsYXRlSlNPTgogICAgfSk7CgogICAgLy8gRGVmYXVsdCBKU09OLXJlcXVlc3Qgb3B0aW9ucy4KICAgIHZhciBwYXJhbXMgPSB7dHlwZTogdHlwZSwgZGF0YVR5cGU6ICdqc29uJ307CgogICAgLy8gRW5zdXJlIHRoYXQgd2UgaGF2ZSBhIFVSTC4KICAgIGlmICghb3B0aW9ucy51cmwpIHsKICAgICAgcGFyYW1zLnVybCA9IF8ucmVzdWx0KG1vZGVsLCAndXJsJykgfHwgdXJsRXJyb3IoKTsKICAgIH0KCiAgICAvLyBFbnN1cmUgdGhhdCB3ZSBoYXZlIHRoZSBhcHByb3ByaWF0ZSByZXF1ZXN0IGRhdGEuCiAgICBpZiAob3B0aW9ucy5kYXRhID09IG51bGwgJiYgbW9kZWwgJiYgKG1ldGhvZCA9PT0gJ2NyZWF0ZScgfHwgbWV0aG9kID09PSAndXBkYXRlJyB8fCBtZXRob2QgPT09ICdwYXRjaCcpKSB7CiAgICAgIHBhcmFtcy5jb250ZW50VHlwZSA9ICdhcHBsaWNhdGlvbi9qc29uJzsKICAgICAgcGFyYW1zLmRhdGEgPSBKU09OLnN0cmluZ2lmeShvcHRpb25zLmF0dHJzIHx8IG1vZGVsLnRvSlNPTihvcHRpb25zKSk7CiAgICB9CgogICAgLy8gRm9yIG9sZGVyIHNlcnZlcnMsIGVtdWxhdGUgSlNPTiBieSBlbmNvZGluZyB0aGUgcmVxdWVzdCBpbnRvIGFuIEhUTUwtZm9ybS4KICAgIGlmIChvcHRpb25zLmVtdWxhdGVKU09OKSB7CiAgICAgIHBhcmFtcy5jb250ZW50VHlwZSA9ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnOwogICAgICBwYXJhbXMuZGF0YSA9IHBhcmFtcy5kYXRhID8ge21vZGVsOiBwYXJhbXMuZGF0YX0gOiB7fTsKICAgIH0KCiAgICAvLyBGb3Igb2xkZXIgc2VydmVycywgZW11bGF0ZSBIVFRQIGJ5IG1pbWlja2luZyB0aGUgSFRUUCBtZXRob2Qgd2l0aCBgX21ldGhvZGAKICAgIC8vIEFuZCBhbiBgWC1IVFRQLU1ldGhvZC1PdmVycmlkZWAgaGVhZGVyLgogICAgaWYgKG9wdGlvbnMuZW11bGF0ZUhUVFAgJiYgKHR5cGUgPT09ICdQVVQnIHx8IHR5cGUgPT09ICdERUxFVEUnIHx8IHR5cGUgPT09ICdQQVRDSCcpKSB7CiAgICAgIHBhcmFtcy50eXBlID0gJ1BPU1QnOwogICAgICBpZiAob3B0aW9ucy5lbXVsYXRlSlNPTikgcGFyYW1zLmRhdGEuX21ldGhvZCA9IHR5cGU7CiAgICAgIHZhciBiZWZvcmVTZW5kID0gb3B0aW9ucy5iZWZvcmVTZW5kOwogICAgICBvcHRpb25zLmJlZm9yZVNlbmQgPSBmdW5jdGlvbih4aHIpIHsKICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcignWC1IVFRQLU1ldGhvZC1PdmVycmlkZScsIHR5cGUpOwogICAgICAgIGlmIChiZWZvcmVTZW5kKSByZXR1cm4gYmVmb3JlU2VuZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9OwogICAgfQoKICAgIC8vIERvbid0IHByb2Nlc3MgZGF0YSBvbiBhIG5vbi1HRVQgcmVxdWVzdC4KICAgIGlmIChwYXJhbXMudHlwZSAhPT0gJ0dFVCcgJiYgIW9wdGlvbnMuZW11bGF0ZUpTT04pIHsKICAgICAgcGFyYW1zLnByb2Nlc3NEYXRhID0gZmFsc2U7CiAgICB9CgogICAgLy8gSWYgd2UncmUgc2VuZGluZyBhIGBQQVRDSGAgcmVxdWVzdCwgYW5kIHdlJ3JlIGluIGFuIG9sZCBJbnRlcm5ldCBFeHBsb3JlcgogICAgLy8gdGhhdCBzdGlsbCBoYXMgQWN0aXZlWCBlbmFibGVkIGJ5IGRlZmF1bHQsIG92ZXJyaWRlIGpRdWVyeSB0byB1c2UgdGhhdAogICAgLy8gZm9yIFhIUiBpbnN0ZWFkLiBSZW1vdmUgdGhpcyBsaW5lIHdoZW4galF1ZXJ5IHN1cHBvcnRzIGBQQVRDSGAgb24gSUU4LgogICAgaWYgKHBhcmFtcy50eXBlID09PSAnUEFUQ0gnICYmIG5vWGhyUGF0Y2gpIHsKICAgICAgcGFyYW1zLnhociA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBuZXcgQWN0aXZlWE9iamVjdCgiTWljcm9zb2Z0LlhNTEhUVFAiKTsKICAgICAgfTsKICAgIH0KCiAgICAvLyBNYWtlIHRoZSByZXF1ZXN0LCBhbGxvd2luZyB0aGUgdXNlciB0byBvdmVycmlkZSBhbnkgQWpheCBvcHRpb25zLgogICAgdmFyIHhociA9IG9wdGlvbnMueGhyID0gQmFja2JvbmUuYWpheChfLmV4dGVuZChwYXJhbXMsIG9wdGlvbnMpKTsKICAgIG1vZGVsLnRyaWdnZXIoJ3JlcXVlc3QnLCBtb2RlbCwgeGhyLCBvcHRpb25zKTsKICAgIHJldHVybiB4aHI7CiAgfTsKCiAgdmFyIG5vWGhyUGF0Y2ggPQogICAgdHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgJiYgISF3aW5kb3cuQWN0aXZlWE9iamVjdCAmJgogICAgICAhKHdpbmRvdy5YTUxIdHRwUmVxdWVzdCAmJiAobmV3IFhNTEh0dHBSZXF1ZXN0KS5kaXNwYXRjaEV2ZW50KTsKCiAgLy8gTWFwIGZyb20gQ1JVRCB0byBIVFRQIGZvciBvdXIgZGVmYXVsdCBgQmFja2JvbmUuc3luY2AgaW1wbGVtZW50YXRpb24uCiAgdmFyIG1ldGhvZE1hcCA9IHsKICAgICdjcmVhdGUnOiAnUE9TVCcsCiAgICAndXBkYXRlJzogJ1BVVCcsCiAgICAncGF0Y2gnOiAgJ1BBVENIJywKICAgICdkZWxldGUnOiAnREVMRVRFJywKICAgICdyZWFkJzogICAnR0VUJwogIH07CgogIC8vIFNldCB0aGUgZGVmYXVsdCBpbXBsZW1lbnRhdGlvbiBvZiBgQmFja2JvbmUuYWpheGAgdG8gcHJveHkgdGhyb3VnaCB0byBgJGAuCiAgLy8gT3ZlcnJpZGUgdGhpcyBpZiB5b3UnZCBsaWtlIHRvIHVzZSBhIGRpZmZlcmVudCBsaWJyYXJ5LgogIEJhY2tib25lLmFqYXggPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiBCYWNrYm9uZS4kLmFqYXguYXBwbHkoQmFja2JvbmUuJCwgYXJndW1lbnRzKTsKICB9OwoKICAvLyBCYWNrYm9uZS5Sb3V0ZXIKICAvLyAtLS0tLS0tLS0tLS0tLS0KCiAgLy8gUm91dGVycyBtYXAgZmF1eC1VUkxzIHRvIGFjdGlvbnMsIGFuZCBmaXJlIGV2ZW50cyB3aGVuIHJvdXRlcyBhcmUKICAvLyBtYXRjaGVkLiBDcmVhdGluZyBhIG5ldyBvbmUgc2V0cyBpdHMgYHJvdXRlc2AgaGFzaCwgaWYgbm90IHNldCBzdGF0aWNhbGx5LgogIHZhciBSb3V0ZXIgPSBCYWNrYm9uZS5Sb3V0ZXIgPSBmdW5jdGlvbihvcHRpb25zKSB7CiAgICBvcHRpb25zIHx8IChvcHRpb25zID0ge30pOwogICAgaWYgKG9wdGlvbnMucm91dGVzKSB0aGlzLnJvdXRlcyA9IG9wdGlvbnMucm91dGVzOwogICAgdGhpcy5fYmluZFJvdXRlcygpOwogICAgdGhpcy5pbml0aWFsaXplLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgfTsKCiAgLy8gQ2FjaGVkIHJlZ3VsYXIgZXhwcmVzc2lvbnMgZm9yIG1hdGNoaW5nIG5hbWVkIHBhcmFtIHBhcnRzIGFuZCBzcGxhdHRlZAogIC8vIHBhcnRzIG9mIHJvdXRlIHN0cmluZ3MuCiAgdmFyIG9wdGlvbmFsUGFyYW0gPSAvXCgoLio/KVwpL2c7CiAgdmFyIG5hbWVkUGFyYW0gICAgPSAvKFwoXD8pPzpcdysvZzsKICB2YXIgc3BsYXRQYXJhbSAgICA9IC9cKlx3Ky9nOwogIHZhciBlc2NhcGVSZWdFeHAgID0gL1tcLXt9XFtcXSs/LixcXFxeJHwjXHNdL2c7CgogIC8vIFNldCB1cCBhbGwgaW5oZXJpdGFibGUgKipCYWNrYm9uZS5Sb3V0ZXIqKiBwcm9wZXJ0aWVzIGFuZCBtZXRob2RzLgogIF8uZXh0ZW5kKFJvdXRlci5wcm90b3R5cGUsIEV2ZW50cywgewoKICAgIC8vIEluaXRpYWxpemUgaXMgYW4gZW1wdHkgZnVuY3Rpb24gYnkgZGVmYXVsdC4gT3ZlcnJpZGUgaXQgd2l0aCB5b3VyIG93bgogICAgLy8gaW5pdGlhbGl6YXRpb24gbG9naWMuCiAgICBpbml0aWFsaXplOiBmdW5jdGlvbigpe30sCgogICAgLy8gTWFudWFsbHkgYmluZCBhIHNpbmdsZSBuYW1lZCByb3V0ZSB0byBhIGNhbGxiYWNrLiBGb3IgZXhhbXBsZToKICAgIC8vCiAgICAvLyAgICAgdGhpcy5yb3V0ZSgnc2VhcmNoLzpxdWVyeS9wOm51bScsICdzZWFyY2gnLCBmdW5jdGlvbihxdWVyeSwgbnVtKSB7CiAgICAvLyAgICAgICAuLi4KICAgIC8vICAgICB9KTsKICAgIC8vCiAgICByb3V0ZTogZnVuY3Rpb24ocm91dGUsIG5hbWUsIGNhbGxiYWNrKSB7CiAgICAgIGlmICghXy5pc1JlZ0V4cChyb3V0ZSkpIHJvdXRlID0gdGhpcy5fcm91dGVUb1JlZ0V4cChyb3V0ZSk7CiAgICAgIGlmIChfLmlzRnVuY3Rpb24obmFtZSkpIHsKICAgICAgICBjYWxsYmFjayA9IG5hbWU7CiAgICAgICAgbmFtZSA9ICcnOwogICAgICB9CiAgICAgIGlmICghY2FsbGJhY2spIGNhbGxiYWNrID0gdGhpc1tuYW1lXTsKICAgICAgdmFyIHJvdXRlciA9IHRoaXM7CiAgICAgIEJhY2tib25lLmhpc3Rvcnkucm91dGUocm91dGUsIGZ1bmN0aW9uKGZyYWdtZW50KSB7CiAgICAgICAgdmFyIGFyZ3MgPSByb3V0ZXIuX2V4dHJhY3RQYXJhbWV0ZXJzKHJvdXRlLCBmcmFnbWVudCk7CiAgICAgICAgcm91dGVyLmV4ZWN1dGUoY2FsbGJhY2ssIGFyZ3MpOwogICAgICAgIHJvdXRlci50cmlnZ2VyLmFwcGx5KHJvdXRlciwgWydyb3V0ZTonICsgbmFtZV0uY29uY2F0KGFyZ3MpKTsKICAgICAgICByb3V0ZXIudHJpZ2dlcigncm91dGUnLCBuYW1lLCBhcmdzKTsKICAgICAgICBCYWNrYm9uZS5oaXN0b3J5LnRyaWdnZXIoJ3JvdXRlJywgcm91dGVyLCBuYW1lLCBhcmdzKTsKICAgICAgfSk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvLyBFeGVjdXRlIGEgcm91dGUgaGFuZGxlciB3aXRoIHRoZSBwcm92aWRlZCBwYXJhbWV0ZXJzLiAgVGhpcyBpcyBhbgogICAgLy8gZXhjZWxsZW50IHBsYWNlIHRvIGRvIHByZS1yb3V0ZSBzZXR1cCBvciBwb3N0LXJvdXRlIGNsZWFudXAuCiAgICBleGVjdXRlOiBmdW5jdGlvbihjYWxsYmFjaywgYXJncykgewogICAgICBpZiAoY2FsbGJhY2spIGNhbGxiYWNrLmFwcGx5KHRoaXMsIGFyZ3MpOwogICAgfSwKCiAgICAvLyBTaW1wbGUgcHJveHkgdG8gYEJhY2tib25lLmhpc3RvcnlgIHRvIHNhdmUgYSBmcmFnbWVudCBpbnRvIHRoZSBoaXN0b3J5LgogICAgbmF2aWdhdGU6IGZ1bmN0aW9uKGZyYWdtZW50LCBvcHRpb25zKSB7CiAgICAgIEJhY2tib25lLmhpc3RvcnkubmF2aWdhdGUoZnJhZ21lbnQsIG9wdGlvbnMpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLy8gQmluZCBhbGwgZGVmaW5lZCByb3V0ZXMgdG8gYEJhY2tib25lLmhpc3RvcnlgLiBXZSBoYXZlIHRvIHJldmVyc2UgdGhlCiAgICAvLyBvcmRlciBvZiB0aGUgcm91dGVzIGhlcmUgdG8gc3VwcG9ydCBiZWhhdmlvciB3aGVyZSB0aGUgbW9zdCBnZW5lcmFsCiAgICAvLyByb3V0ZXMgY2FuIGJlIGRlZmluZWQgYXQgdGhlIGJvdHRvbSBvZiB0aGUgcm91dGUgbWFwLgogICAgX2JpbmRSb3V0ZXM6IGZ1bmN0aW9uKCkgewogICAgICBpZiAoIXRoaXMucm91dGVzKSByZXR1cm47CiAgICAgIHRoaXMucm91dGVzID0gXy5yZXN1bHQodGhpcywgJ3JvdXRlcycpOwogICAgICB2YXIgcm91dGUsIHJvdXRlcyA9IF8ua2V5cyh0aGlzLnJvdXRlcyk7CiAgICAgIHdoaWxlICgocm91dGUgPSByb3V0ZXMucG9wKCkpICE9IG51bGwpIHsKICAgICAgICB0aGlzLnJvdXRlKHJvdXRlLCB0aGlzLnJvdXRlc1tyb3V0ZV0pOwogICAgICB9CiAgICB9LAoKICAgIC8vIENvbnZlcnQgYSByb3V0ZSBzdHJpbmcgaW50byBhIHJlZ3VsYXIgZXhwcmVzc2lvbiwgc3VpdGFibGUgZm9yIG1hdGNoaW5nCiAgICAvLyBhZ2FpbnN0IHRoZSBjdXJyZW50IGxvY2F0aW9uIGhhc2guCiAgICBfcm91dGVUb1JlZ0V4cDogZnVuY3Rpb24ocm91dGUpIHsKICAgICAgcm91dGUgPSByb3V0ZS5yZXBsYWNlKGVzY2FwZVJlZ0V4cCwgJ1xcJCYnKQogICAgICAgICAgICAgICAgICAgLnJlcGxhY2Uob3B0aW9uYWxQYXJhbSwgJyg/OiQxKT8nKQogICAgICAgICAgICAgICAgICAgLnJlcGxhY2UobmFtZWRQYXJhbSwgZnVuY3Rpb24obWF0Y2gsIG9wdGlvbmFsKSB7CiAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvcHRpb25hbCA/IG1hdGNoIDogJyhbXi8/XSspJzsKICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAucmVwbGFjZShzcGxhdFBhcmFtLCAnKFteP10qPyknKTsKICAgICAgcmV0dXJuIG5ldyBSZWdFeHAoJ14nICsgcm91dGUgKyAnKD86XFw/KFtcXHNcXFNdKikpPyQnKTsKICAgIH0sCgogICAgLy8gR2l2ZW4gYSByb3V0ZSwgYW5kIGEgVVJMIGZyYWdtZW50IHRoYXQgaXQgbWF0Y2hlcywgcmV0dXJuIHRoZSBhcnJheSBvZgogICAgLy8gZXh0cmFjdGVkIGRlY29kZWQgcGFyYW1ldGVycy4gRW1wdHkgb3IgdW5tYXRjaGVkIHBhcmFtZXRlcnMgd2lsbCBiZQogICAgLy8gdHJlYXRlZCBhcyBgbnVsbGAgdG8gbm9ybWFsaXplIGNyb3NzLWJyb3dzZXIgYmVoYXZpb3IuCiAgICBfZXh0cmFjdFBhcmFtZXRlcnM6IGZ1bmN0aW9uKHJvdXRlLCBmcmFnbWVudCkgewogICAgICB2YXIgcGFyYW1zID0gcm91dGUuZXhlYyhmcmFnbWVudCkuc2xpY2UoMSk7CiAgICAgIHJldHVybiBfLm1hcChwYXJhbXMsIGZ1bmN0aW9uKHBhcmFtLCBpKSB7CiAgICAgICAgLy8gRG9uJ3QgZGVjb2RlIHRoZSBzZWFyY2ggcGFyYW1zLgogICAgICAgIGlmIChpID09PSBwYXJhbXMubGVuZ3RoIC0gMSkgcmV0dXJuIHBhcmFtIHx8IG51bGw7CiAgICAgICAgcmV0dXJuIHBhcmFtID8gZGVjb2RlVVJJQ29tcG9uZW50KHBhcmFtKSA6IG51bGw7CiAgICAgIH0pOwogICAgfQoKICB9KTsKCiAgLy8gQmFja2JvbmUuSGlzdG9yeQogIC8vIC0tLS0tLS0tLS0tLS0tLS0KCiAgLy8gSGFuZGxlcyBjcm9zcy1icm93c2VyIGhpc3RvcnkgbWFuYWdlbWVudCwgYmFzZWQgb24gZWl0aGVyCiAgLy8gW3B1c2hTdGF0ZV0oaHR0cDovL2RpdmVpbnRvaHRtbDUuaW5mby9oaXN0b3J5Lmh0bWwpIGFuZCByZWFsIFVSTHMsIG9yCiAgLy8gW29uaGFzaGNoYW5nZV0oaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9ET00vd2luZG93Lm9uaGFzaGNoYW5nZSkKICAvLyBhbmQgVVJMIGZyYWdtZW50cy4gSWYgdGhlIGJyb3dzZXIgc3VwcG9ydHMgbmVpdGhlciAob2xkIElFLCBuYXRjaCksCiAgLy8gZmFsbHMgYmFjayB0byBwb2xsaW5nLgogIHZhciBIaXN0b3J5ID0gQmFja2JvbmUuSGlzdG9yeSA9IGZ1bmN0aW9uKCkgewogICAgdGhpcy5oYW5kbGVycyA9IFtdOwogICAgXy5iaW5kQWxsKHRoaXMsICdjaGVja1VybCcpOwoKICAgIC8vIEVuc3VyZSB0aGF0IGBIaXN0b3J5YCBjYW4gYmUgdXNlZCBvdXRzaWRlIG9mIHRoZSBicm93c2VyLgogICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgIHRoaXMubG9jYXRpb24gPSB3aW5kb3cubG9jYXRpb247CiAgICAgIHRoaXMuaGlzdG9yeSA9IHdpbmRvdy5oaXN0b3J5OwogICAgfQogIH07CgogIC8vIENhY2hlZCByZWdleCBmb3Igc3RyaXBwaW5nIGEgbGVhZGluZyBoYXNoL3NsYXNoIGFuZCB0cmFpbGluZyBzcGFjZS4KICB2YXIgcm91dGVTdHJpcHBlciA9IC9eWyNcL118XHMrJC9nOwoKICAvLyBDYWNoZWQgcmVnZXggZm9yIHN0cmlwcGluZyBsZWFkaW5nIGFuZCB0cmFpbGluZyBzbGFzaGVzLgogIHZhciByb290U3RyaXBwZXIgPSAvXlwvK3xcLyskL2c7CgogIC8vIENhY2hlZCByZWdleCBmb3IgZGV0ZWN0aW5nIE1TSUUuCiAgdmFyIGlzRXhwbG9yZXIgPSAvbXNpZSBbXHcuXSsvOwoKICAvLyBDYWNoZWQgcmVnZXggZm9yIHJlbW92aW5nIGEgdHJhaWxpbmcgc2xhc2guCiAgdmFyIHRyYWlsaW5nU2xhc2ggPSAvXC8kLzsKCiAgLy8gQ2FjaGVkIHJlZ2V4IGZvciBzdHJpcHBpbmcgdXJscyBvZiBoYXNoLgogIHZhciBwYXRoU3RyaXBwZXIgPSAvIy4qJC87CgogIC8vIEhhcyB0aGUgaGlzdG9yeSBoYW5kbGluZyBhbHJlYWR5IGJlZW4gc3RhcnRlZD8KICBIaXN0b3J5LnN0YXJ0ZWQgPSBmYWxzZTsKCiAgLy8gU2V0IHVwIGFsbCBpbmhlcml0YWJsZSAqKkJhY2tib25lLkhpc3RvcnkqKiBwcm9wZXJ0aWVzIGFuZCBtZXRob2RzLgogIF8uZXh0ZW5kKEhpc3RvcnkucHJvdG90eXBlLCBFdmVudHMsIHsKCiAgICAvLyBUaGUgZGVmYXVsdCBpbnRlcnZhbCB0byBwb2xsIGZvciBoYXNoIGNoYW5nZXMsIGlmIG5lY2Vzc2FyeSwgaXMKICAgIC8vIHR3ZW50eSB0aW1lcyBhIHNlY29uZC4KICAgIGludGVydmFsOiA1MCwKCiAgICAvLyBBcmUgd2UgYXQgdGhlIGFwcCByb290PwogICAgYXRSb290OiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIHRoaXMubG9jYXRpb24ucGF0aG5hbWUucmVwbGFjZSgvW15cL10kLywgJyQmLycpID09PSB0aGlzLnJvb3Q7CiAgICB9LAoKICAgIC8vIEdldHMgdGhlIHRydWUgaGFzaCB2YWx1ZS4gQ2Fubm90IHVzZSBsb2NhdGlvbi5oYXNoIGRpcmVjdGx5IGR1ZSB0byBidWcKICAgIC8vIGluIEZpcmVmb3ggd2hlcmUgbG9jYXRpb24uaGFzaCB3aWxsIGFsd2F5cyBiZSBkZWNvZGVkLgogICAgZ2V0SGFzaDogZnVuY3Rpb24od2luZG93KSB7CiAgICAgIHZhciBtYXRjaCA9ICh3aW5kb3cgfHwgdGhpcykubG9jYXRpb24uaHJlZi5tYXRjaCgvIyguKikkLyk7CiAgICAgIHJldHVybiBtYXRjaCA/IG1hdGNoWzFdIDogJyc7CiAgICB9LAoKICAgIC8vIEdldCB0aGUgY3Jvc3MtYnJvd3NlciBub3JtYWxpemVkIFVSTCBmcmFnbWVudCwgZWl0aGVyIGZyb20gdGhlIFVSTCwKICAgIC8vIHRoZSBoYXNoLCBvciB0aGUgb3ZlcnJpZGUuCiAgICBnZXRGcmFnbWVudDogZnVuY3Rpb24oZnJhZ21lbnQsIGZvcmNlUHVzaFN0YXRlKSB7CiAgICAgIGlmIChmcmFnbWVudCA9PSBudWxsKSB7CiAgICAgICAgaWYgKHRoaXMuX2hhc1B1c2hTdGF0ZSB8fCAhdGhpcy5fd2FudHNIYXNoQ2hhbmdlIHx8IGZvcmNlUHVzaFN0YXRlKSB7CiAgICAgICAgICBmcmFnbWVudCA9IGRlY29kZVVSSSh0aGlzLmxvY2F0aW9uLnBhdGhuYW1lICsgdGhpcy5sb2NhdGlvbi5zZWFyY2gpOwogICAgICAgICAgdmFyIHJvb3QgPSB0aGlzLnJvb3QucmVwbGFjZSh0cmFpbGluZ1NsYXNoLCAnJyk7CiAgICAgICAgICBpZiAoIWZyYWdtZW50LmluZGV4T2Yocm9vdCkpIGZyYWdtZW50ID0gZnJhZ21lbnQuc2xpY2Uocm9vdC5sZW5ndGgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBmcmFnbWVudCA9IHRoaXMuZ2V0SGFzaCgpOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gZnJhZ21lbnQucmVwbGFjZShyb3V0ZVN0cmlwcGVyLCAnJyk7CiAgICB9LAoKICAgIC8vIFN0YXJ0IHRoZSBoYXNoIGNoYW5nZSBoYW5kbGluZywgcmV0dXJuaW5nIGB0cnVlYCBpZiB0aGUgY3VycmVudCBVUkwgbWF0Y2hlcwogICAgLy8gYW4gZXhpc3Rpbmcgcm91dGUsIGFuZCBgZmFsc2VgIG90aGVyd2lzZS4KICAgIHN0YXJ0OiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgIGlmIChIaXN0b3J5LnN0YXJ0ZWQpIHRocm93IG5ldyBFcnJvcigiQmFja2JvbmUuaGlzdG9yeSBoYXMgYWxyZWFkeSBiZWVuIHN0YXJ0ZWQiKTsKICAgICAgSGlzdG9yeS5zdGFydGVkID0gdHJ1ZTsKCiAgICAgIC8vIEZpZ3VyZSBvdXQgdGhlIGluaXRpYWwgY29uZmlndXJhdGlvbi4gRG8gd2UgbmVlZCBhbiBpZnJhbWU/CiAgICAgIC8vIElzIHB1c2hTdGF0ZSBkZXNpcmVkIC4uLiBpcyBpdCBhdmFpbGFibGU/CiAgICAgIHRoaXMub3B0aW9ucyAgICAgICAgICA9IF8uZXh0ZW5kKHtyb290OiAnLyd9LCB0aGlzLm9wdGlvbnMsIG9wdGlvbnMpOwogICAgICB0aGlzLnJvb3QgICAgICAgICAgICAgPSB0aGlzLm9wdGlvbnMucm9vdDsKICAgICAgdGhpcy5fd2FudHNIYXNoQ2hhbmdlID0gdGhpcy5vcHRpb25zLmhhc2hDaGFuZ2UgIT09IGZhbHNlOwogICAgICB0aGlzLl93YW50c1B1c2hTdGF0ZSAgPSAhIXRoaXMub3B0aW9ucy5wdXNoU3RhdGU7CiAgICAgIHRoaXMuX2hhc1B1c2hTdGF0ZSAgICA9ICEhKHRoaXMub3B0aW9ucy5wdXNoU3RhdGUgJiYgdGhpcy5oaXN0b3J5ICYmIHRoaXMuaGlzdG9yeS5wdXNoU3RhdGUpOwogICAgICB2YXIgZnJhZ21lbnQgICAgICAgICAgPSB0aGlzLmdldEZyYWdtZW50KCk7CiAgICAgIHZhciBkb2NNb2RlICAgICAgICAgICA9IGRvY3VtZW50LmRvY3VtZW50TW9kZTsKICAgICAgdmFyIG9sZElFICAgICAgICAgICAgID0gKGlzRXhwbG9yZXIuZXhlYyhuYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCkpICYmICghZG9jTW9kZSB8fCBkb2NNb2RlIDw9IDcpKTsKCiAgICAgIC8vIE5vcm1hbGl6ZSByb290IHRvIGFsd2F5cyBpbmNsdWRlIGEgbGVhZGluZyBhbmQgdHJhaWxpbmcgc2xhc2guCiAgICAgIHRoaXMucm9vdCA9ICgnLycgKyB0aGlzLnJvb3QgKyAnLycpLnJlcGxhY2Uocm9vdFN0cmlwcGVyLCAnLycpOwoKICAgICAgaWYgKG9sZElFICYmIHRoaXMuX3dhbnRzSGFzaENoYW5nZSkgewogICAgICAgIHZhciBmcmFtZSA9IEJhY2tib25lLiQoJzxpZnJhbWUgc3JjPSJqYXZhc2NyaXB0OjAiIHRhYmluZGV4PSItMSI+Jyk7CiAgICAgICAgdGhpcy5pZnJhbWUgPSBmcmFtZS5oaWRlKCkuYXBwZW5kVG8oJ2JvZHknKVswXS5jb250ZW50V2luZG93OwogICAgICAgIHRoaXMubmF2aWdhdGUoZnJhZ21lbnQpOwogICAgICB9CgogICAgICAvLyBEZXBlbmRpbmcgb24gd2hldGhlciB3ZSdyZSB1c2luZyBwdXNoU3RhdGUgb3IgaGFzaGVzLCBhbmQgd2hldGhlcgogICAgICAvLyAnb25oYXNoY2hhbmdlJyBpcyBzdXBwb3J0ZWQsIGRldGVybWluZSBob3cgd2UgY2hlY2sgdGhlIFVSTCBzdGF0ZS4KICAgICAgaWYgKHRoaXMuX2hhc1B1c2hTdGF0ZSkgewogICAgICAgIEJhY2tib25lLiQod2luZG93KS5vbigncG9wc3RhdGUnLCB0aGlzLmNoZWNrVXJsKTsKICAgICAgfSBlbHNlIGlmICh0aGlzLl93YW50c0hhc2hDaGFuZ2UgJiYgKCdvbmhhc2hjaGFuZ2UnIGluIHdpbmRvdykgJiYgIW9sZElFKSB7CiAgICAgICAgQmFja2JvbmUuJCh3aW5kb3cpLm9uKCdoYXNoY2hhbmdlJywgdGhpcy5jaGVja1VybCk7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5fd2FudHNIYXNoQ2hhbmdlKSB7CiAgICAgICAgdGhpcy5fY2hlY2tVcmxJbnRlcnZhbCA9IHNldEludGVydmFsKHRoaXMuY2hlY2tVcmwsIHRoaXMuaW50ZXJ2YWwpOwogICAgICB9CgogICAgICAvLyBEZXRlcm1pbmUgaWYgd2UgbmVlZCB0byBjaGFuZ2UgdGhlIGJhc2UgdXJsLCBmb3IgYSBwdXNoU3RhdGUgbGluawogICAgICAvLyBvcGVuZWQgYnkgYSBub24tcHVzaFN0YXRlIGJyb3dzZXIuCiAgICAgIHRoaXMuZnJhZ21lbnQgPSBmcmFnbWVudDsKICAgICAgdmFyIGxvYyA9IHRoaXMubG9jYXRpb247CgogICAgICAvLyBUcmFuc2l0aW9uIGZyb20gaGFzaENoYW5nZSB0byBwdXNoU3RhdGUgb3IgdmljZSB2ZXJzYSBpZiBib3RoIGFyZQogICAgICAvLyByZXF1ZXN0ZWQuCiAgICAgIGlmICh0aGlzLl93YW50c0hhc2hDaGFuZ2UgJiYgdGhpcy5fd2FudHNQdXNoU3RhdGUpIHsKCiAgICAgICAgLy8gSWYgd2UndmUgc3RhcnRlZCBvZmYgd2l0aCBhIHJvdXRlIGZyb20gYSBgcHVzaFN0YXRlYC1lbmFibGVkCiAgICAgICAgLy8gYnJvd3NlciwgYnV0IHdlJ3JlIGN1cnJlbnRseSBpbiBhIGJyb3dzZXIgdGhhdCBkb2Vzbid0IHN1cHBvcnQgaXQuLi4KICAgICAgICBpZiAoIXRoaXMuX2hhc1B1c2hTdGF0ZSAmJiAhdGhpcy5hdFJvb3QoKSkgewogICAgICAgICAgdGhpcy5mcmFnbWVudCA9IHRoaXMuZ2V0RnJhZ21lbnQobnVsbCwgdHJ1ZSk7CiAgICAgICAgICB0aGlzLmxvY2F0aW9uLnJlcGxhY2UodGhpcy5yb290ICsgJyMnICsgdGhpcy5mcmFnbWVudCk7CiAgICAgICAgICAvLyBSZXR1cm4gaW1tZWRpYXRlbHkgYXMgYnJvd3NlciB3aWxsIGRvIHJlZGlyZWN0IHRvIG5ldyB1cmwKICAgICAgICAgIHJldHVybiB0cnVlOwoKICAgICAgICAvLyBPciBpZiB3ZSd2ZSBzdGFydGVkIG91dCB3aXRoIGEgaGFzaC1iYXNlZCByb3V0ZSwgYnV0IHdlJ3JlIGN1cnJlbnRseQogICAgICAgIC8vIGluIGEgYnJvd3NlciB3aGVyZSBpdCBjb3VsZCBiZSBgcHVzaFN0YXRlYC1iYXNlZCBpbnN0ZWFkLi4uCiAgICAgICAgfSBlbHNlIGlmICh0aGlzLl9oYXNQdXNoU3RhdGUgJiYgdGhpcy5hdFJvb3QoKSAmJiBsb2MuaGFzaCkgewogICAgICAgICAgdGhpcy5mcmFnbWVudCA9IHRoaXMuZ2V0SGFzaCgpLnJlcGxhY2Uocm91dGVTdHJpcHBlciwgJycpOwogICAgICAgICAgdGhpcy5oaXN0b3J5LnJlcGxhY2VTdGF0ZSh7fSwgZG9jdW1lbnQudGl0bGUsIHRoaXMucm9vdCArIHRoaXMuZnJhZ21lbnQpOwogICAgICAgIH0KCiAgICAgIH0KCiAgICAgIGlmICghdGhpcy5vcHRpb25zLnNpbGVudCkgcmV0dXJuIHRoaXMubG9hZFVybCgpOwogICAgfSwKCiAgICAvLyBEaXNhYmxlIEJhY2tib25lLmhpc3RvcnksIHBlcmhhcHMgdGVtcG9yYXJpbHkuIE5vdCB1c2VmdWwgaW4gYSByZWFsIGFwcCwKICAgIC8vIGJ1dCBwb3NzaWJseSB1c2VmdWwgZm9yIHVuaXQgdGVzdGluZyBSb3V0ZXJzLgogICAgc3RvcDogZnVuY3Rpb24oKSB7CiAgICAgIEJhY2tib25lLiQod2luZG93KS5vZmYoJ3BvcHN0YXRlJywgdGhpcy5jaGVja1VybCkub2ZmKCdoYXNoY2hhbmdlJywgdGhpcy5jaGVja1VybCk7CiAgICAgIGlmICh0aGlzLl9jaGVja1VybEludGVydmFsKSBjbGVhckludGVydmFsKHRoaXMuX2NoZWNrVXJsSW50ZXJ2YWwpOwogICAgICBIaXN0b3J5LnN0YXJ0ZWQgPSBmYWxzZTsKICAgIH0sCgogICAgLy8gQWRkIGEgcm91dGUgdG8gYmUgdGVzdGVkIHdoZW4gdGhlIGZyYWdtZW50IGNoYW5nZXMuIFJvdXRlcyBhZGRlZCBsYXRlcgogICAgLy8gbWF5IG92ZXJyaWRlIHByZXZpb3VzIHJvdXRlcy4KICAgIHJvdXRlOiBmdW5jdGlvbihyb3V0ZSwgY2FsbGJhY2spIHsKICAgICAgdGhpcy5oYW5kbGVycy51bnNoaWZ0KHtyb3V0ZTogcm91dGUsIGNhbGxiYWNrOiBjYWxsYmFja30pOwogICAgfSwKCiAgICAvLyBDaGVja3MgdGhlIGN1cnJlbnQgVVJMIHRvIHNlZSBpZiBpdCBoYXMgY2hhbmdlZCwgYW5kIGlmIGl0IGhhcywKICAgIC8vIGNhbGxzIGBsb2FkVXJsYCwgbm9ybWFsaXppbmcgYWNyb3NzIHRoZSBoaWRkZW4gaWZyYW1lLgogICAgY2hlY2tVcmw6IGZ1bmN0aW9uKGUpIHsKICAgICAgdmFyIGN1cnJlbnQgPSB0aGlzLmdldEZyYWdtZW50KCk7CiAgICAgIGlmIChjdXJyZW50ID09PSB0aGlzLmZyYWdtZW50ICYmIHRoaXMuaWZyYW1lKSB7CiAgICAgICAgY3VycmVudCA9IHRoaXMuZ2V0RnJhZ21lbnQodGhpcy5nZXRIYXNoKHRoaXMuaWZyYW1lKSk7CiAgICAgIH0KICAgICAgaWYgKGN1cnJlbnQgPT09IHRoaXMuZnJhZ21lbnQpIHJldHVybiBmYWxzZTsKICAgICAgaWYgKHRoaXMuaWZyYW1lKSB0aGlzLm5hdmlnYXRlKGN1cnJlbnQpOwogICAgICB0aGlzLmxvYWRVcmwoKTsKICAgIH0sCgogICAgLy8gQXR0ZW1wdCB0byBsb2FkIHRoZSBjdXJyZW50IFVSTCBmcmFnbWVudC4gSWYgYSByb3V0ZSBzdWNjZWVkcyB3aXRoIGEKICAgIC8vIG1hdGNoLCByZXR1cm5zIGB0cnVlYC4gSWYgbm8gZGVmaW5lZCByb3V0ZXMgbWF0Y2hlcyB0aGUgZnJhZ21lbnQsCiAgICAvLyByZXR1cm5zIGBmYWxzZWAuCiAgICBsb2FkVXJsOiBmdW5jdGlvbihmcmFnbWVudCkgewogICAgICBmcmFnbWVudCA9IHRoaXMuZnJhZ21lbnQgPSB0aGlzLmdldEZyYWdtZW50KGZyYWdtZW50KTsKICAgICAgcmV0dXJuIF8uYW55KHRoaXMuaGFuZGxlcnMsIGZ1bmN0aW9uKGhhbmRsZXIpIHsKICAgICAgICBpZiAoaGFuZGxlci5yb3V0ZS50ZXN0KGZyYWdtZW50KSkgewogICAgICAgICAgaGFuZGxlci5jYWxsYmFjayhmcmFnbWVudCk7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKCiAgICAvLyBTYXZlIGEgZnJhZ21lbnQgaW50byB0aGUgaGFzaCBoaXN0b3J5LCBvciByZXBsYWNlIHRoZSBVUkwgc3RhdGUgaWYgdGhlCiAgICAvLyAncmVwbGFjZScgb3B0aW9uIGlzIHBhc3NlZC4gWW91IGFyZSByZXNwb25zaWJsZSBmb3IgcHJvcGVybHkgVVJMLWVuY29kaW5nCiAgICAvLyB0aGUgZnJhZ21lbnQgaW4gYWR2YW5jZS4KICAgIC8vCiAgICAvLyBUaGUgb3B0aW9ucyBvYmplY3QgY2FuIGNvbnRhaW4gYHRyaWdnZXI6IHRydWVgIGlmIHlvdSB3aXNoIHRvIGhhdmUgdGhlCiAgICAvLyByb3V0ZSBjYWxsYmFjayBiZSBmaXJlZCAobm90IHVzdWFsbHkgZGVzaXJhYmxlKSwgb3IgYHJlcGxhY2U6IHRydWVgLCBpZgogICAgLy8geW91IHdpc2ggdG8gbW9kaWZ5IHRoZSBjdXJyZW50IFVSTCB3aXRob3V0IGFkZGluZyBhbiBlbnRyeSB0byB0aGUgaGlzdG9yeS4KICAgIG5hdmlnYXRlOiBmdW5jdGlvbihmcmFnbWVudCwgb3B0aW9ucykgewogICAgICBpZiAoIUhpc3Rvcnkuc3RhcnRlZCkgcmV0dXJuIGZhbHNlOwogICAgICBpZiAoIW9wdGlvbnMgfHwgb3B0aW9ucyA9PT0gdHJ1ZSkgb3B0aW9ucyA9IHt0cmlnZ2VyOiAhIW9wdGlvbnN9OwoKICAgICAgdmFyIHVybCA9IHRoaXMucm9vdCArIChmcmFnbWVudCA9IHRoaXMuZ2V0RnJhZ21lbnQoZnJhZ21lbnQgfHwgJycpKTsKCiAgICAgIC8vIFN0cmlwIHRoZSBoYXNoIGZvciBtYXRjaGluZy4KICAgICAgZnJhZ21lbnQgPSBmcmFnbWVudC5yZXBsYWNlKHBhdGhTdHJpcHBlciwgJycpOwoKICAgICAgaWYgKHRoaXMuZnJhZ21lbnQgPT09IGZyYWdtZW50KSByZXR1cm47CiAgICAgIHRoaXMuZnJhZ21lbnQgPSBmcmFnbWVudDsKCiAgICAgIC8vIERvbid0IGluY2x1ZGUgYSB0cmFpbGluZyBzbGFzaCBvbiB0aGUgcm9vdC4KICAgICAgaWYgKGZyYWdtZW50ID09PSAnJyAmJiB1cmwgIT09ICcvJykgdXJsID0gdXJsLnNsaWNlKDAsIC0xKTsKCiAgICAgIC8vIElmIHB1c2hTdGF0ZSBpcyBhdmFpbGFibGUsIHdlIHVzZSBpdCB0byBzZXQgdGhlIGZyYWdtZW50IGFzIGEgcmVhbCBVUkwuCiAgICAgIGlmICh0aGlzLl9oYXNQdXNoU3RhdGUpIHsKICAgICAgICB0aGlzLmhpc3Rvcnlbb3B0aW9ucy5yZXBsYWNlID8gJ3JlcGxhY2VTdGF0ZScgOiAncHVzaFN0YXRlJ10oe30sIGRvY3VtZW50LnRpdGxlLCB1cmwpOwoKICAgICAgLy8gSWYgaGFzaCBjaGFuZ2VzIGhhdmVuJ3QgYmVlbiBleHBsaWNpdGx5IGRpc2FibGVkLCB1cGRhdGUgdGhlIGhhc2gKICAgICAgLy8gZnJhZ21lbnQgdG8gc3RvcmUgaGlzdG9yeS4KICAgICAgfSBlbHNlIGlmICh0aGlzLl93YW50c0hhc2hDaGFuZ2UpIHsKICAgICAgICB0aGlzLl91cGRhdGVIYXNoKHRoaXMubG9jYXRpb24sIGZyYWdtZW50LCBvcHRpb25zLnJlcGxhY2UpOwogICAgICAgIGlmICh0aGlzLmlmcmFtZSAmJiAoZnJhZ21lbnQgIT09IHRoaXMuZ2V0RnJhZ21lbnQodGhpcy5nZXRIYXNoKHRoaXMuaWZyYW1lKSkpKSB7CiAgICAgICAgICAvLyBPcGVuaW5nIGFuZCBjbG9zaW5nIHRoZSBpZnJhbWUgdHJpY2tzIElFNyBhbmQgZWFybGllciB0byBwdXNoIGEKICAgICAgICAgIC8vIGhpc3RvcnkgZW50cnkgb24gaGFzaC10YWcgY2hhbmdlLiAgV2hlbiByZXBsYWNlIGlzIHRydWUsIHdlIGRvbid0CiAgICAgICAgICAvLyB3YW50IHRoaXMuCiAgICAgICAgICBpZighb3B0aW9ucy5yZXBsYWNlKSB0aGlzLmlmcmFtZS5kb2N1bWVudC5vcGVuKCkuY2xvc2UoKTsKICAgICAgICAgIHRoaXMuX3VwZGF0ZUhhc2godGhpcy5pZnJhbWUubG9jYXRpb24sIGZyYWdtZW50LCBvcHRpb25zLnJlcGxhY2UpOwogICAgICAgIH0KCiAgICAgIC8vIElmIHlvdSd2ZSB0b2xkIHVzIHRoYXQgeW91IGV4cGxpY2l0bHkgZG9uJ3Qgd2FudCBmYWxsYmFjayBoYXNoY2hhbmdlLQogICAgICAvLyBiYXNlZCBoaXN0b3J5LCB0aGVuIGBuYXZpZ2F0ZWAgYmVjb21lcyBhIHBhZ2UgcmVmcmVzaC4KICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gdGhpcy5sb2NhdGlvbi5hc3NpZ24odXJsKTsKICAgICAgfQogICAgICBpZiAob3B0aW9ucy50cmlnZ2VyKSByZXR1cm4gdGhpcy5sb2FkVXJsKGZyYWdtZW50KTsKICAgIH0sCgogICAgLy8gVXBkYXRlIHRoZSBoYXNoIGxvY2F0aW9uLCBlaXRoZXIgcmVwbGFjaW5nIHRoZSBjdXJyZW50IGVudHJ5LCBvciBhZGRpbmcKICAgIC8vIGEgbmV3IG9uZSB0byB0aGUgYnJvd3NlciBoaXN0b3J5LgogICAgX3VwZGF0ZUhhc2g6IGZ1bmN0aW9uKGxvY2F0aW9uLCBmcmFnbWVudCwgcmVwbGFjZSkgewogICAgICBpZiAocmVwbGFjZSkgewogICAgICAgIHZhciBocmVmID0gbG9jYXRpb24uaHJlZi5yZXBsYWNlKC8oamF2YXNjcmlwdDp8IykuKiQvLCAnJyk7CiAgICAgICAgbG9jYXRpb24ucmVwbGFjZShocmVmICsgJyMnICsgZnJhZ21lbnQpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFNvbWUgYnJvd3NlcnMgcmVxdWlyZSB0aGF0IGBoYXNoYCBjb250YWlucyBhIGxlYWRpbmcgIy4KICAgICAgICBsb2NhdGlvbi5oYXNoID0gJyMnICsgZnJhZ21lbnQ7CiAgICAgIH0KICAgIH0KCiAgfSk7CgogIC8vIENyZWF0ZSB0aGUgZGVmYXVsdCBCYWNrYm9uZS5oaXN0b3J5LgogIEJhY2tib25lLmhpc3RvcnkgPSBuZXcgSGlzdG9yeTsKCiAgLy8gSGVscGVycwogIC8vIC0tLS0tLS0KCiAgLy8gSGVscGVyIGZ1bmN0aW9uIHRvIGNvcnJlY3RseSBzZXQgdXAgdGhlIHByb3RvdHlwZSBjaGFpbiwgZm9yIHN1YmNsYXNzZXMuCiAgLy8gU2ltaWxhciB0byBgZ29vZy5pbmhlcml0c2AsIGJ1dCB1c2VzIGEgaGFzaCBvZiBwcm90b3R5cGUgcHJvcGVydGllcyBhbmQKICAvLyBjbGFzcyBwcm9wZXJ0aWVzIHRvIGJlIGV4dGVuZGVkLgogIHZhciBleHRlbmQgPSBmdW5jdGlvbihwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgewogICAgdmFyIHBhcmVudCA9IHRoaXM7CiAgICB2YXIgY2hpbGQ7CgogICAgLy8gVGhlIGNvbnN0cnVjdG9yIGZ1bmN0aW9uIGZvciB0aGUgbmV3IHN1YmNsYXNzIGlzIGVpdGhlciBkZWZpbmVkIGJ5IHlvdQogICAgLy8gKHRoZSAiY29uc3RydWN0b3IiIHByb3BlcnR5IGluIHlvdXIgYGV4dGVuZGAgZGVmaW5pdGlvbiksIG9yIGRlZmF1bHRlZAogICAgLy8gYnkgdXMgdG8gc2ltcGx5IGNhbGwgdGhlIHBhcmVudCdzIGNvbnN0cnVjdG9yLgogICAgaWYgKHByb3RvUHJvcHMgJiYgXy5oYXMocHJvdG9Qcm9wcywgJ2NvbnN0cnVjdG9yJykpIHsKICAgICAgY2hpbGQgPSBwcm90b1Byb3BzLmNvbnN0cnVjdG9yOwogICAgfSBlbHNlIHsKICAgICAgY2hpbGQgPSBmdW5jdGlvbigpeyByZXR1cm4gcGFyZW50LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IH07CiAgICB9CgogICAgLy8gQWRkIHN0YXRpYyBwcm9wZXJ0aWVzIHRvIHRoZSBjb25zdHJ1Y3RvciBmdW5jdGlvbiwgaWYgc3VwcGxpZWQuCiAgICBfLmV4dGVuZChjaGlsZCwgcGFyZW50LCBzdGF0aWNQcm9wcyk7CgogICAgLy8gU2V0IHRoZSBwcm90b3R5cGUgY2hhaW4gdG8gaW5oZXJpdCBmcm9tIGBwYXJlbnRgLCB3aXRob3V0IGNhbGxpbmcKICAgIC8vIGBwYXJlbnRgJ3MgY29uc3RydWN0b3IgZnVuY3Rpb24uCiAgICB2YXIgU3Vycm9nYXRlID0gZnVuY3Rpb24oKXsgdGhpcy5jb25zdHJ1Y3RvciA9IGNoaWxkOyB9OwogICAgU3Vycm9nYXRlLnByb3RvdHlwZSA9IHBhcmVudC5wcm90b3R5cGU7CiAgICBjaGlsZC5wcm90b3R5cGUgPSBuZXcgU3Vycm9nYXRlOwoKICAgIC8vIEFkZCBwcm90b3R5cGUgcHJvcGVydGllcyAoaW5zdGFuY2UgcHJvcGVydGllcykgdG8gdGhlIHN1YmNsYXNzLAogICAgLy8gaWYgc3VwcGxpZWQuCiAgICBpZiAocHJvdG9Qcm9wcykgXy5leHRlbmQoY2hpbGQucHJvdG90eXBlLCBwcm90b1Byb3BzKTsKCiAgICAvLyBTZXQgYSBjb252ZW5pZW5jZSBwcm9wZXJ0eSBpbiBjYXNlIHRoZSBwYXJlbnQncyBwcm90b3R5cGUgaXMgbmVlZGVkCiAgICAvLyBsYXRlci4KICAgIGNoaWxkLl9fc3VwZXJfXyA9IHBhcmVudC5wcm90b3R5cGU7CgogICAgcmV0dXJuIGNoaWxkOwogIH07CgogIC8vIFNldCB1cCBpbmhlcml0YW5jZSBmb3IgdGhlIG1vZGVsLCBjb2xsZWN0aW9uLCByb3V0ZXIsIHZpZXcgYW5kIGhpc3RvcnkuCiAgTW9kZWwuZXh0ZW5kID0gQ29sbGVjdGlvbi5leHRlbmQgPSBSb3V0ZXIuZXh0ZW5kID0gVmlldy5leHRlbmQgPSBIaXN0b3J5LmV4dGVuZCA9IGV4dGVuZDsKCiAgLy8gVGhyb3cgYW4gZXJyb3Igd2hlbiBhIFVSTCBpcyBuZWVkZWQsIGFuZCBub25lIGlzIHN1cHBsaWVkLgogIHZhciB1cmxFcnJvciA9IGZ1bmN0aW9uKCkgewogICAgdGhyb3cgbmV3IEVycm9yKCdBICJ1cmwiIHByb3BlcnR5IG9yIGZ1bmN0aW9uIG11c3QgYmUgc3BlY2lmaWVkJyk7CiAgfTsKCiAgLy8gV3JhcCBhbiBvcHRpb25hbCBlcnJvciBjYWxsYmFjayB3aXRoIGEgZmFsbGJhY2sgZXJyb3IgZXZlbnQuCiAgdmFyIHdyYXBFcnJvciA9IGZ1bmN0aW9uKG1vZGVsLCBvcHRpb25zKSB7CiAgICB2YXIgZXJyb3IgPSBvcHRpb25zLmVycm9yOwogICAgb3B0aW9ucy5lcnJvciA9IGZ1bmN0aW9uKHJlc3ApIHsKICAgICAgaWYgKGVycm9yKSBlcnJvcihtb2RlbCwgcmVzcCwgb3B0aW9ucyk7CiAgICAgIG1vZGVsLnRyaWdnZXIoJ2Vycm9yJywgbW9kZWwsIHJlc3AsIG9wdGlvbnMpOwogICAgfTsKICB9OwoKICByZXR1cm4gQmFja2JvbmU7Cgp9KSk7CgovKgogKiBhbiBleHBlcmltZW50YWwgbXNtcyBzcGVjdHJ1bQogKi8KCmRlZmluZSgnZmlzaHRvbmVzL21vZGVscy93ZXQvRXhwTVNNU1NwZWN0cnVtJyxbJ2pxdWVyeScsICd1bmRlcnNjb3JlJywgJ0JhY2tib25lJywgJ0NvbmZpZyddLCBmdW5jdGlvbigkLCBfLCBCYWNrYm9uZSwgY29uZmlnKSB7CiAgICB2YXIgRXhwTVNNU1NwZWN0cnVtID0gQmFja2JvbmUuTW9kZWwuZXh0ZW5kKHsKICAgICAgICBkZWZhdWx0cyA6IHsKICAgICAgICB9LAogICAgICAgIHVybFJvb3QgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIGNvbmZpZy5nZXQoJ3dldC51cmwucmVzdCcpICsgJy9tc21zc3BlY3RydW0nCiAgICAgICAgfSwKICAgICAgICBpbml0aWFsaXplIDogZnVuY3Rpb24oKSB7CiAgICAgICAgfSwKICAgICAgICBzaXplIDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgcmV0dXJuIChzZWxmLmdldCgnbW96cycpID09IHVuZGVmaW5lZCkgPyAwIDogc2VsZi5nZXQoJ21venMnKS5sZW5ndGg7CiAgICAgICAgfSwKICAgICAgICBmZXRjaCA6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICBvcHRpb25zID0gJC5leHRlbmQoe30sIG9wdGlvbnMpOwogICAgICAgICAgICB2YXIgdXJsID0gc2VsZi51cmxSb290KCkgKyAnLycgKyBzZWxmLmlkOwogICAgICAgICAgICBpZiAob3B0aW9ucy5wYXJhbXMgJiYgb3B0aW9ucy5wYXJhbXMuZmllbGRzID09PSAncHJlY3Vyc29yT25seScpIHsKICAgICAgICAgICAgICAgIHVybCArPSAnP2ZpZWxkcz1wcmVjdXJzb3JPbmx5JzsKICAgICAgICAgICAgfQogICAgICAgICAgICAkLmdldEpTT04odXJsLCB7fSwgZnVuY3Rpb24obSkgewogICAgICAgICAgICAgICAgZm9yIChrIGluIG0pIHsKICAgICAgICAgICAgICAgICAgICBzZWxmLnNldChrLCBtW2tdKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuc3VjY2VzcykgewogICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuc3VjY2VzcyhzZWxmKQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgdmFyIG0gPSAnJzsKICAgICAgICAgICAgICAgIGZvciAoaSBpbiBlKSB7CiAgICAgICAgICAgICAgICAgICAgbSArPSBpICsgJzogJyArIGVbaV0gKyAnICAnCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aHJvdyB7CiAgICAgICAgICAgICAgICAgICAgbmFtZSA6ICdGZXRjaGluZ1hIUkV4Y2VwdGlvbicsCiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZSA6IG0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICB9LAogICAgICAgIG1venMgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0KCJtb3pzIik7CiAgICAgICAgfSwKICAgICAgICAvKioKICAgICAgICAgKiByZXR1cm4gYSBuZXcgRXhwZSBzdGVjdHJ1bSwgd2l0aCBhbGwgZnJhZ21lbnQgcGVha3Mgc2hpZnRlZCBieSBhIGdpdmVuIHZhbHVlCiAgICAgICAgICovCiAgICAgICAgc2hpZnRCeU1veiA6IGZ1bmN0aW9uKGRlbHRhKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIHNwID0gc2VsZi5jbG9uZSgpOwogICAgICAgICAgICBzcC5zZXQoJ21venMnLCBzZWxmLmdldCgnbW96cycpLm1hcChmdW5jdGlvbihtKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbSArIGRlbHRhCiAgICAgICAgICAgIH0pKQogICAgICAgICAgICByZXR1cm4gc3A7CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogYWRkIGFsbCBmcmFnbWVudCBmcm9tIHNwZWN0cnVtIHNwIHRvIHRoZSBjdXJyZW50IG9uZSBhbmQgY3JlYXRlIGEgbmV3IG9uZQogICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvdGhlcgogICAgICAgICAqLwogICAgICAgIGNvbmNhdEZyYWdtZW50cyA6IGZ1bmN0aW9uKG90aGVyKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIHNwID0gc2VsZi5jbG9uZSgpOwoKICAgICAgICAgICAgdmFyIGNvbmNhdFBlYWtzID0gXy56aXAoc2VsZi5nZXQoJ21venMnKS5jb25jYXQob3RoZXIuZ2V0KCdtb3pzJykpLCBzZWxmLmdldCgnaW50ZW5zaXRpZXMnKS5jb25jYXQob3RoZXIuZ2V0KCdpbnRlbnNpdGllcycpKSwgc2VsZi5nZXQoJ2ludGVuc2l0eVJhbmtzJykuY29uY2F0KG90aGVyLmdldCgnaW50ZW5zaXR5UmFua3MnKSkpLnNvcnQoZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgcmV0dXJuIGFbMF0gLSBiWzBdCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgc3Auc2V0KCdtb3pzJywgXy5wbHVjayhjb25jYXRQZWFrcywgMCkpCiAgICAgICAgICAgIHNwLnNldCgnaW50ZW5zaXRpZXMnLCBfLnBsdWNrKGNvbmNhdFBlYWtzLCAxKSkKICAgICAgICAgICAgc3Auc2V0KCdpbnRlbnNpdHlSYW5rcycsIF8ucGx1Y2soY29uY2F0UGVha3MsIDIpKQoKICAgICAgICAgICAgcmV0dXJuIHNwOwogICAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIEV4cE1TTVNTcGVjdHJ1bTsKfSk7CgovKgogKiBqdXN0IGEgY29sbGVjdGlvbiBvZiBFeHBNU01TU3BlY3RydW0gCiAqIAogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KCgpkZWZpbmUoJ2Zpc2h0b25lcy9jb2xsZWN0aW9ucy93ZXQvRXhwTVNNU1NwZWN0cnVtQ29sbGVjdGlvbicsWydCYWNrYm9uZScsICdmaXNodG9uZXMvbW9kZWxzL3dldC9FeHBNU01TU3BlY3RydW0nLCBdLCBmdW5jdGlvbihCYWNrYm9uZSwgRXhwTVNNU1NwZWN0cnVtKSB7CiAgICB2YXIgRXhwTVNNU1NwZWN0cnVtQ29sbGVjdGlvbiA9IEJhY2tib25lLkNvbGxlY3Rpb24uZXh0ZW5kKHsKICAgICAgICBtb2RlbCA6IEV4cE1TTVNTcGVjdHJ1bSwKICAgICAgICBkZWZhdWx0cyA6IHsKICAgICAgICB9LAogICAgICAgIGluaXRpYWxpemUgOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICB9CiAgICB9KTsKICAgIHJldHVybiBFeHBNU01TU3BlY3RydW1Db2xsZWN0aW9uOwp9KTsKCi8qCiAqIGFuIG1zbXNydW4gY2FuIGJlIG9uZSBvYmplY3QsIHdpdGhlIG1vcmUgb3IgbGVzcyBpbmZvcm1hdGlvbi4gdGhpcyBpbmZvcm1hdGlvbiBjYW4gYmUgcG9wdWxhdGVkIGF0IG9uY2Ugd2l0aCB0aGUgbXNtc3J1biBhcGkgb3IgZW5oYW5jZWQgYWZ0ZXJ3YXJkcyB0aHJvdWdoIHRoZSBtc21zc3BlY3RydW0gZ2V0dGVyczoKICogIC0ganVzdCBydW4gaW5mbyAoaWQgJiBuYW1lKQogKiAgLSBtc21zU3BlY3RyYSBkYXRhLCBidXQgb25seSBhdCB0aGUgcHJlY3Vyc29yIGxldmVsIChtc21zPXRydWUmbm9QZWFrcz10cnVlKQogKiAgLSBvbmx5IHRoZSBrIG1vc3QgaW50ZW5zZSBwZWFrcyAobXNtcz10cnVlJm1heFBlYWtzPWspCiAqIC0gIGFsbCBtc21zIGluZm8gKG1zbXM9dHJ1ZSkKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCgpkZWZpbmUoJ2Zpc2h0b25lcy9tb2RlbHMvd2V0L01TTVNSdW4nLFsnanF1ZXJ5JywgJ3VuZGVyc2NvcmUnLCAnQmFja2JvbmUnLCAnQ29uZmlnJywgJ2Zpc2h0b25lcy9jb2xsZWN0aW9ucy93ZXQvRXhwTVNNU1NwZWN0cnVtQ29sbGVjdGlvbiddLCBmdW5jdGlvbigkLCBfLCBCYWNrYm9uZSwgY29uZmlnLCBFeHBNU01TU3BlY3RydW1Db2xsZWN0aW9uKSB7CiAgICB2YXIgTVNNU1J1biA9IEJhY2tib25lLk1vZGVsLmV4dGVuZCh7CiAgICAgICAgZGVmYXVsdHMgOiB7CiAgICAgICAgfSwKICAgICAgICB1cmxSb290IDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiBjb25maWcuZ2V0KCd3ZXQudXJsLnJlc3QnKSArICcvbXNtc3J1bicKICAgICAgICB9LAogICAgICAgIGluaXRpYWxpemUgOiBmdW5jdGlvbigpIHsKICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqIGFwcGx5IHRoZSBjYWxsYmFjayBhcmd1bWVudCBvbiB0aGUgb2JqZWN0LCBidXQgb25seSBpZiBvciBvbmNlIHRoZSBtc21zIGluZm8gaGFzIGJlZW4gbG9hZGVkCiAgICAgICAgICovCiAgICAgICAgd2l0aE1zbXMgOiBmdW5jdGlvbihjYWxsYmFjaykgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIGlmIChzZWxmLmdldCgnbXNtcycpKSB7CiAgICAgICAgICAgICAgICBjYWxsYmFjayhzZWxmKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBzZWxmLnJlYWRNc21zSW5mbyh7CiAgICAgICAgICAgICAgICBzdWNjZXNzIDogY2FsbGJhY2sKICAgICAgICAgICAgfSkKICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqICBsb2FkIG1zbXMgaW5mb3JtYXRpb24sIGJ1dCBubyBwZWFrIGxpc3QKICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogICAgICAgICAqLwogICAgICAgIHJlYWRNc21zSW5mbyA6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzCiAgICAgICAgICAgIHZhciB1cmwgPSBzZWxmLnVybFJvb3QoKSArICcvJyArIHNlbGYuZ2V0KCdpZCcpICsgJz9tc21zPXRydWUmbm9QZWFrcz10cnVlJzsKCiAgICAgICAgICAgICQuZ2V0SlNPTih1cmwsIHt9LCBmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgICAgICAgICBzZWxmLnNldCgnbXNtcycsIG5ldyBFeHBNU01TU3BlY3RydW1Db2xsZWN0aW9uKGRhdGEubXNtc1NwZWN0cmEpKTsKICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLnN1Y2Nlc3MpIHsKICAgICAgICAgICAgICAgICAgICBvcHRpb25zLnN1Y2Nlc3Moc2VsZikKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgIH0sCiAgICAgICAgZ2V0TVNNU1N1YkNvbGxlY3Rpb24gOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgaWYgKG9wdGlvbnMuaWRzKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEV4cE1TTVNTcGVjdHJ1bUNvbGxlY3Rpb24oXy5jb2xsZWN0KG9wdGlvbnMuaWRzLCBmdW5jdGlvbihpZCkgewogICAgICAgICAgICAgICAgICAgIHNlbGYuZ2V0KCdtc21zJykuZ2V0KGlkKTsKICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAob3B0aW9ucy5zY2FuTnVtYmVycykgewogICAgICAgICAgICAgICAgdmFyIGtleXMgPSB7fQogICAgICAgICAgICAgICAgXy5lYWNoKG9wdGlvbnMuc2Nhbk51bWJlcnMsIGZ1bmN0aW9uKHNuKSB7CiAgICAgICAgICAgICAgICAgICAga2V5c1siIiArIHNuXSA9IHRydWU7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBFeHBNU01TU3BlY3RydW1Db2xsZWN0aW9uKHNlbGYuZ2V0KCdtc21zJykuZmlsdGVyKGZ1bmN0aW9uKHNwKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGtleXNbIiIgKyBzcC5nZXQoJ3NjYW5OdW1iZXInKV07CiAgICAgICAgICAgICAgICB9KSk7CgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ211c3QgZ2V0TVNNU1N1YkNvbGxlY3Rpb24gb24gaWRzIG9yIHNuYU51bWJlcnMgbGlzdCBvZiB2YWxzJykKCiAgICAgICAgfSwKICAgICAgICAvKioKICAgICAgICAgKiBnZXQgdGhlIE1TTVNTdWJDb2xsZWN0aW9ucywgdGhlbiBwb3B1bGF0ZSBpdCB3aXRoIHRoZSBtc21zIHBlYWtsaXN0IGFuZCBjYWxsIGEgc3VjY2VzcyBjYWxsYmFjayBpZiBhbnkKICAgICAgICAgKi8KICAgICAgICBmZXRjaE1TTVMgOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIGNvbCA9IHNlbGYuZ2V0TVNNU1N1YkNvbGxlY3Rpb24ob3B0aW9ucyk7CiAgICAgICAgICAgIHZhciBjb2xOb01TTVMgPSBjb2wuZmlsdGVyKGZ1bmN0aW9uKHNwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc3AuZ2V0KCdtb3pzJykgPT0gbnVsbDsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHZhciBuID0gY29sTm9NU01TLmxlbmd0aDsKICAgICAgICAgICAgaWYgKG4gPT0gMCAmJiBvcHRpb25zLnN1Y2Nlc3MpIHsKICAgICAgICAgICAgICAgIG9wdGlvbnMuc3VjY2Vzcyhjb2wpCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIGNwdCA9IDA7CiAgICAgICAgICAgIF8uZWFjaChjb2xOb01TTVMsIGZ1bmN0aW9uKHNwKSB7CiAgICAgICAgICAgICAgICBzcC5mZXRjaCh7CiAgICAgICAgICAgICAgICAgICAgc3VjY2VzcyA6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBjcHQrKzsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNwdCA9PSBuICYmIG9wdGlvbnMuc3VjY2VzcykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5zdWNjZXNzKGNvbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KQogICAgICAgIH0sCiAgICAgICAgLyoqCiAgICAgICAgICogYWx0aG91Z2ggdGhlIG91dGNvbWUgaXMgc2ltaWxhciwgdGhpcyBtZXRoaWQgZGlmZmVycyBmcm9tIGZldGNoTVNNUyh7c2NhbnNOdW1iZXJzOi4uLn0pIGluIHRoZSBzZW5zZSB0aGF0IHdlIGRvbid0IG5lZWQgdG8gbG9hZCB0aGUgZnVsbCBydW4gdG8gdHJhbnNsYXRlIHNjYW4gbnVtYmVyIGludG8gaWRzLi4uCiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IHNjYW5OdW1iZXIKICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogICAgICAgICAqLwogICAgICAgIGZldGNoTVNNU0Zyb21TY2FuTnVtYmVycyA6IGZ1bmN0aW9uKHNjYW5zLCBvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIHVybCA9IHNlbGYudXJsUm9vdCgpICsgJy8nICsgc2VsZi5nZXQoJ2lkJykgKyAnL21zbXNmcm9tc2NhbnMvJyArIHNjYW5zLmpvaW4oJywnKTsKICAgICAgICAgICAgCiAgICAgICAgICAgICQuZ2V0SlNPTih1cmwsIHt9LCBmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgICAgICAgICB2YXIgY29sID0gbmV3IEV4cE1TTVNTcGVjdHJ1bUNvbGxlY3Rpb24oZGF0YSk7CiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5zdWNjZXNzKSB7CiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5zdWNjZXNzKHNlbGYsIGNvbCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gTVNNU1J1bjsKfSk7CgovKioKICogYmFzaWMgbWF0aCB1dGlsaXRpZXMKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCgpkZWZpbmUoJ2Zpc2h0b25lcy91dGlscy9NYXRoVXRpbHMnLFsndW5kZXJzY29yZSddLCBmdW5jdGlvbiAoXykgewogICAgdmFyIE1hdGhVdGlscyA9IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICB9CiAgICAvKioKICAgICAqIFNpbXBzb24gaW50ZWdyYXRpb24gb3ZlciB4LHkgdmFsdWVzCiAgICAgKiBAcGFyYW0geAogICAgICogQHBhcmFtIHkKICAgICAqIEByZXR1cm4ge251bWJlcn0KICAgICAqLwogICAgTWF0aFV0aWxzLnByb3RvdHlwZS5pbnRlZ3JhdGUgPSBmdW5jdGlvbiAoeCwgeSkgewogICAgICAgIHZhciBzID0gMC4wOwogICAgICAgIF8udGltZXMoeC5sZW5ndGggLSAxLCBmdW5jdGlvbiAoaSkgewogICAgICAgICAgICBzICs9IDEuMCAqICh4W2kgKyAxXSAtIHhbaV0pICogKHlbaV0gKyB5W2kgKyAxXSkKICAgICAgICB9KQogICAgICAgIHJldHVybiBzIC8gMi4wCiAgICB9CgogICAgLyoqCiAgICAgKiBsaW5lYXIgaW50ZXJwb2xhdGlvbQogICAgICogeHMgJiB5cyBhcmUgdGhlIGtub3duIG1lYXN1cmVzCiAgICAgKiB4cyBtdXN0IGJlIHNvcnRlZCBhbmQgc3RyaWNsdHkgaW5jcmVhc2luZwogICAgICoKICAgICAqIGZvciBhIGdpdmVuIHgsIHJldHVybiB0aGUgeXMnIGludGVycG9sYXRpb24gYmV0d2VlbiB0aGUgdHdvIGNsb3Nlc3Qgc3Vycm91bmRpaW5nIHhzJwogICAgICogYXNraW5nIGZvciBhbiB4IG91dHNpZGUgYm91bmRhcmllcyB3aWxsIHJldHVybiBOYU4KICAgICAqCiAgICAgKiBAcGFyYW0ge09iamVjdH0geHMKICAgICAqIEBwYXJhbSB7T2JqZWN0fSB5cwogICAgICogQHBhcmFtIHtPYmplY3R9IHgKICAgICAqLwogICAgTWF0aFV0aWxzLnByb3RvdHlwZS5pbnRlcnBvbGF0ZSA9IGZ1bmN0aW9uICh4cywgeXMsIHgpIHsKICAgICAgICB2YXIgbiA9IF8uc2l6ZSh4cykKICAgICAgICBpZiAobiA9PSAwIHx8IHggPCB4c1swXSB8fCB4ID4geHNbbiAtIDFdKSB7CiAgICAgICAgICAgIHJldHVybiBOYU47CiAgICAgICAgfQogICAgICAgIHZhciBpMSA9IDAsIGkyID0gbiAtIDE7CiAgICAgICAgd2hpbGUgKGkyIC0gaTEgPiAxKSB7CiAgICAgICAgICAgIHZhciBpbSA9IE1hdGguZmxvb3IoKGkxICsgaTIpIC8gMikKICAgICAgICAgICAgaWYgKHggPCB4c1tpbV0pIHsKICAgICAgICAgICAgICAgIGkyID0gaW0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGkxID0gaW0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gIHlzW2kxXSArICh4IC0geHNbaTFdKSAvICh4c1tpMl0gLSB4c1tpMV0pICogKHlzW2kyXSAtIHlzW2kxXSkKCiAgICB9CgogICAgcmV0dXJuIG5ldyBNYXRoVXRpbHMoKQp9KTsKCi8qCiAqIEdldCB0aGUgaW5zdHJ1bWVudCBwYXJhbWV0ZXJzLgogKiBNYWlubHk6CiAqIC0gcHJlY3Vyc29yVG9sCiAqIC0gZnJhZ21lbnRUb2wKICogVG9sZXJhbmNlIGFyZSBleHByZXNzZWQgaW4gcHBtCiAqCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwoKZGVmaW5lKCdmaXNodG9uZXMvbW9kZWxzL3dldC9JbnN0cnVtZW50UGFyYW1zJyxbCiAgICAnQmFja2JvbmUnLAogICAgJ0NvbmZpZycKXSwgZnVuY3Rpb24gKEJhY2tib25lLCBjb25maWcpIHsKICAgIHZhciBJbnN0cnVtZW50UGFyYW1zID0gQmFja2JvbmUuTW9kZWwuZXh0ZW5kKHsKICAgICAgICBkZWZhdWx0czogewogICAgICAgICAgICBmcmFnbWVudFRvbDogdW5kZWZpbmVkLAogICAgICAgICAgICBwcmVjdXJzb3JUb2w6IHVuZGVmaW5lZCwKICAgICAgICB9LAogICAgICAgIHVybDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gY29uZmlnLmdldCgnd2V0LnVybC5yZXN0JykgKyAnL2luc3RydW1lbnRwYXJhbXMvJyArIHRoaXMuZ2V0KCdpZCcpCiAgICAgICAgfSwKICAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICB9LAogICAgICAgIHRvU3RyaW5nOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgcmV0dXJuICd0b2w6JyArIHNlbGYuZ2V0KCdwcmVjdXJzb3JUb2wnKSArICcvJyArIHNlbGYuZ2V0KCdmcmFnbWVudFRvbCcpOwogICAgICAgIH0sCiAgICAgICAgdG9Kc29uOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIHByZWN1cnNvclRvbDogc2VsZi5nZXQoJ3ByZWN1cnNvclRvbCcpLAogICAgICAgICAgICAgICAgZnJhZ21lbnRUb2w6IHNlbGYuZ2V0KCdmcmFnbWVudFRvbCcpCiAgICAgICAgICAgIH0KICAgICAgICB9LAoKICAgIH0pOwogICAgcmV0dXJuIEluc3RydW1lbnRQYXJhbXM7Cn0pOwoKLyoKICogQ3Jvc3MgSW9uIENocm9tYXRvZ3JhbS4KICogQ29udGFpbnMgbWFpbmx5IHR3byBhcnJheXMgb2YgZmxvYXQ6CiAqIC0gcmV0ZW50aW9uVGltZXMKICogLSBpbnRlbnNpdGllcwogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KCmRlZmluZSgnZmlzaHRvbmVzL21vZGVscy93ZXQvWElDJyxbJ0JhY2tib25lJywgJ0NvbmZpZyddLCBmdW5jdGlvbihCYWNrYm9uZSwgY29uZmlnKSB7CiAgICB2YXIgWElDID0gQmFja2JvbmUuTW9kZWwuZXh0ZW5kKHsKICAgICAgICBkZWZhdWx0cyA6IHsKICAgICAgICB9LAogICAgICAgIGluaXRpYWxpemUgOiBmdW5jdGlvbigpIHsKICAgICAgICB9LAogICAgICAgIHNpemUgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0KCdyZXRlbnRpb25UaW1lcycpLmxlbmd0aAogICAgICAgIH0sCgogICAgICAgIHRvSlNPTiA6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHZhciBqc29uID0gWElDLl9fc3VwZXJfXy50b0pTT04uY2FsbChzZWxmKTsKCiAgICAgICAgICAgIGlmKGpzb24ucmljaFNlcXVlbmNlKXsKICAgICAgICAgICAgICAgIGpzb24ucmljaFNlcXVlbmNlID0ganNvbi5yaWNoU2VxdWVuY2UudG9TdHJpbmcoKTsgCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vanNvbmlmeSBtZW1lYmVycyAobXNtcywgcmljaFNlcXVlbmNlIGFuZCBjbykKICAgICAgICAgICAgdmFyIGtzID0gXy5rZXlzKGpzb24pCiAgICAgICAgICAgIF8uZWFjaChrcywgZnVuY3Rpb24oayl7CiAgICAgICAgICAgICAgICBpZighICgoanNvbltrXSBpbnN0YW5jZW9mIEJhY2tib25lLk1vZGVsKSB8fCAoanNvbltrXSBpbnN0YW5jZW9mIEJhY2tib25lLkNvbGxlY3Rpb24pKSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBqc29uW2tdID0ganNvbltrXS50b0pTT04oKQogICAgICAgICAgICB9KQogICAgICAgICAgICByZXR1cm4ganNvbgogICAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIFhJQzsKfSk7CgovKgogKiBhbiBJbmplY3Rpb24gaGFuZGxlcyBvbmUgZXhwZXJpbWVudGFsIHJ1biAoTVNSdW4pLCB0b2xlcmFuY2VzICwgbmFtZSBldGMuCiAqIEl0IGlzIHR5cGljYWxseSBmZWN0aGVkIGZyb20gYSBzZXJ2ZXIuCiAqIFByb3BlcnRpZXMKICogKiBhIG5hbWUKICogKiBhbiBNU01TUnVuCiAqICogYW4gSW5zdHJ1bWVudFBhcmFtcwogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KCmRlZmluZSgnZmlzaHRvbmVzL21vZGVscy93ZXQvSW5qZWN0aW9uJyxbJ2pxdWVyeScsICd1bmRlcnNjb3JlJywgJ0JhY2tib25lJywgJ0NvbmZpZycsICdmaXNodG9uZXMvdXRpbHMvTWF0aFV0aWxzJywgJy4vSW5zdHJ1bWVudFBhcmFtcycsICcuL1hJQycsICdmaXNodG9uZXMvY29sbGVjdGlvbnMvd2V0L0V4cE1TTVNTcGVjdHJ1bUNvbGxlY3Rpb24nLCAnZmlzaHRvbmVzL21vZGVscy93ZXQvTVNNU1J1biddLCBmdW5jdGlvbiAoJCwgXywgQmFja2JvbmUsIGNvbmZpZywgbWF0aFV0aWxzLCBJbnN0cnVtZW50UGFyYW1zLCBYSUMsIEV4cE1TTVNTcGVjdHJ1bUNvbGxlY3Rpb24sIE1TTVNSdW4pIHsKICAgIHZhciBJbmplY3Rpb24gPSBCYWNrYm9uZS5Nb2RlbC5leHRlbmQoewogICAgICAgICAgICBkZWZhdWx0czogewogICAgICAgICAgICB9LAogICAgICAgICAgICB1cmxSb290OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gY29uZmlnLmdldCgnd2V0LnVybC5yZXN0JykgKyAnL2luamVjdGlvbic7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHVybHM6IHsKICAgICAgICAgICAgICAgIGNocm9tYXRvWGljOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpZy5nZXQoJ3dldC51cmwucmVzdCcpICsgJy9jaHJvbWF0by94aWMnCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiB0aGUgc2V0IG1ldGhvZCBuZWVkcyB0byBiZSBzbGlnaGx0eSBvdmVycmlkZW4sIGJlYWNhdXNlCiAgICAgICAgICAgICAqIC0gYW4gaW5zdHJ1bWVudFBhcmFtcyBhdHRyIHNob3VsZCBiZSBjYXN0IGludG8gYW4gYWN0dWFsIEluc3RydW1lbnRQYXJhbXMKICAgICAgICAgICAgICogLSBhbiBydW5JbmZvIGF0dHIgc2hhbGwgYmUgY2FzdGVkIGludG8gYW4gTVNNU1J1biwgZXZlbmUgaWYgaXQgZG9lcyBub3QgY29udGFpbiBtdWNoCiAgICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBhdHRycwogICAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogICAgICAgICAgICAgKi8KICAgICAgICAgICAgc2V0OiBmdW5jdGlvbiAoYXR0cnMsIG9wdGlvbnMpIHsKICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgICAgIC8vbG92ZSB0aGF0LiBhcmd1bWVudCBjYW4gZWl0aGVyIGJlIGEgbWFwIGFuZCBhbiBvYmplY3Qgb3IgYSBrZXkgYW5kIGEgdmFsdWUKICAgICAgICAgICAgICAgIGlmIChfLmlzU3RyaW5nKGF0dHJzKSkgewogICAgICAgICAgICAgICAgICAgIHZhciBrID0gYXR0cnM7CiAgICAgICAgICAgICAgICAgICAgYXR0cnMgPSB7fTsKICAgICAgICAgICAgICAgICAgICBhdHRyc1trXSA9IG9wdGlvbnM7CiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy9tb2RpZnkgZXhpc3RpbmcgaW5zdHJ1bW1lbnQgcGFyYW1zCiAgICAgICAgICAgICAgICBpZiAoYXR0cnMuaW5zdHJ1bWVudFBhcmFtcyAmJiAoIShhdHRycy5pbnN0cnVtZW50UGFyYW1zIGluc3RhbmNlb2YgSW5zdHJ1bWVudFBhcmFtcykpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGYuZ2V0KCdpbnN0cnVtZW50UGFyYW1zJykgaW5zdGFuY2VvZiBJbnN0cnVtZW50UGFyYW1zKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZ2V0KCdpbnN0cnVtZW50UGFyYW1zJykuc2V0KGF0dHJzLmluc3RydW1lbnRQYXJhbXMpOwogICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgYXR0cnMuaW5zdHJ1bWVudFBhcmFtcwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJzLmluc3RydW1lbnRQYXJhbXMgPSBuZXcgSW5zdHJ1bWVudFBhcmFtcyhhdHRycy5pbnN0cnVtZW50UGFyYW1zKTsKICAgICAgICAgICAgICAgICAgICAgICAgLy9jaGFuZ2luZyBhbiBlbWJlZGRlZCBpbnN0cnVtZW50IHBhcmFtcyBidWJibGUgdGhlIGV2ZW50Li4uCiAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJzLmluc3RydW1lbnRQYXJhbXMub24oJ2NoYW5nZScsIGZ1bmN0aW9uICh0YXJnZXQsIGN0eCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi50cmlnZ2VyKCdjaGFuZ2VJbnN0cnVtZW50UGFyYW1zJywgY3R4LmNoYW5nZXMpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGF0dHJzLnJ1bkluZm8pIHsKICAgICAgICAgICAgICAgICAgICBhdHRycy5ydW4gPSBuZXcgTVNNU1J1bihhdHRycy5ydW5JbmZvKQogICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBhdHRycy5ydW5JbmZvCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gQmFja2JvbmUuTW9kZWwucHJvdG90eXBlLnNldC5jYWxsKHNlbGYsIGF0dHJzLCBvcHRpb25zKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIGFzayBmb3IgYSBYSUMsIGVucmljaGVkIHdpdGggTVNNUyBmb3IgYSBnaXZlbiBtYXNzIGFuZCBjYWxsYmFjayBvbiBzdWNjZXNzCiAgICAgICAgICAgICAqIEFzIHRoZSBpbmplY3Rpb24ga25vdyB0aGUgcHJlY3Vyc29yIHRvbGVyYW5jZSAodmlhIHRoZSBpbnN0cnVtZW50UGFyYW1zKSwgbWFzcyBpcyBlbm91Z2ggdG8gZ2V0IHRoZSBYSUMuCiAgICAgICAgICAgICAqIEBwYXJhbSBtYXNzCiAgICAgICAgICAgICAqIEBwYXJhbSBvcHRpb25zCiAgICAgICAgICAgICAqIEBwYXJhbSBjYWxsYmFjayBhIGZ1bmN0aW9uIGNhbGxlZCB3aXRoIHRoZSByZXR1cm4geGljLiB0aGUgY2FsbCBiYWNrIGNhbiBhbHNvIGJlIHNwZWNpZmllZCB0aHJvdWdoIHRoZSBzdWNjZXNzIG9wdGlvbnMKICAgICAgICAgICAgICovCiAgICAgICAgICAgIGNocm9tYXRvWGljOiBmdW5jdGlvbiAobWFzcywgb3B0aW9ucywgY2FsbGJhY2spIHsKICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgMyAmJiBvcHRpb25zICE9IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLnN1Y2Nlc3MgIT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrID0gb3B0aW9ucy5zdWNjZXNzOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrID0gb3B0aW9uczsKICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB2YXIgYnVpbGRNc01zUG9pbnRlcnMgPSBmdW5jdGlvbiAoeGljUlQsIHhpY0ludGVucywgbXNtc1NwZWN0cmEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gXy5tYXAobXNtc1NwZWN0cmEsIGZ1bmN0aW9uIChzcCkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgcnQgPSBzcC5yZXRlbnRpb25UaW1lOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW50ZW5zID0gbWF0aFV0aWxzLmludGVycG9sYXRlKHhpY1JULCB4aWNJbnRlbnMsIHJ0KQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3BlY3RydW06IHNwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0ZW50aW9uVGltZTogcnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnRlbnNpdHk6IGludGVucwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHZhciB1cmwgPSBzZWxmLnVybHMuY2hyb21hdG9YaWMoKSArICcvJyArIHNlbGYuZ2V0KCdpZCcpICsgJz9tPScgKyBtYXNzICsgJyZtc21zPXRydWUnOwogICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuY2hhcmdlKSB7CiAgICAgICAgICAgICAgICAgICAgdXJsICs9ICcmej0nICsgb3B0aW9ucy5jaGFyZ2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB1cmwgKz0gJyZwcmVjVG9sPScgKyBzZWxmLmdldCgnaW5zdHJ1bWVudFBhcmFtcycpLmdldCgncHJlY3Vyc29yVG9sJyk7CiAgICAgICAgICAgICAgICAkLmdldEpTT04odXJsLCB7fSwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgeGljID0gbmV3IFhJQygkLmV4dGVuZCh7CiAgICAgICAgICAgICAgICAgICAgICAgIG1hc3M6IG1hc3MKICAgICAgICAgICAgICAgICAgICB9LCBvcHRpb25zKSkKICAgICAgICAgICAgICAgICAgICB4aWMuc2V0KCdpZCcsIHNlbGYuZ2V0KCdpZCcpICsgJ18nICsgbWFzcykKCiAgICAgICAgICAgICAgICAgICAgLy9iYWNrd2FyZHMgY29tcGF0aWJpbGl0eQogICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLmV4cFNwZWN0cmEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBvaW50ZXJzID0gYnVpbGRNc01zUG9pbnRlcnMoZGF0YS5yZXRlbnRpb25UaW1lcywgZGF0YS5pbnRlbnNpdGllcywgZGF0YS5leHBTcGVjdHJhKQogICAgICAgICAgICAgICAgICAgICAgICB4aWMuc2V0KCdtc21zJywgbmV3IEV4cE1TTVNTcGVjdHJ1bUNvbGxlY3Rpb24oXy5wbHVjayhwb2ludGVycywgJ3NwZWN0cnVtJykpKTsKICAgICAgICAgICAgICAgICAgICAgICAgeGljLnNldCgnbXNtc1BvaW50ZXJzJywgcG9pbnRlcnMpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtc21zID0gbmV3IEV4cE1TTVNTcGVjdHJ1bUNvbGxlY3Rpb24oZGF0YS5tc21zLmV4cFNwZWN0cmEpOwogICAgICAgICAgICAgICAgICAgICAgICB4aWMuc2V0KCdtc21zJywgbXNtcyk7CgogICAgICAgICAgICAgICAgICAgICAgICB4aWMuc2V0KCdtc21zUG9pbnRlcnMnLCBfLmNvbGxlY3QoXy56aXAoZGF0YS5tc21zLnNwZWN0cmFJZHMsIGRhdGEubXNtcy5yZXRlbnRpb25UaW1lcywgZGF0YS5tc21zLmludGVuc2l0aWVzKSwgZnVuY3Rpb24gKGEsIGkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzcCA9IG1zbXMuZ2V0KGFbMF0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcGVjdHJ1bTogc3AsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0ZW50aW9uVGltZTogYVsxXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnRlbnNpdHk6IGFbMl0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgeGljLnNldCgncmV0ZW50aW9uVGltZXMnLCBkYXRhLnJldGVudGlvblRpbWVzKQogICAgICAgICAgICAgICAgICAgIHhpYy5zZXQoJ2ludGVuc2l0aWVzJywgZGF0YS5pbnRlbnNpdGllcykKCiAgICAgICAgICAgICAgICAgICAgeGljLnNldCgnaW5qZWN0aW9uSW5mbycsIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHNlbGYuZ2V0KCdpZCcpLAogICAgICAgICAgICAgICAgICAgICAgICBzZWFyY2hJZDogc2VsZi5nZXQoJ3NlYXJjaElkJyksCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHNlbGYuZ2V0KCduYW1lJykKICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soeGljKQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIDsKICAgIHJldHVybiBJbmplY3Rpb247Cn0pCjsKCi8qCiAqIGp1c3QgYSBjb2xsZWN0aW9uIG9mIEluamVjdGlvbgogKiAKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCgpkZWZpbmUoJ2Zpc2h0b25lcy9jb2xsZWN0aW9ucy93ZXQvSW5qZWN0aW9uQ29sbGVjdGlvbicsWydCYWNrYm9uZScsICdmaXNodG9uZXMvbW9kZWxzL3dldC9JbmplY3Rpb24nLCBdLCBmdW5jdGlvbihCYWNrYm9uZSwgSW5qZWN0aW9uKSB7CiAgICB2YXIgSW5qZWN0aW9uQ29sbGVjdGlvbiA9IEJhY2tib25lLkNvbGxlY3Rpb24uZXh0ZW5kKHsKICAgICAgICBtb2RlbCA6IEluamVjdGlvbiwKICAgICAgICBkZWZhdWx0cyA6IHsKICAgICAgICB9LAogICAgICAgIGluaXRpYWxpemUgOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICB9CiAgICB9KTsKICAgIHJldHVybiBJbmplY3Rpb25Db2xsZWN0aW9uOwp9KTsKCgovKgogKiBBbiBleHBlcmltZW50IGNvbnRhaW5zIG1haW5seSBhIGxpc3Qgb2YgaW5qZWN0aW9ucyAoYWNxdWlyZWQgc2FtcGxlcykKICogUHJvcGVydGllczoKICogLSBpbmplY3Rpb246IGFycmF5IG9mIEluamVjdGlvbgogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KCmRlZmluZSgnZmlzaHRvbmVzL21vZGVscy93ZXQvRXhwZXJpbWVudCcsWydqcXVlcnknLCAndW5kZXJzY29yZScsICdCYWNrYm9uZScsICdDb25maWcnLCAnZmlzaHRvbmVzL21vZGVscy93ZXQvSW5qZWN0aW9uJywgJ2Zpc2h0b25lcy9jb2xsZWN0aW9ucy93ZXQvSW5qZWN0aW9uQ29sbGVjdGlvbiddLCBmdW5jdGlvbiAoJCwgXywgQmFja2JvbmUsIGNvbmZpZywgSW5qZWN0aW9uLCBJbmplY3Rpb25Db2xsZWN0aW9uKSB7CiAgICB2YXIgRXhwZXJpbWVudCA9IEJhY2tib25lLk1vZGVsLmV4dGVuZCh7CiAgICAgICAgZGVmYXVsdHM6IHsKICAgICAgICB9LAogICAgICAgIHVybFJvb3Q6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGNvbmZpZy5nZXQoJ3dldC51cmwucmVzdCcpICsgJy9leHBlcmltZW50JwogICAgICAgIH0sCiAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgfSwKICAgICAgICBzZXQ6IGZ1bmN0aW9uIChhdHRycywgb3B0aW9ucykgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICAgICAgICAvL2xvdmUgdGhhdC4gYXJndW1lbnQgY2FuIGVpdGhlciBiZSBhIG1hcCBhbmQgYW4gb2JqZWN0IG9yIGEga2V5IGFuZCBhIHZhbHVlCiAgICAgICAgICAgIGlmIChfLmlzU3RyaW5nKGF0dHJzKSkgewogICAgICAgICAgICAgICAgdmFyIGsgPSBhdHRyczsKICAgICAgICAgICAgICAgIGF0dHJzID0ge307CiAgICAgICAgICAgICAgICBhdHRyc1trXSA9IG9wdGlvbnM7CiAgICAgICAgICAgICAgICBvcHRpb25zID0ge307CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy9tb2RpZnkgZXhpc3RpbmcgSW5qZWN0aW9uIHBhcmFtcwogICAgICAgICAgICBpZiAoYXR0cnMuaW5qZWN0aW9ucyAmJiAoIShhdHRycy5pbmplY3Rpb25zIGluc3RhbmNlb2YgSW5qZWN0aW9uQ29sbGVjdGlvbikpKSB7CiAgICAgICAgICAgICAgICBpZiAoc2VsZi5nZXQoJ2luamVjdGlvbnMnKSBpbnN0YW5jZW9mIEluamVjdGlvbkNvbGxlY3Rpb24pIHsKICAgICAgICAgICAgICAgICAgICBzZWxmLmdldCgnaW5qZWN0aW9ucycpLnJlc2V0KCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHNlbGYuc2V0KCdpbmplY3Rpb25zJywgbmV3IEluamVjdGlvbkNvbGxlY3Rpb24oKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzZWxmLmdldCgnaW5qZWN0aW9ucycpLmFkZChfLmNvbGxlY3QoYXR0cnMuaW5qZWN0aW9ucywgZnVuY3Rpb24gKHBpbmopIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEluamVjdGlvbihwaW5qKQogICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgZGVsZXRlIGF0dHJzLmluamVjdGlvbnMKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gQmFja2JvbmUuTW9kZWwucHJvdG90eXBlLnNldC5jYWxsKHNlbGYsIGF0dHJzLCBvcHRpb25zKTsKICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqIGFkZCBhbiBpbmplY3Rpb24gdG8gdGhlIGxpc3QuCiAgICAgICAgICogQHBhcmFtIGluagogICAgICAgICAqIEBwYXJhbSBvcHRpb25zCiAgICAgICAgICogQHJldHVybiB7RXhwZXJpbWVudH0KICAgICAgICAgKi8KICAgICAgICBpbmplY3Rpb25zX2FkZDogZnVuY3Rpb24gKGluaiwgb3B0aW9ucykgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIG9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgb3B0aW9ucyk7CiAgICAgICAgICAgIHNlbGYuZ2V0KCdpbmplY3Rpb25zJykuYWRkKGluaikKICAgICAgICAgICAgaWYgKG9wdGlvbnMuc2F2ZSkgewogICAgICAgICAgICAgICAgdmFyIHVybCA9IHNlbGYudXJsUm9vdCgpICsgJy8nICsgc2VsZi5nZXQoJ2lkJykgKyAnL2luamVjdGlvbnMvJyArIGluai5nZXQoJ2lkJyk7CiAgICAgICAgICAgICAgICAkLmFqYXgodXJsLCB7CiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ1BVVCcsCiAgICAgICAgICAgICAgICAgICAgc3VjY2Vzczogb3B0aW9ucy5zdWNjZXNzCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICB9CiAgICB9KTsKICAgIHJldHVybiBFeHBlcmltZW50Owp9KTsKCi8qCiAqIGp1c3QgYSBjb2xsZWN0aW9uIG9mIFhJQywgd2l0aCBhbiBhdHRhY2hlZCBjb2xsZWN0aW9uIGxlZ2VuZCBjb250YWluZXIKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCgpkZWZpbmUoJ2Zpc2h0b25lcy9jb2xsZWN0aW9ucy93ZXQvWElDQ29sbGVjdGlvbicsWydCYWNrYm9uZScsICdmaXNodG9uZXMvbW9kZWxzL3dldC9YSUMnXSwgZnVuY3Rpb24oQmFja2JvbmUsIFhJQykgewogIHZhciBYSUNDb2xsZWN0aW9uTGVnZW5kID0gQmFja2JvbmUuTW9kZWwuZXh0ZW5kKHsKICAgIGRlZmF1bHRzIDogewoKICAgIH0sCiAgICBpbml0aWFsaXplIDogZnVuY3Rpb24oKSB7CiAgICAgIHRoaXMuX2xlZ2VuZHMgPSBbXTsKICAgIH0sCiAgICByZXNldCA6IGZ1bmN0aW9uKCkgewogICAgICB0aGlzLl9sZWdlbmRzLmxlbmd0aCA9IDA7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKICAgIC8qKgogICAgICoKICAgICAqIEBwYXJhbSB7T2JqZWN0fSBlIDp7CiAgICAgKiAgIG5hbWU6IHBlcHRpZGUgbmFtZQogICAgICogICBtYXNzZXM6IFtdIGFycmF5IG9mIG1hc3Nlcywgd2hlcmUgbWFzc2VzW2ldIGlzIHRoZSBtYXNzIGZvciBjaGFyZ2UgaQogICAgICogfQogICAgICovCiAgICBhZGQgOiBmdW5jdGlvbihlKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIF90aGlzLl9sZWdlbmRzLnB1c2goewogICAgICAgIG5hbWUgOiBlLm5hbWUgfHwgJ24vYScsCiAgICAgICAgbWFzc2VzIDogZS5tYXNzZXMgfHwgW10KICAgICAgfSk7CiAgICAgIF90aGlzLnRyaWdnZXIoJ2NoYW5nZScpOwogICAgICByZXR1cm4gX3RoaXM7CiAgICB9LAogICAgc2l6ZSA6IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gdGhpcy5fbGVnZW5kcy5sZW5ndGg7CiAgICB9LAogICAgbGlzdCA6IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gdGhpcy5fbGVnZW5kczsKICAgIH0KICB9KTsKCiAgdmFyIFhJQ0NvbGxlY3Rpb24gPSBCYWNrYm9uZS5Db2xsZWN0aW9uLmV4dGVuZCh7CiAgICBtb2RlbCA6IFhJQywKICAgIGRlZmF1bHRzIDogewogICAgfSwKICAgIGluaXRpYWxpemUgOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIF90aGlzLmxlZ2VuZHMgPSBuZXcgWElDQ29sbGVjdGlvbkxlZ2VuZCgpOwogICAgfQogIH0pOwoKICByZXR1cm4gWElDQ29sbGVjdGlvbjsKfSk7CgohZnVuY3Rpb24oKXtmdW5jdGlvbiBuKG4sdCl7cmV0dXJuIHQ+bj8tMTpuPnQ/MTpuPj10PzA6MC8wfWZ1bmN0aW9uIHQobil7cmV0dXJuIG51bGwhPW4mJiFpc05hTihuKX1mdW5jdGlvbiByKG4pe3JldHVybntsZWZ0OmZ1bmN0aW9uKHQscixlLHUpe2Zvcihhcmd1bWVudHMubGVuZ3RoPDMmJihlPTApLGFyZ3VtZW50cy5sZW5ndGg8NCYmKHU9dC5sZW5ndGgpO3U+ZTspe3ZhciBpPWUrdT4+PjE7bih0W2ldLHIpPDA/ZT1pKzE6dT1pfXJldHVybiBlfSxyaWdodDpmdW5jdGlvbih0LHIsZSx1KXtmb3IoYXJndW1lbnRzLmxlbmd0aDwzJiYoZT0wKSxhcmd1bWVudHMubGVuZ3RoPDQmJih1PXQubGVuZ3RoKTt1PmU7KXt2YXIgaT1lK3U+Pj4xO24odFtpXSxyKT4wP3U9aTplPWkrMX1yZXR1cm4gZX19fWZ1bmN0aW9uIGUobil7cmV0dXJuIG4ubGVuZ3RofWZ1bmN0aW9uIHUobil7Zm9yKHZhciB0PTE7bip0JTE7KXQqPTEwO3JldHVybiB0fWZ1bmN0aW9uIGkobix0KXt0cnl7Zm9yKHZhciByIGluIHQpT2JqZWN0LmRlZmluZVByb3BlcnR5KG4ucHJvdG90eXBlLHIse3ZhbHVlOnRbcl0sZW51bWVyYWJsZTohMX0pfWNhdGNoKGUpe24ucHJvdG90eXBlPXR9fWZ1bmN0aW9uIG8oKXt9ZnVuY3Rpb24gYShuKXtyZXR1cm4gc2ErbiBpbiB0aGlzfWZ1bmN0aW9uIGMobil7cmV0dXJuIG49c2ErbixuIGluIHRoaXMmJmRlbGV0ZSB0aGlzW25dfWZ1bmN0aW9uIHMoKXt2YXIgbj1bXTtyZXR1cm4gdGhpcy5mb3JFYWNoKGZ1bmN0aW9uKHQpe24ucHVzaCh0KX0pLG59ZnVuY3Rpb24gbCgpe3ZhciBuPTA7Zm9yKHZhciB0IGluIHRoaXMpdC5jaGFyQ29kZUF0KDApPT09bGEmJisrbjtyZXR1cm4gbn1mdW5jdGlvbiBmKCl7Zm9yKHZhciBuIGluIHRoaXMpaWYobi5jaGFyQ29kZUF0KDApPT09bGEpcmV0dXJuITE7cmV0dXJuITB9ZnVuY3Rpb24gaCgpe31mdW5jdGlvbiBnKG4sdCxyKXtyZXR1cm4gZnVuY3Rpb24oKXt2YXIgZT1yLmFwcGx5KHQsYXJndW1lbnRzKTtyZXR1cm4gZT09PXQ/bjplfX1mdW5jdGlvbiBwKG4sdCl7aWYodCBpbiBuKXJldHVybiB0O3Q9dC5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSt0LnN1YnN0cmluZygxKTtmb3IodmFyIHI9MCxlPWZhLmxlbmd0aDtlPnI7KytyKXt2YXIgdT1mYVtyXSt0O2lmKHUgaW4gbilyZXR1cm4gdX19ZnVuY3Rpb24gdigpe31mdW5jdGlvbiBkKCl7fWZ1bmN0aW9uIG0obil7ZnVuY3Rpb24gdCgpe2Zvcih2YXIgdCxlPXIsdT0tMSxpPWUubGVuZ3RoOysrdTxpOykodD1lW3VdLm9uKSYmdC5hcHBseSh0aGlzLGFyZ3VtZW50cyk7cmV0dXJuIG59dmFyIHI9W10sZT1uZXcgbztyZXR1cm4gdC5vbj1mdW5jdGlvbih0LHUpe3ZhciBpLG89ZS5nZXQodCk7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg8Mj9vJiZvLm9uOihvJiYoby5vbj1udWxsLHI9ci5zbGljZSgwLGk9ci5pbmRleE9mKG8pKS5jb25jYXQoci5zbGljZShpKzEpKSxlLnJlbW92ZSh0KSksdSYmci5wdXNoKGUuc2V0KHQse29uOnV9KSksbil9LHR9ZnVuY3Rpb24geSgpe0JvLmV2ZW50LnByZXZlbnREZWZhdWx0KCl9ZnVuY3Rpb24geCgpe2Zvcih2YXIgbix0PUJvLmV2ZW50O249dC5zb3VyY2VFdmVudDspdD1uO3JldHVybiB0fWZ1bmN0aW9uIE0obil7Zm9yKHZhciB0PW5ldyBkLHI9MCxlPWFyZ3VtZW50cy5sZW5ndGg7KytyPGU7KXRbYXJndW1lbnRzW3JdXT1tKHQpO3JldHVybiB0Lm9mPWZ1bmN0aW9uKHIsZSl7cmV0dXJuIGZ1bmN0aW9uKHUpe3RyeXt2YXIgaT11LnNvdXJjZUV2ZW50PUJvLmV2ZW50O3UudGFyZ2V0PW4sQm8uZXZlbnQ9dSx0W3UudHlwZV0uYXBwbHkocixlKX1maW5hbGx5e0JvLmV2ZW50PWl9fX0sdH1mdW5jdGlvbiBfKG4pe3JldHVybiBnYShuLHlhKSxufWZ1bmN0aW9uIGIobil7cmV0dXJuImZ1bmN0aW9uIj09dHlwZW9mIG4/bjpmdW5jdGlvbigpe3JldHVybiBwYShuLHRoaXMpfX1mdW5jdGlvbiB3KG4pe3JldHVybiJmdW5jdGlvbiI9PXR5cGVvZiBuP246ZnVuY3Rpb24oKXtyZXR1cm4gdmEobix0aGlzKX19ZnVuY3Rpb24gUyhuLHQpe2Z1bmN0aW9uIHIoKXt0aGlzLnJlbW92ZUF0dHJpYnV0ZShuKX1mdW5jdGlvbiBlKCl7dGhpcy5yZW1vdmVBdHRyaWJ1dGVOUyhuLnNwYWNlLG4ubG9jYWwpfWZ1bmN0aW9uIHUoKXt0aGlzLnNldEF0dHJpYnV0ZShuLHQpfWZ1bmN0aW9uIGkoKXt0aGlzLnNldEF0dHJpYnV0ZU5TKG4uc3BhY2Usbi5sb2NhbCx0KX1mdW5jdGlvbiBvKCl7dmFyIHI9dC5hcHBseSh0aGlzLGFyZ3VtZW50cyk7bnVsbD09cj90aGlzLnJlbW92ZUF0dHJpYnV0ZShuKTp0aGlzLnNldEF0dHJpYnV0ZShuLHIpfWZ1bmN0aW9uIGEoKXt2YXIgcj10LmFwcGx5KHRoaXMsYXJndW1lbnRzKTtudWxsPT1yP3RoaXMucmVtb3ZlQXR0cmlidXRlTlMobi5zcGFjZSxuLmxvY2FsKTp0aGlzLnNldEF0dHJpYnV0ZU5TKG4uc3BhY2Usbi5sb2NhbCxyKX1yZXR1cm4gbj1Cby5ucy5xdWFsaWZ5KG4pLG51bGw9PXQ/bi5sb2NhbD9lOnI6ImZ1bmN0aW9uIj09dHlwZW9mIHQ/bi5sb2NhbD9hOm86bi5sb2NhbD9pOnV9ZnVuY3Rpb24gayhuKXtyZXR1cm4gbi50cmltKCkucmVwbGFjZSgvXHMrL2csIiAiKX1mdW5jdGlvbiBFKG4pe3JldHVybiBuZXcgUmVnRXhwKCIoPzpefFxccyspIitCby5yZXF1b3RlKG4pKyIoPzpcXHMrfCQpIiwiZyIpfWZ1bmN0aW9uIEEobil7cmV0dXJuIG4udHJpbSgpLnNwbGl0KC9efFxzKy8pfWZ1bmN0aW9uIEMobix0KXtmdW5jdGlvbiByKCl7Zm9yKHZhciByPS0xOysrcjx1OyluW3JdKHRoaXMsdCl9ZnVuY3Rpb24gZSgpe2Zvcih2YXIgcj0tMSxlPXQuYXBwbHkodGhpcyxhcmd1bWVudHMpOysrcjx1OyluW3JdKHRoaXMsZSl9bj1BKG4pLm1hcChOKTt2YXIgdT1uLmxlbmd0aDtyZXR1cm4iZnVuY3Rpb24iPT10eXBlb2YgdD9lOnJ9ZnVuY3Rpb24gTihuKXt2YXIgdD1FKG4pO3JldHVybiBmdW5jdGlvbihyLGUpe2lmKHU9ci5jbGFzc0xpc3QpcmV0dXJuIGU/dS5hZGQobik6dS5yZW1vdmUobik7dmFyIHU9ci5nZXRBdHRyaWJ1dGUoImNsYXNzIil8fCIiO2U/KHQubGFzdEluZGV4PTAsdC50ZXN0KHUpfHxyLnNldEF0dHJpYnV0ZSgiY2xhc3MiLGsodSsiICIrbikpKTpyLnNldEF0dHJpYnV0ZSgiY2xhc3MiLGsodS5yZXBsYWNlKHQsIiAiKSkpfX1mdW5jdGlvbiB6KG4sdCxyKXtmdW5jdGlvbiBlKCl7dGhpcy5zdHlsZS5yZW1vdmVQcm9wZXJ0eShuKX1mdW5jdGlvbiB1KCl7dGhpcy5zdHlsZS5zZXRQcm9wZXJ0eShuLHQscil9ZnVuY3Rpb24gaSgpe3ZhciBlPXQuYXBwbHkodGhpcyxhcmd1bWVudHMpO251bGw9PWU/dGhpcy5zdHlsZS5yZW1vdmVQcm9wZXJ0eShuKTp0aGlzLnN0eWxlLnNldFByb3BlcnR5KG4sZSxyKX1yZXR1cm4gbnVsbD09dD9lOiJmdW5jdGlvbiI9PXR5cGVvZiB0P2k6dX1mdW5jdGlvbiBMKG4sdCl7ZnVuY3Rpb24gcigpe2RlbGV0ZSB0aGlzW25dfWZ1bmN0aW9uIGUoKXt0aGlzW25dPXR9ZnVuY3Rpb24gdSgpe3ZhciByPXQuYXBwbHkodGhpcyxhcmd1bWVudHMpO251bGw9PXI/ZGVsZXRlIHRoaXNbbl06dGhpc1tuXT1yfXJldHVybiBudWxsPT10P3I6ImZ1bmN0aW9uIj09dHlwZW9mIHQ/dTplfWZ1bmN0aW9uIFQobil7cmV0dXJuImZ1bmN0aW9uIj09dHlwZW9mIG4/bjoobj1Cby5ucy5xdWFsaWZ5KG4pKS5sb2NhbD9mdW5jdGlvbigpe3JldHVybiB0aGlzLm93bmVyRG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKG4uc3BhY2Usbi5sb2NhbCl9OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMub3duZXJEb2N1bWVudC5jcmVhdGVFbGVtZW50TlModGhpcy5uYW1lc3BhY2VVUkksbil9fWZ1bmN0aW9uIHEobil7cmV0dXJue19fZGF0YV9fOm59fWZ1bmN0aW9uIFIobil7cmV0dXJuIGZ1bmN0aW9uKCl7cmV0dXJuIG1hKHRoaXMsbil9fWZ1bmN0aW9uIEQodCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGh8fCh0PW4pLGZ1bmN0aW9uKG4scil7cmV0dXJuIG4mJnI/dChuLl9fZGF0YV9fLHIuX19kYXRhX18pOiFuLSFyfX1mdW5jdGlvbiBQKG4sdCl7Zm9yKHZhciByPTAsZT1uLmxlbmd0aDtlPnI7cisrKWZvcih2YXIgdSxpPW5bcl0sbz0wLGE9aS5sZW5ndGg7YT5vO28rKykodT1pW29dKSYmdCh1LG8scik7cmV0dXJuIG59ZnVuY3Rpb24gVShuKXtyZXR1cm4gZ2EobixNYSksbn1mdW5jdGlvbiBqKG4pe3ZhciB0LHI7cmV0dXJuIGZ1bmN0aW9uKGUsdSxpKXt2YXIgbyxhPW5baV0udXBkYXRlLGM9YS5sZW5ndGg7Zm9yKGkhPXImJihyPWksdD0wKSx1Pj10JiYodD11KzEpOyEobz1hW3RdKSYmKyt0PGM7KTtyZXR1cm4gb319ZnVuY3Rpb24gSCgpe3ZhciBuPXRoaXMuX190cmFuc2l0aW9uX187biYmKytuLmFjdGl2ZX1mdW5jdGlvbiBGKG4sdCxyKXtmdW5jdGlvbiBlKCl7dmFyIHQ9dGhpc1tvXTt0JiYodGhpcy5yZW1vdmVFdmVudExpc3RlbmVyKG4sdCx0LiQpLGRlbGV0ZSB0aGlzW29dKX1mdW5jdGlvbiB1KCl7dmFyIHU9Yyh0LFdvKGFyZ3VtZW50cykpO2UuY2FsbCh0aGlzKSx0aGlzLmFkZEV2ZW50TGlzdGVuZXIobix0aGlzW29dPXUsdS4kPXIpLHUuXz10fWZ1bmN0aW9uIGkoKXt2YXIgdCxyPW5ldyBSZWdFeHAoIl5fX29uKFteLl0rKSIrQm8ucmVxdW90ZShuKSsiJCIpO2Zvcih2YXIgZSBpbiB0aGlzKWlmKHQ9ZS5tYXRjaChyKSl7dmFyIHU9dGhpc1tlXTt0aGlzLnJlbW92ZUV2ZW50TGlzdGVuZXIodFsxXSx1LHUuJCksZGVsZXRlIHRoaXNbZV19fXZhciBvPSJfX29uIituLGE9bi5pbmRleE9mKCIuIiksYz1PO2E+MCYmKG49bi5zdWJzdHJpbmcoMCxhKSk7dmFyIHM9YmEuZ2V0KG4pO3JldHVybiBzJiYobj1zLGM9SSksYT90P3U6ZTp0P3Y6aX1mdW5jdGlvbiBPKG4sdCl7cmV0dXJuIGZ1bmN0aW9uKHIpe3ZhciBlPUJvLmV2ZW50O0JvLmV2ZW50PXIsdFswXT10aGlzLl9fZGF0YV9fO3RyeXtuLmFwcGx5KHRoaXMsdCl9ZmluYWxseXtCby5ldmVudD1lfX19ZnVuY3Rpb24gSShuLHQpe3ZhciByPU8obix0KTtyZXR1cm4gZnVuY3Rpb24obil7dmFyIHQ9dGhpcyxlPW4ucmVsYXRlZFRhcmdldDtlJiYoZT09PXR8fDgmZS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbih0KSl8fHIuY2FsbCh0LG4pfX1mdW5jdGlvbiBZKCl7dmFyIG49Ii5kcmFnc3VwcHJlc3MtIisgKytTYSx0PSJjbGljayIrbixyPUJvLnNlbGVjdChRbykub24oInRvdWNobW92ZSIrbix5KS5vbigiZHJhZ3N0YXJ0IituLHkpLm9uKCJzZWxlY3RzdGFydCIrbix5KTtpZih3YSl7dmFyIGU9S28uc3R5bGUsdT1lW3dhXTtlW3dhXT0ibm9uZSJ9cmV0dXJuIGZ1bmN0aW9uKGkpe2Z1bmN0aW9uIG8oKXtyLm9uKHQsbnVsbCl9ci5vbihuLG51bGwpLHdhJiYoZVt3YV09dSksaSYmKHIub24odCxmdW5jdGlvbigpe3koKSxvKCl9LCEwKSxzZXRUaW1lb3V0KG8sMCkpfX1mdW5jdGlvbiBaKG4sdCl7dC5jaGFuZ2VkVG91Y2hlcyYmKHQ9dC5jaGFuZ2VkVG91Y2hlc1swXSk7dmFyIHI9bi5vd25lclNWR0VsZW1lbnR8fG47aWYoci5jcmVhdGVTVkdQb2ludCl7dmFyIGU9ci5jcmVhdGVTVkdQb2ludCgpO3JldHVybiBlLng9dC5jbGllbnRYLGUueT10LmNsaWVudFksZT1lLm1hdHJpeFRyYW5zZm9ybShuLmdldFNjcmVlbkNUTSgpLmludmVyc2UoKSksW2UueCxlLnldfXZhciB1PW4uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7cmV0dXJuW3QuY2xpZW50WC11LmxlZnQtbi5jbGllbnRMZWZ0LHQuY2xpZW50WS11LnRvcC1uLmNsaWVudFRvcF19ZnVuY3Rpb24gVigpe3JldHVybiBCby5ldmVudC5jaGFuZ2VkVG91Y2hlc1swXS5pZGVudGlmaWVyfWZ1bmN0aW9uICQoKXtyZXR1cm4gQm8uZXZlbnQudGFyZ2V0fWZ1bmN0aW9uIFgoKXtyZXR1cm4gUW99ZnVuY3Rpb24gQihuKXtyZXR1cm4gbj4wPzE6MD5uPy0xOjB9ZnVuY3Rpb24gSihuLHQscil7cmV0dXJuKHRbMF0tblswXSkqKHJbMV0tblsxXSktKHRbMV0tblsxXSkqKHJbMF0tblswXSl9ZnVuY3Rpb24gVyhuKXtyZXR1cm4gbj4xPzA6LTE+bj9rYTpNYXRoLmFjb3Mobil9ZnVuY3Rpb24gRyhuKXtyZXR1cm4gbj4xP0FhOi0xPm4/LUFhOk1hdGguYXNpbihuKX1mdW5jdGlvbiBLKG4pe3JldHVybigobj1NYXRoLmV4cChuKSktMS9uKS8yfWZ1bmN0aW9uIFEobil7cmV0dXJuKChuPU1hdGguZXhwKG4pKSsxL24pLzJ9ZnVuY3Rpb24gbnQobil7cmV0dXJuKChuPU1hdGguZXhwKDIqbikpLTEpLyhuKzEpfWZ1bmN0aW9uIHR0KG4pe3JldHVybihuPU1hdGguc2luKG4vMikpKm59ZnVuY3Rpb24gcnQoKXt9ZnVuY3Rpb24gZXQobix0LHIpe3JldHVybiBuZXcgdXQobix0LHIpfWZ1bmN0aW9uIHV0KG4sdCxyKXt0aGlzLmg9bix0aGlzLnM9dCx0aGlzLmw9cn1mdW5jdGlvbiBpdChuLHQscil7ZnVuY3Rpb24gZShuKXtyZXR1cm4gbj4zNjA/bi09MzYwOjA+biYmKG4rPTM2MCksNjA+bj9pKyhvLWkpKm4vNjA6MTgwPm4/bzoyNDA+bj9pKyhvLWkpKigyNDAtbikvNjA6aX1mdW5jdGlvbiB1KG4pe3JldHVybiBNYXRoLnJvdW5kKDI1NSplKG4pKX12YXIgaSxvO3JldHVybiBuPWlzTmFOKG4pPzA6KG4lPTM2MCk8MD9uKzM2MDpuLHQ9aXNOYU4odCk/MDowPnQ/MDp0PjE/MTp0LHI9MD5yPzA6cj4xPzE6cixvPS41Pj1yP3IqKDErdCk6cit0LXIqdCxpPTIqci1vLHl0KHUobisxMjApLHUobiksdShuLTEyMCkpfWZ1bmN0aW9uIG90KG4sdCxyKXtyZXR1cm4gbmV3IGF0KG4sdCxyKX1mdW5jdGlvbiBhdChuLHQscil7dGhpcy5oPW4sdGhpcy5jPXQsdGhpcy5sPXJ9ZnVuY3Rpb24gY3Qobix0LHIpe3JldHVybiBpc05hTihuKSYmKG49MCksaXNOYU4odCkmJih0PTApLHN0KHIsTWF0aC5jb3Mobio9emEpKnQsTWF0aC5zaW4obikqdCl9ZnVuY3Rpb24gc3Qobix0LHIpe3JldHVybiBuZXcgbHQobix0LHIpfWZ1bmN0aW9uIGx0KG4sdCxyKXt0aGlzLmw9bix0aGlzLmE9dCx0aGlzLmI9cn1mdW5jdGlvbiBmdChuLHQscil7dmFyIGU9KG4rMTYpLzExNix1PWUrdC81MDAsaT1lLXIvMjAwO3JldHVybiB1PWd0KHUpKk9hLGU9Z3QoZSkqSWEsaT1ndChpKSpZYSx5dCh2dCgzLjI0MDQ1NDIqdS0xLjUzNzEzODUqZS0uNDk4NTMxNCppKSx2dCgtLjk2OTI2Nip1KzEuODc2MDEwOCplKy4wNDE1NTYqaSksdnQoLjA1NTY0MzQqdS0uMjA0MDI1OSplKzEuMDU3MjI1MippKSl9ZnVuY3Rpb24gaHQobix0LHIpe3JldHVybiBuPjA/b3QoTWF0aC5hdGFuMihyLHQpKkxhLE1hdGguc3FydCh0KnQrcipyKSxuKTpvdCgwLzAsMC8wLG4pfWZ1bmN0aW9uIGd0KG4pe3JldHVybiBuPi4yMDY4OTMwMzQ/bipuKm46KG4tNC8yOSkvNy43ODcwMzd9ZnVuY3Rpb24gcHQobil7cmV0dXJuIG4+LjAwODg1Nj9NYXRoLnBvdyhuLDEvMyk6Ny43ODcwMzcqbis0LzI5fWZ1bmN0aW9uIHZ0KG4pe3JldHVybiBNYXRoLnJvdW5kKDI1NSooLjAwMzA0Pj1uPzEyLjkyKm46MS4wNTUqTWF0aC5wb3cobiwxLzIuNCktLjA1NSkpfWZ1bmN0aW9uIGR0KG4pe3JldHVybiB5dChuPj4xNiwyNTUmbj4+OCwyNTUmbil9ZnVuY3Rpb24gbXQobil7cmV0dXJuIGR0KG4pKyIifWZ1bmN0aW9uIHl0KG4sdCxyKXtyZXR1cm4gbmV3IHh0KG4sdCxyKX1mdW5jdGlvbiB4dChuLHQscil7dGhpcy5yPW4sdGhpcy5nPXQsdGhpcy5iPXJ9ZnVuY3Rpb24gTXQobil7cmV0dXJuIDE2Pm4/IjAiK01hdGgubWF4KDAsbikudG9TdHJpbmcoMTYpOk1hdGgubWluKDI1NSxuKS50b1N0cmluZygxNil9ZnVuY3Rpb24gX3Qobix0LHIpe3ZhciBlLHUsaSxvPTAsYT0wLGM9MDtpZihlPS8oW2Etel0rKVwoKC4qKVwpL2kuZXhlYyhuKSlzd2l0Y2godT1lWzJdLnNwbGl0KCIsIiksZVsxXSl7Y2FzZSJoc2wiOnJldHVybiByKHBhcnNlRmxvYXQodVswXSkscGFyc2VGbG9hdCh1WzFdKS8xMDAscGFyc2VGbG9hdCh1WzJdKS8xMDApO2Nhc2UicmdiIjpyZXR1cm4gdChrdCh1WzBdKSxrdCh1WzFdKSxrdCh1WzJdKSl9cmV0dXJuKGk9JGEuZ2V0KG4pKT90KGkucixpLmcsaS5iKToobnVsbD09bnx8IiMiIT09bi5jaGFyQXQoMCl8fGlzTmFOKGk9cGFyc2VJbnQobi5zdWJzdHJpbmcoMSksMTYpKXx8KDQ9PT1uLmxlbmd0aD8obz0oMzg0MCZpKT4+NCxvPW8+PjR8byxhPTI0MCZpLGE9YT4+NHxhLGM9MTUmaSxjPWM8PDR8Yyk6Nz09PW4ubGVuZ3RoJiYobz0oMTY3MTE2ODAmaSk+PjE2LGE9KDY1MjgwJmkpPj44LGM9MjU1JmkpKSx0KG8sYSxjKSl9ZnVuY3Rpb24gYnQobix0LHIpe3ZhciBlLHUsaT1NYXRoLm1pbihuLz0yNTUsdC89MjU1LHIvPTI1NSksbz1NYXRoLm1heChuLHQsciksYT1vLWksYz0obytpKS8yO3JldHVybiBhPyh1PS41PmM/YS8obytpKTphLygyLW8taSksZT1uPT1vPyh0LXIpL2ErKHI+dD82OjApOnQ9PW8/KHItbikvYSsyOihuLXQpL2ErNCxlKj02MCk6KGU9MC8wLHU9Yz4wJiYxPmM/MDplKSxldChlLHUsYyl9ZnVuY3Rpb24gd3Qobix0LHIpe249U3QobiksdD1TdCh0KSxyPVN0KHIpO3ZhciBlPXB0KCguNDEyNDU2NCpuKy4zNTc1NzYxKnQrLjE4MDQzNzUqcikvT2EpLHU9cHQoKC4yMTI2NzI5Km4rLjcxNTE1MjIqdCsuMDcyMTc1KnIpL0lhKSxpPXB0KCguMDE5MzMzOSpuKy4xMTkxOTIqdCsuOTUwMzA0MSpyKS9ZYSk7cmV0dXJuIHN0KDExNip1LTE2LDUwMCooZS11KSwyMDAqKHUtaSkpfWZ1bmN0aW9uIFN0KG4pe3JldHVybihuLz0yNTUpPD0uMDQwNDU/bi8xMi45MjpNYXRoLnBvdygobisuMDU1KS8xLjA1NSwyLjQpfWZ1bmN0aW9uIGt0KG4pe3ZhciB0PXBhcnNlRmxvYXQobik7cmV0dXJuIiUiPT09bi5jaGFyQXQobi5sZW5ndGgtMSk/TWF0aC5yb3VuZCgyLjU1KnQpOnR9ZnVuY3Rpb24gRXQobil7cmV0dXJuImZ1bmN0aW9uIj09dHlwZW9mIG4/bjpmdW5jdGlvbigpe3JldHVybiBufX1mdW5jdGlvbiBBdChuKXtyZXR1cm4gbn1mdW5jdGlvbiBDdChuKXtyZXR1cm4gZnVuY3Rpb24odCxyLGUpe3JldHVybiAyPT09YXJndW1lbnRzLmxlbmd0aCYmImZ1bmN0aW9uIj09dHlwZW9mIHImJihlPXIscj1udWxsKSxOdCh0LHIsbixlKX19ZnVuY3Rpb24gTnQobix0LHIsZSl7ZnVuY3Rpb24gdSgpe3ZhciBuLHQ9Yy5zdGF0dXM7aWYoIXQmJmMucmVzcG9uc2VUZXh0fHx0Pj0yMDAmJjMwMD50fHwzMDQ9PT10KXt0cnl7bj1yLmNhbGwoaSxjKX1jYXRjaChlKXtyZXR1cm4gby5lcnJvci5jYWxsKGksZSksdm9pZCAwfW8ubG9hZC5jYWxsKGksbil9ZWxzZSBvLmVycm9yLmNhbGwoaSxjKX12YXIgaT17fSxvPUJvLmRpc3BhdGNoKCJiZWZvcmVzZW5kIiwicHJvZ3Jlc3MiLCJsb2FkIiwiZXJyb3IiKSxhPXt9LGM9bmV3IFhNTEh0dHBSZXF1ZXN0LHM9bnVsbDtyZXR1cm4hUW8uWERvbWFpblJlcXVlc3R8fCJ3aXRoQ3JlZGVudGlhbHMiaW4gY3x8IS9eKGh0dHAocyk/Oik/XC9cLy8udGVzdChuKXx8KGM9bmV3IFhEb21haW5SZXF1ZXN0KSwib25sb2FkImluIGM/Yy5vbmxvYWQ9Yy5vbmVycm9yPXU6Yy5vbnJlYWR5c3RhdGVjaGFuZ2U9ZnVuY3Rpb24oKXtjLnJlYWR5U3RhdGU+MyYmdSgpfSxjLm9ucHJvZ3Jlc3M9ZnVuY3Rpb24obil7dmFyIHQ9Qm8uZXZlbnQ7Qm8uZXZlbnQ9bjt0cnl7by5wcm9ncmVzcy5jYWxsKGksYyl9ZmluYWxseXtCby5ldmVudD10fX0saS5oZWFkZXI9ZnVuY3Rpb24obix0KXtyZXR1cm4gbj0obisiIikudG9Mb3dlckNhc2UoKSxhcmd1bWVudHMubGVuZ3RoPDI/YVtuXToobnVsbD09dD9kZWxldGUgYVtuXTphW25dPXQrIiIsaSl9LGkubWltZVR5cGU9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHQ9bnVsbD09bj9udWxsOm4rIiIsaSk6dH0saS5yZXNwb25zZVR5cGU9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHM9bixpKTpzfSxpLnJlc3BvbnNlPWZ1bmN0aW9uKG4pe3JldHVybiByPW4saX0sWyJnZXQiLCJwb3N0Il0uZm9yRWFjaChmdW5jdGlvbihuKXtpW25dPWZ1bmN0aW9uKCl7cmV0dXJuIGkuc2VuZC5hcHBseShpLFtuXS5jb25jYXQoV28oYXJndW1lbnRzKSkpfX0pLGkuc2VuZD1mdW5jdGlvbihyLGUsdSl7aWYoMj09PWFyZ3VtZW50cy5sZW5ndGgmJiJmdW5jdGlvbiI9PXR5cGVvZiBlJiYodT1lLGU9bnVsbCksYy5vcGVuKHIsbiwhMCksbnVsbD09dHx8ImFjY2VwdCJpbiBhfHwoYS5hY2NlcHQ9dCsiLCovKiIpLGMuc2V0UmVxdWVzdEhlYWRlcilmb3IodmFyIGwgaW4gYSljLnNldFJlcXVlc3RIZWFkZXIobCxhW2xdKTtyZXR1cm4gbnVsbCE9dCYmYy5vdmVycmlkZU1pbWVUeXBlJiZjLm92ZXJyaWRlTWltZVR5cGUodCksbnVsbCE9cyYmKGMucmVzcG9uc2VUeXBlPXMpLG51bGwhPXUmJmkub24oImVycm9yIix1KS5vbigibG9hZCIsZnVuY3Rpb24obil7dShudWxsLG4pfSksby5iZWZvcmVzZW5kLmNhbGwoaSxjKSxjLnNlbmQobnVsbD09ZT9udWxsOmUpLGl9LGkuYWJvcnQ9ZnVuY3Rpb24oKXtyZXR1cm4gYy5hYm9ydCgpLGl9LEJvLnJlYmluZChpLG8sIm9uIiksbnVsbD09ZT9pOmkuZ2V0KHp0KGUpKX1mdW5jdGlvbiB6dChuKXtyZXR1cm4gMT09PW4ubGVuZ3RoP2Z1bmN0aW9uKHQscil7bihudWxsPT10P3I6bnVsbCl9Om59ZnVuY3Rpb24gTHQoKXt2YXIgbj1UdCgpLHQ9cXQoKS1uO3Q+MjQ/KGlzRmluaXRlKHQpJiYoY2xlYXJUaW1lb3V0KFdhKSxXYT1zZXRUaW1lb3V0KEx0LHQpKSxKYT0wKTooSmE9MSxLYShMdCkpfWZ1bmN0aW9uIFR0KCl7dmFyIG49RGF0ZS5ub3coKTtmb3IoR2E9WGE7R2E7KW4+PUdhLnQmJihHYS5mPUdhLmMobi1HYS50KSksR2E9R2EubjtyZXR1cm4gbn1mdW5jdGlvbiBxdCgpe2Zvcih2YXIgbix0PVhhLHI9MS8wO3Q7KXQuZj90PW4/bi5uPXQubjpYYT10Lm46KHQudDxyJiYocj10LnQpLHQ9KG49dCkubik7cmV0dXJuIEJhPW4scn1mdW5jdGlvbiBSdChuLHQpe3JldHVybiB0LShuP01hdGguY2VpbChNYXRoLmxvZyhuKS9NYXRoLkxOMTApOjEpfWZ1bmN0aW9uIER0KG4sdCl7dmFyIHI9TWF0aC5wb3coMTAsMypjYSg4LXQpKTtyZXR1cm57c2NhbGU6dD44P2Z1bmN0aW9uKG4pe3JldHVybiBuL3J9OmZ1bmN0aW9uKG4pe3JldHVybiBuKnJ9LHN5bWJvbDpufX1mdW5jdGlvbiBQdChuKXt2YXIgdD1uLmRlY2ltYWwscj1uLnRob3VzYW5kcyxlPW4uZ3JvdXBpbmcsdT1uLmN1cnJlbmN5LGk9ZT9mdW5jdGlvbihuKXtmb3IodmFyIHQ9bi5sZW5ndGgsdT1bXSxpPTAsbz1lWzBdO3Q+MCYmbz4wOyl1LnB1c2gobi5zdWJzdHJpbmcodC09byx0K28pKSxvPWVbaT0oaSsxKSVlLmxlbmd0aF07cmV0dXJuIHUucmV2ZXJzZSgpLmpvaW4ocil9OkF0O3JldHVybiBmdW5jdGlvbihuKXt2YXIgcj1uYy5leGVjKG4pLGU9clsxXXx8IiAiLG89clsyXXx8Ij4iLGE9clszXXx8IiIsYz1yWzRdfHwiIixzPXJbNV0sbD0rcls2XSxmPXJbN10saD1yWzhdLGc9cls5XSxwPTEsdj0iIixkPSIiLG09ITE7c3dpdGNoKGgmJihoPStoLnN1YnN0cmluZygxKSksKHN8fCIwIj09PWUmJiI9Ij09PW8pJiYocz1lPSIwIixvPSI9IixmJiYobC09TWF0aC5mbG9vcigobC0xKS80KSkpLGcpe2Nhc2UibiI6Zj0hMCxnPSJnIjticmVhaztjYXNlIiUiOnA9MTAwLGQ9IiUiLGc9ImYiO2JyZWFrO2Nhc2UicCI6cD0xMDAsZD0iJSIsZz0iciI7YnJlYWs7Y2FzZSJiIjpjYXNlIm8iOmNhc2UieCI6Y2FzZSJYIjoiIyI9PT1jJiYodj0iMCIrZy50b0xvd2VyQ2FzZSgpKTtjYXNlImMiOmNhc2UiZCI6bT0hMCxoPTA7YnJlYWs7Y2FzZSJzIjpwPS0xLGc9InIifSIkIj09PWMmJih2PXVbMF0sZD11WzFdKSwiciIhPWd8fGh8fChnPSJnIiksbnVsbCE9aCYmKCJnIj09Zz9oPU1hdGgubWF4KDEsTWF0aC5taW4oMjEsaCkpOigiZSI9PWd8fCJmIj09ZykmJihoPU1hdGgubWF4KDAsTWF0aC5taW4oMjAsaCkpKSksZz10Yy5nZXQoZyl8fFV0O3ZhciB5PXMmJmY7cmV0dXJuIGZ1bmN0aW9uKG4pe3ZhciByPWQ7aWYobSYmbiUxKXJldHVybiIiO3ZhciB1PTA+bnx8MD09PW4mJjA+MS9uPyhuPS1uLCItIik6YTtpZigwPnApe3ZhciBjPUJvLmZvcm1hdFByZWZpeChuLGgpO249Yy5zY2FsZShuKSxyPWMuc3ltYm9sK2R9ZWxzZSBuKj1wO249ZyhuLGgpO3ZhciB4PW4ubGFzdEluZGV4T2YoIi4iKSxNPTA+eD9uOm4uc3Vic3RyaW5nKDAseCksXz0wPng/IiI6dCtuLnN1YnN0cmluZyh4KzEpOyFzJiZmJiYoTT1pKE0pKTt2YXIgYj12Lmxlbmd0aCtNLmxlbmd0aCtfLmxlbmd0aCsoeT8wOnUubGVuZ3RoKSx3PWw+Yj9uZXcgQXJyYXkoYj1sLWIrMSkuam9pbihlKToiIjtyZXR1cm4geSYmKE09aSh3K00pKSx1Kz12LG49TStfLCgiPCI9PT1vP3Urbit3OiI+Ij09PW8/dyt1K246Il4iPT09bz93LnN1YnN0cmluZygwLGI+Pj0xKSt1K24rdy5zdWJzdHJpbmcoYik6dSsoeT9uOncrbikpK3J9fX1mdW5jdGlvbiBVdChuKXtyZXR1cm4gbisiIn1mdW5jdGlvbiBqdCgpe3RoaXMuXz1uZXcgRGF0ZShhcmd1bWVudHMubGVuZ3RoPjE/RGF0ZS5VVEMuYXBwbHkodGhpcyxhcmd1bWVudHMpOmFyZ3VtZW50c1swXSl9ZnVuY3Rpb24gSHQobix0LHIpe2Z1bmN0aW9uIGUodCl7dmFyIHI9bih0KSxlPWkociwxKTtyZXR1cm4gZS10PnQtcj9yOmV9ZnVuY3Rpb24gdShyKXtyZXR1cm4gdChyPW4obmV3IGVjKHItMSkpLDEpLHJ9ZnVuY3Rpb24gaShuLHIpe3JldHVybiB0KG49bmV3IGVjKCtuKSxyKSxufWZ1bmN0aW9uIG8obixlLGkpe3ZhciBvPXUobiksYT1bXTtpZihpPjEpZm9yKDtlPm87KXIobyklaXx8YS5wdXNoKG5ldyBEYXRlKCtvKSksdChvLDEpO2Vsc2UgZm9yKDtlPm87KWEucHVzaChuZXcgRGF0ZSgrbykpLHQobywxKTtyZXR1cm4gYX1mdW5jdGlvbiBhKG4sdCxyKXt0cnl7ZWM9anQ7dmFyIGU9bmV3IGp0O3JldHVybiBlLl89bixvKGUsdCxyKX1maW5hbGx5e2VjPURhdGV9fW4uZmxvb3I9bixuLnJvdW5kPWUsbi5jZWlsPXUsbi5vZmZzZXQ9aSxuLnJhbmdlPW87dmFyIGM9bi51dGM9RnQobik7cmV0dXJuIGMuZmxvb3I9YyxjLnJvdW5kPUZ0KGUpLGMuY2VpbD1GdCh1KSxjLm9mZnNldD1GdChpKSxjLnJhbmdlPWEsbn1mdW5jdGlvbiBGdChuKXtyZXR1cm4gZnVuY3Rpb24odCxyKXt0cnl7ZWM9anQ7dmFyIGU9bmV3IGp0O3JldHVybiBlLl89dCxuKGUscikuX31maW5hbGx5e2VjPURhdGV9fX1mdW5jdGlvbiBPdChuKXtmdW5jdGlvbiB0KG4pe2Z1bmN0aW9uIHQodCl7Zm9yKHZhciByLHUsaSxvPVtdLGE9LTEsYz0wOysrYTxlOykzNz09PW4uY2hhckNvZGVBdChhKSYmKG8ucHVzaChuLnN1YnN0cmluZyhjLGEpKSxudWxsIT0odT1pY1tyPW4uY2hhckF0KCsrYSldKSYmKHI9bi5jaGFyQXQoKythKSksKGk9Q1tyXSkmJihyPWkodCxudWxsPT11PyJlIj09PXI/IiAiOiIwIjp1KSksby5wdXNoKHIpLGM9YSsxKTtyZXR1cm4gby5wdXNoKG4uc3Vic3RyaW5nKGMsYSkpLG8uam9pbigiIil9dmFyIGU9bi5sZW5ndGg7cmV0dXJuIHQucGFyc2U9ZnVuY3Rpb24odCl7dmFyIGU9e3k6MTkwMCxtOjAsZDoxLEg6MCxNOjAsUzowLEw6MCxaOm51bGx9LHU9cihlLG4sdCwwKTtpZih1IT10Lmxlbmd0aClyZXR1cm4gbnVsbDsicCJpbiBlJiYoZS5IPWUuSCUxMisxMiplLnApO3ZhciBpPW51bGwhPWUuWiYmZWMhPT1qdCxvPW5ldyhpP2p0OmVjKTtyZXR1cm4iaiJpbiBlP28uc2V0RnVsbFllYXIoZS55LDAsZS5qKToidyJpbiBlJiYoIlciaW4gZXx8IlUiaW4gZSk/KG8uc2V0RnVsbFllYXIoZS55LDAsMSksby5zZXRGdWxsWWVhcihlLnksMCwiVyJpbiBlPyhlLncrNiklNys3KmUuVy0oby5nZXREYXkoKSs1KSU3OmUudys3KmUuVS0oby5nZXREYXkoKSs2KSU3KSk6by5zZXRGdWxsWWVhcihlLnksZS5tLGUuZCksby5zZXRIb3VycyhlLkgrTWF0aC5mbG9vcihlLlovMTAwKSxlLk0rZS5aJTEwMCxlLlMsZS5MKSxpP28uXzpvfSx0LnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuIG59LHR9ZnVuY3Rpb24gcihuLHQscixlKXtmb3IodmFyIHUsaSxvLGE9MCxjPXQubGVuZ3RoLHM9ci5sZW5ndGg7Yz5hOyl7aWYoZT49cylyZXR1cm4tMTtpZih1PXQuY2hhckNvZGVBdChhKyspLDM3PT09dSl7aWYobz10LmNoYXJBdChhKyspLGk9TltvIGluIGljP3QuY2hhckF0KGErKyk6b10sIWl8fChlPWkobixyLGUpKTwwKXJldHVybi0xfWVsc2UgaWYodSE9ci5jaGFyQ29kZUF0KGUrKykpcmV0dXJuLTF9cmV0dXJuIGV9ZnVuY3Rpb24gZShuLHQscil7Yi5sYXN0SW5kZXg9MDt2YXIgZT1iLmV4ZWModC5zdWJzdHJpbmcocikpO3JldHVybiBlPyhuLnc9dy5nZXQoZVswXS50b0xvd2VyQ2FzZSgpKSxyK2VbMF0ubGVuZ3RoKTotMX1mdW5jdGlvbiB1KG4sdCxyKXtNLmxhc3RJbmRleD0wO3ZhciBlPU0uZXhlYyh0LnN1YnN0cmluZyhyKSk7cmV0dXJuIGU/KG4udz1fLmdldChlWzBdLnRvTG93ZXJDYXNlKCkpLHIrZVswXS5sZW5ndGgpOi0xfWZ1bmN0aW9uIGkobix0LHIpe0UubGFzdEluZGV4PTA7dmFyIGU9RS5leGVjKHQuc3Vic3RyaW5nKHIpKTtyZXR1cm4gZT8obi5tPUEuZ2V0KGVbMF0udG9Mb3dlckNhc2UoKSkscitlWzBdLmxlbmd0aCk6LTF9ZnVuY3Rpb24gbyhuLHQscil7Uy5sYXN0SW5kZXg9MDt2YXIgZT1TLmV4ZWModC5zdWJzdHJpbmcocikpO3JldHVybiBlPyhuLm09ay5nZXQoZVswXS50b0xvd2VyQ2FzZSgpKSxyK2VbMF0ubGVuZ3RoKTotMX1mdW5jdGlvbiBhKG4sdCxlKXtyZXR1cm4gcihuLEMuYy50b1N0cmluZygpLHQsZSl9ZnVuY3Rpb24gYyhuLHQsZSl7cmV0dXJuIHIobixDLngudG9TdHJpbmcoKSx0LGUpfWZ1bmN0aW9uIHMobix0LGUpe3JldHVybiByKG4sQy5YLnRvU3RyaW5nKCksdCxlKX1mdW5jdGlvbiBsKG4sdCxyKXt2YXIgZT14LmdldCh0LnN1YnN0cmluZyhyLHIrPTIpLnRvTG93ZXJDYXNlKCkpO3JldHVybiBudWxsPT1lPy0xOihuLnA9ZSxyKX12YXIgZj1uLmRhdGVUaW1lLGg9bi5kYXRlLGc9bi50aW1lLHA9bi5wZXJpb2RzLHY9bi5kYXlzLGQ9bi5zaG9ydERheXMsbT1uLm1vbnRocyx5PW4uc2hvcnRNb250aHM7dC51dGM9ZnVuY3Rpb24obil7ZnVuY3Rpb24gcihuKXt0cnl7ZWM9anQ7dmFyIHQ9bmV3IGVjO3JldHVybiB0Ll89bixlKHQpfWZpbmFsbHl7ZWM9RGF0ZX19dmFyIGU9dChuKTtyZXR1cm4gci5wYXJzZT1mdW5jdGlvbihuKXt0cnl7ZWM9anQ7dmFyIHQ9ZS5wYXJzZShuKTtyZXR1cm4gdCYmdC5ffWZpbmFsbHl7ZWM9RGF0ZX19LHIudG9TdHJpbmc9ZS50b1N0cmluZyxyfSx0Lm11bHRpPXQudXRjLm11bHRpPWFyO3ZhciB4PUJvLm1hcCgpLE09WXQodiksXz1adCh2KSxiPVl0KGQpLHc9WnQoZCksUz1ZdChtKSxrPVp0KG0pLEU9WXQoeSksQT1adCh5KTtwLmZvckVhY2goZnVuY3Rpb24obix0KXt4LnNldChuLnRvTG93ZXJDYXNlKCksdCl9KTt2YXIgQz17YTpmdW5jdGlvbihuKXtyZXR1cm4gZFtuLmdldERheSgpXX0sQTpmdW5jdGlvbihuKXtyZXR1cm4gdltuLmdldERheSgpXX0sYjpmdW5jdGlvbihuKXtyZXR1cm4geVtuLmdldE1vbnRoKCldfSxCOmZ1bmN0aW9uKG4pe3JldHVybiBtW24uZ2V0TW9udGgoKV19LGM6dChmKSxkOmZ1bmN0aW9uKG4sdCl7cmV0dXJuIEl0KG4uZ2V0RGF0ZSgpLHQsMil9LGU6ZnVuY3Rpb24obix0KXtyZXR1cm4gSXQobi5nZXREYXRlKCksdCwyKX0sSDpmdW5jdGlvbihuLHQpe3JldHVybiBJdChuLmdldEhvdXJzKCksdCwyKX0sSTpmdW5jdGlvbihuLHQpe3JldHVybiBJdChuLmdldEhvdXJzKCklMTJ8fDEyLHQsMil9LGo6ZnVuY3Rpb24obix0KXtyZXR1cm4gSXQoMStyYy5kYXlPZlllYXIobiksdCwzKX0sTDpmdW5jdGlvbihuLHQpe3JldHVybiBJdChuLmdldE1pbGxpc2Vjb25kcygpLHQsMyl9LG06ZnVuY3Rpb24obix0KXtyZXR1cm4gSXQobi5nZXRNb250aCgpKzEsdCwyKX0sTTpmdW5jdGlvbihuLHQpe3JldHVybiBJdChuLmdldE1pbnV0ZXMoKSx0LDIpfSxwOmZ1bmN0aW9uKG4pe3JldHVybiBwWysobi5nZXRIb3VycygpPj0xMildfSxTOmZ1bmN0aW9uKG4sdCl7cmV0dXJuIEl0KG4uZ2V0U2Vjb25kcygpLHQsMil9LFU6ZnVuY3Rpb24obix0KXtyZXR1cm4gSXQocmMuc3VuZGF5T2ZZZWFyKG4pLHQsMil9LHc6ZnVuY3Rpb24obil7cmV0dXJuIG4uZ2V0RGF5KCl9LFc6ZnVuY3Rpb24obix0KXtyZXR1cm4gSXQocmMubW9uZGF5T2ZZZWFyKG4pLHQsMil9LHg6dChoKSxYOnQoZykseTpmdW5jdGlvbihuLHQpe3JldHVybiBJdChuLmdldEZ1bGxZZWFyKCklMTAwLHQsMil9LFk6ZnVuY3Rpb24obix0KXtyZXR1cm4gSXQobi5nZXRGdWxsWWVhcigpJTFlNCx0LDQpfSxaOmlyLCIlIjpmdW5jdGlvbigpe3JldHVybiIlIn19LE49e2E6ZSxBOnUsYjppLEI6byxjOmEsZDpRdCxlOlF0LEg6dHIsSTp0cixqOm5yLEw6dXIsbTpLdCxNOnJyLHA6bCxTOmVyLFU6JHQsdzpWdCxXOlh0LHg6YyxYOnMseTpKdCxZOkJ0LFo6V3QsIiUiOm9yfTtyZXR1cm4gdH1mdW5jdGlvbiBJdChuLHQscil7dmFyIGU9MD5uPyItIjoiIix1PShlPy1uOm4pKyIiLGk9dS5sZW5ndGg7cmV0dXJuIGUrKHI+aT9uZXcgQXJyYXkoci1pKzEpLmpvaW4odCkrdTp1KX1mdW5jdGlvbiBZdChuKXtyZXR1cm4gbmV3IFJlZ0V4cCgiXig/OiIrbi5tYXAoQm8ucmVxdW90ZSkuam9pbigifCIpKyIpIiwiaSIpfWZ1bmN0aW9uIFp0KG4pe2Zvcih2YXIgdD1uZXcgbyxyPS0xLGU9bi5sZW5ndGg7KytyPGU7KXQuc2V0KG5bcl0udG9Mb3dlckNhc2UoKSxyKTtyZXR1cm4gdH1mdW5jdGlvbiBWdChuLHQscil7b2MubGFzdEluZGV4PTA7dmFyIGU9b2MuZXhlYyh0LnN1YnN0cmluZyhyLHIrMSkpO3JldHVybiBlPyhuLnc9K2VbMF0scitlWzBdLmxlbmd0aCk6LTF9ZnVuY3Rpb24gJHQobix0LHIpe29jLmxhc3RJbmRleD0wO3ZhciBlPW9jLmV4ZWModC5zdWJzdHJpbmcocikpO3JldHVybiBlPyhuLlU9K2VbMF0scitlWzBdLmxlbmd0aCk6LTF9ZnVuY3Rpb24gWHQobix0LHIpe29jLmxhc3RJbmRleD0wO3ZhciBlPW9jLmV4ZWModC5zdWJzdHJpbmcocikpO3JldHVybiBlPyhuLlc9K2VbMF0scitlWzBdLmxlbmd0aCk6LTF9ZnVuY3Rpb24gQnQobix0LHIpe29jLmxhc3RJbmRleD0wO3ZhciBlPW9jLmV4ZWModC5zdWJzdHJpbmcocixyKzQpKTtyZXR1cm4gZT8obi55PStlWzBdLHIrZVswXS5sZW5ndGgpOi0xfWZ1bmN0aW9uIEp0KG4sdCxyKXtvYy5sYXN0SW5kZXg9MDt2YXIgZT1vYy5leGVjKHQuc3Vic3RyaW5nKHIscisyKSk7cmV0dXJuIGU/KG4ueT1HdCgrZVswXSkscitlWzBdLmxlbmd0aCk6LTF9ZnVuY3Rpb24gV3Qobix0LHIpe3JldHVybi9eWystXVxkezR9JC8udGVzdCh0PXQuc3Vic3RyaW5nKHIscis1KSk/KG4uWj0tdCxyKzUpOi0xfWZ1bmN0aW9uIEd0KG4pe3JldHVybiBuKyhuPjY4PzE5MDA6MmUzKX1mdW5jdGlvbiBLdChuLHQscil7b2MubGFzdEluZGV4PTA7dmFyIGU9b2MuZXhlYyh0LnN1YnN0cmluZyhyLHIrMikpO3JldHVybiBlPyhuLm09ZVswXS0xLHIrZVswXS5sZW5ndGgpOi0xfWZ1bmN0aW9uIFF0KG4sdCxyKXtvYy5sYXN0SW5kZXg9MDt2YXIgZT1vYy5leGVjKHQuc3Vic3RyaW5nKHIscisyKSk7cmV0dXJuIGU/KG4uZD0rZVswXSxyK2VbMF0ubGVuZ3RoKTotMX1mdW5jdGlvbiBucihuLHQscil7b2MubGFzdEluZGV4PTA7dmFyIGU9b2MuZXhlYyh0LnN1YnN0cmluZyhyLHIrMykpO3JldHVybiBlPyhuLmo9K2VbMF0scitlWzBdLmxlbmd0aCk6LTF9ZnVuY3Rpb24gdHIobix0LHIpe29jLmxhc3RJbmRleD0wO3ZhciBlPW9jLmV4ZWModC5zdWJzdHJpbmcocixyKzIpKTtyZXR1cm4gZT8obi5IPStlWzBdLHIrZVswXS5sZW5ndGgpOi0xfWZ1bmN0aW9uIHJyKG4sdCxyKXtvYy5sYXN0SW5kZXg9MDt2YXIgZT1vYy5leGVjKHQuc3Vic3RyaW5nKHIscisyKSk7cmV0dXJuIGU/KG4uTT0rZVswXSxyK2VbMF0ubGVuZ3RoKTotMX1mdW5jdGlvbiBlcihuLHQscil7b2MubGFzdEluZGV4PTA7dmFyIGU9b2MuZXhlYyh0LnN1YnN0cmluZyhyLHIrMikpO3JldHVybiBlPyhuLlM9K2VbMF0scitlWzBdLmxlbmd0aCk6LTF9ZnVuY3Rpb24gdXIobix0LHIpe29jLmxhc3RJbmRleD0wO3ZhciBlPW9jLmV4ZWModC5zdWJzdHJpbmcocixyKzMpKTtyZXR1cm4gZT8obi5MPStlWzBdLHIrZVswXS5sZW5ndGgpOi0xfWZ1bmN0aW9uIGlyKG4pe3ZhciB0PW4uZ2V0VGltZXpvbmVPZmZzZXQoKSxyPXQ+MD8iLSI6IisiLGU9fn4oY2EodCkvNjApLHU9Y2EodCklNjA7cmV0dXJuIHIrSXQoZSwiMCIsMikrSXQodSwiMCIsMil9ZnVuY3Rpb24gb3Iobix0LHIpe2FjLmxhc3RJbmRleD0wO3ZhciBlPWFjLmV4ZWModC5zdWJzdHJpbmcocixyKzEpKTtyZXR1cm4gZT9yK2VbMF0ubGVuZ3RoOi0xfWZ1bmN0aW9uIGFyKG4pe2Zvcih2YXIgdD1uLmxlbmd0aCxyPS0xOysrcjx0OyluW3JdWzBdPXRoaXMobltyXVswXSk7cmV0dXJuIGZ1bmN0aW9uKHQpe2Zvcih2YXIgcj0wLGU9bltyXTshZVsxXSh0KTspZT1uWysrcl07cmV0dXJuIGVbMF0odCl9fWZ1bmN0aW9uIGNyKCl7fWZ1bmN0aW9uIHNyKG4sdCxyKXt2YXIgZT1yLnM9bit0LHU9ZS1uLGk9ZS11O3IudD1uLWkrKHQtdSl9ZnVuY3Rpb24gbHIobix0KXtuJiZmYy5oYXNPd25Qcm9wZXJ0eShuLnR5cGUpJiZmY1tuLnR5cGVdKG4sdCl9ZnVuY3Rpb24gZnIobix0LHIpe3ZhciBlLHU9LTEsaT1uLmxlbmd0aC1yO2Zvcih0LmxpbmVTdGFydCgpOysrdTxpOyllPW5bdV0sdC5wb2ludChlWzBdLGVbMV0sZVsyXSk7dC5saW5lRW5kKCl9ZnVuY3Rpb24gaHIobix0KXt2YXIgcj0tMSxlPW4ubGVuZ3RoO2Zvcih0LnBvbHlnb25TdGFydCgpOysrcjxlOylmcihuW3JdLHQsMSk7dC5wb2x5Z29uRW5kKCl9ZnVuY3Rpb24gZ3IoKXtmdW5jdGlvbiBuKG4sdCl7bio9emEsdD10KnphLzIra2EvNDt2YXIgcj1uLWUsbz1yPj0wPzE6LTEsYT1vKnIsYz1NYXRoLmNvcyh0KSxzPU1hdGguc2luKHQpLGw9aSpzLGY9dSpjK2wqTWF0aC5jb3MoYSksaD1sKm8qTWF0aC5zaW4oYSk7Z2MuYWRkKE1hdGguYXRhbjIoaCxmKSksZT1uLHU9YyxpPXN9dmFyIHQscixlLHUsaTtwYy5wb2ludD1mdW5jdGlvbihvLGEpe3BjLnBvaW50PW4sZT0odD1vKSp6YSx1PU1hdGguY29zKGE9KHI9YSkqemEvMitrYS80KSxpPU1hdGguc2luKGEpfSxwYy5saW5lRW5kPWZ1bmN0aW9uKCl7bih0LHIpfX1mdW5jdGlvbiBwcihuKXt2YXIgdD1uWzBdLHI9blsxXSxlPU1hdGguY29zKHIpO3JldHVybltlKk1hdGguY29zKHQpLGUqTWF0aC5zaW4odCksTWF0aC5zaW4ocildfWZ1bmN0aW9uIHZyKG4sdCl7cmV0dXJuIG5bMF0qdFswXStuWzFdKnRbMV0rblsyXSp0WzJdfWZ1bmN0aW9uIGRyKG4sdCl7cmV0dXJuW25bMV0qdFsyXS1uWzJdKnRbMV0sblsyXSp0WzBdLW5bMF0qdFsyXSxuWzBdKnRbMV0tblsxXSp0WzBdXX1mdW5jdGlvbiBtcihuLHQpe25bMF0rPXRbMF0sblsxXSs9dFsxXSxuWzJdKz10WzJdfWZ1bmN0aW9uIHlyKG4sdCl7cmV0dXJuW25bMF0qdCxuWzFdKnQsblsyXSp0XX1mdW5jdGlvbiB4cihuKXt2YXIgdD1NYXRoLnNxcnQoblswXSpuWzBdK25bMV0qblsxXStuWzJdKm5bMl0pO25bMF0vPXQsblsxXS89dCxuWzJdLz10fWZ1bmN0aW9uIE1yKG4pe3JldHVybltNYXRoLmF0YW4yKG5bMV0sblswXSksRyhuWzJdKV19ZnVuY3Rpb24gX3Iobix0KXtyZXR1cm4gY2EoblswXS10WzBdKTxDYSYmY2EoblsxXS10WzFdKTxDYX1mdW5jdGlvbiBicihuLHQpe24qPXphO3ZhciByPU1hdGguY29zKHQqPXphKTt3cihyKk1hdGguY29zKG4pLHIqTWF0aC5zaW4obiksTWF0aC5zaW4odCkpfWZ1bmN0aW9uIHdyKG4sdCxyKXsrK3ZjLG1jKz0obi1tYykvdmMseWMrPSh0LXljKS92Yyx4Yys9KHIteGMpL3ZjfWZ1bmN0aW9uIFNyKCl7ZnVuY3Rpb24gbihuLHUpe24qPXphO3ZhciBpPU1hdGguY29zKHUqPXphKSxvPWkqTWF0aC5jb3MobiksYT1pKk1hdGguc2luKG4pLGM9TWF0aC5zaW4odSkscz1NYXRoLmF0YW4yKE1hdGguc3FydCgocz1yKmMtZSphKSpzKyhzPWUqby10KmMpKnMrKHM9dCphLXIqbykqcyksdCpvK3IqYStlKmMpO2RjKz1zLE1jKz1zKih0Kyh0PW8pKSxfYys9cyoocisocj1hKSksYmMrPXMqKGUrKGU9YykpLHdyKHQscixlKX12YXIgdCxyLGU7RWMucG9pbnQ9ZnVuY3Rpb24odSxpKXt1Kj16YTt2YXIgbz1NYXRoLmNvcyhpKj16YSk7dD1vKk1hdGguY29zKHUpLHI9bypNYXRoLnNpbih1KSxlPU1hdGguc2luKGkpLEVjLnBvaW50PW4sd3IodCxyLGUpfX1mdW5jdGlvbiBrcigpe0VjLnBvaW50PWJyfWZ1bmN0aW9uIEVyKCl7ZnVuY3Rpb24gbihuLHQpe24qPXphO3ZhciByPU1hdGguY29zKHQqPXphKSxvPXIqTWF0aC5jb3MobiksYT1yKk1hdGguc2luKG4pLGM9TWF0aC5zaW4odCkscz11KmMtaSphLGw9aSpvLWUqYyxmPWUqYS11Km8saD1NYXRoLnNxcnQocypzK2wqbCtmKmYpLGc9ZSpvK3UqYStpKmMscD1oJiYtVyhnKS9oLHY9TWF0aC5hdGFuMihoLGcpO3djKz1wKnMsU2MrPXAqbCxrYys9cCpmLGRjKz12LE1jKz12KihlKyhlPW8pKSxfYys9dioodSsodT1hKSksYmMrPXYqKGkrKGk9YykpLHdyKGUsdSxpKX12YXIgdCxyLGUsdSxpO0VjLnBvaW50PWZ1bmN0aW9uKG8sYSl7dD1vLHI9YSxFYy5wb2ludD1uLG8qPXphO3ZhciBjPU1hdGguY29zKGEqPXphKTtlPWMqTWF0aC5jb3MobyksdT1jKk1hdGguc2luKG8pLGk9TWF0aC5zaW4oYSksd3IoZSx1LGkpfSxFYy5saW5lRW5kPWZ1bmN0aW9uKCl7bih0LHIpLEVjLmxpbmVFbmQ9a3IsRWMucG9pbnQ9YnJ9fWZ1bmN0aW9uIEFyKCl7cmV0dXJuITB9ZnVuY3Rpb24gQ3Iobix0LHIsZSx1KXt2YXIgaT1bXSxvPVtdO2lmKG4uZm9yRWFjaChmdW5jdGlvbihuKXtpZighKCh0PW4ubGVuZ3RoLTEpPD0wKSl7dmFyIHQscj1uWzBdLGU9blt0XTtpZihfcihyLGUpKXt1LmxpbmVTdGFydCgpO2Zvcih2YXIgYT0wO3Q+YTsrK2EpdS5wb2ludCgocj1uW2FdKVswXSxyWzFdKTtyZXR1cm4gdS5saW5lRW5kKCksdm9pZCAwfXZhciBjPW5ldyB6cihyLG4sbnVsbCwhMCkscz1uZXcgenIocixudWxsLGMsITEpO2Mubz1zLGkucHVzaChjKSxvLnB1c2gocyksYz1uZXcgenIoZSxuLG51bGwsITEpLHM9bmV3IHpyKGUsbnVsbCxjLCEwKSxjLm89cyxpLnB1c2goYyksby5wdXNoKHMpfX0pLG8uc29ydCh0KSxOcihpKSxOcihvKSxpLmxlbmd0aCl7Zm9yKHZhciBhPTAsYz1yLHM9by5sZW5ndGg7cz5hOysrYSlvW2FdLmU9Yz0hYztmb3IodmFyIGwsZixoPWlbMF07Oyl7Zm9yKHZhciBnPWgscD0hMDtnLnY7KWlmKChnPWcubik9PT1oKXJldHVybjtsPWcueix1LmxpbmVTdGFydCgpO2Rve2lmKGcudj1nLm8udj0hMCxnLmUpe2lmKHApZm9yKHZhciBhPTAscz1sLmxlbmd0aDtzPmE7KythKXUucG9pbnQoKGY9bFthXSlbMF0sZlsxXSk7ZWxzZSBlKGcueCxnLm4ueCwxLHUpO2c9Zy5ufWVsc2V7aWYocCl7bD1nLnAuejtmb3IodmFyIGE9bC5sZW5ndGgtMTthPj0wOy0tYSl1LnBvaW50KChmPWxbYV0pWzBdLGZbMV0pfWVsc2UgZShnLngsZy5wLngsLTEsdSk7Zz1nLnB9Zz1nLm8sbD1nLnoscD0hcH13aGlsZSghZy52KTt1LmxpbmVFbmQoKX19fWZ1bmN0aW9uIE5yKG4pe2lmKHQ9bi5sZW5ndGgpe2Zvcih2YXIgdCxyLGU9MCx1PW5bMF07KytlPHQ7KXUubj1yPW5bZV0sci5wPXUsdT1yO3Uubj1yPW5bMF0sci5wPXV9fWZ1bmN0aW9uIHpyKG4sdCxyLGUpe3RoaXMueD1uLHRoaXMuej10LHRoaXMubz1yLHRoaXMuZT1lLHRoaXMudj0hMSx0aGlzLm49dGhpcy5wPW51bGx9ZnVuY3Rpb24gTHIobix0LHIsZSl7cmV0dXJuIGZ1bmN0aW9uKHUsaSl7ZnVuY3Rpb24gbyh0LHIpe3ZhciBlPXUodCxyKTtuKHQ9ZVswXSxyPWVbMV0pJiZpLnBvaW50KHQscil9ZnVuY3Rpb24gYShuLHQpe3ZhciByPXUobix0KTtkLnBvaW50KHJbMF0sclsxXSl9ZnVuY3Rpb24gYygpe3kucG9pbnQ9YSxkLmxpbmVTdGFydCgpfWZ1bmN0aW9uIHMoKXt5LnBvaW50PW8sZC5saW5lRW5kKCl9ZnVuY3Rpb24gbChuLHQpe3YucHVzaChbbix0XSk7dmFyIHI9dShuLHQpO00ucG9pbnQoclswXSxyWzFdKX1mdW5jdGlvbiBmKCl7TS5saW5lU3RhcnQoKSx2PVtdfWZ1bmN0aW9uIGgoKXtsKHZbMF1bMF0sdlswXVsxXSksTS5saW5lRW5kKCk7dmFyIG4sdD1NLmNsZWFuKCkscj14LmJ1ZmZlcigpLGU9ci5sZW5ndGg7aWYodi5wb3AoKSxwLnB1c2godiksdj1udWxsLGUpaWYoMSZ0KXtuPXJbMF07dmFyIHUsZT1uLmxlbmd0aC0xLG89LTE7aWYoZT4wKXtmb3IoX3x8KGkucG9seWdvblN0YXJ0KCksXz0hMCksaS5saW5lU3RhcnQoKTsrK288ZTspaS5wb2ludCgodT1uW29dKVswXSx1WzFdKTtpLmxpbmVFbmQoKX19ZWxzZSBlPjEmJjImdCYmci5wdXNoKHIucG9wKCkuY29uY2F0KHIuc2hpZnQoKSkpLGcucHVzaChyLmZpbHRlcihUcikpfXZhciBnLHAsdixkPXQoaSksbT11LmludmVydChlWzBdLGVbMV0pLHk9e3BvaW50Om8sbGluZVN0YXJ0OmMsbGluZUVuZDpzLHBvbHlnb25TdGFydDpmdW5jdGlvbigpe3kucG9pbnQ9bCx5LmxpbmVTdGFydD1mLHkubGluZUVuZD1oLGc9W10scD1bXX0scG9seWdvbkVuZDpmdW5jdGlvbigpe3kucG9pbnQ9byx5LmxpbmVTdGFydD1jLHkubGluZUVuZD1zLGc9Qm8ubWVyZ2UoZyk7dmFyIG49RHIobSxwKTtnLmxlbmd0aD8oX3x8KGkucG9seWdvblN0YXJ0KCksXz0hMCksQ3IoZyxScixuLHIsaSkpOm4mJihffHwoaS5wb2x5Z29uU3RhcnQoKSxfPSEwKSxpLmxpbmVTdGFydCgpLHIobnVsbCxudWxsLDEsaSksaS5saW5lRW5kKCkpLF8mJihpLnBvbHlnb25FbmQoKSxfPSExKSxnPXA9bnVsbH0sc3BoZXJlOmZ1bmN0aW9uKCl7aS5wb2x5Z29uU3RhcnQoKSxpLmxpbmVTdGFydCgpLHIobnVsbCxudWxsLDEsaSksaS5saW5lRW5kKCksaS5wb2x5Z29uRW5kKCl9fSx4PXFyKCksTT10KHgpLF89ITE7cmV0dXJuIHl9fWZ1bmN0aW9uIFRyKG4pe3JldHVybiBuLmxlbmd0aD4xfWZ1bmN0aW9uIHFyKCl7dmFyIG4sdD1bXTtyZXR1cm57bGluZVN0YXJ0OmZ1bmN0aW9uKCl7dC5wdXNoKG49W10pfSxwb2ludDpmdW5jdGlvbih0LHIpe24ucHVzaChbdCxyXSl9LGxpbmVFbmQ6dixidWZmZXI6ZnVuY3Rpb24oKXt2YXIgcj10O3JldHVybiB0PVtdLG49bnVsbCxyfSxyZWpvaW46ZnVuY3Rpb24oKXt0Lmxlbmd0aD4xJiZ0LnB1c2godC5wb3AoKS5jb25jYXQodC5zaGlmdCgpKSl9fX1mdW5jdGlvbiBScihuLHQpe3JldHVybigobj1uLngpWzBdPDA/blsxXS1BYS1DYTpBYS1uWzFdKS0oKHQ9dC54KVswXTwwP3RbMV0tQWEtQ2E6QWEtdFsxXSl9ZnVuY3Rpb24gRHIobix0KXt2YXIgcj1uWzBdLGU9blsxXSx1PVtNYXRoLnNpbihyKSwtTWF0aC5jb3MociksMF0saT0wLG89MDtnYy5yZXNldCgpO2Zvcih2YXIgYT0wLGM9dC5sZW5ndGg7Yz5hOysrYSl7dmFyIHM9dFthXSxsPXMubGVuZ3RoO2lmKGwpZm9yKHZhciBmPXNbMF0saD1mWzBdLGc9ZlsxXS8yK2thLzQscD1NYXRoLnNpbihnKSx2PU1hdGguY29zKGcpLGQ9MTs7KXtkPT09bCYmKGQ9MCksbj1zW2RdO3ZhciBtPW5bMF0seT1uWzFdLzIra2EvNCx4PU1hdGguc2luKHkpLE09TWF0aC5jb3MoeSksXz1tLWgsYj1fPj0wPzE6LTEsdz1iKl8sUz13PmthLGs9cCp4O2lmKGdjLmFkZChNYXRoLmF0YW4yKGsqYipNYXRoLnNpbih3KSx2Kk0raypNYXRoLmNvcyh3KSkpLGkrPVM/XytiKkVhOl8sU15oPj1yXm0+PXIpe3ZhciBFPWRyKHByKGYpLHByKG4pKTt4cihFKTt2YXIgQT1kcih1LEUpO3hyKEEpO3ZhciBDPShTXl8+PTA/LTE6MSkqRyhBWzJdKTsoZT5DfHxlPT09QyYmKEVbMF18fEVbMV0pKSYmKG8rPVNeXz49MD8xOi0xKX1pZighZCsrKWJyZWFrO2g9bSxwPXgsdj1NLGY9bn19cmV0dXJuKC1DYT5pfHxDYT5pJiYwPmdjKV4xJm99ZnVuY3Rpb24gUHIobil7dmFyIHQscj0wLzAsZT0wLzAsdT0wLzA7cmV0dXJue2xpbmVTdGFydDpmdW5jdGlvbigpe24ubGluZVN0YXJ0KCksdD0xfSxwb2ludDpmdW5jdGlvbihpLG8pe3ZhciBhPWk+MD9rYTota2EsYz1jYShpLXIpO2NhKGMta2EpPENhPyhuLnBvaW50KHIsZT0oZStvKS8yPjA/QWE6LUFhKSxuLnBvaW50KHUsZSksbi5saW5lRW5kKCksbi5saW5lU3RhcnQoKSxuLnBvaW50KGEsZSksbi5wb2ludChpLGUpLHQ9MCk6dSE9PWEmJmM+PWthJiYoY2Eoci11KTxDYSYmKHItPXUqQ2EpLGNhKGktYSk8Q2EmJihpLT1hKkNhKSxlPVVyKHIsZSxpLG8pLG4ucG9pbnQodSxlKSxuLmxpbmVFbmQoKSxuLmxpbmVTdGFydCgpLG4ucG9pbnQoYSxlKSx0PTApLG4ucG9pbnQocj1pLGU9byksdT1hfSxsaW5lRW5kOmZ1bmN0aW9uKCl7bi5saW5lRW5kKCkscj1lPTAvMH0sY2xlYW46ZnVuY3Rpb24oKXtyZXR1cm4gMi10fX19ZnVuY3Rpb24gVXIobix0LHIsZSl7dmFyIHUsaSxvPU1hdGguc2luKG4tcik7cmV0dXJuIGNhKG8pPkNhP01hdGguYXRhbigoTWF0aC5zaW4odCkqKGk9TWF0aC5jb3MoZSkpKk1hdGguc2luKHIpLU1hdGguc2luKGUpKih1PU1hdGguY29zKHQpKSpNYXRoLnNpbihuKSkvKHUqaSpvKSk6KHQrZSkvMn1mdW5jdGlvbiBqcihuLHQscixlKXt2YXIgdTtpZihudWxsPT1uKXU9cipBYSxlLnBvaW50KC1rYSx1KSxlLnBvaW50KDAsdSksZS5wb2ludChrYSx1KSxlLnBvaW50KGthLDApLGUucG9pbnQoa2EsLXUpLGUucG9pbnQoMCwtdSksZS5wb2ludCgta2EsLXUpLGUucG9pbnQoLWthLDApLGUucG9pbnQoLWthLHUpO2Vsc2UgaWYoY2EoblswXS10WzBdKT5DYSl7dmFyIGk9blswXTx0WzBdP2thOi1rYTt1PXIqaS8yLGUucG9pbnQoLWksdSksZS5wb2ludCgwLHUpLGUucG9pbnQoaSx1KX1lbHNlIGUucG9pbnQodFswXSx0WzFdKX1mdW5jdGlvbiBIcihuKXtmdW5jdGlvbiB0KG4sdCl7cmV0dXJuIE1hdGguY29zKG4pKk1hdGguY29zKHQpPml9ZnVuY3Rpb24gcihuKXt2YXIgcixpLGMscyxsO3JldHVybntsaW5lU3RhcnQ6ZnVuY3Rpb24oKXtzPWM9ITEsbD0xfSxwb2ludDpmdW5jdGlvbihmLGgpe3ZhciBnLHA9W2YsaF0sdj10KGYsaCksZD1vP3Y/MDp1KGYsaCk6dj91KGYrKDA+Zj9rYTota2EpLGgpOjA7aWYoIXImJihzPWM9dikmJm4ubGluZVN0YXJ0KCksdiE9PWMmJihnPWUocixwKSwoX3IocixnKXx8X3IocCxnKSkmJihwWzBdKz1DYSxwWzFdKz1DYSx2PXQocFswXSxwWzFdKSkpLHYhPT1jKWw9MCx2PyhuLmxpbmVTdGFydCgpLGc9ZShwLHIpLG4ucG9pbnQoZ1swXSxnWzFdKSk6KGc9ZShyLHApLG4ucG9pbnQoZ1swXSxnWzFdKSxuLmxpbmVFbmQoKSkscj1nO2Vsc2UgaWYoYSYmciYmb152KXt2YXIgbTtkJml8fCEobT1lKHAsciwhMCkpfHwobD0wLG8/KG4ubGluZVN0YXJ0KCksbi5wb2ludChtWzBdWzBdLG1bMF1bMV0pLG4ucG9pbnQobVsxXVswXSxtWzFdWzFdKSxuLmxpbmVFbmQoKSk6KG4ucG9pbnQobVsxXVswXSxtWzFdWzFdKSxuLmxpbmVFbmQoKSxuLmxpbmVTdGFydCgpLG4ucG9pbnQobVswXVswXSxtWzBdWzFdKSkpfSF2fHxyJiZfcihyLHApfHxuLnBvaW50KHBbMF0scFsxXSkscj1wLGM9dixpPWR9LGxpbmVFbmQ6ZnVuY3Rpb24oKXtjJiZuLmxpbmVFbmQoKSxyPW51bGx9LGNsZWFuOmZ1bmN0aW9uKCl7cmV0dXJuIGx8KHMmJmMpPDwxfX19ZnVuY3Rpb24gZShuLHQscil7dmFyIGU9cHIobiksdT1wcih0KSxvPVsxLDAsMF0sYT1kcihlLHUpLGM9dnIoYSxhKSxzPWFbMF0sbD1jLXMqcztpZighbClyZXR1cm4hciYmbjt2YXIgZj1pKmMvbCxoPS1pKnMvbCxnPWRyKG8sYSkscD15cihvLGYpLHY9eXIoYSxoKTttcihwLHYpO3ZhciBkPWcsbT12cihwLGQpLHk9dnIoZCxkKSx4PW0qbS15Kih2cihwLHApLTEpO2lmKCEoMD54KSl7dmFyIE09TWF0aC5zcXJ0KHgpLF89eXIoZCwoLW0tTSkveSk7aWYobXIoXyxwKSxfPU1yKF8pLCFyKXJldHVybiBfO3ZhciBiLHc9blswXSxTPXRbMF0saz1uWzFdLEU9dFsxXTt3PlMmJihiPXcsdz1TLFM9Yik7dmFyIEE9Uy13LEM9Y2EoQS1rYSk8Q2EsTj1DfHxDYT5BO2lmKCFDJiZrPkUmJihiPWssaz1FLEU9YiksTj9DP2srRT4wXl9bMV08KGNhKF9bMF0tdyk8Q2E/azpFKTprPD1fWzFdJiZfWzFdPD1FOkE+a2FeKHc8PV9bMF0mJl9bMF08PVMpKXt2YXIgej15cihkLCgtbStNKS95KTtyZXR1cm4gbXIoeixwKSxbXyxNcih6KV19fX1mdW5jdGlvbiB1KHQscil7dmFyIGU9bz9uOmthLW4sdT0wO3JldHVybi1lPnQ/dXw9MTp0PmUmJih1fD0yKSwtZT5yP3V8PTQ6cj5lJiYodXw9OCksdX12YXIgaT1NYXRoLmNvcyhuKSxvPWk+MCxhPWNhKGkpPkNhLGM9Z2Uobiw2KnphKTtyZXR1cm4gTHIodCxyLGMsbz9bMCwtbl06Wy1rYSxuLWthXSl9ZnVuY3Rpb24gRnIobix0LHIsZSl7cmV0dXJuIGZ1bmN0aW9uKHUpe3ZhciBpLG89dS5hLGE9dS5iLGM9by54LHM9by55LGw9YS54LGY9YS55LGg9MCxnPTEscD1sLWMsdj1mLXM7aWYoaT1uLWMscHx8IShpPjApKXtpZihpLz1wLDA+cCl7aWYoaD5pKXJldHVybjtnPmkmJihnPWkpfWVsc2UgaWYocD4wKXtpZihpPmcpcmV0dXJuO2k+aCYmKGg9aSl9aWYoaT1yLWMscHx8ISgwPmkpKXtpZihpLz1wLDA+cCl7aWYoaT5nKXJldHVybjtpPmgmJihoPWkpfWVsc2UgaWYocD4wKXtpZihoPmkpcmV0dXJuO2c+aSYmKGc9aSl9aWYoaT10LXMsdnx8IShpPjApKXtpZihpLz12LDA+dil7aWYoaD5pKXJldHVybjtnPmkmJihnPWkpfWVsc2UgaWYodj4wKXtpZihpPmcpcmV0dXJuO2k+aCYmKGg9aSl9aWYoaT1lLXMsdnx8ISgwPmkpKXtpZihpLz12LDA+dil7aWYoaT5nKXJldHVybjtpPmgmJihoPWkpfWVsc2UgaWYodj4wKXtpZihoPmkpcmV0dXJuO2c+aSYmKGc9aSl9cmV0dXJuIGg+MCYmKHUuYT17eDpjK2gqcCx5OnMraCp2fSksMT5nJiYodS5iPXt4OmMrZypwLHk6cytnKnZ9KSx1fX19fX19ZnVuY3Rpb24gT3Iobix0LHIsZSl7ZnVuY3Rpb24gdShlLHUpe3JldHVybiBjYShlWzBdLW4pPENhP3U+MD8wOjM6Y2EoZVswXS1yKTxDYT91PjA/MjoxOmNhKGVbMV0tdCk8Q2E/dT4wPzE6MDp1PjA/MzoyfWZ1bmN0aW9uIGkobix0KXtyZXR1cm4gbyhuLngsdC54KX1mdW5jdGlvbiBvKG4sdCl7dmFyIHI9dShuLDEpLGU9dSh0LDEpO3JldHVybiByIT09ZT9yLWU6MD09PXI/dFsxXS1uWzFdOjE9PT1yP25bMF0tdFswXToyPT09cj9uWzFdLXRbMV06dFswXS1uWzBdfXJldHVybiBmdW5jdGlvbihhKXtmdW5jdGlvbiBjKG4pe2Zvcih2YXIgdD0wLHI9ZC5sZW5ndGgsZT1uWzFdLHU9MDtyPnU7Kyt1KWZvcih2YXIgaSxvPTEsYT1kW3VdLGM9YS5sZW5ndGgscz1hWzBdO2M+bzsrK28paT1hW29dLHNbMV08PWU/aVsxXT5lJiZKKHMsaSxuKT4wJiYrK3Q6aVsxXTw9ZSYmSihzLGksbik8MCYmLS10LHM9aTtyZXR1cm4gMCE9PXR9ZnVuY3Rpb24gcyhpLGEsYyxzKXt2YXIgbD0wLGY9MDtpZihudWxsPT1pfHwobD11KGksYykpIT09KGY9dShhLGMpKXx8byhpLGEpPDBeYz4wKXtkbyBzLnBvaW50KDA9PT1sfHwzPT09bD9uOnIsbD4xP2U6dCk7d2hpbGUoKGw9KGwrYys0KSU0KSE9PWYpfWVsc2Ugcy5wb2ludChhWzBdLGFbMV0pfWZ1bmN0aW9uIGwodSxpKXtyZXR1cm4gdT49biYmcj49dSYmaT49dCYmZT49aX1mdW5jdGlvbiBmKG4sdCl7bChuLHQpJiZhLnBvaW50KG4sdCl9ZnVuY3Rpb24gaCgpe04ucG9pbnQ9cCxkJiZkLnB1c2gobT1bXSksUz0hMCx3PSExLF89Yj0wLzB9ZnVuY3Rpb24gZygpe3YmJihwKHkseCksTSYmdyYmQS5yZWpvaW4oKSx2LnB1c2goQS5idWZmZXIoKSkpLE4ucG9pbnQ9Zix3JiZhLmxpbmVFbmQoKX1mdW5jdGlvbiBwKG4sdCl7bj1NYXRoLm1heCgtQ2MsTWF0aC5taW4oQ2MsbikpLHQ9TWF0aC5tYXgoLUNjLE1hdGgubWluKENjLHQpKTt2YXIgcj1sKG4sdCk7aWYoZCYmbS5wdXNoKFtuLHRdKSxTKXk9bix4PXQsTT1yLFM9ITEsciYmKGEubGluZVN0YXJ0KCksYS5wb2ludChuLHQpKTtlbHNlIGlmKHImJncpYS5wb2ludChuLHQpO2Vsc2V7dmFyIGU9e2E6e3g6Xyx5OmJ9LGI6e3g6bix5OnR9fTtDKGUpPyh3fHwoYS5saW5lU3RhcnQoKSxhLnBvaW50KGUuYS54LGUuYS55KSksYS5wb2ludChlLmIueCxlLmIueSkscnx8YS5saW5lRW5kKCksaz0hMSk6ciYmKGEubGluZVN0YXJ0KCksYS5wb2ludChuLHQpLGs9ITEpfV89bixiPXQsdz1yfXZhciB2LGQsbSx5LHgsTSxfLGIsdyxTLGssRT1hLEE9cXIoKSxDPUZyKG4sdCxyLGUpLE49e3BvaW50OmYsbGluZVN0YXJ0OmgsbGluZUVuZDpnLHBvbHlnb25TdGFydDpmdW5jdGlvbigpe2E9QSx2PVtdLGQ9W10saz0hMH0scG9seWdvbkVuZDpmdW5jdGlvbigpe2E9RSx2PUJvLm1lcmdlKHYpO3ZhciB0PWMoW24sZV0pLHI9ayYmdCx1PXYubGVuZ3RoOyhyfHx1KSYmKGEucG9seWdvblN0YXJ0KCksciYmKGEubGluZVN0YXJ0KCkscyhudWxsLG51bGwsMSxhKSxhLmxpbmVFbmQoKSksdSYmQ3IodixpLHQscyxhKSxhLnBvbHlnb25FbmQoKSksdj1kPW09bnVsbH19O3JldHVybiBOfX1mdW5jdGlvbiBJcihuLHQpe2Z1bmN0aW9uIHIocixlKXtyZXR1cm4gcj1uKHIsZSksdChyWzBdLHJbMV0pfXJldHVybiBuLmludmVydCYmdC5pbnZlcnQmJihyLmludmVydD1mdW5jdGlvbihyLGUpe3JldHVybiByPXQuaW52ZXJ0KHIsZSksciYmbi5pbnZlcnQoclswXSxyWzFdKX0pLHJ9ZnVuY3Rpb24gWXIobil7dmFyIHQ9MCxyPWthLzMsZT1pZShuKSx1PWUodCxyKTtyZXR1cm4gdS5wYXJhbGxlbHM9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/ZSh0PW5bMF0qa2EvMTgwLHI9blsxXSprYS8xODApOlsxODAqKHQva2EpLDE4MCooci9rYSldfSx1fWZ1bmN0aW9uIFpyKG4sdCl7ZnVuY3Rpb24gcihuLHQpe3ZhciByPU1hdGguc3FydChpLTIqdSpNYXRoLnNpbih0KSkvdTtyZXR1cm5bcipNYXRoLnNpbihuKj11KSxvLXIqTWF0aC5jb3MobildfXZhciBlPU1hdGguc2luKG4pLHU9KGUrTWF0aC5zaW4odCkpLzIsaT0xK2UqKDIqdS1lKSxvPU1hdGguc3FydChpKS91O3JldHVybiByLmludmVydD1mdW5jdGlvbihuLHQpe3ZhciByPW8tdDtyZXR1cm5bTWF0aC5hdGFuMihuLHIpL3UsRygoaS0obipuK3IqcikqdSp1KS8oMip1KSldfSxyfWZ1bmN0aW9uIFZyKCl7ZnVuY3Rpb24gbihuLHQpe3pjKz11Km4tZSp0LGU9bix1PXR9dmFyIHQscixlLHU7RGMucG9pbnQ9ZnVuY3Rpb24oaSxvKXtEYy5wb2ludD1uLHQ9ZT1pLHI9dT1vfSxEYy5saW5lRW5kPWZ1bmN0aW9uKCl7bih0LHIpfX1mdW5jdGlvbiAkcihuLHQpe0xjPm4mJihMYz1uKSxuPnFjJiYocWM9biksVGM+dCYmKFRjPXQpLHQ+UmMmJihSYz10KX1mdW5jdGlvbiBYcigpe2Z1bmN0aW9uIG4obix0KXtvLnB1c2goIk0iLG4sIiwiLHQsaSl9ZnVuY3Rpb24gdChuLHQpe28ucHVzaCgiTSIsbiwiLCIsdCksYS5wb2ludD1yfWZ1bmN0aW9uIHIobix0KXtvLnB1c2goIkwiLG4sIiwiLHQpfWZ1bmN0aW9uIGUoKXthLnBvaW50PW59ZnVuY3Rpb24gdSgpe28ucHVzaCgiWiIpfXZhciBpPUJyKDQuNSksbz1bXSxhPXtwb2ludDpuLGxpbmVTdGFydDpmdW5jdGlvbigpe2EucG9pbnQ9dH0sbGluZUVuZDplLHBvbHlnb25TdGFydDpmdW5jdGlvbigpe2EubGluZUVuZD11fSxwb2x5Z29uRW5kOmZ1bmN0aW9uKCl7YS5saW5lRW5kPWUsYS5wb2ludD1ufSxwb2ludFJhZGl1czpmdW5jdGlvbihuKXtyZXR1cm4gaT1CcihuKSxhfSxyZXN1bHQ6ZnVuY3Rpb24oKXtpZihvLmxlbmd0aCl7dmFyIG49by5qb2luKCIiKTtyZXR1cm4gbz1bXSxufX19O3JldHVybiBhfWZ1bmN0aW9uIEJyKG4pe3JldHVybiJtMCwiK24rImEiK24rIiwiK24rIiAwIDEsMSAwLCIrLTIqbisiYSIrbisiLCIrbisiIDAgMSwxIDAsIisyKm4rInoifWZ1bmN0aW9uIEpyKG4sdCl7bWMrPW4seWMrPXQsKyt4Y31mdW5jdGlvbiBXcigpe2Z1bmN0aW9uIG4obixlKXt2YXIgdT1uLXQsaT1lLXIsbz1NYXRoLnNxcnQodSp1K2kqaSk7TWMrPW8qKHQrbikvMixfYys9byoocitlKS8yLGJjKz1vLEpyKHQ9bixyPWUpfXZhciB0LHI7VWMucG9pbnQ9ZnVuY3Rpb24oZSx1KXtVYy5wb2ludD1uLEpyKHQ9ZSxyPXUpfX1mdW5jdGlvbiBHcigpe1VjLnBvaW50PUpyfWZ1bmN0aW9uIEtyKCl7ZnVuY3Rpb24gbihuLHQpe3ZhciByPW4tZSxpPXQtdSxvPU1hdGguc3FydChyKnIraSppKTtNYys9byooZStuKS8yLF9jKz1vKih1K3QpLzIsYmMrPW8sbz11Km4tZSp0LHdjKz1vKihlK24pLFNjKz1vKih1K3QpLGtjKz0zKm8sSnIoZT1uLHU9dCl9dmFyIHQscixlLHU7VWMucG9pbnQ9ZnVuY3Rpb24oaSxvKXtVYy5wb2ludD1uLEpyKHQ9ZT1pLHI9dT1vKX0sVWMubGluZUVuZD1mdW5jdGlvbigpe24odCxyKX19ZnVuY3Rpb24gUXIobil7ZnVuY3Rpb24gdCh0LHIpe24ubW92ZVRvKHQsciksbi5hcmModCxyLG8sMCxFYSl9ZnVuY3Rpb24gcih0LHIpe24ubW92ZVRvKHQsciksYS5wb2ludD1lfWZ1bmN0aW9uIGUodCxyKXtuLmxpbmVUbyh0LHIpfWZ1bmN0aW9uIHUoKXthLnBvaW50PXR9ZnVuY3Rpb24gaSgpe24uY2xvc2VQYXRoKCl9dmFyIG89NC41LGE9e3BvaW50OnQsbGluZVN0YXJ0OmZ1bmN0aW9uKCl7YS5wb2ludD1yfSxsaW5lRW5kOnUscG9seWdvblN0YXJ0OmZ1bmN0aW9uKCl7YS5saW5lRW5kPWl9LHBvbHlnb25FbmQ6ZnVuY3Rpb24oKXthLmxpbmVFbmQ9dSxhLnBvaW50PXR9LHBvaW50UmFkaXVzOmZ1bmN0aW9uKG4pe3JldHVybiBvPW4sYX0scmVzdWx0OnZ9O3JldHVybiBhfWZ1bmN0aW9uIG5lKG4pe2Z1bmN0aW9uIHQobil7cmV0dXJuKGE/ZTpyKShuKX1mdW5jdGlvbiByKHQpe3JldHVybiBlZSh0LGZ1bmN0aW9uKHIsZSl7cj1uKHIsZSksdC5wb2ludChyWzBdLHJbMV0pfSl9ZnVuY3Rpb24gZSh0KXtmdW5jdGlvbiByKHIsZSl7cj1uKHIsZSksdC5wb2ludChyWzBdLHJbMV0pfWZ1bmN0aW9uIGUoKXt4PTAvMCxTLnBvaW50PWksdC5saW5lU3RhcnQoKX1mdW5jdGlvbiBpKHIsZSl7dmFyIGk9cHIoW3IsZV0pLG89bihyLGUpO3UoeCxNLHksXyxiLHcseD1vWzBdLE09b1sxXSx5PXIsXz1pWzBdLGI9aVsxXSx3PWlbMl0sYSx0KSx0LnBvaW50KHgsTSl9ZnVuY3Rpb24gbygpe1MucG9pbnQ9cix0LmxpbmVFbmQoKX1mdW5jdGlvbiBjKCl7ZSgpLFMucG9pbnQ9cyxTLmxpbmVFbmQ9bH1mdW5jdGlvbiBzKG4sdCl7aShmPW4saD10KSxnPXgscD1NLHY9XyxkPWIsbT13LFMucG9pbnQ9aX1mdW5jdGlvbiBsKCl7dSh4LE0seSxfLGIsdyxnLHAsZix2LGQsbSxhLHQpLFMubGluZUVuZD1vLG8oKX12YXIgZixoLGcscCx2LGQsbSx5LHgsTSxfLGIsdyxTPXtwb2ludDpyLGxpbmVTdGFydDplLGxpbmVFbmQ6byxwb2x5Z29uU3RhcnQ6ZnVuY3Rpb24oKXt0LnBvbHlnb25TdGFydCgpLFMubGluZVN0YXJ0PWN9LHBvbHlnb25FbmQ6ZnVuY3Rpb24oKXt0LnBvbHlnb25FbmQoKSxTLmxpbmVTdGFydD1lfX07cmV0dXJuIFN9ZnVuY3Rpb24gdSh0LHIsZSxhLGMscyxsLGYsaCxnLHAsdixkLG0pe3ZhciB5PWwtdCx4PWYtcixNPXkqeSt4Kng7aWYoTT40KmkmJmQtLSl7dmFyIF89YStnLGI9YytwLHc9cyt2LFM9TWF0aC5zcXJ0KF8qXytiKmIrdyp3KSxrPU1hdGguYXNpbih3Lz1TKSxFPWNhKGNhKHcpLTEpPENhfHxjYShlLWgpPENhPyhlK2gpLzI6TWF0aC5hdGFuMihiLF8pLEE9bihFLGspLEM9QVswXSxOPUFbMV0sej1DLXQsTD1OLXIsVD14KnoteSpMOyhUKlQvTT5pfHxjYSgoeSp6K3gqTCkvTS0uNSk+LjN8fG8+YSpnK2MqcCtzKnYpJiYodSh0LHIsZSxhLGMscyxDLE4sRSxfLz1TLGIvPVMsdyxkLG0pLG0ucG9pbnQoQyxOKSx1KEMsTixFLF8sYix3LGwsZixoLGcscCx2LGQsbSkpfX12YXIgaT0uNSxvPU1hdGguY29zKDMwKnphKSxhPTE2O3JldHVybiB0LnByZWNpc2lvbj1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oYT0oaT1uKm4pPjAmJjE2LHQpOk1hdGguc3FydChpKX0sdH1mdW5jdGlvbiB0ZShuKXt2YXIgdD1uZShmdW5jdGlvbih0LHIpe3JldHVybiBuKFt0KkxhLHIqTGFdKX0pO3JldHVybiBmdW5jdGlvbihuKXtyZXR1cm4gb2UodChuKSl9fWZ1bmN0aW9uIHJlKG4pe3RoaXMuc3RyZWFtPW59ZnVuY3Rpb24gZWUobix0KXtyZXR1cm57cG9pbnQ6dCxzcGhlcmU6ZnVuY3Rpb24oKXtuLnNwaGVyZSgpfSxsaW5lU3RhcnQ6ZnVuY3Rpb24oKXtuLmxpbmVTdGFydCgpfSxsaW5lRW5kOmZ1bmN0aW9uKCl7bi5saW5lRW5kKCl9LHBvbHlnb25TdGFydDpmdW5jdGlvbigpe24ucG9seWdvblN0YXJ0KCl9LHBvbHlnb25FbmQ6ZnVuY3Rpb24oKXtuLnBvbHlnb25FbmQoKX19fWZ1bmN0aW9uIHVlKG4pe3JldHVybiBpZShmdW5jdGlvbigpe3JldHVybiBufSkoKX1mdW5jdGlvbiBpZShuKXtmdW5jdGlvbiB0KG4pe3JldHVybiBuPWEoblswXSp6YSxuWzFdKnphKSxbblswXSpoK2Mscy1uWzFdKmhdfWZ1bmN0aW9uIHIobil7cmV0dXJuIG49YS5pbnZlcnQoKG5bMF0tYykvaCwocy1uWzFdKS9oKSxuJiZbblswXSpMYSxuWzFdKkxhXX1mdW5jdGlvbiBlKCl7YT1JcihvPXNlKG0seSx4KSxpKTt2YXIgbj1pKHYsZCk7cmV0dXJuIGM9Zy1uWzBdKmgscz1wK25bMV0qaCx1KCkKfWZ1bmN0aW9uIHUoKXtyZXR1cm4gbCYmKGwudmFsaWQ9ITEsbD1udWxsKSx0fXZhciBpLG8sYSxjLHMsbCxmPW5lKGZ1bmN0aW9uKG4sdCl7cmV0dXJuIG49aShuLHQpLFtuWzBdKmgrYyxzLW5bMV0qaF19KSxoPTE1MCxnPTQ4MCxwPTI1MCx2PTAsZD0wLG09MCx5PTAseD0wLE09QWMsXz1BdCxiPW51bGwsdz1udWxsO3JldHVybiB0LnN0cmVhbT1mdW5jdGlvbihuKXtyZXR1cm4gbCYmKGwudmFsaWQ9ITEpLGw9b2UoTShvLGYoXyhuKSkpKSxsLnZhbGlkPSEwLGx9LHQuY2xpcEFuZ2xlPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhNPW51bGw9PW4/KGI9bixBYyk6SHIoKGI9K24pKnphKSx1KCkpOmJ9LHQuY2xpcEV4dGVudD1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8odz1uLF89bj9PcihuWzBdWzBdLG5bMF1bMV0sblsxXVswXSxuWzFdWzFdKTpBdCx1KCkpOnd9LHQuc2NhbGU9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGg9K24sZSgpKTpofSx0LnRyYW5zbGF0ZT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oZz0rblswXSxwPStuWzFdLGUoKSk6W2cscF19LHQuY2VudGVyPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh2PW5bMF0lMzYwKnphLGQ9blsxXSUzNjAqemEsZSgpKTpbdipMYSxkKkxhXX0sdC5yb3RhdGU9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KG09blswXSUzNjAqemEseT1uWzFdJTM2MCp6YSx4PW4ubGVuZ3RoPjI/blsyXSUzNjAqemE6MCxlKCkpOlttKkxhLHkqTGEseCpMYV19LEJvLnJlYmluZCh0LGYsInByZWNpc2lvbiIpLGZ1bmN0aW9uKCl7cmV0dXJuIGk9bi5hcHBseSh0aGlzLGFyZ3VtZW50cyksdC5pbnZlcnQ9aS5pbnZlcnQmJnIsZSgpfX1mdW5jdGlvbiBvZShuKXtyZXR1cm4gZWUobixmdW5jdGlvbih0LHIpe24ucG9pbnQodCp6YSxyKnphKX0pfWZ1bmN0aW9uIGFlKG4sdCl7cmV0dXJuW24sdF19ZnVuY3Rpb24gY2Uobix0KXtyZXR1cm5bbj5rYT9uLUVhOi1rYT5uP24rRWE6bix0XX1mdW5jdGlvbiBzZShuLHQscil7cmV0dXJuIG4/dHx8cj9JcihmZShuKSxoZSh0LHIpKTpmZShuKTp0fHxyP2hlKHQscik6Y2V9ZnVuY3Rpb24gbGUobil7cmV0dXJuIGZ1bmN0aW9uKHQscil7cmV0dXJuIHQrPW4sW3Q+a2E/dC1FYTota2E+dD90K0VhOnQscl19fWZ1bmN0aW9uIGZlKG4pe3ZhciB0PWxlKG4pO3JldHVybiB0LmludmVydD1sZSgtbiksdH1mdW5jdGlvbiBoZShuLHQpe2Z1bmN0aW9uIHIobix0KXt2YXIgcj1NYXRoLmNvcyh0KSxhPU1hdGguY29zKG4pKnIsYz1NYXRoLnNpbihuKSpyLHM9TWF0aC5zaW4odCksbD1zKmUrYSp1O3JldHVybltNYXRoLmF0YW4yKGMqaS1sKm8sYSplLXMqdSksRyhsKmkrYypvKV19dmFyIGU9TWF0aC5jb3MobiksdT1NYXRoLnNpbihuKSxpPU1hdGguY29zKHQpLG89TWF0aC5zaW4odCk7cmV0dXJuIHIuaW52ZXJ0PWZ1bmN0aW9uKG4sdCl7dmFyIHI9TWF0aC5jb3ModCksYT1NYXRoLmNvcyhuKSpyLGM9TWF0aC5zaW4obikqcixzPU1hdGguc2luKHQpLGw9cyppLWMqbztyZXR1cm5bTWF0aC5hdGFuMihjKmkrcypvLGEqZStsKnUpLEcobCplLWEqdSldfSxyfWZ1bmN0aW9uIGdlKG4sdCl7dmFyIHI9TWF0aC5jb3MobiksZT1NYXRoLnNpbihuKTtyZXR1cm4gZnVuY3Rpb24odSxpLG8sYSl7dmFyIGM9byp0O251bGwhPXU/KHU9cGUocix1KSxpPXBlKHIsaSksKG8+MD9pPnU6dT5pKSYmKHUrPW8qRWEpKToodT1uK28qRWEsaT1uLS41KmMpO2Zvcih2YXIgcyxsPXU7bz4wP2w+aTppPmw7bC09YylhLnBvaW50KChzPU1yKFtyLC1lKk1hdGguY29zKGwpLC1lKk1hdGguc2luKGwpXSkpWzBdLHNbMV0pfX1mdW5jdGlvbiBwZShuLHQpe3ZhciByPXByKHQpO3JbMF0tPW4seHIocik7dmFyIGU9VygtclsxXSk7cmV0dXJuKCgtclsyXTwwPy1lOmUpKzIqTWF0aC5QSS1DYSklKDIqTWF0aC5QSSl9ZnVuY3Rpb24gdmUobix0LHIpe3ZhciBlPUJvLnJhbmdlKG4sdC1DYSxyKS5jb25jYXQodCk7cmV0dXJuIGZ1bmN0aW9uKG4pe3JldHVybiBlLm1hcChmdW5jdGlvbih0KXtyZXR1cm5bbix0XX0pfX1mdW5jdGlvbiBkZShuLHQscil7dmFyIGU9Qm8ucmFuZ2Uobix0LUNhLHIpLmNvbmNhdCh0KTtyZXR1cm4gZnVuY3Rpb24obil7cmV0dXJuIGUubWFwKGZ1bmN0aW9uKHQpe3JldHVyblt0LG5dfSl9fWZ1bmN0aW9uIG1lKG4pe3JldHVybiBuLnNvdXJjZX1mdW5jdGlvbiB5ZShuKXtyZXR1cm4gbi50YXJnZXR9ZnVuY3Rpb24geGUobix0LHIsZSl7dmFyIHU9TWF0aC5jb3ModCksaT1NYXRoLnNpbih0KSxvPU1hdGguY29zKGUpLGE9TWF0aC5zaW4oZSksYz11Kk1hdGguY29zKG4pLHM9dSpNYXRoLnNpbihuKSxsPW8qTWF0aC5jb3MociksZj1vKk1hdGguc2luKHIpLGg9MipNYXRoLmFzaW4oTWF0aC5zcXJ0KHR0KGUtdCkrdSpvKnR0KHItbikpKSxnPTEvTWF0aC5zaW4oaCkscD1oP2Z1bmN0aW9uKG4pe3ZhciB0PU1hdGguc2luKG4qPWgpKmcscj1NYXRoLnNpbihoLW4pKmcsZT1yKmMrdCpsLHU9cipzK3QqZixvPXIqaSt0KmE7cmV0dXJuW01hdGguYXRhbjIodSxlKSpMYSxNYXRoLmF0YW4yKG8sTWF0aC5zcXJ0KGUqZSt1KnUpKSpMYV19OmZ1bmN0aW9uKCl7cmV0dXJuW24qTGEsdCpMYV19O3JldHVybiBwLmRpc3RhbmNlPWgscH1mdW5jdGlvbiBNZSgpe2Z1bmN0aW9uIG4obix1KXt2YXIgaT1NYXRoLnNpbih1Kj16YSksbz1NYXRoLmNvcyh1KSxhPWNhKChuKj16YSktdCksYz1NYXRoLmNvcyhhKTtqYys9TWF0aC5hdGFuMihNYXRoLnNxcnQoKGE9bypNYXRoLnNpbihhKSkqYSsoYT1lKmktcipvKmMpKmEpLHIqaStlKm8qYyksdD1uLHI9aSxlPW99dmFyIHQscixlO0hjLnBvaW50PWZ1bmN0aW9uKHUsaSl7dD11KnphLHI9TWF0aC5zaW4oaSo9emEpLGU9TWF0aC5jb3MoaSksSGMucG9pbnQ9bn0sSGMubGluZUVuZD1mdW5jdGlvbigpe0hjLnBvaW50PUhjLmxpbmVFbmQ9dn19ZnVuY3Rpb24gX2Uobix0KXtmdW5jdGlvbiByKHQscil7dmFyIGU9TWF0aC5jb3ModCksdT1NYXRoLmNvcyhyKSxpPW4oZSp1KTtyZXR1cm5baSp1Kk1hdGguc2luKHQpLGkqTWF0aC5zaW4ocildfXJldHVybiByLmludmVydD1mdW5jdGlvbihuLHIpe3ZhciBlPU1hdGguc3FydChuKm4rcipyKSx1PXQoZSksaT1NYXRoLnNpbih1KSxvPU1hdGguY29zKHUpO3JldHVybltNYXRoLmF0YW4yKG4qaSxlKm8pLE1hdGguYXNpbihlJiZyKmkvZSldfSxyfWZ1bmN0aW9uIGJlKG4sdCl7ZnVuY3Rpb24gcihuLHQpe28+MD8tQWErQ2E+dCYmKHQ9LUFhK0NhKTp0PkFhLUNhJiYodD1BYS1DYSk7dmFyIHI9by9NYXRoLnBvdyh1KHQpLGkpO3JldHVybltyKk1hdGguc2luKGkqbiksby1yKk1hdGguY29zKGkqbildfXZhciBlPU1hdGguY29zKG4pLHU9ZnVuY3Rpb24obil7cmV0dXJuIE1hdGgudGFuKGthLzQrbi8yKX0saT1uPT09dD9NYXRoLnNpbihuKTpNYXRoLmxvZyhlL01hdGguY29zKHQpKS9NYXRoLmxvZyh1KHQpL3UobikpLG89ZSpNYXRoLnBvdyh1KG4pLGkpL2k7cmV0dXJuIGk/KHIuaW52ZXJ0PWZ1bmN0aW9uKG4sdCl7dmFyIHI9by10LGU9QihpKSpNYXRoLnNxcnQobipuK3Iqcik7cmV0dXJuW01hdGguYXRhbjIobixyKS9pLDIqTWF0aC5hdGFuKE1hdGgucG93KG8vZSwxL2kpKS1BYV19LHIpOlNlfWZ1bmN0aW9uIHdlKG4sdCl7ZnVuY3Rpb24gcihuLHQpe3ZhciByPWktdDtyZXR1cm5bcipNYXRoLnNpbih1Km4pLGktcipNYXRoLmNvcyh1Km4pXX12YXIgZT1NYXRoLmNvcyhuKSx1PW49PT10P01hdGguc2luKG4pOihlLU1hdGguY29zKHQpKS8odC1uKSxpPWUvdStuO3JldHVybiBjYSh1KTxDYT9hZTooci5pbnZlcnQ9ZnVuY3Rpb24obix0KXt2YXIgcj1pLXQ7cmV0dXJuW01hdGguYXRhbjIobixyKS91LGktQih1KSpNYXRoLnNxcnQobipuK3IqcildfSxyKX1mdW5jdGlvbiBTZShuLHQpe3JldHVybltuLE1hdGgubG9nKE1hdGgudGFuKGthLzQrdC8yKSldfWZ1bmN0aW9uIGtlKG4pe3ZhciB0LHI9dWUobiksZT1yLnNjYWxlLHU9ci50cmFuc2xhdGUsaT1yLmNsaXBFeHRlbnQ7cmV0dXJuIHIuc2NhbGU9ZnVuY3Rpb24oKXt2YXIgbj1lLmFwcGx5KHIsYXJndW1lbnRzKTtyZXR1cm4gbj09PXI/dD9yLmNsaXBFeHRlbnQobnVsbCk6cjpufSxyLnRyYW5zbGF0ZT1mdW5jdGlvbigpe3ZhciBuPXUuYXBwbHkocixhcmd1bWVudHMpO3JldHVybiBuPT09cj90P3IuY2xpcEV4dGVudChudWxsKTpyOm59LHIuY2xpcEV4dGVudD1mdW5jdGlvbihuKXt2YXIgbz1pLmFwcGx5KHIsYXJndW1lbnRzKTtpZihvPT09cil7aWYodD1udWxsPT1uKXt2YXIgYT1rYSplKCksYz11KCk7aShbW2NbMF0tYSxjWzFdLWFdLFtjWzBdK2EsY1sxXSthXV0pfX1lbHNlIHQmJihvPW51bGwpO3JldHVybiBvfSxyLmNsaXBFeHRlbnQobnVsbCl9ZnVuY3Rpb24gRWUobix0KXtyZXR1cm5bTWF0aC5sb2coTWF0aC50YW4oa2EvNCt0LzIpKSwtbl19ZnVuY3Rpb24gQWUobil7cmV0dXJuIG5bMF19ZnVuY3Rpb24gQ2Uobil7cmV0dXJuIG5bMV19ZnVuY3Rpb24gTmUobil7Zm9yKHZhciB0PW4ubGVuZ3RoLHI9WzAsMV0sZT0yLHU9Mjt0PnU7dSsrKXtmb3IoO2U+MSYmSihuW3JbZS0yXV0sbltyW2UtMV1dLG5bdV0pPD0wOyktLWU7cltlKytdPXV9cmV0dXJuIHIuc2xpY2UoMCxlKX1mdW5jdGlvbiB6ZShuLHQpe3JldHVybiBuWzBdLXRbMF18fG5bMV0tdFsxXX1mdW5jdGlvbiBMZShuLHQscil7cmV0dXJuKHJbMF0tdFswXSkqKG5bMV0tdFsxXSk8KHJbMV0tdFsxXSkqKG5bMF0tdFswXSl9ZnVuY3Rpb24gVGUobix0LHIsZSl7dmFyIHU9blswXSxpPXJbMF0sbz10WzBdLXUsYT1lWzBdLWksYz1uWzFdLHM9clsxXSxsPXRbMV0tYyxmPWVbMV0tcyxoPShhKihjLXMpLWYqKHUtaSkpLyhmKm8tYSpsKTtyZXR1cm5bdStoKm8sYytoKmxdfWZ1bmN0aW9uIHFlKG4pe3ZhciB0PW5bMF0scj1uW24ubGVuZ3RoLTFdO3JldHVybiEodFswXS1yWzBdfHx0WzFdLXJbMV0pfWZ1bmN0aW9uIFJlKCl7dHUodGhpcyksdGhpcy5lZGdlPXRoaXMuc2l0ZT10aGlzLmNpcmNsZT1udWxsfWZ1bmN0aW9uIERlKG4pe3ZhciB0PUdjLnBvcCgpfHxuZXcgUmU7cmV0dXJuIHQuc2l0ZT1uLHR9ZnVuY3Rpb24gUGUobil7JGUobiksQmMucmVtb3ZlKG4pLEdjLnB1c2gobiksdHUobil9ZnVuY3Rpb24gVWUobil7dmFyIHQ9bi5jaXJjbGUscj10LngsZT10LmN5LHU9e3g6cix5OmV9LGk9bi5QLG89bi5OLGE9W25dO1BlKG4pO2Zvcih2YXIgYz1pO2MuY2lyY2xlJiZjYShyLWMuY2lyY2xlLngpPENhJiZjYShlLWMuY2lyY2xlLmN5KTxDYTspaT1jLlAsYS51bnNoaWZ0KGMpLFBlKGMpLGM9aTthLnVuc2hpZnQoYyksJGUoYyk7Zm9yKHZhciBzPW87cy5jaXJjbGUmJmNhKHItcy5jaXJjbGUueCk8Q2EmJmNhKGUtcy5jaXJjbGUuY3kpPENhOylvPXMuTixhLnB1c2gocyksUGUocykscz1vO2EucHVzaChzKSwkZShzKTt2YXIgbCxmPWEubGVuZ3RoO2ZvcihsPTE7Zj5sOysrbClzPWFbbF0sYz1hW2wtMV0sS2Uocy5lZGdlLGMuc2l0ZSxzLnNpdGUsdSk7Yz1hWzBdLHM9YVtmLTFdLHMuZWRnZT1XZShjLnNpdGUscy5zaXRlLG51bGwsdSksVmUoYyksVmUocyl9ZnVuY3Rpb24gamUobil7Zm9yKHZhciB0LHIsZSx1LGk9bi54LG89bi55LGE9QmMuXzthOylpZihlPUhlKGEsbyktaSxlPkNhKWE9YS5MO2Vsc2V7aWYodT1pLUZlKGEsbyksISh1PkNhKSl7ZT4tQ2E/KHQ9YS5QLHI9YSk6dT4tQ2E/KHQ9YSxyPWEuTik6dD1yPWE7YnJlYWt9aWYoIWEuUil7dD1hO2JyZWFrfWE9YS5SfXZhciBjPURlKG4pO2lmKEJjLmluc2VydCh0LGMpLHR8fHIpe2lmKHQ9PT1yKXJldHVybiAkZSh0KSxyPURlKHQuc2l0ZSksQmMuaW5zZXJ0KGMsciksYy5lZGdlPXIuZWRnZT1XZSh0LnNpdGUsYy5zaXRlKSxWZSh0KSxWZShyKSx2b2lkIDA7aWYoIXIpcmV0dXJuIGMuZWRnZT1XZSh0LnNpdGUsYy5zaXRlKSx2b2lkIDA7JGUodCksJGUocik7dmFyIHM9dC5zaXRlLGw9cy54LGY9cy55LGg9bi54LWwsZz1uLnktZixwPXIuc2l0ZSx2PXAueC1sLGQ9cC55LWYsbT0yKihoKmQtZyp2KSx5PWgqaCtnKmcseD12KnYrZCpkLE09e3g6KGQqeS1nKngpL20rbCx5OihoKngtdip5KS9tK2Z9O0tlKHIuZWRnZSxzLHAsTSksYy5lZGdlPVdlKHMsbixudWxsLE0pLHIuZWRnZT1XZShuLHAsbnVsbCxNKSxWZSh0KSxWZShyKX19ZnVuY3Rpb24gSGUobix0KXt2YXIgcj1uLnNpdGUsZT1yLngsdT1yLnksaT11LXQ7aWYoIWkpcmV0dXJuIGU7dmFyIG89bi5QO2lmKCFvKXJldHVybi0xLzA7cj1vLnNpdGU7dmFyIGE9ci54LGM9ci55LHM9Yy10O2lmKCFzKXJldHVybiBhO3ZhciBsPWEtZSxmPTEvaS0xL3MsaD1sL3M7cmV0dXJuIGY/KC1oK01hdGguc3FydChoKmgtMipmKihsKmwvKC0yKnMpLWMrcy8yK3UtaS8yKSkpL2YrZTooZSthKS8yfWZ1bmN0aW9uIEZlKG4sdCl7dmFyIHI9bi5OO2lmKHIpcmV0dXJuIEhlKHIsdCk7dmFyIGU9bi5zaXRlO3JldHVybiBlLnk9PT10P2UueDoxLzB9ZnVuY3Rpb24gT2Uobil7dGhpcy5zaXRlPW4sdGhpcy5lZGdlcz1bXX1mdW5jdGlvbiBJZShuKXtmb3IodmFyIHQscixlLHUsaSxvLGEsYyxzLGwsZj1uWzBdWzBdLGg9blsxXVswXSxnPW5bMF1bMV0scD1uWzFdWzFdLHY9WGMsZD12Lmxlbmd0aDtkLS07KWlmKGk9dltkXSxpJiZpLnByZXBhcmUoKSlmb3IoYT1pLmVkZ2VzLGM9YS5sZW5ndGgsbz0wO2M+bzspbD1hW29dLmVuZCgpLGU9bC54LHU9bC55LHM9YVsrK28lY10uc3RhcnQoKSx0PXMueCxyPXMueSwoY2EoZS10KT5DYXx8Y2EodS1yKT5DYSkmJihhLnNwbGljZShvLDAsbmV3IFFlKEdlKGkuc2l0ZSxsLGNhKGUtZik8Q2EmJnAtdT5DYT97eDpmLHk6Y2EodC1mKTxDYT9yOnB9OmNhKHUtcCk8Q2EmJmgtZT5DYT97eDpjYShyLXApPENhP3Q6aCx5OnB9OmNhKGUtaCk8Q2EmJnUtZz5DYT97eDpoLHk6Y2EodC1oKTxDYT9yOmd9OmNhKHUtZyk8Q2EmJmUtZj5DYT97eDpjYShyLWcpPENhP3Q6Zix5Omd9Om51bGwpLGkuc2l0ZSxudWxsKSksKytjKX1mdW5jdGlvbiBZZShuLHQpe3JldHVybiB0LmFuZ2xlLW4uYW5nbGV9ZnVuY3Rpb24gWmUoKXt0dSh0aGlzKSx0aGlzLng9dGhpcy55PXRoaXMuYXJjPXRoaXMuc2l0ZT10aGlzLmN5PW51bGx9ZnVuY3Rpb24gVmUobil7dmFyIHQ9bi5QLHI9bi5OO2lmKHQmJnIpe3ZhciBlPXQuc2l0ZSx1PW4uc2l0ZSxpPXIuc2l0ZTtpZihlIT09aSl7dmFyIG89dS54LGE9dS55LGM9ZS54LW8scz1lLnktYSxsPWkueC1vLGY9aS55LWEsaD0yKihjKmYtcypsKTtpZighKGg+PS1OYSkpe3ZhciBnPWMqYytzKnMscD1sKmwrZipmLHY9KGYqZy1zKnApL2gsZD0oYypwLWwqZykvaCxmPWQrYSxtPUtjLnBvcCgpfHxuZXcgWmU7bS5hcmM9bixtLnNpdGU9dSxtLng9ditvLG0ueT1mK01hdGguc3FydCh2KnYrZCpkKSxtLmN5PWYsbi5jaXJjbGU9bTtmb3IodmFyIHk9bnVsbCx4PVdjLl87eDspaWYobS55PHgueXx8bS55PT09eC55JiZtLng8PXgueCl7aWYoIXguTCl7eT14LlA7YnJlYWt9eD14Lkx9ZWxzZXtpZigheC5SKXt5PXg7YnJlYWt9eD14LlJ9V2MuaW5zZXJ0KHksbSkseXx8KEpjPW0pfX19fWZ1bmN0aW9uICRlKG4pe3ZhciB0PW4uY2lyY2xlO3QmJih0LlB8fChKYz10Lk4pLFdjLnJlbW92ZSh0KSxLYy5wdXNoKHQpLHR1KHQpLG4uY2lyY2xlPW51bGwpfWZ1bmN0aW9uIFhlKG4pe2Zvcih2YXIgdCxyPSRjLGU9RnIoblswXVswXSxuWzBdWzFdLG5bMV1bMF0sblsxXVsxXSksdT1yLmxlbmd0aDt1LS07KXQ9clt1XSwoIUJlKHQsbil8fCFlKHQpfHxjYSh0LmEueC10LmIueCk8Q2EmJmNhKHQuYS55LXQuYi55KTxDYSkmJih0LmE9dC5iPW51bGwsci5zcGxpY2UodSwxKSl9ZnVuY3Rpb24gQmUobix0KXt2YXIgcj1uLmI7aWYocilyZXR1cm4hMDt2YXIgZSx1LGk9bi5hLG89dFswXVswXSxhPXRbMV1bMF0sYz10WzBdWzFdLHM9dFsxXVsxXSxsPW4ubCxmPW4ucixoPWwueCxnPWwueSxwPWYueCx2PWYueSxkPShoK3ApLzIsbT0oZyt2KS8yO2lmKHY9PT1nKXtpZihvPmR8fGQ+PWEpcmV0dXJuO2lmKGg+cCl7aWYoaSl7aWYoaS55Pj1zKXJldHVybn1lbHNlIGk9e3g6ZCx5OmN9O3I9e3g6ZCx5OnN9fWVsc2V7aWYoaSl7aWYoaS55PGMpcmV0dXJufWVsc2UgaT17eDpkLHk6c307cj17eDpkLHk6Y319fWVsc2UgaWYoZT0oaC1wKS8odi1nKSx1PW0tZSpkLC0xPmV8fGU+MSlpZihoPnApe2lmKGkpe2lmKGkueT49cylyZXR1cm59ZWxzZSBpPXt4OihjLXUpL2UseTpjfTtyPXt4OihzLXUpL2UseTpzfX1lbHNle2lmKGkpe2lmKGkueTxjKXJldHVybn1lbHNlIGk9e3g6KHMtdSkvZSx5OnN9O3I9e3g6KGMtdSkvZSx5OmN9fWVsc2UgaWYodj5nKXtpZihpKXtpZihpLng+PWEpcmV0dXJufWVsc2UgaT17eDpvLHk6ZSpvK3V9O3I9e3g6YSx5OmUqYSt1fX1lbHNle2lmKGkpe2lmKGkueDxvKXJldHVybn1lbHNlIGk9e3g6YSx5OmUqYSt1fTtyPXt4Om8seTplKm8rdX19cmV0dXJuIG4uYT1pLG4uYj1yLCEwfWZ1bmN0aW9uIEplKG4sdCl7dGhpcy5sPW4sdGhpcy5yPXQsdGhpcy5hPXRoaXMuYj1udWxsfWZ1bmN0aW9uIFdlKG4sdCxyLGUpe3ZhciB1PW5ldyBKZShuLHQpO3JldHVybiAkYy5wdXNoKHUpLHImJktlKHUsbix0LHIpLGUmJktlKHUsdCxuLGUpLFhjW24uaV0uZWRnZXMucHVzaChuZXcgUWUodSxuLHQpKSxYY1t0LmldLmVkZ2VzLnB1c2gobmV3IFFlKHUsdCxuKSksdX1mdW5jdGlvbiBHZShuLHQscil7dmFyIGU9bmV3IEplKG4sbnVsbCk7cmV0dXJuIGUuYT10LGUuYj1yLCRjLnB1c2goZSksZX1mdW5jdGlvbiBLZShuLHQscixlKXtuLmF8fG4uYj9uLmw9PT1yP24uYj1lOm4uYT1lOihuLmE9ZSxuLmw9dCxuLnI9cil9ZnVuY3Rpb24gUWUobix0LHIpe3ZhciBlPW4uYSx1PW4uYjt0aGlzLmVkZ2U9bix0aGlzLnNpdGU9dCx0aGlzLmFuZ2xlPXI/TWF0aC5hdGFuMihyLnktdC55LHIueC10LngpOm4ubD09PXQ/TWF0aC5hdGFuMih1LngtZS54LGUueS11LnkpOk1hdGguYXRhbjIoZS54LXUueCx1LnktZS55KX1mdW5jdGlvbiBudSgpe3RoaXMuXz1udWxsfWZ1bmN0aW9uIHR1KG4pe24uVT1uLkM9bi5MPW4uUj1uLlA9bi5OPW51bGx9ZnVuY3Rpb24gcnUobix0KXt2YXIgcj10LGU9dC5SLHU9ci5VO3U/dS5MPT09cj91Lkw9ZTp1LlI9ZTpuLl89ZSxlLlU9dSxyLlU9ZSxyLlI9ZS5MLHIuUiYmKHIuUi5VPXIpLGUuTD1yfWZ1bmN0aW9uIGV1KG4sdCl7dmFyIHI9dCxlPXQuTCx1PXIuVTt1P3UuTD09PXI/dS5MPWU6dS5SPWU6bi5fPWUsZS5VPXUsci5VPWUsci5MPWUuUixyLkwmJihyLkwuVT1yKSxlLlI9cn1mdW5jdGlvbiB1dShuKXtmb3IoO24uTDspbj1uLkw7cmV0dXJuIG59ZnVuY3Rpb24gaXUobix0KXt2YXIgcixlLHUsaT1uLnNvcnQob3UpLnBvcCgpO2ZvcigkYz1bXSxYYz1uZXcgQXJyYXkobi5sZW5ndGgpLEJjPW5ldyBudSxXYz1uZXcgbnU7OylpZih1PUpjLGkmJighdXx8aS55PHUueXx8aS55PT09dS55JiZpLng8dS54KSkoaS54IT09cnx8aS55IT09ZSkmJihYY1tpLmldPW5ldyBPZShpKSxqZShpKSxyPWkueCxlPWkueSksaT1uLnBvcCgpO2Vsc2V7aWYoIXUpYnJlYWs7VWUodS5hcmMpfXQmJihYZSh0KSxJZSh0KSk7dmFyIG89e2NlbGxzOlhjLGVkZ2VzOiRjfTtyZXR1cm4gQmM9V2M9JGM9WGM9bnVsbCxvfWZ1bmN0aW9uIG91KG4sdCl7cmV0dXJuIHQueS1uLnl8fHQueC1uLnh9ZnVuY3Rpb24gYXUobix0LHIpe3JldHVybihuLngtci54KSoodC55LW4ueSktKG4ueC10LngpKihyLnktbi55KX1mdW5jdGlvbiBjdShuKXtyZXR1cm4gbi54fWZ1bmN0aW9uIHN1KG4pe3JldHVybiBuLnl9ZnVuY3Rpb24gbHUoKXtyZXR1cm57bGVhZjohMCxub2RlczpbXSxwb2ludDpudWxsLHg6bnVsbCx5Om51bGx9fWZ1bmN0aW9uIGZ1KG4sdCxyLGUsdSxpKXtpZighbih0LHIsZSx1LGkpKXt2YXIgbz0uNSoocit1KSxhPS41KihlK2kpLGM9dC5ub2RlcztjWzBdJiZmdShuLGNbMF0scixlLG8sYSksY1sxXSYmZnUobixjWzFdLG8sZSx1LGEpLGNbMl0mJmZ1KG4sY1syXSxyLGEsbyxpKSxjWzNdJiZmdShuLGNbM10sbyxhLHUsaSl9fWZ1bmN0aW9uIGh1KG4sdCl7bj1Cby5yZ2IobiksdD1Cby5yZ2IodCk7dmFyIHI9bi5yLGU9bi5nLHU9bi5iLGk9dC5yLXIsbz10LmctZSxhPXQuYi11O3JldHVybiBmdW5jdGlvbihuKXtyZXR1cm4iIyIrTXQoTWF0aC5yb3VuZChyK2kqbikpK010KE1hdGgucm91bmQoZStvKm4pKStNdChNYXRoLnJvdW5kKHUrYSpuKSl9fWZ1bmN0aW9uIGd1KG4sdCl7dmFyIHIsZT17fSx1PXt9O2ZvcihyIGluIG4pciBpbiB0P2Vbcl09ZHUobltyXSx0W3JdKTp1W3JdPW5bcl07Zm9yKHIgaW4gdClyIGluIG58fCh1W3JdPXRbcl0pO3JldHVybiBmdW5jdGlvbihuKXtmb3IociBpbiBlKXVbcl09ZVtyXShuKTtyZXR1cm4gdX19ZnVuY3Rpb24gcHUobix0KXtyZXR1cm4gdC09bj0rbixmdW5jdGlvbihyKXtyZXR1cm4gbit0KnJ9fWZ1bmN0aW9uIHZ1KG4sdCl7dmFyIHIsZSx1LGk9bnMubGFzdEluZGV4PXRzLmxhc3RJbmRleD0wLG89LTEsYT1bXSxjPVtdO2ZvcihuKz0iIix0Kz0iIjsocj1ucy5leGVjKG4pKSYmKGU9dHMuZXhlYyh0KSk7KSh1PWUuaW5kZXgpPmkmJih1PXQuc3Vic3RyaW5nKGksdSksYVtvXT9hW29dKz11OmFbKytvXT11KSwocj1yWzBdKT09PShlPWVbMF0pP2Fbb10/YVtvXSs9ZTphWysrb109ZTooYVsrK29dPW51bGwsYy5wdXNoKHtpOm8seDpwdShyLGUpfSkpLGk9dHMubGFzdEluZGV4O3JldHVybiBpPHQubGVuZ3RoJiYodT10LnN1YnN0cmluZyhpKSxhW29dP2Fbb10rPXU6YVsrK29dPXUpLGEubGVuZ3RoPDI/Y1swXT8odD1jWzBdLngsZnVuY3Rpb24obil7cmV0dXJuIHQobikrIiJ9KTpmdW5jdGlvbigpe3JldHVybiB0fToodD1jLmxlbmd0aCxmdW5jdGlvbihuKXtmb3IodmFyIHIsZT0wO3Q+ZTsrK2UpYVsocj1jW2VdKS5pXT1yLngobik7cmV0dXJuIGEuam9pbigiIil9KX1mdW5jdGlvbiBkdShuLHQpe2Zvcih2YXIgcixlPUJvLmludGVycG9sYXRvcnMubGVuZ3RoOy0tZT49MCYmIShyPUJvLmludGVycG9sYXRvcnNbZV0obix0KSk7KTtyZXR1cm4gcn1mdW5jdGlvbiBtdShuLHQpe3ZhciByLGU9W10sdT1bXSxpPW4ubGVuZ3RoLG89dC5sZW5ndGgsYT1NYXRoLm1pbihuLmxlbmd0aCx0Lmxlbmd0aCk7Zm9yKHI9MDthPnI7KytyKWUucHVzaChkdShuW3JdLHRbcl0pKTtmb3IoO2k+cjsrK3IpdVtyXT1uW3JdO2Zvcig7bz5yOysrcil1W3JdPXRbcl07cmV0dXJuIGZ1bmN0aW9uKG4pe2ZvcihyPTA7YT5yOysrcil1W3JdPWVbcl0obik7cmV0dXJuIHV9fWZ1bmN0aW9uIHl1KG4pe3JldHVybiBmdW5jdGlvbih0KXtyZXR1cm4gMD49dD8wOnQ+PTE/MTpuKHQpfX1mdW5jdGlvbiB4dShuKXtyZXR1cm4gZnVuY3Rpb24odCl7cmV0dXJuIDEtbigxLXQpfX1mdW5jdGlvbiBNdShuKXtyZXR1cm4gZnVuY3Rpb24odCl7cmV0dXJuLjUqKC41PnQ/bigyKnQpOjItbigyLTIqdCkpfX1mdW5jdGlvbiBfdShuKXtyZXR1cm4gbipufWZ1bmN0aW9uIGJ1KG4pe3JldHVybiBuKm4qbn1mdW5jdGlvbiB3dShuKXtpZigwPj1uKXJldHVybiAwO2lmKG4+PTEpcmV0dXJuIDE7dmFyIHQ9bipuLHI9dCpuO3JldHVybiA0KiguNT5uP3I6Myoobi10KStyLS43NSl9ZnVuY3Rpb24gU3Uobil7cmV0dXJuIGZ1bmN0aW9uKHQpe3JldHVybiBNYXRoLnBvdyh0LG4pfX1mdW5jdGlvbiBrdShuKXtyZXR1cm4gMS1NYXRoLmNvcyhuKkFhKX1mdW5jdGlvbiBFdShuKXtyZXR1cm4gTWF0aC5wb3coMiwxMCoobi0xKSl9ZnVuY3Rpb24gQXUobil7cmV0dXJuIDEtTWF0aC5zcXJ0KDEtbipuKX1mdW5jdGlvbiBDdShuLHQpe3ZhciByO3JldHVybiBhcmd1bWVudHMubGVuZ3RoPDImJih0PS40NSksYXJndW1lbnRzLmxlbmd0aD9yPXQvRWEqTWF0aC5hc2luKDEvbik6KG49MSxyPXQvNCksZnVuY3Rpb24oZSl7cmV0dXJuIDErbipNYXRoLnBvdygyLC0xMCplKSpNYXRoLnNpbigoZS1yKSpFYS90KX19ZnVuY3Rpb24gTnUobil7cmV0dXJuIG58fChuPTEuNzAxNTgpLGZ1bmN0aW9uKHQpe3JldHVybiB0KnQqKChuKzEpKnQtbil9fWZ1bmN0aW9uIHp1KG4pe3JldHVybiAxLzIuNzU+bj83LjU2MjUqbipuOjIvMi43NT5uPzcuNTYyNSoobi09MS41LzIuNzUpKm4rLjc1OjIuNS8yLjc1Pm4/Ny41NjI1KihuLT0yLjI1LzIuNzUpKm4rLjkzNzU6Ny41NjI1KihuLT0yLjYyNS8yLjc1KSpuKy45ODQzNzV9ZnVuY3Rpb24gTHUobix0KXtuPUJvLmhjbChuKSx0PUJvLmhjbCh0KTt2YXIgcj1uLmgsZT1uLmMsdT1uLmwsaT10LmgtcixvPXQuYy1lLGE9dC5sLXU7cmV0dXJuIGlzTmFOKG8pJiYobz0wLGU9aXNOYU4oZSk/dC5jOmUpLGlzTmFOKGkpPyhpPTAscj1pc05hTihyKT90Lmg6cik6aT4xODA/aS09MzYwOi0xODA+aSYmKGkrPTM2MCksZnVuY3Rpb24obil7cmV0dXJuIGN0KHIraSpuLGUrbypuLHUrYSpuKSsiIn19ZnVuY3Rpb24gVHUobix0KXtuPUJvLmhzbChuKSx0PUJvLmhzbCh0KTt2YXIgcj1uLmgsZT1uLnMsdT1uLmwsaT10LmgtcixvPXQucy1lLGE9dC5sLXU7cmV0dXJuIGlzTmFOKG8pJiYobz0wLGU9aXNOYU4oZSk/dC5zOmUpLGlzTmFOKGkpPyhpPTAscj1pc05hTihyKT90Lmg6cik6aT4xODA/aS09MzYwOi0xODA+aSYmKGkrPTM2MCksZnVuY3Rpb24obil7cmV0dXJuIGl0KHIraSpuLGUrbypuLHUrYSpuKSsiIn19ZnVuY3Rpb24gcXUobix0KXtuPUJvLmxhYihuKSx0PUJvLmxhYih0KTt2YXIgcj1uLmwsZT1uLmEsdT1uLmIsaT10LmwtcixvPXQuYS1lLGE9dC5iLXU7cmV0dXJuIGZ1bmN0aW9uKG4pe3JldHVybiBmdChyK2kqbixlK28qbix1K2EqbikrIiJ9fWZ1bmN0aW9uIFJ1KG4sdCl7cmV0dXJuIHQtPW4sZnVuY3Rpb24ocil7cmV0dXJuIE1hdGgucm91bmQobit0KnIpfX1mdW5jdGlvbiBEdShuKXt2YXIgdD1bbi5hLG4uYl0scj1bbi5jLG4uZF0sZT1VdSh0KSx1PVB1KHQsciksaT1VdShqdShyLHQsLXUpKXx8MDt0WzBdKnJbMV08clswXSp0WzFdJiYodFswXSo9LTEsdFsxXSo9LTEsZSo9LTEsdSo9LTEpLHRoaXMucm90YXRlPShlP01hdGguYXRhbjIodFsxXSx0WzBdKTpNYXRoLmF0YW4yKC1yWzBdLHJbMV0pKSpMYSx0aGlzLnRyYW5zbGF0ZT1bbi5lLG4uZl0sdGhpcy5zY2FsZT1bZSxpXSx0aGlzLnNrZXc9aT9NYXRoLmF0YW4yKHUsaSkqTGE6MH1mdW5jdGlvbiBQdShuLHQpe3JldHVybiBuWzBdKnRbMF0rblsxXSp0WzFdfWZ1bmN0aW9uIFV1KG4pe3ZhciB0PU1hdGguc3FydChQdShuLG4pKTtyZXR1cm4gdCYmKG5bMF0vPXQsblsxXS89dCksdH1mdW5jdGlvbiBqdShuLHQscil7cmV0dXJuIG5bMF0rPXIqdFswXSxuWzFdKz1yKnRbMV0sbn1mdW5jdGlvbiBIdShuLHQpe3ZhciByLGU9W10sdT1bXSxpPUJvLnRyYW5zZm9ybShuKSxvPUJvLnRyYW5zZm9ybSh0KSxhPWkudHJhbnNsYXRlLGM9by50cmFuc2xhdGUscz1pLnJvdGF0ZSxsPW8ucm90YXRlLGY9aS5za2V3LGg9by5za2V3LGc9aS5zY2FsZSxwPW8uc2NhbGU7cmV0dXJuIGFbMF0hPWNbMF18fGFbMV0hPWNbMV0/KGUucHVzaCgidHJhbnNsYXRlKCIsbnVsbCwiLCIsbnVsbCwiKSIpLHUucHVzaCh7aToxLHg6cHUoYVswXSxjWzBdKX0se2k6Myx4OnB1KGFbMV0sY1sxXSl9KSk6Y1swXXx8Y1sxXT9lLnB1c2goInRyYW5zbGF0ZSgiK2MrIikiKTplLnB1c2goIiIpLHMhPWw/KHMtbD4xODA/bCs9MzYwOmwtcz4xODAmJihzKz0zNjApLHUucHVzaCh7aTplLnB1c2goZS5wb3AoKSsicm90YXRlKCIsbnVsbCwiKSIpLTIseDpwdShzLGwpfSkpOmwmJmUucHVzaChlLnBvcCgpKyJyb3RhdGUoIitsKyIpIiksZiE9aD91LnB1c2goe2k6ZS5wdXNoKGUucG9wKCkrInNrZXdYKCIsbnVsbCwiKSIpLTIseDpwdShmLGgpfSk6aCYmZS5wdXNoKGUucG9wKCkrInNrZXdYKCIraCsiKSIpLGdbMF0hPXBbMF18fGdbMV0hPXBbMV0/KHI9ZS5wdXNoKGUucG9wKCkrInNjYWxlKCIsbnVsbCwiLCIsbnVsbCwiKSIpLHUucHVzaCh7aTpyLTQseDpwdShnWzBdLHBbMF0pfSx7aTpyLTIseDpwdShnWzFdLHBbMV0pfSkpOigxIT1wWzBdfHwxIT1wWzFdKSYmZS5wdXNoKGUucG9wKCkrInNjYWxlKCIrcCsiKSIpLHI9dS5sZW5ndGgsZnVuY3Rpb24obil7Zm9yKHZhciB0LGk9LTE7KytpPHI7KWVbKHQ9dVtpXSkuaV09dC54KG4pO3JldHVybiBlLmpvaW4oIiIpfX1mdW5jdGlvbiBGdShuLHQpe3JldHVybiB0PXQtKG49K24pPzEvKHQtbik6MCxmdW5jdGlvbihyKXtyZXR1cm4oci1uKSp0fX1mdW5jdGlvbiBPdShuLHQpe3JldHVybiB0PXQtKG49K24pPzEvKHQtbik6MCxmdW5jdGlvbihyKXtyZXR1cm4gTWF0aC5tYXgoMCxNYXRoLm1pbigxLChyLW4pKnQpKX19ZnVuY3Rpb24gSXUobil7Zm9yKHZhciB0PW4uc291cmNlLHI9bi50YXJnZXQsZT1adSh0LHIpLHU9W3RdO3QhPT1lOyl0PXQucGFyZW50LHUucHVzaCh0KTtmb3IodmFyIGk9dS5sZW5ndGg7ciE9PWU7KXUuc3BsaWNlKGksMCxyKSxyPXIucGFyZW50O3JldHVybiB1fWZ1bmN0aW9uIFl1KG4pe2Zvcih2YXIgdD1bXSxyPW4ucGFyZW50O251bGwhPXI7KXQucHVzaChuKSxuPXIscj1yLnBhcmVudDtyZXR1cm4gdC5wdXNoKG4pLHR9ZnVuY3Rpb24gWnUobix0KXtpZihuPT09dClyZXR1cm4gbjtmb3IodmFyIHI9WXUobiksZT1ZdSh0KSx1PXIucG9wKCksaT1lLnBvcCgpLG89bnVsbDt1PT09aTspbz11LHU9ci5wb3AoKSxpPWUucG9wKCk7cmV0dXJuIG99ZnVuY3Rpb24gVnUobil7bi5maXhlZHw9Mn1mdW5jdGlvbiAkdShuKXtuLmZpeGVkJj0tN31mdW5jdGlvbiBYdShuKXtuLmZpeGVkfD00LG4ucHg9bi54LG4ucHk9bi55fWZ1bmN0aW9uIEJ1KG4pe24uZml4ZWQmPS01fWZ1bmN0aW9uIEp1KG4sdCxyKXt2YXIgZT0wLHU9MDtpZihuLmNoYXJnZT0wLCFuLmxlYWYpZm9yKHZhciBpLG89bi5ub2RlcyxhPW8ubGVuZ3RoLGM9LTE7KytjPGE7KWk9b1tjXSxudWxsIT1pJiYoSnUoaSx0LHIpLG4uY2hhcmdlKz1pLmNoYXJnZSxlKz1pLmNoYXJnZSppLmN4LHUrPWkuY2hhcmdlKmkuY3kpO2lmKG4ucG9pbnQpe24ubGVhZnx8KG4ucG9pbnQueCs9TWF0aC5yYW5kb20oKS0uNSxuLnBvaW50LnkrPU1hdGgucmFuZG9tKCktLjUpO3ZhciBzPXQqcltuLnBvaW50LmluZGV4XTtuLmNoYXJnZSs9bi5wb2ludENoYXJnZT1zLGUrPXMqbi5wb2ludC54LHUrPXMqbi5wb2ludC55fW4uY3g9ZS9uLmNoYXJnZSxuLmN5PXUvbi5jaGFyZ2V9ZnVuY3Rpb24gV3Uobix0KXtyZXR1cm4gQm8ucmViaW5kKG4sdCwic29ydCIsImNoaWxkcmVuIiwidmFsdWUiKSxuLm5vZGVzPW4sbi5saW5rcz1yaSxufWZ1bmN0aW9uIEd1KG4sdCl7Zm9yKHZhciByPVtuXTtudWxsIT0obj1yLnBvcCgpKTspaWYodChuKSwodT1uLmNoaWxkcmVuKSYmKGU9dS5sZW5ndGgpKWZvcih2YXIgZSx1Oy0tZT49MDspci5wdXNoKHVbZV0pfWZ1bmN0aW9uIEt1KG4sdCl7Zm9yKHZhciByPVtuXSxlPVtdO251bGwhPShuPXIucG9wKCkpOylpZihlLnB1c2gobiksKGk9bi5jaGlsZHJlbikmJih1PWkubGVuZ3RoKSlmb3IodmFyIHUsaSxvPS0xOysrbzx1OylyLnB1c2goaVtvXSk7Zm9yKDtudWxsIT0obj1lLnBvcCgpKTspdChuKX1mdW5jdGlvbiBRdShuKXtyZXR1cm4gbi5jaGlsZHJlbn1mdW5jdGlvbiBuaShuKXtyZXR1cm4gbi52YWx1ZX1mdW5jdGlvbiB0aShuLHQpe3JldHVybiB0LnZhbHVlLW4udmFsdWV9ZnVuY3Rpb24gcmkobil7cmV0dXJuIEJvLm1lcmdlKG4ubWFwKGZ1bmN0aW9uKG4pe3JldHVybihuLmNoaWxkcmVufHxbXSkubWFwKGZ1bmN0aW9uKHQpe3JldHVybntzb3VyY2U6bix0YXJnZXQ6dH19KX0pKX1mdW5jdGlvbiBlaShuKXtyZXR1cm4gbi54fWZ1bmN0aW9uIHVpKG4pe3JldHVybiBuLnl9ZnVuY3Rpb24gaWkobix0LHIpe24ueTA9dCxuLnk9cn1mdW5jdGlvbiBvaShuKXtyZXR1cm4gQm8ucmFuZ2Uobi5sZW5ndGgpfWZ1bmN0aW9uIGFpKG4pe2Zvcih2YXIgdD0tMSxyPW5bMF0ubGVuZ3RoLGU9W107Kyt0PHI7KWVbdF09MDtyZXR1cm4gZX1mdW5jdGlvbiBjaShuKXtmb3IodmFyIHQscj0xLGU9MCx1PW5bMF1bMV0saT1uLmxlbmd0aDtpPnI7KytyKSh0PW5bcl1bMV0pPnUmJihlPXIsdT10KTtyZXR1cm4gZX1mdW5jdGlvbiBzaShuKXtyZXR1cm4gbi5yZWR1Y2UobGksMCl9ZnVuY3Rpb24gbGkobix0KXtyZXR1cm4gbit0WzFdfWZ1bmN0aW9uIGZpKG4sdCl7cmV0dXJuIGhpKG4sTWF0aC5jZWlsKE1hdGgubG9nKHQubGVuZ3RoKS9NYXRoLkxOMisxKSl9ZnVuY3Rpb24gaGkobix0KXtmb3IodmFyIHI9LTEsZT0rblswXSx1PShuWzFdLWUpL3QsaT1bXTsrK3I8PXQ7KWlbcl09dSpyK2U7cmV0dXJuIGl9ZnVuY3Rpb24gZ2kobil7cmV0dXJuW0JvLm1pbihuKSxCby5tYXgobildfWZ1bmN0aW9uIHBpKG4sdCl7cmV0dXJuIG4udmFsdWUtdC52YWx1ZX1mdW5jdGlvbiB2aShuLHQpe3ZhciByPW4uX3BhY2tfbmV4dDtuLl9wYWNrX25leHQ9dCx0Ll9wYWNrX3ByZXY9bix0Ll9wYWNrX25leHQ9cixyLl9wYWNrX3ByZXY9dH1mdW5jdGlvbiBkaShuLHQpe24uX3BhY2tfbmV4dD10LHQuX3BhY2tfcHJldj1ufWZ1bmN0aW9uIG1pKG4sdCl7dmFyIHI9dC54LW4ueCxlPXQueS1uLnksdT1uLnIrdC5yO3JldHVybi45OTkqdSp1PnIqcitlKmV9ZnVuY3Rpb24geWkobil7ZnVuY3Rpb24gdChuKXtsPU1hdGgubWluKG4ueC1uLnIsbCksZj1NYXRoLm1heChuLngrbi5yLGYpLGg9TWF0aC5taW4obi55LW4ucixoKSxnPU1hdGgubWF4KG4ueStuLnIsZyl9aWYoKHI9bi5jaGlsZHJlbikmJihzPXIubGVuZ3RoKSl7dmFyIHIsZSx1LGksbyxhLGMscyxsPTEvMCxmPS0xLzAsaD0xLzAsZz0tMS8wO2lmKHIuZm9yRWFjaCh4aSksZT1yWzBdLGUueD0tZS5yLGUueT0wLHQoZSkscz4xJiYodT1yWzFdLHUueD11LnIsdS55PTAsdCh1KSxzPjIpKWZvcihpPXJbMl0sYmkoZSx1LGkpLHQoaSksdmkoZSxpKSxlLl9wYWNrX3ByZXY9aSx2aShpLHUpLHU9ZS5fcGFja19uZXh0LG89MztzPm87bysrKXtiaShlLHUsaT1yW29dKTt2YXIgcD0wLHY9MSxkPTE7Zm9yKGE9dS5fcGFja19uZXh0O2EhPT11O2E9YS5fcGFja19uZXh0LHYrKylpZihtaShhLGkpKXtwPTE7YnJlYWt9aWYoMT09cClmb3IoYz1lLl9wYWNrX3ByZXY7YyE9PWEuX3BhY2tfcHJldiYmIW1pKGMsaSk7Yz1jLl9wYWNrX3ByZXYsZCsrKTtwPyhkPnZ8fHY9PWQmJnUucjxlLnI/ZGkoZSx1PWEpOmRpKGU9Yyx1KSxvLS0pOih2aShlLGkpLHU9aSx0KGkpKX12YXIgbT0obCtmKS8yLHk9KGgrZykvMix4PTA7Zm9yKG89MDtzPm87bysrKWk9cltvXSxpLngtPW0saS55LT15LHg9TWF0aC5tYXgoeCxpLnIrTWF0aC5zcXJ0KGkueCppLngraS55KmkueSkpO24ucj14LHIuZm9yRWFjaChNaSl9fWZ1bmN0aW9uIHhpKG4pe24uX3BhY2tfbmV4dD1uLl9wYWNrX3ByZXY9bn1mdW5jdGlvbiBNaShuKXtkZWxldGUgbi5fcGFja19uZXh0LGRlbGV0ZSBuLl9wYWNrX3ByZXZ9ZnVuY3Rpb24gX2kobix0LHIsZSl7dmFyIHU9bi5jaGlsZHJlbjtpZihuLng9dCs9ZSpuLngsbi55PXIrPWUqbi55LG4ucio9ZSx1KWZvcih2YXIgaT0tMSxvPXUubGVuZ3RoOysraTxvOylfaSh1W2ldLHQscixlKX1mdW5jdGlvbiBiaShuLHQscil7dmFyIGU9bi5yK3Iucix1PXQueC1uLngsaT10Lnktbi55O2lmKGUmJih1fHxpKSl7dmFyIG89dC5yK3IucixhPXUqdStpKmk7byo9byxlKj1lO3ZhciBjPS41KyhlLW8pLygyKmEpLHM9TWF0aC5zcXJ0KE1hdGgubWF4KDAsMipvKihlK2EpLShlLT1hKSplLW8qbykpLygyKmEpO3IueD1uLngrYyp1K3MqaSxyLnk9bi55K2MqaS1zKnV9ZWxzZSByLng9bi54K2Usci55PW4ueX1mdW5jdGlvbiB3aShuLHQpe3JldHVybiBuLnBhcmVudD09dC5wYXJlbnQ/MToyfWZ1bmN0aW9uIFNpKG4pe3ZhciB0PW4uY2hpbGRyZW47cmV0dXJuIHQubGVuZ3RoP3RbMF06bi50fWZ1bmN0aW9uIGtpKG4pe3ZhciB0LHI9bi5jaGlsZHJlbjtyZXR1cm4odD1yLmxlbmd0aCk/clt0LTFdOm4udH1mdW5jdGlvbiBFaShuLHQscil7dmFyIGU9ci8odC5pLW4uaSk7dC5jLT1lLHQucys9cixuLmMrPWUsdC56Kz1yLHQubSs9cn1mdW5jdGlvbiBBaShuKXtmb3IodmFyIHQscj0wLGU9MCx1PW4uY2hpbGRyZW4saT11Lmxlbmd0aDstLWk+PTA7KXQ9dVtpXSx0LnorPXIsdC5tKz1yLHIrPXQucysoZSs9dC5jKX1mdW5jdGlvbiBDaShuLHQscil7cmV0dXJuIG4uYS5wYXJlbnQ9PT10LnBhcmVudD9uLmE6cn1mdW5jdGlvbiBOaShuKXtyZXR1cm4gMStCby5tYXgobixmdW5jdGlvbihuKXtyZXR1cm4gbi55fSl9ZnVuY3Rpb24gemkobil7cmV0dXJuIG4ucmVkdWNlKGZ1bmN0aW9uKG4sdCl7cmV0dXJuIG4rdC54fSwwKS9uLmxlbmd0aH1mdW5jdGlvbiBMaShuKXt2YXIgdD1uLmNoaWxkcmVuO3JldHVybiB0JiZ0Lmxlbmd0aD9MaSh0WzBdKTpufWZ1bmN0aW9uIFRpKG4pe3ZhciB0LHI9bi5jaGlsZHJlbjtyZXR1cm4gciYmKHQ9ci5sZW5ndGgpP1RpKHJbdC0xXSk6bn1mdW5jdGlvbiBxaShuKXtyZXR1cm57eDpuLngseTpuLnksZHg6bi5keCxkeTpuLmR5fX1mdW5jdGlvbiBSaShuLHQpe3ZhciByPW4ueCt0WzNdLGU9bi55K3RbMF0sdT1uLmR4LXRbMV0tdFszXSxpPW4uZHktdFswXS10WzJdO3JldHVybiAwPnUmJihyKz11LzIsdT0wKSwwPmkmJihlKz1pLzIsaT0wKSx7eDpyLHk6ZSxkeDp1LGR5Oml9fWZ1bmN0aW9uIERpKG4pe3ZhciB0PW5bMF0scj1uW24ubGVuZ3RoLTFdO3JldHVybiByPnQ/W3Qscl06W3IsdF19ZnVuY3Rpb24gUGkobil7cmV0dXJuIG4ucmFuZ2VFeHRlbnQ/bi5yYW5nZUV4dGVudCgpOkRpKG4ucmFuZ2UoKSl9ZnVuY3Rpb24gVWkobix0LHIsZSl7dmFyIHU9cihuWzBdLG5bMV0pLGk9ZSh0WzBdLHRbMV0pO3JldHVybiBmdW5jdGlvbihuKXtyZXR1cm4gaSh1KG4pKX19ZnVuY3Rpb24gamkobix0KXt2YXIgcixlPTAsdT1uLmxlbmd0aC0xLGk9bltlXSxvPW5bdV07cmV0dXJuIGk+byYmKHI9ZSxlPXUsdT1yLHI9aSxpPW8sbz1yKSxuW2VdPXQuZmxvb3IoaSksblt1XT10LmNlaWwobyksbn1mdW5jdGlvbiBIaShuKXtyZXR1cm4gbj97Zmxvb3I6ZnVuY3Rpb24odCl7cmV0dXJuIE1hdGguZmxvb3IodC9uKSpufSxjZWlsOmZ1bmN0aW9uKHQpe3JldHVybiBNYXRoLmNlaWwodC9uKSpufX06aHN9ZnVuY3Rpb24gRmkobix0LHIsZSl7dmFyIHU9W10saT1bXSxvPTAsYT1NYXRoLm1pbihuLmxlbmd0aCx0Lmxlbmd0aCktMTtmb3IoblthXTxuWzBdJiYobj1uLnNsaWNlKCkucmV2ZXJzZSgpLHQ9dC5zbGljZSgpLnJldmVyc2UoKSk7KytvPD1hOyl1LnB1c2gocihuW28tMV0sbltvXSkpLGkucHVzaChlKHRbby0xXSx0W29dKSk7cmV0dXJuIGZ1bmN0aW9uKHQpe3ZhciByPUJvLmJpc2VjdChuLHQsMSxhKS0xO3JldHVybiBpW3JdKHVbcl0odCkpfX1mdW5jdGlvbiBPaShuLHQscixlKXtmdW5jdGlvbiB1KCl7dmFyIHU9TWF0aC5taW4obi5sZW5ndGgsdC5sZW5ndGgpPjI/Rmk6VWksYz1lP091OkZ1O3JldHVybiBvPXUobix0LGMsciksYT11KHQsbixjLGR1KSxpfWZ1bmN0aW9uIGkobil7cmV0dXJuIG8obil9dmFyIG8sYTtyZXR1cm4gaS5pbnZlcnQ9ZnVuY3Rpb24obil7cmV0dXJuIGEobil9LGkuZG9tYWluPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhuPXQubWFwKE51bWJlciksdSgpKTpufSxpLnJhbmdlPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh0PW4sdSgpKTp0fSxpLnJhbmdlUm91bmQ9ZnVuY3Rpb24obil7cmV0dXJuIGkucmFuZ2UobikuaW50ZXJwb2xhdGUoUnUpfSxpLmNsYW1wPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhlPW4sdSgpKTplfSxpLmludGVycG9sYXRlPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhyPW4sdSgpKTpyfSxpLnRpY2tzPWZ1bmN0aW9uKHQpe3JldHVybiBWaShuLHQpfSxpLnRpY2tGb3JtYXQ9ZnVuY3Rpb24odCxyKXtyZXR1cm4gJGkobix0LHIpfSxpLm5pY2U9ZnVuY3Rpb24odCl7cmV0dXJuIFlpKG4sdCksdSgpfSxpLmNvcHk9ZnVuY3Rpb24oKXtyZXR1cm4gT2kobix0LHIsZSl9LHUoKX1mdW5jdGlvbiBJaShuLHQpe3JldHVybiBCby5yZWJpbmQobix0LCJyYW5nZSIsInJhbmdlUm91bmQiLCJpbnRlcnBvbGF0ZSIsImNsYW1wIil9ZnVuY3Rpb24gWWkobix0KXtyZXR1cm4gamkobixIaShaaShuLHQpWzJdKSl9ZnVuY3Rpb24gWmkobix0KXtudWxsPT10JiYodD0xMCk7dmFyIHI9RGkobiksZT1yWzFdLXJbMF0sdT1NYXRoLnBvdygxMCxNYXRoLmZsb29yKE1hdGgubG9nKGUvdCkvTWF0aC5MTjEwKSksaT10L2UqdTtyZXR1cm4uMTU+PWk/dSo9MTA6LjM1Pj1pP3UqPTU6Ljc1Pj1pJiYodSo9MiksclswXT1NYXRoLmNlaWwoclswXS91KSp1LHJbMV09TWF0aC5mbG9vcihyWzFdL3UpKnUrLjUqdSxyWzJdPXUscn1mdW5jdGlvbiBWaShuLHQpe3JldHVybiBCby5yYW5nZS5hcHBseShCbyxaaShuLHQpKX1mdW5jdGlvbiAkaShuLHQscil7dmFyIGU9Wmkobix0KTtpZihyKXt2YXIgdT1uYy5leGVjKHIpO2lmKHUuc2hpZnQoKSwicyI9PT11WzhdKXt2YXIgaT1Cby5mb3JtYXRQcmVmaXgoTWF0aC5tYXgoY2EoZVswXSksY2EoZVsxXSkpKTtyZXR1cm4gdVs3XXx8KHVbN109Ii4iK1hpKGkuc2NhbGUoZVsyXSkpKSx1WzhdPSJmIixyPUJvLmZvcm1hdCh1LmpvaW4oIiIpKSxmdW5jdGlvbihuKXtyZXR1cm4gcihpLnNjYWxlKG4pKStpLnN5bWJvbH19dVs3XXx8KHVbN109Ii4iK0JpKHVbOF0sZSkpLHI9dS5qb2luKCIiKX1lbHNlIHI9IiwuIitYaShlWzJdKSsiZiI7cmV0dXJuIEJvLmZvcm1hdChyKX1mdW5jdGlvbiBYaShuKXtyZXR1cm4tTWF0aC5mbG9vcihNYXRoLmxvZyhuKS9NYXRoLkxOMTArLjAxKX1mdW5jdGlvbiBCaShuLHQpe3ZhciByPVhpKHRbMl0pO3JldHVybiBuIGluIGdzP01hdGguYWJzKHItWGkoTWF0aC5tYXgoY2EodFswXSksY2EodFsxXSkpKSkrICsoImUiIT09bik6ci0yKigiJSI9PT1uKX1mdW5jdGlvbiBKaShuLHQscixlKXtmdW5jdGlvbiB1KG4pe3JldHVybihyP01hdGgubG9nKDA+bj8wOm4pOi1NYXRoLmxvZyhuPjA/MDotbikpL01hdGgubG9nKHQpfWZ1bmN0aW9uIGkobil7cmV0dXJuIHI/TWF0aC5wb3codCxuKTotTWF0aC5wb3codCwtbil9ZnVuY3Rpb24gbyh0KXtyZXR1cm4gbih1KHQpKX1yZXR1cm4gby5pbnZlcnQ9ZnVuY3Rpb24odCl7cmV0dXJuIGkobi5pbnZlcnQodCkpfSxvLmRvbWFpbj1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8ocj10WzBdPj0wLG4uZG9tYWluKChlPXQubWFwKE51bWJlcikpLm1hcCh1KSksbyk6ZX0sby5iYXNlPWZ1bmN0aW9uKHIpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh0PStyLG4uZG9tYWluKGUubWFwKHUpKSxvKTp0fSxvLm5pY2U9ZnVuY3Rpb24oKXt2YXIgdD1qaShlLm1hcCh1KSxyP01hdGg6dnMpO3JldHVybiBuLmRvbWFpbih0KSxlPXQubWFwKGkpLG99LG8udGlja3M9ZnVuY3Rpb24oKXt2YXIgbj1EaShlKSxvPVtdLGE9blswXSxjPW5bMV0scz1NYXRoLmZsb29yKHUoYSkpLGw9TWF0aC5jZWlsKHUoYykpLGY9dCUxPzI6dDtpZihpc0Zpbml0ZShsLXMpKXtpZihyKXtmb3IoO2w+cztzKyspZm9yKHZhciBoPTE7Zj5oO2grKylvLnB1c2goaShzKSpoKTtvLnB1c2goaShzKSl9ZWxzZSBmb3Ioby5wdXNoKGkocykpO3MrKzxsOylmb3IodmFyIGg9Zi0xO2g+MDtoLS0pby5wdXNoKGkocykqaCk7Zm9yKHM9MDtvW3NdPGE7cysrKTtmb3IobD1vLmxlbmd0aDtvW2wtMV0+YztsLS0pO289by5zbGljZShzLGwpfXJldHVybiBvfSxvLnRpY2tGb3JtYXQ9ZnVuY3Rpb24obix0KXtpZighYXJndW1lbnRzLmxlbmd0aClyZXR1cm4gcHM7YXJndW1lbnRzLmxlbmd0aDwyP3Q9cHM6ImZ1bmN0aW9uIiE9dHlwZW9mIHQmJih0PUJvLmZvcm1hdCh0KSk7dmFyIGUsYT1NYXRoLm1heCguMSxuL28udGlja3MoKS5sZW5ndGgpLGM9cj8oZT0xZS0xMixNYXRoLmNlaWwpOihlPS0xZS0xMixNYXRoLmZsb29yKTtyZXR1cm4gZnVuY3Rpb24obil7cmV0dXJuIG4vaShjKHUobikrZSkpPD1hP3Qobik6IiJ9fSxvLmNvcHk9ZnVuY3Rpb24oKXtyZXR1cm4gSmkobi5jb3B5KCksdCxyLGUpfSxJaShvLG4pfWZ1bmN0aW9uIFdpKG4sdCxyKXtmdW5jdGlvbiBlKHQpe3JldHVybiBuKHUodCkpfXZhciB1PUdpKHQpLGk9R2koMS90KTtyZXR1cm4gZS5pbnZlcnQ9ZnVuY3Rpb24odCl7cmV0dXJuIGkobi5pbnZlcnQodCkpfSxlLmRvbWFpbj1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obi5kb21haW4oKHI9dC5tYXAoTnVtYmVyKSkubWFwKHUpKSxlKTpyfSxlLnRpY2tzPWZ1bmN0aW9uKG4pe3JldHVybiBWaShyLG4pfSxlLnRpY2tGb3JtYXQ9ZnVuY3Rpb24obix0KXtyZXR1cm4gJGkocixuLHQpfSxlLm5pY2U9ZnVuY3Rpb24obil7cmV0dXJuIGUuZG9tYWluKFlpKHIsbikpfSxlLmV4cG9uZW50PWZ1bmN0aW9uKG8pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh1PUdpKHQ9byksaT1HaSgxL3QpLG4uZG9tYWluKHIubWFwKHUpKSxlKTp0fSxlLmNvcHk9ZnVuY3Rpb24oKXtyZXR1cm4gV2kobi5jb3B5KCksdCxyKX0sSWkoZSxuKX1mdW5jdGlvbiBHaShuKXtyZXR1cm4gZnVuY3Rpb24odCl7cmV0dXJuIDA+dD8tTWF0aC5wb3coLXQsbik6TWF0aC5wb3codCxuKX19ZnVuY3Rpb24gS2kobix0KXtmdW5jdGlvbiByKHIpe3JldHVybiBpWygodS5nZXQocil8fCgicmFuZ2UiPT09dC50P3Uuc2V0KHIsbi5wdXNoKHIpKTowLzApKS0xKSVpLmxlbmd0aF19ZnVuY3Rpb24gZSh0LHIpe3JldHVybiBCby5yYW5nZShuLmxlbmd0aCkubWFwKGZ1bmN0aW9uKG4pe3JldHVybiB0K3Iqbn0pfXZhciB1LGksYTtyZXR1cm4gci5kb21haW49ZnVuY3Rpb24oZSl7aWYoIWFyZ3VtZW50cy5sZW5ndGgpcmV0dXJuIG47bj1bXSx1PW5ldyBvO2Zvcih2YXIgaSxhPS0xLGM9ZS5sZW5ndGg7KythPGM7KXUuaGFzKGk9ZVthXSl8fHUuc2V0KGksbi5wdXNoKGkpKTtyZXR1cm4gclt0LnRdLmFwcGx5KHIsdC5hKX0sci5yYW5nZT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oaT1uLGE9MCx0PXt0OiJyYW5nZSIsYTphcmd1bWVudHN9LHIpOml9LHIucmFuZ2VQb2ludHM9ZnVuY3Rpb24odSxvKXthcmd1bWVudHMubGVuZ3RoPDImJihvPTApO3ZhciBjPXVbMF0scz11WzFdLGw9KHMtYykvKE1hdGgubWF4KDEsbi5sZW5ndGgtMSkrbyk7cmV0dXJuIGk9ZShuLmxlbmd0aDwyPyhjK3MpLzI6YytsKm8vMixsKSxhPTAsdD17dDoicmFuZ2VQb2ludHMiLGE6YXJndW1lbnRzfSxyfSxyLnJhbmdlQmFuZHM9ZnVuY3Rpb24odSxvLGMpe2FyZ3VtZW50cy5sZW5ndGg8MiYmKG89MCksYXJndW1lbnRzLmxlbmd0aDwzJiYoYz1vKTt2YXIgcz11WzFdPHVbMF0sbD11W3MtMF0sZj11WzEtc10saD0oZi1sKS8obi5sZW5ndGgtbysyKmMpO3JldHVybiBpPWUobCtoKmMsaCkscyYmaS5yZXZlcnNlKCksYT1oKigxLW8pLHQ9e3Q6InJhbmdlQmFuZHMiLGE6YXJndW1lbnRzfSxyfSxyLnJhbmdlUm91bmRCYW5kcz1mdW5jdGlvbih1LG8sYyl7YXJndW1lbnRzLmxlbmd0aDwyJiYobz0wKSxhcmd1bWVudHMubGVuZ3RoPDMmJihjPW8pO3ZhciBzPXVbMV08dVswXSxsPXVbcy0wXSxmPXVbMS1zXSxoPU1hdGguZmxvb3IoKGYtbCkvKG4ubGVuZ3RoLW8rMipjKSksZz1mLWwtKG4ubGVuZ3RoLW8pKmg7cmV0dXJuIGk9ZShsK01hdGgucm91bmQoZy8yKSxoKSxzJiZpLnJldmVyc2UoKSxhPU1hdGgucm91bmQoaCooMS1vKSksdD17dDoicmFuZ2VSb3VuZEJhbmRzIixhOmFyZ3VtZW50c30scn0sci5yYW5nZUJhbmQ9ZnVuY3Rpb24oKXtyZXR1cm4gYX0sci5yYW5nZUV4dGVudD1mdW5jdGlvbigpe3JldHVybiBEaSh0LmFbMF0pfSxyLmNvcHk9ZnVuY3Rpb24oKXtyZXR1cm4gS2kobix0KX0sci5kb21haW4obil9ZnVuY3Rpb24gUWkocixlKXtmdW5jdGlvbiB1KCl7dmFyIG49MCx0PWUubGVuZ3RoO2ZvcihvPVtdOysrbjx0OylvW24tMV09Qm8ucXVhbnRpbGUocixuL3QpO3JldHVybiBpfWZ1bmN0aW9uIGkobil7cmV0dXJuIGlzTmFOKG49K24pP3ZvaWQgMDplW0JvLmJpc2VjdChvLG4pXX12YXIgbztyZXR1cm4gaS5kb21haW49ZnVuY3Rpb24oZSl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHI9ZS5maWx0ZXIodCkuc29ydChuKSx1KCkpOnJ9LGkucmFuZ2U9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGU9bix1KCkpOmV9LGkucXVhbnRpbGVzPWZ1bmN0aW9uKCl7cmV0dXJuIG99LGkuaW52ZXJ0RXh0ZW50PWZ1bmN0aW9uKG4pe3JldHVybiBuPWUuaW5kZXhPZihuKSwwPm4/WzAvMCwwLzBdOltuPjA/b1tuLTFdOnJbMF0sbjxvLmxlbmd0aD9vW25dOnJbci5sZW5ndGgtMV1dfSxpLmNvcHk9ZnVuY3Rpb24oKXtyZXR1cm4gUWkocixlKX0sdSgpfWZ1bmN0aW9uIG5vKG4sdCxyKXtmdW5jdGlvbiBlKHQpe3JldHVybiByW01hdGgubWF4KDAsTWF0aC5taW4obyxNYXRoLmZsb29yKGkqKHQtbikpKSldfWZ1bmN0aW9uIHUoKXtyZXR1cm4gaT1yLmxlbmd0aC8odC1uKSxvPXIubGVuZ3RoLTEsZX12YXIgaSxvO3JldHVybiBlLmRvbWFpbj1mdW5jdGlvbihyKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obj0rclswXSx0PStyW3IubGVuZ3RoLTFdLHUoKSk6W24sdF19LGUucmFuZ2U9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHI9bix1KCkpOnJ9LGUuaW52ZXJ0RXh0ZW50PWZ1bmN0aW9uKHQpe3JldHVybiB0PXIuaW5kZXhPZih0KSx0PTA+dD8wLzA6dC9pK24sW3QsdCsxL2ldfSxlLmNvcHk9ZnVuY3Rpb24oKXtyZXR1cm4gbm8obix0LHIpfSx1KCl9ZnVuY3Rpb24gdG8obix0KXtmdW5jdGlvbiByKHIpe3JldHVybiByPj1yP3RbQm8uYmlzZWN0KG4scildOnZvaWQgMH1yZXR1cm4gci5kb21haW49ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KG49dCxyKTpufSxyLnJhbmdlPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh0PW4scik6dH0sci5pbnZlcnRFeHRlbnQ9ZnVuY3Rpb24ocil7cmV0dXJuIHI9dC5pbmRleE9mKHIpLFtuW3ItMV0sbltyXV19LHIuY29weT1mdW5jdGlvbigpe3JldHVybiB0byhuLHQpfSxyfWZ1bmN0aW9uIHJvKG4pe2Z1bmN0aW9uIHQobil7cmV0dXJuK259cmV0dXJuIHQuaW52ZXJ0PXQsdC5kb21haW49dC5yYW5nZT1mdW5jdGlvbihyKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obj1yLm1hcCh0KSx0KTpufSx0LnRpY2tzPWZ1bmN0aW9uKHQpe3JldHVybiBWaShuLHQpfSx0LnRpY2tGb3JtYXQ9ZnVuY3Rpb24odCxyKXtyZXR1cm4gJGkobix0LHIpfSx0LmNvcHk9ZnVuY3Rpb24oKXtyZXR1cm4gcm8obil9LHR9ZnVuY3Rpb24gZW8obil7cmV0dXJuIG4uaW5uZXJSYWRpdXN9ZnVuY3Rpb24gdW8obil7cmV0dXJuIG4ub3V0ZXJSYWRpdXN9ZnVuY3Rpb24gaW8obil7cmV0dXJuIG4uc3RhcnRBbmdsZX1mdW5jdGlvbiBvbyhuKXtyZXR1cm4gbi5lbmRBbmdsZX1mdW5jdGlvbiBhbyhuKXtmdW5jdGlvbiB0KHQpe2Z1bmN0aW9uIG8oKXtzLnB1c2goIk0iLGkobihsKSxhKSl9Zm9yKHZhciBjLHM9W10sbD1bXSxmPS0xLGg9dC5sZW5ndGgsZz1FdChyKSxwPUV0KGUpOysrZjxoOyl1LmNhbGwodGhpcyxjPXRbZl0sZik/bC5wdXNoKFsrZy5jYWxsKHRoaXMsYyxmKSwrcC5jYWxsKHRoaXMsYyxmKV0pOmwubGVuZ3RoJiYobygpLGw9W10pO3JldHVybiBsLmxlbmd0aCYmbygpLHMubGVuZ3RoP3Muam9pbigiIik6bnVsbH12YXIgcj1BZSxlPUNlLHU9QXIsaT1jbyxvPWkua2V5LGE9Ljc7cmV0dXJuIHQueD1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8ocj1uLHQpOnJ9LHQueT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oZT1uLHQpOmV9LHQuZGVmaW5lZD1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8odT1uLHQpOnV9LHQuaW50ZXJwb2xhdGU9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KG89ImZ1bmN0aW9uIj09dHlwZW9mIG4/aT1uOihpPWJzLmdldChuKXx8Y28pLmtleSx0KTpvfSx0LnRlbnNpb249ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGE9bix0KTphfSx0fWZ1bmN0aW9uIGNvKG4pe3JldHVybiBuLmpvaW4oIkwiKX1mdW5jdGlvbiBzbyhuKXtyZXR1cm4gY28obikrIloifWZ1bmN0aW9uIGxvKG4pe2Zvcih2YXIgdD0wLHI9bi5sZW5ndGgsZT1uWzBdLHU9W2VbMF0sIiwiLGVbMV1dOysrdDxyOyl1LnB1c2goIkgiLChlWzBdKyhlPW5bdF0pWzBdKS8yLCJWIixlWzFdKTtyZXR1cm4gcj4xJiZ1LnB1c2goIkgiLGVbMF0pLHUuam9pbigiIil9ZnVuY3Rpb24gZm8obil7Zm9yKHZhciB0PTAscj1uLmxlbmd0aCxlPW5bMF0sdT1bZVswXSwiLCIsZVsxXV07Kyt0PHI7KXUucHVzaCgiViIsKGU9blt0XSlbMV0sIkgiLGVbMF0pO3JldHVybiB1LmpvaW4oIiIpfWZ1bmN0aW9uIGhvKG4pe2Zvcih2YXIgdD0wLHI9bi5sZW5ndGgsZT1uWzBdLHU9W2VbMF0sIiwiLGVbMV1dOysrdDxyOyl1LnB1c2goIkgiLChlPW5bdF0pWzBdLCJWIixlWzFdKTtyZXR1cm4gdS5qb2luKCIiKX1mdW5jdGlvbiBnbyhuLHQpe3JldHVybiBuLmxlbmd0aDw0P2NvKG4pOm5bMV0rbW8obi5zbGljZSgxLG4ubGVuZ3RoLTEpLHlvKG4sdCkpfWZ1bmN0aW9uIHBvKG4sdCl7cmV0dXJuIG4ubGVuZ3RoPDM/Y28obik6blswXSttbygobi5wdXNoKG5bMF0pLG4pLHlvKFtuW24ubGVuZ3RoLTJdXS5jb25jYXQobixbblsxXV0pLHQpKX1mdW5jdGlvbiB2byhuLHQpe3JldHVybiBuLmxlbmd0aDwzP2NvKG4pOm5bMF0rbW8obix5byhuLHQpKX1mdW5jdGlvbiBtbyhuLHQpe2lmKHQubGVuZ3RoPDF8fG4ubGVuZ3RoIT10Lmxlbmd0aCYmbi5sZW5ndGghPXQubGVuZ3RoKzIpcmV0dXJuIGNvKG4pO3ZhciByPW4ubGVuZ3RoIT10Lmxlbmd0aCxlPSIiLHU9blswXSxpPW5bMV0sbz10WzBdLGE9byxjPTE7aWYociYmKGUrPSJRIisoaVswXS0yKm9bMF0vMykrIiwiKyhpWzFdLTIqb1sxXS8zKSsiLCIraVswXSsiLCIraVsxXSx1PW5bMV0sYz0yKSx0Lmxlbmd0aD4xKXthPXRbMV0saT1uW2NdLGMrKyxlKz0iQyIrKHVbMF0rb1swXSkrIiwiKyh1WzFdK29bMV0pKyIsIisoaVswXS1hWzBdKSsiLCIrKGlbMV0tYVsxXSkrIiwiK2lbMF0rIiwiK2lbMV07Zm9yKHZhciBzPTI7czx0Lmxlbmd0aDtzKyssYysrKWk9bltjXSxhPXRbc10sZSs9IlMiKyhpWzBdLWFbMF0pKyIsIisoaVsxXS1hWzFdKSsiLCIraVswXSsiLCIraVsxXX1pZihyKXt2YXIgbD1uW2NdO2UrPSJRIisoaVswXSsyKmFbMF0vMykrIiwiKyhpWzFdKzIqYVsxXS8zKSsiLCIrbFswXSsiLCIrbFsxXX1yZXR1cm4gZX1mdW5jdGlvbiB5byhuLHQpe2Zvcih2YXIgcixlPVtdLHU9KDEtdCkvMixpPW5bMF0sbz1uWzFdLGE9MSxjPW4ubGVuZ3RoOysrYTxjOylyPWksaT1vLG89blthXSxlLnB1c2goW3UqKG9bMF0tclswXSksdSoob1sxXS1yWzFdKV0pO3JldHVybiBlfWZ1bmN0aW9uIHhvKG4pe2lmKG4ubGVuZ3RoPDMpcmV0dXJuIGNvKG4pO3ZhciB0PTEscj1uLmxlbmd0aCxlPW5bMF0sdT1lWzBdLGk9ZVsxXSxvPVt1LHUsdSwoZT1uWzFdKVswXV0sYT1baSxpLGksZVsxXV0sYz1bdSwiLCIsaSwiTCIsd28oa3MsbyksIiwiLHdvKGtzLGEpXTtmb3Iobi5wdXNoKG5bci0xXSk7Kyt0PD1yOyllPW5bdF0sby5zaGlmdCgpLG8ucHVzaChlWzBdKSxhLnNoaWZ0KCksYS5wdXNoKGVbMV0pLFNvKGMsbyxhKTtyZXR1cm4gbi5wb3AoKSxjLnB1c2goIkwiLGUpLGMuam9pbigiIil9ZnVuY3Rpb24gTW8obil7aWYobi5sZW5ndGg8NClyZXR1cm4gY28obik7Zm9yKHZhciB0LHI9W10sZT0tMSx1PW4ubGVuZ3RoLGk9WzBdLG89WzBdOysrZTwzOyl0PW5bZV0saS5wdXNoKHRbMF0pLG8ucHVzaCh0WzFdKTtmb3Ioci5wdXNoKHdvKGtzLGkpKyIsIit3byhrcyxvKSksLS1lOysrZTx1Oyl0PW5bZV0saS5zaGlmdCgpLGkucHVzaCh0WzBdKSxvLnNoaWZ0KCksby5wdXNoKHRbMV0pLFNvKHIsaSxvKTtyZXR1cm4gci5qb2luKCIiKX1mdW5jdGlvbiBfbyhuKXtmb3IodmFyIHQscixlPS0xLHU9bi5sZW5ndGgsaT11KzQsbz1bXSxhPVtdOysrZTw0OylyPW5bZSV1XSxvLnB1c2goclswXSksYS5wdXNoKHJbMV0pO2Zvcih0PVt3byhrcyxvKSwiLCIsd28oa3MsYSldLC0tZTsrK2U8aTspcj1uW2UldV0sby5zaGlmdCgpLG8ucHVzaChyWzBdKSxhLnNoaWZ0KCksYS5wdXNoKHJbMV0pLFNvKHQsbyxhKTtyZXR1cm4gdC5qb2luKCIiKX1mdW5jdGlvbiBibyhuLHQpe3ZhciByPW4ubGVuZ3RoLTE7aWYocilmb3IodmFyIGUsdSxpPW5bMF1bMF0sbz1uWzBdWzFdLGE9bltyXVswXS1pLGM9bltyXVsxXS1vLHM9LTE7KytzPD1yOyllPW5bc10sdT1zL3IsZVswXT10KmVbMF0rKDEtdCkqKGkrdSphKSxlWzFdPXQqZVsxXSsoMS10KSoobyt1KmMpO3JldHVybiB4byhuKX1mdW5jdGlvbiB3byhuLHQpe3JldHVybiBuWzBdKnRbMF0rblsxXSp0WzFdK25bMl0qdFsyXStuWzNdKnRbM119ZnVuY3Rpb24gU28obix0LHIpe24ucHVzaCgiQyIsd28od3MsdCksIiwiLHdvKHdzLHIpLCIsIix3byhTcyx0KSwiLCIsd28oU3MsciksIiwiLHdvKGtzLHQpLCIsIix3byhrcyxyKSl9ZnVuY3Rpb24ga28obix0KXtyZXR1cm4odFsxXS1uWzFdKS8odFswXS1uWzBdKX1mdW5jdGlvbiBFbyhuKXtmb3IodmFyIHQ9MCxyPW4ubGVuZ3RoLTEsZT1bXSx1PW5bMF0saT1uWzFdLG89ZVswXT1rbyh1LGkpOysrdDxyOyllW3RdPShvKyhvPWtvKHU9aSxpPW5bdCsxXSkpKS8yO3JldHVybiBlW3RdPW8sZX1mdW5jdGlvbiBBbyhuKXtmb3IodmFyIHQscixlLHUsaT1bXSxvPUVvKG4pLGE9LTEsYz1uLmxlbmd0aC0xOysrYTxjOyl0PWtvKG5bYV0sblthKzFdKSxjYSh0KTxDYT9vW2FdPW9bYSsxXT0wOihyPW9bYV0vdCxlPW9bYSsxXS90LHU9cipyK2UqZSx1PjkmJih1PTMqdC9NYXRoLnNxcnQodSksb1thXT11KnIsb1thKzFdPXUqZSkpO2ZvcihhPS0xOysrYTw9YzspdT0obltNYXRoLm1pbihjLGErMSldWzBdLW5bTWF0aC5tYXgoMCxhLTEpXVswXSkvKDYqKDErb1thXSpvW2FdKSksaS5wdXNoKFt1fHwwLG9bYV0qdXx8MF0pO3JldHVybiBpfWZ1bmN0aW9uIENvKG4pe3JldHVybiBuLmxlbmd0aDwzP2NvKG4pOm5bMF0rbW8obixBbyhuKSl9ZnVuY3Rpb24gTm8obil7Zm9yKHZhciB0LHIsZSx1PS0xLGk9bi5sZW5ndGg7Kyt1PGk7KXQ9blt1XSxyPXRbMF0sZT10WzFdK01zLHRbMF09cipNYXRoLmNvcyhlKSx0WzFdPXIqTWF0aC5zaW4oZSk7cmV0dXJuIG59ZnVuY3Rpb24gem8obil7ZnVuY3Rpb24gdCh0KXtmdW5jdGlvbiBjKCl7di5wdXNoKCJNIixhKG4obSksZiksbCxzKG4oZC5yZXZlcnNlKCkpLGYpLCJaIil9Zm9yKHZhciBoLGcscCx2PVtdLGQ9W10sbT1bXSx5PS0xLHg9dC5sZW5ndGgsTT1FdChyKSxfPUV0KHUpLGI9cj09PWU/ZnVuY3Rpb24oKXtyZXR1cm4gZ306RXQoZSksdz11PT09aT9mdW5jdGlvbigpe3JldHVybiBwfTpFdChpKTsrK3k8eDspby5jYWxsKHRoaXMsaD10W3ldLHkpPyhkLnB1c2goW2c9K00uY2FsbCh0aGlzLGgseSkscD0rXy5jYWxsKHRoaXMsaCx5KV0pLG0ucHVzaChbK2IuY2FsbCh0aGlzLGgseSksK3cuY2FsbCh0aGlzLGgseSldKSk6ZC5sZW5ndGgmJihjKCksZD1bXSxtPVtdKTtyZXR1cm4gZC5sZW5ndGgmJmMoKSx2Lmxlbmd0aD92LmpvaW4oIiIpOm51bGx9dmFyIHI9QWUsZT1BZSx1PTAsaT1DZSxvPUFyLGE9Y28sYz1hLmtleSxzPWEsbD0iTCIsZj0uNztyZXR1cm4gdC54PWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhyPWU9bix0KTplfSx0LngwPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhyPW4sdCk6cn0sdC54MT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oZT1uLHQpOmV9LHQueT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8odT1pPW4sdCk6aX0sdC55MD1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8odT1uLHQpOnV9LHQueTE9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGk9bix0KTppfSx0LmRlZmluZWQ9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KG89bix0KTpvfSx0LmludGVycG9sYXRlPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhjPSJmdW5jdGlvbiI9PXR5cGVvZiBuP2E9bjooYT1icy5nZXQobil8fGNvKS5rZXkscz1hLnJldmVyc2V8fGEsbD1hLmNsb3NlZD8iTSI6IkwiLHQpOmN9LHQudGVuc2lvbj1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oZj1uLHQpOmZ9LHR9ZnVuY3Rpb24gTG8obil7cmV0dXJuIG4ucmFkaXVzfWZ1bmN0aW9uIFRvKG4pe3JldHVybltuLngsbi55XX1mdW5jdGlvbiBxbyhuKXtyZXR1cm4gZnVuY3Rpb24oKXt2YXIgdD1uLmFwcGx5KHRoaXMsYXJndW1lbnRzKSxyPXRbMF0sZT10WzFdK01zO3JldHVybltyKk1hdGguY29zKGUpLHIqTWF0aC5zaW4oZSldfX1mdW5jdGlvbiBSbygpe3JldHVybiA2NH1mdW5jdGlvbiBEbygpe3JldHVybiJjaXJjbGUifWZ1bmN0aW9uIFBvKG4pe3ZhciB0PU1hdGguc3FydChuL2thKTtyZXR1cm4iTTAsIit0KyJBIit0KyIsIit0KyIgMCAxLDEgMCwiKy10KyJBIit0KyIsIit0KyIgMCAxLDEgMCwiK3QrIloifWZ1bmN0aW9uIFVvKG4sdCl7cmV0dXJuIGdhKG4sTHMpLG4uaWQ9dCxufWZ1bmN0aW9uIGpvKG4sdCxyLGUpe3ZhciB1PW4uaWQ7cmV0dXJuIFAobiwiZnVuY3Rpb24iPT10eXBlb2Ygcj9mdW5jdGlvbihuLGksbyl7bi5fX3RyYW5zaXRpb25fX1t1XS50d2Vlbi5zZXQodCxlKHIuY2FsbChuLG4uX19kYXRhX18saSxvKSkpfToocj1lKHIpLGZ1bmN0aW9uKG4pe24uX190cmFuc2l0aW9uX19bdV0udHdlZW4uc2V0KHQscil9KSl9ZnVuY3Rpb24gSG8obil7cmV0dXJuIG51bGw9PW4mJihuPSIiKSxmdW5jdGlvbigpe3RoaXMudGV4dENvbnRlbnQ9bn19ZnVuY3Rpb24gRm8obix0LHIsZSl7dmFyIHU9bi5fX3RyYW5zaXRpb25fX3x8KG4uX190cmFuc2l0aW9uX189e2FjdGl2ZTowLGNvdW50OjB9KSxpPXVbcl07aWYoIWkpe3ZhciBhPWUudGltZTtpPXVbcl09e3R3ZWVuOm5ldyBvLHRpbWU6YSxlYXNlOmUuZWFzZSxkZWxheTplLmRlbGF5LGR1cmF0aW9uOmUuZHVyYXRpb259LCsrdS5jb3VudCxCby50aW1lcihmdW5jdGlvbihlKXtmdW5jdGlvbiBvKGUpe3JldHVybiB1LmFjdGl2ZT5yP3MoKToodS5hY3RpdmU9cixpLmV2ZW50JiZpLmV2ZW50LnN0YXJ0LmNhbGwobixsLHQpLGkudHdlZW4uZm9yRWFjaChmdW5jdGlvbihyLGUpeyhlPWUuY2FsbChuLGwsdCkpJiZ2LnB1c2goZSl9KSxCby50aW1lcihmdW5jdGlvbigpe3JldHVybiBwLmM9YyhlfHwxKT9BcjpjLDF9LDAsYSksdm9pZCAwKX1mdW5jdGlvbiBjKGUpe2lmKHUuYWN0aXZlIT09cilyZXR1cm4gcygpO2Zvcih2YXIgbz1lL2csYT1mKG8pLGM9di5sZW5ndGg7Yz4wOyl2Wy0tY10uY2FsbChuLGEpO3JldHVybiBvPj0xPyhpLmV2ZW50JiZpLmV2ZW50LmVuZC5jYWxsKG4sbCx0KSxzKCkpOnZvaWQgMH1mdW5jdGlvbiBzKCl7cmV0dXJuLS11LmNvdW50P2RlbGV0ZSB1W3JdOmRlbGV0ZSBuLl9fdHJhbnNpdGlvbl9fLDF9dmFyIGw9bi5fX2RhdGFfXyxmPWkuZWFzZSxoPWkuZGVsYXksZz1pLmR1cmF0aW9uLHA9R2Esdj1bXTtyZXR1cm4gcC50PWgrYSxlPj1oP28oZS1oKToocC5jPW8sdm9pZCAwKX0sMCxhKX19ZnVuY3Rpb24gT28obix0KXtuLmF0dHIoInRyYW5zZm9ybSIsZnVuY3Rpb24obil7cmV0dXJuInRyYW5zbGF0ZSgiK3QobikrIiwwKSJ9KX1mdW5jdGlvbiBJbyhuLHQpe24uYXR0cigidHJhbnNmb3JtIixmdW5jdGlvbihuKXtyZXR1cm4idHJhbnNsYXRlKDAsIit0KG4pKyIpIn0pfWZ1bmN0aW9uIFlvKG4pe3JldHVybiBuLnRvSVNPU3RyaW5nKCl9ZnVuY3Rpb24gWm8obix0LHIpe2Z1bmN0aW9uIGUodCl7cmV0dXJuIG4odCl9ZnVuY3Rpb24gdShuLHIpe3ZhciBlPW5bMV0tblswXSx1PWUvcixpPUJvLmJpc2VjdChGcyx1KTtyZXR1cm4gaT09RnMubGVuZ3RoP1t0LnllYXIsWmkobi5tYXAoZnVuY3Rpb24obil7cmV0dXJuIG4vMzE1MzZlNn0pLHIpWzJdXTppP3RbdS9Gc1tpLTFdPEZzW2ldL3U/aS0xOmldOltZcyxaaShuLHIpWzJdXX1yZXR1cm4gZS5pbnZlcnQ9ZnVuY3Rpb24odCl7cmV0dXJuIFZvKG4uaW52ZXJ0KHQpKQp9LGUuZG9tYWluPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhuLmRvbWFpbih0KSxlKTpuLmRvbWFpbigpLm1hcChWbyl9LGUubmljZT1mdW5jdGlvbihuLHQpe2Z1bmN0aW9uIHIocil7cmV0dXJuIWlzTmFOKHIpJiYhbi5yYW5nZShyLFZvKCtyKzEpLHQpLmxlbmd0aH12YXIgaT1lLmRvbWFpbigpLG89RGkoaSksYT1udWxsPT1uP3UobywxMCk6Im51bWJlciI9PXR5cGVvZiBuJiZ1KG8sbik7cmV0dXJuIGEmJihuPWFbMF0sdD1hWzFdKSxlLmRvbWFpbihqaShpLHQ+MT97Zmxvb3I6ZnVuY3Rpb24odCl7Zm9yKDtyKHQ9bi5mbG9vcih0KSk7KXQ9Vm8odC0xKTtyZXR1cm4gdH0sY2VpbDpmdW5jdGlvbih0KXtmb3IoO3IodD1uLmNlaWwodCkpOyl0PVZvKCt0KzEpO3JldHVybiB0fX06bikpfSxlLnRpY2tzPWZ1bmN0aW9uKG4sdCl7dmFyIHI9RGkoZS5kb21haW4oKSksaT1udWxsPT1uP3UociwxMCk6Im51bWJlciI9PXR5cGVvZiBuP3UocixuKTohbi5yYW5nZSYmW3tyYW5nZTpufSx0XTtyZXR1cm4gaSYmKG49aVswXSx0PWlbMV0pLG4ucmFuZ2UoclswXSxWbygrclsxXSsxKSwxPnQ/MTp0KX0sZS50aWNrRm9ybWF0PWZ1bmN0aW9uKCl7cmV0dXJuIHJ9LGUuY29weT1mdW5jdGlvbigpe3JldHVybiBabyhuLmNvcHkoKSx0LHIpfSxJaShlLG4pfWZ1bmN0aW9uIFZvKG4pe3JldHVybiBuZXcgRGF0ZShuKX1mdW5jdGlvbiAkbyhuKXtyZXR1cm4gSlNPTi5wYXJzZShuLnJlc3BvbnNlVGV4dCl9ZnVuY3Rpb24gWG8obil7dmFyIHQ9R28uY3JlYXRlUmFuZ2UoKTtyZXR1cm4gdC5zZWxlY3ROb2RlKEdvLmJvZHkpLHQuY3JlYXRlQ29udGV4dHVhbEZyYWdtZW50KG4ucmVzcG9uc2VUZXh0KX12YXIgQm89e3ZlcnNpb246IjMuNC44In07RGF0ZS5ub3d8fChEYXRlLm5vdz1mdW5jdGlvbigpe3JldHVybituZXcgRGF0ZX0pO3ZhciBKbz1bXS5zbGljZSxXbz1mdW5jdGlvbihuKXtyZXR1cm4gSm8uY2FsbChuKX0sR289ZG9jdW1lbnQsS289R28uZG9jdW1lbnRFbGVtZW50LFFvPXdpbmRvdzt0cnl7V28oS28uY2hpbGROb2RlcylbMF0ubm9kZVR5cGV9Y2F0Y2gobmEpe1dvPWZ1bmN0aW9uKG4pe2Zvcih2YXIgdD1uLmxlbmd0aCxyPW5ldyBBcnJheSh0KTt0LS07KXJbdF09blt0XTtyZXR1cm4gcn19dHJ5e0dvLmNyZWF0ZUVsZW1lbnQoImRpdiIpLnN0eWxlLnNldFByb3BlcnR5KCJvcGFjaXR5IiwwLCIiKX1jYXRjaCh0YSl7dmFyIHJhPVFvLkVsZW1lbnQucHJvdG90eXBlLGVhPXJhLnNldEF0dHJpYnV0ZSx1YT1yYS5zZXRBdHRyaWJ1dGVOUyxpYT1Rby5DU1NTdHlsZURlY2xhcmF0aW9uLnByb3RvdHlwZSxvYT1pYS5zZXRQcm9wZXJ0eTtyYS5zZXRBdHRyaWJ1dGU9ZnVuY3Rpb24obix0KXtlYS5jYWxsKHRoaXMsbix0KyIiKX0scmEuc2V0QXR0cmlidXRlTlM9ZnVuY3Rpb24obix0LHIpe3VhLmNhbGwodGhpcyxuLHQscisiIil9LGlhLnNldFByb3BlcnR5PWZ1bmN0aW9uKG4sdCxyKXtvYS5jYWxsKHRoaXMsbix0KyIiLHIpfX1Cby5hc2NlbmRpbmc9bixCby5kZXNjZW5kaW5nPWZ1bmN0aW9uKG4sdCl7cmV0dXJuIG4+dD8tMTp0Pm4/MTp0Pj1uPzA6MC8wfSxCby5taW49ZnVuY3Rpb24obix0KXt2YXIgcixlLHU9LTEsaT1uLmxlbmd0aDtpZigxPT09YXJndW1lbnRzLmxlbmd0aCl7Zm9yKDsrK3U8aSYmIShudWxsIT0ocj1uW3VdKSYmcj49cik7KXI9dm9pZCAwO2Zvcig7Kyt1PGk7KW51bGwhPShlPW5bdV0pJiZyPmUmJihyPWUpfWVsc2V7Zm9yKDsrK3U8aSYmIShudWxsIT0ocj10LmNhbGwobixuW3VdLHUpKSYmcj49cik7KXI9dm9pZCAwO2Zvcig7Kyt1PGk7KW51bGwhPShlPXQuY2FsbChuLG5bdV0sdSkpJiZyPmUmJihyPWUpfXJldHVybiByfSxCby5tYXg9ZnVuY3Rpb24obix0KXt2YXIgcixlLHU9LTEsaT1uLmxlbmd0aDtpZigxPT09YXJndW1lbnRzLmxlbmd0aCl7Zm9yKDsrK3U8aSYmIShudWxsIT0ocj1uW3VdKSYmcj49cik7KXI9dm9pZCAwO2Zvcig7Kyt1PGk7KW51bGwhPShlPW5bdV0pJiZlPnImJihyPWUpfWVsc2V7Zm9yKDsrK3U8aSYmIShudWxsIT0ocj10LmNhbGwobixuW3VdLHUpKSYmcj49cik7KXI9dm9pZCAwO2Zvcig7Kyt1PGk7KW51bGwhPShlPXQuY2FsbChuLG5bdV0sdSkpJiZlPnImJihyPWUpfXJldHVybiByfSxCby5leHRlbnQ9ZnVuY3Rpb24obix0KXt2YXIgcixlLHUsaT0tMSxvPW4ubGVuZ3RoO2lmKDE9PT1hcmd1bWVudHMubGVuZ3RoKXtmb3IoOysraTxvJiYhKG51bGwhPShyPXU9bltpXSkmJnI+PXIpOylyPXU9dm9pZCAwO2Zvcig7KytpPG87KW51bGwhPShlPW5baV0pJiYocj5lJiYocj1lKSxlPnUmJih1PWUpKX1lbHNle2Zvcig7KytpPG8mJiEobnVsbCE9KHI9dT10LmNhbGwobixuW2ldLGkpKSYmcj49cik7KXI9dm9pZCAwO2Zvcig7KytpPG87KW51bGwhPShlPXQuY2FsbChuLG5baV0saSkpJiYocj5lJiYocj1lKSxlPnUmJih1PWUpKX1yZXR1cm5bcix1XX0sQm8uc3VtPWZ1bmN0aW9uKG4sdCl7dmFyIHIsZT0wLHU9bi5sZW5ndGgsaT0tMTtpZigxPT09YXJndW1lbnRzLmxlbmd0aClmb3IoOysraTx1Oylpc05hTihyPStuW2ldKXx8KGUrPXIpO2Vsc2UgZm9yKDsrK2k8dTspaXNOYU4ocj0rdC5jYWxsKG4sbltpXSxpKSl8fChlKz1yKTtyZXR1cm4gZX0sQm8ubWVhbj1mdW5jdGlvbihuLHIpe3ZhciBlLHU9MCxpPW4ubGVuZ3RoLG89LTEsYT1pO2lmKDE9PT1hcmd1bWVudHMubGVuZ3RoKWZvcig7KytvPGk7KXQoZT1uW29dKT91Kz1lOi0tYTtlbHNlIGZvcig7KytvPGk7KXQoZT1yLmNhbGwobixuW29dLG8pKT91Kz1lOi0tYTtyZXR1cm4gYT91L2E6dm9pZCAwfSxCby5xdWFudGlsZT1mdW5jdGlvbihuLHQpe3ZhciByPShuLmxlbmd0aC0xKSp0KzEsZT1NYXRoLmZsb29yKHIpLHU9K25bZS0xXSxpPXItZTtyZXR1cm4gaT91K2kqKG5bZV0tdSk6dX0sQm8ubWVkaWFuPWZ1bmN0aW9uKHIsZSl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg+MSYmKHI9ci5tYXAoZSkpLHI9ci5maWx0ZXIodCksci5sZW5ndGg/Qm8ucXVhbnRpbGUoci5zb3J0KG4pLC41KTp2b2lkIDB9O3ZhciBhYT1yKG4pO0JvLmJpc2VjdExlZnQ9YWEubGVmdCxCby5iaXNlY3Q9Qm8uYmlzZWN0UmlnaHQ9YWEucmlnaHQsQm8uYmlzZWN0b3I9ZnVuY3Rpb24odCl7cmV0dXJuIHIoMT09PXQubGVuZ3RoP2Z1bmN0aW9uKHIsZSl7cmV0dXJuIG4odChyKSxlKX06dCl9LEJvLnNodWZmbGU9ZnVuY3Rpb24obil7Zm9yKHZhciB0LHIsZT1uLmxlbmd0aDtlOylyPTB8TWF0aC5yYW5kb20oKSplLS0sdD1uW2VdLG5bZV09bltyXSxuW3JdPXQ7cmV0dXJuIG59LEJvLnBlcm11dGU9ZnVuY3Rpb24obix0KXtmb3IodmFyIHI9dC5sZW5ndGgsZT1uZXcgQXJyYXkocik7ci0tOyllW3JdPW5bdFtyXV07cmV0dXJuIGV9LEJvLnBhaXJzPWZ1bmN0aW9uKG4pe2Zvcih2YXIgdCxyPTAsZT1uLmxlbmd0aC0xLHU9blswXSxpPW5ldyBBcnJheSgwPmU/MDplKTtlPnI7KWlbcl09W3Q9dSx1PW5bKytyXV07cmV0dXJuIGl9LEJvLnppcD1mdW5jdGlvbigpe2lmKCEodT1hcmd1bWVudHMubGVuZ3RoKSlyZXR1cm5bXTtmb3IodmFyIG49LTEsdD1Cby5taW4oYXJndW1lbnRzLGUpLHI9bmV3IEFycmF5KHQpOysrbjx0Oylmb3IodmFyIHUsaT0tMSxvPXJbbl09bmV3IEFycmF5KHUpOysraTx1OylvW2ldPWFyZ3VtZW50c1tpXVtuXTtyZXR1cm4gcn0sQm8udHJhbnNwb3NlPWZ1bmN0aW9uKG4pe3JldHVybiBCby56aXAuYXBwbHkoQm8sbil9LEJvLmtleXM9ZnVuY3Rpb24obil7dmFyIHQ9W107Zm9yKHZhciByIGluIG4pdC5wdXNoKHIpO3JldHVybiB0fSxCby52YWx1ZXM9ZnVuY3Rpb24obil7dmFyIHQ9W107Zm9yKHZhciByIGluIG4pdC5wdXNoKG5bcl0pO3JldHVybiB0fSxCby5lbnRyaWVzPWZ1bmN0aW9uKG4pe3ZhciB0PVtdO2Zvcih2YXIgciBpbiBuKXQucHVzaCh7a2V5OnIsdmFsdWU6bltyXX0pO3JldHVybiB0fSxCby5tZXJnZT1mdW5jdGlvbihuKXtmb3IodmFyIHQscixlLHU9bi5sZW5ndGgsaT0tMSxvPTA7KytpPHU7KW8rPW5baV0ubGVuZ3RoO2ZvcihyPW5ldyBBcnJheShvKTstLXU+PTA7KWZvcihlPW5bdV0sdD1lLmxlbmd0aDstLXQ+PTA7KXJbLS1vXT1lW3RdO3JldHVybiByfTt2YXIgY2E9TWF0aC5hYnM7Qm8ucmFuZ2U9ZnVuY3Rpb24obix0LHIpe2lmKGFyZ3VtZW50cy5sZW5ndGg8MyYmKHI9MSxhcmd1bWVudHMubGVuZ3RoPDImJih0PW4sbj0wKSksMS8wPT09KHQtbikvcil0aHJvdyBuZXcgRXJyb3IoImluZmluaXRlIHJhbmdlIik7dmFyIGUsaT1bXSxvPXUoY2EocikpLGE9LTE7aWYobio9byx0Kj1vLHIqPW8sMD5yKWZvcig7KGU9bityKisrYSk+dDspaS5wdXNoKGUvbyk7ZWxzZSBmb3IoOyhlPW4rciorK2EpPHQ7KWkucHVzaChlL28pO3JldHVybiBpfSxCby5tYXA9ZnVuY3Rpb24obil7dmFyIHQ9bmV3IG87aWYobiBpbnN0YW5jZW9mIG8pbi5mb3JFYWNoKGZ1bmN0aW9uKG4scil7dC5zZXQobixyKX0pO2Vsc2UgZm9yKHZhciByIGluIG4pdC5zZXQocixuW3JdKTtyZXR1cm4gdH0saShvLHtoYXM6YSxnZXQ6ZnVuY3Rpb24obil7cmV0dXJuIHRoaXNbc2Erbl19LHNldDpmdW5jdGlvbihuLHQpe3JldHVybiB0aGlzW3NhK25dPXR9LHJlbW92ZTpjLGtleXM6cyx2YWx1ZXM6ZnVuY3Rpb24oKXt2YXIgbj1bXTtyZXR1cm4gdGhpcy5mb3JFYWNoKGZ1bmN0aW9uKHQscil7bi5wdXNoKHIpfSksbn0sZW50cmllczpmdW5jdGlvbigpe3ZhciBuPVtdO3JldHVybiB0aGlzLmZvckVhY2goZnVuY3Rpb24odCxyKXtuLnB1c2goe2tleTp0LHZhbHVlOnJ9KX0pLG59LHNpemU6bCxlbXB0eTpmLGZvckVhY2g6ZnVuY3Rpb24obil7Zm9yKHZhciB0IGluIHRoaXMpdC5jaGFyQ29kZUF0KDApPT09bGEmJm4uY2FsbCh0aGlzLHQuc3Vic3RyaW5nKDEpLHRoaXNbdF0pfX0pO3ZhciBzYT0iXHgwMCIsbGE9c2EuY2hhckNvZGVBdCgwKTtCby5uZXN0PWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbih0LGEsYyl7aWYoYz49aS5sZW5ndGgpcmV0dXJuIGU/ZS5jYWxsKHUsYSk6cj9hLnNvcnQocik6YTtmb3IodmFyIHMsbCxmLGgsZz0tMSxwPWEubGVuZ3RoLHY9aVtjKytdLGQ9bmV3IG87KytnPHA7KShoPWQuZ2V0KHM9dihsPWFbZ10pKSk/aC5wdXNoKGwpOmQuc2V0KHMsW2xdKTtyZXR1cm4gdD8obD10KCksZj1mdW5jdGlvbihyLGUpe2wuc2V0KHIsbih0LGUsYykpfSk6KGw9e30sZj1mdW5jdGlvbihyLGUpe2xbcl09bih0LGUsYyl9KSxkLmZvckVhY2goZiksbH1mdW5jdGlvbiB0KG4scil7aWYocj49aS5sZW5ndGgpcmV0dXJuIG47dmFyIGU9W10sdT1hW3IrK107cmV0dXJuIG4uZm9yRWFjaChmdW5jdGlvbihuLHUpe2UucHVzaCh7a2V5Om4sdmFsdWVzOnQodSxyKX0pfSksdT9lLnNvcnQoZnVuY3Rpb24obix0KXtyZXR1cm4gdShuLmtleSx0LmtleSl9KTplfXZhciByLGUsdT17fSxpPVtdLGE9W107cmV0dXJuIHUubWFwPWZ1bmN0aW9uKHQscil7cmV0dXJuIG4ocix0LDApfSx1LmVudHJpZXM9ZnVuY3Rpb24ocil7cmV0dXJuIHQobihCby5tYXAsciwwKSwwKX0sdS5rZXk9ZnVuY3Rpb24obil7cmV0dXJuIGkucHVzaChuKSx1fSx1LnNvcnRLZXlzPWZ1bmN0aW9uKG4pe3JldHVybiBhW2kubGVuZ3RoLTFdPW4sdX0sdS5zb3J0VmFsdWVzPWZ1bmN0aW9uKG4pe3JldHVybiByPW4sdX0sdS5yb2xsdXA9ZnVuY3Rpb24obil7cmV0dXJuIGU9bix1fSx1fSxCby5zZXQ9ZnVuY3Rpb24obil7dmFyIHQ9bmV3IGg7aWYobilmb3IodmFyIHI9MCxlPW4ubGVuZ3RoO2U+cjsrK3IpdC5hZGQobltyXSk7cmV0dXJuIHR9LGkoaCx7aGFzOmEsYWRkOmZ1bmN0aW9uKG4pe3JldHVybiB0aGlzW3NhK25dPSEwLG59LHJlbW92ZTpmdW5jdGlvbihuKXtyZXR1cm4gbj1zYStuLG4gaW4gdGhpcyYmZGVsZXRlIHRoaXNbbl19LHZhbHVlczpzLHNpemU6bCxlbXB0eTpmLGZvckVhY2g6ZnVuY3Rpb24obil7Zm9yKHZhciB0IGluIHRoaXMpdC5jaGFyQ29kZUF0KDApPT09bGEmJm4uY2FsbCh0aGlzLHQuc3Vic3RyaW5nKDEpKX19KSxCby5iZWhhdmlvcj17fSxCby5yZWJpbmQ9ZnVuY3Rpb24obix0KXtmb3IodmFyIHIsZT0xLHU9YXJndW1lbnRzLmxlbmd0aDsrK2U8dTspbltyPWFyZ3VtZW50c1tlXV09ZyhuLHQsdFtyXSk7cmV0dXJuIG59O3ZhciBmYT1bIndlYmtpdCIsIm1zIiwibW96IiwiTW96IiwibyIsIk8iXTtCby5kaXNwYXRjaD1mdW5jdGlvbigpe2Zvcih2YXIgbj1uZXcgZCx0PS0xLHI9YXJndW1lbnRzLmxlbmd0aDsrK3Q8cjspblthcmd1bWVudHNbdF1dPW0obik7cmV0dXJuIG59LGQucHJvdG90eXBlLm9uPWZ1bmN0aW9uKG4sdCl7dmFyIHI9bi5pbmRleE9mKCIuIiksZT0iIjtpZihyPj0wJiYoZT1uLnN1YnN0cmluZyhyKzEpLG49bi5zdWJzdHJpbmcoMCxyKSksbilyZXR1cm4gYXJndW1lbnRzLmxlbmd0aDwyP3RoaXNbbl0ub24oZSk6dGhpc1tuXS5vbihlLHQpO2lmKDI9PT1hcmd1bWVudHMubGVuZ3RoKXtpZihudWxsPT10KWZvcihuIGluIHRoaXMpdGhpcy5oYXNPd25Qcm9wZXJ0eShuKSYmdGhpc1tuXS5vbihlLG51bGwpO3JldHVybiB0aGlzfX0sQm8uZXZlbnQ9bnVsbCxCby5yZXF1b3RlPWZ1bmN0aW9uKG4pe3JldHVybiBuLnJlcGxhY2UoaGEsIlxcJCYiKX07dmFyIGhhPS9bXFxcXlwkXCpcK1w/XHxcW1xdXChcKVwuXHtcfV0vZyxnYT17fS5fX3Byb3RvX18/ZnVuY3Rpb24obix0KXtuLl9fcHJvdG9fXz10fTpmdW5jdGlvbihuLHQpe2Zvcih2YXIgciBpbiB0KW5bcl09dFtyXX0scGE9ZnVuY3Rpb24obix0KXtyZXR1cm4gdC5xdWVyeVNlbGVjdG9yKG4pfSx2YT1mdW5jdGlvbihuLHQpe3JldHVybiB0LnF1ZXJ5U2VsZWN0b3JBbGwobil9LGRhPUtvW3AoS28sIm1hdGNoZXNTZWxlY3RvciIpXSxtYT1mdW5jdGlvbihuLHQpe3JldHVybiBkYS5jYWxsKG4sdCl9OyJmdW5jdGlvbiI9PXR5cGVvZiBTaXp6bGUmJihwYT1mdW5jdGlvbihuLHQpe3JldHVybiBTaXp6bGUobix0KVswXXx8bnVsbH0sdmE9U2l6emxlLG1hPVNpenpsZS5tYXRjaGVzU2VsZWN0b3IpLEJvLnNlbGVjdGlvbj1mdW5jdGlvbigpe3JldHVybiBfYX07dmFyIHlhPUJvLnNlbGVjdGlvbi5wcm90b3R5cGU9W107eWEuc2VsZWN0PWZ1bmN0aW9uKG4pe3ZhciB0LHIsZSx1LGk9W107bj1iKG4pO2Zvcih2YXIgbz0tMSxhPXRoaXMubGVuZ3RoOysrbzxhOyl7aS5wdXNoKHQ9W10pLHQucGFyZW50Tm9kZT0oZT10aGlzW29dKS5wYXJlbnROb2RlO2Zvcih2YXIgYz0tMSxzPWUubGVuZ3RoOysrYzxzOykodT1lW2NdKT8odC5wdXNoKHI9bi5jYWxsKHUsdS5fX2RhdGFfXyxjLG8pKSxyJiYiX19kYXRhX18iaW4gdSYmKHIuX19kYXRhX189dS5fX2RhdGFfXykpOnQucHVzaChudWxsKX1yZXR1cm4gXyhpKX0seWEuc2VsZWN0QWxsPWZ1bmN0aW9uKG4pe3ZhciB0LHIsZT1bXTtuPXcobik7Zm9yKHZhciB1PS0xLGk9dGhpcy5sZW5ndGg7Kyt1PGk7KWZvcih2YXIgbz10aGlzW3VdLGE9LTEsYz1vLmxlbmd0aDsrK2E8YzspKHI9b1thXSkmJihlLnB1c2godD1XbyhuLmNhbGwocixyLl9fZGF0YV9fLGEsdSkpKSx0LnBhcmVudE5vZGU9cik7cmV0dXJuIF8oZSl9O3ZhciB4YT17c3ZnOiJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIseGh0bWw6Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiLHhsaW5rOiJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIix4bWw6Imh0dHA6Ly93d3cudzMub3JnL1hNTC8xOTk4L25hbWVzcGFjZSIseG1sbnM6Imh0dHA6Ly93d3cudzMub3JnLzIwMDAveG1sbnMvIn07Qm8ubnM9e3ByZWZpeDp4YSxxdWFsaWZ5OmZ1bmN0aW9uKG4pe3ZhciB0PW4uaW5kZXhPZigiOiIpLHI9bjtyZXR1cm4gdD49MCYmKHI9bi5zdWJzdHJpbmcoMCx0KSxuPW4uc3Vic3RyaW5nKHQrMSkpLHhhLmhhc093blByb3BlcnR5KHIpP3tzcGFjZTp4YVtyXSxsb2NhbDpufTpufX0seWEuYXR0cj1mdW5jdGlvbihuLHQpe2lmKGFyZ3VtZW50cy5sZW5ndGg8Mil7aWYoInN0cmluZyI9PXR5cGVvZiBuKXt2YXIgcj10aGlzLm5vZGUoKTtyZXR1cm4gbj1Cby5ucy5xdWFsaWZ5KG4pLG4ubG9jYWw/ci5nZXRBdHRyaWJ1dGVOUyhuLnNwYWNlLG4ubG9jYWwpOnIuZ2V0QXR0cmlidXRlKG4pfWZvcih0IGluIG4pdGhpcy5lYWNoKFModCxuW3RdKSk7cmV0dXJuIHRoaXN9cmV0dXJuIHRoaXMuZWFjaChTKG4sdCkpfSx5YS5jbGFzc2VkPWZ1bmN0aW9uKG4sdCl7aWYoYXJndW1lbnRzLmxlbmd0aDwyKXtpZigic3RyaW5nIj09dHlwZW9mIG4pe3ZhciByPXRoaXMubm9kZSgpLGU9KG49QShuKSkubGVuZ3RoLHU9LTE7aWYodD1yLmNsYXNzTGlzdCl7Zm9yKDsrK3U8ZTspaWYoIXQuY29udGFpbnMoblt1XSkpcmV0dXJuITF9ZWxzZSBmb3IodD1yLmdldEF0dHJpYnV0ZSgiY2xhc3MiKTsrK3U8ZTspaWYoIUUoblt1XSkudGVzdCh0KSlyZXR1cm4hMTtyZXR1cm4hMH1mb3IodCBpbiBuKXRoaXMuZWFjaChDKHQsblt0XSkpO3JldHVybiB0aGlzfXJldHVybiB0aGlzLmVhY2goQyhuLHQpKX0seWEuc3R5bGU9ZnVuY3Rpb24obix0LHIpe3ZhciBlPWFyZ3VtZW50cy5sZW5ndGg7aWYoMz5lKXtpZigic3RyaW5nIiE9dHlwZW9mIG4pezI+ZSYmKHQ9IiIpO2ZvcihyIGluIG4pdGhpcy5lYWNoKHoocixuW3JdLHQpKTtyZXR1cm4gdGhpc31pZigyPmUpcmV0dXJuIFFvLmdldENvbXB1dGVkU3R5bGUodGhpcy5ub2RlKCksbnVsbCkuZ2V0UHJvcGVydHlWYWx1ZShuKTtyPSIifXJldHVybiB0aGlzLmVhY2goeihuLHQscikpfSx5YS5wcm9wZXJ0eT1mdW5jdGlvbihuLHQpe2lmKGFyZ3VtZW50cy5sZW5ndGg8Mil7aWYoInN0cmluZyI9PXR5cGVvZiBuKXJldHVybiB0aGlzLm5vZGUoKVtuXTtmb3IodCBpbiBuKXRoaXMuZWFjaChMKHQsblt0XSkpO3JldHVybiB0aGlzfXJldHVybiB0aGlzLmVhY2goTChuLHQpKX0seWEudGV4dD1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD90aGlzLmVhY2goImZ1bmN0aW9uIj09dHlwZW9mIG4/ZnVuY3Rpb24oKXt2YXIgdD1uLmFwcGx5KHRoaXMsYXJndW1lbnRzKTt0aGlzLnRleHRDb250ZW50PW51bGw9PXQ/IiI6dH06bnVsbD09bj9mdW5jdGlvbigpe3RoaXMudGV4dENvbnRlbnQ9IiJ9OmZ1bmN0aW9uKCl7dGhpcy50ZXh0Q29udGVudD1ufSk6dGhpcy5ub2RlKCkudGV4dENvbnRlbnR9LHlhLmh0bWw9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/dGhpcy5lYWNoKCJmdW5jdGlvbiI9PXR5cGVvZiBuP2Z1bmN0aW9uKCl7dmFyIHQ9bi5hcHBseSh0aGlzLGFyZ3VtZW50cyk7dGhpcy5pbm5lckhUTUw9bnVsbD09dD8iIjp0fTpudWxsPT1uP2Z1bmN0aW9uKCl7dGhpcy5pbm5lckhUTUw9IiJ9OmZ1bmN0aW9uKCl7dGhpcy5pbm5lckhUTUw9bn0pOnRoaXMubm9kZSgpLmlubmVySFRNTH0seWEuYXBwZW5kPWZ1bmN0aW9uKG4pe3JldHVybiBuPVQobiksdGhpcy5zZWxlY3QoZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5hcHBlbmRDaGlsZChuLmFwcGx5KHRoaXMsYXJndW1lbnRzKSl9KX0seWEuaW5zZXJ0PWZ1bmN0aW9uKG4sdCl7cmV0dXJuIG49VChuKSx0PWIodCksdGhpcy5zZWxlY3QoZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5pbnNlcnRCZWZvcmUobi5hcHBseSh0aGlzLGFyZ3VtZW50cyksdC5hcHBseSh0aGlzLGFyZ3VtZW50cyl8fG51bGwpfSl9LHlhLnJlbW92ZT1mdW5jdGlvbigpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgbj10aGlzLnBhcmVudE5vZGU7biYmbi5yZW1vdmVDaGlsZCh0aGlzKX0pfSx5YS5kYXRhPWZ1bmN0aW9uKG4sdCl7ZnVuY3Rpb24gcihuLHIpe3ZhciBlLHUsaSxhPW4ubGVuZ3RoLGY9ci5sZW5ndGgsaD1NYXRoLm1pbihhLGYpLGc9bmV3IEFycmF5KGYpLHA9bmV3IEFycmF5KGYpLHY9bmV3IEFycmF5KGEpO2lmKHQpe3ZhciBkLG09bmV3IG8seT1uZXcgbyx4PVtdO2ZvcihlPS0xOysrZTxhOylkPXQuY2FsbCh1PW5bZV0sdS5fX2RhdGFfXyxlKSxtLmhhcyhkKT92W2VdPXU6bS5zZXQoZCx1KSx4LnB1c2goZCk7Zm9yKGU9LTE7KytlPGY7KWQ9dC5jYWxsKHIsaT1yW2VdLGUpLCh1PW0uZ2V0KGQpKT8oZ1tlXT11LHUuX19kYXRhX189aSk6eS5oYXMoZCl8fChwW2VdPXEoaSkpLHkuc2V0KGQsaSksbS5yZW1vdmUoZCk7Zm9yKGU9LTE7KytlPGE7KW0uaGFzKHhbZV0pJiYodltlXT1uW2VdKX1lbHNle2ZvcihlPS0xOysrZTxoOyl1PW5bZV0saT1yW2VdLHU/KHUuX19kYXRhX189aSxnW2VdPXUpOnBbZV09cShpKTtmb3IoO2Y+ZTsrK2UpcFtlXT1xKHJbZV0pO2Zvcig7YT5lOysrZSl2W2VdPW5bZV19cC51cGRhdGU9ZyxwLnBhcmVudE5vZGU9Zy5wYXJlbnROb2RlPXYucGFyZW50Tm9kZT1uLnBhcmVudE5vZGUsYy5wdXNoKHApLHMucHVzaChnKSxsLnB1c2godil9dmFyIGUsdSxpPS0xLGE9dGhpcy5sZW5ndGg7aWYoIWFyZ3VtZW50cy5sZW5ndGgpe2ZvcihuPW5ldyBBcnJheShhPShlPXRoaXNbMF0pLmxlbmd0aCk7KytpPGE7KSh1PWVbaV0pJiYobltpXT11Ll9fZGF0YV9fKTtyZXR1cm4gbn12YXIgYz1VKFtdKSxzPV8oW10pLGw9XyhbXSk7aWYoImZ1bmN0aW9uIj09dHlwZW9mIG4pZm9yKDsrK2k8YTspcihlPXRoaXNbaV0sbi5jYWxsKGUsZS5wYXJlbnROb2RlLl9fZGF0YV9fLGkpKTtlbHNlIGZvcig7KytpPGE7KXIoZT10aGlzW2ldLG4pO3JldHVybiBzLmVudGVyPWZ1bmN0aW9uKCl7cmV0dXJuIGN9LHMuZXhpdD1mdW5jdGlvbigpe3JldHVybiBsfSxzfSx5YS5kYXR1bT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD90aGlzLnByb3BlcnR5KCJfX2RhdGFfXyIsbik6dGhpcy5wcm9wZXJ0eSgiX19kYXRhX18iKX0seWEuZmlsdGVyPWZ1bmN0aW9uKG4pe3ZhciB0LHIsZSx1PVtdOyJmdW5jdGlvbiIhPXR5cGVvZiBuJiYobj1SKG4pKTtmb3IodmFyIGk9MCxvPXRoaXMubGVuZ3RoO28+aTtpKyspe3UucHVzaCh0PVtdKSx0LnBhcmVudE5vZGU9KHI9dGhpc1tpXSkucGFyZW50Tm9kZTtmb3IodmFyIGE9MCxjPXIubGVuZ3RoO2M+YTthKyspKGU9clthXSkmJm4uY2FsbChlLGUuX19kYXRhX18sYSxpKSYmdC5wdXNoKGUpfXJldHVybiBfKHUpfSx5YS5vcmRlcj1mdW5jdGlvbigpe2Zvcih2YXIgbj0tMSx0PXRoaXMubGVuZ3RoOysrbjx0Oylmb3IodmFyIHIsZT10aGlzW25dLHU9ZS5sZW5ndGgtMSxpPWVbdV07LS11Pj0wOykocj1lW3VdKSYmKGkmJmkhPT1yLm5leHRTaWJsaW5nJiZpLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHIsaSksaT1yKTtyZXR1cm4gdGhpc30seWEuc29ydD1mdW5jdGlvbihuKXtuPUQuYXBwbHkodGhpcyxhcmd1bWVudHMpO2Zvcih2YXIgdD0tMSxyPXRoaXMubGVuZ3RoOysrdDxyOyl0aGlzW3RdLnNvcnQobik7cmV0dXJuIHRoaXMub3JkZXIoKX0seWEuZWFjaD1mdW5jdGlvbihuKXtyZXR1cm4gUCh0aGlzLGZ1bmN0aW9uKHQscixlKXtuLmNhbGwodCx0Ll9fZGF0YV9fLHIsZSl9KX0seWEuY2FsbD1mdW5jdGlvbihuKXt2YXIgdD1Xbyhhcmd1bWVudHMpO3JldHVybiBuLmFwcGx5KHRbMF09dGhpcyx0KSx0aGlzfSx5YS5lbXB0eT1mdW5jdGlvbigpe3JldHVybiF0aGlzLm5vZGUoKX0seWEubm9kZT1mdW5jdGlvbigpe2Zvcih2YXIgbj0wLHQ9dGhpcy5sZW5ndGg7dD5uO24rKylmb3IodmFyIHI9dGhpc1tuXSxlPTAsdT1yLmxlbmd0aDt1PmU7ZSsrKXt2YXIgaT1yW2VdO2lmKGkpcmV0dXJuIGl9cmV0dXJuIG51bGx9LHlhLnNpemU9ZnVuY3Rpb24oKXt2YXIgbj0wO3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXsrK259KSxufTt2YXIgTWE9W107Qm8uc2VsZWN0aW9uLmVudGVyPVUsQm8uc2VsZWN0aW9uLmVudGVyLnByb3RvdHlwZT1NYSxNYS5hcHBlbmQ9eWEuYXBwZW5kLE1hLmVtcHR5PXlhLmVtcHR5LE1hLm5vZGU9eWEubm9kZSxNYS5jYWxsPXlhLmNhbGwsTWEuc2l6ZT15YS5zaXplLE1hLnNlbGVjdD1mdW5jdGlvbihuKXtmb3IodmFyIHQscixlLHUsaSxvPVtdLGE9LTEsYz10aGlzLmxlbmd0aDsrK2E8Yzspe2U9KHU9dGhpc1thXSkudXBkYXRlLG8ucHVzaCh0PVtdKSx0LnBhcmVudE5vZGU9dS5wYXJlbnROb2RlO2Zvcih2YXIgcz0tMSxsPXUubGVuZ3RoOysrczxsOykoaT11W3NdKT8odC5wdXNoKGVbc109cj1uLmNhbGwodS5wYXJlbnROb2RlLGkuX19kYXRhX18scyxhKSksci5fX2RhdGFfXz1pLl9fZGF0YV9fKTp0LnB1c2gobnVsbCl9cmV0dXJuIF8obyl9LE1hLmluc2VydD1mdW5jdGlvbihuLHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPDImJih0PWoodGhpcykpLHlhLmluc2VydC5jYWxsKHRoaXMsbix0KX0seWEudHJhbnNpdGlvbj1mdW5jdGlvbigpe2Zvcih2YXIgbix0LHI9QXN8fCsrVHMsZT1bXSx1PUNzfHx7dGltZTpEYXRlLm5vdygpLGVhc2U6d3UsZGVsYXk6MCxkdXJhdGlvbjoyNTB9LGk9LTEsbz10aGlzLmxlbmd0aDsrK2k8bzspe2UucHVzaChuPVtdKTtmb3IodmFyIGE9dGhpc1tpXSxjPS0xLHM9YS5sZW5ndGg7KytjPHM7KSh0PWFbY10pJiZGbyh0LGMscix1KSxuLnB1c2godCl9cmV0dXJuIFVvKGUscil9LHlhLmludGVycnVwdD1mdW5jdGlvbigpe3JldHVybiB0aGlzLmVhY2goSCl9LEJvLnNlbGVjdD1mdW5jdGlvbihuKXt2YXIgdD1bInN0cmluZyI9PXR5cGVvZiBuP3BhKG4sR28pOm5dO3JldHVybiB0LnBhcmVudE5vZGU9S28sXyhbdF0pfSxCby5zZWxlY3RBbGw9ZnVuY3Rpb24obil7dmFyIHQ9V28oInN0cmluZyI9PXR5cGVvZiBuP3ZhKG4sR28pOm4pO3JldHVybiB0LnBhcmVudE5vZGU9S28sXyhbdF0pfTt2YXIgX2E9Qm8uc2VsZWN0KEtvKTt5YS5vbj1mdW5jdGlvbihuLHQscil7dmFyIGU9YXJndW1lbnRzLmxlbmd0aDtpZigzPmUpe2lmKCJzdHJpbmciIT10eXBlb2Ygbil7Mj5lJiYodD0hMSk7Zm9yKHIgaW4gbil0aGlzLmVhY2goRihyLG5bcl0sdCkpO3JldHVybiB0aGlzfWlmKDI+ZSlyZXR1cm4oZT10aGlzLm5vZGUoKVsiX19vbiIrbl0pJiZlLl87cj0hMX1yZXR1cm4gdGhpcy5lYWNoKEYobix0LHIpKX07dmFyIGJhPUJvLm1hcCh7bW91c2VlbnRlcjoibW91c2VvdmVyIixtb3VzZWxlYXZlOiJtb3VzZW91dCJ9KTtiYS5mb3JFYWNoKGZ1bmN0aW9uKG4peyJvbiIrbiBpbiBHbyYmYmEucmVtb3ZlKG4pfSk7dmFyIHdhPSJvbnNlbGVjdHN0YXJ0ImluIEdvP251bGw6cChLby5zdHlsZSwidXNlclNlbGVjdCIpLFNhPTA7Qm8ubW91c2U9ZnVuY3Rpb24obil7cmV0dXJuIFoobix4KCkpfSxCby50b3VjaGVzPWZ1bmN0aW9uKG4sdCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg8MiYmKHQ9eCgpLnRvdWNoZXMpLHQ/V28odCkubWFwKGZ1bmN0aW9uKHQpe3ZhciByPVoobix0KTtyZXR1cm4gci5pZGVudGlmaWVyPXQuaWRlbnRpZmllcixyfSk6W119LEJvLmJlaGF2aW9yLmRyYWc9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKCl7dGhpcy5vbigibW91c2Vkb3duLmRyYWciLHUpLm9uKCJ0b3VjaHN0YXJ0LmRyYWciLGkpfWZ1bmN0aW9uIHQobix0LHUsaSxvKXtyZXR1cm4gZnVuY3Rpb24oKXtmdW5jdGlvbiBhKCl7dmFyIG4scixlPXQoaCx2KTtlJiYobj1lWzBdLXhbMF0scj1lWzFdLXhbMV0scHw9bnxyLHg9ZSxnKHt0eXBlOiJkcmFnIix4OmVbMF0rc1swXSx5OmVbMV0rc1sxXSxkeDpuLGR5OnJ9KSl9ZnVuY3Rpb24gYygpe3QoaCx2KSYmKG0ub24oaStkLG51bGwpLm9uKG8rZCxudWxsKSx5KHAmJkJvLmV2ZW50LnRhcmdldD09PWYpLGcoe3R5cGU6ImRyYWdlbmQifSkpfXZhciBzLGw9dGhpcyxmPUJvLmV2ZW50LnRhcmdldCxoPWwucGFyZW50Tm9kZSxnPXIub2YobCxhcmd1bWVudHMpLHA9MCx2PW4oKSxkPSIuZHJhZyIrKG51bGw9PXY/IiI6Ii0iK3YpLG09Qm8uc2VsZWN0KHUoKSkub24oaStkLGEpLm9uKG8rZCxjKSx5PVkoKSx4PXQoaCx2KTtlPyhzPWUuYXBwbHkobCxhcmd1bWVudHMpLHM9W3MueC14WzBdLHMueS14WzFdXSk6cz1bMCwwXSxnKHt0eXBlOiJkcmFnc3RhcnQifSl9fXZhciByPU0obiwiZHJhZyIsImRyYWdzdGFydCIsImRyYWdlbmQiKSxlPW51bGwsdT10KHYsQm8ubW91c2UsWCwibW91c2Vtb3ZlIiwibW91c2V1cCIpLGk9dChWLEJvLnRvdWNoLCQsInRvdWNobW92ZSIsInRvdWNoZW5kIik7cmV0dXJuIG4ub3JpZ2luPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhlPXQsbik6ZX0sQm8ucmViaW5kKG4sciwib24iKX07dmFyIGthPU1hdGguUEksRWE9MiprYSxBYT1rYS8yLENhPTFlLTYsTmE9Q2EqQ2EsemE9a2EvMTgwLExhPTE4MC9rYSxUYT1NYXRoLlNRUlQyLHFhPTIsUmE9NDtCby5pbnRlcnBvbGF0ZVpvb209ZnVuY3Rpb24obix0KXtmdW5jdGlvbiByKG4pe3ZhciB0PW4qeTtpZihtKXt2YXIgcj1RKHYpLG89aS8ocWEqaCkqKHIqbnQoVGEqdCt2KS1LKHYpKTtyZXR1cm5bZStvKnMsdStvKmwsaSpyL1EoVGEqdCt2KV19cmV0dXJuW2UrbipzLHUrbipsLGkqTWF0aC5leHAoVGEqdCldfXZhciBlPW5bMF0sdT1uWzFdLGk9blsyXSxvPXRbMF0sYT10WzFdLGM9dFsyXSxzPW8tZSxsPWEtdSxmPXMqcytsKmwsaD1NYXRoLnNxcnQoZiksZz0oYypjLWkqaStSYSpmKS8oMippKnFhKmgpLHA9KGMqYy1pKmktUmEqZikvKDIqYypxYSpoKSx2PU1hdGgubG9nKE1hdGguc3FydChnKmcrMSktZyksZD1NYXRoLmxvZyhNYXRoLnNxcnQocCpwKzEpLXApLG09ZC12LHk9KG18fE1hdGgubG9nKGMvaSkpL1RhO3JldHVybiByLmR1cmF0aW9uPTFlMyp5LHJ9LEJvLmJlaGF2aW9yLnpvb209ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKG4pe24ub24oQSxzKS5vbihVYSsiLnpvb20iLGYpLm9uKEMsaCkub24oImRibGNsaWNrLnpvb20iLGcpLm9uKHosbCl9ZnVuY3Rpb24gdChuKXtyZXR1cm5bKG5bMF0tUy54KS9TLmssKG5bMV0tUy55KS9TLmtdfWZ1bmN0aW9uIHIobil7cmV0dXJuW25bMF0qUy5rK1MueCxuWzFdKlMuaytTLnldfWZ1bmN0aW9uIGUobil7Uy5rPU1hdGgubWF4KEVbMF0sTWF0aC5taW4oRVsxXSxuKSl9ZnVuY3Rpb24gdShuLHQpe3Q9cih0KSxTLngrPW5bMF0tdFswXSxTLnkrPW5bMV0tdFsxXX1mdW5jdGlvbiBpKCl7XyYmXy5kb21haW4oeC5yYW5nZSgpLm1hcChmdW5jdGlvbihuKXtyZXR1cm4obi1TLngpL1Mua30pLm1hcCh4LmludmVydCkpLHcmJncuZG9tYWluKGIucmFuZ2UoKS5tYXAoZnVuY3Rpb24obil7cmV0dXJuKG4tUy55KS9TLmt9KS5tYXAoYi5pbnZlcnQpKX1mdW5jdGlvbiBvKG4pe24oe3R5cGU6Inpvb21zdGFydCJ9KX1mdW5jdGlvbiBhKG4pe2koKSxuKHt0eXBlOiJ6b29tIixzY2FsZTpTLmssdHJhbnNsYXRlOltTLngsUy55XX0pfWZ1bmN0aW9uIGMobil7bih7dHlwZToiem9vbWVuZCJ9KX1mdW5jdGlvbiBzKCl7ZnVuY3Rpb24gbigpe2w9MSx1KEJvLm1vdXNlKGUpLGcpLGEocyl9ZnVuY3Rpb24gcigpe2Yub24oQyxRbz09PWU/aDpudWxsKS5vbihOLG51bGwpLHAobCYmQm8uZXZlbnQudGFyZ2V0PT09aSksYyhzKX12YXIgZT10aGlzLGk9Qm8uZXZlbnQudGFyZ2V0LHM9TC5vZihlLGFyZ3VtZW50cyksbD0wLGY9Qm8uc2VsZWN0KFFvKS5vbihDLG4pLm9uKE4sciksZz10KEJvLm1vdXNlKGUpKSxwPVkoKTtILmNhbGwoZSksbyhzKX1mdW5jdGlvbiBsKCl7ZnVuY3Rpb24gbigpe3ZhciBuPUJvLnRvdWNoZXMoZyk7cmV0dXJuIGg9Uy5rLG4uZm9yRWFjaChmdW5jdGlvbihuKXtuLmlkZW50aWZpZXIgaW4gdiYmKHZbbi5pZGVudGlmaWVyXT10KG4pKX0pLG59ZnVuY3Rpb24gcigpe3ZhciB0PUJvLmV2ZW50LnRhcmdldDtCby5zZWxlY3QodCkub24oTSxpKS5vbihfLGYpLGIucHVzaCh0KTtmb3IodmFyIHI9Qm8uZXZlbnQuY2hhbmdlZFRvdWNoZXMsbz0wLGM9ci5sZW5ndGg7Yz5vOysrbyl2W3Jbb10uaWRlbnRpZmllcl09bnVsbDt2YXIgcz1uKCksbD1EYXRlLm5vdygpO2lmKDE9PT1zLmxlbmd0aCl7aWYoNTAwPmwtbSl7dmFyIGg9c1swXSxnPXZbaC5pZGVudGlmaWVyXTtlKDIqUy5rKSx1KGgsZykseSgpLGEocCl9bT1sfWVsc2UgaWYocy5sZW5ndGg+MSl7dmFyIGg9c1swXSx4PXNbMV0sdz1oWzBdLXhbMF0saz1oWzFdLXhbMV07ZD13KncrayprfX1mdW5jdGlvbiBpKCl7Zm9yKHZhciBuLHQscixpLG89Qm8udG91Y2hlcyhnKSxjPTAscz1vLmxlbmd0aDtzPmM7KytjLGk9bnVsbClpZihyPW9bY10saT12W3IuaWRlbnRpZmllcl0pe2lmKHQpYnJlYWs7bj1yLHQ9aX1pZihpKXt2YXIgbD0obD1yWzBdLW5bMF0pKmwrKGw9clsxXS1uWzFdKSpsLGY9ZCYmTWF0aC5zcXJ0KGwvZCk7bj1bKG5bMF0rclswXSkvMiwoblsxXStyWzFdKS8yXSx0PVsodFswXStpWzBdKS8yLCh0WzFdK2lbMV0pLzJdLGUoZipoKX1tPW51bGwsdShuLHQpLGEocCl9ZnVuY3Rpb24gZigpe2lmKEJvLmV2ZW50LnRvdWNoZXMubGVuZ3RoKXtmb3IodmFyIHQ9Qm8uZXZlbnQuY2hhbmdlZFRvdWNoZXMscj0wLGU9dC5sZW5ndGg7ZT5yOysrcilkZWxldGUgdlt0W3JdLmlkZW50aWZpZXJdO2Zvcih2YXIgdSBpbiB2KXJldHVybiB2b2lkIG4oKX1Cby5zZWxlY3RBbGwoYikub24oeCxudWxsKSx3Lm9uKEEscykub24oeixsKSxrKCksYyhwKX12YXIgaCxnPXRoaXMscD1MLm9mKGcsYXJndW1lbnRzKSx2PXt9LGQ9MCx4PSIuem9vbS0iK0JvLmV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLmlkZW50aWZpZXIsTT0idG91Y2htb3ZlIit4LF89InRvdWNoZW5kIit4LGI9W10sdz1Cby5zZWxlY3QoZykub24oQSxudWxsKS5vbih6LHIpLGs9WSgpO0guY2FsbChnKSxyKCksbyhwKX1mdW5jdGlvbiBmKCl7dmFyIG49TC5vZih0aGlzLGFyZ3VtZW50cyk7ZD9jbGVhclRpbWVvdXQoZCk6KEguY2FsbCh0aGlzKSxvKG4pKSxkPXNldFRpbWVvdXQoZnVuY3Rpb24oKXtkPW51bGwsYyhuKX0sNTApLHkoKTt2YXIgcj12fHxCby5tb3VzZSh0aGlzKTtwfHwocD10KHIpKSxlKE1hdGgucG93KDIsLjAwMipEYSgpKSpTLmspLHUocixwKSxhKG4pfWZ1bmN0aW9uIGgoKXtwPW51bGx9ZnVuY3Rpb24gZygpe3ZhciBuPUwub2YodGhpcyxhcmd1bWVudHMpLHI9Qm8ubW91c2UodGhpcyksaT10KHIpLHM9TWF0aC5sb2coUy5rKS9NYXRoLkxOMjtvKG4pLGUoTWF0aC5wb3coMixCby5ldmVudC5zaGlmdEtleT9NYXRoLmNlaWwocyktMTpNYXRoLmZsb29yKHMpKzEpKSx1KHIsaSksYShuKSxjKG4pfXZhciBwLHYsZCxtLHgsXyxiLHcsUz17eDowLHk6MCxrOjF9LGs9Wzk2MCw1MDBdLEU9UGEsQT0ibW91c2Vkb3duLnpvb20iLEM9Im1vdXNlbW92ZS56b29tIixOPSJtb3VzZXVwLnpvb20iLHo9InRvdWNoc3RhcnQuem9vbSIsTD1NKG4sInpvb21zdGFydCIsInpvb20iLCJ6b29tZW5kIik7cmV0dXJuIG4uZXZlbnQ9ZnVuY3Rpb24obil7bi5lYWNoKGZ1bmN0aW9uKCl7dmFyIG49TC5vZih0aGlzLGFyZ3VtZW50cyksdD1TO0FzP0JvLnNlbGVjdCh0aGlzKS50cmFuc2l0aW9uKCkuZWFjaCgic3RhcnQuem9vbSIsZnVuY3Rpb24oKXtTPXRoaXMuX19jaGFydF9ffHx7eDowLHk6MCxrOjF9LG8obil9KS50d2Vlbigiem9vbTp6b29tIixmdW5jdGlvbigpe3ZhciByPWtbMF0sZT1rWzFdLHU9ci8yLGk9ZS8yLG89Qm8uaW50ZXJwb2xhdGVab29tKFsodS1TLngpL1MuaywoaS1TLnkpL1MuayxyL1Mua10sWyh1LXQueCkvdC5rLChpLXQueSkvdC5rLHIvdC5rXSk7cmV0dXJuIGZ1bmN0aW9uKHQpe3ZhciBlPW8odCksYz1yL2VbMl07dGhpcy5fX2NoYXJ0X189Uz17eDp1LWVbMF0qYyx5OmktZVsxXSpjLGs6Y30sYShuKX19KS5lYWNoKCJlbmQuem9vbSIsZnVuY3Rpb24oKXtjKG4pfSk6KHRoaXMuX19jaGFydF9fPVMsbyhuKSxhKG4pLGMobikpfSl9LG4udHJhbnNsYXRlPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhTPXt4Oit0WzBdLHk6K3RbMV0sazpTLmt9LGkoKSxuKTpbUy54LFMueV19LG4uc2NhbGU9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KFM9e3g6Uy54LHk6Uy55LGs6K3R9LGkoKSxuKTpTLmt9LG4uc2NhbGVFeHRlbnQ9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KEU9bnVsbD09dD9QYTpbK3RbMF0sK3RbMV1dLG4pOkV9LG4uY2VudGVyPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh2PXQmJlsrdFswXSwrdFsxXV0sbik6dn0sbi5zaXplPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhrPXQmJlsrdFswXSwrdFsxXV0sbik6a30sbi54PWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhfPXQseD10LmNvcHkoKSxTPXt4OjAseTowLGs6MX0sbik6X30sbi55PWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh3PXQsYj10LmNvcHkoKSxTPXt4OjAseTowLGs6MX0sbik6d30sQm8ucmViaW5kKG4sTCwib24iKX07dmFyIERhLFBhPVswLDEvMF0sVWE9Im9ud2hlZWwiaW4gR28/KERhPWZ1bmN0aW9uKCl7cmV0dXJuLUJvLmV2ZW50LmRlbHRhWSooQm8uZXZlbnQuZGVsdGFNb2RlPzEyMDoxKX0sIndoZWVsIik6Im9ubW91c2V3aGVlbCJpbiBHbz8oRGE9ZnVuY3Rpb24oKXtyZXR1cm4gQm8uZXZlbnQud2hlZWxEZWx0YX0sIm1vdXNld2hlZWwiKTooRGE9ZnVuY3Rpb24oKXtyZXR1cm4tQm8uZXZlbnQuZGV0YWlsfSwiTW96TW91c2VQaXhlbFNjcm9sbCIpO3J0LnByb3RvdHlwZS50b1N0cmluZz1mdW5jdGlvbigpe3JldHVybiB0aGlzLnJnYigpKyIifSxCby5oc2w9ZnVuY3Rpb24obix0LHIpe3JldHVybiAxPT09YXJndW1lbnRzLmxlbmd0aD9uIGluc3RhbmNlb2YgdXQ/ZXQobi5oLG4ucyxuLmwpOl90KCIiK24sYnQsZXQpOmV0KCtuLCt0LCtyKX07dmFyIGphPXV0LnByb3RvdHlwZT1uZXcgcnQ7amEuYnJpZ2h0ZXI9ZnVuY3Rpb24obil7cmV0dXJuIG49TWF0aC5wb3coLjcsYXJndW1lbnRzLmxlbmd0aD9uOjEpLGV0KHRoaXMuaCx0aGlzLnMsdGhpcy5sL24pfSxqYS5kYXJrZXI9ZnVuY3Rpb24obil7cmV0dXJuIG49TWF0aC5wb3coLjcsYXJndW1lbnRzLmxlbmd0aD9uOjEpLGV0KHRoaXMuaCx0aGlzLnMsbip0aGlzLmwpfSxqYS5yZ2I9ZnVuY3Rpb24oKXtyZXR1cm4gaXQodGhpcy5oLHRoaXMucyx0aGlzLmwpfSxCby5oY2w9ZnVuY3Rpb24obix0LHIpe3JldHVybiAxPT09YXJndW1lbnRzLmxlbmd0aD9uIGluc3RhbmNlb2YgYXQ/b3Qobi5oLG4uYyxuLmwpOm4gaW5zdGFuY2VvZiBsdD9odChuLmwsbi5hLG4uYik6aHQoKG49d3QoKG49Qm8ucmdiKG4pKS5yLG4uZyxuLmIpKS5sLG4uYSxuLmIpOm90KCtuLCt0LCtyKX07dmFyIEhhPWF0LnByb3RvdHlwZT1uZXcgcnQ7SGEuYnJpZ2h0ZXI9ZnVuY3Rpb24obil7cmV0dXJuIG90KHRoaXMuaCx0aGlzLmMsTWF0aC5taW4oMTAwLHRoaXMubCtGYSooYXJndW1lbnRzLmxlbmd0aD9uOjEpKSl9LEhhLmRhcmtlcj1mdW5jdGlvbihuKXtyZXR1cm4gb3QodGhpcy5oLHRoaXMuYyxNYXRoLm1heCgwLHRoaXMubC1GYSooYXJndW1lbnRzLmxlbmd0aD9uOjEpKSl9LEhhLnJnYj1mdW5jdGlvbigpe3JldHVybiBjdCh0aGlzLmgsdGhpcy5jLHRoaXMubCkucmdiKCl9LEJvLmxhYj1mdW5jdGlvbihuLHQscil7cmV0dXJuIDE9PT1hcmd1bWVudHMubGVuZ3RoP24gaW5zdGFuY2VvZiBsdD9zdChuLmwsbi5hLG4uYik6biBpbnN0YW5jZW9mIGF0P2N0KG4ubCxuLmMsbi5oKTp3dCgobj1Cby5yZ2IobikpLnIsbi5nLG4uYik6c3QoK24sK3QsK3IpfTt2YXIgRmE9MTgsT2E9Ljk1MDQ3LElhPTEsWWE9MS4wODg4MyxaYT1sdC5wcm90b3R5cGU9bmV3IHJ0O1phLmJyaWdodGVyPWZ1bmN0aW9uKG4pe3JldHVybiBzdChNYXRoLm1pbigxMDAsdGhpcy5sK0ZhKihhcmd1bWVudHMubGVuZ3RoP246MSkpLHRoaXMuYSx0aGlzLmIpfSxaYS5kYXJrZXI9ZnVuY3Rpb24obil7cmV0dXJuIHN0KE1hdGgubWF4KDAsdGhpcy5sLUZhKihhcmd1bWVudHMubGVuZ3RoP246MSkpLHRoaXMuYSx0aGlzLmIpfSxaYS5yZ2I9ZnVuY3Rpb24oKXtyZXR1cm4gZnQodGhpcy5sLHRoaXMuYSx0aGlzLmIpfSxCby5yZ2I9ZnVuY3Rpb24obix0LHIpe3JldHVybiAxPT09YXJndW1lbnRzLmxlbmd0aD9uIGluc3RhbmNlb2YgeHQ/eXQobi5yLG4uZyxuLmIpOl90KCIiK24seXQsaXQpOnl0KH5+bix+fnQsfn5yKX07dmFyIFZhPXh0LnByb3RvdHlwZT1uZXcgcnQ7VmEuYnJpZ2h0ZXI9ZnVuY3Rpb24obil7bj1NYXRoLnBvdyguNyxhcmd1bWVudHMubGVuZ3RoP246MSk7dmFyIHQ9dGhpcy5yLHI9dGhpcy5nLGU9dGhpcy5iLHU9MzA7cmV0dXJuIHR8fHJ8fGU/KHQmJnU+dCYmKHQ9dSksciYmdT5yJiYocj11KSxlJiZ1PmUmJihlPXUpLHl0KE1hdGgubWluKDI1NSx+fih0L24pKSxNYXRoLm1pbigyNTUsfn4oci9uKSksTWF0aC5taW4oMjU1LH5+KGUvbikpKSk6eXQodSx1LHUpfSxWYS5kYXJrZXI9ZnVuY3Rpb24obil7cmV0dXJuIG49TWF0aC5wb3coLjcsYXJndW1lbnRzLmxlbmd0aD9uOjEpLHl0KH5+KG4qdGhpcy5yKSx+fihuKnRoaXMuZyksfn4obip0aGlzLmIpKX0sVmEuaHNsPWZ1bmN0aW9uKCl7cmV0dXJuIGJ0KHRoaXMucix0aGlzLmcsdGhpcy5iKX0sVmEudG9TdHJpbmc9ZnVuY3Rpb24oKXtyZXR1cm4iIyIrTXQodGhpcy5yKStNdCh0aGlzLmcpK010KHRoaXMuYil9O3ZhciAkYT1Cby5tYXAoe2FsaWNlYmx1ZToxNTc5MjM4MyxhbnRpcXVld2hpdGU6MTY0NDQzNzUsYXF1YTo2NTUzNSxhcXVhbWFyaW5lOjgzODg1NjQsYXp1cmU6MTU3OTQxNzUsYmVpZ2U6MTYxMTkyNjAsYmlzcXVlOjE2NzcwMjQ0LGJsYWNrOjAsYmxhbmNoZWRhbG1vbmQ6MTY3NzIwNDUsYmx1ZToyNTUsYmx1ZXZpb2xldDo5MDU1MjAyLGJyb3duOjEwODI0MjM0LGJ1cmx5d29vZDoxNDU5NjIzMSxjYWRldGJsdWU6NjI2NjUyOCxjaGFydHJldXNlOjgzODgzNTIsY2hvY29sYXRlOjEzNzg5NDcwLGNvcmFsOjE2NzQ0MjcyLGNvcm5mbG93ZXJibHVlOjY1OTE5ODEsY29ybnNpbGs6MTY3NzUzODgsY3JpbXNvbjoxNDQyMzEwMCxjeWFuOjY1NTM1LGRhcmtibHVlOjEzOSxkYXJrY3lhbjozNTcyMyxkYXJrZ29sZGVucm9kOjEyMDkyOTM5LGRhcmtncmF5OjExMTE5MDE3LGRhcmtncmVlbjoyNTYwMCxkYXJrZ3JleToxMTExOTAxNyxkYXJra2hha2k6MTI0MzMyNTksZGFya21hZ2VudGE6OTEwOTY0MyxkYXJrb2xpdmVncmVlbjo1NTk3OTk5LGRhcmtvcmFuZ2U6MTY3NDc1MjAsZGFya29yY2hpZDoxMDA0MDAxMixkYXJrcmVkOjkxMDk1MDQsZGFya3NhbG1vbjoxNTMwODQxMCxkYXJrc2VhZ3JlZW46OTQxOTkxOSxkYXJrc2xhdGVibHVlOjQ3MzQzNDcsZGFya3NsYXRlZ3JheTozMTAwNDk1LGRhcmtzbGF0ZWdyZXk6MzEwMDQ5NSxkYXJrdHVycXVvaXNlOjUyOTQ1LGRhcmt2aW9sZXQ6OTY5OTUzOSxkZWVwcGluazoxNjcxNjk0NyxkZWVwc2t5Ymx1ZTo0OTE1MSxkaW1ncmF5OjY5MDgyNjUsZGltZ3JleTo2OTA4MjY1LGRvZGdlcmJsdWU6MjAwMzE5OSxmaXJlYnJpY2s6MTE2NzQxNDYsZmxvcmFsd2hpdGU6MTY3NzU5MjAsZm9yZXN0Z3JlZW46MjI2Mzg0MixmdWNoc2lhOjE2NzExOTM1LGdhaW5zYm9ybzoxNDQ3NDQ2MCxnaG9zdHdoaXRlOjE2MzE2NjcxLGdvbGQ6MTY3NjY3MjAsZ29sZGVucm9kOjE0MzI5MTIwLGdyYXk6ODQyMTUwNCxncmVlbjozMjc2OCxncmVlbnllbGxvdzoxMTQwMzA1NSxncmV5Ojg0MjE1MDQsaG9uZXlkZXc6MTU3OTQxNjAsaG90cGluazoxNjczODc0MCxpbmRpYW5yZWQ6MTM0NTg1MjQsaW5kaWdvOjQ5MTUzMzAsaXZvcnk6MTY3NzcyMDAsa2hha2k6MTU3ODc2NjAsbGF2ZW5kZXI6MTUxMzI0MTAsbGF2ZW5kZXJibHVzaDoxNjc3MzM2NSxsYXduZ3JlZW46ODE5MDk3NixsZW1vbmNoaWZmb246MTY3NzU4ODUsbGlnaHRibHVlOjExMzkzMjU0LGxpZ2h0Y29yYWw6MTU3NjE1MzYsbGlnaHRjeWFuOjE0NzQ1NTk5LGxpZ2h0Z29sZGVucm9keWVsbG93OjE2NDQ4MjEwLGxpZ2h0Z3JheToxMzg4MjMyMyxsaWdodGdyZWVuOjk0OTgyNTYsbGlnaHRncmV5OjEzODgyMzIzLGxpZ2h0cGluazoxNjc1ODQ2NSxsaWdodHNhbG1vbjoxNjc1Mjc2MixsaWdodHNlYWdyZWVuOjIxNDI4OTAsbGlnaHRza3libHVlOjg5MDAzNDYsbGlnaHRzbGF0ZWdyYXk6NzgzMzc1MyxsaWdodHNsYXRlZ3JleTo3ODMzNzUzLGxpZ2h0c3RlZWxibHVlOjExNTg0NzM0LGxpZ2h0eWVsbG93OjE2Nzc3MTg0LGxpbWU6NjUyODAsbGltZWdyZWVuOjMzMjkzMzAsbGluZW46MTY0NDU2NzAsbWFnZW50YToxNjcxMTkzNSxtYXJvb246ODM4ODYwOCxtZWRpdW1hcXVhbWFyaW5lOjY3MzczMjIsbWVkaXVtYmx1ZToyMDUsbWVkaXVtb3JjaGlkOjEyMjExNjY3LG1lZGl1bXB1cnBsZTo5NjYyNjgzLG1lZGl1bXNlYWdyZWVuOjM5NzgwOTcsbWVkaXVtc2xhdGVibHVlOjgwODc3OTAsbWVkaXVtc3ByaW5nZ3JlZW46NjQxNTQsbWVkaXVtdHVycXVvaXNlOjQ3NzIzMDAsbWVkaXVtdmlvbGV0cmVkOjEzMDQ3MTczLG1pZG5pZ2h0Ymx1ZToxNjQ0OTEyLG1pbnRjcmVhbToxNjEyMTg1MCxtaXN0eXJvc2U6MTY3NzAyNzMsbW9jY2FzaW46MTY3NzAyMjksbmF2YWpvd2hpdGU6MTY3Njg2ODUsbmF2eToxMjgsb2xkbGFjZToxNjY0MzU1OCxvbGl2ZTo4NDIxMzc2LG9saXZlZHJhYjo3MDQ4NzM5LG9yYW5nZToxNjc1MzkyMCxvcmFuZ2VyZWQ6MTY3MjkzNDQsb3JjaGlkOjE0MzE1NzM0LHBhbGVnb2xkZW5yb2Q6MTU2NTcxMzAscGFsZWdyZWVuOjEwMDI1ODgwLHBhbGV0dXJxdW9pc2U6MTE1Mjk5NjYscGFsZXZpb2xldHJlZDoxNDM4MTIwMyxwYXBheWF3aGlwOjE2NzczMDc3LHBlYWNocHVmZjoxNjc2NzY3MyxwZXJ1OjEzNDY4OTkxLHBpbms6MTY3NjEwMzUscGx1bToxNDUyNDYzNyxwb3dkZXJibHVlOjExNTkxOTEwLHB1cnBsZTo4Mzg4NzM2LHJlZDoxNjcxMTY4MCxyb3N5YnJvd246MTIzNTc1MTkscm95YWxibHVlOjQyODY5NDUsc2FkZGxlYnJvd246OTEyNzE4NyxzYWxtb246MTY0MTY4ODIsc2FuZHlicm93bjoxNjAzMjg2NCxzZWFncmVlbjozMDUwMzI3LHNlYXNoZWxsOjE2Nzc0NjM4LHNpZW5uYToxMDUwNjc5NyxzaWx2ZXI6MTI2MzIyNTYsc2t5Ymx1ZTo4OTAwMzMxLHNsYXRlYmx1ZTo2OTcwMDYxLHNsYXRlZ3JheTo3MzcyOTQ0LHNsYXRlZ3JleTo3MzcyOTQ0LHNub3c6MTY3NzU5MzAsc3ByaW5nZ3JlZW46NjU0MDcsc3RlZWxibHVlOjQ2MjA5ODAsdGFuOjEzODA4NzgwLHRlYWw6MzI4OTYsdGhpc3RsZToxNDIwNDg4OCx0b21hdG86MTY3MzcwOTUsdHVycXVvaXNlOjQyNTE4NTYsdmlvbGV0OjE1NjMxMDg2LHdoZWF0OjE2MTEzMzMxLHdoaXRlOjE2Nzc3MjE1LHdoaXRlc21va2U6MTYxMTkyODUseWVsbG93OjE2Nzc2OTYwLHllbGxvd2dyZWVuOjEwMTQ1MDc0fSk7JGEuZm9yRWFjaChmdW5jdGlvbihuLHQpeyRhLnNldChuLGR0KHQpKX0pLEJvLmZ1bmN0b3I9RXQsQm8ueGhyPUN0KEF0KSxCby5kc3Y9ZnVuY3Rpb24obix0KXtmdW5jdGlvbiByKG4scixpKXthcmd1bWVudHMubGVuZ3RoPDMmJihpPXIscj1udWxsKTt2YXIgbz1OdChuLHQsbnVsbD09cj9lOnUociksaSk7cmV0dXJuIG8ucm93PWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoP28ucmVzcG9uc2UobnVsbD09KHI9bik/ZTp1KG4pKTpyfSxvfWZ1bmN0aW9uIGUobil7cmV0dXJuIHIucGFyc2Uobi5yZXNwb25zZVRleHQpfWZ1bmN0aW9uIHUobil7cmV0dXJuIGZ1bmN0aW9uKHQpe3JldHVybiByLnBhcnNlKHQucmVzcG9uc2VUZXh0LG4pfX1mdW5jdGlvbiBpKHQpe3JldHVybiB0Lm1hcChvKS5qb2luKG4pfWZ1bmN0aW9uIG8obil7cmV0dXJuIGEudGVzdChuKT8nIicrbi5yZXBsYWNlKC9cIi9nLCciIicpKyciJzpufXZhciBhPW5ldyBSZWdFeHAoJ1siJytuKyJcbl0iKSxjPW4uY2hhckNvZGVBdCgwKTtyZXR1cm4gci5wYXJzZT1mdW5jdGlvbihuLHQpe3ZhciBlO3JldHVybiByLnBhcnNlUm93cyhuLGZ1bmN0aW9uKG4scil7aWYoZSlyZXR1cm4gZShuLHItMSk7dmFyIHU9bmV3IEZ1bmN0aW9uKCJkIiwicmV0dXJuIHsiK24ubWFwKGZ1bmN0aW9uKG4sdCl7cmV0dXJuIEpTT04uc3RyaW5naWZ5KG4pKyI6IGRbIit0KyJdIn0pLmpvaW4oIiwiKSsifSIpO2U9dD9mdW5jdGlvbihuLHIpe3JldHVybiB0KHUobikscil9OnV9KX0sci5wYXJzZVJvd3M9ZnVuY3Rpb24obix0KXtmdW5jdGlvbiByKCl7aWYobD49cylyZXR1cm4gbztpZih1KXJldHVybiB1PSExLGk7dmFyIHQ9bDtpZigzND09PW4uY2hhckNvZGVBdCh0KSl7Zm9yKHZhciByPXQ7cisrPHM7KWlmKDM0PT09bi5jaGFyQ29kZUF0KHIpKXtpZigzNCE9PW4uY2hhckNvZGVBdChyKzEpKWJyZWFrOysrcn1sPXIrMjt2YXIgZT1uLmNoYXJDb2RlQXQocisxKTtyZXR1cm4gMTM9PT1lPyh1PSEwLDEwPT09bi5jaGFyQ29kZUF0KHIrMikmJisrbCk6MTA9PT1lJiYodT0hMCksbi5zdWJzdHJpbmcodCsxLHIpLnJlcGxhY2UoLyIiL2csJyInKX1mb3IoO3M+bDspe3ZhciBlPW4uY2hhckNvZGVBdChsKyspLGE9MTtpZigxMD09PWUpdT0hMDtlbHNlIGlmKDEzPT09ZSl1PSEwLDEwPT09bi5jaGFyQ29kZUF0KGwpJiYoKytsLCsrYSk7ZWxzZSBpZihlIT09Yyljb250aW51ZTtyZXR1cm4gbi5zdWJzdHJpbmcodCxsLWEpfXJldHVybiBuLnN1YnN0cmluZyh0KX1mb3IodmFyIGUsdSxpPXt9LG89e30sYT1bXSxzPW4ubGVuZ3RoLGw9MCxmPTA7KGU9cigpKSE9PW87KXtmb3IodmFyIGg9W107ZSE9PWkmJmUhPT1vOyloLnB1c2goZSksZT1yKCk7KCF0fHwoaD10KGgsZisrKSkpJiZhLnB1c2goaCl9cmV0dXJuIGF9LHIuZm9ybWF0PWZ1bmN0aW9uKHQpe2lmKEFycmF5LmlzQXJyYXkodFswXSkpcmV0dXJuIHIuZm9ybWF0Um93cyh0KTt2YXIgZT1uZXcgaCx1PVtdO3JldHVybiB0LmZvckVhY2goZnVuY3Rpb24obil7Zm9yKHZhciB0IGluIG4pZS5oYXModCl8fHUucHVzaChlLmFkZCh0KSl9KSxbdS5tYXAobykuam9pbihuKV0uY29uY2F0KHQubWFwKGZ1bmN0aW9uKHQpe3JldHVybiB1Lm1hcChmdW5jdGlvbihuKXtyZXR1cm4gbyh0W25dKX0pLmpvaW4obil9KSkuam9pbigiXG4iKX0sci5mb3JtYXRSb3dzPWZ1bmN0aW9uKG4pe3JldHVybiBuLm1hcChpKS5qb2luKCJcbiIpfSxyfSxCby5jc3Y9Qm8uZHN2KCIsIiwidGV4dC9jc3YiKSxCby50c3Y9Qm8uZHN2KCIJIiwidGV4dC90YWItc2VwYXJhdGVkLXZhbHVlcyIpLEJvLnRvdWNoPWZ1bmN0aW9uKG4sdCxyKXtpZihhcmd1bWVudHMubGVuZ3RoPDMmJihyPXQsdD14KCkuY2hhbmdlZFRvdWNoZXMpLHQpZm9yKHZhciBlLHU9MCxpPXQubGVuZ3RoO2k+dTsrK3UpaWYoKGU9dFt1XSkuaWRlbnRpZmllcj09PXIpcmV0dXJuIFoobixlKX07dmFyIFhhLEJhLEphLFdhLEdhLEthPVFvW3AoUW8sInJlcXVlc3RBbmltYXRpb25GcmFtZSIpXXx8ZnVuY3Rpb24obil7c2V0VGltZW91dChuLDE3KX07Qm8udGltZXI9ZnVuY3Rpb24obix0LHIpe3ZhciBlPWFyZ3VtZW50cy5sZW5ndGg7Mj5lJiYodD0wKSwzPmUmJihyPURhdGUubm93KCkpO3ZhciB1PXIrdCxpPXtjOm4sdDp1LGY6ITEsbjpudWxsfTtCYT9CYS5uPWk6WGE9aSxCYT1pLEphfHwoV2E9Y2xlYXJUaW1lb3V0KFdhKSxKYT0xLEthKEx0KSl9LEJvLnRpbWVyLmZsdXNoPWZ1bmN0aW9uKCl7VHQoKSxxdCgpfSxCby5yb3VuZD1mdW5jdGlvbihuLHQpe3JldHVybiB0P01hdGgucm91bmQobioodD1NYXRoLnBvdygxMCx0KSkpL3Q6TWF0aC5yb3VuZChuKX07dmFyIFFhPVsieSIsInoiLCJhIiwiZiIsInAiLCJuIiwiXHhiNSIsIm0iLCIiLCJrIiwiTSIsIkciLCJUIiwiUCIsIkUiLCJaIiwiWSJdLm1hcChEdCk7Qm8uZm9ybWF0UHJlZml4PWZ1bmN0aW9uKG4sdCl7dmFyIHI9MDtyZXR1cm4gbiYmKDA+biYmKG4qPS0xKSx0JiYobj1Cby5yb3VuZChuLFJ0KG4sdCkpKSxyPTErTWF0aC5mbG9vcigxZS0xMitNYXRoLmxvZyhuKS9NYXRoLkxOMTApLHI9TWF0aC5tYXgoLTI0LE1hdGgubWluKDI0LDMqTWF0aC5mbG9vcigoci0xKS8zKSkpKSxRYVs4K3IvM119O3ZhciBuYz0vKD86KFtee10pPyhbPD49Xl0pKT8oWytcLSBdKT8oWyQjXSk/KDApPyhcZCspPygsKT8oXC4tP1xkKyk/KFthLXolXSk/L2ksdGM9Qm8ubWFwKHtiOmZ1bmN0aW9uKG4pe3JldHVybiBuLnRvU3RyaW5nKDIpfSxjOmZ1bmN0aW9uKG4pe3JldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKG4pfSxvOmZ1bmN0aW9uKG4pe3JldHVybiBuLnRvU3RyaW5nKDgpfSx4OmZ1bmN0aW9uKG4pe3JldHVybiBuLnRvU3RyaW5nKDE2KX0sWDpmdW5jdGlvbihuKXtyZXR1cm4gbi50b1N0cmluZygxNikudG9VcHBlckNhc2UoKX0sZzpmdW5jdGlvbihuLHQpe3JldHVybiBuLnRvUHJlY2lzaW9uKHQpfSxlOmZ1bmN0aW9uKG4sdCl7cmV0dXJuIG4udG9FeHBvbmVudGlhbCh0KX0sZjpmdW5jdGlvbihuLHQpe3JldHVybiBuLnRvRml4ZWQodCl9LHI6ZnVuY3Rpb24obix0KXtyZXR1cm4obj1Cby5yb3VuZChuLFJ0KG4sdCkpKS50b0ZpeGVkKE1hdGgubWF4KDAsTWF0aC5taW4oMjAsUnQobiooMSsxZS0xNSksdCkpKSl9fSkscmM9Qm8udGltZT17fSxlYz1EYXRlO2p0LnByb3RvdHlwZT17Z2V0RGF0ZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLl8uZ2V0VVRDRGF0ZSgpfSxnZXREYXk6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fLmdldFVUQ0RheSgpfSxnZXRGdWxsWWVhcjpmdW5jdGlvbigpe3JldHVybiB0aGlzLl8uZ2V0VVRDRnVsbFllYXIoKX0sZ2V0SG91cnM6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fLmdldFVUQ0hvdXJzKCl9LGdldE1pbGxpc2Vjb25kczpmdW5jdGlvbigpe3JldHVybiB0aGlzLl8uZ2V0VVRDTWlsbGlzZWNvbmRzKCl9LGdldE1pbnV0ZXM6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fLmdldFVUQ01pbnV0ZXMoKX0sZ2V0TW9udGg6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fLmdldFVUQ01vbnRoKCl9LGdldFNlY29uZHM6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fLmdldFVUQ1NlY29uZHMoKX0sZ2V0VGltZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLl8uZ2V0VGltZSgpfSxnZXRUaW1lem9uZU9mZnNldDpmdW5jdGlvbigpe3JldHVybiAwfSx2YWx1ZU9mOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuXy52YWx1ZU9mKCl9LHNldERhdGU6ZnVuY3Rpb24oKXt1Yy5zZXRVVENEYXRlLmFwcGx5KHRoaXMuXyxhcmd1bWVudHMpfSxzZXREYXk6ZnVuY3Rpb24oKXt1Yy5zZXRVVENEYXkuYXBwbHkodGhpcy5fLGFyZ3VtZW50cyl9LHNldEZ1bGxZZWFyOmZ1bmN0aW9uKCl7dWMuc2V0VVRDRnVsbFllYXIuYXBwbHkodGhpcy5fLGFyZ3VtZW50cyl9LHNldEhvdXJzOmZ1bmN0aW9uKCl7dWMuc2V0VVRDSG91cnMuYXBwbHkodGhpcy5fLGFyZ3VtZW50cyl9LHNldE1pbGxpc2Vjb25kczpmdW5jdGlvbigpe3VjLnNldFVUQ01pbGxpc2Vjb25kcy5hcHBseSh0aGlzLl8sYXJndW1lbnRzKX0sc2V0TWludXRlczpmdW5jdGlvbigpe3VjLnNldFVUQ01pbnV0ZXMuYXBwbHkodGhpcy5fLGFyZ3VtZW50cyl9LHNldE1vbnRoOmZ1bmN0aW9uKCl7dWMuc2V0VVRDTW9udGguYXBwbHkodGhpcy5fLGFyZ3VtZW50cyl9LHNldFNlY29uZHM6ZnVuY3Rpb24oKXt1Yy5zZXRVVENTZWNvbmRzLmFwcGx5KHRoaXMuXyxhcmd1bWVudHMpfSxzZXRUaW1lOmZ1bmN0aW9uKCl7dWMuc2V0VGltZS5hcHBseSh0aGlzLl8sYXJndW1lbnRzKX19O3ZhciB1Yz1EYXRlLnByb3RvdHlwZTtyYy55ZWFyPUh0KGZ1bmN0aW9uKG4pe3JldHVybiBuPXJjLmRheShuKSxuLnNldE1vbnRoKDAsMSksbn0sZnVuY3Rpb24obix0KXtuLnNldEZ1bGxZZWFyKG4uZ2V0RnVsbFllYXIoKSt0KX0sZnVuY3Rpb24obil7cmV0dXJuIG4uZ2V0RnVsbFllYXIoKX0pLHJjLnllYXJzPXJjLnllYXIucmFuZ2UscmMueWVhcnMudXRjPXJjLnllYXIudXRjLnJhbmdlLHJjLmRheT1IdChmdW5jdGlvbihuKXt2YXIgdD1uZXcgZWMoMmUzLDApO3JldHVybiB0LnNldEZ1bGxZZWFyKG4uZ2V0RnVsbFllYXIoKSxuLmdldE1vbnRoKCksbi5nZXREYXRlKCkpLHR9LGZ1bmN0aW9uKG4sdCl7bi5zZXREYXRlKG4uZ2V0RGF0ZSgpK3QpfSxmdW5jdGlvbihuKXtyZXR1cm4gbi5nZXREYXRlKCktMX0pLHJjLmRheXM9cmMuZGF5LnJhbmdlLHJjLmRheXMudXRjPXJjLmRheS51dGMucmFuZ2UscmMuZGF5T2ZZZWFyPWZ1bmN0aW9uKG4pe3ZhciB0PXJjLnllYXIobik7cmV0dXJuIE1hdGguZmxvb3IoKG4tdC02ZTQqKG4uZ2V0VGltZXpvbmVPZmZzZXQoKS10LmdldFRpbWV6b25lT2Zmc2V0KCkpKS84NjRlNSl9LFsic3VuZGF5IiwibW9uZGF5IiwidHVlc2RheSIsIndlZG5lc2RheSIsInRodXJzZGF5IiwiZnJpZGF5Iiwic2F0dXJkYXkiXS5mb3JFYWNoKGZ1bmN0aW9uKG4sdCl7dD03LXQ7dmFyIHI9cmNbbl09SHQoZnVuY3Rpb24obil7cmV0dXJuKG49cmMuZGF5KG4pKS5zZXREYXRlKG4uZ2V0RGF0ZSgpLShuLmdldERheSgpK3QpJTcpLG59LGZ1bmN0aW9uKG4sdCl7bi5zZXREYXRlKG4uZ2V0RGF0ZSgpKzcqTWF0aC5mbG9vcih0KSl9LGZ1bmN0aW9uKG4pe3ZhciByPXJjLnllYXIobikuZ2V0RGF5KCk7cmV0dXJuIE1hdGguZmxvb3IoKHJjLmRheU9mWWVhcihuKSsocit0KSU3KS83KS0ociE9PXQpfSk7cmNbbisicyJdPXIucmFuZ2UscmNbbisicyJdLnV0Yz1yLnV0Yy5yYW5nZSxyY1tuKyJPZlllYXIiXT1mdW5jdGlvbihuKXt2YXIgcj1yYy55ZWFyKG4pLmdldERheSgpO3JldHVybiBNYXRoLmZsb29yKChyYy5kYXlPZlllYXIobikrKHIrdCklNykvNyl9fSkscmMud2Vlaz1yYy5zdW5kYXkscmMud2Vla3M9cmMuc3VuZGF5LnJhbmdlLHJjLndlZWtzLnV0Yz1yYy5zdW5kYXkudXRjLnJhbmdlLHJjLndlZWtPZlllYXI9cmMuc3VuZGF5T2ZZZWFyO3ZhciBpYz17Ii0iOiIiLF86IiAiLDA6IjAifSxvYz0vXlxzKlxkKy8sYWM9L14lLztCby5sb2NhbGU9ZnVuY3Rpb24obil7cmV0dXJue251bWJlckZvcm1hdDpQdChuKSx0aW1lRm9ybWF0Ok90KG4pfX07dmFyIGNjPUJvLmxvY2FsZSh7ZGVjaW1hbDoiLiIsdGhvdXNhbmRzOiIsIixncm91cGluZzpbM10sY3VycmVuY3k6WyIkIiwiIl0sZGF0ZVRpbWU6IiVhICViICVlICVYICVZIixkYXRlOiIlbS8lZC8lWSIsdGltZToiJUg6JU06JVMiLHBlcmlvZHM6WyJBTSIsIlBNIl0sZGF5czpbIlN1bmRheSIsIk1vbmRheSIsIlR1ZXNkYXkiLCJXZWRuZXNkYXkiLCJUaHVyc2RheSIsIkZyaWRheSIsIlNhdHVyZGF5Il0sc2hvcnREYXlzOlsiU3VuIiwiTW9uIiwiVHVlIiwiV2VkIiwiVGh1IiwiRnJpIiwiU2F0Il0sbW9udGhzOlsiSmFudWFyeSIsIkZlYnJ1YXJ5IiwiTWFyY2giLCJBcHJpbCIsIk1heSIsIkp1bmUiLCJKdWx5IiwiQXVndXN0IiwiU2VwdGVtYmVyIiwiT2N0b2JlciIsIk5vdmVtYmVyIiwiRGVjZW1iZXIiXSxzaG9ydE1vbnRoczpbIkphbiIsIkZlYiIsIk1hciIsIkFwciIsIk1heSIsIkp1biIsIkp1bCIsIkF1ZyIsIlNlcCIsIk9jdCIsIk5vdiIsIkRlYyJdfSk7Qm8uZm9ybWF0PWNjLm51bWJlckZvcm1hdCxCby5nZW89e30sY3IucHJvdG90eXBlPXtzOjAsdDowLGFkZDpmdW5jdGlvbihuKXtzcihuLHRoaXMudCxzYyksc3Ioc2Mucyx0aGlzLnMsdGhpcyksdGhpcy5zP3RoaXMudCs9c2MudDp0aGlzLnM9c2MudH0scmVzZXQ6ZnVuY3Rpb24oKXt0aGlzLnM9dGhpcy50PTB9LHZhbHVlT2Y6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5zfX07dmFyIHNjPW5ldyBjcjtCby5nZW8uc3RyZWFtPWZ1bmN0aW9uKG4sdCl7biYmbGMuaGFzT3duUHJvcGVydHkobi50eXBlKT9sY1tuLnR5cGVdKG4sdCk6bHIobix0KX07dmFyIGxjPXtGZWF0dXJlOmZ1bmN0aW9uKG4sdCl7bHIobi5nZW9tZXRyeSx0KX0sRmVhdHVyZUNvbGxlY3Rpb246ZnVuY3Rpb24obix0KXtmb3IodmFyIHI9bi5mZWF0dXJlcyxlPS0xLHU9ci5sZW5ndGg7KytlPHU7KWxyKHJbZV0uZ2VvbWV0cnksdCl9fSxmYz17U3BoZXJlOmZ1bmN0aW9uKG4sdCl7dC5zcGhlcmUoKX0sUG9pbnQ6ZnVuY3Rpb24obix0KXtuPW4uY29vcmRpbmF0ZXMsdC5wb2ludChuWzBdLG5bMV0sblsyXSl9LE11bHRpUG9pbnQ6ZnVuY3Rpb24obix0KXtmb3IodmFyIHI9bi5jb29yZGluYXRlcyxlPS0xLHU9ci5sZW5ndGg7KytlPHU7KW49cltlXSx0LnBvaW50KG5bMF0sblsxXSxuWzJdKX0sTGluZVN0cmluZzpmdW5jdGlvbihuLHQpe2ZyKG4uY29vcmRpbmF0ZXMsdCwwKX0sTXVsdGlMaW5lU3RyaW5nOmZ1bmN0aW9uKG4sdCl7Zm9yKHZhciByPW4uY29vcmRpbmF0ZXMsZT0tMSx1PXIubGVuZ3RoOysrZTx1OylmcihyW2VdLHQsMCl9LFBvbHlnb246ZnVuY3Rpb24obix0KXtocihuLmNvb3JkaW5hdGVzLHQpfSxNdWx0aVBvbHlnb246ZnVuY3Rpb24obix0KXtmb3IodmFyIHI9bi5jb29yZGluYXRlcyxlPS0xLHU9ci5sZW5ndGg7KytlPHU7KWhyKHJbZV0sdCl9LEdlb21ldHJ5Q29sbGVjdGlvbjpmdW5jdGlvbihuLHQpe2Zvcih2YXIgcj1uLmdlb21ldHJpZXMsZT0tMSx1PXIubGVuZ3RoOysrZTx1OylscihyW2VdLHQpfX07Qm8uZ2VvLmFyZWE9ZnVuY3Rpb24obil7cmV0dXJuIGhjPTAsQm8uZ2VvLnN0cmVhbShuLHBjKSxoY307dmFyIGhjLGdjPW5ldyBjcixwYz17c3BoZXJlOmZ1bmN0aW9uKCl7aGMrPTQqa2F9LHBvaW50OnYsbGluZVN0YXJ0OnYsbGluZUVuZDp2LHBvbHlnb25TdGFydDpmdW5jdGlvbigpe2djLnJlc2V0KCkscGMubGluZVN0YXJ0PWdyfSxwb2x5Z29uRW5kOmZ1bmN0aW9uKCl7dmFyIG49MipnYztoYys9MD5uPzQqa2ErbjpuLHBjLmxpbmVTdGFydD1wYy5saW5lRW5kPXBjLnBvaW50PXZ9fTtCby5nZW8uYm91bmRzPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbihuLHQpe3gucHVzaChNPVtsPW4saD1uXSksZj50JiYoZj10KSx0PmcmJihnPXQpfWZ1bmN0aW9uIHQodCxyKXt2YXIgZT1wcihbdCp6YSxyKnphXSk7aWYobSl7dmFyIHU9ZHIobSxlKSxpPVt1WzFdLC11WzBdLDBdLG89ZHIoaSx1KTt4cihvKSxvPU1yKG8pO3ZhciBjPXQtcCxzPWM+MD8xOi0xLHY9b1swXSpMYSpzLGQ9Y2EoYyk+MTgwO2lmKGReKHY+cypwJiZzKnQ+dikpe3ZhciB5PW9bMV0qTGE7eT5nJiYoZz15KX1lbHNlIGlmKHY9KHYrMzYwKSUzNjAtMTgwLGReKHY+cypwJiZzKnQ+dikpe3ZhciB5PS1vWzFdKkxhO2Y+eSYmKGY9eSl9ZWxzZSBmPnImJihmPXIpLHI+ZyYmKGc9cik7ZD9wPnQ/YShsLHQpPmEobCxoKSYmKGg9dCk6YSh0LGgpPmEobCxoKSYmKGw9dCk6aD49bD8obD50JiYobD10KSx0PmgmJihoPXQpKTp0PnA/YShsLHQpPmEobCxoKSYmKGg9dCk6YSh0LGgpPmEobCxoKSYmKGw9dCl9ZWxzZSBuKHQscik7bT1lLHA9dH1mdW5jdGlvbiByKCl7Xy5wb2ludD10fWZ1bmN0aW9uIGUoKXtNWzBdPWwsTVsxXT1oLF8ucG9pbnQ9bixtPW51bGx9ZnVuY3Rpb24gdShuLHIpe2lmKG0pe3ZhciBlPW4tcDt5Kz1jYShlKT4xODA/ZSsoZT4wPzM2MDotMzYwKTplfWVsc2Ugdj1uLGQ9cjtwYy5wb2ludChuLHIpLHQobixyKX1mdW5jdGlvbiBpKCl7cGMubGluZVN0YXJ0KCl9ZnVuY3Rpb24gbygpe3UodixkKSxwYy5saW5lRW5kKCksY2EoeSk+Q2EmJihsPS0oaD0xODApKSxNWzBdPWwsTVsxXT1oLG09bnVsbH1mdW5jdGlvbiBhKG4sdCl7cmV0dXJuKHQtPW4pPDA/dCszNjA6dH1mdW5jdGlvbiBjKG4sdCl7cmV0dXJuIG5bMF0tdFswXX1mdW5jdGlvbiBzKG4sdCl7cmV0dXJuIHRbMF08PXRbMV0/dFswXTw9biYmbjw9dFsxXTpuPHRbMF18fHRbMV08bn12YXIgbCxmLGgsZyxwLHYsZCxtLHkseCxNLF89e3BvaW50Om4sbGluZVN0YXJ0OnIsbGluZUVuZDplLHBvbHlnb25TdGFydDpmdW5jdGlvbigpe18ucG9pbnQ9dSxfLmxpbmVTdGFydD1pLF8ubGluZUVuZD1vLHk9MCxwYy5wb2x5Z29uU3RhcnQoKX0scG9seWdvbkVuZDpmdW5jdGlvbigpe3BjLnBvbHlnb25FbmQoKSxfLnBvaW50PW4sXy5saW5lU3RhcnQ9cixfLmxpbmVFbmQ9ZSwwPmdjPyhsPS0oaD0xODApLGY9LShnPTkwKSk6eT5DYT9nPTkwOi1DYT55JiYoZj0tOTApLE1bMF09bCxNWzFdPWh9fTtyZXR1cm4gZnVuY3Rpb24obil7Zz1oPS0obD1mPTEvMCkseD1bXSxCby5nZW8uc3RyZWFtKG4sXyk7dmFyIHQ9eC5sZW5ndGg7aWYodCl7eC5zb3J0KGMpO2Zvcih2YXIgcixlPTEsdT14WzBdLGk9W3VdO3Q+ZTsrK2Upcj14W2VdLHMoclswXSx1KXx8cyhyWzFdLHUpPyhhKHVbMF0sclsxXSk+YSh1WzBdLHVbMV0pJiYodVsxXT1yWzFdKSxhKHJbMF0sdVsxXSk+YSh1WzBdLHVbMV0pJiYodVswXT1yWzBdKSk6aS5wdXNoKHU9cik7Zm9yKHZhciBvLHIscD0tMS8wLHQ9aS5sZW5ndGgtMSxlPTAsdT1pW3RdO3Q+PWU7dT1yLCsrZSlyPWlbZV0sKG89YSh1WzFdLHJbMF0pKT5wJiYocD1vLGw9clswXSxoPXVbMV0pfXJldHVybiB4PU09bnVsbCwxLzA9PT1sfHwxLzA9PT1mP1tbMC8wLDAvMF0sWzAvMCwwLzBdXTpbW2wsZl0sW2gsZ11dCn19KCksQm8uZ2VvLmNlbnRyb2lkPWZ1bmN0aW9uKG4pe3ZjPWRjPW1jPXljPXhjPU1jPV9jPWJjPXdjPVNjPWtjPTAsQm8uZ2VvLnN0cmVhbShuLEVjKTt2YXIgdD13YyxyPVNjLGU9a2MsdT10KnQrcipyK2UqZTtyZXR1cm4gTmE+dSYmKHQ9TWMscj1fYyxlPWJjLENhPmRjJiYodD1tYyxyPXljLGU9eGMpLHU9dCp0K3IqcitlKmUsTmE+dSk/WzAvMCwwLzBdOltNYXRoLmF0YW4yKHIsdCkqTGEsRyhlL01hdGguc3FydCh1KSkqTGFdfTt2YXIgdmMsZGMsbWMseWMseGMsTWMsX2MsYmMsd2MsU2Msa2MsRWM9e3NwaGVyZTp2LHBvaW50OmJyLGxpbmVTdGFydDpTcixsaW5lRW5kOmtyLHBvbHlnb25TdGFydDpmdW5jdGlvbigpe0VjLmxpbmVTdGFydD1Fcn0scG9seWdvbkVuZDpmdW5jdGlvbigpe0VjLmxpbmVTdGFydD1Tcn19LEFjPUxyKEFyLFByLGpyLFsta2EsLWthLzJdKSxDYz0xZTk7Qm8uZ2VvLmNsaXBFeHRlbnQ9ZnVuY3Rpb24oKXt2YXIgbix0LHIsZSx1LGksbz17c3RyZWFtOmZ1bmN0aW9uKG4pe3JldHVybiB1JiYodS52YWxpZD0hMSksdT1pKG4pLHUudmFsaWQ9ITAsdX0sZXh0ZW50OmZ1bmN0aW9uKGEpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhpPU9yKG49K2FbMF1bMF0sdD0rYVswXVsxXSxyPSthWzFdWzBdLGU9K2FbMV1bMV0pLHUmJih1LnZhbGlkPSExLHU9bnVsbCksbyk6W1tuLHRdLFtyLGVdXX19O3JldHVybiBvLmV4dGVudChbWzAsMF0sWzk2MCw1MDBdXSl9LChCby5nZW8uY29uaWNFcXVhbEFyZWE9ZnVuY3Rpb24oKXtyZXR1cm4gWXIoWnIpfSkucmF3PVpyLEJvLmdlby5hbGJlcnM9ZnVuY3Rpb24oKXtyZXR1cm4gQm8uZ2VvLmNvbmljRXF1YWxBcmVhKCkucm90YXRlKFs5NiwwXSkuY2VudGVyKFstLjYsMzguN10pLnBhcmFsbGVscyhbMjkuNSw0NS41XSkuc2NhbGUoMTA3MCl9LEJvLmdlby5hbGJlcnNVc2E9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKG4pe3ZhciBpPW5bMF0sbz1uWzFdO3JldHVybiB0PW51bGwscihpLG8pLHR8fChlKGksbyksdCl8fHUoaSxvKSx0fXZhciB0LHIsZSx1LGk9Qm8uZ2VvLmFsYmVycygpLG89Qm8uZ2VvLmNvbmljRXF1YWxBcmVhKCkucm90YXRlKFsxNTQsMF0pLmNlbnRlcihbLTIsNTguNV0pLnBhcmFsbGVscyhbNTUsNjVdKSxhPUJvLmdlby5jb25pY0VxdWFsQXJlYSgpLnJvdGF0ZShbMTU3LDBdKS5jZW50ZXIoWy0zLDE5LjldKS5wYXJhbGxlbHMoWzgsMThdKSxjPXtwb2ludDpmdW5jdGlvbihuLHIpe3Q9W24scl19fTtyZXR1cm4gbi5pbnZlcnQ9ZnVuY3Rpb24obil7dmFyIHQ9aS5zY2FsZSgpLHI9aS50cmFuc2xhdGUoKSxlPShuWzBdLXJbMF0pL3QsdT0oblsxXS1yWzFdKS90O3JldHVybih1Pj0uMTImJi4yMzQ+dSYmZT49LS40MjUmJi0uMjE0PmU/bzp1Pj0uMTY2JiYuMjM0PnUmJmU+PS0uMjE0JiYtLjExNT5lP2E6aSkuaW52ZXJ0KG4pfSxuLnN0cmVhbT1mdW5jdGlvbihuKXt2YXIgdD1pLnN0cmVhbShuKSxyPW8uc3RyZWFtKG4pLGU9YS5zdHJlYW0obik7cmV0dXJue3BvaW50OmZ1bmN0aW9uKG4sdSl7dC5wb2ludChuLHUpLHIucG9pbnQobix1KSxlLnBvaW50KG4sdSl9LHNwaGVyZTpmdW5jdGlvbigpe3Quc3BoZXJlKCksci5zcGhlcmUoKSxlLnNwaGVyZSgpfSxsaW5lU3RhcnQ6ZnVuY3Rpb24oKXt0LmxpbmVTdGFydCgpLHIubGluZVN0YXJ0KCksZS5saW5lU3RhcnQoKX0sbGluZUVuZDpmdW5jdGlvbigpe3QubGluZUVuZCgpLHIubGluZUVuZCgpLGUubGluZUVuZCgpfSxwb2x5Z29uU3RhcnQ6ZnVuY3Rpb24oKXt0LnBvbHlnb25TdGFydCgpLHIucG9seWdvblN0YXJ0KCksZS5wb2x5Z29uU3RhcnQoKX0scG9seWdvbkVuZDpmdW5jdGlvbigpe3QucG9seWdvbkVuZCgpLHIucG9seWdvbkVuZCgpLGUucG9seWdvbkVuZCgpfX19LG4ucHJlY2lzaW9uPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhpLnByZWNpc2lvbih0KSxvLnByZWNpc2lvbih0KSxhLnByZWNpc2lvbih0KSxuKTppLnByZWNpc2lvbigpfSxuLnNjYWxlPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhpLnNjYWxlKHQpLG8uc2NhbGUoLjM1KnQpLGEuc2NhbGUodCksbi50cmFuc2xhdGUoaS50cmFuc2xhdGUoKSkpOmkuc2NhbGUoKX0sbi50cmFuc2xhdGU9ZnVuY3Rpb24odCl7aWYoIWFyZ3VtZW50cy5sZW5ndGgpcmV0dXJuIGkudHJhbnNsYXRlKCk7dmFyIHM9aS5zY2FsZSgpLGw9K3RbMF0sZj0rdFsxXTtyZXR1cm4gcj1pLnRyYW5zbGF0ZSh0KS5jbGlwRXh0ZW50KFtbbC0uNDU1KnMsZi0uMjM4KnNdLFtsKy40NTUqcyxmKy4yMzgqc11dKS5zdHJlYW0oYykucG9pbnQsZT1vLnRyYW5zbGF0ZShbbC0uMzA3KnMsZisuMjAxKnNdKS5jbGlwRXh0ZW50KFtbbC0uNDI1KnMrQ2EsZisuMTIqcytDYV0sW2wtLjIxNCpzLUNhLGYrLjIzNCpzLUNhXV0pLnN0cmVhbShjKS5wb2ludCx1PWEudHJhbnNsYXRlKFtsLS4yMDUqcyxmKy4yMTIqc10pLmNsaXBFeHRlbnQoW1tsLS4yMTQqcytDYSxmKy4xNjYqcytDYV0sW2wtLjExNSpzLUNhLGYrLjIzNCpzLUNhXV0pLnN0cmVhbShjKS5wb2ludCxufSxuLnNjYWxlKDEwNzApfTt2YXIgTmMsemMsTGMsVGMscWMsUmMsRGM9e3BvaW50OnYsbGluZVN0YXJ0OnYsbGluZUVuZDp2LHBvbHlnb25TdGFydDpmdW5jdGlvbigpe3pjPTAsRGMubGluZVN0YXJ0PVZyfSxwb2x5Z29uRW5kOmZ1bmN0aW9uKCl7RGMubGluZVN0YXJ0PURjLmxpbmVFbmQ9RGMucG9pbnQ9dixOYys9Y2EoemMvMil9fSxQYz17cG9pbnQ6JHIsbGluZVN0YXJ0OnYsbGluZUVuZDp2LHBvbHlnb25TdGFydDp2LHBvbHlnb25FbmQ6dn0sVWM9e3BvaW50OkpyLGxpbmVTdGFydDpXcixsaW5lRW5kOkdyLHBvbHlnb25TdGFydDpmdW5jdGlvbigpe1VjLmxpbmVTdGFydD1Lcn0scG9seWdvbkVuZDpmdW5jdGlvbigpe1VjLnBvaW50PUpyLFVjLmxpbmVTdGFydD1XcixVYy5saW5lRW5kPUdyfX07Qm8uZ2VvLnBhdGg9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKG4pe3JldHVybiBuJiYoImZ1bmN0aW9uIj09dHlwZW9mIGEmJmkucG9pbnRSYWRpdXMoK2EuYXBwbHkodGhpcyxhcmd1bWVudHMpKSxvJiZvLnZhbGlkfHwobz11KGkpKSxCby5nZW8uc3RyZWFtKG4sbykpLGkucmVzdWx0KCl9ZnVuY3Rpb24gdCgpe3JldHVybiBvPW51bGwsbn12YXIgcixlLHUsaSxvLGE9NC41O3JldHVybiBuLmFyZWE9ZnVuY3Rpb24obil7cmV0dXJuIE5jPTAsQm8uZ2VvLnN0cmVhbShuLHUoRGMpKSxOY30sbi5jZW50cm9pZD1mdW5jdGlvbihuKXtyZXR1cm4gbWM9eWM9eGM9TWM9X2M9YmM9d2M9U2M9a2M9MCxCby5nZW8uc3RyZWFtKG4sdShVYykpLGtjP1t3Yy9rYyxTYy9rY106YmM/W01jL2JjLF9jL2JjXTp4Yz9bbWMveGMseWMveGNdOlswLzAsMC8wXX0sbi5ib3VuZHM9ZnVuY3Rpb24obil7cmV0dXJuIHFjPVJjPS0oTGM9VGM9MS8wKSxCby5nZW8uc3RyZWFtKG4sdShQYykpLFtbTGMsVGNdLFtxYyxSY11dfSxuLnByb2plY3Rpb249ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHU9KHI9bik/bi5zdHJlYW18fHRlKG4pOkF0LHQoKSk6cn0sbi5jb250ZXh0PWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhpPW51bGw9PShlPW4pP25ldyBYcjpuZXcgUXIobiksImZ1bmN0aW9uIiE9dHlwZW9mIGEmJmkucG9pbnRSYWRpdXMoYSksdCgpKTplfSxuLnBvaW50UmFkaXVzPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhhPSJmdW5jdGlvbiI9PXR5cGVvZiB0P3Q6KGkucG9pbnRSYWRpdXMoK3QpLCt0KSxuKTphfSxuLnByb2plY3Rpb24oQm8uZ2VvLmFsYmVyc1VzYSgpKS5jb250ZXh0KG51bGwpfSxCby5nZW8udHJhbnNmb3JtPWZ1bmN0aW9uKG4pe3JldHVybntzdHJlYW06ZnVuY3Rpb24odCl7dmFyIHI9bmV3IHJlKHQpO2Zvcih2YXIgZSBpbiBuKXJbZV09bltlXTtyZXR1cm4gcn19fSxyZS5wcm90b3R5cGU9e3BvaW50OmZ1bmN0aW9uKG4sdCl7dGhpcy5zdHJlYW0ucG9pbnQobix0KX0sc3BoZXJlOmZ1bmN0aW9uKCl7dGhpcy5zdHJlYW0uc3BoZXJlKCl9LGxpbmVTdGFydDpmdW5jdGlvbigpe3RoaXMuc3RyZWFtLmxpbmVTdGFydCgpfSxsaW5lRW5kOmZ1bmN0aW9uKCl7dGhpcy5zdHJlYW0ubGluZUVuZCgpfSxwb2x5Z29uU3RhcnQ6ZnVuY3Rpb24oKXt0aGlzLnN0cmVhbS5wb2x5Z29uU3RhcnQoKX0scG9seWdvbkVuZDpmdW5jdGlvbigpe3RoaXMuc3RyZWFtLnBvbHlnb25FbmQoKX19LEJvLmdlby5wcm9qZWN0aW9uPXVlLEJvLmdlby5wcm9qZWN0aW9uTXV0YXRvcj1pZSwoQm8uZ2VvLmVxdWlyZWN0YW5ndWxhcj1mdW5jdGlvbigpe3JldHVybiB1ZShhZSl9KS5yYXc9YWUuaW52ZXJ0PWFlLEJvLmdlby5yb3RhdGlvbj1mdW5jdGlvbihuKXtmdW5jdGlvbiB0KHQpe3JldHVybiB0PW4odFswXSp6YSx0WzFdKnphKSx0WzBdKj1MYSx0WzFdKj1MYSx0fXJldHVybiBuPXNlKG5bMF0lMzYwKnphLG5bMV0qemEsbi5sZW5ndGg+Mj9uWzJdKnphOjApLHQuaW52ZXJ0PWZ1bmN0aW9uKHQpe3JldHVybiB0PW4uaW52ZXJ0KHRbMF0qemEsdFsxXSp6YSksdFswXSo9TGEsdFsxXSo9TGEsdH0sdH0sY2UuaW52ZXJ0PWFlLEJvLmdlby5jaXJjbGU9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKCl7dmFyIG49ImZ1bmN0aW9uIj09dHlwZW9mIGU/ZS5hcHBseSh0aGlzLGFyZ3VtZW50cyk6ZSx0PXNlKC1uWzBdKnphLC1uWzFdKnphLDApLmludmVydCx1PVtdO3JldHVybiByKG51bGwsbnVsbCwxLHtwb2ludDpmdW5jdGlvbihuLHIpe3UucHVzaChuPXQobixyKSksblswXSo9TGEsblsxXSo9TGF9fSkse3R5cGU6IlBvbHlnb24iLGNvb3JkaW5hdGVzOlt1XX19dmFyIHQscixlPVswLDBdLHU9NjtyZXR1cm4gbi5vcmlnaW49ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGU9dCxuKTplfSxuLmFuZ2xlPWZ1bmN0aW9uKGUpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhyPWdlKCh0PStlKSp6YSx1KnphKSxuKTp0fSxuLnByZWNpc2lvbj1mdW5jdGlvbihlKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8ocj1nZSh0KnphLCh1PStlKSp6YSksbik6dX0sbi5hbmdsZSg5MCl9LEJvLmdlby5kaXN0YW5jZT1mdW5jdGlvbihuLHQpe3ZhciByLGU9KHRbMF0tblswXSkqemEsdT1uWzFdKnphLGk9dFsxXSp6YSxvPU1hdGguc2luKGUpLGE9TWF0aC5jb3MoZSksYz1NYXRoLnNpbih1KSxzPU1hdGguY29zKHUpLGw9TWF0aC5zaW4oaSksZj1NYXRoLmNvcyhpKTtyZXR1cm4gTWF0aC5hdGFuMihNYXRoLnNxcnQoKHI9ZipvKSpyKyhyPXMqbC1jKmYqYSkqciksYypsK3MqZiphKX0sQm8uZ2VvLmdyYXRpY3VsZT1mdW5jdGlvbigpe2Z1bmN0aW9uIG4oKXtyZXR1cm57dHlwZToiTXVsdGlMaW5lU3RyaW5nIixjb29yZGluYXRlczp0KCl9fWZ1bmN0aW9uIHQoKXtyZXR1cm4gQm8ucmFuZ2UoTWF0aC5jZWlsKGkvZCkqZCx1LGQpLm1hcChoKS5jb25jYXQoQm8ucmFuZ2UoTWF0aC5jZWlsKHMvbSkqbSxjLG0pLm1hcChnKSkuY29uY2F0KEJvLnJhbmdlKE1hdGguY2VpbChlL3ApKnAscixwKS5maWx0ZXIoZnVuY3Rpb24obil7cmV0dXJuIGNhKG4lZCk+Q2F9KS5tYXAobCkpLmNvbmNhdChCby5yYW5nZShNYXRoLmNlaWwoYS92KSp2LG8sdikuZmlsdGVyKGZ1bmN0aW9uKG4pe3JldHVybiBjYShuJW0pPkNhfSkubWFwKGYpKX12YXIgcixlLHUsaSxvLGEsYyxzLGwsZixoLGcscD0xMCx2PXAsZD05MCxtPTM2MCx5PTIuNTtyZXR1cm4gbi5saW5lcz1mdW5jdGlvbigpe3JldHVybiB0KCkubWFwKGZ1bmN0aW9uKG4pe3JldHVybnt0eXBlOiJMaW5lU3RyaW5nIixjb29yZGluYXRlczpufX0pfSxuLm91dGxpbmU9ZnVuY3Rpb24oKXtyZXR1cm57dHlwZToiUG9seWdvbiIsY29vcmRpbmF0ZXM6W2goaSkuY29uY2F0KGcoYykuc2xpY2UoMSksaCh1KS5yZXZlcnNlKCkuc2xpY2UoMSksZyhzKS5yZXZlcnNlKCkuc2xpY2UoMSkpXX19LG4uZXh0ZW50PWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoP24ubWFqb3JFeHRlbnQodCkubWlub3JFeHRlbnQodCk6bi5taW5vckV4dGVudCgpfSxuLm1ham9yRXh0ZW50PWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhpPSt0WzBdWzBdLHU9K3RbMV1bMF0scz0rdFswXVsxXSxjPSt0WzFdWzFdLGk+dSYmKHQ9aSxpPXUsdT10KSxzPmMmJih0PXMscz1jLGM9dCksbi5wcmVjaXNpb24oeSkpOltbaSxzXSxbdSxjXV19LG4ubWlub3JFeHRlbnQ9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGU9K3RbMF1bMF0scj0rdFsxXVswXSxhPSt0WzBdWzFdLG89K3RbMV1bMV0sZT5yJiYodD1lLGU9cixyPXQpLGE+byYmKHQ9YSxhPW8sbz10KSxuLnByZWNpc2lvbih5KSk6W1tlLGFdLFtyLG9dXX0sbi5zdGVwPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoP24ubWFqb3JTdGVwKHQpLm1pbm9yU3RlcCh0KTpuLm1pbm9yU3RlcCgpfSxuLm1ham9yU3RlcD1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oZD0rdFswXSxtPSt0WzFdLG4pOltkLG1dfSxuLm1pbm9yU3RlcD1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8ocD0rdFswXSx2PSt0WzFdLG4pOltwLHZdfSxuLnByZWNpc2lvbj1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oeT0rdCxsPXZlKGEsbyw5MCksZj1kZShlLHIseSksaD12ZShzLGMsOTApLGc9ZGUoaSx1LHkpLG4pOnl9LG4ubWFqb3JFeHRlbnQoW1stMTgwLC05MCtDYV0sWzE4MCw5MC1DYV1dKS5taW5vckV4dGVudChbWy0xODAsLTgwLUNhXSxbMTgwLDgwK0NhXV0pfSxCby5nZW8uZ3JlYXRBcmM9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKCl7cmV0dXJue3R5cGU6IkxpbmVTdHJpbmciLGNvb3JkaW5hdGVzOlt0fHxlLmFwcGx5KHRoaXMsYXJndW1lbnRzKSxyfHx1LmFwcGx5KHRoaXMsYXJndW1lbnRzKV19fXZhciB0LHIsZT1tZSx1PXllO3JldHVybiBuLmRpc3RhbmNlPWZ1bmN0aW9uKCl7cmV0dXJuIEJvLmdlby5kaXN0YW5jZSh0fHxlLmFwcGx5KHRoaXMsYXJndW1lbnRzKSxyfHx1LmFwcGx5KHRoaXMsYXJndW1lbnRzKSl9LG4uc291cmNlPWZ1bmN0aW9uKHIpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhlPXIsdD0iZnVuY3Rpb24iPT10eXBlb2Ygcj9udWxsOnIsbik6ZX0sbi50YXJnZXQ9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHU9dCxyPSJmdW5jdGlvbiI9PXR5cGVvZiB0P251bGw6dCxuKTp1fSxuLnByZWNpc2lvbj1mdW5jdGlvbigpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoP246MH0sbn0sQm8uZ2VvLmludGVycG9sYXRlPWZ1bmN0aW9uKG4sdCl7cmV0dXJuIHhlKG5bMF0qemEsblsxXSp6YSx0WzBdKnphLHRbMV0qemEpfSxCby5nZW8ubGVuZ3RoPWZ1bmN0aW9uKG4pe3JldHVybiBqYz0wLEJvLmdlby5zdHJlYW0obixIYyksamN9O3ZhciBqYyxIYz17c3BoZXJlOnYscG9pbnQ6dixsaW5lU3RhcnQ6TWUsbGluZUVuZDp2LHBvbHlnb25TdGFydDp2LHBvbHlnb25FbmQ6dn0sRmM9X2UoZnVuY3Rpb24obil7cmV0dXJuIE1hdGguc3FydCgyLygxK24pKX0sZnVuY3Rpb24obil7cmV0dXJuIDIqTWF0aC5hc2luKG4vMil9KTsoQm8uZ2VvLmF6aW11dGhhbEVxdWFsQXJlYT1mdW5jdGlvbigpe3JldHVybiB1ZShGYyl9KS5yYXc9RmM7dmFyIE9jPV9lKGZ1bmN0aW9uKG4pe3ZhciB0PU1hdGguYWNvcyhuKTtyZXR1cm4gdCYmdC9NYXRoLnNpbih0KX0sQXQpOyhCby5nZW8uYXppbXV0aGFsRXF1aWRpc3RhbnQ9ZnVuY3Rpb24oKXtyZXR1cm4gdWUoT2MpfSkucmF3PU9jLChCby5nZW8uY29uaWNDb25mb3JtYWw9ZnVuY3Rpb24oKXtyZXR1cm4gWXIoYmUpfSkucmF3PWJlLChCby5nZW8uY29uaWNFcXVpZGlzdGFudD1mdW5jdGlvbigpe3JldHVybiBZcih3ZSl9KS5yYXc9d2U7dmFyIEljPV9lKGZ1bmN0aW9uKG4pe3JldHVybiAxL259LE1hdGguYXRhbik7KEJvLmdlby5nbm9tb25pYz1mdW5jdGlvbigpe3JldHVybiB1ZShJYyl9KS5yYXc9SWMsU2UuaW52ZXJ0PWZ1bmN0aW9uKG4sdCl7cmV0dXJuW24sMipNYXRoLmF0YW4oTWF0aC5leHAodCkpLUFhXX0sKEJvLmdlby5tZXJjYXRvcj1mdW5jdGlvbigpe3JldHVybiBrZShTZSl9KS5yYXc9U2U7dmFyIFljPV9lKGZ1bmN0aW9uKCl7cmV0dXJuIDF9LE1hdGguYXNpbik7KEJvLmdlby5vcnRob2dyYXBoaWM9ZnVuY3Rpb24oKXtyZXR1cm4gdWUoWWMpfSkucmF3PVljO3ZhciBaYz1fZShmdW5jdGlvbihuKXtyZXR1cm4gMS8oMStuKX0sZnVuY3Rpb24obil7cmV0dXJuIDIqTWF0aC5hdGFuKG4pfSk7KEJvLmdlby5zdGVyZW9ncmFwaGljPWZ1bmN0aW9uKCl7cmV0dXJuIHVlKFpjKX0pLnJhdz1aYyxFZS5pbnZlcnQ9ZnVuY3Rpb24obix0KXtyZXR1cm5bLXQsMipNYXRoLmF0YW4oTWF0aC5leHAobikpLUFhXX0sKEJvLmdlby50cmFuc3ZlcnNlTWVyY2F0b3I9ZnVuY3Rpb24oKXt2YXIgbj1rZShFZSksdD1uLmNlbnRlcixyPW4ucm90YXRlO3JldHVybiBuLmNlbnRlcj1mdW5jdGlvbihuKXtyZXR1cm4gbj90KFstblsxXSxuWzBdXSk6KG49dCgpLFstblsxXSxuWzBdXSl9LG4ucm90YXRlPWZ1bmN0aW9uKG4pe3JldHVybiBuP3IoW25bMF0sblsxXSxuLmxlbmd0aD4yP25bMl0rOTA6OTBdKToobj1yKCksW25bMF0sblsxXSxuWzJdLTkwXSl9LG4ucm90YXRlKFswLDBdKX0pLnJhdz1FZSxCby5nZW9tPXt9LEJvLmdlb20uaHVsbD1mdW5jdGlvbihuKXtmdW5jdGlvbiB0KG4pe2lmKG4ubGVuZ3RoPDMpcmV0dXJuW107dmFyIHQsdT1FdChyKSxpPUV0KGUpLG89bi5sZW5ndGgsYT1bXSxjPVtdO2Zvcih0PTA7bz50O3QrKylhLnB1c2goWyt1LmNhbGwodGhpcyxuW3RdLHQpLCtpLmNhbGwodGhpcyxuW3RdLHQpLHRdKTtmb3IoYS5zb3J0KHplKSx0PTA7bz50O3QrKyljLnB1c2goW2FbdF1bMF0sLWFbdF1bMV1dKTt2YXIgcz1OZShhKSxsPU5lKGMpLGY9bFswXT09PXNbMF0saD1sW2wubGVuZ3RoLTFdPT09c1tzLmxlbmd0aC0xXSxnPVtdO2Zvcih0PXMubGVuZ3RoLTE7dD49MDstLXQpZy5wdXNoKG5bYVtzW3RdXVsyXV0pO2Zvcih0PStmO3Q8bC5sZW5ndGgtaDsrK3QpZy5wdXNoKG5bYVtsW3RdXVsyXV0pO3JldHVybiBnfXZhciByPUFlLGU9Q2U7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/dChuKToodC54PWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhyPW4sdCk6cn0sdC55PWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhlPW4sdCk6ZX0sdCl9LEJvLmdlb20ucG9seWdvbj1mdW5jdGlvbihuKXtyZXR1cm4gZ2EobixWYyksbn07dmFyIFZjPUJvLmdlb20ucG9seWdvbi5wcm90b3R5cGU9W107VmMuYXJlYT1mdW5jdGlvbigpe2Zvcih2YXIgbix0PS0xLHI9dGhpcy5sZW5ndGgsZT10aGlzW3ItMV0sdT0wOysrdDxyOyluPWUsZT10aGlzW3RdLHUrPW5bMV0qZVswXS1uWzBdKmVbMV07cmV0dXJuLjUqdX0sVmMuY2VudHJvaWQ9ZnVuY3Rpb24obil7dmFyIHQscixlPS0xLHU9dGhpcy5sZW5ndGgsaT0wLG89MCxhPXRoaXNbdS0xXTtmb3IoYXJndW1lbnRzLmxlbmd0aHx8KG49LTEvKDYqdGhpcy5hcmVhKCkpKTsrK2U8dTspdD1hLGE9dGhpc1tlXSxyPXRbMF0qYVsxXS1hWzBdKnRbMV0saSs9KHRbMF0rYVswXSkqcixvKz0odFsxXSthWzFdKSpyO3JldHVybltpKm4sbypuXX0sVmMuY2xpcD1mdW5jdGlvbihuKXtmb3IodmFyIHQscixlLHUsaSxvLGE9cWUobiksYz0tMSxzPXRoaXMubGVuZ3RoLXFlKHRoaXMpLGw9dGhpc1tzLTFdOysrYzxzOyl7Zm9yKHQ9bi5zbGljZSgpLG4ubGVuZ3RoPTAsdT10aGlzW2NdLGk9dFsoZT10Lmxlbmd0aC1hKS0xXSxyPS0xOysrcjxlOylvPXRbcl0sTGUobyxsLHUpPyhMZShpLGwsdSl8fG4ucHVzaChUZShpLG8sbCx1KSksbi5wdXNoKG8pKTpMZShpLGwsdSkmJm4ucHVzaChUZShpLG8sbCx1KSksaT1vO2EmJm4ucHVzaChuWzBdKSxsPXV9cmV0dXJuIG59O3ZhciAkYyxYYyxCYyxKYyxXYyxHYz1bXSxLYz1bXTtPZS5wcm90b3R5cGUucHJlcGFyZT1mdW5jdGlvbigpe2Zvcih2YXIgbix0PXRoaXMuZWRnZXMscj10Lmxlbmd0aDtyLS07KW49dFtyXS5lZGdlLG4uYiYmbi5hfHx0LnNwbGljZShyLDEpO3JldHVybiB0LnNvcnQoWWUpLHQubGVuZ3RofSxRZS5wcm90b3R5cGU9e3N0YXJ0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZWRnZS5sPT09dGhpcy5zaXRlP3RoaXMuZWRnZS5hOnRoaXMuZWRnZS5ifSxlbmQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5lZGdlLmw9PT10aGlzLnNpdGU/dGhpcy5lZGdlLmI6dGhpcy5lZGdlLmF9fSxudS5wcm90b3R5cGU9e2luc2VydDpmdW5jdGlvbihuLHQpe3ZhciByLGUsdTtpZihuKXtpZih0LlA9bix0Lk49bi5OLG4uTiYmKG4uTi5QPXQpLG4uTj10LG4uUil7Zm9yKG49bi5SO24uTDspbj1uLkw7bi5MPXR9ZWxzZSBuLlI9dDtyPW59ZWxzZSB0aGlzLl8/KG49dXUodGhpcy5fKSx0LlA9bnVsbCx0Lk49bixuLlA9bi5MPXQscj1uKToodC5QPXQuTj1udWxsLHRoaXMuXz10LHI9bnVsbCk7Zm9yKHQuTD10LlI9bnVsbCx0LlU9cix0LkM9ITAsbj10O3ImJnIuQzspZT1yLlUscj09PWUuTD8odT1lLlIsdSYmdS5DPyhyLkM9dS5DPSExLGUuQz0hMCxuPWUpOihuPT09ci5SJiYocnUodGhpcyxyKSxuPXIscj1uLlUpLHIuQz0hMSxlLkM9ITAsZXUodGhpcyxlKSkpOih1PWUuTCx1JiZ1LkM/KHIuQz11LkM9ITEsZS5DPSEwLG49ZSk6KG49PT1yLkwmJihldSh0aGlzLHIpLG49cixyPW4uVSksci5DPSExLGUuQz0hMCxydSh0aGlzLGUpKSkscj1uLlU7dGhpcy5fLkM9ITF9LHJlbW92ZTpmdW5jdGlvbihuKXtuLk4mJihuLk4uUD1uLlApLG4uUCYmKG4uUC5OPW4uTiksbi5OPW4uUD1udWxsO3ZhciB0LHIsZSx1PW4uVSxpPW4uTCxvPW4uUjtpZihyPWk/bz91dShvKTppOm8sdT91Lkw9PT1uP3UuTD1yOnUuUj1yOnRoaXMuXz1yLGkmJm8/KGU9ci5DLHIuQz1uLkMsci5MPWksaS5VPXIsciE9PW8/KHU9ci5VLHIuVT1uLlUsbj1yLlIsdS5MPW4sci5SPW8sby5VPXIpOihyLlU9dSx1PXIsbj1yLlIpKTooZT1uLkMsbj1yKSxuJiYobi5VPXUpLCFlKXtpZihuJiZuLkMpcmV0dXJuIG4uQz0hMSx2b2lkIDA7ZG97aWYobj09PXRoaXMuXylicmVhaztpZihuPT09dS5MKXtpZih0PXUuUix0LkMmJih0LkM9ITEsdS5DPSEwLHJ1KHRoaXMsdSksdD11LlIpLHQuTCYmdC5MLkN8fHQuUiYmdC5SLkMpe3QuUiYmdC5SLkN8fCh0LkwuQz0hMSx0LkM9ITAsZXUodGhpcyx0KSx0PXUuUiksdC5DPXUuQyx1LkM9dC5SLkM9ITEscnUodGhpcyx1KSxuPXRoaXMuXzticmVha319ZWxzZSBpZih0PXUuTCx0LkMmJih0LkM9ITEsdS5DPSEwLGV1KHRoaXMsdSksdD11LkwpLHQuTCYmdC5MLkN8fHQuUiYmdC5SLkMpe3QuTCYmdC5MLkN8fCh0LlIuQz0hMSx0LkM9ITAscnUodGhpcyx0KSx0PXUuTCksdC5DPXUuQyx1LkM9dC5MLkM9ITEsZXUodGhpcyx1KSxuPXRoaXMuXzticmVha310LkM9ITAsbj11LHU9dS5VfXdoaWxlKCFuLkMpO24mJihuLkM9ITEpfX19LEJvLmdlb20udm9yb25vaT1mdW5jdGlvbihuKXtmdW5jdGlvbiB0KG4pe3ZhciB0PW5ldyBBcnJheShuLmxlbmd0aCksZT1hWzBdWzBdLHU9YVswXVsxXSxpPWFbMV1bMF0sbz1hWzFdWzFdO3JldHVybiBpdShyKG4pLGEpLmNlbGxzLmZvckVhY2goZnVuY3Rpb24ocixhKXt2YXIgYz1yLmVkZ2VzLHM9ci5zaXRlLGw9dFthXT1jLmxlbmd0aD9jLm1hcChmdW5jdGlvbihuKXt2YXIgdD1uLnN0YXJ0KCk7cmV0dXJuW3QueCx0LnldfSk6cy54Pj1lJiZzLng8PWkmJnMueT49dSYmcy55PD1vP1tbZSxvXSxbaSxvXSxbaSx1XSxbZSx1XV06W107bC5wb2ludD1uW2FdfSksdH1mdW5jdGlvbiByKG4pe3JldHVybiBuLm1hcChmdW5jdGlvbihuLHQpe3JldHVybnt4Ok1hdGgucm91bmQoaShuLHQpL0NhKSpDYSx5Ok1hdGgucm91bmQobyhuLHQpL0NhKSpDYSxpOnR9fSl9dmFyIGU9QWUsdT1DZSxpPWUsbz11LGE9UWM7cmV0dXJuIG4/dChuKToodC5saW5rcz1mdW5jdGlvbihuKXtyZXR1cm4gaXUocihuKSkuZWRnZXMuZmlsdGVyKGZ1bmN0aW9uKG4pe3JldHVybiBuLmwmJm4ucn0pLm1hcChmdW5jdGlvbih0KXtyZXR1cm57c291cmNlOm5bdC5sLmldLHRhcmdldDpuW3Quci5pXX19KX0sdC50cmlhbmdsZXM9ZnVuY3Rpb24obil7dmFyIHQ9W107cmV0dXJuIGl1KHIobikpLmNlbGxzLmZvckVhY2goZnVuY3Rpb24ocixlKXtmb3IodmFyIHUsaSxvPXIuc2l0ZSxhPXIuZWRnZXMuc29ydChZZSksYz0tMSxzPWEubGVuZ3RoLGw9YVtzLTFdLmVkZ2UsZj1sLmw9PT1vP2wucjpsLmw7KytjPHM7KXU9bCxpPWYsbD1hW2NdLmVkZ2UsZj1sLmw9PT1vP2wucjpsLmwsZTxpLmkmJmU8Zi5pJiZhdShvLGksZik8MCYmdC5wdXNoKFtuW2VdLG5baS5pXSxuW2YuaV1dKX0pLHR9LHQueD1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oaT1FdChlPW4pLHQpOmV9LHQueT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obz1FdCh1PW4pLHQpOnV9LHQuY2xpcEV4dGVudD1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oYT1udWxsPT1uP1FjOm4sdCk6YT09PVFjP251bGw6YX0sdC5zaXplPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoP3QuY2xpcEV4dGVudChuJiZbWzAsMF0sbl0pOmE9PT1RYz9udWxsOmEmJmFbMV19LHQpfTt2YXIgUWM9W1stMWU2LC0xZTZdLFsxZTYsMWU2XV07Qm8uZ2VvbS5kZWxhdW5heT1mdW5jdGlvbihuKXtyZXR1cm4gQm8uZ2VvbS52b3Jvbm9pKCkudHJpYW5nbGVzKG4pfSxCby5nZW9tLnF1YWR0cmVlPWZ1bmN0aW9uKG4sdCxyLGUsdSl7ZnVuY3Rpb24gaShuKXtmdW5jdGlvbiBpKG4sdCxyLGUsdSxpLG8sYSl7aWYoIWlzTmFOKHIpJiYhaXNOYU4oZSkpaWYobi5sZWFmKXt2YXIgYz1uLngsbD1uLnk7aWYobnVsbCE9YylpZihjYShjLXIpK2NhKGwtZSk8LjAxKXMobix0LHIsZSx1LGksbyxhKTtlbHNle3ZhciBmPW4ucG9pbnQ7bi54PW4ueT1uLnBvaW50PW51bGwscyhuLGYsYyxsLHUsaSxvLGEpLHMobix0LHIsZSx1LGksbyxhKX1lbHNlIG4ueD1yLG4ueT1lLG4ucG9pbnQ9dH1lbHNlIHMobix0LHIsZSx1LGksbyxhKX1mdW5jdGlvbiBzKG4sdCxyLGUsdSxvLGEsYyl7dmFyIHM9LjUqKHUrYSksbD0uNSoobytjKSxmPXI+PXMsaD1lPj1sLGc9KGg8PDEpK2Y7bi5sZWFmPSExLG49bi5ub2Rlc1tnXXx8KG4ubm9kZXNbZ109bHUoKSksZj91PXM6YT1zLGg/bz1sOmM9bCxpKG4sdCxyLGUsdSxvLGEsYyl9dmFyIGwsZixoLGcscCx2LGQsbSx5LHg9RXQoYSksTT1FdChjKTtpZihudWxsIT10KXY9dCxkPXIsbT1lLHk9dTtlbHNlIGlmKG09eT0tKHY9ZD0xLzApLGY9W10saD1bXSxwPW4ubGVuZ3RoLG8pZm9yKGc9MDtwPmc7KytnKWw9bltnXSxsLng8diYmKHY9bC54KSxsLnk8ZCYmKGQ9bC55KSxsLng+bSYmKG09bC54KSxsLnk+eSYmKHk9bC55KSxmLnB1c2gobC54KSxoLnB1c2gobC55KTtlbHNlIGZvcihnPTA7cD5nOysrZyl7dmFyIF89K3gobD1uW2ddLGcpLGI9K00obCxnKTt2Pl8mJih2PV8pLGQ+YiYmKGQ9YiksXz5tJiYobT1fKSxiPnkmJih5PWIpLGYucHVzaChfKSxoLnB1c2goYil9dmFyIHc9bS12LFM9eS1kO3c+Uz95PWQrdzptPXYrUzt2YXIgaz1sdSgpO2lmKGsuYWRkPWZ1bmN0aW9uKG4pe2koayxuLCt4KG4sKytnKSwrTShuLGcpLHYsZCxtLHkpfSxrLnZpc2l0PWZ1bmN0aW9uKG4pe2Z1KG4sayx2LGQsbSx5KX0sZz0tMSxudWxsPT10KXtmb3IoOysrZzxwOylpKGssbltnXSxmW2ddLGhbZ10sdixkLG0seSk7LS1nfWVsc2Ugbi5mb3JFYWNoKGsuYWRkKTtyZXR1cm4gZj1oPW49bD1udWxsLGt9dmFyIG8sYT1BZSxjPUNlO3JldHVybihvPWFyZ3VtZW50cy5sZW5ndGgpPyhhPWN1LGM9c3UsMz09PW8mJih1PXIsZT10LHI9dD0wKSxpKG4pKTooaS54PWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhhPW4saSk6YX0saS55PWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhjPW4saSk6Y30saS5leHRlbnQ9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KG51bGw9PW4/dD1yPWU9dT1udWxsOih0PStuWzBdWzBdLHI9K25bMF1bMV0sZT0rblsxXVswXSx1PStuWzFdWzFdKSxpKTpudWxsPT10P251bGw6W1t0LHJdLFtlLHVdXX0saS5zaXplPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhudWxsPT1uP3Q9cj1lPXU9bnVsbDoodD1yPTAsZT0rblswXSx1PStuWzFdKSxpKTpudWxsPT10P251bGw6W2UtdCx1LXJdfSxpKX0sQm8uaW50ZXJwb2xhdGVSZ2I9aHUsQm8uaW50ZXJwb2xhdGVPYmplY3Q9Z3UsQm8uaW50ZXJwb2xhdGVOdW1iZXI9cHUsQm8uaW50ZXJwb2xhdGVTdHJpbmc9dnU7dmFyIG5zPS9bLStdPyg/OlxkK1wuP1xkKnxcLj9cZCspKD86W2VFXVstK10/XGQrKT8vZyx0cz1uZXcgUmVnRXhwKG5zLnNvdXJjZSwiZyIpO0JvLmludGVycG9sYXRlPWR1LEJvLmludGVycG9sYXRvcnM9W2Z1bmN0aW9uKG4sdCl7dmFyIHI9dHlwZW9mIHQ7cmV0dXJuKCJzdHJpbmciPT09cj8kYS5oYXModCl8fC9eKCN8cmdiXCh8aHNsXCgpLy50ZXN0KHQpP2h1OnZ1OnQgaW5zdGFuY2VvZiBydD9odTpBcnJheS5pc0FycmF5KHQpP211OiJvYmplY3QiPT09ciYmaXNOYU4odCk/Z3U6cHUpKG4sdCl9XSxCby5pbnRlcnBvbGF0ZUFycmF5PW11O3ZhciBycz1mdW5jdGlvbigpe3JldHVybiBBdH0sZXM9Qm8ubWFwKHtsaW5lYXI6cnMscG9seTpTdSxxdWFkOmZ1bmN0aW9uKCl7cmV0dXJuIF91fSxjdWJpYzpmdW5jdGlvbigpe3JldHVybiBidX0sc2luOmZ1bmN0aW9uKCl7cmV0dXJuIGt1fSxleHA6ZnVuY3Rpb24oKXtyZXR1cm4gRXV9LGNpcmNsZTpmdW5jdGlvbigpe3JldHVybiBBdX0sZWxhc3RpYzpDdSxiYWNrOk51LGJvdW5jZTpmdW5jdGlvbigpe3JldHVybiB6dX19KSx1cz1Cby5tYXAoeyJpbiI6QXQsb3V0Onh1LCJpbi1vdXQiOk11LCJvdXQtaW4iOmZ1bmN0aW9uKG4pe3JldHVybiBNdSh4dShuKSl9fSk7Qm8uZWFzZT1mdW5jdGlvbihuKXt2YXIgdD1uLmluZGV4T2YoIi0iKSxyPXQ+PTA/bi5zdWJzdHJpbmcoMCx0KTpuLGU9dD49MD9uLnN1YnN0cmluZyh0KzEpOiJpbiI7cmV0dXJuIHI9ZXMuZ2V0KHIpfHxycyxlPXVzLmdldChlKXx8QXQseXUoZShyLmFwcGx5KG51bGwsSm8uY2FsbChhcmd1bWVudHMsMSkpKSl9LEJvLmludGVycG9sYXRlSGNsPUx1LEJvLmludGVycG9sYXRlSHNsPVR1LEJvLmludGVycG9sYXRlTGFiPXF1LEJvLmludGVycG9sYXRlUm91bmQ9UnUsQm8udHJhbnNmb3JtPWZ1bmN0aW9uKG4pe3ZhciB0PUdvLmNyZWF0ZUVsZW1lbnROUyhCby5ucy5wcmVmaXguc3ZnLCJnIik7cmV0dXJuKEJvLnRyYW5zZm9ybT1mdW5jdGlvbihuKXtpZihudWxsIT1uKXt0LnNldEF0dHJpYnV0ZSgidHJhbnNmb3JtIixuKTt2YXIgcj10LnRyYW5zZm9ybS5iYXNlVmFsLmNvbnNvbGlkYXRlKCl9cmV0dXJuIG5ldyBEdShyP3IubWF0cml4OmlzKX0pKG4pfSxEdS5wcm90b3R5cGUudG9TdHJpbmc9ZnVuY3Rpb24oKXtyZXR1cm4idHJhbnNsYXRlKCIrdGhpcy50cmFuc2xhdGUrIilyb3RhdGUoIit0aGlzLnJvdGF0ZSsiKXNrZXdYKCIrdGhpcy5za2V3KyIpc2NhbGUoIit0aGlzLnNjYWxlKyIpIn07dmFyIGlzPXthOjEsYjowLGM6MCxkOjEsZTowLGY6MH07Qm8uaW50ZXJwb2xhdGVUcmFuc2Zvcm09SHUsQm8ubGF5b3V0PXt9LEJvLmxheW91dC5idW5kbGU9ZnVuY3Rpb24oKXtyZXR1cm4gZnVuY3Rpb24obil7Zm9yKHZhciB0PVtdLHI9LTEsZT1uLmxlbmd0aDsrK3I8ZTspdC5wdXNoKEl1KG5bcl0pKTtyZXR1cm4gdH19LEJvLmxheW91dC5jaG9yZD1mdW5jdGlvbigpe2Z1bmN0aW9uIG4oKXt2YXIgbixzLGYsaCxnLHA9e30sdj1bXSxkPUJvLnJhbmdlKGkpLG09W107Zm9yKHI9W10sZT1bXSxuPTAsaD0tMTsrK2g8aTspe2ZvcihzPTAsZz0tMTsrK2c8aTspcys9dVtoXVtnXTt2LnB1c2gocyksbS5wdXNoKEJvLnJhbmdlKGkpKSxuKz1zfWZvcihvJiZkLnNvcnQoZnVuY3Rpb24obix0KXtyZXR1cm4gbyh2W25dLHZbdF0pfSksYSYmbS5mb3JFYWNoKGZ1bmN0aW9uKG4sdCl7bi5zb3J0KGZ1bmN0aW9uKG4scil7cmV0dXJuIGEodVt0XVtuXSx1W3RdW3JdKX0pfSksbj0oRWEtbCppKS9uLHM9MCxoPS0xOysraDxpOyl7Zm9yKGY9cyxnPS0xOysrZzxpOyl7dmFyIHk9ZFtoXSx4PW1beV1bZ10sTT11W3ldW3hdLF89cyxiPXMrPU0qbjtwW3krIi0iK3hdPXtpbmRleDp5LHN1YmluZGV4Ongsc3RhcnRBbmdsZTpfLGVuZEFuZ2xlOmIsdmFsdWU6TX19ZVt5XT17aW5kZXg6eSxzdGFydEFuZ2xlOmYsZW5kQW5nbGU6cyx2YWx1ZToocy1mKS9ufSxzKz1sfWZvcihoPS0xOysraDxpOylmb3IoZz1oLTE7KytnPGk7KXt2YXIgdz1wW2grIi0iK2ddLFM9cFtnKyItIitoXTsody52YWx1ZXx8Uy52YWx1ZSkmJnIucHVzaCh3LnZhbHVlPFMudmFsdWU/e3NvdXJjZTpTLHRhcmdldDp3fTp7c291cmNlOncsdGFyZ2V0OlN9KX1jJiZ0KCl9ZnVuY3Rpb24gdCgpe3Iuc29ydChmdW5jdGlvbihuLHQpe3JldHVybiBjKChuLnNvdXJjZS52YWx1ZStuLnRhcmdldC52YWx1ZSkvMiwodC5zb3VyY2UudmFsdWUrdC50YXJnZXQudmFsdWUpLzIpfSl9dmFyIHIsZSx1LGksbyxhLGMscz17fSxsPTA7cmV0dXJuIHMubWF0cml4PWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhpPSh1PW4pJiZ1Lmxlbmd0aCxyPWU9bnVsbCxzKTp1fSxzLnBhZGRpbmc9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGw9bixyPWU9bnVsbCxzKTpsfSxzLnNvcnRHcm91cHM9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KG89bixyPWU9bnVsbCxzKTpvfSxzLnNvcnRTdWJncm91cHM9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGE9bixyPW51bGwscyk6YX0scy5zb3J0Q2hvcmRzPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhjPW4sciYmdCgpLHMpOmN9LHMuY2hvcmRzPWZ1bmN0aW9uKCl7cmV0dXJuIHJ8fG4oKSxyfSxzLmdyb3Vwcz1mdW5jdGlvbigpe3JldHVybiBlfHxuKCksZX0sc30sQm8ubGF5b3V0LmZvcmNlPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbihuKXtyZXR1cm4gZnVuY3Rpb24odCxyLGUsdSl7aWYodC5wb2ludCE9PW4pe3ZhciBpPXQuY3gtbi54LG89dC5jeS1uLnksYT11LXIsYz1pKmkrbypvO2lmKGM+YSphL2Qpe2lmKHA+Yyl7dmFyIHM9dC5jaGFyZ2UvYztuLnB4LT1pKnMsbi5weS09bypzfXJldHVybiEwfWlmKHQucG9pbnQmJmMmJnA+Yyl7dmFyIHM9dC5wb2ludENoYXJnZS9jO24ucHgtPWkqcyxuLnB5LT1vKnN9fXJldHVybiF0LmNoYXJnZX19ZnVuY3Rpb24gdChuKXtuLnB4PUJvLmV2ZW50Lngsbi5weT1Cby5ldmVudC55LGEucmVzdW1lKCl9dmFyIHIsZSx1LGksbyxhPXt9LGM9Qm8uZGlzcGF0Y2goInN0YXJ0IiwidGljayIsImVuZCIpLHM9WzEsMV0sbD0uOSxmPW9zLGg9YXMsZz0tMzAscD1jcyx2PS4xLGQ9LjY0LG09W10seT1bXTtyZXR1cm4gYS50aWNrPWZ1bmN0aW9uKCl7aWYoKGUqPS45OSk8LjAwNSlyZXR1cm4gYy5lbmQoe3R5cGU6ImVuZCIsYWxwaGE6ZT0wfSksITA7dmFyIHQscixhLGYsaCxwLGQseCxNLF89bS5sZW5ndGgsYj15Lmxlbmd0aDtmb3Iocj0wO2I+cjsrK3IpYT15W3JdLGY9YS5zb3VyY2UsaD1hLnRhcmdldCx4PWgueC1mLngsTT1oLnktZi55LChwPXgqeCtNKk0pJiYocD1lKmlbcl0qKChwPU1hdGguc3FydChwKSktdVtyXSkvcCx4Kj1wLE0qPXAsaC54LT14KihkPWYud2VpZ2h0LyhoLndlaWdodCtmLndlaWdodCkpLGgueS09TSpkLGYueCs9eCooZD0xLWQpLGYueSs9TSpkKTtpZigoZD1lKnYpJiYoeD1zWzBdLzIsTT1zWzFdLzIscj0tMSxkKSlmb3IoOysrcjxfOylhPW1bcl0sYS54Kz0oeC1hLngpKmQsYS55Kz0oTS1hLnkpKmQ7aWYoZylmb3IoSnUodD1Cby5nZW9tLnF1YWR0cmVlKG0pLGUsbykscj0tMTsrK3I8XzspKGE9bVtyXSkuZml4ZWR8fHQudmlzaXQobihhKSk7Zm9yKHI9LTE7KytyPF87KWE9bVtyXSxhLmZpeGVkPyhhLng9YS5weCxhLnk9YS5weSk6KGEueC09KGEucHgtKGEucHg9YS54KSkqbCxhLnktPShhLnB5LShhLnB5PWEueSkpKmwpO2MudGljayh7dHlwZToidGljayIsYWxwaGE6ZX0pfSxhLm5vZGVzPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhtPW4sYSk6bX0sYS5saW5rcz1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oeT1uLGEpOnl9LGEuc2l6ZT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8ocz1uLGEpOnN9LGEubGlua0Rpc3RhbmNlPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhmPSJmdW5jdGlvbiI9PXR5cGVvZiBuP246K24sYSk6Zn0sYS5kaXN0YW5jZT1hLmxpbmtEaXN0YW5jZSxhLmxpbmtTdHJlbmd0aD1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oaD0iZnVuY3Rpb24iPT10eXBlb2Ygbj9uOituLGEpOmh9LGEuZnJpY3Rpb249ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGw9K24sYSk6bH0sYS5jaGFyZ2U9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGc9ImZ1bmN0aW9uIj09dHlwZW9mIG4/bjorbixhKTpnfSxhLmNoYXJnZURpc3RhbmNlPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhwPW4qbixhKTpNYXRoLnNxcnQocCl9LGEuZ3Jhdml0eT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8odj0rbixhKTp2fSxhLnRoZXRhPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhkPW4qbixhKTpNYXRoLnNxcnQoZCl9LGEuYWxwaGE9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KG49K24sZT9lPW4+MD9uOjA6bj4wJiYoYy5zdGFydCh7dHlwZToic3RhcnQiLGFscGhhOmU9bn0pLEJvLnRpbWVyKGEudGljaykpLGEpOmV9LGEuc3RhcnQ9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKG4sZSl7aWYoIXIpe2ZvcihyPW5ldyBBcnJheShjKSxhPTA7Yz5hOysrYSlyW2FdPVtdO2ZvcihhPTA7cz5hOysrYSl7dmFyIHU9eVthXTtyW3Uuc291cmNlLmluZGV4XS5wdXNoKHUudGFyZ2V0KSxyW3UudGFyZ2V0LmluZGV4XS5wdXNoKHUuc291cmNlKX19Zm9yKHZhciBpLG89clt0XSxhPS0xLHM9by5sZW5ndGg7KythPHM7KWlmKCFpc05hTihpPW9bYV1bbl0pKXJldHVybiBpO3JldHVybiBNYXRoLnJhbmRvbSgpKmV9dmFyIHQscixlLGM9bS5sZW5ndGgsbD15Lmxlbmd0aCxwPXNbMF0sdj1zWzFdO2Zvcih0PTA7Yz50OysrdCkoZT1tW3RdKS5pbmRleD10LGUud2VpZ2h0PTA7Zm9yKHQ9MDtsPnQ7Kyt0KWU9eVt0XSwibnVtYmVyIj09dHlwZW9mIGUuc291cmNlJiYoZS5zb3VyY2U9bVtlLnNvdXJjZV0pLCJudW1iZXIiPT10eXBlb2YgZS50YXJnZXQmJihlLnRhcmdldD1tW2UudGFyZ2V0XSksKytlLnNvdXJjZS53ZWlnaHQsKytlLnRhcmdldC53ZWlnaHQ7Zm9yKHQ9MDtjPnQ7Kyt0KWU9bVt0XSxpc05hTihlLngpJiYoZS54PW4oIngiLHApKSxpc05hTihlLnkpJiYoZS55PW4oInkiLHYpKSxpc05hTihlLnB4KSYmKGUucHg9ZS54KSxpc05hTihlLnB5KSYmKGUucHk9ZS55KTtpZih1PVtdLCJmdW5jdGlvbiI9PXR5cGVvZiBmKWZvcih0PTA7bD50OysrdCl1W3RdPStmLmNhbGwodGhpcyx5W3RdLHQpO2Vsc2UgZm9yKHQ9MDtsPnQ7Kyt0KXVbdF09ZjtpZihpPVtdLCJmdW5jdGlvbiI9PXR5cGVvZiBoKWZvcih0PTA7bD50OysrdClpW3RdPStoLmNhbGwodGhpcyx5W3RdLHQpO2Vsc2UgZm9yKHQ9MDtsPnQ7Kyt0KWlbdF09aDtpZihvPVtdLCJmdW5jdGlvbiI9PXR5cGVvZiBnKWZvcih0PTA7Yz50OysrdClvW3RdPStnLmNhbGwodGhpcyxtW3RdLHQpO2Vsc2UgZm9yKHQ9MDtjPnQ7Kyt0KW9bdF09ZztyZXR1cm4gYS5yZXN1bWUoKX0sYS5yZXN1bWU9ZnVuY3Rpb24oKXtyZXR1cm4gYS5hbHBoYSguMSl9LGEuc3RvcD1mdW5jdGlvbigpe3JldHVybiBhLmFscGhhKDApfSxhLmRyYWc9ZnVuY3Rpb24oKXtyZXR1cm4gcnx8KHI9Qm8uYmVoYXZpb3IuZHJhZygpLm9yaWdpbihBdCkub24oImRyYWdzdGFydC5mb3JjZSIsVnUpLm9uKCJkcmFnLmZvcmNlIix0KS5vbigiZHJhZ2VuZC5mb3JjZSIsJHUpKSxhcmd1bWVudHMubGVuZ3RoPyh0aGlzLm9uKCJtb3VzZW92ZXIuZm9yY2UiLFh1KS5vbigibW91c2VvdXQuZm9yY2UiLEJ1KS5jYWxsKHIpLHZvaWQgMCk6cn0sQm8ucmViaW5kKGEsYywib24iKX07dmFyIG9zPTIwLGFzPTEsY3M9MS8wO0JvLmxheW91dC5oaWVyYXJjaHk9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKHUpe3ZhciBpLG89W3VdLGE9W107Zm9yKHUuZGVwdGg9MDtudWxsIT0oaT1vLnBvcCgpKTspaWYoYS5wdXNoKGkpLChzPXIuY2FsbChuLGksaS5kZXB0aCkpJiYoYz1zLmxlbmd0aCkpe2Zvcih2YXIgYyxzLGw7LS1jPj0wOylvLnB1c2gobD1zW2NdKSxsLnBhcmVudD1pLGwuZGVwdGg9aS5kZXB0aCsxO2UmJihpLnZhbHVlPTApLGkuY2hpbGRyZW49c31lbHNlIGUmJihpLnZhbHVlPStlLmNhbGwobixpLGkuZGVwdGgpfHwwKSxkZWxldGUgaS5jaGlsZHJlbjtyZXR1cm4gS3UodSxmdW5jdGlvbihuKXt2YXIgcix1O3QmJihyPW4uY2hpbGRyZW4pJiZyLnNvcnQodCksZSYmKHU9bi5wYXJlbnQpJiYodS52YWx1ZSs9bi52YWx1ZSl9KSxhfXZhciB0PXRpLHI9UXUsZT1uaTtyZXR1cm4gbi5zb3J0PWZ1bmN0aW9uKHIpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh0PXIsbik6dH0sbi5jaGlsZHJlbj1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8ocj10LG4pOnJ9LG4udmFsdWU9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGU9dCxuKTplfSxuLnJldmFsdWU9ZnVuY3Rpb24odCl7cmV0dXJuIGUmJihHdSh0LGZ1bmN0aW9uKG4pe24uY2hpbGRyZW4mJihuLnZhbHVlPTApfSksS3UodCxmdW5jdGlvbih0KXt2YXIgcjt0LmNoaWxkcmVufHwodC52YWx1ZT0rZS5jYWxsKG4sdCx0LmRlcHRoKXx8MCksKHI9dC5wYXJlbnQpJiYoci52YWx1ZSs9dC52YWx1ZSl9KSksdH0sbn0sQm8ubGF5b3V0LnBhcnRpdGlvbj1mdW5jdGlvbigpe2Z1bmN0aW9uIG4odCxyLGUsdSl7dmFyIGk9dC5jaGlsZHJlbjtpZih0Lng9cix0Lnk9dC5kZXB0aCp1LHQuZHg9ZSx0LmR5PXUsaSYmKG89aS5sZW5ndGgpKXt2YXIgbyxhLGMscz0tMTtmb3IoZT10LnZhbHVlP2UvdC52YWx1ZTowOysrczxvOyluKGE9aVtzXSxyLGM9YS52YWx1ZSplLHUpLHIrPWN9fWZ1bmN0aW9uIHQobil7dmFyIHI9bi5jaGlsZHJlbixlPTA7aWYociYmKHU9ci5sZW5ndGgpKWZvcih2YXIgdSxpPS0xOysraTx1OyllPU1hdGgubWF4KGUsdChyW2ldKSk7cmV0dXJuIDErZX1mdW5jdGlvbiByKHIsaSl7dmFyIG89ZS5jYWxsKHRoaXMscixpKTtyZXR1cm4gbihvWzBdLDAsdVswXSx1WzFdL3Qob1swXSkpLG99dmFyIGU9Qm8ubGF5b3V0LmhpZXJhcmNoeSgpLHU9WzEsMV07cmV0dXJuIHIuc2l6ZT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8odT1uLHIpOnV9LFd1KHIsZSl9LEJvLmxheW91dC5waWU9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKGkpe3ZhciBvPWkubWFwKGZ1bmN0aW9uKHIsZSl7cmV0dXJuK3QuY2FsbChuLHIsZSl9KSxhPSsoImZ1bmN0aW9uIj09dHlwZW9mIGU/ZS5hcHBseSh0aGlzLGFyZ3VtZW50cyk6ZSksYz0oKCJmdW5jdGlvbiI9PXR5cGVvZiB1P3UuYXBwbHkodGhpcyxhcmd1bWVudHMpOnUpLWEpL0JvLnN1bShvKSxzPUJvLnJhbmdlKGkubGVuZ3RoKTtudWxsIT1yJiZzLnNvcnQocj09PXNzP2Z1bmN0aW9uKG4sdCl7cmV0dXJuIG9bdF0tb1tuXX06ZnVuY3Rpb24obix0KXtyZXR1cm4gcihpW25dLGlbdF0pfSk7dmFyIGw9W107cmV0dXJuIHMuZm9yRWFjaChmdW5jdGlvbihuKXt2YXIgdDtsW25dPXtkYXRhOmlbbl0sdmFsdWU6dD1vW25dLHN0YXJ0QW5nbGU6YSxlbmRBbmdsZTphKz10KmN9fSksbH12YXIgdD1OdW1iZXIscj1zcyxlPTAsdT1FYTtyZXR1cm4gbi52YWx1ZT1mdW5jdGlvbihyKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8odD1yLG4pOnR9LG4uc29ydD1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8ocj10LG4pOnJ9LG4uc3RhcnRBbmdsZT1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oZT10LG4pOmV9LG4uZW5kQW5nbGU9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHU9dCxuKTp1fSxufTt2YXIgc3M9e307Qm8ubGF5b3V0LnN0YWNrPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbihhLGMpe3ZhciBzPWEubWFwKGZ1bmN0aW9uKHIsZSl7cmV0dXJuIHQuY2FsbChuLHIsZSl9KSxsPXMubWFwKGZ1bmN0aW9uKHQpe3JldHVybiB0Lm1hcChmdW5jdGlvbih0LHIpe3JldHVybltpLmNhbGwobix0LHIpLG8uY2FsbChuLHQscildfSl9KSxmPXIuY2FsbChuLGwsYyk7cz1Cby5wZXJtdXRlKHMsZiksbD1Cby5wZXJtdXRlKGwsZik7dmFyIGgsZyxwLHY9ZS5jYWxsKG4sbCxjKSxkPXMubGVuZ3RoLG09c1swXS5sZW5ndGg7Zm9yKGc9MDttPmc7KytnKWZvcih1LmNhbGwobixzWzBdW2ddLHA9dltnXSxsWzBdW2ddWzFdKSxoPTE7ZD5oOysraCl1LmNhbGwobixzW2hdW2ddLHArPWxbaC0xXVtnXVsxXSxsW2hdW2ddWzFdKTtyZXR1cm4gYX12YXIgdD1BdCxyPW9pLGU9YWksdT1paSxpPWVpLG89dWk7cmV0dXJuIG4udmFsdWVzPWZ1bmN0aW9uKHIpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh0PXIsbik6dH0sbi5vcmRlcj1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8ocj0iZnVuY3Rpb24iPT10eXBlb2YgdD90OmxzLmdldCh0KXx8b2ksbik6cn0sbi5vZmZzZXQ9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGU9ImZ1bmN0aW9uIj09dHlwZW9mIHQ/dDpmcy5nZXQodCl8fGFpLG4pOmV9LG4ueD1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oaT10LG4pOml9LG4ueT1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obz10LG4pOm99LG4ub3V0PWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh1PXQsbik6dX0sbn07dmFyIGxzPUJvLm1hcCh7Imluc2lkZS1vdXQiOmZ1bmN0aW9uKG4pe3ZhciB0LHIsZT1uLmxlbmd0aCx1PW4ubWFwKGNpKSxpPW4ubWFwKHNpKSxvPUJvLnJhbmdlKGUpLnNvcnQoZnVuY3Rpb24obix0KXtyZXR1cm4gdVtuXS11W3RdfSksYT0wLGM9MCxzPVtdLGw9W107Zm9yKHQ9MDtlPnQ7Kyt0KXI9b1t0XSxjPmE/KGErPWlbcl0scy5wdXNoKHIpKTooYys9aVtyXSxsLnB1c2gocikpO3JldHVybiBsLnJldmVyc2UoKS5jb25jYXQocyl9LHJldmVyc2U6ZnVuY3Rpb24obil7cmV0dXJuIEJvLnJhbmdlKG4ubGVuZ3RoKS5yZXZlcnNlKCl9LCJkZWZhdWx0IjpvaX0pLGZzPUJvLm1hcCh7c2lsaG91ZXR0ZTpmdW5jdGlvbihuKXt2YXIgdCxyLGUsdT1uLmxlbmd0aCxpPW5bMF0ubGVuZ3RoLG89W10sYT0wLGM9W107Zm9yKHI9MDtpPnI7KytyKXtmb3IodD0wLGU9MDt1PnQ7dCsrKWUrPW5bdF1bcl1bMV07ZT5hJiYoYT1lKSxvLnB1c2goZSl9Zm9yKHI9MDtpPnI7KytyKWNbcl09KGEtb1tyXSkvMjtyZXR1cm4gY30sd2lnZ2xlOmZ1bmN0aW9uKG4pe3ZhciB0LHIsZSx1LGksbyxhLGMscyxsPW4ubGVuZ3RoLGY9blswXSxoPWYubGVuZ3RoLGc9W107Zm9yKGdbMF09Yz1zPTAscj0xO2g+cjsrK3Ipe2Zvcih0PTAsdT0wO2w+dDsrK3QpdSs9blt0XVtyXVsxXTtmb3IodD0wLGk9MCxhPWZbcl1bMF0tZltyLTFdWzBdO2w+dDsrK3Qpe2ZvcihlPTAsbz0oblt0XVtyXVsxXS1uW3RdW3ItMV1bMV0pLygyKmEpO3Q+ZTsrK2Upbys9KG5bZV1bcl1bMV0tbltlXVtyLTFdWzFdKS9hO2krPW8qblt0XVtyXVsxXX1nW3JdPWMtPXU/aS91KmE6MCxzPmMmJihzPWMpfWZvcihyPTA7aD5yOysrcilnW3JdLT1zO3JldHVybiBnfSxleHBhbmQ6ZnVuY3Rpb24obil7dmFyIHQscixlLHU9bi5sZW5ndGgsaT1uWzBdLmxlbmd0aCxvPTEvdSxhPVtdO2ZvcihyPTA7aT5yOysrcil7Zm9yKHQ9MCxlPTA7dT50O3QrKyllKz1uW3RdW3JdWzFdO2lmKGUpZm9yKHQ9MDt1PnQ7dCsrKW5bdF1bcl1bMV0vPWU7ZWxzZSBmb3IodD0wO3U+dDt0Kyspblt0XVtyXVsxXT1vfWZvcihyPTA7aT5yOysrcilhW3JdPTA7cmV0dXJuIGF9LHplcm86YWl9KTtCby5sYXlvdXQuaGlzdG9ncmFtPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbihuLGkpe2Zvcih2YXIgbyxhLGM9W10scz1uLm1hcChyLHRoaXMpLGw9ZS5jYWxsKHRoaXMscyxpKSxmPXUuY2FsbCh0aGlzLGwscyxpKSxpPS0xLGg9cy5sZW5ndGgsZz1mLmxlbmd0aC0xLHA9dD8xOjEvaDsrK2k8Zzspbz1jW2ldPVtdLG8uZHg9ZltpKzFdLShvLng9ZltpXSksby55PTA7aWYoZz4wKWZvcihpPS0xOysraTxoOylhPXNbaV0sYT49bFswXSYmYTw9bFsxXSYmKG89Y1tCby5iaXNlY3QoZixhLDEsZyktMV0sby55Kz1wLG8ucHVzaChuW2ldKSk7cmV0dXJuIGN9dmFyIHQ9ITAscj1OdW1iZXIsZT1naSx1PWZpO3JldHVybiBuLnZhbHVlPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhyPXQsbik6cn0sbi5yYW5nZT1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oZT1FdCh0KSxuKTplfSxuLmJpbnM9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHU9Im51bWJlciI9PXR5cGVvZiB0P2Z1bmN0aW9uKG4pe3JldHVybiBoaShuLHQpfTpFdCh0KSxuKTp1fSxuLmZyZXF1ZW5jeT1mdW5jdGlvbihyKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8odD0hIXIsbik6dH0sbn0sQm8ubGF5b3V0LnBhY2s9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKG4saSl7dmFyIG89ci5jYWxsKHRoaXMsbixpKSxhPW9bMF0sYz11WzBdLHM9dVsxXSxsPW51bGw9PXQ/TWF0aC5zcXJ0OiJmdW5jdGlvbiI9PXR5cGVvZiB0P3Q6ZnVuY3Rpb24oKXtyZXR1cm4gdH07aWYoYS54PWEueT0wLEt1KGEsZnVuY3Rpb24obil7bi5yPStsKG4udmFsdWUpfSksS3UoYSx5aSksZSl7dmFyIGY9ZSoodD8xOk1hdGgubWF4KDIqYS5yL2MsMiphLnIvcykpLzI7S3UoYSxmdW5jdGlvbihuKXtuLnIrPWZ9KSxLdShhLHlpKSxLdShhLGZ1bmN0aW9uKG4pe24uci09Zn0pfXJldHVybiBfaShhLGMvMixzLzIsdD8xOjEvTWF0aC5tYXgoMiphLnIvYywyKmEuci9zKSksb312YXIgdCxyPUJvLmxheW91dC5oaWVyYXJjaHkoKS5zb3J0KHBpKSxlPTAsdT1bMSwxXTtyZXR1cm4gbi5zaXplPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh1PXQsbik6dX0sbi5yYWRpdXM9ZnVuY3Rpb24ocil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHQ9bnVsbD09cnx8ImZ1bmN0aW9uIj09dHlwZW9mIHI/cjorcixuKTp0fSxuLnBhZGRpbmc9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGU9K3Qsbik6ZX0sV3UobixyKX0sQm8ubGF5b3V0LnRyZWU9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKG4sdSl7dmFyIGw9by5jYWxsKHRoaXMsbix1KSxmPWxbMF0saD10KGYpO2lmKEt1KGgsciksaC5wYXJlbnQubT0taC56LEd1KGgsZSkscylHdShmLGkpO2Vsc2V7dmFyIGc9ZixwPWYsdj1mO0d1KGYsZnVuY3Rpb24obil7bi54PGcueCYmKGc9biksbi54PnAueCYmKHA9biksbi5kZXB0aD52LmRlcHRoJiYodj1uKX0pO3ZhciBkPWEoZyxwKS8yLWcueCxtPWNbMF0vKHAueCthKHAsZykvMitkKSx5PWNbMV0vKHYuZGVwdGh8fDEpO0d1KGYsZnVuY3Rpb24obil7bi54PShuLngrZCkqbSxuLnk9bi5kZXB0aCp5fSl9cmV0dXJuIGx9ZnVuY3Rpb24gdChuKXtmb3IodmFyIHQscj17QTpudWxsLGNoaWxkcmVuOltuXX0sZT1bcl07bnVsbCE9KHQ9ZS5wb3AoKSk7KWZvcih2YXIgdSxpPXQuY2hpbGRyZW4sbz0wLGE9aS5sZW5ndGg7YT5vOysrbyllLnB1c2goKGlbb109dT17XzppW29dLHBhcmVudDp0LGNoaWxkcmVuOih1PWlbb10uY2hpbGRyZW4pJiZ1LnNsaWNlKCl8fFtdLEE6bnVsbCxhOm51bGwsejowLG06MCxjOjAsczowLHQ6bnVsbCxpOm99KS5hPXUpO3JldHVybiByLmNoaWxkcmVuWzBdfWZ1bmN0aW9uIHIobil7dmFyIHQ9bi5jaGlsZHJlbixyPW4ucGFyZW50LmNoaWxkcmVuLGU9bi5pP3Jbbi5pLTFdOm51bGw7aWYodC5sZW5ndGgpe0FpKG4pO3ZhciBpPSh0WzBdLnordFt0Lmxlbmd0aC0xXS56KS8yO2U/KG4uej1lLnorYShuLl8sZS5fKSxuLm09bi56LWkpOm4uej1pfWVsc2UgZSYmKG4uej1lLnorYShuLl8sZS5fKSk7bi5wYXJlbnQuQT11KG4sZSxuLnBhcmVudC5BfHxyWzBdKX1mdW5jdGlvbiBlKG4pe24uXy54PW4ueituLnBhcmVudC5tLG4ubSs9bi5wYXJlbnQubX1mdW5jdGlvbiB1KG4sdCxyKXtpZih0KXtmb3IodmFyIGUsdT1uLGk9bixvPXQsYz11LnBhcmVudC5jaGlsZHJlblswXSxzPXUubSxsPWkubSxmPW8ubSxoPWMubTtvPWtpKG8pLHU9U2kodSksbyYmdTspYz1TaShjKSxpPWtpKGkpLGkuYT1uLGU9by56K2YtdS56LXMrYShvLl8sdS5fKSxlPjAmJihFaShDaShvLG4sciksbixlKSxzKz1lLGwrPWUpLGYrPW8ubSxzKz11Lm0saCs9Yy5tLGwrPWkubTtvJiYha2koaSkmJihpLnQ9byxpLm0rPWYtbCksdSYmIVNpKGMpJiYoYy50PXUsYy5tKz1zLWgscj1uKX1yZXR1cm4gcn1mdW5jdGlvbiBpKG4pe24ueCo9Y1swXSxuLnk9bi5kZXB0aCpjWzFdfXZhciBvPUJvLmxheW91dC5oaWVyYXJjaHkoKS5zb3J0KG51bGwpLnZhbHVlKG51bGwpLGE9d2ksYz1bMSwxXSxzPW51bGw7cmV0dXJuIG4uc2VwYXJhdGlvbj1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oYT10LG4pOmF9LG4uc2l6ZT1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8ocz1udWxsPT0oYz10KT9pOm51bGwsbik6cz9udWxsOmN9LG4ubm9kZVNpemU9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHM9bnVsbD09KGM9dCk/bnVsbDppLG4pOnM/YzpudWxsfSxXdShuLG8pfSxCby5sYXlvdXQuY2x1c3Rlcj1mdW5jdGlvbigpe2Z1bmN0aW9uIG4obixpKXt2YXIgbyxhPXQuY2FsbCh0aGlzLG4saSksYz1hWzBdLHM9MDtLdShjLGZ1bmN0aW9uKG4pe3ZhciB0PW4uY2hpbGRyZW47dCYmdC5sZW5ndGg/KG4ueD16aSh0KSxuLnk9TmkodCkpOihuLng9bz9zKz1yKG4sbyk6MCxuLnk9MCxvPW4pfSk7dmFyIGw9TGkoYyksZj1UaShjKSxoPWwueC1yKGwsZikvMixnPWYueCtyKGYsbCkvMjtyZXR1cm4gS3UoYyx1P2Z1bmN0aW9uKG4pe24ueD0obi54LWMueCkqZVswXSxuLnk9KGMueS1uLnkpKmVbMV19OmZ1bmN0aW9uKG4pe24ueD0obi54LWgpLyhnLWgpKmVbMF0sbi55PSgxLShjLnk/bi55L2MueToxKSkqZVsxXX0pLGF9dmFyIHQ9Qm8ubGF5b3V0LmhpZXJhcmNoeSgpLnNvcnQobnVsbCkudmFsdWUobnVsbCkscj13aSxlPVsxLDFdLHU9ITE7cmV0dXJuIG4uc2VwYXJhdGlvbj1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8ocj10LG4pOnJ9LG4uc2l6ZT1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8odT1udWxsPT0oZT10KSxuKTp1P251bGw6ZX0sbi5ub2RlU2l6ZT1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8odT1udWxsIT0oZT10KSxuKTp1P2U6bnVsbH0sV3Uobix0KX0sQm8ubGF5b3V0LnRyZWVtYXA9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKG4sdCl7Zm9yKHZhciByLGUsdT0tMSxpPW4ubGVuZ3RoOysrdTxpOyllPShyPW5bdV0pLnZhbHVlKigwPnQ/MDp0KSxyLmFyZWE9aXNOYU4oZSl8fDA+PWU/MDplfWZ1bmN0aW9uIHQocil7dmFyIGk9ci5jaGlsZHJlbjtpZihpJiZpLmxlbmd0aCl7dmFyIG8sYSxjLHM9ZihyKSxsPVtdLGg9aS5zbGljZSgpLHA9MS8wLHY9InNsaWNlIj09PWc/cy5keDoiZGljZSI9PT1nP3MuZHk6InNsaWNlLWRpY2UiPT09Zz8xJnIuZGVwdGg/cy5keTpzLmR4Ok1hdGgubWluKHMuZHgscy5keSk7Zm9yKG4oaCxzLmR4KnMuZHkvci52YWx1ZSksbC5hcmVhPTA7KGM9aC5sZW5ndGgpPjA7KWwucHVzaChvPWhbYy0xXSksbC5hcmVhKz1vLmFyZWEsInNxdWFyaWZ5IiE9PWd8fChhPWUobCx2KSk8PXA/KGgucG9wKCkscD1hKToobC5hcmVhLT1sLnBvcCgpLmFyZWEsdShsLHYscywhMSksdj1NYXRoLm1pbihzLmR4LHMuZHkpLGwubGVuZ3RoPWwuYXJlYT0wLHA9MS8wKTtsLmxlbmd0aCYmKHUobCx2LHMsITApLGwubGVuZ3RoPWwuYXJlYT0wKSxpLmZvckVhY2godCl9fWZ1bmN0aW9uIHIodCl7dmFyIGU9dC5jaGlsZHJlbjtpZihlJiZlLmxlbmd0aCl7dmFyIGksbz1mKHQpLGE9ZS5zbGljZSgpLGM9W107Zm9yKG4oYSxvLmR4Km8uZHkvdC52YWx1ZSksYy5hcmVhPTA7aT1hLnBvcCgpOyljLnB1c2goaSksYy5hcmVhKz1pLmFyZWEsbnVsbCE9aS56JiYodShjLGkuej9vLmR4Om8uZHksbywhYS5sZW5ndGgpLGMubGVuZ3RoPWMuYXJlYT0wKTtlLmZvckVhY2gocil9fWZ1bmN0aW9uIGUobix0KXtmb3IodmFyIHIsZT1uLmFyZWEsdT0wLGk9MS8wLG89LTEsYT1uLmxlbmd0aDsrK288YTspKHI9bltvXS5hcmVhKSYmKGk+ciYmKGk9cikscj51JiYodT1yKSk7cmV0dXJuIGUqPWUsdCo9dCxlP01hdGgubWF4KHQqdSpwL2UsZS8odCppKnApKToxLzB9ZnVuY3Rpb24gdShuLHQscixlKXt2YXIgdSxpPS0xLG89bi5sZW5ndGgsYT1yLngscz1yLnksbD10P2Mobi5hcmVhL3QpOjA7aWYodD09ci5keCl7Zm9yKChlfHxsPnIuZHkpJiYobD1yLmR5KTsrK2k8bzspdT1uW2ldLHUueD1hLHUueT1zLHUuZHk9bCxhKz11LmR4PU1hdGgubWluKHIueCtyLmR4LWEsbD9jKHUuYXJlYS9sKTowKTt1Lno9ITAsdS5keCs9ci54K3IuZHgtYSxyLnkrPWwsci5keS09bH1lbHNle2ZvcigoZXx8bD5yLmR4KSYmKGw9ci5keCk7KytpPG87KXU9bltpXSx1Lng9YSx1Lnk9cyx1LmR4PWwscys9dS5keT1NYXRoLm1pbihyLnkrci5keS1zLGw/Yyh1LmFyZWEvbCk6MCk7dS56PSExLHUuZHkrPXIueStyLmR5LXMsci54Kz1sLHIuZHgtPWx9fWZ1bmN0aW9uIGkoZSl7dmFyIHU9b3x8YShlKSxpPXVbMF07cmV0dXJuIGkueD0wLGkueT0wLGkuZHg9c1swXSxpLmR5PXNbMV0sbyYmYS5yZXZhbHVlKGkpLG4oW2ldLGkuZHgqaS5keS9pLnZhbHVlKSwobz9yOnQpKGkpLGgmJihvPXUpLHV9dmFyIG8sYT1Cby5sYXlvdXQuaGllcmFyY2h5KCksYz1NYXRoLnJvdW5kLHM9WzEsMV0sbD1udWxsLGY9cWksaD0hMSxnPSJzcXVhcmlmeSIscD0uNSooMStNYXRoLnNxcnQoNSkpO3JldHVybiBpLnNpemU9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHM9bixpKTpzfSxpLnBhZGRpbmc9ZnVuY3Rpb24obil7ZnVuY3Rpb24gdCh0KXt2YXIgcj1uLmNhbGwoaSx0LHQuZGVwdGgpO3JldHVybiBudWxsPT1yP3FpKHQpOlJpKHQsIm51bWJlciI9PXR5cGVvZiByP1tyLHIscixyXTpyKX1mdW5jdGlvbiByKHQpe3JldHVybiBSaSh0LG4pfWlmKCFhcmd1bWVudHMubGVuZ3RoKXJldHVybiBsO3ZhciBlO3JldHVybiBmPW51bGw9PShsPW4pP3FpOiJmdW5jdGlvbiI9PShlPXR5cGVvZiBuKT90OiJudW1iZXIiPT09ZT8obj1bbixuLG4sbl0scik6cixpfSxpLnJvdW5kPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhjPW4/TWF0aC5yb3VuZDpOdW1iZXIsaSk6YyE9TnVtYmVyfSxpLnN0aWNreT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oaD1uLG89bnVsbCxpKTpofSxpLnJhdGlvPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhwPW4saSk6cH0saS5tb2RlPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhnPW4rIiIsaSk6Z30sV3UoaSxhKX0sQm8ucmFuZG9tPXtub3JtYWw6ZnVuY3Rpb24obix0KXt2YXIgcj1hcmd1bWVudHMubGVuZ3RoO3JldHVybiAyPnImJih0PTEpLDE+ciYmKG49MCksZnVuY3Rpb24oKXt2YXIgcixlLHU7ZG8gcj0yKk1hdGgucmFuZG9tKCktMSxlPTIqTWF0aC5yYW5kb20oKS0xLHU9cipyK2UqZTt3aGlsZSghdXx8dT4xKTtyZXR1cm4gbit0KnIqTWF0aC5zcXJ0KC0yKk1hdGgubG9nKHUpL3UpfX0sbG9nTm9ybWFsOmZ1bmN0aW9uKCl7dmFyIG49Qm8ucmFuZG9tLm5vcm1hbC5hcHBseShCbyxhcmd1bWVudHMpO3JldHVybiBmdW5jdGlvbigpe3JldHVybiBNYXRoLmV4cChuKCkpfX0sYmF0ZXM6ZnVuY3Rpb24obil7dmFyIHQ9Qm8ucmFuZG9tLmlyd2luSGFsbChuKTtyZXR1cm4gZnVuY3Rpb24oKXtyZXR1cm4gdCgpL259fSxpcndpbkhhbGw6ZnVuY3Rpb24obil7cmV0dXJuIGZ1bmN0aW9uKCl7Zm9yKHZhciB0PTAscj0wO24+cjtyKyspdCs9TWF0aC5yYW5kb20oKTtyZXR1cm4gdH19fSxCby5zY2FsZT17fTt2YXIgaHM9e2Zsb29yOkF0LGNlaWw6QXR9O0JvLnNjYWxlLmxpbmVhcj1mdW5jdGlvbigpe3JldHVybiBPaShbMCwxXSxbMCwxXSxkdSwhMSl9O3ZhciBncz17czoxLGc6MSxwOjEscjoxLGU6MX07Qm8uc2NhbGUubG9nPWZ1bmN0aW9uKCl7cmV0dXJuIEppKEJvLnNjYWxlLmxpbmVhcigpLmRvbWFpbihbMCwxXSksMTAsITAsWzEsMTBdKX07dmFyIHBzPUJvLmZvcm1hdCgiLjBlIiksdnM9e2Zsb29yOmZ1bmN0aW9uKG4pe3JldHVybi1NYXRoLmNlaWwoLW4pfSxjZWlsOmZ1bmN0aW9uKG4pe3JldHVybi1NYXRoLmZsb29yKC1uKX19O0JvLnNjYWxlLnBvdz1mdW5jdGlvbigpe3JldHVybiBXaShCby5zY2FsZS5saW5lYXIoKSwxLFswLDFdKX0sQm8uc2NhbGUuc3FydD1mdW5jdGlvbigpe3JldHVybiBCby5zY2FsZS5wb3coKS5leHBvbmVudCguNSl9LEJvLnNjYWxlLm9yZGluYWw9ZnVuY3Rpb24oKXtyZXR1cm4gS2koW10se3Q6InJhbmdlIixhOltbXV19KX0sQm8uc2NhbGUuY2F0ZWdvcnkxMD1mdW5jdGlvbigpe3JldHVybiBCby5zY2FsZS5vcmRpbmFsKCkucmFuZ2UoZHMpfSxCby5zY2FsZS5jYXRlZ29yeTIwPWZ1bmN0aW9uKCl7cmV0dXJuIEJvLnNjYWxlLm9yZGluYWwoKS5yYW5nZShtcyl9LEJvLnNjYWxlLmNhdGVnb3J5MjBiPWZ1bmN0aW9uKCl7cmV0dXJuIEJvLnNjYWxlLm9yZGluYWwoKS5yYW5nZSh5cyl9LEJvLnNjYWxlLmNhdGVnb3J5MjBjPWZ1bmN0aW9uKCl7cmV0dXJuIEJvLnNjYWxlLm9yZGluYWwoKS5yYW5nZSh4cyl9O3ZhciBkcz1bMjA2MjI2MCwxNjc0NDIwNiwyOTI0NTg4LDE0MDM0NzI4LDk3MjU4ODUsOTE5NzEzMSwxNDkwNzMzMCw4MzU1NzExLDEyMzY5MTg2LDE1NTYxNzVdLm1hcChtdCksbXM9WzIwNjIyNjAsMTE0NTQ0NDAsMTY3NDQyMDYsMTY3NTk2NzIsMjkyNDU4OCwxMDAxODY5OCwxNDAzNDcyOCwxNjc1MDc0Miw5NzI1ODg1LDEyOTU1ODYxLDkxOTcxMzEsMTI4ODUxNDAsMTQ5MDczMzAsMTYyMzQxOTQsODM1NTcxMSwxMzA5MjgwNywxMjM2OTE4NiwxNDQwODU4OSwxNTU2MTc1LDEwNDEwNzI1XS5tYXAobXQpLHlzPVszNzUwNzc3LDUzOTU2MTksNzA0MDcxOSwxMDI2NDI4Niw2NTE5MDk3LDkyMTY1OTQsMTE5MTUxMTUsMTM1NTY2MzYsOTIwMjk5MywxMjQyNjgwOSwxNTE4NjUxNCwxNTE5MDkzMiw4NjY2MTY5LDExMzU2NDkwLDE0MDQ5NjQzLDE1MTc3MzcyLDgwNzc2ODMsMTA4MzQzMjQsMTM1Mjg1MDksMTQ1ODk2NTRdLm1hcChtdCkseHM9WzMyNDQ3MzMsNzA1NzExMCwxMDQwNjYyNSwxMzAzMjQzMSwxNTA5NTA1MywxNjYxNjc2NCwxNjYyNTI1OSwxNjYzNDAxOCwzMjUzMDc2LDc2NTI0NzAsMTA2MDcwMDMsMTMxMDE1MDQsNzY5NTI4MSwxMDM5NDMxMiwxMjM2OTM3MiwxNDM0Mjg5MSw2NTEzNTA3LDk4Njg5NTAsMTI0MzQ4NzcsMTQyNzcwODFdLm1hcChtdCk7Qm8uc2NhbGUucXVhbnRpbGU9ZnVuY3Rpb24oKXtyZXR1cm4gUWkoW10sW10pfSxCby5zY2FsZS5xdWFudGl6ZT1mdW5jdGlvbigpe3JldHVybiBubygwLDEsWzAsMV0pfSxCby5zY2FsZS50aHJlc2hvbGQ9ZnVuY3Rpb24oKXtyZXR1cm4gdG8oWy41XSxbMCwxXSl9LEJvLnNjYWxlLmlkZW50aXR5PWZ1bmN0aW9uKCl7cmV0dXJuIHJvKFswLDFdKX0sQm8uc3ZnPXt9LEJvLnN2Zy5hcmM9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKCl7dmFyIG49dC5hcHBseSh0aGlzLGFyZ3VtZW50cyksaT1yLmFwcGx5KHRoaXMsYXJndW1lbnRzKSxvPWUuYXBwbHkodGhpcyxhcmd1bWVudHMpK01zLGE9dS5hcHBseSh0aGlzLGFyZ3VtZW50cykrTXMsYz0obz5hJiYoYz1vLG89YSxhPWMpLGEtbykscz1rYT5jPyIwIjoiMSIsbD1NYXRoLmNvcyhvKSxmPU1hdGguc2luKG8pLGg9TWF0aC5jb3MoYSksZz1NYXRoLnNpbihhKTsKcmV0dXJuIGM+PV9zP24/Ik0wLCIraSsiQSIraSsiLCIraSsiIDAgMSwxIDAsIistaSsiQSIraSsiLCIraSsiIDAgMSwxIDAsIitpKyJNMCwiK24rIkEiK24rIiwiK24rIiAwIDEsMCAwLCIrLW4rIkEiK24rIiwiK24rIiAwIDEsMCAwLCIrbisiWiI6Ik0wLCIraSsiQSIraSsiLCIraSsiIDAgMSwxIDAsIistaSsiQSIraSsiLCIraSsiIDAgMSwxIDAsIitpKyJaIjpuPyJNIitpKmwrIiwiK2kqZisiQSIraSsiLCIraSsiIDAgIitzKyIsMSAiK2kqaCsiLCIraSpnKyJMIituKmgrIiwiK24qZysiQSIrbisiLCIrbisiIDAgIitzKyIsMCAiK24qbCsiLCIrbipmKyJaIjoiTSIraSpsKyIsIitpKmYrIkEiK2krIiwiK2krIiAwICIrcysiLDEgIitpKmgrIiwiK2kqZysiTDAsMCIrIloifXZhciB0PWVvLHI9dW8sZT1pbyx1PW9vO3JldHVybiBuLmlubmVyUmFkaXVzPWZ1bmN0aW9uKHIpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh0PUV0KHIpLG4pOnR9LG4ub3V0ZXJSYWRpdXM9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHI9RXQodCksbik6cn0sbi5zdGFydEFuZ2xlPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhlPUV0KHQpLG4pOmV9LG4uZW5kQW5nbGU9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHU9RXQodCksbik6dX0sbi5jZW50cm9pZD1mdW5jdGlvbigpe3ZhciBuPSh0LmFwcGx5KHRoaXMsYXJndW1lbnRzKStyLmFwcGx5KHRoaXMsYXJndW1lbnRzKSkvMixpPShlLmFwcGx5KHRoaXMsYXJndW1lbnRzKSt1LmFwcGx5KHRoaXMsYXJndW1lbnRzKSkvMitNcztyZXR1cm5bTWF0aC5jb3MoaSkqbixNYXRoLnNpbihpKSpuXX0sbn07dmFyIE1zPS1BYSxfcz1FYS1DYTtCby5zdmcubGluZT1mdW5jdGlvbigpe3JldHVybiBhbyhBdCl9O3ZhciBicz1Cby5tYXAoe2xpbmVhcjpjbywibGluZWFyLWNsb3NlZCI6c28sc3RlcDpsbywic3RlcC1iZWZvcmUiOmZvLCJzdGVwLWFmdGVyIjpobyxiYXNpczp4bywiYmFzaXMtb3BlbiI6TW8sImJhc2lzLWNsb3NlZCI6X28sYnVuZGxlOmJvLGNhcmRpbmFsOnZvLCJjYXJkaW5hbC1vcGVuIjpnbywiY2FyZGluYWwtY2xvc2VkIjpwbyxtb25vdG9uZTpDb30pO2JzLmZvckVhY2goZnVuY3Rpb24obix0KXt0LmtleT1uLHQuY2xvc2VkPS8tY2xvc2VkJC8udGVzdChuKX0pO3ZhciB3cz1bMCwyLzMsMS8zLDBdLFNzPVswLDEvMywyLzMsMF0sa3M9WzAsMS82LDIvMywxLzZdO0JvLnN2Zy5saW5lLnJhZGlhbD1mdW5jdGlvbigpe3ZhciBuPWFvKE5vKTtyZXR1cm4gbi5yYWRpdXM9bi54LGRlbGV0ZSBuLngsbi5hbmdsZT1uLnksZGVsZXRlIG4ueSxufSxmby5yZXZlcnNlPWhvLGhvLnJldmVyc2U9Zm8sQm8uc3ZnLmFyZWE9ZnVuY3Rpb24oKXtyZXR1cm4gem8oQXQpfSxCby5zdmcuYXJlYS5yYWRpYWw9ZnVuY3Rpb24oKXt2YXIgbj16byhObyk7cmV0dXJuIG4ucmFkaXVzPW4ueCxkZWxldGUgbi54LG4uaW5uZXJSYWRpdXM9bi54MCxkZWxldGUgbi54MCxuLm91dGVyUmFkaXVzPW4ueDEsZGVsZXRlIG4ueDEsbi5hbmdsZT1uLnksZGVsZXRlIG4ueSxuLnN0YXJ0QW5nbGU9bi55MCxkZWxldGUgbi55MCxuLmVuZEFuZ2xlPW4ueTEsZGVsZXRlIG4ueTEsbn0sQm8uc3ZnLmNob3JkPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbihuLGEpe3ZhciBjPXQodGhpcyxpLG4sYSkscz10KHRoaXMsbyxuLGEpO3JldHVybiJNIitjLnAwK2UoYy5yLGMucDEsYy5hMS1jLmEwKSsocihjLHMpP3UoYy5yLGMucDEsYy5yLGMucDApOnUoYy5yLGMucDEscy5yLHMucDApK2Uocy5yLHMucDEscy5hMS1zLmEwKSt1KHMucixzLnAxLGMucixjLnAwKSkrIloifWZ1bmN0aW9uIHQobix0LHIsZSl7dmFyIHU9dC5jYWxsKG4scixlKSxpPWEuY2FsbChuLHUsZSksbz1jLmNhbGwobix1LGUpK01zLGw9cy5jYWxsKG4sdSxlKStNcztyZXR1cm57cjppLGEwOm8sYTE6bCxwMDpbaSpNYXRoLmNvcyhvKSxpKk1hdGguc2luKG8pXSxwMTpbaSpNYXRoLmNvcyhsKSxpKk1hdGguc2luKGwpXX19ZnVuY3Rpb24gcihuLHQpe3JldHVybiBuLmEwPT10LmEwJiZuLmExPT10LmExfWZ1bmN0aW9uIGUobix0LHIpe3JldHVybiJBIituKyIsIituKyIgMCAiKyArKHI+a2EpKyIsMSAiK3R9ZnVuY3Rpb24gdShuLHQscixlKXtyZXR1cm4iUSAwLDAgIitlfXZhciBpPW1lLG89eWUsYT1MbyxjPWlvLHM9b287cmV0dXJuIG4ucmFkaXVzPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhhPUV0KHQpLG4pOmF9LG4uc291cmNlPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhpPUV0KHQpLG4pOml9LG4udGFyZ2V0PWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhvPUV0KHQpLG4pOm99LG4uc3RhcnRBbmdsZT1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oYz1FdCh0KSxuKTpjfSxuLmVuZEFuZ2xlPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhzPUV0KHQpLG4pOnN9LG59LEJvLnN2Zy5kaWFnb25hbD1mdW5jdGlvbigpe2Z1bmN0aW9uIG4obix1KXt2YXIgaT10LmNhbGwodGhpcyxuLHUpLG89ci5jYWxsKHRoaXMsbix1KSxhPShpLnkrby55KS8yLGM9W2kse3g6aS54LHk6YX0se3g6by54LHk6YX0sb107cmV0dXJuIGM9Yy5tYXAoZSksIk0iK2NbMF0rIkMiK2NbMV0rIiAiK2NbMl0rIiAiK2NbM119dmFyIHQ9bWUscj15ZSxlPVRvO3JldHVybiBuLnNvdXJjZT1mdW5jdGlvbihyKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8odD1FdChyKSxuKTp0fSxuLnRhcmdldD1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8ocj1FdCh0KSxuKTpyfSxuLnByb2plY3Rpb249ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGU9dCxuKTplfSxufSxCby5zdmcuZGlhZ29uYWwucmFkaWFsPWZ1bmN0aW9uKCl7dmFyIG49Qm8uc3ZnLmRpYWdvbmFsKCksdD1UbyxyPW4ucHJvamVjdGlvbjtyZXR1cm4gbi5wcm9qZWN0aW9uPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoP3IocW8odD1uKSk6dH0sbn0sQm8uc3ZnLnN5bWJvbD1mdW5jdGlvbigpe2Z1bmN0aW9uIG4obixlKXtyZXR1cm4oRXMuZ2V0KHQuY2FsbCh0aGlzLG4sZSkpfHxQbykoci5jYWxsKHRoaXMsbixlKSl9dmFyIHQ9RG8scj1SbztyZXR1cm4gbi50eXBlPWZ1bmN0aW9uKHIpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh0PUV0KHIpLG4pOnR9LG4uc2l6ZT1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8ocj1FdCh0KSxuKTpyfSxufTt2YXIgRXM9Qm8ubWFwKHtjaXJjbGU6UG8sY3Jvc3M6ZnVuY3Rpb24obil7dmFyIHQ9TWF0aC5zcXJ0KG4vNSkvMjtyZXR1cm4iTSIrLTMqdCsiLCIrLXQrIkgiKy10KyJWIistMyp0KyJIIit0KyJWIistdCsiSCIrMyp0KyJWIit0KyJIIit0KyJWIiszKnQrIkgiKy10KyJWIit0KyJIIistMyp0KyJaIn0sZGlhbW9uZDpmdW5jdGlvbihuKXt2YXIgdD1NYXRoLnNxcnQobi8oMip6cykpLHI9dCp6cztyZXR1cm4iTTAsIistdCsiTCIrcisiLDAiKyIgMCwiK3QrIiAiKy1yKyIsMCIrIloifSxzcXVhcmU6ZnVuY3Rpb24obil7dmFyIHQ9TWF0aC5zcXJ0KG4pLzI7cmV0dXJuIk0iKy10KyIsIistdCsiTCIrdCsiLCIrLXQrIiAiK3QrIiwiK3QrIiAiKy10KyIsIit0KyJaIn0sInRyaWFuZ2xlLWRvd24iOmZ1bmN0aW9uKG4pe3ZhciB0PU1hdGguc3FydChuL05zKSxyPXQqTnMvMjtyZXR1cm4iTTAsIityKyJMIit0KyIsIistcisiICIrLXQrIiwiKy1yKyJaIn0sInRyaWFuZ2xlLXVwIjpmdW5jdGlvbihuKXt2YXIgdD1NYXRoLnNxcnQobi9Ocykscj10Kk5zLzI7cmV0dXJuIk0wLCIrLXIrIkwiK3QrIiwiK3IrIiAiKy10KyIsIityKyJaIn19KTtCby5zdmcuc3ltYm9sVHlwZXM9RXMua2V5cygpO3ZhciBBcyxDcyxOcz1NYXRoLnNxcnQoMyksenM9TWF0aC50YW4oMzAqemEpLExzPVtdLFRzPTA7THMuY2FsbD15YS5jYWxsLExzLmVtcHR5PXlhLmVtcHR5LExzLm5vZGU9eWEubm9kZSxMcy5zaXplPXlhLnNpemUsQm8udHJhbnNpdGlvbj1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD9Bcz9uLnRyYW5zaXRpb24oKTpuOl9hLnRyYW5zaXRpb24oKX0sQm8udHJhbnNpdGlvbi5wcm90b3R5cGU9THMsTHMuc2VsZWN0PWZ1bmN0aW9uKG4pe3ZhciB0LHIsZSx1PXRoaXMuaWQsaT1bXTtuPWIobik7Zm9yKHZhciBvPS0xLGE9dGhpcy5sZW5ndGg7KytvPGE7KXtpLnB1c2godD1bXSk7Zm9yKHZhciBjPXRoaXNbb10scz0tMSxsPWMubGVuZ3RoOysrczxsOykoZT1jW3NdKSYmKHI9bi5jYWxsKGUsZS5fX2RhdGFfXyxzLG8pKT8oIl9fZGF0YV9fImluIGUmJihyLl9fZGF0YV9fPWUuX19kYXRhX18pLEZvKHIscyx1LGUuX190cmFuc2l0aW9uX19bdV0pLHQucHVzaChyKSk6dC5wdXNoKG51bGwpfXJldHVybiBVbyhpLHUpfSxMcy5zZWxlY3RBbGw9ZnVuY3Rpb24obil7dmFyIHQscixlLHUsaSxvPXRoaXMuaWQsYT1bXTtuPXcobik7Zm9yKHZhciBjPS0xLHM9dGhpcy5sZW5ndGg7KytjPHM7KWZvcih2YXIgbD10aGlzW2NdLGY9LTEsaD1sLmxlbmd0aDsrK2Y8aDspaWYoZT1sW2ZdKXtpPWUuX190cmFuc2l0aW9uX19bb10scj1uLmNhbGwoZSxlLl9fZGF0YV9fLGYsYyksYS5wdXNoKHQ9W10pO2Zvcih2YXIgZz0tMSxwPXIubGVuZ3RoOysrZzxwOykodT1yW2ddKSYmRm8odSxnLG8saSksdC5wdXNoKHUpfXJldHVybiBVbyhhLG8pfSxMcy5maWx0ZXI9ZnVuY3Rpb24obil7dmFyIHQscixlLHU9W107ImZ1bmN0aW9uIiE9dHlwZW9mIG4mJihuPVIobikpO2Zvcih2YXIgaT0wLG89dGhpcy5sZW5ndGg7bz5pO2krKyl7dS5wdXNoKHQ9W10pO2Zvcih2YXIgcj10aGlzW2ldLGE9MCxjPXIubGVuZ3RoO2M+YTthKyspKGU9clthXSkmJm4uY2FsbChlLGUuX19kYXRhX18sYSxpKSYmdC5wdXNoKGUpfXJldHVybiBVbyh1LHRoaXMuaWQpfSxMcy50d2Vlbj1mdW5jdGlvbihuLHQpe3ZhciByPXRoaXMuaWQ7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg8Mj90aGlzLm5vZGUoKS5fX3RyYW5zaXRpb25fX1tyXS50d2Vlbi5nZXQobik6UCh0aGlzLG51bGw9PXQ/ZnVuY3Rpb24odCl7dC5fX3RyYW5zaXRpb25fX1tyXS50d2Vlbi5yZW1vdmUobil9OmZ1bmN0aW9uKGUpe2UuX190cmFuc2l0aW9uX19bcl0udHdlZW4uc2V0KG4sdCl9KX0sTHMuYXR0cj1mdW5jdGlvbihuLHQpe2Z1bmN0aW9uIHIoKXt0aGlzLnJlbW92ZUF0dHJpYnV0ZShhKX1mdW5jdGlvbiBlKCl7dGhpcy5yZW1vdmVBdHRyaWJ1dGVOUyhhLnNwYWNlLGEubG9jYWwpfWZ1bmN0aW9uIHUobil7cmV0dXJuIG51bGw9PW4/cjoobis9IiIsZnVuY3Rpb24oKXt2YXIgdCxyPXRoaXMuZ2V0QXR0cmlidXRlKGEpO3JldHVybiByIT09biYmKHQ9byhyLG4pLGZ1bmN0aW9uKG4pe3RoaXMuc2V0QXR0cmlidXRlKGEsdChuKSl9KX0pfWZ1bmN0aW9uIGkobil7cmV0dXJuIG51bGw9PW4/ZToobis9IiIsZnVuY3Rpb24oKXt2YXIgdCxyPXRoaXMuZ2V0QXR0cmlidXRlTlMoYS5zcGFjZSxhLmxvY2FsKTtyZXR1cm4gciE9PW4mJih0PW8ocixuKSxmdW5jdGlvbihuKXt0aGlzLnNldEF0dHJpYnV0ZU5TKGEuc3BhY2UsYS5sb2NhbCx0KG4pKX0pfSl9aWYoYXJndW1lbnRzLmxlbmd0aDwyKXtmb3IodCBpbiBuKXRoaXMuYXR0cih0LG5bdF0pO3JldHVybiB0aGlzfXZhciBvPSJ0cmFuc2Zvcm0iPT1uP0h1OmR1LGE9Qm8ubnMucXVhbGlmeShuKTtyZXR1cm4gam8odGhpcywiYXR0ci4iK24sdCxhLmxvY2FsP2k6dSl9LExzLmF0dHJUd2Vlbj1mdW5jdGlvbihuLHQpe2Z1bmN0aW9uIHIobixyKXt2YXIgZT10LmNhbGwodGhpcyxuLHIsdGhpcy5nZXRBdHRyaWJ1dGUodSkpO3JldHVybiBlJiZmdW5jdGlvbihuKXt0aGlzLnNldEF0dHJpYnV0ZSh1LGUobikpfX1mdW5jdGlvbiBlKG4scil7dmFyIGU9dC5jYWxsKHRoaXMsbixyLHRoaXMuZ2V0QXR0cmlidXRlTlModS5zcGFjZSx1LmxvY2FsKSk7cmV0dXJuIGUmJmZ1bmN0aW9uKG4pe3RoaXMuc2V0QXR0cmlidXRlTlModS5zcGFjZSx1LmxvY2FsLGUobikpfX12YXIgdT1Cby5ucy5xdWFsaWZ5KG4pO3JldHVybiB0aGlzLnR3ZWVuKCJhdHRyLiIrbix1LmxvY2FsP2U6cil9LExzLnN0eWxlPWZ1bmN0aW9uKG4sdCxyKXtmdW5jdGlvbiBlKCl7dGhpcy5zdHlsZS5yZW1vdmVQcm9wZXJ0eShuKX1mdW5jdGlvbiB1KHQpe3JldHVybiBudWxsPT10P2U6KHQrPSIiLGZ1bmN0aW9uKCl7dmFyIGUsdT1Rby5nZXRDb21wdXRlZFN0eWxlKHRoaXMsbnVsbCkuZ2V0UHJvcGVydHlWYWx1ZShuKTtyZXR1cm4gdSE9PXQmJihlPWR1KHUsdCksZnVuY3Rpb24odCl7dGhpcy5zdHlsZS5zZXRQcm9wZXJ0eShuLGUodCkscil9KX0pfXZhciBpPWFyZ3VtZW50cy5sZW5ndGg7aWYoMz5pKXtpZigic3RyaW5nIiE9dHlwZW9mIG4pezI+aSYmKHQ9IiIpO2ZvcihyIGluIG4pdGhpcy5zdHlsZShyLG5bcl0sdCk7cmV0dXJuIHRoaXN9cj0iIn1yZXR1cm4gam8odGhpcywic3R5bGUuIituLHQsdSl9LExzLnN0eWxlVHdlZW49ZnVuY3Rpb24obix0LHIpe2Z1bmN0aW9uIGUoZSx1KXt2YXIgaT10LmNhbGwodGhpcyxlLHUsUW8uZ2V0Q29tcHV0ZWRTdHlsZSh0aGlzLG51bGwpLmdldFByb3BlcnR5VmFsdWUobikpO3JldHVybiBpJiZmdW5jdGlvbih0KXt0aGlzLnN0eWxlLnNldFByb3BlcnR5KG4saSh0KSxyKX19cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg8MyYmKHI9IiIpLHRoaXMudHdlZW4oInN0eWxlLiIrbixlKX0sTHMudGV4dD1mdW5jdGlvbihuKXtyZXR1cm4gam8odGhpcywidGV4dCIsbixIbyl9LExzLnJlbW92ZT1mdW5jdGlvbigpe3JldHVybiB0aGlzLmVhY2goImVuZC50cmFuc2l0aW9uIixmdW5jdGlvbigpe3ZhciBuO3RoaXMuX190cmFuc2l0aW9uX18uY291bnQ8MiYmKG49dGhpcy5wYXJlbnROb2RlKSYmbi5yZW1vdmVDaGlsZCh0aGlzKX0pfSxMcy5lYXNlPWZ1bmN0aW9uKG4pe3ZhciB0PXRoaXMuaWQ7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg8MT90aGlzLm5vZGUoKS5fX3RyYW5zaXRpb25fX1t0XS5lYXNlOigiZnVuY3Rpb24iIT10eXBlb2YgbiYmKG49Qm8uZWFzZS5hcHBseShCbyxhcmd1bWVudHMpKSxQKHRoaXMsZnVuY3Rpb24ocil7ci5fX3RyYW5zaXRpb25fX1t0XS5lYXNlPW59KSl9LExzLmRlbGF5PWZ1bmN0aW9uKG4pe3ZhciB0PXRoaXMuaWQ7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg8MT90aGlzLm5vZGUoKS5fX3RyYW5zaXRpb25fX1t0XS5kZWxheTpQKHRoaXMsImZ1bmN0aW9uIj09dHlwZW9mIG4/ZnVuY3Rpb24ocixlLHUpe3IuX190cmFuc2l0aW9uX19bdF0uZGVsYXk9K24uY2FsbChyLHIuX19kYXRhX18sZSx1KX06KG49K24sZnVuY3Rpb24ocil7ci5fX3RyYW5zaXRpb25fX1t0XS5kZWxheT1ufSkpfSxMcy5kdXJhdGlvbj1mdW5jdGlvbihuKXt2YXIgdD10aGlzLmlkO3JldHVybiBhcmd1bWVudHMubGVuZ3RoPDE/dGhpcy5ub2RlKCkuX190cmFuc2l0aW9uX19bdF0uZHVyYXRpb246UCh0aGlzLCJmdW5jdGlvbiI9PXR5cGVvZiBuP2Z1bmN0aW9uKHIsZSx1KXtyLl9fdHJhbnNpdGlvbl9fW3RdLmR1cmF0aW9uPU1hdGgubWF4KDEsbi5jYWxsKHIsci5fX2RhdGFfXyxlLHUpKX06KG49TWF0aC5tYXgoMSxuKSxmdW5jdGlvbihyKXtyLl9fdHJhbnNpdGlvbl9fW3RdLmR1cmF0aW9uPW59KSl9LExzLmVhY2g9ZnVuY3Rpb24obix0KXt2YXIgcj10aGlzLmlkO2lmKGFyZ3VtZW50cy5sZW5ndGg8Mil7dmFyIGU9Q3MsdT1BcztBcz1yLFAodGhpcyxmdW5jdGlvbih0LGUsdSl7Q3M9dC5fX3RyYW5zaXRpb25fX1tyXSxuLmNhbGwodCx0Ll9fZGF0YV9fLGUsdSl9KSxDcz1lLEFzPXV9ZWxzZSBQKHRoaXMsZnVuY3Rpb24oZSl7dmFyIHU9ZS5fX3RyYW5zaXRpb25fX1tyXTsodS5ldmVudHx8KHUuZXZlbnQ9Qm8uZGlzcGF0Y2goInN0YXJ0IiwiZW5kIikpKS5vbihuLHQpfSk7cmV0dXJuIHRoaXN9LExzLnRyYW5zaXRpb249ZnVuY3Rpb24oKXtmb3IodmFyIG4sdCxyLGUsdT10aGlzLmlkLGk9KytUcyxvPVtdLGE9MCxjPXRoaXMubGVuZ3RoO2M+YTthKyspe28ucHVzaChuPVtdKTtmb3IodmFyIHQ9dGhpc1thXSxzPTAsbD10Lmxlbmd0aDtsPnM7cysrKShyPXRbc10pJiYoZT1PYmplY3QuY3JlYXRlKHIuX190cmFuc2l0aW9uX19bdV0pLGUuZGVsYXkrPWUuZHVyYXRpb24sRm8ocixzLGksZSkpLG4ucHVzaChyKX1yZXR1cm4gVW8obyxpKX0sQm8uc3ZnLmF4aXM9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKG4pe24uZWFjaChmdW5jdGlvbigpe3ZhciBuLHM9Qm8uc2VsZWN0KHRoaXMpLGw9dGhpcy5fX2NoYXJ0X198fHIsZj10aGlzLl9fY2hhcnRfXz1yLmNvcHkoKSxoPW51bGw9PWM/Zi50aWNrcz9mLnRpY2tzLmFwcGx5KGYsYSk6Zi5kb21haW4oKTpjLGc9bnVsbD09dD9mLnRpY2tGb3JtYXQ/Zi50aWNrRm9ybWF0LmFwcGx5KGYsYSk6QXQ6dCxwPXMuc2VsZWN0QWxsKCIudGljayIpLmRhdGEoaCxmKSx2PXAuZW50ZXIoKS5pbnNlcnQoImciLCIuZG9tYWluIikuYXR0cigiY2xhc3MiLCJ0aWNrIikuc3R5bGUoIm9wYWNpdHkiLENhKSxkPUJvLnRyYW5zaXRpb24ocC5leGl0KCkpLnN0eWxlKCJvcGFjaXR5IixDYSkucmVtb3ZlKCksbT1Cby50cmFuc2l0aW9uKHAub3JkZXIoKSkuc3R5bGUoIm9wYWNpdHkiLDEpLHk9UGkoZikseD1zLnNlbGVjdEFsbCgiLmRvbWFpbiIpLmRhdGEoWzBdKSxNPSh4LmVudGVyKCkuYXBwZW5kKCJwYXRoIikuYXR0cigiY2xhc3MiLCJkb21haW4iKSxCby50cmFuc2l0aW9uKHgpKTt2LmFwcGVuZCgibGluZSIpLHYuYXBwZW5kKCJ0ZXh0Iik7dmFyIF89di5zZWxlY3QoImxpbmUiKSxiPW0uc2VsZWN0KCJsaW5lIiksdz1wLnNlbGVjdCgidGV4dCIpLnRleHQoZyksUz12LnNlbGVjdCgidGV4dCIpLGs9bS5zZWxlY3QoInRleHQiKTtzd2l0Y2goZSl7Y2FzZSJib3R0b20iOm49T28sXy5hdHRyKCJ5MiIsdSksUy5hdHRyKCJ5IixNYXRoLm1heCh1LDApK28pLGIuYXR0cigieDIiLDApLmF0dHIoInkyIix1KSxrLmF0dHIoIngiLDApLmF0dHIoInkiLE1hdGgubWF4KHUsMCkrbyksdy5hdHRyKCJkeSIsIi43MWVtIikuc3R5bGUoInRleHQtYW5jaG9yIiwibWlkZGxlIiksTS5hdHRyKCJkIiwiTSIreVswXSsiLCIraSsiVjBIIit5WzFdKyJWIitpKTticmVhaztjYXNlInRvcCI6bj1PbyxfLmF0dHIoInkyIiwtdSksUy5hdHRyKCJ5IiwtKE1hdGgubWF4KHUsMCkrbykpLGIuYXR0cigieDIiLDApLmF0dHIoInkyIiwtdSksay5hdHRyKCJ4IiwwKS5hdHRyKCJ5IiwtKE1hdGgubWF4KHUsMCkrbykpLHcuYXR0cigiZHkiLCIwZW0iKS5zdHlsZSgidGV4dC1hbmNob3IiLCJtaWRkbGUiKSxNLmF0dHIoImQiLCJNIit5WzBdKyIsIistaSsiVjBIIit5WzFdKyJWIistaSk7YnJlYWs7Y2FzZSJsZWZ0IjpuPUlvLF8uYXR0cigieDIiLC11KSxTLmF0dHIoIngiLC0oTWF0aC5tYXgodSwwKStvKSksYi5hdHRyKCJ4MiIsLXUpLmF0dHIoInkyIiwwKSxrLmF0dHIoIngiLC0oTWF0aC5tYXgodSwwKStvKSkuYXR0cigieSIsMCksdy5hdHRyKCJkeSIsIi4zMmVtIikuc3R5bGUoInRleHQtYW5jaG9yIiwiZW5kIiksTS5hdHRyKCJkIiwiTSIrLWkrIiwiK3lbMF0rIkgwViIreVsxXSsiSCIrLWkpO2JyZWFrO2Nhc2UicmlnaHQiOm49SW8sXy5hdHRyKCJ4MiIsdSksUy5hdHRyKCJ4IixNYXRoLm1heCh1LDApK28pLGIuYXR0cigieDIiLHUpLmF0dHIoInkyIiwwKSxrLmF0dHIoIngiLE1hdGgubWF4KHUsMCkrbykuYXR0cigieSIsMCksdy5hdHRyKCJkeSIsIi4zMmVtIikuc3R5bGUoInRleHQtYW5jaG9yIiwic3RhcnQiKSxNLmF0dHIoImQiLCJNIitpKyIsIit5WzBdKyJIMFYiK3lbMV0rIkgiK2kpfWlmKGYucmFuZ2VCYW5kKXt2YXIgRT1mLEE9RS5yYW5nZUJhbmQoKS8yO2w9Zj1mdW5jdGlvbihuKXtyZXR1cm4gRShuKStBfX1lbHNlIGwucmFuZ2VCYW5kP2w9ZjpkLmNhbGwobixmKTt2LmNhbGwobixsKSxtLmNhbGwobixmKX0pfXZhciB0LHI9Qm8uc2NhbGUubGluZWFyKCksZT1xcyx1PTYsaT02LG89MyxhPVsxMF0sYz1udWxsO3JldHVybiBuLnNjYWxlPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhyPXQsbik6cn0sbi5vcmllbnQ9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGU9dCBpbiBScz90KyIiOnFzLG4pOmV9LG4udGlja3M9ZnVuY3Rpb24oKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oYT1hcmd1bWVudHMsbik6YX0sbi50aWNrVmFsdWVzPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhjPXQsbik6Y30sbi50aWNrRm9ybWF0PWZ1bmN0aW9uKHIpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh0PXIsbik6dH0sbi50aWNrU2l6ZT1mdW5jdGlvbih0KXt2YXIgcj1hcmd1bWVudHMubGVuZ3RoO3JldHVybiByPyh1PSt0LGk9K2FyZ3VtZW50c1tyLTFdLG4pOnV9LG4uaW5uZXJUaWNrU2l6ZT1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8odT0rdCxuKTp1fSxuLm91dGVyVGlja1NpemU9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGk9K3Qsbik6aX0sbi50aWNrUGFkZGluZz1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obz0rdCxuKTpvfSxuLnRpY2tTdWJkaXZpZGU9ZnVuY3Rpb24oKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aCYmbn0sbn07dmFyIHFzPSJib3R0b20iLFJzPXt0b3A6MSxyaWdodDoxLGJvdHRvbToxLGxlZnQ6MX07Qm8uc3ZnLmJydXNoPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbihpKXtpLmVhY2goZnVuY3Rpb24oKXt2YXIgaT1Cby5zZWxlY3QodGhpcykuc3R5bGUoInBvaW50ZXItZXZlbnRzIiwiYWxsIikuc3R5bGUoIi13ZWJraXQtdGFwLWhpZ2hsaWdodC1jb2xvciIsInJnYmEoMCwwLDAsMCkiKS5vbigibW91c2Vkb3duLmJydXNoIix1KS5vbigidG91Y2hzdGFydC5icnVzaCIsdSksbz1pLnNlbGVjdEFsbCgiLmJhY2tncm91bmQiKS5kYXRhKFswXSk7by5lbnRlcigpLmFwcGVuZCgicmVjdCIpLmF0dHIoImNsYXNzIiwiYmFja2dyb3VuZCIpLnN0eWxlKCJ2aXNpYmlsaXR5IiwiaGlkZGVuIikuc3R5bGUoImN1cnNvciIsImNyb3NzaGFpciIpLGkuc2VsZWN0QWxsKCIuZXh0ZW50IikuZGF0YShbMF0pLmVudGVyKCkuYXBwZW5kKCJyZWN0IikuYXR0cigiY2xhc3MiLCJleHRlbnQiKS5zdHlsZSgiY3Vyc29yIiwibW92ZSIpO3ZhciBhPWkuc2VsZWN0QWxsKCIucmVzaXplIikuZGF0YShwLEF0KTthLmV4aXQoKS5yZW1vdmUoKSxhLmVudGVyKCkuYXBwZW5kKCJnIikuYXR0cigiY2xhc3MiLGZ1bmN0aW9uKG4pe3JldHVybiJyZXNpemUgIitufSkuc3R5bGUoImN1cnNvciIsZnVuY3Rpb24obil7cmV0dXJuIERzW25dfSkuYXBwZW5kKCJyZWN0IikuYXR0cigieCIsZnVuY3Rpb24obil7cmV0dXJuL1tld10kLy50ZXN0KG4pPy0zOm51bGx9KS5hdHRyKCJ5IixmdW5jdGlvbihuKXtyZXR1cm4vXltuc10vLnRlc3Qobik/LTM6bnVsbH0pLmF0dHIoIndpZHRoIiw2KS5hdHRyKCJoZWlnaHQiLDYpLnN0eWxlKCJ2aXNpYmlsaXR5IiwiaGlkZGVuIiksYS5zdHlsZSgiZGlzcGxheSIsbi5lbXB0eSgpPyJub25lIjpudWxsKTt2YXIgbCxmPUJvLnRyYW5zaXRpb24oaSksaD1Cby50cmFuc2l0aW9uKG8pO2MmJihsPVBpKGMpLGguYXR0cigieCIsbFswXSkuYXR0cigid2lkdGgiLGxbMV0tbFswXSkscihmKSkscyYmKGw9UGkocyksaC5hdHRyKCJ5IixsWzBdKS5hdHRyKCJoZWlnaHQiLGxbMV0tbFswXSksZShmKSksdChmKX0pfWZ1bmN0aW9uIHQobil7bi5zZWxlY3RBbGwoIi5yZXNpemUiKS5hdHRyKCJ0cmFuc2Zvcm0iLGZ1bmN0aW9uKG4pe3JldHVybiJ0cmFuc2xhdGUoIitsWysvZSQvLnRlc3QobildKyIsIitmWysvXnMvLnRlc3QobildKyIpIn0pfWZ1bmN0aW9uIHIobil7bi5zZWxlY3QoIi5leHRlbnQiKS5hdHRyKCJ4IixsWzBdKSxuLnNlbGVjdEFsbCgiLmV4dGVudCwubj5yZWN0LC5zPnJlY3QiKS5hdHRyKCJ3aWR0aCIsbFsxXS1sWzBdKX1mdW5jdGlvbiBlKG4pe24uc2VsZWN0KCIuZXh0ZW50IikuYXR0cigieSIsZlswXSksbi5zZWxlY3RBbGwoIi5leHRlbnQsLmU+cmVjdCwudz5yZWN0IikuYXR0cigiaGVpZ2h0IixmWzFdLWZbMF0pfWZ1bmN0aW9uIHUoKXtmdW5jdGlvbiB1KCl7MzI9PUJvLmV2ZW50LmtleUNvZGUmJihDfHwoeD1udWxsLHpbMF0tPWxbMV0selsxXS09ZlsxXSxDPTIpLHkoKSl9ZnVuY3Rpb24gcCgpezMyPT1Cby5ldmVudC5rZXlDb2RlJiYyPT1DJiYoelswXSs9bFsxXSx6WzFdKz1mWzFdLEM9MCx5KCkpfWZ1bmN0aW9uIHYoKXt2YXIgbj1Cby5tb3VzZShfKSx1PSExO00mJihuWzBdKz1NWzBdLG5bMV0rPU1bMV0pLEN8fChCby5ldmVudC5hbHRLZXk/KHh8fCh4PVsobFswXStsWzFdKS8yLChmWzBdK2ZbMV0pLzJdKSx6WzBdPWxbKyhuWzBdPHhbMF0pXSx6WzFdPWZbKyhuWzFdPHhbMV0pXSk6eD1udWxsKSxFJiZkKG4sYywwKSYmKHIoUyksdT0hMCksQSYmZChuLHMsMSkmJihlKFMpLHU9ITApLHUmJih0KFMpLHcoe3R5cGU6ImJydXNoIixtb2RlOkM/Im1vdmUiOiJyZXNpemUifSkpfWZ1bmN0aW9uIGQobix0LHIpe3ZhciBlLHUsYT1QaSh0KSxjPWFbMF0scz1hWzFdLHA9eltyXSx2PXI/ZjpsLGQ9dlsxXS12WzBdO3JldHVybiBDJiYoYy09cCxzLT1kK3ApLGU9KHI/ZzpoKT9NYXRoLm1heChjLE1hdGgubWluKHMsbltyXSkpOm5bcl0sQz91PShlKz1wKStkOih4JiYocD1NYXRoLm1heChjLE1hdGgubWluKHMsMip4W3JdLWUpKSksZT5wPyh1PWUsZT1wKTp1PXApLHZbMF0hPWV8fHZbMV0hPXU/KHI/bz1udWxsOmk9bnVsbCx2WzBdPWUsdlsxXT11LCEwKTp2b2lkIDB9ZnVuY3Rpb24gbSgpe3YoKSxTLnN0eWxlKCJwb2ludGVyLWV2ZW50cyIsImFsbCIpLnNlbGVjdEFsbCgiLnJlc2l6ZSIpLnN0eWxlKCJkaXNwbGF5IixuLmVtcHR5KCk/Im5vbmUiOm51bGwpLEJvLnNlbGVjdCgiYm9keSIpLnN0eWxlKCJjdXJzb3IiLG51bGwpLEwub24oIm1vdXNlbW92ZS5icnVzaCIsbnVsbCkub24oIm1vdXNldXAuYnJ1c2giLG51bGwpLm9uKCJ0b3VjaG1vdmUuYnJ1c2giLG51bGwpLm9uKCJ0b3VjaGVuZC5icnVzaCIsbnVsbCkub24oImtleWRvd24uYnJ1c2giLG51bGwpLm9uKCJrZXl1cC5icnVzaCIsbnVsbCksTigpLHcoe3R5cGU6ImJydXNoZW5kIn0pfXZhciB4LE0sXz10aGlzLGI9Qm8uc2VsZWN0KEJvLmV2ZW50LnRhcmdldCksdz1hLm9mKF8sYXJndW1lbnRzKSxTPUJvLnNlbGVjdChfKSxrPWIuZGF0dW0oKSxFPSEvXihufHMpJC8udGVzdChrKSYmYyxBPSEvXihlfHcpJC8udGVzdChrKSYmcyxDPWIuY2xhc3NlZCgiZXh0ZW50IiksTj1ZKCksej1Cby5tb3VzZShfKSxMPUJvLnNlbGVjdChRbykub24oImtleWRvd24uYnJ1c2giLHUpLm9uKCJrZXl1cC5icnVzaCIscCk7aWYoQm8uZXZlbnQuY2hhbmdlZFRvdWNoZXM/TC5vbigidG91Y2htb3ZlLmJydXNoIix2KS5vbigidG91Y2hlbmQuYnJ1c2giLG0pOkwub24oIm1vdXNlbW92ZS5icnVzaCIsdikub24oIm1vdXNldXAuYnJ1c2giLG0pLFMuaW50ZXJydXB0KCkuc2VsZWN0QWxsKCIqIikuaW50ZXJydXB0KCksQyl6WzBdPWxbMF0telswXSx6WzFdPWZbMF0telsxXTtlbHNlIGlmKGspe3ZhciBUPSsvdyQvLnRlc3QoaykscT0rL15uLy50ZXN0KGspO009W2xbMS1UXS16WzBdLGZbMS1xXS16WzFdXSx6WzBdPWxbVF0selsxXT1mW3FdfWVsc2UgQm8uZXZlbnQuYWx0S2V5JiYoeD16LnNsaWNlKCkpO1Muc3R5bGUoInBvaW50ZXItZXZlbnRzIiwibm9uZSIpLnNlbGVjdEFsbCgiLnJlc2l6ZSIpLnN0eWxlKCJkaXNwbGF5IixudWxsKSxCby5zZWxlY3QoImJvZHkiKS5zdHlsZSgiY3Vyc29yIixiLnN0eWxlKCJjdXJzb3IiKSksdyh7dHlwZToiYnJ1c2hzdGFydCJ9KSx2KCl9dmFyIGksbyxhPU0obiwiYnJ1c2hzdGFydCIsImJydXNoIiwiYnJ1c2hlbmQiKSxjPW51bGwscz1udWxsLGw9WzAsMF0sZj1bMCwwXSxoPSEwLGc9ITAscD1Qc1swXTtyZXR1cm4gbi5ldmVudD1mdW5jdGlvbihuKXtuLmVhY2goZnVuY3Rpb24oKXt2YXIgbj1hLm9mKHRoaXMsYXJndW1lbnRzKSx0PXt4OmwseTpmLGk6aSxqOm99LHI9dGhpcy5fX2NoYXJ0X198fHQ7dGhpcy5fX2NoYXJ0X189dCxBcz9Cby5zZWxlY3QodGhpcykudHJhbnNpdGlvbigpLmVhY2goInN0YXJ0LmJydXNoIixmdW5jdGlvbigpe2k9ci5pLG89ci5qLGw9ci54LGY9ci55LG4oe3R5cGU6ImJydXNoc3RhcnQifSl9KS50d2VlbigiYnJ1c2g6YnJ1c2giLGZ1bmN0aW9uKCl7dmFyIHI9bXUobCx0LngpLGU9bXUoZix0LnkpO3JldHVybiBpPW89bnVsbCxmdW5jdGlvbih1KXtsPXQueD1yKHUpLGY9dC55PWUodSksbih7dHlwZToiYnJ1c2giLG1vZGU6InJlc2l6ZSJ9KX19KS5lYWNoKCJlbmQuYnJ1c2giLGZ1bmN0aW9uKCl7aT10Lmksbz10Lmosbih7dHlwZToiYnJ1c2giLG1vZGU6InJlc2l6ZSJ9KSxuKHt0eXBlOiJicnVzaGVuZCJ9KX0pOihuKHt0eXBlOiJicnVzaHN0YXJ0In0pLG4oe3R5cGU6ImJydXNoIixtb2RlOiJyZXNpemUifSksbih7dHlwZToiYnJ1c2hlbmQifSkpfSl9LG4ueD1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oYz10LHA9UHNbIWM8PDF8IXNdLG4pOmN9LG4ueT1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8ocz10LHA9UHNbIWM8PDF8IXNdLG4pOnN9LG4uY2xhbXA9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGMmJnM/KGg9ISF0WzBdLGc9ISF0WzFdKTpjP2g9ISF0OnMmJihnPSEhdCksbik6YyYmcz9baCxnXTpjP2g6cz9nOm51bGx9LG4uZXh0ZW50PWZ1bmN0aW9uKHQpe3ZhciByLGUsdSxhLGg7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGMmJihyPXRbMF0sZT10WzFdLHMmJihyPXJbMF0sZT1lWzBdKSxpPVtyLGVdLGMuaW52ZXJ0JiYocj1jKHIpLGU9YyhlKSkscj5lJiYoaD1yLHI9ZSxlPWgpLChyIT1sWzBdfHxlIT1sWzFdKSYmKGw9W3IsZV0pKSxzJiYodT10WzBdLGE9dFsxXSxjJiYodT11WzFdLGE9YVsxXSksbz1bdSxhXSxzLmludmVydCYmKHU9cyh1KSxhPXMoYSkpLHU+YSYmKGg9dSx1PWEsYT1oKSwodSE9ZlswXXx8YSE9ZlsxXSkmJihmPVt1LGFdKSksbik6KGMmJihpPyhyPWlbMF0sZT1pWzFdKToocj1sWzBdLGU9bFsxXSxjLmludmVydCYmKHI9Yy5pbnZlcnQociksZT1jLmludmVydChlKSkscj5lJiYoaD1yLHI9ZSxlPWgpKSkscyYmKG8/KHU9b1swXSxhPW9bMV0pOih1PWZbMF0sYT1mWzFdLHMuaW52ZXJ0JiYodT1zLmludmVydCh1KSxhPXMuaW52ZXJ0KGEpKSx1PmEmJihoPXUsdT1hLGE9aCkpKSxjJiZzP1tbcix1XSxbZSxhXV06Yz9bcixlXTpzJiZbdSxhXSl9LG4uY2xlYXI9ZnVuY3Rpb24oKXtyZXR1cm4gbi5lbXB0eSgpfHwobD1bMCwwXSxmPVswLDBdLGk9bz1udWxsKSxufSxuLmVtcHR5PWZ1bmN0aW9uKCl7cmV0dXJuISFjJiZsWzBdPT1sWzFdfHwhIXMmJmZbMF09PWZbMV19LEJvLnJlYmluZChuLGEsIm9uIil9O3ZhciBEcz17bjoibnMtcmVzaXplIixlOiJldy1yZXNpemUiLHM6Im5zLXJlc2l6ZSIsdzoiZXctcmVzaXplIixudzoibndzZS1yZXNpemUiLG5lOiJuZXN3LXJlc2l6ZSIsc2U6Im53c2UtcmVzaXplIixzdzoibmVzdy1yZXNpemUifSxQcz1bWyJuIiwiZSIsInMiLCJ3IiwibnciLCJuZSIsInNlIiwic3ciXSxbImUiLCJ3Il0sWyJuIiwicyJdLFtdXSxVcz1yYy5mb3JtYXQ9Y2MudGltZUZvcm1hdCxqcz1Vcy51dGMsSHM9anMoIiVZLSVtLSVkVCVIOiVNOiVTLiVMWiIpO1VzLmlzbz1EYXRlLnByb3RvdHlwZS50b0lTT1N0cmluZyYmK25ldyBEYXRlKCIyMDAwLTAxLTAxVDAwOjAwOjAwLjAwMFoiKT9ZbzpIcyxZby5wYXJzZT1mdW5jdGlvbihuKXt2YXIgdD1uZXcgRGF0ZShuKTtyZXR1cm4gaXNOYU4odCk/bnVsbDp0fSxZby50b1N0cmluZz1Icy50b1N0cmluZyxyYy5zZWNvbmQ9SHQoZnVuY3Rpb24obil7cmV0dXJuIG5ldyBlYygxZTMqTWF0aC5mbG9vcihuLzFlMykpfSxmdW5jdGlvbihuLHQpe24uc2V0VGltZShuLmdldFRpbWUoKSsxZTMqTWF0aC5mbG9vcih0KSl9LGZ1bmN0aW9uKG4pe3JldHVybiBuLmdldFNlY29uZHMoKX0pLHJjLnNlY29uZHM9cmMuc2Vjb25kLnJhbmdlLHJjLnNlY29uZHMudXRjPXJjLnNlY29uZC51dGMucmFuZ2UscmMubWludXRlPUh0KGZ1bmN0aW9uKG4pe3JldHVybiBuZXcgZWMoNmU0Kk1hdGguZmxvb3Iobi82ZTQpKX0sZnVuY3Rpb24obix0KXtuLnNldFRpbWUobi5nZXRUaW1lKCkrNmU0Kk1hdGguZmxvb3IodCkpfSxmdW5jdGlvbihuKXtyZXR1cm4gbi5nZXRNaW51dGVzKCl9KSxyYy5taW51dGVzPXJjLm1pbnV0ZS5yYW5nZSxyYy5taW51dGVzLnV0Yz1yYy5taW51dGUudXRjLnJhbmdlLHJjLmhvdXI9SHQoZnVuY3Rpb24obil7dmFyIHQ9bi5nZXRUaW1lem9uZU9mZnNldCgpLzYwO3JldHVybiBuZXcgZWMoMzZlNSooTWF0aC5mbG9vcihuLzM2ZTUtdCkrdCkpfSxmdW5jdGlvbihuLHQpe24uc2V0VGltZShuLmdldFRpbWUoKSszNmU1Kk1hdGguZmxvb3IodCkpfSxmdW5jdGlvbihuKXtyZXR1cm4gbi5nZXRIb3VycygpfSkscmMuaG91cnM9cmMuaG91ci5yYW5nZSxyYy5ob3Vycy51dGM9cmMuaG91ci51dGMucmFuZ2UscmMubW9udGg9SHQoZnVuY3Rpb24obil7cmV0dXJuIG49cmMuZGF5KG4pLG4uc2V0RGF0ZSgxKSxufSxmdW5jdGlvbihuLHQpe24uc2V0TW9udGgobi5nZXRNb250aCgpK3QpfSxmdW5jdGlvbihuKXtyZXR1cm4gbi5nZXRNb250aCgpfSkscmMubW9udGhzPXJjLm1vbnRoLnJhbmdlLHJjLm1vbnRocy51dGM9cmMubW9udGgudXRjLnJhbmdlO3ZhciBGcz1bMWUzLDVlMywxNWUzLDNlNCw2ZTQsM2U1LDllNSwxOGU1LDM2ZTUsMTA4ZTUsMjE2ZTUsNDMyZTUsODY0ZTUsMTcyOGU1LDYwNDhlNSwyNTkyZTYsNzc3NmU2LDMxNTM2ZTZdLE9zPVtbcmMuc2Vjb25kLDFdLFtyYy5zZWNvbmQsNV0sW3JjLnNlY29uZCwxNV0sW3JjLnNlY29uZCwzMF0sW3JjLm1pbnV0ZSwxXSxbcmMubWludXRlLDVdLFtyYy5taW51dGUsMTVdLFtyYy5taW51dGUsMzBdLFtyYy5ob3VyLDFdLFtyYy5ob3VyLDNdLFtyYy5ob3VyLDZdLFtyYy5ob3VyLDEyXSxbcmMuZGF5LDFdLFtyYy5kYXksMl0sW3JjLndlZWssMV0sW3JjLm1vbnRoLDFdLFtyYy5tb250aCwzXSxbcmMueWVhciwxXV0sSXM9VXMubXVsdGkoW1siLiVMIixmdW5jdGlvbihuKXtyZXR1cm4gbi5nZXRNaWxsaXNlY29uZHMoKX1dLFsiOiVTIixmdW5jdGlvbihuKXtyZXR1cm4gbi5nZXRTZWNvbmRzKCl9XSxbIiVJOiVNIixmdW5jdGlvbihuKXtyZXR1cm4gbi5nZXRNaW51dGVzKCl9XSxbIiVJICVwIixmdW5jdGlvbihuKXtyZXR1cm4gbi5nZXRIb3VycygpfV0sWyIlYSAlZCIsZnVuY3Rpb24obil7cmV0dXJuIG4uZ2V0RGF5KCkmJjEhPW4uZ2V0RGF0ZSgpfV0sWyIlYiAlZCIsZnVuY3Rpb24obil7cmV0dXJuIDEhPW4uZ2V0RGF0ZSgpfV0sWyIlQiIsZnVuY3Rpb24obil7cmV0dXJuIG4uZ2V0TW9udGgoKX1dLFsiJVkiLEFyXV0pLFlzPXtyYW5nZTpmdW5jdGlvbihuLHQscil7cmV0dXJuIEJvLnJhbmdlKE1hdGguY2VpbChuL3IpKnIsK3QscikubWFwKFZvKX0sZmxvb3I6QXQsY2VpbDpBdH07T3MueWVhcj1yYy55ZWFyLHJjLnNjYWxlPWZ1bmN0aW9uKCl7cmV0dXJuIFpvKEJvLnNjYWxlLmxpbmVhcigpLE9zLElzKX07dmFyIFpzPU9zLm1hcChmdW5jdGlvbihuKXtyZXR1cm5bblswXS51dGMsblsxXV19KSxWcz1qcy5tdWx0aShbWyIuJUwiLGZ1bmN0aW9uKG4pe3JldHVybiBuLmdldFVUQ01pbGxpc2Vjb25kcygpfV0sWyI6JVMiLGZ1bmN0aW9uKG4pe3JldHVybiBuLmdldFVUQ1NlY29uZHMoKX1dLFsiJUk6JU0iLGZ1bmN0aW9uKG4pe3JldHVybiBuLmdldFVUQ01pbnV0ZXMoKX1dLFsiJUkgJXAiLGZ1bmN0aW9uKG4pe3JldHVybiBuLmdldFVUQ0hvdXJzKCl9XSxbIiVhICVkIixmdW5jdGlvbihuKXtyZXR1cm4gbi5nZXRVVENEYXkoKSYmMSE9bi5nZXRVVENEYXRlKCl9XSxbIiViICVkIixmdW5jdGlvbihuKXtyZXR1cm4gMSE9bi5nZXRVVENEYXRlKCl9XSxbIiVCIixmdW5jdGlvbihuKXtyZXR1cm4gbi5nZXRVVENNb250aCgpfV0sWyIlWSIsQXJdXSk7WnMueWVhcj1yYy55ZWFyLnV0YyxyYy5zY2FsZS51dGM9ZnVuY3Rpb24oKXtyZXR1cm4gWm8oQm8uc2NhbGUubGluZWFyKCksWnMsVnMpfSxCby50ZXh0PUN0KGZ1bmN0aW9uKG4pe3JldHVybiBuLnJlc3BvbnNlVGV4dH0pLEJvLmpzb249ZnVuY3Rpb24obix0KXtyZXR1cm4gTnQobiwiYXBwbGljYXRpb24vanNvbiIsJG8sdCl9LEJvLmh0bWw9ZnVuY3Rpb24obix0KXtyZXR1cm4gTnQobiwidGV4dC9odG1sIixYbyx0KX0sQm8ueG1sPUN0KGZ1bmN0aW9uKG4pe3JldHVybiBuLnJlc3BvbnNlWE1MfSksImZ1bmN0aW9uIj09dHlwZW9mIGRlZmluZSYmZGVmaW5lLmFtZD9kZWZpbmUoJ2QzJyxbXSxCbyk6Im9iamVjdCI9PXR5cGVvZiBtb2R1bGUmJm1vZHVsZS5leHBvcnRzP21vZHVsZS5leHBvcnRzPUJvOnRoaXMuZDM9Qm99KCk7Ci8qKgogKiB0aGUgd2lkdGggaGVpZ2h0ICYgeC9yIHJhbmdlIGFsbCB0aGUgY2hyb21hdG8gJiBzcGVjdHJhIHdpbGwgc2hhcmUKICoKICogZm9sbG93aW5nIGQzLCB0aGVyZSBpcwogKiAqIGEgZG9tYWluOiByYW5nZSBvZiAicmVhbCAiIHZhbHVlcwogKiAqIGEgcmFuZ2U6IHZpZXdwb3J0IGNvb3JlZGluYXRlcwogKiAqIG9yaWdEb21haW4gKGRvbWFpbiBhdCBsYXJnZSwgYmVmb3JlIHpvb20pCiAqCiAqICdzY2FsZWNoYW5nZScgZXZudCBpcyB0cmlnZ2VyZWQgd2hlbiBib3VuZGFyaWVzIGFyZSBjaGFuZ2VkCiAqCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwoKZGVmaW5lKCdmaXNodG9uZXMvdmlld3MvdXRpbHMvRDNTY2FsaW5nQ29udGV4dCcsWydkMycsICd1bmRlcnNjb3JlJywgJ0JhY2tib25lJ10sIGZ1bmN0aW9uKGQzLCBfLCBCYWNrYm9uZSkgewogIHZhciBEM1NjYWxpbmdDb250ZXh0ID0gQmFja2JvbmUuTW9kZWwuZXh0ZW5kKHsKICAgIGluaXRpYWxpemUgOiBmdW5jdGlvbihvcHRpb25zKSB7CgogICAgICB0aGlzLl94T3JpZ0RvbWFpbiA9IChvcHRpb25zICYmIG9wdGlvbnMueERvbWFpbiAmJiBvcHRpb25zLnhEb21haW4uc2xpY2UoKSkgfHwgWzAsIDFdOwogICAgICB0aGlzLl95T3JpZ0RvbWFpbiA9IChvcHRpb25zICYmIG9wdGlvbnMueURvbWFpbiAmJiBvcHRpb25zLnlEb21haW4uc2xpY2UoKSkgfHwgWzAsIDFdOwogICAgICB0aGlzLl94RG9tYWluID0gdGhpcy5feE9yaWdEb21haW4uc2xpY2UoKTsKICAgICAgdGhpcy5feURvbWFpbiA9IHRoaXMuX3lPcmlnRG9tYWluLnNsaWNlKCk7CgogICAgICB0aGlzLl94UmFuZ2UgPSBbMCwgKG9wdGlvbnMgJiYgb3B0aW9ucy53aWR0aCkgfHwgMzMyXTsKICAgICAgdGhpcy5feVJhbmdlID0gWyhvcHRpb25zICYmIG9wdGlvbnMuaGVpZ2h0KSB8fCA2NjQsIDBdOwoKICAgICAgdGhpcy5jaGFuZ2VYRG9tYWluQ2FsbEJhY2tzID0ge307CiAgICAgIHJldHVybiB0aGlzCiAgICB9LAogICAgd2lkdGggOiBmdW5jdGlvbih2KSB7CiAgICAgIGlmICh2ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICB2YXIgY2hhbmdlZCA9IHRoaXMuX3hSYW5nZVsxXSAhPSB2OwogICAgICAgIHRoaXMuX3hSYW5nZVsxXSA9IHY7CiAgICAgICAgaWYgKGNoYW5nZWQpIHsKICAgICAgICAgIHRoaXMudHJpZ2dlcignc2NhbGVjaGFuZ2UnLCAncmVzZXQnKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMuX3hSYW5nZVsxXTsKICAgIH0sCiAgICBoZWlnaHQgOiBmdW5jdGlvbih2KSB7CiAgICAgIGlmICh2ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICB2YXIgY2hhbmdlZCA9IHRoaXMuX3lSYW5nZVswXSAhPSB2OwogICAgICAgIHRoaXMuX3lSYW5nZVswXSA9IHY7CiAgICAgICAgaWYgKGNoYW5nZWQpIHsKICAgICAgICAgIHRoaXMudHJpZ2dlcignc2NhbGVjaGFuZ2UnLCAncmVzZXQnKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMuX3lSYW5nZVswXTsKICAgIH0sCiAgICB4IDogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBkMy5zY2FsZS5saW5lYXIoKS5kb21haW4odGhpcy5feERvbWFpbikucmFuZ2UodGhpcy5feFJhbmdlKTsKICAgIH0sCiAgICB5IDogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBkMy5zY2FsZS5saW5lYXIoKS5kb21haW4odGhpcy5feURvbWFpbikucmFuZ2UodGhpcy5feVJhbmdlKQogICAgfSwKICAgIHJlc2V0IDogZnVuY3Rpb24oKSB7CiAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgdmFyIGNoYW5nZWQgPSBzZWxmLl94RG9tYWluWzBdICE9IHNlbGYuX3hPcmlnRG9tYWluWzBdIHx8IHNlbGYuX3hEb21haW5bMV0gIT0gc2VsZi5feE9yaWdEb21haW5bMV0gfHwgc2VsZi5feURvbWFpblswXSAhPSBzZWxmLl95T3JpZ0RvbWFpblswXSB8fCBzZWxmLl95RG9tYWluWzFdICE9IHNlbGYuX3lPcmlnRG9tYWluWzFdOwoKICAgICAgc2VsZi5feERvbWFpblswXSA9IHNlbGYuX3hPcmlnRG9tYWluWzBdOwogICAgICBzZWxmLl94RG9tYWluWzFdID0gc2VsZi5feE9yaWdEb21haW5bMV07CiAgICAgIHNlbGYuX3lEb21haW5bMF0gPSBzZWxmLl95T3JpZ0RvbWFpblswXTsKICAgICAgc2VsZi5feURvbWFpblsxXSA9IHNlbGYuX3lPcmlnRG9tYWluWzFdOwogICAgICBpZiAoY2hhbmdlZCkgewogICAgICAgIHNlbGYudHJpZ2dlcignc2NhbGVjaGFuZ2UnLCAncmVzZXQnKTsKICAgICAgfQogICAgICAvL3NlbGYuZmlyZUNoYW5nZVhSYW5nZSgpOwogICAgfSwKICAgIHJlc2V0WCA6IGZ1bmN0aW9uKCkgewogICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgIHZhciBjaGFuZ2VkID0gc2VsZi5feERvbWFpblswXSAhPSBzZWxmLl94T3JpZ0RvbWFpblswXSB8fCBzZWxmLl94RG9tYWluWzFdICE9IHNlbGYuX3hPcmlnRG9tYWluWzFdOwoKICAgICAgc2VsZi5feERvbWFpblswXSA9IHNlbGYuX3hPcmlnRG9tYWluWzBdOwogICAgICBzZWxmLl94RG9tYWluWzFdID0gc2VsZi5feE9yaWdEb21haW5bMV07CiAgICAgIGlmIChjaGFuZ2VkKSB7CiAgICAgICAgc2VsZi50cmlnZ2VyKCdzY2FsZWNoYW5nZScsICdyZXNldFgnKTsKICAgICAgfQogICAgICByZXR1cm4gc2VsZjsKCiAgICAgIC8vc2VsZi5maXJlQ2hhbmdlWFJhbmdlKCk7CiAgICB9LAogICAgcmVzZXRZIDogZnVuY3Rpb24oKSB7CiAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgIHNlbGYuX3lEb21haW5bMF0gPSBzZWxmLl95T3JpZ0RvbWFpblswXTsKICAgICAgc2VsZi5feURvbWFpblsxXSA9IHNlbGYuX3lPcmlnRG9tYWluWzFdOwogICAgICAvL3NlbGYuZmlyZUNoYW5nZVhSYW5nZSgpOwogICAgICByZXR1cm4gc2VsZjsKICAgIH0sCiAgICB4TWluIDogZnVuY3Rpb24odikgewogICAgICBpZiAodiAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgdGhpcy5feE9yaWdEb21haW5bMF0gPSB2OwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLl94T3JpZ0RvbWFpblswXQogICAgfSwKICAgIHhNYXggOiBmdW5jdGlvbih2KSB7CiAgICAgIGlmICh2ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICB0aGlzLl94T3JpZ0RvbWFpblsxXSA9IHY7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMuX3hPcmlnRG9tYWluWzFdCiAgICB9LAogICAgeU1pbiA6IGZ1bmN0aW9uKHYpIHsKICAgICAgaWYgKHYgIT09IHVuZGVmaW5lZCkgewogICAgICAgIHRoaXMuX3lPcmlnRG9tYWluWzBdID0gdjsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy5feU9yaWdEb21haW5bMF0KICAgIH0sCiAgICB5TWF4IDogZnVuY3Rpb24odikgewogICAgICBpZiAodiAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgdGhpcy5feU9yaWdEb21haW5bMV0gPSB2OwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLl95T3JpZ0RvbWFpblsxXQogICAgfSwKCiAgICB4T3JpZ0RvbWFpbiA6IGZ1bmN0aW9uKHZzKSB7CiAgICAgIGlmICh2cyAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgdGhpcy5feE9yaWdEb21haW4gPSB2cy5zbGljZSgpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLl94T3JpZ0RvbWFpbi5zbGljZSgpCiAgICB9LAogICAgeU9yaWdEb21haW4gOiBmdW5jdGlvbih2cykgewogICAgICBpZiAodnMgIT09IHVuZGVmaW5lZCkgewogICAgICAgIHRoaXMuX3lPcmlnRG9tYWluID0gdnMuc2xpY2UoKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy5feU9yaWdEb21haW4uc2xpY2UoKQogICAgfSwKICAgIHhEb21haW4gOiBmdW5jdGlvbih4MCwgeDEsIG9wdHMpIHsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgdmFyIG9wdGlvbnMgPSBfLmV4dGVuZCh7CiAgICAgICAgc2lsZW50IDogZmFsc2UKICAgICAgfSwgb3B0cykKCiAgICAgIGlmICh4MCA9PT0gdW5kZWZpbmVkKQogICAgICAgIHJldHVybiBzZWxmLl94RG9tYWluLnNsaWNlKCk7CgogICAgICBpZiAoXy5pc0FycmF5KHgwKSkgewogICAgICAgIHgxID0geDBbMV07CiAgICAgICAgeDAgPSB4MFswXTsKICAgICAgfQogICAgICB2YXIgY2hhbmdlZCA9IHgwICE9IHNlbGYuX3hEb21haW5bMF0gfHwgeDEgIT0gc2VsZi5feERvbWFpblsxXTsKICAgICAgc2VsZi5feERvbWFpblswXSA9IHgwOwogICAgICBzZWxmLl94RG9tYWluWzFdID0geDE7CgogICAgICBpZiAoY2hhbmdlZCAmJiAhb3B0aW9ucy5zaWxlbnQpIHsKICAgICAgICBzZWxmLnRyaWdnZXIoJ3NjYWxlY2hhbmdlJywgJ3hEb21haW4nKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHNlbGYKICAgICAgLy90aGlzLmZpcmVDaGFuZ2VYUmFuZ2UoKTsKICAgIH0sCiAgICB5RG9tYWluIDogZnVuY3Rpb24oeTAsIHkxLCBvcHRzKSB7CiAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgdmFyIG9wdGlvbnMgPSBfLmV4dGVuZCh7CiAgICAgICAgc2lsZW50IDogZmFsc2UKICAgICAgfSwgb3B0cykKCiAgICAgIGlmICh5MCA9PT0gdW5kZWZpbmVkKQogICAgICAgIHJldHVybiB0aGlzLl95RG9tYWluLnNsaWNlKCk7CgogICAgICBpZiAoXy5pc0FycmF5KHkwKSkgewogICAgICAgIHkxID0geTBbMV07CiAgICAgICAgeTAgPSB5MFswXTsKICAgICAgfQogICAgICB2YXIgY2hhbmdlZCA9IHkwICE9IHNlbGYuX3lEb21haW5bMF0gfHwgeTEgIT0gc2VsZi5feURvbWFpblsxXTsKCiAgICAgIHNlbGYuX3lEb21haW5bMF0gPSB5MDsKICAgICAgc2VsZi5feURvbWFpblsxXSA9IHkxOwogICAgICBpZiAoY2hhbmdlZCAmJiAhb3B0aW9ucy5zaWxlbnQpIHsKICAgICAgICBzZWxmLnRyaWdnZXIoJ3NjYWxlY2hhbmdlJywgJ3lEb21haW4nKTsKICAgICAgfQogICAgICBzZWxmLmZpcmVDaGFuZ2VYRG9tYWluKCk7CiAgICAgIHJldHVybiBzZWxmOwogICAgfSwKICAgIGlzWFpvb21lZCA6IGZ1bmN0aW9uKCkgewogICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgIHJldHVybiBzZWxmLl94RG9tYWluWzBdID4gc2VsZi5feE9yaWdEb21haW5bMF0gfHwgc2VsZi5feERvbWFpblsxXSA8IHNlbGYuX3hPcmlnRG9tYWluWzFdOwogICAgfSwKICAgIC8qCiAgICAgKiBzZXQgdGhlIG14aW11bSB4IHZhbHVlLCB0aGUgb3ZlcmFsbCBtYXggYW5kIHRoZSBjdXJyZW50IG9uZS4KICAgICAqIGlmIGxpbWl0T25seSwgdGhlbiB3ZSBqdXN0IG1vZGlmeSB0aGUgb3ZlcmFsbCBsaW1pdAogICAgICovCiAgICBzZXRYTWF4IDogZnVuY3Rpb24obSwgbGltaXRPbmx5KSB7CiAgICAgIHRoaXMuX3hPcmlnRG9tYWluWzFdID0gbQogICAgICBpZiAobGltaXRPbmx5KSB7CiAgICAgICAgdGhpcy5feERvbWFpblsxXSA9IG0KICAgICAgfQogICAgICByZXR1cm4gdGhpczsKICAgIH0sCiAgICBzZXRZTWF4IDogZnVuY3Rpb24obSkgewogICAgICB0aGlzLl95RG9tYWluWzFdID0gdGhpcy5feU9yaWdEb21haW5bMV0gPSBtCgogICAgfSwKICAgIGFkZENoYW5nZVhEb21haW5DYWxsQmFjayA6IGZ1bmN0aW9uKG5hbWUsIGZjdCkgewogICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgIHNlbGYuY2hhbmdlWERvbWFpbkNhbGxCYWNrc1tuYW1lXSA9IGZjdDsKICAgIH0sCiAgICByZW1vdmVDaGFuZ2VYRG9tYWluQ2FsbEJhY2sgOiBmdW5jdGlvbihuYW1lKSB7CiAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgZGVsZXRlIHNlbGYuY2hhbmdlWERvbWFpbkNhbGxCYWNrc1tuYW1lXTsKICAgIH0sCiAgICBmaXJlQ2hhbmdlWERvbWFpbiA6IGZ1bmN0aW9uKCkgewogICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgIF8uZWFjaChzZWxmLmNoYW5nZVhEb21haW5DYWxsQmFja3MsIGZ1bmN0aW9uKGZjdCwgbmFtZSkgewogICAgICAgIGZjdChzZWxmKTsKICAgICAgfSk7CiAgICB9CiAgfSk7CgogIHJldHVybiBEM1NjYWxpbmdDb250ZXh0OwoKfSk7CgovKgogKiBhcmVhIHRvIGhhbmRsZSBtb3ZlL3pvb20gZXRjLiBidXR0b25zCiAqCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwoKZGVmaW5lKCdmaXNodG9uZXMvdmlld3MvdXRpbHMvRDNTY2FsaW5nQXJlYUJ1dHRvbnMnLFsndW5kZXJzY29yZScsICdkMyddLCBmdW5jdGlvbihfLCBkMyl7CiAgICAvKioKICAgICAqIHN2ZyBjb250YWluZXIKICAgICAqIGQzLVNjYWxpbmctY29udGV4dCAoY29udGFpbnMgdGhlIHZpZXdwb3J0IGFuZCBkb21haW5zIGJvdW5kYXJpZXMKICAgICAqIGEgY2FsbCBiYWNrIHRvIGJlIGNhbGxlZCB3aGVuIHpvb21lZAogICAgICovCiAgICBEM1NjYWxpbmdBcmVhQnV0dG9ucyA9IGZ1bmN0aW9uKGNvbnRhaW5lciwgY29udGV4dCwgY2FsbGJhY2ssIG9wdGlvbnMpIHsKICAgICAgICBvcHRpb25zID0gJC5leHRlbmQoe30sIG9wdGlvbnMpOwogICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICBzZWxmLmNvbnRleHQgPSBjb250ZXh0OwogICAgICAgIHNlbGYuY29udGFpbmVyID0gY29udGFpbmVyOwogICAgICAgIHNlbGYuY2FsbGJhY2sgPSBjYWxsYmFjawogICAgICAgIHNlbGYuaGVpZ2h0ID0gb3B0aW9ucy5oZWlnaHQgfHwgMzA7CgogICAgICAgIHNlbGYuY29udGFpbmVyLmF0dHIoJ3dpZHRoJywgY29udGV4dC53aWR0aCk7CiAgICAgICAgc2VsZi5jb250YWluZXIuYXR0cignaGVpZ2h0Jywgc2VsZi5oZWlnaHQpOwoKICAgICAgICBzZWxmLnBfc2V0dXAgPSBwX3NldHVwOwoKICAgICAgICBzZWxmLnBfc2V0dXAoKQoKICAgIH0KICAgICAgcmV0dXJuIEQzU2NhbGluZ0FyZWFCdXR0b25zOwoKfSk7Ci8qCiAqIHN2ZyBjb250YWluZXIgZm9yIHRoZSBjb21tb24gc2NhbGluZ2YgYXJlYS4KICoKICogZDMtU2NhbGluZy1jb250ZXh0IChjb250YWlucyB0aGUgdmlld3BvcnQgYW5kIGRvbWFpbnMgYm91bmRhcmllcwogKiBhIGNhbGwgYmFjayB0byBiZSBjYWxsZWQgd2hlbiB6b29tZWQKICogKiBtb2RlbDogc2NhbGluZ0NvbnRleHQsCiAqICogZWw6IGNvbnRhaW5lciwKICogKiBjYWxsYmFjazogY2FsbCBiYWNrIHdoZW4gem9vbWVkIGhhcyBiZWVuIGNhbGxlZCAoZm9yICBzdHR1ZGZmIG5vdCB0cmlnZ2VyZSBieSBzY2FsZWNoYW5nZSBldmVudHMpCiAqCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwpkZWZpbmUoJ2Zpc2h0b25lcy92aWV3cy91dGlscy9EM1NjYWxpbmdBcmVhJyxbJ3VuZGVyc2NvcmUnLCAnZDMnLCAnQmFja2JvbmUnLCAnLi9EM1NjYWxpbmdBcmVhQnV0dG9ucyddLCBmdW5jdGlvbiAoXywgZDMsIEJhY2tib25lLCBEM1NjYWxpbmdBcmVhQnV0dG9ucykgewogICAgdmFyIEQzU2NhbGluZ0FyZWEgPSBCYWNrYm9uZS5WaWV3LmV4dGVuZCh7CiAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKG9wdGlvbnMpIHsvL2NvbnRhaW5lciwgY29udGV4dCwgY2FsbGJhY2ssIG9wdGlvbnMpIHsKCiAgICAgICAgICAgIG9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgb3B0aW9ucyk7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgc2VsZi5jYWxsYmFjayA9IG9wdGlvbnMuY2FsbGJhY2s7CgogICAgICAgICAgICBzZWxmLmhlaWdodCA9IG9wdGlvbnMuaGVpZ2h0IHx8IHNlbGYubW9kZWwuaGVpZ2h0KCkgfHwgMzA7CgogICAgICAgICAgICB2YXIgZWwgPSBfLmlzQXJyYXkoc2VsZi5lbCkgPyBzZWxmLmVsWzBdIDogc2VsZi5lbDsKICAgICAgICAgICAgc2VsZi5jb250YWluZXIgPSBkMy5zZWxlY3QoZWwpLmFwcGVuZCgnZycpOwogICAgICAgICAgICBzZWxmLmNvbnRhaW5lci5hdHRyKCd3aWR0aCcsIG9wdGlvbnMud2lkdGggfHwgc2VsZi5tb2RlbC53aWR0aCgpKTsKICAgICAgICAgICAgc2VsZi5jb250YWluZXIuYXR0cignaGVpZ2h0Jywgc2VsZi5oZWlnaHQpOwoKICAgICAgICAgICAgc2VsZi5wX3NldHVwKCkKCiAgICAgICAgfSwKICAgICAgICB1cGRhdGVTY2FsaW5nQ29udGV4dDogZnVuY3Rpb24gKGN0eCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHNlbGYubW9kZWwgPSBjdHg7CgogICAgICAgIH0sCiAgICAgICAgcF9zZXR1cDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICAgICAgICB2YXIgZyA9IHNlbGYuY29udGFpbmVyLmluc2VydCgiZyIsICI6Zmlyc3QtY2hpbGQiKQogICAgICAgICAgICAvL3ZhciByZWN0ID0gZy5pbnNlcnQoInJlY3QiLCAiOmZpcnN0LWNoaWxkIikuYXR0cigneCcsIDApLmF0dHIoJ3knLCAwKS5hdHRyKCd3aWR0aCcsICcxMDAlJykuYXR0cignaGVpZ2h0JywgJzEwMCUnKS5hdHRyKCdmaWxsLW9wYWNpdHknLCAnMCUnKS5hdHRyKCdjbGFzcycsICd6b29tLWFyZWEnKTsKCiAgICAgICAgICAgIHNlbGYucF9zZXR1cF9idXR0b25zKCk7CgogICAgICAgICAgICAvLyBzZWxmLnpvb20gPSBkMy5iZWhhdmlvci56b29tKCkueChzZWxmLmNvbnRleHQueFNjYWxlKS5zY2FsZUV4dGVudChbMSwgMTgwXSkub24oInpvb20iLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgLy8gc2VsZi5jYWxsYmFjaygpOwogICAgICAgICAgICAvLyBzZWxmLmNvbnRleHQuZmlyZUNoYW5nZVhSYW5nZSgpOwogICAgICAgICAgICAvLyB9KTsKICAgICAgICAgICAgLy8gICBzZWxmLmNvbnRhaW5lci5jYWxsKHNlbGYuem9vbSk7CiAgICAgICAgfSwKICAgICAgICBwX3NldHVwX2J1dHRvbnM6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICAgICAgdmFyIHNjYWxpbmdDb250ZXh0ID0gc2VsZi5tb2RlbDsKICAgICAgICAgICAgc2VsZi5idXR0b25zID0ge307CiAgICAgICAgICAgIHZhciBnID0gc2VsZi5jb250YWluZXIuaW5zZXJ0KCJnIikuYXR0cignY2xhc3MnLCAnc2NhbGluZy1hcmVhLW1lbnUnKTsKCiAgICAgICAgICAgIHZhciBpQnV0dG9uID0gMDsKICAgICAgICAgICAgdmFyIGZjdEFkZEJ1dHRvbiA9IGZ1bmN0aW9uIChuYW1lLCB0ZXh0LCBmSXNTaG93aW5nLCBmQWN0aW9uKSB7CiAgICAgICAgICAgICAgICB2YXIgZ2J1dCA9IGcuaW5zZXJ0KCJnIikuYXR0cignY2xhc3MnLCAnc2NhbGluZy1hcmVhLW1lbnUtb25lLWJ1dHRvbicpLmF0dHIoJ3RyYW5zZm9ybScsICd0cmFuc2xhdGUoMjAsJyArICgxMCArIGlCdXR0b24gKiAyNykgKyAnKScpOwogICAgICAgICAgICAgICAgdmFyIHJlY3QgPSBnYnV0Lmluc2VydCgicmVjdCIpLmF0dHIoJ2NsYXNzJywgJ2J1dHRvbicpLmF0dHIoJ3gnLCAwKS5hdHRyKCd5JywgMCkuYXR0cignd2lkdGgnLCA4MCkuYXR0cigncngnLCA1KS5hdHRyKCdyeScsIDUpLmF0dHIoJ2hlaWdodCcsIDIyKTsKICAgICAgICAgICAgICAgIGdidXQuYXBwZW5kKCd0ZXh0JykuYXR0cigieCIsIDQwKS5hdHRyKCJ5IiwgMTEpLnRleHQodGV4dCk7CiAgICAgICAgICAgICAgICBzZWxmLmJ1dHRvbnNbbmFtZV0gPSB7CiAgICAgICAgICAgICAgICAgICAgZWw6IGdidXQsCiAgICAgICAgICAgICAgICAgICAgaXNTaG93aW5nOiBmSXNTaG93aW5nLAogICAgICAgICAgICAgICAgICAgIGFjdGlvbjogZkFjdGlvbgogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIHZhciBnT3ZlciA9IGdidXQuaW5zZXJ0KCJyZWN0IikuYXR0cignY2xhc3MnLCAnb3Zlci1idXR0b24nKS5hdHRyKCd4JywgMCkuYXR0cigneScsIDApLmF0dHIoJ3dpZHRoJywgODApLmF0dHIoJ3J4JywgNSkuYXR0cigncnknLCA1KS5hdHRyKCdoZWlnaHQnLCAyMik7CiAgICAgICAgICAgICAgICBnYnV0Lm9uKCdjbGljaycsIGZBY3Rpb24pOwoKICAgICAgICAgICAgICAgIGdidXQuc3R5bGUoJ2Rpc3BsYXknLCBmSXNTaG93aW5nKCkgPyBudWxsIDogJ25vbmUnKTsKICAgICAgICAgICAgICAgIGlCdXR0b24rKzsKICAgICAgICAgICAgfQogICAgICAgICAgICBmY3RBZGRCdXR0b24oJ3pvb21PdXQnLCAnem9vbSBvdXQnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5tb2RlbC5pc1hab29tZWQoKTsKICAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgc2VsZi5tb2RlbC5yZXNldCgpOwogICAgICAgICAgICB9KQoKICAgICAgICAgICAgc2VsZi5saXN0ZW5UbyhzY2FsaW5nQ29udGV4dCwgJ3NjYWxlY2hhbmdlJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgXy5lYWNoKHNlbGYuYnV0dG9ucywgZnVuY3Rpb24gKGJ1dENvbmYsIG5hbWUpIHsKICAgICAgICAgICAgICAgICAgICBidXRDb25mLmVsLnN0eWxlKCdkaXNwbGF5JywgYnV0Q29uZi5pc1Nob3dpbmcoKSA/IG51bGwgOiAnbm9uZScpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSk7CgogICAgICAgIH0sCiAgICAgICAgaGlkZUFsbEJ1dHRvbnM6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICBfLmVhY2goc2VsZi5idXR0b25zLCBmdW5jdGlvbiAoYnV0Q29uZiwgbmFtZSkgewogICAgICAgICAgICAgICAgYnV0Q29uZi5lbC5zdHlsZSgnZGlzcGxheScsICdub25lJyk7CiAgICAgICAgICAgIH0pCiAgICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gRDNTY2FsaW5nQXJlYTsKCn0pOwoKLyoqCiAqIEFuIGFic3RyYWN0IGNsYXNzIGZvciBEM1dpZGdldCBvcmllbnRlZCB2aWV3cwogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KCmRlZmluZSgnZmlzaHRvbmVzL3ZpZXdzL2NvbW1vbnMvQ29tbW9uV2lkZ2V0VmlldycsWyd1bmRlcnNjb3JlJywgJ0JhY2tib25lJywgJ2QzJywgJy4uL3V0aWxzL0QzU2NhbGluZ0NvbnRleHQnLCAnLi4vdXRpbHMvRDNTY2FsaW5nQXJlYSddLCBmdW5jdGlvbihfLCBCYWNrYm9uZSwgZDMsIEQzU2NhbGluZ0NvbnRleHQsIEQzU2NhbGluZ0FyZWEpIHsKICB2YXIgS0VZUFJFU1NFRF9OT05FID0gMDsKICB2YXIgS0VZUFJFU1NFRF9TSElGVCA9IDE7CiAgdmFyIEtFWVBSRVNTRURfQUxUID0gMjsKICB2YXIgRE9VQkxFX0NMSUNLID0gNDsKCiAgQ29tbW9uV2lkZ2V0VmlldyA9IEJhY2tib25lLlZpZXcuZXh0ZW5kKHsKICAgIGluaXRpYWxpemUgOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgIHZhciBlbFRtcCA9IF8uaXNBcnJheShzZWxmLmVsKSA/IHNlbGYuZWxbMF0gOiBzZWxmLmVsCiAgICAgIGlmICgkKGVsVG1wKS5wcm9wKCJ0YWdOYW1lIikudG9Mb3dlckNhc2UoKSA9PT0gJ2RpdicpIHsKICAgICAgICBzZWxmLmVsID0gZDMuc2VsZWN0KGVsVG1wKS5hcHBlbmQoJ3N2ZycpLmF0dHIoJ2hlaWdodCcsICcxMDAlJykuYXR0cignd2lkdGgnLCAnMTAwJScpOwogICAgICB9IGVsc2UgewogICAgICAgIHNlbGYuZWwgPSBkMy5zZWxlY3QoZWxUbXApOwogICAgICB9CgogICAgICBpZiAoc2VsZi5zY2FsaW5nQ29udGV4dCkgewogICAgICAgIHNlbGYueFpvb21hYmxlKCkKICAgICAgfQogICAgICBzZWxmLmJydXNoQ2FsbGJhY2tzID0ge307CgogICAgICBpZiAoJChlbFRtcCkucHJvcCgndGFnTmFtZScpLnRvTG93ZXJDYXNlKCkgPT09ICdzdmcnKSB7CiAgICAgICAgc2VsZi5faGVpZ2h0ID0gb3B0aW9ucy5oZWlnaHQgfHwgJChlbFRtcCkucGFyZW50KCkuaGVpZ2h0KCkgfHwgMzAwOwogICAgICAgIHNlbGYuX3dpZHRoID0gb3B0aW9ucy53aWR0aCB8fCAkKGVsVG1wKS5wYXJlbnQoKS53aWR0aCgpIHx8IDIwMDsKICAgICAgfSBlbHNlIHsKICAgICAgICBzZWxmLl9oZWlnaHQgPSBvcHRpb25zLmhlaWdodCB8fCAkKGVsVG1wKS5oZWlnaHQoKSB8fCAzMDA7CiAgICAgICAgc2VsZi5fd2lkdGggPSBvcHRpb25zLndpZHRoIHx8ICQoZWxUbXApLndpZHRoKCkgfHwgMjAwOwogICAgICB9CgogICAgfSwKICAgIGhlaWdodCA6IGZ1bmN0aW9uKHYpIHsKICAgICAgaWYgKHYgIT09IHVuZGVmaW5lZCkgewogICAgICAgIHRoaXMuX2hlaWdodCA9IHY7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMuX2hlaWdodDsKICAgIH0sCiAgICB3aWR0aCA6IGZ1bmN0aW9uKHYpIHsKICAgICAgaWYgKHYgIT09IHVuZGVmaW5lZCkgewogICAgICAgIHRoaXMuX3dpZHRoID0gdjsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy5fd2lkdGg7CiAgICB9LAogICAgLyoqCiAgICAgKiBnZXQgdGhlIHNjYWxpbmdDb250ZXh0IGZyb20gdGhlIG9wdGlvbnMgKGNvbnRydWN0b3Igb3JpZW50ZWQpIG9yIGRlZmluZSBhIG5ldyBvbmUKICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zCiAgICAgKi8KICAgIHNldHVwU2NhbGluZ0NvbnRleHQgOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CgogICAgICBpZiAob3B0aW9ucy5zY2FsaW5nQ29udGV4dCAhPSB1bmRlZmluZWQpIHsKICAgICAgICBzZWxmLnNjYWxpbmdDb250ZXh0ID0gb3B0aW9ucy5zY2FsaW5nQ29udGV4dDsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoc2VsZi5zY2FsaW5nQ29udGV4dCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBzZWxmLnNjYWxpbmdDb250ZXh0ID0gbmV3IEQzU2NhbGluZ0NvbnRleHQoewogICAgICAgICAgICBoZWlnaHQgOiBzZWxmLl9oZWlnaHQsCiAgICAgICAgICAgIHdpZHRoIDogc2VsZi5fd2lkdGgKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgaWYgKG9wdGlvbnMueERvbWFpbikgewogICAgICAgICAgc2VsZi5zY2FsaW5nQ29udGV4dC54T3JpZ0RvbWFpbihvcHRpb25zLnhEb21haW4pOwogICAgICAgICAgc2VsZi5zY2FsaW5nQ29udGV4dC54RG9tYWluKG9wdGlvbnMueERvbWFpbik7CiAgICAgICAgfQogICAgICAgIGlmIChvcHRpb25zLnlEb21haW4pIHsKICAgICAgICAgIHNlbGYuc2NhbGluZ0NvbnRleHQueU9yaWdEb21haW4ob3B0aW9ucy55RG9tYWluKTsKICAgICAgICAgIHNlbGYuc2NhbGluZ0NvbnRleHQueURvbWFpbihvcHRpb25zLnlEb21haW4pOwogICAgICAgIH0KICAgICAgICBpZiAob3B0aW9ucy5oZWlnaHQpIHsKICAgICAgICAgIHNlbGYuc2NhbGluZ0NvbnRleHQuaGVpZ2h0KG9wdGlvbnMuaGVpZ2h0KTsKICAgICAgICB9CiAgICAgICAgaWYgKG9wdGlvbnMud2lkdGgpIHsKICAgICAgICAgIHNlbGYuc2NhbGluZ0NvbnRleHQud2lkdGgob3B0aW9ucy53aWR0aCk7CiAgICAgICAgfQoKICAgICAgfQogICAgICBzZWxmLmxpc3RlblRvKHNlbGYuc2NhbGluZ0NvbnRleHQsICdzY2FsZWNoYW5nZScsIGZ1bmN0aW9uKGV2dCkgewogICAgICAgIHNlbGYucmVuZGVyKHsKICAgICAgICAgIGNhdXNlIDogewogICAgICAgICAgICBuYW1lIDogZXZ0LAogICAgICAgICAgICBpZCA6IE1hdGgucmFuZG9tKCkKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSkKICAgIH0sCiAgICAvKioKICAgICAqIGFkZCBhIEQzU2NhbGluZ0FyZSwgaS5lLiBhIHgtem9vbWFibGUgYXJlYQogICAgICovCiAgICB4Wm9vbWFibGUgOiBmdW5jdGlvbigpIHsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgdmFyIGFkYXB0WURvbWFpbiA9IGZ1bmN0aW9uKHhzKSB7CiAgICAgICAgaWYgKCFzZWxmLmdldE1heFlJblhEb21haW4pCiAgICAgICAgICByZXR1cm4KICAgICAgICB2YXIgeW1heCA9IHNlbGYuZ2V0TWF4WUluWERvbWFpbih4c1swXSwgeHNbMV0pOwogICAgICAgIHNlbGYuc2NhbGluZ0NvbnRleHQueURvbWFpbigwLCB5bWF4LCB7CiAgICAgICAgICBzaWxlbnQgOiB0cnVlCiAgICAgICAgfSk7CgogICAgICB9CgogICAgICBzZWxmLnNldHVwSW50ZXJhY3RpdmUoKTsKICAgICAgc2VsZi5zZXRCcnVzaENhbGxiYWNrKEtFWVBSRVNTRURfTk9ORSwgZnVuY3Rpb24oeHMpIHsKICAgICAgICBhZGFwdFlEb21haW4oeHMpCiAgICAgICAgc2VsZi5zY2FsaW5nQ29udGV4dC54RG9tYWluKHhzKQogICAgICB9KQogICAgICBzZWxmLnNldEJydXNoQ2FsbGJhY2soRE9VQkxFX0NMSUNLLCBmdW5jdGlvbih4cykgewogICAgICAgIHNlbGYuc2NhbGluZ0NvbnRleHQucmVzZXQoKQogICAgICB9KQogICAgfSwKCiAgICBzZXRTaGlmdFNlbGVjdENhbGxiYWNrIDogZnVuY3Rpb24oZikgewogICAgICB0aGlzLnNldEJydXNoQ2FsbGJhY2soS0VZUFJFU1NFRF9TSElGVCwgZik7CiAgICB9LAoKICAgIHNldHVwSW50ZXJhY3RpdmUgOiBmdW5jdGlvbigpIHsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICBpZiAoc2VsZi5icnVzaCAhPT0gdW5kZWZpbmVkKQogICAgICAgIHJldHVybjsKCiAgICAgIHNlbGYuZWwuc2VsZWN0QWxsKCcuem9vbS1hcmVhJykucmVtb3ZlKCkKICAgICAgaWYgKHNlbGYuc2NhbGluZ0FyZWEgIT09IHVuZGVmaW5lZCkgewogICAgICAgIHNlbGYuc2NhbGluZ0FyZWEudXBkYXRlU2NhbGluZ0NvbnRleHQoc2VsZi5zY2FsaW5nQ29udGV4dCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc2VsZi5zY2FsaW5nQXJlYSA9IG5ldyBEM1NjYWxpbmdBcmVhKHsKICAgICAgICAgIGVsIDogc2VsZi52aXMgfHwgc2VsZi5lbCwKICAgICAgICAgIG1vZGVsIDogc2VsZi5zY2FsaW5nQ29udGV4dCwKICAgICAgICAgIGNhbGxiYWNrIDogZnVuY3Rpb24oKSB7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHZhciBnQnJ1c2ggPSAoc2VsZi52aXMgfHwgc2VsZi5lbCkuaW5zZXJ0KCdnJywgJzpmaXJzdC1jaGlsZCcpLmF0dHIoJ2NsYXNzJywgJ3gtc2VsZWN0b3InKTsKICAgICAgZ0JydXNoLmFwcGVuZCgncmVjdCcpLmF0dHIoJ2hlaWdodCcsICcxMDAlJykuYXR0cignd2lkdGgnLCAnMTAwJScpLmF0dHIoJ2NsYXNzJywgJ2JhY2tncm91bmQnKTsKICAgICAgdmFyIGxlZnRIaWRlciA9IGdCcnVzaC5hcHBlbmQoJ3JlY3QnKS5hdHRyKCdjbGFzcycsICdoaWRlciBsZWZ0JykuYXR0cignaGVpZ2h0JywgJzEwMCUnKS5hdHRyKCd3aWR0aCcsIDApLnN0eWxlKCdkaXNwbGF5JywgJ25vbmUnKTsKICAgICAgdmFyIHJpZ2h0SGlkZXIgPSBnQnJ1c2guYXBwZW5kKCdyZWN0JykuYXR0cignY2xhc3MnLCAnaGlkZXIgcmlnaHQnKS5hdHRyKCdoZWlnaHQnLCAnMTAwJScpLmF0dHIoJ3dpZHRoJywgJzEwMCUnKS5zdHlsZSgnZGlzcGxheScsICdub25lJyk7CgogICAgICB2YXIgdFN0YW1wID0gMDsKICAgICAgdmFyIGlzRGJsQ2xpY2sgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgZCA9IG5ldyBEYXRlKCk7CiAgICAgICAgdmFyIHQxID0gZC5nZXRNaWxsaXNlY29uZHMoKSArIDEwMDAgKiAoZC5nZXRTZWNvbmRzKCkgKyA2MCAqIGQuZ2V0TWludXRlcygpKQogICAgICAgIHZhciBiID0gKHQxIC0gdFN0YW1wKSA8IDQ1MAogICAgICAgIHRTdGFtcCA9IHQxOwogICAgICAgIHJldHVybiBiOwogICAgICB9CiAgICAgIHZhciBicnVzaCA9IGQzLnN2Zy5icnVzaCgpLm9uKCJicnVzaHN0YXJ0IiwgZnVuY3Rpb24oKSB7CiAgICAgICAgYnJ1c2gueChzZWxmLnNjYWxpbmdDb250ZXh0LngoKSk7CiAgICAgICAgbGVmdEhpZGVyLnN0eWxlKCdkaXNwbGF5JywgbnVsbCkKICAgICAgICByaWdodEhpZGVyLnN0eWxlKCdkaXNwbGF5JywgbnVsbCkKCiAgICAgIH0pLm9uKCJicnVzaCIsIGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBib3VuZHMgPSBicnVzaC5leHRlbnQoKQogICAgICAgIHZhciB4ID0gc2VsZi5zY2FsaW5nQ29udGV4dC54KCkKICAgICAgICBsZWZ0SGlkZXIuYXR0cignd2lkdGgnLCB4KGJvdW5kc1swXSkpCiAgICAgICAgcmlnaHRIaWRlci5hdHRyKCd4JywgeChib3VuZHNbMV0pKQoKICAgICAgfSkub24oImJydXNoZW5kIiwgZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGtwID0gZ2V0S2V5UHJlc3NlZCgpOwogICAgICAgIHZhciBib3VuZHMgPSBicnVzaC5leHRlbnQoKQogICAgICAgIGlmIChpc0RibENsaWNrKCkpIHsKICAgICAgICAgIHNlbGYuYnJ1c2hDYWxsYmFja3NbRE9VQkxFX0NMSUNLXSgpCiAgICAgICAgfSBlbHNlIGlmICgoYm91bmRzWzFdIC0gYm91bmRzWzBdKSA+PSAwLjAwMSAqIHNlbGYuc2NhbGluZ0NvbnRleHQueE1heCgpKSB7CiAgICAgICAgICBpZiAoc2VsZi5icnVzaENhbGxiYWNrc1trcF0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBzZWxmLmJydXNoQ2FsbGJhY2tzW2twXShib3VuZHMpCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGxlZnRIaWRlci5zdHlsZSgnZGlzcGxheScsICdub25lJykKICAgICAgICByaWdodEhpZGVyLnN0eWxlKCdkaXNwbGF5JywgJ25vbmUnKQogICAgICB9KTsKCiAgICAgIGJydXNoLngoc2VsZi5zY2FsaW5nQ29udGV4dC54KCkpOwogICAgICBicnVzaChnQnJ1c2gpOwoKICAgIH0sCiAgICBzZXRCcnVzaENhbGxiYWNrIDogZnVuY3Rpb24oa2V5TWFzaywgZikgewogICAgICB0aGlzLmJydXNoQ2FsbGJhY2tzW2tleU1hc2tdID0gZgogICAgfQogIH0pOwoKICB2YXIgZ2V0S2V5UHJlc3NlZCA9IGZ1bmN0aW9uKCkgewogICAgdmFyIGkgPSAwOwogICAgaWYgKGQzLmV2ZW50LnNvdXJjZUV2ZW50LnNoaWZ0S2V5KQogICAgICBpIHw9IEtFWVBSRVNTRURfU0hJRlQ7CgogICAgaWYgKGQzLmV2ZW50LnNvdXJjZUV2ZW50LmFsdEtleSkKICAgICAgaSB8PSBLRVlQUkVTU0VEX0FMVDsKICAgIHJldHVybiBpCiAgfQogIHJldHVybiBDb21tb25XaWRnZXRWaWV3Owp9KTsKCgovKioKICogdXRpbGl0eSBtZXRob2QgdGhhdCB3aWxsIGFwcGx5IGEgcmVndWxhciBleHByZXNzaW9uIG9udG8gYSBzdHJpbmcsIGFzc3VtaW5nIHRoYXQgYWxsIGFsIHRoZSBzdHJpbmcgaXMgY2FwdGlyZWQgYnkgdGhlIHJlZyBleHAgKG5vIGhvbGVzKQogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KCmRlZmluZSgnZmlzaHRvbmVzL3V0aWxzL1JlZ0V4cEZ1bGxTcGxpdGVyJyxbJ3VuZGVyc2NvcmUnXSwgZnVuY3Rpb24gKF8pIHsKICAgIFJlZ0V4cEZ1bGxTcGxpdGVyID0gZnVuY3Rpb24gKG9wdGlvbnMpIHsKCiAgICB9CiAgICAvKioKICAgICAqIGFsbCBtYXRjaCBjYXRwdXJlIGJ5IHRoZSByZWdleHAgYXJlIHJldHVybmVkIGluIGFuIGFycmF5LAogICAgICogSWYgc29tZSBwaWVjZSBvZiB0aGUgc3RyaW5nIGlzIG5vdCBjb3ZlcmVkLCB0aGVuIGFuIEV4Y2VwdGlvbiBpcyB0aHJvd24KICAgICAqIHJlZ2V4cCBpcyBkdXBsaWNhdGUgdG8gYXZvaWQgc3luYyBwcm9ibGVtIG9uIGxhc3RJbmRleE9mIGFuZCB0aGlzIGtpbmQgb2YgdGhpbmdzLi4uCiAgICAgKiBAcGFyYW0ge09iamVjdH0gcmVnZXhwIGlzIGEgc3RyaW5nIG9yIHJlZ2V4cAogICAgICogQHBhcmFtIHtPYmplY3R9IHN0cgogICAgICovCiAgICBSZWdFeHBGdWxsU3BsaXRlci5wcm90b3R5cGUuc3BsaXQgPSBmdW5jdGlvbiAocmVnZXhwLCBzdHIpIHsKICAgICAgICB2YXIgcmV0ID0gW10KCiAgICAgICAgdmFyIHJlCiAgICAgICAgaWYgKHJlZ2V4cCBpbnN0YW5jZW9mIFJlZ0V4cCkgewogICAgICAgICAgICByZSA9IG5ldyBSZWdFeHAocmVnZXhwLnNvdXJjZSwgJ2cnKQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJlID0gbmV3IFJlZ0V4cChyZWdleHAsICdnJykKICAgICAgICB9CiAgICAgICAgcmUuZ2xvYmFsID0gdHJ1ZQoKICAgICAgICB2YXIgcG9zTWF0Y2ggPSAwCiAgICAgICAgd2hpbGUgKG0gPSByZS5leGVjKHN0cikpIHsKICAgICAgICAgICAgaWYgKG0uaW5kZXggIT0gcG9zTWF0Y2gpIHsKICAgICAgICAgICAgICAgIHRocm93IHsKICAgICAgICAgICAgICAgICAgICBuYW1lOiAnUmVnZXhwRnVsbFNlcXVlbmNlQ292ZXJhZ2UnLAogICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdjYW5ub3QgY2hhcmFjdGVyIGF0IHBvcyBbJyArIHBvc01hdGNoICsgJy0nICsgbS5pbmRleCArICddICgnICsgc3RyLnN1YnN0cmluZyhwb3NNYXRjaCwgbS5pbmRleCkgKyAnKSBpbiAiJyArIHN0ciArICciIGlzIG5vdCBjb3ZlcmVkIGJ5IHJlZ3VsYXIgZXhwcmVzc2lvbiAnICsgcmUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBwb3NNYXRjaCA9IHJlLmxhc3RJbmRleDsKCiAgICAgICAgICAgIHJldC5wdXNoKG0pCiAgICAgICAgfQogICAgICAgIGlmIChzdHIubGVuZ3RoICE9IHBvc01hdGNoKSB7CiAgICAgICAgICAgIHRocm93IHsKICAgICAgICAgICAgICAgIG5hbWU6ICdSZWdleHBGdWxsU2VxdWVuY2VDb3ZlcmFnZScsCiAgICAgICAgICAgICAgICBtZXNzYWdlOiAnY2Fubm90IGNoYXJhY3RlciBhdCBwb3MgWycgKyBwb3NNYXRjaCArICctJyArIG0uaW5kZXggKyAnXSAoJyArIHN0ci5zdWJzdHJpbmcocG9zTWF0Y2gsIG0uaW5kZXgpICsgJykgaW4gIicgKyBzdHIgKyAnIiBpcyBub3QgY292ZXJlZCBieSByZWd1bGFyIGV4cHJlc3Npb24gJyArIHJlCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJldAogICAgfQoKICAgIHJldHVybiBSZWdFeHBGdWxsU3BsaXRlcgp9KTsKCi8qCiAqIEFtaW5vQWNpZCBvYmplY3QuCiAgKiBQcm9wZXJ0aWVzOgogICogLSBhIGNvZGUxIChvbmUgbGV0dGVyKSwKICAqIC0gYSBtYXNzLgogICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCmRlZmluZSgnZmlzaHRvbmVzL21vZGVscy9kcnkvQW1pbm9BY2lkJyxbJ0JhY2tib25lJ10sIGZ1bmN0aW9uKEJhY2tib25lKSB7CgogICAgdmFyIEFtaW5vQWNpZCA9IEJhY2tib25lLk1vZGVsLmV4dGVuZCh7CiAgICAgICAgaWRBdHRyaWJ1dGUgOiAnY29kZTEnLAogICAgICAgIGRlZmF1bHRzIDogewogICAgICAgICAgICBtYXNzIDogLTEKICAgICAgICB9LAogICAgICAgIGluaXRpYWxpemUgOiBmdW5jdGlvbigpIHsKICAgICAgICB9LAogICAgICAgIHRvU3RyaW5nIDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgcmV0dXJuIHNlbGYuZ2V0KCdjb2RlMScpOwogICAgICAgIH0KICAgIH0pOwoKICAgIHJldHVybiBBbWlub0FjaWQ7Cn0pOwoKLyoKICogYW1pbm8gYWNpZCBkZWZpbml0aW9uLCBsb2FkZWQgYnkgY29sbGVjdGlvbnMvZHJ5L0FtaW5vQWNpZGljdGlvbmFyeQogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KCmRlZmluZSgnZmlzaHRvbmVzL2RhdGEvYW1pbm9BY2lkcycsW10sZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gW3sKICAgICAgICBjb2RlMSA6ICJBIiwKICAgICAgICAibWFzcyIgOiA3MS4wMzcxMTQKICAgIH0sIHsKICAgICAgICAiY29kZTEiIDogIlIiLAogICAgICAgICJtYXNzIiA6IDE1Ni4xMDExMTEKICAgIH0sIHsKICAgICAgICAiY29kZTEiIDogIk4iLAogICAgICAgICJtYXNzIiA6IDExNC4wNDI5MjcKICAgIH0sIHsKICAgICAgICAiY29kZTEiIDogIkQiLAogICAgICAgICJtYXNzIiA6IDExNS4wMjY5NDMKICAgIH0sIHsKICAgICAgICAiY29kZTEiIDogIkMiLAogICAgICAgICJtYXNzIiA6IDEwMy4wMDkxODUKICAgIH0sIHsKICAgICAgICAiY29kZTEiIDogIkUiLAogICAgICAgICJtYXNzIiA6IDEyOS4wNDI1OTMKICAgIH0sIHsKICAgICAgICAiY29kZTEiIDogIlEiLAogICAgICAgICJtYXNzIiA6IDEyOC4wNTg1NzgKICAgIH0sIHsKICAgICAgICAiY29kZTEiIDogIkciLAogICAgICAgICJtYXNzIiA6IDU3LjAyMTQ2NAogICAgfSwgewogICAgICAgICJjb2RlMSIgOiAiSCIsCiAgICAgICAgIm1hc3MiIDogMTM3LjA1ODkxMgogICAgfSwgewogICAgICAgICJjb2RlMSIgOiAiSSIsCiAgICAgICAgIm1hc3MiIDogMTEzLjA4NDA2NAogICAgfSwgewogICAgICAgICJjb2RlMSIgOiAiTCIsCiAgICAgICAgIm1hc3MiIDogMTEzLjA4NDA2NAogICAgfSwgewogICAgICAgICJjb2RlMSIgOiAiSyIsCiAgICAgICAgIm1hc3MiIDogMTI4LjA5NDk2MwogICAgfSwgewogICAgICAgICJjb2RlMSIgOiAiTSIsCiAgICAgICAgIm1hc3MiIDogMTMxLjA0MDQ4NQogICAgfSwgewogICAgICAgICJjb2RlMSIgOiAiRiIsCiAgICAgICAgIm1hc3MiIDogMTQ3LjA2ODQxNAogICAgfSwgewogICAgICAgICJjb2RlMSIgOiAiUCIsCiAgICAgICAgIm1hc3MiIDogOTcuMDUyNzY0CiAgICB9LCB7CiAgICAgICAgImNvZGUxIiA6ICJTIiwKICAgICAgICAibWFzcyIgOiA4Ny4wMzIwMjgKICAgIH0sIHsKICAgICAgICAiY29kZTEiIDogIlQiLAogICAgICAgICJtYXNzIiA6IDEwMS4wNDc2NzkKICAgIH0sIHsKICAgICAgICAiY29kZTEiIDogIlciLAogICAgICAgICJtYXNzIiA6IDE4Ni4wNzkzMTMKICAgIH0sIHsKICAgICAgICAiY29kZTEiIDogIlkiLAogICAgICAgICJtYXNzIiA6IDE2My4wNjMzMgogICAgfSwgewogICAgICAgICJjb2RlMSIgOiAiViIsCiAgICAgICAgIm1hc3MiIDogOTkuMDY4NDE0CiAgICB9XQp9KTsKCi8qCiAqIEEgc2luZ2xldG9uIGFtaW5vIGFjaWQgZGljdGlvbmFyeSwgbG9hZGVkIGZyb20ganNvbiBmaWwgZGF0YS9hbWlub0FjaWQuanMKICogCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwoKZGVmaW5lKCdmaXNodG9uZXMvY29sbGVjdGlvbnMvZHJ5L0FtaW5vQWNpZERpY3Rpb25hcnknLFsnZmlzaHRvbmVzL21vZGVscy9kcnkvQW1pbm9BY2lkJywgJ2Zpc2h0b25lcy9kYXRhL2FtaW5vQWNpZHMnXSwgZnVuY3Rpb24oQW1pbm9BY2lkLCBic19hbWlub2FjaWRzKSB7CiAgICB2YXIgQW1pbm9BY2lkRGljdGlvbmFyeSA9IEJhY2tib25lLkNvbGxlY3Rpb24uZXh0ZW5kKHsKCiAgICAgICAgbW9kZWwgOiBBbWlub0FjaWQsCiAgICAgICAgZGVmYXVsdHMgOiB7CiAgICAgICAgfSwKICAgICAgICBpbml0aWFsaXplIDogZnVuY3Rpb24ob3B0aW9ucykgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHNlbGYuYWRkKGJzX2FtaW5vYWNpZHMpOwogICAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIG5ldyBBbWlub0FjaWREaWN0aW9uYXJ5KCk7Cn0pOwoKLyoKICogQSBSZXNpZHVlTW9kaWZpY2F0aW9uIFBPSk8sIHdpaHQgcHJvcGVydGllcwogKiAgLSBuYW1lICh1bmlxdWUgYWNyb3NzIHRoZSBkaWN0aW9uYXJ5CiAqICAtIG1hc3MKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCgpkZWZpbmUoJ2Zpc2h0b25lcy9tb2RlbHMvZHJ5L1Jlc2lkdWVNb2RpZmljYXRpb24nLFsnanF1ZXJ5JywgJ3VuZGVyc2NvcmUnLCAnQmFja2JvbmUnXSwgZnVuY3Rpb24oJCwgXywgQmFja2JvbmUpIHsKCiAgICB2YXIgUmVzaWR1ZU1vZGlmaWNhdGlvbiA9IEJhY2tib25lLk1vZGVsLmV4dGVuZCh7CiAgICAgICAgaWRBdHRyaWJ1dGU6J25hbWUnLAogICAgICAgIGRlZmF1bHRzIDogewogICAgICAgICAgICBtYXNzIDogLTEKICAgICAgICB9LAogICAgICAgIGluaXRpYWxpemUgOiBmdW5jdGlvbigpIHsKICAgICAgICB9LAogICAgICAgIHRvU3RyaW5nIDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgcmV0dXJuIHNlbGYuZ2V0KCduYW1lJykgKyAnKCcrc2VsZi5nZXQoJ21hc3MnKSsnKSc7CiAgICAgICAgfQogICAgfSk7CgogICAgcmV0dXJuIFJlc2lkdWVNb2RpZmljYXRpb247Cn0pOwoKLyoKICogYSBqc29uIHBvcnQgb2YgVW5pbW9kICsgc29tZSBjdXN0b20gbW9kaWZzLgogKiBsb2FkZWQgYnkgY29sbGVjdGlvbnMvZHJ5L1Jlc2lkdWVNb2RpZmljYXRpb25EaWN0aW9uYXJ5CiAqCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwoKZGVmaW5lKCdmaXNodG9uZXMvZGF0YS9yZXNpZHVlTW9kaWZpY2F0aW9ucycsW10sZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIFsKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlBJQyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQSUMiLAogICAgICAgICAgICAibWFzcyI6IDExOS4wMzcxMTQsCiAgICAgICAgICAgIGZvcm11bGE6ICdDN09OSDUnCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlBJQ19IRUFWWSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQSUNfSEVBVlkiLAogICAgICAgICAgICAibWFzcyI6IDEyNS4wNTcyNDI5OCwKICAgICAgICAgICAgZm9ybXVsYTogJ0M3T05INScKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiMTNDMTVOLUEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiMTNDMTVOLUEiLAogICAgICAgICAgICAibWFzcyI6IDQuMDA3MDk5NDA2NiwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiMTNDMTVOLUMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiMTNDMTVOLUMiLAogICAgICAgICAgICAibWFzcyI6IDQuMDA3MDk5NDA2NiwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiMTNDMTVOLUQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiMTNDMTVOLUQiLAogICAgICAgICAgICAibWFzcyI6IDUuMDEwNDU0MjQ0NCwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiMTNDMTVOLUUiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiMTNDMTVOLUUiLAogICAgICAgICAgICAibWFzcyI6IDYuMDEzODA5MDgyMiwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiMTNDMTVOLUYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiMTNDMTVOLUYiLAogICAgICAgICAgICAibWFzcyI6IDEwLjAyNzIyODQzMzQsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIjEzQzE1Ti0iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiMTNDMTVOLSIsCiAgICAgICAgICAgICJtYXNzIjogMy4wMDM3NDQ1Njg4LAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICIxM0MxNU4tSCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICIxM0MxNU4tSCIsCiAgICAgICAgICAgICJtYXNzIjogOS4wMTEyMzM3MDY0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIjEzQzE1Ti1JIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIjEzQzE1Ti1JIiwKICAgICAgICAgICAgIm1hc3MiOiA3LjAxNzE2MzkyCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIjEzQzE1Ti1LIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIjEzQzE1Ti1LIiwKICAgICAgICAgICAgIm1hc3MiOiA4LjAxNDE5ODgxMzIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiMTNDMTVOLUwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiMTNDMTVOLUwiLAogICAgICAgICAgICAibWFzcyI6IDcuMDE3MTYzOTIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiMTNDMTVOLU0iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiMTNDMTVOLU0iLAogICAgICAgICAgICAibWFzcyI6IDYuMDEzODA5MDgyMgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICIxM0MxNU4tTiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICIxM0MxNU4tTiIsCiAgICAgICAgICAgICJtYXNzIjogNi4wMDc0ODkxMzc2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIjEzQzE1Ti1QIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIjEzQzE1Ti1QIiwKICAgICAgICAgICAgIm1hc3MiOiA2LjAxMzgwOTA4MjIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiMTNDMTVOLVEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiMTNDMTVOLVEiLAogICAgICAgICAgICAibWFzcyI6IDcuMDEwODQzOTc1NAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICIxM0MxNU4tUiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICIxM0MxNU4tUiIsCiAgICAgICAgICAgICJtYXNzIjogMTAuMDA4MjY4NTk5NgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICIxM0MxNU4tUyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICIxM0MxNU4tUyIsCiAgICAgICAgICAgICJtYXNzIjogNC4wMDcwOTk0MDY2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIjEzQzE1Ti1UIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIjEzQzE1Ti1UIiwKICAgICAgICAgICAgIm1hc3MiOiA1LjAxMDQ1NDI0NDQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiMTNDMTVOLVYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiMTNDMTVOLVYiLAogICAgICAgICAgICAibWFzcyI6IDYuMDEzODA5MDgyMgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICIxM0MxNU4tVyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICIxM0MxNU4tVyIsCiAgICAgICAgICAgICJtYXNzIjogMTMuMDMwOTczMDAyMgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICIxM0MxNU4tWSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICIxM0MxNU4tWSIsCiAgICAgICAgICAgICJtYXNzIjogMTAuMDI3MjI4NDMzNAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJBY2V0eWwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQWNldHlsYXRpb24iLAogICAgICAgICAgICAibWFzcyI6IDQyLjAxMDU2NQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJBbWlkYXRlZCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBbWlkYXRpb24iLAogICAgICAgICAgICAibWFzcyI6IC0wLjk4NDAxNgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJCaW90aW4iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQmlvdGlueWxhdGlvbiIsCiAgICAgICAgICAgICJtYXNzIjogMjI2LjA3NzU5OAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJDYXJiYW1pZG9tZXRoeWwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSW9kb2FjZXRhbWlkZSBkZXJpdmF0aXZlIiwKICAgICAgICAgICAgIm1hc3MiOiA1Ny4wMjE0NjQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQ2FyYmFteWwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQ2FyYmFteWxhdGlvbiIsCiAgICAgICAgICAgICJtYXNzIjogNDMuMDA1ODE0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkNhcmJveHltZXRoeWwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSW9kb2FjZXRpYyBhY2lkIGRlcml2YXRpdmUiLAogICAgICAgICAgICAibWFzcyI6IDU4LjAwNTQ3OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJEZWFtaWRhdGVkIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkRlYW1pZGF0aW9uIiwKICAgICAgICAgICAgIm1hc3MiOiAwLjk4NDAxNgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJNZXQtPkhzZSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJIb21vc2VyaW5lIiwKICAgICAgICAgICAgIm1hc3MiOiAtMjkuOTkyODA2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk1ldC0+SHNsIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkhvbW9zZXJpbmUgbGFjdG9uZSIsCiAgICAgICAgICAgICJtYXNzIjogLTQ4LjAwMzM3MQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJOSVBDQU0iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTi1pc29wcm9weWxjYXJib3hhbWlkb21ldGh5bCIsCiAgICAgICAgICAgICJtYXNzIjogOTkuMDY4NDE0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlBob3NwaG8iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUGhvc3Bob3J5bGF0aW9uIiwKICAgICAgICAgICAgIm1hc3MiOiA3OS45NjYzMzEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRGVoeWRyYXRlZCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJEZWh5ZHJhdGlvbiIsCiAgICAgICAgICAgICJtYXNzIjogLTE4LjAxMDU2NQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJQcm9waW9uYW1pZGUiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQWNyeWxhbWlkZSBhZGR1Y3QiLAogICAgICAgICAgICAibWFzcyI6IDcxLjAzNzExNAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJQeXJvLWNhcmJhbWlkb21ldGh5bCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJTLWNhcmJhbW95bG1ldGh5bGN5c3RlaW5lIGN5Y2xpemF0aW9uIChOLXRlcm1pbnVzKSIsCiAgICAgICAgICAgICJtYXNzIjogMzkuOTk0OTE1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkdsdS0+cHlyby1HbHUiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUHlyby1nbHUgZnJvbSBFIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTguMDEwNTY1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkdsbi0+cHlyby1HbHUiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUHlyby1nbHUgZnJvbSBRIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTcuMDI2NTQ5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkNhdGlvbjpOYSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJTb2RpdW0gYWRkdWN0IiwKICAgICAgICAgICAgIm1hc3MiOiAyMS45ODE5NDMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUHlyaWR5bGV0aHlsIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlMtcHlyaWR5bGV0aHlsYXRpb24iLAogICAgICAgICAgICAibWFzcyI6IDEwNS4wNTc4NDkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTWV0aHlsIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIk1ldGh5bGF0aW9uIiwKICAgICAgICAgICAgIm1hc3MiOiAxNC4wMTU2NQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJPeGlkYXRpb24iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiT3hpZGF0aW9uIG9yIEh5ZHJveHlsYXRpb24iLAogICAgICAgICAgICAibWFzcyI6IDE1Ljk5NDkxNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJEaW1ldGh5bCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJkaS1NZXRoeWxhdGlvbiIsCiAgICAgICAgICAgICJtYXNzIjogMjguMDMxMwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJUcmltZXRoeWwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAidHJpLU1ldGh5bGF0aW9uIiwKICAgICAgICAgICAgIm1hc3MiOiA0Mi4wNDY5NQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJNZXRoeWx0aGlvIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkJldGEtbWV0aHlsdGhpb2xhdGlvbiIsCiAgICAgICAgICAgICJtYXNzIjogNDUuOTg3NzIxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlN1bGZvIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIk8tU3VsZm9uYXRpb24iLAogICAgICAgICAgICAibWFzcyI6IDc5Ljk1NjgxNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJIZXgiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSGV4b3NlIiwKICAgICAgICAgICAgIm1hc3MiOiAxNjIuMDUyODIzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkhleE5BYyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJOLUFjZXR5bGhleG9zYW1pbmUiLAogICAgICAgICAgICAibWFzcyI6IDIwMy4wNzkzNzMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTXlyaXN0b3lsIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIk15cmlzdG95bGF0aW9uIiwKICAgICAgICAgICAgIm1hc3MiOiAyMTAuMTk4MzY2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkd1YW5pZGlueWwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR3VhbmlkaW5hdGlvbiIsCiAgICAgICAgICAgICJtYXNzIjogNDIuMDIxNzk4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlByb3Bpb255bCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQcm9waW9uYXRlIGxhYmVsaW5nIHJlYWdlbnQgbGlnaHQgZm9ybSAoTi10ZXJtICYgSykiLAogICAgICAgICAgICAibWFzcyI6IDU2LjAyNjIxNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJQcm8tPnB5cm8tR2x1IiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogInByb2xpbmUgb3hpZGF0aW9uIHRvIHB5cm9nbHV0YW1pYyBhY2lkIiwKICAgICAgICAgICAgIm1hc3MiOiAxMy45NzkyNjUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTkhTLUxDLUJpb3RpbiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJOSFMtTEMtQmlvdGluIiwKICAgICAgICAgICAgIm1hc3MiOiAzMzkuMTYxNjYyCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIklDQVQtQyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBcHBsaWVkIEJpb3N5c3RlbXMgY2xlYXZhYmxlIElDQVQoVE0pIGxpZ2h0IiwKICAgICAgICAgICAgIm1hc3MiOiAyMjcuMTI2OTkxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIklDQVQtQzoxM0MoOSkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXBwbGllZCBCaW9zeXN0ZW1zIGNsZWF2YWJsZSBJQ0FUKFRNKSBoZWF2eSIsCiAgICAgICAgICAgICJtYXNzIjogMjM2LjE1NzE4NQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJOZXRoeWxtYWxlaW1pZGUiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTi1ldGh5bG1hbGVpbWlkZSBvbiBjeXN0ZWluZXMiLAogICAgICAgICAgICAibWFzcyI6IDEyNS4wNDc2NzkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiR2x5R2x5IiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogInViaXF1aXRpbnlsYXRpb24gcmVzaWR1ZSIsCiAgICAgICAgICAgICJtYXNzIjogMTE0LjA0MjkyNwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJGb3JteWwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiRm9ybXlsYXRpb24iLAogICAgICAgICAgICAibWFzcyI6IDI3Ljk5NDkxNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJIZXgoMSlIZXhOQWMoMSlOZXVBYygyKSAoU1QpIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkhleDFIZXhOQWMxTmV1QWMyIChTVCkiLAogICAgICAgICAgICAibWFzcyI6IDk0Ny4zMjMwMjkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRGltZXRoeWw6MkgoNikxM0MoMikiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiZGltZXRoeWxhdGVkIGFyZ2luaW5lIiwKICAgICAgICAgICAgIm1hc3MiOiAzNi4wNzU2NwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJEZWx0YTpIKDQpQygyKU8oLTEpUygxKSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJTLUV0aHlsY3lzdGluZSBmcm9tIFNlcmluZSIsCiAgICAgICAgICAgICJtYXNzIjogNDQuMDA4NDU2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkxhYmVsOjEzQyg2KSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICIxM0MoNikgU2lsYWMgbGFiZWwiLAogICAgICAgICAgICAibWFzcyI6IDYuMDIwMTI5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkxhYmVsOjE4TygyKSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJPMTggbGFiZWwgYXQgYm90aCBDLXRlcm1pbmFsIG94eWdlbnMiLAogICAgICAgICAgICAibWFzcyI6IDQuMDA4NDkxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogImlUUkFRNHBsZXgiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUmVwcmVzZW50YXRpdmUgbWFzcyBhbmQgYWNjdXJhdGUgbWFzcyBmb3IgMTE2ICYgMTE3IiwKICAgICAgICAgICAgIm1hc3MiOiAxNDQuMTAyMDYzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkxhYmVsOjE4TygxKSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJPMTggTGFiZWxpbmciLAogICAgICAgICAgICAibWFzcyI6IDIuMDA0MjQ2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkxhYmVsOjEzQyg2KTE1TigyKSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICIxM0MoNikgMTVOKDIpIFNpbGFjIGxhYmVsIiwKICAgICAgICAgICAgIm1hc3MiOiA4LjAxNDE5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJMYWJlbDoxM0MoNikxNU4oNCkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiMTNDKDYpIDE1Tig0KSBTaWxhYyBsYWJlbCIsCiAgICAgICAgICAgICJtYXNzIjogMTAuMDA4MjY5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkxhYmVsOjEzQyg5KTE1TigxKSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICIxM0MoOSkgMTVOKDEpIFNpbGFjIGxhYmVsIiwKICAgICAgICAgICAgIm1hc3MiOiAxMC4wMjcyMjgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTGFiZWw6MTNDKDUpMTVOKDEpIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIjEzQyg1KSAxNU4oMSkgU2lsYWMgbGFiZWwiLAogICAgICAgICAgICAibWFzcyI6IDYuMDEzODA5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk5pdHJvc3lsIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlMtbml0cm9zeWxhdGlvbiIsCiAgICAgICAgICAgICJtYXNzIjogMjguOTkwMTY0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkFFQlMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQW1pbm9ldGh5bGJlbnplbmVzdWxmb255bGF0aW9uIiwKICAgICAgICAgICAgIm1hc3MiOiAxODMuMDM1Mzk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkV0aGFub2x5bCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJFdGhhbm9sYXRpb24gb2YgQ3lzIiwKICAgICAgICAgICAgIm1hc3MiOiA0NC4wMjYyMTUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRXRoeWwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiRXRoeWxhdGlvbiIsCiAgICAgICAgICAgICJtYXNzIjogMjguMDMxMwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJDYXJib3h5IiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkNhcmJveHlsYXRpb24iLAogICAgICAgICAgICAibWFzcyI6IDQzLjk4OTgyOQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJOZXRoeWxtYWxlaW1pZGUrd2F0ZXIiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTmV0aHlsbWFsZWltaWRlaHlkcm9seXNpcyIsCiAgICAgICAgICAgICJtYXNzIjogMTQzLjA1ODI0MwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJJQ1BMOjEzQyg2KSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJCcnVrZXIgRGFsdG9uaWNzIFNFUlZBLUlDUEwoVE0pIHF1YW50aWZpY2F0aW9uIGNoZW1pc3RyeSwgaGVhdnkgZm9ybSIsCiAgICAgICAgICAgICJtYXNzIjogMTExLjA0MTU5MwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJJQ1BMIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkJydWtlciBEYWx0b25pY3MgU0VSVkEtSUNQTChUTSkgcXVhbnRpZmljYXRpb24gY2hlbWlzdHJ5LCBsaWdodCBmb3JtIiwKICAgICAgICAgICAgIm1hc3MiOiAxMDUuMDIxNDY0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkRlaHlkcm8iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSGFsZiBvZiBhIGRpc3VsZmlkZSBicmlkZ2UiLAogICAgICAgICAgICAibWFzcyI6IC0xLjAwNzgyNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJIeXB1c2luZSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJoeXB1c2luZSIsCiAgICAgICAgICAgICJtYXNzIjogODcuMDY4NDE0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkFtbW9uaWEtbG9zcyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMb3NzIG9mIGFtbW9uaWEiLAogICAgICAgICAgICAibWFzcyI6IC0xNy4wMjY1NDkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiR2x1Y29zeWxnYWxhY3Rvc3lsIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogImdsdWNvc3lsZ2FsYWN0b3N5bCBoeWRyb3h5bHlzaW5lIiwKICAgICAgICAgICAgIm1hc3MiOiAzNDAuMTAwNTYyCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkRpb3hpZGF0aW9uIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogImRpaHlkcm94eSIsCiAgICAgICAgICAgICJtYXNzIjogMzEuOTg5ODI5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkhleE4iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSGV4b3NhbWluZSIsCiAgICAgICAgICAgICJtYXNzIjogMTYxLjA2ODgwOAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJMYWJlbDoySCg0KSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICI0LDQsNSw1LUQ0IEx5c2luZSIsCiAgICAgICAgICAgICJtYXNzIjogNC4wMjUxMDcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRGltZXRoeWw6MkgoNCkxM0MoMikiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiRGlNZXRoeWwtQzEzSEQyIiwKICAgICAgICAgICAgIm1hc3MiOiAzNC4wNjMxMTcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTWFsZWltaWRlLVBFTzItQmlvdGluIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIk1hbGVpbWlkZS1QRU8yLUJpb3RpbiIsCiAgICAgICAgICAgICJtYXNzIjogNTI1LjIyNTcxOQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJBbGEtPlNlciIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBbGEtPlNlciBzdWJzdGl0dXRpb24iLAogICAgICAgICAgICAibWFzcyI6IDE1Ljk5NDkxNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJUaHItPklsZSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUaHItPklsZSBzdWJzdGl0dXRpb24iLAogICAgICAgICAgICAibWFzcyI6IDEyLjAzNjM4NgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJJQ1BMOjJIKDQpIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkJydWtlciBEYWx0b25pY3MgU0VSVkEtSUNQTChUTSkgcXVhbnRpZmljYXRpb24gY2hlbWlzdHJ5LCBtZWRpdW0gZm9ybSIsCiAgICAgICAgICAgICJtYXNzIjogMTA5LjA0NjU3MQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJpVFJBUThwbGV4IiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlJlcHJlc2VudGF0aXZlIG1hc3MgYW5kIGFjY3VyYXRlIG1hc3MgZm9yIDExMywgMTE0LCAxMTYgJiAxMTciLAogICAgICAgICAgICAibWFzcyI6IDMwNC4yMDUzNgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJMYWJlbDoxM0MoNikxNU4oMSkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiMTNDKDYpIDE1TigxKSBTaWxhYyBsYWJlbCIsCiAgICAgICAgICAgICJtYXNzIjogNy4wMTcxNjQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVE1UNnBsZXgiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiIiwKICAgICAgICAgICAgIm1hc3MiOiAyMjkuMTYyOTMyCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlRNVDJwbGV4IiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRNVDJwbGV4IGJ5IFRoZXJtbyIsCiAgICAgICAgICAgICJtYXNzIjogMjI1LjE1NTgzMwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJUTVQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiIiwKICAgICAgICAgICAgIm1hc3MiOiAyMjQuMTUyNDc4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkV4YWNUYWdUaGlvbCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJFeGFjVGFnIFRoaW9sIGxhYmVsIG1hc3MgZm9yIDItNC03LTEwIHBsZXgiLAogICAgICAgICAgICAibWFzcyI6IDk3Mi4zNjUyMTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRXhhY1RhZ0FtaW5lIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkV4YWNUYWcgQW1pbmUgbGFiZWwgbWFzcyBmb3IgMi00LTctMTAgcGxleCIsCiAgICAgICAgICAgICJtYXNzIjogMTAzMC4zNTI5NAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJBcmdHbHlHbHkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVWJpcXVpdGluYXRpb24gUkdHIiwKICAgICAgICAgICAgIm1hc3MiOiAyNzAuMTQ0MDM5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlN1bGZvLU5IUy1TUy1CaW90aW4iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiRVotTGluayBTdWxmby1OSFMtU1MtQmlvdGluIChQaWVyY2UpIiwKICAgICAgICAgICAgIm1hc3MiOiAzODkuMDkwMTU0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkJQQSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJCZW56b3lhbCBQaGVueWxhbGFuaW5lIiwKICAgICAgICAgICAgIm1hc3MiOiAyNjguMDk3MzY4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkJQQV9BSUxWIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkJlbnpveWFsIFBoZW55bGFsYW5pbmUgQUlMViIsCiAgICAgICAgICAgICJtYXNzIjogMjY4LjA5NzM2OAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJCUEFfU1RETiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJCZW56b3lhbCBQaGVueWxhbGFuaW5lIFNURE4iLAogICAgICAgICAgICAibWFzcyI6IDI2OC4wOTczNjgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQlBBX1BXWUYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQmVuem95YWwgUGhlbnlsYWxhbmluZSBQV1lGIiwKICAgICAgICAgICAgIm1hc3MiOiAyNjguMDk3MzY4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkJQQV9SRUNRIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkJlbnpveWFsIFBoZW55bGFsYW5pbmUgUkVDUSIsCiAgICAgICAgICAgICJtYXNzIjogMjY4LjA5NzM2OAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJCUEFfR0hLTSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJCZW56b3lhbCBQaGVueWxhbGFuaW5lIEdIS00iLAogICAgICAgICAgICAibWFzcyI6IDI2OC4wOTczNjgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiU01DQyBsaW5rZXIiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiU3VjY2luaW1pZHlsLTQtKE4tbWFsZWltaWRvbWV0aHlsKWN5Y2xvaGV4YW5lLTEtY2FyYm94eWxhdGUiLAogICAgICAgICAgICAibWFzcyI6IDIxOS4wODk1NDMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQ0hEIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIjEsMi1DeWNsb2hleGFuZWRpb25lIGFyZ2luaW5lIiwKICAgICAgICAgICAgIm1hc3MiOiAxMTIuMDUyNDMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQkQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiMSwyLUJ1dGFuZWRpb25lIGFyZ2luaW5lIiwKICAgICAgICAgICAgIm1hc3MiOiA4Ni4wMzY3NzkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSEEtVWJpcXVpdGluIFZpbnlsIFN1bGZvbmUiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSEEtVWJpcXVpdGluIFZpbnlsIFN1bGZvbmUiLAogICAgICAgICAgICAibWFzcyI6IDEyMC4wMTE5MjQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSEEtR2x5LVViaXF1aXRpbiBWaW55bCBTdWxmb25lIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkhBLUdseWN5bC1VYmlxdWl0aW4gVmlueWwgU3VsZm9uZSIsCiAgICAgICAgICAgICJtYXNzIjogMTc3LjAzMzM4OAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJDYXJiYW1pZG9tZXRoeWwtRGV1dGVyYXRlZCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJEZXV0ZXJhdGVkIElvZG9hY2V0YW1pZGUgRGVyaXZhdGl2ZSIsCiAgICAgICAgICAgICJtYXNzIjogNTkuMDM0MDE3CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlJHR1ViaXEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVWJpcXVpdGluYXRpb24gUkdHIC0gQXJnR2x5R2x5IiwKICAgICAgICAgICAgIm1hc3MiOiAyNzAuMTQ0MDM5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogImlvZG9hY2V0YW5pbGlkZSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJpb2RvYWNldGFuaWxpZGUiLAogICAgICAgICAgICAibWFzcyI6IDEzOS4wNzI4OTMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAicHJvcHlsbWVyY2FwdG8iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAicHJvcHlsbWVyY2FwdG8gLyBwcm9wYW5ldGhpb2wiLAogICAgICAgICAgICAibWFzcyI6IDU4LjAyNDEwNgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJHbHlHbHkgMTNDKDYpIDE1TigyKSBMeXMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiRG91YmxlIG1vZGlmaWNhdGlvbiBvZiBVYmlxdWl0aW4gYW5kIEx5cys4LjAyIiwKICAgICAgICAgICAgIm1hc3MiOiAxMjIuMDU3MTI2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlJFUExpLUROUCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJETlAgRnJldCBtb2RpZmljYXRpb24gZm9yIFJFUExpIHByb2plY3QiLAogICAgICAgICAgICAibWFzcyI6IDI1Mi4wNDk0NjkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUkVQTGktTUNBLUgiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUkVQTGktTUNBIEMxMkg4TzQiLAogICAgICAgICAgICAibWFzcyI6IDIxNi4wNDIyNTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUVFRVEdHIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlNVTU8gTHlzLVFRUVRHRyIsCiAgICAgICAgICAgICJtYXNzIjogNTk5LjI2NjMzOQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJJQ1BMOjEzQyg2KTJIKDQpIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkJydWtlciBEYWx0b25pY3MgU0VSVkEtSUNQTChUTSkgcXVhbnRpZmljYXRpb24gY2hlbWlzdHJ5LCBoZWF2eSBmb3JtLCArMTAgIHl1azMgMS0zMS0yMDExIiwKICAgICAgICAgICAgIm1hc3MiOiAxMTUuMDY2NwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJtVFJBUSBkMCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJtVFJBUSByYWdlbnQgYnkgQUIgU0NJRVgsIGRlbHRhIDAgZm9ybSIsCiAgICAgICAgICAgICJtYXNzIjogMTQwLjA5NDk2MwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJtVFJBUSBkNCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJtVFJBUSByYWdlbnQgYnkgQUIgU0NJRVgsIGRlbHRhICs0IGZvcm0iLAogICAgICAgICAgICAibWFzcyI6IDE0NC4xMDIwNjMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAibVRSQVEgZDgiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAibVRSQVEgcmFnZW50IGJ5IEFCIFNDSUVYLCBkZWx0YSArOCBmb3JtIiwKICAgICAgICAgICAgIm1hc3MiOiAxNDguMTA5MTYyCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkhleCgxKUhleE5BYygxKSAoU1QpIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkhleDFIZXhOQWMxIChTVCkiLAogICAgICAgICAgICAibWFzcyI6IDM2NS4xMzIxOTYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSGV4KDEpSGV4TkFjKDEpTmV1QWMoMSkgKFNUKSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJIZXgxSGV4TkFjMU5ldUFjMSAoU1QpIiwKICAgICAgICAgICAgIm1hc3MiOiA2NTYuMjI3NjEzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlRNVC1MeXNHbHlHbHkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVE1UIHdpdGggVWJpcXVpdGluIChHbHlHbHkpIG1vZGlmaWNhdGlvbiBvbiBzYW1lIHJlc2lkdWUiLAogICAgICAgICAgICAibWFzcyI6IDMzOC4xOTU0MDUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVE1UNi1MeXNHbHlHbHkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVE1UIDZwbGV4IHdpdGggVWJpcXVpdGluIE1vZGlmaWNhdGlvbiIsCiAgICAgICAgICAgICJtYXNzIjogMzQzLjIwNTg2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkNyb3RvbnlsYXRpb24iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQ3JvdG9ueWxhdGlvbiIsCiAgICAgICAgICAgICJtYXNzIjogNjguMDI2MjE1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkxSTFJHRy1LIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkxldUFyZ0xldUFyZ0dseUdseS1MeXMiLAogICAgICAgICAgICAibWFzcyI6IDY1Mi40MTMyNzgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUkxSR0ctSyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBcmdMZXVBcmdHbHlHbHktTHlzIiwKICAgICAgICAgICAgIm1hc3MiOiA1MzkuMzI5MjE0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkxSR0ctSyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMUkdHIG1vZGlmaWNhdGlvbiBvbiBMeXMiLAogICAgICAgICAgICAibWFzcyI6IDM4My4yMjgxMDMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQVFVQV9WIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogImFxdWEtViIsCiAgICAgICAgICAgICJtYXNzIjogNi4wMTM4MDksCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkFRVUFfUCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJpc290b3BpY2FsbHkgbW9kaWZpZWQgcmVzaWR1ZXMgUHJvIiwKICAgICAgICAgICAgIm1hc3MiOiA2LjAxMzgwOQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJBUVVBX1BWIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogImlzb3RvcGljYWxseSBtb2RpZmllZCByZXNpZHVlcyBQcm8gYW5kIFZhbCIsCiAgICAgICAgICAgICJtYXNzIjogNi4wMTM4MDkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQVFVQV9MIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogImlzb3RvcGljYWxseSBtb2RpZmllZCByZXNpZHVlIExldSIsCiAgICAgICAgICAgICJtYXNzIjogNy4wMTcxNjQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQVFVQV9JIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogImlzb3RvcGljYWxseSBtb2RpZmllZCByZXNpZHVlIElzb2xldWNpbmUiLAogICAgICAgICAgICAibWFzcyI6IDcuMDE3MTY0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkFRVUFfVCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJpc290b3BpY2FsbHkgbW9kaWZpZWQgcmVzaWR1ZSBUaHIiLAogICAgICAgICAgICAibWFzcyI6IDUuMDEwNDUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQVFVQV9HIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogImlzb3RvcGljYWxseSBtb2RpZmllZCByZXNpZHVlIEdseSIsCiAgICAgICAgICAgICJtYXNzIjogMy4wMDM3NDUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQVFVQV9GIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogImlzb3RvcGljYWxseSBtb2RpZmllZCByZXNpZHVlIEYiLAogICAgICAgICAgICAibWFzcyI6IDEwLjAyOAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJBUVVBX0EiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiaXNvdG9waWNhbGx5IG1vZGlmaWVkIHJlc2lkdWUgQWxhIiwKICAgICAgICAgICAgIm1hc3MiOiA0LjAwNzA5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJBUVVBX1lwaG9zIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogImlzb3RvcGljYWxseSBtb2RpZmllZCByZXNpZHVlIHBob3NwaG9yeWxhdGVkIFR5ciIsCiAgICAgICAgICAgICJtYXNzIjogODkuOTkzNTU5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkFRVUFfWSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJpc290b3BpY2FsbHkgbW9kaWZpZWQgcmVzaWR1ZSBUeXIiLAogICAgICAgICAgICAibWFzcyI6IDEwLjAyNzIyOAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJBY2V0eWxfaGVhdnlfTHlzIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFjZXR5bF9oZWF2eV9MeXMiLAogICAgICAgICAgICAibWFzcyI6IDUwLjAyNDc2NAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJRRVFUR0ciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiU1VNTyBMeXMtUUVRVEdHIiwKICAgICAgICAgICAgIm1hc3MiOiA2MDAuMjUwMzU0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk1vbm9NZXRoeWxQcm9waW9ueWwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTW9ub01ldGh5bFByb3Bpb255bEx5c2luZSIsCiAgICAgICAgICAgICJtYXNzIjogNzAuMDQxODY1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlByb3Bpb255bDoySCg1KSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQcm9waW9uYXRlIGxhYmVsaW5nIHJlYWdlbnQgcGVudGFkZXV0ZXJhdGVkIGZvcm0gKCs1YW11KSwgTi10ZXJtICYgSyIsCiAgICAgICAgICAgICJtYXNzIjogNjEuMDU3NTk4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkdseUdseUNhcmJhbXlsIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkNhcmJhbXlsYXRlZCBEaWdseWNpbmUiLAogICAgICAgICAgICAibWFzcyI6IDE1Ny4wNDg3NDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQVFVQV9EIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogImlzb3RvcGljYWxseSBtb2RpZmllZCByZXNpZHVlIEFzcCIsCiAgICAgICAgICAgICJtYXNzIjogNS4wMTA0NTQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQT5SIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFsYT5BcmciLAogICAgICAgICAgICAibWFzcyI6IDg1LjA2Mzk5NwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJBPk4iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQWxhPkFzbiIsCiAgICAgICAgICAgICJtYXNzIjogNDMuMDA1ODEzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkE+RCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBbGE+QXNwIiwKICAgICAgICAgICAgIm1hc3MiOiA0My45ODk4MjkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQT5DIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFsYT5DeXMiLAogICAgICAgICAgICAibWFzcyI6IDMxLjk3MjA3MQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJBPkUiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQWxhPkdsdSIsCiAgICAgICAgICAgICJtYXNzIjogNTguMDA1NDc5MDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQT5RIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFsYT5HbG4iLAogICAgICAgICAgICAibWFzcyI6IDU3LjAyMTQ2NDAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkE+RyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBbGE+R2x5IiwKICAgICAgICAgICAgIm1hc3MiOiAtMTQuMDE1NjUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQT5IIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFsYT5IaXMiLAogICAgICAgICAgICAibWFzcyI6IDY2LjAyMTc5Nzk5OTk5OTk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkE+SSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBbGE+SWxlIiwKICAgICAgICAgICAgIm1hc3MiOiA0Mi4wNDY5NDk5OTk5OTk5OTUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQT5MIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFsYT5MZXUiLAogICAgICAgICAgICAibWFzcyI6IDQyLjA0Njk0OTk5OTk5OTk5NQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJBPksiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQWxhPkx5cyIsCiAgICAgICAgICAgICJtYXNzIjogNTcuMDU3ODQ5MDAwMDAwMDA0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkE+TSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBbGE+TWV0IiwKICAgICAgICAgICAgIm1hc3MiOiA2MC4wMDMzNzA5OTk5OTk5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJBPkYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQWxhPlBoZSIsCiAgICAgICAgICAgICJtYXNzIjogNzYuMDMxMjk5OTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQT5QIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFsYT5Qcm8iLAogICAgICAgICAgICAibWFzcyI6IDI2LjAxNTY0OTk5OTk5OTk5NAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJBPlMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQWxhPlNlciIsCiAgICAgICAgICAgICJtYXNzIjogMTUuOTk0OTEzOTk5OTk5OTk0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkE+VCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBbGE+VGhyIiwKICAgICAgICAgICAgIm1hc3MiOiAzMC4wMTA1NjUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQT5XIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFsYT5UcnAiLAogICAgICAgICAgICAibWFzcyI6IDExNS4wNDIxOTkwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJBPlkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQWxhPlR5ciIsCiAgICAgICAgICAgICJtYXNzIjogOTIuMDI2MjA2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkE+ViIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBbGE+VmFsIiwKICAgICAgICAgICAgIm1hc3MiOiAyOC4wMzEzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlI+QSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBcmc+QWxhIiwKICAgICAgICAgICAgIm1hc3MiOiAtODUuMDYzOTk3CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlI+TiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBcmc+QXNuIiwKICAgICAgICAgICAgIm1hc3MiOiAtNDIuMDU4MTg0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlI+RCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBcmc+QXNwIiwKICAgICAgICAgICAgIm1hc3MiOiAtNDEuMDc0MTY4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlI+QyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBcmc+Q3lzIiwKICAgICAgICAgICAgIm1hc3MiOiAtNTMuMDkxOTI2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlI+RSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBcmc+R2x1IiwKICAgICAgICAgICAgIm1hc3MiOiAtMjcuMDU4NTE3OTk5OTk5OTkyCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlI+USIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBcmc+R2xuIiwKICAgICAgICAgICAgIm1hc3MiOiAtMjguMDQyNTMyOTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUj5HIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFyZz5HbHkiLAogICAgICAgICAgICAibWFzcyI6IC05OS4wNzk2NDcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUj5IIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFyZz5IaXMiLAogICAgICAgICAgICAibWFzcyI6IC0xOS4wNDIxOTkwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJSPkkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXJnPklsZSIsCiAgICAgICAgICAgICJtYXNzIjogLTQzLjAxNzA0NzAwMDAwMDAwNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJSPkwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXJnPkxldSIsCiAgICAgICAgICAgICJtYXNzIjogLTQzLjAxNzA0NzAwMDAwMDAwNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJSPksiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXJnPkx5cyIsCiAgICAgICAgICAgICJtYXNzIjogLTI4LjAwNjE0Nzk5OTk5OTk5NgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJSPk0iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXJnPk1ldCIsCiAgICAgICAgICAgICJtYXNzIjogLTI1LjA2MDYyNjAwMDAwMDAxMwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJSPkYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXJnPlBoZSIsCiAgICAgICAgICAgICJtYXNzIjogLTkuMDMyNjk3MDAwMDAwMDEzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlI+UCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBcmc+UHJvIiwKICAgICAgICAgICAgIm1hc3MiOiAtNTkuMDQ4MzQ3MDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUj5TIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFyZz5TZXIiLAogICAgICAgICAgICAibWFzcyI6IC02OS4wNjkwODMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUj5UIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFyZz5UaHIiLAogICAgICAgICAgICAibWFzcyI6IC01NS4wNTM0MzIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUj5XIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFyZz5UcnAiLAogICAgICAgICAgICAibWFzcyI6IDI5Ljk3ODIwMjAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlI+WSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBcmc+VHlyIiwKICAgICAgICAgICAgIm1hc3MiOiA2Ljk2MjIwOTAwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJSPlYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXJnPlZhbCIsCiAgICAgICAgICAgICJtYXNzIjogLTU3LjAzMjY5NwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJOPkEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNuPkFsYSIsCiAgICAgICAgICAgICJtYXNzIjogLTQzLjAwNTgxMwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJOPlIiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNuPkFyZyIsCiAgICAgICAgICAgICJtYXNzIjogNDIuMDU4MTg0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk4+RCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBc24+QXNwIiwKICAgICAgICAgICAgIm1hc3MiOiAwLjk4NDAxNTk5OTk5OTk5NjkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTj5DIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFzbj5DeXMiLAogICAgICAgICAgICAibWFzcyI6IC0xMS4wMzM3NDIwMDAwMDAwMDQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTj5FIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFzbj5HbHUiLAogICAgICAgICAgICAibWFzcyI6IDE0Ljk5OTY2NjAwMDAwMDAwNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJOPlEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNuPkdsbiIsCiAgICAgICAgICAgICJtYXNzIjogMTQuMDE1NjUxMDAwMDAwMDA1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk4+RyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBc24+R2x5IiwKICAgICAgICAgICAgIm1hc3MiOiAtNTcuMDIxNDYzMDAwMDAwMDA0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk4+SCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBc24+SGlzIiwKICAgICAgICAgICAgIm1hc3MiOiAyMy4wMTU5ODQ5OTk5OTk5ODYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTj5JIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFzbj5JbGUiLAogICAgICAgICAgICAibWFzcyI6IC0wLjk1ODg2MzAwMDAwMDAwOAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJOPkwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNuPkxldSIsCiAgICAgICAgICAgICJtYXNzIjogLTAuOTU4ODYzMDAwMDAwMDA4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk4+SyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBc24+THlzIiwKICAgICAgICAgICAgIm1hc3MiOiAxNC4wNTIwMzYwMDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTj5NIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFzbj5NZXQiLAogICAgICAgICAgICAibWFzcyI6IDE2Ljk5NzU1Nzk5OTk5OTk4NAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJOPkYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNuPlBoZSIsCiAgICAgICAgICAgICJtYXNzIjogMzMuMDI1NDg2OTk5OTk5OTg0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk4+UCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBc24+UHJvIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTYuOTkwMTYzMDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTj5TIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFzbj5TZXIiLAogICAgICAgICAgICAibWFzcyI6IC0yNy4wMTA4OTkwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJOPlQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNuPlRociIsCiAgICAgICAgICAgICJtYXNzIjogLTEyLjk5NTI0ODAwMDAwMDAwNAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJOPlciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNuPlRycCIsCiAgICAgICAgICAgICJtYXNzIjogNzIuMDM2Mzg2MDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTj5ZIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFzbj5UeXIiLAogICAgICAgICAgICAibWFzcyI6IDQ5LjAyMDM5MwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJOPlYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNuPlZhbCIsCiAgICAgICAgICAgICJtYXNzIjogLTE0Ljk3NDUxMzAwMDAwMDAwMgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJEPkEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNwPkFsYSIsCiAgICAgICAgICAgICJtYXNzIjogLTQzLjk4OTgyOQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJEPlIiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNwPkFyZyIsCiAgICAgICAgICAgICJtYXNzIjogNDEuMDc0MTY4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkQ+TiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBc3A+QXNuIiwKICAgICAgICAgICAgIm1hc3MiOiAtMC45ODQwMTU5OTk5OTk5OTY5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkQ+QyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBc3A+Q3lzIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTIuMDE3NzU4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkQ+RSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBc3A+R2x1IiwKICAgICAgICAgICAgIm1hc3MiOiAxNC4wMTU2NTAwMDAwMDAwMDgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRD5RIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFzcD5HbG4iLAogICAgICAgICAgICAibWFzcyI6IDEzLjAzMTYzNTAwMDAwMDAwOQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJEPkciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNwPkdseSIsCiAgICAgICAgICAgICJtYXNzIjogLTU4LjAwNTQ3OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJEPkgiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNwPkhpcyIsCiAgICAgICAgICAgICJtYXNzIjogMjIuMDMxOTY4OTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRD5JIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFzcD5JbGUiLAogICAgICAgICAgICAibWFzcyI6IC0xLjk0Mjg3OTAwMDAwMDAwNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJEPkwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNwPkxldSIsCiAgICAgICAgICAgICJtYXNzIjogLTEuOTQyODc5MDAwMDAwMDA1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkQ+SyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBc3A+THlzIiwKICAgICAgICAgICAgIm1hc3MiOiAxMy4wNjgwMjAwMDAwMDAwMDQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRD5NIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFzcD5NZXQiLAogICAgICAgICAgICAibWFzcyI6IDE2LjAxMzU0MTk5OTk5OTk4NwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJEPkYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNwPlBoZSIsCiAgICAgICAgICAgICJtYXNzIjogMzIuMDQxNDcwOTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRD5QIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFzcD5Qcm8iLAogICAgICAgICAgICAibWFzcyI6IC0xNy45NzQxNzkwMDAwMDAwMDcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRD5TIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFzcD5TZXIiLAogICAgICAgICAgICAibWFzcyI6IC0yNy45OTQ5MTUwMDAwMDAwMDYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRD5UIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFzcD5UaHIiLAogICAgICAgICAgICAibWFzcyI6IC0xMy45NzkyNjQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRD5XIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFzcD5UcnAiLAogICAgICAgICAgICAibWFzcyI6IDcxLjA1MjM3MDAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkQ+WSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBc3A+VHlyIiwKICAgICAgICAgICAgIm1hc3MiOiA0OC4wMzYzNzcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRD5WIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFzcD5WYWwiLAogICAgICAgICAgICAibWFzcyI6IC0xNS45NTg1Mjg5OTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQz5BIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkN5cz5BbGEiLAogICAgICAgICAgICAibWFzcyI6IC0zMS45NzIwNzEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQz5SIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkN5cz5BcmciLAogICAgICAgICAgICAibWFzcyI6IDUzLjA5MTkyNgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJDPk4iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQ3lzPkFzbiIsCiAgICAgICAgICAgICJtYXNzIjogMTEuMDMzNzQyMDAwMDAwMDA0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkM+RCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJDeXM+QXNwIiwKICAgICAgICAgICAgIm1hc3MiOiAxMi4wMTc3NTgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQz5FIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkN5cz5HbHUiLAogICAgICAgICAgICAibWFzcyI6IDI2LjAzMzQwODAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkM+USIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJDeXM+R2xuIiwKICAgICAgICAgICAgIm1hc3MiOiAyNS4wNDkzOTMwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJDPkciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQ3lzPkdseSIsCiAgICAgICAgICAgICJtYXNzIjogLTQ1Ljk4NzcyMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJDPkgiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQ3lzPkhpcyIsCiAgICAgICAgICAgICJtYXNzIjogMzQuMDQ5NzI2OTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQz5JIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkN5cz5JbGUiLAogICAgICAgICAgICAibWFzcyI6IDEwLjA3NDg3ODk5OTk5OTk5NgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJDPkwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQ3lzPkxldSIsCiAgICAgICAgICAgICJtYXNzIjogMTAuMDc0ODc4OTk5OTk5OTk2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkM+SyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJDeXM+THlzIiwKICAgICAgICAgICAgIm1hc3MiOiAyNS4wODU3NzgwMDAwMDAwMDUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQz5NIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkN5cz5NZXQiLAogICAgICAgICAgICAibWFzcyI6IDI4LjAzMTI5OTk5OTk5OTk4NwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJDPkYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQ3lzPlBoZSIsCiAgICAgICAgICAgICJtYXNzIjogNDQuMDU5MjI4OTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQz5QIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkN5cz5Qcm8iLAogICAgICAgICAgICAibWFzcyI6IC01Ljk1NjQyMTAwMDAwMDAwNgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJDPlMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQ3lzPlNlciIsCiAgICAgICAgICAgICJtYXNzIjogLTE1Ljk3NzE1NzAwMDAwMDAwNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJDPlQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQ3lzPlRociIsCiAgICAgICAgICAgICJtYXNzIjogLTEuOTYxNTA2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkM+VyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJDeXM+VHJwIiwKICAgICAgICAgICAgIm1hc3MiOiA4My4wNzAxMjgwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJDPlkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQ3lzPlR5ciIsCiAgICAgICAgICAgICJtYXNzIjogNjAuMDU0MTM1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkM+ViIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJDeXM+VmFsIiwKICAgICAgICAgICAgIm1hc3MiOiAtMy45NDA3NzA5OTk5OTk5OTgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRT5BIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsdT5BbGEiLAogICAgICAgICAgICAibWFzcyI6IC01OC4wMDU0NzkwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJFPlIiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2x1PkFyZyIsCiAgICAgICAgICAgICJtYXNzIjogMjcuMDU4NTE3OTk5OTk5OTkyCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkU+TiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbHU+QXNuIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTQuOTk5NjY2MDAwMDAwMDA1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkU+RCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbHU+QXNwIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTQuMDE1NjUwMDAwMDAwMDA4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkU+QyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbHU+Q3lzIiwKICAgICAgICAgICAgIm1hc3MiOiAtMjYuMDMzNDA4MDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRT5RIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsdT5HbG4iLAogICAgICAgICAgICAibWFzcyI6IC0wLjk4NDAxNDk5OTk5OTk5OTQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRT5HIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsdT5HbHkiLAogICAgICAgICAgICAibWFzcyI6IC03Mi4wMjExMjkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRT5IIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsdT5IaXMiLAogICAgICAgICAgICAibWFzcyI6IDguMDE2MzE4OTk5OTk5OTgyCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkU+SSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbHU+SWxlIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTUuOTU4NTI5MDAwMDAwMDEzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkU+TCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbHU+TGV1IiwKICAgICAgICAgICAgIm1hc3MiOiAtMTUuOTU4NTI5MDAwMDAwMDEzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkU+SyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbHU+THlzIiwKICAgICAgICAgICAgIm1hc3MiOiAtMC45NDc2MzAwMDAwMDAwMDM3CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkU+TSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbHU+TWV0IiwKICAgICAgICAgICAgIm1hc3MiOiAxLjk5Nzg5MTk5OTk5OTk3OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJFPkYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2x1PlBoZSIsCiAgICAgICAgICAgICJtYXNzIjogMTguMDI1ODIwOTk5OTk5OTgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRT5QIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsdT5Qcm8iLAogICAgICAgICAgICAibWFzcyI6IC0zMS45ODk4MjkwMDAwMDAwMTUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRT5TIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsdT5TZXIiLAogICAgICAgICAgICAibWFzcyI6IC00Mi4wMTA1NjUwMDAwMDAwMTQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRT5UIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsdT5UaHIiLAogICAgICAgICAgICAibWFzcyI6IC0yNy45OTQ5MTQwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJFPlciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2x1PlRycCIsCiAgICAgICAgICAgICJtYXNzIjogNTcuMDM2NzIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRT5ZIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsdT5UeXIiLAogICAgICAgICAgICAibWFzcyI6IDM0LjAyMDcyNjk5OTk5OTk5NAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJFPlYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2x1PlZhbCIsCiAgICAgICAgICAgICJtYXNzIjogLTI5Ljk3NDE3OTAwMDAwMDAwNwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJRPkEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2xuPkFsYSIsCiAgICAgICAgICAgICJtYXNzIjogLTU3LjAyMTQ2NDAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlE+UiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbG4+QXJnIiwKICAgICAgICAgICAgIm1hc3MiOiAyOC4wNDI1MzI5OTk5OTk5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJRPk4iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2xuPkFzbiIsCiAgICAgICAgICAgICJtYXNzIjogLTE0LjAxNTY1MTAwMDAwMDAwNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJRPkQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2xuPkFzcCIsCiAgICAgICAgICAgICJtYXNzIjogLTEzLjAzMTYzNTAwMDAwMDAwOQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJRPkMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2xuPkN5cyIsCiAgICAgICAgICAgICJtYXNzIjogLTI1LjA0OTM5MzAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlE+RSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbG4+R2x1IiwKICAgICAgICAgICAgIm1hc3MiOiAwLjk4NDAxNDk5OTk5OTk5OTQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUT5HIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsbj5HbHkiLAogICAgICAgICAgICAibWFzcyI6IC03MS4wMzcxMTQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUT5IIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsbj5IaXMiLAogICAgICAgICAgICAibWFzcyI6IDkuMDAwMzMzOTk5OTk5OTgxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlE+SSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbG4+SWxlIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTQuOTc0NTE0MDAwMDAwMDEzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlE+TCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbG4+TGV1IiwKICAgICAgICAgICAgIm1hc3MiOiAtMTQuOTc0NTE0MDAwMDAwMDEzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlE+SyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbG4+THlzIiwKICAgICAgICAgICAgIm1hc3MiOiAwLjAzNjM4NDk5OTk5OTk5NTY3CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlE+TSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbG4+TWV0IiwKICAgICAgICAgICAgIm1hc3MiOiAyLjk4MTkwNjk5OTk5OTk3ODMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUT5GIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsbj5QaGUiLAogICAgICAgICAgICAibWFzcyI6IDE5LjAwOTgzNTk5OTk5OTk4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlE+UCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbG4+UHJvIiwKICAgICAgICAgICAgIm1hc3MiOiAtMzEuMDA1ODE0MDAwMDAwMDE1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlE+UyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbG4+U2VyIiwKICAgICAgICAgICAgIm1hc3MiOiAtNDEuMDI2NTUwMDAwMDAwMDE1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlE+VCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbG4+VGhyIiwKICAgICAgICAgICAgIm1hc3MiOiAtMjcuMDEwODk5MDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUT5XIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsbj5UcnAiLAogICAgICAgICAgICAibWFzcyI6IDU4LjAyMDczNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJRPlkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2xuPlR5ciIsCiAgICAgICAgICAgICJtYXNzIjogMzUuMDA0NzQxOTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUT5WIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsbj5WYWwiLAogICAgICAgICAgICAibWFzcyI6IC0yOC45OTAxNjQwMDAwMDAwMDcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRz5BIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdseT5BbGEiLAogICAgICAgICAgICAibWFzcyI6IDE0LjAxNTY1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkc+UiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbHk+QXJnIiwKICAgICAgICAgICAgIm1hc3MiOiA5OS4wNzk2NDcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRz5OIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdseT5Bc24iLAogICAgICAgICAgICAibWFzcyI6IDU3LjAyMTQ2MzAwMDAwMDAwNAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJHPkQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2x5PkFzcCIsCiAgICAgICAgICAgICJtYXNzIjogNTguMDA1NDc5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkc+QyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbHk+Q3lzIiwKICAgICAgICAgICAgIm1hc3MiOiA0NS45ODc3MjEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRz5FIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdseT5HbHUiLAogICAgICAgICAgICAibWFzcyI6IDcyLjAyMTEyOQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJHPlEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2x5PkdsbiIsCiAgICAgICAgICAgICJtYXNzIjogNzEuMDM3MTE0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkc+SCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbHk+SGlzIiwKICAgICAgICAgICAgIm1hc3MiOiA4MC4wMzc0NDc5OTk5OTk5OAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJHPkkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2x5PklsZSIsCiAgICAgICAgICAgICJtYXNzIjogNTYuMDYyNTk5OTk5OTk5OTk2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkc+TCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbHk+TGV1IiwKICAgICAgICAgICAgIm1hc3MiOiA1Ni4wNjI1OTk5OTk5OTk5OTYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRz5LIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdseT5MeXMiLAogICAgICAgICAgICAibWFzcyI6IDcxLjA3MzQ5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJHPk0iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2x5Pk1ldCIsCiAgICAgICAgICAgICJtYXNzIjogNzQuMDE5MDIwOTk5OTk5OTgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRz5GIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdseT5QaGUiLAogICAgICAgICAgICAibWFzcyI6IDkwLjA0Njk0OTk5OTk5OTk4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkc+UCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbHk+UHJvIiwKICAgICAgICAgICAgIm1hc3MiOiA0MC4wMzEyOTk5OTk5OTk5OTUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRz5TIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdseT5TZXIiLAogICAgICAgICAgICAibWFzcyI6IDMwLjAxMDU2Mzk5OTk5OTk5NQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJHPlQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2x5PlRociIsCiAgICAgICAgICAgICJtYXNzIjogNDQuMDI2MjE1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkc+VyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbHk+VHJwIiwKICAgICAgICAgICAgIm1hc3MiOiAxMjkuMDU3ODQ5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkc+WSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbHk+VHlyIiwKICAgICAgICAgICAgIm1hc3MiOiAxMDYuMDQxODU2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkc+ViIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbHk+VmFsIiwKICAgICAgICAgICAgIm1hc3MiOiA0Mi4wNDY5NQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJIPkEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSGlzPkFsYSIsCiAgICAgICAgICAgICJtYXNzIjogLTY2LjAyMTc5Nzk5OTk5OTk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkg+UiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJIaXM+QXJnIiwKICAgICAgICAgICAgIm1hc3MiOiAxOS4wNDIxOTkwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJIPk4iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSGlzPkFzbiIsCiAgICAgICAgICAgICJtYXNzIjogLTIzLjAxNTk4NDk5OTk5OTk4NgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJIPkQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSGlzPkFzcCIsCiAgICAgICAgICAgICJtYXNzIjogLTIyLjAzMTk2ODk5OTk5OTk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkg+QyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJIaXM+Q3lzIiwKICAgICAgICAgICAgIm1hc3MiOiAtMzQuMDQ5NzI2OTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSD5FIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkhpcz5HbHUiLAogICAgICAgICAgICAibWFzcyI6IC04LjAxNjMxODk5OTk5OTk4MgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJIPlEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSGlzPkdsbiIsCiAgICAgICAgICAgICJtYXNzIjogLTkuMDAwMzMzOTk5OTk5OTgxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkg+RyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJIaXM+R2x5IiwKICAgICAgICAgICAgIm1hc3MiOiAtODAuMDM3NDQ3OTk5OTk5OTgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSD5JIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkhpcz5JbGUiLAogICAgICAgICAgICAibWFzcyI6IC0yMy45NzQ4NDc5OTk5OTk5OTQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSD5MIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkhpcz5MZXUiLAogICAgICAgICAgICAibWFzcyI6IC0yMy45NzQ4NDc5OTk5OTk5OTQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSD5LIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkhpcz5MeXMiLAogICAgICAgICAgICAibWFzcyI6IC04Ljk2Mzk0ODk5OTk5OTk4NQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJIPk0iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSGlzPk1ldCIsCiAgICAgICAgICAgICJtYXNzIjogLTYuMDE4NDI3MDAwMDAwMDAzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkg+RiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJIaXM+UGhlIiwKICAgICAgICAgICAgIm1hc3MiOiAxMC4wMDk1MDE5OTk5OTk5OTgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSD5QIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkhpcz5Qcm8iLAogICAgICAgICAgICAibWFzcyI6IC00MC4wMDYxNDc5OTk5OTk5OTYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSD5TIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkhpcz5TZXIiLAogICAgICAgICAgICAibWFzcyI6IC01MC4wMjY4ODM5OTk5OTk5OTUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSD5UIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkhpcz5UaHIiLAogICAgICAgICAgICAibWFzcyI6IC0zNi4wMTEyMzI5OTk5OTk5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJIPlciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSGlzPlRycCIsCiAgICAgICAgICAgICJtYXNzIjogNDkuMDIwNDAxMDAwMDAwMDIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSD5ZIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkhpcz5UeXIiLAogICAgICAgICAgICAibWFzcyI6IDI2LjAwNDQwODAwMDAwMDAxMgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJIPlYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSGlzPlZhbCIsCiAgICAgICAgICAgICJtYXNzIjogLTM3Ljk5MDQ5Nzk5OTk5OTk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkk+QSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJJbGU+QWxhIiwKICAgICAgICAgICAgIm1hc3MiOiAtNDIuMDQ2OTQ5OTk5OTk5OTk1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkk+UiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJJbGU+QXJnIiwKICAgICAgICAgICAgIm1hc3MiOiA0My4wMTcwNDcwMDAwMDAwMDUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiST5OIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIklsZT5Bc24iLAogICAgICAgICAgICAibWFzcyI6IDAuOTU4ODYzMDAwMDAwMDA4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkk+RCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJJbGU+QXNwIiwKICAgICAgICAgICAgIm1hc3MiOiAxLjk0Mjg3OTAwMDAwMDAwNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJJPkMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSWxlPkN5cyIsCiAgICAgICAgICAgICJtYXNzIjogLTEwLjA3NDg3ODk5OTk5OTk5NgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJJPkUiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSWxlPkdsdSIsCiAgICAgICAgICAgICJtYXNzIjogMTUuOTU4NTI5MDAwMDAwMDEzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkk+USIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJJbGU+R2xuIiwKICAgICAgICAgICAgIm1hc3MiOiAxNC45NzQ1MTQwMDAwMDAwMTMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiST5HIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIklsZT5HbHkiLAogICAgICAgICAgICAibWFzcyI6IC01Ni4wNjI1OTk5OTk5OTk5OTYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiST5IIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIklsZT5IaXMiLAogICAgICAgICAgICAibWFzcyI6IDIzLjk3NDg0Nzk5OTk5OTk5NAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJJPkwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSWxlPkxldSIsCiAgICAgICAgICAgICJtYXNzIjogMAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJJPksiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSWxlPkx5cyIsCiAgICAgICAgICAgICJtYXNzIjogMTUuMDEwODk5MDAwMDAwMDA5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkk+TSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJJbGU+TWV0IiwKICAgICAgICAgICAgIm1hc3MiOiAxNy45NTY0MjA5OTk5OTk5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJJPkYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSWxlPlBoZSIsCiAgICAgICAgICAgICJtYXNzIjogMzMuOTg0MzQ5OTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiST5QIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIklsZT5Qcm8iLAogICAgICAgICAgICAibWFzcyI6IC0xNi4wMzEzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkk+UyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJJbGU+U2VyIiwKICAgICAgICAgICAgIm1hc3MiOiAtMjYuMDUyMDM2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkk+VCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJJbGU+VGhyIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTIuMDM2Mzg0OTk5OTk5OTk2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkk+VyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJJbGU+VHJwIiwKICAgICAgICAgICAgIm1hc3MiOiA3Mi45OTUyNDkwMDAwMDAwMgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJJPlkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSWxlPlR5ciIsCiAgICAgICAgICAgICJtYXNzIjogNDkuOTc5MjU2MDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiST5WIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIklsZT5WYWwiLAogICAgICAgICAgICAibWFzcyI6IC0xNC4wMTU2NDk5OTk5OTk5OTQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTD5BIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkxldT5BbGEiLAogICAgICAgICAgICAibWFzcyI6IC00Mi4wNDY5NDk5OTk5OTk5OTUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTD5SIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkxldT5BcmciLAogICAgICAgICAgICAibWFzcyI6IDQzLjAxNzA0NzAwMDAwMDAwNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJMPk4iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTGV1PkFzbiIsCiAgICAgICAgICAgICJtYXNzIjogMC45NTg4NjMwMDAwMDAwMDgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTD5EIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkxldT5Bc3AiLAogICAgICAgICAgICAibWFzcyI6IDEuOTQyODc5MDAwMDAwMDA1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkw+QyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMZXU+Q3lzIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTAuMDc0ODc4OTk5OTk5OTk2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkw+RSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMZXU+R2x1IiwKICAgICAgICAgICAgIm1hc3MiOiAxNS45NTg1MjkwMDAwMDAwMTMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTD5RIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkxldT5HbG4iLAogICAgICAgICAgICAibWFzcyI6IDE0Ljk3NDUxNDAwMDAwMDAxMwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJMPkciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTGV1PkdseSIsCiAgICAgICAgICAgICJtYXNzIjogLTU2LjA2MjU5OTk5OTk5OTk5NgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJMPkgiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTGV1PkhpcyIsCiAgICAgICAgICAgICJtYXNzIjogMjMuOTc0ODQ3OTk5OTk5OTk0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkw+SSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMZXU+SWxlIiwKICAgICAgICAgICAgIm1hc3MiOiAwCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkw+SyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMZXU+THlzIiwKICAgICAgICAgICAgIm1hc3MiOiAxNS4wMTA4OTkwMDAwMDAwMDkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTD5NIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkxldT5NZXQiLAogICAgICAgICAgICAibWFzcyI6IDE3Ljk1NjQyMDk5OTk5OTk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkw+RiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMZXU+UGhlIiwKICAgICAgICAgICAgIm1hc3MiOiAzMy45ODQzNDk5OTk5OTk5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJMPlAiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTGV1PlBybyIsCiAgICAgICAgICAgICJtYXNzIjogLTE2LjAzMTMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTD5TIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkxldT5TZXIiLAogICAgICAgICAgICAibWFzcyI6IC0yNi4wNTIwMzYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTD5UIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkxldT5UaHIiLAogICAgICAgICAgICAibWFzcyI6IC0xMi4wMzYzODQ5OTk5OTk5OTYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTD5XIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkxldT5UcnAiLAogICAgICAgICAgICAibWFzcyI6IDcyLjk5NTI0OTAwMDAwMDAyCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkw+WSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMZXU+VHlyIiwKICAgICAgICAgICAgIm1hc3MiOiA0OS45NzkyNTYwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJMPlYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTGV1PlZhbCIsCiAgICAgICAgICAgICJtYXNzIjogLTE0LjAxNTY0OTk5OTk5OTk5NAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJLPkEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTHlzPkFsYSIsCiAgICAgICAgICAgICJtYXNzIjogLTU3LjA1Nzg0OTAwMDAwMDAwNAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJLPlIiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTHlzPkFyZyIsCiAgICAgICAgICAgICJtYXNzIjogMjguMDA2MTQ3OTk5OTk5OTk2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIks+TiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMeXM+QXNuIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTQuMDUyMDM2MDAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIks+RCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMeXM+QXNwIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTMuMDY4MDIwMDAwMDAwMDA0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIks+QyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMeXM+Q3lzIiwKICAgICAgICAgICAgIm1hc3MiOiAtMjUuMDg1Nzc4MDAwMDAwMDA1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIks+RSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMeXM+R2x1IiwKICAgICAgICAgICAgIm1hc3MiOiAwLjk0NzYzMDAwMDAwMDAwMzcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSz5RIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkx5cz5HbG4iLAogICAgICAgICAgICAibWFzcyI6IC0wLjAzNjM4NDk5OTk5OTk5NTY3CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIks+RyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMeXM+R2x5IiwKICAgICAgICAgICAgIm1hc3MiOiAtNzEuMDczNDk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIks+SCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMeXM+SGlzIiwKICAgICAgICAgICAgIm1hc3MiOiA4Ljk2Mzk0ODk5OTk5OTk4NQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJLPkkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTHlzPklsZSIsCiAgICAgICAgICAgICJtYXNzIjogLTE1LjAxMDg5OTAwMDAwMDAwOQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJLPkwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTHlzPkxldSIsCiAgICAgICAgICAgICJtYXNzIjogLTE1LjAxMDg5OTAwMDAwMDAwOQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJLPk0iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTHlzPk1ldCIsCiAgICAgICAgICAgICJtYXNzIjogMi45NDU1MjE5OTk5OTk5ODI3CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIks+RiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMeXM+UGhlIiwKICAgICAgICAgICAgIm1hc3MiOiAxOC45NzM0NTA5OTk5OTk5ODMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSz5QIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkx5cz5Qcm8iLAogICAgICAgICAgICAibWFzcyI6IC0zMS4wNDIxOTkwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJLPlMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTHlzPlNlciIsCiAgICAgICAgICAgICJtYXNzIjogLTQxLjA2MjkzNTAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIks+VCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMeXM+VGhyIiwKICAgICAgICAgICAgIm1hc3MiOiAtMjcuMDQ3Mjg0MDAwMDAwMDA1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIks+VyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMeXM+VHJwIiwKICAgICAgICAgICAgIm1hc3MiOiA1Ny45ODQzNTAwMDAwMDAwMDYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSz5ZIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkx5cz5UeXIiLAogICAgICAgICAgICAibWFzcyI6IDM0Ljk2ODM1NwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJLPlYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTHlzPlZhbCIsCiAgICAgICAgICAgICJtYXNzIjogLTI5LjAyNjU0OTAwMDAwMDAwMwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJNPkEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTWV0PkFsYSIsCiAgICAgICAgICAgICJtYXNzIjogLTYwLjAwMzM3MDk5OTk5OTk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk0+UiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJNZXQ+QXJnIiwKICAgICAgICAgICAgIm1hc3MiOiAyNS4wNjA2MjYwMDAwMDAwMTMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTT5OIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIk1ldD5Bc24iLAogICAgICAgICAgICAibWFzcyI6IC0xNi45OTc1NTc5OTk5OTk5ODQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTT5EIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIk1ldD5Bc3AiLAogICAgICAgICAgICAibWFzcyI6IC0xNi4wMTM1NDE5OTk5OTk5ODcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTT5DIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIk1ldD5DeXMiLAogICAgICAgICAgICAibWFzcyI6IC0yOC4wMzEyOTk5OTk5OTk5ODcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTT5FIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIk1ldD5HbHUiLAogICAgICAgICAgICAibWFzcyI6IC0xLjk5Nzg5MTk5OTk5OTk3OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJNPlEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTWV0PkdsbiIsCiAgICAgICAgICAgICJtYXNzIjogLTIuOTgxOTA2OTk5OTk5OTc4MwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJNPkciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTWV0PkdseSIsCiAgICAgICAgICAgICJtYXNzIjogLTc0LjAxOTAyMDk5OTk5OTk4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk0+SCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJNZXQ+SGlzIiwKICAgICAgICAgICAgIm1hc3MiOiA2LjAxODQyNzAwMDAwMDAwMwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJNPkkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTWV0PklsZSIsCiAgICAgICAgICAgICJtYXNzIjogLTE3Ljk1NjQyMDk5OTk5OTk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk0+TCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJNZXQ+TGV1IiwKICAgICAgICAgICAgIm1hc3MiOiAtMTcuOTU2NDIwOTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTT5LIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIk1ldD5MeXMiLAogICAgICAgICAgICAibWFzcyI6IC0yLjk0NTUyMTk5OTk5OTk4MjcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTT5GIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIk1ldD5QaGUiLAogICAgICAgICAgICAibWFzcyI6IDE2LjAyNzkyOQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJNPlAiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTWV0PlBybyIsCiAgICAgICAgICAgICJtYXNzIjogLTMzLjk4NzcyMDk5OTk5OTk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk0+UyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJNZXQ+U2VyIiwKICAgICAgICAgICAgIm1hc3MiOiAtNDQuMDA4NDU2OTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTT5UIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIk1ldD5UaHIiLAogICAgICAgICAgICAibWFzcyI6IC0yOS45OTI4MDU5OTk5OTk5ODcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTT5XIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIk1ldD5UcnAiLAogICAgICAgICAgICAibWFzcyI6IDU1LjAzODgyODAwMDAwMDAyNAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJNPlkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTWV0PlR5ciIsCiAgICAgICAgICAgICJtYXNzIjogMzIuMDIyODM1MDAwMDAwMDE1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk0+ViIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJNZXQ+VmFsIiwKICAgICAgICAgICAgIm1hc3MiOiAtMzEuOTcyMDcwOTk5OTk5OTg1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkY+QSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQaGU+QWxhIiwKICAgICAgICAgICAgIm1hc3MiOiAtNzYuMDMxMjk5OTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRj5SIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBoZT5BcmciLAogICAgICAgICAgICAibWFzcyI6IDkuMDMyNjk3MDAwMDAwMDEzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkY+TiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQaGU+QXNuIiwKICAgICAgICAgICAgIm1hc3MiOiAtMzMuMDI1NDg2OTk5OTk5OTg0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkY+RCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQaGU+QXNwIiwKICAgICAgICAgICAgIm1hc3MiOiAtMzIuMDQxNDcwOTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRj5DIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBoZT5DeXMiLAogICAgICAgICAgICAibWFzcyI6IC00NC4wNTkyMjg5OTk5OTk5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJGPkUiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUGhlPkdsdSIsCiAgICAgICAgICAgICJtYXNzIjogLTE4LjAyNTgyMDk5OTk5OTk4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkY+USIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQaGU+R2xuIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTkuMDA5ODM1OTk5OTk5OTgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRj5HIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBoZT5HbHkiLAogICAgICAgICAgICAibWFzcyI6IC05MC4wNDY5NDk5OTk5OTk5OAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJGPkgiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUGhlPkhpcyIsCiAgICAgICAgICAgICJtYXNzIjogLTEwLjAwOTUwMTk5OTk5OTk5OAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJGPkkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUGhlPklsZSIsCiAgICAgICAgICAgICJtYXNzIjogLTMzLjk4NDM0OTk5OTk5OTk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkY+TCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQaGU+TGV1IiwKICAgICAgICAgICAgIm1hc3MiOiAtMzMuOTg0MzQ5OTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRj5LIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBoZT5MeXMiLAogICAgICAgICAgICAibWFzcyI6IC0xOC45NzM0NTA5OTk5OTk5ODMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRj5NIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBoZT5NZXQiLAogICAgICAgICAgICAibWFzcyI6IC0xNi4wMjc5MjkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRj5QIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBoZT5Qcm8iLAogICAgICAgICAgICAibWFzcyI6IC01MC4wMTU2NDk5OTk5OTk5OTQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRj5TIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBoZT5TZXIiLAogICAgICAgICAgICAibWFzcyI6IC02MC4wMzYzODU5OTk5OTk5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJGPlQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUGhlPlRociIsCiAgICAgICAgICAgICJtYXNzIjogLTQ2LjAyMDczNDk5OTk5OTk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkY+VyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQaGU+VHJwIiwKICAgICAgICAgICAgIm1hc3MiOiAzOS4wMTA4OTkwMDAwMDAwMgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJGPlkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUGhlPlR5ciIsCiAgICAgICAgICAgICJtYXNzIjogMTUuOTk0OTA2MDAwMDAwMDE1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkY+ViIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQaGU+VmFsIiwKICAgICAgICAgICAgIm1hc3MiOiAtNDcuOTk5OTk5OTk5OTk5OTg2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlA+QSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQcm8+QWxhIiwKICAgICAgICAgICAgIm1hc3MiOiAtMjYuMDE1NjQ5OTk5OTk5OTk0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlA+UiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQcm8+QXJnIiwKICAgICAgICAgICAgIm1hc3MiOiA1OS4wNDgzNDcwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJQPk4iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUHJvPkFzbiIsCiAgICAgICAgICAgICJtYXNzIjogMTYuOTkwMTYzMDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUD5EIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBybz5Bc3AiLAogICAgICAgICAgICAibWFzcyI6IDE3Ljk3NDE3OTAwMDAwMDAwNwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJQPkMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUHJvPkN5cyIsCiAgICAgICAgICAgICJtYXNzIjogNS45NTY0MjEwMDAwMDAwMDYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUD5FIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBybz5HbHUiLAogICAgICAgICAgICAibWFzcyI6IDMxLjk4OTgyOTAwMDAwMDAxNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJQPlEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUHJvPkdsbiIsCiAgICAgICAgICAgICJtYXNzIjogMzEuMDA1ODE0MDAwMDAwMDE1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlA+RyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQcm8+R2x5IiwKICAgICAgICAgICAgIm1hc3MiOiAtNDAuMDMxMjk5OTk5OTk5OTk1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlA+SCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQcm8+SGlzIiwKICAgICAgICAgICAgIm1hc3MiOiA0MC4wMDYxNDc5OTk5OTk5OTYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUD5JIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBybz5JbGUiLAogICAgICAgICAgICAibWFzcyI6IDE2LjAzMTMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUD5MIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBybz5MZXUiLAogICAgICAgICAgICAibWFzcyI6IDE2LjAzMTMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUD5LIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBybz5MeXMiLAogICAgICAgICAgICAibWFzcyI6IDMxLjA0MjE5OTAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlA+TSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQcm8+TWV0IiwKICAgICAgICAgICAgIm1hc3MiOiAzMy45ODc3MjA5OTk5OTk5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJQPkYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUHJvPlBoZSIsCiAgICAgICAgICAgICJtYXNzIjogNTAuMDE1NjQ5OTk5OTk5OTk0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlA+UyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQcm8+U2VyIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTAuMDIwNzM2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlA+VCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQcm8+VGhyIiwKICAgICAgICAgICAgIm1hc3MiOiAzLjk5NDkxNTAwMDAwMDAwNgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJQPlciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUHJvPlRycCIsCiAgICAgICAgICAgICJtYXNzIjogODkuMDI2NTQ5MDAwMDAwMDIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUD5ZIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBybz5UeXIiLAogICAgICAgICAgICAibWFzcyI6IDY2LjAxMDU1NjAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlA+ViIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQcm8+VmFsIiwKICAgICAgICAgICAgIm1hc3MiOiAyLjAxNTY1MDAwMDAwMDAwOAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJTPkEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiU2VyPkFsYSIsCiAgICAgICAgICAgICJtYXNzIjogLTE1Ljk5NDkxMzk5OTk5OTk5NAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJTPlIiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiU2VyPkFyZyIsCiAgICAgICAgICAgICJtYXNzIjogNjkuMDY5MDgzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlM+TiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJTZXI+QXNuIiwKICAgICAgICAgICAgIm1hc3MiOiAyNy4wMTA4OTkwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJTPkQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiU2VyPkFzcCIsCiAgICAgICAgICAgICJtYXNzIjogMjcuOTk0OTE1MDAwMDAwMDA2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlM+QyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJTZXI+Q3lzIiwKICAgICAgICAgICAgIm1hc3MiOiAxNS45NzcxNTcwMDAwMDAwMDUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUz5FIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlNlcj5HbHUiLAogICAgICAgICAgICAibWFzcyI6IDQyLjAxMDU2NTAwMDAwMDAxNAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJTPlEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiU2VyPkdsbiIsCiAgICAgICAgICAgICJtYXNzIjogNDEuMDI2NTUwMDAwMDAwMDE1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlM+RyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJTZXI+R2x5IiwKICAgICAgICAgICAgIm1hc3MiOiAtMzAuMDEwNTYzOTk5OTk5OTk1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlM+SCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJTZXI+SGlzIiwKICAgICAgICAgICAgIm1hc3MiOiA1MC4wMjY4ODM5OTk5OTk5OTUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUz5JIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlNlcj5JbGUiLAogICAgICAgICAgICAibWFzcyI6IDI2LjA1MjAzNgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJTPkwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiU2VyPkxldSIsCiAgICAgICAgICAgICJtYXNzIjogMjYuMDUyMDM2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlM+SyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJTZXI+THlzIiwKICAgICAgICAgICAgIm1hc3MiOiA0MS4wNjI5MzUwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJTPk0iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiU2VyPk1ldCIsCiAgICAgICAgICAgICJtYXNzIjogNDQuMDA4NDU2OTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUz5GIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlNlcj5QaGUiLAogICAgICAgICAgICAibWFzcyI6IDYwLjAzNjM4NTk5OTk5OTk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlM+UCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJTZXI+UHJvIiwKICAgICAgICAgICAgIm1hc3MiOiAxMC4wMjA3MzYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUz5UIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlNlcj5UaHIiLAogICAgICAgICAgICAibWFzcyI6IDE0LjAxNTY1MTAwMDAwMDAwNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJTPlciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiU2VyPlRycCIsCiAgICAgICAgICAgICJtYXNzIjogOTkuMDQ3Mjg1MDAwMDAwMDIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUz5ZIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlNlcj5UeXIiLAogICAgICAgICAgICAibWFzcyI6IDc2LjAzMTI5MjAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlM+ViIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJTZXI+VmFsIiwKICAgICAgICAgICAgIm1hc3MiOiAxMi4wMzYzODYwMDAwMDAwMDcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVD5BIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRocj5BbGEiLAogICAgICAgICAgICAibWFzcyI6IC0zMC4wMTA1NjUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVD5SIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRocj5BcmciLAogICAgICAgICAgICAibWFzcyI6IDU1LjA1MzQzMgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJUPk4iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVGhyPkFzbiIsCiAgICAgICAgICAgICJtYXNzIjogMTIuOTk1MjQ4MDAwMDAwMDA0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlQ+RCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUaHI+QXNwIiwKICAgICAgICAgICAgIm1hc3MiOiAxMy45NzkyNjQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVD5DIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRocj5DeXMiLAogICAgICAgICAgICAibWFzcyI6IDEuOTYxNTA2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlQ+RSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUaHI+R2x1IiwKICAgICAgICAgICAgIm1hc3MiOiAyNy45OTQ5MTQwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJUPlEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVGhyPkdsbiIsCiAgICAgICAgICAgICJtYXNzIjogMjcuMDEwODk5MDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVD5HIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRocj5HbHkiLAogICAgICAgICAgICAibWFzcyI6IC00NC4wMjYyMTUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVD5IIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRocj5IaXMiLAogICAgICAgICAgICAibWFzcyI6IDM2LjAxMTIzMjk5OTk5OTk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlQ+SSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUaHI+SWxlIiwKICAgICAgICAgICAgIm1hc3MiOiAxMi4wMzYzODQ5OTk5OTk5OTYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVD5MIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRocj5MZXUiLAogICAgICAgICAgICAibWFzcyI6IDEyLjAzNjM4NDk5OTk5OTk5NgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJUPksiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVGhyPkx5cyIsCiAgICAgICAgICAgICJtYXNzIjogMjcuMDQ3Mjg0MDAwMDAwMDA1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlQ+TSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUaHI+TWV0IiwKICAgICAgICAgICAgIm1hc3MiOiAyOS45OTI4MDU5OTk5OTk5ODcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVD5GIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRocj5QaGUiLAogICAgICAgICAgICAibWFzcyI6IDQ2LjAyMDczNDk5OTk5OTk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlQ+UCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUaHI+UHJvIiwKICAgICAgICAgICAgIm1hc3MiOiAtMy45OTQ5MTUwMDAwMDAwMDYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVD5TIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRocj5TZXIiLAogICAgICAgICAgICAibWFzcyI6IC0xNC4wMTU2NTEwMDAwMDAwMDUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVD5XIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRocj5UcnAiLAogICAgICAgICAgICAibWFzcyI6IDg1LjAzMTYzNDAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlQ+WSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUaHI+VHlyIiwKICAgICAgICAgICAgIm1hc3MiOiA2Mi4wMTU2NDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVD5WIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRocj5WYWwiLAogICAgICAgICAgICAibWFzcyI6IC0xLjk3OTI2NDk5OTk5OTk5OAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJXPkEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVHJwPkFsYSIsCiAgICAgICAgICAgICJtYXNzIjogLTExNS4wNDIxOTkwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJXPlIiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVHJwPkFyZyIsCiAgICAgICAgICAgICJtYXNzIjogLTI5Ljk3ODIwMjAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlc+TiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUcnA+QXNuIiwKICAgICAgICAgICAgIm1hc3MiOiAtNzIuMDM2Mzg2MDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVz5EIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRycD5Bc3AiLAogICAgICAgICAgICAibWFzcyI6IC03MS4wNTIzNzAwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJXPkMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVHJwPkN5cyIsCiAgICAgICAgICAgICJtYXNzIjogLTgzLjA3MDEyODAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlc+RSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUcnA+R2x1IiwKICAgICAgICAgICAgIm1hc3MiOiAtNTcuMDM2NzIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVz5RIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRycD5HbG4iLAogICAgICAgICAgICAibWFzcyI6IC01OC4wMjA3MzUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVz5HIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRycD5HbHkiLAogICAgICAgICAgICAibWFzcyI6IC0xMjkuMDU3ODQ5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlc+SCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUcnA+SGlzIiwKICAgICAgICAgICAgIm1hc3MiOiAtNDkuMDIwNDAxMDAwMDAwMDIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVz5JIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRycD5JbGUiLAogICAgICAgICAgICAibWFzcyI6IC03Mi45OTUyNDkwMDAwMDAwMgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJXPkwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVHJwPkxldSIsCiAgICAgICAgICAgICJtYXNzIjogLTcyLjk5NTI0OTAwMDAwMDAyCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlc+SyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUcnA+THlzIiwKICAgICAgICAgICAgIm1hc3MiOiAtNTcuOTg0MzUwMDAwMDAwMDA2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlc+TSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUcnA+TWV0IiwKICAgICAgICAgICAgIm1hc3MiOiAtNTUuMDM4ODI4MDAwMDAwMDI0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlc+RiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUcnA+UGhlIiwKICAgICAgICAgICAgIm1hc3MiOiAtMzkuMDEwODk5MDAwMDAwMDIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVz5QIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRycD5Qcm8iLAogICAgICAgICAgICAibWFzcyI6IC04OS4wMjY1NDkwMDAwMDAwMgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJXPlMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVHJwPlNlciIsCiAgICAgICAgICAgICJtYXNzIjogLTk5LjA0NzI4NTAwMDAwMDAyCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlc+VCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUcnA+VGhyIiwKICAgICAgICAgICAgIm1hc3MiOiAtODUuMDMxNjM0MDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVz5ZIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRycD5UeXIiLAogICAgICAgICAgICAibWFzcyI6IC0yMy4wMTU5OTMwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJXPlYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVHJwPlZhbCIsCiAgICAgICAgICAgICJtYXNzIjogLTg3LjAxMDg5OTAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlk+QSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUeXI+QWxhIiwKICAgICAgICAgICAgIm1hc3MiOiAtOTIuMDI2MjA2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlk+UiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUeXI+QXJnIiwKICAgICAgICAgICAgIm1hc3MiOiAtNi45NjIyMDkwMDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiWT5OIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlR5cj5Bc24iLAogICAgICAgICAgICAibWFzcyI6IC00OS4wMjAzOTMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiWT5EIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlR5cj5Bc3AiLAogICAgICAgICAgICAibWFzcyI6IC00OC4wMzYzNzcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiWT5DIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlR5cj5DeXMiLAogICAgICAgICAgICAibWFzcyI6IC02MC4wNTQxMzUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiWT5FIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlR5cj5HbHUiLAogICAgICAgICAgICAibWFzcyI6IC0zNC4wMjA3MjY5OTk5OTk5OTQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiWT5RIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlR5cj5HbG4iLAogICAgICAgICAgICAibWFzcyI6IC0zNS4wMDQ3NDE5OTk5OTk5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJZPkciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVHlyPkdseSIsCiAgICAgICAgICAgICJtYXNzIjogLTEwNi4wNDE4NTYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiWT5IIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlR5cj5IaXMiLAogICAgICAgICAgICAibWFzcyI6IC0yNi4wMDQ0MDgwMDAwMDAwMTIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiWT5JIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlR5cj5JbGUiLAogICAgICAgICAgICAibWFzcyI6IC00OS45NzkyNTYwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJZPkwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVHlyPkxldSIsCiAgICAgICAgICAgICJtYXNzIjogLTQ5Ljk3OTI1NjAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlk+SyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUeXI+THlzIiwKICAgICAgICAgICAgIm1hc3MiOiAtMzQuOTY4MzU3CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlk+TSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUeXI+TWV0IiwKICAgICAgICAgICAgIm1hc3MiOiAtMzIuMDIyODM1MDAwMDAwMDE1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlk+RiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUeXI+UGhlIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTUuOTk0OTA2MDAwMDAwMDE1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlk+UCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUeXI+UHJvIiwKICAgICAgICAgICAgIm1hc3MiOiAtNjYuMDEwNTU2MDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiWT5TIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlR5cj5TZXIiLAogICAgICAgICAgICAibWFzcyI6IC03Ni4wMzEyOTIwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJZPlQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVHlyPlRociIsCiAgICAgICAgICAgICJtYXNzIjogLTYyLjAxNTY0MQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJZPlciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVHlyPlRycCIsCiAgICAgICAgICAgICJtYXNzIjogMjMuMDE1OTkzMDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiWT5WIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlR5cj5WYWwiLAogICAgICAgICAgICAibWFzcyI6IC02My45OTQ5MDYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVj5BIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlZhbD5BbGEiLAogICAgICAgICAgICAibWFzcyI6IC0yOC4wMzEzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlY+UiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJWYWw+QXJnIiwKICAgICAgICAgICAgIm1hc3MiOiA1Ny4wMzI2OTcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVj5OIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlZhbD5Bc24iLAogICAgICAgICAgICAibWFzcyI6IDE0Ljk3NDUxMzAwMDAwMDAwMgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJWPkQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVmFsPkFzcCIsCiAgICAgICAgICAgICJtYXNzIjogMTUuOTU4NTI4OTk5OTk5OTk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlY+QyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJWYWw+Q3lzIiwKICAgICAgICAgICAgIm1hc3MiOiAzLjk0MDc3MDk5OTk5OTk5OAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJWPkUiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVmFsPkdsdSIsCiAgICAgICAgICAgICJtYXNzIjogMjkuOTc0MTc5MDAwMDAwMDA3CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlY+USIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJWYWw+R2xuIiwKICAgICAgICAgICAgIm1hc3MiOiAyOC45OTAxNjQwMDAwMDAwMDcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVj5HIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlZhbD5HbHkiLAogICAgICAgICAgICAibWFzcyI6IC00Mi4wNDY5NQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJWPkgiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVmFsPkhpcyIsCiAgICAgICAgICAgICJtYXNzIjogMzcuOTkwNDk3OTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVj5JIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlZhbD5JbGUiLAogICAgICAgICAgICAibWFzcyI6IDE0LjAxNTY0OTk5OTk5OTk5NAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJWPkwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVmFsPkxldSIsCiAgICAgICAgICAgICJtYXNzIjogMTQuMDE1NjQ5OTk5OTk5OTk0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlY+SyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJWYWw+THlzIiwKICAgICAgICAgICAgIm1hc3MiOiAyOS4wMjY1NDkwMDAwMDAwMDMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVj5NIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlZhbD5NZXQiLAogICAgICAgICAgICAibWFzcyI6IDMxLjk3MjA3MDk5OTk5OTk4NQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJWPkYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVmFsPlBoZSIsCiAgICAgICAgICAgICJtYXNzIjogNDcuOTk5OTk5OTk5OTk5OTg2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlY+UCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJWYWw+UHJvIiwKICAgICAgICAgICAgIm1hc3MiOiAtMi4wMTU2NTAwMDAwMDAwMDgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVj5TIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlZhbD5TZXIiLAogICAgICAgICAgICAibWFzcyI6IC0xMi4wMzYzODYwMDAwMDAwMDcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVj5UIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlZhbD5UaHIiLAogICAgICAgICAgICAibWFzcyI6IDEuOTc5MjY0OTk5OTk5OTk4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlY+VyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJWYWw+VHJwIiwKICAgICAgICAgICAgIm1hc3MiOiA4Ny4wMTA4OTkwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJWPlkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVmFsPlR5ciIsCiAgICAgICAgICAgICJtYXNzIjogNjMuOTk0OTA2CiAgICAgICAgfQogICAgXQp9KTsKCi8qCiAqIEEgc2luZ2xldG9uIGRpY3Rpb25hcnkgZm9yIHJlc2lkdWUgbW9kaWZpY2F0aW9ucywgbG9hZGVkIGZyb20gZGF0YS9yZXNpdWVNb2RpZmljYXRpb25zLmpzLCBhIHRyYW5zZm9ybSBmcm9tIFVuaW1vZCwKICogYnV0IGFueSBtb2RpZmljYXRpb24gY2FuIGJlIGFkZGVkIGFzIGxvbmcgYXMgdGhlIG5hbWUgaXMgdW5pcXVlLgogKiAKICogQ29weXJpZ2h0IChjKSAyMDEzLTE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwoKZGVmaW5lKCdmaXNodG9uZXMvY29sbGVjdGlvbnMvZHJ5L1Jlc2lkdWVNb2RpZmljYXRpb25EaWN0aW9uYXJ5JyxbICdCYWNrYm9uZScsICdmaXNodG9uZXMvbW9kZWxzL2RyeS9SZXNpZHVlTW9kaWZpY2F0aW9uJywgJ2Zpc2h0b25lcy9kYXRhL3Jlc2lkdWVNb2RpZmljYXRpb25zJ10sIGZ1bmN0aW9uKEJhY2tib25lLCBSZXNpZHVlTW9kaWZpY2F0aW9uLCBic19yZXNtb2QpIHsKICAgIHZhciBSZXNpZHVlTW9kaWZpY2F0aW9uRGljdGlvbmFyeSA9IEJhY2tib25lLkNvbGxlY3Rpb24uZXh0ZW5kKHsKCiAgICAgICAgbW9kZWwgOiBSZXNpZHVlTW9kaWZpY2F0aW9uLAogICAgICAgIGRlZmF1bHRzIDogewogICAgICAgIH0sCiAgICAgICAgaW5pdGlhbGl6ZSA6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICBzZWxmLmFkZChic19yZXNtb2QpOwogICAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIG5ldyBSZXNpZHVlTW9kaWZpY2F0aW9uRGljdGlvbmFyeSgpOwp9KTsKCi8qCiAqIFJpY2hTZXF1ZW5jZSBpcyB0aGUgZXhwcmVzc2lvbiBvZiBhIHBlcHRpZGUsIHdpdGggbW9kaWZpY2F0aW9ucy4gSXQgaXMgY2VydGFpbmx5IG9uZSBvZiB0aGUgbW9zdCB1c2VkIGNsYXNzIGFtb25nIGZpc2hUb25lcy1qcy4KICogSXQgaG9sZCB0aGUgcGVwdGlkZSBzZXF1ZW5jZSwgd2l0aCBhbnkgbnVtYmVyIG9mIHBvc3NpYmxlIG1vZGlmaWNhdGlvbiBvbiBhIGFtaW5vIGFjaWQuCiAqIEl0IGFsc28gaG9sZHMgQy9OLXRlcm1zIG1vZGlmaWNhdGlvbihzKSAobXVsdGlwbGUgY2FuIGFsc28gYXBwbHkgb24gdGhlIHRlcm1pbmkuCiAqIFRoaXMgaW1wbGVtZW50YXRpb24gaXMgbm90IGRvbmUgd2l0aCBzcGVlZCBpbiBtaW5kLCBidXQgdmVyc2F0aWxpdHkgb2YgdXNlLgogKgogKiBBIFJpY2hTZXF1ZW5jZSBvYmplY3Qgd2lsbCBjb250YWlucyBhICdzZXF1ZW5jZScgcHJvcGVydGllcyB3aGljaCBpcyBhbiBhcnJheSBvZiB7YWE6eCwgbW9kaWZpY2F0aW9uczpbXX0KICoKICogV2hlbiBnZXR0aW5nIG1vZGlmaWNhdGlvbiBwZXIgcG9zaXRpb25zIG9uIGEgcGVwdGlkZSBvZiBsZW5ndGggbDoKICogMCAtPiBtb2RpZiBvbmUgdGhlIGZpcnN0IGFtaW5vIGFjaWQKICogbC0xIC0+IG9uIHRoZSBsYXN0IGFtaW5vIGFjaWQKICogLTEgLT4gTlRlcm0KICogbCAtPiBDVGVybQogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KCmRlZmluZSgnZmlzaHRvbmVzL21vZGVscy9kcnkvUmljaFNlcXVlbmNlJyxbJ2pxdWVyeScsICd1bmRlcnNjb3JlJywgJ0JhY2tib25lJywgJ2Zpc2h0b25lcy91dGlscy9SZWdFeHBGdWxsU3BsaXRlcicsICdmaXNodG9uZXMvY29sbGVjdGlvbnMvZHJ5L0FtaW5vQWNpZERpY3Rpb25hcnknLCAnZmlzaHRvbmVzL2NvbGxlY3Rpb25zL2RyeS9SZXNpZHVlTW9kaWZpY2F0aW9uRGljdGlvbmFyeScsICdmaXNodG9uZXMvbW9kZWxzL2RyeS9SZXNpZHVlTW9kaWZpY2F0aW9uJ10sIGZ1bmN0aW9uICgkLCBfLCBCYWNrYm9uZSwgUmVnRXhwRnVsbFNwbGl0ZXIsIGRpY29BQSwgZGljb1Jlc01vZCwgUmVzaWR1ZU1vZGlmaWNhdGlvbikgewoKICAgIHZhciBSaWNoU2VxdWVuY2UgPSBCYWNrYm9uZS5Nb2RlbC5leHRlbmQoewogICAgICAgIGRlZmF1bHRzOiB7CiAgICAgICAgICAgIHNlcXVlbmNlOiBbXQogICAgICAgIH0sCiAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKCkgewogICAgICAgIH0sCgogICAgICAgIGNsb25lOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgUmljaFNlcXVlbmNlKCkuZnJvbVN0cmluZyh0aGlzLnRvU3RyaW5nKCkpCiAgICAgICAgfSwKICAgICAgICAvKioKICAgICAgICAgKiBnZXQgdGhlIG1vZGlmaWNhdGlvbiBhcnJheSBmb3IgYSBnaXZlbiBhbWlubyBhY2lkIHBvc2l0aW9uCiAgICAgICAgICogQHBhcmFtIHBvcwogICAgICAgICAqIEBwYXJhbSBjcmVhdGUgOiBjcmVhdGUgc3VjaCBhbiBhcnJ5YSBvbiB0aGUgb2JqZWN0IGlmIGl0IHdhcyBub3QgZXhpc3RpbmcgW2RlZmF1bHQgZmFsc2VdCiAgICAgICAgICogQHJldHVybiB7Kn0KICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAqLwogICAgICAgIGdldE1vZGlmaWNhdGlvbkFycmF5OiBmdW5jdGlvbiAocG9zLCBjcmVhdGUpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICBpZiAocG9zID09IC0xKSB7CiAgICAgICAgICAgICAgICBpZiAoc2VsZi5nZXQoJ25UZXJtTW9kaWZpY2F0aW9ucycpID09PSB1bmRlZmluZWQgJiYgY3JlYXRlKSB7CiAgICAgICAgICAgICAgICAgICAgc2VsZi5zZXQoJ25UZXJtTW9kaWZpY2F0aW9ucycsIFtdKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuZ2V0KCduVGVybU1vZGlmaWNhdGlvbnMnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocG9zID09IHNlbGYuc2l6ZSgpKSB7CiAgICAgICAgICAgICAgICBpZiAoc2VsZi5nZXQoJ2NUZXJtTW9kaWZpY2F0aW9ucycpID09PSB1bmRlZmluZWQgJiYgY3JlYXRlKSB7CiAgICAgICAgICAgICAgICAgICAgc2VsZi5zZXQoJ2NUZXJtTW9kaWZpY2F0aW9ucycsIFtdKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuZ2V0KCdjVGVybU1vZGlmaWNhdGlvbnMnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIXNlbGYuZ2V0KCdzZXF1ZW5jZScpW3Bvc10ubW9kaWZpY2F0aW9ucyAmJiBjcmVhdGUpIHsKICAgICAgICAgICAgICAgIHNlbGYuZ2V0KCdzZXF1ZW5jZScpW3Bvc10ubW9kaWZpY2F0aW9ucyA9IFtdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBzZWxmLmdldCgnc2VxdWVuY2UnKVtwb3NdLm1vZGlmaWNhdGlvbnM7CgogICAgICAgIH0sCiAgICAgICAgLyoqCiAgICAgICAgICogc2V0IHRoZSBtb2ZpY2lhdGlvbiBhcnJheQogICAgICAgICAqIEBwYXJhbSBwb3MKICAgICAgICAgKiBAcGFyYW0gbW9kaWZhcnJheQogICAgICAgICAqIEByZXR1cm4gdGhpcwogICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICovCiAgICAgICAgc2V0TW9kaWZpY2F0aW9uQXJyYXk6IGZ1bmN0aW9uIChwb3MsIG1vZGlmYXJyYXkpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICBpZiAocG9zID09IC0xKSB7CiAgICAgICAgICAgICAgICBzZWxmLnNldCgnblRlcm1Nb2RpZmljYXRpb25zJywgbW9kaWZhcnJheSk7CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHBvcyA9PSBzZWxmLnNpemUoKSkgewogICAgICAgICAgICAgICAgc2VsZi5zZXQoJ2NUZXJtTW9kaWZpY2F0aW9ucycsIG1vZGlmYXJyYXkpCiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgc2VsZi5nZXQoJ3NlcXVlbmNlJylbcG9zXS5tb2RpZmljYXRpb25zID0gbW9kaWZhcnJheTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CgogICAgICAgIH0sCiAgICAgICAgLyoqCiAgICAgICAgICogYWRkIG9uZSBtb2RpZmljYXRpb24gb3IgYW4gYXJyYXkgb2YgbW9kaWYgYXQgYSBnaXZlbiBwb3NpdGlvbiB0byB0aGUgZXhpc2l0aW5nIGxpc3QuCiAgICAgICAgICogQHBhcmFtIHBvczogcG9zaXRpb24gYmVldHdlZW4gLTEgYW5kIGxlbgogICAgICAgICAqIEBwYXJhbSBtb2Q6IG9uZSBtb2RpZmljYWl0b24gb3IgYW4gYXJyYXkgb2YgaXQKICAgICAgICAgKi8KICAgICAgICBzZXRNb2RpZmljYXRpb246IGZ1bmN0aW9uIChwb3MsIG1vZCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHNlbGYuc2V0TW9kaWZpY2F0aW9uQXJyYXkocG9zLCB1bmRlZmluZWQpOwogICAgICAgICAgICBzZWxmLmFkZE1vZGlmaWNhdGlvbihwb3MsIG1vZCk7CiAgICAgICAgICAgIHNlbGYudHJpZ2dlcignY2hhbmdlJykKICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqIGFkZCBvbmUgbW9kaWZpY2F0aW9uIG9yIGFuIGFycmF5IG9mIG1vZGlmIGF0IGEgZ2l2ZW4gcG9zaXRpb24gdG8gdGhlIGV4aXNpdGluZyBsaXN0LgogICAgICAgICAqIEBwYXJhbSBwb3M6IHBvc2l0aW9uIGJlZXR3ZWVuIC0xIGFuZCBsZW4KICAgICAgICAgKiBAcGFyYW0gbW9kOiBvbmUgbW9kaWZpY2FpdG9uIG9yIGFuIGFycmF5IG9mIGl0CiAgICAgICAgICovCiAgICAgICAgYWRkTW9kaWZpY2F0aW9uOiBmdW5jdGlvbiAocG9zLCBtb2QpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICAgICAgaWYgKG1vZCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgbW9kQXJyID0gc2VsZi5nZXRNb2RpZmljYXRpb25BcnJheShwb3MsIHRydWUpCiAgICAgICAgICAgIGlmIChfLmlzQXJyYXkobW9kKSkgewogICAgICAgICAgICAgICAgXy5lYWNoKG1vZCwgZnVuY3Rpb24gKHJtKSB7CiAgICAgICAgICAgICAgICAgICAgbW9kQXJyLnB1c2gocm0pOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBtb2RBcnIucHVzaChtb2QpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIEBwYXJhbSBwb3M6IGJldHdlZW4gLTEgYW5kIGxlbgogICAgICAgICAqIEByZXR1cm4gdGhlIGxpc3Qgb2YgbW9kaWZpY2F0aW9uIGF0IHRoaXMgcG9zaXRpb24gKC0xIGFuZCBzaXplKCkgcG9zaXRpb24gZm9yIHRlcm1pbmkpCiAgICAgICAgICovCiAgICAgICAgY291bnRNb2RpZmljYXRpb25zQXQ6IGZ1bmN0aW9uIChwb3MpIHsKICAgICAgICAgICAgdmFyIGEgPSB0aGlzLmdldE1vZGlmaWNhdGlvbkFycmF5KHBvcyk7CiAgICAgICAgICAgIHJldHVybiBhID8gYS5sZW5ndGggOiAwOwogICAgICAgIH0sCiAgICAgICAgLyoqCiAgICAgICAgICogQHBhcmFtIHBvczogYmV0d2VlbiAtMSBhbmQgbGVuCiAgICAgICAgICogQHJldHVybiB0aGUgbGlzdCBvZiBtb2RpZmljYXRpb24gYXQgdGhpcyBwb3NpdGlvbgogICAgICAgICAqLwogICAgICAgIG1vZGlmQXQ6IGZ1bmN0aW9uIChwb3MpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0TW9kaWZpY2F0aW9uQXJyYXkocG9zKQogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIEBwYWVyYW0gcG9zOiBiZXR3ZWVuIDAgYW5kIGxlbi0xCiAgICAgICAgICogQHJldHVybiB0aGUgYW1pbm8gYWljZCBhdCB0aGlzIHBvc2l0aW9uCiAgICAgICAgICovCiAgICAgICAgYWFBdDogZnVuY3Rpb24gKHBvcykgewogICAgICAgICAgICByZXR1cm4gdGhpcy5nZXQoJ3NlcXVlbmNlJylbcG9zXS5hYQogICAgICAgIH0sCiAgICAgICAgLyoqCiAgICAgICAgICogcmVhZCB0aGUgb2JqZWN0IGJhY2sgZnJvbSB0aGUgdG9TdHJpbmcgbWV0aG9kLiBTZWUgdG9TdHJpbmcgZm9yIG1vcmUgZGV0YWlscyAnQUNEe094aWRhdGlvbn1FRkd7MTIzLjQ1LFBob3NwaG9yeWxhdGlvbn1ISUste0FjZXR5bH0nCiAgICAgICAgICogUmljaFNlcXVlbmNlLXRlc3RzLmpzIHdpbCBzaG93IHBsZW50eSBvZiBleGFtcGxlcwogICAgICAgICAqIEBwYXJhbSBzdHIKICAgICAgICAgKiBAcmV0dXJuIHtSaWNoU2VxdWVuY2V9CiAgICAgICAgICovCiAgICAgICAgZnJvbVN0cmluZzogZnVuY3Rpb24gKHN0cikgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHNlbGYuc2V0KCdzZXF1ZW5jZScsIFtdKTsKCiAgICAgICAgICAgIHN0ciA9IHN0ci50cmltKCkKICAgICAgICAgICAgdmFyIG1hdGNoTnRlcm0gPSAvXlx7KFteXH1dKilcfS8uZXhlYyhzdHIpCiAgICAgICAgICAgIGlmIChtYXRjaE50ZXJtKSB7CiAgICAgICAgICAgICAgICBzdHIgPSBzdHIuc3Vic3RyaW5nKG1hdGNoTnRlcm1bMF0ubGVuZ3RoKTsKICAgICAgICAgICAgICAgIHNlbGYuc2V0TW9kaWZpY2F0aW9uKC0xLCBzZWxmLnN0cmluZzJtb2RpZnMobWF0Y2hOdGVybVsxXSkpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgc2VsZi5zZXRNb2RpZmljYXRpb24oLTEsIHVuZGVmaW5lZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIG1hdGNoQ3Rlcm0gPSAvKFtcfVwtXSlceyhbXlx9XSopXH0kLy5leGVjKHN0cik7CiAgICAgICAgICAgIHZhciBjdGVybU1vZGlmcyA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgaWYgKG1hdGNoQ3Rlcm0pIHsKICAgICAgICAgICAgICAgIHN0ciA9IHN0ci5zdWJzdHIoMCwgc3RyLmxlbmd0aCAtIG1hdGNoQ3Rlcm1bMF0ubGVuZ3RoKTsKICAgICAgICAgICAgICAgIGlmIChtYXRjaEN0ZXJtWzFdID09ICd9JykKICAgICAgICAgICAgICAgICAgICBzdHIgKz0gJ30nOwogICAgICAgICAgICAgICAgY3Rlcm1Nb2RpZnMgPSBzZWxmLnN0cmluZzJtb2RpZnMobWF0Y2hDdGVybVsyXSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBtYXRjaGVzID0gbmV3IFJlZ0V4cEZ1bGxTcGxpdGVyKCkuc3BsaXQoLyhbQS1aXSkoXHsoW15cfV0qKVx9KT8vLCBzdHIpCgogICAgICAgICAgICBfLmVhY2gobWF0Y2hlcywgZnVuY3Rpb24gKG0pIHsKICAgICAgICAgICAgICAgIHZhciByYWEgPSB7CiAgICAgICAgICAgICAgICAgICAgYWE6IGRpY29BQS5nZXQobVsxXSkKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBpZiAoIXJhYS5hYSkgewogICAgICAgICAgICAgICAgICAgIHRocm93IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogJ1Vua253b3duQW1pbm9BY2lkJywKICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJ3Vua253b24gYW1pbm8gYWNpZCAnICsgbVsxXQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChtWzNdKSB7CiAgICAgICAgICAgICAgICAgICAgcmFhLm1vZGlmaWNhdGlvbnMgPSBzZWxmLnN0cmluZzJtb2RpZnMobVszXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzZWxmLmdldCgnc2VxdWVuY2UnKS5wdXNoKHJhYSk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIHNlbGYuc2V0TW9kaWZpY2F0aW9uKHNlbGYuc2l6ZSgpLCBjdGVybU1vZGlmcyk7CiAgICAgICAgICAgIC8vc2VsZi5jaGFuZ2UoKTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgfSwKICAgICAgICAvKioKICAgICAgICAgKiBwYXJzZSBhIG1vZGlmaWNhdGlvbiBzdHJpbmcgc3RyaW5nCiAgICAgICAgICogQHBhcmFtIHN0ck1vZHMKICAgICAgICAgKiBAcmV0dXJuIHtBcnJheX0KICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAqLwogICAgICAgIHN0cmluZzJtb2RpZnM6IGZ1bmN0aW9uIChzdHJNb2RzKSB7CiAgICAgICAgICAgIHZhciBsID0gW107CiAgICAgICAgICAgIF8uZWFjaChzdHJNb2RzLnNwbGl0KCcsJyksIGZ1bmN0aW9uIChtbikgewogICAgICAgICAgICAgICAgdmFyIG1vZCA9IGRpY29SZXNNb2QuZ2V0KG1uKTsKICAgICAgICAgICAgICAgIGlmICghbW9kKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIG1tYXNzID0gcGFyc2VGbG9hdChtbik7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFfLmlzRmluaXRlKG1tYXNzKSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAnVW5rbndvd25SZXNpZHVlTW9kaWZpY2F0aW9uJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICd1bmtub3duIG1vZGlmaWNhdGlvbiBbJyArIG1vZCArICddIGluICcgKyBtbgogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIG1vZCA9IG5ldyBSZXNpZHVlTW9kaWZpY2F0aW9uKHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIiIgKyBtbWFzcywKICAgICAgICAgICAgICAgICAgICAgICAgbWFzczogbW1hc3MKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbC5wdXNoKG1vZCkKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiBsOwogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIGNoZWNrIGVxdWFsaXR5IGJldHdlZSAyIHJpY2ggc2VxdWVuY2UuCiAgICAgICAgICogVGhhdCBjYW4gYmUgbm90IHRoYXQgc3RyYWlnaHQgZm9yd2FyZHMsIGJlY2F1c2UgdGhlIG1vZGlmaWNhdGlvbiBvcmRlciBvbiBhIGdpdmVuIGFtaW5vIGFjaWQgaXMgbm90IHJlbGV2YW50LgogICAgICAgICAqIEBwYXJhbSBvcnMKICAgICAgICAgKiBAcmV0dXJuIHsqfQogICAgICAgICAqLwogICAgICAgIGVxdWFsc1RvOiBmdW5jdGlvbiAob3JzKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgaWYgKChvcnMgPT0gbnVsbCkgfHwgKHNlbGYuc2l6ZSgpICE9IG9ycy5zaXplKCkpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIF8uYWxsKHNlbGYuZ2V0KCdzZXF1ZW5jZScpLCBmdW5jdGlvbiAocmFhLCBpKSB7CiAgICAgICAgICAgICAgICBvcmFhID0gb3JzLmdldCgnc2VxdWVuY2UnKVtpXTsKICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyYWEuYWEuY29kZTEsIG9yYWEuYWEuY29kZSkKICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhfLnBsdWNrKHJhYS5tb2RpZmljYXRpb25zLCAnbmFtZScpLnNvcnQoKS5qb2luKAogICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnJyksIF8ucGx1Y2sob3JhYS5tb2RpZmljYXRpb25zLCAnbmFtZScpCiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zb3J0KCkuam9pbignJykpOwogICAgICAgICAgICAgICAgcmV0dXJuIChyYWEuYWEuZ2V0KCdjb2RlMScpID09IG9yYWEuYWEuZ2V0KCdjb2RlMScpKSAmJiAoXy5jb2xsZWN0KHJhYS5tb2RpZmljYXRpb25zLCBmdW5jdGlvbiAobSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBtLmdldCgnbmFtZScpCiAgICAgICAgICAgICAgICB9KS5zb3J0KCkuam9pbignJykgPT0gXy5jb2xsZWN0KG9yYWEubW9kaWZpY2F0aW9ucywgZnVuY3Rpb24gKG0pIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbS5nZXQoJ25hbWUnKQogICAgICAgICAgICAgICAgfSkuc29ydCgpLmpvaW4oJycpKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogQHJldHVybiBqdXN0IHRoZSBhbWlubyBhY2lkIGxpc3QgYXMgYSBzdHJpbmcKICAgICAgICAgKi8KICAgICAgICB0b0FBU3RyaW5nOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBfLmNvbGxlY3QodGhpcy5nZXQoJ3NlcXVlbmNlJyksIGZ1bmN0aW9uIChyYWEpIHsKICAgICAgICAgICAgICAgIHJldHVybiByYWEuYWEuZ2V0KCdjb2RlMScpOwogICAgICAgICAgICB9KS5qb2luKCcnKTsKICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiBmdWxsIHN0cmluZywgY29tcGF0aWJsZSB3aXRoIHRoZSBmcm9tU3RyaW5nL2NvbnN0cnVjdG9yIHN5bnRheAogICAgICAgICAqIHNlZSBSaWNoU2VxdWVuY2UtdGVzdHMuanMgZm9yIGV4YW1wbGVzCiAgICAgICAgICogQHJldHVybiBhIHN0cmluZwogICAgICAgICAqLwogICAgICAgIHRvU3RyaW5nOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgICAgICAgIHZhciBtb2RpZjJzdHJpbmcgPSBmdW5jdGlvbiAobW9kaWZzKSB7CiAgICAgICAgICAgICAgICBpZiAoIW1vZGlmcyB8fCBtb2RpZnMubGVuZ3RoID09IDApIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJyc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gJ3snICsgXy5jb2xsZWN0KG1vZGlmcywgZnVuY3Rpb24gKG0pIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbS5nZXQoJ25hbWUnKQogICAgICAgICAgICAgICAgfSkuc29ydCgpLmpvaW4oJywnKSArICd9JwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBzID0gbW9kaWYyc3RyaW5nKHNlbGYuZ2V0KCduVGVybU1vZGlmaWNhdGlvbnMnKSk7CiAgICAgICAgICAgIHZhciBzaXplID0gc2VsZi5zaXplKCk7CiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBzaXplOyBpKyspIHsKICAgICAgICAgICAgICAgIHMgKz0gc2VsZi5nZXQoJ3NlcXVlbmNlJylbaV0uYWEuZ2V0KCdjb2RlMScpOwogICAgICAgICAgICAgICAgcyArPSBtb2RpZjJzdHJpbmcoc2VsZi5nZXQoJ3NlcXVlbmNlJylbaV0ubW9kaWZpY2F0aW9ucyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChzZWxmLmNvdW50TW9kaWZpY2F0aW9uc0F0KHNpemUpID4gMCkgewogICAgICAgICAgICAgICAgaWYgKHNlbGYuY291bnRNb2RpZmljYXRpb25zQXQoc2l6ZSAtIDEpID09IDApIHsKICAgICAgICAgICAgICAgICAgICBzICs9ICctJwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgOwogICAgICAgICAgICAgICAgcyArPSBtb2RpZjJzdHJpbmcoc2VsZi5nZXQoJ2NUZXJtTW9kaWZpY2F0aW9ucycpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICA7CgogICAgICAgICAgICByZXR1cm4gczsKICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiBhIHNlcXVlbmNlIGxlbmd0aAogICAgICAgICAqLwogICAgICAgIHNpemU6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0KCdzZXF1ZW5jZScpLmxlbmd0aDsKICAgICAgICB9CiAgICB9KTsKCiAgICByZXR1cm4gUmljaFNlcXVlbmNlOwp9KTsKCi8qCiAqIEEgdGhlb3JldGljYWwgc3BlY3RydW0gcG9qbywgbWFkZSBvdXQgZnJvbSBhIFJpY2hTZXF1ZW5jZSBhbmQgYSBzZXQgb2YgZnJhZ21lbnRhdGlvbiBzZXJpZXMKICogUHJvcGVydGllczoKICogLSByaWNoU2VxdWVuY2UKICogLSBwZWFrcwogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KCmRlZmluZSgnZmlzaHRvbmVzL21vZGVscy9kcnkvVGhlb1NwZWN0cnVtJyxbJ3VuZGVyc2NvcmUnLCAnQmFja2JvbmUnXSwgZnVuY3Rpb24oXywgQmFja2JvbmUpIHsKICAgIHZhciBUaGVvU3BlY3RydW0gPSBCYWNrYm9uZS5Nb2RlbC5leHRlbmQoewogICAgICAgIGRlZmF1bHRzIDogewogICAgICAgICAgICByaWNoU2VxdWVuY2UgOiBudWxsLAogICAgICAgIH0sCiAgICAgICAgaW5pdGlhbGl6ZSA6IGZ1bmN0aW9uKCkgewogICAgICAgIH0sCiAgICAgICAgLyoqCiAgICAgICAgICogQHJldHVybiB0aGUgbGlzdCBvZiBtL3ouIHdlIG5lZWQgdGhhdCB0byBoYXZlIGEga2luZCBvZiAnYWJzdHJhY3Rpb24nIG92ZXIgTWFzc0xpc3QKICAgICAgICAgKi8KICAgICAgICBtb3pzOmZ1bmN0aW9uKCl7CiAgICAgICAgICAgIHJldHVybiBfLnBsdWNrKHRoaXMuZ2V0KCdwZWFrcycpLCAnbW96Jyk7CiAgICAgICAgfSwKICAgICAgICBzaXplOmZ1bmN0aW9uKCl7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldCgncGVha3MnKS5sZW5ndGg7CiAgICAgICAgfQogICAgICAgIAogICAgfSk7CiAgICByZXR1cm4gVGhlb1NwZWN0cnVtOwp9KTsKCi8qCiAqIEJ1aWxkcyB0aGVvcmV0aWNhbCBtYXNzZXMgYmFzZWQgb24gYSBSaWNoU2V1ZW5jZS4gSXQgY2FuIGJlIGludGFjdCBtYXNzICh3aXRoIGNoYXJnZXMpIG9yIGZyYWdtZW50YXRpb24gc3BlY3RyYS4KICogVmlzaXQgTWFzc0J1aWxkZXItdGVzdC5qcyBmb3IgcGxlbnR5IG9mIGV4YW1wbGVzLgogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KZGVmaW5lKCdmaXNodG9uZXMvc2VydmljZXMvZHJ5L01hc3NCdWlsZGVyJyxbJ2pxdWVyeScsICd1bmRlcnNjb3JlJywgJ0JhY2tib25lJywgJ2Zpc2h0b25lcy9tb2RlbHMvZHJ5L1JpY2hTZXF1ZW5jZScsICdmaXNodG9uZXMvbW9kZWxzL2RyeS9UaGVvU3BlY3RydW0nLCAnZmlzaHRvbmVzL2NvbGxlY3Rpb25zL2RyeS9BbWlub0FjaWREaWN0aW9uYXJ5JywgJ2Zpc2h0b25lcy9jb2xsZWN0aW9ucy9kcnkvUmVzaWR1ZU1vZGlmaWNhdGlvbkRpY3Rpb25hcnknXSwgZnVuY3Rpb24oJCwgXywgQmFja2JvbmUsIFJpY2hTZXF1ZW5jZSwgVGhlb1NwZWN0cnVtLCBkaWNvQUEsIGRpY29SZXNNb2QpIHsKICB2YXIgTUFTU19PSCA9IDE1Ljk5NDkxNDYyMiArIDEuMDA3ODI1MDMyLy8gY3Rlcm0KICB2YXIgTUFTU19IID0gMS4wMDc4MjUwMzIvLyBudGVybQogIHZhciBNQVNTX0hQTFVTID0gMS4wMDcyNzY0NjY4MTIKCiAgLyoqCiAgICogcHJpdmF0ZSBjb250c3RydWN0b3IKICAgKi8KICBNYXNzQnVpbGRlciA9IEJhY2tib25lLk1vZGVsLmV4dGVuZCh7CiAgICBpbml0RGVmIDogaW5pdERlZiwKICAgIGxhdW5jaEluaXQgOiBmYWxzZSwKCiAgICBfaW5kZXhNb2RpZiA6IG51bGwsCiAgICBfaW5kZXhBbWlub0FjaWQgOiBudWxsLAoKICAgIGluZGV4TW9kaWYgOiBmdW5jdGlvbihuYW1lKSB7CiAgICAgIHJldHVybiAobmFtZSA9PT0gdW5kZWZpbmVkKSA/IHRoaXMuX2luZGV4TW9kaWYgOiB0aGlzLl9pbmRleE1vZGlmW25hbWVdCiAgICB9LAogICAgaW5kZXhBbWlub0FjaWQgOiBmdW5jdGlvbihuYW1lKSB7CiAgICAgIHJldHVybiAobmFtZSA9PT0gdW5kZWZpbmVkKSA/IHRoaXMuX2luZGV4QW1pbm9BY2lkIDogdGhpcy5faW5kZXhBbWlub0FjaWRbbmFtZV0KICAgIH0sCgogICAgcF9pbml0X2FtaW5vX2FjaWRzX2Zyb21fanNvbiA6IHBfaW5pdF9hbWlub19hY2lkc19mcm9tX2pzb24sCiAgICBwX2luaXRfcmVzaWR1ZV9tb2RpZmljYXRpb25zX2Zyb21fanNvbiA6IHBfaW5pdF9yZXNpZHVlX21vZGlmaWNhdGlvbnNfZnJvbV9qc29uLAoKICAgIGNvbXB1dGVNYXNzUmljaFNlcXVlbmNlIDogY29tcHV0ZU1hc3NSaWNoU2VxdWVuY2UsCiAgICBjb21wdXRlVGhlb1NwZWN0cnVtIDogY29tcHV0ZVRoZW9TcGVjdHJ1bSwKICAgIGNvbXB1dGVNYXNzUmljaEFBIDogY29tcHV0ZU1hc3NSaWNoQUEsCiAgICBjb21wdXRlTWFzc01vZGlmQXJyYXkgOiBjb21wdXRlTWFzc01vZGlmQXJyYXkKCiAgfSk7CgogIE1hc3NCdWlsZGVyLnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24ob3B0aW9ucykgewogICAgdGhpcy5pbml0RGVmKG9wdGlvbnMpCgogIH0KICAvKioKICAgKiByZWFkIE1vZGlmaWNhdGlvbiwgYW1pbm8gYWNpZCAmIGNvIGRlZmluaXRpb25zIGF1dG9tYXRpY2FsbHkgY2FsbGVkIG9uY2UKICAgKiBmcm9tIHRoZSBvcHRpb24gc3JjIGluIG5ldwogICAqIEBwcml2YXRlCiAgICovCiAgZnVuY3Rpb24gaW5pdERlZihvcHRpb25zKSB7CiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLnNyYyAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIHNlbGYubGF1bmNoSW5pdCA9IHRydWUKICAgICAgJC5nZXRKU09OKG9wdGlvbnMuc3JjICsgJy9yZXNpZHVlTW9kaWZpY2F0aW9uL2xpc3QnLCBmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgc2VsZi5wX2luaXRfcmVzaWR1ZV9tb2RpZmljYXRpb25zX2Zyb21fanNvbihkYXRhKQogICAgICB9KTsKICAgICAgJC5nZXRKU09OKG9wdGlvbnMuc3JjICsgJy9hbWlub0FjaWQvbGlzdCcsIGZ1bmN0aW9uKGRhdGEpIHsKCiAgICAgICAgc2VsZi5wX2luaXRfYW1pbm9fYWNpZHNfZnJvbV9qc29uKGRhdGEpOwogICAgICB9KTsKICAgIH0gZWxzZSBpZiAob3B0aW9ucyAmJiBvcHRpb25zLmRhdGEgIT09IHVuZGVmaW5lZCkgewogICAgICBzZWxmLmxhdW5jaEluaXQgPSB0cnVlCiAgICAgIHNlbGYucF9pbml0X2FtaW5vX2FjaWRzX2Zyb21fanNvbihvcHRpb25zLmRhdGEuYW1pbm9BY2lkcyk7CiAgICAgIHNlbGYucF9pbml0X3Jlc2lkdWVfbW9kaWZpY2F0aW9uc19mcm9tX2pzb24ob3B0aW9ucy5kYXRhLnJlc2lkdWVNb2RpZmljYXRpb25zKTsKICAgIH0KICB9CgogIHZhciBwX2luaXRfYW1pbm9fYWNpZHNfZnJvbV9qc29uID0gZnVuY3Rpb24oZGF0YSkgewogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgdmFyIGlkeCA9IHt9OwogICAgXy5lYWNoKGRhdGEsIGZ1bmN0aW9uKGQpIHsKICAgICAgaWR4W2QuY29kZTFdID0gZAogICAgfSk7CgogICAgc2VsZi5faW5kZXhBbWlub0FjaWQgPSBpZHg7CiAgfTsKCiAgdmFyIHBfaW5pdF9yZXNpZHVlX21vZGlmaWNhdGlvbnNfZnJvbV9qc29uID0gZnVuY3Rpb24oZGF0YSkgewogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgdmFyIGlkeCA9IHt9OwogICAgXy5lYWNoKGRhdGEsIGZ1bmN0aW9uKGQpIHsKICAgICAgaWR4W2QubmFtZV0gPSBkCiAgICB9KTsKCiAgICBzZWxmLl9pbmRleE1vZGlmID0gaWR4OwogIH07CgogIC8qKgogICAqIGNvbXB1dGUgUmljaEFBIG1hc3MgKGFtaW5vIGFjaWQgKyBtb2RpZmljYXRpb25zKQogICAqIEBwcml2YXRlCiAgICovCiAgZnVuY3Rpb24gY29tcHV0ZU1hc3NSaWNoQUEocmFhKSB7CiAgICByZXR1cm4gcmFhLmFhLmdldCgnbWFzcycpICsgY29tcHV0ZU1hc3NNb2RpZkFycmF5KHJhYS5tb2RpZmljYXRpb25zKTsKICB9CgogIC8qKgogICAqIGNvbXB1dGUgdGhlIG1hc3Mgb2Ygb2YgbGlzdCBvZiBtb2RpZmljYXRpb25zICh1bmRlZmllbmQgaXMgcG9zc2libGUpLiBJdCdzIGp1c3QgdGhlIHN1bSBvZiB0aGUgbW9kaWYgbWFzc2VzCiAgICogQHByaXZhdGUKICAgKi8KICBmdW5jdGlvbiBjb21wdXRlTWFzc01vZGlmQXJyYXkobW9kaWZpY2F0aW9ucykgewoKICAgIGlmIChtb2RpZmljYXRpb25zID09PSB1bmRlZmluZWQgfHwgbW9kaWZpY2F0aW9ucy5sZW5ndGggPT0gMCkgewogICAgICByZXR1cm4gMDsKICAgIH0KICAgIHZhciB0b3QgPSAwOwogICAgXy5lYWNoKG1vZGlmaWNhdGlvbnMsIGZ1bmN0aW9uKG0pIHsKICAgICAgdG90ICs9IG0uZ2V0KCdtYXNzJyk7CiAgICB9KTsKICAgIHJldHVybiB0b3Q7CiAgfQoKICAvKioKICAgKiBnZXQgcmljaCBzZXF1ZW5jZSBtYXNzIGlmIGEgY2hhcmdlIGFyZ3VtZW50IGlzIGdpdmVuICwgZ2V0IHRoZSBjaGFyZ2VkCiAgICogcGVwdGlkZQogICAqIEBwYXJhbSByaWNoU2VxOiB0aGUgcGVwdGlkZQogICAqIEBwYXJhbSBjaGFyZ2U6IGNoYXJnZSBzdGF0ZS4gaWYgdW5kZWZpbmVkLCBNSCB3aWxsIGJlIHJldHVybmVkCiAgICogQHJldHVybiBhIGRvdWJsZSBmb3IgdGhlIG1hc3MKICAgKi8KICBmdW5jdGlvbiBjb21wdXRlTWFzc1JpY2hTZXF1ZW5jZShyaWNoU2VxLCBjaGFyZ2UpIHsKCiAgICB2YXIgcmF3TWFzcyA9IDA7CgogICAgXy5lYWNoKHJpY2hTZXEuZ2V0KCdzZXF1ZW5jZScpLCBmdW5jdGlvbihyYWEpIHsKICAgICAgcmF3TWFzcyArPSBjb21wdXRlTWFzc1JpY2hBQShyYWEpCiAgICB9KTsKCiAgICByYXdNYXNzICs9IE1BU1NfT0ggKyBNQVNTX0g7CiAgICByYXdNYXNzICs9IGNvbXB1dGVNYXNzTW9kaWZBcnJheShyaWNoU2VxLmdldCgnblRlcm1Nb2RpZmljYXRpb25zJykpICsgY29tcHV0ZU1hc3NNb2RpZkFycmF5KHJpY2hTZXEuZ2V0KCdjVGVybU1vZGlmaWNhdGlvbnMnKSk7CiAgICBpZiAoIWNoYXJnZSkgewogICAgICByZXR1cm4gcmF3TWFzcwogICAgfQogICAgcmV0dXJuIHJhd01hc3MgLyBjaGFyZ2UgKyBNQVNTX0hQTFVTOwogIH0KCiAgLyoqCiAgICogY29tcHV0ZSB0aGUgdGhlb3JldGljYWwgbWFzcyBzcGVjdHJ1bS4gYiwgYisrLCB5LCB5KysKICAgKiBAcmV0dXJuIGEgdGhlb3JldGljYWwgc3BlY3RydW0KICAgKi8KICBmdW5jdGlvbiBjb21wdXRlVGhlb1NwZWN0cnVtKHJpY2hTZXEpIHsKICAgIHZhciByYXdNYXNzZXMgPSBbY29tcHV0ZU1hc3NNb2RpZkFycmF5KHJpY2hTZXEuZ2V0KCduVGVybU1vZGlmaWNhdGlvbnMnKSldLmNvbmNhdChfLmNvbGxlY3QocmljaFNlcS5nZXQoJ3NlcXVlbmNlJyksIGNvbXB1dGVNYXNzUmljaEFBKSk7CiAgICB2YXIgbiA9IHJhd01hc3Nlcy5sZW5ndGg7CiAgICBmb3IgKCBpID0gMTsgaSA8IG47IGkrKykgewogICAgICByYXdNYXNzZXNbaV0gKz0gcmF3TWFzc2VzW2kgLSAxXQogICAgfQogICAgdmFyIG10b3QgPSByYXdNYXNzZXNbbiAtIDFdOwoKICAgIHZhciB0aGVvU3AgPSBuZXcgVGhlb1NwZWN0cnVtKHsKICAgICAgZnJhZ1NlcmllcyA6IFsnYicsICdiKysnLCAneScsICd5KysnXSwKICAgICAgbGVuU2VxIDogcmljaFNlcS5zaXplKCksCiAgICAgIHBlYWtzIDogW10sCiAgICAgIHJpY2hTZXF1ZW5jZSA6IHJpY2hTZXEKICAgIH0pOwogICAgdmFyIHBlYWtzID0gdGhlb1NwLmdldCgncGVha3MnKTsKICAgIGZvciAoIGkgPSAocmF3TWFzc2VzWzBdID49IDEwMCkgPyAwIDogMTsgaSA8IHJhd01hc3Nlcy5sZW5ndGg7IGkrKykgewoKICAgICAgdmFyIHJtID0gcmF3TWFzc2VzW2ldOwogICAgICAvLyAgICAgICAgICAgIGNvbnNvbGUubG9nKHJtLCBpKQogICAgICBwZWFrcy5wdXNoKHsKICAgICAgICBsYWJlbCA6ICdiJyArIGksCiAgICAgICAgc2VyaWVzIDogJ2InLAogICAgICAgIG1veiA6IHJtICsgTUFTU19IUExVUywKICAgICAgICBwb3MgOiBpIC0gMQogICAgICB9KTsKICAgICAgcGVha3MucHVzaCh7CiAgICAgICAgbGFiZWwgOiAnYisrJyArIGksCiAgICAgICAgc2VyaWVzIDogJ2IrKycsCiAgICAgICAgbW96IDogcm0gLyAyICsgTUFTU19IUExVUywKICAgICAgICBwb3MgOiBpIC0gMQogICAgICB9KTsKICAgIH0KCiAgICB2YXIgbWN0ZXJtaW51cyA9IGNvbXB1dGVNYXNzTW9kaWZBcnJheShyaWNoU2VxLmdldCgnY1Rlcm1Nb2RpZmljYXRpb25zJykpCiAgICBmb3IgKCBpID0gMDsgaSA8IHJhd01hc3Nlcy5sZW5ndGg7IGkrKykgewogICAgICB2YXIgeW0gPSBtdG90IC0gcmF3TWFzc2VzW2ldICsgTUFTU19PSCArIE1BU1NfSCArIG1jdGVybWludXM7CiAgICAgIGlmICgoaSA9PSByYXdNYXNzZXMubGVuZ3RoIC0gMSApICYmIHltIDwgMTAwKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KCiAgICAgIHBlYWtzLnB1c2goewogICAgICAgIGxhYmVsIDogJ3knICsgKG4gLSBpIC0gMSksCiAgICAgICAgc2VyaWVzIDogJ3knLAogICAgICAgIG1veiA6IHltICsgTUFTU19IUExVUywKICAgICAgICBwb3MgOiBpCiAgICAgIH0pOwogICAgICBwZWFrcy5wdXNoKHsKICAgICAgICBsYWJlbCA6ICd5KysnICsgKG4gLSBpIC0gMSksCiAgICAgICAgc2VyaWVzIDogJ3krKycsCiAgICAgICAgbW96IDogeW0gLyAyICsgTUFTU19IUExVUywKICAgICAgICBwb3MgOiBpCiAgICAgIH0pOwogICAgfQogICAgcGVha3Muc29ydChmdW5jdGlvbihhLCBiKSB7CiAgICAgIHJldHVybiBhLm1veiAtIGIubW96CiAgICB9KTsKICAgIHJldHVybiB0aGVvU3AKICB9CgogIHJldHVybiBuZXcgTWFzc0J1aWxkZXIoKTsKfSk7CgovKgogKiBmdW5jdGlvbiB0byBjb21wdXRlIGRlbHRhIG1hc3Nlcy4KICAqIE9ubHkgcHBtIGlzIGltcGxlbWVudGVkLCBidXQgdGhhdCBzaG91bGQgYmUgdGhlIGhhbmRsZXIgZm9yIG90aGVyIHVuaXRzIChEYSBldGMuLikKICAqCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwpkZWZpbmUoJ2Zpc2h0b25lcy91dGlscy9EZWx0YU1hc3MnLFsndW5kZXJzY29yZSddLCBmdW5jdGlvbihfKSB7CiAgICB2YXIgRGVsdGFNYXNzID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICAvKioKICAgICAgICAgKiBzeW1tZXRyaWNhbGx5IGNvcnJlY3QgcHBtIGNvbXB1dGF0aW9uICh4LXkpIHNob3VsZCBlcXVhbCB0byAoeS14KQogICAgICAgICAqCiAgICAgICAgICogQHR5cGUge3tkZWx0YTogZGVsdGEsIHJhbmdlOiByYW5nZSwgaXNDbG9zZVRvOiBpc0Nsb3NlVG99fQogICAgICAgICAqLwogICAgICAgIHNlbGYucHBtID0gewogICAgICAgICAgICAvKioKICAgICAgICAgICAgICogZGlzdGFuY2UgYmV0d2VlbiB0d28gbWFzc2VzCiAgICAgICAgICAgICAgKiBAcGFyYW0geAogICAgICAgICAgICAgKiBAcGFyYW0geQogICAgICAgICAgICAgKiBAcmV0dXJuIHtudW1iZXJ9CiAgICAgICAgICAgICAqLwogICAgICAgICAgICBkZWx0YSA6IGZ1bmN0aW9uKHgsIHkpIHsKICAgICAgICAgICAgICAgIHJldHVybiAyICogKHkgLSB4KSAvICh5ICsgeCkgKiAxMDAwMDAwOwogICAgICAgICAgICB9LAogICAgICAgICAgICAvKioKICAgICAgICAgICAgICogcmV0dXJuIG1hc3MgYm91bmRhcmllcyBmb3IgeCArLSB0b2wKICAgICAgICAgICAgICogQHBhcmFtIHgKICAgICAgICAgICAgICogQHBhcmFtIHRvbAogICAgICAgICAgICAgKiBAcmV0dXJuIHtbbU1pbiwgbU1heF19CiAgICAgICAgICAgICAqLwogICAgICAgICAgICByYW5nZSA6IGZ1bmN0aW9uKHgsIHRvbCkgewogICAgICAgICAgICAgICAgdG9sID0gTWF0aC5hYnModG9sKSAvIDEwMDAwMDAuMDsKICAgICAgICAgICAgICAgIHZhciBmID0gKDIgKyB0b2wpIC8gKDIgLSB0b2wpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXR1cm4gKHg+PTApP1t4IC8gZiwgeCAqIGZdOlt4ICogZiwgeCAvIGZdCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiB3ZSBoYXZlIHR3byB2ZXJzaW9uOgogICAgICAgICAgICAgKiAgLSB3aXRoIHRocmVlIHBhcmFtcywgcmV0dXJuIHRydWUvZmFsc2UgaWYgKHRhcmdldCAmIHRvbCBhcmUgY2xvc2VyIHRoYW4gY2FuZGlkYXRlKQogICAgICAgICAgICAgKiAgLSB3aXRoIHR3byBwYXJhbWV0ZXJzLCByZXR1cm4gYSBmdW5jdGlvbiB0aGF0IHdpbGwgdGFrZSB3IHBhcmVtdGVyIG9mIHR5cGUgY2FuZGlkYXRlOyB0aGlzIHNob3VsZCBiZSBtdWNoIGZhc3RlcgogICAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gdGFyZ2V0CiAgICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSB0b2wKICAgICAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGNhbmRpZGF0ZQogICAgICAgICAgICAgKi8KICAgICAgICAgICAgaXNDbG9zZVRvIDogZnVuY3Rpb24odGFyZ2V0LCB0b2wsIGNhbmRpZGF0ZSkgewogICAgICAgICAgICAgICAgaWYgKGNhbmRpZGF0ZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE1hdGguYWJzKDIgKiAoY2FuZGlkYXRlIC0gdGFyZ2V0KSAvIChjYW5kaWRhdGUgKyB0YXJnZXQpICogMTAwMDAwMCkgPD0gdG9sCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB2YXIgciA9IHNlbGYucHBtLnJhbmdlKHRhcmdldCwgdG9sKTsKICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihjKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGMgPj0gclswXSAmJiBjIDw9IHJbMV0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICB9CgogICAgcmV0dXJuIG5ldyBEZWx0YU1hc3MoKTsKCn0pCjsKLyoKICogQWJzdHJhY3Qgd2hhdCB3YXMgb25seSBQU01BbGlnbm1lbnQgaW50byBhbGlnbm1lbnQgb2YgdHdvIGJlYW5zIHdpdGggZnVuY3Rpb24gLm1venMoKSAoZ2V0dGluZyBiYWNrIHRoZSBsaXN0IG9mIG1hc3NlcykKICogVGhlIHBvaW50IGlzIHRvIGFsaWduIGV4cC90aGVvLCBidXQgYWxzbyBleHAvZXhwCiAqCiAqIFRoaXMgd2lsbCBiZSBwb3B1bGF0ZWQgd2l0aCBwa2xBIGFuZCBwa2xCLCBlYWNoIG9mIHRoZW0gaGF2aW5nIGEgLm1venMoKSBmdW5jdGlvbi4KICoKICogTkI6IHRoZSB3YXkgdGhlIGFsaWdubWVudCBpcyBwZXJmb3JtZWQgbm90Li4uIGVmZmljaWVudC4gd2UgY29tcHV0ZSBhZ2FpbiBhbmQgYWdhaW4gdGhlIGNsb3Nlc3QgcGVhayB3aXRoIHRoZSBkaWNob3RvbXkgbWV0aG9kcywgaW5zdGVhZCBvZiBtb3ZpbmcgIHdpdGggYSBzaW5nbGUsIG9uZSBzaG90IGxpbmVhci9kaWNobyBtZXRob2QuLi4KICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCgoKZGVmaW5lKCdmaXNodG9uZXMvbW9kZWxzL21hdGNoL1BlYWtMaXN0UGFpckFsaWdubWVudCcsWydqcXVlcnknLCAndW5kZXJzY29yZScsICdCYWNrYm9uZScsICdmaXNodG9uZXMvdXRpbHMvRGVsdGFNYXNzJ10sIGZ1bmN0aW9uICgkLCBfLCBCYWNrYm9uZSwgRGVsdGFNYXNzKSB7CiAgICB2YXIgY2xvc2VzdFBlYWsgPSBmdW5jdGlvbiAoeCwgeHBlYWtzKSB7CgogICAgICAgIGlmICh4IDw9IHhwZWFrc1swXSkgewogICAgICAgICAgICByZXR1cm4gMAogICAgICAgIH0KICAgICAgICB2YXIgaXN1cCA9IHhwZWFrcy5sZW5ndGggLSAxOwogICAgICAgIGlmICh4ID49IHhwZWFrc1tpc3VwXSkgewogICAgICAgICAgICByZXR1cm4gaXN1cAogICAgICAgIH0KICAgICAgICB2YXIgaWluZiA9IDA7CgogICAgICAgIHdoaWxlICgoaWluZiArIDEpIDwgaXN1cCkgewogICAgICAgICAgICB2YXIgaW1pZCA9IE1hdGgucm91bmQoKGlpbmYgKyBpc3VwKSAvIDIpOwogICAgICAgICAgICBpZiAoeCA8IHhwZWFrc1tpbWlkXSkgewogICAgICAgICAgICAgICAgaXN1cCA9IGltaWQKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlpbmYgPSBpbWlkOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiAoKHggLSB4cGVha3NbaWluZl0pIDwgKHhwZWFrc1tpc3VwXSAtIHgpKSA/IGlpbmYgOiBpc3VwOwogICAgfQoKICAgIHJldHVybiBCYWNrYm9uZS5Nb2RlbC5leHRlbmQoewogICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqIGdldCB0aGUgbWF0Y2hpbmcgcGVhayBpbmRpY2VzIGZyb20gQSB0byBCCiAgICAgICAgICogQHJldHVybiB7Kn0KICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAqLwogICAgICAgIG1hdGNoSW5kaWNlczogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHZhciBtb3pzQSA9IHNlbGYuZ2V0KCdwa2xBJykubW96cygpOwogICAgICAgICAgICB2YXIgbW96c0IgPSBzZWxmLmdldCgncGtsQicpLm1venMoKTsKCiAgICAgICAgICAgIHZhciBuQSA9IG1venNBLmxlbmd0aDsKICAgICAgICAgICAgdmFyIG5CID0gbW96c0IubGVuZ3RoOwogICAgICAgICAgICBpZiAobkEgKiBuQiA9PSAwKQogICAgICAgICAgICAgICAgcmV0dXJuIFtdOwoKICAgICAgICAgICAgdmFyIGlBID0gMDsKICAgICAgICAgICAgdmFyIGlCID0gMDsKICAgICAgICAgICAgdmFyIGN1ckRlbHRhID0gRGVsdGFNYXNzLnBwbS5kZWx0YShtb3pzQlswXSwgbW96c0FbMF0pOwogICAgICAgICAgICB2YXIgbGFzdE1hdGNoID0gewogICAgICAgICAgICAgICAgaUE6IDAsCiAgICAgICAgICAgICAgICBpQjogMCwKICAgICAgICAgICAgICAgIGVycm9yUFBNOiBjdXJEZWx0YQogICAgICAgICAgICB9OwogICAgICAgICAgICB2YXIgcmV0ID0gW2xhc3RNYXRjaF07CiAgICAgICAgICAgIHdoaWxlIChpQSA8IG5BICYmIGlCIDwgbkIpIHsKICAgICAgICAgICAgICAgIHZhciBpbmNBOwogICAgICAgICAgICAgICAgaWYgKG1venNBW2lBXSA8IG1venNCW2lCXSkgewogICAgICAgICAgICAgICAgICAgIGluY0EgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGlBICs9IDE7CiAgICAgICAgICAgICAgICAgICAgaWYgKGlBID09IG5BKQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaW5jQSA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIGlCICs9IDE7CiAgICAgICAgICAgICAgICAgICAgaWYgKGlCID09IG5CKQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB2YXIgbmV3RGVsdGEgPSBEZWx0YU1hc3MucHBtLmRlbHRhKG1venNCW2lCXSwgbW96c0FbaUFdKTsKICAgICAgICAgICAgICAgIGlmIChNYXRoLmFicyhuZXdEZWx0YSkgPCBNYXRoLmFicyhjdXJEZWx0YSkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAobGFzdE1hdGNoID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbGFzdE1hdGNoID0ge30KICAgICAgICAgICAgICAgICAgICAgICAgcmV0LnB1c2gobGFzdE1hdGNoKTsKCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGxhc3RNYXRjaC5pQSA9IGlBOwogICAgICAgICAgICAgICAgICAgIGxhc3RNYXRjaC5pQiA9IGlCOwogICAgICAgICAgICAgICAgICAgIGxhc3RNYXRjaC5lcnJvclBQTSA9IG5ld0RlbHRhOwoKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgY3VyRGVsdGEgPSA5OTk5OTk5OTk5OTk5OTk5LjA7CiAgICAgICAgICAgICAgICAgICAgbGFzdE1hdGNoID0gdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY3VyRGVsdGEgPSBuZXdEZWx0YTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmV0OwoKICAgICAgICB9LAogICAgICAgIG1hdGNoZXM6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMubWF0Y2hJbmRpY2VzKCk7CiAgICAgICAgfSwKICAgICAgICAvKioKICAgICAgICAgKiBAIHJldHVybiB0aGUgbGlzdCBvZiBtYXRjaGVzIGNsb3NlciB0aGFuIGEgZ2l2ZW4gdG9sZXJhbmNlCiAgICAgICAgICovCiAgICAgICAgY2xvc2VyVGhhblBQTTogZnVuY3Rpb24gKHRvbCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHZhciBtID0gXy5maWx0ZXIoc2VsZi5nZXQoJ21hdGNoZXMnKSwgZnVuY3Rpb24gKG0pIHsKICAgICAgICAgICAgICAgIHJldHVybiAoTWF0aC5hYnMobS5lcnJvclBQTSkgPCB0b2wpCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm4gbQogICAgICAgIH0KICAgIH0pOwp9KTsKCi8qKgogKiBleHRlbmRzIFBlYWtMaXN0UGFpckFsaWdubWVudCB0byBtYXAgdGhlIGNsb3Nlc3QgcGVhayBvZiBhbiBleHBlcmltZW50YWwgYW5kIHRoZW9yZXRpY2FsIHNwZWN0cmEuIEJvdGggbXVzdCBiZSBzb3J0ZWQgYnkgbW96cy4KICogUHJvcGVydGllcyBhcmUKICogLSByaWNoU2VxdWVuY2UKICogLSBleHBTcGVjdHJ1bQogKgogKiBhbGlnbm1lbnQgaXMgcmVjb21wdXRlZCBvbiBwcm9wZXJ0eSBjaGFuZ2UuCiAqCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwoKZGVmaW5lKCdmaXNodG9uZXMvbW9kZWxzL21hdGNoL1BTTUFsaWdubWVudCcsWydqcXVlcnknLCAndW5kZXJzY29yZScsICdCYWNrYm9uZScsICdmaXNodG9uZXMvc2VydmljZXMvZHJ5L01hc3NCdWlsZGVyJywgJy4vUGVha0xpc3RQYWlyQWxpZ25tZW50J10sIGZ1bmN0aW9uKCQsIF8sIEJhY2tib25lLCBtYXNzQnVpbGRlciwgUGVha0xpc3RQYWlyQWxpZ25tZW50KSB7CgogICAgLyoqCiAgICAgKiBidWlsZCB0aGUgYWxpZ25tZW50IHdpdGggb3B0aW9ucyB7cmljaFNlcXVlbmNlOi4uLiwgZXhwU3BlY3RydW06Li4ufQogICAgICovCiAgICB2YXIgUFNNQWxpZ25tZW50ID0gUGVha0xpc3RQYWlyQWxpZ25tZW50LmV4dGVuZCh7CiAgICAgICAgaW5pdGlhbGl6ZSA6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICBQU01BbGlnbm1lbnQuX19zdXBlcl9fLmluaXRpYWxpemUuY2FsbCh0aGlzLCB7fSk7CgogICAgICAgICAgICBzZWxmLnNldCgncmljaFNlcXVlbmNlJywgb3B0aW9ucy5yaWNoU2VxdWVuY2UpOwogICAgICAgICAgICBzZWxmLnNldCgnZXhwU3BlY3RydW0nLCBvcHRpb25zLmV4cFNwZWN0cnVtKTsKCiAgICAgICAgICAgIHNlbGYuYnVpbGQoKQoKICAgICAgICAgICAgc2VsZi5nZXQoJ2V4cFNwZWN0cnVtJykub24oImNoYW5nZSIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgc2VsZi5idWlsZCgpCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIHNlbGYuZ2V0KCdyaWNoU2VxdWVuY2UnKS5vbigiY2hhbmdlIiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBzZWxmLmJ1aWxkKCkKICAgICAgICAgICAgfSkKICAgICAgICAgICAgc2VsZi5vbigiY2hhbmdlOnJpY2hTZXF1ZW5jZSIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgc2VsZi5idWlsZCgpCiAgICAgICAgICAgIH0pCiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogY29tcHV0ZSB0aGUgdW5kZXJseWluZyBhbGlnbm1lbnQKICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAqLwogICAgICAgIGJ1aWxkIDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgICAgICAgIHNlbGYuc2V0KCd0aGVvU3BlY3RydW0nLCBtYXNzQnVpbGRlci5jb21wdXRlVGhlb1NwZWN0cnVtKHNlbGYuZ2V0KCdyaWNoU2VxdWVuY2UnKSkpOwoKICAgICAgICAgICAgc2VsZi5zZXQoJ3BrbEEnLCBzZWxmLmdldCgndGhlb1NwZWN0cnVtJykpCiAgICAgICAgICAgIHNlbGYuc2V0KCdwa2xCJywgc2VsZi5nZXQoJ2V4cFNwZWN0cnVtJykpCgogICAgICAgICAgICB2YXIgbWF0Y2hJbmRpY2VzID0gc2VsZi5tYXRjaEluZGljZXMoKTsKICAgICAgICAgICAgdmFyIHNwVGhlbyA9IHNlbGYuZ2V0KCd0aGVvU3BlY3RydW0nKS5nZXQoJ3BlYWtzJyk7CiAgICAgICAgICAgIHZhciB4cGVha3MgPSBzZWxmLmdldCgnZXhwU3BlY3RydW0nKS5nZXQoJ21venMnKTsKICAgICAgICAgICAgdmFyIHhJbnRlbnNpdGllcyA9IHNlbGYuZ2V0KCdleHBTcGVjdHJ1bScpLmdldCgnaW50ZW5zaXR5UmFua3MnKTsKCiAgICAgICAgICAgIHZhciBtYXRjaGVzID0gXy5tYXAobWF0Y2hJbmRpY2VzLCBmdW5jdGlvbihtaSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHsKCiAgICAgICAgICAgICAgICAgICAgdGhlbyA6IHNwVGhlb1ttaS5pQV0sCiAgICAgICAgICAgICAgICAgICAgZXhwIDogewogICAgICAgICAgICAgICAgICAgICAgICBpbmRleCA6IG1pLmlCLAogICAgICAgICAgICAgICAgICAgICAgICBtb3ogOiB4cGVha3NbbWkuaUJdLAogICAgICAgICAgICAgICAgICAgICAgICBpbnRlbnNpdHlSYW5rIDogeEludGVuc2l0aWVzW21pLmlCXSwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIGVycm9yUFBNIDogbWkuZXJyb3JQUE0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICAgICAgc2VsZi5zZXQoJ21hdGNoZXMnLCBtYXRjaGVzKTsKCiAgICAgICAgfSwKICAgCiAgICAgICAgLyoqCiAgICAgICAgICogZGlmZmVyZW5jZSBiZXR3ZWVuIHRoZSBleHBlcmltZW50YWwgcHJlY3Vyc28gbWFzcyBhbmQgdGhlIHNlcXVlbmNlIG1hc3MgKE1IKQogICAgICAgICAqLwogICAgICAgIGRlbHRhUHJlY01venMgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICB2YXIgeiA9IHNlbGYuZ2V0KCdleHBTcGVjdHJ1bScpLmdldCgncHJlY0NoYXJnZScpOwogICAgICAgICAgICB2YXIgdGhlbyA9IG1hc3NCdWlsZGVyLmNvbXB1dGVNYXNzUmljaFNlcXVlbmNlKHNlbGYuZ2V0KCdyaWNoU2VxdWVuY2UnKSwgeikKICAgICAgICAgICAgcmV0dXJuIChzZWxmLmdldCgnZXhwU3BlY3RydW0nKS5nZXQoJ3ByZWNNb3onKSAtIHRoZW8pICogegogICAgICAgIH0sCiAgICAgICAgLyoqCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIHt7fX0gYSBqc28gcmVhZHkgc3RyaW5nCiAgICAgICAgICovCiAgICAgICAgc2VyaWFsaXplIDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIHJldCA9IHt9OwogICAgICAgICAgICByZXQuZXhwU3BlY3RydW0gPSBzZWxmLmdldCgnZXhwU3BlY3RydW0nKS50b0pTT04oKQoKICAgICAgICAgICAgdmFyIHJzZXEgPSBzZWxmLmdldCgncmljaFNlcXVlbmNlJykudG9TdHJpbmcoKTsKICAgICAgICAgICAgcmV0LnJpY2hTZXF1ZW5jZSA9IHJzZXEKCiAgICAgICAgICAgIHJldC5pZCA9IHNlbGYuY29tcHV0ZUlkKCk7CiAgICAgICAgICAgIHJldC5hYVNlcXVlbmNlID0gc2VsZi5nZXQoJ3JpY2hTZXF1ZW5jZScpLnRvQUFTdHJpbmcoKTsKCiAgICAgICAgICAgIHJldHVybiByZXQ7CiAgICAgICAgfSwKICAgICAgICBjb21wdXRlSWQgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICByZXR1cm4gc2VsZi5nZXQoJ2V4cFNwZWN0cnVtJykuZ2V0KCdpZCcpICsgJ3wnICsgc2VsZi5nZXQoJ3JpY2hTZXF1ZW5jZScpLnRvU3RyaW5nKCkKCiAgICAgICAgfSwKICAgICAgICAvKioKICAgICAgICAgKiByZXR1cm4gdGhlIG51bWJlciBvZiB1bm1hdGNoZWQgZXhwZXJpbWVudGFsIHBlYWssIHdpdGggYSBtYXNzIGdyZWF0ZXIgdGhhbiB0aGUgcHJlY3Vyc29yLAogICAgICAgICAqIGludGVuc2l0eSA8IGluRmlyc3QgYW5kIHdpdGggdG9sIGVycm9yCiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IHRvbAogICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBpbkZpcnN0CiAgICAgICAgICogQHJldHVybiBhbiBpbnRlZ2VyIGNvdW50CiAgICAgICAgICovCiAgICAgICAgdW5tYXRjaGVkRmFjdG9yIDogZnVuY3Rpb24odG9sLCBpbkZpcnN0KSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIG1hdGNoZXMgPSBzZWxmLmNsb3NlclRoYW5QUE0odG9sKTsKCiAgICAgICAgICAgIHZhciBwa3MgPSBfLmZpbHRlcihfLnppcChzZWxmLmdldCgnZXhwU3BlY3RydW0nKS5nZXQoJ21venMnKSwgc2VsZi5nZXQoJ2V4cFNwZWN0cnVtJykuZ2V0KCdpbnRlbnNpdHlSYW5rcycpKSwgZnVuY3Rpb24ocCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHBbMV0gPCBpbkZpcnN0CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgdmFyIG1QcmVjID0gc2VsZi5nZXQoJ2V4cFNwZWN0cnVtJykuZ2V0KCdwcmVjTW96JykKICAgICAgICAgICAgcmV0dXJuIF8uZmlsdGVyKHBrcywgZnVuY3Rpb24ocCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHBbMF0gPiBtUHJlYzsKICAgICAgICAgICAgfSkubGVuZ3RoIC0gXy5maWx0ZXIobWF0Y2hlcywgZnVuY3Rpb24obSkgewogICAgICAgICAgICAgICAgcmV0dXJuIChtLmV4cC5pbnRlbnNpdHlSYW5rIDwgaW5GaXJzdCkgJiYgKG0uZXhwLm1veiA+IG1QcmVjKTsKICAgICAgICAgICAgfSkubGVuZ3RoCgogICAgICAgIH0KICAgIH0pOwogICAKICAgIHJldHVybiBQU01BbGlnbm1lbnQ7Cn0pOwoKLyoqCiAqIGFuIEltcGxpY2l0TW9kaWZpZXIgaXMgdG8gYmUgbGlua2VkIHRvIGxhYmVsbGluZyBvciB0byBhIGdsb2JhbCBhdHRyaWJ1dGlvbiBvZiBtb2RpZmljYXRpb24uCiAqIEl0IGVhc2llciB0byBzYXkgYSBwZXB0aWRlIGlzIFNpbGFjIGVpdGhlciB0aGFuIGFkZGluZyBTaWxhYyBtYXNzIHNoaWZ0IG9pbiBldmVyeSBLICYgUi4KICogVGhpcyBjYW4gYmUgZXZlbiBsaWdodGVyIHdpdGggMTNDMTVOIGxhYmVsLCB3aGVyZSBldmVyeSBhbWlubyBhY2lkIGlzIG1vZGlmaWVkIHdpdGggYSBtYXNzIHNoaWZ0IChyZXByZXNlbnRlZCBhcyBhIHJlc2lkdWUgbW9kaWZpY2F0aW9uKS4KICogTXVsdGlwbGUgbGFiZWxzIGNhbiBiZSBhcHBsaWVkIG9uIHRoZSBzYW1lIHNlcXVlbmNlICh0aGVyZSBpcyBhIGRlZmluZWQgbGlzdCBvZiBwcmVjZWRlbmNlKQogKgogKiBJbXBsaWNpdE1vZGlmaWVyIGhhcyB0byBrbm93IHRoZSBvZGRzIG9mIGVhY2ggbGFiZWxpbmcgbWV0aG9kLiBGb3IgZXhhbXBsZSwgSyBjYW4gc3RpbGwgYmUgcHJvcGlvbnlsYXRlZCBpZiBpdCBoYXMgYSBNZXRoeWwsIGJ1dCBub3QgYSBEaW1ldGh5bC4KICoKICogVGhlIG1haW4gbWV0aG9kIGFyZQogKiBsYWJlbChsYWJOYW1lLCByaWNoU2VxKTogYWRkIGFsbCB0aGUgbGFiZWwgbW9kaWZpY2F0aW9uIHRvIGEgZ2l2ZW4gcGVwdGlkZQogKiB1bmxhYmVsKGxhYk5hbSwgcmljaFNlcXVlbmNlKTogcmVtb3ZlIHRoZSBtb2RpZmljYXRpb24gdGlnaHRlbiB0byB0aGlzIGxhYmVsIChpZiB0aGVyZSB3ZXJlIGVub3VnaCB0byBsYWJlbCB0aGUgc2VxdWVuY2UpLgogKiBnZXRMYWJlbChyaWNoU2VxKTogZ2V0IHRoZSBsYWJlbCBmaXR0aW5nIHRoZSBnaXZlbiByaWNoU2VxdWVuY2UKICoKICogVGhlcmUgaXMgYSB2YXN0IHNldCBvZiB0ZXN0IGF2YWlsYWJsZSBpbiB0aGUgSW1wbGljaXRNb2RpZmllci10ZXN0cy5qcwogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KZGVmaW5lKCdmaXNodG9uZXMvc2VydmljZXMvZHJ5L0ltcGxpY2l0TW9kaWZpZXInLFsnanF1ZXJ5JywgJ3VuZGVyc2NvcmUnLCAnQmFja2JvbmUnLCAnZmlzaHRvbmVzL21vZGVscy9kcnkvUmljaFNlcXVlbmNlJywgJ2Zpc2h0b25lcy9jb2xsZWN0aW9ucy9kcnkvUmVzaWR1ZU1vZGlmaWNhdGlvbkRpY3Rpb25hcnknXSwgZnVuY3Rpb24gKCQsIF8sIEJhY2tib25lLCBSaWNoU2VxdWVuY2UsIGRpY29SZXNNb2QpIHsKCiAgICAvKioKICAgICAqIGxhYmVsZXJzIGFyZSB0aGUgZXNzZW5jZSBvZiB0aGUgaW1wbGljaXQgbGFiZWxsaW5nCiAgICAgKiB0aGV5IGFyZSBmdW5jdGlvbnMsIGRlZmluZWQgZm9yIGVhY2ggcHJvcCwgcHJvcF9kMTAsIHNpbGFjIG9yIHdoYXRldmVyLCB0aGF0IHRha2UgYSByaWNoU2VxdWVuZWNlIGFuZCBhIHBvc2l0aW9uIGFuZCByZXR1cm4gYSBtb2RpZmljYXRpb24gKG9yIHVuZGVmaW5lZCkgdGhhdCBzaG91bGQgb2NjdXIgdGhlcmUuCiAgICAgKiBXZSBuZWVkIGFsbCB0aGF0IGJlY2F1c2UgZm9yIGV4YW1wbGUgZm9yIHByb3Bpb255bGF0aW9uLCB3ZSBtdXN0IGtub3cgaWYgdGhlcmUgaXMgYWxyZWFkbiBhIG1vbm8tIG9yIGEgZGktbWV0aHlsYXRpb24gb24gdGhlIHNpdGUuLi4KICAgICAqCiAgICAgKiBwcm9waW9ueWxMYWJlbGVyIGlzIGp1c3QgYW4gcHJpdmF0ZSBmdW5jdGlvbiB0byBsYWJlbCBLICsgbnRlcm0gd2l0aCBwcm9waW9ueWwgZDAgb3IgZDUKICAgICAqLwoKICAgIHZhciBhcXVhTW9kaWZzID0ge307CiAgICBfLmVhY2goJ1ZETElUR0ZBWScuc3BsaXQoJycpLCBmdW5jdGlvbihhYSl7CiAgICAJYXF1YU1vZGlmc1thYV0gPSAgZGljb1Jlc01vZC5nZXQoJ0FRVUFfJythYSkKICAgIH0pOwogICAgXy5lYWNoKGFxdWFNb2RpZnMsIGZ1bmN0aW9uKG1vZCwgYWEpIHsKICAgICAgICBkaWNvUmVzTW9kLmFkZCh7CiAgICAgICAgICAgIG5hbWUgOiAnZGVfJyArIG1vZC5nZXQoJ25hbWUnKSwKICAgICAgICAgICAgZnVsbE5hbWUgOiAnZGVfJyArIG1vZC5nZXQoJ2Z1bGxOYW1lJyksCiAgICAgICAgICAgIG1hc3MgOiAtbW9kLmdldCgnbWFzcycpCiAgICAgICAgfSk7CiAgICB9KQogICAgdmFyIHByb3Bpb255bExhYmVsZXIgPSBmdW5jdGlvbihwbW9kKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHJpY2hTZXEsIHBvcykgewogICAgICAgICAgICBpZiAocG9zID09IC0xKSB7CiAgICAgICAgICAgICAgICBpZiAocmljaFNlcS5jb3VudE1vZGlmaWNhdGlvbnNBdCgtMSkgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIG1vZHMgPSByaWNoU2VxLm1vZGlmQXQoLTEpOwogICAgICAgICAgICAgICAgICAgIGlmIChtb2RzLmxlbmd0aCA9PSAxICYmIG1vZHNbMF0gPT0gcG1vZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcG1vZDsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHBtb2Q7CiAgICAgICAgICAgICAgICAvLyhyaWNoU2VxLmNvdW50TW9kaWZpY2F0aW9uc0F0KC0xKSA+IDApID8gdW5kZWZpbmVkIDogcG1vZAogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChwb3MgPT0gcmljaFNlcS5zaXplKCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHJpY2hTZXEuYWFBdChwb3MpLmdldCgnY29kZTEnKSA9PT0gJ0snKSB7CiAgICAgICAgICAgICAgICBpZiAoXy5hbnkocmljaFNlcS5tb2RpZkF0KHBvcyksIGZ1bmN0aW9uKHJtKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICEvKE1ldGh5bHxQcm9waW9ueWwuKikvLnRlc3Qocm0uZ2V0KCduYW1lJykpOwogICAgICAgICAgICAgICAgfSkpIHsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBtb2Q7CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9OwogICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgICAgIH0KICAgIH07CgogICAgdmFyIGxhYmVsZXJzID0gewogICAgICAgIG5vbmUgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgICB9LAogICAgICAgIHByb3BfZDAgOiBwcm9waW9ueWxMYWJlbGVyKGRpY29SZXNNb2QuZ2V0KCdQcm9waW9ueWwnKSksCiAgICAgICAgcHJvcF9kNSA6IHByb3Bpb255bExhYmVsZXIoZGljb1Jlc01vZC5nZXQoJ1Byb3Bpb255bDoySCg1KScpKSwKICAgICAgICAnMTNDMTVOJyA6IGZ1bmN0aW9uKHJpY2hTZXEsIHBvcykgewogICAgICAgICAgICBpZiAocG9zID09IC0xIHx8IHBvcyA9PSByaWNoU2VxLnNpemUoKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZAogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgYWEgPSByaWNoU2VxLmFhQXQocG9zKS5nZXQoJ2NvZGUxJyk7CiAgICAgICAgICAgIHJldHVybiBkaWNvUmVzTW9kLmdldCgnMTNDMTVOLScgKyBhYSk7CiAgICAgICAgfSwKICAgICAgICAnYXF1YScgOiBmdW5jdGlvbihyaWNoU2VxLCBwb3MpIHsKICAgICAgICAgICAgaWYgKHBvcyA9PSAtMSB8fCBwb3MgPT0gcmljaFNlcS5zaXplKCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGFxdWFNb2RpZnNbcmljaFNlcS5hYUF0KHBvcykuZ2V0KCdjb2RlMScpXTsKICAgICAgICB9LAogICAgICAgICdkZV9hcXVhJyA6IGZ1bmN0aW9uKHJpY2hTZXEsIHBvcykgewogICAgICAgICAgICBpZiAocG9zID09IC0xIHx8IHBvcyA9PSByaWNoU2VxLnNpemUoKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGFtID0gXy5maWx0ZXIocmljaFNlcS5tb2RpZkF0KHBvcyksIGZ1bmN0aW9uKHJtKXsKICAgICAgICAgICAgICAgIHJldHVybiBybS5nZXQoJ25hbWUnKS5pbmRleE9mKCdBUVVBXycpID09PSAwOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIH0pWzBdOwogICAgICAgICAgICBpZihhbSA9PT0gdW5kZWZpbmVkICl7CiAgICAgICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBkaWNvUmVzTW9kLmdldCgnZGVfJythbS5nZXQoJ25hbWUnKSk7CiAgICAgICAgfSwKICAgICAgICBzaWxhYyA6IGZ1bmN0aW9uKHJpY2hTZXEsIHBvcykgewogICAgICAgICAgICBpZiAocG9zID09IC0xIHx8IHBvcyA9PSByaWNoU2VxLnNpemUoKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZAogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgYWEgPSByaWNoU2VxLmFhQXQocG9zKS5nZXQoJ2NvZGUxJyk7CgogICAgICAgICAgICBpZiAoYWEgPT09ICdLJykgewogICAgICAgICAgICAgICAgcmV0dXJuIGRpY29SZXNNb2QuZ2V0KCdMYWJlbDoxM0MoNikxNU4oMiknKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoYWEgPT09ICdSJykgewogICAgICAgICAgICAgICAgcmV0dXJuIGRpY29SZXNNb2QuZ2V0KCdMYWJlbDoxM0MoNikxNU4oNCknKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgICAgICAgICB1bmRlZmluZWQKICAgICAgICB9LAogICAgICAgICdzdXBlcl9zaWxhYycgOiBmdW5jdGlvbihyaWNoU2VxLCBwb3MpIHsKICAgICAgICAgICAgaWYgKHBvcyA9PSAtMSB8fCBwb3MgPT0gcmljaFNlcS5zaXplKCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBhYSA9IHJpY2hTZXEuYWFBdChwb3MpLmdldCgnY29kZTEnKTsKCiAgICAgICAgICAgIGlmIChhYSA9PT0gJ0snKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZGljb1Jlc01vZC5nZXQoJ0xhYmVsOjEzQyg2KTE1TigyKScpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICAgICAgfQogICAgfTsKICAgIGxhYmVsZXJzLnByb3BfZDVfbnRlcm0gPSBmdW5jdGlvbihyaWNoU2VxLCBwb3MpIHsKICAgICAgICBpZiAocG9zID09IC0xKSB7CiAgICAgICAgICAgIHJldHVybiBkaWNvUmVzTW9kLmdldCgnUHJvcGlvbnlsOjJIKDUpJyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBsYWJlbGVycy5wcm9wX2QwKHJpY2hTZXEsIHBvcyk7CiAgICB9OwogICAgbGFiZWxlcnMucGljID0gZnVuY3Rpb24ocmljaFNlcSwgcG9zKSB7CiAgICAgICAgaWYgKHBvcyAhPSAtMSkgewogICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkCiAgICAgICAgfQogICAgICAgIHJldHVybiBkaWNvUmVzTW9kLmdldCgnUElDJyk7CiAgICAgICAgLy9yZXR1cm4gKHJpY2hTZXEuY291bnRNb2RpZmljYXRpb25zQXQoLTEpID4gMCkgPyB1bmRlZmluZWQgOiBkaWNvUmVzTW9kLmdldCgnUElDJyk7CiAgICB9OwogICAgbGFiZWxlcnMucGljX2hlYXZ5ID0gZnVuY3Rpb24ocmljaFNlcSwgcG9zKSB7CiAgICAgICAgaWYgKHBvcyAhPSAtMSkgewogICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkCiAgICAgICAgfQogICAgICAgIHJldHVybiBkaWNvUmVzTW9kLmdldCgnUElDX0hFQVZZJyk7CiAgICAgICAgLy9yZXR1cm4gKHJpY2hTZXEuY291bnRNb2RpZmljYXRpb25zQXQoLTEpID4gMCkgPyB1bmRlZmluZWQgOiBkaWNvUmVzTW9kLmdldCgnUElDJyk7CiAgICB9OwogICAgdmFyIGxhYmVsZXJzT3JkZXIgPSB7CiAgICAgICAgJzEzQzE1TicgOiAzLAogICAgICAgICdhcXVhJyA6IDQsCiAgICAgICAgJ2RlX2FxdWEnIDogNCwKICAgICAgICBwcm9wX2QwIDogMTAsCiAgICAgICAgcHJvcF9kNSA6IDksCiAgICAgICAgcHJvcF9kNV9udGVybSA6IDE1LAogICAgICAgIHBpYyA6IDUsCiAgICAgICAgcGljX2hlYXZ5IDogNSwKICAgICAgICBzaWxhYyA6IDEwMCwKICAgICAgICBzdXBlcl9zaWxhYyA6IDkwLAogICAgICAgIG5vbmUgOiAxMDAwCiAgICB9CgogICAgSW1wbGljaXRNb2RpZmllciA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICBzZWxmLmxhYmVsZXJzID0gbGFiZWxlcnM7CiAgICAgICAgc2VsZi5sYWJlbGVyc09yZGVyID0gbGFiZWxlcnNPcmRlcjsKCiAgICAgICAgcmV0dXJuIHNlbGYKICAgIH07CgogICAgLyoqCiAgICAgKiBBZGQgYWxsIG1vZGlmaWNhdGlvbiBhc3NvY2lhdGVkIHRvIHRoZSBsYWJlbCBvbiB0aGUgcmljaFNlcXVlbmNlIG9iamVjdAogICAgICogQHBhcmFtIHtPYmplY3R9IGxhYmVsTmFtZXMgYSBjb21tYSBzZXBhcmF0ZWQgbGlzdCBvZiBsYWJlbHMsIG9yIGFuIGFycmF5IG9mIHN0cmluZyAod2UgY2FuIGhhdmUgJ3NpbGFjLHByb3BfZDAnLCBvciAncHJvcF9kNScpCiAgICAgKiBAcGFyYW0ge09iamVjdH0gcmljaFNlcXVlbmNlCiAgICAgKi8KICAgIEltcGxpY2l0TW9kaWZpZXIucHJvdG90eXBlLmxhYmVsID0gZnVuY3Rpb24obGFiZWxOYW1lcywgcmljaFNlcXVlbmNlKSB7CiAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgIHZhciBzID0gcmljaFNlcXVlbmNlLnNpemUoKTsKICAgICAgICBpZiAoISBfLmlzQXJyYXkobGFiZWxOYW1lcykpIHsKICAgICAgICAgICAgbGFiZWxOYW1lcyA9IGxhYmVsTmFtZXMuc3BsaXQoJywnKQogICAgICAgIH0KICAgICAgICBfLmVhY2goXy5zb3J0QnkobGFiZWxOYW1lcywgZnVuY3Rpb24obG5hbWUpIHsKICAgICAgICAgICAgcmV0dXJuIHNlbGYubGFiZWxlcnNPcmRlcltsbmFtZV0gfHwgMTAwMDAwOwogICAgICAgIH0pLCBmdW5jdGlvbihsbmFtZSkgewogICAgICAgICAgICBmb3IgKHZhciBpID0gLTE7IGkgPD0gczsgaSsrKSB7CiAgICAgICAgICAgICAgICB2YXIgbSA9IHNlbGYubGFiZWxlcnNbbG5hbWVdKHJpY2hTZXF1ZW5jZSwgaSk7CiAgICAgICAgICAgICAgICBpZiAobSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgcmljaFNlcXVlbmNlLmFkZE1vZGlmaWNhdGlvbihpLCBtKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0pCiAgICB9CiAgICAvKioKICAgICAqIGp1c3QgcmV0dXJucyBhIHNvcnRlZCAoYWxwaGFudW1lcmljKSBsaXN0IG9mIHRoZSBhdmFpbGFibGUgbGFiZWxzCiAgICAgKi8KICAgIEltcGxpY2l0TW9kaWZpZXIucHJvdG90eXBlLmF2YWlsYWJsZUxhYmVscyA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBfLmtleXModGhpcy5sYWJlbGVycykuc29ydCgpOwogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmUgYWxsIG1vZGlmaWNhdGlvbiBhc3NvY2lhdGVkIHRvIHRoZSBsYWJlbCBvbiB0aGUgcmljaFNlcXVlbmNlIG9iamVjdC4KICAgICAqIEF0IHRoaXMgc3RhZ2UsIHdlIGFzc3VtZSB0aGUgcmljaFNlcXVlbmNlIGhhcyB0aGUgbW9kaWYgYXNzb2NpYXRlZCB3aXRoIHRoZSBsYWJlbAogICAgICogQHBhcmFtIHtPYmplY3R9IGxhYmVsTmFtZXMgYSBjb21tYSBzZXBhcmF0ZWQgbGlzdCBvZiBsYWJlbHMgKHdlIGNhbiBoYXZlICdzaWxhYyxwcm9wX2QwJywgb3IgJ3Byb3BfZDEwJykKICAgICAqIEBwYXJhbSB7T2JqZWN0fSByaXNoU2VxdWVuY2UKICAgICAqLwogICAgSW1wbGljaXRNb2RpZmllci5wcm90b3R5cGUudW5sYWJlbCA9IGZ1bmN0aW9uKGxhYmVsTmFtZXMsIHJpY2hTZXF1ZW5jZSkgewogICAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgICAgdmFyIHMgPSByaWNoU2VxdWVuY2Uuc2l6ZSgpOwogICAgICAgIGlmICghIF8uaXNBcnJheShsYWJlbE5hbWVzKSkgewogICAgICAgICAgICBsYWJlbE5hbWVzID0gbGFiZWxOYW1lcy5zcGxpdCgnLCcpCiAgICAgICAgfQogICAgICAgIF8uZWFjaChfLnNvcnRCeShsYWJlbE5hbWVzLCBmdW5jdGlvbihsbmFtZSkgewogICAgICAgICAgICByZXR1cm4gLShzZWxmLmxhYmVsZXJzT3JkZXJbbG5hbWVdIHx8IDEwMDAwMCk7CiAgICAgICAgfSksIGZ1bmN0aW9uKGxuYW1lKSB7CiAgICAgICAgICAgIGZvciAoIGkgPSAtMTsgaSA8PSBzOyBpKyspIHsKICAgICAgICAgICAgICAgIHZhciBtb2RpZnMgPSByaWNoU2VxdWVuY2UuZ2V0TW9kaWZpY2F0aW9uQXJyYXkoaSk7CiAgICAgICAgICAgICAgICBpZiAoIW1vZGlmcykgewogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbW9kaWZzID0gXy5kaWZmZXJlbmNlKG1vZGlmcywgc2VsZi5sYWJlbGVyc1tsbmFtZV0ocmljaFNlcXVlbmNlLCBpKSk7CiAgICAgICAgICAgICAgICByaWNoU2VxdWVuY2Uuc2V0TW9kaWZpY2F0aW9uQXJyYXkoaSwgbW9kaWZzKQoKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfQogICAgLyoqCiAgICAgKiByZXR1cm5zIGFuIGFycmF5IHdpdGggdGhlIG1vZGlmaWVkIHBvaXNpdGlvbnMsIG9uY2UgbGFiZWluZyBtb2RpZiBoYXZlIGJlZW4gcmVtb3ZlZAogICAgICogKC0xID0+IG50ZXJtKQogICAgICovCiAgICBJbXBsaWNpdE1vZGlmaWVyLnByb3RvdHlwZS5ub25pbXBsaWNpdE1vZGlmaWVkUG9zID0gZnVuY3Rpb24ocmljaFNlcXVlbmNlKSB7CiAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgIHZhciBycyA9IHJpY2hTZXF1ZW5jZS5jbG9uZSgpOwogICAgICAgIHNlbGYuZ2V0TGFiZWxzQW5kQ2xlYW4ocnMpOwogICAgICAgIHJldHVybiBfLmZpbHRlcihfLnJhbmdlKC0xLCBycy5zaXplKCkpLCBmdW5jdGlvbihpKSB7CiAgICAgICAgICAgIHJldHVybiBycy5jb3VudE1vZGlmaWNhdGlvbnNBdChpKSA+IDA7CiAgICAgICAgfSkKICAgIH0KICAgIC8qKgogICAgICogcmV0dXJuIHRydWUvZmFsc2UgaWYgdGhlIFJpY2hTZXF1ZW5jZSBpcyBmaWxsZWQgd2l0aCB0aGUgbW9kaWZpY2F0aW9uIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGdpdmVuIGxhYmVsLgogICAgICogaS5lLiB3ZSBjYW4gcmVtb3ZlIGFsbCB0aGUgbW9kaWYgYW5kIGNvbnNpZGVyIHRoZSBSaWNoU2VxdWVuY2UgYXMgaW1wbGljaXRlbHkgbW9kaWZpZWQKICAgICAqIEBwYXJhbSB7T2JqZWN0fSBsYWJlbE5hbWUgb25lIGxhYmVsIG5hbWUKICAgICAqIEBwYXJhbSB7T2JqZWN0fSByaXNoU2VxdWVuY2UKICAgICAqLwogICAgSW1wbGljaXRNb2RpZmllci5wcm90b3R5cGUuaXNMYWJlbGVkID0gZnVuY3Rpb24obGFiZWxOYW1lLCByaWNoU2VxdWVuY2UpIHsKICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICAgIHZhciBhdExlYXN0T25lID0gZmFsc2UKICAgICAgICByZXR1cm4gXy5hbGwoXy5yYW5nZSgtMSwgcmljaFNlcXVlbmNlLnNpemUoKSArIDEpLCBmdW5jdGlvbihpKSB7CiAgICAgICAgICAgIHZhciBleHBlY3RlZE1vZGlmID0gc2VsZi5sYWJlbGVyc1tsYWJlbE5hbWVdKHJpY2hTZXF1ZW5jZSwgaSk7CiAgICAgICAgICAgIGlmIChleHBlY3RlZE1vZGlmID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChyaWNoU2VxdWVuY2UuY291bnRNb2RpZmljYXRpb25zQXQoaSkgPT0gMCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBhdExlYXN0T25lID0gdHJ1ZTsKCiAgICAgICAgICAgIHJldHVybiBfLmFueShyaWNoU2VxdWVuY2UuZ2V0TW9kaWZpY2F0aW9uQXJyYXkoaSksIGZ1bmN0aW9uKG0pIHsKICAgICAgICAgICAgICAgIHJldHVybiBtID09IGV4cGVjdGVkTW9kaWY7CiAgICAgICAgICAgIH0pOwoKICAgICAgICB9KSAmJiBhdExlYXN0T25lOwoKICAgIH0KICAgIC8qKgogICAgICogY2xlYW4gdXAgdGhlIGltcGxpY2l0IG1vZGlmaWNhdGlvbnMgIGFuZCByZXR1cm4gYSBsaXN0IG9mIChzb3J0ZWQgYWxwaGEpIGxhYmVsIG5hbWVzIHRoYXQgd2VyZSB1c2VkIGZvciBjbGVhbnVwCiAgICAgKiBAcGFyYW0ge09iamVjdH0gcmljaFNlcXVlbmNlCiAgICAgKi8KICAgIEltcGxpY2l0TW9kaWZpZXIucHJvdG90eXBlLmdldExhYmVsc0FuZENsZWFuID0gZnVuY3Rpb24ocmljaFNlcXVlbmNlKSB7CiAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICB2YXIgbGFiZWxzID0gW107CiAgICAgICAgXy5lYWNoKF8uc29ydEJ5KF8ua2V5cyhzZWxmLmxhYmVsZXJzT3JkZXIpLCBmdW5jdGlvbihsbmFtZSkgewogICAgICAgICAgICByZXR1cm4gLShzZWxmLmxhYmVsZXJzT3JkZXJbbG5hbWVdIHx8IDEwMDAwMCk7CiAgICAgICAgfSksIGZ1bmN0aW9uKGxuYW1lKSB7CiAgICAgICAgICAgIGlmICghc2VsZi5pc0xhYmVsZWQobG5hbWUsIHJpY2hTZXF1ZW5jZSkpIHsKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIHNlbGYudW5sYWJlbChsbmFtZSwgcmljaFNlcXVlbmNlKTsKICAgICAgICAgICAgbGFiZWxzLnB1c2gobG5hbWUpCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIGxhYmVscy5zb3J0KCkKICAgIH0KICAgIHJldHVybiBuZXcgSW1wbGljaXRNb2RpZmllcigpOwp9KTsKCi8qKgogKiBhIHJlY3Rhbmd1bGFyLCBubyBsZWdlbmQgY29sb3IgUFNNQWxpZ25tZW50IHdpZGdldAogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KCmRlZmluZSgnZmlzaHRvbmVzL3ZpZXdzL21hdGNoL01hdGNoTWFwU2xpbVZpZXcnLFsndW5kZXJzY29yZScsICdCYWNrYm9uZScsICcuLi9jb21tb25zL0NvbW1vbldpZGdldFZpZXcnLCAnZmlzaHRvbmVzL3NlcnZpY2VzL2RyeS9JbXBsaWNpdE1vZGlmaWVyJ10sIGZ1bmN0aW9uKF8sIEJhY2tib25lLCBDb21tb25XaWRnZXRWaWV3LCBpbXBsaWNpdE1vZGlmaWVyKSB7CgogICAgTWF0Y2hNYXBTbGltVmlldyA9IENvbW1vbldpZGdldFZpZXcuZXh0ZW5kKHsKICAgICAgICBkZWZhdWx0cyA6IHsKICAgICAgICAgICAgaGVpZ2h0IDogMTIsCiAgICAgICAgICAgIHRvbCA6IDUwMAogICAgICAgIH0sCiAgICAgICAgaW5pdGlhbGl6ZSA6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgICAgICAgTWF0Y2hNYXBTbGltVmlldy5fX3N1cGVyX18uaW5pdGlhbGl6ZS5jYWxsKHRoaXMsIGFyZ3VtZW50cykKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICBzZWxmLmhlaWdodCA9IG9wdGlvbnMuaGVpZ2h0IHx8IDEyOwogICAgICAgICAgICBzZWxmLnRvbCA9IG9wdGlvbnMudG9sIHx8IDUwMDsKCiAgICAgICAgfSwKICAgICAgICByZW5kZXIgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICAgICAgdmFyIHRoZW9TcGVjdHJ1bSA9IHNlbGYubW9kZWwuZ2V0KCd0aGVvU3BlY3RydW0nKTsKICAgICAgICAgICAgdmFyIG5iU2VyaWVzID0gdGhlb1NwZWN0cnVtLmdldCgnZnJhZ1NlcmllcycpLmxlbmd0aAoKICAgICAgICAgICAgLy8gZ2V0IGZyYWcgc2VyaWVzIC0+IG9yZGluYXRlCiAgICAgICAgICAgIHZhciBzZXJpZXMyaiA9IHt9OwogICAgICAgICAgICB2YXIgaSA9IDA7CiAgICAgICAgICAgIF8uZWFjaCh0aGVvU3BlY3RydW0uZ2V0KCdmcmFnU2VyaWVzJyksIGZ1bmN0aW9uKGZzKSB7CiAgICAgICAgICAgICAgICBpZiAoc2VyaWVzMmpbZnNbMF1dICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHNlcmllczJqW2ZzWzBdXSA9IGkrKzsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB2YXIgaFJvdyA9IHNlbGYuaGVpZ2h0IC8gXy5rZXlzKHNlcmllczJqKS5sZW5ndGg7CiAgICAgICAgICAgIHZhciB3Q29sID0gaFJvdzsKCiAgICAgICAgICAgIHZhciBsZW5TZXEgPSB0aGVvU3BlY3RydW0uZ2V0KCdsZW5TZXEnKTsKICAgICAgICAgICAgdmFyIHdUZXh0ID0gMzA7CiAgICAgICAgICAgIHZhciB3aWR0aCA9IGxlblNlcSAqIHdDb2wgKyB3VGV4dDsKICAgICAgICAgICAgdmFyIGhlaWdodCA9IHNlbGYuaGVpZ2h0OwoKICAgICAgICAgICAgdmFyIGZzMmogPSBmdW5jdGlvbihmcykgewogICAgICAgICAgICAgICAgcmV0dXJuIChzZXJpZXMyaltmc1swXV0pICogaFJvdzsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBkYXRhIG1hdGNoZXMKICAgICAgICAgICAgdmFyIGRtYXRjaGVzID0gc2VsZi5tb2RlbC5jbG9zZXJUaGFuUFBNKHNlbGYudG9sKTsKCiAgICAgICAgICAgIHZhciByZWN0QmcgPSBzZWxmLmVsLmFwcGVuZCgncmVjdCcpLmF0dHIoJ2NsYXNzJywgJ2JhY2tncm91bmQnKS5hdHRyKCd3aWR0aCcsIHdpZHRoKS5hdHRyKCdoZWlnaHQnLCBoZWlnaHQpCiAgICAgICAgICAgIHZhciBnUm9vdCA9IHNlbGYuZWwuYXBwZW5kKCdnJykuYXR0cignY2xhc3MnLCAnZnJhZy1jb2xvci1tYXRjaCcpOwogICAgICAgICAgICBwcmVjdCA9IGdSb290LnNlbGVjdEFsbCgncmVjdCcpLmRhdGEoZG1hdGNoZXMpLmVudGVyKCkKICAgICAgICAgICAgcHJlY3QuYXBwZW5kKCdyZWN0JykuYXR0cignY2xhc3MnLCBmdW5jdGlvbihkbSkgewogICAgICAgICAgICAgICAgdmFyIGlyayA9IGRtLmV4cC5pbnRlbnNpdHlSYW5rOwogICAgICAgICAgICAgICAgcmV0dXJuICJyay0iICsgKChpcmsgPCA0MCkgPyBNYXRoLmZsb29yKGlyayAvIDEwKSA6ICd4JykKICAgICAgICAgICAgfSkuYXR0cigneCcsIGZ1bmN0aW9uKGRtKSB7CiAgICAgICAgICAgICAgICBpZiAoZG0udGhlby5zZXJpZXMgPCAnZycpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChkbS50aGVvLnBvcyArIDAuNSkgKiB3Q29sCiAgICAgICAgICAgICAgICBpZiAoZG0udGhlby5wb3MgPT0gMCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gMAogICAgICAgICAgICAgICAgcmV0dXJuIChkbS50aGVvLnBvcyAtIDAuNSkgKiB3Q29sCiAgICAgICAgICAgIH0pLmF0dHIoJ3knLCBmdW5jdGlvbihkbSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZzMmooZG0udGhlby5zZXJpZXMpCiAgICAgICAgICAgIH0pLmF0dHIoJ3dpZHRoJywgZnVuY3Rpb24oZG0pIHsKICAgICAgICAgICAgICAgIGlmICgoZG0udGhlby5wb3MgPT0gMCkgJiYgKGRtLnRoZW8uc2VyaWVzID4gJ2cnKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gd0NvbCAvIDI7CiAgICAgICAgICAgICAgICBpZiAoKGRtLnRoZW8ucG9zID09IGxlblNlcSAtIDEpICYmIChkbS50aGVvLnNlcmllcyA8ICdnJykpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdDb2wgLyAyOwogICAgICAgICAgICAgICAgcmV0dXJuIHdDb2w7CiAgICAgICAgICAgIH0pLmF0dHIoJ2hlaWdodCcsIGhSb3cpLmF0dHIoJ3RpdGxlJywgZnVuY3Rpb24oZG0pIHsKICAgICAgICAgICAgICAgIHJldHVybiBkbS50aGVvLmxhYmVsCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgdmFyIG1vZFBvcyA9IGltcGxpY2l0TW9kaWZpZXIubm9uaW1wbGljaXRNb2RpZmllZFBvcyhzZWxmLm1vZGVsLmdldCgncmljaFNlcXVlbmNlJykpOwogICAgICAgICAgICBnUm9vdC5zZWxlY3RBbGwoJ3JlY3QubW9kaWZpZWQtc2l0ZScpLmRhdGEobW9kUG9zKS5lbnRlcigpLmFwcGVuZCgncmVjdCcpLmNsYXNzZWQoJ21vZGlmaWVkLXNpdGUnLCB0cnVlKS5hdHRyKCd4JywgZnVuY3Rpb24oaSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGkgKiB3Q29sOwogICAgICAgICAgICB9KS5hdHRyKCd5JywgMCkuYXR0cignaGVpZ2h0Jywgc2VsZi5oZWlnaHQpLmF0dHIoJ3dpZHRoJywgd0NvbCk7CgogICAgICAgICAgICB2YXIgZyA9IHNlbGYuZWwuYXBwZW5kKCdnJykuYXR0cigndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZSgnICsgKHdpZHRoIC0gd1RleHQpICsgJywwKScpOwogICAgICAgICAgICBnLmFwcGVuZCgncmVjdCcpLmNsYXNzZWQoJ21hdGNoLWJveC10ZXh0LWJnJywgdHJ1ZSkuYXR0cignd2lkdGgnLCB3VGV4dCkuYXR0cignaGVpZ2h0Jywgc2VsZi5oZWlnaHQpOwogICAgICAgICAgICAKICAgICAgICAgICAgZy5hcHBlbmQoJ2cnKS5hdHRyKCd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlKCcrKHdUZXh0IC0gNSkrJywyKSxzY2FsZSgnK2hlaWdodCsnLCcraGVpZ2h0KycpJykuCiAgICAgICAgICAgIGFwcGVuZCgndGV4dCcpLmNsYXNzZWQoJ3VubWF0Y2hlZC1mYWN0b3InLCB0cnVlKS50ZXh0KCIvIiArIHNlbGYubW9kZWwudW5tYXRjaGVkRmFjdG9yKHNlbGYudG9sLCAxMCkpCgogICAgICAgICAgICBzZWxmLmRpbSA9IHsKICAgICAgICAgICAgICAgIGhlaWdodCA6IHNlbGYuaGVpZ2h0LAogICAgICAgICAgICAgICAgd2lkdGggOiB3aWR0aAogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBzZWxmLmRpbQogICAgICAgIH0KICAgIH0pOwoKICAgIHJldHVybiBNYXRjaE1hcFNsaW1WaWV3Owp9KTsKCi8qKgogKiBUaGUgUFEgd2lkZ2V0IChQUSA9ICJ0b2lsZXQgcGFwZXIiIGluIGZyZW5jaCkgaXMgZGlzayBwcm9qZWN0ZWQgZGF0YSwgd2hpY2ggY2FuIGJlIHB1bGxlZCBvZiB3aGVuIG1vdXNpbmcgb3ZlcgogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KCmRlZmluZSgnZmlzaHRvbmVzL3ZpZXdzL3V0aWxzL1BRVmlldycsWyd1bmRlcnNjb3JlJywgJ2QzJ10sIGZ1bmN0aW9uKF8sIGQzKSB7CgogIFBRVmlldyA9IGZ1bmN0aW9uKHRhcmdldCwgb3B0aW9ucykgewogICAgb3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCBvcHRpb25zKTsKICAgIHRoaXMucmFkaXVzID0gb3B0aW9ucy5yYWRpdXMgfHwgNTA7CiAgICB0aGlzLnRpbWUgPSBvcHRpb25zLnRpbWUgfHwgMTI1OwogICAgdGhpcy5yb3RhdGluZyA9IDA7CiAgICB0aGlzLm9uY2xpY2sgPSBvcHRpb25zLm9uY2xpY2s7CgogICAgaWYgKCB0eXBlb2YgdGFyZ2V0ID09ICdvYmplY3QnKSB7CiAgICAgIHRoaXMudmlzID0gdGFyZ2V0LmFwcGVuZCgnZycpCgogICAgfSBlbHNlIHsKICAgICAgdGhpcy52aXMgPSBkMy5zZWxlY3QodGFyZ2V0KS5hcHBlbmQoJ2cnKQogICAgfQogIH0KCiAgUFFWaWV3LnByb3RvdHlwZS5idWlsZCA9IGZ1bmN0aW9uKHNlY3RvckNsYXNzZXMsIHJlY3RCdWlsZEZ1bmN0aW9uKSB7CiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICBzZWxmLmxlbiA9IHNlY3RvckNsYXNzZXMubGVuZ3RoOwogICAgc2VsZi5zZWN0b3JDbGFzc2VzID0gc2VjdG9yQ2xhc3NlczsKCiAgICBzZWxmLnN2Z1JlY3QgPSBzZWxmLnZpcy5hcHBlbmQoJ2cnKS5hdHRyKCd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlKCcrIHNlbGYucmFkaXVzKycsMCknKTsKICAgIHNlbGYucmVjdCA9IHNlbGYuc3ZnUmVjdC5hcHBlbmQoJ2cnKS5hdHRyKCdjbGFzcycsICdyZWN0LWNvbnRhaW5lcicpOwogICAgc2VsZi5kaW1SZWN0ID0gcmVjdEJ1aWxkRnVuY3Rpb24oc2VsZi5yZWN0KTsKICAgIHNlbGYuc3ZnUmVjdC5hdHRyKCd3aWR0aCcsIHNlbGYuZGltUmVjdC53aWR0aCkKCiAgICBzZWxmLnJlY3QuYXR0cigndHJhbnNmb3JtJywgJ3NjYWxlKDAsMSknKTsKICAgIHNlbGYuc3ZnUmVjdC5hdHRyKCd4Jywgc2VsZi5yYWRpdXMpOwogICAgc2VsZi52aXMuYXR0cignaGVpZ2h0JywgMiAqIHNlbGYucmFkaXVzKS5hdHRyKCd3aWR0aCcsIHNlbGYucmFkaXVzICsgc2VsZi5kaW1SZWN0LndpZHRoKTsKCiAgfQoKICBQUVZpZXcucHJvdG90eXBlLmRyYXcgPSBmdW5jdGlvbihvcHRpb25zKSB7CiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICB2YXIgY2lyY2xlID0gc2VsZi52aXMuYXBwZW5kKCdnJykuYXR0cigndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZSgnICsgc2VsZi5yYWRpdXMgKyAnLCcgKyBzZWxmLnJhZGl1cyArICcpJykuYXBwZW5kKCdnJyk7CgogICAgdmFyIGFyYyA9IGQzLnN2Zy5hcmMoKS5vdXRlclJhZGl1cyhzZWxmLnJhZGl1cykuaW5uZXJSYWRpdXMoMCkuc3RhcnRBbmdsZShmdW5jdGlvbih2LCBpKSB7CiAgICAgIHJldHVybiAyICogMy4xNCAqIGkgLyBzZWxmLmxlbjsKICAgIH0pLmVuZEFuZ2xlKGZ1bmN0aW9uKHYsIGkpIHsKICAgICAgcmV0dXJuIDIgKiAzLjE0ICogKGkgKyAxKSAvIHNlbGYubGVuOwogICAgfSk7CiAgICB2YXIgcGNpcmMgPSBjaXJjbGUuc2VsZWN0QWxsKCdnLmNpcmNsZScpLmRhdGEoc2VsZi5zZWN0b3JDbGFzc2VzKS5lbnRlcigpLmFwcGVuZCgnZycpLmF0dHIoJ2NsYXNzJywgJ2NpcmNsZScpOwogICAgcGNpcmMuYXBwZW5kKCdwYXRoJykuYXR0cignZCcsIGFyYykuYXR0cignY2xhc3MnLCBmdW5jdGlvbihkLCBpKSB7CiAgICAgIHJldHVybiBkICsgJyBzZWN0b3Igc2VjdG9yLScgKyBpCiAgICB9KS5hdHRyKCdmaWxsJywgZnVuY3Rpb24oZCkgewogICAgICByZXR1cm4gZDMucmdiKDI1NSAvIDEwICogZCwgMjU1IC8gMTAgKiBkLCAyNTUgLyAxMCAqIGQpCiAgICB9KTsKICAgIHZhciBtc2tDaXJjbGUgPSBjaXJjbGUuYXBwZW5kKCdjaXJjbGUnKS5hdHRyKCdyJywgc2VsZi5yYWRpdXMpLmF0dHIoJ2ZpbGwtb3BhY2l0eScsICcwJykuYXR0cignZmlsbCcsICd5ZWxsb3cnKS5zdHlsZSgnY3Vyc29yJywgJ2hhbmQnKTsKCiAgICBtc2tDaXJjbGUub24oJ21vdXNlb3ZlcicsIGZ1bmN0aW9uKCkgewogICAgICBzZWxmLnJvbGxPdXQoY2lyY2xlKTsKICAgIH0pOwogICAgbXNrQ2lyY2xlLm9uKCdtb3VzZW91dCcsIGZ1bmN0aW9uKCkgewogICAgICBzZWxmLnJvbGxCYWNrKGNpcmNsZSk7CiAgICB9KTsKICAgIGlmIChzZWxmLm9uY2xpY2spIHsKICAgICAgbXNrQ2lyY2xlLm9uKCdjbGljaycsIHNlbGYub25jbGljayk7CiAgICB9CiAgfQoKICBQUVZpZXcucHJvdG90eXBlLm1vdmUgPSBmdW5jdGlvbih4LCB5KSB7CiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICB0aGlzLnZpcy5hdHRyKCd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlKCcgKyAoeCAtIHNlbGYucmFkaXVzKSArICcsJyArICh5IC0gc2VsZi5yYWRpdXMpICsgJyknKS5zdHlsZSgnbGVmdCcsIHggKyAncHgnKS5zdHlsZSgnbGVmdCcsIHkgKyAncHgnKS5zdHlsZSgncG9zaXRpb24nLCAncmVsYXRpdmUnKTsKICAgIHJldHVybiB0aGlzCiAgfQoKICBQUVZpZXcucHJvdG90eXBlLnJvbGxPdXQgPSBmdW5jdGlvbihjaXJjbGUsIG9wdGlvbnMpIHsKICAgIHZhciBzZWxmID0gdGhpczsKICAgIGlmIChzZWxmLnJvdGF0aW5nID4gMCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBzZWxmLnJvdGF0aW5nID0gMTsKICAgIHZhciBjcHQgPSAwOwogICAgdmFyIGR0ID0gc2VsZi50aW1lIC8gc2VsZi5sZW47CiAgICB2YXIgd1JlY3QgPSBzZWxmLmRpbVJlY3Qud2lkdGg7CiAgICBmb3IgKCBpID0gMDsgaSA8IHNlbGYubGVuOyBpKyspIHsKICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICBpZiAoc2VsZi5yb3RhdGluZyA8PSAwKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGNpcmNsZS5hdHRyKCd0cmFuc2Zvcm0nLCAncm90YXRlKCcgKyAoKGNwdCArIDEpIC8gc2VsZi5sZW4gKiAzNjApICsgJyknKTsKICAgICAgICBjcHQrKzsKICAgICAgICBzZWxmLnJlY3QuYXR0cigndHJhbnNmb3JtJywgJ3NjYWxlKCcgKyAoKGkgKyAxKSAvIHNlbGYubGVuKSArICcsMSknKTsKICAgICAgICAvLyk7J3RyYW5zbGF0ZSgnICsgKChjcHQgLSBzZWxmLmxlbikgKiB3UmVjdCAvIHNlbGYubGVuKSArICcsMCknKTsKCiAgICAgICAgY2lyY2xlLnNlbGVjdEFsbCgnLnNlY3Rvci0nICsgKHNlbGYubGVuIC0gY3B0KSkuYXR0cignZGlzcGxheScsICdub25lJyk7CiAgICAgICAgaWYgKGNwdCA9PSBzZWxmLmxlbikgewogICAgICAgICAgc2VsZi5yb3RhdGluZyA9IDA7CiAgICAgICAgfQogICAgICB9LCBpICogZHQpOwogICAgfQogIH0KICBQUVZpZXcucHJvdG90eXBlLnJvbGxCYWNrID0gZnVuY3Rpb24oY2lyY2xlLCBvcHRpb25zKSB7CgogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgaWYgKHNlbGYucm90YXRpbmcgPCAwKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHNlbGYucm90YXRpbmcgPSAtMTsKICAgIHZhciBjcHQgPSBzZWxmLmxlbiAtIDE7CiAgICB2YXIgZHQgPSBzZWxmLnRpbWUgLyBzZWxmLmxlbjsKICAgIHZhciB3UmVjdCA9IHNlbGYuZGltUmVjdC53aWR0aDsKICAgIGZvciAoIGkgPSAwOyBpIDwgc2VsZi5sZW47IGkrKykgewogICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgIGlmIChzZWxmLnJvdGF0aW5nID49IDApIHsKICAgICAgICAgIHJldHVybgogICAgICAgIH0KICAgICAgICBjaXJjbGUuYXR0cigndHJhbnNmb3JtJywgJ3JvdGF0ZSgnICsgKGNwdCAvIHNlbGYubGVuICogMzYwKSArICcpJyk7CiAgICAgICAgLy8gICAgICAgIHZhciB0ciA9ICd0cmFuc2xhdGUoJyArICgoY3B0IC0gc2VsZi5sZW4pICogd1JlY3QgLyBzZWxmLmxlbikgKyAnLDApJzsKICAgICAgICB2YXIgdHIgPSAnc2NhbGUoJyArICgxIC0gaSAvIHNlbGYubGVuKSArICcsMSknOwogICAgICAgIHNlbGYucmVjdC5hdHRyKCd0cmFuc2Zvcm0nLCB0cik7CgogICAgICAgIHZhciBzZWwgPSAnLnNlY3Rvci0nICsgKHNlbGYubGVuIC0gY3B0IC0gMSk7CiAgICAgICAgY2lyY2xlLnNlbGVjdEFsbChzZWwpLmF0dHIoJ2Rpc3BsYXknLCBudWxsKQogICAgICAgIGNwdC0tOwogICAgICAgIGlmIChjcHQgPCAwKSB7CiAgICAgICAgICBzZWxmLnJvdGF0aW5nID0gMDsKICAgICAgICB9CiAgICAgIH0sIGkgKiBkdCk7CiAgICB9CgogIH0KCiAgcmV0dXJuIFBRVmlldzsKfSk7CgovKgogKiB3aXRkZ2V0IHRvIGRpc3BsYXkgUFNNLCBiYXNlZCBvbiB0aGUgc3BlY3RydW0gcGVyc3BlY3RpdmUKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCmRlZmluZSgnZmlzaHRvbmVzL3ZpZXdzL21hdGNoL01hdGNoU3BlY3RydW1WaWV3JyxbJ3VuZGVyc2NvcmUnLCAnZDMnLCAnLi4vY29tbW9ucy9Db21tb25XaWRnZXRWaWV3JywgJ2Zpc2h0b25lcy92aWV3cy91dGlscy9EM1NjYWxpbmdDb250ZXh0JywgJ2Zpc2h0b25lcy92aWV3cy91dGlscy9EM1NjYWxpbmdBcmVhJ10sIGZ1bmN0aW9uIChfLCBkMywgQ29tbW9uV2lkZ2V0VmlldywgRDNTY2FsaW5nQ29udGV4dCwgRDNTY2FsaW5nQXJlYSkgewoKICAgIE1hdGNoU3BlY3RydW1WaWV3ID0gQ29tbW9uV2lkZ2V0Vmlldy5leHRlbmQoewogICAgICAgIGRlZmF1bHRzOiB7CiAgICAgICAgfSwKICAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbiAob3B0aW9ucykgewogICAgICAgICAgICBNYXRjaFNwZWN0cnVtVmlldy5fX3N1cGVyX18uaW5pdGlhbGl6ZS5jYWxsKHRoaXMsIG9wdGlvbnMpCiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgICAgICAgIG9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgb3B0aW9ucyk7CiAgICAgICAgICAgIHNlbGYub3B0aW9ucyA9IG9wdGlvbnM7CgogICAgICAgICAgICBzZWxmLnRvbCA9IG9wdGlvbnMudG9sIHx8IDUwMDsKCiAgICAgICAgICAgIHNlbGYuaGVpZ2h0WEF4aXMgPSAyMTsKICAgICAgICAgICAgc2VsZi5wZWFrc0Jhc2VsaW5lSGVpZ2h0ID0gMTA7CgogICAgICAgICAgICBpZiAob3B0aW9ucy5mbHlpbmcpIHsKICAgICAgICAgICAgICAgIHNlbGYuZWwgPSBkMy5zZWxlY3QoJ2JvZHknKTsKICAgICAgICAgICAgICAgIHNlbGYuaXNGbHlpbmcgPSB0cnVlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgc2VsZi5pc0ZseWluZyA9IGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHNlbGYucF9zZXR1cCgpOwoKICAgICAgICAgICAgaWYgKHNlbGYub3B0aW9ucy54Wm9vbWFibGUpIHsKICAgICAgICAgICAgICAgIHNlbGYueFpvb21hYmxlKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgfSwKICAgICAgICBwX3NldHVwOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgLy8gdmFyIGV2dCA9IGQzLm1vdXNlKHNlbGYuY29udGFpbmVyKTsKICAgICAgICAgICAgc2VsZi52aXMgPSBzZWxmLmVsLmFwcGVuZCgnc3ZnJykKICAgICAgICAgICAgc2VsZi52aXMuYXR0cignd2lkdGgnLCBzZWxmLndpZHRoKCkpLmF0dHIoJ2hlaWdodCcsIHNlbGYuaGVpZ2h0KCkpLmF0dHIoJ2NsYXNzJywgJ2QzLXdpZGdldC1tYXRjaC1zcGVjdHJ1bScpOwogICAgICAgICAgICBpZiAoc2VsZi5pc0ZseWluZykgewogICAgICAgICAgICAgICAgdmFyIHggPSBkMy5ldmVudC5wYWdlWCArIDEwOwogICAgICAgICAgICAgICAgdmFyIHkgPSBkMy5ldmVudC5wYWdlWSAtIHNlbGYuaGVpZ2h0KCkgKiAyIC8gMzsKICAgICAgICAgICAgICAgIHNlbGYudmlzLnN0eWxlKCdsZWZ0JywgeCArICdweCcpLnN0eWxlKCd0b3AnLCB5ICsgJ3B4Jyk7CiAgICAgICAgICAgICAgICBzZWxmLnBfZmx5aW5nX2RvbnRfZmx5X2F3YXkoKTsKCiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gc2VsZi52aXMuYXBwZW5kKCdyZWN0JykuYXR0cignd2lkdGgnLCAnMTAwJScpLmF0dHIoJ2hlaWdodCcsICcxMDAlJykuYXR0cignZmlsbCcsICcjZGRkJykuYXR0cignY2xhc3MnLCAnYmFja2dyb3VuZCcpOwoKICAgICAgICAgICAgc2VsZi5wX3NldHVwX3RpdGxlKCk7CgogICAgICAgICAgICBpZiAoc2VsZi5pc0ZseWluZykgewogICAgICAgICAgICAgICAgc2VsZi5idXR0b25Db250YWluZXIgPSBzZWxmLnZpcy5hcHBlbmQoJ2cnKS5hdHRyKCdjbGFzcycsICdidXR0b24tY29udGFpbmVyIHJpZ2h0LWFsaWduJykuYXR0cigndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZSgnICsgc2VsZi53aWR0aCgpICsgJywwKScpCiAgICAgICAgICAgICAgICBzZWxmLnBfc2V0dXBfbWVudV9idXR0b25zKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGFkZCBzcGVjdHJ1bQogICAgICAgICAgICB2YXIgZXhwU3AgPSBzZWxmLm1vZGVsLmdldCgnZXhwU3BlY3RydW0nKTsKICAgICAgICAgICAgdmFyIGhTcGVjdHJ1bSA9IHNlbGYuaGVpZ2h0KCkgLSAyMCAtIHNlbGYuaGVpZ2h0WEF4aXM7CgogICAgICAgICAgICBzZWxmLnBfYnVpbGRfZGF0YSgpOwogICAgICAgICAgICBzZWxmLnNldHVwU2NhbGluZ0NvbnRleHQoewogICAgICAgICAgICAgICAgeERvbWFpbjogW2V4cFNwLmdldCgnbW96cycpWzBdICogMC45NSwgZXhwU3AuZ2V0KCdtb3pzJylbZXhwU3Auc2l6ZSgpIC0gMV0gKiAxLjA1XSwKICAgICAgICAgICAgICAgIHlEb21haW46IFswLCBfLm1heChfLnBsdWNrKHNlbGYuZGF0YS5wZWFrcywgJ3knKSkgKiAxLjJdLAogICAgICAgICAgICAgICAgaGVpZ2h0OiBoU3BlY3RydW0gLSBzZWxmLnBlYWtzQmFzZWxpbmVIZWlnaHQsCiAgICAgICAgICAgICAgICB3aWR0aDogc2VsZi53aWR0aCgpCiAgICAgICAgICAgIH0pCgogICAgICAgICAgICB2YXIgc3Znc3AgPSBzZWxmLnZpcy5hcHBlbmQoJ2cnKS5hdHRyKCd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlKDAsMjApJyk7CiAgICAgICAgICAgIHNlbGYuc3Znc3AgPSBzdmdzcDsKCiAgICAgICAgICAgIHNlbGYuc2NhbGluZ0FyZWEgPSBuZXcgRDNTY2FsaW5nQXJlYSh7CiAgICAgICAgICAgICAgICBlbDogc3Znc3AsCiAgICAgICAgICAgICAgICBtb2RlbDogc2VsZi5zY2FsaW5nQ29udGV4dCwKICAgICAgICAgICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgc2VsZi5yZW5kZXIoKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGhlaWdodDogaFNwZWN0cnVtLAogICAgICAgICAgICAgICAgd2lkdGg6IHNlbGYud2lkdGgoKQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHNlbGYuZDNIb2xkZXJYQXhpcyA9IHN2Z3NwLmFwcGVuZCgnZycpLmF0dHIoJ2NsYXNzJywgJ3hheGlzJykuYXR0cigndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZSgwLCcgKyBoU3BlY3RydW0gKyAnKScpOwogICAgICAgICAgICBzZWxmLmQzaG9sZGVyUHJlY3Vyc29yID0gc3Znc3Auc2VsZWN0QWxsKCdnLnByZWN1cnNvcicpLmRhdGEoc2VsZi5kYXRhLnByZWN1cnNvcikuZW50ZXIoKS5hcHBlbmQoJ2cnKQogICAgICAgICAgICBzZWxmLmQzaG9sZGVyUHJlY3Vyc29yLmFwcGVuZCgncGF0aCcpLmF0dHIoJ2NsYXNzJywgJ3ByZWN1cnNvcicpLmF0dHIoJ2QnLCAnTTAsLTIwTDEwLDBMLTEwLDBMMCwtMjAnKS5hdHRyKCd4JywgZnVuY3Rpb24gKHApIHsKICAgICAgICAgICAgICAgIHJldHVybiBwLng7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBzZWxmLmQzaG9sZGVyUGVha3MgPSBzdmdzcC5zZWxlY3RBbGwoJ2xpbmUucGVhaycpLmRhdGEoc2VsZi5kYXRhLnBlYWtzKS5lbnRlcigpLmFwcGVuZCgnbGluZScpLmF0dHIoJ2NsYXNzJywgZnVuY3Rpb24gKHBrKSB7CiAgICAgICAgICAgICAgICB2YXIgY2xhenogPSAncGVhayc7CiAgICAgICAgICAgICAgICBpZiAocGsubGFiZWwgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgIGNsYXp6ICs9ICcgbWF0Y2hlZCBmcmFnLXNlcmllcy0nICsgcGsubGFiZWwubGFiZWwuc2VyaWVzLnJlcGxhY2UoJysrJywgJycpCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGNsYXp6ICs9ICcgdW5tYXRjaGVkJwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGNsYXp6CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBzZWxmLmQzaG9sZGVyUGVha3NUcnVuY2F0ZWQgPSBzdmdzcC5zZWxlY3RBbGwoJ2xpbmUucGVhay10cnVuY2F0ZWQnKS5kYXRhKHNlbGYuZGF0YS5wZWFrc1RydW5jYXRlZCkuZW50ZXIoKS5hcHBlbmQoJ2xpbmUnKTsKCiAgICAgICAgICAgIHNlbGYucF9zZXR1cF9sYWJlbHMoKTsKCiAgICAgICAgfSwKICAgICAgICAvKioKICAgICAgICAgKiBkaXYgd2l0aCBmbHlpbmcgc3BlY3RydW0gaXMgcG9pc3Rpb24gc29td2hlcmUgKGJ5IHRoZSB2ZW50c291cmNlLCBmb3IgZXhhbXBsZSkKICAgICAgICAgKiBuZXJ2ZXJ0aGVsZXNzLCBpdCBzaG91bGQgbm90IGdvIG91dHNpZGUgdGhlIG1haW4gd2luZG93CiAgICAgICAgICovCiAgICAgICAgcF9mbHlpbmdfZG9udF9mbHlfYXdheTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICAgICAgICB2YXIgeCA9IHBhcnNlSW50KHNlbGYudmlzLnN0eWxlKCdsZWZ0JykpOwogICAgICAgICAgICB2YXIgeSA9IHBhcnNlSW50KHNlbGYudmlzLnN0eWxlKCd0b3AnKSk7CiAgICAgICAgICAgIHZhciBtaW5EaXN0ID0gMjA7CgogICAgICAgICAgICB4ID0gTWF0aC5tYXgoeCwgbWluRGlzdCk7CiAgICAgICAgICAgIHggPSBNYXRoLm1pbih4LCB3aW5kb3cuaW5uZXJXaWR0aCAtIHNlbGYud2lkdGgoKSAtIG1pbkRpc3QpOwoKICAgICAgICAgICAgeSA9IE1hdGgubWF4KHksIG1pbkRpc3QpOwogICAgICAgICAgICB5ID0gTWF0aC5taW4oeSwgJChkb2N1bWVudCkuaGVpZ2h0KCkgLSBzZWxmLmhlaWdodCgpIC0gbWluRGlzdCkKCiAgICAgICAgICAgIHNlbGYudmlzLnN0eWxlKCdsZWZ0JywgeCkKICAgICAgICAgICAgc2VsZi52aXMuc3R5bGUoJ3RvcCcsIHkpCgogICAgICAgIH0sCiAgICAgICAgcF9zZXR1cF9sYWJlbHM6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICAgICAgc2VsZi5zdmdzcC5zZWxlY3RBbGwoJ2cubGFiZWwnKS5yZW1vdmUoKTsKICAgICAgICAgICAgc2VsZi5kM2hvbGRlckxhYmVscyA9IHNlbGYuc3Znc3Auc2VsZWN0QWxsKCdnLmxhYmVsJykuZGF0YShzZWxmLmRhdGEubGFiZWxzKS5lbnRlcigpLmFwcGVuZCgnZycpOwogICAgICAgICAgICBzZWxmLmQzaG9sZGVyTGFiZWxzUGF0aCA9IHNlbGYuZDNob2xkZXJMYWJlbHMuYXBwZW5kKCdwYXRoJykKICAgICAgICAgICAgc2VsZi5kM2hvbGRlckxhYmVsc1RleHRHID0gc2VsZi5kM2hvbGRlckxhYmVscy5hcHBlbmQoJ2cnKQogICAgICAgICAgICBzZWxmLmQzaG9sZGVyTGFiZWxzVGV4dCA9IHNlbGYuZDNob2xkZXJMYWJlbHNUZXh0Ry5hcHBlbmQoJ3RleHQnKQogICAgICAgICAgICByZXR1cm4gc2VsZgogICAgICAgIH0sCiAgICAgICAgcF9zZXR1cF90aXRsZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIC8vIHRpdGxlCiAgICAgICAgICAgIHZhciBleHBTcCA9IHNlbGYubW9kZWwuZ2V0KCdleHBTcGVjdHJ1bScpCiAgICAgICAgICAgIHZhciB0aXRsZSA9ICdzY2FuOiAnICsgZXhwU3AuZ2V0KCdzY2FuTnVtYmVyJykgKyAnICgnICsgKE1hdGgucm91bmQoZXhwU3AuZ2V0KCdyZXRlbnRpb25UaW1lJykpIC8gNjApLnRvRml4ZWQoMSkgKyAnbWluKSAnICsgZXhwU3AuZ2V0KCdwcmVjQ2hhcmdlJykgKyAnKyAnICsgZXhwU3AuZ2V0KCdwcmVjTW96JykudG9GaXhlZCg0KSArICdEYSc7CiAgICAgICAgICAgIHNlbGYudmlzLmFwcGVuZCgndGV4dCcpLmF0dHIoJ3gnLCA1KS5hdHRyKCd5JywgNSkuYXR0cignY2xhc3MnLCAndGl0bGUnKS50ZXh0KHRpdGxlKTsKICAgICAgICAgICAgc2VsZi52aXMuYXBwZW5kKCdyZWN0JykuYXR0cignaGVpZ2h0JywgJzIwJykuYXR0cignd2lkdGgnLCAnMTAwJScpLmF0dHIoJ2NsYXNzJywgJ3RpdGxlJykudGV4dCh0aXRsZSk7CgogICAgICAgIH0sCiAgICAgICAgcF9uZXdfYnV0dG9uOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIG4gPSBzZWxmLmJ1dHRvbkNvbnRhaW5lci5zZWxlY3RBbGwoJ2cuYnV0dG9uLWNvbnRhaW5lcicpWzBdLmxlbmd0aAogICAgICAgICAgICByZXR1cm4gc2VsZi5idXR0b25Db250YWluZXIuYXBwZW5kKCdnJykuYXR0cignY2xhc3MnLCAnYnV0dG9uLWNvbnRhaW5lcicpLmF0dHIoJ3RyYW5zZm9ybScsICd0cmFuc2xhdGUoLScgKyAobiArIDEpICogNDIgKyAnLDIpJyk7CiAgICAgICAgfSwKICAgICAgICBwX3NldHVwX21lbnVfYnV0dG9uczogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICAgICAgICB2YXIgYWRkQnV0dG9uID0gZnVuY3Rpb24gKGdidXQsIHRleHQsIG9wdGlvbnMpIHsKICAgICAgICAgICAgICAgIHZhciBlbFdyYXBwZXIgPSBnYnV0LmFwcGVuZCgnZycpOwogICAgICAgICAgICAgICAgLy8uYXR0cigndHJhbnNmb3JtJywgJ3NjYWxlKCcgKyAob3B0aW9ucy5zaXplIC8gNDApICsgJywnICsgKG9wdGlvbnMuc2l6ZSAvIDQwKSArICcpJyk7CiAgICAgICAgICAgICAgICBnYnV0LmNsYXNzZWQoJ2J1dHRvbicsIHRydWUpOwogICAgICAgICAgICAgICAgZWxXcmFwcGVyLmFwcGVuZCgncmVjdCcpLmF0dHIoJ3dpZHRoJywgNDApLmF0dHIoJ2hlaWdodCcsIDE2KS5hdHRyKCdyeCcsIDQpLmF0dHIoJ3J5JywgNCkuY2xhc3NlZCgnYnV0dG9uJywgdHJ1ZSk7CiAgICAgICAgICAgICAgICBnYnV0LmFwcGVuZCgndGV4dCcpLmF0dHIoJ3gnLCAyMCkuYXR0cigneScsIDExKS50ZXh0KHRleHQpOwogICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5jdXJzb3IpIHsKICAgICAgICAgICAgICAgICAgICBnYnV0LnN0eWxlKCdjdXJzb3InLCBvcHRpb25zLmN1cnNvcik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gZ2J1dDsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBjbG9zZQogICAgICAgICAgICB2YXIgZ2J1dCA9IHNlbGYucF9uZXdfYnV0dG9uKCk7CiAgICAgICAgICAgIGFkZEJ1dHRvbihnYnV0LCAnY2xvc2UnKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBzZWxmLmNsb3NlKCkKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAvLyByZXNpemUKICAgICAgICAgICAgZ2J1dCA9IHNlbGYucF9uZXdfYnV0dG9uKCk7CgogICAgICAgICAgICBhZGRCdXR0b24oZ2J1dCwgJ2xhcmdlcicpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGlmIChzZWxmLmhlaWdodCgpIDwgMzAwKSB7CiAgICAgICAgICAgICAgICAgICAgc2VsZi5yZXNpemUoewogICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDQwMCwKICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IE1hdGgubWluKCQoZG9jdW1lbnQpLndpZHRoKCkgKiAwLjksIDEwMDApCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgc2VsZi5yZXNpemUoewogICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDIwMCwKICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDUwMAogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAvLyBkcmFnCiAgICAgICAgICAgIGdidXQgPSBzZWxmLnBfbmV3X2J1dHRvbigpOwogICAgICAgICAgICBhZGRCdXR0b24oZ2J1dCwgJ21vdmUnLCB7CiAgICAgICAgICAgICAgICBjdXJzb3I6ICdtb3ZlJwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgLy8gc2V0dXAgZHJhZ2dpbgogICAgICAgICAgICB2YXIgZHJhZ0Nvb3JkID0gewogICAgICAgICAgICAgICAgeDogMTAwMCwKICAgICAgICAgICAgICAgIHk6IDEwMDAKICAgICAgICAgICAgfTsKICAgICAgICAgICAgdmFyIGRyYWcgPSBkMy5iZWhhdmlvci5kcmFnKCkub24oImRyYWdzdGFydCIsIGZ1bmN0aW9uIChkKSB7CiAgICAgICAgICAgICAgICBkcmFnQ29vcmQgPSB7CiAgICAgICAgICAgICAgICAgICAgbXg6IGQzLmV2ZW50LnNvdXJjZUV2ZW50LnBhZ2VYLAogICAgICAgICAgICAgICAgICAgIG15OiBkMy5ldmVudC5zb3VyY2VFdmVudC5wYWdlWSwKICAgICAgICAgICAgICAgICAgICB2eDogcGFyc2VJbnQoc2VsZi52aXMuc3R5bGUoJ2xlZnQnKS5yZXBsYWNlKCdweCcsICcnKSksCiAgICAgICAgICAgICAgICAgICAgdnk6IHBhcnNlSW50KHNlbGYudmlzLnN0eWxlKCd0b3AnKS5yZXBsYWNlKCdweCcsICcnKSksCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9KS5vbigiZHJhZyIsIGZ1bmN0aW9uIChkKSB7CiAgICAgICAgICAgICAgICBteCA9IGQzLmV2ZW50LnNvdXJjZUV2ZW50LnBhZ2VYOwogICAgICAgICAgICAgICAgbXkgPSBkMy5ldmVudC5zb3VyY2VFdmVudC5wYWdlWTsKCiAgICAgICAgICAgICAgICBzZWxmLnZpcy5zdHlsZSgibGVmdCIsIChkcmFnQ29vcmQudnggKyBteCAtIGRyYWdDb29yZC5teCkgKyAncHgnKS5zdHlsZSgidG9wIiwgKGRyYWdDb29yZC52eSArIG15IC0gZHJhZ0Nvb3JkLm15KSArICdweCcpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgZ2J1dC5jYWxsKGRyYWcpOwoKICAgICAgICAgICAgLy9lZGl0CiAgICAgICAgICAgIGlmIChzZWxmLm9wdGlvbnMuZWRpdFVybCkgewogICAgICAgICAgICAgICAgZ2J1dCA9IHNlbGYucF9uZXdfYnV0dG9uKCk7CgogICAgICAgICAgICAgICAgYWRkQnV0dG9uKGdidXQsICdlZGl0Jyk7CiAgICAgICAgICAgICAgICBnYnV0Lm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cub3BlbihzZWxmLm9wdGlvbnMuZWRpdFVybCwgJ2VwaS1zaG93X19JRF9JTlRFUkFDVElWRV9fWElDJykKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIC8vIC8vLmFwcGVuZCgndGV4dCcpLmF0dHIoJ3knLCAxNCkudGV4dCgnPycpCiAgICAgICAgICAgICAgICAvLyB2YXIgYiA9IGQzR2x5cGhpY29ucy5hcHBlbmQoYSwgJ2Jpbm9jdWxhcnMnLCB7CiAgICAgICAgICAgICAgICAvLyBzaXplIDogMjQsCiAgICAgICAgICAgICAgICAvLyBidXR0b24gOiB0cnVlCiAgICAgICAgICAgICAgICAvLyB9KTsKCiAgICAgICAgICAgIH0KCiAgICAgICAgfSwKICAgICAgICAvKgogICAgICAgICAqIGJ1aWxkIGRhdGEgcmVhZHkgZm9yIHBsb3R0aW5nOiAtIHBlYWtzIC0gbGFiZWwgLSBwcmVjdXJzb3IKICAgICAgICAgKiBUT0RPOiBhdHRhY2hlIGxhYmVsIHRvIHBlYWssIGZpbHRlciBkYXRhIG9uIF8ucGx1Y2socGVha3MsICdsYWJlbCcpLmZpbHRlcihmdW5jdGlvbihsKXtyZXR1cm4gbCE9PSB1bmRlZmluZWR9KQogICAgICAgICAqIHNvIGV2ZXJ5dGhpbmcgaXMgYXR0YWNoZWQgdG9nZXRoZXIgYXQgb25jZQogICAgICAgICAqIFRPRE8gYXR0YWNoZSB0aGUgdHJ1bmNhdGVkIGluZm8gaW4gdGhlIHNhbWUgd2F5LgogICAgICAgICAqIFRPRE8gYXQgdmlldyB0aW1lLCB3ZSBjYW4gc3RhcnQgZXZlcnkgdGhpbmcgb24gYSBnIHNoaWZ0IHRvIHRoZSBjb3JyZWN0IHBvc2l0aW9uCiAgICAgICAgICovCiAgICAgICAgcF9idWlsZF9kYXRhOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIGV4cFNwID0gc2VsZi5tb2RlbC5nZXQoJ2V4cFNwZWN0cnVtJyk7CgogICAgICAgICAgICB2YXIgcmV0ID0ge307CiAgICAgICAgICAgIHZhciBkbWF0Y2hlcyA9IHNlbGYubW9kZWwuY2xvc2VyVGhhblBQTShzZWxmLnRvbCkKCiAgICAgICAgICAgIHZhciBsYWJlbGVkUGVha3MgPSBbXTsKICAgICAgICAgICAgcmV0LmxhYmVscyA9IF8uY29sbGVjdChkbWF0Y2hlcywgZnVuY3Rpb24gKGRtKSB7CiAgICAgICAgICAgICAgICB2YXIgcmV0ID0gewogICAgICAgICAgICAgICAgICAgIHg6IGRtLmV4cC5tb3osCiAgICAgICAgICAgICAgICAgICAgeTogZXhwU3AuZ2V0KCdpbnRlbnNpdGllcycpW2RtLmV4cC5pbmRleF0sCiAgICAgICAgICAgICAgICAgICAgbGFiZWw6IGRtLnRoZW8KICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBsYWJlbGVkUGVha3NbZG0uZXhwLmluZGV4XSA9IHJldDsKICAgICAgICAgICAgICAgIHJldHVybiByZXQ7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgcmV0LnBlYWtzID0gXy5jb2xsZWN0KF8uemlwKGV4cFNwLmdldCgnbW96cycpLCBleHBTcC5nZXQoJ2ludGVuc2l0aWVzJyksIGV4cFNwLmdldCgnaW50ZW5zaXR5UmFua3MnKSksIGZ1bmN0aW9uIChwLCBpKSB7CiAgICAgICAgICAgICAgICB2YXIgcGsgPSB7CiAgICAgICAgICAgICAgICAgICAgeDogcFswXSwKICAgICAgICAgICAgICAgICAgICB5OiBwWzFdLAogICAgICAgICAgICAgICAgICAgIGludFJhbms6IHBbMl0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChsYWJlbGVkUGVha3NbaV0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgIHBrLmxhYmVsID0gbGFiZWxlZFBlYWtzW2ldOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHBrOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0LnBlYWtzVHJ1bmNhdGVkID0gW10KICAgICAgICAgICAgdmFyIHNvcnRlZEludGVuc2l0aWVzID0gXy5jaGFpbihyZXQucGVha3MpLnBsdWNrKCd5Jykuc29ydChmdW5jdGlvbiAoYSwgYikgewogICAgICAgICAgICAgICAgcmV0dXJuIGIgLSBhCiAgICAgICAgICAgIH0pLnZhbHVlKCk7CiAgICAgICAgICAgIGlmIChzb3J0ZWRJbnRlbnNpdGllc1swXSA+IDEuNSAqIHNvcnRlZEludGVuc2l0aWVzWzFdKSB7CiAgICAgICAgICAgICAgICB2YXIgbWF4SW50ZW5zID0gc29ydGVkSW50ZW5zaXRpZXNbMV0gKiAxLjE7CiAgICAgICAgICAgICAgICBfLmNoYWluKHJldC5wZWFrcykuZmlsdGVyKGZ1bmN0aW9uIChwKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHAueSA+IG1heEludGVucwogICAgICAgICAgICAgICAgfSkuZWFjaChmdW5jdGlvbiAocCkgewogICAgICAgICAgICAgICAgICAgIHAueSA9IG1heEludGVuczsKICAgICAgICAgICAgICAgICAgICByZXQucGVha3NUcnVuY2F0ZWQucHVzaChwKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXQucHJlY3Vyc29yID0gWwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIHg6IGV4cFNwLmdldCgncHJlY01veicpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIF0KCiAgICAgICAgICAgIHNlbGYuZGF0YSA9IHJldDsKICAgICAgICAgICAgcmV0dXJuIHJldDsKICAgICAgICB9LAogICAgICAgIGNsb3NlOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHRoaXMudmlzLnJlbW92ZSgpOwogICAgICAgIH0sCgogICAgICAgIHJlc2l6ZTogZnVuY3Rpb24gKG9wdGlvbnMpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICAgICAgdmFyIGggPSBvcHRpb25zLmhlaWdodCB8fCAyMDA7CiAgICAgICAgICAgIHNlbGYuaGVpZ2h0KGgpLndpZHRoKG9wdGlvbnMud2lkdGggfHwgNTAwKTsKCiAgICAgICAgICAgIHNlbGYudmlzLmF0dHIoJ2hlaWdodCcsIGgpCiAgICAgICAgICAgIHNlbGYudmlzLmF0dHIoJ3dpZHRoJywgc2VsZi53aWR0aCgpKQoKICAgICAgICAgICAgc2VsZi5zY2FsaW5nQ29udGV4dC5oZWlnaHQoc2VsZi5oZWlnaHQoKSAtIHNlbGYuaGVpZ2h0WEF4aXMgLSBzZWxmLnBlYWtzQmFzZWxpbmVIZWlnaHQgLSAyMCk7CiAgICAgICAgICAgIC8vIDIwIGZvciB0aGUgbWVudSBsaW5lLAogICAgICAgICAgICAvLyAxMCBmb3Igd2F0ZXIgbGluZSAtCiAgICAgICAgICAgIC8vIHVnbHksIG5laT8KICAgICAgICAgICAgc2VsZi5zY2FsaW5nQ29udGV4dC53aWR0aChzZWxmLndpZHRoKCkpCgogICAgICAgICAgICBzZWxmLnZpcy5zZWxlY3RBbGwoJy5yaWdodC1hbGlnbicpLmF0dHIoJ3RyYW5zZm9ybScsICd0cmFuc2xhdGUoJyArIHNlbGYud2lkdGgoKSArICcsMCknKTsKICAgICAgICAgICAgaWYgKHNlbGYuaXNGbHlpbmcpIHsKICAgICAgICAgICAgICAgIHNlbGYucF9mbHlpbmdfZG9udF9mbHlfYXdheSgpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHNlbGYucmVuZGVyKCkKICAgICAgICB9LAogICAgICAgIHJlZnJlc2g6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICBzZWxmLnBfYnVpbGRfZGF0YSgpOwogICAgICAgICAgICBzZWxmLnBfc2V0dXBfbGFiZWxzKCk7CiAgICAgICAgICAgIHNlbGYucmVuZGVyKCk7CiAgICAgICAgfSwKICAgICAgICByZW5kZXI6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICAgICAgdmFyIHggPSBzZWxmLnNjYWxpbmdDb250ZXh0LngoKTsKICAgICAgICAgICAgdmFyIHkgPSBzZWxmLnNjYWxpbmdDb250ZXh0LnkoKTsKCiAgICAgICAgICAgIHNlbGYuZDNob2xkZXJQcmVjdXJzb3IuYXR0cigndHJhbnNmb3JtJywgZnVuY3Rpb24gKHApIHsKICAgICAgICAgICAgICAgIHZhciB0ID0gJ3RyYW5zbGF0ZSgnICsgeChwLngpICsgJywnICsgKHkoMCkgKyA5KSArICcpJzsKICAgICAgICAgICAgICAgIHJldHVybiB0OwogICAgICAgICAgICB9KQogICAgICAgICAgICB2YXIgeEF4aXMgPSBkMy5zdmcuYXhpcygpLnNjYWxlKHgpLnRpY2tzKDcpLnRpY2tTaXplKDUpOwogICAgICAgICAgICBzZWxmLmQzSG9sZGVyWEF4aXMuY2FsbCh4QXhpcyk7CgogICAgICAgICAgICBzZWxmLmQzaG9sZGVyUGVha3MuYXR0cigneDEnLCBmdW5jdGlvbiAocCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHgocC54KTsKICAgICAgICAgICAgfSkuYXR0cigneDInLCBmdW5jdGlvbiAocCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHgocC54KTsKICAgICAgICAgICAgfSkuYXR0cigneTEnLCBmdW5jdGlvbiAocCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHkoMCkgKyBzZWxmLnBlYWtzQmFzZWxpbmVIZWlnaHQ7CiAgICAgICAgICAgIH0pLmF0dHIoJ3kyJywgZnVuY3Rpb24gKHApIHsKICAgICAgICAgICAgICAgIHJldHVybiB5KHAueSk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgc2VsZi52aXMuc2VsZWN0QWxsKCdyZWN0LnBlYWstYmFzZWxpbmUnKS5yZW1vdmUoKTsKICAgICAgICAgICAgc2VsZi52aXMuYXBwZW5kKCdyZWN0JykuYXR0cignY2xhc3MnLCAncGVhay1iYXNlbGluZSByZWxhdGl2ZS1zaXplJykuYXR0cigneScsIHNlbGYuaGVpZ2h0KCkgLSBzZWxmLnBlYWtzQmFzZWxpbmVIZWlnaHQgLSBzZWxmLmhlaWdodFhBeGlzKS5hdHRyKCdoZWlnaHQnLCBzZWxmLnBlYWtzQmFzZWxpbmVIZWlnaHQpLmF0dHIoJ3dpZHRoJywgc2VsZi53aWR0aCgpIC0gMikuYXR0cigneCcsIDEpLmF0dHIoJ3JlbGF0aXZlV2lkdGgnLCAtMik7CgogICAgICAgICAgICBzZWxmLmQzSG9sZGVyWEF4aXMuYXR0cigndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZSgwLCcgKyAoc2VsZi5oZWlnaHQoKSAtIDIwIC0gc2VsZi5oZWlnaHRYQXhpcykgKyAnKScpOwoKICAgICAgICAgICAgc2VsZi5kM2hvbGRlclBlYWtzVHJ1bmNhdGVkLmF0dHIoJ2NsYXNzJywgJ3BlYWstdHJ1bmNhdGVkJykuYXR0cigneDEnLCBmdW5jdGlvbiAocCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHgocC54KTsKICAgICAgICAgICAgfSkuYXR0cigneDInLCBmdW5jdGlvbiAocCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHgocC54KTsKICAgICAgICAgICAgfSkuYXR0cigneTEnLCBmdW5jdGlvbiAocCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHkocC55KTsKICAgICAgICAgICAgfSkuYXR0cigneTInLCBmdW5jdGlvbiAocCkgewogICAgICAgICAgICAgICAgMDsvLyByZXR1cm4gc2VsZi5zY2FsaW5nQ29udGV4dC55U2NhbGUoKShwLnkpLTIwOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHZhciBsYWJZID0gZnVuY3Rpb24gKHApIHsKICAgICAgICAgICAgICAgIHJldHVybiBNYXRoLm1heCh5KHAueSkgLSAyOCwgOCkKICAgICAgICAgICAgfQogICAgICAgICAgICBzZWxmLmQzaG9sZGVyTGFiZWxzLmF0dHIoJ2NsYXNzJywgJ2xhYmVsJykuYXR0cigndHJhbnNmb3JtJywgZnVuY3Rpb24gKHApIHsKICAgICAgICAgICAgICAgIHJldHVybiAndHJhbnNsYXRlKCcgKyB4KHAueCkgKyAnLDApJzsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHNlbGYuZDNob2xkZXJMYWJlbHNQYXRoLmF0dHIoJ2NsYXNzJywgJ2xhYmVsLXBvaW50ZXInKS5hdHRyKCdkJywgZnVuY3Rpb24gKHApIHsKICAgICAgICAgICAgICAgIHZhciBqID0geShwLnkpOwogICAgICAgICAgICAgICAgcmV0dXJuICdNNSwnICsgbGFiWShwKSArICdsLTUsOEwwLCcgKyBqOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHNlbGYuZDNob2xkZXJMYWJlbHNUZXh0Ry5hdHRyKCd0cmFuc2Zvcm0nLCBmdW5jdGlvbiAocCkgewogICAgICAgICAgICAgICAgcmV0dXJuICJ0cmFuc2xhdGUoMTAsICIgKyAobGFiWShwKSAtIDIpICsgIikscm90YXRlKC00OCkiCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIHNlbGYuZDNob2xkZXJMYWJlbHNUZXh0LmF0dHIoJ2NsYXNzJywgJ2xhYmVsJykudGV4dChmdW5jdGlvbiAocCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHAubGFiZWwubGFiZWw7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBpZiAoc2VsZi5yZW5kZXJDYWxsYmFjaykgewogICAgICAgICAgICAgICAgc2VsZi5yZW5kZXJDYWxsYmFjaygpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gTWF0Y2hTcGVjdHJ1bVZpZXc7Cn0pOwoKLyoKICogdGhlIGRpc2sgd2l0aCB1bnJvbGxlZCBwZXB0aWRlIGNvdmVyYWdlIGZvciBQU00KICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCgpkZWZpbmUoJ2Zpc2h0b25lcy92aWV3cy9tYXRjaC9NYXRjaE1hcFBRVmlldycsWyd1bmRlcnNjb3JlJywgJ0JhY2tib25lJywgJy4uL2NvbW1vbnMvQ29tbW9uV2lkZ2V0VmlldycsICcuL01hdGNoTWFwU2xpbVZpZXcnLCAnZmlzaHRvbmVzL3ZpZXdzL3V0aWxzL1BRVmlldycsICcuL01hdGNoU3BlY3RydW1WaWV3J10sIGZ1bmN0aW9uKF8sIEJhY2tib25lLCBDb21tb25XaWRnZXRWaWV3LCBNYXRjaE1hcFNsaW1WaWV3LCBQUVZpZXcsIE1hdGNoU3BlY3RydW1WaWV3KSB7CgogICAgTWF0Y2hNYXBQUVZpZXcgPSBDb21tb25XaWRnZXRWaWV3LmV4dGVuZCh7CiAgICAgICAgaW5pdGlhbGl6ZSA6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICBNYXRjaE1hcFBRVmlldy5fX3N1cGVyX18uaW5pdGlhbGl6ZS5jYWxsKHRoaXMsIGFyZ3VtZW50cykKCiAgICAgICAgICAgIHNlbGYucmFkaXVzID0gb3B0aW9ucy5yYWRpdXN8fCAyNDsKICAgICAgICAgICAgc2VsZi50b2wgPSBvcHRpb25zLnRvbHx8IDQ5ODsKCgogICAgICAgICAgICB2YXIgc3BtYSA9IHNlbGYubW9kZWw7CiAgICAgICAgICAgIHZhciB3aWRnZXQgPSBuZXcgUFFWaWV3KHNlbGYuZWwsIHsKICAgICAgICAgICAgICAgIHJhZGl1cyA6IHNlbGYucmFkaXVzLAogICAgICAgICAgICAgICAgb25jbGljayA6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciB3aWRnZXRTcGVjdHJ1bSA9IG5ldyBNYXRjaFNwZWN0cnVtVmlldyh7CiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsIDogc3BtYSwKICAgICAgICAgICAgICAgICAgICAgICAgZmx5aW5nIDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgZWRpdFVybDonL2Zpc2h0b25lcy9pZC8jaW50ZXJhY3RpdmUvJytzZWxmLm1vZGVsLmdldCgnZXhwU3BlY3RydW0nKS5nZXQoJ2lkJykrJy8nK3NlbGYudG9sKycvJytzZWxmLm1vZGVsLmdldCgncmljaFNlcXVlbmNlJykudG9TdHJpbmcoKSwKICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OjIwMCwKICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6NDgwCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgLy8gLy93aWRnZXRTcGVjdHJ1bS5zaG93KCk7CiAgICAgICAgICAgICAgICAgICAgd2lkZ2V0U3BlY3RydW0ucmVuZGVyKCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHZhciBzZWN0b3JDbGFzc2VzID0gbmV3IEFycmF5KHNlbGYubW9kZWwuZ2V0KCdyaWNoU2VxdWVuY2UnKS5zaXplKCkpCiAgICAgICAgICAgIGZvciAoIGlzYyA9IDA7IGlzYyA8IHNlY3RvckNsYXNzZXMubGVuZ3RoOyBpc2MrKykgewogICAgICAgICAgICAgICAgc2VjdG9yQ2xhc3Nlc1tpc2NdID0gJ3NlY3Rvci1yay1ub25lJzsKICAgICAgICAgICAgfQogICAgICAgICAgICBfLmNoYWluKHNwbWEuY2xvc2VyVGhhblBQTShzZWxmLnRvbCkpLmZpbHRlcihmdW5jdGlvbihtKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gTWF0aC5hYnMobS5lcnJvclBQTSkgPD0gNDk5CiAgICAgICAgICAgIH0pLmdyb3VwQnkoZnVuY3Rpb24obSkgewogICAgICAgICAgICAgICAgcmV0dXJuIG0udGhlby5wb3MKICAgICAgICAgICAgfSkuZWFjaChmdW5jdGlvbihncCkgewogICAgICAgICAgICAgICAgdmFyIHBvcyA9IGdwWzBdLnRoZW8ucG9zCiAgICAgICAgICAgICAgICB2YXIgcmsgPSBfLmNoYWluKGdwKS5tYXAoZnVuY3Rpb24obSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBtLmV4cC5pbnRlbnNpdHlSYW5rCiAgICAgICAgICAgICAgICB9KS5taW4oKS52YWx1ZSgpOwogICAgICAgICAgICAgICAgc2VjdG9yQ2xhc3Nlc1twb3NdID0gJ3NlY3Rvci1yay0nICsgKChyayA8IDQwKSA/IE1hdGguZmxvb3IocmsgLyAxMCkgOiAneCcpCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgd2lkZ2V0LmJ1aWxkKHNlY3RvckNsYXNzZXMsIGZ1bmN0aW9uKGNudCkgewogICAgICAgICAgICAgICAgdmFyIHIgPSBuZXcgTWF0Y2hNYXBTbGltVmlldyh7CiAgICAgICAgICAgICAgICAgICAgbW9kZWwgOiBzcG1hLAogICAgICAgICAgICAgICAgICAgIGVsIDogY250LAogICAgICAgICAgICAgICAgICAgIHRvbCA6IHNlbGYudG9sLAogICAgICAgICAgICAgICAgICAgIGhlaWdodCA6IHNlbGYucmFkaXVzCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHJldHVybiByLnJlbmRlcigpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgc2VsZi53aWRnZXRQUSA9IHdpZGdldDsKICAgICAgICB9LAogICAgICAgIGNsY2NjIDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdDTEFLSycpCiAgICAgICAgfSwKCiAgICAgICAgcmVuZGVyIDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgc2VsZi53aWRnZXRQUS5kcmF3KCk7CiAgICAgICAgfSwKCiAgICAgICAgbW92ZSA6IGZ1bmN0aW9uKGksIGopIHsKICAgICAgICAgICAgdGhpcy53aWRnZXRQUS5tb3ZlKGksIGopOwogICAgICAgIH0KICAgIH0pOwoKICAgIHJldHVybiBNYXRjaE1hcFBRVmlldzsKfSk7CgoKLyoqCiAqIGRpc3BsYXkgb25lIFhJQyAoKyBwbHVzIG1zbXMgbWF0Y2hlcyBldmVudHVhbGx5KQogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KCmRlZmluZSgnZmlzaHRvbmVzL3ZpZXdzL3dldC9YSUNWaWV3JyxbJ3VuZGVyc2NvcmUnLCAnQmFja2JvbmUnLCAnZDMnLCAnLi4vY29tbW9ucy9Db21tb25XaWRnZXRWaWV3JywgJ2Zpc2h0b25lcy9tb2RlbHMvbWF0Y2gvUFNNQWxpZ25tZW50JywgJ2Zpc2h0b25lcy92aWV3cy91dGlscy9EM1NjYWxpbmdDb250ZXh0JywgJ2Zpc2h0b25lcy92aWV3cy91dGlscy9EM1NjYWxpbmdBcmVhJywgJy4uL21hdGNoL01hdGNoTWFwUFFWaWV3J10sIGZ1bmN0aW9uIChfLCBCYWNrYm9uZSwgZDMsIEdGWVZpZXdWaWV3LCBQU01BbGlnbm1lbnQsIEQzU2NhbGluZ0NvbnRleHQsIEQzU2NhbGluZ0FyZWEsIE1hdGNoTWFwUFFWaWV3KSB7CgogICAgWElDVmlldyA9IENvbW1vbldpZGdldFZpZXcuZXh0ZW5kKHsKICAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbiAob3B0aW9ucykgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIFhJQ1ZpZXcuX19zdXBlcl9fLmluaXRpYWxpemUuY2FsbCh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICBzZWxmLnJpY2hTZXF1ZW5jZSA9IG9wdGlvbnMucmljaFNlcXVlbmNlOwogICAgICAgICAgICBpZiAob3B0aW9ucy5zY2FsaW5nQ29udGV4dCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBvcHRpb25zLnhEb21haW4gPSBbMCwgXy5tYXgoc2VsZi5tb2RlbC5nZXQoJ3JldGVudGlvblRpbWVzJykpICogMS4wNV07CiAgICAgICAgICAgICAgICBvcHRpb25zLnlEb21haW4gPSBbMCwgXy5tYXgoc2VsZi5tb2RlbC5nZXQoJ2ludGVuc2l0aWVzJykpICogMS4xXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBzZWxmLnNldHVwU2NhbGluZ0NvbnRleHQob3B0aW9ucyk7CgogICAgICAgICAgICBzZWxmLnBfc2V0X21zMXBvaW50cygpOwogICAgICAgICAgICBpZiAoc2VsZi5yaWNoU2VxdWVuY2UpIHsKICAgICAgICAgICAgICAgIHNlbGYucF9zZXRfbXNtc2RhdGEoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICB9LAogICAgICAgIC8vcmV0dXJuIHRoZSBjbGFzcyAtIHdlbGwsIEkgY2Fubm90IGZpZ3VyZSB3aGF0IHRoaXMgb3MgZG9uZSBsaWtlIHRoYXQuLi4KICAgICAgICBwX2NsYXp6Q29tbW9uOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiAnY2hyb21hdG8gbXNtcy1hbGlnbm1lbnQtaWNvbiBjaGFyZ2VfJyArIHRoaXMubW9kZWwuZ2V0KCdjaGFyZ2UnKSArICcgdGFyZ2V0XycgKyB0aGlzLm1vZGVsLmdldCgndGFyZ2V0Jyk7CiAgICAgICAgfSwKICAgICAgICAvL3BhY2thZ2UgdGhlIG1zMSBncmFwaCBwb2ludCAoYW5kIGdldCBkdGF0IHJlYWR5IGZvciBkcmF3aW5nKQogICAgICAgIHBfc2V0X21zMXBvaW50czogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHZhciBjaHJvbWF0byA9IHNlbGYubW9kZWw7CiAgICAgICAgICAgIGNocm9tYXRvLl9kYXRhUG9pbnRzID0gXy56aXAoY2hyb21hdG8uZ2V0KCdyZXRlbnRpb25UaW1lcycpLCBjaHJvbWF0by5nZXQoJ2ludGVuc2l0aWVzJykpCgogICAgICAgICAgICAvL2NvbnNvbGUubG9nKG1zMXBvaW50cykKICAgICAgICAgICAgdmFyIHNlbGVjdG9yID0gJ2cuJyArIHNlbGYucF9jbGF6ekNvbW1vbigpLnJlcGxhY2UoL1xzKy9nLCAnLicpOwogICAgICAgICAgICB2YXIgY29udCA9IHNlbGYuZWwuc2VsZWN0QWxsKHNlbGVjdG9yKTsKICAgICAgICAgICAgLy8gY29udC5yZW1vdmUoKTsKICAgICAgICAgICAgY29udCA9IHNlbGYuZWwuYXBwZW5kKCdnJyk7CiAgICAgICAgICAgIGNvbnQuYXR0cignY2xhc3MnLCBzZWxmLnBfY2xhenpDb21tb24oKSArICcgcGxvdCcpOwoKICAgICAgICAgICAgdmFyIGNsYXp6ID0gc2VsZi5wX2NsYXp6Q29tbW9uKCkgKyAnIHBsb3QnOwogICAgICAgICAgICAvL2NvbnNvbGUubG9nKCdhZGRpbmcgbXMxcG9pbnQnLCBtczFwb2ludHMpCiAgICAgICAgICAgIHNlbGYucDEgPSBjb250LnNlbGVjdEFsbCgicGF0aC4iICsgY2xhenopLmRhdGEoW2Nocm9tYXRvLl9kYXRhUG9pbnRzXSkuZW50ZXIoKS5pbnNlcnQoInBhdGgiKTsKCiAgICAgICAgfSwKICAgICAgICBwX3NldF9tc21zZGF0YTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHZhciBjaHJvbWF0byA9IHNlbGYubW9kZWw7CgogICAgICAgICAgICBzZWxmLm1zbXNEYXRhID0gW10KCiAgICAgICAgICAgIF8uZWFjaChjaHJvbWF0by5nZXQoJ21zbXMnKS5tb2RlbHMsIGZ1bmN0aW9uIChzcCwgaSkgewogICAgICAgICAgICAgICAgdmFyIHNwbWEgPSBuZXcgUFNNQWxpZ25tZW50KHsKICAgICAgICAgICAgICAgICAgICByaWNoU2VxdWVuY2U6IHNlbGYucmljaFNlcXVlbmNlLAogICAgICAgICAgICAgICAgICAgIGV4cFNwZWN0cnVtOiBzcAogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgdmFyIHdpZGdldCA9IG5ldyBNYXRjaE1hcFBRVmlldyh7CiAgICAgICAgICAgICAgICAgICAgbW9kZWw6IHNwbWEsCiAgICAgICAgICAgICAgICAgICAgZWw6IHNlbGYuZWwsCiAgICAgICAgICAgICAgICAgICAgcmFkaXVzOiAxMiwKICAgICAgICAgICAgICAgICAgICB0b2w6IHNlbGYudG9sCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHdpZGdldC53aWRnZXRQUS52aXMuYXR0cignY2xhc3MnLCBzZWxmLnBfY2xhenpDb21tb24oKSkKCiAgICAgICAgICAgICAgICBzZWxmLm1zbXNEYXRhLnB1c2goewogICAgICAgICAgICAgICAgICAgIHdpZGdldDogd2lkZ2V0LAogICAgICAgICAgICAgICAgICAgIHJldGVudGlvblRpbWU6IGNocm9tYXRvLmdldCgnbXNtc1BvaW50ZXJzJylbaV0ucmV0ZW50aW9uVGltZSwKICAgICAgICAgICAgICAgICAgICBpbnRlbnNpdHk6IGNocm9tYXRvLmdldCgnbXNtc1BvaW50ZXJzJylbaV0uaW50ZW5zaXR5CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLy9kcmF3aW5nIHB1dCB0aGVtIG9uIHRoZSBzY3JlZW4KICAgICAgICAgICAgLy9hY3R1YWwgZHJhd2luZyB3aWxsIG1vdmUgdGhlbSB0byB0aGUgY29ycmVjdCBwb3NpdGlvbgogICAgICAgICAgICBfLmVhY2goc2VsZi5tc21zRGF0YSwgZnVuY3Rpb24gKG1zbXMpIHsKICAgICAgICAgICAgICAgIG1zbXMud2lkZ2V0LnJlbmRlcigpCiAgICAgICAgICAgIH0pOwoKICAgICAgICB9CiAgICB9KTsKCiAgICBYSUNWaWV3LnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAob3B0aW9ucykgewogICAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgICAgdmFyIGNocm0gPSBzZWxmLm1vZGVsOwoKICAgICAgICB2YXIgY2xhenogPSBzZWxmLnBfY2xhenpDb21tb24oKSArICcgbXNtcy1hbm5vdCc7CgogICAgICAgIHZhciB4ID0gc2VsZi5zY2FsaW5nQ29udGV4dC54KCk7Ly9kMy5zY2FsZS5saW5lYXIoKS5kb21haW4oc2VsZi5zY2FsaW5nQ29udGV4dC54U2NhbGUuZG9tYWluKCkpLnJhbmdlKHNlbGYuc2NhbGluZ0NvbnRleHQueFNjYWxlLnJhbmdlKCkpCiAgICAgICAgdmFyIHkgPSBzZWxmLnNjYWxpbmdDb250ZXh0LnkoKTsvL2QzLnNjYWxlLmxpbmVhcigpLmRvbWFpbihzZWxmLnNjYWxpbmdDb250ZXh0LnlTY2FsZS5kb21haW4oKSkucmFuZ2Uoc2VsZi5zY2FsaW5nQ29udGV4dC55U2NhbGUucmFuZ2UoKSkKCiAgICAgICAgdmFyIHBMaW5lID0gZDMuc3ZnLmxpbmUoKS54KGZ1bmN0aW9uIChkKSB7CiAgICAgICAgICAgIHJldHVybiB4KGRbMF0pOwogICAgICAgIH0pLnkoZnVuY3Rpb24gKGQpIHsKICAgICAgICAgICAgcmV0dXJuIHkoZFsxXSkKICAgICAgICB9KTsKCiAgICAgICAgdmFyIGdwMSA9IHNlbGYucDEuYXR0cignY2xhc3MnLCBjbGF6eikuYXR0cignZmlsbCcsICdub25lJyk7CiAgICAgICAgZ3AxLmF0dHIoImQiLCBwTGluZShzZWxmLm1vZGVsLl9kYXRhUG9pbnRzKSk7CiAgICAgICAgXy5lYWNoKHNlbGYubXNtc0RhdGEsIGZ1bmN0aW9uIChtc21zKSB7CiAgICAgICAgICAgIG1zbXMud2lkZ2V0Lm1vdmUoeChtc21zLnJldGVudGlvblRpbWUpLCBNYXRoLm1pbih5KG1zbXMuaW50ZW5zaXR5KSwgc2VsZi5zY2FsaW5nQ29udGV4dC5oZWlnaHQoKSAtIDE1KSkKICAgICAgICB9KTsKICAgICAgICAvLyB2YXIgbXMycG9pbnRzID0gXy56aXAoY2hybS5tc21zLnJldGVudGlvblRpbWVzLCBjaHJtLm1zbXMuaW50ZW5zaXRpZXMsIGNocm0ubXNtcy5zcGVjdHJhSWRzKTsKICAgIH0KCiAgICByZXR1cm4gWElDVmlldzsKfSk7CgovKioKICogbXVsdGlwbGUgWElDIHZpZXdzIGluIG9uZSBib3guIFhJQyBpcyB1bmlxdWUgYnkgaXRzIG1hc3MgZmllbGQKICogdGhlIHNjYWxpbmcgY29udGV4dCBpcyBlaXRoZXIgcGFzc2VkIChpZiBtdWx0aXBsZSBlbGVtZW50IGFyZSBzaGFyaW5nIHRoZSBzYW1lb25lKSBvciBidWlsdC4gcmFuZ2VzIHdpbGwgYmUgYWRhcHRlZCBlYWNoIHRpbWUgYSBYSUMgaXMgYWRkZWQKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCmRlZmluZSgnZmlzaHRvbmVzL3ZpZXdzL3dldC9NdWx0aVhJQ1ZpZXcnLFsndW5kZXJzY29yZScsICdCYWNrYm9uZScsICdkMycsICcuLi9jb21tb25zL0NvbW1vbldpZGdldFZpZXcnLCAnLi9YSUNWaWV3J10sIGZ1bmN0aW9uIChfLCBCYWNrYm9uZSwgZDMsIENvbW1vbldpZGdldFZpZXcsIFhJQ1ZpZXcpIHsKCiAgICBNdWx0aVhJQ1ZpZXcgPSBDb21tb25XaWRnZXRWaWV3LmV4dGVuZCh7CgogICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgTXVsdGlYSUNWaWV3Ll9fc3VwZXJfXy5pbml0aWFsaXplLmNhbGwodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgc2VsZi5vcHRpb25zID0gb3B0aW9uczsKICAgICAgICAgICAgc2VsZi5zZXR1cFNjYWxpbmdDb250ZXh0KG9wdGlvbnMpOwoKICAgICAgICAgICAgc2VsZi54aWNWaWV3cyA9IHt9OwogICAgICAgICAgICBzZWxmLm1vZGVsLmJpbmQoJ2FkZCcsIGZ1bmN0aW9uICh4aWMpIHsKICAgICAgICAgICAgICAgIHNlbGYuYWRkKHhpYywgb3B0aW9ucykKICAgICAgICAgICAgfSkKICAgICAgICAgICAgc2VsZi5idWlsZChvcHRpb25zKTsKCiAgICAgICAgICAgIHNlbGYubGlzdGVuVG8oc2VsZi5tb2RlbCwgJ2FkZCcsIHNlbGYucmVuZGVyKTsKICAgICAgICAgICAgc2VsZi5saXN0ZW5UbyhzZWxmLm1vZGVsLCAncmVzZXQnLCBzZWxmLnJlbmRlcik7CgogICAgICAgIH0sCiAgICAgICAgYnVpbGQ6IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy55YXhpcykgewogICAgICAgICAgICAgICAgc2VsZi5lbFlBeGlzID0gc2VsZi5lbC5hcHBlbmQoJ2cnKS5hdHRyKCdjbGFzcycsICd4aWMgeWF4aXMnKQogICAgICAgICAgICB9CgogICAgICAgICAgICBzZWxmLnRpdGxlID0gb3B0aW9ucy50aXRsZTsKICAgICAgICAgICAgc2VsZi5lbFRpdGxlID0gc2VsZi5lbC5hcHBlbmQoJ3RleHQnKS5hdHRyKCd4Jywgc2VsZi5zY2FsaW5nQ29udGV4dC53aWR0aCgpIC0gMjApLmF0dHIoJ3knLCAzMCkuYXR0cignY2xhc3MnLCAneGljIHRpdGxlJyk7CiAgICAgICAgfSwKICAgICAgICAvLyBldmVudHMgOiB7CiAgICAgICAgLy8gJ2NoYW5nZSBtb2RlbCcgOiAnYWRkJwogICAgICAgIC8vIH0sCiAgICAgICAgYWRkOiBmdW5jdGlvbiAoeGljLCBvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIG0gPSB4aWMuZ2V0KCdtYXNzJyk7CgogICAgICAgICAgICB2YXIgeG1heCA9IE1hdGgubWF4KHNlbGYuc2NhbGluZ0NvbnRleHQueE1heCgpLCBfLm1heCh4aWMuZ2V0KCdyZXRlbnRpb25UaW1lcycpKSk7CiAgICAgICAgICAgIGlmICghKG9wdGlvbnMgJiYgb3B0aW9ucy5ub0F1dG9YKSkgewogICAgICAgICAgICAgICAgc2VsZi5zY2FsaW5nQ29udGV4dC5zZXRYTWF4KHhtYXgsIHRydWUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgc2VsZi5zY2FsaW5nQ29udGV4dC5zZXRYTWF4KHhtYXgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciB5bWF4ID0gTWF0aC5tYXgoc2VsZi5zY2FsaW5nQ29udGV4dC55TWF4KCksIF8ubWF4KHhpYy5nZXQoJ2ludGVuc2l0aWVzJykpICogMS4xKTsKICAgICAgICAgICAgc2VsZi5zY2FsaW5nQ29udGV4dC5zZXRZTWF4KHltYXgpOwoKICAgICAgICAgICAgdmFyIHh2ID0gbmV3IFhJQ1ZpZXcoewogICAgICAgICAgICAgICAgZWw6IHNlbGYuZWwuYXBwZW5kKCdnJyksCiAgICAgICAgICAgICAgICBtb2RlbDogeGljLAogICAgICAgICAgICAgICAgc2NhbGluZ0NvbnRleHQ6IHNlbGYuc2NhbGluZ0NvbnRleHQsCiAgICAgICAgICAgICAgICByaWNoU2VxdWVuY2U6IHhpYy5nZXQoJ3JpY2hTZXF1ZW5jZScpLAogICAgICAgICAgICAgICAgbm9BdXRvWDogKG9wdGlvbnMgJiYgb3B0aW9ucy5ub0F1dG9YKQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgLy8gICAgICAgICAgICBjb25zb2xlLmxvZyhzZWxmLmNpZCwgJ1hJQyAnLCB4aWMuZ2V0KCdpZCcpLCB4aWMuY2lkLCB4di5jaWQpCgogICAgICAgICAgICBzZWxmLnhpY1ZpZXdzW21dID0geHY7CgogICAgICAgICAgICAvL3NlbGYueFpvb21hYmxlKCk7CgogICAgICAgIH0sCgogICAgICAgIHVwZGF0ZVlBeGlzOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIHlBeGlzID0gZDMuc3ZnLmF4aXMoKS5zY2FsZShzZWxmLnNjYWxpbmdDb250ZXh0LnkoKSkudGlja3MoNCkudGlja1NpemUoNSk7CiAgICAgICAgICAgIHNlbGYuZWxZQXhpcy5zZWxlY3RBbGwoJ2cnKS5yZW1vdmUoKTsKICAgICAgICAgICAgeUF4aXMub3JpZW50KCdyaWdodCcpOwogICAgICAgICAgICB5QXhpcy50aWNrRm9ybWF0KGQzLmZvcm1hdCgiZSIpKTsKICAgICAgICAgICAgc2VsZi5lbFlBeGlzLmNhbGwoeUF4aXMpOwoKICAgICAgICB9LAogICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKG9wdGlvbnMpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICBzZWxmLmVsVGl0bGUudGV4dChzZWxmLnRpdGxlKTsKICAgICAgICAgICAgaWYgKHNlbGYub3B0aW9ucy55YXhpcykgewogICAgICAgICAgICAgICAgc2VsZi51cGRhdGVZQXhpcygpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIF8uZWFjaChfLnZhbHVlcyhzZWxmLnhpY1ZpZXdzKSwgZnVuY3Rpb24gKHh2KSB7CiAgICAgICAgICAgICAgICB4di5yZW5kZXIoKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfSk7CgogICAgcmV0dXJuIE11bHRpWElDVmlldzsKfSk7CgovKioKICogZGlzcGxheSBhIEQzU2NhbGluZ0NvbnRleHQsIG9uIHRoZSB4YXhpcyB2aWV3CiAqCiAqCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwpkZWZpbmUoJ2Zpc2h0b25lcy92aWV3cy91dGlscy9EM1hBeGlzVmlldycsWyd1bmRlcnNjb3JlJywgJ0JhY2tib25lJywgJ2QzJywgJy4uL2NvbW1vbnMvQ29tbW9uV2lkZ2V0VmlldyddLAogICAgZnVuY3Rpb24gKF8sIEJhY2tib25lLCBkMywgQ29tbW9uV2lkZ2V0VmlldykgewogICAgICAgIEQzWEF4aXNWaWV3ID0gQ29tbW9uV2lkZ2V0Vmlldy5leHRlbmQoewogICAgICAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbiAob3B0aW9ucykgewogICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICAgICAgWElDVmlldy5fX3N1cGVyX18uaW5pdGlhbGl6ZS5jYWxsKHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgICBzZWxmLnNldHVwU2NhbGluZ0NvbnRleHQob3B0aW9ucyk7CiAgICAgICAgICAgICAgICBzZWxmLnRyYW5zZm9ybSA9IG9wdGlvbnMudHJhbnNmb3JtOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgICAgICB2YXIgeFNjYWxlOwogICAgICAgICAgICAgICAgaWYgKHNlbGYudHJhbnNmb3JtKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHhEb20gPSBzZWxmLnNjYWxpbmdDb250ZXh0LngoKS5kb21haW4oKQogICAgICAgICAgICAgICAgICAgIHhTY2FsZSA9IGQzLnNjYWxlLmxpbmVhcigpLmRvbWFpbihbc2VsZi50cmFuc2Zvcm0oeERvbVswXSksIHNlbGYudHJhbnNmb3JtKHhEb21bMV0pXSkucmFuZ2UoWzAsIHNlbGYuc2NhbGluZ0NvbnRleHQud2lkdGgoKV0pCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHhTY2FsZSA9IHNlbGYuc2NhbGluZ0NvbnRleHQueCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgeEF4aXMgPSBkMy5zdmcuYXhpcygpLnNjYWxlKHhTY2FsZSkudGlja3MoNykudGlja1N1YmRpdmlkZSg0KS50aWNrU2l6ZSg2LCA1LCAwKTsKICAgICAgICAgICAgICAgIHNlbGYuZWwuY2FsbCh4QXhpcyk7CiAgICAgICAgICAgICAgICB2YXIgZWxzVGlja3MgPSBzZWxmLmVsLnNlbGVjdEFsbCgnZyBnIGcnKVswXQogICAgICAgICAgICAgICAgXy5lYWNoKGVsc1RpY2tzLCBmdW5jdGlvbiAoZWx0KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHBvcyA9IHBhcnNlRmxvYXQoZDMuc2VsZWN0KGVsdCkuYXR0cigndHJhbnNmb3JtJykucmVwbGFjZSgndHJhbnNsYXRlKCcsICcnKS5yZXBsYWNlKCcsMCknLCAnJykpOwogICAgICAgICAgICAgICAgICAgIGQzLnNlbGVjdChlbHQpLnN0eWxlKCdkaXNwbGF5JywgKHBvcyA8IDM1KSA/ICdub25lJyA6IG51bGwpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0pCiAgICAgICAgcmV0dXJuIEQzWEF4aXNWaWV3CiAgICB9KTsKCi8qCiAqIEEgY2xpcHBlZCB2ZXJzaW9uIG9mIGEgWElDCiAqCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwoKZGVmaW5lKCdmaXNodG9uZXMvbW9kZWxzL3dldC9YSUNDbGlwJyxbJ0JhY2tib25lJywgJ0NvbmZpZycsICcuL1hJQyddLCBmdW5jdGlvbihCYWNrYm9uZSwgY29uZmlnLCBYSUMpIHsKICAgIHZhciBYSUNDbGlwID0gWElDLmV4dGVuZCh7CiAgICAgICAgZGVmYXVsdHMgOiB7CiAgICAgICAgfSwKICAgICAgICBpbml0aWFsaXplIDogZnVuY3Rpb24oKSB7CiAgICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gWElDQ2xpcDsKfSk7CgovKgogKiBidWlsZHMgYW4gWElDIENsaXAgb3V0IG9mIGEgWElDICsgcmV0ZW50aW9uIHRpbWUgcmFuZ2UKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCgpkZWZpbmUoJ2Zpc2h0b25lcy9zZXJ2aWNlcy93ZXQvWElDQ2xpcHBlckZhY3RvcnknLFsnanF1ZXJ5JywgJ3VuZGVyc2NvcmUnLCAnQmFja2JvbmUnLCAnQ29uZmlnJywgJ2Zpc2h0b25lcy9tb2RlbHMvd2V0L1hJQ0NsaXAnLCAnZmlzaHRvbmVzL2NvbGxlY3Rpb25zL3dldC9FeHBNU01TU3BlY3RydW1Db2xsZWN0aW9uJ10sIGZ1bmN0aW9uKCQsIF8sIEJhY2tib25lLCBjb25maWcsIFhJQ0NsaXAsIEV4cE1TTVNTcGVjdHJ1bUNvbGxlY3Rpb24pIHsKICAgIHZhciBYSUNDbGlwcGVyRmFjdG9yeSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgIH07CgogICAgLyoqCiAgICAgKiBidWlsZCBhIFhJQ0NsaXAgYmFzZWQgb24geGljIHdpdGggcmV0ZW50aW9uVGltZXMgaW4gdGhlIHdpbmRvdwogICAgICogeGljICBjYW4gYmUgZWl0aGVyOgogICAgICogLSBvbmUgWElDCiAgICAgKiAtIG9uZVhJQ0NvbGxlY3Rpb24gCiAgICAgKiAtIEFycmF5IG9mIFhJQwogICAgICovCiAgICBYSUNDbGlwcGVyRmFjdG9yeS5wcm90b3R5cGUuY2xpcCA9IGZ1bmN0aW9uKHhpYywgcnRJbmYsIHJ0U3VwLCBvcHRpb25zKSB7CiAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgIAogICAgICAgIGlmKHhpYyBpbnN0YW5jZW9mIEJhY2tib25lLkNvbGxlY3Rpb24pewogICAgICAgICAgICByZXR1cm4gc2VsZi5jbGlwKHhpYy5tb2RlbHMsIHJ0SW5mLCBydFN1cCwgb3B0aW9ucykKICAgICAgICB9CiAgICAgICAgaWYoeGljIGluc3RhbmNlb2YgQXJyYXkpewogICAgICAgICAgICByZXR1cm4gXy5jb2xsZWN0KHhpYywgZnVuY3Rpb24oeCl7CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5jbGlwKHgsIHJ0SW5mLCBydFN1cCwgb3B0aW9ucykKICAgICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICB2YXIgY2xpcHBlZCA9IHhpYy5jbG9uZSgpOwogICAgICAgIHZhciBwb2ludHMgPSBfLnppcCh4aWMuZ2V0KCdyZXRlbnRpb25UaW1lcycpLCB4aWMuZ2V0KCdpbnRlbnNpdGllcycpKQogICAgICAgIHBvaW50cyA9IF8uZmlsdGVyKHBvaW50cywgZnVuY3Rpb24ocCkgewogICAgICAgICAgICByZXR1cm4gcFswXSA+PSBydEluZiAmJiBwWzBdIDw9IHJ0U3VwOwogICAgICAgIH0pCgogICAgICAgIGNsaXBwZWQuc2V0KCdyZXRlbnRpb25UaW1lcycsIF8ucGx1Y2socG9pbnRzLCAwKSkKICAgICAgICBjbGlwcGVkLnNldCgnaW50ZW5zaXRpZXMnLCBfLnBsdWNrKHBvaW50cywgMSkpCiAgICAgICAgY2xpcHBlZC5zZXQoJ3J0UmFuZ2UnLCB7CiAgICAgICAgICAgIGluZiA6IHJ0SW5mLAogICAgICAgICAgICBzdXAgOiBydFN1cAogICAgICAgIH0pCiAgICAgICAgY2xpcHBlZC5zZXQoJ21zbXMnLCBuZXcgRXhwTVNNU1NwZWN0cnVtQ29sbGVjdGlvbihjbGlwcGVkLmdldCgnbXNtcycpLmZpbHRlcihmdW5jdGlvbihtc21zKSB7CiAgICAgICAgICAgIHZhciBydCA9IG1zbXMuZ2V0KCdyZXRlbnRpb25UaW1lJyk7CiAgICAgICAgICAgIHJldHVybiBydCA+PSBydEluZiAmJiBydCA8PSBydFN1cAogICAgICAgIH0pKSkKCiAgICAgICAgcmV0dXJuIG5ldyBYSUNDbGlwKGNsaXBwZWQuYXR0cmlidXRlcykKICAgIH07CiAgICByZXR1cm4gbmV3IFhJQ0NsaXBwZXJGYWN0b3J5KCk7Cn0pOwoKLyoqCiAqIG11bHRpcGxlIFhJQyB2aWV3cyBpbiBvbmUgYm94LiBYSUMgaXMgdW5pcXVlIGJ5IGl0cyBtYXNzIGZpZWxkCiAqIHRoZSBzY2FsaW5nIGNvbnRleHQgaXMgZWl0aGVyIHBhc3NlZCAoaWYgbXVsdGlwbGUgZWxlbWVudCBhcmUgc2hhcmluZyB0aGUgc2FtZW9uZSkgb3IgYnVpbHQuIHJhbmdlcyB3aWxsIGJlIGFkYXB0ZWQgZWFjaCB0aW1lIGEgWElDIGlzIGFkZGVkCiAqICBhIFhJQ011bHRpUGFuZVZpZXcgaXMgYSBzZXQgb2YgTXVsdGlYSUNWaWV3LgogKiBXZSBjYW4gc2VlIHRoYXQgYXMgYSBtdWx0bGluZXMgd2lkZ2V0LCBlYWNoIGxpbmUgY29uc2lzdCBvZiBhIGEgc2VyaWVzIG9mIFhJQy4KICogc2NhbGluZyBjb250ZXh0IGlzIGNvaGVyZW50IHRocm91Z2hvdXQgdGhlIGRpZmZlcmVudCBYSUMKICoKICogdGhlIG1vZGVsIG9mIHRoZSB2aWV3IGlmIGEgbWFwIG9mIFhJQ0NvbGxlY3Rpb24KICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCmRlZmluZSgnZmlzaHRvbmVzL3ZpZXdzL3dldC9YSUNNdWx0aVBhbmVWaWV3JyxbJ2pxdWVyeScsICd1bmRlcnNjb3JlJywgJ0JhY2tib25lJywgJ2QzJywgJy4uL2NvbW1vbnMvQ29tbW9uV2lkZ2V0VmlldycsICcuLi91dGlscy9EM1hBeGlzVmlldycsCiAgICAgICAgJy4vTXVsdGlYSUNWaWV3JywgJ2Zpc2h0b25lcy9jb2xsZWN0aW9ucy93ZXQvWElDQ29sbGVjdGlvbicsICdmaXNodG9uZXMvc2VydmljZXMvd2V0L1hJQ0NsaXBwZXJGYWN0b3J5J10sCiAgICBmdW5jdGlvbiAoJCwgXywgQmFja2JvbmUsIGQzLCBDb21tb25XaWRnZXRWaWV3LCBEM1hBeGlzVmlldywgTXVsdGlYSUNWaWV3LCBYSUNDb2xsZWN0aW9uLCB4aWNDbGlwcGVyRmFjdG9yeSkgewoKICAgICAgICBYSUNNdWx0aVBhbmVWaWV3ID0gQ29tbW9uV2lkZ2V0Vmlldy5leHRlbmQoewogICAgICAgICAgICAvL21hcCBvZiBNdWx0aVhJQ1ZpZXcKICAgICAgICAgICAgeGljUGFuZXM6IHt9LAoKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqCiAgICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIGZvciBjb25zdHJ1Y3RvcgogICAgICAgICAgICAgKiAqIGdyb3VwQnkgOiBhIGZ1bmN0aW9uIHRha2luZyBhIHByb3ZpZGVkIFhJQyBhbmQgY29tcHV0aW5nIHRoZSBrZXkgb24gd2hpY2ggd2Ugc2hhbGwgZ3JvdXBlIHRoZSBYSUMgcGFlcnAgcGFuZQogICAgICAgICAgICAgKiAqIGdldEdyb3VwTmFtZSBbb3B0aW9uYWxdOiBob3cgdG8gbmFtZSBhIGdyb3VwIGJhc2VkIG9uIHRoZSBwcm92aWRlZCBYSUMuIFdlIHNob3VsZCBhc3N1bWUgdGhhdCBhbGwgdGhlIGdyb3VwZWRCeSBYSUMgd2lsbCBwcm92aWRlIHRoZSBzYW1lIG5hbWUuLi4KICAgICAgICAgICAgICoKICAgICAgICAgICAgICovCgogICAgICAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbiAob3B0aW9ucykgewogICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICAgICAgb3B0aW9ucyA9IF8uZXh0ZW5kKHt9LCBvcHRpb25zKTsKICAgICAgICAgICAgICAgIE11bHRpWElDVmlldy5fX3N1cGVyX18uaW5pdGlhbGl6ZS5jYWxsKHRoaXMsIG9wdGlvbnMpOwoKICAgICAgICAgICAgICAgIHNlbGYuZ3JvdXBCeSA9IG9wdGlvbnMuZ3JvdXBCeTsKICAgICAgICAgICAgICAgIHNlbGYuZ2V0R3JvdXBOYW1lID0gb3B0aW9ucy5nZXRHcm91cE5hbWUgfHwgc2VsZi5ncm91cEJ5OwogICAgICAgICAgICAgICAgc2VsZi5yZXRlbnRpb25UaW1lU2VsZWN0Q2FsbGJhY2sgPSBvcHRpb25zLnJldGVudGlvblRpbWVTZWxlY3RDYWxsYmFjazsKCiAgICAgICAgICAgICAgICBzZWxmLmxlZ2VuZElzRGlzcGxheWVkID0gb3B0aW9ucy5sZWdlbmQgfHwgZmFsc2U7CiAgICAgICAgICAgICAgICBzZWxmLm5vQXV0b1ggPSBvcHRpb25zLm5vQXV0b1g7CgogICAgICAgICAgICAgICAgc2VsZi5oZWlnaHRYQXhpcyA9IDMwOwogICAgICAgICAgICAgICAgc2VsZi54aWNQYW5lcyA9IHt9OwogICAgICAgICAgICAgICAgc2VsZi5ncm91cGVkTW9kZWxzID0ge307CgogICAgICAgICAgICAgICAgc2VsZi5saXN0ZW5UbyhzZWxmLm1vZGVsLCAnYWRkJywgc2VsZi5zZXR1cCk7CiAgICAgICAgICAgICAgICBzZWxmLmxpc3RlblRvKHNlbGYubW9kZWwsICdyZXNldCcsIHNlbGYuY2xlYXIpOwoKICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coc2VsZik7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBwX2luaXRfcnRfZG9tYWluX3NlbGVjdG9yOiBmdW5jdGlvbiAoY2IpIHsKICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgICAgIC8vc2V0IHRoZSBSVCByYW5nZSBzZWxlY3RvciBhbmQgcGlwZSBpdCB0byBhIGNhbGxiYWNrCgogICAgICAgICAgICAgICAgaWYgKGNiKSB7CiAgICAgICAgICAgICAgICAgICAgc2VsZi5zZXRTaGlmdFNlbGVjdENhbGxiYWNrKGZ1bmN0aW9uIChydERvbWFpbikgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgcnRJbmYgPSBydERvbWFpblswXQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgcnRTdXAgPSBydERvbWFpblsxXQoKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHhpY2NsaXBDb2wgPSBbXQogICAgICAgICAgICAgICAgICAgICAgICBfLmVhY2goc2VsZi5tb2RlbC5tb2RlbHMsIGZ1bmN0aW9uICh4aWMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjbGlwID0geGljQ2xpcHBlckZhY3RvcnkuY2xpcCh4aWMsIHJ0SW5mLCBydFN1cCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGlwLnVuc2V0KCdtc21zUG9pbnRlcnMnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgeGljY2xpcENvbC5wdXNoKGNsaXApCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBjYih4aWNjbGlwQ29sLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBydERvbWFpbjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZjogcnRJbmYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VwOiBydFN1cAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHNldFBhbmVUaXRsZTogZnVuY3Rpb24gKG5hbWUsIHRpdGxlKSB7CiAgICAgICAgICAgICAgICB0aGlzLnhpY1BhbmVzW25hbWVdLnRpdGxlID0gdGl0bGUKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGNsZWFyOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgICAgICAgICAgIF90aGlzLnhpY1BhbmVzID0ge307CiAgICAgICAgICAgICAgICBfdGhpcy5ncm91cGVkTW9kZWxzID0ge307CiAgICAgICAgICAgICAgICBfdGhpcy54aWNQYW5lcyA9IHt9OwogICAgICAgICAgICAgICAgX3RoaXMucHJldlBhbmVzR3JvdXBLZXlzID0gdW5kZWZpbmVkOwoKICAgICAgICAgICAgICAgIF90aGlzLnNldHVwKCkKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHNldHVwOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICAgICAgICAgICAgX3RoaXMuc2V0dXBQYW5lcygpOwogICAgICAgICAgICAgICAgX3RoaXMuZGlzcGF0Y2hNb2RlbHMoKTsKCiAgICAgICAgICAgICAgICBfdGhpcy5yZW5kZXIoKQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIHBhbmVzIGFyZSBidWlsZCBhcmUgcmVuZGVyIHRpbWUsIGJhc2VkIG9uIHRoZSBncm91cEJ5IHByb3BlcnR5CiAgICAgICAgICAgICAqIGJlZnJlIG1lc3NpbmcgZXZlcnl0aGluZyBhcm91bmQsIHdlIGNoZWNrIGlmIG5ldyBwYW5lcyB3ZXJlIGFjdHVhbGx5IGFkZGVkLgogICAgICAgICAgICAgKi8KICAgICAgICAgICAgc2V0dXBQYW5lczogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICAgICAgaWYgKHNlbGYubW9kZWwuc2l6ZSgpID09IDApIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy9nZXQgb25lIFhJQyByZXByZXNlbnRhdGl2ZXMgb2YgYSBwYW5lcwogICAgICAgICAgICAgICAgdmFyIHJlcDRwYW5lcyA9IF8uY2hhaW4oc2VsZi5tb2RlbC5tb2RlbHMpLmdyb3VwQnkoc2VsZi5ncm91cEJ5KS52YWx1ZXMoKS5tYXAoZnVuY3Rpb24gKGwpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbFswXTsKICAgICAgICAgICAgICAgIH0pLnNvcnRCeShzZWxmLmdyb3VwQnkpLnZhbHVlKCk7CgogICAgICAgICAgICAgICAgLy9leHRyYWN0IHRoZSBrZXkgcGVyIGdyb3VwLCBhbmQgcmV0dXJuIGlmIG5vIGNoYW5nZS4KICAgICAgICAgICAgICAgIHZhciBwYW5lc0dyb3VwS2V5cyA9IF8ubWFwKHJlcDRwYW5lcywgc2VsZi5ncm91cEJ5KTsKICAgICAgICAgICAgICAgIGlmIChfLmlzRXF1YWwocGFuZXNHcm91cEtleXMsIHNlbGYucHJldlBhbmVzR3JvdXBLZXlzKSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHNlbGYucHJldlBhbmVzR3JvdXBLZXlzID0gcGFuZXNHcm91cEtleXM7CgogICAgICAgICAgICAgICAgLy9leHRyYWN0IGdyb3VwIG5hbWVzCiAgICAgICAgICAgICAgICBzZWxmLnBhbmVOYW1lcyA9IHJlcDRwYW5lcy5tYXAoc2VsZi5nZXRHcm91cE5hbWUpOwogICAgICAgICAgICAgICAgdmFyIG5iUGFuZXMgPSByZXA0cGFuZXMubGVuZ3RoOwoKICAgICAgICAgICAgICAgIHZhciBoZWlnaHRQYW5lID0gTWF0aC5mbG9vcigoc2VsZi5oZWlnaHQoKSAtIHNlbGYuaGVpZ2h0WEF4aXMpIC8gbmJQYW5lcyk7CgogICAgICAgICAgICAgICAgaWYgKHNlbGYueGF4aXNWaWV3ID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICBzZWxmLnNldHVwU2NhbGluZ0NvbnRleHQoewogICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IGhlaWdodFBhbmUKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB2YXIgZ3hheGlzID0gc2VsZi5lbC5hcHBlbmQoJ2cnKS5hdHRyKCdjbGFzcycsICd0aW1lLXNjYWxlIHhheGlzJykuYXR0cigndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZSgwLCcgKyAoc2VsZi5oZWlnaHQoKSAtIHNlbGYuaGVpZ2h0WEF4aXMpICsgJyknKTsKICAgICAgICAgICAgICAgICAgICBneGF4aXMuYXBwZW5kKCdyZWN0JykuYXR0cignd2lkdGgnLCBzZWxmLnNjYWxpbmdDb250ZXh0LndpZHRoKCkpLmF0dHIoJ2hlaWdodCcsIHNlbGYuaGVpZ2h0WEF4aXMpLmF0dHIoJ2NsYXNzJywgJ2JhY2tncm91bmQnKTsKICAgICAgICAgICAgICAgICAgICBzZWxmLnhheGlzVmlldyA9IG5ldyBEM1hBeGlzVmlldyh7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsOiBneGF4aXMuYXBwZW5kKCdnJyksCiAgICAgICAgICAgICAgICAgICAgICAgIHNjYWxpbmdDb250ZXh0OiBzZWxmLnNjYWxpbmdDb250ZXh0LAogICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm06IGZ1bmN0aW9uICh4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4geCAvIDYwCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBzZWxmLnNldHVwWm9vbSgpOwoKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvL2NyZWF0ZSBwYW5lcyBpZiB0aGVyZSBhcmUgbmVjZXNzYXJ5CiAgICAgICAgICAgICAgICByZXA0cGFuZXMuZm9yRWFjaChmdW5jdGlvbiAocmVwWGljLCBpKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGsgPSBzZWxmLmdyb3VwQnkocmVwWGljKTsKICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZi54aWNQYW5lc1trXSA9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGcgPSBzZWxmLmVsLmFwcGVuZCgnZycpOwogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmdyb3VwZWRNb2RlbHNba10gPSBuZXcgWElDQ29sbGVjdGlvbigpOwoKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi54aWNQYW5lc1trXSA9IG5ldyBNdWx0aVhJQ1ZpZXcoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWw6IGcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY2FsaW5nQ29udGV4dDogc2VsZi5zY2FsaW5nQ29udGV4dCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsOiBzZWxmLmdyb3VwZWRNb2RlbHNba10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBzZWxmLmdldEdyb3VwTmFtZShyZXBYaWMpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgeWF4aXM6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBub0F1dG9YOiBzZWxmLm5vQXV0b1gsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogc2VsZi5nZXRHcm91cE5hbWUocmVwWGljKQoKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHNlbGYueGljUGFuZXNba10uZWwuYXR0cigndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZSgwLCcgKyAoaSAqIGhlaWdodFBhbmUgKSArICcpJyk7CiAgICAgICAgICAgICAgICAgICAgLy9zZWxmLnhpY1BhbmVzW2tdLnNjYWxpbmdDb250ZXh0ID0gc2VsZi5zY2FsaW5nQ29udGV4dDsKICAgICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKGssIHNlbGYueGljUGFuZXNba10uc2NhbGluZ0NvbnRleHQpCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgc2VsZi5zY2FsaW5nQ29udGV4dC5oZWlnaHQoaGVpZ2h0UGFuZSk7CiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKHNlbGYuY2lkLCAnYWRkaW5nIHBhbmUnLCBuYW1lLCBzZWxmLnhpY1BhbmVzW25hbWVdLmNpZCkKCiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBzZXR1cFpvb206IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgICAgIHNlbGYueFpvb21hYmxlKCkKCiAgICAgICAgICAgICAgICBzZWxmLmdldE1heFlJblhEb21haW4gPSBmdW5jdGlvbiAoeG1pbiwgeG1heCkgewogICAgICAgICAgICAgICAgICAgIHZhciB5bWF4ID0gXy5jaGFpbihzZWxmLm1vZGVsLm1vZGVscykucGx1Y2soJ19kYXRhUG9pbnRzJykubWFwKGZ1bmN0aW9uIChkcHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF8uY2hhaW4oZHBzKS5maWx0ZXIoZnVuY3Rpb24gKGRwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZHBbMF0gPj0geG1pbiAmJiBkcFswXSA8PSB4bWF4OwogICAgICAgICAgICAgICAgICAgICAgICB9KS5wbHVjaygxKS5tYXgoKS52YWx1ZSgpOwogICAgICAgICAgICAgICAgICAgIH0pLm1heCgpLnZhbHVlKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHltYXggKiAxLjEgLy8xLjEgYXNzZXJ0IGZvciB0aGUgc2NhbGluZ1kgY29udGV4dCBtYWpvcmVkIGZyb20gdGhlIHJlYWwgbWF4CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoc2VsZi5ydERvbWFpblNlbGVjdG9yID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICBzZWxmLnBfaW5pdF9ydF9kb21haW5fc2VsZWN0b3Ioc2VsZi5yZXRlbnRpb25UaW1lU2VsZWN0Q2FsbGJhY2spCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHNlbGYucnREb21haW5TZWxlY3Rvci5zY2FsaW5nQ29udGV4dCA9IHNlbGYuc2NhbGluZ0NvbnRleHQ7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICB9LAoKICAgICAgICAgICAgc2V0dXBMZWdlbmQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgICAgICAgICAgICBfdGhpcy5nTGVnZW5kID0gX3RoaXMuZWwuYXBwZW5kKCdnJykuYXR0cignY2xhc3MnLCAnY2hyb21hdG8gbGVnZW5kJyk7CiAgICAgICAgICAgICAgICBfdGhpcy5nTGVnZW5kLmFwcGVuZCgncmVjdCcpLmF0dHIoJ2NsYXNzJywgJ2JhY2tncm91bmQnKS5hdHRyKCdyeCcsIDUpLmF0dHIoJ3J5JywgNSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXM7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICAvKioKICAgICAgICAgICAgICogdGhlIG1vZGVsIGlzIGEgY29sbGVjdGlvbnMsIGJ1dCB0aG9zZSBtb2RlbHMgc2hvdWxkIGJlIGRpc3BhdGNoZWQgdG93cmFkcyB0aGUgaW5kaXZpZHVhbCAgc2VsZi5ncm91cGVkTW9kZWxzW2tdCiAgICAgICAgICAgICAqIEFuZCB0aGUgcG9pbnQgaXMgbm90IHRvIHVwZGF0ZSBhIGNvbGxlY3Rpb24gdGhhdCBoYXMgbm90IGNoYW5nZWQuLi4uCiAgICAgICAgICAgICAqCiAgICAgICAgICAgICAqLwogICAgICAgICAgICBkaXNwYXRjaE1vZGVsczogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICAgICAgXy5jaGFpbihzZWxmLm1vZGVsLm1vZGVscykuZ3JvdXBCeShzZWxmLmdyb3VwQnkpLmVhY2goZnVuY3Rpb24gKGxNb2RlbHMsIGspIHsKICAgICAgICAgICAgICAgICAgICBsTW9kZWxzLmZvckVhY2goZnVuY3Rpb24gKHgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5ncm91cGVkTW9kZWxzW2tdLmFkZCh4KQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIC8vc2VsZi5ncm91cGVkTW9kZWxzW2tdLnJlc2V0KGxNb2RlbHMpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBhZGQgdGhlIGxlZ2VuZHMgaW50byB0aGUgYm94CiAgICAgICAgICAgICAqLwogICAgICAgICAgICByZW5kZXJMZWdlbmQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICAgICAgICAgICAgaWYgKF90aGlzLmdMZWdlbmQgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgIF90aGlzLnNldHVwTGVnZW5kKCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdmFyIGhMaW5lID0gMjA7CiAgICAgICAgICAgICAgICB2YXIgd01veiA9IDEzMDsKICAgICAgICAgICAgICAgIHZhciB3VGV4dCA9IDIwMDsKCiAgICAgICAgICAgICAgICBfdGhpcy5nTGVnZW5kLnNlbGVjdEFsbCgnZy5sZWdlbmQtbGluZScpLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgdmFyIG1heE1veiA9IF8uY2hhaW4oX3RoaXMubW9kZWwubGVnZW5kcy5saXN0KCkpLnBsdWNrKCdtYXNzZXMnKS5tYXAoZnVuY3Rpb24gKGwpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbC5maWx0ZXIoZnVuY3Rpb24gKG0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG07CiAgICAgICAgICAgICAgICAgICAgfSkubGVuZ3RoOwogICAgICAgICAgICAgICAgfSkubWF4KCkudmFsdWUoKTsKICAgICAgICAgICAgICAgIG1heE1veiA9IE1hdGgubWF4KG1heE1veiwgMCk7CgogICAgICAgICAgICAgICAgXy5lYWNoKF90aGlzLm1vZGVsLmxlZ2VuZHMubGlzdCgpLCBmdW5jdGlvbiAobGVnLCBpTGVnKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGdMaW5lID0gX3RoaXMuZ0xlZ2VuZC5hcHBlbmQoJ2cnKS5hdHRyKCdjbGFzcycsICdsZWdlbmQtbGluZScpLmF0dHIoJ3RyYW5zZm9ybScsICd0cmFuc2xhdGUoNSwnICsgKGhMaW5lICogKGlMZWcgKyAwLjUpKSArICcpJykKCiAgICAgICAgICAgICAgICAgICAgdmFyIGltb3ogPSAwOwogICAgICAgICAgICAgICAgICAgIF8uZWFjaChsZWcubWFzc2VzLCBmdW5jdGlvbiAobW96LCB6KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghbW96KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGdNb3ogPSBnTGluZS5hcHBlbmQoJ2cnKS5hdHRyKCd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlKCcgKyAoaW1veiAqIHdNb3opICsgJywwKScpLmF0dHIoJ2NsYXNzJywgJyBsZWdlbmQtZW5saWdodGVyJykuYXR0cignbGVnZW5kc3VibGlnaHRlZCcsICcuY2hyb21hdG8nKS5hdHRyKCdsZWdlbmRlbmxpZ2h0ZWQnLCAnLmNocm9tYXRvLmNoYXJnZV8nICsgeiArICcudGFyZ2V0XycgKyBpTGVnKTsKICAgICAgICAgICAgICAgICAgICAgICAgZ01vei5hcHBlbmQoJ3BhdGgnKS5hdHRyKCdkJywgJ00wLDBMNTAsMCcpLmF0dHIoJ2NsYXNzJywgJ2Nocm9tYXRvIHRhcmdldF8nICsgaUxlZyArICcgY2hhcmdlXycgKyB6KTsKICAgICAgICAgICAgICAgICAgICAgICAgZ01vei5hcHBlbmQoJ3RleHQnKS50ZXh0KCcnICsgeiArICcrICgnICsgbW96LnRvRml4ZWQoNCkgKyAnKScpLmF0dHIoJ3gnLCA1NSk7CgogICAgICAgICAgICAgICAgICAgICAgICBpbW96Kys7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgZ0xpbmUuYXBwZW5kKCd0ZXh0JykuYXR0cigneCcsIG1heE1veiAqIHdNb3opLnRleHQobGVnLm5hbWUpOwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgX3RoaXMuZ0xlZ2VuZC5zZWxlY3RBbGwoJ2cubGVnZW5kLWVubGlnaHRlcicpLm9uKCdtb3VzZW92ZXInLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGVuU2VsID0gJCh0aGlzKS5hdHRyKCdsZWdlbmRlbmxpZ2h0ZWQnKTsKICAgICAgICAgICAgICAgICAgICB2YXIgc3ViU2VsID0gJCh0aGlzKS5hdHRyKCdsZWdlbmRzdWJsaWdodGVkJyk7CgogICAgICAgICAgICAgICAgICAgIGQzLnNlbGVjdEFsbChzdWJTZWwpLnN0eWxlKCdzdHJva2Utb3BhY2l0eScsICcxNSUnKTsKICAgICAgICAgICAgICAgICAgICBkMy5zZWxlY3RBbGwoZW5TZWwpLnN0eWxlKCdzdHJva2Utb3BhY2l0eScsIG51bGwpOwogICAgICAgICAgICAgICAgICAgIGQzLnNlbGVjdEFsbChzdWJTZWwpLnN0eWxlKCdmaWxsLW9wYWNpdHknLCAnMTUlJyk7CiAgICAgICAgICAgICAgICAgICAgZDMuc2VsZWN0QWxsKGVuU2VsKS5zdHlsZSgnZmlsbC1vcGFjaXR5JywgbnVsbCk7CiAgICAgICAgICAgICAgICB9KS5vbignbW91c2VvdXQnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHN1YlNlbCA9ICQodGhpcykuYXR0cignbGVnZW5kc3VibGlnaHRlZCcpOwogICAgICAgICAgICAgICAgICAgIGQzLnNlbGVjdEFsbChzdWJTZWwpLnN0eWxlKCdzdHJva2Utb3BhY2l0eScsIG51bGwpOwogICAgICAgICAgICAgICAgICAgIGQzLnNlbGVjdEFsbChzdWJTZWwpLnN0eWxlKCdmaWxsLW9wYWNpdHknLCBudWxsKTsKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIHZhciB3ID0gbWF4TW96ICogd01veiArIHdUZXh0OwogICAgICAgICAgICAgICAgX3RoaXMuZ0xlZ2VuZC5hdHRyKCd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlKCcgKyAoX3RoaXMud2lkdGgoKSAtIHcgLSAyMCkgKyAnLCcgKyA0MCArICcpJykKICAgICAgICAgICAgICAgIF90aGlzLmdMZWdlbmQuc2VsZWN0QWxsKCdyZWN0LmJhY2tncm91bmQnKS5hdHRyKCd3aWR0aCcsIHcpLmF0dHIoJ2hlaWdodCcsIF90aGlzLm1vZGVsLmxlZ2VuZHMuc2l6ZSgpICogaExpbmUpOwogICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAob3B0aW9ucykgewogICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICAgICAgaWYgKHNlbGYueGF4aXNWaWV3KSB7CiAgICAgICAgICAgICAgICAgICAgc2VsZi54YXhpc1ZpZXcucmVuZGVyKCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIDsKCiAgICAgICAgICAgICAgICBfLmVhY2goXy52YWx1ZXMoc2VsZi54aWNQYW5lcyksIGZ1bmN0aW9uICh4dikgewogICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coJ211bHRpcGFuZSByZW5kZXJpbmcgTVVUTFRJIFhJQycsIHh2KQogICAgICAgICAgICAgICAgICAgIHh2LnJlbmRlcigpOwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgaWYgKHNlbGYubGVnZW5kSXNEaXNwbGF5ZWQpIHsKICAgICAgICAgICAgICAgICAgICBzZWxmLnJlbmRlckxlZ2VuZCgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICByZXR1cm4gWElDTXVsdGlQYW5lVmlldzsKICAgIH0pOwoKLyoKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCmRlZmluZSgnZmlzaHRvbmVzL3ZpZXdzL3dldC9TcGVjdHJ1bVZpZXcnLFsndW5kZXJzY29yZScsICdkMycsICcuLi9jb21tb25zL0NvbW1vbldpZGdldFZpZXcnLCAnZmlzaHRvbmVzL3ZpZXdzL3V0aWxzL0QzU2NhbGluZ0NvbnRleHQnLCAnZmlzaHRvbmVzL3ZpZXdzL3V0aWxzL0QzU2NhbGluZ0FyZWEnXSwgZnVuY3Rpb24gKF8sIGQzLCBDb21tb25XaWRnZXRWaWV3LCBEM1NjYWxpbmdDb250ZXh0LCBEM1NjYWxpbmdBcmVhKSB7CiAgICAvKgogICAgICogcHJvamVjdGVkIHBlYWtzIGNvbnRhaW5zIDMgdmFsdWVzOgogICAgICoKICAgICAqIDA6IG1vegogICAgICogMTppbnRlbnNpdHkKICAgICAqIDI6IGludGVuc2l0eSByYW5rcwogICAgICovCiAgICB2YXIgcHJvamVjdFBlYWtzID0gZnVuY3Rpb24gKGV4cFNwKSB7CiAgICAgICAgcmV0dXJuIF8uY2hhaW4oZXhwU3AuZ2V0KCdtb3pzJykpLnppcChleHBTcC5nZXQoJ2ludGVuc2l0aWVzJyksIGV4cFNwLmdldCgnaW50ZW5zaXR5UmFua3MnKSkudmFsdWUoKQoKICAgIH0KICAgIHZhciBwZWFrUmFua0NsYXNzID0gZnVuY3Rpb24gKHBrKSB7CiAgICAgICAgdmFyIGlyayA9IHBrWzJdOwogICAgICAgIHJldHVybiAncmstJyArICgoaXJrIDwgNDApID8gTWF0aC5mbG9vcihpcmsgLyAxMCkgOiAneCcpOwogICAgfQogICAgdmFyIFNwZWN0cnVtVmlldyA9IENvbW1vbldpZGdldFZpZXcuZXh0ZW5kKHsKICAgICAgICBkZWZhdWx0czogewogICAgICAgIH0sCiAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKG9wdGlvbnMpIHsKICAgICAgICAgICAgb3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCBvcHRpb25zKTsKICAgICAgICAgICAgU3BlY3RydW1WaWV3Ll9fc3VwZXJfXy5pbml0aWFsaXplLmNhbGwodGhpcywgb3B0aW9ucykKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICBzZWxmLmNvbG9yUGVha3MgPSBvcHRpb25zLmNvbG9yUGVha3M7CgogICAgICAgICAgICBzZWxmLmhTY2FsZT0yMDsKICAgICAgICAgICAgc2VsZi5idWlsZCgpOwogICAgICAgICAgICBzZWxmLm1vZGVsLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBzZWxmLmJ1aWxkKCkucmVuZGVyKCk7CiAgICAgICAgICAgIH0pCiAgICAgICAgfSwKCiAgICAgICAgYnVpbGQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuYnVpbGREYXRhKCkuYnVpbGRDb250ZXh0KCkuYnVpbGREMygpOwogICAgICAgIH0sCiAgICAgICAgYnVpbGREYXRhOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgc2VsZi5wZWFrcyA9IHByb2plY3RQZWFrcyhzZWxmLm1vZGVsKTsKCiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIH0sCiAgICAgICAgYnVpbGRDb250ZXh0OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgICAgICAgIHZhciB4TWF4ID0gc2VsZi5tb2RlbC5nZXQoJ21venMnKVtzZWxmLm1vZGVsLnNpemUoKSAtIDFdICogMS4xOwogICAgICAgICAgICB2YXIgeE1pbiA9IHNlbGYubW9kZWwuZ2V0KCdtb3pzJylbMF0gKiAwLjU7CiAgICAgICAgICAgIHZhciB5TWF4ID0gTWF0aC5tYXgoXy5tYXgoc2VsZi5tb2RlbC5nZXQoJ2ludGVuc2l0aWVzJykpKSAqIDEuMDU7CgogICAgICAgICAgICBzZWxmLnNldHVwU2NhbGluZ0NvbnRleHQoewogICAgICAgICAgICAgICAgeERvbWFpbjogW3hNaW4sIHhNYXhdLAogICAgICAgICAgICAgICAgeURvbWFpbjogWzAsIHlNYXhdLAogICAgICAgICAgICAgICAgaGVpZ2h0OiBzZWxmLmhlaWdodCgpLXNlbGYuaFNjYWxlLAogICAgICAgICAgICAgICAgd2lkdGg6IHNlbGYud2lkdGgoKQogICAgICAgICAgICB9KQoKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgfSwKICAgICAgICBidWlsZEQzOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgICAgICAgIHNlbGYudmlzID0gc2VsZi5lbC5hcHBlbmQoJ2cnKTsKICAgICAgICAgICAgc2VsZi52aXMuYXR0cignd2lkdGgnLCBzZWxmLndpZHRoKCkpLmF0dHIoJ2hlaWdodCcsIHNlbGYuaGVpZ2h0KCkpLmF0dHIoJ2NsYXNzJywgJ3NwZWN0cnVtJyk7CgogICAgICAgICAgICB2YXIgeXMgPSBzZWxmLnNjYWxpbmdDb250ZXh0LnkoKTsKCiAgICAgICAgICAgIHNlbGYucGVha3NIb2xkZXIgPSBzZWxmLnZpcy5zZWxlY3RBbGwoJ2xpbmUucGVhaycpLmRhdGEoc2VsZi5wZWFrcykuZW50ZXIoKS5hcHBlbmQoJ2xpbmUnKS5hdHRyKCdjbGFzcycsIGZ1bmN0aW9uIChwaykgewogICAgICAgICAgICAgICAgdmFyIGNsID0gJ3BlYWsgIHBlYWsteCc7CiAgICAgICAgICAgICAgICBpZiAoc2VsZi5jb2xvclBlYWtzKSB7CiAgICAgICAgICAgICAgICAgICAgY2wgKz0gJyAnICsgcGVha1JhbmtDbGFzcyhwayk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gY2w7CiAgICAgICAgICAgIH0pLmF0dHIoJ3kxJywgZnVuY3Rpb24gKHBrKSB7CiAgICAgICAgICAgICAgICByZXR1cm4geXMoMCk7CiAgICAgICAgICAgIH0pLmF0dHIoJ3kyJywgZnVuY3Rpb24gKHBrKSB7CiAgICAgICAgICAgICAgICByZXR1cm4geXMocGtbMV0pOwogICAgICAgICAgICB9KTsKCgogICAgICAgICAgICB2YXIgZ3RpdGxlcyA9IHNlbGYudmlzLmFwcGVuZCgnZycpLmF0dHIoJ2NsYXNzJywgJ3RpdGxlcycpCiAgICAgICAgICAgIGd0aXRsZXMuYXBwZW5kKCd0ZXh0JykudGV4dCgnIycgKyBzZWxmLm1vZGVsLmdldCgnc2Nhbk51bWJlcicpKS5hdHRyKCd4Jywgc2VsZi53aWR0aCgpIC0gNSkuYXR0cigneScsIDMwKS5hdHRyKCdjbGFzcycsICdzY2FuIHRvcCcpCgogICAgICAgICAgICBzZWxmLmF4aXNDb250YWluZXIgPSBzZWxmLnZpcy5hcHBlbmQoJ2cnKS5hdHRyKCdjbGFzcycsICdheGlzJykuYXR0cigndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZSgwLCcreXMoMCkrJyknKTsKCiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIH0sCiAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIHggPSBzZWxmLnNjYWxpbmdDb250ZXh0LngoKTsKCiAgICAgICAgICAgIHNlbGYudmlzLnNlbGVjdEFsbCgnbGluZS5wZWFrLXgnKS5hdHRyKCd4MScsIGZ1bmN0aW9uIChwaykgewogICAgICAgICAgICAgICAgcmV0dXJuIHgocGtbMF0pCiAgICAgICAgICAgIH0pLmF0dHIoJ3gyJywgZnVuY3Rpb24gKHBrKSB7CiAgICAgICAgICAgICAgICByZXR1cm4geChwa1swXSkKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHZhciB4QXhpcyA9IGQzLnN2Zy5heGlzKCkuc2NhbGUoeCkudGlja1NpemUoNCwgMywgMykudGlja3MoMykvLyIiLnRpY2tGb3JtYXQoZDMuZm9ybWF0KCJkIikpOwogICAgICAgICAgICBzZWxmLmF4aXNDb250YWluZXIuY2FsbCh4QXhpcyk7CiAgICAgICAgfQogICAgfSk7CgogICAgcmV0dXJuIFNwZWN0cnVtVmlldzsKCn0pCjsKLyoKICogQ2xlYXZhZ2UgZW56eW1lIHRvIGNsZWF2ZSBwcm90ZWluIHNlcXVlbmNlCiAqIHByb3BlcnRpZXM6CiAqIC0gbmFtZQogKiAtIHJ1bGU6IGEgcmVndWxhciBleHByZXNzaW9uIChzaW50cmcgb3IgUmVnRXhwIG9iamVjdCkKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCmRlZmluZSgnZmlzaHRvbmVzL21vZGVscy9kcnkvQ2xlYXZhZ2VFbnp5bWUnLFsndW5kZXJzY29yZScsICdCYWNrYm9uZSddLCBmdW5jdGlvbihfLCBCYWNrYm9uZSkgewogICAgdmFyIENsZWF2YWdlRW56eW1lID0gQmFja2JvbmUuTW9kZWwuZXh0ZW5kKHsKICAgICAgICBpZEF0dHJpYnV0ZSA6ICduYW1lJywKICAgICAgICBkZWZhdWx0cyA6IHsKICAgICAgICAgICAgbmFtZSA6ICcnLAogICAgICAgICAgICBydWxlIDogbnVsbAogICAgICAgIH0sCiAgICAgICAgc2V0IDogZnVuY3Rpb24oYXR0cnMsIG9wdGlvbnMpIHsKICAgICAgICAgICAgaWYgKF8uaXNTdHJpbmcoYXR0cnMucnVsZSkpIHsKICAgICAgICAgICAgICAgIGF0dHJzLnJ1bGUgPSBuZXcgUmVnRXhwKCBhdHRycy5ydWxlLCAnZycpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBCYWNrYm9uZS5Nb2RlbC5wcm90b3R5cGUuc2V0LmNhbGwodGhpcywgYXR0cnMsIG9wdGlvbnMpOwogICAgICAgIH0sCiAgICAgICAgaW5pdGlhbGl6ZSA6IGZ1bmN0aW9uKCkgewogICAgICAgIH0sCgogICAgICAgIHRvU3RyaW5nIDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgcmV0dXJuIHNlbGYuZ2V0KCduYW1lJykgKyBzZWxmLmdldCgncnVsZScpOwogICAgICAgIH0sCiAgICAgICAgLyoqCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gc2VxIGFuIGlucHV0IGFtaW5vIGFjaWQgc3RyaW5nIHNlcXVlbmNlCiAgICAgICAgICogQHJldHVybiB7QXJyYXl9IGEgbGlzdCBvZiBzdHJpbmcgc2VxdWVuY2VzCiAgICAgICAgICovCiAgICAgICAgY2xlYXZlIDogZnVuY3Rpb24oc2VxKSB7CiAgICAgICAgICAgIHZhciByZXQgPSBbXTsKICAgICAgICAgICAgdmFyIHJlZ2V4cCA9IG5ldyBSZWdFeHAodGhpcy5nZXQoJ3J1bGUnKS5zb3VyY2UsICdnJyk7CiAgICAgICAgICAgIHdoaWxlICggbSA9IHJlZ2V4cC5leGVjKHNlcSkpIHsKICAgICAgICAgICAgICAgIHJldC5wdXNoKG1bMF0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByZXQKICAgICAgICB9CiAgICB9KTsKICAgIHJldHVybiBDbGVhdmFnZUVuenltZTsKfSk7CgovKgogKiBlbnp5bWUgd2l0aCByZWd1bGFyIGV4cHJlc3Npb24uIFRoZXNlcyBhcmUgYSBiaXQgdWdseSwgYmVjYXVzZSBKYXZhU2NyaXB0IGRvZXMgc3VwcG9ydCBsb29rIGFoZWFkCiAqIFRoaXMgZmlsZSBpcyB0byBiZSBsb2FkZWQgYnkgY29sbGVjdGlvbnMvZHJ5L0NsZWF2YWdlRW56eW1lRGljdGlvbmFyeQogKiAKICogQ29weXJpZ2h0IChjKSAyMDEzLTItMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCgpkZWZpbmUoJ2Zpc2h0b25lcy9kYXRhL2NsZWF2YWdlRW56eW1lcycsW10sZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIFsKICAgICAgICB7CiAgICAgICAgICAgIG5hbWU6ICJ0cnlwc2luIiwKICAgICAgICAgICAgcnVsZTogJyg/OltSS118Lis/KD86W1JLXXwkKSkoPz1bXlBdfCQpJwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBuYW1lOiAiYXJnLWMiLAogICAgICAgICAgICBydWxlOiAnKD86UnwuKz8oPzpSfCQpKSg/PVteUF18JCknCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIG5hbWU6ICJjaHltb3RyeXBzaW4iLAogICAgICAgICAgICBydWxlOiAnKD86W0ZMV1ldfC4rPyg/OltGTFdZXXwkKSkoPz1bXlBdfCQpJwogICAgICAgIH0KICAgIF0KfSk7CgoKLyoKICogQSBzaW5nbGV0b24gY2xlYXZhZ2UgZW56eW1lIGNvbGxlY3Rpb24sIGxvYWRlZCBmcm9tIGRhdGEvY2xlYXZhZ2VFbnp5bWVzLmpzCiAqIAogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KCmRlZmluZSgnZmlzaHRvbmVzL2NvbGxlY3Rpb25zL2RyeS9DbGVhdmFnZUVuenltZURpY3Rpb25hcnknLFsnZmlzaHRvbmVzL21vZGVscy9kcnkvQ2xlYXZhZ2VFbnp5bWUnLCAnZmlzaHRvbmVzL2RhdGEvY2xlYXZhZ2VFbnp5bWVzJ10sIGZ1bmN0aW9uKENsZWF2YWdlRW56eW1lLCBic19lbnp5bWVzKSB7CiAgICB2YXIgQ2xlYXZhZ2VFbnp5bWVEaWN0aW9uYXJ5ID0gQmFja2JvbmUuQ29sbGVjdGlvbi5leHRlbmQoewogICAgICAgIG1vZGVsIDogQ2xlYXZhZ2VFbnp5bWUsCiAgICAgICAgZGVmYXVsdHMgOiB7CiAgICAgICAgfSwKICAgICAgICBpbml0aWFsaXplIDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgc2VsZi5hZGQoYnNfZW56eW1lcyk7CiAgICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gbmV3IENsZWF2YWdlRW56eW1lRGljdGlvbmFyeSgpOwp9KTsKCi8qCiAqIEFuIGFtaW5vIGFjaWQgc2VxdWVuY2UsIHdpdGgKICogLSBhY2Nlc3Npb25jb2RlCiAqIC0gbmFtZQogKiAtIHNlcXVlbmNlCiAqCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwpkZWZpbmUoJ2Zpc2h0b25lcy9tb2RlbHMvZHJ5L0FBU2VxdWVuY2UnLFsnanF1ZXJ5JywgJ3VuZGVyc2NvcmUnLCAnQmFja2JvbmUnXSwgZnVuY3Rpb24oJCwgXywgQmFja2JvbmUpIHsKICAgIHZhciBBQVNlcXVlbmNlID0gQmFja2JvbmUuTW9kZWwuZXh0ZW5kKHsKICAgICAgICBpZEF0dHJpYnV0ZSA6ICduYW1lJywKICAgICAgICBkZWZhdWx0cyA6IHsKICAgICAgICAgICAgbmFtZSA6IG51bGwsCiAgICAgICAgICAgIGFjY2Vzc2lvbkNvZGUgOiBudWxsLAogICAgICAgICAgICBzZXF1ZW5jZSA6IG51bGwKICAgICAgICB9LAogICAgICAgIGluaXRpYWxpemUgOiBmdW5jdGlvbigpIHsKICAgICAgICB9LAogICAgICAgIHRvU3RyaW5nIDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgcmV0dXJuIHNlbGYuZ2V0KCdhY2Nlc3Npb25jb2RlJykgKyAnfCcgKyBzZWxmLmdldCgnbmFtZScpICsgJyAoJyArIHNlbGYuZ2V0KCdzZXF1ZW5jZScpLmxlbmdoICsgJyknOwogICAgICAgIH0sCiAgICAgICAgc2l6ZSA6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgcyA9IHRoaXMuZ2V0KCdzZXF1ZW5jZScpCiAgICAgICAgICAgIGlmIChzID09IG51bGwpIHsKICAgICAgICAgICAgICAgIHJldHVybiAwCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHMubGVuZ3RoCiAgICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gQUFTZXF1ZW5jZTsKfSk7IAoKLyoKICogYSBmZXcgZGVmYXVsdCBzZXF1ZW5jZXMsIGJ1dCBhbnkgb3RoZXIgY2FuIGJlIGFkZGVkCiAqCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwpkZWZpbmUoJ2Zpc2h0b25lcy9kYXRhL2FhU2VxdWVuY2VzJyxbXSxmdW5jdGlvbigpIHsKICAgIHJldHVybiBbewogICAgICAgIG5hbWUgOiAiSDMuMSIsCiAgICAgICAgYWNjZXNzaW9uQ29kZSA6ICJQNjg0MzEiLAogICAgICAgIHNlcXVlbmNlIDogIk1BUlRLUVRBUktTVEdHS0FQUktRTEFUS0FBUktTQVBBVEdHVktLUEhSWVJQR1RWQUxSRUlSUllRS1NURUxMSVJLTFBGUVJMVlJFSUFRREZLVERMUkZRU1NBVk1BTFFFQUNFQVlMVkdMRkVEVE5MQ0FJSEFLUlZUSU1QS0RJUUxBUlJJUkdFUkEiCiAgICB9LCB7CiAgICAgICAgbmFtZSA6ICJIMy4xVCIsCiAgICAgICAgYWNjZXNzaW9uQ29kZSA6ICJRMTY2OTUiLAogICAgICAgIHNlcXVlbmNlIDogIk1BUlRLUVRBUktTVEdHS0FQUktRTEFUS1ZBUktTQVBBVEdHVktLUEhSWVJQR1RWQUxSRUlSUllRS1NURUxMSVJLTFBGUVJMTVJFSUFRREZLVERMUkZRU1NBVk1BTFFFQUNFU1lMVkdMRkVEVE5MQ1ZJSEFLUlZUSU1QS0RJUUxBUlJJUkdFUkEiCiAgICB9LCB7CiAgICAgICAgbmFtZSA6ICJIMy4yIiwKICAgICAgICBhY2Nlc3Npb25Db2RlIDogIlE3MURJMyIsCiAgICAgICAgc2VxdWVuY2UgOiAiTUFSVEtRVEFSS1NUR0dLQVBSS1FMQVRLQUFSS1NBUEFUR0dWS0tQSFJZUlBHVFZBTFJFSVJSWVFLU1RFTExJUktMUEZRUkxWUkVJQVFERktURExSRlFTU0FWTUFMUUVBU0VBWUxWR0xGRURUTkxDQUlIQUtSVlRJTVBLRElRTEFSUklSR0VSQSIKICAgIH0sIHsKICAgICAgICBuYW1lIDogIkgzLjMiLAogICAgICAgIGFjY2Vzc2lvbkNvZGUgOiAiUDg0MjQzIiwKICAgICAgICBzZXF1ZW5jZSA6ICJNQVJUS1FUQVJLU1RHR0tBUFJLUUxBVEtBQVJLU0FQU1RHR1ZLS1BIUllSUEdUVkFMUkVJUlJZUUtTVEVMTElSS0xQRlFSTFZSRUlBUURGS1RETFJGUVNBQUlHQUxRRUFTRUFZTFZHTEZFRFROTENBSUhBS1JWVElNUEtESVFMQVJSSVJHRVJBIgogICAgfSwgewogICAgICAgIG5hbWUgOiAiSDMuQyIsCiAgICAgICAgYWNjZXNzaW9uQ29kZSA6ICJRNk5YVDIiLAogICAgICAgIHNlcXVlbmNlIDogIk1BUlRLUVRBUktTVEdHS0FQUktRTEFUS0FBUktTVFBTVENHVktQSFJZUlBHVFZBTFJFSVJSWVFLU1RFTExJUktMUEZRUkxWUkVJQVFERk5URExSRlFTQUFWR0FMUUVBU0VBWUxWR0xMRURUTkxDQUlIQUtSVlRJTVBLRElRTEFSUklSR0VSQSIKICAgIH0sIHsKICAgICAgICBuYW1lIDogIkg0IiwKICAgICAgICBhY2Nlc3Npb25Db2RlIDogIlA2MjgwNSIsCiAgICAgICAgc2VxdWVuY2UgOiAiTVNHUkdLR0dLR0xHS0dHQUtSSFJLVkxSRE5JUUdJVEtQQUlSUkxBUlJHR1ZLUklTR0xJWUVFVFJHVkxLVkZMRU5WSVJEQVZUWVRFSEFLUktUVlRBTURWVllBTEtSUUdSVExZR0ZHRyIKICAgIH1dCn0pOwoKLy8gPnNwfFA2ODQzMXxIMzFfSFVNQU4gSGlzdG9uZSBIMy4xIE9TPUhvbW8gc2FwaWVucyBHTj1ISVNUMUgzQSBQRT0xIFNWPTIKLy8gTUFSVEtRVEFSS1NUR0dLQVBSS1FMQVRLQUFSS1NBUEFUR0dWS0tQSFJZUlBHVFZBTFJFSVJSWVFLU1RFTExJUktMUEZRUkxWUkVJQVFERktURExSRlFTU0FWTUFMUUVBQ0VBWUxWR0xGRURUTkxDQUlIQUtSVlRJTVBLRElRTEFSUklSR0VSQQovLyA+c3B8UTE2Njk1fEgzMVRfSFVNQU4gSGlzdG9uZSBIMy4xdCBPUz1Ib21vIHNhcGllbnMgR049SElTVDNIMyBQRT0xIFNWPTMKLy8gTUFSVEtRVEFSS1NUR0dLQVBSS1FMQVRLVkFSS1NBUEFUR0dWS0tQSFJZUlBHVFZBTFJFSVJSWVFLU1RFTExJUktMUEZRUkxNUkVJQVFERktURExSRlFTU0FWTUFMUUVBQ0VTWUxWR0xGRURUTkxDVklIQUtSVlRJTVBLRElRTEFSUklSR0VSQQoKLy8gPnNwfFE3MURJM3xIMzJfSFVNQU4gSGlzdG9uZSBIMy4yIE9TPUhvbW8gc2FwaWVucyBHTj1ISVNUMkgzQSBQRT0xIFNWPTMKLy8gTUFSVEtRVEFSS1NUR0dLQVBSS1FMQVRLQUFSS1NBUEFUR0dWS0tQSFJZUlBHVFZBTFJFSVJSWVFLU1RFTExJUktMUEZRUkxWUkVJQVFERktURExSRlFTU0FWTUFMUUVBU0VBWUxWR0xGRURUTkxDQUlIQUtSVlRJTVBLRElRTEFSUklSR0VSQQoKLy8gPnNwfFA4NDI0M3xIMzNfSFVNQU4gSGlzdG9uZSBIMy4zIE9TPUhvbW8gc2FwaWVucyBHTj1IM0YzQSBQRT0xIFNWPTIKLy8gTUFSVEtRVEFSS1NUR0dLQVBSS1FMQVRLQUFSS1NBUFNUR0dWS0tQSFJZUlBHVFZBTFJFSVJSWVFLU1RFTExJUktMUEZRUkxWUkVJQVFERktURExSRlFTQUFJR0FMUUVBU0VBWUxWR0xGRURUTkxDQUlIQUtSVlRJTVBLRElRTEFSUklSR0VSQQovLyA+c3B8UTZOWFQyfEgzQ19IVU1BTiBIaXN0b25lIEgzLjNDIE9TPUhvbW8gc2FwaWVucyBHTj1IM0YzQyBQRT0xIFNWPTMKLy8gTUFSVEtRVEFSS1NUR0dLQVBSS1FMQVRLQUFSS1NUUFNUQ0dWS1BIUllSUEdUVkFMUkVJUlJZUUtTVEVMTElSS0xQRlFSTFZSRUlBUURGTlRETFJGUVNBQVZHQUxRRUFTRUFZTFZHTExFRFROTENBSUhBS1JWVElNUEtESVFMQVJSSVJHRVJBCi8vCi8vID5zcHxQNjI4MDV8SDRfSFVNQU4gSGlzdG9uZSBINCBPUz1Ib21vIHNhcGllbnMgR049SElTVDFINEEgUEU9MSBTVj0yCi8vIE1TR1JHS0dHS0dMR0tHR0FLUkhSS1ZMUkROSVFHSVRLUEFJUlJMQVJSR0dWS1JJU0dMSVlFRVRSR1ZMS1ZGTEVOVklSREFWVFlURUhBS1JLVFZUQU1EVlZZQUxLUlFHUlRMWUdGR0cKOwovKgogKiBBIHNpbmdsZXRvbiBkaWN0aW9uYXJ5IGZvciBhIGZldyBwcm90ZWluIHNlcXVlbmNlcyAobWFpbmx5IGhpc3RvbmUgdGFpbHMsIGJ1dCBhZGQgeW91ciBvd24uLi4pCiAqIGl0IGFsbG93IHRvIGdldCBhIG5hbWUgdG8gYSBzZXF1ZW5jZSwgYnV0IGFsc28sIGlmIGEgdHJ5cHRpYyBwZXB0aWRlIHNlcXVlbmNlIGlzIHVuaXF1ZSBhY3Jvc3MgdGhlIGRpZmZlcmVudCBBQVNlcXVlbmNlLAogKiB3ZSBjYW4gcmVmZXIgdG8gaXQgbGlrZSBIMy4zSzI3CiAqCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwoKZGVmaW5lKCdmaXNodG9uZXMvY29sbGVjdGlvbnMvZHJ5L0FBU2VxdWVuY2VEaWN0aW9uYXJ5JyxbJ0JhY2tib25lJywgJ2Zpc2h0b25lcy9tb2RlbHMvZHJ5L0FBU2VxdWVuY2UnLCAnZmlzaHRvbmVzL2RhdGEvYWFTZXF1ZW5jZXMnXSwgZnVuY3Rpb24oQmFja2JvbmUsIEFBU2VxdWVuY2UsIGJzX3NlcXVlbmNlcykgewogICAgdmFyIEFBU2VxdWVuY2VEaWN0aW9uYXJ5ID0gQmFja2JvbmUuQ29sbGVjdGlvbi5leHRlbmQoewogICAgICAgIG1vZGVsIDogQUFTZXF1ZW5jZSwKICAgICAgICBkZWZhdWx0cyA6IHsKICAgICAgICB9LAogICAgICAgIGluaXRpYWxpemUgOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgc2VsZi5hZGQoYnNfc2VxdWVuY2VzKTsKICAgICAgICB9CiAgICB9KTsKICAgIHJldHVybiBuZXcgQUFTZXF1ZW5jZURpY3Rpb25hcnkoKTsKfSk7CgovKgogKiBhIEFBU2VxdWVuY2VQZXB0aWRlUHRyIG9iamVjdCB0cmFuc2Zvcm1zIHBlcHRpZGUgc2VxdWVuY2UgaW50byBhIHNob3J0ZXIgcG9pbnRlciB0byB0aGUgcHJvdGVpbnMuCiAqIFRoaXMgYWxpYXMgc2hvdWxkIGJlIHVuZXF1aXZvY2FsIHJlZ2FyZGluZyB0byB0aGUgbGlzdCBvZiBrbm93biBwcm90ZWlucyAoQUFTZXF1ZW5jZURpY3Rpb25hcnkpCiAqCiAqIFRoaXMgY2xhc3MgaXMgdXNlZCBhcyBhIHV0aWxpdHkgYnkgUnVpY2hTZXF1ZW5jZVNob3J0Y3V0ZXIKICoKICogV2Ugd2FudCB0byBnaXZlIEgzSzQgYW5kIHRoaXMga2luZCBvZiBzaG9ydGN1dCwgZ2l2ZW4gYW4gZW56eW1lLCBhbmQgaXQgcmV0dXJucyBhIHVuYW1iaWd1b3VzIHBlcHRpZGUKICogQW5kIHZpY2UgdmVyc2EsIGdpdmVuIGEgcGVwdGlkZSwgaXQgZ2l2ZXMgYmFjayB0aGUgc2hvcnRlc3QgcG9zc2libGUgcG9pbnRlcgogKgogKiBGb3IgZXhhbXBsZSwgU2VlIEFBU2VxdWVuY2VQZXB0aWRlUHRyLXRlc3QuanMgZm9yIGV4YW1wbGVzCiAqCiAqIFByb3BlcnRpZXM6CiAqIC0gY2xlYXZhZ2VFbnp5bWU6IGVpdGhlciBhIG5hbWUgcmVmZXJpbmcgdG8gdGhlIGRpY3Rpb25hcnkgb3IgYW4gb2JqZWN0CiAqCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwoKCmRlZmluZSgnZmlzaHRvbmVzL21vZGVscy9kcnkvQUFTZXF1ZW5jZVBlcHRpZGVQdHInLFsndW5kZXJzY29yZScsICdCYWNrYm9uZScsICdmaXNodG9uZXMvY29sbGVjdGlvbnMvZHJ5L0NsZWF2YWdlRW56eW1lRGljdGlvbmFyeScsICdmaXNodG9uZXMvY29sbGVjdGlvbnMvZHJ5L0FBU2VxdWVuY2VEaWN0aW9uYXJ5J10sIGZ1bmN0aW9uIChfLCBCYWNrYm9uZSwgZGljb0NFLCBkaWNvU2VxKSB7CiAgICB2YXIgQUFTZXF1ZW5jZVBlcHRpZGVQdHIgPSBCYWNrYm9uZS5Nb2RlbC5leHRlbmQoewogICAgICAgIGRlZmF1bHRzOiB7CiAgICAgICAgICAgIGNsZWF2YWdlRW56eW1lOiBudWxsLAogICAgICAgICAgICBwZXB0aWRlSW5kZXg6IHt9CiAgICAgICAgfSwKICAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgfSwKICAgICAgICBzZXQ6IGZ1bmN0aW9uIChhdHRycywgb3B0aW9ucykgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHZhciBjZSA9IG51bGw7CiAgICAgICAgICAgIGlmIChhdHRycyA9PSAnY2xlYXZhZ2VFbnp5bWUnKSB7CiAgICAgICAgICAgICAgICBpZiAoXy5pc1N0cmluZyhvcHRpb25zKSkgewogICAgICAgICAgICAgICAgICAgIGNlID0gb3B0aW9ucyA9IGRpY29DRS5nZXQob3B0aW9ucykKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAob3B0aW9ucyBpbnN0YW5jZW9mIENsZWF2YWdlRW56eW1lKSB7CiAgICAgICAgICAgICAgICAgICAgY2UgPSBvcHRpb25zOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKF8uaXNTdHJpbmcoYXR0cnMuY2xlYXZhZ2VFbnp5bWUpKSB7CiAgICAgICAgICAgICAgICBjZSA9IGF0dHJzLmNsZWF2YWdlRW56eW1lID0gZGljb0NFLmdldChhdHRycy5jbGVhdmFnZUVuenltZSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoYXR0cnMuY2xlYXZhZ2VFbnp5bWUpIHsKICAgICAgICAgICAgICAgIGNlID0gYXR0cnMuY2xlYXZhZ2VFbnp5bWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGNlICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIHNlbGYucF9yZWJ1aWxkUGVwdGlkZUluZGV4KGNlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gQmFja2JvbmUuTW9kZWwucHJvdG90eXBlLnNldC5jYWxsKHNlbGYsIGF0dHJzLCBvcHRpb25zKTsKICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiByZWJ1aWxkIHRoZSBpbmRleCBwZXB0aWRlIC0+IHNlcXVlbmNlICsgcG9zaXRpb25zCiAgICAgICAgICogQHBhcmFtIHtDbGVhdmFnZUVuenltZX0gb3B0aW9uYWwgcGFyYW1zIChkZWZhdWx0IGlzIHRoZSBjbGVhdmFnZUVuenltZSBwcm9wZXJ0eSkuIFdlIGNhbiBwYXNzIGl0IGluIGNhc2UgdGhlIGVuenltZSBwcm8gaGFzIG5vdCBiZWUgc2V0IHlldCAoc2V0dGVyIG92ZXJpZGluZykKICAgICAgICAgKi8KICAgICAgICBwX3JlYnVpbGRQZXB0aWRlSW5kZXg6IGZ1bmN0aW9uIChjZSkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHZhciBwaW5kZXggPSB7fTsKCiAgICAgICAgICAgIGNlID0gY2UgfHwgc2VsZi5nZXQoJ2NsZWF2YWdlRW56eW1lJyk7CiAgICAgICAgICAgIGlmIChjZSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIG4gPSAwOwogICAgICAgICAgICBfLmVhY2goZGljb1NlcS5tb2RlbHMsIGZ1bmN0aW9uIChhYVNlcSkgewogICAgICAgICAgICAgICAgdmFyIHBvcyA9IDA7CiAgICAgICAgICAgICAgICBfLmVhY2goY2UuY2xlYXZlKGFhU2VxLmdldCgnc2VxdWVuY2UnKSksIGZ1bmN0aW9uIChwZXB0KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHBsaXN0ID0gcGluZGV4W3BlcHRdOwogICAgICAgICAgICAgICAgICAgIGlmICghcGxpc3QpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcGluZGV4W3BlcHRdID0gW107CiAgICAgICAgICAgICAgICAgICAgICAgIHBsaXN0ID0gcGluZGV4W3BlcHRdCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHBsaXN0LnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICBhYVNlcTogYWFTZXEsCiAgICAgICAgICAgICAgICAgICAgICAgIG9mZnNldDogcG9zCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICBwb3MgKz0gcGVwdC5sZW5ndGg7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgbisrCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBzZWxmLnNldCgncGVwdGlkZUluZGV4JywgcGluZGV4KTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogdGFuc2Zvcm0KICAgICAgICAgKiBIMy5bMSwxVCwyXSAtPiBIMy4xCiAgICAgICAgICogSDMuMSAtPiBIMy4xCiAgICAgICAgICovCiAgICAgICAgcHRyVHJpbTogZnVuY3Rpb24gKHB0cikgewoKICAgICAgICAgICAgaWYgKG0gPSAvKC4rKVxbKC4rPyksLio/XSguKikvLmV4ZWMocHRyKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIG1bMV0gKyBtWzJdICsgbVszXQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBwdHI7CiAgICAgICAgfSwKICAgICAgICAvKioKICAgICAgICAgKiBmcm9tIHRoZSBzZXF1ZW5jZSBwb2ludGVyLCBleHRyYWN0IHRoZSBsaXN0IG9mIHByb3RlaW5zIG1hdGNoaW5nCiAgICAgICAgICogSDNLNCA9PiBhbGwgdGhlIHByb3Qgc3RhdGluZyB3aXRoIGEgbmFtZSBIMwogICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBwdHIKICAgICAgICAgKi8KICAgICAgICBwdHIyQUFTZXF1ZW5jZXM6IGZ1bmN0aW9uIChwdHIpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICB2YXIgc2VxUHRyID0gc2VsZi5wX3B0cjJzZXFBbmRQZXB0QW5jaG9yKHNlbGYucHRyVHJpbShwdHIpKS5zZXFQdHI7CgogICAgICAgICAgICBpZiAoZGljb1NlcS5nZXQoc2VxUHRyKSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gW2RpY29TZXEuZ2V0KHNlcVB0cildOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgbCA9IF8uZmlsdGVyKGRpY29TZXEubW9kZWxzLCBmdW5jdGlvbiAoYWFzZXEpIHsKICAgICAgICAgICAgICAgIHJldHVybiBhYXNlcS5nZXQoJ25hbWUnKS5pbmRleE9mKHNlcVB0cikgPT0gMAogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGlmIChsLmxlbmd0aCA9PSAwKSB7CiAgICAgICAgICAgICAgICB0aHJvdyB7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogJ0lsbGVnYWxzZXF1ZW5jZVB0ckV4Y2VwdGlvbicsCiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJ2Nhbm5vdCBmaW5kIG1hdGNoaW5nIEFBU2VxdWVuY2UgWycgKyBwdHIgKyAnXS9bJyArIHNlcVB0ciArICddJwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGw7CiAgICAgICAgfSwKICAgICAgICAvKioKICAgICAgICAgKiBmcm9tIHRoZSBzZXF1ZW5jZSBwb2ludGVyLCByZXR1cm4gb25lIG1hcCBmb3IgdGhlIHBlcHRpZGU6IHtzZXF1ZW5jZTogLi4uICwgb2Zmc2V0Oi4uLn0KICAgICAgICAgKiBJdCB3aWxsIHRoZSBiZSBwYXNzZWQgdG8gUmljaFNlcXVlbmNlU2hvcnRjdXRlciBmb3IgdGhlIGFjdHVhbFJpY2hTZXF1ZW5jZSBjcmVhdGlvbgogICAgICAgICAqCiAgICAgICAgICogSWYgdGhlIGFuc3dlciBpcyBhbWJpZ3VvdXMsIGFuIGV4Y3BldGlvbkhhbmRsZXIucmFpc2UoZXhjcGV0aW9uKSBpcyByYWlzZWQKICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBwdHIKICAgICAgICAgKi8KICAgICAgICBwdHIycGVwdGlkZTogZnVuY3Rpb24gKHB0cikgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHZhciBsU2VxdWVuY2VzID0gc2VsZi5wdHIyQUFTZXF1ZW5jZXMocHRyKTsKCiAgICAgICAgICAgIHZhciBhYXB0ciA9IHNlbGYucF9wdHIyc2VxQW5kUGVwdEFuY2hvcihwdHIpLmFhUHRyOwogICAgICAgICAgICB2YXIgbSA9IGFhcHRyLm1hdGNoKC8oW0EtWl0pKFxkKykvKQogICAgICAgICAgICB2YXIgYW5jaG9yQUEgPSBtWzFdOwogICAgICAgICAgICB2YXIgYW5jaG9yUG9zID0gcGFyc2VJbnQobVsyXSk7CgogICAgICAgICAgICB2YXIgbHBlcHQgPSBfLmNoYWluKGxTZXF1ZW5jZXMpLmNvbGxlY3QoZnVuY3Rpb24gKGFhU2VxKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5wX2NsZWF2ZWRQZXB0aWRlQXQoYWFTZXEsIGFuY2hvclBvcyk7CiAgICAgICAgICAgIH0pLnVuaXEoKS5ncm91cEJ5KGZ1bmN0aW9uIChwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcC5zZXF1ZW5jZSArICd8JyArIHAub2Zmc2V0CiAgICAgICAgICAgIH0pLnZhbHVlcygpLmNvbGxlY3QoZnVuY3Rpb24gKGwpIHsKICAgICAgICAgICAgICAgIHJldHVybiBsWzBdCiAgICAgICAgICAgIH0pLnZhbHVlKCk7CgogICAgICAgICAgICBpZiAobHBlcHQubGVuZ3RoID4gMSkgewogICAgICAgICAgICAgICAgdGhyb3cgewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICdBbWJpZ3VvdXNQdHJFeGNlcHRpb24nLAogICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdwb2ludGVyICcgKyBwdHIgKyAnIHBvaW50cyB0byBtdWx0aXBsZSBwZXB0aWRlczogJyArIF8uY29sbGVjdChscGVwdCwgZnVuY3Rpb24gKHApIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHAuc2VxdWVuY2UgKyAnQCcgKyBwLm9mZnNldAogICAgICAgICAgICAgICAgICAgIH0pLmpvaW4oJywgJykgKyAiLlxuQ2hvb3NlIGEgbGVzcyBhbWJpZ3VvdXMgcHJvdGVpbiBuYW1lIGFtb25nOiAiICsgXy5jb2xsZWN0KGxTZXF1ZW5jZXMsIGZ1bmN0aW9uIChhYVNlcSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYWFTZXEuZ2V0KCduYW1lJyk7CiAgICAgICAgICAgICAgICAgICAgfSkuam9pbignLCAnKQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgcmV0ID0gbHBlcHRbMF07CgogICAgICAgICAgICBpZiAocmV0LnNlcXVlbmNlLmNoYXJBdChhbmNob3JQb3MgLSByZXQub2Zmc2V0KSAhPSBhbmNob3JBQSkgewogICAgICAgICAgICAgICAgdGhyb3cgewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICdJbnZhbGlkUHRyRXhjZXB0aW9uJywKICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAncG9pbnRlciAnICsgcHRyICsgJyBkb2VzIG5vdCBwb2ludCB0byBhbWlub2FjaWQ6ICcgKyBhbmNob3JBQSArICcgYXQgcG9zaXRpb24gJyArIGFuY2hvclBvcyArICcgKGluIGZhY3Q6JyArIHJldC5zZXF1ZW5jZS5jaGFyQXQoYW5jaG9yUG9zIC0gcmV0Lm9mZnNldCkgKyAnKScKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiByZXQKCiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogZnJvbSBhIGxpc3Qgb2YgQUFTZXF1ZW5jZSBvciBuYW1lcywgYnVpbGQgYSBzaG9ydCBjb25jYXRlbmF0aW9uIG9uIHRoZW0KICAgICAgICAgKi8KICAgICAgICBjb25jYXRlbmF0ZU5hbWVzOiBmdW5jdGlvbiAobHNlcSkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHZhciBsTmFtZXMgPSBfLmNvbGxlY3QobHNlcSwgZnVuY3Rpb24gKG4pIHsKICAgICAgICAgICAgICAgIGlmIChfLmlzU3RyaW5nKG4pKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG4KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBuLmdldCgnbmFtZScpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgbE5hbWVzID0gbE5hbWVzLnNvcnQoKTsKCiAgICAgICAgICAgIGlmIChsTmFtZXMubGVuZ3RoIDw9IDEpIHsKICAgICAgICAgICAgICAgIHJldHVybiBsTmFtZXNbMF07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBpQ29tbW9uID0gMTsKICAgICAgICAgICAgd2hpbGUgKGlDb21tb24gPD0gbE5hbWVzWzBdLmxlbmd0aCkgewogICAgICAgICAgICAgICAgdmFyIHByZWYgPSBsTmFtZXNbMF0uc3Vic3RyKDAsIGlDb21tb24pOwoKICAgICAgICAgICAgICAgIGlmIChfLmFueShsTmFtZXMsIGZ1bmN0aW9uIChuKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG4uc3Vic3RyKDAsIGlDb21tb24pICE9IHByZWY7CiAgICAgICAgICAgICAgICB9KSkgewoKICAgICAgICAgICAgICAgICAgICBpQ29tbW9uLS07CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpQ29tbW9uKysKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgY29tbW9uID0gbE5hbWVzWzBdLnN1YnN0cigwLCBpQ29tbW9uKTsKCiAgICAgICAgICAgIHZhciBhbGxOYW1lczRjb21tb24gPSBfLmNoYWluKGRpY29TZXEubW9kZWxzKS5jb2xsZWN0KGZ1bmN0aW9uIChhYXNlcSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGFhc2VxLmdldCgnbmFtZScpCiAgICAgICAgICAgIH0pLmZpbHRlcihmdW5jdGlvbiAobikgewogICAgICAgICAgICAgICAgcmV0dXJuIG4uaW5kZXhPZihjb21tb24pID09IDAKICAgICAgICAgICAgfSkudmFsdWUoKS5zb3J0KCkKICAgICAgICAgICAgaWYgKGFsbE5hbWVzNGNvbW1vbi5sZW5ndGggPT0gbE5hbWVzLmxlbmd0aCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYucF9zaG9ydGVuTmFtZShjb21tb24pCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGNvbW1vbiArIGxOYW1lc1swXS5zdWJzdHIoaUNvbW1vbik7CgogICAgICAgICAgICAvLyByZXR1cm4gY29tbW9uICsgJ1snICsgXy5jb2xsZWN0KGxOYW1lcywgZnVuY3Rpb24obikgewogICAgICAgICAgICAvLyByZXR1cm4gbi5zdWJzdHIoaUNvbW1vbik7CiAgICAgICAgICAgIC8vIH0pLmpvaW4oJywnKSArICddJwogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIGZyb20gYSBzZXF1ZW5jZSwgcmV0dXJuIHRoZSBjbGVhdmVkIHBlcHRpZGUgY29udGFpbmVpbmcgcG9zaXRpb24gcG9zCiAgICAgICAgICogQHBhcmFtIHtBQVNlcXVlbmNlfSBhYVNlcQogICAgICAgICAqIEBwYXJhbSB7aW50fSBwb3MKICAgICAgICAgKi8KICAgICAgICBwX2NsZWF2ZWRQZXB0aWRlQXQ6IGZ1bmN0aW9uIChhYVNlcSwgcG9zKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgaWYgKHBvcyA+PSBhYVNlcS5zaXplKCkpIHsKICAgICAgICAgICAgICAgIHRocm93IHsKICAgICAgICAgICAgICAgICAgICBuYW1lOiAnSWxsZWdhbFBvc2l0aW9uT25TZXF1ZW5jZScsCiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJ3Bvc2l0aW9uICcgKyBwb3MgKyAnIGV4Y2VlZCBzaXplICcgKyBhYVNlcS5zaXplKCkgKyAnIGZvciBzZXEgJyArIGdldC5nZXQoJ25hbWUnKQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBwID0gMDsKCiAgICAgICAgICAgIHZhciByZWdleHAgPSBzZWxmLmdldCgnY2xlYXZhZ2VFbnp5bWUnKS5nZXQoJ3J1bGUnKTsKICAgICAgICAgICAgcmVnZXhwLmxhc3RJbmRleCA9IDA7CiAgICAgICAgICAgIHdoaWxlIChtID0gcmVnZXhwLmV4ZWMoYWFTZXEuZ2V0KCdzZXF1ZW5jZScpKSkgewogICAgICAgICAgICAgICAgdmFyIHBlcHQgPSBtWzBdCiAgICAgICAgICAgICAgICBwICs9IHBlcHQubGVuZ3RoOwogICAgICAgICAgICAgICAgaWYgKHAgPiBwb3MpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICBzZXF1ZW5jZTogcGVwdCwKICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0OiBwIC0gcGVwdC5sZW5ndGgKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG51bGwKICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqIGZyb20gSDJBSzI3QWNLMzZNZSAtPiB7c2VxUHRyOidIMkEnLCBhYVB0cjonSzI3J30KICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gcHRyCiAgICAgICAgICovCiAgICAgICAgcF9wdHIyc2VxQW5kUGVwdEFuY2hvcjogZnVuY3Rpb24gKHB0cikgewogICAgICAgICAgICB2YXIgcmUgPSAvXlxzKihbQS1aXSsuKj8pKFtBLVpdXGQrKS87CiAgICAgICAgICAgIHZhciBtID0gcHRyLm1hdGNoKHJlKTsKICAgICAgICAgICAgaWYgKCFtKSB7CiAgICAgICAgICAgICAgICB0aHJvdyB7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogJ0lsbGVnYWxzZXF1ZW5jZVB0ckV4Y2VwdGlvbicsCiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJyBjYW5ub3QgZXh0cmFjdCBzZXF1ZW5jZSBuYW1lIGhlYWQgIC8gQUEgcG9zIGZyb20gWycgKyBwdHIgKyAnXSB3aXRoICcgKyByZQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBzZXFQdHI6IG1bMV0sCiAgICAgICAgICAgICAgICBhYVB0cjogbVsyXQogICAgICAgICAgICB9CgogICAgICAgIH0sCiAgICAgICAgLy8gY2hlY2sgaWYgaGF2ZSB0aGVtIGFsbCBzdGF0aW5nIHdpdGggY29tbW9uIChpbiB0aGlzIGNhc2UsIHdlIGNhbiByZXR1cm4gb25seSB0aGUgY29tbW9uIHBhcnQpCiAgICAgICAgcF9zaG9ydGVuTmFtZTogZnVuY3Rpb24gKG5hbWUpIHsKICAgICAgICAgICAgdmFyIGFsbE5hbWVzID0gXy5jb2xsZWN0KGRpY29TZXEubW9kZWxzLCBmdW5jdGlvbiAoYWFzZXEpIHsKICAgICAgICAgICAgICAgIHJldHVybiBhYXNlcS5nZXQoJ25hbWUnKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgdmFyIGN1ck5hbWUgPSBuYW1lOwogICAgICAgICAgICB2YXIgaSA9IG5hbWUubGVuZ3RoIC0gMTsKICAgICAgICAgICAgd2hpbGUgKGkgPiAwKSB7CiAgICAgICAgICAgICAgICB2YXIgdHJ1bmNhdGVkID0gbmFtZS5zdWJzdHIoMCwgaSk7CiAgICAgICAgICAgICAgICBpZiAoXy5hbnkoYWxsTmFtZXMsIGZ1bmN0aW9uIChuKSB7CgogICAgICAgICAgICAgICAgICAgIHZhciBva0Z1bGwgPSBuLnN1YnN0cigwLCBuYW1lLmxlbmd0aCkgPT0gbmFtZTsKICAgICAgICAgICAgICAgICAgICB2YXIgb2tUcnVuYyA9IG4uc3Vic3RyKDAsIHRydW5jYXRlZC5sZW5ndGgpID09IHRydW5jYXRlZDsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gKCFva0Z1bGwgJiYgb2tUcnVuYykgfHwgKG9rRnVsbCAmJiAhb2tUcnVuYyk7CiAgICAgICAgICAgICAgICB9KSkgewogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaS0tOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBuYW1lLnN1YnN0cigwLCBpICsgMSkKICAgICAgICB9LAoKICAgICAgICB0b1N0cmluZzogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHJldHVybiBzZWxmLmdldCgnY2xlYXZhZ2VFbnp5bWUnKSArICcgIyBwZXB0aWRlczogJyArIF8uc2l6ZShzZWxmLmdldCgncGVwdGlkZUluZGV4JykpOwogICAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIEFBU2VxdWVuY2VQZXB0aWRlUHRyOwp9KTsKCi8qCiAqIEJ1aWxkcyBhbmQgdW5idWlsZHMgcGVwdGlkZSBzZXF1ZW5jZSBhdGxhcyBjb21wb3NpbmcKICogSW1wbGljaXRNb2RpZmllciBmb3IgbGFiZWxzCiAqIEFBU2VxdWVuY2VQZXB0aWRlUHRyIHRvIHBvaW50IGEgdHJ5cHRpYyBwZXB0aWRlIHRvIGFuIHVuYW1iaWd1b3VzIHByb3RlaW4gc2VxdWVuY2UgYW4gcG9zaXRpb24KICogdHJhbnNmb3JtIGNvbW1vbiBtb2RpZGlmaWNhdGlvbnMgaW50byBhIHNob3J0Y3V0IEFDRHtQaG9zcGhvfUVGe0RpbWV0aHlsfUcgLT4gQUNEUG9FRk1lMkcKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCmRlZmluZSgnZmlzaHRvbmVzL3NlcnZpY2VzL2RyeS9SaWNoU2VxdWVuY2VTaG9ydGN1dGVyJyxbJ2pxdWVyeScsICd1bmRlcnNjb3JlJywgJ0JhY2tib25lJywgJ2Zpc2h0b25lcy9tb2RlbHMvZHJ5L1JpY2hTZXF1ZW5jZScsICdmaXNodG9uZXMvbW9kZWxzL2RyeS9BQVNlcXVlbmNlUGVwdGlkZVB0cicsICdmaXNodG9uZXMvY29sbGVjdGlvbnMvZHJ5L0FtaW5vQWNpZERpY3Rpb25hcnknLCAnZmlzaHRvbmVzL2NvbGxlY3Rpb25zL2RyeS9SZXNpZHVlTW9kaWZpY2F0aW9uRGljdGlvbmFyeScsICdmaXNodG9uZXMvc2VydmljZXMvZHJ5L0ltcGxpY2l0TW9kaWZpZXInXSwgZnVuY3Rpb24oJCwgXywgQmFja2JvbmUsIFJpY2hTZXF1ZW5jZSwgQUFTZXF1ZW5jZVBlcHRpZGVQdHIsIGRpY29BQSwgZGljb1Jlc01vZCwgaW1wbGljaXRNb2RpZmllcikgewoKICAgIHZhciBSaWNoU2VxdWVuY2VTaG9ydGN1dGVyID0gQmFja2JvbmUuTW9kZWwuZXh0ZW5kKHsKICAgICAgICBkZWZhdWx0cyA6IHsKICAgICAgICAgICAgbW9kaWYyc2hvcnQgOiB7CiAgICAgICAgICAgICAgICAvLyAnTGFiZWw6MTNDKDYpMTVOKDIpJzonU2lsYWNrJywKICAgICAgICAgICAgICAgIC8vICdMYWJlbDoxM0MoNikxNU4oNCknOidTaWxhY3InLAogICAgICAgICAgICAgICAgUHJvcGlvbnlsIDogIlByb3AiLAogICAgICAgICAgICAgICAgJ1Byb3Bpb255bDoySCg1KScgOiAnUHJvcGQ1JywKICAgICAgICAgICAgICAgIE1ldGh5bCA6IFsnTWUnLCAnTWUxJ10sCiAgICAgICAgICAgICAgICBEaW1ldGh5bCA6ICdNZTInLAogICAgICAgICAgICAgICAgVHJpbWV0aHlsIDogJ01lMycsCiAgICAgICAgICAgICAgICBBY2V0eWwgOiAnQWMnLAogICAgICAgICAgICAgICAgUGhvc3BobyA6ICdQbycsCiAgICAgICAgICAgICAgICBHbHlHbHkgOiAnVWInCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHJlUmV2ZXJzZSA6IC8oW0EtWl0pKCg/OltBLVpdW2EtejAtOV0rKSopL2csCiAgICAgICAgICAgIHJlUmV2U3BsaXRNb2RpZiA6IC8oPzpbQS1aXVthLXowLTldKykvZwoKICAgICAgICB9LAogICAgICAgIGluaXRpYWxpemUgOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge2NsZWF2YWdlRW56eW1lOiAnYXJnLWMnfTsKICAgICAgICAgICAgc2VsZi5zZXQoJ2FhU2VxdWVuY2VQZXB0aWRlUHRyJywgbmV3IEFBU2VxdWVuY2VQZXB0aWRlUHRyKCkpOwogICAgICAgICAgICBzZWxmLmdldCgnYWFTZXF1ZW5jZVBlcHRpZGVQdHInKS5zZXQoJ2NsZWF2YWdlRW56eW1lJywgb3B0aW9ucy5jbGVhdmFnZUVuenltZSk7CiAgICAgICAgfSwKICAgICAgICBzZXQgOiBmdW5jdGlvbihhdHRycywgb3B0aW9ucykgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIGlmIChhdHRycy5tb2RpZjJzaG9ydCkgewogICAgICAgICAgICAgICAgc2VsZi5wX2luaXRfc2hvcnQybW9kaWYoYXR0cnMubW9kaWYyc2hvcnQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBCYWNrYm9uZS5Nb2RlbC5wcm90b3R5cGUuc2V0LmNhbGwodGhpcywgYXR0cnMsIG9wdGlvbnMpOwogICAgICAgIH0sCgogICAgICAgIC8vIHRoaXMuc2hvcnQybW9kaWYgPSBudWxsOwogICAgICAgIC8vIHRoaXMucF9pbml0X3Nob3J0Mm1vZGlmID0gcF9pbml0X3Nob3J0Mm1vZGlmOwogICAgICAgIHNob3J0Mm1vZGlmIDogZnVuY3Rpb24obW9kaWZTaG9yY3R1dCkgewogICAgICAgICAgICB2YXIgcm0gPSB0aGlzLmdldCgnc2hvcnQybW9kaWYnKVttb2RpZlNob3JjdHV0XTsKICAgICAgICAgICAgaWYgKCFybSkgewogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignVW5rbm93blNob3J0TW9kaWZOYW1lJywgbW9kaWZTaG9yY3R1dCwgdGhpcy5nZXQoJ3Nob3J0Mm1vZGlmJykpCiAgICAgICAgICAgICAgICB0aHJvdyB7CiAgICAgICAgICAgICAgICAgICAgbmFtZSA6ICdVbmtub3duU2hvcnRNb2RpZk5hbWUnLAogICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UgOiBtb2RpZlNob3JjdHV0CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJtOwogICAgICAgIH0sCiAgICAgICAgLyoqCiAgICAgICAgICogZnJvbSBvbmUgb2RpZiwgcmV0dXJuIHRoZSBzaG9ydCBmb3JtIG9mIGl0LgogICAgICAgICAqIFRoZSBvbmx5IHRyaWNrIGlzIHRoYXQgb25lIG1vZGlmIGNhbiBoYXZlIHNldmVyYWwgc2hvcnQgZm9ybXMgKE1ldGh5bCAtPiBNZSBhbmQgTWUxKQogICAgICAgICAqIGFuZCB3ZSBwaWNrIHRoZSBmaXJzdCBpbiB0aGUgbGlzdAogICAgICAgICAqLwogICAgICAgIG1vZGlmMnNob3J0IDogZnVuY3Rpb24ocmVzbW9kKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIHNob3J0ID0gc2VsZi5nZXQoJ21vZGlmMnNob3J0JylbcmVzbW9kLmdldCgnbmFtZScpXTsKICAgICAgICAgICAgaWYgKCFzaG9ydCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHJlc21vZC5nZXQoJ25hbWUnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gKCBzaG9ydCBpbnN0YW5jZW9mIEFycmF5KSA/IHNob3J0WzBdIDogc2hvcnQ7CiAgICAgICAgfSwKCiAgICAgICAgLyoKICAgICAgICAgKiBjb25zdHJ1Y3QgYSBtYXAgZnJvbSBzaG9ydCBuYW1lIHRvIG1vZGlmIG9iamVjdC4gSW4gY2FzZSAyIHNob3J0Y3V0IHBvaW50CiAgICAgICAgICogdG8gdGhlIHNhbWUgbW9kaWYsIHdlIHRha2UgdGhlIG9uZSB3aXRoIHRoZSBzaG9ydGVzdCBuYW1lCiAgICAgICAgICovCiAgICAgICAgcF9pbml0X3Nob3J0Mm1vZGlmIDogZnVuY3Rpb24obmV3VmFsKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIHRtcF9zaG9ydDJtb2RpZiA9IHt9OwogICAgICAgICAgICB2YXIgdG1wX21vZGlmMnNob3J0ID0gbmV3VmFsIHx8IHNlbGYuZ2V0KCdtb2RpZjJzaG9ydCcpOwogICAgICAgICAgICBmb3IgKG1vZCBpbiB0bXBfbW9kaWYyc2hvcnQpIHsKICAgICAgICAgICAgICAgIHZhciB2YWxzID0gdG1wX21vZGlmMnNob3J0W21vZF0KICAgICAgICAgICAgICAgIHZhciBsc2hvcnRzID0gKCB2YWxzIGluc3RhbmNlb2YgQXJyYXkpID8gdmFscyA6IFt2YWxzXTsKICAgICAgICAgICAgICAgIF8uZWFjaChsc2hvcnRzLCBmdW5jdGlvbihzaG9ydCkgewogICAgICAgICAgICAgICAgICAgIGlmICh0bXBfc2hvcnQybW9kaWZbc2hvcnRdICYmIHRtcF9zaG9ydDJtb2RpZltzaG9ydF0uZ2V0KCduYW1lJykubGVuZ3RoIDwgbW9kLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHRtcF9zaG9ydDJtb2RpZltzaG9ydF0gPSBkaWNvUmVzTW9kLmdldChtb2QpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfQogICAgICAgICAgICBzZWxmLnNldCgnc2hvcnQybW9kaWYnLCB0bXBfc2hvcnQybW9kaWYpOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiBleHRyYWN0IGxhYmVsIGF0IHRoZSBlbmQgYmV0ZXd3ZW4gY3VybHkgYnJhY2tldCBpZiBhbnkKICAgICAgICAgKiByZXR1cm4gYW4gYXJyYXkgd2l0aCB0d28gZWxlbWVudAogICAgICAgICAqIFswXTogcGVwdGlkZSBzdHJpbmcgd2l0aG91dCBhbnkgdHJlYXRtZW50CiAgICAgICAgICogWzFdOiBhbiBhcnJheSwgbWF5YmUgZW1wdHkgd2l0aCB0aGUgbGFiZWxzIGluIGFuIGFscGhhbnVtZXJpY2FsIG9yZGVyCiAgICAgICAgICovCiAgICAgICAgc3RyaW5nMnBlcHRpZGVBbmRMYWJlbHMgOiBmdW5jdGlvbihzdHIpIHsKICAgICAgICAgICAgdmFyIHJlID0gLyguKylcWyguKilcXVxzKiQvOwogICAgICAgICAgICB2YXIgbSA9IHJlLmV4ZWMoc3RyKTsKICAgICAgICAgICAgaWYgKCFtKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gW3N0ci50cmltKCksIFtdXQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBbbVsxXS50cmltKCksIG1bMl0udHJpbSgpLnNwbGl0KCcsJykuc29ydCgpXQoKICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiBmcm9tIGEgbWluaWZpZWQgc3RyaW5nLCBidWlsZCBhIGZ1bGwgUmljaFNlcXVlbmNlIHBiamVjdAogICAgICAgICAqLwogICAgICAgIHJpY2hTZXFGcm9tU3RyaW5nIDogZnVuY3Rpb24oc3RyKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgICAgICAgIHZhciB0ID0gc2VsZi5zdHJpbmcycGVwdGlkZUFuZExhYmVscyhzdHIpCiAgICAgICAgICAgIHN0ciA9IHRbMF0KICAgICAgICAgICAgdmFyIG1vZGlmTGFiZWxzID0gdFsxXTsKCiAgICAgICAgICAgIHZhciByczsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHJzID0gbmV3IFJpY2hTZXF1ZW5jZSgpLmZyb21TdHJpbmcoc3RyKQogICAgICAgICAgICB9IGNhdGNoKGUpIHsKICAgICAgICAgICAgICAgIHZhciB0bXBfc2VxID0gW10KICAgICAgICAgICAgICAgIHZhciB0bXBfcmVSZXZTcGxpdE1vZGlmID0gc2VsZi5nZXQoJ3JlUmV2U3BsaXRNb2RpZicpOwogICAgICAgICAgICAgICAgdmFyIG1hdGNoZXMgPSBuZXcgUmVnRXhwRnVsbFNwbGl0ZXIoKS5zcGxpdChzZWxmLmdldCgncmVSZXZlcnNlJyksIHN0ci50cmltKCkpCgogICAgICAgICAgICAgICAgXy5lYWNoKG1hdGNoZXMsIGZ1bmN0aW9uKG0pIHsKICAgICAgICAgICAgICAgICAgICB2YXIgcmFhID0gewogICAgICAgICAgICAgICAgICAgICAgICBhYSA6IGRpY29BQS5nZXQobVsxXSkKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIHZhciBtb2RpZlN0ciA9IG1bMl07CiAgICAgICAgICAgICAgICAgICAgaWYgKG1vZGlmU3RyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJhYS5tb2RpZmljYXRpb25zID0gW107CiAgICAgICAgICAgICAgICAgICAgICAgIF8uZWFjaChtb2RpZlN0ci5tYXRjaCh0bXBfcmVSZXZTcGxpdE1vZGlmKSwgZnVuY3Rpb24obSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmFhLm1vZGlmaWNhdGlvbnMucHVzaChzZWxmLnNob3J0Mm1vZGlmKG0pIHx8IGRpY29SZXNNb2QuZ2V0KG0pKQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdG1wX3NlcS5wdXNoKHJhYSk7CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBycyA9IG5ldyBSaWNoU2VxdWVuY2UoewogICAgICAgICAgICAgICAgICAgIHNlcXVlbmNlIDogdG1wX3NlcQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaW1wbGljaXRNb2RpZmllci5sYWJlbChtb2RpZkxhYmVscywgcnMpCiAgICAgICAgICAgIHJldHVybiByczsKCiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogVGhlIGludmVyc2Ugb2YgcmljaFNlcUZyb21TdHJpbmcKICAgICAgICAgKi8KICAgICAgICByaWNoU2VxVG9TdHJpbmcgOiBmdW5jdGlvbihyaWNoU2VxKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIHMgPSAnJzsKCiAgICAgICAgICAgIHJpY2hTZXEgPSByaWNoU2VxLmNsb25lKCkKICAgICAgICAgICAgdmFyIGxhYmVscyA9IGltcGxpY2l0TW9kaWZpZXIuZ2V0TGFiZWxzQW5kQ2xlYW4ocmljaFNlcSkKCiAgICAgICAgICAgIHZhciB0bXBfc2VxID0gcmljaFNlcS5nZXQoJ3NlcXVlbmNlJyk7CiAgICAgICAgICAgIHZhciB0bXBfbW9kaWYyc2hvcnQgPSBzZWxmLmdldCgnbW9kaWYyc2hvcnQnKTsKCiAgICAgICAgICAgIGZvciAoIGkgPSAwOyBpIDwgdG1wX3NlcS5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgcyArPSB0bXBfc2VxW2ldLmFhLmdldCgnY29kZTEnKTsKICAgICAgICAgICAgICAgIGlmICh0bXBfc2VxW2ldLm1vZGlmaWNhdGlvbnMpIHsKCiAgICAgICAgICAgICAgICAgICAgcyArPSBfLmNvbGxlY3QodG1wX3NlcVtpXS5tb2RpZmljYXRpb25zLCBmdW5jdGlvbihtKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtbmFtZSA9IHNlbGYubW9kaWYyc2hvcnQobSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtbmFtZSA9PSBtLmdldCgnbmFtZScpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKCd7JyArIG1uYW1lICsgJ30nKQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1uYW1lCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgLy9yZXR1cm4gKHRtcF9tb2RpZjJzaG9ydFttLmdldCgnbmFtZScpXSAhPSB1bmRlZmluZWQpID8gdG1wX21vZGlmMnNob3J0W20uZ2V0KCduYW1lJyldIDogKCd7JyArIG0ubmFtZSArICd9JykKICAgICAgICAgICAgICAgICAgICB9KS5qb2luKCcnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAobGFiZWxzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIHMgKz0gJyBbJyArIGxhYmVscy5qb2luKCcsJykgKyAnXSc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHM7CiAgICAgICAgfSwKICAgICAgICAvKioKICAgICAgICAgKiAnSDMuMUs5TWUnLCAnSDNLNCcsICdIMy5DSzlNZUFjJywgJ0gzSzlNZUsxNEFDJywgICdIMy5DSzlNZUFjIFtwcm9wX2QxMF0nLCByZXR1cm4gdGhlIG1vZGlmaWVkIGZ1bGwgUmljaFNlcQogICAgICAgICAqCiAgICAgICAgICovCiAgICAgICAgcmljaFNlcUZyb21TZXF1ZW5jZVB0ciA6IGZ1bmN0aW9uKHB0cikgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICAgICAgICB2YXIgdCA9IHNlbGYuc3RyaW5nMnBlcHRpZGVBbmRMYWJlbHMocHRyKQogICAgICAgICAgICBwdHIgPSB0WzBdCiAgICAgICAgICAgIHZhciBtb2RpZkxhYmVscyA9IHRbMV07CgogICAgICAgICAgICB2YXIgcGVwdCA9IHNlbGYuZ2V0KCdhYVNlcXVlbmNlUGVwdGlkZVB0cicpLnB0cjJwZXB0aWRlKHB0cik7CgogICAgICAgICAgICBpZiAocGVwdCA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgYWEgPSBwZXB0LnNlcXVlbmNlLnNwbGl0KCcnKTsKICAgICAgICAgICAgdmFyIHJlID0gLyhbQS1aXSkoXGQrKSgoPzpbQS1aXVthLXpdW2EtejAtOV0qKSopL2c7CgogICAgICAgICAgICB3aGlsZSAoIG0gPSByZS5leGVjKHB0cikpIHsKICAgICAgICAgICAgICAgIHZhciBpID0gcGFyc2VJbnQobVsyXSkgLSBwZXB0Lm9mZnNldAogICAgICAgICAgICAgICAgYWFbaV0gKz0gbVszXQogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBzZXFwcCA9IGFhLmpvaW4oJycpCgogICAgICAgICAgICB2YXIgcmljaFNlcSA9IHNlbGYucmljaFNlcUZyb21TdHJpbmcoc2VxcHApCiAgICAgICAgICAgIGltcGxpY2l0TW9kaWZpZXIubGFiZWwobW9kaWZMYWJlbHMsIHJpY2hTZXEpCiAgICAgICAgICAgIHJldHVybiByaWNoU2VxOwoKICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiBXZWxsLCB0aGF0J3MgdGhlIHJldmVyc2Ugb2YgcmljaFNlcUZyb21TZXF1ZW5jZVB0ci4KICAgICAgICAgKiBmcm9tIGEgcmljaCBzZXF1ZW5jZSwgd2UgdHJ5IHRvIGZpbmQgdGhlIHNob3J0ZXN0IHBvc3NpYmxlIHB0cgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IHJpY2hTZXEKICAgICAgICAgKi8KICAgICAgICByaWNoU2VxVG9TZXF1ZW5jZVB0ciA6IGZ1bmN0aW9uKHJpY2hTZXFPcmlnKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgICAgICAgIHZhciByaWNoU2VxID0gcmljaFNlcU9yaWcuY2xvbmUoKQogICAgICAgICAgICB2YXIgbGFiZWxzID0gaW1wbGljaXRNb2RpZmllci5nZXRMYWJlbHNBbmRDbGVhbihyaWNoU2VxKQogICAgICAgICAgICBpZiAobGFiZWxzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIGxhYmVscyA9ICcgWycgKyBsYWJlbHMuam9pbignLCcpICsgJ10nOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbGFiZWxzID0gJycKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGFhc2VxID0gXy5jb2xsZWN0KHJpY2hTZXEuZ2V0KCdzZXF1ZW5jZScpLCBmdW5jdGlvbihyYWEpIHsKICAgICAgICAgICAgICAgIHJldHVybiByYWEuYWEuZ2V0KCdjb2RlMScpOwogICAgICAgICAgICB9KS5qb2luKCcnKTsKCiAgICAgICAgICAgIHZhciByZWdTZXFMaXN0ID0gc2VsZi5nZXQoJ2FhU2VxdWVuY2VQZXB0aWRlUHRyJykuZ2V0KCdwZXB0aWRlSW5kZXgnKVthYXNlcV07CgogICAgICAgICAgICBpZiAoIXJlZ1NlcUxpc3QpIHsKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLnJpY2hTZXFUb1N0cmluZyhyaWNoU2VxKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHNlcVB0ciA9IHNlbGYuZ2V0KCdhYVNlcXVlbmNlUGVwdGlkZVB0cicpLmNvbmNhdGVuYXRlTmFtZXMoXy5jb2xsZWN0KHJlZ1NlcUxpc3QsIGZ1bmN0aW9uKHBwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcHAuYWFTZXEuZ2V0KCduYW1lJykKICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgLy9jYXB1dHJlIHRoZSBzdGFydGluZyBwb3NpdGlvbi4gbXVzdCB0aGUgc2FtZSBmb3IgYWxsIHBlcHRpZGVzCiAgICAgICAgICAgIHZhciBvZmZzZXQgPSBfLmNoYWluKHJlZ1NlcUxpc3QpLmNvbGxlY3QoZnVuY3Rpb24ocHApIHsKICAgICAgICAgICAgICAgIHJldHVybiBwcC5vZmZzZXQKICAgICAgICAgICAgfSkudW5pcSgpLnZhbHVlKCk7CiAgICAgICAgICAgIGlmIChvZmZzZXQubGVuZ3RoID4gMSkgewogICAgICAgICAgICAgICAgLy93ZSBoYXZlIGRpZmZlcmVudCBzaXplcwogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYucmljaFNlcVRvU3RyaW5nKHJpY2hTZXEpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG9mZnNldCA9IG9mZnNldFswXQoKICAgICAgICAgICAgdmFyIG1pbmlTdHIgPSAnJzsKICAgICAgICAgICAgXy5lYWNoKHJpY2hTZXEuZ2V0KCdzZXF1ZW5jZScpLCBmdW5jdGlvbihyYWEsIGkpIHsKICAgICAgICAgICAgICAgIHZhciBtb2RzID0gXy5jaGFpbihyYWEubW9kaWZpY2F0aW9ucykuY29sbGVjdChmdW5jdGlvbihtKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYubW9kaWYyc2hvcnQobSk7CiAgICAgICAgICAgICAgICB9KS52YWx1ZSgpLmpvaW4oJycpOwogICAgICAgICAgICAgICAgaWYgKG1vZHMgIT09ICcnKSB7CiAgICAgICAgICAgICAgICAgICAgbWluaVN0ciArPSByYWEuYWEuZ2V0KCdjb2RlMScpICsgKGkgKyBvZmZzZXQpICsgbW9kcwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgaWYgKG1pbmlTdHIgPT09ICcnKSB7CiAgICAgICAgICAgICAgICAvL2ZpbmQgYXQgbGVhc3Qgb25lIGx5c2luZQogICAgICAgICAgICAgICAgdmFyIGlrID0gXy5jb2xsZWN0KHJpY2hTZXEuZ2V0KCdzZXF1ZW5jZScpLCBmdW5jdGlvbihyYWEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmFhLmFhLmdldCgnY29kZTEnKQogICAgICAgICAgICAgICAgfSkuam9pbignJykuaW5kZXhPZignSycpOwogICAgICAgICAgICAgICAgaWYgKGlrID49IDApIHsKICAgICAgICAgICAgICAgICAgICBtaW5pU3RyID0gJ0snICsgKGlrICsgb2Zmc2V0KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChtaW5pU3RyID09PSAnJykgewogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYucmljaFNlcVRvU3RyaW5nKHJpY2hTZXEpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvL2JhY2sgY2hlY2sgdGhhdCB0aGUgcmV2ZXJzZSBpcyBnaXZlIHRoZSBzYW1lCiAgICAgICAgICAgIG1pbmlTdHIgPSBzZXFQdHIgKyBtaW5pU3RyICsgbGFiZWxzOwogICAgICAgICAgICB2YXIgYmFja1BlcHQgPSBzZWxmLnJpY2hTZXFGcm9tU2VxdWVuY2VQdHIobWluaVN0ciwgdHJ1ZSk7CgogICAgICAgICAgICBpZiAoIWJhY2tQZXB0LmVxdWFsc1RvKHJpY2hTZXFPcmlnKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYucmljaFNlcVRvU3RyaW5nKHJpY2hTZXFPcmlnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbWluaVN0cgogICAgICAgIH0sCiAgICAgICAgLyoqCiAgICAgICAgICogV2lsbCB0cnkgdG8gYnVpbGQgdGhlIHNlcXVlbmNlIGZyb20gYSBzZXF1ZW5jZVB0ciBvciBhIGNsYXNzaWMgc2VxdWVuY2UKICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gc3RyCiAgICAgICAgICogQHBhcmFtIHtSaWNoU2VxdWVuY2V9IGlwUmljaFNlcSwgZm9yIGlucGxhY2UgcmVwbGFjZW1lbnQgaW5zdGVhZCBvZiBjcmVhdGluZyBhIG5ldyBvbmUuLi4KICAgICAgICAgKi8KICAgICAgICByaWNoU2VxRnJvbSA6IGZ1bmN0aW9uKHN0ciwgaXBSaWNoU2VxKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT0gMykgewogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignMyBwYXJhbWV0ZXJzLCBubyBnb29kISEnKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHN0ciA9IHN0ci5yZXBsYWNlKC9eXHdcLi8sICcnKTsKICAgICAgICAgICAgc3RyID0gc3RyLnJlcGxhY2UoL1wuXHckLywgJycpOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBSaWNoU2VxdWVuY2UoKS5mcm9tU3RyaW5nKHN0cik7CiAgICAgICAgICAgIH0gY2F0Y2goZXhjKSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLnJpY2hTZXFGcm9tU2VxdWVuY2VQdHIoc3RyKQogICAgICAgICAgICAgICAgfSBjYXRjaChleGMpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgcnMgPSBzZWxmLnJpY2hTZXFGcm9tU3RyaW5nKHN0cikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcnMKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqIFdpbGwgdHJ5IHRvIGJ1aWxkIHRoZSBzZXF1ZW5jZSBmcm9tIGEgc2VxdWVuY2VQdHIgb3IgYSBjbGFzc2ljIHNlcXVlbmNlCiAgICAgICAgICogY29tcGFyZWQgdG8gcmljaFNlcUZyb20sIGlucGxhY2UgcmVwbGFjZW1lbnQgb2YgaXBSaWNoU2VxLCBpbnN0ZWFkIG9mIHJlYXRpbmcgYSBuZXcgb25lLi4uCiAgICAgICAgICogQHBhcmFtIHtSaWNoU2VxdWVuY2V9IGlwUmljaFNlcSwKICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gc3RyCiAgICAgICAgICovCiAgICAgICAgcmljaFNlcVJlYWRGcm9tIDogZnVuY3Rpb24oaXBSaWNoU2VxLCBzdHIpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICB2YXIgcnMgPSBzZWxmLnJpY2hTZXFGcm9tKHN0cik7CgogICAgICAgICAgICAvL29rLCB3ZSBjYW4gZG8gYmV0dGVyLCBidSB0aGF0IHdpbGwgZmx5IGZvciB0aGUgbW9tZW50CiAgICAgICAgICAgIGlwUmljaFNlcS5mcm9tU3RyaW5nKHJzLnRvU3RyaW5nKCkpOwogICAgICAgIH0KICAgIH0pOwoKICAgIHJldHVybiBSaWNoU2VxdWVuY2VTaG9ydGN1dGVyOwp9KTsKCi8qIQogKiBCb290c3RyYXAgdjMuMS4xIChodHRwOi8vZ2V0Ym9vdHN0cmFwLmNvbSkKICogQ29weXJpZ2h0IDIwMTEtMjAxNCBUd2l0dGVyLCBJbmMuCiAqIExpY2Vuc2VkIHVuZGVyIE1JVCAoaHR0cHM6Ly9naXRodWIuY29tL3R3YnMvYm9vdHN0cmFwL2Jsb2IvbWFzdGVyL0xJQ0VOU0UpCiAqLwppZigidW5kZWZpbmVkIj09dHlwZW9mIGpRdWVyeSl0aHJvdyBuZXcgRXJyb3IoIkJvb3RzdHJhcCdzIEphdmFTY3JpcHQgcmVxdWlyZXMgalF1ZXJ5Iik7K2Z1bmN0aW9uKGEpe2Z1bmN0aW9uIGIoKXt2YXIgYT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJib290c3RyYXAiKSxiPXtXZWJraXRUcmFuc2l0aW9uOiJ3ZWJraXRUcmFuc2l0aW9uRW5kIixNb3pUcmFuc2l0aW9uOiJ0cmFuc2l0aW9uZW5kIixPVHJhbnNpdGlvbjoib1RyYW5zaXRpb25FbmQgb3RyYW5zaXRpb25lbmQiLHRyYW5zaXRpb246InRyYW5zaXRpb25lbmQifTtmb3IodmFyIGMgaW4gYilpZih2b2lkIDAhPT1hLnN0eWxlW2NdKXJldHVybntlbmQ6YltjXX07cmV0dXJuITF9YS5mbi5lbXVsYXRlVHJhbnNpdGlvbkVuZD1mdW5jdGlvbihiKXt2YXIgYz0hMSxkPXRoaXM7YSh0aGlzKS5vbmUoYS5zdXBwb3J0LnRyYW5zaXRpb24uZW5kLGZ1bmN0aW9uKCl7Yz0hMH0pO3ZhciBlPWZ1bmN0aW9uKCl7Y3x8YShkKS50cmlnZ2VyKGEuc3VwcG9ydC50cmFuc2l0aW9uLmVuZCl9O3JldHVybiBzZXRUaW1lb3V0KGUsYiksdGhpc30sYShmdW5jdGlvbigpe2Euc3VwcG9ydC50cmFuc2l0aW9uPWIoKX0pfShqUXVlcnkpLCtmdW5jdGlvbihhKXt2YXIgYj0nW2RhdGEtZGlzbWlzcz0iYWxlcnQiXScsYz1mdW5jdGlvbihjKXthKGMpLm9uKCJjbGljayIsYix0aGlzLmNsb3NlKX07Yy5wcm90b3R5cGUuY2xvc2U9ZnVuY3Rpb24oYil7ZnVuY3Rpb24gYygpe2YudHJpZ2dlcigiY2xvc2VkLmJzLmFsZXJ0IikucmVtb3ZlKCl9dmFyIGQ9YSh0aGlzKSxlPWQuYXR0cigiZGF0YS10YXJnZXQiKTtlfHwoZT1kLmF0dHIoImhyZWYiKSxlPWUmJmUucmVwbGFjZSgvLiooPz0jW15cc10qJCkvLCIiKSk7dmFyIGY9YShlKTtiJiZiLnByZXZlbnREZWZhdWx0KCksZi5sZW5ndGh8fChmPWQuaGFzQ2xhc3MoImFsZXJ0Iik/ZDpkLnBhcmVudCgpKSxmLnRyaWdnZXIoYj1hLkV2ZW50KCJjbG9zZS5icy5hbGVydCIpKSxiLmlzRGVmYXVsdFByZXZlbnRlZCgpfHwoZi5yZW1vdmVDbGFzcygiaW4iKSxhLnN1cHBvcnQudHJhbnNpdGlvbiYmZi5oYXNDbGFzcygiZmFkZSIpP2Yub25lKGEuc3VwcG9ydC50cmFuc2l0aW9uLmVuZCxjKS5lbXVsYXRlVHJhbnNpdGlvbkVuZCgxNTApOmMoKSl9O3ZhciBkPWEuZm4uYWxlcnQ7YS5mbi5hbGVydD1mdW5jdGlvbihiKXtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGQ9YSh0aGlzKSxlPWQuZGF0YSgiYnMuYWxlcnQiKTtlfHxkLmRhdGEoImJzLmFsZXJ0IixlPW5ldyBjKHRoaXMpKSwic3RyaW5nIj09dHlwZW9mIGImJmVbYl0uY2FsbChkKX0pfSxhLmZuLmFsZXJ0LkNvbnN0cnVjdG9yPWMsYS5mbi5hbGVydC5ub0NvbmZsaWN0PWZ1bmN0aW9uKCl7cmV0dXJuIGEuZm4uYWxlcnQ9ZCx0aGlzfSxhKGRvY3VtZW50KS5vbigiY2xpY2suYnMuYWxlcnQuZGF0YS1hcGkiLGIsYy5wcm90b3R5cGUuY2xvc2UpfShqUXVlcnkpLCtmdW5jdGlvbihhKXt2YXIgYj1mdW5jdGlvbihjLGQpe3RoaXMuJGVsZW1lbnQ9YShjKSx0aGlzLm9wdGlvbnM9YS5leHRlbmQoe30sYi5ERUZBVUxUUyxkKSx0aGlzLmlzTG9hZGluZz0hMX07Yi5ERUZBVUxUUz17bG9hZGluZ1RleHQ6ImxvYWRpbmcuLi4ifSxiLnByb3RvdHlwZS5zZXRTdGF0ZT1mdW5jdGlvbihiKXt2YXIgYz0iZGlzYWJsZWQiLGQ9dGhpcy4kZWxlbWVudCxlPWQuaXMoImlucHV0Iik/InZhbCI6Imh0bWwiLGY9ZC5kYXRhKCk7Yis9IlRleHQiLGYucmVzZXRUZXh0fHxkLmRhdGEoInJlc2V0VGV4dCIsZFtlXSgpKSxkW2VdKGZbYl18fHRoaXMub3B0aW9uc1tiXSksc2V0VGltZW91dChhLnByb3h5KGZ1bmN0aW9uKCl7ImxvYWRpbmdUZXh0Ij09Yj8odGhpcy5pc0xvYWRpbmc9ITAsZC5hZGRDbGFzcyhjKS5hdHRyKGMsYykpOnRoaXMuaXNMb2FkaW5nJiYodGhpcy5pc0xvYWRpbmc9ITEsZC5yZW1vdmVDbGFzcyhjKS5yZW1vdmVBdHRyKGMpKX0sdGhpcyksMCl9LGIucHJvdG90eXBlLnRvZ2dsZT1mdW5jdGlvbigpe3ZhciBhPSEwLGI9dGhpcy4kZWxlbWVudC5jbG9zZXN0KCdbZGF0YS10b2dnbGU9ImJ1dHRvbnMiXScpO2lmKGIubGVuZ3RoKXt2YXIgYz10aGlzLiRlbGVtZW50LmZpbmQoImlucHV0Iik7InJhZGlvIj09Yy5wcm9wKCJ0eXBlIikmJihjLnByb3AoImNoZWNrZWQiKSYmdGhpcy4kZWxlbWVudC5oYXNDbGFzcygiYWN0aXZlIik/YT0hMTpiLmZpbmQoIi5hY3RpdmUiKS5yZW1vdmVDbGFzcygiYWN0aXZlIikpLGEmJmMucHJvcCgiY2hlY2tlZCIsIXRoaXMuJGVsZW1lbnQuaGFzQ2xhc3MoImFjdGl2ZSIpKS50cmlnZ2VyKCJjaGFuZ2UiKX1hJiZ0aGlzLiRlbGVtZW50LnRvZ2dsZUNsYXNzKCJhY3RpdmUiKX07dmFyIGM9YS5mbi5idXR0b247YS5mbi5idXR0b249ZnVuY3Rpb24oYyl7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBkPWEodGhpcyksZT1kLmRhdGEoImJzLmJ1dHRvbiIpLGY9Im9iamVjdCI9PXR5cGVvZiBjJiZjO2V8fGQuZGF0YSgiYnMuYnV0dG9uIixlPW5ldyBiKHRoaXMsZikpLCJ0b2dnbGUiPT1jP2UudG9nZ2xlKCk6YyYmZS5zZXRTdGF0ZShjKX0pfSxhLmZuLmJ1dHRvbi5Db25zdHJ1Y3Rvcj1iLGEuZm4uYnV0dG9uLm5vQ29uZmxpY3Q9ZnVuY3Rpb24oKXtyZXR1cm4gYS5mbi5idXR0b249Yyx0aGlzfSxhKGRvY3VtZW50KS5vbigiY2xpY2suYnMuYnV0dG9uLmRhdGEtYXBpIiwiW2RhdGEtdG9nZ2xlXj1idXR0b25dIixmdW5jdGlvbihiKXt2YXIgYz1hKGIudGFyZ2V0KTtjLmhhc0NsYXNzKCJidG4iKXx8KGM9Yy5jbG9zZXN0KCIuYnRuIikpLGMuYnV0dG9uKCJ0b2dnbGUiKSxiLnByZXZlbnREZWZhdWx0KCl9KX0oalF1ZXJ5KSwrZnVuY3Rpb24oYSl7dmFyIGI9ZnVuY3Rpb24oYixjKXt0aGlzLiRlbGVtZW50PWEoYiksdGhpcy4kaW5kaWNhdG9ycz10aGlzLiRlbGVtZW50LmZpbmQoIi5jYXJvdXNlbC1pbmRpY2F0b3JzIiksdGhpcy5vcHRpb25zPWMsdGhpcy5wYXVzZWQ9dGhpcy5zbGlkaW5nPXRoaXMuaW50ZXJ2YWw9dGhpcy4kYWN0aXZlPXRoaXMuJGl0ZW1zPW51bGwsImhvdmVyIj09dGhpcy5vcHRpb25zLnBhdXNlJiZ0aGlzLiRlbGVtZW50Lm9uKCJtb3VzZWVudGVyIixhLnByb3h5KHRoaXMucGF1c2UsdGhpcykpLm9uKCJtb3VzZWxlYXZlIixhLnByb3h5KHRoaXMuY3ljbGUsdGhpcykpfTtiLkRFRkFVTFRTPXtpbnRlcnZhbDo1ZTMscGF1c2U6ImhvdmVyIix3cmFwOiEwfSxiLnByb3RvdHlwZS5jeWNsZT1mdW5jdGlvbihiKXtyZXR1cm4gYnx8KHRoaXMucGF1c2VkPSExKSx0aGlzLmludGVydmFsJiZjbGVhckludGVydmFsKHRoaXMuaW50ZXJ2YWwpLHRoaXMub3B0aW9ucy5pbnRlcnZhbCYmIXRoaXMucGF1c2VkJiYodGhpcy5pbnRlcnZhbD1zZXRJbnRlcnZhbChhLnByb3h5KHRoaXMubmV4dCx0aGlzKSx0aGlzLm9wdGlvbnMuaW50ZXJ2YWwpKSx0aGlzfSxiLnByb3RvdHlwZS5nZXRBY3RpdmVJbmRleD1mdW5jdGlvbigpe3JldHVybiB0aGlzLiRhY3RpdmU9dGhpcy4kZWxlbWVudC5maW5kKCIuaXRlbS5hY3RpdmUiKSx0aGlzLiRpdGVtcz10aGlzLiRhY3RpdmUucGFyZW50KCkuY2hpbGRyZW4oKSx0aGlzLiRpdGVtcy5pbmRleCh0aGlzLiRhY3RpdmUpfSxiLnByb3RvdHlwZS50bz1mdW5jdGlvbihiKXt2YXIgYz10aGlzLGQ9dGhpcy5nZXRBY3RpdmVJbmRleCgpO3JldHVybiBiPnRoaXMuJGl0ZW1zLmxlbmd0aC0xfHwwPmI/dm9pZCAwOnRoaXMuc2xpZGluZz90aGlzLiRlbGVtZW50Lm9uZSgic2xpZC5icy5jYXJvdXNlbCIsZnVuY3Rpb24oKXtjLnRvKGIpfSk6ZD09Yj90aGlzLnBhdXNlKCkuY3ljbGUoKTp0aGlzLnNsaWRlKGI+ZD8ibmV4dCI6InByZXYiLGEodGhpcy4kaXRlbXNbYl0pKX0sYi5wcm90b3R5cGUucGF1c2U9ZnVuY3Rpb24oYil7cmV0dXJuIGJ8fCh0aGlzLnBhdXNlZD0hMCksdGhpcy4kZWxlbWVudC5maW5kKCIubmV4dCwgLnByZXYiKS5sZW5ndGgmJmEuc3VwcG9ydC50cmFuc2l0aW9uJiYodGhpcy4kZWxlbWVudC50cmlnZ2VyKGEuc3VwcG9ydC50cmFuc2l0aW9uLmVuZCksdGhpcy5jeWNsZSghMCkpLHRoaXMuaW50ZXJ2YWw9Y2xlYXJJbnRlcnZhbCh0aGlzLmludGVydmFsKSx0aGlzfSxiLnByb3RvdHlwZS5uZXh0PWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuc2xpZGluZz92b2lkIDA6dGhpcy5zbGlkZSgibmV4dCIpfSxiLnByb3RvdHlwZS5wcmV2PWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuc2xpZGluZz92b2lkIDA6dGhpcy5zbGlkZSgicHJldiIpfSxiLnByb3RvdHlwZS5zbGlkZT1mdW5jdGlvbihiLGMpe3ZhciBkPXRoaXMuJGVsZW1lbnQuZmluZCgiLml0ZW0uYWN0aXZlIiksZT1jfHxkW2JdKCksZj10aGlzLmludGVydmFsLGc9Im5leHQiPT1iPyJsZWZ0IjoicmlnaHQiLGg9Im5leHQiPT1iPyJmaXJzdCI6Imxhc3QiLGk9dGhpcztpZighZS5sZW5ndGgpe2lmKCF0aGlzLm9wdGlvbnMud3JhcClyZXR1cm47ZT10aGlzLiRlbGVtZW50LmZpbmQoIi5pdGVtIilbaF0oKX1pZihlLmhhc0NsYXNzKCJhY3RpdmUiKSlyZXR1cm4gdGhpcy5zbGlkaW5nPSExO3ZhciBqPWEuRXZlbnQoInNsaWRlLmJzLmNhcm91c2VsIix7cmVsYXRlZFRhcmdldDplWzBdLGRpcmVjdGlvbjpnfSk7cmV0dXJuIHRoaXMuJGVsZW1lbnQudHJpZ2dlcihqKSxqLmlzRGVmYXVsdFByZXZlbnRlZCgpP3ZvaWQgMDoodGhpcy5zbGlkaW5nPSEwLGYmJnRoaXMucGF1c2UoKSx0aGlzLiRpbmRpY2F0b3JzLmxlbmd0aCYmKHRoaXMuJGluZGljYXRvcnMuZmluZCgiLmFjdGl2ZSIpLnJlbW92ZUNsYXNzKCJhY3RpdmUiKSx0aGlzLiRlbGVtZW50Lm9uZSgic2xpZC5icy5jYXJvdXNlbCIsZnVuY3Rpb24oKXt2YXIgYj1hKGkuJGluZGljYXRvcnMuY2hpbGRyZW4oKVtpLmdldEFjdGl2ZUluZGV4KCldKTtiJiZiLmFkZENsYXNzKCJhY3RpdmUiKX0pKSxhLnN1cHBvcnQudHJhbnNpdGlvbiYmdGhpcy4kZWxlbWVudC5oYXNDbGFzcygic2xpZGUiKT8oZS5hZGRDbGFzcyhiKSxlWzBdLm9mZnNldFdpZHRoLGQuYWRkQ2xhc3MoZyksZS5hZGRDbGFzcyhnKSxkLm9uZShhLnN1cHBvcnQudHJhbnNpdGlvbi5lbmQsZnVuY3Rpb24oKXtlLnJlbW92ZUNsYXNzKFtiLGddLmpvaW4oIiAiKSkuYWRkQ2xhc3MoImFjdGl2ZSIpLGQucmVtb3ZlQ2xhc3MoWyJhY3RpdmUiLGddLmpvaW4oIiAiKSksaS5zbGlkaW5nPSExLHNldFRpbWVvdXQoZnVuY3Rpb24oKXtpLiRlbGVtZW50LnRyaWdnZXIoInNsaWQuYnMuY2Fyb3VzZWwiKX0sMCl9KS5lbXVsYXRlVHJhbnNpdGlvbkVuZCgxZTMqZC5jc3MoInRyYW5zaXRpb24tZHVyYXRpb24iKS5zbGljZSgwLC0xKSkpOihkLnJlbW92ZUNsYXNzKCJhY3RpdmUiKSxlLmFkZENsYXNzKCJhY3RpdmUiKSx0aGlzLnNsaWRpbmc9ITEsdGhpcy4kZWxlbWVudC50cmlnZ2VyKCJzbGlkLmJzLmNhcm91c2VsIikpLGYmJnRoaXMuY3ljbGUoKSx0aGlzKX07dmFyIGM9YS5mbi5jYXJvdXNlbDthLmZuLmNhcm91c2VsPWZ1bmN0aW9uKGMpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgZD1hKHRoaXMpLGU9ZC5kYXRhKCJicy5jYXJvdXNlbCIpLGY9YS5leHRlbmQoe30sYi5ERUZBVUxUUyxkLmRhdGEoKSwib2JqZWN0Ij09dHlwZW9mIGMmJmMpLGc9InN0cmluZyI9PXR5cGVvZiBjP2M6Zi5zbGlkZTtlfHxkLmRhdGEoImJzLmNhcm91c2VsIixlPW5ldyBiKHRoaXMsZikpLCJudW1iZXIiPT10eXBlb2YgYz9lLnRvKGMpOmc/ZVtnXSgpOmYuaW50ZXJ2YWwmJmUucGF1c2UoKS5jeWNsZSgpfSl9LGEuZm4uY2Fyb3VzZWwuQ29uc3RydWN0b3I9YixhLmZuLmNhcm91c2VsLm5vQ29uZmxpY3Q9ZnVuY3Rpb24oKXtyZXR1cm4gYS5mbi5jYXJvdXNlbD1jLHRoaXN9LGEoZG9jdW1lbnQpLm9uKCJjbGljay5icy5jYXJvdXNlbC5kYXRhLWFwaSIsIltkYXRhLXNsaWRlXSwgW2RhdGEtc2xpZGUtdG9dIixmdW5jdGlvbihiKXt2YXIgYyxkPWEodGhpcyksZT1hKGQuYXR0cigiZGF0YS10YXJnZXQiKXx8KGM9ZC5hdHRyKCJocmVmIikpJiZjLnJlcGxhY2UoLy4qKD89I1teXHNdKyQpLywiIikpLGY9YS5leHRlbmQoe30sZS5kYXRhKCksZC5kYXRhKCkpLGc9ZC5hdHRyKCJkYXRhLXNsaWRlLXRvIik7ZyYmKGYuaW50ZXJ2YWw9ITEpLGUuY2Fyb3VzZWwoZiksKGc9ZC5hdHRyKCJkYXRhLXNsaWRlLXRvIikpJiZlLmRhdGEoImJzLmNhcm91c2VsIikudG8oZyksYi5wcmV2ZW50RGVmYXVsdCgpfSksYSh3aW5kb3cpLm9uKCJsb2FkIixmdW5jdGlvbigpe2EoJ1tkYXRhLXJpZGU9ImNhcm91c2VsIl0nKS5lYWNoKGZ1bmN0aW9uKCl7dmFyIGI9YSh0aGlzKTtiLmNhcm91c2VsKGIuZGF0YSgpKX0pfSl9KGpRdWVyeSksK2Z1bmN0aW9uKGEpe3ZhciBiPWZ1bmN0aW9uKGMsZCl7dGhpcy4kZWxlbWVudD1hKGMpLHRoaXMub3B0aW9ucz1hLmV4dGVuZCh7fSxiLkRFRkFVTFRTLGQpLHRoaXMudHJhbnNpdGlvbmluZz1udWxsLHRoaXMub3B0aW9ucy5wYXJlbnQmJih0aGlzLiRwYXJlbnQ9YSh0aGlzLm9wdGlvbnMucGFyZW50KSksdGhpcy5vcHRpb25zLnRvZ2dsZSYmdGhpcy50b2dnbGUoKX07Yi5ERUZBVUxUUz17dG9nZ2xlOiEwfSxiLnByb3RvdHlwZS5kaW1lbnNpb249ZnVuY3Rpb24oKXt2YXIgYT10aGlzLiRlbGVtZW50Lmhhc0NsYXNzKCJ3aWR0aCIpO3JldHVybiBhPyJ3aWR0aCI6ImhlaWdodCJ9LGIucHJvdG90eXBlLnNob3c9ZnVuY3Rpb24oKXtpZighdGhpcy50cmFuc2l0aW9uaW5nJiYhdGhpcy4kZWxlbWVudC5oYXNDbGFzcygiaW4iKSl7dmFyIGI9YS5FdmVudCgic2hvdy5icy5jb2xsYXBzZSIpO2lmKHRoaXMuJGVsZW1lbnQudHJpZ2dlcihiKSwhYi5pc0RlZmF1bHRQcmV2ZW50ZWQoKSl7dmFyIGM9dGhpcy4kcGFyZW50JiZ0aGlzLiRwYXJlbnQuZmluZCgiPiAucGFuZWwgPiAuaW4iKTtpZihjJiZjLmxlbmd0aCl7dmFyIGQ9Yy5kYXRhKCJicy5jb2xsYXBzZSIpO2lmKGQmJmQudHJhbnNpdGlvbmluZylyZXR1cm47Yy5jb2xsYXBzZSgiaGlkZSIpLGR8fGMuZGF0YSgiYnMuY29sbGFwc2UiLG51bGwpfXZhciBlPXRoaXMuZGltZW5zaW9uKCk7dGhpcy4kZWxlbWVudC5yZW1vdmVDbGFzcygiY29sbGFwc2UiKS5hZGRDbGFzcygiY29sbGFwc2luZyIpW2VdKDApLHRoaXMudHJhbnNpdGlvbmluZz0xO3ZhciBmPWZ1bmN0aW9uKCl7dGhpcy4kZWxlbWVudC5yZW1vdmVDbGFzcygiY29sbGFwc2luZyIpLmFkZENsYXNzKCJjb2xsYXBzZSBpbiIpW2VdKCJhdXRvIiksdGhpcy50cmFuc2l0aW9uaW5nPTAsdGhpcy4kZWxlbWVudC50cmlnZ2VyKCJzaG93bi5icy5jb2xsYXBzZSIpfTtpZighYS5zdXBwb3J0LnRyYW5zaXRpb24pcmV0dXJuIGYuY2FsbCh0aGlzKTt2YXIgZz1hLmNhbWVsQ2FzZShbInNjcm9sbCIsZV0uam9pbigiLSIpKTt0aGlzLiRlbGVtZW50Lm9uZShhLnN1cHBvcnQudHJhbnNpdGlvbi5lbmQsYS5wcm94eShmLHRoaXMpKS5lbXVsYXRlVHJhbnNpdGlvbkVuZCgzNTApW2VdKHRoaXMuJGVsZW1lbnRbMF1bZ10pfX19LGIucHJvdG90eXBlLmhpZGU9ZnVuY3Rpb24oKXtpZighdGhpcy50cmFuc2l0aW9uaW5nJiZ0aGlzLiRlbGVtZW50Lmhhc0NsYXNzKCJpbiIpKXt2YXIgYj1hLkV2ZW50KCJoaWRlLmJzLmNvbGxhcHNlIik7aWYodGhpcy4kZWxlbWVudC50cmlnZ2VyKGIpLCFiLmlzRGVmYXVsdFByZXZlbnRlZCgpKXt2YXIgYz10aGlzLmRpbWVuc2lvbigpO3RoaXMuJGVsZW1lbnRbY10odGhpcy4kZWxlbWVudFtjXSgpKVswXS5vZmZzZXRIZWlnaHQsdGhpcy4kZWxlbWVudC5hZGRDbGFzcygiY29sbGFwc2luZyIpLnJlbW92ZUNsYXNzKCJjb2xsYXBzZSIpLnJlbW92ZUNsYXNzKCJpbiIpLHRoaXMudHJhbnNpdGlvbmluZz0xO3ZhciBkPWZ1bmN0aW9uKCl7dGhpcy50cmFuc2l0aW9uaW5nPTAsdGhpcy4kZWxlbWVudC50cmlnZ2VyKCJoaWRkZW4uYnMuY29sbGFwc2UiKS5yZW1vdmVDbGFzcygiY29sbGFwc2luZyIpLmFkZENsYXNzKCJjb2xsYXBzZSIpfTtyZXR1cm4gYS5zdXBwb3J0LnRyYW5zaXRpb24/dm9pZCB0aGlzLiRlbGVtZW50W2NdKDApLm9uZShhLnN1cHBvcnQudHJhbnNpdGlvbi5lbmQsYS5wcm94eShkLHRoaXMpKS5lbXVsYXRlVHJhbnNpdGlvbkVuZCgzNTApOmQuY2FsbCh0aGlzKX19fSxiLnByb3RvdHlwZS50b2dnbGU9ZnVuY3Rpb24oKXt0aGlzW3RoaXMuJGVsZW1lbnQuaGFzQ2xhc3MoImluIik/ImhpZGUiOiJzaG93Il0oKX07dmFyIGM9YS5mbi5jb2xsYXBzZTthLmZuLmNvbGxhcHNlPWZ1bmN0aW9uKGMpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgZD1hKHRoaXMpLGU9ZC5kYXRhKCJicy5jb2xsYXBzZSIpLGY9YS5leHRlbmQoe30sYi5ERUZBVUxUUyxkLmRhdGEoKSwib2JqZWN0Ij09dHlwZW9mIGMmJmMpOyFlJiZmLnRvZ2dsZSYmInNob3ciPT1jJiYoYz0hYyksZXx8ZC5kYXRhKCJicy5jb2xsYXBzZSIsZT1uZXcgYih0aGlzLGYpKSwic3RyaW5nIj09dHlwZW9mIGMmJmVbY10oKX0pfSxhLmZuLmNvbGxhcHNlLkNvbnN0cnVjdG9yPWIsYS5mbi5jb2xsYXBzZS5ub0NvbmZsaWN0PWZ1bmN0aW9uKCl7cmV0dXJuIGEuZm4uY29sbGFwc2U9Yyx0aGlzfSxhKGRvY3VtZW50KS5vbigiY2xpY2suYnMuY29sbGFwc2UuZGF0YS1hcGkiLCJbZGF0YS10b2dnbGU9Y29sbGFwc2VdIixmdW5jdGlvbihiKXt2YXIgYyxkPWEodGhpcyksZT1kLmF0dHIoImRhdGEtdGFyZ2V0Iil8fGIucHJldmVudERlZmF1bHQoKXx8KGM9ZC5hdHRyKCJocmVmIikpJiZjLnJlcGxhY2UoLy4qKD89I1teXHNdKyQpLywiIiksZj1hKGUpLGc9Zi5kYXRhKCJicy5jb2xsYXBzZSIpLGg9Zz8idG9nZ2xlIjpkLmRhdGEoKSxpPWQuYXR0cigiZGF0YS1wYXJlbnQiKSxqPWkmJmEoaSk7ZyYmZy50cmFuc2l0aW9uaW5nfHwoaiYmai5maW5kKCdbZGF0YS10b2dnbGU9Y29sbGFwc2VdW2RhdGEtcGFyZW50PSInK2krJyJdJykubm90KGQpLmFkZENsYXNzKCJjb2xsYXBzZWQiKSxkW2YuaGFzQ2xhc3MoImluIik/ImFkZENsYXNzIjoicmVtb3ZlQ2xhc3MiXSgiY29sbGFwc2VkIikpLGYuY29sbGFwc2UoaCl9KX0oalF1ZXJ5KSwrZnVuY3Rpb24oYSl7ZnVuY3Rpb24gYihiKXthKGQpLnJlbW92ZSgpLGEoZSkuZWFjaChmdW5jdGlvbigpe3ZhciBkPWMoYSh0aGlzKSksZT17cmVsYXRlZFRhcmdldDp0aGlzfTtkLmhhc0NsYXNzKCJvcGVuIikmJihkLnRyaWdnZXIoYj1hLkV2ZW50KCJoaWRlLmJzLmRyb3Bkb3duIixlKSksYi5pc0RlZmF1bHRQcmV2ZW50ZWQoKXx8ZC5yZW1vdmVDbGFzcygib3BlbiIpLnRyaWdnZXIoImhpZGRlbi5icy5kcm9wZG93biIsZSkpfSl9ZnVuY3Rpb24gYyhiKXt2YXIgYz1iLmF0dHIoImRhdGEtdGFyZ2V0Iik7Y3x8KGM9Yi5hdHRyKCJocmVmIiksYz1jJiYvI1tBLVphLXpdLy50ZXN0KGMpJiZjLnJlcGxhY2UoLy4qKD89I1teXHNdKiQpLywiIikpO3ZhciBkPWMmJmEoYyk7cmV0dXJuIGQmJmQubGVuZ3RoP2Q6Yi5wYXJlbnQoKX12YXIgZD0iLmRyb3Bkb3duLWJhY2tkcm9wIixlPSJbZGF0YS10b2dnbGU9ZHJvcGRvd25dIixmPWZ1bmN0aW9uKGIpe2EoYikub24oImNsaWNrLmJzLmRyb3Bkb3duIix0aGlzLnRvZ2dsZSl9O2YucHJvdG90eXBlLnRvZ2dsZT1mdW5jdGlvbihkKXt2YXIgZT1hKHRoaXMpO2lmKCFlLmlzKCIuZGlzYWJsZWQsIDpkaXNhYmxlZCIpKXt2YXIgZj1jKGUpLGc9Zi5oYXNDbGFzcygib3BlbiIpO2lmKGIoKSwhZyl7Im9udG91Y2hzdGFydCJpbiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQmJiFmLmNsb3Nlc3QoIi5uYXZiYXItbmF2IikubGVuZ3RoJiZhKCc8ZGl2IGNsYXNzPSJkcm9wZG93bi1iYWNrZHJvcCIvPicpLmluc2VydEFmdGVyKGEodGhpcykpLm9uKCJjbGljayIsYik7dmFyIGg9e3JlbGF0ZWRUYXJnZXQ6dGhpc307aWYoZi50cmlnZ2VyKGQ9YS5FdmVudCgic2hvdy5icy5kcm9wZG93biIsaCkpLGQuaXNEZWZhdWx0UHJldmVudGVkKCkpcmV0dXJuO2YudG9nZ2xlQ2xhc3MoIm9wZW4iKS50cmlnZ2VyKCJzaG93bi5icy5kcm9wZG93biIsaCksZS5mb2N1cygpfXJldHVybiExfX0sZi5wcm90b3R5cGUua2V5ZG93bj1mdW5jdGlvbihiKXtpZigvKDM4fDQwfDI3KS8udGVzdChiLmtleUNvZGUpKXt2YXIgZD1hKHRoaXMpO2lmKGIucHJldmVudERlZmF1bHQoKSxiLnN0b3BQcm9wYWdhdGlvbigpLCFkLmlzKCIuZGlzYWJsZWQsIDpkaXNhYmxlZCIpKXt2YXIgZj1jKGQpLGc9Zi5oYXNDbGFzcygib3BlbiIpO2lmKCFnfHxnJiYyNz09Yi5rZXlDb2RlKXJldHVybiAyNz09Yi53aGljaCYmZi5maW5kKGUpLmZvY3VzKCksZC5jbGljaygpO3ZhciBoPSIgbGk6bm90KC5kaXZpZGVyKTp2aXNpYmxlIGEiLGk9Zi5maW5kKCJbcm9sZT1tZW51XSIraCsiLCBbcm9sZT1saXN0Ym94XSIraCk7aWYoaS5sZW5ndGgpe3ZhciBqPWkuaW5kZXgoaS5maWx0ZXIoIjpmb2N1cyIpKTszOD09Yi5rZXlDb2RlJiZqPjAmJmotLSw0MD09Yi5rZXlDb2RlJiZqPGkubGVuZ3RoLTEmJmorKyx+anx8KGo9MCksaS5lcShqKS5mb2N1cygpfX19fTt2YXIgZz1hLmZuLmRyb3Bkb3duO2EuZm4uZHJvcGRvd249ZnVuY3Rpb24oYil7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBjPWEodGhpcyksZD1jLmRhdGEoImJzLmRyb3Bkb3duIik7ZHx8Yy5kYXRhKCJicy5kcm9wZG93biIsZD1uZXcgZih0aGlzKSksInN0cmluZyI9PXR5cGVvZiBiJiZkW2JdLmNhbGwoYyl9KX0sYS5mbi5kcm9wZG93bi5Db25zdHJ1Y3Rvcj1mLGEuZm4uZHJvcGRvd24ubm9Db25mbGljdD1mdW5jdGlvbigpe3JldHVybiBhLmZuLmRyb3Bkb3duPWcsdGhpc30sYShkb2N1bWVudCkub24oImNsaWNrLmJzLmRyb3Bkb3duLmRhdGEtYXBpIixiKS5vbigiY2xpY2suYnMuZHJvcGRvd24uZGF0YS1hcGkiLCIuZHJvcGRvd24gZm9ybSIsZnVuY3Rpb24oYSl7YS5zdG9wUHJvcGFnYXRpb24oKX0pLm9uKCJjbGljay5icy5kcm9wZG93bi5kYXRhLWFwaSIsZSxmLnByb3RvdHlwZS50b2dnbGUpLm9uKCJrZXlkb3duLmJzLmRyb3Bkb3duLmRhdGEtYXBpIixlKyIsIFtyb2xlPW1lbnVdLCBbcm9sZT1saXN0Ym94XSIsZi5wcm90b3R5cGUua2V5ZG93bil9KGpRdWVyeSksK2Z1bmN0aW9uKGEpe3ZhciBiPWZ1bmN0aW9uKGIsYyl7dGhpcy5vcHRpb25zPWMsdGhpcy4kZWxlbWVudD1hKGIpLHRoaXMuJGJhY2tkcm9wPXRoaXMuaXNTaG93bj1udWxsLHRoaXMub3B0aW9ucy5yZW1vdGUmJnRoaXMuJGVsZW1lbnQuZmluZCgiLm1vZGFsLWNvbnRlbnQiKS5sb2FkKHRoaXMub3B0aW9ucy5yZW1vdGUsYS5wcm94eShmdW5jdGlvbigpe3RoaXMuJGVsZW1lbnQudHJpZ2dlcigibG9hZGVkLmJzLm1vZGFsIil9LHRoaXMpKX07Yi5ERUZBVUxUUz17YmFja2Ryb3A6ITAsa2V5Ym9hcmQ6ITAsc2hvdzohMH0sYi5wcm90b3R5cGUudG9nZ2xlPWZ1bmN0aW9uKGEpe3JldHVybiB0aGlzW3RoaXMuaXNTaG93bj8iaGlkZSI6InNob3ciXShhKX0sYi5wcm90b3R5cGUuc2hvdz1mdW5jdGlvbihiKXt2YXIgYz10aGlzLGQ9YS5FdmVudCgic2hvdy5icy5tb2RhbCIse3JlbGF0ZWRUYXJnZXQ6Yn0pO3RoaXMuJGVsZW1lbnQudHJpZ2dlcihkKSx0aGlzLmlzU2hvd258fGQuaXNEZWZhdWx0UHJldmVudGVkKCl8fCh0aGlzLmlzU2hvd249ITAsdGhpcy5lc2NhcGUoKSx0aGlzLiRlbGVtZW50Lm9uKCJjbGljay5kaXNtaXNzLmJzLm1vZGFsIiwnW2RhdGEtZGlzbWlzcz0ibW9kYWwiXScsYS5wcm94eSh0aGlzLmhpZGUsdGhpcykpLHRoaXMuYmFja2Ryb3AoZnVuY3Rpb24oKXt2YXIgZD1hLnN1cHBvcnQudHJhbnNpdGlvbiYmYy4kZWxlbWVudC5oYXNDbGFzcygiZmFkZSIpO2MuJGVsZW1lbnQucGFyZW50KCkubGVuZ3RofHxjLiRlbGVtZW50LmFwcGVuZFRvKGRvY3VtZW50LmJvZHkpLGMuJGVsZW1lbnQuc2hvdygpLnNjcm9sbFRvcCgwKSxkJiZjLiRlbGVtZW50WzBdLm9mZnNldFdpZHRoLGMuJGVsZW1lbnQuYWRkQ2xhc3MoImluIikuYXR0cigiYXJpYS1oaWRkZW4iLCExKSxjLmVuZm9yY2VGb2N1cygpO3ZhciBlPWEuRXZlbnQoInNob3duLmJzLm1vZGFsIix7cmVsYXRlZFRhcmdldDpifSk7ZD9jLiRlbGVtZW50LmZpbmQoIi5tb2RhbC1kaWFsb2ciKS5vbmUoYS5zdXBwb3J0LnRyYW5zaXRpb24uZW5kLGZ1bmN0aW9uKCl7Yy4kZWxlbWVudC5mb2N1cygpLnRyaWdnZXIoZSl9KS5lbXVsYXRlVHJhbnNpdGlvbkVuZCgzMDApOmMuJGVsZW1lbnQuZm9jdXMoKS50cmlnZ2VyKGUpfSkpfSxiLnByb3RvdHlwZS5oaWRlPWZ1bmN0aW9uKGIpe2ImJmIucHJldmVudERlZmF1bHQoKSxiPWEuRXZlbnQoImhpZGUuYnMubW9kYWwiKSx0aGlzLiRlbGVtZW50LnRyaWdnZXIoYiksdGhpcy5pc1Nob3duJiYhYi5pc0RlZmF1bHRQcmV2ZW50ZWQoKSYmKHRoaXMuaXNTaG93bj0hMSx0aGlzLmVzY2FwZSgpLGEoZG9jdW1lbnQpLm9mZigiZm9jdXNpbi5icy5tb2RhbCIpLHRoaXMuJGVsZW1lbnQucmVtb3ZlQ2xhc3MoImluIikuYXR0cigiYXJpYS1oaWRkZW4iLCEwKS5vZmYoImNsaWNrLmRpc21pc3MuYnMubW9kYWwiKSxhLnN1cHBvcnQudHJhbnNpdGlvbiYmdGhpcy4kZWxlbWVudC5oYXNDbGFzcygiZmFkZSIpP3RoaXMuJGVsZW1lbnQub25lKGEuc3VwcG9ydC50cmFuc2l0aW9uLmVuZCxhLnByb3h5KHRoaXMuaGlkZU1vZGFsLHRoaXMpKS5lbXVsYXRlVHJhbnNpdGlvbkVuZCgzMDApOnRoaXMuaGlkZU1vZGFsKCkpfSxiLnByb3RvdHlwZS5lbmZvcmNlRm9jdXM9ZnVuY3Rpb24oKXthKGRvY3VtZW50KS5vZmYoImZvY3VzaW4uYnMubW9kYWwiKS5vbigiZm9jdXNpbi5icy5tb2RhbCIsYS5wcm94eShmdW5jdGlvbihhKXt0aGlzLiRlbGVtZW50WzBdPT09YS50YXJnZXR8fHRoaXMuJGVsZW1lbnQuaGFzKGEudGFyZ2V0KS5sZW5ndGh8fHRoaXMuJGVsZW1lbnQuZm9jdXMoKX0sdGhpcykpfSxiLnByb3RvdHlwZS5lc2NhcGU9ZnVuY3Rpb24oKXt0aGlzLmlzU2hvd24mJnRoaXMub3B0aW9ucy5rZXlib2FyZD90aGlzLiRlbGVtZW50Lm9uKCJrZXl1cC5kaXNtaXNzLmJzLm1vZGFsIixhLnByb3h5KGZ1bmN0aW9uKGEpezI3PT1hLndoaWNoJiZ0aGlzLmhpZGUoKX0sdGhpcykpOnRoaXMuaXNTaG93bnx8dGhpcy4kZWxlbWVudC5vZmYoImtleXVwLmRpc21pc3MuYnMubW9kYWwiKX0sYi5wcm90b3R5cGUuaGlkZU1vZGFsPWZ1bmN0aW9uKCl7dmFyIGE9dGhpczt0aGlzLiRlbGVtZW50LmhpZGUoKSx0aGlzLmJhY2tkcm9wKGZ1bmN0aW9uKCl7YS5yZW1vdmVCYWNrZHJvcCgpLGEuJGVsZW1lbnQudHJpZ2dlcigiaGlkZGVuLmJzLm1vZGFsIil9KX0sYi5wcm90b3R5cGUucmVtb3ZlQmFja2Ryb3A9ZnVuY3Rpb24oKXt0aGlzLiRiYWNrZHJvcCYmdGhpcy4kYmFja2Ryb3AucmVtb3ZlKCksdGhpcy4kYmFja2Ryb3A9bnVsbH0sYi5wcm90b3R5cGUuYmFja2Ryb3A9ZnVuY3Rpb24oYil7dmFyIGM9dGhpcy4kZWxlbWVudC5oYXNDbGFzcygiZmFkZSIpPyJmYWRlIjoiIjtpZih0aGlzLmlzU2hvd24mJnRoaXMub3B0aW9ucy5iYWNrZHJvcCl7dmFyIGQ9YS5zdXBwb3J0LnRyYW5zaXRpb24mJmM7aWYodGhpcy4kYmFja2Ryb3A9YSgnPGRpdiBjbGFzcz0ibW9kYWwtYmFja2Ryb3AgJytjKyciIC8+JykuYXBwZW5kVG8oZG9jdW1lbnQuYm9keSksdGhpcy4kZWxlbWVudC5vbigiY2xpY2suZGlzbWlzcy5icy5tb2RhbCIsYS5wcm94eShmdW5jdGlvbihhKXthLnRhcmdldD09PWEuY3VycmVudFRhcmdldCYmKCJzdGF0aWMiPT10aGlzLm9wdGlvbnMuYmFja2Ryb3A/dGhpcy4kZWxlbWVudFswXS5mb2N1cy5jYWxsKHRoaXMuJGVsZW1lbnRbMF0pOnRoaXMuaGlkZS5jYWxsKHRoaXMpKX0sdGhpcykpLGQmJnRoaXMuJGJhY2tkcm9wWzBdLm9mZnNldFdpZHRoLHRoaXMuJGJhY2tkcm9wLmFkZENsYXNzKCJpbiIpLCFiKXJldHVybjtkP3RoaXMuJGJhY2tkcm9wLm9uZShhLnN1cHBvcnQudHJhbnNpdGlvbi5lbmQsYikuZW11bGF0ZVRyYW5zaXRpb25FbmQoMTUwKTpiKCl9ZWxzZSF0aGlzLmlzU2hvd24mJnRoaXMuJGJhY2tkcm9wPyh0aGlzLiRiYWNrZHJvcC5yZW1vdmVDbGFzcygiaW4iKSxhLnN1cHBvcnQudHJhbnNpdGlvbiYmdGhpcy4kZWxlbWVudC5oYXNDbGFzcygiZmFkZSIpP3RoaXMuJGJhY2tkcm9wLm9uZShhLnN1cHBvcnQudHJhbnNpdGlvbi5lbmQsYikuZW11bGF0ZVRyYW5zaXRpb25FbmQoMTUwKTpiKCkpOmImJmIoKX07dmFyIGM9YS5mbi5tb2RhbDthLmZuLm1vZGFsPWZ1bmN0aW9uKGMsZCl7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBlPWEodGhpcyksZj1lLmRhdGEoImJzLm1vZGFsIiksZz1hLmV4dGVuZCh7fSxiLkRFRkFVTFRTLGUuZGF0YSgpLCJvYmplY3QiPT10eXBlb2YgYyYmYyk7Znx8ZS5kYXRhKCJicy5tb2RhbCIsZj1uZXcgYih0aGlzLGcpKSwic3RyaW5nIj09dHlwZW9mIGM/ZltjXShkKTpnLnNob3cmJmYuc2hvdyhkKX0pfSxhLmZuLm1vZGFsLkNvbnN0cnVjdG9yPWIsYS5mbi5tb2RhbC5ub0NvbmZsaWN0PWZ1bmN0aW9uKCl7cmV0dXJuIGEuZm4ubW9kYWw9Yyx0aGlzfSxhKGRvY3VtZW50KS5vbigiY2xpY2suYnMubW9kYWwuZGF0YS1hcGkiLCdbZGF0YS10b2dnbGU9Im1vZGFsIl0nLGZ1bmN0aW9uKGIpe3ZhciBjPWEodGhpcyksZD1jLmF0dHIoImhyZWYiKSxlPWEoYy5hdHRyKCJkYXRhLXRhcmdldCIpfHxkJiZkLnJlcGxhY2UoLy4qKD89I1teXHNdKyQpLywiIikpLGY9ZS5kYXRhKCJicy5tb2RhbCIpPyJ0b2dnbGUiOmEuZXh0ZW5kKHtyZW1vdGU6IS8jLy50ZXN0KGQpJiZkfSxlLmRhdGEoKSxjLmRhdGEoKSk7Yy5pcygiYSIpJiZiLnByZXZlbnREZWZhdWx0KCksZS5tb2RhbChmLHRoaXMpLm9uZSgiaGlkZSIsZnVuY3Rpb24oKXtjLmlzKCI6dmlzaWJsZSIpJiZjLmZvY3VzKCl9KX0pLGEoZG9jdW1lbnQpLm9uKCJzaG93LmJzLm1vZGFsIiwiLm1vZGFsIixmdW5jdGlvbigpe2EoZG9jdW1lbnQuYm9keSkuYWRkQ2xhc3MoIm1vZGFsLW9wZW4iKX0pLm9uKCJoaWRkZW4uYnMubW9kYWwiLCIubW9kYWwiLGZ1bmN0aW9uKCl7YShkb2N1bWVudC5ib2R5KS5yZW1vdmVDbGFzcygibW9kYWwtb3BlbiIpfSl9KGpRdWVyeSksK2Z1bmN0aW9uKGEpe3ZhciBiPWZ1bmN0aW9uKGEsYil7dGhpcy50eXBlPXRoaXMub3B0aW9ucz10aGlzLmVuYWJsZWQ9dGhpcy50aW1lb3V0PXRoaXMuaG92ZXJTdGF0ZT10aGlzLiRlbGVtZW50PW51bGwsdGhpcy5pbml0KCJ0b29sdGlwIixhLGIpfTtiLkRFRkFVTFRTPXthbmltYXRpb246ITAscGxhY2VtZW50OiJ0b3AiLHNlbGVjdG9yOiExLHRlbXBsYXRlOic8ZGl2IGNsYXNzPSJ0b29sdGlwIj48ZGl2IGNsYXNzPSJ0b29sdGlwLWFycm93Ij48L2Rpdj48ZGl2IGNsYXNzPSJ0b29sdGlwLWlubmVyIj48L2Rpdj48L2Rpdj4nLHRyaWdnZXI6ImhvdmVyIGZvY3VzIix0aXRsZToiIixkZWxheTowLGh0bWw6ITEsY29udGFpbmVyOiExfSxiLnByb3RvdHlwZS5pbml0PWZ1bmN0aW9uKGIsYyxkKXt0aGlzLmVuYWJsZWQ9ITAsdGhpcy50eXBlPWIsdGhpcy4kZWxlbWVudD1hKGMpLHRoaXMub3B0aW9ucz10aGlzLmdldE9wdGlvbnMoZCk7Zm9yKHZhciBlPXRoaXMub3B0aW9ucy50cmlnZ2VyLnNwbGl0KCIgIiksZj1lLmxlbmd0aDtmLS07KXt2YXIgZz1lW2ZdO2lmKCJjbGljayI9PWcpdGhpcy4kZWxlbWVudC5vbigiY2xpY2suIit0aGlzLnR5cGUsdGhpcy5vcHRpb25zLnNlbGVjdG9yLGEucHJveHkodGhpcy50b2dnbGUsdGhpcykpO2Vsc2UgaWYoIm1hbnVhbCIhPWcpe3ZhciBoPSJob3ZlciI9PWc/Im1vdXNlZW50ZXIiOiJmb2N1c2luIixpPSJob3ZlciI9PWc/Im1vdXNlbGVhdmUiOiJmb2N1c291dCI7dGhpcy4kZWxlbWVudC5vbihoKyIuIit0aGlzLnR5cGUsdGhpcy5vcHRpb25zLnNlbGVjdG9yLGEucHJveHkodGhpcy5lbnRlcix0aGlzKSksdGhpcy4kZWxlbWVudC5vbihpKyIuIit0aGlzLnR5cGUsdGhpcy5vcHRpb25zLnNlbGVjdG9yLGEucHJveHkodGhpcy5sZWF2ZSx0aGlzKSl9fXRoaXMub3B0aW9ucy5zZWxlY3Rvcj90aGlzLl9vcHRpb25zPWEuZXh0ZW5kKHt9LHRoaXMub3B0aW9ucyx7dHJpZ2dlcjoibWFudWFsIixzZWxlY3RvcjoiIn0pOnRoaXMuZml4VGl0bGUoKX0sYi5wcm90b3R5cGUuZ2V0RGVmYXVsdHM9ZnVuY3Rpb24oKXtyZXR1cm4gYi5ERUZBVUxUU30sYi5wcm90b3R5cGUuZ2V0T3B0aW9ucz1mdW5jdGlvbihiKXtyZXR1cm4gYj1hLmV4dGVuZCh7fSx0aGlzLmdldERlZmF1bHRzKCksdGhpcy4kZWxlbWVudC5kYXRhKCksYiksYi5kZWxheSYmIm51bWJlciI9PXR5cGVvZiBiLmRlbGF5JiYoYi5kZWxheT17c2hvdzpiLmRlbGF5LGhpZGU6Yi5kZWxheX0pLGJ9LGIucHJvdG90eXBlLmdldERlbGVnYXRlT3B0aW9ucz1mdW5jdGlvbigpe3ZhciBiPXt9LGM9dGhpcy5nZXREZWZhdWx0cygpO3JldHVybiB0aGlzLl9vcHRpb25zJiZhLmVhY2godGhpcy5fb3B0aW9ucyxmdW5jdGlvbihhLGQpe2NbYV0hPWQmJihiW2FdPWQpfSksYn0sYi5wcm90b3R5cGUuZW50ZXI9ZnVuY3Rpb24oYil7dmFyIGM9YiBpbnN0YW5jZW9mIHRoaXMuY29uc3RydWN0b3I/YjphKGIuY3VycmVudFRhcmdldClbdGhpcy50eXBlXSh0aGlzLmdldERlbGVnYXRlT3B0aW9ucygpKS5kYXRhKCJicy4iK3RoaXMudHlwZSk7cmV0dXJuIGNsZWFyVGltZW91dChjLnRpbWVvdXQpLGMuaG92ZXJTdGF0ZT0iaW4iLGMub3B0aW9ucy5kZWxheSYmYy5vcHRpb25zLmRlbGF5LnNob3c/dm9pZChjLnRpbWVvdXQ9c2V0VGltZW91dChmdW5jdGlvbigpeyJpbiI9PWMuaG92ZXJTdGF0ZSYmYy5zaG93KCl9LGMub3B0aW9ucy5kZWxheS5zaG93KSk6Yy5zaG93KCl9LGIucHJvdG90eXBlLmxlYXZlPWZ1bmN0aW9uKGIpe3ZhciBjPWIgaW5zdGFuY2VvZiB0aGlzLmNvbnN0cnVjdG9yP2I6YShiLmN1cnJlbnRUYXJnZXQpW3RoaXMudHlwZV0odGhpcy5nZXREZWxlZ2F0ZU9wdGlvbnMoKSkuZGF0YSgiYnMuIit0aGlzLnR5cGUpO3JldHVybiBjbGVhclRpbWVvdXQoYy50aW1lb3V0KSxjLmhvdmVyU3RhdGU9Im91dCIsYy5vcHRpb25zLmRlbGF5JiZjLm9wdGlvbnMuZGVsYXkuaGlkZT92b2lkKGMudGltZW91dD1zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7Im91dCI9PWMuaG92ZXJTdGF0ZSYmYy5oaWRlKCl9LGMub3B0aW9ucy5kZWxheS5oaWRlKSk6Yy5oaWRlKCl9LGIucHJvdG90eXBlLnNob3c9ZnVuY3Rpb24oKXt2YXIgYj1hLkV2ZW50KCJzaG93LmJzLiIrdGhpcy50eXBlKTtpZih0aGlzLmhhc0NvbnRlbnQoKSYmdGhpcy5lbmFibGVkKXtpZih0aGlzLiRlbGVtZW50LnRyaWdnZXIoYiksYi5pc0RlZmF1bHRQcmV2ZW50ZWQoKSlyZXR1cm47dmFyIGM9dGhpcyxkPXRoaXMudGlwKCk7dGhpcy5zZXRDb250ZW50KCksdGhpcy5vcHRpb25zLmFuaW1hdGlvbiYmZC5hZGRDbGFzcygiZmFkZSIpO3ZhciBlPSJmdW5jdGlvbiI9PXR5cGVvZiB0aGlzLm9wdGlvbnMucGxhY2VtZW50P3RoaXMub3B0aW9ucy5wbGFjZW1lbnQuY2FsbCh0aGlzLGRbMF0sdGhpcy4kZWxlbWVudFswXSk6dGhpcy5vcHRpb25zLnBsYWNlbWVudCxmPS9ccz9hdXRvP1xzPy9pLGc9Zi50ZXN0KGUpO2cmJihlPWUucmVwbGFjZShmLCIiKXx8InRvcCIpLGQuZGV0YWNoKCkuY3NzKHt0b3A6MCxsZWZ0OjAsZGlzcGxheToiYmxvY2sifSkuYWRkQ2xhc3MoZSksdGhpcy5vcHRpb25zLmNvbnRhaW5lcj9kLmFwcGVuZFRvKHRoaXMub3B0aW9ucy5jb250YWluZXIpOmQuaW5zZXJ0QWZ0ZXIodGhpcy4kZWxlbWVudCk7dmFyIGg9dGhpcy5nZXRQb3NpdGlvbigpLGk9ZFswXS5vZmZzZXRXaWR0aCxqPWRbMF0ub2Zmc2V0SGVpZ2h0O2lmKGcpe3ZhciBrPXRoaXMuJGVsZW1lbnQucGFyZW50KCksbD1lLG09ZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcHx8ZG9jdW1lbnQuYm9keS5zY3JvbGxUb3Asbj0iYm9keSI9PXRoaXMub3B0aW9ucy5jb250YWluZXI/d2luZG93LmlubmVyV2lkdGg6ay5vdXRlcldpZHRoKCksbz0iYm9keSI9PXRoaXMub3B0aW9ucy5jb250YWluZXI/d2luZG93LmlubmVySGVpZ2h0Omsub3V0ZXJIZWlnaHQoKSxwPSJib2R5Ij09dGhpcy5vcHRpb25zLmNvbnRhaW5lcj8wOmsub2Zmc2V0KCkubGVmdDtlPSJib3R0b20iPT1lJiZoLnRvcCtoLmhlaWdodCtqLW0+bz8idG9wIjoidG9wIj09ZSYmaC50b3AtbS1qPDA/ImJvdHRvbSI6InJpZ2h0Ij09ZSYmaC5yaWdodCtpPm4/ImxlZnQiOiJsZWZ0Ij09ZSYmaC5sZWZ0LWk8cD8icmlnaHQiOmUsZC5yZW1vdmVDbGFzcyhsKS5hZGRDbGFzcyhlKX12YXIgcT10aGlzLmdldENhbGN1bGF0ZWRPZmZzZXQoZSxoLGksaik7dGhpcy5hcHBseVBsYWNlbWVudChxLGUpLHRoaXMuaG92ZXJTdGF0ZT1udWxsO3ZhciByPWZ1bmN0aW9uKCl7Yy4kZWxlbWVudC50cmlnZ2VyKCJzaG93bi5icy4iK2MudHlwZSl9O2Euc3VwcG9ydC50cmFuc2l0aW9uJiZ0aGlzLiR0aXAuaGFzQ2xhc3MoImZhZGUiKT9kLm9uZShhLnN1cHBvcnQudHJhbnNpdGlvbi5lbmQscikuZW11bGF0ZVRyYW5zaXRpb25FbmQoMTUwKTpyKCl9fSxiLnByb3RvdHlwZS5hcHBseVBsYWNlbWVudD1mdW5jdGlvbihiLGMpe3ZhciBkLGU9dGhpcy50aXAoKSxmPWVbMF0ub2Zmc2V0V2lkdGgsZz1lWzBdLm9mZnNldEhlaWdodCxoPXBhcnNlSW50KGUuY3NzKCJtYXJnaW4tdG9wIiksMTApLGk9cGFyc2VJbnQoZS5jc3MoIm1hcmdpbi1sZWZ0IiksMTApO2lzTmFOKGgpJiYoaD0wKSxpc05hTihpKSYmKGk9MCksYi50b3A9Yi50b3AraCxiLmxlZnQ9Yi5sZWZ0K2ksYS5vZmZzZXQuc2V0T2Zmc2V0KGVbMF0sYS5leHRlbmQoe3VzaW5nOmZ1bmN0aW9uKGEpe2UuY3NzKHt0b3A6TWF0aC5yb3VuZChhLnRvcCksbGVmdDpNYXRoLnJvdW5kKGEubGVmdCl9KX19LGIpLDApLGUuYWRkQ2xhc3MoImluIik7dmFyIGo9ZVswXS5vZmZzZXRXaWR0aCxrPWVbMF0ub2Zmc2V0SGVpZ2h0O2lmKCJ0b3AiPT1jJiZrIT1nJiYoZD0hMCxiLnRvcD1iLnRvcCtnLWspLC9ib3R0b218dG9wLy50ZXN0KGMpKXt2YXIgbD0wO2IubGVmdDwwJiYobD0tMipiLmxlZnQsYi5sZWZ0PTAsZS5vZmZzZXQoYiksaj1lWzBdLm9mZnNldFdpZHRoLGs9ZVswXS5vZmZzZXRIZWlnaHQpLHRoaXMucmVwbGFjZUFycm93KGwtZitqLGosImxlZnQiKX1lbHNlIHRoaXMucmVwbGFjZUFycm93KGstZyxrLCJ0b3AiKTtkJiZlLm9mZnNldChiKX0sYi5wcm90b3R5cGUucmVwbGFjZUFycm93PWZ1bmN0aW9uKGEsYixjKXt0aGlzLmFycm93KCkuY3NzKGMsYT81MCooMS1hL2IpKyIlIjoiIil9LGIucHJvdG90eXBlLnNldENvbnRlbnQ9ZnVuY3Rpb24oKXt2YXIgYT10aGlzLnRpcCgpLGI9dGhpcy5nZXRUaXRsZSgpO2EuZmluZCgiLnRvb2x0aXAtaW5uZXIiKVt0aGlzLm9wdGlvbnMuaHRtbD8iaHRtbCI6InRleHQiXShiKSxhLnJlbW92ZUNsYXNzKCJmYWRlIGluIHRvcCBib3R0b20gbGVmdCByaWdodCIpfSxiLnByb3RvdHlwZS5oaWRlPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gYigpeyJpbiIhPWMuaG92ZXJTdGF0ZSYmZC5kZXRhY2goKSxjLiRlbGVtZW50LnRyaWdnZXIoImhpZGRlbi5icy4iK2MudHlwZSl9dmFyIGM9dGhpcyxkPXRoaXMudGlwKCksZT1hLkV2ZW50KCJoaWRlLmJzLiIrdGhpcy50eXBlKTtyZXR1cm4gdGhpcy4kZWxlbWVudC50cmlnZ2VyKGUpLGUuaXNEZWZhdWx0UHJldmVudGVkKCk/dm9pZCAwOihkLnJlbW92ZUNsYXNzKCJpbiIpLGEuc3VwcG9ydC50cmFuc2l0aW9uJiZ0aGlzLiR0aXAuaGFzQ2xhc3MoImZhZGUiKT9kLm9uZShhLnN1cHBvcnQudHJhbnNpdGlvbi5lbmQsYikuZW11bGF0ZVRyYW5zaXRpb25FbmQoMTUwKTpiKCksdGhpcy5ob3ZlclN0YXRlPW51bGwsdGhpcyl9LGIucHJvdG90eXBlLmZpeFRpdGxlPWZ1bmN0aW9uKCl7dmFyIGE9dGhpcy4kZWxlbWVudDsoYS5hdHRyKCJ0aXRsZSIpfHwic3RyaW5nIiE9dHlwZW9mIGEuYXR0cigiZGF0YS1vcmlnaW5hbC10aXRsZSIpKSYmYS5hdHRyKCJkYXRhLW9yaWdpbmFsLXRpdGxlIixhLmF0dHIoInRpdGxlIil8fCIiKS5hdHRyKCJ0aXRsZSIsIiIpfSxiLnByb3RvdHlwZS5oYXNDb250ZW50PWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZ2V0VGl0bGUoKX0sYi5wcm90b3R5cGUuZ2V0UG9zaXRpb249ZnVuY3Rpb24oKXt2YXIgYj10aGlzLiRlbGVtZW50WzBdO3JldHVybiBhLmV4dGVuZCh7fSwiZnVuY3Rpb24iPT10eXBlb2YgYi5nZXRCb3VuZGluZ0NsaWVudFJlY3Q/Yi5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTp7d2lkdGg6Yi5vZmZzZXRXaWR0aCxoZWlnaHQ6Yi5vZmZzZXRIZWlnaHR9LHRoaXMuJGVsZW1lbnQub2Zmc2V0KCkpfSxiLnByb3RvdHlwZS5nZXRDYWxjdWxhdGVkT2Zmc2V0PWZ1bmN0aW9uKGEsYixjLGQpe3JldHVybiJib3R0b20iPT1hP3t0b3A6Yi50b3ArYi5oZWlnaHQsbGVmdDpiLmxlZnQrYi53aWR0aC8yLWMvMn06InRvcCI9PWE/e3RvcDpiLnRvcC1kLGxlZnQ6Yi5sZWZ0K2Iud2lkdGgvMi1jLzJ9OiJsZWZ0Ij09YT97dG9wOmIudG9wK2IuaGVpZ2h0LzItZC8yLGxlZnQ6Yi5sZWZ0LWN9Ont0b3A6Yi50b3ArYi5oZWlnaHQvMi1kLzIsbGVmdDpiLmxlZnQrYi53aWR0aH19LGIucHJvdG90eXBlLmdldFRpdGxlPWZ1bmN0aW9uKCl7dmFyIGEsYj10aGlzLiRlbGVtZW50LGM9dGhpcy5vcHRpb25zO3JldHVybiBhPWIuYXR0cigiZGF0YS1vcmlnaW5hbC10aXRsZSIpfHwoImZ1bmN0aW9uIj09dHlwZW9mIGMudGl0bGU/Yy50aXRsZS5jYWxsKGJbMF0pOmMudGl0bGUpfSxiLnByb3RvdHlwZS50aXA9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy4kdGlwPXRoaXMuJHRpcHx8YSh0aGlzLm9wdGlvbnMudGVtcGxhdGUpfSxiLnByb3RvdHlwZS5hcnJvdz1mdW5jdGlvbigpe3JldHVybiB0aGlzLiRhcnJvdz10aGlzLiRhcnJvd3x8dGhpcy50aXAoKS5maW5kKCIudG9vbHRpcC1hcnJvdyIpfSxiLnByb3RvdHlwZS52YWxpZGF0ZT1mdW5jdGlvbigpe3RoaXMuJGVsZW1lbnRbMF0ucGFyZW50Tm9kZXx8KHRoaXMuaGlkZSgpLHRoaXMuJGVsZW1lbnQ9bnVsbCx0aGlzLm9wdGlvbnM9bnVsbCl9LGIucHJvdG90eXBlLmVuYWJsZT1mdW5jdGlvbigpe3RoaXMuZW5hYmxlZD0hMH0sYi5wcm90b3R5cGUuZGlzYWJsZT1mdW5jdGlvbigpe3RoaXMuZW5hYmxlZD0hMX0sYi5wcm90b3R5cGUudG9nZ2xlRW5hYmxlZD1mdW5jdGlvbigpe3RoaXMuZW5hYmxlZD0hdGhpcy5lbmFibGVkfSxiLnByb3RvdHlwZS50b2dnbGU9ZnVuY3Rpb24oYil7dmFyIGM9Yj9hKGIuY3VycmVudFRhcmdldClbdGhpcy50eXBlXSh0aGlzLmdldERlbGVnYXRlT3B0aW9ucygpKS5kYXRhKCJicy4iK3RoaXMudHlwZSk6dGhpcztjLnRpcCgpLmhhc0NsYXNzKCJpbiIpP2MubGVhdmUoYyk6Yy5lbnRlcihjKX0sYi5wcm90b3R5cGUuZGVzdHJveT1mdW5jdGlvbigpe2NsZWFyVGltZW91dCh0aGlzLnRpbWVvdXQpLHRoaXMuaGlkZSgpLiRlbGVtZW50Lm9mZigiLiIrdGhpcy50eXBlKS5yZW1vdmVEYXRhKCJicy4iK3RoaXMudHlwZSl9O3ZhciBjPWEuZm4udG9vbHRpcDthLmZuLnRvb2x0aXA9ZnVuY3Rpb24oYyl7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBkPWEodGhpcyksZT1kLmRhdGEoImJzLnRvb2x0aXAiKSxmPSJvYmplY3QiPT10eXBlb2YgYyYmYzsoZXx8ImRlc3Ryb3kiIT1jKSYmKGV8fGQuZGF0YSgiYnMudG9vbHRpcCIsZT1uZXcgYih0aGlzLGYpKSwic3RyaW5nIj09dHlwZW9mIGMmJmVbY10oKSl9KX0sYS5mbi50b29sdGlwLkNvbnN0cnVjdG9yPWIsYS5mbi50b29sdGlwLm5vQ29uZmxpY3Q9ZnVuY3Rpb24oKXtyZXR1cm4gYS5mbi50b29sdGlwPWMsdGhpc319KGpRdWVyeSksK2Z1bmN0aW9uKGEpe3ZhciBiPWZ1bmN0aW9uKGEsYil7dGhpcy5pbml0KCJwb3BvdmVyIixhLGIpfTtpZighYS5mbi50b29sdGlwKXRocm93IG5ldyBFcnJvcigiUG9wb3ZlciByZXF1aXJlcyB0b29sdGlwLmpzIik7Yi5ERUZBVUxUUz1hLmV4dGVuZCh7fSxhLmZuLnRvb2x0aXAuQ29uc3RydWN0b3IuREVGQVVMVFMse3BsYWNlbWVudDoicmlnaHQiLHRyaWdnZXI6ImNsaWNrIixjb250ZW50OiIiLHRlbXBsYXRlOic8ZGl2IGNsYXNzPSJwb3BvdmVyIj48ZGl2IGNsYXNzPSJhcnJvdyI+PC9kaXY+PGgzIGNsYXNzPSJwb3BvdmVyLXRpdGxlIj48L2gzPjxkaXYgY2xhc3M9InBvcG92ZXItY29udGVudCI+PC9kaXY+PC9kaXY+J30pLGIucHJvdG90eXBlPWEuZXh0ZW5kKHt9LGEuZm4udG9vbHRpcC5Db25zdHJ1Y3Rvci5wcm90b3R5cGUpLGIucHJvdG90eXBlLmNvbnN0cnVjdG9yPWIsYi5wcm90b3R5cGUuZ2V0RGVmYXVsdHM9ZnVuY3Rpb24oKXtyZXR1cm4gYi5ERUZBVUxUU30sYi5wcm90b3R5cGUuc2V0Q29udGVudD1mdW5jdGlvbigpe3ZhciBhPXRoaXMudGlwKCksYj10aGlzLmdldFRpdGxlKCksYz10aGlzLmdldENvbnRlbnQoKTthLmZpbmQoIi5wb3BvdmVyLXRpdGxlIilbdGhpcy5vcHRpb25zLmh0bWw/Imh0bWwiOiJ0ZXh0Il0oYiksYS5maW5kKCIucG9wb3Zlci1jb250ZW50IilbdGhpcy5vcHRpb25zLmh0bWw/InN0cmluZyI9PXR5cGVvZiBjPyJodG1sIjoiYXBwZW5kIjoidGV4dCJdKGMpLGEucmVtb3ZlQ2xhc3MoImZhZGUgdG9wIGJvdHRvbSBsZWZ0IHJpZ2h0IGluIiksYS5maW5kKCIucG9wb3Zlci10aXRsZSIpLmh0bWwoKXx8YS5maW5kKCIucG9wb3Zlci10aXRsZSIpLmhpZGUoKX0sYi5wcm90b3R5cGUuaGFzQ29udGVudD1mdW5jdGlvbigpe3JldHVybiB0aGlzLmdldFRpdGxlKCl8fHRoaXMuZ2V0Q29udGVudCgpfSxiLnByb3RvdHlwZS5nZXRDb250ZW50PWZ1bmN0aW9uKCl7dmFyIGE9dGhpcy4kZWxlbWVudCxiPXRoaXMub3B0aW9ucztyZXR1cm4gYS5hdHRyKCJkYXRhLWNvbnRlbnQiKXx8KCJmdW5jdGlvbiI9PXR5cGVvZiBiLmNvbnRlbnQ/Yi5jb250ZW50LmNhbGwoYVswXSk6Yi5jb250ZW50KX0sYi5wcm90b3R5cGUuYXJyb3c9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy4kYXJyb3c9dGhpcy4kYXJyb3d8fHRoaXMudGlwKCkuZmluZCgiLmFycm93Iil9LGIucHJvdG90eXBlLnRpcD1mdW5jdGlvbigpe3JldHVybiB0aGlzLiR0aXB8fCh0aGlzLiR0aXA9YSh0aGlzLm9wdGlvbnMudGVtcGxhdGUpKSx0aGlzLiR0aXB9O3ZhciBjPWEuZm4ucG9wb3ZlcjthLmZuLnBvcG92ZXI9ZnVuY3Rpb24oYyl7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBkPWEodGhpcyksZT1kLmRhdGEoImJzLnBvcG92ZXIiKSxmPSJvYmplY3QiPT10eXBlb2YgYyYmYzsoZXx8ImRlc3Ryb3kiIT1jKSYmKGV8fGQuZGF0YSgiYnMucG9wb3ZlciIsZT1uZXcgYih0aGlzLGYpKSwic3RyaW5nIj09dHlwZW9mIGMmJmVbY10oKSl9KX0sYS5mbi5wb3BvdmVyLkNvbnN0cnVjdG9yPWIsYS5mbi5wb3BvdmVyLm5vQ29uZmxpY3Q9ZnVuY3Rpb24oKXtyZXR1cm4gYS5mbi5wb3BvdmVyPWMsdGhpc319KGpRdWVyeSksK2Z1bmN0aW9uKGEpe2Z1bmN0aW9uIGIoYyxkKXt2YXIgZSxmPWEucHJveHkodGhpcy5wcm9jZXNzLHRoaXMpO3RoaXMuJGVsZW1lbnQ9YShhKGMpLmlzKCJib2R5Iik/d2luZG93OmMpLHRoaXMuJGJvZHk9YSgiYm9keSIpLHRoaXMuJHNjcm9sbEVsZW1lbnQ9dGhpcy4kZWxlbWVudC5vbigic2Nyb2xsLmJzLnNjcm9sbC1zcHkuZGF0YS1hcGkiLGYpLHRoaXMub3B0aW9ucz1hLmV4dGVuZCh7fSxiLkRFRkFVTFRTLGQpLHRoaXMuc2VsZWN0b3I9KHRoaXMub3B0aW9ucy50YXJnZXR8fChlPWEoYykuYXR0cigiaHJlZiIpKSYmZS5yZXBsYWNlKC8uKig/PSNbXlxzXSskKS8sIiIpfHwiIikrIiAubmF2IGxpID4gYSIsdGhpcy5vZmZzZXRzPWEoW10pLHRoaXMudGFyZ2V0cz1hKFtdKSx0aGlzLmFjdGl2ZVRhcmdldD1udWxsLHRoaXMucmVmcmVzaCgpLHRoaXMucHJvY2VzcygpfWIuREVGQVVMVFM9e29mZnNldDoxMH0sYi5wcm90b3R5cGUucmVmcmVzaD1mdW5jdGlvbigpe3ZhciBiPXRoaXMuJGVsZW1lbnRbMF09PXdpbmRvdz8ib2Zmc2V0IjoicG9zaXRpb24iO3RoaXMub2Zmc2V0cz1hKFtdKSx0aGlzLnRhcmdldHM9YShbXSk7e3ZhciBjPXRoaXM7dGhpcy4kYm9keS5maW5kKHRoaXMuc2VsZWN0b3IpLm1hcChmdW5jdGlvbigpe3ZhciBkPWEodGhpcyksZT1kLmRhdGEoInRhcmdldCIpfHxkLmF0dHIoImhyZWYiKSxmPS9eIy4vLnRlc3QoZSkmJmEoZSk7cmV0dXJuIGYmJmYubGVuZ3RoJiZmLmlzKCI6dmlzaWJsZSIpJiZbW2ZbYl0oKS50b3ArKCFhLmlzV2luZG93KGMuJHNjcm9sbEVsZW1lbnQuZ2V0KDApKSYmYy4kc2Nyb2xsRWxlbWVudC5zY3JvbGxUb3AoKSksZV1dfHxudWxsfSkuc29ydChmdW5jdGlvbihhLGIpe3JldHVybiBhWzBdLWJbMF19KS5lYWNoKGZ1bmN0aW9uKCl7Yy5vZmZzZXRzLnB1c2godGhpc1swXSksYy50YXJnZXRzLnB1c2godGhpc1sxXSl9KX19LGIucHJvdG90eXBlLnByb2Nlc3M9ZnVuY3Rpb24oKXt2YXIgYSxiPXRoaXMuJHNjcm9sbEVsZW1lbnQuc2Nyb2xsVG9wKCkrdGhpcy5vcHRpb25zLm9mZnNldCxjPXRoaXMuJHNjcm9sbEVsZW1lbnRbMF0uc2Nyb2xsSGVpZ2h0fHx0aGlzLiRib2R5WzBdLnNjcm9sbEhlaWdodCxkPWMtdGhpcy4kc2Nyb2xsRWxlbWVudC5oZWlnaHQoKSxlPXRoaXMub2Zmc2V0cyxmPXRoaXMudGFyZ2V0cyxnPXRoaXMuYWN0aXZlVGFyZ2V0O2lmKGI+PWQpcmV0dXJuIGchPShhPWYubGFzdCgpWzBdKSYmdGhpcy5hY3RpdmF0ZShhKTtpZihnJiZiPD1lWzBdKXJldHVybiBnIT0oYT1mWzBdKSYmdGhpcy5hY3RpdmF0ZShhKTtmb3IoYT1lLmxlbmd0aDthLS07KWchPWZbYV0mJmI+PWVbYV0mJighZVthKzFdfHxiPD1lW2ErMV0pJiZ0aGlzLmFjdGl2YXRlKGZbYV0pfSxiLnByb3RvdHlwZS5hY3RpdmF0ZT1mdW5jdGlvbihiKXt0aGlzLmFjdGl2ZVRhcmdldD1iLGEodGhpcy5zZWxlY3RvcikucGFyZW50c1VudGlsKHRoaXMub3B0aW9ucy50YXJnZXQsIi5hY3RpdmUiKS5yZW1vdmVDbGFzcygiYWN0aXZlIik7dmFyIGM9dGhpcy5zZWxlY3RvcisnW2RhdGEtdGFyZ2V0PSInK2IrJyJdLCcrdGhpcy5zZWxlY3RvcisnW2hyZWY9IicrYisnIl0nLGQ9YShjKS5wYXJlbnRzKCJsaSIpLmFkZENsYXNzKCJhY3RpdmUiKTtkLnBhcmVudCgiLmRyb3Bkb3duLW1lbnUiKS5sZW5ndGgmJihkPWQuY2xvc2VzdCgibGkuZHJvcGRvd24iKS5hZGRDbGFzcygiYWN0aXZlIikpLGQudHJpZ2dlcigiYWN0aXZhdGUuYnMuc2Nyb2xsc3B5Iil9O3ZhciBjPWEuZm4uc2Nyb2xsc3B5O2EuZm4uc2Nyb2xsc3B5PWZ1bmN0aW9uKGMpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgZD1hKHRoaXMpLGU9ZC5kYXRhKCJicy5zY3JvbGxzcHkiKSxmPSJvYmplY3QiPT10eXBlb2YgYyYmYztlfHxkLmRhdGEoImJzLnNjcm9sbHNweSIsZT1uZXcgYih0aGlzLGYpKSwic3RyaW5nIj09dHlwZW9mIGMmJmVbY10oKX0pfSxhLmZuLnNjcm9sbHNweS5Db25zdHJ1Y3Rvcj1iLGEuZm4uc2Nyb2xsc3B5Lm5vQ29uZmxpY3Q9ZnVuY3Rpb24oKXtyZXR1cm4gYS5mbi5zY3JvbGxzcHk9Yyx0aGlzfSxhKHdpbmRvdykub24oImxvYWQiLGZ1bmN0aW9uKCl7YSgnW2RhdGEtc3B5PSJzY3JvbGwiXScpLmVhY2goZnVuY3Rpb24oKXt2YXIgYj1hKHRoaXMpO2Iuc2Nyb2xsc3B5KGIuZGF0YSgpKX0pfSl9KGpRdWVyeSksK2Z1bmN0aW9uKGEpe3ZhciBiPWZ1bmN0aW9uKGIpe3RoaXMuZWxlbWVudD1hKGIpfTtiLnByb3RvdHlwZS5zaG93PWZ1bmN0aW9uKCl7dmFyIGI9dGhpcy5lbGVtZW50LGM9Yi5jbG9zZXN0KCJ1bDpub3QoLmRyb3Bkb3duLW1lbnUpIiksZD1iLmRhdGEoInRhcmdldCIpO2lmKGR8fChkPWIuYXR0cigiaHJlZiIpLGQ9ZCYmZC5yZXBsYWNlKC8uKig/PSNbXlxzXSokKS8sIiIpKSwhYi5wYXJlbnQoImxpIikuaGFzQ2xhc3MoImFjdGl2ZSIpKXt2YXIgZT1jLmZpbmQoIi5hY3RpdmU6bGFzdCBhIilbMF0sZj1hLkV2ZW50KCJzaG93LmJzLnRhYiIse3JlbGF0ZWRUYXJnZXQ6ZX0pO2lmKGIudHJpZ2dlcihmKSwhZi5pc0RlZmF1bHRQcmV2ZW50ZWQoKSl7dmFyIGc9YShkKTt0aGlzLmFjdGl2YXRlKGIucGFyZW50KCJsaSIpLGMpLHRoaXMuYWN0aXZhdGUoZyxnLnBhcmVudCgpLGZ1bmN0aW9uKCl7Yi50cmlnZ2VyKHt0eXBlOiJzaG93bi5icy50YWIiLHJlbGF0ZWRUYXJnZXQ6ZX0pfSl9fX0sYi5wcm90b3R5cGUuYWN0aXZhdGU9ZnVuY3Rpb24oYixjLGQpe2Z1bmN0aW9uIGUoKXtmLnJlbW92ZUNsYXNzKCJhY3RpdmUiKS5maW5kKCI+IC5kcm9wZG93bi1tZW51ID4gLmFjdGl2ZSIpLnJlbW92ZUNsYXNzKCJhY3RpdmUiKSxiLmFkZENsYXNzKCJhY3RpdmUiKSxnPyhiWzBdLm9mZnNldFdpZHRoLGIuYWRkQ2xhc3MoImluIikpOmIucmVtb3ZlQ2xhc3MoImZhZGUiKSxiLnBhcmVudCgiLmRyb3Bkb3duLW1lbnUiKSYmYi5jbG9zZXN0KCJsaS5kcm9wZG93biIpLmFkZENsYXNzKCJhY3RpdmUiKSxkJiZkKCl9dmFyIGY9Yy5maW5kKCI+IC5hY3RpdmUiKSxnPWQmJmEuc3VwcG9ydC50cmFuc2l0aW9uJiZmLmhhc0NsYXNzKCJmYWRlIik7Zz9mLm9uZShhLnN1cHBvcnQudHJhbnNpdGlvbi5lbmQsZSkuZW11bGF0ZVRyYW5zaXRpb25FbmQoMTUwKTplKCksZi5yZW1vdmVDbGFzcygiaW4iKX07dmFyIGM9YS5mbi50YWI7YS5mbi50YWI9ZnVuY3Rpb24oYyl7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBkPWEodGhpcyksZT1kLmRhdGEoImJzLnRhYiIpO2V8fGQuZGF0YSgiYnMudGFiIixlPW5ldyBiKHRoaXMpKSwic3RyaW5nIj09dHlwZW9mIGMmJmVbY10oKX0pfSxhLmZuLnRhYi5Db25zdHJ1Y3Rvcj1iLGEuZm4udGFiLm5vQ29uZmxpY3Q9ZnVuY3Rpb24oKXtyZXR1cm4gYS5mbi50YWI9Yyx0aGlzfSxhKGRvY3VtZW50KS5vbigiY2xpY2suYnMudGFiLmRhdGEtYXBpIiwnW2RhdGEtdG9nZ2xlPSJ0YWIiXSwgW2RhdGEtdG9nZ2xlPSJwaWxsIl0nLGZ1bmN0aW9uKGIpe2IucHJldmVudERlZmF1bHQoKSxhKHRoaXMpLnRhYigic2hvdyIpfSl9KGpRdWVyeSksK2Z1bmN0aW9uKGEpe3ZhciBiPWZ1bmN0aW9uKGMsZCl7dGhpcy5vcHRpb25zPWEuZXh0ZW5kKHt9LGIuREVGQVVMVFMsZCksdGhpcy4kd2luZG93PWEod2luZG93KS5vbigic2Nyb2xsLmJzLmFmZml4LmRhdGEtYXBpIixhLnByb3h5KHRoaXMuY2hlY2tQb3NpdGlvbix0aGlzKSkub24oImNsaWNrLmJzLmFmZml4LmRhdGEtYXBpIixhLnByb3h5KHRoaXMuY2hlY2tQb3NpdGlvbldpdGhFdmVudExvb3AsdGhpcykpLHRoaXMuJGVsZW1lbnQ9YShjKSx0aGlzLmFmZml4ZWQ9dGhpcy51bnBpbj10aGlzLnBpbm5lZE9mZnNldD1udWxsLHRoaXMuY2hlY2tQb3NpdGlvbigpfTtiLlJFU0VUPSJhZmZpeCBhZmZpeC10b3AgYWZmaXgtYm90dG9tIixiLkRFRkFVTFRTPXtvZmZzZXQ6MH0sYi5wcm90b3R5cGUuZ2V0UGlubmVkT2Zmc2V0PWZ1bmN0aW9uKCl7aWYodGhpcy5waW5uZWRPZmZzZXQpcmV0dXJuIHRoaXMucGlubmVkT2Zmc2V0O3RoaXMuJGVsZW1lbnQucmVtb3ZlQ2xhc3MoYi5SRVNFVCkuYWRkQ2xhc3MoImFmZml4Iik7dmFyIGE9dGhpcy4kd2luZG93LnNjcm9sbFRvcCgpLGM9dGhpcy4kZWxlbWVudC5vZmZzZXQoKTtyZXR1cm4gdGhpcy5waW5uZWRPZmZzZXQ9Yy50b3AtYX0sYi5wcm90b3R5cGUuY2hlY2tQb3NpdGlvbldpdGhFdmVudExvb3A9ZnVuY3Rpb24oKXtzZXRUaW1lb3V0KGEucHJveHkodGhpcy5jaGVja1Bvc2l0aW9uLHRoaXMpLDEpfSxiLnByb3RvdHlwZS5jaGVja1Bvc2l0aW9uPWZ1bmN0aW9uKCl7aWYodGhpcy4kZWxlbWVudC5pcygiOnZpc2libGUiKSl7dmFyIGM9YShkb2N1bWVudCkuaGVpZ2h0KCksZD10aGlzLiR3aW5kb3cuc2Nyb2xsVG9wKCksZT10aGlzLiRlbGVtZW50Lm9mZnNldCgpLGY9dGhpcy5vcHRpb25zLm9mZnNldCxnPWYudG9wLGg9Zi5ib3R0b207InRvcCI9PXRoaXMuYWZmaXhlZCYmKGUudG9wKz1kKSwib2JqZWN0IiE9dHlwZW9mIGYmJihoPWc9ZiksImZ1bmN0aW9uIj09dHlwZW9mIGcmJihnPWYudG9wKHRoaXMuJGVsZW1lbnQpKSwiZnVuY3Rpb24iPT10eXBlb2YgaCYmKGg9Zi5ib3R0b20odGhpcy4kZWxlbWVudCkpO3ZhciBpPW51bGwhPXRoaXMudW5waW4mJmQrdGhpcy51bnBpbjw9ZS50b3A/ITE6bnVsbCE9aCYmZS50b3ArdGhpcy4kZWxlbWVudC5oZWlnaHQoKT49Yy1oPyJib3R0b20iOm51bGwhPWcmJmc+PWQ/InRvcCI6ITE7aWYodGhpcy5hZmZpeGVkIT09aSl7dGhpcy51bnBpbiYmdGhpcy4kZWxlbWVudC5jc3MoInRvcCIsIiIpO3ZhciBqPSJhZmZpeCIrKGk/Ii0iK2k6IiIpLGs9YS5FdmVudChqKyIuYnMuYWZmaXgiKTt0aGlzLiRlbGVtZW50LnRyaWdnZXIoayksay5pc0RlZmF1bHRQcmV2ZW50ZWQoKXx8KHRoaXMuYWZmaXhlZD1pLHRoaXMudW5waW49ImJvdHRvbSI9PWk/dGhpcy5nZXRQaW5uZWRPZmZzZXQoKTpudWxsLHRoaXMuJGVsZW1lbnQucmVtb3ZlQ2xhc3MoYi5SRVNFVCkuYWRkQ2xhc3MoaikudHJpZ2dlcihhLkV2ZW50KGoucmVwbGFjZSgiYWZmaXgiLCJhZmZpeGVkIikpKSwiYm90dG9tIj09aSYmdGhpcy4kZWxlbWVudC5vZmZzZXQoe3RvcDpjLWgtdGhpcy4kZWxlbWVudC5oZWlnaHQoKX0pKX19fTt2YXIgYz1hLmZuLmFmZml4O2EuZm4uYWZmaXg9ZnVuY3Rpb24oYyl7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBkPWEodGhpcyksZT1kLmRhdGEoImJzLmFmZml4IiksZj0ib2JqZWN0Ij09dHlwZW9mIGMmJmM7ZXx8ZC5kYXRhKCJicy5hZmZpeCIsZT1uZXcgYih0aGlzLGYpKSwic3RyaW5nIj09dHlwZW9mIGMmJmVbY10oKX0pfSxhLmZuLmFmZml4LkNvbnN0cnVjdG9yPWIsYS5mbi5hZmZpeC5ub0NvbmZsaWN0PWZ1bmN0aW9uKCl7cmV0dXJuIGEuZm4uYWZmaXg9Yyx0aGlzfSxhKHdpbmRvdykub24oImxvYWQiLGZ1bmN0aW9uKCl7YSgnW2RhdGEtc3B5PSJhZmZpeCJdJykuZWFjaChmdW5jdGlvbigpe3ZhciBiPWEodGhpcyksYz1iLmRhdGEoKTtjLm9mZnNldD1jLm9mZnNldHx8e30sYy5vZmZzZXRCb3R0b20mJihjLm9mZnNldC5ib3R0b209Yy5vZmZzZXRCb3R0b20pLGMub2Zmc2V0VG9wJiYoYy5vZmZzZXQudG9wPWMub2Zmc2V0VG9wKSxiLmFmZml4KGMpfSl9KX0oalF1ZXJ5KTsKZGVmaW5lKCJib290c3RyYXAiLCBbImpxdWVyeSJdLCAoZnVuY3Rpb24gKGdsb2JhbCkgewogICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gZ2xvYmFsLmJvb3RzdHJhcDsKICAgIH0KfSh0aGlzKSkpOwoKLyohCiAqIHR5cGVhaGVhZC5qcyAwLjEwLjIKICogaHR0cHM6Ly9naXRodWIuY29tL3R3aXR0ZXIvdHlwZWFoZWFkLmpzCiAqIENvcHlyaWdodCAyMDEzLTIwMTQgVHdpdHRlciwgSW5jLiBhbmQgb3RoZXIgY29udHJpYnV0b3JzOyBMaWNlbnNlZCBNSVQKICovCgooZnVuY3Rpb24oJCkgewogICAgdmFyIF8gPSB7CiAgICAgICAgaXNNc2llOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIC8obXNpZXx0cmlkZW50KS9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkgPyBuYXZpZ2F0b3IudXNlckFnZW50Lm1hdGNoKC8obXNpZSB8cnY6KShcZCsoLlxkKyk/KS9pKVsyXSA6IGZhbHNlOwogICAgICAgIH0sCiAgICAgICAgaXNCbGFua1N0cmluZzogZnVuY3Rpb24oc3RyKSB7CiAgICAgICAgICAgIHJldHVybiAhc3RyIHx8IC9eXHMqJC8udGVzdChzdHIpOwogICAgICAgIH0sCiAgICAgICAgZXNjYXBlUmVnRXhDaGFyczogZnVuY3Rpb24oc3RyKSB7CiAgICAgICAgICAgIHJldHVybiBzdHIucmVwbGFjZSgvW1wtXFtcXVwvXHtcfVwoXClcKlwrXD9cLlxcXF5cJFx8XS9nLCAiXFwkJiIpOwogICAgICAgIH0sCiAgICAgICAgaXNTdHJpbmc6IGZ1bmN0aW9uKG9iaikgewogICAgICAgICAgICByZXR1cm4gdHlwZW9mIG9iaiA9PT0gInN0cmluZyI7CiAgICAgICAgfSwKICAgICAgICBpc051bWJlcjogZnVuY3Rpb24ob2JqKSB7CiAgICAgICAgICAgIHJldHVybiB0eXBlb2Ygb2JqID09PSAibnVtYmVyIjsKICAgICAgICB9LAogICAgICAgIGlzQXJyYXk6ICQuaXNBcnJheSwKICAgICAgICBpc0Z1bmN0aW9uOiAkLmlzRnVuY3Rpb24sCiAgICAgICAgaXNPYmplY3Q6ICQuaXNQbGFpbk9iamVjdCwKICAgICAgICBpc1VuZGVmaW5lZDogZnVuY3Rpb24ob2JqKSB7CiAgICAgICAgICAgIHJldHVybiB0eXBlb2Ygb2JqID09PSAidW5kZWZpbmVkIjsKICAgICAgICB9LAogICAgICAgIGJpbmQ6ICQucHJveHksCiAgICAgICAgZWFjaDogZnVuY3Rpb24oY29sbGVjdGlvbiwgY2IpIHsKICAgICAgICAgICAgJC5lYWNoKGNvbGxlY3Rpb24sIHJldmVyc2VBcmdzKTsKICAgICAgICAgICAgZnVuY3Rpb24gcmV2ZXJzZUFyZ3MoaW5kZXgsIHZhbHVlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gY2IodmFsdWUsIGluZGV4KTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgbWFwOiAkLm1hcCwKICAgICAgICBmaWx0ZXI6ICQuZ3JlcCwKICAgICAgICBldmVyeTogZnVuY3Rpb24ob2JqLCB0ZXN0KSB7CiAgICAgICAgICAgIHZhciByZXN1bHQgPSB0cnVlOwogICAgICAgICAgICBpZiAoIW9iaikgewogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICAgICAgfQogICAgICAgICAgICAkLmVhY2gob2JqLCBmdW5jdGlvbihrZXksIHZhbCkgewogICAgICAgICAgICAgICAgaWYgKCEocmVzdWx0ID0gdGVzdC5jYWxsKG51bGwsIHZhbCwga2V5LCBvYmopKSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiAhIXJlc3VsdDsKICAgICAgICB9LAogICAgICAgIHNvbWU6IGZ1bmN0aW9uKG9iaiwgdGVzdCkgewogICAgICAgICAgICB2YXIgcmVzdWx0ID0gZmFsc2U7CiAgICAgICAgICAgIGlmICghb2JqKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgICAgICB9CiAgICAgICAgICAgICQuZWFjaChvYmosIGZ1bmN0aW9uKGtleSwgdmFsKSB7CiAgICAgICAgICAgICAgICBpZiAocmVzdWx0ID0gdGVzdC5jYWxsKG51bGwsIHZhbCwga2V5LCBvYmopKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuICEhcmVzdWx0OwogICAgICAgIH0sCiAgICAgICAgbWl4aW46ICQuZXh0ZW5kLAogICAgICAgIGdldFVuaXF1ZUlkOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIGNvdW50ZXIgPSAwOwogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gY291bnRlcisrOwogICAgICAgICAgICB9OwogICAgICAgIH0oKSwKICAgICAgICB0ZW1wbGF0aWZ5OiBmdW5jdGlvbiB0ZW1wbGF0aWZ5KG9iaikgewogICAgICAgICAgICByZXR1cm4gJC5pc0Z1bmN0aW9uKG9iaikgPyBvYmogOiB0ZW1wbGF0ZTsKICAgICAgICAgICAgZnVuY3Rpb24gdGVtcGxhdGUoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gU3RyaW5nKG9iaik7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGRlZmVyOiBmdW5jdGlvbihmbikgewogICAgICAgICAgICBzZXRUaW1lb3V0KGZuLCAwKTsKICAgICAgICB9LAogICAgICAgIGRlYm91bmNlOiBmdW5jdGlvbihmdW5jLCB3YWl0LCBpbW1lZGlhdGUpIHsKICAgICAgICAgICAgdmFyIHRpbWVvdXQsIHJlc3VsdDsKICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdmFyIGNvbnRleHQgPSB0aGlzLCBhcmdzID0gYXJndW1lbnRzLCBsYXRlciwgY2FsbE5vdzsKICAgICAgICAgICAgICAgIGxhdGVyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdGltZW91dCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFpbW1lZGlhdGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgY2FsbE5vdyA9IGltbWVkaWF0ZSAmJiAhdGltZW91dDsKICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0KTsKICAgICAgICAgICAgICAgIHRpbWVvdXQgPSBzZXRUaW1lb3V0KGxhdGVyLCB3YWl0KTsKICAgICAgICAgICAgICAgIGlmIChjYWxsTm93KSB7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgICAgIH07CiAgICAgICAgfSwKICAgICAgICB0aHJvdHRsZTogZnVuY3Rpb24oZnVuYywgd2FpdCkgewogICAgICAgICAgICB2YXIgY29udGV4dCwgYXJncywgdGltZW91dCwgcmVzdWx0LCBwcmV2aW91cywgbGF0ZXI7CiAgICAgICAgICAgIHByZXZpb3VzID0gMDsKICAgICAgICAgICAgbGF0ZXIgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHByZXZpb3VzID0gbmV3IERhdGUoKTsKICAgICAgICAgICAgICAgIHRpbWVvdXQgPSBudWxsOwogICAgICAgICAgICAgICAgcmVzdWx0ID0gZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdmFyIG5vdyA9IG5ldyBEYXRlKCksIHJlbWFpbmluZyA9IHdhaXQgLSAobm93IC0gcHJldmlvdXMpOwogICAgICAgICAgICAgICAgY29udGV4dCA9IHRoaXM7CiAgICAgICAgICAgICAgICBhcmdzID0gYXJndW1lbnRzOwogICAgICAgICAgICAgICAgaWYgKHJlbWFpbmluZyA8PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXQpOwogICAgICAgICAgICAgICAgICAgIHRpbWVvdXQgPSBudWxsOwogICAgICAgICAgICAgICAgICAgIHByZXZpb3VzID0gbm93OwogICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IGZ1bmMuYXBwbHkoY29udGV4dCwgYXJncyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCF0aW1lb3V0KSB7CiAgICAgICAgICAgICAgICAgICAgdGltZW91dCA9IHNldFRpbWVvdXQobGF0ZXIsIHJlbWFpbmluZyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgICAgICB9OwogICAgICAgIH0sCiAgICAgICAgbm9vcDogZnVuY3Rpb24oKSB7fQogICAgfTsKICAgIHZhciBodG1sID0gewogICAgICAgIHdyYXBwZXI6ICc8c3BhbiBjbGFzcz0idHdpdHRlci10eXBlYWhlYWQiPjwvc3Bhbj4nLAogICAgICAgIGRyb3Bkb3duOiAnPHNwYW4gY2xhc3M9InR0LWRyb3Bkb3duLW1lbnUiPjwvc3Bhbj4nLAogICAgICAgIGRhdGFzZXQ6ICc8ZGl2IGNsYXNzPSJ0dC1kYXRhc2V0LSVDTEFTUyUiPjwvZGl2PicsCiAgICAgICAgc3VnZ2VzdGlvbnM6ICc8c3BhbiBjbGFzcz0idHQtc3VnZ2VzdGlvbnMiPjwvc3Bhbj4nLAogICAgICAgIHN1Z2dlc3Rpb246ICc8ZGl2IGNsYXNzPSJ0dC1zdWdnZXN0aW9uIj48L2Rpdj4nCiAgICB9OwogICAgdmFyIGNzcyA9IHsKICAgICAgICB3cmFwcGVyOiB7CiAgICAgICAgICAgIHBvc2l0aW9uOiAicmVsYXRpdmUiLAogICAgICAgICAgICBkaXNwbGF5OiAiaW5saW5lLWJsb2NrIgogICAgICAgIH0sCiAgICAgICAgaGludDogewogICAgICAgICAgICBwb3NpdGlvbjogImFic29sdXRlIiwKICAgICAgICAgICAgdG9wOiAiMCIsCiAgICAgICAgICAgIGxlZnQ6ICIwIiwKICAgICAgICAgICAgYm9yZGVyQ29sb3I6ICJ0cmFuc3BhcmVudCIsCiAgICAgICAgICAgIGJveFNoYWRvdzogIm5vbmUiCiAgICAgICAgfSwKICAgICAgICBpbnB1dDogewogICAgICAgICAgICBwb3NpdGlvbjogInJlbGF0aXZlIiwKICAgICAgICAgICAgdmVydGljYWxBbGlnbjogInRvcCIsCiAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogInRyYW5zcGFyZW50IgogICAgICAgIH0sCiAgICAgICAgaW5wdXRXaXRoTm9IaW50OiB7CiAgICAgICAgICAgIHBvc2l0aW9uOiAicmVsYXRpdmUiLAogICAgICAgICAgICB2ZXJ0aWNhbEFsaWduOiAidG9wIgogICAgICAgIH0sCiAgICAgICAgZHJvcGRvd246IHsKICAgICAgICAgICAgcG9zaXRpb246ICJhYnNvbHV0ZSIsCiAgICAgICAgICAgIHRvcDogIjEwMCUiLAogICAgICAgICAgICBsZWZ0OiAiMCIsCiAgICAgICAgICAgIHpJbmRleDogIjEwMCIsCiAgICAgICAgICAgIGRpc3BsYXk6ICJub25lIgogICAgICAgIH0sCiAgICAgICAgc3VnZ2VzdGlvbnM6IHsKICAgICAgICAgICAgZGlzcGxheTogImJsb2NrIgogICAgICAgIH0sCiAgICAgICAgc3VnZ2VzdGlvbjogewogICAgICAgICAgICB3aGl0ZVNwYWNlOiAibm93cmFwIiwKICAgICAgICAgICAgY3Vyc29yOiAicG9pbnRlciIKICAgICAgICB9LAogICAgICAgIHN1Z2dlc3Rpb25DaGlsZDogewogICAgICAgICAgICB3aGl0ZVNwYWNlOiAibm9ybWFsIgogICAgICAgIH0sCiAgICAgICAgbHRyOiB7CiAgICAgICAgICAgIGxlZnQ6ICIwIiwKICAgICAgICAgICAgcmlnaHQ6ICJhdXRvIgogICAgICAgIH0sCiAgICAgICAgcnRsOiB7CiAgICAgICAgICAgIGxlZnQ6ICJhdXRvIiwKICAgICAgICAgICAgcmlnaHQ6ICIgMCIKICAgICAgICB9CiAgICB9OwogICAgaWYgKF8uaXNNc2llKCkpIHsKICAgICAgICBfLm1peGluKGNzcy5pbnB1dCwgewogICAgICAgICAgICBiYWNrZ3JvdW5kSW1hZ2U6ICJ1cmwoZGF0YTppbWFnZS9naWY7YmFzZTY0LFIwbEdPRGxoQVFBQkFJQUFBQUFBQVAvLy95SDVCQUVBQUFBQUxBQUFBQUFCQUFFQUFBSUJSQUE3KSIKICAgICAgICB9KTsKICAgIH0KICAgIGlmIChfLmlzTXNpZSgpICYmIF8uaXNNc2llKCkgPD0gNykgewogICAgICAgIF8ubWl4aW4oY3NzLmlucHV0LCB7CiAgICAgICAgICAgIG1hcmdpblRvcDogIi0xcHgiCiAgICAgICAgfSk7CiAgICB9CiAgICB2YXIgRXZlbnRCdXMgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgbmFtZXNwYWNlID0gInR5cGVhaGVhZDoiOwogICAgICAgIGZ1bmN0aW9uIEV2ZW50QnVzKG8pIHsKICAgICAgICAgICAgaWYgKCFvIHx8ICFvLmVsKSB7CiAgICAgICAgICAgICAgICAkLmVycm9yKCJFdmVudEJ1cyBpbml0aWFsaXplZCB3aXRob3V0IGVsIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy4kZWwgPSAkKG8uZWwpOwogICAgICAgIH0KICAgICAgICBfLm1peGluKEV2ZW50QnVzLnByb3RvdHlwZSwgewogICAgICAgICAgICB0cmlnZ2VyOiBmdW5jdGlvbih0eXBlKSB7CiAgICAgICAgICAgICAgICB2YXIgYXJncyA9IFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKICAgICAgICAgICAgICAgIHRoaXMuJGVsLnRyaWdnZXIobmFtZXNwYWNlICsgdHlwZSwgYXJncyk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICByZXR1cm4gRXZlbnRCdXM7CiAgICB9KCk7CiAgICB2YXIgRXZlbnRFbWl0dGVyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIHNwbGl0dGVyID0gL1xzKy8sIG5leHRUaWNrID0gZ2V0TmV4dFRpY2soKTsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBvblN5bmM6IG9uU3luYywKICAgICAgICAgICAgb25Bc3luYzogb25Bc3luYywKICAgICAgICAgICAgb2ZmOiBvZmYsCiAgICAgICAgICAgIHRyaWdnZXI6IHRyaWdnZXIKICAgICAgICB9OwogICAgICAgIGZ1bmN0aW9uIG9uKG1ldGhvZCwgdHlwZXMsIGNiLCBjb250ZXh0KSB7CiAgICAgICAgICAgIHZhciB0eXBlOwogICAgICAgICAgICBpZiAoIWNiKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfQogICAgICAgICAgICB0eXBlcyA9IHR5cGVzLnNwbGl0KHNwbGl0dGVyKTsKICAgICAgICAgICAgY2IgPSBjb250ZXh0ID8gYmluZENvbnRleHQoY2IsIGNvbnRleHQpIDogY2I7CiAgICAgICAgICAgIHRoaXMuX2NhbGxiYWNrcyA9IHRoaXMuX2NhbGxiYWNrcyB8fCB7fTsKICAgICAgICAgICAgd2hpbGUgKHR5cGUgPSB0eXBlcy5zaGlmdCgpKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9jYWxsYmFja3NbdHlwZV0gPSB0aGlzLl9jYWxsYmFja3NbdHlwZV0gfHwgewogICAgICAgICAgICAgICAgICAgIHN5bmM6IFtdLAogICAgICAgICAgICAgICAgICAgIGFzeW5jOiBbXQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIHRoaXMuX2NhbGxiYWNrc1t0eXBlXVttZXRob2RdLnB1c2goY2IpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBvbkFzeW5jKHR5cGVzLCBjYiwgY29udGV4dCkgewogICAgICAgICAgICByZXR1cm4gb24uY2FsbCh0aGlzLCAiYXN5bmMiLCB0eXBlcywgY2IsIGNvbnRleHQpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBvblN5bmModHlwZXMsIGNiLCBjb250ZXh0KSB7CiAgICAgICAgICAgIHJldHVybiBvbi5jYWxsKHRoaXMsICJzeW5jIiwgdHlwZXMsIGNiLCBjb250ZXh0KTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gb2ZmKHR5cGVzKSB7CiAgICAgICAgICAgIHZhciB0eXBlOwogICAgICAgICAgICBpZiAoIXRoaXMuX2NhbGxiYWNrcykgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdHlwZXMgPSB0eXBlcy5zcGxpdChzcGxpdHRlcik7CiAgICAgICAgICAgIHdoaWxlICh0eXBlID0gdHlwZXMuc2hpZnQoKSkgewogICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuX2NhbGxiYWNrc1t0eXBlXTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gdHJpZ2dlcih0eXBlcykgewogICAgICAgICAgICB2YXIgdHlwZSwgY2FsbGJhY2tzLCBhcmdzLCBzeW5jRmx1c2gsIGFzeW5jRmx1c2g7CiAgICAgICAgICAgIGlmICghdGhpcy5fY2FsbGJhY2tzKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfQogICAgICAgICAgICB0eXBlcyA9IHR5cGVzLnNwbGl0KHNwbGl0dGVyKTsKICAgICAgICAgICAgYXJncyA9IFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKICAgICAgICAgICAgd2hpbGUgKCh0eXBlID0gdHlwZXMuc2hpZnQoKSkgJiYgKGNhbGxiYWNrcyA9IHRoaXMuX2NhbGxiYWNrc1t0eXBlXSkpIHsKICAgICAgICAgICAgICAgIHN5bmNGbHVzaCA9IGdldEZsdXNoKGNhbGxiYWNrcy5zeW5jLCB0aGlzLCBbIHR5cGUgXS5jb25jYXQoYXJncykpOwogICAgICAgICAgICAgICAgYXN5bmNGbHVzaCA9IGdldEZsdXNoKGNhbGxiYWNrcy5hc3luYywgdGhpcywgWyB0eXBlIF0uY29uY2F0KGFyZ3MpKTsKICAgICAgICAgICAgICAgIHN5bmNGbHVzaCgpICYmIG5leHRUaWNrKGFzeW5jRmx1c2gpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBnZXRGbHVzaChjYWxsYmFja3MsIGNvbnRleHQsIGFyZ3MpIHsKICAgICAgICAgICAgcmV0dXJuIGZsdXNoOwogICAgICAgICAgICBmdW5jdGlvbiBmbHVzaCgpIHsKICAgICAgICAgICAgICAgIHZhciBjYW5jZWxsZWQ7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgIWNhbmNlbGxlZCAmJiBpIDwgY2FsbGJhY2tzLmxlbmd0aDsgaSArPSAxKSB7CiAgICAgICAgICAgICAgICAgICAgY2FuY2VsbGVkID0gY2FsbGJhY2tzW2ldLmFwcGx5KGNvbnRleHQsIGFyZ3MpID09PSBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiAhY2FuY2VsbGVkOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGdldE5leHRUaWNrKCkgewogICAgICAgICAgICB2YXIgbmV4dFRpY2tGbjsKICAgICAgICAgICAgaWYgKHdpbmRvdy5zZXRJbW1lZGlhdGUpIHsKICAgICAgICAgICAgICAgIG5leHRUaWNrRm4gPSBmdW5jdGlvbiBuZXh0VGlja1NldEltbWVkaWF0ZShmbikgewogICAgICAgICAgICAgICAgICAgIHNldEltbWVkaWF0ZShmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm4oKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBuZXh0VGlja0ZuID0gZnVuY3Rpb24gbmV4dFRpY2tTZXRUaW1lb3V0KGZuKSB7CiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm4oKTsKICAgICAgICAgICAgICAgICAgICB9LCAwKTsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG5leHRUaWNrRm47CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGJpbmRDb250ZXh0KGZuLCBjb250ZXh0KSB7CiAgICAgICAgICAgIHJldHVybiBmbi5iaW5kID8gZm4uYmluZChjb250ZXh0KSA6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgZm4uYXBwbHkoY29udGV4dCwgW10uc2xpY2UuY2FsbChhcmd1bWVudHMsIDApKTsKICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICB9KCk7CiAgICB2YXIgaGlnaGxpZ2h0ID0gZnVuY3Rpb24oZG9jKSB7CiAgICAgICAgdmFyIGRlZmF1bHRzID0gewogICAgICAgICAgICBub2RlOiBudWxsLAogICAgICAgICAgICBwYXR0ZXJuOiBudWxsLAogICAgICAgICAgICB0YWdOYW1lOiAic3Ryb25nIiwKICAgICAgICAgICAgY2xhc3NOYW1lOiBudWxsLAogICAgICAgICAgICB3b3Jkc09ubHk6IGZhbHNlLAogICAgICAgICAgICBjYXNlU2Vuc2l0aXZlOiBmYWxzZQogICAgICAgIH07CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIGhpZ2h0bGlnaHQobykgewogICAgICAgICAgICB2YXIgcmVnZXg7CiAgICAgICAgICAgIG8gPSBfLm1peGluKHt9LCBkZWZhdWx0cywgbyk7CiAgICAgICAgICAgIGlmICghby5ub2RlIHx8ICFvLnBhdHRlcm4pIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBvLnBhdHRlcm4gPSBfLmlzQXJyYXkoby5wYXR0ZXJuKSA/IG8ucGF0dGVybiA6IFsgby5wYXR0ZXJuIF07CiAgICAgICAgICAgIHJlZ2V4ID0gZ2V0UmVnZXgoby5wYXR0ZXJuLCBvLmNhc2VTZW5zaXRpdmUsIG8ud29yZHNPbmx5KTsKICAgICAgICAgICAgdHJhdmVyc2Uoby5ub2RlLCBoaWdodGxpZ2h0VGV4dE5vZGUpOwogICAgICAgICAgICBmdW5jdGlvbiBoaWdodGxpZ2h0VGV4dE5vZGUodGV4dE5vZGUpIHsKICAgICAgICAgICAgICAgIHZhciBtYXRjaCwgcGF0dGVybk5vZGU7CiAgICAgICAgICAgICAgICBpZiAobWF0Y2ggPSByZWdleC5leGVjKHRleHROb2RlLmRhdGEpKSB7CiAgICAgICAgICAgICAgICAgICAgd3JhcHBlck5vZGUgPSBkb2MuY3JlYXRlRWxlbWVudChvLnRhZ05hbWUpOwogICAgICAgICAgICAgICAgICAgIG8uY2xhc3NOYW1lICYmICh3cmFwcGVyTm9kZS5jbGFzc05hbWUgPSBvLmNsYXNzTmFtZSk7CiAgICAgICAgICAgICAgICAgICAgcGF0dGVybk5vZGUgPSB0ZXh0Tm9kZS5zcGxpdFRleHQobWF0Y2guaW5kZXgpOwogICAgICAgICAgICAgICAgICAgIHBhdHRlcm5Ob2RlLnNwbGl0VGV4dChtYXRjaFswXS5sZW5ndGgpOwogICAgICAgICAgICAgICAgICAgIHdyYXBwZXJOb2RlLmFwcGVuZENoaWxkKHBhdHRlcm5Ob2RlLmNsb25lTm9kZSh0cnVlKSk7CiAgICAgICAgICAgICAgICAgICAgdGV4dE5vZGUucGFyZW50Tm9kZS5yZXBsYWNlQ2hpbGQod3JhcHBlck5vZGUsIHBhdHRlcm5Ob2RlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiAhIW1hdGNoOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHRyYXZlcnNlKGVsLCBoaWdodGxpZ2h0VGV4dE5vZGUpIHsKICAgICAgICAgICAgICAgIHZhciBjaGlsZE5vZGUsIFRFWFRfTk9ERV9UWVBFID0gMzsKICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZWwuY2hpbGROb2Rlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgIGNoaWxkTm9kZSA9IGVsLmNoaWxkTm9kZXNbaV07CiAgICAgICAgICAgICAgICAgICAgaWYgKGNoaWxkTm9kZS5ub2RlVHlwZSA9PT0gVEVYVF9OT0RFX1RZUEUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaSArPSBoaWdodGxpZ2h0VGV4dE5vZGUoY2hpbGROb2RlKSA/IDEgOiAwOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRyYXZlcnNlKGNoaWxkTm9kZSwgaGlnaHRsaWdodFRleHROb2RlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIGZ1bmN0aW9uIGdldFJlZ2V4KHBhdHRlcm5zLCBjYXNlU2Vuc2l0aXZlLCB3b3Jkc09ubHkpIHsKICAgICAgICAgICAgdmFyIGVzY2FwZWRQYXR0ZXJucyA9IFtdLCByZWdleFN0cjsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwYXR0ZXJucy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgZXNjYXBlZFBhdHRlcm5zLnB1c2goXy5lc2NhcGVSZWdFeENoYXJzKHBhdHRlcm5zW2ldKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmVnZXhTdHIgPSB3b3Jkc09ubHkgPyAiXFxiKCIgKyBlc2NhcGVkUGF0dGVybnMuam9pbigifCIpICsgIilcXGIiIDogIigiICsgZXNjYXBlZFBhdHRlcm5zLmpvaW4oInwiKSArICIpIjsKICAgICAgICAgICAgcmV0dXJuIGNhc2VTZW5zaXRpdmUgPyBuZXcgUmVnRXhwKHJlZ2V4U3RyKSA6IG5ldyBSZWdFeHAocmVnZXhTdHIsICJpIik7CiAgICAgICAgfQogICAgfSh3aW5kb3cuZG9jdW1lbnQpOwogICAgdmFyIElucHV0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIHNwZWNpYWxLZXlDb2RlTWFwOwogICAgICAgIHNwZWNpYWxLZXlDb2RlTWFwID0gewogICAgICAgICAgICA5OiAidGFiIiwKICAgICAgICAgICAgMjc6ICJlc2MiLAogICAgICAgICAgICAzNzogImxlZnQiLAogICAgICAgICAgICAzOTogInJpZ2h0IiwKICAgICAgICAgICAgMTM6ICJlbnRlciIsCiAgICAgICAgICAgIDM4OiAidXAiLAogICAgICAgICAgICA0MDogImRvd24iCiAgICAgICAgfTsKICAgICAgICBmdW5jdGlvbiBJbnB1dChvKSB7CiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgb25CbHVyLCBvbkZvY3VzLCBvbktleWRvd24sIG9uSW5wdXQ7CiAgICAgICAgICAgIG8gPSBvIHx8IHt9OwogICAgICAgICAgICBpZiAoIW8uaW5wdXQpIHsKICAgICAgICAgICAgICAgICQuZXJyb3IoImlucHV0IGlzIG1pc3NpbmciKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBvbkJsdXIgPSBfLmJpbmQodGhpcy5fb25CbHVyLCB0aGlzKTsKICAgICAgICAgICAgb25Gb2N1cyA9IF8uYmluZCh0aGlzLl9vbkZvY3VzLCB0aGlzKTsKICAgICAgICAgICAgb25LZXlkb3duID0gXy5iaW5kKHRoaXMuX29uS2V5ZG93biwgdGhpcyk7CiAgICAgICAgICAgIG9uSW5wdXQgPSBfLmJpbmQodGhpcy5fb25JbnB1dCwgdGhpcyk7CiAgICAgICAgICAgIHRoaXMuJGhpbnQgPSAkKG8uaGludCk7CiAgICAgICAgICAgIHRoaXMuJGlucHV0ID0gJChvLmlucHV0KS5vbigiYmx1ci50dCIsIG9uQmx1cikub24oImZvY3VzLnR0Iiwgb25Gb2N1cykub24oImtleWRvd24udHQiLCBvbktleWRvd24pOwogICAgICAgICAgICBpZiAodGhpcy4kaGludC5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgIHRoaXMuc2V0SGludCA9IHRoaXMuZ2V0SGludCA9IHRoaXMuY2xlYXJIaW50ID0gdGhpcy5jbGVhckhpbnRJZkludmFsaWQgPSBfLm5vb3A7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCFfLmlzTXNpZSgpKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRpbnB1dC5vbigiaW5wdXQudHQiLCBvbklucHV0KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuJGlucHV0Lm9uKCJrZXlkb3duLnR0IGtleXByZXNzLnR0IGN1dC50dCBwYXN0ZS50dCIsIGZ1bmN0aW9uKCRlKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHNwZWNpYWxLZXlDb2RlTWFwWyRlLndoaWNoIHx8ICRlLmtleUNvZGVdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgXy5kZWZlcihfLmJpbmQodGhhdC5fb25JbnB1dCwgdGhhdCwgJGUpKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMucXVlcnkgPSB0aGlzLiRpbnB1dC52YWwoKTsKICAgICAgICAgICAgdGhpcy4kb3ZlcmZsb3dIZWxwZXIgPSBidWlsZE92ZXJmbG93SGVscGVyKHRoaXMuJGlucHV0KTsKICAgICAgICB9CiAgICAgICAgSW5wdXQubm9ybWFsaXplUXVlcnkgPSBmdW5jdGlvbihzdHIpIHsKICAgICAgICAgICAgcmV0dXJuIChzdHIgfHwgIiIpLnJlcGxhY2UoL15ccyovZywgIiIpLnJlcGxhY2UoL1xzezIsfS9nLCAiICIpOwogICAgICAgIH07CiAgICAgICAgXy5taXhpbihJbnB1dC5wcm90b3R5cGUsIEV2ZW50RW1pdHRlciwgewogICAgICAgICAgICBfb25CbHVyOiBmdW5jdGlvbiBvbkJsdXIoKSB7CiAgICAgICAgICAgICAgICB0aGlzLnJlc2V0SW5wdXRWYWx1ZSgpOwogICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCJibHVycmVkIik7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9vbkZvY3VzOiBmdW5jdGlvbiBvbkZvY3VzKCkgewogICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCJmb2N1c2VkIik7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9vbktleWRvd246IGZ1bmN0aW9uIG9uS2V5ZG93bigkZSkgewogICAgICAgICAgICAgICAgdmFyIGtleU5hbWUgPSBzcGVjaWFsS2V5Q29kZU1hcFskZS53aGljaCB8fCAkZS5rZXlDb2RlXTsKICAgICAgICAgICAgICAgIHRoaXMuX21hbmFnZVByZXZlbnREZWZhdWx0KGtleU5hbWUsICRlKTsKICAgICAgICAgICAgICAgIGlmIChrZXlOYW1lICYmIHRoaXMuX3Nob3VsZFRyaWdnZXIoa2V5TmFtZSwgJGUpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKGtleU5hbWUgKyAiS2V5ZWQiLCAkZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9vbklucHV0OiBmdW5jdGlvbiBvbklucHV0KCkgewogICAgICAgICAgICAgICAgdGhpcy5fY2hlY2tJbnB1dFZhbHVlKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9tYW5hZ2VQcmV2ZW50RGVmYXVsdDogZnVuY3Rpb24gbWFuYWdlUHJldmVudERlZmF1bHQoa2V5TmFtZSwgJGUpIHsKICAgICAgICAgICAgICAgIHZhciBwcmV2ZW50RGVmYXVsdCwgaGludFZhbHVlLCBpbnB1dFZhbHVlOwogICAgICAgICAgICAgICAgc3dpdGNoIChrZXlOYW1lKSB7CiAgICAgICAgICAgICAgICAgIGNhc2UgInRhYiI6CiAgICAgICAgICAgICAgICAgICAgaGludFZhbHVlID0gdGhpcy5nZXRIaW50KCk7CiAgICAgICAgICAgICAgICAgICAgaW5wdXRWYWx1ZSA9IHRoaXMuZ2V0SW5wdXRWYWx1ZSgpOwogICAgICAgICAgICAgICAgICAgIHByZXZlbnREZWZhdWx0ID0gaGludFZhbHVlICYmIGhpbnRWYWx1ZSAhPT0gaW5wdXRWYWx1ZSAmJiAhd2l0aE1vZGlmaWVyKCRlKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgIGNhc2UgInVwIjoKICAgICAgICAgICAgICAgICAgY2FzZSAiZG93biI6CiAgICAgICAgICAgICAgICAgICAgcHJldmVudERlZmF1bHQgPSAhd2l0aE1vZGlmaWVyKCRlKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgcHJldmVudERlZmF1bHQgPSBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHByZXZlbnREZWZhdWx0ICYmICRlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9zaG91bGRUcmlnZ2VyOiBmdW5jdGlvbiBzaG91bGRUcmlnZ2VyKGtleU5hbWUsICRlKSB7CiAgICAgICAgICAgICAgICB2YXIgdHJpZ2dlcjsKICAgICAgICAgICAgICAgIHN3aXRjaCAoa2V5TmFtZSkgewogICAgICAgICAgICAgICAgICBjYXNlICJ0YWIiOgogICAgICAgICAgICAgICAgICAgIHRyaWdnZXIgPSAhd2l0aE1vZGlmaWVyKCRlKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgdHJpZ2dlciA9IHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gdHJpZ2dlcjsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX2NoZWNrSW5wdXRWYWx1ZTogZnVuY3Rpb24gY2hlY2tJbnB1dFZhbHVlKCkgewogICAgICAgICAgICAgICAgdmFyIGlucHV0VmFsdWUsIGFyZUVxdWl2YWxlbnQsIGhhc0RpZmZlcmVudFdoaXRlc3BhY2U7CiAgICAgICAgICAgICAgICBpbnB1dFZhbHVlID0gdGhpcy5nZXRJbnB1dFZhbHVlKCk7CiAgICAgICAgICAgICAgICBhcmVFcXVpdmFsZW50ID0gYXJlUXVlcmllc0VxdWl2YWxlbnQoaW5wdXRWYWx1ZSwgdGhpcy5xdWVyeSk7CiAgICAgICAgICAgICAgICBoYXNEaWZmZXJlbnRXaGl0ZXNwYWNlID0gYXJlRXF1aXZhbGVudCA/IHRoaXMucXVlcnkubGVuZ3RoICE9PSBpbnB1dFZhbHVlLmxlbmd0aCA6IGZhbHNlOwogICAgICAgICAgICAgICAgaWYgKCFhcmVFcXVpdmFsZW50KSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCJxdWVyeUNoYW5nZWQiLCB0aGlzLnF1ZXJ5ID0gaW5wdXRWYWx1ZSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGhhc0RpZmZlcmVudFdoaXRlc3BhY2UpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXIoIndoaXRlc3BhY2VDaGFuZ2VkIiwgdGhpcy5xdWVyeSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGZvY3VzOiBmdW5jdGlvbiBmb2N1cygpIHsKICAgICAgICAgICAgICAgIHRoaXMuJGlucHV0LmZvY3VzKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGJsdXI6IGZ1bmN0aW9uIGJsdXIoKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRpbnB1dC5ibHVyKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGdldFF1ZXJ5OiBmdW5jdGlvbiBnZXRRdWVyeSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnF1ZXJ5OwogICAgICAgICAgICB9LAogICAgICAgICAgICBzZXRRdWVyeTogZnVuY3Rpb24gc2V0UXVlcnkocXVlcnkpIHsKICAgICAgICAgICAgICAgIHRoaXMucXVlcnkgPSBxdWVyeTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZ2V0SW5wdXRWYWx1ZTogZnVuY3Rpb24gZ2V0SW5wdXRWYWx1ZSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiRpbnB1dC52YWwoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2V0SW5wdXRWYWx1ZTogZnVuY3Rpb24gc2V0SW5wdXRWYWx1ZSh2YWx1ZSwgc2lsZW50KSB7CiAgICAgICAgICAgICAgICB0aGlzLiRpbnB1dC52YWwodmFsdWUpOwogICAgICAgICAgICAgICAgc2lsZW50ID8gdGhpcy5jbGVhckhpbnQoKSA6IHRoaXMuX2NoZWNrSW5wdXRWYWx1ZSgpOwogICAgICAgICAgICB9LAogICAgICAgICAgICByZXNldElucHV0VmFsdWU6IGZ1bmN0aW9uIHJlc2V0SW5wdXRWYWx1ZSgpIHsKICAgICAgICAgICAgICAgIHRoaXMuc2V0SW5wdXRWYWx1ZSh0aGlzLnF1ZXJ5LCB0cnVlKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZ2V0SGludDogZnVuY3Rpb24gZ2V0SGludCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiRoaW50LnZhbCgpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBzZXRIaW50OiBmdW5jdGlvbiBzZXRIaW50KHZhbHVlKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRoaW50LnZhbCh2YWx1ZSk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNsZWFySGludDogZnVuY3Rpb24gY2xlYXJIaW50KCkgewogICAgICAgICAgICAgICAgdGhpcy5zZXRIaW50KCIiKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgY2xlYXJIaW50SWZJbnZhbGlkOiBmdW5jdGlvbiBjbGVhckhpbnRJZkludmFsaWQoKSB7CiAgICAgICAgICAgICAgICB2YXIgdmFsLCBoaW50LCB2YWxJc1ByZWZpeE9mSGludCwgaXNWYWxpZDsKICAgICAgICAgICAgICAgIHZhbCA9IHRoaXMuZ2V0SW5wdXRWYWx1ZSgpOwogICAgICAgICAgICAgICAgaGludCA9IHRoaXMuZ2V0SGludCgpOwogICAgICAgICAgICAgICAgdmFsSXNQcmVmaXhPZkhpbnQgPSB2YWwgIT09IGhpbnQgJiYgaGludC5pbmRleE9mKHZhbCkgPT09IDA7CiAgICAgICAgICAgICAgICBpc1ZhbGlkID0gdmFsICE9PSAiIiAmJiB2YWxJc1ByZWZpeE9mSGludCAmJiAhdGhpcy5oYXNPdmVyZmxvdygpOwogICAgICAgICAgICAgICAgIWlzVmFsaWQgJiYgdGhpcy5jbGVhckhpbnQoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZ2V0TGFuZ3VhZ2VEaXJlY3Rpb246IGZ1bmN0aW9uIGdldExhbmd1YWdlRGlyZWN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuICh0aGlzLiRpbnB1dC5jc3MoImRpcmVjdGlvbiIpIHx8ICJsdHIiKS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBoYXNPdmVyZmxvdzogZnVuY3Rpb24gaGFzT3ZlcmZsb3coKSB7CiAgICAgICAgICAgICAgICB2YXIgY29uc3RyYWludCA9IHRoaXMuJGlucHV0LndpZHRoKCkgLSAyOwogICAgICAgICAgICAgICAgdGhpcy4kb3ZlcmZsb3dIZWxwZXIudGV4dCh0aGlzLmdldElucHV0VmFsdWUoKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kb3ZlcmZsb3dIZWxwZXIud2lkdGgoKSA+PSBjb25zdHJhaW50OwogICAgICAgICAgICB9LAogICAgICAgICAgICBpc0N1cnNvckF0RW5kOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHZhciB2YWx1ZUxlbmd0aCwgc2VsZWN0aW9uU3RhcnQsIHJhbmdlOwogICAgICAgICAgICAgICAgdmFsdWVMZW5ndGggPSB0aGlzLiRpbnB1dC52YWwoKS5sZW5ndGg7CiAgICAgICAgICAgICAgICBzZWxlY3Rpb25TdGFydCA9IHRoaXMuJGlucHV0WzBdLnNlbGVjdGlvblN0YXJ0OwogICAgICAgICAgICAgICAgaWYgKF8uaXNOdW1iZXIoc2VsZWN0aW9uU3RhcnQpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGVjdGlvblN0YXJ0ID09PSB2YWx1ZUxlbmd0aDsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZG9jdW1lbnQuc2VsZWN0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgcmFuZ2UgPSBkb2N1bWVudC5zZWxlY3Rpb24uY3JlYXRlUmFuZ2UoKTsKICAgICAgICAgICAgICAgICAgICByYW5nZS5tb3ZlU3RhcnQoImNoYXJhY3RlciIsIC12YWx1ZUxlbmd0aCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlTGVuZ3RoID09PSByYW5nZS50ZXh0Lmxlbmd0aDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9LAogICAgICAgICAgICBkZXN0cm95OiBmdW5jdGlvbiBkZXN0cm95KCkgewogICAgICAgICAgICAgICAgdGhpcy4kaGludC5vZmYoIi50dCIpOwogICAgICAgICAgICAgICAgdGhpcy4kaW5wdXQub2ZmKCIudHQiKTsKICAgICAgICAgICAgICAgIHRoaXMuJGhpbnQgPSB0aGlzLiRpbnB1dCA9IHRoaXMuJG92ZXJmbG93SGVscGVyID0gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHJldHVybiBJbnB1dDsKICAgICAgICBmdW5jdGlvbiBidWlsZE92ZXJmbG93SGVscGVyKCRpbnB1dCkgewogICAgICAgICAgICByZXR1cm4gJCgnPHByZSBhcmlhLWhpZGRlbj0idHJ1ZSI+PC9wcmU+JykuY3NzKHsKICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAiYWJzb2x1dGUiLAogICAgICAgICAgICAgICAgdmlzaWJpbGl0eTogImhpZGRlbiIsCiAgICAgICAgICAgICAgICB3aGl0ZVNwYWNlOiAicHJlIiwKICAgICAgICAgICAgICAgIGZvbnRGYW1pbHk6ICRpbnB1dC5jc3MoImZvbnQtZmFtaWx5IiksCiAgICAgICAgICAgICAgICBmb250U2l6ZTogJGlucHV0LmNzcygiZm9udC1zaXplIiksCiAgICAgICAgICAgICAgICBmb250U3R5bGU6ICRpbnB1dC5jc3MoImZvbnQtc3R5bGUiKSwKICAgICAgICAgICAgICAgIGZvbnRWYXJpYW50OiAkaW5wdXQuY3NzKCJmb250LXZhcmlhbnQiKSwKICAgICAgICAgICAgICAgIGZvbnRXZWlnaHQ6ICRpbnB1dC5jc3MoImZvbnQtd2VpZ2h0IiksCiAgICAgICAgICAgICAgICB3b3JkU3BhY2luZzogJGlucHV0LmNzcygid29yZC1zcGFjaW5nIiksCiAgICAgICAgICAgICAgICBsZXR0ZXJTcGFjaW5nOiAkaW5wdXQuY3NzKCJsZXR0ZXItc3BhY2luZyIpLAogICAgICAgICAgICAgICAgdGV4dEluZGVudDogJGlucHV0LmNzcygidGV4dC1pbmRlbnQiKSwKICAgICAgICAgICAgICAgIHRleHRSZW5kZXJpbmc6ICRpbnB1dC5jc3MoInRleHQtcmVuZGVyaW5nIiksCiAgICAgICAgICAgICAgICB0ZXh0VHJhbnNmb3JtOiAkaW5wdXQuY3NzKCJ0ZXh0LXRyYW5zZm9ybSIpCiAgICAgICAgICAgIH0pLmluc2VydEFmdGVyKCRpbnB1dCk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGFyZVF1ZXJpZXNFcXVpdmFsZW50KGEsIGIpIHsKICAgICAgICAgICAgcmV0dXJuIElucHV0Lm5vcm1hbGl6ZVF1ZXJ5KGEpID09PSBJbnB1dC5ub3JtYWxpemVRdWVyeShiKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gd2l0aE1vZGlmaWVyKCRlKSB7CiAgICAgICAgICAgIHJldHVybiAkZS5hbHRLZXkgfHwgJGUuY3RybEtleSB8fCAkZS5tZXRhS2V5IHx8ICRlLnNoaWZ0S2V5OwogICAgICAgIH0KICAgIH0oKTsKICAgIHZhciBEYXRhc2V0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGRhdGFzZXRLZXkgPSAidHREYXRhc2V0IiwgdmFsdWVLZXkgPSAidHRWYWx1ZSIsIGRhdHVtS2V5ID0gInR0RGF0dW0iOwogICAgICAgIGZ1bmN0aW9uIERhdGFzZXQobykgewogICAgICAgICAgICBvID0gbyB8fCB7fTsKICAgICAgICAgICAgby50ZW1wbGF0ZXMgPSBvLnRlbXBsYXRlcyB8fCB7fTsKICAgICAgICAgICAgaWYgKCFvLnNvdXJjZSkgewogICAgICAgICAgICAgICAgJC5lcnJvcigibWlzc2luZyBzb3VyY2UiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoby5uYW1lICYmICFpc1ZhbGlkTmFtZShvLm5hbWUpKSB7CiAgICAgICAgICAgICAgICAkLmVycm9yKCJpbnZhbGlkIGRhdGFzZXQgbmFtZTogIiArIG8ubmFtZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5xdWVyeSA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuaGlnaGxpZ2h0ID0gISFvLmhpZ2hsaWdodDsKICAgICAgICAgICAgdGhpcy5uYW1lID0gby5uYW1lIHx8IF8uZ2V0VW5pcXVlSWQoKTsKICAgICAgICAgICAgdGhpcy5zb3VyY2UgPSBvLnNvdXJjZTsKICAgICAgICAgICAgdGhpcy5kaXNwbGF5Rm4gPSBnZXREaXNwbGF5Rm4oby5kaXNwbGF5IHx8IG8uZGlzcGxheUtleSk7CiAgICAgICAgICAgIHRoaXMudGVtcGxhdGVzID0gZ2V0VGVtcGxhdGVzKG8udGVtcGxhdGVzLCB0aGlzLmRpc3BsYXlGbik7CiAgICAgICAgICAgIHRoaXMuJGVsID0gJChodG1sLmRhdGFzZXQucmVwbGFjZSgiJUNMQVNTJSIsIHRoaXMubmFtZSkpOwogICAgICAgIH0KICAgICAgICBEYXRhc2V0LmV4dHJhY3REYXRhc2V0TmFtZSA9IGZ1bmN0aW9uIGV4dHJhY3REYXRhc2V0TmFtZShlbCkgewogICAgICAgICAgICByZXR1cm4gJChlbCkuZGF0YShkYXRhc2V0S2V5KTsKICAgICAgICB9OwogICAgICAgIERhdGFzZXQuZXh0cmFjdFZhbHVlID0gZnVuY3Rpb24gZXh0cmFjdERhdHVtKGVsKSB7CiAgICAgICAgICAgIHJldHVybiAkKGVsKS5kYXRhKHZhbHVlS2V5KTsKICAgICAgICB9OwogICAgICAgIERhdGFzZXQuZXh0cmFjdERhdHVtID0gZnVuY3Rpb24gZXh0cmFjdERhdHVtKGVsKSB7CiAgICAgICAgICAgIHJldHVybiAkKGVsKS5kYXRhKGRhdHVtS2V5KTsKICAgICAgICB9OwogICAgICAgIF8ubWl4aW4oRGF0YXNldC5wcm90b3R5cGUsIEV2ZW50RW1pdHRlciwgewogICAgICAgICAgICBfcmVuZGVyOiBmdW5jdGlvbiByZW5kZXIocXVlcnksIHN1Z2dlc3Rpb25zKSB7CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuJGVsKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBoYXNTdWdnZXN0aW9uczsKICAgICAgICAgICAgICAgIHRoaXMuJGVsLmVtcHR5KCk7CiAgICAgICAgICAgICAgICBoYXNTdWdnZXN0aW9ucyA9IHN1Z2dlc3Rpb25zICYmIHN1Z2dlc3Rpb25zLmxlbmd0aDsKICAgICAgICAgICAgICAgIGlmICghaGFzU3VnZ2VzdGlvbnMgJiYgdGhpcy50ZW1wbGF0ZXMuZW1wdHkpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbC5odG1sKGdldEVtcHR5SHRtbCgpKS5wcmVwZW5kKHRoYXQudGVtcGxhdGVzLmhlYWRlciA/IGdldEhlYWRlckh0bWwoKSA6IG51bGwpLmFwcGVuZCh0aGF0LnRlbXBsYXRlcy5mb290ZXIgPyBnZXRGb290ZXJIdG1sKCkgOiBudWxsKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaGFzU3VnZ2VzdGlvbnMpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbC5odG1sKGdldFN1Z2dlc3Rpb25zSHRtbCgpKS5wcmVwZW5kKHRoYXQudGVtcGxhdGVzLmhlYWRlciA/IGdldEhlYWRlckh0bWwoKSA6IG51bGwpLmFwcGVuZCh0aGF0LnRlbXBsYXRlcy5mb290ZXIgPyBnZXRGb290ZXJIdG1sKCkgOiBudWxsKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMudHJpZ2dlcigicmVuZGVyZWQiKTsKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGdldEVtcHR5SHRtbCgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhhdC50ZW1wbGF0ZXMuZW1wdHkoewogICAgICAgICAgICAgICAgICAgICAgICBxdWVyeTogcXVlcnksCiAgICAgICAgICAgICAgICAgICAgICAgIGlzRW1wdHk6IHRydWUKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGdldFN1Z2dlc3Rpb25zSHRtbCgpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgJHN1Z2dlc3Rpb25zLCBub2RlczsKICAgICAgICAgICAgICAgICAgICAkc3VnZ2VzdGlvbnMgPSAkKGh0bWwuc3VnZ2VzdGlvbnMpLmNzcyhjc3Muc3VnZ2VzdGlvbnMpOwogICAgICAgICAgICAgICAgICAgIG5vZGVzID0gXy5tYXAoc3VnZ2VzdGlvbnMsIGdldFN1Z2dlc3Rpb25Ob2RlKTsKICAgICAgICAgICAgICAgICAgICAkc3VnZ2VzdGlvbnMuYXBwZW5kLmFwcGx5KCRzdWdnZXN0aW9ucywgbm9kZXMpOwogICAgICAgICAgICAgICAgICAgIHRoYXQuaGlnaGxpZ2h0ICYmIGhpZ2hsaWdodCh7CiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGU6ICRzdWdnZXN0aW9uc1swXSwKICAgICAgICAgICAgICAgICAgICAgICAgcGF0dGVybjogcXVlcnkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHN1Z2dlc3Rpb25zOwogICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGdldFN1Z2dlc3Rpb25Ob2RlKHN1Z2dlc3Rpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyICRlbDsKICAgICAgICAgICAgICAgICAgICAgICAgJGVsID0gJChodG1sLnN1Z2dlc3Rpb24pLmFwcGVuZCh0aGF0LnRlbXBsYXRlcy5zdWdnZXN0aW9uKHN1Z2dlc3Rpb24pKS5kYXRhKGRhdGFzZXRLZXksIHRoYXQubmFtZSkuZGF0YSh2YWx1ZUtleSwgdGhhdC5kaXNwbGF5Rm4oc3VnZ2VzdGlvbikpLmRhdGEoZGF0dW1LZXksIHN1Z2dlc3Rpb24pOwogICAgICAgICAgICAgICAgICAgICAgICAkZWwuY2hpbGRyZW4oKS5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5jc3MoY3NzLnN1Z2dlc3Rpb25DaGlsZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGVsOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGdldEhlYWRlckh0bWwoKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoYXQudGVtcGxhdGVzLmhlYWRlcih7CiAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXJ5OiBxdWVyeSwKICAgICAgICAgICAgICAgICAgICAgICAgaXNFbXB0eTogIWhhc1N1Z2dlc3Rpb25zCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBmdW5jdGlvbiBnZXRGb290ZXJIdG1sKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGF0LnRlbXBsYXRlcy5mb290ZXIoewogICAgICAgICAgICAgICAgICAgICAgICBxdWVyeTogcXVlcnksCiAgICAgICAgICAgICAgICAgICAgICAgIGlzRW1wdHk6ICFoYXNTdWdnZXN0aW9ucwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBnZXRSb290OiBmdW5jdGlvbiBnZXRSb290KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJGVsOwogICAgICAgICAgICB9LAogICAgICAgICAgICB1cGRhdGU6IGZ1bmN0aW9uIHVwZGF0ZShxdWVyeSkgewogICAgICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzOwogICAgICAgICAgICAgICAgdGhpcy5xdWVyeSA9IHF1ZXJ5OwogICAgICAgICAgICAgICAgdGhpcy5jYW5jZWxlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgdGhpcy5zb3VyY2UocXVlcnksIHJlbmRlcik7CiAgICAgICAgICAgICAgICBmdW5jdGlvbiByZW5kZXIoc3VnZ2VzdGlvbnMpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIXRoYXQuY2FuY2VsZWQgJiYgcXVlcnkgPT09IHRoYXQucXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5fcmVuZGVyKHF1ZXJ5LCBzdWdnZXN0aW9ucyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBjYW5jZWw6IGZ1bmN0aW9uIGNhbmNlbCgpIHsKICAgICAgICAgICAgICAgIHRoaXMuY2FuY2VsZWQgPSB0cnVlOwogICAgICAgICAgICB9LAogICAgICAgICAgICBjbGVhcjogZnVuY3Rpb24gY2xlYXIoKSB7CiAgICAgICAgICAgICAgICB0aGlzLmNhbmNlbCgpOwogICAgICAgICAgICAgICAgdGhpcy4kZWwuZW1wdHkoKTsKICAgICAgICAgICAgICAgIHRoaXMudHJpZ2dlcigicmVuZGVyZWQiKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgaXNFbXB0eTogZnVuY3Rpb24gaXNFbXB0eSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiRlbC5pcygiOmVtcHR5Iik7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uIGRlc3Ryb3koKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRlbCA9IG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICByZXR1cm4gRGF0YXNldDsKICAgICAgICBmdW5jdGlvbiBnZXREaXNwbGF5Rm4oZGlzcGxheSkgewogICAgICAgICAgICBkaXNwbGF5ID0gZGlzcGxheSB8fCAidmFsdWUiOwogICAgICAgICAgICByZXR1cm4gXy5pc0Z1bmN0aW9uKGRpc3BsYXkpID8gZGlzcGxheSA6IGRpc3BsYXlGbjsKICAgICAgICAgICAgZnVuY3Rpb24gZGlzcGxheUZuKG9iaikgewogICAgICAgICAgICAgICAgcmV0dXJuIG9ialtkaXNwbGF5XTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBnZXRUZW1wbGF0ZXModGVtcGxhdGVzLCBkaXNwbGF5Rm4pIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIGVtcHR5OiB0ZW1wbGF0ZXMuZW1wdHkgJiYgXy50ZW1wbGF0aWZ5KHRlbXBsYXRlcy5lbXB0eSksCiAgICAgICAgICAgICAgICBoZWFkZXI6IHRlbXBsYXRlcy5oZWFkZXIgJiYgXy50ZW1wbGF0aWZ5KHRlbXBsYXRlcy5oZWFkZXIpLAogICAgICAgICAgICAgICAgZm9vdGVyOiB0ZW1wbGF0ZXMuZm9vdGVyICYmIF8udGVtcGxhdGlmeSh0ZW1wbGF0ZXMuZm9vdGVyKSwKICAgICAgICAgICAgICAgIHN1Z2dlc3Rpb246IHRlbXBsYXRlcy5zdWdnZXN0aW9uIHx8IHN1Z2dlc3Rpb25UZW1wbGF0ZQogICAgICAgICAgICB9OwogICAgICAgICAgICBmdW5jdGlvbiBzdWdnZXN0aW9uVGVtcGxhdGUoY29udGV4dCkgewogICAgICAgICAgICAgICAgcmV0dXJuICI8cD4iICsgZGlzcGxheUZuKGNvbnRleHQpICsgIjwvcD4iOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGlzVmFsaWROYW1lKHN0cikgewogICAgICAgICAgICByZXR1cm4gL15bX2EtekEtWjAtOS1dKyQvLnRlc3Qoc3RyKTsKICAgICAgICB9CiAgICB9KCk7CiAgICB2YXIgRHJvcGRvd24gPSBmdW5jdGlvbigpIHsKICAgICAgICBmdW5jdGlvbiBEcm9wZG93bihvKSB7CiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgb25TdWdnZXN0aW9uQ2xpY2ssIG9uU3VnZ2VzdGlvbk1vdXNlRW50ZXIsIG9uU3VnZ2VzdGlvbk1vdXNlTGVhdmU7CiAgICAgICAgICAgIG8gPSBvIHx8IHt9OwogICAgICAgICAgICBpZiAoIW8ubWVudSkgewogICAgICAgICAgICAgICAgJC5lcnJvcigibWVudSBpcyByZXF1aXJlZCIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuaXNPcGVuID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuaXNFbXB0eSA9IHRydWU7CiAgICAgICAgICAgIHRoaXMuZGF0YXNldHMgPSBfLm1hcChvLmRhdGFzZXRzLCBpbml0aWFsaXplRGF0YXNldCk7CiAgICAgICAgICAgIG9uU3VnZ2VzdGlvbkNsaWNrID0gXy5iaW5kKHRoaXMuX29uU3VnZ2VzdGlvbkNsaWNrLCB0aGlzKTsKICAgICAgICAgICAgb25TdWdnZXN0aW9uTW91c2VFbnRlciA9IF8uYmluZCh0aGlzLl9vblN1Z2dlc3Rpb25Nb3VzZUVudGVyLCB0aGlzKTsKICAgICAgICAgICAgb25TdWdnZXN0aW9uTW91c2VMZWF2ZSA9IF8uYmluZCh0aGlzLl9vblN1Z2dlc3Rpb25Nb3VzZUxlYXZlLCB0aGlzKTsKICAgICAgICAgICAgdGhpcy4kbWVudSA9ICQoby5tZW51KS5vbigiY2xpY2sudHQiLCAiLnR0LXN1Z2dlc3Rpb24iLCBvblN1Z2dlc3Rpb25DbGljaykub24oIm1vdXNlZW50ZXIudHQiLCAiLnR0LXN1Z2dlc3Rpb24iLCBvblN1Z2dlc3Rpb25Nb3VzZUVudGVyKS5vbigibW91c2VsZWF2ZS50dCIsICIudHQtc3VnZ2VzdGlvbiIsIG9uU3VnZ2VzdGlvbk1vdXNlTGVhdmUpOwogICAgICAgICAgICBfLmVhY2godGhpcy5kYXRhc2V0cywgZnVuY3Rpb24oZGF0YXNldCkgewogICAgICAgICAgICAgICAgdGhhdC4kbWVudS5hcHBlbmQoZGF0YXNldC5nZXRSb290KCkpOwogICAgICAgICAgICAgICAgZGF0YXNldC5vblN5bmMoInJlbmRlcmVkIiwgdGhhdC5fb25SZW5kZXJlZCwgdGhhdCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBfLm1peGluKERyb3Bkb3duLnByb3RvdHlwZSwgRXZlbnRFbWl0dGVyLCB7CiAgICAgICAgICAgIF9vblN1Z2dlc3Rpb25DbGljazogZnVuY3Rpb24gb25TdWdnZXN0aW9uQ2xpY2soJGUpIHsKICAgICAgICAgICAgICAgIHRoaXMudHJpZ2dlcigic3VnZ2VzdGlvbkNsaWNrZWQiLCAkKCRlLmN1cnJlbnRUYXJnZXQpKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX29uU3VnZ2VzdGlvbk1vdXNlRW50ZXI6IGZ1bmN0aW9uIG9uU3VnZ2VzdGlvbk1vdXNlRW50ZXIoJGUpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3JlbW92ZUN1cnNvcigpOwogICAgICAgICAgICAgICAgdGhpcy5fc2V0Q3Vyc29yKCQoJGUuY3VycmVudFRhcmdldCksIHRydWUpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfb25TdWdnZXN0aW9uTW91c2VMZWF2ZTogZnVuY3Rpb24gb25TdWdnZXN0aW9uTW91c2VMZWF2ZSgpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3JlbW92ZUN1cnNvcigpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfb25SZW5kZXJlZDogZnVuY3Rpb24gb25SZW5kZXJlZCgpIHsKICAgICAgICAgICAgICAgIHRoaXMuaXNFbXB0eSA9IF8uZXZlcnkodGhpcy5kYXRhc2V0cywgaXNEYXRhc2V0RW1wdHkpOwogICAgICAgICAgICAgICAgdGhpcy5pc0VtcHR5ID8gdGhpcy5faGlkZSgpIDogdGhpcy5pc09wZW4gJiYgdGhpcy5fc2hvdygpOwogICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCJkYXRhc2V0UmVuZGVyZWQiKTsKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGlzRGF0YXNldEVtcHR5KGRhdGFzZXQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YXNldC5pc0VtcHR5KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9oaWRlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHRoaXMuJG1lbnUuaGlkZSgpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfc2hvdzogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRtZW51LmNzcygiZGlzcGxheSIsICJibG9jayIpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfZ2V0U3VnZ2VzdGlvbnM6IGZ1bmN0aW9uIGdldFN1Z2dlc3Rpb25zKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJG1lbnUuZmluZCgiLnR0LXN1Z2dlc3Rpb24iKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX2dldEN1cnNvcjogZnVuY3Rpb24gZ2V0Q3Vyc29yKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJG1lbnUuZmluZCgiLnR0LWN1cnNvciIpLmZpcnN0KCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9zZXRDdXJzb3I6IGZ1bmN0aW9uIHNldEN1cnNvcigkZWwsIHNpbGVudCkgewogICAgICAgICAgICAgICAgJGVsLmZpcnN0KCkuYWRkQ2xhc3MoInR0LWN1cnNvciIpOwogICAgICAgICAgICAgICAgIXNpbGVudCAmJiB0aGlzLnRyaWdnZXIoImN1cnNvck1vdmVkIik7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9yZW1vdmVDdXJzb3I6IGZ1bmN0aW9uIHJlbW92ZUN1cnNvcigpIHsKICAgICAgICAgICAgICAgIHRoaXMuX2dldEN1cnNvcigpLnJlbW92ZUNsYXNzKCJ0dC1jdXJzb3IiKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX21vdmVDdXJzb3I6IGZ1bmN0aW9uIG1vdmVDdXJzb3IoaW5jcmVtZW50KSB7CiAgICAgICAgICAgICAgICB2YXIgJHN1Z2dlc3Rpb25zLCAkb2xkQ3Vyc29yLCBuZXdDdXJzb3JJbmRleCwgJG5ld0N1cnNvcjsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5pc09wZW4pIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkb2xkQ3Vyc29yID0gdGhpcy5fZ2V0Q3Vyc29yKCk7CiAgICAgICAgICAgICAgICAkc3VnZ2VzdGlvbnMgPSB0aGlzLl9nZXRTdWdnZXN0aW9ucygpOwogICAgICAgICAgICAgICAgdGhpcy5fcmVtb3ZlQ3Vyc29yKCk7CiAgICAgICAgICAgICAgICBuZXdDdXJzb3JJbmRleCA9ICRzdWdnZXN0aW9ucy5pbmRleCgkb2xkQ3Vyc29yKSArIGluY3JlbWVudDsKICAgICAgICAgICAgICAgIG5ld0N1cnNvckluZGV4ID0gKG5ld0N1cnNvckluZGV4ICsgMSkgJSAoJHN1Z2dlc3Rpb25zLmxlbmd0aCArIDEpIC0gMTsKICAgICAgICAgICAgICAgIGlmIChuZXdDdXJzb3JJbmRleCA9PT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXIoImN1cnNvclJlbW92ZWQiKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG5ld0N1cnNvckluZGV4IDwgLTEpIHsKICAgICAgICAgICAgICAgICAgICBuZXdDdXJzb3JJbmRleCA9ICRzdWdnZXN0aW9ucy5sZW5ndGggLSAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5fc2V0Q3Vyc29yKCRuZXdDdXJzb3IgPSAkc3VnZ2VzdGlvbnMuZXEobmV3Q3Vyc29ySW5kZXgpKTsKICAgICAgICAgICAgICAgIHRoaXMuX2Vuc3VyZVZpc2libGUoJG5ld0N1cnNvcik7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9lbnN1cmVWaXNpYmxlOiBmdW5jdGlvbiBlbnN1cmVWaXNpYmxlKCRlbCkgewogICAgICAgICAgICAgICAgdmFyIGVsVG9wLCBlbEJvdHRvbSwgbWVudVNjcm9sbFRvcCwgbWVudUhlaWdodDsKICAgICAgICAgICAgICAgIGVsVG9wID0gJGVsLnBvc2l0aW9uKCkudG9wOwogICAgICAgICAgICAgICAgZWxCb3R0b20gPSBlbFRvcCArICRlbC5vdXRlckhlaWdodCh0cnVlKTsKICAgICAgICAgICAgICAgIG1lbnVTY3JvbGxUb3AgPSB0aGlzLiRtZW51LnNjcm9sbFRvcCgpOwogICAgICAgICAgICAgICAgbWVudUhlaWdodCA9IHRoaXMuJG1lbnUuaGVpZ2h0KCkgKyBwYXJzZUludCh0aGlzLiRtZW51LmNzcygicGFkZGluZ1RvcCIpLCAxMCkgKyBwYXJzZUludCh0aGlzLiRtZW51LmNzcygicGFkZGluZ0JvdHRvbSIpLCAxMCk7CiAgICAgICAgICAgICAgICBpZiAoZWxUb3AgPCAwKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kbWVudS5zY3JvbGxUb3AobWVudVNjcm9sbFRvcCArIGVsVG9wKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobWVudUhlaWdodCA8IGVsQm90dG9tKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kbWVudS5zY3JvbGxUb3AobWVudVNjcm9sbFRvcCArIChlbEJvdHRvbSAtIG1lbnVIZWlnaHQpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgY2xvc2U6IGZ1bmN0aW9uIGNsb3NlKCkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNPcGVuKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5pc09wZW4gPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZW1vdmVDdXJzb3IoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9oaWRlKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCJjbG9zZWQiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgb3BlbjogZnVuY3Rpb24gb3BlbigpIHsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5pc09wZW4pIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmlzT3BlbiA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgIXRoaXMuaXNFbXB0eSAmJiB0aGlzLl9zaG93KCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCJvcGVuZWQiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2V0TGFuZ3VhZ2VEaXJlY3Rpb246IGZ1bmN0aW9uIHNldExhbmd1YWdlRGlyZWN0aW9uKGRpcikgewogICAgICAgICAgICAgICAgdGhpcy4kbWVudS5jc3MoZGlyID09PSAibHRyIiA/IGNzcy5sdHIgOiBjc3MucnRsKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgbW92ZUN1cnNvclVwOiBmdW5jdGlvbiBtb3ZlQ3Vyc29yVXAoKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9tb3ZlQ3Vyc29yKC0xKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgbW92ZUN1cnNvckRvd246IGZ1bmN0aW9uIG1vdmVDdXJzb3JEb3duKCkgewogICAgICAgICAgICAgICAgdGhpcy5fbW92ZUN1cnNvcigrMSk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGdldERhdHVtRm9yU3VnZ2VzdGlvbjogZnVuY3Rpb24gZ2V0RGF0dW1Gb3JTdWdnZXN0aW9uKCRlbCkgewogICAgICAgICAgICAgICAgdmFyIGRhdHVtID0gbnVsbDsKICAgICAgICAgICAgICAgIGlmICgkZWwubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgZGF0dW0gPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJhdzogRGF0YXNldC5leHRyYWN0RGF0dW0oJGVsKSwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IERhdGFzZXQuZXh0cmFjdFZhbHVlKCRlbCksCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFzZXROYW1lOiBEYXRhc2V0LmV4dHJhY3REYXRhc2V0TmFtZSgkZWwpCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBkYXR1bTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZ2V0RGF0dW1Gb3JDdXJzb3I6IGZ1bmN0aW9uIGdldERhdHVtRm9yQ3Vyc29yKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0RGF0dW1Gb3JTdWdnZXN0aW9uKHRoaXMuX2dldEN1cnNvcigpLmZpcnN0KCkpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBnZXREYXR1bUZvclRvcFN1Z2dlc3Rpb246IGZ1bmN0aW9uIGdldERhdHVtRm9yVG9wU3VnZ2VzdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldERhdHVtRm9yU3VnZ2VzdGlvbih0aGlzLl9nZXRTdWdnZXN0aW9ucygpLmZpcnN0KCkpOwogICAgICAgICAgICB9LAogICAgICAgICAgICB1cGRhdGU6IGZ1bmN0aW9uIHVwZGF0ZShxdWVyeSkgewogICAgICAgICAgICAgICAgXy5lYWNoKHRoaXMuZGF0YXNldHMsIHVwZGF0ZURhdGFzZXQpOwogICAgICAgICAgICAgICAgZnVuY3Rpb24gdXBkYXRlRGF0YXNldChkYXRhc2V0KSB7CiAgICAgICAgICAgICAgICAgICAgZGF0YXNldC51cGRhdGUocXVlcnkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbXB0eTogZnVuY3Rpb24gZW1wdHkoKSB7CiAgICAgICAgICAgICAgICBfLmVhY2godGhpcy5kYXRhc2V0cywgY2xlYXJEYXRhc2V0KTsKICAgICAgICAgICAgICAgIHRoaXMuaXNFbXB0eSA9IHRydWU7CiAgICAgICAgICAgICAgICBmdW5jdGlvbiBjbGVhckRhdGFzZXQoZGF0YXNldCkgewogICAgICAgICAgICAgICAgICAgIGRhdGFzZXQuY2xlYXIoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgaXNWaXNpYmxlOiBmdW5jdGlvbiBpc1Zpc2libGUoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5pc09wZW4gJiYgIXRoaXMuaXNFbXB0eTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZGVzdHJveTogZnVuY3Rpb24gZGVzdHJveSgpIHsKICAgICAgICAgICAgICAgIHRoaXMuJG1lbnUub2ZmKCIudHQiKTsKICAgICAgICAgICAgICAgIHRoaXMuJG1lbnUgPSBudWxsOwogICAgICAgICAgICAgICAgXy5lYWNoKHRoaXMuZGF0YXNldHMsIGRlc3Ryb3lEYXRhc2V0KTsKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGRlc3Ryb3lEYXRhc2V0KGRhdGFzZXQpIHsKICAgICAgICAgICAgICAgICAgICBkYXRhc2V0LmRlc3Ryb3koKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHJldHVybiBEcm9wZG93bjsKICAgICAgICBmdW5jdGlvbiBpbml0aWFsaXplRGF0YXNldChvRGF0YXNldCkgewogICAgICAgICAgICByZXR1cm4gbmV3IERhdGFzZXQob0RhdGFzZXQpOwogICAgICAgIH0KICAgIH0oKTsKICAgIHZhciBUeXBlYWhlYWQgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgYXR0cnNLZXkgPSAidHRBdHRycyI7CiAgICAgICAgZnVuY3Rpb24gVHlwZWFoZWFkKG8pIHsKICAgICAgICAgICAgdmFyICRtZW51LCAkaW5wdXQsICRoaW50OwogICAgICAgICAgICBvID0gbyB8fCB7fTsKICAgICAgICAgICAgaWYgKCFvLmlucHV0KSB7CiAgICAgICAgICAgICAgICAkLmVycm9yKCJtaXNzaW5nIGlucHV0Iik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5pc0FjdGl2YXRlZCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLmF1dG9zZWxlY3QgPSAhIW8uYXV0b3NlbGVjdDsKICAgICAgICAgICAgdGhpcy5taW5MZW5ndGggPSBfLmlzTnVtYmVyKG8ubWluTGVuZ3RoKSA/IG8ubWluTGVuZ3RoIDogMTsKICAgICAgICAgICAgdGhpcy4kbm9kZSA9IGJ1aWxkRG9tU3RydWN0dXJlKG8uaW5wdXQsIG8ud2l0aEhpbnQpOwogICAgICAgICAgICAkbWVudSA9IHRoaXMuJG5vZGUuZmluZCgiLnR0LWRyb3Bkb3duLW1lbnUiKTsKICAgICAgICAgICAgJGlucHV0ID0gdGhpcy4kbm9kZS5maW5kKCIudHQtaW5wdXQiKTsKICAgICAgICAgICAgJGhpbnQgPSB0aGlzLiRub2RlLmZpbmQoIi50dC1oaW50Iik7CiAgICAgICAgICAgICRpbnB1dC5vbigiYmx1ci50dCIsIGZ1bmN0aW9uKCRlKSB7CiAgICAgICAgICAgICAgICB2YXIgYWN0aXZlLCBpc0FjdGl2ZSwgaGFzQWN0aXZlOwogICAgICAgICAgICAgICAgYWN0aXZlID0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudDsKICAgICAgICAgICAgICAgIGlzQWN0aXZlID0gJG1lbnUuaXMoYWN0aXZlKTsKICAgICAgICAgICAgICAgIGhhc0FjdGl2ZSA9ICRtZW51LmhhcyhhY3RpdmUpLmxlbmd0aCA+IDA7CiAgICAgICAgICAgICAgICBpZiAoXy5pc01zaWUoKSAmJiAoaXNBY3RpdmUgfHwgaGFzQWN0aXZlKSkgewogICAgICAgICAgICAgICAgICAgICRlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgJGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7CiAgICAgICAgICAgICAgICAgICAgXy5kZWZlcihmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGlucHV0LmZvY3VzKCk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAkbWVudS5vbigibW91c2Vkb3duLnR0IiwgZnVuY3Rpb24oJGUpIHsKICAgICAgICAgICAgICAgICRlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0aGlzLmV2ZW50QnVzID0gby5ldmVudEJ1cyB8fCBuZXcgRXZlbnRCdXMoewogICAgICAgICAgICAgICAgZWw6ICRpbnB1dAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGhpcy5kcm9wZG93biA9IG5ldyBEcm9wZG93bih7CiAgICAgICAgICAgICAgICBtZW51OiAkbWVudSwKICAgICAgICAgICAgICAgIGRhdGFzZXRzOiBvLmRhdGFzZXRzCiAgICAgICAgICAgIH0pLm9uU3luYygic3VnZ2VzdGlvbkNsaWNrZWQiLCB0aGlzLl9vblN1Z2dlc3Rpb25DbGlja2VkLCB0aGlzKS5vblN5bmMoImN1cnNvck1vdmVkIiwgdGhpcy5fb25DdXJzb3JNb3ZlZCwgdGhpcykub25TeW5jKCJjdXJzb3JSZW1vdmVkIiwgdGhpcy5fb25DdXJzb3JSZW1vdmVkLCB0aGlzKS5vblN5bmMoIm9wZW5lZCIsIHRoaXMuX29uT3BlbmVkLCB0aGlzKS5vblN5bmMoImNsb3NlZCIsIHRoaXMuX29uQ2xvc2VkLCB0aGlzKS5vbkFzeW5jKCJkYXRhc2V0UmVuZGVyZWQiLCB0aGlzLl9vbkRhdGFzZXRSZW5kZXJlZCwgdGhpcyk7CiAgICAgICAgICAgIHRoaXMuaW5wdXQgPSBuZXcgSW5wdXQoewogICAgICAgICAgICAgICAgaW5wdXQ6ICRpbnB1dCwKICAgICAgICAgICAgICAgIGhpbnQ6ICRoaW50CiAgICAgICAgICAgIH0pLm9uU3luYygiZm9jdXNlZCIsIHRoaXMuX29uRm9jdXNlZCwgdGhpcykub25TeW5jKCJibHVycmVkIiwgdGhpcy5fb25CbHVycmVkLCB0aGlzKS5vblN5bmMoImVudGVyS2V5ZWQiLCB0aGlzLl9vbkVudGVyS2V5ZWQsIHRoaXMpLm9uU3luYygidGFiS2V5ZWQiLCB0aGlzLl9vblRhYktleWVkLCB0aGlzKS5vblN5bmMoImVzY0tleWVkIiwgdGhpcy5fb25Fc2NLZXllZCwgdGhpcykub25TeW5jKCJ1cEtleWVkIiwgdGhpcy5fb25VcEtleWVkLCB0aGlzKS5vblN5bmMoImRvd25LZXllZCIsIHRoaXMuX29uRG93bktleWVkLCB0aGlzKS5vblN5bmMoImxlZnRLZXllZCIsIHRoaXMuX29uTGVmdEtleWVkLCB0aGlzKS5vblN5bmMoInJpZ2h0S2V5ZWQiLCB0aGlzLl9vblJpZ2h0S2V5ZWQsIHRoaXMpLm9uU3luYygicXVlcnlDaGFuZ2VkIiwgdGhpcy5fb25RdWVyeUNoYW5nZWQsIHRoaXMpLm9uU3luYygid2hpdGVzcGFjZUNoYW5nZWQiLCB0aGlzLl9vbldoaXRlc3BhY2VDaGFuZ2VkLCB0aGlzKTsKICAgICAgICAgICAgdGhpcy5fc2V0TGFuZ3VhZ2VEaXJlY3Rpb24oKTsKICAgICAgICB9CiAgICAgICAgXy5taXhpbihUeXBlYWhlYWQucHJvdG90eXBlLCB7CiAgICAgICAgICAgIF9vblN1Z2dlc3Rpb25DbGlja2VkOiBmdW5jdGlvbiBvblN1Z2dlc3Rpb25DbGlja2VkKHR5cGUsICRlbCkgewogICAgICAgICAgICAgICAgdmFyIGRhdHVtOwogICAgICAgICAgICAgICAgaWYgKGRhdHVtID0gdGhpcy5kcm9wZG93bi5nZXREYXR1bUZvclN1Z2dlc3Rpb24oJGVsKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX3NlbGVjdChkYXR1bSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9vbkN1cnNvck1vdmVkOiBmdW5jdGlvbiBvbkN1cnNvck1vdmVkKCkgewogICAgICAgICAgICAgICAgdmFyIGRhdHVtID0gdGhpcy5kcm9wZG93bi5nZXREYXR1bUZvckN1cnNvcigpOwogICAgICAgICAgICAgICAgdGhpcy5pbnB1dC5zZXRJbnB1dFZhbHVlKGRhdHVtLnZhbHVlLCB0cnVlKTsKICAgICAgICAgICAgICAgIHRoaXMuZXZlbnRCdXMudHJpZ2dlcigiY3Vyc29yY2hhbmdlZCIsIGRhdHVtLnJhdywgZGF0dW0uZGF0YXNldE5hbWUpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfb25DdXJzb3JSZW1vdmVkOiBmdW5jdGlvbiBvbkN1cnNvclJlbW92ZWQoKSB7CiAgICAgICAgICAgICAgICB0aGlzLmlucHV0LnJlc2V0SW5wdXRWYWx1ZSgpOwogICAgICAgICAgICAgICAgdGhpcy5fdXBkYXRlSGludCgpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfb25EYXRhc2V0UmVuZGVyZWQ6IGZ1bmN0aW9uIG9uRGF0YXNldFJlbmRlcmVkKCkgewogICAgICAgICAgICAgICAgdGhpcy5fdXBkYXRlSGludCgpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfb25PcGVuZWQ6IGZ1bmN0aW9uIG9uT3BlbmVkKCkgewogICAgICAgICAgICAgICAgdGhpcy5fdXBkYXRlSGludCgpOwogICAgICAgICAgICAgICAgdGhpcy5ldmVudEJ1cy50cmlnZ2VyKCJvcGVuZWQiKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX29uQ2xvc2VkOiBmdW5jdGlvbiBvbkNsb3NlZCgpIHsKICAgICAgICAgICAgICAgIHRoaXMuaW5wdXQuY2xlYXJIaW50KCk7CiAgICAgICAgICAgICAgICB0aGlzLmV2ZW50QnVzLnRyaWdnZXIoImNsb3NlZCIpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfb25Gb2N1c2VkOiBmdW5jdGlvbiBvbkZvY3VzZWQoKSB7CiAgICAgICAgICAgICAgICB0aGlzLmlzQWN0aXZhdGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHRoaXMuZHJvcGRvd24ub3BlbigpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfb25CbHVycmVkOiBmdW5jdGlvbiBvbkJsdXJyZWQoKSB7CiAgICAgICAgICAgICAgICB0aGlzLmlzQWN0aXZhdGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICB0aGlzLmRyb3Bkb3duLmVtcHR5KCk7CiAgICAgICAgICAgICAgICB0aGlzLmRyb3Bkb3duLmNsb3NlKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9vbkVudGVyS2V5ZWQ6IGZ1bmN0aW9uIG9uRW50ZXJLZXllZCh0eXBlLCAkZSkgewogICAgICAgICAgICAgICAgdmFyIGN1cnNvckRhdHVtLCB0b3BTdWdnZXN0aW9uRGF0dW07CiAgICAgICAgICAgICAgICBjdXJzb3JEYXR1bSA9IHRoaXMuZHJvcGRvd24uZ2V0RGF0dW1Gb3JDdXJzb3IoKTsKICAgICAgICAgICAgICAgIHRvcFN1Z2dlc3Rpb25EYXR1bSA9IHRoaXMuZHJvcGRvd24uZ2V0RGF0dW1Gb3JUb3BTdWdnZXN0aW9uKCk7CiAgICAgICAgICAgICAgICBpZiAoY3Vyc29yRGF0dW0pIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9zZWxlY3QoY3Vyc29yRGF0dW0pOwogICAgICAgICAgICAgICAgICAgICRlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuYXV0b3NlbGVjdCAmJiB0b3BTdWdnZXN0aW9uRGF0dW0pIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9zZWxlY3QodG9wU3VnZ2VzdGlvbkRhdHVtKTsKICAgICAgICAgICAgICAgICAgICAkZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBfb25UYWJLZXllZDogZnVuY3Rpb24gb25UYWJLZXllZCh0eXBlLCAkZSkgewogICAgICAgICAgICAgICAgdmFyIGRhdHVtOwogICAgICAgICAgICAgICAgaWYgKGRhdHVtID0gdGhpcy5kcm9wZG93bi5nZXREYXR1bUZvckN1cnNvcigpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2VsZWN0KGRhdHVtKTsKICAgICAgICAgICAgICAgICAgICAkZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9hdXRvY29tcGxldGUodHJ1ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9vbkVzY0tleWVkOiBmdW5jdGlvbiBvbkVzY0tleWVkKCkgewogICAgICAgICAgICAgICAgdGhpcy5kcm9wZG93bi5jbG9zZSgpOwogICAgICAgICAgICAgICAgdGhpcy5pbnB1dC5yZXNldElucHV0VmFsdWUoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX29uVXBLZXllZDogZnVuY3Rpb24gb25VcEtleWVkKCkgewogICAgICAgICAgICAgICAgdmFyIHF1ZXJ5ID0gdGhpcy5pbnB1dC5nZXRRdWVyeSgpOwogICAgICAgICAgICAgICAgdGhpcy5kcm9wZG93bi5pc0VtcHR5ICYmIHF1ZXJ5Lmxlbmd0aCA+PSB0aGlzLm1pbkxlbmd0aCA/IHRoaXMuZHJvcGRvd24udXBkYXRlKHF1ZXJ5KSA6IHRoaXMuZHJvcGRvd24ubW92ZUN1cnNvclVwKCk7CiAgICAgICAgICAgICAgICB0aGlzLmRyb3Bkb3duLm9wZW4oKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX29uRG93bktleWVkOiBmdW5jdGlvbiBvbkRvd25LZXllZCgpIHsKICAgICAgICAgICAgICAgIHZhciBxdWVyeSA9IHRoaXMuaW5wdXQuZ2V0UXVlcnkoKTsKICAgICAgICAgICAgICAgIHRoaXMuZHJvcGRvd24uaXNFbXB0eSAmJiBxdWVyeS5sZW5ndGggPj0gdGhpcy5taW5MZW5ndGggPyB0aGlzLmRyb3Bkb3duLnVwZGF0ZShxdWVyeSkgOiB0aGlzLmRyb3Bkb3duLm1vdmVDdXJzb3JEb3duKCk7CiAgICAgICAgICAgICAgICB0aGlzLmRyb3Bkb3duLm9wZW4oKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX29uTGVmdEtleWVkOiBmdW5jdGlvbiBvbkxlZnRLZXllZCgpIHsKICAgICAgICAgICAgICAgIHRoaXMuZGlyID09PSAicnRsIiAmJiB0aGlzLl9hdXRvY29tcGxldGUoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX29uUmlnaHRLZXllZDogZnVuY3Rpb24gb25SaWdodEtleWVkKCkgewogICAgICAgICAgICAgICAgdGhpcy5kaXIgPT09ICJsdHIiICYmIHRoaXMuX2F1dG9jb21wbGV0ZSgpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfb25RdWVyeUNoYW5nZWQ6IGZ1bmN0aW9uIG9uUXVlcnlDaGFuZ2VkKGUsIHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICB0aGlzLmlucHV0LmNsZWFySGludElmSW52YWxpZCgpOwogICAgICAgICAgICAgICAgcXVlcnkubGVuZ3RoID49IHRoaXMubWluTGVuZ3RoID8gdGhpcy5kcm9wZG93bi51cGRhdGUocXVlcnkpIDogdGhpcy5kcm9wZG93bi5lbXB0eSgpOwogICAgICAgICAgICAgICAgdGhpcy5kcm9wZG93bi5vcGVuKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9zZXRMYW5ndWFnZURpcmVjdGlvbigpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfb25XaGl0ZXNwYWNlQ2hhbmdlZDogZnVuY3Rpb24gb25XaGl0ZXNwYWNlQ2hhbmdlZCgpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3VwZGF0ZUhpbnQoKTsKICAgICAgICAgICAgICAgIHRoaXMuZHJvcGRvd24ub3BlbigpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfc2V0TGFuZ3VhZ2VEaXJlY3Rpb246IGZ1bmN0aW9uIHNldExhbmd1YWdlRGlyZWN0aW9uKCkgewogICAgICAgICAgICAgICAgdmFyIGRpcjsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmRpciAhPT0gKGRpciA9IHRoaXMuaW5wdXQuZ2V0TGFuZ3VhZ2VEaXJlY3Rpb24oKSkpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmRpciA9IGRpcjsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRub2RlLmNzcygiZGlyZWN0aW9uIiwgZGlyKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmRyb3Bkb3duLnNldExhbmd1YWdlRGlyZWN0aW9uKGRpcik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF91cGRhdGVIaW50OiBmdW5jdGlvbiB1cGRhdGVIaW50KCkgewogICAgICAgICAgICAgICAgdmFyIGRhdHVtLCB2YWwsIHF1ZXJ5LCBlc2NhcGVkUXVlcnksIGZyb250TWF0Y2hSZWdFeCwgbWF0Y2g7CiAgICAgICAgICAgICAgICBkYXR1bSA9IHRoaXMuZHJvcGRvd24uZ2V0RGF0dW1Gb3JUb3BTdWdnZXN0aW9uKCk7CiAgICAgICAgICAgICAgICBpZiAoZGF0dW0gJiYgdGhpcy5kcm9wZG93bi5pc1Zpc2libGUoKSAmJiAhdGhpcy5pbnB1dC5oYXNPdmVyZmxvdygpKSB7CiAgICAgICAgICAgICAgICAgICAgdmFsID0gdGhpcy5pbnB1dC5nZXRJbnB1dFZhbHVlKCk7CiAgICAgICAgICAgICAgICAgICAgcXVlcnkgPSBJbnB1dC5ub3JtYWxpemVRdWVyeSh2YWwpOwogICAgICAgICAgICAgICAgICAgIGVzY2FwZWRRdWVyeSA9IF8uZXNjYXBlUmVnRXhDaGFycyhxdWVyeSk7CiAgICAgICAgICAgICAgICAgICAgZnJvbnRNYXRjaFJlZ0V4ID0gbmV3IFJlZ0V4cCgiXig/OiIgKyBlc2NhcGVkUXVlcnkgKyAiKSguKyQpIiwgImkiKTsKICAgICAgICAgICAgICAgICAgICBtYXRjaCA9IGZyb250TWF0Y2hSZWdFeC5leGVjKGRhdHVtLnZhbHVlKTsKICAgICAgICAgICAgICAgICAgICBtYXRjaCA/IHRoaXMuaW5wdXQuc2V0SGludCh2YWwgKyBtYXRjaFsxXSkgOiB0aGlzLmlucHV0LmNsZWFySGludCgpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmlucHV0LmNsZWFySGludCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBfYXV0b2NvbXBsZXRlOiBmdW5jdGlvbiBhdXRvY29tcGxldGUobGF4Q3Vyc29yKSB7CiAgICAgICAgICAgICAgICB2YXIgaGludCwgcXVlcnksIGlzQ3Vyc29yQXRFbmQsIGRhdHVtOwogICAgICAgICAgICAgICAgaGludCA9IHRoaXMuaW5wdXQuZ2V0SGludCgpOwogICAgICAgICAgICAgICAgcXVlcnkgPSB0aGlzLmlucHV0LmdldFF1ZXJ5KCk7CiAgICAgICAgICAgICAgICBpc0N1cnNvckF0RW5kID0gbGF4Q3Vyc29yIHx8IHRoaXMuaW5wdXQuaXNDdXJzb3JBdEVuZCgpOwogICAgICAgICAgICAgICAgaWYgKGhpbnQgJiYgcXVlcnkgIT09IGhpbnQgJiYgaXNDdXJzb3JBdEVuZCkgewogICAgICAgICAgICAgICAgICAgIGRhdHVtID0gdGhpcy5kcm9wZG93bi5nZXREYXR1bUZvclRvcFN1Z2dlc3Rpb24oKTsKICAgICAgICAgICAgICAgICAgICBkYXR1bSAmJiB0aGlzLmlucHV0LnNldElucHV0VmFsdWUoZGF0dW0udmFsdWUpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZXZlbnRCdXMudHJpZ2dlcigiYXV0b2NvbXBsZXRlZCIsIGRhdHVtLnJhdywgZGF0dW0uZGF0YXNldE5hbWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBfc2VsZWN0OiBmdW5jdGlvbiBzZWxlY3QoZGF0dW0pIHsKICAgICAgICAgICAgICAgIHRoaXMuaW5wdXQuc2V0UXVlcnkoZGF0dW0udmFsdWUpOwogICAgICAgICAgICAgICAgdGhpcy5pbnB1dC5zZXRJbnB1dFZhbHVlKGRhdHVtLnZhbHVlLCB0cnVlKTsKICAgICAgICAgICAgICAgIHRoaXMuX3NldExhbmd1YWdlRGlyZWN0aW9uKCk7CiAgICAgICAgICAgICAgICB0aGlzLmV2ZW50QnVzLnRyaWdnZXIoInNlbGVjdGVkIiwgZGF0dW0ucmF3LCBkYXR1bS5kYXRhc2V0TmFtZSk7CiAgICAgICAgICAgICAgICB0aGlzLmRyb3Bkb3duLmNsb3NlKCk7CiAgICAgICAgICAgICAgICBfLmRlZmVyKF8uYmluZCh0aGlzLmRyb3Bkb3duLmVtcHR5LCB0aGlzLmRyb3Bkb3duKSk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG9wZW46IGZ1bmN0aW9uIG9wZW4oKSB7CiAgICAgICAgICAgICAgICB0aGlzLmRyb3Bkb3duLm9wZW4oKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgY2xvc2U6IGZ1bmN0aW9uIGNsb3NlKCkgewogICAgICAgICAgICAgICAgdGhpcy5kcm9wZG93bi5jbG9zZSgpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBzZXRWYWw6IGZ1bmN0aW9uIHNldFZhbCh2YWwpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzQWN0aXZhdGVkKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnB1dC5zZXRJbnB1dFZhbHVlKHZhbCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRoaXMuaW5wdXQuc2V0UXVlcnkodmFsKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmlucHV0LnNldElucHV0VmFsdWUodmFsLCB0cnVlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuX3NldExhbmd1YWdlRGlyZWN0aW9uKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGdldFZhbDogZnVuY3Rpb24gZ2V0VmFsKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaW5wdXQuZ2V0UXVlcnkoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZGVzdHJveTogZnVuY3Rpb24gZGVzdHJveSgpIHsKICAgICAgICAgICAgICAgIHRoaXMuaW5wdXQuZGVzdHJveSgpOwogICAgICAgICAgICAgICAgdGhpcy5kcm9wZG93bi5kZXN0cm95KCk7CiAgICAgICAgICAgICAgICBkZXN0cm95RG9tU3RydWN0dXJlKHRoaXMuJG5vZGUpOwogICAgICAgICAgICAgICAgdGhpcy4kbm9kZSA9IG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICByZXR1cm4gVHlwZWFoZWFkOwogICAgICAgIGZ1bmN0aW9uIGJ1aWxkRG9tU3RydWN0dXJlKGlucHV0LCB3aXRoSGludCkgewogICAgICAgICAgICB2YXIgJGlucHV0LCAkd3JhcHBlciwgJGRyb3Bkb3duLCAkaGludDsKICAgICAgICAgICAgJGlucHV0ID0gJChpbnB1dCk7CiAgICAgICAgICAgICR3cmFwcGVyID0gJChodG1sLndyYXBwZXIpLmNzcyhjc3Mud3JhcHBlcik7CiAgICAgICAgICAgICRkcm9wZG93biA9ICQoaHRtbC5kcm9wZG93bikuY3NzKGNzcy5kcm9wZG93bik7CiAgICAgICAgICAgICRoaW50ID0gJGlucHV0LmNsb25lKCkuY3NzKGNzcy5oaW50KS5jc3MoZ2V0QmFja2dyb3VuZFN0eWxlcygkaW5wdXQpKTsKICAgICAgICAgICAgJGhpbnQudmFsKCIiKS5yZW1vdmVEYXRhKCkuYWRkQ2xhc3MoInR0LWhpbnQiKS5yZW1vdmVBdHRyKCJpZCBuYW1lIHBsYWNlaG9sZGVyIikucHJvcCgiZGlzYWJsZWQiLCB0cnVlKS5hdHRyKHsKICAgICAgICAgICAgICAgIGF1dG9jb21wbGV0ZTogIm9mZiIsCiAgICAgICAgICAgICAgICBzcGVsbGNoZWNrOiAiZmFsc2UiCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAkaW5wdXQuZGF0YShhdHRyc0tleSwgewogICAgICAgICAgICAgICAgZGlyOiAkaW5wdXQuYXR0cigiZGlyIiksCiAgICAgICAgICAgICAgICBhdXRvY29tcGxldGU6ICRpbnB1dC5hdHRyKCJhdXRvY29tcGxldGUiKSwKICAgICAgICAgICAgICAgIHNwZWxsY2hlY2s6ICRpbnB1dC5hdHRyKCJzcGVsbGNoZWNrIiksCiAgICAgICAgICAgICAgICBzdHlsZTogJGlucHV0LmF0dHIoInN0eWxlIikKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICRpbnB1dC5hZGRDbGFzcygidHQtaW5wdXQiKS5hdHRyKHsKICAgICAgICAgICAgICAgIGF1dG9jb21wbGV0ZTogIm9mZiIsCiAgICAgICAgICAgICAgICBzcGVsbGNoZWNrOiBmYWxzZQogICAgICAgICAgICB9KS5jc3Mod2l0aEhpbnQgPyBjc3MuaW5wdXQgOiBjc3MuaW5wdXRXaXRoTm9IaW50KTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICEkaW5wdXQuYXR0cigiZGlyIikgJiYgJGlucHV0LmF0dHIoImRpciIsICJhdXRvIik7CiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHt9CiAgICAgICAgICAgIHJldHVybiAkaW5wdXQud3JhcCgkd3JhcHBlcikucGFyZW50KCkucHJlcGVuZCh3aXRoSGludCA/ICRoaW50IDogbnVsbCkuYXBwZW5kKCRkcm9wZG93bik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGdldEJhY2tncm91bmRTdHlsZXMoJGVsKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQXR0YWNobWVudDogJGVsLmNzcygiYmFja2dyb3VuZC1hdHRhY2htZW50IiksCiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ2xpcDogJGVsLmNzcygiYmFja2dyb3VuZC1jbGlwIiksCiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICRlbC5jc3MoImJhY2tncm91bmQtY29sb3IiKSwKICAgICAgICAgICAgICAgIGJhY2tncm91bmRJbWFnZTogJGVsLmNzcygiYmFja2dyb3VuZC1pbWFnZSIpLAogICAgICAgICAgICAgICAgYmFja2dyb3VuZE9yaWdpbjogJGVsLmNzcygiYmFja2dyb3VuZC1vcmlnaW4iKSwKICAgICAgICAgICAgICAgIGJhY2tncm91bmRQb3NpdGlvbjogJGVsLmNzcygiYmFja2dyb3VuZC1wb3NpdGlvbiIpLAogICAgICAgICAgICAgICAgYmFja2dyb3VuZFJlcGVhdDogJGVsLmNzcygiYmFja2dyb3VuZC1yZXBlYXQiKSwKICAgICAgICAgICAgICAgIGJhY2tncm91bmRTaXplOiAkZWwuY3NzKCJiYWNrZ3JvdW5kLXNpemUiKQogICAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBkZXN0cm95RG9tU3RydWN0dXJlKCRub2RlKSB7CiAgICAgICAgICAgIHZhciAkaW5wdXQgPSAkbm9kZS5maW5kKCIudHQtaW5wdXQiKTsKICAgICAgICAgICAgXy5lYWNoKCRpbnB1dC5kYXRhKGF0dHJzS2V5KSwgZnVuY3Rpb24odmFsLCBrZXkpIHsKICAgICAgICAgICAgICAgIF8uaXNVbmRlZmluZWQodmFsKSA/ICRpbnB1dC5yZW1vdmVBdHRyKGtleSkgOiAkaW5wdXQuYXR0cihrZXksIHZhbCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAkaW5wdXQuZGV0YWNoKCkucmVtb3ZlRGF0YShhdHRyc0tleSkucmVtb3ZlQ2xhc3MoInR0LWlucHV0IikuaW5zZXJ0QWZ0ZXIoJG5vZGUpOwogICAgICAgICAgICAkbm9kZS5yZW1vdmUoKTsKICAgICAgICB9CiAgICB9KCk7CiAgICAoZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIG9sZCwgdHlwZWFoZWFkS2V5LCBtZXRob2RzOwogICAgICAgIG9sZCA9ICQuZm4udHlwZWFoZWFkOwogICAgICAgIHR5cGVhaGVhZEtleSA9ICJ0dFR5cGVhaGVhZCI7CiAgICAgICAgbWV0aG9kcyA9IHsKICAgICAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gaW5pdGlhbGl6ZShvLCBkYXRhc2V0cykgewogICAgICAgICAgICAgICAgZGF0YXNldHMgPSBfLmlzQXJyYXkoZGF0YXNldHMpID8gZGF0YXNldHMgOiBbXS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSk7CiAgICAgICAgICAgICAgICBvID0gbyB8fCB7fTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goYXR0YWNoKTsKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGF0dGFjaCgpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgJGlucHV0ID0gJCh0aGlzKSwgZXZlbnRCdXMsIHR5cGVhaGVhZDsKICAgICAgICAgICAgICAgICAgICBfLmVhY2goZGF0YXNldHMsIGZ1bmN0aW9uKGQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZC5oaWdobGlnaHQgPSAhIW8uaGlnaGxpZ2h0OwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHR5cGVhaGVhZCA9IG5ldyBUeXBlYWhlYWQoewogICAgICAgICAgICAgICAgICAgICAgICBpbnB1dDogJGlucHV0LAogICAgICAgICAgICAgICAgICAgICAgICBldmVudEJ1czogZXZlbnRCdXMgPSBuZXcgRXZlbnRCdXMoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWw6ICRpbnB1dAogICAgICAgICAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgd2l0aEhpbnQ6IF8uaXNVbmRlZmluZWQoby5oaW50KSA/IHRydWUgOiAhIW8uaGludCwKICAgICAgICAgICAgICAgICAgICAgICAgbWluTGVuZ3RoOiBvLm1pbkxlbmd0aCwKICAgICAgICAgICAgICAgICAgICAgICAgYXV0b3NlbGVjdDogby5hdXRvc2VsZWN0LAogICAgICAgICAgICAgICAgICAgICAgICBkYXRhc2V0czogZGF0YXNldHMKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAkaW5wdXQuZGF0YSh0eXBlYWhlYWRLZXksIHR5cGVhaGVhZCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG9wZW46IGZ1bmN0aW9uIG9wZW4oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKG9wZW5UeXBlYWhlYWQpOwogICAgICAgICAgICAgICAgZnVuY3Rpb24gb3BlblR5cGVhaGVhZCgpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgJGlucHV0ID0gJCh0aGlzKSwgdHlwZWFoZWFkOwogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlYWhlYWQgPSAkaW5wdXQuZGF0YSh0eXBlYWhlYWRLZXkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVhaGVhZC5vcGVuKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBjbG9zZTogZnVuY3Rpb24gY2xvc2UoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGNsb3NlVHlwZWFoZWFkKTsKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGNsb3NlVHlwZWFoZWFkKCkgewogICAgICAgICAgICAgICAgICAgIHZhciAkaW5wdXQgPSAkKHRoaXMpLCB0eXBlYWhlYWQ7CiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVhaGVhZCA9ICRpbnB1dC5kYXRhKHR5cGVhaGVhZEtleSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZWFoZWFkLmNsb3NlKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICB2YWw6IGZ1bmN0aW9uIHZhbChuZXdWYWwpIHsKICAgICAgICAgICAgICAgIHJldHVybiAhYXJndW1lbnRzLmxlbmd0aCA/IGdldFZhbCh0aGlzLmZpcnN0KCkpIDogdGhpcy5lYWNoKHNldFZhbCk7CiAgICAgICAgICAgICAgICBmdW5jdGlvbiBzZXRWYWwoKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyICRpbnB1dCA9ICQodGhpcyksIHR5cGVhaGVhZDsKICAgICAgICAgICAgICAgICAgICBpZiAodHlwZWFoZWFkID0gJGlucHV0LmRhdGEodHlwZWFoZWFkS2V5KSkgewogICAgICAgICAgICAgICAgICAgICAgICB0eXBlYWhlYWQuc2V0VmFsKG5ld1ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZnVuY3Rpb24gZ2V0VmFsKCRpbnB1dCkgewogICAgICAgICAgICAgICAgICAgIHZhciB0eXBlYWhlYWQsIHF1ZXJ5OwogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlYWhlYWQgPSAkaW5wdXQuZGF0YSh0eXBlYWhlYWRLZXkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXJ5ID0gdHlwZWFoZWFkLmdldFZhbCgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gcXVlcnk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uIGRlc3Ryb3koKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKHVuYXR0YWNoKTsKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHVuYXR0YWNoKCkgewogICAgICAgICAgICAgICAgICAgIHZhciAkaW5wdXQgPSAkKHRoaXMpLCB0eXBlYWhlYWQ7CiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVhaGVhZCA9ICRpbnB1dC5kYXRhKHR5cGVhaGVhZEtleSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZWFoZWFkLmRlc3Ryb3koKTsKICAgICAgICAgICAgICAgICAgICAgICAgJGlucHV0LnJlbW92ZURhdGEodHlwZWFoZWFkS2V5KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgICQuZm4udHlwZWFoZWFkID0gZnVuY3Rpb24obWV0aG9kKSB7CiAgICAgICAgICAgIGlmIChtZXRob2RzW21ldGhvZF0pIHsKICAgICAgICAgICAgICAgIHJldHVybiBtZXRob2RzW21ldGhvZF0uYXBwbHkodGhpcywgW10uc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBtZXRob2RzLmluaXRpYWxpemUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgJC5mbi50eXBlYWhlYWQubm9Db25mbGljdCA9IGZ1bmN0aW9uIG5vQ29uZmxpY3QoKSB7CiAgICAgICAgICAgICQuZm4udHlwZWFoZWFkID0gb2xkOwogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9OwogICAgfSkoKTsKfSkod2luZG93LmpRdWVyeSk7CmRlZmluZSgidHlwZWFoZWFkIiwgZnVuY3Rpb24oKXt9KTsKCi8qIQogKiBqUXVlcnkgQ29va2llIFBsdWdpbiB2MS40LjEKICogaHR0cHM6Ly9naXRodWIuY29tL2NhcmhhcnRsL2pxdWVyeS1jb29raWUKICoKICogQ29weXJpZ2h0IDIwMTMgS2xhdXMgSGFydGwKICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlCiAqLwooZnVuY3Rpb24gKGZhY3RvcnkpIHsKCWlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHsKCQkvLyBBTUQKCQlkZWZpbmUoJ2pRdWVyeUNvb2tpZScsWydqcXVlcnknXSwgZmFjdG9yeSk7Cgl9IGVsc2UgaWYgKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JykgewoJCS8vIENvbW1vbkpTCgkJZmFjdG9yeShyZXF1aXJlKCdqcXVlcnknKSk7Cgl9IGVsc2UgewoJCS8vIEJyb3dzZXIgZ2xvYmFscwoJCWZhY3RvcnkoalF1ZXJ5KTsKCX0KfShmdW5jdGlvbiAoJCkgewoKCXZhciBwbHVzZXMgPSAvXCsvZzsKCglmdW5jdGlvbiBlbmNvZGUocykgewoJCXJldHVybiBjb25maWcucmF3ID8gcyA6IGVuY29kZVVSSUNvbXBvbmVudChzKTsKCX0KCglmdW5jdGlvbiBkZWNvZGUocykgewoJCXJldHVybiBjb25maWcucmF3ID8gcyA6IGRlY29kZVVSSUNvbXBvbmVudChzKTsKCX0KCglmdW5jdGlvbiBzdHJpbmdpZnlDb29raWVWYWx1ZSh2YWx1ZSkgewoJCXJldHVybiBlbmNvZGUoY29uZmlnLmpzb24gPyBKU09OLnN0cmluZ2lmeSh2YWx1ZSkgOiBTdHJpbmcodmFsdWUpKTsKCX0KCglmdW5jdGlvbiBwYXJzZUNvb2tpZVZhbHVlKHMpIHsKCQlpZiAocy5pbmRleE9mKCciJykgPT09IDApIHsKCQkJLy8gVGhpcyBpcyBhIHF1b3RlZCBjb29raWUgYXMgYWNjb3JkaW5nIHRvIFJGQzIwNjgsIHVuZXNjYXBlLi4uCgkJCXMgPSBzLnNsaWNlKDEsIC0xKS5yZXBsYWNlKC9cXCIvZywgJyInKS5yZXBsYWNlKC9cXFxcL2csICdcXCcpOwoJCX0KCgkJdHJ5IHsKCQkJLy8gUmVwbGFjZSBzZXJ2ZXItc2lkZSB3cml0dGVuIHBsdXNlcyB3aXRoIHNwYWNlcy4KCQkJLy8gSWYgd2UgY2FuJ3QgZGVjb2RlIHRoZSBjb29raWUsIGlnbm9yZSBpdCwgaXQncyB1bnVzYWJsZS4KCQkJLy8gSWYgd2UgY2FuJ3QgcGFyc2UgdGhlIGNvb2tpZSwgaWdub3JlIGl0LCBpdCdzIHVudXNhYmxlLgoJCQlzID0gZGVjb2RlVVJJQ29tcG9uZW50KHMucmVwbGFjZShwbHVzZXMsICcgJykpOwoJCQlyZXR1cm4gY29uZmlnLmpzb24gPyBKU09OLnBhcnNlKHMpIDogczsKCQl9IGNhdGNoKGUpIHt9Cgl9CgoJZnVuY3Rpb24gcmVhZChzLCBjb252ZXJ0ZXIpIHsKCQl2YXIgdmFsdWUgPSBjb25maWcucmF3ID8gcyA6IHBhcnNlQ29va2llVmFsdWUocyk7CgkJcmV0dXJuICQuaXNGdW5jdGlvbihjb252ZXJ0ZXIpID8gY29udmVydGVyKHZhbHVlKSA6IHZhbHVlOwoJfQoKCXZhciBjb25maWcgPSAkLmNvb2tpZSA9IGZ1bmN0aW9uIChrZXksIHZhbHVlLCBvcHRpb25zKSB7CgoJCS8vIFdyaXRlCgoJCWlmICh2YWx1ZSAhPT0gdW5kZWZpbmVkICYmICEkLmlzRnVuY3Rpb24odmFsdWUpKSB7CgkJCW9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgY29uZmlnLmRlZmF1bHRzLCBvcHRpb25zKTsKCgkJCWlmICh0eXBlb2Ygb3B0aW9ucy5leHBpcmVzID09PSAnbnVtYmVyJykgewoJCQkJdmFyIGRheXMgPSBvcHRpb25zLmV4cGlyZXMsIHQgPSBvcHRpb25zLmV4cGlyZXMgPSBuZXcgRGF0ZSgpOwoJCQkJdC5zZXRUaW1lKCt0ICsgZGF5cyAqIDg2NGUrNSk7CgkJCX0KCgkJCXJldHVybiAoZG9jdW1lbnQuY29va2llID0gWwoJCQkJZW5jb2RlKGtleSksICc9Jywgc3RyaW5naWZ5Q29va2llVmFsdWUodmFsdWUpLAoJCQkJb3B0aW9ucy5leHBpcmVzID8gJzsgZXhwaXJlcz0nICsgb3B0aW9ucy5leHBpcmVzLnRvVVRDU3RyaW5nKCkgOiAnJywgLy8gdXNlIGV4cGlyZXMgYXR0cmlidXRlLCBtYXgtYWdlIGlzIG5vdCBzdXBwb3J0ZWQgYnkgSUUKCQkJCW9wdGlvbnMucGF0aCAgICA/ICc7IHBhdGg9JyArIG9wdGlvbnMucGF0aCA6ICcnLAoJCQkJb3B0aW9ucy5kb21haW4gID8gJzsgZG9tYWluPScgKyBvcHRpb25zLmRvbWFpbiA6ICcnLAoJCQkJb3B0aW9ucy5zZWN1cmUgID8gJzsgc2VjdXJlJyA6ICcnCgkJCV0uam9pbignJykpOwoJCX0KCgkJLy8gUmVhZAoKCQl2YXIgcmVzdWx0ID0ga2V5ID8gdW5kZWZpbmVkIDoge307CgoJCS8vIFRvIHByZXZlbnQgdGhlIGZvciBsb29wIGluIHRoZSBmaXJzdCBwbGFjZSBhc3NpZ24gYW4gZW1wdHkgYXJyYXkKCQkvLyBpbiBjYXNlIHRoZXJlIGFyZSBubyBjb29raWVzIGF0IGFsbC4gQWxzbyBwcmV2ZW50cyBvZGQgcmVzdWx0IHdoZW4KCQkvLyBjYWxsaW5nICQuY29va2llKCkuCgkJdmFyIGNvb2tpZXMgPSBkb2N1bWVudC5jb29raWUgPyBkb2N1bWVudC5jb29raWUuc3BsaXQoJzsgJykgOiBbXTsKCgkJZm9yICh2YXIgaSA9IDAsIGwgPSBjb29raWVzLmxlbmd0aDsgaSA8IGw7IGkrKykgewoJCQl2YXIgcGFydHMgPSBjb29raWVzW2ldLnNwbGl0KCc9Jyk7CgkJCXZhciBuYW1lID0gZGVjb2RlKHBhcnRzLnNoaWZ0KCkpOwoJCQl2YXIgY29va2llID0gcGFydHMuam9pbignPScpOwoKCQkJaWYgKGtleSAmJiBrZXkgPT09IG5hbWUpIHsKCQkJCS8vIElmIHNlY29uZCBhcmd1bWVudCAodmFsdWUpIGlzIGEgZnVuY3Rpb24gaXQncyBhIGNvbnZlcnRlci4uLgoJCQkJcmVzdWx0ID0gcmVhZChjb29raWUsIHZhbHVlKTsKCQkJCWJyZWFrOwoJCQl9CgoJCQkvLyBQcmV2ZW50IHN0b3JpbmcgYSBjb29raWUgdGhhdCB3ZSBjb3VsZG4ndCBkZWNvZGUuCgkJCWlmICgha2V5ICYmIChjb29raWUgPSByZWFkKGNvb2tpZSkpICE9PSB1bmRlZmluZWQpIHsKCQkJCXJlc3VsdFtuYW1lXSA9IGNvb2tpZTsKCQkJfQoJCX0KCgkJcmV0dXJuIHJlc3VsdDsKCX07CgoJY29uZmlnLmRlZmF1bHRzID0ge307CgoJJC5yZW1vdmVDb29raWUgPSBmdW5jdGlvbiAoa2V5LCBvcHRpb25zKSB7CgkJaWYgKCQuY29va2llKGtleSkgPT09IHVuZGVmaW5lZCkgewoJCQlyZXR1cm4gZmFsc2U7CgkJfQoKCQkvLyBNdXN0IG5vdCBhbHRlciBvcHRpb25zLCB0aHVzIGV4dGVuZGluZyBhIGZyZXNoIG9iamVjdC4uLgoJCSQuY29va2llKGtleSwgJycsICQuZXh0ZW5kKHt9LCBvcHRpb25zLCB7IGV4cGlyZXM6IC0xIH0pKTsKCQlyZXR1cm4gISQuY29va2llKGtleSk7Cgl9OwoKfSkpOwoKLyoKICogZ2l2ZW4gYSBwYXJ0aWFsIFJpY2hTZXF1ZW5jZSBzdHJpbmcsIHJldHVybiB2YWx1ZSBhdXRvY29tcGxldGlvbiB2YWx1ZXMuCiAqIFRoaXMgY2FuIGNvdmVyOgogKiAtIGdpdmUgbWUgYSBudW1lcmljYWwgdmFsdWUsIEknbGwgcmV0dXJuIGNsb3NlIG1vZGlmaWNhdGlvbiBsaXN0CiAqIC0gZ2l2ZSBtZSBhIHBhcnRpYWwgbW9kaWZpY2F0aW9uIG5hbWUsIEknbGwgc2hvb3QgdGhlIG1hdGNoaW5nIG1vZGlmaWNhdGlvbnMKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCmRlZmluZSgnZmlzaHRvbmVzL3NlcnZpY2VzL2RyeS9SaWNoU2VxdWVuY2VBdXRvQ29tcGxldGlvbmVyJyxbJ2pxdWVyeScsICd1bmRlcnNjb3JlJywgJ0JhY2tib25lJywgJ2Zpc2h0b25lcy9jb2xsZWN0aW9ucy9kcnkvQW1pbm9BY2lkRGljdGlvbmFyeScsICdmaXNodG9uZXMvY29sbGVjdGlvbnMvZHJ5L1Jlc2lkdWVNb2RpZmljYXRpb25EaWN0aW9uYXJ5J10sIGZ1bmN0aW9uICgkLCBfLCBCYWNrYm9uZSwgZGljb0FBLCBkaWNvUmVzTW9kKSB7CgogICAgdmFyIFJpY2hTZXF1ZW5jZUF1dG9Db21wbGV0aW9uZXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgIHNlbGYubW9kaWZOYW1lcyA9IF8uY2hhaW4oZGljb1Jlc01vZC5tb2RlbHMpLmNvbGxlY3QoZnVuY3Rpb24gKHJtKSB7CiAgICAgICAgICAgIHJldHVybiBybS5nZXQoJ25hbWUnKQogICAgICAgIH0pLnNvcnQoKS52YWx1ZSgpOwoKICAgICAgICBzZWxmLm1vZGlmMm1hc3MgPSB7fQogICAgICAgIF8uZWFjaChkaWNvUmVzTW9kLm1vZGVscywgZnVuY3Rpb24gKHJtKSB7CiAgICAgICAgICAgIHNlbGYubW9kaWYybWFzc1tybS5nZXQoJ25hbWUnKV0gPSBybS5nZXQoJ21hc3MnKQogICAgICAgIH0pCiAgICB9OwoKICAgIC8qKgogICAgICogcmV0dXJuIGEgdHJ1ZSB2YWx1ZSBpZiB0aGUgY3VycmVudCB0aGVyZSBpcyBub3QgY2xvc2VlZCBjdXJseSBicmFja2V0IGJlZm9yZSB0aGUgbmV4dCBvcGVuIG9yIHRoZSBlbmQKICAgICAqIChpLmUuLCBpZiB3ZSBjYWxsIHRoYXQgZnVuY2l0b24gZnRlciBvcGVuaW5nIGEgY3VscnksIGl0IHdpbGwgdXMgaWYgd2Ugc2hhbGwgYWRkIGEgY29zZSBvbmUpCiAgICAgKiBAcGFyYW0ge09iamVjdH0gdHh0CiAgICAgKiBAcGFyYW0ge09iamVjdH0gcG9zCiAgICAgKi8KICAgIFJpY2hTZXF1ZW5jZUF1dG9Db21wbGV0aW9uZXIucHJvdG90eXBlLmNsb3NlQ3VybHkgPSBmdW5jdGlvbiAodHh0LCBwb3MpIHsKICAgICAgICB2YXIgdGFpbCA9IHR4dC5zdWJzdHJpbmcocG9zKQogICAgICAgIGlmICh0YWlsLmluZGV4T2YoJ30nKSA8IDAgfHwgKHRhaWwuaW5kZXhPZigneycpID4gMCkgJiYgKHRhaWwuaW5kZXhPZignfScpID4gdGFpbC5pbmRleE9mKCd7JykpKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH07CiAgICAvKioKICAgICAqIGdpdmVuIGEgdGV4dCBhbmQgYSBwb3N0aW9uLCBleHRyYWN0IHRoZSBwcmVmaXggdGhhdCB3aWxsIGJlIHVzZWQgYXMgYSBhbmNob3IgZm9yIGF1dG9jb21wbGV0aW9uLCBhcyB3ZWxsIGFzIHRoZSB0ZXh0IHBvc2l0aW9uIHRvIGJlIHJlcGxhY2VkIGJ5IHRoZSBhdXRvY29tcGxldGlvbmVyCiAgICAgKiBUaGluayB0aGF0IHdlIGNhbiBjb21lIGJhY2sgaW50byAgY3VybHkgYnJhY2tldHMgYW5kIHdlIHN0aWxsIHdhbnQgc29tZSBjb21wbGV0aW9uCiAgICAgKiByZXR1cm4gbnVsbCBpcyB3ZSBhcmUgbm90IGF0IGEgcG9zaXRpb24gdG8gZ2V0IGFueSByZXBsYWNlbWVudAogICAgICoKICAgICAqIGdvIGNoZWNrIGphc21pbmUgUmljaFNlcXVlbmNlQXV0b0NvbXBsZXRpb25lciUyMHJlcGxhY2VhYmxlIHRvIGdldCB0b25zIG9mIGV4YW1wbGVzCiAgICAgKiBAcGFyYW0ge09iamVjdH0gdHh0CiAgICAgKiBAcGFyYW0ge09iamVjdH0gcG9zCiAgICAgKi8KICAgIFJpY2hTZXF1ZW5jZUF1dG9Db21wbGV0aW9uZXIucHJvdG90eXBlLnJlcGxhY2VhYmxlID0gZnVuY3Rpb24gKHR4dCwgcG9zKSB7CiAgICAgICAgdmFyIGJlZm9yZSA9IHR4dC5zdWJzdHJpbmcoMCwgcG9zKQogICAgICAgIHZhciBhZnRlciA9IHR4dC5zdWJzdHJpbmcocG9zKQoKICAgICAgICBpZiAoYmVmb3JlLmluZGV4T2YoJ3snKSA8IDApIHsKICAgICAgICAgICAgLy9ub3QgZXZlbiBhbiBvcGVuIGN1cmx5LCBkb24ndCB3YXN0ZSBteSB0aW1lCiAgICAgICAgICAgIHJldHVybiBudWxsCiAgICAgICAgfQoKICAgICAgICBiZWZvcmUgPSBiZWZvcmUucmVwbGFjZSgvLipcfS8sICcnKTsKICAgICAgICBpZiAoYmVmb3JlLmluZGV4T2YoJ3snKSA8IDApIHsKICAgICAgICAgICAgLy93ZSBhcmUgbm90IGFmdGVyIGFuIG9wZW4gY3VybHkgYnJhY2tldAogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAgYmVmb3JlID0gYmVmb3JlLnJlcGxhY2UoLy4qW1x7LF0vLCAnJyk7CgogICAgICAgIGFmdGVyID0gYWZ0ZXIucmVwbGFjZSgvW1x9LF0uKi8sICcnKTsKCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgcHJlZml4OiBiZWZvcmUsCiAgICAgICAgICAgIHBvc1N0YXJ0OiBwb3MgLSBiZWZvcmUubGVuZ3RoLAogICAgICAgICAgICBwb3NFbmQ6IHBvcyArIGFmdGVyLmxlbmd0aAogICAgICAgIH0KCiAgICB9OwoKICAgIC8qKgogICAgICogZ2V0IHRoZSBsaXN0IG9mIG1vZGlmY2F0aW9uIG1hYXRjaGluZyB0aGUgcHJlZml4LiBpLmUuCiAgICAgKiBzdGFydGluZyB3aXRoIHRoZSBwcmVmaXgKICAgICAqIGNhc2UgaXMgbm90IGltcG9ydGFudAogICAgICogcHJlZml4IGNhbiBiZSBhIG1hc3MgKCsvLSAxIERhKQogICAgICogQHBhcmFtIHtPYmplY3R9IHByZWZpeAogICAgICovCiAgICBSaWNoU2VxdWVuY2VBdXRvQ29tcGxldGlvbmVyLnByb3RvdHlwZS5nZXRMaXN0ID0gZnVuY3Rpb24gKHByZWZpeCkgewogICAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgICAgdmFyIG1hc3MgPSBwYXJzZUZsb2F0KHByZWZpeCkKICAgICAgICBpZiAoXy5pc0Zpbml0ZShtYXNzKSkgewogICAgICAgICAgICB2YXIgbUluZiA9IG1hc3MgLSAxLjAKICAgICAgICAgICAgdmFyIG1TdXAgPSBtYXNzICsgMS4wCiAgICAgICAgICAgIHJldHVybiBfLmNoYWluKHNlbGYubW9kaWYybWFzcykuY29sbGVjdChmdW5jdGlvbiAobWFzcywgbmFtZSkgewogICAgICAgICAgICAgICAgaWYgKG1hc3MgPCBtSW5mIHx8IG1hc3MgPiBtU3VwKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGwKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBuYW1lCiAgICAgICAgICAgIH0pLmZpbHRlcihmdW5jdGlvbiAobikgewogICAgICAgICAgICAgICAgcmV0dXJuIG4gIT0gbnVsbAogICAgICAgICAgICB9KS52YWx1ZSgpCiAgICAgICAgfQoKICAgICAgICBwcmVmaXggPSBwcmVmaXgudG9Mb3dlckNhc2UoKTsKICAgICAgICByZXR1cm4gXy5maWx0ZXIodGhpcy5tb2RpZk5hbWVzLCBmdW5jdGlvbiAobikgewogICAgICAgICAgICByZXR1cm4gbi50b0xvd2VyQ2FzZSgpLmluZGV4T2YocHJlZml4KSA9PSAwCiAgICAgICAgfSkKICAgIH0KICAgIHJldHVybiBSaWNoU2VxdWVuY2VBdXRvQ29tcGxldGlvbmVyOwp9KTsKCi8qCiBSZXF1aXJlSlMgdGV4dCAwLjI3LjAgQ29weXJpZ2h0IChjKSAyMDEwLTIwMTEsIFRoZSBEb2pvIEZvdW5kYXRpb24gQWxsIFJpZ2h0cyBSZXNlcnZlZC4KIEF2YWlsYWJsZSB2aWEgdGhlIE1JVCBvciBuZXcgQlNEIGxpY2Vuc2UuCiBzZWU6IGh0dHA6Ly9naXRodWIuY29tL2pyYnVya2UvcmVxdWlyZWpzIGZvciBkZXRhaWxzCiovCihmdW5jdGlvbigpe3ZhciBrPVsiTXN4bWwyLlhNTEhUVFAiLCJNaWNyb3NvZnQuWE1MSFRUUCIsIk1zeG1sMi5YTUxIVFRQLjQuMCJdLG49L15ccyo8XD94bWwoXHMpK3ZlcnNpb249W1wnXCJdKFxkKSouKFxkKSpbXCdcIl0oXHMpKlw/Pi9pbSxvPS88Ym9keVtePl0qPlxzKihbXHNcU10rKVxzKjxcL2JvZHk+L2ltLGk9dHlwZW9mIGxvY2F0aW9uIT09InVuZGVmaW5lZCImJmxvY2F0aW9uLmhyZWYscD1pJiZsb2NhdGlvbi5wcm90b2NvbCYmbG9jYXRpb24ucHJvdG9jb2wucmVwbGFjZSgvXDovLCIiKSxxPWkmJmxvY2F0aW9uLmhvc3RuYW1lLHI9aSYmKGxvY2F0aW9uLnBvcnR8fHZvaWQgMCksaj1bXTtkZWZpbmUoJ3RleHQnLFtdLGZ1bmN0aW9uKCl7dmFyIGcsaCxsO3R5cGVvZiB3aW5kb3chPT0idW5kZWZpbmVkIiYmd2luZG93Lm5hdmlnYXRvciYmd2luZG93LmRvY3VtZW50P2g9ZnVuY3Rpb24oYSxiKXt2YXIgYz1nLmNyZWF0ZVhocigpO2Mub3BlbigiR0VUIixhLCEwKTtjLm9ucmVhZHlzdGF0ZWNoYW5nZT0KZnVuY3Rpb24oKXtjLnJlYWR5U3RhdGU9PT00JiZiKGMucmVzcG9uc2VUZXh0KX07Yy5zZW5kKG51bGwpfTp0eXBlb2YgcHJvY2VzcyE9PSJ1bmRlZmluZWQiJiZwcm9jZXNzLnZlcnNpb25zJiZwcm9jZXNzLnZlcnNpb25zLm5vZGU/KGw9cmVxdWlyZS5ub2RlUmVxdWlyZSgiZnMiKSxoPWZ1bmN0aW9uKGEsYil7YihsLnJlYWRGaWxlU3luYyhhLCJ1dGY4IikpfSk6dHlwZW9mIFBhY2thZ2VzIT09InVuZGVmaW5lZCImJihoPWZ1bmN0aW9uKGEsYil7dmFyIGM9bmV3IGphdmEuaW8uRmlsZShhKSxlPWphdmEubGFuZy5TeXN0ZW0uZ2V0UHJvcGVydHkoImxpbmUuc2VwYXJhdG9yIiksYz1uZXcgamF2YS5pby5CdWZmZXJlZFJlYWRlcihuZXcgamF2YS5pby5JbnB1dFN0cmVhbVJlYWRlcihuZXcgamF2YS5pby5GaWxlSW5wdXRTdHJlYW0oYyksInV0Zi04IikpLGQsZixnPSIiO3RyeXtkPW5ldyBqYXZhLmxhbmcuU3RyaW5nQnVmZmVyOyhmPWMucmVhZExpbmUoKSkmJmYubGVuZ3RoKCkmJgpmLmNoYXJBdCgwKT09PTY1Mjc5JiYoZj1mLnN1YnN0cmluZygxKSk7Zm9yKGQuYXBwZW5kKGYpOyhmPWMucmVhZExpbmUoKSkhPT1udWxsOylkLmFwcGVuZChlKSxkLmFwcGVuZChmKTtnPVN0cmluZyhkLnRvU3RyaW5nKCkpfWZpbmFsbHl7Yy5jbG9zZSgpfWIoZyl9KTtyZXR1cm4gZz17dmVyc2lvbjoiMC4yNy4wIixzdHJpcDpmdW5jdGlvbihhKXtpZihhKXt2YXIgYT1hLnJlcGxhY2UobiwiIiksYj1hLm1hdGNoKG8pO2ImJihhPWJbMV0pfWVsc2UgYT0iIjtyZXR1cm4gYX0sanNFc2NhcGU6ZnVuY3Rpb24oYSl7cmV0dXJuIGEucmVwbGFjZSgvKFsnXFxdKS9nLCJcXCQxIikucmVwbGFjZSgvW1xmXS9nLCJcXGYiKS5yZXBsYWNlKC9bXGJdL2csIlxcYiIpLnJlcGxhY2UoL1tcbl0vZywiXFxuIikucmVwbGFjZSgvW1x0XS9nLCJcXHQiKS5yZXBsYWNlKC9bXHJdL2csIlxcciIpfSxjcmVhdGVYaHI6ZnVuY3Rpb24oKXt2YXIgYSxiLGM7aWYodHlwZW9mIFhNTEh0dHBSZXF1ZXN0IT09CiJ1bmRlZmluZWQiKXJldHVybiBuZXcgWE1MSHR0cFJlcXVlc3Q7ZWxzZSBmb3IoYj0wO2I8MztiKyspe2M9a1tiXTt0cnl7YT1uZXcgQWN0aXZlWE9iamVjdChjKX1jYXRjaChlKXt9aWYoYSl7az1bY107YnJlYWt9fWlmKCFhKXRocm93IEVycm9yKCJjcmVhdGVYaHIoKTogWE1MSHR0cFJlcXVlc3Qgbm90IGF2YWlsYWJsZSIpO3JldHVybiBhfSxnZXQ6aCxwYXJzZU5hbWU6ZnVuY3Rpb24oYSl7dmFyIGI9ITEsYz1hLmluZGV4T2YoIi4iKSxlPWEuc3Vic3RyaW5nKDAsYyksYT1hLnN1YnN0cmluZyhjKzEsYS5sZW5ndGgpLGM9YS5pbmRleE9mKCIhIik7YyE9PS0xJiYoYj1hLnN1YnN0cmluZyhjKzEsYS5sZW5ndGgpLGI9Yj09PSJzdHJpcCIsYT1hLnN1YnN0cmluZygwLGMpKTtyZXR1cm57bW9kdWxlTmFtZTplLGV4dDphLHN0cmlwOmJ9fSx4ZFJlZ0V4cDovXigoXHcrKVw6KT9cL1wvKFteXC9cXF0rKS8sdXNlWGhyOmZ1bmN0aW9uKGEsYixjLGUpe3ZhciBkPWcueGRSZWdFeHAuZXhlYyhhKSwKZjtpZighZClyZXR1cm4hMDthPWRbMl07ZD1kWzNdO2Q9ZC5zcGxpdCgiOiIpO2Y9ZFsxXTtkPWRbMF07cmV0dXJuKCFhfHxhPT09YikmJighZHx8ZD09PWMpJiYoIWYmJiFkfHxmPT09ZSl9LGZpbmlzaExvYWQ6ZnVuY3Rpb24oYSxiLGMsZSxkKXtjPWI/Zy5zdHJpcChjKTpjO2QuaXNCdWlsZCYmZC5pbmxpbmVUZXh0JiYoalthXT1jKTtlKGMpfSxsb2FkOmZ1bmN0aW9uKGEsYixjLGUpe3ZhciBkPWcucGFyc2VOYW1lKGEpLGY9ZC5tb2R1bGVOYW1lKyIuIitkLmV4dCxtPWIudG9VcmwoZiksaD1lJiZlLnRleHQmJmUudGV4dC51c2VYaHJ8fGcudXNlWGhyOyFpfHxoKG0scCxxLHIpP2cuZ2V0KG0sZnVuY3Rpb24oYil7Zy5maW5pc2hMb2FkKGEsZC5zdHJpcCxiLGMsZSl9KTpiKFtmXSxmdW5jdGlvbihhKXtnLmZpbmlzaExvYWQoZC5tb2R1bGVOYW1lKyIuIitkLmV4dCxkLnN0cmlwLGEsYyxlKX0pfSx3cml0ZTpmdW5jdGlvbihhLGIsYyl7aWYoYiBpbiBqKXt2YXIgZT1nLmpzRXNjYXBlKGpbYl0pOwpjLmFzTW9kdWxlKGErIiEiK2IsImRlZmluZShmdW5jdGlvbiAoKSB7IHJldHVybiAnIitlKyInO30pO1xuIil9fSx3cml0ZUZpbGU6ZnVuY3Rpb24oYSxiLGMsZSxkKXt2YXIgYj1nLnBhcnNlTmFtZShiKSxmPWIubW9kdWxlTmFtZSsiLiIrYi5leHQsaD1jLnRvVXJsKGIubW9kdWxlTmFtZSsiLiIrYi5leHQpKyIuanMiO2cubG9hZChmLGMsZnVuY3Rpb24oKXt2YXIgYj1mdW5jdGlvbihhKXtyZXR1cm4gZShoLGEpfTtiLmFzTW9kdWxlPWZ1bmN0aW9uKGEsYil7cmV0dXJuIGUuYXNNb2R1bGUoYSxoLGIpfTtnLndyaXRlKGEsZixiLGQpfSxkKX19fSl9KSgpOwoKZGVmaW5lKCd0ZXh0IWZpc2h0b25lcy10ZW1wbGF0ZXMvZHJ5L2Zvcm1zL3JpY2hzZXF1ZW5jZS1pbnB1dC5odG1sJyxbXSxmdW5jdGlvbiAoKSB7IHJldHVybiAnPGRpdiBjbGFzcz0iaW5wdXQtYXBwZW5kIiBzdHlsZT0id2lkdGg6MTAwJSI+XG4gICAgPHNwYW4gY2xhc3M9ImdseXBoaWNvbiBnbHlwaGljb24tcXVlc3Rpb24tc2lnbiI+PC9zcGFuPlxuICAgIDxpbnB1dCBpZD0ie3tpbnB1dElkfX0iIHR5cGU9InRleHQiIGNsYXNzPSJ7e2lucHV0Q2xhc3N9fSIgcGxhY2Vob2xkZXI9Int7cGxhY2Vob2xkZXJ9fSJcbiAgICAgICAgICAgdmFsdWU9Int7dmFsdWV9fSIvPlxuXG4gICAgPGJ1dHRvbiBpZD0ie3tidXR0b25JZH19IiBjbGFzcz0ie3tidXR0b25DbGFzc319IiB0eXBlPSJidXR0b24iPnt7YnV0dG9uVGV4dH19PC9idXR0b24+XG4gICAgPHNwYW4gaWQ9Int7dmFsaWRJbmRpY2F0b3JJZH19IiBjbGFzcz0iYmFkZ2UgYmFkZ2UtaW1wb3J0YW50Ij5YPC9zcGFuPlxuPC9kaXY+Jzt9KTsKCi8qKgogKiBJbnB1dCBmaWVsZCBmb3IgIFJpY2hTZXF1ZW5jZSwgd2l0aCBhdXRvY29tcGxldGlvbgogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KZGVmaW5lKCdmaXNodG9uZXMvdmlld3MvZHJ5L2Zvcm1zL1JpY2hTZXF1ZW5jZUlucHV0JyxbJ2pxdWVyeS1wbHVzJywgJ3VuZGVyc2NvcmUnLCAnQmFja2JvbmUnLCAnZmlzaHRvbmVzL21vZGVscy9kcnkvUmljaFNlcXVlbmNlJywgJ2Zpc2h0b25lcy9zZXJ2aWNlcy9kcnkvUmljaFNlcXVlbmNlU2hvcnRjdXRlcicsICdmaXNodG9uZXMvc2VydmljZXMvZHJ5L1JpY2hTZXF1ZW5jZUF1dG9Db21wbGV0aW9uZXInLCAndGV4dCFmaXNodG9uZXMtdGVtcGxhdGVzL2RyeS9mb3Jtcy9yaWNoc2VxdWVuY2UtaW5wdXQuaHRtbCddLAogICAgZnVuY3Rpb24gKCQsIF8sIEJhY2tib25lLCBSaWNoU2VxdWVuY2UsIFJpY2hTZXF1ZW5jZVNob3J0Y3V0ZXIsIFJpY2hTZXF1ZW5jZUF1dG9Db21wbGV0aW9uZXIsIHRtcGwpIHsKCiAgICAgICAgUmljaFNlcXVlbmNlSW5wdXQgPSBCYWNrYm9uZS5WaWV3LmV4dGVuZCh7CiAgICAgICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICAgICAgICAgICAgaWYgKCFzZWxmLm1vZGVsKSB7CiAgICAgICAgICAgICAgICAgICAgc2VsZi5tb2RlbCA9IG5ldyBSaWNoU2VxdWVuY2UoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vaW5pdGlhbGl6YXRpb24gcGVyIHNlCiAgICAgICAgICAgICAgICBzZWxmLnJpY2hTZXF1ZW5jZVNob3J0Y3V0ZXIgPSBuZXcgUmljaFNlcXVlbmNlU2hvcnRjdXRlcigpOwogICAgICAgICAgICAgICAgc2VsZi5hdXRvQ29tcGxldGlvbmVyID0gbmV3IFJpY2hTZXF1ZW5jZUF1dG9Db21wbGV0aW9uZXIoKQogICAgICAgICAgICAgICAgc2VsZi5jYWxsYmFja3NJbnZhbGlkID0gW107CiAgICAgICAgICAgICAgICBzZWxmLmNhbGxiYWNrc1ZhbGlkID0gW107CiAgICAgICAgICAgICAgICBzZWxmLmNhbGxiYWNrc0NsZWFyID0gW107CgogICAgICAgICAgICAgICAgc2VsZi5hY3Rpb24gPSBvcHRpb25zICYmIG9wdGlvbnMuYWN0aW9uOwoKICAgICAgICAgICAgICAgIC8vZG9tIGNvbnN0cnVjdGlvbgogICAgICAgICAgICAgICAgdmFyIGFyZ3MgPSAkLmV4dGVuZCh7CiAgICAgICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI6ICdIM0s0LCBIMy4xSzE4QWMsIEgzLjFLMThBY0syM01lMiwgS1FUQVIsIEtBY1FUQVIsIEt7QWNldHlsYXRpb24sTWV0aHlsYXRpb259UVRBUntNZXRoeWxhdGlvbn0nLAogICAgICAgICAgICAgICAgICAgIGlucHV0Q2xhc3M6ICdmb3JtLWNvbnRyb2wnLAogICAgICAgICAgICAgICAgICAgIHZhbHVlOiAnJywKICAgICAgICAgICAgICAgICAgICBpbnB1dElkOiAncnNpLWlucHV0LScgKyBzZWxmLmNpZCwKICAgICAgICAgICAgICAgICAgICBidXR0b25DbGFzczogJ2J0bicsCiAgICAgICAgICAgICAgICAgICAgYnV0dG9uSWQ6ICdyc2ktYnV0LScgKyBzZWxmLmNpZCwKICAgICAgICAgICAgICAgICAgICBidXR0b25UZXh0OiAnYWN0aW9uJywKICAgICAgICAgICAgICAgICAgICBoaWRlQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICBoaWRlVmFsaWRJbmRpY2F0b3I6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgdmFsaWRJbmRpY2F0b3JJZDogJ3JzaS1iYWRnZS0nICsgc2VsZi5jaWQKICAgICAgICAgICAgICAgIH0sIG9wdGlvbnMpOwoKICAgICAgICAgICAgICAgIHZhciBjb250ID0gJChzZWxmLmVsKS5hcHBlbmQoJChfLnRlbXBsYXRlKHRtcGwsIGFyZ3MpKSk7CiAgICAgICAgICAgICAgICBzZWxmLmVsSW5wdXQgPSBjb250LmZpbmQoJ2lucHV0Jyk7CiAgICAgICAgICAgICAgICBzZWxmLmVsQnV0dG9uID0gY29udC5maW5kKCdidXR0b24nKTsKICAgICAgICAgICAgICAgIHNlbGYuaGlkZUluZGljYXRvciA9IGNvbnQuZmluZCgnc3Bhbi5iYWRnZScpCgoKICAgICAgICAgICAgICAgIGlmIChhcmdzLmhpZGVCdXR0b24pIHsKICAgICAgICAgICAgICAgICAgICBzZWxmLmVsQnV0dG9uLmhpZGUoKTsKICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGFyZ3MuaGlkZVZhbGlkSW5kaWNhdG9yKSB7CiAgICAgICAgICAgICAgICAgICAgc2VsZi5oaWRlSW5kaWNhdG9yLmhpZGUoKTsKICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHNlbGYuZWxJY29uID0gY29udC5maW5kKCdzcGFuLmdseXBoaWNvbicpOwogICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpewogICAgICAgICAgICAgICAgICAgIHZhciB0b3RhbFdpZHRoID0gJChzZWxmLmVsKS53aWR0aCgpOwogICAgICAgICAgICAgICAgICAgIHRvdGFsV2lkdGgtPXNlbGYuZWxCdXR0b24ub3V0ZXJXaWR0aCh0cnVlKTsKICAgICAgICAgICAgICAgICAgICB0b3RhbFdpZHRoLT1zZWxmLmhpZGVJbmRpY2F0b3Iub3V0ZXJXaWR0aCh0cnVlKTsKICAgICAgICAgICAgICAgICAgICB0b3RhbFdpZHRoLT0gc2VsZi5lbEljb24ub3V0ZXJXaWR0aCh0cnVlKTsKICAgICAgICAgICAgICAgICAgICB0b3RhbFdpZHRoLT0yMAoKICAgICAgICAgICAgICAgICAgICBzZWxmLmVsSW5wdXQud2lkdGgoJycrdG90YWxXaWR0aCsncHgnKTsKICAgICAgICAgICAgICAgIH0sMCk7CgogICAgICAgICAgICAgICAgc2VsZi5lbElucHV0LnZhbChzZWxmLm1vZGVsLnRvU3RyaW5nKCkpCgogICAgICAgICAgICAgICAgc2VsZi5lbElucHV0LnR5cGVhaGVhZCh7CiAgICAgICAgICAgICAgICAgICAgc291cmNlOiBmdW5jdGlvbiAodHh0LCBwcm9jZXNzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0eXBlYWhlYWQgPSB0aGlzOwogICAgICAgICAgICAgICAgICAgICAgICB0eXBlYWhlYWQucmVwbGFjZUNvbnRleHQgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgcENhcmV0ID0gc2VsZi5lbElucHV0WzBdLnNlbGVjdGlvblN0YXJ0CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbnNlcnRlZENoYXIgPSB0eHQuY2hhckF0KHBDYXJldCAtIDEpCgogICAgICAgICAgICAgICAgICAgICAgICAvL2Nsb3NlIHRoZSBjdXJseSBicmFja2V0IGlmIG5lZWRlZAogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5zZXJ0ZWRDaGFyID09ICd7JyAmJiBzZWxmLmF1dG9Db21wbGV0aW9uZXIuY2xvc2VDdXJseSh0eHQsIHBDYXJldCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZWxJbnB1dC52YWwodHh0LnN1YnN0cmluZygwLCBwQ2FyZXQpICsgJ30nICsgdHh0LnN1YnN0cmluZyhwQ2FyZXQpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zZXRDYXJldEF0KHBDYXJldCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlcGxhY2UgPSBzZWxmLmF1dG9Db21wbGV0aW9uZXIucmVwbGFjZWFibGUodHh0LCBwQ2FyZXQpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXBsYWNlID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVhaGVhZC5oaWRlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXBsYWNlLnByZWZpeC5sZW5ndGggPCAyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlYWhlYWQuaGlkZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVhaGVhZC5yZXBsYWNlQ29udGV4dCA9IHJlcGxhY2UKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuYXV0b0NvbXBsZXRpb25lci5nZXRMaXN0KHJlcGxhY2UucHJlZml4KQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgbWF0Y2hlcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgaGlnaGxpZ2h0ZXI6IGZ1bmN0aW9uICh0eHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHR5cGVhaGVhZCA9IHRoaXM7CgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5lbElucHV0LnZhbCgpLnN1YnN0cmluZygwLCB0eXBlYWhlYWQucmVwbGFjZUNvbnRleHQucG9zU3RhcnQpICsgJzxiPicgKyB0eHQgKyAnPC9iPicgKyBzZWxmLmVsSW5wdXQudmFsKCkuc3Vic3RyaW5nKHR5cGVhaGVhZC5yZXBsYWNlQ29udGV4dC5wb3NFbmQpCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB1cGRhdGVyOiBmdW5jdGlvbiAodHh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0eXBlYWhlYWQgPSB0aGlzOwogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNldENhcmV0U2VsZWN0aW9uKHR5cGVhaGVhZC5yZXBsYWNlQ29udGV4dC5wb3NTdGFydCwgdHlwZWFoZWFkLnJlcGxhY2VDb250ZXh0LnBvc0VuZCkKCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuZXdWYWwgPSBzZWxmLmVsSW5wdXQudmFsKCkuc3Vic3RyaW5nKDAsIHR5cGVhaGVhZC5yZXBsYWNlQ29udGV4dC5wb3NTdGFydCkgKyB0eHQgKyBzZWxmLmVsSW5wdXQudmFsKCkuc3Vic3RyaW5nKHR5cGVhaGVhZC5yZXBsYWNlQ29udGV4dC5wb3NFbmQpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZWxJbnB1dC52YWwobmV3VmFsKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnVwZGF0ZSgpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXdWYWwKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgIHZhciBwb3AgPSBzZWxmLmVsSWNvbi5wb3BvdmVyKHsKICAgICAgICAgICAgICAgICAgICBwbGFjZW1lbnQ6ICJib3R0b20iLAogICAgICAgICAgICAgICAgICAgIGh0bWw6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgdHJpZ2dlcjogJ2hvdmVyJywKICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ0hvdyB0byBlbnRlciBhIHBlcHRpZGUgIDxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0iY2xvc2UiIGRhdGEtZGlzbWlzcz0ibW9kYWwiIGFyaWEtaGlkZGVuPSJ0cnVlIicsCgogICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6ICJUaGVyZSBpcyBtb3JlIHRoYW4gb25lIHdheSB0byBkbyBpdDo8dWw+IDxsaT5zaG9ydGN1dCBhcyA8Y29kZT5IM0s5PC9jb2RlPiBvciA8Y29kZT5IMy4xSzI3PC9jb2RlPjwvbGk+PGxpPnNob3J0Y3V0IHdpdGggbW9kaWZpY2F0aW9uIGFzIDxjb2RlPkgzSzlNZTI8L2NvZGU+PC9saT48bGk+YXMgc2VxdWVuY2Ugd2l0aCBzaG9ydCBtb2RpZmljYXRpb24gPGNvZGU+UUtBY1RBUk1lPC9jb2RlPjwvbGk+PGxpPndpdGggbG9uZyB2ZXJzaW9uIG1vZGlmaWNhdGlvbiA8Y29kZT5RS3tBY2V0eWx9VEFSPC9jb2RlPjwvbGk+PGxpPndpdGggZXhwbGljaXQgbWFzcyA8Y29kZT5QRVB7MTIzNC41Njd9VElERU1lPC9jb2RlPjwvbGk+PGxpPmluIGNvbnRleHQgPGNvZGU+Ui5RS1RBUi5LPC9jb2RlPjwvbGk+PC91bD5UaGUgbW9kaWZpY2F0aW9uIGxpc3QgY2FuIGJlIGZvdW5kIDxhIGhyZWY9Jyc+c29vbjwvYT4iCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICAgICAgc2VsZi5lbElucHV0LnZhbChzZWxmLm1vZGVsLnRvU3RyaW5nKCkpOwogICAgICAgICAgICAgICAgc2VsZi5kZWxlZ2F0ZUV2ZW50cyh7CiAgICAgICAgICAgICAgICAgICAgJ2lucHV0JzogJ3VwZGF0ZScsCiAgICAgICAgICAgICAgICAgICAgJ2tleXByZXNzIGlucHV0JzogJ2lucHV0S2V5UHJlc3NlZCcsCiAgICAgICAgICAgICAgICAgICAgJ2NsaWNrIGJ1dHRvbic6ICdjYWxsQWN0aW9uJwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC8vIHNlbGYub24oJ2NoYW5nZTppbnB1dCcsIGZ1bmN0aW9uKCl7c2VsZi51cGRhdGUoKX0pOwogICAgICAgICAgICAgICAgLy8gc2VsZi5vbigna2V5cHJlc3M6aW5wdXQnLCBmdW5jdGlvbigpe3NlbGYuaW5wdXRLZXlQcmVzc2VkKCl9KTsKICAgICAgICAgICAgICAgIC8vIHNlbGYub24oJ2J1dHRvbjpjbGljaycsIGZ1bmN0aW9uKCl7c2VsZi5jYWxsQWN0aW9uKCl9KTsKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgICAgICB9LAogICAgICAgICAgICAvLyBldmVudHMgOiB7CiAgICAgICAgICAgIC8vICdpbnB1dCcgOiAndXBkYXRlJywKICAgICAgICAgICAgLy8gJ2tleXByZXNzIGlucHV0JyA6ICdpbnB1dEtleVByZXNzZWQnLAogICAgICAgICAgICAvLyAnY2xpY2sgYnV0dG9uJyA6ICdjYWxsQWN0aW9uJwogICAgICAgICAgICAvLyB9LAogICAgICAgICAgICB1cGRhdGU6IGZ1bmN0aW9uIChldnQpIHsKICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGluU3RyID0gc2VsZi5lbElucHV0LnZhbCgpLnRyaW0oKTsKICAgICAgICAgICAgICAgICAgICBpZiAoaW5TdHIgPT0gJycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgXy5lYWNoKHNlbGYuY2FsbGJhY2tzQ2xlYXIsIGZ1bmN0aW9uIChmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmKHNlbGYubW9kZWwpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBzZWxmLnJpY2hTZXF1ZW5jZVNob3J0Y3V0ZXIucmljaFNlcVJlYWRGcm9tKHNlbGYubW9kZWwsIGluU3RyKQogICAgICAgICAgICAgICAgICAgIHNlbGYuaXNWYWxpZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgc2VsZi5lbEJ1dHRvbi5yZW1vdmVDbGFzcygnYnRuLXdhcm5pbmcnKS5hZGRDbGFzcygnYnRuLXN1Y2Nlc3MnKS5hdHRyKCdkaXNhYmxlZCcsIG51bGwpOwogICAgICAgICAgICAgICAgICAgIHNlbGYuaGlkZUluZGljYXRvci5yZW1vdmVDbGFzcygnYmFkZ2UtaW1wb3J0YW50JykuYWRkQ2xhc3MoJ2JhZGdlLXN1Y2Nlc3MnKS5odG1sKCcmcmFkaWM7Jyk7CiAgICAgICAgICAgICAgICAgICAgXy5lYWNoKHNlbGYuY2FsbGJhY2tzVmFsaWQsIGZ1bmN0aW9uIChmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGYoc2VsZi5tb2RlbCkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGV4YykgewogICAgICAgICAgICAgICAgICAgIHNlbGYuaXNWYWxpZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIHNlbGYuZWxCdXR0b24uYWRkQ2xhc3MoJ2J0bi13YXJuaW5nJykucmVtb3ZlQ2xhc3MoJ2J0bi1zdWNjZXNzJykuYXR0cignZGlzYWJsZWQnLCAnZGlzYWJsZWQnKTsKICAgICAgICAgICAgICAgICAgICBzZWxmLmhpZGVJbmRpY2F0b3IucmVtb3ZlQ2xhc3MoJ2JhZGdlLXN1Y2Nlc3MnKS5hZGRDbGFzcygnYmFkZ2UtaW1wb3J0YW50JykuaHRtbCgnWCcpOwogICAgICAgICAgICAgICAgICAgIF8uZWFjaChzZWxmLmNhbGxiYWNrc0ludmFsaWQsIGZ1bmN0aW9uIChmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGYoZXhjKQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgfSwKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIGNsaWNrIGJ1dHRvbiBpZiBlbnRlciBrZXkgaXMgcHJlc3NlZAogICAgICAgICAgICAgKi8KICAgICAgICAgICAgaW5wdXRLZXlQcmVzc2VkOiBmdW5jdGlvbiAoZXZ0KSB7CiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgICAgICBpZiAoZXZ0LmNoYXJDb2RlID09IDEzKSB7CiAgICAgICAgICAgICAgICAgICAgc2VsZi5jYWxsQWN0aW9uKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBhZGQgYSBmdW5jaXRvbiB0byBiZSBjYWxsZWQgd2hlbmV2ZXIgdGhlIGZpZWxkIGlzIGEgdmFsaWQgUmljaFNlcXVlbmNlIGRlc2NyaXB0b3IKICAgICAgICAgICAgICogYXJndW1lbnQgcGFzc2VkIHRvIHRoZSBmdW5jdGlvbiB3aWxsIGEgUmljaFNlcXVlbmNlICh0aGUgUlNJIG1vZGVsKQogICAgICAgICAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBmCiAgICAgICAgICAgICAqLwogICAgICAgICAgICBhZGRDYWxsYmFja1ZhbGlkOiBmdW5jdGlvbiAoZikgewogICAgICAgICAgICAgICAgdGhpcy5jYWxsYmFja3NWYWxpZC5wdXNoKGYpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBhZGQgYSBmdW5jaXRvbiB0byBiZSBjYWxsZWQgd2hlbmV2ZXIgdGhlIGZpZWxkIGlzIGEgSU52YWxpZCBSaWNoU2VxdWVuY2UgZGVzY3JpcHRvcgogICAgICAgICAgICAgKiBhcmcgcGFzc2VkIHRvIGZ1bmN0aW9uIGlzIHRoZSBjdXJyZW50IGV4Y2VwdGlvbgogICAgICAgICAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBmCiAgICAgICAgICAgICAqLwogICAgICAgICAgICBhZGRDYWxsYmFja0ludmFsaWQ6IGZ1bmN0aW9uIChmKSB7CiAgICAgICAgICAgICAgICB0aGlzLmNhbGxiYWNrc0ludmFsaWQucHVzaChmKQogICAgICAgICAgICB9LAogICAgICAgICAgICBhZGRDYWxsYmFja0NsZWFyOiBmdW5jdGlvbiAoZikgewogICAgICAgICAgICAgICAgdGhpcy5jYWxsYmFja3NDbGVhci5wdXNoKGYpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNhbGxBY3Rpb246IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgICAgIGlmIChzZWxmLmFjdGlvbiA9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzZWxmLmFjdGlvbihzZWxmLm1vZGVsKQogICAgICAgICAgICB9LAogICAgICAgICAgICBzZXRDYXJldEF0OiBmdW5jdGlvbiAocG9zKSB7CiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgICAgICB2YXIgbm9kZSA9IHNlbGYuZWxJbnB1dFswXTsKICAgICAgICAgICAgICAgIG5vZGUuc2V0U2VsZWN0aW9uUmFuZ2UocG9zLCBwb3MpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBzZXRDYXJldFNlbGVjdGlvbjogZnVuY3Rpb24gKHBTdGFydCwgcEVuZCkgewogICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICAgICAgdmFyIG5vZGUgPSBzZWxmLmVsSW5wdXRbMF07CiAgICAgICAgICAgICAgICBub2RlLnNldFNlbGVjdGlvblJhbmdlKHBTdGFydCwgcEVuZCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBqdXN0IHJldHVybiB0aGUgdGV4dCBpbiB0aGUgaW5wdXQgZmllbGQKICAgICAgICAgICAgICovCiAgICAgICAgICAgIGlucHV0U2VxdWVuY2U6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmVsSW5wdXQudmFsKCkudHJpbSgpCiAgICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIHJldHVybiBSaWNoU2VxdWVuY2VJbnB1dDsKICAgIH0pOwoKLyoKICogU1ZHIHJlbmRlciBvZiB0aGVvcmV0aWNhbCBmcmFnbWVudCBvbiBhIHNlcXVlbmNlCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwoKZGVmaW5lKCdmaXNodG9uZXMvdmlld3MvZHJ5L1RoZW9PblNlcXVlbmNlVmlldycsWyd1bmRlcnNjb3JlJywgJ0JhY2tib25lJywgJ2QzJ10sIGZ1bmN0aW9uKF8sIEJhY2tib25lLCBkMykgewoKICAgIFRoZW9PblNlcXVlbmNlVmlldyA9IEJhY2tib25lLlZpZXcuZXh0ZW5kKHsKICAgICAgICBkZWZhdWx0cyA6IHsKICAgICAgICB9LAoKICAgICAgICByZW5kZXIgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICAgICAgdmFyIHRoZW9TcGVjdHJ1bSA9IHNlbGYubW9kZWw7CgogICAgICAgICAgICB2YXIgd1VuaXQgPSA2NTsKICAgICAgICAgICAgdmFyIGhVbml0ID0gMTU7CgogICAgICAgICAgICB2YXIgd2lkdGggPSAodGhlb1NwZWN0cnVtLmdldCgncmljaFNlcXVlbmNlJykuc2l6ZSgpICsgMSkgKiB3VW5pdDsKICAgICAgICAgICAgdmFyIGhlaWdodCA9ICh0aGVvU3BlY3RydW0uZ2V0KCdmcmFnU2VyaWVzJykubGVuZ3RoICsgMiApICogaFVuaXQ7CgogICAgICAgICAgICBzZWxmLnZpeiA9IGQzLnNlbGVjdChzZWxmLmVsKS5hcHBlbmQoInN2ZyIpLmF0dHIoJ2NsYXNzJywgJ2QzLXdpZGdldC10aGVvLW9uLXNlcXVlbmNlJykuYXR0cigid2lkdGgiLCB3aWR0aCkuYXR0cigiaGVpZ2h0IiwgaGVpZ2h0KTsKCiAgICAgICAgICAgIHZhciBzZXJpZXMyaSA9IHt9OwogICAgICAgICAgICB2YXIgaV9jID0gMDsKICAgICAgICAgICAgdmFyIGlfbiA9IDA7CiAgICAgICAgICAgIF8uZWFjaCh0aGVvU3BlY3RydW0uZ2V0KCdmcmFnU2VyaWVzJyksIGZ1bmN0aW9uKGZzKSB7CiAgICAgICAgICAgICAgICBpZiAoZnMgPCAnbScpIHsvLyBudGVybQogICAgICAgICAgICAgICAgICAgIGlfbiA9IGlfbiAtIDE7CiAgICAgICAgICAgICAgICAgICAgc2VyaWVzMmlbZnNdID0gaV9uOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpX2MgPSBpX2MgKyAxCiAgICAgICAgICAgICAgICAgICAgc2VyaWVzMmlbZnNdID0gaV9jOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgaV9uIC09IDAuNTsKCiAgICAgICAgICAgIHZhciByaWNoU2VxID0gdGhlb1NwZWN0cnVtLmdldCgncmljaFNlcXVlbmNlJyk7CiAgICAgICAgICAgIHNlbGYudml6LmFwcGVuZCgnZycpLnNlbGVjdEFsbCgndGV4dC5hYScpLmRhdGEocmljaFNlcS5nZXQoJ3NlcXVlbmNlJykpLmVudGVyKCkuYXBwZW5kKCd0ZXh0JykuYXR0cignY2xhc3MnLCAnYWEnKS5hdHRyKCd4JywgZnVuY3Rpb24oYWEsIGkpIHsKICAgICAgICAgICAgICAgIHJldHVybiAoaSArIDEpICogd1VuaXQ7CiAgICAgICAgICAgIH0pLmF0dHIoJ3knLCAoLWlfbiArIDAuNSkgKiBoVW5pdCkudGV4dChmdW5jdGlvbihyYWEpIHsKICAgICAgICAgICAgICAgIHJldHVybiByYWEuYWEuZ2V0KCdjb2RlMScpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHZhciBzaXplID0gcmljaFNlcS5zaXplKCk7CiAgICAgICAgICAgIHZhciBtb2RpZnMgPSBbcmljaFNlcS5nZXRNb2RpZmljYXRpb25BcnJheSgtMSldLmNvbmNhdChfLmNvbGxlY3QocmljaFNlcS5nZXQoJ3NlcXVlbmNlJyksIGZ1bmN0aW9uKHJhYSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHJhYS5tb2RpZmljYXRpb25zCiAgICAgICAgICAgIH0pKS5jb25jYXQoW3JpY2hTZXEuZ2V0TW9kaWZpY2F0aW9uQXJyYXkoc2l6ZSldKTsKICAgICAgICAgICAgc2VsZi52aXouYXBwZW5kKCdnJykuc2VsZWN0QWxsKCd0ZXh0LmFhLW1vZGlmJykuZGF0YShtb2RpZnMpLmVudGVyKCkuYXBwZW5kKCd0ZXh0JykuYXR0cignY2xhc3MnLCAnYWEtbW9kaWYnKS5hdHRyKCd4JywgZnVuY3Rpb24obW9kcywgaSkgewogICAgICAgICAgICAgICAgaWYoaT09MCl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdVbml0ICowLjQ1OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYoaT09c2l6ZSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChpLTAuNDUpKndVbml0OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGkgKiB3VW5pdDsKICAgICAgICAgICAgfSkuYXR0cigneScsICgtaV9uICsgMC41KSAqIGhVbml0ICsgMTApLnRleHQoZnVuY3Rpb24obW9kcykgewogICAgICAgICAgICAgICAgaWYgKG1vZHMgPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcnCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gXy5jb2xsZWN0KG1vZHMsIGZ1bmN0aW9uKG0pIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbS5nZXQoJ25hbWUnKTsKICAgICAgICAgICAgICAgIH0pLmpvaW4oJywnKTsKCiAgICAgICAgICAgIH0pLnN0eWxlKCd0ZXh0LWFuY2hvcicsIGZ1bmN0aW9uKG1vZHMsIGkpewogICAgICAgICAgICAgICAgaWYoaT09MCl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdlbmQnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYoaT09c2l6ZSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdzdGFydCc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gJ21pZGRsZScKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB2YXIgcGVhazJwb3MgPSBmdW5jdGlvbihwKSB7CiAgICAgICAgICAgICAgICB2YXIgc2VyaWVzID0gcC5zZXJpZXM7CiAgICAgICAgICAgICAgICBpZiAoc2VyaWVzIDwgJ20nKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgaXNOdGVybSA6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgIHggOiB3VW5pdCAqIChwLnBvcyArIDEuNSkgLSA3LAogICAgICAgICAgICAgICAgICAgICAgICB5IDogKHNlcmllczJpW3Nlcmllc10gLSBpX24pICogaFVuaXQKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgIGlzTnRlcm0gOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICB4IDogd1VuaXQgKiAocC5wb3MgKyAuNSkgKyA3LAogICAgICAgICAgICAgICAgICAgIHkgOiAoc2VyaWVzMmlbc2VyaWVzXSAtIGlfbiArIDEpICogaFVuaXQKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBzZWxmLnZpei5hcHBlbmQoJ2cnKS5zZWxlY3RBbGwoJ3BhdGguZnJhZ21lbnQnKS5kYXRhKHRoZW9TcGVjdHJ1bS5nZXQoJ3BlYWtzJykpLmVudGVyKCkuYXBwZW5kKCdwYXRoJykuYXR0cignY2xhc3MnLCAnZnJhZ21lbnQnKS5hdHRyKCdkJywgZnVuY3Rpb24ocCkgewogICAgICAgICAgICAgICAgdmFyIHNlcmllcyA9IHAuc2VyaWVzOwogICAgICAgICAgICAgICAgdmFyIHBvcyA9IHBlYWsycG9zKHApCiAgICAgICAgICAgICAgICBpZiAocG9zLmlzTnRlcm0pIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ00nICsgcG9zLnggKyAnLCcgKyBwb3MueSArICdsNywzIGwwLCcgKyAoaFVuaXQgLSA1KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdNJyArIHBvcy54ICsgJywnICsgcG9zLnkgKyAnbC03LC0zIGwwLCcgKyAoLWhVbml0ICsgNSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBzZWxmLnZpei5hcHBlbmQoJ2cnKS5zZWxlY3RBbGwoJ3RleHQuZnJhZy1tb3oucGVha3MnKS5kYXRhKHRoZW9TcGVjdHJ1bS5nZXQoJ3BlYWtzJykpLmVudGVyKCkuYXBwZW5kKCd0ZXh0JykuYXR0cignY2xhc3MnLCAnZnJhZy1tb3ogcGVha3MnKS5hdHRyKCd4JywgZnVuY3Rpb24ocCkgewogICAgICAgICAgICAgICAgdmFyIHBvcyA9IHBlYWsycG9zKHApOwogICAgICAgICAgICAgICAgcmV0dXJuIHBvcy54ICsgKHBvcy5pc050ZXJtID8gLTMgOiArMyk7CiAgICAgICAgICAgIH0pLmF0dHIoJ3knLCBmdW5jdGlvbihwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcGVhazJwb3MocCkueSArIDM7CiAgICAgICAgICAgIH0pLnN0eWxlKCd0ZXh0LWFuY2hvcicsIGZ1bmN0aW9uKHApIHsKICAgICAgICAgICAgICAgIHJldHVybiBwZWFrMnBvcyhwKS5pc050ZXJtID8gJ2VuZCcgOiAnc3RhcnQnOwogICAgICAgICAgICB9KS50ZXh0KGZ1bmN0aW9uKHApIHsKICAgICAgICAgICAgICAgIHJldHVybiBwLm1vei50b0ZpeGVkKDQpCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLy9hZGQgZnJhZ3NlcmllcyBuYW1lIG9uIGxlZnQvcmlnaHQgY29sdW1uCiAgICAgICAgICAgIHZhciBkU2VyaWVzTmFtZXMgPSBfLnppcChfLmtleXMoc2VyaWVzMmkpLCBfLnZhbHVlcyhzZXJpZXMyaSkpOwogICAgICAgICAgICBzZWxmLnZpei5hcHBlbmQoJ2cnKS5zZWxlY3RBbGwoJ3RleHQuZnJhZy1tb3oubGVnZW5kJykuZGF0YShkU2VyaWVzTmFtZXMpLmVudGVyKCkuYXBwZW5kKCd0ZXh0JykuYXR0cignY2xhc3MnLCAnZnJhZy1tb3ogbGVnZW5kJykuYXR0cigneCcsIGZ1bmN0aW9uKHApIHsKICAgICAgICAgICAgICAgIHJldHVybiAocFswXSA8ICdtJykgPyA1IDogKHdpZHRoIC0gNSk7CiAgICAgICAgICAgIH0pLmF0dHIoJ3knLCBmdW5jdGlvbihwKSB7CiAgICAgICAgICAgICAgICB2YXIgcGsgPSB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWVzIDogcFswXSwKICAgICAgICAgICAgICAgICAgICBwb3MgOiAwCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gcGVhazJwb3MocGspLnkgKyAzOwogICAgICAgICAgICB9KS5zdHlsZSgndGV4dC1hbmNob3InLCBmdW5jdGlvbihwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gKHBbMF0gPiAnbScpID8gJ2VuZCcgOiAnc3RhcnQnOwogICAgICAgICAgICB9KS50ZXh0KGZ1bmN0aW9uKHApIHsKICAgICAgICAgICAgICAgIHJldHVybiBwWzBdOwogICAgICAgICAgICB9KTsKCiAgICAgICAgfQogICAgfSk7CgogICAgcmV0dXJuIFRoZW9PblNlcXVlbmNlVmlldzsKfSk7CgovKioKICogRXh0ZW5kcyBQZWFrTGlzdFBhaXJBbGlnbm1lbnQgZm9yIGEgcGFpciBvZiB0d28gRXhwU3BlY3RydW0KICogUHJvcGVydGllcyBhcmUKICogLSBzcGVjdHJ1bUEKICogLSBzcGVjdHJ1bUIKICoKICogYWxpZ25tZW50IGlzIHJlY29tcHV0ZWQgaWYgYW55IG9mIHRoZW0gdHJpZ2dlIGEgJ2NoYW5nZScgZXZlbnQKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCgpkZWZpbmUoJ2Zpc2h0b25lcy9tb2RlbHMvbWF0Y2gvU3BlY3RyYVBhaXJBbGlnbm1lbnQnLFsndW5kZXJzY29yZScsICcuL1BlYWtMaXN0UGFpckFsaWdubWVudCddLCBmdW5jdGlvbihfLCBQZWFrTGlzdFBhaXJBbGlnbm1lbnQpIHsKCiAgICAvKioKICAgICAqIGJ1aWxkIHRoZSBhbGlnbm1lbnQgd2l0aCBvcHRpb25zIHtyaWNoU2VxdWVuY2U6Li4uLCBleHBTcGVjdHJ1bTouLi59CiAgICAgKi8KICAgIHZhciBQU01BbGlnbm1lbnQgPSBQZWFrTGlzdFBhaXJBbGlnbm1lbnQuZXh0ZW5kKHsKICAgICAgICBpbml0aWFsaXplIDogZnVuY3Rpb24ob3B0aW9ucykgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIFBTTUFsaWdubWVudC5fX3N1cGVyX18uaW5pdGlhbGl6ZS5jYWxsKHRoaXMsIHt9KTsKICAgICAgICAgICAgc2VsZi5idWlsZCgpCgogICAgICAgICAgICBzZWxmLmdldCgnc3BlY3RydW1BJykub24oImNoYW5nZSIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgc2VsZi5idWlsZCgpCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIHNlbGYuZ2V0KCdzcGVjdHJ1bUInKS5vbigiY2hhbmdlIiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBzZWxmLmJ1aWxkKCkKICAgICAgICAgICAgfSkKICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICovCiAgICAgICAgYnVpbGQgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICAgICAgc2VsZi5zZXQoJ3BrbEEnLCBzZWxmLmdldCgnc3BlY3RydW1BJykpCiAgICAgICAgICAgIHNlbGYuc2V0KCdwa2xCJywgc2VsZi5nZXQoJ3NwZWN0cnVtQicpKQoKICAgICAgICAgICAgdmFyIG1hdGNoSW5kaWNlcyA9IHNlbGYubWF0Y2hJbmRpY2VzKCk7CgogICAgICAgICAgICB2YXIgeHBlYWtzQSA9IHNlbGYuZ2V0KCdzcGVjdHJ1bUEnKS5nZXQoJ21venMnKTsKICAgICAgICAgICAgdmFyIHhJbnRlbnNpdGllc0EgPSBzZWxmLmdldCgnc3BlY3RydW1BJykuZ2V0KCdpbnRlbnNpdHlSYW5rcycpOwogICAgICAgICAgICB2YXIgeHBlYWtzQiA9IHNlbGYuZ2V0KCdzcGVjdHJ1bUInKS5nZXQoJ21venMnKTsKICAgICAgICAgICAgdmFyIHhJbnRlbnNpdGllc0IgPSBzZWxmLmdldCgnc3BlY3RydW1CJykuZ2V0KCdpbnRlbnNpdHlSYW5rcycpOwoKICAgICAgICAgICAgdmFyIG1hdGNoZXMgPSBfLm1hcChtYXRjaEluZGljZXMsIGZ1bmN0aW9uKG1pKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgIHBrQiA6IHsKICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXggOiBtaS5pQiwKICAgICAgICAgICAgICAgICAgICAgICAgbW96IDogeHBlYWtzQlttaS5pQl0sCiAgICAgICAgICAgICAgICAgICAgICAgIGludGVuc2l0eVJhbmsgOiB4SW50ZW5zaXRpZXNCW21pLmlCXSwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHBrQSA6IHsKICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXggOiBtaS5pQSwKICAgICAgICAgICAgICAgICAgICAgICAgbW96IDogeHBlYWtzQVttaS5pQV0sCiAgICAgICAgICAgICAgICAgICAgICAgIGludGVuc2l0eVJhbmsgOiB4SW50ZW5zaXRpZXNBW21pLmlBXSwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIGVycm9yUFBNIDogbWkuZXJyb3JQUE0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICAgICAgc2VsZi5zZXQoJ21hdGNoZXMnLCBtYXRjaGVzKTsKCiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogQHJldHVybiBkaWZmZXJlbmNlIGJldHdlZW4gdGhlIGV4cGVyaW1lbnRhbCBhbmQgdGhlIHRoZW9yZXRpY2FsIHByZWN1cnNvcnMgKE1IKQogICAgICAgICAqLwogICAgICAgIGRlbHRhUHJlY01venMgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICB2YXIgeiA9IHNlbGYuZ2V0KCdleHBTcGVjdHJ1bScpLmdldCgncHJlY0NoYXJnZScpOwogICAgICAgICAgICB2YXIgdGhlbyA9IG1hc3NCdWlsZGVyLmNvbXB1dGVNYXNzUmljaFNlcXVlbmNlKHNlbGYuZ2V0KCdyaWNoU2VxdWVuY2UnKSwgeikKICAgICAgICAgICAgcmV0dXJuIChzZWxmLmdldCgnZXhwU3BlY3RydW0nKS5nZXQoJ3ByZWNNb3onKSAtIHRoZW8pICogegogICAgICAgIH0sCiAgICAgICAgLyoqCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIHt7fX0gcmVhZHkgZm9yIEpTT04KICAgICAgICAgKi8KICAgICAgICBzZXJpYWxpemUgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICB2YXIgcmV0ID0ge307CiAgICAgICAgICAgIHJldC5leHBTcGVjdHJ1bSA9IHNlbGYuZ2V0KCdleHBTcGVjdHJ1bScpLnRvSlNPTigpCgogICAgICAgICAgICB2YXIgcnNlcSA9IHNlbGYuZ2V0KCdyaWNoU2VxdWVuY2UnKS50b1N0cmluZygpOwogICAgICAgICAgICByZXQucmljaFNlcXVlbmNlID0gcnNlcQoKICAgICAgICAgICAgcmV0LmlkID0gc2VsZi5jb21wdXRlSWQoKTsKICAgICAgICAgICAgcmV0LmFhU2VxdWVuY2UgPSBzZWxmLmdldCgncmljaFNlcXVlbmNlJykudG9BQVN0cmluZygpOwoKICAgICAgICAgICAgcmV0dXJuIHJldDsKICAgICAgICB9LAogICAgICAgIGNvbXB1dGVJZCA6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHJldHVybiBzZWxmLmdldCgnZXhwU3BlY3RydW0nKS5nZXQoJ2lkJykgKyAnfCcgKyBzZWxmLmdldCgncmljaFNlcXVlbmNlJykudG9TdHJpbmcoKQoKICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqIHJldHVybiB0aGUgbnVtYmVyIG9mIHVubWFjdGhlZCBleHBlcmltZW50YWwgcGVhaywgd2l0aCBhIG1hc3MgZ3JlYXRlciB0aGFuIHRoZSBwcmVjdXJzb3IsCiAgICAgICAgICogaW50ZW5zaXR5IDwgaW5GaXJzdCBhbmQgd2l0aCB0b2wgZXJyb3IKICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gdG9sCiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGluRmlyc3QKICAgICAgICAgKi8KICAgICAgICB1bm1hdGNoZWRGYWN0b3IgOiBmdW5jdGlvbih0b2wsIGluRmlyc3QpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICB2YXIgbWF0Y2hlcyA9IHNlbGYuY2xvc2VyVGhhblBQTSh0b2wpOwoKICAgICAgICAgICAgdmFyIHBrcyA9IF8uZmlsdGVyKF8uemlwKHNlbGYuZ2V0KCdleHBTcGVjdHJ1bScpLmdldCgnbW96cycpLCBzZWxmLmdldCgnZXhwU3BlY3RydW0nKS5nZXQoJ2ludGVuc2l0eVJhbmtzJykpLCBmdW5jdGlvbihwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcFsxXSA8IGluRmlyc3QKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB2YXIgbVByZWMgPSBzZWxmLmdldCgnZXhwU3BlY3RydW0nKS5nZXQoJ3ByZWNNb3onKQogICAgICAgICAgICByZXR1cm4gXy5maWx0ZXIocGtzLCBmdW5jdGlvbihwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcFswXSA+IG1QcmVjOwogICAgICAgICAgICB9KS5sZW5ndGggLSBfLmZpbHRlcihtYXRjaGVzLCBmdW5jdGlvbihtKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gKG0uZXhwLmludGVuc2l0eVJhbmsgPCBpbkZpcnN0KSAmJiAobS5leHAubW96ID4gbVByZWMpOwogICAgICAgICAgICB9KS5sZW5ndGgKCiAgICAgICAgfQogICAgfSk7CgogICAgcmV0dXJuIFBTTUFsaWdubWVudDsKfSk7CgovKgogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KZGVmaW5lKCdmaXNodG9uZXMvdmlld3MvbWF0Y2gvU3BlY3RyYVBhaXJBbGlnbm1lbnRWaWV3JyxbJ3VuZGVyc2NvcmUnLCAnZDMnLCAnLi4vY29tbW9ucy9Db21tb25XaWRnZXRWaWV3JywgJ2Zpc2h0b25lcy92aWV3cy91dGlscy9EM1NjYWxpbmdDb250ZXh0JywgJ2Zpc2h0b25lcy92aWV3cy91dGlscy9EM1NjYWxpbmdBcmVhJ10sIGZ1bmN0aW9uKF8sIGQzLCBDb21tb25XaWRnZXRWaWV3LCBEM1NjYWxpbmdDb250ZXh0LCBEM1NjYWxpbmdBcmVhKSB7CiAgLyoKICAgKiBwcm9qZWN0ZWQgcGVha3MgY29udGFpbnMgNCB2YWx1ZXM6CiAgICoKICAgKiAwOiBtb3oKICAgKiAxOmludGVuc2l0eQogICAqIDI6IGludGVuc2l0eSByYW5rcwogICAqIDM6IGlzTWF0aGNpbmcgKCBjb25zdHJ1Y3RlZCBhdCB0aGUgYnVpbGREYXRhIHN0ZXApCiAgICovCiAgdmFyIHByb2plY3RTcGVjdHJ1bSA9IGZ1bmN0aW9uKGV4cFNwKSB7CiAgICByZXR1cm4gewogICAgICBwcmVjdXJzb3IgOiB7CiAgICAgICAgc2Nhbk51bWJlciA6IGV4cFNwLmdldCgnc2Nhbk51bWJlcicpLAogICAgICAgIGlkIDogZXhwU3AuZ2V0KCdpZCcpCiAgICAgIH0sCiAgICAgIHBlYWtzIDogXy5jaGFpbihleHBTcC5nZXQoJ21venMnKSkuemlwKGV4cFNwLmdldCgnaW50ZW5zaXRpZXMnKSwgZXhwU3AuZ2V0KCdpbnRlbnNpdHlSYW5rcycpKS52YWx1ZSgpCiAgICB9CiAgfQogIHZhciBwZWFrUmFua0NsYXNzID0gZnVuY3Rpb24ocGspIHsKICAgIHZhciBpcmsgPSBwa1syXTsKICAgIHJldHVybiAncmstJyArICgoaXJrIDwgNDApID8gTWF0aC5mbG9vcihpcmsgLyAxMCkgOiAneCcpOwogIH0KICB2YXIgU3BlY3RyYVBhaXJBbGlnbm1lbnRWaWV3ID0gQ29tbW9uV2lkZ2V0Vmlldy5leHRlbmQoewogICAgZGVmYXVsdHMgOiB7CiAgICB9LAogICAgaW5pdGlhbGl6ZSA6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgb3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCBvcHRpb25zKTsKICAgICAgU3BlY3RyYVBhaXJBbGlnbm1lbnRWaWV3Ll9fc3VwZXJfXy5pbml0aWFsaXplLmNhbGwodGhpcywgb3B0aW9ucykKICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICBzZWxmLmlzRW5oYW5jZWQgPSBvcHRpb25zLmVuaGFuY2VkOwogICAgICBzZWxmLm1heFJhbmtNYXRjaGluZ1BlYWtzID0gb3B0aW9ucy5tYXhQZWFrcyB8fCAxMDAwOwogICAgICBzZWxmLmluZGVwZW5kZW50WVNjYWxlcyA9IG9wdGlvbnMuaW5kZXBlbmRlbnRZU2NhbGVzOwogICAgICBzZWxmLmNvbG9yUGVha3MgPSBvcHRpb25zLmNvbG9yUGVha3M7CgogICAgICBzZWxmLmZyYWdUb2wgPSBvcHRpb25zLmZyYWdUb2wgfHwgMjA7CiAgICAgIHNlbGYuaGVpZ2h0TWlkZGxlWm9uZSA9IChzZWxmLmlzRW5oYW5jZWQpID8gKHNlbGYuaGVpZ2h0KCkgKiAwLjEpIDogMAoKICAgICAgc2VsZi5idWlsZCgpOwogICAgICBzZWxmLm1vZGVsLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbigpIHsKICAgICAgICBzZWxmLmJ1aWxkKCkucmVuZGVyKCk7CiAgICAgIH0pCiAgICB9LAoKICAgIGJ1aWxkIDogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiB0aGlzLmJ1aWxkRGF0YSgpLmJ1aWxkQ29udGV4dCgpLmJ1aWxkRDMoKTsKICAgIH0sCiAgICBidWlsZERhdGEgOiBmdW5jdGlvbigpIHsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICBzZWxmLnNwQSA9IHByb2plY3RTcGVjdHJ1bShzZWxmLm1vZGVsLmdldCgnc3BlY3RydW1BJykpOwogICAgICBzZWxmLnNwQiA9IHByb2plY3RTcGVjdHJ1bShzZWxmLm1vZGVsLmdldCgnc3BlY3RydW1CJykpOwoKICAgICAgaWYgKHNlbGYuaXNFbmhhbmNlZCkgewogICAgICAgIF8uZWFjaChzZWxmLm1vZGVsLmNsb3NlclRoYW5QUE0oc2VsZi5mcmFnVG9sKSwgZnVuY3Rpb24ocCkgewogICAgICAgICAgc2VsZi5zcEEucGVha3NbcC5wa0EuaW5kZXhdWzNdID0gdHJ1ZTsKICAgICAgICAgIHNlbGYuc3BCLnBlYWtzW3AucGtCLmluZGV4XVszXSA9IHRydWU7CiAgICAgICAgfSkKICAgICAgfQoKICAgICAgc2VsZi5hbGxQZWFrcyA9IHNlbGYuc3BBLnBlYWtzLm1hcChmdW5jdGlvbihwKSB7CiAgICAgICAgcFs0XSA9IDAKICAgICAgICByZXR1cm4gcDsKICAgICAgfSkuY29uY2F0KHNlbGYuc3BCLnBlYWtzLm1hcChmdW5jdGlvbihwKSB7CiAgICAgICAgcFs0XSA9IDEKICAgICAgICByZXR1cm4gcDsKICAgICAgfSkpCgogICAgICByZXR1cm4gc2VsZjsKICAgIH0sCiAgICBidWlsZENvbnRleHQgOiBmdW5jdGlvbigpIHsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgdmFyIHhNYXggPSBNYXRoLm1heChzZWxmLnNwQS5wZWFrc1tzZWxmLnNwQS5wZWFrcy5sZW5ndGgtMV1bMF0sIHNlbGYuc3BCLnBlYWtzW3NlbGYuc3BCLnBlYWtzLmxlbmd0aC0xXVswXSkgKiAxLjE7CiAgICAgIHZhciB4TWluID0gTWF0aC5tYXgoc2VsZi5zcEEucGVha3NbMF1bMF0sIHNlbGYuc3BCLnBlYWtzWzBdWzBdKSAqIDAuNTsKICAgICAgdmFyIHlNYXggPSBNYXRoLm1heChfLm1heChzZWxmLm1vZGVsLmdldCgnc3BlY3RydW1BJykuZ2V0KCdpbnRlbnNpdGllcycpKSwgXy5tYXgoc2VsZi5tb2RlbC5nZXQoJ3NwZWN0cnVtQicpLmdldCgnaW50ZW5zaXRpZXMnKSkpICogMS4wNTsKCiAgICAgIHNlbGYuc2V0dXBTY2FsaW5nQ29udGV4dCh7CiAgICAgICAgeERvbWFpbiA6IFt4TWluLCB4TWF4XSwKICAgICAgICB5RG9tYWluIDogWzAsIHlNYXhdLAogICAgICAgIGhlaWdodCA6IChzZWxmLmhlaWdodCgpIC0gc2VsZi5oZWlnaHRNaWRkbGVab25lKSAvIDIsCiAgICAgICAgd2lkdGggOiBzZWxmLndpZHRoKCkKICAgICAgfSkKCiAgICAgIHJldHVybiBzZWxmOwogICAgfSwKICAgIGJ1aWxkRDMgOiBmdW5jdGlvbigpIHsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgc2VsZi52aXMgPSBzZWxmLmVsLmFwcGVuZCgnc3ZnJyk7CiAgICAgIHNlbGYudmlzLmF0dHIoJ3dpZHRoJywgc2VsZi53aWR0aCgpKS5hdHRyKCdoZWlnaHQnLCBzZWxmLmhlaWdodCgpKS5hdHRyKCdjbGFzcycsICdzcGVjdHJhLXBhaXItYWxpZ25tZW50Jyk7CiAgICAgIHNlbGYudmlzLmFwcGVuZCgnbGluZScpLmF0dHIoJ3kxJywgc2VsZi5oZWlnaHQoKSAvIDIpLmF0dHIoJ3kyJywgc2VsZi5oZWlnaHQoKSAvIDIpLmF0dHIoJ3gxJywgMCkuYXR0cigneDInLCBzZWxmLndpZHRoKCkpLmF0dHIoJ2NsYXNzJywgJ2F4aXMnKQoKICAgICAgdmFyIHlzID0gW3NlbGYuc2NhbGluZ0NvbnRleHQueSgpLCBzZWxmLnNjYWxpbmdDb250ZXh0LnkoKV0KCiAgICAgIHlzWzFdLnJhbmdlKFsoc2VsZi5oZWlnaHQoKSArIHNlbGYuaGVpZ2h0TWlkZGxlWm9uZSkgLyAyLCBzZWxmLmhlaWdodCgpXSk7CiAgICAgIGlmIChzZWxmLmluZGVwZW5kZW50WVNjYWxlcykgewogICAgICAgIHlzWzBdLmRvbWFpbihbMCwgXy5tYXgoc2VsZi5tb2RlbC5nZXQoJ3NwZWN0cnVtQScpLmdldCgnaW50ZW5zaXRpZXMnKSkgKiAxLjA1XSkKICAgICAgICB5c1sxXS5kb21haW4oWzAsIF8ubWF4KHNlbGYubW9kZWwuZ2V0KCdzcGVjdHJ1bUInKS5nZXQoJ2ludGVuc2l0aWVzJykpICogMS4wNV0pCiAgICAgIH0KCiAgICAgIHZhciBqMHVwID0gKHNlbGYuaGVpZ2h0KCkgLSBzZWxmLmhlaWdodE1pZGRsZVpvbmUpIC8gMjsKICAgICAgdmFyIGowZG93biA9IChzZWxmLmhlaWdodCgpICsgc2VsZi5oZWlnaHRNaWRkbGVab25lKSAvIDI7CgogICAgICBzZWxmLnBlYWtzSG9sZGVyID0gc2VsZi52aXMuc2VsZWN0QWxsKCdsaW5lLnBlYWsnKS5kYXRhKHNlbGYuYWxsUGVha3MpLmVudGVyKCkuYXBwZW5kKCdsaW5lJykuYXR0cignY2xhc3MnLCBmdW5jdGlvbihwaykgewogICAgICAgIHZhciBjbCA9ICdwZWFrICBwZWFrLXgnOwogICAgICAgIGlmIChzZWxmLmNvbG9yUGVha3MpIHsKICAgICAgICAgIGNsICs9ICcgJyArIHBlYWtSYW5rQ2xhc3MocGspOwogICAgICAgIH0KICAgICAgICBpZiAoc2VsZi5pc0VuaGFuY2VkKSB7CiAgICAgICAgICBjbCArPSBwa1szXSA/ICIgbWF0Y2hlZCIgOiAiIHVubWF0Y2hlZCI7CiAgICAgICAgfQogICAgICAgIHJldHVybiBjbDsKICAgICAgfSkuYXR0cigneTEnLCBmdW5jdGlvbihwaykgewogICAgICAgIHJldHVybiB5c1twa1s0XV0oMCk7CiAgICAgICAgLy8ocGtbMV0gPiAwKSA/IGowdXAgOiBqMGRvd247CiAgICAgIH0pLmF0dHIoJ3kyJywgZnVuY3Rpb24ocGspIHsKICAgICAgICByZXR1cm4geXNbcGtbNF1dKHBrWzFdKS8vKHBrWzFdID4gMCkgPyAoajB1cCAtIHkocGtbMV0pKSA6IChqMGRvd24gKyB5KC1wa1sxXSkpOwogICAgICB9KTsKCiAgICAgIGlmIChzZWxmLmlzRW5oYW5jZWQpIHsKICAgICAgICBzZWxmLnZpcy5zZWxlY3RBbGwoJ2xpbmUucGVhay1tYXRjaCcpLmRhdGEoXy5maWx0ZXIoc2VsZi5zcEEucGVha3MuY29uY2F0KHNlbGYuc3BCLnBlYWtzKSwgZnVuY3Rpb24ocGspIHsKICAgICAgICAgIHJldHVybiBwa1szXSAmJiAocGtbMl0gPCBzZWxmLm1heFJhbmtNYXRjaGluZ1BlYWtzICk7CiAgICAgICAgfSkpLmVudGVyKCkuYXBwZW5kKCdsaW5lJykuYXR0cignY2xhc3MnLCBmdW5jdGlvbihwaykgewogICAgICAgICAgdmFyIGNsID0gJ3BlYWsgcGVhay1tYXRjaCBwZWFrLXgnOwogICAgICAgICAgY2wgKz0gJyAnICsgcGVha1JhbmtDbGFzcyhwayk7CiAgICAgICAgICByZXR1cm4gY2wKICAgICAgICB9KS5hdHRyKCd5MScsIHNlbGYuaGVpZ2h0KCkgLyAyKS5hdHRyKCd5MicsIGZ1bmN0aW9uKHBrKSB7CiAgICAgICAgICByZXR1cm4gKHBrWzRdID09IDApID8gajB1cCA6IGowZG93bjsKICAgICAgICB9KQogICAgICB9CgogICAgICB2YXIgZ3RpdGxlcyA9IHNlbGYudmlzLmFwcGVuZCgnZycpLmF0dHIoJ2NsYXNzJywgJ3RpdGxlcycpCiAgICAgIGd0aXRsZXMuYXBwZW5kKCd0ZXh0JykudGV4dCgnIycgKyBzZWxmLnNwQS5wcmVjdXJzb3Iuc2Nhbk51bWJlcikuYXR0cigneCcsIHNlbGYud2lkdGgoKSAtIDUpLmF0dHIoJ3knLCAzMCkuYXR0cignY2xhc3MnLCAnc2NhbiB0b3AnKQogICAgICBndGl0bGVzLmFwcGVuZCgndGV4dCcpLnRleHQoJyMnICsgc2VsZi5zcEIucHJlY3Vyc29yLnNjYW5OdW1iZXIpLmF0dHIoJ3gnLCBzZWxmLndpZHRoKCkgLSA1KS5hdHRyKCd5Jywgc2VsZi5oZWlnaHQoKSAtIDMwKS5hdHRyKCdjbGFzcycsICdzY2FuIGJvdHRvbScpCgogICAgICBzZWxmLmF4aXNDb250YWluZXIgPSBzZWxmLnZpcy5hcHBlbmQoJ2cnKS5hdHRyKCdjbGFzcycsICdheGlzJyk7CgogICAgICByZXR1cm4gc2VsZjsKICAgIH0sCiAgICByZW5kZXIgOiBmdW5jdGlvbigpIHsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICB2YXIgeCA9IHNlbGYuc2NhbGluZ0NvbnRleHQueCgpOwoKICAgICAgc2VsZi52aXMuc2VsZWN0QWxsKCdsaW5lLnBlYWsteCcpLmF0dHIoJ3gxJywgZnVuY3Rpb24ocGspIHsKICAgICAgICByZXR1cm4geChwa1swXSkKICAgICAgfSkuYXR0cigneDInLCBmdW5jdGlvbihwaykgewogICAgICAgIHJldHVybiB4KHBrWzBdKQogICAgICB9KTsKICAgICAgdmFyIHhBeGlzID0gZDMuc3ZnLmF4aXMoKS5zY2FsZSh4KS50aWNrU2l6ZSg2LCAwLCAwKS50aWNrcygzKS8vIiIudGlja0Zvcm1hdChkMy5mb3JtYXQoImQiKSk7CiAgICAgIHNlbGYuYXhpc0NvbnRhaW5lci5jYWxsKHhBeGlzKTsKICAgIH0KICB9KTsKCiAgcmV0dXJuIFNwZWN0cmFQYWlyQWxpZ25tZW50VmlldzsKCn0pCjsKLyoqCiAqIHRoaXMgaXMgYSBncmlkIGZvciBkaXNwbGF5aW5nIGEgc3BlY3RydW0vcGVwdGlkZSBtYXRjaC4gVGhlIGNsYXNzaWMgc3R1ZmYsIGFzCiAqIGEgaHRtbCB0YWJsZSwgYWRkaW5nIGNvbG9yIGFuZCBzby4uLgogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KZGVmaW5lKCdmaXNodG9uZXMvdmlld3MvbWF0Y2gvTWF0Y2hHcmlkVmFsdWVzVmlldycsWyd1bmRlcnNjb3JlJywgJ0JhY2tib25lJywgJy4uL2NvbW1vbnMvQ29tbW9uV2lkZ2V0VmlldyddLCBmdW5jdGlvbiAoXywgQmFja2JvbmUsIENvbW1vbldpZGdldFZpZXcpIHsKCiAgICBNYXRjaEdyaWRWYWx1ZXNWaWV3ID0gQ29tbW9uV2lkZ2V0Vmlldy5leHRlbmQoewogICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgTWF0Y2hHcmlkVmFsdWVzVmlldy5fX3N1cGVyX18uaW5pdGlhbGl6ZS5jYWxsKHRoaXMsIGFyZ3VtZW50cykKCiAgICAgICAgICAgIG9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgb3B0aW9ucyk7CiAgICAgICAgICAgIHNlbGYuaGVpZ2h0ID0gb3B0aW9ucy5oZWlnaHQgfHwgNDAwOwogICAgICAgICAgICBzZWxmLndpZHRoID0gb3B0aW9ucy53aWR0aCB8fCAzMDA7CiAgICAgICAgICAgIHNlbGYudG9sID0gb3B0aW9ucy50b2wgfHwgNTAwOwoKICAgICAgICAgICAgc2VsZi5lbC5jbGFzc2VkKCdkMy13aWRnZXQtbWF0Y2gtZ3JpZC12YWx1ZXMnLCB0cnVlKQogICAgICAgIH0sCiAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoKSB7CgogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICAgICAgICB2YXIgdGhlb1NwZWN0cnVtID0gc2VsZi5tb2RlbC5nZXQoJ3RoZW9TcGVjdHJ1bScpOwogICAgICAgICAgICB2YXIgbmJTZXJpZXMgPSB0aGVvU3BlY3RydW0uZ2V0KCdmcmFnU2VyaWVzJykubGVuZ3RoCgogICAgICAgICAgICBzZWxmLmVsLmFwcGVuZCgncmVjdCcpLmF0dHIoJ2NsYXNzJywgJ2JhY2tncm91bmQnKS5hdHRyKCd3aWR0aCcsIHNlbGYud2lkdGgpLmF0dHIoJ2hlaWdodCcsIHNlbGYuaGVpZ2h0KQogICAgICAgICAgICAvLyBnZXQgZnJhZyBzZXJpZXMgLT4gb3JkaW5hdGUKICAgICAgICAgICAgdmFyIHNlcmllczJpID0ge307CiAgICAgICAgICAgIHZhciBpX2MgPSAwOwogICAgICAgICAgICB2YXIgaV9uID0gMDsKICAgICAgICAgICAgXy5lYWNoKHRoZW9TcGVjdHJ1bS5nZXQoJ2ZyYWdTZXJpZXMnKSwgZnVuY3Rpb24gKGZzKSB7CiAgICAgICAgICAgICAgICBpZiAoZnMgPCAnbScpIHsvLyBudGVybQogICAgICAgICAgICAgICAgICAgIGlfbiA9IGlfbiAtIDM7CiAgICAgICAgICAgICAgICAgICAgc2VyaWVzMmlbZnNdID0gaV9uICsgMjsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaV9jID0gaV9jICsgMwogICAgICAgICAgICAgICAgICAgIHNlcmllczJpW2ZzXSA9IGlfYyArIDI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLy8gd2UgaGF2ZSB0byBzY2FsZSBbMDood2lkdGggLSAyKjEwKV0geCBbMC1oZWlnaHRdIHRvIFtpX246aV9jKzFdIHgKICAgICAgICAgICAgLy8gWy0xOiB0aGVvU3BlY3RydW0ucmljaFNlcXVlbmNlLnNpemUoKV0KICAgICAgICAgICAgdmFyIHJpY2hTZXEgPSB0aGVvU3BlY3RydW0uZ2V0KCdyaWNoU2VxdWVuY2UnKTsKICAgICAgICAgICAgdmFyIHNpemUgPSByaWNoU2VxLnNpemUoKTsKCiAgICAgICAgICAgIHZhciBzY2FsZSA9IE1hdGgubWluKCgoc2VsZi53aWR0aCkgLyAoaV9jICsgMSAtIGlfbiArIDMpKSwgKHNlbGYuaGVpZ2h0IC8gKHNpemUgKyAxKSkpOwogICAgICAgICAgICB2YXIgdHJhbnNmID0gJ3NjYWxlKCcgKyBzY2FsZSArICcsJyArIHNjYWxlICsgJyksdHJhbnNsYXRlKCcgKyAoLWlfbiArIDEpICsgJywxLjcpJzsKCiAgICAgICAgICAgIHZhciBnQ29udCA9IHNlbGYuZWwuYXBwZW5kKCdnJykuYXR0cigndHJhbnNmb3JtJywgdHJhbnNmKTsKCiAgICAgICAgICAgIHZhciBmczJpID0gZnVuY3Rpb24gKGZzKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc2VyaWVzMmlbZnNdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIGRhdGEgbWF0Y2hlcwogICAgICAgICAgICB2YXIgZG1hdGNoZXMgPSBzZWxmLm1vZGVsLmNsb3NlclRoYW5QUE0oc2VsZi50b2wpOwoKICAgICAgICAgICAgZ0NvbnQuc2VsZWN0QWxsKCd0ZXh0LmFhJykuZGF0YShyaWNoU2VxLmdldCgnc2VxdWVuY2UnKSkuZW50ZXIoKS5hcHBlbmQoJ3RleHQnKS5hdHRyKCdjbGFzcycsICdhYScpLmF0dHIoJ3gnLCAxKS5hdHRyKCd5JywgZnVuY3Rpb24gKGQsIGkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBpICsgMC41CiAgICAgICAgICAgIH0pLnRleHQoZnVuY3Rpb24gKGQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBkLmFhLmdldCgnY29kZTEnKQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHZhciBtb2RpZnMgPSBbcmljaFNlcS5nZXRNb2RpZmljYXRpb25BcnJheSgtMSldLmNvbmNhdChfLmNvbGxlY3QocmljaFNlcS5nZXQoJ3NlcXVlbmNlJyksIGZ1bmN0aW9uIChyYWEpIHsKICAgICAgICAgICAgICAgIHJldHVybiByYWEubW9kaWZpY2F0aW9ucwogICAgICAgICAgICB9KSkuY29uY2F0KFtyaWNoU2VxLmdldE1vZGlmaWNhdGlvbkFycmF5KHNpemUpXSk7CiAgICAgICAgICAgIGdDb250LnNlbGVjdEFsbCgndGV4dC5hYS1tb2RpZicpLmRhdGEobW9kaWZzKS5lbnRlcigpLmFwcGVuZCgndGV4dCcpLmF0dHIoJ2NsYXNzJywgJ2FhLW1vZGlmJykuYXR0cigneCcsIDEpLmF0dHIoJ3knLCBmdW5jdGlvbiAoZCwgaSkgewogICAgICAgICAgICAgICAgaWYgKGkgPT0gc2l6ZSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBpICsgMC4zMiAtIDAuNSArIDAuNQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGkgKyAwLjMyIC0gMSArIDAuNTsKICAgICAgICAgICAgfSkudGV4dChmdW5jdGlvbiAobW9kcykgewogICAgICAgICAgICAgICAgaWYgKG1vZHMgPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcnCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gXy5jb2xsZWN0KG1vZHMsIGZ1bmN0aW9uIChtKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG0uZ2V0KCduYW1lJyk7CiAgICAgICAgICAgICAgICB9KS5qb2luKCcsJyk7CgogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGdDb250LnNlbGVjdEFsbCgndGV4dC5zZXJpZXMnKS5kYXRhKHRoZW9TcGVjdHJ1bS5nZXQoJ2ZyYWdTZXJpZXMnKSkuZW50ZXIoKS5hcHBlbmQoJ3RleHQnKS5hdHRyKCdjbGFzcycsICdzZXJpZXMnKS5hdHRyKCd4JywgZnVuY3Rpb24gKGQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBzZXJpZXMyaVtkXTsKICAgICAgICAgICAgfSkuYXR0cigneScsIC0xKS50ZXh0KGZ1bmN0aW9uIChkKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZDsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB2YXIgcG9zbGFiID0gW107CiAgICAgICAgICAgIGZvciAoaSA9IDE7IGkgPD0gc2l6ZTsgaSsrKSB7CiAgICAgICAgICAgICAgICBwb3NsYWIucHVzaChpKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGdDb250LnNlbGVjdEFsbCgndGV4dC5wb3NsYWJlbC5udGVybScpLmRhdGEocG9zbGFiKS5lbnRlcigpLmFwcGVuZCgndGV4dCcpLmF0dHIoJ2NsYXNzJywgJ3Bvc2xhYmVsIG50ZXJtJykuYXR0cigneCcsIGlfbiAtIDAuOSkuYXR0cigneScsIGZ1bmN0aW9uIChkLCBpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gaSArIDEKICAgICAgICAgICAgfSkudGV4dChmdW5jdGlvbiAoZCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGQKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGdDb250LnNlbGVjdEFsbCgndGV4dC5wb3NsYWJlbC5jdGVybScpLmRhdGEocG9zbGFiKS5lbnRlcigpLmFwcGVuZCgndGV4dCcpLmF0dHIoJ2NsYXNzJywgJ3Bvc2xhYmVsIGN0ZXJtJykuYXR0cigneCcsIGlfYyArIDIuOSkuYXR0cigneScsIGZ1bmN0aW9uIChkLCBpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc2l6ZSAtIGkgLSAxCiAgICAgICAgICAgIH0pLnRleHQoZnVuY3Rpb24gKGQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBkCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgZ0NvbnQuc2VsZWN0QWxsKCd0ZXh0LnRoZW9mcmFnJykuZGF0YSh0aGVvU3BlY3RydW0uZ2V0KCdwZWFrcycpKS5lbnRlcigpLmFwcGVuZCgndGV4dCcpLmF0dHIoJ2NsYXNzJywgJ3RoZW9mcmFnJykuYXR0cigneCcsIGZ1bmN0aW9uIChwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc2VyaWVzMmlbcC5zZXJpZXNdCiAgICAgICAgICAgIH0pLmF0dHIoJ3knLCBmdW5jdGlvbiAocCkgewogICAgICAgICAgICAgICAgcmV0dXJuIChwLnNlcmllcyA8ICdnJykgPyAocC5wb3MgKyAxKSA6IHAucG9zCiAgICAgICAgICAgIH0pLnRleHQoZnVuY3Rpb24gKHApIHsKICAgICAgICAgICAgICAgIHJldHVybiBwLm1vei50b0ZpeGVkKDIpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGdDb250LnNlbGVjdEFsbCgncmVjdC5tYXRjaGluZycpLmRhdGEoZG1hdGNoZXMpLmVudGVyKCkuYXBwZW5kKCdyZWN0JykuYXR0cignY2xhc3MnLCBmdW5jdGlvbiAoZCkgewogICAgICAgICAgICAgICAgdmFyIGlyayA9IGQuZXhwLmludGVuc2l0eVJhbms7CiAgICAgICAgICAgICAgICByZXR1cm4gIm1hdGNoaW5nIHJrLSIgKyAoKGlyayA8IDQwKSA/IE1hdGguZmxvb3IoaXJrIC8gMTApIDogJ3gnKQogICAgICAgICAgICB9KS5hdHRyKCd4JywgZnVuY3Rpb24gKGQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBzZXJpZXMyaVtkLnRoZW8uc2VyaWVzXSAtIDIuOAogICAgICAgICAgICB9KS5hdHRyKCd5JywgZnVuY3Rpb24gKGQpIHsKICAgICAgICAgICAgICAgIHJldHVybiAoZC50aGVvLnNlcmllcyA8ICdnJykgPyAoZC50aGVvLnBvcyAtIDAuNyArIDEpIDogKGQudGhlby5wb3MgLSAwLjcpOwogICAgICAgICAgICB9KS5hdHRyKCd3aWR0aCcsIDMpLmF0dHIoJ2hlaWdodCcsIDEpOwogICAgICAgIH0KICAgIH0pOwoKICAgIHJldHVybiBNYXRjaEdyaWRWYWx1ZXNWaWV3Owp9KTsKCi8qCiAqIGEgY29tcGFjdCBpY29uaWMgdmlldyBvZiBTcGVjdHJ1bS9TcGVjdHJ1bSBhbGlnbm1lbnQKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCmRlZmluZSgnZmlzaHRvbmVzL3ZpZXdzL21hdGNoL1NwZWN0cmFQYWlyQWxpZ25tZW50SWNvbicsWyd1bmRlcnNjb3JlJywgJ2QzJywgJy4uL2NvbW1vbnMvQ29tbW9uV2lkZ2V0VmlldycsICdmaXNodG9uZXMvdXRpbHMvRGVsdGFNYXNzJywgJ2Zpc2h0b25lcy92aWV3cy91dGlscy9EM1NjYWxpbmdDb250ZXh0JywgJ2Zpc2h0b25lcy92aWV3cy91dGlscy9EM1NjYWxpbmdBcmVhJ10sIGZ1bmN0aW9uIChfLCBkMywgQ29tbW9uV2lkZ2V0VmlldywgRGVsdGFNYXNzLCBEM1NjYWxpbmdDb250ZXh0LCBEM1NjYWxpbmdBcmVhKSB7CgogICAgdmFyIHByb2plY3RTcGVjdHJ1bSA9IGZ1bmN0aW9uIChleHBTcCwgc2FtcGxlKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgcHJlY3Vyc29yOiB7CiAgICAgICAgICAgICAgICBzY2FuTnVtYmVyOiBleHBTcC5nZXQoJ3NjYW5OdW1iZXInKSwKICAgICAgICAgICAgICAgIGlkOiBleHBTcC5nZXQoJ2lkJykKICAgICAgICAgICAgfSwKICAgICAgICAgICAgcGVha3M6IF8uY2hhaW4oZXhwU3AuZ2V0KCdtb3pzJykpLnppcChleHBTcC5nZXQoJ2ludGVuc2l0aWVzJyksIGV4cFNwLmdldCgnaW50ZW5zaXR5UmFua3MnKSkubWFwKGZ1bmN0aW9uIChwLCBpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgIG1vejogcFswXSwKICAgICAgICAgICAgICAgICAgICBpbnRlbnNpdHlSYW5rOiBwWzJdLAogICAgICAgICAgICAgICAgICAgIG9yaWdJbmRleDogaSwKICAgICAgICAgICAgICAgICAgICBzYW1wbGU6IHNhbXBsZQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSkudmFsdWUoKQogICAgICAgIH0KICAgIH0KICAgIHZhciBTcGVjdHJhUGFpckFsaWdubWVudEljb24gPSBDb21tb25XaWRnZXRWaWV3LmV4dGVuZCh7CiAgICAgICAgZGVmYXVsdHM6IHsKICAgICAgICB9LAogICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgICAgICAgIG9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgb3B0aW9ucyk7CiAgICAgICAgICAgIFNwZWN0cmFQYWlyQWxpZ25tZW50SWNvbi5fX3N1cGVyX18uaW5pdGlhbGl6ZS5jYWxsKHRoaXMsIG9wdGlvbnMpCiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgICAgICAgIHNlbGYubWF4UGVha3MgPSBvcHRpb25zLm1heFBlYWtzIHx8IDUwOwogICAgICAgICAgICBzZWxmLmZyYWdUb2wgPSBvcHRpb25zLmZyYWdUb2wgfHwgMjA7CgogICAgICAgICAgICBzZWxmLmJ1aWxkKCk7CiAgICAgICAgICAgIHNlbGYubW9kZWwub24oJ2NoYW5nZScsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHNlbGYuYnVpbGQoKS5yZW5kZXIoKTsKICAgICAgICAgICAgfSkKICAgICAgICB9LAogICAgICAgIGJ1aWxkOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmJ1aWxkRGF0YSgpLmJ1aWxkQ29udGV4dCgpLmJ1aWxkRDMoKTsKICAgICAgICB9LAogICAgICAgIGJ1aWxkRGF0YTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHNlbGYuc3BBID0gcHJvamVjdFNwZWN0cnVtKHNlbGYubW9kZWwuZ2V0KCdzcGVjdHJ1bUEnKSwgMCk7CiAgICAgICAgICAgIHNlbGYuc3BCID0gcHJvamVjdFNwZWN0cnVtKHNlbGYubW9kZWwuZ2V0KCdzcGVjdHJ1bUInKSwgMSk7CgogICAgICAgICAgICAvL2xhYmVsIHRoZSBwZWFrcwogICAgICAgICAgICB2YXIgcGtCaW5zID0gWwogICAgICAgICAgICAgICAgW10sCiAgICAgICAgICAgICAgICBbXQogICAgICAgICAgICBdCgogICAgICAgICAgICAvL29uZSBwcm9qZWN0ZWQgcGVha3MgY29udGFpbnMgW21veiwgaW50ZW5zaXR5LCBpbnRlbnNpdHlSYW5rLCBpc01hdGNoaW5nLCBzYW1wbGVOYW1lLCBvdmVyYWxsTnVtYmVyXQoKICAgICAgICAgICAgc2VsZi5zb3J0ZWRNYXRjaGVkUGVha3MgPSBfLmNoYWluKHNlbGYuc3BBLnBlYWtzLmNvbmNhdChzZWxmLnNwQi5wZWFrcykpLmZpbHRlcihmdW5jdGlvbiAocCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHAuaW50ZW5zaXR5UmFuayA8IHNlbGYubWF4UGVha3M7CiAgICAgICAgICAgIH0pLnNvcnRCeShmdW5jdGlvbiAocCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHAubW96OwogICAgICAgICAgICB9KS5tYXAoZnVuY3Rpb24gKHAsIGkpIHsKICAgICAgICAgICAgICAgIHAuYmluSW5kZXggPSBpOwogICAgICAgICAgICAgICAgcC5tYXRjaGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICBwa0JpbnNbcC5zYW1wbGVdW3Aub3JpZ0luZGV4XSA9IGk7CiAgICAgICAgICAgICAgICByZXR1cm4gcDsKICAgICAgICAgICAgfSkudmFsdWUoKTsKCiAgICAgICAgICAgIHZhciBtYXRjaGVzID0gc2VsZi5tb2RlbC5jbG9zZXJUaGFuUFBNKHNlbGYuZnJhZ1RvbCk7CiAgICAgICAgICAgIF8uZWFjaChtYXRjaGVzLCBmdW5jdGlvbiAobSkgewogICAgICAgICAgICAgICAgaWYgKChtLnBrQi5pbnRlbnNpdHlSYW5rID49IHNlbGYubWF4UGVha3MpIHx8IChtLnBrQS5pbnRlbnNpdHlSYW5rID49IHNlbGYubWF4UGVha3MpKQogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIHNlbGYuc29ydGVkTWF0Y2hlZFBlYWtzLnB1c2goewogICAgICAgICAgICAgICAgICAgIHNhbXBsZTogMSwKICAgICAgICAgICAgICAgICAgICBiaW5JbmRleDogcGtCaW5zWzBdW20ucGtBLmluZGV4XSwKICAgICAgICAgICAgICAgICAgICBpbnRlbnNpdHlSYW5rOiBtLnBrQi5pbnRlbnNpdHlSYW5rLAogICAgICAgICAgICAgICAgICAgIG1hdGNoZWQ6IHRydWUKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgc2VsZi5zb3J0ZWRNYXRjaGVkUGVha3MucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgc2FtcGxlOiAwLAogICAgICAgICAgICAgICAgICAgIGJpbkluZGV4OiBwa0JpbnNbMV1bbS5wa0IuaW5kZXhdLAogICAgICAgICAgICAgICAgICAgIGludGVuc2l0eVJhbms6IG0ucGtBLmludGVuc2l0eVJhbmssCiAgICAgICAgICAgICAgICAgICAgbWF0Y2hlZDogdHJ1ZQogICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICBzZWxmLnNvcnRlZE1hdGNoZWRQZWFrc1twa0JpbnNbMV1bbS5wa0IuaW5kZXhdXS5tYXRjaGVkID0gdHJ1ZQogICAgICAgICAgICAgICAgc2VsZi5zb3J0ZWRNYXRjaGVkUGVha3NbcGtCaW5zWzBdW20ucGtBLmluZGV4XV0ubWF0Y2hlZCA9IHRydWUKCgogICAgICAgICAgICB9KQoKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgfSwKICAgICAgICBidWlsZENvbnRleHQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICAgICAgc2VsZi5zY2FsaW5nQ29udGV4dCA9IG5ldyBEM1NjYWxpbmdDb250ZXh0KHsKICAgICAgICAgICAgICAgIHhEb21haW46IFswLCAyICogc2VsZi5tYXhQZWFrc10sCiAgICAgICAgICAgICAgICB5RG9tYWluOiBbMiwgMF0sCiAgICAgICAgICAgICAgICBoZWlnaHQ6IHNlbGYuaGVpZ2h0KCksCiAgICAgICAgICAgICAgICB3aWR0aDogc2VsZi53aWR0aCgpCiAgICAgICAgICAgIH0pCgogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICB9LAogICAgICAgIGJ1aWxkRDM6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICBzZWxmLnZpcyA9IHNlbGYuZWwuYXBwZW5kKCdzdmcnKTsKICAgICAgICAgICAgc2VsZi52aXMuYXR0cignd2lkdGgnLCBzZWxmLndpZHRoKCkpLmF0dHIoJ2hlaWdodCcsIHNlbGYuaGVpZ2h0KCkpLmF0dHIoJ2NsYXNzJywgJ3NwZWN0cmEtcGFpci1pY29uJyk7CiAgICAgICAgICAgIHNlbGYudmlzLmFwcGVuZCgncmVjdCcpLmF0dHIoJ2NsYXNzJywgJ2JhY2tncm91bmQnKS5hdHRyKCdoZWlnaHQnLCAnMTAwJScpLmF0dHIoJ3dpZHRoJywgJzEwMCUnKTsKCiAgICAgICAgICAgIHNlbGYucGVha3NIb2xkZXIgPSBzZWxmLnZpcy5zZWxlY3RBbGwoJ3JlY3QucGVhay1iaW4nKS5kYXRhKHNlbGYuc29ydGVkTWF0Y2hlZFBlYWtzKS5lbnRlcigpLmFwcGVuZCgncmVjdCcpLmF0dHIoJ2NsYXNzJywgJ3BlYWstYmluJyk7CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIH0sCiAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIHggPSBzZWxmLnNjYWxpbmdDb250ZXh0LngoKTsKICAgICAgICAgICAgdmFyIHkgPSBzZWxmLnNjYWxpbmdDb250ZXh0LnkoKTsKCiAgICAgICAgICAgIHNlbGYucGVha3NIb2xkZXIuYXR0cigneCcsIGZ1bmN0aW9uIChwaykgewogICAgICAgICAgICAgICAgLy8gaWYocGtbNF09PSdCJyAmJiBwWzNdKXsKICAgICAgICAgICAgICAgIC8vIHJldHVybiB4KHBrWzVdLTEpCiAgICAgICAgICAgICAgICAvLyB9CiAgICAgICAgICAgICAgICByZXR1cm4geChway5iaW5JbmRleCkKICAgICAgICAgICAgfSkuYXR0cignd2lkdGgnLCBmdW5jdGlvbiAocGspIHsKICAgICAgICAgICAgICAgIHJldHVybiB4KDEpCiAgICAgICAgICAgIH0pLmF0dHIoJ2hlaWdodCcsIHkoMSkpLmF0dHIoJ3knLCBmdW5jdGlvbiAocGspIHsKICAgICAgICAgICAgICAgIHJldHVybiB5KHBrLnNhbXBsZSkKICAgICAgICAgICAgfSkuYXR0cignY2xhc3MnLCBmdW5jdGlvbiAocGspIHsKICAgICAgICAgICAgICAgIHZhciBpcmsgPSBway5pbnRlbnNpdHlSYW5rOwogICAgICAgICAgICAgICAgdmFyIGNsID0gJ3NwZWN0cmEtcGFpci1pY29uLWJpbiByay0nICsgKChpcmsgPCA0MCkgPyBNYXRoLmZsb29yKGlyayAvIDEwKSA6ICd4Jyk7CiAgICAgICAgICAgICAgICBpZiAocGsubWF0Y2hlZCkKICAgICAgICAgICAgICAgICAgICBjbCArPSAiIG1hdGNoZWQiCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgY2wgKz0gIiB1bm1hdGNoZWQiCiAgICAgICAgICAgICAgICByZXR1cm4gY2w7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH0pOwoKICAgIHJldHVybiBTcGVjdHJhUGFpckFsaWdubWVudEljb247Cgp9KTsKLyoqCiAqIHdyYXBwIGFsbCBleHBvc2VkIGZ1bmN0aW9uIGhhbmRsZXJzIGFuZCBwcm90b3R5cGVzCiAqCiAqIHRoZXJlIGlzIHNvbWUgcmVwZXRpdGlvbiBhbmQgc29tZSBvcmRlci4gQnV0IEkgY2Fubm90IGZpZ3VyZSBvdXQgd2hhdCBpcyBoYXBwZW5pbmcgd2l0aCBhbG1vbmQsIHdoaWNoIGxvb2sgbGlrZSBpdCBkb2VzIG5vdCBpbnRlcnByZXQgJ2RlZmluZScgaW4gc29tZSBjYXNzaWMgd2F5Li4uCiAqCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwoKKGZ1bmN0aW9uICgpIHsKICAgIGRlZmluZSgnanF1ZXJ5LXBsdXMnLCBbJ2pxdWVyeScsICdib290c3RyYXAnLCAndHlwZWFoZWFkJywgJ2pRdWVyeUNvb2tpZSddLCBmdW5jdGlvbiAoJCkgewogICAgICAgIHJldHVybiAkOwogICAgfSk7CgogICAgdmFyIGV4cG9ydGVkID0gewogICAgICAgIHdldDogWydDb25maWcnLCAnZmlzaHRvbmVzL21vZGVscy93ZXQvRXhwTVNNU1NwZWN0cnVtJywgJ2Zpc2h0b25lcy9jb2xsZWN0aW9ucy93ZXQvRXhwTVNNU1NwZWN0cnVtQ29sbGVjdGlvbicsICdmaXNodG9uZXMvbW9kZWxzL3dldC9NU01TUnVuJywgJ2Zpc2h0b25lcy9tb2RlbHMvd2V0L0luamVjdGlvbicsICdmaXNodG9uZXMvbW9kZWxzL3dldC9FeHBlcmltZW50JywgJ2Zpc2h0b25lcy9jb2xsZWN0aW9ucy93ZXQvWElDQ29sbGVjdGlvbicsICdmaXNodG9uZXMvdmlld3Mvd2V0L1hJQ1ZpZXcnLCAnZmlzaHRvbmVzL3ZpZXdzL3dldC9NdWx0aVhJQ1ZpZXcnLCAnZmlzaHRvbmVzL3ZpZXdzL3dldC9YSUNNdWx0aVBhbmVWaWV3JywgJ2Zpc2h0b25lcy92aWV3cy93ZXQvU3BlY3RydW1WaWV3J10sCiAgICAgICAgZHJ5OiBbJ2Zpc2h0b25lcy9tb2RlbHMvZHJ5L1JpY2hTZXF1ZW5jZScsICdmaXNodG9uZXMvc2VydmljZXMvZHJ5L0ltcGxpY2l0TW9kaWZpZXInLCAnZmlzaHRvbmVzL3NlcnZpY2VzL2RyeS9NYXNzQnVpbGRlcicsICdmaXNodG9uZXMvc2VydmljZXMvZHJ5L1JpY2hTZXF1ZW5jZVNob3J0Y3V0ZXInLCAnZmlzaHRvbmVzL2NvbGxlY3Rpb25zL2RyeS9SZXNpZHVlTW9kaWZpY2F0aW9uRGljdGlvbmFyeScsICdmaXNodG9uZXMvY29sbGVjdGlvbnMvZHJ5L0FtaW5vQWNpZERpY3Rpb25hcnknLCAnZmlzaHRvbmVzL3ZpZXdzL2RyeS9mb3Jtcy9SaWNoU2VxdWVuY2VJbnB1dCcsICdmaXNodG9uZXMvdmlld3MvZHJ5L1RoZW9PblNlcXVlbmNlVmlldyddLAogICAgICAgIG1hdGNoOiBbJ2Zpc2h0b25lcy9tb2RlbHMvbWF0Y2gvU3BlY3RyYVBhaXJBbGlnbm1lbnQnLCAnZmlzaHRvbmVzL3ZpZXdzL21hdGNoL1NwZWN0cmFQYWlyQWxpZ25tZW50VmlldycsICdmaXNodG9uZXMvbW9kZWxzL21hdGNoL1BTTUFsaWdubWVudCcsICdmaXNodG9uZXMvdmlld3MvbWF0Y2gvTWF0Y2hTcGVjdHJ1bVZpZXcnLCAnZmlzaHRvbmVzL3ZpZXdzL21hdGNoL01hdGNoR3JpZFZhbHVlc1ZpZXcnLCAnZmlzaHRvbmVzL3ZpZXdzL21hdGNoL01hdGNoTWFwUFFWaWV3JywgJ2Zpc2h0b25lcy92aWV3cy9tYXRjaC9NYXRjaE1hcFNsaW1WaWV3JywgJ2Zpc2h0b25lcy92aWV3cy9tYXRjaC9TcGVjdHJhUGFpckFsaWdubWVudEljb24nXSwKICAgICAgICB1dGlsczogWydmaXNodG9uZXMvdmlld3MvdXRpbHMvRDNTY2FsaW5nQ29udGV4dCcsICdmaXNodG9uZXMvdXRpbHMvRGVsdGFNYXNzJ10KICAgIH0KCiAgICBjb25zdCBjbGFzc1BhdGhzID0gW107CiAgICB2YXIgYWxsID0gW107CiAgICB2YXIgdHlwZTJjYXQgPSB7fTsKCiAgICBbJ3dldCcsICdkcnknLCAnbWF0Y2gnLCAndXRpbHMnXS5mb3JFYWNoKGZ1bmN0aW9uIChjYXQpIHsKICAgICAgICB2YXIgbCA9IGV4cG9ydGVkW2NhdF07CiAgICAgICAgZm9yIChpIGluIGwpIHsKICAgICAgICAgICAgdmFyIHR5cGUgPSBsW2ldOwogICAgICAgICAgICB0eXBlMmNhdFt0eXBlXSA9IGNhdDsKICAgICAgICAgICAgYWxsLnB1c2godHlwZSk7CiAgICAgICAgfQogICAgfSk7CgogICAgdmFyIGJ1aWxkRXhwb3J0ID0gZnVuY3Rpb24gKF8pIHsKICAgICAgICB2YXIgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cyk7CiAgICAgICAgdmFyICQgPSBhcmdzLnNoaWZ0KCk7CiAgICAgICAgdmFyIGV4cCA9IHt9CiAgICAgICAgZm9yIChpIGluIGFsbCkgewogICAgICAgICAgICB2YXIgYXJnID0gYXJnc1tpXTsKICAgICAgICAgICAgdmFyIHR5cGUgPSBhbGxbaV0KICAgICAgICAgICAgdmFyIHNpbXBsZU5hbWUgPSB0eXBlLnJlcGxhY2UoLy4qXC8vLCAnJyk7CiAgICAgICAgICAgIHZhciBjYXQgPSB0eXBlMmNhdFt0eXBlXTsKCiAgICAgICAgICAgIGlmIChleHBbY2F0XSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBleHBbY2F0XSA9IHt9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGV4cFtjYXRdW3NpbXBsZU5hbWVdID0gYXJnc1tpXTsKICAgICAgICB9CiAgICAgICAgZXhwLmRlcHMgPSB7CiAgICAgICAgICAgICckJzogJAogICAgICAgIH07CiAgICAgICAgcmV0dXJuIGV4cDsKICAgIH07CgogICAgZGVmaW5lKCdNU01TSlNFeHBvcnQnLFsKICAgICAgICAnanF1ZXJ5JywKICAgICAgICAnQ29uZmlnJywgJ2Zpc2h0b25lcy9tb2RlbHMvd2V0L0V4cE1TTVNTcGVjdHJ1bScsICdmaXNodG9uZXMvY29sbGVjdGlvbnMvd2V0L0V4cE1TTVNTcGVjdHJ1bUNvbGxlY3Rpb24nLCAnZmlzaHRvbmVzL21vZGVscy93ZXQvTVNNU1J1bicsICdmaXNodG9uZXMvbW9kZWxzL3dldC9JbmplY3Rpb24nLCAnZmlzaHRvbmVzL21vZGVscy93ZXQvRXhwZXJpbWVudCcsICdmaXNodG9uZXMvY29sbGVjdGlvbnMvd2V0L1hJQ0NvbGxlY3Rpb24nLCAnZmlzaHRvbmVzL3ZpZXdzL3dldC9YSUNWaWV3JywgJ2Zpc2h0b25lcy92aWV3cy93ZXQvTXVsdGlYSUNWaWV3JywgJ2Zpc2h0b25lcy92aWV3cy93ZXQvWElDTXVsdGlQYW5lVmlldycsICdmaXNodG9uZXMvdmlld3Mvd2V0L1NwZWN0cnVtVmlldycsCiAgICAgICAgJ2Zpc2h0b25lcy9tb2RlbHMvZHJ5L1JpY2hTZXF1ZW5jZScsICdmaXNodG9uZXMvc2VydmljZXMvZHJ5L0ltcGxpY2l0TW9kaWZpZXInLCAnZmlzaHRvbmVzL3NlcnZpY2VzL2RyeS9NYXNzQnVpbGRlcicsICdmaXNodG9uZXMvc2VydmljZXMvZHJ5L1JpY2hTZXF1ZW5jZVNob3J0Y3V0ZXInLCAnZmlzaHRvbmVzL2NvbGxlY3Rpb25zL2RyeS9SZXNpZHVlTW9kaWZpY2F0aW9uRGljdGlvbmFyeScsICdmaXNodG9uZXMvY29sbGVjdGlvbnMvZHJ5L0FtaW5vQWNpZERpY3Rpb25hcnknLCAnZmlzaHRvbmVzL3ZpZXdzL2RyeS9mb3Jtcy9SaWNoU2VxdWVuY2VJbnB1dCcsICdmaXNodG9uZXMvdmlld3MvZHJ5L1RoZW9PblNlcXVlbmNlVmlldycsCiAgICAgICAgJ2Zpc2h0b25lcy9tb2RlbHMvbWF0Y2gvU3BlY3RyYVBhaXJBbGlnbm1lbnQnLCAnZmlzaHRvbmVzL3ZpZXdzL21hdGNoL1NwZWN0cmFQYWlyQWxpZ25tZW50VmlldycsICdmaXNodG9uZXMvbW9kZWxzL21hdGNoL1BTTUFsaWdubWVudCcsICdmaXNodG9uZXMvdmlld3MvbWF0Y2gvTWF0Y2hTcGVjdHJ1bVZpZXcnLCAnZmlzaHRvbmVzL3ZpZXdzL21hdGNoL01hdGNoR3JpZFZhbHVlc1ZpZXcnLCAnZmlzaHRvbmVzL3ZpZXdzL21hdGNoL01hdGNoTWFwUFFWaWV3JywgJ2Zpc2h0b25lcy92aWV3cy9tYXRjaC9NYXRjaE1hcFNsaW1WaWV3JywgJ2Zpc2h0b25lcy92aWV3cy9tYXRjaC9TcGVjdHJhUGFpckFsaWdubWVudEljb24nLAogICAgICAgICdmaXNodG9uZXMvdmlld3MvdXRpbHMvRDNTY2FsaW5nQ29udGV4dCcsICdmaXNodG9uZXMvdXRpbHMvRGVsdGFNYXNzJywKICAgIF0sIGJ1aWxkRXhwb3J0KTsKCn0pKCk7CgogICAgcmV0dXJuIHJlcXVpcmUoJ01TTVNKU0V4cG9ydCcpOwp9KSk7",
                "body": "LyoqCiAqIHBWaXogYWxsIGJ1bmRsZWQgZmlsZSwgd2l0aCBkZXBlbmRlbmNpZXMKCgogKiBqUXVlcnkgdjEuOC4zIGpxdWVyeS5jb20gfCBqcXVlcnkub3JnL2xpY2Vuc2UKICogYm9vdHN0cmFwIDMuMCBUaGUgTUlUICBMaWNlbnNlIChNSVQpIENvcHlyaWdodCAoYykgMjAxMyBUd2l0dGVyLCBJbmMKICogZDMudjMuanMgQ29weXJpZ2h0IChjKSAyMDEzLCBNaWNoYWVsIEJvc3RvY2sgQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogYmFja2JvbmVqcy5vcmcgQ29weXJpZ2h0IChjKSAyMDEwLTIwMTMgSmVyZW15IEFzaGtlbmFzLCBEb2N1bWVudENsb3VkCiAqIHVuZGVyc2NvcmUuanMgQ29weXJpZ2h0IChjKSAyMDA5LTIwMTMgSmVyZW15IEFzaGtlbmFzLCBEb2N1bWVudENsb3VkIGFuZCBJbnZlc3RpZ2F0aXZlIFJlcG9ydGVycyAmIEVkaXRvcnMKIAogKiBmaXNodG9uZXMtanMKICogQ29weXJpZ2h0IChjKSAyMDEzLCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAgCiAgUmVkaXN0cmlidXRpb24gYW5kIHVzZSBpbiBzb3VyY2UgYW5kIGJpbmFyeSBmb3JtcyBhcmUgcGVybWl0dGVkCnByb3ZpZGVkIHRoYXQgdGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGFyYWdyYXBoIGFyZQkKZHVwbGljYXRlZCBpbiBhbGwgc3VjaCBmb3JtcyBhbmQgdGhhdCBhbnkgZG9jdW1lbnRhdGlvbiwKYWR2ZXJ0aXNpbmcgbWF0ZXJpYWxzLCBhbmQgb3RoZXIgbWF0ZXJpYWxzIHJlbGF0ZWQgdG8gc3VjaApkaXN0cmlidXRpb24gYW5kIHVzZSBhY2tub3dsZWRnZSB0aGF0IHRoZSBzb2Z0d2FyZSB3YXMgZGV2ZWxvcGVkCmJ5IHRoZSBCaW9pbmZvcm1hdGljcyBhbmQgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaCBJbmMuICBUaGUgbmFtZSBvZgpHZW5lbnRlY2ggbWF5IG5vdCBiZSB1c2VkIHRvIGVuZG9yc2Ugb3IgcHJvbW90ZSBwcm9kdWN0cyBkZXJpdmVkCmZyb20gdGhpcyBzb2Z0d2FyZSB3aXRob3V0IHNwZWNpZmljIHByaW9yIHdyaXR0ZW4gcGVybWlzc2lvbi4KVEhJUyBTT0ZUV0FSRSBJUyBQUk9WSURFRCBgYEFTIElTJycgQU5EIFdJVEhPVVQgQU5ZIEVYUFJFU1MgT1IKSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIFdJVEhPVVQgTElNSVRBVElPTiwgVEhFIElNUExJRUQKV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkgQU5EIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLgoKICovCgoKKGZ1bmN0aW9uIChyb290LCBmYWN0b3J5KSB7CiAgICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7CiAgIAogICAgICAgIGRlZmluZShmYWN0b3J5KTsKICAgIH0gZWxzZSB7CiAgICAgICAgLy9Ccm93c2VyIGdsb2JhbHMgY2FzZS4gSnVzdCBhc3NpZ24gdGhlCiAgICAgICAgLy9yZXN1bHQgdG8gYSBwcm9wZXJ0eSBvbiB0aGUgZ2xvYmFsLgogICAgICAgIHJvb3QuZmlzaHRvbmVzID0gZmFjdG9yeSgpOwogICAgfQp9KHRoaXMsIGZ1bmN0aW9uICgpIHsKICAgIC8vYWxtb25kLCBhbmQgeW91ciBtb2R1bGVzIHdpbGwgYmUgaW5saW5lZCBoZXJlCiAgICAKLyoqCiAqIGFsbW9uZCAwLjIuNSBDb3B5cmlnaHQgKGMpIDIwMTEtMjAxMiwgVGhlIERvam8gRm91bmRhdGlvbiBBbGwgUmlnaHRzIFJlc2VydmVkLgogKiBBdmFpbGFibGUgdmlhIHRoZSBNSVQgb3IgbmV3IEJTRCBsaWNlbnNlLgogKiBzZWU6IGh0dHA6Ly9naXRodWIuY29tL2pyYnVya2UvYWxtb25kIGZvciBkZXRhaWxzCiAqLwovL0dvaW5nIHNsb3BweSB0byBhdm9pZCAndXNlIHN0cmljdCcgc3RyaW5nIGNvc3QsIGJ1dCBzdHJpY3QgcHJhY3RpY2VzIHNob3VsZAovL2JlIGZvbGxvd2VkLgovKmpzbGludCBzbG9wcHk6IHRydWUgKi8KLypnbG9iYWwgc2V0VGltZW91dDogZmFsc2UgKi8KCnZhciByZXF1aXJlanMsIHJlcXVpcmUsIGRlZmluZTsKKGZ1bmN0aW9uICh1bmRlZikgewogICAgdmFyIG1haW4sIHJlcSwgbWFrZU1hcCwgaGFuZGxlcnMsCiAgICAgICAgZGVmaW5lZCA9IHt9LAogICAgICAgIHdhaXRpbmcgPSB7fSwKICAgICAgICBjb25maWcgPSB7fSwKICAgICAgICBkZWZpbmluZyA9IHt9LAogICAgICAgIGhhc093biA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHksCiAgICAgICAgYXBzID0gW10uc2xpY2U7CgogICAgZnVuY3Rpb24gaGFzUHJvcChvYmosIHByb3ApIHsKICAgICAgICByZXR1cm4gaGFzT3duLmNhbGwob2JqLCBwcm9wKTsKICAgIH0KCiAgICAvKioKICAgICAqIEdpdmVuIGEgcmVsYXRpdmUgbW9kdWxlIG5hbWUsIGxpa2UgLi9zb21ldGhpbmcsIG5vcm1hbGl6ZSBpdCB0bwogICAgICogYSByZWFsIG5hbWUgdGhhdCBjYW4gYmUgbWFwcGVkIHRvIGEgcGF0aC4KICAgICAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lIHRoZSByZWxhdGl2ZSBuYW1lCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gYmFzZU5hbWUgYSByZWFsIG5hbWUgdGhhdCB0aGUgbmFtZSBhcmcgaXMgcmVsYXRpdmUKICAgICAqIHRvLgogICAgICogQHJldHVybnMge1N0cmluZ30gbm9ybWFsaXplZCBuYW1lCiAgICAgKi8KICAgIGZ1bmN0aW9uIG5vcm1hbGl6ZShuYW1lLCBiYXNlTmFtZSkgewogICAgICAgIHZhciBuYW1lUGFydHMsIG5hbWVTZWdtZW50LCBtYXBWYWx1ZSwgZm91bmRNYXAsCiAgICAgICAgICAgIGZvdW5kSSwgZm91bmRTdGFyTWFwLCBzdGFySSwgaSwgaiwgcGFydCwKICAgICAgICAgICAgYmFzZVBhcnRzID0gYmFzZU5hbWUgJiYgYmFzZU5hbWUuc3BsaXQoIi8iKSwKICAgICAgICAgICAgbWFwID0gY29uZmlnLm1hcCwKICAgICAgICAgICAgc3Rhck1hcCA9IChtYXAgJiYgbWFwWycqJ10pIHx8IHt9OwoKICAgICAgICAvL0FkanVzdCBhbnkgcmVsYXRpdmUgcGF0aHMuCiAgICAgICAgaWYgKG5hbWUgJiYgbmFtZS5jaGFyQXQoMCkgPT09ICIuIikgewogICAgICAgICAgICAvL0lmIGhhdmUgYSBiYXNlIG5hbWUsIHRyeSB0byBub3JtYWxpemUgYWdhaW5zdCBpdCwKICAgICAgICAgICAgLy9vdGhlcndpc2UsIGFzc3VtZSBpdCBpcyBhIHRvcC1sZXZlbCByZXF1aXJlIHRoYXQgd2lsbAogICAgICAgICAgICAvL2JlIHJlbGF0aXZlIHRvIGJhc2VVcmwgaW4gdGhlIGVuZC4KICAgICAgICAgICAgaWYgKGJhc2VOYW1lKSB7CiAgICAgICAgICAgICAgICAvL0NvbnZlcnQgYmFzZU5hbWUgdG8gYXJyYXksIGFuZCBsb3Agb2ZmIHRoZSBsYXN0IHBhcnQsCiAgICAgICAgICAgICAgICAvL3NvIHRoYXQgLiBtYXRjaGVzIHRoYXQgImRpcmVjdG9yeSIgYW5kIG5vdCBuYW1lIG9mIHRoZSBiYXNlTmFtZSdzCiAgICAgICAgICAgICAgICAvL21vZHVsZS4gRm9yIGluc3RhbmNlLCBiYXNlTmFtZSBvZiAib25lL3R3by90aHJlZSIsIG1hcHMgdG8KICAgICAgICAgICAgICAgIC8vIm9uZS90d28vdGhyZWUuanMiLCBidXQgd2Ugd2FudCB0aGUgZGlyZWN0b3J5LCAib25lL3R3byIgZm9yCiAgICAgICAgICAgICAgICAvL3RoaXMgbm9ybWFsaXphdGlvbi4KICAgICAgICAgICAgICAgIGJhc2VQYXJ0cyA9IGJhc2VQYXJ0cy5zbGljZSgwLCBiYXNlUGFydHMubGVuZ3RoIC0gMSk7CgogICAgICAgICAgICAgICAgbmFtZSA9IGJhc2VQYXJ0cy5jb25jYXQobmFtZS5zcGxpdCgiLyIpKTsKCiAgICAgICAgICAgICAgICAvL3N0YXJ0IHRyaW1Eb3RzCiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbmFtZS5sZW5ndGg7IGkgKz0gMSkgewogICAgICAgICAgICAgICAgICAgIHBhcnQgPSBuYW1lW2ldOwogICAgICAgICAgICAgICAgICAgIGlmIChwYXJ0ID09PSAiLiIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZS5zcGxpY2UoaSwgMSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGkgLT0gMTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHBhcnQgPT09ICIuLiIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGkgPT09IDEgJiYgKG5hbWVbMl0gPT09ICcuLicgfHwgbmFtZVswXSA9PT0gJy4uJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vRW5kIG9mIHRoZSBsaW5lLiBLZWVwIGF0IGxlYXN0IG9uZSBub24tZG90CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3BhdGggc2VnbWVudCBhdCB0aGUgZnJvbnQgc28gaXQgY2FuIGJlIG1hcHBlZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9jb3JyZWN0bHkgdG8gZGlzay4gT3RoZXJ3aXNlLCB0aGVyZSBpcyBsaWtlbHkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vbm8gcGF0aCBtYXBwaW5nIGZvciBhIHBhdGggc3RhcnRpbmcgd2l0aCAnLi4nLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9UaGlzIGNhbiBzdGlsbCBmYWlsLCBidXQgY2F0Y2hlcyB0aGUgbW9zdCByZWFzb25hYmxlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3VzZXMgb2YgLi4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGkgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lLnNwbGljZShpIC0gMSwgMik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpIC09IDI7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvL2VuZCB0cmltRG90cwoKICAgICAgICAgICAgICAgIG5hbWUgPSBuYW1lLmpvaW4oIi8iKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChuYW1lLmluZGV4T2YoJy4vJykgPT09IDApIHsKICAgICAgICAgICAgICAgIC8vIE5vIGJhc2VOYW1lLCBzbyB0aGlzIGlzIElEIGlzIHJlc29sdmVkIHJlbGF0aXZlCiAgICAgICAgICAgICAgICAvLyB0byBiYXNlVXJsLCBwdWxsIG9mZiB0aGUgbGVhZGluZyBkb3QuCiAgICAgICAgICAgICAgICBuYW1lID0gbmFtZS5zdWJzdHJpbmcoMik7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vQXBwbHkgbWFwIGNvbmZpZyBpZiBhdmFpbGFibGUuCiAgICAgICAgaWYgKChiYXNlUGFydHMgfHwgc3Rhck1hcCkgJiYgbWFwKSB7CiAgICAgICAgICAgIG5hbWVQYXJ0cyA9IG5hbWUuc3BsaXQoJy8nKTsKCiAgICAgICAgICAgIGZvciAoaSA9IG5hbWVQYXJ0cy5sZW5ndGg7IGkgPiAwOyBpIC09IDEpIHsKICAgICAgICAgICAgICAgIG5hbWVTZWdtZW50ID0gbmFtZVBhcnRzLnNsaWNlKDAsIGkpLmpvaW4oIi8iKTsKCiAgICAgICAgICAgICAgICBpZiAoYmFzZVBhcnRzKSB7CiAgICAgICAgICAgICAgICAgICAgLy9GaW5kIHRoZSBsb25nZXN0IGJhc2VOYW1lIHNlZ21lbnQgbWF0Y2ggaW4gdGhlIGNvbmZpZy4KICAgICAgICAgICAgICAgICAgICAvL1NvLCBkbyBqb2lucyBvbiB0aGUgYmlnZ2VzdCB0byBzbWFsbGVzdCBsZW5ndGhzIG9mIGJhc2VQYXJ0cy4KICAgICAgICAgICAgICAgICAgICBmb3IgKGogPSBiYXNlUGFydHMubGVuZ3RoOyBqID4gMDsgaiAtPSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG1hcFZhbHVlID0gbWFwW2Jhc2VQYXJ0cy5zbGljZSgwLCBqKS5qb2luKCcvJyldOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy9iYXNlTmFtZSBzZWdtZW50IGhhcyAgY29uZmlnLCBmaW5kIGlmIGl0IGhhcyBvbmUgZm9yCiAgICAgICAgICAgICAgICAgICAgICAgIC8vdGhpcyBuYW1lLgogICAgICAgICAgICAgICAgICAgICAgICBpZiAobWFwVmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcFZhbHVlID0gbWFwVmFsdWVbbmFtZVNlZ21lbnRdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1hcFZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9NYXRjaCwgdXBkYXRlIG5hbWUgdG8gdGhlIG5ldyB2YWx1ZS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3VuZE1hcCA9IG1hcFZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvdW5kSSA9IGk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKGZvdW5kTWFwKSB7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy9DaGVjayBmb3IgYSBzdGFyIG1hcCBtYXRjaCwgYnV0IGp1c3QgaG9sZCBvbiB0byBpdCwKICAgICAgICAgICAgICAgIC8vaWYgdGhlcmUgaXMgYSBzaG9ydGVyIHNlZ21lbnQgbWF0Y2ggbGF0ZXIgaW4gYSBtYXRjaGluZwogICAgICAgICAgICAgICAgLy9jb25maWcsIHRoZW4gZmF2b3Igb3ZlciB0aGlzIHN0YXIgbWFwLgogICAgICAgICAgICAgICAgaWYgKCFmb3VuZFN0YXJNYXAgJiYgc3Rhck1hcCAmJiBzdGFyTWFwW25hbWVTZWdtZW50XSkgewogICAgICAgICAgICAgICAgICAgIGZvdW5kU3Rhck1hcCA9IHN0YXJNYXBbbmFtZVNlZ21lbnRdOwogICAgICAgICAgICAgICAgICAgIHN0YXJJID0gaTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCFmb3VuZE1hcCAmJiBmb3VuZFN0YXJNYXApIHsKICAgICAgICAgICAgICAgIGZvdW5kTWFwID0gZm91bmRTdGFyTWFwOwogICAgICAgICAgICAgICAgZm91bmRJID0gc3Rhckk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChmb3VuZE1hcCkgewogICAgICAgICAgICAgICAgbmFtZVBhcnRzLnNwbGljZSgwLCBmb3VuZEksIGZvdW5kTWFwKTsKICAgICAgICAgICAgICAgIG5hbWUgPSBuYW1lUGFydHMuam9pbignLycpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbmFtZTsKICAgIH0KCiAgICBmdW5jdGlvbiBtYWtlUmVxdWlyZShyZWxOYW1lLCBmb3JjZVN5bmMpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAvL0EgdmVyc2lvbiBvZiBhIHJlcXVpcmUgZnVuY3Rpb24gdGhhdCBwYXNzZXMgYSBtb2R1bGVOYW1lCiAgICAgICAgICAgIC8vdmFsdWUgZm9yIGl0ZW1zIHRoYXQgbWF5IG5lZWQgdG8KICAgICAgICAgICAgLy9sb29rIHVwIHBhdGhzIHJlbGF0aXZlIHRvIHRoZSBtb2R1bGVOYW1lCiAgICAgICAgICAgIHJldHVybiByZXEuYXBwbHkodW5kZWYsIGFwcy5jYWxsKGFyZ3VtZW50cywgMCkuY29uY2F0KFtyZWxOYW1lLCBmb3JjZVN5bmNdKSk7CiAgICAgICAgfTsKICAgIH0KCiAgICBmdW5jdGlvbiBtYWtlTm9ybWFsaXplKHJlbE5hbWUpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKG5hbWUpIHsKICAgICAgICAgICAgcmV0dXJuIG5vcm1hbGl6ZShuYW1lLCByZWxOYW1lKTsKICAgICAgICB9OwogICAgfQoKICAgIGZ1bmN0aW9uIG1ha2VMb2FkKGRlcE5hbWUpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgICAgIGRlZmluZWRbZGVwTmFtZV0gPSB2YWx1ZTsKICAgICAgICB9OwogICAgfQoKICAgIGZ1bmN0aW9uIGNhbGxEZXAobmFtZSkgewogICAgICAgIGlmIChoYXNQcm9wKHdhaXRpbmcsIG5hbWUpKSB7CiAgICAgICAgICAgIHZhciBhcmdzID0gd2FpdGluZ1tuYW1lXTsKICAgICAgICAgICAgZGVsZXRlIHdhaXRpbmdbbmFtZV07CiAgICAgICAgICAgIGRlZmluaW5nW25hbWVdID0gdHJ1ZTsKICAgICAgICAgICAgbWFpbi5hcHBseSh1bmRlZiwgYXJncyk7CiAgICAgICAgfQoKICAgICAgICBpZiAoIWhhc1Byb3AoZGVmaW5lZCwgbmFtZSkgJiYgIWhhc1Byb3AoZGVmaW5pbmcsIG5hbWUpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTm8gJyArIG5hbWUpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZGVmaW5lZFtuYW1lXTsKICAgIH0KCiAgICAvL1R1cm5zIGEgcGx1Z2luIXJlc291cmNlIHRvIFtwbHVnaW4sIHJlc291cmNlXQogICAgLy93aXRoIHRoZSBwbHVnaW4gYmVpbmcgdW5kZWZpbmVkIGlmIHRoZSBuYW1lCiAgICAvL2RpZCBub3QgaGF2ZSBhIHBsdWdpbiBwcmVmaXguCiAgICBmdW5jdGlvbiBzcGxpdFByZWZpeChuYW1lKSB7CiAgICAgICAgdmFyIHByZWZpeCwKICAgICAgICAgICAgaW5kZXggPSBuYW1lID8gbmFtZS5pbmRleE9mKCchJykgOiAtMTsKICAgICAgICBpZiAoaW5kZXggPiAtMSkgewogICAgICAgICAgICBwcmVmaXggPSBuYW1lLnN1YnN0cmluZygwLCBpbmRleCk7CiAgICAgICAgICAgIG5hbWUgPSBuYW1lLnN1YnN0cmluZyhpbmRleCArIDEsIG5hbWUubGVuZ3RoKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIFtwcmVmaXgsIG5hbWVdOwogICAgfQoKICAgIC8qKgogICAgICogTWFrZXMgYSBuYW1lIG1hcCwgbm9ybWFsaXppbmcgdGhlIG5hbWUsIGFuZCB1c2luZyBhIHBsdWdpbgogICAgICogZm9yIG5vcm1hbGl6YXRpb24gaWYgbmVjZXNzYXJ5LiBHcmFicyBhIHJlZiB0byBwbHVnaW4KICAgICAqIHRvbywgYXMgYW4gb3B0aW1pemF0aW9uLgogICAgICovCiAgICBtYWtlTWFwID0gZnVuY3Rpb24gKG5hbWUsIHJlbE5hbWUpIHsKICAgICAgICB2YXIgcGx1Z2luLAogICAgICAgICAgICBwYXJ0cyA9IHNwbGl0UHJlZml4KG5hbWUpLAogICAgICAgICAgICBwcmVmaXggPSBwYXJ0c1swXTsKCiAgICAgICAgbmFtZSA9IHBhcnRzWzFdOwoKICAgICAgICBpZiAocHJlZml4KSB7CiAgICAgICAgICAgIHByZWZpeCA9IG5vcm1hbGl6ZShwcmVmaXgsIHJlbE5hbWUpOwogICAgICAgICAgICBwbHVnaW4gPSBjYWxsRGVwKHByZWZpeCk7CiAgICAgICAgfQoKICAgICAgICAvL05vcm1hbGl6ZSBhY2NvcmRpbmcKICAgICAgICBpZiAocHJlZml4KSB7CiAgICAgICAgICAgIGlmIChwbHVnaW4gJiYgcGx1Z2luLm5vcm1hbGl6ZSkgewogICAgICAgICAgICAgICAgbmFtZSA9IHBsdWdpbi5ub3JtYWxpemUobmFtZSwgbWFrZU5vcm1hbGl6ZShyZWxOYW1lKSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBuYW1lID0gbm9ybWFsaXplKG5hbWUsIHJlbE5hbWUpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbmFtZSA9IG5vcm1hbGl6ZShuYW1lLCByZWxOYW1lKTsKICAgICAgICAgICAgcGFydHMgPSBzcGxpdFByZWZpeChuYW1lKTsKICAgICAgICAgICAgcHJlZml4ID0gcGFydHNbMF07CiAgICAgICAgICAgIG5hbWUgPSBwYXJ0c1sxXTsKICAgICAgICAgICAgaWYgKHByZWZpeCkgewogICAgICAgICAgICAgICAgcGx1Z2luID0gY2FsbERlcChwcmVmaXgpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvL1VzaW5nIHJpZGljdWxvdXMgcHJvcGVydHkgbmFtZXMgZm9yIHNwYWNlIHJlYXNvbnMKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBmOiBwcmVmaXggPyBwcmVmaXggKyAnIScgKyBuYW1lIDogbmFtZSwgLy9mdWxsTmFtZQogICAgICAgICAgICBuOiBuYW1lLAogICAgICAgICAgICBwcjogcHJlZml4LAogICAgICAgICAgICBwOiBwbHVnaW4KICAgICAgICB9OwogICAgfTsKCiAgICBmdW5jdGlvbiBtYWtlQ29uZmlnKG5hbWUpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gKGNvbmZpZyAmJiBjb25maWcuY29uZmlnICYmIGNvbmZpZy5jb25maWdbbmFtZV0pIHx8IHt9OwogICAgICAgIH07CiAgICB9CgogICAgaGFuZGxlcnMgPSB7CiAgICAgICAgcmVxdWlyZTogZnVuY3Rpb24gKG5hbWUpIHsKICAgICAgICAgICAgcmV0dXJuIG1ha2VSZXF1aXJlKG5hbWUpOwogICAgICAgIH0sCiAgICAgICAgZXhwb3J0czogZnVuY3Rpb24gKG5hbWUpIHsKICAgICAgICAgICAgdmFyIGUgPSBkZWZpbmVkW25hbWVdOwogICAgICAgICAgICBpZiAodHlwZW9mIGUgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiAoZGVmaW5lZFtuYW1lXSA9IHt9KTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgbW9kdWxlOiBmdW5jdGlvbiAobmFtZSkgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgaWQ6IG5hbWUsCiAgICAgICAgICAgICAgICB1cmk6ICcnLAogICAgICAgICAgICAgICAgZXhwb3J0czogZGVmaW5lZFtuYW1lXSwKICAgICAgICAgICAgICAgIGNvbmZpZzogbWFrZUNvbmZpZyhuYW1lKQogICAgICAgICAgICB9OwogICAgICAgIH0KICAgIH07CgogICAgbWFpbiA9IGZ1bmN0aW9uIChuYW1lLCBkZXBzLCBjYWxsYmFjaywgcmVsTmFtZSkgewogICAgICAgIHZhciBjanNNb2R1bGUsIGRlcE5hbWUsIHJldCwgbWFwLCBpLAogICAgICAgICAgICBhcmdzID0gW10sCiAgICAgICAgICAgIHVzaW5nRXhwb3J0czsKCiAgICAgICAgLy9Vc2UgbmFtZSBpZiBubyByZWxOYW1lCiAgICAgICAgcmVsTmFtZSA9IHJlbE5hbWUgfHwgbmFtZTsKCiAgICAgICAgLy9DYWxsIHRoZSBjYWxsYmFjayB0byBkZWZpbmUgdGhlIG1vZHVsZSwgaWYgbmVjZXNzYXJ5LgogICAgICAgIGlmICh0eXBlb2YgY2FsbGJhY2sgPT09ICdmdW5jdGlvbicpIHsKCiAgICAgICAgICAgIC8vUHVsbCBvdXQgdGhlIGRlZmluZWQgZGVwZW5kZW5jaWVzIGFuZCBwYXNzIHRoZSBvcmRlcmVkCiAgICAgICAgICAgIC8vdmFsdWVzIHRvIHRoZSBjYWxsYmFjay4KICAgICAgICAgICAgLy9EZWZhdWx0IHRvIFtyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGVdIGlmIG5vIGRlcHMKICAgICAgICAgICAgZGVwcyA9ICFkZXBzLmxlbmd0aCAmJiBjYWxsYmFjay5sZW5ndGggPyBbJ3JlcXVpcmUnLCAnZXhwb3J0cycsICdtb2R1bGUnXSA6IGRlcHM7CiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBkZXBzLmxlbmd0aDsgaSArPSAxKSB7CiAgICAgICAgICAgICAgICBtYXAgPSBtYWtlTWFwKGRlcHNbaV0sIHJlbE5hbWUpOwogICAgICAgICAgICAgICAgZGVwTmFtZSA9IG1hcC5mOwoKICAgICAgICAgICAgICAgIC8vRmFzdCBwYXRoIENvbW1vbkpTIHN0YW5kYXJkIGRlcGVuZGVuY2llcy4KICAgICAgICAgICAgICAgIGlmIChkZXBOYW1lID09PSAicmVxdWlyZSIpIHsKICAgICAgICAgICAgICAgICAgICBhcmdzW2ldID0gaGFuZGxlcnMucmVxdWlyZShuYW1lKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZGVwTmFtZSA9PT0gImV4cG9ydHMiKSB7CiAgICAgICAgICAgICAgICAgICAgLy9Db21tb25KUyBtb2R1bGUgc3BlYyAxLjEKICAgICAgICAgICAgICAgICAgICBhcmdzW2ldID0gaGFuZGxlcnMuZXhwb3J0cyhuYW1lKTsKICAgICAgICAgICAgICAgICAgICB1c2luZ0V4cG9ydHMgPSB0cnVlOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChkZXBOYW1lID09PSAibW9kdWxlIikgewogICAgICAgICAgICAgICAgICAgIC8vQ29tbW9uSlMgbW9kdWxlIHNwZWMgMS4xCiAgICAgICAgICAgICAgICAgICAgY2pzTW9kdWxlID0gYXJnc1tpXSA9IGhhbmRsZXJzLm1vZHVsZShuYW1lKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaGFzUHJvcChkZWZpbmVkLCBkZXBOYW1lKSB8fAogICAgICAgICAgICAgICAgICAgICAgICAgICBoYXNQcm9wKHdhaXRpbmcsIGRlcE5hbWUpIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhc1Byb3AoZGVmaW5pbmcsIGRlcE5hbWUpKSB7CiAgICAgICAgICAgICAgICAgICAgYXJnc1tpXSA9IGNhbGxEZXAoZGVwTmFtZSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG1hcC5wKSB7CiAgICAgICAgICAgICAgICAgICAgbWFwLnAubG9hZChtYXAubiwgbWFrZVJlcXVpcmUocmVsTmFtZSwgdHJ1ZSksIG1ha2VMb2FkKGRlcE5hbWUpLCB7fSk7CiAgICAgICAgICAgICAgICAgICAgYXJnc1tpXSA9IGRlZmluZWRbZGVwTmFtZV07CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihuYW1lICsgJyBtaXNzaW5nICcgKyBkZXBOYW1lKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0ID0gY2FsbGJhY2suYXBwbHkoZGVmaW5lZFtuYW1lXSwgYXJncyk7CgogICAgICAgICAgICBpZiAobmFtZSkgewogICAgICAgICAgICAgICAgLy9JZiBzZXR0aW5nIGV4cG9ydHMgdmlhICJtb2R1bGUiIGlzIGluIHBsYXksCiAgICAgICAgICAgICAgICAvL2Zhdm9yIHRoYXQgb3ZlciByZXR1cm4gdmFsdWUgYW5kIGV4cG9ydHMuIEFmdGVyIHRoYXQsCiAgICAgICAgICAgICAgICAvL2Zhdm9yIGEgbm9uLXVuZGVmaW5lZCByZXR1cm4gdmFsdWUgb3ZlciBleHBvcnRzIHVzZS4KICAgICAgICAgICAgICAgIGlmIChjanNNb2R1bGUgJiYgY2pzTW9kdWxlLmV4cG9ydHMgIT09IHVuZGVmICYmCiAgICAgICAgICAgICAgICAgICAgICAgIGNqc01vZHVsZS5leHBvcnRzICE9PSBkZWZpbmVkW25hbWVdKSB7CiAgICAgICAgICAgICAgICAgICAgZGVmaW5lZFtuYW1lXSA9IGNqc01vZHVsZS5leHBvcnRzOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXQgIT09IHVuZGVmIHx8ICF1c2luZ0V4cG9ydHMpIHsKICAgICAgICAgICAgICAgICAgICAvL1VzZSB0aGUgcmV0dXJuIHZhbHVlIGZyb20gdGhlIGZ1bmN0aW9uLgogICAgICAgICAgICAgICAgICAgIGRlZmluZWRbbmFtZV0gPSByZXQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKG5hbWUpIHsKICAgICAgICAgICAgLy9NYXkganVzdCBiZSBhbiBvYmplY3QgZGVmaW5pdGlvbiBmb3IgdGhlIG1vZHVsZS4gT25seQogICAgICAgICAgICAvL3dvcnJ5IGFib3V0IGRlZmluaW5nIGlmIGhhdmUgYSBtb2R1bGUgbmFtZS4KICAgICAgICAgICAgZGVmaW5lZFtuYW1lXSA9IGNhbGxiYWNrOwogICAgICAgIH0KICAgIH07CgogICAgcmVxdWlyZWpzID0gcmVxdWlyZSA9IHJlcSA9IGZ1bmN0aW9uIChkZXBzLCBjYWxsYmFjaywgcmVsTmFtZSwgZm9yY2VTeW5jLCBhbHQpIHsKICAgICAgICBpZiAodHlwZW9mIGRlcHMgPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgIGlmIChoYW5kbGVyc1tkZXBzXSkgewogICAgICAgICAgICAgICAgLy9jYWxsYmFjayBpbiB0aGlzIGNhc2UgaXMgcmVhbGx5IHJlbE5hbWUKICAgICAgICAgICAgICAgIHJldHVybiBoYW5kbGVyc1tkZXBzXShjYWxsYmFjayk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy9KdXN0IHJldHVybiB0aGUgbW9kdWxlIHdhbnRlZC4gSW4gdGhpcyBzY2VuYXJpbywgdGhlCiAgICAgICAgICAgIC8vZGVwcyBhcmcgaXMgdGhlIG1vZHVsZSBuYW1lLCBhbmQgc2Vjb25kIGFyZyAoaWYgcGFzc2VkKQogICAgICAgICAgICAvL2lzIGp1c3QgdGhlIHJlbE5hbWUuCiAgICAgICAgICAgIC8vTm9ybWFsaXplIG1vZHVsZSBuYW1lLCBpZiBpdCBjb250YWlucyAuIG9yIC4uCiAgICAgICAgICAgIHJldHVybiBjYWxsRGVwKG1ha2VNYXAoZGVwcywgY2FsbGJhY2spLmYpOwogICAgICAgIH0gZWxzZSBpZiAoIWRlcHMuc3BsaWNlKSB7CiAgICAgICAgICAgIC8vZGVwcyBpcyBhIGNvbmZpZyBvYmplY3QsIG5vdCBhbiBhcnJheS4KICAgICAgICAgICAgY29uZmlnID0gZGVwczsKICAgICAgICAgICAgaWYgKGNhbGxiYWNrLnNwbGljZSkgewogICAgICAgICAgICAgICAgLy9jYWxsYmFjayBpcyBhbiBhcnJheSwgd2hpY2ggbWVhbnMgaXQgaXMgYSBkZXBlbmRlbmN5IGxpc3QuCiAgICAgICAgICAgICAgICAvL0FkanVzdCBhcmdzIGlmIHRoZXJlIGFyZSBkZXBlbmRlbmNpZXMKICAgICAgICAgICAgICAgIGRlcHMgPSBjYWxsYmFjazsKICAgICAgICAgICAgICAgIGNhbGxiYWNrID0gcmVsTmFtZTsKICAgICAgICAgICAgICAgIHJlbE5hbWUgPSBudWxsOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZGVwcyA9IHVuZGVmOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvL1N1cHBvcnQgcmVxdWlyZShbJ2EnXSkKICAgICAgICBjYWxsYmFjayA9IGNhbGxiYWNrIHx8IGZ1bmN0aW9uICgpIHt9OwoKICAgICAgICAvL0lmIHJlbE5hbWUgaXMgYSBmdW5jdGlvbiwgaXQgaXMgYW4gZXJyYmFjayBoYW5kbGVyLAogICAgICAgIC8vc28gcmVtb3ZlIGl0LgogICAgICAgIGlmICh0eXBlb2YgcmVsTmFtZSA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICByZWxOYW1lID0gZm9yY2VTeW5jOwogICAgICAgICAgICBmb3JjZVN5bmMgPSBhbHQ7CiAgICAgICAgfQoKICAgICAgICAvL1NpbXVsYXRlIGFzeW5jIGNhbGxiYWNrOwogICAgICAgIGlmIChmb3JjZVN5bmMpIHsKICAgICAgICAgICAgbWFpbih1bmRlZiwgZGVwcywgY2FsbGJhY2ssIHJlbE5hbWUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vVXNpbmcgYSBub24temVybyB2YWx1ZSBiZWNhdXNlIG9mIGNvbmNlcm4gZm9yIHdoYXQgb2xkIGJyb3dzZXJzCiAgICAgICAgICAgIC8vZG8sIGFuZCBsYXRlc3QgYnJvd3NlcnMgInVwZ3JhZGUiIHRvIDQgaWYgbG93ZXIgdmFsdWUgaXMgdXNlZDoKICAgICAgICAgICAgLy9odHRwOi8vd3d3LndoYXR3Zy5vcmcvc3BlY3Mvd2ViLWFwcHMvY3VycmVudC13b3JrL211bHRpcGFnZS90aW1lcnMuaHRtbCNkb20td2luZG93dGltZXJzLXNldHRpbWVvdXQ6CiAgICAgICAgICAgIC8vSWYgd2FudCBhIHZhbHVlIGltbWVkaWF0ZWx5LCB1c2UgcmVxdWlyZSgnaWQnKSBpbnN0ZWFkIC0tIHNvbWV0aGluZwogICAgICAgICAgICAvL3RoYXQgd29ya3MgaW4gYWxtb25kIG9uIHRoZSBnbG9iYWwgbGV2ZWwsIGJ1dCBub3QgZ3VhcmFudGVlZCBhbmQKICAgICAgICAgICAgLy91bmxpa2VseSB0byB3b3JrIGluIG90aGVyIEFNRCBpbXBsZW1lbnRhdGlvbnMuCiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgbWFpbih1bmRlZiwgZGVwcywgY2FsbGJhY2ssIHJlbE5hbWUpOwogICAgICAgICAgICB9LCA0KTsKICAgICAgICB9CgogICAgICAgIHJldHVybiByZXE7CiAgICB9OwoKICAgIC8qKgogICAgICogSnVzdCBkcm9wcyB0aGUgY29uZmlnIG9uIHRoZSBmbG9vciwgYnV0IHJldHVybnMgcmVxIGluIGNhc2UKICAgICAqIHRoZSBjb25maWcgcmV0dXJuIHZhbHVlIGlzIHVzZWQuCiAgICAgKi8KICAgIHJlcS5jb25maWcgPSBmdW5jdGlvbiAoY2ZnKSB7CiAgICAgICAgY29uZmlnID0gY2ZnOwogICAgICAgIGlmIChjb25maWcuZGVwcykgewogICAgICAgICAgICByZXEoY29uZmlnLmRlcHMsIGNvbmZpZy5jYWxsYmFjayk7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXE7CiAgICB9OwoKICAgIGRlZmluZSA9IGZ1bmN0aW9uIChuYW1lLCBkZXBzLCBjYWxsYmFjaykgewoKICAgICAgICAvL1RoaXMgbW9kdWxlIG1heSBub3QgaGF2ZSBkZXBlbmRlbmNpZXMKICAgICAgICBpZiAoIWRlcHMuc3BsaWNlKSB7CiAgICAgICAgICAgIC8vZGVwcyBpcyBub3QgYW4gYXJyYXksIHNvIHByb2JhYmx5IG1lYW5zCiAgICAgICAgICAgIC8vYW4gb2JqZWN0IGxpdGVyYWwgb3IgZmFjdG9yeSBmdW5jdGlvbiBmb3IKICAgICAgICAgICAgLy90aGUgdmFsdWUuIEFkanVzdCBhcmdzLgogICAgICAgICAgICBjYWxsYmFjayA9IGRlcHM7CiAgICAgICAgICAgIGRlcHMgPSBbXTsKICAgICAgICB9CgogICAgICAgIGlmICghaGFzUHJvcChkZWZpbmVkLCBuYW1lKSAmJiAhaGFzUHJvcCh3YWl0aW5nLCBuYW1lKSkgewogICAgICAgICAgICB3YWl0aW5nW25hbWVdID0gW25hbWUsIGRlcHMsIGNhbGxiYWNrXTsKICAgICAgICB9CiAgICB9OwoKICAgIGRlZmluZS5hbWQgPSB7CiAgICAgICAgalF1ZXJ5OiB0cnVlCiAgICB9Owp9KCkpOwpkZWZpbmUoIi4uLy4uL2J1aWxkLXV0aWxzL2FsbW9uZCIsIGZ1bmN0aW9uKCl7fSk7CgovKiEKICogalF1ZXJ5IEphdmFTY3JpcHQgTGlicmFyeSB2MS45LjEKICogaHR0cDovL2pxdWVyeS5jb20vCiAqCiAqIEluY2x1ZGVzIFNpenpsZS5qcwogKiBodHRwOi8vc2l6emxlanMuY29tLwogKgogKiBDb3B5cmlnaHQgMjAwNSwgMjAxMiBqUXVlcnkgRm91bmRhdGlvbiwgSW5jLiBhbmQgb3RoZXIgY29udHJpYnV0b3JzCiAqIFJlbGVhc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZQogKiBodHRwOi8vanF1ZXJ5Lm9yZy9saWNlbnNlCiAqCiAqIERhdGU6IDIwMTMtMi00CiAqLwooZnVuY3Rpb24oIHdpbmRvdywgdW5kZWZpbmVkICkgewoKLy8gQ2FuJ3QgZG8gdGhpcyBiZWNhdXNlIHNldmVyYWwgYXBwcyBpbmNsdWRpbmcgQVNQLk5FVCB0cmFjZQovLyB0aGUgc3RhY2sgdmlhIGFyZ3VtZW50cy5jYWxsZXIuY2FsbGVlIGFuZCBGaXJlZm94IGRpZXMgaWYKLy8geW91IHRyeSB0byB0cmFjZSB0aHJvdWdoICJ1c2Ugc3RyaWN0IiBjYWxsIGNoYWlucy4gKCMxMzMzNSkKLy8gU3VwcG9ydDogRmlyZWZveCAxOCsKLy8KdmFyCgkvLyBUaGUgZGVmZXJyZWQgdXNlZCBvbiBET00gcmVhZHkKCXJlYWR5TGlzdCwKCgkvLyBBIGNlbnRyYWwgcmVmZXJlbmNlIHRvIHRoZSByb290IGpRdWVyeShkb2N1bWVudCkKCXJvb3RqUXVlcnksCgoJLy8gU3VwcG9ydDogSUU8OQoJLy8gRm9yIGB0eXBlb2Ygbm9kZS5tZXRob2RgIGluc3RlYWQgb2YgYG5vZGUubWV0aG9kICE9PSB1bmRlZmluZWRgCgljb3JlX3N0cnVuZGVmaW5lZCA9IHR5cGVvZiB1bmRlZmluZWQsCgoJLy8gVXNlIHRoZSBjb3JyZWN0IGRvY3VtZW50IGFjY29yZGluZ2x5IHdpdGggd2luZG93IGFyZ3VtZW50IChzYW5kYm94KQoJZG9jdW1lbnQgPSB3aW5kb3cuZG9jdW1lbnQsCglsb2NhdGlvbiA9IHdpbmRvdy5sb2NhdGlvbiwKCgkvLyBNYXAgb3ZlciBqUXVlcnkgaW4gY2FzZSBvZiBvdmVyd3JpdGUKCV9qUXVlcnkgPSB3aW5kb3cualF1ZXJ5LAoKCS8vIE1hcCBvdmVyIHRoZSAkIGluIGNhc2Ugb2Ygb3ZlcndyaXRlCglfJCA9IHdpbmRvdy4kLAoKCS8vIFtbQ2xhc3NdXSAtPiB0eXBlIHBhaXJzCgljbGFzczJ0eXBlID0ge30sCgoJLy8gTGlzdCBvZiBkZWxldGVkIGRhdGEgY2FjaGUgaWRzLCBzbyB3ZSBjYW4gcmV1c2UgdGhlbQoJY29yZV9kZWxldGVkSWRzID0gW10sCgoJY29yZV92ZXJzaW9uID0gIjEuOS4xIiwKCgkvLyBTYXZlIGEgcmVmZXJlbmNlIHRvIHNvbWUgY29yZSBtZXRob2RzCgljb3JlX2NvbmNhdCA9IGNvcmVfZGVsZXRlZElkcy5jb25jYXQsCgljb3JlX3B1c2ggPSBjb3JlX2RlbGV0ZWRJZHMucHVzaCwKCWNvcmVfc2xpY2UgPSBjb3JlX2RlbGV0ZWRJZHMuc2xpY2UsCgljb3JlX2luZGV4T2YgPSBjb3JlX2RlbGV0ZWRJZHMuaW5kZXhPZiwKCWNvcmVfdG9TdHJpbmcgPSBjbGFzczJ0eXBlLnRvU3RyaW5nLAoJY29yZV9oYXNPd24gPSBjbGFzczJ0eXBlLmhhc093blByb3BlcnR5LAoJY29yZV90cmltID0gY29yZV92ZXJzaW9uLnRyaW0sCgoJLy8gRGVmaW5lIGEgbG9jYWwgY29weSBvZiBqUXVlcnkKCWpRdWVyeSA9IGZ1bmN0aW9uKCBzZWxlY3RvciwgY29udGV4dCApIHsKCQkvLyBUaGUgalF1ZXJ5IG9iamVjdCBpcyBhY3R1YWxseSBqdXN0IHRoZSBpbml0IGNvbnN0cnVjdG9yICdlbmhhbmNlZCcKCQlyZXR1cm4gbmV3IGpRdWVyeS5mbi5pbml0KCBzZWxlY3RvciwgY29udGV4dCwgcm9vdGpRdWVyeSApOwoJfSwKCgkvLyBVc2VkIGZvciBtYXRjaGluZyBudW1iZXJzCgljb3JlX3BudW0gPSAvWystXT8oPzpcZCpcLnwpXGQrKD86W2VFXVsrLV0/XGQrfCkvLnNvdXJjZSwKCgkvLyBVc2VkIGZvciBzcGxpdHRpbmcgb24gd2hpdGVzcGFjZQoJY29yZV9ybm90d2hpdGUgPSAvXFMrL2csCgoJLy8gTWFrZSBzdXJlIHdlIHRyaW0gQk9NIGFuZCBOQlNQIChoZXJlJ3MgbG9va2luZyBhdCB5b3UsIFNhZmFyaSA1LjAgYW5kIElFKQoJcnRyaW0gPSAvXltcc1x1RkVGRlx4QTBdK3xbXHNcdUZFRkZceEEwXSskL2csCgoJLy8gQSBzaW1wbGUgd2F5IHRvIGNoZWNrIGZvciBIVE1MIHN0cmluZ3MKCS8vIFByaW9yaXRpemUgI2lkIG92ZXIgPHRhZz4gdG8gYXZvaWQgWFNTIHZpYSBsb2NhdGlvbi5oYXNoICgjOTUyMSkKCS8vIFN0cmljdCBIVE1MIHJlY29nbml0aW9uICgjMTEyOTA6IG11c3Qgc3RhcnQgd2l0aCA8KQoJcnF1aWNrRXhwciA9IC9eKD86KDxbXHdcV10rPilbXj5dKnwjKFtcdy1dKikpJC8sCgoJLy8gTWF0Y2ggYSBzdGFuZGFsb25lIHRhZwoJcnNpbmdsZVRhZyA9IC9ePChcdyspXHMqXC8/Pig/OjxcL1wxPnwpJC8sCgoJLy8gSlNPTiBSZWdFeHAKCXJ2YWxpZGNoYXJzID0gL15bXF0sOnt9XHNdKiQvLAoJcnZhbGlkYnJhY2VzID0gLyg/Ol58OnwsKSg/OlxzKlxbKSsvZywKCXJ2YWxpZGVzY2FwZSA9IC9cXCg/OlsiXFxcL2JmbnJ0XXx1W1xkYS1mQS1GXXs0fSkvZywKCXJ2YWxpZHRva2VucyA9IC8iW14iXFxcclxuXSoifHRydWV8ZmFsc2V8bnVsbHwtPyg/OlxkK1wufClcZCsoPzpbZUVdWystXT9cZCt8KS9nLAoKCS8vIE1hdGNoZXMgZGFzaGVkIHN0cmluZyBmb3IgY2FtZWxpemluZwoJcm1zUHJlZml4ID0gL14tbXMtLywKCXJkYXNoQWxwaGEgPSAvLShbXGRhLXpdKS9naSwKCgkvLyBVc2VkIGJ5IGpRdWVyeS5jYW1lbENhc2UgYXMgY2FsbGJhY2sgdG8gcmVwbGFjZSgpCglmY2FtZWxDYXNlID0gZnVuY3Rpb24oIGFsbCwgbGV0dGVyICkgewoJCXJldHVybiBsZXR0ZXIudG9VcHBlckNhc2UoKTsKCX0sCgoJLy8gVGhlIHJlYWR5IGV2ZW50IGhhbmRsZXIKCWNvbXBsZXRlZCA9IGZ1bmN0aW9uKCBldmVudCApIHsKCgkJLy8gcmVhZHlTdGF0ZSA9PT0gImNvbXBsZXRlIiBpcyBnb29kIGVub3VnaCBmb3IgdXMgdG8gY2FsbCB0aGUgZG9tIHJlYWR5IGluIG9sZElFCgkJaWYgKCBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyIHx8IGV2ZW50LnR5cGUgPT09ICJsb2FkIiB8fCBkb2N1bWVudC5yZWFkeVN0YXRlID09PSAiY29tcGxldGUiICkgewoJCQlkZXRhY2goKTsKCQkJalF1ZXJ5LnJlYWR5KCk7CgkJfQoJfSwKCS8vIENsZWFuLXVwIG1ldGhvZCBmb3IgZG9tIHJlYWR5IGV2ZW50cwoJZGV0YWNoID0gZnVuY3Rpb24oKSB7CgkJaWYgKCBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyICkgewoJCQlkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCAiRE9NQ29udGVudExvYWRlZCIsIGNvbXBsZXRlZCwgZmFsc2UgKTsKCQkJd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoICJsb2FkIiwgY29tcGxldGVkLCBmYWxzZSApOwoKCQl9IGVsc2UgewoJCQlkb2N1bWVudC5kZXRhY2hFdmVudCggIm9ucmVhZHlzdGF0ZWNoYW5nZSIsIGNvbXBsZXRlZCApOwoJCQl3aW5kb3cuZGV0YWNoRXZlbnQoICJvbmxvYWQiLCBjb21wbGV0ZWQgKTsKCQl9Cgl9OwoKalF1ZXJ5LmZuID0galF1ZXJ5LnByb3RvdHlwZSA9IHsKCS8vIFRoZSBjdXJyZW50IHZlcnNpb24gb2YgalF1ZXJ5IGJlaW5nIHVzZWQKCWpxdWVyeTogY29yZV92ZXJzaW9uLAoKCWNvbnN0cnVjdG9yOiBqUXVlcnksCglpbml0OiBmdW5jdGlvbiggc2VsZWN0b3IsIGNvbnRleHQsIHJvb3RqUXVlcnkgKSB7CgkJdmFyIG1hdGNoLCBlbGVtOwoKCQkvLyBIQU5ETEU6ICQoIiIpLCAkKG51bGwpLCAkKHVuZGVmaW5lZCksICQoZmFsc2UpCgkJaWYgKCAhc2VsZWN0b3IgKSB7CgkJCXJldHVybiB0aGlzOwoJCX0KCgkJLy8gSGFuZGxlIEhUTUwgc3RyaW5ncwoJCWlmICggdHlwZW9mIHNlbGVjdG9yID09PSAic3RyaW5nIiApIHsKCQkJaWYgKCBzZWxlY3Rvci5jaGFyQXQoMCkgPT09ICI8IiAmJiBzZWxlY3Rvci5jaGFyQXQoIHNlbGVjdG9yLmxlbmd0aCAtIDEgKSA9PT0gIj4iICYmIHNlbGVjdG9yLmxlbmd0aCA+PSAzICkgewoJCQkJLy8gQXNzdW1lIHRoYXQgc3RyaW5ncyB0aGF0IHN0YXJ0IGFuZCBlbmQgd2l0aCA8PiBhcmUgSFRNTCBhbmQgc2tpcCB0aGUgcmVnZXggY2hlY2sKCQkJCW1hdGNoID0gWyBudWxsLCBzZWxlY3RvciwgbnVsbCBdOwoKCQkJfSBlbHNlIHsKCQkJCW1hdGNoID0gcnF1aWNrRXhwci5leGVjKCBzZWxlY3RvciApOwoJCQl9CgoJCQkvLyBNYXRjaCBodG1sIG9yIG1ha2Ugc3VyZSBubyBjb250ZXh0IGlzIHNwZWNpZmllZCBmb3IgI2lkCgkJCWlmICggbWF0Y2ggJiYgKG1hdGNoWzFdIHx8ICFjb250ZXh0KSApIHsKCgkJCQkvLyBIQU5ETEU6ICQoaHRtbCkgLT4gJChhcnJheSkKCQkJCWlmICggbWF0Y2hbMV0gKSB7CgkJCQkJY29udGV4dCA9IGNvbnRleHQgaW5zdGFuY2VvZiBqUXVlcnkgPyBjb250ZXh0WzBdIDogY29udGV4dDsKCgkJCQkJLy8gc2NyaXB0cyBpcyB0cnVlIGZvciBiYWNrLWNvbXBhdAoJCQkJCWpRdWVyeS5tZXJnZSggdGhpcywgalF1ZXJ5LnBhcnNlSFRNTCgKCQkJCQkJbWF0Y2hbMV0sCgkJCQkJCWNvbnRleHQgJiYgY29udGV4dC5ub2RlVHlwZSA/IGNvbnRleHQub3duZXJEb2N1bWVudCB8fCBjb250ZXh0IDogZG9jdW1lbnQsCgkJCQkJCXRydWUKCQkJCQkpICk7CgoJCQkJCS8vIEhBTkRMRTogJChodG1sLCBwcm9wcykKCQkJCQlpZiAoIHJzaW5nbGVUYWcudGVzdCggbWF0Y2hbMV0gKSAmJiBqUXVlcnkuaXNQbGFpbk9iamVjdCggY29udGV4dCApICkgewoJCQkJCQlmb3IgKCBtYXRjaCBpbiBjb250ZXh0ICkgewoJCQkJCQkJLy8gUHJvcGVydGllcyBvZiBjb250ZXh0IGFyZSBjYWxsZWQgYXMgbWV0aG9kcyBpZiBwb3NzaWJsZQoJCQkJCQkJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggdGhpc1sgbWF0Y2ggXSApICkgewoJCQkJCQkJCXRoaXNbIG1hdGNoIF0oIGNvbnRleHRbIG1hdGNoIF0gKTsKCgkJCQkJCQkvLyAuLi5hbmQgb3RoZXJ3aXNlIHNldCBhcyBhdHRyaWJ1dGVzCgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCXRoaXMuYXR0ciggbWF0Y2gsIGNvbnRleHRbIG1hdGNoIF0gKTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCgkJCQkJcmV0dXJuIHRoaXM7CgoJCQkJLy8gSEFORExFOiAkKCNpZCkKCQkJCX0gZWxzZSB7CgkJCQkJZWxlbSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCBtYXRjaFsyXSApOwoKCQkJCQkvLyBDaGVjayBwYXJlbnROb2RlIHRvIGNhdGNoIHdoZW4gQmxhY2tiZXJyeSA0LjYgcmV0dXJucwoJCQkJCS8vIG5vZGVzIHRoYXQgYXJlIG5vIGxvbmdlciBpbiB0aGUgZG9jdW1lbnQgIzY5NjMKCQkJCQlpZiAoIGVsZW0gJiYgZWxlbS5wYXJlbnROb2RlICkgewoJCQkJCQkvLyBIYW5kbGUgdGhlIGNhc2Ugd2hlcmUgSUUgYW5kIE9wZXJhIHJldHVybiBpdGVtcwoJCQkJCQkvLyBieSBuYW1lIGluc3RlYWQgb2YgSUQKCQkJCQkJaWYgKCBlbGVtLmlkICE9PSBtYXRjaFsyXSApIHsKCQkJCQkJCXJldHVybiByb290alF1ZXJ5LmZpbmQoIHNlbGVjdG9yICk7CgkJCQkJCX0KCgkJCQkJCS8vIE90aGVyd2lzZSwgd2UgaW5qZWN0IHRoZSBlbGVtZW50IGRpcmVjdGx5IGludG8gdGhlIGpRdWVyeSBvYmplY3QKCQkJCQkJdGhpcy5sZW5ndGggPSAxOwoJCQkJCQl0aGlzWzBdID0gZWxlbTsKCQkJCQl9CgoJCQkJCXRoaXMuY29udGV4dCA9IGRvY3VtZW50OwoJCQkJCXRoaXMuc2VsZWN0b3IgPSBzZWxlY3RvcjsKCQkJCQlyZXR1cm4gdGhpczsKCQkJCX0KCgkJCS8vIEhBTkRMRTogJChleHByLCAkKC4uLikpCgkJCX0gZWxzZSBpZiAoICFjb250ZXh0IHx8IGNvbnRleHQuanF1ZXJ5ICkgewoJCQkJcmV0dXJuICggY29udGV4dCB8fCByb290alF1ZXJ5ICkuZmluZCggc2VsZWN0b3IgKTsKCgkJCS8vIEhBTkRMRTogJChleHByLCBjb250ZXh0KQoJCQkvLyAod2hpY2ggaXMganVzdCBlcXVpdmFsZW50IHRvOiAkKGNvbnRleHQpLmZpbmQoZXhwcikKCQkJfSBlbHNlIHsKCQkJCXJldHVybiB0aGlzLmNvbnN0cnVjdG9yKCBjb250ZXh0ICkuZmluZCggc2VsZWN0b3IgKTsKCQkJfQoKCQkvLyBIQU5ETEU6ICQoRE9NRWxlbWVudCkKCQl9IGVsc2UgaWYgKCBzZWxlY3Rvci5ub2RlVHlwZSApIHsKCQkJdGhpcy5jb250ZXh0ID0gdGhpc1swXSA9IHNlbGVjdG9yOwoJCQl0aGlzLmxlbmd0aCA9IDE7CgkJCXJldHVybiB0aGlzOwoKCQkvLyBIQU5ETEU6ICQoZnVuY3Rpb24pCgkJLy8gU2hvcnRjdXQgZm9yIGRvY3VtZW50IHJlYWR5CgkJfSBlbHNlIGlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIHNlbGVjdG9yICkgKSB7CgkJCXJldHVybiByb290alF1ZXJ5LnJlYWR5KCBzZWxlY3RvciApOwoJCX0KCgkJaWYgKCBzZWxlY3Rvci5zZWxlY3RvciAhPT0gdW5kZWZpbmVkICkgewoJCQl0aGlzLnNlbGVjdG9yID0gc2VsZWN0b3Iuc2VsZWN0b3I7CgkJCXRoaXMuY29udGV4dCA9IHNlbGVjdG9yLmNvbnRleHQ7CgkJfQoKCQlyZXR1cm4galF1ZXJ5Lm1ha2VBcnJheSggc2VsZWN0b3IsIHRoaXMgKTsKCX0sCgoJLy8gU3RhcnQgd2l0aCBhbiBlbXB0eSBzZWxlY3RvcgoJc2VsZWN0b3I6ICIiLAoKCS8vIFRoZSBkZWZhdWx0IGxlbmd0aCBvZiBhIGpRdWVyeSBvYmplY3QgaXMgMAoJbGVuZ3RoOiAwLAoKCS8vIFRoZSBudW1iZXIgb2YgZWxlbWVudHMgY29udGFpbmVkIGluIHRoZSBtYXRjaGVkIGVsZW1lbnQgc2V0CglzaXplOiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5sZW5ndGg7Cgl9LAoKCXRvQXJyYXk6IGZ1bmN0aW9uKCkgewoJCXJldHVybiBjb3JlX3NsaWNlLmNhbGwoIHRoaXMgKTsKCX0sCgoJLy8gR2V0IHRoZSBOdGggZWxlbWVudCBpbiB0aGUgbWF0Y2hlZCBlbGVtZW50IHNldCBPUgoJLy8gR2V0IHRoZSB3aG9sZSBtYXRjaGVkIGVsZW1lbnQgc2V0IGFzIGEgY2xlYW4gYXJyYXkKCWdldDogZnVuY3Rpb24oIG51bSApIHsKCQlyZXR1cm4gbnVtID09IG51bGwgPwoKCQkJLy8gUmV0dXJuIGEgJ2NsZWFuJyBhcnJheQoJCQl0aGlzLnRvQXJyYXkoKSA6CgoJCQkvLyBSZXR1cm4ganVzdCB0aGUgb2JqZWN0CgkJCSggbnVtIDwgMCA/IHRoaXNbIHRoaXMubGVuZ3RoICsgbnVtIF0gOiB0aGlzWyBudW0gXSApOwoJfSwKCgkvLyBUYWtlIGFuIGFycmF5IG9mIGVsZW1lbnRzIGFuZCBwdXNoIGl0IG9udG8gdGhlIHN0YWNrCgkvLyAocmV0dXJuaW5nIHRoZSBuZXcgbWF0Y2hlZCBlbGVtZW50IHNldCkKCXB1c2hTdGFjazogZnVuY3Rpb24oIGVsZW1zICkgewoKCQkvLyBCdWlsZCBhIG5ldyBqUXVlcnkgbWF0Y2hlZCBlbGVtZW50IHNldAoJCXZhciByZXQgPSBqUXVlcnkubWVyZ2UoIHRoaXMuY29uc3RydWN0b3IoKSwgZWxlbXMgKTsKCgkJLy8gQWRkIHRoZSBvbGQgb2JqZWN0IG9udG8gdGhlIHN0YWNrIChhcyBhIHJlZmVyZW5jZSkKCQlyZXQucHJldk9iamVjdCA9IHRoaXM7CgkJcmV0LmNvbnRleHQgPSB0aGlzLmNvbnRleHQ7CgoJCS8vIFJldHVybiB0aGUgbmV3bHktZm9ybWVkIGVsZW1lbnQgc2V0CgkJcmV0dXJuIHJldDsKCX0sCgoJLy8gRXhlY3V0ZSBhIGNhbGxiYWNrIGZvciBldmVyeSBlbGVtZW50IGluIHRoZSBtYXRjaGVkIHNldC4KCS8vIChZb3UgY2FuIHNlZWQgdGhlIGFyZ3VtZW50cyB3aXRoIGFuIGFycmF5IG9mIGFyZ3MsIGJ1dCB0aGlzIGlzCgkvLyBvbmx5IHVzZWQgaW50ZXJuYWxseS4pCgllYWNoOiBmdW5jdGlvbiggY2FsbGJhY2ssIGFyZ3MgKSB7CgkJcmV0dXJuIGpRdWVyeS5lYWNoKCB0aGlzLCBjYWxsYmFjaywgYXJncyApOwoJfSwKCglyZWFkeTogZnVuY3Rpb24oIGZuICkgewoJCS8vIEFkZCB0aGUgY2FsbGJhY2sKCQlqUXVlcnkucmVhZHkucHJvbWlzZSgpLmRvbmUoIGZuICk7CgoJCXJldHVybiB0aGlzOwoJfSwKCglzbGljZTogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMucHVzaFN0YWNrKCBjb3JlX3NsaWNlLmFwcGx5KCB0aGlzLCBhcmd1bWVudHMgKSApOwoJfSwKCglmaXJzdDogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMuZXEoIDAgKTsKCX0sCgoJbGFzdDogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMuZXEoIC0xICk7Cgl9LAoKCWVxOiBmdW5jdGlvbiggaSApIHsKCQl2YXIgbGVuID0gdGhpcy5sZW5ndGgsCgkJCWogPSAraSArICggaSA8IDAgPyBsZW4gOiAwICk7CgkJcmV0dXJuIHRoaXMucHVzaFN0YWNrKCBqID49IDAgJiYgaiA8IGxlbiA/IFsgdGhpc1tqXSBdIDogW10gKTsKCX0sCgoJbWFwOiBmdW5jdGlvbiggY2FsbGJhY2sgKSB7CgkJcmV0dXJuIHRoaXMucHVzaFN0YWNrKCBqUXVlcnkubWFwKHRoaXMsIGZ1bmN0aW9uKCBlbGVtLCBpICkgewoJCQlyZXR1cm4gY2FsbGJhY2suY2FsbCggZWxlbSwgaSwgZWxlbSApOwoJCX0pKTsKCX0sCgoJZW5kOiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5wcmV2T2JqZWN0IHx8IHRoaXMuY29uc3RydWN0b3IobnVsbCk7Cgl9LAoKCS8vIEZvciBpbnRlcm5hbCB1c2Ugb25seS4KCS8vIEJlaGF2ZXMgbGlrZSBhbiBBcnJheSdzIG1ldGhvZCwgbm90IGxpa2UgYSBqUXVlcnkgbWV0aG9kLgoJcHVzaDogY29yZV9wdXNoLAoJc29ydDogW10uc29ydCwKCXNwbGljZTogW10uc3BsaWNlCn07CgovLyBHaXZlIHRoZSBpbml0IGZ1bmN0aW9uIHRoZSBqUXVlcnkgcHJvdG90eXBlIGZvciBsYXRlciBpbnN0YW50aWF0aW9uCmpRdWVyeS5mbi5pbml0LnByb3RvdHlwZSA9IGpRdWVyeS5mbjsKCmpRdWVyeS5leHRlbmQgPSBqUXVlcnkuZm4uZXh0ZW5kID0gZnVuY3Rpb24oKSB7Cgl2YXIgc3JjLCBjb3B5SXNBcnJheSwgY29weSwgbmFtZSwgb3B0aW9ucywgY2xvbmUsCgkJdGFyZ2V0ID0gYXJndW1lbnRzWzBdIHx8IHt9LAoJCWkgPSAxLAoJCWxlbmd0aCA9IGFyZ3VtZW50cy5sZW5ndGgsCgkJZGVlcCA9IGZhbHNlOwoKCS8vIEhhbmRsZSBhIGRlZXAgY29weSBzaXR1YXRpb24KCWlmICggdHlwZW9mIHRhcmdldCA9PT0gImJvb2xlYW4iICkgewoJCWRlZXAgPSB0YXJnZXQ7CgkJdGFyZ2V0ID0gYXJndW1lbnRzWzFdIHx8IHt9OwoJCS8vIHNraXAgdGhlIGJvb2xlYW4gYW5kIHRoZSB0YXJnZXQKCQlpID0gMjsKCX0KCgkvLyBIYW5kbGUgY2FzZSB3aGVuIHRhcmdldCBpcyBhIHN0cmluZyBvciBzb21ldGhpbmcgKHBvc3NpYmxlIGluIGRlZXAgY29weSkKCWlmICggdHlwZW9mIHRhcmdldCAhPT0gIm9iamVjdCIgJiYgIWpRdWVyeS5pc0Z1bmN0aW9uKHRhcmdldCkgKSB7CgkJdGFyZ2V0ID0ge307Cgl9CgoJLy8gZXh0ZW5kIGpRdWVyeSBpdHNlbGYgaWYgb25seSBvbmUgYXJndW1lbnQgaXMgcGFzc2VkCglpZiAoIGxlbmd0aCA9PT0gaSApIHsKCQl0YXJnZXQgPSB0aGlzOwoJCS0taTsKCX0KCglmb3IgKCA7IGkgPCBsZW5ndGg7IGkrKyApIHsKCQkvLyBPbmx5IGRlYWwgd2l0aCBub24tbnVsbC91bmRlZmluZWQgdmFsdWVzCgkJaWYgKCAob3B0aW9ucyA9IGFyZ3VtZW50c1sgaSBdKSAhPSBudWxsICkgewoJCQkvLyBFeHRlbmQgdGhlIGJhc2Ugb2JqZWN0CgkJCWZvciAoIG5hbWUgaW4gb3B0aW9ucyApIHsKCQkJCXNyYyA9IHRhcmdldFsgbmFtZSBdOwoJCQkJY29weSA9IG9wdGlvbnNbIG5hbWUgXTsKCgkJCQkvLyBQcmV2ZW50IG5ldmVyLWVuZGluZyBsb29wCgkJCQlpZiAoIHRhcmdldCA9PT0gY29weSApIHsKCQkJCQljb250aW51ZTsKCQkJCX0KCgkJCQkvLyBSZWN1cnNlIGlmIHdlJ3JlIG1lcmdpbmcgcGxhaW4gb2JqZWN0cyBvciBhcnJheXMKCQkJCWlmICggZGVlcCAmJiBjb3B5ICYmICggalF1ZXJ5LmlzUGxhaW5PYmplY3QoY29weSkgfHwgKGNvcHlJc0FycmF5ID0galF1ZXJ5LmlzQXJyYXkoY29weSkpICkgKSB7CgkJCQkJaWYgKCBjb3B5SXNBcnJheSApIHsKCQkJCQkJY29weUlzQXJyYXkgPSBmYWxzZTsKCQkJCQkJY2xvbmUgPSBzcmMgJiYgalF1ZXJ5LmlzQXJyYXkoc3JjKSA/IHNyYyA6IFtdOwoKCQkJCQl9IGVsc2UgewoJCQkJCQljbG9uZSA9IHNyYyAmJiBqUXVlcnkuaXNQbGFpbk9iamVjdChzcmMpID8gc3JjIDoge307CgkJCQkJfQoKCQkJCQkvLyBOZXZlciBtb3ZlIG9yaWdpbmFsIG9iamVjdHMsIGNsb25lIHRoZW0KCQkJCQl0YXJnZXRbIG5hbWUgXSA9IGpRdWVyeS5leHRlbmQoIGRlZXAsIGNsb25lLCBjb3B5ICk7CgoJCQkJLy8gRG9uJ3QgYnJpbmcgaW4gdW5kZWZpbmVkIHZhbHVlcwoJCQkJfSBlbHNlIGlmICggY29weSAhPT0gdW5kZWZpbmVkICkgewoJCQkJCXRhcmdldFsgbmFtZSBdID0gY29weTsKCQkJCX0KCQkJfQoJCX0KCX0KCgkvLyBSZXR1cm4gdGhlIG1vZGlmaWVkIG9iamVjdAoJcmV0dXJuIHRhcmdldDsKfTsKCmpRdWVyeS5leHRlbmQoewoJbm9Db25mbGljdDogZnVuY3Rpb24oIGRlZXAgKSB7CgkJaWYgKCB3aW5kb3cuJCA9PT0galF1ZXJ5ICkgewoJCQl3aW5kb3cuJCA9IF8kOwoJCX0KCgkJaWYgKCBkZWVwICYmIHdpbmRvdy5qUXVlcnkgPT09IGpRdWVyeSApIHsKCQkJd2luZG93LmpRdWVyeSA9IF9qUXVlcnk7CgkJfQoKCQlyZXR1cm4galF1ZXJ5OwoJfSwKCgkvLyBJcyB0aGUgRE9NIHJlYWR5IHRvIGJlIHVzZWQ/IFNldCB0byB0cnVlIG9uY2UgaXQgb2NjdXJzLgoJaXNSZWFkeTogZmFsc2UsCgoJLy8gQSBjb3VudGVyIHRvIHRyYWNrIGhvdyBtYW55IGl0ZW1zIHRvIHdhaXQgZm9yIGJlZm9yZQoJLy8gdGhlIHJlYWR5IGV2ZW50IGZpcmVzLiBTZWUgIzY3ODEKCXJlYWR5V2FpdDogMSwKCgkvLyBIb2xkIChvciByZWxlYXNlKSB0aGUgcmVhZHkgZXZlbnQKCWhvbGRSZWFkeTogZnVuY3Rpb24oIGhvbGQgKSB7CgkJaWYgKCBob2xkICkgewoJCQlqUXVlcnkucmVhZHlXYWl0Kys7CgkJfSBlbHNlIHsKCQkJalF1ZXJ5LnJlYWR5KCB0cnVlICk7CgkJfQoJfSwKCgkvLyBIYW5kbGUgd2hlbiB0aGUgRE9NIGlzIHJlYWR5CglyZWFkeTogZnVuY3Rpb24oIHdhaXQgKSB7CgoJCS8vIEFib3J0IGlmIHRoZXJlIGFyZSBwZW5kaW5nIGhvbGRzIG9yIHdlJ3JlIGFscmVhZHkgcmVhZHkKCQlpZiAoIHdhaXQgPT09IHRydWUgPyAtLWpRdWVyeS5yZWFkeVdhaXQgOiBqUXVlcnkuaXNSZWFkeSApIHsKCQkJcmV0dXJuOwoJCX0KCgkJLy8gTWFrZSBzdXJlIGJvZHkgZXhpc3RzLCBhdCBsZWFzdCwgaW4gY2FzZSBJRSBnZXRzIGEgbGl0dGxlIG92ZXJ6ZWFsb3VzICh0aWNrZXQgIzU0NDMpLgoJCWlmICggIWRvY3VtZW50LmJvZHkgKSB7CgkJCXJldHVybiBzZXRUaW1lb3V0KCBqUXVlcnkucmVhZHkgKTsKCQl9CgoJCS8vIFJlbWVtYmVyIHRoYXQgdGhlIERPTSBpcyByZWFkeQoJCWpRdWVyeS5pc1JlYWR5ID0gdHJ1ZTsKCgkJLy8gSWYgYSBub3JtYWwgRE9NIFJlYWR5IGV2ZW50IGZpcmVkLCBkZWNyZW1lbnQsIGFuZCB3YWl0IGlmIG5lZWQgYmUKCQlpZiAoIHdhaXQgIT09IHRydWUgJiYgLS1qUXVlcnkucmVhZHlXYWl0ID4gMCApIHsKCQkJcmV0dXJuOwoJCX0KCgkJLy8gSWYgdGhlcmUgYXJlIGZ1bmN0aW9ucyBib3VuZCwgdG8gZXhlY3V0ZQoJCXJlYWR5TGlzdC5yZXNvbHZlV2l0aCggZG9jdW1lbnQsIFsgalF1ZXJ5IF0gKTsKCgkJLy8gVHJpZ2dlciBhbnkgYm91bmQgcmVhZHkgZXZlbnRzCgkJaWYgKCBqUXVlcnkuZm4udHJpZ2dlciApIHsKCQkJalF1ZXJ5KCBkb2N1bWVudCApLnRyaWdnZXIoInJlYWR5Iikub2ZmKCJyZWFkeSIpOwoJCX0KCX0sCgoJLy8gU2VlIHRlc3QvdW5pdC9jb3JlLmpzIGZvciBkZXRhaWxzIGNvbmNlcm5pbmcgaXNGdW5jdGlvbi4KCS8vIFNpbmNlIHZlcnNpb24gMS4zLCBET00gbWV0aG9kcyBhbmQgZnVuY3Rpb25zIGxpa2UgYWxlcnQKCS8vIGFyZW4ndCBzdXBwb3J0ZWQuIFRoZXkgcmV0dXJuIGZhbHNlIG9uIElFICgjMjk2OCkuCglpc0Z1bmN0aW9uOiBmdW5jdGlvbiggb2JqICkgewoJCXJldHVybiBqUXVlcnkudHlwZShvYmopID09PSAiZnVuY3Rpb24iOwoJfSwKCglpc0FycmF5OiBBcnJheS5pc0FycmF5IHx8IGZ1bmN0aW9uKCBvYmogKSB7CgkJcmV0dXJuIGpRdWVyeS50eXBlKG9iaikgPT09ICJhcnJheSI7Cgl9LAoKCWlzV2luZG93OiBmdW5jdGlvbiggb2JqICkgewoJCXJldHVybiBvYmogIT0gbnVsbCAmJiBvYmogPT0gb2JqLndpbmRvdzsKCX0sCgoJaXNOdW1lcmljOiBmdW5jdGlvbiggb2JqICkgewoJCXJldHVybiAhaXNOYU4oIHBhcnNlRmxvYXQob2JqKSApICYmIGlzRmluaXRlKCBvYmogKTsKCX0sCgoJdHlwZTogZnVuY3Rpb24oIG9iaiApIHsKCQlpZiAoIG9iaiA9PSBudWxsICkgewoJCQlyZXR1cm4gU3RyaW5nKCBvYmogKTsKCQl9CgkJcmV0dXJuIHR5cGVvZiBvYmogPT09ICJvYmplY3QiIHx8IHR5cGVvZiBvYmogPT09ICJmdW5jdGlvbiIgPwoJCQljbGFzczJ0eXBlWyBjb3JlX3RvU3RyaW5nLmNhbGwob2JqKSBdIHx8ICJvYmplY3QiIDoKCQkJdHlwZW9mIG9iajsKCX0sCgoJaXNQbGFpbk9iamVjdDogZnVuY3Rpb24oIG9iaiApIHsKCQkvLyBNdXN0IGJlIGFuIE9iamVjdC4KCQkvLyBCZWNhdXNlIG9mIElFLCB3ZSBhbHNvIGhhdmUgdG8gY2hlY2sgdGhlIHByZXNlbmNlIG9mIHRoZSBjb25zdHJ1Y3RvciBwcm9wZXJ0eS4KCQkvLyBNYWtlIHN1cmUgdGhhdCBET00gbm9kZXMgYW5kIHdpbmRvdyBvYmplY3RzIGRvbid0IHBhc3MgdGhyb3VnaCwgYXMgd2VsbAoJCWlmICggIW9iaiB8fCBqUXVlcnkudHlwZShvYmopICE9PSAib2JqZWN0IiB8fCBvYmoubm9kZVR5cGUgfHwgalF1ZXJ5LmlzV2luZG93KCBvYmogKSApIHsKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCgkJdHJ5IHsKCQkJLy8gTm90IG93biBjb25zdHJ1Y3RvciBwcm9wZXJ0eSBtdXN0IGJlIE9iamVjdAoJCQlpZiAoIG9iai5jb25zdHJ1Y3RvciAmJgoJCQkJIWNvcmVfaGFzT3duLmNhbGwob2JqLCAiY29uc3RydWN0b3IiKSAmJgoJCQkJIWNvcmVfaGFzT3duLmNhbGwob2JqLmNvbnN0cnVjdG9yLnByb3RvdHlwZSwgImlzUHJvdG90eXBlT2YiKSApIHsKCQkJCXJldHVybiBmYWxzZTsKCQkJfQoJCX0gY2F0Y2ggKCBlICkgewoJCQkvLyBJRTgsOSBXaWxsIHRocm93IGV4Y2VwdGlvbnMgb24gY2VydGFpbiBob3N0IG9iamVjdHMgIzk4OTcKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCgkJLy8gT3duIHByb3BlcnRpZXMgYXJlIGVudW1lcmF0ZWQgZmlyc3RseSwgc28gdG8gc3BlZWQgdXAsCgkJLy8gaWYgbGFzdCBvbmUgaXMgb3duLCB0aGVuIGFsbCBwcm9wZXJ0aWVzIGFyZSBvd24uCgoJCXZhciBrZXk7CgkJZm9yICgga2V5IGluIG9iaiApIHt9CgoJCXJldHVybiBrZXkgPT09IHVuZGVmaW5lZCB8fCBjb3JlX2hhc093bi5jYWxsKCBvYmosIGtleSApOwoJfSwKCglpc0VtcHR5T2JqZWN0OiBmdW5jdGlvbiggb2JqICkgewoJCXZhciBuYW1lOwoJCWZvciAoIG5hbWUgaW4gb2JqICkgewoJCQlyZXR1cm4gZmFsc2U7CgkJfQoJCXJldHVybiB0cnVlOwoJfSwKCgllcnJvcjogZnVuY3Rpb24oIG1zZyApIHsKCQl0aHJvdyBuZXcgRXJyb3IoIG1zZyApOwoJfSwKCgkvLyBkYXRhOiBzdHJpbmcgb2YgaHRtbAoJLy8gY29udGV4dCAob3B0aW9uYWwpOiBJZiBzcGVjaWZpZWQsIHRoZSBmcmFnbWVudCB3aWxsIGJlIGNyZWF0ZWQgaW4gdGhpcyBjb250ZXh0LCBkZWZhdWx0cyB0byBkb2N1bWVudAoJLy8ga2VlcFNjcmlwdHMgKG9wdGlvbmFsKTogSWYgdHJ1ZSwgd2lsbCBpbmNsdWRlIHNjcmlwdHMgcGFzc2VkIGluIHRoZSBodG1sIHN0cmluZwoJcGFyc2VIVE1MOiBmdW5jdGlvbiggZGF0YSwgY29udGV4dCwga2VlcFNjcmlwdHMgKSB7CgkJaWYgKCAhZGF0YSB8fCB0eXBlb2YgZGF0YSAhPT0gInN0cmluZyIgKSB7CgkJCXJldHVybiBudWxsOwoJCX0KCQlpZiAoIHR5cGVvZiBjb250ZXh0ID09PSAiYm9vbGVhbiIgKSB7CgkJCWtlZXBTY3JpcHRzID0gY29udGV4dDsKCQkJY29udGV4dCA9IGZhbHNlOwoJCX0KCQljb250ZXh0ID0gY29udGV4dCB8fCBkb2N1bWVudDsKCgkJdmFyIHBhcnNlZCA9IHJzaW5nbGVUYWcuZXhlYyggZGF0YSApLAoJCQlzY3JpcHRzID0gIWtlZXBTY3JpcHRzICYmIFtdOwoKCQkvLyBTaW5nbGUgdGFnCgkJaWYgKCBwYXJzZWQgKSB7CgkJCXJldHVybiBbIGNvbnRleHQuY3JlYXRlRWxlbWVudCggcGFyc2VkWzFdICkgXTsKCQl9CgoJCXBhcnNlZCA9IGpRdWVyeS5idWlsZEZyYWdtZW50KCBbIGRhdGEgXSwgY29udGV4dCwgc2NyaXB0cyApOwoJCWlmICggc2NyaXB0cyApIHsKCQkJalF1ZXJ5KCBzY3JpcHRzICkucmVtb3ZlKCk7CgkJfQoJCXJldHVybiBqUXVlcnkubWVyZ2UoIFtdLCBwYXJzZWQuY2hpbGROb2RlcyApOwoJfSwKCglwYXJzZUpTT046IGZ1bmN0aW9uKCBkYXRhICkgewoJCS8vIEF0dGVtcHQgdG8gcGFyc2UgdXNpbmcgdGhlIG5hdGl2ZSBKU09OIHBhcnNlciBmaXJzdAoJCWlmICggd2luZG93LkpTT04gJiYgd2luZG93LkpTT04ucGFyc2UgKSB7CgkJCXJldHVybiB3aW5kb3cuSlNPTi5wYXJzZSggZGF0YSApOwoJCX0KCgkJaWYgKCBkYXRhID09PSBudWxsICkgewoJCQlyZXR1cm4gZGF0YTsKCQl9CgoJCWlmICggdHlwZW9mIGRhdGEgPT09ICJzdHJpbmciICkgewoKCQkJLy8gTWFrZSBzdXJlIGxlYWRpbmcvdHJhaWxpbmcgd2hpdGVzcGFjZSBpcyByZW1vdmVkIChJRSBjYW4ndCBoYW5kbGUgaXQpCgkJCWRhdGEgPSBqUXVlcnkudHJpbSggZGF0YSApOwoKCQkJaWYgKCBkYXRhICkgewoJCQkJLy8gTWFrZSBzdXJlIHRoZSBpbmNvbWluZyBkYXRhIGlzIGFjdHVhbCBKU09OCgkJCQkvLyBMb2dpYyBib3Jyb3dlZCBmcm9tIGh0dHA6Ly9qc29uLm9yZy9qc29uMi5qcwoJCQkJaWYgKCBydmFsaWRjaGFycy50ZXN0KCBkYXRhLnJlcGxhY2UoIHJ2YWxpZGVzY2FwZSwgIkAiICkKCQkJCQkucmVwbGFjZSggcnZhbGlkdG9rZW5zLCAiXSIgKQoJCQkJCS5yZXBsYWNlKCBydmFsaWRicmFjZXMsICIiKSkgKSB7CgoJCQkJCXJldHVybiAoIG5ldyBGdW5jdGlvbiggInJldHVybiAiICsgZGF0YSApICkoKTsKCQkJCX0KCQkJfQoJCX0KCgkJalF1ZXJ5LmVycm9yKCAiSW52YWxpZCBKU09OOiAiICsgZGF0YSApOwoJfSwKCgkvLyBDcm9zcy1icm93c2VyIHhtbCBwYXJzaW5nCglwYXJzZVhNTDogZnVuY3Rpb24oIGRhdGEgKSB7CgkJdmFyIHhtbCwgdG1wOwoJCWlmICggIWRhdGEgfHwgdHlwZW9mIGRhdGEgIT09ICJzdHJpbmciICkgewoJCQlyZXR1cm4gbnVsbDsKCQl9CgkJdHJ5IHsKCQkJaWYgKCB3aW5kb3cuRE9NUGFyc2VyICkgeyAvLyBTdGFuZGFyZAoJCQkJdG1wID0gbmV3IERPTVBhcnNlcigpOwoJCQkJeG1sID0gdG1wLnBhcnNlRnJvbVN0cmluZyggZGF0YSAsICJ0ZXh0L3htbCIgKTsKCQkJfSBlbHNlIHsgLy8gSUUKCQkJCXhtbCA9IG5ldyBBY3RpdmVYT2JqZWN0KCAiTWljcm9zb2Z0LlhNTERPTSIgKTsKCQkJCXhtbC5hc3luYyA9ICJmYWxzZSI7CgkJCQl4bWwubG9hZFhNTCggZGF0YSApOwoJCQl9CgkJfSBjYXRjaCggZSApIHsKCQkJeG1sID0gdW5kZWZpbmVkOwoJCX0KCQlpZiAoICF4bWwgfHwgIXhtbC5kb2N1bWVudEVsZW1lbnQgfHwgeG1sLmdldEVsZW1lbnRzQnlUYWdOYW1lKCAicGFyc2VyZXJyb3IiICkubGVuZ3RoICkgewoJCQlqUXVlcnkuZXJyb3IoICJJbnZhbGlkIFhNTDogIiArIGRhdGEgKTsKCQl9CgkJcmV0dXJuIHhtbDsKCX0sCgoJbm9vcDogZnVuY3Rpb24oKSB7fSwKCgkvLyBFdmFsdWF0ZXMgYSBzY3JpcHQgaW4gYSBnbG9iYWwgY29udGV4dAoJLy8gV29ya2Fyb3VuZHMgYmFzZWQgb24gZmluZGluZ3MgYnkgSmltIERyaXNjb2xsCgkvLyBodHRwOi8vd2VibG9ncy5qYXZhLm5ldC9ibG9nL2RyaXNjb2xsL2FyY2hpdmUvMjAwOS8wOS8wOC9ldmFsLWphdmFzY3JpcHQtZ2xvYmFsLWNvbnRleHQKCWdsb2JhbEV2YWw6IGZ1bmN0aW9uKCBkYXRhICkgewoJCWlmICggZGF0YSAmJiBqUXVlcnkudHJpbSggZGF0YSApICkgewoJCQkvLyBXZSB1c2UgZXhlY1NjcmlwdCBvbiBJbnRlcm5ldCBFeHBsb3JlcgoJCQkvLyBXZSB1c2UgYW4gYW5vbnltb3VzIGZ1bmN0aW9uIHNvIHRoYXQgY29udGV4dCBpcyB3aW5kb3cKCQkJLy8gcmF0aGVyIHRoYW4galF1ZXJ5IGluIEZpcmVmb3gKCQkJKCB3aW5kb3cuZXhlY1NjcmlwdCB8fCBmdW5jdGlvbiggZGF0YSApIHsKCQkJCXdpbmRvd1sgImV2YWwiIF0uY2FsbCggd2luZG93LCBkYXRhICk7CgkJCX0gKSggZGF0YSApOwoJCX0KCX0sCgoJLy8gQ29udmVydCBkYXNoZWQgdG8gY2FtZWxDYXNlOyB1c2VkIGJ5IHRoZSBjc3MgYW5kIGRhdGEgbW9kdWxlcwoJLy8gTWljcm9zb2Z0IGZvcmdvdCB0byBodW1wIHRoZWlyIHZlbmRvciBwcmVmaXggKCM5NTcyKQoJY2FtZWxDYXNlOiBmdW5jdGlvbiggc3RyaW5nICkgewoJCXJldHVybiBzdHJpbmcucmVwbGFjZSggcm1zUHJlZml4LCAibXMtIiApLnJlcGxhY2UoIHJkYXNoQWxwaGEsIGZjYW1lbENhc2UgKTsKCX0sCgoJbm9kZU5hbWU6IGZ1bmN0aW9uKCBlbGVtLCBuYW1lICkgewoJCXJldHVybiBlbGVtLm5vZGVOYW1lICYmIGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gbmFtZS50b0xvd2VyQ2FzZSgpOwoJfSwKCgkvLyBhcmdzIGlzIGZvciBpbnRlcm5hbCB1c2FnZSBvbmx5CgllYWNoOiBmdW5jdGlvbiggb2JqLCBjYWxsYmFjaywgYXJncyApIHsKCQl2YXIgdmFsdWUsCgkJCWkgPSAwLAoJCQlsZW5ndGggPSBvYmoubGVuZ3RoLAoJCQlpc0FycmF5ID0gaXNBcnJheWxpa2UoIG9iaiApOwoKCQlpZiAoIGFyZ3MgKSB7CgkJCWlmICggaXNBcnJheSApIHsKCQkJCWZvciAoIDsgaSA8IGxlbmd0aDsgaSsrICkgewoJCQkJCXZhbHVlID0gY2FsbGJhY2suYXBwbHkoIG9ialsgaSBdLCBhcmdzICk7CgoJCQkJCWlmICggdmFsdWUgPT09IGZhbHNlICkgewoJCQkJCQlicmVhazsKCQkJCQl9CgkJCQl9CgkJCX0gZWxzZSB7CgkJCQlmb3IgKCBpIGluIG9iaiApIHsKCQkJCQl2YWx1ZSA9IGNhbGxiYWNrLmFwcGx5KCBvYmpbIGkgXSwgYXJncyApOwoKCQkJCQlpZiAoIHZhbHVlID09PSBmYWxzZSApIHsKCQkJCQkJYnJlYWs7CgkJCQkJfQoJCQkJfQoJCQl9CgoJCS8vIEEgc3BlY2lhbCwgZmFzdCwgY2FzZSBmb3IgdGhlIG1vc3QgY29tbW9uIHVzZSBvZiBlYWNoCgkJfSBlbHNlIHsKCQkJaWYgKCBpc0FycmF5ICkgewoJCQkJZm9yICggOyBpIDwgbGVuZ3RoOyBpKysgKSB7CgkJCQkJdmFsdWUgPSBjYWxsYmFjay5jYWxsKCBvYmpbIGkgXSwgaSwgb2JqWyBpIF0gKTsKCgkJCQkJaWYgKCB2YWx1ZSA9PT0gZmFsc2UgKSB7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCQkJCX0KCQkJfSBlbHNlIHsKCQkJCWZvciAoIGkgaW4gb2JqICkgewoJCQkJCXZhbHVlID0gY2FsbGJhY2suY2FsbCggb2JqWyBpIF0sIGksIG9ialsgaSBdICk7CgoJCQkJCWlmICggdmFsdWUgPT09IGZhbHNlICkgewoJCQkJCQlicmVhazsKCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgoJCXJldHVybiBvYmo7Cgl9LAoKCS8vIFVzZSBuYXRpdmUgU3RyaW5nLnRyaW0gZnVuY3Rpb24gd2hlcmV2ZXIgcG9zc2libGUKCXRyaW06IGNvcmVfdHJpbSAmJiAhY29yZV90cmltLmNhbGwoIlx1RkVGRlx4QTAiKSA/CgkJZnVuY3Rpb24oIHRleHQgKSB7CgkJCXJldHVybiB0ZXh0ID09IG51bGwgPwoJCQkJIiIgOgoJCQkJY29yZV90cmltLmNhbGwoIHRleHQgKTsKCQl9IDoKCgkJLy8gT3RoZXJ3aXNlIHVzZSBvdXIgb3duIHRyaW1taW5nIGZ1bmN0aW9uYWxpdHkKCQlmdW5jdGlvbiggdGV4dCApIHsKCQkJcmV0dXJuIHRleHQgPT0gbnVsbCA/CgkJCQkiIiA6CgkJCQkoIHRleHQgKyAiIiApLnJlcGxhY2UoIHJ0cmltLCAiIiApOwoJCX0sCgoJLy8gcmVzdWx0cyBpcyBmb3IgaW50ZXJuYWwgdXNhZ2Ugb25seQoJbWFrZUFycmF5OiBmdW5jdGlvbiggYXJyLCByZXN1bHRzICkgewoJCXZhciByZXQgPSByZXN1bHRzIHx8IFtdOwoKCQlpZiAoIGFyciAhPSBudWxsICkgewoJCQlpZiAoIGlzQXJyYXlsaWtlKCBPYmplY3QoYXJyKSApICkgewoJCQkJalF1ZXJ5Lm1lcmdlKCByZXQsCgkJCQkJdHlwZW9mIGFyciA9PT0gInN0cmluZyIgPwoJCQkJCVsgYXJyIF0gOiBhcnIKCQkJCSk7CgkJCX0gZWxzZSB7CgkJCQljb3JlX3B1c2guY2FsbCggcmV0LCBhcnIgKTsKCQkJfQoJCX0KCgkJcmV0dXJuIHJldDsKCX0sCgoJaW5BcnJheTogZnVuY3Rpb24oIGVsZW0sIGFyciwgaSApIHsKCQl2YXIgbGVuOwoKCQlpZiAoIGFyciApIHsKCQkJaWYgKCBjb3JlX2luZGV4T2YgKSB7CgkJCQlyZXR1cm4gY29yZV9pbmRleE9mLmNhbGwoIGFyciwgZWxlbSwgaSApOwoJCQl9CgoJCQlsZW4gPSBhcnIubGVuZ3RoOwoJCQlpID0gaSA/IGkgPCAwID8gTWF0aC5tYXgoIDAsIGxlbiArIGkgKSA6IGkgOiAwOwoKCQkJZm9yICggOyBpIDwgbGVuOyBpKysgKSB7CgkJCQkvLyBTa2lwIGFjY2Vzc2luZyBpbiBzcGFyc2UgYXJyYXlzCgkJCQlpZiAoIGkgaW4gYXJyICYmIGFyclsgaSBdID09PSBlbGVtICkgewoJCQkJCXJldHVybiBpOwoJCQkJfQoJCQl9CgkJfQoKCQlyZXR1cm4gLTE7Cgl9LAoKCW1lcmdlOiBmdW5jdGlvbiggZmlyc3QsIHNlY29uZCApIHsKCQl2YXIgbCA9IHNlY29uZC5sZW5ndGgsCgkJCWkgPSBmaXJzdC5sZW5ndGgsCgkJCWogPSAwOwoKCQlpZiAoIHR5cGVvZiBsID09PSAibnVtYmVyIiApIHsKCQkJZm9yICggOyBqIDwgbDsgaisrICkgewoJCQkJZmlyc3RbIGkrKyBdID0gc2Vjb25kWyBqIF07CgkJCX0KCQl9IGVsc2UgewoJCQl3aGlsZSAoIHNlY29uZFtqXSAhPT0gdW5kZWZpbmVkICkgewoJCQkJZmlyc3RbIGkrKyBdID0gc2Vjb25kWyBqKysgXTsKCQkJfQoJCX0KCgkJZmlyc3QubGVuZ3RoID0gaTsKCgkJcmV0dXJuIGZpcnN0OwoJfSwKCglncmVwOiBmdW5jdGlvbiggZWxlbXMsIGNhbGxiYWNrLCBpbnYgKSB7CgkJdmFyIHJldFZhbCwKCQkJcmV0ID0gW10sCgkJCWkgPSAwLAoJCQlsZW5ndGggPSBlbGVtcy5sZW5ndGg7CgkJaW52ID0gISFpbnY7CgoJCS8vIEdvIHRocm91Z2ggdGhlIGFycmF5LCBvbmx5IHNhdmluZyB0aGUgaXRlbXMKCQkvLyB0aGF0IHBhc3MgdGhlIHZhbGlkYXRvciBmdW5jdGlvbgoJCWZvciAoIDsgaSA8IGxlbmd0aDsgaSsrICkgewoJCQlyZXRWYWwgPSAhIWNhbGxiYWNrKCBlbGVtc1sgaSBdLCBpICk7CgkJCWlmICggaW52ICE9PSByZXRWYWwgKSB7CgkJCQlyZXQucHVzaCggZWxlbXNbIGkgXSApOwoJCQl9CgkJfQoKCQlyZXR1cm4gcmV0OwoJfSwKCgkvLyBhcmcgaXMgZm9yIGludGVybmFsIHVzYWdlIG9ubHkKCW1hcDogZnVuY3Rpb24oIGVsZW1zLCBjYWxsYmFjaywgYXJnICkgewoJCXZhciB2YWx1ZSwKCQkJaSA9IDAsCgkJCWxlbmd0aCA9IGVsZW1zLmxlbmd0aCwKCQkJaXNBcnJheSA9IGlzQXJyYXlsaWtlKCBlbGVtcyApLAoJCQlyZXQgPSBbXTsKCgkJLy8gR28gdGhyb3VnaCB0aGUgYXJyYXksIHRyYW5zbGF0aW5nIGVhY2ggb2YgdGhlIGl0ZW1zIHRvIHRoZWlyCgkJaWYgKCBpc0FycmF5ICkgewoJCQlmb3IgKCA7IGkgPCBsZW5ndGg7IGkrKyApIHsKCQkJCXZhbHVlID0gY2FsbGJhY2soIGVsZW1zWyBpIF0sIGksIGFyZyApOwoKCQkJCWlmICggdmFsdWUgIT0gbnVsbCApIHsKCQkJCQlyZXRbIHJldC5sZW5ndGggXSA9IHZhbHVlOwoJCQkJfQoJCQl9CgoJCS8vIEdvIHRocm91Z2ggZXZlcnkga2V5IG9uIHRoZSBvYmplY3QsCgkJfSBlbHNlIHsKCQkJZm9yICggaSBpbiBlbGVtcyApIHsKCQkJCXZhbHVlID0gY2FsbGJhY2soIGVsZW1zWyBpIF0sIGksIGFyZyApOwoKCQkJCWlmICggdmFsdWUgIT0gbnVsbCApIHsKCQkJCQlyZXRbIHJldC5sZW5ndGggXSA9IHZhbHVlOwoJCQkJfQoJCQl9CgkJfQoKCQkvLyBGbGF0dGVuIGFueSBuZXN0ZWQgYXJyYXlzCgkJcmV0dXJuIGNvcmVfY29uY2F0LmFwcGx5KCBbXSwgcmV0ICk7Cgl9LAoKCS8vIEEgZ2xvYmFsIEdVSUQgY291bnRlciBmb3Igb2JqZWN0cwoJZ3VpZDogMSwKCgkvLyBCaW5kIGEgZnVuY3Rpb24gdG8gYSBjb250ZXh0LCBvcHRpb25hbGx5IHBhcnRpYWxseSBhcHBseWluZyBhbnkKCS8vIGFyZ3VtZW50cy4KCXByb3h5OiBmdW5jdGlvbiggZm4sIGNvbnRleHQgKSB7CgkJdmFyIGFyZ3MsIHByb3h5LCB0bXA7CgoJCWlmICggdHlwZW9mIGNvbnRleHQgPT09ICJzdHJpbmciICkgewoJCQl0bXAgPSBmblsgY29udGV4dCBdOwoJCQljb250ZXh0ID0gZm47CgkJCWZuID0gdG1wOwoJCX0KCgkJLy8gUXVpY2sgY2hlY2sgdG8gZGV0ZXJtaW5lIGlmIHRhcmdldCBpcyBjYWxsYWJsZSwgaW4gdGhlIHNwZWMKCQkvLyB0aGlzIHRocm93cyBhIFR5cGVFcnJvciwgYnV0IHdlIHdpbGwganVzdCByZXR1cm4gdW5kZWZpbmVkLgoJCWlmICggIWpRdWVyeS5pc0Z1bmN0aW9uKCBmbiApICkgewoJCQlyZXR1cm4gdW5kZWZpbmVkOwoJCX0KCgkJLy8gU2ltdWxhdGVkIGJpbmQKCQlhcmdzID0gY29yZV9zbGljZS5jYWxsKCBhcmd1bWVudHMsIDIgKTsKCQlwcm94eSA9IGZ1bmN0aW9uKCkgewoJCQlyZXR1cm4gZm4uYXBwbHkoIGNvbnRleHQgfHwgdGhpcywgYXJncy5jb25jYXQoIGNvcmVfc2xpY2UuY2FsbCggYXJndW1lbnRzICkgKSApOwoJCX07CgoJCS8vIFNldCB0aGUgZ3VpZCBvZiB1bmlxdWUgaGFuZGxlciB0byB0aGUgc2FtZSBvZiBvcmlnaW5hbCBoYW5kbGVyLCBzbyBpdCBjYW4gYmUgcmVtb3ZlZAoJCXByb3h5Lmd1aWQgPSBmbi5ndWlkID0gZm4uZ3VpZCB8fCBqUXVlcnkuZ3VpZCsrOwoKCQlyZXR1cm4gcHJveHk7Cgl9LAoKCS8vIE11bHRpZnVuY3Rpb25hbCBtZXRob2QgdG8gZ2V0IGFuZCBzZXQgdmFsdWVzIG9mIGEgY29sbGVjdGlvbgoJLy8gVGhlIHZhbHVlL3MgY2FuIG9wdGlvbmFsbHkgYmUgZXhlY3V0ZWQgaWYgaXQncyBhIGZ1bmN0aW9uCglhY2Nlc3M6IGZ1bmN0aW9uKCBlbGVtcywgZm4sIGtleSwgdmFsdWUsIGNoYWluYWJsZSwgZW1wdHlHZXQsIHJhdyApIHsKCQl2YXIgaSA9IDAsCgkJCWxlbmd0aCA9IGVsZW1zLmxlbmd0aCwKCQkJYnVsayA9IGtleSA9PSBudWxsOwoKCQkvLyBTZXRzIG1hbnkgdmFsdWVzCgkJaWYgKCBqUXVlcnkudHlwZSgga2V5ICkgPT09ICJvYmplY3QiICkgewoJCQljaGFpbmFibGUgPSB0cnVlOwoJCQlmb3IgKCBpIGluIGtleSApIHsKCQkJCWpRdWVyeS5hY2Nlc3MoIGVsZW1zLCBmbiwgaSwga2V5W2ldLCB0cnVlLCBlbXB0eUdldCwgcmF3ICk7CgkJCX0KCgkJLy8gU2V0cyBvbmUgdmFsdWUKCQl9IGVsc2UgaWYgKCB2YWx1ZSAhPT0gdW5kZWZpbmVkICkgewoJCQljaGFpbmFibGUgPSB0cnVlOwoKCQkJaWYgKCAhalF1ZXJ5LmlzRnVuY3Rpb24oIHZhbHVlICkgKSB7CgkJCQlyYXcgPSB0cnVlOwoJCQl9CgoJCQlpZiAoIGJ1bGsgKSB7CgkJCQkvLyBCdWxrIG9wZXJhdGlvbnMgcnVuIGFnYWluc3QgdGhlIGVudGlyZSBzZXQKCQkJCWlmICggcmF3ICkgewoJCQkJCWZuLmNhbGwoIGVsZW1zLCB2YWx1ZSApOwoJCQkJCWZuID0gbnVsbDsKCgkJCQkvLyAuLi5leGNlcHQgd2hlbiBleGVjdXRpbmcgZnVuY3Rpb24gdmFsdWVzCgkJCQl9IGVsc2UgewoJCQkJCWJ1bGsgPSBmbjsKCQkJCQlmbiA9IGZ1bmN0aW9uKCBlbGVtLCBrZXksIHZhbHVlICkgewoJCQkJCQlyZXR1cm4gYnVsay5jYWxsKCBqUXVlcnkoIGVsZW0gKSwgdmFsdWUgKTsKCQkJCQl9OwoJCQkJfQoJCQl9CgoJCQlpZiAoIGZuICkgewoJCQkJZm9yICggOyBpIDwgbGVuZ3RoOyBpKysgKSB7CgkJCQkJZm4oIGVsZW1zW2ldLCBrZXksIHJhdyA/IHZhbHVlIDogdmFsdWUuY2FsbCggZWxlbXNbaV0sIGksIGZuKCBlbGVtc1tpXSwga2V5ICkgKSApOwoJCQkJfQoJCQl9CgkJfQoKCQlyZXR1cm4gY2hhaW5hYmxlID8KCQkJZWxlbXMgOgoKCQkJLy8gR2V0cwoJCQlidWxrID8KCQkJCWZuLmNhbGwoIGVsZW1zICkgOgoJCQkJbGVuZ3RoID8gZm4oIGVsZW1zWzBdLCBrZXkgKSA6IGVtcHR5R2V0OwoJfSwKCglub3c6IGZ1bmN0aW9uKCkgewoJCXJldHVybiAoIG5ldyBEYXRlKCkgKS5nZXRUaW1lKCk7Cgl9Cn0pOwoKalF1ZXJ5LnJlYWR5LnByb21pc2UgPSBmdW5jdGlvbiggb2JqICkgewoJaWYgKCAhcmVhZHlMaXN0ICkgewoKCQlyZWFkeUxpc3QgPSBqUXVlcnkuRGVmZXJyZWQoKTsKCgkJLy8gQ2F0Y2ggY2FzZXMgd2hlcmUgJChkb2N1bWVudCkucmVhZHkoKSBpcyBjYWxsZWQgYWZ0ZXIgdGhlIGJyb3dzZXIgZXZlbnQgaGFzIGFscmVhZHkgb2NjdXJyZWQuCgkJLy8gd2Ugb25jZSB0cmllZCB0byB1c2UgcmVhZHlTdGF0ZSAiaW50ZXJhY3RpdmUiIGhlcmUsIGJ1dCBpdCBjYXVzZWQgaXNzdWVzIGxpa2UgdGhlIG9uZQoJCS8vIGRpc2NvdmVyZWQgYnkgQ2hyaXNTIGhlcmU6IGh0dHA6Ly9idWdzLmpxdWVyeS5jb20vdGlja2V0LzEyMjgyI2NvbW1lbnQ6MTUKCQlpZiAoIGRvY3VtZW50LnJlYWR5U3RhdGUgPT09ICJjb21wbGV0ZSIgKSB7CgkJCS8vIEhhbmRsZSBpdCBhc3luY2hyb25vdXNseSB0byBhbGxvdyBzY3JpcHRzIHRoZSBvcHBvcnR1bml0eSB0byBkZWxheSByZWFkeQoJCQlzZXRUaW1lb3V0KCBqUXVlcnkucmVhZHkgKTsKCgkJLy8gU3RhbmRhcmRzLWJhc2VkIGJyb3dzZXJzIHN1cHBvcnQgRE9NQ29udGVudExvYWRlZAoJCX0gZWxzZSBpZiAoIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIgKSB7CgkJCS8vIFVzZSB0aGUgaGFuZHkgZXZlbnQgY2FsbGJhY2sKCQkJZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lciggIkRPTUNvbnRlbnRMb2FkZWQiLCBjb21wbGV0ZWQsIGZhbHNlICk7CgoJCQkvLyBBIGZhbGxiYWNrIHRvIHdpbmRvdy5vbmxvYWQsIHRoYXQgd2lsbCBhbHdheXMgd29yawoJCQl3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lciggImxvYWQiLCBjb21wbGV0ZWQsIGZhbHNlICk7CgoJCS8vIElmIElFIGV2ZW50IG1vZGVsIGlzIHVzZWQKCQl9IGVsc2UgewoJCQkvLyBFbnN1cmUgZmlyaW5nIGJlZm9yZSBvbmxvYWQsIG1heWJlIGxhdGUgYnV0IHNhZmUgYWxzbyBmb3IgaWZyYW1lcwoJCQlkb2N1bWVudC5hdHRhY2hFdmVudCggIm9ucmVhZHlzdGF0ZWNoYW5nZSIsIGNvbXBsZXRlZCApOwoKCQkJLy8gQSBmYWxsYmFjayB0byB3aW5kb3cub25sb2FkLCB0aGF0IHdpbGwgYWx3YXlzIHdvcmsKCQkJd2luZG93LmF0dGFjaEV2ZW50KCAib25sb2FkIiwgY29tcGxldGVkICk7CgoJCQkvLyBJZiBJRSBhbmQgbm90IGEgZnJhbWUKCQkJLy8gY29udGludWFsbHkgY2hlY2sgdG8gc2VlIGlmIHRoZSBkb2N1bWVudCBpcyByZWFkeQoJCQl2YXIgdG9wID0gZmFsc2U7CgoJCQl0cnkgewoJCQkJdG9wID0gd2luZG93LmZyYW1lRWxlbWVudCA9PSBudWxsICYmIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDsKCQkJfSBjYXRjaChlKSB7fQoKCQkJaWYgKCB0b3AgJiYgdG9wLmRvU2Nyb2xsICkgewoJCQkJKGZ1bmN0aW9uIGRvU2Nyb2xsQ2hlY2soKSB7CgkJCQkJaWYgKCAhalF1ZXJ5LmlzUmVhZHkgKSB7CgoJCQkJCQl0cnkgewoJCQkJCQkJLy8gVXNlIHRoZSB0cmljayBieSBEaWVnbyBQZXJpbmkKCQkJCQkJCS8vIGh0dHA6Ly9qYXZhc2NyaXB0Lm53Ym94LmNvbS9JRUNvbnRlbnRMb2FkZWQvCgkJCQkJCQl0b3AuZG9TY3JvbGwoImxlZnQiKTsKCQkJCQkJfSBjYXRjaChlKSB7CgkJCQkJCQlyZXR1cm4gc2V0VGltZW91dCggZG9TY3JvbGxDaGVjaywgNTAgKTsKCQkJCQkJfQoKCQkJCQkJLy8gZGV0YWNoIGFsbCBkb20gcmVhZHkgZXZlbnRzCgkJCQkJCWRldGFjaCgpOwoKCQkJCQkJLy8gYW5kIGV4ZWN1dGUgYW55IHdhaXRpbmcgZnVuY3Rpb25zCgkJCQkJCWpRdWVyeS5yZWFkeSgpOwoJCQkJCX0KCQkJCX0pKCk7CgkJCX0KCQl9Cgl9CglyZXR1cm4gcmVhZHlMaXN0LnByb21pc2UoIG9iaiApOwp9OwoKLy8gUG9wdWxhdGUgdGhlIGNsYXNzMnR5cGUgbWFwCmpRdWVyeS5lYWNoKCJCb29sZWFuIE51bWJlciBTdHJpbmcgRnVuY3Rpb24gQXJyYXkgRGF0ZSBSZWdFeHAgT2JqZWN0IEVycm9yIi5zcGxpdCgiICIpLCBmdW5jdGlvbihpLCBuYW1lKSB7CgljbGFzczJ0eXBlWyAiW29iamVjdCAiICsgbmFtZSArICJdIiBdID0gbmFtZS50b0xvd2VyQ2FzZSgpOwp9KTsKCmZ1bmN0aW9uIGlzQXJyYXlsaWtlKCBvYmogKSB7Cgl2YXIgbGVuZ3RoID0gb2JqLmxlbmd0aCwKCQl0eXBlID0galF1ZXJ5LnR5cGUoIG9iaiApOwoKCWlmICggalF1ZXJ5LmlzV2luZG93KCBvYmogKSApIHsKCQlyZXR1cm4gZmFsc2U7Cgl9CgoJaWYgKCBvYmoubm9kZVR5cGUgPT09IDEgJiYgbGVuZ3RoICkgewoJCXJldHVybiB0cnVlOwoJfQoKCXJldHVybiB0eXBlID09PSAiYXJyYXkiIHx8IHR5cGUgIT09ICJmdW5jdGlvbiIgJiYKCQkoIGxlbmd0aCA9PT0gMCB8fAoJCXR5cGVvZiBsZW5ndGggPT09ICJudW1iZXIiICYmIGxlbmd0aCA+IDAgJiYgKCBsZW5ndGggLSAxICkgaW4gb2JqICk7Cn0KCi8vIEFsbCBqUXVlcnkgb2JqZWN0cyBzaG91bGQgcG9pbnQgYmFjayB0byB0aGVzZQpyb290alF1ZXJ5ID0galF1ZXJ5KGRvY3VtZW50KTsKLy8gU3RyaW5nIHRvIE9iamVjdCBvcHRpb25zIGZvcm1hdCBjYWNoZQp2YXIgb3B0aW9uc0NhY2hlID0ge307CgovLyBDb252ZXJ0IFN0cmluZy1mb3JtYXR0ZWQgb3B0aW9ucyBpbnRvIE9iamVjdC1mb3JtYXR0ZWQgb25lcyBhbmQgc3RvcmUgaW4gY2FjaGUKZnVuY3Rpb24gY3JlYXRlT3B0aW9ucyggb3B0aW9ucyApIHsKCXZhciBvYmplY3QgPSBvcHRpb25zQ2FjaGVbIG9wdGlvbnMgXSA9IHt9OwoJalF1ZXJ5LmVhY2goIG9wdGlvbnMubWF0Y2goIGNvcmVfcm5vdHdoaXRlICkgfHwgW10sIGZ1bmN0aW9uKCBfLCBmbGFnICkgewoJCW9iamVjdFsgZmxhZyBdID0gdHJ1ZTsKCX0pOwoJcmV0dXJuIG9iamVjdDsKfQoKLyoKICogQ3JlYXRlIGEgY2FsbGJhY2sgbGlzdCB1c2luZyB0aGUgZm9sbG93aW5nIHBhcmFtZXRlcnM6CiAqCiAqCW9wdGlvbnM6IGFuIG9wdGlvbmFsIGxpc3Qgb2Ygc3BhY2Utc2VwYXJhdGVkIG9wdGlvbnMgdGhhdCB3aWxsIGNoYW5nZSBob3cKICoJCQl0aGUgY2FsbGJhY2sgbGlzdCBiZWhhdmVzIG9yIGEgbW9yZSB0cmFkaXRpb25hbCBvcHRpb24gb2JqZWN0CiAqCiAqIEJ5IGRlZmF1bHQgYSBjYWxsYmFjayBsaXN0IHdpbGwgYWN0IGxpa2UgYW4gZXZlbnQgY2FsbGJhY2sgbGlzdCBhbmQgY2FuIGJlCiAqICJmaXJlZCIgbXVsdGlwbGUgdGltZXMuCiAqCiAqIFBvc3NpYmxlIG9wdGlvbnM6CiAqCiAqCW9uY2U6CQkJd2lsbCBlbnN1cmUgdGhlIGNhbGxiYWNrIGxpc3QgY2FuIG9ubHkgYmUgZmlyZWQgb25jZSAobGlrZSBhIERlZmVycmVkKQogKgogKgltZW1vcnk6CQkJd2lsbCBrZWVwIHRyYWNrIG9mIHByZXZpb3VzIHZhbHVlcyBhbmQgd2lsbCBjYWxsIGFueSBjYWxsYmFjayBhZGRlZAogKgkJCQkJYWZ0ZXIgdGhlIGxpc3QgaGFzIGJlZW4gZmlyZWQgcmlnaHQgYXdheSB3aXRoIHRoZSBsYXRlc3QgIm1lbW9yaXplZCIKICoJCQkJCXZhbHVlcyAobGlrZSBhIERlZmVycmVkKQogKgogKgl1bmlxdWU6CQkJd2lsbCBlbnN1cmUgYSBjYWxsYmFjayBjYW4gb25seSBiZSBhZGRlZCBvbmNlIChubyBkdXBsaWNhdGUgaW4gdGhlIGxpc3QpCiAqCiAqCXN0b3BPbkZhbHNlOglpbnRlcnJ1cHQgY2FsbGluZ3Mgd2hlbiBhIGNhbGxiYWNrIHJldHVybnMgZmFsc2UKICoKICovCmpRdWVyeS5DYWxsYmFja3MgPSBmdW5jdGlvbiggb3B0aW9ucyApIHsKCgkvLyBDb252ZXJ0IG9wdGlvbnMgZnJvbSBTdHJpbmctZm9ybWF0dGVkIHRvIE9iamVjdC1mb3JtYXR0ZWQgaWYgbmVlZGVkCgkvLyAod2UgY2hlY2sgaW4gY2FjaGUgZmlyc3QpCglvcHRpb25zID0gdHlwZW9mIG9wdGlvbnMgPT09ICJzdHJpbmciID8KCQkoIG9wdGlvbnNDYWNoZVsgb3B0aW9ucyBdIHx8IGNyZWF0ZU9wdGlvbnMoIG9wdGlvbnMgKSApIDoKCQlqUXVlcnkuZXh0ZW5kKCB7fSwgb3B0aW9ucyApOwoKCXZhciAvLyBGbGFnIHRvIGtub3cgaWYgbGlzdCBpcyBjdXJyZW50bHkgZmlyaW5nCgkJZmlyaW5nLAoJCS8vIExhc3QgZmlyZSB2YWx1ZSAoZm9yIG5vbi1mb3JnZXR0YWJsZSBsaXN0cykKCQltZW1vcnksCgkJLy8gRmxhZyB0byBrbm93IGlmIGxpc3Qgd2FzIGFscmVhZHkgZmlyZWQKCQlmaXJlZCwKCQkvLyBFbmQgb2YgdGhlIGxvb3Agd2hlbiBmaXJpbmcKCQlmaXJpbmdMZW5ndGgsCgkJLy8gSW5kZXggb2YgY3VycmVudGx5IGZpcmluZyBjYWxsYmFjayAobW9kaWZpZWQgYnkgcmVtb3ZlIGlmIG5lZWRlZCkKCQlmaXJpbmdJbmRleCwKCQkvLyBGaXJzdCBjYWxsYmFjayB0byBmaXJlICh1c2VkIGludGVybmFsbHkgYnkgYWRkIGFuZCBmaXJlV2l0aCkKCQlmaXJpbmdTdGFydCwKCQkvLyBBY3R1YWwgY2FsbGJhY2sgbGlzdAoJCWxpc3QgPSBbXSwKCQkvLyBTdGFjayBvZiBmaXJlIGNhbGxzIGZvciByZXBlYXRhYmxlIGxpc3RzCgkJc3RhY2sgPSAhb3B0aW9ucy5vbmNlICYmIFtdLAoJCS8vIEZpcmUgY2FsbGJhY2tzCgkJZmlyZSA9IGZ1bmN0aW9uKCBkYXRhICkgewoJCQltZW1vcnkgPSBvcHRpb25zLm1lbW9yeSAmJiBkYXRhOwoJCQlmaXJlZCA9IHRydWU7CgkJCWZpcmluZ0luZGV4ID0gZmlyaW5nU3RhcnQgfHwgMDsKCQkJZmlyaW5nU3RhcnQgPSAwOwoJCQlmaXJpbmdMZW5ndGggPSBsaXN0Lmxlbmd0aDsKCQkJZmlyaW5nID0gdHJ1ZTsKCQkJZm9yICggOyBsaXN0ICYmIGZpcmluZ0luZGV4IDwgZmlyaW5nTGVuZ3RoOyBmaXJpbmdJbmRleCsrICkgewoJCQkJaWYgKCBsaXN0WyBmaXJpbmdJbmRleCBdLmFwcGx5KCBkYXRhWyAwIF0sIGRhdGFbIDEgXSApID09PSBmYWxzZSAmJiBvcHRpb25zLnN0b3BPbkZhbHNlICkgewoJCQkJCW1lbW9yeSA9IGZhbHNlOyAvLyBUbyBwcmV2ZW50IGZ1cnRoZXIgY2FsbHMgdXNpbmcgYWRkCgkJCQkJYnJlYWs7CgkJCQl9CgkJCX0KCQkJZmlyaW5nID0gZmFsc2U7CgkJCWlmICggbGlzdCApIHsKCQkJCWlmICggc3RhY2sgKSB7CgkJCQkJaWYgKCBzdGFjay5sZW5ndGggKSB7CgkJCQkJCWZpcmUoIHN0YWNrLnNoaWZ0KCkgKTsKCQkJCQl9CgkJCQl9IGVsc2UgaWYgKCBtZW1vcnkgKSB7CgkJCQkJbGlzdCA9IFtdOwoJCQkJfSBlbHNlIHsKCQkJCQlzZWxmLmRpc2FibGUoKTsKCQkJCX0KCQkJfQoJCX0sCgkJLy8gQWN0dWFsIENhbGxiYWNrcyBvYmplY3QKCQlzZWxmID0gewoJCQkvLyBBZGQgYSBjYWxsYmFjayBvciBhIGNvbGxlY3Rpb24gb2YgY2FsbGJhY2tzIHRvIHRoZSBsaXN0CgkJCWFkZDogZnVuY3Rpb24oKSB7CgkJCQlpZiAoIGxpc3QgKSB7CgkJCQkJLy8gRmlyc3QsIHdlIHNhdmUgdGhlIGN1cnJlbnQgbGVuZ3RoCgkJCQkJdmFyIHN0YXJ0ID0gbGlzdC5sZW5ndGg7CgkJCQkJKGZ1bmN0aW9uIGFkZCggYXJncyApIHsKCQkJCQkJalF1ZXJ5LmVhY2goIGFyZ3MsIGZ1bmN0aW9uKCBfLCBhcmcgKSB7CgkJCQkJCQl2YXIgdHlwZSA9IGpRdWVyeS50eXBlKCBhcmcgKTsKCQkJCQkJCWlmICggdHlwZSA9PT0gImZ1bmN0aW9uIiApIHsKCQkJCQkJCQlpZiAoICFvcHRpb25zLnVuaXF1ZSB8fCAhc2VsZi5oYXMoIGFyZyApICkgewoJCQkJCQkJCQlsaXN0LnB1c2goIGFyZyApOwoJCQkJCQkJCX0KCQkJCQkJCX0gZWxzZSBpZiAoIGFyZyAmJiBhcmcubGVuZ3RoICYmIHR5cGUgIT09ICJzdHJpbmciICkgewoJCQkJCQkJCS8vIEluc3BlY3QgcmVjdXJzaXZlbHkKCQkJCQkJCQlhZGQoIGFyZyApOwoJCQkJCQkJfQoJCQkJCQl9KTsKCQkJCQl9KSggYXJndW1lbnRzICk7CgkJCQkJLy8gRG8gd2UgbmVlZCB0byBhZGQgdGhlIGNhbGxiYWNrcyB0byB0aGUKCQkJCQkvLyBjdXJyZW50IGZpcmluZyBiYXRjaD8KCQkJCQlpZiAoIGZpcmluZyApIHsKCQkJCQkJZmlyaW5nTGVuZ3RoID0gbGlzdC5sZW5ndGg7CgkJCQkJLy8gV2l0aCBtZW1vcnksIGlmIHdlJ3JlIG5vdCBmaXJpbmcgdGhlbgoJCQkJCS8vIHdlIHNob3VsZCBjYWxsIHJpZ2h0IGF3YXkKCQkJCQl9IGVsc2UgaWYgKCBtZW1vcnkgKSB7CgkJCQkJCWZpcmluZ1N0YXJ0ID0gc3RhcnQ7CgkJCQkJCWZpcmUoIG1lbW9yeSApOwoJCQkJCX0KCQkJCX0KCQkJCXJldHVybiB0aGlzOwoJCQl9LAoJCQkvLyBSZW1vdmUgYSBjYWxsYmFjayBmcm9tIHRoZSBsaXN0CgkJCXJlbW92ZTogZnVuY3Rpb24oKSB7CgkJCQlpZiAoIGxpc3QgKSB7CgkJCQkJalF1ZXJ5LmVhY2goIGFyZ3VtZW50cywgZnVuY3Rpb24oIF8sIGFyZyApIHsKCQkJCQkJdmFyIGluZGV4OwoJCQkJCQl3aGlsZSggKCBpbmRleCA9IGpRdWVyeS5pbkFycmF5KCBhcmcsIGxpc3QsIGluZGV4ICkgKSA+IC0xICkgewoJCQkJCQkJbGlzdC5zcGxpY2UoIGluZGV4LCAxICk7CgkJCQkJCQkvLyBIYW5kbGUgZmlyaW5nIGluZGV4ZXMKCQkJCQkJCWlmICggZmlyaW5nICkgewoJCQkJCQkJCWlmICggaW5kZXggPD0gZmlyaW5nTGVuZ3RoICkgewoJCQkJCQkJCQlmaXJpbmdMZW5ndGgtLTsKCQkJCQkJCQl9CgkJCQkJCQkJaWYgKCBpbmRleCA8PSBmaXJpbmdJbmRleCApIHsKCQkJCQkJCQkJZmlyaW5nSW5kZXgtLTsKCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9KTsKCQkJCX0KCQkJCXJldHVybiB0aGlzOwoJCQl9LAoJCQkvLyBDaGVjayBpZiBhIGdpdmVuIGNhbGxiYWNrIGlzIGluIHRoZSBsaXN0LgoJCQkvLyBJZiBubyBhcmd1bWVudCBpcyBnaXZlbiwgcmV0dXJuIHdoZXRoZXIgb3Igbm90IGxpc3QgaGFzIGNhbGxiYWNrcyBhdHRhY2hlZC4KCQkJaGFzOiBmdW5jdGlvbiggZm4gKSB7CgkJCQlyZXR1cm4gZm4gPyBqUXVlcnkuaW5BcnJheSggZm4sIGxpc3QgKSA+IC0xIDogISEoIGxpc3QgJiYgbGlzdC5sZW5ndGggKTsKCQkJfSwKCQkJLy8gUmVtb3ZlIGFsbCBjYWxsYmFja3MgZnJvbSB0aGUgbGlzdAoJCQllbXB0eTogZnVuY3Rpb24oKSB7CgkJCQlsaXN0ID0gW107CgkJCQlyZXR1cm4gdGhpczsKCQkJfSwKCQkJLy8gSGF2ZSB0aGUgbGlzdCBkbyBub3RoaW5nIGFueW1vcmUKCQkJZGlzYWJsZTogZnVuY3Rpb24oKSB7CgkJCQlsaXN0ID0gc3RhY2sgPSBtZW1vcnkgPSB1bmRlZmluZWQ7CgkJCQlyZXR1cm4gdGhpczsKCQkJfSwKCQkJLy8gSXMgaXQgZGlzYWJsZWQ/CgkJCWRpc2FibGVkOiBmdW5jdGlvbigpIHsKCQkJCXJldHVybiAhbGlzdDsKCQkJfSwKCQkJLy8gTG9jayB0aGUgbGlzdCBpbiBpdHMgY3VycmVudCBzdGF0ZQoJCQlsb2NrOiBmdW5jdGlvbigpIHsKCQkJCXN0YWNrID0gdW5kZWZpbmVkOwoJCQkJaWYgKCAhbWVtb3J5ICkgewoJCQkJCXNlbGYuZGlzYWJsZSgpOwoJCQkJfQoJCQkJcmV0dXJuIHRoaXM7CgkJCX0sCgkJCS8vIElzIGl0IGxvY2tlZD8KCQkJbG9ja2VkOiBmdW5jdGlvbigpIHsKCQkJCXJldHVybiAhc3RhY2s7CgkJCX0sCgkJCS8vIENhbGwgYWxsIGNhbGxiYWNrcyB3aXRoIHRoZSBnaXZlbiBjb250ZXh0IGFuZCBhcmd1bWVudHMKCQkJZmlyZVdpdGg6IGZ1bmN0aW9uKCBjb250ZXh0LCBhcmdzICkgewoJCQkJYXJncyA9IGFyZ3MgfHwgW107CgkJCQlhcmdzID0gWyBjb250ZXh0LCBhcmdzLnNsaWNlID8gYXJncy5zbGljZSgpIDogYXJncyBdOwoJCQkJaWYgKCBsaXN0ICYmICggIWZpcmVkIHx8IHN0YWNrICkgKSB7CgkJCQkJaWYgKCBmaXJpbmcgKSB7CgkJCQkJCXN0YWNrLnB1c2goIGFyZ3MgKTsKCQkJCQl9IGVsc2UgewoJCQkJCQlmaXJlKCBhcmdzICk7CgkJCQkJfQoJCQkJfQoJCQkJcmV0dXJuIHRoaXM7CgkJCX0sCgkJCS8vIENhbGwgYWxsIHRoZSBjYWxsYmFja3Mgd2l0aCB0aGUgZ2l2ZW4gYXJndW1lbnRzCgkJCWZpcmU6IGZ1bmN0aW9uKCkgewoJCQkJc2VsZi5maXJlV2l0aCggdGhpcywgYXJndW1lbnRzICk7CgkJCQlyZXR1cm4gdGhpczsKCQkJfSwKCQkJLy8gVG8ga25vdyBpZiB0aGUgY2FsbGJhY2tzIGhhdmUgYWxyZWFkeSBiZWVuIGNhbGxlZCBhdCBsZWFzdCBvbmNlCgkJCWZpcmVkOiBmdW5jdGlvbigpIHsKCQkJCXJldHVybiAhIWZpcmVkOwoJCQl9CgkJfTsKCglyZXR1cm4gc2VsZjsKfTsKalF1ZXJ5LmV4dGVuZCh7CgoJRGVmZXJyZWQ6IGZ1bmN0aW9uKCBmdW5jICkgewoJCXZhciB0dXBsZXMgPSBbCgkJCQkvLyBhY3Rpb24sIGFkZCBsaXN0ZW5lciwgbGlzdGVuZXIgbGlzdCwgZmluYWwgc3RhdGUKCQkJCVsgInJlc29sdmUiLCAiZG9uZSIsIGpRdWVyeS5DYWxsYmFja3MoIm9uY2UgbWVtb3J5IiksICJyZXNvbHZlZCIgXSwKCQkJCVsgInJlamVjdCIsICJmYWlsIiwgalF1ZXJ5LkNhbGxiYWNrcygib25jZSBtZW1vcnkiKSwgInJlamVjdGVkIiBdLAoJCQkJWyAibm90aWZ5IiwgInByb2dyZXNzIiwgalF1ZXJ5LkNhbGxiYWNrcygibWVtb3J5IikgXQoJCQldLAoJCQlzdGF0ZSA9ICJwZW5kaW5nIiwKCQkJcHJvbWlzZSA9IHsKCQkJCXN0YXRlOiBmdW5jdGlvbigpIHsKCQkJCQlyZXR1cm4gc3RhdGU7CgkJCQl9LAoJCQkJYWx3YXlzOiBmdW5jdGlvbigpIHsKCQkJCQlkZWZlcnJlZC5kb25lKCBhcmd1bWVudHMgKS5mYWlsKCBhcmd1bWVudHMgKTsKCQkJCQlyZXR1cm4gdGhpczsKCQkJCX0sCgkJCQl0aGVuOiBmdW5jdGlvbiggLyogZm5Eb25lLCBmbkZhaWwsIGZuUHJvZ3Jlc3MgKi8gKSB7CgkJCQkJdmFyIGZucyA9IGFyZ3VtZW50czsKCQkJCQlyZXR1cm4galF1ZXJ5LkRlZmVycmVkKGZ1bmN0aW9uKCBuZXdEZWZlciApIHsKCQkJCQkJalF1ZXJ5LmVhY2goIHR1cGxlcywgZnVuY3Rpb24oIGksIHR1cGxlICkgewoJCQkJCQkJdmFyIGFjdGlvbiA9IHR1cGxlWyAwIF0sCgkJCQkJCQkJZm4gPSBqUXVlcnkuaXNGdW5jdGlvbiggZm5zWyBpIF0gKSAmJiBmbnNbIGkgXTsKCQkJCQkJCS8vIGRlZmVycmVkWyBkb25lIHwgZmFpbCB8IHByb2dyZXNzIF0gZm9yIGZvcndhcmRpbmcgYWN0aW9ucyB0byBuZXdEZWZlcgoJCQkJCQkJZGVmZXJyZWRbIHR1cGxlWzFdIF0oZnVuY3Rpb24oKSB7CgkJCQkJCQkJdmFyIHJldHVybmVkID0gZm4gJiYgZm4uYXBwbHkoIHRoaXMsIGFyZ3VtZW50cyApOwoJCQkJCQkJCWlmICggcmV0dXJuZWQgJiYgalF1ZXJ5LmlzRnVuY3Rpb24oIHJldHVybmVkLnByb21pc2UgKSApIHsKCQkJCQkJCQkJcmV0dXJuZWQucHJvbWlzZSgpCgkJCQkJCQkJCQkuZG9uZSggbmV3RGVmZXIucmVzb2x2ZSApCgkJCQkJCQkJCQkuZmFpbCggbmV3RGVmZXIucmVqZWN0ICkKCQkJCQkJCQkJCS5wcm9ncmVzcyggbmV3RGVmZXIubm90aWZ5ICk7CgkJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkJbmV3RGVmZXJbIGFjdGlvbiArICJXaXRoIiBdKCB0aGlzID09PSBwcm9taXNlID8gbmV3RGVmZXIucHJvbWlzZSgpIDogdGhpcywgZm4gPyBbIHJldHVybmVkIF0gOiBhcmd1bWVudHMgKTsKCQkJCQkJCQl9CgkJCQkJCQl9KTsKCQkJCQkJfSk7CgkJCQkJCWZucyA9IG51bGw7CgkJCQkJfSkucHJvbWlzZSgpOwoJCQkJfSwKCQkJCS8vIEdldCBhIHByb21pc2UgZm9yIHRoaXMgZGVmZXJyZWQKCQkJCS8vIElmIG9iaiBpcyBwcm92aWRlZCwgdGhlIHByb21pc2UgYXNwZWN0IGlzIGFkZGVkIHRvIHRoZSBvYmplY3QKCQkJCXByb21pc2U6IGZ1bmN0aW9uKCBvYmogKSB7CgkJCQkJcmV0dXJuIG9iaiAhPSBudWxsID8galF1ZXJ5LmV4dGVuZCggb2JqLCBwcm9taXNlICkgOiBwcm9taXNlOwoJCQkJfQoJCQl9LAoJCQlkZWZlcnJlZCA9IHt9OwoKCQkvLyBLZWVwIHBpcGUgZm9yIGJhY2stY29tcGF0CgkJcHJvbWlzZS5waXBlID0gcHJvbWlzZS50aGVuOwoKCQkvLyBBZGQgbGlzdC1zcGVjaWZpYyBtZXRob2RzCgkJalF1ZXJ5LmVhY2goIHR1cGxlcywgZnVuY3Rpb24oIGksIHR1cGxlICkgewoJCQl2YXIgbGlzdCA9IHR1cGxlWyAyIF0sCgkJCQlzdGF0ZVN0cmluZyA9IHR1cGxlWyAzIF07CgoJCQkvLyBwcm9taXNlWyBkb25lIHwgZmFpbCB8IHByb2dyZXNzIF0gPSBsaXN0LmFkZAoJCQlwcm9taXNlWyB0dXBsZVsxXSBdID0gbGlzdC5hZGQ7CgoJCQkvLyBIYW5kbGUgc3RhdGUKCQkJaWYgKCBzdGF0ZVN0cmluZyApIHsKCQkJCWxpc3QuYWRkKGZ1bmN0aW9uKCkgewoJCQkJCS8vIHN0YXRlID0gWyByZXNvbHZlZCB8IHJlamVjdGVkIF0KCQkJCQlzdGF0ZSA9IHN0YXRlU3RyaW5nOwoKCQkJCS8vIFsgcmVqZWN0X2xpc3QgfCByZXNvbHZlX2xpc3QgXS5kaXNhYmxlOyBwcm9ncmVzc19saXN0LmxvY2sKCQkJCX0sIHR1cGxlc1sgaSBeIDEgXVsgMiBdLmRpc2FibGUsIHR1cGxlc1sgMiBdWyAyIF0ubG9jayApOwoJCQl9CgoJCQkvLyBkZWZlcnJlZFsgcmVzb2x2ZSB8IHJlamVjdCB8IG5vdGlmeSBdCgkJCWRlZmVycmVkWyB0dXBsZVswXSBdID0gZnVuY3Rpb24oKSB7CgkJCQlkZWZlcnJlZFsgdHVwbGVbMF0gKyAiV2l0aCIgXSggdGhpcyA9PT0gZGVmZXJyZWQgPyBwcm9taXNlIDogdGhpcywgYXJndW1lbnRzICk7CgkJCQlyZXR1cm4gdGhpczsKCQkJfTsKCQkJZGVmZXJyZWRbIHR1cGxlWzBdICsgIldpdGgiIF0gPSBsaXN0LmZpcmVXaXRoOwoJCX0pOwoKCQkvLyBNYWtlIHRoZSBkZWZlcnJlZCBhIHByb21pc2UKCQlwcm9taXNlLnByb21pc2UoIGRlZmVycmVkICk7CgoJCS8vIENhbGwgZ2l2ZW4gZnVuYyBpZiBhbnkKCQlpZiAoIGZ1bmMgKSB7CgkJCWZ1bmMuY2FsbCggZGVmZXJyZWQsIGRlZmVycmVkICk7CgkJfQoKCQkvLyBBbGwgZG9uZSEKCQlyZXR1cm4gZGVmZXJyZWQ7Cgl9LAoKCS8vIERlZmVycmVkIGhlbHBlcgoJd2hlbjogZnVuY3Rpb24oIHN1Ym9yZGluYXRlIC8qICwgLi4uLCBzdWJvcmRpbmF0ZU4gKi8gKSB7CgkJdmFyIGkgPSAwLAoJCQlyZXNvbHZlVmFsdWVzID0gY29yZV9zbGljZS5jYWxsKCBhcmd1bWVudHMgKSwKCQkJbGVuZ3RoID0gcmVzb2x2ZVZhbHVlcy5sZW5ndGgsCgoJCQkvLyB0aGUgY291bnQgb2YgdW5jb21wbGV0ZWQgc3Vib3JkaW5hdGVzCgkJCXJlbWFpbmluZyA9IGxlbmd0aCAhPT0gMSB8fCAoIHN1Ym9yZGluYXRlICYmIGpRdWVyeS5pc0Z1bmN0aW9uKCBzdWJvcmRpbmF0ZS5wcm9taXNlICkgKSA/IGxlbmd0aCA6IDAsCgoJCQkvLyB0aGUgbWFzdGVyIERlZmVycmVkLiBJZiByZXNvbHZlVmFsdWVzIGNvbnNpc3Qgb2Ygb25seSBhIHNpbmdsZSBEZWZlcnJlZCwganVzdCB1c2UgdGhhdC4KCQkJZGVmZXJyZWQgPSByZW1haW5pbmcgPT09IDEgPyBzdWJvcmRpbmF0ZSA6IGpRdWVyeS5EZWZlcnJlZCgpLAoKCQkJLy8gVXBkYXRlIGZ1bmN0aW9uIGZvciBib3RoIHJlc29sdmUgYW5kIHByb2dyZXNzIHZhbHVlcwoJCQl1cGRhdGVGdW5jID0gZnVuY3Rpb24oIGksIGNvbnRleHRzLCB2YWx1ZXMgKSB7CgkJCQlyZXR1cm4gZnVuY3Rpb24oIHZhbHVlICkgewoJCQkJCWNvbnRleHRzWyBpIF0gPSB0aGlzOwoJCQkJCXZhbHVlc1sgaSBdID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBjb3JlX3NsaWNlLmNhbGwoIGFyZ3VtZW50cyApIDogdmFsdWU7CgkJCQkJaWYoIHZhbHVlcyA9PT0gcHJvZ3Jlc3NWYWx1ZXMgKSB7CgkJCQkJCWRlZmVycmVkLm5vdGlmeVdpdGgoIGNvbnRleHRzLCB2YWx1ZXMgKTsKCQkJCQl9IGVsc2UgaWYgKCAhKCAtLXJlbWFpbmluZyApICkgewoJCQkJCQlkZWZlcnJlZC5yZXNvbHZlV2l0aCggY29udGV4dHMsIHZhbHVlcyApOwoJCQkJCX0KCQkJCX07CgkJCX0sCgoJCQlwcm9ncmVzc1ZhbHVlcywgcHJvZ3Jlc3NDb250ZXh0cywgcmVzb2x2ZUNvbnRleHRzOwoKCQkvLyBhZGQgbGlzdGVuZXJzIHRvIERlZmVycmVkIHN1Ym9yZGluYXRlczsgdHJlYXQgb3RoZXJzIGFzIHJlc29sdmVkCgkJaWYgKCBsZW5ndGggPiAxICkgewoJCQlwcm9ncmVzc1ZhbHVlcyA9IG5ldyBBcnJheSggbGVuZ3RoICk7CgkJCXByb2dyZXNzQ29udGV4dHMgPSBuZXcgQXJyYXkoIGxlbmd0aCApOwoJCQlyZXNvbHZlQ29udGV4dHMgPSBuZXcgQXJyYXkoIGxlbmd0aCApOwoJCQlmb3IgKCA7IGkgPCBsZW5ndGg7IGkrKyApIHsKCQkJCWlmICggcmVzb2x2ZVZhbHVlc1sgaSBdICYmIGpRdWVyeS5pc0Z1bmN0aW9uKCByZXNvbHZlVmFsdWVzWyBpIF0ucHJvbWlzZSApICkgewoJCQkJCXJlc29sdmVWYWx1ZXNbIGkgXS5wcm9taXNlKCkKCQkJCQkJLmRvbmUoIHVwZGF0ZUZ1bmMoIGksIHJlc29sdmVDb250ZXh0cywgcmVzb2x2ZVZhbHVlcyApICkKCQkJCQkJLmZhaWwoIGRlZmVycmVkLnJlamVjdCApCgkJCQkJCS5wcm9ncmVzcyggdXBkYXRlRnVuYyggaSwgcHJvZ3Jlc3NDb250ZXh0cywgcHJvZ3Jlc3NWYWx1ZXMgKSApOwoJCQkJfSBlbHNlIHsKCQkJCQktLXJlbWFpbmluZzsKCQkJCX0KCQkJfQoJCX0KCgkJLy8gaWYgd2UncmUgbm90IHdhaXRpbmcgb24gYW55dGhpbmcsIHJlc29sdmUgdGhlIG1hc3RlcgoJCWlmICggIXJlbWFpbmluZyApIHsKCQkJZGVmZXJyZWQucmVzb2x2ZVdpdGgoIHJlc29sdmVDb250ZXh0cywgcmVzb2x2ZVZhbHVlcyApOwoJCX0KCgkJcmV0dXJuIGRlZmVycmVkLnByb21pc2UoKTsKCX0KfSk7CmpRdWVyeS5zdXBwb3J0ID0gKGZ1bmN0aW9uKCkgewoKCXZhciBzdXBwb3J0LCBhbGwsIGEsCgkJaW5wdXQsIHNlbGVjdCwgZnJhZ21lbnQsCgkJb3B0LCBldmVudE5hbWUsIGlzU3VwcG9ydGVkLCBpLAoJCWRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwoKCS8vIFNldHVwCglkaXYuc2V0QXR0cmlidXRlKCAiY2xhc3NOYW1lIiwgInQiICk7CglkaXYuaW5uZXJIVE1MID0gIiAgPGxpbmsvPjx0YWJsZT48L3RhYmxlPjxhIGhyZWY9Jy9hJz5hPC9hPjxpbnB1dCB0eXBlPSdjaGVja2JveCcvPiI7CgoJLy8gU3VwcG9ydCB0ZXN0cyB3b24ndCBydW4gaW4gc29tZSBsaW1pdGVkIG9yIG5vbi1icm93c2VyIGVudmlyb25tZW50cwoJYWxsID0gZGl2LmdldEVsZW1lbnRzQnlUYWdOYW1lKCIqIik7CglhID0gZGl2LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJhIilbIDAgXTsKCWlmICggIWFsbCB8fCAhYSB8fCAhYWxsLmxlbmd0aCApIHsKCQlyZXR1cm4ge307Cgl9CgoJLy8gRmlyc3QgYmF0Y2ggb2YgdGVzdHMKCXNlbGVjdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNlbGVjdCIpOwoJb3B0ID0gc2VsZWN0LmFwcGVuZENoaWxkKCBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJvcHRpb24iKSApOwoJaW5wdXQgPSBkaXYuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImlucHV0IilbIDAgXTsKCglhLnN0eWxlLmNzc1RleHQgPSAidG9wOjFweDtmbG9hdDpsZWZ0O29wYWNpdHk6LjUiOwoJc3VwcG9ydCA9IHsKCQkvLyBUZXN0IHNldEF0dHJpYnV0ZSBvbiBjYW1lbENhc2UgY2xhc3MuIElmIGl0IHdvcmtzLCB3ZSBuZWVkIGF0dHJGaXhlcyB3aGVuIGRvaW5nIGdldC9zZXRBdHRyaWJ1dGUgKGllNi83KQoJCWdldFNldEF0dHJpYnV0ZTogZGl2LmNsYXNzTmFtZSAhPT0gInQiLAoKCQkvLyBJRSBzdHJpcHMgbGVhZGluZyB3aGl0ZXNwYWNlIHdoZW4gLmlubmVySFRNTCBpcyB1c2VkCgkJbGVhZGluZ1doaXRlc3BhY2U6IGRpdi5maXJzdENoaWxkLm5vZGVUeXBlID09PSAzLAoKCQkvLyBNYWtlIHN1cmUgdGhhdCB0Ym9keSBlbGVtZW50cyBhcmVuJ3QgYXV0b21hdGljYWxseSBpbnNlcnRlZAoJCS8vIElFIHdpbGwgaW5zZXJ0IHRoZW0gaW50byBlbXB0eSB0YWJsZXMKCQl0Ym9keTogIWRpdi5nZXRFbGVtZW50c0J5VGFnTmFtZSgidGJvZHkiKS5sZW5ndGgsCgoJCS8vIE1ha2Ugc3VyZSB0aGF0IGxpbmsgZWxlbWVudHMgZ2V0IHNlcmlhbGl6ZWQgY29ycmVjdGx5IGJ5IGlubmVySFRNTAoJCS8vIFRoaXMgcmVxdWlyZXMgYSB3cmFwcGVyIGVsZW1lbnQgaW4gSUUKCQlodG1sU2VyaWFsaXplOiAhIWRpdi5nZXRFbGVtZW50c0J5VGFnTmFtZSgibGluayIpLmxlbmd0aCwKCgkJLy8gR2V0IHRoZSBzdHlsZSBpbmZvcm1hdGlvbiBmcm9tIGdldEF0dHJpYnV0ZQoJCS8vIChJRSB1c2VzIC5jc3NUZXh0IGluc3RlYWQpCgkJc3R5bGU6IC90b3AvLnRlc3QoIGEuZ2V0QXR0cmlidXRlKCJzdHlsZSIpICksCgoJCS8vIE1ha2Ugc3VyZSB0aGF0IFVSTHMgYXJlbid0IG1hbmlwdWxhdGVkCgkJLy8gKElFIG5vcm1hbGl6ZXMgaXQgYnkgZGVmYXVsdCkKCQlocmVmTm9ybWFsaXplZDogYS5nZXRBdHRyaWJ1dGUoImhyZWYiKSA9PT0gIi9hIiwKCgkJLy8gTWFrZSBzdXJlIHRoYXQgZWxlbWVudCBvcGFjaXR5IGV4aXN0cwoJCS8vIChJRSB1c2VzIGZpbHRlciBpbnN0ZWFkKQoJCS8vIFVzZSBhIHJlZ2V4IHRvIHdvcmsgYXJvdW5kIGEgV2ViS2l0IGlzc3VlLiBTZWUgIzUxNDUKCQlvcGFjaXR5OiAvXjAuNS8udGVzdCggYS5zdHlsZS5vcGFjaXR5ICksCgoJCS8vIFZlcmlmeSBzdHlsZSBmbG9hdCBleGlzdGVuY2UKCQkvLyAoSUUgdXNlcyBzdHlsZUZsb2F0IGluc3RlYWQgb2YgY3NzRmxvYXQpCgkJY3NzRmxvYXQ6ICEhYS5zdHlsZS5jc3NGbG9hdCwKCgkJLy8gQ2hlY2sgdGhlIGRlZmF1bHQgY2hlY2tib3gvcmFkaW8gdmFsdWUgKCIiIG9uIFdlYktpdDsgIm9uIiBlbHNld2hlcmUpCgkJY2hlY2tPbjogISFpbnB1dC52YWx1ZSwKCgkJLy8gTWFrZSBzdXJlIHRoYXQgYSBzZWxlY3RlZC1ieS1kZWZhdWx0IG9wdGlvbiBoYXMgYSB3b3JraW5nIHNlbGVjdGVkIHByb3BlcnR5LgoJCS8vIChXZWJLaXQgZGVmYXVsdHMgdG8gZmFsc2UgaW5zdGVhZCBvZiB0cnVlLCBJRSB0b28sIGlmIGl0J3MgaW4gYW4gb3B0Z3JvdXApCgkJb3B0U2VsZWN0ZWQ6IG9wdC5zZWxlY3RlZCwKCgkJLy8gVGVzdHMgZm9yIGVuY3R5cGUgc3VwcG9ydCBvbiBhIGZvcm0gKCM2NzQzKQoJCWVuY3R5cGU6ICEhZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZm9ybSIpLmVuY3R5cGUsCgoJCS8vIE1ha2VzIHN1cmUgY2xvbmluZyBhbiBodG1sNSBlbGVtZW50IGRvZXMgbm90IGNhdXNlIHByb2JsZW1zCgkJLy8gV2hlcmUgb3V0ZXJIVE1MIGlzIHVuZGVmaW5lZCwgdGhpcyBzdGlsbCB3b3JrcwoJCWh0bWw1Q2xvbmU6IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIm5hdiIpLmNsb25lTm9kZSggdHJ1ZSApLm91dGVySFRNTCAhPT0gIjw6bmF2PjwvOm5hdj4iLAoKCQkvLyBqUXVlcnkuc3VwcG9ydC5ib3hNb2RlbCBERVBSRUNBVEVEIGluIDEuOCBzaW5jZSB3ZSBkb24ndCBzdXBwb3J0IFF1aXJrcyBNb2RlCgkJYm94TW9kZWw6IGRvY3VtZW50LmNvbXBhdE1vZGUgPT09ICJDU1MxQ29tcGF0IiwKCgkJLy8gV2lsbCBiZSBkZWZpbmVkIGxhdGVyCgkJZGVsZXRlRXhwYW5kbzogdHJ1ZSwKCQlub0Nsb25lRXZlbnQ6IHRydWUsCgkJaW5saW5lQmxvY2tOZWVkc0xheW91dDogZmFsc2UsCgkJc2hyaW5rV3JhcEJsb2NrczogZmFsc2UsCgkJcmVsaWFibGVNYXJnaW5SaWdodDogdHJ1ZSwKCQlib3hTaXppbmdSZWxpYWJsZTogdHJ1ZSwKCQlwaXhlbFBvc2l0aW9uOiBmYWxzZQoJfTsKCgkvLyBNYWtlIHN1cmUgY2hlY2tlZCBzdGF0dXMgaXMgcHJvcGVybHkgY2xvbmVkCglpbnB1dC5jaGVja2VkID0gdHJ1ZTsKCXN1cHBvcnQubm9DbG9uZUNoZWNrZWQgPSBpbnB1dC5jbG9uZU5vZGUoIHRydWUgKS5jaGVja2VkOwoKCS8vIE1ha2Ugc3VyZSB0aGF0IHRoZSBvcHRpb25zIGluc2lkZSBkaXNhYmxlZCBzZWxlY3RzIGFyZW4ndCBtYXJrZWQgYXMgZGlzYWJsZWQKCS8vIChXZWJLaXQgbWFya3MgdGhlbSBhcyBkaXNhYmxlZCkKCXNlbGVjdC5kaXNhYmxlZCA9IHRydWU7CglzdXBwb3J0Lm9wdERpc2FibGVkID0gIW9wdC5kaXNhYmxlZDsKCgkvLyBTdXBwb3J0OiBJRTw5Cgl0cnkgewoJCWRlbGV0ZSBkaXYudGVzdDsKCX0gY2F0Y2goIGUgKSB7CgkJc3VwcG9ydC5kZWxldGVFeHBhbmRvID0gZmFsc2U7Cgl9CgoJLy8gQ2hlY2sgaWYgd2UgY2FuIHRydXN0IGdldEF0dHJpYnV0ZSgidmFsdWUiKQoJaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbnB1dCIpOwoJaW5wdXQuc2V0QXR0cmlidXRlKCAidmFsdWUiLCAiIiApOwoJc3VwcG9ydC5pbnB1dCA9IGlucHV0LmdldEF0dHJpYnV0ZSggInZhbHVlIiApID09PSAiIjsKCgkvLyBDaGVjayBpZiBhbiBpbnB1dCBtYWludGFpbnMgaXRzIHZhbHVlIGFmdGVyIGJlY29taW5nIGEgcmFkaW8KCWlucHV0LnZhbHVlID0gInQiOwoJaW5wdXQuc2V0QXR0cmlidXRlKCAidHlwZSIsICJyYWRpbyIgKTsKCXN1cHBvcnQucmFkaW9WYWx1ZSA9IGlucHV0LnZhbHVlID09PSAidCI7CgoJLy8gIzExMjE3IC0gV2ViS2l0IGxvc2VzIGNoZWNrIHdoZW4gdGhlIG5hbWUgaXMgYWZ0ZXIgdGhlIGNoZWNrZWQgYXR0cmlidXRlCglpbnB1dC5zZXRBdHRyaWJ1dGUoICJjaGVja2VkIiwgInQiICk7CglpbnB1dC5zZXRBdHRyaWJ1dGUoICJuYW1lIiwgInQiICk7CgoJZnJhZ21lbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7CglmcmFnbWVudC5hcHBlbmRDaGlsZCggaW5wdXQgKTsKCgkvLyBDaGVjayBpZiBhIGRpc2Nvbm5lY3RlZCBjaGVja2JveCB3aWxsIHJldGFpbiBpdHMgY2hlY2tlZAoJLy8gdmFsdWUgb2YgdHJ1ZSBhZnRlciBhcHBlbmRlZCB0byB0aGUgRE9NIChJRTYvNykKCXN1cHBvcnQuYXBwZW5kQ2hlY2tlZCA9IGlucHV0LmNoZWNrZWQ7CgoJLy8gV2ViS2l0IGRvZXNuJ3QgY2xvbmUgY2hlY2tlZCBzdGF0ZSBjb3JyZWN0bHkgaW4gZnJhZ21lbnRzCglzdXBwb3J0LmNoZWNrQ2xvbmUgPSBmcmFnbWVudC5jbG9uZU5vZGUoIHRydWUgKS5jbG9uZU5vZGUoIHRydWUgKS5sYXN0Q2hpbGQuY2hlY2tlZDsKCgkvLyBTdXBwb3J0OiBJRTw5CgkvLyBPcGVyYSBkb2VzIG5vdCBjbG9uZSBldmVudHMgKGFuZCB0eXBlb2YgZGl2LmF0dGFjaEV2ZW50ID09PSB1bmRlZmluZWQpLgoJLy8gSUU5LTEwIGNsb25lcyBldmVudHMgYm91bmQgdmlhIGF0dGFjaEV2ZW50LCBidXQgdGhleSBkb24ndCB0cmlnZ2VyIHdpdGggLmNsaWNrKCkKCWlmICggZGl2LmF0dGFjaEV2ZW50ICkgewoJCWRpdi5hdHRhY2hFdmVudCggIm9uY2xpY2siLCBmdW5jdGlvbigpIHsKCQkJc3VwcG9ydC5ub0Nsb25lRXZlbnQgPSBmYWxzZTsKCQl9KTsKCgkJZGl2LmNsb25lTm9kZSggdHJ1ZSApLmNsaWNrKCk7Cgl9CgoJLy8gU3VwcG9ydDogSUU8OSAobGFjayBzdWJtaXQvY2hhbmdlIGJ1YmJsZSksIEZpcmVmb3ggMTcrIChsYWNrIGZvY3VzaW4gZXZlbnQpCgkvLyBCZXdhcmUgb2YgQ1NQIHJlc3RyaWN0aW9ucyAoaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4vU2VjdXJpdHkvQ1NQKSwgdGVzdC9jc3AucGhwCglmb3IgKCBpIGluIHsgc3VibWl0OiB0cnVlLCBjaGFuZ2U6IHRydWUsIGZvY3VzaW46IHRydWUgfSkgewoJCWRpdi5zZXRBdHRyaWJ1dGUoIGV2ZW50TmFtZSA9ICJvbiIgKyBpLCAidCIgKTsKCgkJc3VwcG9ydFsgaSArICJCdWJibGVzIiBdID0gZXZlbnROYW1lIGluIHdpbmRvdyB8fCBkaXYuYXR0cmlidXRlc1sgZXZlbnROYW1lIF0uZXhwYW5kbyA9PT0gZmFsc2U7Cgl9CgoJZGl2LnN0eWxlLmJhY2tncm91bmRDbGlwID0gImNvbnRlbnQtYm94IjsKCWRpdi5jbG9uZU5vZGUoIHRydWUgKS5zdHlsZS5iYWNrZ3JvdW5kQ2xpcCA9ICIiOwoJc3VwcG9ydC5jbGVhckNsb25lU3R5bGUgPSBkaXYuc3R5bGUuYmFja2dyb3VuZENsaXAgPT09ICJjb250ZW50LWJveCI7CgoJLy8gUnVuIHRlc3RzIHRoYXQgbmVlZCBhIGJvZHkgYXQgZG9jIHJlYWR5CglqUXVlcnkoZnVuY3Rpb24oKSB7CgkJdmFyIGNvbnRhaW5lciwgbWFyZ2luRGl2LCB0ZHMsCgkJCWRpdlJlc2V0ID0gInBhZGRpbmc6MDttYXJnaW46MDtib3JkZXI6MDtkaXNwbGF5OmJsb2NrO2JveC1zaXppbmc6Y29udGVudC1ib3g7LW1vei1ib3gtc2l6aW5nOmNvbnRlbnQtYm94Oy13ZWJraXQtYm94LXNpemluZzpjb250ZW50LWJveDsiLAoJCQlib2R5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImJvZHkiKVswXTsKCgkJaWYgKCAhYm9keSApIHsKCQkJLy8gUmV0dXJuIGZvciBmcmFtZXNldCBkb2NzIHRoYXQgZG9uJ3QgaGF2ZSBhIGJvZHkKCQkJcmV0dXJuOwoJCX0KCgkJY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CgkJY29udGFpbmVyLnN0eWxlLmNzc1RleHQgPSAiYm9yZGVyOjA7d2lkdGg6MDtoZWlnaHQ6MDtwb3NpdGlvbjphYnNvbHV0ZTt0b3A6MDtsZWZ0Oi05OTk5cHg7bWFyZ2luLXRvcDoxcHgiOwoKCQlib2R5LmFwcGVuZENoaWxkKCBjb250YWluZXIgKS5hcHBlbmRDaGlsZCggZGl2ICk7CgoJCS8vIFN1cHBvcnQ6IElFOAoJCS8vIENoZWNrIGlmIHRhYmxlIGNlbGxzIHN0aWxsIGhhdmUgb2Zmc2V0V2lkdGgvSGVpZ2h0IHdoZW4gdGhleSBhcmUgc2V0CgkJLy8gdG8gZGlzcGxheTpub25lIGFuZCB0aGVyZSBhcmUgc3RpbGwgb3RoZXIgdmlzaWJsZSB0YWJsZSBjZWxscyBpbiBhCgkJLy8gdGFibGUgcm93OyBpZiBzbywgb2Zmc2V0V2lkdGgvSGVpZ2h0IGFyZSBub3QgcmVsaWFibGUgZm9yIHVzZSB3aGVuCgkJLy8gZGV0ZXJtaW5pbmcgaWYgYW4gZWxlbWVudCBoYXMgYmVlbiBoaWRkZW4gZGlyZWN0bHkgdXNpbmcKCQkvLyBkaXNwbGF5Om5vbmUgKGl0IGlzIHN0aWxsIHNhZmUgdG8gdXNlIG9mZnNldHMgaWYgYSBwYXJlbnQgZWxlbWVudCBpcwoJCS8vIGhpZGRlbjsgZG9uIHNhZmV0eSBnb2dnbGVzIGFuZCBzZWUgYnVnICM0NTEyIGZvciBtb3JlIGluZm9ybWF0aW9uKS4KCQlkaXYuaW5uZXJIVE1MID0gIjx0YWJsZT48dHI+PHRkPjwvdGQ+PHRkPnQ8L3RkPjwvdHI+PC90YWJsZT4iOwoJCXRkcyA9IGRpdi5nZXRFbGVtZW50c0J5VGFnTmFtZSgidGQiKTsKCQl0ZHNbIDAgXS5zdHlsZS5jc3NUZXh0ID0gInBhZGRpbmc6MDttYXJnaW46MDtib3JkZXI6MDtkaXNwbGF5Om5vbmUiOwoJCWlzU3VwcG9ydGVkID0gKCB0ZHNbIDAgXS5vZmZzZXRIZWlnaHQgPT09IDAgKTsKCgkJdGRzWyAwIF0uc3R5bGUuZGlzcGxheSA9ICIiOwoJCXRkc1sgMSBdLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CgoJCS8vIFN1cHBvcnQ6IElFOAoJCS8vIENoZWNrIGlmIGVtcHR5IHRhYmxlIGNlbGxzIHN0aWxsIGhhdmUgb2Zmc2V0V2lkdGgvSGVpZ2h0CgkJc3VwcG9ydC5yZWxpYWJsZUhpZGRlbk9mZnNldHMgPSBpc1N1cHBvcnRlZCAmJiAoIHRkc1sgMCBdLm9mZnNldEhlaWdodCA9PT0gMCApOwoKCQkvLyBDaGVjayBib3gtc2l6aW5nIGFuZCBtYXJnaW4gYmVoYXZpb3IKCQlkaXYuaW5uZXJIVE1MID0gIiI7CgkJZGl2LnN0eWxlLmNzc1RleHQgPSAiYm94LXNpemluZzpib3JkZXItYm94Oy1tb3otYm94LXNpemluZzpib3JkZXItYm94Oy13ZWJraXQtYm94LXNpemluZzpib3JkZXItYm94O3BhZGRpbmc6MXB4O2JvcmRlcjoxcHg7ZGlzcGxheTpibG9jazt3aWR0aDo0cHg7bWFyZ2luLXRvcDoxJTtwb3NpdGlvbjphYnNvbHV0ZTt0b3A6MSU7IjsKCQlzdXBwb3J0LmJveFNpemluZyA9ICggZGl2Lm9mZnNldFdpZHRoID09PSA0ICk7CgkJc3VwcG9ydC5kb2VzTm90SW5jbHVkZU1hcmdpbkluQm9keU9mZnNldCA9ICggYm9keS5vZmZzZXRUb3AgIT09IDEgKTsKCgkJLy8gVXNlIHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlIGJlY2F1c2UganNkb20gb24gbm9kZS5qcyB3aWxsIGJyZWFrIHdpdGhvdXQgaXQuCgkJaWYgKCB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSApIHsKCQkJc3VwcG9ydC5waXhlbFBvc2l0aW9uID0gKCB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSggZGl2LCBudWxsICkgfHwge30gKS50b3AgIT09ICIxJSI7CgkJCXN1cHBvcnQuYm94U2l6aW5nUmVsaWFibGUgPSAoIHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKCBkaXYsIG51bGwgKSB8fCB7IHdpZHRoOiAiNHB4IiB9ICkud2lkdGggPT09ICI0cHgiOwoKCQkJLy8gQ2hlY2sgaWYgZGl2IHdpdGggZXhwbGljaXQgd2lkdGggYW5kIG5vIG1hcmdpbi1yaWdodCBpbmNvcnJlY3RseQoJCQkvLyBnZXRzIGNvbXB1dGVkIG1hcmdpbi1yaWdodCBiYXNlZCBvbiB3aWR0aCBvZiBjb250YWluZXIuICgjMzMzMykKCQkJLy8gRmFpbHMgaW4gV2ViS2l0IGJlZm9yZSBGZWIgMjAxMSBuaWdodGxpZXMKCQkJLy8gV2ViS2l0IEJ1ZyAxMzM0MyAtIGdldENvbXB1dGVkU3R5bGUgcmV0dXJucyB3cm9uZyB2YWx1ZSBmb3IgbWFyZ2luLXJpZ2h0CgkJCW1hcmdpbkRpdiA9IGRpdi5hcHBlbmRDaGlsZCggZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikgKTsKCQkJbWFyZ2luRGl2LnN0eWxlLmNzc1RleHQgPSBkaXYuc3R5bGUuY3NzVGV4dCA9IGRpdlJlc2V0OwoJCQltYXJnaW5EaXYuc3R5bGUubWFyZ2luUmlnaHQgPSBtYXJnaW5EaXYuc3R5bGUud2lkdGggPSAiMCI7CgkJCWRpdi5zdHlsZS53aWR0aCA9ICIxcHgiOwoKCQkJc3VwcG9ydC5yZWxpYWJsZU1hcmdpblJpZ2h0ID0KCQkJCSFwYXJzZUZsb2F0KCAoIHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKCBtYXJnaW5EaXYsIG51bGwgKSB8fCB7fSApLm1hcmdpblJpZ2h0ICk7CgkJfQoKCQlpZiAoIHR5cGVvZiBkaXYuc3R5bGUuem9vbSAhPT0gY29yZV9zdHJ1bmRlZmluZWQgKSB7CgkJCS8vIFN1cHBvcnQ6IElFPDgKCQkJLy8gQ2hlY2sgaWYgbmF0aXZlbHkgYmxvY2stbGV2ZWwgZWxlbWVudHMgYWN0IGxpa2UgaW5saW5lLWJsb2NrCgkJCS8vIGVsZW1lbnRzIHdoZW4gc2V0dGluZyB0aGVpciBkaXNwbGF5IHRvICdpbmxpbmUnIGFuZCBnaXZpbmcKCQkJLy8gdGhlbSBsYXlvdXQKCQkJZGl2LmlubmVySFRNTCA9ICIiOwoJCQlkaXYuc3R5bGUuY3NzVGV4dCA9IGRpdlJlc2V0ICsgIndpZHRoOjFweDtwYWRkaW5nOjFweDtkaXNwbGF5OmlubGluZTt6b29tOjEiOwoJCQlzdXBwb3J0LmlubGluZUJsb2NrTmVlZHNMYXlvdXQgPSAoIGRpdi5vZmZzZXRXaWR0aCA9PT0gMyApOwoKCQkJLy8gU3VwcG9ydDogSUU2CgkJCS8vIENoZWNrIGlmIGVsZW1lbnRzIHdpdGggbGF5b3V0IHNocmluay13cmFwIHRoZWlyIGNoaWxkcmVuCgkJCWRpdi5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKCQkJZGl2LmlubmVySFRNTCA9ICI8ZGl2PjwvZGl2PiI7CgkJCWRpdi5maXJzdENoaWxkLnN0eWxlLndpZHRoID0gIjVweCI7CgkJCXN1cHBvcnQuc2hyaW5rV3JhcEJsb2NrcyA9ICggZGl2Lm9mZnNldFdpZHRoICE9PSAzICk7CgoJCQlpZiAoIHN1cHBvcnQuaW5saW5lQmxvY2tOZWVkc0xheW91dCApIHsKCQkJCS8vIFByZXZlbnQgSUUgNiBmcm9tIGFmZmVjdGluZyBsYXlvdXQgZm9yIHBvc2l0aW9uZWQgZWxlbWVudHMgIzExMDQ4CgkJCQkvLyBQcmV2ZW50IElFIGZyb20gc2hyaW5raW5nIHRoZSBib2R5IGluIElFIDcgbW9kZSAjMTI4NjkKCQkJCS8vIFN1cHBvcnQ6IElFPDgKCQkJCWJvZHkuc3R5bGUuem9vbSA9IDE7CgkJCX0KCQl9CgoJCWJvZHkucmVtb3ZlQ2hpbGQoIGNvbnRhaW5lciApOwoKCQkvLyBOdWxsIGVsZW1lbnRzIHRvIGF2b2lkIGxlYWtzIGluIElFCgkJY29udGFpbmVyID0gZGl2ID0gdGRzID0gbWFyZ2luRGl2ID0gbnVsbDsKCX0pOwoKCS8vIE51bGwgZWxlbWVudHMgdG8gYXZvaWQgbGVha3MgaW4gSUUKCWFsbCA9IHNlbGVjdCA9IGZyYWdtZW50ID0gb3B0ID0gYSA9IGlucHV0ID0gbnVsbDsKCglyZXR1cm4gc3VwcG9ydDsKfSkoKTsKCnZhciByYnJhY2UgPSAvKD86XHtbXHNcU10qXH18XFtbXHNcU10qXF0pJC8sCglybXVsdGlEYXNoID0gLyhbQS1aXSkvZzsKCmZ1bmN0aW9uIGludGVybmFsRGF0YSggZWxlbSwgbmFtZSwgZGF0YSwgcHZ0IC8qIEludGVybmFsIFVzZSBPbmx5ICovICl7CglpZiAoICFqUXVlcnkuYWNjZXB0RGF0YSggZWxlbSApICkgewoJCXJldHVybjsKCX0KCgl2YXIgdGhpc0NhY2hlLCByZXQsCgkJaW50ZXJuYWxLZXkgPSBqUXVlcnkuZXhwYW5kbywKCQlnZXRCeU5hbWUgPSB0eXBlb2YgbmFtZSA9PT0gInN0cmluZyIsCgoJCS8vIFdlIGhhdmUgdG8gaGFuZGxlIERPTSBub2RlcyBhbmQgSlMgb2JqZWN0cyBkaWZmZXJlbnRseSBiZWNhdXNlIElFNi03CgkJLy8gY2FuJ3QgR0Mgb2JqZWN0IHJlZmVyZW5jZXMgcHJvcGVybHkgYWNyb3NzIHRoZSBET00tSlMgYm91bmRhcnkKCQlpc05vZGUgPSBlbGVtLm5vZGVUeXBlLAoKCQkvLyBPbmx5IERPTSBub2RlcyBuZWVkIHRoZSBnbG9iYWwgalF1ZXJ5IGNhY2hlOyBKUyBvYmplY3QgZGF0YSBpcwoJCS8vIGF0dGFjaGVkIGRpcmVjdGx5IHRvIHRoZSBvYmplY3Qgc28gR0MgY2FuIG9jY3VyIGF1dG9tYXRpY2FsbHkKCQljYWNoZSA9IGlzTm9kZSA/IGpRdWVyeS5jYWNoZSA6IGVsZW0sCgoJCS8vIE9ubHkgZGVmaW5pbmcgYW4gSUQgZm9yIEpTIG9iamVjdHMgaWYgaXRzIGNhY2hlIGFscmVhZHkgZXhpc3RzIGFsbG93cwoJCS8vIHRoZSBjb2RlIHRvIHNob3J0Y3V0IG9uIHRoZSBzYW1lIHBhdGggYXMgYSBET00gbm9kZSB3aXRoIG5vIGNhY2hlCgkJaWQgPSBpc05vZGUgPyBlbGVtWyBpbnRlcm5hbEtleSBdIDogZWxlbVsgaW50ZXJuYWxLZXkgXSAmJiBpbnRlcm5hbEtleTsKCgkvLyBBdm9pZCBkb2luZyBhbnkgbW9yZSB3b3JrIHRoYW4gd2UgbmVlZCB0byB3aGVuIHRyeWluZyB0byBnZXQgZGF0YSBvbiBhbgoJLy8gb2JqZWN0IHRoYXQgaGFzIG5vIGRhdGEgYXQgYWxsCglpZiAoICghaWQgfHwgIWNhY2hlW2lkXSB8fCAoIXB2dCAmJiAhY2FjaGVbaWRdLmRhdGEpKSAmJiBnZXRCeU5hbWUgJiYgZGF0YSA9PT0gdW5kZWZpbmVkICkgewoJCXJldHVybjsKCX0KCglpZiAoICFpZCApIHsKCQkvLyBPbmx5IERPTSBub2RlcyBuZWVkIGEgbmV3IHVuaXF1ZSBJRCBmb3IgZWFjaCBlbGVtZW50IHNpbmNlIHRoZWlyIGRhdGEKCQkvLyBlbmRzIHVwIGluIHRoZSBnbG9iYWwgY2FjaGUKCQlpZiAoIGlzTm9kZSApIHsKCQkJZWxlbVsgaW50ZXJuYWxLZXkgXSA9IGlkID0gY29yZV9kZWxldGVkSWRzLnBvcCgpIHx8IGpRdWVyeS5ndWlkKys7CgkJfSBlbHNlIHsKCQkJaWQgPSBpbnRlcm5hbEtleTsKCQl9Cgl9CgoJaWYgKCAhY2FjaGVbIGlkIF0gKSB7CgkJY2FjaGVbIGlkIF0gPSB7fTsKCgkJLy8gQXZvaWRzIGV4cG9zaW5nIGpRdWVyeSBtZXRhZGF0YSBvbiBwbGFpbiBKUyBvYmplY3RzIHdoZW4gdGhlIG9iamVjdAoJCS8vIGlzIHNlcmlhbGl6ZWQgdXNpbmcgSlNPTi5zdHJpbmdpZnkKCQlpZiAoICFpc05vZGUgKSB7CgkJCWNhY2hlWyBpZCBdLnRvSlNPTiA9IGpRdWVyeS5ub29wOwoJCX0KCX0KCgkvLyBBbiBvYmplY3QgY2FuIGJlIHBhc3NlZCB0byBqUXVlcnkuZGF0YSBpbnN0ZWFkIG9mIGEga2V5L3ZhbHVlIHBhaXI7IHRoaXMgZ2V0cwoJLy8gc2hhbGxvdyBjb3BpZWQgb3ZlciBvbnRvIHRoZSBleGlzdGluZyBjYWNoZQoJaWYgKCB0eXBlb2YgbmFtZSA9PT0gIm9iamVjdCIgfHwgdHlwZW9mIG5hbWUgPT09ICJmdW5jdGlvbiIgKSB7CgkJaWYgKCBwdnQgKSB7CgkJCWNhY2hlWyBpZCBdID0galF1ZXJ5LmV4dGVuZCggY2FjaGVbIGlkIF0sIG5hbWUgKTsKCQl9IGVsc2UgewoJCQljYWNoZVsgaWQgXS5kYXRhID0galF1ZXJ5LmV4dGVuZCggY2FjaGVbIGlkIF0uZGF0YSwgbmFtZSApOwoJCX0KCX0KCgl0aGlzQ2FjaGUgPSBjYWNoZVsgaWQgXTsKCgkvLyBqUXVlcnkgZGF0YSgpIGlzIHN0b3JlZCBpbiBhIHNlcGFyYXRlIG9iamVjdCBpbnNpZGUgdGhlIG9iamVjdCdzIGludGVybmFsIGRhdGEKCS8vIGNhY2hlIGluIG9yZGVyIHRvIGF2b2lkIGtleSBjb2xsaXNpb25zIGJldHdlZW4gaW50ZXJuYWwgZGF0YSBhbmQgdXNlci1kZWZpbmVkCgkvLyBkYXRhLgoJaWYgKCAhcHZ0ICkgewoJCWlmICggIXRoaXNDYWNoZS5kYXRhICkgewoJCQl0aGlzQ2FjaGUuZGF0YSA9IHt9OwoJCX0KCgkJdGhpc0NhY2hlID0gdGhpc0NhY2hlLmRhdGE7Cgl9CgoJaWYgKCBkYXRhICE9PSB1bmRlZmluZWQgKSB7CgkJdGhpc0NhY2hlWyBqUXVlcnkuY2FtZWxDYXNlKCBuYW1lICkgXSA9IGRhdGE7Cgl9CgoJLy8gQ2hlY2sgZm9yIGJvdGggY29udmVydGVkLXRvLWNhbWVsIGFuZCBub24tY29udmVydGVkIGRhdGEgcHJvcGVydHkgbmFtZXMKCS8vIElmIGEgZGF0YSBwcm9wZXJ0eSB3YXMgc3BlY2lmaWVkCglpZiAoIGdldEJ5TmFtZSApIHsKCgkJLy8gRmlyc3QgVHJ5IHRvIGZpbmQgYXMtaXMgcHJvcGVydHkgZGF0YQoJCXJldCA9IHRoaXNDYWNoZVsgbmFtZSBdOwoKCQkvLyBUZXN0IGZvciBudWxsfHVuZGVmaW5lZCBwcm9wZXJ0eSBkYXRhCgkJaWYgKCByZXQgPT0gbnVsbCApIHsKCgkJCS8vIFRyeSB0byBmaW5kIHRoZSBjYW1lbENhc2VkIHByb3BlcnR5CgkJCXJldCA9IHRoaXNDYWNoZVsgalF1ZXJ5LmNhbWVsQ2FzZSggbmFtZSApIF07CgkJfQoJfSBlbHNlIHsKCQlyZXQgPSB0aGlzQ2FjaGU7Cgl9CgoJcmV0dXJuIHJldDsKfQoKZnVuY3Rpb24gaW50ZXJuYWxSZW1vdmVEYXRhKCBlbGVtLCBuYW1lLCBwdnQgKSB7CglpZiAoICFqUXVlcnkuYWNjZXB0RGF0YSggZWxlbSApICkgewoJCXJldHVybjsKCX0KCgl2YXIgaSwgbCwgdGhpc0NhY2hlLAoJCWlzTm9kZSA9IGVsZW0ubm9kZVR5cGUsCgoJCS8vIFNlZSBqUXVlcnkuZGF0YSBmb3IgbW9yZSBpbmZvcm1hdGlvbgoJCWNhY2hlID0gaXNOb2RlID8galF1ZXJ5LmNhY2hlIDogZWxlbSwKCQlpZCA9IGlzTm9kZSA/IGVsZW1bIGpRdWVyeS5leHBhbmRvIF0gOiBqUXVlcnkuZXhwYW5kbzsKCgkvLyBJZiB0aGVyZSBpcyBhbHJlYWR5IG5vIGNhY2hlIGVudHJ5IGZvciB0aGlzIG9iamVjdCwgdGhlcmUgaXMgbm8KCS8vIHB1cnBvc2UgaW4gY29udGludWluZwoJaWYgKCAhY2FjaGVbIGlkIF0gKSB7CgkJcmV0dXJuOwoJfQoKCWlmICggbmFtZSApIHsKCgkJdGhpc0NhY2hlID0gcHZ0ID8gY2FjaGVbIGlkIF0gOiBjYWNoZVsgaWQgXS5kYXRhOwoKCQlpZiAoIHRoaXNDYWNoZSApIHsKCgkJCS8vIFN1cHBvcnQgYXJyYXkgb3Igc3BhY2Ugc2VwYXJhdGVkIHN0cmluZyBuYW1lcyBmb3IgZGF0YSBrZXlzCgkJCWlmICggIWpRdWVyeS5pc0FycmF5KCBuYW1lICkgKSB7CgoJCQkJLy8gdHJ5IHRoZSBzdHJpbmcgYXMgYSBrZXkgYmVmb3JlIGFueSBtYW5pcHVsYXRpb24KCQkJCWlmICggbmFtZSBpbiB0aGlzQ2FjaGUgKSB7CgkJCQkJbmFtZSA9IFsgbmFtZSBdOwoJCQkJfSBlbHNlIHsKCgkJCQkJLy8gc3BsaXQgdGhlIGNhbWVsIGNhc2VkIHZlcnNpb24gYnkgc3BhY2VzIHVubGVzcyBhIGtleSB3aXRoIHRoZSBzcGFjZXMgZXhpc3RzCgkJCQkJbmFtZSA9IGpRdWVyeS5jYW1lbENhc2UoIG5hbWUgKTsKCQkJCQlpZiAoIG5hbWUgaW4gdGhpc0NhY2hlICkgewoJCQkJCQluYW1lID0gWyBuYW1lIF07CgkJCQkJfSBlbHNlIHsKCQkJCQkJbmFtZSA9IG5hbWUuc3BsaXQoIiAiKTsKCQkJCQl9CgkJCQl9CgkJCX0gZWxzZSB7CgkJCQkvLyBJZiAibmFtZSIgaXMgYW4gYXJyYXkgb2Yga2V5cy4uLgoJCQkJLy8gV2hlbiBkYXRhIGlzIGluaXRpYWxseSBjcmVhdGVkLCB2aWEgKCJrZXkiLCAidmFsIikgc2lnbmF0dXJlLAoJCQkJLy8ga2V5cyB3aWxsIGJlIGNvbnZlcnRlZCB0byBjYW1lbENhc2UuCgkJCQkvLyBTaW5jZSB0aGVyZSBpcyBubyB3YXkgdG8gdGVsbCBfaG93XyBhIGtleSB3YXMgYWRkZWQsIHJlbW92ZQoJCQkJLy8gYm90aCBwbGFpbiBrZXkgYW5kIGNhbWVsQ2FzZSBrZXkuICMxMjc4NgoJCQkJLy8gVGhpcyB3aWxsIG9ubHkgcGVuYWxpemUgdGhlIGFycmF5IGFyZ3VtZW50IHBhdGguCgkJCQluYW1lID0gbmFtZS5jb25jYXQoIGpRdWVyeS5tYXAoIG5hbWUsIGpRdWVyeS5jYW1lbENhc2UgKSApOwoJCQl9CgoJCQlmb3IgKCBpID0gMCwgbCA9IG5hbWUubGVuZ3RoOyBpIDwgbDsgaSsrICkgewoJCQkJZGVsZXRlIHRoaXNDYWNoZVsgbmFtZVtpXSBdOwoJCQl9CgoJCQkvLyBJZiB0aGVyZSBpcyBubyBkYXRhIGxlZnQgaW4gdGhlIGNhY2hlLCB3ZSB3YW50IHRvIGNvbnRpbnVlCgkJCS8vIGFuZCBsZXQgdGhlIGNhY2hlIG9iamVjdCBpdHNlbGYgZ2V0IGRlc3Ryb3llZAoJCQlpZiAoICEoIHB2dCA/IGlzRW1wdHlEYXRhT2JqZWN0IDogalF1ZXJ5LmlzRW1wdHlPYmplY3QgKSggdGhpc0NhY2hlICkgKSB7CgkJCQlyZXR1cm47CgkJCX0KCQl9Cgl9CgoJLy8gU2VlIGpRdWVyeS5kYXRhIGZvciBtb3JlIGluZm9ybWF0aW9uCglpZiAoICFwdnQgKSB7CgkJZGVsZXRlIGNhY2hlWyBpZCBdLmRhdGE7CgoJCS8vIERvbid0IGRlc3Ryb3kgdGhlIHBhcmVudCBjYWNoZSB1bmxlc3MgdGhlIGludGVybmFsIGRhdGEgb2JqZWN0CgkJLy8gaGFkIGJlZW4gdGhlIG9ubHkgdGhpbmcgbGVmdCBpbiBpdAoJCWlmICggIWlzRW1wdHlEYXRhT2JqZWN0KCBjYWNoZVsgaWQgXSApICkgewoJCQlyZXR1cm47CgkJfQoJfQoKCS8vIERlc3Ryb3kgdGhlIGNhY2hlCglpZiAoIGlzTm9kZSApIHsKCQlqUXVlcnkuY2xlYW5EYXRhKCBbIGVsZW0gXSwgdHJ1ZSApOwoKCS8vIFVzZSBkZWxldGUgd2hlbiBzdXBwb3J0ZWQgZm9yIGV4cGFuZG9zIG9yIGBjYWNoZWAgaXMgbm90IGEgd2luZG93IHBlciBpc1dpbmRvdyAoIzEwMDgwKQoJfSBlbHNlIGlmICggalF1ZXJ5LnN1cHBvcnQuZGVsZXRlRXhwYW5kbyB8fCBjYWNoZSAhPSBjYWNoZS53aW5kb3cgKSB7CgkJZGVsZXRlIGNhY2hlWyBpZCBdOwoKCS8vIFdoZW4gYWxsIGVsc2UgZmFpbHMsIG51bGwKCX0gZWxzZSB7CgkJY2FjaGVbIGlkIF0gPSBudWxsOwoJfQp9CgpqUXVlcnkuZXh0ZW5kKHsKCWNhY2hlOiB7fSwKCgkvLyBVbmlxdWUgZm9yIGVhY2ggY29weSBvZiBqUXVlcnkgb24gdGhlIHBhZ2UKCS8vIE5vbi1kaWdpdHMgcmVtb3ZlZCB0byBtYXRjaCByaW5saW5lalF1ZXJ5CglleHBhbmRvOiAialF1ZXJ5IiArICggY29yZV92ZXJzaW9uICsgTWF0aC5yYW5kb20oKSApLnJlcGxhY2UoIC9cRC9nLCAiIiApLAoKCS8vIFRoZSBmb2xsb3dpbmcgZWxlbWVudHMgdGhyb3cgdW5jYXRjaGFibGUgZXhjZXB0aW9ucyBpZiB5b3UKCS8vIGF0dGVtcHQgdG8gYWRkIGV4cGFuZG8gcHJvcGVydGllcyB0byB0aGVtLgoJbm9EYXRhOiB7CgkJImVtYmVkIjogdHJ1ZSwKCQkvLyBCYW4gYWxsIG9iamVjdHMgZXhjZXB0IGZvciBGbGFzaCAod2hpY2ggaGFuZGxlIGV4cGFuZG9zKQoJCSJvYmplY3QiOiAiY2xzaWQ6RDI3Q0RCNkUtQUU2RC0xMWNmLTk2QjgtNDQ0NTUzNTQwMDAwIiwKCQkiYXBwbGV0IjogdHJ1ZQoJfSwKCgloYXNEYXRhOiBmdW5jdGlvbiggZWxlbSApIHsKCQllbGVtID0gZWxlbS5ub2RlVHlwZSA/IGpRdWVyeS5jYWNoZVsgZWxlbVtqUXVlcnkuZXhwYW5kb10gXSA6IGVsZW1bIGpRdWVyeS5leHBhbmRvIF07CgkJcmV0dXJuICEhZWxlbSAmJiAhaXNFbXB0eURhdGFPYmplY3QoIGVsZW0gKTsKCX0sCgoJZGF0YTogZnVuY3Rpb24oIGVsZW0sIG5hbWUsIGRhdGEgKSB7CgkJcmV0dXJuIGludGVybmFsRGF0YSggZWxlbSwgbmFtZSwgZGF0YSApOwoJfSwKCglyZW1vdmVEYXRhOiBmdW5jdGlvbiggZWxlbSwgbmFtZSApIHsKCQlyZXR1cm4gaW50ZXJuYWxSZW1vdmVEYXRhKCBlbGVtLCBuYW1lICk7Cgl9LAoKCS8vIEZvciBpbnRlcm5hbCB1c2Ugb25seS4KCV9kYXRhOiBmdW5jdGlvbiggZWxlbSwgbmFtZSwgZGF0YSApIHsKCQlyZXR1cm4gaW50ZXJuYWxEYXRhKCBlbGVtLCBuYW1lLCBkYXRhLCB0cnVlICk7Cgl9LAoKCV9yZW1vdmVEYXRhOiBmdW5jdGlvbiggZWxlbSwgbmFtZSApIHsKCQlyZXR1cm4gaW50ZXJuYWxSZW1vdmVEYXRhKCBlbGVtLCBuYW1lLCB0cnVlICk7Cgl9LAoKCS8vIEEgbWV0aG9kIGZvciBkZXRlcm1pbmluZyBpZiBhIERPTSBub2RlIGNhbiBoYW5kbGUgdGhlIGRhdGEgZXhwYW5kbwoJYWNjZXB0RGF0YTogZnVuY3Rpb24oIGVsZW0gKSB7CgkJLy8gRG8gbm90IHNldCBkYXRhIG9uIG5vbi1lbGVtZW50IGJlY2F1c2UgaXQgd2lsbCBub3QgYmUgY2xlYXJlZCAoIzgzMzUpLgoJCWlmICggZWxlbS5ub2RlVHlwZSAmJiBlbGVtLm5vZGVUeXBlICE9PSAxICYmIGVsZW0ubm9kZVR5cGUgIT09IDkgKSB7CgkJCXJldHVybiBmYWxzZTsKCQl9CgoJCXZhciBub0RhdGEgPSBlbGVtLm5vZGVOYW1lICYmIGpRdWVyeS5ub0RhdGFbIGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSBdOwoKCQkvLyBub2RlcyBhY2NlcHQgZGF0YSB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZDsgcmVqZWN0aW9uIGNhbiBiZSBjb25kaXRpb25hbAoJCXJldHVybiAhbm9EYXRhIHx8IG5vRGF0YSAhPT0gdHJ1ZSAmJiBlbGVtLmdldEF0dHJpYnV0ZSgiY2xhc3NpZCIpID09PSBub0RhdGE7Cgl9Cn0pOwoKalF1ZXJ5LmZuLmV4dGVuZCh7CglkYXRhOiBmdW5jdGlvbigga2V5LCB2YWx1ZSApIHsKCQl2YXIgYXR0cnMsIG5hbWUsCgkJCWVsZW0gPSB0aGlzWzBdLAoJCQlpID0gMCwKCQkJZGF0YSA9IG51bGw7CgoJCS8vIEdldHMgYWxsIHZhbHVlcwoJCWlmICgga2V5ID09PSB1bmRlZmluZWQgKSB7CgkJCWlmICggdGhpcy5sZW5ndGggKSB7CgkJCQlkYXRhID0galF1ZXJ5LmRhdGEoIGVsZW0gKTsKCgkJCQlpZiAoIGVsZW0ubm9kZVR5cGUgPT09IDEgJiYgIWpRdWVyeS5fZGF0YSggZWxlbSwgInBhcnNlZEF0dHJzIiApICkgewoJCQkJCWF0dHJzID0gZWxlbS5hdHRyaWJ1dGVzOwoJCQkJCWZvciAoIDsgaSA8IGF0dHJzLmxlbmd0aDsgaSsrICkgewoJCQkJCQluYW1lID0gYXR0cnNbaV0ubmFtZTsKCgkJCQkJCWlmICggIW5hbWUuaW5kZXhPZiggImRhdGEtIiApICkgewoJCQkJCQkJbmFtZSA9IGpRdWVyeS5jYW1lbENhc2UoIG5hbWUuc2xpY2UoNSkgKTsKCgkJCQkJCQlkYXRhQXR0ciggZWxlbSwgbmFtZSwgZGF0YVsgbmFtZSBdICk7CgkJCQkJCX0KCQkJCQl9CgkJCQkJalF1ZXJ5Ll9kYXRhKCBlbGVtLCAicGFyc2VkQXR0cnMiLCB0cnVlICk7CgkJCQl9CgkJCX0KCgkJCXJldHVybiBkYXRhOwoJCX0KCgkJLy8gU2V0cyBtdWx0aXBsZSB2YWx1ZXMKCQlpZiAoIHR5cGVvZiBrZXkgPT09ICJvYmplY3QiICkgewoJCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCQkJalF1ZXJ5LmRhdGEoIHRoaXMsIGtleSApOwoJCQl9KTsKCQl9CgoJCXJldHVybiBqUXVlcnkuYWNjZXNzKCB0aGlzLCBmdW5jdGlvbiggdmFsdWUgKSB7CgoJCQlpZiAoIHZhbHVlID09PSB1bmRlZmluZWQgKSB7CgkJCQkvLyBUcnkgdG8gZmV0Y2ggYW55IGludGVybmFsbHkgc3RvcmVkIGRhdGEgZmlyc3QKCQkJCXJldHVybiBlbGVtID8gZGF0YUF0dHIoIGVsZW0sIGtleSwgalF1ZXJ5LmRhdGEoIGVsZW0sIGtleSApICkgOiBudWxsOwoJCQl9CgoJCQl0aGlzLmVhY2goZnVuY3Rpb24oKSB7CgkJCQlqUXVlcnkuZGF0YSggdGhpcywga2V5LCB2YWx1ZSApOwoJCQl9KTsKCQl9LCBudWxsLCB2YWx1ZSwgYXJndW1lbnRzLmxlbmd0aCA+IDEsIG51bGwsIHRydWUgKTsKCX0sCgoJcmVtb3ZlRGF0YTogZnVuY3Rpb24oIGtleSApIHsKCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCQlqUXVlcnkucmVtb3ZlRGF0YSggdGhpcywga2V5ICk7CgkJfSk7Cgl9Cn0pOwoKZnVuY3Rpb24gZGF0YUF0dHIoIGVsZW0sIGtleSwgZGF0YSApIHsKCS8vIElmIG5vdGhpbmcgd2FzIGZvdW5kIGludGVybmFsbHksIHRyeSB0byBmZXRjaCBhbnkKCS8vIGRhdGEgZnJvbSB0aGUgSFRNTDUgZGF0YS0qIGF0dHJpYnV0ZQoJaWYgKCBkYXRhID09PSB1bmRlZmluZWQgJiYgZWxlbS5ub2RlVHlwZSA9PT0gMSApIHsKCgkJdmFyIG5hbWUgPSAiZGF0YS0iICsga2V5LnJlcGxhY2UoIHJtdWx0aURhc2gsICItJDEiICkudG9Mb3dlckNhc2UoKTsKCgkJZGF0YSA9IGVsZW0uZ2V0QXR0cmlidXRlKCBuYW1lICk7CgoJCWlmICggdHlwZW9mIGRhdGEgPT09ICJzdHJpbmciICkgewoJCQl0cnkgewoJCQkJZGF0YSA9IGRhdGEgPT09ICJ0cnVlIiA/IHRydWUgOgoJCQkJCWRhdGEgPT09ICJmYWxzZSIgPyBmYWxzZSA6CgkJCQkJZGF0YSA9PT0gIm51bGwiID8gbnVsbCA6CgkJCQkJLy8gT25seSBjb252ZXJ0IHRvIGEgbnVtYmVyIGlmIGl0IGRvZXNuJ3QgY2hhbmdlIHRoZSBzdHJpbmcKCQkJCQkrZGF0YSArICIiID09PSBkYXRhID8gK2RhdGEgOgoJCQkJCXJicmFjZS50ZXN0KCBkYXRhICkgPyBqUXVlcnkucGFyc2VKU09OKCBkYXRhICkgOgoJCQkJCQlkYXRhOwoJCQl9IGNhdGNoKCBlICkge30KCgkJCS8vIE1ha2Ugc3VyZSB3ZSBzZXQgdGhlIGRhdGEgc28gaXQgaXNuJ3QgY2hhbmdlZCBsYXRlcgoJCQlqUXVlcnkuZGF0YSggZWxlbSwga2V5LCBkYXRhICk7CgoJCX0gZWxzZSB7CgkJCWRhdGEgPSB1bmRlZmluZWQ7CgkJfQoJfQoKCXJldHVybiBkYXRhOwp9CgovLyBjaGVja3MgYSBjYWNoZSBvYmplY3QgZm9yIGVtcHRpbmVzcwpmdW5jdGlvbiBpc0VtcHR5RGF0YU9iamVjdCggb2JqICkgewoJdmFyIG5hbWU7Cglmb3IgKCBuYW1lIGluIG9iaiApIHsKCgkJLy8gaWYgdGhlIHB1YmxpYyBkYXRhIG9iamVjdCBpcyBlbXB0eSwgdGhlIHByaXZhdGUgaXMgc3RpbGwgZW1wdHkKCQlpZiAoIG5hbWUgPT09ICJkYXRhIiAmJiBqUXVlcnkuaXNFbXB0eU9iamVjdCggb2JqW25hbWVdICkgKSB7CgkJCWNvbnRpbnVlOwoJCX0KCQlpZiAoIG5hbWUgIT09ICJ0b0pTT04iICkgewoJCQlyZXR1cm4gZmFsc2U7CgkJfQoJfQoKCXJldHVybiB0cnVlOwp9CmpRdWVyeS5leHRlbmQoewoJcXVldWU6IGZ1bmN0aW9uKCBlbGVtLCB0eXBlLCBkYXRhICkgewoJCXZhciBxdWV1ZTsKCgkJaWYgKCBlbGVtICkgewoJCQl0eXBlID0gKCB0eXBlIHx8ICJmeCIgKSArICJxdWV1ZSI7CgkJCXF1ZXVlID0galF1ZXJ5Ll9kYXRhKCBlbGVtLCB0eXBlICk7CgoJCQkvLyBTcGVlZCB1cCBkZXF1ZXVlIGJ5IGdldHRpbmcgb3V0IHF1aWNrbHkgaWYgdGhpcyBpcyBqdXN0IGEgbG9va3VwCgkJCWlmICggZGF0YSApIHsKCQkJCWlmICggIXF1ZXVlIHx8IGpRdWVyeS5pc0FycmF5KGRhdGEpICkgewoJCQkJCXF1ZXVlID0galF1ZXJ5Ll9kYXRhKCBlbGVtLCB0eXBlLCBqUXVlcnkubWFrZUFycmF5KGRhdGEpICk7CgkJCQl9IGVsc2UgewoJCQkJCXF1ZXVlLnB1c2goIGRhdGEgKTsKCQkJCX0KCQkJfQoJCQlyZXR1cm4gcXVldWUgfHwgW107CgkJfQoJfSwKCglkZXF1ZXVlOiBmdW5jdGlvbiggZWxlbSwgdHlwZSApIHsKCQl0eXBlID0gdHlwZSB8fCAiZngiOwoKCQl2YXIgcXVldWUgPSBqUXVlcnkucXVldWUoIGVsZW0sIHR5cGUgKSwKCQkJc3RhcnRMZW5ndGggPSBxdWV1ZS5sZW5ndGgsCgkJCWZuID0gcXVldWUuc2hpZnQoKSwKCQkJaG9va3MgPSBqUXVlcnkuX3F1ZXVlSG9va3MoIGVsZW0sIHR5cGUgKSwKCQkJbmV4dCA9IGZ1bmN0aW9uKCkgewoJCQkJalF1ZXJ5LmRlcXVldWUoIGVsZW0sIHR5cGUgKTsKCQkJfTsKCgkJLy8gSWYgdGhlIGZ4IHF1ZXVlIGlzIGRlcXVldWVkLCBhbHdheXMgcmVtb3ZlIHRoZSBwcm9ncmVzcyBzZW50aW5lbAoJCWlmICggZm4gPT09ICJpbnByb2dyZXNzIiApIHsKCQkJZm4gPSBxdWV1ZS5zaGlmdCgpOwoJCQlzdGFydExlbmd0aC0tOwoJCX0KCgkJaG9va3MuY3VyID0gZm47CgkJaWYgKCBmbiApIHsKCgkJCS8vIEFkZCBhIHByb2dyZXNzIHNlbnRpbmVsIHRvIHByZXZlbnQgdGhlIGZ4IHF1ZXVlIGZyb20gYmVpbmcKCQkJLy8gYXV0b21hdGljYWxseSBkZXF1ZXVlZAoJCQlpZiAoIHR5cGUgPT09ICJmeCIgKSB7CgkJCQlxdWV1ZS51bnNoaWZ0KCAiaW5wcm9ncmVzcyIgKTsKCQkJfQoKCQkJLy8gY2xlYXIgdXAgdGhlIGxhc3QgcXVldWUgc3RvcCBmdW5jdGlvbgoJCQlkZWxldGUgaG9va3Muc3RvcDsKCQkJZm4uY2FsbCggZWxlbSwgbmV4dCwgaG9va3MgKTsKCQl9CgoJCWlmICggIXN0YXJ0TGVuZ3RoICYmIGhvb2tzICkgewoJCQlob29rcy5lbXB0eS5maXJlKCk7CgkJfQoJfSwKCgkvLyBub3QgaW50ZW5kZWQgZm9yIHB1YmxpYyBjb25zdW1wdGlvbiAtIGdlbmVyYXRlcyBhIHF1ZXVlSG9va3Mgb2JqZWN0LCBvciByZXR1cm5zIHRoZSBjdXJyZW50IG9uZQoJX3F1ZXVlSG9va3M6IGZ1bmN0aW9uKCBlbGVtLCB0eXBlICkgewoJCXZhciBrZXkgPSB0eXBlICsgInF1ZXVlSG9va3MiOwoJCXJldHVybiBqUXVlcnkuX2RhdGEoIGVsZW0sIGtleSApIHx8IGpRdWVyeS5fZGF0YSggZWxlbSwga2V5LCB7CgkJCWVtcHR5OiBqUXVlcnkuQ2FsbGJhY2tzKCJvbmNlIG1lbW9yeSIpLmFkZChmdW5jdGlvbigpIHsKCQkJCWpRdWVyeS5fcmVtb3ZlRGF0YSggZWxlbSwgdHlwZSArICJxdWV1ZSIgKTsKCQkJCWpRdWVyeS5fcmVtb3ZlRGF0YSggZWxlbSwga2V5ICk7CgkJCX0pCgkJfSk7Cgl9Cn0pOwoKalF1ZXJ5LmZuLmV4dGVuZCh7CglxdWV1ZTogZnVuY3Rpb24oIHR5cGUsIGRhdGEgKSB7CgkJdmFyIHNldHRlciA9IDI7CgoJCWlmICggdHlwZW9mIHR5cGUgIT09ICJzdHJpbmciICkgewoJCQlkYXRhID0gdHlwZTsKCQkJdHlwZSA9ICJmeCI7CgkJCXNldHRlci0tOwoJCX0KCgkJaWYgKCBhcmd1bWVudHMubGVuZ3RoIDwgc2V0dGVyICkgewoJCQlyZXR1cm4galF1ZXJ5LnF1ZXVlKCB0aGlzWzBdLCB0eXBlICk7CgkJfQoKCQlyZXR1cm4gZGF0YSA9PT0gdW5kZWZpbmVkID8KCQkJdGhpcyA6CgkJCXRoaXMuZWFjaChmdW5jdGlvbigpIHsKCQkJCXZhciBxdWV1ZSA9IGpRdWVyeS5xdWV1ZSggdGhpcywgdHlwZSwgZGF0YSApOwoKCQkJCS8vIGVuc3VyZSBhIGhvb2tzIGZvciB0aGlzIHF1ZXVlCgkJCQlqUXVlcnkuX3F1ZXVlSG9va3MoIHRoaXMsIHR5cGUgKTsKCgkJCQlpZiAoIHR5cGUgPT09ICJmeCIgJiYgcXVldWVbMF0gIT09ICJpbnByb2dyZXNzIiApIHsKCQkJCQlqUXVlcnkuZGVxdWV1ZSggdGhpcywgdHlwZSApOwoJCQkJfQoJCQl9KTsKCX0sCglkZXF1ZXVlOiBmdW5jdGlvbiggdHlwZSApIHsKCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCQlqUXVlcnkuZGVxdWV1ZSggdGhpcywgdHlwZSApOwoJCX0pOwoJfSwKCS8vIEJhc2VkIG9mZiBvZiB0aGUgcGx1Z2luIGJ5IENsaW50IEhlbGZlcnMsIHdpdGggcGVybWlzc2lvbi4KCS8vIGh0dHA6Ly9ibGluZHNpZ25hbHMuY29tL2luZGV4LnBocC8yMDA5LzA3L2pxdWVyeS1kZWxheS8KCWRlbGF5OiBmdW5jdGlvbiggdGltZSwgdHlwZSApIHsKCQl0aW1lID0galF1ZXJ5LmZ4ID8galF1ZXJ5LmZ4LnNwZWVkc1sgdGltZSBdIHx8IHRpbWUgOiB0aW1lOwoJCXR5cGUgPSB0eXBlIHx8ICJmeCI7CgoJCXJldHVybiB0aGlzLnF1ZXVlKCB0eXBlLCBmdW5jdGlvbiggbmV4dCwgaG9va3MgKSB7CgkJCXZhciB0aW1lb3V0ID0gc2V0VGltZW91dCggbmV4dCwgdGltZSApOwoJCQlob29rcy5zdG9wID0gZnVuY3Rpb24oKSB7CgkJCQljbGVhclRpbWVvdXQoIHRpbWVvdXQgKTsKCQkJfTsKCQl9KTsKCX0sCgljbGVhclF1ZXVlOiBmdW5jdGlvbiggdHlwZSApIHsKCQlyZXR1cm4gdGhpcy5xdWV1ZSggdHlwZSB8fCAiZngiLCBbXSApOwoJfSwKCS8vIEdldCBhIHByb21pc2UgcmVzb2x2ZWQgd2hlbiBxdWV1ZXMgb2YgYSBjZXJ0YWluIHR5cGUKCS8vIGFyZSBlbXB0aWVkIChmeCBpcyB0aGUgdHlwZSBieSBkZWZhdWx0KQoJcHJvbWlzZTogZnVuY3Rpb24oIHR5cGUsIG9iaiApIHsKCQl2YXIgdG1wLAoJCQljb3VudCA9IDEsCgkJCWRlZmVyID0galF1ZXJ5LkRlZmVycmVkKCksCgkJCWVsZW1lbnRzID0gdGhpcywKCQkJaSA9IHRoaXMubGVuZ3RoLAoJCQlyZXNvbHZlID0gZnVuY3Rpb24oKSB7CgkJCQlpZiAoICEoIC0tY291bnQgKSApIHsKCQkJCQlkZWZlci5yZXNvbHZlV2l0aCggZWxlbWVudHMsIFsgZWxlbWVudHMgXSApOwoJCQkJfQoJCQl9OwoKCQlpZiAoIHR5cGVvZiB0eXBlICE9PSAic3RyaW5nIiApIHsKCQkJb2JqID0gdHlwZTsKCQkJdHlwZSA9IHVuZGVmaW5lZDsKCQl9CgkJdHlwZSA9IHR5cGUgfHwgImZ4IjsKCgkJd2hpbGUoIGktLSApIHsKCQkJdG1wID0galF1ZXJ5Ll9kYXRhKCBlbGVtZW50c1sgaSBdLCB0eXBlICsgInF1ZXVlSG9va3MiICk7CgkJCWlmICggdG1wICYmIHRtcC5lbXB0eSApIHsKCQkJCWNvdW50Kys7CgkJCQl0bXAuZW1wdHkuYWRkKCByZXNvbHZlICk7CgkJCX0KCQl9CgkJcmVzb2x2ZSgpOwoJCXJldHVybiBkZWZlci5wcm9taXNlKCBvYmogKTsKCX0KfSk7CnZhciBub2RlSG9vaywgYm9vbEhvb2ssCglyY2xhc3MgPSAvW1x0XHJcbl0vZywKCXJyZXR1cm4gPSAvXHIvZywKCXJmb2N1c2FibGUgPSAvXig/OmlucHV0fHNlbGVjdHx0ZXh0YXJlYXxidXR0b258b2JqZWN0KSQvaSwKCXJjbGlja2FibGUgPSAvXig/OmF8YXJlYSkkL2ksCglyYm9vbGVhbiA9IC9eKD86Y2hlY2tlZHxzZWxlY3RlZHxhdXRvZm9jdXN8YXV0b3BsYXl8YXN5bmN8Y29udHJvbHN8ZGVmZXJ8ZGlzYWJsZWR8aGlkZGVufGxvb3B8bXVsdGlwbGV8b3BlbnxyZWFkb25seXxyZXF1aXJlZHxzY29wZWQpJC9pLAoJcnVzZURlZmF1bHQgPSAvXig/OmNoZWNrZWR8c2VsZWN0ZWQpJC9pLAoJZ2V0U2V0QXR0cmlidXRlID0galF1ZXJ5LnN1cHBvcnQuZ2V0U2V0QXR0cmlidXRlLAoJZ2V0U2V0SW5wdXQgPSBqUXVlcnkuc3VwcG9ydC5pbnB1dDsKCmpRdWVyeS5mbi5leHRlbmQoewoJYXR0cjogZnVuY3Rpb24oIG5hbWUsIHZhbHVlICkgewoJCXJldHVybiBqUXVlcnkuYWNjZXNzKCB0aGlzLCBqUXVlcnkuYXR0ciwgbmFtZSwgdmFsdWUsIGFyZ3VtZW50cy5sZW5ndGggPiAxICk7Cgl9LAoKCXJlbW92ZUF0dHI6IGZ1bmN0aW9uKCBuYW1lICkgewoJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CgkJCWpRdWVyeS5yZW1vdmVBdHRyKCB0aGlzLCBuYW1lICk7CgkJfSk7Cgl9LAoKCXByb3A6IGZ1bmN0aW9uKCBuYW1lLCB2YWx1ZSApIHsKCQlyZXR1cm4galF1ZXJ5LmFjY2VzcyggdGhpcywgalF1ZXJ5LnByb3AsIG5hbWUsIHZhbHVlLCBhcmd1bWVudHMubGVuZ3RoID4gMSApOwoJfSwKCglyZW1vdmVQcm9wOiBmdW5jdGlvbiggbmFtZSApIHsKCQluYW1lID0galF1ZXJ5LnByb3BGaXhbIG5hbWUgXSB8fCBuYW1lOwoJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CgkJCS8vIHRyeS9jYXRjaCBoYW5kbGVzIGNhc2VzIHdoZXJlIElFIGJhbGtzIChzdWNoIGFzIHJlbW92aW5nIGEgcHJvcGVydHkgb24gd2luZG93KQoJCQl0cnkgewoJCQkJdGhpc1sgbmFtZSBdID0gdW5kZWZpbmVkOwoJCQkJZGVsZXRlIHRoaXNbIG5hbWUgXTsKCQkJfSBjYXRjaCggZSApIHt9CgkJfSk7Cgl9LAoKCWFkZENsYXNzOiBmdW5jdGlvbiggdmFsdWUgKSB7CgkJdmFyIGNsYXNzZXMsIGVsZW0sIGN1ciwgY2xhenosIGosCgkJCWkgPSAwLAoJCQlsZW4gPSB0aGlzLmxlbmd0aCwKCQkJcHJvY2VlZCA9IHR5cGVvZiB2YWx1ZSA9PT0gInN0cmluZyIgJiYgdmFsdWU7CgoJCWlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIHZhbHVlICkgKSB7CgkJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oIGogKSB7CgkJCQlqUXVlcnkoIHRoaXMgKS5hZGRDbGFzcyggdmFsdWUuY2FsbCggdGhpcywgaiwgdGhpcy5jbGFzc05hbWUgKSApOwoJCQl9KTsKCQl9CgoJCWlmICggcHJvY2VlZCApIHsKCQkJLy8gVGhlIGRpc2p1bmN0aW9uIGhlcmUgaXMgZm9yIGJldHRlciBjb21wcmVzc2liaWxpdHkgKHNlZSByZW1vdmVDbGFzcykKCQkJY2xhc3NlcyA9ICggdmFsdWUgfHwgIiIgKS5tYXRjaCggY29yZV9ybm90d2hpdGUgKSB8fCBbXTsKCgkJCWZvciAoIDsgaSA8IGxlbjsgaSsrICkgewoJCQkJZWxlbSA9IHRoaXNbIGkgXTsKCQkJCWN1ciA9IGVsZW0ubm9kZVR5cGUgPT09IDEgJiYgKCBlbGVtLmNsYXNzTmFtZSA/CgkJCQkJKCAiICIgKyBlbGVtLmNsYXNzTmFtZSArICIgIiApLnJlcGxhY2UoIHJjbGFzcywgIiAiICkgOgoJCQkJCSIgIgoJCQkJKTsKCgkJCQlpZiAoIGN1ciApIHsKCQkJCQlqID0gMDsKCQkJCQl3aGlsZSAoIChjbGF6eiA9IGNsYXNzZXNbaisrXSkgKSB7CgkJCQkJCWlmICggY3VyLmluZGV4T2YoICIgIiArIGNsYXp6ICsgIiAiICkgPCAwICkgewoJCQkJCQkJY3VyICs9IGNsYXp6ICsgIiAiOwoJCQkJCQl9CgkJCQkJfQoJCQkJCWVsZW0uY2xhc3NOYW1lID0galF1ZXJ5LnRyaW0oIGN1ciApOwoKCQkJCX0KCQkJfQoJCX0KCgkJcmV0dXJuIHRoaXM7Cgl9LAoKCXJlbW92ZUNsYXNzOiBmdW5jdGlvbiggdmFsdWUgKSB7CgkJdmFyIGNsYXNzZXMsIGVsZW0sIGN1ciwgY2xhenosIGosCgkJCWkgPSAwLAoJCQlsZW4gPSB0aGlzLmxlbmd0aCwKCQkJcHJvY2VlZCA9IGFyZ3VtZW50cy5sZW5ndGggPT09IDAgfHwgdHlwZW9mIHZhbHVlID09PSAic3RyaW5nIiAmJiB2YWx1ZTsKCgkJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggdmFsdWUgKSApIHsKCQkJcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiggaiApIHsKCQkJCWpRdWVyeSggdGhpcyApLnJlbW92ZUNsYXNzKCB2YWx1ZS5jYWxsKCB0aGlzLCBqLCB0aGlzLmNsYXNzTmFtZSApICk7CgkJCX0pOwoJCX0KCQlpZiAoIHByb2NlZWQgKSB7CgkJCWNsYXNzZXMgPSAoIHZhbHVlIHx8ICIiICkubWF0Y2goIGNvcmVfcm5vdHdoaXRlICkgfHwgW107CgoJCQlmb3IgKCA7IGkgPCBsZW47IGkrKyApIHsKCQkJCWVsZW0gPSB0aGlzWyBpIF07CgkJCQkvLyBUaGlzIGV4cHJlc3Npb24gaXMgaGVyZSBmb3IgYmV0dGVyIGNvbXByZXNzaWJpbGl0eSAoc2VlIGFkZENsYXNzKQoJCQkJY3VyID0gZWxlbS5ub2RlVHlwZSA9PT0gMSAmJiAoIGVsZW0uY2xhc3NOYW1lID8KCQkJCQkoICIgIiArIGVsZW0uY2xhc3NOYW1lICsgIiAiICkucmVwbGFjZSggcmNsYXNzLCAiICIgKSA6CgkJCQkJIiIKCQkJCSk7CgoJCQkJaWYgKCBjdXIgKSB7CgkJCQkJaiA9IDA7CgkJCQkJd2hpbGUgKCAoY2xhenogPSBjbGFzc2VzW2orK10pICkgewoJCQkJCQkvLyBSZW1vdmUgKmFsbCogaW5zdGFuY2VzCgkJCQkJCXdoaWxlICggY3VyLmluZGV4T2YoICIgIiArIGNsYXp6ICsgIiAiICkgPj0gMCApIHsKCQkJCQkJCWN1ciA9IGN1ci5yZXBsYWNlKCAiICIgKyBjbGF6eiArICIgIiwgIiAiICk7CgkJCQkJCX0KCQkJCQl9CgkJCQkJZWxlbS5jbGFzc05hbWUgPSB2YWx1ZSA/IGpRdWVyeS50cmltKCBjdXIgKSA6ICIiOwoJCQkJfQoJCQl9CgkJfQoKCQlyZXR1cm4gdGhpczsKCX0sCgoJdG9nZ2xlQ2xhc3M6IGZ1bmN0aW9uKCB2YWx1ZSwgc3RhdGVWYWwgKSB7CgkJdmFyIHR5cGUgPSB0eXBlb2YgdmFsdWUsCgkJCWlzQm9vbCA9IHR5cGVvZiBzdGF0ZVZhbCA9PT0gImJvb2xlYW4iOwoKCQlpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCB2YWx1ZSApICkgewoJCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCBpICkgewoJCQkJalF1ZXJ5KCB0aGlzICkudG9nZ2xlQ2xhc3MoIHZhbHVlLmNhbGwodGhpcywgaSwgdGhpcy5jbGFzc05hbWUsIHN0YXRlVmFsKSwgc3RhdGVWYWwgKTsKCQkJfSk7CgkJfQoKCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCQlpZiAoIHR5cGUgPT09ICJzdHJpbmciICkgewoJCQkJLy8gdG9nZ2xlIGluZGl2aWR1YWwgY2xhc3MgbmFtZXMKCQkJCXZhciBjbGFzc05hbWUsCgkJCQkJaSA9IDAsCgkJCQkJc2VsZiA9IGpRdWVyeSggdGhpcyApLAoJCQkJCXN0YXRlID0gc3RhdGVWYWwsCgkJCQkJY2xhc3NOYW1lcyA9IHZhbHVlLm1hdGNoKCBjb3JlX3Jub3R3aGl0ZSApIHx8IFtdOwoKCQkJCXdoaWxlICggKGNsYXNzTmFtZSA9IGNsYXNzTmFtZXNbIGkrKyBdKSApIHsKCQkJCQkvLyBjaGVjayBlYWNoIGNsYXNzTmFtZSBnaXZlbiwgc3BhY2Ugc2VwYXJhdGVkIGxpc3QKCQkJCQlzdGF0ZSA9IGlzQm9vbCA/IHN0YXRlIDogIXNlbGYuaGFzQ2xhc3MoIGNsYXNzTmFtZSApOwoJCQkJCXNlbGZbIHN0YXRlID8gImFkZENsYXNzIiA6ICJyZW1vdmVDbGFzcyIgXSggY2xhc3NOYW1lICk7CgkJCQl9CgoJCQkvLyBUb2dnbGUgd2hvbGUgY2xhc3MgbmFtZQoJCQl9IGVsc2UgaWYgKCB0eXBlID09PSBjb3JlX3N0cnVuZGVmaW5lZCB8fCB0eXBlID09PSAiYm9vbGVhbiIgKSB7CgkJCQlpZiAoIHRoaXMuY2xhc3NOYW1lICkgewoJCQkJCS8vIHN0b3JlIGNsYXNzTmFtZSBpZiBzZXQKCQkJCQlqUXVlcnkuX2RhdGEoIHRoaXMsICJfX2NsYXNzTmFtZV9fIiwgdGhpcy5jbGFzc05hbWUgKTsKCQkJCX0KCgkJCQkvLyBJZiB0aGUgZWxlbWVudCBoYXMgYSBjbGFzcyBuYW1lIG9yIGlmIHdlJ3JlIHBhc3NlZCAiZmFsc2UiLAoJCQkJLy8gdGhlbiByZW1vdmUgdGhlIHdob2xlIGNsYXNzbmFtZSAoaWYgdGhlcmUgd2FzIG9uZSwgdGhlIGFib3ZlIHNhdmVkIGl0KS4KCQkJCS8vIE90aGVyd2lzZSBicmluZyBiYWNrIHdoYXRldmVyIHdhcyBwcmV2aW91c2x5IHNhdmVkIChpZiBhbnl0aGluZyksCgkJCQkvLyBmYWxsaW5nIGJhY2sgdG8gdGhlIGVtcHR5IHN0cmluZyBpZiBub3RoaW5nIHdhcyBzdG9yZWQuCgkJCQl0aGlzLmNsYXNzTmFtZSA9IHRoaXMuY2xhc3NOYW1lIHx8IHZhbHVlID09PSBmYWxzZSA/ICIiIDogalF1ZXJ5Ll9kYXRhKCB0aGlzLCAiX19jbGFzc05hbWVfXyIgKSB8fCAiIjsKCQkJfQoJCX0pOwoJfSwKCgloYXNDbGFzczogZnVuY3Rpb24oIHNlbGVjdG9yICkgewoJCXZhciBjbGFzc05hbWUgPSAiICIgKyBzZWxlY3RvciArICIgIiwKCQkJaSA9IDAsCgkJCWwgPSB0aGlzLmxlbmd0aDsKCQlmb3IgKCA7IGkgPCBsOyBpKysgKSB7CgkJCWlmICggdGhpc1tpXS5ub2RlVHlwZSA9PT0gMSAmJiAoIiAiICsgdGhpc1tpXS5jbGFzc05hbWUgKyAiICIpLnJlcGxhY2UocmNsYXNzLCAiICIpLmluZGV4T2YoIGNsYXNzTmFtZSApID49IDAgKSB7CgkJCQlyZXR1cm4gdHJ1ZTsKCQkJfQoJCX0KCgkJcmV0dXJuIGZhbHNlOwoJfSwKCgl2YWw6IGZ1bmN0aW9uKCB2YWx1ZSApIHsKCQl2YXIgcmV0LCBob29rcywgaXNGdW5jdGlvbiwKCQkJZWxlbSA9IHRoaXNbMF07CgoJCWlmICggIWFyZ3VtZW50cy5sZW5ndGggKSB7CgkJCWlmICggZWxlbSApIHsKCQkJCWhvb2tzID0galF1ZXJ5LnZhbEhvb2tzWyBlbGVtLnR5cGUgXSB8fCBqUXVlcnkudmFsSG9va3NbIGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSBdOwoKCQkJCWlmICggaG9va3MgJiYgImdldCIgaW4gaG9va3MgJiYgKHJldCA9IGhvb2tzLmdldCggZWxlbSwgInZhbHVlIiApKSAhPT0gdW5kZWZpbmVkICkgewoJCQkJCXJldHVybiByZXQ7CgkJCQl9CgoJCQkJcmV0ID0gZWxlbS52YWx1ZTsKCgkJCQlyZXR1cm4gdHlwZW9mIHJldCA9PT0gInN0cmluZyIgPwoJCQkJCS8vIGhhbmRsZSBtb3N0IGNvbW1vbiBzdHJpbmcgY2FzZXMKCQkJCQlyZXQucmVwbGFjZShycmV0dXJuLCAiIikgOgoJCQkJCS8vIGhhbmRsZSBjYXNlcyB3aGVyZSB2YWx1ZSBpcyBudWxsL3VuZGVmIG9yIG51bWJlcgoJCQkJCXJldCA9PSBudWxsID8gIiIgOiByZXQ7CgkJCX0KCgkJCXJldHVybjsKCQl9CgoJCWlzRnVuY3Rpb24gPSBqUXVlcnkuaXNGdW5jdGlvbiggdmFsdWUgKTsKCgkJcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiggaSApIHsKCQkJdmFyIHZhbCwKCQkJCXNlbGYgPSBqUXVlcnkodGhpcyk7CgoJCQlpZiAoIHRoaXMubm9kZVR5cGUgIT09IDEgKSB7CgkJCQlyZXR1cm47CgkJCX0KCgkJCWlmICggaXNGdW5jdGlvbiApIHsKCQkJCXZhbCA9IHZhbHVlLmNhbGwoIHRoaXMsIGksIHNlbGYudmFsKCkgKTsKCQkJfSBlbHNlIHsKCQkJCXZhbCA9IHZhbHVlOwoJCQl9CgoJCQkvLyBUcmVhdCBudWxsL3VuZGVmaW5lZCBhcyAiIjsgY29udmVydCBudW1iZXJzIHRvIHN0cmluZwoJCQlpZiAoIHZhbCA9PSBudWxsICkgewoJCQkJdmFsID0gIiI7CgkJCX0gZWxzZSBpZiAoIHR5cGVvZiB2YWwgPT09ICJudW1iZXIiICkgewoJCQkJdmFsICs9ICIiOwoJCQl9IGVsc2UgaWYgKCBqUXVlcnkuaXNBcnJheSggdmFsICkgKSB7CgkJCQl2YWwgPSBqUXVlcnkubWFwKHZhbCwgZnVuY3Rpb24gKCB2YWx1ZSApIHsKCQkJCQlyZXR1cm4gdmFsdWUgPT0gbnVsbCA/ICIiIDogdmFsdWUgKyAiIjsKCQkJCX0pOwoJCQl9CgoJCQlob29rcyA9IGpRdWVyeS52YWxIb29rc1sgdGhpcy50eXBlIF0gfHwgalF1ZXJ5LnZhbEhvb2tzWyB0aGlzLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgXTsKCgkJCS8vIElmIHNldCByZXR1cm5zIHVuZGVmaW5lZCwgZmFsbCBiYWNrIHRvIG5vcm1hbCBzZXR0aW5nCgkJCWlmICggIWhvb2tzIHx8ICEoInNldCIgaW4gaG9va3MpIHx8IGhvb2tzLnNldCggdGhpcywgdmFsLCAidmFsdWUiICkgPT09IHVuZGVmaW5lZCApIHsKCQkJCXRoaXMudmFsdWUgPSB2YWw7CgkJCX0KCQl9KTsKCX0KfSk7CgpqUXVlcnkuZXh0ZW5kKHsKCXZhbEhvb2tzOiB7CgkJb3B0aW9uOiB7CgkJCWdldDogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCQkvLyBhdHRyaWJ1dGVzLnZhbHVlIGlzIHVuZGVmaW5lZCBpbiBCbGFja2JlcnJ5IDQuNyBidXQKCQkJCS8vIHVzZXMgLnZhbHVlLiBTZWUgIzY5MzIKCQkJCXZhciB2YWwgPSBlbGVtLmF0dHJpYnV0ZXMudmFsdWU7CgkJCQlyZXR1cm4gIXZhbCB8fCB2YWwuc3BlY2lmaWVkID8gZWxlbS52YWx1ZSA6IGVsZW0udGV4dDsKCQkJfQoJCX0sCgkJc2VsZWN0OiB7CgkJCWdldDogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCQl2YXIgdmFsdWUsIG9wdGlvbiwKCQkJCQlvcHRpb25zID0gZWxlbS5vcHRpb25zLAoJCQkJCWluZGV4ID0gZWxlbS5zZWxlY3RlZEluZGV4LAoJCQkJCW9uZSA9IGVsZW0udHlwZSA9PT0gInNlbGVjdC1vbmUiIHx8IGluZGV4IDwgMCwKCQkJCQl2YWx1ZXMgPSBvbmUgPyBudWxsIDogW10sCgkJCQkJbWF4ID0gb25lID8gaW5kZXggKyAxIDogb3B0aW9ucy5sZW5ndGgsCgkJCQkJaSA9IGluZGV4IDwgMCA/CgkJCQkJCW1heCA6CgkJCQkJCW9uZSA/IGluZGV4IDogMDsKCgkJCQkvLyBMb29wIHRocm91Z2ggYWxsIHRoZSBzZWxlY3RlZCBvcHRpb25zCgkJCQlmb3IgKCA7IGkgPCBtYXg7IGkrKyApIHsKCQkJCQlvcHRpb24gPSBvcHRpb25zWyBpIF07CgoJCQkJCS8vIG9sZElFIGRvZXNuJ3QgdXBkYXRlIHNlbGVjdGVkIGFmdGVyIGZvcm0gcmVzZXQgKCMyNTUxKQoJCQkJCWlmICggKCBvcHRpb24uc2VsZWN0ZWQgfHwgaSA9PT0gaW5kZXggKSAmJgoJCQkJCQkJLy8gRG9uJ3QgcmV0dXJuIG9wdGlvbnMgdGhhdCBhcmUgZGlzYWJsZWQgb3IgaW4gYSBkaXNhYmxlZCBvcHRncm91cAoJCQkJCQkJKCBqUXVlcnkuc3VwcG9ydC5vcHREaXNhYmxlZCA/ICFvcHRpb24uZGlzYWJsZWQgOiBvcHRpb24uZ2V0QXR0cmlidXRlKCJkaXNhYmxlZCIpID09PSBudWxsICkgJiYKCQkJCQkJCSggIW9wdGlvbi5wYXJlbnROb2RlLmRpc2FibGVkIHx8ICFqUXVlcnkubm9kZU5hbWUoIG9wdGlvbi5wYXJlbnROb2RlLCAib3B0Z3JvdXAiICkgKSApIHsKCgkJCQkJCS8vIEdldCB0aGUgc3BlY2lmaWMgdmFsdWUgZm9yIHRoZSBvcHRpb24KCQkJCQkJdmFsdWUgPSBqUXVlcnkoIG9wdGlvbiApLnZhbCgpOwoKCQkJCQkJLy8gV2UgZG9uJ3QgbmVlZCBhbiBhcnJheSBmb3Igb25lIHNlbGVjdHMKCQkJCQkJaWYgKCBvbmUgKSB7CgkJCQkJCQlyZXR1cm4gdmFsdWU7CgkJCQkJCX0KCgkJCQkJCS8vIE11bHRpLVNlbGVjdHMgcmV0dXJuIGFuIGFycmF5CgkJCQkJCXZhbHVlcy5wdXNoKCB2YWx1ZSApOwoJCQkJCX0KCQkJCX0KCgkJCQlyZXR1cm4gdmFsdWVzOwoJCQl9LAoKCQkJc2V0OiBmdW5jdGlvbiggZWxlbSwgdmFsdWUgKSB7CgkJCQl2YXIgdmFsdWVzID0galF1ZXJ5Lm1ha2VBcnJheSggdmFsdWUgKTsKCgkJCQlqUXVlcnkoZWxlbSkuZmluZCgib3B0aW9uIikuZWFjaChmdW5jdGlvbigpIHsKCQkJCQl0aGlzLnNlbGVjdGVkID0galF1ZXJ5LmluQXJyYXkoIGpRdWVyeSh0aGlzKS52YWwoKSwgdmFsdWVzICkgPj0gMDsKCQkJCX0pOwoKCQkJCWlmICggIXZhbHVlcy5sZW5ndGggKSB7CgkJCQkJZWxlbS5zZWxlY3RlZEluZGV4ID0gLTE7CgkJCQl9CgkJCQlyZXR1cm4gdmFsdWVzOwoJCQl9CgkJfQoJfSwKCglhdHRyOiBmdW5jdGlvbiggZWxlbSwgbmFtZSwgdmFsdWUgKSB7CgkJdmFyIGhvb2tzLCBub3R4bWwsIHJldCwKCQkJblR5cGUgPSBlbGVtLm5vZGVUeXBlOwoKCQkvLyBkb24ndCBnZXQvc2V0IGF0dHJpYnV0ZXMgb24gdGV4dCwgY29tbWVudCBhbmQgYXR0cmlidXRlIG5vZGVzCgkJaWYgKCAhZWxlbSB8fCBuVHlwZSA9PT0gMyB8fCBuVHlwZSA9PT0gOCB8fCBuVHlwZSA9PT0gMiApIHsKCQkJcmV0dXJuOwoJCX0KCgkJLy8gRmFsbGJhY2sgdG8gcHJvcCB3aGVuIGF0dHJpYnV0ZXMgYXJlIG5vdCBzdXBwb3J0ZWQKCQlpZiAoIHR5cGVvZiBlbGVtLmdldEF0dHJpYnV0ZSA9PT0gY29yZV9zdHJ1bmRlZmluZWQgKSB7CgkJCXJldHVybiBqUXVlcnkucHJvcCggZWxlbSwgbmFtZSwgdmFsdWUgKTsKCQl9CgoJCW5vdHhtbCA9IG5UeXBlICE9PSAxIHx8ICFqUXVlcnkuaXNYTUxEb2MoIGVsZW0gKTsKCgkJLy8gQWxsIGF0dHJpYnV0ZXMgYXJlIGxvd2VyY2FzZQoJCS8vIEdyYWIgbmVjZXNzYXJ5IGhvb2sgaWYgb25lIGlzIGRlZmluZWQKCQlpZiAoIG5vdHhtbCApIHsKCQkJbmFtZSA9IG5hbWUudG9Mb3dlckNhc2UoKTsKCQkJaG9va3MgPSBqUXVlcnkuYXR0ckhvb2tzWyBuYW1lIF0gfHwgKCByYm9vbGVhbi50ZXN0KCBuYW1lICkgPyBib29sSG9vayA6IG5vZGVIb29rICk7CgkJfQoKCQlpZiAoIHZhbHVlICE9PSB1bmRlZmluZWQgKSB7CgoJCQlpZiAoIHZhbHVlID09PSBudWxsICkgewoJCQkJalF1ZXJ5LnJlbW92ZUF0dHIoIGVsZW0sIG5hbWUgKTsKCgkJCX0gZWxzZSBpZiAoIGhvb2tzICYmIG5vdHhtbCAmJiAic2V0IiBpbiBob29rcyAmJiAocmV0ID0gaG9va3Muc2V0KCBlbGVtLCB2YWx1ZSwgbmFtZSApKSAhPT0gdW5kZWZpbmVkICkgewoJCQkJcmV0dXJuIHJldDsKCgkJCX0gZWxzZSB7CgkJCQllbGVtLnNldEF0dHJpYnV0ZSggbmFtZSwgdmFsdWUgKyAiIiApOwoJCQkJcmV0dXJuIHZhbHVlOwoJCQl9CgoJCX0gZWxzZSBpZiAoIGhvb2tzICYmIG5vdHhtbCAmJiAiZ2V0IiBpbiBob29rcyAmJiAocmV0ID0gaG9va3MuZ2V0KCBlbGVtLCBuYW1lICkpICE9PSBudWxsICkgewoJCQlyZXR1cm4gcmV0OwoKCQl9IGVsc2UgewoKCQkJLy8gSW4gSUU5KywgRmxhc2ggb2JqZWN0cyBkb24ndCBoYXZlIC5nZXRBdHRyaWJ1dGUgKCMxMjk0NSkKCQkJLy8gU3VwcG9ydDogSUU5KwoJCQlpZiAoIHR5cGVvZiBlbGVtLmdldEF0dHJpYnV0ZSAhPT0gY29yZV9zdHJ1bmRlZmluZWQgKSB7CgkJCQlyZXQgPSAgZWxlbS5nZXRBdHRyaWJ1dGUoIG5hbWUgKTsKCQkJfQoKCQkJLy8gTm9uLWV4aXN0ZW50IGF0dHJpYnV0ZXMgcmV0dXJuIG51bGwsIHdlIG5vcm1hbGl6ZSB0byB1bmRlZmluZWQKCQkJcmV0dXJuIHJldCA9PSBudWxsID8KCQkJCXVuZGVmaW5lZCA6CgkJCQlyZXQ7CgkJfQoJfSwKCglyZW1vdmVBdHRyOiBmdW5jdGlvbiggZWxlbSwgdmFsdWUgKSB7CgkJdmFyIG5hbWUsIHByb3BOYW1lLAoJCQlpID0gMCwKCQkJYXR0ck5hbWVzID0gdmFsdWUgJiYgdmFsdWUubWF0Y2goIGNvcmVfcm5vdHdoaXRlICk7CgoJCWlmICggYXR0ck5hbWVzICYmIGVsZW0ubm9kZVR5cGUgPT09IDEgKSB7CgkJCXdoaWxlICggKG5hbWUgPSBhdHRyTmFtZXNbaSsrXSkgKSB7CgkJCQlwcm9wTmFtZSA9IGpRdWVyeS5wcm9wRml4WyBuYW1lIF0gfHwgbmFtZTsKCgkJCQkvLyBCb29sZWFuIGF0dHJpYnV0ZXMgZ2V0IHNwZWNpYWwgdHJlYXRtZW50ICgjMTA4NzApCgkJCQlpZiAoIHJib29sZWFuLnRlc3QoIG5hbWUgKSApIHsKCQkJCQkvLyBTZXQgY29ycmVzcG9uZGluZyBwcm9wZXJ0eSB0byBmYWxzZSBmb3IgYm9vbGVhbiBhdHRyaWJ1dGVzCgkJCQkJLy8gQWxzbyBjbGVhciBkZWZhdWx0Q2hlY2tlZC9kZWZhdWx0U2VsZWN0ZWQgKGlmIGFwcHJvcHJpYXRlKSBmb3IgSUU8OAoJCQkJCWlmICggIWdldFNldEF0dHJpYnV0ZSAmJiBydXNlRGVmYXVsdC50ZXN0KCBuYW1lICkgKSB7CgkJCQkJCWVsZW1bIGpRdWVyeS5jYW1lbENhc2UoICJkZWZhdWx0LSIgKyBuYW1lICkgXSA9CgkJCQkJCQllbGVtWyBwcm9wTmFtZSBdID0gZmFsc2U7CgkJCQkJfSBlbHNlIHsKCQkJCQkJZWxlbVsgcHJvcE5hbWUgXSA9IGZhbHNlOwoJCQkJCX0KCgkJCQkvLyBTZWUgIzk2OTkgZm9yIGV4cGxhbmF0aW9uIG9mIHRoaXMgYXBwcm9hY2ggKHNldHRpbmcgZmlyc3QsIHRoZW4gcmVtb3ZhbCkKCQkJCX0gZWxzZSB7CgkJCQkJalF1ZXJ5LmF0dHIoIGVsZW0sIG5hbWUsICIiICk7CgkJCQl9CgoJCQkJZWxlbS5yZW1vdmVBdHRyaWJ1dGUoIGdldFNldEF0dHJpYnV0ZSA/IG5hbWUgOiBwcm9wTmFtZSApOwoJCQl9CgkJfQoJfSwKCglhdHRySG9va3M6IHsKCQl0eXBlOiB7CgkJCXNldDogZnVuY3Rpb24oIGVsZW0sIHZhbHVlICkgewoJCQkJaWYgKCAhalF1ZXJ5LnN1cHBvcnQucmFkaW9WYWx1ZSAmJiB2YWx1ZSA9PT0gInJhZGlvIiAmJiBqUXVlcnkubm9kZU5hbWUoZWxlbSwgImlucHV0IikgKSB7CgkJCQkJLy8gU2V0dGluZyB0aGUgdHlwZSBvbiBhIHJhZGlvIGJ1dHRvbiBhZnRlciB0aGUgdmFsdWUgcmVzZXRzIHRoZSB2YWx1ZSBpbiBJRTYtOQoJCQkJCS8vIFJlc2V0IHZhbHVlIHRvIGRlZmF1bHQgaW4gY2FzZSB0eXBlIGlzIHNldCBhZnRlciB2YWx1ZSBkdXJpbmcgY3JlYXRpb24KCQkJCQl2YXIgdmFsID0gZWxlbS52YWx1ZTsKCQkJCQllbGVtLnNldEF0dHJpYnV0ZSggInR5cGUiLCB2YWx1ZSApOwoJCQkJCWlmICggdmFsICkgewoJCQkJCQllbGVtLnZhbHVlID0gdmFsOwoJCQkJCX0KCQkJCQlyZXR1cm4gdmFsdWU7CgkJCQl9CgkJCX0KCQl9Cgl9LAoKCXByb3BGaXg6IHsKCQl0YWJpbmRleDogInRhYkluZGV4IiwKCQlyZWFkb25seTogInJlYWRPbmx5IiwKCQkiZm9yIjogImh0bWxGb3IiLAoJCSJjbGFzcyI6ICJjbGFzc05hbWUiLAoJCW1heGxlbmd0aDogIm1heExlbmd0aCIsCgkJY2VsbHNwYWNpbmc6ICJjZWxsU3BhY2luZyIsCgkJY2VsbHBhZGRpbmc6ICJjZWxsUGFkZGluZyIsCgkJcm93c3BhbjogInJvd1NwYW4iLAoJCWNvbHNwYW46ICJjb2xTcGFuIiwKCQl1c2VtYXA6ICJ1c2VNYXAiLAoJCWZyYW1lYm9yZGVyOiAiZnJhbWVCb3JkZXIiLAoJCWNvbnRlbnRlZGl0YWJsZTogImNvbnRlbnRFZGl0YWJsZSIKCX0sCgoJcHJvcDogZnVuY3Rpb24oIGVsZW0sIG5hbWUsIHZhbHVlICkgewoJCXZhciByZXQsIGhvb2tzLCBub3R4bWwsCgkJCW5UeXBlID0gZWxlbS5ub2RlVHlwZTsKCgkJLy8gZG9uJ3QgZ2V0L3NldCBwcm9wZXJ0aWVzIG9uIHRleHQsIGNvbW1lbnQgYW5kIGF0dHJpYnV0ZSBub2RlcwoJCWlmICggIWVsZW0gfHwgblR5cGUgPT09IDMgfHwgblR5cGUgPT09IDggfHwgblR5cGUgPT09IDIgKSB7CgkJCXJldHVybjsKCQl9CgoJCW5vdHhtbCA9IG5UeXBlICE9PSAxIHx8ICFqUXVlcnkuaXNYTUxEb2MoIGVsZW0gKTsKCgkJaWYgKCBub3R4bWwgKSB7CgkJCS8vIEZpeCBuYW1lIGFuZCBhdHRhY2ggaG9va3MKCQkJbmFtZSA9IGpRdWVyeS5wcm9wRml4WyBuYW1lIF0gfHwgbmFtZTsKCQkJaG9va3MgPSBqUXVlcnkucHJvcEhvb2tzWyBuYW1lIF07CgkJfQoKCQlpZiAoIHZhbHVlICE9PSB1bmRlZmluZWQgKSB7CgkJCWlmICggaG9va3MgJiYgInNldCIgaW4gaG9va3MgJiYgKHJldCA9IGhvb2tzLnNldCggZWxlbSwgdmFsdWUsIG5hbWUgKSkgIT09IHVuZGVmaW5lZCApIHsKCQkJCXJldHVybiByZXQ7CgoJCQl9IGVsc2UgewoJCQkJcmV0dXJuICggZWxlbVsgbmFtZSBdID0gdmFsdWUgKTsKCQkJfQoKCQl9IGVsc2UgewoJCQlpZiAoIGhvb2tzICYmICJnZXQiIGluIGhvb2tzICYmIChyZXQgPSBob29rcy5nZXQoIGVsZW0sIG5hbWUgKSkgIT09IG51bGwgKSB7CgkJCQlyZXR1cm4gcmV0OwoKCQkJfSBlbHNlIHsKCQkJCXJldHVybiBlbGVtWyBuYW1lIF07CgkJCX0KCQl9Cgl9LAoKCXByb3BIb29rczogewoJCXRhYkluZGV4OiB7CgkJCWdldDogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCQkvLyBlbGVtLnRhYkluZGV4IGRvZXNuJ3QgYWx3YXlzIHJldHVybiB0aGUgY29ycmVjdCB2YWx1ZSB3aGVuIGl0IGhhc24ndCBiZWVuIGV4cGxpY2l0bHkgc2V0CgkJCQkvLyBodHRwOi8vZmx1aWRwcm9qZWN0Lm9yZy9ibG9nLzIwMDgvMDEvMDkvZ2V0dGluZy1zZXR0aW5nLWFuZC1yZW1vdmluZy10YWJpbmRleC12YWx1ZXMtd2l0aC1qYXZhc2NyaXB0LwoJCQkJdmFyIGF0dHJpYnV0ZU5vZGUgPSBlbGVtLmdldEF0dHJpYnV0ZU5vZGUoInRhYmluZGV4Iik7CgoJCQkJcmV0dXJuIGF0dHJpYnV0ZU5vZGUgJiYgYXR0cmlidXRlTm9kZS5zcGVjaWZpZWQgPwoJCQkJCXBhcnNlSW50KCBhdHRyaWJ1dGVOb2RlLnZhbHVlLCAxMCApIDoKCQkJCQlyZm9jdXNhYmxlLnRlc3QoIGVsZW0ubm9kZU5hbWUgKSB8fCByY2xpY2thYmxlLnRlc3QoIGVsZW0ubm9kZU5hbWUgKSAmJiBlbGVtLmhyZWYgPwoJCQkJCQkwIDoKCQkJCQkJdW5kZWZpbmVkOwoJCQl9CgkJfQoJfQp9KTsKCi8vIEhvb2sgZm9yIGJvb2xlYW4gYXR0cmlidXRlcwpib29sSG9vayA9IHsKCWdldDogZnVuY3Rpb24oIGVsZW0sIG5hbWUgKSB7CgkJdmFyCgkJCS8vIFVzZSAucHJvcCB0byBkZXRlcm1pbmUgaWYgdGhpcyBhdHRyaWJ1dGUgaXMgdW5kZXJzdG9vZCBhcyBib29sZWFuCgkJCXByb3AgPSBqUXVlcnkucHJvcCggZWxlbSwgbmFtZSApLAoKCQkJLy8gRmV0Y2ggaXQgYWNjb3JkaW5nbHkKCQkJYXR0ciA9IHR5cGVvZiBwcm9wID09PSAiYm9vbGVhbiIgJiYgZWxlbS5nZXRBdHRyaWJ1dGUoIG5hbWUgKSwKCQkJZGV0YWlsID0gdHlwZW9mIHByb3AgPT09ICJib29sZWFuIiA/CgoJCQkJZ2V0U2V0SW5wdXQgJiYgZ2V0U2V0QXR0cmlidXRlID8KCQkJCQlhdHRyICE9IG51bGwgOgoJCQkJCS8vIG9sZElFIGZhYnJpY2F0ZXMgYW4gZW1wdHkgc3RyaW5nIGZvciBtaXNzaW5nIGJvb2xlYW4gYXR0cmlidXRlcwoJCQkJCS8vIGFuZCBjb25mbGF0ZXMgY2hlY2tlZC9zZWxlY3RlZCBpbnRvIGF0dHJvcGVydGllcwoJCQkJCXJ1c2VEZWZhdWx0LnRlc3QoIG5hbWUgKSA/CgkJCQkJCWVsZW1bIGpRdWVyeS5jYW1lbENhc2UoICJkZWZhdWx0LSIgKyBuYW1lICkgXSA6CgkJCQkJCSEhYXR0ciA6CgoJCQkJLy8gZmV0Y2ggYW4gYXR0cmlidXRlIG5vZGUgZm9yIHByb3BlcnRpZXMgbm90IHJlY29nbml6ZWQgYXMgYm9vbGVhbgoJCQkJZWxlbS5nZXRBdHRyaWJ1dGVOb2RlKCBuYW1lICk7CgoJCXJldHVybiBkZXRhaWwgJiYgZGV0YWlsLnZhbHVlICE9PSBmYWxzZSA/CgkJCW5hbWUudG9Mb3dlckNhc2UoKSA6CgkJCXVuZGVmaW5lZDsKCX0sCglzZXQ6IGZ1bmN0aW9uKCBlbGVtLCB2YWx1ZSwgbmFtZSApIHsKCQlpZiAoIHZhbHVlID09PSBmYWxzZSApIHsKCQkJLy8gUmVtb3ZlIGJvb2xlYW4gYXR0cmlidXRlcyB3aGVuIHNldCB0byBmYWxzZQoJCQlqUXVlcnkucmVtb3ZlQXR0ciggZWxlbSwgbmFtZSApOwoJCX0gZWxzZSBpZiAoIGdldFNldElucHV0ICYmIGdldFNldEF0dHJpYnV0ZSB8fCAhcnVzZURlZmF1bHQudGVzdCggbmFtZSApICkgewoJCQkvLyBJRTw4IG5lZWRzIHRoZSAqcHJvcGVydHkqIG5hbWUKCQkJZWxlbS5zZXRBdHRyaWJ1dGUoICFnZXRTZXRBdHRyaWJ1dGUgJiYgalF1ZXJ5LnByb3BGaXhbIG5hbWUgXSB8fCBuYW1lLCBuYW1lICk7CgoJCS8vIFVzZSBkZWZhdWx0Q2hlY2tlZCBhbmQgZGVmYXVsdFNlbGVjdGVkIGZvciBvbGRJRQoJCX0gZWxzZSB7CgkJCWVsZW1bIGpRdWVyeS5jYW1lbENhc2UoICJkZWZhdWx0LSIgKyBuYW1lICkgXSA9IGVsZW1bIG5hbWUgXSA9IHRydWU7CgkJfQoKCQlyZXR1cm4gbmFtZTsKCX0KfTsKCi8vIGZpeCBvbGRJRSB2YWx1ZSBhdHRyb3BlcnR5CmlmICggIWdldFNldElucHV0IHx8ICFnZXRTZXRBdHRyaWJ1dGUgKSB7CglqUXVlcnkuYXR0ckhvb2tzLnZhbHVlID0gewoJCWdldDogZnVuY3Rpb24oIGVsZW0sIG5hbWUgKSB7CgkJCXZhciByZXQgPSBlbGVtLmdldEF0dHJpYnV0ZU5vZGUoIG5hbWUgKTsKCQkJcmV0dXJuIGpRdWVyeS5ub2RlTmFtZSggZWxlbSwgImlucHV0IiApID8KCgkJCQkvLyBJZ25vcmUgdGhlIHZhbHVlICpwcm9wZXJ0eSogYnkgdXNpbmcgZGVmYXVsdFZhbHVlCgkJCQllbGVtLmRlZmF1bHRWYWx1ZSA6CgoJCQkJcmV0ICYmIHJldC5zcGVjaWZpZWQgPyByZXQudmFsdWUgOiB1bmRlZmluZWQ7CgkJfSwKCQlzZXQ6IGZ1bmN0aW9uKCBlbGVtLCB2YWx1ZSwgbmFtZSApIHsKCQkJaWYgKCBqUXVlcnkubm9kZU5hbWUoIGVsZW0sICJpbnB1dCIgKSApIHsKCQkJCS8vIERvZXMgbm90IHJldHVybiBzbyB0aGF0IHNldEF0dHJpYnV0ZSBpcyBhbHNvIHVzZWQKCQkJCWVsZW0uZGVmYXVsdFZhbHVlID0gdmFsdWU7CgkJCX0gZWxzZSB7CgkJCQkvLyBVc2Ugbm9kZUhvb2sgaWYgZGVmaW5lZCAoIzE5NTQpOyBvdGhlcndpc2Ugc2V0QXR0cmlidXRlIGlzIGZpbmUKCQkJCXJldHVybiBub2RlSG9vayAmJiBub2RlSG9vay5zZXQoIGVsZW0sIHZhbHVlLCBuYW1lICk7CgkJCX0KCQl9Cgl9Owp9CgovLyBJRTYvNyBkbyBub3Qgc3VwcG9ydCBnZXR0aW5nL3NldHRpbmcgc29tZSBhdHRyaWJ1dGVzIHdpdGggZ2V0L3NldEF0dHJpYnV0ZQppZiAoICFnZXRTZXRBdHRyaWJ1dGUgKSB7CgoJLy8gVXNlIHRoaXMgZm9yIGFueSBhdHRyaWJ1dGUgaW4gSUU2LzcKCS8vIFRoaXMgZml4ZXMgYWxtb3N0IGV2ZXJ5IElFNi83IGlzc3VlCglub2RlSG9vayA9IGpRdWVyeS52YWxIb29rcy5idXR0b24gPSB7CgkJZ2V0OiBmdW5jdGlvbiggZWxlbSwgbmFtZSApIHsKCQkJdmFyIHJldCA9IGVsZW0uZ2V0QXR0cmlidXRlTm9kZSggbmFtZSApOwoJCQlyZXR1cm4gcmV0ICYmICggbmFtZSA9PT0gImlkIiB8fCBuYW1lID09PSAibmFtZSIgfHwgbmFtZSA9PT0gImNvb3JkcyIgPyByZXQudmFsdWUgIT09ICIiIDogcmV0LnNwZWNpZmllZCApID8KCQkJCXJldC52YWx1ZSA6CgkJCQl1bmRlZmluZWQ7CgkJfSwKCQlzZXQ6IGZ1bmN0aW9uKCBlbGVtLCB2YWx1ZSwgbmFtZSApIHsKCQkJLy8gU2V0IHRoZSBleGlzdGluZyBvciBjcmVhdGUgYSBuZXcgYXR0cmlidXRlIG5vZGUKCQkJdmFyIHJldCA9IGVsZW0uZ2V0QXR0cmlidXRlTm9kZSggbmFtZSApOwoJCQlpZiAoICFyZXQgKSB7CgkJCQllbGVtLnNldEF0dHJpYnV0ZU5vZGUoCgkJCQkJKHJldCA9IGVsZW0ub3duZXJEb2N1bWVudC5jcmVhdGVBdHRyaWJ1dGUoIG5hbWUgKSkKCQkJCSk7CgkJCX0KCgkJCXJldC52YWx1ZSA9IHZhbHVlICs9ICIiOwoKCQkJLy8gQnJlYWsgYXNzb2NpYXRpb24gd2l0aCBjbG9uZWQgZWxlbWVudHMgYnkgYWxzbyB1c2luZyBzZXRBdHRyaWJ1dGUgKCM5NjQ2KQoJCQlyZXR1cm4gbmFtZSA9PT0gInZhbHVlIiB8fCB2YWx1ZSA9PT0gZWxlbS5nZXRBdHRyaWJ1dGUoIG5hbWUgKSA/CgkJCQl2YWx1ZSA6CgkJCQl1bmRlZmluZWQ7CgkJfQoJfTsKCgkvLyBTZXQgY29udGVudGVkaXRhYmxlIHRvIGZhbHNlIG9uIHJlbW92YWxzKCMxMDQyOSkKCS8vIFNldHRpbmcgdG8gZW1wdHkgc3RyaW5nIHRocm93cyBhbiBlcnJvciBhcyBhbiBpbnZhbGlkIHZhbHVlCglqUXVlcnkuYXR0ckhvb2tzLmNvbnRlbnRlZGl0YWJsZSA9IHsKCQlnZXQ6IG5vZGVIb29rLmdldCwKCQlzZXQ6IGZ1bmN0aW9uKCBlbGVtLCB2YWx1ZSwgbmFtZSApIHsKCQkJbm9kZUhvb2suc2V0KCBlbGVtLCB2YWx1ZSA9PT0gIiIgPyBmYWxzZSA6IHZhbHVlLCBuYW1lICk7CgkJfQoJfTsKCgkvLyBTZXQgd2lkdGggYW5kIGhlaWdodCB0byBhdXRvIGluc3RlYWQgb2YgMCBvbiBlbXB0eSBzdHJpbmcoIEJ1ZyAjODE1MCApCgkvLyBUaGlzIGlzIGZvciByZW1vdmFscwoJalF1ZXJ5LmVhY2goWyAid2lkdGgiLCAiaGVpZ2h0IiBdLCBmdW5jdGlvbiggaSwgbmFtZSApIHsKCQlqUXVlcnkuYXR0ckhvb2tzWyBuYW1lIF0gPSBqUXVlcnkuZXh0ZW5kKCBqUXVlcnkuYXR0ckhvb2tzWyBuYW1lIF0sIHsKCQkJc2V0OiBmdW5jdGlvbiggZWxlbSwgdmFsdWUgKSB7CgkJCQlpZiAoIHZhbHVlID09PSAiIiApIHsKCQkJCQllbGVtLnNldEF0dHJpYnV0ZSggbmFtZSwgImF1dG8iICk7CgkJCQkJcmV0dXJuIHZhbHVlOwoJCQkJfQoJCQl9CgkJfSk7Cgl9KTsKfQoKCi8vIFNvbWUgYXR0cmlidXRlcyByZXF1aXJlIGEgc3BlY2lhbCBjYWxsIG9uIElFCi8vIGh0dHA6Ly9tc2RuLm1pY3Jvc29mdC5jb20vZW4tdXMvbGlicmFyeS9tczUzNjQyOSUyOFZTLjg1JTI5LmFzcHgKaWYgKCAhalF1ZXJ5LnN1cHBvcnQuaHJlZk5vcm1hbGl6ZWQgKSB7CglqUXVlcnkuZWFjaChbICJocmVmIiwgInNyYyIsICJ3aWR0aCIsICJoZWlnaHQiIF0sIGZ1bmN0aW9uKCBpLCBuYW1lICkgewoJCWpRdWVyeS5hdHRySG9va3NbIG5hbWUgXSA9IGpRdWVyeS5leHRlbmQoIGpRdWVyeS5hdHRySG9va3NbIG5hbWUgXSwgewoJCQlnZXQ6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJdmFyIHJldCA9IGVsZW0uZ2V0QXR0cmlidXRlKCBuYW1lLCAyICk7CgkJCQlyZXR1cm4gcmV0ID09IG51bGwgPyB1bmRlZmluZWQgOiByZXQ7CgkJCX0KCQl9KTsKCX0pOwoKCS8vIGhyZWYvc3JjIHByb3BlcnR5IHNob3VsZCBnZXQgdGhlIGZ1bGwgbm9ybWFsaXplZCBVUkwgKCMxMDI5OS8jMTI5MTUpCglqUXVlcnkuZWFjaChbICJocmVmIiwgInNyYyIgXSwgZnVuY3Rpb24oIGksIG5hbWUgKSB7CgkJalF1ZXJ5LnByb3BIb29rc1sgbmFtZSBdID0gewoJCQlnZXQ6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJcmV0dXJuIGVsZW0uZ2V0QXR0cmlidXRlKCBuYW1lLCA0ICk7CgkJCX0KCQl9OwoJfSk7Cn0KCmlmICggIWpRdWVyeS5zdXBwb3J0LnN0eWxlICkgewoJalF1ZXJ5LmF0dHJIb29rcy5zdHlsZSA9IHsKCQlnZXQ6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQkvLyBSZXR1cm4gdW5kZWZpbmVkIGluIHRoZSBjYXNlIG9mIGVtcHR5IHN0cmluZwoJCQkvLyBOb3RlOiBJRSB1cHBlcmNhc2VzIGNzcyBwcm9wZXJ0eSBuYW1lcywgYnV0IGlmIHdlIHdlcmUgdG8gLnRvTG93ZXJDYXNlKCkKCQkJLy8gLmNzc1RleHQsIHRoYXQgd291bGQgZGVzdHJveSBjYXNlIHNlbnN0aXRpdml0eSBpbiBVUkwncywgbGlrZSBpbiAiYmFja2dyb3VuZCIKCQkJcmV0dXJuIGVsZW0uc3R5bGUuY3NzVGV4dCB8fCB1bmRlZmluZWQ7CgkJfSwKCQlzZXQ6IGZ1bmN0aW9uKCBlbGVtLCB2YWx1ZSApIHsKCQkJcmV0dXJuICggZWxlbS5zdHlsZS5jc3NUZXh0ID0gdmFsdWUgKyAiIiApOwoJCX0KCX07Cn0KCi8vIFNhZmFyaSBtaXMtcmVwb3J0cyB0aGUgZGVmYXVsdCBzZWxlY3RlZCBwcm9wZXJ0eSBvZiBhbiBvcHRpb24KLy8gQWNjZXNzaW5nIHRoZSBwYXJlbnQncyBzZWxlY3RlZEluZGV4IHByb3BlcnR5IGZpeGVzIGl0CmlmICggIWpRdWVyeS5zdXBwb3J0Lm9wdFNlbGVjdGVkICkgewoJalF1ZXJ5LnByb3BIb29rcy5zZWxlY3RlZCA9IGpRdWVyeS5leHRlbmQoIGpRdWVyeS5wcm9wSG9va3Muc2VsZWN0ZWQsIHsKCQlnZXQ6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQl2YXIgcGFyZW50ID0gZWxlbS5wYXJlbnROb2RlOwoKCQkJaWYgKCBwYXJlbnQgKSB7CgkJCQlwYXJlbnQuc2VsZWN0ZWRJbmRleDsKCgkJCQkvLyBNYWtlIHN1cmUgdGhhdCBpdCBhbHNvIHdvcmtzIHdpdGggb3B0Z3JvdXBzLCBzZWUgIzU3MDEKCQkJCWlmICggcGFyZW50LnBhcmVudE5vZGUgKSB7CgkJCQkJcGFyZW50LnBhcmVudE5vZGUuc2VsZWN0ZWRJbmRleDsKCQkJCX0KCQkJfQoJCQlyZXR1cm4gbnVsbDsKCQl9Cgl9KTsKfQoKLy8gSUU2LzcgY2FsbCBlbmN0eXBlIGVuY29kaW5nCmlmICggIWpRdWVyeS5zdXBwb3J0LmVuY3R5cGUgKSB7CglqUXVlcnkucHJvcEZpeC5lbmN0eXBlID0gImVuY29kaW5nIjsKfQoKLy8gUmFkaW9zIGFuZCBjaGVja2JveGVzIGdldHRlci9zZXR0ZXIKaWYgKCAhalF1ZXJ5LnN1cHBvcnQuY2hlY2tPbiApIHsKCWpRdWVyeS5lYWNoKFsgInJhZGlvIiwgImNoZWNrYm94IiBdLCBmdW5jdGlvbigpIHsKCQlqUXVlcnkudmFsSG9va3NbIHRoaXMgXSA9IHsKCQkJZ2V0OiBmdW5jdGlvbiggZWxlbSApIHsKCQkJCS8vIEhhbmRsZSB0aGUgY2FzZSB3aGVyZSBpbiBXZWJraXQgIiIgaXMgcmV0dXJuZWQgaW5zdGVhZCBvZiAib24iIGlmIGEgdmFsdWUgaXNuJ3Qgc3BlY2lmaWVkCgkJCQlyZXR1cm4gZWxlbS5nZXRBdHRyaWJ1dGUoInZhbHVlIikgPT09IG51bGwgPyAib24iIDogZWxlbS52YWx1ZTsKCQkJfQoJCX07Cgl9KTsKfQpqUXVlcnkuZWFjaChbICJyYWRpbyIsICJjaGVja2JveCIgXSwgZnVuY3Rpb24oKSB7CglqUXVlcnkudmFsSG9va3NbIHRoaXMgXSA9IGpRdWVyeS5leHRlbmQoIGpRdWVyeS52YWxIb29rc1sgdGhpcyBdLCB7CgkJc2V0OiBmdW5jdGlvbiggZWxlbSwgdmFsdWUgKSB7CgkJCWlmICggalF1ZXJ5LmlzQXJyYXkoIHZhbHVlICkgKSB7CgkJCQlyZXR1cm4gKCBlbGVtLmNoZWNrZWQgPSBqUXVlcnkuaW5BcnJheSggalF1ZXJ5KGVsZW0pLnZhbCgpLCB2YWx1ZSApID49IDAgKTsKCQkJfQoJCX0KCX0pOwp9KTsKdmFyIHJmb3JtRWxlbXMgPSAvXig/OmlucHV0fHNlbGVjdHx0ZXh0YXJlYSkkL2ksCglya2V5RXZlbnQgPSAvXmtleS8sCglybW91c2VFdmVudCA9IC9eKD86bW91c2V8Y29udGV4dG1lbnUpfGNsaWNrLywKCXJmb2N1c01vcnBoID0gL14oPzpmb2N1c2luZm9jdXN8Zm9jdXNvdXRibHVyKSQvLAoJcnR5cGVuYW1lc3BhY2UgPSAvXihbXi5dKikoPzpcLiguKyl8KSQvOwoKZnVuY3Rpb24gcmV0dXJuVHJ1ZSgpIHsKCXJldHVybiB0cnVlOwp9CgpmdW5jdGlvbiByZXR1cm5GYWxzZSgpIHsKCXJldHVybiBmYWxzZTsKfQoKLyoKICogSGVscGVyIGZ1bmN0aW9ucyBmb3IgbWFuYWdpbmcgZXZlbnRzIC0tIG5vdCBwYXJ0IG9mIHRoZSBwdWJsaWMgaW50ZXJmYWNlLgogKiBQcm9wcyB0byBEZWFuIEVkd2FyZHMnIGFkZEV2ZW50IGxpYnJhcnkgZm9yIG1hbnkgb2YgdGhlIGlkZWFzLgogKi8KalF1ZXJ5LmV2ZW50ID0gewoKCWdsb2JhbDoge30sCgoJYWRkOiBmdW5jdGlvbiggZWxlbSwgdHlwZXMsIGhhbmRsZXIsIGRhdGEsIHNlbGVjdG9yICkgewoJCXZhciB0bXAsIGV2ZW50cywgdCwgaGFuZGxlT2JqSW4sCgkJCXNwZWNpYWwsIGV2ZW50SGFuZGxlLCBoYW5kbGVPYmosCgkJCWhhbmRsZXJzLCB0eXBlLCBuYW1lc3BhY2VzLCBvcmlnVHlwZSwKCQkJZWxlbURhdGEgPSBqUXVlcnkuX2RhdGEoIGVsZW0gKTsKCgkJLy8gRG9uJ3QgYXR0YWNoIGV2ZW50cyB0byBub0RhdGEgb3IgdGV4dC9jb21tZW50IG5vZGVzIChidXQgYWxsb3cgcGxhaW4gb2JqZWN0cykKCQlpZiAoICFlbGVtRGF0YSApIHsKCQkJcmV0dXJuOwoJCX0KCgkJLy8gQ2FsbGVyIGNhbiBwYXNzIGluIGFuIG9iamVjdCBvZiBjdXN0b20gZGF0YSBpbiBsaWV1IG9mIHRoZSBoYW5kbGVyCgkJaWYgKCBoYW5kbGVyLmhhbmRsZXIgKSB7CgkJCWhhbmRsZU9iakluID0gaGFuZGxlcjsKCQkJaGFuZGxlciA9IGhhbmRsZU9iakluLmhhbmRsZXI7CgkJCXNlbGVjdG9yID0gaGFuZGxlT2JqSW4uc2VsZWN0b3I7CgkJfQoKCQkvLyBNYWtlIHN1cmUgdGhhdCB0aGUgaGFuZGxlciBoYXMgYSB1bmlxdWUgSUQsIHVzZWQgdG8gZmluZC9yZW1vdmUgaXQgbGF0ZXIKCQlpZiAoICFoYW5kbGVyLmd1aWQgKSB7CgkJCWhhbmRsZXIuZ3VpZCA9IGpRdWVyeS5ndWlkKys7CgkJfQoKCQkvLyBJbml0IHRoZSBlbGVtZW50J3MgZXZlbnQgc3RydWN0dXJlIGFuZCBtYWluIGhhbmRsZXIsIGlmIHRoaXMgaXMgdGhlIGZpcnN0CgkJaWYgKCAhKGV2ZW50cyA9IGVsZW1EYXRhLmV2ZW50cykgKSB7CgkJCWV2ZW50cyA9IGVsZW1EYXRhLmV2ZW50cyA9IHt9OwoJCX0KCQlpZiAoICEoZXZlbnRIYW5kbGUgPSBlbGVtRGF0YS5oYW5kbGUpICkgewoJCQlldmVudEhhbmRsZSA9IGVsZW1EYXRhLmhhbmRsZSA9IGZ1bmN0aW9uKCBlICkgewoJCQkJLy8gRGlzY2FyZCB0aGUgc2Vjb25kIGV2ZW50IG9mIGEgalF1ZXJ5LmV2ZW50LnRyaWdnZXIoKSBhbmQKCQkJCS8vIHdoZW4gYW4gZXZlbnQgaXMgY2FsbGVkIGFmdGVyIGEgcGFnZSBoYXMgdW5sb2FkZWQKCQkJCXJldHVybiB0eXBlb2YgalF1ZXJ5ICE9PSBjb3JlX3N0cnVuZGVmaW5lZCAmJiAoIWUgfHwgalF1ZXJ5LmV2ZW50LnRyaWdnZXJlZCAhPT0gZS50eXBlKSA/CgkJCQkJalF1ZXJ5LmV2ZW50LmRpc3BhdGNoLmFwcGx5KCBldmVudEhhbmRsZS5lbGVtLCBhcmd1bWVudHMgKSA6CgkJCQkJdW5kZWZpbmVkOwoJCQl9OwoJCQkvLyBBZGQgZWxlbSBhcyBhIHByb3BlcnR5IG9mIHRoZSBoYW5kbGUgZm4gdG8gcHJldmVudCBhIG1lbW9yeSBsZWFrIHdpdGggSUUgbm9uLW5hdGl2ZSBldmVudHMKCQkJZXZlbnRIYW5kbGUuZWxlbSA9IGVsZW07CgkJfQoKCQkvLyBIYW5kbGUgbXVsdGlwbGUgZXZlbnRzIHNlcGFyYXRlZCBieSBhIHNwYWNlCgkJLy8galF1ZXJ5KC4uLikuYmluZCgibW91c2VvdmVyIG1vdXNlb3V0IiwgZm4pOwoJCXR5cGVzID0gKCB0eXBlcyB8fCAiIiApLm1hdGNoKCBjb3JlX3Jub3R3aGl0ZSApIHx8IFsiIl07CgkJdCA9IHR5cGVzLmxlbmd0aDsKCQl3aGlsZSAoIHQtLSApIHsKCQkJdG1wID0gcnR5cGVuYW1lc3BhY2UuZXhlYyggdHlwZXNbdF0gKSB8fCBbXTsKCQkJdHlwZSA9IG9yaWdUeXBlID0gdG1wWzFdOwoJCQluYW1lc3BhY2VzID0gKCB0bXBbMl0gfHwgIiIgKS5zcGxpdCggIi4iICkuc29ydCgpOwoKCQkJLy8gSWYgZXZlbnQgY2hhbmdlcyBpdHMgdHlwZSwgdXNlIHRoZSBzcGVjaWFsIGV2ZW50IGhhbmRsZXJzIGZvciB0aGUgY2hhbmdlZCB0eXBlCgkJCXNwZWNpYWwgPSBqUXVlcnkuZXZlbnQuc3BlY2lhbFsgdHlwZSBdIHx8IHt9OwoKCQkJLy8gSWYgc2VsZWN0b3IgZGVmaW5lZCwgZGV0ZXJtaW5lIHNwZWNpYWwgZXZlbnQgYXBpIHR5cGUsIG90aGVyd2lzZSBnaXZlbiB0eXBlCgkJCXR5cGUgPSAoIHNlbGVjdG9yID8gc3BlY2lhbC5kZWxlZ2F0ZVR5cGUgOiBzcGVjaWFsLmJpbmRUeXBlICkgfHwgdHlwZTsKCgkJCS8vIFVwZGF0ZSBzcGVjaWFsIGJhc2VkIG9uIG5ld2x5IHJlc2V0IHR5cGUKCQkJc3BlY2lhbCA9IGpRdWVyeS5ldmVudC5zcGVjaWFsWyB0eXBlIF0gfHwge307CgoJCQkvLyBoYW5kbGVPYmogaXMgcGFzc2VkIHRvIGFsbCBldmVudCBoYW5kbGVycwoJCQloYW5kbGVPYmogPSBqUXVlcnkuZXh0ZW5kKHsKCQkJCXR5cGU6IHR5cGUsCgkJCQlvcmlnVHlwZTogb3JpZ1R5cGUsCgkJCQlkYXRhOiBkYXRhLAoJCQkJaGFuZGxlcjogaGFuZGxlciwKCQkJCWd1aWQ6IGhhbmRsZXIuZ3VpZCwKCQkJCXNlbGVjdG9yOiBzZWxlY3RvciwKCQkJCW5lZWRzQ29udGV4dDogc2VsZWN0b3IgJiYgalF1ZXJ5LmV4cHIubWF0Y2gubmVlZHNDb250ZXh0LnRlc3QoIHNlbGVjdG9yICksCgkJCQluYW1lc3BhY2U6IG5hbWVzcGFjZXMuam9pbigiLiIpCgkJCX0sIGhhbmRsZU9iakluICk7CgoJCQkvLyBJbml0IHRoZSBldmVudCBoYW5kbGVyIHF1ZXVlIGlmIHdlJ3JlIHRoZSBmaXJzdAoJCQlpZiAoICEoaGFuZGxlcnMgPSBldmVudHNbIHR5cGUgXSkgKSB7CgkJCQloYW5kbGVycyA9IGV2ZW50c1sgdHlwZSBdID0gW107CgkJCQloYW5kbGVycy5kZWxlZ2F0ZUNvdW50ID0gMDsKCgkJCQkvLyBPbmx5IHVzZSBhZGRFdmVudExpc3RlbmVyL2F0dGFjaEV2ZW50IGlmIHRoZSBzcGVjaWFsIGV2ZW50cyBoYW5kbGVyIHJldHVybnMgZmFsc2UKCQkJCWlmICggIXNwZWNpYWwuc2V0dXAgfHwgc3BlY2lhbC5zZXR1cC5jYWxsKCBlbGVtLCBkYXRhLCBuYW1lc3BhY2VzLCBldmVudEhhbmRsZSApID09PSBmYWxzZSApIHsKCQkJCQkvLyBCaW5kIHRoZSBnbG9iYWwgZXZlbnQgaGFuZGxlciB0byB0aGUgZWxlbWVudAoJCQkJCWlmICggZWxlbS5hZGRFdmVudExpc3RlbmVyICkgewoJCQkJCQllbGVtLmFkZEV2ZW50TGlzdGVuZXIoIHR5cGUsIGV2ZW50SGFuZGxlLCBmYWxzZSApOwoKCQkJCQl9IGVsc2UgaWYgKCBlbGVtLmF0dGFjaEV2ZW50ICkgewoJCQkJCQllbGVtLmF0dGFjaEV2ZW50KCAib24iICsgdHlwZSwgZXZlbnRIYW5kbGUgKTsKCQkJCQl9CgkJCQl9CgkJCX0KCgkJCWlmICggc3BlY2lhbC5hZGQgKSB7CgkJCQlzcGVjaWFsLmFkZC5jYWxsKCBlbGVtLCBoYW5kbGVPYmogKTsKCgkJCQlpZiAoICFoYW5kbGVPYmouaGFuZGxlci5ndWlkICkgewoJCQkJCWhhbmRsZU9iai5oYW5kbGVyLmd1aWQgPSBoYW5kbGVyLmd1aWQ7CgkJCQl9CgkJCX0KCgkJCS8vIEFkZCB0byB0aGUgZWxlbWVudCdzIGhhbmRsZXIgbGlzdCwgZGVsZWdhdGVzIGluIGZyb250CgkJCWlmICggc2VsZWN0b3IgKSB7CgkJCQloYW5kbGVycy5zcGxpY2UoIGhhbmRsZXJzLmRlbGVnYXRlQ291bnQrKywgMCwgaGFuZGxlT2JqICk7CgkJCX0gZWxzZSB7CgkJCQloYW5kbGVycy5wdXNoKCBoYW5kbGVPYmogKTsKCQkJfQoKCQkJLy8gS2VlcCB0cmFjayBvZiB3aGljaCBldmVudHMgaGF2ZSBldmVyIGJlZW4gdXNlZCwgZm9yIGV2ZW50IG9wdGltaXphdGlvbgoJCQlqUXVlcnkuZXZlbnQuZ2xvYmFsWyB0eXBlIF0gPSB0cnVlOwoJCX0KCgkJLy8gTnVsbGlmeSBlbGVtIHRvIHByZXZlbnQgbWVtb3J5IGxlYWtzIGluIElFCgkJZWxlbSA9IG51bGw7Cgl9LAoKCS8vIERldGFjaCBhbiBldmVudCBvciBzZXQgb2YgZXZlbnRzIGZyb20gYW4gZWxlbWVudAoJcmVtb3ZlOiBmdW5jdGlvbiggZWxlbSwgdHlwZXMsIGhhbmRsZXIsIHNlbGVjdG9yLCBtYXBwZWRUeXBlcyApIHsKCQl2YXIgaiwgaGFuZGxlT2JqLCB0bXAsCgkJCW9yaWdDb3VudCwgdCwgZXZlbnRzLAoJCQlzcGVjaWFsLCBoYW5kbGVycywgdHlwZSwKCQkJbmFtZXNwYWNlcywgb3JpZ1R5cGUsCgkJCWVsZW1EYXRhID0galF1ZXJ5Lmhhc0RhdGEoIGVsZW0gKSAmJiBqUXVlcnkuX2RhdGEoIGVsZW0gKTsKCgkJaWYgKCAhZWxlbURhdGEgfHwgIShldmVudHMgPSBlbGVtRGF0YS5ldmVudHMpICkgewoJCQlyZXR1cm47CgkJfQoKCQkvLyBPbmNlIGZvciBlYWNoIHR5cGUubmFtZXNwYWNlIGluIHR5cGVzOyB0eXBlIG1heSBiZSBvbWl0dGVkCgkJdHlwZXMgPSAoIHR5cGVzIHx8ICIiICkubWF0Y2goIGNvcmVfcm5vdHdoaXRlICkgfHwgWyIiXTsKCQl0ID0gdHlwZXMubGVuZ3RoOwoJCXdoaWxlICggdC0tICkgewoJCQl0bXAgPSBydHlwZW5hbWVzcGFjZS5leGVjKCB0eXBlc1t0XSApIHx8IFtdOwoJCQl0eXBlID0gb3JpZ1R5cGUgPSB0bXBbMV07CgkJCW5hbWVzcGFjZXMgPSAoIHRtcFsyXSB8fCAiIiApLnNwbGl0KCAiLiIgKS5zb3J0KCk7CgoJCQkvLyBVbmJpbmQgYWxsIGV2ZW50cyAob24gdGhpcyBuYW1lc3BhY2UsIGlmIHByb3ZpZGVkKSBmb3IgdGhlIGVsZW1lbnQKCQkJaWYgKCAhdHlwZSApIHsKCQkJCWZvciAoIHR5cGUgaW4gZXZlbnRzICkgewoJCQkJCWpRdWVyeS5ldmVudC5yZW1vdmUoIGVsZW0sIHR5cGUgKyB0eXBlc1sgdCBdLCBoYW5kbGVyLCBzZWxlY3RvciwgdHJ1ZSApOwoJCQkJfQoJCQkJY29udGludWU7CgkJCX0KCgkJCXNwZWNpYWwgPSBqUXVlcnkuZXZlbnQuc3BlY2lhbFsgdHlwZSBdIHx8IHt9OwoJCQl0eXBlID0gKCBzZWxlY3RvciA/IHNwZWNpYWwuZGVsZWdhdGVUeXBlIDogc3BlY2lhbC5iaW5kVHlwZSApIHx8IHR5cGU7CgkJCWhhbmRsZXJzID0gZXZlbnRzWyB0eXBlIF0gfHwgW107CgkJCXRtcCA9IHRtcFsyXSAmJiBuZXcgUmVnRXhwKCAiKF58XFwuKSIgKyBuYW1lc3BhY2VzLmpvaW4oIlxcLig/Oi4qXFwufCkiKSArICIoXFwufCQpIiApOwoKCQkJLy8gUmVtb3ZlIG1hdGNoaW5nIGV2ZW50cwoJCQlvcmlnQ291bnQgPSBqID0gaGFuZGxlcnMubGVuZ3RoOwoJCQl3aGlsZSAoIGotLSApIHsKCQkJCWhhbmRsZU9iaiA9IGhhbmRsZXJzWyBqIF07CgoJCQkJaWYgKCAoIG1hcHBlZFR5cGVzIHx8IG9yaWdUeXBlID09PSBoYW5kbGVPYmoub3JpZ1R5cGUgKSAmJgoJCQkJCSggIWhhbmRsZXIgfHwgaGFuZGxlci5ndWlkID09PSBoYW5kbGVPYmouZ3VpZCApICYmCgkJCQkJKCAhdG1wIHx8IHRtcC50ZXN0KCBoYW5kbGVPYmoubmFtZXNwYWNlICkgKSAmJgoJCQkJCSggIXNlbGVjdG9yIHx8IHNlbGVjdG9yID09PSBoYW5kbGVPYmouc2VsZWN0b3IgfHwgc2VsZWN0b3IgPT09ICIqKiIgJiYgaGFuZGxlT2JqLnNlbGVjdG9yICkgKSB7CgkJCQkJaGFuZGxlcnMuc3BsaWNlKCBqLCAxICk7CgoJCQkJCWlmICggaGFuZGxlT2JqLnNlbGVjdG9yICkgewoJCQkJCQloYW5kbGVycy5kZWxlZ2F0ZUNvdW50LS07CgkJCQkJfQoJCQkJCWlmICggc3BlY2lhbC5yZW1vdmUgKSB7CgkJCQkJCXNwZWNpYWwucmVtb3ZlLmNhbGwoIGVsZW0sIGhhbmRsZU9iaiApOwoJCQkJCX0KCQkJCX0KCQkJfQoKCQkJLy8gUmVtb3ZlIGdlbmVyaWMgZXZlbnQgaGFuZGxlciBpZiB3ZSByZW1vdmVkIHNvbWV0aGluZyBhbmQgbm8gbW9yZSBoYW5kbGVycyBleGlzdAoJCQkvLyAoYXZvaWRzIHBvdGVudGlhbCBmb3IgZW5kbGVzcyByZWN1cnNpb24gZHVyaW5nIHJlbW92YWwgb2Ygc3BlY2lhbCBldmVudCBoYW5kbGVycykKCQkJaWYgKCBvcmlnQ291bnQgJiYgIWhhbmRsZXJzLmxlbmd0aCApIHsKCQkJCWlmICggIXNwZWNpYWwudGVhcmRvd24gfHwgc3BlY2lhbC50ZWFyZG93bi5jYWxsKCBlbGVtLCBuYW1lc3BhY2VzLCBlbGVtRGF0YS5oYW5kbGUgKSA9PT0gZmFsc2UgKSB7CgkJCQkJalF1ZXJ5LnJlbW92ZUV2ZW50KCBlbGVtLCB0eXBlLCBlbGVtRGF0YS5oYW5kbGUgKTsKCQkJCX0KCgkJCQlkZWxldGUgZXZlbnRzWyB0eXBlIF07CgkJCX0KCQl9CgoJCS8vIFJlbW92ZSB0aGUgZXhwYW5kbyBpZiBpdCdzIG5vIGxvbmdlciB1c2VkCgkJaWYgKCBqUXVlcnkuaXNFbXB0eU9iamVjdCggZXZlbnRzICkgKSB7CgkJCWRlbGV0ZSBlbGVtRGF0YS5oYW5kbGU7CgoJCQkvLyByZW1vdmVEYXRhIGFsc28gY2hlY2tzIGZvciBlbXB0aW5lc3MgYW5kIGNsZWFycyB0aGUgZXhwYW5kbyBpZiBlbXB0eQoJCQkvLyBzbyB1c2UgaXQgaW5zdGVhZCBvZiBkZWxldGUKCQkJalF1ZXJ5Ll9yZW1vdmVEYXRhKCBlbGVtLCAiZXZlbnRzIiApOwoJCX0KCX0sCgoJdHJpZ2dlcjogZnVuY3Rpb24oIGV2ZW50LCBkYXRhLCBlbGVtLCBvbmx5SGFuZGxlcnMgKSB7CgkJdmFyIGhhbmRsZSwgb250eXBlLCBjdXIsCgkJCWJ1YmJsZVR5cGUsIHNwZWNpYWwsIHRtcCwgaSwKCQkJZXZlbnRQYXRoID0gWyBlbGVtIHx8IGRvY3VtZW50IF0sCgkJCXR5cGUgPSBjb3JlX2hhc093bi5jYWxsKCBldmVudCwgInR5cGUiICkgPyBldmVudC50eXBlIDogZXZlbnQsCgkJCW5hbWVzcGFjZXMgPSBjb3JlX2hhc093bi5jYWxsKCBldmVudCwgIm5hbWVzcGFjZSIgKSA/IGV2ZW50Lm5hbWVzcGFjZS5zcGxpdCgiLiIpIDogW107CgoJCWN1ciA9IHRtcCA9IGVsZW0gPSBlbGVtIHx8IGRvY3VtZW50OwoKCQkvLyBEb24ndCBkbyBldmVudHMgb24gdGV4dCBhbmQgY29tbWVudCBub2RlcwoJCWlmICggZWxlbS5ub2RlVHlwZSA9PT0gMyB8fCBlbGVtLm5vZGVUeXBlID09PSA4ICkgewoJCQlyZXR1cm47CgkJfQoKCQkvLyBmb2N1cy9ibHVyIG1vcnBocyB0byBmb2N1c2luL291dDsgZW5zdXJlIHdlJ3JlIG5vdCBmaXJpbmcgdGhlbSByaWdodCBub3cKCQlpZiAoIHJmb2N1c01vcnBoLnRlc3QoIHR5cGUgKyBqUXVlcnkuZXZlbnQudHJpZ2dlcmVkICkgKSB7CgkJCXJldHVybjsKCQl9CgoJCWlmICggdHlwZS5pbmRleE9mKCIuIikgPj0gMCApIHsKCQkJLy8gTmFtZXNwYWNlZCB0cmlnZ2VyOyBjcmVhdGUgYSByZWdleHAgdG8gbWF0Y2ggZXZlbnQgdHlwZSBpbiBoYW5kbGUoKQoJCQluYW1lc3BhY2VzID0gdHlwZS5zcGxpdCgiLiIpOwoJCQl0eXBlID0gbmFtZXNwYWNlcy5zaGlmdCgpOwoJCQluYW1lc3BhY2VzLnNvcnQoKTsKCQl9CgkJb250eXBlID0gdHlwZS5pbmRleE9mKCI6IikgPCAwICYmICJvbiIgKyB0eXBlOwoKCQkvLyBDYWxsZXIgY2FuIHBhc3MgaW4gYSBqUXVlcnkuRXZlbnQgb2JqZWN0LCBPYmplY3QsIG9yIGp1c3QgYW4gZXZlbnQgdHlwZSBzdHJpbmcKCQlldmVudCA9IGV2ZW50WyBqUXVlcnkuZXhwYW5kbyBdID8KCQkJZXZlbnQgOgoJCQluZXcgalF1ZXJ5LkV2ZW50KCB0eXBlLCB0eXBlb2YgZXZlbnQgPT09ICJvYmplY3QiICYmIGV2ZW50ICk7CgoJCWV2ZW50LmlzVHJpZ2dlciA9IHRydWU7CgkJZXZlbnQubmFtZXNwYWNlID0gbmFtZXNwYWNlcy5qb2luKCIuIik7CgkJZXZlbnQubmFtZXNwYWNlX3JlID0gZXZlbnQubmFtZXNwYWNlID8KCQkJbmV3IFJlZ0V4cCggIihefFxcLikiICsgbmFtZXNwYWNlcy5qb2luKCJcXC4oPzouKlxcLnwpIikgKyAiKFxcLnwkKSIgKSA6CgkJCW51bGw7CgoJCS8vIENsZWFuIHVwIHRoZSBldmVudCBpbiBjYXNlIGl0IGlzIGJlaW5nIHJldXNlZAoJCWV2ZW50LnJlc3VsdCA9IHVuZGVmaW5lZDsKCQlpZiAoICFldmVudC50YXJnZXQgKSB7CgkJCWV2ZW50LnRhcmdldCA9IGVsZW07CgkJfQoKCQkvLyBDbG9uZSBhbnkgaW5jb21pbmcgZGF0YSBhbmQgcHJlcGVuZCB0aGUgZXZlbnQsIGNyZWF0aW5nIHRoZSBoYW5kbGVyIGFyZyBsaXN0CgkJZGF0YSA9IGRhdGEgPT0gbnVsbCA/CgkJCVsgZXZlbnQgXSA6CgkJCWpRdWVyeS5tYWtlQXJyYXkoIGRhdGEsIFsgZXZlbnQgXSApOwoKCQkvLyBBbGxvdyBzcGVjaWFsIGV2ZW50cyB0byBkcmF3IG91dHNpZGUgdGhlIGxpbmVzCgkJc3BlY2lhbCA9IGpRdWVyeS5ldmVudC5zcGVjaWFsWyB0eXBlIF0gfHwge307CgkJaWYgKCAhb25seUhhbmRsZXJzICYmIHNwZWNpYWwudHJpZ2dlciAmJiBzcGVjaWFsLnRyaWdnZXIuYXBwbHkoIGVsZW0sIGRhdGEgKSA9PT0gZmFsc2UgKSB7CgkJCXJldHVybjsKCQl9CgoJCS8vIERldGVybWluZSBldmVudCBwcm9wYWdhdGlvbiBwYXRoIGluIGFkdmFuY2UsIHBlciBXM0MgZXZlbnRzIHNwZWMgKCM5OTUxKQoJCS8vIEJ1YmJsZSB1cCB0byBkb2N1bWVudCwgdGhlbiB0byB3aW5kb3c7IHdhdGNoIGZvciBhIGdsb2JhbCBvd25lckRvY3VtZW50IHZhciAoIzk3MjQpCgkJaWYgKCAhb25seUhhbmRsZXJzICYmICFzcGVjaWFsLm5vQnViYmxlICYmICFqUXVlcnkuaXNXaW5kb3coIGVsZW0gKSApIHsKCgkJCWJ1YmJsZVR5cGUgPSBzcGVjaWFsLmRlbGVnYXRlVHlwZSB8fCB0eXBlOwoJCQlpZiAoICFyZm9jdXNNb3JwaC50ZXN0KCBidWJibGVUeXBlICsgdHlwZSApICkgewoJCQkJY3VyID0gY3VyLnBhcmVudE5vZGU7CgkJCX0KCQkJZm9yICggOyBjdXI7IGN1ciA9IGN1ci5wYXJlbnROb2RlICkgewoJCQkJZXZlbnRQYXRoLnB1c2goIGN1ciApOwoJCQkJdG1wID0gY3VyOwoJCQl9CgoJCQkvLyBPbmx5IGFkZCB3aW5kb3cgaWYgd2UgZ290IHRvIGRvY3VtZW50IChlLmcuLCBub3QgcGxhaW4gb2JqIG9yIGRldGFjaGVkIERPTSkKCQkJaWYgKCB0bXAgPT09IChlbGVtLm93bmVyRG9jdW1lbnQgfHwgZG9jdW1lbnQpICkgewoJCQkJZXZlbnRQYXRoLnB1c2goIHRtcC5kZWZhdWx0VmlldyB8fCB0bXAucGFyZW50V2luZG93IHx8IHdpbmRvdyApOwoJCQl9CgkJfQoKCQkvLyBGaXJlIGhhbmRsZXJzIG9uIHRoZSBldmVudCBwYXRoCgkJaSA9IDA7CgkJd2hpbGUgKCAoY3VyID0gZXZlbnRQYXRoW2krK10pICYmICFldmVudC5pc1Byb3BhZ2F0aW9uU3RvcHBlZCgpICkgewoKCQkJZXZlbnQudHlwZSA9IGkgPiAxID8KCQkJCWJ1YmJsZVR5cGUgOgoJCQkJc3BlY2lhbC5iaW5kVHlwZSB8fCB0eXBlOwoKCQkJLy8galF1ZXJ5IGhhbmRsZXIKCQkJaGFuZGxlID0gKCBqUXVlcnkuX2RhdGEoIGN1ciwgImV2ZW50cyIgKSB8fCB7fSApWyBldmVudC50eXBlIF0gJiYgalF1ZXJ5Ll9kYXRhKCBjdXIsICJoYW5kbGUiICk7CgkJCWlmICggaGFuZGxlICkgewoJCQkJaGFuZGxlLmFwcGx5KCBjdXIsIGRhdGEgKTsKCQkJfQoKCQkJLy8gTmF0aXZlIGhhbmRsZXIKCQkJaGFuZGxlID0gb250eXBlICYmIGN1clsgb250eXBlIF07CgkJCWlmICggaGFuZGxlICYmIGpRdWVyeS5hY2NlcHREYXRhKCBjdXIgKSAmJiBoYW5kbGUuYXBwbHkgJiYgaGFuZGxlLmFwcGx5KCBjdXIsIGRhdGEgKSA9PT0gZmFsc2UgKSB7CgkJCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoJCQl9CgkJfQoJCWV2ZW50LnR5cGUgPSB0eXBlOwoKCQkvLyBJZiBub2JvZHkgcHJldmVudGVkIHRoZSBkZWZhdWx0IGFjdGlvbiwgZG8gaXQgbm93CgkJaWYgKCAhb25seUhhbmRsZXJzICYmICFldmVudC5pc0RlZmF1bHRQcmV2ZW50ZWQoKSApIHsKCgkJCWlmICggKCFzcGVjaWFsLl9kZWZhdWx0IHx8IHNwZWNpYWwuX2RlZmF1bHQuYXBwbHkoIGVsZW0ub3duZXJEb2N1bWVudCwgZGF0YSApID09PSBmYWxzZSkgJiYKCQkJCSEodHlwZSA9PT0gImNsaWNrIiAmJiBqUXVlcnkubm9kZU5hbWUoIGVsZW0sICJhIiApKSAmJiBqUXVlcnkuYWNjZXB0RGF0YSggZWxlbSApICkgewoKCQkJCS8vIENhbGwgYSBuYXRpdmUgRE9NIG1ldGhvZCBvbiB0aGUgdGFyZ2V0IHdpdGggdGhlIHNhbWUgbmFtZSBuYW1lIGFzIHRoZSBldmVudC4KCQkJCS8vIENhbid0IHVzZSBhbiAuaXNGdW5jdGlvbigpIGNoZWNrIGhlcmUgYmVjYXVzZSBJRTYvNyBmYWlscyB0aGF0IHRlc3QuCgkJCQkvLyBEb24ndCBkbyBkZWZhdWx0IGFjdGlvbnMgb24gd2luZG93LCB0aGF0J3Mgd2hlcmUgZ2xvYmFsIHZhcmlhYmxlcyBiZSAoIzYxNzApCgkJCQlpZiAoIG9udHlwZSAmJiBlbGVtWyB0eXBlIF0gJiYgIWpRdWVyeS5pc1dpbmRvdyggZWxlbSApICkgewoKCQkJCQkvLyBEb24ndCByZS10cmlnZ2VyIGFuIG9uRk9PIGV2ZW50IHdoZW4gd2UgY2FsbCBpdHMgRk9PKCkgbWV0aG9kCgkJCQkJdG1wID0gZWxlbVsgb250eXBlIF07CgoJCQkJCWlmICggdG1wICkgewoJCQkJCQllbGVtWyBvbnR5cGUgXSA9IG51bGw7CgkJCQkJfQoKCQkJCQkvLyBQcmV2ZW50IHJlLXRyaWdnZXJpbmcgb2YgdGhlIHNhbWUgZXZlbnQsIHNpbmNlIHdlIGFscmVhZHkgYnViYmxlZCBpdCBhYm92ZQoJCQkJCWpRdWVyeS5ldmVudC50cmlnZ2VyZWQgPSB0eXBlOwoJCQkJCXRyeSB7CgkJCQkJCWVsZW1bIHR5cGUgXSgpOwoJCQkJCX0gY2F0Y2ggKCBlICkgewoJCQkJCQkvLyBJRTw5IGRpZXMgb24gZm9jdXMvYmx1ciB0byBoaWRkZW4gZWxlbWVudCAoIzE0ODYsIzEyNTE4KQoJCQkJCQkvLyBvbmx5IHJlcHJvZHVjaWJsZSBvbiB3aW5YUCBJRTggbmF0aXZlLCBub3QgSUU5IGluIElFOCBtb2RlCgkJCQkJfQoJCQkJCWpRdWVyeS5ldmVudC50cmlnZ2VyZWQgPSB1bmRlZmluZWQ7CgoJCQkJCWlmICggdG1wICkgewoJCQkJCQllbGVtWyBvbnR5cGUgXSA9IHRtcDsKCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgoJCXJldHVybiBldmVudC5yZXN1bHQ7Cgl9LAoKCWRpc3BhdGNoOiBmdW5jdGlvbiggZXZlbnQgKSB7CgoJCS8vIE1ha2UgYSB3cml0YWJsZSBqUXVlcnkuRXZlbnQgZnJvbSB0aGUgbmF0aXZlIGV2ZW50IG9iamVjdAoJCWV2ZW50ID0galF1ZXJ5LmV2ZW50LmZpeCggZXZlbnQgKTsKCgkJdmFyIGksIHJldCwgaGFuZGxlT2JqLCBtYXRjaGVkLCBqLAoJCQloYW5kbGVyUXVldWUgPSBbXSwKCQkJYXJncyA9IGNvcmVfc2xpY2UuY2FsbCggYXJndW1lbnRzICksCgkJCWhhbmRsZXJzID0gKCBqUXVlcnkuX2RhdGEoIHRoaXMsICJldmVudHMiICkgfHwge30gKVsgZXZlbnQudHlwZSBdIHx8IFtdLAoJCQlzcGVjaWFsID0galF1ZXJ5LmV2ZW50LnNwZWNpYWxbIGV2ZW50LnR5cGUgXSB8fCB7fTsKCgkJLy8gVXNlIHRoZSBmaXgtZWQgalF1ZXJ5LkV2ZW50IHJhdGhlciB0aGFuIHRoZSAocmVhZC1vbmx5KSBuYXRpdmUgZXZlbnQKCQlhcmdzWzBdID0gZXZlbnQ7CgkJZXZlbnQuZGVsZWdhdGVUYXJnZXQgPSB0aGlzOwoKCQkvLyBDYWxsIHRoZSBwcmVEaXNwYXRjaCBob29rIGZvciB0aGUgbWFwcGVkIHR5cGUsIGFuZCBsZXQgaXQgYmFpbCBpZiBkZXNpcmVkCgkJaWYgKCBzcGVjaWFsLnByZURpc3BhdGNoICYmIHNwZWNpYWwucHJlRGlzcGF0Y2guY2FsbCggdGhpcywgZXZlbnQgKSA9PT0gZmFsc2UgKSB7CgkJCXJldHVybjsKCQl9CgoJCS8vIERldGVybWluZSBoYW5kbGVycwoJCWhhbmRsZXJRdWV1ZSA9IGpRdWVyeS5ldmVudC5oYW5kbGVycy5jYWxsKCB0aGlzLCBldmVudCwgaGFuZGxlcnMgKTsKCgkJLy8gUnVuIGRlbGVnYXRlcyBmaXJzdDsgdGhleSBtYXkgd2FudCB0byBzdG9wIHByb3BhZ2F0aW9uIGJlbmVhdGggdXMKCQlpID0gMDsKCQl3aGlsZSAoIChtYXRjaGVkID0gaGFuZGxlclF1ZXVlWyBpKysgXSkgJiYgIWV2ZW50LmlzUHJvcGFnYXRpb25TdG9wcGVkKCkgKSB7CgkJCWV2ZW50LmN1cnJlbnRUYXJnZXQgPSBtYXRjaGVkLmVsZW07CgoJCQlqID0gMDsKCQkJd2hpbGUgKCAoaGFuZGxlT2JqID0gbWF0Y2hlZC5oYW5kbGVyc1sgaisrIF0pICYmICFldmVudC5pc0ltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZCgpICkgewoKCQkJCS8vIFRyaWdnZXJlZCBldmVudCBtdXN0IGVpdGhlciAxKSBoYXZlIG5vIG5hbWVzcGFjZSwgb3IKCQkJCS8vIDIpIGhhdmUgbmFtZXNwYWNlKHMpIGEgc3Vic2V0IG9yIGVxdWFsIHRvIHRob3NlIGluIHRoZSBib3VuZCBldmVudCAoYm90aCBjYW4gaGF2ZSBubyBuYW1lc3BhY2UpLgoJCQkJaWYgKCAhZXZlbnQubmFtZXNwYWNlX3JlIHx8IGV2ZW50Lm5hbWVzcGFjZV9yZS50ZXN0KCBoYW5kbGVPYmoubmFtZXNwYWNlICkgKSB7CgoJCQkJCWV2ZW50LmhhbmRsZU9iaiA9IGhhbmRsZU9iajsKCQkJCQlldmVudC5kYXRhID0gaGFuZGxlT2JqLmRhdGE7CgoJCQkJCXJldCA9ICggKGpRdWVyeS5ldmVudC5zcGVjaWFsWyBoYW5kbGVPYmoub3JpZ1R5cGUgXSB8fCB7fSkuaGFuZGxlIHx8IGhhbmRsZU9iai5oYW5kbGVyICkKCQkJCQkJCS5hcHBseSggbWF0Y2hlZC5lbGVtLCBhcmdzICk7CgoJCQkJCWlmICggcmV0ICE9PSB1bmRlZmluZWQgKSB7CgkJCQkJCWlmICggKGV2ZW50LnJlc3VsdCA9IHJldCkgPT09IGZhbHNlICkgewoJCQkJCQkJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCQkJCQkJCWV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoKCQkvLyBDYWxsIHRoZSBwb3N0RGlzcGF0Y2ggaG9vayBmb3IgdGhlIG1hcHBlZCB0eXBlCgkJaWYgKCBzcGVjaWFsLnBvc3REaXNwYXRjaCApIHsKCQkJc3BlY2lhbC5wb3N0RGlzcGF0Y2guY2FsbCggdGhpcywgZXZlbnQgKTsKCQl9CgoJCXJldHVybiBldmVudC5yZXN1bHQ7Cgl9LAoKCWhhbmRsZXJzOiBmdW5jdGlvbiggZXZlbnQsIGhhbmRsZXJzICkgewoJCXZhciBzZWwsIGhhbmRsZU9iaiwgbWF0Y2hlcywgaSwKCQkJaGFuZGxlclF1ZXVlID0gW10sCgkJCWRlbGVnYXRlQ291bnQgPSBoYW5kbGVycy5kZWxlZ2F0ZUNvdW50LAoJCQljdXIgPSBldmVudC50YXJnZXQ7CgoJCS8vIEZpbmQgZGVsZWdhdGUgaGFuZGxlcnMKCQkvLyBCbGFjay1ob2xlIFNWRyA8dXNlPiBpbnN0YW5jZSB0cmVlcyAoIzEzMTgwKQoJCS8vIEF2b2lkIG5vbi1sZWZ0LWNsaWNrIGJ1YmJsaW5nIGluIEZpcmVmb3ggKCMzODYxKQoJCWlmICggZGVsZWdhdGVDb3VudCAmJiBjdXIubm9kZVR5cGUgJiYgKCFldmVudC5idXR0b24gfHwgZXZlbnQudHlwZSAhPT0gImNsaWNrIikgKSB7CgoJCQlmb3IgKCA7IGN1ciAhPSB0aGlzOyBjdXIgPSBjdXIucGFyZW50Tm9kZSB8fCB0aGlzICkgewoKCQkJCS8vIERvbid0IGNoZWNrIG5vbi1lbGVtZW50cyAoIzEzMjA4KQoJCQkJLy8gRG9uJ3QgcHJvY2VzcyBjbGlja3Mgb24gZGlzYWJsZWQgZWxlbWVudHMgKCM2OTExLCAjODE2NSwgIzExMzgyLCAjMTE3NjQpCgkJCQlpZiAoIGN1ci5ub2RlVHlwZSA9PT0gMSAmJiAoY3VyLmRpc2FibGVkICE9PSB0cnVlIHx8IGV2ZW50LnR5cGUgIT09ICJjbGljayIpICkgewoJCQkJCW1hdGNoZXMgPSBbXTsKCQkJCQlmb3IgKCBpID0gMDsgaSA8IGRlbGVnYXRlQ291bnQ7IGkrKyApIHsKCQkJCQkJaGFuZGxlT2JqID0gaGFuZGxlcnNbIGkgXTsKCgkJCQkJCS8vIERvbid0IGNvbmZsaWN0IHdpdGggT2JqZWN0LnByb3RvdHlwZSBwcm9wZXJ0aWVzICgjMTMyMDMpCgkJCQkJCXNlbCA9IGhhbmRsZU9iai5zZWxlY3RvciArICIgIjsKCgkJCQkJCWlmICggbWF0Y2hlc1sgc2VsIF0gPT09IHVuZGVmaW5lZCApIHsKCQkJCQkJCW1hdGNoZXNbIHNlbCBdID0gaGFuZGxlT2JqLm5lZWRzQ29udGV4dCA/CgkJCQkJCQkJalF1ZXJ5KCBzZWwsIHRoaXMgKS5pbmRleCggY3VyICkgPj0gMCA6CgkJCQkJCQkJalF1ZXJ5LmZpbmQoIHNlbCwgdGhpcywgbnVsbCwgWyBjdXIgXSApLmxlbmd0aDsKCQkJCQkJfQoJCQkJCQlpZiAoIG1hdGNoZXNbIHNlbCBdICkgewoJCQkJCQkJbWF0Y2hlcy5wdXNoKCBoYW5kbGVPYmogKTsKCQkJCQkJfQoJCQkJCX0KCQkJCQlpZiAoIG1hdGNoZXMubGVuZ3RoICkgewoJCQkJCQloYW5kbGVyUXVldWUucHVzaCh7IGVsZW06IGN1ciwgaGFuZGxlcnM6IG1hdGNoZXMgfSk7CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoKCQkvLyBBZGQgdGhlIHJlbWFpbmluZyAoZGlyZWN0bHktYm91bmQpIGhhbmRsZXJzCgkJaWYgKCBkZWxlZ2F0ZUNvdW50IDwgaGFuZGxlcnMubGVuZ3RoICkgewoJCQloYW5kbGVyUXVldWUucHVzaCh7IGVsZW06IHRoaXMsIGhhbmRsZXJzOiBoYW5kbGVycy5zbGljZSggZGVsZWdhdGVDb3VudCApIH0pOwoJCX0KCgkJcmV0dXJuIGhhbmRsZXJRdWV1ZTsKCX0sCgoJZml4OiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJaWYgKCBldmVudFsgalF1ZXJ5LmV4cGFuZG8gXSApIHsKCQkJcmV0dXJuIGV2ZW50OwoJCX0KCgkJLy8gQ3JlYXRlIGEgd3JpdGFibGUgY29weSBvZiB0aGUgZXZlbnQgb2JqZWN0IGFuZCBub3JtYWxpemUgc29tZSBwcm9wZXJ0aWVzCgkJdmFyIGksIHByb3AsIGNvcHksCgkJCXR5cGUgPSBldmVudC50eXBlLAoJCQlvcmlnaW5hbEV2ZW50ID0gZXZlbnQsCgkJCWZpeEhvb2sgPSB0aGlzLmZpeEhvb2tzWyB0eXBlIF07CgoJCWlmICggIWZpeEhvb2sgKSB7CgkJCXRoaXMuZml4SG9va3NbIHR5cGUgXSA9IGZpeEhvb2sgPQoJCQkJcm1vdXNlRXZlbnQudGVzdCggdHlwZSApID8gdGhpcy5tb3VzZUhvb2tzIDoKCQkJCXJrZXlFdmVudC50ZXN0KCB0eXBlICkgPyB0aGlzLmtleUhvb2tzIDoKCQkJCXt9OwoJCX0KCQljb3B5ID0gZml4SG9vay5wcm9wcyA/IHRoaXMucHJvcHMuY29uY2F0KCBmaXhIb29rLnByb3BzICkgOiB0aGlzLnByb3BzOwoKCQlldmVudCA9IG5ldyBqUXVlcnkuRXZlbnQoIG9yaWdpbmFsRXZlbnQgKTsKCgkJaSA9IGNvcHkubGVuZ3RoOwoJCXdoaWxlICggaS0tICkgewoJCQlwcm9wID0gY29weVsgaSBdOwoJCQlldmVudFsgcHJvcCBdID0gb3JpZ2luYWxFdmVudFsgcHJvcCBdOwoJCX0KCgkJLy8gU3VwcG9ydDogSUU8OQoJCS8vIEZpeCB0YXJnZXQgcHJvcGVydHkgKCMxOTI1KQoJCWlmICggIWV2ZW50LnRhcmdldCApIHsKCQkJZXZlbnQudGFyZ2V0ID0gb3JpZ2luYWxFdmVudC5zcmNFbGVtZW50IHx8IGRvY3VtZW50OwoJCX0KCgkJLy8gU3VwcG9ydDogQ2hyb21lIDIzKywgU2FmYXJpPwoJCS8vIFRhcmdldCBzaG91bGQgbm90IGJlIGEgdGV4dCBub2RlICgjNTA0LCAjMTMxNDMpCgkJaWYgKCBldmVudC50YXJnZXQubm9kZVR5cGUgPT09IDMgKSB7CgkJCWV2ZW50LnRhcmdldCA9IGV2ZW50LnRhcmdldC5wYXJlbnROb2RlOwoJCX0KCgkJLy8gU3VwcG9ydDogSUU8OQoJCS8vIEZvciBtb3VzZS9rZXkgZXZlbnRzLCBtZXRhS2V5PT1mYWxzZSBpZiBpdCdzIHVuZGVmaW5lZCAoIzMzNjgsICMxMTMyOCkKCQlldmVudC5tZXRhS2V5ID0gISFldmVudC5tZXRhS2V5OwoKCQlyZXR1cm4gZml4SG9vay5maWx0ZXIgPyBmaXhIb29rLmZpbHRlciggZXZlbnQsIG9yaWdpbmFsRXZlbnQgKSA6IGV2ZW50OwoJfSwKCgkvLyBJbmNsdWRlcyBzb21lIGV2ZW50IHByb3BzIHNoYXJlZCBieSBLZXlFdmVudCBhbmQgTW91c2VFdmVudAoJcHJvcHM6ICJhbHRLZXkgYnViYmxlcyBjYW5jZWxhYmxlIGN0cmxLZXkgY3VycmVudFRhcmdldCBldmVudFBoYXNlIG1ldGFLZXkgcmVsYXRlZFRhcmdldCBzaGlmdEtleSB0YXJnZXQgdGltZVN0YW1wIHZpZXcgd2hpY2giLnNwbGl0KCIgIiksCgoJZml4SG9va3M6IHt9LAoKCWtleUhvb2tzOiB7CgkJcHJvcHM6ICJjaGFyIGNoYXJDb2RlIGtleSBrZXlDb2RlIi5zcGxpdCgiICIpLAoJCWZpbHRlcjogZnVuY3Rpb24oIGV2ZW50LCBvcmlnaW5hbCApIHsKCgkJCS8vIEFkZCB3aGljaCBmb3Iga2V5IGV2ZW50cwoJCQlpZiAoIGV2ZW50LndoaWNoID09IG51bGwgKSB7CgkJCQlldmVudC53aGljaCA9IG9yaWdpbmFsLmNoYXJDb2RlICE9IG51bGwgPyBvcmlnaW5hbC5jaGFyQ29kZSA6IG9yaWdpbmFsLmtleUNvZGU7CgkJCX0KCgkJCXJldHVybiBldmVudDsKCQl9Cgl9LAoKCW1vdXNlSG9va3M6IHsKCQlwcm9wczogImJ1dHRvbiBidXR0b25zIGNsaWVudFggY2xpZW50WSBmcm9tRWxlbWVudCBvZmZzZXRYIG9mZnNldFkgcGFnZVggcGFnZVkgc2NyZWVuWCBzY3JlZW5ZIHRvRWxlbWVudCIuc3BsaXQoIiAiKSwKCQlmaWx0ZXI6IGZ1bmN0aW9uKCBldmVudCwgb3JpZ2luYWwgKSB7CgkJCXZhciBib2R5LCBldmVudERvYywgZG9jLAoJCQkJYnV0dG9uID0gb3JpZ2luYWwuYnV0dG9uLAoJCQkJZnJvbUVsZW1lbnQgPSBvcmlnaW5hbC5mcm9tRWxlbWVudDsKCgkJCS8vIENhbGN1bGF0ZSBwYWdlWC9ZIGlmIG1pc3NpbmcgYW5kIGNsaWVudFgvWSBhdmFpbGFibGUKCQkJaWYgKCBldmVudC5wYWdlWCA9PSBudWxsICYmIG9yaWdpbmFsLmNsaWVudFggIT0gbnVsbCApIHsKCQkJCWV2ZW50RG9jID0gZXZlbnQudGFyZ2V0Lm93bmVyRG9jdW1lbnQgfHwgZG9jdW1lbnQ7CgkJCQlkb2MgPSBldmVudERvYy5kb2N1bWVudEVsZW1lbnQ7CgkJCQlib2R5ID0gZXZlbnREb2MuYm9keTsKCgkJCQlldmVudC5wYWdlWCA9IG9yaWdpbmFsLmNsaWVudFggKyAoIGRvYyAmJiBkb2Muc2Nyb2xsTGVmdCB8fCBib2R5ICYmIGJvZHkuc2Nyb2xsTGVmdCB8fCAwICkgLSAoIGRvYyAmJiBkb2MuY2xpZW50TGVmdCB8fCBib2R5ICYmIGJvZHkuY2xpZW50TGVmdCB8fCAwICk7CgkJCQlldmVudC5wYWdlWSA9IG9yaWdpbmFsLmNsaWVudFkgKyAoIGRvYyAmJiBkb2Muc2Nyb2xsVG9wICB8fCBib2R5ICYmIGJvZHkuc2Nyb2xsVG9wICB8fCAwICkgLSAoIGRvYyAmJiBkb2MuY2xpZW50VG9wICB8fCBib2R5ICYmIGJvZHkuY2xpZW50VG9wICB8fCAwICk7CgkJCX0KCgkJCS8vIEFkZCByZWxhdGVkVGFyZ2V0LCBpZiBuZWNlc3NhcnkKCQkJaWYgKCAhZXZlbnQucmVsYXRlZFRhcmdldCAmJiBmcm9tRWxlbWVudCApIHsKCQkJCWV2ZW50LnJlbGF0ZWRUYXJnZXQgPSBmcm9tRWxlbWVudCA9PT0gZXZlbnQudGFyZ2V0ID8gb3JpZ2luYWwudG9FbGVtZW50IDogZnJvbUVsZW1lbnQ7CgkJCX0KCgkJCS8vIEFkZCB3aGljaCBmb3IgY2xpY2s6IDEgPT09IGxlZnQ7IDIgPT09IG1pZGRsZTsgMyA9PT0gcmlnaHQKCQkJLy8gTm90ZTogYnV0dG9uIGlzIG5vdCBub3JtYWxpemVkLCBzbyBkb24ndCB1c2UgaXQKCQkJaWYgKCAhZXZlbnQud2hpY2ggJiYgYnV0dG9uICE9PSB1bmRlZmluZWQgKSB7CgkJCQlldmVudC53aGljaCA9ICggYnV0dG9uICYgMSA/IDEgOiAoIGJ1dHRvbiAmIDIgPyAzIDogKCBidXR0b24gJiA0ID8gMiA6IDAgKSApICk7CgkJCX0KCgkJCXJldHVybiBldmVudDsKCQl9Cgl9LAoKCXNwZWNpYWw6IHsKCQlsb2FkOiB7CgkJCS8vIFByZXZlbnQgdHJpZ2dlcmVkIGltYWdlLmxvYWQgZXZlbnRzIGZyb20gYnViYmxpbmcgdG8gd2luZG93LmxvYWQKCQkJbm9CdWJibGU6IHRydWUKCQl9LAoJCWNsaWNrOiB7CgkJCS8vIEZvciBjaGVja2JveCwgZmlyZSBuYXRpdmUgZXZlbnQgc28gY2hlY2tlZCBzdGF0ZSB3aWxsIGJlIHJpZ2h0CgkJCXRyaWdnZXI6IGZ1bmN0aW9uKCkgewoJCQkJaWYgKCBqUXVlcnkubm9kZU5hbWUoIHRoaXMsICJpbnB1dCIgKSAmJiB0aGlzLnR5cGUgPT09ICJjaGVja2JveCIgJiYgdGhpcy5jbGljayApIHsKCQkJCQl0aGlzLmNsaWNrKCk7CgkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJfQoJCQl9CgkJfSwKCQlmb2N1czogewoJCQkvLyBGaXJlIG5hdGl2ZSBldmVudCBpZiBwb3NzaWJsZSBzbyBibHVyL2ZvY3VzIHNlcXVlbmNlIGlzIGNvcnJlY3QKCQkJdHJpZ2dlcjogZnVuY3Rpb24oKSB7CgkJCQlpZiAoIHRoaXMgIT09IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgJiYgdGhpcy5mb2N1cyApIHsKCQkJCQl0cnkgewoJCQkJCQl0aGlzLmZvY3VzKCk7CgkJCQkJCXJldHVybiBmYWxzZTsKCQkJCQl9IGNhdGNoICggZSApIHsKCQkJCQkJLy8gU3VwcG9ydDogSUU8OQoJCQkJCQkvLyBJZiB3ZSBlcnJvciBvbiBmb2N1cyB0byBoaWRkZW4gZWxlbWVudCAoIzE0ODYsICMxMjUxOCksCgkJCQkJCS8vIGxldCAudHJpZ2dlcigpIHJ1biB0aGUgaGFuZGxlcnMKCQkJCQl9CgkJCQl9CgkJCX0sCgkJCWRlbGVnYXRlVHlwZTogImZvY3VzaW4iCgkJfSwKCQlibHVyOiB7CgkJCXRyaWdnZXI6IGZ1bmN0aW9uKCkgewoJCQkJaWYgKCB0aGlzID09PSBkb2N1bWVudC5hY3RpdmVFbGVtZW50ICYmIHRoaXMuYmx1ciApIHsKCQkJCQl0aGlzLmJsdXIoKTsKCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQl9CgkJCX0sCgkJCWRlbGVnYXRlVHlwZTogImZvY3Vzb3V0IgoJCX0sCgoJCWJlZm9yZXVubG9hZDogewoJCQlwb3N0RGlzcGF0Y2g6IGZ1bmN0aW9uKCBldmVudCApIHsKCgkJCQkvLyBFdmVuIHdoZW4gcmV0dXJuVmFsdWUgZXF1YWxzIHRvIHVuZGVmaW5lZCBGaXJlZm94IHdpbGwgc3RpbGwgc2hvdyBhbGVydAoJCQkJaWYgKCBldmVudC5yZXN1bHQgIT09IHVuZGVmaW5lZCApIHsKCQkJCQlldmVudC5vcmlnaW5hbEV2ZW50LnJldHVyblZhbHVlID0gZXZlbnQucmVzdWx0OwoJCQkJfQoJCQl9CgkJfQoJfSwKCglzaW11bGF0ZTogZnVuY3Rpb24oIHR5cGUsIGVsZW0sIGV2ZW50LCBidWJibGUgKSB7CgkJLy8gUGlnZ3liYWNrIG9uIGEgZG9ub3IgZXZlbnQgdG8gc2ltdWxhdGUgYSBkaWZmZXJlbnQgb25lLgoJCS8vIEZha2Ugb3JpZ2luYWxFdmVudCB0byBhdm9pZCBkb25vcidzIHN0b3BQcm9wYWdhdGlvbiwgYnV0IGlmIHRoZQoJCS8vIHNpbXVsYXRlZCBldmVudCBwcmV2ZW50cyBkZWZhdWx0IHRoZW4gd2UgZG8gdGhlIHNhbWUgb24gdGhlIGRvbm9yLgoJCXZhciBlID0galF1ZXJ5LmV4dGVuZCgKCQkJbmV3IGpRdWVyeS5FdmVudCgpLAoJCQlldmVudCwKCQkJeyB0eXBlOiB0eXBlLAoJCQkJaXNTaW11bGF0ZWQ6IHRydWUsCgkJCQlvcmlnaW5hbEV2ZW50OiB7fQoJCQl9CgkJKTsKCQlpZiAoIGJ1YmJsZSApIHsKCQkJalF1ZXJ5LmV2ZW50LnRyaWdnZXIoIGUsIG51bGwsIGVsZW0gKTsKCQl9IGVsc2UgewoJCQlqUXVlcnkuZXZlbnQuZGlzcGF0Y2guY2FsbCggZWxlbSwgZSApOwoJCX0KCQlpZiAoIGUuaXNEZWZhdWx0UHJldmVudGVkKCkgKSB7CgkJCWV2ZW50LnByZXZlbnREZWZhdWx0KCk7CgkJfQoJfQp9OwoKalF1ZXJ5LnJlbW92ZUV2ZW50ID0gZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lciA/CglmdW5jdGlvbiggZWxlbSwgdHlwZSwgaGFuZGxlICkgewoJCWlmICggZWxlbS5yZW1vdmVFdmVudExpc3RlbmVyICkgewoJCQllbGVtLnJlbW92ZUV2ZW50TGlzdGVuZXIoIHR5cGUsIGhhbmRsZSwgZmFsc2UgKTsKCQl9Cgl9IDoKCWZ1bmN0aW9uKCBlbGVtLCB0eXBlLCBoYW5kbGUgKSB7CgkJdmFyIG5hbWUgPSAib24iICsgdHlwZTsKCgkJaWYgKCBlbGVtLmRldGFjaEV2ZW50ICkgewoKCQkJLy8gIzg1NDUsICM3MDU0LCBwcmV2ZW50aW5nIG1lbW9yeSBsZWFrcyBmb3IgY3VzdG9tIGV2ZW50cyBpbiBJRTYtOAoJCQkvLyBkZXRhY2hFdmVudCBuZWVkZWQgcHJvcGVydHkgb24gZWxlbWVudCwgYnkgbmFtZSBvZiB0aGF0IGV2ZW50LCB0byBwcm9wZXJseSBleHBvc2UgaXQgdG8gR0MKCQkJaWYgKCB0eXBlb2YgZWxlbVsgbmFtZSBdID09PSBjb3JlX3N0cnVuZGVmaW5lZCApIHsKCQkJCWVsZW1bIG5hbWUgXSA9IG51bGw7CgkJCX0KCgkJCWVsZW0uZGV0YWNoRXZlbnQoIG5hbWUsIGhhbmRsZSApOwoJCX0KCX07CgpqUXVlcnkuRXZlbnQgPSBmdW5jdGlvbiggc3JjLCBwcm9wcyApIHsKCS8vIEFsbG93IGluc3RhbnRpYXRpb24gd2l0aG91dCB0aGUgJ25ldycga2V5d29yZAoJaWYgKCAhKHRoaXMgaW5zdGFuY2VvZiBqUXVlcnkuRXZlbnQpICkgewoJCXJldHVybiBuZXcgalF1ZXJ5LkV2ZW50KCBzcmMsIHByb3BzICk7Cgl9CgoJLy8gRXZlbnQgb2JqZWN0CglpZiAoIHNyYyAmJiBzcmMudHlwZSApIHsKCQl0aGlzLm9yaWdpbmFsRXZlbnQgPSBzcmM7CgkJdGhpcy50eXBlID0gc3JjLnR5cGU7CgoJCS8vIEV2ZW50cyBidWJibGluZyB1cCB0aGUgZG9jdW1lbnQgbWF5IGhhdmUgYmVlbiBtYXJrZWQgYXMgcHJldmVudGVkCgkJLy8gYnkgYSBoYW5kbGVyIGxvd2VyIGRvd24gdGhlIHRyZWU7IHJlZmxlY3QgdGhlIGNvcnJlY3QgdmFsdWUuCgkJdGhpcy5pc0RlZmF1bHRQcmV2ZW50ZWQgPSAoIHNyYy5kZWZhdWx0UHJldmVudGVkIHx8IHNyYy5yZXR1cm5WYWx1ZSA9PT0gZmFsc2UgfHwKCQkJc3JjLmdldFByZXZlbnREZWZhdWx0ICYmIHNyYy5nZXRQcmV2ZW50RGVmYXVsdCgpICkgPyByZXR1cm5UcnVlIDogcmV0dXJuRmFsc2U7CgoJLy8gRXZlbnQgdHlwZQoJfSBlbHNlIHsKCQl0aGlzLnR5cGUgPSBzcmM7Cgl9CgoJLy8gUHV0IGV4cGxpY2l0bHkgcHJvdmlkZWQgcHJvcGVydGllcyBvbnRvIHRoZSBldmVudCBvYmplY3QKCWlmICggcHJvcHMgKSB7CgkJalF1ZXJ5LmV4dGVuZCggdGhpcywgcHJvcHMgKTsKCX0KCgkvLyBDcmVhdGUgYSB0aW1lc3RhbXAgaWYgaW5jb21pbmcgZXZlbnQgZG9lc24ndCBoYXZlIG9uZQoJdGhpcy50aW1lU3RhbXAgPSBzcmMgJiYgc3JjLnRpbWVTdGFtcCB8fCBqUXVlcnkubm93KCk7CgoJLy8gTWFyayBpdCBhcyBmaXhlZAoJdGhpc1sgalF1ZXJ5LmV4cGFuZG8gXSA9IHRydWU7Cn07CgovLyBqUXVlcnkuRXZlbnQgaXMgYmFzZWQgb24gRE9NMyBFdmVudHMgYXMgc3BlY2lmaWVkIGJ5IHRoZSBFQ01BU2NyaXB0IExhbmd1YWdlIEJpbmRpbmcKLy8gaHR0cDovL3d3dy53My5vcmcvVFIvMjAwMy9XRC1ET00tTGV2ZWwtMy1FdmVudHMtMjAwMzAzMzEvZWNtYS1zY3JpcHQtYmluZGluZy5odG1sCmpRdWVyeS5FdmVudC5wcm90b3R5cGUgPSB7Cglpc0RlZmF1bHRQcmV2ZW50ZWQ6IHJldHVybkZhbHNlLAoJaXNQcm9wYWdhdGlvblN0b3BwZWQ6IHJldHVybkZhbHNlLAoJaXNJbW1lZGlhdGVQcm9wYWdhdGlvblN0b3BwZWQ6IHJldHVybkZhbHNlLAoKCXByZXZlbnREZWZhdWx0OiBmdW5jdGlvbigpIHsKCQl2YXIgZSA9IHRoaXMub3JpZ2luYWxFdmVudDsKCgkJdGhpcy5pc0RlZmF1bHRQcmV2ZW50ZWQgPSByZXR1cm5UcnVlOwoJCWlmICggIWUgKSB7CgkJCXJldHVybjsKCQl9CgoJCS8vIElmIHByZXZlbnREZWZhdWx0IGV4aXN0cywgcnVuIGl0IG9uIHRoZSBvcmlnaW5hbCBldmVudAoJCWlmICggZS5wcmV2ZW50RGVmYXVsdCApIHsKCQkJZS5wcmV2ZW50RGVmYXVsdCgpOwoKCQkvLyBTdXBwb3J0OiBJRQoJCS8vIE90aGVyd2lzZSBzZXQgdGhlIHJldHVyblZhbHVlIHByb3BlcnR5IG9mIHRoZSBvcmlnaW5hbCBldmVudCB0byBmYWxzZQoJCX0gZWxzZSB7CgkJCWUucmV0dXJuVmFsdWUgPSBmYWxzZTsKCQl9Cgl9LAoJc3RvcFByb3BhZ2F0aW9uOiBmdW5jdGlvbigpIHsKCQl2YXIgZSA9IHRoaXMub3JpZ2luYWxFdmVudDsKCgkJdGhpcy5pc1Byb3BhZ2F0aW9uU3RvcHBlZCA9IHJldHVyblRydWU7CgkJaWYgKCAhZSApIHsKCQkJcmV0dXJuOwoJCX0KCQkvLyBJZiBzdG9wUHJvcGFnYXRpb24gZXhpc3RzLCBydW4gaXQgb24gdGhlIG9yaWdpbmFsIGV2ZW50CgkJaWYgKCBlLnN0b3BQcm9wYWdhdGlvbiApIHsKCQkJZS5zdG9wUHJvcGFnYXRpb24oKTsKCQl9CgoJCS8vIFN1cHBvcnQ6IElFCgkJLy8gU2V0IHRoZSBjYW5jZWxCdWJibGUgcHJvcGVydHkgb2YgdGhlIG9yaWdpbmFsIGV2ZW50IHRvIHRydWUKCQllLmNhbmNlbEJ1YmJsZSA9IHRydWU7Cgl9LAoJc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uOiBmdW5jdGlvbigpIHsKCQl0aGlzLmlzSW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkID0gcmV0dXJuVHJ1ZTsKCQl0aGlzLnN0b3BQcm9wYWdhdGlvbigpOwoJfQp9OwoKLy8gQ3JlYXRlIG1vdXNlZW50ZXIvbGVhdmUgZXZlbnRzIHVzaW5nIG1vdXNlb3Zlci9vdXQgYW5kIGV2ZW50LXRpbWUgY2hlY2tzCmpRdWVyeS5lYWNoKHsKCW1vdXNlZW50ZXI6ICJtb3VzZW92ZXIiLAoJbW91c2VsZWF2ZTogIm1vdXNlb3V0Igp9LCBmdW5jdGlvbiggb3JpZywgZml4ICkgewoJalF1ZXJ5LmV2ZW50LnNwZWNpYWxbIG9yaWcgXSA9IHsKCQlkZWxlZ2F0ZVR5cGU6IGZpeCwKCQliaW5kVHlwZTogZml4LAoKCQloYW5kbGU6IGZ1bmN0aW9uKCBldmVudCApIHsKCQkJdmFyIHJldCwKCQkJCXRhcmdldCA9IHRoaXMsCgkJCQlyZWxhdGVkID0gZXZlbnQucmVsYXRlZFRhcmdldCwKCQkJCWhhbmRsZU9iaiA9IGV2ZW50LmhhbmRsZU9iajsKCgkJCS8vIEZvciBtb3VzZW50ZXIvbGVhdmUgY2FsbCB0aGUgaGFuZGxlciBpZiByZWxhdGVkIGlzIG91dHNpZGUgdGhlIHRhcmdldC4KCQkJLy8gTkI6IE5vIHJlbGF0ZWRUYXJnZXQgaWYgdGhlIG1vdXNlIGxlZnQvZW50ZXJlZCB0aGUgYnJvd3NlciB3aW5kb3cKCQkJaWYgKCAhcmVsYXRlZCB8fCAocmVsYXRlZCAhPT0gdGFyZ2V0ICYmICFqUXVlcnkuY29udGFpbnMoIHRhcmdldCwgcmVsYXRlZCApKSApIHsKCQkJCWV2ZW50LnR5cGUgPSBoYW5kbGVPYmoub3JpZ1R5cGU7CgkJCQlyZXQgPSBoYW5kbGVPYmouaGFuZGxlci5hcHBseSggdGhpcywgYXJndW1lbnRzICk7CgkJCQlldmVudC50eXBlID0gZml4OwoJCQl9CgkJCXJldHVybiByZXQ7CgkJfQoJfTsKfSk7CgovLyBJRSBzdWJtaXQgZGVsZWdhdGlvbgppZiAoICFqUXVlcnkuc3VwcG9ydC5zdWJtaXRCdWJibGVzICkgewoKCWpRdWVyeS5ldmVudC5zcGVjaWFsLnN1Ym1pdCA9IHsKCQlzZXR1cDogZnVuY3Rpb24oKSB7CgkJCS8vIE9ubHkgbmVlZCB0aGlzIGZvciBkZWxlZ2F0ZWQgZm9ybSBzdWJtaXQgZXZlbnRzCgkJCWlmICggalF1ZXJ5Lm5vZGVOYW1lKCB0aGlzLCAiZm9ybSIgKSApIHsKCQkJCXJldHVybiBmYWxzZTsKCQkJfQoKCQkJLy8gTGF6eS1hZGQgYSBzdWJtaXQgaGFuZGxlciB3aGVuIGEgZGVzY2VuZGFudCBmb3JtIG1heSBwb3RlbnRpYWxseSBiZSBzdWJtaXR0ZWQKCQkJalF1ZXJ5LmV2ZW50LmFkZCggdGhpcywgImNsaWNrLl9zdWJtaXQga2V5cHJlc3MuX3N1Ym1pdCIsIGZ1bmN0aW9uKCBlICkgewoJCQkJLy8gTm9kZSBuYW1lIGNoZWNrIGF2b2lkcyBhIFZNTC1yZWxhdGVkIGNyYXNoIGluIElFICgjOTgwNykKCQkJCXZhciBlbGVtID0gZS50YXJnZXQsCgkJCQkJZm9ybSA9IGpRdWVyeS5ub2RlTmFtZSggZWxlbSwgImlucHV0IiApIHx8IGpRdWVyeS5ub2RlTmFtZSggZWxlbSwgImJ1dHRvbiIgKSA/IGVsZW0uZm9ybSA6IHVuZGVmaW5lZDsKCQkJCWlmICggZm9ybSAmJiAhalF1ZXJ5Ll9kYXRhKCBmb3JtLCAic3VibWl0QnViYmxlcyIgKSApIHsKCQkJCQlqUXVlcnkuZXZlbnQuYWRkKCBmb3JtLCAic3VibWl0Ll9zdWJtaXQiLCBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCQkJCWV2ZW50Ll9zdWJtaXRfYnViYmxlID0gdHJ1ZTsKCQkJCQl9KTsKCQkJCQlqUXVlcnkuX2RhdGEoIGZvcm0sICJzdWJtaXRCdWJibGVzIiwgdHJ1ZSApOwoJCQkJfQoJCQl9KTsKCQkJLy8gcmV0dXJuIHVuZGVmaW5lZCBzaW5jZSB3ZSBkb24ndCBuZWVkIGFuIGV2ZW50IGxpc3RlbmVyCgkJfSwKCgkJcG9zdERpc3BhdGNoOiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCS8vIElmIGZvcm0gd2FzIHN1Ym1pdHRlZCBieSB0aGUgdXNlciwgYnViYmxlIHRoZSBldmVudCB1cCB0aGUgdHJlZQoJCQlpZiAoIGV2ZW50Ll9zdWJtaXRfYnViYmxlICkgewoJCQkJZGVsZXRlIGV2ZW50Ll9zdWJtaXRfYnViYmxlOwoJCQkJaWYgKCB0aGlzLnBhcmVudE5vZGUgJiYgIWV2ZW50LmlzVHJpZ2dlciApIHsKCQkJCQlqUXVlcnkuZXZlbnQuc2ltdWxhdGUoICJzdWJtaXQiLCB0aGlzLnBhcmVudE5vZGUsIGV2ZW50LCB0cnVlICk7CgkJCQl9CgkJCX0KCQl9LAoKCQl0ZWFyZG93bjogZnVuY3Rpb24oKSB7CgkJCS8vIE9ubHkgbmVlZCB0aGlzIGZvciBkZWxlZ2F0ZWQgZm9ybSBzdWJtaXQgZXZlbnRzCgkJCWlmICggalF1ZXJ5Lm5vZGVOYW1lKCB0aGlzLCAiZm9ybSIgKSApIHsKCQkJCXJldHVybiBmYWxzZTsKCQkJfQoKCQkJLy8gUmVtb3ZlIGRlbGVnYXRlZCBoYW5kbGVyczsgY2xlYW5EYXRhIGV2ZW50dWFsbHkgcmVhcHMgc3VibWl0IGhhbmRsZXJzIGF0dGFjaGVkIGFib3ZlCgkJCWpRdWVyeS5ldmVudC5yZW1vdmUoIHRoaXMsICIuX3N1Ym1pdCIgKTsKCQl9Cgl9Owp9CgovLyBJRSBjaGFuZ2UgZGVsZWdhdGlvbiBhbmQgY2hlY2tib3gvcmFkaW8gZml4CmlmICggIWpRdWVyeS5zdXBwb3J0LmNoYW5nZUJ1YmJsZXMgKSB7CgoJalF1ZXJ5LmV2ZW50LnNwZWNpYWwuY2hhbmdlID0gewoKCQlzZXR1cDogZnVuY3Rpb24oKSB7CgoJCQlpZiAoIHJmb3JtRWxlbXMudGVzdCggdGhpcy5ub2RlTmFtZSApICkgewoJCQkJLy8gSUUgZG9lc24ndCBmaXJlIGNoYW5nZSBvbiBhIGNoZWNrL3JhZGlvIHVudGlsIGJsdXI7IHRyaWdnZXIgaXQgb24gY2xpY2sKCQkJCS8vIGFmdGVyIGEgcHJvcGVydHljaGFuZ2UuIEVhdCB0aGUgYmx1ci1jaGFuZ2UgaW4gc3BlY2lhbC5jaGFuZ2UuaGFuZGxlLgoJCQkJLy8gVGhpcyBzdGlsbCBmaXJlcyBvbmNoYW5nZSBhIHNlY29uZCB0aW1lIGZvciBjaGVjay9yYWRpbyBhZnRlciBibHVyLgoJCQkJaWYgKCB0aGlzLnR5cGUgPT09ICJjaGVja2JveCIgfHwgdGhpcy50eXBlID09PSAicmFkaW8iICkgewoJCQkJCWpRdWVyeS5ldmVudC5hZGQoIHRoaXMsICJwcm9wZXJ0eWNoYW5nZS5fY2hhbmdlIiwgZnVuY3Rpb24oIGV2ZW50ICkgewoJCQkJCQlpZiAoIGV2ZW50Lm9yaWdpbmFsRXZlbnQucHJvcGVydHlOYW1lID09PSAiY2hlY2tlZCIgKSB7CgkJCQkJCQl0aGlzLl9qdXN0X2NoYW5nZWQgPSB0cnVlOwoJCQkJCQl9CgkJCQkJfSk7CgkJCQkJalF1ZXJ5LmV2ZW50LmFkZCggdGhpcywgImNsaWNrLl9jaGFuZ2UiLCBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCQkJCWlmICggdGhpcy5fanVzdF9jaGFuZ2VkICYmICFldmVudC5pc1RyaWdnZXIgKSB7CgkJCQkJCQl0aGlzLl9qdXN0X2NoYW5nZWQgPSBmYWxzZTsKCQkJCQkJfQoJCQkJCQkvLyBBbGxvdyB0cmlnZ2VyZWQsIHNpbXVsYXRlZCBjaGFuZ2UgZXZlbnRzICgjMTE1MDApCgkJCQkJCWpRdWVyeS5ldmVudC5zaW11bGF0ZSggImNoYW5nZSIsIHRoaXMsIGV2ZW50LCB0cnVlICk7CgkJCQkJfSk7CgkJCQl9CgkJCQlyZXR1cm4gZmFsc2U7CgkJCX0KCQkJLy8gRGVsZWdhdGVkIGV2ZW50OyBsYXp5LWFkZCBhIGNoYW5nZSBoYW5kbGVyIG9uIGRlc2NlbmRhbnQgaW5wdXRzCgkJCWpRdWVyeS5ldmVudC5hZGQoIHRoaXMsICJiZWZvcmVhY3RpdmF0ZS5fY2hhbmdlIiwgZnVuY3Rpb24oIGUgKSB7CgkJCQl2YXIgZWxlbSA9IGUudGFyZ2V0OwoKCQkJCWlmICggcmZvcm1FbGVtcy50ZXN0KCBlbGVtLm5vZGVOYW1lICkgJiYgIWpRdWVyeS5fZGF0YSggZWxlbSwgImNoYW5nZUJ1YmJsZXMiICkgKSB7CgkJCQkJalF1ZXJ5LmV2ZW50LmFkZCggZWxlbSwgImNoYW5nZS5fY2hhbmdlIiwgZnVuY3Rpb24oIGV2ZW50ICkgewoJCQkJCQlpZiAoIHRoaXMucGFyZW50Tm9kZSAmJiAhZXZlbnQuaXNTaW11bGF0ZWQgJiYgIWV2ZW50LmlzVHJpZ2dlciApIHsKCQkJCQkJCWpRdWVyeS5ldmVudC5zaW11bGF0ZSggImNoYW5nZSIsIHRoaXMucGFyZW50Tm9kZSwgZXZlbnQsIHRydWUgKTsKCQkJCQkJfQoJCQkJCX0pOwoJCQkJCWpRdWVyeS5fZGF0YSggZWxlbSwgImNoYW5nZUJ1YmJsZXMiLCB0cnVlICk7CgkJCQl9CgkJCX0pOwoJCX0sCgoJCWhhbmRsZTogZnVuY3Rpb24oIGV2ZW50ICkgewoJCQl2YXIgZWxlbSA9IGV2ZW50LnRhcmdldDsKCgkJCS8vIFN3YWxsb3cgbmF0aXZlIGNoYW5nZSBldmVudHMgZnJvbSBjaGVja2JveC9yYWRpbywgd2UgYWxyZWFkeSB0cmlnZ2VyZWQgdGhlbSBhYm92ZQoJCQlpZiAoIHRoaXMgIT09IGVsZW0gfHwgZXZlbnQuaXNTaW11bGF0ZWQgfHwgZXZlbnQuaXNUcmlnZ2VyIHx8IChlbGVtLnR5cGUgIT09ICJyYWRpbyIgJiYgZWxlbS50eXBlICE9PSAiY2hlY2tib3giKSApIHsKCQkJCXJldHVybiBldmVudC5oYW5kbGVPYmouaGFuZGxlci5hcHBseSggdGhpcywgYXJndW1lbnRzICk7CgkJCX0KCQl9LAoKCQl0ZWFyZG93bjogZnVuY3Rpb24oKSB7CgkJCWpRdWVyeS5ldmVudC5yZW1vdmUoIHRoaXMsICIuX2NoYW5nZSIgKTsKCgkJCXJldHVybiAhcmZvcm1FbGVtcy50ZXN0KCB0aGlzLm5vZGVOYW1lICk7CgkJfQoJfTsKfQoKLy8gQ3JlYXRlICJidWJibGluZyIgZm9jdXMgYW5kIGJsdXIgZXZlbnRzCmlmICggIWpRdWVyeS5zdXBwb3J0LmZvY3VzaW5CdWJibGVzICkgewoJalF1ZXJ5LmVhY2goeyBmb2N1czogImZvY3VzaW4iLCBibHVyOiAiZm9jdXNvdXQiIH0sIGZ1bmN0aW9uKCBvcmlnLCBmaXggKSB7CgoJCS8vIEF0dGFjaCBhIHNpbmdsZSBjYXB0dXJpbmcgaGFuZGxlciB3aGlsZSBzb21lb25lIHdhbnRzIGZvY3VzaW4vZm9jdXNvdXQKCQl2YXIgYXR0YWNoZXMgPSAwLAoJCQloYW5kbGVyID0gZnVuY3Rpb24oIGV2ZW50ICkgewoJCQkJalF1ZXJ5LmV2ZW50LnNpbXVsYXRlKCBmaXgsIGV2ZW50LnRhcmdldCwgalF1ZXJ5LmV2ZW50LmZpeCggZXZlbnQgKSwgdHJ1ZSApOwoJCQl9OwoKCQlqUXVlcnkuZXZlbnQuc3BlY2lhbFsgZml4IF0gPSB7CgkJCXNldHVwOiBmdW5jdGlvbigpIHsKCQkJCWlmICggYXR0YWNoZXMrKyA9PT0gMCApIHsKCQkJCQlkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCBvcmlnLCBoYW5kbGVyLCB0cnVlICk7CgkJCQl9CgkJCX0sCgkJCXRlYXJkb3duOiBmdW5jdGlvbigpIHsKCQkJCWlmICggLS1hdHRhY2hlcyA9PT0gMCApIHsKCQkJCQlkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCBvcmlnLCBoYW5kbGVyLCB0cnVlICk7CgkJCQl9CgkJCX0KCQl9OwoJfSk7Cn0KCmpRdWVyeS5mbi5leHRlbmQoewoKCW9uOiBmdW5jdGlvbiggdHlwZXMsIHNlbGVjdG9yLCBkYXRhLCBmbiwgLypJTlRFUk5BTCovIG9uZSApIHsKCQl2YXIgdHlwZSwgb3JpZ0ZuOwoKCQkvLyBUeXBlcyBjYW4gYmUgYSBtYXAgb2YgdHlwZXMvaGFuZGxlcnMKCQlpZiAoIHR5cGVvZiB0eXBlcyA9PT0gIm9iamVjdCIgKSB7CgkJCS8vICggdHlwZXMtT2JqZWN0LCBzZWxlY3RvciwgZGF0YSApCgkJCWlmICggdHlwZW9mIHNlbGVjdG9yICE9PSAic3RyaW5nIiApIHsKCQkJCS8vICggdHlwZXMtT2JqZWN0LCBkYXRhICkKCQkJCWRhdGEgPSBkYXRhIHx8IHNlbGVjdG9yOwoJCQkJc2VsZWN0b3IgPSB1bmRlZmluZWQ7CgkJCX0KCQkJZm9yICggdHlwZSBpbiB0eXBlcyApIHsKCQkJCXRoaXMub24oIHR5cGUsIHNlbGVjdG9yLCBkYXRhLCB0eXBlc1sgdHlwZSBdLCBvbmUgKTsKCQkJfQoJCQlyZXR1cm4gdGhpczsKCQl9CgoJCWlmICggZGF0YSA9PSBudWxsICYmIGZuID09IG51bGwgKSB7CgkJCS8vICggdHlwZXMsIGZuICkKCQkJZm4gPSBzZWxlY3RvcjsKCQkJZGF0YSA9IHNlbGVjdG9yID0gdW5kZWZpbmVkOwoJCX0gZWxzZSBpZiAoIGZuID09IG51bGwgKSB7CgkJCWlmICggdHlwZW9mIHNlbGVjdG9yID09PSAic3RyaW5nIiApIHsKCQkJCS8vICggdHlwZXMsIHNlbGVjdG9yLCBmbiApCgkJCQlmbiA9IGRhdGE7CgkJCQlkYXRhID0gdW5kZWZpbmVkOwoJCQl9IGVsc2UgewoJCQkJLy8gKCB0eXBlcywgZGF0YSwgZm4gKQoJCQkJZm4gPSBkYXRhOwoJCQkJZGF0YSA9IHNlbGVjdG9yOwoJCQkJc2VsZWN0b3IgPSB1bmRlZmluZWQ7CgkJCX0KCQl9CgkJaWYgKCBmbiA9PT0gZmFsc2UgKSB7CgkJCWZuID0gcmV0dXJuRmFsc2U7CgkJfSBlbHNlIGlmICggIWZuICkgewoJCQlyZXR1cm4gdGhpczsKCQl9CgoJCWlmICggb25lID09PSAxICkgewoJCQlvcmlnRm4gPSBmbjsKCQkJZm4gPSBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCQkvLyBDYW4gdXNlIGFuIGVtcHR5IHNldCwgc2luY2UgZXZlbnQgY29udGFpbnMgdGhlIGluZm8KCQkJCWpRdWVyeSgpLm9mZiggZXZlbnQgKTsKCQkJCXJldHVybiBvcmlnRm4uYXBwbHkoIHRoaXMsIGFyZ3VtZW50cyApOwoJCQl9OwoJCQkvLyBVc2Ugc2FtZSBndWlkIHNvIGNhbGxlciBjYW4gcmVtb3ZlIHVzaW5nIG9yaWdGbgoJCQlmbi5ndWlkID0gb3JpZ0ZuLmd1aWQgfHwgKCBvcmlnRm4uZ3VpZCA9IGpRdWVyeS5ndWlkKysgKTsKCQl9CgkJcmV0dXJuIHRoaXMuZWFjaCggZnVuY3Rpb24oKSB7CgkJCWpRdWVyeS5ldmVudC5hZGQoIHRoaXMsIHR5cGVzLCBmbiwgZGF0YSwgc2VsZWN0b3IgKTsKCQl9KTsKCX0sCglvbmU6IGZ1bmN0aW9uKCB0eXBlcywgc2VsZWN0b3IsIGRhdGEsIGZuICkgewoJCXJldHVybiB0aGlzLm9uKCB0eXBlcywgc2VsZWN0b3IsIGRhdGEsIGZuLCAxICk7Cgl9LAoJb2ZmOiBmdW5jdGlvbiggdHlwZXMsIHNlbGVjdG9yLCBmbiApIHsKCQl2YXIgaGFuZGxlT2JqLCB0eXBlOwoJCWlmICggdHlwZXMgJiYgdHlwZXMucHJldmVudERlZmF1bHQgJiYgdHlwZXMuaGFuZGxlT2JqICkgewoJCQkvLyAoIGV2ZW50ICkgIGRpc3BhdGNoZWQgalF1ZXJ5LkV2ZW50CgkJCWhhbmRsZU9iaiA9IHR5cGVzLmhhbmRsZU9iajsKCQkJalF1ZXJ5KCB0eXBlcy5kZWxlZ2F0ZVRhcmdldCApLm9mZigKCQkJCWhhbmRsZU9iai5uYW1lc3BhY2UgPyBoYW5kbGVPYmoub3JpZ1R5cGUgKyAiLiIgKyBoYW5kbGVPYmoubmFtZXNwYWNlIDogaGFuZGxlT2JqLm9yaWdUeXBlLAoJCQkJaGFuZGxlT2JqLnNlbGVjdG9yLAoJCQkJaGFuZGxlT2JqLmhhbmRsZXIKCQkJKTsKCQkJcmV0dXJuIHRoaXM7CgkJfQoJCWlmICggdHlwZW9mIHR5cGVzID09PSAib2JqZWN0IiApIHsKCQkJLy8gKCB0eXBlcy1vYmplY3QgWywgc2VsZWN0b3JdICkKCQkJZm9yICggdHlwZSBpbiB0eXBlcyApIHsKCQkJCXRoaXMub2ZmKCB0eXBlLCBzZWxlY3RvciwgdHlwZXNbIHR5cGUgXSApOwoJCQl9CgkJCXJldHVybiB0aGlzOwoJCX0KCQlpZiAoIHNlbGVjdG9yID09PSBmYWxzZSB8fCB0eXBlb2Ygc2VsZWN0b3IgPT09ICJmdW5jdGlvbiIgKSB7CgkJCS8vICggdHlwZXMgWywgZm5dICkKCQkJZm4gPSBzZWxlY3RvcjsKCQkJc2VsZWN0b3IgPSB1bmRlZmluZWQ7CgkJfQoJCWlmICggZm4gPT09IGZhbHNlICkgewoJCQlmbiA9IHJldHVybkZhbHNlOwoJCX0KCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCQlqUXVlcnkuZXZlbnQucmVtb3ZlKCB0aGlzLCB0eXBlcywgZm4sIHNlbGVjdG9yICk7CgkJfSk7Cgl9LAoKCWJpbmQ6IGZ1bmN0aW9uKCB0eXBlcywgZGF0YSwgZm4gKSB7CgkJcmV0dXJuIHRoaXMub24oIHR5cGVzLCBudWxsLCBkYXRhLCBmbiApOwoJfSwKCXVuYmluZDogZnVuY3Rpb24oIHR5cGVzLCBmbiApIHsKCQlyZXR1cm4gdGhpcy5vZmYoIHR5cGVzLCBudWxsLCBmbiApOwoJfSwKCglkZWxlZ2F0ZTogZnVuY3Rpb24oIHNlbGVjdG9yLCB0eXBlcywgZGF0YSwgZm4gKSB7CgkJcmV0dXJuIHRoaXMub24oIHR5cGVzLCBzZWxlY3RvciwgZGF0YSwgZm4gKTsKCX0sCgl1bmRlbGVnYXRlOiBmdW5jdGlvbiggc2VsZWN0b3IsIHR5cGVzLCBmbiApIHsKCQkvLyAoIG5hbWVzcGFjZSApIG9yICggc2VsZWN0b3IsIHR5cGVzIFssIGZuXSApCgkJcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGggPT09IDEgPyB0aGlzLm9mZiggc2VsZWN0b3IsICIqKiIgKSA6IHRoaXMub2ZmKCB0eXBlcywgc2VsZWN0b3IgfHwgIioqIiwgZm4gKTsKCX0sCgoJdHJpZ2dlcjogZnVuY3Rpb24oIHR5cGUsIGRhdGEgKSB7CgkJcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKCQkJalF1ZXJ5LmV2ZW50LnRyaWdnZXIoIHR5cGUsIGRhdGEsIHRoaXMgKTsKCQl9KTsKCX0sCgl0cmlnZ2VySGFuZGxlcjogZnVuY3Rpb24oIHR5cGUsIGRhdGEgKSB7CgkJdmFyIGVsZW0gPSB0aGlzWzBdOwoJCWlmICggZWxlbSApIHsKCQkJcmV0dXJuIGpRdWVyeS5ldmVudC50cmlnZ2VyKCB0eXBlLCBkYXRhLCBlbGVtLCB0cnVlICk7CgkJfQoJfQp9KTsKLyohCiAqIFNpenpsZSBDU1MgU2VsZWN0b3IgRW5naW5lCiAqIENvcHlyaWdodCAyMDEyIGpRdWVyeSBGb3VuZGF0aW9uIGFuZCBvdGhlciBjb250cmlidXRvcnMKICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlCiAqIGh0dHA6Ly9zaXp6bGVqcy5jb20vCiAqLwooZnVuY3Rpb24oIHdpbmRvdywgdW5kZWZpbmVkICkgewoKdmFyIGksCgljYWNoZWRydW5zLAoJRXhwciwKCWdldFRleHQsCglpc1hNTCwKCWNvbXBpbGUsCgloYXNEdXBsaWNhdGUsCglvdXRlcm1vc3RDb250ZXh0LAoKCS8vIExvY2FsIGRvY3VtZW50IHZhcnMKCXNldERvY3VtZW50LAoJZG9jdW1lbnQsCglkb2NFbGVtLAoJZG9jdW1lbnRJc1hNTCwKCXJidWdneVFTQSwKCXJidWdneU1hdGNoZXMsCgltYXRjaGVzLAoJY29udGFpbnMsCglzb3J0T3JkZXIsCgoJLy8gSW5zdGFuY2Utc3BlY2lmaWMgZGF0YQoJZXhwYW5kbyA9ICJzaXp6bGUiICsgLShuZXcgRGF0ZSgpKSwKCXByZWZlcnJlZERvYyA9IHdpbmRvdy5kb2N1bWVudCwKCXN1cHBvcnQgPSB7fSwKCWRpcnJ1bnMgPSAwLAoJZG9uZSA9IDAsCgljbGFzc0NhY2hlID0gY3JlYXRlQ2FjaGUoKSwKCXRva2VuQ2FjaGUgPSBjcmVhdGVDYWNoZSgpLAoJY29tcGlsZXJDYWNoZSA9IGNyZWF0ZUNhY2hlKCksCgoJLy8gR2VuZXJhbC1wdXJwb3NlIGNvbnN0YW50cwoJc3RydW5kZWZpbmVkID0gdHlwZW9mIHVuZGVmaW5lZCwKCU1BWF9ORUdBVElWRSA9IDEgPDwgMzEsCgoJLy8gQXJyYXkgbWV0aG9kcwoJYXJyID0gW10sCglwb3AgPSBhcnIucG9wLAoJcHVzaCA9IGFyci5wdXNoLAoJc2xpY2UgPSBhcnIuc2xpY2UsCgkvLyBVc2UgYSBzdHJpcHBlZC1kb3duIGluZGV4T2YgaWYgd2UgY2FuJ3QgdXNlIGEgbmF0aXZlIG9uZQoJaW5kZXhPZiA9IGFyci5pbmRleE9mIHx8IGZ1bmN0aW9uKCBlbGVtICkgewoJCXZhciBpID0gMCwKCQkJbGVuID0gdGhpcy5sZW5ndGg7CgkJZm9yICggOyBpIDwgbGVuOyBpKysgKSB7CgkJCWlmICggdGhpc1tpXSA9PT0gZWxlbSApIHsKCQkJCXJldHVybiBpOwoJCQl9CgkJfQoJCXJldHVybiAtMTsKCX0sCgoKCS8vIFJlZ3VsYXIgZXhwcmVzc2lvbnMKCgkvLyBXaGl0ZXNwYWNlIGNoYXJhY3RlcnMgaHR0cDovL3d3dy53My5vcmcvVFIvY3NzMy1zZWxlY3RvcnMvI3doaXRlc3BhY2UKCXdoaXRlc3BhY2UgPSAiW1xceDIwXFx0XFxyXFxuXFxmXSIsCgkvLyBodHRwOi8vd3d3LnczLm9yZy9UUi9jc3MzLXN5bnRheC8jY2hhcmFjdGVycwoJY2hhcmFjdGVyRW5jb2RpbmcgPSAiKD86XFxcXC58W1xcdy1dfFteXFx4MDAtXFx4YTBdKSsiLAoKCS8vIExvb3NlbHkgbW9kZWxlZCBvbiBDU1MgaWRlbnRpZmllciBjaGFyYWN0ZXJzCgkvLyBBbiB1bnF1b3RlZCB2YWx1ZSBzaG91bGQgYmUgYSBDU1MgaWRlbnRpZmllciBodHRwOi8vd3d3LnczLm9yZy9UUi9jc3MzLXNlbGVjdG9ycy8jYXR0cmlidXRlLXNlbGVjdG9ycwoJLy8gUHJvcGVyIHN5bnRheDogaHR0cDovL3d3dy53My5vcmcvVFIvQ1NTMjEvc3luZGF0YS5odG1sI3ZhbHVlLWRlZi1pZGVudGlmaWVyCglpZGVudGlmaWVyID0gY2hhcmFjdGVyRW5jb2RpbmcucmVwbGFjZSggInciLCAidyMiICksCgoJLy8gQWNjZXB0YWJsZSBvcGVyYXRvcnMgaHR0cDovL3d3dy53My5vcmcvVFIvc2VsZWN0b3JzLyNhdHRyaWJ1dGUtc2VsZWN0b3JzCglvcGVyYXRvcnMgPSAiKFsqXiR8IX5dPz0pIiwKCWF0dHJpYnV0ZXMgPSAiXFxbIiArIHdoaXRlc3BhY2UgKyAiKigiICsgY2hhcmFjdGVyRW5jb2RpbmcgKyAiKSIgKyB3aGl0ZXNwYWNlICsKCQkiKig/OiIgKyBvcGVyYXRvcnMgKyB3aGl0ZXNwYWNlICsgIiooPzooWydcIl0pKCg/OlxcXFwufFteXFxcXF0pKj8pXFwzfCgiICsgaWRlbnRpZmllciArICIpfCl8KSIgKyB3aGl0ZXNwYWNlICsgIipcXF0iLAoKCS8vIFByZWZlciBhcmd1bWVudHMgcXVvdGVkLAoJLy8gICB0aGVuIG5vdCBjb250YWluaW5nIHBzZXVkb3MvYnJhY2tldHMsCgkvLyAgIHRoZW4gYXR0cmlidXRlIHNlbGVjdG9ycy9ub24tcGFyZW50aGV0aWNhbCBleHByZXNzaW9ucywKCS8vICAgdGhlbiBhbnl0aGluZyBlbHNlCgkvLyBUaGVzZSBwcmVmZXJlbmNlcyBhcmUgaGVyZSB0byByZWR1Y2UgdGhlIG51bWJlciBvZiBzZWxlY3RvcnMKCS8vICAgbmVlZGluZyB0b2tlbml6ZSBpbiB0aGUgUFNFVURPIHByZUZpbHRlcgoJcHNldWRvcyA9ICI6KCIgKyBjaGFyYWN0ZXJFbmNvZGluZyArICIpKD86XFwoKChbJ1wiXSkoKD86XFxcXC58W15cXFxcXSkqPylcXDN8KCg/OlxcXFwufFteXFxcXCgpW1xcXV18IiArIGF0dHJpYnV0ZXMucmVwbGFjZSggMywgOCApICsgIikqKXwuKilcXCl8KSIsCgoJLy8gTGVhZGluZyBhbmQgbm9uLWVzY2FwZWQgdHJhaWxpbmcgd2hpdGVzcGFjZSwgY2FwdHVyaW5nIHNvbWUgbm9uLXdoaXRlc3BhY2UgY2hhcmFjdGVycyBwcmVjZWRpbmcgdGhlIGxhdHRlcgoJcnRyaW0gPSBuZXcgUmVnRXhwKCAiXiIgKyB3aGl0ZXNwYWNlICsgIit8KCg/Ol58W15cXFxcXSkoPzpcXFxcLikqKSIgKyB3aGl0ZXNwYWNlICsgIiskIiwgImciICksCgoJcmNvbW1hID0gbmV3IFJlZ0V4cCggIl4iICsgd2hpdGVzcGFjZSArICIqLCIgKyB3aGl0ZXNwYWNlICsgIioiICksCglyY29tYmluYXRvcnMgPSBuZXcgUmVnRXhwKCAiXiIgKyB3aGl0ZXNwYWNlICsgIiooW1xceDIwXFx0XFxyXFxuXFxmPit+XSkiICsgd2hpdGVzcGFjZSArICIqIiApLAoJcnBzZXVkbyA9IG5ldyBSZWdFeHAoIHBzZXVkb3MgKSwKCXJpZGVudGlmaWVyID0gbmV3IFJlZ0V4cCggIl4iICsgaWRlbnRpZmllciArICIkIiApLAoKCW1hdGNoRXhwciA9IHsKCQkiSUQiOiBuZXcgUmVnRXhwKCAiXiMoIiArIGNoYXJhY3RlckVuY29kaW5nICsgIikiICksCgkJIkNMQVNTIjogbmV3IFJlZ0V4cCggIl5cXC4oIiArIGNoYXJhY3RlckVuY29kaW5nICsgIikiICksCgkJIk5BTUUiOiBuZXcgUmVnRXhwKCAiXlxcW25hbWU9WydcIl0/KCIgKyBjaGFyYWN0ZXJFbmNvZGluZyArICIpWydcIl0/XFxdIiApLAoJCSJUQUciOiBuZXcgUmVnRXhwKCAiXigiICsgY2hhcmFjdGVyRW5jb2RpbmcucmVwbGFjZSggInciLCAidyoiICkgKyAiKSIgKSwKCQkiQVRUUiI6IG5ldyBSZWdFeHAoICJeIiArIGF0dHJpYnV0ZXMgKSwKCQkiUFNFVURPIjogbmV3IFJlZ0V4cCggIl4iICsgcHNldWRvcyApLAoJCSJDSElMRCI6IG5ldyBSZWdFeHAoICJeOihvbmx5fGZpcnN0fGxhc3R8bnRofG50aC1sYXN0KS0oY2hpbGR8b2YtdHlwZSkoPzpcXCgiICsgd2hpdGVzcGFjZSArCgkJCSIqKGV2ZW58b2RkfCgoWystXXwpKFxcZCopbnwpIiArIHdoaXRlc3BhY2UgKyAiKig/OihbKy1dfCkiICsgd2hpdGVzcGFjZSArCgkJCSIqKFxcZCspfCkpIiArIHdoaXRlc3BhY2UgKyAiKlxcKXwpIiwgImkiICksCgkJLy8gRm9yIHVzZSBpbiBsaWJyYXJpZXMgaW1wbGVtZW50aW5nIC5pcygpCgkJLy8gV2UgdXNlIHRoaXMgZm9yIFBPUyBtYXRjaGluZyBpbiBgc2VsZWN0YAoJCSJuZWVkc0NvbnRleHQiOiBuZXcgUmVnRXhwKCAiXiIgKyB3aGl0ZXNwYWNlICsgIipbPit+XXw6KGV2ZW58b2RkfGVxfGd0fGx0fG50aHxmaXJzdHxsYXN0KSg/OlxcKCIgKwoJCQl3aGl0ZXNwYWNlICsgIiooKD86LVxcZCk/XFxkKikiICsgd2hpdGVzcGFjZSArICIqXFwpfCkoPz1bXi1dfCQpIiwgImkiICkKCX0sCgoJcnNpYmxpbmcgPSAvW1x4MjBcdFxyXG5cZl0qWyt+XS8sCgoJcm5hdGl2ZSA9IC9eW157XStce1xzKlxbbmF0aXZlIGNvZGUvLAoKCS8vIEVhc2lseS1wYXJzZWFibGUvcmV0cmlldmFibGUgSUQgb3IgVEFHIG9yIENMQVNTIHNlbGVjdG9ycwoJcnF1aWNrRXhwciA9IC9eKD86IyhbXHctXSspfChcdyspfFwuKFtcdy1dKykpJC8sCgoJcmlucHV0cyA9IC9eKD86aW5wdXR8c2VsZWN0fHRleHRhcmVhfGJ1dHRvbikkL2ksCglyaGVhZGVyID0gL15oXGQkL2ksCgoJcmVzY2FwZSA9IC8nfFxcL2csCglyYXR0cmlidXRlUXVvdGVzID0gL1w9W1x4MjBcdFxyXG5cZl0qKFteJyJcXV0qKVtceDIwXHRcclxuXGZdKlxdL2csCgoJLy8gQ1NTIGVzY2FwZXMgaHR0cDovL3d3dy53My5vcmcvVFIvQ1NTMjEvc3luZGF0YS5odG1sI2VzY2FwZWQtY2hhcmFjdGVycwoJcnVuZXNjYXBlID0gL1xcKFtcZGEtZkEtRl17MSw2fVtceDIwXHRcclxuXGZdP3wuKS9nLAoJZnVuZXNjYXBlID0gZnVuY3Rpb24oIF8sIGVzY2FwZWQgKSB7CgkJdmFyIGhpZ2ggPSAiMHgiICsgZXNjYXBlZCAtIDB4MTAwMDA7CgkJLy8gTmFOIG1lYW5zIG5vbi1jb2RlcG9pbnQKCQlyZXR1cm4gaGlnaCAhPT0gaGlnaCA/CgkJCWVzY2FwZWQgOgoJCQkvLyBCTVAgY29kZXBvaW50CgkJCWhpZ2ggPCAwID8KCQkJCVN0cmluZy5mcm9tQ2hhckNvZGUoIGhpZ2ggKyAweDEwMDAwICkgOgoJCQkJLy8gU3VwcGxlbWVudGFsIFBsYW5lIGNvZGVwb2ludCAoc3Vycm9nYXRlIHBhaXIpCgkJCQlTdHJpbmcuZnJvbUNoYXJDb2RlKCBoaWdoID4+IDEwIHwgMHhEODAwLCBoaWdoICYgMHgzRkYgfCAweERDMDAgKTsKCX07CgovLyBVc2UgYSBzdHJpcHBlZC1kb3duIHNsaWNlIGlmIHdlIGNhbid0IHVzZSBhIG5hdGl2ZSBvbmUKdHJ5IHsKCXNsaWNlLmNhbGwoIHByZWZlcnJlZERvYy5kb2N1bWVudEVsZW1lbnQuY2hpbGROb2RlcywgMCApWzBdLm5vZGVUeXBlOwp9IGNhdGNoICggZSApIHsKCXNsaWNlID0gZnVuY3Rpb24oIGkgKSB7CgkJdmFyIGVsZW0sCgkJCXJlc3VsdHMgPSBbXTsKCQl3aGlsZSAoIChlbGVtID0gdGhpc1tpKytdKSApIHsKCQkJcmVzdWx0cy5wdXNoKCBlbGVtICk7CgkJfQoJCXJldHVybiByZXN1bHRzOwoJfTsKfQoKLyoqCiAqIEZvciBmZWF0dXJlIGRldGVjdGlvbgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbiBUaGUgZnVuY3Rpb24gdG8gdGVzdCBmb3IgbmF0aXZlIHN1cHBvcnQKICovCmZ1bmN0aW9uIGlzTmF0aXZlKCBmbiApIHsKCXJldHVybiBybmF0aXZlLnRlc3QoIGZuICsgIiIgKTsKfQoKLyoqCiAqIENyZWF0ZSBrZXktdmFsdWUgY2FjaGVzIG9mIGxpbWl0ZWQgc2l6ZQogKiBAcmV0dXJucyB7RnVuY3Rpb24oc3RyaW5nLCBPYmplY3QpfSBSZXR1cm5zIHRoZSBPYmplY3QgZGF0YSBhZnRlciBzdG9yaW5nIGl0IG9uIGl0c2VsZiB3aXRoCiAqCXByb3BlcnR5IG5hbWUgdGhlIChzcGFjZS1zdWZmaXhlZCkgc3RyaW5nIGFuZCAoaWYgdGhlIGNhY2hlIGlzIGxhcmdlciB0aGFuIEV4cHIuY2FjaGVMZW5ndGgpCiAqCWRlbGV0aW5nIHRoZSBvbGRlc3QgZW50cnkKICovCmZ1bmN0aW9uIGNyZWF0ZUNhY2hlKCkgewoJdmFyIGNhY2hlLAoJCWtleXMgPSBbXTsKCglyZXR1cm4gKGNhY2hlID0gZnVuY3Rpb24oIGtleSwgdmFsdWUgKSB7CgkJLy8gVXNlIChrZXkgKyAiICIpIHRvIGF2b2lkIGNvbGxpc2lvbiB3aXRoIG5hdGl2ZSBwcm90b3R5cGUgcHJvcGVydGllcyAoc2VlIElzc3VlICMxNTcpCgkJaWYgKCBrZXlzLnB1c2goIGtleSArPSAiICIgKSA+IEV4cHIuY2FjaGVMZW5ndGggKSB7CgkJCS8vIE9ubHkga2VlcCB0aGUgbW9zdCByZWNlbnQgZW50cmllcwoJCQlkZWxldGUgY2FjaGVbIGtleXMuc2hpZnQoKSBdOwoJCX0KCQlyZXR1cm4gKGNhY2hlWyBrZXkgXSA9IHZhbHVlKTsKCX0pOwp9CgovKioKICogTWFyayBhIGZ1bmN0aW9uIGZvciBzcGVjaWFsIHVzZSBieSBTaXp6bGUKICogQHBhcmFtIHtGdW5jdGlvbn0gZm4gVGhlIGZ1bmN0aW9uIHRvIG1hcmsKICovCmZ1bmN0aW9uIG1hcmtGdW5jdGlvbiggZm4gKSB7CglmblsgZXhwYW5kbyBdID0gdHJ1ZTsKCXJldHVybiBmbjsKfQoKLyoqCiAqIFN1cHBvcnQgdGVzdGluZyB1c2luZyBhbiBlbGVtZW50CiAqIEBwYXJhbSB7RnVuY3Rpb259IGZuIFBhc3NlZCB0aGUgY3JlYXRlZCBkaXYgYW5kIGV4cGVjdHMgYSBib29sZWFuIHJlc3VsdAogKi8KZnVuY3Rpb24gYXNzZXJ0KCBmbiApIHsKCXZhciBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKCgl0cnkgewoJCXJldHVybiBmbiggZGl2ICk7Cgl9IGNhdGNoIChlKSB7CgkJcmV0dXJuIGZhbHNlOwoJfSBmaW5hbGx5IHsKCQkvLyByZWxlYXNlIG1lbW9yeSBpbiBJRQoJCWRpdiA9IG51bGw7Cgl9Cn0KCmZ1bmN0aW9uIFNpenpsZSggc2VsZWN0b3IsIGNvbnRleHQsIHJlc3VsdHMsIHNlZWQgKSB7Cgl2YXIgbWF0Y2gsIGVsZW0sIG0sIG5vZGVUeXBlLAoJCS8vIFFTQSB2YXJzCgkJaSwgZ3JvdXBzLCBvbGQsIG5pZCwgbmV3Q29udGV4dCwgbmV3U2VsZWN0b3I7CgoJaWYgKCAoIGNvbnRleHQgPyBjb250ZXh0Lm93bmVyRG9jdW1lbnQgfHwgY29udGV4dCA6IHByZWZlcnJlZERvYyApICE9PSBkb2N1bWVudCApIHsKCQlzZXREb2N1bWVudCggY29udGV4dCApOwoJfQoKCWNvbnRleHQgPSBjb250ZXh0IHx8IGRvY3VtZW50OwoJcmVzdWx0cyA9IHJlc3VsdHMgfHwgW107CgoJaWYgKCAhc2VsZWN0b3IgfHwgdHlwZW9mIHNlbGVjdG9yICE9PSAic3RyaW5nIiApIHsKCQlyZXR1cm4gcmVzdWx0czsKCX0KCglpZiAoIChub2RlVHlwZSA9IGNvbnRleHQubm9kZVR5cGUpICE9PSAxICYmIG5vZGVUeXBlICE9PSA5ICkgewoJCXJldHVybiBbXTsKCX0KCglpZiAoICFkb2N1bWVudElzWE1MICYmICFzZWVkICkgewoKCQkvLyBTaG9ydGN1dHMKCQlpZiAoIChtYXRjaCA9IHJxdWlja0V4cHIuZXhlYyggc2VsZWN0b3IgKSkgKSB7CgkJCS8vIFNwZWVkLXVwOiBTaXp6bGUoIiNJRCIpCgkJCWlmICggKG0gPSBtYXRjaFsxXSkgKSB7CgkJCQlpZiAoIG5vZGVUeXBlID09PSA5ICkgewoJCQkJCWVsZW0gPSBjb250ZXh0LmdldEVsZW1lbnRCeUlkKCBtICk7CgkJCQkJLy8gQ2hlY2sgcGFyZW50Tm9kZSB0byBjYXRjaCB3aGVuIEJsYWNrYmVycnkgNC42IHJldHVybnMKCQkJCQkvLyBub2RlcyB0aGF0IGFyZSBubyBsb25nZXIgaW4gdGhlIGRvY3VtZW50ICM2OTYzCgkJCQkJaWYgKCBlbGVtICYmIGVsZW0ucGFyZW50Tm9kZSApIHsKCQkJCQkJLy8gSGFuZGxlIHRoZSBjYXNlIHdoZXJlIElFLCBPcGVyYSwgYW5kIFdlYmtpdCByZXR1cm4gaXRlbXMKCQkJCQkJLy8gYnkgbmFtZSBpbnN0ZWFkIG9mIElECgkJCQkJCWlmICggZWxlbS5pZCA9PT0gbSApIHsKCQkJCQkJCXJlc3VsdHMucHVzaCggZWxlbSApOwoJCQkJCQkJcmV0dXJuIHJlc3VsdHM7CgkJCQkJCX0KCQkJCQl9IGVsc2UgewoJCQkJCQlyZXR1cm4gcmVzdWx0czsKCQkJCQl9CgkJCQl9IGVsc2UgewoJCQkJCS8vIENvbnRleHQgaXMgbm90IGEgZG9jdW1lbnQKCQkJCQlpZiAoIGNvbnRleHQub3duZXJEb2N1bWVudCAmJiAoZWxlbSA9IGNvbnRleHQub3duZXJEb2N1bWVudC5nZXRFbGVtZW50QnlJZCggbSApKSAmJgoJCQkJCQljb250YWlucyggY29udGV4dCwgZWxlbSApICYmIGVsZW0uaWQgPT09IG0gKSB7CgkJCQkJCXJlc3VsdHMucHVzaCggZWxlbSApOwoJCQkJCQlyZXR1cm4gcmVzdWx0czsKCQkJCQl9CgkJCQl9CgoJCQkvLyBTcGVlZC11cDogU2l6emxlKCJUQUciKQoJCQl9IGVsc2UgaWYgKCBtYXRjaFsyXSApIHsKCQkJCXB1c2guYXBwbHkoIHJlc3VsdHMsIHNsaWNlLmNhbGwoY29udGV4dC5nZXRFbGVtZW50c0J5VGFnTmFtZSggc2VsZWN0b3IgKSwgMCkgKTsKCQkJCXJldHVybiByZXN1bHRzOwoKCQkJLy8gU3BlZWQtdXA6IFNpenpsZSgiLkNMQVNTIikKCQkJfSBlbHNlIGlmICggKG0gPSBtYXRjaFszXSkgJiYgc3VwcG9ydC5nZXRCeUNsYXNzTmFtZSAmJiBjb250ZXh0LmdldEVsZW1lbnRzQnlDbGFzc05hbWUgKSB7CgkJCQlwdXNoLmFwcGx5KCByZXN1bHRzLCBzbGljZS5jYWxsKGNvbnRleHQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSggbSApLCAwKSApOwoJCQkJcmV0dXJuIHJlc3VsdHM7CgkJCX0KCQl9CgoJCS8vIFFTQSBwYXRoCgkJaWYgKCBzdXBwb3J0LnFzYSAmJiAhcmJ1Z2d5UVNBLnRlc3Qoc2VsZWN0b3IpICkgewoJCQlvbGQgPSB0cnVlOwoJCQluaWQgPSBleHBhbmRvOwoJCQluZXdDb250ZXh0ID0gY29udGV4dDsKCQkJbmV3U2VsZWN0b3IgPSBub2RlVHlwZSA9PT0gOSAmJiBzZWxlY3RvcjsKCgkJCS8vIHFTQSB3b3JrcyBzdHJhbmdlbHkgb24gRWxlbWVudC1yb290ZWQgcXVlcmllcwoJCQkvLyBXZSBjYW4gd29yayBhcm91bmQgdGhpcyBieSBzcGVjaWZ5aW5nIGFuIGV4dHJhIElEIG9uIHRoZSByb290CgkJCS8vIGFuZCB3b3JraW5nIHVwIGZyb20gdGhlcmUgKFRoYW5rcyB0byBBbmRyZXcgRHVwb250IGZvciB0aGUgdGVjaG5pcXVlKQoJCQkvLyBJRSA4IGRvZXNuJ3Qgd29yayBvbiBvYmplY3QgZWxlbWVudHMKCQkJaWYgKCBub2RlVHlwZSA9PT0gMSAmJiBjb250ZXh0Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgIT09ICJvYmplY3QiICkgewoJCQkJZ3JvdXBzID0gdG9rZW5pemUoIHNlbGVjdG9yICk7CgoJCQkJaWYgKCAob2xkID0gY29udGV4dC5nZXRBdHRyaWJ1dGUoImlkIikpICkgewoJCQkJCW5pZCA9IG9sZC5yZXBsYWNlKCByZXNjYXBlLCAiXFwkJiIgKTsKCQkJCX0gZWxzZSB7CgkJCQkJY29udGV4dC5zZXRBdHRyaWJ1dGUoICJpZCIsIG5pZCApOwoJCQkJfQoJCQkJbmlkID0gIltpZD0nIiArIG5pZCArICInXSAiOwoKCQkJCWkgPSBncm91cHMubGVuZ3RoOwoJCQkJd2hpbGUgKCBpLS0gKSB7CgkJCQkJZ3JvdXBzW2ldID0gbmlkICsgdG9TZWxlY3RvciggZ3JvdXBzW2ldICk7CgkJCQl9CgkJCQluZXdDb250ZXh0ID0gcnNpYmxpbmcudGVzdCggc2VsZWN0b3IgKSAmJiBjb250ZXh0LnBhcmVudE5vZGUgfHwgY29udGV4dDsKCQkJCW5ld1NlbGVjdG9yID0gZ3JvdXBzLmpvaW4oIiwiKTsKCQkJfQoKCQkJaWYgKCBuZXdTZWxlY3RvciApIHsKCQkJCXRyeSB7CgkJCQkJcHVzaC5hcHBseSggcmVzdWx0cywgc2xpY2UuY2FsbCggbmV3Q29udGV4dC5xdWVyeVNlbGVjdG9yQWxsKAoJCQkJCQluZXdTZWxlY3RvcgoJCQkJCSksIDAgKSApOwoJCQkJCXJldHVybiByZXN1bHRzOwoJCQkJfSBjYXRjaChxc2FFcnJvcikgewoJCQkJfSBmaW5hbGx5IHsKCQkJCQlpZiAoICFvbGQgKSB7CgkJCQkJCWNvbnRleHQucmVtb3ZlQXR0cmlidXRlKCJpZCIpOwoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCX0KCgkvLyBBbGwgb3RoZXJzCglyZXR1cm4gc2VsZWN0KCBzZWxlY3Rvci5yZXBsYWNlKCBydHJpbSwgIiQxIiApLCBjb250ZXh0LCByZXN1bHRzLCBzZWVkICk7Cn0KCi8qKgogKiBEZXRlY3QgeG1sCiAqIEBwYXJhbSB7RWxlbWVudHxPYmplY3R9IGVsZW0gQW4gZWxlbWVudCBvciBhIGRvY3VtZW50CiAqLwppc1hNTCA9IFNpenpsZS5pc1hNTCA9IGZ1bmN0aW9uKCBlbGVtICkgewoJLy8gZG9jdW1lbnRFbGVtZW50IGlzIHZlcmlmaWVkIGZvciBjYXNlcyB3aGVyZSBpdCBkb2Vzbid0IHlldCBleGlzdAoJLy8gKHN1Y2ggYXMgbG9hZGluZyBpZnJhbWVzIGluIElFIC0gIzQ4MzMpCgl2YXIgZG9jdW1lbnRFbGVtZW50ID0gZWxlbSAmJiAoZWxlbS5vd25lckRvY3VtZW50IHx8IGVsZW0pLmRvY3VtZW50RWxlbWVudDsKCXJldHVybiBkb2N1bWVudEVsZW1lbnQgPyBkb2N1bWVudEVsZW1lbnQubm9kZU5hbWUgIT09ICJIVE1MIiA6IGZhbHNlOwp9OwoKLyoqCiAqIFNldHMgZG9jdW1lbnQtcmVsYXRlZCB2YXJpYWJsZXMgb25jZSBiYXNlZCBvbiB0aGUgY3VycmVudCBkb2N1bWVudAogKiBAcGFyYW0ge0VsZW1lbnR8T2JqZWN0fSBbZG9jXSBBbiBlbGVtZW50IG9yIGRvY3VtZW50IG9iamVjdCB0byB1c2UgdG8gc2V0IHRoZSBkb2N1bWVudAogKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBjdXJyZW50IGRvY3VtZW50CiAqLwpzZXREb2N1bWVudCA9IFNpenpsZS5zZXREb2N1bWVudCA9IGZ1bmN0aW9uKCBub2RlICkgewoJdmFyIGRvYyA9IG5vZGUgPyBub2RlLm93bmVyRG9jdW1lbnQgfHwgbm9kZSA6IHByZWZlcnJlZERvYzsKCgkvLyBJZiBubyBkb2N1bWVudCBhbmQgZG9jdW1lbnRFbGVtZW50IGlzIGF2YWlsYWJsZSwgcmV0dXJuCglpZiAoIGRvYyA9PT0gZG9jdW1lbnQgfHwgZG9jLm5vZGVUeXBlICE9PSA5IHx8ICFkb2MuZG9jdW1lbnRFbGVtZW50ICkgewoJCXJldHVybiBkb2N1bWVudDsKCX0KCgkvLyBTZXQgb3VyIGRvY3VtZW50Cglkb2N1bWVudCA9IGRvYzsKCWRvY0VsZW0gPSBkb2MuZG9jdW1lbnRFbGVtZW50OwoKCS8vIFN1cHBvcnQgdGVzdHMKCWRvY3VtZW50SXNYTUwgPSBpc1hNTCggZG9jICk7CgoJLy8gQ2hlY2sgaWYgZ2V0RWxlbWVudHNCeVRhZ05hbWUoIioiKSByZXR1cm5zIG9ubHkgZWxlbWVudHMKCXN1cHBvcnQudGFnTmFtZU5vQ29tbWVudHMgPSBhc3NlcnQoZnVuY3Rpb24oIGRpdiApIHsKCQlkaXYuYXBwZW5kQ2hpbGQoIGRvYy5jcmVhdGVDb21tZW50KCIiKSApOwoJCXJldHVybiAhZGl2LmdldEVsZW1lbnRzQnlUYWdOYW1lKCIqIikubGVuZ3RoOwoJfSk7CgoJLy8gQ2hlY2sgaWYgYXR0cmlidXRlcyBzaG91bGQgYmUgcmV0cmlldmVkIGJ5IGF0dHJpYnV0ZSBub2RlcwoJc3VwcG9ydC5hdHRyaWJ1dGVzID0gYXNzZXJ0KGZ1bmN0aW9uKCBkaXYgKSB7CgkJZGl2LmlubmVySFRNTCA9ICI8c2VsZWN0Pjwvc2VsZWN0PiI7CgkJdmFyIHR5cGUgPSB0eXBlb2YgZGl2Lmxhc3RDaGlsZC5nZXRBdHRyaWJ1dGUoIm11bHRpcGxlIik7CgkJLy8gSUU4IHJldHVybnMgYSBzdHJpbmcgZm9yIHNvbWUgYXR0cmlidXRlcyBldmVuIHdoZW4gbm90IHByZXNlbnQKCQlyZXR1cm4gdHlwZSAhPT0gImJvb2xlYW4iICYmIHR5cGUgIT09ICJzdHJpbmciOwoJfSk7CgoJLy8gQ2hlY2sgaWYgZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSBjYW4gYmUgdHJ1c3RlZAoJc3VwcG9ydC5nZXRCeUNsYXNzTmFtZSA9IGFzc2VydChmdW5jdGlvbiggZGl2ICkgewoJCS8vIE9wZXJhIGNhbid0IGZpbmQgYSBzZWNvbmQgY2xhc3NuYW1lIChpbiA5LjYpCgkJZGl2LmlubmVySFRNTCA9ICI8ZGl2IGNsYXNzPSdoaWRkZW4gZSc+PC9kaXY+PGRpdiBjbGFzcz0naGlkZGVuJz48L2Rpdj4iOwoJCWlmICggIWRpdi5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lIHx8ICFkaXYuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgiZSIpLmxlbmd0aCApIHsKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCgkJLy8gU2FmYXJpIDMuMiBjYWNoZXMgY2xhc3MgYXR0cmlidXRlcyBhbmQgZG9lc24ndCBjYXRjaCBjaGFuZ2VzCgkJZGl2Lmxhc3RDaGlsZC5jbGFzc05hbWUgPSAiZSI7CgkJcmV0dXJuIGRpdi5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCJlIikubGVuZ3RoID09PSAyOwoJfSk7CgoJLy8gQ2hlY2sgaWYgZ2V0RWxlbWVudEJ5SWQgcmV0dXJucyBlbGVtZW50cyBieSBuYW1lCgkvLyBDaGVjayBpZiBnZXRFbGVtZW50c0J5TmFtZSBwcml2aWxlZ2VzIGZvcm0gY29udHJvbHMgb3IgcmV0dXJucyBlbGVtZW50cyBieSBJRAoJc3VwcG9ydC5nZXRCeU5hbWUgPSBhc3NlcnQoZnVuY3Rpb24oIGRpdiApIHsKCQkvLyBJbmplY3QgY29udGVudAoJCWRpdi5pZCA9IGV4cGFuZG8gKyAwOwoJCWRpdi5pbm5lckhUTUwgPSAiPGEgbmFtZT0nIiArIGV4cGFuZG8gKyAiJz48L2E+PGRpdiBuYW1lPSciICsgZXhwYW5kbyArICInPjwvZGl2PiI7CgkJZG9jRWxlbS5pbnNlcnRCZWZvcmUoIGRpdiwgZG9jRWxlbS5maXJzdENoaWxkICk7CgoJCS8vIFRlc3QKCQl2YXIgcGFzcyA9IGRvYy5nZXRFbGVtZW50c0J5TmFtZSAmJgoJCQkvLyBidWdneSBicm93c2VycyB3aWxsIHJldHVybiBmZXdlciB0aGFuIHRoZSBjb3JyZWN0IDIKCQkJZG9jLmdldEVsZW1lbnRzQnlOYW1lKCBleHBhbmRvICkubGVuZ3RoID09PSAyICsKCQkJLy8gYnVnZ3kgYnJvd3NlcnMgd2lsbCByZXR1cm4gbW9yZSB0aGFuIHRoZSBjb3JyZWN0IDAKCQkJZG9jLmdldEVsZW1lbnRzQnlOYW1lKCBleHBhbmRvICsgMCApLmxlbmd0aDsKCQlzdXBwb3J0LmdldElkTm90TmFtZSA9ICFkb2MuZ2V0RWxlbWVudEJ5SWQoIGV4cGFuZG8gKTsKCgkJLy8gQ2xlYW51cAoJCWRvY0VsZW0ucmVtb3ZlQ2hpbGQoIGRpdiApOwoKCQlyZXR1cm4gcGFzczsKCX0pOwoKCS8vIElFNi83IHJldHVybiBtb2RpZmllZCBhdHRyaWJ1dGVzCglFeHByLmF0dHJIYW5kbGUgPSBhc3NlcnQoZnVuY3Rpb24oIGRpdiApIHsKCQlkaXYuaW5uZXJIVE1MID0gIjxhIGhyZWY9JyMnPjwvYT4iOwoJCXJldHVybiBkaXYuZmlyc3RDaGlsZCAmJiB0eXBlb2YgZGl2LmZpcnN0Q2hpbGQuZ2V0QXR0cmlidXRlICE9PSBzdHJ1bmRlZmluZWQgJiYKCQkJZGl2LmZpcnN0Q2hpbGQuZ2V0QXR0cmlidXRlKCJocmVmIikgPT09ICIjIjsKCX0pID8KCQl7fSA6CgkJewoJCQkiaHJlZiI6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJcmV0dXJuIGVsZW0uZ2V0QXR0cmlidXRlKCAiaHJlZiIsIDIgKTsKCQkJfSwKCQkJInR5cGUiOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJCXJldHVybiBlbGVtLmdldEF0dHJpYnV0ZSgidHlwZSIpOwoJCQl9CgkJfTsKCgkvLyBJRCBmaW5kIGFuZCBmaWx0ZXIKCWlmICggc3VwcG9ydC5nZXRJZE5vdE5hbWUgKSB7CgkJRXhwci5maW5kWyJJRCJdID0gZnVuY3Rpb24oIGlkLCBjb250ZXh0ICkgewoJCQlpZiAoIHR5cGVvZiBjb250ZXh0LmdldEVsZW1lbnRCeUlkICE9PSBzdHJ1bmRlZmluZWQgJiYgIWRvY3VtZW50SXNYTUwgKSB7CgkJCQl2YXIgbSA9IGNvbnRleHQuZ2V0RWxlbWVudEJ5SWQoIGlkICk7CgkJCQkvLyBDaGVjayBwYXJlbnROb2RlIHRvIGNhdGNoIHdoZW4gQmxhY2tiZXJyeSA0LjYgcmV0dXJucwoJCQkJLy8gbm9kZXMgdGhhdCBhcmUgbm8gbG9uZ2VyIGluIHRoZSBkb2N1bWVudCAjNjk2MwoJCQkJcmV0dXJuIG0gJiYgbS5wYXJlbnROb2RlID8gW21dIDogW107CgkJCX0KCQl9OwoJCUV4cHIuZmlsdGVyWyJJRCJdID0gZnVuY3Rpb24oIGlkICkgewoJCQl2YXIgYXR0cklkID0gaWQucmVwbGFjZSggcnVuZXNjYXBlLCBmdW5lc2NhcGUgKTsKCQkJcmV0dXJuIGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJcmV0dXJuIGVsZW0uZ2V0QXR0cmlidXRlKCJpZCIpID09PSBhdHRySWQ7CgkJCX07CgkJfTsKCX0gZWxzZSB7CgkJRXhwci5maW5kWyJJRCJdID0gZnVuY3Rpb24oIGlkLCBjb250ZXh0ICkgewoJCQlpZiAoIHR5cGVvZiBjb250ZXh0LmdldEVsZW1lbnRCeUlkICE9PSBzdHJ1bmRlZmluZWQgJiYgIWRvY3VtZW50SXNYTUwgKSB7CgkJCQl2YXIgbSA9IGNvbnRleHQuZ2V0RWxlbWVudEJ5SWQoIGlkICk7CgoJCQkJcmV0dXJuIG0gPwoJCQkJCW0uaWQgPT09IGlkIHx8IHR5cGVvZiBtLmdldEF0dHJpYnV0ZU5vZGUgIT09IHN0cnVuZGVmaW5lZCAmJiBtLmdldEF0dHJpYnV0ZU5vZGUoImlkIikudmFsdWUgPT09IGlkID8KCQkJCQkJW21dIDoKCQkJCQkJdW5kZWZpbmVkIDoKCQkJCQlbXTsKCQkJfQoJCX07CgkJRXhwci5maWx0ZXJbIklEIl0gPSAgZnVuY3Rpb24oIGlkICkgewoJCQl2YXIgYXR0cklkID0gaWQucmVwbGFjZSggcnVuZXNjYXBlLCBmdW5lc2NhcGUgKTsKCQkJcmV0dXJuIGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJdmFyIG5vZGUgPSB0eXBlb2YgZWxlbS5nZXRBdHRyaWJ1dGVOb2RlICE9PSBzdHJ1bmRlZmluZWQgJiYgZWxlbS5nZXRBdHRyaWJ1dGVOb2RlKCJpZCIpOwoJCQkJcmV0dXJuIG5vZGUgJiYgbm9kZS52YWx1ZSA9PT0gYXR0cklkOwoJCQl9OwoJCX07Cgl9CgoJLy8gVGFnCglFeHByLmZpbmRbIlRBRyJdID0gc3VwcG9ydC50YWdOYW1lTm9Db21tZW50cyA/CgkJZnVuY3Rpb24oIHRhZywgY29udGV4dCApIHsKCQkJaWYgKCB0eXBlb2YgY29udGV4dC5nZXRFbGVtZW50c0J5VGFnTmFtZSAhPT0gc3RydW5kZWZpbmVkICkgewoJCQkJcmV0dXJuIGNvbnRleHQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoIHRhZyApOwoJCQl9CgkJfSA6CgkJZnVuY3Rpb24oIHRhZywgY29udGV4dCApIHsKCQkJdmFyIGVsZW0sCgkJCQl0bXAgPSBbXSwKCQkJCWkgPSAwLAoJCQkJcmVzdWx0cyA9IGNvbnRleHQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoIHRhZyApOwoKCQkJLy8gRmlsdGVyIG91dCBwb3NzaWJsZSBjb21tZW50cwoJCQlpZiAoIHRhZyA9PT0gIioiICkgewoJCQkJd2hpbGUgKCAoZWxlbSA9IHJlc3VsdHNbaSsrXSkgKSB7CgkJCQkJaWYgKCBlbGVtLm5vZGVUeXBlID09PSAxICkgewoJCQkJCQl0bXAucHVzaCggZWxlbSApOwoJCQkJCX0KCQkJCX0KCgkJCQlyZXR1cm4gdG1wOwoJCQl9CgkJCXJldHVybiByZXN1bHRzOwoJCX07CgoJLy8gTmFtZQoJRXhwci5maW5kWyJOQU1FIl0gPSBzdXBwb3J0LmdldEJ5TmFtZSAmJiBmdW5jdGlvbiggdGFnLCBjb250ZXh0ICkgewoJCWlmICggdHlwZW9mIGNvbnRleHQuZ2V0RWxlbWVudHNCeU5hbWUgIT09IHN0cnVuZGVmaW5lZCApIHsKCQkJcmV0dXJuIGNvbnRleHQuZ2V0RWxlbWVudHNCeU5hbWUoIG5hbWUgKTsKCQl9Cgl9OwoKCS8vIENsYXNzCglFeHByLmZpbmRbIkNMQVNTIl0gPSBzdXBwb3J0LmdldEJ5Q2xhc3NOYW1lICYmIGZ1bmN0aW9uKCBjbGFzc05hbWUsIGNvbnRleHQgKSB7CgkJaWYgKCB0eXBlb2YgY29udGV4dC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lICE9PSBzdHJ1bmRlZmluZWQgJiYgIWRvY3VtZW50SXNYTUwgKSB7CgkJCXJldHVybiBjb250ZXh0LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoIGNsYXNzTmFtZSApOwoJCX0KCX07CgoJLy8gUVNBIGFuZCBtYXRjaGVzU2VsZWN0b3Igc3VwcG9ydAoKCS8vIG1hdGNoZXNTZWxlY3Rvcig6YWN0aXZlKSByZXBvcnRzIGZhbHNlIHdoZW4gdHJ1ZSAoSUU5L09wZXJhIDExLjUpCglyYnVnZ3lNYXRjaGVzID0gW107CgoJLy8gcVNhKDpmb2N1cykgcmVwb3J0cyBmYWxzZSB3aGVuIHRydWUgKENocm9tZSAyMSksCgkvLyBubyBuZWVkIHRvIGFsc28gYWRkIHRvIGJ1Z2d5TWF0Y2hlcyBzaW5jZSBtYXRjaGVzIGNoZWNrcyBidWdneVFTQQoJLy8gQSBzdXBwb3J0IHRlc3Qgd291bGQgcmVxdWlyZSB0b28gbXVjaCBjb2RlICh3b3VsZCBpbmNsdWRlIGRvY3VtZW50IHJlYWR5KQoJcmJ1Z2d5UVNBID0gWyAiOmZvY3VzIiBdOwoKCWlmICggKHN1cHBvcnQucXNhID0gaXNOYXRpdmUoZG9jLnF1ZXJ5U2VsZWN0b3JBbGwpKSApIHsKCQkvLyBCdWlsZCBRU0EgcmVnZXgKCQkvLyBSZWdleCBzdHJhdGVneSBhZG9wdGVkIGZyb20gRGllZ28gUGVyaW5pCgkJYXNzZXJ0KGZ1bmN0aW9uKCBkaXYgKSB7CgkJCS8vIFNlbGVjdCBpcyBzZXQgdG8gZW1wdHkgc3RyaW5nIG9uIHB1cnBvc2UKCQkJLy8gVGhpcyBpcyB0byB0ZXN0IElFJ3MgdHJlYXRtZW50IG9mIG5vdCBleHBsaWN0bHkKCQkJLy8gc2V0dGluZyBhIGJvb2xlYW4gY29udGVudCBhdHRyaWJ1dGUsCgkJCS8vIHNpbmNlIGl0cyBwcmVzZW5jZSBzaG91bGQgYmUgZW5vdWdoCgkJCS8vIGh0dHA6Ly9idWdzLmpxdWVyeS5jb20vdGlja2V0LzEyMzU5CgkJCWRpdi5pbm5lckhUTUwgPSAiPHNlbGVjdD48b3B0aW9uIHNlbGVjdGVkPScnPjwvb3B0aW9uPjwvc2VsZWN0PiI7CgoJCQkvLyBJRTggLSBTb21lIGJvb2xlYW4gYXR0cmlidXRlcyBhcmUgbm90IHRyZWF0ZWQgY29ycmVjdGx5CgkJCWlmICggIWRpdi5xdWVyeVNlbGVjdG9yQWxsKCJbc2VsZWN0ZWRdIikubGVuZ3RoICkgewoJCQkJcmJ1Z2d5UVNBLnB1c2goICJcXFsiICsgd2hpdGVzcGFjZSArICIqKD86Y2hlY2tlZHxkaXNhYmxlZHxpc21hcHxtdWx0aXBsZXxyZWFkb25seXxzZWxlY3RlZHx2YWx1ZSkiICk7CgkJCX0KCgkJCS8vIFdlYmtpdC9PcGVyYSAtIDpjaGVja2VkIHNob3VsZCByZXR1cm4gc2VsZWN0ZWQgb3B0aW9uIGVsZW1lbnRzCgkJCS8vIGh0dHA6Ly93d3cudzMub3JnL1RSLzIwMTEvUkVDLWNzczMtc2VsZWN0b3JzLTIwMTEwOTI5LyNjaGVja2VkCgkJCS8vIElFOCB0aHJvd3MgZXJyb3IgaGVyZSBhbmQgd2lsbCBub3Qgc2VlIGxhdGVyIHRlc3RzCgkJCWlmICggIWRpdi5xdWVyeVNlbGVjdG9yQWxsKCI6Y2hlY2tlZCIpLmxlbmd0aCApIHsKCQkJCXJidWdneVFTQS5wdXNoKCI6Y2hlY2tlZCIpOwoJCQl9CgkJfSk7CgoJCWFzc2VydChmdW5jdGlvbiggZGl2ICkgewoKCQkJLy8gT3BlcmEgMTAtMTIvSUU4IC0gXj0gJD0gKj0gYW5kIGVtcHR5IHZhbHVlcwoJCQkvLyBTaG91bGQgbm90IHNlbGVjdCBhbnl0aGluZwoJCQlkaXYuaW5uZXJIVE1MID0gIjxpbnB1dCB0eXBlPSdoaWRkZW4nIGk9JycvPiI7CgkJCWlmICggZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoIltpXj0nJ10iKS5sZW5ndGggKSB7CgkJCQlyYnVnZ3lRU0EucHVzaCggIlsqXiRdPSIgKyB3aGl0ZXNwYWNlICsgIiooPzpcIlwifCcnKSIgKTsKCQkJfQoKCQkJLy8gRkYgMy41IC0gOmVuYWJsZWQvOmRpc2FibGVkIGFuZCBoaWRkZW4gZWxlbWVudHMgKGhpZGRlbiBlbGVtZW50cyBhcmUgc3RpbGwgZW5hYmxlZCkKCQkJLy8gSUU4IHRocm93cyBlcnJvciBoZXJlIGFuZCB3aWxsIG5vdCBzZWUgbGF0ZXIgdGVzdHMKCQkJaWYgKCAhZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoIjplbmFibGVkIikubGVuZ3RoICkgewoJCQkJcmJ1Z2d5UVNBLnB1c2goICI6ZW5hYmxlZCIsICI6ZGlzYWJsZWQiICk7CgkJCX0KCgkJCS8vIE9wZXJhIDEwLTExIGRvZXMgbm90IHRocm93IG9uIHBvc3QtY29tbWEgaW52YWxpZCBwc2V1ZG9zCgkJCWRpdi5xdWVyeVNlbGVjdG9yQWxsKCIqLDp4Iik7CgkJCXJidWdneVFTQS5wdXNoKCIsLio6Iik7CgkJfSk7Cgl9CgoJaWYgKCAoc3VwcG9ydC5tYXRjaGVzU2VsZWN0b3IgPSBpc05hdGl2ZSggKG1hdGNoZXMgPSBkb2NFbGVtLm1hdGNoZXNTZWxlY3RvciB8fAoJCWRvY0VsZW0ubW96TWF0Y2hlc1NlbGVjdG9yIHx8CgkJZG9jRWxlbS53ZWJraXRNYXRjaGVzU2VsZWN0b3IgfHwKCQlkb2NFbGVtLm9NYXRjaGVzU2VsZWN0b3IgfHwKCQlkb2NFbGVtLm1zTWF0Y2hlc1NlbGVjdG9yKSApKSApIHsKCgkJYXNzZXJ0KGZ1bmN0aW9uKCBkaXYgKSB7CgkJCS8vIENoZWNrIHRvIHNlZSBpZiBpdCdzIHBvc3NpYmxlIHRvIGRvIG1hdGNoZXNTZWxlY3RvcgoJCQkvLyBvbiBhIGRpc2Nvbm5lY3RlZCBub2RlIChJRSA5KQoJCQlzdXBwb3J0LmRpc2Nvbm5lY3RlZE1hdGNoID0gbWF0Y2hlcy5jYWxsKCBkaXYsICJkaXYiICk7CgoJCQkvLyBUaGlzIHNob3VsZCBmYWlsIHdpdGggYW4gZXhjZXB0aW9uCgkJCS8vIEdlY2tvIGRvZXMgbm90IGVycm9yLCByZXR1cm5zIGZhbHNlIGluc3RlYWQKCQkJbWF0Y2hlcy5jYWxsKCBkaXYsICJbcyE9JyddOngiICk7CgkJCXJidWdneU1hdGNoZXMucHVzaCggIiE9IiwgcHNldWRvcyApOwoJCX0pOwoJfQoKCXJidWdneVFTQSA9IG5ldyBSZWdFeHAoIHJidWdneVFTQS5qb2luKCJ8IikgKTsKCXJidWdneU1hdGNoZXMgPSBuZXcgUmVnRXhwKCByYnVnZ3lNYXRjaGVzLmpvaW4oInwiKSApOwoKCS8vIEVsZW1lbnQgY29udGFpbnMgYW5vdGhlcgoJLy8gUHVycG9zZWZ1bGx5IGRvZXMgbm90IGltcGxlbWVudCBpbmNsdXNpdmUgZGVzY2VuZGVudAoJLy8gQXMgaW4sIGFuIGVsZW1lbnQgZG9lcyBub3QgY29udGFpbiBpdHNlbGYKCWNvbnRhaW5zID0gaXNOYXRpdmUoZG9jRWxlbS5jb250YWlucykgfHwgZG9jRWxlbS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiA/CgkJZnVuY3Rpb24oIGEsIGIgKSB7CgkJCXZhciBhZG93biA9IGEubm9kZVR5cGUgPT09IDkgPyBhLmRvY3VtZW50RWxlbWVudCA6IGEsCgkJCQlidXAgPSBiICYmIGIucGFyZW50Tm9kZTsKCQkJcmV0dXJuIGEgPT09IGJ1cCB8fCAhISggYnVwICYmIGJ1cC5ub2RlVHlwZSA9PT0gMSAmJiAoCgkJCQlhZG93bi5jb250YWlucyA/CgkJCQkJYWRvd24uY29udGFpbnMoIGJ1cCApIDoKCQkJCQlhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uICYmIGEuY29tcGFyZURvY3VtZW50UG9zaXRpb24oIGJ1cCApICYgMTYKCQkJKSk7CgkJfSA6CgkJZnVuY3Rpb24oIGEsIGIgKSB7CgkJCWlmICggYiApIHsKCQkJCXdoaWxlICggKGIgPSBiLnBhcmVudE5vZGUpICkgewoJCQkJCWlmICggYiA9PT0gYSApIHsKCQkJCQkJcmV0dXJuIHRydWU7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCXJldHVybiBmYWxzZTsKCQl9OwoKCS8vIERvY3VtZW50IG9yZGVyIHNvcnRpbmcKCXNvcnRPcmRlciA9IGRvY0VsZW0uY29tcGFyZURvY3VtZW50UG9zaXRpb24gPwoJZnVuY3Rpb24oIGEsIGIgKSB7CgkJdmFyIGNvbXBhcmU7CgoJCWlmICggYSA9PT0gYiApIHsKCQkJaGFzRHVwbGljYXRlID0gdHJ1ZTsKCQkJcmV0dXJuIDA7CgkJfQoKCQlpZiAoIChjb21wYXJlID0gYi5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiAmJiBhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uICYmIGEuY29tcGFyZURvY3VtZW50UG9zaXRpb24oIGIgKSkgKSB7CgkJCWlmICggY29tcGFyZSAmIDEgfHwgYS5wYXJlbnROb2RlICYmIGEucGFyZW50Tm9kZS5ub2RlVHlwZSA9PT0gMTEgKSB7CgkJCQlpZiAoIGEgPT09IGRvYyB8fCBjb250YWlucyggcHJlZmVycmVkRG9jLCBhICkgKSB7CgkJCQkJcmV0dXJuIC0xOwoJCQkJfQoJCQkJaWYgKCBiID09PSBkb2MgfHwgY29udGFpbnMoIHByZWZlcnJlZERvYywgYiApICkgewoJCQkJCXJldHVybiAxOwoJCQkJfQoJCQkJcmV0dXJuIDA7CgkJCX0KCQkJcmV0dXJuIGNvbXBhcmUgJiA0ID8gLTEgOiAxOwoJCX0KCgkJcmV0dXJuIGEuY29tcGFyZURvY3VtZW50UG9zaXRpb24gPyAtMSA6IDE7Cgl9IDoKCWZ1bmN0aW9uKCBhLCBiICkgewoJCXZhciBjdXIsCgkJCWkgPSAwLAoJCQlhdXAgPSBhLnBhcmVudE5vZGUsCgkJCWJ1cCA9IGIucGFyZW50Tm9kZSwKCQkJYXAgPSBbIGEgXSwKCQkJYnAgPSBbIGIgXTsKCgkJLy8gRXhpdCBlYXJseSBpZiB0aGUgbm9kZXMgYXJlIGlkZW50aWNhbAoJCWlmICggYSA9PT0gYiApIHsKCQkJaGFzRHVwbGljYXRlID0gdHJ1ZTsKCQkJcmV0dXJuIDA7CgoJCS8vIFBhcmVudGxlc3Mgbm9kZXMgYXJlIGVpdGhlciBkb2N1bWVudHMgb3IgZGlzY29ubmVjdGVkCgkJfSBlbHNlIGlmICggIWF1cCB8fCAhYnVwICkgewoJCQlyZXR1cm4gYSA9PT0gZG9jID8gLTEgOgoJCQkJYiA9PT0gZG9jID8gMSA6CgkJCQlhdXAgPyAtMSA6CgkJCQlidXAgPyAxIDoKCQkJCTA7CgoJCS8vIElmIHRoZSBub2RlcyBhcmUgc2libGluZ3MsIHdlIGNhbiBkbyBhIHF1aWNrIGNoZWNrCgkJfSBlbHNlIGlmICggYXVwID09PSBidXAgKSB7CgkJCXJldHVybiBzaWJsaW5nQ2hlY2soIGEsIGIgKTsKCQl9CgoJCS8vIE90aGVyd2lzZSB3ZSBuZWVkIGZ1bGwgbGlzdHMgb2YgdGhlaXIgYW5jZXN0b3JzIGZvciBjb21wYXJpc29uCgkJY3VyID0gYTsKCQl3aGlsZSAoIChjdXIgPSBjdXIucGFyZW50Tm9kZSkgKSB7CgkJCWFwLnVuc2hpZnQoIGN1ciApOwoJCX0KCQljdXIgPSBiOwoJCXdoaWxlICggKGN1ciA9IGN1ci5wYXJlbnROb2RlKSApIHsKCQkJYnAudW5zaGlmdCggY3VyICk7CgkJfQoKCQkvLyBXYWxrIGRvd24gdGhlIHRyZWUgbG9va2luZyBmb3IgYSBkaXNjcmVwYW5jeQoJCXdoaWxlICggYXBbaV0gPT09IGJwW2ldICkgewoJCQlpKys7CgkJfQoKCQlyZXR1cm4gaSA/CgkJCS8vIERvIGEgc2libGluZyBjaGVjayBpZiB0aGUgbm9kZXMgaGF2ZSBhIGNvbW1vbiBhbmNlc3RvcgoJCQlzaWJsaW5nQ2hlY2soIGFwW2ldLCBicFtpXSApIDoKCgkJCS8vIE90aGVyd2lzZSBub2RlcyBpbiBvdXIgZG9jdW1lbnQgc29ydCBmaXJzdAoJCQlhcFtpXSA9PT0gcHJlZmVycmVkRG9jID8gLTEgOgoJCQlicFtpXSA9PT0gcHJlZmVycmVkRG9jID8gMSA6CgkJCTA7Cgl9OwoKCS8vIEFsd2F5cyBhc3N1bWUgdGhlIHByZXNlbmNlIG9mIGR1cGxpY2F0ZXMgaWYgc29ydCBkb2Vzbid0CgkvLyBwYXNzIHRoZW0gdG8gb3VyIGNvbXBhcmlzb24gZnVuY3Rpb24gKGFzIGluIEdvb2dsZSBDaHJvbWUpLgoJaGFzRHVwbGljYXRlID0gZmFsc2U7CglbMCwgMF0uc29ydCggc29ydE9yZGVyICk7CglzdXBwb3J0LmRldGVjdER1cGxpY2F0ZXMgPSBoYXNEdXBsaWNhdGU7CgoJcmV0dXJuIGRvY3VtZW50Owp9OwoKU2l6emxlLm1hdGNoZXMgPSBmdW5jdGlvbiggZXhwciwgZWxlbWVudHMgKSB7CglyZXR1cm4gU2l6emxlKCBleHByLCBudWxsLCBudWxsLCBlbGVtZW50cyApOwp9OwoKU2l6emxlLm1hdGNoZXNTZWxlY3RvciA9IGZ1bmN0aW9uKCBlbGVtLCBleHByICkgewoJLy8gU2V0IGRvY3VtZW50IHZhcnMgaWYgbmVlZGVkCglpZiAoICggZWxlbS5vd25lckRvY3VtZW50IHx8IGVsZW0gKSAhPT0gZG9jdW1lbnQgKSB7CgkJc2V0RG9jdW1lbnQoIGVsZW0gKTsKCX0KCgkvLyBNYWtlIHN1cmUgdGhhdCBhdHRyaWJ1dGUgc2VsZWN0b3JzIGFyZSBxdW90ZWQKCWV4cHIgPSBleHByLnJlcGxhY2UoIHJhdHRyaWJ1dGVRdW90ZXMsICI9JyQxJ10iICk7CgoJLy8gcmJ1Z2d5UVNBIGFsd2F5cyBjb250YWlucyA6Zm9jdXMsIHNvIG5vIG5lZWQgZm9yIGFuIGV4aXN0ZW5jZSBjaGVjawoJaWYgKCBzdXBwb3J0Lm1hdGNoZXNTZWxlY3RvciAmJiAhZG9jdW1lbnRJc1hNTCAmJiAoIXJidWdneU1hdGNoZXMgfHwgIXJidWdneU1hdGNoZXMudGVzdChleHByKSkgJiYgIXJidWdneVFTQS50ZXN0KGV4cHIpICkgewoJCXRyeSB7CgkJCXZhciByZXQgPSBtYXRjaGVzLmNhbGwoIGVsZW0sIGV4cHIgKTsKCgkJCS8vIElFIDkncyBtYXRjaGVzU2VsZWN0b3IgcmV0dXJucyBmYWxzZSBvbiBkaXNjb25uZWN0ZWQgbm9kZXMKCQkJaWYgKCByZXQgfHwgc3VwcG9ydC5kaXNjb25uZWN0ZWRNYXRjaCB8fAoJCQkJCS8vIEFzIHdlbGwsIGRpc2Nvbm5lY3RlZCBub2RlcyBhcmUgc2FpZCB0byBiZSBpbiBhIGRvY3VtZW50CgkJCQkJLy8gZnJhZ21lbnQgaW4gSUUgOQoJCQkJCWVsZW0uZG9jdW1lbnQgJiYgZWxlbS5kb2N1bWVudC5ub2RlVHlwZSAhPT0gMTEgKSB7CgkJCQlyZXR1cm4gcmV0OwoJCQl9CgkJfSBjYXRjaChlKSB7fQoJfQoKCXJldHVybiBTaXp6bGUoIGV4cHIsIGRvY3VtZW50LCBudWxsLCBbZWxlbV0gKS5sZW5ndGggPiAwOwp9OwoKU2l6emxlLmNvbnRhaW5zID0gZnVuY3Rpb24oIGNvbnRleHQsIGVsZW0gKSB7CgkvLyBTZXQgZG9jdW1lbnQgdmFycyBpZiBuZWVkZWQKCWlmICggKCBjb250ZXh0Lm93bmVyRG9jdW1lbnQgfHwgY29udGV4dCApICE9PSBkb2N1bWVudCApIHsKCQlzZXREb2N1bWVudCggY29udGV4dCApOwoJfQoJcmV0dXJuIGNvbnRhaW5zKCBjb250ZXh0LCBlbGVtICk7Cn07CgpTaXp6bGUuYXR0ciA9IGZ1bmN0aW9uKCBlbGVtLCBuYW1lICkgewoJdmFyIHZhbDsKCgkvLyBTZXQgZG9jdW1lbnQgdmFycyBpZiBuZWVkZWQKCWlmICggKCBlbGVtLm93bmVyRG9jdW1lbnQgfHwgZWxlbSApICE9PSBkb2N1bWVudCApIHsKCQlzZXREb2N1bWVudCggZWxlbSApOwoJfQoKCWlmICggIWRvY3VtZW50SXNYTUwgKSB7CgkJbmFtZSA9IG5hbWUudG9Mb3dlckNhc2UoKTsKCX0KCWlmICggKHZhbCA9IEV4cHIuYXR0ckhhbmRsZVsgbmFtZSBdKSApIHsKCQlyZXR1cm4gdmFsKCBlbGVtICk7Cgl9CglpZiAoIGRvY3VtZW50SXNYTUwgfHwgc3VwcG9ydC5hdHRyaWJ1dGVzICkgewoJCXJldHVybiBlbGVtLmdldEF0dHJpYnV0ZSggbmFtZSApOwoJfQoJcmV0dXJuICggKHZhbCA9IGVsZW0uZ2V0QXR0cmlidXRlTm9kZSggbmFtZSApKSB8fCBlbGVtLmdldEF0dHJpYnV0ZSggbmFtZSApICkgJiYgZWxlbVsgbmFtZSBdID09PSB0cnVlID8KCQluYW1lIDoKCQl2YWwgJiYgdmFsLnNwZWNpZmllZCA/IHZhbC52YWx1ZSA6IG51bGw7Cn07CgpTaXp6bGUuZXJyb3IgPSBmdW5jdGlvbiggbXNnICkgewoJdGhyb3cgbmV3IEVycm9yKCAiU3ludGF4IGVycm9yLCB1bnJlY29nbml6ZWQgZXhwcmVzc2lvbjogIiArIG1zZyApOwp9OwoKLy8gRG9jdW1lbnQgc29ydGluZyBhbmQgcmVtb3ZpbmcgZHVwbGljYXRlcwpTaXp6bGUudW5pcXVlU29ydCA9IGZ1bmN0aW9uKCByZXN1bHRzICkgewoJdmFyIGVsZW0sCgkJZHVwbGljYXRlcyA9IFtdLAoJCWkgPSAxLAoJCWogPSAwOwoKCS8vIFVubGVzcyB3ZSAqa25vdyogd2UgY2FuIGRldGVjdCBkdXBsaWNhdGVzLCBhc3N1bWUgdGhlaXIgcHJlc2VuY2UKCWhhc0R1cGxpY2F0ZSA9ICFzdXBwb3J0LmRldGVjdER1cGxpY2F0ZXM7CglyZXN1bHRzLnNvcnQoIHNvcnRPcmRlciApOwoKCWlmICggaGFzRHVwbGljYXRlICkgewoJCWZvciAoIDsgKGVsZW0gPSByZXN1bHRzW2ldKTsgaSsrICkgewoJCQlpZiAoIGVsZW0gPT09IHJlc3VsdHNbIGkgLSAxIF0gKSB7CgkJCQlqID0gZHVwbGljYXRlcy5wdXNoKCBpICk7CgkJCX0KCQl9CgkJd2hpbGUgKCBqLS0gKSB7CgkJCXJlc3VsdHMuc3BsaWNlKCBkdXBsaWNhdGVzWyBqIF0sIDEgKTsKCQl9Cgl9CgoJcmV0dXJuIHJlc3VsdHM7Cn07CgpmdW5jdGlvbiBzaWJsaW5nQ2hlY2soIGEsIGIgKSB7Cgl2YXIgY3VyID0gYiAmJiBhLAoJCWRpZmYgPSBjdXIgJiYgKCB+Yi5zb3VyY2VJbmRleCB8fCBNQVhfTkVHQVRJVkUgKSAtICggfmEuc291cmNlSW5kZXggfHwgTUFYX05FR0FUSVZFICk7CgoJLy8gVXNlIElFIHNvdXJjZUluZGV4IGlmIGF2YWlsYWJsZSBvbiBib3RoIG5vZGVzCglpZiAoIGRpZmYgKSB7CgkJcmV0dXJuIGRpZmY7Cgl9CgoJLy8gQ2hlY2sgaWYgYiBmb2xsb3dzIGEKCWlmICggY3VyICkgewoJCXdoaWxlICggKGN1ciA9IGN1ci5uZXh0U2libGluZykgKSB7CgkJCWlmICggY3VyID09PSBiICkgewoJCQkJcmV0dXJuIC0xOwoJCQl9CgkJfQoJfQoKCXJldHVybiBhID8gMSA6IC0xOwp9CgovLyBSZXR1cm5zIGEgZnVuY3Rpb24gdG8gdXNlIGluIHBzZXVkb3MgZm9yIGlucHV0IHR5cGVzCmZ1bmN0aW9uIGNyZWF0ZUlucHV0UHNldWRvKCB0eXBlICkgewoJcmV0dXJuIGZ1bmN0aW9uKCBlbGVtICkgewoJCXZhciBuYW1lID0gZWxlbS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpOwoJCXJldHVybiBuYW1lID09PSAiaW5wdXQiICYmIGVsZW0udHlwZSA9PT0gdHlwZTsKCX07Cn0KCi8vIFJldHVybnMgYSBmdW5jdGlvbiB0byB1c2UgaW4gcHNldWRvcyBmb3IgYnV0dG9ucwpmdW5jdGlvbiBjcmVhdGVCdXR0b25Qc2V1ZG8oIHR5cGUgKSB7CglyZXR1cm4gZnVuY3Rpb24oIGVsZW0gKSB7CgkJdmFyIG5hbWUgPSBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7CgkJcmV0dXJuIChuYW1lID09PSAiaW5wdXQiIHx8IG5hbWUgPT09ICJidXR0b24iKSAmJiBlbGVtLnR5cGUgPT09IHR5cGU7Cgl9Owp9CgovLyBSZXR1cm5zIGEgZnVuY3Rpb24gdG8gdXNlIGluIHBzZXVkb3MgZm9yIHBvc2l0aW9uYWxzCmZ1bmN0aW9uIGNyZWF0ZVBvc2l0aW9uYWxQc2V1ZG8oIGZuICkgewoJcmV0dXJuIG1hcmtGdW5jdGlvbihmdW5jdGlvbiggYXJndW1lbnQgKSB7CgkJYXJndW1lbnQgPSArYXJndW1lbnQ7CgkJcmV0dXJuIG1hcmtGdW5jdGlvbihmdW5jdGlvbiggc2VlZCwgbWF0Y2hlcyApIHsKCQkJdmFyIGosCgkJCQltYXRjaEluZGV4ZXMgPSBmbiggW10sIHNlZWQubGVuZ3RoLCBhcmd1bWVudCApLAoJCQkJaSA9IG1hdGNoSW5kZXhlcy5sZW5ndGg7CgoJCQkvLyBNYXRjaCBlbGVtZW50cyBmb3VuZCBhdCB0aGUgc3BlY2lmaWVkIGluZGV4ZXMKCQkJd2hpbGUgKCBpLS0gKSB7CgkJCQlpZiAoIHNlZWRbIChqID0gbWF0Y2hJbmRleGVzW2ldKSBdICkgewoJCQkJCXNlZWRbal0gPSAhKG1hdGNoZXNbal0gPSBzZWVkW2pdKTsKCQkJCX0KCQkJfQoJCX0pOwoJfSk7Cn0KCi8qKgogKiBVdGlsaXR5IGZ1bmN0aW9uIGZvciByZXRyaWV2aW5nIHRoZSB0ZXh0IHZhbHVlIG9mIGFuIGFycmF5IG9mIERPTSBub2RlcwogKiBAcGFyYW0ge0FycmF5fEVsZW1lbnR9IGVsZW0KICovCmdldFRleHQgPSBTaXp6bGUuZ2V0VGV4dCA9IGZ1bmN0aW9uKCBlbGVtICkgewoJdmFyIG5vZGUsCgkJcmV0ID0gIiIsCgkJaSA9IDAsCgkJbm9kZVR5cGUgPSBlbGVtLm5vZGVUeXBlOwoKCWlmICggIW5vZGVUeXBlICkgewoJCS8vIElmIG5vIG5vZGVUeXBlLCB0aGlzIGlzIGV4cGVjdGVkIHRvIGJlIGFuIGFycmF5CgkJZm9yICggOyAobm9kZSA9IGVsZW1baV0pOyBpKysgKSB7CgkJCS8vIERvIG5vdCB0cmF2ZXJzZSBjb21tZW50IG5vZGVzCgkJCXJldCArPSBnZXRUZXh0KCBub2RlICk7CgkJfQoJfSBlbHNlIGlmICggbm9kZVR5cGUgPT09IDEgfHwgbm9kZVR5cGUgPT09IDkgfHwgbm9kZVR5cGUgPT09IDExICkgewoJCS8vIFVzZSB0ZXh0Q29udGVudCBmb3IgZWxlbWVudHMKCQkvLyBpbm5lclRleHQgdXNhZ2UgcmVtb3ZlZCBmb3IgY29uc2lzdGVuY3kgb2YgbmV3IGxpbmVzIChzZWUgIzExMTUzKQoJCWlmICggdHlwZW9mIGVsZW0udGV4dENvbnRlbnQgPT09ICJzdHJpbmciICkgewoJCQlyZXR1cm4gZWxlbS50ZXh0Q29udGVudDsKCQl9IGVsc2UgewoJCQkvLyBUcmF2ZXJzZSBpdHMgY2hpbGRyZW4KCQkJZm9yICggZWxlbSA9IGVsZW0uZmlyc3RDaGlsZDsgZWxlbTsgZWxlbSA9IGVsZW0ubmV4dFNpYmxpbmcgKSB7CgkJCQlyZXQgKz0gZ2V0VGV4dCggZWxlbSApOwoJCQl9CgkJfQoJfSBlbHNlIGlmICggbm9kZVR5cGUgPT09IDMgfHwgbm9kZVR5cGUgPT09IDQgKSB7CgkJcmV0dXJuIGVsZW0ubm9kZVZhbHVlOwoJfQoJLy8gRG8gbm90IGluY2x1ZGUgY29tbWVudCBvciBwcm9jZXNzaW5nIGluc3RydWN0aW9uIG5vZGVzCgoJcmV0dXJuIHJldDsKfTsKCkV4cHIgPSBTaXp6bGUuc2VsZWN0b3JzID0gewoKCS8vIENhbiBiZSBhZGp1c3RlZCBieSB0aGUgdXNlcgoJY2FjaGVMZW5ndGg6IDUwLAoKCWNyZWF0ZVBzZXVkbzogbWFya0Z1bmN0aW9uLAoKCW1hdGNoOiBtYXRjaEV4cHIsCgoJZmluZDoge30sCgoJcmVsYXRpdmU6IHsKCQkiPiI6IHsgZGlyOiAicGFyZW50Tm9kZSIsIGZpcnN0OiB0cnVlIH0sCgkJIiAiOiB7IGRpcjogInBhcmVudE5vZGUiIH0sCgkJIisiOiB7IGRpcjogInByZXZpb3VzU2libGluZyIsIGZpcnN0OiB0cnVlIH0sCgkJIn4iOiB7IGRpcjogInByZXZpb3VzU2libGluZyIgfQoJfSwKCglwcmVGaWx0ZXI6IHsKCQkiQVRUUiI6IGZ1bmN0aW9uKCBtYXRjaCApIHsKCQkJbWF0Y2hbMV0gPSBtYXRjaFsxXS5yZXBsYWNlKCBydW5lc2NhcGUsIGZ1bmVzY2FwZSApOwoKCQkJLy8gTW92ZSB0aGUgZ2l2ZW4gdmFsdWUgdG8gbWF0Y2hbM10gd2hldGhlciBxdW90ZWQgb3IgdW5xdW90ZWQKCQkJbWF0Y2hbM10gPSAoIG1hdGNoWzRdIHx8IG1hdGNoWzVdIHx8ICIiICkucmVwbGFjZSggcnVuZXNjYXBlLCBmdW5lc2NhcGUgKTsKCgkJCWlmICggbWF0Y2hbMl0gPT09ICJ+PSIgKSB7CgkJCQltYXRjaFszXSA9ICIgIiArIG1hdGNoWzNdICsgIiAiOwoJCQl9CgoJCQlyZXR1cm4gbWF0Y2guc2xpY2UoIDAsIDQgKTsKCQl9LAoKCQkiQ0hJTEQiOiBmdW5jdGlvbiggbWF0Y2ggKSB7CgkJCS8qIG1hdGNoZXMgZnJvbSBtYXRjaEV4cHJbIkNISUxEIl0KCQkJCTEgdHlwZSAob25seXxudGh8Li4uKQoJCQkJMiB3aGF0IChjaGlsZHxvZi10eXBlKQoJCQkJMyBhcmd1bWVudCAoZXZlbnxvZGR8XGQqfFxkKm4oWystXVxkKyk/fC4uLikKCQkJCTQgeG4tY29tcG9uZW50IG9mIHhuK3kgYXJndW1lbnQgKFsrLV0/XGQqbnwpCgkJCQk1IHNpZ24gb2YgeG4tY29tcG9uZW50CgkJCQk2IHggb2YgeG4tY29tcG9uZW50CgkJCQk3IHNpZ24gb2YgeS1jb21wb25lbnQKCQkJCTggeSBvZiB5LWNvbXBvbmVudAoJCQkqLwoJCQltYXRjaFsxXSA9IG1hdGNoWzFdLnRvTG93ZXJDYXNlKCk7CgoJCQlpZiAoIG1hdGNoWzFdLnNsaWNlKCAwLCAzICkgPT09ICJudGgiICkgewoJCQkJLy8gbnRoLSogcmVxdWlyZXMgYXJndW1lbnQKCQkJCWlmICggIW1hdGNoWzNdICkgewoJCQkJCVNpenpsZS5lcnJvciggbWF0Y2hbMF0gKTsKCQkJCX0KCgkJCQkvLyBudW1lcmljIHggYW5kIHkgcGFyYW1ldGVycyBmb3IgRXhwci5maWx0ZXIuQ0hJTEQKCQkJCS8vIHJlbWVtYmVyIHRoYXQgZmFsc2UvdHJ1ZSBjYXN0IHJlc3BlY3RpdmVseSB0byAwLzEKCQkJCW1hdGNoWzRdID0gKyggbWF0Y2hbNF0gPyBtYXRjaFs1XSArIChtYXRjaFs2XSB8fCAxKSA6IDIgKiAoIG1hdGNoWzNdID09PSAiZXZlbiIgfHwgbWF0Y2hbM10gPT09ICJvZGQiICkgKTsKCQkJCW1hdGNoWzVdID0gKyggKCBtYXRjaFs3XSArIG1hdGNoWzhdICkgfHwgbWF0Y2hbM10gPT09ICJvZGQiICk7CgoJCQkvLyBvdGhlciB0eXBlcyBwcm9oaWJpdCBhcmd1bWVudHMKCQkJfSBlbHNlIGlmICggbWF0Y2hbM10gKSB7CgkJCQlTaXp6bGUuZXJyb3IoIG1hdGNoWzBdICk7CgkJCX0KCgkJCXJldHVybiBtYXRjaDsKCQl9LAoKCQkiUFNFVURPIjogZnVuY3Rpb24oIG1hdGNoICkgewoJCQl2YXIgZXhjZXNzLAoJCQkJdW5xdW90ZWQgPSAhbWF0Y2hbNV0gJiYgbWF0Y2hbMl07CgoJCQlpZiAoIG1hdGNoRXhwclsiQ0hJTEQiXS50ZXN0KCBtYXRjaFswXSApICkgewoJCQkJcmV0dXJuIG51bGw7CgkJCX0KCgkJCS8vIEFjY2VwdCBxdW90ZWQgYXJndW1lbnRzIGFzLWlzCgkJCWlmICggbWF0Y2hbNF0gKSB7CgkJCQltYXRjaFsyXSA9IG1hdGNoWzRdOwoKCQkJLy8gU3RyaXAgZXhjZXNzIGNoYXJhY3RlcnMgZnJvbSB1bnF1b3RlZCBhcmd1bWVudHMKCQkJfSBlbHNlIGlmICggdW5xdW90ZWQgJiYgcnBzZXVkby50ZXN0KCB1bnF1b3RlZCApICYmCgkJCQkvLyBHZXQgZXhjZXNzIGZyb20gdG9rZW5pemUgKHJlY3Vyc2l2ZWx5KQoJCQkJKGV4Y2VzcyA9IHRva2VuaXplKCB1bnF1b3RlZCwgdHJ1ZSApKSAmJgoJCQkJLy8gYWR2YW5jZSB0byB0aGUgbmV4dCBjbG9zaW5nIHBhcmVudGhlc2lzCgkJCQkoZXhjZXNzID0gdW5xdW90ZWQuaW5kZXhPZiggIikiLCB1bnF1b3RlZC5sZW5ndGggLSBleGNlc3MgKSAtIHVucXVvdGVkLmxlbmd0aCkgKSB7CgoJCQkJLy8gZXhjZXNzIGlzIGEgbmVnYXRpdmUgaW5kZXgKCQkJCW1hdGNoWzBdID0gbWF0Y2hbMF0uc2xpY2UoIDAsIGV4Y2VzcyApOwoJCQkJbWF0Y2hbMl0gPSB1bnF1b3RlZC5zbGljZSggMCwgZXhjZXNzICk7CgkJCX0KCgkJCS8vIFJldHVybiBvbmx5IGNhcHR1cmVzIG5lZWRlZCBieSB0aGUgcHNldWRvIGZpbHRlciBtZXRob2QgKHR5cGUgYW5kIGFyZ3VtZW50KQoJCQlyZXR1cm4gbWF0Y2guc2xpY2UoIDAsIDMgKTsKCQl9Cgl9LAoKCWZpbHRlcjogewoKCQkiVEFHIjogZnVuY3Rpb24oIG5vZGVOYW1lICkgewoJCQlpZiAoIG5vZGVOYW1lID09PSAiKiIgKSB7CgkJCQlyZXR1cm4gZnVuY3Rpb24oKSB7IHJldHVybiB0cnVlOyB9OwoJCQl9CgoJCQlub2RlTmFtZSA9IG5vZGVOYW1lLnJlcGxhY2UoIHJ1bmVzY2FwZSwgZnVuZXNjYXBlICkudG9Mb3dlckNhc2UoKTsKCQkJcmV0dXJuIGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJcmV0dXJuIGVsZW0ubm9kZU5hbWUgJiYgZWxlbS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSBub2RlTmFtZTsKCQkJfTsKCQl9LAoKCQkiQ0xBU1MiOiBmdW5jdGlvbiggY2xhc3NOYW1lICkgewoJCQl2YXIgcGF0dGVybiA9IGNsYXNzQ2FjaGVbIGNsYXNzTmFtZSArICIgIiBdOwoKCQkJcmV0dXJuIHBhdHRlcm4gfHwKCQkJCShwYXR0ZXJuID0gbmV3IFJlZ0V4cCggIihefCIgKyB3aGl0ZXNwYWNlICsgIikiICsgY2xhc3NOYW1lICsgIigiICsgd2hpdGVzcGFjZSArICJ8JCkiICkpICYmCgkJCQljbGFzc0NhY2hlKCBjbGFzc05hbWUsIGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJCXJldHVybiBwYXR0ZXJuLnRlc3QoIGVsZW0uY2xhc3NOYW1lIHx8ICh0eXBlb2YgZWxlbS5nZXRBdHRyaWJ1dGUgIT09IHN0cnVuZGVmaW5lZCAmJiBlbGVtLmdldEF0dHJpYnV0ZSgiY2xhc3MiKSkgfHwgIiIgKTsKCQkJCX0pOwoJCX0sCgoJCSJBVFRSIjogZnVuY3Rpb24oIG5hbWUsIG9wZXJhdG9yLCBjaGVjayApIHsKCQkJcmV0dXJuIGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJdmFyIHJlc3VsdCA9IFNpenpsZS5hdHRyKCBlbGVtLCBuYW1lICk7CgoJCQkJaWYgKCByZXN1bHQgPT0gbnVsbCApIHsKCQkJCQlyZXR1cm4gb3BlcmF0b3IgPT09ICIhPSI7CgkJCQl9CgkJCQlpZiAoICFvcGVyYXRvciApIHsKCQkJCQlyZXR1cm4gdHJ1ZTsKCQkJCX0KCgkJCQlyZXN1bHQgKz0gIiI7CgoJCQkJcmV0dXJuIG9wZXJhdG9yID09PSAiPSIgPyByZXN1bHQgPT09IGNoZWNrIDoKCQkJCQlvcGVyYXRvciA9PT0gIiE9IiA/IHJlc3VsdCAhPT0gY2hlY2sgOgoJCQkJCW9wZXJhdG9yID09PSAiXj0iID8gY2hlY2sgJiYgcmVzdWx0LmluZGV4T2YoIGNoZWNrICkgPT09IDAgOgoJCQkJCW9wZXJhdG9yID09PSAiKj0iID8gY2hlY2sgJiYgcmVzdWx0LmluZGV4T2YoIGNoZWNrICkgPiAtMSA6CgkJCQkJb3BlcmF0b3IgPT09ICIkPSIgPyBjaGVjayAmJiByZXN1bHQuc2xpY2UoIC1jaGVjay5sZW5ndGggKSA9PT0gY2hlY2sgOgoJCQkJCW9wZXJhdG9yID09PSAifj0iID8gKCAiICIgKyByZXN1bHQgKyAiICIgKS5pbmRleE9mKCBjaGVjayApID4gLTEgOgoJCQkJCW9wZXJhdG9yID09PSAifD0iID8gcmVzdWx0ID09PSBjaGVjayB8fCByZXN1bHQuc2xpY2UoIDAsIGNoZWNrLmxlbmd0aCArIDEgKSA9PT0gY2hlY2sgKyAiLSIgOgoJCQkJCWZhbHNlOwoJCQl9OwoJCX0sCgoJCSJDSElMRCI6IGZ1bmN0aW9uKCB0eXBlLCB3aGF0LCBhcmd1bWVudCwgZmlyc3QsIGxhc3QgKSB7CgkJCXZhciBzaW1wbGUgPSB0eXBlLnNsaWNlKCAwLCAzICkgIT09ICJudGgiLAoJCQkJZm9yd2FyZCA9IHR5cGUuc2xpY2UoIC00ICkgIT09ICJsYXN0IiwKCQkJCW9mVHlwZSA9IHdoYXQgPT09ICJvZi10eXBlIjsKCgkJCXJldHVybiBmaXJzdCA9PT0gMSAmJiBsYXN0ID09PSAwID8KCgkJCQkvLyBTaG9ydGN1dCBmb3IgOm50aC0qKG4pCgkJCQlmdW5jdGlvbiggZWxlbSApIHsKCQkJCQlyZXR1cm4gISFlbGVtLnBhcmVudE5vZGU7CgkJCQl9IDoKCgkJCQlmdW5jdGlvbiggZWxlbSwgY29udGV4dCwgeG1sICkgewoJCQkJCXZhciBjYWNoZSwgb3V0ZXJDYWNoZSwgbm9kZSwgZGlmZiwgbm9kZUluZGV4LCBzdGFydCwKCQkJCQkJZGlyID0gc2ltcGxlICE9PSBmb3J3YXJkID8gIm5leHRTaWJsaW5nIiA6ICJwcmV2aW91c1NpYmxpbmciLAoJCQkJCQlwYXJlbnQgPSBlbGVtLnBhcmVudE5vZGUsCgkJCQkJCW5hbWUgPSBvZlR5cGUgJiYgZWxlbS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpLAoJCQkJCQl1c2VDYWNoZSA9ICF4bWwgJiYgIW9mVHlwZTsKCgkJCQkJaWYgKCBwYXJlbnQgKSB7CgoJCQkJCQkvLyA6KGZpcnN0fGxhc3R8b25seSktKGNoaWxkfG9mLXR5cGUpCgkJCQkJCWlmICggc2ltcGxlICkgewoJCQkJCQkJd2hpbGUgKCBkaXIgKSB7CgkJCQkJCQkJbm9kZSA9IGVsZW07CgkJCQkJCQkJd2hpbGUgKCAobm9kZSA9IG5vZGVbIGRpciBdKSApIHsKCQkJCQkJCQkJaWYgKCBvZlR5cGUgPyBub2RlLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09IG5hbWUgOiBub2RlLm5vZGVUeXBlID09PSAxICkgewoJCQkJCQkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJCQkJCQl9CgkJCQkJCQkJfQoJCQkJCQkJCS8vIFJldmVyc2UgZGlyZWN0aW9uIGZvciA6b25seS0qIChpZiB3ZSBoYXZlbid0IHlldCBkb25lIHNvKQoJCQkJCQkJCXN0YXJ0ID0gZGlyID0gdHlwZSA9PT0gIm9ubHkiICYmICFzdGFydCAmJiAibmV4dFNpYmxpbmciOwoJCQkJCQkJfQoJCQkJCQkJcmV0dXJuIHRydWU7CgkJCQkJCX0KCgkJCQkJCXN0YXJ0ID0gWyBmb3J3YXJkID8gcGFyZW50LmZpcnN0Q2hpbGQgOiBwYXJlbnQubGFzdENoaWxkIF07CgoJCQkJCQkvLyBub24teG1sIDpudGgtY2hpbGQoLi4uKSBzdG9yZXMgY2FjaGUgZGF0YSBvbiBgcGFyZW50YAoJCQkJCQlpZiAoIGZvcndhcmQgJiYgdXNlQ2FjaGUgKSB7CgkJCQkJCQkvLyBTZWVrIGBlbGVtYCBmcm9tIGEgcHJldmlvdXNseS1jYWNoZWQgaW5kZXgKCQkJCQkJCW91dGVyQ2FjaGUgPSBwYXJlbnRbIGV4cGFuZG8gXSB8fCAocGFyZW50WyBleHBhbmRvIF0gPSB7fSk7CgkJCQkJCQljYWNoZSA9IG91dGVyQ2FjaGVbIHR5cGUgXSB8fCBbXTsKCQkJCQkJCW5vZGVJbmRleCA9IGNhY2hlWzBdID09PSBkaXJydW5zICYmIGNhY2hlWzFdOwoJCQkJCQkJZGlmZiA9IGNhY2hlWzBdID09PSBkaXJydW5zICYmIGNhY2hlWzJdOwoJCQkJCQkJbm9kZSA9IG5vZGVJbmRleCAmJiBwYXJlbnQuY2hpbGROb2Rlc1sgbm9kZUluZGV4IF07CgoJCQkJCQkJd2hpbGUgKCAobm9kZSA9ICsrbm9kZUluZGV4ICYmIG5vZGUgJiYgbm9kZVsgZGlyIF0gfHwKCgkJCQkJCQkJLy8gRmFsbGJhY2sgdG8gc2Vla2luZyBgZWxlbWAgZnJvbSB0aGUgc3RhcnQKCQkJCQkJCQkoZGlmZiA9IG5vZGVJbmRleCA9IDApIHx8IHN0YXJ0LnBvcCgpKSApIHsKCgkJCQkJCQkJLy8gV2hlbiBmb3VuZCwgY2FjaGUgaW5kZXhlcyBvbiBgcGFyZW50YCBhbmQgYnJlYWsKCQkJCQkJCQlpZiAoIG5vZGUubm9kZVR5cGUgPT09IDEgJiYgKytkaWZmICYmIG5vZGUgPT09IGVsZW0gKSB7CgkJCQkJCQkJCW91dGVyQ2FjaGVbIHR5cGUgXSA9IFsgZGlycnVucywgbm9kZUluZGV4LCBkaWZmIF07CgkJCQkJCQkJCWJyZWFrOwoJCQkJCQkJCX0KCQkJCQkJCX0KCgkJCQkJCS8vIFVzZSBwcmV2aW91c2x5LWNhY2hlZCBlbGVtZW50IGluZGV4IGlmIGF2YWlsYWJsZQoJCQkJCQl9IGVsc2UgaWYgKCB1c2VDYWNoZSAmJiAoY2FjaGUgPSAoZWxlbVsgZXhwYW5kbyBdIHx8IChlbGVtWyBleHBhbmRvIF0gPSB7fSkpWyB0eXBlIF0pICYmIGNhY2hlWzBdID09PSBkaXJydW5zICkgewoJCQkJCQkJZGlmZiA9IGNhY2hlWzFdOwoKCQkJCQkJLy8geG1sIDpudGgtY2hpbGQoLi4uKSBvciA6bnRoLWxhc3QtY2hpbGQoLi4uKSBvciA6bnRoKC1sYXN0KT8tb2YtdHlwZSguLi4pCgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkvLyBVc2UgdGhlIHNhbWUgbG9vcCBhcyBhYm92ZSB0byBzZWVrIGBlbGVtYCBmcm9tIHRoZSBzdGFydAoJCQkJCQkJd2hpbGUgKCAobm9kZSA9ICsrbm9kZUluZGV4ICYmIG5vZGUgJiYgbm9kZVsgZGlyIF0gfHwKCQkJCQkJCQkoZGlmZiA9IG5vZGVJbmRleCA9IDApIHx8IHN0YXJ0LnBvcCgpKSApIHsKCgkJCQkJCQkJaWYgKCAoIG9mVHlwZSA/IG5vZGUubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gbmFtZSA6IG5vZGUubm9kZVR5cGUgPT09IDEgKSAmJiArK2RpZmYgKSB7CgkJCQkJCQkJCS8vIENhY2hlIHRoZSBpbmRleCBvZiBlYWNoIGVuY291bnRlcmVkIGVsZW1lbnQKCQkJCQkJCQkJaWYgKCB1c2VDYWNoZSApIHsKCQkJCQkJCQkJCShub2RlWyBleHBhbmRvIF0gfHwgKG5vZGVbIGV4cGFuZG8gXSA9IHt9KSlbIHR5cGUgXSA9IFsgZGlycnVucywgZGlmZiBdOwoJCQkJCQkJCQl9CgoJCQkJCQkJCQlpZiAoIG5vZGUgPT09IGVsZW0gKSB7CgkJCQkJCQkJCQlicmVhazsKCQkJCQkJCQkJfQoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJfQoKCQkJCQkJLy8gSW5jb3Jwb3JhdGUgdGhlIG9mZnNldCwgdGhlbiBjaGVjayBhZ2FpbnN0IGN5Y2xlIHNpemUKCQkJCQkJZGlmZiAtPSBsYXN0OwoJCQkJCQlyZXR1cm4gZGlmZiA9PT0gZmlyc3QgfHwgKCBkaWZmICUgZmlyc3QgPT09IDAgJiYgZGlmZiAvIGZpcnN0ID49IDAgKTsKCQkJCQl9CgkJCQl9OwoJCX0sCgoJCSJQU0VVRE8iOiBmdW5jdGlvbiggcHNldWRvLCBhcmd1bWVudCApIHsKCQkJLy8gcHNldWRvLWNsYXNzIG5hbWVzIGFyZSBjYXNlLWluc2Vuc2l0aXZlCgkJCS8vIGh0dHA6Ly93d3cudzMub3JnL1RSL3NlbGVjdG9ycy8jcHNldWRvLWNsYXNzZXMKCQkJLy8gUHJpb3JpdGl6ZSBieSBjYXNlIHNlbnNpdGl2aXR5IGluIGNhc2UgY3VzdG9tIHBzZXVkb3MgYXJlIGFkZGVkIHdpdGggdXBwZXJjYXNlIGxldHRlcnMKCQkJLy8gUmVtZW1iZXIgdGhhdCBzZXRGaWx0ZXJzIGluaGVyaXRzIGZyb20gcHNldWRvcwoJCQl2YXIgYXJncywKCQkJCWZuID0gRXhwci5wc2V1ZG9zWyBwc2V1ZG8gXSB8fCBFeHByLnNldEZpbHRlcnNbIHBzZXVkby50b0xvd2VyQ2FzZSgpIF0gfHwKCQkJCQlTaXp6bGUuZXJyb3IoICJ1bnN1cHBvcnRlZCBwc2V1ZG86ICIgKyBwc2V1ZG8gKTsKCgkJCS8vIFRoZSB1c2VyIG1heSB1c2UgY3JlYXRlUHNldWRvIHRvIGluZGljYXRlIHRoYXQKCQkJLy8gYXJndW1lbnRzIGFyZSBuZWVkZWQgdG8gY3JlYXRlIHRoZSBmaWx0ZXIgZnVuY3Rpb24KCQkJLy8ganVzdCBhcyBTaXp6bGUgZG9lcwoJCQlpZiAoIGZuWyBleHBhbmRvIF0gKSB7CgkJCQlyZXR1cm4gZm4oIGFyZ3VtZW50ICk7CgkJCX0KCgkJCS8vIEJ1dCBtYWludGFpbiBzdXBwb3J0IGZvciBvbGQgc2lnbmF0dXJlcwoJCQlpZiAoIGZuLmxlbmd0aCA+IDEgKSB7CgkJCQlhcmdzID0gWyBwc2V1ZG8sIHBzZXVkbywgIiIsIGFyZ3VtZW50IF07CgkJCQlyZXR1cm4gRXhwci5zZXRGaWx0ZXJzLmhhc093blByb3BlcnR5KCBwc2V1ZG8udG9Mb3dlckNhc2UoKSApID8KCQkJCQltYXJrRnVuY3Rpb24oZnVuY3Rpb24oIHNlZWQsIG1hdGNoZXMgKSB7CgkJCQkJCXZhciBpZHgsCgkJCQkJCQltYXRjaGVkID0gZm4oIHNlZWQsIGFyZ3VtZW50ICksCgkJCQkJCQlpID0gbWF0Y2hlZC5sZW5ndGg7CgkJCQkJCXdoaWxlICggaS0tICkgewoJCQkJCQkJaWR4ID0gaW5kZXhPZi5jYWxsKCBzZWVkLCBtYXRjaGVkW2ldICk7CgkJCQkJCQlzZWVkWyBpZHggXSA9ICEoIG1hdGNoZXNbIGlkeCBdID0gbWF0Y2hlZFtpXSApOwoJCQkJCQl9CgkJCQkJfSkgOgoJCQkJCWZ1bmN0aW9uKCBlbGVtICkgewoJCQkJCQlyZXR1cm4gZm4oIGVsZW0sIDAsIGFyZ3MgKTsKCQkJCQl9OwoJCQl9CgoJCQlyZXR1cm4gZm47CgkJfQoJfSwKCglwc2V1ZG9zOiB7CgkJLy8gUG90ZW50aWFsbHkgY29tcGxleCBwc2V1ZG9zCgkJIm5vdCI6IG1hcmtGdW5jdGlvbihmdW5jdGlvbiggc2VsZWN0b3IgKSB7CgkJCS8vIFRyaW0gdGhlIHNlbGVjdG9yIHBhc3NlZCB0byBjb21waWxlCgkJCS8vIHRvIGF2b2lkIHRyZWF0aW5nIGxlYWRpbmcgYW5kIHRyYWlsaW5nCgkJCS8vIHNwYWNlcyBhcyBjb21iaW5hdG9ycwoJCQl2YXIgaW5wdXQgPSBbXSwKCQkJCXJlc3VsdHMgPSBbXSwKCQkJCW1hdGNoZXIgPSBjb21waWxlKCBzZWxlY3Rvci5yZXBsYWNlKCBydHJpbSwgIiQxIiApICk7CgoJCQlyZXR1cm4gbWF0Y2hlclsgZXhwYW5kbyBdID8KCQkJCW1hcmtGdW5jdGlvbihmdW5jdGlvbiggc2VlZCwgbWF0Y2hlcywgY29udGV4dCwgeG1sICkgewoJCQkJCXZhciBlbGVtLAoJCQkJCQl1bm1hdGNoZWQgPSBtYXRjaGVyKCBzZWVkLCBudWxsLCB4bWwsIFtdICksCgkJCQkJCWkgPSBzZWVkLmxlbmd0aDsKCgkJCQkJLy8gTWF0Y2ggZWxlbWVudHMgdW5tYXRjaGVkIGJ5IGBtYXRjaGVyYAoJCQkJCXdoaWxlICggaS0tICkgewoJCQkJCQlpZiAoIChlbGVtID0gdW5tYXRjaGVkW2ldKSApIHsKCQkJCQkJCXNlZWRbaV0gPSAhKG1hdGNoZXNbaV0gPSBlbGVtKTsKCQkJCQkJfQoJCQkJCX0KCQkJCX0pIDoKCQkJCWZ1bmN0aW9uKCBlbGVtLCBjb250ZXh0LCB4bWwgKSB7CgkJCQkJaW5wdXRbMF0gPSBlbGVtOwoJCQkJCW1hdGNoZXIoIGlucHV0LCBudWxsLCB4bWwsIHJlc3VsdHMgKTsKCQkJCQlyZXR1cm4gIXJlc3VsdHMucG9wKCk7CgkJCQl9OwoJCX0pLAoKCQkiaGFzIjogbWFya0Z1bmN0aW9uKGZ1bmN0aW9uKCBzZWxlY3RvciApIHsKCQkJcmV0dXJuIGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJcmV0dXJuIFNpenpsZSggc2VsZWN0b3IsIGVsZW0gKS5sZW5ndGggPiAwOwoJCQl9OwoJCX0pLAoKCQkiY29udGFpbnMiOiBtYXJrRnVuY3Rpb24oZnVuY3Rpb24oIHRleHQgKSB7CgkJCXJldHVybiBmdW5jdGlvbiggZWxlbSApIHsKCQkJCXJldHVybiAoIGVsZW0udGV4dENvbnRlbnQgfHwgZWxlbS5pbm5lclRleHQgfHwgZ2V0VGV4dCggZWxlbSApICkuaW5kZXhPZiggdGV4dCApID4gLTE7CgkJCX07CgkJfSksCgoJCS8vICJXaGV0aGVyIGFuIGVsZW1lbnQgaXMgcmVwcmVzZW50ZWQgYnkgYSA6bGFuZygpIHNlbGVjdG9yCgkJLy8gaXMgYmFzZWQgc29sZWx5IG9uIHRoZSBlbGVtZW50J3MgbGFuZ3VhZ2UgdmFsdWUKCQkvLyBiZWluZyBlcXVhbCB0byB0aGUgaWRlbnRpZmllciBDLAoJCS8vIG9yIGJlZ2lubmluZyB3aXRoIHRoZSBpZGVudGlmaWVyIEMgaW1tZWRpYXRlbHkgZm9sbG93ZWQgYnkgIi0iLgoJCS8vIFRoZSBtYXRjaGluZyBvZiBDIGFnYWluc3QgdGhlIGVsZW1lbnQncyBsYW5ndWFnZSB2YWx1ZSBpcyBwZXJmb3JtZWQgY2FzZS1pbnNlbnNpdGl2ZWx5LgoJCS8vIFRoZSBpZGVudGlmaWVyIEMgZG9lcyBub3QgaGF2ZSB0byBiZSBhIHZhbGlkIGxhbmd1YWdlIG5hbWUuIgoJCS8vIGh0dHA6Ly93d3cudzMub3JnL1RSL3NlbGVjdG9ycy8jbGFuZy1wc2V1ZG8KCQkibGFuZyI6IG1hcmtGdW5jdGlvbiggZnVuY3Rpb24oIGxhbmcgKSB7CgkJCS8vIGxhbmcgdmFsdWUgbXVzdCBiZSBhIHZhbGlkIGlkZW50aWZpZGVyCgkJCWlmICggIXJpZGVudGlmaWVyLnRlc3QobGFuZyB8fCAiIikgKSB7CgkJCQlTaXp6bGUuZXJyb3IoICJ1bnN1cHBvcnRlZCBsYW5nOiAiICsgbGFuZyApOwoJCQl9CgkJCWxhbmcgPSBsYW5nLnJlcGxhY2UoIHJ1bmVzY2FwZSwgZnVuZXNjYXBlICkudG9Mb3dlckNhc2UoKTsKCQkJcmV0dXJuIGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJdmFyIGVsZW1MYW5nOwoJCQkJZG8gewoJCQkJCWlmICggKGVsZW1MYW5nID0gZG9jdW1lbnRJc1hNTCA/CgkJCQkJCWVsZW0uZ2V0QXR0cmlidXRlKCJ4bWw6bGFuZyIpIHx8IGVsZW0uZ2V0QXR0cmlidXRlKCJsYW5nIikgOgoJCQkJCQllbGVtLmxhbmcpICkgewoKCQkJCQkJZWxlbUxhbmcgPSBlbGVtTGFuZy50b0xvd2VyQ2FzZSgpOwoJCQkJCQlyZXR1cm4gZWxlbUxhbmcgPT09IGxhbmcgfHwgZWxlbUxhbmcuaW5kZXhPZiggbGFuZyArICItIiApID09PSAwOwoJCQkJCX0KCQkJCX0gd2hpbGUgKCAoZWxlbSA9IGVsZW0ucGFyZW50Tm9kZSkgJiYgZWxlbS5ub2RlVHlwZSA9PT0gMSApOwoJCQkJcmV0dXJuIGZhbHNlOwoJCQl9OwoJCX0pLAoKCQkvLyBNaXNjZWxsYW5lb3VzCgkJInRhcmdldCI6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQl2YXIgaGFzaCA9IHdpbmRvdy5sb2NhdGlvbiAmJiB3aW5kb3cubG9jYXRpb24uaGFzaDsKCQkJcmV0dXJuIGhhc2ggJiYgaGFzaC5zbGljZSggMSApID09PSBlbGVtLmlkOwoJCX0sCgoJCSJyb290IjogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCXJldHVybiBlbGVtID09PSBkb2NFbGVtOwoJCX0sCgoJCSJmb2N1cyI6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQlyZXR1cm4gZWxlbSA9PT0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudCAmJiAoIWRvY3VtZW50Lmhhc0ZvY3VzIHx8IGRvY3VtZW50Lmhhc0ZvY3VzKCkpICYmICEhKGVsZW0udHlwZSB8fCBlbGVtLmhyZWYgfHwgfmVsZW0udGFiSW5kZXgpOwoJCX0sCgoJCS8vIEJvb2xlYW4gcHJvcGVydGllcwoJCSJlbmFibGVkIjogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCXJldHVybiBlbGVtLmRpc2FibGVkID09PSBmYWxzZTsKCQl9LAoKCQkiZGlzYWJsZWQiOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJcmV0dXJuIGVsZW0uZGlzYWJsZWQgPT09IHRydWU7CgkJfSwKCgkJImNoZWNrZWQiOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJLy8gSW4gQ1NTMywgOmNoZWNrZWQgc2hvdWxkIHJldHVybiBib3RoIGNoZWNrZWQgYW5kIHNlbGVjdGVkIGVsZW1lbnRzCgkJCS8vIGh0dHA6Ly93d3cudzMub3JnL1RSLzIwMTEvUkVDLWNzczMtc2VsZWN0b3JzLTIwMTEwOTI5LyNjaGVja2VkCgkJCXZhciBub2RlTmFtZSA9IGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKTsKCQkJcmV0dXJuIChub2RlTmFtZSA9PT0gImlucHV0IiAmJiAhIWVsZW0uY2hlY2tlZCkgfHwgKG5vZGVOYW1lID09PSAib3B0aW9uIiAmJiAhIWVsZW0uc2VsZWN0ZWQpOwoJCX0sCgoJCSJzZWxlY3RlZCI6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQkvLyBBY2Nlc3NpbmcgdGhpcyBwcm9wZXJ0eSBtYWtlcyBzZWxlY3RlZC1ieS1kZWZhdWx0CgkJCS8vIG9wdGlvbnMgaW4gU2FmYXJpIHdvcmsgcHJvcGVybHkKCQkJaWYgKCBlbGVtLnBhcmVudE5vZGUgKSB7CgkJCQllbGVtLnBhcmVudE5vZGUuc2VsZWN0ZWRJbmRleDsKCQkJfQoKCQkJcmV0dXJuIGVsZW0uc2VsZWN0ZWQgPT09IHRydWU7CgkJfSwKCgkJLy8gQ29udGVudHMKCQkiZW1wdHkiOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJLy8gaHR0cDovL3d3dy53My5vcmcvVFIvc2VsZWN0b3JzLyNlbXB0eS1wc2V1ZG8KCQkJLy8gOmVtcHR5IGlzIG9ubHkgYWZmZWN0ZWQgYnkgZWxlbWVudCBub2RlcyBhbmQgY29udGVudCBub2RlcyhpbmNsdWRpbmcgdGV4dCgzKSwgY2RhdGEoNCkpLAoJCQkvLyAgIG5vdCBjb21tZW50LCBwcm9jZXNzaW5nIGluc3RydWN0aW9ucywgb3Igb3RoZXJzCgkJCS8vIFRoYW5rcyB0byBEaWVnbyBQZXJpbmkgZm9yIHRoZSBub2RlTmFtZSBzaG9ydGN1dAoJCQkvLyAgIEdyZWF0ZXIgdGhhbiAiQCIgbWVhbnMgYWxwaGEgY2hhcmFjdGVycyAoc3BlY2lmaWNhbGx5IG5vdCBzdGFydGluZyB3aXRoICIjIiBvciAiPyIpCgkJCWZvciAoIGVsZW0gPSBlbGVtLmZpcnN0Q2hpbGQ7IGVsZW07IGVsZW0gPSBlbGVtLm5leHRTaWJsaW5nICkgewoJCQkJaWYgKCBlbGVtLm5vZGVOYW1lID4gIkAiIHx8IGVsZW0ubm9kZVR5cGUgPT09IDMgfHwgZWxlbS5ub2RlVHlwZSA9PT0gNCApIHsKCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQl9CgkJCX0KCQkJcmV0dXJuIHRydWU7CgkJfSwKCgkJInBhcmVudCI6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQlyZXR1cm4gIUV4cHIucHNldWRvc1siZW1wdHkiXSggZWxlbSApOwoJCX0sCgoJCS8vIEVsZW1lbnQvaW5wdXQgdHlwZXMKCQkiaGVhZGVyIjogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCXJldHVybiByaGVhZGVyLnRlc3QoIGVsZW0ubm9kZU5hbWUgKTsKCQl9LAoKCQkiaW5wdXQiOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJcmV0dXJuIHJpbnB1dHMudGVzdCggZWxlbS5ub2RlTmFtZSApOwoJCX0sCgoJCSJidXR0b24iOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJdmFyIG5hbWUgPSBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7CgkJCXJldHVybiBuYW1lID09PSAiaW5wdXQiICYmIGVsZW0udHlwZSA9PT0gImJ1dHRvbiIgfHwgbmFtZSA9PT0gImJ1dHRvbiI7CgkJfSwKCgkJInRleHQiOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJdmFyIGF0dHI7CgkJCS8vIElFNiBhbmQgNyB3aWxsIG1hcCBlbGVtLnR5cGUgdG8gJ3RleHQnIGZvciBuZXcgSFRNTDUgdHlwZXMgKHNlYXJjaCwgZXRjKQoJCQkvLyB1c2UgZ2V0QXR0cmlidXRlIGluc3RlYWQgdG8gdGVzdCB0aGlzIGNhc2UKCQkJcmV0dXJuIGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gImlucHV0IiAmJgoJCQkJZWxlbS50eXBlID09PSAidGV4dCIgJiYKCQkJCSggKGF0dHIgPSBlbGVtLmdldEF0dHJpYnV0ZSgidHlwZSIpKSA9PSBudWxsIHx8IGF0dHIudG9Mb3dlckNhc2UoKSA9PT0gZWxlbS50eXBlICk7CgkJfSwKCgkJLy8gUG9zaXRpb24taW4tY29sbGVjdGlvbgoJCSJmaXJzdCI6IGNyZWF0ZVBvc2l0aW9uYWxQc2V1ZG8oZnVuY3Rpb24oKSB7CgkJCXJldHVybiBbIDAgXTsKCQl9KSwKCgkJImxhc3QiOiBjcmVhdGVQb3NpdGlvbmFsUHNldWRvKGZ1bmN0aW9uKCBtYXRjaEluZGV4ZXMsIGxlbmd0aCApIHsKCQkJcmV0dXJuIFsgbGVuZ3RoIC0gMSBdOwoJCX0pLAoKCQkiZXEiOiBjcmVhdGVQb3NpdGlvbmFsUHNldWRvKGZ1bmN0aW9uKCBtYXRjaEluZGV4ZXMsIGxlbmd0aCwgYXJndW1lbnQgKSB7CgkJCXJldHVybiBbIGFyZ3VtZW50IDwgMCA/IGFyZ3VtZW50ICsgbGVuZ3RoIDogYXJndW1lbnQgXTsKCQl9KSwKCgkJImV2ZW4iOiBjcmVhdGVQb3NpdGlvbmFsUHNldWRvKGZ1bmN0aW9uKCBtYXRjaEluZGV4ZXMsIGxlbmd0aCApIHsKCQkJdmFyIGkgPSAwOwoJCQlmb3IgKCA7IGkgPCBsZW5ndGg7IGkgKz0gMiApIHsKCQkJCW1hdGNoSW5kZXhlcy5wdXNoKCBpICk7CgkJCX0KCQkJcmV0dXJuIG1hdGNoSW5kZXhlczsKCQl9KSwKCgkJIm9kZCI6IGNyZWF0ZVBvc2l0aW9uYWxQc2V1ZG8oZnVuY3Rpb24oIG1hdGNoSW5kZXhlcywgbGVuZ3RoICkgewoJCQl2YXIgaSA9IDE7CgkJCWZvciAoIDsgaSA8IGxlbmd0aDsgaSArPSAyICkgewoJCQkJbWF0Y2hJbmRleGVzLnB1c2goIGkgKTsKCQkJfQoJCQlyZXR1cm4gbWF0Y2hJbmRleGVzOwoJCX0pLAoKCQkibHQiOiBjcmVhdGVQb3NpdGlvbmFsUHNldWRvKGZ1bmN0aW9uKCBtYXRjaEluZGV4ZXMsIGxlbmd0aCwgYXJndW1lbnQgKSB7CgkJCXZhciBpID0gYXJndW1lbnQgPCAwID8gYXJndW1lbnQgKyBsZW5ndGggOiBhcmd1bWVudDsKCQkJZm9yICggOyAtLWkgPj0gMDsgKSB7CgkJCQltYXRjaEluZGV4ZXMucHVzaCggaSApOwoJCQl9CgkJCXJldHVybiBtYXRjaEluZGV4ZXM7CgkJfSksCgoJCSJndCI6IGNyZWF0ZVBvc2l0aW9uYWxQc2V1ZG8oZnVuY3Rpb24oIG1hdGNoSW5kZXhlcywgbGVuZ3RoLCBhcmd1bWVudCApIHsKCQkJdmFyIGkgPSBhcmd1bWVudCA8IDAgPyBhcmd1bWVudCArIGxlbmd0aCA6IGFyZ3VtZW50OwoJCQlmb3IgKCA7ICsraSA8IGxlbmd0aDsgKSB7CgkJCQltYXRjaEluZGV4ZXMucHVzaCggaSApOwoJCQl9CgkJCXJldHVybiBtYXRjaEluZGV4ZXM7CgkJfSkKCX0KfTsKCi8vIEFkZCBidXR0b24vaW5wdXQgdHlwZSBwc2V1ZG9zCmZvciAoIGkgaW4geyByYWRpbzogdHJ1ZSwgY2hlY2tib3g6IHRydWUsIGZpbGU6IHRydWUsIHBhc3N3b3JkOiB0cnVlLCBpbWFnZTogdHJ1ZSB9ICkgewoJRXhwci5wc2V1ZG9zWyBpIF0gPSBjcmVhdGVJbnB1dFBzZXVkbyggaSApOwp9CmZvciAoIGkgaW4geyBzdWJtaXQ6IHRydWUsIHJlc2V0OiB0cnVlIH0gKSB7CglFeHByLnBzZXVkb3NbIGkgXSA9IGNyZWF0ZUJ1dHRvblBzZXVkbyggaSApOwp9CgpmdW5jdGlvbiB0b2tlbml6ZSggc2VsZWN0b3IsIHBhcnNlT25seSApIHsKCXZhciBtYXRjaGVkLCBtYXRjaCwgdG9rZW5zLCB0eXBlLAoJCXNvRmFyLCBncm91cHMsIHByZUZpbHRlcnMsCgkJY2FjaGVkID0gdG9rZW5DYWNoZVsgc2VsZWN0b3IgKyAiICIgXTsKCglpZiAoIGNhY2hlZCApIHsKCQlyZXR1cm4gcGFyc2VPbmx5ID8gMCA6IGNhY2hlZC5zbGljZSggMCApOwoJfQoKCXNvRmFyID0gc2VsZWN0b3I7Cglncm91cHMgPSBbXTsKCXByZUZpbHRlcnMgPSBFeHByLnByZUZpbHRlcjsKCgl3aGlsZSAoIHNvRmFyICkgewoKCQkvLyBDb21tYSBhbmQgZmlyc3QgcnVuCgkJaWYgKCAhbWF0Y2hlZCB8fCAobWF0Y2ggPSByY29tbWEuZXhlYyggc29GYXIgKSkgKSB7CgkJCWlmICggbWF0Y2ggKSB7CgkJCQkvLyBEb24ndCBjb25zdW1lIHRyYWlsaW5nIGNvbW1hcyBhcyB2YWxpZAoJCQkJc29GYXIgPSBzb0Zhci5zbGljZSggbWF0Y2hbMF0ubGVuZ3RoICkgfHwgc29GYXI7CgkJCX0KCQkJZ3JvdXBzLnB1c2goIHRva2VucyA9IFtdICk7CgkJfQoKCQltYXRjaGVkID0gZmFsc2U7CgoJCS8vIENvbWJpbmF0b3JzCgkJaWYgKCAobWF0Y2ggPSByY29tYmluYXRvcnMuZXhlYyggc29GYXIgKSkgKSB7CgkJCW1hdGNoZWQgPSBtYXRjaC5zaGlmdCgpOwoJCQl0b2tlbnMucHVzaCggewoJCQkJdmFsdWU6IG1hdGNoZWQsCgkJCQkvLyBDYXN0IGRlc2NlbmRhbnQgY29tYmluYXRvcnMgdG8gc3BhY2UKCQkJCXR5cGU6IG1hdGNoWzBdLnJlcGxhY2UoIHJ0cmltLCAiICIgKQoJCQl9ICk7CgkJCXNvRmFyID0gc29GYXIuc2xpY2UoIG1hdGNoZWQubGVuZ3RoICk7CgkJfQoKCQkvLyBGaWx0ZXJzCgkJZm9yICggdHlwZSBpbiBFeHByLmZpbHRlciApIHsKCQkJaWYgKCAobWF0Y2ggPSBtYXRjaEV4cHJbIHR5cGUgXS5leGVjKCBzb0ZhciApKSAmJiAoIXByZUZpbHRlcnNbIHR5cGUgXSB8fAoJCQkJKG1hdGNoID0gcHJlRmlsdGVyc1sgdHlwZSBdKCBtYXRjaCApKSkgKSB7CgkJCQltYXRjaGVkID0gbWF0Y2guc2hpZnQoKTsKCQkJCXRva2Vucy5wdXNoKCB7CgkJCQkJdmFsdWU6IG1hdGNoZWQsCgkJCQkJdHlwZTogdHlwZSwKCQkJCQltYXRjaGVzOiBtYXRjaAoJCQkJfSApOwoJCQkJc29GYXIgPSBzb0Zhci5zbGljZSggbWF0Y2hlZC5sZW5ndGggKTsKCQkJfQoJCX0KCgkJaWYgKCAhbWF0Y2hlZCApIHsKCQkJYnJlYWs7CgkJfQoJfQoKCS8vIFJldHVybiB0aGUgbGVuZ3RoIG9mIHRoZSBpbnZhbGlkIGV4Y2VzcwoJLy8gaWYgd2UncmUganVzdCBwYXJzaW5nCgkvLyBPdGhlcndpc2UsIHRocm93IGFuIGVycm9yIG9yIHJldHVybiB0b2tlbnMKCXJldHVybiBwYXJzZU9ubHkgPwoJCXNvRmFyLmxlbmd0aCA6CgkJc29GYXIgPwoJCQlTaXp6bGUuZXJyb3IoIHNlbGVjdG9yICkgOgoJCQkvLyBDYWNoZSB0aGUgdG9rZW5zCgkJCXRva2VuQ2FjaGUoIHNlbGVjdG9yLCBncm91cHMgKS5zbGljZSggMCApOwp9CgpmdW5jdGlvbiB0b1NlbGVjdG9yKCB0b2tlbnMgKSB7Cgl2YXIgaSA9IDAsCgkJbGVuID0gdG9rZW5zLmxlbmd0aCwKCQlzZWxlY3RvciA9ICIiOwoJZm9yICggOyBpIDwgbGVuOyBpKysgKSB7CgkJc2VsZWN0b3IgKz0gdG9rZW5zW2ldLnZhbHVlOwoJfQoJcmV0dXJuIHNlbGVjdG9yOwp9CgpmdW5jdGlvbiBhZGRDb21iaW5hdG9yKCBtYXRjaGVyLCBjb21iaW5hdG9yLCBiYXNlICkgewoJdmFyIGRpciA9IGNvbWJpbmF0b3IuZGlyLAoJCWNoZWNrTm9uRWxlbWVudHMgPSBiYXNlICYmIGRpciA9PT0gInBhcmVudE5vZGUiLAoJCWRvbmVOYW1lID0gZG9uZSsrOwoKCXJldHVybiBjb21iaW5hdG9yLmZpcnN0ID8KCQkvLyBDaGVjayBhZ2FpbnN0IGNsb3Nlc3QgYW5jZXN0b3IvcHJlY2VkaW5nIGVsZW1lbnQKCQlmdW5jdGlvbiggZWxlbSwgY29udGV4dCwgeG1sICkgewoJCQl3aGlsZSAoIChlbGVtID0gZWxlbVsgZGlyIF0pICkgewoJCQkJaWYgKCBlbGVtLm5vZGVUeXBlID09PSAxIHx8IGNoZWNrTm9uRWxlbWVudHMgKSB7CgkJCQkJcmV0dXJuIG1hdGNoZXIoIGVsZW0sIGNvbnRleHQsIHhtbCApOwoJCQkJfQoJCQl9CgkJfSA6CgoJCS8vIENoZWNrIGFnYWluc3QgYWxsIGFuY2VzdG9yL3ByZWNlZGluZyBlbGVtZW50cwoJCWZ1bmN0aW9uKCBlbGVtLCBjb250ZXh0LCB4bWwgKSB7CgkJCXZhciBkYXRhLCBjYWNoZSwgb3V0ZXJDYWNoZSwKCQkJCWRpcmtleSA9IGRpcnJ1bnMgKyAiICIgKyBkb25lTmFtZTsKCgkJCS8vIFdlIGNhbid0IHNldCBhcmJpdHJhcnkgZGF0YSBvbiBYTUwgbm9kZXMsIHNvIHRoZXkgZG9uJ3QgYmVuZWZpdCBmcm9tIGRpciBjYWNoaW5nCgkJCWlmICggeG1sICkgewoJCQkJd2hpbGUgKCAoZWxlbSA9IGVsZW1bIGRpciBdKSApIHsKCQkJCQlpZiAoIGVsZW0ubm9kZVR5cGUgPT09IDEgfHwgY2hlY2tOb25FbGVtZW50cyApIHsKCQkJCQkJaWYgKCBtYXRjaGVyKCBlbGVtLCBjb250ZXh0LCB4bWwgKSApIHsKCQkJCQkJCXJldHVybiB0cnVlOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9IGVsc2UgewoJCQkJd2hpbGUgKCAoZWxlbSA9IGVsZW1bIGRpciBdKSApIHsKCQkJCQlpZiAoIGVsZW0ubm9kZVR5cGUgPT09IDEgfHwgY2hlY2tOb25FbGVtZW50cyApIHsKCQkJCQkJb3V0ZXJDYWNoZSA9IGVsZW1bIGV4cGFuZG8gXSB8fCAoZWxlbVsgZXhwYW5kbyBdID0ge30pOwoJCQkJCQlpZiAoIChjYWNoZSA9IG91dGVyQ2FjaGVbIGRpciBdKSAmJiBjYWNoZVswXSA9PT0gZGlya2V5ICkgewoJCQkJCQkJaWYgKCAoZGF0YSA9IGNhY2hlWzFdKSA9PT0gdHJ1ZSB8fCBkYXRhID09PSBjYWNoZWRydW5zICkgewoJCQkJCQkJCXJldHVybiBkYXRhID09PSB0cnVlOwoJCQkJCQkJfQoJCQkJCQl9IGVsc2UgewoJCQkJCQkJY2FjaGUgPSBvdXRlckNhY2hlWyBkaXIgXSA9IFsgZGlya2V5IF07CgkJCQkJCQljYWNoZVsxXSA9IG1hdGNoZXIoIGVsZW0sIGNvbnRleHQsIHhtbCApIHx8IGNhY2hlZHJ1bnM7CgkJCQkJCQlpZiAoIGNhY2hlWzFdID09PSB0cnVlICkgewoJCQkJCQkJCXJldHVybiB0cnVlOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJfTsKfQoKZnVuY3Rpb24gZWxlbWVudE1hdGNoZXIoIG1hdGNoZXJzICkgewoJcmV0dXJuIG1hdGNoZXJzLmxlbmd0aCA+IDEgPwoJCWZ1bmN0aW9uKCBlbGVtLCBjb250ZXh0LCB4bWwgKSB7CgkJCXZhciBpID0gbWF0Y2hlcnMubGVuZ3RoOwoJCQl3aGlsZSAoIGktLSApIHsKCQkJCWlmICggIW1hdGNoZXJzW2ldKCBlbGVtLCBjb250ZXh0LCB4bWwgKSApIHsKCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQl9CgkJCX0KCQkJcmV0dXJuIHRydWU7CgkJfSA6CgkJbWF0Y2hlcnNbMF07Cn0KCmZ1bmN0aW9uIGNvbmRlbnNlKCB1bm1hdGNoZWQsIG1hcCwgZmlsdGVyLCBjb250ZXh0LCB4bWwgKSB7Cgl2YXIgZWxlbSwKCQluZXdVbm1hdGNoZWQgPSBbXSwKCQlpID0gMCwKCQlsZW4gPSB1bm1hdGNoZWQubGVuZ3RoLAoJCW1hcHBlZCA9IG1hcCAhPSBudWxsOwoKCWZvciAoIDsgaSA8IGxlbjsgaSsrICkgewoJCWlmICggKGVsZW0gPSB1bm1hdGNoZWRbaV0pICkgewoJCQlpZiAoICFmaWx0ZXIgfHwgZmlsdGVyKCBlbGVtLCBjb250ZXh0LCB4bWwgKSApIHsKCQkJCW5ld1VubWF0Y2hlZC5wdXNoKCBlbGVtICk7CgkJCQlpZiAoIG1hcHBlZCApIHsKCQkJCQltYXAucHVzaCggaSApOwoJCQkJfQoJCQl9CgkJfQoJfQoKCXJldHVybiBuZXdVbm1hdGNoZWQ7Cn0KCmZ1bmN0aW9uIHNldE1hdGNoZXIoIHByZUZpbHRlciwgc2VsZWN0b3IsIG1hdGNoZXIsIHBvc3RGaWx0ZXIsIHBvc3RGaW5kZXIsIHBvc3RTZWxlY3RvciApIHsKCWlmICggcG9zdEZpbHRlciAmJiAhcG9zdEZpbHRlclsgZXhwYW5kbyBdICkgewoJCXBvc3RGaWx0ZXIgPSBzZXRNYXRjaGVyKCBwb3N0RmlsdGVyICk7Cgl9CglpZiAoIHBvc3RGaW5kZXIgJiYgIXBvc3RGaW5kZXJbIGV4cGFuZG8gXSApIHsKCQlwb3N0RmluZGVyID0gc2V0TWF0Y2hlciggcG9zdEZpbmRlciwgcG9zdFNlbGVjdG9yICk7Cgl9CglyZXR1cm4gbWFya0Z1bmN0aW9uKGZ1bmN0aW9uKCBzZWVkLCByZXN1bHRzLCBjb250ZXh0LCB4bWwgKSB7CgkJdmFyIHRlbXAsIGksIGVsZW0sCgkJCXByZU1hcCA9IFtdLAoJCQlwb3N0TWFwID0gW10sCgkJCXByZWV4aXN0aW5nID0gcmVzdWx0cy5sZW5ndGgsCgoJCQkvLyBHZXQgaW5pdGlhbCBlbGVtZW50cyBmcm9tIHNlZWQgb3IgY29udGV4dAoJCQllbGVtcyA9IHNlZWQgfHwgbXVsdGlwbGVDb250ZXh0cyggc2VsZWN0b3IgfHwgIioiLCBjb250ZXh0Lm5vZGVUeXBlID8gWyBjb250ZXh0IF0gOiBjb250ZXh0LCBbXSApLAoKCQkJLy8gUHJlZmlsdGVyIHRvIGdldCBtYXRjaGVyIGlucHV0LCBwcmVzZXJ2aW5nIGEgbWFwIGZvciBzZWVkLXJlc3VsdHMgc3luY2hyb25pemF0aW9uCgkJCW1hdGNoZXJJbiA9IHByZUZpbHRlciAmJiAoIHNlZWQgfHwgIXNlbGVjdG9yICkgPwoJCQkJY29uZGVuc2UoIGVsZW1zLCBwcmVNYXAsIHByZUZpbHRlciwgY29udGV4dCwgeG1sICkgOgoJCQkJZWxlbXMsCgoJCQltYXRjaGVyT3V0ID0gbWF0Y2hlciA/CgkJCQkvLyBJZiB3ZSBoYXZlIGEgcG9zdEZpbmRlciwgb3IgZmlsdGVyZWQgc2VlZCwgb3Igbm9uLXNlZWQgcG9zdEZpbHRlciBvciBwcmVleGlzdGluZyByZXN1bHRzLAoJCQkJcG9zdEZpbmRlciB8fCAoIHNlZWQgPyBwcmVGaWx0ZXIgOiBwcmVleGlzdGluZyB8fCBwb3N0RmlsdGVyICkgPwoKCQkJCQkvLyAuLi5pbnRlcm1lZGlhdGUgcHJvY2Vzc2luZyBpcyBuZWNlc3NhcnkKCQkJCQlbXSA6CgoJCQkJCS8vIC4uLm90aGVyd2lzZSB1c2UgcmVzdWx0cyBkaXJlY3RseQoJCQkJCXJlc3VsdHMgOgoJCQkJbWF0Y2hlckluOwoKCQkvLyBGaW5kIHByaW1hcnkgbWF0Y2hlcwoJCWlmICggbWF0Y2hlciApIHsKCQkJbWF0Y2hlciggbWF0Y2hlckluLCBtYXRjaGVyT3V0LCBjb250ZXh0LCB4bWwgKTsKCQl9CgoJCS8vIEFwcGx5IHBvc3RGaWx0ZXIKCQlpZiAoIHBvc3RGaWx0ZXIgKSB7CgkJCXRlbXAgPSBjb25kZW5zZSggbWF0Y2hlck91dCwgcG9zdE1hcCApOwoJCQlwb3N0RmlsdGVyKCB0ZW1wLCBbXSwgY29udGV4dCwgeG1sICk7CgoJCQkvLyBVbi1tYXRjaCBmYWlsaW5nIGVsZW1lbnRzIGJ5IG1vdmluZyB0aGVtIGJhY2sgdG8gbWF0Y2hlckluCgkJCWkgPSB0ZW1wLmxlbmd0aDsKCQkJd2hpbGUgKCBpLS0gKSB7CgkJCQlpZiAoIChlbGVtID0gdGVtcFtpXSkgKSB7CgkJCQkJbWF0Y2hlck91dFsgcG9zdE1hcFtpXSBdID0gIShtYXRjaGVySW5bIHBvc3RNYXBbaV0gXSA9IGVsZW0pOwoJCQkJfQoJCQl9CgkJfQoKCQlpZiAoIHNlZWQgKSB7CgkJCWlmICggcG9zdEZpbmRlciB8fCBwcmVGaWx0ZXIgKSB7CgkJCQlpZiAoIHBvc3RGaW5kZXIgKSB7CgkJCQkJLy8gR2V0IHRoZSBmaW5hbCBtYXRjaGVyT3V0IGJ5IGNvbmRlbnNpbmcgdGhpcyBpbnRlcm1lZGlhdGUgaW50byBwb3N0RmluZGVyIGNvbnRleHRzCgkJCQkJdGVtcCA9IFtdOwoJCQkJCWkgPSBtYXRjaGVyT3V0Lmxlbmd0aDsKCQkJCQl3aGlsZSAoIGktLSApIHsKCQkJCQkJaWYgKCAoZWxlbSA9IG1hdGNoZXJPdXRbaV0pICkgewoJCQkJCQkJLy8gUmVzdG9yZSBtYXRjaGVySW4gc2luY2UgZWxlbSBpcyBub3QgeWV0IGEgZmluYWwgbWF0Y2gKCQkJCQkJCXRlbXAucHVzaCggKG1hdGNoZXJJbltpXSA9IGVsZW0pICk7CgkJCQkJCX0KCQkJCQl9CgkJCQkJcG9zdEZpbmRlciggbnVsbCwgKG1hdGNoZXJPdXQgPSBbXSksIHRlbXAsIHhtbCApOwoJCQkJfQoKCQkJCS8vIE1vdmUgbWF0Y2hlZCBlbGVtZW50cyBmcm9tIHNlZWQgdG8gcmVzdWx0cyB0byBrZWVwIHRoZW0gc3luY2hyb25pemVkCgkJCQlpID0gbWF0Y2hlck91dC5sZW5ndGg7CgkJCQl3aGlsZSAoIGktLSApIHsKCQkJCQlpZiAoIChlbGVtID0gbWF0Y2hlck91dFtpXSkgJiYKCQkJCQkJKHRlbXAgPSBwb3N0RmluZGVyID8gaW5kZXhPZi5jYWxsKCBzZWVkLCBlbGVtICkgOiBwcmVNYXBbaV0pID4gLTEgKSB7CgoJCQkJCQlzZWVkW3RlbXBdID0gIShyZXN1bHRzW3RlbXBdID0gZWxlbSk7CgkJCQkJfQoJCQkJfQoJCQl9CgoJCS8vIEFkZCBlbGVtZW50cyB0byByZXN1bHRzLCB0aHJvdWdoIHBvc3RGaW5kZXIgaWYgZGVmaW5lZAoJCX0gZWxzZSB7CgkJCW1hdGNoZXJPdXQgPSBjb25kZW5zZSgKCQkJCW1hdGNoZXJPdXQgPT09IHJlc3VsdHMgPwoJCQkJCW1hdGNoZXJPdXQuc3BsaWNlKCBwcmVleGlzdGluZywgbWF0Y2hlck91dC5sZW5ndGggKSA6CgkJCQkJbWF0Y2hlck91dAoJCQkpOwoJCQlpZiAoIHBvc3RGaW5kZXIgKSB7CgkJCQlwb3N0RmluZGVyKCBudWxsLCByZXN1bHRzLCBtYXRjaGVyT3V0LCB4bWwgKTsKCQkJfSBlbHNlIHsKCQkJCXB1c2guYXBwbHkoIHJlc3VsdHMsIG1hdGNoZXJPdXQgKTsKCQkJfQoJCX0KCX0pOwp9CgpmdW5jdGlvbiBtYXRjaGVyRnJvbVRva2VucyggdG9rZW5zICkgewoJdmFyIGNoZWNrQ29udGV4dCwgbWF0Y2hlciwgaiwKCQlsZW4gPSB0b2tlbnMubGVuZ3RoLAoJCWxlYWRpbmdSZWxhdGl2ZSA9IEV4cHIucmVsYXRpdmVbIHRva2Vuc1swXS50eXBlIF0sCgkJaW1wbGljaXRSZWxhdGl2ZSA9IGxlYWRpbmdSZWxhdGl2ZSB8fCBFeHByLnJlbGF0aXZlWyIgIl0sCgkJaSA9IGxlYWRpbmdSZWxhdGl2ZSA/IDEgOiAwLAoKCQkvLyBUaGUgZm91bmRhdGlvbmFsIG1hdGNoZXIgZW5zdXJlcyB0aGF0IGVsZW1lbnRzIGFyZSByZWFjaGFibGUgZnJvbSB0b3AtbGV2ZWwgY29udGV4dChzKQoJCW1hdGNoQ29udGV4dCA9IGFkZENvbWJpbmF0b3IoIGZ1bmN0aW9uKCBlbGVtICkgewoJCQlyZXR1cm4gZWxlbSA9PT0gY2hlY2tDb250ZXh0OwoJCX0sIGltcGxpY2l0UmVsYXRpdmUsIHRydWUgKSwKCQltYXRjaEFueUNvbnRleHQgPSBhZGRDb21iaW5hdG9yKCBmdW5jdGlvbiggZWxlbSApIHsKCQkJcmV0dXJuIGluZGV4T2YuY2FsbCggY2hlY2tDb250ZXh0LCBlbGVtICkgPiAtMTsKCQl9LCBpbXBsaWNpdFJlbGF0aXZlLCB0cnVlICksCgkJbWF0Y2hlcnMgPSBbIGZ1bmN0aW9uKCBlbGVtLCBjb250ZXh0LCB4bWwgKSB7CgkJCXJldHVybiAoICFsZWFkaW5nUmVsYXRpdmUgJiYgKCB4bWwgfHwgY29udGV4dCAhPT0gb3V0ZXJtb3N0Q29udGV4dCApICkgfHwgKAoJCQkJKGNoZWNrQ29udGV4dCA9IGNvbnRleHQpLm5vZGVUeXBlID8KCQkJCQltYXRjaENvbnRleHQoIGVsZW0sIGNvbnRleHQsIHhtbCApIDoKCQkJCQltYXRjaEFueUNvbnRleHQoIGVsZW0sIGNvbnRleHQsIHhtbCApICk7CgkJfSBdOwoKCWZvciAoIDsgaSA8IGxlbjsgaSsrICkgewoJCWlmICggKG1hdGNoZXIgPSBFeHByLnJlbGF0aXZlWyB0b2tlbnNbaV0udHlwZSBdKSApIHsKCQkJbWF0Y2hlcnMgPSBbIGFkZENvbWJpbmF0b3IoZWxlbWVudE1hdGNoZXIoIG1hdGNoZXJzICksIG1hdGNoZXIpIF07CgkJfSBlbHNlIHsKCQkJbWF0Y2hlciA9IEV4cHIuZmlsdGVyWyB0b2tlbnNbaV0udHlwZSBdLmFwcGx5KCBudWxsLCB0b2tlbnNbaV0ubWF0Y2hlcyApOwoKCQkJLy8gUmV0dXJuIHNwZWNpYWwgdXBvbiBzZWVpbmcgYSBwb3NpdGlvbmFsIG1hdGNoZXIKCQkJaWYgKCBtYXRjaGVyWyBleHBhbmRvIF0gKSB7CgkJCQkvLyBGaW5kIHRoZSBuZXh0IHJlbGF0aXZlIG9wZXJhdG9yIChpZiBhbnkpIGZvciBwcm9wZXIgaGFuZGxpbmcKCQkJCWogPSArK2k7CgkJCQlmb3IgKCA7IGogPCBsZW47IGorKyApIHsKCQkJCQlpZiAoIEV4cHIucmVsYXRpdmVbIHRva2Vuc1tqXS50eXBlIF0gKSB7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCQkJCX0KCQkJCXJldHVybiBzZXRNYXRjaGVyKAoJCQkJCWkgPiAxICYmIGVsZW1lbnRNYXRjaGVyKCBtYXRjaGVycyApLAoJCQkJCWkgPiAxICYmIHRvU2VsZWN0b3IoIHRva2Vucy5zbGljZSggMCwgaSAtIDEgKSApLnJlcGxhY2UoIHJ0cmltLCAiJDEiICksCgkJCQkJbWF0Y2hlciwKCQkJCQlpIDwgaiAmJiBtYXRjaGVyRnJvbVRva2VucyggdG9rZW5zLnNsaWNlKCBpLCBqICkgKSwKCQkJCQlqIDwgbGVuICYmIG1hdGNoZXJGcm9tVG9rZW5zKCAodG9rZW5zID0gdG9rZW5zLnNsaWNlKCBqICkpICksCgkJCQkJaiA8IGxlbiAmJiB0b1NlbGVjdG9yKCB0b2tlbnMgKQoJCQkJKTsKCQkJfQoJCQltYXRjaGVycy5wdXNoKCBtYXRjaGVyICk7CgkJfQoJfQoKCXJldHVybiBlbGVtZW50TWF0Y2hlciggbWF0Y2hlcnMgKTsKfQoKZnVuY3Rpb24gbWF0Y2hlckZyb21Hcm91cE1hdGNoZXJzKCBlbGVtZW50TWF0Y2hlcnMsIHNldE1hdGNoZXJzICkgewoJLy8gQSBjb3VudGVyIHRvIHNwZWNpZnkgd2hpY2ggZWxlbWVudCBpcyBjdXJyZW50bHkgYmVpbmcgbWF0Y2hlZAoJdmFyIG1hdGNoZXJDYWNoZWRSdW5zID0gMCwKCQlieVNldCA9IHNldE1hdGNoZXJzLmxlbmd0aCA+IDAsCgkJYnlFbGVtZW50ID0gZWxlbWVudE1hdGNoZXJzLmxlbmd0aCA+IDAsCgkJc3VwZXJNYXRjaGVyID0gZnVuY3Rpb24oIHNlZWQsIGNvbnRleHQsIHhtbCwgcmVzdWx0cywgZXhwYW5kQ29udGV4dCApIHsKCQkJdmFyIGVsZW0sIGosIG1hdGNoZXIsCgkJCQlzZXRNYXRjaGVkID0gW10sCgkJCQltYXRjaGVkQ291bnQgPSAwLAoJCQkJaSA9ICIwIiwKCQkJCXVubWF0Y2hlZCA9IHNlZWQgJiYgW10sCgkJCQlvdXRlcm1vc3QgPSBleHBhbmRDb250ZXh0ICE9IG51bGwsCgkJCQljb250ZXh0QmFja3VwID0gb3V0ZXJtb3N0Q29udGV4dCwKCQkJCS8vIFdlIG11c3QgYWx3YXlzIGhhdmUgZWl0aGVyIHNlZWQgZWxlbWVudHMgb3IgY29udGV4dAoJCQkJZWxlbXMgPSBzZWVkIHx8IGJ5RWxlbWVudCAmJiBFeHByLmZpbmRbIlRBRyJdKCAiKiIsIGV4cGFuZENvbnRleHQgJiYgY29udGV4dC5wYXJlbnROb2RlIHx8IGNvbnRleHQgKSwKCQkJCS8vIFVzZSBpbnRlZ2VyIGRpcnJ1bnMgaWZmIHRoaXMgaXMgdGhlIG91dGVybW9zdCBtYXRjaGVyCgkJCQlkaXJydW5zVW5pcXVlID0gKGRpcnJ1bnMgKz0gY29udGV4dEJhY2t1cCA9PSBudWxsID8gMSA6IE1hdGgucmFuZG9tKCkgfHwgMC4xKTsKCgkJCWlmICggb3V0ZXJtb3N0ICkgewoJCQkJb3V0ZXJtb3N0Q29udGV4dCA9IGNvbnRleHQgIT09IGRvY3VtZW50ICYmIGNvbnRleHQ7CgkJCQljYWNoZWRydW5zID0gbWF0Y2hlckNhY2hlZFJ1bnM7CgkJCX0KCgkJCS8vIEFkZCBlbGVtZW50cyBwYXNzaW5nIGVsZW1lbnRNYXRjaGVycyBkaXJlY3RseSB0byByZXN1bHRzCgkJCS8vIEtlZXAgYGlgIGEgc3RyaW5nIGlmIHRoZXJlIGFyZSBubyBlbGVtZW50cyBzbyBgbWF0Y2hlZENvdW50YCB3aWxsIGJlICIwMCIgYmVsb3cKCQkJZm9yICggOyAoZWxlbSA9IGVsZW1zW2ldKSAhPSBudWxsOyBpKysgKSB7CgkJCQlpZiAoIGJ5RWxlbWVudCAmJiBlbGVtICkgewoJCQkJCWogPSAwOwoJCQkJCXdoaWxlICggKG1hdGNoZXIgPSBlbGVtZW50TWF0Y2hlcnNbaisrXSkgKSB7CgkJCQkJCWlmICggbWF0Y2hlciggZWxlbSwgY29udGV4dCwgeG1sICkgKSB7CgkJCQkJCQlyZXN1bHRzLnB1c2goIGVsZW0gKTsKCQkJCQkJCWJyZWFrOwoJCQkJCQl9CgkJCQkJfQoJCQkJCWlmICggb3V0ZXJtb3N0ICkgewoJCQkJCQlkaXJydW5zID0gZGlycnVuc1VuaXF1ZTsKCQkJCQkJY2FjaGVkcnVucyA9ICsrbWF0Y2hlckNhY2hlZFJ1bnM7CgkJCQkJfQoJCQkJfQoKCQkJCS8vIFRyYWNrIHVubWF0Y2hlZCBlbGVtZW50cyBmb3Igc2V0IGZpbHRlcnMKCQkJCWlmICggYnlTZXQgKSB7CgkJCQkJLy8gVGhleSB3aWxsIGhhdmUgZ29uZSB0aHJvdWdoIGFsbCBwb3NzaWJsZSBtYXRjaGVycwoJCQkJCWlmICggKGVsZW0gPSAhbWF0Y2hlciAmJiBlbGVtKSApIHsKCQkJCQkJbWF0Y2hlZENvdW50LS07CgkJCQkJfQoKCQkJCQkvLyBMZW5ndGhlbiB0aGUgYXJyYXkgZm9yIGV2ZXJ5IGVsZW1lbnQsIG1hdGNoZWQgb3Igbm90CgkJCQkJaWYgKCBzZWVkICkgewoJCQkJCQl1bm1hdGNoZWQucHVzaCggZWxlbSApOwoJCQkJCX0KCQkJCX0KCQkJfQoKCQkJLy8gQXBwbHkgc2V0IGZpbHRlcnMgdG8gdW5tYXRjaGVkIGVsZW1lbnRzCgkJCW1hdGNoZWRDb3VudCArPSBpOwoJCQlpZiAoIGJ5U2V0ICYmIGkgIT09IG1hdGNoZWRDb3VudCApIHsKCQkJCWogPSAwOwoJCQkJd2hpbGUgKCAobWF0Y2hlciA9IHNldE1hdGNoZXJzW2orK10pICkgewoJCQkJCW1hdGNoZXIoIHVubWF0Y2hlZCwgc2V0TWF0Y2hlZCwgY29udGV4dCwgeG1sICk7CgkJCQl9CgoJCQkJaWYgKCBzZWVkICkgewoJCQkJCS8vIFJlaW50ZWdyYXRlIGVsZW1lbnQgbWF0Y2hlcyB0byBlbGltaW5hdGUgdGhlIG5lZWQgZm9yIHNvcnRpbmcKCQkJCQlpZiAoIG1hdGNoZWRDb3VudCA+IDAgKSB7CgkJCQkJCXdoaWxlICggaS0tICkgewoJCQkJCQkJaWYgKCAhKHVubWF0Y2hlZFtpXSB8fCBzZXRNYXRjaGVkW2ldKSApIHsKCQkJCQkJCQlzZXRNYXRjaGVkW2ldID0gcG9wLmNhbGwoIHJlc3VsdHMgKTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCgkJCQkJLy8gRGlzY2FyZCBpbmRleCBwbGFjZWhvbGRlciB2YWx1ZXMgdG8gZ2V0IG9ubHkgYWN0dWFsIG1hdGNoZXMKCQkJCQlzZXRNYXRjaGVkID0gY29uZGVuc2UoIHNldE1hdGNoZWQgKTsKCQkJCX0KCgkJCQkvLyBBZGQgbWF0Y2hlcyB0byByZXN1bHRzCgkJCQlwdXNoLmFwcGx5KCByZXN1bHRzLCBzZXRNYXRjaGVkICk7CgoJCQkJLy8gU2VlZGxlc3Mgc2V0IG1hdGNoZXMgc3VjY2VlZGluZyBtdWx0aXBsZSBzdWNjZXNzZnVsIG1hdGNoZXJzIHN0aXB1bGF0ZSBzb3J0aW5nCgkJCQlpZiAoIG91dGVybW9zdCAmJiAhc2VlZCAmJiBzZXRNYXRjaGVkLmxlbmd0aCA+IDAgJiYKCQkJCQkoIG1hdGNoZWRDb3VudCArIHNldE1hdGNoZXJzLmxlbmd0aCApID4gMSApIHsKCgkJCQkJU2l6emxlLnVuaXF1ZVNvcnQoIHJlc3VsdHMgKTsKCQkJCX0KCQkJfQoKCQkJLy8gT3ZlcnJpZGUgbWFuaXB1bGF0aW9uIG9mIGdsb2JhbHMgYnkgbmVzdGVkIG1hdGNoZXJzCgkJCWlmICggb3V0ZXJtb3N0ICkgewoJCQkJZGlycnVucyA9IGRpcnJ1bnNVbmlxdWU7CgkJCQlvdXRlcm1vc3RDb250ZXh0ID0gY29udGV4dEJhY2t1cDsKCQkJfQoKCQkJcmV0dXJuIHVubWF0Y2hlZDsKCQl9OwoKCXJldHVybiBieVNldCA/CgkJbWFya0Z1bmN0aW9uKCBzdXBlck1hdGNoZXIgKSA6CgkJc3VwZXJNYXRjaGVyOwp9Cgpjb21waWxlID0gU2l6emxlLmNvbXBpbGUgPSBmdW5jdGlvbiggc2VsZWN0b3IsIGdyb3VwIC8qIEludGVybmFsIFVzZSBPbmx5ICovICkgewoJdmFyIGksCgkJc2V0TWF0Y2hlcnMgPSBbXSwKCQllbGVtZW50TWF0Y2hlcnMgPSBbXSwKCQljYWNoZWQgPSBjb21waWxlckNhY2hlWyBzZWxlY3RvciArICIgIiBdOwoKCWlmICggIWNhY2hlZCApIHsKCQkvLyBHZW5lcmF0ZSBhIGZ1bmN0aW9uIG9mIHJlY3Vyc2l2ZSBmdW5jdGlvbnMgdGhhdCBjYW4gYmUgdXNlZCB0byBjaGVjayBlYWNoIGVsZW1lbnQKCQlpZiAoICFncm91cCApIHsKCQkJZ3JvdXAgPSB0b2tlbml6ZSggc2VsZWN0b3IgKTsKCQl9CgkJaSA9IGdyb3VwLmxlbmd0aDsKCQl3aGlsZSAoIGktLSApIHsKCQkJY2FjaGVkID0gbWF0Y2hlckZyb21Ub2tlbnMoIGdyb3VwW2ldICk7CgkJCWlmICggY2FjaGVkWyBleHBhbmRvIF0gKSB7CgkJCQlzZXRNYXRjaGVycy5wdXNoKCBjYWNoZWQgKTsKCQkJfSBlbHNlIHsKCQkJCWVsZW1lbnRNYXRjaGVycy5wdXNoKCBjYWNoZWQgKTsKCQkJfQoJCX0KCgkJLy8gQ2FjaGUgdGhlIGNvbXBpbGVkIGZ1bmN0aW9uCgkJY2FjaGVkID0gY29tcGlsZXJDYWNoZSggc2VsZWN0b3IsIG1hdGNoZXJGcm9tR3JvdXBNYXRjaGVycyggZWxlbWVudE1hdGNoZXJzLCBzZXRNYXRjaGVycyApICk7Cgl9CglyZXR1cm4gY2FjaGVkOwp9OwoKZnVuY3Rpb24gbXVsdGlwbGVDb250ZXh0cyggc2VsZWN0b3IsIGNvbnRleHRzLCByZXN1bHRzICkgewoJdmFyIGkgPSAwLAoJCWxlbiA9IGNvbnRleHRzLmxlbmd0aDsKCWZvciAoIDsgaSA8IGxlbjsgaSsrICkgewoJCVNpenpsZSggc2VsZWN0b3IsIGNvbnRleHRzW2ldLCByZXN1bHRzICk7Cgl9CglyZXR1cm4gcmVzdWx0czsKfQoKZnVuY3Rpb24gc2VsZWN0KCBzZWxlY3RvciwgY29udGV4dCwgcmVzdWx0cywgc2VlZCApIHsKCXZhciBpLCB0b2tlbnMsIHRva2VuLCB0eXBlLCBmaW5kLAoJCW1hdGNoID0gdG9rZW5pemUoIHNlbGVjdG9yICk7CgoJaWYgKCAhc2VlZCApIHsKCQkvLyBUcnkgdG8gbWluaW1pemUgb3BlcmF0aW9ucyBpZiB0aGVyZSBpcyBvbmx5IG9uZSBncm91cAoJCWlmICggbWF0Y2gubGVuZ3RoID09PSAxICkgewoKCQkJLy8gVGFrZSBhIHNob3J0Y3V0IGFuZCBzZXQgdGhlIGNvbnRleHQgaWYgdGhlIHJvb3Qgc2VsZWN0b3IgaXMgYW4gSUQKCQkJdG9rZW5zID0gbWF0Y2hbMF0gPSBtYXRjaFswXS5zbGljZSggMCApOwoJCQlpZiAoIHRva2Vucy5sZW5ndGggPiAyICYmICh0b2tlbiA9IHRva2Vuc1swXSkudHlwZSA9PT0gIklEIiAmJgoJCQkJCWNvbnRleHQubm9kZVR5cGUgPT09IDkgJiYgIWRvY3VtZW50SXNYTUwgJiYKCQkJCQlFeHByLnJlbGF0aXZlWyB0b2tlbnNbMV0udHlwZSBdICkgewoKCQkJCWNvbnRleHQgPSBFeHByLmZpbmRbIklEIl0oIHRva2VuLm1hdGNoZXNbMF0ucmVwbGFjZSggcnVuZXNjYXBlLCBmdW5lc2NhcGUgKSwgY29udGV4dCApWzBdOwoJCQkJaWYgKCAhY29udGV4dCApIHsKCQkJCQlyZXR1cm4gcmVzdWx0czsKCQkJCX0KCgkJCQlzZWxlY3RvciA9IHNlbGVjdG9yLnNsaWNlKCB0b2tlbnMuc2hpZnQoKS52YWx1ZS5sZW5ndGggKTsKCQkJfQoKCQkJLy8gRmV0Y2ggYSBzZWVkIHNldCBmb3IgcmlnaHQtdG8tbGVmdCBtYXRjaGluZwoJCQlpID0gbWF0Y2hFeHByWyJuZWVkc0NvbnRleHQiXS50ZXN0KCBzZWxlY3RvciApID8gMCA6IHRva2Vucy5sZW5ndGg7CgkJCXdoaWxlICggaS0tICkgewoJCQkJdG9rZW4gPSB0b2tlbnNbaV07CgoJCQkJLy8gQWJvcnQgaWYgd2UgaGl0IGEgY29tYmluYXRvcgoJCQkJaWYgKCBFeHByLnJlbGF0aXZlWyAodHlwZSA9IHRva2VuLnR5cGUpIF0gKSB7CgkJCQkJYnJlYWs7CgkJCQl9CgkJCQlpZiAoIChmaW5kID0gRXhwci5maW5kWyB0eXBlIF0pICkgewoJCQkJCS8vIFNlYXJjaCwgZXhwYW5kaW5nIGNvbnRleHQgZm9yIGxlYWRpbmcgc2libGluZyBjb21iaW5hdG9ycwoJCQkJCWlmICggKHNlZWQgPSBmaW5kKAoJCQkJCQl0b2tlbi5tYXRjaGVzWzBdLnJlcGxhY2UoIHJ1bmVzY2FwZSwgZnVuZXNjYXBlICksCgkJCQkJCXJzaWJsaW5nLnRlc3QoIHRva2Vuc1swXS50eXBlICkgJiYgY29udGV4dC5wYXJlbnROb2RlIHx8IGNvbnRleHQKCQkJCQkpKSApIHsKCgkJCQkJCS8vIElmIHNlZWQgaXMgZW1wdHkgb3Igbm8gdG9rZW5zIHJlbWFpbiwgd2UgY2FuIHJldHVybiBlYXJseQoJCQkJCQl0b2tlbnMuc3BsaWNlKCBpLCAxICk7CgkJCQkJCXNlbGVjdG9yID0gc2VlZC5sZW5ndGggJiYgdG9TZWxlY3RvciggdG9rZW5zICk7CgkJCQkJCWlmICggIXNlbGVjdG9yICkgewoJCQkJCQkJcHVzaC5hcHBseSggcmVzdWx0cywgc2xpY2UuY2FsbCggc2VlZCwgMCApICk7CgkJCQkJCQlyZXR1cm4gcmVzdWx0czsKCQkJCQkJfQoKCQkJCQkJYnJlYWs7CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoJfQoKCS8vIENvbXBpbGUgYW5kIGV4ZWN1dGUgYSBmaWx0ZXJpbmcgZnVuY3Rpb24KCS8vIFByb3ZpZGUgYG1hdGNoYCB0byBhdm9pZCByZXRva2VuaXphdGlvbiBpZiB3ZSBtb2RpZmllZCB0aGUgc2VsZWN0b3IgYWJvdmUKCWNvbXBpbGUoIHNlbGVjdG9yLCBtYXRjaCApKAoJCXNlZWQsCgkJY29udGV4dCwKCQlkb2N1bWVudElzWE1MLAoJCXJlc3VsdHMsCgkJcnNpYmxpbmcudGVzdCggc2VsZWN0b3IgKQoJKTsKCXJldHVybiByZXN1bHRzOwp9CgovLyBEZXByZWNhdGVkCkV4cHIucHNldWRvc1sibnRoIl0gPSBFeHByLnBzZXVkb3NbImVxIl07CgovLyBFYXN5IEFQSSBmb3IgY3JlYXRpbmcgbmV3IHNldEZpbHRlcnMKZnVuY3Rpb24gc2V0RmlsdGVycygpIHt9CkV4cHIuZmlsdGVycyA9IHNldEZpbHRlcnMucHJvdG90eXBlID0gRXhwci5wc2V1ZG9zOwpFeHByLnNldEZpbHRlcnMgPSBuZXcgc2V0RmlsdGVycygpOwoKLy8gSW5pdGlhbGl6ZSB3aXRoIHRoZSBkZWZhdWx0IGRvY3VtZW50CnNldERvY3VtZW50KCk7CgovLyBPdmVycmlkZSBzaXp6bGUgYXR0cmlidXRlIHJldHJpZXZhbApTaXp6bGUuYXR0ciA9IGpRdWVyeS5hdHRyOwpqUXVlcnkuZmluZCA9IFNpenpsZTsKalF1ZXJ5LmV4cHIgPSBTaXp6bGUuc2VsZWN0b3JzOwpqUXVlcnkuZXhwclsiOiJdID0galF1ZXJ5LmV4cHIucHNldWRvczsKalF1ZXJ5LnVuaXF1ZSA9IFNpenpsZS51bmlxdWVTb3J0OwpqUXVlcnkudGV4dCA9IFNpenpsZS5nZXRUZXh0OwpqUXVlcnkuaXNYTUxEb2MgPSBTaXp6bGUuaXNYTUw7CmpRdWVyeS5jb250YWlucyA9IFNpenpsZS5jb250YWluczsKCgp9KSggd2luZG93ICk7CnZhciBydW50aWwgPSAvVW50aWwkLywKCXJwYXJlbnRzcHJldiA9IC9eKD86cGFyZW50c3xwcmV2KD86VW50aWx8QWxsKSkvLAoJaXNTaW1wbGUgPSAvXi5bXjojXFtcLixdKiQvLAoJcm5lZWRzQ29udGV4dCA9IGpRdWVyeS5leHByLm1hdGNoLm5lZWRzQ29udGV4dCwKCS8vIG1ldGhvZHMgZ3VhcmFudGVlZCB0byBwcm9kdWNlIGEgdW5pcXVlIHNldCB3aGVuIHN0YXJ0aW5nIGZyb20gYSB1bmlxdWUgc2V0CglndWFyYW50ZWVkVW5pcXVlID0gewoJCWNoaWxkcmVuOiB0cnVlLAoJCWNvbnRlbnRzOiB0cnVlLAoJCW5leHQ6IHRydWUsCgkJcHJldjogdHJ1ZQoJfTsKCmpRdWVyeS5mbi5leHRlbmQoewoJZmluZDogZnVuY3Rpb24oIHNlbGVjdG9yICkgewoJCXZhciBpLCByZXQsIHNlbGYsCgkJCWxlbiA9IHRoaXMubGVuZ3RoOwoKCQlpZiAoIHR5cGVvZiBzZWxlY3RvciAhPT0gInN0cmluZyIgKSB7CgkJCXNlbGYgPSB0aGlzOwoJCQlyZXR1cm4gdGhpcy5wdXNoU3RhY2soIGpRdWVyeSggc2VsZWN0b3IgKS5maWx0ZXIoZnVuY3Rpb24oKSB7CgkJCQlmb3IgKCBpID0gMDsgaSA8IGxlbjsgaSsrICkgewoJCQkJCWlmICggalF1ZXJ5LmNvbnRhaW5zKCBzZWxmWyBpIF0sIHRoaXMgKSApIHsKCQkJCQkJcmV0dXJuIHRydWU7CgkJCQkJfQoJCQkJfQoJCQl9KSApOwoJCX0KCgkJcmV0ID0gW107CgkJZm9yICggaSA9IDA7IGkgPCBsZW47IGkrKyApIHsKCQkJalF1ZXJ5LmZpbmQoIHNlbGVjdG9yLCB0aGlzWyBpIF0sIHJldCApOwoJCX0KCgkJLy8gTmVlZGVkIGJlY2F1c2UgJCggc2VsZWN0b3IsIGNvbnRleHQgKSBiZWNvbWVzICQoIGNvbnRleHQgKS5maW5kKCBzZWxlY3RvciApCgkJcmV0ID0gdGhpcy5wdXNoU3RhY2soIGxlbiA+IDEgPyBqUXVlcnkudW5pcXVlKCByZXQgKSA6IHJldCApOwoJCXJldC5zZWxlY3RvciA9ICggdGhpcy5zZWxlY3RvciA/IHRoaXMuc2VsZWN0b3IgKyAiICIgOiAiIiApICsgc2VsZWN0b3I7CgkJcmV0dXJuIHJldDsKCX0sCgoJaGFzOiBmdW5jdGlvbiggdGFyZ2V0ICkgewoJCXZhciBpLAoJCQl0YXJnZXRzID0galF1ZXJ5KCB0YXJnZXQsIHRoaXMgKSwKCQkJbGVuID0gdGFyZ2V0cy5sZW5ndGg7CgoJCXJldHVybiB0aGlzLmZpbHRlcihmdW5jdGlvbigpIHsKCQkJZm9yICggaSA9IDA7IGkgPCBsZW47IGkrKyApIHsKCQkJCWlmICggalF1ZXJ5LmNvbnRhaW5zKCB0aGlzLCB0YXJnZXRzW2ldICkgKSB7CgkJCQkJcmV0dXJuIHRydWU7CgkJCQl9CgkJCX0KCQl9KTsKCX0sCgoJbm90OiBmdW5jdGlvbiggc2VsZWN0b3IgKSB7CgkJcmV0dXJuIHRoaXMucHVzaFN0YWNrKCB3aW5ub3codGhpcywgc2VsZWN0b3IsIGZhbHNlKSApOwoJfSwKCglmaWx0ZXI6IGZ1bmN0aW9uKCBzZWxlY3RvciApIHsKCQlyZXR1cm4gdGhpcy5wdXNoU3RhY2soIHdpbm5vdyh0aGlzLCBzZWxlY3RvciwgdHJ1ZSkgKTsKCX0sCgoJaXM6IGZ1bmN0aW9uKCBzZWxlY3RvciApIHsKCQlyZXR1cm4gISFzZWxlY3RvciAmJiAoCgkJCXR5cGVvZiBzZWxlY3RvciA9PT0gInN0cmluZyIgPwoJCQkJLy8gSWYgdGhpcyBpcyBhIHBvc2l0aW9uYWwvcmVsYXRpdmUgc2VsZWN0b3IsIGNoZWNrIG1lbWJlcnNoaXAgaW4gdGhlIHJldHVybmVkIHNldAoJCQkJLy8gc28gJCgicDpmaXJzdCIpLmlzKCJwOmxhc3QiKSB3b24ndCByZXR1cm4gdHJ1ZSBmb3IgYSBkb2Mgd2l0aCB0d28gInAiLgoJCQkJcm5lZWRzQ29udGV4dC50ZXN0KCBzZWxlY3RvciApID8KCQkJCQlqUXVlcnkoIHNlbGVjdG9yLCB0aGlzLmNvbnRleHQgKS5pbmRleCggdGhpc1swXSApID49IDAgOgoJCQkJCWpRdWVyeS5maWx0ZXIoIHNlbGVjdG9yLCB0aGlzICkubGVuZ3RoID4gMCA6CgkJCQl0aGlzLmZpbHRlciggc2VsZWN0b3IgKS5sZW5ndGggPiAwICk7Cgl9LAoKCWNsb3Nlc3Q6IGZ1bmN0aW9uKCBzZWxlY3RvcnMsIGNvbnRleHQgKSB7CgkJdmFyIGN1ciwKCQkJaSA9IDAsCgkJCWwgPSB0aGlzLmxlbmd0aCwKCQkJcmV0ID0gW10sCgkJCXBvcyA9IHJuZWVkc0NvbnRleHQudGVzdCggc2VsZWN0b3JzICkgfHwgdHlwZW9mIHNlbGVjdG9ycyAhPT0gInN0cmluZyIgPwoJCQkJalF1ZXJ5KCBzZWxlY3RvcnMsIGNvbnRleHQgfHwgdGhpcy5jb250ZXh0ICkgOgoJCQkJMDsKCgkJZm9yICggOyBpIDwgbDsgaSsrICkgewoJCQljdXIgPSB0aGlzW2ldOwoKCQkJd2hpbGUgKCBjdXIgJiYgY3VyLm93bmVyRG9jdW1lbnQgJiYgY3VyICE9PSBjb250ZXh0ICYmIGN1ci5ub2RlVHlwZSAhPT0gMTEgKSB7CgkJCQlpZiAoIHBvcyA/IHBvcy5pbmRleChjdXIpID4gLTEgOiBqUXVlcnkuZmluZC5tYXRjaGVzU2VsZWN0b3IoY3VyLCBzZWxlY3RvcnMpICkgewoJCQkJCXJldC5wdXNoKCBjdXIgKTsKCQkJCQlicmVhazsKCQkJCX0KCQkJCWN1ciA9IGN1ci5wYXJlbnROb2RlOwoJCQl9CgkJfQoKCQlyZXR1cm4gdGhpcy5wdXNoU3RhY2soIHJldC5sZW5ndGggPiAxID8galF1ZXJ5LnVuaXF1ZSggcmV0ICkgOiByZXQgKTsKCX0sCgoJLy8gRGV0ZXJtaW5lIHRoZSBwb3NpdGlvbiBvZiBhbiBlbGVtZW50IHdpdGhpbgoJLy8gdGhlIG1hdGNoZWQgc2V0IG9mIGVsZW1lbnRzCglpbmRleDogZnVuY3Rpb24oIGVsZW0gKSB7CgoJCS8vIE5vIGFyZ3VtZW50LCByZXR1cm4gaW5kZXggaW4gcGFyZW50CgkJaWYgKCAhZWxlbSApIHsKCQkJcmV0dXJuICggdGhpc1swXSAmJiB0aGlzWzBdLnBhcmVudE5vZGUgKSA/IHRoaXMuZmlyc3QoKS5wcmV2QWxsKCkubGVuZ3RoIDogLTE7CgkJfQoKCQkvLyBpbmRleCBpbiBzZWxlY3RvcgoJCWlmICggdHlwZW9mIGVsZW0gPT09ICJzdHJpbmciICkgewoJCQlyZXR1cm4galF1ZXJ5LmluQXJyYXkoIHRoaXNbMF0sIGpRdWVyeSggZWxlbSApICk7CgkJfQoKCQkvLyBMb2NhdGUgdGhlIHBvc2l0aW9uIG9mIHRoZSBkZXNpcmVkIGVsZW1lbnQKCQlyZXR1cm4galF1ZXJ5LmluQXJyYXkoCgkJCS8vIElmIGl0IHJlY2VpdmVzIGEgalF1ZXJ5IG9iamVjdCwgdGhlIGZpcnN0IGVsZW1lbnQgaXMgdXNlZAoJCQllbGVtLmpxdWVyeSA/IGVsZW1bMF0gOiBlbGVtLCB0aGlzICk7Cgl9LAoKCWFkZDogZnVuY3Rpb24oIHNlbGVjdG9yLCBjb250ZXh0ICkgewoJCXZhciBzZXQgPSB0eXBlb2Ygc2VsZWN0b3IgPT09ICJzdHJpbmciID8KCQkJCWpRdWVyeSggc2VsZWN0b3IsIGNvbnRleHQgKSA6CgkJCQlqUXVlcnkubWFrZUFycmF5KCBzZWxlY3RvciAmJiBzZWxlY3Rvci5ub2RlVHlwZSA/IFsgc2VsZWN0b3IgXSA6IHNlbGVjdG9yICksCgkJCWFsbCA9IGpRdWVyeS5tZXJnZSggdGhpcy5nZXQoKSwgc2V0ICk7CgoJCXJldHVybiB0aGlzLnB1c2hTdGFjayggalF1ZXJ5LnVuaXF1ZShhbGwpICk7Cgl9LAoKCWFkZEJhY2s6IGZ1bmN0aW9uKCBzZWxlY3RvciApIHsKCQlyZXR1cm4gdGhpcy5hZGQoIHNlbGVjdG9yID09IG51bGwgPwoJCQl0aGlzLnByZXZPYmplY3QgOiB0aGlzLnByZXZPYmplY3QuZmlsdGVyKHNlbGVjdG9yKQoJCSk7Cgl9Cn0pOwoKalF1ZXJ5LmZuLmFuZFNlbGYgPSBqUXVlcnkuZm4uYWRkQmFjazsKCmZ1bmN0aW9uIHNpYmxpbmcoIGN1ciwgZGlyICkgewoJZG8gewoJCWN1ciA9IGN1clsgZGlyIF07Cgl9IHdoaWxlICggY3VyICYmIGN1ci5ub2RlVHlwZSAhPT0gMSApOwoKCXJldHVybiBjdXI7Cn0KCmpRdWVyeS5lYWNoKHsKCXBhcmVudDogZnVuY3Rpb24oIGVsZW0gKSB7CgkJdmFyIHBhcmVudCA9IGVsZW0ucGFyZW50Tm9kZTsKCQlyZXR1cm4gcGFyZW50ICYmIHBhcmVudC5ub2RlVHlwZSAhPT0gMTEgPyBwYXJlbnQgOiBudWxsOwoJfSwKCXBhcmVudHM6IGZ1bmN0aW9uKCBlbGVtICkgewoJCXJldHVybiBqUXVlcnkuZGlyKCBlbGVtLCAicGFyZW50Tm9kZSIgKTsKCX0sCglwYXJlbnRzVW50aWw6IGZ1bmN0aW9uKCBlbGVtLCBpLCB1bnRpbCApIHsKCQlyZXR1cm4galF1ZXJ5LmRpciggZWxlbSwgInBhcmVudE5vZGUiLCB1bnRpbCApOwoJfSwKCW5leHQ6IGZ1bmN0aW9uKCBlbGVtICkgewoJCXJldHVybiBzaWJsaW5nKCBlbGVtLCAibmV4dFNpYmxpbmciICk7Cgl9LAoJcHJldjogZnVuY3Rpb24oIGVsZW0gKSB7CgkJcmV0dXJuIHNpYmxpbmcoIGVsZW0sICJwcmV2aW91c1NpYmxpbmciICk7Cgl9LAoJbmV4dEFsbDogZnVuY3Rpb24oIGVsZW0gKSB7CgkJcmV0dXJuIGpRdWVyeS5kaXIoIGVsZW0sICJuZXh0U2libGluZyIgKTsKCX0sCglwcmV2QWxsOiBmdW5jdGlvbiggZWxlbSApIHsKCQlyZXR1cm4galF1ZXJ5LmRpciggZWxlbSwgInByZXZpb3VzU2libGluZyIgKTsKCX0sCgluZXh0VW50aWw6IGZ1bmN0aW9uKCBlbGVtLCBpLCB1bnRpbCApIHsKCQlyZXR1cm4galF1ZXJ5LmRpciggZWxlbSwgIm5leHRTaWJsaW5nIiwgdW50aWwgKTsKCX0sCglwcmV2VW50aWw6IGZ1bmN0aW9uKCBlbGVtLCBpLCB1bnRpbCApIHsKCQlyZXR1cm4galF1ZXJ5LmRpciggZWxlbSwgInByZXZpb3VzU2libGluZyIsIHVudGlsICk7Cgl9LAoJc2libGluZ3M6IGZ1bmN0aW9uKCBlbGVtICkgewoJCXJldHVybiBqUXVlcnkuc2libGluZyggKCBlbGVtLnBhcmVudE5vZGUgfHwge30gKS5maXJzdENoaWxkLCBlbGVtICk7Cgl9LAoJY2hpbGRyZW46IGZ1bmN0aW9uKCBlbGVtICkgewoJCXJldHVybiBqUXVlcnkuc2libGluZyggZWxlbS5maXJzdENoaWxkICk7Cgl9LAoJY29udGVudHM6IGZ1bmN0aW9uKCBlbGVtICkgewoJCXJldHVybiBqUXVlcnkubm9kZU5hbWUoIGVsZW0sICJpZnJhbWUiICkgPwoJCQllbGVtLmNvbnRlbnREb2N1bWVudCB8fCBlbGVtLmNvbnRlbnRXaW5kb3cuZG9jdW1lbnQgOgoJCQlqUXVlcnkubWVyZ2UoIFtdLCBlbGVtLmNoaWxkTm9kZXMgKTsKCX0KfSwgZnVuY3Rpb24oIG5hbWUsIGZuICkgewoJalF1ZXJ5LmZuWyBuYW1lIF0gPSBmdW5jdGlvbiggdW50aWwsIHNlbGVjdG9yICkgewoJCXZhciByZXQgPSBqUXVlcnkubWFwKCB0aGlzLCBmbiwgdW50aWwgKTsKCgkJaWYgKCAhcnVudGlsLnRlc3QoIG5hbWUgKSApIHsKCQkJc2VsZWN0b3IgPSB1bnRpbDsKCQl9CgoJCWlmICggc2VsZWN0b3IgJiYgdHlwZW9mIHNlbGVjdG9yID09PSAic3RyaW5nIiApIHsKCQkJcmV0ID0galF1ZXJ5LmZpbHRlciggc2VsZWN0b3IsIHJldCApOwoJCX0KCgkJcmV0ID0gdGhpcy5sZW5ndGggPiAxICYmICFndWFyYW50ZWVkVW5pcXVlWyBuYW1lIF0gPyBqUXVlcnkudW5pcXVlKCByZXQgKSA6IHJldDsKCgkJaWYgKCB0aGlzLmxlbmd0aCA+IDEgJiYgcnBhcmVudHNwcmV2LnRlc3QoIG5hbWUgKSApIHsKCQkJcmV0ID0gcmV0LnJldmVyc2UoKTsKCQl9CgoJCXJldHVybiB0aGlzLnB1c2hTdGFjayggcmV0ICk7Cgl9Owp9KTsKCmpRdWVyeS5leHRlbmQoewoJZmlsdGVyOiBmdW5jdGlvbiggZXhwciwgZWxlbXMsIG5vdCApIHsKCQlpZiAoIG5vdCApIHsKCQkJZXhwciA9ICI6bm90KCIgKyBleHByICsgIikiOwoJCX0KCgkJcmV0dXJuIGVsZW1zLmxlbmd0aCA9PT0gMSA/CgkJCWpRdWVyeS5maW5kLm1hdGNoZXNTZWxlY3RvcihlbGVtc1swXSwgZXhwcikgPyBbIGVsZW1zWzBdIF0gOiBbXSA6CgkJCWpRdWVyeS5maW5kLm1hdGNoZXMoZXhwciwgZWxlbXMpOwoJfSwKCglkaXI6IGZ1bmN0aW9uKCBlbGVtLCBkaXIsIHVudGlsICkgewoJCXZhciBtYXRjaGVkID0gW10sCgkJCWN1ciA9IGVsZW1bIGRpciBdOwoKCQl3aGlsZSAoIGN1ciAmJiBjdXIubm9kZVR5cGUgIT09IDkgJiYgKHVudGlsID09PSB1bmRlZmluZWQgfHwgY3VyLm5vZGVUeXBlICE9PSAxIHx8ICFqUXVlcnkoIGN1ciApLmlzKCB1bnRpbCApKSApIHsKCQkJaWYgKCBjdXIubm9kZVR5cGUgPT09IDEgKSB7CgkJCQltYXRjaGVkLnB1c2goIGN1ciApOwoJCQl9CgkJCWN1ciA9IGN1cltkaXJdOwoJCX0KCQlyZXR1cm4gbWF0Y2hlZDsKCX0sCgoJc2libGluZzogZnVuY3Rpb24oIG4sIGVsZW0gKSB7CgkJdmFyIHIgPSBbXTsKCgkJZm9yICggOyBuOyBuID0gbi5uZXh0U2libGluZyApIHsKCQkJaWYgKCBuLm5vZGVUeXBlID09PSAxICYmIG4gIT09IGVsZW0gKSB7CgkJCQlyLnB1c2goIG4gKTsKCQkJfQoJCX0KCgkJcmV0dXJuIHI7Cgl9Cn0pOwoKLy8gSW1wbGVtZW50IHRoZSBpZGVudGljYWwgZnVuY3Rpb25hbGl0eSBmb3IgZmlsdGVyIGFuZCBub3QKZnVuY3Rpb24gd2lubm93KCBlbGVtZW50cywgcXVhbGlmaWVyLCBrZWVwICkgewoKCS8vIENhbid0IHBhc3MgbnVsbCBvciB1bmRlZmluZWQgdG8gaW5kZXhPZiBpbiBGaXJlZm94IDQKCS8vIFNldCB0byAwIHRvIHNraXAgc3RyaW5nIGNoZWNrCglxdWFsaWZpZXIgPSBxdWFsaWZpZXIgfHwgMDsKCglpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCBxdWFsaWZpZXIgKSApIHsKCQlyZXR1cm4galF1ZXJ5LmdyZXAoZWxlbWVudHMsIGZ1bmN0aW9uKCBlbGVtLCBpICkgewoJCQl2YXIgcmV0VmFsID0gISFxdWFsaWZpZXIuY2FsbCggZWxlbSwgaSwgZWxlbSApOwoJCQlyZXR1cm4gcmV0VmFsID09PSBrZWVwOwoJCX0pOwoKCX0gZWxzZSBpZiAoIHF1YWxpZmllci5ub2RlVHlwZSApIHsKCQlyZXR1cm4galF1ZXJ5LmdyZXAoZWxlbWVudHMsIGZ1bmN0aW9uKCBlbGVtICkgewoJCQlyZXR1cm4gKCBlbGVtID09PSBxdWFsaWZpZXIgKSA9PT0ga2VlcDsKCQl9KTsKCgl9IGVsc2UgaWYgKCB0eXBlb2YgcXVhbGlmaWVyID09PSAic3RyaW5nIiApIHsKCQl2YXIgZmlsdGVyZWQgPSBqUXVlcnkuZ3JlcChlbGVtZW50cywgZnVuY3Rpb24oIGVsZW0gKSB7CgkJCXJldHVybiBlbGVtLm5vZGVUeXBlID09PSAxOwoJCX0pOwoKCQlpZiAoIGlzU2ltcGxlLnRlc3QoIHF1YWxpZmllciApICkgewoJCQlyZXR1cm4galF1ZXJ5LmZpbHRlcihxdWFsaWZpZXIsIGZpbHRlcmVkLCAha2VlcCk7CgkJfSBlbHNlIHsKCQkJcXVhbGlmaWVyID0galF1ZXJ5LmZpbHRlciggcXVhbGlmaWVyLCBmaWx0ZXJlZCApOwoJCX0KCX0KCglyZXR1cm4galF1ZXJ5LmdyZXAoZWxlbWVudHMsIGZ1bmN0aW9uKCBlbGVtICkgewoJCXJldHVybiAoIGpRdWVyeS5pbkFycmF5KCBlbGVtLCBxdWFsaWZpZXIgKSA+PSAwICkgPT09IGtlZXA7Cgl9KTsKfQpmdW5jdGlvbiBjcmVhdGVTYWZlRnJhZ21lbnQoIGRvY3VtZW50ICkgewoJdmFyIGxpc3QgPSBub2RlTmFtZXMuc3BsaXQoICJ8IiApLAoJCXNhZmVGcmFnID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpOwoKCWlmICggc2FmZUZyYWcuY3JlYXRlRWxlbWVudCApIHsKCQl3aGlsZSAoIGxpc3QubGVuZ3RoICkgewoJCQlzYWZlRnJhZy5jcmVhdGVFbGVtZW50KAoJCQkJbGlzdC5wb3AoKQoJCQkpOwoJCX0KCX0KCXJldHVybiBzYWZlRnJhZzsKfQoKdmFyIG5vZGVOYW1lcyA9ICJhYmJyfGFydGljbGV8YXNpZGV8YXVkaW98YmRpfGNhbnZhc3xkYXRhfGRhdGFsaXN0fGRldGFpbHN8ZmlnY2FwdGlvbnxmaWd1cmV8Zm9vdGVyfCIgKwoJCSJoZWFkZXJ8aGdyb3VwfG1hcmt8bWV0ZXJ8bmF2fG91dHB1dHxwcm9ncmVzc3xzZWN0aW9ufHN1bW1hcnl8dGltZXx2aWRlbyIsCglyaW5saW5lalF1ZXJ5ID0gLyBqUXVlcnlcZCs9Iig/Om51bGx8XGQrKSIvZywKCXJub3NoaW1jYWNoZSA9IG5ldyBSZWdFeHAoIjwoPzoiICsgbm9kZU5hbWVzICsgIilbXFxzLz5dIiwgImkiKSwKCXJsZWFkaW5nV2hpdGVzcGFjZSA9IC9eXHMrLywKCXJ4aHRtbFRhZyA9IC88KD8hYXJlYXxicnxjb2x8ZW1iZWR8aHJ8aW1nfGlucHV0fGxpbmt8bWV0YXxwYXJhbSkoKFtcdzpdKylbXj5dKilcLz4vZ2ksCglydGFnTmFtZSA9IC88KFtcdzpdKykvLAoJcnRib2R5ID0gLzx0Ym9keS9pLAoJcmh0bWwgPSAvPHwmIz9cdys7LywKCXJub0lubmVyaHRtbCA9IC88KD86c2NyaXB0fHN0eWxlfGxpbmspL2ksCgltYW5pcHVsYXRpb25fcmNoZWNrYWJsZVR5cGUgPSAvXig/OmNoZWNrYm94fHJhZGlvKSQvaSwKCS8vIGNoZWNrZWQ9ImNoZWNrZWQiIG9yIGNoZWNrZWQKCXJjaGVja2VkID0gL2NoZWNrZWRccyooPzpbXj1dfD1ccyouY2hlY2tlZC4pL2ksCglyc2NyaXB0VHlwZSA9IC9eJHxcLyg/OmphdmF8ZWNtYSlzY3JpcHQvaSwKCXJzY3JpcHRUeXBlTWFza2VkID0gL150cnVlXC8oLiopLywKCXJjbGVhblNjcmlwdCA9IC9eXHMqPCEoPzpcW0NEQVRBXFt8LS0pfCg/OlxdXF18LS0pPlxzKiQvZywKCgkvLyBXZSBoYXZlIHRvIGNsb3NlIHRoZXNlIHRhZ3MgdG8gc3VwcG9ydCBYSFRNTCAoIzEzMjAwKQoJd3JhcE1hcCA9IHsKCQlvcHRpb246IFsgMSwgIjxzZWxlY3QgbXVsdGlwbGU9J211bHRpcGxlJz4iLCAiPC9zZWxlY3Q+IiBdLAoJCWxlZ2VuZDogWyAxLCAiPGZpZWxkc2V0PiIsICI8L2ZpZWxkc2V0PiIgXSwKCQlhcmVhOiBbIDEsICI8bWFwPiIsICI8L21hcD4iIF0sCgkJcGFyYW06IFsgMSwgIjxvYmplY3Q+IiwgIjwvb2JqZWN0PiIgXSwKCQl0aGVhZDogWyAxLCAiPHRhYmxlPiIsICI8L3RhYmxlPiIgXSwKCQl0cjogWyAyLCAiPHRhYmxlPjx0Ym9keT4iLCAiPC90Ym9keT48L3RhYmxlPiIgXSwKCQljb2w6IFsgMiwgIjx0YWJsZT48dGJvZHk+PC90Ym9keT48Y29sZ3JvdXA+IiwgIjwvY29sZ3JvdXA+PC90YWJsZT4iIF0sCgkJdGQ6IFsgMywgIjx0YWJsZT48dGJvZHk+PHRyPiIsICI8L3RyPjwvdGJvZHk+PC90YWJsZT4iIF0sCgoJCS8vIElFNi04IGNhbid0IHNlcmlhbGl6ZSBsaW5rLCBzY3JpcHQsIHN0eWxlLCBvciBhbnkgaHRtbDUgKE5vU2NvcGUpIHRhZ3MsCgkJLy8gdW5sZXNzIHdyYXBwZWQgaW4gYSBkaXYgd2l0aCBub24tYnJlYWtpbmcgY2hhcmFjdGVycyBpbiBmcm9udCBvZiBpdC4KCQlfZGVmYXVsdDogalF1ZXJ5LnN1cHBvcnQuaHRtbFNlcmlhbGl6ZSA/IFsgMCwgIiIsICIiIF0gOiBbIDEsICJYPGRpdj4iLCAiPC9kaXY+IiAgXQoJfSwKCXNhZmVGcmFnbWVudCA9IGNyZWF0ZVNhZmVGcmFnbWVudCggZG9jdW1lbnQgKSwKCWZyYWdtZW50RGl2ID0gc2FmZUZyYWdtZW50LmFwcGVuZENoaWxkKCBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKSApOwoKd3JhcE1hcC5vcHRncm91cCA9IHdyYXBNYXAub3B0aW9uOwp3cmFwTWFwLnRib2R5ID0gd3JhcE1hcC50Zm9vdCA9IHdyYXBNYXAuY29sZ3JvdXAgPSB3cmFwTWFwLmNhcHRpb24gPSB3cmFwTWFwLnRoZWFkOwp3cmFwTWFwLnRoID0gd3JhcE1hcC50ZDsKCmpRdWVyeS5mbi5leHRlbmQoewoJdGV4dDogZnVuY3Rpb24oIHZhbHVlICkgewoJCXJldHVybiBqUXVlcnkuYWNjZXNzKCB0aGlzLCBmdW5jdGlvbiggdmFsdWUgKSB7CgkJCXJldHVybiB2YWx1ZSA9PT0gdW5kZWZpbmVkID8KCQkJCWpRdWVyeS50ZXh0KCB0aGlzICkgOgoJCQkJdGhpcy5lbXB0eSgpLmFwcGVuZCggKCB0aGlzWzBdICYmIHRoaXNbMF0ub3duZXJEb2N1bWVudCB8fCBkb2N1bWVudCApLmNyZWF0ZVRleHROb2RlKCB2YWx1ZSApICk7CgkJfSwgbnVsbCwgdmFsdWUsIGFyZ3VtZW50cy5sZW5ndGggKTsKCX0sCgoJd3JhcEFsbDogZnVuY3Rpb24oIGh0bWwgKSB7CgkJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggaHRtbCApICkgewoJCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKGkpIHsKCQkJCWpRdWVyeSh0aGlzKS53cmFwQWxsKCBodG1sLmNhbGwodGhpcywgaSkgKTsKCQkJfSk7CgkJfQoKCQlpZiAoIHRoaXNbMF0gKSB7CgkJCS8vIFRoZSBlbGVtZW50cyB0byB3cmFwIHRoZSB0YXJnZXQgYXJvdW5kCgkJCXZhciB3cmFwID0galF1ZXJ5KCBodG1sLCB0aGlzWzBdLm93bmVyRG9jdW1lbnQgKS5lcSgwKS5jbG9uZSh0cnVlKTsKCgkJCWlmICggdGhpc1swXS5wYXJlbnROb2RlICkgewoJCQkJd3JhcC5pbnNlcnRCZWZvcmUoIHRoaXNbMF0gKTsKCQkJfQoKCQkJd3JhcC5tYXAoZnVuY3Rpb24oKSB7CgkJCQl2YXIgZWxlbSA9IHRoaXM7CgoJCQkJd2hpbGUgKCBlbGVtLmZpcnN0Q2hpbGQgJiYgZWxlbS5maXJzdENoaWxkLm5vZGVUeXBlID09PSAxICkgewoJCQkJCWVsZW0gPSBlbGVtLmZpcnN0Q2hpbGQ7CgkJCQl9CgoJCQkJcmV0dXJuIGVsZW07CgkJCX0pLmFwcGVuZCggdGhpcyApOwoJCX0KCgkJcmV0dXJuIHRoaXM7Cgl9LAoKCXdyYXBJbm5lcjogZnVuY3Rpb24oIGh0bWwgKSB7CgkJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggaHRtbCApICkgewoJCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKGkpIHsKCQkJCWpRdWVyeSh0aGlzKS53cmFwSW5uZXIoIGh0bWwuY2FsbCh0aGlzLCBpKSApOwoJCQl9KTsKCQl9CgoJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CgkJCXZhciBzZWxmID0galF1ZXJ5KCB0aGlzICksCgkJCQljb250ZW50cyA9IHNlbGYuY29udGVudHMoKTsKCgkJCWlmICggY29udGVudHMubGVuZ3RoICkgewoJCQkJY29udGVudHMud3JhcEFsbCggaHRtbCApOwoKCQkJfSBlbHNlIHsKCQkJCXNlbGYuYXBwZW5kKCBodG1sICk7CgkJCX0KCQl9KTsKCX0sCgoJd3JhcDogZnVuY3Rpb24oIGh0bWwgKSB7CgkJdmFyIGlzRnVuY3Rpb24gPSBqUXVlcnkuaXNGdW5jdGlvbiggaHRtbCApOwoKCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKGkpIHsKCQkJalF1ZXJ5KCB0aGlzICkud3JhcEFsbCggaXNGdW5jdGlvbiA/IGh0bWwuY2FsbCh0aGlzLCBpKSA6IGh0bWwgKTsKCQl9KTsKCX0sCgoJdW53cmFwOiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5wYXJlbnQoKS5lYWNoKGZ1bmN0aW9uKCkgewoJCQlpZiAoICFqUXVlcnkubm9kZU5hbWUoIHRoaXMsICJib2R5IiApICkgewoJCQkJalF1ZXJ5KCB0aGlzICkucmVwbGFjZVdpdGgoIHRoaXMuY2hpbGROb2RlcyApOwoJCQl9CgkJfSkuZW5kKCk7Cgl9LAoKCWFwcGVuZDogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMuZG9tTWFuaXAoYXJndW1lbnRzLCB0cnVlLCBmdW5jdGlvbiggZWxlbSApIHsKCQkJaWYgKCB0aGlzLm5vZGVUeXBlID09PSAxIHx8IHRoaXMubm9kZVR5cGUgPT09IDExIHx8IHRoaXMubm9kZVR5cGUgPT09IDkgKSB7CgkJCQl0aGlzLmFwcGVuZENoaWxkKCBlbGVtICk7CgkJCX0KCQl9KTsKCX0sCgoJcHJlcGVuZDogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMuZG9tTWFuaXAoYXJndW1lbnRzLCB0cnVlLCBmdW5jdGlvbiggZWxlbSApIHsKCQkJaWYgKCB0aGlzLm5vZGVUeXBlID09PSAxIHx8IHRoaXMubm9kZVR5cGUgPT09IDExIHx8IHRoaXMubm9kZVR5cGUgPT09IDkgKSB7CgkJCQl0aGlzLmluc2VydEJlZm9yZSggZWxlbSwgdGhpcy5maXJzdENoaWxkICk7CgkJCX0KCQl9KTsKCX0sCgoJYmVmb3JlOiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5kb21NYW5pcCggYXJndW1lbnRzLCBmYWxzZSwgZnVuY3Rpb24oIGVsZW0gKSB7CgkJCWlmICggdGhpcy5wYXJlbnROb2RlICkgewoJCQkJdGhpcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZSggZWxlbSwgdGhpcyApOwoJCQl9CgkJfSk7Cgl9LAoKCWFmdGVyOiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5kb21NYW5pcCggYXJndW1lbnRzLCBmYWxzZSwgZnVuY3Rpb24oIGVsZW0gKSB7CgkJCWlmICggdGhpcy5wYXJlbnROb2RlICkgewoJCQkJdGhpcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZSggZWxlbSwgdGhpcy5uZXh0U2libGluZyApOwoJCQl9CgkJfSk7Cgl9LAoKCS8vIGtlZXBEYXRhIGlzIGZvciBpbnRlcm5hbCB1c2Ugb25seS0tZG8gbm90IGRvY3VtZW50CglyZW1vdmU6IGZ1bmN0aW9uKCBzZWxlY3Rvciwga2VlcERhdGEgKSB7CgkJdmFyIGVsZW0sCgkJCWkgPSAwOwoKCQlmb3IgKCA7IChlbGVtID0gdGhpc1tpXSkgIT0gbnVsbDsgaSsrICkgewoJCQlpZiAoICFzZWxlY3RvciB8fCBqUXVlcnkuZmlsdGVyKCBzZWxlY3RvciwgWyBlbGVtIF0gKS5sZW5ndGggPiAwICkgewoJCQkJaWYgKCAha2VlcERhdGEgJiYgZWxlbS5ub2RlVHlwZSA9PT0gMSApIHsKCQkJCQlqUXVlcnkuY2xlYW5EYXRhKCBnZXRBbGwoIGVsZW0gKSApOwoJCQkJfQoKCQkJCWlmICggZWxlbS5wYXJlbnROb2RlICkgewoJCQkJCWlmICgga2VlcERhdGEgJiYgalF1ZXJ5LmNvbnRhaW5zKCBlbGVtLm93bmVyRG9jdW1lbnQsIGVsZW0gKSApIHsKCQkJCQkJc2V0R2xvYmFsRXZhbCggZ2V0QWxsKCBlbGVtLCAic2NyaXB0IiApICk7CgkJCQkJfQoJCQkJCWVsZW0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCggZWxlbSApOwoJCQkJfQoJCQl9CgkJfQoKCQlyZXR1cm4gdGhpczsKCX0sCgoJZW1wdHk6IGZ1bmN0aW9uKCkgewoJCXZhciBlbGVtLAoJCQlpID0gMDsKCgkJZm9yICggOyAoZWxlbSA9IHRoaXNbaV0pICE9IG51bGw7IGkrKyApIHsKCQkJLy8gUmVtb3ZlIGVsZW1lbnQgbm9kZXMgYW5kIHByZXZlbnQgbWVtb3J5IGxlYWtzCgkJCWlmICggZWxlbS5ub2RlVHlwZSA9PT0gMSApIHsKCQkJCWpRdWVyeS5jbGVhbkRhdGEoIGdldEFsbCggZWxlbSwgZmFsc2UgKSApOwoJCQl9CgoJCQkvLyBSZW1vdmUgYW55IHJlbWFpbmluZyBub2RlcwoJCQl3aGlsZSAoIGVsZW0uZmlyc3RDaGlsZCApIHsKCQkJCWVsZW0ucmVtb3ZlQ2hpbGQoIGVsZW0uZmlyc3RDaGlsZCApOwoJCQl9CgoJCQkvLyBJZiB0aGlzIGlzIGEgc2VsZWN0LCBlbnN1cmUgdGhhdCBpdCBkaXNwbGF5cyBlbXB0eSAoIzEyMzM2KQoJCQkvLyBTdXBwb3J0OiBJRTw5CgkJCWlmICggZWxlbS5vcHRpb25zICYmIGpRdWVyeS5ub2RlTmFtZSggZWxlbSwgInNlbGVjdCIgKSApIHsKCQkJCWVsZW0ub3B0aW9ucy5sZW5ndGggPSAwOwoJCQl9CgkJfQoKCQlyZXR1cm4gdGhpczsKCX0sCgoJY2xvbmU6IGZ1bmN0aW9uKCBkYXRhQW5kRXZlbnRzLCBkZWVwRGF0YUFuZEV2ZW50cyApIHsKCQlkYXRhQW5kRXZlbnRzID0gZGF0YUFuZEV2ZW50cyA9PSBudWxsID8gZmFsc2UgOiBkYXRhQW5kRXZlbnRzOwoJCWRlZXBEYXRhQW5kRXZlbnRzID0gZGVlcERhdGFBbmRFdmVudHMgPT0gbnVsbCA/IGRhdGFBbmRFdmVudHMgOiBkZWVwRGF0YUFuZEV2ZW50czsKCgkJcmV0dXJuIHRoaXMubWFwKCBmdW5jdGlvbiAoKSB7CgkJCXJldHVybiBqUXVlcnkuY2xvbmUoIHRoaXMsIGRhdGFBbmRFdmVudHMsIGRlZXBEYXRhQW5kRXZlbnRzICk7CgkJfSk7Cgl9LAoKCWh0bWw6IGZ1bmN0aW9uKCB2YWx1ZSApIHsKCQlyZXR1cm4galF1ZXJ5LmFjY2VzcyggdGhpcywgZnVuY3Rpb24oIHZhbHVlICkgewoJCQl2YXIgZWxlbSA9IHRoaXNbMF0gfHwge30sCgkJCQlpID0gMCwKCQkJCWwgPSB0aGlzLmxlbmd0aDsKCgkJCWlmICggdmFsdWUgPT09IHVuZGVmaW5lZCApIHsKCQkJCXJldHVybiBlbGVtLm5vZGVUeXBlID09PSAxID8KCQkJCQllbGVtLmlubmVySFRNTC5yZXBsYWNlKCByaW5saW5lalF1ZXJ5LCAiIiApIDoKCQkJCQl1bmRlZmluZWQ7CgkJCX0KCgkJCS8vIFNlZSBpZiB3ZSBjYW4gdGFrZSBhIHNob3J0Y3V0IGFuZCBqdXN0IHVzZSBpbm5lckhUTUwKCQkJaWYgKCB0eXBlb2YgdmFsdWUgPT09ICJzdHJpbmciICYmICFybm9Jbm5lcmh0bWwudGVzdCggdmFsdWUgKSAmJgoJCQkJKCBqUXVlcnkuc3VwcG9ydC5odG1sU2VyaWFsaXplIHx8ICFybm9zaGltY2FjaGUudGVzdCggdmFsdWUgKSAgKSAmJgoJCQkJKCBqUXVlcnkuc3VwcG9ydC5sZWFkaW5nV2hpdGVzcGFjZSB8fCAhcmxlYWRpbmdXaGl0ZXNwYWNlLnRlc3QoIHZhbHVlICkgKSAmJgoJCQkJIXdyYXBNYXBbICggcnRhZ05hbWUuZXhlYyggdmFsdWUgKSB8fCBbIiIsICIiXSApWzFdLnRvTG93ZXJDYXNlKCkgXSApIHsKCgkJCQl2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoIHJ4aHRtbFRhZywgIjwkMT48LyQyPiIgKTsKCgkJCQl0cnkgewoJCQkJCWZvciAoOyBpIDwgbDsgaSsrICkgewoJCQkJCQkvLyBSZW1vdmUgZWxlbWVudCBub2RlcyBhbmQgcHJldmVudCBtZW1vcnkgbGVha3MKCQkJCQkJZWxlbSA9IHRoaXNbaV0gfHwge307CgkJCQkJCWlmICggZWxlbS5ub2RlVHlwZSA9PT0gMSApIHsKCQkJCQkJCWpRdWVyeS5jbGVhbkRhdGEoIGdldEFsbCggZWxlbSwgZmFsc2UgKSApOwoJCQkJCQkJZWxlbS5pbm5lckhUTUwgPSB2YWx1ZTsKCQkJCQkJfQoJCQkJCX0KCgkJCQkJZWxlbSA9IDA7CgoJCQkJLy8gSWYgdXNpbmcgaW5uZXJIVE1MIHRocm93cyBhbiBleGNlcHRpb24sIHVzZSB0aGUgZmFsbGJhY2sgbWV0aG9kCgkJCQl9IGNhdGNoKGUpIHt9CgkJCX0KCgkJCWlmICggZWxlbSApIHsKCQkJCXRoaXMuZW1wdHkoKS5hcHBlbmQoIHZhbHVlICk7CgkJCX0KCQl9LCBudWxsLCB2YWx1ZSwgYXJndW1lbnRzLmxlbmd0aCApOwoJfSwKCglyZXBsYWNlV2l0aDogZnVuY3Rpb24oIHZhbHVlICkgewoJCXZhciBpc0Z1bmMgPSBqUXVlcnkuaXNGdW5jdGlvbiggdmFsdWUgKTsKCgkJLy8gTWFrZSBzdXJlIHRoYXQgdGhlIGVsZW1lbnRzIGFyZSByZW1vdmVkIGZyb20gdGhlIERPTSBiZWZvcmUgdGhleSBhcmUgaW5zZXJ0ZWQKCQkvLyB0aGlzIGNhbiBoZWxwIGZpeCByZXBsYWNpbmcgYSBwYXJlbnQgd2l0aCBjaGlsZCBlbGVtZW50cwoJCWlmICggIWlzRnVuYyAmJiB0eXBlb2YgdmFsdWUgIT09ICJzdHJpbmciICkgewoJCQl2YWx1ZSA9IGpRdWVyeSggdmFsdWUgKS5ub3QoIHRoaXMgKS5kZXRhY2goKTsKCQl9CgoJCXJldHVybiB0aGlzLmRvbU1hbmlwKCBbIHZhbHVlIF0sIHRydWUsIGZ1bmN0aW9uKCBlbGVtICkgewoJCQl2YXIgbmV4dCA9IHRoaXMubmV4dFNpYmxpbmcsCgkJCQlwYXJlbnQgPSB0aGlzLnBhcmVudE5vZGU7CgoJCQlpZiAoIHBhcmVudCApIHsKCQkJCWpRdWVyeSggdGhpcyApLnJlbW92ZSgpOwoJCQkJcGFyZW50Lmluc2VydEJlZm9yZSggZWxlbSwgbmV4dCApOwoJCQl9CgkJfSk7Cgl9LAoKCWRldGFjaDogZnVuY3Rpb24oIHNlbGVjdG9yICkgewoJCXJldHVybiB0aGlzLnJlbW92ZSggc2VsZWN0b3IsIHRydWUgKTsKCX0sCgoJZG9tTWFuaXA6IGZ1bmN0aW9uKCBhcmdzLCB0YWJsZSwgY2FsbGJhY2sgKSB7CgoJCS8vIEZsYXR0ZW4gYW55IG5lc3RlZCBhcnJheXMKCQlhcmdzID0gY29yZV9jb25jYXQuYXBwbHkoIFtdLCBhcmdzICk7CgoJCXZhciBmaXJzdCwgbm9kZSwgaGFzU2NyaXB0cywKCQkJc2NyaXB0cywgZG9jLCBmcmFnbWVudCwKCQkJaSA9IDAsCgkJCWwgPSB0aGlzLmxlbmd0aCwKCQkJc2V0ID0gdGhpcywKCQkJaU5vQ2xvbmUgPSBsIC0gMSwKCQkJdmFsdWUgPSBhcmdzWzBdLAoJCQlpc0Z1bmN0aW9uID0galF1ZXJ5LmlzRnVuY3Rpb24oIHZhbHVlICk7CgoJCS8vIFdlIGNhbid0IGNsb25lTm9kZSBmcmFnbWVudHMgdGhhdCBjb250YWluIGNoZWNrZWQsIGluIFdlYktpdAoJCWlmICggaXNGdW5jdGlvbiB8fCAhKCBsIDw9IDEgfHwgdHlwZW9mIHZhbHVlICE9PSAic3RyaW5nIiB8fCBqUXVlcnkuc3VwcG9ydC5jaGVja0Nsb25lIHx8ICFyY2hlY2tlZC50ZXN0KCB2YWx1ZSApICkgKSB7CgkJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oIGluZGV4ICkgewoJCQkJdmFyIHNlbGYgPSBzZXQuZXEoIGluZGV4ICk7CgkJCQlpZiAoIGlzRnVuY3Rpb24gKSB7CgkJCQkJYXJnc1swXSA9IHZhbHVlLmNhbGwoIHRoaXMsIGluZGV4LCB0YWJsZSA/IHNlbGYuaHRtbCgpIDogdW5kZWZpbmVkICk7CgkJCQl9CgkJCQlzZWxmLmRvbU1hbmlwKCBhcmdzLCB0YWJsZSwgY2FsbGJhY2sgKTsKCQkJfSk7CgkJfQoKCQlpZiAoIGwgKSB7CgkJCWZyYWdtZW50ID0galF1ZXJ5LmJ1aWxkRnJhZ21lbnQoIGFyZ3MsIHRoaXNbIDAgXS5vd25lckRvY3VtZW50LCBmYWxzZSwgdGhpcyApOwoJCQlmaXJzdCA9IGZyYWdtZW50LmZpcnN0Q2hpbGQ7CgoJCQlpZiAoIGZyYWdtZW50LmNoaWxkTm9kZXMubGVuZ3RoID09PSAxICkgewoJCQkJZnJhZ21lbnQgPSBmaXJzdDsKCQkJfQoKCQkJaWYgKCBmaXJzdCApIHsKCQkJCXRhYmxlID0gdGFibGUgJiYgalF1ZXJ5Lm5vZGVOYW1lKCBmaXJzdCwgInRyIiApOwoJCQkJc2NyaXB0cyA9IGpRdWVyeS5tYXAoIGdldEFsbCggZnJhZ21lbnQsICJzY3JpcHQiICksIGRpc2FibGVTY3JpcHQgKTsKCQkJCWhhc1NjcmlwdHMgPSBzY3JpcHRzLmxlbmd0aDsKCgkJCQkvLyBVc2UgdGhlIG9yaWdpbmFsIGZyYWdtZW50IGZvciB0aGUgbGFzdCBpdGVtIGluc3RlYWQgb2YgdGhlIGZpcnN0IGJlY2F1c2UgaXQgY2FuIGVuZCB1cAoJCQkJLy8gYmVpbmcgZW1wdGllZCBpbmNvcnJlY3RseSBpbiBjZXJ0YWluIHNpdHVhdGlvbnMgKCM4MDcwKS4KCQkJCWZvciAoIDsgaSA8IGw7IGkrKyApIHsKCQkJCQlub2RlID0gZnJhZ21lbnQ7CgoJCQkJCWlmICggaSAhPT0gaU5vQ2xvbmUgKSB7CgkJCQkJCW5vZGUgPSBqUXVlcnkuY2xvbmUoIG5vZGUsIHRydWUsIHRydWUgKTsKCgkJCQkJCS8vIEtlZXAgcmVmZXJlbmNlcyB0byBjbG9uZWQgc2NyaXB0cyBmb3IgbGF0ZXIgcmVzdG9yYXRpb24KCQkJCQkJaWYgKCBoYXNTY3JpcHRzICkgewoJCQkJCQkJalF1ZXJ5Lm1lcmdlKCBzY3JpcHRzLCBnZXRBbGwoIG5vZGUsICJzY3JpcHQiICkgKTsKCQkJCQkJfQoJCQkJCX0KCgkJCQkJY2FsbGJhY2suY2FsbCgKCQkJCQkJdGFibGUgJiYgalF1ZXJ5Lm5vZGVOYW1lKCB0aGlzW2ldLCAidGFibGUiICkgPwoJCQkJCQkJZmluZE9yQXBwZW5kKCB0aGlzW2ldLCAidGJvZHkiICkgOgoJCQkJCQkJdGhpc1tpXSwKCQkJCQkJbm9kZSwKCQkJCQkJaQoJCQkJCSk7CgkJCQl9CgoJCQkJaWYgKCBoYXNTY3JpcHRzICkgewoJCQkJCWRvYyA9IHNjcmlwdHNbIHNjcmlwdHMubGVuZ3RoIC0gMSBdLm93bmVyRG9jdW1lbnQ7CgoJCQkJCS8vIFJlZW5hYmxlIHNjcmlwdHMKCQkJCQlqUXVlcnkubWFwKCBzY3JpcHRzLCByZXN0b3JlU2NyaXB0ICk7CgoJCQkJCS8vIEV2YWx1YXRlIGV4ZWN1dGFibGUgc2NyaXB0cyBvbiBmaXJzdCBkb2N1bWVudCBpbnNlcnRpb24KCQkJCQlmb3IgKCBpID0gMDsgaSA8IGhhc1NjcmlwdHM7IGkrKyApIHsKCQkJCQkJbm9kZSA9IHNjcmlwdHNbIGkgXTsKCQkJCQkJaWYgKCByc2NyaXB0VHlwZS50ZXN0KCBub2RlLnR5cGUgfHwgIiIgKSAmJgoJCQkJCQkJIWpRdWVyeS5fZGF0YSggbm9kZSwgImdsb2JhbEV2YWwiICkgJiYgalF1ZXJ5LmNvbnRhaW5zKCBkb2MsIG5vZGUgKSApIHsKCgkJCQkJCQlpZiAoIG5vZGUuc3JjICkgewoJCQkJCQkJCS8vIEhvcGUgYWpheCBpcyBhdmFpbGFibGUuLi4KCQkJCQkJCQlqUXVlcnkuYWpheCh7CgkJCQkJCQkJCXVybDogbm9kZS5zcmMsCgkJCQkJCQkJCXR5cGU6ICJHRVQiLAoJCQkJCQkJCQlkYXRhVHlwZTogInNjcmlwdCIsCgkJCQkJCQkJCWFzeW5jOiBmYWxzZSwKCQkJCQkJCQkJZ2xvYmFsOiBmYWxzZSwKCQkJCQkJCQkJInRocm93cyI6IHRydWUKCQkJCQkJCQl9KTsKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJalF1ZXJ5Lmdsb2JhbEV2YWwoICggbm9kZS50ZXh0IHx8IG5vZGUudGV4dENvbnRlbnQgfHwgbm9kZS5pbm5lckhUTUwgfHwgIiIgKS5yZXBsYWNlKCByY2xlYW5TY3JpcHQsICIiICkgKTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCQkJCX0KCgkJCQkvLyBGaXggIzExODA5OiBBdm9pZCBsZWFraW5nIG1lbW9yeQoJCQkJZnJhZ21lbnQgPSBmaXJzdCA9IG51bGw7CgkJCX0KCQl9CgoJCXJldHVybiB0aGlzOwoJfQp9KTsKCmZ1bmN0aW9uIGZpbmRPckFwcGVuZCggZWxlbSwgdGFnICkgewoJcmV0dXJuIGVsZW0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoIHRhZyApWzBdIHx8IGVsZW0uYXBwZW5kQ2hpbGQoIGVsZW0ub3duZXJEb2N1bWVudC5jcmVhdGVFbGVtZW50KCB0YWcgKSApOwp9CgovLyBSZXBsYWNlL3Jlc3RvcmUgdGhlIHR5cGUgYXR0cmlidXRlIG9mIHNjcmlwdCBlbGVtZW50cyBmb3Igc2FmZSBET00gbWFuaXB1bGF0aW9uCmZ1bmN0aW9uIGRpc2FibGVTY3JpcHQoIGVsZW0gKSB7Cgl2YXIgYXR0ciA9IGVsZW0uZ2V0QXR0cmlidXRlTm9kZSgidHlwZSIpOwoJZWxlbS50eXBlID0gKCBhdHRyICYmIGF0dHIuc3BlY2lmaWVkICkgKyAiLyIgKyBlbGVtLnR5cGU7CglyZXR1cm4gZWxlbTsKfQpmdW5jdGlvbiByZXN0b3JlU2NyaXB0KCBlbGVtICkgewoJdmFyIG1hdGNoID0gcnNjcmlwdFR5cGVNYXNrZWQuZXhlYyggZWxlbS50eXBlICk7CglpZiAoIG1hdGNoICkgewoJCWVsZW0udHlwZSA9IG1hdGNoWzFdOwoJfSBlbHNlIHsKCQllbGVtLnJlbW92ZUF0dHJpYnV0ZSgidHlwZSIpOwoJfQoJcmV0dXJuIGVsZW07Cn0KCi8vIE1hcmsgc2NyaXB0cyBhcyBoYXZpbmcgYWxyZWFkeSBiZWVuIGV2YWx1YXRlZApmdW5jdGlvbiBzZXRHbG9iYWxFdmFsKCBlbGVtcywgcmVmRWxlbWVudHMgKSB7Cgl2YXIgZWxlbSwKCQlpID0gMDsKCWZvciAoIDsgKGVsZW0gPSBlbGVtc1tpXSkgIT0gbnVsbDsgaSsrICkgewoJCWpRdWVyeS5fZGF0YSggZWxlbSwgImdsb2JhbEV2YWwiLCAhcmVmRWxlbWVudHMgfHwgalF1ZXJ5Ll9kYXRhKCByZWZFbGVtZW50c1tpXSwgImdsb2JhbEV2YWwiICkgKTsKCX0KfQoKZnVuY3Rpb24gY2xvbmVDb3B5RXZlbnQoIHNyYywgZGVzdCApIHsKCglpZiAoIGRlc3Qubm9kZVR5cGUgIT09IDEgfHwgIWpRdWVyeS5oYXNEYXRhKCBzcmMgKSApIHsKCQlyZXR1cm47Cgl9CgoJdmFyIHR5cGUsIGksIGwsCgkJb2xkRGF0YSA9IGpRdWVyeS5fZGF0YSggc3JjICksCgkJY3VyRGF0YSA9IGpRdWVyeS5fZGF0YSggZGVzdCwgb2xkRGF0YSApLAoJCWV2ZW50cyA9IG9sZERhdGEuZXZlbnRzOwoKCWlmICggZXZlbnRzICkgewoJCWRlbGV0ZSBjdXJEYXRhLmhhbmRsZTsKCQljdXJEYXRhLmV2ZW50cyA9IHt9OwoKCQlmb3IgKCB0eXBlIGluIGV2ZW50cyApIHsKCQkJZm9yICggaSA9IDAsIGwgPSBldmVudHNbIHR5cGUgXS5sZW5ndGg7IGkgPCBsOyBpKysgKSB7CgkJCQlqUXVlcnkuZXZlbnQuYWRkKCBkZXN0LCB0eXBlLCBldmVudHNbIHR5cGUgXVsgaSBdICk7CgkJCX0KCQl9Cgl9CgoJLy8gbWFrZSB0aGUgY2xvbmVkIHB1YmxpYyBkYXRhIG9iamVjdCBhIGNvcHkgZnJvbSB0aGUgb3JpZ2luYWwKCWlmICggY3VyRGF0YS5kYXRhICkgewoJCWN1ckRhdGEuZGF0YSA9IGpRdWVyeS5leHRlbmQoIHt9LCBjdXJEYXRhLmRhdGEgKTsKCX0KfQoKZnVuY3Rpb24gZml4Q2xvbmVOb2RlSXNzdWVzKCBzcmMsIGRlc3QgKSB7Cgl2YXIgbm9kZU5hbWUsIGUsIGRhdGE7CgoJLy8gV2UgZG8gbm90IG5lZWQgdG8gZG8gYW55dGhpbmcgZm9yIG5vbi1FbGVtZW50cwoJaWYgKCBkZXN0Lm5vZGVUeXBlICE9PSAxICkgewoJCXJldHVybjsKCX0KCglub2RlTmFtZSA9IGRlc3Qubm9kZU5hbWUudG9Mb3dlckNhc2UoKTsKCgkvLyBJRTYtOCBjb3BpZXMgZXZlbnRzIGJvdW5kIHZpYSBhdHRhY2hFdmVudCB3aGVuIHVzaW5nIGNsb25lTm9kZS4KCWlmICggIWpRdWVyeS5zdXBwb3J0Lm5vQ2xvbmVFdmVudCAmJiBkZXN0WyBqUXVlcnkuZXhwYW5kbyBdICkgewoJCWRhdGEgPSBqUXVlcnkuX2RhdGEoIGRlc3QgKTsKCgkJZm9yICggZSBpbiBkYXRhLmV2ZW50cyApIHsKCQkJalF1ZXJ5LnJlbW92ZUV2ZW50KCBkZXN0LCBlLCBkYXRhLmhhbmRsZSApOwoJCX0KCgkJLy8gRXZlbnQgZGF0YSBnZXRzIHJlZmVyZW5jZWQgaW5zdGVhZCBvZiBjb3BpZWQgaWYgdGhlIGV4cGFuZG8gZ2V0cyBjb3BpZWQgdG9vCgkJZGVzdC5yZW1vdmVBdHRyaWJ1dGUoIGpRdWVyeS5leHBhbmRvICk7Cgl9CgoJLy8gSUUgYmxhbmtzIGNvbnRlbnRzIHdoZW4gY2xvbmluZyBzY3JpcHRzLCBhbmQgdHJpZXMgdG8gZXZhbHVhdGUgbmV3bHktc2V0IHRleHQKCWlmICggbm9kZU5hbWUgPT09ICJzY3JpcHQiICYmIGRlc3QudGV4dCAhPT0gc3JjLnRleHQgKSB7CgkJZGlzYWJsZVNjcmlwdCggZGVzdCApLnRleHQgPSBzcmMudGV4dDsKCQlyZXN0b3JlU2NyaXB0KCBkZXN0ICk7CgoJLy8gSUU2LTEwIGltcHJvcGVybHkgY2xvbmVzIGNoaWxkcmVuIG9mIG9iamVjdCBlbGVtZW50cyB1c2luZyBjbGFzc2lkLgoJLy8gSUUxMCB0aHJvd3MgTm9Nb2RpZmljYXRpb25BbGxvd2VkRXJyb3IgaWYgcGFyZW50IGlzIG51bGwsICMxMjEzMi4KCX0gZWxzZSBpZiAoIG5vZGVOYW1lID09PSAib2JqZWN0IiApIHsKCQlpZiAoIGRlc3QucGFyZW50Tm9kZSApIHsKCQkJZGVzdC5vdXRlckhUTUwgPSBzcmMub3V0ZXJIVE1MOwoJCX0KCgkJLy8gVGhpcyBwYXRoIGFwcGVhcnMgdW5hdm9pZGFibGUgZm9yIElFOS4gV2hlbiBjbG9uaW5nIGFuIG9iamVjdAoJCS8vIGVsZW1lbnQgaW4gSUU5LCB0aGUgb3V0ZXJIVE1MIHN0cmF0ZWd5IGFib3ZlIGlzIG5vdCBzdWZmaWNpZW50LgoJCS8vIElmIHRoZSBzcmMgaGFzIGlubmVySFRNTCBhbmQgdGhlIGRlc3RpbmF0aW9uIGRvZXMgbm90LAoJCS8vIGNvcHkgdGhlIHNyYy5pbm5lckhUTUwgaW50byB0aGUgZGVzdC5pbm5lckhUTUwuICMxMDMyNAoJCWlmICggalF1ZXJ5LnN1cHBvcnQuaHRtbDVDbG9uZSAmJiAoIHNyYy5pbm5lckhUTUwgJiYgIWpRdWVyeS50cmltKGRlc3QuaW5uZXJIVE1MKSApICkgewoJCQlkZXN0LmlubmVySFRNTCA9IHNyYy5pbm5lckhUTUw7CgkJfQoKCX0gZWxzZSBpZiAoIG5vZGVOYW1lID09PSAiaW5wdXQiICYmIG1hbmlwdWxhdGlvbl9yY2hlY2thYmxlVHlwZS50ZXN0KCBzcmMudHlwZSApICkgewoJCS8vIElFNi04IGZhaWxzIHRvIHBlcnNpc3QgdGhlIGNoZWNrZWQgc3RhdGUgb2YgYSBjbG9uZWQgY2hlY2tib3gKCQkvLyBvciByYWRpbyBidXR0b24uIFdvcnNlLCBJRTYtNyBmYWlsIHRvIGdpdmUgdGhlIGNsb25lZCBlbGVtZW50CgkJLy8gYSBjaGVja2VkIGFwcGVhcmFuY2UgaWYgdGhlIGRlZmF1bHRDaGVja2VkIHZhbHVlIGlzbid0IGFsc28gc2V0CgoJCWRlc3QuZGVmYXVsdENoZWNrZWQgPSBkZXN0LmNoZWNrZWQgPSBzcmMuY2hlY2tlZDsKCgkJLy8gSUU2LTcgZ2V0IGNvbmZ1c2VkIGFuZCBlbmQgdXAgc2V0dGluZyB0aGUgdmFsdWUgb2YgYSBjbG9uZWQKCQkvLyBjaGVja2JveC9yYWRpbyBidXR0b24gdG8gYW4gZW1wdHkgc3RyaW5nIGluc3RlYWQgb2YgIm9uIgoJCWlmICggZGVzdC52YWx1ZSAhPT0gc3JjLnZhbHVlICkgewoJCQlkZXN0LnZhbHVlID0gc3JjLnZhbHVlOwoJCX0KCgkvLyBJRTYtOCBmYWlscyB0byByZXR1cm4gdGhlIHNlbGVjdGVkIG9wdGlvbiB0byB0aGUgZGVmYXVsdCBzZWxlY3RlZAoJLy8gc3RhdGUgd2hlbiBjbG9uaW5nIG9wdGlvbnMKCX0gZWxzZSBpZiAoIG5vZGVOYW1lID09PSAib3B0aW9uIiApIHsKCQlkZXN0LmRlZmF1bHRTZWxlY3RlZCA9IGRlc3Quc2VsZWN0ZWQgPSBzcmMuZGVmYXVsdFNlbGVjdGVkOwoKCS8vIElFNi04IGZhaWxzIHRvIHNldCB0aGUgZGVmYXVsdFZhbHVlIHRvIHRoZSBjb3JyZWN0IHZhbHVlIHdoZW4KCS8vIGNsb25pbmcgb3RoZXIgdHlwZXMgb2YgaW5wdXQgZmllbGRzCgl9IGVsc2UgaWYgKCBub2RlTmFtZSA9PT0gImlucHV0IiB8fCBub2RlTmFtZSA9PT0gInRleHRhcmVhIiApIHsKCQlkZXN0LmRlZmF1bHRWYWx1ZSA9IHNyYy5kZWZhdWx0VmFsdWU7Cgl9Cn0KCmpRdWVyeS5lYWNoKHsKCWFwcGVuZFRvOiAiYXBwZW5kIiwKCXByZXBlbmRUbzogInByZXBlbmQiLAoJaW5zZXJ0QmVmb3JlOiAiYmVmb3JlIiwKCWluc2VydEFmdGVyOiAiYWZ0ZXIiLAoJcmVwbGFjZUFsbDogInJlcGxhY2VXaXRoIgp9LCBmdW5jdGlvbiggbmFtZSwgb3JpZ2luYWwgKSB7CglqUXVlcnkuZm5bIG5hbWUgXSA9IGZ1bmN0aW9uKCBzZWxlY3RvciApIHsKCQl2YXIgZWxlbXMsCgkJCWkgPSAwLAoJCQlyZXQgPSBbXSwKCQkJaW5zZXJ0ID0galF1ZXJ5KCBzZWxlY3RvciApLAoJCQlsYXN0ID0gaW5zZXJ0Lmxlbmd0aCAtIDE7CgoJCWZvciAoIDsgaSA8PSBsYXN0OyBpKysgKSB7CgkJCWVsZW1zID0gaSA9PT0gbGFzdCA/IHRoaXMgOiB0aGlzLmNsb25lKHRydWUpOwoJCQlqUXVlcnkoIGluc2VydFtpXSApWyBvcmlnaW5hbCBdKCBlbGVtcyApOwoKCQkJLy8gTW9kZXJuIGJyb3dzZXJzIGNhbiBhcHBseSBqUXVlcnkgY29sbGVjdGlvbnMgYXMgYXJyYXlzLCBidXQgb2xkSUUgbmVlZHMgYSAuZ2V0KCkKCQkJY29yZV9wdXNoLmFwcGx5KCByZXQsIGVsZW1zLmdldCgpICk7CgkJfQoKCQlyZXR1cm4gdGhpcy5wdXNoU3RhY2soIHJldCApOwoJfTsKfSk7CgpmdW5jdGlvbiBnZXRBbGwoIGNvbnRleHQsIHRhZyApIHsKCXZhciBlbGVtcywgZWxlbSwKCQlpID0gMCwKCQlmb3VuZCA9IHR5cGVvZiBjb250ZXh0LmdldEVsZW1lbnRzQnlUYWdOYW1lICE9PSBjb3JlX3N0cnVuZGVmaW5lZCA/IGNvbnRleHQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoIHRhZyB8fCAiKiIgKSA6CgkJCXR5cGVvZiBjb250ZXh0LnF1ZXJ5U2VsZWN0b3JBbGwgIT09IGNvcmVfc3RydW5kZWZpbmVkID8gY29udGV4dC5xdWVyeVNlbGVjdG9yQWxsKCB0YWcgfHwgIioiICkgOgoJCQl1bmRlZmluZWQ7CgoJaWYgKCAhZm91bmQgKSB7CgkJZm9yICggZm91bmQgPSBbXSwgZWxlbXMgPSBjb250ZXh0LmNoaWxkTm9kZXMgfHwgY29udGV4dDsgKGVsZW0gPSBlbGVtc1tpXSkgIT0gbnVsbDsgaSsrICkgewoJCQlpZiAoICF0YWcgfHwgalF1ZXJ5Lm5vZGVOYW1lKCBlbGVtLCB0YWcgKSApIHsKCQkJCWZvdW5kLnB1c2goIGVsZW0gKTsKCQkJfSBlbHNlIHsKCQkJCWpRdWVyeS5tZXJnZSggZm91bmQsIGdldEFsbCggZWxlbSwgdGFnICkgKTsKCQkJfQoJCX0KCX0KCglyZXR1cm4gdGFnID09PSB1bmRlZmluZWQgfHwgdGFnICYmIGpRdWVyeS5ub2RlTmFtZSggY29udGV4dCwgdGFnICkgPwoJCWpRdWVyeS5tZXJnZSggWyBjb250ZXh0IF0sIGZvdW5kICkgOgoJCWZvdW5kOwp9CgovLyBVc2VkIGluIGJ1aWxkRnJhZ21lbnQsIGZpeGVzIHRoZSBkZWZhdWx0Q2hlY2tlZCBwcm9wZXJ0eQpmdW5jdGlvbiBmaXhEZWZhdWx0Q2hlY2tlZCggZWxlbSApIHsKCWlmICggbWFuaXB1bGF0aW9uX3JjaGVja2FibGVUeXBlLnRlc3QoIGVsZW0udHlwZSApICkgewoJCWVsZW0uZGVmYXVsdENoZWNrZWQgPSBlbGVtLmNoZWNrZWQ7Cgl9Cn0KCmpRdWVyeS5leHRlbmQoewoJY2xvbmU6IGZ1bmN0aW9uKCBlbGVtLCBkYXRhQW5kRXZlbnRzLCBkZWVwRGF0YUFuZEV2ZW50cyApIHsKCQl2YXIgZGVzdEVsZW1lbnRzLCBub2RlLCBjbG9uZSwgaSwgc3JjRWxlbWVudHMsCgkJCWluUGFnZSA9IGpRdWVyeS5jb250YWlucyggZWxlbS5vd25lckRvY3VtZW50LCBlbGVtICk7CgoJCWlmICggalF1ZXJ5LnN1cHBvcnQuaHRtbDVDbG9uZSB8fCBqUXVlcnkuaXNYTUxEb2MoZWxlbSkgfHwgIXJub3NoaW1jYWNoZS50ZXN0KCAiPCIgKyBlbGVtLm5vZGVOYW1lICsgIj4iICkgKSB7CgkJCWNsb25lID0gZWxlbS5jbG9uZU5vZGUoIHRydWUgKTsKCgkJLy8gSUU8PTggZG9lcyBub3QgcHJvcGVybHkgY2xvbmUgZGV0YWNoZWQsIHVua25vd24gZWxlbWVudCBub2RlcwoJCX0gZWxzZSB7CgkJCWZyYWdtZW50RGl2LmlubmVySFRNTCA9IGVsZW0ub3V0ZXJIVE1MOwoJCQlmcmFnbWVudERpdi5yZW1vdmVDaGlsZCggY2xvbmUgPSBmcmFnbWVudERpdi5maXJzdENoaWxkICk7CgkJfQoKCQlpZiAoICghalF1ZXJ5LnN1cHBvcnQubm9DbG9uZUV2ZW50IHx8ICFqUXVlcnkuc3VwcG9ydC5ub0Nsb25lQ2hlY2tlZCkgJiYKCQkJCShlbGVtLm5vZGVUeXBlID09PSAxIHx8IGVsZW0ubm9kZVR5cGUgPT09IDExKSAmJiAhalF1ZXJ5LmlzWE1MRG9jKGVsZW0pICkgewoKCQkJLy8gV2UgZXNjaGV3IFNpenpsZSBoZXJlIGZvciBwZXJmb3JtYW5jZSByZWFzb25zOiBodHRwOi8vanNwZXJmLmNvbS9nZXRhbGwtdnMtc2l6emxlLzIKCQkJZGVzdEVsZW1lbnRzID0gZ2V0QWxsKCBjbG9uZSApOwoJCQlzcmNFbGVtZW50cyA9IGdldEFsbCggZWxlbSApOwoKCQkJLy8gRml4IGFsbCBJRSBjbG9uaW5nIGlzc3VlcwoJCQlmb3IgKCBpID0gMDsgKG5vZGUgPSBzcmNFbGVtZW50c1tpXSkgIT0gbnVsbDsgKytpICkgewoJCQkJLy8gRW5zdXJlIHRoYXQgdGhlIGRlc3RpbmF0aW9uIG5vZGUgaXMgbm90IG51bGw7IEZpeGVzICM5NTg3CgkJCQlpZiAoIGRlc3RFbGVtZW50c1tpXSApIHsKCQkJCQlmaXhDbG9uZU5vZGVJc3N1ZXMoIG5vZGUsIGRlc3RFbGVtZW50c1tpXSApOwoJCQkJfQoJCQl9CgkJfQoKCQkvLyBDb3B5IHRoZSBldmVudHMgZnJvbSB0aGUgb3JpZ2luYWwgdG8gdGhlIGNsb25lCgkJaWYgKCBkYXRhQW5kRXZlbnRzICkgewoJCQlpZiAoIGRlZXBEYXRhQW5kRXZlbnRzICkgewoJCQkJc3JjRWxlbWVudHMgPSBzcmNFbGVtZW50cyB8fCBnZXRBbGwoIGVsZW0gKTsKCQkJCWRlc3RFbGVtZW50cyA9IGRlc3RFbGVtZW50cyB8fCBnZXRBbGwoIGNsb25lICk7CgoJCQkJZm9yICggaSA9IDA7IChub2RlID0gc3JjRWxlbWVudHNbaV0pICE9IG51bGw7IGkrKyApIHsKCQkJCQljbG9uZUNvcHlFdmVudCggbm9kZSwgZGVzdEVsZW1lbnRzW2ldICk7CgkJCQl9CgkJCX0gZWxzZSB7CgkJCQljbG9uZUNvcHlFdmVudCggZWxlbSwgY2xvbmUgKTsKCQkJfQoJCX0KCgkJLy8gUHJlc2VydmUgc2NyaXB0IGV2YWx1YXRpb24gaGlzdG9yeQoJCWRlc3RFbGVtZW50cyA9IGdldEFsbCggY2xvbmUsICJzY3JpcHQiICk7CgkJaWYgKCBkZXN0RWxlbWVudHMubGVuZ3RoID4gMCApIHsKCQkJc2V0R2xvYmFsRXZhbCggZGVzdEVsZW1lbnRzLCAhaW5QYWdlICYmIGdldEFsbCggZWxlbSwgInNjcmlwdCIgKSApOwoJCX0KCgkJZGVzdEVsZW1lbnRzID0gc3JjRWxlbWVudHMgPSBub2RlID0gbnVsbDsKCgkJLy8gUmV0dXJuIHRoZSBjbG9uZWQgc2V0CgkJcmV0dXJuIGNsb25lOwoJfSwKCglidWlsZEZyYWdtZW50OiBmdW5jdGlvbiggZWxlbXMsIGNvbnRleHQsIHNjcmlwdHMsIHNlbGVjdGlvbiApIHsKCQl2YXIgaiwgZWxlbSwgY29udGFpbnMsCgkJCXRtcCwgdGFnLCB0Ym9keSwgd3JhcCwKCQkJbCA9IGVsZW1zLmxlbmd0aCwKCgkJCS8vIEVuc3VyZSBhIHNhZmUgZnJhZ21lbnQKCQkJc2FmZSA9IGNyZWF0ZVNhZmVGcmFnbWVudCggY29udGV4dCApLAoKCQkJbm9kZXMgPSBbXSwKCQkJaSA9IDA7CgoJCWZvciAoIDsgaSA8IGw7IGkrKyApIHsKCQkJZWxlbSA9IGVsZW1zWyBpIF07CgoJCQlpZiAoIGVsZW0gfHwgZWxlbSA9PT0gMCApIHsKCgkJCQkvLyBBZGQgbm9kZXMgZGlyZWN0bHkKCQkJCWlmICggalF1ZXJ5LnR5cGUoIGVsZW0gKSA9PT0gIm9iamVjdCIgKSB7CgkJCQkJalF1ZXJ5Lm1lcmdlKCBub2RlcywgZWxlbS5ub2RlVHlwZSA/IFsgZWxlbSBdIDogZWxlbSApOwoKCQkJCS8vIENvbnZlcnQgbm9uLWh0bWwgaW50byBhIHRleHQgbm9kZQoJCQkJfSBlbHNlIGlmICggIXJodG1sLnRlc3QoIGVsZW0gKSApIHsKCQkJCQlub2Rlcy5wdXNoKCBjb250ZXh0LmNyZWF0ZVRleHROb2RlKCBlbGVtICkgKTsKCgkJCQkvLyBDb252ZXJ0IGh0bWwgaW50byBET00gbm9kZXMKCQkJCX0gZWxzZSB7CgkJCQkJdG1wID0gdG1wIHx8IHNhZmUuYXBwZW5kQ2hpbGQoIGNvbnRleHQuY3JlYXRlRWxlbWVudCgiZGl2IikgKTsKCgkJCQkJLy8gRGVzZXJpYWxpemUgYSBzdGFuZGFyZCByZXByZXNlbnRhdGlvbgoJCQkJCXRhZyA9ICggcnRhZ05hbWUuZXhlYyggZWxlbSApIHx8IFsiIiwgIiJdIClbMV0udG9Mb3dlckNhc2UoKTsKCQkJCQl3cmFwID0gd3JhcE1hcFsgdGFnIF0gfHwgd3JhcE1hcC5fZGVmYXVsdDsKCgkJCQkJdG1wLmlubmVySFRNTCA9IHdyYXBbMV0gKyBlbGVtLnJlcGxhY2UoIHJ4aHRtbFRhZywgIjwkMT48LyQyPiIgKSArIHdyYXBbMl07CgoJCQkJCS8vIERlc2NlbmQgdGhyb3VnaCB3cmFwcGVycyB0byB0aGUgcmlnaHQgY29udGVudAoJCQkJCWogPSB3cmFwWzBdOwoJCQkJCXdoaWxlICggai0tICkgewoJCQkJCQl0bXAgPSB0bXAubGFzdENoaWxkOwoJCQkJCX0KCgkJCQkJLy8gTWFudWFsbHkgYWRkIGxlYWRpbmcgd2hpdGVzcGFjZSByZW1vdmVkIGJ5IElFCgkJCQkJaWYgKCAhalF1ZXJ5LnN1cHBvcnQubGVhZGluZ1doaXRlc3BhY2UgJiYgcmxlYWRpbmdXaGl0ZXNwYWNlLnRlc3QoIGVsZW0gKSApIHsKCQkJCQkJbm9kZXMucHVzaCggY29udGV4dC5jcmVhdGVUZXh0Tm9kZSggcmxlYWRpbmdXaGl0ZXNwYWNlLmV4ZWMoIGVsZW0gKVswXSApICk7CgkJCQkJfQoKCQkJCQkvLyBSZW1vdmUgSUUncyBhdXRvaW5zZXJ0ZWQgPHRib2R5PiBmcm9tIHRhYmxlIGZyYWdtZW50cwoJCQkJCWlmICggIWpRdWVyeS5zdXBwb3J0LnRib2R5ICkgewoKCQkJCQkJLy8gU3RyaW5nIHdhcyBhIDx0YWJsZT4sICptYXkqIGhhdmUgc3B1cmlvdXMgPHRib2R5PgoJCQkJCQllbGVtID0gdGFnID09PSAidGFibGUiICYmICFydGJvZHkudGVzdCggZWxlbSApID8KCQkJCQkJCXRtcC5maXJzdENoaWxkIDoKCgkJCQkJCQkvLyBTdHJpbmcgd2FzIGEgYmFyZSA8dGhlYWQ+IG9yIDx0Zm9vdD4KCQkJCQkJCXdyYXBbMV0gPT09ICI8dGFibGU+IiAmJiAhcnRib2R5LnRlc3QoIGVsZW0gKSA/CgkJCQkJCQkJdG1wIDoKCQkJCQkJCQkwOwoKCQkJCQkJaiA9IGVsZW0gJiYgZWxlbS5jaGlsZE5vZGVzLmxlbmd0aDsKCQkJCQkJd2hpbGUgKCBqLS0gKSB7CgkJCQkJCQlpZiAoIGpRdWVyeS5ub2RlTmFtZSggKHRib2R5ID0gZWxlbS5jaGlsZE5vZGVzW2pdKSwgInRib2R5IiApICYmICF0Ym9keS5jaGlsZE5vZGVzLmxlbmd0aCApIHsKCQkJCQkJCQllbGVtLnJlbW92ZUNoaWxkKCB0Ym9keSApOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoKCQkJCQlqUXVlcnkubWVyZ2UoIG5vZGVzLCB0bXAuY2hpbGROb2RlcyApOwoKCQkJCQkvLyBGaXggIzEyMzkyIGZvciBXZWJLaXQgYW5kIElFID4gOQoJCQkJCXRtcC50ZXh0Q29udGVudCA9ICIiOwoKCQkJCQkvLyBGaXggIzEyMzkyIGZvciBvbGRJRQoJCQkJCXdoaWxlICggdG1wLmZpcnN0Q2hpbGQgKSB7CgkJCQkJCXRtcC5yZW1vdmVDaGlsZCggdG1wLmZpcnN0Q2hpbGQgKTsKCQkJCQl9CgoJCQkJCS8vIFJlbWVtYmVyIHRoZSB0b3AtbGV2ZWwgY29udGFpbmVyIGZvciBwcm9wZXIgY2xlYW51cAoJCQkJCXRtcCA9IHNhZmUubGFzdENoaWxkOwoJCQkJfQoJCQl9CgkJfQoKCQkvLyBGaXggIzExMzU2OiBDbGVhciBlbGVtZW50cyBmcm9tIGZyYWdtZW50CgkJaWYgKCB0bXAgKSB7CgkJCXNhZmUucmVtb3ZlQ2hpbGQoIHRtcCApOwoJCX0KCgkJLy8gUmVzZXQgZGVmYXVsdENoZWNrZWQgZm9yIGFueSByYWRpb3MgYW5kIGNoZWNrYm94ZXMKCQkvLyBhYm91dCB0byBiZSBhcHBlbmRlZCB0byB0aGUgRE9NIGluIElFIDYvNyAoIzgwNjApCgkJaWYgKCAhalF1ZXJ5LnN1cHBvcnQuYXBwZW5kQ2hlY2tlZCApIHsKCQkJalF1ZXJ5LmdyZXAoIGdldEFsbCggbm9kZXMsICJpbnB1dCIgKSwgZml4RGVmYXVsdENoZWNrZWQgKTsKCQl9CgoJCWkgPSAwOwoJCXdoaWxlICggKGVsZW0gPSBub2Rlc1sgaSsrIF0pICkgewoKCQkJLy8gIzQwODcgLSBJZiBvcmlnaW4gYW5kIGRlc3RpbmF0aW9uIGVsZW1lbnRzIGFyZSB0aGUgc2FtZSwgYW5kIHRoaXMgaXMKCQkJLy8gdGhhdCBlbGVtZW50LCBkbyBub3QgZG8gYW55dGhpbmcKCQkJaWYgKCBzZWxlY3Rpb24gJiYgalF1ZXJ5LmluQXJyYXkoIGVsZW0sIHNlbGVjdGlvbiApICE9PSAtMSApIHsKCQkJCWNvbnRpbnVlOwoJCQl9CgoJCQljb250YWlucyA9IGpRdWVyeS5jb250YWlucyggZWxlbS5vd25lckRvY3VtZW50LCBlbGVtICk7CgoJCQkvLyBBcHBlbmQgdG8gZnJhZ21lbnQKCQkJdG1wID0gZ2V0QWxsKCBzYWZlLmFwcGVuZENoaWxkKCBlbGVtICksICJzY3JpcHQiICk7CgoJCQkvLyBQcmVzZXJ2ZSBzY3JpcHQgZXZhbHVhdGlvbiBoaXN0b3J5CgkJCWlmICggY29udGFpbnMgKSB7CgkJCQlzZXRHbG9iYWxFdmFsKCB0bXAgKTsKCQkJfQoKCQkJLy8gQ2FwdHVyZSBleGVjdXRhYmxlcwoJCQlpZiAoIHNjcmlwdHMgKSB7CgkJCQlqID0gMDsKCQkJCXdoaWxlICggKGVsZW0gPSB0bXBbIGorKyBdKSApIHsKCQkJCQlpZiAoIHJzY3JpcHRUeXBlLnRlc3QoIGVsZW0udHlwZSB8fCAiIiApICkgewoJCQkJCQlzY3JpcHRzLnB1c2goIGVsZW0gKTsKCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgoJCXRtcCA9IG51bGw7CgoJCXJldHVybiBzYWZlOwoJfSwKCgljbGVhbkRhdGE6IGZ1bmN0aW9uKCBlbGVtcywgLyogaW50ZXJuYWwgKi8gYWNjZXB0RGF0YSApIHsKCQl2YXIgZWxlbSwgdHlwZSwgaWQsIGRhdGEsCgkJCWkgPSAwLAoJCQlpbnRlcm5hbEtleSA9IGpRdWVyeS5leHBhbmRvLAoJCQljYWNoZSA9IGpRdWVyeS5jYWNoZSwKCQkJZGVsZXRlRXhwYW5kbyA9IGpRdWVyeS5zdXBwb3J0LmRlbGV0ZUV4cGFuZG8sCgkJCXNwZWNpYWwgPSBqUXVlcnkuZXZlbnQuc3BlY2lhbDsKCgkJZm9yICggOyAoZWxlbSA9IGVsZW1zW2ldKSAhPSBudWxsOyBpKysgKSB7CgoJCQlpZiAoIGFjY2VwdERhdGEgfHwgalF1ZXJ5LmFjY2VwdERhdGEoIGVsZW0gKSApIHsKCgkJCQlpZCA9IGVsZW1bIGludGVybmFsS2V5IF07CgkJCQlkYXRhID0gaWQgJiYgY2FjaGVbIGlkIF07CgoJCQkJaWYgKCBkYXRhICkgewoJCQkJCWlmICggZGF0YS5ldmVudHMgKSB7CgkJCQkJCWZvciAoIHR5cGUgaW4gZGF0YS5ldmVudHMgKSB7CgkJCQkJCQlpZiAoIHNwZWNpYWxbIHR5cGUgXSApIHsKCQkJCQkJCQlqUXVlcnkuZXZlbnQucmVtb3ZlKCBlbGVtLCB0eXBlICk7CgoJCQkJCQkJLy8gVGhpcyBpcyBhIHNob3J0Y3V0IHRvIGF2b2lkIGpRdWVyeS5ldmVudC5yZW1vdmUncyBvdmVyaGVhZAoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQlqUXVlcnkucmVtb3ZlRXZlbnQoIGVsZW0sIHR5cGUsIGRhdGEuaGFuZGxlICk7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9CgoJCQkJCS8vIFJlbW92ZSBjYWNoZSBvbmx5IGlmIGl0IHdhcyBub3QgYWxyZWFkeSByZW1vdmVkIGJ5IGpRdWVyeS5ldmVudC5yZW1vdmUKCQkJCQlpZiAoIGNhY2hlWyBpZCBdICkgewoKCQkJCQkJZGVsZXRlIGNhY2hlWyBpZCBdOwoKCQkJCQkJLy8gSUUgZG9lcyBub3QgYWxsb3cgdXMgdG8gZGVsZXRlIGV4cGFuZG8gcHJvcGVydGllcyBmcm9tIG5vZGVzLAoJCQkJCQkvLyBub3IgZG9lcyBpdCBoYXZlIGEgcmVtb3ZlQXR0cmlidXRlIGZ1bmN0aW9uIG9uIERvY3VtZW50IG5vZGVzOwoJCQkJCQkvLyB3ZSBtdXN0IGhhbmRsZSBhbGwgb2YgdGhlc2UgY2FzZXMKCQkJCQkJaWYgKCBkZWxldGVFeHBhbmRvICkgewoJCQkJCQkJZGVsZXRlIGVsZW1bIGludGVybmFsS2V5IF07CgoJCQkJCQl9IGVsc2UgaWYgKCB0eXBlb2YgZWxlbS5yZW1vdmVBdHRyaWJ1dGUgIT09IGNvcmVfc3RydW5kZWZpbmVkICkgewoJCQkJCQkJZWxlbS5yZW1vdmVBdHRyaWJ1dGUoIGludGVybmFsS2V5ICk7CgoJCQkJCQl9IGVsc2UgewoJCQkJCQkJZWxlbVsgaW50ZXJuYWxLZXkgXSA9IG51bGw7CgkJCQkJCX0KCgkJCQkJCWNvcmVfZGVsZXRlZElkcy5wdXNoKCBpZCApOwoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCX0KfSk7CnZhciBpZnJhbWUsIGdldFN0eWxlcywgY3VyQ1NTLAoJcmFscGhhID0gL2FscGhhXChbXildKlwpL2ksCglyb3BhY2l0eSA9IC9vcGFjaXR5XHMqPVxzKihbXildKikvLAoJcnBvc2l0aW9uID0gL14odG9wfHJpZ2h0fGJvdHRvbXxsZWZ0KSQvLAoJLy8gc3dhcHBhYmxlIGlmIGRpc3BsYXkgaXMgbm9uZSBvciBzdGFydHMgd2l0aCB0YWJsZSBleGNlcHQgInRhYmxlIiwgInRhYmxlLWNlbGwiLCBvciAidGFibGUtY2FwdGlvbiIKCS8vIHNlZSBoZXJlIGZvciBkaXNwbGF5IHZhbHVlczogaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9DU1MvZGlzcGxheQoJcmRpc3BsYXlzd2FwID0gL14obm9uZXx0YWJsZSg/IS1jW2VhXSkuKykvLAoJcm1hcmdpbiA9IC9ebWFyZ2luLywKCXJudW1zcGxpdCA9IG5ldyBSZWdFeHAoICJeKCIgKyBjb3JlX3BudW0gKyAiKSguKikkIiwgImkiICksCglybnVtbm9ucHggPSBuZXcgUmVnRXhwKCAiXigiICsgY29yZV9wbnVtICsgIikoPyFweClbYS16JV0rJCIsICJpIiApLAoJcnJlbE51bSA9IG5ldyBSZWdFeHAoICJeKFsrLV0pPSgiICsgY29yZV9wbnVtICsgIikiLCAiaSIgKSwKCWVsZW1kaXNwbGF5ID0geyBCT0RZOiAiYmxvY2siIH0sCgoJY3NzU2hvdyA9IHsgcG9zaXRpb246ICJhYnNvbHV0ZSIsIHZpc2liaWxpdHk6ICJoaWRkZW4iLCBkaXNwbGF5OiAiYmxvY2siIH0sCgljc3NOb3JtYWxUcmFuc2Zvcm0gPSB7CgkJbGV0dGVyU3BhY2luZzogMCwKCQlmb250V2VpZ2h0OiA0MDAKCX0sCgoJY3NzRXhwYW5kID0gWyAiVG9wIiwgIlJpZ2h0IiwgIkJvdHRvbSIsICJMZWZ0IiBdLAoJY3NzUHJlZml4ZXMgPSBbICJXZWJraXQiLCAiTyIsICJNb3oiLCAibXMiIF07CgovLyByZXR1cm4gYSBjc3MgcHJvcGVydHkgbWFwcGVkIHRvIGEgcG90ZW50aWFsbHkgdmVuZG9yIHByZWZpeGVkIHByb3BlcnR5CmZ1bmN0aW9uIHZlbmRvclByb3BOYW1lKCBzdHlsZSwgbmFtZSApIHsKCgkvLyBzaG9ydGN1dCBmb3IgbmFtZXMgdGhhdCBhcmUgbm90IHZlbmRvciBwcmVmaXhlZAoJaWYgKCBuYW1lIGluIHN0eWxlICkgewoJCXJldHVybiBuYW1lOwoJfQoKCS8vIGNoZWNrIGZvciB2ZW5kb3IgcHJlZml4ZWQgbmFtZXMKCXZhciBjYXBOYW1lID0gbmFtZS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIG5hbWUuc2xpY2UoMSksCgkJb3JpZ05hbWUgPSBuYW1lLAoJCWkgPSBjc3NQcmVmaXhlcy5sZW5ndGg7CgoJd2hpbGUgKCBpLS0gKSB7CgkJbmFtZSA9IGNzc1ByZWZpeGVzWyBpIF0gKyBjYXBOYW1lOwoJCWlmICggbmFtZSBpbiBzdHlsZSApIHsKCQkJcmV0dXJuIG5hbWU7CgkJfQoJfQoKCXJldHVybiBvcmlnTmFtZTsKfQoKZnVuY3Rpb24gaXNIaWRkZW4oIGVsZW0sIGVsICkgewoJLy8gaXNIaWRkZW4gbWlnaHQgYmUgY2FsbGVkIGZyb20galF1ZXJ5I2ZpbHRlciBmdW5jdGlvbjsKCS8vIGluIHRoYXQgY2FzZSwgZWxlbWVudCB3aWxsIGJlIHNlY29uZCBhcmd1bWVudAoJZWxlbSA9IGVsIHx8IGVsZW07CglyZXR1cm4galF1ZXJ5LmNzcyggZWxlbSwgImRpc3BsYXkiICkgPT09ICJub25lIiB8fCAhalF1ZXJ5LmNvbnRhaW5zKCBlbGVtLm93bmVyRG9jdW1lbnQsIGVsZW0gKTsKfQoKZnVuY3Rpb24gc2hvd0hpZGUoIGVsZW1lbnRzLCBzaG93ICkgewoJdmFyIGRpc3BsYXksIGVsZW0sIGhpZGRlbiwKCQl2YWx1ZXMgPSBbXSwKCQlpbmRleCA9IDAsCgkJbGVuZ3RoID0gZWxlbWVudHMubGVuZ3RoOwoKCWZvciAoIDsgaW5kZXggPCBsZW5ndGg7IGluZGV4KysgKSB7CgkJZWxlbSA9IGVsZW1lbnRzWyBpbmRleCBdOwoJCWlmICggIWVsZW0uc3R5bGUgKSB7CgkJCWNvbnRpbnVlOwoJCX0KCgkJdmFsdWVzWyBpbmRleCBdID0galF1ZXJ5Ll9kYXRhKCBlbGVtLCAib2xkZGlzcGxheSIgKTsKCQlkaXNwbGF5ID0gZWxlbS5zdHlsZS5kaXNwbGF5OwoJCWlmICggc2hvdyApIHsKCQkJLy8gUmVzZXQgdGhlIGlubGluZSBkaXNwbGF5IG9mIHRoaXMgZWxlbWVudCB0byBsZWFybiBpZiBpdCBpcwoJCQkvLyBiZWluZyBoaWRkZW4gYnkgY2FzY2FkZWQgcnVsZXMgb3Igbm90CgkJCWlmICggIXZhbHVlc1sgaW5kZXggXSAmJiBkaXNwbGF5ID09PSAibm9uZSIgKSB7CgkJCQllbGVtLnN0eWxlLmRpc3BsYXkgPSAiIjsKCQkJfQoKCQkJLy8gU2V0IGVsZW1lbnRzIHdoaWNoIGhhdmUgYmVlbiBvdmVycmlkZGVuIHdpdGggZGlzcGxheTogbm9uZQoJCQkvLyBpbiBhIHN0eWxlc2hlZXQgdG8gd2hhdGV2ZXIgdGhlIGRlZmF1bHQgYnJvd3NlciBzdHlsZSBpcwoJCQkvLyBmb3Igc3VjaCBhbiBlbGVtZW50CgkJCWlmICggZWxlbS5zdHlsZS5kaXNwbGF5ID09PSAiIiAmJiBpc0hpZGRlbiggZWxlbSApICkgewoJCQkJdmFsdWVzWyBpbmRleCBdID0galF1ZXJ5Ll9kYXRhKCBlbGVtLCAib2xkZGlzcGxheSIsIGNzc19kZWZhdWx0RGlzcGxheShlbGVtLm5vZGVOYW1lKSApOwoJCQl9CgkJfSBlbHNlIHsKCgkJCWlmICggIXZhbHVlc1sgaW5kZXggXSApIHsKCQkJCWhpZGRlbiA9IGlzSGlkZGVuKCBlbGVtICk7CgoJCQkJaWYgKCBkaXNwbGF5ICYmIGRpc3BsYXkgIT09ICJub25lIiB8fCAhaGlkZGVuICkgewoJCQkJCWpRdWVyeS5fZGF0YSggZWxlbSwgIm9sZGRpc3BsYXkiLCBoaWRkZW4gPyBkaXNwbGF5IDogalF1ZXJ5LmNzcyggZWxlbSwgImRpc3BsYXkiICkgKTsKCQkJCX0KCQkJfQoJCX0KCX0KCgkvLyBTZXQgdGhlIGRpc3BsYXkgb2YgbW9zdCBvZiB0aGUgZWxlbWVudHMgaW4gYSBzZWNvbmQgbG9vcAoJLy8gdG8gYXZvaWQgdGhlIGNvbnN0YW50IHJlZmxvdwoJZm9yICggaW5kZXggPSAwOyBpbmRleCA8IGxlbmd0aDsgaW5kZXgrKyApIHsKCQllbGVtID0gZWxlbWVudHNbIGluZGV4IF07CgkJaWYgKCAhZWxlbS5zdHlsZSApIHsKCQkJY29udGludWU7CgkJfQoJCWlmICggIXNob3cgfHwgZWxlbS5zdHlsZS5kaXNwbGF5ID09PSAibm9uZSIgfHwgZWxlbS5zdHlsZS5kaXNwbGF5ID09PSAiIiApIHsKCQkJZWxlbS5zdHlsZS5kaXNwbGF5ID0gc2hvdyA/IHZhbHVlc1sgaW5kZXggXSB8fCAiIiA6ICJub25lIjsKCQl9Cgl9CgoJcmV0dXJuIGVsZW1lbnRzOwp9CgpqUXVlcnkuZm4uZXh0ZW5kKHsKCWNzczogZnVuY3Rpb24oIG5hbWUsIHZhbHVlICkgewoJCXJldHVybiBqUXVlcnkuYWNjZXNzKCB0aGlzLCBmdW5jdGlvbiggZWxlbSwgbmFtZSwgdmFsdWUgKSB7CgkJCXZhciBsZW4sIHN0eWxlcywKCQkJCW1hcCA9IHt9LAoJCQkJaSA9IDA7CgoJCQlpZiAoIGpRdWVyeS5pc0FycmF5KCBuYW1lICkgKSB7CgkJCQlzdHlsZXMgPSBnZXRTdHlsZXMoIGVsZW0gKTsKCQkJCWxlbiA9IG5hbWUubGVuZ3RoOwoKCQkJCWZvciAoIDsgaSA8IGxlbjsgaSsrICkgewoJCQkJCW1hcFsgbmFtZVsgaSBdIF0gPSBqUXVlcnkuY3NzKCBlbGVtLCBuYW1lWyBpIF0sIGZhbHNlLCBzdHlsZXMgKTsKCQkJCX0KCgkJCQlyZXR1cm4gbWFwOwoJCQl9CgoJCQlyZXR1cm4gdmFsdWUgIT09IHVuZGVmaW5lZCA/CgkJCQlqUXVlcnkuc3R5bGUoIGVsZW0sIG5hbWUsIHZhbHVlICkgOgoJCQkJalF1ZXJ5LmNzcyggZWxlbSwgbmFtZSApOwoJCX0sIG5hbWUsIHZhbHVlLCBhcmd1bWVudHMubGVuZ3RoID4gMSApOwoJfSwKCXNob3c6IGZ1bmN0aW9uKCkgewoJCXJldHVybiBzaG93SGlkZSggdGhpcywgdHJ1ZSApOwoJfSwKCWhpZGU6IGZ1bmN0aW9uKCkgewoJCXJldHVybiBzaG93SGlkZSggdGhpcyApOwoJfSwKCXRvZ2dsZTogZnVuY3Rpb24oIHN0YXRlICkgewoJCXZhciBib29sID0gdHlwZW9mIHN0YXRlID09PSAiYm9vbGVhbiI7CgoJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CgkJCWlmICggYm9vbCA/IHN0YXRlIDogaXNIaWRkZW4oIHRoaXMgKSApIHsKCQkJCWpRdWVyeSggdGhpcyApLnNob3coKTsKCQkJfSBlbHNlIHsKCQkJCWpRdWVyeSggdGhpcyApLmhpZGUoKTsKCQkJfQoJCX0pOwoJfQp9KTsKCmpRdWVyeS5leHRlbmQoewoJLy8gQWRkIGluIHN0eWxlIHByb3BlcnR5IGhvb2tzIGZvciBvdmVycmlkaW5nIHRoZSBkZWZhdWx0CgkvLyBiZWhhdmlvciBvZiBnZXR0aW5nIGFuZCBzZXR0aW5nIGEgc3R5bGUgcHJvcGVydHkKCWNzc0hvb2tzOiB7CgkJb3BhY2l0eTogewoJCQlnZXQ6IGZ1bmN0aW9uKCBlbGVtLCBjb21wdXRlZCApIHsKCQkJCWlmICggY29tcHV0ZWQgKSB7CgkJCQkJLy8gV2Ugc2hvdWxkIGFsd2F5cyBnZXQgYSBudW1iZXIgYmFjayBmcm9tIG9wYWNpdHkKCQkJCQl2YXIgcmV0ID0gY3VyQ1NTKCBlbGVtLCAib3BhY2l0eSIgKTsKCQkJCQlyZXR1cm4gcmV0ID09PSAiIiA/ICIxIiA6IHJldDsKCQkJCX0KCQkJfQoJCX0KCX0sCgoJLy8gRXhjbHVkZSB0aGUgZm9sbG93aW5nIGNzcyBwcm9wZXJ0aWVzIHRvIGFkZCBweAoJY3NzTnVtYmVyOiB7CgkJImNvbHVtbkNvdW50IjogdHJ1ZSwKCQkiZmlsbE9wYWNpdHkiOiB0cnVlLAoJCSJmb250V2VpZ2h0IjogdHJ1ZSwKCQkibGluZUhlaWdodCI6IHRydWUsCgkJIm9wYWNpdHkiOiB0cnVlLAoJCSJvcnBoYW5zIjogdHJ1ZSwKCQkid2lkb3dzIjogdHJ1ZSwKCQkiekluZGV4IjogdHJ1ZSwKCQkiem9vbSI6IHRydWUKCX0sCgoJLy8gQWRkIGluIHByb3BlcnRpZXMgd2hvc2UgbmFtZXMgeW91IHdpc2ggdG8gZml4IGJlZm9yZQoJLy8gc2V0dGluZyBvciBnZXR0aW5nIHRoZSB2YWx1ZQoJY3NzUHJvcHM6IHsKCQkvLyBub3JtYWxpemUgZmxvYXQgY3NzIHByb3BlcnR5CgkJImZsb2F0IjogalF1ZXJ5LnN1cHBvcnQuY3NzRmxvYXQgPyAiY3NzRmxvYXQiIDogInN0eWxlRmxvYXQiCgl9LAoKCS8vIEdldCBhbmQgc2V0IHRoZSBzdHlsZSBwcm9wZXJ0eSBvbiBhIERPTSBOb2RlCglzdHlsZTogZnVuY3Rpb24oIGVsZW0sIG5hbWUsIHZhbHVlLCBleHRyYSApIHsKCQkvLyBEb24ndCBzZXQgc3R5bGVzIG9uIHRleHQgYW5kIGNvbW1lbnQgbm9kZXMKCQlpZiAoICFlbGVtIHx8IGVsZW0ubm9kZVR5cGUgPT09IDMgfHwgZWxlbS5ub2RlVHlwZSA9PT0gOCB8fCAhZWxlbS5zdHlsZSApIHsKCQkJcmV0dXJuOwoJCX0KCgkJLy8gTWFrZSBzdXJlIHRoYXQgd2UncmUgd29ya2luZyB3aXRoIHRoZSByaWdodCBuYW1lCgkJdmFyIHJldCwgdHlwZSwgaG9va3MsCgkJCW9yaWdOYW1lID0galF1ZXJ5LmNhbWVsQ2FzZSggbmFtZSApLAoJCQlzdHlsZSA9IGVsZW0uc3R5bGU7CgoJCW5hbWUgPSBqUXVlcnkuY3NzUHJvcHNbIG9yaWdOYW1lIF0gfHwgKCBqUXVlcnkuY3NzUHJvcHNbIG9yaWdOYW1lIF0gPSB2ZW5kb3JQcm9wTmFtZSggc3R5bGUsIG9yaWdOYW1lICkgKTsKCgkJLy8gZ2V0cyBob29rIGZvciB0aGUgcHJlZml4ZWQgdmVyc2lvbgoJCS8vIGZvbGxvd2VkIGJ5IHRoZSB1bnByZWZpeGVkIHZlcnNpb24KCQlob29rcyA9IGpRdWVyeS5jc3NIb29rc1sgbmFtZSBdIHx8IGpRdWVyeS5jc3NIb29rc1sgb3JpZ05hbWUgXTsKCgkJLy8gQ2hlY2sgaWYgd2UncmUgc2V0dGluZyBhIHZhbHVlCgkJaWYgKCB2YWx1ZSAhPT0gdW5kZWZpbmVkICkgewoJCQl0eXBlID0gdHlwZW9mIHZhbHVlOwoKCQkJLy8gY29udmVydCByZWxhdGl2ZSBudW1iZXIgc3RyaW5ncyAoKz0gb3IgLT0pIHRvIHJlbGF0aXZlIG51bWJlcnMuICM3MzQ1CgkJCWlmICggdHlwZSA9PT0gInN0cmluZyIgJiYgKHJldCA9IHJyZWxOdW0uZXhlYyggdmFsdWUgKSkgKSB7CgkJCQl2YWx1ZSA9ICggcmV0WzFdICsgMSApICogcmV0WzJdICsgcGFyc2VGbG9hdCggalF1ZXJ5LmNzcyggZWxlbSwgbmFtZSApICk7CgkJCQkvLyBGaXhlcyBidWcgIzkyMzcKCQkJCXR5cGUgPSAibnVtYmVyIjsKCQkJfQoKCQkJLy8gTWFrZSBzdXJlIHRoYXQgTmFOIGFuZCBudWxsIHZhbHVlcyBhcmVuJ3Qgc2V0LiBTZWU6ICM3MTE2CgkJCWlmICggdmFsdWUgPT0gbnVsbCB8fCB0eXBlID09PSAibnVtYmVyIiAmJiBpc05hTiggdmFsdWUgKSApIHsKCQkJCXJldHVybjsKCQkJfQoKCQkJLy8gSWYgYSBudW1iZXIgd2FzIHBhc3NlZCBpbiwgYWRkICdweCcgdG8gdGhlIChleGNlcHQgZm9yIGNlcnRhaW4gQ1NTIHByb3BlcnRpZXMpCgkJCWlmICggdHlwZSA9PT0gIm51bWJlciIgJiYgIWpRdWVyeS5jc3NOdW1iZXJbIG9yaWdOYW1lIF0gKSB7CgkJCQl2YWx1ZSArPSAicHgiOwoJCQl9CgoJCQkvLyBGaXhlcyAjODkwOCwgaXQgY2FuIGJlIGRvbmUgbW9yZSBjb3JyZWN0bHkgYnkgc3BlY2lmaW5nIHNldHRlcnMgaW4gY3NzSG9va3MsCgkJCS8vIGJ1dCBpdCB3b3VsZCBtZWFuIHRvIGRlZmluZSBlaWdodCAoZm9yIGV2ZXJ5IHByb2JsZW1hdGljIHByb3BlcnR5KSBpZGVudGljYWwgZnVuY3Rpb25zCgkJCWlmICggIWpRdWVyeS5zdXBwb3J0LmNsZWFyQ2xvbmVTdHlsZSAmJiB2YWx1ZSA9PT0gIiIgJiYgbmFtZS5pbmRleE9mKCJiYWNrZ3JvdW5kIikgPT09IDAgKSB7CgkJCQlzdHlsZVsgbmFtZSBdID0gImluaGVyaXQiOwoJCQl9CgoJCQkvLyBJZiBhIGhvb2sgd2FzIHByb3ZpZGVkLCB1c2UgdGhhdCB2YWx1ZSwgb3RoZXJ3aXNlIGp1c3Qgc2V0IHRoZSBzcGVjaWZpZWQgdmFsdWUKCQkJaWYgKCAhaG9va3MgfHwgISgic2V0IiBpbiBob29rcykgfHwgKHZhbHVlID0gaG9va3Muc2V0KCBlbGVtLCB2YWx1ZSwgZXh0cmEgKSkgIT09IHVuZGVmaW5lZCApIHsKCgkJCQkvLyBXcmFwcGVkIHRvIHByZXZlbnQgSUUgZnJvbSB0aHJvd2luZyBlcnJvcnMgd2hlbiAnaW52YWxpZCcgdmFsdWVzIGFyZSBwcm92aWRlZAoJCQkJLy8gRml4ZXMgYnVnICM1NTA5CgkJCQl0cnkgewoJCQkJCXN0eWxlWyBuYW1lIF0gPSB2YWx1ZTsKCQkJCX0gY2F0Y2goZSkge30KCQkJfQoKCQl9IGVsc2UgewoJCQkvLyBJZiBhIGhvb2sgd2FzIHByb3ZpZGVkIGdldCB0aGUgbm9uLWNvbXB1dGVkIHZhbHVlIGZyb20gdGhlcmUKCQkJaWYgKCBob29rcyAmJiAiZ2V0IiBpbiBob29rcyAmJiAocmV0ID0gaG9va3MuZ2V0KCBlbGVtLCBmYWxzZSwgZXh0cmEgKSkgIT09IHVuZGVmaW5lZCApIHsKCQkJCXJldHVybiByZXQ7CgkJCX0KCgkJCS8vIE90aGVyd2lzZSBqdXN0IGdldCB0aGUgdmFsdWUgZnJvbSB0aGUgc3R5bGUgb2JqZWN0CgkJCXJldHVybiBzdHlsZVsgbmFtZSBdOwoJCX0KCX0sCgoJY3NzOiBmdW5jdGlvbiggZWxlbSwgbmFtZSwgZXh0cmEsIHN0eWxlcyApIHsKCQl2YXIgbnVtLCB2YWwsIGhvb2tzLAoJCQlvcmlnTmFtZSA9IGpRdWVyeS5jYW1lbENhc2UoIG5hbWUgKTsKCgkJLy8gTWFrZSBzdXJlIHRoYXQgd2UncmUgd29ya2luZyB3aXRoIHRoZSByaWdodCBuYW1lCgkJbmFtZSA9IGpRdWVyeS5jc3NQcm9wc1sgb3JpZ05hbWUgXSB8fCAoIGpRdWVyeS5jc3NQcm9wc1sgb3JpZ05hbWUgXSA9IHZlbmRvclByb3BOYW1lKCBlbGVtLnN0eWxlLCBvcmlnTmFtZSApICk7CgoJCS8vIGdldHMgaG9vayBmb3IgdGhlIHByZWZpeGVkIHZlcnNpb24KCQkvLyBmb2xsb3dlZCBieSB0aGUgdW5wcmVmaXhlZCB2ZXJzaW9uCgkJaG9va3MgPSBqUXVlcnkuY3NzSG9va3NbIG5hbWUgXSB8fCBqUXVlcnkuY3NzSG9va3NbIG9yaWdOYW1lIF07CgoJCS8vIElmIGEgaG9vayB3YXMgcHJvdmlkZWQgZ2V0IHRoZSBjb21wdXRlZCB2YWx1ZSBmcm9tIHRoZXJlCgkJaWYgKCBob29rcyAmJiAiZ2V0IiBpbiBob29rcyApIHsKCQkJdmFsID0gaG9va3MuZ2V0KCBlbGVtLCB0cnVlLCBleHRyYSApOwoJCX0KCgkJLy8gT3RoZXJ3aXNlLCBpZiBhIHdheSB0byBnZXQgdGhlIGNvbXB1dGVkIHZhbHVlIGV4aXN0cywgdXNlIHRoYXQKCQlpZiAoIHZhbCA9PT0gdW5kZWZpbmVkICkgewoJCQl2YWwgPSBjdXJDU1MoIGVsZW0sIG5hbWUsIHN0eWxlcyApOwoJCX0KCgkJLy9jb252ZXJ0ICJub3JtYWwiIHRvIGNvbXB1dGVkIHZhbHVlCgkJaWYgKCB2YWwgPT09ICJub3JtYWwiICYmIG5hbWUgaW4gY3NzTm9ybWFsVHJhbnNmb3JtICkgewoJCQl2YWwgPSBjc3NOb3JtYWxUcmFuc2Zvcm1bIG5hbWUgXTsKCQl9CgoJCS8vIFJldHVybiwgY29udmVydGluZyB0byBudW1iZXIgaWYgZm9yY2VkIG9yIGEgcXVhbGlmaWVyIHdhcyBwcm92aWRlZCBhbmQgdmFsIGxvb2tzIG51bWVyaWMKCQlpZiAoIGV4dHJhID09PSAiIiB8fCBleHRyYSApIHsKCQkJbnVtID0gcGFyc2VGbG9hdCggdmFsICk7CgkJCXJldHVybiBleHRyYSA9PT0gdHJ1ZSB8fCBqUXVlcnkuaXNOdW1lcmljKCBudW0gKSA/IG51bSB8fCAwIDogdmFsOwoJCX0KCQlyZXR1cm4gdmFsOwoJfSwKCgkvLyBBIG1ldGhvZCBmb3IgcXVpY2tseSBzd2FwcGluZyBpbi9vdXQgQ1NTIHByb3BlcnRpZXMgdG8gZ2V0IGNvcnJlY3QgY2FsY3VsYXRpb25zCglzd2FwOiBmdW5jdGlvbiggZWxlbSwgb3B0aW9ucywgY2FsbGJhY2ssIGFyZ3MgKSB7CgkJdmFyIHJldCwgbmFtZSwKCQkJb2xkID0ge307CgoJCS8vIFJlbWVtYmVyIHRoZSBvbGQgdmFsdWVzLCBhbmQgaW5zZXJ0IHRoZSBuZXcgb25lcwoJCWZvciAoIG5hbWUgaW4gb3B0aW9ucyApIHsKCQkJb2xkWyBuYW1lIF0gPSBlbGVtLnN0eWxlWyBuYW1lIF07CgkJCWVsZW0uc3R5bGVbIG5hbWUgXSA9IG9wdGlvbnNbIG5hbWUgXTsKCQl9CgoJCXJldCA9IGNhbGxiYWNrLmFwcGx5KCBlbGVtLCBhcmdzIHx8IFtdICk7CgoJCS8vIFJldmVydCB0aGUgb2xkIHZhbHVlcwoJCWZvciAoIG5hbWUgaW4gb3B0aW9ucyApIHsKCQkJZWxlbS5zdHlsZVsgbmFtZSBdID0gb2xkWyBuYW1lIF07CgkJfQoKCQlyZXR1cm4gcmV0OwoJfQp9KTsKCi8vIE5PVEU6IHdlJ3ZlIGluY2x1ZGVkIHRoZSAid2luZG93IiBpbiB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZQovLyBiZWNhdXNlIGpzZG9tIG9uIG5vZGUuanMgd2lsbCBicmVhayB3aXRob3V0IGl0LgppZiAoIHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlICkgewoJZ2V0U3R5bGVzID0gZnVuY3Rpb24oIGVsZW0gKSB7CgkJcmV0dXJuIHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKCBlbGVtLCBudWxsICk7Cgl9OwoKCWN1ckNTUyA9IGZ1bmN0aW9uKCBlbGVtLCBuYW1lLCBfY29tcHV0ZWQgKSB7CgkJdmFyIHdpZHRoLCBtaW5XaWR0aCwgbWF4V2lkdGgsCgkJCWNvbXB1dGVkID0gX2NvbXB1dGVkIHx8IGdldFN0eWxlcyggZWxlbSApLAoKCQkJLy8gZ2V0UHJvcGVydHlWYWx1ZSBpcyBvbmx5IG5lZWRlZCBmb3IgLmNzcygnZmlsdGVyJykgaW4gSUU5LCBzZWUgIzEyNTM3CgkJCXJldCA9IGNvbXB1dGVkID8gY29tcHV0ZWQuZ2V0UHJvcGVydHlWYWx1ZSggbmFtZSApIHx8IGNvbXB1dGVkWyBuYW1lIF0gOiB1bmRlZmluZWQsCgkJCXN0eWxlID0gZWxlbS5zdHlsZTsKCgkJaWYgKCBjb21wdXRlZCApIHsKCgkJCWlmICggcmV0ID09PSAiIiAmJiAhalF1ZXJ5LmNvbnRhaW5zKCBlbGVtLm93bmVyRG9jdW1lbnQsIGVsZW0gKSApIHsKCQkJCXJldCA9IGpRdWVyeS5zdHlsZSggZWxlbSwgbmFtZSApOwoJCQl9CgoJCQkvLyBBIHRyaWJ1dGUgdG8gdGhlICJhd2Vzb21lIGhhY2sgYnkgRGVhbiBFZHdhcmRzIgoJCQkvLyBDaHJvbWUgPCAxNyBhbmQgU2FmYXJpIDUuMCB1c2VzICJjb21wdXRlZCB2YWx1ZSIgaW5zdGVhZCBvZiAidXNlZCB2YWx1ZSIgZm9yIG1hcmdpbi1yaWdodAoJCQkvLyBTYWZhcmkgNS4xLjcgKGF0IGxlYXN0KSByZXR1cm5zIHBlcmNlbnRhZ2UgZm9yIGEgbGFyZ2VyIHNldCBvZiB2YWx1ZXMsIGJ1dCB3aWR0aCBzZWVtcyB0byBiZSByZWxpYWJseSBwaXhlbHMKCQkJLy8gdGhpcyBpcyBhZ2FpbnN0IHRoZSBDU1NPTSBkcmFmdCBzcGVjOiBodHRwOi8vZGV2LnczLm9yZy9jc3N3Zy9jc3NvbS8jcmVzb2x2ZWQtdmFsdWVzCgkJCWlmICggcm51bW5vbnB4LnRlc3QoIHJldCApICYmIHJtYXJnaW4udGVzdCggbmFtZSApICkgewoKCQkJCS8vIFJlbWVtYmVyIHRoZSBvcmlnaW5hbCB2YWx1ZXMKCQkJCXdpZHRoID0gc3R5bGUud2lkdGg7CgkJCQltaW5XaWR0aCA9IHN0eWxlLm1pbldpZHRoOwoJCQkJbWF4V2lkdGggPSBzdHlsZS5tYXhXaWR0aDsKCgkJCQkvLyBQdXQgaW4gdGhlIG5ldyB2YWx1ZXMgdG8gZ2V0IGEgY29tcHV0ZWQgdmFsdWUgb3V0CgkJCQlzdHlsZS5taW5XaWR0aCA9IHN0eWxlLm1heFdpZHRoID0gc3R5bGUud2lkdGggPSByZXQ7CgkJCQlyZXQgPSBjb21wdXRlZC53aWR0aDsKCgkJCQkvLyBSZXZlcnQgdGhlIGNoYW5nZWQgdmFsdWVzCgkJCQlzdHlsZS53aWR0aCA9IHdpZHRoOwoJCQkJc3R5bGUubWluV2lkdGggPSBtaW5XaWR0aDsKCQkJCXN0eWxlLm1heFdpZHRoID0gbWF4V2lkdGg7CgkJCX0KCQl9CgoJCXJldHVybiByZXQ7Cgl9Owp9IGVsc2UgaWYgKCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY3VycmVudFN0eWxlICkgewoJZ2V0U3R5bGVzID0gZnVuY3Rpb24oIGVsZW0gKSB7CgkJcmV0dXJuIGVsZW0uY3VycmVudFN0eWxlOwoJfTsKCgljdXJDU1MgPSBmdW5jdGlvbiggZWxlbSwgbmFtZSwgX2NvbXB1dGVkICkgewoJCXZhciBsZWZ0LCBycywgcnNMZWZ0LAoJCQljb21wdXRlZCA9IF9jb21wdXRlZCB8fCBnZXRTdHlsZXMoIGVsZW0gKSwKCQkJcmV0ID0gY29tcHV0ZWQgPyBjb21wdXRlZFsgbmFtZSBdIDogdW5kZWZpbmVkLAoJCQlzdHlsZSA9IGVsZW0uc3R5bGU7CgoJCS8vIEF2b2lkIHNldHRpbmcgcmV0IHRvIGVtcHR5IHN0cmluZyBoZXJlCgkJLy8gc28gd2UgZG9uJ3QgZGVmYXVsdCB0byBhdXRvCgkJaWYgKCByZXQgPT0gbnVsbCAmJiBzdHlsZSAmJiBzdHlsZVsgbmFtZSBdICkgewoJCQlyZXQgPSBzdHlsZVsgbmFtZSBdOwoJCX0KCgkJLy8gRnJvbSB0aGUgYXdlc29tZSBoYWNrIGJ5IERlYW4gRWR3YXJkcwoJCS8vIGh0dHA6Ly9lcmlrLmVhZS5uZXQvYXJjaGl2ZXMvMjAwNy8wNy8yNy8xOC41NC4xNS8jY29tbWVudC0xMDIyOTEKCgkJLy8gSWYgd2UncmUgbm90IGRlYWxpbmcgd2l0aCBhIHJlZ3VsYXIgcGl4ZWwgbnVtYmVyCgkJLy8gYnV0IGEgbnVtYmVyIHRoYXQgaGFzIGEgd2VpcmQgZW5kaW5nLCB3ZSBuZWVkIHRvIGNvbnZlcnQgaXQgdG8gcGl4ZWxzCgkJLy8gYnV0IG5vdCBwb3NpdGlvbiBjc3MgYXR0cmlidXRlcywgYXMgdGhvc2UgYXJlIHByb3BvcnRpb25hbCB0byB0aGUgcGFyZW50IGVsZW1lbnQgaW5zdGVhZAoJCS8vIGFuZCB3ZSBjYW4ndCBtZWFzdXJlIHRoZSBwYXJlbnQgaW5zdGVhZCBiZWNhdXNlIGl0IG1pZ2h0IHRyaWdnZXIgYSAic3RhY2tpbmcgZG9sbHMiIHByb2JsZW0KCQlpZiAoIHJudW1ub25weC50ZXN0KCByZXQgKSAmJiAhcnBvc2l0aW9uLnRlc3QoIG5hbWUgKSApIHsKCgkJCS8vIFJlbWVtYmVyIHRoZSBvcmlnaW5hbCB2YWx1ZXMKCQkJbGVmdCA9IHN0eWxlLmxlZnQ7CgkJCXJzID0gZWxlbS5ydW50aW1lU3R5bGU7CgkJCXJzTGVmdCA9IHJzICYmIHJzLmxlZnQ7CgoJCQkvLyBQdXQgaW4gdGhlIG5ldyB2YWx1ZXMgdG8gZ2V0IGEgY29tcHV0ZWQgdmFsdWUgb3V0CgkJCWlmICggcnNMZWZ0ICkgewoJCQkJcnMubGVmdCA9IGVsZW0uY3VycmVudFN0eWxlLmxlZnQ7CgkJCX0KCQkJc3R5bGUubGVmdCA9IG5hbWUgPT09ICJmb250U2l6ZSIgPyAiMWVtIiA6IHJldDsKCQkJcmV0ID0gc3R5bGUucGl4ZWxMZWZ0ICsgInB4IjsKCgkJCS8vIFJldmVydCB0aGUgY2hhbmdlZCB2YWx1ZXMKCQkJc3R5bGUubGVmdCA9IGxlZnQ7CgkJCWlmICggcnNMZWZ0ICkgewoJCQkJcnMubGVmdCA9IHJzTGVmdDsKCQkJfQoJCX0KCgkJcmV0dXJuIHJldCA9PT0gIiIgPyAiYXV0byIgOiByZXQ7Cgl9Owp9CgpmdW5jdGlvbiBzZXRQb3NpdGl2ZU51bWJlciggZWxlbSwgdmFsdWUsIHN1YnRyYWN0ICkgewoJdmFyIG1hdGNoZXMgPSBybnVtc3BsaXQuZXhlYyggdmFsdWUgKTsKCXJldHVybiBtYXRjaGVzID8KCQkvLyBHdWFyZCBhZ2FpbnN0IHVuZGVmaW5lZCAic3VidHJhY3QiLCBlLmcuLCB3aGVuIHVzZWQgYXMgaW4gY3NzSG9va3MKCQlNYXRoLm1heCggMCwgbWF0Y2hlc1sgMSBdIC0gKCBzdWJ0cmFjdCB8fCAwICkgKSArICggbWF0Y2hlc1sgMiBdIHx8ICJweCIgKSA6CgkJdmFsdWU7Cn0KCmZ1bmN0aW9uIGF1Z21lbnRXaWR0aE9ySGVpZ2h0KCBlbGVtLCBuYW1lLCBleHRyYSwgaXNCb3JkZXJCb3gsIHN0eWxlcyApIHsKCXZhciBpID0gZXh0cmEgPT09ICggaXNCb3JkZXJCb3ggPyAiYm9yZGVyIiA6ICJjb250ZW50IiApID8KCQkvLyBJZiB3ZSBhbHJlYWR5IGhhdmUgdGhlIHJpZ2h0IG1lYXN1cmVtZW50LCBhdm9pZCBhdWdtZW50YXRpb24KCQk0IDoKCQkvLyBPdGhlcndpc2UgaW5pdGlhbGl6ZSBmb3IgaG9yaXpvbnRhbCBvciB2ZXJ0aWNhbCBwcm9wZXJ0aWVzCgkJbmFtZSA9PT0gIndpZHRoIiA/IDEgOiAwLAoKCQl2YWwgPSAwOwoKCWZvciAoIDsgaSA8IDQ7IGkgKz0gMiApIHsKCQkvLyBib3RoIGJveCBtb2RlbHMgZXhjbHVkZSBtYXJnaW4sIHNvIGFkZCBpdCBpZiB3ZSB3YW50IGl0CgkJaWYgKCBleHRyYSA9PT0gIm1hcmdpbiIgKSB7CgkJCXZhbCArPSBqUXVlcnkuY3NzKCBlbGVtLCBleHRyYSArIGNzc0V4cGFuZFsgaSBdLCB0cnVlLCBzdHlsZXMgKTsKCQl9CgoJCWlmICggaXNCb3JkZXJCb3ggKSB7CgkJCS8vIGJvcmRlci1ib3ggaW5jbHVkZXMgcGFkZGluZywgc28gcmVtb3ZlIGl0IGlmIHdlIHdhbnQgY29udGVudAoJCQlpZiAoIGV4dHJhID09PSAiY29udGVudCIgKSB7CgkJCQl2YWwgLT0galF1ZXJ5LmNzcyggZWxlbSwgInBhZGRpbmciICsgY3NzRXhwYW5kWyBpIF0sIHRydWUsIHN0eWxlcyApOwoJCQl9CgoJCQkvLyBhdCB0aGlzIHBvaW50LCBleHRyYSBpc24ndCBib3JkZXIgbm9yIG1hcmdpbiwgc28gcmVtb3ZlIGJvcmRlcgoJCQlpZiAoIGV4dHJhICE9PSAibWFyZ2luIiApIHsKCQkJCXZhbCAtPSBqUXVlcnkuY3NzKCBlbGVtLCAiYm9yZGVyIiArIGNzc0V4cGFuZFsgaSBdICsgIldpZHRoIiwgdHJ1ZSwgc3R5bGVzICk7CgkJCX0KCQl9IGVsc2UgewoJCQkvLyBhdCB0aGlzIHBvaW50LCBleHRyYSBpc24ndCBjb250ZW50LCBzbyBhZGQgcGFkZGluZwoJCQl2YWwgKz0galF1ZXJ5LmNzcyggZWxlbSwgInBhZGRpbmciICsgY3NzRXhwYW5kWyBpIF0sIHRydWUsIHN0eWxlcyApOwoKCQkJLy8gYXQgdGhpcyBwb2ludCwgZXh0cmEgaXNuJ3QgY29udGVudCBub3IgcGFkZGluZywgc28gYWRkIGJvcmRlcgoJCQlpZiAoIGV4dHJhICE9PSAicGFkZGluZyIgKSB7CgkJCQl2YWwgKz0galF1ZXJ5LmNzcyggZWxlbSwgImJvcmRlciIgKyBjc3NFeHBhbmRbIGkgXSArICJXaWR0aCIsIHRydWUsIHN0eWxlcyApOwoJCQl9CgkJfQoJfQoKCXJldHVybiB2YWw7Cn0KCmZ1bmN0aW9uIGdldFdpZHRoT3JIZWlnaHQoIGVsZW0sIG5hbWUsIGV4dHJhICkgewoKCS8vIFN0YXJ0IHdpdGggb2Zmc2V0IHByb3BlcnR5LCB3aGljaCBpcyBlcXVpdmFsZW50IHRvIHRoZSBib3JkZXItYm94IHZhbHVlCgl2YXIgdmFsdWVJc0JvcmRlckJveCA9IHRydWUsCgkJdmFsID0gbmFtZSA9PT0gIndpZHRoIiA/IGVsZW0ub2Zmc2V0V2lkdGggOiBlbGVtLm9mZnNldEhlaWdodCwKCQlzdHlsZXMgPSBnZXRTdHlsZXMoIGVsZW0gKSwKCQlpc0JvcmRlckJveCA9IGpRdWVyeS5zdXBwb3J0LmJveFNpemluZyAmJiBqUXVlcnkuY3NzKCBlbGVtLCAiYm94U2l6aW5nIiwgZmFsc2UsIHN0eWxlcyApID09PSAiYm9yZGVyLWJveCI7CgoJLy8gc29tZSBub24taHRtbCBlbGVtZW50cyByZXR1cm4gdW5kZWZpbmVkIGZvciBvZmZzZXRXaWR0aCwgc28gY2hlY2sgZm9yIG51bGwvdW5kZWZpbmVkCgkvLyBzdmcgLSBodHRwczovL2J1Z3ppbGxhLm1vemlsbGEub3JnL3Nob3dfYnVnLmNnaT9pZD02NDkyODUKCS8vIE1hdGhNTCAtIGh0dHBzOi8vYnVnemlsbGEubW96aWxsYS5vcmcvc2hvd19idWcuY2dpP2lkPTQ5MTY2OAoJaWYgKCB2YWwgPD0gMCB8fCB2YWwgPT0gbnVsbCApIHsKCQkvLyBGYWxsIGJhY2sgdG8gY29tcHV0ZWQgdGhlbiB1bmNvbXB1dGVkIGNzcyBpZiBuZWNlc3NhcnkKCQl2YWwgPSBjdXJDU1MoIGVsZW0sIG5hbWUsIHN0eWxlcyApOwoJCWlmICggdmFsIDwgMCB8fCB2YWwgPT0gbnVsbCApIHsKCQkJdmFsID0gZWxlbS5zdHlsZVsgbmFtZSBdOwoJCX0KCgkJLy8gQ29tcHV0ZWQgdW5pdCBpcyBub3QgcGl4ZWxzLiBTdG9wIGhlcmUgYW5kIHJldHVybi4KCQlpZiAoIHJudW1ub25weC50ZXN0KHZhbCkgKSB7CgkJCXJldHVybiB2YWw7CgkJfQoKCQkvLyB3ZSBuZWVkIHRoZSBjaGVjayBmb3Igc3R5bGUgaW4gY2FzZSBhIGJyb3dzZXIgd2hpY2ggcmV0dXJucyB1bnJlbGlhYmxlIHZhbHVlcwoJCS8vIGZvciBnZXRDb21wdXRlZFN0eWxlIHNpbGVudGx5IGZhbGxzIGJhY2sgdG8gdGhlIHJlbGlhYmxlIGVsZW0uc3R5bGUKCQl2YWx1ZUlzQm9yZGVyQm94ID0gaXNCb3JkZXJCb3ggJiYgKCBqUXVlcnkuc3VwcG9ydC5ib3hTaXppbmdSZWxpYWJsZSB8fCB2YWwgPT09IGVsZW0uc3R5bGVbIG5hbWUgXSApOwoKCQkvLyBOb3JtYWxpemUgIiIsIGF1dG8sIGFuZCBwcmVwYXJlIGZvciBleHRyYQoJCXZhbCA9IHBhcnNlRmxvYXQoIHZhbCApIHx8IDA7Cgl9CgoJLy8gdXNlIHRoZSBhY3RpdmUgYm94LXNpemluZyBtb2RlbCB0byBhZGQvc3VidHJhY3QgaXJyZWxldmFudCBzdHlsZXMKCXJldHVybiAoIHZhbCArCgkJYXVnbWVudFdpZHRoT3JIZWlnaHQoCgkJCWVsZW0sCgkJCW5hbWUsCgkJCWV4dHJhIHx8ICggaXNCb3JkZXJCb3ggPyAiYm9yZGVyIiA6ICJjb250ZW50IiApLAoJCQl2YWx1ZUlzQm9yZGVyQm94LAoJCQlzdHlsZXMKCQkpCgkpICsgInB4IjsKfQoKLy8gVHJ5IHRvIGRldGVybWluZSB0aGUgZGVmYXVsdCBkaXNwbGF5IHZhbHVlIG9mIGFuIGVsZW1lbnQKZnVuY3Rpb24gY3NzX2RlZmF1bHREaXNwbGF5KCBub2RlTmFtZSApIHsKCXZhciBkb2MgPSBkb2N1bWVudCwKCQlkaXNwbGF5ID0gZWxlbWRpc3BsYXlbIG5vZGVOYW1lIF07CgoJaWYgKCAhZGlzcGxheSApIHsKCQlkaXNwbGF5ID0gYWN0dWFsRGlzcGxheSggbm9kZU5hbWUsIGRvYyApOwoKCQkvLyBJZiB0aGUgc2ltcGxlIHdheSBmYWlscywgcmVhZCBmcm9tIGluc2lkZSBhbiBpZnJhbWUKCQlpZiAoIGRpc3BsYXkgPT09ICJub25lIiB8fCAhZGlzcGxheSApIHsKCQkJLy8gVXNlIHRoZSBhbHJlYWR5LWNyZWF0ZWQgaWZyYW1lIGlmIHBvc3NpYmxlCgkJCWlmcmFtZSA9ICggaWZyYW1lIHx8CgkJCQlqUXVlcnkoIjxpZnJhbWUgZnJhbWVib3JkZXI9JzAnIHdpZHRoPScwJyBoZWlnaHQ9JzAnLz4iKQoJCQkJLmNzcyggImNzc1RleHQiLCAiZGlzcGxheTpibG9jayAhaW1wb3J0YW50IiApCgkJCSkuYXBwZW5kVG8oIGRvYy5kb2N1bWVudEVsZW1lbnQgKTsKCgkJCS8vIEFsd2F5cyB3cml0ZSBhIG5ldyBIVE1MIHNrZWxldG9uIHNvIFdlYmtpdCBhbmQgRmlyZWZveCBkb24ndCBjaG9rZSBvbiByZXVzZQoJCQlkb2MgPSAoIGlmcmFtZVswXS5jb250ZW50V2luZG93IHx8IGlmcmFtZVswXS5jb250ZW50RG9jdW1lbnQgKS5kb2N1bWVudDsKCQkJZG9jLndyaXRlKCI8IWRvY3R5cGUgaHRtbD48aHRtbD48Ym9keT4iKTsKCQkJZG9jLmNsb3NlKCk7CgoJCQlkaXNwbGF5ID0gYWN0dWFsRGlzcGxheSggbm9kZU5hbWUsIGRvYyApOwoJCQlpZnJhbWUuZGV0YWNoKCk7CgkJfQoKCQkvLyBTdG9yZSB0aGUgY29ycmVjdCBkZWZhdWx0IGRpc3BsYXkKCQllbGVtZGlzcGxheVsgbm9kZU5hbWUgXSA9IGRpc3BsYXk7Cgl9CgoJcmV0dXJuIGRpc3BsYXk7Cn0KCi8vIENhbGxlZCBPTkxZIGZyb20gd2l0aGluIGNzc19kZWZhdWx0RGlzcGxheQpmdW5jdGlvbiBhY3R1YWxEaXNwbGF5KCBuYW1lLCBkb2MgKSB7Cgl2YXIgZWxlbSA9IGpRdWVyeSggZG9jLmNyZWF0ZUVsZW1lbnQoIG5hbWUgKSApLmFwcGVuZFRvKCBkb2MuYm9keSApLAoJCWRpc3BsYXkgPSBqUXVlcnkuY3NzKCBlbGVtWzBdLCAiZGlzcGxheSIgKTsKCWVsZW0ucmVtb3ZlKCk7CglyZXR1cm4gZGlzcGxheTsKfQoKalF1ZXJ5LmVhY2goWyAiaGVpZ2h0IiwgIndpZHRoIiBdLCBmdW5jdGlvbiggaSwgbmFtZSApIHsKCWpRdWVyeS5jc3NIb29rc1sgbmFtZSBdID0gewoJCWdldDogZnVuY3Rpb24oIGVsZW0sIGNvbXB1dGVkLCBleHRyYSApIHsKCQkJaWYgKCBjb21wdXRlZCApIHsKCQkJCS8vIGNlcnRhaW4gZWxlbWVudHMgY2FuIGhhdmUgZGltZW5zaW9uIGluZm8gaWYgd2UgaW52aXNpYmx5IHNob3cgdGhlbQoJCQkJLy8gaG93ZXZlciwgaXQgbXVzdCBoYXZlIGEgY3VycmVudCBkaXNwbGF5IHN0eWxlIHRoYXQgd291bGQgYmVuZWZpdCBmcm9tIHRoaXMKCQkJCXJldHVybiBlbGVtLm9mZnNldFdpZHRoID09PSAwICYmIHJkaXNwbGF5c3dhcC50ZXN0KCBqUXVlcnkuY3NzKCBlbGVtLCAiZGlzcGxheSIgKSApID8KCQkJCQlqUXVlcnkuc3dhcCggZWxlbSwgY3NzU2hvdywgZnVuY3Rpb24oKSB7CgkJCQkJCXJldHVybiBnZXRXaWR0aE9ySGVpZ2h0KCBlbGVtLCBuYW1lLCBleHRyYSApOwoJCQkJCX0pIDoKCQkJCQlnZXRXaWR0aE9ySGVpZ2h0KCBlbGVtLCBuYW1lLCBleHRyYSApOwoJCQl9CgkJfSwKCgkJc2V0OiBmdW5jdGlvbiggZWxlbSwgdmFsdWUsIGV4dHJhICkgewoJCQl2YXIgc3R5bGVzID0gZXh0cmEgJiYgZ2V0U3R5bGVzKCBlbGVtICk7CgkJCXJldHVybiBzZXRQb3NpdGl2ZU51bWJlciggZWxlbSwgdmFsdWUsIGV4dHJhID8KCQkJCWF1Z21lbnRXaWR0aE9ySGVpZ2h0KAoJCQkJCWVsZW0sCgkJCQkJbmFtZSwKCQkJCQlleHRyYSwKCQkJCQlqUXVlcnkuc3VwcG9ydC5ib3hTaXppbmcgJiYgalF1ZXJ5LmNzcyggZWxlbSwgImJveFNpemluZyIsIGZhbHNlLCBzdHlsZXMgKSA9PT0gImJvcmRlci1ib3giLAoJCQkJCXN0eWxlcwoJCQkJKSA6IDAKCQkJKTsKCQl9Cgl9Owp9KTsKCmlmICggIWpRdWVyeS5zdXBwb3J0Lm9wYWNpdHkgKSB7CglqUXVlcnkuY3NzSG9va3Mub3BhY2l0eSA9IHsKCQlnZXQ6IGZ1bmN0aW9uKCBlbGVtLCBjb21wdXRlZCApIHsKCQkJLy8gSUUgdXNlcyBmaWx0ZXJzIGZvciBvcGFjaXR5CgkJCXJldHVybiByb3BhY2l0eS50ZXN0KCAoY29tcHV0ZWQgJiYgZWxlbS5jdXJyZW50U3R5bGUgPyBlbGVtLmN1cnJlbnRTdHlsZS5maWx0ZXIgOiBlbGVtLnN0eWxlLmZpbHRlcikgfHwgIiIgKSA/CgkJCQkoIDAuMDEgKiBwYXJzZUZsb2F0KCBSZWdFeHAuJDEgKSApICsgIiIgOgoJCQkJY29tcHV0ZWQgPyAiMSIgOiAiIjsKCQl9LAoKCQlzZXQ6IGZ1bmN0aW9uKCBlbGVtLCB2YWx1ZSApIHsKCQkJdmFyIHN0eWxlID0gZWxlbS5zdHlsZSwKCQkJCWN1cnJlbnRTdHlsZSA9IGVsZW0uY3VycmVudFN0eWxlLAoJCQkJb3BhY2l0eSA9IGpRdWVyeS5pc051bWVyaWMoIHZhbHVlICkgPyAiYWxwaGEob3BhY2l0eT0iICsgdmFsdWUgKiAxMDAgKyAiKSIgOiAiIiwKCQkJCWZpbHRlciA9IGN1cnJlbnRTdHlsZSAmJiBjdXJyZW50U3R5bGUuZmlsdGVyIHx8IHN0eWxlLmZpbHRlciB8fCAiIjsKCgkJCS8vIElFIGhhcyB0cm91YmxlIHdpdGggb3BhY2l0eSBpZiBpdCBkb2VzIG5vdCBoYXZlIGxheW91dAoJCQkvLyBGb3JjZSBpdCBieSBzZXR0aW5nIHRoZSB6b29tIGxldmVsCgkJCXN0eWxlLnpvb20gPSAxOwoKCQkJLy8gaWYgc2V0dGluZyBvcGFjaXR5IHRvIDEsIGFuZCBubyBvdGhlciBmaWx0ZXJzIGV4aXN0IC0gYXR0ZW1wdCB0byByZW1vdmUgZmlsdGVyIGF0dHJpYnV0ZSAjNjY1MgoJCQkvLyBpZiB2YWx1ZSA9PT0gIiIsIHRoZW4gcmVtb3ZlIGlubGluZSBvcGFjaXR5ICMxMjY4NQoJCQlpZiAoICggdmFsdWUgPj0gMSB8fCB2YWx1ZSA9PT0gIiIgKSAmJgoJCQkJCWpRdWVyeS50cmltKCBmaWx0ZXIucmVwbGFjZSggcmFscGhhLCAiIiApICkgPT09ICIiICYmCgkJCQkJc3R5bGUucmVtb3ZlQXR0cmlidXRlICkgewoKCQkJCS8vIFNldHRpbmcgc3R5bGUuZmlsdGVyIHRvIG51bGwsICIiICYgIiAiIHN0aWxsIGxlYXZlICJmaWx0ZXI6IiBpbiB0aGUgY3NzVGV4dAoJCQkJLy8gaWYgImZpbHRlcjoiIGlzIHByZXNlbnQgYXQgYWxsLCBjbGVhclR5cGUgaXMgZGlzYWJsZWQsIHdlIHdhbnQgdG8gYXZvaWQgdGhpcwoJCQkJLy8gc3R5bGUucmVtb3ZlQXR0cmlidXRlIGlzIElFIE9ubHksIGJ1dCBzbyBhcHBhcmVudGx5IGlzIHRoaXMgY29kZSBwYXRoLi4uCgkJCQlzdHlsZS5yZW1vdmVBdHRyaWJ1dGUoICJmaWx0ZXIiICk7CgoJCQkJLy8gaWYgdGhlcmUgaXMgbm8gZmlsdGVyIHN0eWxlIGFwcGxpZWQgaW4gYSBjc3MgcnVsZSBvciB1bnNldCBpbmxpbmUgb3BhY2l0eSwgd2UgYXJlIGRvbmUKCQkJCWlmICggdmFsdWUgPT09ICIiIHx8IGN1cnJlbnRTdHlsZSAmJiAhY3VycmVudFN0eWxlLmZpbHRlciApIHsKCQkJCQlyZXR1cm47CgkJCQl9CgkJCX0KCgkJCS8vIG90aGVyd2lzZSwgc2V0IG5ldyBmaWx0ZXIgdmFsdWVzCgkJCXN0eWxlLmZpbHRlciA9IHJhbHBoYS50ZXN0KCBmaWx0ZXIgKSA/CgkJCQlmaWx0ZXIucmVwbGFjZSggcmFscGhhLCBvcGFjaXR5ICkgOgoJCQkJZmlsdGVyICsgIiAiICsgb3BhY2l0eTsKCQl9Cgl9Owp9CgovLyBUaGVzZSBob29rcyBjYW5ub3QgYmUgYWRkZWQgdW50aWwgRE9NIHJlYWR5IGJlY2F1c2UgdGhlIHN1cHBvcnQgdGVzdAovLyBmb3IgaXQgaXMgbm90IHJ1biB1bnRpbCBhZnRlciBET00gcmVhZHkKalF1ZXJ5KGZ1bmN0aW9uKCkgewoJaWYgKCAhalF1ZXJ5LnN1cHBvcnQucmVsaWFibGVNYXJnaW5SaWdodCApIHsKCQlqUXVlcnkuY3NzSG9va3MubWFyZ2luUmlnaHQgPSB7CgkJCWdldDogZnVuY3Rpb24oIGVsZW0sIGNvbXB1dGVkICkgewoJCQkJaWYgKCBjb21wdXRlZCApIHsKCQkJCQkvLyBXZWJLaXQgQnVnIDEzMzQzIC0gZ2V0Q29tcHV0ZWRTdHlsZSByZXR1cm5zIHdyb25nIHZhbHVlIGZvciBtYXJnaW4tcmlnaHQKCQkJCQkvLyBXb3JrIGFyb3VuZCBieSB0ZW1wb3JhcmlseSBzZXR0aW5nIGVsZW1lbnQgZGlzcGxheSB0byBpbmxpbmUtYmxvY2sKCQkJCQlyZXR1cm4galF1ZXJ5LnN3YXAoIGVsZW0sIHsgImRpc3BsYXkiOiAiaW5saW5lLWJsb2NrIiB9LAoJCQkJCQljdXJDU1MsIFsgZWxlbSwgIm1hcmdpblJpZ2h0IiBdICk7CgkJCQl9CgkJCX0KCQl9OwoJfQoKCS8vIFdlYmtpdCBidWc6IGh0dHBzOi8vYnVncy53ZWJraXQub3JnL3Nob3dfYnVnLmNnaT9pZD0yOTA4NAoJLy8gZ2V0Q29tcHV0ZWRTdHlsZSByZXR1cm5zIHBlcmNlbnQgd2hlbiBzcGVjaWZpZWQgZm9yIHRvcC9sZWZ0L2JvdHRvbS9yaWdodAoJLy8gcmF0aGVyIHRoYW4gbWFrZSB0aGUgY3NzIG1vZHVsZSBkZXBlbmQgb24gdGhlIG9mZnNldCBtb2R1bGUsIHdlIGp1c3QgY2hlY2sgZm9yIGl0IGhlcmUKCWlmICggIWpRdWVyeS5zdXBwb3J0LnBpeGVsUG9zaXRpb24gJiYgalF1ZXJ5LmZuLnBvc2l0aW9uICkgewoJCWpRdWVyeS5lYWNoKCBbICJ0b3AiLCAibGVmdCIgXSwgZnVuY3Rpb24oIGksIHByb3AgKSB7CgkJCWpRdWVyeS5jc3NIb29rc1sgcHJvcCBdID0gewoJCQkJZ2V0OiBmdW5jdGlvbiggZWxlbSwgY29tcHV0ZWQgKSB7CgkJCQkJaWYgKCBjb21wdXRlZCApIHsKCQkJCQkJY29tcHV0ZWQgPSBjdXJDU1MoIGVsZW0sIHByb3AgKTsKCQkJCQkJLy8gaWYgY3VyQ1NTIHJldHVybnMgcGVyY2VudGFnZSwgZmFsbGJhY2sgdG8gb2Zmc2V0CgkJCQkJCXJldHVybiBybnVtbm9ucHgudGVzdCggY29tcHV0ZWQgKSA/CgkJCQkJCQlqUXVlcnkoIGVsZW0gKS5wb3NpdGlvbigpWyBwcm9wIF0gKyAicHgiIDoKCQkJCQkJCWNvbXB1dGVkOwoJCQkJCX0KCQkJCX0KCQkJfTsKCQl9KTsKCX0KCn0pOwoKaWYgKCBqUXVlcnkuZXhwciAmJiBqUXVlcnkuZXhwci5maWx0ZXJzICkgewoJalF1ZXJ5LmV4cHIuZmlsdGVycy5oaWRkZW4gPSBmdW5jdGlvbiggZWxlbSApIHsKCQkvLyBTdXBwb3J0OiBPcGVyYSA8PSAxMi4xMgoJCS8vIE9wZXJhIHJlcG9ydHMgb2Zmc2V0V2lkdGhzIGFuZCBvZmZzZXRIZWlnaHRzIGxlc3MgdGhhbiB6ZXJvIG9uIHNvbWUgZWxlbWVudHMKCQlyZXR1cm4gZWxlbS5vZmZzZXRXaWR0aCA8PSAwICYmIGVsZW0ub2Zmc2V0SGVpZ2h0IDw9IDAgfHwKCQkJKCFqUXVlcnkuc3VwcG9ydC5yZWxpYWJsZUhpZGRlbk9mZnNldHMgJiYgKChlbGVtLnN0eWxlICYmIGVsZW0uc3R5bGUuZGlzcGxheSkgfHwgalF1ZXJ5LmNzcyggZWxlbSwgImRpc3BsYXkiICkpID09PSAibm9uZSIpOwoJfTsKCglqUXVlcnkuZXhwci5maWx0ZXJzLnZpc2libGUgPSBmdW5jdGlvbiggZWxlbSApIHsKCQlyZXR1cm4gIWpRdWVyeS5leHByLmZpbHRlcnMuaGlkZGVuKCBlbGVtICk7Cgl9Owp9CgovLyBUaGVzZSBob29rcyBhcmUgdXNlZCBieSBhbmltYXRlIHRvIGV4cGFuZCBwcm9wZXJ0aWVzCmpRdWVyeS5lYWNoKHsKCW1hcmdpbjogIiIsCglwYWRkaW5nOiAiIiwKCWJvcmRlcjogIldpZHRoIgp9LCBmdW5jdGlvbiggcHJlZml4LCBzdWZmaXggKSB7CglqUXVlcnkuY3NzSG9va3NbIHByZWZpeCArIHN1ZmZpeCBdID0gewoJCWV4cGFuZDogZnVuY3Rpb24oIHZhbHVlICkgewoJCQl2YXIgaSA9IDAsCgkJCQlleHBhbmRlZCA9IHt9LAoKCQkJCS8vIGFzc3VtZXMgYSBzaW5nbGUgbnVtYmVyIGlmIG5vdCBhIHN0cmluZwoJCQkJcGFydHMgPSB0eXBlb2YgdmFsdWUgPT09ICJzdHJpbmciID8gdmFsdWUuc3BsaXQoIiAiKSA6IFsgdmFsdWUgXTsKCgkJCWZvciAoIDsgaSA8IDQ7IGkrKyApIHsKCQkJCWV4cGFuZGVkWyBwcmVmaXggKyBjc3NFeHBhbmRbIGkgXSArIHN1ZmZpeCBdID0KCQkJCQlwYXJ0c1sgaSBdIHx8IHBhcnRzWyBpIC0gMiBdIHx8IHBhcnRzWyAwIF07CgkJCX0KCgkJCXJldHVybiBleHBhbmRlZDsKCQl9Cgl9OwoKCWlmICggIXJtYXJnaW4udGVzdCggcHJlZml4ICkgKSB7CgkJalF1ZXJ5LmNzc0hvb2tzWyBwcmVmaXggKyBzdWZmaXggXS5zZXQgPSBzZXRQb3NpdGl2ZU51bWJlcjsKCX0KfSk7CnZhciByMjAgPSAvJTIwL2csCglyYnJhY2tldCA9IC9cW1xdJC8sCglyQ1JMRiA9IC9ccj9cbi9nLAoJcnN1Ym1pdHRlclR5cGVzID0gL14oPzpzdWJtaXR8YnV0dG9ufGltYWdlfHJlc2V0fGZpbGUpJC9pLAoJcnN1Ym1pdHRhYmxlID0gL14oPzppbnB1dHxzZWxlY3R8dGV4dGFyZWF8a2V5Z2VuKS9pOwoKalF1ZXJ5LmZuLmV4dGVuZCh7CglzZXJpYWxpemU6IGZ1bmN0aW9uKCkgewoJCXJldHVybiBqUXVlcnkucGFyYW0oIHRoaXMuc2VyaWFsaXplQXJyYXkoKSApOwoJfSwKCXNlcmlhbGl6ZUFycmF5OiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5tYXAoZnVuY3Rpb24oKXsKCQkJLy8gQ2FuIGFkZCBwcm9wSG9vayBmb3IgImVsZW1lbnRzIiB0byBmaWx0ZXIgb3IgYWRkIGZvcm0gZWxlbWVudHMKCQkJdmFyIGVsZW1lbnRzID0galF1ZXJ5LnByb3AoIHRoaXMsICJlbGVtZW50cyIgKTsKCQkJcmV0dXJuIGVsZW1lbnRzID8galF1ZXJ5Lm1ha2VBcnJheSggZWxlbWVudHMgKSA6IHRoaXM7CgkJfSkKCQkuZmlsdGVyKGZ1bmN0aW9uKCl7CgkJCXZhciB0eXBlID0gdGhpcy50eXBlOwoJCQkvLyBVc2UgLmlzKCI6ZGlzYWJsZWQiKSBzbyB0aGF0IGZpZWxkc2V0W2Rpc2FibGVkXSB3b3JrcwoJCQlyZXR1cm4gdGhpcy5uYW1lICYmICFqUXVlcnkoIHRoaXMgKS5pcyggIjpkaXNhYmxlZCIgKSAmJgoJCQkJcnN1Ym1pdHRhYmxlLnRlc3QoIHRoaXMubm9kZU5hbWUgKSAmJiAhcnN1Ym1pdHRlclR5cGVzLnRlc3QoIHR5cGUgKSAmJgoJCQkJKCB0aGlzLmNoZWNrZWQgfHwgIW1hbmlwdWxhdGlvbl9yY2hlY2thYmxlVHlwZS50ZXN0KCB0eXBlICkgKTsKCQl9KQoJCS5tYXAoZnVuY3Rpb24oIGksIGVsZW0gKXsKCQkJdmFyIHZhbCA9IGpRdWVyeSggdGhpcyApLnZhbCgpOwoKCQkJcmV0dXJuIHZhbCA9PSBudWxsID8KCQkJCW51bGwgOgoJCQkJalF1ZXJ5LmlzQXJyYXkoIHZhbCApID8KCQkJCQlqUXVlcnkubWFwKCB2YWwsIGZ1bmN0aW9uKCB2YWwgKXsKCQkJCQkJcmV0dXJuIHsgbmFtZTogZWxlbS5uYW1lLCB2YWx1ZTogdmFsLnJlcGxhY2UoIHJDUkxGLCAiXHJcbiIgKSB9OwoJCQkJCX0pIDoKCQkJCQl7IG5hbWU6IGVsZW0ubmFtZSwgdmFsdWU6IHZhbC5yZXBsYWNlKCByQ1JMRiwgIlxyXG4iICkgfTsKCQl9KS5nZXQoKTsKCX0KfSk7CgovL1NlcmlhbGl6ZSBhbiBhcnJheSBvZiBmb3JtIGVsZW1lbnRzIG9yIGEgc2V0IG9mCi8va2V5L3ZhbHVlcyBpbnRvIGEgcXVlcnkgc3RyaW5nCmpRdWVyeS5wYXJhbSA9IGZ1bmN0aW9uKCBhLCB0cmFkaXRpb25hbCApIHsKCXZhciBwcmVmaXgsCgkJcyA9IFtdLAoJCWFkZCA9IGZ1bmN0aW9uKCBrZXksIHZhbHVlICkgewoJCQkvLyBJZiB2YWx1ZSBpcyBhIGZ1bmN0aW9uLCBpbnZva2UgaXQgYW5kIHJldHVybiBpdHMgdmFsdWUKCQkJdmFsdWUgPSBqUXVlcnkuaXNGdW5jdGlvbiggdmFsdWUgKSA/IHZhbHVlKCkgOiAoIHZhbHVlID09IG51bGwgPyAiIiA6IHZhbHVlICk7CgkJCXNbIHMubGVuZ3RoIF0gPSBlbmNvZGVVUklDb21wb25lbnQoIGtleSApICsgIj0iICsgZW5jb2RlVVJJQ29tcG9uZW50KCB2YWx1ZSApOwoJCX07CgoJLy8gU2V0IHRyYWRpdGlvbmFsIHRvIHRydWUgZm9yIGpRdWVyeSA8PSAxLjMuMiBiZWhhdmlvci4KCWlmICggdHJhZGl0aW9uYWwgPT09IHVuZGVmaW5lZCApIHsKCQl0cmFkaXRpb25hbCA9IGpRdWVyeS5hamF4U2V0dGluZ3MgJiYgalF1ZXJ5LmFqYXhTZXR0aW5ncy50cmFkaXRpb25hbDsKCX0KCgkvLyBJZiBhbiBhcnJheSB3YXMgcGFzc2VkIGluLCBhc3N1bWUgdGhhdCBpdCBpcyBhbiBhcnJheSBvZiBmb3JtIGVsZW1lbnRzLgoJaWYgKCBqUXVlcnkuaXNBcnJheSggYSApIHx8ICggYS5qcXVlcnkgJiYgIWpRdWVyeS5pc1BsYWluT2JqZWN0KCBhICkgKSApIHsKCQkvLyBTZXJpYWxpemUgdGhlIGZvcm0gZWxlbWVudHMKCQlqUXVlcnkuZWFjaCggYSwgZnVuY3Rpb24oKSB7CgkJCWFkZCggdGhpcy5uYW1lLCB0aGlzLnZhbHVlICk7CgkJfSk7CgoJfSBlbHNlIHsKCQkvLyBJZiB0cmFkaXRpb25hbCwgZW5jb2RlIHRoZSAib2xkIiB3YXkgKHRoZSB3YXkgMS4zLjIgb3Igb2xkZXIKCQkvLyBkaWQgaXQpLCBvdGhlcndpc2UgZW5jb2RlIHBhcmFtcyByZWN1cnNpdmVseS4KCQlmb3IgKCBwcmVmaXggaW4gYSApIHsKCQkJYnVpbGRQYXJhbXMoIHByZWZpeCwgYVsgcHJlZml4IF0sIHRyYWRpdGlvbmFsLCBhZGQgKTsKCQl9Cgl9CgoJLy8gUmV0dXJuIHRoZSByZXN1bHRpbmcgc2VyaWFsaXphdGlvbgoJcmV0dXJuIHMuam9pbiggIiYiICkucmVwbGFjZSggcjIwLCAiKyIgKTsKfTsKCmZ1bmN0aW9uIGJ1aWxkUGFyYW1zKCBwcmVmaXgsIG9iaiwgdHJhZGl0aW9uYWwsIGFkZCApIHsKCXZhciBuYW1lOwoKCWlmICggalF1ZXJ5LmlzQXJyYXkoIG9iaiApICkgewoJCS8vIFNlcmlhbGl6ZSBhcnJheSBpdGVtLgoJCWpRdWVyeS5lYWNoKCBvYmosIGZ1bmN0aW9uKCBpLCB2ICkgewoJCQlpZiAoIHRyYWRpdGlvbmFsIHx8IHJicmFja2V0LnRlc3QoIHByZWZpeCApICkgewoJCQkJLy8gVHJlYXQgZWFjaCBhcnJheSBpdGVtIGFzIGEgc2NhbGFyLgoJCQkJYWRkKCBwcmVmaXgsIHYgKTsKCgkJCX0gZWxzZSB7CgkJCQkvLyBJdGVtIGlzIG5vbi1zY2FsYXIgKGFycmF5IG9yIG9iamVjdCksIGVuY29kZSBpdHMgbnVtZXJpYyBpbmRleC4KCQkJCWJ1aWxkUGFyYW1zKCBwcmVmaXggKyAiWyIgKyAoIHR5cGVvZiB2ID09PSAib2JqZWN0IiA/IGkgOiAiIiApICsgIl0iLCB2LCB0cmFkaXRpb25hbCwgYWRkICk7CgkJCX0KCQl9KTsKCgl9IGVsc2UgaWYgKCAhdHJhZGl0aW9uYWwgJiYgalF1ZXJ5LnR5cGUoIG9iaiApID09PSAib2JqZWN0IiApIHsKCQkvLyBTZXJpYWxpemUgb2JqZWN0IGl0ZW0uCgkJZm9yICggbmFtZSBpbiBvYmogKSB7CgkJCWJ1aWxkUGFyYW1zKCBwcmVmaXggKyAiWyIgKyBuYW1lICsgIl0iLCBvYmpbIG5hbWUgXSwgdHJhZGl0aW9uYWwsIGFkZCApOwoJCX0KCgl9IGVsc2UgewoJCS8vIFNlcmlhbGl6ZSBzY2FsYXIgaXRlbS4KCQlhZGQoIHByZWZpeCwgb2JqICk7Cgl9Cn0KalF1ZXJ5LmVhY2goICgiYmx1ciBmb2N1cyBmb2N1c2luIGZvY3Vzb3V0IGxvYWQgcmVzaXplIHNjcm9sbCB1bmxvYWQgY2xpY2sgZGJsY2xpY2sgIiArCgkibW91c2Vkb3duIG1vdXNldXAgbW91c2Vtb3ZlIG1vdXNlb3ZlciBtb3VzZW91dCBtb3VzZWVudGVyIG1vdXNlbGVhdmUgIiArCgkiY2hhbmdlIHNlbGVjdCBzdWJtaXQga2V5ZG93biBrZXlwcmVzcyBrZXl1cCBlcnJvciBjb250ZXh0bWVudSIpLnNwbGl0KCIgIiksIGZ1bmN0aW9uKCBpLCBuYW1lICkgewoKCS8vIEhhbmRsZSBldmVudCBiaW5kaW5nCglqUXVlcnkuZm5bIG5hbWUgXSA9IGZ1bmN0aW9uKCBkYXRhLCBmbiApIHsKCQlyZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA+IDAgPwoJCQl0aGlzLm9uKCBuYW1lLCBudWxsLCBkYXRhLCBmbiApIDoKCQkJdGhpcy50cmlnZ2VyKCBuYW1lICk7Cgl9Owp9KTsKCmpRdWVyeS5mbi5ob3ZlciA9IGZ1bmN0aW9uKCBmbk92ZXIsIGZuT3V0ICkgewoJcmV0dXJuIHRoaXMubW91c2VlbnRlciggZm5PdmVyICkubW91c2VsZWF2ZSggZm5PdXQgfHwgZm5PdmVyICk7Cn07CnZhcgoJLy8gRG9jdW1lbnQgbG9jYXRpb24KCWFqYXhMb2NQYXJ0cywKCWFqYXhMb2NhdGlvbiwKCWFqYXhfbm9uY2UgPSBqUXVlcnkubm93KCksCgoJYWpheF9ycXVlcnkgPSAvXD8vLAoJcmhhc2ggPSAvIy4qJC8sCglydHMgPSAvKFs/Jl0pXz1bXiZdKi8sCglyaGVhZGVycyA9IC9eKC4qPyk6WyBcdF0qKFteXHJcbl0qKVxyPyQvbWcsIC8vIElFIGxlYXZlcyBhbiBcciBjaGFyYWN0ZXIgYXQgRU9MCgkvLyAjNzY1MywgIzgxMjUsICM4MTUyOiBsb2NhbCBwcm90b2NvbCBkZXRlY3Rpb24KCXJsb2NhbFByb3RvY29sID0gL14oPzphYm91dHxhcHB8YXBwLXN0b3JhZ2V8ListZXh0ZW5zaW9ufGZpbGV8cmVzfHdpZGdldCk6JC8sCglybm9Db250ZW50ID0gL14oPzpHRVR8SEVBRCkkLywKCXJwcm90b2NvbCA9IC9eXC9cLy8sCglydXJsID0gL14oW1x3ListXSs6KSg/OlwvXC8oW15cLz8jOl0qKSg/OjooXGQrKXwpfCkvLAoKCS8vIEtlZXAgYSBjb3B5IG9mIHRoZSBvbGQgbG9hZCBtZXRob2QKCV9sb2FkID0galF1ZXJ5LmZuLmxvYWQsCgoJLyogUHJlZmlsdGVycwoJICogMSkgVGhleSBhcmUgdXNlZnVsIHRvIGludHJvZHVjZSBjdXN0b20gZGF0YVR5cGVzIChzZWUgYWpheC9qc29ucC5qcyBmb3IgYW4gZXhhbXBsZSkKCSAqIDIpIFRoZXNlIGFyZSBjYWxsZWQ6CgkgKiAgICAtIEJFRk9SRSBhc2tpbmcgZm9yIGEgdHJhbnNwb3J0CgkgKiAgICAtIEFGVEVSIHBhcmFtIHNlcmlhbGl6YXRpb24gKHMuZGF0YSBpcyBhIHN0cmluZyBpZiBzLnByb2Nlc3NEYXRhIGlzIHRydWUpCgkgKiAzKSBrZXkgaXMgdGhlIGRhdGFUeXBlCgkgKiA0KSB0aGUgY2F0Y2hhbGwgc3ltYm9sICIqIiBjYW4gYmUgdXNlZAoJICogNSkgZXhlY3V0aW9uIHdpbGwgc3RhcnQgd2l0aCB0cmFuc3BvcnQgZGF0YVR5cGUgYW5kIFRIRU4gY29udGludWUgZG93biB0byAiKiIgaWYgbmVlZGVkCgkgKi8KCXByZWZpbHRlcnMgPSB7fSwKCgkvKiBUcmFuc3BvcnRzIGJpbmRpbmdzCgkgKiAxKSBrZXkgaXMgdGhlIGRhdGFUeXBlCgkgKiAyKSB0aGUgY2F0Y2hhbGwgc3ltYm9sICIqIiBjYW4gYmUgdXNlZAoJICogMykgc2VsZWN0aW9uIHdpbGwgc3RhcnQgd2l0aCB0cmFuc3BvcnQgZGF0YVR5cGUgYW5kIFRIRU4gZ28gdG8gIioiIGlmIG5lZWRlZAoJICovCgl0cmFuc3BvcnRzID0ge30sCgoJLy8gQXZvaWQgY29tbWVudC1wcm9sb2cgY2hhciBzZXF1ZW5jZSAoIzEwMDk4KTsgbXVzdCBhcHBlYXNlIGxpbnQgYW5kIGV2YWRlIGNvbXByZXNzaW9uCglhbGxUeXBlcyA9ICIqLyIuY29uY2F0KCIqIik7CgovLyAjODEzOCwgSUUgbWF5IHRocm93IGFuIGV4Y2VwdGlvbiB3aGVuIGFjY2Vzc2luZwovLyBhIGZpZWxkIGZyb20gd2luZG93LmxvY2F0aW9uIGlmIGRvY3VtZW50LmRvbWFpbiBoYXMgYmVlbiBzZXQKdHJ5IHsKCWFqYXhMb2NhdGlvbiA9IGxvY2F0aW9uLmhyZWY7Cn0gY2F0Y2goIGUgKSB7CgkvLyBVc2UgdGhlIGhyZWYgYXR0cmlidXRlIG9mIGFuIEEgZWxlbWVudAoJLy8gc2luY2UgSUUgd2lsbCBtb2RpZnkgaXQgZ2l2ZW4gZG9jdW1lbnQubG9jYXRpb24KCWFqYXhMb2NhdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICJhIiApOwoJYWpheExvY2F0aW9uLmhyZWYgPSAiIjsKCWFqYXhMb2NhdGlvbiA9IGFqYXhMb2NhdGlvbi5ocmVmOwp9CgovLyBTZWdtZW50IGxvY2F0aW9uIGludG8gcGFydHMKYWpheExvY1BhcnRzID0gcnVybC5leGVjKCBhamF4TG9jYXRpb24udG9Mb3dlckNhc2UoKSApIHx8IFtdOwoKLy8gQmFzZSAiY29uc3RydWN0b3IiIGZvciBqUXVlcnkuYWpheFByZWZpbHRlciBhbmQgalF1ZXJ5LmFqYXhUcmFuc3BvcnQKZnVuY3Rpb24gYWRkVG9QcmVmaWx0ZXJzT3JUcmFuc3BvcnRzKCBzdHJ1Y3R1cmUgKSB7CgoJLy8gZGF0YVR5cGVFeHByZXNzaW9uIGlzIG9wdGlvbmFsIGFuZCBkZWZhdWx0cyB0byAiKiIKCXJldHVybiBmdW5jdGlvbiggZGF0YVR5cGVFeHByZXNzaW9uLCBmdW5jICkgewoKCQlpZiAoIHR5cGVvZiBkYXRhVHlwZUV4cHJlc3Npb24gIT09ICJzdHJpbmciICkgewoJCQlmdW5jID0gZGF0YVR5cGVFeHByZXNzaW9uOwoJCQlkYXRhVHlwZUV4cHJlc3Npb24gPSAiKiI7CgkJfQoKCQl2YXIgZGF0YVR5cGUsCgkJCWkgPSAwLAoJCQlkYXRhVHlwZXMgPSBkYXRhVHlwZUV4cHJlc3Npb24udG9Mb3dlckNhc2UoKS5tYXRjaCggY29yZV9ybm90d2hpdGUgKSB8fCBbXTsKCgkJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggZnVuYyApICkgewoJCQkvLyBGb3IgZWFjaCBkYXRhVHlwZSBpbiB0aGUgZGF0YVR5cGVFeHByZXNzaW9uCgkJCXdoaWxlICggKGRhdGFUeXBlID0gZGF0YVR5cGVzW2krK10pICkgewoJCQkJLy8gUHJlcGVuZCBpZiByZXF1ZXN0ZWQKCQkJCWlmICggZGF0YVR5cGVbMF0gPT09ICIrIiApIHsKCQkJCQlkYXRhVHlwZSA9IGRhdGFUeXBlLnNsaWNlKCAxICkgfHwgIioiOwoJCQkJCShzdHJ1Y3R1cmVbIGRhdGFUeXBlIF0gPSBzdHJ1Y3R1cmVbIGRhdGFUeXBlIF0gfHwgW10pLnVuc2hpZnQoIGZ1bmMgKTsKCgkJCQkvLyBPdGhlcndpc2UgYXBwZW5kCgkJCQl9IGVsc2UgewoJCQkJCShzdHJ1Y3R1cmVbIGRhdGFUeXBlIF0gPSBzdHJ1Y3R1cmVbIGRhdGFUeXBlIF0gfHwgW10pLnB1c2goIGZ1bmMgKTsKCQkJCX0KCQkJfQoJCX0KCX07Cn0KCi8vIEJhc2UgaW5zcGVjdGlvbiBmdW5jdGlvbiBmb3IgcHJlZmlsdGVycyBhbmQgdHJhbnNwb3J0cwpmdW5jdGlvbiBpbnNwZWN0UHJlZmlsdGVyc09yVHJhbnNwb3J0cyggc3RydWN0dXJlLCBvcHRpb25zLCBvcmlnaW5hbE9wdGlvbnMsIGpxWEhSICkgewoKCXZhciBpbnNwZWN0ZWQgPSB7fSwKCQlzZWVraW5nVHJhbnNwb3J0ID0gKCBzdHJ1Y3R1cmUgPT09IHRyYW5zcG9ydHMgKTsKCglmdW5jdGlvbiBpbnNwZWN0KCBkYXRhVHlwZSApIHsKCQl2YXIgc2VsZWN0ZWQ7CgkJaW5zcGVjdGVkWyBkYXRhVHlwZSBdID0gdHJ1ZTsKCQlqUXVlcnkuZWFjaCggc3RydWN0dXJlWyBkYXRhVHlwZSBdIHx8IFtdLCBmdW5jdGlvbiggXywgcHJlZmlsdGVyT3JGYWN0b3J5ICkgewoJCQl2YXIgZGF0YVR5cGVPclRyYW5zcG9ydCA9IHByZWZpbHRlck9yRmFjdG9yeSggb3B0aW9ucywgb3JpZ2luYWxPcHRpb25zLCBqcVhIUiApOwoJCQlpZiggdHlwZW9mIGRhdGFUeXBlT3JUcmFuc3BvcnQgPT09ICJzdHJpbmciICYmICFzZWVraW5nVHJhbnNwb3J0ICYmICFpbnNwZWN0ZWRbIGRhdGFUeXBlT3JUcmFuc3BvcnQgXSApIHsKCQkJCW9wdGlvbnMuZGF0YVR5cGVzLnVuc2hpZnQoIGRhdGFUeXBlT3JUcmFuc3BvcnQgKTsKCQkJCWluc3BlY3QoIGRhdGFUeXBlT3JUcmFuc3BvcnQgKTsKCQkJCXJldHVybiBmYWxzZTsKCQkJfSBlbHNlIGlmICggc2Vla2luZ1RyYW5zcG9ydCApIHsKCQkJCXJldHVybiAhKCBzZWxlY3RlZCA9IGRhdGFUeXBlT3JUcmFuc3BvcnQgKTsKCQkJfQoJCX0pOwoJCXJldHVybiBzZWxlY3RlZDsKCX0KCglyZXR1cm4gaW5zcGVjdCggb3B0aW9ucy5kYXRhVHlwZXNbIDAgXSApIHx8ICFpbnNwZWN0ZWRbICIqIiBdICYmIGluc3BlY3QoICIqIiApOwp9CgovLyBBIHNwZWNpYWwgZXh0ZW5kIGZvciBhamF4IG9wdGlvbnMKLy8gdGhhdCB0YWtlcyAiZmxhdCIgb3B0aW9ucyAobm90IHRvIGJlIGRlZXAgZXh0ZW5kZWQpCi8vIEZpeGVzICM5ODg3CmZ1bmN0aW9uIGFqYXhFeHRlbmQoIHRhcmdldCwgc3JjICkgewoJdmFyIGRlZXAsIGtleSwKCQlmbGF0T3B0aW9ucyA9IGpRdWVyeS5hamF4U2V0dGluZ3MuZmxhdE9wdGlvbnMgfHwge307CgoJZm9yICgga2V5IGluIHNyYyApIHsKCQlpZiAoIHNyY1sga2V5IF0gIT09IHVuZGVmaW5lZCApIHsKCQkJKCBmbGF0T3B0aW9uc1sga2V5IF0gPyB0YXJnZXQgOiAoIGRlZXAgfHwgKGRlZXAgPSB7fSkgKSApWyBrZXkgXSA9IHNyY1sga2V5IF07CgkJfQoJfQoJaWYgKCBkZWVwICkgewoJCWpRdWVyeS5leHRlbmQoIHRydWUsIHRhcmdldCwgZGVlcCApOwoJfQoKCXJldHVybiB0YXJnZXQ7Cn0KCmpRdWVyeS5mbi5sb2FkID0gZnVuY3Rpb24oIHVybCwgcGFyYW1zLCBjYWxsYmFjayApIHsKCWlmICggdHlwZW9mIHVybCAhPT0gInN0cmluZyIgJiYgX2xvYWQgKSB7CgkJcmV0dXJuIF9sb2FkLmFwcGx5KCB0aGlzLCBhcmd1bWVudHMgKTsKCX0KCgl2YXIgc2VsZWN0b3IsIHJlc3BvbnNlLCB0eXBlLAoJCXNlbGYgPSB0aGlzLAoJCW9mZiA9IHVybC5pbmRleE9mKCIgIik7CgoJaWYgKCBvZmYgPj0gMCApIHsKCQlzZWxlY3RvciA9IHVybC5zbGljZSggb2ZmLCB1cmwubGVuZ3RoICk7CgkJdXJsID0gdXJsLnNsaWNlKCAwLCBvZmYgKTsKCX0KCgkvLyBJZiBpdCdzIGEgZnVuY3Rpb24KCWlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIHBhcmFtcyApICkgewoKCQkvLyBXZSBhc3N1bWUgdGhhdCBpdCdzIHRoZSBjYWxsYmFjawoJCWNhbGxiYWNrID0gcGFyYW1zOwoJCXBhcmFtcyA9IHVuZGVmaW5lZDsKCgkvLyBPdGhlcndpc2UsIGJ1aWxkIGEgcGFyYW0gc3RyaW5nCgl9IGVsc2UgaWYgKCBwYXJhbXMgJiYgdHlwZW9mIHBhcmFtcyA9PT0gIm9iamVjdCIgKSB7CgkJdHlwZSA9ICJQT1NUIjsKCX0KCgkvLyBJZiB3ZSBoYXZlIGVsZW1lbnRzIHRvIG1vZGlmeSwgbWFrZSB0aGUgcmVxdWVzdAoJaWYgKCBzZWxmLmxlbmd0aCA+IDAgKSB7CgkJalF1ZXJ5LmFqYXgoewoJCQl1cmw6IHVybCwKCgkJCS8vIGlmICJ0eXBlIiB2YXJpYWJsZSBpcyB1bmRlZmluZWQsIHRoZW4gIkdFVCIgbWV0aG9kIHdpbGwgYmUgdXNlZAoJCQl0eXBlOiB0eXBlLAoJCQlkYXRhVHlwZTogImh0bWwiLAoJCQlkYXRhOiBwYXJhbXMKCQl9KS5kb25lKGZ1bmN0aW9uKCByZXNwb25zZVRleHQgKSB7CgoJCQkvLyBTYXZlIHJlc3BvbnNlIGZvciB1c2UgaW4gY29tcGxldGUgY2FsbGJhY2sKCQkJcmVzcG9uc2UgPSBhcmd1bWVudHM7CgoJCQlzZWxmLmh0bWwoIHNlbGVjdG9yID8KCgkJCQkvLyBJZiBhIHNlbGVjdG9yIHdhcyBzcGVjaWZpZWQsIGxvY2F0ZSB0aGUgcmlnaHQgZWxlbWVudHMgaW4gYSBkdW1teSBkaXYKCQkJCS8vIEV4Y2x1ZGUgc2NyaXB0cyB0byBhdm9pZCBJRSAnUGVybWlzc2lvbiBEZW5pZWQnIGVycm9ycwoJCQkJalF1ZXJ5KCI8ZGl2PiIpLmFwcGVuZCggalF1ZXJ5LnBhcnNlSFRNTCggcmVzcG9uc2VUZXh0ICkgKS5maW5kKCBzZWxlY3RvciApIDoKCgkJCQkvLyBPdGhlcndpc2UgdXNlIHRoZSBmdWxsIHJlc3VsdAoJCQkJcmVzcG9uc2VUZXh0ICk7CgoJCX0pLmNvbXBsZXRlKCBjYWxsYmFjayAmJiBmdW5jdGlvbigganFYSFIsIHN0YXR1cyApIHsKCQkJc2VsZi5lYWNoKCBjYWxsYmFjaywgcmVzcG9uc2UgfHwgWyBqcVhIUi5yZXNwb25zZVRleHQsIHN0YXR1cywganFYSFIgXSApOwoJCX0pOwoJfQoKCXJldHVybiB0aGlzOwp9OwoKLy8gQXR0YWNoIGEgYnVuY2ggb2YgZnVuY3Rpb25zIGZvciBoYW5kbGluZyBjb21tb24gQUpBWCBldmVudHMKalF1ZXJ5LmVhY2goIFsgImFqYXhTdGFydCIsICJhamF4U3RvcCIsICJhamF4Q29tcGxldGUiLCAiYWpheEVycm9yIiwgImFqYXhTdWNjZXNzIiwgImFqYXhTZW5kIiBdLCBmdW5jdGlvbiggaSwgdHlwZSApewoJalF1ZXJ5LmZuWyB0eXBlIF0gPSBmdW5jdGlvbiggZm4gKXsKCQlyZXR1cm4gdGhpcy5vbiggdHlwZSwgZm4gKTsKCX07Cn0pOwoKalF1ZXJ5LmVhY2goIFsgImdldCIsICJwb3N0IiBdLCBmdW5jdGlvbiggaSwgbWV0aG9kICkgewoJalF1ZXJ5WyBtZXRob2QgXSA9IGZ1bmN0aW9uKCB1cmwsIGRhdGEsIGNhbGxiYWNrLCB0eXBlICkgewoJCS8vIHNoaWZ0IGFyZ3VtZW50cyBpZiBkYXRhIGFyZ3VtZW50IHdhcyBvbWl0dGVkCgkJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggZGF0YSApICkgewoJCQl0eXBlID0gdHlwZSB8fCBjYWxsYmFjazsKCQkJY2FsbGJhY2sgPSBkYXRhOwoJCQlkYXRhID0gdW5kZWZpbmVkOwoJCX0KCgkJcmV0dXJuIGpRdWVyeS5hamF4KHsKCQkJdXJsOiB1cmwsCgkJCXR5cGU6IG1ldGhvZCwKCQkJZGF0YVR5cGU6IHR5cGUsCgkJCWRhdGE6IGRhdGEsCgkJCXN1Y2Nlc3M6IGNhbGxiYWNrCgkJfSk7Cgl9Owp9KTsKCmpRdWVyeS5leHRlbmQoewoKCS8vIENvdW50ZXIgZm9yIGhvbGRpbmcgdGhlIG51bWJlciBvZiBhY3RpdmUgcXVlcmllcwoJYWN0aXZlOiAwLAoKCS8vIExhc3QtTW9kaWZpZWQgaGVhZGVyIGNhY2hlIGZvciBuZXh0IHJlcXVlc3QKCWxhc3RNb2RpZmllZDoge30sCglldGFnOiB7fSwKCglhamF4U2V0dGluZ3M6IHsKCQl1cmw6IGFqYXhMb2NhdGlvbiwKCQl0eXBlOiAiR0VUIiwKCQlpc0xvY2FsOiBybG9jYWxQcm90b2NvbC50ZXN0KCBhamF4TG9jUGFydHNbIDEgXSApLAoJCWdsb2JhbDogdHJ1ZSwKCQlwcm9jZXNzRGF0YTogdHJ1ZSwKCQlhc3luYzogdHJ1ZSwKCQljb250ZW50VHlwZTogImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZDsgY2hhcnNldD1VVEYtOCIsCgkJLyoKCQl0aW1lb3V0OiAwLAoJCWRhdGE6IG51bGwsCgkJZGF0YVR5cGU6IG51bGwsCgkJdXNlcm5hbWU6IG51bGwsCgkJcGFzc3dvcmQ6IG51bGwsCgkJY2FjaGU6IG51bGwsCgkJdGhyb3dzOiBmYWxzZSwKCQl0cmFkaXRpb25hbDogZmFsc2UsCgkJaGVhZGVyczoge30sCgkJKi8KCgkJYWNjZXB0czogewoJCQkiKiI6IGFsbFR5cGVzLAoJCQl0ZXh0OiAidGV4dC9wbGFpbiIsCgkJCWh0bWw6ICJ0ZXh0L2h0bWwiLAoJCQl4bWw6ICJhcHBsaWNhdGlvbi94bWwsIHRleHQveG1sIiwKCQkJanNvbjogImFwcGxpY2F0aW9uL2pzb24sIHRleHQvamF2YXNjcmlwdCIKCQl9LAoKCQljb250ZW50czogewoJCQl4bWw6IC94bWwvLAoJCQlodG1sOiAvaHRtbC8sCgkJCWpzb246IC9qc29uLwoJCX0sCgoJCXJlc3BvbnNlRmllbGRzOiB7CgkJCXhtbDogInJlc3BvbnNlWE1MIiwKCQkJdGV4dDogInJlc3BvbnNlVGV4dCIKCQl9LAoKCQkvLyBEYXRhIGNvbnZlcnRlcnMKCQkvLyBLZXlzIHNlcGFyYXRlIHNvdXJjZSAob3IgY2F0Y2hhbGwgIioiKSBhbmQgZGVzdGluYXRpb24gdHlwZXMgd2l0aCBhIHNpbmdsZSBzcGFjZQoJCWNvbnZlcnRlcnM6IHsKCgkJCS8vIENvbnZlcnQgYW55dGhpbmcgdG8gdGV4dAoJCQkiKiB0ZXh0Ijogd2luZG93LlN0cmluZywKCgkJCS8vIFRleHQgdG8gaHRtbCAodHJ1ZSA9IG5vIHRyYW5zZm9ybWF0aW9uKQoJCQkidGV4dCBodG1sIjogdHJ1ZSwKCgkJCS8vIEV2YWx1YXRlIHRleHQgYXMgYSBqc29uIGV4cHJlc3Npb24KCQkJInRleHQganNvbiI6IGpRdWVyeS5wYXJzZUpTT04sCgoJCQkvLyBQYXJzZSB0ZXh0IGFzIHhtbAoJCQkidGV4dCB4bWwiOiBqUXVlcnkucGFyc2VYTUwKCQl9LAoKCQkvLyBGb3Igb3B0aW9ucyB0aGF0IHNob3VsZG4ndCBiZSBkZWVwIGV4dGVuZGVkOgoJCS8vIHlvdSBjYW4gYWRkIHlvdXIgb3duIGN1c3RvbSBvcHRpb25zIGhlcmUgaWYKCQkvLyBhbmQgd2hlbiB5b3UgY3JlYXRlIG9uZSB0aGF0IHNob3VsZG4ndCBiZQoJCS8vIGRlZXAgZXh0ZW5kZWQgKHNlZSBhamF4RXh0ZW5kKQoJCWZsYXRPcHRpb25zOiB7CgkJCXVybDogdHJ1ZSwKCQkJY29udGV4dDogdHJ1ZQoJCX0KCX0sCgoJLy8gQ3JlYXRlcyBhIGZ1bGwgZmxlZGdlZCBzZXR0aW5ncyBvYmplY3QgaW50byB0YXJnZXQKCS8vIHdpdGggYm90aCBhamF4U2V0dGluZ3MgYW5kIHNldHRpbmdzIGZpZWxkcy4KCS8vIElmIHRhcmdldCBpcyBvbWl0dGVkLCB3cml0ZXMgaW50byBhamF4U2V0dGluZ3MuCglhamF4U2V0dXA6IGZ1bmN0aW9uKCB0YXJnZXQsIHNldHRpbmdzICkgewoJCXJldHVybiBzZXR0aW5ncyA/CgoJCQkvLyBCdWlsZGluZyBhIHNldHRpbmdzIG9iamVjdAoJCQlhamF4RXh0ZW5kKCBhamF4RXh0ZW5kKCB0YXJnZXQsIGpRdWVyeS5hamF4U2V0dGluZ3MgKSwgc2V0dGluZ3MgKSA6CgoJCQkvLyBFeHRlbmRpbmcgYWpheFNldHRpbmdzCgkJCWFqYXhFeHRlbmQoIGpRdWVyeS5hamF4U2V0dGluZ3MsIHRhcmdldCApOwoJfSwKCglhamF4UHJlZmlsdGVyOiBhZGRUb1ByZWZpbHRlcnNPclRyYW5zcG9ydHMoIHByZWZpbHRlcnMgKSwKCWFqYXhUcmFuc3BvcnQ6IGFkZFRvUHJlZmlsdGVyc09yVHJhbnNwb3J0cyggdHJhbnNwb3J0cyApLAoKCS8vIE1haW4gbWV0aG9kCglhamF4OiBmdW5jdGlvbiggdXJsLCBvcHRpb25zICkgewoKCQkvLyBJZiB1cmwgaXMgYW4gb2JqZWN0LCBzaW11bGF0ZSBwcmUtMS41IHNpZ25hdHVyZQoJCWlmICggdHlwZW9mIHVybCA9PT0gIm9iamVjdCIgKSB7CgkJCW9wdGlvbnMgPSB1cmw7CgkJCXVybCA9IHVuZGVmaW5lZDsKCQl9CgoJCS8vIEZvcmNlIG9wdGlvbnMgdG8gYmUgYW4gb2JqZWN0CgkJb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CgoJCXZhciAvLyBDcm9zcy1kb21haW4gZGV0ZWN0aW9uIHZhcnMKCQkJcGFydHMsCgkJCS8vIExvb3AgdmFyaWFibGUKCQkJaSwKCQkJLy8gVVJMIHdpdGhvdXQgYW50aS1jYWNoZSBwYXJhbQoJCQljYWNoZVVSTCwKCQkJLy8gUmVzcG9uc2UgaGVhZGVycyBhcyBzdHJpbmcKCQkJcmVzcG9uc2VIZWFkZXJzU3RyaW5nLAoJCQkvLyB0aW1lb3V0IGhhbmRsZQoJCQl0aW1lb3V0VGltZXIsCgoJCQkvLyBUbyBrbm93IGlmIGdsb2JhbCBldmVudHMgYXJlIHRvIGJlIGRpc3BhdGNoZWQKCQkJZmlyZUdsb2JhbHMsCgoJCQl0cmFuc3BvcnQsCgkJCS8vIFJlc3BvbnNlIGhlYWRlcnMKCQkJcmVzcG9uc2VIZWFkZXJzLAoJCQkvLyBDcmVhdGUgdGhlIGZpbmFsIG9wdGlvbnMgb2JqZWN0CgkJCXMgPSBqUXVlcnkuYWpheFNldHVwKCB7fSwgb3B0aW9ucyApLAoJCQkvLyBDYWxsYmFja3MgY29udGV4dAoJCQljYWxsYmFja0NvbnRleHQgPSBzLmNvbnRleHQgfHwgcywKCQkJLy8gQ29udGV4dCBmb3IgZ2xvYmFsIGV2ZW50cyBpcyBjYWxsYmFja0NvbnRleHQgaWYgaXQgaXMgYSBET00gbm9kZSBvciBqUXVlcnkgY29sbGVjdGlvbgoJCQlnbG9iYWxFdmVudENvbnRleHQgPSBzLmNvbnRleHQgJiYgKCBjYWxsYmFja0NvbnRleHQubm9kZVR5cGUgfHwgY2FsbGJhY2tDb250ZXh0LmpxdWVyeSApID8KCQkJCWpRdWVyeSggY2FsbGJhY2tDb250ZXh0ICkgOgoJCQkJalF1ZXJ5LmV2ZW50LAoJCQkvLyBEZWZlcnJlZHMKCQkJZGVmZXJyZWQgPSBqUXVlcnkuRGVmZXJyZWQoKSwKCQkJY29tcGxldGVEZWZlcnJlZCA9IGpRdWVyeS5DYWxsYmFja3MoIm9uY2UgbWVtb3J5IiksCgkJCS8vIFN0YXR1cy1kZXBlbmRlbnQgY2FsbGJhY2tzCgkJCXN0YXR1c0NvZGUgPSBzLnN0YXR1c0NvZGUgfHwge30sCgkJCS8vIEhlYWRlcnMgKHRoZXkgYXJlIHNlbnQgYWxsIGF0IG9uY2UpCgkJCXJlcXVlc3RIZWFkZXJzID0ge30sCgkJCXJlcXVlc3RIZWFkZXJzTmFtZXMgPSB7fSwKCQkJLy8gVGhlIGpxWEhSIHN0YXRlCgkJCXN0YXRlID0gMCwKCQkJLy8gRGVmYXVsdCBhYm9ydCBtZXNzYWdlCgkJCXN0ckFib3J0ID0gImNhbmNlbGVkIiwKCQkJLy8gRmFrZSB4aHIKCQkJanFYSFIgPSB7CgkJCQlyZWFkeVN0YXRlOiAwLAoKCQkJCS8vIEJ1aWxkcyBoZWFkZXJzIGhhc2h0YWJsZSBpZiBuZWVkZWQKCQkJCWdldFJlc3BvbnNlSGVhZGVyOiBmdW5jdGlvbigga2V5ICkgewoJCQkJCXZhciBtYXRjaDsKCQkJCQlpZiAoIHN0YXRlID09PSAyICkgewoJCQkJCQlpZiAoICFyZXNwb25zZUhlYWRlcnMgKSB7CgkJCQkJCQlyZXNwb25zZUhlYWRlcnMgPSB7fTsKCQkJCQkJCXdoaWxlICggKG1hdGNoID0gcmhlYWRlcnMuZXhlYyggcmVzcG9uc2VIZWFkZXJzU3RyaW5nICkpICkgewoJCQkJCQkJCXJlc3BvbnNlSGVhZGVyc1sgbWF0Y2hbMV0udG9Mb3dlckNhc2UoKSBdID0gbWF0Y2hbIDIgXTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQltYXRjaCA9IHJlc3BvbnNlSGVhZGVyc1sga2V5LnRvTG93ZXJDYXNlKCkgXTsKCQkJCQl9CgkJCQkJcmV0dXJuIG1hdGNoID09IG51bGwgPyBudWxsIDogbWF0Y2g7CgkJCQl9LAoKCQkJCS8vIFJhdyBzdHJpbmcKCQkJCWdldEFsbFJlc3BvbnNlSGVhZGVyczogZnVuY3Rpb24oKSB7CgkJCQkJcmV0dXJuIHN0YXRlID09PSAyID8gcmVzcG9uc2VIZWFkZXJzU3RyaW5nIDogbnVsbDsKCQkJCX0sCgoJCQkJLy8gQ2FjaGVzIHRoZSBoZWFkZXIKCQkJCXNldFJlcXVlc3RIZWFkZXI6IGZ1bmN0aW9uKCBuYW1lLCB2YWx1ZSApIHsKCQkJCQl2YXIgbG5hbWUgPSBuYW1lLnRvTG93ZXJDYXNlKCk7CgkJCQkJaWYgKCAhc3RhdGUgKSB7CgkJCQkJCW5hbWUgPSByZXF1ZXN0SGVhZGVyc05hbWVzWyBsbmFtZSBdID0gcmVxdWVzdEhlYWRlcnNOYW1lc1sgbG5hbWUgXSB8fCBuYW1lOwoJCQkJCQlyZXF1ZXN0SGVhZGVyc1sgbmFtZSBdID0gdmFsdWU7CgkJCQkJfQoJCQkJCXJldHVybiB0aGlzOwoJCQkJfSwKCgkJCQkvLyBPdmVycmlkZXMgcmVzcG9uc2UgY29udGVudC10eXBlIGhlYWRlcgoJCQkJb3ZlcnJpZGVNaW1lVHlwZTogZnVuY3Rpb24oIHR5cGUgKSB7CgkJCQkJaWYgKCAhc3RhdGUgKSB7CgkJCQkJCXMubWltZVR5cGUgPSB0eXBlOwoJCQkJCX0KCQkJCQlyZXR1cm4gdGhpczsKCQkJCX0sCgoJCQkJLy8gU3RhdHVzLWRlcGVuZGVudCBjYWxsYmFja3MKCQkJCXN0YXR1c0NvZGU6IGZ1bmN0aW9uKCBtYXAgKSB7CgkJCQkJdmFyIGNvZGU7CgkJCQkJaWYgKCBtYXAgKSB7CgkJCQkJCWlmICggc3RhdGUgPCAyICkgewoJCQkJCQkJZm9yICggY29kZSBpbiBtYXAgKSB7CgkJCQkJCQkJLy8gTGF6eS1hZGQgdGhlIG5ldyBjYWxsYmFjayBpbiBhIHdheSB0aGF0IHByZXNlcnZlcyBvbGQgb25lcwoJCQkJCQkJCXN0YXR1c0NvZGVbIGNvZGUgXSA9IFsgc3RhdHVzQ29kZVsgY29kZSBdLCBtYXBbIGNvZGUgXSBdOwoJCQkJCQkJfQoJCQkJCQl9IGVsc2UgewoJCQkJCQkJLy8gRXhlY3V0ZSB0aGUgYXBwcm9wcmlhdGUgY2FsbGJhY2tzCgkJCQkJCQlqcVhIUi5hbHdheXMoIG1hcFsganFYSFIuc3RhdHVzIF0gKTsKCQkJCQkJfQoJCQkJCX0KCQkJCQlyZXR1cm4gdGhpczsKCQkJCX0sCgoJCQkJLy8gQ2FuY2VsIHRoZSByZXF1ZXN0CgkJCQlhYm9ydDogZnVuY3Rpb24oIHN0YXR1c1RleHQgKSB7CgkJCQkJdmFyIGZpbmFsVGV4dCA9IHN0YXR1c1RleHQgfHwgc3RyQWJvcnQ7CgkJCQkJaWYgKCB0cmFuc3BvcnQgKSB7CgkJCQkJCXRyYW5zcG9ydC5hYm9ydCggZmluYWxUZXh0ICk7CgkJCQkJfQoJCQkJCWRvbmUoIDAsIGZpbmFsVGV4dCApOwoJCQkJCXJldHVybiB0aGlzOwoJCQkJfQoJCQl9OwoKCQkvLyBBdHRhY2ggZGVmZXJyZWRzCgkJZGVmZXJyZWQucHJvbWlzZSgganFYSFIgKS5jb21wbGV0ZSA9IGNvbXBsZXRlRGVmZXJyZWQuYWRkOwoJCWpxWEhSLnN1Y2Nlc3MgPSBqcVhIUi5kb25lOwoJCWpxWEhSLmVycm9yID0ganFYSFIuZmFpbDsKCgkJLy8gUmVtb3ZlIGhhc2ggY2hhcmFjdGVyICgjNzUzMTogYW5kIHN0cmluZyBwcm9tb3Rpb24pCgkJLy8gQWRkIHByb3RvY29sIGlmIG5vdCBwcm92aWRlZCAoIzU4NjY6IElFNyBpc3N1ZSB3aXRoIHByb3RvY29sLWxlc3MgdXJscykKCQkvLyBIYW5kbGUgZmFsc3kgdXJsIGluIHRoZSBzZXR0aW5ncyBvYmplY3QgKCMxMDA5MzogY29uc2lzdGVuY3kgd2l0aCBvbGQgc2lnbmF0dXJlKQoJCS8vIFdlIGFsc28gdXNlIHRoZSB1cmwgcGFyYW1ldGVyIGlmIGF2YWlsYWJsZQoJCXMudXJsID0gKCAoIHVybCB8fCBzLnVybCB8fCBhamF4TG9jYXRpb24gKSArICIiICkucmVwbGFjZSggcmhhc2gsICIiICkucmVwbGFjZSggcnByb3RvY29sLCBhamF4TG9jUGFydHNbIDEgXSArICIvLyIgKTsKCgkJLy8gQWxpYXMgbWV0aG9kIG9wdGlvbiB0byB0eXBlIGFzIHBlciB0aWNrZXQgIzEyMDA0CgkJcy50eXBlID0gb3B0aW9ucy5tZXRob2QgfHwgb3B0aW9ucy50eXBlIHx8IHMubWV0aG9kIHx8IHMudHlwZTsKCgkJLy8gRXh0cmFjdCBkYXRhVHlwZXMgbGlzdAoJCXMuZGF0YVR5cGVzID0galF1ZXJ5LnRyaW0oIHMuZGF0YVR5cGUgfHwgIioiICkudG9Mb3dlckNhc2UoKS5tYXRjaCggY29yZV9ybm90d2hpdGUgKSB8fCBbIiJdOwoKCQkvLyBBIGNyb3NzLWRvbWFpbiByZXF1ZXN0IGlzIGluIG9yZGVyIHdoZW4gd2UgaGF2ZSBhIHByb3RvY29sOmhvc3Q6cG9ydCBtaXNtYXRjaAoJCWlmICggcy5jcm9zc0RvbWFpbiA9PSBudWxsICkgewoJCQlwYXJ0cyA9IHJ1cmwuZXhlYyggcy51cmwudG9Mb3dlckNhc2UoKSApOwoJCQlzLmNyb3NzRG9tYWluID0gISEoIHBhcnRzICYmCgkJCQkoIHBhcnRzWyAxIF0gIT09IGFqYXhMb2NQYXJ0c1sgMSBdIHx8IHBhcnRzWyAyIF0gIT09IGFqYXhMb2NQYXJ0c1sgMiBdIHx8CgkJCQkJKCBwYXJ0c1sgMyBdIHx8ICggcGFydHNbIDEgXSA9PT0gImh0dHA6IiA/IDgwIDogNDQzICkgKSAhPQoJCQkJCQkoIGFqYXhMb2NQYXJ0c1sgMyBdIHx8ICggYWpheExvY1BhcnRzWyAxIF0gPT09ICJodHRwOiIgPyA4MCA6IDQ0MyApICkgKQoJCQkpOwoJCX0KCgkJLy8gQ29udmVydCBkYXRhIGlmIG5vdCBhbHJlYWR5IGEgc3RyaW5nCgkJaWYgKCBzLmRhdGEgJiYgcy5wcm9jZXNzRGF0YSAmJiB0eXBlb2Ygcy5kYXRhICE9PSAic3RyaW5nIiApIHsKCQkJcy5kYXRhID0galF1ZXJ5LnBhcmFtKCBzLmRhdGEsIHMudHJhZGl0aW9uYWwgKTsKCQl9CgoJCS8vIEFwcGx5IHByZWZpbHRlcnMKCQlpbnNwZWN0UHJlZmlsdGVyc09yVHJhbnNwb3J0cyggcHJlZmlsdGVycywgcywgb3B0aW9ucywganFYSFIgKTsKCgkJLy8gSWYgcmVxdWVzdCB3YXMgYWJvcnRlZCBpbnNpZGUgYSBwcmVmaWx0ZXIsIHN0b3AgdGhlcmUKCQlpZiAoIHN0YXRlID09PSAyICkgewoJCQlyZXR1cm4ganFYSFI7CgkJfQoKCQkvLyBXZSBjYW4gZmlyZSBnbG9iYWwgZXZlbnRzIGFzIG9mIG5vdyBpZiBhc2tlZCB0bwoJCWZpcmVHbG9iYWxzID0gcy5nbG9iYWw7CgoJCS8vIFdhdGNoIGZvciBhIG5ldyBzZXQgb2YgcmVxdWVzdHMKCQlpZiAoIGZpcmVHbG9iYWxzICYmIGpRdWVyeS5hY3RpdmUrKyA9PT0gMCApIHsKCQkJalF1ZXJ5LmV2ZW50LnRyaWdnZXIoImFqYXhTdGFydCIpOwoJCX0KCgkJLy8gVXBwZXJjYXNlIHRoZSB0eXBlCgkJcy50eXBlID0gcy50eXBlLnRvVXBwZXJDYXNlKCk7CgoJCS8vIERldGVybWluZSBpZiByZXF1ZXN0IGhhcyBjb250ZW50CgkJcy5oYXNDb250ZW50ID0gIXJub0NvbnRlbnQudGVzdCggcy50eXBlICk7CgoJCS8vIFNhdmUgdGhlIFVSTCBpbiBjYXNlIHdlJ3JlIHRveWluZyB3aXRoIHRoZSBJZi1Nb2RpZmllZC1TaW5jZQoJCS8vIGFuZC9vciBJZi1Ob25lLU1hdGNoIGhlYWRlciBsYXRlciBvbgoJCWNhY2hlVVJMID0gcy51cmw7CgoJCS8vIE1vcmUgb3B0aW9ucyBoYW5kbGluZyBmb3IgcmVxdWVzdHMgd2l0aCBubyBjb250ZW50CgkJaWYgKCAhcy5oYXNDb250ZW50ICkgewoKCQkJLy8gSWYgZGF0YSBpcyBhdmFpbGFibGUsIGFwcGVuZCBkYXRhIHRvIHVybAoJCQlpZiAoIHMuZGF0YSApIHsKCQkJCWNhY2hlVVJMID0gKCBzLnVybCArPSAoIGFqYXhfcnF1ZXJ5LnRlc3QoIGNhY2hlVVJMICkgPyAiJiIgOiAiPyIgKSArIHMuZGF0YSApOwoJCQkJLy8gIzk2ODI6IHJlbW92ZSBkYXRhIHNvIHRoYXQgaXQncyBub3QgdXNlZCBpbiBhbiBldmVudHVhbCByZXRyeQoJCQkJZGVsZXRlIHMuZGF0YTsKCQkJfQoKCQkJLy8gQWRkIGFudGktY2FjaGUgaW4gdXJsIGlmIG5lZWRlZAoJCQlpZiAoIHMuY2FjaGUgPT09IGZhbHNlICkgewoJCQkJcy51cmwgPSBydHMudGVzdCggY2FjaGVVUkwgKSA/CgoJCQkJCS8vIElmIHRoZXJlIGlzIGFscmVhZHkgYSAnXycgcGFyYW1ldGVyLCBzZXQgaXRzIHZhbHVlCgkJCQkJY2FjaGVVUkwucmVwbGFjZSggcnRzLCAiJDFfPSIgKyBhamF4X25vbmNlKysgKSA6CgoJCQkJCS8vIE90aGVyd2lzZSBhZGQgb25lIHRvIHRoZSBlbmQKCQkJCQljYWNoZVVSTCArICggYWpheF9ycXVlcnkudGVzdCggY2FjaGVVUkwgKSA/ICImIiA6ICI/IiApICsgIl89IiArIGFqYXhfbm9uY2UrKzsKCQkJfQoJCX0KCgkJLy8gU2V0IHRoZSBJZi1Nb2RpZmllZC1TaW5jZSBhbmQvb3IgSWYtTm9uZS1NYXRjaCBoZWFkZXIsIGlmIGluIGlmTW9kaWZpZWQgbW9kZS4KCQlpZiAoIHMuaWZNb2RpZmllZCApIHsKCQkJaWYgKCBqUXVlcnkubGFzdE1vZGlmaWVkWyBjYWNoZVVSTCBdICkgewoJCQkJanFYSFIuc2V0UmVxdWVzdEhlYWRlciggIklmLU1vZGlmaWVkLVNpbmNlIiwgalF1ZXJ5Lmxhc3RNb2RpZmllZFsgY2FjaGVVUkwgXSApOwoJCQl9CgkJCWlmICggalF1ZXJ5LmV0YWdbIGNhY2hlVVJMIF0gKSB7CgkJCQlqcVhIUi5zZXRSZXF1ZXN0SGVhZGVyKCAiSWYtTm9uZS1NYXRjaCIsIGpRdWVyeS5ldGFnWyBjYWNoZVVSTCBdICk7CgkJCX0KCQl9CgoJCS8vIFNldCB0aGUgY29ycmVjdCBoZWFkZXIsIGlmIGRhdGEgaXMgYmVpbmcgc2VudAoJCWlmICggcy5kYXRhICYmIHMuaGFzQ29udGVudCAmJiBzLmNvbnRlbnRUeXBlICE9PSBmYWxzZSB8fCBvcHRpb25zLmNvbnRlbnRUeXBlICkgewoJCQlqcVhIUi5zZXRSZXF1ZXN0SGVhZGVyKCAiQ29udGVudC1UeXBlIiwgcy5jb250ZW50VHlwZSApOwoJCX0KCgkJLy8gU2V0IHRoZSBBY2NlcHRzIGhlYWRlciBmb3IgdGhlIHNlcnZlciwgZGVwZW5kaW5nIG9uIHRoZSBkYXRhVHlwZQoJCWpxWEhSLnNldFJlcXVlc3RIZWFkZXIoCgkJCSJBY2NlcHQiLAoJCQlzLmRhdGFUeXBlc1sgMCBdICYmIHMuYWNjZXB0c1sgcy5kYXRhVHlwZXNbMF0gXSA/CgkJCQlzLmFjY2VwdHNbIHMuZGF0YVR5cGVzWzBdIF0gKyAoIHMuZGF0YVR5cGVzWyAwIF0gIT09ICIqIiA/ICIsICIgKyBhbGxUeXBlcyArICI7IHE9MC4wMSIgOiAiIiApIDoKCQkJCXMuYWNjZXB0c1sgIioiIF0KCQkpOwoKCQkvLyBDaGVjayBmb3IgaGVhZGVycyBvcHRpb24KCQlmb3IgKCBpIGluIHMuaGVhZGVycyApIHsKCQkJanFYSFIuc2V0UmVxdWVzdEhlYWRlciggaSwgcy5oZWFkZXJzWyBpIF0gKTsKCQl9CgoJCS8vIEFsbG93IGN1c3RvbSBoZWFkZXJzL21pbWV0eXBlcyBhbmQgZWFybHkgYWJvcnQKCQlpZiAoIHMuYmVmb3JlU2VuZCAmJiAoIHMuYmVmb3JlU2VuZC5jYWxsKCBjYWxsYmFja0NvbnRleHQsIGpxWEhSLCBzICkgPT09IGZhbHNlIHx8IHN0YXRlID09PSAyICkgKSB7CgkJCS8vIEFib3J0IGlmIG5vdCBkb25lIGFscmVhZHkgYW5kIHJldHVybgoJCQlyZXR1cm4ganFYSFIuYWJvcnQoKTsKCQl9CgoJCS8vIGFib3J0aW5nIGlzIG5vIGxvbmdlciBhIGNhbmNlbGxhdGlvbgoJCXN0ckFib3J0ID0gImFib3J0IjsKCgkJLy8gSW5zdGFsbCBjYWxsYmFja3Mgb24gZGVmZXJyZWRzCgkJZm9yICggaSBpbiB7IHN1Y2Nlc3M6IDEsIGVycm9yOiAxLCBjb21wbGV0ZTogMSB9ICkgewoJCQlqcVhIUlsgaSBdKCBzWyBpIF0gKTsKCQl9CgoJCS8vIEdldCB0cmFuc3BvcnQKCQl0cmFuc3BvcnQgPSBpbnNwZWN0UHJlZmlsdGVyc09yVHJhbnNwb3J0cyggdHJhbnNwb3J0cywgcywgb3B0aW9ucywganFYSFIgKTsKCgkJLy8gSWYgbm8gdHJhbnNwb3J0LCB3ZSBhdXRvLWFib3J0CgkJaWYgKCAhdHJhbnNwb3J0ICkgewoJCQlkb25lKCAtMSwgIk5vIFRyYW5zcG9ydCIgKTsKCQl9IGVsc2UgewoJCQlqcVhIUi5yZWFkeVN0YXRlID0gMTsKCgkJCS8vIFNlbmQgZ2xvYmFsIGV2ZW50CgkJCWlmICggZmlyZUdsb2JhbHMgKSB7CgkJCQlnbG9iYWxFdmVudENvbnRleHQudHJpZ2dlciggImFqYXhTZW5kIiwgWyBqcVhIUiwgcyBdICk7CgkJCX0KCQkJLy8gVGltZW91dAoJCQlpZiAoIHMuYXN5bmMgJiYgcy50aW1lb3V0ID4gMCApIHsKCQkJCXRpbWVvdXRUaW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CgkJCQkJanFYSFIuYWJvcnQoInRpbWVvdXQiKTsKCQkJCX0sIHMudGltZW91dCApOwoJCQl9CgoJCQl0cnkgewoJCQkJc3RhdGUgPSAxOwoJCQkJdHJhbnNwb3J0LnNlbmQoIHJlcXVlc3RIZWFkZXJzLCBkb25lICk7CgkJCX0gY2F0Y2ggKCBlICkgewoJCQkJLy8gUHJvcGFnYXRlIGV4Y2VwdGlvbiBhcyBlcnJvciBpZiBub3QgZG9uZQoJCQkJaWYgKCBzdGF0ZSA8IDIgKSB7CgkJCQkJZG9uZSggLTEsIGUgKTsKCQkJCS8vIFNpbXBseSByZXRocm93IG90aGVyd2lzZQoJCQkJfSBlbHNlIHsKCQkJCQl0aHJvdyBlOwoJCQkJfQoJCQl9CgkJfQoKCQkvLyBDYWxsYmFjayBmb3Igd2hlbiBldmVyeXRoaW5nIGlzIGRvbmUKCQlmdW5jdGlvbiBkb25lKCBzdGF0dXMsIG5hdGl2ZVN0YXR1c1RleHQsIHJlc3BvbnNlcywgaGVhZGVycyApIHsKCQkJdmFyIGlzU3VjY2Vzcywgc3VjY2VzcywgZXJyb3IsIHJlc3BvbnNlLCBtb2RpZmllZCwKCQkJCXN0YXR1c1RleHQgPSBuYXRpdmVTdGF0dXNUZXh0OwoKCQkJLy8gQ2FsbGVkIG9uY2UKCQkJaWYgKCBzdGF0ZSA9PT0gMiApIHsKCQkJCXJldHVybjsKCQkJfQoKCQkJLy8gU3RhdGUgaXMgImRvbmUiIG5vdwoJCQlzdGF0ZSA9IDI7CgoJCQkvLyBDbGVhciB0aW1lb3V0IGlmIGl0IGV4aXN0cwoJCQlpZiAoIHRpbWVvdXRUaW1lciApIHsKCQkJCWNsZWFyVGltZW91dCggdGltZW91dFRpbWVyICk7CgkJCX0KCgkJCS8vIERlcmVmZXJlbmNlIHRyYW5zcG9ydCBmb3IgZWFybHkgZ2FyYmFnZSBjb2xsZWN0aW9uCgkJCS8vIChubyBtYXR0ZXIgaG93IGxvbmcgdGhlIGpxWEhSIG9iamVjdCB3aWxsIGJlIHVzZWQpCgkJCXRyYW5zcG9ydCA9IHVuZGVmaW5lZDsKCgkJCS8vIENhY2hlIHJlc3BvbnNlIGhlYWRlcnMKCQkJcmVzcG9uc2VIZWFkZXJzU3RyaW5nID0gaGVhZGVycyB8fCAiIjsKCgkJCS8vIFNldCByZWFkeVN0YXRlCgkJCWpxWEhSLnJlYWR5U3RhdGUgPSBzdGF0dXMgPiAwID8gNCA6IDA7CgoJCQkvLyBHZXQgcmVzcG9uc2UgZGF0YQoJCQlpZiAoIHJlc3BvbnNlcyApIHsKCQkJCXJlc3BvbnNlID0gYWpheEhhbmRsZVJlc3BvbnNlcyggcywganFYSFIsIHJlc3BvbnNlcyApOwoJCQl9CgoJCQkvLyBJZiBzdWNjZXNzZnVsLCBoYW5kbGUgdHlwZSBjaGFpbmluZwoJCQlpZiAoIHN0YXR1cyA+PSAyMDAgJiYgc3RhdHVzIDwgMzAwIHx8IHN0YXR1cyA9PT0gMzA0ICkgewoKCQkJCS8vIFNldCB0aGUgSWYtTW9kaWZpZWQtU2luY2UgYW5kL29yIElmLU5vbmUtTWF0Y2ggaGVhZGVyLCBpZiBpbiBpZk1vZGlmaWVkIG1vZGUuCgkJCQlpZiAoIHMuaWZNb2RpZmllZCApIHsKCQkJCQltb2RpZmllZCA9IGpxWEhSLmdldFJlc3BvbnNlSGVhZGVyKCJMYXN0LU1vZGlmaWVkIik7CgkJCQkJaWYgKCBtb2RpZmllZCApIHsKCQkJCQkJalF1ZXJ5Lmxhc3RNb2RpZmllZFsgY2FjaGVVUkwgXSA9IG1vZGlmaWVkOwoJCQkJCX0KCQkJCQltb2RpZmllZCA9IGpxWEhSLmdldFJlc3BvbnNlSGVhZGVyKCJldGFnIik7CgkJCQkJaWYgKCBtb2RpZmllZCApIHsKCQkJCQkJalF1ZXJ5LmV0YWdbIGNhY2hlVVJMIF0gPSBtb2RpZmllZDsKCQkJCQl9CgkJCQl9CgoJCQkJLy8gaWYgbm8gY29udGVudAoJCQkJaWYgKCBzdGF0dXMgPT09IDIwNCApIHsKCQkJCQlpc1N1Y2Nlc3MgPSB0cnVlOwoJCQkJCXN0YXR1c1RleHQgPSAibm9jb250ZW50IjsKCgkJCQkvLyBpZiBub3QgbW9kaWZpZWQKCQkJCX0gZWxzZSBpZiAoIHN0YXR1cyA9PT0gMzA0ICkgewoJCQkJCWlzU3VjY2VzcyA9IHRydWU7CgkJCQkJc3RhdHVzVGV4dCA9ICJub3Rtb2RpZmllZCI7CgoJCQkJLy8gSWYgd2UgaGF2ZSBkYXRhLCBsZXQncyBjb252ZXJ0IGl0CgkJCQl9IGVsc2UgewoJCQkJCWlzU3VjY2VzcyA9IGFqYXhDb252ZXJ0KCBzLCByZXNwb25zZSApOwoJCQkJCXN0YXR1c1RleHQgPSBpc1N1Y2Nlc3Muc3RhdGU7CgkJCQkJc3VjY2VzcyA9IGlzU3VjY2Vzcy5kYXRhOwoJCQkJCWVycm9yID0gaXNTdWNjZXNzLmVycm9yOwoJCQkJCWlzU3VjY2VzcyA9ICFlcnJvcjsKCQkJCX0KCQkJfSBlbHNlIHsKCQkJCS8vIFdlIGV4dHJhY3QgZXJyb3IgZnJvbSBzdGF0dXNUZXh0CgkJCQkvLyB0aGVuIG5vcm1hbGl6ZSBzdGF0dXNUZXh0IGFuZCBzdGF0dXMgZm9yIG5vbi1hYm9ydHMKCQkJCWVycm9yID0gc3RhdHVzVGV4dDsKCQkJCWlmICggc3RhdHVzIHx8ICFzdGF0dXNUZXh0ICkgewoJCQkJCXN0YXR1c1RleHQgPSAiZXJyb3IiOwoJCQkJCWlmICggc3RhdHVzIDwgMCApIHsKCQkJCQkJc3RhdHVzID0gMDsKCQkJCQl9CgkJCQl9CgkJCX0KCgkJCS8vIFNldCBkYXRhIGZvciB0aGUgZmFrZSB4aHIgb2JqZWN0CgkJCWpxWEhSLnN0YXR1cyA9IHN0YXR1czsKCQkJanFYSFIuc3RhdHVzVGV4dCA9ICggbmF0aXZlU3RhdHVzVGV4dCB8fCBzdGF0dXNUZXh0ICkgKyAiIjsKCgkJCS8vIFN1Y2Nlc3MvRXJyb3IKCQkJaWYgKCBpc1N1Y2Nlc3MgKSB7CgkJCQlkZWZlcnJlZC5yZXNvbHZlV2l0aCggY2FsbGJhY2tDb250ZXh0LCBbIHN1Y2Nlc3MsIHN0YXR1c1RleHQsIGpxWEhSIF0gKTsKCQkJfSBlbHNlIHsKCQkJCWRlZmVycmVkLnJlamVjdFdpdGgoIGNhbGxiYWNrQ29udGV4dCwgWyBqcVhIUiwgc3RhdHVzVGV4dCwgZXJyb3IgXSApOwoJCQl9CgoJCQkvLyBTdGF0dXMtZGVwZW5kZW50IGNhbGxiYWNrcwoJCQlqcVhIUi5zdGF0dXNDb2RlKCBzdGF0dXNDb2RlICk7CgkJCXN0YXR1c0NvZGUgPSB1bmRlZmluZWQ7CgoJCQlpZiAoIGZpcmVHbG9iYWxzICkgewoJCQkJZ2xvYmFsRXZlbnRDb250ZXh0LnRyaWdnZXIoIGlzU3VjY2VzcyA/ICJhamF4U3VjY2VzcyIgOiAiYWpheEVycm9yIiwKCQkJCQlbIGpxWEhSLCBzLCBpc1N1Y2Nlc3MgPyBzdWNjZXNzIDogZXJyb3IgXSApOwoJCQl9CgoJCQkvLyBDb21wbGV0ZQoJCQljb21wbGV0ZURlZmVycmVkLmZpcmVXaXRoKCBjYWxsYmFja0NvbnRleHQsIFsganFYSFIsIHN0YXR1c1RleHQgXSApOwoKCQkJaWYgKCBmaXJlR2xvYmFscyApIHsKCQkJCWdsb2JhbEV2ZW50Q29udGV4dC50cmlnZ2VyKCAiYWpheENvbXBsZXRlIiwgWyBqcVhIUiwgcyBdICk7CgkJCQkvLyBIYW5kbGUgdGhlIGdsb2JhbCBBSkFYIGNvdW50ZXIKCQkJCWlmICggISggLS1qUXVlcnkuYWN0aXZlICkgKSB7CgkJCQkJalF1ZXJ5LmV2ZW50LnRyaWdnZXIoImFqYXhTdG9wIik7CgkJCQl9CgkJCX0KCQl9CgoJCXJldHVybiBqcVhIUjsKCX0sCgoJZ2V0U2NyaXB0OiBmdW5jdGlvbiggdXJsLCBjYWxsYmFjayApIHsKCQlyZXR1cm4galF1ZXJ5LmdldCggdXJsLCB1bmRlZmluZWQsIGNhbGxiYWNrLCAic2NyaXB0IiApOwoJfSwKCglnZXRKU09OOiBmdW5jdGlvbiggdXJsLCBkYXRhLCBjYWxsYmFjayApIHsKCQlyZXR1cm4galF1ZXJ5LmdldCggdXJsLCBkYXRhLCBjYWxsYmFjaywgImpzb24iICk7Cgl9Cn0pOwoKLyogSGFuZGxlcyByZXNwb25zZXMgdG8gYW4gYWpheCByZXF1ZXN0OgogKiAtIHNldHMgYWxsIHJlc3BvbnNlWFhYIGZpZWxkcyBhY2NvcmRpbmdseQogKiAtIGZpbmRzIHRoZSByaWdodCBkYXRhVHlwZSAobWVkaWF0ZXMgYmV0d2VlbiBjb250ZW50LXR5cGUgYW5kIGV4cGVjdGVkIGRhdGFUeXBlKQogKiAtIHJldHVybnMgdGhlIGNvcnJlc3BvbmRpbmcgcmVzcG9uc2UKICovCmZ1bmN0aW9uIGFqYXhIYW5kbGVSZXNwb25zZXMoIHMsIGpxWEhSLCByZXNwb25zZXMgKSB7Cgl2YXIgZmlyc3REYXRhVHlwZSwgY3QsIGZpbmFsRGF0YVR5cGUsIHR5cGUsCgkJY29udGVudHMgPSBzLmNvbnRlbnRzLAoJCWRhdGFUeXBlcyA9IHMuZGF0YVR5cGVzLAoJCXJlc3BvbnNlRmllbGRzID0gcy5yZXNwb25zZUZpZWxkczsKCgkvLyBGaWxsIHJlc3BvbnNlWFhYIGZpZWxkcwoJZm9yICggdHlwZSBpbiByZXNwb25zZUZpZWxkcyApIHsKCQlpZiAoIHR5cGUgaW4gcmVzcG9uc2VzICkgewoJCQlqcVhIUlsgcmVzcG9uc2VGaWVsZHNbdHlwZV0gXSA9IHJlc3BvbnNlc1sgdHlwZSBdOwoJCX0KCX0KCgkvLyBSZW1vdmUgYXV0byBkYXRhVHlwZSBhbmQgZ2V0IGNvbnRlbnQtdHlwZSBpbiB0aGUgcHJvY2VzcwoJd2hpbGUoIGRhdGFUeXBlc1sgMCBdID09PSAiKiIgKSB7CgkJZGF0YVR5cGVzLnNoaWZ0KCk7CgkJaWYgKCBjdCA9PT0gdW5kZWZpbmVkICkgewoJCQljdCA9IHMubWltZVR5cGUgfHwganFYSFIuZ2V0UmVzcG9uc2VIZWFkZXIoIkNvbnRlbnQtVHlwZSIpOwoJCX0KCX0KCgkvLyBDaGVjayBpZiB3ZSdyZSBkZWFsaW5nIHdpdGggYSBrbm93biBjb250ZW50LXR5cGUKCWlmICggY3QgKSB7CgkJZm9yICggdHlwZSBpbiBjb250ZW50cyApIHsKCQkJaWYgKCBjb250ZW50c1sgdHlwZSBdICYmIGNvbnRlbnRzWyB0eXBlIF0udGVzdCggY3QgKSApIHsKCQkJCWRhdGFUeXBlcy51bnNoaWZ0KCB0eXBlICk7CgkJCQlicmVhazsKCQkJfQoJCX0KCX0KCgkvLyBDaGVjayB0byBzZWUgaWYgd2UgaGF2ZSBhIHJlc3BvbnNlIGZvciB0aGUgZXhwZWN0ZWQgZGF0YVR5cGUKCWlmICggZGF0YVR5cGVzWyAwIF0gaW4gcmVzcG9uc2VzICkgewoJCWZpbmFsRGF0YVR5cGUgPSBkYXRhVHlwZXNbIDAgXTsKCX0gZWxzZSB7CgkJLy8gVHJ5IGNvbnZlcnRpYmxlIGRhdGFUeXBlcwoJCWZvciAoIHR5cGUgaW4gcmVzcG9uc2VzICkgewoJCQlpZiAoICFkYXRhVHlwZXNbIDAgXSB8fCBzLmNvbnZlcnRlcnNbIHR5cGUgKyAiICIgKyBkYXRhVHlwZXNbMF0gXSApIHsKCQkJCWZpbmFsRGF0YVR5cGUgPSB0eXBlOwoJCQkJYnJlYWs7CgkJCX0KCQkJaWYgKCAhZmlyc3REYXRhVHlwZSApIHsKCQkJCWZpcnN0RGF0YVR5cGUgPSB0eXBlOwoJCQl9CgkJfQoJCS8vIE9yIGp1c3QgdXNlIGZpcnN0IG9uZQoJCWZpbmFsRGF0YVR5cGUgPSBmaW5hbERhdGFUeXBlIHx8IGZpcnN0RGF0YVR5cGU7Cgl9CgoJLy8gSWYgd2UgZm91bmQgYSBkYXRhVHlwZQoJLy8gV2UgYWRkIHRoZSBkYXRhVHlwZSB0byB0aGUgbGlzdCBpZiBuZWVkZWQKCS8vIGFuZCByZXR1cm4gdGhlIGNvcnJlc3BvbmRpbmcgcmVzcG9uc2UKCWlmICggZmluYWxEYXRhVHlwZSApIHsKCQlpZiAoIGZpbmFsRGF0YVR5cGUgIT09IGRhdGFUeXBlc1sgMCBdICkgewoJCQlkYXRhVHlwZXMudW5zaGlmdCggZmluYWxEYXRhVHlwZSApOwoJCX0KCQlyZXR1cm4gcmVzcG9uc2VzWyBmaW5hbERhdGFUeXBlIF07Cgl9Cn0KCi8vIENoYWluIGNvbnZlcnNpb25zIGdpdmVuIHRoZSByZXF1ZXN0IGFuZCB0aGUgb3JpZ2luYWwgcmVzcG9uc2UKZnVuY3Rpb24gYWpheENvbnZlcnQoIHMsIHJlc3BvbnNlICkgewoJdmFyIGNvbnYyLCBjdXJyZW50LCBjb252LCB0bXAsCgkJY29udmVydGVycyA9IHt9LAoJCWkgPSAwLAoJCS8vIFdvcmsgd2l0aCBhIGNvcHkgb2YgZGF0YVR5cGVzIGluIGNhc2Ugd2UgbmVlZCB0byBtb2RpZnkgaXQgZm9yIGNvbnZlcnNpb24KCQlkYXRhVHlwZXMgPSBzLmRhdGFUeXBlcy5zbGljZSgpLAoJCXByZXYgPSBkYXRhVHlwZXNbIDAgXTsKCgkvLyBBcHBseSB0aGUgZGF0YUZpbHRlciBpZiBwcm92aWRlZAoJaWYgKCBzLmRhdGFGaWx0ZXIgKSB7CgkJcmVzcG9uc2UgPSBzLmRhdGFGaWx0ZXIoIHJlc3BvbnNlLCBzLmRhdGFUeXBlICk7Cgl9CgoJLy8gQ3JlYXRlIGNvbnZlcnRlcnMgbWFwIHdpdGggbG93ZXJjYXNlZCBrZXlzCglpZiAoIGRhdGFUeXBlc1sgMSBdICkgewoJCWZvciAoIGNvbnYgaW4gcy5jb252ZXJ0ZXJzICkgewoJCQljb252ZXJ0ZXJzWyBjb252LnRvTG93ZXJDYXNlKCkgXSA9IHMuY29udmVydGVyc1sgY29udiBdOwoJCX0KCX0KCgkvLyBDb252ZXJ0IHRvIGVhY2ggc2VxdWVudGlhbCBkYXRhVHlwZSwgdG9sZXJhdGluZyBsaXN0IG1vZGlmaWNhdGlvbgoJZm9yICggOyAoY3VycmVudCA9IGRhdGFUeXBlc1srK2ldKTsgKSB7CgoJCS8vIFRoZXJlJ3Mgb25seSB3b3JrIHRvIGRvIGlmIGN1cnJlbnQgZGF0YVR5cGUgaXMgbm9uLWF1dG8KCQlpZiAoIGN1cnJlbnQgIT09ICIqIiApIHsKCgkJCS8vIENvbnZlcnQgcmVzcG9uc2UgaWYgcHJldiBkYXRhVHlwZSBpcyBub24tYXV0byBhbmQgZGlmZmVycyBmcm9tIGN1cnJlbnQKCQkJaWYgKCBwcmV2ICE9PSAiKiIgJiYgcHJldiAhPT0gY3VycmVudCApIHsKCgkJCQkvLyBTZWVrIGEgZGlyZWN0IGNvbnZlcnRlcgoJCQkJY29udiA9IGNvbnZlcnRlcnNbIHByZXYgKyAiICIgKyBjdXJyZW50IF0gfHwgY29udmVydGVyc1sgIiogIiArIGN1cnJlbnQgXTsKCgkJCQkvLyBJZiBub25lIGZvdW5kLCBzZWVrIGEgcGFpcgoJCQkJaWYgKCAhY29udiApIHsKCQkJCQlmb3IgKCBjb252MiBpbiBjb252ZXJ0ZXJzICkgewoKCQkJCQkJLy8gSWYgY29udjIgb3V0cHV0cyBjdXJyZW50CgkJCQkJCXRtcCA9IGNvbnYyLnNwbGl0KCIgIik7CgkJCQkJCWlmICggdG1wWyAxIF0gPT09IGN1cnJlbnQgKSB7CgoJCQkJCQkJLy8gSWYgcHJldiBjYW4gYmUgY29udmVydGVkIHRvIGFjY2VwdGVkIGlucHV0CgkJCQkJCQljb252ID0gY29udmVydGVyc1sgcHJldiArICIgIiArIHRtcFsgMCBdIF0gfHwKCQkJCQkJCQljb252ZXJ0ZXJzWyAiKiAiICsgdG1wWyAwIF0gXTsKCQkJCQkJCWlmICggY29udiApIHsKCQkJCQkJCQkvLyBDb25kZW5zZSBlcXVpdmFsZW5jZSBjb252ZXJ0ZXJzCgkJCQkJCQkJaWYgKCBjb252ID09PSB0cnVlICkgewoJCQkJCQkJCQljb252ID0gY29udmVydGVyc1sgY29udjIgXTsKCgkJCQkJCQkJLy8gT3RoZXJ3aXNlLCBpbnNlcnQgdGhlIGludGVybWVkaWF0ZSBkYXRhVHlwZQoJCQkJCQkJCX0gZWxzZSBpZiAoIGNvbnZlcnRlcnNbIGNvbnYyIF0gIT09IHRydWUgKSB7CgkJCQkJCQkJCWN1cnJlbnQgPSB0bXBbIDAgXTsKCQkJCQkJCQkJZGF0YVR5cGVzLnNwbGljZSggaS0tLCAwLCBjdXJyZW50ICk7CgkJCQkJCQkJfQoKCQkJCQkJCQlicmVhazsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCQkJCX0KCgkJCQkvLyBBcHBseSBjb252ZXJ0ZXIgKGlmIG5vdCBhbiBlcXVpdmFsZW5jZSkKCQkJCWlmICggY29udiAhPT0gdHJ1ZSApIHsKCgkJCQkJLy8gVW5sZXNzIGVycm9ycyBhcmUgYWxsb3dlZCB0byBidWJibGUsIGNhdGNoIGFuZCByZXR1cm4gdGhlbQoJCQkJCWlmICggY29udiAmJiBzWyJ0aHJvd3MiXSApIHsKCQkJCQkJcmVzcG9uc2UgPSBjb252KCByZXNwb25zZSApOwoJCQkJCX0gZWxzZSB7CgkJCQkJCXRyeSB7CgkJCQkJCQlyZXNwb25zZSA9IGNvbnYoIHJlc3BvbnNlICk7CgkJCQkJCX0gY2F0Y2ggKCBlICkgewoJCQkJCQkJcmV0dXJuIHsgc3RhdGU6ICJwYXJzZXJlcnJvciIsIGVycm9yOiBjb252ID8gZSA6ICJObyBjb252ZXJzaW9uIGZyb20gIiArIHByZXYgKyAiIHRvICIgKyBjdXJyZW50IH07CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCX0KCgkJCS8vIFVwZGF0ZSBwcmV2IGZvciBuZXh0IGl0ZXJhdGlvbgoJCQlwcmV2ID0gY3VycmVudDsKCQl9Cgl9CgoJcmV0dXJuIHsgc3RhdGU6ICJzdWNjZXNzIiwgZGF0YTogcmVzcG9uc2UgfTsKfQovLyBJbnN0YWxsIHNjcmlwdCBkYXRhVHlwZQpqUXVlcnkuYWpheFNldHVwKHsKCWFjY2VwdHM6IHsKCQlzY3JpcHQ6ICJ0ZXh0L2phdmFzY3JpcHQsIGFwcGxpY2F0aW9uL2phdmFzY3JpcHQsIGFwcGxpY2F0aW9uL2VjbWFzY3JpcHQsIGFwcGxpY2F0aW9uL3gtZWNtYXNjcmlwdCIKCX0sCgljb250ZW50czogewoJCXNjcmlwdDogLyg/OmphdmF8ZWNtYSlzY3JpcHQvCgl9LAoJY29udmVydGVyczogewoJCSJ0ZXh0IHNjcmlwdCI6IGZ1bmN0aW9uKCB0ZXh0ICkgewoJCQlqUXVlcnkuZ2xvYmFsRXZhbCggdGV4dCApOwoJCQlyZXR1cm4gdGV4dDsKCQl9Cgl9Cn0pOwoKLy8gSGFuZGxlIGNhY2hlJ3Mgc3BlY2lhbCBjYXNlIGFuZCBnbG9iYWwKalF1ZXJ5LmFqYXhQcmVmaWx0ZXIoICJzY3JpcHQiLCBmdW5jdGlvbiggcyApIHsKCWlmICggcy5jYWNoZSA9PT0gdW5kZWZpbmVkICkgewoJCXMuY2FjaGUgPSBmYWxzZTsKCX0KCWlmICggcy5jcm9zc0RvbWFpbiApIHsKCQlzLnR5cGUgPSAiR0VUIjsKCQlzLmdsb2JhbCA9IGZhbHNlOwoJfQp9KTsKCi8vIEJpbmQgc2NyaXB0IHRhZyBoYWNrIHRyYW5zcG9ydApqUXVlcnkuYWpheFRyYW5zcG9ydCggInNjcmlwdCIsIGZ1bmN0aW9uKHMpIHsKCgkvLyBUaGlzIHRyYW5zcG9ydCBvbmx5IGRlYWxzIHdpdGggY3Jvc3MgZG9tYWluIHJlcXVlc3RzCglpZiAoIHMuY3Jvc3NEb21haW4gKSB7CgoJCXZhciBzY3JpcHQsCgkJCWhlYWQgPSBkb2N1bWVudC5oZWFkIHx8IGpRdWVyeSgiaGVhZCIpWzBdIHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDsKCgkJcmV0dXJuIHsKCgkJCXNlbmQ6IGZ1bmN0aW9uKCBfLCBjYWxsYmFjayApIHsKCgkJCQlzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzY3JpcHQiKTsKCgkJCQlzY3JpcHQuYXN5bmMgPSB0cnVlOwoKCQkJCWlmICggcy5zY3JpcHRDaGFyc2V0ICkgewoJCQkJCXNjcmlwdC5jaGFyc2V0ID0gcy5zY3JpcHRDaGFyc2V0OwoJCQkJfQoKCQkJCXNjcmlwdC5zcmMgPSBzLnVybDsKCgkJCQkvLyBBdHRhY2ggaGFuZGxlcnMgZm9yIGFsbCBicm93c2VycwoJCQkJc2NyaXB0Lm9ubG9hZCA9IHNjcmlwdC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbiggXywgaXNBYm9ydCApIHsKCgkJCQkJaWYgKCBpc0Fib3J0IHx8ICFzY3JpcHQucmVhZHlTdGF0ZSB8fCAvbG9hZGVkfGNvbXBsZXRlLy50ZXN0KCBzY3JpcHQucmVhZHlTdGF0ZSApICkgewoKCQkJCQkJLy8gSGFuZGxlIG1lbW9yeSBsZWFrIGluIElFCgkJCQkJCXNjcmlwdC5vbmxvYWQgPSBzY3JpcHQub25yZWFkeXN0YXRlY2hhbmdlID0gbnVsbDsKCgkJCQkJCS8vIFJlbW92ZSB0aGUgc2NyaXB0CgkJCQkJCWlmICggc2NyaXB0LnBhcmVudE5vZGUgKSB7CgkJCQkJCQlzY3JpcHQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCggc2NyaXB0ICk7CgkJCQkJCX0KCgkJCQkJCS8vIERlcmVmZXJlbmNlIHRoZSBzY3JpcHQKCQkJCQkJc2NyaXB0ID0gbnVsbDsKCgkJCQkJCS8vIENhbGxiYWNrIGlmIG5vdCBhYm9ydAoJCQkJCQlpZiAoICFpc0Fib3J0ICkgewoJCQkJCQkJY2FsbGJhY2soIDIwMCwgInN1Y2Nlc3MiICk7CgkJCQkJCX0KCQkJCQl9CgkJCQl9OwoKCQkJCS8vIENpcmN1bXZlbnQgSUU2IGJ1Z3Mgd2l0aCBiYXNlIGVsZW1lbnRzICgjMjcwOSBhbmQgIzQzNzgpIGJ5IHByZXBlbmRpbmcKCQkJCS8vIFVzZSBuYXRpdmUgRE9NIG1hbmlwdWxhdGlvbiB0byBhdm9pZCBvdXIgZG9tTWFuaXAgQUpBWCB0cmlja2VyeQoJCQkJaGVhZC5pbnNlcnRCZWZvcmUoIHNjcmlwdCwgaGVhZC5maXJzdENoaWxkICk7CgkJCX0sCgoJCQlhYm9ydDogZnVuY3Rpb24oKSB7CgkJCQlpZiAoIHNjcmlwdCApIHsKCQkJCQlzY3JpcHQub25sb2FkKCB1bmRlZmluZWQsIHRydWUgKTsKCQkJCX0KCQkJfQoJCX07Cgl9Cn0pOwp2YXIgb2xkQ2FsbGJhY2tzID0gW10sCglyanNvbnAgPSAvKD0pXD8oPz0mfCQpfFw/XD8vOwoKLy8gRGVmYXVsdCBqc29ucCBzZXR0aW5ncwpqUXVlcnkuYWpheFNldHVwKHsKCWpzb25wOiAiY2FsbGJhY2siLAoJanNvbnBDYWxsYmFjazogZnVuY3Rpb24oKSB7CgkJdmFyIGNhbGxiYWNrID0gb2xkQ2FsbGJhY2tzLnBvcCgpIHx8ICggalF1ZXJ5LmV4cGFuZG8gKyAiXyIgKyAoIGFqYXhfbm9uY2UrKyApICk7CgkJdGhpc1sgY2FsbGJhY2sgXSA9IHRydWU7CgkJcmV0dXJuIGNhbGxiYWNrOwoJfQp9KTsKCi8vIERldGVjdCwgbm9ybWFsaXplIG9wdGlvbnMgYW5kIGluc3RhbGwgY2FsbGJhY2tzIGZvciBqc29ucCByZXF1ZXN0cwpqUXVlcnkuYWpheFByZWZpbHRlciggImpzb24ganNvbnAiLCBmdW5jdGlvbiggcywgb3JpZ2luYWxTZXR0aW5ncywganFYSFIgKSB7CgoJdmFyIGNhbGxiYWNrTmFtZSwgb3ZlcndyaXR0ZW4sIHJlc3BvbnNlQ29udGFpbmVyLAoJCWpzb25Qcm9wID0gcy5qc29ucCAhPT0gZmFsc2UgJiYgKCByanNvbnAudGVzdCggcy51cmwgKSA/CgkJCSJ1cmwiIDoKCQkJdHlwZW9mIHMuZGF0YSA9PT0gInN0cmluZyIgJiYgISggcy5jb250ZW50VHlwZSB8fCAiIiApLmluZGV4T2YoImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCIpICYmIHJqc29ucC50ZXN0KCBzLmRhdGEgKSAmJiAiZGF0YSIKCQkpOwoKCS8vIEhhbmRsZSBpZmYgdGhlIGV4cGVjdGVkIGRhdGEgdHlwZSBpcyAianNvbnAiIG9yIHdlIGhhdmUgYSBwYXJhbWV0ZXIgdG8gc2V0CglpZiAoIGpzb25Qcm9wIHx8IHMuZGF0YVR5cGVzWyAwIF0gPT09ICJqc29ucCIgKSB7CgoJCS8vIEdldCBjYWxsYmFjayBuYW1lLCByZW1lbWJlcmluZyBwcmVleGlzdGluZyB2YWx1ZSBhc3NvY2lhdGVkIHdpdGggaXQKCQljYWxsYmFja05hbWUgPSBzLmpzb25wQ2FsbGJhY2sgPSBqUXVlcnkuaXNGdW5jdGlvbiggcy5qc29ucENhbGxiYWNrICkgPwoJCQlzLmpzb25wQ2FsbGJhY2soKSA6CgkJCXMuanNvbnBDYWxsYmFjazsKCgkJLy8gSW5zZXJ0IGNhbGxiYWNrIGludG8gdXJsIG9yIGZvcm0gZGF0YQoJCWlmICgganNvblByb3AgKSB7CgkJCXNbIGpzb25Qcm9wIF0gPSBzWyBqc29uUHJvcCBdLnJlcGxhY2UoIHJqc29ucCwgIiQxIiArIGNhbGxiYWNrTmFtZSApOwoJCX0gZWxzZSBpZiAoIHMuanNvbnAgIT09IGZhbHNlICkgewoJCQlzLnVybCArPSAoIGFqYXhfcnF1ZXJ5LnRlc3QoIHMudXJsICkgPyAiJiIgOiAiPyIgKSArIHMuanNvbnAgKyAiPSIgKyBjYWxsYmFja05hbWU7CgkJfQoKCQkvLyBVc2UgZGF0YSBjb252ZXJ0ZXIgdG8gcmV0cmlldmUganNvbiBhZnRlciBzY3JpcHQgZXhlY3V0aW9uCgkJcy5jb252ZXJ0ZXJzWyJzY3JpcHQganNvbiJdID0gZnVuY3Rpb24oKSB7CgkJCWlmICggIXJlc3BvbnNlQ29udGFpbmVyICkgewoJCQkJalF1ZXJ5LmVycm9yKCBjYWxsYmFja05hbWUgKyAiIHdhcyBub3QgY2FsbGVkIiApOwoJCQl9CgkJCXJldHVybiByZXNwb25zZUNvbnRhaW5lclsgMCBdOwoJCX07CgoJCS8vIGZvcmNlIGpzb24gZGF0YVR5cGUKCQlzLmRhdGFUeXBlc1sgMCBdID0gImpzb24iOwoKCQkvLyBJbnN0YWxsIGNhbGxiYWNrCgkJb3ZlcndyaXR0ZW4gPSB3aW5kb3dbIGNhbGxiYWNrTmFtZSBdOwoJCXdpbmRvd1sgY2FsbGJhY2tOYW1lIF0gPSBmdW5jdGlvbigpIHsKCQkJcmVzcG9uc2VDb250YWluZXIgPSBhcmd1bWVudHM7CgkJfTsKCgkJLy8gQ2xlYW4tdXAgZnVuY3Rpb24gKGZpcmVzIGFmdGVyIGNvbnZlcnRlcnMpCgkJanFYSFIuYWx3YXlzKGZ1bmN0aW9uKCkgewoJCQkvLyBSZXN0b3JlIHByZWV4aXN0aW5nIHZhbHVlCgkJCXdpbmRvd1sgY2FsbGJhY2tOYW1lIF0gPSBvdmVyd3JpdHRlbjsKCgkJCS8vIFNhdmUgYmFjayBhcyBmcmVlCgkJCWlmICggc1sgY2FsbGJhY2tOYW1lIF0gKSB7CgkJCQkvLyBtYWtlIHN1cmUgdGhhdCByZS11c2luZyB0aGUgb3B0aW9ucyBkb2Vzbid0IHNjcmV3IHRoaW5ncyBhcm91bmQKCQkJCXMuanNvbnBDYWxsYmFjayA9IG9yaWdpbmFsU2V0dGluZ3MuanNvbnBDYWxsYmFjazsKCgkJCQkvLyBzYXZlIHRoZSBjYWxsYmFjayBuYW1lIGZvciBmdXR1cmUgdXNlCgkJCQlvbGRDYWxsYmFja3MucHVzaCggY2FsbGJhY2tOYW1lICk7CgkJCX0KCgkJCS8vIENhbGwgaWYgaXQgd2FzIGEgZnVuY3Rpb24gYW5kIHdlIGhhdmUgYSByZXNwb25zZQoJCQlpZiAoIHJlc3BvbnNlQ29udGFpbmVyICYmIGpRdWVyeS5pc0Z1bmN0aW9uKCBvdmVyd3JpdHRlbiApICkgewoJCQkJb3ZlcndyaXR0ZW4oIHJlc3BvbnNlQ29udGFpbmVyWyAwIF0gKTsKCQkJfQoKCQkJcmVzcG9uc2VDb250YWluZXIgPSBvdmVyd3JpdHRlbiA9IHVuZGVmaW5lZDsKCQl9KTsKCgkJLy8gRGVsZWdhdGUgdG8gc2NyaXB0CgkJcmV0dXJuICJzY3JpcHQiOwoJfQp9KTsKdmFyIHhockNhbGxiYWNrcywgeGhyU3VwcG9ydGVkLAoJeGhySWQgPSAwLAoJLy8gIzUyODA6IEludGVybmV0IEV4cGxvcmVyIHdpbGwga2VlcCBjb25uZWN0aW9ucyBhbGl2ZSBpZiB3ZSBkb24ndCBhYm9ydCBvbiB1bmxvYWQKCXhock9uVW5sb2FkQWJvcnQgPSB3aW5kb3cuQWN0aXZlWE9iamVjdCAmJiBmdW5jdGlvbigpIHsKCQkvLyBBYm9ydCBhbGwgcGVuZGluZyByZXF1ZXN0cwoJCXZhciBrZXk7CgkJZm9yICgga2V5IGluIHhockNhbGxiYWNrcyApIHsKCQkJeGhyQ2FsbGJhY2tzWyBrZXkgXSggdW5kZWZpbmVkLCB0cnVlICk7CgkJfQoJfTsKCi8vIEZ1bmN0aW9ucyB0byBjcmVhdGUgeGhycwpmdW5jdGlvbiBjcmVhdGVTdGFuZGFyZFhIUigpIHsKCXRyeSB7CgkJcmV0dXJuIG5ldyB3aW5kb3cuWE1MSHR0cFJlcXVlc3QoKTsKCX0gY2F0Y2goIGUgKSB7fQp9CgpmdW5jdGlvbiBjcmVhdGVBY3RpdmVYSFIoKSB7Cgl0cnkgewoJCXJldHVybiBuZXcgd2luZG93LkFjdGl2ZVhPYmplY3QoIk1pY3Jvc29mdC5YTUxIVFRQIik7Cgl9IGNhdGNoKCBlICkge30KfQoKLy8gQ3JlYXRlIHRoZSByZXF1ZXN0IG9iamVjdAovLyAoVGhpcyBpcyBzdGlsbCBhdHRhY2hlZCB0byBhamF4U2V0dGluZ3MgZm9yIGJhY2t3YXJkIGNvbXBhdGliaWxpdHkpCmpRdWVyeS5hamF4U2V0dGluZ3MueGhyID0gd2luZG93LkFjdGl2ZVhPYmplY3QgPwoJLyogTWljcm9zb2Z0IGZhaWxlZCB0byBwcm9wZXJseQoJICogaW1wbGVtZW50IHRoZSBYTUxIdHRwUmVxdWVzdCBpbiBJRTcgKGNhbid0IHJlcXVlc3QgbG9jYWwgZmlsZXMpLAoJICogc28gd2UgdXNlIHRoZSBBY3RpdmVYT2JqZWN0IHdoZW4gaXQgaXMgYXZhaWxhYmxlCgkgKiBBZGRpdGlvbmFsbHkgWE1MSHR0cFJlcXVlc3QgY2FuIGJlIGRpc2FibGVkIGluIElFNy9JRTggc28KCSAqIHdlIG5lZWQgYSBmYWxsYmFjay4KCSAqLwoJZnVuY3Rpb24oKSB7CgkJcmV0dXJuICF0aGlzLmlzTG9jYWwgJiYgY3JlYXRlU3RhbmRhcmRYSFIoKSB8fCBjcmVhdGVBY3RpdmVYSFIoKTsKCX0gOgoJLy8gRm9yIGFsbCBvdGhlciBicm93c2VycywgdXNlIHRoZSBzdGFuZGFyZCBYTUxIdHRwUmVxdWVzdCBvYmplY3QKCWNyZWF0ZVN0YW5kYXJkWEhSOwoKLy8gRGV0ZXJtaW5lIHN1cHBvcnQgcHJvcGVydGllcwp4aHJTdXBwb3J0ZWQgPSBqUXVlcnkuYWpheFNldHRpbmdzLnhocigpOwpqUXVlcnkuc3VwcG9ydC5jb3JzID0gISF4aHJTdXBwb3J0ZWQgJiYgKCAid2l0aENyZWRlbnRpYWxzIiBpbiB4aHJTdXBwb3J0ZWQgKTsKeGhyU3VwcG9ydGVkID0galF1ZXJ5LnN1cHBvcnQuYWpheCA9ICEheGhyU3VwcG9ydGVkOwoKLy8gQ3JlYXRlIHRyYW5zcG9ydCBpZiB0aGUgYnJvd3NlciBjYW4gcHJvdmlkZSBhbiB4aHIKaWYgKCB4aHJTdXBwb3J0ZWQgKSB7CgoJalF1ZXJ5LmFqYXhUcmFuc3BvcnQoZnVuY3Rpb24oIHMgKSB7CgkJLy8gQ3Jvc3MgZG9tYWluIG9ubHkgYWxsb3dlZCBpZiBzdXBwb3J0ZWQgdGhyb3VnaCBYTUxIdHRwUmVxdWVzdAoJCWlmICggIXMuY3Jvc3NEb21haW4gfHwgalF1ZXJ5LnN1cHBvcnQuY29ycyApIHsKCgkJCXZhciBjYWxsYmFjazsKCgkJCXJldHVybiB7CgkJCQlzZW5kOiBmdW5jdGlvbiggaGVhZGVycywgY29tcGxldGUgKSB7CgoJCQkJCS8vIEdldCBhIG5ldyB4aHIKCQkJCQl2YXIgaGFuZGxlLCBpLAoJCQkJCQl4aHIgPSBzLnhocigpOwoKCQkJCQkvLyBPcGVuIHRoZSBzb2NrZXQKCQkJCQkvLyBQYXNzaW5nIG51bGwgdXNlcm5hbWUsIGdlbmVyYXRlcyBhIGxvZ2luIHBvcHVwIG9uIE9wZXJhICgjMjg2NSkKCQkJCQlpZiAoIHMudXNlcm5hbWUgKSB7CgkJCQkJCXhoci5vcGVuKCBzLnR5cGUsIHMudXJsLCBzLmFzeW5jLCBzLnVzZXJuYW1lLCBzLnBhc3N3b3JkICk7CgkJCQkJfSBlbHNlIHsKCQkJCQkJeGhyLm9wZW4oIHMudHlwZSwgcy51cmwsIHMuYXN5bmMgKTsKCQkJCQl9CgoJCQkJCS8vIEFwcGx5IGN1c3RvbSBmaWVsZHMgaWYgcHJvdmlkZWQKCQkJCQlpZiAoIHMueGhyRmllbGRzICkgewoJCQkJCQlmb3IgKCBpIGluIHMueGhyRmllbGRzICkgewoJCQkJCQkJeGhyWyBpIF0gPSBzLnhockZpZWxkc1sgaSBdOwoJCQkJCQl9CgkJCQkJfQoKCQkJCQkvLyBPdmVycmlkZSBtaW1lIHR5cGUgaWYgbmVlZGVkCgkJCQkJaWYgKCBzLm1pbWVUeXBlICYmIHhoci5vdmVycmlkZU1pbWVUeXBlICkgewoJCQkJCQl4aHIub3ZlcnJpZGVNaW1lVHlwZSggcy5taW1lVHlwZSApOwoJCQkJCX0KCgkJCQkJLy8gWC1SZXF1ZXN0ZWQtV2l0aCBoZWFkZXIKCQkJCQkvLyBGb3IgY3Jvc3MtZG9tYWluIHJlcXVlc3RzLCBzZWVpbmcgYXMgY29uZGl0aW9ucyBmb3IgYSBwcmVmbGlnaHQgYXJlCgkJCQkJLy8gYWtpbiB0byBhIGppZ3NhdyBwdXp6bGUsIHdlIHNpbXBseSBuZXZlciBzZXQgaXQgdG8gYmUgc3VyZS4KCQkJCQkvLyAoaXQgY2FuIGFsd2F5cyBiZSBzZXQgb24gYSBwZXItcmVxdWVzdCBiYXNpcyBvciBldmVuIHVzaW5nIGFqYXhTZXR1cCkKCQkJCQkvLyBGb3Igc2FtZS1kb21haW4gcmVxdWVzdHMsIHdvbid0IGNoYW5nZSBoZWFkZXIgaWYgYWxyZWFkeSBwcm92aWRlZC4KCQkJCQlpZiAoICFzLmNyb3NzRG9tYWluICYmICFoZWFkZXJzWyJYLVJlcXVlc3RlZC1XaXRoIl0gKSB7CgkJCQkJCWhlYWRlcnNbIlgtUmVxdWVzdGVkLVdpdGgiXSA9ICJYTUxIdHRwUmVxdWVzdCI7CgkJCQkJfQoKCQkJCQkvLyBOZWVkIGFuIGV4dHJhIHRyeS9jYXRjaCBmb3IgY3Jvc3MgZG9tYWluIHJlcXVlc3RzIGluIEZpcmVmb3ggMwoJCQkJCXRyeSB7CgkJCQkJCWZvciAoIGkgaW4gaGVhZGVycyApIHsKCQkJCQkJCXhoci5zZXRSZXF1ZXN0SGVhZGVyKCBpLCBoZWFkZXJzWyBpIF0gKTsKCQkJCQkJfQoJCQkJCX0gY2F0Y2goIGVyciApIHt9CgoJCQkJCS8vIERvIHNlbmQgdGhlIHJlcXVlc3QKCQkJCQkvLyBUaGlzIG1heSByYWlzZSBhbiBleGNlcHRpb24gd2hpY2ggaXMgYWN0dWFsbHkKCQkJCQkvLyBoYW5kbGVkIGluIGpRdWVyeS5hamF4IChzbyBubyB0cnkvY2F0Y2ggaGVyZSkKCQkJCQl4aHIuc2VuZCggKCBzLmhhc0NvbnRlbnQgJiYgcy5kYXRhICkgfHwgbnVsbCApOwoKCQkJCQkvLyBMaXN0ZW5lcgoJCQkJCWNhbGxiYWNrID0gZnVuY3Rpb24oIF8sIGlzQWJvcnQgKSB7CgkJCQkJCXZhciBzdGF0dXMsIHJlc3BvbnNlSGVhZGVycywgc3RhdHVzVGV4dCwgcmVzcG9uc2VzOwoKCQkJCQkJLy8gRmlyZWZveCB0aHJvd3MgZXhjZXB0aW9ucyB3aGVuIGFjY2Vzc2luZyBwcm9wZXJ0aWVzCgkJCQkJCS8vIG9mIGFuIHhociB3aGVuIGEgbmV0d29yayBlcnJvciBvY2N1cnJlZAoJCQkJCQkvLyBodHRwOi8vaGVscGZ1bC5rbm9icy1kaWFscy5jb20vaW5kZXgucGhwL0NvbXBvbmVudF9yZXR1cm5lZF9mYWlsdXJlX2NvZGU6XzB4ODAwNDAxMTFfKE5TX0VSUk9SX05PVF9BVkFJTEFCTEUpCgkJCQkJCXRyeSB7CgoJCQkJCQkJLy8gV2FzIG5ldmVyIGNhbGxlZCBhbmQgaXMgYWJvcnRlZCBvciBjb21wbGV0ZQoJCQkJCQkJaWYgKCBjYWxsYmFjayAmJiAoIGlzQWJvcnQgfHwgeGhyLnJlYWR5U3RhdGUgPT09IDQgKSApIHsKCgkJCQkJCQkJLy8gT25seSBjYWxsZWQgb25jZQoJCQkJCQkJCWNhbGxiYWNrID0gdW5kZWZpbmVkOwoKCQkJCQkJCQkvLyBEbyBub3Qga2VlcCBhcyBhY3RpdmUgYW55bW9yZQoJCQkJCQkJCWlmICggaGFuZGxlICkgewoJCQkJCQkJCQl4aHIub25yZWFkeXN0YXRlY2hhbmdlID0galF1ZXJ5Lm5vb3A7CgkJCQkJCQkJCWlmICggeGhyT25VbmxvYWRBYm9ydCApIHsKCQkJCQkJCQkJCWRlbGV0ZSB4aHJDYWxsYmFja3NbIGhhbmRsZSBdOwoJCQkJCQkJCQl9CgkJCQkJCQkJfQoKCQkJCQkJCQkvLyBJZiBpdCdzIGFuIGFib3J0CgkJCQkJCQkJaWYgKCBpc0Fib3J0ICkgewoJCQkJCQkJCQkvLyBBYm9ydCBpdCBtYW51YWxseSBpZiBuZWVkZWQKCQkJCQkJCQkJaWYgKCB4aHIucmVhZHlTdGF0ZSAhPT0gNCApIHsKCQkJCQkJCQkJCXhoci5hYm9ydCgpOwoJCQkJCQkJCQl9CgkJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkJcmVzcG9uc2VzID0ge307CgkJCQkJCQkJCXN0YXR1cyA9IHhoci5zdGF0dXM7CgkJCQkJCQkJCXJlc3BvbnNlSGVhZGVycyA9IHhoci5nZXRBbGxSZXNwb25zZUhlYWRlcnMoKTsKCgkJCQkJCQkJCS8vIFdoZW4gcmVxdWVzdGluZyBiaW5hcnkgZGF0YSwgSUU2LTkgd2lsbCB0aHJvdyBhbiBleGNlcHRpb24KCQkJCQkJCQkJLy8gb24gYW55IGF0dGVtcHQgdG8gYWNjZXNzIHJlc3BvbnNlVGV4dCAoIzExNDI2KQoJCQkJCQkJCQlpZiAoIHR5cGVvZiB4aHIucmVzcG9uc2VUZXh0ID09PSAic3RyaW5nIiApIHsKCQkJCQkJCQkJCXJlc3BvbnNlcy50ZXh0ID0geGhyLnJlc3BvbnNlVGV4dDsKCQkJCQkJCQkJfQoKCQkJCQkJCQkJLy8gRmlyZWZveCB0aHJvd3MgYW4gZXhjZXB0aW9uIHdoZW4gYWNjZXNzaW5nCgkJCQkJCQkJCS8vIHN0YXR1c1RleHQgZm9yIGZhdWx0eSBjcm9zcy1kb21haW4gcmVxdWVzdHMKCQkJCQkJCQkJdHJ5IHsKCQkJCQkJCQkJCXN0YXR1c1RleHQgPSB4aHIuc3RhdHVzVGV4dDsKCQkJCQkJCQkJfSBjYXRjaCggZSApIHsKCQkJCQkJCQkJCS8vIFdlIG5vcm1hbGl6ZSB3aXRoIFdlYmtpdCBnaXZpbmcgYW4gZW1wdHkgc3RhdHVzVGV4dAoJCQkJCQkJCQkJc3RhdHVzVGV4dCA9ICIiOwoJCQkJCQkJCQl9CgoJCQkJCQkJCQkvLyBGaWx0ZXIgc3RhdHVzIGZvciBub24gc3RhbmRhcmQgYmVoYXZpb3JzCgoJCQkJCQkJCQkvLyBJZiB0aGUgcmVxdWVzdCBpcyBsb2NhbCBhbmQgd2UgaGF2ZSBkYXRhOiBhc3N1bWUgYSBzdWNjZXNzCgkJCQkJCQkJCS8vIChzdWNjZXNzIHdpdGggbm8gZGF0YSB3b24ndCBnZXQgbm90aWZpZWQsIHRoYXQncyB0aGUgYmVzdCB3ZQoJCQkJCQkJCQkvLyBjYW4gZG8gZ2l2ZW4gY3VycmVudCBpbXBsZW1lbnRhdGlvbnMpCgkJCQkJCQkJCWlmICggIXN0YXR1cyAmJiBzLmlzTG9jYWwgJiYgIXMuY3Jvc3NEb21haW4gKSB7CgkJCQkJCQkJCQlzdGF0dXMgPSByZXNwb25zZXMudGV4dCA/IDIwMCA6IDQwNDsKCQkJCQkJCQkJLy8gSUUgLSAjMTQ1MDogc29tZXRpbWVzIHJldHVybnMgMTIyMyB3aGVuIGl0IHNob3VsZCBiZSAyMDQKCQkJCQkJCQkJfSBlbHNlIGlmICggc3RhdHVzID09PSAxMjIzICkgewoJCQkJCQkJCQkJc3RhdHVzID0gMjA0OwoJCQkJCQkJCQl9CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQl9IGNhdGNoKCBmaXJlZm94QWNjZXNzRXhjZXB0aW9uICkgewoJCQkJCQkJaWYgKCAhaXNBYm9ydCApIHsKCQkJCQkJCQljb21wbGV0ZSggLTEsIGZpcmVmb3hBY2Nlc3NFeGNlcHRpb24gKTsKCQkJCQkJCX0KCQkJCQkJfQoKCQkJCQkJLy8gQ2FsbCBjb21wbGV0ZSBpZiBuZWVkZWQKCQkJCQkJaWYgKCByZXNwb25zZXMgKSB7CgkJCQkJCQljb21wbGV0ZSggc3RhdHVzLCBzdGF0dXNUZXh0LCByZXNwb25zZXMsIHJlc3BvbnNlSGVhZGVycyApOwoJCQkJCQl9CgkJCQkJfTsKCgkJCQkJaWYgKCAhcy5hc3luYyApIHsKCQkJCQkJLy8gaWYgd2UncmUgaW4gc3luYyBtb2RlIHdlIGZpcmUgdGhlIGNhbGxiYWNrCgkJCQkJCWNhbGxiYWNrKCk7CgkJCQkJfSBlbHNlIGlmICggeGhyLnJlYWR5U3RhdGUgPT09IDQgKSB7CgkJCQkJCS8vIChJRTYgJiBJRTcpIGlmIGl0J3MgaW4gY2FjaGUgYW5kIGhhcyBiZWVuCgkJCQkJCS8vIHJldHJpZXZlZCBkaXJlY3RseSB3ZSBuZWVkIHRvIGZpcmUgdGhlIGNhbGxiYWNrCgkJCQkJCXNldFRpbWVvdXQoIGNhbGxiYWNrICk7CgkJCQkJfSBlbHNlIHsKCQkJCQkJaGFuZGxlID0gKyt4aHJJZDsKCQkJCQkJaWYgKCB4aHJPblVubG9hZEFib3J0ICkgewoJCQkJCQkJLy8gQ3JlYXRlIHRoZSBhY3RpdmUgeGhycyBjYWxsYmFja3MgbGlzdCBpZiBuZWVkZWQKCQkJCQkJCS8vIGFuZCBhdHRhY2ggdGhlIHVubG9hZCBoYW5kbGVyCgkJCQkJCQlpZiAoICF4aHJDYWxsYmFja3MgKSB7CgkJCQkJCQkJeGhyQ2FsbGJhY2tzID0ge307CgkJCQkJCQkJalF1ZXJ5KCB3aW5kb3cgKS51bmxvYWQoIHhock9uVW5sb2FkQWJvcnQgKTsKCQkJCQkJCX0KCQkJCQkJCS8vIEFkZCB0byBsaXN0IG9mIGFjdGl2ZSB4aHJzIGNhbGxiYWNrcwoJCQkJCQkJeGhyQ2FsbGJhY2tzWyBoYW5kbGUgXSA9IGNhbGxiYWNrOwoJCQkJCQl9CgkJCQkJCXhoci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBjYWxsYmFjazsKCQkJCQl9CgkJCQl9LAoKCQkJCWFib3J0OiBmdW5jdGlvbigpIHsKCQkJCQlpZiAoIGNhbGxiYWNrICkgewoJCQkJCQljYWxsYmFjayggdW5kZWZpbmVkLCB0cnVlICk7CgkJCQkJfQoJCQkJfQoJCQl9OwoJCX0KCX0pOwp9CnZhciBmeE5vdywgdGltZXJJZCwKCXJmeHR5cGVzID0gL14oPzp0b2dnbGV8c2hvd3xoaWRlKSQvLAoJcmZ4bnVtID0gbmV3IFJlZ0V4cCggIl4oPzooWystXSk9fCkoIiArIGNvcmVfcG51bSArICIpKFthLXolXSopJCIsICJpIiApLAoJcnJ1biA9IC9xdWV1ZUhvb2tzJC8sCglhbmltYXRpb25QcmVmaWx0ZXJzID0gWyBkZWZhdWx0UHJlZmlsdGVyIF0sCgl0d2VlbmVycyA9IHsKCQkiKiI6IFtmdW5jdGlvbiggcHJvcCwgdmFsdWUgKSB7CgkJCXZhciBlbmQsIHVuaXQsCgkJCQl0d2VlbiA9IHRoaXMuY3JlYXRlVHdlZW4oIHByb3AsIHZhbHVlICksCgkJCQlwYXJ0cyA9IHJmeG51bS5leGVjKCB2YWx1ZSApLAoJCQkJdGFyZ2V0ID0gdHdlZW4uY3VyKCksCgkJCQlzdGFydCA9ICt0YXJnZXQgfHwgMCwKCQkJCXNjYWxlID0gMSwKCQkJCW1heEl0ZXJhdGlvbnMgPSAyMDsKCgkJCWlmICggcGFydHMgKSB7CgkJCQllbmQgPSArcGFydHNbMl07CgkJCQl1bml0ID0gcGFydHNbM10gfHwgKCBqUXVlcnkuY3NzTnVtYmVyWyBwcm9wIF0gPyAiIiA6ICJweCIgKTsKCgkJCQkvLyBXZSBuZWVkIHRvIGNvbXB1dGUgc3RhcnRpbmcgdmFsdWUKCQkJCWlmICggdW5pdCAhPT0gInB4IiAmJiBzdGFydCApIHsKCQkJCQkvLyBJdGVyYXRpdmVseSBhcHByb3hpbWF0ZSBmcm9tIGEgbm9uemVybyBzdGFydGluZyBwb2ludAoJCQkJCS8vIFByZWZlciB0aGUgY3VycmVudCBwcm9wZXJ0eSwgYmVjYXVzZSB0aGlzIHByb2Nlc3Mgd2lsbCBiZSB0cml2aWFsIGlmIGl0IHVzZXMgdGhlIHNhbWUgdW5pdHMKCQkJCQkvLyBGYWxsYmFjayB0byBlbmQgb3IgYSBzaW1wbGUgY29uc3RhbnQKCQkJCQlzdGFydCA9IGpRdWVyeS5jc3MoIHR3ZWVuLmVsZW0sIHByb3AsIHRydWUgKSB8fCBlbmQgfHwgMTsKCgkJCQkJZG8gewoJCQkJCQkvLyBJZiBwcmV2aW91cyBpdGVyYXRpb24gemVyb2VkIG91dCwgZG91YmxlIHVudGlsIHdlIGdldCAqc29tZXRoaW5nKgoJCQkJCQkvLyBVc2UgYSBzdHJpbmcgZm9yIGRvdWJsaW5nIGZhY3RvciBzbyB3ZSBkb24ndCBhY2NpZGVudGFsbHkgc2VlIHNjYWxlIGFzIHVuY2hhbmdlZCBiZWxvdwoJCQkJCQlzY2FsZSA9IHNjYWxlIHx8ICIuNSI7CgoJCQkJCQkvLyBBZGp1c3QgYW5kIGFwcGx5CgkJCQkJCXN0YXJ0ID0gc3RhcnQgLyBzY2FsZTsKCQkJCQkJalF1ZXJ5LnN0eWxlKCB0d2Vlbi5lbGVtLCBwcm9wLCBzdGFydCArIHVuaXQgKTsKCgkJCQkJLy8gVXBkYXRlIHNjYWxlLCB0b2xlcmF0aW5nIHplcm8gb3IgTmFOIGZyb20gdHdlZW4uY3VyKCkKCQkJCQkvLyBBbmQgYnJlYWtpbmcgdGhlIGxvb3AgaWYgc2NhbGUgaXMgdW5jaGFuZ2VkIG9yIHBlcmZlY3QsIG9yIGlmIHdlJ3ZlIGp1c3QgaGFkIGVub3VnaAoJCQkJCX0gd2hpbGUgKCBzY2FsZSAhPT0gKHNjYWxlID0gdHdlZW4uY3VyKCkgLyB0YXJnZXQpICYmIHNjYWxlICE9PSAxICYmIC0tbWF4SXRlcmF0aW9ucyApOwoJCQkJfQoKCQkJCXR3ZWVuLnVuaXQgPSB1bml0OwoJCQkJdHdlZW4uc3RhcnQgPSBzdGFydDsKCQkJCS8vIElmIGEgKz0vLT0gdG9rZW4gd2FzIHByb3ZpZGVkLCB3ZSdyZSBkb2luZyBhIHJlbGF0aXZlIGFuaW1hdGlvbgoJCQkJdHdlZW4uZW5kID0gcGFydHNbMV0gPyBzdGFydCArICggcGFydHNbMV0gKyAxICkgKiBlbmQgOiBlbmQ7CgkJCX0KCQkJcmV0dXJuIHR3ZWVuOwoJCX1dCgl9OwoKLy8gQW5pbWF0aW9ucyBjcmVhdGVkIHN5bmNocm9ub3VzbHkgd2lsbCBydW4gc3luY2hyb25vdXNseQpmdW5jdGlvbiBjcmVhdGVGeE5vdygpIHsKCXNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CgkJZnhOb3cgPSB1bmRlZmluZWQ7Cgl9KTsKCXJldHVybiAoIGZ4Tm93ID0galF1ZXJ5Lm5vdygpICk7Cn0KCmZ1bmN0aW9uIGNyZWF0ZVR3ZWVucyggYW5pbWF0aW9uLCBwcm9wcyApIHsKCWpRdWVyeS5lYWNoKCBwcm9wcywgZnVuY3Rpb24oIHByb3AsIHZhbHVlICkgewoJCXZhciBjb2xsZWN0aW9uID0gKCB0d2VlbmVyc1sgcHJvcCBdIHx8IFtdICkuY29uY2F0KCB0d2VlbmVyc1sgIioiIF0gKSwKCQkJaW5kZXggPSAwLAoJCQlsZW5ndGggPSBjb2xsZWN0aW9uLmxlbmd0aDsKCQlmb3IgKCA7IGluZGV4IDwgbGVuZ3RoOyBpbmRleCsrICkgewoJCQlpZiAoIGNvbGxlY3Rpb25bIGluZGV4IF0uY2FsbCggYW5pbWF0aW9uLCBwcm9wLCB2YWx1ZSApICkgewoKCQkJCS8vIHdlJ3JlIGRvbmUgd2l0aCB0aGlzIHByb3BlcnR5CgkJCQlyZXR1cm47CgkJCX0KCQl9Cgl9KTsKfQoKZnVuY3Rpb24gQW5pbWF0aW9uKCBlbGVtLCBwcm9wZXJ0aWVzLCBvcHRpb25zICkgewoJdmFyIHJlc3VsdCwKCQlzdG9wcGVkLAoJCWluZGV4ID0gMCwKCQlsZW5ndGggPSBhbmltYXRpb25QcmVmaWx0ZXJzLmxlbmd0aCwKCQlkZWZlcnJlZCA9IGpRdWVyeS5EZWZlcnJlZCgpLmFsd2F5cyggZnVuY3Rpb24oKSB7CgkJCS8vIGRvbid0IG1hdGNoIGVsZW0gaW4gdGhlIDphbmltYXRlZCBzZWxlY3RvcgoJCQlkZWxldGUgdGljay5lbGVtOwoJCX0pLAoJCXRpY2sgPSBmdW5jdGlvbigpIHsKCQkJaWYgKCBzdG9wcGVkICkgewoJCQkJcmV0dXJuIGZhbHNlOwoJCQl9CgkJCXZhciBjdXJyZW50VGltZSA9IGZ4Tm93IHx8IGNyZWF0ZUZ4Tm93KCksCgkJCQlyZW1haW5pbmcgPSBNYXRoLm1heCggMCwgYW5pbWF0aW9uLnN0YXJ0VGltZSArIGFuaW1hdGlvbi5kdXJhdGlvbiAtIGN1cnJlbnRUaW1lICksCgkJCQkvLyBhcmNoYWljIGNyYXNoIGJ1ZyB3b24ndCBhbGxvdyB1cyB0byB1c2UgMSAtICggMC41IHx8IDAgKSAoIzEyNDk3KQoJCQkJdGVtcCA9IHJlbWFpbmluZyAvIGFuaW1hdGlvbi5kdXJhdGlvbiB8fCAwLAoJCQkJcGVyY2VudCA9IDEgLSB0ZW1wLAoJCQkJaW5kZXggPSAwLAoJCQkJbGVuZ3RoID0gYW5pbWF0aW9uLnR3ZWVucy5sZW5ndGg7CgoJCQlmb3IgKCA7IGluZGV4IDwgbGVuZ3RoIDsgaW5kZXgrKyApIHsKCQkJCWFuaW1hdGlvbi50d2VlbnNbIGluZGV4IF0ucnVuKCBwZXJjZW50ICk7CgkJCX0KCgkJCWRlZmVycmVkLm5vdGlmeVdpdGgoIGVsZW0sIFsgYW5pbWF0aW9uLCBwZXJjZW50LCByZW1haW5pbmcgXSk7CgoJCQlpZiAoIHBlcmNlbnQgPCAxICYmIGxlbmd0aCApIHsKCQkJCXJldHVybiByZW1haW5pbmc7CgkJCX0gZWxzZSB7CgkJCQlkZWZlcnJlZC5yZXNvbHZlV2l0aCggZWxlbSwgWyBhbmltYXRpb24gXSApOwoJCQkJcmV0dXJuIGZhbHNlOwoJCQl9CgkJfSwKCQlhbmltYXRpb24gPSBkZWZlcnJlZC5wcm9taXNlKHsKCQkJZWxlbTogZWxlbSwKCQkJcHJvcHM6IGpRdWVyeS5leHRlbmQoIHt9LCBwcm9wZXJ0aWVzICksCgkJCW9wdHM6IGpRdWVyeS5leHRlbmQoIHRydWUsIHsgc3BlY2lhbEVhc2luZzoge30gfSwgb3B0aW9ucyApLAoJCQlvcmlnaW5hbFByb3BlcnRpZXM6IHByb3BlcnRpZXMsCgkJCW9yaWdpbmFsT3B0aW9uczogb3B0aW9ucywKCQkJc3RhcnRUaW1lOiBmeE5vdyB8fCBjcmVhdGVGeE5vdygpLAoJCQlkdXJhdGlvbjogb3B0aW9ucy5kdXJhdGlvbiwKCQkJdHdlZW5zOiBbXSwKCQkJY3JlYXRlVHdlZW46IGZ1bmN0aW9uKCBwcm9wLCBlbmQgKSB7CgkJCQl2YXIgdHdlZW4gPSBqUXVlcnkuVHdlZW4oIGVsZW0sIGFuaW1hdGlvbi5vcHRzLCBwcm9wLCBlbmQsCgkJCQkJCWFuaW1hdGlvbi5vcHRzLnNwZWNpYWxFYXNpbmdbIHByb3AgXSB8fCBhbmltYXRpb24ub3B0cy5lYXNpbmcgKTsKCQkJCWFuaW1hdGlvbi50d2VlbnMucHVzaCggdHdlZW4gKTsKCQkJCXJldHVybiB0d2VlbjsKCQkJfSwKCQkJc3RvcDogZnVuY3Rpb24oIGdvdG9FbmQgKSB7CgkJCQl2YXIgaW5kZXggPSAwLAoJCQkJCS8vIGlmIHdlIGFyZSBnb2luZyB0byB0aGUgZW5kLCB3ZSB3YW50IHRvIHJ1biBhbGwgdGhlIHR3ZWVucwoJCQkJCS8vIG90aGVyd2lzZSB3ZSBza2lwIHRoaXMgcGFydAoJCQkJCWxlbmd0aCA9IGdvdG9FbmQgPyBhbmltYXRpb24udHdlZW5zLmxlbmd0aCA6IDA7CgkJCQlpZiAoIHN0b3BwZWQgKSB7CgkJCQkJcmV0dXJuIHRoaXM7CgkJCQl9CgkJCQlzdG9wcGVkID0gdHJ1ZTsKCQkJCWZvciAoIDsgaW5kZXggPCBsZW5ndGggOyBpbmRleCsrICkgewoJCQkJCWFuaW1hdGlvbi50d2VlbnNbIGluZGV4IF0ucnVuKCAxICk7CgkJCQl9CgoJCQkJLy8gcmVzb2x2ZSB3aGVuIHdlIHBsYXllZCB0aGUgbGFzdCBmcmFtZQoJCQkJLy8gb3RoZXJ3aXNlLCByZWplY3QKCQkJCWlmICggZ290b0VuZCApIHsKCQkJCQlkZWZlcnJlZC5yZXNvbHZlV2l0aCggZWxlbSwgWyBhbmltYXRpb24sIGdvdG9FbmQgXSApOwoJCQkJfSBlbHNlIHsKCQkJCQlkZWZlcnJlZC5yZWplY3RXaXRoKCBlbGVtLCBbIGFuaW1hdGlvbiwgZ290b0VuZCBdICk7CgkJCQl9CgkJCQlyZXR1cm4gdGhpczsKCQkJfQoJCX0pLAoJCXByb3BzID0gYW5pbWF0aW9uLnByb3BzOwoKCXByb3BGaWx0ZXIoIHByb3BzLCBhbmltYXRpb24ub3B0cy5zcGVjaWFsRWFzaW5nICk7CgoJZm9yICggOyBpbmRleCA8IGxlbmd0aCA7IGluZGV4KysgKSB7CgkJcmVzdWx0ID0gYW5pbWF0aW9uUHJlZmlsdGVyc1sgaW5kZXggXS5jYWxsKCBhbmltYXRpb24sIGVsZW0sIHByb3BzLCBhbmltYXRpb24ub3B0cyApOwoJCWlmICggcmVzdWx0ICkgewoJCQlyZXR1cm4gcmVzdWx0OwoJCX0KCX0KCgljcmVhdGVUd2VlbnMoIGFuaW1hdGlvbiwgcHJvcHMgKTsKCglpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCBhbmltYXRpb24ub3B0cy5zdGFydCApICkgewoJCWFuaW1hdGlvbi5vcHRzLnN0YXJ0LmNhbGwoIGVsZW0sIGFuaW1hdGlvbiApOwoJfQoKCWpRdWVyeS5meC50aW1lcigKCQlqUXVlcnkuZXh0ZW5kKCB0aWNrLCB7CgkJCWVsZW06IGVsZW0sCgkJCWFuaW06IGFuaW1hdGlvbiwKCQkJcXVldWU6IGFuaW1hdGlvbi5vcHRzLnF1ZXVlCgkJfSkKCSk7CgoJLy8gYXR0YWNoIGNhbGxiYWNrcyBmcm9tIG9wdGlvbnMKCXJldHVybiBhbmltYXRpb24ucHJvZ3Jlc3MoIGFuaW1hdGlvbi5vcHRzLnByb2dyZXNzICkKCQkuZG9uZSggYW5pbWF0aW9uLm9wdHMuZG9uZSwgYW5pbWF0aW9uLm9wdHMuY29tcGxldGUgKQoJCS5mYWlsKCBhbmltYXRpb24ub3B0cy5mYWlsICkKCQkuYWx3YXlzKCBhbmltYXRpb24ub3B0cy5hbHdheXMgKTsKfQoKZnVuY3Rpb24gcHJvcEZpbHRlciggcHJvcHMsIHNwZWNpYWxFYXNpbmcgKSB7Cgl2YXIgdmFsdWUsIG5hbWUsIGluZGV4LCBlYXNpbmcsIGhvb2tzOwoKCS8vIGNhbWVsQ2FzZSwgc3BlY2lhbEVhc2luZyBhbmQgZXhwYW5kIGNzc0hvb2sgcGFzcwoJZm9yICggaW5kZXggaW4gcHJvcHMgKSB7CgkJbmFtZSA9IGpRdWVyeS5jYW1lbENhc2UoIGluZGV4ICk7CgkJZWFzaW5nID0gc3BlY2lhbEVhc2luZ1sgbmFtZSBdOwoJCXZhbHVlID0gcHJvcHNbIGluZGV4IF07CgkJaWYgKCBqUXVlcnkuaXNBcnJheSggdmFsdWUgKSApIHsKCQkJZWFzaW5nID0gdmFsdWVbIDEgXTsKCQkJdmFsdWUgPSBwcm9wc1sgaW5kZXggXSA9IHZhbHVlWyAwIF07CgkJfQoKCQlpZiAoIGluZGV4ICE9PSBuYW1lICkgewoJCQlwcm9wc1sgbmFtZSBdID0gdmFsdWU7CgkJCWRlbGV0ZSBwcm9wc1sgaW5kZXggXTsKCQl9CgoJCWhvb2tzID0galF1ZXJ5LmNzc0hvb2tzWyBuYW1lIF07CgkJaWYgKCBob29rcyAmJiAiZXhwYW5kIiBpbiBob29rcyApIHsKCQkJdmFsdWUgPSBob29rcy5leHBhbmQoIHZhbHVlICk7CgkJCWRlbGV0ZSBwcm9wc1sgbmFtZSBdOwoKCQkJLy8gbm90IHF1aXRlICQuZXh0ZW5kLCB0aGlzIHdvbnQgb3ZlcndyaXRlIGtleXMgYWxyZWFkeSBwcmVzZW50LgoJCQkvLyBhbHNvIC0gcmV1c2luZyAnaW5kZXgnIGZyb20gYWJvdmUgYmVjYXVzZSB3ZSBoYXZlIHRoZSBjb3JyZWN0ICJuYW1lIgoJCQlmb3IgKCBpbmRleCBpbiB2YWx1ZSApIHsKCQkJCWlmICggISggaW5kZXggaW4gcHJvcHMgKSApIHsKCQkJCQlwcm9wc1sgaW5kZXggXSA9IHZhbHVlWyBpbmRleCBdOwoJCQkJCXNwZWNpYWxFYXNpbmdbIGluZGV4IF0gPSBlYXNpbmc7CgkJCQl9CgkJCX0KCQl9IGVsc2UgewoJCQlzcGVjaWFsRWFzaW5nWyBuYW1lIF0gPSBlYXNpbmc7CgkJfQoJfQp9CgpqUXVlcnkuQW5pbWF0aW9uID0galF1ZXJ5LmV4dGVuZCggQW5pbWF0aW9uLCB7CgoJdHdlZW5lcjogZnVuY3Rpb24oIHByb3BzLCBjYWxsYmFjayApIHsKCQlpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCBwcm9wcyApICkgewoJCQljYWxsYmFjayA9IHByb3BzOwoJCQlwcm9wcyA9IFsgIioiIF07CgkJfSBlbHNlIHsKCQkJcHJvcHMgPSBwcm9wcy5zcGxpdCgiICIpOwoJCX0KCgkJdmFyIHByb3AsCgkJCWluZGV4ID0gMCwKCQkJbGVuZ3RoID0gcHJvcHMubGVuZ3RoOwoKCQlmb3IgKCA7IGluZGV4IDwgbGVuZ3RoIDsgaW5kZXgrKyApIHsKCQkJcHJvcCA9IHByb3BzWyBpbmRleCBdOwoJCQl0d2VlbmVyc1sgcHJvcCBdID0gdHdlZW5lcnNbIHByb3AgXSB8fCBbXTsKCQkJdHdlZW5lcnNbIHByb3AgXS51bnNoaWZ0KCBjYWxsYmFjayApOwoJCX0KCX0sCgoJcHJlZmlsdGVyOiBmdW5jdGlvbiggY2FsbGJhY2ssIHByZXBlbmQgKSB7CgkJaWYgKCBwcmVwZW5kICkgewoJCQlhbmltYXRpb25QcmVmaWx0ZXJzLnVuc2hpZnQoIGNhbGxiYWNrICk7CgkJfSBlbHNlIHsKCQkJYW5pbWF0aW9uUHJlZmlsdGVycy5wdXNoKCBjYWxsYmFjayApOwoJCX0KCX0KfSk7CgpmdW5jdGlvbiBkZWZhdWx0UHJlZmlsdGVyKCBlbGVtLCBwcm9wcywgb3B0cyApIHsKCS8qanNoaW50IHZhbGlkdGhpczp0cnVlICovCgl2YXIgcHJvcCwgaW5kZXgsIGxlbmd0aCwKCQl2YWx1ZSwgZGF0YVNob3csIHRvZ2dsZSwKCQl0d2VlbiwgaG9va3MsIG9sZGZpcmUsCgkJYW5pbSA9IHRoaXMsCgkJc3R5bGUgPSBlbGVtLnN0eWxlLAoJCW9yaWcgPSB7fSwKCQloYW5kbGVkID0gW10sCgkJaGlkZGVuID0gZWxlbS5ub2RlVHlwZSAmJiBpc0hpZGRlbiggZWxlbSApOwoKCS8vIGhhbmRsZSBxdWV1ZTogZmFsc2UgcHJvbWlzZXMKCWlmICggIW9wdHMucXVldWUgKSB7CgkJaG9va3MgPSBqUXVlcnkuX3F1ZXVlSG9va3MoIGVsZW0sICJmeCIgKTsKCQlpZiAoIGhvb2tzLnVucXVldWVkID09IG51bGwgKSB7CgkJCWhvb2tzLnVucXVldWVkID0gMDsKCQkJb2xkZmlyZSA9IGhvb2tzLmVtcHR5LmZpcmU7CgkJCWhvb2tzLmVtcHR5LmZpcmUgPSBmdW5jdGlvbigpIHsKCQkJCWlmICggIWhvb2tzLnVucXVldWVkICkgewoJCQkJCW9sZGZpcmUoKTsKCQkJCX0KCQkJfTsKCQl9CgkJaG9va3MudW5xdWV1ZWQrKzsKCgkJYW5pbS5hbHdheXMoZnVuY3Rpb24oKSB7CgkJCS8vIGRvaW5nIHRoaXMgbWFrZXMgc3VyZSB0aGF0IHRoZSBjb21wbGV0ZSBoYW5kbGVyIHdpbGwgYmUgY2FsbGVkCgkJCS8vIGJlZm9yZSB0aGlzIGNvbXBsZXRlcwoJCQlhbmltLmFsd2F5cyhmdW5jdGlvbigpIHsKCQkJCWhvb2tzLnVucXVldWVkLS07CgkJCQlpZiAoICFqUXVlcnkucXVldWUoIGVsZW0sICJmeCIgKS5sZW5ndGggKSB7CgkJCQkJaG9va3MuZW1wdHkuZmlyZSgpOwoJCQkJfQoJCQl9KTsKCQl9KTsKCX0KCgkvLyBoZWlnaHQvd2lkdGggb3ZlcmZsb3cgcGFzcwoJaWYgKCBlbGVtLm5vZGVUeXBlID09PSAxICYmICggImhlaWdodCIgaW4gcHJvcHMgfHwgIndpZHRoIiBpbiBwcm9wcyApICkgewoJCS8vIE1ha2Ugc3VyZSB0aGF0IG5vdGhpbmcgc25lYWtzIG91dAoJCS8vIFJlY29yZCBhbGwgMyBvdmVyZmxvdyBhdHRyaWJ1dGVzIGJlY2F1c2UgSUUgZG9lcyBub3QKCQkvLyBjaGFuZ2UgdGhlIG92ZXJmbG93IGF0dHJpYnV0ZSB3aGVuIG92ZXJmbG93WCBhbmQKCQkvLyBvdmVyZmxvd1kgYXJlIHNldCB0byB0aGUgc2FtZSB2YWx1ZQoJCW9wdHMub3ZlcmZsb3cgPSBbIHN0eWxlLm92ZXJmbG93LCBzdHlsZS5vdmVyZmxvd1gsIHN0eWxlLm92ZXJmbG93WSBdOwoKCQkvLyBTZXQgZGlzcGxheSBwcm9wZXJ0eSB0byBpbmxpbmUtYmxvY2sgZm9yIGhlaWdodC93aWR0aAoJCS8vIGFuaW1hdGlvbnMgb24gaW5saW5lIGVsZW1lbnRzIHRoYXQgYXJlIGhhdmluZyB3aWR0aC9oZWlnaHQgYW5pbWF0ZWQKCQlpZiAoIGpRdWVyeS5jc3MoIGVsZW0sICJkaXNwbGF5IiApID09PSAiaW5saW5lIiAmJgoJCQkJalF1ZXJ5LmNzcyggZWxlbSwgImZsb2F0IiApID09PSAibm9uZSIgKSB7CgoJCQkvLyBpbmxpbmUtbGV2ZWwgZWxlbWVudHMgYWNjZXB0IGlubGluZS1ibG9jazsKCQkJLy8gYmxvY2stbGV2ZWwgZWxlbWVudHMgbmVlZCB0byBiZSBpbmxpbmUgd2l0aCBsYXlvdXQKCQkJaWYgKCAhalF1ZXJ5LnN1cHBvcnQuaW5saW5lQmxvY2tOZWVkc0xheW91dCB8fCBjc3NfZGVmYXVsdERpc3BsYXkoIGVsZW0ubm9kZU5hbWUgKSA9PT0gImlubGluZSIgKSB7CgkJCQlzdHlsZS5kaXNwbGF5ID0gImlubGluZS1ibG9jayI7CgoJCQl9IGVsc2UgewoJCQkJc3R5bGUuem9vbSA9IDE7CgkJCX0KCQl9Cgl9CgoJaWYgKCBvcHRzLm92ZXJmbG93ICkgewoJCXN0eWxlLm92ZXJmbG93ID0gImhpZGRlbiI7CgkJaWYgKCAhalF1ZXJ5LnN1cHBvcnQuc2hyaW5rV3JhcEJsb2NrcyApIHsKCQkJYW5pbS5hbHdheXMoZnVuY3Rpb24oKSB7CgkJCQlzdHlsZS5vdmVyZmxvdyA9IG9wdHMub3ZlcmZsb3dbIDAgXTsKCQkJCXN0eWxlLm92ZXJmbG93WCA9IG9wdHMub3ZlcmZsb3dbIDEgXTsKCQkJCXN0eWxlLm92ZXJmbG93WSA9IG9wdHMub3ZlcmZsb3dbIDIgXTsKCQkJfSk7CgkJfQoJfQoKCgkvLyBzaG93L2hpZGUgcGFzcwoJZm9yICggaW5kZXggaW4gcHJvcHMgKSB7CgkJdmFsdWUgPSBwcm9wc1sgaW5kZXggXTsKCQlpZiAoIHJmeHR5cGVzLmV4ZWMoIHZhbHVlICkgKSB7CgkJCWRlbGV0ZSBwcm9wc1sgaW5kZXggXTsKCQkJdG9nZ2xlID0gdG9nZ2xlIHx8IHZhbHVlID09PSAidG9nZ2xlIjsKCQkJaWYgKCB2YWx1ZSA9PT0gKCBoaWRkZW4gPyAiaGlkZSIgOiAic2hvdyIgKSApIHsKCQkJCWNvbnRpbnVlOwoJCQl9CgkJCWhhbmRsZWQucHVzaCggaW5kZXggKTsKCQl9Cgl9CgoJbGVuZ3RoID0gaGFuZGxlZC5sZW5ndGg7CglpZiAoIGxlbmd0aCApIHsKCQlkYXRhU2hvdyA9IGpRdWVyeS5fZGF0YSggZWxlbSwgImZ4c2hvdyIgKSB8fCBqUXVlcnkuX2RhdGEoIGVsZW0sICJmeHNob3ciLCB7fSApOwoJCWlmICggImhpZGRlbiIgaW4gZGF0YVNob3cgKSB7CgkJCWhpZGRlbiA9IGRhdGFTaG93LmhpZGRlbjsKCQl9CgoJCS8vIHN0b3JlIHN0YXRlIGlmIGl0cyB0b2dnbGUgLSBlbmFibGVzIC5zdG9wKCkudG9nZ2xlKCkgdG8gInJldmVyc2UiCgkJaWYgKCB0b2dnbGUgKSB7CgkJCWRhdGFTaG93LmhpZGRlbiA9ICFoaWRkZW47CgkJfQoJCWlmICggaGlkZGVuICkgewoJCQlqUXVlcnkoIGVsZW0gKS5zaG93KCk7CgkJfSBlbHNlIHsKCQkJYW5pbS5kb25lKGZ1bmN0aW9uKCkgewoJCQkJalF1ZXJ5KCBlbGVtICkuaGlkZSgpOwoJCQl9KTsKCQl9CgkJYW5pbS5kb25lKGZ1bmN0aW9uKCkgewoJCQl2YXIgcHJvcDsKCQkJalF1ZXJ5Ll9yZW1vdmVEYXRhKCBlbGVtLCAiZnhzaG93IiApOwoJCQlmb3IgKCBwcm9wIGluIG9yaWcgKSB7CgkJCQlqUXVlcnkuc3R5bGUoIGVsZW0sIHByb3AsIG9yaWdbIHByb3AgXSApOwoJCQl9CgkJfSk7CgkJZm9yICggaW5kZXggPSAwIDsgaW5kZXggPCBsZW5ndGggOyBpbmRleCsrICkgewoJCQlwcm9wID0gaGFuZGxlZFsgaW5kZXggXTsKCQkJdHdlZW4gPSBhbmltLmNyZWF0ZVR3ZWVuKCBwcm9wLCBoaWRkZW4gPyBkYXRhU2hvd1sgcHJvcCBdIDogMCApOwoJCQlvcmlnWyBwcm9wIF0gPSBkYXRhU2hvd1sgcHJvcCBdIHx8IGpRdWVyeS5zdHlsZSggZWxlbSwgcHJvcCApOwoKCQkJaWYgKCAhKCBwcm9wIGluIGRhdGFTaG93ICkgKSB7CgkJCQlkYXRhU2hvd1sgcHJvcCBdID0gdHdlZW4uc3RhcnQ7CgkJCQlpZiAoIGhpZGRlbiApIHsKCQkJCQl0d2Vlbi5lbmQgPSB0d2Vlbi5zdGFydDsKCQkJCQl0d2Vlbi5zdGFydCA9IHByb3AgPT09ICJ3aWR0aCIgfHwgcHJvcCA9PT0gImhlaWdodCIgPyAxIDogMDsKCQkJCX0KCQkJfQoJCX0KCX0KfQoKZnVuY3Rpb24gVHdlZW4oIGVsZW0sIG9wdGlvbnMsIHByb3AsIGVuZCwgZWFzaW5nICkgewoJcmV0dXJuIG5ldyBUd2Vlbi5wcm90b3R5cGUuaW5pdCggZWxlbSwgb3B0aW9ucywgcHJvcCwgZW5kLCBlYXNpbmcgKTsKfQpqUXVlcnkuVHdlZW4gPSBUd2VlbjsKClR3ZWVuLnByb3RvdHlwZSA9IHsKCWNvbnN0cnVjdG9yOiBUd2VlbiwKCWluaXQ6IGZ1bmN0aW9uKCBlbGVtLCBvcHRpb25zLCBwcm9wLCBlbmQsIGVhc2luZywgdW5pdCApIHsKCQl0aGlzLmVsZW0gPSBlbGVtOwoJCXRoaXMucHJvcCA9IHByb3A7CgkJdGhpcy5lYXNpbmcgPSBlYXNpbmcgfHwgInN3aW5nIjsKCQl0aGlzLm9wdGlvbnMgPSBvcHRpb25zOwoJCXRoaXMuc3RhcnQgPSB0aGlzLm5vdyA9IHRoaXMuY3VyKCk7CgkJdGhpcy5lbmQgPSBlbmQ7CgkJdGhpcy51bml0ID0gdW5pdCB8fCAoIGpRdWVyeS5jc3NOdW1iZXJbIHByb3AgXSA/ICIiIDogInB4IiApOwoJfSwKCWN1cjogZnVuY3Rpb24oKSB7CgkJdmFyIGhvb2tzID0gVHdlZW4ucHJvcEhvb2tzWyB0aGlzLnByb3AgXTsKCgkJcmV0dXJuIGhvb2tzICYmIGhvb2tzLmdldCA/CgkJCWhvb2tzLmdldCggdGhpcyApIDoKCQkJVHdlZW4ucHJvcEhvb2tzLl9kZWZhdWx0LmdldCggdGhpcyApOwoJfSwKCXJ1bjogZnVuY3Rpb24oIHBlcmNlbnQgKSB7CgkJdmFyIGVhc2VkLAoJCQlob29rcyA9IFR3ZWVuLnByb3BIb29rc1sgdGhpcy5wcm9wIF07CgoJCWlmICggdGhpcy5vcHRpb25zLmR1cmF0aW9uICkgewoJCQl0aGlzLnBvcyA9IGVhc2VkID0galF1ZXJ5LmVhc2luZ1sgdGhpcy5lYXNpbmcgXSgKCQkJCXBlcmNlbnQsIHRoaXMub3B0aW9ucy5kdXJhdGlvbiAqIHBlcmNlbnQsIDAsIDEsIHRoaXMub3B0aW9ucy5kdXJhdGlvbgoJCQkpOwoJCX0gZWxzZSB7CgkJCXRoaXMucG9zID0gZWFzZWQgPSBwZXJjZW50OwoJCX0KCQl0aGlzLm5vdyA9ICggdGhpcy5lbmQgLSB0aGlzLnN0YXJ0ICkgKiBlYXNlZCArIHRoaXMuc3RhcnQ7CgoJCWlmICggdGhpcy5vcHRpb25zLnN0ZXAgKSB7CgkJCXRoaXMub3B0aW9ucy5zdGVwLmNhbGwoIHRoaXMuZWxlbSwgdGhpcy5ub3csIHRoaXMgKTsKCQl9CgoJCWlmICggaG9va3MgJiYgaG9va3Muc2V0ICkgewoJCQlob29rcy5zZXQoIHRoaXMgKTsKCQl9IGVsc2UgewoJCQlUd2Vlbi5wcm9wSG9va3MuX2RlZmF1bHQuc2V0KCB0aGlzICk7CgkJfQoJCXJldHVybiB0aGlzOwoJfQp9OwoKVHdlZW4ucHJvdG90eXBlLmluaXQucHJvdG90eXBlID0gVHdlZW4ucHJvdG90eXBlOwoKVHdlZW4ucHJvcEhvb2tzID0gewoJX2RlZmF1bHQ6IHsKCQlnZXQ6IGZ1bmN0aW9uKCB0d2VlbiApIHsKCQkJdmFyIHJlc3VsdDsKCgkJCWlmICggdHdlZW4uZWxlbVsgdHdlZW4ucHJvcCBdICE9IG51bGwgJiYKCQkJCSghdHdlZW4uZWxlbS5zdHlsZSB8fCB0d2Vlbi5lbGVtLnN0eWxlWyB0d2Vlbi5wcm9wIF0gPT0gbnVsbCkgKSB7CgkJCQlyZXR1cm4gdHdlZW4uZWxlbVsgdHdlZW4ucHJvcCBdOwoJCQl9CgoJCQkvLyBwYXNzaW5nIGFuIGVtcHR5IHN0cmluZyBhcyBhIDNyZCBwYXJhbWV0ZXIgdG8gLmNzcyB3aWxsIGF1dG9tYXRpY2FsbHkKCQkJLy8gYXR0ZW1wdCBhIHBhcnNlRmxvYXQgYW5kIGZhbGxiYWNrIHRvIGEgc3RyaW5nIGlmIHRoZSBwYXJzZSBmYWlscwoJCQkvLyBzbywgc2ltcGxlIHZhbHVlcyBzdWNoIGFzICIxMHB4IiBhcmUgcGFyc2VkIHRvIEZsb2F0LgoJCQkvLyBjb21wbGV4IHZhbHVlcyBzdWNoIGFzICJyb3RhdGUoMXJhZCkiIGFyZSByZXR1cm5lZCBhcyBpcy4KCQkJcmVzdWx0ID0galF1ZXJ5LmNzcyggdHdlZW4uZWxlbSwgdHdlZW4ucHJvcCwgIiIgKTsKCQkJLy8gRW1wdHkgc3RyaW5ncywgbnVsbCwgdW5kZWZpbmVkIGFuZCAiYXV0byIgYXJlIGNvbnZlcnRlZCB0byAwLgoJCQlyZXR1cm4gIXJlc3VsdCB8fCByZXN1bHQgPT09ICJhdXRvIiA/IDAgOiByZXN1bHQ7CgkJfSwKCQlzZXQ6IGZ1bmN0aW9uKCB0d2VlbiApIHsKCQkJLy8gdXNlIHN0ZXAgaG9vayBmb3IgYmFjayBjb21wYXQgLSB1c2UgY3NzSG9vayBpZiBpdHMgdGhlcmUgLSB1c2UgLnN0eWxlIGlmIGl0cwoJCQkvLyBhdmFpbGFibGUgYW5kIHVzZSBwbGFpbiBwcm9wZXJ0aWVzIHdoZXJlIGF2YWlsYWJsZQoJCQlpZiAoIGpRdWVyeS5meC5zdGVwWyB0d2Vlbi5wcm9wIF0gKSB7CgkJCQlqUXVlcnkuZnguc3RlcFsgdHdlZW4ucHJvcCBdKCB0d2VlbiApOwoJCQl9IGVsc2UgaWYgKCB0d2Vlbi5lbGVtLnN0eWxlICYmICggdHdlZW4uZWxlbS5zdHlsZVsgalF1ZXJ5LmNzc1Byb3BzWyB0d2Vlbi5wcm9wIF0gXSAhPSBudWxsIHx8IGpRdWVyeS5jc3NIb29rc1sgdHdlZW4ucHJvcCBdICkgKSB7CgkJCQlqUXVlcnkuc3R5bGUoIHR3ZWVuLmVsZW0sIHR3ZWVuLnByb3AsIHR3ZWVuLm5vdyArIHR3ZWVuLnVuaXQgKTsKCQkJfSBlbHNlIHsKCQkJCXR3ZWVuLmVsZW1bIHR3ZWVuLnByb3AgXSA9IHR3ZWVuLm5vdzsKCQkJfQoJCX0KCX0KfTsKCi8vIFJlbW92ZSBpbiAyLjAgLSB0aGlzIHN1cHBvcnRzIElFOCdzIHBhbmljIGJhc2VkIGFwcHJvYWNoCi8vIHRvIHNldHRpbmcgdGhpbmdzIG9uIGRpc2Nvbm5lY3RlZCBub2RlcwoKVHdlZW4ucHJvcEhvb2tzLnNjcm9sbFRvcCA9IFR3ZWVuLnByb3BIb29rcy5zY3JvbGxMZWZ0ID0gewoJc2V0OiBmdW5jdGlvbiggdHdlZW4gKSB7CgkJaWYgKCB0d2Vlbi5lbGVtLm5vZGVUeXBlICYmIHR3ZWVuLmVsZW0ucGFyZW50Tm9kZSApIHsKCQkJdHdlZW4uZWxlbVsgdHdlZW4ucHJvcCBdID0gdHdlZW4ubm93OwoJCX0KCX0KfTsKCmpRdWVyeS5lYWNoKFsgInRvZ2dsZSIsICJzaG93IiwgImhpZGUiIF0sIGZ1bmN0aW9uKCBpLCBuYW1lICkgewoJdmFyIGNzc0ZuID0galF1ZXJ5LmZuWyBuYW1lIF07CglqUXVlcnkuZm5bIG5hbWUgXSA9IGZ1bmN0aW9uKCBzcGVlZCwgZWFzaW5nLCBjYWxsYmFjayApIHsKCQlyZXR1cm4gc3BlZWQgPT0gbnVsbCB8fCB0eXBlb2Ygc3BlZWQgPT09ICJib29sZWFuIiA/CgkJCWNzc0ZuLmFwcGx5KCB0aGlzLCBhcmd1bWVudHMgKSA6CgkJCXRoaXMuYW5pbWF0ZSggZ2VuRngoIG5hbWUsIHRydWUgKSwgc3BlZWQsIGVhc2luZywgY2FsbGJhY2sgKTsKCX07Cn0pOwoKalF1ZXJ5LmZuLmV4dGVuZCh7CglmYWRlVG86IGZ1bmN0aW9uKCBzcGVlZCwgdG8sIGVhc2luZywgY2FsbGJhY2sgKSB7CgoJCS8vIHNob3cgYW55IGhpZGRlbiBlbGVtZW50cyBhZnRlciBzZXR0aW5nIG9wYWNpdHkgdG8gMAoJCXJldHVybiB0aGlzLmZpbHRlciggaXNIaWRkZW4gKS5jc3MoICJvcGFjaXR5IiwgMCApLnNob3coKQoKCQkJLy8gYW5pbWF0ZSB0byB0aGUgdmFsdWUgc3BlY2lmaWVkCgkJCS5lbmQoKS5hbmltYXRlKHsgb3BhY2l0eTogdG8gfSwgc3BlZWQsIGVhc2luZywgY2FsbGJhY2sgKTsKCX0sCglhbmltYXRlOiBmdW5jdGlvbiggcHJvcCwgc3BlZWQsIGVhc2luZywgY2FsbGJhY2sgKSB7CgkJdmFyIGVtcHR5ID0galF1ZXJ5LmlzRW1wdHlPYmplY3QoIHByb3AgKSwKCQkJb3B0YWxsID0galF1ZXJ5LnNwZWVkKCBzcGVlZCwgZWFzaW5nLCBjYWxsYmFjayApLAoJCQlkb0FuaW1hdGlvbiA9IGZ1bmN0aW9uKCkgewoJCQkJLy8gT3BlcmF0ZSBvbiBhIGNvcHkgb2YgcHJvcCBzbyBwZXItcHJvcGVydHkgZWFzaW5nIHdvbid0IGJlIGxvc3QKCQkJCXZhciBhbmltID0gQW5pbWF0aW9uKCB0aGlzLCBqUXVlcnkuZXh0ZW5kKCB7fSwgcHJvcCApLCBvcHRhbGwgKTsKCQkJCWRvQW5pbWF0aW9uLmZpbmlzaCA9IGZ1bmN0aW9uKCkgewoJCQkJCWFuaW0uc3RvcCggdHJ1ZSApOwoJCQkJfTsKCQkJCS8vIEVtcHR5IGFuaW1hdGlvbnMsIG9yIGZpbmlzaGluZyByZXNvbHZlcyBpbW1lZGlhdGVseQoJCQkJaWYgKCBlbXB0eSB8fCBqUXVlcnkuX2RhdGEoIHRoaXMsICJmaW5pc2giICkgKSB7CgkJCQkJYW5pbS5zdG9wKCB0cnVlICk7CgkJCQl9CgkJCX07CgkJCWRvQW5pbWF0aW9uLmZpbmlzaCA9IGRvQW5pbWF0aW9uOwoKCQlyZXR1cm4gZW1wdHkgfHwgb3B0YWxsLnF1ZXVlID09PSBmYWxzZSA/CgkJCXRoaXMuZWFjaCggZG9BbmltYXRpb24gKSA6CgkJCXRoaXMucXVldWUoIG9wdGFsbC5xdWV1ZSwgZG9BbmltYXRpb24gKTsKCX0sCglzdG9wOiBmdW5jdGlvbiggdHlwZSwgY2xlYXJRdWV1ZSwgZ290b0VuZCApIHsKCQl2YXIgc3RvcFF1ZXVlID0gZnVuY3Rpb24oIGhvb2tzICkgewoJCQl2YXIgc3RvcCA9IGhvb2tzLnN0b3A7CgkJCWRlbGV0ZSBob29rcy5zdG9wOwoJCQlzdG9wKCBnb3RvRW5kICk7CgkJfTsKCgkJaWYgKCB0eXBlb2YgdHlwZSAhPT0gInN0cmluZyIgKSB7CgkJCWdvdG9FbmQgPSBjbGVhclF1ZXVlOwoJCQljbGVhclF1ZXVlID0gdHlwZTsKCQkJdHlwZSA9IHVuZGVmaW5lZDsKCQl9CgkJaWYgKCBjbGVhclF1ZXVlICYmIHR5cGUgIT09IGZhbHNlICkgewoJCQl0aGlzLnF1ZXVlKCB0eXBlIHx8ICJmeCIsIFtdICk7CgkJfQoKCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCQl2YXIgZGVxdWV1ZSA9IHRydWUsCgkJCQlpbmRleCA9IHR5cGUgIT0gbnVsbCAmJiB0eXBlICsgInF1ZXVlSG9va3MiLAoJCQkJdGltZXJzID0galF1ZXJ5LnRpbWVycywKCQkJCWRhdGEgPSBqUXVlcnkuX2RhdGEoIHRoaXMgKTsKCgkJCWlmICggaW5kZXggKSB7CgkJCQlpZiAoIGRhdGFbIGluZGV4IF0gJiYgZGF0YVsgaW5kZXggXS5zdG9wICkgewoJCQkJCXN0b3BRdWV1ZSggZGF0YVsgaW5kZXggXSApOwoJCQkJfQoJCQl9IGVsc2UgewoJCQkJZm9yICggaW5kZXggaW4gZGF0YSApIHsKCQkJCQlpZiAoIGRhdGFbIGluZGV4IF0gJiYgZGF0YVsgaW5kZXggXS5zdG9wICYmIHJydW4udGVzdCggaW5kZXggKSApIHsKCQkJCQkJc3RvcFF1ZXVlKCBkYXRhWyBpbmRleCBdICk7CgkJCQkJfQoJCQkJfQoJCQl9CgoJCQlmb3IgKCBpbmRleCA9IHRpbWVycy5sZW5ndGg7IGluZGV4LS07ICkgewoJCQkJaWYgKCB0aW1lcnNbIGluZGV4IF0uZWxlbSA9PT0gdGhpcyAmJiAodHlwZSA9PSBudWxsIHx8IHRpbWVyc1sgaW5kZXggXS5xdWV1ZSA9PT0gdHlwZSkgKSB7CgkJCQkJdGltZXJzWyBpbmRleCBdLmFuaW0uc3RvcCggZ290b0VuZCApOwoJCQkJCWRlcXVldWUgPSBmYWxzZTsKCQkJCQl0aW1lcnMuc3BsaWNlKCBpbmRleCwgMSApOwoJCQkJfQoJCQl9CgoJCQkvLyBzdGFydCB0aGUgbmV4dCBpbiB0aGUgcXVldWUgaWYgdGhlIGxhc3Qgc3RlcCB3YXNuJ3QgZm9yY2VkCgkJCS8vIHRpbWVycyBjdXJyZW50bHkgd2lsbCBjYWxsIHRoZWlyIGNvbXBsZXRlIGNhbGxiYWNrcywgd2hpY2ggd2lsbCBkZXF1ZXVlCgkJCS8vIGJ1dCBvbmx5IGlmIHRoZXkgd2VyZSBnb3RvRW5kCgkJCWlmICggZGVxdWV1ZSB8fCAhZ290b0VuZCApIHsKCQkJCWpRdWVyeS5kZXF1ZXVlKCB0aGlzLCB0eXBlICk7CgkJCX0KCQl9KTsKCX0sCglmaW5pc2g6IGZ1bmN0aW9uKCB0eXBlICkgewoJCWlmICggdHlwZSAhPT0gZmFsc2UgKSB7CgkJCXR5cGUgPSB0eXBlIHx8ICJmeCI7CgkJfQoJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CgkJCXZhciBpbmRleCwKCQkJCWRhdGEgPSBqUXVlcnkuX2RhdGEoIHRoaXMgKSwKCQkJCXF1ZXVlID0gZGF0YVsgdHlwZSArICJxdWV1ZSIgXSwKCQkJCWhvb2tzID0gZGF0YVsgdHlwZSArICJxdWV1ZUhvb2tzIiBdLAoJCQkJdGltZXJzID0galF1ZXJ5LnRpbWVycywKCQkJCWxlbmd0aCA9IHF1ZXVlID8gcXVldWUubGVuZ3RoIDogMDsKCgkJCS8vIGVuYWJsZSBmaW5pc2hpbmcgZmxhZyBvbiBwcml2YXRlIGRhdGEKCQkJZGF0YS5maW5pc2ggPSB0cnVlOwoKCQkJLy8gZW1wdHkgdGhlIHF1ZXVlIGZpcnN0CgkJCWpRdWVyeS5xdWV1ZSggdGhpcywgdHlwZSwgW10gKTsKCgkJCWlmICggaG9va3MgJiYgaG9va3MuY3VyICYmIGhvb2tzLmN1ci5maW5pc2ggKSB7CgkJCQlob29rcy5jdXIuZmluaXNoLmNhbGwoIHRoaXMgKTsKCQkJfQoKCQkJLy8gbG9vayBmb3IgYW55IGFjdGl2ZSBhbmltYXRpb25zLCBhbmQgZmluaXNoIHRoZW0KCQkJZm9yICggaW5kZXggPSB0aW1lcnMubGVuZ3RoOyBpbmRleC0tOyApIHsKCQkJCWlmICggdGltZXJzWyBpbmRleCBdLmVsZW0gPT09IHRoaXMgJiYgdGltZXJzWyBpbmRleCBdLnF1ZXVlID09PSB0eXBlICkgewoJCQkJCXRpbWVyc1sgaW5kZXggXS5hbmltLnN0b3AoIHRydWUgKTsKCQkJCQl0aW1lcnMuc3BsaWNlKCBpbmRleCwgMSApOwoJCQkJfQoJCQl9CgoJCQkvLyBsb29rIGZvciBhbnkgYW5pbWF0aW9ucyBpbiB0aGUgb2xkIHF1ZXVlIGFuZCBmaW5pc2ggdGhlbQoJCQlmb3IgKCBpbmRleCA9IDA7IGluZGV4IDwgbGVuZ3RoOyBpbmRleCsrICkgewoJCQkJaWYgKCBxdWV1ZVsgaW5kZXggXSAmJiBxdWV1ZVsgaW5kZXggXS5maW5pc2ggKSB7CgkJCQkJcXVldWVbIGluZGV4IF0uZmluaXNoLmNhbGwoIHRoaXMgKTsKCQkJCX0KCQkJfQoKCQkJLy8gdHVybiBvZmYgZmluaXNoaW5nIGZsYWcKCQkJZGVsZXRlIGRhdGEuZmluaXNoOwoJCX0pOwoJfQp9KTsKCi8vIEdlbmVyYXRlIHBhcmFtZXRlcnMgdG8gY3JlYXRlIGEgc3RhbmRhcmQgYW5pbWF0aW9uCmZ1bmN0aW9uIGdlbkZ4KCB0eXBlLCBpbmNsdWRlV2lkdGggKSB7Cgl2YXIgd2hpY2gsCgkJYXR0cnMgPSB7IGhlaWdodDogdHlwZSB9LAoJCWkgPSAwOwoKCS8vIGlmIHdlIGluY2x1ZGUgd2lkdGgsIHN0ZXAgdmFsdWUgaXMgMSB0byBkbyBhbGwgY3NzRXhwYW5kIHZhbHVlcywKCS8vIGlmIHdlIGRvbid0IGluY2x1ZGUgd2lkdGgsIHN0ZXAgdmFsdWUgaXMgMiB0byBza2lwIG92ZXIgTGVmdCBhbmQgUmlnaHQKCWluY2x1ZGVXaWR0aCA9IGluY2x1ZGVXaWR0aD8gMSA6IDA7Cglmb3IoIDsgaSA8IDQgOyBpICs9IDIgLSBpbmNsdWRlV2lkdGggKSB7CgkJd2hpY2ggPSBjc3NFeHBhbmRbIGkgXTsKCQlhdHRyc1sgIm1hcmdpbiIgKyB3aGljaCBdID0gYXR0cnNbICJwYWRkaW5nIiArIHdoaWNoIF0gPSB0eXBlOwoJfQoKCWlmICggaW5jbHVkZVdpZHRoICkgewoJCWF0dHJzLm9wYWNpdHkgPSBhdHRycy53aWR0aCA9IHR5cGU7Cgl9CgoJcmV0dXJuIGF0dHJzOwp9CgovLyBHZW5lcmF0ZSBzaG9ydGN1dHMgZm9yIGN1c3RvbSBhbmltYXRpb25zCmpRdWVyeS5lYWNoKHsKCXNsaWRlRG93bjogZ2VuRngoInNob3ciKSwKCXNsaWRlVXA6IGdlbkZ4KCJoaWRlIiksCglzbGlkZVRvZ2dsZTogZ2VuRngoInRvZ2dsZSIpLAoJZmFkZUluOiB7IG9wYWNpdHk6ICJzaG93IiB9LAoJZmFkZU91dDogeyBvcGFjaXR5OiAiaGlkZSIgfSwKCWZhZGVUb2dnbGU6IHsgb3BhY2l0eTogInRvZ2dsZSIgfQp9LCBmdW5jdGlvbiggbmFtZSwgcHJvcHMgKSB7CglqUXVlcnkuZm5bIG5hbWUgXSA9IGZ1bmN0aW9uKCBzcGVlZCwgZWFzaW5nLCBjYWxsYmFjayApIHsKCQlyZXR1cm4gdGhpcy5hbmltYXRlKCBwcm9wcywgc3BlZWQsIGVhc2luZywgY2FsbGJhY2sgKTsKCX07Cn0pOwoKalF1ZXJ5LnNwZWVkID0gZnVuY3Rpb24oIHNwZWVkLCBlYXNpbmcsIGZuICkgewoJdmFyIG9wdCA9IHNwZWVkICYmIHR5cGVvZiBzcGVlZCA9PT0gIm9iamVjdCIgPyBqUXVlcnkuZXh0ZW5kKCB7fSwgc3BlZWQgKSA6IHsKCQljb21wbGV0ZTogZm4gfHwgIWZuICYmIGVhc2luZyB8fAoJCQlqUXVlcnkuaXNGdW5jdGlvbiggc3BlZWQgKSAmJiBzcGVlZCwKCQlkdXJhdGlvbjogc3BlZWQsCgkJZWFzaW5nOiBmbiAmJiBlYXNpbmcgfHwgZWFzaW5nICYmICFqUXVlcnkuaXNGdW5jdGlvbiggZWFzaW5nICkgJiYgZWFzaW5nCgl9OwoKCW9wdC5kdXJhdGlvbiA9IGpRdWVyeS5meC5vZmYgPyAwIDogdHlwZW9mIG9wdC5kdXJhdGlvbiA9PT0gIm51bWJlciIgPyBvcHQuZHVyYXRpb24gOgoJCW9wdC5kdXJhdGlvbiBpbiBqUXVlcnkuZnguc3BlZWRzID8galF1ZXJ5LmZ4LnNwZWVkc1sgb3B0LmR1cmF0aW9uIF0gOiBqUXVlcnkuZnguc3BlZWRzLl9kZWZhdWx0OwoKCS8vIG5vcm1hbGl6ZSBvcHQucXVldWUgLSB0cnVlL3VuZGVmaW5lZC9udWxsIC0+ICJmeCIKCWlmICggb3B0LnF1ZXVlID09IG51bGwgfHwgb3B0LnF1ZXVlID09PSB0cnVlICkgewoJCW9wdC5xdWV1ZSA9ICJmeCI7Cgl9CgoJLy8gUXVldWVpbmcKCW9wdC5vbGQgPSBvcHQuY29tcGxldGU7CgoJb3B0LmNvbXBsZXRlID0gZnVuY3Rpb24oKSB7CgkJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggb3B0Lm9sZCApICkgewoJCQlvcHQub2xkLmNhbGwoIHRoaXMgKTsKCQl9CgoJCWlmICggb3B0LnF1ZXVlICkgewoJCQlqUXVlcnkuZGVxdWV1ZSggdGhpcywgb3B0LnF1ZXVlICk7CgkJfQoJfTsKCglyZXR1cm4gb3B0Owp9OwoKalF1ZXJ5LmVhc2luZyA9IHsKCWxpbmVhcjogZnVuY3Rpb24oIHAgKSB7CgkJcmV0dXJuIHA7Cgl9LAoJc3dpbmc6IGZ1bmN0aW9uKCBwICkgewoJCXJldHVybiAwLjUgLSBNYXRoLmNvcyggcCpNYXRoLlBJICkgLyAyOwoJfQp9OwoKalF1ZXJ5LnRpbWVycyA9IFtdOwpqUXVlcnkuZnggPSBUd2Vlbi5wcm90b3R5cGUuaW5pdDsKalF1ZXJ5LmZ4LnRpY2sgPSBmdW5jdGlvbigpIHsKCXZhciB0aW1lciwKCQl0aW1lcnMgPSBqUXVlcnkudGltZXJzLAoJCWkgPSAwOwoKCWZ4Tm93ID0galF1ZXJ5Lm5vdygpOwoKCWZvciAoIDsgaSA8IHRpbWVycy5sZW5ndGg7IGkrKyApIHsKCQl0aW1lciA9IHRpbWVyc1sgaSBdOwoJCS8vIENoZWNrcyB0aGUgdGltZXIgaGFzIG5vdCBhbHJlYWR5IGJlZW4gcmVtb3ZlZAoJCWlmICggIXRpbWVyKCkgJiYgdGltZXJzWyBpIF0gPT09IHRpbWVyICkgewoJCQl0aW1lcnMuc3BsaWNlKCBpLS0sIDEgKTsKCQl9Cgl9CgoJaWYgKCAhdGltZXJzLmxlbmd0aCApIHsKCQlqUXVlcnkuZnguc3RvcCgpOwoJfQoJZnhOb3cgPSB1bmRlZmluZWQ7Cn07CgpqUXVlcnkuZngudGltZXIgPSBmdW5jdGlvbiggdGltZXIgKSB7CglpZiAoIHRpbWVyKCkgJiYgalF1ZXJ5LnRpbWVycy5wdXNoKCB0aW1lciApICkgewoJCWpRdWVyeS5meC5zdGFydCgpOwoJfQp9OwoKalF1ZXJ5LmZ4LmludGVydmFsID0gMTM7CgpqUXVlcnkuZnguc3RhcnQgPSBmdW5jdGlvbigpIHsKCWlmICggIXRpbWVySWQgKSB7CgkJdGltZXJJZCA9IHNldEludGVydmFsKCBqUXVlcnkuZngudGljaywgalF1ZXJ5LmZ4LmludGVydmFsICk7Cgl9Cn07CgpqUXVlcnkuZnguc3RvcCA9IGZ1bmN0aW9uKCkgewoJY2xlYXJJbnRlcnZhbCggdGltZXJJZCApOwoJdGltZXJJZCA9IG51bGw7Cn07CgpqUXVlcnkuZnguc3BlZWRzID0gewoJc2xvdzogNjAwLAoJZmFzdDogMjAwLAoJLy8gRGVmYXVsdCBzcGVlZAoJX2RlZmF1bHQ6IDQwMAp9OwoKLy8gQmFjayBDb21wYXQgPDEuOCBleHRlbnNpb24gcG9pbnQKalF1ZXJ5LmZ4LnN0ZXAgPSB7fTsKCmlmICggalF1ZXJ5LmV4cHIgJiYgalF1ZXJ5LmV4cHIuZmlsdGVycyApIHsKCWpRdWVyeS5leHByLmZpbHRlcnMuYW5pbWF0ZWQgPSBmdW5jdGlvbiggZWxlbSApIHsKCQlyZXR1cm4galF1ZXJ5LmdyZXAoalF1ZXJ5LnRpbWVycywgZnVuY3Rpb24oIGZuICkgewoJCQlyZXR1cm4gZWxlbSA9PT0gZm4uZWxlbTsKCQl9KS5sZW5ndGg7Cgl9Owp9CmpRdWVyeS5mbi5vZmZzZXQgPSBmdW5jdGlvbiggb3B0aW9ucyApIHsKCWlmICggYXJndW1lbnRzLmxlbmd0aCApIHsKCQlyZXR1cm4gb3B0aW9ucyA9PT0gdW5kZWZpbmVkID8KCQkJdGhpcyA6CgkJCXRoaXMuZWFjaChmdW5jdGlvbiggaSApIHsKCQkJCWpRdWVyeS5vZmZzZXQuc2V0T2Zmc2V0KCB0aGlzLCBvcHRpb25zLCBpICk7CgkJCX0pOwoJfQoKCXZhciBkb2NFbGVtLCB3aW4sCgkJYm94ID0geyB0b3A6IDAsIGxlZnQ6IDAgfSwKCQllbGVtID0gdGhpc1sgMCBdLAoJCWRvYyA9IGVsZW0gJiYgZWxlbS5vd25lckRvY3VtZW50OwoKCWlmICggIWRvYyApIHsKCQlyZXR1cm47Cgl9CgoJZG9jRWxlbSA9IGRvYy5kb2N1bWVudEVsZW1lbnQ7CgoJLy8gTWFrZSBzdXJlIGl0J3Mgbm90IGEgZGlzY29ubmVjdGVkIERPTSBub2RlCglpZiAoICFqUXVlcnkuY29udGFpbnMoIGRvY0VsZW0sIGVsZW0gKSApIHsKCQlyZXR1cm4gYm94OwoJfQoKCS8vIElmIHdlIGRvbid0IGhhdmUgZ0JDUiwganVzdCB1c2UgMCwwIHJhdGhlciB0aGFuIGVycm9yCgkvLyBCbGFja0JlcnJ5IDUsIGlPUyAzIChvcmlnaW5hbCBpUGhvbmUpCglpZiAoIHR5cGVvZiBlbGVtLmdldEJvdW5kaW5nQ2xpZW50UmVjdCAhPT0gY29yZV9zdHJ1bmRlZmluZWQgKSB7CgkJYm94ID0gZWxlbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKCX0KCXdpbiA9IGdldFdpbmRvdyggZG9jICk7CglyZXR1cm4gewoJCXRvcDogYm94LnRvcCAgKyAoIHdpbi5wYWdlWU9mZnNldCB8fCBkb2NFbGVtLnNjcm9sbFRvcCApICAtICggZG9jRWxlbS5jbGllbnRUb3AgIHx8IDAgKSwKCQlsZWZ0OiBib3gubGVmdCArICggd2luLnBhZ2VYT2Zmc2V0IHx8IGRvY0VsZW0uc2Nyb2xsTGVmdCApIC0gKCBkb2NFbGVtLmNsaWVudExlZnQgfHwgMCApCgl9Owp9OwoKalF1ZXJ5Lm9mZnNldCA9IHsKCglzZXRPZmZzZXQ6IGZ1bmN0aW9uKCBlbGVtLCBvcHRpb25zLCBpICkgewoJCXZhciBwb3NpdGlvbiA9IGpRdWVyeS5jc3MoIGVsZW0sICJwb3NpdGlvbiIgKTsKCgkJLy8gc2V0IHBvc2l0aW9uIGZpcnN0LCBpbi1jYXNlIHRvcC9sZWZ0IGFyZSBzZXQgZXZlbiBvbiBzdGF0aWMgZWxlbQoJCWlmICggcG9zaXRpb24gPT09ICJzdGF0aWMiICkgewoJCQllbGVtLnN0eWxlLnBvc2l0aW9uID0gInJlbGF0aXZlIjsKCQl9CgoJCXZhciBjdXJFbGVtID0galF1ZXJ5KCBlbGVtICksCgkJCWN1ck9mZnNldCA9IGN1ckVsZW0ub2Zmc2V0KCksCgkJCWN1ckNTU1RvcCA9IGpRdWVyeS5jc3MoIGVsZW0sICJ0b3AiICksCgkJCWN1ckNTU0xlZnQgPSBqUXVlcnkuY3NzKCBlbGVtLCAibGVmdCIgKSwKCQkJY2FsY3VsYXRlUG9zaXRpb24gPSAoIHBvc2l0aW9uID09PSAiYWJzb2x1dGUiIHx8IHBvc2l0aW9uID09PSAiZml4ZWQiICkgJiYgalF1ZXJ5LmluQXJyYXkoImF1dG8iLCBbY3VyQ1NTVG9wLCBjdXJDU1NMZWZ0XSkgPiAtMSwKCQkJcHJvcHMgPSB7fSwgY3VyUG9zaXRpb24gPSB7fSwgY3VyVG9wLCBjdXJMZWZ0OwoKCQkvLyBuZWVkIHRvIGJlIGFibGUgdG8gY2FsY3VsYXRlIHBvc2l0aW9uIGlmIGVpdGhlciB0b3Agb3IgbGVmdCBpcyBhdXRvIGFuZCBwb3NpdGlvbiBpcyBlaXRoZXIgYWJzb2x1dGUgb3IgZml4ZWQKCQlpZiAoIGNhbGN1bGF0ZVBvc2l0aW9uICkgewoJCQljdXJQb3NpdGlvbiA9IGN1ckVsZW0ucG9zaXRpb24oKTsKCQkJY3VyVG9wID0gY3VyUG9zaXRpb24udG9wOwoJCQljdXJMZWZ0ID0gY3VyUG9zaXRpb24ubGVmdDsKCQl9IGVsc2UgewoJCQljdXJUb3AgPSBwYXJzZUZsb2F0KCBjdXJDU1NUb3AgKSB8fCAwOwoJCQljdXJMZWZ0ID0gcGFyc2VGbG9hdCggY3VyQ1NTTGVmdCApIHx8IDA7CgkJfQoKCQlpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCBvcHRpb25zICkgKSB7CgkJCW9wdGlvbnMgPSBvcHRpb25zLmNhbGwoIGVsZW0sIGksIGN1ck9mZnNldCApOwoJCX0KCgkJaWYgKCBvcHRpb25zLnRvcCAhPSBudWxsICkgewoJCQlwcm9wcy50b3AgPSAoIG9wdGlvbnMudG9wIC0gY3VyT2Zmc2V0LnRvcCApICsgY3VyVG9wOwoJCX0KCQlpZiAoIG9wdGlvbnMubGVmdCAhPSBudWxsICkgewoJCQlwcm9wcy5sZWZ0ID0gKCBvcHRpb25zLmxlZnQgLSBjdXJPZmZzZXQubGVmdCApICsgY3VyTGVmdDsKCQl9CgoJCWlmICggInVzaW5nIiBpbiBvcHRpb25zICkgewoJCQlvcHRpb25zLnVzaW5nLmNhbGwoIGVsZW0sIHByb3BzICk7CgkJfSBlbHNlIHsKCQkJY3VyRWxlbS5jc3MoIHByb3BzICk7CgkJfQoJfQp9OwoKCmpRdWVyeS5mbi5leHRlbmQoewoKCXBvc2l0aW9uOiBmdW5jdGlvbigpIHsKCQlpZiAoICF0aGlzWyAwIF0gKSB7CgkJCXJldHVybjsKCQl9CgoJCXZhciBvZmZzZXRQYXJlbnQsIG9mZnNldCwKCQkJcGFyZW50T2Zmc2V0ID0geyB0b3A6IDAsIGxlZnQ6IDAgfSwKCQkJZWxlbSA9IHRoaXNbIDAgXTsKCgkJLy8gZml4ZWQgZWxlbWVudHMgYXJlIG9mZnNldCBmcm9tIHdpbmRvdyAocGFyZW50T2Zmc2V0ID0ge3RvcDowLCBsZWZ0OiAwfSwgYmVjYXVzZSBpdCBpcyBpdCdzIG9ubHkgb2Zmc2V0IHBhcmVudAoJCWlmICggalF1ZXJ5LmNzcyggZWxlbSwgInBvc2l0aW9uIiApID09PSAiZml4ZWQiICkgewoJCQkvLyB3ZSBhc3N1bWUgdGhhdCBnZXRCb3VuZGluZ0NsaWVudFJlY3QgaXMgYXZhaWxhYmxlIHdoZW4gY29tcHV0ZWQgcG9zaXRpb24gaXMgZml4ZWQKCQkJb2Zmc2V0ID0gZWxlbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKCQl9IGVsc2UgewoJCQkvLyBHZXQgKnJlYWwqIG9mZnNldFBhcmVudAoJCQlvZmZzZXRQYXJlbnQgPSB0aGlzLm9mZnNldFBhcmVudCgpOwoKCQkJLy8gR2V0IGNvcnJlY3Qgb2Zmc2V0cwoJCQlvZmZzZXQgPSB0aGlzLm9mZnNldCgpOwoJCQlpZiAoICFqUXVlcnkubm9kZU5hbWUoIG9mZnNldFBhcmVudFsgMCBdLCAiaHRtbCIgKSApIHsKCQkJCXBhcmVudE9mZnNldCA9IG9mZnNldFBhcmVudC5vZmZzZXQoKTsKCQkJfQoKCQkJLy8gQWRkIG9mZnNldFBhcmVudCBib3JkZXJzCgkJCXBhcmVudE9mZnNldC50b3AgICs9IGpRdWVyeS5jc3MoIG9mZnNldFBhcmVudFsgMCBdLCAiYm9yZGVyVG9wV2lkdGgiLCB0cnVlICk7CgkJCXBhcmVudE9mZnNldC5sZWZ0ICs9IGpRdWVyeS5jc3MoIG9mZnNldFBhcmVudFsgMCBdLCAiYm9yZGVyTGVmdFdpZHRoIiwgdHJ1ZSApOwoJCX0KCgkJLy8gU3VidHJhY3QgcGFyZW50IG9mZnNldHMgYW5kIGVsZW1lbnQgbWFyZ2lucwoJCS8vIG5vdGU6IHdoZW4gYW4gZWxlbWVudCBoYXMgbWFyZ2luOiBhdXRvIHRoZSBvZmZzZXRMZWZ0IGFuZCBtYXJnaW5MZWZ0CgkJLy8gYXJlIHRoZSBzYW1lIGluIFNhZmFyaSBjYXVzaW5nIG9mZnNldC5sZWZ0IHRvIGluY29ycmVjdGx5IGJlIDAKCQlyZXR1cm4gewoJCQl0b3A6ICBvZmZzZXQudG9wICAtIHBhcmVudE9mZnNldC50b3AgLSBqUXVlcnkuY3NzKCBlbGVtLCAibWFyZ2luVG9wIiwgdHJ1ZSApLAoJCQlsZWZ0OiBvZmZzZXQubGVmdCAtIHBhcmVudE9mZnNldC5sZWZ0IC0galF1ZXJ5LmNzcyggZWxlbSwgIm1hcmdpbkxlZnQiLCB0cnVlKQoJCX07Cgl9LAoKCW9mZnNldFBhcmVudDogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMubWFwKGZ1bmN0aW9uKCkgewoJCQl2YXIgb2Zmc2V0UGFyZW50ID0gdGhpcy5vZmZzZXRQYXJlbnQgfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50OwoJCQl3aGlsZSAoIG9mZnNldFBhcmVudCAmJiAoICFqUXVlcnkubm9kZU5hbWUoIG9mZnNldFBhcmVudCwgImh0bWwiICkgJiYgalF1ZXJ5LmNzcyggb2Zmc2V0UGFyZW50LCAicG9zaXRpb24iKSA9PT0gInN0YXRpYyIgKSApIHsKCQkJCW9mZnNldFBhcmVudCA9IG9mZnNldFBhcmVudC5vZmZzZXRQYXJlbnQ7CgkJCX0KCQkJcmV0dXJuIG9mZnNldFBhcmVudCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7CgkJfSk7Cgl9Cn0pOwoKCi8vIENyZWF0ZSBzY3JvbGxMZWZ0IGFuZCBzY3JvbGxUb3AgbWV0aG9kcwpqUXVlcnkuZWFjaCgge3Njcm9sbExlZnQ6ICJwYWdlWE9mZnNldCIsIHNjcm9sbFRvcDogInBhZ2VZT2Zmc2V0In0sIGZ1bmN0aW9uKCBtZXRob2QsIHByb3AgKSB7Cgl2YXIgdG9wID0gL1kvLnRlc3QoIHByb3AgKTsKCglqUXVlcnkuZm5bIG1ldGhvZCBdID0gZnVuY3Rpb24oIHZhbCApIHsKCQlyZXR1cm4galF1ZXJ5LmFjY2VzcyggdGhpcywgZnVuY3Rpb24oIGVsZW0sIG1ldGhvZCwgdmFsICkgewoJCQl2YXIgd2luID0gZ2V0V2luZG93KCBlbGVtICk7CgoJCQlpZiAoIHZhbCA9PT0gdW5kZWZpbmVkICkgewoJCQkJcmV0dXJuIHdpbiA/IChwcm9wIGluIHdpbikgPyB3aW5bIHByb3AgXSA6CgkJCQkJd2luLmRvY3VtZW50LmRvY3VtZW50RWxlbWVudFsgbWV0aG9kIF0gOgoJCQkJCWVsZW1bIG1ldGhvZCBdOwoJCQl9CgoJCQlpZiAoIHdpbiApIHsKCQkJCXdpbi5zY3JvbGxUbygKCQkJCQkhdG9wID8gdmFsIDogalF1ZXJ5KCB3aW4gKS5zY3JvbGxMZWZ0KCksCgkJCQkJdG9wID8gdmFsIDogalF1ZXJ5KCB3aW4gKS5zY3JvbGxUb3AoKQoJCQkJKTsKCgkJCX0gZWxzZSB7CgkJCQllbGVtWyBtZXRob2QgXSA9IHZhbDsKCQkJfQoJCX0sIG1ldGhvZCwgdmFsLCBhcmd1bWVudHMubGVuZ3RoLCBudWxsICk7Cgl9Owp9KTsKCmZ1bmN0aW9uIGdldFdpbmRvdyggZWxlbSApIHsKCXJldHVybiBqUXVlcnkuaXNXaW5kb3coIGVsZW0gKSA/CgkJZWxlbSA6CgkJZWxlbS5ub2RlVHlwZSA9PT0gOSA/CgkJCWVsZW0uZGVmYXVsdFZpZXcgfHwgZWxlbS5wYXJlbnRXaW5kb3cgOgoJCQlmYWxzZTsKfQovLyBDcmVhdGUgaW5uZXJIZWlnaHQsIGlubmVyV2lkdGgsIGhlaWdodCwgd2lkdGgsIG91dGVySGVpZ2h0IGFuZCBvdXRlcldpZHRoIG1ldGhvZHMKalF1ZXJ5LmVhY2goIHsgSGVpZ2h0OiAiaGVpZ2h0IiwgV2lkdGg6ICJ3aWR0aCIgfSwgZnVuY3Rpb24oIG5hbWUsIHR5cGUgKSB7CglqUXVlcnkuZWFjaCggeyBwYWRkaW5nOiAiaW5uZXIiICsgbmFtZSwgY29udGVudDogdHlwZSwgIiI6ICJvdXRlciIgKyBuYW1lIH0sIGZ1bmN0aW9uKCBkZWZhdWx0RXh0cmEsIGZ1bmNOYW1lICkgewoJCS8vIG1hcmdpbiBpcyBvbmx5IGZvciBvdXRlckhlaWdodCwgb3V0ZXJXaWR0aAoJCWpRdWVyeS5mblsgZnVuY05hbWUgXSA9IGZ1bmN0aW9uKCBtYXJnaW4sIHZhbHVlICkgewoJCQl2YXIgY2hhaW5hYmxlID0gYXJndW1lbnRzLmxlbmd0aCAmJiAoIGRlZmF1bHRFeHRyYSB8fCB0eXBlb2YgbWFyZ2luICE9PSAiYm9vbGVhbiIgKSwKCQkJCWV4dHJhID0gZGVmYXVsdEV4dHJhIHx8ICggbWFyZ2luID09PSB0cnVlIHx8IHZhbHVlID09PSB0cnVlID8gIm1hcmdpbiIgOiAiYm9yZGVyIiApOwoKCQkJcmV0dXJuIGpRdWVyeS5hY2Nlc3MoIHRoaXMsIGZ1bmN0aW9uKCBlbGVtLCB0eXBlLCB2YWx1ZSApIHsKCQkJCXZhciBkb2M7CgoJCQkJaWYgKCBqUXVlcnkuaXNXaW5kb3coIGVsZW0gKSApIHsKCQkJCQkvLyBBcyBvZiA1LzgvMjAxMiB0aGlzIHdpbGwgeWllbGQgaW5jb3JyZWN0IHJlc3VsdHMgZm9yIE1vYmlsZSBTYWZhcmksIGJ1dCB0aGVyZQoJCQkJCS8vIGlzbid0IGEgd2hvbGUgbG90IHdlIGNhbiBkby4gU2VlIHB1bGwgcmVxdWVzdCBhdCB0aGlzIFVSTCBmb3IgZGlzY3Vzc2lvbjoKCQkJCQkvLyBodHRwczovL2dpdGh1Yi5jb20vanF1ZXJ5L2pxdWVyeS9wdWxsLzc2NAoJCQkJCXJldHVybiBlbGVtLmRvY3VtZW50LmRvY3VtZW50RWxlbWVudFsgImNsaWVudCIgKyBuYW1lIF07CgkJCQl9CgoJCQkJLy8gR2V0IGRvY3VtZW50IHdpZHRoIG9yIGhlaWdodAoJCQkJaWYgKCBlbGVtLm5vZGVUeXBlID09PSA5ICkgewoJCQkJCWRvYyA9IGVsZW0uZG9jdW1lbnRFbGVtZW50OwoKCQkJCQkvLyBFaXRoZXIgc2Nyb2xsW1dpZHRoL0hlaWdodF0gb3Igb2Zmc2V0W1dpZHRoL0hlaWdodF0gb3IgY2xpZW50W1dpZHRoL0hlaWdodF0sIHdoaWNoZXZlciBpcyBncmVhdGVzdAoJCQkJCS8vIHVuZm9ydHVuYXRlbHksIHRoaXMgY2F1c2VzIGJ1ZyAjMzgzOCBpbiBJRTYvOCBvbmx5LCBidXQgdGhlcmUgaXMgY3VycmVudGx5IG5vIGdvb2QsIHNtYWxsIHdheSB0byBmaXggaXQuCgkJCQkJcmV0dXJuIE1hdGgubWF4KAoJCQkJCQllbGVtLmJvZHlbICJzY3JvbGwiICsgbmFtZSBdLCBkb2NbICJzY3JvbGwiICsgbmFtZSBdLAoJCQkJCQllbGVtLmJvZHlbICJvZmZzZXQiICsgbmFtZSBdLCBkb2NbICJvZmZzZXQiICsgbmFtZSBdLAoJCQkJCQlkb2NbICJjbGllbnQiICsgbmFtZSBdCgkJCQkJKTsKCQkJCX0KCgkJCQlyZXR1cm4gdmFsdWUgPT09IHVuZGVmaW5lZCA/CgkJCQkJLy8gR2V0IHdpZHRoIG9yIGhlaWdodCBvbiB0aGUgZWxlbWVudCwgcmVxdWVzdGluZyBidXQgbm90IGZvcmNpbmcgcGFyc2VGbG9hdAoJCQkJCWpRdWVyeS5jc3MoIGVsZW0sIHR5cGUsIGV4dHJhICkgOgoKCQkJCQkvLyBTZXQgd2lkdGggb3IgaGVpZ2h0IG9uIHRoZSBlbGVtZW50CgkJCQkJalF1ZXJ5LnN0eWxlKCBlbGVtLCB0eXBlLCB2YWx1ZSwgZXh0cmEgKTsKCQkJfSwgdHlwZSwgY2hhaW5hYmxlID8gbWFyZ2luIDogdW5kZWZpbmVkLCBjaGFpbmFibGUsIG51bGwgKTsKCQl9OwoJfSk7Cn0pOwovLyBMaW1pdCBzY29wZSBwb2xsdXRpb24gZnJvbSBhbnkgZGVwcmVjYXRlZCBBUEkKLy8gKGZ1bmN0aW9uKCkgewoKLy8gfSkoKTsKLy8gRXhwb3NlIGpRdWVyeSB0byB0aGUgZ2xvYmFsIG9iamVjdAp3aW5kb3cualF1ZXJ5ID0gd2luZG93LiQgPSBqUXVlcnk7CgovLyBFeHBvc2UgalF1ZXJ5IGFzIGFuIEFNRCBtb2R1bGUsIGJ1dCBvbmx5IGZvciBBTUQgbG9hZGVycyB0aGF0Ci8vIHVuZGVyc3RhbmQgdGhlIGlzc3VlcyB3aXRoIGxvYWRpbmcgbXVsdGlwbGUgdmVyc2lvbnMgb2YgalF1ZXJ5Ci8vIGluIGEgcGFnZSB0aGF0IGFsbCBtaWdodCBjYWxsIGRlZmluZSgpLiBUaGUgbG9hZGVyIHdpbGwgaW5kaWNhdGUKLy8gdGhleSBoYXZlIHNwZWNpYWwgYWxsb3dhbmNlcyBmb3IgbXVsdGlwbGUgalF1ZXJ5IHZlcnNpb25zIGJ5Ci8vIHNwZWNpZnlpbmcgZGVmaW5lLmFtZC5qUXVlcnkgPSB0cnVlLiBSZWdpc3RlciBhcyBhIG5hbWVkIG1vZHVsZSwKLy8gc2luY2UgalF1ZXJ5IGNhbiBiZSBjb25jYXRlbmF0ZWQgd2l0aCBvdGhlciBmaWxlcyB0aGF0IG1heSB1c2UgZGVmaW5lLAovLyBidXQgbm90IHVzZSBhIHByb3BlciBjb25jYXRlbmF0aW9uIHNjcmlwdCB0aGF0IHVuZGVyc3RhbmRzIGFub255bW91cwovLyBBTUQgbW9kdWxlcy4gQSBuYW1lZCBBTUQgaXMgc2FmZXN0IGFuZCBtb3N0IHJvYnVzdCB3YXkgdG8gcmVnaXN0ZXIuCi8vIExvd2VyY2FzZSBqcXVlcnkgaXMgdXNlZCBiZWNhdXNlIEFNRCBtb2R1bGUgbmFtZXMgYXJlIGRlcml2ZWQgZnJvbQovLyBmaWxlIG5hbWVzLCBhbmQgalF1ZXJ5IGlzIG5vcm1hbGx5IGRlbGl2ZXJlZCBpbiBhIGxvd2VyY2FzZSBmaWxlIG5hbWUuCi8vIERvIHRoaXMgYWZ0ZXIgY3JlYXRpbmcgdGhlIGdsb2JhbCBzbyB0aGF0IGlmIGFuIEFNRCBtb2R1bGUgd2FudHMgdG8gY2FsbAovLyBub0NvbmZsaWN0IHRvIGhpZGUgdGhpcyB2ZXJzaW9uIG9mIGpRdWVyeSwgaXQgd2lsbCB3b3JrLgppZiAoIHR5cGVvZiBkZWZpbmUgPT09ICJmdW5jdGlvbiIgJiYgZGVmaW5lLmFtZCAmJiBkZWZpbmUuYW1kLmpRdWVyeSApIHsKCWRlZmluZSggImpxdWVyeSIsIFtdLCBmdW5jdGlvbiAoKSB7IHJldHVybiBqUXVlcnk7IH0gKTsKfQoKfSkoIHdpbmRvdyApOwovLyAgICAgVW5kZXJzY29yZS5qcyAxLjYuMAovLyAgICAgaHR0cDovL3VuZGVyc2NvcmVqcy5vcmcKLy8gICAgIChjKSAyMDA5LTIwMTQgSmVyZW15IEFzaGtlbmFzLCBEb2N1bWVudENsb3VkIGFuZCBJbnZlc3RpZ2F0aXZlIFJlcG9ydGVycyAmIEVkaXRvcnMKLy8gICAgIFVuZGVyc2NvcmUgbWF5IGJlIGZyZWVseSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UuCgooZnVuY3Rpb24oKSB7CgogIC8vIEJhc2VsaW5lIHNldHVwCiAgLy8gLS0tLS0tLS0tLS0tLS0KCiAgLy8gRXN0YWJsaXNoIHRoZSByb290IG9iamVjdCwgYHdpbmRvd2AgaW4gdGhlIGJyb3dzZXIsIG9yIGBleHBvcnRzYCBvbiB0aGUgc2VydmVyLgogIHZhciByb290ID0gdGhpczsKCiAgLy8gU2F2ZSB0aGUgcHJldmlvdXMgdmFsdWUgb2YgdGhlIGBfYCB2YXJpYWJsZS4KICB2YXIgcHJldmlvdXNVbmRlcnNjb3JlID0gcm9vdC5fOwoKICAvLyBFc3RhYmxpc2ggdGhlIG9iamVjdCB0aGF0IGdldHMgcmV0dXJuZWQgdG8gYnJlYWsgb3V0IG9mIGEgbG9vcCBpdGVyYXRpb24uCiAgdmFyIGJyZWFrZXIgPSB7fTsKCiAgLy8gU2F2ZSBieXRlcyBpbiB0aGUgbWluaWZpZWQgKGJ1dCBub3QgZ3ppcHBlZCkgdmVyc2lvbjoKICB2YXIgQXJyYXlQcm90byA9IEFycmF5LnByb3RvdHlwZSwgT2JqUHJvdG8gPSBPYmplY3QucHJvdG90eXBlLCBGdW5jUHJvdG8gPSBGdW5jdGlvbi5wcm90b3R5cGU7CgogIC8vIENyZWF0ZSBxdWljayByZWZlcmVuY2UgdmFyaWFibGVzIGZvciBzcGVlZCBhY2Nlc3MgdG8gY29yZSBwcm90b3R5cGVzLgogIHZhcgogICAgcHVzaCAgICAgICAgICAgICA9IEFycmF5UHJvdG8ucHVzaCwKICAgIHNsaWNlICAgICAgICAgICAgPSBBcnJheVByb3RvLnNsaWNlLAogICAgY29uY2F0ICAgICAgICAgICA9IEFycmF5UHJvdG8uY29uY2F0LAogICAgdG9TdHJpbmcgICAgICAgICA9IE9ialByb3RvLnRvU3RyaW5nLAogICAgaGFzT3duUHJvcGVydHkgICA9IE9ialByb3RvLmhhc093blByb3BlcnR5OwoKICAvLyBBbGwgKipFQ01BU2NyaXB0IDUqKiBuYXRpdmUgZnVuY3Rpb24gaW1wbGVtZW50YXRpb25zIHRoYXQgd2UgaG9wZSB0byB1c2UKICAvLyBhcmUgZGVjbGFyZWQgaGVyZS4KICB2YXIKICAgIG5hdGl2ZUZvckVhY2ggICAgICA9IEFycmF5UHJvdG8uZm9yRWFjaCwKICAgIG5hdGl2ZU1hcCAgICAgICAgICA9IEFycmF5UHJvdG8ubWFwLAogICAgbmF0aXZlUmVkdWNlICAgICAgID0gQXJyYXlQcm90by5yZWR1Y2UsCiAgICBuYXRpdmVSZWR1Y2VSaWdodCAgPSBBcnJheVByb3RvLnJlZHVjZVJpZ2h0LAogICAgbmF0aXZlRmlsdGVyICAgICAgID0gQXJyYXlQcm90by5maWx0ZXIsCiAgICBuYXRpdmVFdmVyeSAgICAgICAgPSBBcnJheVByb3RvLmV2ZXJ5LAogICAgbmF0aXZlU29tZSAgICAgICAgID0gQXJyYXlQcm90by5zb21lLAogICAgbmF0aXZlSW5kZXhPZiAgICAgID0gQXJyYXlQcm90by5pbmRleE9mLAogICAgbmF0aXZlTGFzdEluZGV4T2YgID0gQXJyYXlQcm90by5sYXN0SW5kZXhPZiwKICAgIG5hdGl2ZUlzQXJyYXkgICAgICA9IEFycmF5LmlzQXJyYXksCiAgICBuYXRpdmVLZXlzICAgICAgICAgPSBPYmplY3Qua2V5cywKICAgIG5hdGl2ZUJpbmQgICAgICAgICA9IEZ1bmNQcm90by5iaW5kOwoKICAvLyBDcmVhdGUgYSBzYWZlIHJlZmVyZW5jZSB0byB0aGUgVW5kZXJzY29yZSBvYmplY3QgZm9yIHVzZSBiZWxvdy4KICB2YXIgXyA9IGZ1bmN0aW9uKG9iaikgewogICAgaWYgKG9iaiBpbnN0YW5jZW9mIF8pIHJldHVybiBvYmo7CiAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgXykpIHJldHVybiBuZXcgXyhvYmopOwogICAgdGhpcy5fd3JhcHBlZCA9IG9iajsKICB9OwoKICAvLyBFeHBvcnQgdGhlIFVuZGVyc2NvcmUgb2JqZWN0IGZvciAqKk5vZGUuanMqKiwgd2l0aAogIC8vIGJhY2t3YXJkcy1jb21wYXRpYmlsaXR5IGZvciB0aGUgb2xkIGByZXF1aXJlKClgIEFQSS4gSWYgd2UncmUgaW4KICAvLyB0aGUgYnJvd3NlciwgYWRkIGBfYCBhcyBhIGdsb2JhbCBvYmplY3QgdmlhIGEgc3RyaW5nIGlkZW50aWZpZXIsCiAgLy8gZm9yIENsb3N1cmUgQ29tcGlsZXIgImFkdmFuY2VkIiBtb2RlLgogIGlmICh0eXBlb2YgZXhwb3J0cyAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgIGlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyAmJiBtb2R1bGUuZXhwb3J0cykgewogICAgICBleHBvcnRzID0gbW9kdWxlLmV4cG9ydHMgPSBfOwogICAgfQogICAgZXhwb3J0cy5fID0gXzsKICB9IGVsc2UgewogICAgcm9vdC5fID0gXzsKICB9CgogIC8vIEN1cnJlbnQgdmVyc2lvbi4KICBfLlZFUlNJT04gPSAnMS42LjAnOwoKICAvLyBDb2xsZWN0aW9uIEZ1bmN0aW9ucwogIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tCgogIC8vIFRoZSBjb3JuZXJzdG9uZSwgYW4gYGVhY2hgIGltcGxlbWVudGF0aW9uLCBha2EgYGZvckVhY2hgLgogIC8vIEhhbmRsZXMgb2JqZWN0cyB3aXRoIHRoZSBidWlsdC1pbiBgZm9yRWFjaGAsIGFycmF5cywgYW5kIHJhdyBvYmplY3RzLgogIC8vIERlbGVnYXRlcyB0byAqKkVDTUFTY3JpcHQgNSoqJ3MgbmF0aXZlIGBmb3JFYWNoYCBpZiBhdmFpbGFibGUuCiAgdmFyIGVhY2ggPSBfLmVhY2ggPSBfLmZvckVhY2ggPSBmdW5jdGlvbihvYmosIGl0ZXJhdG9yLCBjb250ZXh0KSB7CiAgICBpZiAob2JqID09IG51bGwpIHJldHVybiBvYmo7CiAgICBpZiAobmF0aXZlRm9yRWFjaCAmJiBvYmouZm9yRWFjaCA9PT0gbmF0aXZlRm9yRWFjaCkgewogICAgICBvYmouZm9yRWFjaChpdGVyYXRvciwgY29udGV4dCk7CiAgICB9IGVsc2UgaWYgKG9iai5sZW5ndGggPT09ICtvYmoubGVuZ3RoKSB7CiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBvYmoubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAoaXRlcmF0b3IuY2FsbChjb250ZXh0LCBvYmpbaV0sIGksIG9iaikgPT09IGJyZWFrZXIpIHJldHVybjsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgdmFyIGtleXMgPSBfLmtleXMob2JqKTsKICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IGtleXMubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAoaXRlcmF0b3IuY2FsbChjb250ZXh0LCBvYmpba2V5c1tpXV0sIGtleXNbaV0sIG9iaikgPT09IGJyZWFrZXIpIHJldHVybjsKICAgICAgfQogICAgfQogICAgcmV0dXJuIG9iajsKICB9OwoKICAvLyBSZXR1cm4gdGhlIHJlc3VsdHMgb2YgYXBwbHlpbmcgdGhlIGl0ZXJhdG9yIHRvIGVhY2ggZWxlbWVudC4KICAvLyBEZWxlZ2F0ZXMgdG8gKipFQ01BU2NyaXB0IDUqKidzIG5hdGl2ZSBgbWFwYCBpZiBhdmFpbGFibGUuCiAgXy5tYXAgPSBfLmNvbGxlY3QgPSBmdW5jdGlvbihvYmosIGl0ZXJhdG9yLCBjb250ZXh0KSB7CiAgICB2YXIgcmVzdWx0cyA9IFtdOwogICAgaWYgKG9iaiA9PSBudWxsKSByZXR1cm4gcmVzdWx0czsKICAgIGlmIChuYXRpdmVNYXAgJiYgb2JqLm1hcCA9PT0gbmF0aXZlTWFwKSByZXR1cm4gb2JqLm1hcChpdGVyYXRvciwgY29udGV4dCk7CiAgICBlYWNoKG9iaiwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBsaXN0KSB7CiAgICAgIHJlc3VsdHMucHVzaChpdGVyYXRvci5jYWxsKGNvbnRleHQsIHZhbHVlLCBpbmRleCwgbGlzdCkpOwogICAgfSk7CiAgICByZXR1cm4gcmVzdWx0czsKICB9OwoKICB2YXIgcmVkdWNlRXJyb3IgPSAnUmVkdWNlIG9mIGVtcHR5IGFycmF5IHdpdGggbm8gaW5pdGlhbCB2YWx1ZSc7CgogIC8vICoqUmVkdWNlKiogYnVpbGRzIHVwIGEgc2luZ2xlIHJlc3VsdCBmcm9tIGEgbGlzdCBvZiB2YWx1ZXMsIGFrYSBgaW5qZWN0YCwKICAvLyBvciBgZm9sZGxgLiBEZWxlZ2F0ZXMgdG8gKipFQ01BU2NyaXB0IDUqKidzIG5hdGl2ZSBgcmVkdWNlYCBpZiBhdmFpbGFibGUuCiAgXy5yZWR1Y2UgPSBfLmZvbGRsID0gXy5pbmplY3QgPSBmdW5jdGlvbihvYmosIGl0ZXJhdG9yLCBtZW1vLCBjb250ZXh0KSB7CiAgICB2YXIgaW5pdGlhbCA9IGFyZ3VtZW50cy5sZW5ndGggPiAyOwogICAgaWYgKG9iaiA9PSBudWxsKSBvYmogPSBbXTsKICAgIGlmIChuYXRpdmVSZWR1Y2UgJiYgb2JqLnJlZHVjZSA9PT0gbmF0aXZlUmVkdWNlKSB7CiAgICAgIGlmIChjb250ZXh0KSBpdGVyYXRvciA9IF8uYmluZChpdGVyYXRvciwgY29udGV4dCk7CiAgICAgIHJldHVybiBpbml0aWFsID8gb2JqLnJlZHVjZShpdGVyYXRvciwgbWVtbykgOiBvYmoucmVkdWNlKGl0ZXJhdG9yKTsKICAgIH0KICAgIGVhY2gob2JqLCBmdW5jdGlvbih2YWx1ZSwgaW5kZXgsIGxpc3QpIHsKICAgICAgaWYgKCFpbml0aWFsKSB7CiAgICAgICAgbWVtbyA9IHZhbHVlOwogICAgICAgIGluaXRpYWwgPSB0cnVlOwogICAgICB9IGVsc2UgewogICAgICAgIG1lbW8gPSBpdGVyYXRvci5jYWxsKGNvbnRleHQsIG1lbW8sIHZhbHVlLCBpbmRleCwgbGlzdCk7CiAgICAgIH0KICAgIH0pOwogICAgaWYgKCFpbml0aWFsKSB0aHJvdyBuZXcgVHlwZUVycm9yKHJlZHVjZUVycm9yKTsKICAgIHJldHVybiBtZW1vOwogIH07CgogIC8vIFRoZSByaWdodC1hc3NvY2lhdGl2ZSB2ZXJzaW9uIG9mIHJlZHVjZSwgYWxzbyBrbm93biBhcyBgZm9sZHJgLgogIC8vIERlbGVnYXRlcyB0byAqKkVDTUFTY3JpcHQgNSoqJ3MgbmF0aXZlIGByZWR1Y2VSaWdodGAgaWYgYXZhaWxhYmxlLgogIF8ucmVkdWNlUmlnaHQgPSBfLmZvbGRyID0gZnVuY3Rpb24ob2JqLCBpdGVyYXRvciwgbWVtbywgY29udGV4dCkgewogICAgdmFyIGluaXRpYWwgPSBhcmd1bWVudHMubGVuZ3RoID4gMjsKICAgIGlmIChvYmogPT0gbnVsbCkgb2JqID0gW107CiAgICBpZiAobmF0aXZlUmVkdWNlUmlnaHQgJiYgb2JqLnJlZHVjZVJpZ2h0ID09PSBuYXRpdmVSZWR1Y2VSaWdodCkgewogICAgICBpZiAoY29udGV4dCkgaXRlcmF0b3IgPSBfLmJpbmQoaXRlcmF0b3IsIGNvbnRleHQpOwogICAgICByZXR1cm4gaW5pdGlhbCA/IG9iai5yZWR1Y2VSaWdodChpdGVyYXRvciwgbWVtbykgOiBvYmoucmVkdWNlUmlnaHQoaXRlcmF0b3IpOwogICAgfQogICAgdmFyIGxlbmd0aCA9IG9iai5sZW5ndGg7CiAgICBpZiAobGVuZ3RoICE9PSArbGVuZ3RoKSB7CiAgICAgIHZhciBrZXlzID0gXy5rZXlzKG9iaik7CiAgICAgIGxlbmd0aCA9IGtleXMubGVuZ3RoOwogICAgfQogICAgZWFjaChvYmosIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCwgbGlzdCkgewogICAgICBpbmRleCA9IGtleXMgPyBrZXlzWy0tbGVuZ3RoXSA6IC0tbGVuZ3RoOwogICAgICBpZiAoIWluaXRpYWwpIHsKICAgICAgICBtZW1vID0gb2JqW2luZGV4XTsKICAgICAgICBpbml0aWFsID0gdHJ1ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBtZW1vID0gaXRlcmF0b3IuY2FsbChjb250ZXh0LCBtZW1vLCBvYmpbaW5kZXhdLCBpbmRleCwgbGlzdCk7CiAgICAgIH0KICAgIH0pOwogICAgaWYgKCFpbml0aWFsKSB0aHJvdyBuZXcgVHlwZUVycm9yKHJlZHVjZUVycm9yKTsKICAgIHJldHVybiBtZW1vOwogIH07CgogIC8vIFJldHVybiB0aGUgZmlyc3QgdmFsdWUgd2hpY2ggcGFzc2VzIGEgdHJ1dGggdGVzdC4gQWxpYXNlZCBhcyBgZGV0ZWN0YC4KICBfLmZpbmQgPSBfLmRldGVjdCA9IGZ1bmN0aW9uKG9iaiwgcHJlZGljYXRlLCBjb250ZXh0KSB7CiAgICB2YXIgcmVzdWx0OwogICAgYW55KG9iaiwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBsaXN0KSB7CiAgICAgIGlmIChwcmVkaWNhdGUuY2FsbChjb250ZXh0LCB2YWx1ZSwgaW5kZXgsIGxpc3QpKSB7CiAgICAgICAgcmVzdWx0ID0gdmFsdWU7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIHJlc3VsdDsKICB9OwoKICAvLyBSZXR1cm4gYWxsIHRoZSBlbGVtZW50cyB0aGF0IHBhc3MgYSB0cnV0aCB0ZXN0LgogIC8vIERlbGVnYXRlcyB0byAqKkVDTUFTY3JpcHQgNSoqJ3MgbmF0aXZlIGBmaWx0ZXJgIGlmIGF2YWlsYWJsZS4KICAvLyBBbGlhc2VkIGFzIGBzZWxlY3RgLgogIF8uZmlsdGVyID0gXy5zZWxlY3QgPSBmdW5jdGlvbihvYmosIHByZWRpY2F0ZSwgY29udGV4dCkgewogICAgdmFyIHJlc3VsdHMgPSBbXTsKICAgIGlmIChvYmogPT0gbnVsbCkgcmV0dXJuIHJlc3VsdHM7CiAgICBpZiAobmF0aXZlRmlsdGVyICYmIG9iai5maWx0ZXIgPT09IG5hdGl2ZUZpbHRlcikgcmV0dXJuIG9iai5maWx0ZXIocHJlZGljYXRlLCBjb250ZXh0KTsKICAgIGVhY2gob2JqLCBmdW5jdGlvbih2YWx1ZSwgaW5kZXgsIGxpc3QpIHsKICAgICAgaWYgKHByZWRpY2F0ZS5jYWxsKGNvbnRleHQsIHZhbHVlLCBpbmRleCwgbGlzdCkpIHJlc3VsdHMucHVzaCh2YWx1ZSk7CiAgICB9KTsKICAgIHJldHVybiByZXN1bHRzOwogIH07CgogIC8vIFJldHVybiBhbGwgdGhlIGVsZW1lbnRzIGZvciB3aGljaCBhIHRydXRoIHRlc3QgZmFpbHMuCiAgXy5yZWplY3QgPSBmdW5jdGlvbihvYmosIHByZWRpY2F0ZSwgY29udGV4dCkgewogICAgcmV0dXJuIF8uZmlsdGVyKG9iaiwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBsaXN0KSB7CiAgICAgIHJldHVybiAhcHJlZGljYXRlLmNhbGwoY29udGV4dCwgdmFsdWUsIGluZGV4LCBsaXN0KTsKICAgIH0sIGNvbnRleHQpOwogIH07CgogIC8vIERldGVybWluZSB3aGV0aGVyIGFsbCBvZiB0aGUgZWxlbWVudHMgbWF0Y2ggYSB0cnV0aCB0ZXN0LgogIC8vIERlbGVnYXRlcyB0byAqKkVDTUFTY3JpcHQgNSoqJ3MgbmF0aXZlIGBldmVyeWAgaWYgYXZhaWxhYmxlLgogIC8vIEFsaWFzZWQgYXMgYGFsbGAuCiAgXy5ldmVyeSA9IF8uYWxsID0gZnVuY3Rpb24ob2JqLCBwcmVkaWNhdGUsIGNvbnRleHQpIHsKICAgIHByZWRpY2F0ZSB8fCAocHJlZGljYXRlID0gXy5pZGVudGl0eSk7CiAgICB2YXIgcmVzdWx0ID0gdHJ1ZTsKICAgIGlmIChvYmogPT0gbnVsbCkgcmV0dXJuIHJlc3VsdDsKICAgIGlmIChuYXRpdmVFdmVyeSAmJiBvYmouZXZlcnkgPT09IG5hdGl2ZUV2ZXJ5KSByZXR1cm4gb2JqLmV2ZXJ5KHByZWRpY2F0ZSwgY29udGV4dCk7CiAgICBlYWNoKG9iaiwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBsaXN0KSB7CiAgICAgIGlmICghKHJlc3VsdCA9IHJlc3VsdCAmJiBwcmVkaWNhdGUuY2FsbChjb250ZXh0LCB2YWx1ZSwgaW5kZXgsIGxpc3QpKSkgcmV0dXJuIGJyZWFrZXI7CiAgICB9KTsKICAgIHJldHVybiAhIXJlc3VsdDsKICB9OwoKICAvLyBEZXRlcm1pbmUgaWYgYXQgbGVhc3Qgb25lIGVsZW1lbnQgaW4gdGhlIG9iamVjdCBtYXRjaGVzIGEgdHJ1dGggdGVzdC4KICAvLyBEZWxlZ2F0ZXMgdG8gKipFQ01BU2NyaXB0IDUqKidzIG5hdGl2ZSBgc29tZWAgaWYgYXZhaWxhYmxlLgogIC8vIEFsaWFzZWQgYXMgYGFueWAuCiAgdmFyIGFueSA9IF8uc29tZSA9IF8uYW55ID0gZnVuY3Rpb24ob2JqLCBwcmVkaWNhdGUsIGNvbnRleHQpIHsKICAgIHByZWRpY2F0ZSB8fCAocHJlZGljYXRlID0gXy5pZGVudGl0eSk7CiAgICB2YXIgcmVzdWx0ID0gZmFsc2U7CiAgICBpZiAob2JqID09IG51bGwpIHJldHVybiByZXN1bHQ7CiAgICBpZiAobmF0aXZlU29tZSAmJiBvYmouc29tZSA9PT0gbmF0aXZlU29tZSkgcmV0dXJuIG9iai5zb21lKHByZWRpY2F0ZSwgY29udGV4dCk7CiAgICBlYWNoKG9iaiwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBsaXN0KSB7CiAgICAgIGlmIChyZXN1bHQgfHwgKHJlc3VsdCA9IHByZWRpY2F0ZS5jYWxsKGNvbnRleHQsIHZhbHVlLCBpbmRleCwgbGlzdCkpKSByZXR1cm4gYnJlYWtlcjsKICAgIH0pOwogICAgcmV0dXJuICEhcmVzdWx0OwogIH07CgogIC8vIERldGVybWluZSBpZiB0aGUgYXJyYXkgb3Igb2JqZWN0IGNvbnRhaW5zIGEgZ2l2ZW4gdmFsdWUgKHVzaW5nIGA9PT1gKS4KICAvLyBBbGlhc2VkIGFzIGBpbmNsdWRlYC4KICBfLmNvbnRhaW5zID0gXy5pbmNsdWRlID0gZnVuY3Rpb24ob2JqLCB0YXJnZXQpIHsKICAgIGlmIChvYmogPT0gbnVsbCkgcmV0dXJuIGZhbHNlOwogICAgaWYgKG5hdGl2ZUluZGV4T2YgJiYgb2JqLmluZGV4T2YgPT09IG5hdGl2ZUluZGV4T2YpIHJldHVybiBvYmouaW5kZXhPZih0YXJnZXQpICE9IC0xOwogICAgcmV0dXJuIGFueShvYmosIGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgIHJldHVybiB2YWx1ZSA9PT0gdGFyZ2V0OwogICAgfSk7CiAgfTsKCiAgLy8gSW52b2tlIGEgbWV0aG9kICh3aXRoIGFyZ3VtZW50cykgb24gZXZlcnkgaXRlbSBpbiBhIGNvbGxlY3Rpb24uCiAgXy5pbnZva2UgPSBmdW5jdGlvbihvYmosIG1ldGhvZCkgewogICAgdmFyIGFyZ3MgPSBzbGljZS5jYWxsKGFyZ3VtZW50cywgMik7CiAgICB2YXIgaXNGdW5jID0gXy5pc0Z1bmN0aW9uKG1ldGhvZCk7CiAgICByZXR1cm4gXy5tYXAob2JqLCBmdW5jdGlvbih2YWx1ZSkgewogICAgICByZXR1cm4gKGlzRnVuYyA/IG1ldGhvZCA6IHZhbHVlW21ldGhvZF0pLmFwcGx5KHZhbHVlLCBhcmdzKTsKICAgIH0pOwogIH07CgogIC8vIENvbnZlbmllbmNlIHZlcnNpb24gb2YgYSBjb21tb24gdXNlIGNhc2Ugb2YgYG1hcGA6IGZldGNoaW5nIGEgcHJvcGVydHkuCiAgXy5wbHVjayA9IGZ1bmN0aW9uKG9iaiwga2V5KSB7CiAgICByZXR1cm4gXy5tYXAob2JqLCBfLnByb3BlcnR5KGtleSkpOwogIH07CgogIC8vIENvbnZlbmllbmNlIHZlcnNpb24gb2YgYSBjb21tb24gdXNlIGNhc2Ugb2YgYGZpbHRlcmA6IHNlbGVjdGluZyBvbmx5IG9iamVjdHMKICAvLyBjb250YWluaW5nIHNwZWNpZmljIGBrZXk6dmFsdWVgIHBhaXJzLgogIF8ud2hlcmUgPSBmdW5jdGlvbihvYmosIGF0dHJzKSB7CiAgICByZXR1cm4gXy5maWx0ZXIob2JqLCBfLm1hdGNoZXMoYXR0cnMpKTsKICB9OwoKICAvLyBDb252ZW5pZW5jZSB2ZXJzaW9uIG9mIGEgY29tbW9uIHVzZSBjYXNlIG9mIGBmaW5kYDogZ2V0dGluZyB0aGUgZmlyc3Qgb2JqZWN0CiAgLy8gY29udGFpbmluZyBzcGVjaWZpYyBga2V5OnZhbHVlYCBwYWlycy4KICBfLmZpbmRXaGVyZSA9IGZ1bmN0aW9uKG9iaiwgYXR0cnMpIHsKICAgIHJldHVybiBfLmZpbmQob2JqLCBfLm1hdGNoZXMoYXR0cnMpKTsKICB9OwoKICAvLyBSZXR1cm4gdGhlIG1heGltdW0gZWxlbWVudCBvciAoZWxlbWVudC1iYXNlZCBjb21wdXRhdGlvbikuCiAgLy8gQ2FuJ3Qgb3B0aW1pemUgYXJyYXlzIG9mIGludGVnZXJzIGxvbmdlciB0aGFuIDY1LDUzNSBlbGVtZW50cy4KICAvLyBTZWUgW1dlYktpdCBCdWcgODA3OTddKGh0dHBzOi8vYnVncy53ZWJraXQub3JnL3Nob3dfYnVnLmNnaT9pZD04MDc5NykKICBfLm1heCA9IGZ1bmN0aW9uKG9iaiwgaXRlcmF0b3IsIGNvbnRleHQpIHsKICAgIGlmICghaXRlcmF0b3IgJiYgXy5pc0FycmF5KG9iaikgJiYgb2JqWzBdID09PSArb2JqWzBdICYmIG9iai5sZW5ndGggPCA2NTUzNSkgewogICAgICByZXR1cm4gTWF0aC5tYXguYXBwbHkoTWF0aCwgb2JqKTsKICAgIH0KICAgIHZhciByZXN1bHQgPSAtSW5maW5pdHksIGxhc3RDb21wdXRlZCA9IC1JbmZpbml0eTsKICAgIGVhY2gob2JqLCBmdW5jdGlvbih2YWx1ZSwgaW5kZXgsIGxpc3QpIHsKICAgICAgdmFyIGNvbXB1dGVkID0gaXRlcmF0b3IgPyBpdGVyYXRvci5jYWxsKGNvbnRleHQsIHZhbHVlLCBpbmRleCwgbGlzdCkgOiB2YWx1ZTsKICAgICAgaWYgKGNvbXB1dGVkID4gbGFzdENvbXB1dGVkKSB7CiAgICAgICAgcmVzdWx0ID0gdmFsdWU7CiAgICAgICAgbGFzdENvbXB1dGVkID0gY29tcHV0ZWQ7CiAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIHJlc3VsdDsKICB9OwoKICAvLyBSZXR1cm4gdGhlIG1pbmltdW0gZWxlbWVudCAob3IgZWxlbWVudC1iYXNlZCBjb21wdXRhdGlvbikuCiAgXy5taW4gPSBmdW5jdGlvbihvYmosIGl0ZXJhdG9yLCBjb250ZXh0KSB7CiAgICBpZiAoIWl0ZXJhdG9yICYmIF8uaXNBcnJheShvYmopICYmIG9ialswXSA9PT0gK29ialswXSAmJiBvYmoubGVuZ3RoIDwgNjU1MzUpIHsKICAgICAgcmV0dXJuIE1hdGgubWluLmFwcGx5KE1hdGgsIG9iaik7CiAgICB9CiAgICB2YXIgcmVzdWx0ID0gSW5maW5pdHksIGxhc3RDb21wdXRlZCA9IEluZmluaXR5OwogICAgZWFjaChvYmosIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCwgbGlzdCkgewogICAgICB2YXIgY29tcHV0ZWQgPSBpdGVyYXRvciA/IGl0ZXJhdG9yLmNhbGwoY29udGV4dCwgdmFsdWUsIGluZGV4LCBsaXN0KSA6IHZhbHVlOwogICAgICBpZiAoY29tcHV0ZWQgPCBsYXN0Q29tcHV0ZWQpIHsKICAgICAgICByZXN1bHQgPSB2YWx1ZTsKICAgICAgICBsYXN0Q29tcHV0ZWQgPSBjb21wdXRlZDsKICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gcmVzdWx0OwogIH07CgogIC8vIFNodWZmbGUgYW4gYXJyYXksIHVzaW5nIHRoZSBtb2Rlcm4gdmVyc2lvbiBvZiB0aGUKICAvLyBbRmlzaGVyLVlhdGVzIHNodWZmbGVdKGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvRmlzaGVy4oCTWWF0ZXNfc2h1ZmZsZSkuCiAgXy5zaHVmZmxlID0gZnVuY3Rpb24ob2JqKSB7CiAgICB2YXIgcmFuZDsKICAgIHZhciBpbmRleCA9IDA7CiAgICB2YXIgc2h1ZmZsZWQgPSBbXTsKICAgIGVhY2gob2JqLCBmdW5jdGlvbih2YWx1ZSkgewogICAgICByYW5kID0gXy5yYW5kb20oaW5kZXgrKyk7CiAgICAgIHNodWZmbGVkW2luZGV4IC0gMV0gPSBzaHVmZmxlZFtyYW5kXTsKICAgICAgc2h1ZmZsZWRbcmFuZF0gPSB2YWx1ZTsKICAgIH0pOwogICAgcmV0dXJuIHNodWZmbGVkOwogIH07CgogIC8vIFNhbXBsZSAqKm4qKiByYW5kb20gdmFsdWVzIGZyb20gYSBjb2xsZWN0aW9uLgogIC8vIElmICoqbioqIGlzIG5vdCBzcGVjaWZpZWQsIHJldHVybnMgYSBzaW5nbGUgcmFuZG9tIGVsZW1lbnQuCiAgLy8gVGhlIGludGVybmFsIGBndWFyZGAgYXJndW1lbnQgYWxsb3dzIGl0IHRvIHdvcmsgd2l0aCBgbWFwYC4KICBfLnNhbXBsZSA9IGZ1bmN0aW9uKG9iaiwgbiwgZ3VhcmQpIHsKICAgIGlmIChuID09IG51bGwgfHwgZ3VhcmQpIHsKICAgICAgaWYgKG9iai5sZW5ndGggIT09ICtvYmoubGVuZ3RoKSBvYmogPSBfLnZhbHVlcyhvYmopOwogICAgICByZXR1cm4gb2JqW18ucmFuZG9tKG9iai5sZW5ndGggLSAxKV07CiAgICB9CiAgICByZXR1cm4gXy5zaHVmZmxlKG9iaikuc2xpY2UoMCwgTWF0aC5tYXgoMCwgbikpOwogIH07CgogIC8vIEFuIGludGVybmFsIGZ1bmN0aW9uIHRvIGdlbmVyYXRlIGxvb2t1cCBpdGVyYXRvcnMuCiAgdmFyIGxvb2t1cEl0ZXJhdG9yID0gZnVuY3Rpb24odmFsdWUpIHsKICAgIGlmICh2YWx1ZSA9PSBudWxsKSByZXR1cm4gXy5pZGVudGl0eTsKICAgIGlmIChfLmlzRnVuY3Rpb24odmFsdWUpKSByZXR1cm4gdmFsdWU7CiAgICByZXR1cm4gXy5wcm9wZXJ0eSh2YWx1ZSk7CiAgfTsKCiAgLy8gU29ydCB0aGUgb2JqZWN0J3MgdmFsdWVzIGJ5IGEgY3JpdGVyaW9uIHByb2R1Y2VkIGJ5IGFuIGl0ZXJhdG9yLgogIF8uc29ydEJ5ID0gZnVuY3Rpb24ob2JqLCBpdGVyYXRvciwgY29udGV4dCkgewogICAgaXRlcmF0b3IgPSBsb29rdXBJdGVyYXRvcihpdGVyYXRvcik7CiAgICByZXR1cm4gXy5wbHVjayhfLm1hcChvYmosIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCwgbGlzdCkgewogICAgICByZXR1cm4gewogICAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgICBpbmRleDogaW5kZXgsCiAgICAgICAgY3JpdGVyaWE6IGl0ZXJhdG9yLmNhbGwoY29udGV4dCwgdmFsdWUsIGluZGV4LCBsaXN0KQogICAgICB9OwogICAgfSkuc29ydChmdW5jdGlvbihsZWZ0LCByaWdodCkgewogICAgICB2YXIgYSA9IGxlZnQuY3JpdGVyaWE7CiAgICAgIHZhciBiID0gcmlnaHQuY3JpdGVyaWE7CiAgICAgIGlmIChhICE9PSBiKSB7CiAgICAgICAgaWYgKGEgPiBiIHx8IGEgPT09IHZvaWQgMCkgcmV0dXJuIDE7CiAgICAgICAgaWYgKGEgPCBiIHx8IGIgPT09IHZvaWQgMCkgcmV0dXJuIC0xOwogICAgICB9CiAgICAgIHJldHVybiBsZWZ0LmluZGV4IC0gcmlnaHQuaW5kZXg7CiAgICB9KSwgJ3ZhbHVlJyk7CiAgfTsKCiAgLy8gQW4gaW50ZXJuYWwgZnVuY3Rpb24gdXNlZCBmb3IgYWdncmVnYXRlICJncm91cCBieSIgb3BlcmF0aW9ucy4KICB2YXIgZ3JvdXAgPSBmdW5jdGlvbihiZWhhdmlvcikgewogICAgcmV0dXJuIGZ1bmN0aW9uKG9iaiwgaXRlcmF0b3IsIGNvbnRleHQpIHsKICAgICAgdmFyIHJlc3VsdCA9IHt9OwogICAgICBpdGVyYXRvciA9IGxvb2t1cEl0ZXJhdG9yKGl0ZXJhdG9yKTsKICAgICAgZWFjaChvYmosIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCkgewogICAgICAgIHZhciBrZXkgPSBpdGVyYXRvci5jYWxsKGNvbnRleHQsIHZhbHVlLCBpbmRleCwgb2JqKTsKICAgICAgICBiZWhhdmlvcihyZXN1bHQsIGtleSwgdmFsdWUpOwogICAgICB9KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH07CiAgfTsKCiAgLy8gR3JvdXBzIHRoZSBvYmplY3QncyB2YWx1ZXMgYnkgYSBjcml0ZXJpb24uIFBhc3MgZWl0aGVyIGEgc3RyaW5nIGF0dHJpYnV0ZQogIC8vIHRvIGdyb3VwIGJ5LCBvciBhIGZ1bmN0aW9uIHRoYXQgcmV0dXJucyB0aGUgY3JpdGVyaW9uLgogIF8uZ3JvdXBCeSA9IGdyb3VwKGZ1bmN0aW9uKHJlc3VsdCwga2V5LCB2YWx1ZSkgewogICAgXy5oYXMocmVzdWx0LCBrZXkpID8gcmVzdWx0W2tleV0ucHVzaCh2YWx1ZSkgOiByZXN1bHRba2V5XSA9IFt2YWx1ZV07CiAgfSk7CgogIC8vIEluZGV4ZXMgdGhlIG9iamVjdCdzIHZhbHVlcyBieSBhIGNyaXRlcmlvbiwgc2ltaWxhciB0byBgZ3JvdXBCeWAsIGJ1dCBmb3IKICAvLyB3aGVuIHlvdSBrbm93IHRoYXQgeW91ciBpbmRleCB2YWx1ZXMgd2lsbCBiZSB1bmlxdWUuCiAgXy5pbmRleEJ5ID0gZ3JvdXAoZnVuY3Rpb24ocmVzdWx0LCBrZXksIHZhbHVlKSB7CiAgICByZXN1bHRba2V5XSA9IHZhbHVlOwogIH0pOwoKICAvLyBDb3VudHMgaW5zdGFuY2VzIG9mIGFuIG9iamVjdCB0aGF0IGdyb3VwIGJ5IGEgY2VydGFpbiBjcml0ZXJpb24uIFBhc3MKICAvLyBlaXRoZXIgYSBzdHJpbmcgYXR0cmlidXRlIHRvIGNvdW50IGJ5LCBvciBhIGZ1bmN0aW9uIHRoYXQgcmV0dXJucyB0aGUKICAvLyBjcml0ZXJpb24uCiAgXy5jb3VudEJ5ID0gZ3JvdXAoZnVuY3Rpb24ocmVzdWx0LCBrZXkpIHsKICAgIF8uaGFzKHJlc3VsdCwga2V5KSA/IHJlc3VsdFtrZXldKysgOiByZXN1bHRba2V5XSA9IDE7CiAgfSk7CgogIC8vIFVzZSBhIGNvbXBhcmF0b3IgZnVuY3Rpb24gdG8gZmlndXJlIG91dCB0aGUgc21hbGxlc3QgaW5kZXggYXQgd2hpY2gKICAvLyBhbiBvYmplY3Qgc2hvdWxkIGJlIGluc2VydGVkIHNvIGFzIHRvIG1haW50YWluIG9yZGVyLiBVc2VzIGJpbmFyeSBzZWFyY2guCiAgXy5zb3J0ZWRJbmRleCA9IGZ1bmN0aW9uKGFycmF5LCBvYmosIGl0ZXJhdG9yLCBjb250ZXh0KSB7CiAgICBpdGVyYXRvciA9IGxvb2t1cEl0ZXJhdG9yKGl0ZXJhdG9yKTsKICAgIHZhciB2YWx1ZSA9IGl0ZXJhdG9yLmNhbGwoY29udGV4dCwgb2JqKTsKICAgIHZhciBsb3cgPSAwLCBoaWdoID0gYXJyYXkubGVuZ3RoOwogICAgd2hpbGUgKGxvdyA8IGhpZ2gpIHsKICAgICAgdmFyIG1pZCA9IChsb3cgKyBoaWdoKSA+Pj4gMTsKICAgICAgaXRlcmF0b3IuY2FsbChjb250ZXh0LCBhcnJheVttaWRdKSA8IHZhbHVlID8gbG93ID0gbWlkICsgMSA6IGhpZ2ggPSBtaWQ7CiAgICB9CiAgICByZXR1cm4gbG93OwogIH07CgogIC8vIFNhZmVseSBjcmVhdGUgYSByZWFsLCBsaXZlIGFycmF5IGZyb20gYW55dGhpbmcgaXRlcmFibGUuCiAgXy50b0FycmF5ID0gZnVuY3Rpb24ob2JqKSB7CiAgICBpZiAoIW9iaikgcmV0dXJuIFtdOwogICAgaWYgKF8uaXNBcnJheShvYmopKSByZXR1cm4gc2xpY2UuY2FsbChvYmopOwogICAgaWYgKG9iai5sZW5ndGggPT09ICtvYmoubGVuZ3RoKSByZXR1cm4gXy5tYXAob2JqLCBfLmlkZW50aXR5KTsKICAgIHJldHVybiBfLnZhbHVlcyhvYmopOwogIH07CgogIC8vIFJldHVybiB0aGUgbnVtYmVyIG9mIGVsZW1lbnRzIGluIGFuIG9iamVjdC4KICBfLnNpemUgPSBmdW5jdGlvbihvYmopIHsKICAgIGlmIChvYmogPT0gbnVsbCkgcmV0dXJuIDA7CiAgICByZXR1cm4gKG9iai5sZW5ndGggPT09ICtvYmoubGVuZ3RoKSA/IG9iai5sZW5ndGggOiBfLmtleXMob2JqKS5sZW5ndGg7CiAgfTsKCiAgLy8gQXJyYXkgRnVuY3Rpb25zCiAgLy8gLS0tLS0tLS0tLS0tLS0tCgogIC8vIEdldCB0aGUgZmlyc3QgZWxlbWVudCBvZiBhbiBhcnJheS4gUGFzc2luZyAqKm4qKiB3aWxsIHJldHVybiB0aGUgZmlyc3QgTgogIC8vIHZhbHVlcyBpbiB0aGUgYXJyYXkuIEFsaWFzZWQgYXMgYGhlYWRgIGFuZCBgdGFrZWAuIFRoZSAqKmd1YXJkKiogY2hlY2sKICAvLyBhbGxvd3MgaXQgdG8gd29yayB3aXRoIGBfLm1hcGAuCiAgXy5maXJzdCA9IF8uaGVhZCA9IF8udGFrZSA9IGZ1bmN0aW9uKGFycmF5LCBuLCBndWFyZCkgewogICAgaWYgKGFycmF5ID09IG51bGwpIHJldHVybiB2b2lkIDA7CiAgICBpZiAoKG4gPT0gbnVsbCkgfHwgZ3VhcmQpIHJldHVybiBhcnJheVswXTsKICAgIGlmIChuIDwgMCkgcmV0dXJuIFtdOwogICAgcmV0dXJuIHNsaWNlLmNhbGwoYXJyYXksIDAsIG4pOwogIH07CgogIC8vIFJldHVybnMgZXZlcnl0aGluZyBidXQgdGhlIGxhc3QgZW50cnkgb2YgdGhlIGFycmF5LiBFc3BlY2lhbGx5IHVzZWZ1bCBvbgogIC8vIHRoZSBhcmd1bWVudHMgb2JqZWN0LiBQYXNzaW5nICoqbioqIHdpbGwgcmV0dXJuIGFsbCB0aGUgdmFsdWVzIGluCiAgLy8gdGhlIGFycmF5LCBleGNsdWRpbmcgdGhlIGxhc3QgTi4gVGhlICoqZ3VhcmQqKiBjaGVjayBhbGxvd3MgaXQgdG8gd29yayB3aXRoCiAgLy8gYF8ubWFwYC4KICBfLmluaXRpYWwgPSBmdW5jdGlvbihhcnJheSwgbiwgZ3VhcmQpIHsKICAgIHJldHVybiBzbGljZS5jYWxsKGFycmF5LCAwLCBhcnJheS5sZW5ndGggLSAoKG4gPT0gbnVsbCkgfHwgZ3VhcmQgPyAxIDogbikpOwogIH07CgogIC8vIEdldCB0aGUgbGFzdCBlbGVtZW50IG9mIGFuIGFycmF5LiBQYXNzaW5nICoqbioqIHdpbGwgcmV0dXJuIHRoZSBsYXN0IE4KICAvLyB2YWx1ZXMgaW4gdGhlIGFycmF5LiBUaGUgKipndWFyZCoqIGNoZWNrIGFsbG93cyBpdCB0byB3b3JrIHdpdGggYF8ubWFwYC4KICBfLmxhc3QgPSBmdW5jdGlvbihhcnJheSwgbiwgZ3VhcmQpIHsKICAgIGlmIChhcnJheSA9PSBudWxsKSByZXR1cm4gdm9pZCAwOwogICAgaWYgKChuID09IG51bGwpIHx8IGd1YXJkKSByZXR1cm4gYXJyYXlbYXJyYXkubGVuZ3RoIC0gMV07CiAgICByZXR1cm4gc2xpY2UuY2FsbChhcnJheSwgTWF0aC5tYXgoYXJyYXkubGVuZ3RoIC0gbiwgMCkpOwogIH07CgogIC8vIFJldHVybnMgZXZlcnl0aGluZyBidXQgdGhlIGZpcnN0IGVudHJ5IG9mIHRoZSBhcnJheS4gQWxpYXNlZCBhcyBgdGFpbGAgYW5kIGBkcm9wYC4KICAvLyBFc3BlY2lhbGx5IHVzZWZ1bCBvbiB0aGUgYXJndW1lbnRzIG9iamVjdC4gUGFzc2luZyBhbiAqKm4qKiB3aWxsIHJldHVybgogIC8vIHRoZSByZXN0IE4gdmFsdWVzIGluIHRoZSBhcnJheS4gVGhlICoqZ3VhcmQqKgogIC8vIGNoZWNrIGFsbG93cyBpdCB0byB3b3JrIHdpdGggYF8ubWFwYC4KICBfLnJlc3QgPSBfLnRhaWwgPSBfLmRyb3AgPSBmdW5jdGlvbihhcnJheSwgbiwgZ3VhcmQpIHsKICAgIHJldHVybiBzbGljZS5jYWxsKGFycmF5LCAobiA9PSBudWxsKSB8fCBndWFyZCA/IDEgOiBuKTsKICB9OwoKICAvLyBUcmltIG91dCBhbGwgZmFsc3kgdmFsdWVzIGZyb20gYW4gYXJyYXkuCiAgXy5jb21wYWN0ID0gZnVuY3Rpb24oYXJyYXkpIHsKICAgIHJldHVybiBfLmZpbHRlcihhcnJheSwgXy5pZGVudGl0eSk7CiAgfTsKCiAgLy8gSW50ZXJuYWwgaW1wbGVtZW50YXRpb24gb2YgYSByZWN1cnNpdmUgYGZsYXR0ZW5gIGZ1bmN0aW9uLgogIHZhciBmbGF0dGVuID0gZnVuY3Rpb24oaW5wdXQsIHNoYWxsb3csIG91dHB1dCkgewogICAgaWYgKHNoYWxsb3cgJiYgXy5ldmVyeShpbnB1dCwgXy5pc0FycmF5KSkgewogICAgICByZXR1cm4gY29uY2F0LmFwcGx5KG91dHB1dCwgaW5wdXQpOwogICAgfQogICAgZWFjaChpbnB1dCwgZnVuY3Rpb24odmFsdWUpIHsKICAgICAgaWYgKF8uaXNBcnJheSh2YWx1ZSkgfHwgXy5pc0FyZ3VtZW50cyh2YWx1ZSkpIHsKICAgICAgICBzaGFsbG93ID8gcHVzaC5hcHBseShvdXRwdXQsIHZhbHVlKSA6IGZsYXR0ZW4odmFsdWUsIHNoYWxsb3csIG91dHB1dCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgb3V0cHV0LnB1c2godmFsdWUpOwogICAgICB9CiAgICB9KTsKICAgIHJldHVybiBvdXRwdXQ7CiAgfTsKCiAgLy8gRmxhdHRlbiBvdXQgYW4gYXJyYXksIGVpdGhlciByZWN1cnNpdmVseSAoYnkgZGVmYXVsdCksIG9yIGp1c3Qgb25lIGxldmVsLgogIF8uZmxhdHRlbiA9IGZ1bmN0aW9uKGFycmF5LCBzaGFsbG93KSB7CiAgICByZXR1cm4gZmxhdHRlbihhcnJheSwgc2hhbGxvdywgW10pOwogIH07CgogIC8vIFJldHVybiBhIHZlcnNpb24gb2YgdGhlIGFycmF5IHRoYXQgZG9lcyBub3QgY29udGFpbiB0aGUgc3BlY2lmaWVkIHZhbHVlKHMpLgogIF8ud2l0aG91dCA9IGZ1bmN0aW9uKGFycmF5KSB7CiAgICByZXR1cm4gXy5kaWZmZXJlbmNlKGFycmF5LCBzbGljZS5jYWxsKGFyZ3VtZW50cywgMSkpOwogIH07CgogIC8vIFNwbGl0IGFuIGFycmF5IGludG8gdHdvIGFycmF5czogb25lIHdob3NlIGVsZW1lbnRzIGFsbCBzYXRpc2Z5IHRoZSBnaXZlbgogIC8vIHByZWRpY2F0ZSwgYW5kIG9uZSB3aG9zZSBlbGVtZW50cyBhbGwgZG8gbm90IHNhdGlzZnkgdGhlIHByZWRpY2F0ZS4KICBfLnBhcnRpdGlvbiA9IGZ1bmN0aW9uKGFycmF5LCBwcmVkaWNhdGUpIHsKICAgIHZhciBwYXNzID0gW10sIGZhaWwgPSBbXTsKICAgIGVhY2goYXJyYXksIGZ1bmN0aW9uKGVsZW0pIHsKICAgICAgKHByZWRpY2F0ZShlbGVtKSA/IHBhc3MgOiBmYWlsKS5wdXNoKGVsZW0pOwogICAgfSk7CiAgICByZXR1cm4gW3Bhc3MsIGZhaWxdOwogIH07CgogIC8vIFByb2R1Y2UgYSBkdXBsaWNhdGUtZnJlZSB2ZXJzaW9uIG9mIHRoZSBhcnJheS4gSWYgdGhlIGFycmF5IGhhcyBhbHJlYWR5CiAgLy8gYmVlbiBzb3J0ZWQsIHlvdSBoYXZlIHRoZSBvcHRpb24gb2YgdXNpbmcgYSBmYXN0ZXIgYWxnb3JpdGhtLgogIC8vIEFsaWFzZWQgYXMgYHVuaXF1ZWAuCiAgXy51bmlxID0gXy51bmlxdWUgPSBmdW5jdGlvbihhcnJheSwgaXNTb3J0ZWQsIGl0ZXJhdG9yLCBjb250ZXh0KSB7CiAgICBpZiAoXy5pc0Z1bmN0aW9uKGlzU29ydGVkKSkgewogICAgICBjb250ZXh0ID0gaXRlcmF0b3I7CiAgICAgIGl0ZXJhdG9yID0gaXNTb3J0ZWQ7CiAgICAgIGlzU29ydGVkID0gZmFsc2U7CiAgICB9CiAgICB2YXIgaW5pdGlhbCA9IGl0ZXJhdG9yID8gXy5tYXAoYXJyYXksIGl0ZXJhdG9yLCBjb250ZXh0KSA6IGFycmF5OwogICAgdmFyIHJlc3VsdHMgPSBbXTsKICAgIHZhciBzZWVuID0gW107CiAgICBlYWNoKGluaXRpYWwsIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCkgewogICAgICBpZiAoaXNTb3J0ZWQgPyAoIWluZGV4IHx8IHNlZW5bc2Vlbi5sZW5ndGggLSAxXSAhPT0gdmFsdWUpIDogIV8uY29udGFpbnMoc2VlbiwgdmFsdWUpKSB7CiAgICAgICAgc2Vlbi5wdXNoKHZhbHVlKTsKICAgICAgICByZXN1bHRzLnB1c2goYXJyYXlbaW5kZXhdKTsKICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gcmVzdWx0czsKICB9OwoKICAvLyBQcm9kdWNlIGFuIGFycmF5IHRoYXQgY29udGFpbnMgdGhlIHVuaW9uOiBlYWNoIGRpc3RpbmN0IGVsZW1lbnQgZnJvbSBhbGwgb2YKICAvLyB0aGUgcGFzc2VkLWluIGFycmF5cy4KICBfLnVuaW9uID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gXy51bmlxKF8uZmxhdHRlbihhcmd1bWVudHMsIHRydWUpKTsKICB9OwoKICAvLyBQcm9kdWNlIGFuIGFycmF5IHRoYXQgY29udGFpbnMgZXZlcnkgaXRlbSBzaGFyZWQgYmV0d2VlbiBhbGwgdGhlCiAgLy8gcGFzc2VkLWluIGFycmF5cy4KICBfLmludGVyc2VjdGlvbiA9IGZ1bmN0aW9uKGFycmF5KSB7CiAgICB2YXIgcmVzdCA9IHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKICAgIHJldHVybiBfLmZpbHRlcihfLnVuaXEoYXJyYXkpLCBmdW5jdGlvbihpdGVtKSB7CiAgICAgIHJldHVybiBfLmV2ZXJ5KHJlc3QsIGZ1bmN0aW9uKG90aGVyKSB7CiAgICAgICAgcmV0dXJuIF8uY29udGFpbnMob3RoZXIsIGl0ZW0pOwogICAgICB9KTsKICAgIH0pOwogIH07CgogIC8vIFRha2UgdGhlIGRpZmZlcmVuY2UgYmV0d2VlbiBvbmUgYXJyYXkgYW5kIGEgbnVtYmVyIG9mIG90aGVyIGFycmF5cy4KICAvLyBPbmx5IHRoZSBlbGVtZW50cyBwcmVzZW50IGluIGp1c3QgdGhlIGZpcnN0IGFycmF5IHdpbGwgcmVtYWluLgogIF8uZGlmZmVyZW5jZSA9IGZ1bmN0aW9uKGFycmF5KSB7CiAgICB2YXIgcmVzdCA9IGNvbmNhdC5hcHBseShBcnJheVByb3RvLCBzbGljZS5jYWxsKGFyZ3VtZW50cywgMSkpOwogICAgcmV0dXJuIF8uZmlsdGVyKGFycmF5LCBmdW5jdGlvbih2YWx1ZSl7IHJldHVybiAhXy5jb250YWlucyhyZXN0LCB2YWx1ZSk7IH0pOwogIH07CgogIC8vIFppcCB0b2dldGhlciBtdWx0aXBsZSBsaXN0cyBpbnRvIGEgc2luZ2xlIGFycmF5IC0tIGVsZW1lbnRzIHRoYXQgc2hhcmUKICAvLyBhbiBpbmRleCBnbyB0b2dldGhlci4KICBfLnppcCA9IGZ1bmN0aW9uKCkgewogICAgdmFyIGxlbmd0aCA9IF8ubWF4KF8ucGx1Y2soYXJndW1lbnRzLCAnbGVuZ3RoJykuY29uY2F0KDApKTsKICAgIHZhciByZXN1bHRzID0gbmV3IEFycmF5KGxlbmd0aCk7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgIHJlc3VsdHNbaV0gPSBfLnBsdWNrKGFyZ3VtZW50cywgJycgKyBpKTsKICAgIH0KICAgIHJldHVybiByZXN1bHRzOwogIH07CgogIC8vIENvbnZlcnRzIGxpc3RzIGludG8gb2JqZWN0cy4gUGFzcyBlaXRoZXIgYSBzaW5nbGUgYXJyYXkgb2YgYFtrZXksIHZhbHVlXWAKICAvLyBwYWlycywgb3IgdHdvIHBhcmFsbGVsIGFycmF5cyBvZiB0aGUgc2FtZSBsZW5ndGggLS0gb25lIG9mIGtleXMsIGFuZCBvbmUgb2YKICAvLyB0aGUgY29ycmVzcG9uZGluZyB2YWx1ZXMuCiAgXy5vYmplY3QgPSBmdW5jdGlvbihsaXN0LCB2YWx1ZXMpIHsKICAgIGlmIChsaXN0ID09IG51bGwpIHJldHVybiB7fTsKICAgIHZhciByZXN1bHQgPSB7fTsKICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBsaXN0Lmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgIGlmICh2YWx1ZXMpIHsKICAgICAgICByZXN1bHRbbGlzdFtpXV0gPSB2YWx1ZXNbaV07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmVzdWx0W2xpc3RbaV1bMF1dID0gbGlzdFtpXVsxXTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9OwoKICAvLyBJZiB0aGUgYnJvd3NlciBkb2Vzbid0IHN1cHBseSB1cyB3aXRoIGluZGV4T2YgKEknbSBsb29raW5nIGF0IHlvdSwgKipNU0lFKiopLAogIC8vIHdlIG5lZWQgdGhpcyBmdW5jdGlvbi4gUmV0dXJuIHRoZSBwb3NpdGlvbiBvZiB0aGUgZmlyc3Qgb2NjdXJyZW5jZSBvZiBhbgogIC8vIGl0ZW0gaW4gYW4gYXJyYXksIG9yIC0xIGlmIHRoZSBpdGVtIGlzIG5vdCBpbmNsdWRlZCBpbiB0aGUgYXJyYXkuCiAgLy8gRGVsZWdhdGVzIHRvICoqRUNNQVNjcmlwdCA1KioncyBuYXRpdmUgYGluZGV4T2ZgIGlmIGF2YWlsYWJsZS4KICAvLyBJZiB0aGUgYXJyYXkgaXMgbGFyZ2UgYW5kIGFscmVhZHkgaW4gc29ydCBvcmRlciwgcGFzcyBgdHJ1ZWAKICAvLyBmb3IgKippc1NvcnRlZCoqIHRvIHVzZSBiaW5hcnkgc2VhcmNoLgogIF8uaW5kZXhPZiA9IGZ1bmN0aW9uKGFycmF5LCBpdGVtLCBpc1NvcnRlZCkgewogICAgaWYgKGFycmF5ID09IG51bGwpIHJldHVybiAtMTsKICAgIHZhciBpID0gMCwgbGVuZ3RoID0gYXJyYXkubGVuZ3RoOwogICAgaWYgKGlzU29ydGVkKSB7CiAgICAgIGlmICh0eXBlb2YgaXNTb3J0ZWQgPT0gJ251bWJlcicpIHsKICAgICAgICBpID0gKGlzU29ydGVkIDwgMCA/IE1hdGgubWF4KDAsIGxlbmd0aCArIGlzU29ydGVkKSA6IGlzU29ydGVkKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpID0gXy5zb3J0ZWRJbmRleChhcnJheSwgaXRlbSk7CiAgICAgICAgcmV0dXJuIGFycmF5W2ldID09PSBpdGVtID8gaSA6IC0xOwogICAgICB9CiAgICB9CiAgICBpZiAobmF0aXZlSW5kZXhPZiAmJiBhcnJheS5pbmRleE9mID09PSBuYXRpdmVJbmRleE9mKSByZXR1cm4gYXJyYXkuaW5kZXhPZihpdGVtLCBpc1NvcnRlZCk7CiAgICBmb3IgKDsgaSA8IGxlbmd0aDsgaSsrKSBpZiAoYXJyYXlbaV0gPT09IGl0ZW0pIHJldHVybiBpOwogICAgcmV0dXJuIC0xOwogIH07CgogIC8vIERlbGVnYXRlcyB0byAqKkVDTUFTY3JpcHQgNSoqJ3MgbmF0aXZlIGBsYXN0SW5kZXhPZmAgaWYgYXZhaWxhYmxlLgogIF8ubGFzdEluZGV4T2YgPSBmdW5jdGlvbihhcnJheSwgaXRlbSwgZnJvbSkgewogICAgaWYgKGFycmF5ID09IG51bGwpIHJldHVybiAtMTsKICAgIHZhciBoYXNJbmRleCA9IGZyb20gIT0gbnVsbDsKICAgIGlmIChuYXRpdmVMYXN0SW5kZXhPZiAmJiBhcnJheS5sYXN0SW5kZXhPZiA9PT0gbmF0aXZlTGFzdEluZGV4T2YpIHsKICAgICAgcmV0dXJuIGhhc0luZGV4ID8gYXJyYXkubGFzdEluZGV4T2YoaXRlbSwgZnJvbSkgOiBhcnJheS5sYXN0SW5kZXhPZihpdGVtKTsKICAgIH0KICAgIHZhciBpID0gKGhhc0luZGV4ID8gZnJvbSA6IGFycmF5Lmxlbmd0aCk7CiAgICB3aGlsZSAoaS0tKSBpZiAoYXJyYXlbaV0gPT09IGl0ZW0pIHJldHVybiBpOwogICAgcmV0dXJuIC0xOwogIH07CgogIC8vIEdlbmVyYXRlIGFuIGludGVnZXIgQXJyYXkgY29udGFpbmluZyBhbiBhcml0aG1ldGljIHByb2dyZXNzaW9uLiBBIHBvcnQgb2YKICAvLyB0aGUgbmF0aXZlIFB5dGhvbiBgcmFuZ2UoKWAgZnVuY3Rpb24uIFNlZQogIC8vIFt0aGUgUHl0aG9uIGRvY3VtZW50YXRpb25dKGh0dHA6Ly9kb2NzLnB5dGhvbi5vcmcvbGlicmFyeS9mdW5jdGlvbnMuaHRtbCNyYW5nZSkuCiAgXy5yYW5nZSA9IGZ1bmN0aW9uKHN0YXJ0LCBzdG9wLCBzdGVwKSB7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8PSAxKSB7CiAgICAgIHN0b3AgPSBzdGFydCB8fCAwOwogICAgICBzdGFydCA9IDA7CiAgICB9CiAgICBzdGVwID0gYXJndW1lbnRzWzJdIHx8IDE7CgogICAgdmFyIGxlbmd0aCA9IE1hdGgubWF4KE1hdGguY2VpbCgoc3RvcCAtIHN0YXJ0KSAvIHN0ZXApLCAwKTsKICAgIHZhciBpZHggPSAwOwogICAgdmFyIHJhbmdlID0gbmV3IEFycmF5KGxlbmd0aCk7CgogICAgd2hpbGUoaWR4IDwgbGVuZ3RoKSB7CiAgICAgIHJhbmdlW2lkeCsrXSA9IHN0YXJ0OwogICAgICBzdGFydCArPSBzdGVwOwogICAgfQoKICAgIHJldHVybiByYW5nZTsKICB9OwoKICAvLyBGdW5jdGlvbiAoYWhlbSkgRnVuY3Rpb25zCiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tCgogIC8vIFJldXNhYmxlIGNvbnN0cnVjdG9yIGZ1bmN0aW9uIGZvciBwcm90b3R5cGUgc2V0dGluZy4KICB2YXIgY3RvciA9IGZ1bmN0aW9uKCl7fTsKCiAgLy8gQ3JlYXRlIGEgZnVuY3Rpb24gYm91bmQgdG8gYSBnaXZlbiBvYmplY3QgKGFzc2lnbmluZyBgdGhpc2AsIGFuZCBhcmd1bWVudHMsCiAgLy8gb3B0aW9uYWxseSkuIERlbGVnYXRlcyB0byAqKkVDTUFTY3JpcHQgNSoqJ3MgbmF0aXZlIGBGdW5jdGlvbi5iaW5kYCBpZgogIC8vIGF2YWlsYWJsZS4KICBfLmJpbmQgPSBmdW5jdGlvbihmdW5jLCBjb250ZXh0KSB7CiAgICB2YXIgYXJncywgYm91bmQ7CiAgICBpZiAobmF0aXZlQmluZCAmJiBmdW5jLmJpbmQgPT09IG5hdGl2ZUJpbmQpIHJldHVybiBuYXRpdmVCaW5kLmFwcGx5KGZ1bmMsIHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSk7CiAgICBpZiAoIV8uaXNGdW5jdGlvbihmdW5jKSkgdGhyb3cgbmV3IFR5cGVFcnJvcjsKICAgIGFyZ3MgPSBzbGljZS5jYWxsKGFyZ3VtZW50cywgMik7CiAgICByZXR1cm4gYm91bmQgPSBmdW5jdGlvbigpIHsKICAgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIGJvdW5kKSkgcmV0dXJuIGZ1bmMuYXBwbHkoY29udGV4dCwgYXJncy5jb25jYXQoc2xpY2UuY2FsbChhcmd1bWVudHMpKSk7CiAgICAgIGN0b3IucHJvdG90eXBlID0gZnVuYy5wcm90b3R5cGU7CiAgICAgIHZhciBzZWxmID0gbmV3IGN0b3I7CiAgICAgIGN0b3IucHJvdG90eXBlID0gbnVsbDsKICAgICAgdmFyIHJlc3VsdCA9IGZ1bmMuYXBwbHkoc2VsZiwgYXJncy5jb25jYXQoc2xpY2UuY2FsbChhcmd1bWVudHMpKSk7CiAgICAgIGlmIChPYmplY3QocmVzdWx0KSA9PT0gcmVzdWx0KSByZXR1cm4gcmVzdWx0OwogICAgICByZXR1cm4gc2VsZjsKICAgIH07CiAgfTsKCiAgLy8gUGFydGlhbGx5IGFwcGx5IGEgZnVuY3Rpb24gYnkgY3JlYXRpbmcgYSB2ZXJzaW9uIHRoYXQgaGFzIGhhZCBzb21lIG9mIGl0cwogIC8vIGFyZ3VtZW50cyBwcmUtZmlsbGVkLCB3aXRob3V0IGNoYW5naW5nIGl0cyBkeW5hbWljIGB0aGlzYCBjb250ZXh0LiBfIGFjdHMKICAvLyBhcyBhIHBsYWNlaG9sZGVyLCBhbGxvd2luZyBhbnkgY29tYmluYXRpb24gb2YgYXJndW1lbnRzIHRvIGJlIHByZS1maWxsZWQuCiAgXy5wYXJ0aWFsID0gZnVuY3Rpb24oZnVuYykgewogICAgdmFyIGJvdW5kQXJncyA9IHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgdmFyIHBvc2l0aW9uID0gMDsKICAgICAgdmFyIGFyZ3MgPSBib3VuZEFyZ3Muc2xpY2UoKTsKICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IGFyZ3MubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAoYXJnc1tpXSA9PT0gXykgYXJnc1tpXSA9IGFyZ3VtZW50c1twb3NpdGlvbisrXTsKICAgICAgfQogICAgICB3aGlsZSAocG9zaXRpb24gPCBhcmd1bWVudHMubGVuZ3RoKSBhcmdzLnB1c2goYXJndW1lbnRzW3Bvc2l0aW9uKytdKTsKICAgICAgcmV0dXJuIGZ1bmMuYXBwbHkodGhpcywgYXJncyk7CiAgICB9OwogIH07CgogIC8vIEJpbmQgYSBudW1iZXIgb2YgYW4gb2JqZWN0J3MgbWV0aG9kcyB0byB0aGF0IG9iamVjdC4gUmVtYWluaW5nIGFyZ3VtZW50cwogIC8vIGFyZSB0aGUgbWV0aG9kIG5hbWVzIHRvIGJlIGJvdW5kLiBVc2VmdWwgZm9yIGVuc3VyaW5nIHRoYXQgYWxsIGNhbGxiYWNrcwogIC8vIGRlZmluZWQgb24gYW4gb2JqZWN0IGJlbG9uZyB0byBpdC4KICBfLmJpbmRBbGwgPSBmdW5jdGlvbihvYmopIHsKICAgIHZhciBmdW5jcyA9IHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKICAgIGlmIChmdW5jcy5sZW5ndGggPT09IDApIHRocm93IG5ldyBFcnJvcignYmluZEFsbCBtdXN0IGJlIHBhc3NlZCBmdW5jdGlvbiBuYW1lcycpOwogICAgZWFjaChmdW5jcywgZnVuY3Rpb24oZikgeyBvYmpbZl0gPSBfLmJpbmQob2JqW2ZdLCBvYmopOyB9KTsKICAgIHJldHVybiBvYmo7CiAgfTsKCiAgLy8gTWVtb2l6ZSBhbiBleHBlbnNpdmUgZnVuY3Rpb24gYnkgc3RvcmluZyBpdHMgcmVzdWx0cy4KICBfLm1lbW9pemUgPSBmdW5jdGlvbihmdW5jLCBoYXNoZXIpIHsKICAgIHZhciBtZW1vID0ge307CiAgICBoYXNoZXIgfHwgKGhhc2hlciA9IF8uaWRlbnRpdHkpOwogICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICB2YXIga2V5ID0gaGFzaGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIHJldHVybiBfLmhhcyhtZW1vLCBrZXkpID8gbWVtb1trZXldIDogKG1lbW9ba2V5XSA9IGZ1bmMuYXBwbHkodGhpcywgYXJndW1lbnRzKSk7CiAgICB9OwogIH07CgogIC8vIERlbGF5cyBhIGZ1bmN0aW9uIGZvciB0aGUgZ2l2ZW4gbnVtYmVyIG9mIG1pbGxpc2Vjb25kcywgYW5kIHRoZW4gY2FsbHMKICAvLyBpdCB3aXRoIHRoZSBhcmd1bWVudHMgc3VwcGxpZWQuCiAgXy5kZWxheSA9IGZ1bmN0aW9uKGZ1bmMsIHdhaXQpIHsKICAgIHZhciBhcmdzID0gc2xpY2UuY2FsbChhcmd1bWVudHMsIDIpOwogICAgcmV0dXJuIHNldFRpbWVvdXQoZnVuY3Rpb24oKXsgcmV0dXJuIGZ1bmMuYXBwbHkobnVsbCwgYXJncyk7IH0sIHdhaXQpOwogIH07CgogIC8vIERlZmVycyBhIGZ1bmN0aW9uLCBzY2hlZHVsaW5nIGl0IHRvIHJ1biBhZnRlciB0aGUgY3VycmVudCBjYWxsIHN0YWNrIGhhcwogIC8vIGNsZWFyZWQuCiAgXy5kZWZlciA9IGZ1bmN0aW9uKGZ1bmMpIHsKICAgIHJldHVybiBfLmRlbGF5LmFwcGx5KF8sIFtmdW5jLCAxXS5jb25jYXQoc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpKSk7CiAgfTsKCiAgLy8gUmV0dXJucyBhIGZ1bmN0aW9uLCB0aGF0LCB3aGVuIGludm9rZWQsIHdpbGwgb25seSBiZSB0cmlnZ2VyZWQgYXQgbW9zdCBvbmNlCiAgLy8gZHVyaW5nIGEgZ2l2ZW4gd2luZG93IG9mIHRpbWUuIE5vcm1hbGx5LCB0aGUgdGhyb3R0bGVkIGZ1bmN0aW9uIHdpbGwgcnVuCiAgLy8gYXMgbXVjaCBhcyBpdCBjYW4sIHdpdGhvdXQgZXZlciBnb2luZyBtb3JlIHRoYW4gb25jZSBwZXIgYHdhaXRgIGR1cmF0aW9uOwogIC8vIGJ1dCBpZiB5b3UnZCBsaWtlIHRvIGRpc2FibGUgdGhlIGV4ZWN1dGlvbiBvbiB0aGUgbGVhZGluZyBlZGdlLCBwYXNzCiAgLy8gYHtsZWFkaW5nOiBmYWxzZX1gLiBUbyBkaXNhYmxlIGV4ZWN1dGlvbiBvbiB0aGUgdHJhaWxpbmcgZWRnZSwgZGl0dG8uCiAgXy50aHJvdHRsZSA9IGZ1bmN0aW9uKGZ1bmMsIHdhaXQsIG9wdGlvbnMpIHsKICAgIHZhciBjb250ZXh0LCBhcmdzLCByZXN1bHQ7CiAgICB2YXIgdGltZW91dCA9IG51bGw7CiAgICB2YXIgcHJldmlvdXMgPSAwOwogICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTsKICAgIHZhciBsYXRlciA9IGZ1bmN0aW9uKCkgewogICAgICBwcmV2aW91cyA9IG9wdGlvbnMubGVhZGluZyA9PT0gZmFsc2UgPyAwIDogXy5ub3coKTsKICAgICAgdGltZW91dCA9IG51bGw7CiAgICAgIHJlc3VsdCA9IGZ1bmMuYXBwbHkoY29udGV4dCwgYXJncyk7CiAgICAgIGNvbnRleHQgPSBhcmdzID0gbnVsbDsKICAgIH07CiAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBub3cgPSBfLm5vdygpOwogICAgICBpZiAoIXByZXZpb3VzICYmIG9wdGlvbnMubGVhZGluZyA9PT0gZmFsc2UpIHByZXZpb3VzID0gbm93OwogICAgICB2YXIgcmVtYWluaW5nID0gd2FpdCAtIChub3cgLSBwcmV2aW91cyk7CiAgICAgIGNvbnRleHQgPSB0aGlzOwogICAgICBhcmdzID0gYXJndW1lbnRzOwogICAgICBpZiAocmVtYWluaW5nIDw9IDApIHsKICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dCk7CiAgICAgICAgdGltZW91dCA9IG51bGw7CiAgICAgICAgcHJldmlvdXMgPSBub3c7CiAgICAgICAgcmVzdWx0ID0gZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTsKICAgICAgICBjb250ZXh0ID0gYXJncyA9IG51bGw7CiAgICAgIH0gZWxzZSBpZiAoIXRpbWVvdXQgJiYgb3B0aW9ucy50cmFpbGluZyAhPT0gZmFsc2UpIHsKICAgICAgICB0aW1lb3V0ID0gc2V0VGltZW91dChsYXRlciwgcmVtYWluaW5nKTsKICAgICAgfQogICAgICByZXR1cm4gcmVzdWx0OwogICAgfTsKICB9OwoKICAvLyBSZXR1cm5zIGEgZnVuY3Rpb24sIHRoYXQsIGFzIGxvbmcgYXMgaXQgY29udGludWVzIHRvIGJlIGludm9rZWQsIHdpbGwgbm90CiAgLy8gYmUgdHJpZ2dlcmVkLiBUaGUgZnVuY3Rpb24gd2lsbCBiZSBjYWxsZWQgYWZ0ZXIgaXQgc3RvcHMgYmVpbmcgY2FsbGVkIGZvcgogIC8vIE4gbWlsbGlzZWNvbmRzLiBJZiBgaW1tZWRpYXRlYCBpcyBwYXNzZWQsIHRyaWdnZXIgdGhlIGZ1bmN0aW9uIG9uIHRoZQogIC8vIGxlYWRpbmcgZWRnZSwgaW5zdGVhZCBvZiB0aGUgdHJhaWxpbmcuCiAgXy5kZWJvdW5jZSA9IGZ1bmN0aW9uKGZ1bmMsIHdhaXQsIGltbWVkaWF0ZSkgewogICAgdmFyIHRpbWVvdXQsIGFyZ3MsIGNvbnRleHQsIHRpbWVzdGFtcCwgcmVzdWx0OwoKICAgIHZhciBsYXRlciA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgbGFzdCA9IF8ubm93KCkgLSB0aW1lc3RhbXA7CiAgICAgIGlmIChsYXN0IDwgd2FpdCkgewogICAgICAgIHRpbWVvdXQgPSBzZXRUaW1lb3V0KGxhdGVyLCB3YWl0IC0gbGFzdCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGltZW91dCA9IG51bGw7CiAgICAgICAgaWYgKCFpbW1lZGlhdGUpIHsKICAgICAgICAgIHJlc3VsdCA9IGZ1bmMuYXBwbHkoY29udGV4dCwgYXJncyk7CiAgICAgICAgICBjb250ZXh0ID0gYXJncyA9IG51bGw7CiAgICAgICAgfQogICAgICB9CiAgICB9OwoKICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgY29udGV4dCA9IHRoaXM7CiAgICAgIGFyZ3MgPSBhcmd1bWVudHM7CiAgICAgIHRpbWVzdGFtcCA9IF8ubm93KCk7CiAgICAgIHZhciBjYWxsTm93ID0gaW1tZWRpYXRlICYmICF0aW1lb3V0OwogICAgICBpZiAoIXRpbWVvdXQpIHsKICAgICAgICB0aW1lb3V0ID0gc2V0VGltZW91dChsYXRlciwgd2FpdCk7CiAgICAgIH0KICAgICAgaWYgKGNhbGxOb3cpIHsKICAgICAgICByZXN1bHQgPSBmdW5jLmFwcGx5KGNvbnRleHQsIGFyZ3MpOwogICAgICAgIGNvbnRleHQgPSBhcmdzID0gbnVsbDsKICAgICAgfQoKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH07CiAgfTsKCiAgLy8gUmV0dXJucyBhIGZ1bmN0aW9uIHRoYXQgd2lsbCBiZSBleGVjdXRlZCBhdCBtb3N0IG9uZSB0aW1lLCBubyBtYXR0ZXIgaG93CiAgLy8gb2Z0ZW4geW91IGNhbGwgaXQuIFVzZWZ1bCBmb3IgbGF6eSBpbml0aWFsaXphdGlvbi4KICBfLm9uY2UgPSBmdW5jdGlvbihmdW5jKSB7CiAgICB2YXIgcmFuID0gZmFsc2UsIG1lbW87CiAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgIGlmIChyYW4pIHJldHVybiBtZW1vOwogICAgICByYW4gPSB0cnVlOwogICAgICBtZW1vID0gZnVuYy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICBmdW5jID0gbnVsbDsKICAgICAgcmV0dXJuIG1lbW87CiAgICB9OwogIH07CgogIC8vIFJldHVybnMgdGhlIGZpcnN0IGZ1bmN0aW9uIHBhc3NlZCBhcyBhbiBhcmd1bWVudCB0byB0aGUgc2Vjb25kLAogIC8vIGFsbG93aW5nIHlvdSB0byBhZGp1c3QgYXJndW1lbnRzLCBydW4gY29kZSBiZWZvcmUgYW5kIGFmdGVyLCBhbmQKICAvLyBjb25kaXRpb25hbGx5IGV4ZWN1dGUgdGhlIG9yaWdpbmFsIGZ1bmN0aW9uLgogIF8ud3JhcCA9IGZ1bmN0aW9uKGZ1bmMsIHdyYXBwZXIpIHsKICAgIHJldHVybiBfLnBhcnRpYWwod3JhcHBlciwgZnVuYyk7CiAgfTsKCiAgLy8gUmV0dXJucyBhIGZ1bmN0aW9uIHRoYXQgaXMgdGhlIGNvbXBvc2l0aW9uIG9mIGEgbGlzdCBvZiBmdW5jdGlvbnMsIGVhY2gKICAvLyBjb25zdW1pbmcgdGhlIHJldHVybiB2YWx1ZSBvZiB0aGUgZnVuY3Rpb24gdGhhdCBmb2xsb3dzLgogIF8uY29tcG9zZSA9IGZ1bmN0aW9uKCkgewogICAgdmFyIGZ1bmNzID0gYXJndW1lbnRzOwogICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICB2YXIgYXJncyA9IGFyZ3VtZW50czsKICAgICAgZm9yICh2YXIgaSA9IGZ1bmNzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgYXJncyA9IFtmdW5jc1tpXS5hcHBseSh0aGlzLCBhcmdzKV07CiAgICAgIH0KICAgICAgcmV0dXJuIGFyZ3NbMF07CiAgICB9OwogIH07CgogIC8vIFJldHVybnMgYSBmdW5jdGlvbiB0aGF0IHdpbGwgb25seSBiZSBleGVjdXRlZCBhZnRlciBiZWluZyBjYWxsZWQgTiB0aW1lcy4KICBfLmFmdGVyID0gZnVuY3Rpb24odGltZXMsIGZ1bmMpIHsKICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgaWYgKC0tdGltZXMgPCAxKSB7CiAgICAgICAgcmV0dXJuIGZ1bmMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQogICAgfTsKICB9OwoKICAvLyBPYmplY3QgRnVuY3Rpb25zCiAgLy8gLS0tLS0tLS0tLS0tLS0tLQoKICAvLyBSZXRyaWV2ZSB0aGUgbmFtZXMgb2YgYW4gb2JqZWN0J3MgcHJvcGVydGllcy4KICAvLyBEZWxlZ2F0ZXMgdG8gKipFQ01BU2NyaXB0IDUqKidzIG5hdGl2ZSBgT2JqZWN0LmtleXNgCiAgXy5rZXlzID0gZnVuY3Rpb24ob2JqKSB7CiAgICBpZiAoIV8uaXNPYmplY3Qob2JqKSkgcmV0dXJuIFtdOwogICAgaWYgKG5hdGl2ZUtleXMpIHJldHVybiBuYXRpdmVLZXlzKG9iaik7CiAgICB2YXIga2V5cyA9IFtdOwogICAgZm9yICh2YXIga2V5IGluIG9iaikgaWYgKF8uaGFzKG9iaiwga2V5KSkga2V5cy5wdXNoKGtleSk7CiAgICByZXR1cm4ga2V5czsKICB9OwoKICAvLyBSZXRyaWV2ZSB0aGUgdmFsdWVzIG9mIGFuIG9iamVjdCdzIHByb3BlcnRpZXMuCiAgXy52YWx1ZXMgPSBmdW5jdGlvbihvYmopIHsKICAgIHZhciBrZXlzID0gXy5rZXlzKG9iaik7CiAgICB2YXIgbGVuZ3RoID0ga2V5cy5sZW5ndGg7CiAgICB2YXIgdmFsdWVzID0gbmV3IEFycmF5KGxlbmd0aCk7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgIHZhbHVlc1tpXSA9IG9ialtrZXlzW2ldXTsKICAgIH0KICAgIHJldHVybiB2YWx1ZXM7CiAgfTsKCiAgLy8gQ29udmVydCBhbiBvYmplY3QgaW50byBhIGxpc3Qgb2YgYFtrZXksIHZhbHVlXWAgcGFpcnMuCiAgXy5wYWlycyA9IGZ1bmN0aW9uKG9iaikgewogICAgdmFyIGtleXMgPSBfLmtleXMob2JqKTsKICAgIHZhciBsZW5ndGggPSBrZXlzLmxlbmd0aDsKICAgIHZhciBwYWlycyA9IG5ldyBBcnJheShsZW5ndGgpOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICBwYWlyc1tpXSA9IFtrZXlzW2ldLCBvYmpba2V5c1tpXV1dOwogICAgfQogICAgcmV0dXJuIHBhaXJzOwogIH07CgogIC8vIEludmVydCB0aGUga2V5cyBhbmQgdmFsdWVzIG9mIGFuIG9iamVjdC4gVGhlIHZhbHVlcyBtdXN0IGJlIHNlcmlhbGl6YWJsZS4KICBfLmludmVydCA9IGZ1bmN0aW9uKG9iaikgewogICAgdmFyIHJlc3VsdCA9IHt9OwogICAgdmFyIGtleXMgPSBfLmtleXMob2JqKTsKICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBrZXlzLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgIHJlc3VsdFtvYmpba2V5c1tpXV1dID0ga2V5c1tpXTsKICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfTsKCiAgLy8gUmV0dXJuIGEgc29ydGVkIGxpc3Qgb2YgdGhlIGZ1bmN0aW9uIG5hbWVzIGF2YWlsYWJsZSBvbiB0aGUgb2JqZWN0LgogIC8vIEFsaWFzZWQgYXMgYG1ldGhvZHNgCiAgXy5mdW5jdGlvbnMgPSBfLm1ldGhvZHMgPSBmdW5jdGlvbihvYmopIHsKICAgIHZhciBuYW1lcyA9IFtdOwogICAgZm9yICh2YXIga2V5IGluIG9iaikgewogICAgICBpZiAoXy5pc0Z1bmN0aW9uKG9ialtrZXldKSkgbmFtZXMucHVzaChrZXkpOwogICAgfQogICAgcmV0dXJuIG5hbWVzLnNvcnQoKTsKICB9OwoKICAvLyBFeHRlbmQgYSBnaXZlbiBvYmplY3Qgd2l0aCBhbGwgdGhlIHByb3BlcnRpZXMgaW4gcGFzc2VkLWluIG9iamVjdChzKS4KICBfLmV4dGVuZCA9IGZ1bmN0aW9uKG9iaikgewogICAgZWFjaChzbGljZS5jYWxsKGFyZ3VtZW50cywgMSksIGZ1bmN0aW9uKHNvdXJjZSkgewogICAgICBpZiAoc291cmNlKSB7CiAgICAgICAgZm9yICh2YXIgcHJvcCBpbiBzb3VyY2UpIHsKICAgICAgICAgIG9ialtwcm9wXSA9IHNvdXJjZVtwcm9wXTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIG9iajsKICB9OwoKICAvLyBSZXR1cm4gYSBjb3B5IG9mIHRoZSBvYmplY3Qgb25seSBjb250YWluaW5nIHRoZSB3aGl0ZWxpc3RlZCBwcm9wZXJ0aWVzLgogIF8ucGljayA9IGZ1bmN0aW9uKG9iaikgewogICAgdmFyIGNvcHkgPSB7fTsKICAgIHZhciBrZXlzID0gY29uY2F0LmFwcGx5KEFycmF5UHJvdG8sIHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSk7CiAgICBlYWNoKGtleXMsIGZ1bmN0aW9uKGtleSkgewogICAgICBpZiAoa2V5IGluIG9iaikgY29weVtrZXldID0gb2JqW2tleV07CiAgICB9KTsKICAgIHJldHVybiBjb3B5OwogIH07CgogICAvLyBSZXR1cm4gYSBjb3B5IG9mIHRoZSBvYmplY3Qgd2l0aG91dCB0aGUgYmxhY2tsaXN0ZWQgcHJvcGVydGllcy4KICBfLm9taXQgPSBmdW5jdGlvbihvYmopIHsKICAgIHZhciBjb3B5ID0ge307CiAgICB2YXIga2V5cyA9IGNvbmNhdC5hcHBseShBcnJheVByb3RvLCBzbGljZS5jYWxsKGFyZ3VtZW50cywgMSkpOwogICAgZm9yICh2YXIga2V5IGluIG9iaikgewogICAgICBpZiAoIV8uY29udGFpbnMoa2V5cywga2V5KSkgY29weVtrZXldID0gb2JqW2tleV07CiAgICB9CiAgICByZXR1cm4gY29weTsKICB9OwoKICAvLyBGaWxsIGluIGEgZ2l2ZW4gb2JqZWN0IHdpdGggZGVmYXVsdCBwcm9wZXJ0aWVzLgogIF8uZGVmYXVsdHMgPSBmdW5jdGlvbihvYmopIHsKICAgIGVhY2goc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpLCBmdW5jdGlvbihzb3VyY2UpIHsKICAgICAgaWYgKHNvdXJjZSkgewogICAgICAgIGZvciAodmFyIHByb3AgaW4gc291cmNlKSB7CiAgICAgICAgICBpZiAob2JqW3Byb3BdID09PSB2b2lkIDApIG9ialtwcm9wXSA9IHNvdXJjZVtwcm9wXTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIG9iajsKICB9OwoKICAvLyBDcmVhdGUgYSAoc2hhbGxvdy1jbG9uZWQpIGR1cGxpY2F0ZSBvZiBhbiBvYmplY3QuCiAgXy5jbG9uZSA9IGZ1bmN0aW9uKG9iaikgewogICAgaWYgKCFfLmlzT2JqZWN0KG9iaikpIHJldHVybiBvYmo7CiAgICByZXR1cm4gXy5pc0FycmF5KG9iaikgPyBvYmouc2xpY2UoKSA6IF8uZXh0ZW5kKHt9LCBvYmopOwogIH07CgogIC8vIEludm9rZXMgaW50ZXJjZXB0b3Igd2l0aCB0aGUgb2JqLCBhbmQgdGhlbiByZXR1cm5zIG9iai4KICAvLyBUaGUgcHJpbWFyeSBwdXJwb3NlIG9mIHRoaXMgbWV0aG9kIGlzIHRvICJ0YXAgaW50byIgYSBtZXRob2QgY2hhaW4sIGluCiAgLy8gb3JkZXIgdG8gcGVyZm9ybSBvcGVyYXRpb25zIG9uIGludGVybWVkaWF0ZSByZXN1bHRzIHdpdGhpbiB0aGUgY2hhaW4uCiAgXy50YXAgPSBmdW5jdGlvbihvYmosIGludGVyY2VwdG9yKSB7CiAgICBpbnRlcmNlcHRvcihvYmopOwogICAgcmV0dXJuIG9iajsKICB9OwoKICAvLyBJbnRlcm5hbCByZWN1cnNpdmUgY29tcGFyaXNvbiBmdW5jdGlvbiBmb3IgYGlzRXF1YWxgLgogIHZhciBlcSA9IGZ1bmN0aW9uKGEsIGIsIGFTdGFjaywgYlN0YWNrKSB7CiAgICAvLyBJZGVudGljYWwgb2JqZWN0cyBhcmUgZXF1YWwuIGAwID09PSAtMGAsIGJ1dCB0aGV5IGFyZW4ndCBpZGVudGljYWwuCiAgICAvLyBTZWUgdGhlIFtIYXJtb255IGBlZ2FsYCBwcm9wb3NhbF0oaHR0cDovL3dpa2kuZWNtYXNjcmlwdC5vcmcvZG9rdS5waHA/aWQ9aGFybW9ueTplZ2FsKS4KICAgIGlmIChhID09PSBiKSByZXR1cm4gYSAhPT0gMCB8fCAxIC8gYSA9PSAxIC8gYjsKICAgIC8vIEEgc3RyaWN0IGNvbXBhcmlzb24gaXMgbmVjZXNzYXJ5IGJlY2F1c2UgYG51bGwgPT0gdW5kZWZpbmVkYC4KICAgIGlmIChhID09IG51bGwgfHwgYiA9PSBudWxsKSByZXR1cm4gYSA9PT0gYjsKICAgIC8vIFVud3JhcCBhbnkgd3JhcHBlZCBvYmplY3RzLgogICAgaWYgKGEgaW5zdGFuY2VvZiBfKSBhID0gYS5fd3JhcHBlZDsKICAgIGlmIChiIGluc3RhbmNlb2YgXykgYiA9IGIuX3dyYXBwZWQ7CiAgICAvLyBDb21wYXJlIGBbW0NsYXNzXV1gIG5hbWVzLgogICAgdmFyIGNsYXNzTmFtZSA9IHRvU3RyaW5nLmNhbGwoYSk7CiAgICBpZiAoY2xhc3NOYW1lICE9IHRvU3RyaW5nLmNhbGwoYikpIHJldHVybiBmYWxzZTsKICAgIHN3aXRjaCAoY2xhc3NOYW1lKSB7CiAgICAgIC8vIFN0cmluZ3MsIG51bWJlcnMsIGRhdGVzLCBhbmQgYm9vbGVhbnMgYXJlIGNvbXBhcmVkIGJ5IHZhbHVlLgogICAgICBjYXNlICdbb2JqZWN0IFN0cmluZ10nOgogICAgICAgIC8vIFByaW1pdGl2ZXMgYW5kIHRoZWlyIGNvcnJlc3BvbmRpbmcgb2JqZWN0IHdyYXBwZXJzIGFyZSBlcXVpdmFsZW50OyB0aHVzLCBgIjUiYCBpcwogICAgICAgIC8vIGVxdWl2YWxlbnQgdG8gYG5ldyBTdHJpbmcoIjUiKWAuCiAgICAgICAgcmV0dXJuIGEgPT0gU3RyaW5nKGIpOwogICAgICBjYXNlICdbb2JqZWN0IE51bWJlcl0nOgogICAgICAgIC8vIGBOYU5gcyBhcmUgZXF1aXZhbGVudCwgYnV0IG5vbi1yZWZsZXhpdmUuIEFuIGBlZ2FsYCBjb21wYXJpc29uIGlzIHBlcmZvcm1lZCBmb3IKICAgICAgICAvLyBvdGhlciBudW1lcmljIHZhbHVlcy4KICAgICAgICByZXR1cm4gYSAhPSArYSA/IGIgIT0gK2IgOiAoYSA9PSAwID8gMSAvIGEgPT0gMSAvIGIgOiBhID09ICtiKTsKICAgICAgY2FzZSAnW29iamVjdCBEYXRlXSc6CiAgICAgIGNhc2UgJ1tvYmplY3QgQm9vbGVhbl0nOgogICAgICAgIC8vIENvZXJjZSBkYXRlcyBhbmQgYm9vbGVhbnMgdG8gbnVtZXJpYyBwcmltaXRpdmUgdmFsdWVzLiBEYXRlcyBhcmUgY29tcGFyZWQgYnkgdGhlaXIKICAgICAgICAvLyBtaWxsaXNlY29uZCByZXByZXNlbnRhdGlvbnMuIE5vdGUgdGhhdCBpbnZhbGlkIGRhdGVzIHdpdGggbWlsbGlzZWNvbmQgcmVwcmVzZW50YXRpb25zCiAgICAgICAgLy8gb2YgYE5hTmAgYXJlIG5vdCBlcXVpdmFsZW50LgogICAgICAgIHJldHVybiArYSA9PSArYjsKICAgICAgLy8gUmVnRXhwcyBhcmUgY29tcGFyZWQgYnkgdGhlaXIgc291cmNlIHBhdHRlcm5zIGFuZCBmbGFncy4KICAgICAgY2FzZSAnW29iamVjdCBSZWdFeHBdJzoKICAgICAgICByZXR1cm4gYS5zb3VyY2UgPT0gYi5zb3VyY2UgJiYKICAgICAgICAgICAgICAgYS5nbG9iYWwgPT0gYi5nbG9iYWwgJiYKICAgICAgICAgICAgICAgYS5tdWx0aWxpbmUgPT0gYi5tdWx0aWxpbmUgJiYKICAgICAgICAgICAgICAgYS5pZ25vcmVDYXNlID09IGIuaWdub3JlQ2FzZTsKICAgIH0KICAgIGlmICh0eXBlb2YgYSAhPSAnb2JqZWN0JyB8fCB0eXBlb2YgYiAhPSAnb2JqZWN0JykgcmV0dXJuIGZhbHNlOwogICAgLy8gQXNzdW1lIGVxdWFsaXR5IGZvciBjeWNsaWMgc3RydWN0dXJlcy4gVGhlIGFsZ29yaXRobSBmb3IgZGV0ZWN0aW5nIGN5Y2xpYwogICAgLy8gc3RydWN0dXJlcyBpcyBhZGFwdGVkIGZyb20gRVMgNS4xIHNlY3Rpb24gMTUuMTIuMywgYWJzdHJhY3Qgb3BlcmF0aW9uIGBKT2AuCiAgICB2YXIgbGVuZ3RoID0gYVN0YWNrLmxlbmd0aDsKICAgIHdoaWxlIChsZW5ndGgtLSkgewogICAgICAvLyBMaW5lYXIgc2VhcmNoLiBQZXJmb3JtYW5jZSBpcyBpbnZlcnNlbHkgcHJvcG9ydGlvbmFsIHRvIHRoZSBudW1iZXIgb2YKICAgICAgLy8gdW5pcXVlIG5lc3RlZCBzdHJ1Y3R1cmVzLgogICAgICBpZiAoYVN0YWNrW2xlbmd0aF0gPT0gYSkgcmV0dXJuIGJTdGFja1tsZW5ndGhdID09IGI7CiAgICB9CiAgICAvLyBPYmplY3RzIHdpdGggZGlmZmVyZW50IGNvbnN0cnVjdG9ycyBhcmUgbm90IGVxdWl2YWxlbnQsIGJ1dCBgT2JqZWN0YHMKICAgIC8vIGZyb20gZGlmZmVyZW50IGZyYW1lcyBhcmUuCiAgICB2YXIgYUN0b3IgPSBhLmNvbnN0cnVjdG9yLCBiQ3RvciA9IGIuY29uc3RydWN0b3I7CiAgICBpZiAoYUN0b3IgIT09IGJDdG9yICYmICEoXy5pc0Z1bmN0aW9uKGFDdG9yKSAmJiAoYUN0b3IgaW5zdGFuY2VvZiBhQ3RvcikgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfLmlzRnVuY3Rpb24oYkN0b3IpICYmIChiQ3RvciBpbnN0YW5jZW9mIGJDdG9yKSkKICAgICAgICAgICAgICAgICAgICAgICAgJiYgKCdjb25zdHJ1Y3RvcicgaW4gYSAmJiAnY29uc3RydWN0b3InIGluIGIpKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIC8vIEFkZCB0aGUgZmlyc3Qgb2JqZWN0IHRvIHRoZSBzdGFjayBvZiB0cmF2ZXJzZWQgb2JqZWN0cy4KICAgIGFTdGFjay5wdXNoKGEpOwogICAgYlN0YWNrLnB1c2goYik7CiAgICB2YXIgc2l6ZSA9IDAsIHJlc3VsdCA9IHRydWU7CiAgICAvLyBSZWN1cnNpdmVseSBjb21wYXJlIG9iamVjdHMgYW5kIGFycmF5cy4KICAgIGlmIChjbGFzc05hbWUgPT0gJ1tvYmplY3QgQXJyYXldJykgewogICAgICAvLyBDb21wYXJlIGFycmF5IGxlbmd0aHMgdG8gZGV0ZXJtaW5lIGlmIGEgZGVlcCBjb21wYXJpc29uIGlzIG5lY2Vzc2FyeS4KICAgICAgc2l6ZSA9IGEubGVuZ3RoOwogICAgICByZXN1bHQgPSBzaXplID09IGIubGVuZ3RoOwogICAgICBpZiAocmVzdWx0KSB7CiAgICAgICAgLy8gRGVlcCBjb21wYXJlIHRoZSBjb250ZW50cywgaWdub3Jpbmcgbm9uLW51bWVyaWMgcHJvcGVydGllcy4KICAgICAgICB3aGlsZSAoc2l6ZS0tKSB7CiAgICAgICAgICBpZiAoIShyZXN1bHQgPSBlcShhW3NpemVdLCBiW3NpemVdLCBhU3RhY2ssIGJTdGFjaykpKSBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIC8vIERlZXAgY29tcGFyZSBvYmplY3RzLgogICAgICBmb3IgKHZhciBrZXkgaW4gYSkgewogICAgICAgIGlmIChfLmhhcyhhLCBrZXkpKSB7CiAgICAgICAgICAvLyBDb3VudCB0aGUgZXhwZWN0ZWQgbnVtYmVyIG9mIHByb3BlcnRpZXMuCiAgICAgICAgICBzaXplKys7CiAgICAgICAgICAvLyBEZWVwIGNvbXBhcmUgZWFjaCBtZW1iZXIuCiAgICAgICAgICBpZiAoIShyZXN1bHQgPSBfLmhhcyhiLCBrZXkpICYmIGVxKGFba2V5XSwgYltrZXldLCBhU3RhY2ssIGJTdGFjaykpKSBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgICAgLy8gRW5zdXJlIHRoYXQgYm90aCBvYmplY3RzIGNvbnRhaW4gdGhlIHNhbWUgbnVtYmVyIG9mIHByb3BlcnRpZXMuCiAgICAgIGlmIChyZXN1bHQpIHsKICAgICAgICBmb3IgKGtleSBpbiBiKSB7CiAgICAgICAgICBpZiAoXy5oYXMoYiwga2V5KSAmJiAhKHNpemUtLSkpIGJyZWFrOwogICAgICAgIH0KICAgICAgICByZXN1bHQgPSAhc2l6ZTsKICAgICAgfQogICAgfQogICAgLy8gUmVtb3ZlIHRoZSBmaXJzdCBvYmplY3QgZnJvbSB0aGUgc3RhY2sgb2YgdHJhdmVyc2VkIG9iamVjdHMuCiAgICBhU3RhY2sucG9wKCk7CiAgICBiU3RhY2sucG9wKCk7CiAgICByZXR1cm4gcmVzdWx0OwogIH07CgogIC8vIFBlcmZvcm0gYSBkZWVwIGNvbXBhcmlzb24gdG8gY2hlY2sgaWYgdHdvIG9iamVjdHMgYXJlIGVxdWFsLgogIF8uaXNFcXVhbCA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgIHJldHVybiBlcShhLCBiLCBbXSwgW10pOwogIH07CgogIC8vIElzIGEgZ2l2ZW4gYXJyYXksIHN0cmluZywgb3Igb2JqZWN0IGVtcHR5PwogIC8vIEFuICJlbXB0eSIgb2JqZWN0IGhhcyBubyBlbnVtZXJhYmxlIG93bi1wcm9wZXJ0aWVzLgogIF8uaXNFbXB0eSA9IGZ1bmN0aW9uKG9iaikgewogICAgaWYgKG9iaiA9PSBudWxsKSByZXR1cm4gdHJ1ZTsKICAgIGlmIChfLmlzQXJyYXkob2JqKSB8fCBfLmlzU3RyaW5nKG9iaikpIHJldHVybiBvYmoubGVuZ3RoID09PSAwOwogICAgZm9yICh2YXIga2V5IGluIG9iaikgaWYgKF8uaGFzKG9iaiwga2V5KSkgcmV0dXJuIGZhbHNlOwogICAgcmV0dXJuIHRydWU7CiAgfTsKCiAgLy8gSXMgYSBnaXZlbiB2YWx1ZSBhIERPTSBlbGVtZW50PwogIF8uaXNFbGVtZW50ID0gZnVuY3Rpb24ob2JqKSB7CiAgICByZXR1cm4gISEob2JqICYmIG9iai5ub2RlVHlwZSA9PT0gMSk7CiAgfTsKCiAgLy8gSXMgYSBnaXZlbiB2YWx1ZSBhbiBhcnJheT8KICAvLyBEZWxlZ2F0ZXMgdG8gRUNNQTUncyBuYXRpdmUgQXJyYXkuaXNBcnJheQogIF8uaXNBcnJheSA9IG5hdGl2ZUlzQXJyYXkgfHwgZnVuY3Rpb24ob2JqKSB7CiAgICByZXR1cm4gdG9TdHJpbmcuY2FsbChvYmopID09ICdbb2JqZWN0IEFycmF5XSc7CiAgfTsKCiAgLy8gSXMgYSBnaXZlbiB2YXJpYWJsZSBhbiBvYmplY3Q/CiAgXy5pc09iamVjdCA9IGZ1bmN0aW9uKG9iaikgewogICAgcmV0dXJuIG9iaiA9PT0gT2JqZWN0KG9iaik7CiAgfTsKCiAgLy8gQWRkIHNvbWUgaXNUeXBlIG1ldGhvZHM6IGlzQXJndW1lbnRzLCBpc0Z1bmN0aW9uLCBpc1N0cmluZywgaXNOdW1iZXIsIGlzRGF0ZSwgaXNSZWdFeHAuCiAgZWFjaChbJ0FyZ3VtZW50cycsICdGdW5jdGlvbicsICdTdHJpbmcnLCAnTnVtYmVyJywgJ0RhdGUnLCAnUmVnRXhwJ10sIGZ1bmN0aW9uKG5hbWUpIHsKICAgIF9bJ2lzJyArIG5hbWVdID0gZnVuY3Rpb24ob2JqKSB7CiAgICAgIHJldHVybiB0b1N0cmluZy5jYWxsKG9iaikgPT0gJ1tvYmplY3QgJyArIG5hbWUgKyAnXSc7CiAgICB9OwogIH0pOwoKICAvLyBEZWZpbmUgYSBmYWxsYmFjayB2ZXJzaW9uIG9mIHRoZSBtZXRob2QgaW4gYnJvd3NlcnMgKGFoZW0sIElFKSwgd2hlcmUKICAvLyB0aGVyZSBpc24ndCBhbnkgaW5zcGVjdGFibGUgIkFyZ3VtZW50cyIgdHlwZS4KICBpZiAoIV8uaXNBcmd1bWVudHMoYXJndW1lbnRzKSkgewogICAgXy5pc0FyZ3VtZW50cyA9IGZ1bmN0aW9uKG9iaikgewogICAgICByZXR1cm4gISEob2JqICYmIF8uaGFzKG9iaiwgJ2NhbGxlZScpKTsKICAgIH07CiAgfQoKICAvLyBPcHRpbWl6ZSBgaXNGdW5jdGlvbmAgaWYgYXBwcm9wcmlhdGUuCiAgaWYgKHR5cGVvZiAoLy4vKSAhPT0gJ2Z1bmN0aW9uJykgewogICAgXy5pc0Z1bmN0aW9uID0gZnVuY3Rpb24ob2JqKSB7CiAgICAgIHJldHVybiB0eXBlb2Ygb2JqID09PSAnZnVuY3Rpb24nOwogICAgfTsKICB9CgogIC8vIElzIGEgZ2l2ZW4gb2JqZWN0IGEgZmluaXRlIG51bWJlcj8KICBfLmlzRmluaXRlID0gZnVuY3Rpb24ob2JqKSB7CiAgICByZXR1cm4gaXNGaW5pdGUob2JqKSAmJiAhaXNOYU4ocGFyc2VGbG9hdChvYmopKTsKICB9OwoKICAvLyBJcyB0aGUgZ2l2ZW4gdmFsdWUgYE5hTmA/IChOYU4gaXMgdGhlIG9ubHkgbnVtYmVyIHdoaWNoIGRvZXMgbm90IGVxdWFsIGl0c2VsZikuCiAgXy5pc05hTiA9IGZ1bmN0aW9uKG9iaikgewogICAgcmV0dXJuIF8uaXNOdW1iZXIob2JqKSAmJiBvYmogIT0gK29iajsKICB9OwoKICAvLyBJcyBhIGdpdmVuIHZhbHVlIGEgYm9vbGVhbj8KICBfLmlzQm9vbGVhbiA9IGZ1bmN0aW9uKG9iaikgewogICAgcmV0dXJuIG9iaiA9PT0gdHJ1ZSB8fCBvYmogPT09IGZhbHNlIHx8IHRvU3RyaW5nLmNhbGwob2JqKSA9PSAnW29iamVjdCBCb29sZWFuXSc7CiAgfTsKCiAgLy8gSXMgYSBnaXZlbiB2YWx1ZSBlcXVhbCB0byBudWxsPwogIF8uaXNOdWxsID0gZnVuY3Rpb24ob2JqKSB7CiAgICByZXR1cm4gb2JqID09PSBudWxsOwogIH07CgogIC8vIElzIGEgZ2l2ZW4gdmFyaWFibGUgdW5kZWZpbmVkPwogIF8uaXNVbmRlZmluZWQgPSBmdW5jdGlvbihvYmopIHsKICAgIHJldHVybiBvYmogPT09IHZvaWQgMDsKICB9OwoKICAvLyBTaG9ydGN1dCBmdW5jdGlvbiBmb3IgY2hlY2tpbmcgaWYgYW4gb2JqZWN0IGhhcyBhIGdpdmVuIHByb3BlcnR5IGRpcmVjdGx5CiAgLy8gb24gaXRzZWxmIChpbiBvdGhlciB3b3Jkcywgbm90IG9uIGEgcHJvdG90eXBlKS4KICBfLmhhcyA9IGZ1bmN0aW9uKG9iaiwga2V5KSB7CiAgICByZXR1cm4gaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSk7CiAgfTsKCiAgLy8gVXRpbGl0eSBGdW5jdGlvbnMKICAvLyAtLS0tLS0tLS0tLS0tLS0tLQoKICAvLyBSdW4gVW5kZXJzY29yZS5qcyBpbiAqbm9Db25mbGljdCogbW9kZSwgcmV0dXJuaW5nIHRoZSBgX2AgdmFyaWFibGUgdG8gaXRzCiAgLy8gcHJldmlvdXMgb3duZXIuIFJldHVybnMgYSByZWZlcmVuY2UgdG8gdGhlIFVuZGVyc2NvcmUgb2JqZWN0LgogIF8ubm9Db25mbGljdCA9IGZ1bmN0aW9uKCkgewogICAgcm9vdC5fID0gcHJldmlvdXNVbmRlcnNjb3JlOwogICAgcmV0dXJuIHRoaXM7CiAgfTsKCiAgLy8gS2VlcCB0aGUgaWRlbnRpdHkgZnVuY3Rpb24gYXJvdW5kIGZvciBkZWZhdWx0IGl0ZXJhdG9ycy4KICBfLmlkZW50aXR5ID0gZnVuY3Rpb24odmFsdWUpIHsKICAgIHJldHVybiB2YWx1ZTsKICB9OwoKICBfLmNvbnN0YW50ID0gZnVuY3Rpb24odmFsdWUpIHsKICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH07CiAgfTsKCiAgXy5wcm9wZXJ0eSA9IGZ1bmN0aW9uKGtleSkgewogICAgcmV0dXJuIGZ1bmN0aW9uKG9iaikgewogICAgICByZXR1cm4gb2JqW2tleV07CiAgICB9OwogIH07CgogIC8vIFJldHVybnMgYSBwcmVkaWNhdGUgZm9yIGNoZWNraW5nIHdoZXRoZXIgYW4gb2JqZWN0IGhhcyBhIGdpdmVuIHNldCBvZiBga2V5OnZhbHVlYCBwYWlycy4KICBfLm1hdGNoZXMgPSBmdW5jdGlvbihhdHRycykgewogICAgcmV0dXJuIGZ1bmN0aW9uKG9iaikgewogICAgICBpZiAob2JqID09PSBhdHRycykgcmV0dXJuIHRydWU7IC8vYXZvaWQgY29tcGFyaW5nIGFuIG9iamVjdCB0byBpdHNlbGYuCiAgICAgIGZvciAodmFyIGtleSBpbiBhdHRycykgewogICAgICAgIGlmIChhdHRyc1trZXldICE9PSBvYmpba2V5XSkKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICB9OwoKICAvLyBSdW4gYSBmdW5jdGlvbiAqKm4qKiB0aW1lcy4KICBfLnRpbWVzID0gZnVuY3Rpb24obiwgaXRlcmF0b3IsIGNvbnRleHQpIHsKICAgIHZhciBhY2N1bSA9IEFycmF5KE1hdGgubWF4KDAsIG4pKTsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbjsgaSsrKSBhY2N1bVtpXSA9IGl0ZXJhdG9yLmNhbGwoY29udGV4dCwgaSk7CiAgICByZXR1cm4gYWNjdW07CiAgfTsKCiAgLy8gUmV0dXJuIGEgcmFuZG9tIGludGVnZXIgYmV0d2VlbiBtaW4gYW5kIG1heCAoaW5jbHVzaXZlKS4KICBfLnJhbmRvbSA9IGZ1bmN0aW9uKG1pbiwgbWF4KSB7CiAgICBpZiAobWF4ID09IG51bGwpIHsKICAgICAgbWF4ID0gbWluOwogICAgICBtaW4gPSAwOwogICAgfQogICAgcmV0dXJuIG1pbiArIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChtYXggLSBtaW4gKyAxKSk7CiAgfTsKCiAgLy8gQSAocG9zc2libHkgZmFzdGVyKSB3YXkgdG8gZ2V0IHRoZSBjdXJyZW50IHRpbWVzdGFtcCBhcyBhbiBpbnRlZ2VyLgogIF8ubm93ID0gRGF0ZS5ub3cgfHwgZnVuY3Rpb24oKSB7IHJldHVybiBuZXcgRGF0ZSgpLmdldFRpbWUoKTsgfTsKCiAgLy8gTGlzdCBvZiBIVE1MIGVudGl0aWVzIGZvciBlc2NhcGluZy4KICB2YXIgZW50aXR5TWFwID0gewogICAgZXNjYXBlOiB7CiAgICAgICcmJzogJyZhbXA7JywKICAgICAgJzwnOiAnJmx0OycsCiAgICAgICc+JzogJyZndDsnLAogICAgICAnIic6ICcmcXVvdDsnLAogICAgICAiJyI6ICcmI3gyNzsnCiAgICB9CiAgfTsKICBlbnRpdHlNYXAudW5lc2NhcGUgPSBfLmludmVydChlbnRpdHlNYXAuZXNjYXBlKTsKCiAgLy8gUmVnZXhlcyBjb250YWluaW5nIHRoZSBrZXlzIGFuZCB2YWx1ZXMgbGlzdGVkIGltbWVkaWF0ZWx5IGFib3ZlLgogIHZhciBlbnRpdHlSZWdleGVzID0gewogICAgZXNjYXBlOiAgIG5ldyBSZWdFeHAoJ1snICsgXy5rZXlzKGVudGl0eU1hcC5lc2NhcGUpLmpvaW4oJycpICsgJ10nLCAnZycpLAogICAgdW5lc2NhcGU6IG5ldyBSZWdFeHAoJygnICsgXy5rZXlzKGVudGl0eU1hcC51bmVzY2FwZSkuam9pbignfCcpICsgJyknLCAnZycpCiAgfTsKCiAgLy8gRnVuY3Rpb25zIGZvciBlc2NhcGluZyBhbmQgdW5lc2NhcGluZyBzdHJpbmdzIHRvL2Zyb20gSFRNTCBpbnRlcnBvbGF0aW9uLgogIF8uZWFjaChbJ2VzY2FwZScsICd1bmVzY2FwZSddLCBmdW5jdGlvbihtZXRob2QpIHsKICAgIF9bbWV0aG9kXSA9IGZ1bmN0aW9uKHN0cmluZykgewogICAgICBpZiAoc3RyaW5nID09IG51bGwpIHJldHVybiAnJzsKICAgICAgcmV0dXJuICgnJyArIHN0cmluZykucmVwbGFjZShlbnRpdHlSZWdleGVzW21ldGhvZF0sIGZ1bmN0aW9uKG1hdGNoKSB7CiAgICAgICAgcmV0dXJuIGVudGl0eU1hcFttZXRob2RdW21hdGNoXTsKICAgICAgfSk7CiAgICB9OwogIH0pOwoKICAvLyBJZiB0aGUgdmFsdWUgb2YgdGhlIG5hbWVkIGBwcm9wZXJ0eWAgaXMgYSBmdW5jdGlvbiB0aGVuIGludm9rZSBpdCB3aXRoIHRoZQogIC8vIGBvYmplY3RgIGFzIGNvbnRleHQ7IG90aGVyd2lzZSwgcmV0dXJuIGl0LgogIF8ucmVzdWx0ID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgewogICAgaWYgKG9iamVjdCA9PSBudWxsKSByZXR1cm4gdm9pZCAwOwogICAgdmFyIHZhbHVlID0gb2JqZWN0W3Byb3BlcnR5XTsKICAgIHJldHVybiBfLmlzRnVuY3Rpb24odmFsdWUpID8gdmFsdWUuY2FsbChvYmplY3QpIDogdmFsdWU7CiAgfTsKCiAgLy8gQWRkIHlvdXIgb3duIGN1c3RvbSBmdW5jdGlvbnMgdG8gdGhlIFVuZGVyc2NvcmUgb2JqZWN0LgogIF8ubWl4aW4gPSBmdW5jdGlvbihvYmopIHsKICAgIGVhY2goXy5mdW5jdGlvbnMob2JqKSwgZnVuY3Rpb24obmFtZSkgewogICAgICB2YXIgZnVuYyA9IF9bbmFtZV0gPSBvYmpbbmFtZV07CiAgICAgIF8ucHJvdG90eXBlW25hbWVdID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGFyZ3MgPSBbdGhpcy5fd3JhcHBlZF07CiAgICAgICAgcHVzaC5hcHBseShhcmdzLCBhcmd1bWVudHMpOwogICAgICAgIHJldHVybiByZXN1bHQuY2FsbCh0aGlzLCBmdW5jLmFwcGx5KF8sIGFyZ3MpKTsKICAgICAgfTsKICAgIH0pOwogIH07CgogIC8vIEdlbmVyYXRlIGEgdW5pcXVlIGludGVnZXIgaWQgKHVuaXF1ZSB3aXRoaW4gdGhlIGVudGlyZSBjbGllbnQgc2Vzc2lvbikuCiAgLy8gVXNlZnVsIGZvciB0ZW1wb3JhcnkgRE9NIGlkcy4KICB2YXIgaWRDb3VudGVyID0gMDsKICBfLnVuaXF1ZUlkID0gZnVuY3Rpb24ocHJlZml4KSB7CiAgICB2YXIgaWQgPSArK2lkQ291bnRlciArICcnOwogICAgcmV0dXJuIHByZWZpeCA/IHByZWZpeCArIGlkIDogaWQ7CiAgfTsKCiAgLy8gQnkgZGVmYXVsdCwgVW5kZXJzY29yZSB1c2VzIEVSQi1zdHlsZSB0ZW1wbGF0ZSBkZWxpbWl0ZXJzLCBjaGFuZ2UgdGhlCiAgLy8gZm9sbG93aW5nIHRlbXBsYXRlIHNldHRpbmdzIHRvIHVzZSBhbHRlcm5hdGl2ZSBkZWxpbWl0ZXJzLgogIF8udGVtcGxhdGVTZXR0aW5ncyA9IHsKICAgIGV2YWx1YXRlICAgIDogLzwlKFtcc1xTXSs/KSU+L2csCiAgICBpbnRlcnBvbGF0ZSA6IC88JT0oW1xzXFNdKz8pJT4vZywKICAgIGVzY2FwZSAgICAgIDogLzwlLShbXHNcU10rPyklPi9nCiAgfTsKCiAgLy8gV2hlbiBjdXN0b21pemluZyBgdGVtcGxhdGVTZXR0aW5nc2AsIGlmIHlvdSBkb24ndCB3YW50IHRvIGRlZmluZSBhbgogIC8vIGludGVycG9sYXRpb24sIGV2YWx1YXRpb24gb3IgZXNjYXBpbmcgcmVnZXgsIHdlIG5lZWQgb25lIHRoYXQgaXMKICAvLyBndWFyYW50ZWVkIG5vdCB0byBtYXRjaC4KICB2YXIgbm9NYXRjaCA9IC8oLileLzsKCiAgLy8gQ2VydGFpbiBjaGFyYWN0ZXJzIG5lZWQgdG8gYmUgZXNjYXBlZCBzbyB0aGF0IHRoZXkgY2FuIGJlIHB1dCBpbnRvIGEKICAvLyBzdHJpbmcgbGl0ZXJhbC4KICB2YXIgZXNjYXBlcyA9IHsKICAgICInIjogICAgICAiJyIsCiAgICAnXFwnOiAgICAgJ1xcJywKICAgICdccic6ICAgICAncicsCiAgICAnXG4nOiAgICAgJ24nLAogICAgJ1x0JzogICAgICd0JywKICAgICdcdTIwMjgnOiAndTIwMjgnLAogICAgJ1x1MjAyOSc6ICd1MjAyOScKICB9OwoKICB2YXIgZXNjYXBlciA9IC9cXHwnfFxyfFxufFx0fFx1MjAyOHxcdTIwMjkvZzsKCiAgLy8gSmF2YVNjcmlwdCBtaWNyby10ZW1wbGF0aW5nLCBzaW1pbGFyIHRvIEpvaG4gUmVzaWcncyBpbXBsZW1lbnRhdGlvbi4KICAvLyBVbmRlcnNjb3JlIHRlbXBsYXRpbmcgaGFuZGxlcyBhcmJpdHJhcnkgZGVsaW1pdGVycywgcHJlc2VydmVzIHdoaXRlc3BhY2UsCiAgLy8gYW5kIGNvcnJlY3RseSBlc2NhcGVzIHF1b3RlcyB3aXRoaW4gaW50ZXJwb2xhdGVkIGNvZGUuCiAgXy50ZW1wbGF0ZSA9IGZ1bmN0aW9uKHRleHQsIGRhdGEsIHNldHRpbmdzKSB7CiAgICB2YXIgcmVuZGVyOwogICAgc2V0dGluZ3MgPSBfLmRlZmF1bHRzKHt9LCBzZXR0aW5ncywgXy50ZW1wbGF0ZVNldHRpbmdzKTsKCiAgICAvLyBDb21iaW5lIGRlbGltaXRlcnMgaW50byBvbmUgcmVndWxhciBleHByZXNzaW9uIHZpYSBhbHRlcm5hdGlvbi4KICAgIHZhciBtYXRjaGVyID0gbmV3IFJlZ0V4cChbCiAgICAgIChzZXR0aW5ncy5lc2NhcGUgfHwgbm9NYXRjaCkuc291cmNlLAogICAgICAoc2V0dGluZ3MuaW50ZXJwb2xhdGUgfHwgbm9NYXRjaCkuc291cmNlLAogICAgICAoc2V0dGluZ3MuZXZhbHVhdGUgfHwgbm9NYXRjaCkuc291cmNlCiAgICBdLmpvaW4oJ3wnKSArICd8JCcsICdnJyk7CgogICAgLy8gQ29tcGlsZSB0aGUgdGVtcGxhdGUgc291cmNlLCBlc2NhcGluZyBzdHJpbmcgbGl0ZXJhbHMgYXBwcm9wcmlhdGVseS4KICAgIHZhciBpbmRleCA9IDA7CiAgICB2YXIgc291cmNlID0gIl9fcCs9JyI7CiAgICB0ZXh0LnJlcGxhY2UobWF0Y2hlciwgZnVuY3Rpb24obWF0Y2gsIGVzY2FwZSwgaW50ZXJwb2xhdGUsIGV2YWx1YXRlLCBvZmZzZXQpIHsKICAgICAgc291cmNlICs9IHRleHQuc2xpY2UoaW5kZXgsIG9mZnNldCkKICAgICAgICAucmVwbGFjZShlc2NhcGVyLCBmdW5jdGlvbihtYXRjaCkgeyByZXR1cm4gJ1xcJyArIGVzY2FwZXNbbWF0Y2hdOyB9KTsKCiAgICAgIGlmIChlc2NhcGUpIHsKICAgICAgICBzb3VyY2UgKz0gIicrXG4oKF9fdD0oIiArIGVzY2FwZSArICIpKT09bnVsbD8nJzpfLmVzY2FwZShfX3QpKStcbiciOwogICAgICB9CiAgICAgIGlmIChpbnRlcnBvbGF0ZSkgewogICAgICAgIHNvdXJjZSArPSAiJytcbigoX190PSgiICsgaW50ZXJwb2xhdGUgKyAiKSk9PW51bGw/Jyc6X190KStcbiciOwogICAgICB9CiAgICAgIGlmIChldmFsdWF0ZSkgewogICAgICAgIHNvdXJjZSArPSAiJztcbiIgKyBldmFsdWF0ZSArICJcbl9fcCs9JyI7CiAgICAgIH0KICAgICAgaW5kZXggPSBvZmZzZXQgKyBtYXRjaC5sZW5ndGg7CiAgICAgIHJldHVybiBtYXRjaDsKICAgIH0pOwogICAgc291cmNlICs9ICInO1xuIjsKCiAgICAvLyBJZiBhIHZhcmlhYmxlIGlzIG5vdCBzcGVjaWZpZWQsIHBsYWNlIGRhdGEgdmFsdWVzIGluIGxvY2FsIHNjb3BlLgogICAgaWYgKCFzZXR0aW5ncy52YXJpYWJsZSkgc291cmNlID0gJ3dpdGgob2JqfHx7fSl7XG4nICsgc291cmNlICsgJ31cbic7CgogICAgc291cmNlID0gInZhciBfX3QsX19wPScnLF9faj1BcnJheS5wcm90b3R5cGUuam9pbiwiICsKICAgICAgInByaW50PWZ1bmN0aW9uKCl7X19wKz1fX2ouY2FsbChhcmd1bWVudHMsJycpO307XG4iICsKICAgICAgc291cmNlICsgInJldHVybiBfX3A7XG4iOwoKICAgIHRyeSB7CiAgICAgIHJlbmRlciA9IG5ldyBGdW5jdGlvbihzZXR0aW5ncy52YXJpYWJsZSB8fCAnb2JqJywgJ18nLCBzb3VyY2UpOwogICAgfSBjYXRjaCAoZSkgewogICAgICBlLnNvdXJjZSA9IHNvdXJjZTsKICAgICAgdGhyb3cgZTsKICAgIH0KCiAgICBpZiAoZGF0YSkgcmV0dXJuIHJlbmRlcihkYXRhLCBfKTsKICAgIHZhciB0ZW1wbGF0ZSA9IGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgcmV0dXJuIHJlbmRlci5jYWxsKHRoaXMsIGRhdGEsIF8pOwogICAgfTsKCiAgICAvLyBQcm92aWRlIHRoZSBjb21waWxlZCBmdW5jdGlvbiBzb3VyY2UgYXMgYSBjb252ZW5pZW5jZSBmb3IgcHJlY29tcGlsYXRpb24uCiAgICB0ZW1wbGF0ZS5zb3VyY2UgPSAnZnVuY3Rpb24oJyArIChzZXR0aW5ncy52YXJpYWJsZSB8fCAnb2JqJykgKyAnKXtcbicgKyBzb3VyY2UgKyAnfSc7CgogICAgcmV0dXJuIHRlbXBsYXRlOwogIH07CgogIC8vIEFkZCBhICJjaGFpbiIgZnVuY3Rpb24sIHdoaWNoIHdpbGwgZGVsZWdhdGUgdG8gdGhlIHdyYXBwZXIuCiAgXy5jaGFpbiA9IGZ1bmN0aW9uKG9iaikgewogICAgcmV0dXJuIF8ob2JqKS5jaGFpbigpOwogIH07CgogIC8vIE9PUAogIC8vIC0tLS0tLS0tLS0tLS0tLQogIC8vIElmIFVuZGVyc2NvcmUgaXMgY2FsbGVkIGFzIGEgZnVuY3Rpb24sIGl0IHJldHVybnMgYSB3cmFwcGVkIG9iamVjdCB0aGF0CiAgLy8gY2FuIGJlIHVzZWQgT08tc3R5bGUuIFRoaXMgd3JhcHBlciBob2xkcyBhbHRlcmVkIHZlcnNpb25zIG9mIGFsbCB0aGUKICAvLyB1bmRlcnNjb3JlIGZ1bmN0aW9ucy4gV3JhcHBlZCBvYmplY3RzIG1heSBiZSBjaGFpbmVkLgoKICAvLyBIZWxwZXIgZnVuY3Rpb24gdG8gY29udGludWUgY2hhaW5pbmcgaW50ZXJtZWRpYXRlIHJlc3VsdHMuCiAgdmFyIHJlc3VsdCA9IGZ1bmN0aW9uKG9iaikgewogICAgcmV0dXJuIHRoaXMuX2NoYWluID8gXyhvYmopLmNoYWluKCkgOiBvYmo7CiAgfTsKCiAgLy8gQWRkIGFsbCBvZiB0aGUgVW5kZXJzY29yZSBmdW5jdGlvbnMgdG8gdGhlIHdyYXBwZXIgb2JqZWN0LgogIF8ubWl4aW4oXyk7CgogIC8vIEFkZCBhbGwgbXV0YXRvciBBcnJheSBmdW5jdGlvbnMgdG8gdGhlIHdyYXBwZXIuCiAgZWFjaChbJ3BvcCcsICdwdXNoJywgJ3JldmVyc2UnLCAnc2hpZnQnLCAnc29ydCcsICdzcGxpY2UnLCAndW5zaGlmdCddLCBmdW5jdGlvbihuYW1lKSB7CiAgICB2YXIgbWV0aG9kID0gQXJyYXlQcm90b1tuYW1lXTsKICAgIF8ucHJvdG90eXBlW25hbWVdID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBvYmogPSB0aGlzLl93cmFwcGVkOwogICAgICBtZXRob2QuYXBwbHkob2JqLCBhcmd1bWVudHMpOwogICAgICBpZiAoKG5hbWUgPT0gJ3NoaWZ0JyB8fCBuYW1lID09ICdzcGxpY2UnKSAmJiBvYmoubGVuZ3RoID09PSAwKSBkZWxldGUgb2JqWzBdOwogICAgICByZXR1cm4gcmVzdWx0LmNhbGwodGhpcywgb2JqKTsKICAgIH07CiAgfSk7CgogIC8vIEFkZCBhbGwgYWNjZXNzb3IgQXJyYXkgZnVuY3Rpb25zIHRvIHRoZSB3cmFwcGVyLgogIGVhY2goWydjb25jYXQnLCAnam9pbicsICdzbGljZSddLCBmdW5jdGlvbihuYW1lKSB7CiAgICB2YXIgbWV0aG9kID0gQXJyYXlQcm90b1tuYW1lXTsKICAgIF8ucHJvdG90eXBlW25hbWVdID0gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiByZXN1bHQuY2FsbCh0aGlzLCBtZXRob2QuYXBwbHkodGhpcy5fd3JhcHBlZCwgYXJndW1lbnRzKSk7CiAgICB9OwogIH0pOwoKICBfLmV4dGVuZChfLnByb3RvdHlwZSwgewoKICAgIC8vIFN0YXJ0IGNoYWluaW5nIGEgd3JhcHBlZCBVbmRlcnNjb3JlIG9iamVjdC4KICAgIGNoYWluOiBmdW5jdGlvbigpIHsKICAgICAgdGhpcy5fY2hhaW4gPSB0cnVlOwogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLy8gRXh0cmFjdHMgdGhlIHJlc3VsdCBmcm9tIGEgd3JhcHBlZCBhbmQgY2hhaW5lZCBvYmplY3QuCiAgICB2YWx1ZTogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiB0aGlzLl93cmFwcGVkOwogICAgfQoKICB9KTsKCiAgLy8gQU1EIHJlZ2lzdHJhdGlvbiBoYXBwZW5zIGF0IHRoZSBlbmQgZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBBTUQgbG9hZGVycwogIC8vIHRoYXQgbWF5IG5vdCBlbmZvcmNlIG5leHQtdHVybiBzZW1hbnRpY3Mgb24gbW9kdWxlcy4gRXZlbiB0aG91Z2ggZ2VuZXJhbAogIC8vIHByYWN0aWNlIGZvciBBTUQgcmVnaXN0cmF0aW9uIGlzIHRvIGJlIGFub255bW91cywgdW5kZXJzY29yZSByZWdpc3RlcnMKICAvLyBhcyBhIG5hbWVkIG1vZHVsZSBiZWNhdXNlLCBsaWtlIGpRdWVyeSwgaXQgaXMgYSBiYXNlIGxpYnJhcnkgdGhhdCBpcwogIC8vIHBvcHVsYXIgZW5vdWdoIHRvIGJlIGJ1bmRsZWQgaW4gYSB0aGlyZCBwYXJ0eSBsaWIsIGJ1dCBub3QgYmUgcGFydCBvZgogIC8vIGFuIEFNRCBsb2FkIHJlcXVlc3QuIFRob3NlIGNhc2VzIGNvdWxkIGdlbmVyYXRlIGFuIGVycm9yIHdoZW4gYW4KICAvLyBhbm9ueW1vdXMgZGVmaW5lKCkgaXMgY2FsbGVkIG91dHNpZGUgb2YgYSBsb2FkZXIgcmVxdWVzdC4KICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7CiAgICBkZWZpbmUoJ3VuZGVyc2NvcmUnLCBbXSwgZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBfOwogICAgfSk7CiAgfQp9KS5jYWxsKHRoaXMpOwoKLyoqCiAqIGEgc2luZ2xldG9uIG9iamVjdCB0aGF0IHdpbGwgaGFuZGxlIGdsb2JhbCBzY29wZSBjb25maWd1cmF0aW9uIChwYXRoIHRvIHdldCBpbmZvIHJlc3Qgc2VydmljZSBldGMuLikKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCmRlZmluZSgnQ29uZmlnJyxbJ3VuZGVyc2NvcmUnXSwgZnVuY3Rpb24gKF8pIHsKICAgIF8udGVtcGxhdGVTZXR0aW5ncyA9IHsKICAgICAgICBpbnRlcnBvbGF0ZTogL1x7XHsoLis/KVx9XH0vZwogICAgfTsKCiAgICBDb25maWcgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgIHNlbGYuZGF0YSA9IHt9CiAgICB9CiAgICBDb25maWcucHJvdG90eXBlLnNldCA9IGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7CiAgICAgICAgdGhpcy5kYXRhW2tleV0gPSB2YWx1ZTsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIENvbmZpZy5wcm90b3R5cGUuZ2V0ID0gZnVuY3Rpb24gKGtleSkgewogICAgICAgIHJldHVybiB0aGlzLmRhdGFba2V5XTsKICAgIH0KCiAgICByZXR1cm4gbmV3IENvbmZpZygpOwp9KTsKCi8vICAgICBCYWNrYm9uZS5qcyAxLjEuMgoKLy8gICAgIChjKSAyMDEwLTIwMTQgSmVyZW15IEFzaGtlbmFzLCBEb2N1bWVudENsb3VkIGFuZCBJbnZlc3RpZ2F0aXZlIFJlcG9ydGVycyAmIEVkaXRvcnMKLy8gICAgIEJhY2tib25lIG1heSBiZSBmcmVlbHkgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlLgovLyAgICAgRm9yIGFsbCBkZXRhaWxzIGFuZCBkb2N1bWVudGF0aW9uOgovLyAgICAgaHR0cDovL2JhY2tib25lanMub3JnCgooZnVuY3Rpb24ocm9vdCwgZmFjdG9yeSkgewoKICAvLyBTZXQgdXAgQmFja2JvbmUgYXBwcm9wcmlhdGVseSBmb3IgdGhlIGVudmlyb25tZW50LiBTdGFydCB3aXRoIEFNRC4KICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7CiAgICBkZWZpbmUoJ0JhY2tib25lJyxbJ3VuZGVyc2NvcmUnLCAnanF1ZXJ5JywgJ2V4cG9ydHMnXSwgZnVuY3Rpb24oXywgJCwgZXhwb3J0cykgewogICAgICAvLyBFeHBvcnQgZ2xvYmFsIGV2ZW4gaW4gQU1EIGNhc2UgaW4gY2FzZSB0aGlzIHNjcmlwdCBpcyBsb2FkZWQgd2l0aAogICAgICAvLyBvdGhlcnMgdGhhdCBtYXkgc3RpbGwgZXhwZWN0IGEgZ2xvYmFsIEJhY2tib25lLgogICAgICByb290LkJhY2tib25lID0gZmFjdG9yeShyb290LCBleHBvcnRzLCBfLCAkKTsKICAgIH0pOwoKICAvLyBOZXh0IGZvciBOb2RlLmpzIG9yIENvbW1vbkpTLiBqUXVlcnkgbWF5IG5vdCBiZSBuZWVkZWQgYXMgYSBtb2R1bGUuCiAgfSBlbHNlIGlmICh0eXBlb2YgZXhwb3J0cyAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgIHZhciBfID0gcmVxdWlyZSgndW5kZXJzY29yZScpOwogICAgZmFjdG9yeShyb290LCBleHBvcnRzLCBfKTsKCiAgLy8gRmluYWxseSwgYXMgYSBicm93c2VyIGdsb2JhbC4KICB9IGVsc2UgewogICAgcm9vdC5CYWNrYm9uZSA9IGZhY3Rvcnkocm9vdCwge30sIHJvb3QuXywgKHJvb3QualF1ZXJ5IHx8IHJvb3QuWmVwdG8gfHwgcm9vdC5lbmRlciB8fCByb290LiQpKTsKICB9Cgp9KHRoaXMsIGZ1bmN0aW9uKHJvb3QsIEJhY2tib25lLCBfLCAkKSB7CgogIC8vIEluaXRpYWwgU2V0dXAKICAvLyAtLS0tLS0tLS0tLS0tCgogIC8vIFNhdmUgdGhlIHByZXZpb3VzIHZhbHVlIG9mIHRoZSBgQmFja2JvbmVgIHZhcmlhYmxlLCBzbyB0aGF0IGl0IGNhbiBiZQogIC8vIHJlc3RvcmVkIGxhdGVyIG9uLCBpZiBgbm9Db25mbGljdGAgaXMgdXNlZC4KICB2YXIgcHJldmlvdXNCYWNrYm9uZSA9IHJvb3QuQmFja2JvbmU7CgogIC8vIENyZWF0ZSBsb2NhbCByZWZlcmVuY2VzIHRvIGFycmF5IG1ldGhvZHMgd2UnbGwgd2FudCB0byB1c2UgbGF0ZXIuCiAgdmFyIGFycmF5ID0gW107CiAgdmFyIHB1c2ggPSBhcnJheS5wdXNoOwogIHZhciBzbGljZSA9IGFycmF5LnNsaWNlOwogIHZhciBzcGxpY2UgPSBhcnJheS5zcGxpY2U7CgogIC8vIEN1cnJlbnQgdmVyc2lvbiBvZiB0aGUgbGlicmFyeS4gS2VlcCBpbiBzeW5jIHdpdGggYHBhY2thZ2UuanNvbmAuCiAgQmFja2JvbmUuVkVSU0lPTiA9ICcxLjEuMic7CgogIC8vIEZvciBCYWNrYm9uZSdzIHB1cnBvc2VzLCBqUXVlcnksIFplcHRvLCBFbmRlciwgb3IgTXkgTGlicmFyeSAoa2lkZGluZykgb3ducwogIC8vIHRoZSBgJGAgdmFyaWFibGUuCiAgQmFja2JvbmUuJCA9ICQ7CgogIC8vIFJ1bnMgQmFja2JvbmUuanMgaW4gKm5vQ29uZmxpY3QqIG1vZGUsIHJldHVybmluZyB0aGUgYEJhY2tib25lYCB2YXJpYWJsZQogIC8vIHRvIGl0cyBwcmV2aW91cyBvd25lci4gUmV0dXJucyBhIHJlZmVyZW5jZSB0byB0aGlzIEJhY2tib25lIG9iamVjdC4KICBCYWNrYm9uZS5ub0NvbmZsaWN0ID0gZnVuY3Rpb24oKSB7CiAgICByb290LkJhY2tib25lID0gcHJldmlvdXNCYWNrYm9uZTsKICAgIHJldHVybiB0aGlzOwogIH07CgogIC8vIFR1cm4gb24gYGVtdWxhdGVIVFRQYCB0byBzdXBwb3J0IGxlZ2FjeSBIVFRQIHNlcnZlcnMuIFNldHRpbmcgdGhpcyBvcHRpb24KICAvLyB3aWxsIGZha2UgYCJQQVRDSCJgLCBgIlBVVCJgIGFuZCBgIkRFTEVURSJgIHJlcXVlc3RzIHZpYSB0aGUgYF9tZXRob2RgIHBhcmFtZXRlciBhbmQKICAvLyBzZXQgYSBgWC1IdHRwLU1ldGhvZC1PdmVycmlkZWAgaGVhZGVyLgogIEJhY2tib25lLmVtdWxhdGVIVFRQID0gZmFsc2U7CgogIC8vIFR1cm4gb24gYGVtdWxhdGVKU09OYCB0byBzdXBwb3J0IGxlZ2FjeSBzZXJ2ZXJzIHRoYXQgY2FuJ3QgZGVhbCB3aXRoIGRpcmVjdAogIC8vIGBhcHBsaWNhdGlvbi9qc29uYCByZXF1ZXN0cyAuLi4gd2lsbCBlbmNvZGUgdGhlIGJvZHkgYXMKICAvLyBgYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkYCBpbnN0ZWFkIGFuZCB3aWxsIHNlbmQgdGhlIG1vZGVsIGluIGEKICAvLyBmb3JtIHBhcmFtIG5hbWVkIGBtb2RlbGAuCiAgQmFja2JvbmUuZW11bGF0ZUpTT04gPSBmYWxzZTsKCiAgLy8gQmFja2JvbmUuRXZlbnRzCiAgLy8gLS0tLS0tLS0tLS0tLS0tCgogIC8vIEEgbW9kdWxlIHRoYXQgY2FuIGJlIG1peGVkIGluIHRvICphbnkgb2JqZWN0KiBpbiBvcmRlciB0byBwcm92aWRlIGl0IHdpdGgKICAvLyBjdXN0b20gZXZlbnRzLiBZb3UgbWF5IGJpbmQgd2l0aCBgb25gIG9yIHJlbW92ZSB3aXRoIGBvZmZgIGNhbGxiYWNrCiAgLy8gZnVuY3Rpb25zIHRvIGFuIGV2ZW50OyBgdHJpZ2dlcmAtaW5nIGFuIGV2ZW50IGZpcmVzIGFsbCBjYWxsYmFja3MgaW4KICAvLyBzdWNjZXNzaW9uLgogIC8vCiAgLy8gICAgIHZhciBvYmplY3QgPSB7fTsKICAvLyAgICAgXy5leHRlbmQob2JqZWN0LCBCYWNrYm9uZS5FdmVudHMpOwogIC8vICAgICBvYmplY3Qub24oJ2V4cGFuZCcsIGZ1bmN0aW9uKCl7IGFsZXJ0KCdleHBhbmRlZCcpOyB9KTsKICAvLyAgICAgb2JqZWN0LnRyaWdnZXIoJ2V4cGFuZCcpOwogIC8vCiAgdmFyIEV2ZW50cyA9IEJhY2tib25lLkV2ZW50cyA9IHsKCiAgICAvLyBCaW5kIGFuIGV2ZW50IHRvIGEgYGNhbGxiYWNrYCBmdW5jdGlvbi4gUGFzc2luZyBgImFsbCJgIHdpbGwgYmluZAogICAgLy8gdGhlIGNhbGxiYWNrIHRvIGFsbCBldmVudHMgZmlyZWQuCiAgICBvbjogZnVuY3Rpb24obmFtZSwgY2FsbGJhY2ssIGNvbnRleHQpIHsKICAgICAgaWYgKCFldmVudHNBcGkodGhpcywgJ29uJywgbmFtZSwgW2NhbGxiYWNrLCBjb250ZXh0XSkgfHwgIWNhbGxiYWNrKSByZXR1cm4gdGhpczsKICAgICAgdGhpcy5fZXZlbnRzIHx8ICh0aGlzLl9ldmVudHMgPSB7fSk7CiAgICAgIHZhciBldmVudHMgPSB0aGlzLl9ldmVudHNbbmFtZV0gfHwgKHRoaXMuX2V2ZW50c1tuYW1lXSA9IFtdKTsKICAgICAgZXZlbnRzLnB1c2goe2NhbGxiYWNrOiBjYWxsYmFjaywgY29udGV4dDogY29udGV4dCwgY3R4OiBjb250ZXh0IHx8IHRoaXN9KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAoKICAgIC8vIEJpbmQgYW4gZXZlbnQgdG8gb25seSBiZSB0cmlnZ2VyZWQgYSBzaW5nbGUgdGltZS4gQWZ0ZXIgdGhlIGZpcnN0IHRpbWUKICAgIC8vIHRoZSBjYWxsYmFjayBpcyBpbnZva2VkLCBpdCB3aWxsIGJlIHJlbW92ZWQuCiAgICBvbmNlOiBmdW5jdGlvbihuYW1lLCBjYWxsYmFjaywgY29udGV4dCkgewogICAgICBpZiAoIWV2ZW50c0FwaSh0aGlzLCAnb25jZScsIG5hbWUsIFtjYWxsYmFjaywgY29udGV4dF0pIHx8ICFjYWxsYmFjaykgcmV0dXJuIHRoaXM7CiAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgdmFyIG9uY2UgPSBfLm9uY2UoZnVuY3Rpb24oKSB7CiAgICAgICAgc2VsZi5vZmYobmFtZSwgb25jZSk7CiAgICAgICAgY2FsbGJhY2suYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfSk7CiAgICAgIG9uY2UuX2NhbGxiYWNrID0gY2FsbGJhY2s7CiAgICAgIHJldHVybiB0aGlzLm9uKG5hbWUsIG9uY2UsIGNvbnRleHQpOwogICAgfSwKCiAgICAvLyBSZW1vdmUgb25lIG9yIG1hbnkgY2FsbGJhY2tzLiBJZiBgY29udGV4dGAgaXMgbnVsbCwgcmVtb3ZlcyBhbGwKICAgIC8vIGNhbGxiYWNrcyB3aXRoIHRoYXQgZnVuY3Rpb24uIElmIGBjYWxsYmFja2AgaXMgbnVsbCwgcmVtb3ZlcyBhbGwKICAgIC8vIGNhbGxiYWNrcyBmb3IgdGhlIGV2ZW50LiBJZiBgbmFtZWAgaXMgbnVsbCwgcmVtb3ZlcyBhbGwgYm91bmQKICAgIC8vIGNhbGxiYWNrcyBmb3IgYWxsIGV2ZW50cy4KICAgIG9mZjogZnVuY3Rpb24obmFtZSwgY2FsbGJhY2ssIGNvbnRleHQpIHsKICAgICAgdmFyIHJldGFpbiwgZXYsIGV2ZW50cywgbmFtZXMsIGksIGwsIGosIGs7CiAgICAgIGlmICghdGhpcy5fZXZlbnRzIHx8ICFldmVudHNBcGkodGhpcywgJ29mZicsIG5hbWUsIFtjYWxsYmFjaywgY29udGV4dF0pKSByZXR1cm4gdGhpczsKICAgICAgaWYgKCFuYW1lICYmICFjYWxsYmFjayAmJiAhY29udGV4dCkgewogICAgICAgIHRoaXMuX2V2ZW50cyA9IHZvaWQgMDsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICBuYW1lcyA9IG5hbWUgPyBbbmFtZV0gOiBfLmtleXModGhpcy5fZXZlbnRzKTsKICAgICAgZm9yIChpID0gMCwgbCA9IG5hbWVzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIG5hbWUgPSBuYW1lc1tpXTsKICAgICAgICBpZiAoZXZlbnRzID0gdGhpcy5fZXZlbnRzW25hbWVdKSB7CiAgICAgICAgICB0aGlzLl9ldmVudHNbbmFtZV0gPSByZXRhaW4gPSBbXTsKICAgICAgICAgIGlmIChjYWxsYmFjayB8fCBjb250ZXh0KSB7CiAgICAgICAgICAgIGZvciAoaiA9IDAsIGsgPSBldmVudHMubGVuZ3RoOyBqIDwgazsgaisrKSB7CiAgICAgICAgICAgICAgZXYgPSBldmVudHNbal07CiAgICAgICAgICAgICAgaWYgKChjYWxsYmFjayAmJiBjYWxsYmFjayAhPT0gZXYuY2FsbGJhY2sgJiYgY2FsbGJhY2sgIT09IGV2LmNhbGxiYWNrLl9jYWxsYmFjaykgfHwKICAgICAgICAgICAgICAgICAgKGNvbnRleHQgJiYgY29udGV4dCAhPT0gZXYuY29udGV4dCkpIHsKICAgICAgICAgICAgICAgIHJldGFpbi5wdXNoKGV2KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGlmICghcmV0YWluLmxlbmd0aCkgZGVsZXRlIHRoaXMuX2V2ZW50c1tuYW1lXTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvLyBUcmlnZ2VyIG9uZSBvciBtYW55IGV2ZW50cywgZmlyaW5nIGFsbCBib3VuZCBjYWxsYmFja3MuIENhbGxiYWNrcyBhcmUKICAgIC8vIHBhc3NlZCB0aGUgc2FtZSBhcmd1bWVudHMgYXMgYHRyaWdnZXJgIGlzLCBhcGFydCBmcm9tIHRoZSBldmVudCBuYW1lCiAgICAvLyAodW5sZXNzIHlvdSdyZSBsaXN0ZW5pbmcgb24gYCJhbGwiYCwgd2hpY2ggd2lsbCBjYXVzZSB5b3VyIGNhbGxiYWNrIHRvCiAgICAvLyByZWNlaXZlIHRoZSB0cnVlIG5hbWUgb2YgdGhlIGV2ZW50IGFzIHRoZSBmaXJzdCBhcmd1bWVudCkuCiAgICB0cmlnZ2VyOiBmdW5jdGlvbihuYW1lKSB7CiAgICAgIGlmICghdGhpcy5fZXZlbnRzKSByZXR1cm4gdGhpczsKICAgICAgdmFyIGFyZ3MgPSBzbGljZS5jYWxsKGFyZ3VtZW50cywgMSk7CiAgICAgIGlmICghZXZlbnRzQXBpKHRoaXMsICd0cmlnZ2VyJywgbmFtZSwgYXJncykpIHJldHVybiB0aGlzOwogICAgICB2YXIgZXZlbnRzID0gdGhpcy5fZXZlbnRzW25hbWVdOwogICAgICB2YXIgYWxsRXZlbnRzID0gdGhpcy5fZXZlbnRzLmFsbDsKICAgICAgaWYgKGV2ZW50cykgdHJpZ2dlckV2ZW50cyhldmVudHMsIGFyZ3MpOwogICAgICBpZiAoYWxsRXZlbnRzKSB0cmlnZ2VyRXZlbnRzKGFsbEV2ZW50cywgYXJndW1lbnRzKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAoKICAgIC8vIFRlbGwgdGhpcyBvYmplY3QgdG8gc3RvcCBsaXN0ZW5pbmcgdG8gZWl0aGVyIHNwZWNpZmljIGV2ZW50cyAuLi4gb3IKICAgIC8vIHRvIGV2ZXJ5IG9iamVjdCBpdCdzIGN1cnJlbnRseSBsaXN0ZW5pbmcgdG8uCiAgICBzdG9wTGlzdGVuaW5nOiBmdW5jdGlvbihvYmosIG5hbWUsIGNhbGxiYWNrKSB7CiAgICAgIHZhciBsaXN0ZW5pbmdUbyA9IHRoaXMuX2xpc3RlbmluZ1RvOwogICAgICBpZiAoIWxpc3RlbmluZ1RvKSByZXR1cm4gdGhpczsKICAgICAgdmFyIHJlbW92ZSA9ICFuYW1lICYmICFjYWxsYmFjazsKICAgICAgaWYgKCFjYWxsYmFjayAmJiB0eXBlb2YgbmFtZSA9PT0gJ29iamVjdCcpIGNhbGxiYWNrID0gdGhpczsKICAgICAgaWYgKG9iaikgKGxpc3RlbmluZ1RvID0ge30pW29iai5fbGlzdGVuSWRdID0gb2JqOwogICAgICBmb3IgKHZhciBpZCBpbiBsaXN0ZW5pbmdUbykgewogICAgICAgIG9iaiA9IGxpc3RlbmluZ1RvW2lkXTsKICAgICAgICBvYmoub2ZmKG5hbWUsIGNhbGxiYWNrLCB0aGlzKTsKICAgICAgICBpZiAocmVtb3ZlIHx8IF8uaXNFbXB0eShvYmouX2V2ZW50cykpIGRlbGV0ZSB0aGlzLl9saXN0ZW5pbmdUb1tpZF07CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogIH07CgogIC8vIFJlZ3VsYXIgZXhwcmVzc2lvbiB1c2VkIHRvIHNwbGl0IGV2ZW50IHN0cmluZ3MuCiAgdmFyIGV2ZW50U3BsaXR0ZXIgPSAvXHMrLzsKCiAgLy8gSW1wbGVtZW50IGZhbmN5IGZlYXR1cmVzIG9mIHRoZSBFdmVudHMgQVBJIHN1Y2ggYXMgbXVsdGlwbGUgZXZlbnQKICAvLyBuYW1lcyBgImNoYW5nZSBibHVyImAgYW5kIGpRdWVyeS1zdHlsZSBldmVudCBtYXBzIGB7Y2hhbmdlOiBhY3Rpb259YAogIC8vIGluIHRlcm1zIG9mIHRoZSBleGlzdGluZyBBUEkuCiAgdmFyIGV2ZW50c0FwaSA9IGZ1bmN0aW9uKG9iaiwgYWN0aW9uLCBuYW1lLCByZXN0KSB7CiAgICBpZiAoIW5hbWUpIHJldHVybiB0cnVlOwoKICAgIC8vIEhhbmRsZSBldmVudCBtYXBzLgogICAgaWYgKHR5cGVvZiBuYW1lID09PSAnb2JqZWN0JykgewogICAgICBmb3IgKHZhciBrZXkgaW4gbmFtZSkgewogICAgICAgIG9ialthY3Rpb25dLmFwcGx5KG9iaiwgW2tleSwgbmFtZVtrZXldXS5jb25jYXQocmVzdCkpOwogICAgICB9CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvLyBIYW5kbGUgc3BhY2Ugc2VwYXJhdGVkIGV2ZW50IG5hbWVzLgogICAgaWYgKGV2ZW50U3BsaXR0ZXIudGVzdChuYW1lKSkgewogICAgICB2YXIgbmFtZXMgPSBuYW1lLnNwbGl0KGV2ZW50U3BsaXR0ZXIpOwogICAgICBmb3IgKHZhciBpID0gMCwgbCA9IG5hbWVzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIG9ialthY3Rpb25dLmFwcGx5KG9iaiwgW25hbWVzW2ldXS5jb25jYXQocmVzdCkpOwogICAgICB9CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICByZXR1cm4gdHJ1ZTsKICB9OwoKICAvLyBBIGRpZmZpY3VsdC10by1iZWxpZXZlLCBidXQgb3B0aW1pemVkIGludGVybmFsIGRpc3BhdGNoIGZ1bmN0aW9uIGZvcgogIC8vIHRyaWdnZXJpbmcgZXZlbnRzLiBUcmllcyB0byBrZWVwIHRoZSB1c3VhbCBjYXNlcyBzcGVlZHkgKG1vc3QgaW50ZXJuYWwKICAvLyBCYWNrYm9uZSBldmVudHMgaGF2ZSAzIGFyZ3VtZW50cykuCiAgdmFyIHRyaWdnZXJFdmVudHMgPSBmdW5jdGlvbihldmVudHMsIGFyZ3MpIHsKICAgIHZhciBldiwgaSA9IC0xLCBsID0gZXZlbnRzLmxlbmd0aCwgYTEgPSBhcmdzWzBdLCBhMiA9IGFyZ3NbMV0sIGEzID0gYXJnc1syXTsKICAgIHN3aXRjaCAoYXJncy5sZW5ndGgpIHsKICAgICAgY2FzZSAwOiB3aGlsZSAoKytpIDwgbCkgKGV2ID0gZXZlbnRzW2ldKS5jYWxsYmFjay5jYWxsKGV2LmN0eCk7IHJldHVybjsKICAgICAgY2FzZSAxOiB3aGlsZSAoKytpIDwgbCkgKGV2ID0gZXZlbnRzW2ldKS5jYWxsYmFjay5jYWxsKGV2LmN0eCwgYTEpOyByZXR1cm47CiAgICAgIGNhc2UgMjogd2hpbGUgKCsraSA8IGwpIChldiA9IGV2ZW50c1tpXSkuY2FsbGJhY2suY2FsbChldi5jdHgsIGExLCBhMik7IHJldHVybjsKICAgICAgY2FzZSAzOiB3aGlsZSAoKytpIDwgbCkgKGV2ID0gZXZlbnRzW2ldKS5jYWxsYmFjay5jYWxsKGV2LmN0eCwgYTEsIGEyLCBhMyk7IHJldHVybjsKICAgICAgZGVmYXVsdDogd2hpbGUgKCsraSA8IGwpIChldiA9IGV2ZW50c1tpXSkuY2FsbGJhY2suYXBwbHkoZXYuY3R4LCBhcmdzKTsgcmV0dXJuOwogICAgfQogIH07CgogIHZhciBsaXN0ZW5NZXRob2RzID0ge2xpc3RlblRvOiAnb24nLCBsaXN0ZW5Ub09uY2U6ICdvbmNlJ307CgogIC8vIEludmVyc2lvbi1vZi1jb250cm9sIHZlcnNpb25zIG9mIGBvbmAgYW5kIGBvbmNlYC4gVGVsbCAqdGhpcyogb2JqZWN0IHRvCiAgLy8gbGlzdGVuIHRvIGFuIGV2ZW50IGluIGFub3RoZXIgb2JqZWN0IC4uLiBrZWVwaW5nIHRyYWNrIG9mIHdoYXQgaXQncwogIC8vIGxpc3RlbmluZyB0by4KICBfLmVhY2gobGlzdGVuTWV0aG9kcywgZnVuY3Rpb24oaW1wbGVtZW50YXRpb24sIG1ldGhvZCkgewogICAgRXZlbnRzW21ldGhvZF0gPSBmdW5jdGlvbihvYmosIG5hbWUsIGNhbGxiYWNrKSB7CiAgICAgIHZhciBsaXN0ZW5pbmdUbyA9IHRoaXMuX2xpc3RlbmluZ1RvIHx8ICh0aGlzLl9saXN0ZW5pbmdUbyA9IHt9KTsKICAgICAgdmFyIGlkID0gb2JqLl9saXN0ZW5JZCB8fCAob2JqLl9saXN0ZW5JZCA9IF8udW5pcXVlSWQoJ2wnKSk7CiAgICAgIGxpc3RlbmluZ1RvW2lkXSA9IG9iajsKICAgICAgaWYgKCFjYWxsYmFjayAmJiB0eXBlb2YgbmFtZSA9PT0gJ29iamVjdCcpIGNhbGxiYWNrID0gdGhpczsKICAgICAgb2JqW2ltcGxlbWVudGF0aW9uXShuYW1lLCBjYWxsYmFjaywgdGhpcyk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfTsKICB9KTsKCiAgLy8gQWxpYXNlcyBmb3IgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkuCiAgRXZlbnRzLmJpbmQgICA9IEV2ZW50cy5vbjsKICBFdmVudHMudW5iaW5kID0gRXZlbnRzLm9mZjsKCiAgLy8gQWxsb3cgdGhlIGBCYWNrYm9uZWAgb2JqZWN0IHRvIHNlcnZlIGFzIGEgZ2xvYmFsIGV2ZW50IGJ1cywgZm9yIGZvbGtzIHdobwogIC8vIHdhbnQgZ2xvYmFsICJwdWJzdWIiIGluIGEgY29udmVuaWVudCBwbGFjZS4KICBfLmV4dGVuZChCYWNrYm9uZSwgRXZlbnRzKTsKCiAgLy8gQmFja2JvbmUuTW9kZWwKICAvLyAtLS0tLS0tLS0tLS0tLQoKICAvLyBCYWNrYm9uZSAqKk1vZGVscyoqIGFyZSB0aGUgYmFzaWMgZGF0YSBvYmplY3QgaW4gdGhlIGZyYW1ld29yayAtLQogIC8vIGZyZXF1ZW50bHkgcmVwcmVzZW50aW5nIGEgcm93IGluIGEgdGFibGUgaW4gYSBkYXRhYmFzZSBvbiB5b3VyIHNlcnZlci4KICAvLyBBIGRpc2NyZXRlIGNodW5rIG9mIGRhdGEgYW5kIGEgYnVuY2ggb2YgdXNlZnVsLCByZWxhdGVkIG1ldGhvZHMgZm9yCiAgLy8gcGVyZm9ybWluZyBjb21wdXRhdGlvbnMgYW5kIHRyYW5zZm9ybWF0aW9ucyBvbiB0aGF0IGRhdGEuCgogIC8vIENyZWF0ZSBhIG5ldyBtb2RlbCB3aXRoIHRoZSBzcGVjaWZpZWQgYXR0cmlidXRlcy4gQSBjbGllbnQgaWQgKGBjaWRgKQogIC8vIGlzIGF1dG9tYXRpY2FsbHkgZ2VuZXJhdGVkIGFuZCBhc3NpZ25lZCBmb3IgeW91LgogIHZhciBNb2RlbCA9IEJhY2tib25lLk1vZGVsID0gZnVuY3Rpb24oYXR0cmlidXRlcywgb3B0aW9ucykgewogICAgdmFyIGF0dHJzID0gYXR0cmlidXRlcyB8fCB7fTsKICAgIG9wdGlvbnMgfHwgKG9wdGlvbnMgPSB7fSk7CiAgICB0aGlzLmNpZCA9IF8udW5pcXVlSWQoJ2MnKTsKICAgIHRoaXMuYXR0cmlidXRlcyA9IHt9OwogICAgaWYgKG9wdGlvbnMuY29sbGVjdGlvbikgdGhpcy5jb2xsZWN0aW9uID0gb3B0aW9ucy5jb2xsZWN0aW9uOwogICAgaWYgKG9wdGlvbnMucGFyc2UpIGF0dHJzID0gdGhpcy5wYXJzZShhdHRycywgb3B0aW9ucykgfHwge307CiAgICBhdHRycyA9IF8uZGVmYXVsdHMoe30sIGF0dHJzLCBfLnJlc3VsdCh0aGlzLCAnZGVmYXVsdHMnKSk7CiAgICB0aGlzLnNldChhdHRycywgb3B0aW9ucyk7CiAgICB0aGlzLmNoYW5nZWQgPSB7fTsKICAgIHRoaXMuaW5pdGlhbGl6ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogIH07CgogIC8vIEF0dGFjaCBhbGwgaW5oZXJpdGFibGUgbWV0aG9kcyB0byB0aGUgTW9kZWwgcHJvdG90eXBlLgogIF8uZXh0ZW5kKE1vZGVsLnByb3RvdHlwZSwgRXZlbnRzLCB7CgogICAgLy8gQSBoYXNoIG9mIGF0dHJpYnV0ZXMgd2hvc2UgY3VycmVudCBhbmQgcHJldmlvdXMgdmFsdWUgZGlmZmVyLgogICAgY2hhbmdlZDogbnVsbCwKCiAgICAvLyBUaGUgdmFsdWUgcmV0dXJuZWQgZHVyaW5nIHRoZSBsYXN0IGZhaWxlZCB2YWxpZGF0aW9uLgogICAgdmFsaWRhdGlvbkVycm9yOiBudWxsLAoKICAgIC8vIFRoZSBkZWZhdWx0IG5hbWUgZm9yIHRoZSBKU09OIGBpZGAgYXR0cmlidXRlIGlzIGAiaWQiYC4gTW9uZ29EQiBhbmQKICAgIC8vIENvdWNoREIgdXNlcnMgbWF5IHdhbnQgdG8gc2V0IHRoaXMgdG8gYCJfaWQiYC4KICAgIGlkQXR0cmlidXRlOiAnaWQnLAoKICAgIC8vIEluaXRpYWxpemUgaXMgYW4gZW1wdHkgZnVuY3Rpb24gYnkgZGVmYXVsdC4gT3ZlcnJpZGUgaXQgd2l0aCB5b3VyIG93bgogICAgLy8gaW5pdGlhbGl6YXRpb24gbG9naWMuCiAgICBpbml0aWFsaXplOiBmdW5jdGlvbigpe30sCgogICAgLy8gUmV0dXJuIGEgY29weSBvZiB0aGUgbW9kZWwncyBgYXR0cmlidXRlc2Agb2JqZWN0LgogICAgdG9KU09OOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgIHJldHVybiBfLmNsb25lKHRoaXMuYXR0cmlidXRlcyk7CiAgICB9LAoKICAgIC8vIFByb3h5IGBCYWNrYm9uZS5zeW5jYCBieSBkZWZhdWx0IC0tIGJ1dCBvdmVycmlkZSB0aGlzIGlmIHlvdSBuZWVkCiAgICAvLyBjdXN0b20gc3luY2luZyBzZW1hbnRpY3MgZm9yICp0aGlzKiBwYXJ0aWN1bGFyIG1vZGVsLgogICAgc3luYzogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBCYWNrYm9uZS5zeW5jLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICB9LAoKICAgIC8vIEdldCB0aGUgdmFsdWUgb2YgYW4gYXR0cmlidXRlLgogICAgZ2V0OiBmdW5jdGlvbihhdHRyKSB7CiAgICAgIHJldHVybiB0aGlzLmF0dHJpYnV0ZXNbYXR0cl07CiAgICB9LAoKICAgIC8vIEdldCB0aGUgSFRNTC1lc2NhcGVkIHZhbHVlIG9mIGFuIGF0dHJpYnV0ZS4KICAgIGVzY2FwZTogZnVuY3Rpb24oYXR0cikgewogICAgICByZXR1cm4gXy5lc2NhcGUodGhpcy5nZXQoYXR0cikpOwogICAgfSwKCiAgICAvLyBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgYXR0cmlidXRlIGNvbnRhaW5zIGEgdmFsdWUgdGhhdCBpcyBub3QgbnVsbAogICAgLy8gb3IgdW5kZWZpbmVkLgogICAgaGFzOiBmdW5jdGlvbihhdHRyKSB7CiAgICAgIHJldHVybiB0aGlzLmdldChhdHRyKSAhPSBudWxsOwogICAgfSwKCiAgICAvLyBTZXQgYSBoYXNoIG9mIG1vZGVsIGF0dHJpYnV0ZXMgb24gdGhlIG9iamVjdCwgZmlyaW5nIGAiY2hhbmdlImAuIFRoaXMgaXMKICAgIC8vIHRoZSBjb3JlIHByaW1pdGl2ZSBvcGVyYXRpb24gb2YgYSBtb2RlbCwgdXBkYXRpbmcgdGhlIGRhdGEgYW5kIG5vdGlmeWluZwogICAgLy8gYW55b25lIHdobyBuZWVkcyB0byBrbm93IGFib3V0IHRoZSBjaGFuZ2UgaW4gc3RhdGUuIFRoZSBoZWFydCBvZiB0aGUgYmVhc3QuCiAgICBzZXQ6IGZ1bmN0aW9uKGtleSwgdmFsLCBvcHRpb25zKSB7CiAgICAgIHZhciBhdHRyLCBhdHRycywgdW5zZXQsIGNoYW5nZXMsIHNpbGVudCwgY2hhbmdpbmcsIHByZXYsIGN1cnJlbnQ7CiAgICAgIGlmIChrZXkgPT0gbnVsbCkgcmV0dXJuIHRoaXM7CgogICAgICAvLyBIYW5kbGUgYm90aCBgImtleSIsIHZhbHVlYCBhbmQgYHtrZXk6IHZhbHVlfWAgLXN0eWxlIGFyZ3VtZW50cy4KICAgICAgaWYgKHR5cGVvZiBrZXkgPT09ICdvYmplY3QnKSB7CiAgICAgICAgYXR0cnMgPSBrZXk7CiAgICAgICAgb3B0aW9ucyA9IHZhbDsKICAgICAgfSBlbHNlIHsKICAgICAgICAoYXR0cnMgPSB7fSlba2V5XSA9IHZhbDsKICAgICAgfQoKICAgICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTsKCiAgICAgIC8vIFJ1biB2YWxpZGF0aW9uLgogICAgICBpZiAoIXRoaXMuX3ZhbGlkYXRlKGF0dHJzLCBvcHRpb25zKSkgcmV0dXJuIGZhbHNlOwoKICAgICAgLy8gRXh0cmFjdCBhdHRyaWJ1dGVzIGFuZCBvcHRpb25zLgogICAgICB1bnNldCAgICAgICAgICAgPSBvcHRpb25zLnVuc2V0OwogICAgICBzaWxlbnQgICAgICAgICAgPSBvcHRpb25zLnNpbGVudDsKICAgICAgY2hhbmdlcyAgICAgICAgID0gW107CiAgICAgIGNoYW5naW5nICAgICAgICA9IHRoaXMuX2NoYW5naW5nOwogICAgICB0aGlzLl9jaGFuZ2luZyAgPSB0cnVlOwoKICAgICAgaWYgKCFjaGFuZ2luZykgewogICAgICAgIHRoaXMuX3ByZXZpb3VzQXR0cmlidXRlcyA9IF8uY2xvbmUodGhpcy5hdHRyaWJ1dGVzKTsKICAgICAgICB0aGlzLmNoYW5nZWQgPSB7fTsKICAgICAgfQogICAgICBjdXJyZW50ID0gdGhpcy5hdHRyaWJ1dGVzLCBwcmV2ID0gdGhpcy5fcHJldmlvdXNBdHRyaWJ1dGVzOwoKICAgICAgLy8gQ2hlY2sgZm9yIGNoYW5nZXMgb2YgYGlkYC4KICAgICAgaWYgKHRoaXMuaWRBdHRyaWJ1dGUgaW4gYXR0cnMpIHRoaXMuaWQgPSBhdHRyc1t0aGlzLmlkQXR0cmlidXRlXTsKCiAgICAgIC8vIEZvciBlYWNoIGBzZXRgIGF0dHJpYnV0ZSwgdXBkYXRlIG9yIGRlbGV0ZSB0aGUgY3VycmVudCB2YWx1ZS4KICAgICAgZm9yIChhdHRyIGluIGF0dHJzKSB7CiAgICAgICAgdmFsID0gYXR0cnNbYXR0cl07CiAgICAgICAgaWYgKCFfLmlzRXF1YWwoY3VycmVudFthdHRyXSwgdmFsKSkgY2hhbmdlcy5wdXNoKGF0dHIpOwogICAgICAgIGlmICghXy5pc0VxdWFsKHByZXZbYXR0cl0sIHZhbCkpIHsKICAgICAgICAgIHRoaXMuY2hhbmdlZFthdHRyXSA9IHZhbDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZGVsZXRlIHRoaXMuY2hhbmdlZFthdHRyXTsKICAgICAgICB9CiAgICAgICAgdW5zZXQgPyBkZWxldGUgY3VycmVudFthdHRyXSA6IGN1cnJlbnRbYXR0cl0gPSB2YWw7CiAgICAgIH0KCiAgICAgIC8vIFRyaWdnZXIgYWxsIHJlbGV2YW50IGF0dHJpYnV0ZSBjaGFuZ2VzLgogICAgICBpZiAoIXNpbGVudCkgewogICAgICAgIGlmIChjaGFuZ2VzLmxlbmd0aCkgdGhpcy5fcGVuZGluZyA9IG9wdGlvbnM7CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSBjaGFuZ2VzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgICAgdGhpcy50cmlnZ2VyKCdjaGFuZ2U6JyArIGNoYW5nZXNbaV0sIHRoaXMsIGN1cnJlbnRbY2hhbmdlc1tpXV0sIG9wdGlvbnMpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgLy8gWW91IG1pZ2h0IGJlIHdvbmRlcmluZyB3aHkgdGhlcmUncyBhIGB3aGlsZWAgbG9vcCBoZXJlLiBDaGFuZ2VzIGNhbgogICAgICAvLyBiZSByZWN1cnNpdmVseSBuZXN0ZWQgd2l0aGluIGAiY2hhbmdlImAgZXZlbnRzLgogICAgICBpZiAoY2hhbmdpbmcpIHJldHVybiB0aGlzOwogICAgICBpZiAoIXNpbGVudCkgewogICAgICAgIHdoaWxlICh0aGlzLl9wZW5kaW5nKSB7CiAgICAgICAgICBvcHRpb25zID0gdGhpcy5fcGVuZGluZzsKICAgICAgICAgIHRoaXMuX3BlbmRpbmcgPSBmYWxzZTsKICAgICAgICAgIHRoaXMudHJpZ2dlcignY2hhbmdlJywgdGhpcywgb3B0aW9ucyk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMuX3BlbmRpbmcgPSBmYWxzZTsKICAgICAgdGhpcy5fY2hhbmdpbmcgPSBmYWxzZTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAoKICAgIC8vIFJlbW92ZSBhbiBhdHRyaWJ1dGUgZnJvbSB0aGUgbW9kZWwsIGZpcmluZyBgImNoYW5nZSJgLiBgdW5zZXRgIGlzIGEgbm9vcAogICAgLy8gaWYgdGhlIGF0dHJpYnV0ZSBkb2Vzbid0IGV4aXN0LgogICAgdW5zZXQ6IGZ1bmN0aW9uKGF0dHIsIG9wdGlvbnMpIHsKICAgICAgcmV0dXJuIHRoaXMuc2V0KGF0dHIsIHZvaWQgMCwgXy5leHRlbmQoe30sIG9wdGlvbnMsIHt1bnNldDogdHJ1ZX0pKTsKICAgIH0sCgogICAgLy8gQ2xlYXIgYWxsIGF0dHJpYnV0ZXMgb24gdGhlIG1vZGVsLCBmaXJpbmcgYCJjaGFuZ2UiYC4KICAgIGNsZWFyOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgIHZhciBhdHRycyA9IHt9OwogICAgICBmb3IgKHZhciBrZXkgaW4gdGhpcy5hdHRyaWJ1dGVzKSBhdHRyc1trZXldID0gdm9pZCAwOwogICAgICByZXR1cm4gdGhpcy5zZXQoYXR0cnMsIF8uZXh0ZW5kKHt9LCBvcHRpb25zLCB7dW5zZXQ6IHRydWV9KSk7CiAgICB9LAoKICAgIC8vIERldGVybWluZSBpZiB0aGUgbW9kZWwgaGFzIGNoYW5nZWQgc2luY2UgdGhlIGxhc3QgYCJjaGFuZ2UiYCBldmVudC4KICAgIC8vIElmIHlvdSBzcGVjaWZ5IGFuIGF0dHJpYnV0ZSBuYW1lLCBkZXRlcm1pbmUgaWYgdGhhdCBhdHRyaWJ1dGUgaGFzIGNoYW5nZWQuCiAgICBoYXNDaGFuZ2VkOiBmdW5jdGlvbihhdHRyKSB7CiAgICAgIGlmIChhdHRyID09IG51bGwpIHJldHVybiAhXy5pc0VtcHR5KHRoaXMuY2hhbmdlZCk7CiAgICAgIHJldHVybiBfLmhhcyh0aGlzLmNoYW5nZWQsIGF0dHIpOwogICAgfSwKCiAgICAvLyBSZXR1cm4gYW4gb2JqZWN0IGNvbnRhaW5pbmcgYWxsIHRoZSBhdHRyaWJ1dGVzIHRoYXQgaGF2ZSBjaGFuZ2VkLCBvcgogICAgLy8gZmFsc2UgaWYgdGhlcmUgYXJlIG5vIGNoYW5nZWQgYXR0cmlidXRlcy4gVXNlZnVsIGZvciBkZXRlcm1pbmluZyB3aGF0CiAgICAvLyBwYXJ0cyBvZiBhIHZpZXcgbmVlZCB0byBiZSB1cGRhdGVkIGFuZC9vciB3aGF0IGF0dHJpYnV0ZXMgbmVlZCB0byBiZQogICAgLy8gcGVyc2lzdGVkIHRvIHRoZSBzZXJ2ZXIuIFVuc2V0IGF0dHJpYnV0ZXMgd2lsbCBiZSBzZXQgdG8gdW5kZWZpbmVkLgogICAgLy8gWW91IGNhbiBhbHNvIHBhc3MgYW4gYXR0cmlidXRlcyBvYmplY3QgdG8gZGlmZiBhZ2FpbnN0IHRoZSBtb2RlbCwKICAgIC8vIGRldGVybWluaW5nIGlmIHRoZXJlICp3b3VsZCBiZSogYSBjaGFuZ2UuCiAgICBjaGFuZ2VkQXR0cmlidXRlczogZnVuY3Rpb24oZGlmZikgewogICAgICBpZiAoIWRpZmYpIHJldHVybiB0aGlzLmhhc0NoYW5nZWQoKSA/IF8uY2xvbmUodGhpcy5jaGFuZ2VkKSA6IGZhbHNlOwogICAgICB2YXIgdmFsLCBjaGFuZ2VkID0gZmFsc2U7CiAgICAgIHZhciBvbGQgPSB0aGlzLl9jaGFuZ2luZyA/IHRoaXMuX3ByZXZpb3VzQXR0cmlidXRlcyA6IHRoaXMuYXR0cmlidXRlczsKICAgICAgZm9yICh2YXIgYXR0ciBpbiBkaWZmKSB7CiAgICAgICAgaWYgKF8uaXNFcXVhbChvbGRbYXR0cl0sICh2YWwgPSBkaWZmW2F0dHJdKSkpIGNvbnRpbnVlOwogICAgICAgIChjaGFuZ2VkIHx8IChjaGFuZ2VkID0ge30pKVthdHRyXSA9IHZhbDsKICAgICAgfQogICAgICByZXR1cm4gY2hhbmdlZDsKICAgIH0sCgogICAgLy8gR2V0IHRoZSBwcmV2aW91cyB2YWx1ZSBvZiBhbiBhdHRyaWJ1dGUsIHJlY29yZGVkIGF0IHRoZSB0aW1lIHRoZSBsYXN0CiAgICAvLyBgImNoYW5nZSJgIGV2ZW50IHdhcyBmaXJlZC4KICAgIHByZXZpb3VzOiBmdW5jdGlvbihhdHRyKSB7CiAgICAgIGlmIChhdHRyID09IG51bGwgfHwgIXRoaXMuX3ByZXZpb3VzQXR0cmlidXRlcykgcmV0dXJuIG51bGw7CiAgICAgIHJldHVybiB0aGlzLl9wcmV2aW91c0F0dHJpYnV0ZXNbYXR0cl07CiAgICB9LAoKICAgIC8vIEdldCBhbGwgb2YgdGhlIGF0dHJpYnV0ZXMgb2YgdGhlIG1vZGVsIGF0IHRoZSB0aW1lIG9mIHRoZSBwcmV2aW91cwogICAgLy8gYCJjaGFuZ2UiYCBldmVudC4KICAgIHByZXZpb3VzQXR0cmlidXRlczogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBfLmNsb25lKHRoaXMuX3ByZXZpb3VzQXR0cmlidXRlcyk7CiAgICB9LAoKICAgIC8vIEZldGNoIHRoZSBtb2RlbCBmcm9tIHRoZSBzZXJ2ZXIuIElmIHRoZSBzZXJ2ZXIncyByZXByZXNlbnRhdGlvbiBvZiB0aGUKICAgIC8vIG1vZGVsIGRpZmZlcnMgZnJvbSBpdHMgY3VycmVudCBhdHRyaWJ1dGVzLCB0aGV5IHdpbGwgYmUgb3ZlcnJpZGRlbiwKICAgIC8vIHRyaWdnZXJpbmcgYSBgImNoYW5nZSJgIGV2ZW50LgogICAgZmV0Y2g6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgPyBfLmNsb25lKG9wdGlvbnMpIDoge307CiAgICAgIGlmIChvcHRpb25zLnBhcnNlID09PSB2b2lkIDApIG9wdGlvbnMucGFyc2UgPSB0cnVlOwogICAgICB2YXIgbW9kZWwgPSB0aGlzOwogICAgICB2YXIgc3VjY2VzcyA9IG9wdGlvbnMuc3VjY2VzczsKICAgICAgb3B0aW9ucy5zdWNjZXNzID0gZnVuY3Rpb24ocmVzcCkgewogICAgICAgIGlmICghbW9kZWwuc2V0KG1vZGVsLnBhcnNlKHJlc3AsIG9wdGlvbnMpLCBvcHRpb25zKSkgcmV0dXJuIGZhbHNlOwogICAgICAgIGlmIChzdWNjZXNzKSBzdWNjZXNzKG1vZGVsLCByZXNwLCBvcHRpb25zKTsKICAgICAgICBtb2RlbC50cmlnZ2VyKCdzeW5jJywgbW9kZWwsIHJlc3AsIG9wdGlvbnMpOwogICAgICB9OwogICAgICB3cmFwRXJyb3IodGhpcywgb3B0aW9ucyk7CiAgICAgIHJldHVybiB0aGlzLnN5bmMoJ3JlYWQnLCB0aGlzLCBvcHRpb25zKTsKICAgIH0sCgogICAgLy8gU2V0IGEgaGFzaCBvZiBtb2RlbCBhdHRyaWJ1dGVzLCBhbmQgc3luYyB0aGUgbW9kZWwgdG8gdGhlIHNlcnZlci4KICAgIC8vIElmIHRoZSBzZXJ2ZXIgcmV0dXJucyBhbiBhdHRyaWJ1dGVzIGhhc2ggdGhhdCBkaWZmZXJzLCB0aGUgbW9kZWwncwogICAgLy8gc3RhdGUgd2lsbCBiZSBgc2V0YCBhZ2Fpbi4KICAgIHNhdmU6IGZ1bmN0aW9uKGtleSwgdmFsLCBvcHRpb25zKSB7CiAgICAgIHZhciBhdHRycywgbWV0aG9kLCB4aHIsIGF0dHJpYnV0ZXMgPSB0aGlzLmF0dHJpYnV0ZXM7CgogICAgICAvLyBIYW5kbGUgYm90aCBgImtleSIsIHZhbHVlYCBhbmQgYHtrZXk6IHZhbHVlfWAgLXN0eWxlIGFyZ3VtZW50cy4KICAgICAgaWYgKGtleSA9PSBudWxsIHx8IHR5cGVvZiBrZXkgPT09ICdvYmplY3QnKSB7CiAgICAgICAgYXR0cnMgPSBrZXk7CiAgICAgICAgb3B0aW9ucyA9IHZhbDsKICAgICAgfSBlbHNlIHsKICAgICAgICAoYXR0cnMgPSB7fSlba2V5XSA9IHZhbDsKICAgICAgfQoKICAgICAgb3B0aW9ucyA9IF8uZXh0ZW5kKHt2YWxpZGF0ZTogdHJ1ZX0sIG9wdGlvbnMpOwoKICAgICAgLy8gSWYgd2UncmUgbm90IHdhaXRpbmcgYW5kIGF0dHJpYnV0ZXMgZXhpc3QsIHNhdmUgYWN0cyBhcwogICAgICAvLyBgc2V0KGF0dHIpLnNhdmUobnVsbCwgb3B0cylgIHdpdGggdmFsaWRhdGlvbi4gT3RoZXJ3aXNlLCBjaGVjayBpZgogICAgICAvLyB0aGUgbW9kZWwgd2lsbCBiZSB2YWxpZCB3aGVuIHRoZSBhdHRyaWJ1dGVzLCBpZiBhbnksIGFyZSBzZXQuCiAgICAgIGlmIChhdHRycyAmJiAhb3B0aW9ucy53YWl0KSB7CiAgICAgICAgaWYgKCF0aGlzLnNldChhdHRycywgb3B0aW9ucykpIHJldHVybiBmYWxzZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoIXRoaXMuX3ZhbGlkYXRlKGF0dHJzLCBvcHRpb25zKSkgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICAvLyBTZXQgdGVtcG9yYXJ5IGF0dHJpYnV0ZXMgaWYgYHt3YWl0OiB0cnVlfWAuCiAgICAgIGlmIChhdHRycyAmJiBvcHRpb25zLndhaXQpIHsKICAgICAgICB0aGlzLmF0dHJpYnV0ZXMgPSBfLmV4dGVuZCh7fSwgYXR0cmlidXRlcywgYXR0cnMpOwogICAgICB9CgogICAgICAvLyBBZnRlciBhIHN1Y2Nlc3NmdWwgc2VydmVyLXNpZGUgc2F2ZSwgdGhlIGNsaWVudCBpcyAob3B0aW9uYWxseSkKICAgICAgLy8gdXBkYXRlZCB3aXRoIHRoZSBzZXJ2ZXItc2lkZSBzdGF0ZS4KICAgICAgaWYgKG9wdGlvbnMucGFyc2UgPT09IHZvaWQgMCkgb3B0aW9ucy5wYXJzZSA9IHRydWU7CiAgICAgIHZhciBtb2RlbCA9IHRoaXM7CiAgICAgIHZhciBzdWNjZXNzID0gb3B0aW9ucy5zdWNjZXNzOwogICAgICBvcHRpb25zLnN1Y2Nlc3MgPSBmdW5jdGlvbihyZXNwKSB7CiAgICAgICAgLy8gRW5zdXJlIGF0dHJpYnV0ZXMgYXJlIHJlc3RvcmVkIGR1cmluZyBzeW5jaHJvbm91cyBzYXZlcy4KICAgICAgICBtb2RlbC5hdHRyaWJ1dGVzID0gYXR0cmlidXRlczsKICAgICAgICB2YXIgc2VydmVyQXR0cnMgPSBtb2RlbC5wYXJzZShyZXNwLCBvcHRpb25zKTsKICAgICAgICBpZiAob3B0aW9ucy53YWl0KSBzZXJ2ZXJBdHRycyA9IF8uZXh0ZW5kKGF0dHJzIHx8IHt9LCBzZXJ2ZXJBdHRycyk7CiAgICAgICAgaWYgKF8uaXNPYmplY3Qoc2VydmVyQXR0cnMpICYmICFtb2RlbC5zZXQoc2VydmVyQXR0cnMsIG9wdGlvbnMpKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmIChzdWNjZXNzKSBzdWNjZXNzKG1vZGVsLCByZXNwLCBvcHRpb25zKTsKICAgICAgICBtb2RlbC50cmlnZ2VyKCdzeW5jJywgbW9kZWwsIHJlc3AsIG9wdGlvbnMpOwogICAgICB9OwogICAgICB3cmFwRXJyb3IodGhpcywgb3B0aW9ucyk7CgogICAgICBtZXRob2QgPSB0aGlzLmlzTmV3KCkgPyAnY3JlYXRlJyA6IChvcHRpb25zLnBhdGNoID8gJ3BhdGNoJyA6ICd1cGRhdGUnKTsKICAgICAgaWYgKG1ldGhvZCA9PT0gJ3BhdGNoJykgb3B0aW9ucy5hdHRycyA9IGF0dHJzOwogICAgICB4aHIgPSB0aGlzLnN5bmMobWV0aG9kLCB0aGlzLCBvcHRpb25zKTsKCiAgICAgIC8vIFJlc3RvcmUgYXR0cmlidXRlcy4KICAgICAgaWYgKGF0dHJzICYmIG9wdGlvbnMud2FpdCkgdGhpcy5hdHRyaWJ1dGVzID0gYXR0cmlidXRlczsKCiAgICAgIHJldHVybiB4aHI7CiAgICB9LAoKICAgIC8vIERlc3Ryb3kgdGhpcyBtb2RlbCBvbiB0aGUgc2VydmVyIGlmIGl0IHdhcyBhbHJlYWR5IHBlcnNpc3RlZC4KICAgIC8vIE9wdGltaXN0aWNhbGx5IHJlbW92ZXMgdGhlIG1vZGVsIGZyb20gaXRzIGNvbGxlY3Rpb24sIGlmIGl0IGhhcyBvbmUuCiAgICAvLyBJZiBgd2FpdDogdHJ1ZWAgaXMgcGFzc2VkLCB3YWl0cyBmb3IgdGhlIHNlcnZlciB0byByZXNwb25kIGJlZm9yZSByZW1vdmFsLgogICAgZGVzdHJveTogZnVuY3Rpb24ob3B0aW9ucykgewogICAgICBvcHRpb25zID0gb3B0aW9ucyA/IF8uY2xvbmUob3B0aW9ucykgOiB7fTsKICAgICAgdmFyIG1vZGVsID0gdGhpczsKICAgICAgdmFyIHN1Y2Nlc3MgPSBvcHRpb25zLnN1Y2Nlc3M7CgogICAgICB2YXIgZGVzdHJveSA9IGZ1bmN0aW9uKCkgewogICAgICAgIG1vZGVsLnRyaWdnZXIoJ2Rlc3Ryb3knLCBtb2RlbCwgbW9kZWwuY29sbGVjdGlvbiwgb3B0aW9ucyk7CiAgICAgIH07CgogICAgICBvcHRpb25zLnN1Y2Nlc3MgPSBmdW5jdGlvbihyZXNwKSB7CiAgICAgICAgaWYgKG9wdGlvbnMud2FpdCB8fCBtb2RlbC5pc05ldygpKSBkZXN0cm95KCk7CiAgICAgICAgaWYgKHN1Y2Nlc3MpIHN1Y2Nlc3MobW9kZWwsIHJlc3AsIG9wdGlvbnMpOwogICAgICAgIGlmICghbW9kZWwuaXNOZXcoKSkgbW9kZWwudHJpZ2dlcignc3luYycsIG1vZGVsLCByZXNwLCBvcHRpb25zKTsKICAgICAgfTsKCiAgICAgIGlmICh0aGlzLmlzTmV3KCkpIHsKICAgICAgICBvcHRpb25zLnN1Y2Nlc3MoKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgd3JhcEVycm9yKHRoaXMsIG9wdGlvbnMpOwoKICAgICAgdmFyIHhociA9IHRoaXMuc3luYygnZGVsZXRlJywgdGhpcywgb3B0aW9ucyk7CiAgICAgIGlmICghb3B0aW9ucy53YWl0KSBkZXN0cm95KCk7CiAgICAgIHJldHVybiB4aHI7CiAgICB9LAoKICAgIC8vIERlZmF1bHQgVVJMIGZvciB0aGUgbW9kZWwncyByZXByZXNlbnRhdGlvbiBvbiB0aGUgc2VydmVyIC0tIGlmIHlvdSdyZQogICAgLy8gdXNpbmcgQmFja2JvbmUncyByZXN0ZnVsIG1ldGhvZHMsIG92ZXJyaWRlIHRoaXMgdG8gY2hhbmdlIHRoZSBlbmRwb2ludAogICAgLy8gdGhhdCB3aWxsIGJlIGNhbGxlZC4KICAgIHVybDogZnVuY3Rpb24oKSB7CiAgICAgIHZhciBiYXNlID0KICAgICAgICBfLnJlc3VsdCh0aGlzLCAndXJsUm9vdCcpIHx8CiAgICAgICAgXy5yZXN1bHQodGhpcy5jb2xsZWN0aW9uLCAndXJsJykgfHwKICAgICAgICB1cmxFcnJvcigpOwogICAgICBpZiAodGhpcy5pc05ldygpKSByZXR1cm4gYmFzZTsKICAgICAgcmV0dXJuIGJhc2UucmVwbGFjZSgvKFteXC9dKSQvLCAnJDEvJykgKyBlbmNvZGVVUklDb21wb25lbnQodGhpcy5pZCk7CiAgICB9LAoKICAgIC8vICoqcGFyc2UqKiBjb252ZXJ0cyBhIHJlc3BvbnNlIGludG8gdGhlIGhhc2ggb2YgYXR0cmlidXRlcyB0byBiZSBgc2V0YCBvbgogICAgLy8gdGhlIG1vZGVsLiBUaGUgZGVmYXVsdCBpbXBsZW1lbnRhdGlvbiBpcyBqdXN0IHRvIHBhc3MgdGhlIHJlc3BvbnNlIGFsb25nLgogICAgcGFyc2U6IGZ1bmN0aW9uKHJlc3AsIG9wdGlvbnMpIHsKICAgICAgcmV0dXJuIHJlc3A7CiAgICB9LAoKICAgIC8vIENyZWF0ZSBhIG5ldyBtb2RlbCB3aXRoIGlkZW50aWNhbCBhdHRyaWJ1dGVzIHRvIHRoaXMgb25lLgogICAgY2xvbmU6IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IodGhpcy5hdHRyaWJ1dGVzKTsKICAgIH0sCgogICAgLy8gQSBtb2RlbCBpcyBuZXcgaWYgaXQgaGFzIG5ldmVyIGJlZW4gc2F2ZWQgdG8gdGhlIHNlcnZlciwgYW5kIGxhY2tzIGFuIGlkLgogICAgaXNOZXc6IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gIXRoaXMuaGFzKHRoaXMuaWRBdHRyaWJ1dGUpOwogICAgfSwKCiAgICAvLyBDaGVjayBpZiB0aGUgbW9kZWwgaXMgY3VycmVudGx5IGluIGEgdmFsaWQgc3RhdGUuCiAgICBpc1ZhbGlkOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgIHJldHVybiB0aGlzLl92YWxpZGF0ZSh7fSwgXy5leHRlbmQob3B0aW9ucyB8fCB7fSwgeyB2YWxpZGF0ZTogdHJ1ZSB9KSk7CiAgICB9LAoKICAgIC8vIFJ1biB2YWxpZGF0aW9uIGFnYWluc3QgdGhlIG5leHQgY29tcGxldGUgc2V0IG9mIG1vZGVsIGF0dHJpYnV0ZXMsCiAgICAvLyByZXR1cm5pbmcgYHRydWVgIGlmIGFsbCBpcyB3ZWxsLiBPdGhlcndpc2UsIGZpcmUgYW4gYCJpbnZhbGlkImAgZXZlbnQuCiAgICBfdmFsaWRhdGU6IGZ1bmN0aW9uKGF0dHJzLCBvcHRpb25zKSB7CiAgICAgIGlmICghb3B0aW9ucy52YWxpZGF0ZSB8fCAhdGhpcy52YWxpZGF0ZSkgcmV0dXJuIHRydWU7CiAgICAgIGF0dHJzID0gXy5leHRlbmQoe30sIHRoaXMuYXR0cmlidXRlcywgYXR0cnMpOwogICAgICB2YXIgZXJyb3IgPSB0aGlzLnZhbGlkYXRpb25FcnJvciA9IHRoaXMudmFsaWRhdGUoYXR0cnMsIG9wdGlvbnMpIHx8IG51bGw7CiAgICAgIGlmICghZXJyb3IpIHJldHVybiB0cnVlOwogICAgICB0aGlzLnRyaWdnZXIoJ2ludmFsaWQnLCB0aGlzLCBlcnJvciwgXy5leHRlbmQob3B0aW9ucywge3ZhbGlkYXRpb25FcnJvcjogZXJyb3J9KSk7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgfSk7CgogIC8vIFVuZGVyc2NvcmUgbWV0aG9kcyB0aGF0IHdlIHdhbnQgdG8gaW1wbGVtZW50IG9uIHRoZSBNb2RlbC4KICB2YXIgbW9kZWxNZXRob2RzID0gWydrZXlzJywgJ3ZhbHVlcycsICdwYWlycycsICdpbnZlcnQnLCAncGljaycsICdvbWl0J107CgogIC8vIE1peCBpbiBlYWNoIFVuZGVyc2NvcmUgbWV0aG9kIGFzIGEgcHJveHkgdG8gYE1vZGVsI2F0dHJpYnV0ZXNgLgogIF8uZWFjaChtb2RlbE1ldGhvZHMsIGZ1bmN0aW9uKG1ldGhvZCkgewogICAgTW9kZWwucHJvdG90eXBlW21ldGhvZF0gPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIGFyZ3MgPSBzbGljZS5jYWxsKGFyZ3VtZW50cyk7CiAgICAgIGFyZ3MudW5zaGlmdCh0aGlzLmF0dHJpYnV0ZXMpOwogICAgICByZXR1cm4gX1ttZXRob2RdLmFwcGx5KF8sIGFyZ3MpOwogICAgfTsKICB9KTsKCiAgLy8gQmFja2JvbmUuQ29sbGVjdGlvbgogIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgLy8gSWYgbW9kZWxzIHRlbmQgdG8gcmVwcmVzZW50IGEgc2luZ2xlIHJvdyBvZiBkYXRhLCBhIEJhY2tib25lIENvbGxlY3Rpb24gaXMKICAvLyBtb3JlIGFuYWxhZ291cyB0byBhIHRhYmxlIGZ1bGwgb2YgZGF0YSAuLi4gb3IgYSBzbWFsbCBzbGljZSBvciBwYWdlIG9mIHRoYXQKICAvLyB0YWJsZSwgb3IgYSBjb2xsZWN0aW9uIG9mIHJvd3MgdGhhdCBiZWxvbmcgdG9nZXRoZXIgZm9yIGEgcGFydGljdWxhciByZWFzb24KICAvLyAtLSBhbGwgb2YgdGhlIG1lc3NhZ2VzIGluIHRoaXMgcGFydGljdWxhciBmb2xkZXIsIGFsbCBvZiB0aGUgZG9jdW1lbnRzCiAgLy8gYmVsb25naW5nIHRvIHRoaXMgcGFydGljdWxhciBhdXRob3IsIGFuZCBzbyBvbi4gQ29sbGVjdGlvbnMgbWFpbnRhaW4KICAvLyBpbmRleGVzIG9mIHRoZWlyIG1vZGVscywgYm90aCBpbiBvcmRlciwgYW5kIGZvciBsb29rdXAgYnkgYGlkYC4KCiAgLy8gQ3JlYXRlIGEgbmV3ICoqQ29sbGVjdGlvbioqLCBwZXJoYXBzIHRvIGNvbnRhaW4gYSBzcGVjaWZpYyB0eXBlIG9mIGBtb2RlbGAuCiAgLy8gSWYgYSBgY29tcGFyYXRvcmAgaXMgc3BlY2lmaWVkLCB0aGUgQ29sbGVjdGlvbiB3aWxsIG1haW50YWluCiAgLy8gaXRzIG1vZGVscyBpbiBzb3J0IG9yZGVyLCBhcyB0aGV5J3JlIGFkZGVkIGFuZCByZW1vdmVkLgogIHZhciBDb2xsZWN0aW9uID0gQmFja2JvbmUuQ29sbGVjdGlvbiA9IGZ1bmN0aW9uKG1vZGVscywgb3B0aW9ucykgewogICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTsKICAgIGlmIChvcHRpb25zLm1vZGVsKSB0aGlzLm1vZGVsID0gb3B0aW9ucy5tb2RlbDsKICAgIGlmIChvcHRpb25zLmNvbXBhcmF0b3IgIT09IHZvaWQgMCkgdGhpcy5jb21wYXJhdG9yID0gb3B0aW9ucy5jb21wYXJhdG9yOwogICAgdGhpcy5fcmVzZXQoKTsKICAgIHRoaXMuaW5pdGlhbGl6ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgaWYgKG1vZGVscykgdGhpcy5yZXNldChtb2RlbHMsIF8uZXh0ZW5kKHtzaWxlbnQ6IHRydWV9LCBvcHRpb25zKSk7CiAgfTsKCiAgLy8gRGVmYXVsdCBvcHRpb25zIGZvciBgQ29sbGVjdGlvbiNzZXRgLgogIHZhciBzZXRPcHRpb25zID0ge2FkZDogdHJ1ZSwgcmVtb3ZlOiB0cnVlLCBtZXJnZTogdHJ1ZX07CiAgdmFyIGFkZE9wdGlvbnMgPSB7YWRkOiB0cnVlLCByZW1vdmU6IGZhbHNlfTsKCiAgLy8gRGVmaW5lIHRoZSBDb2xsZWN0aW9uJ3MgaW5oZXJpdGFibGUgbWV0aG9kcy4KICBfLmV4dGVuZChDb2xsZWN0aW9uLnByb3RvdHlwZSwgRXZlbnRzLCB7CgogICAgLy8gVGhlIGRlZmF1bHQgbW9kZWwgZm9yIGEgY29sbGVjdGlvbiBpcyBqdXN0IGEgKipCYWNrYm9uZS5Nb2RlbCoqLgogICAgLy8gVGhpcyBzaG91bGQgYmUgb3ZlcnJpZGRlbiBpbiBtb3N0IGNhc2VzLgogICAgbW9kZWw6IE1vZGVsLAoKICAgIC8vIEluaXRpYWxpemUgaXMgYW4gZW1wdHkgZnVuY3Rpb24gYnkgZGVmYXVsdC4gT3ZlcnJpZGUgaXQgd2l0aCB5b3VyIG93bgogICAgLy8gaW5pdGlhbGl6YXRpb24gbG9naWMuCiAgICBpbml0aWFsaXplOiBmdW5jdGlvbigpe30sCgogICAgLy8gVGhlIEpTT04gcmVwcmVzZW50YXRpb24gb2YgYSBDb2xsZWN0aW9uIGlzIGFuIGFycmF5IG9mIHRoZQogICAgLy8gbW9kZWxzJyBhdHRyaWJ1dGVzLgogICAgdG9KU09OOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgIHJldHVybiB0aGlzLm1hcChmdW5jdGlvbihtb2RlbCl7IHJldHVybiBtb2RlbC50b0pTT04ob3B0aW9ucyk7IH0pOwogICAgfSwKCiAgICAvLyBQcm94eSBgQmFja2JvbmUuc3luY2AgYnkgZGVmYXVsdC4KICAgIHN5bmM6IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gQmFja2JvbmUuc3luYy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgfSwKCiAgICAvLyBBZGQgYSBtb2RlbCwgb3IgbGlzdCBvZiBtb2RlbHMgdG8gdGhlIHNldC4KICAgIGFkZDogZnVuY3Rpb24obW9kZWxzLCBvcHRpb25zKSB7CiAgICAgIHJldHVybiB0aGlzLnNldChtb2RlbHMsIF8uZXh0ZW5kKHttZXJnZTogZmFsc2V9LCBvcHRpb25zLCBhZGRPcHRpb25zKSk7CiAgICB9LAoKICAgIC8vIFJlbW92ZSBhIG1vZGVsLCBvciBhIGxpc3Qgb2YgbW9kZWxzIGZyb20gdGhlIHNldC4KICAgIHJlbW92ZTogZnVuY3Rpb24obW9kZWxzLCBvcHRpb25zKSB7CiAgICAgIHZhciBzaW5ndWxhciA9ICFfLmlzQXJyYXkobW9kZWxzKTsKICAgICAgbW9kZWxzID0gc2luZ3VsYXIgPyBbbW9kZWxzXSA6IF8uY2xvbmUobW9kZWxzKTsKICAgICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTsKICAgICAgdmFyIGksIGwsIGluZGV4LCBtb2RlbDsKICAgICAgZm9yIChpID0gMCwgbCA9IG1vZGVscy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBtb2RlbCA9IG1vZGVsc1tpXSA9IHRoaXMuZ2V0KG1vZGVsc1tpXSk7CiAgICAgICAgaWYgKCFtb2RlbCkgY29udGludWU7CiAgICAgICAgZGVsZXRlIHRoaXMuX2J5SWRbbW9kZWwuaWRdOwogICAgICAgIGRlbGV0ZSB0aGlzLl9ieUlkW21vZGVsLmNpZF07CiAgICAgICAgaW5kZXggPSB0aGlzLmluZGV4T2YobW9kZWwpOwogICAgICAgIHRoaXMubW9kZWxzLnNwbGljZShpbmRleCwgMSk7CiAgICAgICAgdGhpcy5sZW5ndGgtLTsKICAgICAgICBpZiAoIW9wdGlvbnMuc2lsZW50KSB7CiAgICAgICAgICBvcHRpb25zLmluZGV4ID0gaW5kZXg7CiAgICAgICAgICBtb2RlbC50cmlnZ2VyKCdyZW1vdmUnLCBtb2RlbCwgdGhpcywgb3B0aW9ucyk7CiAgICAgICAgfQogICAgICAgIHRoaXMuX3JlbW92ZVJlZmVyZW5jZShtb2RlbCwgb3B0aW9ucyk7CiAgICAgIH0KICAgICAgcmV0dXJuIHNpbmd1bGFyID8gbW9kZWxzWzBdIDogbW9kZWxzOwogICAgfSwKCiAgICAvLyBVcGRhdGUgYSBjb2xsZWN0aW9uIGJ5IGBzZXRgLWluZyBhIG5ldyBsaXN0IG9mIG1vZGVscywgYWRkaW5nIG5ldyBvbmVzLAogICAgLy8gcmVtb3ZpbmcgbW9kZWxzIHRoYXQgYXJlIG5vIGxvbmdlciBwcmVzZW50LCBhbmQgbWVyZ2luZyBtb2RlbHMgdGhhdAogICAgLy8gYWxyZWFkeSBleGlzdCBpbiB0aGUgY29sbGVjdGlvbiwgYXMgbmVjZXNzYXJ5LiBTaW1pbGFyIHRvICoqTW9kZWwjc2V0KiosCiAgICAvLyB0aGUgY29yZSBvcGVyYXRpb24gZm9yIHVwZGF0aW5nIHRoZSBkYXRhIGNvbnRhaW5lZCBieSB0aGUgY29sbGVjdGlvbi4KICAgIHNldDogZnVuY3Rpb24obW9kZWxzLCBvcHRpb25zKSB7CiAgICAgIG9wdGlvbnMgPSBfLmRlZmF1bHRzKHt9LCBvcHRpb25zLCBzZXRPcHRpb25zKTsKICAgICAgaWYgKG9wdGlvbnMucGFyc2UpIG1vZGVscyA9IHRoaXMucGFyc2UobW9kZWxzLCBvcHRpb25zKTsKICAgICAgdmFyIHNpbmd1bGFyID0gIV8uaXNBcnJheShtb2RlbHMpOwogICAgICBtb2RlbHMgPSBzaW5ndWxhciA/IChtb2RlbHMgPyBbbW9kZWxzXSA6IFtdKSA6IF8uY2xvbmUobW9kZWxzKTsKICAgICAgdmFyIGksIGwsIGlkLCBtb2RlbCwgYXR0cnMsIGV4aXN0aW5nLCBzb3J0OwogICAgICB2YXIgYXQgPSBvcHRpb25zLmF0OwogICAgICB2YXIgdGFyZ2V0TW9kZWwgPSB0aGlzLm1vZGVsOwogICAgICB2YXIgc29ydGFibGUgPSB0aGlzLmNvbXBhcmF0b3IgJiYgKGF0ID09IG51bGwpICYmIG9wdGlvbnMuc29ydCAhPT0gZmFsc2U7CiAgICAgIHZhciBzb3J0QXR0ciA9IF8uaXNTdHJpbmcodGhpcy5jb21wYXJhdG9yKSA/IHRoaXMuY29tcGFyYXRvciA6IG51bGw7CiAgICAgIHZhciB0b0FkZCA9IFtdLCB0b1JlbW92ZSA9IFtdLCBtb2RlbE1hcCA9IHt9OwogICAgICB2YXIgYWRkID0gb3B0aW9ucy5hZGQsIG1lcmdlID0gb3B0aW9ucy5tZXJnZSwgcmVtb3ZlID0gb3B0aW9ucy5yZW1vdmU7CiAgICAgIHZhciBvcmRlciA9ICFzb3J0YWJsZSAmJiBhZGQgJiYgcmVtb3ZlID8gW10gOiBmYWxzZTsKCiAgICAgIC8vIFR1cm4gYmFyZSBvYmplY3RzIGludG8gbW9kZWwgcmVmZXJlbmNlcywgYW5kIHByZXZlbnQgaW52YWxpZCBtb2RlbHMKICAgICAgLy8gZnJvbSBiZWluZyBhZGRlZC4KICAgICAgZm9yIChpID0gMCwgbCA9IG1vZGVscy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBhdHRycyA9IG1vZGVsc1tpXSB8fCB7fTsKICAgICAgICBpZiAoYXR0cnMgaW5zdGFuY2VvZiBNb2RlbCkgewogICAgICAgICAgaWQgPSBtb2RlbCA9IGF0dHJzOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZCA9IGF0dHJzW3RhcmdldE1vZGVsLnByb3RvdHlwZS5pZEF0dHJpYnV0ZSB8fCAnaWQnXTsKICAgICAgICB9CgogICAgICAgIC8vIElmIGEgZHVwbGljYXRlIGlzIGZvdW5kLCBwcmV2ZW50IGl0IGZyb20gYmVpbmcgYWRkZWQgYW5kCiAgICAgICAgLy8gb3B0aW9uYWxseSBtZXJnZSBpdCBpbnRvIHRoZSBleGlzdGluZyBtb2RlbC4KICAgICAgICBpZiAoZXhpc3RpbmcgPSB0aGlzLmdldChpZCkpIHsKICAgICAgICAgIGlmIChyZW1vdmUpIG1vZGVsTWFwW2V4aXN0aW5nLmNpZF0gPSB0cnVlOwogICAgICAgICAgaWYgKG1lcmdlKSB7CiAgICAgICAgICAgIGF0dHJzID0gYXR0cnMgPT09IG1vZGVsID8gbW9kZWwuYXR0cmlidXRlcyA6IGF0dHJzOwogICAgICAgICAgICBpZiAob3B0aW9ucy5wYXJzZSkgYXR0cnMgPSBleGlzdGluZy5wYXJzZShhdHRycywgb3B0aW9ucyk7CiAgICAgICAgICAgIGV4aXN0aW5nLnNldChhdHRycywgb3B0aW9ucyk7CiAgICAgICAgICAgIGlmIChzb3J0YWJsZSAmJiAhc29ydCAmJiBleGlzdGluZy5oYXNDaGFuZ2VkKHNvcnRBdHRyKSkgc29ydCA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgICBtb2RlbHNbaV0gPSBleGlzdGluZzsKCiAgICAgICAgLy8gSWYgdGhpcyBpcyBhIG5ldywgdmFsaWQgbW9kZWwsIHB1c2ggaXQgdG8gdGhlIGB0b0FkZGAgbGlzdC4KICAgICAgICB9IGVsc2UgaWYgKGFkZCkgewogICAgICAgICAgbW9kZWwgPSBtb2RlbHNbaV0gPSB0aGlzLl9wcmVwYXJlTW9kZWwoYXR0cnMsIG9wdGlvbnMpOwogICAgICAgICAgaWYgKCFtb2RlbCkgY29udGludWU7CiAgICAgICAgICB0b0FkZC5wdXNoKG1vZGVsKTsKICAgICAgICAgIHRoaXMuX2FkZFJlZmVyZW5jZShtb2RlbCwgb3B0aW9ucyk7CiAgICAgICAgfQoKICAgICAgICAvLyBEbyBub3QgYWRkIG11bHRpcGxlIG1vZGVscyB3aXRoIHRoZSBzYW1lIGBpZGAuCiAgICAgICAgbW9kZWwgPSBleGlzdGluZyB8fCBtb2RlbDsKICAgICAgICBpZiAob3JkZXIgJiYgKG1vZGVsLmlzTmV3KCkgfHwgIW1vZGVsTWFwW21vZGVsLmlkXSkpIG9yZGVyLnB1c2gobW9kZWwpOwogICAgICAgIG1vZGVsTWFwW21vZGVsLmlkXSA9IHRydWU7CiAgICAgIH0KCiAgICAgIC8vIFJlbW92ZSBub25leGlzdGVudCBtb2RlbHMgaWYgYXBwcm9wcmlhdGUuCiAgICAgIGlmIChyZW1vdmUpIHsKICAgICAgICBmb3IgKGkgPSAwLCBsID0gdGhpcy5sZW5ndGg7IGkgPCBsOyArK2kpIHsKICAgICAgICAgIGlmICghbW9kZWxNYXBbKG1vZGVsID0gdGhpcy5tb2RlbHNbaV0pLmNpZF0pIHRvUmVtb3ZlLnB1c2gobW9kZWwpOwogICAgICAgIH0KICAgICAgICBpZiAodG9SZW1vdmUubGVuZ3RoKSB0aGlzLnJlbW92ZSh0b1JlbW92ZSwgb3B0aW9ucyk7CiAgICAgIH0KCiAgICAgIC8vIFNlZSBpZiBzb3J0aW5nIGlzIG5lZWRlZCwgdXBkYXRlIGBsZW5ndGhgIGFuZCBzcGxpY2UgaW4gbmV3IG1vZGVscy4KICAgICAgaWYgKHRvQWRkLmxlbmd0aCB8fCAob3JkZXIgJiYgb3JkZXIubGVuZ3RoKSkgewogICAgICAgIGlmIChzb3J0YWJsZSkgc29ydCA9IHRydWU7CiAgICAgICAgdGhpcy5sZW5ndGggKz0gdG9BZGQubGVuZ3RoOwogICAgICAgIGlmIChhdCAhPSBudWxsKSB7CiAgICAgICAgICBmb3IgKGkgPSAwLCBsID0gdG9BZGQubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICAgIHRoaXMubW9kZWxzLnNwbGljZShhdCArIGksIDAsIHRvQWRkW2ldKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKG9yZGVyKSB0aGlzLm1vZGVscy5sZW5ndGggPSAwOwogICAgICAgICAgdmFyIG9yZGVyZWRNb2RlbHMgPSBvcmRlciB8fCB0b0FkZDsKICAgICAgICAgIGZvciAoaSA9IDAsIGwgPSBvcmRlcmVkTW9kZWxzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgICAgICB0aGlzLm1vZGVscy5wdXNoKG9yZGVyZWRNb2RlbHNbaV0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgLy8gU2lsZW50bHkgc29ydCB0aGUgY29sbGVjdGlvbiBpZiBhcHByb3ByaWF0ZS4KICAgICAgaWYgKHNvcnQpIHRoaXMuc29ydCh7c2lsZW50OiB0cnVlfSk7CgogICAgICAvLyBVbmxlc3Mgc2lsZW5jZWQsIGl0J3MgdGltZSB0byBmaXJlIGFsbCBhcHByb3ByaWF0ZSBhZGQvc29ydCBldmVudHMuCiAgICAgIGlmICghb3B0aW9ucy5zaWxlbnQpIHsKICAgICAgICBmb3IgKGkgPSAwLCBsID0gdG9BZGQubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICAobW9kZWwgPSB0b0FkZFtpXSkudHJpZ2dlcignYWRkJywgbW9kZWwsIHRoaXMsIG9wdGlvbnMpOwogICAgICAgIH0KICAgICAgICBpZiAoc29ydCB8fCAob3JkZXIgJiYgb3JkZXIubGVuZ3RoKSkgdGhpcy50cmlnZ2VyKCdzb3J0JywgdGhpcywgb3B0aW9ucyk7CiAgICAgIH0KCiAgICAgIC8vIFJldHVybiB0aGUgYWRkZWQgKG9yIG1lcmdlZCkgbW9kZWwgKG9yIG1vZGVscykuCiAgICAgIHJldHVybiBzaW5ndWxhciA/IG1vZGVsc1swXSA6IG1vZGVsczsKICAgIH0sCgogICAgLy8gV2hlbiB5b3UgaGF2ZSBtb3JlIGl0ZW1zIHRoYW4geW91IHdhbnQgdG8gYWRkIG9yIHJlbW92ZSBpbmRpdmlkdWFsbHksCiAgICAvLyB5b3UgY2FuIHJlc2V0IHRoZSBlbnRpcmUgc2V0IHdpdGggYSBuZXcgbGlzdCBvZiBtb2RlbHMsIHdpdGhvdXQgZmlyaW5nCiAgICAvLyBhbnkgZ3JhbnVsYXIgYGFkZGAgb3IgYHJlbW92ZWAgZXZlbnRzLiBGaXJlcyBgcmVzZXRgIHdoZW4gZmluaXNoZWQuCiAgICAvLyBVc2VmdWwgZm9yIGJ1bGsgb3BlcmF0aW9ucyBhbmQgb3B0aW1pemF0aW9ucy4KICAgIHJlc2V0OiBmdW5jdGlvbihtb2RlbHMsIG9wdGlvbnMpIHsKICAgICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTsKICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSB0aGlzLm1vZGVscy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICB0aGlzLl9yZW1vdmVSZWZlcmVuY2UodGhpcy5tb2RlbHNbaV0sIG9wdGlvbnMpOwogICAgICB9CiAgICAgIG9wdGlvbnMucHJldmlvdXNNb2RlbHMgPSB0aGlzLm1vZGVsczsKICAgICAgdGhpcy5fcmVzZXQoKTsKICAgICAgbW9kZWxzID0gdGhpcy5hZGQobW9kZWxzLCBfLmV4dGVuZCh7c2lsZW50OiB0cnVlfSwgb3B0aW9ucykpOwogICAgICBpZiAoIW9wdGlvbnMuc2lsZW50KSB0aGlzLnRyaWdnZXIoJ3Jlc2V0JywgdGhpcywgb3B0aW9ucyk7CiAgICAgIHJldHVybiBtb2RlbHM7CiAgICB9LAoKICAgIC8vIEFkZCBhIG1vZGVsIHRvIHRoZSBlbmQgb2YgdGhlIGNvbGxlY3Rpb24uCiAgICBwdXNoOiBmdW5jdGlvbihtb2RlbCwgb3B0aW9ucykgewogICAgICByZXR1cm4gdGhpcy5hZGQobW9kZWwsIF8uZXh0ZW5kKHthdDogdGhpcy5sZW5ndGh9LCBvcHRpb25zKSk7CiAgICB9LAoKICAgIC8vIFJlbW92ZSBhIG1vZGVsIGZyb20gdGhlIGVuZCBvZiB0aGUgY29sbGVjdGlvbi4KICAgIHBvcDogZnVuY3Rpb24ob3B0aW9ucykgewogICAgICB2YXIgbW9kZWwgPSB0aGlzLmF0KHRoaXMubGVuZ3RoIC0gMSk7CiAgICAgIHRoaXMucmVtb3ZlKG1vZGVsLCBvcHRpb25zKTsKICAgICAgcmV0dXJuIG1vZGVsOwogICAgfSwKCiAgICAvLyBBZGQgYSBtb2RlbCB0byB0aGUgYmVnaW5uaW5nIG9mIHRoZSBjb2xsZWN0aW9uLgogICAgdW5zaGlmdDogZnVuY3Rpb24obW9kZWwsIG9wdGlvbnMpIHsKICAgICAgcmV0dXJuIHRoaXMuYWRkKG1vZGVsLCBfLmV4dGVuZCh7YXQ6IDB9LCBvcHRpb25zKSk7CiAgICB9LAoKICAgIC8vIFJlbW92ZSBhIG1vZGVsIGZyb20gdGhlIGJlZ2lubmluZyBvZiB0aGUgY29sbGVjdGlvbi4KICAgIHNoaWZ0OiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgIHZhciBtb2RlbCA9IHRoaXMuYXQoMCk7CiAgICAgIHRoaXMucmVtb3ZlKG1vZGVsLCBvcHRpb25zKTsKICAgICAgcmV0dXJuIG1vZGVsOwogICAgfSwKCiAgICAvLyBTbGljZSBvdXQgYSBzdWItYXJyYXkgb2YgbW9kZWxzIGZyb20gdGhlIGNvbGxlY3Rpb24uCiAgICBzbGljZTogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBzbGljZS5hcHBseSh0aGlzLm1vZGVscywgYXJndW1lbnRzKTsKICAgIH0sCgogICAgLy8gR2V0IGEgbW9kZWwgZnJvbSB0aGUgc2V0IGJ5IGlkLgogICAgZ2V0OiBmdW5jdGlvbihvYmopIHsKICAgICAgaWYgKG9iaiA9PSBudWxsKSByZXR1cm4gdm9pZCAwOwogICAgICByZXR1cm4gdGhpcy5fYnlJZFtvYmpdIHx8IHRoaXMuX2J5SWRbb2JqLmlkXSB8fCB0aGlzLl9ieUlkW29iai5jaWRdOwogICAgfSwKCiAgICAvLyBHZXQgdGhlIG1vZGVsIGF0IHRoZSBnaXZlbiBpbmRleC4KICAgIGF0OiBmdW5jdGlvbihpbmRleCkgewogICAgICByZXR1cm4gdGhpcy5tb2RlbHNbaW5kZXhdOwogICAgfSwKCiAgICAvLyBSZXR1cm4gbW9kZWxzIHdpdGggbWF0Y2hpbmcgYXR0cmlidXRlcy4gVXNlZnVsIGZvciBzaW1wbGUgY2FzZXMgb2YKICAgIC8vIGBmaWx0ZXJgLgogICAgd2hlcmU6IGZ1bmN0aW9uKGF0dHJzLCBmaXJzdCkgewogICAgICBpZiAoXy5pc0VtcHR5KGF0dHJzKSkgcmV0dXJuIGZpcnN0ID8gdm9pZCAwIDogW107CiAgICAgIHJldHVybiB0aGlzW2ZpcnN0ID8gJ2ZpbmQnIDogJ2ZpbHRlciddKGZ1bmN0aW9uKG1vZGVsKSB7CiAgICAgICAgZm9yICh2YXIga2V5IGluIGF0dHJzKSB7CiAgICAgICAgICBpZiAoYXR0cnNba2V5XSAhPT0gbW9kZWwuZ2V0KGtleSkpIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0pOwogICAgfSwKCiAgICAvLyBSZXR1cm4gdGhlIGZpcnN0IG1vZGVsIHdpdGggbWF0Y2hpbmcgYXR0cmlidXRlcy4gVXNlZnVsIGZvciBzaW1wbGUgY2FzZXMKICAgIC8vIG9mIGBmaW5kYC4KICAgIGZpbmRXaGVyZTogZnVuY3Rpb24oYXR0cnMpIHsKICAgICAgcmV0dXJuIHRoaXMud2hlcmUoYXR0cnMsIHRydWUpOwogICAgfSwKCiAgICAvLyBGb3JjZSB0aGUgY29sbGVjdGlvbiB0byByZS1zb3J0IGl0c2VsZi4gWW91IGRvbid0IG5lZWQgdG8gY2FsbCB0aGlzIHVuZGVyCiAgICAvLyBub3JtYWwgY2lyY3Vtc3RhbmNlcywgYXMgdGhlIHNldCB3aWxsIG1haW50YWluIHNvcnQgb3JkZXIgYXMgZWFjaCBpdGVtCiAgICAvLyBpcyBhZGRlZC4KICAgIHNvcnQ6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgaWYgKCF0aGlzLmNvbXBhcmF0b3IpIHRocm93IG5ldyBFcnJvcignQ2Fubm90IHNvcnQgYSBzZXQgd2l0aG91dCBhIGNvbXBhcmF0b3InKTsKICAgICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTsKCiAgICAgIC8vIFJ1biBzb3J0IGJhc2VkIG9uIHR5cGUgb2YgYGNvbXBhcmF0b3JgLgogICAgICBpZiAoXy5pc1N0cmluZyh0aGlzLmNvbXBhcmF0b3IpIHx8IHRoaXMuY29tcGFyYXRvci5sZW5ndGggPT09IDEpIHsKICAgICAgICB0aGlzLm1vZGVscyA9IHRoaXMuc29ydEJ5KHRoaXMuY29tcGFyYXRvciwgdGhpcyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5tb2RlbHMuc29ydChfLmJpbmQodGhpcy5jb21wYXJhdG9yLCB0aGlzKSk7CiAgICAgIH0KCiAgICAgIGlmICghb3B0aW9ucy5zaWxlbnQpIHRoaXMudHJpZ2dlcignc29ydCcsIHRoaXMsIG9wdGlvbnMpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLy8gUGx1Y2sgYW4gYXR0cmlidXRlIGZyb20gZWFjaCBtb2RlbCBpbiB0aGUgY29sbGVjdGlvbi4KICAgIHBsdWNrOiBmdW5jdGlvbihhdHRyKSB7CiAgICAgIHJldHVybiBfLmludm9rZSh0aGlzLm1vZGVscywgJ2dldCcsIGF0dHIpOwogICAgfSwKCiAgICAvLyBGZXRjaCB0aGUgZGVmYXVsdCBzZXQgb2YgbW9kZWxzIGZvciB0aGlzIGNvbGxlY3Rpb24sIHJlc2V0dGluZyB0aGUKICAgIC8vIGNvbGxlY3Rpb24gd2hlbiB0aGV5IGFycml2ZS4gSWYgYHJlc2V0OiB0cnVlYCBpcyBwYXNzZWQsIHRoZSByZXNwb25zZQogICAgLy8gZGF0YSB3aWxsIGJlIHBhc3NlZCB0aHJvdWdoIHRoZSBgcmVzZXRgIG1ldGhvZCBpbnN0ZWFkIG9mIGBzZXRgLgogICAgZmV0Y2g6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgPyBfLmNsb25lKG9wdGlvbnMpIDoge307CiAgICAgIGlmIChvcHRpb25zLnBhcnNlID09PSB2b2lkIDApIG9wdGlvbnMucGFyc2UgPSB0cnVlOwogICAgICB2YXIgc3VjY2VzcyA9IG9wdGlvbnMuc3VjY2VzczsKICAgICAgdmFyIGNvbGxlY3Rpb24gPSB0aGlzOwogICAgICBvcHRpb25zLnN1Y2Nlc3MgPSBmdW5jdGlvbihyZXNwKSB7CiAgICAgICAgdmFyIG1ldGhvZCA9IG9wdGlvbnMucmVzZXQgPyAncmVzZXQnIDogJ3NldCc7CiAgICAgICAgY29sbGVjdGlvblttZXRob2RdKHJlc3AsIG9wdGlvbnMpOwogICAgICAgIGlmIChzdWNjZXNzKSBzdWNjZXNzKGNvbGxlY3Rpb24sIHJlc3AsIG9wdGlvbnMpOwogICAgICAgIGNvbGxlY3Rpb24udHJpZ2dlcignc3luYycsIGNvbGxlY3Rpb24sIHJlc3AsIG9wdGlvbnMpOwogICAgICB9OwogICAgICB3cmFwRXJyb3IodGhpcywgb3B0aW9ucyk7CiAgICAgIHJldHVybiB0aGlzLnN5bmMoJ3JlYWQnLCB0aGlzLCBvcHRpb25zKTsKICAgIH0sCgogICAgLy8gQ3JlYXRlIGEgbmV3IGluc3RhbmNlIG9mIGEgbW9kZWwgaW4gdGhpcyBjb2xsZWN0aW9uLiBBZGQgdGhlIG1vZGVsIHRvIHRoZQogICAgLy8gY29sbGVjdGlvbiBpbW1lZGlhdGVseSwgdW5sZXNzIGB3YWl0OiB0cnVlYCBpcyBwYXNzZWQsIGluIHdoaWNoIGNhc2Ugd2UKICAgIC8vIHdhaXQgZm9yIHRoZSBzZXJ2ZXIgdG8gYWdyZWUuCiAgICBjcmVhdGU6IGZ1bmN0aW9uKG1vZGVsLCBvcHRpb25zKSB7CiAgICAgIG9wdGlvbnMgPSBvcHRpb25zID8gXy5jbG9uZShvcHRpb25zKSA6IHt9OwogICAgICBpZiAoIShtb2RlbCA9IHRoaXMuX3ByZXBhcmVNb2RlbChtb2RlbCwgb3B0aW9ucykpKSByZXR1cm4gZmFsc2U7CiAgICAgIGlmICghb3B0aW9ucy53YWl0KSB0aGlzLmFkZChtb2RlbCwgb3B0aW9ucyk7CiAgICAgIHZhciBjb2xsZWN0aW9uID0gdGhpczsKICAgICAgdmFyIHN1Y2Nlc3MgPSBvcHRpb25zLnN1Y2Nlc3M7CiAgICAgIG9wdGlvbnMuc3VjY2VzcyA9IGZ1bmN0aW9uKG1vZGVsLCByZXNwKSB7CiAgICAgICAgaWYgKG9wdGlvbnMud2FpdCkgY29sbGVjdGlvbi5hZGQobW9kZWwsIG9wdGlvbnMpOwogICAgICAgIGlmIChzdWNjZXNzKSBzdWNjZXNzKG1vZGVsLCByZXNwLCBvcHRpb25zKTsKICAgICAgfTsKICAgICAgbW9kZWwuc2F2ZShudWxsLCBvcHRpb25zKTsKICAgICAgcmV0dXJuIG1vZGVsOwogICAgfSwKCiAgICAvLyAqKnBhcnNlKiogY29udmVydHMgYSByZXNwb25zZSBpbnRvIGEgbGlzdCBvZiBtb2RlbHMgdG8gYmUgYWRkZWQgdG8gdGhlCiAgICAvLyBjb2xsZWN0aW9uLiBUaGUgZGVmYXVsdCBpbXBsZW1lbnRhdGlvbiBpcyBqdXN0IHRvIHBhc3MgaXQgdGhyb3VnaC4KICAgIHBhcnNlOiBmdW5jdGlvbihyZXNwLCBvcHRpb25zKSB7CiAgICAgIHJldHVybiByZXNwOwogICAgfSwKCiAgICAvLyBDcmVhdGUgYSBuZXcgY29sbGVjdGlvbiB3aXRoIGFuIGlkZW50aWNhbCBsaXN0IG9mIG1vZGVscyBhcyB0aGlzIG9uZS4KICAgIGNsb25lOiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKHRoaXMubW9kZWxzKTsKICAgIH0sCgogICAgLy8gUHJpdmF0ZSBtZXRob2QgdG8gcmVzZXQgYWxsIGludGVybmFsIHN0YXRlLiBDYWxsZWQgd2hlbiB0aGUgY29sbGVjdGlvbgogICAgLy8gaXMgZmlyc3QgaW5pdGlhbGl6ZWQgb3IgcmVzZXQuCiAgICBfcmVzZXQ6IGZ1bmN0aW9uKCkgewogICAgICB0aGlzLmxlbmd0aCA9IDA7CiAgICAgIHRoaXMubW9kZWxzID0gW107CiAgICAgIHRoaXMuX2J5SWQgID0ge307CiAgICB9LAoKICAgIC8vIFByZXBhcmUgYSBoYXNoIG9mIGF0dHJpYnV0ZXMgKG9yIG90aGVyIG1vZGVsKSB0byBiZSBhZGRlZCB0byB0aGlzCiAgICAvLyBjb2xsZWN0aW9uLgogICAgX3ByZXBhcmVNb2RlbDogZnVuY3Rpb24oYXR0cnMsIG9wdGlvbnMpIHsKICAgICAgaWYgKGF0dHJzIGluc3RhbmNlb2YgTW9kZWwpIHJldHVybiBhdHRyczsKICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgPyBfLmNsb25lKG9wdGlvbnMpIDoge307CiAgICAgIG9wdGlvbnMuY29sbGVjdGlvbiA9IHRoaXM7CiAgICAgIHZhciBtb2RlbCA9IG5ldyB0aGlzLm1vZGVsKGF0dHJzLCBvcHRpb25zKTsKICAgICAgaWYgKCFtb2RlbC52YWxpZGF0aW9uRXJyb3IpIHJldHVybiBtb2RlbDsKICAgICAgdGhpcy50cmlnZ2VyKCdpbnZhbGlkJywgdGhpcywgbW9kZWwudmFsaWRhdGlvbkVycm9yLCBvcHRpb25zKTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSwKCiAgICAvLyBJbnRlcm5hbCBtZXRob2QgdG8gY3JlYXRlIGEgbW9kZWwncyB0aWVzIHRvIGEgY29sbGVjdGlvbi4KICAgIF9hZGRSZWZlcmVuY2U6IGZ1bmN0aW9uKG1vZGVsLCBvcHRpb25zKSB7CiAgICAgIHRoaXMuX2J5SWRbbW9kZWwuY2lkXSA9IG1vZGVsOwogICAgICBpZiAobW9kZWwuaWQgIT0gbnVsbCkgdGhpcy5fYnlJZFttb2RlbC5pZF0gPSBtb2RlbDsKICAgICAgaWYgKCFtb2RlbC5jb2xsZWN0aW9uKSBtb2RlbC5jb2xsZWN0aW9uID0gdGhpczsKICAgICAgbW9kZWwub24oJ2FsbCcsIHRoaXMuX29uTW9kZWxFdmVudCwgdGhpcyk7CiAgICB9LAoKICAgIC8vIEludGVybmFsIG1ldGhvZCB0byBzZXZlciBhIG1vZGVsJ3MgdGllcyB0byBhIGNvbGxlY3Rpb24uCiAgICBfcmVtb3ZlUmVmZXJlbmNlOiBmdW5jdGlvbihtb2RlbCwgb3B0aW9ucykgewogICAgICBpZiAodGhpcyA9PT0gbW9kZWwuY29sbGVjdGlvbikgZGVsZXRlIG1vZGVsLmNvbGxlY3Rpb247CiAgICAgIG1vZGVsLm9mZignYWxsJywgdGhpcy5fb25Nb2RlbEV2ZW50LCB0aGlzKTsKICAgIH0sCgogICAgLy8gSW50ZXJuYWwgbWV0aG9kIGNhbGxlZCBldmVyeSB0aW1lIGEgbW9kZWwgaW4gdGhlIHNldCBmaXJlcyBhbiBldmVudC4KICAgIC8vIFNldHMgbmVlZCB0byB1cGRhdGUgdGhlaXIgaW5kZXhlcyB3aGVuIG1vZGVscyBjaGFuZ2UgaWRzLiBBbGwgb3RoZXIKICAgIC8vIGV2ZW50cyBzaW1wbHkgcHJveHkgdGhyb3VnaC4gImFkZCIgYW5kICJyZW1vdmUiIGV2ZW50cyB0aGF0IG9yaWdpbmF0ZQogICAgLy8gaW4gb3RoZXIgY29sbGVjdGlvbnMgYXJlIGlnbm9yZWQuCiAgICBfb25Nb2RlbEV2ZW50OiBmdW5jdGlvbihldmVudCwgbW9kZWwsIGNvbGxlY3Rpb24sIG9wdGlvbnMpIHsKICAgICAgaWYgKChldmVudCA9PT0gJ2FkZCcgfHwgZXZlbnQgPT09ICdyZW1vdmUnKSAmJiBjb2xsZWN0aW9uICE9PSB0aGlzKSByZXR1cm47CiAgICAgIGlmIChldmVudCA9PT0gJ2Rlc3Ryb3knKSB0aGlzLnJlbW92ZShtb2RlbCwgb3B0aW9ucyk7CiAgICAgIGlmIChtb2RlbCAmJiBldmVudCA9PT0gJ2NoYW5nZTonICsgbW9kZWwuaWRBdHRyaWJ1dGUpIHsKICAgICAgICBkZWxldGUgdGhpcy5fYnlJZFttb2RlbC5wcmV2aW91cyhtb2RlbC5pZEF0dHJpYnV0ZSldOwogICAgICAgIGlmIChtb2RlbC5pZCAhPSBudWxsKSB0aGlzLl9ieUlkW21vZGVsLmlkXSA9IG1vZGVsOwogICAgICB9CiAgICAgIHRoaXMudHJpZ2dlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgfQoKICB9KTsKCiAgLy8gVW5kZXJzY29yZSBtZXRob2RzIHRoYXQgd2Ugd2FudCB0byBpbXBsZW1lbnQgb24gdGhlIENvbGxlY3Rpb24uCiAgLy8gOTAlIG9mIHRoZSBjb3JlIHVzZWZ1bG5lc3Mgb2YgQmFja2JvbmUgQ29sbGVjdGlvbnMgaXMgYWN0dWFsbHkgaW1wbGVtZW50ZWQKICAvLyByaWdodCBoZXJlOgogIHZhciBtZXRob2RzID0gWydmb3JFYWNoJywgJ2VhY2gnLCAnbWFwJywgJ2NvbGxlY3QnLCAncmVkdWNlJywgJ2ZvbGRsJywKICAgICdpbmplY3QnLCAncmVkdWNlUmlnaHQnLCAnZm9sZHInLCAnZmluZCcsICdkZXRlY3QnLCAnZmlsdGVyJywgJ3NlbGVjdCcsCiAgICAncmVqZWN0JywgJ2V2ZXJ5JywgJ2FsbCcsICdzb21lJywgJ2FueScsICdpbmNsdWRlJywgJ2NvbnRhaW5zJywgJ2ludm9rZScsCiAgICAnbWF4JywgJ21pbicsICd0b0FycmF5JywgJ3NpemUnLCAnZmlyc3QnLCAnaGVhZCcsICd0YWtlJywgJ2luaXRpYWwnLCAncmVzdCcsCiAgICAndGFpbCcsICdkcm9wJywgJ2xhc3QnLCAnd2l0aG91dCcsICdkaWZmZXJlbmNlJywgJ2luZGV4T2YnLCAnc2h1ZmZsZScsCiAgICAnbGFzdEluZGV4T2YnLCAnaXNFbXB0eScsICdjaGFpbicsICdzYW1wbGUnXTsKCiAgLy8gTWl4IGluIGVhY2ggVW5kZXJzY29yZSBtZXRob2QgYXMgYSBwcm94eSB0byBgQ29sbGVjdGlvbiNtb2RlbHNgLgogIF8uZWFjaChtZXRob2RzLCBmdW5jdGlvbihtZXRob2QpIHsKICAgIENvbGxlY3Rpb24ucHJvdG90eXBlW21ldGhvZF0gPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIGFyZ3MgPSBzbGljZS5jYWxsKGFyZ3VtZW50cyk7CiAgICAgIGFyZ3MudW5zaGlmdCh0aGlzLm1vZGVscyk7CiAgICAgIHJldHVybiBfW21ldGhvZF0uYXBwbHkoXywgYXJncyk7CiAgICB9OwogIH0pOwoKICAvLyBVbmRlcnNjb3JlIG1ldGhvZHMgdGhhdCB0YWtlIGEgcHJvcGVydHkgbmFtZSBhcyBhbiBhcmd1bWVudC4KICB2YXIgYXR0cmlidXRlTWV0aG9kcyA9IFsnZ3JvdXBCeScsICdjb3VudEJ5JywgJ3NvcnRCeScsICdpbmRleEJ5J107CgogIC8vIFVzZSBhdHRyaWJ1dGVzIGluc3RlYWQgb2YgcHJvcGVydGllcy4KICBfLmVhY2goYXR0cmlidXRlTWV0aG9kcywgZnVuY3Rpb24obWV0aG9kKSB7CiAgICBDb2xsZWN0aW9uLnByb3RvdHlwZVttZXRob2RdID0gZnVuY3Rpb24odmFsdWUsIGNvbnRleHQpIHsKICAgICAgdmFyIGl0ZXJhdG9yID0gXy5pc0Z1bmN0aW9uKHZhbHVlKSA/IHZhbHVlIDogZnVuY3Rpb24obW9kZWwpIHsKICAgICAgICByZXR1cm4gbW9kZWwuZ2V0KHZhbHVlKTsKICAgICAgfTsKICAgICAgcmV0dXJuIF9bbWV0aG9kXSh0aGlzLm1vZGVscywgaXRlcmF0b3IsIGNvbnRleHQpOwogICAgfTsKICB9KTsKCiAgLy8gQmFja2JvbmUuVmlldwogIC8vIC0tLS0tLS0tLS0tLS0KCiAgLy8gQmFja2JvbmUgVmlld3MgYXJlIGFsbW9zdCBtb3JlIGNvbnZlbnRpb24gdGhhbiB0aGV5IGFyZSBhY3R1YWwgY29kZS4gQSBWaWV3CiAgLy8gaXMgc2ltcGx5IGEgSmF2YVNjcmlwdCBvYmplY3QgdGhhdCByZXByZXNlbnRzIGEgbG9naWNhbCBjaHVuayBvZiBVSSBpbiB0aGUKICAvLyBET00uIFRoaXMgbWlnaHQgYmUgYSBzaW5nbGUgaXRlbSwgYW4gZW50aXJlIGxpc3QsIGEgc2lkZWJhciBvciBwYW5lbCwgb3IKICAvLyBldmVuIHRoZSBzdXJyb3VuZGluZyBmcmFtZSB3aGljaCB3cmFwcyB5b3VyIHdob2xlIGFwcC4gRGVmaW5pbmcgYSBjaHVuayBvZgogIC8vIFVJIGFzIGEgKipWaWV3KiogYWxsb3dzIHlvdSB0byBkZWZpbmUgeW91ciBET00gZXZlbnRzIGRlY2xhcmF0aXZlbHksIHdpdGhvdXQKICAvLyBoYXZpbmcgdG8gd29ycnkgYWJvdXQgcmVuZGVyIG9yZGVyIC4uLiBhbmQgbWFrZXMgaXQgZWFzeSBmb3IgdGhlIHZpZXcgdG8KICAvLyByZWFjdCB0byBzcGVjaWZpYyBjaGFuZ2VzIGluIHRoZSBzdGF0ZSBvZiB5b3VyIG1vZGVscy4KCiAgLy8gQ3JlYXRpbmcgYSBCYWNrYm9uZS5WaWV3IGNyZWF0ZXMgaXRzIGluaXRpYWwgZWxlbWVudCBvdXRzaWRlIG9mIHRoZSBET00sCiAgLy8gaWYgYW4gZXhpc3RpbmcgZWxlbWVudCBpcyBub3QgcHJvdmlkZWQuLi4KICB2YXIgVmlldyA9IEJhY2tib25lLlZpZXcgPSBmdW5jdGlvbihvcHRpb25zKSB7CiAgICB0aGlzLmNpZCA9IF8udW5pcXVlSWQoJ3ZpZXcnKTsKICAgIG9wdGlvbnMgfHwgKG9wdGlvbnMgPSB7fSk7CiAgICBfLmV4dGVuZCh0aGlzLCBfLnBpY2sob3B0aW9ucywgdmlld09wdGlvbnMpKTsKICAgIHRoaXMuX2Vuc3VyZUVsZW1lbnQoKTsKICAgIHRoaXMuaW5pdGlhbGl6ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgdGhpcy5kZWxlZ2F0ZUV2ZW50cygpOwogIH07CgogIC8vIENhY2hlZCByZWdleCB0byBzcGxpdCBrZXlzIGZvciBgZGVsZWdhdGVgLgogIHZhciBkZWxlZ2F0ZUV2ZW50U3BsaXR0ZXIgPSAvXihcUyspXHMqKC4qKSQvOwoKICAvLyBMaXN0IG9mIHZpZXcgb3B0aW9ucyB0byBiZSBtZXJnZWQgYXMgcHJvcGVydGllcy4KICB2YXIgdmlld09wdGlvbnMgPSBbJ21vZGVsJywgJ2NvbGxlY3Rpb24nLCAnZWwnLCAnaWQnLCAnYXR0cmlidXRlcycsICdjbGFzc05hbWUnLCAndGFnTmFtZScsICdldmVudHMnXTsKCiAgLy8gU2V0IHVwIGFsbCBpbmhlcml0YWJsZSAqKkJhY2tib25lLlZpZXcqKiBwcm9wZXJ0aWVzIGFuZCBtZXRob2RzLgogIF8uZXh0ZW5kKFZpZXcucHJvdG90eXBlLCBFdmVudHMsIHsKCiAgICAvLyBUaGUgZGVmYXVsdCBgdGFnTmFtZWAgb2YgYSBWaWV3J3MgZWxlbWVudCBpcyBgImRpdiJgLgogICAgdGFnTmFtZTogJ2RpdicsCgogICAgLy8galF1ZXJ5IGRlbGVnYXRlIGZvciBlbGVtZW50IGxvb2t1cCwgc2NvcGVkIHRvIERPTSBlbGVtZW50cyB3aXRoaW4gdGhlCiAgICAvLyBjdXJyZW50IHZpZXcuIFRoaXMgc2hvdWxkIGJlIHByZWZlcnJlZCB0byBnbG9iYWwgbG9va3VwcyB3aGVyZSBwb3NzaWJsZS4KICAgICQ6IGZ1bmN0aW9uKHNlbGVjdG9yKSB7CiAgICAgIHJldHVybiB0aGlzLiRlbC5maW5kKHNlbGVjdG9yKTsKICAgIH0sCgogICAgLy8gSW5pdGlhbGl6ZSBpcyBhbiBlbXB0eSBmdW5jdGlvbiBieSBkZWZhdWx0LiBPdmVycmlkZSBpdCB3aXRoIHlvdXIgb3duCiAgICAvLyBpbml0aWFsaXphdGlvbiBsb2dpYy4KICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uKCl7fSwKCiAgICAvLyAqKnJlbmRlcioqIGlzIHRoZSBjb3JlIGZ1bmN0aW9uIHRoYXQgeW91ciB2aWV3IHNob3VsZCBvdmVycmlkZSwgaW4gb3JkZXIKICAgIC8vIHRvIHBvcHVsYXRlIGl0cyBlbGVtZW50IChgdGhpcy5lbGApLCB3aXRoIHRoZSBhcHByb3ByaWF0ZSBIVE1MLiBUaGUKICAgIC8vIGNvbnZlbnRpb24gaXMgZm9yICoqcmVuZGVyKiogdG8gYWx3YXlzIHJldHVybiBgdGhpc2AuCiAgICByZW5kZXI6IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLy8gUmVtb3ZlIHRoaXMgdmlldyBieSB0YWtpbmcgdGhlIGVsZW1lbnQgb3V0IG9mIHRoZSBET00sIGFuZCByZW1vdmluZyBhbnkKICAgIC8vIGFwcGxpY2FibGUgQmFja2JvbmUuRXZlbnRzIGxpc3RlbmVycy4KICAgIHJlbW92ZTogZnVuY3Rpb24oKSB7CiAgICAgIHRoaXMuJGVsLnJlbW92ZSgpOwogICAgICB0aGlzLnN0b3BMaXN0ZW5pbmcoKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAoKICAgIC8vIENoYW5nZSB0aGUgdmlldydzIGVsZW1lbnQgKGB0aGlzLmVsYCBwcm9wZXJ0eSksIGluY2x1ZGluZyBldmVudAogICAgLy8gcmUtZGVsZWdhdGlvbi4KICAgIHNldEVsZW1lbnQ6IGZ1bmN0aW9uKGVsZW1lbnQsIGRlbGVnYXRlKSB7CiAgICAgIGlmICh0aGlzLiRlbCkgdGhpcy51bmRlbGVnYXRlRXZlbnRzKCk7CiAgICAgIHRoaXMuJGVsID0gZWxlbWVudCBpbnN0YW5jZW9mIEJhY2tib25lLiQgPyBlbGVtZW50IDogQmFja2JvbmUuJChlbGVtZW50KTsKICAgICAgdGhpcy5lbCA9IHRoaXMuJGVsWzBdOwogICAgICBpZiAoZGVsZWdhdGUgIT09IGZhbHNlKSB0aGlzLmRlbGVnYXRlRXZlbnRzKCk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvLyBTZXQgY2FsbGJhY2tzLCB3aGVyZSBgdGhpcy5ldmVudHNgIGlzIGEgaGFzaCBvZgogICAgLy8KICAgIC8vICp7ImV2ZW50IHNlbGVjdG9yIjogImNhbGxiYWNrIn0qCiAgICAvLwogICAgLy8gICAgIHsKICAgIC8vICAgICAgICdtb3VzZWRvd24gLnRpdGxlJzogICdlZGl0JywKICAgIC8vICAgICAgICdjbGljayAuYnV0dG9uJzogICAgICdzYXZlJywKICAgIC8vICAgICAgICdjbGljayAub3Blbic6ICAgICAgIGZ1bmN0aW9uKGUpIHsgLi4uIH0KICAgIC8vICAgICB9CiAgICAvLwogICAgLy8gcGFpcnMuIENhbGxiYWNrcyB3aWxsIGJlIGJvdW5kIHRvIHRoZSB2aWV3LCB3aXRoIGB0aGlzYCBzZXQgcHJvcGVybHkuCiAgICAvLyBVc2VzIGV2ZW50IGRlbGVnYXRpb24gZm9yIGVmZmljaWVuY3kuCiAgICAvLyBPbWl0dGluZyB0aGUgc2VsZWN0b3IgYmluZHMgdGhlIGV2ZW50IHRvIGB0aGlzLmVsYC4KICAgIC8vIFRoaXMgb25seSB3b3JrcyBmb3IgZGVsZWdhdGUtYWJsZSBldmVudHM6IG5vdCBgZm9jdXNgLCBgYmx1cmAsIGFuZAogICAgLy8gbm90IGBjaGFuZ2VgLCBgc3VibWl0YCwgYW5kIGByZXNldGAgaW4gSW50ZXJuZXQgRXhwbG9yZXIuCiAgICBkZWxlZ2F0ZUV2ZW50czogZnVuY3Rpb24oZXZlbnRzKSB7CiAgICAgIGlmICghKGV2ZW50cyB8fCAoZXZlbnRzID0gXy5yZXN1bHQodGhpcywgJ2V2ZW50cycpKSkpIHJldHVybiB0aGlzOwogICAgICB0aGlzLnVuZGVsZWdhdGVFdmVudHMoKTsKICAgICAgZm9yICh2YXIga2V5IGluIGV2ZW50cykgewogICAgICAgIHZhciBtZXRob2QgPSBldmVudHNba2V5XTsKICAgICAgICBpZiAoIV8uaXNGdW5jdGlvbihtZXRob2QpKSBtZXRob2QgPSB0aGlzW2V2ZW50c1trZXldXTsKICAgICAgICBpZiAoIW1ldGhvZCkgY29udGludWU7CgogICAgICAgIHZhciBtYXRjaCA9IGtleS5tYXRjaChkZWxlZ2F0ZUV2ZW50U3BsaXR0ZXIpOwogICAgICAgIHZhciBldmVudE5hbWUgPSBtYXRjaFsxXSwgc2VsZWN0b3IgPSBtYXRjaFsyXTsKICAgICAgICBtZXRob2QgPSBfLmJpbmQobWV0aG9kLCB0aGlzKTsKICAgICAgICBldmVudE5hbWUgKz0gJy5kZWxlZ2F0ZUV2ZW50cycgKyB0aGlzLmNpZDsKICAgICAgICBpZiAoc2VsZWN0b3IgPT09ICcnKSB7CiAgICAgICAgICB0aGlzLiRlbC5vbihldmVudE5hbWUsIG1ldGhvZCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuJGVsLm9uKGV2ZW50TmFtZSwgc2VsZWN0b3IsIG1ldGhvZCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvLyBDbGVhcnMgYWxsIGNhbGxiYWNrcyBwcmV2aW91c2x5IGJvdW5kIHRvIHRoZSB2aWV3IHdpdGggYGRlbGVnYXRlRXZlbnRzYC4KICAgIC8vIFlvdSB1c3VhbGx5IGRvbid0IG5lZWQgdG8gdXNlIHRoaXMsIGJ1dCBtYXkgd2lzaCB0byBpZiB5b3UgaGF2ZSBtdWx0aXBsZQogICAgLy8gQmFja2JvbmUgdmlld3MgYXR0YWNoZWQgdG8gdGhlIHNhbWUgRE9NIGVsZW1lbnQuCiAgICB1bmRlbGVnYXRlRXZlbnRzOiBmdW5jdGlvbigpIHsKICAgICAgdGhpcy4kZWwub2ZmKCcuZGVsZWdhdGVFdmVudHMnICsgdGhpcy5jaWQpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLy8gRW5zdXJlIHRoYXQgdGhlIFZpZXcgaGFzIGEgRE9NIGVsZW1lbnQgdG8gcmVuZGVyIGludG8uCiAgICAvLyBJZiBgdGhpcy5lbGAgaXMgYSBzdHJpbmcsIHBhc3MgaXQgdGhyb3VnaCBgJCgpYCwgdGFrZSB0aGUgZmlyc3QKICAgIC8vIG1hdGNoaW5nIGVsZW1lbnQsIGFuZCByZS1hc3NpZ24gaXQgdG8gYGVsYC4gT3RoZXJ3aXNlLCBjcmVhdGUKICAgIC8vIGFuIGVsZW1lbnQgZnJvbSB0aGUgYGlkYCwgYGNsYXNzTmFtZWAgYW5kIGB0YWdOYW1lYCBwcm9wZXJ0aWVzLgogICAgX2Vuc3VyZUVsZW1lbnQ6IGZ1bmN0aW9uKCkgewogICAgICBpZiAoIXRoaXMuZWwpIHsKICAgICAgICB2YXIgYXR0cnMgPSBfLmV4dGVuZCh7fSwgXy5yZXN1bHQodGhpcywgJ2F0dHJpYnV0ZXMnKSk7CiAgICAgICAgaWYgKHRoaXMuaWQpIGF0dHJzLmlkID0gXy5yZXN1bHQodGhpcywgJ2lkJyk7CiAgICAgICAgaWYgKHRoaXMuY2xhc3NOYW1lKSBhdHRyc1snY2xhc3MnXSA9IF8ucmVzdWx0KHRoaXMsICdjbGFzc05hbWUnKTsKICAgICAgICB2YXIgJGVsID0gQmFja2JvbmUuJCgnPCcgKyBfLnJlc3VsdCh0aGlzLCAndGFnTmFtZScpICsgJz4nKS5hdHRyKGF0dHJzKTsKICAgICAgICB0aGlzLnNldEVsZW1lbnQoJGVsLCBmYWxzZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5zZXRFbGVtZW50KF8ucmVzdWx0KHRoaXMsICdlbCcpLCBmYWxzZSk7CiAgICAgIH0KICAgIH0KCiAgfSk7CgogIC8vIEJhY2tib25lLnN5bmMKICAvLyAtLS0tLS0tLS0tLS0tCgogIC8vIE92ZXJyaWRlIHRoaXMgZnVuY3Rpb24gdG8gY2hhbmdlIHRoZSBtYW5uZXIgaW4gd2hpY2ggQmFja2JvbmUgcGVyc2lzdHMKICAvLyBtb2RlbHMgdG8gdGhlIHNlcnZlci4gWW91IHdpbGwgYmUgcGFzc2VkIHRoZSB0eXBlIG9mIHJlcXVlc3QsIGFuZCB0aGUKICAvLyBtb2RlbCBpbiBxdWVzdGlvbi4gQnkgZGVmYXVsdCwgbWFrZXMgYSBSRVNUZnVsIEFqYXggcmVxdWVzdAogIC8vIHRvIHRoZSBtb2RlbCdzIGB1cmwoKWAuIFNvbWUgcG9zc2libGUgY3VzdG9taXphdGlvbnMgY291bGQgYmU6CiAgLy8KICAvLyAqIFVzZSBgc2V0VGltZW91dGAgdG8gYmF0Y2ggcmFwaWQtZmlyZSB1cGRhdGVzIGludG8gYSBzaW5nbGUgcmVxdWVzdC4KICAvLyAqIFNlbmQgdXAgdGhlIG1vZGVscyBhcyBYTUwgaW5zdGVhZCBvZiBKU09OLgogIC8vICogUGVyc2lzdCBtb2RlbHMgdmlhIFdlYlNvY2tldHMgaW5zdGVhZCBvZiBBamF4LgogIC8vCiAgLy8gVHVybiBvbiBgQmFja2JvbmUuZW11bGF0ZUhUVFBgIGluIG9yZGVyIHRvIHNlbmQgYFBVVGAgYW5kIGBERUxFVEVgIHJlcXVlc3RzCiAgLy8gYXMgYFBPU1RgLCB3aXRoIGEgYF9tZXRob2RgIHBhcmFtZXRlciBjb250YWluaW5nIHRoZSB0cnVlIEhUVFAgbWV0aG9kLAogIC8vIGFzIHdlbGwgYXMgYWxsIHJlcXVlc3RzIHdpdGggdGhlIGJvZHkgYXMgYGFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZGAKICAvLyBpbnN0ZWFkIG9mIGBhcHBsaWNhdGlvbi9qc29uYCB3aXRoIHRoZSBtb2RlbCBpbiBhIHBhcmFtIG5hbWVkIGBtb2RlbGAuCiAgLy8gVXNlZnVsIHdoZW4gaW50ZXJmYWNpbmcgd2l0aCBzZXJ2ZXItc2lkZSBsYW5ndWFnZXMgbGlrZSAqKlBIUCoqIHRoYXQgbWFrZQogIC8vIGl0IGRpZmZpY3VsdCB0byByZWFkIHRoZSBib2R5IG9mIGBQVVRgIHJlcXVlc3RzLgogIEJhY2tib25lLnN5bmMgPSBmdW5jdGlvbihtZXRob2QsIG1vZGVsLCBvcHRpb25zKSB7CiAgICB2YXIgdHlwZSA9IG1ldGhvZE1hcFttZXRob2RdOwoKICAgIC8vIERlZmF1bHQgb3B0aW9ucywgdW5sZXNzIHNwZWNpZmllZC4KICAgIF8uZGVmYXVsdHMob3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KSwgewogICAgICBlbXVsYXRlSFRUUDogQmFja2JvbmUuZW11bGF0ZUhUVFAsCiAgICAgIGVtdWxhdGVKU09OOiBCYWNrYm9uZS5lbXVsYXRlSlNPTgogICAgfSk7CgogICAgLy8gRGVmYXVsdCBKU09OLXJlcXVlc3Qgb3B0aW9ucy4KICAgIHZhciBwYXJhbXMgPSB7dHlwZTogdHlwZSwgZGF0YVR5cGU6ICdqc29uJ307CgogICAgLy8gRW5zdXJlIHRoYXQgd2UgaGF2ZSBhIFVSTC4KICAgIGlmICghb3B0aW9ucy51cmwpIHsKICAgICAgcGFyYW1zLnVybCA9IF8ucmVzdWx0KG1vZGVsLCAndXJsJykgfHwgdXJsRXJyb3IoKTsKICAgIH0KCiAgICAvLyBFbnN1cmUgdGhhdCB3ZSBoYXZlIHRoZSBhcHByb3ByaWF0ZSByZXF1ZXN0IGRhdGEuCiAgICBpZiAob3B0aW9ucy5kYXRhID09IG51bGwgJiYgbW9kZWwgJiYgKG1ldGhvZCA9PT0gJ2NyZWF0ZScgfHwgbWV0aG9kID09PSAndXBkYXRlJyB8fCBtZXRob2QgPT09ICdwYXRjaCcpKSB7CiAgICAgIHBhcmFtcy5jb250ZW50VHlwZSA9ICdhcHBsaWNhdGlvbi9qc29uJzsKICAgICAgcGFyYW1zLmRhdGEgPSBKU09OLnN0cmluZ2lmeShvcHRpb25zLmF0dHJzIHx8IG1vZGVsLnRvSlNPTihvcHRpb25zKSk7CiAgICB9CgogICAgLy8gRm9yIG9sZGVyIHNlcnZlcnMsIGVtdWxhdGUgSlNPTiBieSBlbmNvZGluZyB0aGUgcmVxdWVzdCBpbnRvIGFuIEhUTUwtZm9ybS4KICAgIGlmIChvcHRpb25zLmVtdWxhdGVKU09OKSB7CiAgICAgIHBhcmFtcy5jb250ZW50VHlwZSA9ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnOwogICAgICBwYXJhbXMuZGF0YSA9IHBhcmFtcy5kYXRhID8ge21vZGVsOiBwYXJhbXMuZGF0YX0gOiB7fTsKICAgIH0KCiAgICAvLyBGb3Igb2xkZXIgc2VydmVycywgZW11bGF0ZSBIVFRQIGJ5IG1pbWlja2luZyB0aGUgSFRUUCBtZXRob2Qgd2l0aCBgX21ldGhvZGAKICAgIC8vIEFuZCBhbiBgWC1IVFRQLU1ldGhvZC1PdmVycmlkZWAgaGVhZGVyLgogICAgaWYgKG9wdGlvbnMuZW11bGF0ZUhUVFAgJiYgKHR5cGUgPT09ICdQVVQnIHx8IHR5cGUgPT09ICdERUxFVEUnIHx8IHR5cGUgPT09ICdQQVRDSCcpKSB7CiAgICAgIHBhcmFtcy50eXBlID0gJ1BPU1QnOwogICAgICBpZiAob3B0aW9ucy5lbXVsYXRlSlNPTikgcGFyYW1zLmRhdGEuX21ldGhvZCA9IHR5cGU7CiAgICAgIHZhciBiZWZvcmVTZW5kID0gb3B0aW9ucy5iZWZvcmVTZW5kOwogICAgICBvcHRpb25zLmJlZm9yZVNlbmQgPSBmdW5jdGlvbih4aHIpIHsKICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcignWC1IVFRQLU1ldGhvZC1PdmVycmlkZScsIHR5cGUpOwogICAgICAgIGlmIChiZWZvcmVTZW5kKSByZXR1cm4gYmVmb3JlU2VuZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9OwogICAgfQoKICAgIC8vIERvbid0IHByb2Nlc3MgZGF0YSBvbiBhIG5vbi1HRVQgcmVxdWVzdC4KICAgIGlmIChwYXJhbXMudHlwZSAhPT0gJ0dFVCcgJiYgIW9wdGlvbnMuZW11bGF0ZUpTT04pIHsKICAgICAgcGFyYW1zLnByb2Nlc3NEYXRhID0gZmFsc2U7CiAgICB9CgogICAgLy8gSWYgd2UncmUgc2VuZGluZyBhIGBQQVRDSGAgcmVxdWVzdCwgYW5kIHdlJ3JlIGluIGFuIG9sZCBJbnRlcm5ldCBFeHBsb3JlcgogICAgLy8gdGhhdCBzdGlsbCBoYXMgQWN0aXZlWCBlbmFibGVkIGJ5IGRlZmF1bHQsIG92ZXJyaWRlIGpRdWVyeSB0byB1c2UgdGhhdAogICAgLy8gZm9yIFhIUiBpbnN0ZWFkLiBSZW1vdmUgdGhpcyBsaW5lIHdoZW4galF1ZXJ5IHN1cHBvcnRzIGBQQVRDSGAgb24gSUU4LgogICAgaWYgKHBhcmFtcy50eXBlID09PSAnUEFUQ0gnICYmIG5vWGhyUGF0Y2gpIHsKICAgICAgcGFyYW1zLnhociA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBuZXcgQWN0aXZlWE9iamVjdCgiTWljcm9zb2Z0LlhNTEhUVFAiKTsKICAgICAgfTsKICAgIH0KCiAgICAvLyBNYWtlIHRoZSByZXF1ZXN0LCBhbGxvd2luZyB0aGUgdXNlciB0byBvdmVycmlkZSBhbnkgQWpheCBvcHRpb25zLgogICAgdmFyIHhociA9IG9wdGlvbnMueGhyID0gQmFja2JvbmUuYWpheChfLmV4dGVuZChwYXJhbXMsIG9wdGlvbnMpKTsKICAgIG1vZGVsLnRyaWdnZXIoJ3JlcXVlc3QnLCBtb2RlbCwgeGhyLCBvcHRpb25zKTsKICAgIHJldHVybiB4aHI7CiAgfTsKCiAgdmFyIG5vWGhyUGF0Y2ggPQogICAgdHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgJiYgISF3aW5kb3cuQWN0aXZlWE9iamVjdCAmJgogICAgICAhKHdpbmRvdy5YTUxIdHRwUmVxdWVzdCAmJiAobmV3IFhNTEh0dHBSZXF1ZXN0KS5kaXNwYXRjaEV2ZW50KTsKCiAgLy8gTWFwIGZyb20gQ1JVRCB0byBIVFRQIGZvciBvdXIgZGVmYXVsdCBgQmFja2JvbmUuc3luY2AgaW1wbGVtZW50YXRpb24uCiAgdmFyIG1ldGhvZE1hcCA9IHsKICAgICdjcmVhdGUnOiAnUE9TVCcsCiAgICAndXBkYXRlJzogJ1BVVCcsCiAgICAncGF0Y2gnOiAgJ1BBVENIJywKICAgICdkZWxldGUnOiAnREVMRVRFJywKICAgICdyZWFkJzogICAnR0VUJwogIH07CgogIC8vIFNldCB0aGUgZGVmYXVsdCBpbXBsZW1lbnRhdGlvbiBvZiBgQmFja2JvbmUuYWpheGAgdG8gcHJveHkgdGhyb3VnaCB0byBgJGAuCiAgLy8gT3ZlcnJpZGUgdGhpcyBpZiB5b3UnZCBsaWtlIHRvIHVzZSBhIGRpZmZlcmVudCBsaWJyYXJ5LgogIEJhY2tib25lLmFqYXggPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiBCYWNrYm9uZS4kLmFqYXguYXBwbHkoQmFja2JvbmUuJCwgYXJndW1lbnRzKTsKICB9OwoKICAvLyBCYWNrYm9uZS5Sb3V0ZXIKICAvLyAtLS0tLS0tLS0tLS0tLS0KCiAgLy8gUm91dGVycyBtYXAgZmF1eC1VUkxzIHRvIGFjdGlvbnMsIGFuZCBmaXJlIGV2ZW50cyB3aGVuIHJvdXRlcyBhcmUKICAvLyBtYXRjaGVkLiBDcmVhdGluZyBhIG5ldyBvbmUgc2V0cyBpdHMgYHJvdXRlc2AgaGFzaCwgaWYgbm90IHNldCBzdGF0aWNhbGx5LgogIHZhciBSb3V0ZXIgPSBCYWNrYm9uZS5Sb3V0ZXIgPSBmdW5jdGlvbihvcHRpb25zKSB7CiAgICBvcHRpb25zIHx8IChvcHRpb25zID0ge30pOwogICAgaWYgKG9wdGlvbnMucm91dGVzKSB0aGlzLnJvdXRlcyA9IG9wdGlvbnMucm91dGVzOwogICAgdGhpcy5fYmluZFJvdXRlcygpOwogICAgdGhpcy5pbml0aWFsaXplLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgfTsKCiAgLy8gQ2FjaGVkIHJlZ3VsYXIgZXhwcmVzc2lvbnMgZm9yIG1hdGNoaW5nIG5hbWVkIHBhcmFtIHBhcnRzIGFuZCBzcGxhdHRlZAogIC8vIHBhcnRzIG9mIHJvdXRlIHN0cmluZ3MuCiAgdmFyIG9wdGlvbmFsUGFyYW0gPSAvXCgoLio/KVwpL2c7CiAgdmFyIG5hbWVkUGFyYW0gICAgPSAvKFwoXD8pPzpcdysvZzsKICB2YXIgc3BsYXRQYXJhbSAgICA9IC9cKlx3Ky9nOwogIHZhciBlc2NhcGVSZWdFeHAgID0gL1tcLXt9XFtcXSs/LixcXFxeJHwjXHNdL2c7CgogIC8vIFNldCB1cCBhbGwgaW5oZXJpdGFibGUgKipCYWNrYm9uZS5Sb3V0ZXIqKiBwcm9wZXJ0aWVzIGFuZCBtZXRob2RzLgogIF8uZXh0ZW5kKFJvdXRlci5wcm90b3R5cGUsIEV2ZW50cywgewoKICAgIC8vIEluaXRpYWxpemUgaXMgYW4gZW1wdHkgZnVuY3Rpb24gYnkgZGVmYXVsdC4gT3ZlcnJpZGUgaXQgd2l0aCB5b3VyIG93bgogICAgLy8gaW5pdGlhbGl6YXRpb24gbG9naWMuCiAgICBpbml0aWFsaXplOiBmdW5jdGlvbigpe30sCgogICAgLy8gTWFudWFsbHkgYmluZCBhIHNpbmdsZSBuYW1lZCByb3V0ZSB0byBhIGNhbGxiYWNrLiBGb3IgZXhhbXBsZToKICAgIC8vCiAgICAvLyAgICAgdGhpcy5yb3V0ZSgnc2VhcmNoLzpxdWVyeS9wOm51bScsICdzZWFyY2gnLCBmdW5jdGlvbihxdWVyeSwgbnVtKSB7CiAgICAvLyAgICAgICAuLi4KICAgIC8vICAgICB9KTsKICAgIC8vCiAgICByb3V0ZTogZnVuY3Rpb24ocm91dGUsIG5hbWUsIGNhbGxiYWNrKSB7CiAgICAgIGlmICghXy5pc1JlZ0V4cChyb3V0ZSkpIHJvdXRlID0gdGhpcy5fcm91dGVUb1JlZ0V4cChyb3V0ZSk7CiAgICAgIGlmIChfLmlzRnVuY3Rpb24obmFtZSkpIHsKICAgICAgICBjYWxsYmFjayA9IG5hbWU7CiAgICAgICAgbmFtZSA9ICcnOwogICAgICB9CiAgICAgIGlmICghY2FsbGJhY2spIGNhbGxiYWNrID0gdGhpc1tuYW1lXTsKICAgICAgdmFyIHJvdXRlciA9IHRoaXM7CiAgICAgIEJhY2tib25lLmhpc3Rvcnkucm91dGUocm91dGUsIGZ1bmN0aW9uKGZyYWdtZW50KSB7CiAgICAgICAgdmFyIGFyZ3MgPSByb3V0ZXIuX2V4dHJhY3RQYXJhbWV0ZXJzKHJvdXRlLCBmcmFnbWVudCk7CiAgICAgICAgcm91dGVyLmV4ZWN1dGUoY2FsbGJhY2ssIGFyZ3MpOwogICAgICAgIHJvdXRlci50cmlnZ2VyLmFwcGx5KHJvdXRlciwgWydyb3V0ZTonICsgbmFtZV0uY29uY2F0KGFyZ3MpKTsKICAgICAgICByb3V0ZXIudHJpZ2dlcigncm91dGUnLCBuYW1lLCBhcmdzKTsKICAgICAgICBCYWNrYm9uZS5oaXN0b3J5LnRyaWdnZXIoJ3JvdXRlJywgcm91dGVyLCBuYW1lLCBhcmdzKTsKICAgICAgfSk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvLyBFeGVjdXRlIGEgcm91dGUgaGFuZGxlciB3aXRoIHRoZSBwcm92aWRlZCBwYXJhbWV0ZXJzLiAgVGhpcyBpcyBhbgogICAgLy8gZXhjZWxsZW50IHBsYWNlIHRvIGRvIHByZS1yb3V0ZSBzZXR1cCBvciBwb3N0LXJvdXRlIGNsZWFudXAuCiAgICBleGVjdXRlOiBmdW5jdGlvbihjYWxsYmFjaywgYXJncykgewogICAgICBpZiAoY2FsbGJhY2spIGNhbGxiYWNrLmFwcGx5KHRoaXMsIGFyZ3MpOwogICAgfSwKCiAgICAvLyBTaW1wbGUgcHJveHkgdG8gYEJhY2tib25lLmhpc3RvcnlgIHRvIHNhdmUgYSBmcmFnbWVudCBpbnRvIHRoZSBoaXN0b3J5LgogICAgbmF2aWdhdGU6IGZ1bmN0aW9uKGZyYWdtZW50LCBvcHRpb25zKSB7CiAgICAgIEJhY2tib25lLmhpc3RvcnkubmF2aWdhdGUoZnJhZ21lbnQsIG9wdGlvbnMpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLy8gQmluZCBhbGwgZGVmaW5lZCByb3V0ZXMgdG8gYEJhY2tib25lLmhpc3RvcnlgLiBXZSBoYXZlIHRvIHJldmVyc2UgdGhlCiAgICAvLyBvcmRlciBvZiB0aGUgcm91dGVzIGhlcmUgdG8gc3VwcG9ydCBiZWhhdmlvciB3aGVyZSB0aGUgbW9zdCBnZW5lcmFsCiAgICAvLyByb3V0ZXMgY2FuIGJlIGRlZmluZWQgYXQgdGhlIGJvdHRvbSBvZiB0aGUgcm91dGUgbWFwLgogICAgX2JpbmRSb3V0ZXM6IGZ1bmN0aW9uKCkgewogICAgICBpZiAoIXRoaXMucm91dGVzKSByZXR1cm47CiAgICAgIHRoaXMucm91dGVzID0gXy5yZXN1bHQodGhpcywgJ3JvdXRlcycpOwogICAgICB2YXIgcm91dGUsIHJvdXRlcyA9IF8ua2V5cyh0aGlzLnJvdXRlcyk7CiAgICAgIHdoaWxlICgocm91dGUgPSByb3V0ZXMucG9wKCkpICE9IG51bGwpIHsKICAgICAgICB0aGlzLnJvdXRlKHJvdXRlLCB0aGlzLnJvdXRlc1tyb3V0ZV0pOwogICAgICB9CiAgICB9LAoKICAgIC8vIENvbnZlcnQgYSByb3V0ZSBzdHJpbmcgaW50byBhIHJlZ3VsYXIgZXhwcmVzc2lvbiwgc3VpdGFibGUgZm9yIG1hdGNoaW5nCiAgICAvLyBhZ2FpbnN0IHRoZSBjdXJyZW50IGxvY2F0aW9uIGhhc2guCiAgICBfcm91dGVUb1JlZ0V4cDogZnVuY3Rpb24ocm91dGUpIHsKICAgICAgcm91dGUgPSByb3V0ZS5yZXBsYWNlKGVzY2FwZVJlZ0V4cCwgJ1xcJCYnKQogICAgICAgICAgICAgICAgICAgLnJlcGxhY2Uob3B0aW9uYWxQYXJhbSwgJyg/OiQxKT8nKQogICAgICAgICAgICAgICAgICAgLnJlcGxhY2UobmFtZWRQYXJhbSwgZnVuY3Rpb24obWF0Y2gsIG9wdGlvbmFsKSB7CiAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvcHRpb25hbCA/IG1hdGNoIDogJyhbXi8/XSspJzsKICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAucmVwbGFjZShzcGxhdFBhcmFtLCAnKFteP10qPyknKTsKICAgICAgcmV0dXJuIG5ldyBSZWdFeHAoJ14nICsgcm91dGUgKyAnKD86XFw/KFtcXHNcXFNdKikpPyQnKTsKICAgIH0sCgogICAgLy8gR2l2ZW4gYSByb3V0ZSwgYW5kIGEgVVJMIGZyYWdtZW50IHRoYXQgaXQgbWF0Y2hlcywgcmV0dXJuIHRoZSBhcnJheSBvZgogICAgLy8gZXh0cmFjdGVkIGRlY29kZWQgcGFyYW1ldGVycy4gRW1wdHkgb3IgdW5tYXRjaGVkIHBhcmFtZXRlcnMgd2lsbCBiZQogICAgLy8gdHJlYXRlZCBhcyBgbnVsbGAgdG8gbm9ybWFsaXplIGNyb3NzLWJyb3dzZXIgYmVoYXZpb3IuCiAgICBfZXh0cmFjdFBhcmFtZXRlcnM6IGZ1bmN0aW9uKHJvdXRlLCBmcmFnbWVudCkgewogICAgICB2YXIgcGFyYW1zID0gcm91dGUuZXhlYyhmcmFnbWVudCkuc2xpY2UoMSk7CiAgICAgIHJldHVybiBfLm1hcChwYXJhbXMsIGZ1bmN0aW9uKHBhcmFtLCBpKSB7CiAgICAgICAgLy8gRG9uJ3QgZGVjb2RlIHRoZSBzZWFyY2ggcGFyYW1zLgogICAgICAgIGlmIChpID09PSBwYXJhbXMubGVuZ3RoIC0gMSkgcmV0dXJuIHBhcmFtIHx8IG51bGw7CiAgICAgICAgcmV0dXJuIHBhcmFtID8gZGVjb2RlVVJJQ29tcG9uZW50KHBhcmFtKSA6IG51bGw7CiAgICAgIH0pOwogICAgfQoKICB9KTsKCiAgLy8gQmFja2JvbmUuSGlzdG9yeQogIC8vIC0tLS0tLS0tLS0tLS0tLS0KCiAgLy8gSGFuZGxlcyBjcm9zcy1icm93c2VyIGhpc3RvcnkgbWFuYWdlbWVudCwgYmFzZWQgb24gZWl0aGVyCiAgLy8gW3B1c2hTdGF0ZV0oaHR0cDovL2RpdmVpbnRvaHRtbDUuaW5mby9oaXN0b3J5Lmh0bWwpIGFuZCByZWFsIFVSTHMsIG9yCiAgLy8gW29uaGFzaGNoYW5nZV0oaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9ET00vd2luZG93Lm9uaGFzaGNoYW5nZSkKICAvLyBhbmQgVVJMIGZyYWdtZW50cy4gSWYgdGhlIGJyb3dzZXIgc3VwcG9ydHMgbmVpdGhlciAob2xkIElFLCBuYXRjaCksCiAgLy8gZmFsbHMgYmFjayB0byBwb2xsaW5nLgogIHZhciBIaXN0b3J5ID0gQmFja2JvbmUuSGlzdG9yeSA9IGZ1bmN0aW9uKCkgewogICAgdGhpcy5oYW5kbGVycyA9IFtdOwogICAgXy5iaW5kQWxsKHRoaXMsICdjaGVja1VybCcpOwoKICAgIC8vIEVuc3VyZSB0aGF0IGBIaXN0b3J5YCBjYW4gYmUgdXNlZCBvdXRzaWRlIG9mIHRoZSBicm93c2VyLgogICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgIHRoaXMubG9jYXRpb24gPSB3aW5kb3cubG9jYXRpb247CiAgICAgIHRoaXMuaGlzdG9yeSA9IHdpbmRvdy5oaXN0b3J5OwogICAgfQogIH07CgogIC8vIENhY2hlZCByZWdleCBmb3Igc3RyaXBwaW5nIGEgbGVhZGluZyBoYXNoL3NsYXNoIGFuZCB0cmFpbGluZyBzcGFjZS4KICB2YXIgcm91dGVTdHJpcHBlciA9IC9eWyNcL118XHMrJC9nOwoKICAvLyBDYWNoZWQgcmVnZXggZm9yIHN0cmlwcGluZyBsZWFkaW5nIGFuZCB0cmFpbGluZyBzbGFzaGVzLgogIHZhciByb290U3RyaXBwZXIgPSAvXlwvK3xcLyskL2c7CgogIC8vIENhY2hlZCByZWdleCBmb3IgZGV0ZWN0aW5nIE1TSUUuCiAgdmFyIGlzRXhwbG9yZXIgPSAvbXNpZSBbXHcuXSsvOwoKICAvLyBDYWNoZWQgcmVnZXggZm9yIHJlbW92aW5nIGEgdHJhaWxpbmcgc2xhc2guCiAgdmFyIHRyYWlsaW5nU2xhc2ggPSAvXC8kLzsKCiAgLy8gQ2FjaGVkIHJlZ2V4IGZvciBzdHJpcHBpbmcgdXJscyBvZiBoYXNoLgogIHZhciBwYXRoU3RyaXBwZXIgPSAvIy4qJC87CgogIC8vIEhhcyB0aGUgaGlzdG9yeSBoYW5kbGluZyBhbHJlYWR5IGJlZW4gc3RhcnRlZD8KICBIaXN0b3J5LnN0YXJ0ZWQgPSBmYWxzZTsKCiAgLy8gU2V0IHVwIGFsbCBpbmhlcml0YWJsZSAqKkJhY2tib25lLkhpc3RvcnkqKiBwcm9wZXJ0aWVzIGFuZCBtZXRob2RzLgogIF8uZXh0ZW5kKEhpc3RvcnkucHJvdG90eXBlLCBFdmVudHMsIHsKCiAgICAvLyBUaGUgZGVmYXVsdCBpbnRlcnZhbCB0byBwb2xsIGZvciBoYXNoIGNoYW5nZXMsIGlmIG5lY2Vzc2FyeSwgaXMKICAgIC8vIHR3ZW50eSB0aW1lcyBhIHNlY29uZC4KICAgIGludGVydmFsOiA1MCwKCiAgICAvLyBBcmUgd2UgYXQgdGhlIGFwcCByb290PwogICAgYXRSb290OiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIHRoaXMubG9jYXRpb24ucGF0aG5hbWUucmVwbGFjZSgvW15cL10kLywgJyQmLycpID09PSB0aGlzLnJvb3Q7CiAgICB9LAoKICAgIC8vIEdldHMgdGhlIHRydWUgaGFzaCB2YWx1ZS4gQ2Fubm90IHVzZSBsb2NhdGlvbi5oYXNoIGRpcmVjdGx5IGR1ZSB0byBidWcKICAgIC8vIGluIEZpcmVmb3ggd2hlcmUgbG9jYXRpb24uaGFzaCB3aWxsIGFsd2F5cyBiZSBkZWNvZGVkLgogICAgZ2V0SGFzaDogZnVuY3Rpb24od2luZG93KSB7CiAgICAgIHZhciBtYXRjaCA9ICh3aW5kb3cgfHwgdGhpcykubG9jYXRpb24uaHJlZi5tYXRjaCgvIyguKikkLyk7CiAgICAgIHJldHVybiBtYXRjaCA/IG1hdGNoWzFdIDogJyc7CiAgICB9LAoKICAgIC8vIEdldCB0aGUgY3Jvc3MtYnJvd3NlciBub3JtYWxpemVkIFVSTCBmcmFnbWVudCwgZWl0aGVyIGZyb20gdGhlIFVSTCwKICAgIC8vIHRoZSBoYXNoLCBvciB0aGUgb3ZlcnJpZGUuCiAgICBnZXRGcmFnbWVudDogZnVuY3Rpb24oZnJhZ21lbnQsIGZvcmNlUHVzaFN0YXRlKSB7CiAgICAgIGlmIChmcmFnbWVudCA9PSBudWxsKSB7CiAgICAgICAgaWYgKHRoaXMuX2hhc1B1c2hTdGF0ZSB8fCAhdGhpcy5fd2FudHNIYXNoQ2hhbmdlIHx8IGZvcmNlUHVzaFN0YXRlKSB7CiAgICAgICAgICBmcmFnbWVudCA9IGRlY29kZVVSSSh0aGlzLmxvY2F0aW9uLnBhdGhuYW1lICsgdGhpcy5sb2NhdGlvbi5zZWFyY2gpOwogICAgICAgICAgdmFyIHJvb3QgPSB0aGlzLnJvb3QucmVwbGFjZSh0cmFpbGluZ1NsYXNoLCAnJyk7CiAgICAgICAgICBpZiAoIWZyYWdtZW50LmluZGV4T2Yocm9vdCkpIGZyYWdtZW50ID0gZnJhZ21lbnQuc2xpY2Uocm9vdC5sZW5ndGgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBmcmFnbWVudCA9IHRoaXMuZ2V0SGFzaCgpOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gZnJhZ21lbnQucmVwbGFjZShyb3V0ZVN0cmlwcGVyLCAnJyk7CiAgICB9LAoKICAgIC8vIFN0YXJ0IHRoZSBoYXNoIGNoYW5nZSBoYW5kbGluZywgcmV0dXJuaW5nIGB0cnVlYCBpZiB0aGUgY3VycmVudCBVUkwgbWF0Y2hlcwogICAgLy8gYW4gZXhpc3Rpbmcgcm91dGUsIGFuZCBgZmFsc2VgIG90aGVyd2lzZS4KICAgIHN0YXJ0OiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgIGlmIChIaXN0b3J5LnN0YXJ0ZWQpIHRocm93IG5ldyBFcnJvcigiQmFja2JvbmUuaGlzdG9yeSBoYXMgYWxyZWFkeSBiZWVuIHN0YXJ0ZWQiKTsKICAgICAgSGlzdG9yeS5zdGFydGVkID0gdHJ1ZTsKCiAgICAgIC8vIEZpZ3VyZSBvdXQgdGhlIGluaXRpYWwgY29uZmlndXJhdGlvbi4gRG8gd2UgbmVlZCBhbiBpZnJhbWU/CiAgICAgIC8vIElzIHB1c2hTdGF0ZSBkZXNpcmVkIC4uLiBpcyBpdCBhdmFpbGFibGU/CiAgICAgIHRoaXMub3B0aW9ucyAgICAgICAgICA9IF8uZXh0ZW5kKHtyb290OiAnLyd9LCB0aGlzLm9wdGlvbnMsIG9wdGlvbnMpOwogICAgICB0aGlzLnJvb3QgICAgICAgICAgICAgPSB0aGlzLm9wdGlvbnMucm9vdDsKICAgICAgdGhpcy5fd2FudHNIYXNoQ2hhbmdlID0gdGhpcy5vcHRpb25zLmhhc2hDaGFuZ2UgIT09IGZhbHNlOwogICAgICB0aGlzLl93YW50c1B1c2hTdGF0ZSAgPSAhIXRoaXMub3B0aW9ucy5wdXNoU3RhdGU7CiAgICAgIHRoaXMuX2hhc1B1c2hTdGF0ZSAgICA9ICEhKHRoaXMub3B0aW9ucy5wdXNoU3RhdGUgJiYgdGhpcy5oaXN0b3J5ICYmIHRoaXMuaGlzdG9yeS5wdXNoU3RhdGUpOwogICAgICB2YXIgZnJhZ21lbnQgICAgICAgICAgPSB0aGlzLmdldEZyYWdtZW50KCk7CiAgICAgIHZhciBkb2NNb2RlICAgICAgICAgICA9IGRvY3VtZW50LmRvY3VtZW50TW9kZTsKICAgICAgdmFyIG9sZElFICAgICAgICAgICAgID0gKGlzRXhwbG9yZXIuZXhlYyhuYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCkpICYmICghZG9jTW9kZSB8fCBkb2NNb2RlIDw9IDcpKTsKCiAgICAgIC8vIE5vcm1hbGl6ZSByb290IHRvIGFsd2F5cyBpbmNsdWRlIGEgbGVhZGluZyBhbmQgdHJhaWxpbmcgc2xhc2guCiAgICAgIHRoaXMucm9vdCA9ICgnLycgKyB0aGlzLnJvb3QgKyAnLycpLnJlcGxhY2Uocm9vdFN0cmlwcGVyLCAnLycpOwoKICAgICAgaWYgKG9sZElFICYmIHRoaXMuX3dhbnRzSGFzaENoYW5nZSkgewogICAgICAgIHZhciBmcmFtZSA9IEJhY2tib25lLiQoJzxpZnJhbWUgc3JjPSJqYXZhc2NyaXB0OjAiIHRhYmluZGV4PSItMSI+Jyk7CiAgICAgICAgdGhpcy5pZnJhbWUgPSBmcmFtZS5oaWRlKCkuYXBwZW5kVG8oJ2JvZHknKVswXS5jb250ZW50V2luZG93OwogICAgICAgIHRoaXMubmF2aWdhdGUoZnJhZ21lbnQpOwogICAgICB9CgogICAgICAvLyBEZXBlbmRpbmcgb24gd2hldGhlciB3ZSdyZSB1c2luZyBwdXNoU3RhdGUgb3IgaGFzaGVzLCBhbmQgd2hldGhlcgogICAgICAvLyAnb25oYXNoY2hhbmdlJyBpcyBzdXBwb3J0ZWQsIGRldGVybWluZSBob3cgd2UgY2hlY2sgdGhlIFVSTCBzdGF0ZS4KICAgICAgaWYgKHRoaXMuX2hhc1B1c2hTdGF0ZSkgewogICAgICAgIEJhY2tib25lLiQod2luZG93KS5vbigncG9wc3RhdGUnLCB0aGlzLmNoZWNrVXJsKTsKICAgICAgfSBlbHNlIGlmICh0aGlzLl93YW50c0hhc2hDaGFuZ2UgJiYgKCdvbmhhc2hjaGFuZ2UnIGluIHdpbmRvdykgJiYgIW9sZElFKSB7CiAgICAgICAgQmFja2JvbmUuJCh3aW5kb3cpLm9uKCdoYXNoY2hhbmdlJywgdGhpcy5jaGVja1VybCk7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5fd2FudHNIYXNoQ2hhbmdlKSB7CiAgICAgICAgdGhpcy5fY2hlY2tVcmxJbnRlcnZhbCA9IHNldEludGVydmFsKHRoaXMuY2hlY2tVcmwsIHRoaXMuaW50ZXJ2YWwpOwogICAgICB9CgogICAgICAvLyBEZXRlcm1pbmUgaWYgd2UgbmVlZCB0byBjaGFuZ2UgdGhlIGJhc2UgdXJsLCBmb3IgYSBwdXNoU3RhdGUgbGluawogICAgICAvLyBvcGVuZWQgYnkgYSBub24tcHVzaFN0YXRlIGJyb3dzZXIuCiAgICAgIHRoaXMuZnJhZ21lbnQgPSBmcmFnbWVudDsKICAgICAgdmFyIGxvYyA9IHRoaXMubG9jYXRpb247CgogICAgICAvLyBUcmFuc2l0aW9uIGZyb20gaGFzaENoYW5nZSB0byBwdXNoU3RhdGUgb3IgdmljZSB2ZXJzYSBpZiBib3RoIGFyZQogICAgICAvLyByZXF1ZXN0ZWQuCiAgICAgIGlmICh0aGlzLl93YW50c0hhc2hDaGFuZ2UgJiYgdGhpcy5fd2FudHNQdXNoU3RhdGUpIHsKCiAgICAgICAgLy8gSWYgd2UndmUgc3RhcnRlZCBvZmYgd2l0aCBhIHJvdXRlIGZyb20gYSBgcHVzaFN0YXRlYC1lbmFibGVkCiAgICAgICAgLy8gYnJvd3NlciwgYnV0IHdlJ3JlIGN1cnJlbnRseSBpbiBhIGJyb3dzZXIgdGhhdCBkb2Vzbid0IHN1cHBvcnQgaXQuLi4KICAgICAgICBpZiAoIXRoaXMuX2hhc1B1c2hTdGF0ZSAmJiAhdGhpcy5hdFJvb3QoKSkgewogICAgICAgICAgdGhpcy5mcmFnbWVudCA9IHRoaXMuZ2V0RnJhZ21lbnQobnVsbCwgdHJ1ZSk7CiAgICAgICAgICB0aGlzLmxvY2F0aW9uLnJlcGxhY2UodGhpcy5yb290ICsgJyMnICsgdGhpcy5mcmFnbWVudCk7CiAgICAgICAgICAvLyBSZXR1cm4gaW1tZWRpYXRlbHkgYXMgYnJvd3NlciB3aWxsIGRvIHJlZGlyZWN0IHRvIG5ldyB1cmwKICAgICAgICAgIHJldHVybiB0cnVlOwoKICAgICAgICAvLyBPciBpZiB3ZSd2ZSBzdGFydGVkIG91dCB3aXRoIGEgaGFzaC1iYXNlZCByb3V0ZSwgYnV0IHdlJ3JlIGN1cnJlbnRseQogICAgICAgIC8vIGluIGEgYnJvd3NlciB3aGVyZSBpdCBjb3VsZCBiZSBgcHVzaFN0YXRlYC1iYXNlZCBpbnN0ZWFkLi4uCiAgICAgICAgfSBlbHNlIGlmICh0aGlzLl9oYXNQdXNoU3RhdGUgJiYgdGhpcy5hdFJvb3QoKSAmJiBsb2MuaGFzaCkgewogICAgICAgICAgdGhpcy5mcmFnbWVudCA9IHRoaXMuZ2V0SGFzaCgpLnJlcGxhY2Uocm91dGVTdHJpcHBlciwgJycpOwogICAgICAgICAgdGhpcy5oaXN0b3J5LnJlcGxhY2VTdGF0ZSh7fSwgZG9jdW1lbnQudGl0bGUsIHRoaXMucm9vdCArIHRoaXMuZnJhZ21lbnQpOwogICAgICAgIH0KCiAgICAgIH0KCiAgICAgIGlmICghdGhpcy5vcHRpb25zLnNpbGVudCkgcmV0dXJuIHRoaXMubG9hZFVybCgpOwogICAgfSwKCiAgICAvLyBEaXNhYmxlIEJhY2tib25lLmhpc3RvcnksIHBlcmhhcHMgdGVtcG9yYXJpbHkuIE5vdCB1c2VmdWwgaW4gYSByZWFsIGFwcCwKICAgIC8vIGJ1dCBwb3NzaWJseSB1c2VmdWwgZm9yIHVuaXQgdGVzdGluZyBSb3V0ZXJzLgogICAgc3RvcDogZnVuY3Rpb24oKSB7CiAgICAgIEJhY2tib25lLiQod2luZG93KS5vZmYoJ3BvcHN0YXRlJywgdGhpcy5jaGVja1VybCkub2ZmKCdoYXNoY2hhbmdlJywgdGhpcy5jaGVja1VybCk7CiAgICAgIGlmICh0aGlzLl9jaGVja1VybEludGVydmFsKSBjbGVhckludGVydmFsKHRoaXMuX2NoZWNrVXJsSW50ZXJ2YWwpOwogICAgICBIaXN0b3J5LnN0YXJ0ZWQgPSBmYWxzZTsKICAgIH0sCgogICAgLy8gQWRkIGEgcm91dGUgdG8gYmUgdGVzdGVkIHdoZW4gdGhlIGZyYWdtZW50IGNoYW5nZXMuIFJvdXRlcyBhZGRlZCBsYXRlcgogICAgLy8gbWF5IG92ZXJyaWRlIHByZXZpb3VzIHJvdXRlcy4KICAgIHJvdXRlOiBmdW5jdGlvbihyb3V0ZSwgY2FsbGJhY2spIHsKICAgICAgdGhpcy5oYW5kbGVycy51bnNoaWZ0KHtyb3V0ZTogcm91dGUsIGNhbGxiYWNrOiBjYWxsYmFja30pOwogICAgfSwKCiAgICAvLyBDaGVja3MgdGhlIGN1cnJlbnQgVVJMIHRvIHNlZSBpZiBpdCBoYXMgY2hhbmdlZCwgYW5kIGlmIGl0IGhhcywKICAgIC8vIGNhbGxzIGBsb2FkVXJsYCwgbm9ybWFsaXppbmcgYWNyb3NzIHRoZSBoaWRkZW4gaWZyYW1lLgogICAgY2hlY2tVcmw6IGZ1bmN0aW9uKGUpIHsKICAgICAgdmFyIGN1cnJlbnQgPSB0aGlzLmdldEZyYWdtZW50KCk7CiAgICAgIGlmIChjdXJyZW50ID09PSB0aGlzLmZyYWdtZW50ICYmIHRoaXMuaWZyYW1lKSB7CiAgICAgICAgY3VycmVudCA9IHRoaXMuZ2V0RnJhZ21lbnQodGhpcy5nZXRIYXNoKHRoaXMuaWZyYW1lKSk7CiAgICAgIH0KICAgICAgaWYgKGN1cnJlbnQgPT09IHRoaXMuZnJhZ21lbnQpIHJldHVybiBmYWxzZTsKICAgICAgaWYgKHRoaXMuaWZyYW1lKSB0aGlzLm5hdmlnYXRlKGN1cnJlbnQpOwogICAgICB0aGlzLmxvYWRVcmwoKTsKICAgIH0sCgogICAgLy8gQXR0ZW1wdCB0byBsb2FkIHRoZSBjdXJyZW50IFVSTCBmcmFnbWVudC4gSWYgYSByb3V0ZSBzdWNjZWVkcyB3aXRoIGEKICAgIC8vIG1hdGNoLCByZXR1cm5zIGB0cnVlYC4gSWYgbm8gZGVmaW5lZCByb3V0ZXMgbWF0Y2hlcyB0aGUgZnJhZ21lbnQsCiAgICAvLyByZXR1cm5zIGBmYWxzZWAuCiAgICBsb2FkVXJsOiBmdW5jdGlvbihmcmFnbWVudCkgewogICAgICBmcmFnbWVudCA9IHRoaXMuZnJhZ21lbnQgPSB0aGlzLmdldEZyYWdtZW50KGZyYWdtZW50KTsKICAgICAgcmV0dXJuIF8uYW55KHRoaXMuaGFuZGxlcnMsIGZ1bmN0aW9uKGhhbmRsZXIpIHsKICAgICAgICBpZiAoaGFuZGxlci5yb3V0ZS50ZXN0KGZyYWdtZW50KSkgewogICAgICAgICAgaGFuZGxlci5jYWxsYmFjayhmcmFnbWVudCk7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKCiAgICAvLyBTYXZlIGEgZnJhZ21lbnQgaW50byB0aGUgaGFzaCBoaXN0b3J5LCBvciByZXBsYWNlIHRoZSBVUkwgc3RhdGUgaWYgdGhlCiAgICAvLyAncmVwbGFjZScgb3B0aW9uIGlzIHBhc3NlZC4gWW91IGFyZSByZXNwb25zaWJsZSBmb3IgcHJvcGVybHkgVVJMLWVuY29kaW5nCiAgICAvLyB0aGUgZnJhZ21lbnQgaW4gYWR2YW5jZS4KICAgIC8vCiAgICAvLyBUaGUgb3B0aW9ucyBvYmplY3QgY2FuIGNvbnRhaW4gYHRyaWdnZXI6IHRydWVgIGlmIHlvdSB3aXNoIHRvIGhhdmUgdGhlCiAgICAvLyByb3V0ZSBjYWxsYmFjayBiZSBmaXJlZCAobm90IHVzdWFsbHkgZGVzaXJhYmxlKSwgb3IgYHJlcGxhY2U6IHRydWVgLCBpZgogICAgLy8geW91IHdpc2ggdG8gbW9kaWZ5IHRoZSBjdXJyZW50IFVSTCB3aXRob3V0IGFkZGluZyBhbiBlbnRyeSB0byB0aGUgaGlzdG9yeS4KICAgIG5hdmlnYXRlOiBmdW5jdGlvbihmcmFnbWVudCwgb3B0aW9ucykgewogICAgICBpZiAoIUhpc3Rvcnkuc3RhcnRlZCkgcmV0dXJuIGZhbHNlOwogICAgICBpZiAoIW9wdGlvbnMgfHwgb3B0aW9ucyA9PT0gdHJ1ZSkgb3B0aW9ucyA9IHt0cmlnZ2VyOiAhIW9wdGlvbnN9OwoKICAgICAgdmFyIHVybCA9IHRoaXMucm9vdCArIChmcmFnbWVudCA9IHRoaXMuZ2V0RnJhZ21lbnQoZnJhZ21lbnQgfHwgJycpKTsKCiAgICAgIC8vIFN0cmlwIHRoZSBoYXNoIGZvciBtYXRjaGluZy4KICAgICAgZnJhZ21lbnQgPSBmcmFnbWVudC5yZXBsYWNlKHBhdGhTdHJpcHBlciwgJycpOwoKICAgICAgaWYgKHRoaXMuZnJhZ21lbnQgPT09IGZyYWdtZW50KSByZXR1cm47CiAgICAgIHRoaXMuZnJhZ21lbnQgPSBmcmFnbWVudDsKCiAgICAgIC8vIERvbid0IGluY2x1ZGUgYSB0cmFpbGluZyBzbGFzaCBvbiB0aGUgcm9vdC4KICAgICAgaWYgKGZyYWdtZW50ID09PSAnJyAmJiB1cmwgIT09ICcvJykgdXJsID0gdXJsLnNsaWNlKDAsIC0xKTsKCiAgICAgIC8vIElmIHB1c2hTdGF0ZSBpcyBhdmFpbGFibGUsIHdlIHVzZSBpdCB0byBzZXQgdGhlIGZyYWdtZW50IGFzIGEgcmVhbCBVUkwuCiAgICAgIGlmICh0aGlzLl9oYXNQdXNoU3RhdGUpIHsKICAgICAgICB0aGlzLmhpc3Rvcnlbb3B0aW9ucy5yZXBsYWNlID8gJ3JlcGxhY2VTdGF0ZScgOiAncHVzaFN0YXRlJ10oe30sIGRvY3VtZW50LnRpdGxlLCB1cmwpOwoKICAgICAgLy8gSWYgaGFzaCBjaGFuZ2VzIGhhdmVuJ3QgYmVlbiBleHBsaWNpdGx5IGRpc2FibGVkLCB1cGRhdGUgdGhlIGhhc2gKICAgICAgLy8gZnJhZ21lbnQgdG8gc3RvcmUgaGlzdG9yeS4KICAgICAgfSBlbHNlIGlmICh0aGlzLl93YW50c0hhc2hDaGFuZ2UpIHsKICAgICAgICB0aGlzLl91cGRhdGVIYXNoKHRoaXMubG9jYXRpb24sIGZyYWdtZW50LCBvcHRpb25zLnJlcGxhY2UpOwogICAgICAgIGlmICh0aGlzLmlmcmFtZSAmJiAoZnJhZ21lbnQgIT09IHRoaXMuZ2V0RnJhZ21lbnQodGhpcy5nZXRIYXNoKHRoaXMuaWZyYW1lKSkpKSB7CiAgICAgICAgICAvLyBPcGVuaW5nIGFuZCBjbG9zaW5nIHRoZSBpZnJhbWUgdHJpY2tzIElFNyBhbmQgZWFybGllciB0byBwdXNoIGEKICAgICAgICAgIC8vIGhpc3RvcnkgZW50cnkgb24gaGFzaC10YWcgY2hhbmdlLiAgV2hlbiByZXBsYWNlIGlzIHRydWUsIHdlIGRvbid0CiAgICAgICAgICAvLyB3YW50IHRoaXMuCiAgICAgICAgICBpZighb3B0aW9ucy5yZXBsYWNlKSB0aGlzLmlmcmFtZS5kb2N1bWVudC5vcGVuKCkuY2xvc2UoKTsKICAgICAgICAgIHRoaXMuX3VwZGF0ZUhhc2godGhpcy5pZnJhbWUubG9jYXRpb24sIGZyYWdtZW50LCBvcHRpb25zLnJlcGxhY2UpOwogICAgICAgIH0KCiAgICAgIC8vIElmIHlvdSd2ZSB0b2xkIHVzIHRoYXQgeW91IGV4cGxpY2l0bHkgZG9uJ3Qgd2FudCBmYWxsYmFjayBoYXNoY2hhbmdlLQogICAgICAvLyBiYXNlZCBoaXN0b3J5LCB0aGVuIGBuYXZpZ2F0ZWAgYmVjb21lcyBhIHBhZ2UgcmVmcmVzaC4KICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gdGhpcy5sb2NhdGlvbi5hc3NpZ24odXJsKTsKICAgICAgfQogICAgICBpZiAob3B0aW9ucy50cmlnZ2VyKSByZXR1cm4gdGhpcy5sb2FkVXJsKGZyYWdtZW50KTsKICAgIH0sCgogICAgLy8gVXBkYXRlIHRoZSBoYXNoIGxvY2F0aW9uLCBlaXRoZXIgcmVwbGFjaW5nIHRoZSBjdXJyZW50IGVudHJ5LCBvciBhZGRpbmcKICAgIC8vIGEgbmV3IG9uZSB0byB0aGUgYnJvd3NlciBoaXN0b3J5LgogICAgX3VwZGF0ZUhhc2g6IGZ1bmN0aW9uKGxvY2F0aW9uLCBmcmFnbWVudCwgcmVwbGFjZSkgewogICAgICBpZiAocmVwbGFjZSkgewogICAgICAgIHZhciBocmVmID0gbG9jYXRpb24uaHJlZi5yZXBsYWNlKC8oamF2YXNjcmlwdDp8IykuKiQvLCAnJyk7CiAgICAgICAgbG9jYXRpb24ucmVwbGFjZShocmVmICsgJyMnICsgZnJhZ21lbnQpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFNvbWUgYnJvd3NlcnMgcmVxdWlyZSB0aGF0IGBoYXNoYCBjb250YWlucyBhIGxlYWRpbmcgIy4KICAgICAgICBsb2NhdGlvbi5oYXNoID0gJyMnICsgZnJhZ21lbnQ7CiAgICAgIH0KICAgIH0KCiAgfSk7CgogIC8vIENyZWF0ZSB0aGUgZGVmYXVsdCBCYWNrYm9uZS5oaXN0b3J5LgogIEJhY2tib25lLmhpc3RvcnkgPSBuZXcgSGlzdG9yeTsKCiAgLy8gSGVscGVycwogIC8vIC0tLS0tLS0KCiAgLy8gSGVscGVyIGZ1bmN0aW9uIHRvIGNvcnJlY3RseSBzZXQgdXAgdGhlIHByb3RvdHlwZSBjaGFpbiwgZm9yIHN1YmNsYXNzZXMuCiAgLy8gU2ltaWxhciB0byBgZ29vZy5pbmhlcml0c2AsIGJ1dCB1c2VzIGEgaGFzaCBvZiBwcm90b3R5cGUgcHJvcGVydGllcyBhbmQKICAvLyBjbGFzcyBwcm9wZXJ0aWVzIHRvIGJlIGV4dGVuZGVkLgogIHZhciBleHRlbmQgPSBmdW5jdGlvbihwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgewogICAgdmFyIHBhcmVudCA9IHRoaXM7CiAgICB2YXIgY2hpbGQ7CgogICAgLy8gVGhlIGNvbnN0cnVjdG9yIGZ1bmN0aW9uIGZvciB0aGUgbmV3IHN1YmNsYXNzIGlzIGVpdGhlciBkZWZpbmVkIGJ5IHlvdQogICAgLy8gKHRoZSAiY29uc3RydWN0b3IiIHByb3BlcnR5IGluIHlvdXIgYGV4dGVuZGAgZGVmaW5pdGlvbiksIG9yIGRlZmF1bHRlZAogICAgLy8gYnkgdXMgdG8gc2ltcGx5IGNhbGwgdGhlIHBhcmVudCdzIGNvbnN0cnVjdG9yLgogICAgaWYgKHByb3RvUHJvcHMgJiYgXy5oYXMocHJvdG9Qcm9wcywgJ2NvbnN0cnVjdG9yJykpIHsKICAgICAgY2hpbGQgPSBwcm90b1Byb3BzLmNvbnN0cnVjdG9yOwogICAgfSBlbHNlIHsKICAgICAgY2hpbGQgPSBmdW5jdGlvbigpeyByZXR1cm4gcGFyZW50LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IH07CiAgICB9CgogICAgLy8gQWRkIHN0YXRpYyBwcm9wZXJ0aWVzIHRvIHRoZSBjb25zdHJ1Y3RvciBmdW5jdGlvbiwgaWYgc3VwcGxpZWQuCiAgICBfLmV4dGVuZChjaGlsZCwgcGFyZW50LCBzdGF0aWNQcm9wcyk7CgogICAgLy8gU2V0IHRoZSBwcm90b3R5cGUgY2hhaW4gdG8gaW5oZXJpdCBmcm9tIGBwYXJlbnRgLCB3aXRob3V0IGNhbGxpbmcKICAgIC8vIGBwYXJlbnRgJ3MgY29uc3RydWN0b3IgZnVuY3Rpb24uCiAgICB2YXIgU3Vycm9nYXRlID0gZnVuY3Rpb24oKXsgdGhpcy5jb25zdHJ1Y3RvciA9IGNoaWxkOyB9OwogICAgU3Vycm9nYXRlLnByb3RvdHlwZSA9IHBhcmVudC5wcm90b3R5cGU7CiAgICBjaGlsZC5wcm90b3R5cGUgPSBuZXcgU3Vycm9nYXRlOwoKICAgIC8vIEFkZCBwcm90b3R5cGUgcHJvcGVydGllcyAoaW5zdGFuY2UgcHJvcGVydGllcykgdG8gdGhlIHN1YmNsYXNzLAogICAgLy8gaWYgc3VwcGxpZWQuCiAgICBpZiAocHJvdG9Qcm9wcykgXy5leHRlbmQoY2hpbGQucHJvdG90eXBlLCBwcm90b1Byb3BzKTsKCiAgICAvLyBTZXQgYSBjb252ZW5pZW5jZSBwcm9wZXJ0eSBpbiBjYXNlIHRoZSBwYXJlbnQncyBwcm90b3R5cGUgaXMgbmVlZGVkCiAgICAvLyBsYXRlci4KICAgIGNoaWxkLl9fc3VwZXJfXyA9IHBhcmVudC5wcm90b3R5cGU7CgogICAgcmV0dXJuIGNoaWxkOwogIH07CgogIC8vIFNldCB1cCBpbmhlcml0YW5jZSBmb3IgdGhlIG1vZGVsLCBjb2xsZWN0aW9uLCByb3V0ZXIsIHZpZXcgYW5kIGhpc3RvcnkuCiAgTW9kZWwuZXh0ZW5kID0gQ29sbGVjdGlvbi5leHRlbmQgPSBSb3V0ZXIuZXh0ZW5kID0gVmlldy5leHRlbmQgPSBIaXN0b3J5LmV4dGVuZCA9IGV4dGVuZDsKCiAgLy8gVGhyb3cgYW4gZXJyb3Igd2hlbiBhIFVSTCBpcyBuZWVkZWQsIGFuZCBub25lIGlzIHN1cHBsaWVkLgogIHZhciB1cmxFcnJvciA9IGZ1bmN0aW9uKCkgewogICAgdGhyb3cgbmV3IEVycm9yKCdBICJ1cmwiIHByb3BlcnR5IG9yIGZ1bmN0aW9uIG11c3QgYmUgc3BlY2lmaWVkJyk7CiAgfTsKCiAgLy8gV3JhcCBhbiBvcHRpb25hbCBlcnJvciBjYWxsYmFjayB3aXRoIGEgZmFsbGJhY2sgZXJyb3IgZXZlbnQuCiAgdmFyIHdyYXBFcnJvciA9IGZ1bmN0aW9uKG1vZGVsLCBvcHRpb25zKSB7CiAgICB2YXIgZXJyb3IgPSBvcHRpb25zLmVycm9yOwogICAgb3B0aW9ucy5lcnJvciA9IGZ1bmN0aW9uKHJlc3ApIHsKICAgICAgaWYgKGVycm9yKSBlcnJvcihtb2RlbCwgcmVzcCwgb3B0aW9ucyk7CiAgICAgIG1vZGVsLnRyaWdnZXIoJ2Vycm9yJywgbW9kZWwsIHJlc3AsIG9wdGlvbnMpOwogICAgfTsKICB9OwoKICByZXR1cm4gQmFja2JvbmU7Cgp9KSk7CgovKgogKiBhbiBleHBlcmltZW50YWwgbXNtcyBzcGVjdHJ1bQogKi8KCmRlZmluZSgnZmlzaHRvbmVzL21vZGVscy93ZXQvRXhwTVNNU1NwZWN0cnVtJyxbJ2pxdWVyeScsICd1bmRlcnNjb3JlJywgJ0JhY2tib25lJywgJ0NvbmZpZyddLCBmdW5jdGlvbigkLCBfLCBCYWNrYm9uZSwgY29uZmlnKSB7CiAgICB2YXIgRXhwTVNNU1NwZWN0cnVtID0gQmFja2JvbmUuTW9kZWwuZXh0ZW5kKHsKICAgICAgICBkZWZhdWx0cyA6IHsKICAgICAgICB9LAogICAgICAgIHVybFJvb3QgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIGNvbmZpZy5nZXQoJ3dldC51cmwucmVzdCcpICsgJy9tc21zc3BlY3RydW0nCiAgICAgICAgfSwKICAgICAgICBpbml0aWFsaXplIDogZnVuY3Rpb24oKSB7CiAgICAgICAgfSwKICAgICAgICBzaXplIDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgcmV0dXJuIChzZWxmLmdldCgnbW96cycpID09IHVuZGVmaW5lZCkgPyAwIDogc2VsZi5nZXQoJ21venMnKS5sZW5ndGg7CiAgICAgICAgfSwKICAgICAgICBmZXRjaCA6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICBvcHRpb25zID0gJC5leHRlbmQoe30sIG9wdGlvbnMpOwogICAgICAgICAgICB2YXIgdXJsID0gc2VsZi51cmxSb290KCkgKyAnLycgKyBzZWxmLmlkOwogICAgICAgICAgICBpZiAob3B0aW9ucy5wYXJhbXMgJiYgb3B0aW9ucy5wYXJhbXMuZmllbGRzID09PSAncHJlY3Vyc29yT25seScpIHsKICAgICAgICAgICAgICAgIHVybCArPSAnP2ZpZWxkcz1wcmVjdXJzb3JPbmx5JzsKICAgICAgICAgICAgfQogICAgICAgICAgICAkLmdldEpTT04odXJsLCB7fSwgZnVuY3Rpb24obSkgewogICAgICAgICAgICAgICAgZm9yIChrIGluIG0pIHsKICAgICAgICAgICAgICAgICAgICBzZWxmLnNldChrLCBtW2tdKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuc3VjY2VzcykgewogICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuc3VjY2VzcyhzZWxmKQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgdmFyIG0gPSAnJzsKICAgICAgICAgICAgICAgIGZvciAoaSBpbiBlKSB7CiAgICAgICAgICAgICAgICAgICAgbSArPSBpICsgJzogJyArIGVbaV0gKyAnICAnCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aHJvdyB7CiAgICAgICAgICAgICAgICAgICAgbmFtZSA6ICdGZXRjaGluZ1hIUkV4Y2VwdGlvbicsCiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZSA6IG0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICB9LAogICAgICAgIG1venMgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0KCJtb3pzIik7CiAgICAgICAgfSwKICAgICAgICAvKioKICAgICAgICAgKiByZXR1cm4gYSBuZXcgRXhwZSBzdGVjdHJ1bSwgd2l0aCBhbGwgZnJhZ21lbnQgcGVha3Mgc2hpZnRlZCBieSBhIGdpdmVuIHZhbHVlCiAgICAgICAgICovCiAgICAgICAgc2hpZnRCeU1veiA6IGZ1bmN0aW9uKGRlbHRhKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIHNwID0gc2VsZi5jbG9uZSgpOwogICAgICAgICAgICBzcC5zZXQoJ21venMnLCBzZWxmLmdldCgnbW96cycpLm1hcChmdW5jdGlvbihtKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbSArIGRlbHRhCiAgICAgICAgICAgIH0pKQogICAgICAgICAgICByZXR1cm4gc3A7CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogYWRkIGFsbCBmcmFnbWVudCBmcm9tIHNwZWN0cnVtIHNwIHRvIHRoZSBjdXJyZW50IG9uZSBhbmQgY3JlYXRlIGEgbmV3IG9uZQogICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvdGhlcgogICAgICAgICAqLwogICAgICAgIGNvbmNhdEZyYWdtZW50cyA6IGZ1bmN0aW9uKG90aGVyKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIHNwID0gc2VsZi5jbG9uZSgpOwoKICAgICAgICAgICAgdmFyIGNvbmNhdFBlYWtzID0gXy56aXAoc2VsZi5nZXQoJ21venMnKS5jb25jYXQob3RoZXIuZ2V0KCdtb3pzJykpLCBzZWxmLmdldCgnaW50ZW5zaXRpZXMnKS5jb25jYXQob3RoZXIuZ2V0KCdpbnRlbnNpdGllcycpKSwgc2VsZi5nZXQoJ2ludGVuc2l0eVJhbmtzJykuY29uY2F0KG90aGVyLmdldCgnaW50ZW5zaXR5UmFua3MnKSkpLnNvcnQoZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgcmV0dXJuIGFbMF0gLSBiWzBdCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgc3Auc2V0KCdtb3pzJywgXy5wbHVjayhjb25jYXRQZWFrcywgMCkpCiAgICAgICAgICAgIHNwLnNldCgnaW50ZW5zaXRpZXMnLCBfLnBsdWNrKGNvbmNhdFBlYWtzLCAxKSkKICAgICAgICAgICAgc3Auc2V0KCdpbnRlbnNpdHlSYW5rcycsIF8ucGx1Y2soY29uY2F0UGVha3MsIDIpKQoKICAgICAgICAgICAgcmV0dXJuIHNwOwogICAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIEV4cE1TTVNTcGVjdHJ1bTsKfSk7CgovKgogKiBqdXN0IGEgY29sbGVjdGlvbiBvZiBFeHBNU01TU3BlY3RydW0gCiAqIAogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KCgpkZWZpbmUoJ2Zpc2h0b25lcy9jb2xsZWN0aW9ucy93ZXQvRXhwTVNNU1NwZWN0cnVtQ29sbGVjdGlvbicsWydCYWNrYm9uZScsICdmaXNodG9uZXMvbW9kZWxzL3dldC9FeHBNU01TU3BlY3RydW0nLCBdLCBmdW5jdGlvbihCYWNrYm9uZSwgRXhwTVNNU1NwZWN0cnVtKSB7CiAgICB2YXIgRXhwTVNNU1NwZWN0cnVtQ29sbGVjdGlvbiA9IEJhY2tib25lLkNvbGxlY3Rpb24uZXh0ZW5kKHsKICAgICAgICBtb2RlbCA6IEV4cE1TTVNTcGVjdHJ1bSwKICAgICAgICBkZWZhdWx0cyA6IHsKICAgICAgICB9LAogICAgICAgIGluaXRpYWxpemUgOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICB9CiAgICB9KTsKICAgIHJldHVybiBFeHBNU01TU3BlY3RydW1Db2xsZWN0aW9uOwp9KTsKCi8qCiAqIGFuIG1zbXNydW4gY2FuIGJlIG9uZSBvYmplY3QsIHdpdGhlIG1vcmUgb3IgbGVzcyBpbmZvcm1hdGlvbi4gdGhpcyBpbmZvcm1hdGlvbiBjYW4gYmUgcG9wdWxhdGVkIGF0IG9uY2Ugd2l0aCB0aGUgbXNtc3J1biBhcGkgb3IgZW5oYW5jZWQgYWZ0ZXJ3YXJkcyB0aHJvdWdoIHRoZSBtc21zc3BlY3RydW0gZ2V0dGVyczoKICogIC0ganVzdCBydW4gaW5mbyAoaWQgJiBuYW1lKQogKiAgLSBtc21zU3BlY3RyYSBkYXRhLCBidXQgb25seSBhdCB0aGUgcHJlY3Vyc29yIGxldmVsIChtc21zPXRydWUmbm9QZWFrcz10cnVlKQogKiAgLSBvbmx5IHRoZSBrIG1vc3QgaW50ZW5zZSBwZWFrcyAobXNtcz10cnVlJm1heFBlYWtzPWspCiAqIC0gIGFsbCBtc21zIGluZm8gKG1zbXM9dHJ1ZSkKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCgpkZWZpbmUoJ2Zpc2h0b25lcy9tb2RlbHMvd2V0L01TTVNSdW4nLFsnanF1ZXJ5JywgJ3VuZGVyc2NvcmUnLCAnQmFja2JvbmUnLCAnQ29uZmlnJywgJ2Zpc2h0b25lcy9jb2xsZWN0aW9ucy93ZXQvRXhwTVNNU1NwZWN0cnVtQ29sbGVjdGlvbiddLCBmdW5jdGlvbigkLCBfLCBCYWNrYm9uZSwgY29uZmlnLCBFeHBNU01TU3BlY3RydW1Db2xsZWN0aW9uKSB7CiAgICB2YXIgTVNNU1J1biA9IEJhY2tib25lLk1vZGVsLmV4dGVuZCh7CiAgICAgICAgZGVmYXVsdHMgOiB7CiAgICAgICAgfSwKICAgICAgICB1cmxSb290IDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiBjb25maWcuZ2V0KCd3ZXQudXJsLnJlc3QnKSArICcvbXNtc3J1bicKICAgICAgICB9LAogICAgICAgIGluaXRpYWxpemUgOiBmdW5jdGlvbigpIHsKICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqIGFwcGx5IHRoZSBjYWxsYmFjayBhcmd1bWVudCBvbiB0aGUgb2JqZWN0LCBidXQgb25seSBpZiBvciBvbmNlIHRoZSBtc21zIGluZm8gaGFzIGJlZW4gbG9hZGVkCiAgICAgICAgICovCiAgICAgICAgd2l0aE1zbXMgOiBmdW5jdGlvbihjYWxsYmFjaykgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIGlmIChzZWxmLmdldCgnbXNtcycpKSB7CiAgICAgICAgICAgICAgICBjYWxsYmFjayhzZWxmKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBzZWxmLnJlYWRNc21zSW5mbyh7CiAgICAgICAgICAgICAgICBzdWNjZXNzIDogY2FsbGJhY2sKICAgICAgICAgICAgfSkKICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqICBsb2FkIG1zbXMgaW5mb3JtYXRpb24sIGJ1dCBubyBwZWFrIGxpc3QKICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogICAgICAgICAqLwogICAgICAgIHJlYWRNc21zSW5mbyA6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzCiAgICAgICAgICAgIHZhciB1cmwgPSBzZWxmLnVybFJvb3QoKSArICcvJyArIHNlbGYuZ2V0KCdpZCcpICsgJz9tc21zPXRydWUmbm9QZWFrcz10cnVlJzsKCiAgICAgICAgICAgICQuZ2V0SlNPTih1cmwsIHt9LCBmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgICAgICAgICBzZWxmLnNldCgnbXNtcycsIG5ldyBFeHBNU01TU3BlY3RydW1Db2xsZWN0aW9uKGRhdGEubXNtc1NwZWN0cmEpKTsKICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLnN1Y2Nlc3MpIHsKICAgICAgICAgICAgICAgICAgICBvcHRpb25zLnN1Y2Nlc3Moc2VsZikKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgIH0sCiAgICAgICAgZ2V0TVNNU1N1YkNvbGxlY3Rpb24gOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgaWYgKG9wdGlvbnMuaWRzKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEV4cE1TTVNTcGVjdHJ1bUNvbGxlY3Rpb24oXy5jb2xsZWN0KG9wdGlvbnMuaWRzLCBmdW5jdGlvbihpZCkgewogICAgICAgICAgICAgICAgICAgIHNlbGYuZ2V0KCdtc21zJykuZ2V0KGlkKTsKICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAob3B0aW9ucy5zY2FuTnVtYmVycykgewogICAgICAgICAgICAgICAgdmFyIGtleXMgPSB7fQogICAgICAgICAgICAgICAgXy5lYWNoKG9wdGlvbnMuc2Nhbk51bWJlcnMsIGZ1bmN0aW9uKHNuKSB7CiAgICAgICAgICAgICAgICAgICAga2V5c1siIiArIHNuXSA9IHRydWU7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBFeHBNU01TU3BlY3RydW1Db2xsZWN0aW9uKHNlbGYuZ2V0KCdtc21zJykuZmlsdGVyKGZ1bmN0aW9uKHNwKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGtleXNbIiIgKyBzcC5nZXQoJ3NjYW5OdW1iZXInKV07CiAgICAgICAgICAgICAgICB9KSk7CgogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ211c3QgZ2V0TVNNU1N1YkNvbGxlY3Rpb24gb24gaWRzIG9yIHNuYU51bWJlcnMgbGlzdCBvZiB2YWxzJykKCiAgICAgICAgfSwKICAgICAgICAvKioKICAgICAgICAgKiBnZXQgdGhlIE1TTVNTdWJDb2xsZWN0aW9ucywgdGhlbiBwb3B1bGF0ZSBpdCB3aXRoIHRoZSBtc21zIHBlYWtsaXN0IGFuZCBjYWxsIGEgc3VjY2VzcyBjYWxsYmFjayBpZiBhbnkKICAgICAgICAgKi8KICAgICAgICBmZXRjaE1TTVMgOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIGNvbCA9IHNlbGYuZ2V0TVNNU1N1YkNvbGxlY3Rpb24ob3B0aW9ucyk7CiAgICAgICAgICAgIHZhciBjb2xOb01TTVMgPSBjb2wuZmlsdGVyKGZ1bmN0aW9uKHNwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc3AuZ2V0KCdtb3pzJykgPT0gbnVsbDsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHZhciBuID0gY29sTm9NU01TLmxlbmd0aDsKICAgICAgICAgICAgaWYgKG4gPT0gMCAmJiBvcHRpb25zLnN1Y2Nlc3MpIHsKICAgICAgICAgICAgICAgIG9wdGlvbnMuc3VjY2Vzcyhjb2wpCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIGNwdCA9IDA7CiAgICAgICAgICAgIF8uZWFjaChjb2xOb01TTVMsIGZ1bmN0aW9uKHNwKSB7CiAgICAgICAgICAgICAgICBzcC5mZXRjaCh7CiAgICAgICAgICAgICAgICAgICAgc3VjY2VzcyA6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBjcHQrKzsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNwdCA9PSBuICYmIG9wdGlvbnMuc3VjY2VzcykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5zdWNjZXNzKGNvbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KQogICAgICAgIH0sCiAgICAgICAgLyoqCiAgICAgICAgICogYWx0aG91Z2ggdGhlIG91dGNvbWUgaXMgc2ltaWxhciwgdGhpcyBtZXRoaWQgZGlmZmVycyBmcm9tIGZldGNoTVNNUyh7c2NhbnNOdW1iZXJzOi4uLn0pIGluIHRoZSBzZW5zZSB0aGF0IHdlIGRvbid0IG5lZWQgdG8gbG9hZCB0aGUgZnVsbCBydW4gdG8gdHJhbnNsYXRlIHNjYW4gbnVtYmVyIGludG8gaWRzLi4uCiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IHNjYW5OdW1iZXIKICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogICAgICAgICAqLwogICAgICAgIGZldGNoTVNNU0Zyb21TY2FuTnVtYmVycyA6IGZ1bmN0aW9uKHNjYW5zLCBvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIHVybCA9IHNlbGYudXJsUm9vdCgpICsgJy8nICsgc2VsZi5nZXQoJ2lkJykgKyAnL21zbXNmcm9tc2NhbnMvJyArIHNjYW5zLmpvaW4oJywnKTsKICAgICAgICAgICAgCiAgICAgICAgICAgICQuZ2V0SlNPTih1cmwsIHt9LCBmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgICAgICAgICB2YXIgY29sID0gbmV3IEV4cE1TTVNTcGVjdHJ1bUNvbGxlY3Rpb24oZGF0YSk7CiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5zdWNjZXNzKSB7CiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5zdWNjZXNzKHNlbGYsIGNvbCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gTVNNU1J1bjsKfSk7CgovKioKICogYmFzaWMgbWF0aCB1dGlsaXRpZXMKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCgpkZWZpbmUoJ2Zpc2h0b25lcy91dGlscy9NYXRoVXRpbHMnLFsndW5kZXJzY29yZSddLCBmdW5jdGlvbiAoXykgewogICAgdmFyIE1hdGhVdGlscyA9IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICB9CiAgICAvKioKICAgICAqIFNpbXBzb24gaW50ZWdyYXRpb24gb3ZlciB4LHkgdmFsdWVzCiAgICAgKiBAcGFyYW0geAogICAgICogQHBhcmFtIHkKICAgICAqIEByZXR1cm4ge251bWJlcn0KICAgICAqLwogICAgTWF0aFV0aWxzLnByb3RvdHlwZS5pbnRlZ3JhdGUgPSBmdW5jdGlvbiAoeCwgeSkgewogICAgICAgIHZhciBzID0gMC4wOwogICAgICAgIF8udGltZXMoeC5sZW5ndGggLSAxLCBmdW5jdGlvbiAoaSkgewogICAgICAgICAgICBzICs9IDEuMCAqICh4W2kgKyAxXSAtIHhbaV0pICogKHlbaV0gKyB5W2kgKyAxXSkKICAgICAgICB9KQogICAgICAgIHJldHVybiBzIC8gMi4wCiAgICB9CgogICAgLyoqCiAgICAgKiBsaW5lYXIgaW50ZXJwb2xhdGlvbQogICAgICogeHMgJiB5cyBhcmUgdGhlIGtub3duIG1lYXN1cmVzCiAgICAgKiB4cyBtdXN0IGJlIHNvcnRlZCBhbmQgc3RyaWNsdHkgaW5jcmVhc2luZwogICAgICoKICAgICAqIGZvciBhIGdpdmVuIHgsIHJldHVybiB0aGUgeXMnIGludGVycG9sYXRpb24gYmV0d2VlbiB0aGUgdHdvIGNsb3Nlc3Qgc3Vycm91bmRpaW5nIHhzJwogICAgICogYXNraW5nIGZvciBhbiB4IG91dHNpZGUgYm91bmRhcmllcyB3aWxsIHJldHVybiBOYU4KICAgICAqCiAgICAgKiBAcGFyYW0ge09iamVjdH0geHMKICAgICAqIEBwYXJhbSB7T2JqZWN0fSB5cwogICAgICogQHBhcmFtIHtPYmplY3R9IHgKICAgICAqLwogICAgTWF0aFV0aWxzLnByb3RvdHlwZS5pbnRlcnBvbGF0ZSA9IGZ1bmN0aW9uICh4cywgeXMsIHgpIHsKICAgICAgICB2YXIgbiA9IF8uc2l6ZSh4cykKICAgICAgICBpZiAobiA9PSAwIHx8IHggPCB4c1swXSB8fCB4ID4geHNbbiAtIDFdKSB7CiAgICAgICAgICAgIHJldHVybiBOYU47CiAgICAgICAgfQogICAgICAgIHZhciBpMSA9IDAsIGkyID0gbiAtIDE7CiAgICAgICAgd2hpbGUgKGkyIC0gaTEgPiAxKSB7CiAgICAgICAgICAgIHZhciBpbSA9IE1hdGguZmxvb3IoKGkxICsgaTIpIC8gMikKICAgICAgICAgICAgaWYgKHggPCB4c1tpbV0pIHsKICAgICAgICAgICAgICAgIGkyID0gaW0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGkxID0gaW0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gIHlzW2kxXSArICh4IC0geHNbaTFdKSAvICh4c1tpMl0gLSB4c1tpMV0pICogKHlzW2kyXSAtIHlzW2kxXSkKCiAgICB9CgogICAgcmV0dXJuIG5ldyBNYXRoVXRpbHMoKQp9KTsKCi8qCiAqIEdldCB0aGUgaW5zdHJ1bWVudCBwYXJhbWV0ZXJzLgogKiBNYWlubHk6CiAqIC0gcHJlY3Vyc29yVG9sCiAqIC0gZnJhZ21lbnRUb2wKICogVG9sZXJhbmNlIGFyZSBleHByZXNzZWQgaW4gcHBtCiAqCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwoKZGVmaW5lKCdmaXNodG9uZXMvbW9kZWxzL3dldC9JbnN0cnVtZW50UGFyYW1zJyxbCiAgICAnQmFja2JvbmUnLAogICAgJ0NvbmZpZycKXSwgZnVuY3Rpb24gKEJhY2tib25lLCBjb25maWcpIHsKICAgIHZhciBJbnN0cnVtZW50UGFyYW1zID0gQmFja2JvbmUuTW9kZWwuZXh0ZW5kKHsKICAgICAgICBkZWZhdWx0czogewogICAgICAgICAgICBmcmFnbWVudFRvbDogdW5kZWZpbmVkLAogICAgICAgICAgICBwcmVjdXJzb3JUb2w6IHVuZGVmaW5lZCwKICAgICAgICB9LAogICAgICAgIHVybDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gY29uZmlnLmdldCgnd2V0LnVybC5yZXN0JykgKyAnL2luc3RydW1lbnRwYXJhbXMvJyArIHRoaXMuZ2V0KCdpZCcpCiAgICAgICAgfSwKICAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICB9LAogICAgICAgIHRvU3RyaW5nOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgcmV0dXJuICd0b2w6JyArIHNlbGYuZ2V0KCdwcmVjdXJzb3JUb2wnKSArICcvJyArIHNlbGYuZ2V0KCdmcmFnbWVudFRvbCcpOwogICAgICAgIH0sCiAgICAgICAgdG9Kc29uOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIHByZWN1cnNvclRvbDogc2VsZi5nZXQoJ3ByZWN1cnNvclRvbCcpLAogICAgICAgICAgICAgICAgZnJhZ21lbnRUb2w6IHNlbGYuZ2V0KCdmcmFnbWVudFRvbCcpCiAgICAgICAgICAgIH0KICAgICAgICB9LAoKICAgIH0pOwogICAgcmV0dXJuIEluc3RydW1lbnRQYXJhbXM7Cn0pOwoKLyoKICogQ3Jvc3MgSW9uIENocm9tYXRvZ3JhbS4KICogQ29udGFpbnMgbWFpbmx5IHR3byBhcnJheXMgb2YgZmxvYXQ6CiAqIC0gcmV0ZW50aW9uVGltZXMKICogLSBpbnRlbnNpdGllcwogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KCmRlZmluZSgnZmlzaHRvbmVzL21vZGVscy93ZXQvWElDJyxbJ0JhY2tib25lJywgJ0NvbmZpZyddLCBmdW5jdGlvbihCYWNrYm9uZSwgY29uZmlnKSB7CiAgICB2YXIgWElDID0gQmFja2JvbmUuTW9kZWwuZXh0ZW5kKHsKICAgICAgICBkZWZhdWx0cyA6IHsKICAgICAgICB9LAogICAgICAgIGluaXRpYWxpemUgOiBmdW5jdGlvbigpIHsKICAgICAgICB9LAogICAgICAgIHNpemUgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0KCdyZXRlbnRpb25UaW1lcycpLmxlbmd0aAogICAgICAgIH0sCgogICAgICAgIHRvSlNPTiA6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHZhciBqc29uID0gWElDLl9fc3VwZXJfXy50b0pTT04uY2FsbChzZWxmKTsKCiAgICAgICAgICAgIGlmKGpzb24ucmljaFNlcXVlbmNlKXsKICAgICAgICAgICAgICAgIGpzb24ucmljaFNlcXVlbmNlID0ganNvbi5yaWNoU2VxdWVuY2UudG9TdHJpbmcoKTsgCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vanNvbmlmeSBtZW1lYmVycyAobXNtcywgcmljaFNlcXVlbmNlIGFuZCBjbykKICAgICAgICAgICAgdmFyIGtzID0gXy5rZXlzKGpzb24pCiAgICAgICAgICAgIF8uZWFjaChrcywgZnVuY3Rpb24oayl7CiAgICAgICAgICAgICAgICBpZighICgoanNvbltrXSBpbnN0YW5jZW9mIEJhY2tib25lLk1vZGVsKSB8fCAoanNvbltrXSBpbnN0YW5jZW9mIEJhY2tib25lLkNvbGxlY3Rpb24pKSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBqc29uW2tdID0ganNvbltrXS50b0pTT04oKQogICAgICAgICAgICB9KQogICAgICAgICAgICByZXR1cm4ganNvbgogICAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIFhJQzsKfSk7CgovKgogKiBhbiBJbmplY3Rpb24gaGFuZGxlcyBvbmUgZXhwZXJpbWVudGFsIHJ1biAoTVNSdW4pLCB0b2xlcmFuY2VzICwgbmFtZSBldGMuCiAqIEl0IGlzIHR5cGljYWxseSBmZWN0aGVkIGZyb20gYSBzZXJ2ZXIuCiAqIFByb3BlcnRpZXMKICogKiBhIG5hbWUKICogKiBhbiBNU01TUnVuCiAqICogYW4gSW5zdHJ1bWVudFBhcmFtcwogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KCmRlZmluZSgnZmlzaHRvbmVzL21vZGVscy93ZXQvSW5qZWN0aW9uJyxbJ2pxdWVyeScsICd1bmRlcnNjb3JlJywgJ0JhY2tib25lJywgJ0NvbmZpZycsICdmaXNodG9uZXMvdXRpbHMvTWF0aFV0aWxzJywgJy4vSW5zdHJ1bWVudFBhcmFtcycsICcuL1hJQycsICdmaXNodG9uZXMvY29sbGVjdGlvbnMvd2V0L0V4cE1TTVNTcGVjdHJ1bUNvbGxlY3Rpb24nLCAnZmlzaHRvbmVzL21vZGVscy93ZXQvTVNNU1J1biddLCBmdW5jdGlvbiAoJCwgXywgQmFja2JvbmUsIGNvbmZpZywgbWF0aFV0aWxzLCBJbnN0cnVtZW50UGFyYW1zLCBYSUMsIEV4cE1TTVNTcGVjdHJ1bUNvbGxlY3Rpb24sIE1TTVNSdW4pIHsKICAgIHZhciBJbmplY3Rpb24gPSBCYWNrYm9uZS5Nb2RlbC5leHRlbmQoewogICAgICAgICAgICBkZWZhdWx0czogewogICAgICAgICAgICB9LAogICAgICAgICAgICB1cmxSb290OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gY29uZmlnLmdldCgnd2V0LnVybC5yZXN0JykgKyAnL2luamVjdGlvbic7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHVybHM6IHsKICAgICAgICAgICAgICAgIGNocm9tYXRvWGljOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpZy5nZXQoJ3dldC51cmwucmVzdCcpICsgJy9jaHJvbWF0by94aWMnCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiB0aGUgc2V0IG1ldGhvZCBuZWVkcyB0byBiZSBzbGlnaGx0eSBvdmVycmlkZW4sIGJlYWNhdXNlCiAgICAgICAgICAgICAqIC0gYW4gaW5zdHJ1bWVudFBhcmFtcyBhdHRyIHNob3VsZCBiZSBjYXN0IGludG8gYW4gYWN0dWFsIEluc3RydW1lbnRQYXJhbXMKICAgICAgICAgICAgICogLSBhbiBydW5JbmZvIGF0dHIgc2hhbGwgYmUgY2FzdGVkIGludG8gYW4gTVNNU1J1biwgZXZlbmUgaWYgaXQgZG9lcyBub3QgY29udGFpbiBtdWNoCiAgICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBhdHRycwogICAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogICAgICAgICAgICAgKi8KICAgICAgICAgICAgc2V0OiBmdW5jdGlvbiAoYXR0cnMsIG9wdGlvbnMpIHsKICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgICAgIC8vbG92ZSB0aGF0LiBhcmd1bWVudCBjYW4gZWl0aGVyIGJlIGEgbWFwIGFuZCBhbiBvYmplY3Qgb3IgYSBrZXkgYW5kIGEgdmFsdWUKICAgICAgICAgICAgICAgIGlmIChfLmlzU3RyaW5nKGF0dHJzKSkgewogICAgICAgICAgICAgICAgICAgIHZhciBrID0gYXR0cnM7CiAgICAgICAgICAgICAgICAgICAgYXR0cnMgPSB7fTsKICAgICAgICAgICAgICAgICAgICBhdHRyc1trXSA9IG9wdGlvbnM7CiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy9tb2RpZnkgZXhpc3RpbmcgaW5zdHJ1bW1lbnQgcGFyYW1zCiAgICAgICAgICAgICAgICBpZiAoYXR0cnMuaW5zdHJ1bWVudFBhcmFtcyAmJiAoIShhdHRycy5pbnN0cnVtZW50UGFyYW1zIGluc3RhbmNlb2YgSW5zdHJ1bWVudFBhcmFtcykpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGYuZ2V0KCdpbnN0cnVtZW50UGFyYW1zJykgaW5zdGFuY2VvZiBJbnN0cnVtZW50UGFyYW1zKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZ2V0KCdpbnN0cnVtZW50UGFyYW1zJykuc2V0KGF0dHJzLmluc3RydW1lbnRQYXJhbXMpOwogICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgYXR0cnMuaW5zdHJ1bWVudFBhcmFtcwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJzLmluc3RydW1lbnRQYXJhbXMgPSBuZXcgSW5zdHJ1bWVudFBhcmFtcyhhdHRycy5pbnN0cnVtZW50UGFyYW1zKTsKICAgICAgICAgICAgICAgICAgICAgICAgLy9jaGFuZ2luZyBhbiBlbWJlZGRlZCBpbnN0cnVtZW50IHBhcmFtcyBidWJibGUgdGhlIGV2ZW50Li4uCiAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJzLmluc3RydW1lbnRQYXJhbXMub24oJ2NoYW5nZScsIGZ1bmN0aW9uICh0YXJnZXQsIGN0eCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi50cmlnZ2VyKCdjaGFuZ2VJbnN0cnVtZW50UGFyYW1zJywgY3R4LmNoYW5nZXMpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGF0dHJzLnJ1bkluZm8pIHsKICAgICAgICAgICAgICAgICAgICBhdHRycy5ydW4gPSBuZXcgTVNNU1J1bihhdHRycy5ydW5JbmZvKQogICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBhdHRycy5ydW5JbmZvCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gQmFja2JvbmUuTW9kZWwucHJvdG90eXBlLnNldC5jYWxsKHNlbGYsIGF0dHJzLCBvcHRpb25zKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIGFzayBmb3IgYSBYSUMsIGVucmljaGVkIHdpdGggTVNNUyBmb3IgYSBnaXZlbiBtYXNzIGFuZCBjYWxsYmFjayBvbiBzdWNjZXNzCiAgICAgICAgICAgICAqIEFzIHRoZSBpbmplY3Rpb24ga25vdyB0aGUgcHJlY3Vyc29yIHRvbGVyYW5jZSAodmlhIHRoZSBpbnN0cnVtZW50UGFyYW1zKSwgbWFzcyBpcyBlbm91Z2ggdG8gZ2V0IHRoZSBYSUMuCiAgICAgICAgICAgICAqIEBwYXJhbSBtYXNzCiAgICAgICAgICAgICAqIEBwYXJhbSBvcHRpb25zCiAgICAgICAgICAgICAqIEBwYXJhbSBjYWxsYmFjayBhIGZ1bmN0aW9uIGNhbGxlZCB3aXRoIHRoZSByZXR1cm4geGljLiB0aGUgY2FsbCBiYWNrIGNhbiBhbHNvIGJlIHNwZWNpZmllZCB0aHJvdWdoIHRoZSBzdWNjZXNzIG9wdGlvbnMKICAgICAgICAgICAgICovCiAgICAgICAgICAgIGNocm9tYXRvWGljOiBmdW5jdGlvbiAobWFzcywgb3B0aW9ucywgY2FsbGJhY2spIHsKICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgMyAmJiBvcHRpb25zICE9IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLnN1Y2Nlc3MgIT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrID0gb3B0aW9ucy5zdWNjZXNzOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrID0gb3B0aW9uczsKICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB2YXIgYnVpbGRNc01zUG9pbnRlcnMgPSBmdW5jdGlvbiAoeGljUlQsIHhpY0ludGVucywgbXNtc1NwZWN0cmEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gXy5tYXAobXNtc1NwZWN0cmEsIGZ1bmN0aW9uIChzcCkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgcnQgPSBzcC5yZXRlbnRpb25UaW1lOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW50ZW5zID0gbWF0aFV0aWxzLmludGVycG9sYXRlKHhpY1JULCB4aWNJbnRlbnMsIHJ0KQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3BlY3RydW06IHNwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0ZW50aW9uVGltZTogcnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnRlbnNpdHk6IGludGVucwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHZhciB1cmwgPSBzZWxmLnVybHMuY2hyb21hdG9YaWMoKSArICcvJyArIHNlbGYuZ2V0KCdpZCcpICsgJz9tPScgKyBtYXNzICsgJyZtc21zPXRydWUnOwogICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuY2hhcmdlKSB7CiAgICAgICAgICAgICAgICAgICAgdXJsICs9ICcmej0nICsgb3B0aW9ucy5jaGFyZ2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB1cmwgKz0gJyZwcmVjVG9sPScgKyBzZWxmLmdldCgnaW5zdHJ1bWVudFBhcmFtcycpLmdldCgncHJlY3Vyc29yVG9sJyk7CiAgICAgICAgICAgICAgICAkLmdldEpTT04odXJsLCB7fSwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgeGljID0gbmV3IFhJQygkLmV4dGVuZCh7CiAgICAgICAgICAgICAgICAgICAgICAgIG1hc3M6IG1hc3MKICAgICAgICAgICAgICAgICAgICB9LCBvcHRpb25zKSkKICAgICAgICAgICAgICAgICAgICB4aWMuc2V0KCdpZCcsIHNlbGYuZ2V0KCdpZCcpICsgJ18nICsgbWFzcykKCiAgICAgICAgICAgICAgICAgICAgLy9iYWNrd2FyZHMgY29tcGF0aWJpbGl0eQogICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLmV4cFNwZWN0cmEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBvaW50ZXJzID0gYnVpbGRNc01zUG9pbnRlcnMoZGF0YS5yZXRlbnRpb25UaW1lcywgZGF0YS5pbnRlbnNpdGllcywgZGF0YS5leHBTcGVjdHJhKQogICAgICAgICAgICAgICAgICAgICAgICB4aWMuc2V0KCdtc21zJywgbmV3IEV4cE1TTVNTcGVjdHJ1bUNvbGxlY3Rpb24oXy5wbHVjayhwb2ludGVycywgJ3NwZWN0cnVtJykpKTsKICAgICAgICAgICAgICAgICAgICAgICAgeGljLnNldCgnbXNtc1BvaW50ZXJzJywgcG9pbnRlcnMpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtc21zID0gbmV3IEV4cE1TTVNTcGVjdHJ1bUNvbGxlY3Rpb24oZGF0YS5tc21zLmV4cFNwZWN0cmEpOwogICAgICAgICAgICAgICAgICAgICAgICB4aWMuc2V0KCdtc21zJywgbXNtcyk7CgogICAgICAgICAgICAgICAgICAgICAgICB4aWMuc2V0KCdtc21zUG9pbnRlcnMnLCBfLmNvbGxlY3QoXy56aXAoZGF0YS5tc21zLnNwZWN0cmFJZHMsIGRhdGEubXNtcy5yZXRlbnRpb25UaW1lcywgZGF0YS5tc21zLmludGVuc2l0aWVzKSwgZnVuY3Rpb24gKGEsIGkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzcCA9IG1zbXMuZ2V0KGFbMF0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcGVjdHJ1bTogc3AsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0ZW50aW9uVGltZTogYVsxXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnRlbnNpdHk6IGFbMl0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgeGljLnNldCgncmV0ZW50aW9uVGltZXMnLCBkYXRhLnJldGVudGlvblRpbWVzKQogICAgICAgICAgICAgICAgICAgIHhpYy5zZXQoJ2ludGVuc2l0aWVzJywgZGF0YS5pbnRlbnNpdGllcykKCiAgICAgICAgICAgICAgICAgICAgeGljLnNldCgnaW5qZWN0aW9uSW5mbycsIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHNlbGYuZ2V0KCdpZCcpLAogICAgICAgICAgICAgICAgICAgICAgICBzZWFyY2hJZDogc2VsZi5nZXQoJ3NlYXJjaElkJyksCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHNlbGYuZ2V0KCduYW1lJykKICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soeGljKQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIDsKICAgIHJldHVybiBJbmplY3Rpb247Cn0pCjsKCi8qCiAqIGp1c3QgYSBjb2xsZWN0aW9uIG9mIEluamVjdGlvbgogKiAKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCgpkZWZpbmUoJ2Zpc2h0b25lcy9jb2xsZWN0aW9ucy93ZXQvSW5qZWN0aW9uQ29sbGVjdGlvbicsWydCYWNrYm9uZScsICdmaXNodG9uZXMvbW9kZWxzL3dldC9JbmplY3Rpb24nLCBdLCBmdW5jdGlvbihCYWNrYm9uZSwgSW5qZWN0aW9uKSB7CiAgICB2YXIgSW5qZWN0aW9uQ29sbGVjdGlvbiA9IEJhY2tib25lLkNvbGxlY3Rpb24uZXh0ZW5kKHsKICAgICAgICBtb2RlbCA6IEluamVjdGlvbiwKICAgICAgICBkZWZhdWx0cyA6IHsKICAgICAgICB9LAogICAgICAgIGluaXRpYWxpemUgOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICB9CiAgICB9KTsKICAgIHJldHVybiBJbmplY3Rpb25Db2xsZWN0aW9uOwp9KTsKCgovKgogKiBBbiBleHBlcmltZW50IGNvbnRhaW5zIG1haW5seSBhIGxpc3Qgb2YgaW5qZWN0aW9ucyAoYWNxdWlyZWQgc2FtcGxlcykKICogUHJvcGVydGllczoKICogLSBpbmplY3Rpb246IGFycmF5IG9mIEluamVjdGlvbgogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KCmRlZmluZSgnZmlzaHRvbmVzL21vZGVscy93ZXQvRXhwZXJpbWVudCcsWydqcXVlcnknLCAndW5kZXJzY29yZScsICdCYWNrYm9uZScsICdDb25maWcnLCAnZmlzaHRvbmVzL21vZGVscy93ZXQvSW5qZWN0aW9uJywgJ2Zpc2h0b25lcy9jb2xsZWN0aW9ucy93ZXQvSW5qZWN0aW9uQ29sbGVjdGlvbiddLCBmdW5jdGlvbiAoJCwgXywgQmFja2JvbmUsIGNvbmZpZywgSW5qZWN0aW9uLCBJbmplY3Rpb25Db2xsZWN0aW9uKSB7CiAgICB2YXIgRXhwZXJpbWVudCA9IEJhY2tib25lLk1vZGVsLmV4dGVuZCh7CiAgICAgICAgZGVmYXVsdHM6IHsKICAgICAgICB9LAogICAgICAgIHVybFJvb3Q6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGNvbmZpZy5nZXQoJ3dldC51cmwucmVzdCcpICsgJy9leHBlcmltZW50JwogICAgICAgIH0sCiAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgfSwKICAgICAgICBzZXQ6IGZ1bmN0aW9uIChhdHRycywgb3B0aW9ucykgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICAgICAgICAvL2xvdmUgdGhhdC4gYXJndW1lbnQgY2FuIGVpdGhlciBiZSBhIG1hcCBhbmQgYW4gb2JqZWN0IG9yIGEga2V5IGFuZCBhIHZhbHVlCiAgICAgICAgICAgIGlmIChfLmlzU3RyaW5nKGF0dHJzKSkgewogICAgICAgICAgICAgICAgdmFyIGsgPSBhdHRyczsKICAgICAgICAgICAgICAgIGF0dHJzID0ge307CiAgICAgICAgICAgICAgICBhdHRyc1trXSA9IG9wdGlvbnM7CiAgICAgICAgICAgICAgICBvcHRpb25zID0ge307CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy9tb2RpZnkgZXhpc3RpbmcgSW5qZWN0aW9uIHBhcmFtcwogICAgICAgICAgICBpZiAoYXR0cnMuaW5qZWN0aW9ucyAmJiAoIShhdHRycy5pbmplY3Rpb25zIGluc3RhbmNlb2YgSW5qZWN0aW9uQ29sbGVjdGlvbikpKSB7CiAgICAgICAgICAgICAgICBpZiAoc2VsZi5nZXQoJ2luamVjdGlvbnMnKSBpbnN0YW5jZW9mIEluamVjdGlvbkNvbGxlY3Rpb24pIHsKICAgICAgICAgICAgICAgICAgICBzZWxmLmdldCgnaW5qZWN0aW9ucycpLnJlc2V0KCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHNlbGYuc2V0KCdpbmplY3Rpb25zJywgbmV3IEluamVjdGlvbkNvbGxlY3Rpb24oKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzZWxmLmdldCgnaW5qZWN0aW9ucycpLmFkZChfLmNvbGxlY3QoYXR0cnMuaW5qZWN0aW9ucywgZnVuY3Rpb24gKHBpbmopIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEluamVjdGlvbihwaW5qKQogICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgZGVsZXRlIGF0dHJzLmluamVjdGlvbnMKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gQmFja2JvbmUuTW9kZWwucHJvdG90eXBlLnNldC5jYWxsKHNlbGYsIGF0dHJzLCBvcHRpb25zKTsKICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqIGFkZCBhbiBpbmplY3Rpb24gdG8gdGhlIGxpc3QuCiAgICAgICAgICogQHBhcmFtIGluagogICAgICAgICAqIEBwYXJhbSBvcHRpb25zCiAgICAgICAgICogQHJldHVybiB7RXhwZXJpbWVudH0KICAgICAgICAgKi8KICAgICAgICBpbmplY3Rpb25zX2FkZDogZnVuY3Rpb24gKGluaiwgb3B0aW9ucykgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIG9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgb3B0aW9ucyk7CiAgICAgICAgICAgIHNlbGYuZ2V0KCdpbmplY3Rpb25zJykuYWRkKGluaikKICAgICAgICAgICAgaWYgKG9wdGlvbnMuc2F2ZSkgewogICAgICAgICAgICAgICAgdmFyIHVybCA9IHNlbGYudXJsUm9vdCgpICsgJy8nICsgc2VsZi5nZXQoJ2lkJykgKyAnL2luamVjdGlvbnMvJyArIGluai5nZXQoJ2lkJyk7CiAgICAgICAgICAgICAgICAkLmFqYXgodXJsLCB7CiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ1BVVCcsCiAgICAgICAgICAgICAgICAgICAgc3VjY2Vzczogb3B0aW9ucy5zdWNjZXNzCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICB9CiAgICB9KTsKICAgIHJldHVybiBFeHBlcmltZW50Owp9KTsKCi8qCiAqIGp1c3QgYSBjb2xsZWN0aW9uIG9mIFhJQywgd2l0aCBhbiBhdHRhY2hlZCBjb2xsZWN0aW9uIGxlZ2VuZCBjb250YWluZXIKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCgpkZWZpbmUoJ2Zpc2h0b25lcy9jb2xsZWN0aW9ucy93ZXQvWElDQ29sbGVjdGlvbicsWydCYWNrYm9uZScsICdmaXNodG9uZXMvbW9kZWxzL3dldC9YSUMnXSwgZnVuY3Rpb24oQmFja2JvbmUsIFhJQykgewogIHZhciBYSUNDb2xsZWN0aW9uTGVnZW5kID0gQmFja2JvbmUuTW9kZWwuZXh0ZW5kKHsKICAgIGRlZmF1bHRzIDogewoKICAgIH0sCiAgICBpbml0aWFsaXplIDogZnVuY3Rpb24oKSB7CiAgICAgIHRoaXMuX2xlZ2VuZHMgPSBbXTsKICAgIH0sCiAgICByZXNldCA6IGZ1bmN0aW9uKCkgewogICAgICB0aGlzLl9sZWdlbmRzLmxlbmd0aCA9IDA7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKICAgIC8qKgogICAgICoKICAgICAqIEBwYXJhbSB7T2JqZWN0fSBlIDp7CiAgICAgKiAgIG5hbWU6IHBlcHRpZGUgbmFtZQogICAgICogICBtYXNzZXM6IFtdIGFycmF5IG9mIG1hc3Nlcywgd2hlcmUgbWFzc2VzW2ldIGlzIHRoZSBtYXNzIGZvciBjaGFyZ2UgaQogICAgICogfQogICAgICovCiAgICBhZGQgOiBmdW5jdGlvbihlKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIF90aGlzLl9sZWdlbmRzLnB1c2goewogICAgICAgIG5hbWUgOiBlLm5hbWUgfHwgJ24vYScsCiAgICAgICAgbWFzc2VzIDogZS5tYXNzZXMgfHwgW10KICAgICAgfSk7CiAgICAgIF90aGlzLnRyaWdnZXIoJ2NoYW5nZScpOwogICAgICByZXR1cm4gX3RoaXM7CiAgICB9LAogICAgc2l6ZSA6IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gdGhpcy5fbGVnZW5kcy5sZW5ndGg7CiAgICB9LAogICAgbGlzdCA6IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gdGhpcy5fbGVnZW5kczsKICAgIH0KICB9KTsKCiAgdmFyIFhJQ0NvbGxlY3Rpb24gPSBCYWNrYm9uZS5Db2xsZWN0aW9uLmV4dGVuZCh7CiAgICBtb2RlbCA6IFhJQywKICAgIGRlZmF1bHRzIDogewogICAgfSwKICAgIGluaXRpYWxpemUgOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIF90aGlzLmxlZ2VuZHMgPSBuZXcgWElDQ29sbGVjdGlvbkxlZ2VuZCgpOwogICAgfQogIH0pOwoKICByZXR1cm4gWElDQ29sbGVjdGlvbjsKfSk7CgohZnVuY3Rpb24oKXtmdW5jdGlvbiBuKG4sdCl7cmV0dXJuIHQ+bj8tMTpuPnQ/MTpuPj10PzA6MC8wfWZ1bmN0aW9uIHQobil7cmV0dXJuIG51bGwhPW4mJiFpc05hTihuKX1mdW5jdGlvbiByKG4pe3JldHVybntsZWZ0OmZ1bmN0aW9uKHQscixlLHUpe2Zvcihhcmd1bWVudHMubGVuZ3RoPDMmJihlPTApLGFyZ3VtZW50cy5sZW5ndGg8NCYmKHU9dC5sZW5ndGgpO3U+ZTspe3ZhciBpPWUrdT4+PjE7bih0W2ldLHIpPDA/ZT1pKzE6dT1pfXJldHVybiBlfSxyaWdodDpmdW5jdGlvbih0LHIsZSx1KXtmb3IoYXJndW1lbnRzLmxlbmd0aDwzJiYoZT0wKSxhcmd1bWVudHMubGVuZ3RoPDQmJih1PXQubGVuZ3RoKTt1PmU7KXt2YXIgaT1lK3U+Pj4xO24odFtpXSxyKT4wP3U9aTplPWkrMX1yZXR1cm4gZX19fWZ1bmN0aW9uIGUobil7cmV0dXJuIG4ubGVuZ3RofWZ1bmN0aW9uIHUobil7Zm9yKHZhciB0PTE7bip0JTE7KXQqPTEwO3JldHVybiB0fWZ1bmN0aW9uIGkobix0KXt0cnl7Zm9yKHZhciByIGluIHQpT2JqZWN0LmRlZmluZVByb3BlcnR5KG4ucHJvdG90eXBlLHIse3ZhbHVlOnRbcl0sZW51bWVyYWJsZTohMX0pfWNhdGNoKGUpe24ucHJvdG90eXBlPXR9fWZ1bmN0aW9uIG8oKXt9ZnVuY3Rpb24gYShuKXtyZXR1cm4gc2ErbiBpbiB0aGlzfWZ1bmN0aW9uIGMobil7cmV0dXJuIG49c2ErbixuIGluIHRoaXMmJmRlbGV0ZSB0aGlzW25dfWZ1bmN0aW9uIHMoKXt2YXIgbj1bXTtyZXR1cm4gdGhpcy5mb3JFYWNoKGZ1bmN0aW9uKHQpe24ucHVzaCh0KX0pLG59ZnVuY3Rpb24gbCgpe3ZhciBuPTA7Zm9yKHZhciB0IGluIHRoaXMpdC5jaGFyQ29kZUF0KDApPT09bGEmJisrbjtyZXR1cm4gbn1mdW5jdGlvbiBmKCl7Zm9yKHZhciBuIGluIHRoaXMpaWYobi5jaGFyQ29kZUF0KDApPT09bGEpcmV0dXJuITE7cmV0dXJuITB9ZnVuY3Rpb24gaCgpe31mdW5jdGlvbiBnKG4sdCxyKXtyZXR1cm4gZnVuY3Rpb24oKXt2YXIgZT1yLmFwcGx5KHQsYXJndW1lbnRzKTtyZXR1cm4gZT09PXQ/bjplfX1mdW5jdGlvbiBwKG4sdCl7aWYodCBpbiBuKXJldHVybiB0O3Q9dC5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSt0LnN1YnN0cmluZygxKTtmb3IodmFyIHI9MCxlPWZhLmxlbmd0aDtlPnI7KytyKXt2YXIgdT1mYVtyXSt0O2lmKHUgaW4gbilyZXR1cm4gdX19ZnVuY3Rpb24gdigpe31mdW5jdGlvbiBkKCl7fWZ1bmN0aW9uIG0obil7ZnVuY3Rpb24gdCgpe2Zvcih2YXIgdCxlPXIsdT0tMSxpPWUubGVuZ3RoOysrdTxpOykodD1lW3VdLm9uKSYmdC5hcHBseSh0aGlzLGFyZ3VtZW50cyk7cmV0dXJuIG59dmFyIHI9W10sZT1uZXcgbztyZXR1cm4gdC5vbj1mdW5jdGlvbih0LHUpe3ZhciBpLG89ZS5nZXQodCk7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg8Mj9vJiZvLm9uOihvJiYoby5vbj1udWxsLHI9ci5zbGljZSgwLGk9ci5pbmRleE9mKG8pKS5jb25jYXQoci5zbGljZShpKzEpKSxlLnJlbW92ZSh0KSksdSYmci5wdXNoKGUuc2V0KHQse29uOnV9KSksbil9LHR9ZnVuY3Rpb24geSgpe0JvLmV2ZW50LnByZXZlbnREZWZhdWx0KCl9ZnVuY3Rpb24geCgpe2Zvcih2YXIgbix0PUJvLmV2ZW50O249dC5zb3VyY2VFdmVudDspdD1uO3JldHVybiB0fWZ1bmN0aW9uIE0obil7Zm9yKHZhciB0PW5ldyBkLHI9MCxlPWFyZ3VtZW50cy5sZW5ndGg7KytyPGU7KXRbYXJndW1lbnRzW3JdXT1tKHQpO3JldHVybiB0Lm9mPWZ1bmN0aW9uKHIsZSl7cmV0dXJuIGZ1bmN0aW9uKHUpe3RyeXt2YXIgaT11LnNvdXJjZUV2ZW50PUJvLmV2ZW50O3UudGFyZ2V0PW4sQm8uZXZlbnQ9dSx0W3UudHlwZV0uYXBwbHkocixlKX1maW5hbGx5e0JvLmV2ZW50PWl9fX0sdH1mdW5jdGlvbiBfKG4pe3JldHVybiBnYShuLHlhKSxufWZ1bmN0aW9uIGIobil7cmV0dXJuImZ1bmN0aW9uIj09dHlwZW9mIG4/bjpmdW5jdGlvbigpe3JldHVybiBwYShuLHRoaXMpfX1mdW5jdGlvbiB3KG4pe3JldHVybiJmdW5jdGlvbiI9PXR5cGVvZiBuP246ZnVuY3Rpb24oKXtyZXR1cm4gdmEobix0aGlzKX19ZnVuY3Rpb24gUyhuLHQpe2Z1bmN0aW9uIHIoKXt0aGlzLnJlbW92ZUF0dHJpYnV0ZShuKX1mdW5jdGlvbiBlKCl7dGhpcy5yZW1vdmVBdHRyaWJ1dGVOUyhuLnNwYWNlLG4ubG9jYWwpfWZ1bmN0aW9uIHUoKXt0aGlzLnNldEF0dHJpYnV0ZShuLHQpfWZ1bmN0aW9uIGkoKXt0aGlzLnNldEF0dHJpYnV0ZU5TKG4uc3BhY2Usbi5sb2NhbCx0KX1mdW5jdGlvbiBvKCl7dmFyIHI9dC5hcHBseSh0aGlzLGFyZ3VtZW50cyk7bnVsbD09cj90aGlzLnJlbW92ZUF0dHJpYnV0ZShuKTp0aGlzLnNldEF0dHJpYnV0ZShuLHIpfWZ1bmN0aW9uIGEoKXt2YXIgcj10LmFwcGx5KHRoaXMsYXJndW1lbnRzKTtudWxsPT1yP3RoaXMucmVtb3ZlQXR0cmlidXRlTlMobi5zcGFjZSxuLmxvY2FsKTp0aGlzLnNldEF0dHJpYnV0ZU5TKG4uc3BhY2Usbi5sb2NhbCxyKX1yZXR1cm4gbj1Cby5ucy5xdWFsaWZ5KG4pLG51bGw9PXQ/bi5sb2NhbD9lOnI6ImZ1bmN0aW9uIj09dHlwZW9mIHQ/bi5sb2NhbD9hOm86bi5sb2NhbD9pOnV9ZnVuY3Rpb24gayhuKXtyZXR1cm4gbi50cmltKCkucmVwbGFjZSgvXHMrL2csIiAiKX1mdW5jdGlvbiBFKG4pe3JldHVybiBuZXcgUmVnRXhwKCIoPzpefFxccyspIitCby5yZXF1b3RlKG4pKyIoPzpcXHMrfCQpIiwiZyIpfWZ1bmN0aW9uIEEobil7cmV0dXJuIG4udHJpbSgpLnNwbGl0KC9efFxzKy8pfWZ1bmN0aW9uIEMobix0KXtmdW5jdGlvbiByKCl7Zm9yKHZhciByPS0xOysrcjx1OyluW3JdKHRoaXMsdCl9ZnVuY3Rpb24gZSgpe2Zvcih2YXIgcj0tMSxlPXQuYXBwbHkodGhpcyxhcmd1bWVudHMpOysrcjx1OyluW3JdKHRoaXMsZSl9bj1BKG4pLm1hcChOKTt2YXIgdT1uLmxlbmd0aDtyZXR1cm4iZnVuY3Rpb24iPT10eXBlb2YgdD9lOnJ9ZnVuY3Rpb24gTihuKXt2YXIgdD1FKG4pO3JldHVybiBmdW5jdGlvbihyLGUpe2lmKHU9ci5jbGFzc0xpc3QpcmV0dXJuIGU/dS5hZGQobik6dS5yZW1vdmUobik7dmFyIHU9ci5nZXRBdHRyaWJ1dGUoImNsYXNzIil8fCIiO2U/KHQubGFzdEluZGV4PTAsdC50ZXN0KHUpfHxyLnNldEF0dHJpYnV0ZSgiY2xhc3MiLGsodSsiICIrbikpKTpyLnNldEF0dHJpYnV0ZSgiY2xhc3MiLGsodS5yZXBsYWNlKHQsIiAiKSkpfX1mdW5jdGlvbiB6KG4sdCxyKXtmdW5jdGlvbiBlKCl7dGhpcy5zdHlsZS5yZW1vdmVQcm9wZXJ0eShuKX1mdW5jdGlvbiB1KCl7dGhpcy5zdHlsZS5zZXRQcm9wZXJ0eShuLHQscil9ZnVuY3Rpb24gaSgpe3ZhciBlPXQuYXBwbHkodGhpcyxhcmd1bWVudHMpO251bGw9PWU/dGhpcy5zdHlsZS5yZW1vdmVQcm9wZXJ0eShuKTp0aGlzLnN0eWxlLnNldFByb3BlcnR5KG4sZSxyKX1yZXR1cm4gbnVsbD09dD9lOiJmdW5jdGlvbiI9PXR5cGVvZiB0P2k6dX1mdW5jdGlvbiBMKG4sdCl7ZnVuY3Rpb24gcigpe2RlbGV0ZSB0aGlzW25dfWZ1bmN0aW9uIGUoKXt0aGlzW25dPXR9ZnVuY3Rpb24gdSgpe3ZhciByPXQuYXBwbHkodGhpcyxhcmd1bWVudHMpO251bGw9PXI/ZGVsZXRlIHRoaXNbbl06dGhpc1tuXT1yfXJldHVybiBudWxsPT10P3I6ImZ1bmN0aW9uIj09dHlwZW9mIHQ/dTplfWZ1bmN0aW9uIFQobil7cmV0dXJuImZ1bmN0aW9uIj09dHlwZW9mIG4/bjoobj1Cby5ucy5xdWFsaWZ5KG4pKS5sb2NhbD9mdW5jdGlvbigpe3JldHVybiB0aGlzLm93bmVyRG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKG4uc3BhY2Usbi5sb2NhbCl9OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMub3duZXJEb2N1bWVudC5jcmVhdGVFbGVtZW50TlModGhpcy5uYW1lc3BhY2VVUkksbil9fWZ1bmN0aW9uIHEobil7cmV0dXJue19fZGF0YV9fOm59fWZ1bmN0aW9uIFIobil7cmV0dXJuIGZ1bmN0aW9uKCl7cmV0dXJuIG1hKHRoaXMsbil9fWZ1bmN0aW9uIEQodCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGh8fCh0PW4pLGZ1bmN0aW9uKG4scil7cmV0dXJuIG4mJnI/dChuLl9fZGF0YV9fLHIuX19kYXRhX18pOiFuLSFyfX1mdW5jdGlvbiBQKG4sdCl7Zm9yKHZhciByPTAsZT1uLmxlbmd0aDtlPnI7cisrKWZvcih2YXIgdSxpPW5bcl0sbz0wLGE9aS5sZW5ndGg7YT5vO28rKykodT1pW29dKSYmdCh1LG8scik7cmV0dXJuIG59ZnVuY3Rpb24gVShuKXtyZXR1cm4gZ2EobixNYSksbn1mdW5jdGlvbiBqKG4pe3ZhciB0LHI7cmV0dXJuIGZ1bmN0aW9uKGUsdSxpKXt2YXIgbyxhPW5baV0udXBkYXRlLGM9YS5sZW5ndGg7Zm9yKGkhPXImJihyPWksdD0wKSx1Pj10JiYodD11KzEpOyEobz1hW3RdKSYmKyt0PGM7KTtyZXR1cm4gb319ZnVuY3Rpb24gSCgpe3ZhciBuPXRoaXMuX190cmFuc2l0aW9uX187biYmKytuLmFjdGl2ZX1mdW5jdGlvbiBGKG4sdCxyKXtmdW5jdGlvbiBlKCl7dmFyIHQ9dGhpc1tvXTt0JiYodGhpcy5yZW1vdmVFdmVudExpc3RlbmVyKG4sdCx0LiQpLGRlbGV0ZSB0aGlzW29dKX1mdW5jdGlvbiB1KCl7dmFyIHU9Yyh0LFdvKGFyZ3VtZW50cykpO2UuY2FsbCh0aGlzKSx0aGlzLmFkZEV2ZW50TGlzdGVuZXIobix0aGlzW29dPXUsdS4kPXIpLHUuXz10fWZ1bmN0aW9uIGkoKXt2YXIgdCxyPW5ldyBSZWdFeHAoIl5fX29uKFteLl0rKSIrQm8ucmVxdW90ZShuKSsiJCIpO2Zvcih2YXIgZSBpbiB0aGlzKWlmKHQ9ZS5tYXRjaChyKSl7dmFyIHU9dGhpc1tlXTt0aGlzLnJlbW92ZUV2ZW50TGlzdGVuZXIodFsxXSx1LHUuJCksZGVsZXRlIHRoaXNbZV19fXZhciBvPSJfX29uIituLGE9bi5pbmRleE9mKCIuIiksYz1PO2E+MCYmKG49bi5zdWJzdHJpbmcoMCxhKSk7dmFyIHM9YmEuZ2V0KG4pO3JldHVybiBzJiYobj1zLGM9SSksYT90P3U6ZTp0P3Y6aX1mdW5jdGlvbiBPKG4sdCl7cmV0dXJuIGZ1bmN0aW9uKHIpe3ZhciBlPUJvLmV2ZW50O0JvLmV2ZW50PXIsdFswXT10aGlzLl9fZGF0YV9fO3RyeXtuLmFwcGx5KHRoaXMsdCl9ZmluYWxseXtCby5ldmVudD1lfX19ZnVuY3Rpb24gSShuLHQpe3ZhciByPU8obix0KTtyZXR1cm4gZnVuY3Rpb24obil7dmFyIHQ9dGhpcyxlPW4ucmVsYXRlZFRhcmdldDtlJiYoZT09PXR8fDgmZS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbih0KSl8fHIuY2FsbCh0LG4pfX1mdW5jdGlvbiBZKCl7dmFyIG49Ii5kcmFnc3VwcHJlc3MtIisgKytTYSx0PSJjbGljayIrbixyPUJvLnNlbGVjdChRbykub24oInRvdWNobW92ZSIrbix5KS5vbigiZHJhZ3N0YXJ0IituLHkpLm9uKCJzZWxlY3RzdGFydCIrbix5KTtpZih3YSl7dmFyIGU9S28uc3R5bGUsdT1lW3dhXTtlW3dhXT0ibm9uZSJ9cmV0dXJuIGZ1bmN0aW9uKGkpe2Z1bmN0aW9uIG8oKXtyLm9uKHQsbnVsbCl9ci5vbihuLG51bGwpLHdhJiYoZVt3YV09dSksaSYmKHIub24odCxmdW5jdGlvbigpe3koKSxvKCl9LCEwKSxzZXRUaW1lb3V0KG8sMCkpfX1mdW5jdGlvbiBaKG4sdCl7dC5jaGFuZ2VkVG91Y2hlcyYmKHQ9dC5jaGFuZ2VkVG91Y2hlc1swXSk7dmFyIHI9bi5vd25lclNWR0VsZW1lbnR8fG47aWYoci5jcmVhdGVTVkdQb2ludCl7dmFyIGU9ci5jcmVhdGVTVkdQb2ludCgpO3JldHVybiBlLng9dC5jbGllbnRYLGUueT10LmNsaWVudFksZT1lLm1hdHJpeFRyYW5zZm9ybShuLmdldFNjcmVlbkNUTSgpLmludmVyc2UoKSksW2UueCxlLnldfXZhciB1PW4uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7cmV0dXJuW3QuY2xpZW50WC11LmxlZnQtbi5jbGllbnRMZWZ0LHQuY2xpZW50WS11LnRvcC1uLmNsaWVudFRvcF19ZnVuY3Rpb24gVigpe3JldHVybiBCby5ldmVudC5jaGFuZ2VkVG91Y2hlc1swXS5pZGVudGlmaWVyfWZ1bmN0aW9uICQoKXtyZXR1cm4gQm8uZXZlbnQudGFyZ2V0fWZ1bmN0aW9uIFgoKXtyZXR1cm4gUW99ZnVuY3Rpb24gQihuKXtyZXR1cm4gbj4wPzE6MD5uPy0xOjB9ZnVuY3Rpb24gSihuLHQscil7cmV0dXJuKHRbMF0tblswXSkqKHJbMV0tblsxXSktKHRbMV0tblsxXSkqKHJbMF0tblswXSl9ZnVuY3Rpb24gVyhuKXtyZXR1cm4gbj4xPzA6LTE+bj9rYTpNYXRoLmFjb3Mobil9ZnVuY3Rpb24gRyhuKXtyZXR1cm4gbj4xP0FhOi0xPm4/LUFhOk1hdGguYXNpbihuKX1mdW5jdGlvbiBLKG4pe3JldHVybigobj1NYXRoLmV4cChuKSktMS9uKS8yfWZ1bmN0aW9uIFEobil7cmV0dXJuKChuPU1hdGguZXhwKG4pKSsxL24pLzJ9ZnVuY3Rpb24gbnQobil7cmV0dXJuKChuPU1hdGguZXhwKDIqbikpLTEpLyhuKzEpfWZ1bmN0aW9uIHR0KG4pe3JldHVybihuPU1hdGguc2luKG4vMikpKm59ZnVuY3Rpb24gcnQoKXt9ZnVuY3Rpb24gZXQobix0LHIpe3JldHVybiBuZXcgdXQobix0LHIpfWZ1bmN0aW9uIHV0KG4sdCxyKXt0aGlzLmg9bix0aGlzLnM9dCx0aGlzLmw9cn1mdW5jdGlvbiBpdChuLHQscil7ZnVuY3Rpb24gZShuKXtyZXR1cm4gbj4zNjA/bi09MzYwOjA+biYmKG4rPTM2MCksNjA+bj9pKyhvLWkpKm4vNjA6MTgwPm4/bzoyNDA+bj9pKyhvLWkpKigyNDAtbikvNjA6aX1mdW5jdGlvbiB1KG4pe3JldHVybiBNYXRoLnJvdW5kKDI1NSplKG4pKX12YXIgaSxvO3JldHVybiBuPWlzTmFOKG4pPzA6KG4lPTM2MCk8MD9uKzM2MDpuLHQ9aXNOYU4odCk/MDowPnQ/MDp0PjE/MTp0LHI9MD5yPzA6cj4xPzE6cixvPS41Pj1yP3IqKDErdCk6cit0LXIqdCxpPTIqci1vLHl0KHUobisxMjApLHUobiksdShuLTEyMCkpfWZ1bmN0aW9uIG90KG4sdCxyKXtyZXR1cm4gbmV3IGF0KG4sdCxyKX1mdW5jdGlvbiBhdChuLHQscil7dGhpcy5oPW4sdGhpcy5jPXQsdGhpcy5sPXJ9ZnVuY3Rpb24gY3Qobix0LHIpe3JldHVybiBpc05hTihuKSYmKG49MCksaXNOYU4odCkmJih0PTApLHN0KHIsTWF0aC5jb3Mobio9emEpKnQsTWF0aC5zaW4obikqdCl9ZnVuY3Rpb24gc3Qobix0LHIpe3JldHVybiBuZXcgbHQobix0LHIpfWZ1bmN0aW9uIGx0KG4sdCxyKXt0aGlzLmw9bix0aGlzLmE9dCx0aGlzLmI9cn1mdW5jdGlvbiBmdChuLHQscil7dmFyIGU9KG4rMTYpLzExNix1PWUrdC81MDAsaT1lLXIvMjAwO3JldHVybiB1PWd0KHUpKk9hLGU9Z3QoZSkqSWEsaT1ndChpKSpZYSx5dCh2dCgzLjI0MDQ1NDIqdS0xLjUzNzEzODUqZS0uNDk4NTMxNCppKSx2dCgtLjk2OTI2Nip1KzEuODc2MDEwOCplKy4wNDE1NTYqaSksdnQoLjA1NTY0MzQqdS0uMjA0MDI1OSplKzEuMDU3MjI1MippKSl9ZnVuY3Rpb24gaHQobix0LHIpe3JldHVybiBuPjA/b3QoTWF0aC5hdGFuMihyLHQpKkxhLE1hdGguc3FydCh0KnQrcipyKSxuKTpvdCgwLzAsMC8wLG4pfWZ1bmN0aW9uIGd0KG4pe3JldHVybiBuPi4yMDY4OTMwMzQ/bipuKm46KG4tNC8yOSkvNy43ODcwMzd9ZnVuY3Rpb24gcHQobil7cmV0dXJuIG4+LjAwODg1Nj9NYXRoLnBvdyhuLDEvMyk6Ny43ODcwMzcqbis0LzI5fWZ1bmN0aW9uIHZ0KG4pe3JldHVybiBNYXRoLnJvdW5kKDI1NSooLjAwMzA0Pj1uPzEyLjkyKm46MS4wNTUqTWF0aC5wb3cobiwxLzIuNCktLjA1NSkpfWZ1bmN0aW9uIGR0KG4pe3JldHVybiB5dChuPj4xNiwyNTUmbj4+OCwyNTUmbil9ZnVuY3Rpb24gbXQobil7cmV0dXJuIGR0KG4pKyIifWZ1bmN0aW9uIHl0KG4sdCxyKXtyZXR1cm4gbmV3IHh0KG4sdCxyKX1mdW5jdGlvbiB4dChuLHQscil7dGhpcy5yPW4sdGhpcy5nPXQsdGhpcy5iPXJ9ZnVuY3Rpb24gTXQobil7cmV0dXJuIDE2Pm4/IjAiK01hdGgubWF4KDAsbikudG9TdHJpbmcoMTYpOk1hdGgubWluKDI1NSxuKS50b1N0cmluZygxNil9ZnVuY3Rpb24gX3Qobix0LHIpe3ZhciBlLHUsaSxvPTAsYT0wLGM9MDtpZihlPS8oW2Etel0rKVwoKC4qKVwpL2kuZXhlYyhuKSlzd2l0Y2godT1lWzJdLnNwbGl0KCIsIiksZVsxXSl7Y2FzZSJoc2wiOnJldHVybiByKHBhcnNlRmxvYXQodVswXSkscGFyc2VGbG9hdCh1WzFdKS8xMDAscGFyc2VGbG9hdCh1WzJdKS8xMDApO2Nhc2UicmdiIjpyZXR1cm4gdChrdCh1WzBdKSxrdCh1WzFdKSxrdCh1WzJdKSl9cmV0dXJuKGk9JGEuZ2V0KG4pKT90KGkucixpLmcsaS5iKToobnVsbD09bnx8IiMiIT09bi5jaGFyQXQoMCl8fGlzTmFOKGk9cGFyc2VJbnQobi5zdWJzdHJpbmcoMSksMTYpKXx8KDQ9PT1uLmxlbmd0aD8obz0oMzg0MCZpKT4+NCxvPW8+PjR8byxhPTI0MCZpLGE9YT4+NHxhLGM9MTUmaSxjPWM8PDR8Yyk6Nz09PW4ubGVuZ3RoJiYobz0oMTY3MTE2ODAmaSk+PjE2LGE9KDY1MjgwJmkpPj44LGM9MjU1JmkpKSx0KG8sYSxjKSl9ZnVuY3Rpb24gYnQobix0LHIpe3ZhciBlLHUsaT1NYXRoLm1pbihuLz0yNTUsdC89MjU1LHIvPTI1NSksbz1NYXRoLm1heChuLHQsciksYT1vLWksYz0obytpKS8yO3JldHVybiBhPyh1PS41PmM/YS8obytpKTphLygyLW8taSksZT1uPT1vPyh0LXIpL2ErKHI+dD82OjApOnQ9PW8/KHItbikvYSsyOihuLXQpL2ErNCxlKj02MCk6KGU9MC8wLHU9Yz4wJiYxPmM/MDplKSxldChlLHUsYyl9ZnVuY3Rpb24gd3Qobix0LHIpe249U3QobiksdD1TdCh0KSxyPVN0KHIpO3ZhciBlPXB0KCguNDEyNDU2NCpuKy4zNTc1NzYxKnQrLjE4MDQzNzUqcikvT2EpLHU9cHQoKC4yMTI2NzI5Km4rLjcxNTE1MjIqdCsuMDcyMTc1KnIpL0lhKSxpPXB0KCguMDE5MzMzOSpuKy4xMTkxOTIqdCsuOTUwMzA0MSpyKS9ZYSk7cmV0dXJuIHN0KDExNip1LTE2LDUwMCooZS11KSwyMDAqKHUtaSkpfWZ1bmN0aW9uIFN0KG4pe3JldHVybihuLz0yNTUpPD0uMDQwNDU/bi8xMi45MjpNYXRoLnBvdygobisuMDU1KS8xLjA1NSwyLjQpfWZ1bmN0aW9uIGt0KG4pe3ZhciB0PXBhcnNlRmxvYXQobik7cmV0dXJuIiUiPT09bi5jaGFyQXQobi5sZW5ndGgtMSk/TWF0aC5yb3VuZCgyLjU1KnQpOnR9ZnVuY3Rpb24gRXQobil7cmV0dXJuImZ1bmN0aW9uIj09dHlwZW9mIG4/bjpmdW5jdGlvbigpe3JldHVybiBufX1mdW5jdGlvbiBBdChuKXtyZXR1cm4gbn1mdW5jdGlvbiBDdChuKXtyZXR1cm4gZnVuY3Rpb24odCxyLGUpe3JldHVybiAyPT09YXJndW1lbnRzLmxlbmd0aCYmImZ1bmN0aW9uIj09dHlwZW9mIHImJihlPXIscj1udWxsKSxOdCh0LHIsbixlKX19ZnVuY3Rpb24gTnQobix0LHIsZSl7ZnVuY3Rpb24gdSgpe3ZhciBuLHQ9Yy5zdGF0dXM7aWYoIXQmJmMucmVzcG9uc2VUZXh0fHx0Pj0yMDAmJjMwMD50fHwzMDQ9PT10KXt0cnl7bj1yLmNhbGwoaSxjKX1jYXRjaChlKXtyZXR1cm4gby5lcnJvci5jYWxsKGksZSksdm9pZCAwfW8ubG9hZC5jYWxsKGksbil9ZWxzZSBvLmVycm9yLmNhbGwoaSxjKX12YXIgaT17fSxvPUJvLmRpc3BhdGNoKCJiZWZvcmVzZW5kIiwicHJvZ3Jlc3MiLCJsb2FkIiwiZXJyb3IiKSxhPXt9LGM9bmV3IFhNTEh0dHBSZXF1ZXN0LHM9bnVsbDtyZXR1cm4hUW8uWERvbWFpblJlcXVlc3R8fCJ3aXRoQ3JlZGVudGlhbHMiaW4gY3x8IS9eKGh0dHAocyk/Oik/XC9cLy8udGVzdChuKXx8KGM9bmV3IFhEb21haW5SZXF1ZXN0KSwib25sb2FkImluIGM/Yy5vbmxvYWQ9Yy5vbmVycm9yPXU6Yy5vbnJlYWR5c3RhdGVjaGFuZ2U9ZnVuY3Rpb24oKXtjLnJlYWR5U3RhdGU+MyYmdSgpfSxjLm9ucHJvZ3Jlc3M9ZnVuY3Rpb24obil7dmFyIHQ9Qm8uZXZlbnQ7Qm8uZXZlbnQ9bjt0cnl7by5wcm9ncmVzcy5jYWxsKGksYyl9ZmluYWxseXtCby5ldmVudD10fX0saS5oZWFkZXI9ZnVuY3Rpb24obix0KXtyZXR1cm4gbj0obisiIikudG9Mb3dlckNhc2UoKSxhcmd1bWVudHMubGVuZ3RoPDI/YVtuXToobnVsbD09dD9kZWxldGUgYVtuXTphW25dPXQrIiIsaSl9LGkubWltZVR5cGU9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHQ9bnVsbD09bj9udWxsOm4rIiIsaSk6dH0saS5yZXNwb25zZVR5cGU9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHM9bixpKTpzfSxpLnJlc3BvbnNlPWZ1bmN0aW9uKG4pe3JldHVybiByPW4saX0sWyJnZXQiLCJwb3N0Il0uZm9yRWFjaChmdW5jdGlvbihuKXtpW25dPWZ1bmN0aW9uKCl7cmV0dXJuIGkuc2VuZC5hcHBseShpLFtuXS5jb25jYXQoV28oYXJndW1lbnRzKSkpfX0pLGkuc2VuZD1mdW5jdGlvbihyLGUsdSl7aWYoMj09PWFyZ3VtZW50cy5sZW5ndGgmJiJmdW5jdGlvbiI9PXR5cGVvZiBlJiYodT1lLGU9bnVsbCksYy5vcGVuKHIsbiwhMCksbnVsbD09dHx8ImFjY2VwdCJpbiBhfHwoYS5hY2NlcHQ9dCsiLCovKiIpLGMuc2V0UmVxdWVzdEhlYWRlcilmb3IodmFyIGwgaW4gYSljLnNldFJlcXVlc3RIZWFkZXIobCxhW2xdKTtyZXR1cm4gbnVsbCE9dCYmYy5vdmVycmlkZU1pbWVUeXBlJiZjLm92ZXJyaWRlTWltZVR5cGUodCksbnVsbCE9cyYmKGMucmVzcG9uc2VUeXBlPXMpLG51bGwhPXUmJmkub24oImVycm9yIix1KS5vbigibG9hZCIsZnVuY3Rpb24obil7dShudWxsLG4pfSksby5iZWZvcmVzZW5kLmNhbGwoaSxjKSxjLnNlbmQobnVsbD09ZT9udWxsOmUpLGl9LGkuYWJvcnQ9ZnVuY3Rpb24oKXtyZXR1cm4gYy5hYm9ydCgpLGl9LEJvLnJlYmluZChpLG8sIm9uIiksbnVsbD09ZT9pOmkuZ2V0KHp0KGUpKX1mdW5jdGlvbiB6dChuKXtyZXR1cm4gMT09PW4ubGVuZ3RoP2Z1bmN0aW9uKHQscil7bihudWxsPT10P3I6bnVsbCl9Om59ZnVuY3Rpb24gTHQoKXt2YXIgbj1UdCgpLHQ9cXQoKS1uO3Q+MjQ/KGlzRmluaXRlKHQpJiYoY2xlYXJUaW1lb3V0KFdhKSxXYT1zZXRUaW1lb3V0KEx0LHQpKSxKYT0wKTooSmE9MSxLYShMdCkpfWZ1bmN0aW9uIFR0KCl7dmFyIG49RGF0ZS5ub3coKTtmb3IoR2E9WGE7R2E7KW4+PUdhLnQmJihHYS5mPUdhLmMobi1HYS50KSksR2E9R2EubjtyZXR1cm4gbn1mdW5jdGlvbiBxdCgpe2Zvcih2YXIgbix0PVhhLHI9MS8wO3Q7KXQuZj90PW4/bi5uPXQubjpYYT10Lm46KHQudDxyJiYocj10LnQpLHQ9KG49dCkubik7cmV0dXJuIEJhPW4scn1mdW5jdGlvbiBSdChuLHQpe3JldHVybiB0LShuP01hdGguY2VpbChNYXRoLmxvZyhuKS9NYXRoLkxOMTApOjEpfWZ1bmN0aW9uIER0KG4sdCl7dmFyIHI9TWF0aC5wb3coMTAsMypjYSg4LXQpKTtyZXR1cm57c2NhbGU6dD44P2Z1bmN0aW9uKG4pe3JldHVybiBuL3J9OmZ1bmN0aW9uKG4pe3JldHVybiBuKnJ9LHN5bWJvbDpufX1mdW5jdGlvbiBQdChuKXt2YXIgdD1uLmRlY2ltYWwscj1uLnRob3VzYW5kcyxlPW4uZ3JvdXBpbmcsdT1uLmN1cnJlbmN5LGk9ZT9mdW5jdGlvbihuKXtmb3IodmFyIHQ9bi5sZW5ndGgsdT1bXSxpPTAsbz1lWzBdO3Q+MCYmbz4wOyl1LnB1c2gobi5zdWJzdHJpbmcodC09byx0K28pKSxvPWVbaT0oaSsxKSVlLmxlbmd0aF07cmV0dXJuIHUucmV2ZXJzZSgpLmpvaW4ocil9OkF0O3JldHVybiBmdW5jdGlvbihuKXt2YXIgcj1uYy5leGVjKG4pLGU9clsxXXx8IiAiLG89clsyXXx8Ij4iLGE9clszXXx8IiIsYz1yWzRdfHwiIixzPXJbNV0sbD0rcls2XSxmPXJbN10saD1yWzhdLGc9cls5XSxwPTEsdj0iIixkPSIiLG09ITE7c3dpdGNoKGgmJihoPStoLnN1YnN0cmluZygxKSksKHN8fCIwIj09PWUmJiI9Ij09PW8pJiYocz1lPSIwIixvPSI9IixmJiYobC09TWF0aC5mbG9vcigobC0xKS80KSkpLGcpe2Nhc2UibiI6Zj0hMCxnPSJnIjticmVhaztjYXNlIiUiOnA9MTAwLGQ9IiUiLGc9ImYiO2JyZWFrO2Nhc2UicCI6cD0xMDAsZD0iJSIsZz0iciI7YnJlYWs7Y2FzZSJiIjpjYXNlIm8iOmNhc2UieCI6Y2FzZSJYIjoiIyI9PT1jJiYodj0iMCIrZy50b0xvd2VyQ2FzZSgpKTtjYXNlImMiOmNhc2UiZCI6bT0hMCxoPTA7YnJlYWs7Y2FzZSJzIjpwPS0xLGc9InIifSIkIj09PWMmJih2PXVbMF0sZD11WzFdKSwiciIhPWd8fGh8fChnPSJnIiksbnVsbCE9aCYmKCJnIj09Zz9oPU1hdGgubWF4KDEsTWF0aC5taW4oMjEsaCkpOigiZSI9PWd8fCJmIj09ZykmJihoPU1hdGgubWF4KDAsTWF0aC5taW4oMjAsaCkpKSksZz10Yy5nZXQoZyl8fFV0O3ZhciB5PXMmJmY7cmV0dXJuIGZ1bmN0aW9uKG4pe3ZhciByPWQ7aWYobSYmbiUxKXJldHVybiIiO3ZhciB1PTA+bnx8MD09PW4mJjA+MS9uPyhuPS1uLCItIik6YTtpZigwPnApe3ZhciBjPUJvLmZvcm1hdFByZWZpeChuLGgpO249Yy5zY2FsZShuKSxyPWMuc3ltYm9sK2R9ZWxzZSBuKj1wO249ZyhuLGgpO3ZhciB4PW4ubGFzdEluZGV4T2YoIi4iKSxNPTA+eD9uOm4uc3Vic3RyaW5nKDAseCksXz0wPng/IiI6dCtuLnN1YnN0cmluZyh4KzEpOyFzJiZmJiYoTT1pKE0pKTt2YXIgYj12Lmxlbmd0aCtNLmxlbmd0aCtfLmxlbmd0aCsoeT8wOnUubGVuZ3RoKSx3PWw+Yj9uZXcgQXJyYXkoYj1sLWIrMSkuam9pbihlKToiIjtyZXR1cm4geSYmKE09aSh3K00pKSx1Kz12LG49TStfLCgiPCI9PT1vP3Urbit3OiI+Ij09PW8/dyt1K246Il4iPT09bz93LnN1YnN0cmluZygwLGI+Pj0xKSt1K24rdy5zdWJzdHJpbmcoYik6dSsoeT9uOncrbikpK3J9fX1mdW5jdGlvbiBVdChuKXtyZXR1cm4gbisiIn1mdW5jdGlvbiBqdCgpe3RoaXMuXz1uZXcgRGF0ZShhcmd1bWVudHMubGVuZ3RoPjE/RGF0ZS5VVEMuYXBwbHkodGhpcyxhcmd1bWVudHMpOmFyZ3VtZW50c1swXSl9ZnVuY3Rpb24gSHQobix0LHIpe2Z1bmN0aW9uIGUodCl7dmFyIHI9bih0KSxlPWkociwxKTtyZXR1cm4gZS10PnQtcj9yOmV9ZnVuY3Rpb24gdShyKXtyZXR1cm4gdChyPW4obmV3IGVjKHItMSkpLDEpLHJ9ZnVuY3Rpb24gaShuLHIpe3JldHVybiB0KG49bmV3IGVjKCtuKSxyKSxufWZ1bmN0aW9uIG8obixlLGkpe3ZhciBvPXUobiksYT1bXTtpZihpPjEpZm9yKDtlPm87KXIobyklaXx8YS5wdXNoKG5ldyBEYXRlKCtvKSksdChvLDEpO2Vsc2UgZm9yKDtlPm87KWEucHVzaChuZXcgRGF0ZSgrbykpLHQobywxKTtyZXR1cm4gYX1mdW5jdGlvbiBhKG4sdCxyKXt0cnl7ZWM9anQ7dmFyIGU9bmV3IGp0O3JldHVybiBlLl89bixvKGUsdCxyKX1maW5hbGx5e2VjPURhdGV9fW4uZmxvb3I9bixuLnJvdW5kPWUsbi5jZWlsPXUsbi5vZmZzZXQ9aSxuLnJhbmdlPW87dmFyIGM9bi51dGM9RnQobik7cmV0dXJuIGMuZmxvb3I9YyxjLnJvdW5kPUZ0KGUpLGMuY2VpbD1GdCh1KSxjLm9mZnNldD1GdChpKSxjLnJhbmdlPWEsbn1mdW5jdGlvbiBGdChuKXtyZXR1cm4gZnVuY3Rpb24odCxyKXt0cnl7ZWM9anQ7dmFyIGU9bmV3IGp0O3JldHVybiBlLl89dCxuKGUscikuX31maW5hbGx5e2VjPURhdGV9fX1mdW5jdGlvbiBPdChuKXtmdW5jdGlvbiB0KG4pe2Z1bmN0aW9uIHQodCl7Zm9yKHZhciByLHUsaSxvPVtdLGE9LTEsYz0wOysrYTxlOykzNz09PW4uY2hhckNvZGVBdChhKSYmKG8ucHVzaChuLnN1YnN0cmluZyhjLGEpKSxudWxsIT0odT1pY1tyPW4uY2hhckF0KCsrYSldKSYmKHI9bi5jaGFyQXQoKythKSksKGk9Q1tyXSkmJihyPWkodCxudWxsPT11PyJlIj09PXI/IiAiOiIwIjp1KSksby5wdXNoKHIpLGM9YSsxKTtyZXR1cm4gby5wdXNoKG4uc3Vic3RyaW5nKGMsYSkpLG8uam9pbigiIil9dmFyIGU9bi5sZW5ndGg7cmV0dXJuIHQucGFyc2U9ZnVuY3Rpb24odCl7dmFyIGU9e3k6MTkwMCxtOjAsZDoxLEg6MCxNOjAsUzowLEw6MCxaOm51bGx9LHU9cihlLG4sdCwwKTtpZih1IT10Lmxlbmd0aClyZXR1cm4gbnVsbDsicCJpbiBlJiYoZS5IPWUuSCUxMisxMiplLnApO3ZhciBpPW51bGwhPWUuWiYmZWMhPT1qdCxvPW5ldyhpP2p0OmVjKTtyZXR1cm4iaiJpbiBlP28uc2V0RnVsbFllYXIoZS55LDAsZS5qKToidyJpbiBlJiYoIlciaW4gZXx8IlUiaW4gZSk/KG8uc2V0RnVsbFllYXIoZS55LDAsMSksby5zZXRGdWxsWWVhcihlLnksMCwiVyJpbiBlPyhlLncrNiklNys3KmUuVy0oby5nZXREYXkoKSs1KSU3OmUudys3KmUuVS0oby5nZXREYXkoKSs2KSU3KSk6by5zZXRGdWxsWWVhcihlLnksZS5tLGUuZCksby5zZXRIb3VycyhlLkgrTWF0aC5mbG9vcihlLlovMTAwKSxlLk0rZS5aJTEwMCxlLlMsZS5MKSxpP28uXzpvfSx0LnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuIG59LHR9ZnVuY3Rpb24gcihuLHQscixlKXtmb3IodmFyIHUsaSxvLGE9MCxjPXQubGVuZ3RoLHM9ci5sZW5ndGg7Yz5hOyl7aWYoZT49cylyZXR1cm4tMTtpZih1PXQuY2hhckNvZGVBdChhKyspLDM3PT09dSl7aWYobz10LmNoYXJBdChhKyspLGk9TltvIGluIGljP3QuY2hhckF0KGErKyk6b10sIWl8fChlPWkobixyLGUpKTwwKXJldHVybi0xfWVsc2UgaWYodSE9ci5jaGFyQ29kZUF0KGUrKykpcmV0dXJuLTF9cmV0dXJuIGV9ZnVuY3Rpb24gZShuLHQscil7Yi5sYXN0SW5kZXg9MDt2YXIgZT1iLmV4ZWModC5zdWJzdHJpbmcocikpO3JldHVybiBlPyhuLnc9dy5nZXQoZVswXS50b0xvd2VyQ2FzZSgpKSxyK2VbMF0ubGVuZ3RoKTotMX1mdW5jdGlvbiB1KG4sdCxyKXtNLmxhc3RJbmRleD0wO3ZhciBlPU0uZXhlYyh0LnN1YnN0cmluZyhyKSk7cmV0dXJuIGU/KG4udz1fLmdldChlWzBdLnRvTG93ZXJDYXNlKCkpLHIrZVswXS5sZW5ndGgpOi0xfWZ1bmN0aW9uIGkobix0LHIpe0UubGFzdEluZGV4PTA7dmFyIGU9RS5leGVjKHQuc3Vic3RyaW5nKHIpKTtyZXR1cm4gZT8obi5tPUEuZ2V0KGVbMF0udG9Mb3dlckNhc2UoKSkscitlWzBdLmxlbmd0aCk6LTF9ZnVuY3Rpb24gbyhuLHQscil7Uy5sYXN0SW5kZXg9MDt2YXIgZT1TLmV4ZWModC5zdWJzdHJpbmcocikpO3JldHVybiBlPyhuLm09ay5nZXQoZVswXS50b0xvd2VyQ2FzZSgpKSxyK2VbMF0ubGVuZ3RoKTotMX1mdW5jdGlvbiBhKG4sdCxlKXtyZXR1cm4gcihuLEMuYy50b1N0cmluZygpLHQsZSl9ZnVuY3Rpb24gYyhuLHQsZSl7cmV0dXJuIHIobixDLngudG9TdHJpbmcoKSx0LGUpfWZ1bmN0aW9uIHMobix0LGUpe3JldHVybiByKG4sQy5YLnRvU3RyaW5nKCksdCxlKX1mdW5jdGlvbiBsKG4sdCxyKXt2YXIgZT14LmdldCh0LnN1YnN0cmluZyhyLHIrPTIpLnRvTG93ZXJDYXNlKCkpO3JldHVybiBudWxsPT1lPy0xOihuLnA9ZSxyKX12YXIgZj1uLmRhdGVUaW1lLGg9bi5kYXRlLGc9bi50aW1lLHA9bi5wZXJpb2RzLHY9bi5kYXlzLGQ9bi5zaG9ydERheXMsbT1uLm1vbnRocyx5PW4uc2hvcnRNb250aHM7dC51dGM9ZnVuY3Rpb24obil7ZnVuY3Rpb24gcihuKXt0cnl7ZWM9anQ7dmFyIHQ9bmV3IGVjO3JldHVybiB0Ll89bixlKHQpfWZpbmFsbHl7ZWM9RGF0ZX19dmFyIGU9dChuKTtyZXR1cm4gci5wYXJzZT1mdW5jdGlvbihuKXt0cnl7ZWM9anQ7dmFyIHQ9ZS5wYXJzZShuKTtyZXR1cm4gdCYmdC5ffWZpbmFsbHl7ZWM9RGF0ZX19LHIudG9TdHJpbmc9ZS50b1N0cmluZyxyfSx0Lm11bHRpPXQudXRjLm11bHRpPWFyO3ZhciB4PUJvLm1hcCgpLE09WXQodiksXz1adCh2KSxiPVl0KGQpLHc9WnQoZCksUz1ZdChtKSxrPVp0KG0pLEU9WXQoeSksQT1adCh5KTtwLmZvckVhY2goZnVuY3Rpb24obix0KXt4LnNldChuLnRvTG93ZXJDYXNlKCksdCl9KTt2YXIgQz17YTpmdW5jdGlvbihuKXtyZXR1cm4gZFtuLmdldERheSgpXX0sQTpmdW5jdGlvbihuKXtyZXR1cm4gdltuLmdldERheSgpXX0sYjpmdW5jdGlvbihuKXtyZXR1cm4geVtuLmdldE1vbnRoKCldfSxCOmZ1bmN0aW9uKG4pe3JldHVybiBtW24uZ2V0TW9udGgoKV19LGM6dChmKSxkOmZ1bmN0aW9uKG4sdCl7cmV0dXJuIEl0KG4uZ2V0RGF0ZSgpLHQsMil9LGU6ZnVuY3Rpb24obix0KXtyZXR1cm4gSXQobi5nZXREYXRlKCksdCwyKX0sSDpmdW5jdGlvbihuLHQpe3JldHVybiBJdChuLmdldEhvdXJzKCksdCwyKX0sSTpmdW5jdGlvbihuLHQpe3JldHVybiBJdChuLmdldEhvdXJzKCklMTJ8fDEyLHQsMil9LGo6ZnVuY3Rpb24obix0KXtyZXR1cm4gSXQoMStyYy5kYXlPZlllYXIobiksdCwzKX0sTDpmdW5jdGlvbihuLHQpe3JldHVybiBJdChuLmdldE1pbGxpc2Vjb25kcygpLHQsMyl9LG06ZnVuY3Rpb24obix0KXtyZXR1cm4gSXQobi5nZXRNb250aCgpKzEsdCwyKX0sTTpmdW5jdGlvbihuLHQpe3JldHVybiBJdChuLmdldE1pbnV0ZXMoKSx0LDIpfSxwOmZ1bmN0aW9uKG4pe3JldHVybiBwWysobi5nZXRIb3VycygpPj0xMildfSxTOmZ1bmN0aW9uKG4sdCl7cmV0dXJuIEl0KG4uZ2V0U2Vjb25kcygpLHQsMil9LFU6ZnVuY3Rpb24obix0KXtyZXR1cm4gSXQocmMuc3VuZGF5T2ZZZWFyKG4pLHQsMil9LHc6ZnVuY3Rpb24obil7cmV0dXJuIG4uZ2V0RGF5KCl9LFc6ZnVuY3Rpb24obix0KXtyZXR1cm4gSXQocmMubW9uZGF5T2ZZZWFyKG4pLHQsMil9LHg6dChoKSxYOnQoZykseTpmdW5jdGlvbihuLHQpe3JldHVybiBJdChuLmdldEZ1bGxZZWFyKCklMTAwLHQsMil9LFk6ZnVuY3Rpb24obix0KXtyZXR1cm4gSXQobi5nZXRGdWxsWWVhcigpJTFlNCx0LDQpfSxaOmlyLCIlIjpmdW5jdGlvbigpe3JldHVybiIlIn19LE49e2E6ZSxBOnUsYjppLEI6byxjOmEsZDpRdCxlOlF0LEg6dHIsSTp0cixqOm5yLEw6dXIsbTpLdCxNOnJyLHA6bCxTOmVyLFU6JHQsdzpWdCxXOlh0LHg6YyxYOnMseTpKdCxZOkJ0LFo6V3QsIiUiOm9yfTtyZXR1cm4gdH1mdW5jdGlvbiBJdChuLHQscil7dmFyIGU9MD5uPyItIjoiIix1PShlPy1uOm4pKyIiLGk9dS5sZW5ndGg7cmV0dXJuIGUrKHI+aT9uZXcgQXJyYXkoci1pKzEpLmpvaW4odCkrdTp1KX1mdW5jdGlvbiBZdChuKXtyZXR1cm4gbmV3IFJlZ0V4cCgiXig/OiIrbi5tYXAoQm8ucmVxdW90ZSkuam9pbigifCIpKyIpIiwiaSIpfWZ1bmN0aW9uIFp0KG4pe2Zvcih2YXIgdD1uZXcgbyxyPS0xLGU9bi5sZW5ndGg7KytyPGU7KXQuc2V0KG5bcl0udG9Mb3dlckNhc2UoKSxyKTtyZXR1cm4gdH1mdW5jdGlvbiBWdChuLHQscil7b2MubGFzdEluZGV4PTA7dmFyIGU9b2MuZXhlYyh0LnN1YnN0cmluZyhyLHIrMSkpO3JldHVybiBlPyhuLnc9K2VbMF0scitlWzBdLmxlbmd0aCk6LTF9ZnVuY3Rpb24gJHQobix0LHIpe29jLmxhc3RJbmRleD0wO3ZhciBlPW9jLmV4ZWModC5zdWJzdHJpbmcocikpO3JldHVybiBlPyhuLlU9K2VbMF0scitlWzBdLmxlbmd0aCk6LTF9ZnVuY3Rpb24gWHQobix0LHIpe29jLmxhc3RJbmRleD0wO3ZhciBlPW9jLmV4ZWModC5zdWJzdHJpbmcocikpO3JldHVybiBlPyhuLlc9K2VbMF0scitlWzBdLmxlbmd0aCk6LTF9ZnVuY3Rpb24gQnQobix0LHIpe29jLmxhc3RJbmRleD0wO3ZhciBlPW9jLmV4ZWModC5zdWJzdHJpbmcocixyKzQpKTtyZXR1cm4gZT8obi55PStlWzBdLHIrZVswXS5sZW5ndGgpOi0xfWZ1bmN0aW9uIEp0KG4sdCxyKXtvYy5sYXN0SW5kZXg9MDt2YXIgZT1vYy5leGVjKHQuc3Vic3RyaW5nKHIscisyKSk7cmV0dXJuIGU/KG4ueT1HdCgrZVswXSkscitlWzBdLmxlbmd0aCk6LTF9ZnVuY3Rpb24gV3Qobix0LHIpe3JldHVybi9eWystXVxkezR9JC8udGVzdCh0PXQuc3Vic3RyaW5nKHIscis1KSk/KG4uWj0tdCxyKzUpOi0xfWZ1bmN0aW9uIEd0KG4pe3JldHVybiBuKyhuPjY4PzE5MDA6MmUzKX1mdW5jdGlvbiBLdChuLHQscil7b2MubGFzdEluZGV4PTA7dmFyIGU9b2MuZXhlYyh0LnN1YnN0cmluZyhyLHIrMikpO3JldHVybiBlPyhuLm09ZVswXS0xLHIrZVswXS5sZW5ndGgpOi0xfWZ1bmN0aW9uIFF0KG4sdCxyKXtvYy5sYXN0SW5kZXg9MDt2YXIgZT1vYy5leGVjKHQuc3Vic3RyaW5nKHIscisyKSk7cmV0dXJuIGU/KG4uZD0rZVswXSxyK2VbMF0ubGVuZ3RoKTotMX1mdW5jdGlvbiBucihuLHQscil7b2MubGFzdEluZGV4PTA7dmFyIGU9b2MuZXhlYyh0LnN1YnN0cmluZyhyLHIrMykpO3JldHVybiBlPyhuLmo9K2VbMF0scitlWzBdLmxlbmd0aCk6LTF9ZnVuY3Rpb24gdHIobix0LHIpe29jLmxhc3RJbmRleD0wO3ZhciBlPW9jLmV4ZWModC5zdWJzdHJpbmcocixyKzIpKTtyZXR1cm4gZT8obi5IPStlWzBdLHIrZVswXS5sZW5ndGgpOi0xfWZ1bmN0aW9uIHJyKG4sdCxyKXtvYy5sYXN0SW5kZXg9MDt2YXIgZT1vYy5leGVjKHQuc3Vic3RyaW5nKHIscisyKSk7cmV0dXJuIGU/KG4uTT0rZVswXSxyK2VbMF0ubGVuZ3RoKTotMX1mdW5jdGlvbiBlcihuLHQscil7b2MubGFzdEluZGV4PTA7dmFyIGU9b2MuZXhlYyh0LnN1YnN0cmluZyhyLHIrMikpO3JldHVybiBlPyhuLlM9K2VbMF0scitlWzBdLmxlbmd0aCk6LTF9ZnVuY3Rpb24gdXIobix0LHIpe29jLmxhc3RJbmRleD0wO3ZhciBlPW9jLmV4ZWModC5zdWJzdHJpbmcocixyKzMpKTtyZXR1cm4gZT8obi5MPStlWzBdLHIrZVswXS5sZW5ndGgpOi0xfWZ1bmN0aW9uIGlyKG4pe3ZhciB0PW4uZ2V0VGltZXpvbmVPZmZzZXQoKSxyPXQ+MD8iLSI6IisiLGU9fn4oY2EodCkvNjApLHU9Y2EodCklNjA7cmV0dXJuIHIrSXQoZSwiMCIsMikrSXQodSwiMCIsMil9ZnVuY3Rpb24gb3Iobix0LHIpe2FjLmxhc3RJbmRleD0wO3ZhciBlPWFjLmV4ZWModC5zdWJzdHJpbmcocixyKzEpKTtyZXR1cm4gZT9yK2VbMF0ubGVuZ3RoOi0xfWZ1bmN0aW9uIGFyKG4pe2Zvcih2YXIgdD1uLmxlbmd0aCxyPS0xOysrcjx0OyluW3JdWzBdPXRoaXMobltyXVswXSk7cmV0dXJuIGZ1bmN0aW9uKHQpe2Zvcih2YXIgcj0wLGU9bltyXTshZVsxXSh0KTspZT1uWysrcl07cmV0dXJuIGVbMF0odCl9fWZ1bmN0aW9uIGNyKCl7fWZ1bmN0aW9uIHNyKG4sdCxyKXt2YXIgZT1yLnM9bit0LHU9ZS1uLGk9ZS11O3IudD1uLWkrKHQtdSl9ZnVuY3Rpb24gbHIobix0KXtuJiZmYy5oYXNPd25Qcm9wZXJ0eShuLnR5cGUpJiZmY1tuLnR5cGVdKG4sdCl9ZnVuY3Rpb24gZnIobix0LHIpe3ZhciBlLHU9LTEsaT1uLmxlbmd0aC1yO2Zvcih0LmxpbmVTdGFydCgpOysrdTxpOyllPW5bdV0sdC5wb2ludChlWzBdLGVbMV0sZVsyXSk7dC5saW5lRW5kKCl9ZnVuY3Rpb24gaHIobix0KXt2YXIgcj0tMSxlPW4ubGVuZ3RoO2Zvcih0LnBvbHlnb25TdGFydCgpOysrcjxlOylmcihuW3JdLHQsMSk7dC5wb2x5Z29uRW5kKCl9ZnVuY3Rpb24gZ3IoKXtmdW5jdGlvbiBuKG4sdCl7bio9emEsdD10KnphLzIra2EvNDt2YXIgcj1uLWUsbz1yPj0wPzE6LTEsYT1vKnIsYz1NYXRoLmNvcyh0KSxzPU1hdGguc2luKHQpLGw9aSpzLGY9dSpjK2wqTWF0aC5jb3MoYSksaD1sKm8qTWF0aC5zaW4oYSk7Z2MuYWRkKE1hdGguYXRhbjIoaCxmKSksZT1uLHU9YyxpPXN9dmFyIHQscixlLHUsaTtwYy5wb2ludD1mdW5jdGlvbihvLGEpe3BjLnBvaW50PW4sZT0odD1vKSp6YSx1PU1hdGguY29zKGE9KHI9YSkqemEvMitrYS80KSxpPU1hdGguc2luKGEpfSxwYy5saW5lRW5kPWZ1bmN0aW9uKCl7bih0LHIpfX1mdW5jdGlvbiBwcihuKXt2YXIgdD1uWzBdLHI9blsxXSxlPU1hdGguY29zKHIpO3JldHVybltlKk1hdGguY29zKHQpLGUqTWF0aC5zaW4odCksTWF0aC5zaW4ocildfWZ1bmN0aW9uIHZyKG4sdCl7cmV0dXJuIG5bMF0qdFswXStuWzFdKnRbMV0rblsyXSp0WzJdfWZ1bmN0aW9uIGRyKG4sdCl7cmV0dXJuW25bMV0qdFsyXS1uWzJdKnRbMV0sblsyXSp0WzBdLW5bMF0qdFsyXSxuWzBdKnRbMV0tblsxXSp0WzBdXX1mdW5jdGlvbiBtcihuLHQpe25bMF0rPXRbMF0sblsxXSs9dFsxXSxuWzJdKz10WzJdfWZ1bmN0aW9uIHlyKG4sdCl7cmV0dXJuW25bMF0qdCxuWzFdKnQsblsyXSp0XX1mdW5jdGlvbiB4cihuKXt2YXIgdD1NYXRoLnNxcnQoblswXSpuWzBdK25bMV0qblsxXStuWzJdKm5bMl0pO25bMF0vPXQsblsxXS89dCxuWzJdLz10fWZ1bmN0aW9uIE1yKG4pe3JldHVybltNYXRoLmF0YW4yKG5bMV0sblswXSksRyhuWzJdKV19ZnVuY3Rpb24gX3Iobix0KXtyZXR1cm4gY2EoblswXS10WzBdKTxDYSYmY2EoblsxXS10WzFdKTxDYX1mdW5jdGlvbiBicihuLHQpe24qPXphO3ZhciByPU1hdGguY29zKHQqPXphKTt3cihyKk1hdGguY29zKG4pLHIqTWF0aC5zaW4obiksTWF0aC5zaW4odCkpfWZ1bmN0aW9uIHdyKG4sdCxyKXsrK3ZjLG1jKz0obi1tYykvdmMseWMrPSh0LXljKS92Yyx4Yys9KHIteGMpL3ZjfWZ1bmN0aW9uIFNyKCl7ZnVuY3Rpb24gbihuLHUpe24qPXphO3ZhciBpPU1hdGguY29zKHUqPXphKSxvPWkqTWF0aC5jb3MobiksYT1pKk1hdGguc2luKG4pLGM9TWF0aC5zaW4odSkscz1NYXRoLmF0YW4yKE1hdGguc3FydCgocz1yKmMtZSphKSpzKyhzPWUqby10KmMpKnMrKHM9dCphLXIqbykqcyksdCpvK3IqYStlKmMpO2RjKz1zLE1jKz1zKih0Kyh0PW8pKSxfYys9cyoocisocj1hKSksYmMrPXMqKGUrKGU9YykpLHdyKHQscixlKX12YXIgdCxyLGU7RWMucG9pbnQ9ZnVuY3Rpb24odSxpKXt1Kj16YTt2YXIgbz1NYXRoLmNvcyhpKj16YSk7dD1vKk1hdGguY29zKHUpLHI9bypNYXRoLnNpbih1KSxlPU1hdGguc2luKGkpLEVjLnBvaW50PW4sd3IodCxyLGUpfX1mdW5jdGlvbiBrcigpe0VjLnBvaW50PWJyfWZ1bmN0aW9uIEVyKCl7ZnVuY3Rpb24gbihuLHQpe24qPXphO3ZhciByPU1hdGguY29zKHQqPXphKSxvPXIqTWF0aC5jb3MobiksYT1yKk1hdGguc2luKG4pLGM9TWF0aC5zaW4odCkscz11KmMtaSphLGw9aSpvLWUqYyxmPWUqYS11Km8saD1NYXRoLnNxcnQocypzK2wqbCtmKmYpLGc9ZSpvK3UqYStpKmMscD1oJiYtVyhnKS9oLHY9TWF0aC5hdGFuMihoLGcpO3djKz1wKnMsU2MrPXAqbCxrYys9cCpmLGRjKz12LE1jKz12KihlKyhlPW8pKSxfYys9dioodSsodT1hKSksYmMrPXYqKGkrKGk9YykpLHdyKGUsdSxpKX12YXIgdCxyLGUsdSxpO0VjLnBvaW50PWZ1bmN0aW9uKG8sYSl7dD1vLHI9YSxFYy5wb2ludD1uLG8qPXphO3ZhciBjPU1hdGguY29zKGEqPXphKTtlPWMqTWF0aC5jb3MobyksdT1jKk1hdGguc2luKG8pLGk9TWF0aC5zaW4oYSksd3IoZSx1LGkpfSxFYy5saW5lRW5kPWZ1bmN0aW9uKCl7bih0LHIpLEVjLmxpbmVFbmQ9a3IsRWMucG9pbnQ9YnJ9fWZ1bmN0aW9uIEFyKCl7cmV0dXJuITB9ZnVuY3Rpb24gQ3Iobix0LHIsZSx1KXt2YXIgaT1bXSxvPVtdO2lmKG4uZm9yRWFjaChmdW5jdGlvbihuKXtpZighKCh0PW4ubGVuZ3RoLTEpPD0wKSl7dmFyIHQscj1uWzBdLGU9blt0XTtpZihfcihyLGUpKXt1LmxpbmVTdGFydCgpO2Zvcih2YXIgYT0wO3Q+YTsrK2EpdS5wb2ludCgocj1uW2FdKVswXSxyWzFdKTtyZXR1cm4gdS5saW5lRW5kKCksdm9pZCAwfXZhciBjPW5ldyB6cihyLG4sbnVsbCwhMCkscz1uZXcgenIocixudWxsLGMsITEpO2Mubz1zLGkucHVzaChjKSxvLnB1c2gocyksYz1uZXcgenIoZSxuLG51bGwsITEpLHM9bmV3IHpyKGUsbnVsbCxjLCEwKSxjLm89cyxpLnB1c2goYyksby5wdXNoKHMpfX0pLG8uc29ydCh0KSxOcihpKSxOcihvKSxpLmxlbmd0aCl7Zm9yKHZhciBhPTAsYz1yLHM9by5sZW5ndGg7cz5hOysrYSlvW2FdLmU9Yz0hYztmb3IodmFyIGwsZixoPWlbMF07Oyl7Zm9yKHZhciBnPWgscD0hMDtnLnY7KWlmKChnPWcubik9PT1oKXJldHVybjtsPWcueix1LmxpbmVTdGFydCgpO2Rve2lmKGcudj1nLm8udj0hMCxnLmUpe2lmKHApZm9yKHZhciBhPTAscz1sLmxlbmd0aDtzPmE7KythKXUucG9pbnQoKGY9bFthXSlbMF0sZlsxXSk7ZWxzZSBlKGcueCxnLm4ueCwxLHUpO2c9Zy5ufWVsc2V7aWYocCl7bD1nLnAuejtmb3IodmFyIGE9bC5sZW5ndGgtMTthPj0wOy0tYSl1LnBvaW50KChmPWxbYV0pWzBdLGZbMV0pfWVsc2UgZShnLngsZy5wLngsLTEsdSk7Zz1nLnB9Zz1nLm8sbD1nLnoscD0hcH13aGlsZSghZy52KTt1LmxpbmVFbmQoKX19fWZ1bmN0aW9uIE5yKG4pe2lmKHQ9bi5sZW5ndGgpe2Zvcih2YXIgdCxyLGU9MCx1PW5bMF07KytlPHQ7KXUubj1yPW5bZV0sci5wPXUsdT1yO3Uubj1yPW5bMF0sci5wPXV9fWZ1bmN0aW9uIHpyKG4sdCxyLGUpe3RoaXMueD1uLHRoaXMuej10LHRoaXMubz1yLHRoaXMuZT1lLHRoaXMudj0hMSx0aGlzLm49dGhpcy5wPW51bGx9ZnVuY3Rpb24gTHIobix0LHIsZSl7cmV0dXJuIGZ1bmN0aW9uKHUsaSl7ZnVuY3Rpb24gbyh0LHIpe3ZhciBlPXUodCxyKTtuKHQ9ZVswXSxyPWVbMV0pJiZpLnBvaW50KHQscil9ZnVuY3Rpb24gYShuLHQpe3ZhciByPXUobix0KTtkLnBvaW50KHJbMF0sclsxXSl9ZnVuY3Rpb24gYygpe3kucG9pbnQ9YSxkLmxpbmVTdGFydCgpfWZ1bmN0aW9uIHMoKXt5LnBvaW50PW8sZC5saW5lRW5kKCl9ZnVuY3Rpb24gbChuLHQpe3YucHVzaChbbix0XSk7dmFyIHI9dShuLHQpO00ucG9pbnQoclswXSxyWzFdKX1mdW5jdGlvbiBmKCl7TS5saW5lU3RhcnQoKSx2PVtdfWZ1bmN0aW9uIGgoKXtsKHZbMF1bMF0sdlswXVsxXSksTS5saW5lRW5kKCk7dmFyIG4sdD1NLmNsZWFuKCkscj14LmJ1ZmZlcigpLGU9ci5sZW5ndGg7aWYodi5wb3AoKSxwLnB1c2godiksdj1udWxsLGUpaWYoMSZ0KXtuPXJbMF07dmFyIHUsZT1uLmxlbmd0aC0xLG89LTE7aWYoZT4wKXtmb3IoX3x8KGkucG9seWdvblN0YXJ0KCksXz0hMCksaS5saW5lU3RhcnQoKTsrK288ZTspaS5wb2ludCgodT1uW29dKVswXSx1WzFdKTtpLmxpbmVFbmQoKX19ZWxzZSBlPjEmJjImdCYmci5wdXNoKHIucG9wKCkuY29uY2F0KHIuc2hpZnQoKSkpLGcucHVzaChyLmZpbHRlcihUcikpfXZhciBnLHAsdixkPXQoaSksbT11LmludmVydChlWzBdLGVbMV0pLHk9e3BvaW50Om8sbGluZVN0YXJ0OmMsbGluZUVuZDpzLHBvbHlnb25TdGFydDpmdW5jdGlvbigpe3kucG9pbnQ9bCx5LmxpbmVTdGFydD1mLHkubGluZUVuZD1oLGc9W10scD1bXX0scG9seWdvbkVuZDpmdW5jdGlvbigpe3kucG9pbnQ9byx5LmxpbmVTdGFydD1jLHkubGluZUVuZD1zLGc9Qm8ubWVyZ2UoZyk7dmFyIG49RHIobSxwKTtnLmxlbmd0aD8oX3x8KGkucG9seWdvblN0YXJ0KCksXz0hMCksQ3IoZyxScixuLHIsaSkpOm4mJihffHwoaS5wb2x5Z29uU3RhcnQoKSxfPSEwKSxpLmxpbmVTdGFydCgpLHIobnVsbCxudWxsLDEsaSksaS5saW5lRW5kKCkpLF8mJihpLnBvbHlnb25FbmQoKSxfPSExKSxnPXA9bnVsbH0sc3BoZXJlOmZ1bmN0aW9uKCl7aS5wb2x5Z29uU3RhcnQoKSxpLmxpbmVTdGFydCgpLHIobnVsbCxudWxsLDEsaSksaS5saW5lRW5kKCksaS5wb2x5Z29uRW5kKCl9fSx4PXFyKCksTT10KHgpLF89ITE7cmV0dXJuIHl9fWZ1bmN0aW9uIFRyKG4pe3JldHVybiBuLmxlbmd0aD4xfWZ1bmN0aW9uIHFyKCl7dmFyIG4sdD1bXTtyZXR1cm57bGluZVN0YXJ0OmZ1bmN0aW9uKCl7dC5wdXNoKG49W10pfSxwb2ludDpmdW5jdGlvbih0LHIpe24ucHVzaChbdCxyXSl9LGxpbmVFbmQ6dixidWZmZXI6ZnVuY3Rpb24oKXt2YXIgcj10O3JldHVybiB0PVtdLG49bnVsbCxyfSxyZWpvaW46ZnVuY3Rpb24oKXt0Lmxlbmd0aD4xJiZ0LnB1c2godC5wb3AoKS5jb25jYXQodC5zaGlmdCgpKSl9fX1mdW5jdGlvbiBScihuLHQpe3JldHVybigobj1uLngpWzBdPDA/blsxXS1BYS1DYTpBYS1uWzFdKS0oKHQ9dC54KVswXTwwP3RbMV0tQWEtQ2E6QWEtdFsxXSl9ZnVuY3Rpb24gRHIobix0KXt2YXIgcj1uWzBdLGU9blsxXSx1PVtNYXRoLnNpbihyKSwtTWF0aC5jb3MociksMF0saT0wLG89MDtnYy5yZXNldCgpO2Zvcih2YXIgYT0wLGM9dC5sZW5ndGg7Yz5hOysrYSl7dmFyIHM9dFthXSxsPXMubGVuZ3RoO2lmKGwpZm9yKHZhciBmPXNbMF0saD1mWzBdLGc9ZlsxXS8yK2thLzQscD1NYXRoLnNpbihnKSx2PU1hdGguY29zKGcpLGQ9MTs7KXtkPT09bCYmKGQ9MCksbj1zW2RdO3ZhciBtPW5bMF0seT1uWzFdLzIra2EvNCx4PU1hdGguc2luKHkpLE09TWF0aC5jb3MoeSksXz1tLWgsYj1fPj0wPzE6LTEsdz1iKl8sUz13PmthLGs9cCp4O2lmKGdjLmFkZChNYXRoLmF0YW4yKGsqYipNYXRoLnNpbih3KSx2Kk0raypNYXRoLmNvcyh3KSkpLGkrPVM/XytiKkVhOl8sU15oPj1yXm0+PXIpe3ZhciBFPWRyKHByKGYpLHByKG4pKTt4cihFKTt2YXIgQT1kcih1LEUpO3hyKEEpO3ZhciBDPShTXl8+PTA/LTE6MSkqRyhBWzJdKTsoZT5DfHxlPT09QyYmKEVbMF18fEVbMV0pKSYmKG8rPVNeXz49MD8xOi0xKX1pZighZCsrKWJyZWFrO2g9bSxwPXgsdj1NLGY9bn19cmV0dXJuKC1DYT5pfHxDYT5pJiYwPmdjKV4xJm99ZnVuY3Rpb24gUHIobil7dmFyIHQscj0wLzAsZT0wLzAsdT0wLzA7cmV0dXJue2xpbmVTdGFydDpmdW5jdGlvbigpe24ubGluZVN0YXJ0KCksdD0xfSxwb2ludDpmdW5jdGlvbihpLG8pe3ZhciBhPWk+MD9rYTota2EsYz1jYShpLXIpO2NhKGMta2EpPENhPyhuLnBvaW50KHIsZT0oZStvKS8yPjA/QWE6LUFhKSxuLnBvaW50KHUsZSksbi5saW5lRW5kKCksbi5saW5lU3RhcnQoKSxuLnBvaW50KGEsZSksbi5wb2ludChpLGUpLHQ9MCk6dSE9PWEmJmM+PWthJiYoY2Eoci11KTxDYSYmKHItPXUqQ2EpLGNhKGktYSk8Q2EmJihpLT1hKkNhKSxlPVVyKHIsZSxpLG8pLG4ucG9pbnQodSxlKSxuLmxpbmVFbmQoKSxuLmxpbmVTdGFydCgpLG4ucG9pbnQoYSxlKSx0PTApLG4ucG9pbnQocj1pLGU9byksdT1hfSxsaW5lRW5kOmZ1bmN0aW9uKCl7bi5saW5lRW5kKCkscj1lPTAvMH0sY2xlYW46ZnVuY3Rpb24oKXtyZXR1cm4gMi10fX19ZnVuY3Rpb24gVXIobix0LHIsZSl7dmFyIHUsaSxvPU1hdGguc2luKG4tcik7cmV0dXJuIGNhKG8pPkNhP01hdGguYXRhbigoTWF0aC5zaW4odCkqKGk9TWF0aC5jb3MoZSkpKk1hdGguc2luKHIpLU1hdGguc2luKGUpKih1PU1hdGguY29zKHQpKSpNYXRoLnNpbihuKSkvKHUqaSpvKSk6KHQrZSkvMn1mdW5jdGlvbiBqcihuLHQscixlKXt2YXIgdTtpZihudWxsPT1uKXU9cipBYSxlLnBvaW50KC1rYSx1KSxlLnBvaW50KDAsdSksZS5wb2ludChrYSx1KSxlLnBvaW50KGthLDApLGUucG9pbnQoa2EsLXUpLGUucG9pbnQoMCwtdSksZS5wb2ludCgta2EsLXUpLGUucG9pbnQoLWthLDApLGUucG9pbnQoLWthLHUpO2Vsc2UgaWYoY2EoblswXS10WzBdKT5DYSl7dmFyIGk9blswXTx0WzBdP2thOi1rYTt1PXIqaS8yLGUucG9pbnQoLWksdSksZS5wb2ludCgwLHUpLGUucG9pbnQoaSx1KX1lbHNlIGUucG9pbnQodFswXSx0WzFdKX1mdW5jdGlvbiBIcihuKXtmdW5jdGlvbiB0KG4sdCl7cmV0dXJuIE1hdGguY29zKG4pKk1hdGguY29zKHQpPml9ZnVuY3Rpb24gcihuKXt2YXIgcixpLGMscyxsO3JldHVybntsaW5lU3RhcnQ6ZnVuY3Rpb24oKXtzPWM9ITEsbD0xfSxwb2ludDpmdW5jdGlvbihmLGgpe3ZhciBnLHA9W2YsaF0sdj10KGYsaCksZD1vP3Y/MDp1KGYsaCk6dj91KGYrKDA+Zj9rYTota2EpLGgpOjA7aWYoIXImJihzPWM9dikmJm4ubGluZVN0YXJ0KCksdiE9PWMmJihnPWUocixwKSwoX3IocixnKXx8X3IocCxnKSkmJihwWzBdKz1DYSxwWzFdKz1DYSx2PXQocFswXSxwWzFdKSkpLHYhPT1jKWw9MCx2PyhuLmxpbmVTdGFydCgpLGc9ZShwLHIpLG4ucG9pbnQoZ1swXSxnWzFdKSk6KGc9ZShyLHApLG4ucG9pbnQoZ1swXSxnWzFdKSxuLmxpbmVFbmQoKSkscj1nO2Vsc2UgaWYoYSYmciYmb152KXt2YXIgbTtkJml8fCEobT1lKHAsciwhMCkpfHwobD0wLG8/KG4ubGluZVN0YXJ0KCksbi5wb2ludChtWzBdWzBdLG1bMF1bMV0pLG4ucG9pbnQobVsxXVswXSxtWzFdWzFdKSxuLmxpbmVFbmQoKSk6KG4ucG9pbnQobVsxXVswXSxtWzFdWzFdKSxuLmxpbmVFbmQoKSxuLmxpbmVTdGFydCgpLG4ucG9pbnQobVswXVswXSxtWzBdWzFdKSkpfSF2fHxyJiZfcihyLHApfHxuLnBvaW50KHBbMF0scFsxXSkscj1wLGM9dixpPWR9LGxpbmVFbmQ6ZnVuY3Rpb24oKXtjJiZuLmxpbmVFbmQoKSxyPW51bGx9LGNsZWFuOmZ1bmN0aW9uKCl7cmV0dXJuIGx8KHMmJmMpPDwxfX19ZnVuY3Rpb24gZShuLHQscil7dmFyIGU9cHIobiksdT1wcih0KSxvPVsxLDAsMF0sYT1kcihlLHUpLGM9dnIoYSxhKSxzPWFbMF0sbD1jLXMqcztpZighbClyZXR1cm4hciYmbjt2YXIgZj1pKmMvbCxoPS1pKnMvbCxnPWRyKG8sYSkscD15cihvLGYpLHY9eXIoYSxoKTttcihwLHYpO3ZhciBkPWcsbT12cihwLGQpLHk9dnIoZCxkKSx4PW0qbS15Kih2cihwLHApLTEpO2lmKCEoMD54KSl7dmFyIE09TWF0aC5zcXJ0KHgpLF89eXIoZCwoLW0tTSkveSk7aWYobXIoXyxwKSxfPU1yKF8pLCFyKXJldHVybiBfO3ZhciBiLHc9blswXSxTPXRbMF0saz1uWzFdLEU9dFsxXTt3PlMmJihiPXcsdz1TLFM9Yik7dmFyIEE9Uy13LEM9Y2EoQS1rYSk8Q2EsTj1DfHxDYT5BO2lmKCFDJiZrPkUmJihiPWssaz1FLEU9YiksTj9DP2srRT4wXl9bMV08KGNhKF9bMF0tdyk8Q2E/azpFKTprPD1fWzFdJiZfWzFdPD1FOkE+a2FeKHc8PV9bMF0mJl9bMF08PVMpKXt2YXIgej15cihkLCgtbStNKS95KTtyZXR1cm4gbXIoeixwKSxbXyxNcih6KV19fX1mdW5jdGlvbiB1KHQscil7dmFyIGU9bz9uOmthLW4sdT0wO3JldHVybi1lPnQ/dXw9MTp0PmUmJih1fD0yKSwtZT5yP3V8PTQ6cj5lJiYodXw9OCksdX12YXIgaT1NYXRoLmNvcyhuKSxvPWk+MCxhPWNhKGkpPkNhLGM9Z2Uobiw2KnphKTtyZXR1cm4gTHIodCxyLGMsbz9bMCwtbl06Wy1rYSxuLWthXSl9ZnVuY3Rpb24gRnIobix0LHIsZSl7cmV0dXJuIGZ1bmN0aW9uKHUpe3ZhciBpLG89dS5hLGE9dS5iLGM9by54LHM9by55LGw9YS54LGY9YS55LGg9MCxnPTEscD1sLWMsdj1mLXM7aWYoaT1uLWMscHx8IShpPjApKXtpZihpLz1wLDA+cCl7aWYoaD5pKXJldHVybjtnPmkmJihnPWkpfWVsc2UgaWYocD4wKXtpZihpPmcpcmV0dXJuO2k+aCYmKGg9aSl9aWYoaT1yLWMscHx8ISgwPmkpKXtpZihpLz1wLDA+cCl7aWYoaT5nKXJldHVybjtpPmgmJihoPWkpfWVsc2UgaWYocD4wKXtpZihoPmkpcmV0dXJuO2c+aSYmKGc9aSl9aWYoaT10LXMsdnx8IShpPjApKXtpZihpLz12LDA+dil7aWYoaD5pKXJldHVybjtnPmkmJihnPWkpfWVsc2UgaWYodj4wKXtpZihpPmcpcmV0dXJuO2k+aCYmKGg9aSl9aWYoaT1lLXMsdnx8ISgwPmkpKXtpZihpLz12LDA+dil7aWYoaT5nKXJldHVybjtpPmgmJihoPWkpfWVsc2UgaWYodj4wKXtpZihoPmkpcmV0dXJuO2c+aSYmKGc9aSl9cmV0dXJuIGg+MCYmKHUuYT17eDpjK2gqcCx5OnMraCp2fSksMT5nJiYodS5iPXt4OmMrZypwLHk6cytnKnZ9KSx1fX19fX19ZnVuY3Rpb24gT3Iobix0LHIsZSl7ZnVuY3Rpb24gdShlLHUpe3JldHVybiBjYShlWzBdLW4pPENhP3U+MD8wOjM6Y2EoZVswXS1yKTxDYT91PjA/MjoxOmNhKGVbMV0tdCk8Q2E/dT4wPzE6MDp1PjA/MzoyfWZ1bmN0aW9uIGkobix0KXtyZXR1cm4gbyhuLngsdC54KX1mdW5jdGlvbiBvKG4sdCl7dmFyIHI9dShuLDEpLGU9dSh0LDEpO3JldHVybiByIT09ZT9yLWU6MD09PXI/dFsxXS1uWzFdOjE9PT1yP25bMF0tdFswXToyPT09cj9uWzFdLXRbMV06dFswXS1uWzBdfXJldHVybiBmdW5jdGlvbihhKXtmdW5jdGlvbiBjKG4pe2Zvcih2YXIgdD0wLHI9ZC5sZW5ndGgsZT1uWzFdLHU9MDtyPnU7Kyt1KWZvcih2YXIgaSxvPTEsYT1kW3VdLGM9YS5sZW5ndGgscz1hWzBdO2M+bzsrK28paT1hW29dLHNbMV08PWU/aVsxXT5lJiZKKHMsaSxuKT4wJiYrK3Q6aVsxXTw9ZSYmSihzLGksbik8MCYmLS10LHM9aTtyZXR1cm4gMCE9PXR9ZnVuY3Rpb24gcyhpLGEsYyxzKXt2YXIgbD0wLGY9MDtpZihudWxsPT1pfHwobD11KGksYykpIT09KGY9dShhLGMpKXx8byhpLGEpPDBeYz4wKXtkbyBzLnBvaW50KDA9PT1sfHwzPT09bD9uOnIsbD4xP2U6dCk7d2hpbGUoKGw9KGwrYys0KSU0KSE9PWYpfWVsc2Ugcy5wb2ludChhWzBdLGFbMV0pfWZ1bmN0aW9uIGwodSxpKXtyZXR1cm4gdT49biYmcj49dSYmaT49dCYmZT49aX1mdW5jdGlvbiBmKG4sdCl7bChuLHQpJiZhLnBvaW50KG4sdCl9ZnVuY3Rpb24gaCgpe04ucG9pbnQ9cCxkJiZkLnB1c2gobT1bXSksUz0hMCx3PSExLF89Yj0wLzB9ZnVuY3Rpb24gZygpe3YmJihwKHkseCksTSYmdyYmQS5yZWpvaW4oKSx2LnB1c2goQS5idWZmZXIoKSkpLE4ucG9pbnQ9Zix3JiZhLmxpbmVFbmQoKX1mdW5jdGlvbiBwKG4sdCl7bj1NYXRoLm1heCgtQ2MsTWF0aC5taW4oQ2MsbikpLHQ9TWF0aC5tYXgoLUNjLE1hdGgubWluKENjLHQpKTt2YXIgcj1sKG4sdCk7aWYoZCYmbS5wdXNoKFtuLHRdKSxTKXk9bix4PXQsTT1yLFM9ITEsciYmKGEubGluZVN0YXJ0KCksYS5wb2ludChuLHQpKTtlbHNlIGlmKHImJncpYS5wb2ludChuLHQpO2Vsc2V7dmFyIGU9e2E6e3g6Xyx5OmJ9LGI6e3g6bix5OnR9fTtDKGUpPyh3fHwoYS5saW5lU3RhcnQoKSxhLnBvaW50KGUuYS54LGUuYS55KSksYS5wb2ludChlLmIueCxlLmIueSkscnx8YS5saW5lRW5kKCksaz0hMSk6ciYmKGEubGluZVN0YXJ0KCksYS5wb2ludChuLHQpLGs9ITEpfV89bixiPXQsdz1yfXZhciB2LGQsbSx5LHgsTSxfLGIsdyxTLGssRT1hLEE9cXIoKSxDPUZyKG4sdCxyLGUpLE49e3BvaW50OmYsbGluZVN0YXJ0OmgsbGluZUVuZDpnLHBvbHlnb25TdGFydDpmdW5jdGlvbigpe2E9QSx2PVtdLGQ9W10saz0hMH0scG9seWdvbkVuZDpmdW5jdGlvbigpe2E9RSx2PUJvLm1lcmdlKHYpO3ZhciB0PWMoW24sZV0pLHI9ayYmdCx1PXYubGVuZ3RoOyhyfHx1KSYmKGEucG9seWdvblN0YXJ0KCksciYmKGEubGluZVN0YXJ0KCkscyhudWxsLG51bGwsMSxhKSxhLmxpbmVFbmQoKSksdSYmQ3IodixpLHQscyxhKSxhLnBvbHlnb25FbmQoKSksdj1kPW09bnVsbH19O3JldHVybiBOfX1mdW5jdGlvbiBJcihuLHQpe2Z1bmN0aW9uIHIocixlKXtyZXR1cm4gcj1uKHIsZSksdChyWzBdLHJbMV0pfXJldHVybiBuLmludmVydCYmdC5pbnZlcnQmJihyLmludmVydD1mdW5jdGlvbihyLGUpe3JldHVybiByPXQuaW52ZXJ0KHIsZSksciYmbi5pbnZlcnQoclswXSxyWzFdKX0pLHJ9ZnVuY3Rpb24gWXIobil7dmFyIHQ9MCxyPWthLzMsZT1pZShuKSx1PWUodCxyKTtyZXR1cm4gdS5wYXJhbGxlbHM9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/ZSh0PW5bMF0qa2EvMTgwLHI9blsxXSprYS8xODApOlsxODAqKHQva2EpLDE4MCooci9rYSldfSx1fWZ1bmN0aW9uIFpyKG4sdCl7ZnVuY3Rpb24gcihuLHQpe3ZhciByPU1hdGguc3FydChpLTIqdSpNYXRoLnNpbih0KSkvdTtyZXR1cm5bcipNYXRoLnNpbihuKj11KSxvLXIqTWF0aC5jb3MobildfXZhciBlPU1hdGguc2luKG4pLHU9KGUrTWF0aC5zaW4odCkpLzIsaT0xK2UqKDIqdS1lKSxvPU1hdGguc3FydChpKS91O3JldHVybiByLmludmVydD1mdW5jdGlvbihuLHQpe3ZhciByPW8tdDtyZXR1cm5bTWF0aC5hdGFuMihuLHIpL3UsRygoaS0obipuK3IqcikqdSp1KS8oMip1KSldfSxyfWZ1bmN0aW9uIFZyKCl7ZnVuY3Rpb24gbihuLHQpe3pjKz11Km4tZSp0LGU9bix1PXR9dmFyIHQscixlLHU7RGMucG9pbnQ9ZnVuY3Rpb24oaSxvKXtEYy5wb2ludD1uLHQ9ZT1pLHI9dT1vfSxEYy5saW5lRW5kPWZ1bmN0aW9uKCl7bih0LHIpfX1mdW5jdGlvbiAkcihuLHQpe0xjPm4mJihMYz1uKSxuPnFjJiYocWM9biksVGM+dCYmKFRjPXQpLHQ+UmMmJihSYz10KX1mdW5jdGlvbiBYcigpe2Z1bmN0aW9uIG4obix0KXtvLnB1c2goIk0iLG4sIiwiLHQsaSl9ZnVuY3Rpb24gdChuLHQpe28ucHVzaCgiTSIsbiwiLCIsdCksYS5wb2ludD1yfWZ1bmN0aW9uIHIobix0KXtvLnB1c2goIkwiLG4sIiwiLHQpfWZ1bmN0aW9uIGUoKXthLnBvaW50PW59ZnVuY3Rpb24gdSgpe28ucHVzaCgiWiIpfXZhciBpPUJyKDQuNSksbz1bXSxhPXtwb2ludDpuLGxpbmVTdGFydDpmdW5jdGlvbigpe2EucG9pbnQ9dH0sbGluZUVuZDplLHBvbHlnb25TdGFydDpmdW5jdGlvbigpe2EubGluZUVuZD11fSxwb2x5Z29uRW5kOmZ1bmN0aW9uKCl7YS5saW5lRW5kPWUsYS5wb2ludD1ufSxwb2ludFJhZGl1czpmdW5jdGlvbihuKXtyZXR1cm4gaT1CcihuKSxhfSxyZXN1bHQ6ZnVuY3Rpb24oKXtpZihvLmxlbmd0aCl7dmFyIG49by5qb2luKCIiKTtyZXR1cm4gbz1bXSxufX19O3JldHVybiBhfWZ1bmN0aW9uIEJyKG4pe3JldHVybiJtMCwiK24rImEiK24rIiwiK24rIiAwIDEsMSAwLCIrLTIqbisiYSIrbisiLCIrbisiIDAgMSwxIDAsIisyKm4rInoifWZ1bmN0aW9uIEpyKG4sdCl7bWMrPW4seWMrPXQsKyt4Y31mdW5jdGlvbiBXcigpe2Z1bmN0aW9uIG4obixlKXt2YXIgdT1uLXQsaT1lLXIsbz1NYXRoLnNxcnQodSp1K2kqaSk7TWMrPW8qKHQrbikvMixfYys9byoocitlKS8yLGJjKz1vLEpyKHQ9bixyPWUpfXZhciB0LHI7VWMucG9pbnQ9ZnVuY3Rpb24oZSx1KXtVYy5wb2ludD1uLEpyKHQ9ZSxyPXUpfX1mdW5jdGlvbiBHcigpe1VjLnBvaW50PUpyfWZ1bmN0aW9uIEtyKCl7ZnVuY3Rpb24gbihuLHQpe3ZhciByPW4tZSxpPXQtdSxvPU1hdGguc3FydChyKnIraSppKTtNYys9byooZStuKS8yLF9jKz1vKih1K3QpLzIsYmMrPW8sbz11Km4tZSp0LHdjKz1vKihlK24pLFNjKz1vKih1K3QpLGtjKz0zKm8sSnIoZT1uLHU9dCl9dmFyIHQscixlLHU7VWMucG9pbnQ9ZnVuY3Rpb24oaSxvKXtVYy5wb2ludD1uLEpyKHQ9ZT1pLHI9dT1vKX0sVWMubGluZUVuZD1mdW5jdGlvbigpe24odCxyKX19ZnVuY3Rpb24gUXIobil7ZnVuY3Rpb24gdCh0LHIpe24ubW92ZVRvKHQsciksbi5hcmModCxyLG8sMCxFYSl9ZnVuY3Rpb24gcih0LHIpe24ubW92ZVRvKHQsciksYS5wb2ludD1lfWZ1bmN0aW9uIGUodCxyKXtuLmxpbmVUbyh0LHIpfWZ1bmN0aW9uIHUoKXthLnBvaW50PXR9ZnVuY3Rpb24gaSgpe24uY2xvc2VQYXRoKCl9dmFyIG89NC41LGE9e3BvaW50OnQsbGluZVN0YXJ0OmZ1bmN0aW9uKCl7YS5wb2ludD1yfSxsaW5lRW5kOnUscG9seWdvblN0YXJ0OmZ1bmN0aW9uKCl7YS5saW5lRW5kPWl9LHBvbHlnb25FbmQ6ZnVuY3Rpb24oKXthLmxpbmVFbmQ9dSxhLnBvaW50PXR9LHBvaW50UmFkaXVzOmZ1bmN0aW9uKG4pe3JldHVybiBvPW4sYX0scmVzdWx0OnZ9O3JldHVybiBhfWZ1bmN0aW9uIG5lKG4pe2Z1bmN0aW9uIHQobil7cmV0dXJuKGE/ZTpyKShuKX1mdW5jdGlvbiByKHQpe3JldHVybiBlZSh0LGZ1bmN0aW9uKHIsZSl7cj1uKHIsZSksdC5wb2ludChyWzBdLHJbMV0pfSl9ZnVuY3Rpb24gZSh0KXtmdW5jdGlvbiByKHIsZSl7cj1uKHIsZSksdC5wb2ludChyWzBdLHJbMV0pfWZ1bmN0aW9uIGUoKXt4PTAvMCxTLnBvaW50PWksdC5saW5lU3RhcnQoKX1mdW5jdGlvbiBpKHIsZSl7dmFyIGk9cHIoW3IsZV0pLG89bihyLGUpO3UoeCxNLHksXyxiLHcseD1vWzBdLE09b1sxXSx5PXIsXz1pWzBdLGI9aVsxXSx3PWlbMl0sYSx0KSx0LnBvaW50KHgsTSl9ZnVuY3Rpb24gbygpe1MucG9pbnQ9cix0LmxpbmVFbmQoKX1mdW5jdGlvbiBjKCl7ZSgpLFMucG9pbnQ9cyxTLmxpbmVFbmQ9bH1mdW5jdGlvbiBzKG4sdCl7aShmPW4saD10KSxnPXgscD1NLHY9XyxkPWIsbT13LFMucG9pbnQ9aX1mdW5jdGlvbiBsKCl7dSh4LE0seSxfLGIsdyxnLHAsZix2LGQsbSxhLHQpLFMubGluZUVuZD1vLG8oKX12YXIgZixoLGcscCx2LGQsbSx5LHgsTSxfLGIsdyxTPXtwb2ludDpyLGxpbmVTdGFydDplLGxpbmVFbmQ6byxwb2x5Z29uU3RhcnQ6ZnVuY3Rpb24oKXt0LnBvbHlnb25TdGFydCgpLFMubGluZVN0YXJ0PWN9LHBvbHlnb25FbmQ6ZnVuY3Rpb24oKXt0LnBvbHlnb25FbmQoKSxTLmxpbmVTdGFydD1lfX07cmV0dXJuIFN9ZnVuY3Rpb24gdSh0LHIsZSxhLGMscyxsLGYsaCxnLHAsdixkLG0pe3ZhciB5PWwtdCx4PWYtcixNPXkqeSt4Kng7aWYoTT40KmkmJmQtLSl7dmFyIF89YStnLGI9YytwLHc9cyt2LFM9TWF0aC5zcXJ0KF8qXytiKmIrdyp3KSxrPU1hdGguYXNpbih3Lz1TKSxFPWNhKGNhKHcpLTEpPENhfHxjYShlLWgpPENhPyhlK2gpLzI6TWF0aC5hdGFuMihiLF8pLEE9bihFLGspLEM9QVswXSxOPUFbMV0sej1DLXQsTD1OLXIsVD14KnoteSpMOyhUKlQvTT5pfHxjYSgoeSp6K3gqTCkvTS0uNSk+LjN8fG8+YSpnK2MqcCtzKnYpJiYodSh0LHIsZSxhLGMscyxDLE4sRSxfLz1TLGIvPVMsdyxkLG0pLG0ucG9pbnQoQyxOKSx1KEMsTixFLF8sYix3LGwsZixoLGcscCx2LGQsbSkpfX12YXIgaT0uNSxvPU1hdGguY29zKDMwKnphKSxhPTE2O3JldHVybiB0LnByZWNpc2lvbj1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oYT0oaT1uKm4pPjAmJjE2LHQpOk1hdGguc3FydChpKX0sdH1mdW5jdGlvbiB0ZShuKXt2YXIgdD1uZShmdW5jdGlvbih0LHIpe3JldHVybiBuKFt0KkxhLHIqTGFdKX0pO3JldHVybiBmdW5jdGlvbihuKXtyZXR1cm4gb2UodChuKSl9fWZ1bmN0aW9uIHJlKG4pe3RoaXMuc3RyZWFtPW59ZnVuY3Rpb24gZWUobix0KXtyZXR1cm57cG9pbnQ6dCxzcGhlcmU6ZnVuY3Rpb24oKXtuLnNwaGVyZSgpfSxsaW5lU3RhcnQ6ZnVuY3Rpb24oKXtuLmxpbmVTdGFydCgpfSxsaW5lRW5kOmZ1bmN0aW9uKCl7bi5saW5lRW5kKCl9LHBvbHlnb25TdGFydDpmdW5jdGlvbigpe24ucG9seWdvblN0YXJ0KCl9LHBvbHlnb25FbmQ6ZnVuY3Rpb24oKXtuLnBvbHlnb25FbmQoKX19fWZ1bmN0aW9uIHVlKG4pe3JldHVybiBpZShmdW5jdGlvbigpe3JldHVybiBufSkoKX1mdW5jdGlvbiBpZShuKXtmdW5jdGlvbiB0KG4pe3JldHVybiBuPWEoblswXSp6YSxuWzFdKnphKSxbblswXSpoK2Mscy1uWzFdKmhdfWZ1bmN0aW9uIHIobil7cmV0dXJuIG49YS5pbnZlcnQoKG5bMF0tYykvaCwocy1uWzFdKS9oKSxuJiZbblswXSpMYSxuWzFdKkxhXX1mdW5jdGlvbiBlKCl7YT1JcihvPXNlKG0seSx4KSxpKTt2YXIgbj1pKHYsZCk7cmV0dXJuIGM9Zy1uWzBdKmgscz1wK25bMV0qaCx1KCkKfWZ1bmN0aW9uIHUoKXtyZXR1cm4gbCYmKGwudmFsaWQ9ITEsbD1udWxsKSx0fXZhciBpLG8sYSxjLHMsbCxmPW5lKGZ1bmN0aW9uKG4sdCl7cmV0dXJuIG49aShuLHQpLFtuWzBdKmgrYyxzLW5bMV0qaF19KSxoPTE1MCxnPTQ4MCxwPTI1MCx2PTAsZD0wLG09MCx5PTAseD0wLE09QWMsXz1BdCxiPW51bGwsdz1udWxsO3JldHVybiB0LnN0cmVhbT1mdW5jdGlvbihuKXtyZXR1cm4gbCYmKGwudmFsaWQ9ITEpLGw9b2UoTShvLGYoXyhuKSkpKSxsLnZhbGlkPSEwLGx9LHQuY2xpcEFuZ2xlPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhNPW51bGw9PW4/KGI9bixBYyk6SHIoKGI9K24pKnphKSx1KCkpOmJ9LHQuY2xpcEV4dGVudD1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8odz1uLF89bj9PcihuWzBdWzBdLG5bMF1bMV0sblsxXVswXSxuWzFdWzFdKTpBdCx1KCkpOnd9LHQuc2NhbGU9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGg9K24sZSgpKTpofSx0LnRyYW5zbGF0ZT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oZz0rblswXSxwPStuWzFdLGUoKSk6W2cscF19LHQuY2VudGVyPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh2PW5bMF0lMzYwKnphLGQ9blsxXSUzNjAqemEsZSgpKTpbdipMYSxkKkxhXX0sdC5yb3RhdGU9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KG09blswXSUzNjAqemEseT1uWzFdJTM2MCp6YSx4PW4ubGVuZ3RoPjI/blsyXSUzNjAqemE6MCxlKCkpOlttKkxhLHkqTGEseCpMYV19LEJvLnJlYmluZCh0LGYsInByZWNpc2lvbiIpLGZ1bmN0aW9uKCl7cmV0dXJuIGk9bi5hcHBseSh0aGlzLGFyZ3VtZW50cyksdC5pbnZlcnQ9aS5pbnZlcnQmJnIsZSgpfX1mdW5jdGlvbiBvZShuKXtyZXR1cm4gZWUobixmdW5jdGlvbih0LHIpe24ucG9pbnQodCp6YSxyKnphKX0pfWZ1bmN0aW9uIGFlKG4sdCl7cmV0dXJuW24sdF19ZnVuY3Rpb24gY2Uobix0KXtyZXR1cm5bbj5rYT9uLUVhOi1rYT5uP24rRWE6bix0XX1mdW5jdGlvbiBzZShuLHQscil7cmV0dXJuIG4/dHx8cj9JcihmZShuKSxoZSh0LHIpKTpmZShuKTp0fHxyP2hlKHQscik6Y2V9ZnVuY3Rpb24gbGUobil7cmV0dXJuIGZ1bmN0aW9uKHQscil7cmV0dXJuIHQrPW4sW3Q+a2E/dC1FYTota2E+dD90K0VhOnQscl19fWZ1bmN0aW9uIGZlKG4pe3ZhciB0PWxlKG4pO3JldHVybiB0LmludmVydD1sZSgtbiksdH1mdW5jdGlvbiBoZShuLHQpe2Z1bmN0aW9uIHIobix0KXt2YXIgcj1NYXRoLmNvcyh0KSxhPU1hdGguY29zKG4pKnIsYz1NYXRoLnNpbihuKSpyLHM9TWF0aC5zaW4odCksbD1zKmUrYSp1O3JldHVybltNYXRoLmF0YW4yKGMqaS1sKm8sYSplLXMqdSksRyhsKmkrYypvKV19dmFyIGU9TWF0aC5jb3MobiksdT1NYXRoLnNpbihuKSxpPU1hdGguY29zKHQpLG89TWF0aC5zaW4odCk7cmV0dXJuIHIuaW52ZXJ0PWZ1bmN0aW9uKG4sdCl7dmFyIHI9TWF0aC5jb3ModCksYT1NYXRoLmNvcyhuKSpyLGM9TWF0aC5zaW4obikqcixzPU1hdGguc2luKHQpLGw9cyppLWMqbztyZXR1cm5bTWF0aC5hdGFuMihjKmkrcypvLGEqZStsKnUpLEcobCplLWEqdSldfSxyfWZ1bmN0aW9uIGdlKG4sdCl7dmFyIHI9TWF0aC5jb3MobiksZT1NYXRoLnNpbihuKTtyZXR1cm4gZnVuY3Rpb24odSxpLG8sYSl7dmFyIGM9byp0O251bGwhPXU/KHU9cGUocix1KSxpPXBlKHIsaSksKG8+MD9pPnU6dT5pKSYmKHUrPW8qRWEpKToodT1uK28qRWEsaT1uLS41KmMpO2Zvcih2YXIgcyxsPXU7bz4wP2w+aTppPmw7bC09YylhLnBvaW50KChzPU1yKFtyLC1lKk1hdGguY29zKGwpLC1lKk1hdGguc2luKGwpXSkpWzBdLHNbMV0pfX1mdW5jdGlvbiBwZShuLHQpe3ZhciByPXByKHQpO3JbMF0tPW4seHIocik7dmFyIGU9VygtclsxXSk7cmV0dXJuKCgtclsyXTwwPy1lOmUpKzIqTWF0aC5QSS1DYSklKDIqTWF0aC5QSSl9ZnVuY3Rpb24gdmUobix0LHIpe3ZhciBlPUJvLnJhbmdlKG4sdC1DYSxyKS5jb25jYXQodCk7cmV0dXJuIGZ1bmN0aW9uKG4pe3JldHVybiBlLm1hcChmdW5jdGlvbih0KXtyZXR1cm5bbix0XX0pfX1mdW5jdGlvbiBkZShuLHQscil7dmFyIGU9Qm8ucmFuZ2Uobix0LUNhLHIpLmNvbmNhdCh0KTtyZXR1cm4gZnVuY3Rpb24obil7cmV0dXJuIGUubWFwKGZ1bmN0aW9uKHQpe3JldHVyblt0LG5dfSl9fWZ1bmN0aW9uIG1lKG4pe3JldHVybiBuLnNvdXJjZX1mdW5jdGlvbiB5ZShuKXtyZXR1cm4gbi50YXJnZXR9ZnVuY3Rpb24geGUobix0LHIsZSl7dmFyIHU9TWF0aC5jb3ModCksaT1NYXRoLnNpbih0KSxvPU1hdGguY29zKGUpLGE9TWF0aC5zaW4oZSksYz11Kk1hdGguY29zKG4pLHM9dSpNYXRoLnNpbihuKSxsPW8qTWF0aC5jb3MociksZj1vKk1hdGguc2luKHIpLGg9MipNYXRoLmFzaW4oTWF0aC5zcXJ0KHR0KGUtdCkrdSpvKnR0KHItbikpKSxnPTEvTWF0aC5zaW4oaCkscD1oP2Z1bmN0aW9uKG4pe3ZhciB0PU1hdGguc2luKG4qPWgpKmcscj1NYXRoLnNpbihoLW4pKmcsZT1yKmMrdCpsLHU9cipzK3QqZixvPXIqaSt0KmE7cmV0dXJuW01hdGguYXRhbjIodSxlKSpMYSxNYXRoLmF0YW4yKG8sTWF0aC5zcXJ0KGUqZSt1KnUpKSpMYV19OmZ1bmN0aW9uKCl7cmV0dXJuW24qTGEsdCpMYV19O3JldHVybiBwLmRpc3RhbmNlPWgscH1mdW5jdGlvbiBNZSgpe2Z1bmN0aW9uIG4obix1KXt2YXIgaT1NYXRoLnNpbih1Kj16YSksbz1NYXRoLmNvcyh1KSxhPWNhKChuKj16YSktdCksYz1NYXRoLmNvcyhhKTtqYys9TWF0aC5hdGFuMihNYXRoLnNxcnQoKGE9bypNYXRoLnNpbihhKSkqYSsoYT1lKmktcipvKmMpKmEpLHIqaStlKm8qYyksdD1uLHI9aSxlPW99dmFyIHQscixlO0hjLnBvaW50PWZ1bmN0aW9uKHUsaSl7dD11KnphLHI9TWF0aC5zaW4oaSo9emEpLGU9TWF0aC5jb3MoaSksSGMucG9pbnQ9bn0sSGMubGluZUVuZD1mdW5jdGlvbigpe0hjLnBvaW50PUhjLmxpbmVFbmQ9dn19ZnVuY3Rpb24gX2Uobix0KXtmdW5jdGlvbiByKHQscil7dmFyIGU9TWF0aC5jb3ModCksdT1NYXRoLmNvcyhyKSxpPW4oZSp1KTtyZXR1cm5baSp1Kk1hdGguc2luKHQpLGkqTWF0aC5zaW4ocildfXJldHVybiByLmludmVydD1mdW5jdGlvbihuLHIpe3ZhciBlPU1hdGguc3FydChuKm4rcipyKSx1PXQoZSksaT1NYXRoLnNpbih1KSxvPU1hdGguY29zKHUpO3JldHVybltNYXRoLmF0YW4yKG4qaSxlKm8pLE1hdGguYXNpbihlJiZyKmkvZSldfSxyfWZ1bmN0aW9uIGJlKG4sdCl7ZnVuY3Rpb24gcihuLHQpe28+MD8tQWErQ2E+dCYmKHQ9LUFhK0NhKTp0PkFhLUNhJiYodD1BYS1DYSk7dmFyIHI9by9NYXRoLnBvdyh1KHQpLGkpO3JldHVybltyKk1hdGguc2luKGkqbiksby1yKk1hdGguY29zKGkqbildfXZhciBlPU1hdGguY29zKG4pLHU9ZnVuY3Rpb24obil7cmV0dXJuIE1hdGgudGFuKGthLzQrbi8yKX0saT1uPT09dD9NYXRoLnNpbihuKTpNYXRoLmxvZyhlL01hdGguY29zKHQpKS9NYXRoLmxvZyh1KHQpL3UobikpLG89ZSpNYXRoLnBvdyh1KG4pLGkpL2k7cmV0dXJuIGk/KHIuaW52ZXJ0PWZ1bmN0aW9uKG4sdCl7dmFyIHI9by10LGU9QihpKSpNYXRoLnNxcnQobipuK3Iqcik7cmV0dXJuW01hdGguYXRhbjIobixyKS9pLDIqTWF0aC5hdGFuKE1hdGgucG93KG8vZSwxL2kpKS1BYV19LHIpOlNlfWZ1bmN0aW9uIHdlKG4sdCl7ZnVuY3Rpb24gcihuLHQpe3ZhciByPWktdDtyZXR1cm5bcipNYXRoLnNpbih1Km4pLGktcipNYXRoLmNvcyh1Km4pXX12YXIgZT1NYXRoLmNvcyhuKSx1PW49PT10P01hdGguc2luKG4pOihlLU1hdGguY29zKHQpKS8odC1uKSxpPWUvdStuO3JldHVybiBjYSh1KTxDYT9hZTooci5pbnZlcnQ9ZnVuY3Rpb24obix0KXt2YXIgcj1pLXQ7cmV0dXJuW01hdGguYXRhbjIobixyKS91LGktQih1KSpNYXRoLnNxcnQobipuK3IqcildfSxyKX1mdW5jdGlvbiBTZShuLHQpe3JldHVybltuLE1hdGgubG9nKE1hdGgudGFuKGthLzQrdC8yKSldfWZ1bmN0aW9uIGtlKG4pe3ZhciB0LHI9dWUobiksZT1yLnNjYWxlLHU9ci50cmFuc2xhdGUsaT1yLmNsaXBFeHRlbnQ7cmV0dXJuIHIuc2NhbGU9ZnVuY3Rpb24oKXt2YXIgbj1lLmFwcGx5KHIsYXJndW1lbnRzKTtyZXR1cm4gbj09PXI/dD9yLmNsaXBFeHRlbnQobnVsbCk6cjpufSxyLnRyYW5zbGF0ZT1mdW5jdGlvbigpe3ZhciBuPXUuYXBwbHkocixhcmd1bWVudHMpO3JldHVybiBuPT09cj90P3IuY2xpcEV4dGVudChudWxsKTpyOm59LHIuY2xpcEV4dGVudD1mdW5jdGlvbihuKXt2YXIgbz1pLmFwcGx5KHIsYXJndW1lbnRzKTtpZihvPT09cil7aWYodD1udWxsPT1uKXt2YXIgYT1rYSplKCksYz11KCk7aShbW2NbMF0tYSxjWzFdLWFdLFtjWzBdK2EsY1sxXSthXV0pfX1lbHNlIHQmJihvPW51bGwpO3JldHVybiBvfSxyLmNsaXBFeHRlbnQobnVsbCl9ZnVuY3Rpb24gRWUobix0KXtyZXR1cm5bTWF0aC5sb2coTWF0aC50YW4oa2EvNCt0LzIpKSwtbl19ZnVuY3Rpb24gQWUobil7cmV0dXJuIG5bMF19ZnVuY3Rpb24gQ2Uobil7cmV0dXJuIG5bMV19ZnVuY3Rpb24gTmUobil7Zm9yKHZhciB0PW4ubGVuZ3RoLHI9WzAsMV0sZT0yLHU9Mjt0PnU7dSsrKXtmb3IoO2U+MSYmSihuW3JbZS0yXV0sbltyW2UtMV1dLG5bdV0pPD0wOyktLWU7cltlKytdPXV9cmV0dXJuIHIuc2xpY2UoMCxlKX1mdW5jdGlvbiB6ZShuLHQpe3JldHVybiBuWzBdLXRbMF18fG5bMV0tdFsxXX1mdW5jdGlvbiBMZShuLHQscil7cmV0dXJuKHJbMF0tdFswXSkqKG5bMV0tdFsxXSk8KHJbMV0tdFsxXSkqKG5bMF0tdFswXSl9ZnVuY3Rpb24gVGUobix0LHIsZSl7dmFyIHU9blswXSxpPXJbMF0sbz10WzBdLXUsYT1lWzBdLWksYz1uWzFdLHM9clsxXSxsPXRbMV0tYyxmPWVbMV0tcyxoPShhKihjLXMpLWYqKHUtaSkpLyhmKm8tYSpsKTtyZXR1cm5bdStoKm8sYytoKmxdfWZ1bmN0aW9uIHFlKG4pe3ZhciB0PW5bMF0scj1uW24ubGVuZ3RoLTFdO3JldHVybiEodFswXS1yWzBdfHx0WzFdLXJbMV0pfWZ1bmN0aW9uIFJlKCl7dHUodGhpcyksdGhpcy5lZGdlPXRoaXMuc2l0ZT10aGlzLmNpcmNsZT1udWxsfWZ1bmN0aW9uIERlKG4pe3ZhciB0PUdjLnBvcCgpfHxuZXcgUmU7cmV0dXJuIHQuc2l0ZT1uLHR9ZnVuY3Rpb24gUGUobil7JGUobiksQmMucmVtb3ZlKG4pLEdjLnB1c2gobiksdHUobil9ZnVuY3Rpb24gVWUobil7dmFyIHQ9bi5jaXJjbGUscj10LngsZT10LmN5LHU9e3g6cix5OmV9LGk9bi5QLG89bi5OLGE9W25dO1BlKG4pO2Zvcih2YXIgYz1pO2MuY2lyY2xlJiZjYShyLWMuY2lyY2xlLngpPENhJiZjYShlLWMuY2lyY2xlLmN5KTxDYTspaT1jLlAsYS51bnNoaWZ0KGMpLFBlKGMpLGM9aTthLnVuc2hpZnQoYyksJGUoYyk7Zm9yKHZhciBzPW87cy5jaXJjbGUmJmNhKHItcy5jaXJjbGUueCk8Q2EmJmNhKGUtcy5jaXJjbGUuY3kpPENhOylvPXMuTixhLnB1c2gocyksUGUocykscz1vO2EucHVzaChzKSwkZShzKTt2YXIgbCxmPWEubGVuZ3RoO2ZvcihsPTE7Zj5sOysrbClzPWFbbF0sYz1hW2wtMV0sS2Uocy5lZGdlLGMuc2l0ZSxzLnNpdGUsdSk7Yz1hWzBdLHM9YVtmLTFdLHMuZWRnZT1XZShjLnNpdGUscy5zaXRlLG51bGwsdSksVmUoYyksVmUocyl9ZnVuY3Rpb24gamUobil7Zm9yKHZhciB0LHIsZSx1LGk9bi54LG89bi55LGE9QmMuXzthOylpZihlPUhlKGEsbyktaSxlPkNhKWE9YS5MO2Vsc2V7aWYodT1pLUZlKGEsbyksISh1PkNhKSl7ZT4tQ2E/KHQ9YS5QLHI9YSk6dT4tQ2E/KHQ9YSxyPWEuTik6dD1yPWE7YnJlYWt9aWYoIWEuUil7dD1hO2JyZWFrfWE9YS5SfXZhciBjPURlKG4pO2lmKEJjLmluc2VydCh0LGMpLHR8fHIpe2lmKHQ9PT1yKXJldHVybiAkZSh0KSxyPURlKHQuc2l0ZSksQmMuaW5zZXJ0KGMsciksYy5lZGdlPXIuZWRnZT1XZSh0LnNpdGUsYy5zaXRlKSxWZSh0KSxWZShyKSx2b2lkIDA7aWYoIXIpcmV0dXJuIGMuZWRnZT1XZSh0LnNpdGUsYy5zaXRlKSx2b2lkIDA7JGUodCksJGUocik7dmFyIHM9dC5zaXRlLGw9cy54LGY9cy55LGg9bi54LWwsZz1uLnktZixwPXIuc2l0ZSx2PXAueC1sLGQ9cC55LWYsbT0yKihoKmQtZyp2KSx5PWgqaCtnKmcseD12KnYrZCpkLE09e3g6KGQqeS1nKngpL20rbCx5OihoKngtdip5KS9tK2Z9O0tlKHIuZWRnZSxzLHAsTSksYy5lZGdlPVdlKHMsbixudWxsLE0pLHIuZWRnZT1XZShuLHAsbnVsbCxNKSxWZSh0KSxWZShyKX19ZnVuY3Rpb24gSGUobix0KXt2YXIgcj1uLnNpdGUsZT1yLngsdT1yLnksaT11LXQ7aWYoIWkpcmV0dXJuIGU7dmFyIG89bi5QO2lmKCFvKXJldHVybi0xLzA7cj1vLnNpdGU7dmFyIGE9ci54LGM9ci55LHM9Yy10O2lmKCFzKXJldHVybiBhO3ZhciBsPWEtZSxmPTEvaS0xL3MsaD1sL3M7cmV0dXJuIGY/KC1oK01hdGguc3FydChoKmgtMipmKihsKmwvKC0yKnMpLWMrcy8yK3UtaS8yKSkpL2YrZTooZSthKS8yfWZ1bmN0aW9uIEZlKG4sdCl7dmFyIHI9bi5OO2lmKHIpcmV0dXJuIEhlKHIsdCk7dmFyIGU9bi5zaXRlO3JldHVybiBlLnk9PT10P2UueDoxLzB9ZnVuY3Rpb24gT2Uobil7dGhpcy5zaXRlPW4sdGhpcy5lZGdlcz1bXX1mdW5jdGlvbiBJZShuKXtmb3IodmFyIHQscixlLHUsaSxvLGEsYyxzLGwsZj1uWzBdWzBdLGg9blsxXVswXSxnPW5bMF1bMV0scD1uWzFdWzFdLHY9WGMsZD12Lmxlbmd0aDtkLS07KWlmKGk9dltkXSxpJiZpLnByZXBhcmUoKSlmb3IoYT1pLmVkZ2VzLGM9YS5sZW5ndGgsbz0wO2M+bzspbD1hW29dLmVuZCgpLGU9bC54LHU9bC55LHM9YVsrK28lY10uc3RhcnQoKSx0PXMueCxyPXMueSwoY2EoZS10KT5DYXx8Y2EodS1yKT5DYSkmJihhLnNwbGljZShvLDAsbmV3IFFlKEdlKGkuc2l0ZSxsLGNhKGUtZik8Q2EmJnAtdT5DYT97eDpmLHk6Y2EodC1mKTxDYT9yOnB9OmNhKHUtcCk8Q2EmJmgtZT5DYT97eDpjYShyLXApPENhP3Q6aCx5OnB9OmNhKGUtaCk8Q2EmJnUtZz5DYT97eDpoLHk6Y2EodC1oKTxDYT9yOmd9OmNhKHUtZyk8Q2EmJmUtZj5DYT97eDpjYShyLWcpPENhP3Q6Zix5Omd9Om51bGwpLGkuc2l0ZSxudWxsKSksKytjKX1mdW5jdGlvbiBZZShuLHQpe3JldHVybiB0LmFuZ2xlLW4uYW5nbGV9ZnVuY3Rpb24gWmUoKXt0dSh0aGlzKSx0aGlzLng9dGhpcy55PXRoaXMuYXJjPXRoaXMuc2l0ZT10aGlzLmN5PW51bGx9ZnVuY3Rpb24gVmUobil7dmFyIHQ9bi5QLHI9bi5OO2lmKHQmJnIpe3ZhciBlPXQuc2l0ZSx1PW4uc2l0ZSxpPXIuc2l0ZTtpZihlIT09aSl7dmFyIG89dS54LGE9dS55LGM9ZS54LW8scz1lLnktYSxsPWkueC1vLGY9aS55LWEsaD0yKihjKmYtcypsKTtpZighKGg+PS1OYSkpe3ZhciBnPWMqYytzKnMscD1sKmwrZipmLHY9KGYqZy1zKnApL2gsZD0oYypwLWwqZykvaCxmPWQrYSxtPUtjLnBvcCgpfHxuZXcgWmU7bS5hcmM9bixtLnNpdGU9dSxtLng9ditvLG0ueT1mK01hdGguc3FydCh2KnYrZCpkKSxtLmN5PWYsbi5jaXJjbGU9bTtmb3IodmFyIHk9bnVsbCx4PVdjLl87eDspaWYobS55PHgueXx8bS55PT09eC55JiZtLng8PXgueCl7aWYoIXguTCl7eT14LlA7YnJlYWt9eD14Lkx9ZWxzZXtpZigheC5SKXt5PXg7YnJlYWt9eD14LlJ9V2MuaW5zZXJ0KHksbSkseXx8KEpjPW0pfX19fWZ1bmN0aW9uICRlKG4pe3ZhciB0PW4uY2lyY2xlO3QmJih0LlB8fChKYz10Lk4pLFdjLnJlbW92ZSh0KSxLYy5wdXNoKHQpLHR1KHQpLG4uY2lyY2xlPW51bGwpfWZ1bmN0aW9uIFhlKG4pe2Zvcih2YXIgdCxyPSRjLGU9RnIoblswXVswXSxuWzBdWzFdLG5bMV1bMF0sblsxXVsxXSksdT1yLmxlbmd0aDt1LS07KXQ9clt1XSwoIUJlKHQsbil8fCFlKHQpfHxjYSh0LmEueC10LmIueCk8Q2EmJmNhKHQuYS55LXQuYi55KTxDYSkmJih0LmE9dC5iPW51bGwsci5zcGxpY2UodSwxKSl9ZnVuY3Rpb24gQmUobix0KXt2YXIgcj1uLmI7aWYocilyZXR1cm4hMDt2YXIgZSx1LGk9bi5hLG89dFswXVswXSxhPXRbMV1bMF0sYz10WzBdWzFdLHM9dFsxXVsxXSxsPW4ubCxmPW4ucixoPWwueCxnPWwueSxwPWYueCx2PWYueSxkPShoK3ApLzIsbT0oZyt2KS8yO2lmKHY9PT1nKXtpZihvPmR8fGQ+PWEpcmV0dXJuO2lmKGg+cCl7aWYoaSl7aWYoaS55Pj1zKXJldHVybn1lbHNlIGk9e3g6ZCx5OmN9O3I9e3g6ZCx5OnN9fWVsc2V7aWYoaSl7aWYoaS55PGMpcmV0dXJufWVsc2UgaT17eDpkLHk6c307cj17eDpkLHk6Y319fWVsc2UgaWYoZT0oaC1wKS8odi1nKSx1PW0tZSpkLC0xPmV8fGU+MSlpZihoPnApe2lmKGkpe2lmKGkueT49cylyZXR1cm59ZWxzZSBpPXt4OihjLXUpL2UseTpjfTtyPXt4OihzLXUpL2UseTpzfX1lbHNle2lmKGkpe2lmKGkueTxjKXJldHVybn1lbHNlIGk9e3g6KHMtdSkvZSx5OnN9O3I9e3g6KGMtdSkvZSx5OmN9fWVsc2UgaWYodj5nKXtpZihpKXtpZihpLng+PWEpcmV0dXJufWVsc2UgaT17eDpvLHk6ZSpvK3V9O3I9e3g6YSx5OmUqYSt1fX1lbHNle2lmKGkpe2lmKGkueDxvKXJldHVybn1lbHNlIGk9e3g6YSx5OmUqYSt1fTtyPXt4Om8seTplKm8rdX19cmV0dXJuIG4uYT1pLG4uYj1yLCEwfWZ1bmN0aW9uIEplKG4sdCl7dGhpcy5sPW4sdGhpcy5yPXQsdGhpcy5hPXRoaXMuYj1udWxsfWZ1bmN0aW9uIFdlKG4sdCxyLGUpe3ZhciB1PW5ldyBKZShuLHQpO3JldHVybiAkYy5wdXNoKHUpLHImJktlKHUsbix0LHIpLGUmJktlKHUsdCxuLGUpLFhjW24uaV0uZWRnZXMucHVzaChuZXcgUWUodSxuLHQpKSxYY1t0LmldLmVkZ2VzLnB1c2gobmV3IFFlKHUsdCxuKSksdX1mdW5jdGlvbiBHZShuLHQscil7dmFyIGU9bmV3IEplKG4sbnVsbCk7cmV0dXJuIGUuYT10LGUuYj1yLCRjLnB1c2goZSksZX1mdW5jdGlvbiBLZShuLHQscixlKXtuLmF8fG4uYj9uLmw9PT1yP24uYj1lOm4uYT1lOihuLmE9ZSxuLmw9dCxuLnI9cil9ZnVuY3Rpb24gUWUobix0LHIpe3ZhciBlPW4uYSx1PW4uYjt0aGlzLmVkZ2U9bix0aGlzLnNpdGU9dCx0aGlzLmFuZ2xlPXI/TWF0aC5hdGFuMihyLnktdC55LHIueC10LngpOm4ubD09PXQ/TWF0aC5hdGFuMih1LngtZS54LGUueS11LnkpOk1hdGguYXRhbjIoZS54LXUueCx1LnktZS55KX1mdW5jdGlvbiBudSgpe3RoaXMuXz1udWxsfWZ1bmN0aW9uIHR1KG4pe24uVT1uLkM9bi5MPW4uUj1uLlA9bi5OPW51bGx9ZnVuY3Rpb24gcnUobix0KXt2YXIgcj10LGU9dC5SLHU9ci5VO3U/dS5MPT09cj91Lkw9ZTp1LlI9ZTpuLl89ZSxlLlU9dSxyLlU9ZSxyLlI9ZS5MLHIuUiYmKHIuUi5VPXIpLGUuTD1yfWZ1bmN0aW9uIGV1KG4sdCl7dmFyIHI9dCxlPXQuTCx1PXIuVTt1P3UuTD09PXI/dS5MPWU6dS5SPWU6bi5fPWUsZS5VPXUsci5VPWUsci5MPWUuUixyLkwmJihyLkwuVT1yKSxlLlI9cn1mdW5jdGlvbiB1dShuKXtmb3IoO24uTDspbj1uLkw7cmV0dXJuIG59ZnVuY3Rpb24gaXUobix0KXt2YXIgcixlLHUsaT1uLnNvcnQob3UpLnBvcCgpO2ZvcigkYz1bXSxYYz1uZXcgQXJyYXkobi5sZW5ndGgpLEJjPW5ldyBudSxXYz1uZXcgbnU7OylpZih1PUpjLGkmJighdXx8aS55PHUueXx8aS55PT09dS55JiZpLng8dS54KSkoaS54IT09cnx8aS55IT09ZSkmJihYY1tpLmldPW5ldyBPZShpKSxqZShpKSxyPWkueCxlPWkueSksaT1uLnBvcCgpO2Vsc2V7aWYoIXUpYnJlYWs7VWUodS5hcmMpfXQmJihYZSh0KSxJZSh0KSk7dmFyIG89e2NlbGxzOlhjLGVkZ2VzOiRjfTtyZXR1cm4gQmM9V2M9JGM9WGM9bnVsbCxvfWZ1bmN0aW9uIG91KG4sdCl7cmV0dXJuIHQueS1uLnl8fHQueC1uLnh9ZnVuY3Rpb24gYXUobix0LHIpe3JldHVybihuLngtci54KSoodC55LW4ueSktKG4ueC10LngpKihyLnktbi55KX1mdW5jdGlvbiBjdShuKXtyZXR1cm4gbi54fWZ1bmN0aW9uIHN1KG4pe3JldHVybiBuLnl9ZnVuY3Rpb24gbHUoKXtyZXR1cm57bGVhZjohMCxub2RlczpbXSxwb2ludDpudWxsLHg6bnVsbCx5Om51bGx9fWZ1bmN0aW9uIGZ1KG4sdCxyLGUsdSxpKXtpZighbih0LHIsZSx1LGkpKXt2YXIgbz0uNSoocit1KSxhPS41KihlK2kpLGM9dC5ub2RlcztjWzBdJiZmdShuLGNbMF0scixlLG8sYSksY1sxXSYmZnUobixjWzFdLG8sZSx1LGEpLGNbMl0mJmZ1KG4sY1syXSxyLGEsbyxpKSxjWzNdJiZmdShuLGNbM10sbyxhLHUsaSl9fWZ1bmN0aW9uIGh1KG4sdCl7bj1Cby5yZ2IobiksdD1Cby5yZ2IodCk7dmFyIHI9bi5yLGU9bi5nLHU9bi5iLGk9dC5yLXIsbz10LmctZSxhPXQuYi11O3JldHVybiBmdW5jdGlvbihuKXtyZXR1cm4iIyIrTXQoTWF0aC5yb3VuZChyK2kqbikpK010KE1hdGgucm91bmQoZStvKm4pKStNdChNYXRoLnJvdW5kKHUrYSpuKSl9fWZ1bmN0aW9uIGd1KG4sdCl7dmFyIHIsZT17fSx1PXt9O2ZvcihyIGluIG4pciBpbiB0P2Vbcl09ZHUobltyXSx0W3JdKTp1W3JdPW5bcl07Zm9yKHIgaW4gdClyIGluIG58fCh1W3JdPXRbcl0pO3JldHVybiBmdW5jdGlvbihuKXtmb3IociBpbiBlKXVbcl09ZVtyXShuKTtyZXR1cm4gdX19ZnVuY3Rpb24gcHUobix0KXtyZXR1cm4gdC09bj0rbixmdW5jdGlvbihyKXtyZXR1cm4gbit0KnJ9fWZ1bmN0aW9uIHZ1KG4sdCl7dmFyIHIsZSx1LGk9bnMubGFzdEluZGV4PXRzLmxhc3RJbmRleD0wLG89LTEsYT1bXSxjPVtdO2ZvcihuKz0iIix0Kz0iIjsocj1ucy5leGVjKG4pKSYmKGU9dHMuZXhlYyh0KSk7KSh1PWUuaW5kZXgpPmkmJih1PXQuc3Vic3RyaW5nKGksdSksYVtvXT9hW29dKz11OmFbKytvXT11KSwocj1yWzBdKT09PShlPWVbMF0pP2Fbb10/YVtvXSs9ZTphWysrb109ZTooYVsrK29dPW51bGwsYy5wdXNoKHtpOm8seDpwdShyLGUpfSkpLGk9dHMubGFzdEluZGV4O3JldHVybiBpPHQubGVuZ3RoJiYodT10LnN1YnN0cmluZyhpKSxhW29dP2Fbb10rPXU6YVsrK29dPXUpLGEubGVuZ3RoPDI/Y1swXT8odD1jWzBdLngsZnVuY3Rpb24obil7cmV0dXJuIHQobikrIiJ9KTpmdW5jdGlvbigpe3JldHVybiB0fToodD1jLmxlbmd0aCxmdW5jdGlvbihuKXtmb3IodmFyIHIsZT0wO3Q+ZTsrK2UpYVsocj1jW2VdKS5pXT1yLngobik7cmV0dXJuIGEuam9pbigiIil9KX1mdW5jdGlvbiBkdShuLHQpe2Zvcih2YXIgcixlPUJvLmludGVycG9sYXRvcnMubGVuZ3RoOy0tZT49MCYmIShyPUJvLmludGVycG9sYXRvcnNbZV0obix0KSk7KTtyZXR1cm4gcn1mdW5jdGlvbiBtdShuLHQpe3ZhciByLGU9W10sdT1bXSxpPW4ubGVuZ3RoLG89dC5sZW5ndGgsYT1NYXRoLm1pbihuLmxlbmd0aCx0Lmxlbmd0aCk7Zm9yKHI9MDthPnI7KytyKWUucHVzaChkdShuW3JdLHRbcl0pKTtmb3IoO2k+cjsrK3IpdVtyXT1uW3JdO2Zvcig7bz5yOysrcil1W3JdPXRbcl07cmV0dXJuIGZ1bmN0aW9uKG4pe2ZvcihyPTA7YT5yOysrcil1W3JdPWVbcl0obik7cmV0dXJuIHV9fWZ1bmN0aW9uIHl1KG4pe3JldHVybiBmdW5jdGlvbih0KXtyZXR1cm4gMD49dD8wOnQ+PTE/MTpuKHQpfX1mdW5jdGlvbiB4dShuKXtyZXR1cm4gZnVuY3Rpb24odCl7cmV0dXJuIDEtbigxLXQpfX1mdW5jdGlvbiBNdShuKXtyZXR1cm4gZnVuY3Rpb24odCl7cmV0dXJuLjUqKC41PnQ/bigyKnQpOjItbigyLTIqdCkpfX1mdW5jdGlvbiBfdShuKXtyZXR1cm4gbipufWZ1bmN0aW9uIGJ1KG4pe3JldHVybiBuKm4qbn1mdW5jdGlvbiB3dShuKXtpZigwPj1uKXJldHVybiAwO2lmKG4+PTEpcmV0dXJuIDE7dmFyIHQ9bipuLHI9dCpuO3JldHVybiA0KiguNT5uP3I6Myoobi10KStyLS43NSl9ZnVuY3Rpb24gU3Uobil7cmV0dXJuIGZ1bmN0aW9uKHQpe3JldHVybiBNYXRoLnBvdyh0LG4pfX1mdW5jdGlvbiBrdShuKXtyZXR1cm4gMS1NYXRoLmNvcyhuKkFhKX1mdW5jdGlvbiBFdShuKXtyZXR1cm4gTWF0aC5wb3coMiwxMCoobi0xKSl9ZnVuY3Rpb24gQXUobil7cmV0dXJuIDEtTWF0aC5zcXJ0KDEtbipuKX1mdW5jdGlvbiBDdShuLHQpe3ZhciByO3JldHVybiBhcmd1bWVudHMubGVuZ3RoPDImJih0PS40NSksYXJndW1lbnRzLmxlbmd0aD9yPXQvRWEqTWF0aC5hc2luKDEvbik6KG49MSxyPXQvNCksZnVuY3Rpb24oZSl7cmV0dXJuIDErbipNYXRoLnBvdygyLC0xMCplKSpNYXRoLnNpbigoZS1yKSpFYS90KX19ZnVuY3Rpb24gTnUobil7cmV0dXJuIG58fChuPTEuNzAxNTgpLGZ1bmN0aW9uKHQpe3JldHVybiB0KnQqKChuKzEpKnQtbil9fWZ1bmN0aW9uIHp1KG4pe3JldHVybiAxLzIuNzU+bj83LjU2MjUqbipuOjIvMi43NT5uPzcuNTYyNSoobi09MS41LzIuNzUpKm4rLjc1OjIuNS8yLjc1Pm4/Ny41NjI1KihuLT0yLjI1LzIuNzUpKm4rLjkzNzU6Ny41NjI1KihuLT0yLjYyNS8yLjc1KSpuKy45ODQzNzV9ZnVuY3Rpb24gTHUobix0KXtuPUJvLmhjbChuKSx0PUJvLmhjbCh0KTt2YXIgcj1uLmgsZT1uLmMsdT1uLmwsaT10LmgtcixvPXQuYy1lLGE9dC5sLXU7cmV0dXJuIGlzTmFOKG8pJiYobz0wLGU9aXNOYU4oZSk/dC5jOmUpLGlzTmFOKGkpPyhpPTAscj1pc05hTihyKT90Lmg6cik6aT4xODA/aS09MzYwOi0xODA+aSYmKGkrPTM2MCksZnVuY3Rpb24obil7cmV0dXJuIGN0KHIraSpuLGUrbypuLHUrYSpuKSsiIn19ZnVuY3Rpb24gVHUobix0KXtuPUJvLmhzbChuKSx0PUJvLmhzbCh0KTt2YXIgcj1uLmgsZT1uLnMsdT1uLmwsaT10LmgtcixvPXQucy1lLGE9dC5sLXU7cmV0dXJuIGlzTmFOKG8pJiYobz0wLGU9aXNOYU4oZSk/dC5zOmUpLGlzTmFOKGkpPyhpPTAscj1pc05hTihyKT90Lmg6cik6aT4xODA/aS09MzYwOi0xODA+aSYmKGkrPTM2MCksZnVuY3Rpb24obil7cmV0dXJuIGl0KHIraSpuLGUrbypuLHUrYSpuKSsiIn19ZnVuY3Rpb24gcXUobix0KXtuPUJvLmxhYihuKSx0PUJvLmxhYih0KTt2YXIgcj1uLmwsZT1uLmEsdT1uLmIsaT10LmwtcixvPXQuYS1lLGE9dC5iLXU7cmV0dXJuIGZ1bmN0aW9uKG4pe3JldHVybiBmdChyK2kqbixlK28qbix1K2EqbikrIiJ9fWZ1bmN0aW9uIFJ1KG4sdCl7cmV0dXJuIHQtPW4sZnVuY3Rpb24ocil7cmV0dXJuIE1hdGgucm91bmQobit0KnIpfX1mdW5jdGlvbiBEdShuKXt2YXIgdD1bbi5hLG4uYl0scj1bbi5jLG4uZF0sZT1VdSh0KSx1PVB1KHQsciksaT1VdShqdShyLHQsLXUpKXx8MDt0WzBdKnJbMV08clswXSp0WzFdJiYodFswXSo9LTEsdFsxXSo9LTEsZSo9LTEsdSo9LTEpLHRoaXMucm90YXRlPShlP01hdGguYXRhbjIodFsxXSx0WzBdKTpNYXRoLmF0YW4yKC1yWzBdLHJbMV0pKSpMYSx0aGlzLnRyYW5zbGF0ZT1bbi5lLG4uZl0sdGhpcy5zY2FsZT1bZSxpXSx0aGlzLnNrZXc9aT9NYXRoLmF0YW4yKHUsaSkqTGE6MH1mdW5jdGlvbiBQdShuLHQpe3JldHVybiBuWzBdKnRbMF0rblsxXSp0WzFdfWZ1bmN0aW9uIFV1KG4pe3ZhciB0PU1hdGguc3FydChQdShuLG4pKTtyZXR1cm4gdCYmKG5bMF0vPXQsblsxXS89dCksdH1mdW5jdGlvbiBqdShuLHQscil7cmV0dXJuIG5bMF0rPXIqdFswXSxuWzFdKz1yKnRbMV0sbn1mdW5jdGlvbiBIdShuLHQpe3ZhciByLGU9W10sdT1bXSxpPUJvLnRyYW5zZm9ybShuKSxvPUJvLnRyYW5zZm9ybSh0KSxhPWkudHJhbnNsYXRlLGM9by50cmFuc2xhdGUscz1pLnJvdGF0ZSxsPW8ucm90YXRlLGY9aS5za2V3LGg9by5za2V3LGc9aS5zY2FsZSxwPW8uc2NhbGU7cmV0dXJuIGFbMF0hPWNbMF18fGFbMV0hPWNbMV0/KGUucHVzaCgidHJhbnNsYXRlKCIsbnVsbCwiLCIsbnVsbCwiKSIpLHUucHVzaCh7aToxLHg6cHUoYVswXSxjWzBdKX0se2k6Myx4OnB1KGFbMV0sY1sxXSl9KSk6Y1swXXx8Y1sxXT9lLnB1c2goInRyYW5zbGF0ZSgiK2MrIikiKTplLnB1c2goIiIpLHMhPWw/KHMtbD4xODA/bCs9MzYwOmwtcz4xODAmJihzKz0zNjApLHUucHVzaCh7aTplLnB1c2goZS5wb3AoKSsicm90YXRlKCIsbnVsbCwiKSIpLTIseDpwdShzLGwpfSkpOmwmJmUucHVzaChlLnBvcCgpKyJyb3RhdGUoIitsKyIpIiksZiE9aD91LnB1c2goe2k6ZS5wdXNoKGUucG9wKCkrInNrZXdYKCIsbnVsbCwiKSIpLTIseDpwdShmLGgpfSk6aCYmZS5wdXNoKGUucG9wKCkrInNrZXdYKCIraCsiKSIpLGdbMF0hPXBbMF18fGdbMV0hPXBbMV0/KHI9ZS5wdXNoKGUucG9wKCkrInNjYWxlKCIsbnVsbCwiLCIsbnVsbCwiKSIpLHUucHVzaCh7aTpyLTQseDpwdShnWzBdLHBbMF0pfSx7aTpyLTIseDpwdShnWzFdLHBbMV0pfSkpOigxIT1wWzBdfHwxIT1wWzFdKSYmZS5wdXNoKGUucG9wKCkrInNjYWxlKCIrcCsiKSIpLHI9dS5sZW5ndGgsZnVuY3Rpb24obil7Zm9yKHZhciB0LGk9LTE7KytpPHI7KWVbKHQ9dVtpXSkuaV09dC54KG4pO3JldHVybiBlLmpvaW4oIiIpfX1mdW5jdGlvbiBGdShuLHQpe3JldHVybiB0PXQtKG49K24pPzEvKHQtbik6MCxmdW5jdGlvbihyKXtyZXR1cm4oci1uKSp0fX1mdW5jdGlvbiBPdShuLHQpe3JldHVybiB0PXQtKG49K24pPzEvKHQtbik6MCxmdW5jdGlvbihyKXtyZXR1cm4gTWF0aC5tYXgoMCxNYXRoLm1pbigxLChyLW4pKnQpKX19ZnVuY3Rpb24gSXUobil7Zm9yKHZhciB0PW4uc291cmNlLHI9bi50YXJnZXQsZT1adSh0LHIpLHU9W3RdO3QhPT1lOyl0PXQucGFyZW50LHUucHVzaCh0KTtmb3IodmFyIGk9dS5sZW5ndGg7ciE9PWU7KXUuc3BsaWNlKGksMCxyKSxyPXIucGFyZW50O3JldHVybiB1fWZ1bmN0aW9uIFl1KG4pe2Zvcih2YXIgdD1bXSxyPW4ucGFyZW50O251bGwhPXI7KXQucHVzaChuKSxuPXIscj1yLnBhcmVudDtyZXR1cm4gdC5wdXNoKG4pLHR9ZnVuY3Rpb24gWnUobix0KXtpZihuPT09dClyZXR1cm4gbjtmb3IodmFyIHI9WXUobiksZT1ZdSh0KSx1PXIucG9wKCksaT1lLnBvcCgpLG89bnVsbDt1PT09aTspbz11LHU9ci5wb3AoKSxpPWUucG9wKCk7cmV0dXJuIG99ZnVuY3Rpb24gVnUobil7bi5maXhlZHw9Mn1mdW5jdGlvbiAkdShuKXtuLmZpeGVkJj0tN31mdW5jdGlvbiBYdShuKXtuLmZpeGVkfD00LG4ucHg9bi54LG4ucHk9bi55fWZ1bmN0aW9uIEJ1KG4pe24uZml4ZWQmPS01fWZ1bmN0aW9uIEp1KG4sdCxyKXt2YXIgZT0wLHU9MDtpZihuLmNoYXJnZT0wLCFuLmxlYWYpZm9yKHZhciBpLG89bi5ub2RlcyxhPW8ubGVuZ3RoLGM9LTE7KytjPGE7KWk9b1tjXSxudWxsIT1pJiYoSnUoaSx0LHIpLG4uY2hhcmdlKz1pLmNoYXJnZSxlKz1pLmNoYXJnZSppLmN4LHUrPWkuY2hhcmdlKmkuY3kpO2lmKG4ucG9pbnQpe24ubGVhZnx8KG4ucG9pbnQueCs9TWF0aC5yYW5kb20oKS0uNSxuLnBvaW50LnkrPU1hdGgucmFuZG9tKCktLjUpO3ZhciBzPXQqcltuLnBvaW50LmluZGV4XTtuLmNoYXJnZSs9bi5wb2ludENoYXJnZT1zLGUrPXMqbi5wb2ludC54LHUrPXMqbi5wb2ludC55fW4uY3g9ZS9uLmNoYXJnZSxuLmN5PXUvbi5jaGFyZ2V9ZnVuY3Rpb24gV3Uobix0KXtyZXR1cm4gQm8ucmViaW5kKG4sdCwic29ydCIsImNoaWxkcmVuIiwidmFsdWUiKSxuLm5vZGVzPW4sbi5saW5rcz1yaSxufWZ1bmN0aW9uIEd1KG4sdCl7Zm9yKHZhciByPVtuXTtudWxsIT0obj1yLnBvcCgpKTspaWYodChuKSwodT1uLmNoaWxkcmVuKSYmKGU9dS5sZW5ndGgpKWZvcih2YXIgZSx1Oy0tZT49MDspci5wdXNoKHVbZV0pfWZ1bmN0aW9uIEt1KG4sdCl7Zm9yKHZhciByPVtuXSxlPVtdO251bGwhPShuPXIucG9wKCkpOylpZihlLnB1c2gobiksKGk9bi5jaGlsZHJlbikmJih1PWkubGVuZ3RoKSlmb3IodmFyIHUsaSxvPS0xOysrbzx1OylyLnB1c2goaVtvXSk7Zm9yKDtudWxsIT0obj1lLnBvcCgpKTspdChuKX1mdW5jdGlvbiBRdShuKXtyZXR1cm4gbi5jaGlsZHJlbn1mdW5jdGlvbiBuaShuKXtyZXR1cm4gbi52YWx1ZX1mdW5jdGlvbiB0aShuLHQpe3JldHVybiB0LnZhbHVlLW4udmFsdWV9ZnVuY3Rpb24gcmkobil7cmV0dXJuIEJvLm1lcmdlKG4ubWFwKGZ1bmN0aW9uKG4pe3JldHVybihuLmNoaWxkcmVufHxbXSkubWFwKGZ1bmN0aW9uKHQpe3JldHVybntzb3VyY2U6bix0YXJnZXQ6dH19KX0pKX1mdW5jdGlvbiBlaShuKXtyZXR1cm4gbi54fWZ1bmN0aW9uIHVpKG4pe3JldHVybiBuLnl9ZnVuY3Rpb24gaWkobix0LHIpe24ueTA9dCxuLnk9cn1mdW5jdGlvbiBvaShuKXtyZXR1cm4gQm8ucmFuZ2Uobi5sZW5ndGgpfWZ1bmN0aW9uIGFpKG4pe2Zvcih2YXIgdD0tMSxyPW5bMF0ubGVuZ3RoLGU9W107Kyt0PHI7KWVbdF09MDtyZXR1cm4gZX1mdW5jdGlvbiBjaShuKXtmb3IodmFyIHQscj0xLGU9MCx1PW5bMF1bMV0saT1uLmxlbmd0aDtpPnI7KytyKSh0PW5bcl1bMV0pPnUmJihlPXIsdT10KTtyZXR1cm4gZX1mdW5jdGlvbiBzaShuKXtyZXR1cm4gbi5yZWR1Y2UobGksMCl9ZnVuY3Rpb24gbGkobix0KXtyZXR1cm4gbit0WzFdfWZ1bmN0aW9uIGZpKG4sdCl7cmV0dXJuIGhpKG4sTWF0aC5jZWlsKE1hdGgubG9nKHQubGVuZ3RoKS9NYXRoLkxOMisxKSl9ZnVuY3Rpb24gaGkobix0KXtmb3IodmFyIHI9LTEsZT0rblswXSx1PShuWzFdLWUpL3QsaT1bXTsrK3I8PXQ7KWlbcl09dSpyK2U7cmV0dXJuIGl9ZnVuY3Rpb24gZ2kobil7cmV0dXJuW0JvLm1pbihuKSxCby5tYXgobildfWZ1bmN0aW9uIHBpKG4sdCl7cmV0dXJuIG4udmFsdWUtdC52YWx1ZX1mdW5jdGlvbiB2aShuLHQpe3ZhciByPW4uX3BhY2tfbmV4dDtuLl9wYWNrX25leHQ9dCx0Ll9wYWNrX3ByZXY9bix0Ll9wYWNrX25leHQ9cixyLl9wYWNrX3ByZXY9dH1mdW5jdGlvbiBkaShuLHQpe24uX3BhY2tfbmV4dD10LHQuX3BhY2tfcHJldj1ufWZ1bmN0aW9uIG1pKG4sdCl7dmFyIHI9dC54LW4ueCxlPXQueS1uLnksdT1uLnIrdC5yO3JldHVybi45OTkqdSp1PnIqcitlKmV9ZnVuY3Rpb24geWkobil7ZnVuY3Rpb24gdChuKXtsPU1hdGgubWluKG4ueC1uLnIsbCksZj1NYXRoLm1heChuLngrbi5yLGYpLGg9TWF0aC5taW4obi55LW4ucixoKSxnPU1hdGgubWF4KG4ueStuLnIsZyl9aWYoKHI9bi5jaGlsZHJlbikmJihzPXIubGVuZ3RoKSl7dmFyIHIsZSx1LGksbyxhLGMscyxsPTEvMCxmPS0xLzAsaD0xLzAsZz0tMS8wO2lmKHIuZm9yRWFjaCh4aSksZT1yWzBdLGUueD0tZS5yLGUueT0wLHQoZSkscz4xJiYodT1yWzFdLHUueD11LnIsdS55PTAsdCh1KSxzPjIpKWZvcihpPXJbMl0sYmkoZSx1LGkpLHQoaSksdmkoZSxpKSxlLl9wYWNrX3ByZXY9aSx2aShpLHUpLHU9ZS5fcGFja19uZXh0LG89MztzPm87bysrKXtiaShlLHUsaT1yW29dKTt2YXIgcD0wLHY9MSxkPTE7Zm9yKGE9dS5fcGFja19uZXh0O2EhPT11O2E9YS5fcGFja19uZXh0LHYrKylpZihtaShhLGkpKXtwPTE7YnJlYWt9aWYoMT09cClmb3IoYz1lLl9wYWNrX3ByZXY7YyE9PWEuX3BhY2tfcHJldiYmIW1pKGMsaSk7Yz1jLl9wYWNrX3ByZXYsZCsrKTtwPyhkPnZ8fHY9PWQmJnUucjxlLnI/ZGkoZSx1PWEpOmRpKGU9Yyx1KSxvLS0pOih2aShlLGkpLHU9aSx0KGkpKX12YXIgbT0obCtmKS8yLHk9KGgrZykvMix4PTA7Zm9yKG89MDtzPm87bysrKWk9cltvXSxpLngtPW0saS55LT15LHg9TWF0aC5tYXgoeCxpLnIrTWF0aC5zcXJ0KGkueCppLngraS55KmkueSkpO24ucj14LHIuZm9yRWFjaChNaSl9fWZ1bmN0aW9uIHhpKG4pe24uX3BhY2tfbmV4dD1uLl9wYWNrX3ByZXY9bn1mdW5jdGlvbiBNaShuKXtkZWxldGUgbi5fcGFja19uZXh0LGRlbGV0ZSBuLl9wYWNrX3ByZXZ9ZnVuY3Rpb24gX2kobix0LHIsZSl7dmFyIHU9bi5jaGlsZHJlbjtpZihuLng9dCs9ZSpuLngsbi55PXIrPWUqbi55LG4ucio9ZSx1KWZvcih2YXIgaT0tMSxvPXUubGVuZ3RoOysraTxvOylfaSh1W2ldLHQscixlKX1mdW5jdGlvbiBiaShuLHQscil7dmFyIGU9bi5yK3Iucix1PXQueC1uLngsaT10Lnktbi55O2lmKGUmJih1fHxpKSl7dmFyIG89dC5yK3IucixhPXUqdStpKmk7byo9byxlKj1lO3ZhciBjPS41KyhlLW8pLygyKmEpLHM9TWF0aC5zcXJ0KE1hdGgubWF4KDAsMipvKihlK2EpLShlLT1hKSplLW8qbykpLygyKmEpO3IueD1uLngrYyp1K3MqaSxyLnk9bi55K2MqaS1zKnV9ZWxzZSByLng9bi54K2Usci55PW4ueX1mdW5jdGlvbiB3aShuLHQpe3JldHVybiBuLnBhcmVudD09dC5wYXJlbnQ/MToyfWZ1bmN0aW9uIFNpKG4pe3ZhciB0PW4uY2hpbGRyZW47cmV0dXJuIHQubGVuZ3RoP3RbMF06bi50fWZ1bmN0aW9uIGtpKG4pe3ZhciB0LHI9bi5jaGlsZHJlbjtyZXR1cm4odD1yLmxlbmd0aCk/clt0LTFdOm4udH1mdW5jdGlvbiBFaShuLHQscil7dmFyIGU9ci8odC5pLW4uaSk7dC5jLT1lLHQucys9cixuLmMrPWUsdC56Kz1yLHQubSs9cn1mdW5jdGlvbiBBaShuKXtmb3IodmFyIHQscj0wLGU9MCx1PW4uY2hpbGRyZW4saT11Lmxlbmd0aDstLWk+PTA7KXQ9dVtpXSx0LnorPXIsdC5tKz1yLHIrPXQucysoZSs9dC5jKX1mdW5jdGlvbiBDaShuLHQscil7cmV0dXJuIG4uYS5wYXJlbnQ9PT10LnBhcmVudD9uLmE6cn1mdW5jdGlvbiBOaShuKXtyZXR1cm4gMStCby5tYXgobixmdW5jdGlvbihuKXtyZXR1cm4gbi55fSl9ZnVuY3Rpb24gemkobil7cmV0dXJuIG4ucmVkdWNlKGZ1bmN0aW9uKG4sdCl7cmV0dXJuIG4rdC54fSwwKS9uLmxlbmd0aH1mdW5jdGlvbiBMaShuKXt2YXIgdD1uLmNoaWxkcmVuO3JldHVybiB0JiZ0Lmxlbmd0aD9MaSh0WzBdKTpufWZ1bmN0aW9uIFRpKG4pe3ZhciB0LHI9bi5jaGlsZHJlbjtyZXR1cm4gciYmKHQ9ci5sZW5ndGgpP1RpKHJbdC0xXSk6bn1mdW5jdGlvbiBxaShuKXtyZXR1cm57eDpuLngseTpuLnksZHg6bi5keCxkeTpuLmR5fX1mdW5jdGlvbiBSaShuLHQpe3ZhciByPW4ueCt0WzNdLGU9bi55K3RbMF0sdT1uLmR4LXRbMV0tdFszXSxpPW4uZHktdFswXS10WzJdO3JldHVybiAwPnUmJihyKz11LzIsdT0wKSwwPmkmJihlKz1pLzIsaT0wKSx7eDpyLHk6ZSxkeDp1LGR5Oml9fWZ1bmN0aW9uIERpKG4pe3ZhciB0PW5bMF0scj1uW24ubGVuZ3RoLTFdO3JldHVybiByPnQ/W3Qscl06W3IsdF19ZnVuY3Rpb24gUGkobil7cmV0dXJuIG4ucmFuZ2VFeHRlbnQ/bi5yYW5nZUV4dGVudCgpOkRpKG4ucmFuZ2UoKSl9ZnVuY3Rpb24gVWkobix0LHIsZSl7dmFyIHU9cihuWzBdLG5bMV0pLGk9ZSh0WzBdLHRbMV0pO3JldHVybiBmdW5jdGlvbihuKXtyZXR1cm4gaSh1KG4pKX19ZnVuY3Rpb24gamkobix0KXt2YXIgcixlPTAsdT1uLmxlbmd0aC0xLGk9bltlXSxvPW5bdV07cmV0dXJuIGk+byYmKHI9ZSxlPXUsdT1yLHI9aSxpPW8sbz1yKSxuW2VdPXQuZmxvb3IoaSksblt1XT10LmNlaWwobyksbn1mdW5jdGlvbiBIaShuKXtyZXR1cm4gbj97Zmxvb3I6ZnVuY3Rpb24odCl7cmV0dXJuIE1hdGguZmxvb3IodC9uKSpufSxjZWlsOmZ1bmN0aW9uKHQpe3JldHVybiBNYXRoLmNlaWwodC9uKSpufX06aHN9ZnVuY3Rpb24gRmkobix0LHIsZSl7dmFyIHU9W10saT1bXSxvPTAsYT1NYXRoLm1pbihuLmxlbmd0aCx0Lmxlbmd0aCktMTtmb3IoblthXTxuWzBdJiYobj1uLnNsaWNlKCkucmV2ZXJzZSgpLHQ9dC5zbGljZSgpLnJldmVyc2UoKSk7KytvPD1hOyl1LnB1c2gocihuW28tMV0sbltvXSkpLGkucHVzaChlKHRbby0xXSx0W29dKSk7cmV0dXJuIGZ1bmN0aW9uKHQpe3ZhciByPUJvLmJpc2VjdChuLHQsMSxhKS0xO3JldHVybiBpW3JdKHVbcl0odCkpfX1mdW5jdGlvbiBPaShuLHQscixlKXtmdW5jdGlvbiB1KCl7dmFyIHU9TWF0aC5taW4obi5sZW5ndGgsdC5sZW5ndGgpPjI/Rmk6VWksYz1lP091OkZ1O3JldHVybiBvPXUobix0LGMsciksYT11KHQsbixjLGR1KSxpfWZ1bmN0aW9uIGkobil7cmV0dXJuIG8obil9dmFyIG8sYTtyZXR1cm4gaS5pbnZlcnQ9ZnVuY3Rpb24obil7cmV0dXJuIGEobil9LGkuZG9tYWluPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhuPXQubWFwKE51bWJlciksdSgpKTpufSxpLnJhbmdlPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh0PW4sdSgpKTp0fSxpLnJhbmdlUm91bmQ9ZnVuY3Rpb24obil7cmV0dXJuIGkucmFuZ2UobikuaW50ZXJwb2xhdGUoUnUpfSxpLmNsYW1wPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhlPW4sdSgpKTplfSxpLmludGVycG9sYXRlPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhyPW4sdSgpKTpyfSxpLnRpY2tzPWZ1bmN0aW9uKHQpe3JldHVybiBWaShuLHQpfSxpLnRpY2tGb3JtYXQ9ZnVuY3Rpb24odCxyKXtyZXR1cm4gJGkobix0LHIpfSxpLm5pY2U9ZnVuY3Rpb24odCl7cmV0dXJuIFlpKG4sdCksdSgpfSxpLmNvcHk9ZnVuY3Rpb24oKXtyZXR1cm4gT2kobix0LHIsZSl9LHUoKX1mdW5jdGlvbiBJaShuLHQpe3JldHVybiBCby5yZWJpbmQobix0LCJyYW5nZSIsInJhbmdlUm91bmQiLCJpbnRlcnBvbGF0ZSIsImNsYW1wIil9ZnVuY3Rpb24gWWkobix0KXtyZXR1cm4gamkobixIaShaaShuLHQpWzJdKSl9ZnVuY3Rpb24gWmkobix0KXtudWxsPT10JiYodD0xMCk7dmFyIHI9RGkobiksZT1yWzFdLXJbMF0sdT1NYXRoLnBvdygxMCxNYXRoLmZsb29yKE1hdGgubG9nKGUvdCkvTWF0aC5MTjEwKSksaT10L2UqdTtyZXR1cm4uMTU+PWk/dSo9MTA6LjM1Pj1pP3UqPTU6Ljc1Pj1pJiYodSo9MiksclswXT1NYXRoLmNlaWwoclswXS91KSp1LHJbMV09TWF0aC5mbG9vcihyWzFdL3UpKnUrLjUqdSxyWzJdPXUscn1mdW5jdGlvbiBWaShuLHQpe3JldHVybiBCby5yYW5nZS5hcHBseShCbyxaaShuLHQpKX1mdW5jdGlvbiAkaShuLHQscil7dmFyIGU9Wmkobix0KTtpZihyKXt2YXIgdT1uYy5leGVjKHIpO2lmKHUuc2hpZnQoKSwicyI9PT11WzhdKXt2YXIgaT1Cby5mb3JtYXRQcmVmaXgoTWF0aC5tYXgoY2EoZVswXSksY2EoZVsxXSkpKTtyZXR1cm4gdVs3XXx8KHVbN109Ii4iK1hpKGkuc2NhbGUoZVsyXSkpKSx1WzhdPSJmIixyPUJvLmZvcm1hdCh1LmpvaW4oIiIpKSxmdW5jdGlvbihuKXtyZXR1cm4gcihpLnNjYWxlKG4pKStpLnN5bWJvbH19dVs3XXx8KHVbN109Ii4iK0JpKHVbOF0sZSkpLHI9dS5qb2luKCIiKX1lbHNlIHI9IiwuIitYaShlWzJdKSsiZiI7cmV0dXJuIEJvLmZvcm1hdChyKX1mdW5jdGlvbiBYaShuKXtyZXR1cm4tTWF0aC5mbG9vcihNYXRoLmxvZyhuKS9NYXRoLkxOMTArLjAxKX1mdW5jdGlvbiBCaShuLHQpe3ZhciByPVhpKHRbMl0pO3JldHVybiBuIGluIGdzP01hdGguYWJzKHItWGkoTWF0aC5tYXgoY2EodFswXSksY2EodFsxXSkpKSkrICsoImUiIT09bik6ci0yKigiJSI9PT1uKX1mdW5jdGlvbiBKaShuLHQscixlKXtmdW5jdGlvbiB1KG4pe3JldHVybihyP01hdGgubG9nKDA+bj8wOm4pOi1NYXRoLmxvZyhuPjA/MDotbikpL01hdGgubG9nKHQpfWZ1bmN0aW9uIGkobil7cmV0dXJuIHI/TWF0aC5wb3codCxuKTotTWF0aC5wb3codCwtbil9ZnVuY3Rpb24gbyh0KXtyZXR1cm4gbih1KHQpKX1yZXR1cm4gby5pbnZlcnQ9ZnVuY3Rpb24odCl7cmV0dXJuIGkobi5pbnZlcnQodCkpfSxvLmRvbWFpbj1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8ocj10WzBdPj0wLG4uZG9tYWluKChlPXQubWFwKE51bWJlcikpLm1hcCh1KSksbyk6ZX0sby5iYXNlPWZ1bmN0aW9uKHIpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh0PStyLG4uZG9tYWluKGUubWFwKHUpKSxvKTp0fSxvLm5pY2U9ZnVuY3Rpb24oKXt2YXIgdD1qaShlLm1hcCh1KSxyP01hdGg6dnMpO3JldHVybiBuLmRvbWFpbih0KSxlPXQubWFwKGkpLG99LG8udGlja3M9ZnVuY3Rpb24oKXt2YXIgbj1EaShlKSxvPVtdLGE9blswXSxjPW5bMV0scz1NYXRoLmZsb29yKHUoYSkpLGw9TWF0aC5jZWlsKHUoYykpLGY9dCUxPzI6dDtpZihpc0Zpbml0ZShsLXMpKXtpZihyKXtmb3IoO2w+cztzKyspZm9yKHZhciBoPTE7Zj5oO2grKylvLnB1c2goaShzKSpoKTtvLnB1c2goaShzKSl9ZWxzZSBmb3Ioby5wdXNoKGkocykpO3MrKzxsOylmb3IodmFyIGg9Zi0xO2g+MDtoLS0pby5wdXNoKGkocykqaCk7Zm9yKHM9MDtvW3NdPGE7cysrKTtmb3IobD1vLmxlbmd0aDtvW2wtMV0+YztsLS0pO289by5zbGljZShzLGwpfXJldHVybiBvfSxvLnRpY2tGb3JtYXQ9ZnVuY3Rpb24obix0KXtpZighYXJndW1lbnRzLmxlbmd0aClyZXR1cm4gcHM7YXJndW1lbnRzLmxlbmd0aDwyP3Q9cHM6ImZ1bmN0aW9uIiE9dHlwZW9mIHQmJih0PUJvLmZvcm1hdCh0KSk7dmFyIGUsYT1NYXRoLm1heCguMSxuL28udGlja3MoKS5sZW5ndGgpLGM9cj8oZT0xZS0xMixNYXRoLmNlaWwpOihlPS0xZS0xMixNYXRoLmZsb29yKTtyZXR1cm4gZnVuY3Rpb24obil7cmV0dXJuIG4vaShjKHUobikrZSkpPD1hP3Qobik6IiJ9fSxvLmNvcHk9ZnVuY3Rpb24oKXtyZXR1cm4gSmkobi5jb3B5KCksdCxyLGUpfSxJaShvLG4pfWZ1bmN0aW9uIFdpKG4sdCxyKXtmdW5jdGlvbiBlKHQpe3JldHVybiBuKHUodCkpfXZhciB1PUdpKHQpLGk9R2koMS90KTtyZXR1cm4gZS5pbnZlcnQ9ZnVuY3Rpb24odCl7cmV0dXJuIGkobi5pbnZlcnQodCkpfSxlLmRvbWFpbj1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obi5kb21haW4oKHI9dC5tYXAoTnVtYmVyKSkubWFwKHUpKSxlKTpyfSxlLnRpY2tzPWZ1bmN0aW9uKG4pe3JldHVybiBWaShyLG4pfSxlLnRpY2tGb3JtYXQ9ZnVuY3Rpb24obix0KXtyZXR1cm4gJGkocixuLHQpfSxlLm5pY2U9ZnVuY3Rpb24obil7cmV0dXJuIGUuZG9tYWluKFlpKHIsbikpfSxlLmV4cG9uZW50PWZ1bmN0aW9uKG8pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh1PUdpKHQ9byksaT1HaSgxL3QpLG4uZG9tYWluKHIubWFwKHUpKSxlKTp0fSxlLmNvcHk9ZnVuY3Rpb24oKXtyZXR1cm4gV2kobi5jb3B5KCksdCxyKX0sSWkoZSxuKX1mdW5jdGlvbiBHaShuKXtyZXR1cm4gZnVuY3Rpb24odCl7cmV0dXJuIDA+dD8tTWF0aC5wb3coLXQsbik6TWF0aC5wb3codCxuKX19ZnVuY3Rpb24gS2kobix0KXtmdW5jdGlvbiByKHIpe3JldHVybiBpWygodS5nZXQocil8fCgicmFuZ2UiPT09dC50P3Uuc2V0KHIsbi5wdXNoKHIpKTowLzApKS0xKSVpLmxlbmd0aF19ZnVuY3Rpb24gZSh0LHIpe3JldHVybiBCby5yYW5nZShuLmxlbmd0aCkubWFwKGZ1bmN0aW9uKG4pe3JldHVybiB0K3Iqbn0pfXZhciB1LGksYTtyZXR1cm4gci5kb21haW49ZnVuY3Rpb24oZSl7aWYoIWFyZ3VtZW50cy5sZW5ndGgpcmV0dXJuIG47bj1bXSx1PW5ldyBvO2Zvcih2YXIgaSxhPS0xLGM9ZS5sZW5ndGg7KythPGM7KXUuaGFzKGk9ZVthXSl8fHUuc2V0KGksbi5wdXNoKGkpKTtyZXR1cm4gclt0LnRdLmFwcGx5KHIsdC5hKX0sci5yYW5nZT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oaT1uLGE9MCx0PXt0OiJyYW5nZSIsYTphcmd1bWVudHN9LHIpOml9LHIucmFuZ2VQb2ludHM9ZnVuY3Rpb24odSxvKXthcmd1bWVudHMubGVuZ3RoPDImJihvPTApO3ZhciBjPXVbMF0scz11WzFdLGw9KHMtYykvKE1hdGgubWF4KDEsbi5sZW5ndGgtMSkrbyk7cmV0dXJuIGk9ZShuLmxlbmd0aDwyPyhjK3MpLzI6YytsKm8vMixsKSxhPTAsdD17dDoicmFuZ2VQb2ludHMiLGE6YXJndW1lbnRzfSxyfSxyLnJhbmdlQmFuZHM9ZnVuY3Rpb24odSxvLGMpe2FyZ3VtZW50cy5sZW5ndGg8MiYmKG89MCksYXJndW1lbnRzLmxlbmd0aDwzJiYoYz1vKTt2YXIgcz11WzFdPHVbMF0sbD11W3MtMF0sZj11WzEtc10saD0oZi1sKS8obi5sZW5ndGgtbysyKmMpO3JldHVybiBpPWUobCtoKmMsaCkscyYmaS5yZXZlcnNlKCksYT1oKigxLW8pLHQ9e3Q6InJhbmdlQmFuZHMiLGE6YXJndW1lbnRzfSxyfSxyLnJhbmdlUm91bmRCYW5kcz1mdW5jdGlvbih1LG8sYyl7YXJndW1lbnRzLmxlbmd0aDwyJiYobz0wKSxhcmd1bWVudHMubGVuZ3RoPDMmJihjPW8pO3ZhciBzPXVbMV08dVswXSxsPXVbcy0wXSxmPXVbMS1zXSxoPU1hdGguZmxvb3IoKGYtbCkvKG4ubGVuZ3RoLW8rMipjKSksZz1mLWwtKG4ubGVuZ3RoLW8pKmg7cmV0dXJuIGk9ZShsK01hdGgucm91bmQoZy8yKSxoKSxzJiZpLnJldmVyc2UoKSxhPU1hdGgucm91bmQoaCooMS1vKSksdD17dDoicmFuZ2VSb3VuZEJhbmRzIixhOmFyZ3VtZW50c30scn0sci5yYW5nZUJhbmQ9ZnVuY3Rpb24oKXtyZXR1cm4gYX0sci5yYW5nZUV4dGVudD1mdW5jdGlvbigpe3JldHVybiBEaSh0LmFbMF0pfSxyLmNvcHk9ZnVuY3Rpb24oKXtyZXR1cm4gS2kobix0KX0sci5kb21haW4obil9ZnVuY3Rpb24gUWkocixlKXtmdW5jdGlvbiB1KCl7dmFyIG49MCx0PWUubGVuZ3RoO2ZvcihvPVtdOysrbjx0OylvW24tMV09Qm8ucXVhbnRpbGUocixuL3QpO3JldHVybiBpfWZ1bmN0aW9uIGkobil7cmV0dXJuIGlzTmFOKG49K24pP3ZvaWQgMDplW0JvLmJpc2VjdChvLG4pXX12YXIgbztyZXR1cm4gaS5kb21haW49ZnVuY3Rpb24oZSl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHI9ZS5maWx0ZXIodCkuc29ydChuKSx1KCkpOnJ9LGkucmFuZ2U9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGU9bix1KCkpOmV9LGkucXVhbnRpbGVzPWZ1bmN0aW9uKCl7cmV0dXJuIG99LGkuaW52ZXJ0RXh0ZW50PWZ1bmN0aW9uKG4pe3JldHVybiBuPWUuaW5kZXhPZihuKSwwPm4/WzAvMCwwLzBdOltuPjA/b1tuLTFdOnJbMF0sbjxvLmxlbmd0aD9vW25dOnJbci5sZW5ndGgtMV1dfSxpLmNvcHk9ZnVuY3Rpb24oKXtyZXR1cm4gUWkocixlKX0sdSgpfWZ1bmN0aW9uIG5vKG4sdCxyKXtmdW5jdGlvbiBlKHQpe3JldHVybiByW01hdGgubWF4KDAsTWF0aC5taW4obyxNYXRoLmZsb29yKGkqKHQtbikpKSldfWZ1bmN0aW9uIHUoKXtyZXR1cm4gaT1yLmxlbmd0aC8odC1uKSxvPXIubGVuZ3RoLTEsZX12YXIgaSxvO3JldHVybiBlLmRvbWFpbj1mdW5jdGlvbihyKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obj0rclswXSx0PStyW3IubGVuZ3RoLTFdLHUoKSk6W24sdF19LGUucmFuZ2U9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHI9bix1KCkpOnJ9LGUuaW52ZXJ0RXh0ZW50PWZ1bmN0aW9uKHQpe3JldHVybiB0PXIuaW5kZXhPZih0KSx0PTA+dD8wLzA6dC9pK24sW3QsdCsxL2ldfSxlLmNvcHk9ZnVuY3Rpb24oKXtyZXR1cm4gbm8obix0LHIpfSx1KCl9ZnVuY3Rpb24gdG8obix0KXtmdW5jdGlvbiByKHIpe3JldHVybiByPj1yP3RbQm8uYmlzZWN0KG4scildOnZvaWQgMH1yZXR1cm4gci5kb21haW49ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KG49dCxyKTpufSxyLnJhbmdlPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh0PW4scik6dH0sci5pbnZlcnRFeHRlbnQ9ZnVuY3Rpb24ocil7cmV0dXJuIHI9dC5pbmRleE9mKHIpLFtuW3ItMV0sbltyXV19LHIuY29weT1mdW5jdGlvbigpe3JldHVybiB0byhuLHQpfSxyfWZ1bmN0aW9uIHJvKG4pe2Z1bmN0aW9uIHQobil7cmV0dXJuK259cmV0dXJuIHQuaW52ZXJ0PXQsdC5kb21haW49dC5yYW5nZT1mdW5jdGlvbihyKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obj1yLm1hcCh0KSx0KTpufSx0LnRpY2tzPWZ1bmN0aW9uKHQpe3JldHVybiBWaShuLHQpfSx0LnRpY2tGb3JtYXQ9ZnVuY3Rpb24odCxyKXtyZXR1cm4gJGkobix0LHIpfSx0LmNvcHk9ZnVuY3Rpb24oKXtyZXR1cm4gcm8obil9LHR9ZnVuY3Rpb24gZW8obil7cmV0dXJuIG4uaW5uZXJSYWRpdXN9ZnVuY3Rpb24gdW8obil7cmV0dXJuIG4ub3V0ZXJSYWRpdXN9ZnVuY3Rpb24gaW8obil7cmV0dXJuIG4uc3RhcnRBbmdsZX1mdW5jdGlvbiBvbyhuKXtyZXR1cm4gbi5lbmRBbmdsZX1mdW5jdGlvbiBhbyhuKXtmdW5jdGlvbiB0KHQpe2Z1bmN0aW9uIG8oKXtzLnB1c2goIk0iLGkobihsKSxhKSl9Zm9yKHZhciBjLHM9W10sbD1bXSxmPS0xLGg9dC5sZW5ndGgsZz1FdChyKSxwPUV0KGUpOysrZjxoOyl1LmNhbGwodGhpcyxjPXRbZl0sZik/bC5wdXNoKFsrZy5jYWxsKHRoaXMsYyxmKSwrcC5jYWxsKHRoaXMsYyxmKV0pOmwubGVuZ3RoJiYobygpLGw9W10pO3JldHVybiBsLmxlbmd0aCYmbygpLHMubGVuZ3RoP3Muam9pbigiIik6bnVsbH12YXIgcj1BZSxlPUNlLHU9QXIsaT1jbyxvPWkua2V5LGE9Ljc7cmV0dXJuIHQueD1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8ocj1uLHQpOnJ9LHQueT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oZT1uLHQpOmV9LHQuZGVmaW5lZD1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8odT1uLHQpOnV9LHQuaW50ZXJwb2xhdGU9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KG89ImZ1bmN0aW9uIj09dHlwZW9mIG4/aT1uOihpPWJzLmdldChuKXx8Y28pLmtleSx0KTpvfSx0LnRlbnNpb249ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGE9bix0KTphfSx0fWZ1bmN0aW9uIGNvKG4pe3JldHVybiBuLmpvaW4oIkwiKX1mdW5jdGlvbiBzbyhuKXtyZXR1cm4gY28obikrIloifWZ1bmN0aW9uIGxvKG4pe2Zvcih2YXIgdD0wLHI9bi5sZW5ndGgsZT1uWzBdLHU9W2VbMF0sIiwiLGVbMV1dOysrdDxyOyl1LnB1c2goIkgiLChlWzBdKyhlPW5bdF0pWzBdKS8yLCJWIixlWzFdKTtyZXR1cm4gcj4xJiZ1LnB1c2goIkgiLGVbMF0pLHUuam9pbigiIil9ZnVuY3Rpb24gZm8obil7Zm9yKHZhciB0PTAscj1uLmxlbmd0aCxlPW5bMF0sdT1bZVswXSwiLCIsZVsxXV07Kyt0PHI7KXUucHVzaCgiViIsKGU9blt0XSlbMV0sIkgiLGVbMF0pO3JldHVybiB1LmpvaW4oIiIpfWZ1bmN0aW9uIGhvKG4pe2Zvcih2YXIgdD0wLHI9bi5sZW5ndGgsZT1uWzBdLHU9W2VbMF0sIiwiLGVbMV1dOysrdDxyOyl1LnB1c2goIkgiLChlPW5bdF0pWzBdLCJWIixlWzFdKTtyZXR1cm4gdS5qb2luKCIiKX1mdW5jdGlvbiBnbyhuLHQpe3JldHVybiBuLmxlbmd0aDw0P2NvKG4pOm5bMV0rbW8obi5zbGljZSgxLG4ubGVuZ3RoLTEpLHlvKG4sdCkpfWZ1bmN0aW9uIHBvKG4sdCl7cmV0dXJuIG4ubGVuZ3RoPDM/Y28obik6blswXSttbygobi5wdXNoKG5bMF0pLG4pLHlvKFtuW24ubGVuZ3RoLTJdXS5jb25jYXQobixbblsxXV0pLHQpKX1mdW5jdGlvbiB2byhuLHQpe3JldHVybiBuLmxlbmd0aDwzP2NvKG4pOm5bMF0rbW8obix5byhuLHQpKX1mdW5jdGlvbiBtbyhuLHQpe2lmKHQubGVuZ3RoPDF8fG4ubGVuZ3RoIT10Lmxlbmd0aCYmbi5sZW5ndGghPXQubGVuZ3RoKzIpcmV0dXJuIGNvKG4pO3ZhciByPW4ubGVuZ3RoIT10Lmxlbmd0aCxlPSIiLHU9blswXSxpPW5bMV0sbz10WzBdLGE9byxjPTE7aWYociYmKGUrPSJRIisoaVswXS0yKm9bMF0vMykrIiwiKyhpWzFdLTIqb1sxXS8zKSsiLCIraVswXSsiLCIraVsxXSx1PW5bMV0sYz0yKSx0Lmxlbmd0aD4xKXthPXRbMV0saT1uW2NdLGMrKyxlKz0iQyIrKHVbMF0rb1swXSkrIiwiKyh1WzFdK29bMV0pKyIsIisoaVswXS1hWzBdKSsiLCIrKGlbMV0tYVsxXSkrIiwiK2lbMF0rIiwiK2lbMV07Zm9yKHZhciBzPTI7czx0Lmxlbmd0aDtzKyssYysrKWk9bltjXSxhPXRbc10sZSs9IlMiKyhpWzBdLWFbMF0pKyIsIisoaVsxXS1hWzFdKSsiLCIraVswXSsiLCIraVsxXX1pZihyKXt2YXIgbD1uW2NdO2UrPSJRIisoaVswXSsyKmFbMF0vMykrIiwiKyhpWzFdKzIqYVsxXS8zKSsiLCIrbFswXSsiLCIrbFsxXX1yZXR1cm4gZX1mdW5jdGlvbiB5byhuLHQpe2Zvcih2YXIgcixlPVtdLHU9KDEtdCkvMixpPW5bMF0sbz1uWzFdLGE9MSxjPW4ubGVuZ3RoOysrYTxjOylyPWksaT1vLG89blthXSxlLnB1c2goW3UqKG9bMF0tclswXSksdSoob1sxXS1yWzFdKV0pO3JldHVybiBlfWZ1bmN0aW9uIHhvKG4pe2lmKG4ubGVuZ3RoPDMpcmV0dXJuIGNvKG4pO3ZhciB0PTEscj1uLmxlbmd0aCxlPW5bMF0sdT1lWzBdLGk9ZVsxXSxvPVt1LHUsdSwoZT1uWzFdKVswXV0sYT1baSxpLGksZVsxXV0sYz1bdSwiLCIsaSwiTCIsd28oa3MsbyksIiwiLHdvKGtzLGEpXTtmb3Iobi5wdXNoKG5bci0xXSk7Kyt0PD1yOyllPW5bdF0sby5zaGlmdCgpLG8ucHVzaChlWzBdKSxhLnNoaWZ0KCksYS5wdXNoKGVbMV0pLFNvKGMsbyxhKTtyZXR1cm4gbi5wb3AoKSxjLnB1c2goIkwiLGUpLGMuam9pbigiIil9ZnVuY3Rpb24gTW8obil7aWYobi5sZW5ndGg8NClyZXR1cm4gY28obik7Zm9yKHZhciB0LHI9W10sZT0tMSx1PW4ubGVuZ3RoLGk9WzBdLG89WzBdOysrZTwzOyl0PW5bZV0saS5wdXNoKHRbMF0pLG8ucHVzaCh0WzFdKTtmb3Ioci5wdXNoKHdvKGtzLGkpKyIsIit3byhrcyxvKSksLS1lOysrZTx1Oyl0PW5bZV0saS5zaGlmdCgpLGkucHVzaCh0WzBdKSxvLnNoaWZ0KCksby5wdXNoKHRbMV0pLFNvKHIsaSxvKTtyZXR1cm4gci5qb2luKCIiKX1mdW5jdGlvbiBfbyhuKXtmb3IodmFyIHQscixlPS0xLHU9bi5sZW5ndGgsaT11KzQsbz1bXSxhPVtdOysrZTw0OylyPW5bZSV1XSxvLnB1c2goclswXSksYS5wdXNoKHJbMV0pO2Zvcih0PVt3byhrcyxvKSwiLCIsd28oa3MsYSldLC0tZTsrK2U8aTspcj1uW2UldV0sby5zaGlmdCgpLG8ucHVzaChyWzBdKSxhLnNoaWZ0KCksYS5wdXNoKHJbMV0pLFNvKHQsbyxhKTtyZXR1cm4gdC5qb2luKCIiKX1mdW5jdGlvbiBibyhuLHQpe3ZhciByPW4ubGVuZ3RoLTE7aWYocilmb3IodmFyIGUsdSxpPW5bMF1bMF0sbz1uWzBdWzFdLGE9bltyXVswXS1pLGM9bltyXVsxXS1vLHM9LTE7KytzPD1yOyllPW5bc10sdT1zL3IsZVswXT10KmVbMF0rKDEtdCkqKGkrdSphKSxlWzFdPXQqZVsxXSsoMS10KSoobyt1KmMpO3JldHVybiB4byhuKX1mdW5jdGlvbiB3byhuLHQpe3JldHVybiBuWzBdKnRbMF0rblsxXSp0WzFdK25bMl0qdFsyXStuWzNdKnRbM119ZnVuY3Rpb24gU28obix0LHIpe24ucHVzaCgiQyIsd28od3MsdCksIiwiLHdvKHdzLHIpLCIsIix3byhTcyx0KSwiLCIsd28oU3MsciksIiwiLHdvKGtzLHQpLCIsIix3byhrcyxyKSl9ZnVuY3Rpb24ga28obix0KXtyZXR1cm4odFsxXS1uWzFdKS8odFswXS1uWzBdKX1mdW5jdGlvbiBFbyhuKXtmb3IodmFyIHQ9MCxyPW4ubGVuZ3RoLTEsZT1bXSx1PW5bMF0saT1uWzFdLG89ZVswXT1rbyh1LGkpOysrdDxyOyllW3RdPShvKyhvPWtvKHU9aSxpPW5bdCsxXSkpKS8yO3JldHVybiBlW3RdPW8sZX1mdW5jdGlvbiBBbyhuKXtmb3IodmFyIHQscixlLHUsaT1bXSxvPUVvKG4pLGE9LTEsYz1uLmxlbmd0aC0xOysrYTxjOyl0PWtvKG5bYV0sblthKzFdKSxjYSh0KTxDYT9vW2FdPW9bYSsxXT0wOihyPW9bYV0vdCxlPW9bYSsxXS90LHU9cipyK2UqZSx1PjkmJih1PTMqdC9NYXRoLnNxcnQodSksb1thXT11KnIsb1thKzFdPXUqZSkpO2ZvcihhPS0xOysrYTw9YzspdT0obltNYXRoLm1pbihjLGErMSldWzBdLW5bTWF0aC5tYXgoMCxhLTEpXVswXSkvKDYqKDErb1thXSpvW2FdKSksaS5wdXNoKFt1fHwwLG9bYV0qdXx8MF0pO3JldHVybiBpfWZ1bmN0aW9uIENvKG4pe3JldHVybiBuLmxlbmd0aDwzP2NvKG4pOm5bMF0rbW8obixBbyhuKSl9ZnVuY3Rpb24gTm8obil7Zm9yKHZhciB0LHIsZSx1PS0xLGk9bi5sZW5ndGg7Kyt1PGk7KXQ9blt1XSxyPXRbMF0sZT10WzFdK01zLHRbMF09cipNYXRoLmNvcyhlKSx0WzFdPXIqTWF0aC5zaW4oZSk7cmV0dXJuIG59ZnVuY3Rpb24gem8obil7ZnVuY3Rpb24gdCh0KXtmdW5jdGlvbiBjKCl7di5wdXNoKCJNIixhKG4obSksZiksbCxzKG4oZC5yZXZlcnNlKCkpLGYpLCJaIil9Zm9yKHZhciBoLGcscCx2PVtdLGQ9W10sbT1bXSx5PS0xLHg9dC5sZW5ndGgsTT1FdChyKSxfPUV0KHUpLGI9cj09PWU/ZnVuY3Rpb24oKXtyZXR1cm4gZ306RXQoZSksdz11PT09aT9mdW5jdGlvbigpe3JldHVybiBwfTpFdChpKTsrK3k8eDspby5jYWxsKHRoaXMsaD10W3ldLHkpPyhkLnB1c2goW2c9K00uY2FsbCh0aGlzLGgseSkscD0rXy5jYWxsKHRoaXMsaCx5KV0pLG0ucHVzaChbK2IuY2FsbCh0aGlzLGgseSksK3cuY2FsbCh0aGlzLGgseSldKSk6ZC5sZW5ndGgmJihjKCksZD1bXSxtPVtdKTtyZXR1cm4gZC5sZW5ndGgmJmMoKSx2Lmxlbmd0aD92LmpvaW4oIiIpOm51bGx9dmFyIHI9QWUsZT1BZSx1PTAsaT1DZSxvPUFyLGE9Y28sYz1hLmtleSxzPWEsbD0iTCIsZj0uNztyZXR1cm4gdC54PWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhyPWU9bix0KTplfSx0LngwPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhyPW4sdCk6cn0sdC54MT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oZT1uLHQpOmV9LHQueT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8odT1pPW4sdCk6aX0sdC55MD1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8odT1uLHQpOnV9LHQueTE9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGk9bix0KTppfSx0LmRlZmluZWQ9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KG89bix0KTpvfSx0LmludGVycG9sYXRlPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhjPSJmdW5jdGlvbiI9PXR5cGVvZiBuP2E9bjooYT1icy5nZXQobil8fGNvKS5rZXkscz1hLnJldmVyc2V8fGEsbD1hLmNsb3NlZD8iTSI6IkwiLHQpOmN9LHQudGVuc2lvbj1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oZj1uLHQpOmZ9LHR9ZnVuY3Rpb24gTG8obil7cmV0dXJuIG4ucmFkaXVzfWZ1bmN0aW9uIFRvKG4pe3JldHVybltuLngsbi55XX1mdW5jdGlvbiBxbyhuKXtyZXR1cm4gZnVuY3Rpb24oKXt2YXIgdD1uLmFwcGx5KHRoaXMsYXJndW1lbnRzKSxyPXRbMF0sZT10WzFdK01zO3JldHVybltyKk1hdGguY29zKGUpLHIqTWF0aC5zaW4oZSldfX1mdW5jdGlvbiBSbygpe3JldHVybiA2NH1mdW5jdGlvbiBEbygpe3JldHVybiJjaXJjbGUifWZ1bmN0aW9uIFBvKG4pe3ZhciB0PU1hdGguc3FydChuL2thKTtyZXR1cm4iTTAsIit0KyJBIit0KyIsIit0KyIgMCAxLDEgMCwiKy10KyJBIit0KyIsIit0KyIgMCAxLDEgMCwiK3QrIloifWZ1bmN0aW9uIFVvKG4sdCl7cmV0dXJuIGdhKG4sTHMpLG4uaWQ9dCxufWZ1bmN0aW9uIGpvKG4sdCxyLGUpe3ZhciB1PW4uaWQ7cmV0dXJuIFAobiwiZnVuY3Rpb24iPT10eXBlb2Ygcj9mdW5jdGlvbihuLGksbyl7bi5fX3RyYW5zaXRpb25fX1t1XS50d2Vlbi5zZXQodCxlKHIuY2FsbChuLG4uX19kYXRhX18saSxvKSkpfToocj1lKHIpLGZ1bmN0aW9uKG4pe24uX190cmFuc2l0aW9uX19bdV0udHdlZW4uc2V0KHQscil9KSl9ZnVuY3Rpb24gSG8obil7cmV0dXJuIG51bGw9PW4mJihuPSIiKSxmdW5jdGlvbigpe3RoaXMudGV4dENvbnRlbnQ9bn19ZnVuY3Rpb24gRm8obix0LHIsZSl7dmFyIHU9bi5fX3RyYW5zaXRpb25fX3x8KG4uX190cmFuc2l0aW9uX189e2FjdGl2ZTowLGNvdW50OjB9KSxpPXVbcl07aWYoIWkpe3ZhciBhPWUudGltZTtpPXVbcl09e3R3ZWVuOm5ldyBvLHRpbWU6YSxlYXNlOmUuZWFzZSxkZWxheTplLmRlbGF5LGR1cmF0aW9uOmUuZHVyYXRpb259LCsrdS5jb3VudCxCby50aW1lcihmdW5jdGlvbihlKXtmdW5jdGlvbiBvKGUpe3JldHVybiB1LmFjdGl2ZT5yP3MoKToodS5hY3RpdmU9cixpLmV2ZW50JiZpLmV2ZW50LnN0YXJ0LmNhbGwobixsLHQpLGkudHdlZW4uZm9yRWFjaChmdW5jdGlvbihyLGUpeyhlPWUuY2FsbChuLGwsdCkpJiZ2LnB1c2goZSl9KSxCby50aW1lcihmdW5jdGlvbigpe3JldHVybiBwLmM9YyhlfHwxKT9BcjpjLDF9LDAsYSksdm9pZCAwKX1mdW5jdGlvbiBjKGUpe2lmKHUuYWN0aXZlIT09cilyZXR1cm4gcygpO2Zvcih2YXIgbz1lL2csYT1mKG8pLGM9di5sZW5ndGg7Yz4wOyl2Wy0tY10uY2FsbChuLGEpO3JldHVybiBvPj0xPyhpLmV2ZW50JiZpLmV2ZW50LmVuZC5jYWxsKG4sbCx0KSxzKCkpOnZvaWQgMH1mdW5jdGlvbiBzKCl7cmV0dXJuLS11LmNvdW50P2RlbGV0ZSB1W3JdOmRlbGV0ZSBuLl9fdHJhbnNpdGlvbl9fLDF9dmFyIGw9bi5fX2RhdGFfXyxmPWkuZWFzZSxoPWkuZGVsYXksZz1pLmR1cmF0aW9uLHA9R2Esdj1bXTtyZXR1cm4gcC50PWgrYSxlPj1oP28oZS1oKToocC5jPW8sdm9pZCAwKX0sMCxhKX19ZnVuY3Rpb24gT28obix0KXtuLmF0dHIoInRyYW5zZm9ybSIsZnVuY3Rpb24obil7cmV0dXJuInRyYW5zbGF0ZSgiK3QobikrIiwwKSJ9KX1mdW5jdGlvbiBJbyhuLHQpe24uYXR0cigidHJhbnNmb3JtIixmdW5jdGlvbihuKXtyZXR1cm4idHJhbnNsYXRlKDAsIit0KG4pKyIpIn0pfWZ1bmN0aW9uIFlvKG4pe3JldHVybiBuLnRvSVNPU3RyaW5nKCl9ZnVuY3Rpb24gWm8obix0LHIpe2Z1bmN0aW9uIGUodCl7cmV0dXJuIG4odCl9ZnVuY3Rpb24gdShuLHIpe3ZhciBlPW5bMV0tblswXSx1PWUvcixpPUJvLmJpc2VjdChGcyx1KTtyZXR1cm4gaT09RnMubGVuZ3RoP1t0LnllYXIsWmkobi5tYXAoZnVuY3Rpb24obil7cmV0dXJuIG4vMzE1MzZlNn0pLHIpWzJdXTppP3RbdS9Gc1tpLTFdPEZzW2ldL3U/aS0xOmldOltZcyxaaShuLHIpWzJdXX1yZXR1cm4gZS5pbnZlcnQ9ZnVuY3Rpb24odCl7cmV0dXJuIFZvKG4uaW52ZXJ0KHQpKQp9LGUuZG9tYWluPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhuLmRvbWFpbih0KSxlKTpuLmRvbWFpbigpLm1hcChWbyl9LGUubmljZT1mdW5jdGlvbihuLHQpe2Z1bmN0aW9uIHIocil7cmV0dXJuIWlzTmFOKHIpJiYhbi5yYW5nZShyLFZvKCtyKzEpLHQpLmxlbmd0aH12YXIgaT1lLmRvbWFpbigpLG89RGkoaSksYT1udWxsPT1uP3UobywxMCk6Im51bWJlciI9PXR5cGVvZiBuJiZ1KG8sbik7cmV0dXJuIGEmJihuPWFbMF0sdD1hWzFdKSxlLmRvbWFpbihqaShpLHQ+MT97Zmxvb3I6ZnVuY3Rpb24odCl7Zm9yKDtyKHQ9bi5mbG9vcih0KSk7KXQ9Vm8odC0xKTtyZXR1cm4gdH0sY2VpbDpmdW5jdGlvbih0KXtmb3IoO3IodD1uLmNlaWwodCkpOyl0PVZvKCt0KzEpO3JldHVybiB0fX06bikpfSxlLnRpY2tzPWZ1bmN0aW9uKG4sdCl7dmFyIHI9RGkoZS5kb21haW4oKSksaT1udWxsPT1uP3UociwxMCk6Im51bWJlciI9PXR5cGVvZiBuP3UocixuKTohbi5yYW5nZSYmW3tyYW5nZTpufSx0XTtyZXR1cm4gaSYmKG49aVswXSx0PWlbMV0pLG4ucmFuZ2UoclswXSxWbygrclsxXSsxKSwxPnQ/MTp0KX0sZS50aWNrRm9ybWF0PWZ1bmN0aW9uKCl7cmV0dXJuIHJ9LGUuY29weT1mdW5jdGlvbigpe3JldHVybiBabyhuLmNvcHkoKSx0LHIpfSxJaShlLG4pfWZ1bmN0aW9uIFZvKG4pe3JldHVybiBuZXcgRGF0ZShuKX1mdW5jdGlvbiAkbyhuKXtyZXR1cm4gSlNPTi5wYXJzZShuLnJlc3BvbnNlVGV4dCl9ZnVuY3Rpb24gWG8obil7dmFyIHQ9R28uY3JlYXRlUmFuZ2UoKTtyZXR1cm4gdC5zZWxlY3ROb2RlKEdvLmJvZHkpLHQuY3JlYXRlQ29udGV4dHVhbEZyYWdtZW50KG4ucmVzcG9uc2VUZXh0KX12YXIgQm89e3ZlcnNpb246IjMuNC44In07RGF0ZS5ub3d8fChEYXRlLm5vdz1mdW5jdGlvbigpe3JldHVybituZXcgRGF0ZX0pO3ZhciBKbz1bXS5zbGljZSxXbz1mdW5jdGlvbihuKXtyZXR1cm4gSm8uY2FsbChuKX0sR289ZG9jdW1lbnQsS289R28uZG9jdW1lbnRFbGVtZW50LFFvPXdpbmRvdzt0cnl7V28oS28uY2hpbGROb2RlcylbMF0ubm9kZVR5cGV9Y2F0Y2gobmEpe1dvPWZ1bmN0aW9uKG4pe2Zvcih2YXIgdD1uLmxlbmd0aCxyPW5ldyBBcnJheSh0KTt0LS07KXJbdF09blt0XTtyZXR1cm4gcn19dHJ5e0dvLmNyZWF0ZUVsZW1lbnQoImRpdiIpLnN0eWxlLnNldFByb3BlcnR5KCJvcGFjaXR5IiwwLCIiKX1jYXRjaCh0YSl7dmFyIHJhPVFvLkVsZW1lbnQucHJvdG90eXBlLGVhPXJhLnNldEF0dHJpYnV0ZSx1YT1yYS5zZXRBdHRyaWJ1dGVOUyxpYT1Rby5DU1NTdHlsZURlY2xhcmF0aW9uLnByb3RvdHlwZSxvYT1pYS5zZXRQcm9wZXJ0eTtyYS5zZXRBdHRyaWJ1dGU9ZnVuY3Rpb24obix0KXtlYS5jYWxsKHRoaXMsbix0KyIiKX0scmEuc2V0QXR0cmlidXRlTlM9ZnVuY3Rpb24obix0LHIpe3VhLmNhbGwodGhpcyxuLHQscisiIil9LGlhLnNldFByb3BlcnR5PWZ1bmN0aW9uKG4sdCxyKXtvYS5jYWxsKHRoaXMsbix0KyIiLHIpfX1Cby5hc2NlbmRpbmc9bixCby5kZXNjZW5kaW5nPWZ1bmN0aW9uKG4sdCl7cmV0dXJuIG4+dD8tMTp0Pm4/MTp0Pj1uPzA6MC8wfSxCby5taW49ZnVuY3Rpb24obix0KXt2YXIgcixlLHU9LTEsaT1uLmxlbmd0aDtpZigxPT09YXJndW1lbnRzLmxlbmd0aCl7Zm9yKDsrK3U8aSYmIShudWxsIT0ocj1uW3VdKSYmcj49cik7KXI9dm9pZCAwO2Zvcig7Kyt1PGk7KW51bGwhPShlPW5bdV0pJiZyPmUmJihyPWUpfWVsc2V7Zm9yKDsrK3U8aSYmIShudWxsIT0ocj10LmNhbGwobixuW3VdLHUpKSYmcj49cik7KXI9dm9pZCAwO2Zvcig7Kyt1PGk7KW51bGwhPShlPXQuY2FsbChuLG5bdV0sdSkpJiZyPmUmJihyPWUpfXJldHVybiByfSxCby5tYXg9ZnVuY3Rpb24obix0KXt2YXIgcixlLHU9LTEsaT1uLmxlbmd0aDtpZigxPT09YXJndW1lbnRzLmxlbmd0aCl7Zm9yKDsrK3U8aSYmIShudWxsIT0ocj1uW3VdKSYmcj49cik7KXI9dm9pZCAwO2Zvcig7Kyt1PGk7KW51bGwhPShlPW5bdV0pJiZlPnImJihyPWUpfWVsc2V7Zm9yKDsrK3U8aSYmIShudWxsIT0ocj10LmNhbGwobixuW3VdLHUpKSYmcj49cik7KXI9dm9pZCAwO2Zvcig7Kyt1PGk7KW51bGwhPShlPXQuY2FsbChuLG5bdV0sdSkpJiZlPnImJihyPWUpfXJldHVybiByfSxCby5leHRlbnQ9ZnVuY3Rpb24obix0KXt2YXIgcixlLHUsaT0tMSxvPW4ubGVuZ3RoO2lmKDE9PT1hcmd1bWVudHMubGVuZ3RoKXtmb3IoOysraTxvJiYhKG51bGwhPShyPXU9bltpXSkmJnI+PXIpOylyPXU9dm9pZCAwO2Zvcig7KytpPG87KW51bGwhPShlPW5baV0pJiYocj5lJiYocj1lKSxlPnUmJih1PWUpKX1lbHNle2Zvcig7KytpPG8mJiEobnVsbCE9KHI9dT10LmNhbGwobixuW2ldLGkpKSYmcj49cik7KXI9dm9pZCAwO2Zvcig7KytpPG87KW51bGwhPShlPXQuY2FsbChuLG5baV0saSkpJiYocj5lJiYocj1lKSxlPnUmJih1PWUpKX1yZXR1cm5bcix1XX0sQm8uc3VtPWZ1bmN0aW9uKG4sdCl7dmFyIHIsZT0wLHU9bi5sZW5ndGgsaT0tMTtpZigxPT09YXJndW1lbnRzLmxlbmd0aClmb3IoOysraTx1Oylpc05hTihyPStuW2ldKXx8KGUrPXIpO2Vsc2UgZm9yKDsrK2k8dTspaXNOYU4ocj0rdC5jYWxsKG4sbltpXSxpKSl8fChlKz1yKTtyZXR1cm4gZX0sQm8ubWVhbj1mdW5jdGlvbihuLHIpe3ZhciBlLHU9MCxpPW4ubGVuZ3RoLG89LTEsYT1pO2lmKDE9PT1hcmd1bWVudHMubGVuZ3RoKWZvcig7KytvPGk7KXQoZT1uW29dKT91Kz1lOi0tYTtlbHNlIGZvcig7KytvPGk7KXQoZT1yLmNhbGwobixuW29dLG8pKT91Kz1lOi0tYTtyZXR1cm4gYT91L2E6dm9pZCAwfSxCby5xdWFudGlsZT1mdW5jdGlvbihuLHQpe3ZhciByPShuLmxlbmd0aC0xKSp0KzEsZT1NYXRoLmZsb29yKHIpLHU9K25bZS0xXSxpPXItZTtyZXR1cm4gaT91K2kqKG5bZV0tdSk6dX0sQm8ubWVkaWFuPWZ1bmN0aW9uKHIsZSl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg+MSYmKHI9ci5tYXAoZSkpLHI9ci5maWx0ZXIodCksci5sZW5ndGg/Qm8ucXVhbnRpbGUoci5zb3J0KG4pLC41KTp2b2lkIDB9O3ZhciBhYT1yKG4pO0JvLmJpc2VjdExlZnQ9YWEubGVmdCxCby5iaXNlY3Q9Qm8uYmlzZWN0UmlnaHQ9YWEucmlnaHQsQm8uYmlzZWN0b3I9ZnVuY3Rpb24odCl7cmV0dXJuIHIoMT09PXQubGVuZ3RoP2Z1bmN0aW9uKHIsZSl7cmV0dXJuIG4odChyKSxlKX06dCl9LEJvLnNodWZmbGU9ZnVuY3Rpb24obil7Zm9yKHZhciB0LHIsZT1uLmxlbmd0aDtlOylyPTB8TWF0aC5yYW5kb20oKSplLS0sdD1uW2VdLG5bZV09bltyXSxuW3JdPXQ7cmV0dXJuIG59LEJvLnBlcm11dGU9ZnVuY3Rpb24obix0KXtmb3IodmFyIHI9dC5sZW5ndGgsZT1uZXcgQXJyYXkocik7ci0tOyllW3JdPW5bdFtyXV07cmV0dXJuIGV9LEJvLnBhaXJzPWZ1bmN0aW9uKG4pe2Zvcih2YXIgdCxyPTAsZT1uLmxlbmd0aC0xLHU9blswXSxpPW5ldyBBcnJheSgwPmU/MDplKTtlPnI7KWlbcl09W3Q9dSx1PW5bKytyXV07cmV0dXJuIGl9LEJvLnppcD1mdW5jdGlvbigpe2lmKCEodT1hcmd1bWVudHMubGVuZ3RoKSlyZXR1cm5bXTtmb3IodmFyIG49LTEsdD1Cby5taW4oYXJndW1lbnRzLGUpLHI9bmV3IEFycmF5KHQpOysrbjx0Oylmb3IodmFyIHUsaT0tMSxvPXJbbl09bmV3IEFycmF5KHUpOysraTx1OylvW2ldPWFyZ3VtZW50c1tpXVtuXTtyZXR1cm4gcn0sQm8udHJhbnNwb3NlPWZ1bmN0aW9uKG4pe3JldHVybiBCby56aXAuYXBwbHkoQm8sbil9LEJvLmtleXM9ZnVuY3Rpb24obil7dmFyIHQ9W107Zm9yKHZhciByIGluIG4pdC5wdXNoKHIpO3JldHVybiB0fSxCby52YWx1ZXM9ZnVuY3Rpb24obil7dmFyIHQ9W107Zm9yKHZhciByIGluIG4pdC5wdXNoKG5bcl0pO3JldHVybiB0fSxCby5lbnRyaWVzPWZ1bmN0aW9uKG4pe3ZhciB0PVtdO2Zvcih2YXIgciBpbiBuKXQucHVzaCh7a2V5OnIsdmFsdWU6bltyXX0pO3JldHVybiB0fSxCby5tZXJnZT1mdW5jdGlvbihuKXtmb3IodmFyIHQscixlLHU9bi5sZW5ndGgsaT0tMSxvPTA7KytpPHU7KW8rPW5baV0ubGVuZ3RoO2ZvcihyPW5ldyBBcnJheShvKTstLXU+PTA7KWZvcihlPW5bdV0sdD1lLmxlbmd0aDstLXQ+PTA7KXJbLS1vXT1lW3RdO3JldHVybiByfTt2YXIgY2E9TWF0aC5hYnM7Qm8ucmFuZ2U9ZnVuY3Rpb24obix0LHIpe2lmKGFyZ3VtZW50cy5sZW5ndGg8MyYmKHI9MSxhcmd1bWVudHMubGVuZ3RoPDImJih0PW4sbj0wKSksMS8wPT09KHQtbikvcil0aHJvdyBuZXcgRXJyb3IoImluZmluaXRlIHJhbmdlIik7dmFyIGUsaT1bXSxvPXUoY2EocikpLGE9LTE7aWYobio9byx0Kj1vLHIqPW8sMD5yKWZvcig7KGU9bityKisrYSk+dDspaS5wdXNoKGUvbyk7ZWxzZSBmb3IoOyhlPW4rciorK2EpPHQ7KWkucHVzaChlL28pO3JldHVybiBpfSxCby5tYXA9ZnVuY3Rpb24obil7dmFyIHQ9bmV3IG87aWYobiBpbnN0YW5jZW9mIG8pbi5mb3JFYWNoKGZ1bmN0aW9uKG4scil7dC5zZXQobixyKX0pO2Vsc2UgZm9yKHZhciByIGluIG4pdC5zZXQocixuW3JdKTtyZXR1cm4gdH0saShvLHtoYXM6YSxnZXQ6ZnVuY3Rpb24obil7cmV0dXJuIHRoaXNbc2Erbl19LHNldDpmdW5jdGlvbihuLHQpe3JldHVybiB0aGlzW3NhK25dPXR9LHJlbW92ZTpjLGtleXM6cyx2YWx1ZXM6ZnVuY3Rpb24oKXt2YXIgbj1bXTtyZXR1cm4gdGhpcy5mb3JFYWNoKGZ1bmN0aW9uKHQscil7bi5wdXNoKHIpfSksbn0sZW50cmllczpmdW5jdGlvbigpe3ZhciBuPVtdO3JldHVybiB0aGlzLmZvckVhY2goZnVuY3Rpb24odCxyKXtuLnB1c2goe2tleTp0LHZhbHVlOnJ9KX0pLG59LHNpemU6bCxlbXB0eTpmLGZvckVhY2g6ZnVuY3Rpb24obil7Zm9yKHZhciB0IGluIHRoaXMpdC5jaGFyQ29kZUF0KDApPT09bGEmJm4uY2FsbCh0aGlzLHQuc3Vic3RyaW5nKDEpLHRoaXNbdF0pfX0pO3ZhciBzYT0iXHgwMCIsbGE9c2EuY2hhckNvZGVBdCgwKTtCby5uZXN0PWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbih0LGEsYyl7aWYoYz49aS5sZW5ndGgpcmV0dXJuIGU/ZS5jYWxsKHUsYSk6cj9hLnNvcnQocik6YTtmb3IodmFyIHMsbCxmLGgsZz0tMSxwPWEubGVuZ3RoLHY9aVtjKytdLGQ9bmV3IG87KytnPHA7KShoPWQuZ2V0KHM9dihsPWFbZ10pKSk/aC5wdXNoKGwpOmQuc2V0KHMsW2xdKTtyZXR1cm4gdD8obD10KCksZj1mdW5jdGlvbihyLGUpe2wuc2V0KHIsbih0LGUsYykpfSk6KGw9e30sZj1mdW5jdGlvbihyLGUpe2xbcl09bih0LGUsYyl9KSxkLmZvckVhY2goZiksbH1mdW5jdGlvbiB0KG4scil7aWYocj49aS5sZW5ndGgpcmV0dXJuIG47dmFyIGU9W10sdT1hW3IrK107cmV0dXJuIG4uZm9yRWFjaChmdW5jdGlvbihuLHUpe2UucHVzaCh7a2V5Om4sdmFsdWVzOnQodSxyKX0pfSksdT9lLnNvcnQoZnVuY3Rpb24obix0KXtyZXR1cm4gdShuLmtleSx0LmtleSl9KTplfXZhciByLGUsdT17fSxpPVtdLGE9W107cmV0dXJuIHUubWFwPWZ1bmN0aW9uKHQscil7cmV0dXJuIG4ocix0LDApfSx1LmVudHJpZXM9ZnVuY3Rpb24ocil7cmV0dXJuIHQobihCby5tYXAsciwwKSwwKX0sdS5rZXk9ZnVuY3Rpb24obil7cmV0dXJuIGkucHVzaChuKSx1fSx1LnNvcnRLZXlzPWZ1bmN0aW9uKG4pe3JldHVybiBhW2kubGVuZ3RoLTFdPW4sdX0sdS5zb3J0VmFsdWVzPWZ1bmN0aW9uKG4pe3JldHVybiByPW4sdX0sdS5yb2xsdXA9ZnVuY3Rpb24obil7cmV0dXJuIGU9bix1fSx1fSxCby5zZXQ9ZnVuY3Rpb24obil7dmFyIHQ9bmV3IGg7aWYobilmb3IodmFyIHI9MCxlPW4ubGVuZ3RoO2U+cjsrK3IpdC5hZGQobltyXSk7cmV0dXJuIHR9LGkoaCx7aGFzOmEsYWRkOmZ1bmN0aW9uKG4pe3JldHVybiB0aGlzW3NhK25dPSEwLG59LHJlbW92ZTpmdW5jdGlvbihuKXtyZXR1cm4gbj1zYStuLG4gaW4gdGhpcyYmZGVsZXRlIHRoaXNbbl19LHZhbHVlczpzLHNpemU6bCxlbXB0eTpmLGZvckVhY2g6ZnVuY3Rpb24obil7Zm9yKHZhciB0IGluIHRoaXMpdC5jaGFyQ29kZUF0KDApPT09bGEmJm4uY2FsbCh0aGlzLHQuc3Vic3RyaW5nKDEpKX19KSxCby5iZWhhdmlvcj17fSxCby5yZWJpbmQ9ZnVuY3Rpb24obix0KXtmb3IodmFyIHIsZT0xLHU9YXJndW1lbnRzLmxlbmd0aDsrK2U8dTspbltyPWFyZ3VtZW50c1tlXV09ZyhuLHQsdFtyXSk7cmV0dXJuIG59O3ZhciBmYT1bIndlYmtpdCIsIm1zIiwibW96IiwiTW96IiwibyIsIk8iXTtCby5kaXNwYXRjaD1mdW5jdGlvbigpe2Zvcih2YXIgbj1uZXcgZCx0PS0xLHI9YXJndW1lbnRzLmxlbmd0aDsrK3Q8cjspblthcmd1bWVudHNbdF1dPW0obik7cmV0dXJuIG59LGQucHJvdG90eXBlLm9uPWZ1bmN0aW9uKG4sdCl7dmFyIHI9bi5pbmRleE9mKCIuIiksZT0iIjtpZihyPj0wJiYoZT1uLnN1YnN0cmluZyhyKzEpLG49bi5zdWJzdHJpbmcoMCxyKSksbilyZXR1cm4gYXJndW1lbnRzLmxlbmd0aDwyP3RoaXNbbl0ub24oZSk6dGhpc1tuXS5vbihlLHQpO2lmKDI9PT1hcmd1bWVudHMubGVuZ3RoKXtpZihudWxsPT10KWZvcihuIGluIHRoaXMpdGhpcy5oYXNPd25Qcm9wZXJ0eShuKSYmdGhpc1tuXS5vbihlLG51bGwpO3JldHVybiB0aGlzfX0sQm8uZXZlbnQ9bnVsbCxCby5yZXF1b3RlPWZ1bmN0aW9uKG4pe3JldHVybiBuLnJlcGxhY2UoaGEsIlxcJCYiKX07dmFyIGhhPS9bXFxcXlwkXCpcK1w/XHxcW1xdXChcKVwuXHtcfV0vZyxnYT17fS5fX3Byb3RvX18/ZnVuY3Rpb24obix0KXtuLl9fcHJvdG9fXz10fTpmdW5jdGlvbihuLHQpe2Zvcih2YXIgciBpbiB0KW5bcl09dFtyXX0scGE9ZnVuY3Rpb24obix0KXtyZXR1cm4gdC5xdWVyeVNlbGVjdG9yKG4pfSx2YT1mdW5jdGlvbihuLHQpe3JldHVybiB0LnF1ZXJ5U2VsZWN0b3JBbGwobil9LGRhPUtvW3AoS28sIm1hdGNoZXNTZWxlY3RvciIpXSxtYT1mdW5jdGlvbihuLHQpe3JldHVybiBkYS5jYWxsKG4sdCl9OyJmdW5jdGlvbiI9PXR5cGVvZiBTaXp6bGUmJihwYT1mdW5jdGlvbihuLHQpe3JldHVybiBTaXp6bGUobix0KVswXXx8bnVsbH0sdmE9U2l6emxlLG1hPVNpenpsZS5tYXRjaGVzU2VsZWN0b3IpLEJvLnNlbGVjdGlvbj1mdW5jdGlvbigpe3JldHVybiBfYX07dmFyIHlhPUJvLnNlbGVjdGlvbi5wcm90b3R5cGU9W107eWEuc2VsZWN0PWZ1bmN0aW9uKG4pe3ZhciB0LHIsZSx1LGk9W107bj1iKG4pO2Zvcih2YXIgbz0tMSxhPXRoaXMubGVuZ3RoOysrbzxhOyl7aS5wdXNoKHQ9W10pLHQucGFyZW50Tm9kZT0oZT10aGlzW29dKS5wYXJlbnROb2RlO2Zvcih2YXIgYz0tMSxzPWUubGVuZ3RoOysrYzxzOykodT1lW2NdKT8odC5wdXNoKHI9bi5jYWxsKHUsdS5fX2RhdGFfXyxjLG8pKSxyJiYiX19kYXRhX18iaW4gdSYmKHIuX19kYXRhX189dS5fX2RhdGFfXykpOnQucHVzaChudWxsKX1yZXR1cm4gXyhpKX0seWEuc2VsZWN0QWxsPWZ1bmN0aW9uKG4pe3ZhciB0LHIsZT1bXTtuPXcobik7Zm9yKHZhciB1PS0xLGk9dGhpcy5sZW5ndGg7Kyt1PGk7KWZvcih2YXIgbz10aGlzW3VdLGE9LTEsYz1vLmxlbmd0aDsrK2E8YzspKHI9b1thXSkmJihlLnB1c2godD1XbyhuLmNhbGwocixyLl9fZGF0YV9fLGEsdSkpKSx0LnBhcmVudE5vZGU9cik7cmV0dXJuIF8oZSl9O3ZhciB4YT17c3ZnOiJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIseGh0bWw6Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiLHhsaW5rOiJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIix4bWw6Imh0dHA6Ly93d3cudzMub3JnL1hNTC8xOTk4L25hbWVzcGFjZSIseG1sbnM6Imh0dHA6Ly93d3cudzMub3JnLzIwMDAveG1sbnMvIn07Qm8ubnM9e3ByZWZpeDp4YSxxdWFsaWZ5OmZ1bmN0aW9uKG4pe3ZhciB0PW4uaW5kZXhPZigiOiIpLHI9bjtyZXR1cm4gdD49MCYmKHI9bi5zdWJzdHJpbmcoMCx0KSxuPW4uc3Vic3RyaW5nKHQrMSkpLHhhLmhhc093blByb3BlcnR5KHIpP3tzcGFjZTp4YVtyXSxsb2NhbDpufTpufX0seWEuYXR0cj1mdW5jdGlvbihuLHQpe2lmKGFyZ3VtZW50cy5sZW5ndGg8Mil7aWYoInN0cmluZyI9PXR5cGVvZiBuKXt2YXIgcj10aGlzLm5vZGUoKTtyZXR1cm4gbj1Cby5ucy5xdWFsaWZ5KG4pLG4ubG9jYWw/ci5nZXRBdHRyaWJ1dGVOUyhuLnNwYWNlLG4ubG9jYWwpOnIuZ2V0QXR0cmlidXRlKG4pfWZvcih0IGluIG4pdGhpcy5lYWNoKFModCxuW3RdKSk7cmV0dXJuIHRoaXN9cmV0dXJuIHRoaXMuZWFjaChTKG4sdCkpfSx5YS5jbGFzc2VkPWZ1bmN0aW9uKG4sdCl7aWYoYXJndW1lbnRzLmxlbmd0aDwyKXtpZigic3RyaW5nIj09dHlwZW9mIG4pe3ZhciByPXRoaXMubm9kZSgpLGU9KG49QShuKSkubGVuZ3RoLHU9LTE7aWYodD1yLmNsYXNzTGlzdCl7Zm9yKDsrK3U8ZTspaWYoIXQuY29udGFpbnMoblt1XSkpcmV0dXJuITF9ZWxzZSBmb3IodD1yLmdldEF0dHJpYnV0ZSgiY2xhc3MiKTsrK3U8ZTspaWYoIUUoblt1XSkudGVzdCh0KSlyZXR1cm4hMTtyZXR1cm4hMH1mb3IodCBpbiBuKXRoaXMuZWFjaChDKHQsblt0XSkpO3JldHVybiB0aGlzfXJldHVybiB0aGlzLmVhY2goQyhuLHQpKX0seWEuc3R5bGU9ZnVuY3Rpb24obix0LHIpe3ZhciBlPWFyZ3VtZW50cy5sZW5ndGg7aWYoMz5lKXtpZigic3RyaW5nIiE9dHlwZW9mIG4pezI+ZSYmKHQ9IiIpO2ZvcihyIGluIG4pdGhpcy5lYWNoKHoocixuW3JdLHQpKTtyZXR1cm4gdGhpc31pZigyPmUpcmV0dXJuIFFvLmdldENvbXB1dGVkU3R5bGUodGhpcy5ub2RlKCksbnVsbCkuZ2V0UHJvcGVydHlWYWx1ZShuKTtyPSIifXJldHVybiB0aGlzLmVhY2goeihuLHQscikpfSx5YS5wcm9wZXJ0eT1mdW5jdGlvbihuLHQpe2lmKGFyZ3VtZW50cy5sZW5ndGg8Mil7aWYoInN0cmluZyI9PXR5cGVvZiBuKXJldHVybiB0aGlzLm5vZGUoKVtuXTtmb3IodCBpbiBuKXRoaXMuZWFjaChMKHQsblt0XSkpO3JldHVybiB0aGlzfXJldHVybiB0aGlzLmVhY2goTChuLHQpKX0seWEudGV4dD1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD90aGlzLmVhY2goImZ1bmN0aW9uIj09dHlwZW9mIG4/ZnVuY3Rpb24oKXt2YXIgdD1uLmFwcGx5KHRoaXMsYXJndW1lbnRzKTt0aGlzLnRleHRDb250ZW50PW51bGw9PXQ/IiI6dH06bnVsbD09bj9mdW5jdGlvbigpe3RoaXMudGV4dENvbnRlbnQ9IiJ9OmZ1bmN0aW9uKCl7dGhpcy50ZXh0Q29udGVudD1ufSk6dGhpcy5ub2RlKCkudGV4dENvbnRlbnR9LHlhLmh0bWw9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/dGhpcy5lYWNoKCJmdW5jdGlvbiI9PXR5cGVvZiBuP2Z1bmN0aW9uKCl7dmFyIHQ9bi5hcHBseSh0aGlzLGFyZ3VtZW50cyk7dGhpcy5pbm5lckhUTUw9bnVsbD09dD8iIjp0fTpudWxsPT1uP2Z1bmN0aW9uKCl7dGhpcy5pbm5lckhUTUw9IiJ9OmZ1bmN0aW9uKCl7dGhpcy5pbm5lckhUTUw9bn0pOnRoaXMubm9kZSgpLmlubmVySFRNTH0seWEuYXBwZW5kPWZ1bmN0aW9uKG4pe3JldHVybiBuPVQobiksdGhpcy5zZWxlY3QoZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5hcHBlbmRDaGlsZChuLmFwcGx5KHRoaXMsYXJndW1lbnRzKSl9KX0seWEuaW5zZXJ0PWZ1bmN0aW9uKG4sdCl7cmV0dXJuIG49VChuKSx0PWIodCksdGhpcy5zZWxlY3QoZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5pbnNlcnRCZWZvcmUobi5hcHBseSh0aGlzLGFyZ3VtZW50cyksdC5hcHBseSh0aGlzLGFyZ3VtZW50cyl8fG51bGwpfSl9LHlhLnJlbW92ZT1mdW5jdGlvbigpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgbj10aGlzLnBhcmVudE5vZGU7biYmbi5yZW1vdmVDaGlsZCh0aGlzKX0pfSx5YS5kYXRhPWZ1bmN0aW9uKG4sdCl7ZnVuY3Rpb24gcihuLHIpe3ZhciBlLHUsaSxhPW4ubGVuZ3RoLGY9ci5sZW5ndGgsaD1NYXRoLm1pbihhLGYpLGc9bmV3IEFycmF5KGYpLHA9bmV3IEFycmF5KGYpLHY9bmV3IEFycmF5KGEpO2lmKHQpe3ZhciBkLG09bmV3IG8seT1uZXcgbyx4PVtdO2ZvcihlPS0xOysrZTxhOylkPXQuY2FsbCh1PW5bZV0sdS5fX2RhdGFfXyxlKSxtLmhhcyhkKT92W2VdPXU6bS5zZXQoZCx1KSx4LnB1c2goZCk7Zm9yKGU9LTE7KytlPGY7KWQ9dC5jYWxsKHIsaT1yW2VdLGUpLCh1PW0uZ2V0KGQpKT8oZ1tlXT11LHUuX19kYXRhX189aSk6eS5oYXMoZCl8fChwW2VdPXEoaSkpLHkuc2V0KGQsaSksbS5yZW1vdmUoZCk7Zm9yKGU9LTE7KytlPGE7KW0uaGFzKHhbZV0pJiYodltlXT1uW2VdKX1lbHNle2ZvcihlPS0xOysrZTxoOyl1PW5bZV0saT1yW2VdLHU/KHUuX19kYXRhX189aSxnW2VdPXUpOnBbZV09cShpKTtmb3IoO2Y+ZTsrK2UpcFtlXT1xKHJbZV0pO2Zvcig7YT5lOysrZSl2W2VdPW5bZV19cC51cGRhdGU9ZyxwLnBhcmVudE5vZGU9Zy5wYXJlbnROb2RlPXYucGFyZW50Tm9kZT1uLnBhcmVudE5vZGUsYy5wdXNoKHApLHMucHVzaChnKSxsLnB1c2godil9dmFyIGUsdSxpPS0xLGE9dGhpcy5sZW5ndGg7aWYoIWFyZ3VtZW50cy5sZW5ndGgpe2ZvcihuPW5ldyBBcnJheShhPShlPXRoaXNbMF0pLmxlbmd0aCk7KytpPGE7KSh1PWVbaV0pJiYobltpXT11Ll9fZGF0YV9fKTtyZXR1cm4gbn12YXIgYz1VKFtdKSxzPV8oW10pLGw9XyhbXSk7aWYoImZ1bmN0aW9uIj09dHlwZW9mIG4pZm9yKDsrK2k8YTspcihlPXRoaXNbaV0sbi5jYWxsKGUsZS5wYXJlbnROb2RlLl9fZGF0YV9fLGkpKTtlbHNlIGZvcig7KytpPGE7KXIoZT10aGlzW2ldLG4pO3JldHVybiBzLmVudGVyPWZ1bmN0aW9uKCl7cmV0dXJuIGN9LHMuZXhpdD1mdW5jdGlvbigpe3JldHVybiBsfSxzfSx5YS5kYXR1bT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD90aGlzLnByb3BlcnR5KCJfX2RhdGFfXyIsbik6dGhpcy5wcm9wZXJ0eSgiX19kYXRhX18iKX0seWEuZmlsdGVyPWZ1bmN0aW9uKG4pe3ZhciB0LHIsZSx1PVtdOyJmdW5jdGlvbiIhPXR5cGVvZiBuJiYobj1SKG4pKTtmb3IodmFyIGk9MCxvPXRoaXMubGVuZ3RoO28+aTtpKyspe3UucHVzaCh0PVtdKSx0LnBhcmVudE5vZGU9KHI9dGhpc1tpXSkucGFyZW50Tm9kZTtmb3IodmFyIGE9MCxjPXIubGVuZ3RoO2M+YTthKyspKGU9clthXSkmJm4uY2FsbChlLGUuX19kYXRhX18sYSxpKSYmdC5wdXNoKGUpfXJldHVybiBfKHUpfSx5YS5vcmRlcj1mdW5jdGlvbigpe2Zvcih2YXIgbj0tMSx0PXRoaXMubGVuZ3RoOysrbjx0Oylmb3IodmFyIHIsZT10aGlzW25dLHU9ZS5sZW5ndGgtMSxpPWVbdV07LS11Pj0wOykocj1lW3VdKSYmKGkmJmkhPT1yLm5leHRTaWJsaW5nJiZpLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHIsaSksaT1yKTtyZXR1cm4gdGhpc30seWEuc29ydD1mdW5jdGlvbihuKXtuPUQuYXBwbHkodGhpcyxhcmd1bWVudHMpO2Zvcih2YXIgdD0tMSxyPXRoaXMubGVuZ3RoOysrdDxyOyl0aGlzW3RdLnNvcnQobik7cmV0dXJuIHRoaXMub3JkZXIoKX0seWEuZWFjaD1mdW5jdGlvbihuKXtyZXR1cm4gUCh0aGlzLGZ1bmN0aW9uKHQscixlKXtuLmNhbGwodCx0Ll9fZGF0YV9fLHIsZSl9KX0seWEuY2FsbD1mdW5jdGlvbihuKXt2YXIgdD1Xbyhhcmd1bWVudHMpO3JldHVybiBuLmFwcGx5KHRbMF09dGhpcyx0KSx0aGlzfSx5YS5lbXB0eT1mdW5jdGlvbigpe3JldHVybiF0aGlzLm5vZGUoKX0seWEubm9kZT1mdW5jdGlvbigpe2Zvcih2YXIgbj0wLHQ9dGhpcy5sZW5ndGg7dD5uO24rKylmb3IodmFyIHI9dGhpc1tuXSxlPTAsdT1yLmxlbmd0aDt1PmU7ZSsrKXt2YXIgaT1yW2VdO2lmKGkpcmV0dXJuIGl9cmV0dXJuIG51bGx9LHlhLnNpemU9ZnVuY3Rpb24oKXt2YXIgbj0wO3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXsrK259KSxufTt2YXIgTWE9W107Qm8uc2VsZWN0aW9uLmVudGVyPVUsQm8uc2VsZWN0aW9uLmVudGVyLnByb3RvdHlwZT1NYSxNYS5hcHBlbmQ9eWEuYXBwZW5kLE1hLmVtcHR5PXlhLmVtcHR5LE1hLm5vZGU9eWEubm9kZSxNYS5jYWxsPXlhLmNhbGwsTWEuc2l6ZT15YS5zaXplLE1hLnNlbGVjdD1mdW5jdGlvbihuKXtmb3IodmFyIHQscixlLHUsaSxvPVtdLGE9LTEsYz10aGlzLmxlbmd0aDsrK2E8Yzspe2U9KHU9dGhpc1thXSkudXBkYXRlLG8ucHVzaCh0PVtdKSx0LnBhcmVudE5vZGU9dS5wYXJlbnROb2RlO2Zvcih2YXIgcz0tMSxsPXUubGVuZ3RoOysrczxsOykoaT11W3NdKT8odC5wdXNoKGVbc109cj1uLmNhbGwodS5wYXJlbnROb2RlLGkuX19kYXRhX18scyxhKSksci5fX2RhdGFfXz1pLl9fZGF0YV9fKTp0LnB1c2gobnVsbCl9cmV0dXJuIF8obyl9LE1hLmluc2VydD1mdW5jdGlvbihuLHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPDImJih0PWoodGhpcykpLHlhLmluc2VydC5jYWxsKHRoaXMsbix0KX0seWEudHJhbnNpdGlvbj1mdW5jdGlvbigpe2Zvcih2YXIgbix0LHI9QXN8fCsrVHMsZT1bXSx1PUNzfHx7dGltZTpEYXRlLm5vdygpLGVhc2U6d3UsZGVsYXk6MCxkdXJhdGlvbjoyNTB9LGk9LTEsbz10aGlzLmxlbmd0aDsrK2k8bzspe2UucHVzaChuPVtdKTtmb3IodmFyIGE9dGhpc1tpXSxjPS0xLHM9YS5sZW5ndGg7KytjPHM7KSh0PWFbY10pJiZGbyh0LGMscix1KSxuLnB1c2godCl9cmV0dXJuIFVvKGUscil9LHlhLmludGVycnVwdD1mdW5jdGlvbigpe3JldHVybiB0aGlzLmVhY2goSCl9LEJvLnNlbGVjdD1mdW5jdGlvbihuKXt2YXIgdD1bInN0cmluZyI9PXR5cGVvZiBuP3BhKG4sR28pOm5dO3JldHVybiB0LnBhcmVudE5vZGU9S28sXyhbdF0pfSxCby5zZWxlY3RBbGw9ZnVuY3Rpb24obil7dmFyIHQ9V28oInN0cmluZyI9PXR5cGVvZiBuP3ZhKG4sR28pOm4pO3JldHVybiB0LnBhcmVudE5vZGU9S28sXyhbdF0pfTt2YXIgX2E9Qm8uc2VsZWN0KEtvKTt5YS5vbj1mdW5jdGlvbihuLHQscil7dmFyIGU9YXJndW1lbnRzLmxlbmd0aDtpZigzPmUpe2lmKCJzdHJpbmciIT10eXBlb2Ygbil7Mj5lJiYodD0hMSk7Zm9yKHIgaW4gbil0aGlzLmVhY2goRihyLG5bcl0sdCkpO3JldHVybiB0aGlzfWlmKDI+ZSlyZXR1cm4oZT10aGlzLm5vZGUoKVsiX19vbiIrbl0pJiZlLl87cj0hMX1yZXR1cm4gdGhpcy5lYWNoKEYobix0LHIpKX07dmFyIGJhPUJvLm1hcCh7bW91c2VlbnRlcjoibW91c2VvdmVyIixtb3VzZWxlYXZlOiJtb3VzZW91dCJ9KTtiYS5mb3JFYWNoKGZ1bmN0aW9uKG4peyJvbiIrbiBpbiBHbyYmYmEucmVtb3ZlKG4pfSk7dmFyIHdhPSJvbnNlbGVjdHN0YXJ0ImluIEdvP251bGw6cChLby5zdHlsZSwidXNlclNlbGVjdCIpLFNhPTA7Qm8ubW91c2U9ZnVuY3Rpb24obil7cmV0dXJuIFoobix4KCkpfSxCby50b3VjaGVzPWZ1bmN0aW9uKG4sdCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg8MiYmKHQ9eCgpLnRvdWNoZXMpLHQ/V28odCkubWFwKGZ1bmN0aW9uKHQpe3ZhciByPVoobix0KTtyZXR1cm4gci5pZGVudGlmaWVyPXQuaWRlbnRpZmllcixyfSk6W119LEJvLmJlaGF2aW9yLmRyYWc9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKCl7dGhpcy5vbigibW91c2Vkb3duLmRyYWciLHUpLm9uKCJ0b3VjaHN0YXJ0LmRyYWciLGkpfWZ1bmN0aW9uIHQobix0LHUsaSxvKXtyZXR1cm4gZnVuY3Rpb24oKXtmdW5jdGlvbiBhKCl7dmFyIG4scixlPXQoaCx2KTtlJiYobj1lWzBdLXhbMF0scj1lWzFdLXhbMV0scHw9bnxyLHg9ZSxnKHt0eXBlOiJkcmFnIix4OmVbMF0rc1swXSx5OmVbMV0rc1sxXSxkeDpuLGR5OnJ9KSl9ZnVuY3Rpb24gYygpe3QoaCx2KSYmKG0ub24oaStkLG51bGwpLm9uKG8rZCxudWxsKSx5KHAmJkJvLmV2ZW50LnRhcmdldD09PWYpLGcoe3R5cGU6ImRyYWdlbmQifSkpfXZhciBzLGw9dGhpcyxmPUJvLmV2ZW50LnRhcmdldCxoPWwucGFyZW50Tm9kZSxnPXIub2YobCxhcmd1bWVudHMpLHA9MCx2PW4oKSxkPSIuZHJhZyIrKG51bGw9PXY/IiI6Ii0iK3YpLG09Qm8uc2VsZWN0KHUoKSkub24oaStkLGEpLm9uKG8rZCxjKSx5PVkoKSx4PXQoaCx2KTtlPyhzPWUuYXBwbHkobCxhcmd1bWVudHMpLHM9W3MueC14WzBdLHMueS14WzFdXSk6cz1bMCwwXSxnKHt0eXBlOiJkcmFnc3RhcnQifSl9fXZhciByPU0obiwiZHJhZyIsImRyYWdzdGFydCIsImRyYWdlbmQiKSxlPW51bGwsdT10KHYsQm8ubW91c2UsWCwibW91c2Vtb3ZlIiwibW91c2V1cCIpLGk9dChWLEJvLnRvdWNoLCQsInRvdWNobW92ZSIsInRvdWNoZW5kIik7cmV0dXJuIG4ub3JpZ2luPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhlPXQsbik6ZX0sQm8ucmViaW5kKG4sciwib24iKX07dmFyIGthPU1hdGguUEksRWE9MiprYSxBYT1rYS8yLENhPTFlLTYsTmE9Q2EqQ2EsemE9a2EvMTgwLExhPTE4MC9rYSxUYT1NYXRoLlNRUlQyLHFhPTIsUmE9NDtCby5pbnRlcnBvbGF0ZVpvb209ZnVuY3Rpb24obix0KXtmdW5jdGlvbiByKG4pe3ZhciB0PW4qeTtpZihtKXt2YXIgcj1RKHYpLG89aS8ocWEqaCkqKHIqbnQoVGEqdCt2KS1LKHYpKTtyZXR1cm5bZStvKnMsdStvKmwsaSpyL1EoVGEqdCt2KV19cmV0dXJuW2UrbipzLHUrbipsLGkqTWF0aC5leHAoVGEqdCldfXZhciBlPW5bMF0sdT1uWzFdLGk9blsyXSxvPXRbMF0sYT10WzFdLGM9dFsyXSxzPW8tZSxsPWEtdSxmPXMqcytsKmwsaD1NYXRoLnNxcnQoZiksZz0oYypjLWkqaStSYSpmKS8oMippKnFhKmgpLHA9KGMqYy1pKmktUmEqZikvKDIqYypxYSpoKSx2PU1hdGgubG9nKE1hdGguc3FydChnKmcrMSktZyksZD1NYXRoLmxvZyhNYXRoLnNxcnQocCpwKzEpLXApLG09ZC12LHk9KG18fE1hdGgubG9nKGMvaSkpL1RhO3JldHVybiByLmR1cmF0aW9uPTFlMyp5LHJ9LEJvLmJlaGF2aW9yLnpvb209ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKG4pe24ub24oQSxzKS5vbihVYSsiLnpvb20iLGYpLm9uKEMsaCkub24oImRibGNsaWNrLnpvb20iLGcpLm9uKHosbCl9ZnVuY3Rpb24gdChuKXtyZXR1cm5bKG5bMF0tUy54KS9TLmssKG5bMV0tUy55KS9TLmtdfWZ1bmN0aW9uIHIobil7cmV0dXJuW25bMF0qUy5rK1MueCxuWzFdKlMuaytTLnldfWZ1bmN0aW9uIGUobil7Uy5rPU1hdGgubWF4KEVbMF0sTWF0aC5taW4oRVsxXSxuKSl9ZnVuY3Rpb24gdShuLHQpe3Q9cih0KSxTLngrPW5bMF0tdFswXSxTLnkrPW5bMV0tdFsxXX1mdW5jdGlvbiBpKCl7XyYmXy5kb21haW4oeC5yYW5nZSgpLm1hcChmdW5jdGlvbihuKXtyZXR1cm4obi1TLngpL1Mua30pLm1hcCh4LmludmVydCkpLHcmJncuZG9tYWluKGIucmFuZ2UoKS5tYXAoZnVuY3Rpb24obil7cmV0dXJuKG4tUy55KS9TLmt9KS5tYXAoYi5pbnZlcnQpKX1mdW5jdGlvbiBvKG4pe24oe3R5cGU6Inpvb21zdGFydCJ9KX1mdW5jdGlvbiBhKG4pe2koKSxuKHt0eXBlOiJ6b29tIixzY2FsZTpTLmssdHJhbnNsYXRlOltTLngsUy55XX0pfWZ1bmN0aW9uIGMobil7bih7dHlwZToiem9vbWVuZCJ9KX1mdW5jdGlvbiBzKCl7ZnVuY3Rpb24gbigpe2w9MSx1KEJvLm1vdXNlKGUpLGcpLGEocyl9ZnVuY3Rpb24gcigpe2Yub24oQyxRbz09PWU/aDpudWxsKS5vbihOLG51bGwpLHAobCYmQm8uZXZlbnQudGFyZ2V0PT09aSksYyhzKX12YXIgZT10aGlzLGk9Qm8uZXZlbnQudGFyZ2V0LHM9TC5vZihlLGFyZ3VtZW50cyksbD0wLGY9Qm8uc2VsZWN0KFFvKS5vbihDLG4pLm9uKE4sciksZz10KEJvLm1vdXNlKGUpKSxwPVkoKTtILmNhbGwoZSksbyhzKX1mdW5jdGlvbiBsKCl7ZnVuY3Rpb24gbigpe3ZhciBuPUJvLnRvdWNoZXMoZyk7cmV0dXJuIGg9Uy5rLG4uZm9yRWFjaChmdW5jdGlvbihuKXtuLmlkZW50aWZpZXIgaW4gdiYmKHZbbi5pZGVudGlmaWVyXT10KG4pKX0pLG59ZnVuY3Rpb24gcigpe3ZhciB0PUJvLmV2ZW50LnRhcmdldDtCby5zZWxlY3QodCkub24oTSxpKS5vbihfLGYpLGIucHVzaCh0KTtmb3IodmFyIHI9Qm8uZXZlbnQuY2hhbmdlZFRvdWNoZXMsbz0wLGM9ci5sZW5ndGg7Yz5vOysrbyl2W3Jbb10uaWRlbnRpZmllcl09bnVsbDt2YXIgcz1uKCksbD1EYXRlLm5vdygpO2lmKDE9PT1zLmxlbmd0aCl7aWYoNTAwPmwtbSl7dmFyIGg9c1swXSxnPXZbaC5pZGVudGlmaWVyXTtlKDIqUy5rKSx1KGgsZykseSgpLGEocCl9bT1sfWVsc2UgaWYocy5sZW5ndGg+MSl7dmFyIGg9c1swXSx4PXNbMV0sdz1oWzBdLXhbMF0saz1oWzFdLXhbMV07ZD13KncrayprfX1mdW5jdGlvbiBpKCl7Zm9yKHZhciBuLHQscixpLG89Qm8udG91Y2hlcyhnKSxjPTAscz1vLmxlbmd0aDtzPmM7KytjLGk9bnVsbClpZihyPW9bY10saT12W3IuaWRlbnRpZmllcl0pe2lmKHQpYnJlYWs7bj1yLHQ9aX1pZihpKXt2YXIgbD0obD1yWzBdLW5bMF0pKmwrKGw9clsxXS1uWzFdKSpsLGY9ZCYmTWF0aC5zcXJ0KGwvZCk7bj1bKG5bMF0rclswXSkvMiwoblsxXStyWzFdKS8yXSx0PVsodFswXStpWzBdKS8yLCh0WzFdK2lbMV0pLzJdLGUoZipoKX1tPW51bGwsdShuLHQpLGEocCl9ZnVuY3Rpb24gZigpe2lmKEJvLmV2ZW50LnRvdWNoZXMubGVuZ3RoKXtmb3IodmFyIHQ9Qm8uZXZlbnQuY2hhbmdlZFRvdWNoZXMscj0wLGU9dC5sZW5ndGg7ZT5yOysrcilkZWxldGUgdlt0W3JdLmlkZW50aWZpZXJdO2Zvcih2YXIgdSBpbiB2KXJldHVybiB2b2lkIG4oKX1Cby5zZWxlY3RBbGwoYikub24oeCxudWxsKSx3Lm9uKEEscykub24oeixsKSxrKCksYyhwKX12YXIgaCxnPXRoaXMscD1MLm9mKGcsYXJndW1lbnRzKSx2PXt9LGQ9MCx4PSIuem9vbS0iK0JvLmV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLmlkZW50aWZpZXIsTT0idG91Y2htb3ZlIit4LF89InRvdWNoZW5kIit4LGI9W10sdz1Cby5zZWxlY3QoZykub24oQSxudWxsKS5vbih6LHIpLGs9WSgpO0guY2FsbChnKSxyKCksbyhwKX1mdW5jdGlvbiBmKCl7dmFyIG49TC5vZih0aGlzLGFyZ3VtZW50cyk7ZD9jbGVhclRpbWVvdXQoZCk6KEguY2FsbCh0aGlzKSxvKG4pKSxkPXNldFRpbWVvdXQoZnVuY3Rpb24oKXtkPW51bGwsYyhuKX0sNTApLHkoKTt2YXIgcj12fHxCby5tb3VzZSh0aGlzKTtwfHwocD10KHIpKSxlKE1hdGgucG93KDIsLjAwMipEYSgpKSpTLmspLHUocixwKSxhKG4pfWZ1bmN0aW9uIGgoKXtwPW51bGx9ZnVuY3Rpb24gZygpe3ZhciBuPUwub2YodGhpcyxhcmd1bWVudHMpLHI9Qm8ubW91c2UodGhpcyksaT10KHIpLHM9TWF0aC5sb2coUy5rKS9NYXRoLkxOMjtvKG4pLGUoTWF0aC5wb3coMixCby5ldmVudC5zaGlmdEtleT9NYXRoLmNlaWwocyktMTpNYXRoLmZsb29yKHMpKzEpKSx1KHIsaSksYShuKSxjKG4pfXZhciBwLHYsZCxtLHgsXyxiLHcsUz17eDowLHk6MCxrOjF9LGs9Wzk2MCw1MDBdLEU9UGEsQT0ibW91c2Vkb3duLnpvb20iLEM9Im1vdXNlbW92ZS56b29tIixOPSJtb3VzZXVwLnpvb20iLHo9InRvdWNoc3RhcnQuem9vbSIsTD1NKG4sInpvb21zdGFydCIsInpvb20iLCJ6b29tZW5kIik7cmV0dXJuIG4uZXZlbnQ9ZnVuY3Rpb24obil7bi5lYWNoKGZ1bmN0aW9uKCl7dmFyIG49TC5vZih0aGlzLGFyZ3VtZW50cyksdD1TO0FzP0JvLnNlbGVjdCh0aGlzKS50cmFuc2l0aW9uKCkuZWFjaCgic3RhcnQuem9vbSIsZnVuY3Rpb24oKXtTPXRoaXMuX19jaGFydF9ffHx7eDowLHk6MCxrOjF9LG8obil9KS50d2Vlbigiem9vbTp6b29tIixmdW5jdGlvbigpe3ZhciByPWtbMF0sZT1rWzFdLHU9ci8yLGk9ZS8yLG89Qm8uaW50ZXJwb2xhdGVab29tKFsodS1TLngpL1MuaywoaS1TLnkpL1MuayxyL1Mua10sWyh1LXQueCkvdC5rLChpLXQueSkvdC5rLHIvdC5rXSk7cmV0dXJuIGZ1bmN0aW9uKHQpe3ZhciBlPW8odCksYz1yL2VbMl07dGhpcy5fX2NoYXJ0X189Uz17eDp1LWVbMF0qYyx5OmktZVsxXSpjLGs6Y30sYShuKX19KS5lYWNoKCJlbmQuem9vbSIsZnVuY3Rpb24oKXtjKG4pfSk6KHRoaXMuX19jaGFydF9fPVMsbyhuKSxhKG4pLGMobikpfSl9LG4udHJhbnNsYXRlPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhTPXt4Oit0WzBdLHk6K3RbMV0sazpTLmt9LGkoKSxuKTpbUy54LFMueV19LG4uc2NhbGU9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KFM9e3g6Uy54LHk6Uy55LGs6K3R9LGkoKSxuKTpTLmt9LG4uc2NhbGVFeHRlbnQ9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KEU9bnVsbD09dD9QYTpbK3RbMF0sK3RbMV1dLG4pOkV9LG4uY2VudGVyPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh2PXQmJlsrdFswXSwrdFsxXV0sbik6dn0sbi5zaXplPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhrPXQmJlsrdFswXSwrdFsxXV0sbik6a30sbi54PWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhfPXQseD10LmNvcHkoKSxTPXt4OjAseTowLGs6MX0sbik6X30sbi55PWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh3PXQsYj10LmNvcHkoKSxTPXt4OjAseTowLGs6MX0sbik6d30sQm8ucmViaW5kKG4sTCwib24iKX07dmFyIERhLFBhPVswLDEvMF0sVWE9Im9ud2hlZWwiaW4gR28/KERhPWZ1bmN0aW9uKCl7cmV0dXJuLUJvLmV2ZW50LmRlbHRhWSooQm8uZXZlbnQuZGVsdGFNb2RlPzEyMDoxKX0sIndoZWVsIik6Im9ubW91c2V3aGVlbCJpbiBHbz8oRGE9ZnVuY3Rpb24oKXtyZXR1cm4gQm8uZXZlbnQud2hlZWxEZWx0YX0sIm1vdXNld2hlZWwiKTooRGE9ZnVuY3Rpb24oKXtyZXR1cm4tQm8uZXZlbnQuZGV0YWlsfSwiTW96TW91c2VQaXhlbFNjcm9sbCIpO3J0LnByb3RvdHlwZS50b1N0cmluZz1mdW5jdGlvbigpe3JldHVybiB0aGlzLnJnYigpKyIifSxCby5oc2w9ZnVuY3Rpb24obix0LHIpe3JldHVybiAxPT09YXJndW1lbnRzLmxlbmd0aD9uIGluc3RhbmNlb2YgdXQ/ZXQobi5oLG4ucyxuLmwpOl90KCIiK24sYnQsZXQpOmV0KCtuLCt0LCtyKX07dmFyIGphPXV0LnByb3RvdHlwZT1uZXcgcnQ7amEuYnJpZ2h0ZXI9ZnVuY3Rpb24obil7cmV0dXJuIG49TWF0aC5wb3coLjcsYXJndW1lbnRzLmxlbmd0aD9uOjEpLGV0KHRoaXMuaCx0aGlzLnMsdGhpcy5sL24pfSxqYS5kYXJrZXI9ZnVuY3Rpb24obil7cmV0dXJuIG49TWF0aC5wb3coLjcsYXJndW1lbnRzLmxlbmd0aD9uOjEpLGV0KHRoaXMuaCx0aGlzLnMsbip0aGlzLmwpfSxqYS5yZ2I9ZnVuY3Rpb24oKXtyZXR1cm4gaXQodGhpcy5oLHRoaXMucyx0aGlzLmwpfSxCby5oY2w9ZnVuY3Rpb24obix0LHIpe3JldHVybiAxPT09YXJndW1lbnRzLmxlbmd0aD9uIGluc3RhbmNlb2YgYXQ/b3Qobi5oLG4uYyxuLmwpOm4gaW5zdGFuY2VvZiBsdD9odChuLmwsbi5hLG4uYik6aHQoKG49d3QoKG49Qm8ucmdiKG4pKS5yLG4uZyxuLmIpKS5sLG4uYSxuLmIpOm90KCtuLCt0LCtyKX07dmFyIEhhPWF0LnByb3RvdHlwZT1uZXcgcnQ7SGEuYnJpZ2h0ZXI9ZnVuY3Rpb24obil7cmV0dXJuIG90KHRoaXMuaCx0aGlzLmMsTWF0aC5taW4oMTAwLHRoaXMubCtGYSooYXJndW1lbnRzLmxlbmd0aD9uOjEpKSl9LEhhLmRhcmtlcj1mdW5jdGlvbihuKXtyZXR1cm4gb3QodGhpcy5oLHRoaXMuYyxNYXRoLm1heCgwLHRoaXMubC1GYSooYXJndW1lbnRzLmxlbmd0aD9uOjEpKSl9LEhhLnJnYj1mdW5jdGlvbigpe3JldHVybiBjdCh0aGlzLmgsdGhpcy5jLHRoaXMubCkucmdiKCl9LEJvLmxhYj1mdW5jdGlvbihuLHQscil7cmV0dXJuIDE9PT1hcmd1bWVudHMubGVuZ3RoP24gaW5zdGFuY2VvZiBsdD9zdChuLmwsbi5hLG4uYik6biBpbnN0YW5jZW9mIGF0P2N0KG4ubCxuLmMsbi5oKTp3dCgobj1Cby5yZ2IobikpLnIsbi5nLG4uYik6c3QoK24sK3QsK3IpfTt2YXIgRmE9MTgsT2E9Ljk1MDQ3LElhPTEsWWE9MS4wODg4MyxaYT1sdC5wcm90b3R5cGU9bmV3IHJ0O1phLmJyaWdodGVyPWZ1bmN0aW9uKG4pe3JldHVybiBzdChNYXRoLm1pbigxMDAsdGhpcy5sK0ZhKihhcmd1bWVudHMubGVuZ3RoP246MSkpLHRoaXMuYSx0aGlzLmIpfSxaYS5kYXJrZXI9ZnVuY3Rpb24obil7cmV0dXJuIHN0KE1hdGgubWF4KDAsdGhpcy5sLUZhKihhcmd1bWVudHMubGVuZ3RoP246MSkpLHRoaXMuYSx0aGlzLmIpfSxaYS5yZ2I9ZnVuY3Rpb24oKXtyZXR1cm4gZnQodGhpcy5sLHRoaXMuYSx0aGlzLmIpfSxCby5yZ2I9ZnVuY3Rpb24obix0LHIpe3JldHVybiAxPT09YXJndW1lbnRzLmxlbmd0aD9uIGluc3RhbmNlb2YgeHQ/eXQobi5yLG4uZyxuLmIpOl90KCIiK24seXQsaXQpOnl0KH5+bix+fnQsfn5yKX07dmFyIFZhPXh0LnByb3RvdHlwZT1uZXcgcnQ7VmEuYnJpZ2h0ZXI9ZnVuY3Rpb24obil7bj1NYXRoLnBvdyguNyxhcmd1bWVudHMubGVuZ3RoP246MSk7dmFyIHQ9dGhpcy5yLHI9dGhpcy5nLGU9dGhpcy5iLHU9MzA7cmV0dXJuIHR8fHJ8fGU/KHQmJnU+dCYmKHQ9dSksciYmdT5yJiYocj11KSxlJiZ1PmUmJihlPXUpLHl0KE1hdGgubWluKDI1NSx+fih0L24pKSxNYXRoLm1pbigyNTUsfn4oci9uKSksTWF0aC5taW4oMjU1LH5+KGUvbikpKSk6eXQodSx1LHUpfSxWYS5kYXJrZXI9ZnVuY3Rpb24obil7cmV0dXJuIG49TWF0aC5wb3coLjcsYXJndW1lbnRzLmxlbmd0aD9uOjEpLHl0KH5+KG4qdGhpcy5yKSx+fihuKnRoaXMuZyksfn4obip0aGlzLmIpKX0sVmEuaHNsPWZ1bmN0aW9uKCl7cmV0dXJuIGJ0KHRoaXMucix0aGlzLmcsdGhpcy5iKX0sVmEudG9TdHJpbmc9ZnVuY3Rpb24oKXtyZXR1cm4iIyIrTXQodGhpcy5yKStNdCh0aGlzLmcpK010KHRoaXMuYil9O3ZhciAkYT1Cby5tYXAoe2FsaWNlYmx1ZToxNTc5MjM4MyxhbnRpcXVld2hpdGU6MTY0NDQzNzUsYXF1YTo2NTUzNSxhcXVhbWFyaW5lOjgzODg1NjQsYXp1cmU6MTU3OTQxNzUsYmVpZ2U6MTYxMTkyNjAsYmlzcXVlOjE2NzcwMjQ0LGJsYWNrOjAsYmxhbmNoZWRhbG1vbmQ6MTY3NzIwNDUsYmx1ZToyNTUsYmx1ZXZpb2xldDo5MDU1MjAyLGJyb3duOjEwODI0MjM0LGJ1cmx5d29vZDoxNDU5NjIzMSxjYWRldGJsdWU6NjI2NjUyOCxjaGFydHJldXNlOjgzODgzNTIsY2hvY29sYXRlOjEzNzg5NDcwLGNvcmFsOjE2NzQ0MjcyLGNvcm5mbG93ZXJibHVlOjY1OTE5ODEsY29ybnNpbGs6MTY3NzUzODgsY3JpbXNvbjoxNDQyMzEwMCxjeWFuOjY1NTM1LGRhcmtibHVlOjEzOSxkYXJrY3lhbjozNTcyMyxkYXJrZ29sZGVucm9kOjEyMDkyOTM5LGRhcmtncmF5OjExMTE5MDE3LGRhcmtncmVlbjoyNTYwMCxkYXJrZ3JleToxMTExOTAxNyxkYXJra2hha2k6MTI0MzMyNTksZGFya21hZ2VudGE6OTEwOTY0MyxkYXJrb2xpdmVncmVlbjo1NTk3OTk5LGRhcmtvcmFuZ2U6MTY3NDc1MjAsZGFya29yY2hpZDoxMDA0MDAxMixkYXJrcmVkOjkxMDk1MDQsZGFya3NhbG1vbjoxNTMwODQxMCxkYXJrc2VhZ3JlZW46OTQxOTkxOSxkYXJrc2xhdGVibHVlOjQ3MzQzNDcsZGFya3NsYXRlZ3JheTozMTAwNDk1LGRhcmtzbGF0ZWdyZXk6MzEwMDQ5NSxkYXJrdHVycXVvaXNlOjUyOTQ1LGRhcmt2aW9sZXQ6OTY5OTUzOSxkZWVwcGluazoxNjcxNjk0NyxkZWVwc2t5Ymx1ZTo0OTE1MSxkaW1ncmF5OjY5MDgyNjUsZGltZ3JleTo2OTA4MjY1LGRvZGdlcmJsdWU6MjAwMzE5OSxmaXJlYnJpY2s6MTE2NzQxNDYsZmxvcmFsd2hpdGU6MTY3NzU5MjAsZm9yZXN0Z3JlZW46MjI2Mzg0MixmdWNoc2lhOjE2NzExOTM1LGdhaW5zYm9ybzoxNDQ3NDQ2MCxnaG9zdHdoaXRlOjE2MzE2NjcxLGdvbGQ6MTY3NjY3MjAsZ29sZGVucm9kOjE0MzI5MTIwLGdyYXk6ODQyMTUwNCxncmVlbjozMjc2OCxncmVlbnllbGxvdzoxMTQwMzA1NSxncmV5Ojg0MjE1MDQsaG9uZXlkZXc6MTU3OTQxNjAsaG90cGluazoxNjczODc0MCxpbmRpYW5yZWQ6MTM0NTg1MjQsaW5kaWdvOjQ5MTUzMzAsaXZvcnk6MTY3NzcyMDAsa2hha2k6MTU3ODc2NjAsbGF2ZW5kZXI6MTUxMzI0MTAsbGF2ZW5kZXJibHVzaDoxNjc3MzM2NSxsYXduZ3JlZW46ODE5MDk3NixsZW1vbmNoaWZmb246MTY3NzU4ODUsbGlnaHRibHVlOjExMzkzMjU0LGxpZ2h0Y29yYWw6MTU3NjE1MzYsbGlnaHRjeWFuOjE0NzQ1NTk5LGxpZ2h0Z29sZGVucm9keWVsbG93OjE2NDQ4MjEwLGxpZ2h0Z3JheToxMzg4MjMyMyxsaWdodGdyZWVuOjk0OTgyNTYsbGlnaHRncmV5OjEzODgyMzIzLGxpZ2h0cGluazoxNjc1ODQ2NSxsaWdodHNhbG1vbjoxNjc1Mjc2MixsaWdodHNlYWdyZWVuOjIxNDI4OTAsbGlnaHRza3libHVlOjg5MDAzNDYsbGlnaHRzbGF0ZWdyYXk6NzgzMzc1MyxsaWdodHNsYXRlZ3JleTo3ODMzNzUzLGxpZ2h0c3RlZWxibHVlOjExNTg0NzM0LGxpZ2h0eWVsbG93OjE2Nzc3MTg0LGxpbWU6NjUyODAsbGltZWdyZWVuOjMzMjkzMzAsbGluZW46MTY0NDU2NzAsbWFnZW50YToxNjcxMTkzNSxtYXJvb246ODM4ODYwOCxtZWRpdW1hcXVhbWFyaW5lOjY3MzczMjIsbWVkaXVtYmx1ZToyMDUsbWVkaXVtb3JjaGlkOjEyMjExNjY3LG1lZGl1bXB1cnBsZTo5NjYyNjgzLG1lZGl1bXNlYWdyZWVuOjM5NzgwOTcsbWVkaXVtc2xhdGVibHVlOjgwODc3OTAsbWVkaXVtc3ByaW5nZ3JlZW46NjQxNTQsbWVkaXVtdHVycXVvaXNlOjQ3NzIzMDAsbWVkaXVtdmlvbGV0cmVkOjEzMDQ3MTczLG1pZG5pZ2h0Ymx1ZToxNjQ0OTEyLG1pbnRjcmVhbToxNjEyMTg1MCxtaXN0eXJvc2U6MTY3NzAyNzMsbW9jY2FzaW46MTY3NzAyMjksbmF2YWpvd2hpdGU6MTY3Njg2ODUsbmF2eToxMjgsb2xkbGFjZToxNjY0MzU1OCxvbGl2ZTo4NDIxMzc2LG9saXZlZHJhYjo3MDQ4NzM5LG9yYW5nZToxNjc1MzkyMCxvcmFuZ2VyZWQ6MTY3MjkzNDQsb3JjaGlkOjE0MzE1NzM0LHBhbGVnb2xkZW5yb2Q6MTU2NTcxMzAscGFsZWdyZWVuOjEwMDI1ODgwLHBhbGV0dXJxdW9pc2U6MTE1Mjk5NjYscGFsZXZpb2xldHJlZDoxNDM4MTIwMyxwYXBheWF3aGlwOjE2NzczMDc3LHBlYWNocHVmZjoxNjc2NzY3MyxwZXJ1OjEzNDY4OTkxLHBpbms6MTY3NjEwMzUscGx1bToxNDUyNDYzNyxwb3dkZXJibHVlOjExNTkxOTEwLHB1cnBsZTo4Mzg4NzM2LHJlZDoxNjcxMTY4MCxyb3N5YnJvd246MTIzNTc1MTkscm95YWxibHVlOjQyODY5NDUsc2FkZGxlYnJvd246OTEyNzE4NyxzYWxtb246MTY0MTY4ODIsc2FuZHlicm93bjoxNjAzMjg2NCxzZWFncmVlbjozMDUwMzI3LHNlYXNoZWxsOjE2Nzc0NjM4LHNpZW5uYToxMDUwNjc5NyxzaWx2ZXI6MTI2MzIyNTYsc2t5Ymx1ZTo4OTAwMzMxLHNsYXRlYmx1ZTo2OTcwMDYxLHNsYXRlZ3JheTo3MzcyOTQ0LHNsYXRlZ3JleTo3MzcyOTQ0LHNub3c6MTY3NzU5MzAsc3ByaW5nZ3JlZW46NjU0MDcsc3RlZWxibHVlOjQ2MjA5ODAsdGFuOjEzODA4NzgwLHRlYWw6MzI4OTYsdGhpc3RsZToxNDIwNDg4OCx0b21hdG86MTY3MzcwOTUsdHVycXVvaXNlOjQyNTE4NTYsdmlvbGV0OjE1NjMxMDg2LHdoZWF0OjE2MTEzMzMxLHdoaXRlOjE2Nzc3MjE1LHdoaXRlc21va2U6MTYxMTkyODUseWVsbG93OjE2Nzc2OTYwLHllbGxvd2dyZWVuOjEwMTQ1MDc0fSk7JGEuZm9yRWFjaChmdW5jdGlvbihuLHQpeyRhLnNldChuLGR0KHQpKX0pLEJvLmZ1bmN0b3I9RXQsQm8ueGhyPUN0KEF0KSxCby5kc3Y9ZnVuY3Rpb24obix0KXtmdW5jdGlvbiByKG4scixpKXthcmd1bWVudHMubGVuZ3RoPDMmJihpPXIscj1udWxsKTt2YXIgbz1OdChuLHQsbnVsbD09cj9lOnUociksaSk7cmV0dXJuIG8ucm93PWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoP28ucmVzcG9uc2UobnVsbD09KHI9bik/ZTp1KG4pKTpyfSxvfWZ1bmN0aW9uIGUobil7cmV0dXJuIHIucGFyc2Uobi5yZXNwb25zZVRleHQpfWZ1bmN0aW9uIHUobil7cmV0dXJuIGZ1bmN0aW9uKHQpe3JldHVybiByLnBhcnNlKHQucmVzcG9uc2VUZXh0LG4pfX1mdW5jdGlvbiBpKHQpe3JldHVybiB0Lm1hcChvKS5qb2luKG4pfWZ1bmN0aW9uIG8obil7cmV0dXJuIGEudGVzdChuKT8nIicrbi5yZXBsYWNlKC9cIi9nLCciIicpKyciJzpufXZhciBhPW5ldyBSZWdFeHAoJ1siJytuKyJcbl0iKSxjPW4uY2hhckNvZGVBdCgwKTtyZXR1cm4gci5wYXJzZT1mdW5jdGlvbihuLHQpe3ZhciBlO3JldHVybiByLnBhcnNlUm93cyhuLGZ1bmN0aW9uKG4scil7aWYoZSlyZXR1cm4gZShuLHItMSk7dmFyIHU9bmV3IEZ1bmN0aW9uKCJkIiwicmV0dXJuIHsiK24ubWFwKGZ1bmN0aW9uKG4sdCl7cmV0dXJuIEpTT04uc3RyaW5naWZ5KG4pKyI6IGRbIit0KyJdIn0pLmpvaW4oIiwiKSsifSIpO2U9dD9mdW5jdGlvbihuLHIpe3JldHVybiB0KHUobikscil9OnV9KX0sci5wYXJzZVJvd3M9ZnVuY3Rpb24obix0KXtmdW5jdGlvbiByKCl7aWYobD49cylyZXR1cm4gbztpZih1KXJldHVybiB1PSExLGk7dmFyIHQ9bDtpZigzND09PW4uY2hhckNvZGVBdCh0KSl7Zm9yKHZhciByPXQ7cisrPHM7KWlmKDM0PT09bi5jaGFyQ29kZUF0KHIpKXtpZigzNCE9PW4uY2hhckNvZGVBdChyKzEpKWJyZWFrOysrcn1sPXIrMjt2YXIgZT1uLmNoYXJDb2RlQXQocisxKTtyZXR1cm4gMTM9PT1lPyh1PSEwLDEwPT09bi5jaGFyQ29kZUF0KHIrMikmJisrbCk6MTA9PT1lJiYodT0hMCksbi5zdWJzdHJpbmcodCsxLHIpLnJlcGxhY2UoLyIiL2csJyInKX1mb3IoO3M+bDspe3ZhciBlPW4uY2hhckNvZGVBdChsKyspLGE9MTtpZigxMD09PWUpdT0hMDtlbHNlIGlmKDEzPT09ZSl1PSEwLDEwPT09bi5jaGFyQ29kZUF0KGwpJiYoKytsLCsrYSk7ZWxzZSBpZihlIT09Yyljb250aW51ZTtyZXR1cm4gbi5zdWJzdHJpbmcodCxsLWEpfXJldHVybiBuLnN1YnN0cmluZyh0KX1mb3IodmFyIGUsdSxpPXt9LG89e30sYT1bXSxzPW4ubGVuZ3RoLGw9MCxmPTA7KGU9cigpKSE9PW87KXtmb3IodmFyIGg9W107ZSE9PWkmJmUhPT1vOyloLnB1c2goZSksZT1yKCk7KCF0fHwoaD10KGgsZisrKSkpJiZhLnB1c2goaCl9cmV0dXJuIGF9LHIuZm9ybWF0PWZ1bmN0aW9uKHQpe2lmKEFycmF5LmlzQXJyYXkodFswXSkpcmV0dXJuIHIuZm9ybWF0Um93cyh0KTt2YXIgZT1uZXcgaCx1PVtdO3JldHVybiB0LmZvckVhY2goZnVuY3Rpb24obil7Zm9yKHZhciB0IGluIG4pZS5oYXModCl8fHUucHVzaChlLmFkZCh0KSl9KSxbdS5tYXAobykuam9pbihuKV0uY29uY2F0KHQubWFwKGZ1bmN0aW9uKHQpe3JldHVybiB1Lm1hcChmdW5jdGlvbihuKXtyZXR1cm4gbyh0W25dKX0pLmpvaW4obil9KSkuam9pbigiXG4iKX0sci5mb3JtYXRSb3dzPWZ1bmN0aW9uKG4pe3JldHVybiBuLm1hcChpKS5qb2luKCJcbiIpfSxyfSxCby5jc3Y9Qm8uZHN2KCIsIiwidGV4dC9jc3YiKSxCby50c3Y9Qm8uZHN2KCIJIiwidGV4dC90YWItc2VwYXJhdGVkLXZhbHVlcyIpLEJvLnRvdWNoPWZ1bmN0aW9uKG4sdCxyKXtpZihhcmd1bWVudHMubGVuZ3RoPDMmJihyPXQsdD14KCkuY2hhbmdlZFRvdWNoZXMpLHQpZm9yKHZhciBlLHU9MCxpPXQubGVuZ3RoO2k+dTsrK3UpaWYoKGU9dFt1XSkuaWRlbnRpZmllcj09PXIpcmV0dXJuIFoobixlKX07dmFyIFhhLEJhLEphLFdhLEdhLEthPVFvW3AoUW8sInJlcXVlc3RBbmltYXRpb25GcmFtZSIpXXx8ZnVuY3Rpb24obil7c2V0VGltZW91dChuLDE3KX07Qm8udGltZXI9ZnVuY3Rpb24obix0LHIpe3ZhciBlPWFyZ3VtZW50cy5sZW5ndGg7Mj5lJiYodD0wKSwzPmUmJihyPURhdGUubm93KCkpO3ZhciB1PXIrdCxpPXtjOm4sdDp1LGY6ITEsbjpudWxsfTtCYT9CYS5uPWk6WGE9aSxCYT1pLEphfHwoV2E9Y2xlYXJUaW1lb3V0KFdhKSxKYT0xLEthKEx0KSl9LEJvLnRpbWVyLmZsdXNoPWZ1bmN0aW9uKCl7VHQoKSxxdCgpfSxCby5yb3VuZD1mdW5jdGlvbihuLHQpe3JldHVybiB0P01hdGgucm91bmQobioodD1NYXRoLnBvdygxMCx0KSkpL3Q6TWF0aC5yb3VuZChuKX07dmFyIFFhPVsieSIsInoiLCJhIiwiZiIsInAiLCJuIiwiXHhiNSIsIm0iLCIiLCJrIiwiTSIsIkciLCJUIiwiUCIsIkUiLCJaIiwiWSJdLm1hcChEdCk7Qm8uZm9ybWF0UHJlZml4PWZ1bmN0aW9uKG4sdCl7dmFyIHI9MDtyZXR1cm4gbiYmKDA+biYmKG4qPS0xKSx0JiYobj1Cby5yb3VuZChuLFJ0KG4sdCkpKSxyPTErTWF0aC5mbG9vcigxZS0xMitNYXRoLmxvZyhuKS9NYXRoLkxOMTApLHI9TWF0aC5tYXgoLTI0LE1hdGgubWluKDI0LDMqTWF0aC5mbG9vcigoci0xKS8zKSkpKSxRYVs4K3IvM119O3ZhciBuYz0vKD86KFtee10pPyhbPD49Xl0pKT8oWytcLSBdKT8oWyQjXSk/KDApPyhcZCspPygsKT8oXC4tP1xkKyk/KFthLXolXSk/L2ksdGM9Qm8ubWFwKHtiOmZ1bmN0aW9uKG4pe3JldHVybiBuLnRvU3RyaW5nKDIpfSxjOmZ1bmN0aW9uKG4pe3JldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKG4pfSxvOmZ1bmN0aW9uKG4pe3JldHVybiBuLnRvU3RyaW5nKDgpfSx4OmZ1bmN0aW9uKG4pe3JldHVybiBuLnRvU3RyaW5nKDE2KX0sWDpmdW5jdGlvbihuKXtyZXR1cm4gbi50b1N0cmluZygxNikudG9VcHBlckNhc2UoKX0sZzpmdW5jdGlvbihuLHQpe3JldHVybiBuLnRvUHJlY2lzaW9uKHQpfSxlOmZ1bmN0aW9uKG4sdCl7cmV0dXJuIG4udG9FeHBvbmVudGlhbCh0KX0sZjpmdW5jdGlvbihuLHQpe3JldHVybiBuLnRvRml4ZWQodCl9LHI6ZnVuY3Rpb24obix0KXtyZXR1cm4obj1Cby5yb3VuZChuLFJ0KG4sdCkpKS50b0ZpeGVkKE1hdGgubWF4KDAsTWF0aC5taW4oMjAsUnQobiooMSsxZS0xNSksdCkpKSl9fSkscmM9Qm8udGltZT17fSxlYz1EYXRlO2p0LnByb3RvdHlwZT17Z2V0RGF0ZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLl8uZ2V0VVRDRGF0ZSgpfSxnZXREYXk6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fLmdldFVUQ0RheSgpfSxnZXRGdWxsWWVhcjpmdW5jdGlvbigpe3JldHVybiB0aGlzLl8uZ2V0VVRDRnVsbFllYXIoKX0sZ2V0SG91cnM6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fLmdldFVUQ0hvdXJzKCl9LGdldE1pbGxpc2Vjb25kczpmdW5jdGlvbigpe3JldHVybiB0aGlzLl8uZ2V0VVRDTWlsbGlzZWNvbmRzKCl9LGdldE1pbnV0ZXM6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fLmdldFVUQ01pbnV0ZXMoKX0sZ2V0TW9udGg6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fLmdldFVUQ01vbnRoKCl9LGdldFNlY29uZHM6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fLmdldFVUQ1NlY29uZHMoKX0sZ2V0VGltZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLl8uZ2V0VGltZSgpfSxnZXRUaW1lem9uZU9mZnNldDpmdW5jdGlvbigpe3JldHVybiAwfSx2YWx1ZU9mOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuXy52YWx1ZU9mKCl9LHNldERhdGU6ZnVuY3Rpb24oKXt1Yy5zZXRVVENEYXRlLmFwcGx5KHRoaXMuXyxhcmd1bWVudHMpfSxzZXREYXk6ZnVuY3Rpb24oKXt1Yy5zZXRVVENEYXkuYXBwbHkodGhpcy5fLGFyZ3VtZW50cyl9LHNldEZ1bGxZZWFyOmZ1bmN0aW9uKCl7dWMuc2V0VVRDRnVsbFllYXIuYXBwbHkodGhpcy5fLGFyZ3VtZW50cyl9LHNldEhvdXJzOmZ1bmN0aW9uKCl7dWMuc2V0VVRDSG91cnMuYXBwbHkodGhpcy5fLGFyZ3VtZW50cyl9LHNldE1pbGxpc2Vjb25kczpmdW5jdGlvbigpe3VjLnNldFVUQ01pbGxpc2Vjb25kcy5hcHBseSh0aGlzLl8sYXJndW1lbnRzKX0sc2V0TWludXRlczpmdW5jdGlvbigpe3VjLnNldFVUQ01pbnV0ZXMuYXBwbHkodGhpcy5fLGFyZ3VtZW50cyl9LHNldE1vbnRoOmZ1bmN0aW9uKCl7dWMuc2V0VVRDTW9udGguYXBwbHkodGhpcy5fLGFyZ3VtZW50cyl9LHNldFNlY29uZHM6ZnVuY3Rpb24oKXt1Yy5zZXRVVENTZWNvbmRzLmFwcGx5KHRoaXMuXyxhcmd1bWVudHMpfSxzZXRUaW1lOmZ1bmN0aW9uKCl7dWMuc2V0VGltZS5hcHBseSh0aGlzLl8sYXJndW1lbnRzKX19O3ZhciB1Yz1EYXRlLnByb3RvdHlwZTtyYy55ZWFyPUh0KGZ1bmN0aW9uKG4pe3JldHVybiBuPXJjLmRheShuKSxuLnNldE1vbnRoKDAsMSksbn0sZnVuY3Rpb24obix0KXtuLnNldEZ1bGxZZWFyKG4uZ2V0RnVsbFllYXIoKSt0KX0sZnVuY3Rpb24obil7cmV0dXJuIG4uZ2V0RnVsbFllYXIoKX0pLHJjLnllYXJzPXJjLnllYXIucmFuZ2UscmMueWVhcnMudXRjPXJjLnllYXIudXRjLnJhbmdlLHJjLmRheT1IdChmdW5jdGlvbihuKXt2YXIgdD1uZXcgZWMoMmUzLDApO3JldHVybiB0LnNldEZ1bGxZZWFyKG4uZ2V0RnVsbFllYXIoKSxuLmdldE1vbnRoKCksbi5nZXREYXRlKCkpLHR9LGZ1bmN0aW9uKG4sdCl7bi5zZXREYXRlKG4uZ2V0RGF0ZSgpK3QpfSxmdW5jdGlvbihuKXtyZXR1cm4gbi5nZXREYXRlKCktMX0pLHJjLmRheXM9cmMuZGF5LnJhbmdlLHJjLmRheXMudXRjPXJjLmRheS51dGMucmFuZ2UscmMuZGF5T2ZZZWFyPWZ1bmN0aW9uKG4pe3ZhciB0PXJjLnllYXIobik7cmV0dXJuIE1hdGguZmxvb3IoKG4tdC02ZTQqKG4uZ2V0VGltZXpvbmVPZmZzZXQoKS10LmdldFRpbWV6b25lT2Zmc2V0KCkpKS84NjRlNSl9LFsic3VuZGF5IiwibW9uZGF5IiwidHVlc2RheSIsIndlZG5lc2RheSIsInRodXJzZGF5IiwiZnJpZGF5Iiwic2F0dXJkYXkiXS5mb3JFYWNoKGZ1bmN0aW9uKG4sdCl7dD03LXQ7dmFyIHI9cmNbbl09SHQoZnVuY3Rpb24obil7cmV0dXJuKG49cmMuZGF5KG4pKS5zZXREYXRlKG4uZ2V0RGF0ZSgpLShuLmdldERheSgpK3QpJTcpLG59LGZ1bmN0aW9uKG4sdCl7bi5zZXREYXRlKG4uZ2V0RGF0ZSgpKzcqTWF0aC5mbG9vcih0KSl9LGZ1bmN0aW9uKG4pe3ZhciByPXJjLnllYXIobikuZ2V0RGF5KCk7cmV0dXJuIE1hdGguZmxvb3IoKHJjLmRheU9mWWVhcihuKSsocit0KSU3KS83KS0ociE9PXQpfSk7cmNbbisicyJdPXIucmFuZ2UscmNbbisicyJdLnV0Yz1yLnV0Yy5yYW5nZSxyY1tuKyJPZlllYXIiXT1mdW5jdGlvbihuKXt2YXIgcj1yYy55ZWFyKG4pLmdldERheSgpO3JldHVybiBNYXRoLmZsb29yKChyYy5kYXlPZlllYXIobikrKHIrdCklNykvNyl9fSkscmMud2Vlaz1yYy5zdW5kYXkscmMud2Vla3M9cmMuc3VuZGF5LnJhbmdlLHJjLndlZWtzLnV0Yz1yYy5zdW5kYXkudXRjLnJhbmdlLHJjLndlZWtPZlllYXI9cmMuc3VuZGF5T2ZZZWFyO3ZhciBpYz17Ii0iOiIiLF86IiAiLDA6IjAifSxvYz0vXlxzKlxkKy8sYWM9L14lLztCby5sb2NhbGU9ZnVuY3Rpb24obil7cmV0dXJue251bWJlckZvcm1hdDpQdChuKSx0aW1lRm9ybWF0Ok90KG4pfX07dmFyIGNjPUJvLmxvY2FsZSh7ZGVjaW1hbDoiLiIsdGhvdXNhbmRzOiIsIixncm91cGluZzpbM10sY3VycmVuY3k6WyIkIiwiIl0sZGF0ZVRpbWU6IiVhICViICVlICVYICVZIixkYXRlOiIlbS8lZC8lWSIsdGltZToiJUg6JU06JVMiLHBlcmlvZHM6WyJBTSIsIlBNIl0sZGF5czpbIlN1bmRheSIsIk1vbmRheSIsIlR1ZXNkYXkiLCJXZWRuZXNkYXkiLCJUaHVyc2RheSIsIkZyaWRheSIsIlNhdHVyZGF5Il0sc2hvcnREYXlzOlsiU3VuIiwiTW9uIiwiVHVlIiwiV2VkIiwiVGh1IiwiRnJpIiwiU2F0Il0sbW9udGhzOlsiSmFudWFyeSIsIkZlYnJ1YXJ5IiwiTWFyY2giLCJBcHJpbCIsIk1heSIsIkp1bmUiLCJKdWx5IiwiQXVndXN0IiwiU2VwdGVtYmVyIiwiT2N0b2JlciIsIk5vdmVtYmVyIiwiRGVjZW1iZXIiXSxzaG9ydE1vbnRoczpbIkphbiIsIkZlYiIsIk1hciIsIkFwciIsIk1heSIsIkp1biIsIkp1bCIsIkF1ZyIsIlNlcCIsIk9jdCIsIk5vdiIsIkRlYyJdfSk7Qm8uZm9ybWF0PWNjLm51bWJlckZvcm1hdCxCby5nZW89e30sY3IucHJvdG90eXBlPXtzOjAsdDowLGFkZDpmdW5jdGlvbihuKXtzcihuLHRoaXMudCxzYyksc3Ioc2Mucyx0aGlzLnMsdGhpcyksdGhpcy5zP3RoaXMudCs9c2MudDp0aGlzLnM9c2MudH0scmVzZXQ6ZnVuY3Rpb24oKXt0aGlzLnM9dGhpcy50PTB9LHZhbHVlT2Y6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5zfX07dmFyIHNjPW5ldyBjcjtCby5nZW8uc3RyZWFtPWZ1bmN0aW9uKG4sdCl7biYmbGMuaGFzT3duUHJvcGVydHkobi50eXBlKT9sY1tuLnR5cGVdKG4sdCk6bHIobix0KX07dmFyIGxjPXtGZWF0dXJlOmZ1bmN0aW9uKG4sdCl7bHIobi5nZW9tZXRyeSx0KX0sRmVhdHVyZUNvbGxlY3Rpb246ZnVuY3Rpb24obix0KXtmb3IodmFyIHI9bi5mZWF0dXJlcyxlPS0xLHU9ci5sZW5ndGg7KytlPHU7KWxyKHJbZV0uZ2VvbWV0cnksdCl9fSxmYz17U3BoZXJlOmZ1bmN0aW9uKG4sdCl7dC5zcGhlcmUoKX0sUG9pbnQ6ZnVuY3Rpb24obix0KXtuPW4uY29vcmRpbmF0ZXMsdC5wb2ludChuWzBdLG5bMV0sblsyXSl9LE11bHRpUG9pbnQ6ZnVuY3Rpb24obix0KXtmb3IodmFyIHI9bi5jb29yZGluYXRlcyxlPS0xLHU9ci5sZW5ndGg7KytlPHU7KW49cltlXSx0LnBvaW50KG5bMF0sblsxXSxuWzJdKX0sTGluZVN0cmluZzpmdW5jdGlvbihuLHQpe2ZyKG4uY29vcmRpbmF0ZXMsdCwwKX0sTXVsdGlMaW5lU3RyaW5nOmZ1bmN0aW9uKG4sdCl7Zm9yKHZhciByPW4uY29vcmRpbmF0ZXMsZT0tMSx1PXIubGVuZ3RoOysrZTx1OylmcihyW2VdLHQsMCl9LFBvbHlnb246ZnVuY3Rpb24obix0KXtocihuLmNvb3JkaW5hdGVzLHQpfSxNdWx0aVBvbHlnb246ZnVuY3Rpb24obix0KXtmb3IodmFyIHI9bi5jb29yZGluYXRlcyxlPS0xLHU9ci5sZW5ndGg7KytlPHU7KWhyKHJbZV0sdCl9LEdlb21ldHJ5Q29sbGVjdGlvbjpmdW5jdGlvbihuLHQpe2Zvcih2YXIgcj1uLmdlb21ldHJpZXMsZT0tMSx1PXIubGVuZ3RoOysrZTx1OylscihyW2VdLHQpfX07Qm8uZ2VvLmFyZWE9ZnVuY3Rpb24obil7cmV0dXJuIGhjPTAsQm8uZ2VvLnN0cmVhbShuLHBjKSxoY307dmFyIGhjLGdjPW5ldyBjcixwYz17c3BoZXJlOmZ1bmN0aW9uKCl7aGMrPTQqa2F9LHBvaW50OnYsbGluZVN0YXJ0OnYsbGluZUVuZDp2LHBvbHlnb25TdGFydDpmdW5jdGlvbigpe2djLnJlc2V0KCkscGMubGluZVN0YXJ0PWdyfSxwb2x5Z29uRW5kOmZ1bmN0aW9uKCl7dmFyIG49MipnYztoYys9MD5uPzQqa2ErbjpuLHBjLmxpbmVTdGFydD1wYy5saW5lRW5kPXBjLnBvaW50PXZ9fTtCby5nZW8uYm91bmRzPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbihuLHQpe3gucHVzaChNPVtsPW4saD1uXSksZj50JiYoZj10KSx0PmcmJihnPXQpfWZ1bmN0aW9uIHQodCxyKXt2YXIgZT1wcihbdCp6YSxyKnphXSk7aWYobSl7dmFyIHU9ZHIobSxlKSxpPVt1WzFdLC11WzBdLDBdLG89ZHIoaSx1KTt4cihvKSxvPU1yKG8pO3ZhciBjPXQtcCxzPWM+MD8xOi0xLHY9b1swXSpMYSpzLGQ9Y2EoYyk+MTgwO2lmKGReKHY+cypwJiZzKnQ+dikpe3ZhciB5PW9bMV0qTGE7eT5nJiYoZz15KX1lbHNlIGlmKHY9KHYrMzYwKSUzNjAtMTgwLGReKHY+cypwJiZzKnQ+dikpe3ZhciB5PS1vWzFdKkxhO2Y+eSYmKGY9eSl9ZWxzZSBmPnImJihmPXIpLHI+ZyYmKGc9cik7ZD9wPnQ/YShsLHQpPmEobCxoKSYmKGg9dCk6YSh0LGgpPmEobCxoKSYmKGw9dCk6aD49bD8obD50JiYobD10KSx0PmgmJihoPXQpKTp0PnA/YShsLHQpPmEobCxoKSYmKGg9dCk6YSh0LGgpPmEobCxoKSYmKGw9dCl9ZWxzZSBuKHQscik7bT1lLHA9dH1mdW5jdGlvbiByKCl7Xy5wb2ludD10fWZ1bmN0aW9uIGUoKXtNWzBdPWwsTVsxXT1oLF8ucG9pbnQ9bixtPW51bGx9ZnVuY3Rpb24gdShuLHIpe2lmKG0pe3ZhciBlPW4tcDt5Kz1jYShlKT4xODA/ZSsoZT4wPzM2MDotMzYwKTplfWVsc2Ugdj1uLGQ9cjtwYy5wb2ludChuLHIpLHQobixyKX1mdW5jdGlvbiBpKCl7cGMubGluZVN0YXJ0KCl9ZnVuY3Rpb24gbygpe3UodixkKSxwYy5saW5lRW5kKCksY2EoeSk+Q2EmJihsPS0oaD0xODApKSxNWzBdPWwsTVsxXT1oLG09bnVsbH1mdW5jdGlvbiBhKG4sdCl7cmV0dXJuKHQtPW4pPDA/dCszNjA6dH1mdW5jdGlvbiBjKG4sdCl7cmV0dXJuIG5bMF0tdFswXX1mdW5jdGlvbiBzKG4sdCl7cmV0dXJuIHRbMF08PXRbMV0/dFswXTw9biYmbjw9dFsxXTpuPHRbMF18fHRbMV08bn12YXIgbCxmLGgsZyxwLHYsZCxtLHkseCxNLF89e3BvaW50Om4sbGluZVN0YXJ0OnIsbGluZUVuZDplLHBvbHlnb25TdGFydDpmdW5jdGlvbigpe18ucG9pbnQ9dSxfLmxpbmVTdGFydD1pLF8ubGluZUVuZD1vLHk9MCxwYy5wb2x5Z29uU3RhcnQoKX0scG9seWdvbkVuZDpmdW5jdGlvbigpe3BjLnBvbHlnb25FbmQoKSxfLnBvaW50PW4sXy5saW5lU3RhcnQ9cixfLmxpbmVFbmQ9ZSwwPmdjPyhsPS0oaD0xODApLGY9LShnPTkwKSk6eT5DYT9nPTkwOi1DYT55JiYoZj0tOTApLE1bMF09bCxNWzFdPWh9fTtyZXR1cm4gZnVuY3Rpb24obil7Zz1oPS0obD1mPTEvMCkseD1bXSxCby5nZW8uc3RyZWFtKG4sXyk7dmFyIHQ9eC5sZW5ndGg7aWYodCl7eC5zb3J0KGMpO2Zvcih2YXIgcixlPTEsdT14WzBdLGk9W3VdO3Q+ZTsrK2Upcj14W2VdLHMoclswXSx1KXx8cyhyWzFdLHUpPyhhKHVbMF0sclsxXSk+YSh1WzBdLHVbMV0pJiYodVsxXT1yWzFdKSxhKHJbMF0sdVsxXSk+YSh1WzBdLHVbMV0pJiYodVswXT1yWzBdKSk6aS5wdXNoKHU9cik7Zm9yKHZhciBvLHIscD0tMS8wLHQ9aS5sZW5ndGgtMSxlPTAsdT1pW3RdO3Q+PWU7dT1yLCsrZSlyPWlbZV0sKG89YSh1WzFdLHJbMF0pKT5wJiYocD1vLGw9clswXSxoPXVbMV0pfXJldHVybiB4PU09bnVsbCwxLzA9PT1sfHwxLzA9PT1mP1tbMC8wLDAvMF0sWzAvMCwwLzBdXTpbW2wsZl0sW2gsZ11dCn19KCksQm8uZ2VvLmNlbnRyb2lkPWZ1bmN0aW9uKG4pe3ZjPWRjPW1jPXljPXhjPU1jPV9jPWJjPXdjPVNjPWtjPTAsQm8uZ2VvLnN0cmVhbShuLEVjKTt2YXIgdD13YyxyPVNjLGU9a2MsdT10KnQrcipyK2UqZTtyZXR1cm4gTmE+dSYmKHQ9TWMscj1fYyxlPWJjLENhPmRjJiYodD1tYyxyPXljLGU9eGMpLHU9dCp0K3IqcitlKmUsTmE+dSk/WzAvMCwwLzBdOltNYXRoLmF0YW4yKHIsdCkqTGEsRyhlL01hdGguc3FydCh1KSkqTGFdfTt2YXIgdmMsZGMsbWMseWMseGMsTWMsX2MsYmMsd2MsU2Msa2MsRWM9e3NwaGVyZTp2LHBvaW50OmJyLGxpbmVTdGFydDpTcixsaW5lRW5kOmtyLHBvbHlnb25TdGFydDpmdW5jdGlvbigpe0VjLmxpbmVTdGFydD1Fcn0scG9seWdvbkVuZDpmdW5jdGlvbigpe0VjLmxpbmVTdGFydD1Tcn19LEFjPUxyKEFyLFByLGpyLFsta2EsLWthLzJdKSxDYz0xZTk7Qm8uZ2VvLmNsaXBFeHRlbnQ9ZnVuY3Rpb24oKXt2YXIgbix0LHIsZSx1LGksbz17c3RyZWFtOmZ1bmN0aW9uKG4pe3JldHVybiB1JiYodS52YWxpZD0hMSksdT1pKG4pLHUudmFsaWQ9ITAsdX0sZXh0ZW50OmZ1bmN0aW9uKGEpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhpPU9yKG49K2FbMF1bMF0sdD0rYVswXVsxXSxyPSthWzFdWzBdLGU9K2FbMV1bMV0pLHUmJih1LnZhbGlkPSExLHU9bnVsbCksbyk6W1tuLHRdLFtyLGVdXX19O3JldHVybiBvLmV4dGVudChbWzAsMF0sWzk2MCw1MDBdXSl9LChCby5nZW8uY29uaWNFcXVhbEFyZWE9ZnVuY3Rpb24oKXtyZXR1cm4gWXIoWnIpfSkucmF3PVpyLEJvLmdlby5hbGJlcnM9ZnVuY3Rpb24oKXtyZXR1cm4gQm8uZ2VvLmNvbmljRXF1YWxBcmVhKCkucm90YXRlKFs5NiwwXSkuY2VudGVyKFstLjYsMzguN10pLnBhcmFsbGVscyhbMjkuNSw0NS41XSkuc2NhbGUoMTA3MCl9LEJvLmdlby5hbGJlcnNVc2E9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKG4pe3ZhciBpPW5bMF0sbz1uWzFdO3JldHVybiB0PW51bGwscihpLG8pLHR8fChlKGksbyksdCl8fHUoaSxvKSx0fXZhciB0LHIsZSx1LGk9Qm8uZ2VvLmFsYmVycygpLG89Qm8uZ2VvLmNvbmljRXF1YWxBcmVhKCkucm90YXRlKFsxNTQsMF0pLmNlbnRlcihbLTIsNTguNV0pLnBhcmFsbGVscyhbNTUsNjVdKSxhPUJvLmdlby5jb25pY0VxdWFsQXJlYSgpLnJvdGF0ZShbMTU3LDBdKS5jZW50ZXIoWy0zLDE5LjldKS5wYXJhbGxlbHMoWzgsMThdKSxjPXtwb2ludDpmdW5jdGlvbihuLHIpe3Q9W24scl19fTtyZXR1cm4gbi5pbnZlcnQ9ZnVuY3Rpb24obil7dmFyIHQ9aS5zY2FsZSgpLHI9aS50cmFuc2xhdGUoKSxlPShuWzBdLXJbMF0pL3QsdT0oblsxXS1yWzFdKS90O3JldHVybih1Pj0uMTImJi4yMzQ+dSYmZT49LS40MjUmJi0uMjE0PmU/bzp1Pj0uMTY2JiYuMjM0PnUmJmU+PS0uMjE0JiYtLjExNT5lP2E6aSkuaW52ZXJ0KG4pfSxuLnN0cmVhbT1mdW5jdGlvbihuKXt2YXIgdD1pLnN0cmVhbShuKSxyPW8uc3RyZWFtKG4pLGU9YS5zdHJlYW0obik7cmV0dXJue3BvaW50OmZ1bmN0aW9uKG4sdSl7dC5wb2ludChuLHUpLHIucG9pbnQobix1KSxlLnBvaW50KG4sdSl9LHNwaGVyZTpmdW5jdGlvbigpe3Quc3BoZXJlKCksci5zcGhlcmUoKSxlLnNwaGVyZSgpfSxsaW5lU3RhcnQ6ZnVuY3Rpb24oKXt0LmxpbmVTdGFydCgpLHIubGluZVN0YXJ0KCksZS5saW5lU3RhcnQoKX0sbGluZUVuZDpmdW5jdGlvbigpe3QubGluZUVuZCgpLHIubGluZUVuZCgpLGUubGluZUVuZCgpfSxwb2x5Z29uU3RhcnQ6ZnVuY3Rpb24oKXt0LnBvbHlnb25TdGFydCgpLHIucG9seWdvblN0YXJ0KCksZS5wb2x5Z29uU3RhcnQoKX0scG9seWdvbkVuZDpmdW5jdGlvbigpe3QucG9seWdvbkVuZCgpLHIucG9seWdvbkVuZCgpLGUucG9seWdvbkVuZCgpfX19LG4ucHJlY2lzaW9uPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhpLnByZWNpc2lvbih0KSxvLnByZWNpc2lvbih0KSxhLnByZWNpc2lvbih0KSxuKTppLnByZWNpc2lvbigpfSxuLnNjYWxlPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhpLnNjYWxlKHQpLG8uc2NhbGUoLjM1KnQpLGEuc2NhbGUodCksbi50cmFuc2xhdGUoaS50cmFuc2xhdGUoKSkpOmkuc2NhbGUoKX0sbi50cmFuc2xhdGU9ZnVuY3Rpb24odCl7aWYoIWFyZ3VtZW50cy5sZW5ndGgpcmV0dXJuIGkudHJhbnNsYXRlKCk7dmFyIHM9aS5zY2FsZSgpLGw9K3RbMF0sZj0rdFsxXTtyZXR1cm4gcj1pLnRyYW5zbGF0ZSh0KS5jbGlwRXh0ZW50KFtbbC0uNDU1KnMsZi0uMjM4KnNdLFtsKy40NTUqcyxmKy4yMzgqc11dKS5zdHJlYW0oYykucG9pbnQsZT1vLnRyYW5zbGF0ZShbbC0uMzA3KnMsZisuMjAxKnNdKS5jbGlwRXh0ZW50KFtbbC0uNDI1KnMrQ2EsZisuMTIqcytDYV0sW2wtLjIxNCpzLUNhLGYrLjIzNCpzLUNhXV0pLnN0cmVhbShjKS5wb2ludCx1PWEudHJhbnNsYXRlKFtsLS4yMDUqcyxmKy4yMTIqc10pLmNsaXBFeHRlbnQoW1tsLS4yMTQqcytDYSxmKy4xNjYqcytDYV0sW2wtLjExNSpzLUNhLGYrLjIzNCpzLUNhXV0pLnN0cmVhbShjKS5wb2ludCxufSxuLnNjYWxlKDEwNzApfTt2YXIgTmMsemMsTGMsVGMscWMsUmMsRGM9e3BvaW50OnYsbGluZVN0YXJ0OnYsbGluZUVuZDp2LHBvbHlnb25TdGFydDpmdW5jdGlvbigpe3pjPTAsRGMubGluZVN0YXJ0PVZyfSxwb2x5Z29uRW5kOmZ1bmN0aW9uKCl7RGMubGluZVN0YXJ0PURjLmxpbmVFbmQ9RGMucG9pbnQ9dixOYys9Y2EoemMvMil9fSxQYz17cG9pbnQ6JHIsbGluZVN0YXJ0OnYsbGluZUVuZDp2LHBvbHlnb25TdGFydDp2LHBvbHlnb25FbmQ6dn0sVWM9e3BvaW50OkpyLGxpbmVTdGFydDpXcixsaW5lRW5kOkdyLHBvbHlnb25TdGFydDpmdW5jdGlvbigpe1VjLmxpbmVTdGFydD1Lcn0scG9seWdvbkVuZDpmdW5jdGlvbigpe1VjLnBvaW50PUpyLFVjLmxpbmVTdGFydD1XcixVYy5saW5lRW5kPUdyfX07Qm8uZ2VvLnBhdGg9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKG4pe3JldHVybiBuJiYoImZ1bmN0aW9uIj09dHlwZW9mIGEmJmkucG9pbnRSYWRpdXMoK2EuYXBwbHkodGhpcyxhcmd1bWVudHMpKSxvJiZvLnZhbGlkfHwobz11KGkpKSxCby5nZW8uc3RyZWFtKG4sbykpLGkucmVzdWx0KCl9ZnVuY3Rpb24gdCgpe3JldHVybiBvPW51bGwsbn12YXIgcixlLHUsaSxvLGE9NC41O3JldHVybiBuLmFyZWE9ZnVuY3Rpb24obil7cmV0dXJuIE5jPTAsQm8uZ2VvLnN0cmVhbShuLHUoRGMpKSxOY30sbi5jZW50cm9pZD1mdW5jdGlvbihuKXtyZXR1cm4gbWM9eWM9eGM9TWM9X2M9YmM9d2M9U2M9a2M9MCxCby5nZW8uc3RyZWFtKG4sdShVYykpLGtjP1t3Yy9rYyxTYy9rY106YmM/W01jL2JjLF9jL2JjXTp4Yz9bbWMveGMseWMveGNdOlswLzAsMC8wXX0sbi5ib3VuZHM9ZnVuY3Rpb24obil7cmV0dXJuIHFjPVJjPS0oTGM9VGM9MS8wKSxCby5nZW8uc3RyZWFtKG4sdShQYykpLFtbTGMsVGNdLFtxYyxSY11dfSxuLnByb2plY3Rpb249ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHU9KHI9bik/bi5zdHJlYW18fHRlKG4pOkF0LHQoKSk6cn0sbi5jb250ZXh0PWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhpPW51bGw9PShlPW4pP25ldyBYcjpuZXcgUXIobiksImZ1bmN0aW9uIiE9dHlwZW9mIGEmJmkucG9pbnRSYWRpdXMoYSksdCgpKTplfSxuLnBvaW50UmFkaXVzPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhhPSJmdW5jdGlvbiI9PXR5cGVvZiB0P3Q6KGkucG9pbnRSYWRpdXMoK3QpLCt0KSxuKTphfSxuLnByb2plY3Rpb24oQm8uZ2VvLmFsYmVyc1VzYSgpKS5jb250ZXh0KG51bGwpfSxCby5nZW8udHJhbnNmb3JtPWZ1bmN0aW9uKG4pe3JldHVybntzdHJlYW06ZnVuY3Rpb24odCl7dmFyIHI9bmV3IHJlKHQpO2Zvcih2YXIgZSBpbiBuKXJbZV09bltlXTtyZXR1cm4gcn19fSxyZS5wcm90b3R5cGU9e3BvaW50OmZ1bmN0aW9uKG4sdCl7dGhpcy5zdHJlYW0ucG9pbnQobix0KX0sc3BoZXJlOmZ1bmN0aW9uKCl7dGhpcy5zdHJlYW0uc3BoZXJlKCl9LGxpbmVTdGFydDpmdW5jdGlvbigpe3RoaXMuc3RyZWFtLmxpbmVTdGFydCgpfSxsaW5lRW5kOmZ1bmN0aW9uKCl7dGhpcy5zdHJlYW0ubGluZUVuZCgpfSxwb2x5Z29uU3RhcnQ6ZnVuY3Rpb24oKXt0aGlzLnN0cmVhbS5wb2x5Z29uU3RhcnQoKX0scG9seWdvbkVuZDpmdW5jdGlvbigpe3RoaXMuc3RyZWFtLnBvbHlnb25FbmQoKX19LEJvLmdlby5wcm9qZWN0aW9uPXVlLEJvLmdlby5wcm9qZWN0aW9uTXV0YXRvcj1pZSwoQm8uZ2VvLmVxdWlyZWN0YW5ndWxhcj1mdW5jdGlvbigpe3JldHVybiB1ZShhZSl9KS5yYXc9YWUuaW52ZXJ0PWFlLEJvLmdlby5yb3RhdGlvbj1mdW5jdGlvbihuKXtmdW5jdGlvbiB0KHQpe3JldHVybiB0PW4odFswXSp6YSx0WzFdKnphKSx0WzBdKj1MYSx0WzFdKj1MYSx0fXJldHVybiBuPXNlKG5bMF0lMzYwKnphLG5bMV0qemEsbi5sZW5ndGg+Mj9uWzJdKnphOjApLHQuaW52ZXJ0PWZ1bmN0aW9uKHQpe3JldHVybiB0PW4uaW52ZXJ0KHRbMF0qemEsdFsxXSp6YSksdFswXSo9TGEsdFsxXSo9TGEsdH0sdH0sY2UuaW52ZXJ0PWFlLEJvLmdlby5jaXJjbGU9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKCl7dmFyIG49ImZ1bmN0aW9uIj09dHlwZW9mIGU/ZS5hcHBseSh0aGlzLGFyZ3VtZW50cyk6ZSx0PXNlKC1uWzBdKnphLC1uWzFdKnphLDApLmludmVydCx1PVtdO3JldHVybiByKG51bGwsbnVsbCwxLHtwb2ludDpmdW5jdGlvbihuLHIpe3UucHVzaChuPXQobixyKSksblswXSo9TGEsblsxXSo9TGF9fSkse3R5cGU6IlBvbHlnb24iLGNvb3JkaW5hdGVzOlt1XX19dmFyIHQscixlPVswLDBdLHU9NjtyZXR1cm4gbi5vcmlnaW49ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGU9dCxuKTplfSxuLmFuZ2xlPWZ1bmN0aW9uKGUpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhyPWdlKCh0PStlKSp6YSx1KnphKSxuKTp0fSxuLnByZWNpc2lvbj1mdW5jdGlvbihlKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8ocj1nZSh0KnphLCh1PStlKSp6YSksbik6dX0sbi5hbmdsZSg5MCl9LEJvLmdlby5kaXN0YW5jZT1mdW5jdGlvbihuLHQpe3ZhciByLGU9KHRbMF0tblswXSkqemEsdT1uWzFdKnphLGk9dFsxXSp6YSxvPU1hdGguc2luKGUpLGE9TWF0aC5jb3MoZSksYz1NYXRoLnNpbih1KSxzPU1hdGguY29zKHUpLGw9TWF0aC5zaW4oaSksZj1NYXRoLmNvcyhpKTtyZXR1cm4gTWF0aC5hdGFuMihNYXRoLnNxcnQoKHI9ZipvKSpyKyhyPXMqbC1jKmYqYSkqciksYypsK3MqZiphKX0sQm8uZ2VvLmdyYXRpY3VsZT1mdW5jdGlvbigpe2Z1bmN0aW9uIG4oKXtyZXR1cm57dHlwZToiTXVsdGlMaW5lU3RyaW5nIixjb29yZGluYXRlczp0KCl9fWZ1bmN0aW9uIHQoKXtyZXR1cm4gQm8ucmFuZ2UoTWF0aC5jZWlsKGkvZCkqZCx1LGQpLm1hcChoKS5jb25jYXQoQm8ucmFuZ2UoTWF0aC5jZWlsKHMvbSkqbSxjLG0pLm1hcChnKSkuY29uY2F0KEJvLnJhbmdlKE1hdGguY2VpbChlL3ApKnAscixwKS5maWx0ZXIoZnVuY3Rpb24obil7cmV0dXJuIGNhKG4lZCk+Q2F9KS5tYXAobCkpLmNvbmNhdChCby5yYW5nZShNYXRoLmNlaWwoYS92KSp2LG8sdikuZmlsdGVyKGZ1bmN0aW9uKG4pe3JldHVybiBjYShuJW0pPkNhfSkubWFwKGYpKX12YXIgcixlLHUsaSxvLGEsYyxzLGwsZixoLGcscD0xMCx2PXAsZD05MCxtPTM2MCx5PTIuNTtyZXR1cm4gbi5saW5lcz1mdW5jdGlvbigpe3JldHVybiB0KCkubWFwKGZ1bmN0aW9uKG4pe3JldHVybnt0eXBlOiJMaW5lU3RyaW5nIixjb29yZGluYXRlczpufX0pfSxuLm91dGxpbmU9ZnVuY3Rpb24oKXtyZXR1cm57dHlwZToiUG9seWdvbiIsY29vcmRpbmF0ZXM6W2goaSkuY29uY2F0KGcoYykuc2xpY2UoMSksaCh1KS5yZXZlcnNlKCkuc2xpY2UoMSksZyhzKS5yZXZlcnNlKCkuc2xpY2UoMSkpXX19LG4uZXh0ZW50PWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoP24ubWFqb3JFeHRlbnQodCkubWlub3JFeHRlbnQodCk6bi5taW5vckV4dGVudCgpfSxuLm1ham9yRXh0ZW50PWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhpPSt0WzBdWzBdLHU9K3RbMV1bMF0scz0rdFswXVsxXSxjPSt0WzFdWzFdLGk+dSYmKHQ9aSxpPXUsdT10KSxzPmMmJih0PXMscz1jLGM9dCksbi5wcmVjaXNpb24oeSkpOltbaSxzXSxbdSxjXV19LG4ubWlub3JFeHRlbnQ9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGU9K3RbMF1bMF0scj0rdFsxXVswXSxhPSt0WzBdWzFdLG89K3RbMV1bMV0sZT5yJiYodD1lLGU9cixyPXQpLGE+byYmKHQ9YSxhPW8sbz10KSxuLnByZWNpc2lvbih5KSk6W1tlLGFdLFtyLG9dXX0sbi5zdGVwPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoP24ubWFqb3JTdGVwKHQpLm1pbm9yU3RlcCh0KTpuLm1pbm9yU3RlcCgpfSxuLm1ham9yU3RlcD1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oZD0rdFswXSxtPSt0WzFdLG4pOltkLG1dfSxuLm1pbm9yU3RlcD1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8ocD0rdFswXSx2PSt0WzFdLG4pOltwLHZdfSxuLnByZWNpc2lvbj1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oeT0rdCxsPXZlKGEsbyw5MCksZj1kZShlLHIseSksaD12ZShzLGMsOTApLGc9ZGUoaSx1LHkpLG4pOnl9LG4ubWFqb3JFeHRlbnQoW1stMTgwLC05MCtDYV0sWzE4MCw5MC1DYV1dKS5taW5vckV4dGVudChbWy0xODAsLTgwLUNhXSxbMTgwLDgwK0NhXV0pfSxCby5nZW8uZ3JlYXRBcmM9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKCl7cmV0dXJue3R5cGU6IkxpbmVTdHJpbmciLGNvb3JkaW5hdGVzOlt0fHxlLmFwcGx5KHRoaXMsYXJndW1lbnRzKSxyfHx1LmFwcGx5KHRoaXMsYXJndW1lbnRzKV19fXZhciB0LHIsZT1tZSx1PXllO3JldHVybiBuLmRpc3RhbmNlPWZ1bmN0aW9uKCl7cmV0dXJuIEJvLmdlby5kaXN0YW5jZSh0fHxlLmFwcGx5KHRoaXMsYXJndW1lbnRzKSxyfHx1LmFwcGx5KHRoaXMsYXJndW1lbnRzKSl9LG4uc291cmNlPWZ1bmN0aW9uKHIpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhlPXIsdD0iZnVuY3Rpb24iPT10eXBlb2Ygcj9udWxsOnIsbik6ZX0sbi50YXJnZXQ9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHU9dCxyPSJmdW5jdGlvbiI9PXR5cGVvZiB0P251bGw6dCxuKTp1fSxuLnByZWNpc2lvbj1mdW5jdGlvbigpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoP246MH0sbn0sQm8uZ2VvLmludGVycG9sYXRlPWZ1bmN0aW9uKG4sdCl7cmV0dXJuIHhlKG5bMF0qemEsblsxXSp6YSx0WzBdKnphLHRbMV0qemEpfSxCby5nZW8ubGVuZ3RoPWZ1bmN0aW9uKG4pe3JldHVybiBqYz0wLEJvLmdlby5zdHJlYW0obixIYyksamN9O3ZhciBqYyxIYz17c3BoZXJlOnYscG9pbnQ6dixsaW5lU3RhcnQ6TWUsbGluZUVuZDp2LHBvbHlnb25TdGFydDp2LHBvbHlnb25FbmQ6dn0sRmM9X2UoZnVuY3Rpb24obil7cmV0dXJuIE1hdGguc3FydCgyLygxK24pKX0sZnVuY3Rpb24obil7cmV0dXJuIDIqTWF0aC5hc2luKG4vMil9KTsoQm8uZ2VvLmF6aW11dGhhbEVxdWFsQXJlYT1mdW5jdGlvbigpe3JldHVybiB1ZShGYyl9KS5yYXc9RmM7dmFyIE9jPV9lKGZ1bmN0aW9uKG4pe3ZhciB0PU1hdGguYWNvcyhuKTtyZXR1cm4gdCYmdC9NYXRoLnNpbih0KX0sQXQpOyhCby5nZW8uYXppbXV0aGFsRXF1aWRpc3RhbnQ9ZnVuY3Rpb24oKXtyZXR1cm4gdWUoT2MpfSkucmF3PU9jLChCby5nZW8uY29uaWNDb25mb3JtYWw9ZnVuY3Rpb24oKXtyZXR1cm4gWXIoYmUpfSkucmF3PWJlLChCby5nZW8uY29uaWNFcXVpZGlzdGFudD1mdW5jdGlvbigpe3JldHVybiBZcih3ZSl9KS5yYXc9d2U7dmFyIEljPV9lKGZ1bmN0aW9uKG4pe3JldHVybiAxL259LE1hdGguYXRhbik7KEJvLmdlby5nbm9tb25pYz1mdW5jdGlvbigpe3JldHVybiB1ZShJYyl9KS5yYXc9SWMsU2UuaW52ZXJ0PWZ1bmN0aW9uKG4sdCl7cmV0dXJuW24sMipNYXRoLmF0YW4oTWF0aC5leHAodCkpLUFhXX0sKEJvLmdlby5tZXJjYXRvcj1mdW5jdGlvbigpe3JldHVybiBrZShTZSl9KS5yYXc9U2U7dmFyIFljPV9lKGZ1bmN0aW9uKCl7cmV0dXJuIDF9LE1hdGguYXNpbik7KEJvLmdlby5vcnRob2dyYXBoaWM9ZnVuY3Rpb24oKXtyZXR1cm4gdWUoWWMpfSkucmF3PVljO3ZhciBaYz1fZShmdW5jdGlvbihuKXtyZXR1cm4gMS8oMStuKX0sZnVuY3Rpb24obil7cmV0dXJuIDIqTWF0aC5hdGFuKG4pfSk7KEJvLmdlby5zdGVyZW9ncmFwaGljPWZ1bmN0aW9uKCl7cmV0dXJuIHVlKFpjKX0pLnJhdz1aYyxFZS5pbnZlcnQ9ZnVuY3Rpb24obix0KXtyZXR1cm5bLXQsMipNYXRoLmF0YW4oTWF0aC5leHAobikpLUFhXX0sKEJvLmdlby50cmFuc3ZlcnNlTWVyY2F0b3I9ZnVuY3Rpb24oKXt2YXIgbj1rZShFZSksdD1uLmNlbnRlcixyPW4ucm90YXRlO3JldHVybiBuLmNlbnRlcj1mdW5jdGlvbihuKXtyZXR1cm4gbj90KFstblsxXSxuWzBdXSk6KG49dCgpLFstblsxXSxuWzBdXSl9LG4ucm90YXRlPWZ1bmN0aW9uKG4pe3JldHVybiBuP3IoW25bMF0sblsxXSxuLmxlbmd0aD4yP25bMl0rOTA6OTBdKToobj1yKCksW25bMF0sblsxXSxuWzJdLTkwXSl9LG4ucm90YXRlKFswLDBdKX0pLnJhdz1FZSxCby5nZW9tPXt9LEJvLmdlb20uaHVsbD1mdW5jdGlvbihuKXtmdW5jdGlvbiB0KG4pe2lmKG4ubGVuZ3RoPDMpcmV0dXJuW107dmFyIHQsdT1FdChyKSxpPUV0KGUpLG89bi5sZW5ndGgsYT1bXSxjPVtdO2Zvcih0PTA7bz50O3QrKylhLnB1c2goWyt1LmNhbGwodGhpcyxuW3RdLHQpLCtpLmNhbGwodGhpcyxuW3RdLHQpLHRdKTtmb3IoYS5zb3J0KHplKSx0PTA7bz50O3QrKyljLnB1c2goW2FbdF1bMF0sLWFbdF1bMV1dKTt2YXIgcz1OZShhKSxsPU5lKGMpLGY9bFswXT09PXNbMF0saD1sW2wubGVuZ3RoLTFdPT09c1tzLmxlbmd0aC0xXSxnPVtdO2Zvcih0PXMubGVuZ3RoLTE7dD49MDstLXQpZy5wdXNoKG5bYVtzW3RdXVsyXV0pO2Zvcih0PStmO3Q8bC5sZW5ndGgtaDsrK3QpZy5wdXNoKG5bYVtsW3RdXVsyXV0pO3JldHVybiBnfXZhciByPUFlLGU9Q2U7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/dChuKToodC54PWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhyPW4sdCk6cn0sdC55PWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhlPW4sdCk6ZX0sdCl9LEJvLmdlb20ucG9seWdvbj1mdW5jdGlvbihuKXtyZXR1cm4gZ2EobixWYyksbn07dmFyIFZjPUJvLmdlb20ucG9seWdvbi5wcm90b3R5cGU9W107VmMuYXJlYT1mdW5jdGlvbigpe2Zvcih2YXIgbix0PS0xLHI9dGhpcy5sZW5ndGgsZT10aGlzW3ItMV0sdT0wOysrdDxyOyluPWUsZT10aGlzW3RdLHUrPW5bMV0qZVswXS1uWzBdKmVbMV07cmV0dXJuLjUqdX0sVmMuY2VudHJvaWQ9ZnVuY3Rpb24obil7dmFyIHQscixlPS0xLHU9dGhpcy5sZW5ndGgsaT0wLG89MCxhPXRoaXNbdS0xXTtmb3IoYXJndW1lbnRzLmxlbmd0aHx8KG49LTEvKDYqdGhpcy5hcmVhKCkpKTsrK2U8dTspdD1hLGE9dGhpc1tlXSxyPXRbMF0qYVsxXS1hWzBdKnRbMV0saSs9KHRbMF0rYVswXSkqcixvKz0odFsxXSthWzFdKSpyO3JldHVybltpKm4sbypuXX0sVmMuY2xpcD1mdW5jdGlvbihuKXtmb3IodmFyIHQscixlLHUsaSxvLGE9cWUobiksYz0tMSxzPXRoaXMubGVuZ3RoLXFlKHRoaXMpLGw9dGhpc1tzLTFdOysrYzxzOyl7Zm9yKHQ9bi5zbGljZSgpLG4ubGVuZ3RoPTAsdT10aGlzW2NdLGk9dFsoZT10Lmxlbmd0aC1hKS0xXSxyPS0xOysrcjxlOylvPXRbcl0sTGUobyxsLHUpPyhMZShpLGwsdSl8fG4ucHVzaChUZShpLG8sbCx1KSksbi5wdXNoKG8pKTpMZShpLGwsdSkmJm4ucHVzaChUZShpLG8sbCx1KSksaT1vO2EmJm4ucHVzaChuWzBdKSxsPXV9cmV0dXJuIG59O3ZhciAkYyxYYyxCYyxKYyxXYyxHYz1bXSxLYz1bXTtPZS5wcm90b3R5cGUucHJlcGFyZT1mdW5jdGlvbigpe2Zvcih2YXIgbix0PXRoaXMuZWRnZXMscj10Lmxlbmd0aDtyLS07KW49dFtyXS5lZGdlLG4uYiYmbi5hfHx0LnNwbGljZShyLDEpO3JldHVybiB0LnNvcnQoWWUpLHQubGVuZ3RofSxRZS5wcm90b3R5cGU9e3N0YXJ0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZWRnZS5sPT09dGhpcy5zaXRlP3RoaXMuZWRnZS5hOnRoaXMuZWRnZS5ifSxlbmQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5lZGdlLmw9PT10aGlzLnNpdGU/dGhpcy5lZGdlLmI6dGhpcy5lZGdlLmF9fSxudS5wcm90b3R5cGU9e2luc2VydDpmdW5jdGlvbihuLHQpe3ZhciByLGUsdTtpZihuKXtpZih0LlA9bix0Lk49bi5OLG4uTiYmKG4uTi5QPXQpLG4uTj10LG4uUil7Zm9yKG49bi5SO24uTDspbj1uLkw7bi5MPXR9ZWxzZSBuLlI9dDtyPW59ZWxzZSB0aGlzLl8/KG49dXUodGhpcy5fKSx0LlA9bnVsbCx0Lk49bixuLlA9bi5MPXQscj1uKToodC5QPXQuTj1udWxsLHRoaXMuXz10LHI9bnVsbCk7Zm9yKHQuTD10LlI9bnVsbCx0LlU9cix0LkM9ITAsbj10O3ImJnIuQzspZT1yLlUscj09PWUuTD8odT1lLlIsdSYmdS5DPyhyLkM9dS5DPSExLGUuQz0hMCxuPWUpOihuPT09ci5SJiYocnUodGhpcyxyKSxuPXIscj1uLlUpLHIuQz0hMSxlLkM9ITAsZXUodGhpcyxlKSkpOih1PWUuTCx1JiZ1LkM/KHIuQz11LkM9ITEsZS5DPSEwLG49ZSk6KG49PT1yLkwmJihldSh0aGlzLHIpLG49cixyPW4uVSksci5DPSExLGUuQz0hMCxydSh0aGlzLGUpKSkscj1uLlU7dGhpcy5fLkM9ITF9LHJlbW92ZTpmdW5jdGlvbihuKXtuLk4mJihuLk4uUD1uLlApLG4uUCYmKG4uUC5OPW4uTiksbi5OPW4uUD1udWxsO3ZhciB0LHIsZSx1PW4uVSxpPW4uTCxvPW4uUjtpZihyPWk/bz91dShvKTppOm8sdT91Lkw9PT1uP3UuTD1yOnUuUj1yOnRoaXMuXz1yLGkmJm8/KGU9ci5DLHIuQz1uLkMsci5MPWksaS5VPXIsciE9PW8/KHU9ci5VLHIuVT1uLlUsbj1yLlIsdS5MPW4sci5SPW8sby5VPXIpOihyLlU9dSx1PXIsbj1yLlIpKTooZT1uLkMsbj1yKSxuJiYobi5VPXUpLCFlKXtpZihuJiZuLkMpcmV0dXJuIG4uQz0hMSx2b2lkIDA7ZG97aWYobj09PXRoaXMuXylicmVhaztpZihuPT09dS5MKXtpZih0PXUuUix0LkMmJih0LkM9ITEsdS5DPSEwLHJ1KHRoaXMsdSksdD11LlIpLHQuTCYmdC5MLkN8fHQuUiYmdC5SLkMpe3QuUiYmdC5SLkN8fCh0LkwuQz0hMSx0LkM9ITAsZXUodGhpcyx0KSx0PXUuUiksdC5DPXUuQyx1LkM9dC5SLkM9ITEscnUodGhpcyx1KSxuPXRoaXMuXzticmVha319ZWxzZSBpZih0PXUuTCx0LkMmJih0LkM9ITEsdS5DPSEwLGV1KHRoaXMsdSksdD11LkwpLHQuTCYmdC5MLkN8fHQuUiYmdC5SLkMpe3QuTCYmdC5MLkN8fCh0LlIuQz0hMSx0LkM9ITAscnUodGhpcyx0KSx0PXUuTCksdC5DPXUuQyx1LkM9dC5MLkM9ITEsZXUodGhpcyx1KSxuPXRoaXMuXzticmVha310LkM9ITAsbj11LHU9dS5VfXdoaWxlKCFuLkMpO24mJihuLkM9ITEpfX19LEJvLmdlb20udm9yb25vaT1mdW5jdGlvbihuKXtmdW5jdGlvbiB0KG4pe3ZhciB0PW5ldyBBcnJheShuLmxlbmd0aCksZT1hWzBdWzBdLHU9YVswXVsxXSxpPWFbMV1bMF0sbz1hWzFdWzFdO3JldHVybiBpdShyKG4pLGEpLmNlbGxzLmZvckVhY2goZnVuY3Rpb24ocixhKXt2YXIgYz1yLmVkZ2VzLHM9ci5zaXRlLGw9dFthXT1jLmxlbmd0aD9jLm1hcChmdW5jdGlvbihuKXt2YXIgdD1uLnN0YXJ0KCk7cmV0dXJuW3QueCx0LnldfSk6cy54Pj1lJiZzLng8PWkmJnMueT49dSYmcy55PD1vP1tbZSxvXSxbaSxvXSxbaSx1XSxbZSx1XV06W107bC5wb2ludD1uW2FdfSksdH1mdW5jdGlvbiByKG4pe3JldHVybiBuLm1hcChmdW5jdGlvbihuLHQpe3JldHVybnt4Ok1hdGgucm91bmQoaShuLHQpL0NhKSpDYSx5Ok1hdGgucm91bmQobyhuLHQpL0NhKSpDYSxpOnR9fSl9dmFyIGU9QWUsdT1DZSxpPWUsbz11LGE9UWM7cmV0dXJuIG4/dChuKToodC5saW5rcz1mdW5jdGlvbihuKXtyZXR1cm4gaXUocihuKSkuZWRnZXMuZmlsdGVyKGZ1bmN0aW9uKG4pe3JldHVybiBuLmwmJm4ucn0pLm1hcChmdW5jdGlvbih0KXtyZXR1cm57c291cmNlOm5bdC5sLmldLHRhcmdldDpuW3Quci5pXX19KX0sdC50cmlhbmdsZXM9ZnVuY3Rpb24obil7dmFyIHQ9W107cmV0dXJuIGl1KHIobikpLmNlbGxzLmZvckVhY2goZnVuY3Rpb24ocixlKXtmb3IodmFyIHUsaSxvPXIuc2l0ZSxhPXIuZWRnZXMuc29ydChZZSksYz0tMSxzPWEubGVuZ3RoLGw9YVtzLTFdLmVkZ2UsZj1sLmw9PT1vP2wucjpsLmw7KytjPHM7KXU9bCxpPWYsbD1hW2NdLmVkZ2UsZj1sLmw9PT1vP2wucjpsLmwsZTxpLmkmJmU8Zi5pJiZhdShvLGksZik8MCYmdC5wdXNoKFtuW2VdLG5baS5pXSxuW2YuaV1dKX0pLHR9LHQueD1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oaT1FdChlPW4pLHQpOmV9LHQueT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obz1FdCh1PW4pLHQpOnV9LHQuY2xpcEV4dGVudD1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oYT1udWxsPT1uP1FjOm4sdCk6YT09PVFjP251bGw6YX0sdC5zaXplPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoP3QuY2xpcEV4dGVudChuJiZbWzAsMF0sbl0pOmE9PT1RYz9udWxsOmEmJmFbMV19LHQpfTt2YXIgUWM9W1stMWU2LC0xZTZdLFsxZTYsMWU2XV07Qm8uZ2VvbS5kZWxhdW5heT1mdW5jdGlvbihuKXtyZXR1cm4gQm8uZ2VvbS52b3Jvbm9pKCkudHJpYW5nbGVzKG4pfSxCby5nZW9tLnF1YWR0cmVlPWZ1bmN0aW9uKG4sdCxyLGUsdSl7ZnVuY3Rpb24gaShuKXtmdW5jdGlvbiBpKG4sdCxyLGUsdSxpLG8sYSl7aWYoIWlzTmFOKHIpJiYhaXNOYU4oZSkpaWYobi5sZWFmKXt2YXIgYz1uLngsbD1uLnk7aWYobnVsbCE9YylpZihjYShjLXIpK2NhKGwtZSk8LjAxKXMobix0LHIsZSx1LGksbyxhKTtlbHNle3ZhciBmPW4ucG9pbnQ7bi54PW4ueT1uLnBvaW50PW51bGwscyhuLGYsYyxsLHUsaSxvLGEpLHMobix0LHIsZSx1LGksbyxhKX1lbHNlIG4ueD1yLG4ueT1lLG4ucG9pbnQ9dH1lbHNlIHMobix0LHIsZSx1LGksbyxhKX1mdW5jdGlvbiBzKG4sdCxyLGUsdSxvLGEsYyl7dmFyIHM9LjUqKHUrYSksbD0uNSoobytjKSxmPXI+PXMsaD1lPj1sLGc9KGg8PDEpK2Y7bi5sZWFmPSExLG49bi5ub2Rlc1tnXXx8KG4ubm9kZXNbZ109bHUoKSksZj91PXM6YT1zLGg/bz1sOmM9bCxpKG4sdCxyLGUsdSxvLGEsYyl9dmFyIGwsZixoLGcscCx2LGQsbSx5LHg9RXQoYSksTT1FdChjKTtpZihudWxsIT10KXY9dCxkPXIsbT1lLHk9dTtlbHNlIGlmKG09eT0tKHY9ZD0xLzApLGY9W10saD1bXSxwPW4ubGVuZ3RoLG8pZm9yKGc9MDtwPmc7KytnKWw9bltnXSxsLng8diYmKHY9bC54KSxsLnk8ZCYmKGQ9bC55KSxsLng+bSYmKG09bC54KSxsLnk+eSYmKHk9bC55KSxmLnB1c2gobC54KSxoLnB1c2gobC55KTtlbHNlIGZvcihnPTA7cD5nOysrZyl7dmFyIF89K3gobD1uW2ddLGcpLGI9K00obCxnKTt2Pl8mJih2PV8pLGQ+YiYmKGQ9YiksXz5tJiYobT1fKSxiPnkmJih5PWIpLGYucHVzaChfKSxoLnB1c2goYil9dmFyIHc9bS12LFM9eS1kO3c+Uz95PWQrdzptPXYrUzt2YXIgaz1sdSgpO2lmKGsuYWRkPWZ1bmN0aW9uKG4pe2koayxuLCt4KG4sKytnKSwrTShuLGcpLHYsZCxtLHkpfSxrLnZpc2l0PWZ1bmN0aW9uKG4pe2Z1KG4sayx2LGQsbSx5KX0sZz0tMSxudWxsPT10KXtmb3IoOysrZzxwOylpKGssbltnXSxmW2ddLGhbZ10sdixkLG0seSk7LS1nfWVsc2Ugbi5mb3JFYWNoKGsuYWRkKTtyZXR1cm4gZj1oPW49bD1udWxsLGt9dmFyIG8sYT1BZSxjPUNlO3JldHVybihvPWFyZ3VtZW50cy5sZW5ndGgpPyhhPWN1LGM9c3UsMz09PW8mJih1PXIsZT10LHI9dD0wKSxpKG4pKTooaS54PWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhhPW4saSk6YX0saS55PWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhjPW4saSk6Y30saS5leHRlbnQ9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KG51bGw9PW4/dD1yPWU9dT1udWxsOih0PStuWzBdWzBdLHI9K25bMF1bMV0sZT0rblsxXVswXSx1PStuWzFdWzFdKSxpKTpudWxsPT10P251bGw6W1t0LHJdLFtlLHVdXX0saS5zaXplPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhudWxsPT1uP3Q9cj1lPXU9bnVsbDoodD1yPTAsZT0rblswXSx1PStuWzFdKSxpKTpudWxsPT10P251bGw6W2UtdCx1LXJdfSxpKX0sQm8uaW50ZXJwb2xhdGVSZ2I9aHUsQm8uaW50ZXJwb2xhdGVPYmplY3Q9Z3UsQm8uaW50ZXJwb2xhdGVOdW1iZXI9cHUsQm8uaW50ZXJwb2xhdGVTdHJpbmc9dnU7dmFyIG5zPS9bLStdPyg/OlxkK1wuP1xkKnxcLj9cZCspKD86W2VFXVstK10/XGQrKT8vZyx0cz1uZXcgUmVnRXhwKG5zLnNvdXJjZSwiZyIpO0JvLmludGVycG9sYXRlPWR1LEJvLmludGVycG9sYXRvcnM9W2Z1bmN0aW9uKG4sdCl7dmFyIHI9dHlwZW9mIHQ7cmV0dXJuKCJzdHJpbmciPT09cj8kYS5oYXModCl8fC9eKCN8cmdiXCh8aHNsXCgpLy50ZXN0KHQpP2h1OnZ1OnQgaW5zdGFuY2VvZiBydD9odTpBcnJheS5pc0FycmF5KHQpP211OiJvYmplY3QiPT09ciYmaXNOYU4odCk/Z3U6cHUpKG4sdCl9XSxCby5pbnRlcnBvbGF0ZUFycmF5PW11O3ZhciBycz1mdW5jdGlvbigpe3JldHVybiBBdH0sZXM9Qm8ubWFwKHtsaW5lYXI6cnMscG9seTpTdSxxdWFkOmZ1bmN0aW9uKCl7cmV0dXJuIF91fSxjdWJpYzpmdW5jdGlvbigpe3JldHVybiBidX0sc2luOmZ1bmN0aW9uKCl7cmV0dXJuIGt1fSxleHA6ZnVuY3Rpb24oKXtyZXR1cm4gRXV9LGNpcmNsZTpmdW5jdGlvbigpe3JldHVybiBBdX0sZWxhc3RpYzpDdSxiYWNrOk51LGJvdW5jZTpmdW5jdGlvbigpe3JldHVybiB6dX19KSx1cz1Cby5tYXAoeyJpbiI6QXQsb3V0Onh1LCJpbi1vdXQiOk11LCJvdXQtaW4iOmZ1bmN0aW9uKG4pe3JldHVybiBNdSh4dShuKSl9fSk7Qm8uZWFzZT1mdW5jdGlvbihuKXt2YXIgdD1uLmluZGV4T2YoIi0iKSxyPXQ+PTA/bi5zdWJzdHJpbmcoMCx0KTpuLGU9dD49MD9uLnN1YnN0cmluZyh0KzEpOiJpbiI7cmV0dXJuIHI9ZXMuZ2V0KHIpfHxycyxlPXVzLmdldChlKXx8QXQseXUoZShyLmFwcGx5KG51bGwsSm8uY2FsbChhcmd1bWVudHMsMSkpKSl9LEJvLmludGVycG9sYXRlSGNsPUx1LEJvLmludGVycG9sYXRlSHNsPVR1LEJvLmludGVycG9sYXRlTGFiPXF1LEJvLmludGVycG9sYXRlUm91bmQ9UnUsQm8udHJhbnNmb3JtPWZ1bmN0aW9uKG4pe3ZhciB0PUdvLmNyZWF0ZUVsZW1lbnROUyhCby5ucy5wcmVmaXguc3ZnLCJnIik7cmV0dXJuKEJvLnRyYW5zZm9ybT1mdW5jdGlvbihuKXtpZihudWxsIT1uKXt0LnNldEF0dHJpYnV0ZSgidHJhbnNmb3JtIixuKTt2YXIgcj10LnRyYW5zZm9ybS5iYXNlVmFsLmNvbnNvbGlkYXRlKCl9cmV0dXJuIG5ldyBEdShyP3IubWF0cml4OmlzKX0pKG4pfSxEdS5wcm90b3R5cGUudG9TdHJpbmc9ZnVuY3Rpb24oKXtyZXR1cm4idHJhbnNsYXRlKCIrdGhpcy50cmFuc2xhdGUrIilyb3RhdGUoIit0aGlzLnJvdGF0ZSsiKXNrZXdYKCIrdGhpcy5za2V3KyIpc2NhbGUoIit0aGlzLnNjYWxlKyIpIn07dmFyIGlzPXthOjEsYjowLGM6MCxkOjEsZTowLGY6MH07Qm8uaW50ZXJwb2xhdGVUcmFuc2Zvcm09SHUsQm8ubGF5b3V0PXt9LEJvLmxheW91dC5idW5kbGU9ZnVuY3Rpb24oKXtyZXR1cm4gZnVuY3Rpb24obil7Zm9yKHZhciB0PVtdLHI9LTEsZT1uLmxlbmd0aDsrK3I8ZTspdC5wdXNoKEl1KG5bcl0pKTtyZXR1cm4gdH19LEJvLmxheW91dC5jaG9yZD1mdW5jdGlvbigpe2Z1bmN0aW9uIG4oKXt2YXIgbixzLGYsaCxnLHA9e30sdj1bXSxkPUJvLnJhbmdlKGkpLG09W107Zm9yKHI9W10sZT1bXSxuPTAsaD0tMTsrK2g8aTspe2ZvcihzPTAsZz0tMTsrK2c8aTspcys9dVtoXVtnXTt2LnB1c2gocyksbS5wdXNoKEJvLnJhbmdlKGkpKSxuKz1zfWZvcihvJiZkLnNvcnQoZnVuY3Rpb24obix0KXtyZXR1cm4gbyh2W25dLHZbdF0pfSksYSYmbS5mb3JFYWNoKGZ1bmN0aW9uKG4sdCl7bi5zb3J0KGZ1bmN0aW9uKG4scil7cmV0dXJuIGEodVt0XVtuXSx1W3RdW3JdKX0pfSksbj0oRWEtbCppKS9uLHM9MCxoPS0xOysraDxpOyl7Zm9yKGY9cyxnPS0xOysrZzxpOyl7dmFyIHk9ZFtoXSx4PW1beV1bZ10sTT11W3ldW3hdLF89cyxiPXMrPU0qbjtwW3krIi0iK3hdPXtpbmRleDp5LHN1YmluZGV4Ongsc3RhcnRBbmdsZTpfLGVuZEFuZ2xlOmIsdmFsdWU6TX19ZVt5XT17aW5kZXg6eSxzdGFydEFuZ2xlOmYsZW5kQW5nbGU6cyx2YWx1ZToocy1mKS9ufSxzKz1sfWZvcihoPS0xOysraDxpOylmb3IoZz1oLTE7KytnPGk7KXt2YXIgdz1wW2grIi0iK2ddLFM9cFtnKyItIitoXTsody52YWx1ZXx8Uy52YWx1ZSkmJnIucHVzaCh3LnZhbHVlPFMudmFsdWU/e3NvdXJjZTpTLHRhcmdldDp3fTp7c291cmNlOncsdGFyZ2V0OlN9KX1jJiZ0KCl9ZnVuY3Rpb24gdCgpe3Iuc29ydChmdW5jdGlvbihuLHQpe3JldHVybiBjKChuLnNvdXJjZS52YWx1ZStuLnRhcmdldC52YWx1ZSkvMiwodC5zb3VyY2UudmFsdWUrdC50YXJnZXQudmFsdWUpLzIpfSl9dmFyIHIsZSx1LGksbyxhLGMscz17fSxsPTA7cmV0dXJuIHMubWF0cml4PWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhpPSh1PW4pJiZ1Lmxlbmd0aCxyPWU9bnVsbCxzKTp1fSxzLnBhZGRpbmc9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGw9bixyPWU9bnVsbCxzKTpsfSxzLnNvcnRHcm91cHM9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KG89bixyPWU9bnVsbCxzKTpvfSxzLnNvcnRTdWJncm91cHM9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGE9bixyPW51bGwscyk6YX0scy5zb3J0Q2hvcmRzPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhjPW4sciYmdCgpLHMpOmN9LHMuY2hvcmRzPWZ1bmN0aW9uKCl7cmV0dXJuIHJ8fG4oKSxyfSxzLmdyb3Vwcz1mdW5jdGlvbigpe3JldHVybiBlfHxuKCksZX0sc30sQm8ubGF5b3V0LmZvcmNlPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbihuKXtyZXR1cm4gZnVuY3Rpb24odCxyLGUsdSl7aWYodC5wb2ludCE9PW4pe3ZhciBpPXQuY3gtbi54LG89dC5jeS1uLnksYT11LXIsYz1pKmkrbypvO2lmKGM+YSphL2Qpe2lmKHA+Yyl7dmFyIHM9dC5jaGFyZ2UvYztuLnB4LT1pKnMsbi5weS09bypzfXJldHVybiEwfWlmKHQucG9pbnQmJmMmJnA+Yyl7dmFyIHM9dC5wb2ludENoYXJnZS9jO24ucHgtPWkqcyxuLnB5LT1vKnN9fXJldHVybiF0LmNoYXJnZX19ZnVuY3Rpb24gdChuKXtuLnB4PUJvLmV2ZW50Lngsbi5weT1Cby5ldmVudC55LGEucmVzdW1lKCl9dmFyIHIsZSx1LGksbyxhPXt9LGM9Qm8uZGlzcGF0Y2goInN0YXJ0IiwidGljayIsImVuZCIpLHM9WzEsMV0sbD0uOSxmPW9zLGg9YXMsZz0tMzAscD1jcyx2PS4xLGQ9LjY0LG09W10seT1bXTtyZXR1cm4gYS50aWNrPWZ1bmN0aW9uKCl7aWYoKGUqPS45OSk8LjAwNSlyZXR1cm4gYy5lbmQoe3R5cGU6ImVuZCIsYWxwaGE6ZT0wfSksITA7dmFyIHQscixhLGYsaCxwLGQseCxNLF89bS5sZW5ndGgsYj15Lmxlbmd0aDtmb3Iocj0wO2I+cjsrK3IpYT15W3JdLGY9YS5zb3VyY2UsaD1hLnRhcmdldCx4PWgueC1mLngsTT1oLnktZi55LChwPXgqeCtNKk0pJiYocD1lKmlbcl0qKChwPU1hdGguc3FydChwKSktdVtyXSkvcCx4Kj1wLE0qPXAsaC54LT14KihkPWYud2VpZ2h0LyhoLndlaWdodCtmLndlaWdodCkpLGgueS09TSpkLGYueCs9eCooZD0xLWQpLGYueSs9TSpkKTtpZigoZD1lKnYpJiYoeD1zWzBdLzIsTT1zWzFdLzIscj0tMSxkKSlmb3IoOysrcjxfOylhPW1bcl0sYS54Kz0oeC1hLngpKmQsYS55Kz0oTS1hLnkpKmQ7aWYoZylmb3IoSnUodD1Cby5nZW9tLnF1YWR0cmVlKG0pLGUsbykscj0tMTsrK3I8XzspKGE9bVtyXSkuZml4ZWR8fHQudmlzaXQobihhKSk7Zm9yKHI9LTE7KytyPF87KWE9bVtyXSxhLmZpeGVkPyhhLng9YS5weCxhLnk9YS5weSk6KGEueC09KGEucHgtKGEucHg9YS54KSkqbCxhLnktPShhLnB5LShhLnB5PWEueSkpKmwpO2MudGljayh7dHlwZToidGljayIsYWxwaGE6ZX0pfSxhLm5vZGVzPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhtPW4sYSk6bX0sYS5saW5rcz1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oeT1uLGEpOnl9LGEuc2l6ZT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8ocz1uLGEpOnN9LGEubGlua0Rpc3RhbmNlPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhmPSJmdW5jdGlvbiI9PXR5cGVvZiBuP246K24sYSk6Zn0sYS5kaXN0YW5jZT1hLmxpbmtEaXN0YW5jZSxhLmxpbmtTdHJlbmd0aD1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oaD0iZnVuY3Rpb24iPT10eXBlb2Ygbj9uOituLGEpOmh9LGEuZnJpY3Rpb249ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGw9K24sYSk6bH0sYS5jaGFyZ2U9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGc9ImZ1bmN0aW9uIj09dHlwZW9mIG4/bjorbixhKTpnfSxhLmNoYXJnZURpc3RhbmNlPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhwPW4qbixhKTpNYXRoLnNxcnQocCl9LGEuZ3Jhdml0eT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8odj0rbixhKTp2fSxhLnRoZXRhPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhkPW4qbixhKTpNYXRoLnNxcnQoZCl9LGEuYWxwaGE9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KG49K24sZT9lPW4+MD9uOjA6bj4wJiYoYy5zdGFydCh7dHlwZToic3RhcnQiLGFscGhhOmU9bn0pLEJvLnRpbWVyKGEudGljaykpLGEpOmV9LGEuc3RhcnQ9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKG4sZSl7aWYoIXIpe2ZvcihyPW5ldyBBcnJheShjKSxhPTA7Yz5hOysrYSlyW2FdPVtdO2ZvcihhPTA7cz5hOysrYSl7dmFyIHU9eVthXTtyW3Uuc291cmNlLmluZGV4XS5wdXNoKHUudGFyZ2V0KSxyW3UudGFyZ2V0LmluZGV4XS5wdXNoKHUuc291cmNlKX19Zm9yKHZhciBpLG89clt0XSxhPS0xLHM9by5sZW5ndGg7KythPHM7KWlmKCFpc05hTihpPW9bYV1bbl0pKXJldHVybiBpO3JldHVybiBNYXRoLnJhbmRvbSgpKmV9dmFyIHQscixlLGM9bS5sZW5ndGgsbD15Lmxlbmd0aCxwPXNbMF0sdj1zWzFdO2Zvcih0PTA7Yz50OysrdCkoZT1tW3RdKS5pbmRleD10LGUud2VpZ2h0PTA7Zm9yKHQ9MDtsPnQ7Kyt0KWU9eVt0XSwibnVtYmVyIj09dHlwZW9mIGUuc291cmNlJiYoZS5zb3VyY2U9bVtlLnNvdXJjZV0pLCJudW1iZXIiPT10eXBlb2YgZS50YXJnZXQmJihlLnRhcmdldD1tW2UudGFyZ2V0XSksKytlLnNvdXJjZS53ZWlnaHQsKytlLnRhcmdldC53ZWlnaHQ7Zm9yKHQ9MDtjPnQ7Kyt0KWU9bVt0XSxpc05hTihlLngpJiYoZS54PW4oIngiLHApKSxpc05hTihlLnkpJiYoZS55PW4oInkiLHYpKSxpc05hTihlLnB4KSYmKGUucHg9ZS54KSxpc05hTihlLnB5KSYmKGUucHk9ZS55KTtpZih1PVtdLCJmdW5jdGlvbiI9PXR5cGVvZiBmKWZvcih0PTA7bD50OysrdCl1W3RdPStmLmNhbGwodGhpcyx5W3RdLHQpO2Vsc2UgZm9yKHQ9MDtsPnQ7Kyt0KXVbdF09ZjtpZihpPVtdLCJmdW5jdGlvbiI9PXR5cGVvZiBoKWZvcih0PTA7bD50OysrdClpW3RdPStoLmNhbGwodGhpcyx5W3RdLHQpO2Vsc2UgZm9yKHQ9MDtsPnQ7Kyt0KWlbdF09aDtpZihvPVtdLCJmdW5jdGlvbiI9PXR5cGVvZiBnKWZvcih0PTA7Yz50OysrdClvW3RdPStnLmNhbGwodGhpcyxtW3RdLHQpO2Vsc2UgZm9yKHQ9MDtjPnQ7Kyt0KW9bdF09ZztyZXR1cm4gYS5yZXN1bWUoKX0sYS5yZXN1bWU9ZnVuY3Rpb24oKXtyZXR1cm4gYS5hbHBoYSguMSl9LGEuc3RvcD1mdW5jdGlvbigpe3JldHVybiBhLmFscGhhKDApfSxhLmRyYWc9ZnVuY3Rpb24oKXtyZXR1cm4gcnx8KHI9Qm8uYmVoYXZpb3IuZHJhZygpLm9yaWdpbihBdCkub24oImRyYWdzdGFydC5mb3JjZSIsVnUpLm9uKCJkcmFnLmZvcmNlIix0KS5vbigiZHJhZ2VuZC5mb3JjZSIsJHUpKSxhcmd1bWVudHMubGVuZ3RoPyh0aGlzLm9uKCJtb3VzZW92ZXIuZm9yY2UiLFh1KS5vbigibW91c2VvdXQuZm9yY2UiLEJ1KS5jYWxsKHIpLHZvaWQgMCk6cn0sQm8ucmViaW5kKGEsYywib24iKX07dmFyIG9zPTIwLGFzPTEsY3M9MS8wO0JvLmxheW91dC5oaWVyYXJjaHk9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKHUpe3ZhciBpLG89W3VdLGE9W107Zm9yKHUuZGVwdGg9MDtudWxsIT0oaT1vLnBvcCgpKTspaWYoYS5wdXNoKGkpLChzPXIuY2FsbChuLGksaS5kZXB0aCkpJiYoYz1zLmxlbmd0aCkpe2Zvcih2YXIgYyxzLGw7LS1jPj0wOylvLnB1c2gobD1zW2NdKSxsLnBhcmVudD1pLGwuZGVwdGg9aS5kZXB0aCsxO2UmJihpLnZhbHVlPTApLGkuY2hpbGRyZW49c31lbHNlIGUmJihpLnZhbHVlPStlLmNhbGwobixpLGkuZGVwdGgpfHwwKSxkZWxldGUgaS5jaGlsZHJlbjtyZXR1cm4gS3UodSxmdW5jdGlvbihuKXt2YXIgcix1O3QmJihyPW4uY2hpbGRyZW4pJiZyLnNvcnQodCksZSYmKHU9bi5wYXJlbnQpJiYodS52YWx1ZSs9bi52YWx1ZSl9KSxhfXZhciB0PXRpLHI9UXUsZT1uaTtyZXR1cm4gbi5zb3J0PWZ1bmN0aW9uKHIpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh0PXIsbik6dH0sbi5jaGlsZHJlbj1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8ocj10LG4pOnJ9LG4udmFsdWU9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGU9dCxuKTplfSxuLnJldmFsdWU9ZnVuY3Rpb24odCl7cmV0dXJuIGUmJihHdSh0LGZ1bmN0aW9uKG4pe24uY2hpbGRyZW4mJihuLnZhbHVlPTApfSksS3UodCxmdW5jdGlvbih0KXt2YXIgcjt0LmNoaWxkcmVufHwodC52YWx1ZT0rZS5jYWxsKG4sdCx0LmRlcHRoKXx8MCksKHI9dC5wYXJlbnQpJiYoci52YWx1ZSs9dC52YWx1ZSl9KSksdH0sbn0sQm8ubGF5b3V0LnBhcnRpdGlvbj1mdW5jdGlvbigpe2Z1bmN0aW9uIG4odCxyLGUsdSl7dmFyIGk9dC5jaGlsZHJlbjtpZih0Lng9cix0Lnk9dC5kZXB0aCp1LHQuZHg9ZSx0LmR5PXUsaSYmKG89aS5sZW5ndGgpKXt2YXIgbyxhLGMscz0tMTtmb3IoZT10LnZhbHVlP2UvdC52YWx1ZTowOysrczxvOyluKGE9aVtzXSxyLGM9YS52YWx1ZSplLHUpLHIrPWN9fWZ1bmN0aW9uIHQobil7dmFyIHI9bi5jaGlsZHJlbixlPTA7aWYociYmKHU9ci5sZW5ndGgpKWZvcih2YXIgdSxpPS0xOysraTx1OyllPU1hdGgubWF4KGUsdChyW2ldKSk7cmV0dXJuIDErZX1mdW5jdGlvbiByKHIsaSl7dmFyIG89ZS5jYWxsKHRoaXMscixpKTtyZXR1cm4gbihvWzBdLDAsdVswXSx1WzFdL3Qob1swXSkpLG99dmFyIGU9Qm8ubGF5b3V0LmhpZXJhcmNoeSgpLHU9WzEsMV07cmV0dXJuIHIuc2l6ZT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8odT1uLHIpOnV9LFd1KHIsZSl9LEJvLmxheW91dC5waWU9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKGkpe3ZhciBvPWkubWFwKGZ1bmN0aW9uKHIsZSl7cmV0dXJuK3QuY2FsbChuLHIsZSl9KSxhPSsoImZ1bmN0aW9uIj09dHlwZW9mIGU/ZS5hcHBseSh0aGlzLGFyZ3VtZW50cyk6ZSksYz0oKCJmdW5jdGlvbiI9PXR5cGVvZiB1P3UuYXBwbHkodGhpcyxhcmd1bWVudHMpOnUpLWEpL0JvLnN1bShvKSxzPUJvLnJhbmdlKGkubGVuZ3RoKTtudWxsIT1yJiZzLnNvcnQocj09PXNzP2Z1bmN0aW9uKG4sdCl7cmV0dXJuIG9bdF0tb1tuXX06ZnVuY3Rpb24obix0KXtyZXR1cm4gcihpW25dLGlbdF0pfSk7dmFyIGw9W107cmV0dXJuIHMuZm9yRWFjaChmdW5jdGlvbihuKXt2YXIgdDtsW25dPXtkYXRhOmlbbl0sdmFsdWU6dD1vW25dLHN0YXJ0QW5nbGU6YSxlbmRBbmdsZTphKz10KmN9fSksbH12YXIgdD1OdW1iZXIscj1zcyxlPTAsdT1FYTtyZXR1cm4gbi52YWx1ZT1mdW5jdGlvbihyKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8odD1yLG4pOnR9LG4uc29ydD1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8ocj10LG4pOnJ9LG4uc3RhcnRBbmdsZT1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oZT10LG4pOmV9LG4uZW5kQW5nbGU9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHU9dCxuKTp1fSxufTt2YXIgc3M9e307Qm8ubGF5b3V0LnN0YWNrPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbihhLGMpe3ZhciBzPWEubWFwKGZ1bmN0aW9uKHIsZSl7cmV0dXJuIHQuY2FsbChuLHIsZSl9KSxsPXMubWFwKGZ1bmN0aW9uKHQpe3JldHVybiB0Lm1hcChmdW5jdGlvbih0LHIpe3JldHVybltpLmNhbGwobix0LHIpLG8uY2FsbChuLHQscildfSl9KSxmPXIuY2FsbChuLGwsYyk7cz1Cby5wZXJtdXRlKHMsZiksbD1Cby5wZXJtdXRlKGwsZik7dmFyIGgsZyxwLHY9ZS5jYWxsKG4sbCxjKSxkPXMubGVuZ3RoLG09c1swXS5sZW5ndGg7Zm9yKGc9MDttPmc7KytnKWZvcih1LmNhbGwobixzWzBdW2ddLHA9dltnXSxsWzBdW2ddWzFdKSxoPTE7ZD5oOysraCl1LmNhbGwobixzW2hdW2ddLHArPWxbaC0xXVtnXVsxXSxsW2hdW2ddWzFdKTtyZXR1cm4gYX12YXIgdD1BdCxyPW9pLGU9YWksdT1paSxpPWVpLG89dWk7cmV0dXJuIG4udmFsdWVzPWZ1bmN0aW9uKHIpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh0PXIsbik6dH0sbi5vcmRlcj1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8ocj0iZnVuY3Rpb24iPT10eXBlb2YgdD90OmxzLmdldCh0KXx8b2ksbik6cn0sbi5vZmZzZXQ9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGU9ImZ1bmN0aW9uIj09dHlwZW9mIHQ/dDpmcy5nZXQodCl8fGFpLG4pOmV9LG4ueD1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oaT10LG4pOml9LG4ueT1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obz10LG4pOm99LG4ub3V0PWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh1PXQsbik6dX0sbn07dmFyIGxzPUJvLm1hcCh7Imluc2lkZS1vdXQiOmZ1bmN0aW9uKG4pe3ZhciB0LHIsZT1uLmxlbmd0aCx1PW4ubWFwKGNpKSxpPW4ubWFwKHNpKSxvPUJvLnJhbmdlKGUpLnNvcnQoZnVuY3Rpb24obix0KXtyZXR1cm4gdVtuXS11W3RdfSksYT0wLGM9MCxzPVtdLGw9W107Zm9yKHQ9MDtlPnQ7Kyt0KXI9b1t0XSxjPmE/KGErPWlbcl0scy5wdXNoKHIpKTooYys9aVtyXSxsLnB1c2gocikpO3JldHVybiBsLnJldmVyc2UoKS5jb25jYXQocyl9LHJldmVyc2U6ZnVuY3Rpb24obil7cmV0dXJuIEJvLnJhbmdlKG4ubGVuZ3RoKS5yZXZlcnNlKCl9LCJkZWZhdWx0IjpvaX0pLGZzPUJvLm1hcCh7c2lsaG91ZXR0ZTpmdW5jdGlvbihuKXt2YXIgdCxyLGUsdT1uLmxlbmd0aCxpPW5bMF0ubGVuZ3RoLG89W10sYT0wLGM9W107Zm9yKHI9MDtpPnI7KytyKXtmb3IodD0wLGU9MDt1PnQ7dCsrKWUrPW5bdF1bcl1bMV07ZT5hJiYoYT1lKSxvLnB1c2goZSl9Zm9yKHI9MDtpPnI7KytyKWNbcl09KGEtb1tyXSkvMjtyZXR1cm4gY30sd2lnZ2xlOmZ1bmN0aW9uKG4pe3ZhciB0LHIsZSx1LGksbyxhLGMscyxsPW4ubGVuZ3RoLGY9blswXSxoPWYubGVuZ3RoLGc9W107Zm9yKGdbMF09Yz1zPTAscj0xO2g+cjsrK3Ipe2Zvcih0PTAsdT0wO2w+dDsrK3QpdSs9blt0XVtyXVsxXTtmb3IodD0wLGk9MCxhPWZbcl1bMF0tZltyLTFdWzBdO2w+dDsrK3Qpe2ZvcihlPTAsbz0oblt0XVtyXVsxXS1uW3RdW3ItMV1bMV0pLygyKmEpO3Q+ZTsrK2Upbys9KG5bZV1bcl1bMV0tbltlXVtyLTFdWzFdKS9hO2krPW8qblt0XVtyXVsxXX1nW3JdPWMtPXU/aS91KmE6MCxzPmMmJihzPWMpfWZvcihyPTA7aD5yOysrcilnW3JdLT1zO3JldHVybiBnfSxleHBhbmQ6ZnVuY3Rpb24obil7dmFyIHQscixlLHU9bi5sZW5ndGgsaT1uWzBdLmxlbmd0aCxvPTEvdSxhPVtdO2ZvcihyPTA7aT5yOysrcil7Zm9yKHQ9MCxlPTA7dT50O3QrKyllKz1uW3RdW3JdWzFdO2lmKGUpZm9yKHQ9MDt1PnQ7dCsrKW5bdF1bcl1bMV0vPWU7ZWxzZSBmb3IodD0wO3U+dDt0Kyspblt0XVtyXVsxXT1vfWZvcihyPTA7aT5yOysrcilhW3JdPTA7cmV0dXJuIGF9LHplcm86YWl9KTtCby5sYXlvdXQuaGlzdG9ncmFtPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbihuLGkpe2Zvcih2YXIgbyxhLGM9W10scz1uLm1hcChyLHRoaXMpLGw9ZS5jYWxsKHRoaXMscyxpKSxmPXUuY2FsbCh0aGlzLGwscyxpKSxpPS0xLGg9cy5sZW5ndGgsZz1mLmxlbmd0aC0xLHA9dD8xOjEvaDsrK2k8Zzspbz1jW2ldPVtdLG8uZHg9ZltpKzFdLShvLng9ZltpXSksby55PTA7aWYoZz4wKWZvcihpPS0xOysraTxoOylhPXNbaV0sYT49bFswXSYmYTw9bFsxXSYmKG89Y1tCby5iaXNlY3QoZixhLDEsZyktMV0sby55Kz1wLG8ucHVzaChuW2ldKSk7cmV0dXJuIGN9dmFyIHQ9ITAscj1OdW1iZXIsZT1naSx1PWZpO3JldHVybiBuLnZhbHVlPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhyPXQsbik6cn0sbi5yYW5nZT1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oZT1FdCh0KSxuKTplfSxuLmJpbnM9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHU9Im51bWJlciI9PXR5cGVvZiB0P2Z1bmN0aW9uKG4pe3JldHVybiBoaShuLHQpfTpFdCh0KSxuKTp1fSxuLmZyZXF1ZW5jeT1mdW5jdGlvbihyKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8odD0hIXIsbik6dH0sbn0sQm8ubGF5b3V0LnBhY2s9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKG4saSl7dmFyIG89ci5jYWxsKHRoaXMsbixpKSxhPW9bMF0sYz11WzBdLHM9dVsxXSxsPW51bGw9PXQ/TWF0aC5zcXJ0OiJmdW5jdGlvbiI9PXR5cGVvZiB0P3Q6ZnVuY3Rpb24oKXtyZXR1cm4gdH07aWYoYS54PWEueT0wLEt1KGEsZnVuY3Rpb24obil7bi5yPStsKG4udmFsdWUpfSksS3UoYSx5aSksZSl7dmFyIGY9ZSoodD8xOk1hdGgubWF4KDIqYS5yL2MsMiphLnIvcykpLzI7S3UoYSxmdW5jdGlvbihuKXtuLnIrPWZ9KSxLdShhLHlpKSxLdShhLGZ1bmN0aW9uKG4pe24uci09Zn0pfXJldHVybiBfaShhLGMvMixzLzIsdD8xOjEvTWF0aC5tYXgoMiphLnIvYywyKmEuci9zKSksb312YXIgdCxyPUJvLmxheW91dC5oaWVyYXJjaHkoKS5zb3J0KHBpKSxlPTAsdT1bMSwxXTtyZXR1cm4gbi5zaXplPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh1PXQsbik6dX0sbi5yYWRpdXM9ZnVuY3Rpb24ocil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHQ9bnVsbD09cnx8ImZ1bmN0aW9uIj09dHlwZW9mIHI/cjorcixuKTp0fSxuLnBhZGRpbmc9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGU9K3Qsbik6ZX0sV3UobixyKX0sQm8ubGF5b3V0LnRyZWU9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKG4sdSl7dmFyIGw9by5jYWxsKHRoaXMsbix1KSxmPWxbMF0saD10KGYpO2lmKEt1KGgsciksaC5wYXJlbnQubT0taC56LEd1KGgsZSkscylHdShmLGkpO2Vsc2V7dmFyIGc9ZixwPWYsdj1mO0d1KGYsZnVuY3Rpb24obil7bi54PGcueCYmKGc9biksbi54PnAueCYmKHA9biksbi5kZXB0aD52LmRlcHRoJiYodj1uKX0pO3ZhciBkPWEoZyxwKS8yLWcueCxtPWNbMF0vKHAueCthKHAsZykvMitkKSx5PWNbMV0vKHYuZGVwdGh8fDEpO0d1KGYsZnVuY3Rpb24obil7bi54PShuLngrZCkqbSxuLnk9bi5kZXB0aCp5fSl9cmV0dXJuIGx9ZnVuY3Rpb24gdChuKXtmb3IodmFyIHQscj17QTpudWxsLGNoaWxkcmVuOltuXX0sZT1bcl07bnVsbCE9KHQ9ZS5wb3AoKSk7KWZvcih2YXIgdSxpPXQuY2hpbGRyZW4sbz0wLGE9aS5sZW5ndGg7YT5vOysrbyllLnB1c2goKGlbb109dT17XzppW29dLHBhcmVudDp0LGNoaWxkcmVuOih1PWlbb10uY2hpbGRyZW4pJiZ1LnNsaWNlKCl8fFtdLEE6bnVsbCxhOm51bGwsejowLG06MCxjOjAsczowLHQ6bnVsbCxpOm99KS5hPXUpO3JldHVybiByLmNoaWxkcmVuWzBdfWZ1bmN0aW9uIHIobil7dmFyIHQ9bi5jaGlsZHJlbixyPW4ucGFyZW50LmNoaWxkcmVuLGU9bi5pP3Jbbi5pLTFdOm51bGw7aWYodC5sZW5ndGgpe0FpKG4pO3ZhciBpPSh0WzBdLnordFt0Lmxlbmd0aC0xXS56KS8yO2U/KG4uej1lLnorYShuLl8sZS5fKSxuLm09bi56LWkpOm4uej1pfWVsc2UgZSYmKG4uej1lLnorYShuLl8sZS5fKSk7bi5wYXJlbnQuQT11KG4sZSxuLnBhcmVudC5BfHxyWzBdKX1mdW5jdGlvbiBlKG4pe24uXy54PW4ueituLnBhcmVudC5tLG4ubSs9bi5wYXJlbnQubX1mdW5jdGlvbiB1KG4sdCxyKXtpZih0KXtmb3IodmFyIGUsdT1uLGk9bixvPXQsYz11LnBhcmVudC5jaGlsZHJlblswXSxzPXUubSxsPWkubSxmPW8ubSxoPWMubTtvPWtpKG8pLHU9U2kodSksbyYmdTspYz1TaShjKSxpPWtpKGkpLGkuYT1uLGU9by56K2YtdS56LXMrYShvLl8sdS5fKSxlPjAmJihFaShDaShvLG4sciksbixlKSxzKz1lLGwrPWUpLGYrPW8ubSxzKz11Lm0saCs9Yy5tLGwrPWkubTtvJiYha2koaSkmJihpLnQ9byxpLm0rPWYtbCksdSYmIVNpKGMpJiYoYy50PXUsYy5tKz1zLWgscj1uKX1yZXR1cm4gcn1mdW5jdGlvbiBpKG4pe24ueCo9Y1swXSxuLnk9bi5kZXB0aCpjWzFdfXZhciBvPUJvLmxheW91dC5oaWVyYXJjaHkoKS5zb3J0KG51bGwpLnZhbHVlKG51bGwpLGE9d2ksYz1bMSwxXSxzPW51bGw7cmV0dXJuIG4uc2VwYXJhdGlvbj1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oYT10LG4pOmF9LG4uc2l6ZT1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8ocz1udWxsPT0oYz10KT9pOm51bGwsbik6cz9udWxsOmN9LG4ubm9kZVNpemU9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHM9bnVsbD09KGM9dCk/bnVsbDppLG4pOnM/YzpudWxsfSxXdShuLG8pfSxCby5sYXlvdXQuY2x1c3Rlcj1mdW5jdGlvbigpe2Z1bmN0aW9uIG4obixpKXt2YXIgbyxhPXQuY2FsbCh0aGlzLG4saSksYz1hWzBdLHM9MDtLdShjLGZ1bmN0aW9uKG4pe3ZhciB0PW4uY2hpbGRyZW47dCYmdC5sZW5ndGg/KG4ueD16aSh0KSxuLnk9TmkodCkpOihuLng9bz9zKz1yKG4sbyk6MCxuLnk9MCxvPW4pfSk7dmFyIGw9TGkoYyksZj1UaShjKSxoPWwueC1yKGwsZikvMixnPWYueCtyKGYsbCkvMjtyZXR1cm4gS3UoYyx1P2Z1bmN0aW9uKG4pe24ueD0obi54LWMueCkqZVswXSxuLnk9KGMueS1uLnkpKmVbMV19OmZ1bmN0aW9uKG4pe24ueD0obi54LWgpLyhnLWgpKmVbMF0sbi55PSgxLShjLnk/bi55L2MueToxKSkqZVsxXX0pLGF9dmFyIHQ9Qm8ubGF5b3V0LmhpZXJhcmNoeSgpLnNvcnQobnVsbCkudmFsdWUobnVsbCkscj13aSxlPVsxLDFdLHU9ITE7cmV0dXJuIG4uc2VwYXJhdGlvbj1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8ocj10LG4pOnJ9LG4uc2l6ZT1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8odT1udWxsPT0oZT10KSxuKTp1P251bGw6ZX0sbi5ub2RlU2l6ZT1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8odT1udWxsIT0oZT10KSxuKTp1P2U6bnVsbH0sV3Uobix0KX0sQm8ubGF5b3V0LnRyZWVtYXA9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKG4sdCl7Zm9yKHZhciByLGUsdT0tMSxpPW4ubGVuZ3RoOysrdTxpOyllPShyPW5bdV0pLnZhbHVlKigwPnQ/MDp0KSxyLmFyZWE9aXNOYU4oZSl8fDA+PWU/MDplfWZ1bmN0aW9uIHQocil7dmFyIGk9ci5jaGlsZHJlbjtpZihpJiZpLmxlbmd0aCl7dmFyIG8sYSxjLHM9ZihyKSxsPVtdLGg9aS5zbGljZSgpLHA9MS8wLHY9InNsaWNlIj09PWc/cy5keDoiZGljZSI9PT1nP3MuZHk6InNsaWNlLWRpY2UiPT09Zz8xJnIuZGVwdGg/cy5keTpzLmR4Ok1hdGgubWluKHMuZHgscy5keSk7Zm9yKG4oaCxzLmR4KnMuZHkvci52YWx1ZSksbC5hcmVhPTA7KGM9aC5sZW5ndGgpPjA7KWwucHVzaChvPWhbYy0xXSksbC5hcmVhKz1vLmFyZWEsInNxdWFyaWZ5IiE9PWd8fChhPWUobCx2KSk8PXA/KGgucG9wKCkscD1hKToobC5hcmVhLT1sLnBvcCgpLmFyZWEsdShsLHYscywhMSksdj1NYXRoLm1pbihzLmR4LHMuZHkpLGwubGVuZ3RoPWwuYXJlYT0wLHA9MS8wKTtsLmxlbmd0aCYmKHUobCx2LHMsITApLGwubGVuZ3RoPWwuYXJlYT0wKSxpLmZvckVhY2godCl9fWZ1bmN0aW9uIHIodCl7dmFyIGU9dC5jaGlsZHJlbjtpZihlJiZlLmxlbmd0aCl7dmFyIGksbz1mKHQpLGE9ZS5zbGljZSgpLGM9W107Zm9yKG4oYSxvLmR4Km8uZHkvdC52YWx1ZSksYy5hcmVhPTA7aT1hLnBvcCgpOyljLnB1c2goaSksYy5hcmVhKz1pLmFyZWEsbnVsbCE9aS56JiYodShjLGkuej9vLmR4Om8uZHksbywhYS5sZW5ndGgpLGMubGVuZ3RoPWMuYXJlYT0wKTtlLmZvckVhY2gocil9fWZ1bmN0aW9uIGUobix0KXtmb3IodmFyIHIsZT1uLmFyZWEsdT0wLGk9MS8wLG89LTEsYT1uLmxlbmd0aDsrK288YTspKHI9bltvXS5hcmVhKSYmKGk+ciYmKGk9cikscj51JiYodT1yKSk7cmV0dXJuIGUqPWUsdCo9dCxlP01hdGgubWF4KHQqdSpwL2UsZS8odCppKnApKToxLzB9ZnVuY3Rpb24gdShuLHQscixlKXt2YXIgdSxpPS0xLG89bi5sZW5ndGgsYT1yLngscz1yLnksbD10P2Mobi5hcmVhL3QpOjA7aWYodD09ci5keCl7Zm9yKChlfHxsPnIuZHkpJiYobD1yLmR5KTsrK2k8bzspdT1uW2ldLHUueD1hLHUueT1zLHUuZHk9bCxhKz11LmR4PU1hdGgubWluKHIueCtyLmR4LWEsbD9jKHUuYXJlYS9sKTowKTt1Lno9ITAsdS5keCs9ci54K3IuZHgtYSxyLnkrPWwsci5keS09bH1lbHNle2ZvcigoZXx8bD5yLmR4KSYmKGw9ci5keCk7KytpPG87KXU9bltpXSx1Lng9YSx1Lnk9cyx1LmR4PWwscys9dS5keT1NYXRoLm1pbihyLnkrci5keS1zLGw/Yyh1LmFyZWEvbCk6MCk7dS56PSExLHUuZHkrPXIueStyLmR5LXMsci54Kz1sLHIuZHgtPWx9fWZ1bmN0aW9uIGkoZSl7dmFyIHU9b3x8YShlKSxpPXVbMF07cmV0dXJuIGkueD0wLGkueT0wLGkuZHg9c1swXSxpLmR5PXNbMV0sbyYmYS5yZXZhbHVlKGkpLG4oW2ldLGkuZHgqaS5keS9pLnZhbHVlKSwobz9yOnQpKGkpLGgmJihvPXUpLHV9dmFyIG8sYT1Cby5sYXlvdXQuaGllcmFyY2h5KCksYz1NYXRoLnJvdW5kLHM9WzEsMV0sbD1udWxsLGY9cWksaD0hMSxnPSJzcXVhcmlmeSIscD0uNSooMStNYXRoLnNxcnQoNSkpO3JldHVybiBpLnNpemU9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHM9bixpKTpzfSxpLnBhZGRpbmc9ZnVuY3Rpb24obil7ZnVuY3Rpb24gdCh0KXt2YXIgcj1uLmNhbGwoaSx0LHQuZGVwdGgpO3JldHVybiBudWxsPT1yP3FpKHQpOlJpKHQsIm51bWJlciI9PXR5cGVvZiByP1tyLHIscixyXTpyKX1mdW5jdGlvbiByKHQpe3JldHVybiBSaSh0LG4pfWlmKCFhcmd1bWVudHMubGVuZ3RoKXJldHVybiBsO3ZhciBlO3JldHVybiBmPW51bGw9PShsPW4pP3FpOiJmdW5jdGlvbiI9PShlPXR5cGVvZiBuKT90OiJudW1iZXIiPT09ZT8obj1bbixuLG4sbl0scik6cixpfSxpLnJvdW5kPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhjPW4/TWF0aC5yb3VuZDpOdW1iZXIsaSk6YyE9TnVtYmVyfSxpLnN0aWNreT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oaD1uLG89bnVsbCxpKTpofSxpLnJhdGlvPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhwPW4saSk6cH0saS5tb2RlPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhnPW4rIiIsaSk6Z30sV3UoaSxhKX0sQm8ucmFuZG9tPXtub3JtYWw6ZnVuY3Rpb24obix0KXt2YXIgcj1hcmd1bWVudHMubGVuZ3RoO3JldHVybiAyPnImJih0PTEpLDE+ciYmKG49MCksZnVuY3Rpb24oKXt2YXIgcixlLHU7ZG8gcj0yKk1hdGgucmFuZG9tKCktMSxlPTIqTWF0aC5yYW5kb20oKS0xLHU9cipyK2UqZTt3aGlsZSghdXx8dT4xKTtyZXR1cm4gbit0KnIqTWF0aC5zcXJ0KC0yKk1hdGgubG9nKHUpL3UpfX0sbG9nTm9ybWFsOmZ1bmN0aW9uKCl7dmFyIG49Qm8ucmFuZG9tLm5vcm1hbC5hcHBseShCbyxhcmd1bWVudHMpO3JldHVybiBmdW5jdGlvbigpe3JldHVybiBNYXRoLmV4cChuKCkpfX0sYmF0ZXM6ZnVuY3Rpb24obil7dmFyIHQ9Qm8ucmFuZG9tLmlyd2luSGFsbChuKTtyZXR1cm4gZnVuY3Rpb24oKXtyZXR1cm4gdCgpL259fSxpcndpbkhhbGw6ZnVuY3Rpb24obil7cmV0dXJuIGZ1bmN0aW9uKCl7Zm9yKHZhciB0PTAscj0wO24+cjtyKyspdCs9TWF0aC5yYW5kb20oKTtyZXR1cm4gdH19fSxCby5zY2FsZT17fTt2YXIgaHM9e2Zsb29yOkF0LGNlaWw6QXR9O0JvLnNjYWxlLmxpbmVhcj1mdW5jdGlvbigpe3JldHVybiBPaShbMCwxXSxbMCwxXSxkdSwhMSl9O3ZhciBncz17czoxLGc6MSxwOjEscjoxLGU6MX07Qm8uc2NhbGUubG9nPWZ1bmN0aW9uKCl7cmV0dXJuIEppKEJvLnNjYWxlLmxpbmVhcigpLmRvbWFpbihbMCwxXSksMTAsITAsWzEsMTBdKX07dmFyIHBzPUJvLmZvcm1hdCgiLjBlIiksdnM9e2Zsb29yOmZ1bmN0aW9uKG4pe3JldHVybi1NYXRoLmNlaWwoLW4pfSxjZWlsOmZ1bmN0aW9uKG4pe3JldHVybi1NYXRoLmZsb29yKC1uKX19O0JvLnNjYWxlLnBvdz1mdW5jdGlvbigpe3JldHVybiBXaShCby5zY2FsZS5saW5lYXIoKSwxLFswLDFdKX0sQm8uc2NhbGUuc3FydD1mdW5jdGlvbigpe3JldHVybiBCby5zY2FsZS5wb3coKS5leHBvbmVudCguNSl9LEJvLnNjYWxlLm9yZGluYWw9ZnVuY3Rpb24oKXtyZXR1cm4gS2koW10se3Q6InJhbmdlIixhOltbXV19KX0sQm8uc2NhbGUuY2F0ZWdvcnkxMD1mdW5jdGlvbigpe3JldHVybiBCby5zY2FsZS5vcmRpbmFsKCkucmFuZ2UoZHMpfSxCby5zY2FsZS5jYXRlZ29yeTIwPWZ1bmN0aW9uKCl7cmV0dXJuIEJvLnNjYWxlLm9yZGluYWwoKS5yYW5nZShtcyl9LEJvLnNjYWxlLmNhdGVnb3J5MjBiPWZ1bmN0aW9uKCl7cmV0dXJuIEJvLnNjYWxlLm9yZGluYWwoKS5yYW5nZSh5cyl9LEJvLnNjYWxlLmNhdGVnb3J5MjBjPWZ1bmN0aW9uKCl7cmV0dXJuIEJvLnNjYWxlLm9yZGluYWwoKS5yYW5nZSh4cyl9O3ZhciBkcz1bMjA2MjI2MCwxNjc0NDIwNiwyOTI0NTg4LDE0MDM0NzI4LDk3MjU4ODUsOTE5NzEzMSwxNDkwNzMzMCw4MzU1NzExLDEyMzY5MTg2LDE1NTYxNzVdLm1hcChtdCksbXM9WzIwNjIyNjAsMTE0NTQ0NDAsMTY3NDQyMDYsMTY3NTk2NzIsMjkyNDU4OCwxMDAxODY5OCwxNDAzNDcyOCwxNjc1MDc0Miw5NzI1ODg1LDEyOTU1ODYxLDkxOTcxMzEsMTI4ODUxNDAsMTQ5MDczMzAsMTYyMzQxOTQsODM1NTcxMSwxMzA5MjgwNywxMjM2OTE4NiwxNDQwODU4OSwxNTU2MTc1LDEwNDEwNzI1XS5tYXAobXQpLHlzPVszNzUwNzc3LDUzOTU2MTksNzA0MDcxOSwxMDI2NDI4Niw2NTE5MDk3LDkyMTY1OTQsMTE5MTUxMTUsMTM1NTY2MzYsOTIwMjk5MywxMjQyNjgwOSwxNTE4NjUxNCwxNTE5MDkzMiw4NjY2MTY5LDExMzU2NDkwLDE0MDQ5NjQzLDE1MTc3MzcyLDgwNzc2ODMsMTA4MzQzMjQsMTM1Mjg1MDksMTQ1ODk2NTRdLm1hcChtdCkseHM9WzMyNDQ3MzMsNzA1NzExMCwxMDQwNjYyNSwxMzAzMjQzMSwxNTA5NTA1MywxNjYxNjc2NCwxNjYyNTI1OSwxNjYzNDAxOCwzMjUzMDc2LDc2NTI0NzAsMTA2MDcwMDMsMTMxMDE1MDQsNzY5NTI4MSwxMDM5NDMxMiwxMjM2OTM3MiwxNDM0Mjg5MSw2NTEzNTA3LDk4Njg5NTAsMTI0MzQ4NzcsMTQyNzcwODFdLm1hcChtdCk7Qm8uc2NhbGUucXVhbnRpbGU9ZnVuY3Rpb24oKXtyZXR1cm4gUWkoW10sW10pfSxCby5zY2FsZS5xdWFudGl6ZT1mdW5jdGlvbigpe3JldHVybiBubygwLDEsWzAsMV0pfSxCby5zY2FsZS50aHJlc2hvbGQ9ZnVuY3Rpb24oKXtyZXR1cm4gdG8oWy41XSxbMCwxXSl9LEJvLnNjYWxlLmlkZW50aXR5PWZ1bmN0aW9uKCl7cmV0dXJuIHJvKFswLDFdKX0sQm8uc3ZnPXt9LEJvLnN2Zy5hcmM9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKCl7dmFyIG49dC5hcHBseSh0aGlzLGFyZ3VtZW50cyksaT1yLmFwcGx5KHRoaXMsYXJndW1lbnRzKSxvPWUuYXBwbHkodGhpcyxhcmd1bWVudHMpK01zLGE9dS5hcHBseSh0aGlzLGFyZ3VtZW50cykrTXMsYz0obz5hJiYoYz1vLG89YSxhPWMpLGEtbykscz1rYT5jPyIwIjoiMSIsbD1NYXRoLmNvcyhvKSxmPU1hdGguc2luKG8pLGg9TWF0aC5jb3MoYSksZz1NYXRoLnNpbihhKTsKcmV0dXJuIGM+PV9zP24/Ik0wLCIraSsiQSIraSsiLCIraSsiIDAgMSwxIDAsIistaSsiQSIraSsiLCIraSsiIDAgMSwxIDAsIitpKyJNMCwiK24rIkEiK24rIiwiK24rIiAwIDEsMCAwLCIrLW4rIkEiK24rIiwiK24rIiAwIDEsMCAwLCIrbisiWiI6Ik0wLCIraSsiQSIraSsiLCIraSsiIDAgMSwxIDAsIistaSsiQSIraSsiLCIraSsiIDAgMSwxIDAsIitpKyJaIjpuPyJNIitpKmwrIiwiK2kqZisiQSIraSsiLCIraSsiIDAgIitzKyIsMSAiK2kqaCsiLCIraSpnKyJMIituKmgrIiwiK24qZysiQSIrbisiLCIrbisiIDAgIitzKyIsMCAiK24qbCsiLCIrbipmKyJaIjoiTSIraSpsKyIsIitpKmYrIkEiK2krIiwiK2krIiAwICIrcysiLDEgIitpKmgrIiwiK2kqZysiTDAsMCIrIloifXZhciB0PWVvLHI9dW8sZT1pbyx1PW9vO3JldHVybiBuLmlubmVyUmFkaXVzPWZ1bmN0aW9uKHIpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh0PUV0KHIpLG4pOnR9LG4ub3V0ZXJSYWRpdXM9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHI9RXQodCksbik6cn0sbi5zdGFydEFuZ2xlPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhlPUV0KHQpLG4pOmV9LG4uZW5kQW5nbGU9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHU9RXQodCksbik6dX0sbi5jZW50cm9pZD1mdW5jdGlvbigpe3ZhciBuPSh0LmFwcGx5KHRoaXMsYXJndW1lbnRzKStyLmFwcGx5KHRoaXMsYXJndW1lbnRzKSkvMixpPShlLmFwcGx5KHRoaXMsYXJndW1lbnRzKSt1LmFwcGx5KHRoaXMsYXJndW1lbnRzKSkvMitNcztyZXR1cm5bTWF0aC5jb3MoaSkqbixNYXRoLnNpbihpKSpuXX0sbn07dmFyIE1zPS1BYSxfcz1FYS1DYTtCby5zdmcubGluZT1mdW5jdGlvbigpe3JldHVybiBhbyhBdCl9O3ZhciBicz1Cby5tYXAoe2xpbmVhcjpjbywibGluZWFyLWNsb3NlZCI6c28sc3RlcDpsbywic3RlcC1iZWZvcmUiOmZvLCJzdGVwLWFmdGVyIjpobyxiYXNpczp4bywiYmFzaXMtb3BlbiI6TW8sImJhc2lzLWNsb3NlZCI6X28sYnVuZGxlOmJvLGNhcmRpbmFsOnZvLCJjYXJkaW5hbC1vcGVuIjpnbywiY2FyZGluYWwtY2xvc2VkIjpwbyxtb25vdG9uZTpDb30pO2JzLmZvckVhY2goZnVuY3Rpb24obix0KXt0LmtleT1uLHQuY2xvc2VkPS8tY2xvc2VkJC8udGVzdChuKX0pO3ZhciB3cz1bMCwyLzMsMS8zLDBdLFNzPVswLDEvMywyLzMsMF0sa3M9WzAsMS82LDIvMywxLzZdO0JvLnN2Zy5saW5lLnJhZGlhbD1mdW5jdGlvbigpe3ZhciBuPWFvKE5vKTtyZXR1cm4gbi5yYWRpdXM9bi54LGRlbGV0ZSBuLngsbi5hbmdsZT1uLnksZGVsZXRlIG4ueSxufSxmby5yZXZlcnNlPWhvLGhvLnJldmVyc2U9Zm8sQm8uc3ZnLmFyZWE9ZnVuY3Rpb24oKXtyZXR1cm4gem8oQXQpfSxCby5zdmcuYXJlYS5yYWRpYWw9ZnVuY3Rpb24oKXt2YXIgbj16byhObyk7cmV0dXJuIG4ucmFkaXVzPW4ueCxkZWxldGUgbi54LG4uaW5uZXJSYWRpdXM9bi54MCxkZWxldGUgbi54MCxuLm91dGVyUmFkaXVzPW4ueDEsZGVsZXRlIG4ueDEsbi5hbmdsZT1uLnksZGVsZXRlIG4ueSxuLnN0YXJ0QW5nbGU9bi55MCxkZWxldGUgbi55MCxuLmVuZEFuZ2xlPW4ueTEsZGVsZXRlIG4ueTEsbn0sQm8uc3ZnLmNob3JkPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbihuLGEpe3ZhciBjPXQodGhpcyxpLG4sYSkscz10KHRoaXMsbyxuLGEpO3JldHVybiJNIitjLnAwK2UoYy5yLGMucDEsYy5hMS1jLmEwKSsocihjLHMpP3UoYy5yLGMucDEsYy5yLGMucDApOnUoYy5yLGMucDEscy5yLHMucDApK2Uocy5yLHMucDEscy5hMS1zLmEwKSt1KHMucixzLnAxLGMucixjLnAwKSkrIloifWZ1bmN0aW9uIHQobix0LHIsZSl7dmFyIHU9dC5jYWxsKG4scixlKSxpPWEuY2FsbChuLHUsZSksbz1jLmNhbGwobix1LGUpK01zLGw9cy5jYWxsKG4sdSxlKStNcztyZXR1cm57cjppLGEwOm8sYTE6bCxwMDpbaSpNYXRoLmNvcyhvKSxpKk1hdGguc2luKG8pXSxwMTpbaSpNYXRoLmNvcyhsKSxpKk1hdGguc2luKGwpXX19ZnVuY3Rpb24gcihuLHQpe3JldHVybiBuLmEwPT10LmEwJiZuLmExPT10LmExfWZ1bmN0aW9uIGUobix0LHIpe3JldHVybiJBIituKyIsIituKyIgMCAiKyArKHI+a2EpKyIsMSAiK3R9ZnVuY3Rpb24gdShuLHQscixlKXtyZXR1cm4iUSAwLDAgIitlfXZhciBpPW1lLG89eWUsYT1MbyxjPWlvLHM9b287cmV0dXJuIG4ucmFkaXVzPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhhPUV0KHQpLG4pOmF9LG4uc291cmNlPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhpPUV0KHQpLG4pOml9LG4udGFyZ2V0PWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhvPUV0KHQpLG4pOm99LG4uc3RhcnRBbmdsZT1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oYz1FdCh0KSxuKTpjfSxuLmVuZEFuZ2xlPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhzPUV0KHQpLG4pOnN9LG59LEJvLnN2Zy5kaWFnb25hbD1mdW5jdGlvbigpe2Z1bmN0aW9uIG4obix1KXt2YXIgaT10LmNhbGwodGhpcyxuLHUpLG89ci5jYWxsKHRoaXMsbix1KSxhPShpLnkrby55KS8yLGM9W2kse3g6aS54LHk6YX0se3g6by54LHk6YX0sb107cmV0dXJuIGM9Yy5tYXAoZSksIk0iK2NbMF0rIkMiK2NbMV0rIiAiK2NbMl0rIiAiK2NbM119dmFyIHQ9bWUscj15ZSxlPVRvO3JldHVybiBuLnNvdXJjZT1mdW5jdGlvbihyKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8odD1FdChyKSxuKTp0fSxuLnRhcmdldD1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8ocj1FdCh0KSxuKTpyfSxuLnByb2plY3Rpb249ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGU9dCxuKTplfSxufSxCby5zdmcuZGlhZ29uYWwucmFkaWFsPWZ1bmN0aW9uKCl7dmFyIG49Qm8uc3ZnLmRpYWdvbmFsKCksdD1UbyxyPW4ucHJvamVjdGlvbjtyZXR1cm4gbi5wcm9qZWN0aW9uPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoP3IocW8odD1uKSk6dH0sbn0sQm8uc3ZnLnN5bWJvbD1mdW5jdGlvbigpe2Z1bmN0aW9uIG4obixlKXtyZXR1cm4oRXMuZ2V0KHQuY2FsbCh0aGlzLG4sZSkpfHxQbykoci5jYWxsKHRoaXMsbixlKSl9dmFyIHQ9RG8scj1SbztyZXR1cm4gbi50eXBlPWZ1bmN0aW9uKHIpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh0PUV0KHIpLG4pOnR9LG4uc2l6ZT1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8ocj1FdCh0KSxuKTpyfSxufTt2YXIgRXM9Qm8ubWFwKHtjaXJjbGU6UG8sY3Jvc3M6ZnVuY3Rpb24obil7dmFyIHQ9TWF0aC5zcXJ0KG4vNSkvMjtyZXR1cm4iTSIrLTMqdCsiLCIrLXQrIkgiKy10KyJWIistMyp0KyJIIit0KyJWIistdCsiSCIrMyp0KyJWIit0KyJIIit0KyJWIiszKnQrIkgiKy10KyJWIit0KyJIIistMyp0KyJaIn0sZGlhbW9uZDpmdW5jdGlvbihuKXt2YXIgdD1NYXRoLnNxcnQobi8oMip6cykpLHI9dCp6cztyZXR1cm4iTTAsIistdCsiTCIrcisiLDAiKyIgMCwiK3QrIiAiKy1yKyIsMCIrIloifSxzcXVhcmU6ZnVuY3Rpb24obil7dmFyIHQ9TWF0aC5zcXJ0KG4pLzI7cmV0dXJuIk0iKy10KyIsIistdCsiTCIrdCsiLCIrLXQrIiAiK3QrIiwiK3QrIiAiKy10KyIsIit0KyJaIn0sInRyaWFuZ2xlLWRvd24iOmZ1bmN0aW9uKG4pe3ZhciB0PU1hdGguc3FydChuL05zKSxyPXQqTnMvMjtyZXR1cm4iTTAsIityKyJMIit0KyIsIistcisiICIrLXQrIiwiKy1yKyJaIn0sInRyaWFuZ2xlLXVwIjpmdW5jdGlvbihuKXt2YXIgdD1NYXRoLnNxcnQobi9Ocykscj10Kk5zLzI7cmV0dXJuIk0wLCIrLXIrIkwiK3QrIiwiK3IrIiAiKy10KyIsIityKyJaIn19KTtCby5zdmcuc3ltYm9sVHlwZXM9RXMua2V5cygpO3ZhciBBcyxDcyxOcz1NYXRoLnNxcnQoMyksenM9TWF0aC50YW4oMzAqemEpLExzPVtdLFRzPTA7THMuY2FsbD15YS5jYWxsLExzLmVtcHR5PXlhLmVtcHR5LExzLm5vZGU9eWEubm9kZSxMcy5zaXplPXlhLnNpemUsQm8udHJhbnNpdGlvbj1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD9Bcz9uLnRyYW5zaXRpb24oKTpuOl9hLnRyYW5zaXRpb24oKX0sQm8udHJhbnNpdGlvbi5wcm90b3R5cGU9THMsTHMuc2VsZWN0PWZ1bmN0aW9uKG4pe3ZhciB0LHIsZSx1PXRoaXMuaWQsaT1bXTtuPWIobik7Zm9yKHZhciBvPS0xLGE9dGhpcy5sZW5ndGg7KytvPGE7KXtpLnB1c2godD1bXSk7Zm9yKHZhciBjPXRoaXNbb10scz0tMSxsPWMubGVuZ3RoOysrczxsOykoZT1jW3NdKSYmKHI9bi5jYWxsKGUsZS5fX2RhdGFfXyxzLG8pKT8oIl9fZGF0YV9fImluIGUmJihyLl9fZGF0YV9fPWUuX19kYXRhX18pLEZvKHIscyx1LGUuX190cmFuc2l0aW9uX19bdV0pLHQucHVzaChyKSk6dC5wdXNoKG51bGwpfXJldHVybiBVbyhpLHUpfSxMcy5zZWxlY3RBbGw9ZnVuY3Rpb24obil7dmFyIHQscixlLHUsaSxvPXRoaXMuaWQsYT1bXTtuPXcobik7Zm9yKHZhciBjPS0xLHM9dGhpcy5sZW5ndGg7KytjPHM7KWZvcih2YXIgbD10aGlzW2NdLGY9LTEsaD1sLmxlbmd0aDsrK2Y8aDspaWYoZT1sW2ZdKXtpPWUuX190cmFuc2l0aW9uX19bb10scj1uLmNhbGwoZSxlLl9fZGF0YV9fLGYsYyksYS5wdXNoKHQ9W10pO2Zvcih2YXIgZz0tMSxwPXIubGVuZ3RoOysrZzxwOykodT1yW2ddKSYmRm8odSxnLG8saSksdC5wdXNoKHUpfXJldHVybiBVbyhhLG8pfSxMcy5maWx0ZXI9ZnVuY3Rpb24obil7dmFyIHQscixlLHU9W107ImZ1bmN0aW9uIiE9dHlwZW9mIG4mJihuPVIobikpO2Zvcih2YXIgaT0wLG89dGhpcy5sZW5ndGg7bz5pO2krKyl7dS5wdXNoKHQ9W10pO2Zvcih2YXIgcj10aGlzW2ldLGE9MCxjPXIubGVuZ3RoO2M+YTthKyspKGU9clthXSkmJm4uY2FsbChlLGUuX19kYXRhX18sYSxpKSYmdC5wdXNoKGUpfXJldHVybiBVbyh1LHRoaXMuaWQpfSxMcy50d2Vlbj1mdW5jdGlvbihuLHQpe3ZhciByPXRoaXMuaWQ7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg8Mj90aGlzLm5vZGUoKS5fX3RyYW5zaXRpb25fX1tyXS50d2Vlbi5nZXQobik6UCh0aGlzLG51bGw9PXQ/ZnVuY3Rpb24odCl7dC5fX3RyYW5zaXRpb25fX1tyXS50d2Vlbi5yZW1vdmUobil9OmZ1bmN0aW9uKGUpe2UuX190cmFuc2l0aW9uX19bcl0udHdlZW4uc2V0KG4sdCl9KX0sTHMuYXR0cj1mdW5jdGlvbihuLHQpe2Z1bmN0aW9uIHIoKXt0aGlzLnJlbW92ZUF0dHJpYnV0ZShhKX1mdW5jdGlvbiBlKCl7dGhpcy5yZW1vdmVBdHRyaWJ1dGVOUyhhLnNwYWNlLGEubG9jYWwpfWZ1bmN0aW9uIHUobil7cmV0dXJuIG51bGw9PW4/cjoobis9IiIsZnVuY3Rpb24oKXt2YXIgdCxyPXRoaXMuZ2V0QXR0cmlidXRlKGEpO3JldHVybiByIT09biYmKHQ9byhyLG4pLGZ1bmN0aW9uKG4pe3RoaXMuc2V0QXR0cmlidXRlKGEsdChuKSl9KX0pfWZ1bmN0aW9uIGkobil7cmV0dXJuIG51bGw9PW4/ZToobis9IiIsZnVuY3Rpb24oKXt2YXIgdCxyPXRoaXMuZ2V0QXR0cmlidXRlTlMoYS5zcGFjZSxhLmxvY2FsKTtyZXR1cm4gciE9PW4mJih0PW8ocixuKSxmdW5jdGlvbihuKXt0aGlzLnNldEF0dHJpYnV0ZU5TKGEuc3BhY2UsYS5sb2NhbCx0KG4pKX0pfSl9aWYoYXJndW1lbnRzLmxlbmd0aDwyKXtmb3IodCBpbiBuKXRoaXMuYXR0cih0LG5bdF0pO3JldHVybiB0aGlzfXZhciBvPSJ0cmFuc2Zvcm0iPT1uP0h1OmR1LGE9Qm8ubnMucXVhbGlmeShuKTtyZXR1cm4gam8odGhpcywiYXR0ci4iK24sdCxhLmxvY2FsP2k6dSl9LExzLmF0dHJUd2Vlbj1mdW5jdGlvbihuLHQpe2Z1bmN0aW9uIHIobixyKXt2YXIgZT10LmNhbGwodGhpcyxuLHIsdGhpcy5nZXRBdHRyaWJ1dGUodSkpO3JldHVybiBlJiZmdW5jdGlvbihuKXt0aGlzLnNldEF0dHJpYnV0ZSh1LGUobikpfX1mdW5jdGlvbiBlKG4scil7dmFyIGU9dC5jYWxsKHRoaXMsbixyLHRoaXMuZ2V0QXR0cmlidXRlTlModS5zcGFjZSx1LmxvY2FsKSk7cmV0dXJuIGUmJmZ1bmN0aW9uKG4pe3RoaXMuc2V0QXR0cmlidXRlTlModS5zcGFjZSx1LmxvY2FsLGUobikpfX12YXIgdT1Cby5ucy5xdWFsaWZ5KG4pO3JldHVybiB0aGlzLnR3ZWVuKCJhdHRyLiIrbix1LmxvY2FsP2U6cil9LExzLnN0eWxlPWZ1bmN0aW9uKG4sdCxyKXtmdW5jdGlvbiBlKCl7dGhpcy5zdHlsZS5yZW1vdmVQcm9wZXJ0eShuKX1mdW5jdGlvbiB1KHQpe3JldHVybiBudWxsPT10P2U6KHQrPSIiLGZ1bmN0aW9uKCl7dmFyIGUsdT1Rby5nZXRDb21wdXRlZFN0eWxlKHRoaXMsbnVsbCkuZ2V0UHJvcGVydHlWYWx1ZShuKTtyZXR1cm4gdSE9PXQmJihlPWR1KHUsdCksZnVuY3Rpb24odCl7dGhpcy5zdHlsZS5zZXRQcm9wZXJ0eShuLGUodCkscil9KX0pfXZhciBpPWFyZ3VtZW50cy5sZW5ndGg7aWYoMz5pKXtpZigic3RyaW5nIiE9dHlwZW9mIG4pezI+aSYmKHQ9IiIpO2ZvcihyIGluIG4pdGhpcy5zdHlsZShyLG5bcl0sdCk7cmV0dXJuIHRoaXN9cj0iIn1yZXR1cm4gam8odGhpcywic3R5bGUuIituLHQsdSl9LExzLnN0eWxlVHdlZW49ZnVuY3Rpb24obix0LHIpe2Z1bmN0aW9uIGUoZSx1KXt2YXIgaT10LmNhbGwodGhpcyxlLHUsUW8uZ2V0Q29tcHV0ZWRTdHlsZSh0aGlzLG51bGwpLmdldFByb3BlcnR5VmFsdWUobikpO3JldHVybiBpJiZmdW5jdGlvbih0KXt0aGlzLnN0eWxlLnNldFByb3BlcnR5KG4saSh0KSxyKX19cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg8MyYmKHI9IiIpLHRoaXMudHdlZW4oInN0eWxlLiIrbixlKX0sTHMudGV4dD1mdW5jdGlvbihuKXtyZXR1cm4gam8odGhpcywidGV4dCIsbixIbyl9LExzLnJlbW92ZT1mdW5jdGlvbigpe3JldHVybiB0aGlzLmVhY2goImVuZC50cmFuc2l0aW9uIixmdW5jdGlvbigpe3ZhciBuO3RoaXMuX190cmFuc2l0aW9uX18uY291bnQ8MiYmKG49dGhpcy5wYXJlbnROb2RlKSYmbi5yZW1vdmVDaGlsZCh0aGlzKX0pfSxMcy5lYXNlPWZ1bmN0aW9uKG4pe3ZhciB0PXRoaXMuaWQ7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg8MT90aGlzLm5vZGUoKS5fX3RyYW5zaXRpb25fX1t0XS5lYXNlOigiZnVuY3Rpb24iIT10eXBlb2YgbiYmKG49Qm8uZWFzZS5hcHBseShCbyxhcmd1bWVudHMpKSxQKHRoaXMsZnVuY3Rpb24ocil7ci5fX3RyYW5zaXRpb25fX1t0XS5lYXNlPW59KSl9LExzLmRlbGF5PWZ1bmN0aW9uKG4pe3ZhciB0PXRoaXMuaWQ7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg8MT90aGlzLm5vZGUoKS5fX3RyYW5zaXRpb25fX1t0XS5kZWxheTpQKHRoaXMsImZ1bmN0aW9uIj09dHlwZW9mIG4/ZnVuY3Rpb24ocixlLHUpe3IuX190cmFuc2l0aW9uX19bdF0uZGVsYXk9K24uY2FsbChyLHIuX19kYXRhX18sZSx1KX06KG49K24sZnVuY3Rpb24ocil7ci5fX3RyYW5zaXRpb25fX1t0XS5kZWxheT1ufSkpfSxMcy5kdXJhdGlvbj1mdW5jdGlvbihuKXt2YXIgdD10aGlzLmlkO3JldHVybiBhcmd1bWVudHMubGVuZ3RoPDE/dGhpcy5ub2RlKCkuX190cmFuc2l0aW9uX19bdF0uZHVyYXRpb246UCh0aGlzLCJmdW5jdGlvbiI9PXR5cGVvZiBuP2Z1bmN0aW9uKHIsZSx1KXtyLl9fdHJhbnNpdGlvbl9fW3RdLmR1cmF0aW9uPU1hdGgubWF4KDEsbi5jYWxsKHIsci5fX2RhdGFfXyxlLHUpKX06KG49TWF0aC5tYXgoMSxuKSxmdW5jdGlvbihyKXtyLl9fdHJhbnNpdGlvbl9fW3RdLmR1cmF0aW9uPW59KSl9LExzLmVhY2g9ZnVuY3Rpb24obix0KXt2YXIgcj10aGlzLmlkO2lmKGFyZ3VtZW50cy5sZW5ndGg8Mil7dmFyIGU9Q3MsdT1BcztBcz1yLFAodGhpcyxmdW5jdGlvbih0LGUsdSl7Q3M9dC5fX3RyYW5zaXRpb25fX1tyXSxuLmNhbGwodCx0Ll9fZGF0YV9fLGUsdSl9KSxDcz1lLEFzPXV9ZWxzZSBQKHRoaXMsZnVuY3Rpb24oZSl7dmFyIHU9ZS5fX3RyYW5zaXRpb25fX1tyXTsodS5ldmVudHx8KHUuZXZlbnQ9Qm8uZGlzcGF0Y2goInN0YXJ0IiwiZW5kIikpKS5vbihuLHQpfSk7cmV0dXJuIHRoaXN9LExzLnRyYW5zaXRpb249ZnVuY3Rpb24oKXtmb3IodmFyIG4sdCxyLGUsdT10aGlzLmlkLGk9KytUcyxvPVtdLGE9MCxjPXRoaXMubGVuZ3RoO2M+YTthKyspe28ucHVzaChuPVtdKTtmb3IodmFyIHQ9dGhpc1thXSxzPTAsbD10Lmxlbmd0aDtsPnM7cysrKShyPXRbc10pJiYoZT1PYmplY3QuY3JlYXRlKHIuX190cmFuc2l0aW9uX19bdV0pLGUuZGVsYXkrPWUuZHVyYXRpb24sRm8ocixzLGksZSkpLG4ucHVzaChyKX1yZXR1cm4gVW8obyxpKX0sQm8uc3ZnLmF4aXM9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKG4pe24uZWFjaChmdW5jdGlvbigpe3ZhciBuLHM9Qm8uc2VsZWN0KHRoaXMpLGw9dGhpcy5fX2NoYXJ0X198fHIsZj10aGlzLl9fY2hhcnRfXz1yLmNvcHkoKSxoPW51bGw9PWM/Zi50aWNrcz9mLnRpY2tzLmFwcGx5KGYsYSk6Zi5kb21haW4oKTpjLGc9bnVsbD09dD9mLnRpY2tGb3JtYXQ/Zi50aWNrRm9ybWF0LmFwcGx5KGYsYSk6QXQ6dCxwPXMuc2VsZWN0QWxsKCIudGljayIpLmRhdGEoaCxmKSx2PXAuZW50ZXIoKS5pbnNlcnQoImciLCIuZG9tYWluIikuYXR0cigiY2xhc3MiLCJ0aWNrIikuc3R5bGUoIm9wYWNpdHkiLENhKSxkPUJvLnRyYW5zaXRpb24ocC5leGl0KCkpLnN0eWxlKCJvcGFjaXR5IixDYSkucmVtb3ZlKCksbT1Cby50cmFuc2l0aW9uKHAub3JkZXIoKSkuc3R5bGUoIm9wYWNpdHkiLDEpLHk9UGkoZikseD1zLnNlbGVjdEFsbCgiLmRvbWFpbiIpLmRhdGEoWzBdKSxNPSh4LmVudGVyKCkuYXBwZW5kKCJwYXRoIikuYXR0cigiY2xhc3MiLCJkb21haW4iKSxCby50cmFuc2l0aW9uKHgpKTt2LmFwcGVuZCgibGluZSIpLHYuYXBwZW5kKCJ0ZXh0Iik7dmFyIF89di5zZWxlY3QoImxpbmUiKSxiPW0uc2VsZWN0KCJsaW5lIiksdz1wLnNlbGVjdCgidGV4dCIpLnRleHQoZyksUz12LnNlbGVjdCgidGV4dCIpLGs9bS5zZWxlY3QoInRleHQiKTtzd2l0Y2goZSl7Y2FzZSJib3R0b20iOm49T28sXy5hdHRyKCJ5MiIsdSksUy5hdHRyKCJ5IixNYXRoLm1heCh1LDApK28pLGIuYXR0cigieDIiLDApLmF0dHIoInkyIix1KSxrLmF0dHIoIngiLDApLmF0dHIoInkiLE1hdGgubWF4KHUsMCkrbyksdy5hdHRyKCJkeSIsIi43MWVtIikuc3R5bGUoInRleHQtYW5jaG9yIiwibWlkZGxlIiksTS5hdHRyKCJkIiwiTSIreVswXSsiLCIraSsiVjBIIit5WzFdKyJWIitpKTticmVhaztjYXNlInRvcCI6bj1PbyxfLmF0dHIoInkyIiwtdSksUy5hdHRyKCJ5IiwtKE1hdGgubWF4KHUsMCkrbykpLGIuYXR0cigieDIiLDApLmF0dHIoInkyIiwtdSksay5hdHRyKCJ4IiwwKS5hdHRyKCJ5IiwtKE1hdGgubWF4KHUsMCkrbykpLHcuYXR0cigiZHkiLCIwZW0iKS5zdHlsZSgidGV4dC1hbmNob3IiLCJtaWRkbGUiKSxNLmF0dHIoImQiLCJNIit5WzBdKyIsIistaSsiVjBIIit5WzFdKyJWIistaSk7YnJlYWs7Y2FzZSJsZWZ0IjpuPUlvLF8uYXR0cigieDIiLC11KSxTLmF0dHIoIngiLC0oTWF0aC5tYXgodSwwKStvKSksYi5hdHRyKCJ4MiIsLXUpLmF0dHIoInkyIiwwKSxrLmF0dHIoIngiLC0oTWF0aC5tYXgodSwwKStvKSkuYXR0cigieSIsMCksdy5hdHRyKCJkeSIsIi4zMmVtIikuc3R5bGUoInRleHQtYW5jaG9yIiwiZW5kIiksTS5hdHRyKCJkIiwiTSIrLWkrIiwiK3lbMF0rIkgwViIreVsxXSsiSCIrLWkpO2JyZWFrO2Nhc2UicmlnaHQiOm49SW8sXy5hdHRyKCJ4MiIsdSksUy5hdHRyKCJ4IixNYXRoLm1heCh1LDApK28pLGIuYXR0cigieDIiLHUpLmF0dHIoInkyIiwwKSxrLmF0dHIoIngiLE1hdGgubWF4KHUsMCkrbykuYXR0cigieSIsMCksdy5hdHRyKCJkeSIsIi4zMmVtIikuc3R5bGUoInRleHQtYW5jaG9yIiwic3RhcnQiKSxNLmF0dHIoImQiLCJNIitpKyIsIit5WzBdKyJIMFYiK3lbMV0rIkgiK2kpfWlmKGYucmFuZ2VCYW5kKXt2YXIgRT1mLEE9RS5yYW5nZUJhbmQoKS8yO2w9Zj1mdW5jdGlvbihuKXtyZXR1cm4gRShuKStBfX1lbHNlIGwucmFuZ2VCYW5kP2w9ZjpkLmNhbGwobixmKTt2LmNhbGwobixsKSxtLmNhbGwobixmKX0pfXZhciB0LHI9Qm8uc2NhbGUubGluZWFyKCksZT1xcyx1PTYsaT02LG89MyxhPVsxMF0sYz1udWxsO3JldHVybiBuLnNjYWxlPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhyPXQsbik6cn0sbi5vcmllbnQ9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGU9dCBpbiBScz90KyIiOnFzLG4pOmV9LG4udGlja3M9ZnVuY3Rpb24oKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oYT1hcmd1bWVudHMsbik6YX0sbi50aWNrVmFsdWVzPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhjPXQsbik6Y30sbi50aWNrRm9ybWF0PWZ1bmN0aW9uKHIpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh0PXIsbik6dH0sbi50aWNrU2l6ZT1mdW5jdGlvbih0KXt2YXIgcj1hcmd1bWVudHMubGVuZ3RoO3JldHVybiByPyh1PSt0LGk9K2FyZ3VtZW50c1tyLTFdLG4pOnV9LG4uaW5uZXJUaWNrU2l6ZT1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8odT0rdCxuKTp1fSxuLm91dGVyVGlja1NpemU9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGk9K3Qsbik6aX0sbi50aWNrUGFkZGluZz1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obz0rdCxuKTpvfSxuLnRpY2tTdWJkaXZpZGU9ZnVuY3Rpb24oKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aCYmbn0sbn07dmFyIHFzPSJib3R0b20iLFJzPXt0b3A6MSxyaWdodDoxLGJvdHRvbToxLGxlZnQ6MX07Qm8uc3ZnLmJydXNoPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbihpKXtpLmVhY2goZnVuY3Rpb24oKXt2YXIgaT1Cby5zZWxlY3QodGhpcykuc3R5bGUoInBvaW50ZXItZXZlbnRzIiwiYWxsIikuc3R5bGUoIi13ZWJraXQtdGFwLWhpZ2hsaWdodC1jb2xvciIsInJnYmEoMCwwLDAsMCkiKS5vbigibW91c2Vkb3duLmJydXNoIix1KS5vbigidG91Y2hzdGFydC5icnVzaCIsdSksbz1pLnNlbGVjdEFsbCgiLmJhY2tncm91bmQiKS5kYXRhKFswXSk7by5lbnRlcigpLmFwcGVuZCgicmVjdCIpLmF0dHIoImNsYXNzIiwiYmFja2dyb3VuZCIpLnN0eWxlKCJ2aXNpYmlsaXR5IiwiaGlkZGVuIikuc3R5bGUoImN1cnNvciIsImNyb3NzaGFpciIpLGkuc2VsZWN0QWxsKCIuZXh0ZW50IikuZGF0YShbMF0pLmVudGVyKCkuYXBwZW5kKCJyZWN0IikuYXR0cigiY2xhc3MiLCJleHRlbnQiKS5zdHlsZSgiY3Vyc29yIiwibW92ZSIpO3ZhciBhPWkuc2VsZWN0QWxsKCIucmVzaXplIikuZGF0YShwLEF0KTthLmV4aXQoKS5yZW1vdmUoKSxhLmVudGVyKCkuYXBwZW5kKCJnIikuYXR0cigiY2xhc3MiLGZ1bmN0aW9uKG4pe3JldHVybiJyZXNpemUgIitufSkuc3R5bGUoImN1cnNvciIsZnVuY3Rpb24obil7cmV0dXJuIERzW25dfSkuYXBwZW5kKCJyZWN0IikuYXR0cigieCIsZnVuY3Rpb24obil7cmV0dXJuL1tld10kLy50ZXN0KG4pPy0zOm51bGx9KS5hdHRyKCJ5IixmdW5jdGlvbihuKXtyZXR1cm4vXltuc10vLnRlc3Qobik/LTM6bnVsbH0pLmF0dHIoIndpZHRoIiw2KS5hdHRyKCJoZWlnaHQiLDYpLnN0eWxlKCJ2aXNpYmlsaXR5IiwiaGlkZGVuIiksYS5zdHlsZSgiZGlzcGxheSIsbi5lbXB0eSgpPyJub25lIjpudWxsKTt2YXIgbCxmPUJvLnRyYW5zaXRpb24oaSksaD1Cby50cmFuc2l0aW9uKG8pO2MmJihsPVBpKGMpLGguYXR0cigieCIsbFswXSkuYXR0cigid2lkdGgiLGxbMV0tbFswXSkscihmKSkscyYmKGw9UGkocyksaC5hdHRyKCJ5IixsWzBdKS5hdHRyKCJoZWlnaHQiLGxbMV0tbFswXSksZShmKSksdChmKX0pfWZ1bmN0aW9uIHQobil7bi5zZWxlY3RBbGwoIi5yZXNpemUiKS5hdHRyKCJ0cmFuc2Zvcm0iLGZ1bmN0aW9uKG4pe3JldHVybiJ0cmFuc2xhdGUoIitsWysvZSQvLnRlc3QobildKyIsIitmWysvXnMvLnRlc3QobildKyIpIn0pfWZ1bmN0aW9uIHIobil7bi5zZWxlY3QoIi5leHRlbnQiKS5hdHRyKCJ4IixsWzBdKSxuLnNlbGVjdEFsbCgiLmV4dGVudCwubj5yZWN0LC5zPnJlY3QiKS5hdHRyKCJ3aWR0aCIsbFsxXS1sWzBdKX1mdW5jdGlvbiBlKG4pe24uc2VsZWN0KCIuZXh0ZW50IikuYXR0cigieSIsZlswXSksbi5zZWxlY3RBbGwoIi5leHRlbnQsLmU+cmVjdCwudz5yZWN0IikuYXR0cigiaGVpZ2h0IixmWzFdLWZbMF0pfWZ1bmN0aW9uIHUoKXtmdW5jdGlvbiB1KCl7MzI9PUJvLmV2ZW50LmtleUNvZGUmJihDfHwoeD1udWxsLHpbMF0tPWxbMV0selsxXS09ZlsxXSxDPTIpLHkoKSl9ZnVuY3Rpb24gcCgpezMyPT1Cby5ldmVudC5rZXlDb2RlJiYyPT1DJiYoelswXSs9bFsxXSx6WzFdKz1mWzFdLEM9MCx5KCkpfWZ1bmN0aW9uIHYoKXt2YXIgbj1Cby5tb3VzZShfKSx1PSExO00mJihuWzBdKz1NWzBdLG5bMV0rPU1bMV0pLEN8fChCby5ldmVudC5hbHRLZXk/KHh8fCh4PVsobFswXStsWzFdKS8yLChmWzBdK2ZbMV0pLzJdKSx6WzBdPWxbKyhuWzBdPHhbMF0pXSx6WzFdPWZbKyhuWzFdPHhbMV0pXSk6eD1udWxsKSxFJiZkKG4sYywwKSYmKHIoUyksdT0hMCksQSYmZChuLHMsMSkmJihlKFMpLHU9ITApLHUmJih0KFMpLHcoe3R5cGU6ImJydXNoIixtb2RlOkM/Im1vdmUiOiJyZXNpemUifSkpfWZ1bmN0aW9uIGQobix0LHIpe3ZhciBlLHUsYT1QaSh0KSxjPWFbMF0scz1hWzFdLHA9eltyXSx2PXI/ZjpsLGQ9dlsxXS12WzBdO3JldHVybiBDJiYoYy09cCxzLT1kK3ApLGU9KHI/ZzpoKT9NYXRoLm1heChjLE1hdGgubWluKHMsbltyXSkpOm5bcl0sQz91PShlKz1wKStkOih4JiYocD1NYXRoLm1heChjLE1hdGgubWluKHMsMip4W3JdLWUpKSksZT5wPyh1PWUsZT1wKTp1PXApLHZbMF0hPWV8fHZbMV0hPXU/KHI/bz1udWxsOmk9bnVsbCx2WzBdPWUsdlsxXT11LCEwKTp2b2lkIDB9ZnVuY3Rpb24gbSgpe3YoKSxTLnN0eWxlKCJwb2ludGVyLWV2ZW50cyIsImFsbCIpLnNlbGVjdEFsbCgiLnJlc2l6ZSIpLnN0eWxlKCJkaXNwbGF5IixuLmVtcHR5KCk/Im5vbmUiOm51bGwpLEJvLnNlbGVjdCgiYm9keSIpLnN0eWxlKCJjdXJzb3IiLG51bGwpLEwub24oIm1vdXNlbW92ZS5icnVzaCIsbnVsbCkub24oIm1vdXNldXAuYnJ1c2giLG51bGwpLm9uKCJ0b3VjaG1vdmUuYnJ1c2giLG51bGwpLm9uKCJ0b3VjaGVuZC5icnVzaCIsbnVsbCkub24oImtleWRvd24uYnJ1c2giLG51bGwpLm9uKCJrZXl1cC5icnVzaCIsbnVsbCksTigpLHcoe3R5cGU6ImJydXNoZW5kIn0pfXZhciB4LE0sXz10aGlzLGI9Qm8uc2VsZWN0KEJvLmV2ZW50LnRhcmdldCksdz1hLm9mKF8sYXJndW1lbnRzKSxTPUJvLnNlbGVjdChfKSxrPWIuZGF0dW0oKSxFPSEvXihufHMpJC8udGVzdChrKSYmYyxBPSEvXihlfHcpJC8udGVzdChrKSYmcyxDPWIuY2xhc3NlZCgiZXh0ZW50IiksTj1ZKCksej1Cby5tb3VzZShfKSxMPUJvLnNlbGVjdChRbykub24oImtleWRvd24uYnJ1c2giLHUpLm9uKCJrZXl1cC5icnVzaCIscCk7aWYoQm8uZXZlbnQuY2hhbmdlZFRvdWNoZXM/TC5vbigidG91Y2htb3ZlLmJydXNoIix2KS5vbigidG91Y2hlbmQuYnJ1c2giLG0pOkwub24oIm1vdXNlbW92ZS5icnVzaCIsdikub24oIm1vdXNldXAuYnJ1c2giLG0pLFMuaW50ZXJydXB0KCkuc2VsZWN0QWxsKCIqIikuaW50ZXJydXB0KCksQyl6WzBdPWxbMF0telswXSx6WzFdPWZbMF0telsxXTtlbHNlIGlmKGspe3ZhciBUPSsvdyQvLnRlc3QoaykscT0rL15uLy50ZXN0KGspO009W2xbMS1UXS16WzBdLGZbMS1xXS16WzFdXSx6WzBdPWxbVF0selsxXT1mW3FdfWVsc2UgQm8uZXZlbnQuYWx0S2V5JiYoeD16LnNsaWNlKCkpO1Muc3R5bGUoInBvaW50ZXItZXZlbnRzIiwibm9uZSIpLnNlbGVjdEFsbCgiLnJlc2l6ZSIpLnN0eWxlKCJkaXNwbGF5IixudWxsKSxCby5zZWxlY3QoImJvZHkiKS5zdHlsZSgiY3Vyc29yIixiLnN0eWxlKCJjdXJzb3IiKSksdyh7dHlwZToiYnJ1c2hzdGFydCJ9KSx2KCl9dmFyIGksbyxhPU0obiwiYnJ1c2hzdGFydCIsImJydXNoIiwiYnJ1c2hlbmQiKSxjPW51bGwscz1udWxsLGw9WzAsMF0sZj1bMCwwXSxoPSEwLGc9ITAscD1Qc1swXTtyZXR1cm4gbi5ldmVudD1mdW5jdGlvbihuKXtuLmVhY2goZnVuY3Rpb24oKXt2YXIgbj1hLm9mKHRoaXMsYXJndW1lbnRzKSx0PXt4OmwseTpmLGk6aSxqOm99LHI9dGhpcy5fX2NoYXJ0X198fHQ7dGhpcy5fX2NoYXJ0X189dCxBcz9Cby5zZWxlY3QodGhpcykudHJhbnNpdGlvbigpLmVhY2goInN0YXJ0LmJydXNoIixmdW5jdGlvbigpe2k9ci5pLG89ci5qLGw9ci54LGY9ci55LG4oe3R5cGU6ImJydXNoc3RhcnQifSl9KS50d2VlbigiYnJ1c2g6YnJ1c2giLGZ1bmN0aW9uKCl7dmFyIHI9bXUobCx0LngpLGU9bXUoZix0LnkpO3JldHVybiBpPW89bnVsbCxmdW5jdGlvbih1KXtsPXQueD1yKHUpLGY9dC55PWUodSksbih7dHlwZToiYnJ1c2giLG1vZGU6InJlc2l6ZSJ9KX19KS5lYWNoKCJlbmQuYnJ1c2giLGZ1bmN0aW9uKCl7aT10Lmksbz10Lmosbih7dHlwZToiYnJ1c2giLG1vZGU6InJlc2l6ZSJ9KSxuKHt0eXBlOiJicnVzaGVuZCJ9KX0pOihuKHt0eXBlOiJicnVzaHN0YXJ0In0pLG4oe3R5cGU6ImJydXNoIixtb2RlOiJyZXNpemUifSksbih7dHlwZToiYnJ1c2hlbmQifSkpfSl9LG4ueD1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oYz10LHA9UHNbIWM8PDF8IXNdLG4pOmN9LG4ueT1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8ocz10LHA9UHNbIWM8PDF8IXNdLG4pOnN9LG4uY2xhbXA9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGMmJnM/KGg9ISF0WzBdLGc9ISF0WzFdKTpjP2g9ISF0OnMmJihnPSEhdCksbik6YyYmcz9baCxnXTpjP2g6cz9nOm51bGx9LG4uZXh0ZW50PWZ1bmN0aW9uKHQpe3ZhciByLGUsdSxhLGg7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGMmJihyPXRbMF0sZT10WzFdLHMmJihyPXJbMF0sZT1lWzBdKSxpPVtyLGVdLGMuaW52ZXJ0JiYocj1jKHIpLGU9YyhlKSkscj5lJiYoaD1yLHI9ZSxlPWgpLChyIT1sWzBdfHxlIT1sWzFdKSYmKGw9W3IsZV0pKSxzJiYodT10WzBdLGE9dFsxXSxjJiYodT11WzFdLGE9YVsxXSksbz1bdSxhXSxzLmludmVydCYmKHU9cyh1KSxhPXMoYSkpLHU+YSYmKGg9dSx1PWEsYT1oKSwodSE9ZlswXXx8YSE9ZlsxXSkmJihmPVt1LGFdKSksbik6KGMmJihpPyhyPWlbMF0sZT1pWzFdKToocj1sWzBdLGU9bFsxXSxjLmludmVydCYmKHI9Yy5pbnZlcnQociksZT1jLmludmVydChlKSkscj5lJiYoaD1yLHI9ZSxlPWgpKSkscyYmKG8/KHU9b1swXSxhPW9bMV0pOih1PWZbMF0sYT1mWzFdLHMuaW52ZXJ0JiYodT1zLmludmVydCh1KSxhPXMuaW52ZXJ0KGEpKSx1PmEmJihoPXUsdT1hLGE9aCkpKSxjJiZzP1tbcix1XSxbZSxhXV06Yz9bcixlXTpzJiZbdSxhXSl9LG4uY2xlYXI9ZnVuY3Rpb24oKXtyZXR1cm4gbi5lbXB0eSgpfHwobD1bMCwwXSxmPVswLDBdLGk9bz1udWxsKSxufSxuLmVtcHR5PWZ1bmN0aW9uKCl7cmV0dXJuISFjJiZsWzBdPT1sWzFdfHwhIXMmJmZbMF09PWZbMV19LEJvLnJlYmluZChuLGEsIm9uIil9O3ZhciBEcz17bjoibnMtcmVzaXplIixlOiJldy1yZXNpemUiLHM6Im5zLXJlc2l6ZSIsdzoiZXctcmVzaXplIixudzoibndzZS1yZXNpemUiLG5lOiJuZXN3LXJlc2l6ZSIsc2U6Im53c2UtcmVzaXplIixzdzoibmVzdy1yZXNpemUifSxQcz1bWyJuIiwiZSIsInMiLCJ3IiwibnciLCJuZSIsInNlIiwic3ciXSxbImUiLCJ3Il0sWyJuIiwicyJdLFtdXSxVcz1yYy5mb3JtYXQ9Y2MudGltZUZvcm1hdCxqcz1Vcy51dGMsSHM9anMoIiVZLSVtLSVkVCVIOiVNOiVTLiVMWiIpO1VzLmlzbz1EYXRlLnByb3RvdHlwZS50b0lTT1N0cmluZyYmK25ldyBEYXRlKCIyMDAwLTAxLTAxVDAwOjAwOjAwLjAwMFoiKT9ZbzpIcyxZby5wYXJzZT1mdW5jdGlvbihuKXt2YXIgdD1uZXcgRGF0ZShuKTtyZXR1cm4gaXNOYU4odCk/bnVsbDp0fSxZby50b1N0cmluZz1Icy50b1N0cmluZyxyYy5zZWNvbmQ9SHQoZnVuY3Rpb24obil7cmV0dXJuIG5ldyBlYygxZTMqTWF0aC5mbG9vcihuLzFlMykpfSxmdW5jdGlvbihuLHQpe24uc2V0VGltZShuLmdldFRpbWUoKSsxZTMqTWF0aC5mbG9vcih0KSl9LGZ1bmN0aW9uKG4pe3JldHVybiBuLmdldFNlY29uZHMoKX0pLHJjLnNlY29uZHM9cmMuc2Vjb25kLnJhbmdlLHJjLnNlY29uZHMudXRjPXJjLnNlY29uZC51dGMucmFuZ2UscmMubWludXRlPUh0KGZ1bmN0aW9uKG4pe3JldHVybiBuZXcgZWMoNmU0Kk1hdGguZmxvb3Iobi82ZTQpKX0sZnVuY3Rpb24obix0KXtuLnNldFRpbWUobi5nZXRUaW1lKCkrNmU0Kk1hdGguZmxvb3IodCkpfSxmdW5jdGlvbihuKXtyZXR1cm4gbi5nZXRNaW51dGVzKCl9KSxyYy5taW51dGVzPXJjLm1pbnV0ZS5yYW5nZSxyYy5taW51dGVzLnV0Yz1yYy5taW51dGUudXRjLnJhbmdlLHJjLmhvdXI9SHQoZnVuY3Rpb24obil7dmFyIHQ9bi5nZXRUaW1lem9uZU9mZnNldCgpLzYwO3JldHVybiBuZXcgZWMoMzZlNSooTWF0aC5mbG9vcihuLzM2ZTUtdCkrdCkpfSxmdW5jdGlvbihuLHQpe24uc2V0VGltZShuLmdldFRpbWUoKSszNmU1Kk1hdGguZmxvb3IodCkpfSxmdW5jdGlvbihuKXtyZXR1cm4gbi5nZXRIb3VycygpfSkscmMuaG91cnM9cmMuaG91ci5yYW5nZSxyYy5ob3Vycy51dGM9cmMuaG91ci51dGMucmFuZ2UscmMubW9udGg9SHQoZnVuY3Rpb24obil7cmV0dXJuIG49cmMuZGF5KG4pLG4uc2V0RGF0ZSgxKSxufSxmdW5jdGlvbihuLHQpe24uc2V0TW9udGgobi5nZXRNb250aCgpK3QpfSxmdW5jdGlvbihuKXtyZXR1cm4gbi5nZXRNb250aCgpfSkscmMubW9udGhzPXJjLm1vbnRoLnJhbmdlLHJjLm1vbnRocy51dGM9cmMubW9udGgudXRjLnJhbmdlO3ZhciBGcz1bMWUzLDVlMywxNWUzLDNlNCw2ZTQsM2U1LDllNSwxOGU1LDM2ZTUsMTA4ZTUsMjE2ZTUsNDMyZTUsODY0ZTUsMTcyOGU1LDYwNDhlNSwyNTkyZTYsNzc3NmU2LDMxNTM2ZTZdLE9zPVtbcmMuc2Vjb25kLDFdLFtyYy5zZWNvbmQsNV0sW3JjLnNlY29uZCwxNV0sW3JjLnNlY29uZCwzMF0sW3JjLm1pbnV0ZSwxXSxbcmMubWludXRlLDVdLFtyYy5taW51dGUsMTVdLFtyYy5taW51dGUsMzBdLFtyYy5ob3VyLDFdLFtyYy5ob3VyLDNdLFtyYy5ob3VyLDZdLFtyYy5ob3VyLDEyXSxbcmMuZGF5LDFdLFtyYy5kYXksMl0sW3JjLndlZWssMV0sW3JjLm1vbnRoLDFdLFtyYy5tb250aCwzXSxbcmMueWVhciwxXV0sSXM9VXMubXVsdGkoW1siLiVMIixmdW5jdGlvbihuKXtyZXR1cm4gbi5nZXRNaWxsaXNlY29uZHMoKX1dLFsiOiVTIixmdW5jdGlvbihuKXtyZXR1cm4gbi5nZXRTZWNvbmRzKCl9XSxbIiVJOiVNIixmdW5jdGlvbihuKXtyZXR1cm4gbi5nZXRNaW51dGVzKCl9XSxbIiVJICVwIixmdW5jdGlvbihuKXtyZXR1cm4gbi5nZXRIb3VycygpfV0sWyIlYSAlZCIsZnVuY3Rpb24obil7cmV0dXJuIG4uZ2V0RGF5KCkmJjEhPW4uZ2V0RGF0ZSgpfV0sWyIlYiAlZCIsZnVuY3Rpb24obil7cmV0dXJuIDEhPW4uZ2V0RGF0ZSgpfV0sWyIlQiIsZnVuY3Rpb24obil7cmV0dXJuIG4uZ2V0TW9udGgoKX1dLFsiJVkiLEFyXV0pLFlzPXtyYW5nZTpmdW5jdGlvbihuLHQscil7cmV0dXJuIEJvLnJhbmdlKE1hdGguY2VpbChuL3IpKnIsK3QscikubWFwKFZvKX0sZmxvb3I6QXQsY2VpbDpBdH07T3MueWVhcj1yYy55ZWFyLHJjLnNjYWxlPWZ1bmN0aW9uKCl7cmV0dXJuIFpvKEJvLnNjYWxlLmxpbmVhcigpLE9zLElzKX07dmFyIFpzPU9zLm1hcChmdW5jdGlvbihuKXtyZXR1cm5bblswXS51dGMsblsxXV19KSxWcz1qcy5tdWx0aShbWyIuJUwiLGZ1bmN0aW9uKG4pe3JldHVybiBuLmdldFVUQ01pbGxpc2Vjb25kcygpfV0sWyI6JVMiLGZ1bmN0aW9uKG4pe3JldHVybiBuLmdldFVUQ1NlY29uZHMoKX1dLFsiJUk6JU0iLGZ1bmN0aW9uKG4pe3JldHVybiBuLmdldFVUQ01pbnV0ZXMoKX1dLFsiJUkgJXAiLGZ1bmN0aW9uKG4pe3JldHVybiBuLmdldFVUQ0hvdXJzKCl9XSxbIiVhICVkIixmdW5jdGlvbihuKXtyZXR1cm4gbi5nZXRVVENEYXkoKSYmMSE9bi5nZXRVVENEYXRlKCl9XSxbIiViICVkIixmdW5jdGlvbihuKXtyZXR1cm4gMSE9bi5nZXRVVENEYXRlKCl9XSxbIiVCIixmdW5jdGlvbihuKXtyZXR1cm4gbi5nZXRVVENNb250aCgpfV0sWyIlWSIsQXJdXSk7WnMueWVhcj1yYy55ZWFyLnV0YyxyYy5zY2FsZS51dGM9ZnVuY3Rpb24oKXtyZXR1cm4gWm8oQm8uc2NhbGUubGluZWFyKCksWnMsVnMpfSxCby50ZXh0PUN0KGZ1bmN0aW9uKG4pe3JldHVybiBuLnJlc3BvbnNlVGV4dH0pLEJvLmpzb249ZnVuY3Rpb24obix0KXtyZXR1cm4gTnQobiwiYXBwbGljYXRpb24vanNvbiIsJG8sdCl9LEJvLmh0bWw9ZnVuY3Rpb24obix0KXtyZXR1cm4gTnQobiwidGV4dC9odG1sIixYbyx0KX0sQm8ueG1sPUN0KGZ1bmN0aW9uKG4pe3JldHVybiBuLnJlc3BvbnNlWE1MfSksImZ1bmN0aW9uIj09dHlwZW9mIGRlZmluZSYmZGVmaW5lLmFtZD9kZWZpbmUoJ2QzJyxbXSxCbyk6Im9iamVjdCI9PXR5cGVvZiBtb2R1bGUmJm1vZHVsZS5leHBvcnRzP21vZHVsZS5leHBvcnRzPUJvOnRoaXMuZDM9Qm99KCk7Ci8qKgogKiB0aGUgd2lkdGggaGVpZ2h0ICYgeC9yIHJhbmdlIGFsbCB0aGUgY2hyb21hdG8gJiBzcGVjdHJhIHdpbGwgc2hhcmUKICoKICogZm9sbG93aW5nIGQzLCB0aGVyZSBpcwogKiAqIGEgZG9tYWluOiByYW5nZSBvZiAicmVhbCAiIHZhbHVlcwogKiAqIGEgcmFuZ2U6IHZpZXdwb3J0IGNvb3JlZGluYXRlcwogKiAqIG9yaWdEb21haW4gKGRvbWFpbiBhdCBsYXJnZSwgYmVmb3JlIHpvb20pCiAqCiAqICdzY2FsZWNoYW5nZScgZXZudCBpcyB0cmlnZ2VyZWQgd2hlbiBib3VuZGFyaWVzIGFyZSBjaGFuZ2VkCiAqCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwoKZGVmaW5lKCdmaXNodG9uZXMvdmlld3MvdXRpbHMvRDNTY2FsaW5nQ29udGV4dCcsWydkMycsICd1bmRlcnNjb3JlJywgJ0JhY2tib25lJ10sIGZ1bmN0aW9uKGQzLCBfLCBCYWNrYm9uZSkgewogIHZhciBEM1NjYWxpbmdDb250ZXh0ID0gQmFja2JvbmUuTW9kZWwuZXh0ZW5kKHsKICAgIGluaXRpYWxpemUgOiBmdW5jdGlvbihvcHRpb25zKSB7CgogICAgICB0aGlzLl94T3JpZ0RvbWFpbiA9IChvcHRpb25zICYmIG9wdGlvbnMueERvbWFpbiAmJiBvcHRpb25zLnhEb21haW4uc2xpY2UoKSkgfHwgWzAsIDFdOwogICAgICB0aGlzLl95T3JpZ0RvbWFpbiA9IChvcHRpb25zICYmIG9wdGlvbnMueURvbWFpbiAmJiBvcHRpb25zLnlEb21haW4uc2xpY2UoKSkgfHwgWzAsIDFdOwogICAgICB0aGlzLl94RG9tYWluID0gdGhpcy5feE9yaWdEb21haW4uc2xpY2UoKTsKICAgICAgdGhpcy5feURvbWFpbiA9IHRoaXMuX3lPcmlnRG9tYWluLnNsaWNlKCk7CgogICAgICB0aGlzLl94UmFuZ2UgPSBbMCwgKG9wdGlvbnMgJiYgb3B0aW9ucy53aWR0aCkgfHwgMzMyXTsKICAgICAgdGhpcy5feVJhbmdlID0gWyhvcHRpb25zICYmIG9wdGlvbnMuaGVpZ2h0KSB8fCA2NjQsIDBdOwoKICAgICAgdGhpcy5jaGFuZ2VYRG9tYWluQ2FsbEJhY2tzID0ge307CiAgICAgIHJldHVybiB0aGlzCiAgICB9LAogICAgd2lkdGggOiBmdW5jdGlvbih2KSB7CiAgICAgIGlmICh2ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICB2YXIgY2hhbmdlZCA9IHRoaXMuX3hSYW5nZVsxXSAhPSB2OwogICAgICAgIHRoaXMuX3hSYW5nZVsxXSA9IHY7CiAgICAgICAgaWYgKGNoYW5nZWQpIHsKICAgICAgICAgIHRoaXMudHJpZ2dlcignc2NhbGVjaGFuZ2UnLCAncmVzZXQnKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMuX3hSYW5nZVsxXTsKICAgIH0sCiAgICBoZWlnaHQgOiBmdW5jdGlvbih2KSB7CiAgICAgIGlmICh2ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICB2YXIgY2hhbmdlZCA9IHRoaXMuX3lSYW5nZVswXSAhPSB2OwogICAgICAgIHRoaXMuX3lSYW5nZVswXSA9IHY7CiAgICAgICAgaWYgKGNoYW5nZWQpIHsKICAgICAgICAgIHRoaXMudHJpZ2dlcignc2NhbGVjaGFuZ2UnLCAncmVzZXQnKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMuX3lSYW5nZVswXTsKICAgIH0sCiAgICB4IDogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBkMy5zY2FsZS5saW5lYXIoKS5kb21haW4odGhpcy5feERvbWFpbikucmFuZ2UodGhpcy5feFJhbmdlKTsKICAgIH0sCiAgICB5IDogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBkMy5zY2FsZS5saW5lYXIoKS5kb21haW4odGhpcy5feURvbWFpbikucmFuZ2UodGhpcy5feVJhbmdlKQogICAgfSwKICAgIHJlc2V0IDogZnVuY3Rpb24oKSB7CiAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgdmFyIGNoYW5nZWQgPSBzZWxmLl94RG9tYWluWzBdICE9IHNlbGYuX3hPcmlnRG9tYWluWzBdIHx8IHNlbGYuX3hEb21haW5bMV0gIT0gc2VsZi5feE9yaWdEb21haW5bMV0gfHwgc2VsZi5feURvbWFpblswXSAhPSBzZWxmLl95T3JpZ0RvbWFpblswXSB8fCBzZWxmLl95RG9tYWluWzFdICE9IHNlbGYuX3lPcmlnRG9tYWluWzFdOwoKICAgICAgc2VsZi5feERvbWFpblswXSA9IHNlbGYuX3hPcmlnRG9tYWluWzBdOwogICAgICBzZWxmLl94RG9tYWluWzFdID0gc2VsZi5feE9yaWdEb21haW5bMV07CiAgICAgIHNlbGYuX3lEb21haW5bMF0gPSBzZWxmLl95T3JpZ0RvbWFpblswXTsKICAgICAgc2VsZi5feURvbWFpblsxXSA9IHNlbGYuX3lPcmlnRG9tYWluWzFdOwogICAgICBpZiAoY2hhbmdlZCkgewogICAgICAgIHNlbGYudHJpZ2dlcignc2NhbGVjaGFuZ2UnLCAncmVzZXQnKTsKICAgICAgfQogICAgICAvL3NlbGYuZmlyZUNoYW5nZVhSYW5nZSgpOwogICAgfSwKICAgIHJlc2V0WCA6IGZ1bmN0aW9uKCkgewogICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgIHZhciBjaGFuZ2VkID0gc2VsZi5feERvbWFpblswXSAhPSBzZWxmLl94T3JpZ0RvbWFpblswXSB8fCBzZWxmLl94RG9tYWluWzFdICE9IHNlbGYuX3hPcmlnRG9tYWluWzFdOwoKICAgICAgc2VsZi5feERvbWFpblswXSA9IHNlbGYuX3hPcmlnRG9tYWluWzBdOwogICAgICBzZWxmLl94RG9tYWluWzFdID0gc2VsZi5feE9yaWdEb21haW5bMV07CiAgICAgIGlmIChjaGFuZ2VkKSB7CiAgICAgICAgc2VsZi50cmlnZ2VyKCdzY2FsZWNoYW5nZScsICdyZXNldFgnKTsKICAgICAgfQogICAgICByZXR1cm4gc2VsZjsKCiAgICAgIC8vc2VsZi5maXJlQ2hhbmdlWFJhbmdlKCk7CiAgICB9LAogICAgcmVzZXRZIDogZnVuY3Rpb24oKSB7CiAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgIHNlbGYuX3lEb21haW5bMF0gPSBzZWxmLl95T3JpZ0RvbWFpblswXTsKICAgICAgc2VsZi5feURvbWFpblsxXSA9IHNlbGYuX3lPcmlnRG9tYWluWzFdOwogICAgICAvL3NlbGYuZmlyZUNoYW5nZVhSYW5nZSgpOwogICAgICByZXR1cm4gc2VsZjsKICAgIH0sCiAgICB4TWluIDogZnVuY3Rpb24odikgewogICAgICBpZiAodiAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgdGhpcy5feE9yaWdEb21haW5bMF0gPSB2OwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLl94T3JpZ0RvbWFpblswXQogICAgfSwKICAgIHhNYXggOiBmdW5jdGlvbih2KSB7CiAgICAgIGlmICh2ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICB0aGlzLl94T3JpZ0RvbWFpblsxXSA9IHY7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMuX3hPcmlnRG9tYWluWzFdCiAgICB9LAogICAgeU1pbiA6IGZ1bmN0aW9uKHYpIHsKICAgICAgaWYgKHYgIT09IHVuZGVmaW5lZCkgewogICAgICAgIHRoaXMuX3lPcmlnRG9tYWluWzBdID0gdjsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy5feU9yaWdEb21haW5bMF0KICAgIH0sCiAgICB5TWF4IDogZnVuY3Rpb24odikgewogICAgICBpZiAodiAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgdGhpcy5feU9yaWdEb21haW5bMV0gPSB2OwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLl95T3JpZ0RvbWFpblsxXQogICAgfSwKCiAgICB4T3JpZ0RvbWFpbiA6IGZ1bmN0aW9uKHZzKSB7CiAgICAgIGlmICh2cyAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgdGhpcy5feE9yaWdEb21haW4gPSB2cy5zbGljZSgpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLl94T3JpZ0RvbWFpbi5zbGljZSgpCiAgICB9LAogICAgeU9yaWdEb21haW4gOiBmdW5jdGlvbih2cykgewogICAgICBpZiAodnMgIT09IHVuZGVmaW5lZCkgewogICAgICAgIHRoaXMuX3lPcmlnRG9tYWluID0gdnMuc2xpY2UoKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy5feU9yaWdEb21haW4uc2xpY2UoKQogICAgfSwKICAgIHhEb21haW4gOiBmdW5jdGlvbih4MCwgeDEsIG9wdHMpIHsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgdmFyIG9wdGlvbnMgPSBfLmV4dGVuZCh7CiAgICAgICAgc2lsZW50IDogZmFsc2UKICAgICAgfSwgb3B0cykKCiAgICAgIGlmICh4MCA9PT0gdW5kZWZpbmVkKQogICAgICAgIHJldHVybiBzZWxmLl94RG9tYWluLnNsaWNlKCk7CgogICAgICBpZiAoXy5pc0FycmF5KHgwKSkgewogICAgICAgIHgxID0geDBbMV07CiAgICAgICAgeDAgPSB4MFswXTsKICAgICAgfQogICAgICB2YXIgY2hhbmdlZCA9IHgwICE9IHNlbGYuX3hEb21haW5bMF0gfHwgeDEgIT0gc2VsZi5feERvbWFpblsxXTsKICAgICAgc2VsZi5feERvbWFpblswXSA9IHgwOwogICAgICBzZWxmLl94RG9tYWluWzFdID0geDE7CgogICAgICBpZiAoY2hhbmdlZCAmJiAhb3B0aW9ucy5zaWxlbnQpIHsKICAgICAgICBzZWxmLnRyaWdnZXIoJ3NjYWxlY2hhbmdlJywgJ3hEb21haW4nKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHNlbGYKICAgICAgLy90aGlzLmZpcmVDaGFuZ2VYUmFuZ2UoKTsKICAgIH0sCiAgICB5RG9tYWluIDogZnVuY3Rpb24oeTAsIHkxLCBvcHRzKSB7CiAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgdmFyIG9wdGlvbnMgPSBfLmV4dGVuZCh7CiAgICAgICAgc2lsZW50IDogZmFsc2UKICAgICAgfSwgb3B0cykKCiAgICAgIGlmICh5MCA9PT0gdW5kZWZpbmVkKQogICAgICAgIHJldHVybiB0aGlzLl95RG9tYWluLnNsaWNlKCk7CgogICAgICBpZiAoXy5pc0FycmF5KHkwKSkgewogICAgICAgIHkxID0geTBbMV07CiAgICAgICAgeTAgPSB5MFswXTsKICAgICAgfQogICAgICB2YXIgY2hhbmdlZCA9IHkwICE9IHNlbGYuX3lEb21haW5bMF0gfHwgeTEgIT0gc2VsZi5feURvbWFpblsxXTsKCiAgICAgIHNlbGYuX3lEb21haW5bMF0gPSB5MDsKICAgICAgc2VsZi5feURvbWFpblsxXSA9IHkxOwogICAgICBpZiAoY2hhbmdlZCAmJiAhb3B0aW9ucy5zaWxlbnQpIHsKICAgICAgICBzZWxmLnRyaWdnZXIoJ3NjYWxlY2hhbmdlJywgJ3lEb21haW4nKTsKICAgICAgfQogICAgICBzZWxmLmZpcmVDaGFuZ2VYRG9tYWluKCk7CiAgICAgIHJldHVybiBzZWxmOwogICAgfSwKICAgIGlzWFpvb21lZCA6IGZ1bmN0aW9uKCkgewogICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgIHJldHVybiBzZWxmLl94RG9tYWluWzBdID4gc2VsZi5feE9yaWdEb21haW5bMF0gfHwgc2VsZi5feERvbWFpblsxXSA8IHNlbGYuX3hPcmlnRG9tYWluWzFdOwogICAgfSwKICAgIC8qCiAgICAgKiBzZXQgdGhlIG14aW11bSB4IHZhbHVlLCB0aGUgb3ZlcmFsbCBtYXggYW5kIHRoZSBjdXJyZW50IG9uZS4KICAgICAqIGlmIGxpbWl0T25seSwgdGhlbiB3ZSBqdXN0IG1vZGlmeSB0aGUgb3ZlcmFsbCBsaW1pdAogICAgICovCiAgICBzZXRYTWF4IDogZnVuY3Rpb24obSwgbGltaXRPbmx5KSB7CiAgICAgIHRoaXMuX3hPcmlnRG9tYWluWzFdID0gbQogICAgICBpZiAobGltaXRPbmx5KSB7CiAgICAgICAgdGhpcy5feERvbWFpblsxXSA9IG0KICAgICAgfQogICAgICByZXR1cm4gdGhpczsKICAgIH0sCiAgICBzZXRZTWF4IDogZnVuY3Rpb24obSkgewogICAgICB0aGlzLl95RG9tYWluWzFdID0gdGhpcy5feU9yaWdEb21haW5bMV0gPSBtCgogICAgfSwKICAgIGFkZENoYW5nZVhEb21haW5DYWxsQmFjayA6IGZ1bmN0aW9uKG5hbWUsIGZjdCkgewogICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgIHNlbGYuY2hhbmdlWERvbWFpbkNhbGxCYWNrc1tuYW1lXSA9IGZjdDsKICAgIH0sCiAgICByZW1vdmVDaGFuZ2VYRG9tYWluQ2FsbEJhY2sgOiBmdW5jdGlvbihuYW1lKSB7CiAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgZGVsZXRlIHNlbGYuY2hhbmdlWERvbWFpbkNhbGxCYWNrc1tuYW1lXTsKICAgIH0sCiAgICBmaXJlQ2hhbmdlWERvbWFpbiA6IGZ1bmN0aW9uKCkgewogICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgIF8uZWFjaChzZWxmLmNoYW5nZVhEb21haW5DYWxsQmFja3MsIGZ1bmN0aW9uKGZjdCwgbmFtZSkgewogICAgICAgIGZjdChzZWxmKTsKICAgICAgfSk7CiAgICB9CiAgfSk7CgogIHJldHVybiBEM1NjYWxpbmdDb250ZXh0OwoKfSk7CgovKgogKiBhcmVhIHRvIGhhbmRsZSBtb3ZlL3pvb20gZXRjLiBidXR0b25zCiAqCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwoKZGVmaW5lKCdmaXNodG9uZXMvdmlld3MvdXRpbHMvRDNTY2FsaW5nQXJlYUJ1dHRvbnMnLFsndW5kZXJzY29yZScsICdkMyddLCBmdW5jdGlvbihfLCBkMyl7CiAgICAvKioKICAgICAqIHN2ZyBjb250YWluZXIKICAgICAqIGQzLVNjYWxpbmctY29udGV4dCAoY29udGFpbnMgdGhlIHZpZXdwb3J0IGFuZCBkb21haW5zIGJvdW5kYXJpZXMKICAgICAqIGEgY2FsbCBiYWNrIHRvIGJlIGNhbGxlZCB3aGVuIHpvb21lZAogICAgICovCiAgICBEM1NjYWxpbmdBcmVhQnV0dG9ucyA9IGZ1bmN0aW9uKGNvbnRhaW5lciwgY29udGV4dCwgY2FsbGJhY2ssIG9wdGlvbnMpIHsKICAgICAgICBvcHRpb25zID0gJC5leHRlbmQoe30sIG9wdGlvbnMpOwogICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICBzZWxmLmNvbnRleHQgPSBjb250ZXh0OwogICAgICAgIHNlbGYuY29udGFpbmVyID0gY29udGFpbmVyOwogICAgICAgIHNlbGYuY2FsbGJhY2sgPSBjYWxsYmFjawogICAgICAgIHNlbGYuaGVpZ2h0ID0gb3B0aW9ucy5oZWlnaHQgfHwgMzA7CgogICAgICAgIHNlbGYuY29udGFpbmVyLmF0dHIoJ3dpZHRoJywgY29udGV4dC53aWR0aCk7CiAgICAgICAgc2VsZi5jb250YWluZXIuYXR0cignaGVpZ2h0Jywgc2VsZi5oZWlnaHQpOwoKICAgICAgICBzZWxmLnBfc2V0dXAgPSBwX3NldHVwOwoKICAgICAgICBzZWxmLnBfc2V0dXAoKQoKICAgIH0KICAgICAgcmV0dXJuIEQzU2NhbGluZ0FyZWFCdXR0b25zOwoKfSk7Ci8qCiAqIHN2ZyBjb250YWluZXIgZm9yIHRoZSBjb21tb24gc2NhbGluZ2YgYXJlYS4KICoKICogZDMtU2NhbGluZy1jb250ZXh0IChjb250YWlucyB0aGUgdmlld3BvcnQgYW5kIGRvbWFpbnMgYm91bmRhcmllcwogKiBhIGNhbGwgYmFjayB0byBiZSBjYWxsZWQgd2hlbiB6b29tZWQKICogKiBtb2RlbDogc2NhbGluZ0NvbnRleHQsCiAqICogZWw6IGNvbnRhaW5lciwKICogKiBjYWxsYmFjazogY2FsbCBiYWNrIHdoZW4gem9vbWVkIGhhcyBiZWVuIGNhbGxlZCAoZm9yICBzdHR1ZGZmIG5vdCB0cmlnZ2VyZSBieSBzY2FsZWNoYW5nZSBldmVudHMpCiAqCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwpkZWZpbmUoJ2Zpc2h0b25lcy92aWV3cy91dGlscy9EM1NjYWxpbmdBcmVhJyxbJ3VuZGVyc2NvcmUnLCAnZDMnLCAnQmFja2JvbmUnLCAnLi9EM1NjYWxpbmdBcmVhQnV0dG9ucyddLCBmdW5jdGlvbiAoXywgZDMsIEJhY2tib25lLCBEM1NjYWxpbmdBcmVhQnV0dG9ucykgewogICAgdmFyIEQzU2NhbGluZ0FyZWEgPSBCYWNrYm9uZS5WaWV3LmV4dGVuZCh7CiAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKG9wdGlvbnMpIHsvL2NvbnRhaW5lciwgY29udGV4dCwgY2FsbGJhY2ssIG9wdGlvbnMpIHsKCiAgICAgICAgICAgIG9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgb3B0aW9ucyk7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgc2VsZi5jYWxsYmFjayA9IG9wdGlvbnMuY2FsbGJhY2s7CgogICAgICAgICAgICBzZWxmLmhlaWdodCA9IG9wdGlvbnMuaGVpZ2h0IHx8IHNlbGYubW9kZWwuaGVpZ2h0KCkgfHwgMzA7CgogICAgICAgICAgICB2YXIgZWwgPSBfLmlzQXJyYXkoc2VsZi5lbCkgPyBzZWxmLmVsWzBdIDogc2VsZi5lbDsKICAgICAgICAgICAgc2VsZi5jb250YWluZXIgPSBkMy5zZWxlY3QoZWwpLmFwcGVuZCgnZycpOwogICAgICAgICAgICBzZWxmLmNvbnRhaW5lci5hdHRyKCd3aWR0aCcsIG9wdGlvbnMud2lkdGggfHwgc2VsZi5tb2RlbC53aWR0aCgpKTsKICAgICAgICAgICAgc2VsZi5jb250YWluZXIuYXR0cignaGVpZ2h0Jywgc2VsZi5oZWlnaHQpOwoKICAgICAgICAgICAgc2VsZi5wX3NldHVwKCkKCiAgICAgICAgfSwKICAgICAgICB1cGRhdGVTY2FsaW5nQ29udGV4dDogZnVuY3Rpb24gKGN0eCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHNlbGYubW9kZWwgPSBjdHg7CgogICAgICAgIH0sCiAgICAgICAgcF9zZXR1cDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICAgICAgICB2YXIgZyA9IHNlbGYuY29udGFpbmVyLmluc2VydCgiZyIsICI6Zmlyc3QtY2hpbGQiKQogICAgICAgICAgICAvL3ZhciByZWN0ID0gZy5pbnNlcnQoInJlY3QiLCAiOmZpcnN0LWNoaWxkIikuYXR0cigneCcsIDApLmF0dHIoJ3knLCAwKS5hdHRyKCd3aWR0aCcsICcxMDAlJykuYXR0cignaGVpZ2h0JywgJzEwMCUnKS5hdHRyKCdmaWxsLW9wYWNpdHknLCAnMCUnKS5hdHRyKCdjbGFzcycsICd6b29tLWFyZWEnKTsKCiAgICAgICAgICAgIHNlbGYucF9zZXR1cF9idXR0b25zKCk7CgogICAgICAgICAgICAvLyBzZWxmLnpvb20gPSBkMy5iZWhhdmlvci56b29tKCkueChzZWxmLmNvbnRleHQueFNjYWxlKS5zY2FsZUV4dGVudChbMSwgMTgwXSkub24oInpvb20iLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgLy8gc2VsZi5jYWxsYmFjaygpOwogICAgICAgICAgICAvLyBzZWxmLmNvbnRleHQuZmlyZUNoYW5nZVhSYW5nZSgpOwogICAgICAgICAgICAvLyB9KTsKICAgICAgICAgICAgLy8gICBzZWxmLmNvbnRhaW5lci5jYWxsKHNlbGYuem9vbSk7CiAgICAgICAgfSwKICAgICAgICBwX3NldHVwX2J1dHRvbnM6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICAgICAgdmFyIHNjYWxpbmdDb250ZXh0ID0gc2VsZi5tb2RlbDsKICAgICAgICAgICAgc2VsZi5idXR0b25zID0ge307CiAgICAgICAgICAgIHZhciBnID0gc2VsZi5jb250YWluZXIuaW5zZXJ0KCJnIikuYXR0cignY2xhc3MnLCAnc2NhbGluZy1hcmVhLW1lbnUnKTsKCiAgICAgICAgICAgIHZhciBpQnV0dG9uID0gMDsKICAgICAgICAgICAgdmFyIGZjdEFkZEJ1dHRvbiA9IGZ1bmN0aW9uIChuYW1lLCB0ZXh0LCBmSXNTaG93aW5nLCBmQWN0aW9uKSB7CiAgICAgICAgICAgICAgICB2YXIgZ2J1dCA9IGcuaW5zZXJ0KCJnIikuYXR0cignY2xhc3MnLCAnc2NhbGluZy1hcmVhLW1lbnUtb25lLWJ1dHRvbicpLmF0dHIoJ3RyYW5zZm9ybScsICd0cmFuc2xhdGUoMjAsJyArICgxMCArIGlCdXR0b24gKiAyNykgKyAnKScpOwogICAgICAgICAgICAgICAgdmFyIHJlY3QgPSBnYnV0Lmluc2VydCgicmVjdCIpLmF0dHIoJ2NsYXNzJywgJ2J1dHRvbicpLmF0dHIoJ3gnLCAwKS5hdHRyKCd5JywgMCkuYXR0cignd2lkdGgnLCA4MCkuYXR0cigncngnLCA1KS5hdHRyKCdyeScsIDUpLmF0dHIoJ2hlaWdodCcsIDIyKTsKICAgICAgICAgICAgICAgIGdidXQuYXBwZW5kKCd0ZXh0JykuYXR0cigieCIsIDQwKS5hdHRyKCJ5IiwgMTEpLnRleHQodGV4dCk7CiAgICAgICAgICAgICAgICBzZWxmLmJ1dHRvbnNbbmFtZV0gPSB7CiAgICAgICAgICAgICAgICAgICAgZWw6IGdidXQsCiAgICAgICAgICAgICAgICAgICAgaXNTaG93aW5nOiBmSXNTaG93aW5nLAogICAgICAgICAgICAgICAgICAgIGFjdGlvbjogZkFjdGlvbgogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIHZhciBnT3ZlciA9IGdidXQuaW5zZXJ0KCJyZWN0IikuYXR0cignY2xhc3MnLCAnb3Zlci1idXR0b24nKS5hdHRyKCd4JywgMCkuYXR0cigneScsIDApLmF0dHIoJ3dpZHRoJywgODApLmF0dHIoJ3J4JywgNSkuYXR0cigncnknLCA1KS5hdHRyKCdoZWlnaHQnLCAyMik7CiAgICAgICAgICAgICAgICBnYnV0Lm9uKCdjbGljaycsIGZBY3Rpb24pOwoKICAgICAgICAgICAgICAgIGdidXQuc3R5bGUoJ2Rpc3BsYXknLCBmSXNTaG93aW5nKCkgPyBudWxsIDogJ25vbmUnKTsKICAgICAgICAgICAgICAgIGlCdXR0b24rKzsKICAgICAgICAgICAgfQogICAgICAgICAgICBmY3RBZGRCdXR0b24oJ3pvb21PdXQnLCAnem9vbSBvdXQnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5tb2RlbC5pc1hab29tZWQoKTsKICAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgc2VsZi5tb2RlbC5yZXNldCgpOwogICAgICAgICAgICB9KQoKICAgICAgICAgICAgc2VsZi5saXN0ZW5UbyhzY2FsaW5nQ29udGV4dCwgJ3NjYWxlY2hhbmdlJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgXy5lYWNoKHNlbGYuYnV0dG9ucywgZnVuY3Rpb24gKGJ1dENvbmYsIG5hbWUpIHsKICAgICAgICAgICAgICAgICAgICBidXRDb25mLmVsLnN0eWxlKCdkaXNwbGF5JywgYnV0Q29uZi5pc1Nob3dpbmcoKSA/IG51bGwgOiAnbm9uZScpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSk7CgogICAgICAgIH0sCiAgICAgICAgaGlkZUFsbEJ1dHRvbnM6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICBfLmVhY2goc2VsZi5idXR0b25zLCBmdW5jdGlvbiAoYnV0Q29uZiwgbmFtZSkgewogICAgICAgICAgICAgICAgYnV0Q29uZi5lbC5zdHlsZSgnZGlzcGxheScsICdub25lJyk7CiAgICAgICAgICAgIH0pCiAgICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gRDNTY2FsaW5nQXJlYTsKCn0pOwoKLyoqCiAqIEFuIGFic3RyYWN0IGNsYXNzIGZvciBEM1dpZGdldCBvcmllbnRlZCB2aWV3cwogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KCmRlZmluZSgnZmlzaHRvbmVzL3ZpZXdzL2NvbW1vbnMvQ29tbW9uV2lkZ2V0VmlldycsWyd1bmRlcnNjb3JlJywgJ0JhY2tib25lJywgJ2QzJywgJy4uL3V0aWxzL0QzU2NhbGluZ0NvbnRleHQnLCAnLi4vdXRpbHMvRDNTY2FsaW5nQXJlYSddLCBmdW5jdGlvbihfLCBCYWNrYm9uZSwgZDMsIEQzU2NhbGluZ0NvbnRleHQsIEQzU2NhbGluZ0FyZWEpIHsKICB2YXIgS0VZUFJFU1NFRF9OT05FID0gMDsKICB2YXIgS0VZUFJFU1NFRF9TSElGVCA9IDE7CiAgdmFyIEtFWVBSRVNTRURfQUxUID0gMjsKICB2YXIgRE9VQkxFX0NMSUNLID0gNDsKCiAgQ29tbW9uV2lkZ2V0VmlldyA9IEJhY2tib25lLlZpZXcuZXh0ZW5kKHsKICAgIGluaXRpYWxpemUgOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgIHZhciBlbFRtcCA9IF8uaXNBcnJheShzZWxmLmVsKSA/IHNlbGYuZWxbMF0gOiBzZWxmLmVsCiAgICAgIGlmICgkKGVsVG1wKS5wcm9wKCJ0YWdOYW1lIikudG9Mb3dlckNhc2UoKSA9PT0gJ2RpdicpIHsKICAgICAgICBzZWxmLmVsID0gZDMuc2VsZWN0KGVsVG1wKS5hcHBlbmQoJ3N2ZycpLmF0dHIoJ2hlaWdodCcsICcxMDAlJykuYXR0cignd2lkdGgnLCAnMTAwJScpOwogICAgICB9IGVsc2UgewogICAgICAgIHNlbGYuZWwgPSBkMy5zZWxlY3QoZWxUbXApOwogICAgICB9CgogICAgICBpZiAoc2VsZi5zY2FsaW5nQ29udGV4dCkgewogICAgICAgIHNlbGYueFpvb21hYmxlKCkKICAgICAgfQogICAgICBzZWxmLmJydXNoQ2FsbGJhY2tzID0ge307CgogICAgICBpZiAoJChlbFRtcCkucHJvcCgndGFnTmFtZScpLnRvTG93ZXJDYXNlKCkgPT09ICdzdmcnKSB7CiAgICAgICAgc2VsZi5faGVpZ2h0ID0gb3B0aW9ucy5oZWlnaHQgfHwgJChlbFRtcCkucGFyZW50KCkuaGVpZ2h0KCkgfHwgMzAwOwogICAgICAgIHNlbGYuX3dpZHRoID0gb3B0aW9ucy53aWR0aCB8fCAkKGVsVG1wKS5wYXJlbnQoKS53aWR0aCgpIHx8IDIwMDsKICAgICAgfSBlbHNlIHsKICAgICAgICBzZWxmLl9oZWlnaHQgPSBvcHRpb25zLmhlaWdodCB8fCAkKGVsVG1wKS5oZWlnaHQoKSB8fCAzMDA7CiAgICAgICAgc2VsZi5fd2lkdGggPSBvcHRpb25zLndpZHRoIHx8ICQoZWxUbXApLndpZHRoKCkgfHwgMjAwOwogICAgICB9CgogICAgfSwKICAgIGhlaWdodCA6IGZ1bmN0aW9uKHYpIHsKICAgICAgaWYgKHYgIT09IHVuZGVmaW5lZCkgewogICAgICAgIHRoaXMuX2hlaWdodCA9IHY7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMuX2hlaWdodDsKICAgIH0sCiAgICB3aWR0aCA6IGZ1bmN0aW9uKHYpIHsKICAgICAgaWYgKHYgIT09IHVuZGVmaW5lZCkgewogICAgICAgIHRoaXMuX3dpZHRoID0gdjsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy5fd2lkdGg7CiAgICB9LAogICAgLyoqCiAgICAgKiBnZXQgdGhlIHNjYWxpbmdDb250ZXh0IGZyb20gdGhlIG9wdGlvbnMgKGNvbnRydWN0b3Igb3JpZW50ZWQpIG9yIGRlZmluZSBhIG5ldyBvbmUKICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zCiAgICAgKi8KICAgIHNldHVwU2NhbGluZ0NvbnRleHQgOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CgogICAgICBpZiAob3B0aW9ucy5zY2FsaW5nQ29udGV4dCAhPSB1bmRlZmluZWQpIHsKICAgICAgICBzZWxmLnNjYWxpbmdDb250ZXh0ID0gb3B0aW9ucy5zY2FsaW5nQ29udGV4dDsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoc2VsZi5zY2FsaW5nQ29udGV4dCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBzZWxmLnNjYWxpbmdDb250ZXh0ID0gbmV3IEQzU2NhbGluZ0NvbnRleHQoewogICAgICAgICAgICBoZWlnaHQgOiBzZWxmLl9oZWlnaHQsCiAgICAgICAgICAgIHdpZHRoIDogc2VsZi5fd2lkdGgKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgaWYgKG9wdGlvbnMueERvbWFpbikgewogICAgICAgICAgc2VsZi5zY2FsaW5nQ29udGV4dC54T3JpZ0RvbWFpbihvcHRpb25zLnhEb21haW4pOwogICAgICAgICAgc2VsZi5zY2FsaW5nQ29udGV4dC54RG9tYWluKG9wdGlvbnMueERvbWFpbik7CiAgICAgICAgfQogICAgICAgIGlmIChvcHRpb25zLnlEb21haW4pIHsKICAgICAgICAgIHNlbGYuc2NhbGluZ0NvbnRleHQueU9yaWdEb21haW4ob3B0aW9ucy55RG9tYWluKTsKICAgICAgICAgIHNlbGYuc2NhbGluZ0NvbnRleHQueURvbWFpbihvcHRpb25zLnlEb21haW4pOwogICAgICAgIH0KICAgICAgICBpZiAob3B0aW9ucy5oZWlnaHQpIHsKICAgICAgICAgIHNlbGYuc2NhbGluZ0NvbnRleHQuaGVpZ2h0KG9wdGlvbnMuaGVpZ2h0KTsKICAgICAgICB9CiAgICAgICAgaWYgKG9wdGlvbnMud2lkdGgpIHsKICAgICAgICAgIHNlbGYuc2NhbGluZ0NvbnRleHQud2lkdGgob3B0aW9ucy53aWR0aCk7CiAgICAgICAgfQoKICAgICAgfQogICAgICBzZWxmLmxpc3RlblRvKHNlbGYuc2NhbGluZ0NvbnRleHQsICdzY2FsZWNoYW5nZScsIGZ1bmN0aW9uKGV2dCkgewogICAgICAgIHNlbGYucmVuZGVyKHsKICAgICAgICAgIGNhdXNlIDogewogICAgICAgICAgICBuYW1lIDogZXZ0LAogICAgICAgICAgICBpZCA6IE1hdGgucmFuZG9tKCkKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSkKICAgIH0sCiAgICAvKioKICAgICAqIGFkZCBhIEQzU2NhbGluZ0FyZSwgaS5lLiBhIHgtem9vbWFibGUgYXJlYQogICAgICovCiAgICB4Wm9vbWFibGUgOiBmdW5jdGlvbigpIHsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgdmFyIGFkYXB0WURvbWFpbiA9IGZ1bmN0aW9uKHhzKSB7CiAgICAgICAgaWYgKCFzZWxmLmdldE1heFlJblhEb21haW4pCiAgICAgICAgICByZXR1cm4KICAgICAgICB2YXIgeW1heCA9IHNlbGYuZ2V0TWF4WUluWERvbWFpbih4c1swXSwgeHNbMV0pOwogICAgICAgIHNlbGYuc2NhbGluZ0NvbnRleHQueURvbWFpbigwLCB5bWF4LCB7CiAgICAgICAgICBzaWxlbnQgOiB0cnVlCiAgICAgICAgfSk7CgogICAgICB9CgogICAgICBzZWxmLnNldHVwSW50ZXJhY3RpdmUoKTsKICAgICAgc2VsZi5zZXRCcnVzaENhbGxiYWNrKEtFWVBSRVNTRURfTk9ORSwgZnVuY3Rpb24oeHMpIHsKICAgICAgICBhZGFwdFlEb21haW4oeHMpCiAgICAgICAgc2VsZi5zY2FsaW5nQ29udGV4dC54RG9tYWluKHhzKQogICAgICB9KQogICAgICBzZWxmLnNldEJydXNoQ2FsbGJhY2soRE9VQkxFX0NMSUNLLCBmdW5jdGlvbih4cykgewogICAgICAgIHNlbGYuc2NhbGluZ0NvbnRleHQucmVzZXQoKQogICAgICB9KQogICAgfSwKCiAgICBzZXRTaGlmdFNlbGVjdENhbGxiYWNrIDogZnVuY3Rpb24oZikgewogICAgICB0aGlzLnNldEJydXNoQ2FsbGJhY2soS0VZUFJFU1NFRF9TSElGVCwgZik7CiAgICB9LAoKICAgIHNldHVwSW50ZXJhY3RpdmUgOiBmdW5jdGlvbigpIHsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICBpZiAoc2VsZi5icnVzaCAhPT0gdW5kZWZpbmVkKQogICAgICAgIHJldHVybjsKCiAgICAgIHNlbGYuZWwuc2VsZWN0QWxsKCcuem9vbS1hcmVhJykucmVtb3ZlKCkKICAgICAgaWYgKHNlbGYuc2NhbGluZ0FyZWEgIT09IHVuZGVmaW5lZCkgewogICAgICAgIHNlbGYuc2NhbGluZ0FyZWEudXBkYXRlU2NhbGluZ0NvbnRleHQoc2VsZi5zY2FsaW5nQ29udGV4dCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc2VsZi5zY2FsaW5nQXJlYSA9IG5ldyBEM1NjYWxpbmdBcmVhKHsKICAgICAgICAgIGVsIDogc2VsZi52aXMgfHwgc2VsZi5lbCwKICAgICAgICAgIG1vZGVsIDogc2VsZi5zY2FsaW5nQ29udGV4dCwKICAgICAgICAgIGNhbGxiYWNrIDogZnVuY3Rpb24oKSB7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHZhciBnQnJ1c2ggPSAoc2VsZi52aXMgfHwgc2VsZi5lbCkuaW5zZXJ0KCdnJywgJzpmaXJzdC1jaGlsZCcpLmF0dHIoJ2NsYXNzJywgJ3gtc2VsZWN0b3InKTsKICAgICAgZ0JydXNoLmFwcGVuZCgncmVjdCcpLmF0dHIoJ2hlaWdodCcsICcxMDAlJykuYXR0cignd2lkdGgnLCAnMTAwJScpLmF0dHIoJ2NsYXNzJywgJ2JhY2tncm91bmQnKTsKICAgICAgdmFyIGxlZnRIaWRlciA9IGdCcnVzaC5hcHBlbmQoJ3JlY3QnKS5hdHRyKCdjbGFzcycsICdoaWRlciBsZWZ0JykuYXR0cignaGVpZ2h0JywgJzEwMCUnKS5hdHRyKCd3aWR0aCcsIDApLnN0eWxlKCdkaXNwbGF5JywgJ25vbmUnKTsKICAgICAgdmFyIHJpZ2h0SGlkZXIgPSBnQnJ1c2guYXBwZW5kKCdyZWN0JykuYXR0cignY2xhc3MnLCAnaGlkZXIgcmlnaHQnKS5hdHRyKCdoZWlnaHQnLCAnMTAwJScpLmF0dHIoJ3dpZHRoJywgJzEwMCUnKS5zdHlsZSgnZGlzcGxheScsICdub25lJyk7CgogICAgICB2YXIgdFN0YW1wID0gMDsKICAgICAgdmFyIGlzRGJsQ2xpY2sgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgZCA9IG5ldyBEYXRlKCk7CiAgICAgICAgdmFyIHQxID0gZC5nZXRNaWxsaXNlY29uZHMoKSArIDEwMDAgKiAoZC5nZXRTZWNvbmRzKCkgKyA2MCAqIGQuZ2V0TWludXRlcygpKQogICAgICAgIHZhciBiID0gKHQxIC0gdFN0YW1wKSA8IDQ1MAogICAgICAgIHRTdGFtcCA9IHQxOwogICAgICAgIHJldHVybiBiOwogICAgICB9CiAgICAgIHZhciBicnVzaCA9IGQzLnN2Zy5icnVzaCgpLm9uKCJicnVzaHN0YXJ0IiwgZnVuY3Rpb24oKSB7CiAgICAgICAgYnJ1c2gueChzZWxmLnNjYWxpbmdDb250ZXh0LngoKSk7CiAgICAgICAgbGVmdEhpZGVyLnN0eWxlKCdkaXNwbGF5JywgbnVsbCkKICAgICAgICByaWdodEhpZGVyLnN0eWxlKCdkaXNwbGF5JywgbnVsbCkKCiAgICAgIH0pLm9uKCJicnVzaCIsIGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBib3VuZHMgPSBicnVzaC5leHRlbnQoKQogICAgICAgIHZhciB4ID0gc2VsZi5zY2FsaW5nQ29udGV4dC54KCkKICAgICAgICBsZWZ0SGlkZXIuYXR0cignd2lkdGgnLCB4KGJvdW5kc1swXSkpCiAgICAgICAgcmlnaHRIaWRlci5hdHRyKCd4JywgeChib3VuZHNbMV0pKQoKICAgICAgfSkub24oImJydXNoZW5kIiwgZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGtwID0gZ2V0S2V5UHJlc3NlZCgpOwogICAgICAgIHZhciBib3VuZHMgPSBicnVzaC5leHRlbnQoKQogICAgICAgIGlmIChpc0RibENsaWNrKCkpIHsKICAgICAgICAgIHNlbGYuYnJ1c2hDYWxsYmFja3NbRE9VQkxFX0NMSUNLXSgpCiAgICAgICAgfSBlbHNlIGlmICgoYm91bmRzWzFdIC0gYm91bmRzWzBdKSA+PSAwLjAwMSAqIHNlbGYuc2NhbGluZ0NvbnRleHQueE1heCgpKSB7CiAgICAgICAgICBpZiAoc2VsZi5icnVzaENhbGxiYWNrc1trcF0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBzZWxmLmJydXNoQ2FsbGJhY2tzW2twXShib3VuZHMpCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGxlZnRIaWRlci5zdHlsZSgnZGlzcGxheScsICdub25lJykKICAgICAgICByaWdodEhpZGVyLnN0eWxlKCdkaXNwbGF5JywgJ25vbmUnKQogICAgICB9KTsKCiAgICAgIGJydXNoLngoc2VsZi5zY2FsaW5nQ29udGV4dC54KCkpOwogICAgICBicnVzaChnQnJ1c2gpOwoKICAgIH0sCiAgICBzZXRCcnVzaENhbGxiYWNrIDogZnVuY3Rpb24oa2V5TWFzaywgZikgewogICAgICB0aGlzLmJydXNoQ2FsbGJhY2tzW2tleU1hc2tdID0gZgogICAgfQogIH0pOwoKICB2YXIgZ2V0S2V5UHJlc3NlZCA9IGZ1bmN0aW9uKCkgewogICAgdmFyIGkgPSAwOwogICAgaWYgKGQzLmV2ZW50LnNvdXJjZUV2ZW50LnNoaWZ0S2V5KQogICAgICBpIHw9IEtFWVBSRVNTRURfU0hJRlQ7CgogICAgaWYgKGQzLmV2ZW50LnNvdXJjZUV2ZW50LmFsdEtleSkKICAgICAgaSB8PSBLRVlQUkVTU0VEX0FMVDsKICAgIHJldHVybiBpCiAgfQogIHJldHVybiBDb21tb25XaWRnZXRWaWV3Owp9KTsKCgovKioKICogdXRpbGl0eSBtZXRob2QgdGhhdCB3aWxsIGFwcGx5IGEgcmVndWxhciBleHByZXNzaW9uIG9udG8gYSBzdHJpbmcsIGFzc3VtaW5nIHRoYXQgYWxsIGFsIHRoZSBzdHJpbmcgaXMgY2FwdGlyZWQgYnkgdGhlIHJlZyBleHAgKG5vIGhvbGVzKQogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KCmRlZmluZSgnZmlzaHRvbmVzL3V0aWxzL1JlZ0V4cEZ1bGxTcGxpdGVyJyxbJ3VuZGVyc2NvcmUnXSwgZnVuY3Rpb24gKF8pIHsKICAgIFJlZ0V4cEZ1bGxTcGxpdGVyID0gZnVuY3Rpb24gKG9wdGlvbnMpIHsKCiAgICB9CiAgICAvKioKICAgICAqIGFsbCBtYXRjaCBjYXRwdXJlIGJ5IHRoZSByZWdleHAgYXJlIHJldHVybmVkIGluIGFuIGFycmF5LAogICAgICogSWYgc29tZSBwaWVjZSBvZiB0aGUgc3RyaW5nIGlzIG5vdCBjb3ZlcmVkLCB0aGVuIGFuIEV4Y2VwdGlvbiBpcyB0aHJvd24KICAgICAqIHJlZ2V4cCBpcyBkdXBsaWNhdGUgdG8gYXZvaWQgc3luYyBwcm9ibGVtIG9uIGxhc3RJbmRleE9mIGFuZCB0aGlzIGtpbmQgb2YgdGhpbmdzLi4uCiAgICAgKiBAcGFyYW0ge09iamVjdH0gcmVnZXhwIGlzIGEgc3RyaW5nIG9yIHJlZ2V4cAogICAgICogQHBhcmFtIHtPYmplY3R9IHN0cgogICAgICovCiAgICBSZWdFeHBGdWxsU3BsaXRlci5wcm90b3R5cGUuc3BsaXQgPSBmdW5jdGlvbiAocmVnZXhwLCBzdHIpIHsKICAgICAgICB2YXIgcmV0ID0gW10KCiAgICAgICAgdmFyIHJlCiAgICAgICAgaWYgKHJlZ2V4cCBpbnN0YW5jZW9mIFJlZ0V4cCkgewogICAgICAgICAgICByZSA9IG5ldyBSZWdFeHAocmVnZXhwLnNvdXJjZSwgJ2cnKQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJlID0gbmV3IFJlZ0V4cChyZWdleHAsICdnJykKICAgICAgICB9CiAgICAgICAgcmUuZ2xvYmFsID0gdHJ1ZQoKICAgICAgICB2YXIgcG9zTWF0Y2ggPSAwCiAgICAgICAgd2hpbGUgKG0gPSByZS5leGVjKHN0cikpIHsKICAgICAgICAgICAgaWYgKG0uaW5kZXggIT0gcG9zTWF0Y2gpIHsKICAgICAgICAgICAgICAgIHRocm93IHsKICAgICAgICAgICAgICAgICAgICBuYW1lOiAnUmVnZXhwRnVsbFNlcXVlbmNlQ292ZXJhZ2UnLAogICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdjYW5ub3QgY2hhcmFjdGVyIGF0IHBvcyBbJyArIHBvc01hdGNoICsgJy0nICsgbS5pbmRleCArICddICgnICsgc3RyLnN1YnN0cmluZyhwb3NNYXRjaCwgbS5pbmRleCkgKyAnKSBpbiAiJyArIHN0ciArICciIGlzIG5vdCBjb3ZlcmVkIGJ5IHJlZ3VsYXIgZXhwcmVzc2lvbiAnICsgcmUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBwb3NNYXRjaCA9IHJlLmxhc3RJbmRleDsKCiAgICAgICAgICAgIHJldC5wdXNoKG0pCiAgICAgICAgfQogICAgICAgIGlmIChzdHIubGVuZ3RoICE9IHBvc01hdGNoKSB7CiAgICAgICAgICAgIHRocm93IHsKICAgICAgICAgICAgICAgIG5hbWU6ICdSZWdleHBGdWxsU2VxdWVuY2VDb3ZlcmFnZScsCiAgICAgICAgICAgICAgICBtZXNzYWdlOiAnY2Fubm90IGNoYXJhY3RlciBhdCBwb3MgWycgKyBwb3NNYXRjaCArICctJyArIG0uaW5kZXggKyAnXSAoJyArIHN0ci5zdWJzdHJpbmcocG9zTWF0Y2gsIG0uaW5kZXgpICsgJykgaW4gIicgKyBzdHIgKyAnIiBpcyBub3QgY292ZXJlZCBieSByZWd1bGFyIGV4cHJlc3Npb24gJyArIHJlCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJldAogICAgfQoKICAgIHJldHVybiBSZWdFeHBGdWxsU3BsaXRlcgp9KTsKCi8qCiAqIEFtaW5vQWNpZCBvYmplY3QuCiAgKiBQcm9wZXJ0aWVzOgogICogLSBhIGNvZGUxIChvbmUgbGV0dGVyKSwKICAqIC0gYSBtYXNzLgogICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCmRlZmluZSgnZmlzaHRvbmVzL21vZGVscy9kcnkvQW1pbm9BY2lkJyxbJ0JhY2tib25lJ10sIGZ1bmN0aW9uKEJhY2tib25lKSB7CgogICAgdmFyIEFtaW5vQWNpZCA9IEJhY2tib25lLk1vZGVsLmV4dGVuZCh7CiAgICAgICAgaWRBdHRyaWJ1dGUgOiAnY29kZTEnLAogICAgICAgIGRlZmF1bHRzIDogewogICAgICAgICAgICBtYXNzIDogLTEKICAgICAgICB9LAogICAgICAgIGluaXRpYWxpemUgOiBmdW5jdGlvbigpIHsKICAgICAgICB9LAogICAgICAgIHRvU3RyaW5nIDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgcmV0dXJuIHNlbGYuZ2V0KCdjb2RlMScpOwogICAgICAgIH0KICAgIH0pOwoKICAgIHJldHVybiBBbWlub0FjaWQ7Cn0pOwoKLyoKICogYW1pbm8gYWNpZCBkZWZpbml0aW9uLCBsb2FkZWQgYnkgY29sbGVjdGlvbnMvZHJ5L0FtaW5vQWNpZGljdGlvbmFyeQogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KCmRlZmluZSgnZmlzaHRvbmVzL2RhdGEvYW1pbm9BY2lkcycsW10sZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gW3sKICAgICAgICBjb2RlMSA6ICJBIiwKICAgICAgICAibWFzcyIgOiA3MS4wMzcxMTQKICAgIH0sIHsKICAgICAgICAiY29kZTEiIDogIlIiLAogICAgICAgICJtYXNzIiA6IDE1Ni4xMDExMTEKICAgIH0sIHsKICAgICAgICAiY29kZTEiIDogIk4iLAogICAgICAgICJtYXNzIiA6IDExNC4wNDI5MjcKICAgIH0sIHsKICAgICAgICAiY29kZTEiIDogIkQiLAogICAgICAgICJtYXNzIiA6IDExNS4wMjY5NDMKICAgIH0sIHsKICAgICAgICAiY29kZTEiIDogIkMiLAogICAgICAgICJtYXNzIiA6IDEwMy4wMDkxODUKICAgIH0sIHsKICAgICAgICAiY29kZTEiIDogIkUiLAogICAgICAgICJtYXNzIiA6IDEyOS4wNDI1OTMKICAgIH0sIHsKICAgICAgICAiY29kZTEiIDogIlEiLAogICAgICAgICJtYXNzIiA6IDEyOC4wNTg1NzgKICAgIH0sIHsKICAgICAgICAiY29kZTEiIDogIkciLAogICAgICAgICJtYXNzIiA6IDU3LjAyMTQ2NAogICAgfSwgewogICAgICAgICJjb2RlMSIgOiAiSCIsCiAgICAgICAgIm1hc3MiIDogMTM3LjA1ODkxMgogICAgfSwgewogICAgICAgICJjb2RlMSIgOiAiSSIsCiAgICAgICAgIm1hc3MiIDogMTEzLjA4NDA2NAogICAgfSwgewogICAgICAgICJjb2RlMSIgOiAiTCIsCiAgICAgICAgIm1hc3MiIDogMTEzLjA4NDA2NAogICAgfSwgewogICAgICAgICJjb2RlMSIgOiAiSyIsCiAgICAgICAgIm1hc3MiIDogMTI4LjA5NDk2MwogICAgfSwgewogICAgICAgICJjb2RlMSIgOiAiTSIsCiAgICAgICAgIm1hc3MiIDogMTMxLjA0MDQ4NQogICAgfSwgewogICAgICAgICJjb2RlMSIgOiAiRiIsCiAgICAgICAgIm1hc3MiIDogMTQ3LjA2ODQxNAogICAgfSwgewogICAgICAgICJjb2RlMSIgOiAiUCIsCiAgICAgICAgIm1hc3MiIDogOTcuMDUyNzY0CiAgICB9LCB7CiAgICAgICAgImNvZGUxIiA6ICJTIiwKICAgICAgICAibWFzcyIgOiA4Ny4wMzIwMjgKICAgIH0sIHsKICAgICAgICAiY29kZTEiIDogIlQiLAogICAgICAgICJtYXNzIiA6IDEwMS4wNDc2NzkKICAgIH0sIHsKICAgICAgICAiY29kZTEiIDogIlciLAogICAgICAgICJtYXNzIiA6IDE4Ni4wNzkzMTMKICAgIH0sIHsKICAgICAgICAiY29kZTEiIDogIlkiLAogICAgICAgICJtYXNzIiA6IDE2My4wNjMzMgogICAgfSwgewogICAgICAgICJjb2RlMSIgOiAiViIsCiAgICAgICAgIm1hc3MiIDogOTkuMDY4NDE0CiAgICB9XQp9KTsKCi8qCiAqIEEgc2luZ2xldG9uIGFtaW5vIGFjaWQgZGljdGlvbmFyeSwgbG9hZGVkIGZyb20ganNvbiBmaWwgZGF0YS9hbWlub0FjaWQuanMKICogCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwoKZGVmaW5lKCdmaXNodG9uZXMvY29sbGVjdGlvbnMvZHJ5L0FtaW5vQWNpZERpY3Rpb25hcnknLFsnZmlzaHRvbmVzL21vZGVscy9kcnkvQW1pbm9BY2lkJywgJ2Zpc2h0b25lcy9kYXRhL2FtaW5vQWNpZHMnXSwgZnVuY3Rpb24oQW1pbm9BY2lkLCBic19hbWlub2FjaWRzKSB7CiAgICB2YXIgQW1pbm9BY2lkRGljdGlvbmFyeSA9IEJhY2tib25lLkNvbGxlY3Rpb24uZXh0ZW5kKHsKCiAgICAgICAgbW9kZWwgOiBBbWlub0FjaWQsCiAgICAgICAgZGVmYXVsdHMgOiB7CiAgICAgICAgfSwKICAgICAgICBpbml0aWFsaXplIDogZnVuY3Rpb24ob3B0aW9ucykgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHNlbGYuYWRkKGJzX2FtaW5vYWNpZHMpOwogICAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIG5ldyBBbWlub0FjaWREaWN0aW9uYXJ5KCk7Cn0pOwoKLyoKICogQSBSZXNpZHVlTW9kaWZpY2F0aW9uIFBPSk8sIHdpaHQgcHJvcGVydGllcwogKiAgLSBuYW1lICh1bmlxdWUgYWNyb3NzIHRoZSBkaWN0aW9uYXJ5CiAqICAtIG1hc3MKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCgpkZWZpbmUoJ2Zpc2h0b25lcy9tb2RlbHMvZHJ5L1Jlc2lkdWVNb2RpZmljYXRpb24nLFsnanF1ZXJ5JywgJ3VuZGVyc2NvcmUnLCAnQmFja2JvbmUnXSwgZnVuY3Rpb24oJCwgXywgQmFja2JvbmUpIHsKCiAgICB2YXIgUmVzaWR1ZU1vZGlmaWNhdGlvbiA9IEJhY2tib25lLk1vZGVsLmV4dGVuZCh7CiAgICAgICAgaWRBdHRyaWJ1dGU6J25hbWUnLAogICAgICAgIGRlZmF1bHRzIDogewogICAgICAgICAgICBtYXNzIDogLTEKICAgICAgICB9LAogICAgICAgIGluaXRpYWxpemUgOiBmdW5jdGlvbigpIHsKICAgICAgICB9LAogICAgICAgIHRvU3RyaW5nIDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgcmV0dXJuIHNlbGYuZ2V0KCduYW1lJykgKyAnKCcrc2VsZi5nZXQoJ21hc3MnKSsnKSc7CiAgICAgICAgfQogICAgfSk7CgogICAgcmV0dXJuIFJlc2lkdWVNb2RpZmljYXRpb247Cn0pOwoKLyoKICogYSBqc29uIHBvcnQgb2YgVW5pbW9kICsgc29tZSBjdXN0b20gbW9kaWZzLgogKiBsb2FkZWQgYnkgY29sbGVjdGlvbnMvZHJ5L1Jlc2lkdWVNb2RpZmljYXRpb25EaWN0aW9uYXJ5CiAqCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwoKZGVmaW5lKCdmaXNodG9uZXMvZGF0YS9yZXNpZHVlTW9kaWZpY2F0aW9ucycsW10sZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIFsKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlBJQyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQSUMiLAogICAgICAgICAgICAibWFzcyI6IDExOS4wMzcxMTQsCiAgICAgICAgICAgIGZvcm11bGE6ICdDN09OSDUnCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlBJQ19IRUFWWSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQSUNfSEVBVlkiLAogICAgICAgICAgICAibWFzcyI6IDEyNS4wNTcyNDI5OCwKICAgICAgICAgICAgZm9ybXVsYTogJ0M3T05INScKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiMTNDMTVOLUEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiMTNDMTVOLUEiLAogICAgICAgICAgICAibWFzcyI6IDQuMDA3MDk5NDA2NiwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiMTNDMTVOLUMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiMTNDMTVOLUMiLAogICAgICAgICAgICAibWFzcyI6IDQuMDA3MDk5NDA2NiwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiMTNDMTVOLUQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiMTNDMTVOLUQiLAogICAgICAgICAgICAibWFzcyI6IDUuMDEwNDU0MjQ0NCwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiMTNDMTVOLUUiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiMTNDMTVOLUUiLAogICAgICAgICAgICAibWFzcyI6IDYuMDEzODA5MDgyMiwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiMTNDMTVOLUYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiMTNDMTVOLUYiLAogICAgICAgICAgICAibWFzcyI6IDEwLjAyNzIyODQzMzQsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIjEzQzE1Ti0iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiMTNDMTVOLSIsCiAgICAgICAgICAgICJtYXNzIjogMy4wMDM3NDQ1Njg4LAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICIxM0MxNU4tSCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICIxM0MxNU4tSCIsCiAgICAgICAgICAgICJtYXNzIjogOS4wMTEyMzM3MDY0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIjEzQzE1Ti1JIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIjEzQzE1Ti1JIiwKICAgICAgICAgICAgIm1hc3MiOiA3LjAxNzE2MzkyCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIjEzQzE1Ti1LIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIjEzQzE1Ti1LIiwKICAgICAgICAgICAgIm1hc3MiOiA4LjAxNDE5ODgxMzIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiMTNDMTVOLUwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiMTNDMTVOLUwiLAogICAgICAgICAgICAibWFzcyI6IDcuMDE3MTYzOTIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiMTNDMTVOLU0iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiMTNDMTVOLU0iLAogICAgICAgICAgICAibWFzcyI6IDYuMDEzODA5MDgyMgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICIxM0MxNU4tTiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICIxM0MxNU4tTiIsCiAgICAgICAgICAgICJtYXNzIjogNi4wMDc0ODkxMzc2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIjEzQzE1Ti1QIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIjEzQzE1Ti1QIiwKICAgICAgICAgICAgIm1hc3MiOiA2LjAxMzgwOTA4MjIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiMTNDMTVOLVEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiMTNDMTVOLVEiLAogICAgICAgICAgICAibWFzcyI6IDcuMDEwODQzOTc1NAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICIxM0MxNU4tUiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICIxM0MxNU4tUiIsCiAgICAgICAgICAgICJtYXNzIjogMTAuMDA4MjY4NTk5NgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICIxM0MxNU4tUyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICIxM0MxNU4tUyIsCiAgICAgICAgICAgICJtYXNzIjogNC4wMDcwOTk0MDY2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIjEzQzE1Ti1UIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIjEzQzE1Ti1UIiwKICAgICAgICAgICAgIm1hc3MiOiA1LjAxMDQ1NDI0NDQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiMTNDMTVOLVYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiMTNDMTVOLVYiLAogICAgICAgICAgICAibWFzcyI6IDYuMDEzODA5MDgyMgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICIxM0MxNU4tVyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICIxM0MxNU4tVyIsCiAgICAgICAgICAgICJtYXNzIjogMTMuMDMwOTczMDAyMgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICIxM0MxNU4tWSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICIxM0MxNU4tWSIsCiAgICAgICAgICAgICJtYXNzIjogMTAuMDI3MjI4NDMzNAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJBY2V0eWwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQWNldHlsYXRpb24iLAogICAgICAgICAgICAibWFzcyI6IDQyLjAxMDU2NQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJBbWlkYXRlZCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBbWlkYXRpb24iLAogICAgICAgICAgICAibWFzcyI6IC0wLjk4NDAxNgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJCaW90aW4iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQmlvdGlueWxhdGlvbiIsCiAgICAgICAgICAgICJtYXNzIjogMjI2LjA3NzU5OAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJDYXJiYW1pZG9tZXRoeWwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSW9kb2FjZXRhbWlkZSBkZXJpdmF0aXZlIiwKICAgICAgICAgICAgIm1hc3MiOiA1Ny4wMjE0NjQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQ2FyYmFteWwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQ2FyYmFteWxhdGlvbiIsCiAgICAgICAgICAgICJtYXNzIjogNDMuMDA1ODE0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkNhcmJveHltZXRoeWwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSW9kb2FjZXRpYyBhY2lkIGRlcml2YXRpdmUiLAogICAgICAgICAgICAibWFzcyI6IDU4LjAwNTQ3OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJEZWFtaWRhdGVkIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkRlYW1pZGF0aW9uIiwKICAgICAgICAgICAgIm1hc3MiOiAwLjk4NDAxNgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJNZXQtPkhzZSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJIb21vc2VyaW5lIiwKICAgICAgICAgICAgIm1hc3MiOiAtMjkuOTkyODA2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk1ldC0+SHNsIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkhvbW9zZXJpbmUgbGFjdG9uZSIsCiAgICAgICAgICAgICJtYXNzIjogLTQ4LjAwMzM3MQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJOSVBDQU0iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTi1pc29wcm9weWxjYXJib3hhbWlkb21ldGh5bCIsCiAgICAgICAgICAgICJtYXNzIjogOTkuMDY4NDE0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlBob3NwaG8iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUGhvc3Bob3J5bGF0aW9uIiwKICAgICAgICAgICAgIm1hc3MiOiA3OS45NjYzMzEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRGVoeWRyYXRlZCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJEZWh5ZHJhdGlvbiIsCiAgICAgICAgICAgICJtYXNzIjogLTE4LjAxMDU2NQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJQcm9waW9uYW1pZGUiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQWNyeWxhbWlkZSBhZGR1Y3QiLAogICAgICAgICAgICAibWFzcyI6IDcxLjAzNzExNAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJQeXJvLWNhcmJhbWlkb21ldGh5bCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJTLWNhcmJhbW95bG1ldGh5bGN5c3RlaW5lIGN5Y2xpemF0aW9uIChOLXRlcm1pbnVzKSIsCiAgICAgICAgICAgICJtYXNzIjogMzkuOTk0OTE1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkdsdS0+cHlyby1HbHUiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUHlyby1nbHUgZnJvbSBFIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTguMDEwNTY1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkdsbi0+cHlyby1HbHUiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUHlyby1nbHUgZnJvbSBRIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTcuMDI2NTQ5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkNhdGlvbjpOYSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJTb2RpdW0gYWRkdWN0IiwKICAgICAgICAgICAgIm1hc3MiOiAyMS45ODE5NDMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUHlyaWR5bGV0aHlsIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlMtcHlyaWR5bGV0aHlsYXRpb24iLAogICAgICAgICAgICAibWFzcyI6IDEwNS4wNTc4NDkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTWV0aHlsIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIk1ldGh5bGF0aW9uIiwKICAgICAgICAgICAgIm1hc3MiOiAxNC4wMTU2NQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJPeGlkYXRpb24iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiT3hpZGF0aW9uIG9yIEh5ZHJveHlsYXRpb24iLAogICAgICAgICAgICAibWFzcyI6IDE1Ljk5NDkxNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJEaW1ldGh5bCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJkaS1NZXRoeWxhdGlvbiIsCiAgICAgICAgICAgICJtYXNzIjogMjguMDMxMwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJUcmltZXRoeWwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAidHJpLU1ldGh5bGF0aW9uIiwKICAgICAgICAgICAgIm1hc3MiOiA0Mi4wNDY5NQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJNZXRoeWx0aGlvIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkJldGEtbWV0aHlsdGhpb2xhdGlvbiIsCiAgICAgICAgICAgICJtYXNzIjogNDUuOTg3NzIxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlN1bGZvIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIk8tU3VsZm9uYXRpb24iLAogICAgICAgICAgICAibWFzcyI6IDc5Ljk1NjgxNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJIZXgiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSGV4b3NlIiwKICAgICAgICAgICAgIm1hc3MiOiAxNjIuMDUyODIzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkhleE5BYyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJOLUFjZXR5bGhleG9zYW1pbmUiLAogICAgICAgICAgICAibWFzcyI6IDIwMy4wNzkzNzMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTXlyaXN0b3lsIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIk15cmlzdG95bGF0aW9uIiwKICAgICAgICAgICAgIm1hc3MiOiAyMTAuMTk4MzY2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkd1YW5pZGlueWwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR3VhbmlkaW5hdGlvbiIsCiAgICAgICAgICAgICJtYXNzIjogNDIuMDIxNzk4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlByb3Bpb255bCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQcm9waW9uYXRlIGxhYmVsaW5nIHJlYWdlbnQgbGlnaHQgZm9ybSAoTi10ZXJtICYgSykiLAogICAgICAgICAgICAibWFzcyI6IDU2LjAyNjIxNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJQcm8tPnB5cm8tR2x1IiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogInByb2xpbmUgb3hpZGF0aW9uIHRvIHB5cm9nbHV0YW1pYyBhY2lkIiwKICAgICAgICAgICAgIm1hc3MiOiAxMy45NzkyNjUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTkhTLUxDLUJpb3RpbiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJOSFMtTEMtQmlvdGluIiwKICAgICAgICAgICAgIm1hc3MiOiAzMzkuMTYxNjYyCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIklDQVQtQyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBcHBsaWVkIEJpb3N5c3RlbXMgY2xlYXZhYmxlIElDQVQoVE0pIGxpZ2h0IiwKICAgICAgICAgICAgIm1hc3MiOiAyMjcuMTI2OTkxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIklDQVQtQzoxM0MoOSkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXBwbGllZCBCaW9zeXN0ZW1zIGNsZWF2YWJsZSBJQ0FUKFRNKSBoZWF2eSIsCiAgICAgICAgICAgICJtYXNzIjogMjM2LjE1NzE4NQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJOZXRoeWxtYWxlaW1pZGUiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTi1ldGh5bG1hbGVpbWlkZSBvbiBjeXN0ZWluZXMiLAogICAgICAgICAgICAibWFzcyI6IDEyNS4wNDc2NzkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiR2x5R2x5IiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogInViaXF1aXRpbnlsYXRpb24gcmVzaWR1ZSIsCiAgICAgICAgICAgICJtYXNzIjogMTE0LjA0MjkyNwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJGb3JteWwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiRm9ybXlsYXRpb24iLAogICAgICAgICAgICAibWFzcyI6IDI3Ljk5NDkxNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJIZXgoMSlIZXhOQWMoMSlOZXVBYygyKSAoU1QpIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkhleDFIZXhOQWMxTmV1QWMyIChTVCkiLAogICAgICAgICAgICAibWFzcyI6IDk0Ny4zMjMwMjkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRGltZXRoeWw6MkgoNikxM0MoMikiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiZGltZXRoeWxhdGVkIGFyZ2luaW5lIiwKICAgICAgICAgICAgIm1hc3MiOiAzNi4wNzU2NwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJEZWx0YTpIKDQpQygyKU8oLTEpUygxKSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJTLUV0aHlsY3lzdGluZSBmcm9tIFNlcmluZSIsCiAgICAgICAgICAgICJtYXNzIjogNDQuMDA4NDU2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkxhYmVsOjEzQyg2KSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICIxM0MoNikgU2lsYWMgbGFiZWwiLAogICAgICAgICAgICAibWFzcyI6IDYuMDIwMTI5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkxhYmVsOjE4TygyKSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJPMTggbGFiZWwgYXQgYm90aCBDLXRlcm1pbmFsIG94eWdlbnMiLAogICAgICAgICAgICAibWFzcyI6IDQuMDA4NDkxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogImlUUkFRNHBsZXgiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUmVwcmVzZW50YXRpdmUgbWFzcyBhbmQgYWNjdXJhdGUgbWFzcyBmb3IgMTE2ICYgMTE3IiwKICAgICAgICAgICAgIm1hc3MiOiAxNDQuMTAyMDYzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkxhYmVsOjE4TygxKSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJPMTggTGFiZWxpbmciLAogICAgICAgICAgICAibWFzcyI6IDIuMDA0MjQ2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkxhYmVsOjEzQyg2KTE1TigyKSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICIxM0MoNikgMTVOKDIpIFNpbGFjIGxhYmVsIiwKICAgICAgICAgICAgIm1hc3MiOiA4LjAxNDE5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJMYWJlbDoxM0MoNikxNU4oNCkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiMTNDKDYpIDE1Tig0KSBTaWxhYyBsYWJlbCIsCiAgICAgICAgICAgICJtYXNzIjogMTAuMDA4MjY5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkxhYmVsOjEzQyg5KTE1TigxKSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICIxM0MoOSkgMTVOKDEpIFNpbGFjIGxhYmVsIiwKICAgICAgICAgICAgIm1hc3MiOiAxMC4wMjcyMjgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTGFiZWw6MTNDKDUpMTVOKDEpIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIjEzQyg1KSAxNU4oMSkgU2lsYWMgbGFiZWwiLAogICAgICAgICAgICAibWFzcyI6IDYuMDEzODA5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk5pdHJvc3lsIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlMtbml0cm9zeWxhdGlvbiIsCiAgICAgICAgICAgICJtYXNzIjogMjguOTkwMTY0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkFFQlMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQW1pbm9ldGh5bGJlbnplbmVzdWxmb255bGF0aW9uIiwKICAgICAgICAgICAgIm1hc3MiOiAxODMuMDM1Mzk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkV0aGFub2x5bCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJFdGhhbm9sYXRpb24gb2YgQ3lzIiwKICAgICAgICAgICAgIm1hc3MiOiA0NC4wMjYyMTUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRXRoeWwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiRXRoeWxhdGlvbiIsCiAgICAgICAgICAgICJtYXNzIjogMjguMDMxMwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJDYXJib3h5IiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkNhcmJveHlsYXRpb24iLAogICAgICAgICAgICAibWFzcyI6IDQzLjk4OTgyOQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJOZXRoeWxtYWxlaW1pZGUrd2F0ZXIiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTmV0aHlsbWFsZWltaWRlaHlkcm9seXNpcyIsCiAgICAgICAgICAgICJtYXNzIjogMTQzLjA1ODI0MwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJJQ1BMOjEzQyg2KSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJCcnVrZXIgRGFsdG9uaWNzIFNFUlZBLUlDUEwoVE0pIHF1YW50aWZpY2F0aW9uIGNoZW1pc3RyeSwgaGVhdnkgZm9ybSIsCiAgICAgICAgICAgICJtYXNzIjogMTExLjA0MTU5MwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJJQ1BMIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkJydWtlciBEYWx0b25pY3MgU0VSVkEtSUNQTChUTSkgcXVhbnRpZmljYXRpb24gY2hlbWlzdHJ5LCBsaWdodCBmb3JtIiwKICAgICAgICAgICAgIm1hc3MiOiAxMDUuMDIxNDY0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkRlaHlkcm8iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSGFsZiBvZiBhIGRpc3VsZmlkZSBicmlkZ2UiLAogICAgICAgICAgICAibWFzcyI6IC0xLjAwNzgyNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJIeXB1c2luZSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJoeXB1c2luZSIsCiAgICAgICAgICAgICJtYXNzIjogODcuMDY4NDE0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkFtbW9uaWEtbG9zcyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMb3NzIG9mIGFtbW9uaWEiLAogICAgICAgICAgICAibWFzcyI6IC0xNy4wMjY1NDkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiR2x1Y29zeWxnYWxhY3Rvc3lsIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogImdsdWNvc3lsZ2FsYWN0b3N5bCBoeWRyb3h5bHlzaW5lIiwKICAgICAgICAgICAgIm1hc3MiOiAzNDAuMTAwNTYyCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkRpb3hpZGF0aW9uIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogImRpaHlkcm94eSIsCiAgICAgICAgICAgICJtYXNzIjogMzEuOTg5ODI5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkhleE4iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSGV4b3NhbWluZSIsCiAgICAgICAgICAgICJtYXNzIjogMTYxLjA2ODgwOAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJMYWJlbDoySCg0KSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICI0LDQsNSw1LUQ0IEx5c2luZSIsCiAgICAgICAgICAgICJtYXNzIjogNC4wMjUxMDcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRGltZXRoeWw6MkgoNCkxM0MoMikiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiRGlNZXRoeWwtQzEzSEQyIiwKICAgICAgICAgICAgIm1hc3MiOiAzNC4wNjMxMTcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTWFsZWltaWRlLVBFTzItQmlvdGluIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIk1hbGVpbWlkZS1QRU8yLUJpb3RpbiIsCiAgICAgICAgICAgICJtYXNzIjogNTI1LjIyNTcxOQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJBbGEtPlNlciIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBbGEtPlNlciBzdWJzdGl0dXRpb24iLAogICAgICAgICAgICAibWFzcyI6IDE1Ljk5NDkxNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJUaHItPklsZSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUaHItPklsZSBzdWJzdGl0dXRpb24iLAogICAgICAgICAgICAibWFzcyI6IDEyLjAzNjM4NgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJJQ1BMOjJIKDQpIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkJydWtlciBEYWx0b25pY3MgU0VSVkEtSUNQTChUTSkgcXVhbnRpZmljYXRpb24gY2hlbWlzdHJ5LCBtZWRpdW0gZm9ybSIsCiAgICAgICAgICAgICJtYXNzIjogMTA5LjA0NjU3MQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJpVFJBUThwbGV4IiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlJlcHJlc2VudGF0aXZlIG1hc3MgYW5kIGFjY3VyYXRlIG1hc3MgZm9yIDExMywgMTE0LCAxMTYgJiAxMTciLAogICAgICAgICAgICAibWFzcyI6IDMwNC4yMDUzNgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJMYWJlbDoxM0MoNikxNU4oMSkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiMTNDKDYpIDE1TigxKSBTaWxhYyBsYWJlbCIsCiAgICAgICAgICAgICJtYXNzIjogNy4wMTcxNjQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVE1UNnBsZXgiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiIiwKICAgICAgICAgICAgIm1hc3MiOiAyMjkuMTYyOTMyCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlRNVDJwbGV4IiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRNVDJwbGV4IGJ5IFRoZXJtbyIsCiAgICAgICAgICAgICJtYXNzIjogMjI1LjE1NTgzMwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJUTVQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiIiwKICAgICAgICAgICAgIm1hc3MiOiAyMjQuMTUyNDc4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkV4YWNUYWdUaGlvbCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJFeGFjVGFnIFRoaW9sIGxhYmVsIG1hc3MgZm9yIDItNC03LTEwIHBsZXgiLAogICAgICAgICAgICAibWFzcyI6IDk3Mi4zNjUyMTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRXhhY1RhZ0FtaW5lIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkV4YWNUYWcgQW1pbmUgbGFiZWwgbWFzcyBmb3IgMi00LTctMTAgcGxleCIsCiAgICAgICAgICAgICJtYXNzIjogMTAzMC4zNTI5NAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJBcmdHbHlHbHkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVWJpcXVpdGluYXRpb24gUkdHIiwKICAgICAgICAgICAgIm1hc3MiOiAyNzAuMTQ0MDM5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlN1bGZvLU5IUy1TUy1CaW90aW4iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiRVotTGluayBTdWxmby1OSFMtU1MtQmlvdGluIChQaWVyY2UpIiwKICAgICAgICAgICAgIm1hc3MiOiAzODkuMDkwMTU0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkJQQSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJCZW56b3lhbCBQaGVueWxhbGFuaW5lIiwKICAgICAgICAgICAgIm1hc3MiOiAyNjguMDk3MzY4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkJQQV9BSUxWIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkJlbnpveWFsIFBoZW55bGFsYW5pbmUgQUlMViIsCiAgICAgICAgICAgICJtYXNzIjogMjY4LjA5NzM2OAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJCUEFfU1RETiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJCZW56b3lhbCBQaGVueWxhbGFuaW5lIFNURE4iLAogICAgICAgICAgICAibWFzcyI6IDI2OC4wOTczNjgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQlBBX1BXWUYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQmVuem95YWwgUGhlbnlsYWxhbmluZSBQV1lGIiwKICAgICAgICAgICAgIm1hc3MiOiAyNjguMDk3MzY4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkJQQV9SRUNRIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkJlbnpveWFsIFBoZW55bGFsYW5pbmUgUkVDUSIsCiAgICAgICAgICAgICJtYXNzIjogMjY4LjA5NzM2OAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJCUEFfR0hLTSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJCZW56b3lhbCBQaGVueWxhbGFuaW5lIEdIS00iLAogICAgICAgICAgICAibWFzcyI6IDI2OC4wOTczNjgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiU01DQyBsaW5rZXIiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiU3VjY2luaW1pZHlsLTQtKE4tbWFsZWltaWRvbWV0aHlsKWN5Y2xvaGV4YW5lLTEtY2FyYm94eWxhdGUiLAogICAgICAgICAgICAibWFzcyI6IDIxOS4wODk1NDMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQ0hEIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIjEsMi1DeWNsb2hleGFuZWRpb25lIGFyZ2luaW5lIiwKICAgICAgICAgICAgIm1hc3MiOiAxMTIuMDUyNDMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQkQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiMSwyLUJ1dGFuZWRpb25lIGFyZ2luaW5lIiwKICAgICAgICAgICAgIm1hc3MiOiA4Ni4wMzY3NzkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSEEtVWJpcXVpdGluIFZpbnlsIFN1bGZvbmUiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSEEtVWJpcXVpdGluIFZpbnlsIFN1bGZvbmUiLAogICAgICAgICAgICAibWFzcyI6IDEyMC4wMTE5MjQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSEEtR2x5LVViaXF1aXRpbiBWaW55bCBTdWxmb25lIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkhBLUdseWN5bC1VYmlxdWl0aW4gVmlueWwgU3VsZm9uZSIsCiAgICAgICAgICAgICJtYXNzIjogMTc3LjAzMzM4OAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJDYXJiYW1pZG9tZXRoeWwtRGV1dGVyYXRlZCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJEZXV0ZXJhdGVkIElvZG9hY2V0YW1pZGUgRGVyaXZhdGl2ZSIsCiAgICAgICAgICAgICJtYXNzIjogNTkuMDM0MDE3CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlJHR1ViaXEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVWJpcXVpdGluYXRpb24gUkdHIC0gQXJnR2x5R2x5IiwKICAgICAgICAgICAgIm1hc3MiOiAyNzAuMTQ0MDM5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogImlvZG9hY2V0YW5pbGlkZSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJpb2RvYWNldGFuaWxpZGUiLAogICAgICAgICAgICAibWFzcyI6IDEzOS4wNzI4OTMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAicHJvcHlsbWVyY2FwdG8iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAicHJvcHlsbWVyY2FwdG8gLyBwcm9wYW5ldGhpb2wiLAogICAgICAgICAgICAibWFzcyI6IDU4LjAyNDEwNgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJHbHlHbHkgMTNDKDYpIDE1TigyKSBMeXMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiRG91YmxlIG1vZGlmaWNhdGlvbiBvZiBVYmlxdWl0aW4gYW5kIEx5cys4LjAyIiwKICAgICAgICAgICAgIm1hc3MiOiAxMjIuMDU3MTI2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlJFUExpLUROUCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJETlAgRnJldCBtb2RpZmljYXRpb24gZm9yIFJFUExpIHByb2plY3QiLAogICAgICAgICAgICAibWFzcyI6IDI1Mi4wNDk0NjkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUkVQTGktTUNBLUgiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUkVQTGktTUNBIEMxMkg4TzQiLAogICAgICAgICAgICAibWFzcyI6IDIxNi4wNDIyNTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUVFRVEdHIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlNVTU8gTHlzLVFRUVRHRyIsCiAgICAgICAgICAgICJtYXNzIjogNTk5LjI2NjMzOQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJJQ1BMOjEzQyg2KTJIKDQpIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkJydWtlciBEYWx0b25pY3MgU0VSVkEtSUNQTChUTSkgcXVhbnRpZmljYXRpb24gY2hlbWlzdHJ5LCBoZWF2eSBmb3JtLCArMTAgIHl1azMgMS0zMS0yMDExIiwKICAgICAgICAgICAgIm1hc3MiOiAxMTUuMDY2NwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJtVFJBUSBkMCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJtVFJBUSByYWdlbnQgYnkgQUIgU0NJRVgsIGRlbHRhIDAgZm9ybSIsCiAgICAgICAgICAgICJtYXNzIjogMTQwLjA5NDk2MwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJtVFJBUSBkNCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJtVFJBUSByYWdlbnQgYnkgQUIgU0NJRVgsIGRlbHRhICs0IGZvcm0iLAogICAgICAgICAgICAibWFzcyI6IDE0NC4xMDIwNjMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAibVRSQVEgZDgiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAibVRSQVEgcmFnZW50IGJ5IEFCIFNDSUVYLCBkZWx0YSArOCBmb3JtIiwKICAgICAgICAgICAgIm1hc3MiOiAxNDguMTA5MTYyCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkhleCgxKUhleE5BYygxKSAoU1QpIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkhleDFIZXhOQWMxIChTVCkiLAogICAgICAgICAgICAibWFzcyI6IDM2NS4xMzIxOTYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSGV4KDEpSGV4TkFjKDEpTmV1QWMoMSkgKFNUKSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJIZXgxSGV4TkFjMU5ldUFjMSAoU1QpIiwKICAgICAgICAgICAgIm1hc3MiOiA2NTYuMjI3NjEzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlRNVC1MeXNHbHlHbHkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVE1UIHdpdGggVWJpcXVpdGluIChHbHlHbHkpIG1vZGlmaWNhdGlvbiBvbiBzYW1lIHJlc2lkdWUiLAogICAgICAgICAgICAibWFzcyI6IDMzOC4xOTU0MDUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVE1UNi1MeXNHbHlHbHkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVE1UIDZwbGV4IHdpdGggVWJpcXVpdGluIE1vZGlmaWNhdGlvbiIsCiAgICAgICAgICAgICJtYXNzIjogMzQzLjIwNTg2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkNyb3RvbnlsYXRpb24iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQ3JvdG9ueWxhdGlvbiIsCiAgICAgICAgICAgICJtYXNzIjogNjguMDI2MjE1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkxSTFJHRy1LIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkxldUFyZ0xldUFyZ0dseUdseS1MeXMiLAogICAgICAgICAgICAibWFzcyI6IDY1Mi40MTMyNzgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUkxSR0ctSyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBcmdMZXVBcmdHbHlHbHktTHlzIiwKICAgICAgICAgICAgIm1hc3MiOiA1MzkuMzI5MjE0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkxSR0ctSyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMUkdHIG1vZGlmaWNhdGlvbiBvbiBMeXMiLAogICAgICAgICAgICAibWFzcyI6IDM4My4yMjgxMDMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQVFVQV9WIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogImFxdWEtViIsCiAgICAgICAgICAgICJtYXNzIjogNi4wMTM4MDksCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkFRVUFfUCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJpc290b3BpY2FsbHkgbW9kaWZpZWQgcmVzaWR1ZXMgUHJvIiwKICAgICAgICAgICAgIm1hc3MiOiA2LjAxMzgwOQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJBUVVBX1BWIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogImlzb3RvcGljYWxseSBtb2RpZmllZCByZXNpZHVlcyBQcm8gYW5kIFZhbCIsCiAgICAgICAgICAgICJtYXNzIjogNi4wMTM4MDkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQVFVQV9MIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogImlzb3RvcGljYWxseSBtb2RpZmllZCByZXNpZHVlIExldSIsCiAgICAgICAgICAgICJtYXNzIjogNy4wMTcxNjQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQVFVQV9JIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogImlzb3RvcGljYWxseSBtb2RpZmllZCByZXNpZHVlIElzb2xldWNpbmUiLAogICAgICAgICAgICAibWFzcyI6IDcuMDE3MTY0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkFRVUFfVCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJpc290b3BpY2FsbHkgbW9kaWZpZWQgcmVzaWR1ZSBUaHIiLAogICAgICAgICAgICAibWFzcyI6IDUuMDEwNDUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQVFVQV9HIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogImlzb3RvcGljYWxseSBtb2RpZmllZCByZXNpZHVlIEdseSIsCiAgICAgICAgICAgICJtYXNzIjogMy4wMDM3NDUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQVFVQV9GIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogImlzb3RvcGljYWxseSBtb2RpZmllZCByZXNpZHVlIEYiLAogICAgICAgICAgICAibWFzcyI6IDEwLjAyOAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJBUVVBX0EiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiaXNvdG9waWNhbGx5IG1vZGlmaWVkIHJlc2lkdWUgQWxhIiwKICAgICAgICAgICAgIm1hc3MiOiA0LjAwNzA5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJBUVVBX1lwaG9zIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogImlzb3RvcGljYWxseSBtb2RpZmllZCByZXNpZHVlIHBob3NwaG9yeWxhdGVkIFR5ciIsCiAgICAgICAgICAgICJtYXNzIjogODkuOTkzNTU5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkFRVUFfWSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJpc290b3BpY2FsbHkgbW9kaWZpZWQgcmVzaWR1ZSBUeXIiLAogICAgICAgICAgICAibWFzcyI6IDEwLjAyNzIyOAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJBY2V0eWxfaGVhdnlfTHlzIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFjZXR5bF9oZWF2eV9MeXMiLAogICAgICAgICAgICAibWFzcyI6IDUwLjAyNDc2NAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJRRVFUR0ciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiU1VNTyBMeXMtUUVRVEdHIiwKICAgICAgICAgICAgIm1hc3MiOiA2MDAuMjUwMzU0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk1vbm9NZXRoeWxQcm9waW9ueWwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTW9ub01ldGh5bFByb3Bpb255bEx5c2luZSIsCiAgICAgICAgICAgICJtYXNzIjogNzAuMDQxODY1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlByb3Bpb255bDoySCg1KSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQcm9waW9uYXRlIGxhYmVsaW5nIHJlYWdlbnQgcGVudGFkZXV0ZXJhdGVkIGZvcm0gKCs1YW11KSwgTi10ZXJtICYgSyIsCiAgICAgICAgICAgICJtYXNzIjogNjEuMDU3NTk4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkdseUdseUNhcmJhbXlsIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkNhcmJhbXlsYXRlZCBEaWdseWNpbmUiLAogICAgICAgICAgICAibWFzcyI6IDE1Ny4wNDg3NDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQVFVQV9EIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogImlzb3RvcGljYWxseSBtb2RpZmllZCByZXNpZHVlIEFzcCIsCiAgICAgICAgICAgICJtYXNzIjogNS4wMTA0NTQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQT5SIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFsYT5BcmciLAogICAgICAgICAgICAibWFzcyI6IDg1LjA2Mzk5NwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJBPk4iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQWxhPkFzbiIsCiAgICAgICAgICAgICJtYXNzIjogNDMuMDA1ODEzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkE+RCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBbGE+QXNwIiwKICAgICAgICAgICAgIm1hc3MiOiA0My45ODk4MjkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQT5DIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFsYT5DeXMiLAogICAgICAgICAgICAibWFzcyI6IDMxLjk3MjA3MQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJBPkUiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQWxhPkdsdSIsCiAgICAgICAgICAgICJtYXNzIjogNTguMDA1NDc5MDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQT5RIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFsYT5HbG4iLAogICAgICAgICAgICAibWFzcyI6IDU3LjAyMTQ2NDAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkE+RyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBbGE+R2x5IiwKICAgICAgICAgICAgIm1hc3MiOiAtMTQuMDE1NjUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQT5IIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFsYT5IaXMiLAogICAgICAgICAgICAibWFzcyI6IDY2LjAyMTc5Nzk5OTk5OTk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkE+SSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBbGE+SWxlIiwKICAgICAgICAgICAgIm1hc3MiOiA0Mi4wNDY5NDk5OTk5OTk5OTUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQT5MIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFsYT5MZXUiLAogICAgICAgICAgICAibWFzcyI6IDQyLjA0Njk0OTk5OTk5OTk5NQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJBPksiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQWxhPkx5cyIsCiAgICAgICAgICAgICJtYXNzIjogNTcuMDU3ODQ5MDAwMDAwMDA0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkE+TSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBbGE+TWV0IiwKICAgICAgICAgICAgIm1hc3MiOiA2MC4wMDMzNzA5OTk5OTk5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJBPkYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQWxhPlBoZSIsCiAgICAgICAgICAgICJtYXNzIjogNzYuMDMxMjk5OTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQT5QIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFsYT5Qcm8iLAogICAgICAgICAgICAibWFzcyI6IDI2LjAxNTY0OTk5OTk5OTk5NAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJBPlMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQWxhPlNlciIsCiAgICAgICAgICAgICJtYXNzIjogMTUuOTk0OTEzOTk5OTk5OTk0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkE+VCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBbGE+VGhyIiwKICAgICAgICAgICAgIm1hc3MiOiAzMC4wMTA1NjUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQT5XIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFsYT5UcnAiLAogICAgICAgICAgICAibWFzcyI6IDExNS4wNDIxOTkwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJBPlkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQWxhPlR5ciIsCiAgICAgICAgICAgICJtYXNzIjogOTIuMDI2MjA2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkE+ViIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBbGE+VmFsIiwKICAgICAgICAgICAgIm1hc3MiOiAyOC4wMzEzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlI+QSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBcmc+QWxhIiwKICAgICAgICAgICAgIm1hc3MiOiAtODUuMDYzOTk3CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlI+TiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBcmc+QXNuIiwKICAgICAgICAgICAgIm1hc3MiOiAtNDIuMDU4MTg0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlI+RCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBcmc+QXNwIiwKICAgICAgICAgICAgIm1hc3MiOiAtNDEuMDc0MTY4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlI+QyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBcmc+Q3lzIiwKICAgICAgICAgICAgIm1hc3MiOiAtNTMuMDkxOTI2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlI+RSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBcmc+R2x1IiwKICAgICAgICAgICAgIm1hc3MiOiAtMjcuMDU4NTE3OTk5OTk5OTkyCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlI+USIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBcmc+R2xuIiwKICAgICAgICAgICAgIm1hc3MiOiAtMjguMDQyNTMyOTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUj5HIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFyZz5HbHkiLAogICAgICAgICAgICAibWFzcyI6IC05OS4wNzk2NDcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUj5IIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFyZz5IaXMiLAogICAgICAgICAgICAibWFzcyI6IC0xOS4wNDIxOTkwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJSPkkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXJnPklsZSIsCiAgICAgICAgICAgICJtYXNzIjogLTQzLjAxNzA0NzAwMDAwMDAwNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJSPkwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXJnPkxldSIsCiAgICAgICAgICAgICJtYXNzIjogLTQzLjAxNzA0NzAwMDAwMDAwNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJSPksiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXJnPkx5cyIsCiAgICAgICAgICAgICJtYXNzIjogLTI4LjAwNjE0Nzk5OTk5OTk5NgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJSPk0iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXJnPk1ldCIsCiAgICAgICAgICAgICJtYXNzIjogLTI1LjA2MDYyNjAwMDAwMDAxMwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJSPkYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXJnPlBoZSIsCiAgICAgICAgICAgICJtYXNzIjogLTkuMDMyNjk3MDAwMDAwMDEzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlI+UCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBcmc+UHJvIiwKICAgICAgICAgICAgIm1hc3MiOiAtNTkuMDQ4MzQ3MDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUj5TIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFyZz5TZXIiLAogICAgICAgICAgICAibWFzcyI6IC02OS4wNjkwODMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUj5UIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFyZz5UaHIiLAogICAgICAgICAgICAibWFzcyI6IC01NS4wNTM0MzIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUj5XIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFyZz5UcnAiLAogICAgICAgICAgICAibWFzcyI6IDI5Ljk3ODIwMjAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlI+WSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBcmc+VHlyIiwKICAgICAgICAgICAgIm1hc3MiOiA2Ljk2MjIwOTAwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJSPlYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXJnPlZhbCIsCiAgICAgICAgICAgICJtYXNzIjogLTU3LjAzMjY5NwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJOPkEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNuPkFsYSIsCiAgICAgICAgICAgICJtYXNzIjogLTQzLjAwNTgxMwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJOPlIiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNuPkFyZyIsCiAgICAgICAgICAgICJtYXNzIjogNDIuMDU4MTg0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk4+RCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBc24+QXNwIiwKICAgICAgICAgICAgIm1hc3MiOiAwLjk4NDAxNTk5OTk5OTk5NjkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTj5DIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFzbj5DeXMiLAogICAgICAgICAgICAibWFzcyI6IC0xMS4wMzM3NDIwMDAwMDAwMDQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTj5FIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFzbj5HbHUiLAogICAgICAgICAgICAibWFzcyI6IDE0Ljk5OTY2NjAwMDAwMDAwNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJOPlEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNuPkdsbiIsCiAgICAgICAgICAgICJtYXNzIjogMTQuMDE1NjUxMDAwMDAwMDA1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk4+RyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBc24+R2x5IiwKICAgICAgICAgICAgIm1hc3MiOiAtNTcuMDIxNDYzMDAwMDAwMDA0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk4+SCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBc24+SGlzIiwKICAgICAgICAgICAgIm1hc3MiOiAyMy4wMTU5ODQ5OTk5OTk5ODYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTj5JIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFzbj5JbGUiLAogICAgICAgICAgICAibWFzcyI6IC0wLjk1ODg2MzAwMDAwMDAwOAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJOPkwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNuPkxldSIsCiAgICAgICAgICAgICJtYXNzIjogLTAuOTU4ODYzMDAwMDAwMDA4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk4+SyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBc24+THlzIiwKICAgICAgICAgICAgIm1hc3MiOiAxNC4wNTIwMzYwMDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTj5NIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFzbj5NZXQiLAogICAgICAgICAgICAibWFzcyI6IDE2Ljk5NzU1Nzk5OTk5OTk4NAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJOPkYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNuPlBoZSIsCiAgICAgICAgICAgICJtYXNzIjogMzMuMDI1NDg2OTk5OTk5OTg0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk4+UCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBc24+UHJvIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTYuOTkwMTYzMDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTj5TIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFzbj5TZXIiLAogICAgICAgICAgICAibWFzcyI6IC0yNy4wMTA4OTkwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJOPlQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNuPlRociIsCiAgICAgICAgICAgICJtYXNzIjogLTEyLjk5NTI0ODAwMDAwMDAwNAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJOPlciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNuPlRycCIsCiAgICAgICAgICAgICJtYXNzIjogNzIuMDM2Mzg2MDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTj5ZIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFzbj5UeXIiLAogICAgICAgICAgICAibWFzcyI6IDQ5LjAyMDM5MwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJOPlYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNuPlZhbCIsCiAgICAgICAgICAgICJtYXNzIjogLTE0Ljk3NDUxMzAwMDAwMDAwMgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJEPkEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNwPkFsYSIsCiAgICAgICAgICAgICJtYXNzIjogLTQzLjk4OTgyOQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJEPlIiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNwPkFyZyIsCiAgICAgICAgICAgICJtYXNzIjogNDEuMDc0MTY4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkQ+TiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBc3A+QXNuIiwKICAgICAgICAgICAgIm1hc3MiOiAtMC45ODQwMTU5OTk5OTk5OTY5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkQ+QyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBc3A+Q3lzIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTIuMDE3NzU4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkQ+RSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBc3A+R2x1IiwKICAgICAgICAgICAgIm1hc3MiOiAxNC4wMTU2NTAwMDAwMDAwMDgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRD5RIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFzcD5HbG4iLAogICAgICAgICAgICAibWFzcyI6IDEzLjAzMTYzNTAwMDAwMDAwOQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJEPkciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNwPkdseSIsCiAgICAgICAgICAgICJtYXNzIjogLTU4LjAwNTQ3OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJEPkgiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNwPkhpcyIsCiAgICAgICAgICAgICJtYXNzIjogMjIuMDMxOTY4OTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRD5JIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFzcD5JbGUiLAogICAgICAgICAgICAibWFzcyI6IC0xLjk0Mjg3OTAwMDAwMDAwNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJEPkwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNwPkxldSIsCiAgICAgICAgICAgICJtYXNzIjogLTEuOTQyODc5MDAwMDAwMDA1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkQ+SyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBc3A+THlzIiwKICAgICAgICAgICAgIm1hc3MiOiAxMy4wNjgwMjAwMDAwMDAwMDQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRD5NIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFzcD5NZXQiLAogICAgICAgICAgICAibWFzcyI6IDE2LjAxMzU0MTk5OTk5OTk4NwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJEPkYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQXNwPlBoZSIsCiAgICAgICAgICAgICJtYXNzIjogMzIuMDQxNDcwOTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRD5QIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFzcD5Qcm8iLAogICAgICAgICAgICAibWFzcyI6IC0xNy45NzQxNzkwMDAwMDAwMDcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRD5TIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFzcD5TZXIiLAogICAgICAgICAgICAibWFzcyI6IC0yNy45OTQ5MTUwMDAwMDAwMDYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRD5UIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFzcD5UaHIiLAogICAgICAgICAgICAibWFzcyI6IC0xMy45NzkyNjQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRD5XIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFzcD5UcnAiLAogICAgICAgICAgICAibWFzcyI6IDcxLjA1MjM3MDAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkQ+WSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJBc3A+VHlyIiwKICAgICAgICAgICAgIm1hc3MiOiA0OC4wMzYzNzcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRD5WIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkFzcD5WYWwiLAogICAgICAgICAgICAibWFzcyI6IC0xNS45NTg1Mjg5OTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQz5BIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkN5cz5BbGEiLAogICAgICAgICAgICAibWFzcyI6IC0zMS45NzIwNzEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQz5SIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkN5cz5BcmciLAogICAgICAgICAgICAibWFzcyI6IDUzLjA5MTkyNgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJDPk4iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQ3lzPkFzbiIsCiAgICAgICAgICAgICJtYXNzIjogMTEuMDMzNzQyMDAwMDAwMDA0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkM+RCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJDeXM+QXNwIiwKICAgICAgICAgICAgIm1hc3MiOiAxMi4wMTc3NTgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQz5FIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkN5cz5HbHUiLAogICAgICAgICAgICAibWFzcyI6IDI2LjAzMzQwODAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkM+USIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJDeXM+R2xuIiwKICAgICAgICAgICAgIm1hc3MiOiAyNS4wNDkzOTMwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJDPkciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQ3lzPkdseSIsCiAgICAgICAgICAgICJtYXNzIjogLTQ1Ljk4NzcyMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJDPkgiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQ3lzPkhpcyIsCiAgICAgICAgICAgICJtYXNzIjogMzQuMDQ5NzI2OTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQz5JIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkN5cz5JbGUiLAogICAgICAgICAgICAibWFzcyI6IDEwLjA3NDg3ODk5OTk5OTk5NgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJDPkwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQ3lzPkxldSIsCiAgICAgICAgICAgICJtYXNzIjogMTAuMDc0ODc4OTk5OTk5OTk2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkM+SyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJDeXM+THlzIiwKICAgICAgICAgICAgIm1hc3MiOiAyNS4wODU3NzgwMDAwMDAwMDUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQz5NIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkN5cz5NZXQiLAogICAgICAgICAgICAibWFzcyI6IDI4LjAzMTI5OTk5OTk5OTk4NwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJDPkYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQ3lzPlBoZSIsCiAgICAgICAgICAgICJtYXNzIjogNDQuMDU5MjI4OTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiQz5QIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkN5cz5Qcm8iLAogICAgICAgICAgICAibWFzcyI6IC01Ljk1NjQyMTAwMDAwMDAwNgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJDPlMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQ3lzPlNlciIsCiAgICAgICAgICAgICJtYXNzIjogLTE1Ljk3NzE1NzAwMDAwMDAwNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJDPlQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQ3lzPlRociIsCiAgICAgICAgICAgICJtYXNzIjogLTEuOTYxNTA2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkM+VyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJDeXM+VHJwIiwKICAgICAgICAgICAgIm1hc3MiOiA4My4wNzAxMjgwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJDPlkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiQ3lzPlR5ciIsCiAgICAgICAgICAgICJtYXNzIjogNjAuMDU0MTM1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkM+ViIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJDeXM+VmFsIiwKICAgICAgICAgICAgIm1hc3MiOiAtMy45NDA3NzA5OTk5OTk5OTgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRT5BIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsdT5BbGEiLAogICAgICAgICAgICAibWFzcyI6IC01OC4wMDU0NzkwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJFPlIiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2x1PkFyZyIsCiAgICAgICAgICAgICJtYXNzIjogMjcuMDU4NTE3OTk5OTk5OTkyCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkU+TiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbHU+QXNuIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTQuOTk5NjY2MDAwMDAwMDA1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkU+RCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbHU+QXNwIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTQuMDE1NjUwMDAwMDAwMDA4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkU+QyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbHU+Q3lzIiwKICAgICAgICAgICAgIm1hc3MiOiAtMjYuMDMzNDA4MDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRT5RIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsdT5HbG4iLAogICAgICAgICAgICAibWFzcyI6IC0wLjk4NDAxNDk5OTk5OTk5OTQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRT5HIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsdT5HbHkiLAogICAgICAgICAgICAibWFzcyI6IC03Mi4wMjExMjkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRT5IIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsdT5IaXMiLAogICAgICAgICAgICAibWFzcyI6IDguMDE2MzE4OTk5OTk5OTgyCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkU+SSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbHU+SWxlIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTUuOTU4NTI5MDAwMDAwMDEzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkU+TCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbHU+TGV1IiwKICAgICAgICAgICAgIm1hc3MiOiAtMTUuOTU4NTI5MDAwMDAwMDEzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkU+SyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbHU+THlzIiwKICAgICAgICAgICAgIm1hc3MiOiAtMC45NDc2MzAwMDAwMDAwMDM3CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkU+TSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbHU+TWV0IiwKICAgICAgICAgICAgIm1hc3MiOiAxLjk5Nzg5MTk5OTk5OTk3OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJFPkYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2x1PlBoZSIsCiAgICAgICAgICAgICJtYXNzIjogMTguMDI1ODIwOTk5OTk5OTgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRT5QIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsdT5Qcm8iLAogICAgICAgICAgICAibWFzcyI6IC0zMS45ODk4MjkwMDAwMDAwMTUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRT5TIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsdT5TZXIiLAogICAgICAgICAgICAibWFzcyI6IC00Mi4wMTA1NjUwMDAwMDAwMTQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRT5UIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsdT5UaHIiLAogICAgICAgICAgICAibWFzcyI6IC0yNy45OTQ5MTQwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJFPlciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2x1PlRycCIsCiAgICAgICAgICAgICJtYXNzIjogNTcuMDM2NzIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRT5ZIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsdT5UeXIiLAogICAgICAgICAgICAibWFzcyI6IDM0LjAyMDcyNjk5OTk5OTk5NAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJFPlYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2x1PlZhbCIsCiAgICAgICAgICAgICJtYXNzIjogLTI5Ljk3NDE3OTAwMDAwMDAwNwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJRPkEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2xuPkFsYSIsCiAgICAgICAgICAgICJtYXNzIjogLTU3LjAyMTQ2NDAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlE+UiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbG4+QXJnIiwKICAgICAgICAgICAgIm1hc3MiOiAyOC4wNDI1MzI5OTk5OTk5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJRPk4iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2xuPkFzbiIsCiAgICAgICAgICAgICJtYXNzIjogLTE0LjAxNTY1MTAwMDAwMDAwNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJRPkQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2xuPkFzcCIsCiAgICAgICAgICAgICJtYXNzIjogLTEzLjAzMTYzNTAwMDAwMDAwOQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJRPkMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2xuPkN5cyIsCiAgICAgICAgICAgICJtYXNzIjogLTI1LjA0OTM5MzAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlE+RSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbG4+R2x1IiwKICAgICAgICAgICAgIm1hc3MiOiAwLjk4NDAxNDk5OTk5OTk5OTQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUT5HIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsbj5HbHkiLAogICAgICAgICAgICAibWFzcyI6IC03MS4wMzcxMTQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUT5IIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsbj5IaXMiLAogICAgICAgICAgICAibWFzcyI6IDkuMDAwMzMzOTk5OTk5OTgxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlE+SSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbG4+SWxlIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTQuOTc0NTE0MDAwMDAwMDEzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlE+TCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbG4+TGV1IiwKICAgICAgICAgICAgIm1hc3MiOiAtMTQuOTc0NTE0MDAwMDAwMDEzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlE+SyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbG4+THlzIiwKICAgICAgICAgICAgIm1hc3MiOiAwLjAzNjM4NDk5OTk5OTk5NTY3CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlE+TSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbG4+TWV0IiwKICAgICAgICAgICAgIm1hc3MiOiAyLjk4MTkwNjk5OTk5OTk3ODMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUT5GIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsbj5QaGUiLAogICAgICAgICAgICAibWFzcyI6IDE5LjAwOTgzNTk5OTk5OTk4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlE+UCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbG4+UHJvIiwKICAgICAgICAgICAgIm1hc3MiOiAtMzEuMDA1ODE0MDAwMDAwMDE1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlE+UyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbG4+U2VyIiwKICAgICAgICAgICAgIm1hc3MiOiAtNDEuMDI2NTUwMDAwMDAwMDE1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlE+VCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbG4+VGhyIiwKICAgICAgICAgICAgIm1hc3MiOiAtMjcuMDEwODk5MDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUT5XIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsbj5UcnAiLAogICAgICAgICAgICAibWFzcyI6IDU4LjAyMDczNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJRPlkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2xuPlR5ciIsCiAgICAgICAgICAgICJtYXNzIjogMzUuMDA0NzQxOTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUT5WIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdsbj5WYWwiLAogICAgICAgICAgICAibWFzcyI6IC0yOC45OTAxNjQwMDAwMDAwMDcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRz5BIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdseT5BbGEiLAogICAgICAgICAgICAibWFzcyI6IDE0LjAxNTY1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkc+UiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbHk+QXJnIiwKICAgICAgICAgICAgIm1hc3MiOiA5OS4wNzk2NDcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRz5OIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdseT5Bc24iLAogICAgICAgICAgICAibWFzcyI6IDU3LjAyMTQ2MzAwMDAwMDAwNAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJHPkQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2x5PkFzcCIsCiAgICAgICAgICAgICJtYXNzIjogNTguMDA1NDc5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkc+QyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbHk+Q3lzIiwKICAgICAgICAgICAgIm1hc3MiOiA0NS45ODc3MjEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRz5FIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdseT5HbHUiLAogICAgICAgICAgICAibWFzcyI6IDcyLjAyMTEyOQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJHPlEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2x5PkdsbiIsCiAgICAgICAgICAgICJtYXNzIjogNzEuMDM3MTE0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkc+SCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbHk+SGlzIiwKICAgICAgICAgICAgIm1hc3MiOiA4MC4wMzc0NDc5OTk5OTk5OAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJHPkkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2x5PklsZSIsCiAgICAgICAgICAgICJtYXNzIjogNTYuMDYyNTk5OTk5OTk5OTk2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkc+TCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbHk+TGV1IiwKICAgICAgICAgICAgIm1hc3MiOiA1Ni4wNjI1OTk5OTk5OTk5OTYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRz5LIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdseT5MeXMiLAogICAgICAgICAgICAibWFzcyI6IDcxLjA3MzQ5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJHPk0iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2x5Pk1ldCIsCiAgICAgICAgICAgICJtYXNzIjogNzQuMDE5MDIwOTk5OTk5OTgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRz5GIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdseT5QaGUiLAogICAgICAgICAgICAibWFzcyI6IDkwLjA0Njk0OTk5OTk5OTk4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkc+UCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbHk+UHJvIiwKICAgICAgICAgICAgIm1hc3MiOiA0MC4wMzEyOTk5OTk5OTk5OTUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRz5TIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkdseT5TZXIiLAogICAgICAgICAgICAibWFzcyI6IDMwLjAxMDU2Mzk5OTk5OTk5NQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJHPlQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiR2x5PlRociIsCiAgICAgICAgICAgICJtYXNzIjogNDQuMDI2MjE1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkc+VyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbHk+VHJwIiwKICAgICAgICAgICAgIm1hc3MiOiAxMjkuMDU3ODQ5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkc+WSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbHk+VHlyIiwKICAgICAgICAgICAgIm1hc3MiOiAxMDYuMDQxODU2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkc+ViIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJHbHk+VmFsIiwKICAgICAgICAgICAgIm1hc3MiOiA0Mi4wNDY5NQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJIPkEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSGlzPkFsYSIsCiAgICAgICAgICAgICJtYXNzIjogLTY2LjAyMTc5Nzk5OTk5OTk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkg+UiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJIaXM+QXJnIiwKICAgICAgICAgICAgIm1hc3MiOiAxOS4wNDIxOTkwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJIPk4iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSGlzPkFzbiIsCiAgICAgICAgICAgICJtYXNzIjogLTIzLjAxNTk4NDk5OTk5OTk4NgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJIPkQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSGlzPkFzcCIsCiAgICAgICAgICAgICJtYXNzIjogLTIyLjAzMTk2ODk5OTk5OTk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkg+QyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJIaXM+Q3lzIiwKICAgICAgICAgICAgIm1hc3MiOiAtMzQuMDQ5NzI2OTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSD5FIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkhpcz5HbHUiLAogICAgICAgICAgICAibWFzcyI6IC04LjAxNjMxODk5OTk5OTk4MgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJIPlEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSGlzPkdsbiIsCiAgICAgICAgICAgICJtYXNzIjogLTkuMDAwMzMzOTk5OTk5OTgxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkg+RyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJIaXM+R2x5IiwKICAgICAgICAgICAgIm1hc3MiOiAtODAuMDM3NDQ3OTk5OTk5OTgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSD5JIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkhpcz5JbGUiLAogICAgICAgICAgICAibWFzcyI6IC0yMy45NzQ4NDc5OTk5OTk5OTQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSD5MIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkhpcz5MZXUiLAogICAgICAgICAgICAibWFzcyI6IC0yMy45NzQ4NDc5OTk5OTk5OTQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSD5LIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkhpcz5MeXMiLAogICAgICAgICAgICAibWFzcyI6IC04Ljk2Mzk0ODk5OTk5OTk4NQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJIPk0iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSGlzPk1ldCIsCiAgICAgICAgICAgICJtYXNzIjogLTYuMDE4NDI3MDAwMDAwMDAzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkg+RiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJIaXM+UGhlIiwKICAgICAgICAgICAgIm1hc3MiOiAxMC4wMDk1MDE5OTk5OTk5OTgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSD5QIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkhpcz5Qcm8iLAogICAgICAgICAgICAibWFzcyI6IC00MC4wMDYxNDc5OTk5OTk5OTYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSD5TIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkhpcz5TZXIiLAogICAgICAgICAgICAibWFzcyI6IC01MC4wMjY4ODM5OTk5OTk5OTUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSD5UIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkhpcz5UaHIiLAogICAgICAgICAgICAibWFzcyI6IC0zNi4wMTEyMzI5OTk5OTk5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJIPlciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSGlzPlRycCIsCiAgICAgICAgICAgICJtYXNzIjogNDkuMDIwNDAxMDAwMDAwMDIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSD5ZIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkhpcz5UeXIiLAogICAgICAgICAgICAibWFzcyI6IDI2LjAwNDQwODAwMDAwMDAxMgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJIPlYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSGlzPlZhbCIsCiAgICAgICAgICAgICJtYXNzIjogLTM3Ljk5MDQ5Nzk5OTk5OTk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkk+QSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJJbGU+QWxhIiwKICAgICAgICAgICAgIm1hc3MiOiAtNDIuMDQ2OTQ5OTk5OTk5OTk1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkk+UiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJJbGU+QXJnIiwKICAgICAgICAgICAgIm1hc3MiOiA0My4wMTcwNDcwMDAwMDAwMDUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiST5OIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIklsZT5Bc24iLAogICAgICAgICAgICAibWFzcyI6IDAuOTU4ODYzMDAwMDAwMDA4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkk+RCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJJbGU+QXNwIiwKICAgICAgICAgICAgIm1hc3MiOiAxLjk0Mjg3OTAwMDAwMDAwNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJJPkMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSWxlPkN5cyIsCiAgICAgICAgICAgICJtYXNzIjogLTEwLjA3NDg3ODk5OTk5OTk5NgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJJPkUiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSWxlPkdsdSIsCiAgICAgICAgICAgICJtYXNzIjogMTUuOTU4NTI5MDAwMDAwMDEzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkk+USIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJJbGU+R2xuIiwKICAgICAgICAgICAgIm1hc3MiOiAxNC45NzQ1MTQwMDAwMDAwMTMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiST5HIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIklsZT5HbHkiLAogICAgICAgICAgICAibWFzcyI6IC01Ni4wNjI1OTk5OTk5OTk5OTYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiST5IIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIklsZT5IaXMiLAogICAgICAgICAgICAibWFzcyI6IDIzLjk3NDg0Nzk5OTk5OTk5NAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJJPkwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSWxlPkxldSIsCiAgICAgICAgICAgICJtYXNzIjogMAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJJPksiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSWxlPkx5cyIsCiAgICAgICAgICAgICJtYXNzIjogMTUuMDEwODk5MDAwMDAwMDA5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkk+TSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJJbGU+TWV0IiwKICAgICAgICAgICAgIm1hc3MiOiAxNy45NTY0MjA5OTk5OTk5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJJPkYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSWxlPlBoZSIsCiAgICAgICAgICAgICJtYXNzIjogMzMuOTg0MzQ5OTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiST5QIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIklsZT5Qcm8iLAogICAgICAgICAgICAibWFzcyI6IC0xNi4wMzEzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkk+UyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJJbGU+U2VyIiwKICAgICAgICAgICAgIm1hc3MiOiAtMjYuMDUyMDM2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkk+VCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJJbGU+VGhyIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTIuMDM2Mzg0OTk5OTk5OTk2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkk+VyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJJbGU+VHJwIiwKICAgICAgICAgICAgIm1hc3MiOiA3Mi45OTUyNDkwMDAwMDAwMgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJJPlkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiSWxlPlR5ciIsCiAgICAgICAgICAgICJtYXNzIjogNDkuOTc5MjU2MDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiST5WIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIklsZT5WYWwiLAogICAgICAgICAgICAibWFzcyI6IC0xNC4wMTU2NDk5OTk5OTk5OTQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTD5BIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkxldT5BbGEiLAogICAgICAgICAgICAibWFzcyI6IC00Mi4wNDY5NDk5OTk5OTk5OTUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTD5SIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkxldT5BcmciLAogICAgICAgICAgICAibWFzcyI6IDQzLjAxNzA0NzAwMDAwMDAwNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJMPk4iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTGV1PkFzbiIsCiAgICAgICAgICAgICJtYXNzIjogMC45NTg4NjMwMDAwMDAwMDgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTD5EIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkxldT5Bc3AiLAogICAgICAgICAgICAibWFzcyI6IDEuOTQyODc5MDAwMDAwMDA1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkw+QyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMZXU+Q3lzIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTAuMDc0ODc4OTk5OTk5OTk2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkw+RSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMZXU+R2x1IiwKICAgICAgICAgICAgIm1hc3MiOiAxNS45NTg1MjkwMDAwMDAwMTMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTD5RIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkxldT5HbG4iLAogICAgICAgICAgICAibWFzcyI6IDE0Ljk3NDUxNDAwMDAwMDAxMwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJMPkciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTGV1PkdseSIsCiAgICAgICAgICAgICJtYXNzIjogLTU2LjA2MjU5OTk5OTk5OTk5NgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJMPkgiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTGV1PkhpcyIsCiAgICAgICAgICAgICJtYXNzIjogMjMuOTc0ODQ3OTk5OTk5OTk0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkw+SSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMZXU+SWxlIiwKICAgICAgICAgICAgIm1hc3MiOiAwCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkw+SyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMZXU+THlzIiwKICAgICAgICAgICAgIm1hc3MiOiAxNS4wMTA4OTkwMDAwMDAwMDkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTD5NIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkxldT5NZXQiLAogICAgICAgICAgICAibWFzcyI6IDE3Ljk1NjQyMDk5OTk5OTk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkw+RiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMZXU+UGhlIiwKICAgICAgICAgICAgIm1hc3MiOiAzMy45ODQzNDk5OTk5OTk5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJMPlAiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTGV1PlBybyIsCiAgICAgICAgICAgICJtYXNzIjogLTE2LjAzMTMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTD5TIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkxldT5TZXIiLAogICAgICAgICAgICAibWFzcyI6IC0yNi4wNTIwMzYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTD5UIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkxldT5UaHIiLAogICAgICAgICAgICAibWFzcyI6IC0xMi4wMzYzODQ5OTk5OTk5OTYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTD5XIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkxldT5UcnAiLAogICAgICAgICAgICAibWFzcyI6IDcyLjk5NTI0OTAwMDAwMDAyCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkw+WSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMZXU+VHlyIiwKICAgICAgICAgICAgIm1hc3MiOiA0OS45NzkyNTYwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJMPlYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTGV1PlZhbCIsCiAgICAgICAgICAgICJtYXNzIjogLTE0LjAxNTY0OTk5OTk5OTk5NAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJLPkEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTHlzPkFsYSIsCiAgICAgICAgICAgICJtYXNzIjogLTU3LjA1Nzg0OTAwMDAwMDAwNAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJLPlIiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTHlzPkFyZyIsCiAgICAgICAgICAgICJtYXNzIjogMjguMDA2MTQ3OTk5OTk5OTk2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIks+TiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMeXM+QXNuIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTQuMDUyMDM2MDAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIks+RCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMeXM+QXNwIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTMuMDY4MDIwMDAwMDAwMDA0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIks+QyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMeXM+Q3lzIiwKICAgICAgICAgICAgIm1hc3MiOiAtMjUuMDg1Nzc4MDAwMDAwMDA1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIks+RSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMeXM+R2x1IiwKICAgICAgICAgICAgIm1hc3MiOiAwLjk0NzYzMDAwMDAwMDAwMzcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSz5RIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkx5cz5HbG4iLAogICAgICAgICAgICAibWFzcyI6IC0wLjAzNjM4NDk5OTk5OTk5NTY3CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIks+RyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMeXM+R2x5IiwKICAgICAgICAgICAgIm1hc3MiOiAtNzEuMDczNDk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIks+SCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMeXM+SGlzIiwKICAgICAgICAgICAgIm1hc3MiOiA4Ljk2Mzk0ODk5OTk5OTk4NQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJLPkkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTHlzPklsZSIsCiAgICAgICAgICAgICJtYXNzIjogLTE1LjAxMDg5OTAwMDAwMDAwOQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJLPkwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTHlzPkxldSIsCiAgICAgICAgICAgICJtYXNzIjogLTE1LjAxMDg5OTAwMDAwMDAwOQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJLPk0iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTHlzPk1ldCIsCiAgICAgICAgICAgICJtYXNzIjogMi45NDU1MjE5OTk5OTk5ODI3CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIks+RiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMeXM+UGhlIiwKICAgICAgICAgICAgIm1hc3MiOiAxOC45NzM0NTA5OTk5OTk5ODMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSz5QIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkx5cz5Qcm8iLAogICAgICAgICAgICAibWFzcyI6IC0zMS4wNDIxOTkwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJLPlMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTHlzPlNlciIsCiAgICAgICAgICAgICJtYXNzIjogLTQxLjA2MjkzNTAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIks+VCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMeXM+VGhyIiwKICAgICAgICAgICAgIm1hc3MiOiAtMjcuMDQ3Mjg0MDAwMDAwMDA1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIks+VyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJMeXM+VHJwIiwKICAgICAgICAgICAgIm1hc3MiOiA1Ny45ODQzNTAwMDAwMDAwMDYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiSz5ZIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIkx5cz5UeXIiLAogICAgICAgICAgICAibWFzcyI6IDM0Ljk2ODM1NwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJLPlYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTHlzPlZhbCIsCiAgICAgICAgICAgICJtYXNzIjogLTI5LjAyNjU0OTAwMDAwMDAwMwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJNPkEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTWV0PkFsYSIsCiAgICAgICAgICAgICJtYXNzIjogLTYwLjAwMzM3MDk5OTk5OTk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk0+UiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJNZXQ+QXJnIiwKICAgICAgICAgICAgIm1hc3MiOiAyNS4wNjA2MjYwMDAwMDAwMTMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTT5OIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIk1ldD5Bc24iLAogICAgICAgICAgICAibWFzcyI6IC0xNi45OTc1NTc5OTk5OTk5ODQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTT5EIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIk1ldD5Bc3AiLAogICAgICAgICAgICAibWFzcyI6IC0xNi4wMTM1NDE5OTk5OTk5ODcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTT5DIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIk1ldD5DeXMiLAogICAgICAgICAgICAibWFzcyI6IC0yOC4wMzEyOTk5OTk5OTk5ODcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTT5FIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIk1ldD5HbHUiLAogICAgICAgICAgICAibWFzcyI6IC0xLjk5Nzg5MTk5OTk5OTk3OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJNPlEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTWV0PkdsbiIsCiAgICAgICAgICAgICJtYXNzIjogLTIuOTgxOTA2OTk5OTk5OTc4MwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJNPkciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTWV0PkdseSIsCiAgICAgICAgICAgICJtYXNzIjogLTc0LjAxOTAyMDk5OTk5OTk4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk0+SCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJNZXQ+SGlzIiwKICAgICAgICAgICAgIm1hc3MiOiA2LjAxODQyNzAwMDAwMDAwMwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJNPkkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTWV0PklsZSIsCiAgICAgICAgICAgICJtYXNzIjogLTE3Ljk1NjQyMDk5OTk5OTk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk0+TCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJNZXQ+TGV1IiwKICAgICAgICAgICAgIm1hc3MiOiAtMTcuOTU2NDIwOTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTT5LIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIk1ldD5MeXMiLAogICAgICAgICAgICAibWFzcyI6IC0yLjk0NTUyMTk5OTk5OTk4MjcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTT5GIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIk1ldD5QaGUiLAogICAgICAgICAgICAibWFzcyI6IDE2LjAyNzkyOQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJNPlAiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTWV0PlBybyIsCiAgICAgICAgICAgICJtYXNzIjogLTMzLjk4NzcyMDk5OTk5OTk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk0+UyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJNZXQ+U2VyIiwKICAgICAgICAgICAgIm1hc3MiOiAtNDQuMDA4NDU2OTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTT5UIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIk1ldD5UaHIiLAogICAgICAgICAgICAibWFzcyI6IC0yOS45OTI4MDU5OTk5OTk5ODcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiTT5XIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIk1ldD5UcnAiLAogICAgICAgICAgICAibWFzcyI6IDU1LjAzODgyODAwMDAwMDAyNAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJNPlkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiTWV0PlR5ciIsCiAgICAgICAgICAgICJtYXNzIjogMzIuMDIyODM1MDAwMDAwMDE1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIk0+ViIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJNZXQ+VmFsIiwKICAgICAgICAgICAgIm1hc3MiOiAtMzEuOTcyMDcwOTk5OTk5OTg1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkY+QSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQaGU+QWxhIiwKICAgICAgICAgICAgIm1hc3MiOiAtNzYuMDMxMjk5OTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRj5SIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBoZT5BcmciLAogICAgICAgICAgICAibWFzcyI6IDkuMDMyNjk3MDAwMDAwMDEzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkY+TiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQaGU+QXNuIiwKICAgICAgICAgICAgIm1hc3MiOiAtMzMuMDI1NDg2OTk5OTk5OTg0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkY+RCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQaGU+QXNwIiwKICAgICAgICAgICAgIm1hc3MiOiAtMzIuMDQxNDcwOTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRj5DIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBoZT5DeXMiLAogICAgICAgICAgICAibWFzcyI6IC00NC4wNTkyMjg5OTk5OTk5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJGPkUiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUGhlPkdsdSIsCiAgICAgICAgICAgICJtYXNzIjogLTE4LjAyNTgyMDk5OTk5OTk4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkY+USIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQaGU+R2xuIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTkuMDA5ODM1OTk5OTk5OTgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRj5HIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBoZT5HbHkiLAogICAgICAgICAgICAibWFzcyI6IC05MC4wNDY5NDk5OTk5OTk5OAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJGPkgiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUGhlPkhpcyIsCiAgICAgICAgICAgICJtYXNzIjogLTEwLjAwOTUwMTk5OTk5OTk5OAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJGPkkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUGhlPklsZSIsCiAgICAgICAgICAgICJtYXNzIjogLTMzLjk4NDM0OTk5OTk5OTk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkY+TCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQaGU+TGV1IiwKICAgICAgICAgICAgIm1hc3MiOiAtMzMuOTg0MzQ5OTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRj5LIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBoZT5MeXMiLAogICAgICAgICAgICAibWFzcyI6IC0xOC45NzM0NTA5OTk5OTk5ODMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRj5NIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBoZT5NZXQiLAogICAgICAgICAgICAibWFzcyI6IC0xNi4wMjc5MjkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRj5QIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBoZT5Qcm8iLAogICAgICAgICAgICAibWFzcyI6IC01MC4wMTU2NDk5OTk5OTk5OTQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiRj5TIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBoZT5TZXIiLAogICAgICAgICAgICAibWFzcyI6IC02MC4wMzYzODU5OTk5OTk5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJGPlQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUGhlPlRociIsCiAgICAgICAgICAgICJtYXNzIjogLTQ2LjAyMDczNDk5OTk5OTk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkY+VyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQaGU+VHJwIiwKICAgICAgICAgICAgIm1hc3MiOiAzOS4wMTA4OTkwMDAwMDAwMgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJGPlkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUGhlPlR5ciIsCiAgICAgICAgICAgICJtYXNzIjogMTUuOTk0OTA2MDAwMDAwMDE1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIkY+ViIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQaGU+VmFsIiwKICAgICAgICAgICAgIm1hc3MiOiAtNDcuOTk5OTk5OTk5OTk5OTg2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlA+QSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQcm8+QWxhIiwKICAgICAgICAgICAgIm1hc3MiOiAtMjYuMDE1NjQ5OTk5OTk5OTk0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlA+UiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQcm8+QXJnIiwKICAgICAgICAgICAgIm1hc3MiOiA1OS4wNDgzNDcwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJQPk4iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUHJvPkFzbiIsCiAgICAgICAgICAgICJtYXNzIjogMTYuOTkwMTYzMDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUD5EIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBybz5Bc3AiLAogICAgICAgICAgICAibWFzcyI6IDE3Ljk3NDE3OTAwMDAwMDAwNwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJQPkMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUHJvPkN5cyIsCiAgICAgICAgICAgICJtYXNzIjogNS45NTY0MjEwMDAwMDAwMDYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUD5FIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBybz5HbHUiLAogICAgICAgICAgICAibWFzcyI6IDMxLjk4OTgyOTAwMDAwMDAxNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJQPlEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUHJvPkdsbiIsCiAgICAgICAgICAgICJtYXNzIjogMzEuMDA1ODE0MDAwMDAwMDE1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlA+RyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQcm8+R2x5IiwKICAgICAgICAgICAgIm1hc3MiOiAtNDAuMDMxMjk5OTk5OTk5OTk1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlA+SCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQcm8+SGlzIiwKICAgICAgICAgICAgIm1hc3MiOiA0MC4wMDYxNDc5OTk5OTk5OTYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUD5JIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBybz5JbGUiLAogICAgICAgICAgICAibWFzcyI6IDE2LjAzMTMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUD5MIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBybz5MZXUiLAogICAgICAgICAgICAibWFzcyI6IDE2LjAzMTMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUD5LIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBybz5MeXMiLAogICAgICAgICAgICAibWFzcyI6IDMxLjA0MjE5OTAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlA+TSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQcm8+TWV0IiwKICAgICAgICAgICAgIm1hc3MiOiAzMy45ODc3MjA5OTk5OTk5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJQPkYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUHJvPlBoZSIsCiAgICAgICAgICAgICJtYXNzIjogNTAuMDE1NjQ5OTk5OTk5OTk0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlA+UyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQcm8+U2VyIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTAuMDIwNzM2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlA+VCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQcm8+VGhyIiwKICAgICAgICAgICAgIm1hc3MiOiAzLjk5NDkxNTAwMDAwMDAwNgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJQPlciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiUHJvPlRycCIsCiAgICAgICAgICAgICJtYXNzIjogODkuMDI2NTQ5MDAwMDAwMDIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUD5ZIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlBybz5UeXIiLAogICAgICAgICAgICAibWFzcyI6IDY2LjAxMDU1NjAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlA+ViIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJQcm8+VmFsIiwKICAgICAgICAgICAgIm1hc3MiOiAyLjAxNTY1MDAwMDAwMDAwOAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJTPkEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiU2VyPkFsYSIsCiAgICAgICAgICAgICJtYXNzIjogLTE1Ljk5NDkxMzk5OTk5OTk5NAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJTPlIiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiU2VyPkFyZyIsCiAgICAgICAgICAgICJtYXNzIjogNjkuMDY5MDgzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlM+TiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJTZXI+QXNuIiwKICAgICAgICAgICAgIm1hc3MiOiAyNy4wMTA4OTkwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJTPkQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiU2VyPkFzcCIsCiAgICAgICAgICAgICJtYXNzIjogMjcuOTk0OTE1MDAwMDAwMDA2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlM+QyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJTZXI+Q3lzIiwKICAgICAgICAgICAgIm1hc3MiOiAxNS45NzcxNTcwMDAwMDAwMDUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUz5FIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlNlcj5HbHUiLAogICAgICAgICAgICAibWFzcyI6IDQyLjAxMDU2NTAwMDAwMDAxNAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJTPlEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiU2VyPkdsbiIsCiAgICAgICAgICAgICJtYXNzIjogNDEuMDI2NTUwMDAwMDAwMDE1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlM+RyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJTZXI+R2x5IiwKICAgICAgICAgICAgIm1hc3MiOiAtMzAuMDEwNTYzOTk5OTk5OTk1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlM+SCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJTZXI+SGlzIiwKICAgICAgICAgICAgIm1hc3MiOiA1MC4wMjY4ODM5OTk5OTk5OTUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUz5JIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlNlcj5JbGUiLAogICAgICAgICAgICAibWFzcyI6IDI2LjA1MjAzNgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJTPkwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiU2VyPkxldSIsCiAgICAgICAgICAgICJtYXNzIjogMjYuMDUyMDM2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlM+SyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJTZXI+THlzIiwKICAgICAgICAgICAgIm1hc3MiOiA0MS4wNjI5MzUwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJTPk0iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiU2VyPk1ldCIsCiAgICAgICAgICAgICJtYXNzIjogNDQuMDA4NDU2OTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUz5GIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlNlcj5QaGUiLAogICAgICAgICAgICAibWFzcyI6IDYwLjAzNjM4NTk5OTk5OTk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlM+UCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJTZXI+UHJvIiwKICAgICAgICAgICAgIm1hc3MiOiAxMC4wMjA3MzYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUz5UIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlNlcj5UaHIiLAogICAgICAgICAgICAibWFzcyI6IDE0LjAxNTY1MTAwMDAwMDAwNQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJTPlciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiU2VyPlRycCIsCiAgICAgICAgICAgICJtYXNzIjogOTkuMDQ3Mjg1MDAwMDAwMDIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiUz5ZIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlNlcj5UeXIiLAogICAgICAgICAgICAibWFzcyI6IDc2LjAzMTI5MjAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlM+ViIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJTZXI+VmFsIiwKICAgICAgICAgICAgIm1hc3MiOiAxMi4wMzYzODYwMDAwMDAwMDcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVD5BIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRocj5BbGEiLAogICAgICAgICAgICAibWFzcyI6IC0zMC4wMTA1NjUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVD5SIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRocj5BcmciLAogICAgICAgICAgICAibWFzcyI6IDU1LjA1MzQzMgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJUPk4iLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVGhyPkFzbiIsCiAgICAgICAgICAgICJtYXNzIjogMTIuOTk1MjQ4MDAwMDAwMDA0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlQ+RCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUaHI+QXNwIiwKICAgICAgICAgICAgIm1hc3MiOiAxMy45NzkyNjQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVD5DIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRocj5DeXMiLAogICAgICAgICAgICAibWFzcyI6IDEuOTYxNTA2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlQ+RSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUaHI+R2x1IiwKICAgICAgICAgICAgIm1hc3MiOiAyNy45OTQ5MTQwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJUPlEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVGhyPkdsbiIsCiAgICAgICAgICAgICJtYXNzIjogMjcuMDEwODk5MDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVD5HIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRocj5HbHkiLAogICAgICAgICAgICAibWFzcyI6IC00NC4wMjYyMTUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVD5IIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRocj5IaXMiLAogICAgICAgICAgICAibWFzcyI6IDM2LjAxMTIzMjk5OTk5OTk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlQ+SSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUaHI+SWxlIiwKICAgICAgICAgICAgIm1hc3MiOiAxMi4wMzYzODQ5OTk5OTk5OTYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVD5MIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRocj5MZXUiLAogICAgICAgICAgICAibWFzcyI6IDEyLjAzNjM4NDk5OTk5OTk5NgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJUPksiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVGhyPkx5cyIsCiAgICAgICAgICAgICJtYXNzIjogMjcuMDQ3Mjg0MDAwMDAwMDA1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlQ+TSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUaHI+TWV0IiwKICAgICAgICAgICAgIm1hc3MiOiAyOS45OTI4MDU5OTk5OTk5ODcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVD5GIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRocj5QaGUiLAogICAgICAgICAgICAibWFzcyI6IDQ2LjAyMDczNDk5OTk5OTk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlQ+UCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUaHI+UHJvIiwKICAgICAgICAgICAgIm1hc3MiOiAtMy45OTQ5MTUwMDAwMDAwMDYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVD5TIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRocj5TZXIiLAogICAgICAgICAgICAibWFzcyI6IC0xNC4wMTU2NTEwMDAwMDAwMDUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVD5XIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRocj5UcnAiLAogICAgICAgICAgICAibWFzcyI6IDg1LjAzMTYzNDAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlQ+WSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUaHI+VHlyIiwKICAgICAgICAgICAgIm1hc3MiOiA2Mi4wMTU2NDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVD5WIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRocj5WYWwiLAogICAgICAgICAgICAibWFzcyI6IC0xLjk3OTI2NDk5OTk5OTk5OAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJXPkEiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVHJwPkFsYSIsCiAgICAgICAgICAgICJtYXNzIjogLTExNS4wNDIxOTkwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJXPlIiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVHJwPkFyZyIsCiAgICAgICAgICAgICJtYXNzIjogLTI5Ljk3ODIwMjAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlc+TiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUcnA+QXNuIiwKICAgICAgICAgICAgIm1hc3MiOiAtNzIuMDM2Mzg2MDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVz5EIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRycD5Bc3AiLAogICAgICAgICAgICAibWFzcyI6IC03MS4wNTIzNzAwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJXPkMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVHJwPkN5cyIsCiAgICAgICAgICAgICJtYXNzIjogLTgzLjA3MDEyODAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlc+RSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUcnA+R2x1IiwKICAgICAgICAgICAgIm1hc3MiOiAtNTcuMDM2NzIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVz5RIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRycD5HbG4iLAogICAgICAgICAgICAibWFzcyI6IC01OC4wMjA3MzUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVz5HIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRycD5HbHkiLAogICAgICAgICAgICAibWFzcyI6IC0xMjkuMDU3ODQ5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlc+SCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUcnA+SGlzIiwKICAgICAgICAgICAgIm1hc3MiOiAtNDkuMDIwNDAxMDAwMDAwMDIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVz5JIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRycD5JbGUiLAogICAgICAgICAgICAibWFzcyI6IC03Mi45OTUyNDkwMDAwMDAwMgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJXPkwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVHJwPkxldSIsCiAgICAgICAgICAgICJtYXNzIjogLTcyLjk5NTI0OTAwMDAwMDAyCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlc+SyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUcnA+THlzIiwKICAgICAgICAgICAgIm1hc3MiOiAtNTcuOTg0MzUwMDAwMDAwMDA2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlc+TSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUcnA+TWV0IiwKICAgICAgICAgICAgIm1hc3MiOiAtNTUuMDM4ODI4MDAwMDAwMDI0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlc+RiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUcnA+UGhlIiwKICAgICAgICAgICAgIm1hc3MiOiAtMzkuMDEwODk5MDAwMDAwMDIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVz5QIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRycD5Qcm8iLAogICAgICAgICAgICAibWFzcyI6IC04OS4wMjY1NDkwMDAwMDAwMgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJXPlMiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVHJwPlNlciIsCiAgICAgICAgICAgICJtYXNzIjogLTk5LjA0NzI4NTAwMDAwMDAyCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlc+VCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUcnA+VGhyIiwKICAgICAgICAgICAgIm1hc3MiOiAtODUuMDMxNjM0MDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVz5ZIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlRycD5UeXIiLAogICAgICAgICAgICAibWFzcyI6IC0yMy4wMTU5OTMwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJXPlYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVHJwPlZhbCIsCiAgICAgICAgICAgICJtYXNzIjogLTg3LjAxMDg5OTAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlk+QSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUeXI+QWxhIiwKICAgICAgICAgICAgIm1hc3MiOiAtOTIuMDI2MjA2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlk+UiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUeXI+QXJnIiwKICAgICAgICAgICAgIm1hc3MiOiAtNi45NjIyMDkwMDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiWT5OIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlR5cj5Bc24iLAogICAgICAgICAgICAibWFzcyI6IC00OS4wMjAzOTMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiWT5EIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlR5cj5Bc3AiLAogICAgICAgICAgICAibWFzcyI6IC00OC4wMzYzNzcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiWT5DIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlR5cj5DeXMiLAogICAgICAgICAgICAibWFzcyI6IC02MC4wNTQxMzUKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiWT5FIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlR5cj5HbHUiLAogICAgICAgICAgICAibWFzcyI6IC0zNC4wMjA3MjY5OTk5OTk5OTQKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiWT5RIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlR5cj5HbG4iLAogICAgICAgICAgICAibWFzcyI6IC0zNS4wMDQ3NDE5OTk5OTk5OQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJZPkciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVHlyPkdseSIsCiAgICAgICAgICAgICJtYXNzIjogLTEwNi4wNDE4NTYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiWT5IIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlR5cj5IaXMiLAogICAgICAgICAgICAibWFzcyI6IC0yNi4wMDQ0MDgwMDAwMDAwMTIKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiWT5JIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlR5cj5JbGUiLAogICAgICAgICAgICAibWFzcyI6IC00OS45NzkyNTYwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJZPkwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVHlyPkxldSIsCiAgICAgICAgICAgICJtYXNzIjogLTQ5Ljk3OTI1NjAwMDAwMDAxCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlk+SyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUeXI+THlzIiwKICAgICAgICAgICAgIm1hc3MiOiAtMzQuOTY4MzU3CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlk+TSIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUeXI+TWV0IiwKICAgICAgICAgICAgIm1hc3MiOiAtMzIuMDIyODM1MDAwMDAwMDE1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlk+RiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUeXI+UGhlIiwKICAgICAgICAgICAgIm1hc3MiOiAtMTUuOTk0OTA2MDAwMDAwMDE1CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlk+UCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJUeXI+UHJvIiwKICAgICAgICAgICAgIm1hc3MiOiAtNjYuMDEwNTU2MDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiWT5TIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlR5cj5TZXIiLAogICAgICAgICAgICAibWFzcyI6IC03Ni4wMzEyOTIwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJZPlQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVHlyPlRociIsCiAgICAgICAgICAgICJtYXNzIjogLTYyLjAxNTY0MQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJZPlciLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVHlyPlRycCIsCiAgICAgICAgICAgICJtYXNzIjogMjMuMDE1OTkzMDAwMDAwMDEKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiWT5WIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlR5cj5WYWwiLAogICAgICAgICAgICAibWFzcyI6IC02My45OTQ5MDYKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVj5BIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlZhbD5BbGEiLAogICAgICAgICAgICAibWFzcyI6IC0yOC4wMzEzCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlY+UiIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJWYWw+QXJnIiwKICAgICAgICAgICAgIm1hc3MiOiA1Ny4wMzI2OTcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVj5OIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlZhbD5Bc24iLAogICAgICAgICAgICAibWFzcyI6IDE0Ljk3NDUxMzAwMDAwMDAwMgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJWPkQiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVmFsPkFzcCIsCiAgICAgICAgICAgICJtYXNzIjogMTUuOTU4NTI4OTk5OTk5OTk5CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlY+QyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJWYWw+Q3lzIiwKICAgICAgICAgICAgIm1hc3MiOiAzLjk0MDc3MDk5OTk5OTk5OAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJWPkUiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVmFsPkdsdSIsCiAgICAgICAgICAgICJtYXNzIjogMjkuOTc0MTc5MDAwMDAwMDA3CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlY+USIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJWYWw+R2xuIiwKICAgICAgICAgICAgIm1hc3MiOiAyOC45OTAxNjQwMDAwMDAwMDcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVj5HIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlZhbD5HbHkiLAogICAgICAgICAgICAibWFzcyI6IC00Mi4wNDY5NQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJWPkgiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVmFsPkhpcyIsCiAgICAgICAgICAgICJtYXNzIjogMzcuOTkwNDk3OTk5OTk5OTkKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVj5JIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlZhbD5JbGUiLAogICAgICAgICAgICAibWFzcyI6IDE0LjAxNTY0OTk5OTk5OTk5NAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJWPkwiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVmFsPkxldSIsCiAgICAgICAgICAgICJtYXNzIjogMTQuMDE1NjQ5OTk5OTk5OTk0CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlY+SyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJWYWw+THlzIiwKICAgICAgICAgICAgIm1hc3MiOiAyOS4wMjY1NDkwMDAwMDAwMDMKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVj5NIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlZhbD5NZXQiLAogICAgICAgICAgICAibWFzcyI6IDMxLjk3MjA3MDk5OTk5OTk4NQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJWPkYiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVmFsPlBoZSIsCiAgICAgICAgICAgICJtYXNzIjogNDcuOTk5OTk5OTk5OTk5OTg2CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlY+UCIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJWYWw+UHJvIiwKICAgICAgICAgICAgIm1hc3MiOiAtMi4wMTU2NTAwMDAwMDAwMDgKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVj5TIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlZhbD5TZXIiLAogICAgICAgICAgICAibWFzcyI6IC0xMi4wMzYzODYwMDAwMDAwMDcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgIm5hbWUiOiAiVj5UIiwKICAgICAgICAgICAgImZ1bGxOYW1lIjogIlZhbD5UaHIiLAogICAgICAgICAgICAibWFzcyI6IDEuOTc5MjY0OTk5OTk5OTk4CiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJuYW1lIjogIlY+VyIsCiAgICAgICAgICAgICJmdWxsTmFtZSI6ICJWYWw+VHJwIiwKICAgICAgICAgICAgIm1hc3MiOiA4Ny4wMTA4OTkwMDAwMDAwMQogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAibmFtZSI6ICJWPlkiLAogICAgICAgICAgICAiZnVsbE5hbWUiOiAiVmFsPlR5ciIsCiAgICAgICAgICAgICJtYXNzIjogNjMuOTk0OTA2CiAgICAgICAgfQogICAgXQp9KTsKCi8qCiAqIEEgc2luZ2xldG9uIGRpY3Rpb25hcnkgZm9yIHJlc2lkdWUgbW9kaWZpY2F0aW9ucywgbG9hZGVkIGZyb20gZGF0YS9yZXNpdWVNb2RpZmljYXRpb25zLmpzLCBhIHRyYW5zZm9ybSBmcm9tIFVuaW1vZCwKICogYnV0IGFueSBtb2RpZmljYXRpb24gY2FuIGJlIGFkZGVkIGFzIGxvbmcgYXMgdGhlIG5hbWUgaXMgdW5pcXVlLgogKiAKICogQ29weXJpZ2h0IChjKSAyMDEzLTE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwoKZGVmaW5lKCdmaXNodG9uZXMvY29sbGVjdGlvbnMvZHJ5L1Jlc2lkdWVNb2RpZmljYXRpb25EaWN0aW9uYXJ5JyxbICdCYWNrYm9uZScsICdmaXNodG9uZXMvbW9kZWxzL2RyeS9SZXNpZHVlTW9kaWZpY2F0aW9uJywgJ2Zpc2h0b25lcy9kYXRhL3Jlc2lkdWVNb2RpZmljYXRpb25zJ10sIGZ1bmN0aW9uKEJhY2tib25lLCBSZXNpZHVlTW9kaWZpY2F0aW9uLCBic19yZXNtb2QpIHsKICAgIHZhciBSZXNpZHVlTW9kaWZpY2F0aW9uRGljdGlvbmFyeSA9IEJhY2tib25lLkNvbGxlY3Rpb24uZXh0ZW5kKHsKCiAgICAgICAgbW9kZWwgOiBSZXNpZHVlTW9kaWZpY2F0aW9uLAogICAgICAgIGRlZmF1bHRzIDogewogICAgICAgIH0sCiAgICAgICAgaW5pdGlhbGl6ZSA6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICBzZWxmLmFkZChic19yZXNtb2QpOwogICAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIG5ldyBSZXNpZHVlTW9kaWZpY2F0aW9uRGljdGlvbmFyeSgpOwp9KTsKCi8qCiAqIFJpY2hTZXF1ZW5jZSBpcyB0aGUgZXhwcmVzc2lvbiBvZiBhIHBlcHRpZGUsIHdpdGggbW9kaWZpY2F0aW9ucy4gSXQgaXMgY2VydGFpbmx5IG9uZSBvZiB0aGUgbW9zdCB1c2VkIGNsYXNzIGFtb25nIGZpc2hUb25lcy1qcy4KICogSXQgaG9sZCB0aGUgcGVwdGlkZSBzZXF1ZW5jZSwgd2l0aCBhbnkgbnVtYmVyIG9mIHBvc3NpYmxlIG1vZGlmaWNhdGlvbiBvbiBhIGFtaW5vIGFjaWQuCiAqIEl0IGFsc28gaG9sZHMgQy9OLXRlcm1zIG1vZGlmaWNhdGlvbihzKSAobXVsdGlwbGUgY2FuIGFsc28gYXBwbHkgb24gdGhlIHRlcm1pbmkuCiAqIFRoaXMgaW1wbGVtZW50YXRpb24gaXMgbm90IGRvbmUgd2l0aCBzcGVlZCBpbiBtaW5kLCBidXQgdmVyc2F0aWxpdHkgb2YgdXNlLgogKgogKiBBIFJpY2hTZXF1ZW5jZSBvYmplY3Qgd2lsbCBjb250YWlucyBhICdzZXF1ZW5jZScgcHJvcGVydGllcyB3aGljaCBpcyBhbiBhcnJheSBvZiB7YWE6eCwgbW9kaWZpY2F0aW9uczpbXX0KICoKICogV2hlbiBnZXR0aW5nIG1vZGlmaWNhdGlvbiBwZXIgcG9zaXRpb25zIG9uIGEgcGVwdGlkZSBvZiBsZW5ndGggbDoKICogMCAtPiBtb2RpZiBvbmUgdGhlIGZpcnN0IGFtaW5vIGFjaWQKICogbC0xIC0+IG9uIHRoZSBsYXN0IGFtaW5vIGFjaWQKICogLTEgLT4gTlRlcm0KICogbCAtPiBDVGVybQogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KCmRlZmluZSgnZmlzaHRvbmVzL21vZGVscy9kcnkvUmljaFNlcXVlbmNlJyxbJ2pxdWVyeScsICd1bmRlcnNjb3JlJywgJ0JhY2tib25lJywgJ2Zpc2h0b25lcy91dGlscy9SZWdFeHBGdWxsU3BsaXRlcicsICdmaXNodG9uZXMvY29sbGVjdGlvbnMvZHJ5L0FtaW5vQWNpZERpY3Rpb25hcnknLCAnZmlzaHRvbmVzL2NvbGxlY3Rpb25zL2RyeS9SZXNpZHVlTW9kaWZpY2F0aW9uRGljdGlvbmFyeScsICdmaXNodG9uZXMvbW9kZWxzL2RyeS9SZXNpZHVlTW9kaWZpY2F0aW9uJ10sIGZ1bmN0aW9uICgkLCBfLCBCYWNrYm9uZSwgUmVnRXhwRnVsbFNwbGl0ZXIsIGRpY29BQSwgZGljb1Jlc01vZCwgUmVzaWR1ZU1vZGlmaWNhdGlvbikgewoKICAgIHZhciBSaWNoU2VxdWVuY2UgPSBCYWNrYm9uZS5Nb2RlbC5leHRlbmQoewogICAgICAgIGRlZmF1bHRzOiB7CiAgICAgICAgICAgIHNlcXVlbmNlOiBbXQogICAgICAgIH0sCiAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKCkgewogICAgICAgIH0sCgogICAgICAgIGNsb25lOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgUmljaFNlcXVlbmNlKCkuZnJvbVN0cmluZyh0aGlzLnRvU3RyaW5nKCkpCiAgICAgICAgfSwKICAgICAgICAvKioKICAgICAgICAgKiBnZXQgdGhlIG1vZGlmaWNhdGlvbiBhcnJheSBmb3IgYSBnaXZlbiBhbWlubyBhY2lkIHBvc2l0aW9uCiAgICAgICAgICogQHBhcmFtIHBvcwogICAgICAgICAqIEBwYXJhbSBjcmVhdGUgOiBjcmVhdGUgc3VjaCBhbiBhcnJ5YSBvbiB0aGUgb2JqZWN0IGlmIGl0IHdhcyBub3QgZXhpc3RpbmcgW2RlZmF1bHQgZmFsc2VdCiAgICAgICAgICogQHJldHVybiB7Kn0KICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAqLwogICAgICAgIGdldE1vZGlmaWNhdGlvbkFycmF5OiBmdW5jdGlvbiAocG9zLCBjcmVhdGUpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICBpZiAocG9zID09IC0xKSB7CiAgICAgICAgICAgICAgICBpZiAoc2VsZi5nZXQoJ25UZXJtTW9kaWZpY2F0aW9ucycpID09PSB1bmRlZmluZWQgJiYgY3JlYXRlKSB7CiAgICAgICAgICAgICAgICAgICAgc2VsZi5zZXQoJ25UZXJtTW9kaWZpY2F0aW9ucycsIFtdKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuZ2V0KCduVGVybU1vZGlmaWNhdGlvbnMnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocG9zID09IHNlbGYuc2l6ZSgpKSB7CiAgICAgICAgICAgICAgICBpZiAoc2VsZi5nZXQoJ2NUZXJtTW9kaWZpY2F0aW9ucycpID09PSB1bmRlZmluZWQgJiYgY3JlYXRlKSB7CiAgICAgICAgICAgICAgICAgICAgc2VsZi5zZXQoJ2NUZXJtTW9kaWZpY2F0aW9ucycsIFtdKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuZ2V0KCdjVGVybU1vZGlmaWNhdGlvbnMnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIXNlbGYuZ2V0KCdzZXF1ZW5jZScpW3Bvc10ubW9kaWZpY2F0aW9ucyAmJiBjcmVhdGUpIHsKICAgICAgICAgICAgICAgIHNlbGYuZ2V0KCdzZXF1ZW5jZScpW3Bvc10ubW9kaWZpY2F0aW9ucyA9IFtdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBzZWxmLmdldCgnc2VxdWVuY2UnKVtwb3NdLm1vZGlmaWNhdGlvbnM7CgogICAgICAgIH0sCiAgICAgICAgLyoqCiAgICAgICAgICogc2V0IHRoZSBtb2ZpY2lhdGlvbiBhcnJheQogICAgICAgICAqIEBwYXJhbSBwb3MKICAgICAgICAgKiBAcGFyYW0gbW9kaWZhcnJheQogICAgICAgICAqIEByZXR1cm4gdGhpcwogICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICovCiAgICAgICAgc2V0TW9kaWZpY2F0aW9uQXJyYXk6IGZ1bmN0aW9uIChwb3MsIG1vZGlmYXJyYXkpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICBpZiAocG9zID09IC0xKSB7CiAgICAgICAgICAgICAgICBzZWxmLnNldCgnblRlcm1Nb2RpZmljYXRpb25zJywgbW9kaWZhcnJheSk7CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHBvcyA9PSBzZWxmLnNpemUoKSkgewogICAgICAgICAgICAgICAgc2VsZi5zZXQoJ2NUZXJtTW9kaWZpY2F0aW9ucycsIG1vZGlmYXJyYXkpCiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgc2VsZi5nZXQoJ3NlcXVlbmNlJylbcG9zXS5tb2RpZmljYXRpb25zID0gbW9kaWZhcnJheTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CgogICAgICAgIH0sCiAgICAgICAgLyoqCiAgICAgICAgICogYWRkIG9uZSBtb2RpZmljYXRpb24gb3IgYW4gYXJyYXkgb2YgbW9kaWYgYXQgYSBnaXZlbiBwb3NpdGlvbiB0byB0aGUgZXhpc2l0aW5nIGxpc3QuCiAgICAgICAgICogQHBhcmFtIHBvczogcG9zaXRpb24gYmVldHdlZW4gLTEgYW5kIGxlbgogICAgICAgICAqIEBwYXJhbSBtb2Q6IG9uZSBtb2RpZmljYWl0b24gb3IgYW4gYXJyYXkgb2YgaXQKICAgICAgICAgKi8KICAgICAgICBzZXRNb2RpZmljYXRpb246IGZ1bmN0aW9uIChwb3MsIG1vZCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHNlbGYuc2V0TW9kaWZpY2F0aW9uQXJyYXkocG9zLCB1bmRlZmluZWQpOwogICAgICAgICAgICBzZWxmLmFkZE1vZGlmaWNhdGlvbihwb3MsIG1vZCk7CiAgICAgICAgICAgIHNlbGYudHJpZ2dlcignY2hhbmdlJykKICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqIGFkZCBvbmUgbW9kaWZpY2F0aW9uIG9yIGFuIGFycmF5IG9mIG1vZGlmIGF0IGEgZ2l2ZW4gcG9zaXRpb24gdG8gdGhlIGV4aXNpdGluZyBsaXN0LgogICAgICAgICAqIEBwYXJhbSBwb3M6IHBvc2l0aW9uIGJlZXR3ZWVuIC0xIGFuZCBsZW4KICAgICAgICAgKiBAcGFyYW0gbW9kOiBvbmUgbW9kaWZpY2FpdG9uIG9yIGFuIGFycmF5IG9mIGl0CiAgICAgICAgICovCiAgICAgICAgYWRkTW9kaWZpY2F0aW9uOiBmdW5jdGlvbiAocG9zLCBtb2QpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICAgICAgaWYgKG1vZCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgbW9kQXJyID0gc2VsZi5nZXRNb2RpZmljYXRpb25BcnJheShwb3MsIHRydWUpCiAgICAgICAgICAgIGlmIChfLmlzQXJyYXkobW9kKSkgewogICAgICAgICAgICAgICAgXy5lYWNoKG1vZCwgZnVuY3Rpb24gKHJtKSB7CiAgICAgICAgICAgICAgICAgICAgbW9kQXJyLnB1c2gocm0pOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBtb2RBcnIucHVzaChtb2QpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIEBwYXJhbSBwb3M6IGJldHdlZW4gLTEgYW5kIGxlbgogICAgICAgICAqIEByZXR1cm4gdGhlIGxpc3Qgb2YgbW9kaWZpY2F0aW9uIGF0IHRoaXMgcG9zaXRpb24gKC0xIGFuZCBzaXplKCkgcG9zaXRpb24gZm9yIHRlcm1pbmkpCiAgICAgICAgICovCiAgICAgICAgY291bnRNb2RpZmljYXRpb25zQXQ6IGZ1bmN0aW9uIChwb3MpIHsKICAgICAgICAgICAgdmFyIGEgPSB0aGlzLmdldE1vZGlmaWNhdGlvbkFycmF5KHBvcyk7CiAgICAgICAgICAgIHJldHVybiBhID8gYS5sZW5ndGggOiAwOwogICAgICAgIH0sCiAgICAgICAgLyoqCiAgICAgICAgICogQHBhcmFtIHBvczogYmV0d2VlbiAtMSBhbmQgbGVuCiAgICAgICAgICogQHJldHVybiB0aGUgbGlzdCBvZiBtb2RpZmljYXRpb24gYXQgdGhpcyBwb3NpdGlvbgogICAgICAgICAqLwogICAgICAgIG1vZGlmQXQ6IGZ1bmN0aW9uIChwb3MpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0TW9kaWZpY2F0aW9uQXJyYXkocG9zKQogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIEBwYWVyYW0gcG9zOiBiZXR3ZWVuIDAgYW5kIGxlbi0xCiAgICAgICAgICogQHJldHVybiB0aGUgYW1pbm8gYWljZCBhdCB0aGlzIHBvc2l0aW9uCiAgICAgICAgICovCiAgICAgICAgYWFBdDogZnVuY3Rpb24gKHBvcykgewogICAgICAgICAgICByZXR1cm4gdGhpcy5nZXQoJ3NlcXVlbmNlJylbcG9zXS5hYQogICAgICAgIH0sCiAgICAgICAgLyoqCiAgICAgICAgICogcmVhZCB0aGUgb2JqZWN0IGJhY2sgZnJvbSB0aGUgdG9TdHJpbmcgbWV0aG9kLiBTZWUgdG9TdHJpbmcgZm9yIG1vcmUgZGV0YWlscyAnQUNEe094aWRhdGlvbn1FRkd7MTIzLjQ1LFBob3NwaG9yeWxhdGlvbn1ISUste0FjZXR5bH0nCiAgICAgICAgICogUmljaFNlcXVlbmNlLXRlc3RzLmpzIHdpbCBzaG93IHBsZW50eSBvZiBleGFtcGxlcwogICAgICAgICAqIEBwYXJhbSBzdHIKICAgICAgICAgKiBAcmV0dXJuIHtSaWNoU2VxdWVuY2V9CiAgICAgICAgICovCiAgICAgICAgZnJvbVN0cmluZzogZnVuY3Rpb24gKHN0cikgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHNlbGYuc2V0KCdzZXF1ZW5jZScsIFtdKTsKCiAgICAgICAgICAgIHN0ciA9IHN0ci50cmltKCkKICAgICAgICAgICAgdmFyIG1hdGNoTnRlcm0gPSAvXlx7KFteXH1dKilcfS8uZXhlYyhzdHIpCiAgICAgICAgICAgIGlmIChtYXRjaE50ZXJtKSB7CiAgICAgICAgICAgICAgICBzdHIgPSBzdHIuc3Vic3RyaW5nKG1hdGNoTnRlcm1bMF0ubGVuZ3RoKTsKICAgICAgICAgICAgICAgIHNlbGYuc2V0TW9kaWZpY2F0aW9uKC0xLCBzZWxmLnN0cmluZzJtb2RpZnMobWF0Y2hOdGVybVsxXSkpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgc2VsZi5zZXRNb2RpZmljYXRpb24oLTEsIHVuZGVmaW5lZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIG1hdGNoQ3Rlcm0gPSAvKFtcfVwtXSlceyhbXlx9XSopXH0kLy5leGVjKHN0cik7CiAgICAgICAgICAgIHZhciBjdGVybU1vZGlmcyA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgaWYgKG1hdGNoQ3Rlcm0pIHsKICAgICAgICAgICAgICAgIHN0ciA9IHN0ci5zdWJzdHIoMCwgc3RyLmxlbmd0aCAtIG1hdGNoQ3Rlcm1bMF0ubGVuZ3RoKTsKICAgICAgICAgICAgICAgIGlmIChtYXRjaEN0ZXJtWzFdID09ICd9JykKICAgICAgICAgICAgICAgICAgICBzdHIgKz0gJ30nOwogICAgICAgICAgICAgICAgY3Rlcm1Nb2RpZnMgPSBzZWxmLnN0cmluZzJtb2RpZnMobWF0Y2hDdGVybVsyXSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBtYXRjaGVzID0gbmV3IFJlZ0V4cEZ1bGxTcGxpdGVyKCkuc3BsaXQoLyhbQS1aXSkoXHsoW15cfV0qKVx9KT8vLCBzdHIpCgogICAgICAgICAgICBfLmVhY2gobWF0Y2hlcywgZnVuY3Rpb24gKG0pIHsKICAgICAgICAgICAgICAgIHZhciByYWEgPSB7CiAgICAgICAgICAgICAgICAgICAgYWE6IGRpY29BQS5nZXQobVsxXSkKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBpZiAoIXJhYS5hYSkgewogICAgICAgICAgICAgICAgICAgIHRocm93IHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogJ1Vua253b3duQW1pbm9BY2lkJywKICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJ3Vua253b24gYW1pbm8gYWNpZCAnICsgbVsxXQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChtWzNdKSB7CiAgICAgICAgICAgICAgICAgICAgcmFhLm1vZGlmaWNhdGlvbnMgPSBzZWxmLnN0cmluZzJtb2RpZnMobVszXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzZWxmLmdldCgnc2VxdWVuY2UnKS5wdXNoKHJhYSk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIHNlbGYuc2V0TW9kaWZpY2F0aW9uKHNlbGYuc2l6ZSgpLCBjdGVybU1vZGlmcyk7CiAgICAgICAgICAgIC8vc2VsZi5jaGFuZ2UoKTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgfSwKICAgICAgICAvKioKICAgICAgICAgKiBwYXJzZSBhIG1vZGlmaWNhdGlvbiBzdHJpbmcgc3RyaW5nCiAgICAgICAgICogQHBhcmFtIHN0ck1vZHMKICAgICAgICAgKiBAcmV0dXJuIHtBcnJheX0KICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAqLwogICAgICAgIHN0cmluZzJtb2RpZnM6IGZ1bmN0aW9uIChzdHJNb2RzKSB7CiAgICAgICAgICAgIHZhciBsID0gW107CiAgICAgICAgICAgIF8uZWFjaChzdHJNb2RzLnNwbGl0KCcsJyksIGZ1bmN0aW9uIChtbikgewogICAgICAgICAgICAgICAgdmFyIG1vZCA9IGRpY29SZXNNb2QuZ2V0KG1uKTsKICAgICAgICAgICAgICAgIGlmICghbW9kKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIG1tYXNzID0gcGFyc2VGbG9hdChtbik7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFfLmlzRmluaXRlKG1tYXNzKSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAnVW5rbndvd25SZXNpZHVlTW9kaWZpY2F0aW9uJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICd1bmtub3duIG1vZGlmaWNhdGlvbiBbJyArIG1vZCArICddIGluICcgKyBtbgogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIG1vZCA9IG5ldyBSZXNpZHVlTW9kaWZpY2F0aW9uKHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogIiIgKyBtbWFzcywKICAgICAgICAgICAgICAgICAgICAgICAgbWFzczogbW1hc3MKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbC5wdXNoKG1vZCkKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiBsOwogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIGNoZWNrIGVxdWFsaXR5IGJldHdlZSAyIHJpY2ggc2VxdWVuY2UuCiAgICAgICAgICogVGhhdCBjYW4gYmUgbm90IHRoYXQgc3RyYWlnaHQgZm9yd2FyZHMsIGJlY2F1c2UgdGhlIG1vZGlmaWNhdGlvbiBvcmRlciBvbiBhIGdpdmVuIGFtaW5vIGFjaWQgaXMgbm90IHJlbGV2YW50LgogICAgICAgICAqIEBwYXJhbSBvcnMKICAgICAgICAgKiBAcmV0dXJuIHsqfQogICAgICAgICAqLwogICAgICAgIGVxdWFsc1RvOiBmdW5jdGlvbiAob3JzKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgaWYgKChvcnMgPT0gbnVsbCkgfHwgKHNlbGYuc2l6ZSgpICE9IG9ycy5zaXplKCkpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIF8uYWxsKHNlbGYuZ2V0KCdzZXF1ZW5jZScpLCBmdW5jdGlvbiAocmFhLCBpKSB7CiAgICAgICAgICAgICAgICBvcmFhID0gb3JzLmdldCgnc2VxdWVuY2UnKVtpXTsKICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyYWEuYWEuY29kZTEsIG9yYWEuYWEuY29kZSkKICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhfLnBsdWNrKHJhYS5tb2RpZmljYXRpb25zLCAnbmFtZScpLnNvcnQoKS5qb2luKAogICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnJyksIF8ucGx1Y2sob3JhYS5tb2RpZmljYXRpb25zLCAnbmFtZScpCiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zb3J0KCkuam9pbignJykpOwogICAgICAgICAgICAgICAgcmV0dXJuIChyYWEuYWEuZ2V0KCdjb2RlMScpID09IG9yYWEuYWEuZ2V0KCdjb2RlMScpKSAmJiAoXy5jb2xsZWN0KHJhYS5tb2RpZmljYXRpb25zLCBmdW5jdGlvbiAobSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBtLmdldCgnbmFtZScpCiAgICAgICAgICAgICAgICB9KS5zb3J0KCkuam9pbignJykgPT0gXy5jb2xsZWN0KG9yYWEubW9kaWZpY2F0aW9ucywgZnVuY3Rpb24gKG0pIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbS5nZXQoJ25hbWUnKQogICAgICAgICAgICAgICAgfSkuc29ydCgpLmpvaW4oJycpKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogQHJldHVybiBqdXN0IHRoZSBhbWlubyBhY2lkIGxpc3QgYXMgYSBzdHJpbmcKICAgICAgICAgKi8KICAgICAgICB0b0FBU3RyaW5nOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBfLmNvbGxlY3QodGhpcy5nZXQoJ3NlcXVlbmNlJyksIGZ1bmN0aW9uIChyYWEpIHsKICAgICAgICAgICAgICAgIHJldHVybiByYWEuYWEuZ2V0KCdjb2RlMScpOwogICAgICAgICAgICB9KS5qb2luKCcnKTsKICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiBmdWxsIHN0cmluZywgY29tcGF0aWJsZSB3aXRoIHRoZSBmcm9tU3RyaW5nL2NvbnN0cnVjdG9yIHN5bnRheAogICAgICAgICAqIHNlZSBSaWNoU2VxdWVuY2UtdGVzdHMuanMgZm9yIGV4YW1wbGVzCiAgICAgICAgICogQHJldHVybiBhIHN0cmluZwogICAgICAgICAqLwogICAgICAgIHRvU3RyaW5nOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgICAgICAgIHZhciBtb2RpZjJzdHJpbmcgPSBmdW5jdGlvbiAobW9kaWZzKSB7CiAgICAgICAgICAgICAgICBpZiAoIW1vZGlmcyB8fCBtb2RpZnMubGVuZ3RoID09IDApIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJyc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gJ3snICsgXy5jb2xsZWN0KG1vZGlmcywgZnVuY3Rpb24gKG0pIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbS5nZXQoJ25hbWUnKQogICAgICAgICAgICAgICAgfSkuc29ydCgpLmpvaW4oJywnKSArICd9JwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBzID0gbW9kaWYyc3RyaW5nKHNlbGYuZ2V0KCduVGVybU1vZGlmaWNhdGlvbnMnKSk7CiAgICAgICAgICAgIHZhciBzaXplID0gc2VsZi5zaXplKCk7CiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBzaXplOyBpKyspIHsKICAgICAgICAgICAgICAgIHMgKz0gc2VsZi5nZXQoJ3NlcXVlbmNlJylbaV0uYWEuZ2V0KCdjb2RlMScpOwogICAgICAgICAgICAgICAgcyArPSBtb2RpZjJzdHJpbmcoc2VsZi5nZXQoJ3NlcXVlbmNlJylbaV0ubW9kaWZpY2F0aW9ucyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChzZWxmLmNvdW50TW9kaWZpY2F0aW9uc0F0KHNpemUpID4gMCkgewogICAgICAgICAgICAgICAgaWYgKHNlbGYuY291bnRNb2RpZmljYXRpb25zQXQoc2l6ZSAtIDEpID09IDApIHsKICAgICAgICAgICAgICAgICAgICBzICs9ICctJwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgOwogICAgICAgICAgICAgICAgcyArPSBtb2RpZjJzdHJpbmcoc2VsZi5nZXQoJ2NUZXJtTW9kaWZpY2F0aW9ucycpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICA7CgogICAgICAgICAgICByZXR1cm4gczsKICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiBhIHNlcXVlbmNlIGxlbmd0aAogICAgICAgICAqLwogICAgICAgIHNpemU6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0KCdzZXF1ZW5jZScpLmxlbmd0aDsKICAgICAgICB9CiAgICB9KTsKCiAgICByZXR1cm4gUmljaFNlcXVlbmNlOwp9KTsKCi8qCiAqIEEgdGhlb3JldGljYWwgc3BlY3RydW0gcG9qbywgbWFkZSBvdXQgZnJvbSBhIFJpY2hTZXF1ZW5jZSBhbmQgYSBzZXQgb2YgZnJhZ21lbnRhdGlvbiBzZXJpZXMKICogUHJvcGVydGllczoKICogLSByaWNoU2VxdWVuY2UKICogLSBwZWFrcwogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KCmRlZmluZSgnZmlzaHRvbmVzL21vZGVscy9kcnkvVGhlb1NwZWN0cnVtJyxbJ3VuZGVyc2NvcmUnLCAnQmFja2JvbmUnXSwgZnVuY3Rpb24oXywgQmFja2JvbmUpIHsKICAgIHZhciBUaGVvU3BlY3RydW0gPSBCYWNrYm9uZS5Nb2RlbC5leHRlbmQoewogICAgICAgIGRlZmF1bHRzIDogewogICAgICAgICAgICByaWNoU2VxdWVuY2UgOiBudWxsLAogICAgICAgIH0sCiAgICAgICAgaW5pdGlhbGl6ZSA6IGZ1bmN0aW9uKCkgewogICAgICAgIH0sCiAgICAgICAgLyoqCiAgICAgICAgICogQHJldHVybiB0aGUgbGlzdCBvZiBtL3ouIHdlIG5lZWQgdGhhdCB0byBoYXZlIGEga2luZCBvZiAnYWJzdHJhY3Rpb24nIG92ZXIgTWFzc0xpc3QKICAgICAgICAgKi8KICAgICAgICBtb3pzOmZ1bmN0aW9uKCl7CiAgICAgICAgICAgIHJldHVybiBfLnBsdWNrKHRoaXMuZ2V0KCdwZWFrcycpLCAnbW96Jyk7CiAgICAgICAgfSwKICAgICAgICBzaXplOmZ1bmN0aW9uKCl7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldCgncGVha3MnKS5sZW5ndGg7CiAgICAgICAgfQogICAgICAgIAogICAgfSk7CiAgICByZXR1cm4gVGhlb1NwZWN0cnVtOwp9KTsKCi8qCiAqIEJ1aWxkcyB0aGVvcmV0aWNhbCBtYXNzZXMgYmFzZWQgb24gYSBSaWNoU2V1ZW5jZS4gSXQgY2FuIGJlIGludGFjdCBtYXNzICh3aXRoIGNoYXJnZXMpIG9yIGZyYWdtZW50YXRpb24gc3BlY3RyYS4KICogVmlzaXQgTWFzc0J1aWxkZXItdGVzdC5qcyBmb3IgcGxlbnR5IG9mIGV4YW1wbGVzLgogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KZGVmaW5lKCdmaXNodG9uZXMvc2VydmljZXMvZHJ5L01hc3NCdWlsZGVyJyxbJ2pxdWVyeScsICd1bmRlcnNjb3JlJywgJ0JhY2tib25lJywgJ2Zpc2h0b25lcy9tb2RlbHMvZHJ5L1JpY2hTZXF1ZW5jZScsICdmaXNodG9uZXMvbW9kZWxzL2RyeS9UaGVvU3BlY3RydW0nLCAnZmlzaHRvbmVzL2NvbGxlY3Rpb25zL2RyeS9BbWlub0FjaWREaWN0aW9uYXJ5JywgJ2Zpc2h0b25lcy9jb2xsZWN0aW9ucy9kcnkvUmVzaWR1ZU1vZGlmaWNhdGlvbkRpY3Rpb25hcnknXSwgZnVuY3Rpb24oJCwgXywgQmFja2JvbmUsIFJpY2hTZXF1ZW5jZSwgVGhlb1NwZWN0cnVtLCBkaWNvQUEsIGRpY29SZXNNb2QpIHsKICB2YXIgTUFTU19PSCA9IDE1Ljk5NDkxNDYyMiArIDEuMDA3ODI1MDMyLy8gY3Rlcm0KICB2YXIgTUFTU19IID0gMS4wMDc4MjUwMzIvLyBudGVybQogIHZhciBNQVNTX0hQTFVTID0gMS4wMDcyNzY0NjY4MTIKCiAgLyoqCiAgICogcHJpdmF0ZSBjb250c3RydWN0b3IKICAgKi8KICBNYXNzQnVpbGRlciA9IEJhY2tib25lLk1vZGVsLmV4dGVuZCh7CiAgICBpbml0RGVmIDogaW5pdERlZiwKICAgIGxhdW5jaEluaXQgOiBmYWxzZSwKCiAgICBfaW5kZXhNb2RpZiA6IG51bGwsCiAgICBfaW5kZXhBbWlub0FjaWQgOiBudWxsLAoKICAgIGluZGV4TW9kaWYgOiBmdW5jdGlvbihuYW1lKSB7CiAgICAgIHJldHVybiAobmFtZSA9PT0gdW5kZWZpbmVkKSA/IHRoaXMuX2luZGV4TW9kaWYgOiB0aGlzLl9pbmRleE1vZGlmW25hbWVdCiAgICB9LAogICAgaW5kZXhBbWlub0FjaWQgOiBmdW5jdGlvbihuYW1lKSB7CiAgICAgIHJldHVybiAobmFtZSA9PT0gdW5kZWZpbmVkKSA/IHRoaXMuX2luZGV4QW1pbm9BY2lkIDogdGhpcy5faW5kZXhBbWlub0FjaWRbbmFtZV0KICAgIH0sCgogICAgcF9pbml0X2FtaW5vX2FjaWRzX2Zyb21fanNvbiA6IHBfaW5pdF9hbWlub19hY2lkc19mcm9tX2pzb24sCiAgICBwX2luaXRfcmVzaWR1ZV9tb2RpZmljYXRpb25zX2Zyb21fanNvbiA6IHBfaW5pdF9yZXNpZHVlX21vZGlmaWNhdGlvbnNfZnJvbV9qc29uLAoKICAgIGNvbXB1dGVNYXNzUmljaFNlcXVlbmNlIDogY29tcHV0ZU1hc3NSaWNoU2VxdWVuY2UsCiAgICBjb21wdXRlVGhlb1NwZWN0cnVtIDogY29tcHV0ZVRoZW9TcGVjdHJ1bSwKICAgIGNvbXB1dGVNYXNzUmljaEFBIDogY29tcHV0ZU1hc3NSaWNoQUEsCiAgICBjb21wdXRlTWFzc01vZGlmQXJyYXkgOiBjb21wdXRlTWFzc01vZGlmQXJyYXkKCiAgfSk7CgogIE1hc3NCdWlsZGVyLnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24ob3B0aW9ucykgewogICAgdGhpcy5pbml0RGVmKG9wdGlvbnMpCgogIH0KICAvKioKICAgKiByZWFkIE1vZGlmaWNhdGlvbiwgYW1pbm8gYWNpZCAmIGNvIGRlZmluaXRpb25zIGF1dG9tYXRpY2FsbHkgY2FsbGVkIG9uY2UKICAgKiBmcm9tIHRoZSBvcHRpb24gc3JjIGluIG5ldwogICAqIEBwcml2YXRlCiAgICovCiAgZnVuY3Rpb24gaW5pdERlZihvcHRpb25zKSB7CiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLnNyYyAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIHNlbGYubGF1bmNoSW5pdCA9IHRydWUKICAgICAgJC5nZXRKU09OKG9wdGlvbnMuc3JjICsgJy9yZXNpZHVlTW9kaWZpY2F0aW9uL2xpc3QnLCBmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgc2VsZi5wX2luaXRfcmVzaWR1ZV9tb2RpZmljYXRpb25zX2Zyb21fanNvbihkYXRhKQogICAgICB9KTsKICAgICAgJC5nZXRKU09OKG9wdGlvbnMuc3JjICsgJy9hbWlub0FjaWQvbGlzdCcsIGZ1bmN0aW9uKGRhdGEpIHsKCiAgICAgICAgc2VsZi5wX2luaXRfYW1pbm9fYWNpZHNfZnJvbV9qc29uKGRhdGEpOwogICAgICB9KTsKICAgIH0gZWxzZSBpZiAob3B0aW9ucyAmJiBvcHRpb25zLmRhdGEgIT09IHVuZGVmaW5lZCkgewogICAgICBzZWxmLmxhdW5jaEluaXQgPSB0cnVlCiAgICAgIHNlbGYucF9pbml0X2FtaW5vX2FjaWRzX2Zyb21fanNvbihvcHRpb25zLmRhdGEuYW1pbm9BY2lkcyk7CiAgICAgIHNlbGYucF9pbml0X3Jlc2lkdWVfbW9kaWZpY2F0aW9uc19mcm9tX2pzb24ob3B0aW9ucy5kYXRhLnJlc2lkdWVNb2RpZmljYXRpb25zKTsKICAgIH0KICB9CgogIHZhciBwX2luaXRfYW1pbm9fYWNpZHNfZnJvbV9qc29uID0gZnVuY3Rpb24oZGF0YSkgewogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgdmFyIGlkeCA9IHt9OwogICAgXy5lYWNoKGRhdGEsIGZ1bmN0aW9uKGQpIHsKICAgICAgaWR4W2QuY29kZTFdID0gZAogICAgfSk7CgogICAgc2VsZi5faW5kZXhBbWlub0FjaWQgPSBpZHg7CiAgfTsKCiAgdmFyIHBfaW5pdF9yZXNpZHVlX21vZGlmaWNhdGlvbnNfZnJvbV9qc29uID0gZnVuY3Rpb24oZGF0YSkgewogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgdmFyIGlkeCA9IHt9OwogICAgXy5lYWNoKGRhdGEsIGZ1bmN0aW9uKGQpIHsKICAgICAgaWR4W2QubmFtZV0gPSBkCiAgICB9KTsKCiAgICBzZWxmLl9pbmRleE1vZGlmID0gaWR4OwogIH07CgogIC8qKgogICAqIGNvbXB1dGUgUmljaEFBIG1hc3MgKGFtaW5vIGFjaWQgKyBtb2RpZmljYXRpb25zKQogICAqIEBwcml2YXRlCiAgICovCiAgZnVuY3Rpb24gY29tcHV0ZU1hc3NSaWNoQUEocmFhKSB7CiAgICByZXR1cm4gcmFhLmFhLmdldCgnbWFzcycpICsgY29tcHV0ZU1hc3NNb2RpZkFycmF5KHJhYS5tb2RpZmljYXRpb25zKTsKICB9CgogIC8qKgogICAqIGNvbXB1dGUgdGhlIG1hc3Mgb2Ygb2YgbGlzdCBvZiBtb2RpZmljYXRpb25zICh1bmRlZmllbmQgaXMgcG9zc2libGUpLiBJdCdzIGp1c3QgdGhlIHN1bSBvZiB0aGUgbW9kaWYgbWFzc2VzCiAgICogQHByaXZhdGUKICAgKi8KICBmdW5jdGlvbiBjb21wdXRlTWFzc01vZGlmQXJyYXkobW9kaWZpY2F0aW9ucykgewoKICAgIGlmIChtb2RpZmljYXRpb25zID09PSB1bmRlZmluZWQgfHwgbW9kaWZpY2F0aW9ucy5sZW5ndGggPT0gMCkgewogICAgICByZXR1cm4gMDsKICAgIH0KICAgIHZhciB0b3QgPSAwOwogICAgXy5lYWNoKG1vZGlmaWNhdGlvbnMsIGZ1bmN0aW9uKG0pIHsKICAgICAgdG90ICs9IG0uZ2V0KCdtYXNzJyk7CiAgICB9KTsKICAgIHJldHVybiB0b3Q7CiAgfQoKICAvKioKICAgKiBnZXQgcmljaCBzZXF1ZW5jZSBtYXNzIGlmIGEgY2hhcmdlIGFyZ3VtZW50IGlzIGdpdmVuICwgZ2V0IHRoZSBjaGFyZ2VkCiAgICogcGVwdGlkZQogICAqIEBwYXJhbSByaWNoU2VxOiB0aGUgcGVwdGlkZQogICAqIEBwYXJhbSBjaGFyZ2U6IGNoYXJnZSBzdGF0ZS4gaWYgdW5kZWZpbmVkLCBNSCB3aWxsIGJlIHJldHVybmVkCiAgICogQHJldHVybiBhIGRvdWJsZSBmb3IgdGhlIG1hc3MKICAgKi8KICBmdW5jdGlvbiBjb21wdXRlTWFzc1JpY2hTZXF1ZW5jZShyaWNoU2VxLCBjaGFyZ2UpIHsKCiAgICB2YXIgcmF3TWFzcyA9IDA7CgogICAgXy5lYWNoKHJpY2hTZXEuZ2V0KCdzZXF1ZW5jZScpLCBmdW5jdGlvbihyYWEpIHsKICAgICAgcmF3TWFzcyArPSBjb21wdXRlTWFzc1JpY2hBQShyYWEpCiAgICB9KTsKCiAgICByYXdNYXNzICs9IE1BU1NfT0ggKyBNQVNTX0g7CiAgICByYXdNYXNzICs9IGNvbXB1dGVNYXNzTW9kaWZBcnJheShyaWNoU2VxLmdldCgnblRlcm1Nb2RpZmljYXRpb25zJykpICsgY29tcHV0ZU1hc3NNb2RpZkFycmF5KHJpY2hTZXEuZ2V0KCdjVGVybU1vZGlmaWNhdGlvbnMnKSk7CiAgICBpZiAoIWNoYXJnZSkgewogICAgICByZXR1cm4gcmF3TWFzcwogICAgfQogICAgcmV0dXJuIHJhd01hc3MgLyBjaGFyZ2UgKyBNQVNTX0hQTFVTOwogIH0KCiAgLyoqCiAgICogY29tcHV0ZSB0aGUgdGhlb3JldGljYWwgbWFzcyBzcGVjdHJ1bS4gYiwgYisrLCB5LCB5KysKICAgKiBAcmV0dXJuIGEgdGhlb3JldGljYWwgc3BlY3RydW0KICAgKi8KICBmdW5jdGlvbiBjb21wdXRlVGhlb1NwZWN0cnVtKHJpY2hTZXEpIHsKICAgIHZhciByYXdNYXNzZXMgPSBbY29tcHV0ZU1hc3NNb2RpZkFycmF5KHJpY2hTZXEuZ2V0KCduVGVybU1vZGlmaWNhdGlvbnMnKSldLmNvbmNhdChfLmNvbGxlY3QocmljaFNlcS5nZXQoJ3NlcXVlbmNlJyksIGNvbXB1dGVNYXNzUmljaEFBKSk7CiAgICB2YXIgbiA9IHJhd01hc3Nlcy5sZW5ndGg7CiAgICBmb3IgKCBpID0gMTsgaSA8IG47IGkrKykgewogICAgICByYXdNYXNzZXNbaV0gKz0gcmF3TWFzc2VzW2kgLSAxXQogICAgfQogICAgdmFyIG10b3QgPSByYXdNYXNzZXNbbiAtIDFdOwoKICAgIHZhciB0aGVvU3AgPSBuZXcgVGhlb1NwZWN0cnVtKHsKICAgICAgZnJhZ1NlcmllcyA6IFsnYicsICdiKysnLCAneScsICd5KysnXSwKICAgICAgbGVuU2VxIDogcmljaFNlcS5zaXplKCksCiAgICAgIHBlYWtzIDogW10sCiAgICAgIHJpY2hTZXF1ZW5jZSA6IHJpY2hTZXEKICAgIH0pOwogICAgdmFyIHBlYWtzID0gdGhlb1NwLmdldCgncGVha3MnKTsKICAgIGZvciAoIGkgPSAocmF3TWFzc2VzWzBdID49IDEwMCkgPyAwIDogMTsgaSA8IHJhd01hc3Nlcy5sZW5ndGg7IGkrKykgewoKICAgICAgdmFyIHJtID0gcmF3TWFzc2VzW2ldOwogICAgICAvLyAgICAgICAgICAgIGNvbnNvbGUubG9nKHJtLCBpKQogICAgICBwZWFrcy5wdXNoKHsKICAgICAgICBsYWJlbCA6ICdiJyArIGksCiAgICAgICAgc2VyaWVzIDogJ2InLAogICAgICAgIG1veiA6IHJtICsgTUFTU19IUExVUywKICAgICAgICBwb3MgOiBpIC0gMQogICAgICB9KTsKICAgICAgcGVha3MucHVzaCh7CiAgICAgICAgbGFiZWwgOiAnYisrJyArIGksCiAgICAgICAgc2VyaWVzIDogJ2IrKycsCiAgICAgICAgbW96IDogcm0gLyAyICsgTUFTU19IUExVUywKICAgICAgICBwb3MgOiBpIC0gMQogICAgICB9KTsKICAgIH0KCiAgICB2YXIgbWN0ZXJtaW51cyA9IGNvbXB1dGVNYXNzTW9kaWZBcnJheShyaWNoU2VxLmdldCgnY1Rlcm1Nb2RpZmljYXRpb25zJykpCiAgICBmb3IgKCBpID0gMDsgaSA8IHJhd01hc3Nlcy5sZW5ndGg7IGkrKykgewogICAgICB2YXIgeW0gPSBtdG90IC0gcmF3TWFzc2VzW2ldICsgTUFTU19PSCArIE1BU1NfSCArIG1jdGVybWludXM7CiAgICAgIGlmICgoaSA9PSByYXdNYXNzZXMubGVuZ3RoIC0gMSApICYmIHltIDwgMTAwKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KCiAgICAgIHBlYWtzLnB1c2goewogICAgICAgIGxhYmVsIDogJ3knICsgKG4gLSBpIC0gMSksCiAgICAgICAgc2VyaWVzIDogJ3knLAogICAgICAgIG1veiA6IHltICsgTUFTU19IUExVUywKICAgICAgICBwb3MgOiBpCiAgICAgIH0pOwogICAgICBwZWFrcy5wdXNoKHsKICAgICAgICBsYWJlbCA6ICd5KysnICsgKG4gLSBpIC0gMSksCiAgICAgICAgc2VyaWVzIDogJ3krKycsCiAgICAgICAgbW96IDogeW0gLyAyICsgTUFTU19IUExVUywKICAgICAgICBwb3MgOiBpCiAgICAgIH0pOwogICAgfQogICAgcGVha3Muc29ydChmdW5jdGlvbihhLCBiKSB7CiAgICAgIHJldHVybiBhLm1veiAtIGIubW96CiAgICB9KTsKICAgIHJldHVybiB0aGVvU3AKICB9CgogIHJldHVybiBuZXcgTWFzc0J1aWxkZXIoKTsKfSk7CgovKgogKiBmdW5jdGlvbiB0byBjb21wdXRlIGRlbHRhIG1hc3Nlcy4KICAqIE9ubHkgcHBtIGlzIGltcGxlbWVudGVkLCBidXQgdGhhdCBzaG91bGQgYmUgdGhlIGhhbmRsZXIgZm9yIG90aGVyIHVuaXRzIChEYSBldGMuLikKICAqCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwpkZWZpbmUoJ2Zpc2h0b25lcy91dGlscy9EZWx0YU1hc3MnLFsndW5kZXJzY29yZSddLCBmdW5jdGlvbihfKSB7CiAgICB2YXIgRGVsdGFNYXNzID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICAvKioKICAgICAgICAgKiBzeW1tZXRyaWNhbGx5IGNvcnJlY3QgcHBtIGNvbXB1dGF0aW9uICh4LXkpIHNob3VsZCBlcXVhbCB0byAoeS14KQogICAgICAgICAqCiAgICAgICAgICogQHR5cGUge3tkZWx0YTogZGVsdGEsIHJhbmdlOiByYW5nZSwgaXNDbG9zZVRvOiBpc0Nsb3NlVG99fQogICAgICAgICAqLwogICAgICAgIHNlbGYucHBtID0gewogICAgICAgICAgICAvKioKICAgICAgICAgICAgICogZGlzdGFuY2UgYmV0d2VlbiB0d28gbWFzc2VzCiAgICAgICAgICAgICAgKiBAcGFyYW0geAogICAgICAgICAgICAgKiBAcGFyYW0geQogICAgICAgICAgICAgKiBAcmV0dXJuIHtudW1iZXJ9CiAgICAgICAgICAgICAqLwogICAgICAgICAgICBkZWx0YSA6IGZ1bmN0aW9uKHgsIHkpIHsKICAgICAgICAgICAgICAgIHJldHVybiAyICogKHkgLSB4KSAvICh5ICsgeCkgKiAxMDAwMDAwOwogICAgICAgICAgICB9LAogICAgICAgICAgICAvKioKICAgICAgICAgICAgICogcmV0dXJuIG1hc3MgYm91bmRhcmllcyBmb3IgeCArLSB0b2wKICAgICAgICAgICAgICogQHBhcmFtIHgKICAgICAgICAgICAgICogQHBhcmFtIHRvbAogICAgICAgICAgICAgKiBAcmV0dXJuIHtbbU1pbiwgbU1heF19CiAgICAgICAgICAgICAqLwogICAgICAgICAgICByYW5nZSA6IGZ1bmN0aW9uKHgsIHRvbCkgewogICAgICAgICAgICAgICAgdG9sID0gTWF0aC5hYnModG9sKSAvIDEwMDAwMDAuMDsKICAgICAgICAgICAgICAgIHZhciBmID0gKDIgKyB0b2wpIC8gKDIgLSB0b2wpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXR1cm4gKHg+PTApP1t4IC8gZiwgeCAqIGZdOlt4ICogZiwgeCAvIGZdCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiB3ZSBoYXZlIHR3byB2ZXJzaW9uOgogICAgICAgICAgICAgKiAgLSB3aXRoIHRocmVlIHBhcmFtcywgcmV0dXJuIHRydWUvZmFsc2UgaWYgKHRhcmdldCAmIHRvbCBhcmUgY2xvc2VyIHRoYW4gY2FuZGlkYXRlKQogICAgICAgICAgICAgKiAgLSB3aXRoIHR3byBwYXJhbWV0ZXJzLCByZXR1cm4gYSBmdW5jdGlvbiB0aGF0IHdpbGwgdGFrZSB3IHBhcmVtdGVyIG9mIHR5cGUgY2FuZGlkYXRlOyB0aGlzIHNob3VsZCBiZSBtdWNoIGZhc3RlcgogICAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gdGFyZ2V0CiAgICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSB0b2wKICAgICAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGNhbmRpZGF0ZQogICAgICAgICAgICAgKi8KICAgICAgICAgICAgaXNDbG9zZVRvIDogZnVuY3Rpb24odGFyZ2V0LCB0b2wsIGNhbmRpZGF0ZSkgewogICAgICAgICAgICAgICAgaWYgKGNhbmRpZGF0ZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE1hdGguYWJzKDIgKiAoY2FuZGlkYXRlIC0gdGFyZ2V0KSAvIChjYW5kaWRhdGUgKyB0YXJnZXQpICogMTAwMDAwMCkgPD0gdG9sCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB2YXIgciA9IHNlbGYucHBtLnJhbmdlKHRhcmdldCwgdG9sKTsKICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihjKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGMgPj0gclswXSAmJiBjIDw9IHJbMV0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICB9CgogICAgcmV0dXJuIG5ldyBEZWx0YU1hc3MoKTsKCn0pCjsKLyoKICogQWJzdHJhY3Qgd2hhdCB3YXMgb25seSBQU01BbGlnbm1lbnQgaW50byBhbGlnbm1lbnQgb2YgdHdvIGJlYW5zIHdpdGggZnVuY3Rpb24gLm1venMoKSAoZ2V0dGluZyBiYWNrIHRoZSBsaXN0IG9mIG1hc3NlcykKICogVGhlIHBvaW50IGlzIHRvIGFsaWduIGV4cC90aGVvLCBidXQgYWxzbyBleHAvZXhwCiAqCiAqIFRoaXMgd2lsbCBiZSBwb3B1bGF0ZWQgd2l0aCBwa2xBIGFuZCBwa2xCLCBlYWNoIG9mIHRoZW0gaGF2aW5nIGEgLm1venMoKSBmdW5jdGlvbi4KICoKICogTkI6IHRoZSB3YXkgdGhlIGFsaWdubWVudCBpcyBwZXJmb3JtZWQgbm90Li4uIGVmZmljaWVudC4gd2UgY29tcHV0ZSBhZ2FpbiBhbmQgYWdhaW4gdGhlIGNsb3Nlc3QgcGVhayB3aXRoIHRoZSBkaWNob3RvbXkgbWV0aG9kcywgaW5zdGVhZCBvZiBtb3ZpbmcgIHdpdGggYSBzaW5nbGUsIG9uZSBzaG90IGxpbmVhci9kaWNobyBtZXRob2QuLi4KICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCgoKZGVmaW5lKCdmaXNodG9uZXMvbW9kZWxzL21hdGNoL1BlYWtMaXN0UGFpckFsaWdubWVudCcsWydqcXVlcnknLCAndW5kZXJzY29yZScsICdCYWNrYm9uZScsICdmaXNodG9uZXMvdXRpbHMvRGVsdGFNYXNzJ10sIGZ1bmN0aW9uICgkLCBfLCBCYWNrYm9uZSwgRGVsdGFNYXNzKSB7CiAgICB2YXIgY2xvc2VzdFBlYWsgPSBmdW5jdGlvbiAoeCwgeHBlYWtzKSB7CgogICAgICAgIGlmICh4IDw9IHhwZWFrc1swXSkgewogICAgICAgICAgICByZXR1cm4gMAogICAgICAgIH0KICAgICAgICB2YXIgaXN1cCA9IHhwZWFrcy5sZW5ndGggLSAxOwogICAgICAgIGlmICh4ID49IHhwZWFrc1tpc3VwXSkgewogICAgICAgICAgICByZXR1cm4gaXN1cAogICAgICAgIH0KICAgICAgICB2YXIgaWluZiA9IDA7CgogICAgICAgIHdoaWxlICgoaWluZiArIDEpIDwgaXN1cCkgewogICAgICAgICAgICB2YXIgaW1pZCA9IE1hdGgucm91bmQoKGlpbmYgKyBpc3VwKSAvIDIpOwogICAgICAgICAgICBpZiAoeCA8IHhwZWFrc1tpbWlkXSkgewogICAgICAgICAgICAgICAgaXN1cCA9IGltaWQKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlpbmYgPSBpbWlkOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiAoKHggLSB4cGVha3NbaWluZl0pIDwgKHhwZWFrc1tpc3VwXSAtIHgpKSA/IGlpbmYgOiBpc3VwOwogICAgfQoKICAgIHJldHVybiBCYWNrYm9uZS5Nb2RlbC5leHRlbmQoewogICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqIGdldCB0aGUgbWF0Y2hpbmcgcGVhayBpbmRpY2VzIGZyb20gQSB0byBCCiAgICAgICAgICogQHJldHVybiB7Kn0KICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAqLwogICAgICAgIG1hdGNoSW5kaWNlczogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHZhciBtb3pzQSA9IHNlbGYuZ2V0KCdwa2xBJykubW96cygpOwogICAgICAgICAgICB2YXIgbW96c0IgPSBzZWxmLmdldCgncGtsQicpLm1venMoKTsKCiAgICAgICAgICAgIHZhciBuQSA9IG1venNBLmxlbmd0aDsKICAgICAgICAgICAgdmFyIG5CID0gbW96c0IubGVuZ3RoOwogICAgICAgICAgICBpZiAobkEgKiBuQiA9PSAwKQogICAgICAgICAgICAgICAgcmV0dXJuIFtdOwoKICAgICAgICAgICAgdmFyIGlBID0gMDsKICAgICAgICAgICAgdmFyIGlCID0gMDsKICAgICAgICAgICAgdmFyIGN1ckRlbHRhID0gRGVsdGFNYXNzLnBwbS5kZWx0YShtb3pzQlswXSwgbW96c0FbMF0pOwogICAgICAgICAgICB2YXIgbGFzdE1hdGNoID0gewogICAgICAgICAgICAgICAgaUE6IDAsCiAgICAgICAgICAgICAgICBpQjogMCwKICAgICAgICAgICAgICAgIGVycm9yUFBNOiBjdXJEZWx0YQogICAgICAgICAgICB9OwogICAgICAgICAgICB2YXIgcmV0ID0gW2xhc3RNYXRjaF07CiAgICAgICAgICAgIHdoaWxlIChpQSA8IG5BICYmIGlCIDwgbkIpIHsKICAgICAgICAgICAgICAgIHZhciBpbmNBOwogICAgICAgICAgICAgICAgaWYgKG1venNBW2lBXSA8IG1venNCW2lCXSkgewogICAgICAgICAgICAgICAgICAgIGluY0EgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGlBICs9IDE7CiAgICAgICAgICAgICAgICAgICAgaWYgKGlBID09IG5BKQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaW5jQSA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIGlCICs9IDE7CiAgICAgICAgICAgICAgICAgICAgaWYgKGlCID09IG5CKQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB2YXIgbmV3RGVsdGEgPSBEZWx0YU1hc3MucHBtLmRlbHRhKG1venNCW2lCXSwgbW96c0FbaUFdKTsKICAgICAgICAgICAgICAgIGlmIChNYXRoLmFicyhuZXdEZWx0YSkgPCBNYXRoLmFicyhjdXJEZWx0YSkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAobGFzdE1hdGNoID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbGFzdE1hdGNoID0ge30KICAgICAgICAgICAgICAgICAgICAgICAgcmV0LnB1c2gobGFzdE1hdGNoKTsKCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGxhc3RNYXRjaC5pQSA9IGlBOwogICAgICAgICAgICAgICAgICAgIGxhc3RNYXRjaC5pQiA9IGlCOwogICAgICAgICAgICAgICAgICAgIGxhc3RNYXRjaC5lcnJvclBQTSA9IG5ld0RlbHRhOwoKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgY3VyRGVsdGEgPSA5OTk5OTk5OTk5OTk5OTk5LjA7CiAgICAgICAgICAgICAgICAgICAgbGFzdE1hdGNoID0gdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY3VyRGVsdGEgPSBuZXdEZWx0YTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmV0OwoKICAgICAgICB9LAogICAgICAgIG1hdGNoZXM6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMubWF0Y2hJbmRpY2VzKCk7CiAgICAgICAgfSwKICAgICAgICAvKioKICAgICAgICAgKiBAIHJldHVybiB0aGUgbGlzdCBvZiBtYXRjaGVzIGNsb3NlciB0aGFuIGEgZ2l2ZW4gdG9sZXJhbmNlCiAgICAgICAgICovCiAgICAgICAgY2xvc2VyVGhhblBQTTogZnVuY3Rpb24gKHRvbCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHZhciBtID0gXy5maWx0ZXIoc2VsZi5nZXQoJ21hdGNoZXMnKSwgZnVuY3Rpb24gKG0pIHsKICAgICAgICAgICAgICAgIHJldHVybiAoTWF0aC5hYnMobS5lcnJvclBQTSkgPCB0b2wpCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm4gbQogICAgICAgIH0KICAgIH0pOwp9KTsKCi8qKgogKiBleHRlbmRzIFBlYWtMaXN0UGFpckFsaWdubWVudCB0byBtYXAgdGhlIGNsb3Nlc3QgcGVhayBvZiBhbiBleHBlcmltZW50YWwgYW5kIHRoZW9yZXRpY2FsIHNwZWN0cmEuIEJvdGggbXVzdCBiZSBzb3J0ZWQgYnkgbW96cy4KICogUHJvcGVydGllcyBhcmUKICogLSByaWNoU2VxdWVuY2UKICogLSBleHBTcGVjdHJ1bQogKgogKiBhbGlnbm1lbnQgaXMgcmVjb21wdXRlZCBvbiBwcm9wZXJ0eSBjaGFuZ2UuCiAqCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwoKZGVmaW5lKCdmaXNodG9uZXMvbW9kZWxzL21hdGNoL1BTTUFsaWdubWVudCcsWydqcXVlcnknLCAndW5kZXJzY29yZScsICdCYWNrYm9uZScsICdmaXNodG9uZXMvc2VydmljZXMvZHJ5L01hc3NCdWlsZGVyJywgJy4vUGVha0xpc3RQYWlyQWxpZ25tZW50J10sIGZ1bmN0aW9uKCQsIF8sIEJhY2tib25lLCBtYXNzQnVpbGRlciwgUGVha0xpc3RQYWlyQWxpZ25tZW50KSB7CgogICAgLyoqCiAgICAgKiBidWlsZCB0aGUgYWxpZ25tZW50IHdpdGggb3B0aW9ucyB7cmljaFNlcXVlbmNlOi4uLiwgZXhwU3BlY3RydW06Li4ufQogICAgICovCiAgICB2YXIgUFNNQWxpZ25tZW50ID0gUGVha0xpc3RQYWlyQWxpZ25tZW50LmV4dGVuZCh7CiAgICAgICAgaW5pdGlhbGl6ZSA6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICBQU01BbGlnbm1lbnQuX19zdXBlcl9fLmluaXRpYWxpemUuY2FsbCh0aGlzLCB7fSk7CgogICAgICAgICAgICBzZWxmLnNldCgncmljaFNlcXVlbmNlJywgb3B0aW9ucy5yaWNoU2VxdWVuY2UpOwogICAgICAgICAgICBzZWxmLnNldCgnZXhwU3BlY3RydW0nLCBvcHRpb25zLmV4cFNwZWN0cnVtKTsKCiAgICAgICAgICAgIHNlbGYuYnVpbGQoKQoKICAgICAgICAgICAgc2VsZi5nZXQoJ2V4cFNwZWN0cnVtJykub24oImNoYW5nZSIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgc2VsZi5idWlsZCgpCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIHNlbGYuZ2V0KCdyaWNoU2VxdWVuY2UnKS5vbigiY2hhbmdlIiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBzZWxmLmJ1aWxkKCkKICAgICAgICAgICAgfSkKICAgICAgICAgICAgc2VsZi5vbigiY2hhbmdlOnJpY2hTZXF1ZW5jZSIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgc2VsZi5idWlsZCgpCiAgICAgICAgICAgIH0pCiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogY29tcHV0ZSB0aGUgdW5kZXJseWluZyBhbGlnbm1lbnQKICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAqLwogICAgICAgIGJ1aWxkIDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgICAgICAgIHNlbGYuc2V0KCd0aGVvU3BlY3RydW0nLCBtYXNzQnVpbGRlci5jb21wdXRlVGhlb1NwZWN0cnVtKHNlbGYuZ2V0KCdyaWNoU2VxdWVuY2UnKSkpOwoKICAgICAgICAgICAgc2VsZi5zZXQoJ3BrbEEnLCBzZWxmLmdldCgndGhlb1NwZWN0cnVtJykpCiAgICAgICAgICAgIHNlbGYuc2V0KCdwa2xCJywgc2VsZi5nZXQoJ2V4cFNwZWN0cnVtJykpCgogICAgICAgICAgICB2YXIgbWF0Y2hJbmRpY2VzID0gc2VsZi5tYXRjaEluZGljZXMoKTsKICAgICAgICAgICAgdmFyIHNwVGhlbyA9IHNlbGYuZ2V0KCd0aGVvU3BlY3RydW0nKS5nZXQoJ3BlYWtzJyk7CiAgICAgICAgICAgIHZhciB4cGVha3MgPSBzZWxmLmdldCgnZXhwU3BlY3RydW0nKS5nZXQoJ21venMnKTsKICAgICAgICAgICAgdmFyIHhJbnRlbnNpdGllcyA9IHNlbGYuZ2V0KCdleHBTcGVjdHJ1bScpLmdldCgnaW50ZW5zaXR5UmFua3MnKTsKCiAgICAgICAgICAgIHZhciBtYXRjaGVzID0gXy5tYXAobWF0Y2hJbmRpY2VzLCBmdW5jdGlvbihtaSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHsKCiAgICAgICAgICAgICAgICAgICAgdGhlbyA6IHNwVGhlb1ttaS5pQV0sCiAgICAgICAgICAgICAgICAgICAgZXhwIDogewogICAgICAgICAgICAgICAgICAgICAgICBpbmRleCA6IG1pLmlCLAogICAgICAgICAgICAgICAgICAgICAgICBtb3ogOiB4cGVha3NbbWkuaUJdLAogICAgICAgICAgICAgICAgICAgICAgICBpbnRlbnNpdHlSYW5rIDogeEludGVuc2l0aWVzW21pLmlCXSwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIGVycm9yUFBNIDogbWkuZXJyb3JQUE0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICAgICAgc2VsZi5zZXQoJ21hdGNoZXMnLCBtYXRjaGVzKTsKCiAgICAgICAgfSwKICAgCiAgICAgICAgLyoqCiAgICAgICAgICogZGlmZmVyZW5jZSBiZXR3ZWVuIHRoZSBleHBlcmltZW50YWwgcHJlY3Vyc28gbWFzcyBhbmQgdGhlIHNlcXVlbmNlIG1hc3MgKE1IKQogICAgICAgICAqLwogICAgICAgIGRlbHRhUHJlY01venMgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICB2YXIgeiA9IHNlbGYuZ2V0KCdleHBTcGVjdHJ1bScpLmdldCgncHJlY0NoYXJnZScpOwogICAgICAgICAgICB2YXIgdGhlbyA9IG1hc3NCdWlsZGVyLmNvbXB1dGVNYXNzUmljaFNlcXVlbmNlKHNlbGYuZ2V0KCdyaWNoU2VxdWVuY2UnKSwgeikKICAgICAgICAgICAgcmV0dXJuIChzZWxmLmdldCgnZXhwU3BlY3RydW0nKS5nZXQoJ3ByZWNNb3onKSAtIHRoZW8pICogegogICAgICAgIH0sCiAgICAgICAgLyoqCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIHt7fX0gYSBqc28gcmVhZHkgc3RyaW5nCiAgICAgICAgICovCiAgICAgICAgc2VyaWFsaXplIDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIHJldCA9IHt9OwogICAgICAgICAgICByZXQuZXhwU3BlY3RydW0gPSBzZWxmLmdldCgnZXhwU3BlY3RydW0nKS50b0pTT04oKQoKICAgICAgICAgICAgdmFyIHJzZXEgPSBzZWxmLmdldCgncmljaFNlcXVlbmNlJykudG9TdHJpbmcoKTsKICAgICAgICAgICAgcmV0LnJpY2hTZXF1ZW5jZSA9IHJzZXEKCiAgICAgICAgICAgIHJldC5pZCA9IHNlbGYuY29tcHV0ZUlkKCk7CiAgICAgICAgICAgIHJldC5hYVNlcXVlbmNlID0gc2VsZi5nZXQoJ3JpY2hTZXF1ZW5jZScpLnRvQUFTdHJpbmcoKTsKCiAgICAgICAgICAgIHJldHVybiByZXQ7CiAgICAgICAgfSwKICAgICAgICBjb21wdXRlSWQgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICByZXR1cm4gc2VsZi5nZXQoJ2V4cFNwZWN0cnVtJykuZ2V0KCdpZCcpICsgJ3wnICsgc2VsZi5nZXQoJ3JpY2hTZXF1ZW5jZScpLnRvU3RyaW5nKCkKCiAgICAgICAgfSwKICAgICAgICAvKioKICAgICAgICAgKiByZXR1cm4gdGhlIG51bWJlciBvZiB1bm1hdGNoZWQgZXhwZXJpbWVudGFsIHBlYWssIHdpdGggYSBtYXNzIGdyZWF0ZXIgdGhhbiB0aGUgcHJlY3Vyc29yLAogICAgICAgICAqIGludGVuc2l0eSA8IGluRmlyc3QgYW5kIHdpdGggdG9sIGVycm9yCiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IHRvbAogICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBpbkZpcnN0CiAgICAgICAgICogQHJldHVybiBhbiBpbnRlZ2VyIGNvdW50CiAgICAgICAgICovCiAgICAgICAgdW5tYXRjaGVkRmFjdG9yIDogZnVuY3Rpb24odG9sLCBpbkZpcnN0KSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIG1hdGNoZXMgPSBzZWxmLmNsb3NlclRoYW5QUE0odG9sKTsKCiAgICAgICAgICAgIHZhciBwa3MgPSBfLmZpbHRlcihfLnppcChzZWxmLmdldCgnZXhwU3BlY3RydW0nKS5nZXQoJ21venMnKSwgc2VsZi5nZXQoJ2V4cFNwZWN0cnVtJykuZ2V0KCdpbnRlbnNpdHlSYW5rcycpKSwgZnVuY3Rpb24ocCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHBbMV0gPCBpbkZpcnN0CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgdmFyIG1QcmVjID0gc2VsZi5nZXQoJ2V4cFNwZWN0cnVtJykuZ2V0KCdwcmVjTW96JykKICAgICAgICAgICAgcmV0dXJuIF8uZmlsdGVyKHBrcywgZnVuY3Rpb24ocCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHBbMF0gPiBtUHJlYzsKICAgICAgICAgICAgfSkubGVuZ3RoIC0gXy5maWx0ZXIobWF0Y2hlcywgZnVuY3Rpb24obSkgewogICAgICAgICAgICAgICAgcmV0dXJuIChtLmV4cC5pbnRlbnNpdHlSYW5rIDwgaW5GaXJzdCkgJiYgKG0uZXhwLm1veiA+IG1QcmVjKTsKICAgICAgICAgICAgfSkubGVuZ3RoCgogICAgICAgIH0KICAgIH0pOwogICAKICAgIHJldHVybiBQU01BbGlnbm1lbnQ7Cn0pOwoKLyoqCiAqIGFuIEltcGxpY2l0TW9kaWZpZXIgaXMgdG8gYmUgbGlua2VkIHRvIGxhYmVsbGluZyBvciB0byBhIGdsb2JhbCBhdHRyaWJ1dGlvbiBvZiBtb2RpZmljYXRpb24uCiAqIEl0IGVhc2llciB0byBzYXkgYSBwZXB0aWRlIGlzIFNpbGFjIGVpdGhlciB0aGFuIGFkZGluZyBTaWxhYyBtYXNzIHNoaWZ0IG9pbiBldmVyeSBLICYgUi4KICogVGhpcyBjYW4gYmUgZXZlbiBsaWdodGVyIHdpdGggMTNDMTVOIGxhYmVsLCB3aGVyZSBldmVyeSBhbWlubyBhY2lkIGlzIG1vZGlmaWVkIHdpdGggYSBtYXNzIHNoaWZ0IChyZXByZXNlbnRlZCBhcyBhIHJlc2lkdWUgbW9kaWZpY2F0aW9uKS4KICogTXVsdGlwbGUgbGFiZWxzIGNhbiBiZSBhcHBsaWVkIG9uIHRoZSBzYW1lIHNlcXVlbmNlICh0aGVyZSBpcyBhIGRlZmluZWQgbGlzdCBvZiBwcmVjZWRlbmNlKQogKgogKiBJbXBsaWNpdE1vZGlmaWVyIGhhcyB0byBrbm93IHRoZSBvZGRzIG9mIGVhY2ggbGFiZWxpbmcgbWV0aG9kLiBGb3IgZXhhbXBsZSwgSyBjYW4gc3RpbGwgYmUgcHJvcGlvbnlsYXRlZCBpZiBpdCBoYXMgYSBNZXRoeWwsIGJ1dCBub3QgYSBEaW1ldGh5bC4KICoKICogVGhlIG1haW4gbWV0aG9kIGFyZQogKiBsYWJlbChsYWJOYW1lLCByaWNoU2VxKTogYWRkIGFsbCB0aGUgbGFiZWwgbW9kaWZpY2F0aW9uIHRvIGEgZ2l2ZW4gcGVwdGlkZQogKiB1bmxhYmVsKGxhYk5hbSwgcmljaFNlcXVlbmNlKTogcmVtb3ZlIHRoZSBtb2RpZmljYXRpb24gdGlnaHRlbiB0byB0aGlzIGxhYmVsIChpZiB0aGVyZSB3ZXJlIGVub3VnaCB0byBsYWJlbCB0aGUgc2VxdWVuY2UpLgogKiBnZXRMYWJlbChyaWNoU2VxKTogZ2V0IHRoZSBsYWJlbCBmaXR0aW5nIHRoZSBnaXZlbiByaWNoU2VxdWVuY2UKICoKICogVGhlcmUgaXMgYSB2YXN0IHNldCBvZiB0ZXN0IGF2YWlsYWJsZSBpbiB0aGUgSW1wbGljaXRNb2RpZmllci10ZXN0cy5qcwogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KZGVmaW5lKCdmaXNodG9uZXMvc2VydmljZXMvZHJ5L0ltcGxpY2l0TW9kaWZpZXInLFsnanF1ZXJ5JywgJ3VuZGVyc2NvcmUnLCAnQmFja2JvbmUnLCAnZmlzaHRvbmVzL21vZGVscy9kcnkvUmljaFNlcXVlbmNlJywgJ2Zpc2h0b25lcy9jb2xsZWN0aW9ucy9kcnkvUmVzaWR1ZU1vZGlmaWNhdGlvbkRpY3Rpb25hcnknXSwgZnVuY3Rpb24gKCQsIF8sIEJhY2tib25lLCBSaWNoU2VxdWVuY2UsIGRpY29SZXNNb2QpIHsKCiAgICAvKioKICAgICAqIGxhYmVsZXJzIGFyZSB0aGUgZXNzZW5jZSBvZiB0aGUgaW1wbGljaXQgbGFiZWxsaW5nCiAgICAgKiB0aGV5IGFyZSBmdW5jdGlvbnMsIGRlZmluZWQgZm9yIGVhY2ggcHJvcCwgcHJvcF9kMTAsIHNpbGFjIG9yIHdoYXRldmVyLCB0aGF0IHRha2UgYSByaWNoU2VxdWVuZWNlIGFuZCBhIHBvc2l0aW9uIGFuZCByZXR1cm4gYSBtb2RpZmljYXRpb24gKG9yIHVuZGVmaW5lZCkgdGhhdCBzaG91bGQgb2NjdXIgdGhlcmUuCiAgICAgKiBXZSBuZWVkIGFsbCB0aGF0IGJlY2F1c2UgZm9yIGV4YW1wbGUgZm9yIHByb3Bpb255bGF0aW9uLCB3ZSBtdXN0IGtub3cgaWYgdGhlcmUgaXMgYWxyZWFkbiBhIG1vbm8tIG9yIGEgZGktbWV0aHlsYXRpb24gb24gdGhlIHNpdGUuLi4KICAgICAqCiAgICAgKiBwcm9waW9ueWxMYWJlbGVyIGlzIGp1c3QgYW4gcHJpdmF0ZSBmdW5jdGlvbiB0byBsYWJlbCBLICsgbnRlcm0gd2l0aCBwcm9waW9ueWwgZDAgb3IgZDUKICAgICAqLwoKICAgIHZhciBhcXVhTW9kaWZzID0ge307CiAgICBfLmVhY2goJ1ZETElUR0ZBWScuc3BsaXQoJycpLCBmdW5jdGlvbihhYSl7CiAgICAJYXF1YU1vZGlmc1thYV0gPSAgZGljb1Jlc01vZC5nZXQoJ0FRVUFfJythYSkKICAgIH0pOwogICAgXy5lYWNoKGFxdWFNb2RpZnMsIGZ1bmN0aW9uKG1vZCwgYWEpIHsKICAgICAgICBkaWNvUmVzTW9kLmFkZCh7CiAgICAgICAgICAgIG5hbWUgOiAnZGVfJyArIG1vZC5nZXQoJ25hbWUnKSwKICAgICAgICAgICAgZnVsbE5hbWUgOiAnZGVfJyArIG1vZC5nZXQoJ2Z1bGxOYW1lJyksCiAgICAgICAgICAgIG1hc3MgOiAtbW9kLmdldCgnbWFzcycpCiAgICAgICAgfSk7CiAgICB9KQogICAgdmFyIHByb3Bpb255bExhYmVsZXIgPSBmdW5jdGlvbihwbW9kKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHJpY2hTZXEsIHBvcykgewogICAgICAgICAgICBpZiAocG9zID09IC0xKSB7CiAgICAgICAgICAgICAgICBpZiAocmljaFNlcS5jb3VudE1vZGlmaWNhdGlvbnNBdCgtMSkgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIG1vZHMgPSByaWNoU2VxLm1vZGlmQXQoLTEpOwogICAgICAgICAgICAgICAgICAgIGlmIChtb2RzLmxlbmd0aCA9PSAxICYmIG1vZHNbMF0gPT0gcG1vZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcG1vZDsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHBtb2Q7CiAgICAgICAgICAgICAgICAvLyhyaWNoU2VxLmNvdW50TW9kaWZpY2F0aW9uc0F0KC0xKSA+IDApID8gdW5kZWZpbmVkIDogcG1vZAogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChwb3MgPT0gcmljaFNlcS5zaXplKCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHJpY2hTZXEuYWFBdChwb3MpLmdldCgnY29kZTEnKSA9PT0gJ0snKSB7CiAgICAgICAgICAgICAgICBpZiAoXy5hbnkocmljaFNlcS5tb2RpZkF0KHBvcyksIGZ1bmN0aW9uKHJtKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICEvKE1ldGh5bHxQcm9waW9ueWwuKikvLnRlc3Qocm0uZ2V0KCduYW1lJykpOwogICAgICAgICAgICAgICAgfSkpIHsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBtb2Q7CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9OwogICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgICAgIH0KICAgIH07CgogICAgdmFyIGxhYmVsZXJzID0gewogICAgICAgIG5vbmUgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgICB9LAogICAgICAgIHByb3BfZDAgOiBwcm9waW9ueWxMYWJlbGVyKGRpY29SZXNNb2QuZ2V0KCdQcm9waW9ueWwnKSksCiAgICAgICAgcHJvcF9kNSA6IHByb3Bpb255bExhYmVsZXIoZGljb1Jlc01vZC5nZXQoJ1Byb3Bpb255bDoySCg1KScpKSwKICAgICAgICAnMTNDMTVOJyA6IGZ1bmN0aW9uKHJpY2hTZXEsIHBvcykgewogICAgICAgICAgICBpZiAocG9zID09IC0xIHx8IHBvcyA9PSByaWNoU2VxLnNpemUoKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZAogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgYWEgPSByaWNoU2VxLmFhQXQocG9zKS5nZXQoJ2NvZGUxJyk7CiAgICAgICAgICAgIHJldHVybiBkaWNvUmVzTW9kLmdldCgnMTNDMTVOLScgKyBhYSk7CiAgICAgICAgfSwKICAgICAgICAnYXF1YScgOiBmdW5jdGlvbihyaWNoU2VxLCBwb3MpIHsKICAgICAgICAgICAgaWYgKHBvcyA9PSAtMSB8fCBwb3MgPT0gcmljaFNlcS5zaXplKCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGFxdWFNb2RpZnNbcmljaFNlcS5hYUF0KHBvcykuZ2V0KCdjb2RlMScpXTsKICAgICAgICB9LAogICAgICAgICdkZV9hcXVhJyA6IGZ1bmN0aW9uKHJpY2hTZXEsIHBvcykgewogICAgICAgICAgICBpZiAocG9zID09IC0xIHx8IHBvcyA9PSByaWNoU2VxLnNpemUoKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGFtID0gXy5maWx0ZXIocmljaFNlcS5tb2RpZkF0KHBvcyksIGZ1bmN0aW9uKHJtKXsKICAgICAgICAgICAgICAgIHJldHVybiBybS5nZXQoJ25hbWUnKS5pbmRleE9mKCdBUVVBXycpID09PSAwOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIH0pWzBdOwogICAgICAgICAgICBpZihhbSA9PT0gdW5kZWZpbmVkICl7CiAgICAgICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBkaWNvUmVzTW9kLmdldCgnZGVfJythbS5nZXQoJ25hbWUnKSk7CiAgICAgICAgfSwKICAgICAgICBzaWxhYyA6IGZ1bmN0aW9uKHJpY2hTZXEsIHBvcykgewogICAgICAgICAgICBpZiAocG9zID09IC0xIHx8IHBvcyA9PSByaWNoU2VxLnNpemUoKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZAogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgYWEgPSByaWNoU2VxLmFhQXQocG9zKS5nZXQoJ2NvZGUxJyk7CgogICAgICAgICAgICBpZiAoYWEgPT09ICdLJykgewogICAgICAgICAgICAgICAgcmV0dXJuIGRpY29SZXNNb2QuZ2V0KCdMYWJlbDoxM0MoNikxNU4oMiknKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoYWEgPT09ICdSJykgewogICAgICAgICAgICAgICAgcmV0dXJuIGRpY29SZXNNb2QuZ2V0KCdMYWJlbDoxM0MoNikxNU4oNCknKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgICAgICAgICB1bmRlZmluZWQKICAgICAgICB9LAogICAgICAgICdzdXBlcl9zaWxhYycgOiBmdW5jdGlvbihyaWNoU2VxLCBwb3MpIHsKICAgICAgICAgICAgaWYgKHBvcyA9PSAtMSB8fCBwb3MgPT0gcmljaFNlcS5zaXplKCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBhYSA9IHJpY2hTZXEuYWFBdChwb3MpLmdldCgnY29kZTEnKTsKCiAgICAgICAgICAgIGlmIChhYSA9PT0gJ0snKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZGljb1Jlc01vZC5nZXQoJ0xhYmVsOjEzQyg2KTE1TigyKScpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICAgICAgfQogICAgfTsKICAgIGxhYmVsZXJzLnByb3BfZDVfbnRlcm0gPSBmdW5jdGlvbihyaWNoU2VxLCBwb3MpIHsKICAgICAgICBpZiAocG9zID09IC0xKSB7CiAgICAgICAgICAgIHJldHVybiBkaWNvUmVzTW9kLmdldCgnUHJvcGlvbnlsOjJIKDUpJyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBsYWJlbGVycy5wcm9wX2QwKHJpY2hTZXEsIHBvcyk7CiAgICB9OwogICAgbGFiZWxlcnMucGljID0gZnVuY3Rpb24ocmljaFNlcSwgcG9zKSB7CiAgICAgICAgaWYgKHBvcyAhPSAtMSkgewogICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkCiAgICAgICAgfQogICAgICAgIHJldHVybiBkaWNvUmVzTW9kLmdldCgnUElDJyk7CiAgICAgICAgLy9yZXR1cm4gKHJpY2hTZXEuY291bnRNb2RpZmljYXRpb25zQXQoLTEpID4gMCkgPyB1bmRlZmluZWQgOiBkaWNvUmVzTW9kLmdldCgnUElDJyk7CiAgICB9OwogICAgbGFiZWxlcnMucGljX2hlYXZ5ID0gZnVuY3Rpb24ocmljaFNlcSwgcG9zKSB7CiAgICAgICAgaWYgKHBvcyAhPSAtMSkgewogICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkCiAgICAgICAgfQogICAgICAgIHJldHVybiBkaWNvUmVzTW9kLmdldCgnUElDX0hFQVZZJyk7CiAgICAgICAgLy9yZXR1cm4gKHJpY2hTZXEuY291bnRNb2RpZmljYXRpb25zQXQoLTEpID4gMCkgPyB1bmRlZmluZWQgOiBkaWNvUmVzTW9kLmdldCgnUElDJyk7CiAgICB9OwogICAgdmFyIGxhYmVsZXJzT3JkZXIgPSB7CiAgICAgICAgJzEzQzE1TicgOiAzLAogICAgICAgICdhcXVhJyA6IDQsCiAgICAgICAgJ2RlX2FxdWEnIDogNCwKICAgICAgICBwcm9wX2QwIDogMTAsCiAgICAgICAgcHJvcF9kNSA6IDksCiAgICAgICAgcHJvcF9kNV9udGVybSA6IDE1LAogICAgICAgIHBpYyA6IDUsCiAgICAgICAgcGljX2hlYXZ5IDogNSwKICAgICAgICBzaWxhYyA6IDEwMCwKICAgICAgICBzdXBlcl9zaWxhYyA6IDkwLAogICAgICAgIG5vbmUgOiAxMDAwCiAgICB9CgogICAgSW1wbGljaXRNb2RpZmllciA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICBzZWxmLmxhYmVsZXJzID0gbGFiZWxlcnM7CiAgICAgICAgc2VsZi5sYWJlbGVyc09yZGVyID0gbGFiZWxlcnNPcmRlcjsKCiAgICAgICAgcmV0dXJuIHNlbGYKICAgIH07CgogICAgLyoqCiAgICAgKiBBZGQgYWxsIG1vZGlmaWNhdGlvbiBhc3NvY2lhdGVkIHRvIHRoZSBsYWJlbCBvbiB0aGUgcmljaFNlcXVlbmNlIG9iamVjdAogICAgICogQHBhcmFtIHtPYmplY3R9IGxhYmVsTmFtZXMgYSBjb21tYSBzZXBhcmF0ZWQgbGlzdCBvZiBsYWJlbHMsIG9yIGFuIGFycmF5IG9mIHN0cmluZyAod2UgY2FuIGhhdmUgJ3NpbGFjLHByb3BfZDAnLCBvciAncHJvcF9kNScpCiAgICAgKiBAcGFyYW0ge09iamVjdH0gcmljaFNlcXVlbmNlCiAgICAgKi8KICAgIEltcGxpY2l0TW9kaWZpZXIucHJvdG90eXBlLmxhYmVsID0gZnVuY3Rpb24obGFiZWxOYW1lcywgcmljaFNlcXVlbmNlKSB7CiAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgIHZhciBzID0gcmljaFNlcXVlbmNlLnNpemUoKTsKICAgICAgICBpZiAoISBfLmlzQXJyYXkobGFiZWxOYW1lcykpIHsKICAgICAgICAgICAgbGFiZWxOYW1lcyA9IGxhYmVsTmFtZXMuc3BsaXQoJywnKQogICAgICAgIH0KICAgICAgICBfLmVhY2goXy5zb3J0QnkobGFiZWxOYW1lcywgZnVuY3Rpb24obG5hbWUpIHsKICAgICAgICAgICAgcmV0dXJuIHNlbGYubGFiZWxlcnNPcmRlcltsbmFtZV0gfHwgMTAwMDAwOwogICAgICAgIH0pLCBmdW5jdGlvbihsbmFtZSkgewogICAgICAgICAgICBmb3IgKHZhciBpID0gLTE7IGkgPD0gczsgaSsrKSB7CiAgICAgICAgICAgICAgICB2YXIgbSA9IHNlbGYubGFiZWxlcnNbbG5hbWVdKHJpY2hTZXF1ZW5jZSwgaSk7CiAgICAgICAgICAgICAgICBpZiAobSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgcmljaFNlcXVlbmNlLmFkZE1vZGlmaWNhdGlvbihpLCBtKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0pCiAgICB9CiAgICAvKioKICAgICAqIGp1c3QgcmV0dXJucyBhIHNvcnRlZCAoYWxwaGFudW1lcmljKSBsaXN0IG9mIHRoZSBhdmFpbGFibGUgbGFiZWxzCiAgICAgKi8KICAgIEltcGxpY2l0TW9kaWZpZXIucHJvdG90eXBlLmF2YWlsYWJsZUxhYmVscyA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBfLmtleXModGhpcy5sYWJlbGVycykuc29ydCgpOwogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmUgYWxsIG1vZGlmaWNhdGlvbiBhc3NvY2lhdGVkIHRvIHRoZSBsYWJlbCBvbiB0aGUgcmljaFNlcXVlbmNlIG9iamVjdC4KICAgICAqIEF0IHRoaXMgc3RhZ2UsIHdlIGFzc3VtZSB0aGUgcmljaFNlcXVlbmNlIGhhcyB0aGUgbW9kaWYgYXNzb2NpYXRlZCB3aXRoIHRoZSBsYWJlbAogICAgICogQHBhcmFtIHtPYmplY3R9IGxhYmVsTmFtZXMgYSBjb21tYSBzZXBhcmF0ZWQgbGlzdCBvZiBsYWJlbHMgKHdlIGNhbiBoYXZlICdzaWxhYyxwcm9wX2QwJywgb3IgJ3Byb3BfZDEwJykKICAgICAqIEBwYXJhbSB7T2JqZWN0fSByaXNoU2VxdWVuY2UKICAgICAqLwogICAgSW1wbGljaXRNb2RpZmllci5wcm90b3R5cGUudW5sYWJlbCA9IGZ1bmN0aW9uKGxhYmVsTmFtZXMsIHJpY2hTZXF1ZW5jZSkgewogICAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgICAgdmFyIHMgPSByaWNoU2VxdWVuY2Uuc2l6ZSgpOwogICAgICAgIGlmICghIF8uaXNBcnJheShsYWJlbE5hbWVzKSkgewogICAgICAgICAgICBsYWJlbE5hbWVzID0gbGFiZWxOYW1lcy5zcGxpdCgnLCcpCiAgICAgICAgfQogICAgICAgIF8uZWFjaChfLnNvcnRCeShsYWJlbE5hbWVzLCBmdW5jdGlvbihsbmFtZSkgewogICAgICAgICAgICByZXR1cm4gLShzZWxmLmxhYmVsZXJzT3JkZXJbbG5hbWVdIHx8IDEwMDAwMCk7CiAgICAgICAgfSksIGZ1bmN0aW9uKGxuYW1lKSB7CiAgICAgICAgICAgIGZvciAoIGkgPSAtMTsgaSA8PSBzOyBpKyspIHsKICAgICAgICAgICAgICAgIHZhciBtb2RpZnMgPSByaWNoU2VxdWVuY2UuZ2V0TW9kaWZpY2F0aW9uQXJyYXkoaSk7CiAgICAgICAgICAgICAgICBpZiAoIW1vZGlmcykgewogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbW9kaWZzID0gXy5kaWZmZXJlbmNlKG1vZGlmcywgc2VsZi5sYWJlbGVyc1tsbmFtZV0ocmljaFNlcXVlbmNlLCBpKSk7CiAgICAgICAgICAgICAgICByaWNoU2VxdWVuY2Uuc2V0TW9kaWZpY2F0aW9uQXJyYXkoaSwgbW9kaWZzKQoKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfQogICAgLyoqCiAgICAgKiByZXR1cm5zIGFuIGFycmF5IHdpdGggdGhlIG1vZGlmaWVkIHBvaXNpdGlvbnMsIG9uY2UgbGFiZWluZyBtb2RpZiBoYXZlIGJlZW4gcmVtb3ZlZAogICAgICogKC0xID0+IG50ZXJtKQogICAgICovCiAgICBJbXBsaWNpdE1vZGlmaWVyLnByb3RvdHlwZS5ub25pbXBsaWNpdE1vZGlmaWVkUG9zID0gZnVuY3Rpb24ocmljaFNlcXVlbmNlKSB7CiAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgIHZhciBycyA9IHJpY2hTZXF1ZW5jZS5jbG9uZSgpOwogICAgICAgIHNlbGYuZ2V0TGFiZWxzQW5kQ2xlYW4ocnMpOwogICAgICAgIHJldHVybiBfLmZpbHRlcihfLnJhbmdlKC0xLCBycy5zaXplKCkpLCBmdW5jdGlvbihpKSB7CiAgICAgICAgICAgIHJldHVybiBycy5jb3VudE1vZGlmaWNhdGlvbnNBdChpKSA+IDA7CiAgICAgICAgfSkKICAgIH0KICAgIC8qKgogICAgICogcmV0dXJuIHRydWUvZmFsc2UgaWYgdGhlIFJpY2hTZXF1ZW5jZSBpcyBmaWxsZWQgd2l0aCB0aGUgbW9kaWZpY2F0aW9uIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGdpdmVuIGxhYmVsLgogICAgICogaS5lLiB3ZSBjYW4gcmVtb3ZlIGFsbCB0aGUgbW9kaWYgYW5kIGNvbnNpZGVyIHRoZSBSaWNoU2VxdWVuY2UgYXMgaW1wbGljaXRlbHkgbW9kaWZpZWQKICAgICAqIEBwYXJhbSB7T2JqZWN0fSBsYWJlbE5hbWUgb25lIGxhYmVsIG5hbWUKICAgICAqIEBwYXJhbSB7T2JqZWN0fSByaXNoU2VxdWVuY2UKICAgICAqLwogICAgSW1wbGljaXRNb2RpZmllci5wcm90b3R5cGUuaXNMYWJlbGVkID0gZnVuY3Rpb24obGFiZWxOYW1lLCByaWNoU2VxdWVuY2UpIHsKICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICAgIHZhciBhdExlYXN0T25lID0gZmFsc2UKICAgICAgICByZXR1cm4gXy5hbGwoXy5yYW5nZSgtMSwgcmljaFNlcXVlbmNlLnNpemUoKSArIDEpLCBmdW5jdGlvbihpKSB7CiAgICAgICAgICAgIHZhciBleHBlY3RlZE1vZGlmID0gc2VsZi5sYWJlbGVyc1tsYWJlbE5hbWVdKHJpY2hTZXF1ZW5jZSwgaSk7CiAgICAgICAgICAgIGlmIChleHBlY3RlZE1vZGlmID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChyaWNoU2VxdWVuY2UuY291bnRNb2RpZmljYXRpb25zQXQoaSkgPT0gMCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBhdExlYXN0T25lID0gdHJ1ZTsKCiAgICAgICAgICAgIHJldHVybiBfLmFueShyaWNoU2VxdWVuY2UuZ2V0TW9kaWZpY2F0aW9uQXJyYXkoaSksIGZ1bmN0aW9uKG0pIHsKICAgICAgICAgICAgICAgIHJldHVybiBtID09IGV4cGVjdGVkTW9kaWY7CiAgICAgICAgICAgIH0pOwoKICAgICAgICB9KSAmJiBhdExlYXN0T25lOwoKICAgIH0KICAgIC8qKgogICAgICogY2xlYW4gdXAgdGhlIGltcGxpY2l0IG1vZGlmaWNhdGlvbnMgIGFuZCByZXR1cm4gYSBsaXN0IG9mIChzb3J0ZWQgYWxwaGEpIGxhYmVsIG5hbWVzIHRoYXQgd2VyZSB1c2VkIGZvciBjbGVhbnVwCiAgICAgKiBAcGFyYW0ge09iamVjdH0gcmljaFNlcXVlbmNlCiAgICAgKi8KICAgIEltcGxpY2l0TW9kaWZpZXIucHJvdG90eXBlLmdldExhYmVsc0FuZENsZWFuID0gZnVuY3Rpb24ocmljaFNlcXVlbmNlKSB7CiAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICB2YXIgbGFiZWxzID0gW107CiAgICAgICAgXy5lYWNoKF8uc29ydEJ5KF8ua2V5cyhzZWxmLmxhYmVsZXJzT3JkZXIpLCBmdW5jdGlvbihsbmFtZSkgewogICAgICAgICAgICByZXR1cm4gLShzZWxmLmxhYmVsZXJzT3JkZXJbbG5hbWVdIHx8IDEwMDAwMCk7CiAgICAgICAgfSksIGZ1bmN0aW9uKGxuYW1lKSB7CiAgICAgICAgICAgIGlmICghc2VsZi5pc0xhYmVsZWQobG5hbWUsIHJpY2hTZXF1ZW5jZSkpIHsKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIHNlbGYudW5sYWJlbChsbmFtZSwgcmljaFNlcXVlbmNlKTsKICAgICAgICAgICAgbGFiZWxzLnB1c2gobG5hbWUpCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIGxhYmVscy5zb3J0KCkKICAgIH0KICAgIHJldHVybiBuZXcgSW1wbGljaXRNb2RpZmllcigpOwp9KTsKCi8qKgogKiBhIHJlY3Rhbmd1bGFyLCBubyBsZWdlbmQgY29sb3IgUFNNQWxpZ25tZW50IHdpZGdldAogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KCmRlZmluZSgnZmlzaHRvbmVzL3ZpZXdzL21hdGNoL01hdGNoTWFwU2xpbVZpZXcnLFsndW5kZXJzY29yZScsICdCYWNrYm9uZScsICcuLi9jb21tb25zL0NvbW1vbldpZGdldFZpZXcnLCAnZmlzaHRvbmVzL3NlcnZpY2VzL2RyeS9JbXBsaWNpdE1vZGlmaWVyJ10sIGZ1bmN0aW9uKF8sIEJhY2tib25lLCBDb21tb25XaWRnZXRWaWV3LCBpbXBsaWNpdE1vZGlmaWVyKSB7CgogICAgTWF0Y2hNYXBTbGltVmlldyA9IENvbW1vbldpZGdldFZpZXcuZXh0ZW5kKHsKICAgICAgICBkZWZhdWx0cyA6IHsKICAgICAgICAgICAgaGVpZ2h0IDogMTIsCiAgICAgICAgICAgIHRvbCA6IDUwMAogICAgICAgIH0sCiAgICAgICAgaW5pdGlhbGl6ZSA6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgICAgICAgTWF0Y2hNYXBTbGltVmlldy5fX3N1cGVyX18uaW5pdGlhbGl6ZS5jYWxsKHRoaXMsIGFyZ3VtZW50cykKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICBzZWxmLmhlaWdodCA9IG9wdGlvbnMuaGVpZ2h0IHx8IDEyOwogICAgICAgICAgICBzZWxmLnRvbCA9IG9wdGlvbnMudG9sIHx8IDUwMDsKCiAgICAgICAgfSwKICAgICAgICByZW5kZXIgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICAgICAgdmFyIHRoZW9TcGVjdHJ1bSA9IHNlbGYubW9kZWwuZ2V0KCd0aGVvU3BlY3RydW0nKTsKICAgICAgICAgICAgdmFyIG5iU2VyaWVzID0gdGhlb1NwZWN0cnVtLmdldCgnZnJhZ1NlcmllcycpLmxlbmd0aAoKICAgICAgICAgICAgLy8gZ2V0IGZyYWcgc2VyaWVzIC0+IG9yZGluYXRlCiAgICAgICAgICAgIHZhciBzZXJpZXMyaiA9IHt9OwogICAgICAgICAgICB2YXIgaSA9IDA7CiAgICAgICAgICAgIF8uZWFjaCh0aGVvU3BlY3RydW0uZ2V0KCdmcmFnU2VyaWVzJyksIGZ1bmN0aW9uKGZzKSB7CiAgICAgICAgICAgICAgICBpZiAoc2VyaWVzMmpbZnNbMF1dICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHNlcmllczJqW2ZzWzBdXSA9IGkrKzsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB2YXIgaFJvdyA9IHNlbGYuaGVpZ2h0IC8gXy5rZXlzKHNlcmllczJqKS5sZW5ndGg7CiAgICAgICAgICAgIHZhciB3Q29sID0gaFJvdzsKCiAgICAgICAgICAgIHZhciBsZW5TZXEgPSB0aGVvU3BlY3RydW0uZ2V0KCdsZW5TZXEnKTsKICAgICAgICAgICAgdmFyIHdUZXh0ID0gMzA7CiAgICAgICAgICAgIHZhciB3aWR0aCA9IGxlblNlcSAqIHdDb2wgKyB3VGV4dDsKICAgICAgICAgICAgdmFyIGhlaWdodCA9IHNlbGYuaGVpZ2h0OwoKICAgICAgICAgICAgdmFyIGZzMmogPSBmdW5jdGlvbihmcykgewogICAgICAgICAgICAgICAgcmV0dXJuIChzZXJpZXMyaltmc1swXV0pICogaFJvdzsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBkYXRhIG1hdGNoZXMKICAgICAgICAgICAgdmFyIGRtYXRjaGVzID0gc2VsZi5tb2RlbC5jbG9zZXJUaGFuUFBNKHNlbGYudG9sKTsKCiAgICAgICAgICAgIHZhciByZWN0QmcgPSBzZWxmLmVsLmFwcGVuZCgncmVjdCcpLmF0dHIoJ2NsYXNzJywgJ2JhY2tncm91bmQnKS5hdHRyKCd3aWR0aCcsIHdpZHRoKS5hdHRyKCdoZWlnaHQnLCBoZWlnaHQpCiAgICAgICAgICAgIHZhciBnUm9vdCA9IHNlbGYuZWwuYXBwZW5kKCdnJykuYXR0cignY2xhc3MnLCAnZnJhZy1jb2xvci1tYXRjaCcpOwogICAgICAgICAgICBwcmVjdCA9IGdSb290LnNlbGVjdEFsbCgncmVjdCcpLmRhdGEoZG1hdGNoZXMpLmVudGVyKCkKICAgICAgICAgICAgcHJlY3QuYXBwZW5kKCdyZWN0JykuYXR0cignY2xhc3MnLCBmdW5jdGlvbihkbSkgewogICAgICAgICAgICAgICAgdmFyIGlyayA9IGRtLmV4cC5pbnRlbnNpdHlSYW5rOwogICAgICAgICAgICAgICAgcmV0dXJuICJyay0iICsgKChpcmsgPCA0MCkgPyBNYXRoLmZsb29yKGlyayAvIDEwKSA6ICd4JykKICAgICAgICAgICAgfSkuYXR0cigneCcsIGZ1bmN0aW9uKGRtKSB7CiAgICAgICAgICAgICAgICBpZiAoZG0udGhlby5zZXJpZXMgPCAnZycpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChkbS50aGVvLnBvcyArIDAuNSkgKiB3Q29sCiAgICAgICAgICAgICAgICBpZiAoZG0udGhlby5wb3MgPT0gMCkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gMAogICAgICAgICAgICAgICAgcmV0dXJuIChkbS50aGVvLnBvcyAtIDAuNSkgKiB3Q29sCiAgICAgICAgICAgIH0pLmF0dHIoJ3knLCBmdW5jdGlvbihkbSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZzMmooZG0udGhlby5zZXJpZXMpCiAgICAgICAgICAgIH0pLmF0dHIoJ3dpZHRoJywgZnVuY3Rpb24oZG0pIHsKICAgICAgICAgICAgICAgIGlmICgoZG0udGhlby5wb3MgPT0gMCkgJiYgKGRtLnRoZW8uc2VyaWVzID4gJ2cnKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gd0NvbCAvIDI7CiAgICAgICAgICAgICAgICBpZiAoKGRtLnRoZW8ucG9zID09IGxlblNlcSAtIDEpICYmIChkbS50aGVvLnNlcmllcyA8ICdnJykpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdDb2wgLyAyOwogICAgICAgICAgICAgICAgcmV0dXJuIHdDb2w7CiAgICAgICAgICAgIH0pLmF0dHIoJ2hlaWdodCcsIGhSb3cpLmF0dHIoJ3RpdGxlJywgZnVuY3Rpb24oZG0pIHsKICAgICAgICAgICAgICAgIHJldHVybiBkbS50aGVvLmxhYmVsCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgdmFyIG1vZFBvcyA9IGltcGxpY2l0TW9kaWZpZXIubm9uaW1wbGljaXRNb2RpZmllZFBvcyhzZWxmLm1vZGVsLmdldCgncmljaFNlcXVlbmNlJykpOwogICAgICAgICAgICBnUm9vdC5zZWxlY3RBbGwoJ3JlY3QubW9kaWZpZWQtc2l0ZScpLmRhdGEobW9kUG9zKS5lbnRlcigpLmFwcGVuZCgncmVjdCcpLmNsYXNzZWQoJ21vZGlmaWVkLXNpdGUnLCB0cnVlKS5hdHRyKCd4JywgZnVuY3Rpb24oaSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGkgKiB3Q29sOwogICAgICAgICAgICB9KS5hdHRyKCd5JywgMCkuYXR0cignaGVpZ2h0Jywgc2VsZi5oZWlnaHQpLmF0dHIoJ3dpZHRoJywgd0NvbCk7CgogICAgICAgICAgICB2YXIgZyA9IHNlbGYuZWwuYXBwZW5kKCdnJykuYXR0cigndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZSgnICsgKHdpZHRoIC0gd1RleHQpICsgJywwKScpOwogICAgICAgICAgICBnLmFwcGVuZCgncmVjdCcpLmNsYXNzZWQoJ21hdGNoLWJveC10ZXh0LWJnJywgdHJ1ZSkuYXR0cignd2lkdGgnLCB3VGV4dCkuYXR0cignaGVpZ2h0Jywgc2VsZi5oZWlnaHQpOwogICAgICAgICAgICAKICAgICAgICAgICAgZy5hcHBlbmQoJ2cnKS5hdHRyKCd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlKCcrKHdUZXh0IC0gNSkrJywyKSxzY2FsZSgnK2hlaWdodCsnLCcraGVpZ2h0KycpJykuCiAgICAgICAgICAgIGFwcGVuZCgndGV4dCcpLmNsYXNzZWQoJ3VubWF0Y2hlZC1mYWN0b3InLCB0cnVlKS50ZXh0KCIvIiArIHNlbGYubW9kZWwudW5tYXRjaGVkRmFjdG9yKHNlbGYudG9sLCAxMCkpCgogICAgICAgICAgICBzZWxmLmRpbSA9IHsKICAgICAgICAgICAgICAgIGhlaWdodCA6IHNlbGYuaGVpZ2h0LAogICAgICAgICAgICAgICAgd2lkdGggOiB3aWR0aAogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBzZWxmLmRpbQogICAgICAgIH0KICAgIH0pOwoKICAgIHJldHVybiBNYXRjaE1hcFNsaW1WaWV3Owp9KTsKCi8qKgogKiBUaGUgUFEgd2lkZ2V0IChQUSA9ICJ0b2lsZXQgcGFwZXIiIGluIGZyZW5jaCkgaXMgZGlzayBwcm9qZWN0ZWQgZGF0YSwgd2hpY2ggY2FuIGJlIHB1bGxlZCBvZiB3aGVuIG1vdXNpbmcgb3ZlcgogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KCmRlZmluZSgnZmlzaHRvbmVzL3ZpZXdzL3V0aWxzL1BRVmlldycsWyd1bmRlcnNjb3JlJywgJ2QzJ10sIGZ1bmN0aW9uKF8sIGQzKSB7CgogIFBRVmlldyA9IGZ1bmN0aW9uKHRhcmdldCwgb3B0aW9ucykgewogICAgb3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCBvcHRpb25zKTsKICAgIHRoaXMucmFkaXVzID0gb3B0aW9ucy5yYWRpdXMgfHwgNTA7CiAgICB0aGlzLnRpbWUgPSBvcHRpb25zLnRpbWUgfHwgMTI1OwogICAgdGhpcy5yb3RhdGluZyA9IDA7CiAgICB0aGlzLm9uY2xpY2sgPSBvcHRpb25zLm9uY2xpY2s7CgogICAgaWYgKCB0eXBlb2YgdGFyZ2V0ID09ICdvYmplY3QnKSB7CiAgICAgIHRoaXMudmlzID0gdGFyZ2V0LmFwcGVuZCgnZycpCgogICAgfSBlbHNlIHsKICAgICAgdGhpcy52aXMgPSBkMy5zZWxlY3QodGFyZ2V0KS5hcHBlbmQoJ2cnKQogICAgfQogIH0KCiAgUFFWaWV3LnByb3RvdHlwZS5idWlsZCA9IGZ1bmN0aW9uKHNlY3RvckNsYXNzZXMsIHJlY3RCdWlsZEZ1bmN0aW9uKSB7CiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICBzZWxmLmxlbiA9IHNlY3RvckNsYXNzZXMubGVuZ3RoOwogICAgc2VsZi5zZWN0b3JDbGFzc2VzID0gc2VjdG9yQ2xhc3NlczsKCiAgICBzZWxmLnN2Z1JlY3QgPSBzZWxmLnZpcy5hcHBlbmQoJ2cnKS5hdHRyKCd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlKCcrIHNlbGYucmFkaXVzKycsMCknKTsKICAgIHNlbGYucmVjdCA9IHNlbGYuc3ZnUmVjdC5hcHBlbmQoJ2cnKS5hdHRyKCdjbGFzcycsICdyZWN0LWNvbnRhaW5lcicpOwogICAgc2VsZi5kaW1SZWN0ID0gcmVjdEJ1aWxkRnVuY3Rpb24oc2VsZi5yZWN0KTsKICAgIHNlbGYuc3ZnUmVjdC5hdHRyKCd3aWR0aCcsIHNlbGYuZGltUmVjdC53aWR0aCkKCiAgICBzZWxmLnJlY3QuYXR0cigndHJhbnNmb3JtJywgJ3NjYWxlKDAsMSknKTsKICAgIHNlbGYuc3ZnUmVjdC5hdHRyKCd4Jywgc2VsZi5yYWRpdXMpOwogICAgc2VsZi52aXMuYXR0cignaGVpZ2h0JywgMiAqIHNlbGYucmFkaXVzKS5hdHRyKCd3aWR0aCcsIHNlbGYucmFkaXVzICsgc2VsZi5kaW1SZWN0LndpZHRoKTsKCiAgfQoKICBQUVZpZXcucHJvdG90eXBlLmRyYXcgPSBmdW5jdGlvbihvcHRpb25zKSB7CiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICB2YXIgY2lyY2xlID0gc2VsZi52aXMuYXBwZW5kKCdnJykuYXR0cigndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZSgnICsgc2VsZi5yYWRpdXMgKyAnLCcgKyBzZWxmLnJhZGl1cyArICcpJykuYXBwZW5kKCdnJyk7CgogICAgdmFyIGFyYyA9IGQzLnN2Zy5hcmMoKS5vdXRlclJhZGl1cyhzZWxmLnJhZGl1cykuaW5uZXJSYWRpdXMoMCkuc3RhcnRBbmdsZShmdW5jdGlvbih2LCBpKSB7CiAgICAgIHJldHVybiAyICogMy4xNCAqIGkgLyBzZWxmLmxlbjsKICAgIH0pLmVuZEFuZ2xlKGZ1bmN0aW9uKHYsIGkpIHsKICAgICAgcmV0dXJuIDIgKiAzLjE0ICogKGkgKyAxKSAvIHNlbGYubGVuOwogICAgfSk7CiAgICB2YXIgcGNpcmMgPSBjaXJjbGUuc2VsZWN0QWxsKCdnLmNpcmNsZScpLmRhdGEoc2VsZi5zZWN0b3JDbGFzc2VzKS5lbnRlcigpLmFwcGVuZCgnZycpLmF0dHIoJ2NsYXNzJywgJ2NpcmNsZScpOwogICAgcGNpcmMuYXBwZW5kKCdwYXRoJykuYXR0cignZCcsIGFyYykuYXR0cignY2xhc3MnLCBmdW5jdGlvbihkLCBpKSB7CiAgICAgIHJldHVybiBkICsgJyBzZWN0b3Igc2VjdG9yLScgKyBpCiAgICB9KS5hdHRyKCdmaWxsJywgZnVuY3Rpb24oZCkgewogICAgICByZXR1cm4gZDMucmdiKDI1NSAvIDEwICogZCwgMjU1IC8gMTAgKiBkLCAyNTUgLyAxMCAqIGQpCiAgICB9KTsKICAgIHZhciBtc2tDaXJjbGUgPSBjaXJjbGUuYXBwZW5kKCdjaXJjbGUnKS5hdHRyKCdyJywgc2VsZi5yYWRpdXMpLmF0dHIoJ2ZpbGwtb3BhY2l0eScsICcwJykuYXR0cignZmlsbCcsICd5ZWxsb3cnKS5zdHlsZSgnY3Vyc29yJywgJ2hhbmQnKTsKCiAgICBtc2tDaXJjbGUub24oJ21vdXNlb3ZlcicsIGZ1bmN0aW9uKCkgewogICAgICBzZWxmLnJvbGxPdXQoY2lyY2xlKTsKICAgIH0pOwogICAgbXNrQ2lyY2xlLm9uKCdtb3VzZW91dCcsIGZ1bmN0aW9uKCkgewogICAgICBzZWxmLnJvbGxCYWNrKGNpcmNsZSk7CiAgICB9KTsKICAgIGlmIChzZWxmLm9uY2xpY2spIHsKICAgICAgbXNrQ2lyY2xlLm9uKCdjbGljaycsIHNlbGYub25jbGljayk7CiAgICB9CiAgfQoKICBQUVZpZXcucHJvdG90eXBlLm1vdmUgPSBmdW5jdGlvbih4LCB5KSB7CiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICB0aGlzLnZpcy5hdHRyKCd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlKCcgKyAoeCAtIHNlbGYucmFkaXVzKSArICcsJyArICh5IC0gc2VsZi5yYWRpdXMpICsgJyknKS5zdHlsZSgnbGVmdCcsIHggKyAncHgnKS5zdHlsZSgnbGVmdCcsIHkgKyAncHgnKS5zdHlsZSgncG9zaXRpb24nLCAncmVsYXRpdmUnKTsKICAgIHJldHVybiB0aGlzCiAgfQoKICBQUVZpZXcucHJvdG90eXBlLnJvbGxPdXQgPSBmdW5jdGlvbihjaXJjbGUsIG9wdGlvbnMpIHsKICAgIHZhciBzZWxmID0gdGhpczsKICAgIGlmIChzZWxmLnJvdGF0aW5nID4gMCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBzZWxmLnJvdGF0aW5nID0gMTsKICAgIHZhciBjcHQgPSAwOwogICAgdmFyIGR0ID0gc2VsZi50aW1lIC8gc2VsZi5sZW47CiAgICB2YXIgd1JlY3QgPSBzZWxmLmRpbVJlY3Qud2lkdGg7CiAgICBmb3IgKCBpID0gMDsgaSA8IHNlbGYubGVuOyBpKyspIHsKICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICBpZiAoc2VsZi5yb3RhdGluZyA8PSAwKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGNpcmNsZS5hdHRyKCd0cmFuc2Zvcm0nLCAncm90YXRlKCcgKyAoKGNwdCArIDEpIC8gc2VsZi5sZW4gKiAzNjApICsgJyknKTsKICAgICAgICBjcHQrKzsKICAgICAgICBzZWxmLnJlY3QuYXR0cigndHJhbnNmb3JtJywgJ3NjYWxlKCcgKyAoKGkgKyAxKSAvIHNlbGYubGVuKSArICcsMSknKTsKICAgICAgICAvLyk7J3RyYW5zbGF0ZSgnICsgKChjcHQgLSBzZWxmLmxlbikgKiB3UmVjdCAvIHNlbGYubGVuKSArICcsMCknKTsKCiAgICAgICAgY2lyY2xlLnNlbGVjdEFsbCgnLnNlY3Rvci0nICsgKHNlbGYubGVuIC0gY3B0KSkuYXR0cignZGlzcGxheScsICdub25lJyk7CiAgICAgICAgaWYgKGNwdCA9PSBzZWxmLmxlbikgewogICAgICAgICAgc2VsZi5yb3RhdGluZyA9IDA7CiAgICAgICAgfQogICAgICB9LCBpICogZHQpOwogICAgfQogIH0KICBQUVZpZXcucHJvdG90eXBlLnJvbGxCYWNrID0gZnVuY3Rpb24oY2lyY2xlLCBvcHRpb25zKSB7CgogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgaWYgKHNlbGYucm90YXRpbmcgPCAwKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHNlbGYucm90YXRpbmcgPSAtMTsKICAgIHZhciBjcHQgPSBzZWxmLmxlbiAtIDE7CiAgICB2YXIgZHQgPSBzZWxmLnRpbWUgLyBzZWxmLmxlbjsKICAgIHZhciB3UmVjdCA9IHNlbGYuZGltUmVjdC53aWR0aDsKICAgIGZvciAoIGkgPSAwOyBpIDwgc2VsZi5sZW47IGkrKykgewogICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgIGlmIChzZWxmLnJvdGF0aW5nID49IDApIHsKICAgICAgICAgIHJldHVybgogICAgICAgIH0KICAgICAgICBjaXJjbGUuYXR0cigndHJhbnNmb3JtJywgJ3JvdGF0ZSgnICsgKGNwdCAvIHNlbGYubGVuICogMzYwKSArICcpJyk7CiAgICAgICAgLy8gICAgICAgIHZhciB0ciA9ICd0cmFuc2xhdGUoJyArICgoY3B0IC0gc2VsZi5sZW4pICogd1JlY3QgLyBzZWxmLmxlbikgKyAnLDApJzsKICAgICAgICB2YXIgdHIgPSAnc2NhbGUoJyArICgxIC0gaSAvIHNlbGYubGVuKSArICcsMSknOwogICAgICAgIHNlbGYucmVjdC5hdHRyKCd0cmFuc2Zvcm0nLCB0cik7CgogICAgICAgIHZhciBzZWwgPSAnLnNlY3Rvci0nICsgKHNlbGYubGVuIC0gY3B0IC0gMSk7CiAgICAgICAgY2lyY2xlLnNlbGVjdEFsbChzZWwpLmF0dHIoJ2Rpc3BsYXknLCBudWxsKQogICAgICAgIGNwdC0tOwogICAgICAgIGlmIChjcHQgPCAwKSB7CiAgICAgICAgICBzZWxmLnJvdGF0aW5nID0gMDsKICAgICAgICB9CiAgICAgIH0sIGkgKiBkdCk7CiAgICB9CgogIH0KCiAgcmV0dXJuIFBRVmlldzsKfSk7CgovKgogKiB3aXRkZ2V0IHRvIGRpc3BsYXkgUFNNLCBiYXNlZCBvbiB0aGUgc3BlY3RydW0gcGVyc3BlY3RpdmUKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCmRlZmluZSgnZmlzaHRvbmVzL3ZpZXdzL21hdGNoL01hdGNoU3BlY3RydW1WaWV3JyxbJ3VuZGVyc2NvcmUnLCAnZDMnLCAnLi4vY29tbW9ucy9Db21tb25XaWRnZXRWaWV3JywgJ2Zpc2h0b25lcy92aWV3cy91dGlscy9EM1NjYWxpbmdDb250ZXh0JywgJ2Zpc2h0b25lcy92aWV3cy91dGlscy9EM1NjYWxpbmdBcmVhJ10sIGZ1bmN0aW9uIChfLCBkMywgQ29tbW9uV2lkZ2V0VmlldywgRDNTY2FsaW5nQ29udGV4dCwgRDNTY2FsaW5nQXJlYSkgewoKICAgIE1hdGNoU3BlY3RydW1WaWV3ID0gQ29tbW9uV2lkZ2V0Vmlldy5leHRlbmQoewogICAgICAgIGRlZmF1bHRzOiB7CiAgICAgICAgfSwKICAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbiAob3B0aW9ucykgewogICAgICAgICAgICBNYXRjaFNwZWN0cnVtVmlldy5fX3N1cGVyX18uaW5pdGlhbGl6ZS5jYWxsKHRoaXMsIG9wdGlvbnMpCiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgICAgICAgIG9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgb3B0aW9ucyk7CiAgICAgICAgICAgIHNlbGYub3B0aW9ucyA9IG9wdGlvbnM7CgogICAgICAgICAgICBzZWxmLnRvbCA9IG9wdGlvbnMudG9sIHx8IDUwMDsKCiAgICAgICAgICAgIHNlbGYuaGVpZ2h0WEF4aXMgPSAyMTsKICAgICAgICAgICAgc2VsZi5wZWFrc0Jhc2VsaW5lSGVpZ2h0ID0gMTA7CgogICAgICAgICAgICBpZiAob3B0aW9ucy5mbHlpbmcpIHsKICAgICAgICAgICAgICAgIHNlbGYuZWwgPSBkMy5zZWxlY3QoJ2JvZHknKTsKICAgICAgICAgICAgICAgIHNlbGYuaXNGbHlpbmcgPSB0cnVlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgc2VsZi5pc0ZseWluZyA9IGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHNlbGYucF9zZXR1cCgpOwoKICAgICAgICAgICAgaWYgKHNlbGYub3B0aW9ucy54Wm9vbWFibGUpIHsKICAgICAgICAgICAgICAgIHNlbGYueFpvb21hYmxlKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgfSwKICAgICAgICBwX3NldHVwOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgLy8gdmFyIGV2dCA9IGQzLm1vdXNlKHNlbGYuY29udGFpbmVyKTsKICAgICAgICAgICAgc2VsZi52aXMgPSBzZWxmLmVsLmFwcGVuZCgnc3ZnJykKICAgICAgICAgICAgc2VsZi52aXMuYXR0cignd2lkdGgnLCBzZWxmLndpZHRoKCkpLmF0dHIoJ2hlaWdodCcsIHNlbGYuaGVpZ2h0KCkpLmF0dHIoJ2NsYXNzJywgJ2QzLXdpZGdldC1tYXRjaC1zcGVjdHJ1bScpOwogICAgICAgICAgICBpZiAoc2VsZi5pc0ZseWluZykgewogICAgICAgICAgICAgICAgdmFyIHggPSBkMy5ldmVudC5wYWdlWCArIDEwOwogICAgICAgICAgICAgICAgdmFyIHkgPSBkMy5ldmVudC5wYWdlWSAtIHNlbGYuaGVpZ2h0KCkgKiAyIC8gMzsKICAgICAgICAgICAgICAgIHNlbGYudmlzLnN0eWxlKCdsZWZ0JywgeCArICdweCcpLnN0eWxlKCd0b3AnLCB5ICsgJ3B4Jyk7CiAgICAgICAgICAgICAgICBzZWxmLnBfZmx5aW5nX2RvbnRfZmx5X2F3YXkoKTsKCiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gc2VsZi52aXMuYXBwZW5kKCdyZWN0JykuYXR0cignd2lkdGgnLCAnMTAwJScpLmF0dHIoJ2hlaWdodCcsICcxMDAlJykuYXR0cignZmlsbCcsICcjZGRkJykuYXR0cignY2xhc3MnLCAnYmFja2dyb3VuZCcpOwoKICAgICAgICAgICAgc2VsZi5wX3NldHVwX3RpdGxlKCk7CgogICAgICAgICAgICBpZiAoc2VsZi5pc0ZseWluZykgewogICAgICAgICAgICAgICAgc2VsZi5idXR0b25Db250YWluZXIgPSBzZWxmLnZpcy5hcHBlbmQoJ2cnKS5hdHRyKCdjbGFzcycsICdidXR0b24tY29udGFpbmVyIHJpZ2h0LWFsaWduJykuYXR0cigndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZSgnICsgc2VsZi53aWR0aCgpICsgJywwKScpCiAgICAgICAgICAgICAgICBzZWxmLnBfc2V0dXBfbWVudV9idXR0b25zKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGFkZCBzcGVjdHJ1bQogICAgICAgICAgICB2YXIgZXhwU3AgPSBzZWxmLm1vZGVsLmdldCgnZXhwU3BlY3RydW0nKTsKICAgICAgICAgICAgdmFyIGhTcGVjdHJ1bSA9IHNlbGYuaGVpZ2h0KCkgLSAyMCAtIHNlbGYuaGVpZ2h0WEF4aXM7CgogICAgICAgICAgICBzZWxmLnBfYnVpbGRfZGF0YSgpOwogICAgICAgICAgICBzZWxmLnNldHVwU2NhbGluZ0NvbnRleHQoewogICAgICAgICAgICAgICAgeERvbWFpbjogW2V4cFNwLmdldCgnbW96cycpWzBdICogMC45NSwgZXhwU3AuZ2V0KCdtb3pzJylbZXhwU3Auc2l6ZSgpIC0gMV0gKiAxLjA1XSwKICAgICAgICAgICAgICAgIHlEb21haW46IFswLCBfLm1heChfLnBsdWNrKHNlbGYuZGF0YS5wZWFrcywgJ3knKSkgKiAxLjJdLAogICAgICAgICAgICAgICAgaGVpZ2h0OiBoU3BlY3RydW0gLSBzZWxmLnBlYWtzQmFzZWxpbmVIZWlnaHQsCiAgICAgICAgICAgICAgICB3aWR0aDogc2VsZi53aWR0aCgpCiAgICAgICAgICAgIH0pCgogICAgICAgICAgICB2YXIgc3Znc3AgPSBzZWxmLnZpcy5hcHBlbmQoJ2cnKS5hdHRyKCd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlKDAsMjApJyk7CiAgICAgICAgICAgIHNlbGYuc3Znc3AgPSBzdmdzcDsKCiAgICAgICAgICAgIHNlbGYuc2NhbGluZ0FyZWEgPSBuZXcgRDNTY2FsaW5nQXJlYSh7CiAgICAgICAgICAgICAgICBlbDogc3Znc3AsCiAgICAgICAgICAgICAgICBtb2RlbDogc2VsZi5zY2FsaW5nQ29udGV4dCwKICAgICAgICAgICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgc2VsZi5yZW5kZXIoKQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGhlaWdodDogaFNwZWN0cnVtLAogICAgICAgICAgICAgICAgd2lkdGg6IHNlbGYud2lkdGgoKQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHNlbGYuZDNIb2xkZXJYQXhpcyA9IHN2Z3NwLmFwcGVuZCgnZycpLmF0dHIoJ2NsYXNzJywgJ3hheGlzJykuYXR0cigndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZSgwLCcgKyBoU3BlY3RydW0gKyAnKScpOwogICAgICAgICAgICBzZWxmLmQzaG9sZGVyUHJlY3Vyc29yID0gc3Znc3Auc2VsZWN0QWxsKCdnLnByZWN1cnNvcicpLmRhdGEoc2VsZi5kYXRhLnByZWN1cnNvcikuZW50ZXIoKS5hcHBlbmQoJ2cnKQogICAgICAgICAgICBzZWxmLmQzaG9sZGVyUHJlY3Vyc29yLmFwcGVuZCgncGF0aCcpLmF0dHIoJ2NsYXNzJywgJ3ByZWN1cnNvcicpLmF0dHIoJ2QnLCAnTTAsLTIwTDEwLDBMLTEwLDBMMCwtMjAnKS5hdHRyKCd4JywgZnVuY3Rpb24gKHApIHsKICAgICAgICAgICAgICAgIHJldHVybiBwLng7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBzZWxmLmQzaG9sZGVyUGVha3MgPSBzdmdzcC5zZWxlY3RBbGwoJ2xpbmUucGVhaycpLmRhdGEoc2VsZi5kYXRhLnBlYWtzKS5lbnRlcigpLmFwcGVuZCgnbGluZScpLmF0dHIoJ2NsYXNzJywgZnVuY3Rpb24gKHBrKSB7CiAgICAgICAgICAgICAgICB2YXIgY2xhenogPSAncGVhayc7CiAgICAgICAgICAgICAgICBpZiAocGsubGFiZWwgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgIGNsYXp6ICs9ICcgbWF0Y2hlZCBmcmFnLXNlcmllcy0nICsgcGsubGFiZWwubGFiZWwuc2VyaWVzLnJlcGxhY2UoJysrJywgJycpCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGNsYXp6ICs9ICcgdW5tYXRjaGVkJwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGNsYXp6CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBzZWxmLmQzaG9sZGVyUGVha3NUcnVuY2F0ZWQgPSBzdmdzcC5zZWxlY3RBbGwoJ2xpbmUucGVhay10cnVuY2F0ZWQnKS5kYXRhKHNlbGYuZGF0YS5wZWFrc1RydW5jYXRlZCkuZW50ZXIoKS5hcHBlbmQoJ2xpbmUnKTsKCiAgICAgICAgICAgIHNlbGYucF9zZXR1cF9sYWJlbHMoKTsKCiAgICAgICAgfSwKICAgICAgICAvKioKICAgICAgICAgKiBkaXYgd2l0aCBmbHlpbmcgc3BlY3RydW0gaXMgcG9pc3Rpb24gc29td2hlcmUgKGJ5IHRoZSB2ZW50c291cmNlLCBmb3IgZXhhbXBsZSkKICAgICAgICAgKiBuZXJ2ZXJ0aGVsZXNzLCBpdCBzaG91bGQgbm90IGdvIG91dHNpZGUgdGhlIG1haW4gd2luZG93CiAgICAgICAgICovCiAgICAgICAgcF9mbHlpbmdfZG9udF9mbHlfYXdheTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICAgICAgICB2YXIgeCA9IHBhcnNlSW50KHNlbGYudmlzLnN0eWxlKCdsZWZ0JykpOwogICAgICAgICAgICB2YXIgeSA9IHBhcnNlSW50KHNlbGYudmlzLnN0eWxlKCd0b3AnKSk7CiAgICAgICAgICAgIHZhciBtaW5EaXN0ID0gMjA7CgogICAgICAgICAgICB4ID0gTWF0aC5tYXgoeCwgbWluRGlzdCk7CiAgICAgICAgICAgIHggPSBNYXRoLm1pbih4LCB3aW5kb3cuaW5uZXJXaWR0aCAtIHNlbGYud2lkdGgoKSAtIG1pbkRpc3QpOwoKICAgICAgICAgICAgeSA9IE1hdGgubWF4KHksIG1pbkRpc3QpOwogICAgICAgICAgICB5ID0gTWF0aC5taW4oeSwgJChkb2N1bWVudCkuaGVpZ2h0KCkgLSBzZWxmLmhlaWdodCgpIC0gbWluRGlzdCkKCiAgICAgICAgICAgIHNlbGYudmlzLnN0eWxlKCdsZWZ0JywgeCkKICAgICAgICAgICAgc2VsZi52aXMuc3R5bGUoJ3RvcCcsIHkpCgogICAgICAgIH0sCiAgICAgICAgcF9zZXR1cF9sYWJlbHM6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICAgICAgc2VsZi5zdmdzcC5zZWxlY3RBbGwoJ2cubGFiZWwnKS5yZW1vdmUoKTsKICAgICAgICAgICAgc2VsZi5kM2hvbGRlckxhYmVscyA9IHNlbGYuc3Znc3Auc2VsZWN0QWxsKCdnLmxhYmVsJykuZGF0YShzZWxmLmRhdGEubGFiZWxzKS5lbnRlcigpLmFwcGVuZCgnZycpOwogICAgICAgICAgICBzZWxmLmQzaG9sZGVyTGFiZWxzUGF0aCA9IHNlbGYuZDNob2xkZXJMYWJlbHMuYXBwZW5kKCdwYXRoJykKICAgICAgICAgICAgc2VsZi5kM2hvbGRlckxhYmVsc1RleHRHID0gc2VsZi5kM2hvbGRlckxhYmVscy5hcHBlbmQoJ2cnKQogICAgICAgICAgICBzZWxmLmQzaG9sZGVyTGFiZWxzVGV4dCA9IHNlbGYuZDNob2xkZXJMYWJlbHNUZXh0Ry5hcHBlbmQoJ3RleHQnKQogICAgICAgICAgICByZXR1cm4gc2VsZgogICAgICAgIH0sCiAgICAgICAgcF9zZXR1cF90aXRsZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIC8vIHRpdGxlCiAgICAgICAgICAgIHZhciBleHBTcCA9IHNlbGYubW9kZWwuZ2V0KCdleHBTcGVjdHJ1bScpCiAgICAgICAgICAgIHZhciB0aXRsZSA9ICdzY2FuOiAnICsgZXhwU3AuZ2V0KCdzY2FuTnVtYmVyJykgKyAnICgnICsgKE1hdGgucm91bmQoZXhwU3AuZ2V0KCdyZXRlbnRpb25UaW1lJykpIC8gNjApLnRvRml4ZWQoMSkgKyAnbWluKSAnICsgZXhwU3AuZ2V0KCdwcmVjQ2hhcmdlJykgKyAnKyAnICsgZXhwU3AuZ2V0KCdwcmVjTW96JykudG9GaXhlZCg0KSArICdEYSc7CiAgICAgICAgICAgIHNlbGYudmlzLmFwcGVuZCgndGV4dCcpLmF0dHIoJ3gnLCA1KS5hdHRyKCd5JywgNSkuYXR0cignY2xhc3MnLCAndGl0bGUnKS50ZXh0KHRpdGxlKTsKICAgICAgICAgICAgc2VsZi52aXMuYXBwZW5kKCdyZWN0JykuYXR0cignaGVpZ2h0JywgJzIwJykuYXR0cignd2lkdGgnLCAnMTAwJScpLmF0dHIoJ2NsYXNzJywgJ3RpdGxlJykudGV4dCh0aXRsZSk7CgogICAgICAgIH0sCiAgICAgICAgcF9uZXdfYnV0dG9uOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIG4gPSBzZWxmLmJ1dHRvbkNvbnRhaW5lci5zZWxlY3RBbGwoJ2cuYnV0dG9uLWNvbnRhaW5lcicpWzBdLmxlbmd0aAogICAgICAgICAgICByZXR1cm4gc2VsZi5idXR0b25Db250YWluZXIuYXBwZW5kKCdnJykuYXR0cignY2xhc3MnLCAnYnV0dG9uLWNvbnRhaW5lcicpLmF0dHIoJ3RyYW5zZm9ybScsICd0cmFuc2xhdGUoLScgKyAobiArIDEpICogNDIgKyAnLDIpJyk7CiAgICAgICAgfSwKICAgICAgICBwX3NldHVwX21lbnVfYnV0dG9uczogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICAgICAgICB2YXIgYWRkQnV0dG9uID0gZnVuY3Rpb24gKGdidXQsIHRleHQsIG9wdGlvbnMpIHsKICAgICAgICAgICAgICAgIHZhciBlbFdyYXBwZXIgPSBnYnV0LmFwcGVuZCgnZycpOwogICAgICAgICAgICAgICAgLy8uYXR0cigndHJhbnNmb3JtJywgJ3NjYWxlKCcgKyAob3B0aW9ucy5zaXplIC8gNDApICsgJywnICsgKG9wdGlvbnMuc2l6ZSAvIDQwKSArICcpJyk7CiAgICAgICAgICAgICAgICBnYnV0LmNsYXNzZWQoJ2J1dHRvbicsIHRydWUpOwogICAgICAgICAgICAgICAgZWxXcmFwcGVyLmFwcGVuZCgncmVjdCcpLmF0dHIoJ3dpZHRoJywgNDApLmF0dHIoJ2hlaWdodCcsIDE2KS5hdHRyKCdyeCcsIDQpLmF0dHIoJ3J5JywgNCkuY2xhc3NlZCgnYnV0dG9uJywgdHJ1ZSk7CiAgICAgICAgICAgICAgICBnYnV0LmFwcGVuZCgndGV4dCcpLmF0dHIoJ3gnLCAyMCkuYXR0cigneScsIDExKS50ZXh0KHRleHQpOwogICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5jdXJzb3IpIHsKICAgICAgICAgICAgICAgICAgICBnYnV0LnN0eWxlKCdjdXJzb3InLCBvcHRpb25zLmN1cnNvcik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gZ2J1dDsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBjbG9zZQogICAgICAgICAgICB2YXIgZ2J1dCA9IHNlbGYucF9uZXdfYnV0dG9uKCk7CiAgICAgICAgICAgIGFkZEJ1dHRvbihnYnV0LCAnY2xvc2UnKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBzZWxmLmNsb3NlKCkKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAvLyByZXNpemUKICAgICAgICAgICAgZ2J1dCA9IHNlbGYucF9uZXdfYnV0dG9uKCk7CgogICAgICAgICAgICBhZGRCdXR0b24oZ2J1dCwgJ2xhcmdlcicpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGlmIChzZWxmLmhlaWdodCgpIDwgMzAwKSB7CiAgICAgICAgICAgICAgICAgICAgc2VsZi5yZXNpemUoewogICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDQwMCwKICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IE1hdGgubWluKCQoZG9jdW1lbnQpLndpZHRoKCkgKiAwLjksIDEwMDApCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgc2VsZi5yZXNpemUoewogICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDIwMCwKICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDUwMAogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAvLyBkcmFnCiAgICAgICAgICAgIGdidXQgPSBzZWxmLnBfbmV3X2J1dHRvbigpOwogICAgICAgICAgICBhZGRCdXR0b24oZ2J1dCwgJ21vdmUnLCB7CiAgICAgICAgICAgICAgICBjdXJzb3I6ICdtb3ZlJwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgLy8gc2V0dXAgZHJhZ2dpbgogICAgICAgICAgICB2YXIgZHJhZ0Nvb3JkID0gewogICAgICAgICAgICAgICAgeDogMTAwMCwKICAgICAgICAgICAgICAgIHk6IDEwMDAKICAgICAgICAgICAgfTsKICAgICAgICAgICAgdmFyIGRyYWcgPSBkMy5iZWhhdmlvci5kcmFnKCkub24oImRyYWdzdGFydCIsIGZ1bmN0aW9uIChkKSB7CiAgICAgICAgICAgICAgICBkcmFnQ29vcmQgPSB7CiAgICAgICAgICAgICAgICAgICAgbXg6IGQzLmV2ZW50LnNvdXJjZUV2ZW50LnBhZ2VYLAogICAgICAgICAgICAgICAgICAgIG15OiBkMy5ldmVudC5zb3VyY2VFdmVudC5wYWdlWSwKICAgICAgICAgICAgICAgICAgICB2eDogcGFyc2VJbnQoc2VsZi52aXMuc3R5bGUoJ2xlZnQnKS5yZXBsYWNlKCdweCcsICcnKSksCiAgICAgICAgICAgICAgICAgICAgdnk6IHBhcnNlSW50KHNlbGYudmlzLnN0eWxlKCd0b3AnKS5yZXBsYWNlKCdweCcsICcnKSksCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9KS5vbigiZHJhZyIsIGZ1bmN0aW9uIChkKSB7CiAgICAgICAgICAgICAgICBteCA9IGQzLmV2ZW50LnNvdXJjZUV2ZW50LnBhZ2VYOwogICAgICAgICAgICAgICAgbXkgPSBkMy5ldmVudC5zb3VyY2VFdmVudC5wYWdlWTsKCiAgICAgICAgICAgICAgICBzZWxmLnZpcy5zdHlsZSgibGVmdCIsIChkcmFnQ29vcmQudnggKyBteCAtIGRyYWdDb29yZC5teCkgKyAncHgnKS5zdHlsZSgidG9wIiwgKGRyYWdDb29yZC52eSArIG15IC0gZHJhZ0Nvb3JkLm15KSArICdweCcpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgZ2J1dC5jYWxsKGRyYWcpOwoKICAgICAgICAgICAgLy9lZGl0CiAgICAgICAgICAgIGlmIChzZWxmLm9wdGlvbnMuZWRpdFVybCkgewogICAgICAgICAgICAgICAgZ2J1dCA9IHNlbGYucF9uZXdfYnV0dG9uKCk7CgogICAgICAgICAgICAgICAgYWRkQnV0dG9uKGdidXQsICdlZGl0Jyk7CiAgICAgICAgICAgICAgICBnYnV0Lm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cub3BlbihzZWxmLm9wdGlvbnMuZWRpdFVybCwgJ2VwaS1zaG93X19JRF9JTlRFUkFDVElWRV9fWElDJykKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIC8vIC8vLmFwcGVuZCgndGV4dCcpLmF0dHIoJ3knLCAxNCkudGV4dCgnPycpCiAgICAgICAgICAgICAgICAvLyB2YXIgYiA9IGQzR2x5cGhpY29ucy5hcHBlbmQoYSwgJ2Jpbm9jdWxhcnMnLCB7CiAgICAgICAgICAgICAgICAvLyBzaXplIDogMjQsCiAgICAgICAgICAgICAgICAvLyBidXR0b24gOiB0cnVlCiAgICAgICAgICAgICAgICAvLyB9KTsKCiAgICAgICAgICAgIH0KCiAgICAgICAgfSwKICAgICAgICAvKgogICAgICAgICAqIGJ1aWxkIGRhdGEgcmVhZHkgZm9yIHBsb3R0aW5nOiAtIHBlYWtzIC0gbGFiZWwgLSBwcmVjdXJzb3IKICAgICAgICAgKiBUT0RPOiBhdHRhY2hlIGxhYmVsIHRvIHBlYWssIGZpbHRlciBkYXRhIG9uIF8ucGx1Y2socGVha3MsICdsYWJlbCcpLmZpbHRlcihmdW5jdGlvbihsKXtyZXR1cm4gbCE9PSB1bmRlZmluZWR9KQogICAgICAgICAqIHNvIGV2ZXJ5dGhpbmcgaXMgYXR0YWNoZWQgdG9nZXRoZXIgYXQgb25jZQogICAgICAgICAqIFRPRE8gYXR0YWNoZSB0aGUgdHJ1bmNhdGVkIGluZm8gaW4gdGhlIHNhbWUgd2F5LgogICAgICAgICAqIFRPRE8gYXQgdmlldyB0aW1lLCB3ZSBjYW4gc3RhcnQgZXZlcnkgdGhpbmcgb24gYSBnIHNoaWZ0IHRvIHRoZSBjb3JyZWN0IHBvc2l0aW9uCiAgICAgICAgICovCiAgICAgICAgcF9idWlsZF9kYXRhOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIGV4cFNwID0gc2VsZi5tb2RlbC5nZXQoJ2V4cFNwZWN0cnVtJyk7CgogICAgICAgICAgICB2YXIgcmV0ID0ge307CiAgICAgICAgICAgIHZhciBkbWF0Y2hlcyA9IHNlbGYubW9kZWwuY2xvc2VyVGhhblBQTShzZWxmLnRvbCkKCiAgICAgICAgICAgIHZhciBsYWJlbGVkUGVha3MgPSBbXTsKICAgICAgICAgICAgcmV0LmxhYmVscyA9IF8uY29sbGVjdChkbWF0Y2hlcywgZnVuY3Rpb24gKGRtKSB7CiAgICAgICAgICAgICAgICB2YXIgcmV0ID0gewogICAgICAgICAgICAgICAgICAgIHg6IGRtLmV4cC5tb3osCiAgICAgICAgICAgICAgICAgICAgeTogZXhwU3AuZ2V0KCdpbnRlbnNpdGllcycpW2RtLmV4cC5pbmRleF0sCiAgICAgICAgICAgICAgICAgICAgbGFiZWw6IGRtLnRoZW8KICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBsYWJlbGVkUGVha3NbZG0uZXhwLmluZGV4XSA9IHJldDsKICAgICAgICAgICAgICAgIHJldHVybiByZXQ7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgcmV0LnBlYWtzID0gXy5jb2xsZWN0KF8uemlwKGV4cFNwLmdldCgnbW96cycpLCBleHBTcC5nZXQoJ2ludGVuc2l0aWVzJyksIGV4cFNwLmdldCgnaW50ZW5zaXR5UmFua3MnKSksIGZ1bmN0aW9uIChwLCBpKSB7CiAgICAgICAgICAgICAgICB2YXIgcGsgPSB7CiAgICAgICAgICAgICAgICAgICAgeDogcFswXSwKICAgICAgICAgICAgICAgICAgICB5OiBwWzFdLAogICAgICAgICAgICAgICAgICAgIGludFJhbms6IHBbMl0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChsYWJlbGVkUGVha3NbaV0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgIHBrLmxhYmVsID0gbGFiZWxlZFBlYWtzW2ldOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHBrOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0LnBlYWtzVHJ1bmNhdGVkID0gW10KICAgICAgICAgICAgdmFyIHNvcnRlZEludGVuc2l0aWVzID0gXy5jaGFpbihyZXQucGVha3MpLnBsdWNrKCd5Jykuc29ydChmdW5jdGlvbiAoYSwgYikgewogICAgICAgICAgICAgICAgcmV0dXJuIGIgLSBhCiAgICAgICAgICAgIH0pLnZhbHVlKCk7CiAgICAgICAgICAgIGlmIChzb3J0ZWRJbnRlbnNpdGllc1swXSA+IDEuNSAqIHNvcnRlZEludGVuc2l0aWVzWzFdKSB7CiAgICAgICAgICAgICAgICB2YXIgbWF4SW50ZW5zID0gc29ydGVkSW50ZW5zaXRpZXNbMV0gKiAxLjE7CiAgICAgICAgICAgICAgICBfLmNoYWluKHJldC5wZWFrcykuZmlsdGVyKGZ1bmN0aW9uIChwKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHAueSA+IG1heEludGVucwogICAgICAgICAgICAgICAgfSkuZWFjaChmdW5jdGlvbiAocCkgewogICAgICAgICAgICAgICAgICAgIHAueSA9IG1heEludGVuczsKICAgICAgICAgICAgICAgICAgICByZXQucGVha3NUcnVuY2F0ZWQucHVzaChwKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXQucHJlY3Vyc29yID0gWwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIHg6IGV4cFNwLmdldCgncHJlY01veicpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIF0KCiAgICAgICAgICAgIHNlbGYuZGF0YSA9IHJldDsKICAgICAgICAgICAgcmV0dXJuIHJldDsKICAgICAgICB9LAogICAgICAgIGNsb3NlOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHRoaXMudmlzLnJlbW92ZSgpOwogICAgICAgIH0sCgogICAgICAgIHJlc2l6ZTogZnVuY3Rpb24gKG9wdGlvbnMpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICAgICAgdmFyIGggPSBvcHRpb25zLmhlaWdodCB8fCAyMDA7CiAgICAgICAgICAgIHNlbGYuaGVpZ2h0KGgpLndpZHRoKG9wdGlvbnMud2lkdGggfHwgNTAwKTsKCiAgICAgICAgICAgIHNlbGYudmlzLmF0dHIoJ2hlaWdodCcsIGgpCiAgICAgICAgICAgIHNlbGYudmlzLmF0dHIoJ3dpZHRoJywgc2VsZi53aWR0aCgpKQoKICAgICAgICAgICAgc2VsZi5zY2FsaW5nQ29udGV4dC5oZWlnaHQoc2VsZi5oZWlnaHQoKSAtIHNlbGYuaGVpZ2h0WEF4aXMgLSBzZWxmLnBlYWtzQmFzZWxpbmVIZWlnaHQgLSAyMCk7CiAgICAgICAgICAgIC8vIDIwIGZvciB0aGUgbWVudSBsaW5lLAogICAgICAgICAgICAvLyAxMCBmb3Igd2F0ZXIgbGluZSAtCiAgICAgICAgICAgIC8vIHVnbHksIG5laT8KICAgICAgICAgICAgc2VsZi5zY2FsaW5nQ29udGV4dC53aWR0aChzZWxmLndpZHRoKCkpCgogICAgICAgICAgICBzZWxmLnZpcy5zZWxlY3RBbGwoJy5yaWdodC1hbGlnbicpLmF0dHIoJ3RyYW5zZm9ybScsICd0cmFuc2xhdGUoJyArIHNlbGYud2lkdGgoKSArICcsMCknKTsKICAgICAgICAgICAgaWYgKHNlbGYuaXNGbHlpbmcpIHsKICAgICAgICAgICAgICAgIHNlbGYucF9mbHlpbmdfZG9udF9mbHlfYXdheSgpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHNlbGYucmVuZGVyKCkKICAgICAgICB9LAogICAgICAgIHJlZnJlc2g6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICBzZWxmLnBfYnVpbGRfZGF0YSgpOwogICAgICAgICAgICBzZWxmLnBfc2V0dXBfbGFiZWxzKCk7CiAgICAgICAgICAgIHNlbGYucmVuZGVyKCk7CiAgICAgICAgfSwKICAgICAgICByZW5kZXI6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICAgICAgdmFyIHggPSBzZWxmLnNjYWxpbmdDb250ZXh0LngoKTsKICAgICAgICAgICAgdmFyIHkgPSBzZWxmLnNjYWxpbmdDb250ZXh0LnkoKTsKCiAgICAgICAgICAgIHNlbGYuZDNob2xkZXJQcmVjdXJzb3IuYXR0cigndHJhbnNmb3JtJywgZnVuY3Rpb24gKHApIHsKICAgICAgICAgICAgICAgIHZhciB0ID0gJ3RyYW5zbGF0ZSgnICsgeChwLngpICsgJywnICsgKHkoMCkgKyA5KSArICcpJzsKICAgICAgICAgICAgICAgIHJldHVybiB0OwogICAgICAgICAgICB9KQogICAgICAgICAgICB2YXIgeEF4aXMgPSBkMy5zdmcuYXhpcygpLnNjYWxlKHgpLnRpY2tzKDcpLnRpY2tTaXplKDUpOwogICAgICAgICAgICBzZWxmLmQzSG9sZGVyWEF4aXMuY2FsbCh4QXhpcyk7CgogICAgICAgICAgICBzZWxmLmQzaG9sZGVyUGVha3MuYXR0cigneDEnLCBmdW5jdGlvbiAocCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHgocC54KTsKICAgICAgICAgICAgfSkuYXR0cigneDInLCBmdW5jdGlvbiAocCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHgocC54KTsKICAgICAgICAgICAgfSkuYXR0cigneTEnLCBmdW5jdGlvbiAocCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHkoMCkgKyBzZWxmLnBlYWtzQmFzZWxpbmVIZWlnaHQ7CiAgICAgICAgICAgIH0pLmF0dHIoJ3kyJywgZnVuY3Rpb24gKHApIHsKICAgICAgICAgICAgICAgIHJldHVybiB5KHAueSk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgc2VsZi52aXMuc2VsZWN0QWxsKCdyZWN0LnBlYWstYmFzZWxpbmUnKS5yZW1vdmUoKTsKICAgICAgICAgICAgc2VsZi52aXMuYXBwZW5kKCdyZWN0JykuYXR0cignY2xhc3MnLCAncGVhay1iYXNlbGluZSByZWxhdGl2ZS1zaXplJykuYXR0cigneScsIHNlbGYuaGVpZ2h0KCkgLSBzZWxmLnBlYWtzQmFzZWxpbmVIZWlnaHQgLSBzZWxmLmhlaWdodFhBeGlzKS5hdHRyKCdoZWlnaHQnLCBzZWxmLnBlYWtzQmFzZWxpbmVIZWlnaHQpLmF0dHIoJ3dpZHRoJywgc2VsZi53aWR0aCgpIC0gMikuYXR0cigneCcsIDEpLmF0dHIoJ3JlbGF0aXZlV2lkdGgnLCAtMik7CgogICAgICAgICAgICBzZWxmLmQzSG9sZGVyWEF4aXMuYXR0cigndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZSgwLCcgKyAoc2VsZi5oZWlnaHQoKSAtIDIwIC0gc2VsZi5oZWlnaHRYQXhpcykgKyAnKScpOwoKICAgICAgICAgICAgc2VsZi5kM2hvbGRlclBlYWtzVHJ1bmNhdGVkLmF0dHIoJ2NsYXNzJywgJ3BlYWstdHJ1bmNhdGVkJykuYXR0cigneDEnLCBmdW5jdGlvbiAocCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHgocC54KTsKICAgICAgICAgICAgfSkuYXR0cigneDInLCBmdW5jdGlvbiAocCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHgocC54KTsKICAgICAgICAgICAgfSkuYXR0cigneTEnLCBmdW5jdGlvbiAocCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHkocC55KTsKICAgICAgICAgICAgfSkuYXR0cigneTInLCBmdW5jdGlvbiAocCkgewogICAgICAgICAgICAgICAgMDsvLyByZXR1cm4gc2VsZi5zY2FsaW5nQ29udGV4dC55U2NhbGUoKShwLnkpLTIwOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHZhciBsYWJZID0gZnVuY3Rpb24gKHApIHsKICAgICAgICAgICAgICAgIHJldHVybiBNYXRoLm1heCh5KHAueSkgLSAyOCwgOCkKICAgICAgICAgICAgfQogICAgICAgICAgICBzZWxmLmQzaG9sZGVyTGFiZWxzLmF0dHIoJ2NsYXNzJywgJ2xhYmVsJykuYXR0cigndHJhbnNmb3JtJywgZnVuY3Rpb24gKHApIHsKICAgICAgICAgICAgICAgIHJldHVybiAndHJhbnNsYXRlKCcgKyB4KHAueCkgKyAnLDApJzsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHNlbGYuZDNob2xkZXJMYWJlbHNQYXRoLmF0dHIoJ2NsYXNzJywgJ2xhYmVsLXBvaW50ZXInKS5hdHRyKCdkJywgZnVuY3Rpb24gKHApIHsKICAgICAgICAgICAgICAgIHZhciBqID0geShwLnkpOwogICAgICAgICAgICAgICAgcmV0dXJuICdNNSwnICsgbGFiWShwKSArICdsLTUsOEwwLCcgKyBqOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHNlbGYuZDNob2xkZXJMYWJlbHNUZXh0Ry5hdHRyKCd0cmFuc2Zvcm0nLCBmdW5jdGlvbiAocCkgewogICAgICAgICAgICAgICAgcmV0dXJuICJ0cmFuc2xhdGUoMTAsICIgKyAobGFiWShwKSAtIDIpICsgIikscm90YXRlKC00OCkiCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIHNlbGYuZDNob2xkZXJMYWJlbHNUZXh0LmF0dHIoJ2NsYXNzJywgJ2xhYmVsJykudGV4dChmdW5jdGlvbiAocCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHAubGFiZWwubGFiZWw7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBpZiAoc2VsZi5yZW5kZXJDYWxsYmFjaykgewogICAgICAgICAgICAgICAgc2VsZi5yZW5kZXJDYWxsYmFjaygpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gTWF0Y2hTcGVjdHJ1bVZpZXc7Cn0pOwoKLyoKICogdGhlIGRpc2sgd2l0aCB1bnJvbGxlZCBwZXB0aWRlIGNvdmVyYWdlIGZvciBQU00KICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCgpkZWZpbmUoJ2Zpc2h0b25lcy92aWV3cy9tYXRjaC9NYXRjaE1hcFBRVmlldycsWyd1bmRlcnNjb3JlJywgJ0JhY2tib25lJywgJy4uL2NvbW1vbnMvQ29tbW9uV2lkZ2V0VmlldycsICcuL01hdGNoTWFwU2xpbVZpZXcnLCAnZmlzaHRvbmVzL3ZpZXdzL3V0aWxzL1BRVmlldycsICcuL01hdGNoU3BlY3RydW1WaWV3J10sIGZ1bmN0aW9uKF8sIEJhY2tib25lLCBDb21tb25XaWRnZXRWaWV3LCBNYXRjaE1hcFNsaW1WaWV3LCBQUVZpZXcsIE1hdGNoU3BlY3RydW1WaWV3KSB7CgogICAgTWF0Y2hNYXBQUVZpZXcgPSBDb21tb25XaWRnZXRWaWV3LmV4dGVuZCh7CiAgICAgICAgaW5pdGlhbGl6ZSA6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICBNYXRjaE1hcFBRVmlldy5fX3N1cGVyX18uaW5pdGlhbGl6ZS5jYWxsKHRoaXMsIGFyZ3VtZW50cykKCiAgICAgICAgICAgIHNlbGYucmFkaXVzID0gb3B0aW9ucy5yYWRpdXN8fCAyNDsKICAgICAgICAgICAgc2VsZi50b2wgPSBvcHRpb25zLnRvbHx8IDQ5ODsKCgogICAgICAgICAgICB2YXIgc3BtYSA9IHNlbGYubW9kZWw7CiAgICAgICAgICAgIHZhciB3aWRnZXQgPSBuZXcgUFFWaWV3KHNlbGYuZWwsIHsKICAgICAgICAgICAgICAgIHJhZGl1cyA6IHNlbGYucmFkaXVzLAogICAgICAgICAgICAgICAgb25jbGljayA6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciB3aWRnZXRTcGVjdHJ1bSA9IG5ldyBNYXRjaFNwZWN0cnVtVmlldyh7CiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsIDogc3BtYSwKICAgICAgICAgICAgICAgICAgICAgICAgZmx5aW5nIDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgZWRpdFVybDonL2Zpc2h0b25lcy9pZC8jaW50ZXJhY3RpdmUvJytzZWxmLm1vZGVsLmdldCgnZXhwU3BlY3RydW0nKS5nZXQoJ2lkJykrJy8nK3NlbGYudG9sKycvJytzZWxmLm1vZGVsLmdldCgncmljaFNlcXVlbmNlJykudG9TdHJpbmcoKSwKICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OjIwMCwKICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6NDgwCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgLy8gLy93aWRnZXRTcGVjdHJ1bS5zaG93KCk7CiAgICAgICAgICAgICAgICAgICAgd2lkZ2V0U3BlY3RydW0ucmVuZGVyKCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHZhciBzZWN0b3JDbGFzc2VzID0gbmV3IEFycmF5KHNlbGYubW9kZWwuZ2V0KCdyaWNoU2VxdWVuY2UnKS5zaXplKCkpCiAgICAgICAgICAgIGZvciAoIGlzYyA9IDA7IGlzYyA8IHNlY3RvckNsYXNzZXMubGVuZ3RoOyBpc2MrKykgewogICAgICAgICAgICAgICAgc2VjdG9yQ2xhc3Nlc1tpc2NdID0gJ3NlY3Rvci1yay1ub25lJzsKICAgICAgICAgICAgfQogICAgICAgICAgICBfLmNoYWluKHNwbWEuY2xvc2VyVGhhblBQTShzZWxmLnRvbCkpLmZpbHRlcihmdW5jdGlvbihtKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gTWF0aC5hYnMobS5lcnJvclBQTSkgPD0gNDk5CiAgICAgICAgICAgIH0pLmdyb3VwQnkoZnVuY3Rpb24obSkgewogICAgICAgICAgICAgICAgcmV0dXJuIG0udGhlby5wb3MKICAgICAgICAgICAgfSkuZWFjaChmdW5jdGlvbihncCkgewogICAgICAgICAgICAgICAgdmFyIHBvcyA9IGdwWzBdLnRoZW8ucG9zCiAgICAgICAgICAgICAgICB2YXIgcmsgPSBfLmNoYWluKGdwKS5tYXAoZnVuY3Rpb24obSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBtLmV4cC5pbnRlbnNpdHlSYW5rCiAgICAgICAgICAgICAgICB9KS5taW4oKS52YWx1ZSgpOwogICAgICAgICAgICAgICAgc2VjdG9yQ2xhc3Nlc1twb3NdID0gJ3NlY3Rvci1yay0nICsgKChyayA8IDQwKSA/IE1hdGguZmxvb3IocmsgLyAxMCkgOiAneCcpCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgd2lkZ2V0LmJ1aWxkKHNlY3RvckNsYXNzZXMsIGZ1bmN0aW9uKGNudCkgewogICAgICAgICAgICAgICAgdmFyIHIgPSBuZXcgTWF0Y2hNYXBTbGltVmlldyh7CiAgICAgICAgICAgICAgICAgICAgbW9kZWwgOiBzcG1hLAogICAgICAgICAgICAgICAgICAgIGVsIDogY250LAogICAgICAgICAgICAgICAgICAgIHRvbCA6IHNlbGYudG9sLAogICAgICAgICAgICAgICAgICAgIGhlaWdodCA6IHNlbGYucmFkaXVzCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHJldHVybiByLnJlbmRlcigpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgc2VsZi53aWRnZXRQUSA9IHdpZGdldDsKICAgICAgICB9LAogICAgICAgIGNsY2NjIDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdDTEFLSycpCiAgICAgICAgfSwKCiAgICAgICAgcmVuZGVyIDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgc2VsZi53aWRnZXRQUS5kcmF3KCk7CiAgICAgICAgfSwKCiAgICAgICAgbW92ZSA6IGZ1bmN0aW9uKGksIGopIHsKICAgICAgICAgICAgdGhpcy53aWRnZXRQUS5tb3ZlKGksIGopOwogICAgICAgIH0KICAgIH0pOwoKICAgIHJldHVybiBNYXRjaE1hcFBRVmlldzsKfSk7CgoKLyoqCiAqIGRpc3BsYXkgb25lIFhJQyAoKyBwbHVzIG1zbXMgbWF0Y2hlcyBldmVudHVhbGx5KQogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KCmRlZmluZSgnZmlzaHRvbmVzL3ZpZXdzL3dldC9YSUNWaWV3JyxbJ3VuZGVyc2NvcmUnLCAnQmFja2JvbmUnLCAnZDMnLCAnLi4vY29tbW9ucy9Db21tb25XaWRnZXRWaWV3JywgJ2Zpc2h0b25lcy9tb2RlbHMvbWF0Y2gvUFNNQWxpZ25tZW50JywgJ2Zpc2h0b25lcy92aWV3cy91dGlscy9EM1NjYWxpbmdDb250ZXh0JywgJ2Zpc2h0b25lcy92aWV3cy91dGlscy9EM1NjYWxpbmdBcmVhJywgJy4uL21hdGNoL01hdGNoTWFwUFFWaWV3J10sIGZ1bmN0aW9uIChfLCBCYWNrYm9uZSwgZDMsIEdGWVZpZXdWaWV3LCBQU01BbGlnbm1lbnQsIEQzU2NhbGluZ0NvbnRleHQsIEQzU2NhbGluZ0FyZWEsIE1hdGNoTWFwUFFWaWV3KSB7CgogICAgWElDVmlldyA9IENvbW1vbldpZGdldFZpZXcuZXh0ZW5kKHsKICAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbiAob3B0aW9ucykgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIFhJQ1ZpZXcuX19zdXBlcl9fLmluaXRpYWxpemUuY2FsbCh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICBzZWxmLnJpY2hTZXF1ZW5jZSA9IG9wdGlvbnMucmljaFNlcXVlbmNlOwogICAgICAgICAgICBpZiAob3B0aW9ucy5zY2FsaW5nQ29udGV4dCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBvcHRpb25zLnhEb21haW4gPSBbMCwgXy5tYXgoc2VsZi5tb2RlbC5nZXQoJ3JldGVudGlvblRpbWVzJykpICogMS4wNV07CiAgICAgICAgICAgICAgICBvcHRpb25zLnlEb21haW4gPSBbMCwgXy5tYXgoc2VsZi5tb2RlbC5nZXQoJ2ludGVuc2l0aWVzJykpICogMS4xXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBzZWxmLnNldHVwU2NhbGluZ0NvbnRleHQob3B0aW9ucyk7CgogICAgICAgICAgICBzZWxmLnBfc2V0X21zMXBvaW50cygpOwogICAgICAgICAgICBpZiAoc2VsZi5yaWNoU2VxdWVuY2UpIHsKICAgICAgICAgICAgICAgIHNlbGYucF9zZXRfbXNtc2RhdGEoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICB9LAogICAgICAgIC8vcmV0dXJuIHRoZSBjbGFzcyAtIHdlbGwsIEkgY2Fubm90IGZpZ3VyZSB3aGF0IHRoaXMgb3MgZG9uZSBsaWtlIHRoYXQuLi4KICAgICAgICBwX2NsYXp6Q29tbW9uOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiAnY2hyb21hdG8gbXNtcy1hbGlnbm1lbnQtaWNvbiBjaGFyZ2VfJyArIHRoaXMubW9kZWwuZ2V0KCdjaGFyZ2UnKSArICcgdGFyZ2V0XycgKyB0aGlzLm1vZGVsLmdldCgndGFyZ2V0Jyk7CiAgICAgICAgfSwKICAgICAgICAvL3BhY2thZ2UgdGhlIG1zMSBncmFwaCBwb2ludCAoYW5kIGdldCBkdGF0IHJlYWR5IGZvciBkcmF3aW5nKQogICAgICAgIHBfc2V0X21zMXBvaW50czogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHZhciBjaHJvbWF0byA9IHNlbGYubW9kZWw7CiAgICAgICAgICAgIGNocm9tYXRvLl9kYXRhUG9pbnRzID0gXy56aXAoY2hyb21hdG8uZ2V0KCdyZXRlbnRpb25UaW1lcycpLCBjaHJvbWF0by5nZXQoJ2ludGVuc2l0aWVzJykpCgogICAgICAgICAgICAvL2NvbnNvbGUubG9nKG1zMXBvaW50cykKICAgICAgICAgICAgdmFyIHNlbGVjdG9yID0gJ2cuJyArIHNlbGYucF9jbGF6ekNvbW1vbigpLnJlcGxhY2UoL1xzKy9nLCAnLicpOwogICAgICAgICAgICB2YXIgY29udCA9IHNlbGYuZWwuc2VsZWN0QWxsKHNlbGVjdG9yKTsKICAgICAgICAgICAgLy8gY29udC5yZW1vdmUoKTsKICAgICAgICAgICAgY29udCA9IHNlbGYuZWwuYXBwZW5kKCdnJyk7CiAgICAgICAgICAgIGNvbnQuYXR0cignY2xhc3MnLCBzZWxmLnBfY2xhenpDb21tb24oKSArICcgcGxvdCcpOwoKICAgICAgICAgICAgdmFyIGNsYXp6ID0gc2VsZi5wX2NsYXp6Q29tbW9uKCkgKyAnIHBsb3QnOwogICAgICAgICAgICAvL2NvbnNvbGUubG9nKCdhZGRpbmcgbXMxcG9pbnQnLCBtczFwb2ludHMpCiAgICAgICAgICAgIHNlbGYucDEgPSBjb250LnNlbGVjdEFsbCgicGF0aC4iICsgY2xhenopLmRhdGEoW2Nocm9tYXRvLl9kYXRhUG9pbnRzXSkuZW50ZXIoKS5pbnNlcnQoInBhdGgiKTsKCiAgICAgICAgfSwKICAgICAgICBwX3NldF9tc21zZGF0YTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHZhciBjaHJvbWF0byA9IHNlbGYubW9kZWw7CgogICAgICAgICAgICBzZWxmLm1zbXNEYXRhID0gW10KCiAgICAgICAgICAgIF8uZWFjaChjaHJvbWF0by5nZXQoJ21zbXMnKS5tb2RlbHMsIGZ1bmN0aW9uIChzcCwgaSkgewogICAgICAgICAgICAgICAgdmFyIHNwbWEgPSBuZXcgUFNNQWxpZ25tZW50KHsKICAgICAgICAgICAgICAgICAgICByaWNoU2VxdWVuY2U6IHNlbGYucmljaFNlcXVlbmNlLAogICAgICAgICAgICAgICAgICAgIGV4cFNwZWN0cnVtOiBzcAogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgdmFyIHdpZGdldCA9IG5ldyBNYXRjaE1hcFBRVmlldyh7CiAgICAgICAgICAgICAgICAgICAgbW9kZWw6IHNwbWEsCiAgICAgICAgICAgICAgICAgICAgZWw6IHNlbGYuZWwsCiAgICAgICAgICAgICAgICAgICAgcmFkaXVzOiAxMiwKICAgICAgICAgICAgICAgICAgICB0b2w6IHNlbGYudG9sCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHdpZGdldC53aWRnZXRQUS52aXMuYXR0cignY2xhc3MnLCBzZWxmLnBfY2xhenpDb21tb24oKSkKCiAgICAgICAgICAgICAgICBzZWxmLm1zbXNEYXRhLnB1c2goewogICAgICAgICAgICAgICAgICAgIHdpZGdldDogd2lkZ2V0LAogICAgICAgICAgICAgICAgICAgIHJldGVudGlvblRpbWU6IGNocm9tYXRvLmdldCgnbXNtc1BvaW50ZXJzJylbaV0ucmV0ZW50aW9uVGltZSwKICAgICAgICAgICAgICAgICAgICBpbnRlbnNpdHk6IGNocm9tYXRvLmdldCgnbXNtc1BvaW50ZXJzJylbaV0uaW50ZW5zaXR5CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLy9kcmF3aW5nIHB1dCB0aGVtIG9uIHRoZSBzY3JlZW4KICAgICAgICAgICAgLy9hY3R1YWwgZHJhd2luZyB3aWxsIG1vdmUgdGhlbSB0byB0aGUgY29ycmVjdCBwb3NpdGlvbgogICAgICAgICAgICBfLmVhY2goc2VsZi5tc21zRGF0YSwgZnVuY3Rpb24gKG1zbXMpIHsKICAgICAgICAgICAgICAgIG1zbXMud2lkZ2V0LnJlbmRlcigpCiAgICAgICAgICAgIH0pOwoKICAgICAgICB9CiAgICB9KTsKCiAgICBYSUNWaWV3LnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAob3B0aW9ucykgewogICAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgICAgdmFyIGNocm0gPSBzZWxmLm1vZGVsOwoKICAgICAgICB2YXIgY2xhenogPSBzZWxmLnBfY2xhenpDb21tb24oKSArICcgbXNtcy1hbm5vdCc7CgogICAgICAgIHZhciB4ID0gc2VsZi5zY2FsaW5nQ29udGV4dC54KCk7Ly9kMy5zY2FsZS5saW5lYXIoKS5kb21haW4oc2VsZi5zY2FsaW5nQ29udGV4dC54U2NhbGUuZG9tYWluKCkpLnJhbmdlKHNlbGYuc2NhbGluZ0NvbnRleHQueFNjYWxlLnJhbmdlKCkpCiAgICAgICAgdmFyIHkgPSBzZWxmLnNjYWxpbmdDb250ZXh0LnkoKTsvL2QzLnNjYWxlLmxpbmVhcigpLmRvbWFpbihzZWxmLnNjYWxpbmdDb250ZXh0LnlTY2FsZS5kb21haW4oKSkucmFuZ2Uoc2VsZi5zY2FsaW5nQ29udGV4dC55U2NhbGUucmFuZ2UoKSkKCiAgICAgICAgdmFyIHBMaW5lID0gZDMuc3ZnLmxpbmUoKS54KGZ1bmN0aW9uIChkKSB7CiAgICAgICAgICAgIHJldHVybiB4KGRbMF0pOwogICAgICAgIH0pLnkoZnVuY3Rpb24gKGQpIHsKICAgICAgICAgICAgcmV0dXJuIHkoZFsxXSkKICAgICAgICB9KTsKCiAgICAgICAgdmFyIGdwMSA9IHNlbGYucDEuYXR0cignY2xhc3MnLCBjbGF6eikuYXR0cignZmlsbCcsICdub25lJyk7CiAgICAgICAgZ3AxLmF0dHIoImQiLCBwTGluZShzZWxmLm1vZGVsLl9kYXRhUG9pbnRzKSk7CiAgICAgICAgXy5lYWNoKHNlbGYubXNtc0RhdGEsIGZ1bmN0aW9uIChtc21zKSB7CiAgICAgICAgICAgIG1zbXMud2lkZ2V0Lm1vdmUoeChtc21zLnJldGVudGlvblRpbWUpLCBNYXRoLm1pbih5KG1zbXMuaW50ZW5zaXR5KSwgc2VsZi5zY2FsaW5nQ29udGV4dC5oZWlnaHQoKSAtIDE1KSkKICAgICAgICB9KTsKICAgICAgICAvLyB2YXIgbXMycG9pbnRzID0gXy56aXAoY2hybS5tc21zLnJldGVudGlvblRpbWVzLCBjaHJtLm1zbXMuaW50ZW5zaXRpZXMsIGNocm0ubXNtcy5zcGVjdHJhSWRzKTsKICAgIH0KCiAgICByZXR1cm4gWElDVmlldzsKfSk7CgovKioKICogbXVsdGlwbGUgWElDIHZpZXdzIGluIG9uZSBib3guIFhJQyBpcyB1bmlxdWUgYnkgaXRzIG1hc3MgZmllbGQKICogdGhlIHNjYWxpbmcgY29udGV4dCBpcyBlaXRoZXIgcGFzc2VkIChpZiBtdWx0aXBsZSBlbGVtZW50IGFyZSBzaGFyaW5nIHRoZSBzYW1lb25lKSBvciBidWlsdC4gcmFuZ2VzIHdpbGwgYmUgYWRhcHRlZCBlYWNoIHRpbWUgYSBYSUMgaXMgYWRkZWQKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCmRlZmluZSgnZmlzaHRvbmVzL3ZpZXdzL3dldC9NdWx0aVhJQ1ZpZXcnLFsndW5kZXJzY29yZScsICdCYWNrYm9uZScsICdkMycsICcuLi9jb21tb25zL0NvbW1vbldpZGdldFZpZXcnLCAnLi9YSUNWaWV3J10sIGZ1bmN0aW9uIChfLCBCYWNrYm9uZSwgZDMsIENvbW1vbldpZGdldFZpZXcsIFhJQ1ZpZXcpIHsKCiAgICBNdWx0aVhJQ1ZpZXcgPSBDb21tb25XaWRnZXRWaWV3LmV4dGVuZCh7CgogICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgTXVsdGlYSUNWaWV3Ll9fc3VwZXJfXy5pbml0aWFsaXplLmNhbGwodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgc2VsZi5vcHRpb25zID0gb3B0aW9uczsKICAgICAgICAgICAgc2VsZi5zZXR1cFNjYWxpbmdDb250ZXh0KG9wdGlvbnMpOwoKICAgICAgICAgICAgc2VsZi54aWNWaWV3cyA9IHt9OwogICAgICAgICAgICBzZWxmLm1vZGVsLmJpbmQoJ2FkZCcsIGZ1bmN0aW9uICh4aWMpIHsKICAgICAgICAgICAgICAgIHNlbGYuYWRkKHhpYywgb3B0aW9ucykKICAgICAgICAgICAgfSkKICAgICAgICAgICAgc2VsZi5idWlsZChvcHRpb25zKTsKCiAgICAgICAgICAgIHNlbGYubGlzdGVuVG8oc2VsZi5tb2RlbCwgJ2FkZCcsIHNlbGYucmVuZGVyKTsKICAgICAgICAgICAgc2VsZi5saXN0ZW5UbyhzZWxmLm1vZGVsLCAncmVzZXQnLCBzZWxmLnJlbmRlcik7CgogICAgICAgIH0sCiAgICAgICAgYnVpbGQ6IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy55YXhpcykgewogICAgICAgICAgICAgICAgc2VsZi5lbFlBeGlzID0gc2VsZi5lbC5hcHBlbmQoJ2cnKS5hdHRyKCdjbGFzcycsICd4aWMgeWF4aXMnKQogICAgICAgICAgICB9CgogICAgICAgICAgICBzZWxmLnRpdGxlID0gb3B0aW9ucy50aXRsZTsKICAgICAgICAgICAgc2VsZi5lbFRpdGxlID0gc2VsZi5lbC5hcHBlbmQoJ3RleHQnKS5hdHRyKCd4Jywgc2VsZi5zY2FsaW5nQ29udGV4dC53aWR0aCgpIC0gMjApLmF0dHIoJ3knLCAzMCkuYXR0cignY2xhc3MnLCAneGljIHRpdGxlJyk7CiAgICAgICAgfSwKICAgICAgICAvLyBldmVudHMgOiB7CiAgICAgICAgLy8gJ2NoYW5nZSBtb2RlbCcgOiAnYWRkJwogICAgICAgIC8vIH0sCiAgICAgICAgYWRkOiBmdW5jdGlvbiAoeGljLCBvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIG0gPSB4aWMuZ2V0KCdtYXNzJyk7CgogICAgICAgICAgICB2YXIgeG1heCA9IE1hdGgubWF4KHNlbGYuc2NhbGluZ0NvbnRleHQueE1heCgpLCBfLm1heCh4aWMuZ2V0KCdyZXRlbnRpb25UaW1lcycpKSk7CiAgICAgICAgICAgIGlmICghKG9wdGlvbnMgJiYgb3B0aW9ucy5ub0F1dG9YKSkgewogICAgICAgICAgICAgICAgc2VsZi5zY2FsaW5nQ29udGV4dC5zZXRYTWF4KHhtYXgsIHRydWUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgc2VsZi5zY2FsaW5nQ29udGV4dC5zZXRYTWF4KHhtYXgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciB5bWF4ID0gTWF0aC5tYXgoc2VsZi5zY2FsaW5nQ29udGV4dC55TWF4KCksIF8ubWF4KHhpYy5nZXQoJ2ludGVuc2l0aWVzJykpICogMS4xKTsKICAgICAgICAgICAgc2VsZi5zY2FsaW5nQ29udGV4dC5zZXRZTWF4KHltYXgpOwoKICAgICAgICAgICAgdmFyIHh2ID0gbmV3IFhJQ1ZpZXcoewogICAgICAgICAgICAgICAgZWw6IHNlbGYuZWwuYXBwZW5kKCdnJyksCiAgICAgICAgICAgICAgICBtb2RlbDogeGljLAogICAgICAgICAgICAgICAgc2NhbGluZ0NvbnRleHQ6IHNlbGYuc2NhbGluZ0NvbnRleHQsCiAgICAgICAgICAgICAgICByaWNoU2VxdWVuY2U6IHhpYy5nZXQoJ3JpY2hTZXF1ZW5jZScpLAogICAgICAgICAgICAgICAgbm9BdXRvWDogKG9wdGlvbnMgJiYgb3B0aW9ucy5ub0F1dG9YKQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgLy8gICAgICAgICAgICBjb25zb2xlLmxvZyhzZWxmLmNpZCwgJ1hJQyAnLCB4aWMuZ2V0KCdpZCcpLCB4aWMuY2lkLCB4di5jaWQpCgogICAgICAgICAgICBzZWxmLnhpY1ZpZXdzW21dID0geHY7CgogICAgICAgICAgICAvL3NlbGYueFpvb21hYmxlKCk7CgogICAgICAgIH0sCgogICAgICAgIHVwZGF0ZVlBeGlzOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIHlBeGlzID0gZDMuc3ZnLmF4aXMoKS5zY2FsZShzZWxmLnNjYWxpbmdDb250ZXh0LnkoKSkudGlja3MoNCkudGlja1NpemUoNSk7CiAgICAgICAgICAgIHNlbGYuZWxZQXhpcy5zZWxlY3RBbGwoJ2cnKS5yZW1vdmUoKTsKICAgICAgICAgICAgeUF4aXMub3JpZW50KCdyaWdodCcpOwogICAgICAgICAgICB5QXhpcy50aWNrRm9ybWF0KGQzLmZvcm1hdCgiZSIpKTsKICAgICAgICAgICAgc2VsZi5lbFlBeGlzLmNhbGwoeUF4aXMpOwoKICAgICAgICB9LAogICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKG9wdGlvbnMpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICBzZWxmLmVsVGl0bGUudGV4dChzZWxmLnRpdGxlKTsKICAgICAgICAgICAgaWYgKHNlbGYub3B0aW9ucy55YXhpcykgewogICAgICAgICAgICAgICAgc2VsZi51cGRhdGVZQXhpcygpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIF8uZWFjaChfLnZhbHVlcyhzZWxmLnhpY1ZpZXdzKSwgZnVuY3Rpb24gKHh2KSB7CiAgICAgICAgICAgICAgICB4di5yZW5kZXIoKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfSk7CgogICAgcmV0dXJuIE11bHRpWElDVmlldzsKfSk7CgovKioKICogZGlzcGxheSBhIEQzU2NhbGluZ0NvbnRleHQsIG9uIHRoZSB4YXhpcyB2aWV3CiAqCiAqCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwpkZWZpbmUoJ2Zpc2h0b25lcy92aWV3cy91dGlscy9EM1hBeGlzVmlldycsWyd1bmRlcnNjb3JlJywgJ0JhY2tib25lJywgJ2QzJywgJy4uL2NvbW1vbnMvQ29tbW9uV2lkZ2V0VmlldyddLAogICAgZnVuY3Rpb24gKF8sIEJhY2tib25lLCBkMywgQ29tbW9uV2lkZ2V0VmlldykgewogICAgICAgIEQzWEF4aXNWaWV3ID0gQ29tbW9uV2lkZ2V0Vmlldy5leHRlbmQoewogICAgICAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbiAob3B0aW9ucykgewogICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICAgICAgWElDVmlldy5fX3N1cGVyX18uaW5pdGlhbGl6ZS5jYWxsKHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgICBzZWxmLnNldHVwU2NhbGluZ0NvbnRleHQob3B0aW9ucyk7CiAgICAgICAgICAgICAgICBzZWxmLnRyYW5zZm9ybSA9IG9wdGlvbnMudHJhbnNmb3JtOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgICAgICB2YXIgeFNjYWxlOwogICAgICAgICAgICAgICAgaWYgKHNlbGYudHJhbnNmb3JtKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHhEb20gPSBzZWxmLnNjYWxpbmdDb250ZXh0LngoKS5kb21haW4oKQogICAgICAgICAgICAgICAgICAgIHhTY2FsZSA9IGQzLnNjYWxlLmxpbmVhcigpLmRvbWFpbihbc2VsZi50cmFuc2Zvcm0oeERvbVswXSksIHNlbGYudHJhbnNmb3JtKHhEb21bMV0pXSkucmFuZ2UoWzAsIHNlbGYuc2NhbGluZ0NvbnRleHQud2lkdGgoKV0pCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHhTY2FsZSA9IHNlbGYuc2NhbGluZ0NvbnRleHQueCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgeEF4aXMgPSBkMy5zdmcuYXhpcygpLnNjYWxlKHhTY2FsZSkudGlja3MoNykudGlja1N1YmRpdmlkZSg0KS50aWNrU2l6ZSg2LCA1LCAwKTsKICAgICAgICAgICAgICAgIHNlbGYuZWwuY2FsbCh4QXhpcyk7CiAgICAgICAgICAgICAgICB2YXIgZWxzVGlja3MgPSBzZWxmLmVsLnNlbGVjdEFsbCgnZyBnIGcnKVswXQogICAgICAgICAgICAgICAgXy5lYWNoKGVsc1RpY2tzLCBmdW5jdGlvbiAoZWx0KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHBvcyA9IHBhcnNlRmxvYXQoZDMuc2VsZWN0KGVsdCkuYXR0cigndHJhbnNmb3JtJykucmVwbGFjZSgndHJhbnNsYXRlKCcsICcnKS5yZXBsYWNlKCcsMCknLCAnJykpOwogICAgICAgICAgICAgICAgICAgIGQzLnNlbGVjdChlbHQpLnN0eWxlKCdkaXNwbGF5JywgKHBvcyA8IDM1KSA/ICdub25lJyA6IG51bGwpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0pCiAgICAgICAgcmV0dXJuIEQzWEF4aXNWaWV3CiAgICB9KTsKCi8qCiAqIEEgY2xpcHBlZCB2ZXJzaW9uIG9mIGEgWElDCiAqCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwoKZGVmaW5lKCdmaXNodG9uZXMvbW9kZWxzL3dldC9YSUNDbGlwJyxbJ0JhY2tib25lJywgJ0NvbmZpZycsICcuL1hJQyddLCBmdW5jdGlvbihCYWNrYm9uZSwgY29uZmlnLCBYSUMpIHsKICAgIHZhciBYSUNDbGlwID0gWElDLmV4dGVuZCh7CiAgICAgICAgZGVmYXVsdHMgOiB7CiAgICAgICAgfSwKICAgICAgICBpbml0aWFsaXplIDogZnVuY3Rpb24oKSB7CiAgICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gWElDQ2xpcDsKfSk7CgovKgogKiBidWlsZHMgYW4gWElDIENsaXAgb3V0IG9mIGEgWElDICsgcmV0ZW50aW9uIHRpbWUgcmFuZ2UKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCgpkZWZpbmUoJ2Zpc2h0b25lcy9zZXJ2aWNlcy93ZXQvWElDQ2xpcHBlckZhY3RvcnknLFsnanF1ZXJ5JywgJ3VuZGVyc2NvcmUnLCAnQmFja2JvbmUnLCAnQ29uZmlnJywgJ2Zpc2h0b25lcy9tb2RlbHMvd2V0L1hJQ0NsaXAnLCAnZmlzaHRvbmVzL2NvbGxlY3Rpb25zL3dldC9FeHBNU01TU3BlY3RydW1Db2xsZWN0aW9uJ10sIGZ1bmN0aW9uKCQsIF8sIEJhY2tib25lLCBjb25maWcsIFhJQ0NsaXAsIEV4cE1TTVNTcGVjdHJ1bUNvbGxlY3Rpb24pIHsKICAgIHZhciBYSUNDbGlwcGVyRmFjdG9yeSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgIH07CgogICAgLyoqCiAgICAgKiBidWlsZCBhIFhJQ0NsaXAgYmFzZWQgb24geGljIHdpdGggcmV0ZW50aW9uVGltZXMgaW4gdGhlIHdpbmRvdwogICAgICogeGljICBjYW4gYmUgZWl0aGVyOgogICAgICogLSBvbmUgWElDCiAgICAgKiAtIG9uZVhJQ0NvbGxlY3Rpb24gCiAgICAgKiAtIEFycmF5IG9mIFhJQwogICAgICovCiAgICBYSUNDbGlwcGVyRmFjdG9yeS5wcm90b3R5cGUuY2xpcCA9IGZ1bmN0aW9uKHhpYywgcnRJbmYsIHJ0U3VwLCBvcHRpb25zKSB7CiAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgIAogICAgICAgIGlmKHhpYyBpbnN0YW5jZW9mIEJhY2tib25lLkNvbGxlY3Rpb24pewogICAgICAgICAgICByZXR1cm4gc2VsZi5jbGlwKHhpYy5tb2RlbHMsIHJ0SW5mLCBydFN1cCwgb3B0aW9ucykKICAgICAgICB9CiAgICAgICAgaWYoeGljIGluc3RhbmNlb2YgQXJyYXkpewogICAgICAgICAgICByZXR1cm4gXy5jb2xsZWN0KHhpYywgZnVuY3Rpb24oeCl7CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5jbGlwKHgsIHJ0SW5mLCBydFN1cCwgb3B0aW9ucykKICAgICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICB2YXIgY2xpcHBlZCA9IHhpYy5jbG9uZSgpOwogICAgICAgIHZhciBwb2ludHMgPSBfLnppcCh4aWMuZ2V0KCdyZXRlbnRpb25UaW1lcycpLCB4aWMuZ2V0KCdpbnRlbnNpdGllcycpKQogICAgICAgIHBvaW50cyA9IF8uZmlsdGVyKHBvaW50cywgZnVuY3Rpb24ocCkgewogICAgICAgICAgICByZXR1cm4gcFswXSA+PSBydEluZiAmJiBwWzBdIDw9IHJ0U3VwOwogICAgICAgIH0pCgogICAgICAgIGNsaXBwZWQuc2V0KCdyZXRlbnRpb25UaW1lcycsIF8ucGx1Y2socG9pbnRzLCAwKSkKICAgICAgICBjbGlwcGVkLnNldCgnaW50ZW5zaXRpZXMnLCBfLnBsdWNrKHBvaW50cywgMSkpCiAgICAgICAgY2xpcHBlZC5zZXQoJ3J0UmFuZ2UnLCB7CiAgICAgICAgICAgIGluZiA6IHJ0SW5mLAogICAgICAgICAgICBzdXAgOiBydFN1cAogICAgICAgIH0pCiAgICAgICAgY2xpcHBlZC5zZXQoJ21zbXMnLCBuZXcgRXhwTVNNU1NwZWN0cnVtQ29sbGVjdGlvbihjbGlwcGVkLmdldCgnbXNtcycpLmZpbHRlcihmdW5jdGlvbihtc21zKSB7CiAgICAgICAgICAgIHZhciBydCA9IG1zbXMuZ2V0KCdyZXRlbnRpb25UaW1lJyk7CiAgICAgICAgICAgIHJldHVybiBydCA+PSBydEluZiAmJiBydCA8PSBydFN1cAogICAgICAgIH0pKSkKCiAgICAgICAgcmV0dXJuIG5ldyBYSUNDbGlwKGNsaXBwZWQuYXR0cmlidXRlcykKICAgIH07CiAgICByZXR1cm4gbmV3IFhJQ0NsaXBwZXJGYWN0b3J5KCk7Cn0pOwoKLyoqCiAqIG11bHRpcGxlIFhJQyB2aWV3cyBpbiBvbmUgYm94LiBYSUMgaXMgdW5pcXVlIGJ5IGl0cyBtYXNzIGZpZWxkCiAqIHRoZSBzY2FsaW5nIGNvbnRleHQgaXMgZWl0aGVyIHBhc3NlZCAoaWYgbXVsdGlwbGUgZWxlbWVudCBhcmUgc2hhcmluZyB0aGUgc2FtZW9uZSkgb3IgYnVpbHQuIHJhbmdlcyB3aWxsIGJlIGFkYXB0ZWQgZWFjaCB0aW1lIGEgWElDIGlzIGFkZGVkCiAqICBhIFhJQ011bHRpUGFuZVZpZXcgaXMgYSBzZXQgb2YgTXVsdGlYSUNWaWV3LgogKiBXZSBjYW4gc2VlIHRoYXQgYXMgYSBtdWx0bGluZXMgd2lkZ2V0LCBlYWNoIGxpbmUgY29uc2lzdCBvZiBhIGEgc2VyaWVzIG9mIFhJQy4KICogc2NhbGluZyBjb250ZXh0IGlzIGNvaGVyZW50IHRocm91Z2hvdXQgdGhlIGRpZmZlcmVudCBYSUMKICoKICogdGhlIG1vZGVsIG9mIHRoZSB2aWV3IGlmIGEgbWFwIG9mIFhJQ0NvbGxlY3Rpb24KICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCmRlZmluZSgnZmlzaHRvbmVzL3ZpZXdzL3dldC9YSUNNdWx0aVBhbmVWaWV3JyxbJ2pxdWVyeScsICd1bmRlcnNjb3JlJywgJ0JhY2tib25lJywgJ2QzJywgJy4uL2NvbW1vbnMvQ29tbW9uV2lkZ2V0VmlldycsICcuLi91dGlscy9EM1hBeGlzVmlldycsCiAgICAgICAgJy4vTXVsdGlYSUNWaWV3JywgJ2Zpc2h0b25lcy9jb2xsZWN0aW9ucy93ZXQvWElDQ29sbGVjdGlvbicsICdmaXNodG9uZXMvc2VydmljZXMvd2V0L1hJQ0NsaXBwZXJGYWN0b3J5J10sCiAgICBmdW5jdGlvbiAoJCwgXywgQmFja2JvbmUsIGQzLCBDb21tb25XaWRnZXRWaWV3LCBEM1hBeGlzVmlldywgTXVsdGlYSUNWaWV3LCBYSUNDb2xsZWN0aW9uLCB4aWNDbGlwcGVyRmFjdG9yeSkgewoKICAgICAgICBYSUNNdWx0aVBhbmVWaWV3ID0gQ29tbW9uV2lkZ2V0Vmlldy5leHRlbmQoewogICAgICAgICAgICAvL21hcCBvZiBNdWx0aVhJQ1ZpZXcKICAgICAgICAgICAgeGljUGFuZXM6IHt9LAoKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqCiAgICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIGZvciBjb25zdHJ1Y3RvcgogICAgICAgICAgICAgKiAqIGdyb3VwQnkgOiBhIGZ1bmN0aW9uIHRha2luZyBhIHByb3ZpZGVkIFhJQyBhbmQgY29tcHV0aW5nIHRoZSBrZXkgb24gd2hpY2ggd2Ugc2hhbGwgZ3JvdXBlIHRoZSBYSUMgcGFlcnAgcGFuZQogICAgICAgICAgICAgKiAqIGdldEdyb3VwTmFtZSBbb3B0aW9uYWxdOiBob3cgdG8gbmFtZSBhIGdyb3VwIGJhc2VkIG9uIHRoZSBwcm92aWRlZCBYSUMuIFdlIHNob3VsZCBhc3N1bWUgdGhhdCBhbGwgdGhlIGdyb3VwZWRCeSBYSUMgd2lsbCBwcm92aWRlIHRoZSBzYW1lIG5hbWUuLi4KICAgICAgICAgICAgICoKICAgICAgICAgICAgICovCgogICAgICAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbiAob3B0aW9ucykgewogICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICAgICAgb3B0aW9ucyA9IF8uZXh0ZW5kKHt9LCBvcHRpb25zKTsKICAgICAgICAgICAgICAgIE11bHRpWElDVmlldy5fX3N1cGVyX18uaW5pdGlhbGl6ZS5jYWxsKHRoaXMsIG9wdGlvbnMpOwoKICAgICAgICAgICAgICAgIHNlbGYuZ3JvdXBCeSA9IG9wdGlvbnMuZ3JvdXBCeTsKICAgICAgICAgICAgICAgIHNlbGYuZ2V0R3JvdXBOYW1lID0gb3B0aW9ucy5nZXRHcm91cE5hbWUgfHwgc2VsZi5ncm91cEJ5OwogICAgICAgICAgICAgICAgc2VsZi5yZXRlbnRpb25UaW1lU2VsZWN0Q2FsbGJhY2sgPSBvcHRpb25zLnJldGVudGlvblRpbWVTZWxlY3RDYWxsYmFjazsKCiAgICAgICAgICAgICAgICBzZWxmLmxlZ2VuZElzRGlzcGxheWVkID0gb3B0aW9ucy5sZWdlbmQgfHwgZmFsc2U7CiAgICAgICAgICAgICAgICBzZWxmLm5vQXV0b1ggPSBvcHRpb25zLm5vQXV0b1g7CgogICAgICAgICAgICAgICAgc2VsZi5oZWlnaHRYQXhpcyA9IDMwOwogICAgICAgICAgICAgICAgc2VsZi54aWNQYW5lcyA9IHt9OwogICAgICAgICAgICAgICAgc2VsZi5ncm91cGVkTW9kZWxzID0ge307CgogICAgICAgICAgICAgICAgc2VsZi5saXN0ZW5UbyhzZWxmLm1vZGVsLCAnYWRkJywgc2VsZi5zZXR1cCk7CiAgICAgICAgICAgICAgICBzZWxmLmxpc3RlblRvKHNlbGYubW9kZWwsICdyZXNldCcsIHNlbGYuY2xlYXIpOwoKICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coc2VsZik7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBwX2luaXRfcnRfZG9tYWluX3NlbGVjdG9yOiBmdW5jdGlvbiAoY2IpIHsKICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgICAgIC8vc2V0IHRoZSBSVCByYW5nZSBzZWxlY3RvciBhbmQgcGlwZSBpdCB0byBhIGNhbGxiYWNrCgogICAgICAgICAgICAgICAgaWYgKGNiKSB7CiAgICAgICAgICAgICAgICAgICAgc2VsZi5zZXRTaGlmdFNlbGVjdENhbGxiYWNrKGZ1bmN0aW9uIChydERvbWFpbikgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgcnRJbmYgPSBydERvbWFpblswXQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgcnRTdXAgPSBydERvbWFpblsxXQoKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHhpY2NsaXBDb2wgPSBbXQogICAgICAgICAgICAgICAgICAgICAgICBfLmVhY2goc2VsZi5tb2RlbC5tb2RlbHMsIGZ1bmN0aW9uICh4aWMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjbGlwID0geGljQ2xpcHBlckZhY3RvcnkuY2xpcCh4aWMsIHJ0SW5mLCBydFN1cCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGlwLnVuc2V0KCdtc21zUG9pbnRlcnMnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgeGljY2xpcENvbC5wdXNoKGNsaXApCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBjYih4aWNjbGlwQ29sLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBydERvbWFpbjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZjogcnRJbmYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VwOiBydFN1cAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHNldFBhbmVUaXRsZTogZnVuY3Rpb24gKG5hbWUsIHRpdGxlKSB7CiAgICAgICAgICAgICAgICB0aGlzLnhpY1BhbmVzW25hbWVdLnRpdGxlID0gdGl0bGUKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGNsZWFyOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgICAgICAgICAgIF90aGlzLnhpY1BhbmVzID0ge307CiAgICAgICAgICAgICAgICBfdGhpcy5ncm91cGVkTW9kZWxzID0ge307CiAgICAgICAgICAgICAgICBfdGhpcy54aWNQYW5lcyA9IHt9OwogICAgICAgICAgICAgICAgX3RoaXMucHJldlBhbmVzR3JvdXBLZXlzID0gdW5kZWZpbmVkOwoKICAgICAgICAgICAgICAgIF90aGlzLnNldHVwKCkKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHNldHVwOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICAgICAgICAgICAgX3RoaXMuc2V0dXBQYW5lcygpOwogICAgICAgICAgICAgICAgX3RoaXMuZGlzcGF0Y2hNb2RlbHMoKTsKCiAgICAgICAgICAgICAgICBfdGhpcy5yZW5kZXIoKQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIHBhbmVzIGFyZSBidWlsZCBhcmUgcmVuZGVyIHRpbWUsIGJhc2VkIG9uIHRoZSBncm91cEJ5IHByb3BlcnR5CiAgICAgICAgICAgICAqIGJlZnJlIG1lc3NpbmcgZXZlcnl0aGluZyBhcm91bmQsIHdlIGNoZWNrIGlmIG5ldyBwYW5lcyB3ZXJlIGFjdHVhbGx5IGFkZGVkLgogICAgICAgICAgICAgKi8KICAgICAgICAgICAgc2V0dXBQYW5lczogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICAgICAgaWYgKHNlbGYubW9kZWwuc2l6ZSgpID09IDApIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy9nZXQgb25lIFhJQyByZXByZXNlbnRhdGl2ZXMgb2YgYSBwYW5lcwogICAgICAgICAgICAgICAgdmFyIHJlcDRwYW5lcyA9IF8uY2hhaW4oc2VsZi5tb2RlbC5tb2RlbHMpLmdyb3VwQnkoc2VsZi5ncm91cEJ5KS52YWx1ZXMoKS5tYXAoZnVuY3Rpb24gKGwpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbFswXTsKICAgICAgICAgICAgICAgIH0pLnNvcnRCeShzZWxmLmdyb3VwQnkpLnZhbHVlKCk7CgogICAgICAgICAgICAgICAgLy9leHRyYWN0IHRoZSBrZXkgcGVyIGdyb3VwLCBhbmQgcmV0dXJuIGlmIG5vIGNoYW5nZS4KICAgICAgICAgICAgICAgIHZhciBwYW5lc0dyb3VwS2V5cyA9IF8ubWFwKHJlcDRwYW5lcywgc2VsZi5ncm91cEJ5KTsKICAgICAgICAgICAgICAgIGlmIChfLmlzRXF1YWwocGFuZXNHcm91cEtleXMsIHNlbGYucHJldlBhbmVzR3JvdXBLZXlzKSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHNlbGYucHJldlBhbmVzR3JvdXBLZXlzID0gcGFuZXNHcm91cEtleXM7CgogICAgICAgICAgICAgICAgLy9leHRyYWN0IGdyb3VwIG5hbWVzCiAgICAgICAgICAgICAgICBzZWxmLnBhbmVOYW1lcyA9IHJlcDRwYW5lcy5tYXAoc2VsZi5nZXRHcm91cE5hbWUpOwogICAgICAgICAgICAgICAgdmFyIG5iUGFuZXMgPSByZXA0cGFuZXMubGVuZ3RoOwoKICAgICAgICAgICAgICAgIHZhciBoZWlnaHRQYW5lID0gTWF0aC5mbG9vcigoc2VsZi5oZWlnaHQoKSAtIHNlbGYuaGVpZ2h0WEF4aXMpIC8gbmJQYW5lcyk7CgogICAgICAgICAgICAgICAgaWYgKHNlbGYueGF4aXNWaWV3ID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICBzZWxmLnNldHVwU2NhbGluZ0NvbnRleHQoewogICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IGhlaWdodFBhbmUKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB2YXIgZ3hheGlzID0gc2VsZi5lbC5hcHBlbmQoJ2cnKS5hdHRyKCdjbGFzcycsICd0aW1lLXNjYWxlIHhheGlzJykuYXR0cigndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZSgwLCcgKyAoc2VsZi5oZWlnaHQoKSAtIHNlbGYuaGVpZ2h0WEF4aXMpICsgJyknKTsKICAgICAgICAgICAgICAgICAgICBneGF4aXMuYXBwZW5kKCdyZWN0JykuYXR0cignd2lkdGgnLCBzZWxmLnNjYWxpbmdDb250ZXh0LndpZHRoKCkpLmF0dHIoJ2hlaWdodCcsIHNlbGYuaGVpZ2h0WEF4aXMpLmF0dHIoJ2NsYXNzJywgJ2JhY2tncm91bmQnKTsKICAgICAgICAgICAgICAgICAgICBzZWxmLnhheGlzVmlldyA9IG5ldyBEM1hBeGlzVmlldyh7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsOiBneGF4aXMuYXBwZW5kKCdnJyksCiAgICAgICAgICAgICAgICAgICAgICAgIHNjYWxpbmdDb250ZXh0OiBzZWxmLnNjYWxpbmdDb250ZXh0LAogICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm06IGZ1bmN0aW9uICh4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4geCAvIDYwCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBzZWxmLnNldHVwWm9vbSgpOwoKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvL2NyZWF0ZSBwYW5lcyBpZiB0aGVyZSBhcmUgbmVjZXNzYXJ5CiAgICAgICAgICAgICAgICByZXA0cGFuZXMuZm9yRWFjaChmdW5jdGlvbiAocmVwWGljLCBpKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGsgPSBzZWxmLmdyb3VwQnkocmVwWGljKTsKICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZi54aWNQYW5lc1trXSA9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGcgPSBzZWxmLmVsLmFwcGVuZCgnZycpOwogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmdyb3VwZWRNb2RlbHNba10gPSBuZXcgWElDQ29sbGVjdGlvbigpOwoKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi54aWNQYW5lc1trXSA9IG5ldyBNdWx0aVhJQ1ZpZXcoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWw6IGcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY2FsaW5nQ29udGV4dDogc2VsZi5zY2FsaW5nQ29udGV4dCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsOiBzZWxmLmdyb3VwZWRNb2RlbHNba10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBzZWxmLmdldEdyb3VwTmFtZShyZXBYaWMpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgeWF4aXM6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBub0F1dG9YOiBzZWxmLm5vQXV0b1gsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogc2VsZi5nZXRHcm91cE5hbWUocmVwWGljKQoKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHNlbGYueGljUGFuZXNba10uZWwuYXR0cigndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZSgwLCcgKyAoaSAqIGhlaWdodFBhbmUgKSArICcpJyk7CiAgICAgICAgICAgICAgICAgICAgLy9zZWxmLnhpY1BhbmVzW2tdLnNjYWxpbmdDb250ZXh0ID0gc2VsZi5zY2FsaW5nQ29udGV4dDsKICAgICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKGssIHNlbGYueGljUGFuZXNba10uc2NhbGluZ0NvbnRleHQpCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgc2VsZi5zY2FsaW5nQ29udGV4dC5oZWlnaHQoaGVpZ2h0UGFuZSk7CiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKHNlbGYuY2lkLCAnYWRkaW5nIHBhbmUnLCBuYW1lLCBzZWxmLnhpY1BhbmVzW25hbWVdLmNpZCkKCiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBzZXR1cFpvb206IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgICAgIHNlbGYueFpvb21hYmxlKCkKCiAgICAgICAgICAgICAgICBzZWxmLmdldE1heFlJblhEb21haW4gPSBmdW5jdGlvbiAoeG1pbiwgeG1heCkgewogICAgICAgICAgICAgICAgICAgIHZhciB5bWF4ID0gXy5jaGFpbihzZWxmLm1vZGVsLm1vZGVscykucGx1Y2soJ19kYXRhUG9pbnRzJykubWFwKGZ1bmN0aW9uIChkcHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF8uY2hhaW4oZHBzKS5maWx0ZXIoZnVuY3Rpb24gKGRwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZHBbMF0gPj0geG1pbiAmJiBkcFswXSA8PSB4bWF4OwogICAgICAgICAgICAgICAgICAgICAgICB9KS5wbHVjaygxKS5tYXgoKS52YWx1ZSgpOwogICAgICAgICAgICAgICAgICAgIH0pLm1heCgpLnZhbHVlKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHltYXggKiAxLjEgLy8xLjEgYXNzZXJ0IGZvciB0aGUgc2NhbGluZ1kgY29udGV4dCBtYWpvcmVkIGZyb20gdGhlIHJlYWwgbWF4CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoc2VsZi5ydERvbWFpblNlbGVjdG9yID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICBzZWxmLnBfaW5pdF9ydF9kb21haW5fc2VsZWN0b3Ioc2VsZi5yZXRlbnRpb25UaW1lU2VsZWN0Q2FsbGJhY2spCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHNlbGYucnREb21haW5TZWxlY3Rvci5zY2FsaW5nQ29udGV4dCA9IHNlbGYuc2NhbGluZ0NvbnRleHQ7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICB9LAoKICAgICAgICAgICAgc2V0dXBMZWdlbmQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgICAgICAgICAgICBfdGhpcy5nTGVnZW5kID0gX3RoaXMuZWwuYXBwZW5kKCdnJykuYXR0cignY2xhc3MnLCAnY2hyb21hdG8gbGVnZW5kJyk7CiAgICAgICAgICAgICAgICBfdGhpcy5nTGVnZW5kLmFwcGVuZCgncmVjdCcpLmF0dHIoJ2NsYXNzJywgJ2JhY2tncm91bmQnKS5hdHRyKCdyeCcsIDUpLmF0dHIoJ3J5JywgNSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXM7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICAvKioKICAgICAgICAgICAgICogdGhlIG1vZGVsIGlzIGEgY29sbGVjdGlvbnMsIGJ1dCB0aG9zZSBtb2RlbHMgc2hvdWxkIGJlIGRpc3BhdGNoZWQgdG93cmFkcyB0aGUgaW5kaXZpZHVhbCAgc2VsZi5ncm91cGVkTW9kZWxzW2tdCiAgICAgICAgICAgICAqIEFuZCB0aGUgcG9pbnQgaXMgbm90IHRvIHVwZGF0ZSBhIGNvbGxlY3Rpb24gdGhhdCBoYXMgbm90IGNoYW5nZWQuLi4uCiAgICAgICAgICAgICAqCiAgICAgICAgICAgICAqLwogICAgICAgICAgICBkaXNwYXRjaE1vZGVsczogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICAgICAgXy5jaGFpbihzZWxmLm1vZGVsLm1vZGVscykuZ3JvdXBCeShzZWxmLmdyb3VwQnkpLmVhY2goZnVuY3Rpb24gKGxNb2RlbHMsIGspIHsKICAgICAgICAgICAgICAgICAgICBsTW9kZWxzLmZvckVhY2goZnVuY3Rpb24gKHgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5ncm91cGVkTW9kZWxzW2tdLmFkZCh4KQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIC8vc2VsZi5ncm91cGVkTW9kZWxzW2tdLnJlc2V0KGxNb2RlbHMpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBhZGQgdGhlIGxlZ2VuZHMgaW50byB0aGUgYm94CiAgICAgICAgICAgICAqLwogICAgICAgICAgICByZW5kZXJMZWdlbmQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICAgICAgICAgICAgaWYgKF90aGlzLmdMZWdlbmQgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgIF90aGlzLnNldHVwTGVnZW5kKCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdmFyIGhMaW5lID0gMjA7CiAgICAgICAgICAgICAgICB2YXIgd01veiA9IDEzMDsKICAgICAgICAgICAgICAgIHZhciB3VGV4dCA9IDIwMDsKCiAgICAgICAgICAgICAgICBfdGhpcy5nTGVnZW5kLnNlbGVjdEFsbCgnZy5sZWdlbmQtbGluZScpLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgdmFyIG1heE1veiA9IF8uY2hhaW4oX3RoaXMubW9kZWwubGVnZW5kcy5saXN0KCkpLnBsdWNrKCdtYXNzZXMnKS5tYXAoZnVuY3Rpb24gKGwpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbC5maWx0ZXIoZnVuY3Rpb24gKG0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG07CiAgICAgICAgICAgICAgICAgICAgfSkubGVuZ3RoOwogICAgICAgICAgICAgICAgfSkubWF4KCkudmFsdWUoKTsKICAgICAgICAgICAgICAgIG1heE1veiA9IE1hdGgubWF4KG1heE1veiwgMCk7CgogICAgICAgICAgICAgICAgXy5lYWNoKF90aGlzLm1vZGVsLmxlZ2VuZHMubGlzdCgpLCBmdW5jdGlvbiAobGVnLCBpTGVnKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGdMaW5lID0gX3RoaXMuZ0xlZ2VuZC5hcHBlbmQoJ2cnKS5hdHRyKCdjbGFzcycsICdsZWdlbmQtbGluZScpLmF0dHIoJ3RyYW5zZm9ybScsICd0cmFuc2xhdGUoNSwnICsgKGhMaW5lICogKGlMZWcgKyAwLjUpKSArICcpJykKCiAgICAgICAgICAgICAgICAgICAgdmFyIGltb3ogPSAwOwogICAgICAgICAgICAgICAgICAgIF8uZWFjaChsZWcubWFzc2VzLCBmdW5jdGlvbiAobW96LCB6KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghbW96KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGdNb3ogPSBnTGluZS5hcHBlbmQoJ2cnKS5hdHRyKCd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlKCcgKyAoaW1veiAqIHdNb3opICsgJywwKScpLmF0dHIoJ2NsYXNzJywgJyBsZWdlbmQtZW5saWdodGVyJykuYXR0cignbGVnZW5kc3VibGlnaHRlZCcsICcuY2hyb21hdG8nKS5hdHRyKCdsZWdlbmRlbmxpZ2h0ZWQnLCAnLmNocm9tYXRvLmNoYXJnZV8nICsgeiArICcudGFyZ2V0XycgKyBpTGVnKTsKICAgICAgICAgICAgICAgICAgICAgICAgZ01vei5hcHBlbmQoJ3BhdGgnKS5hdHRyKCdkJywgJ00wLDBMNTAsMCcpLmF0dHIoJ2NsYXNzJywgJ2Nocm9tYXRvIHRhcmdldF8nICsgaUxlZyArICcgY2hhcmdlXycgKyB6KTsKICAgICAgICAgICAgICAgICAgICAgICAgZ01vei5hcHBlbmQoJ3RleHQnKS50ZXh0KCcnICsgeiArICcrICgnICsgbW96LnRvRml4ZWQoNCkgKyAnKScpLmF0dHIoJ3gnLCA1NSk7CgogICAgICAgICAgICAgICAgICAgICAgICBpbW96Kys7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgZ0xpbmUuYXBwZW5kKCd0ZXh0JykuYXR0cigneCcsIG1heE1veiAqIHdNb3opLnRleHQobGVnLm5hbWUpOwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgX3RoaXMuZ0xlZ2VuZC5zZWxlY3RBbGwoJ2cubGVnZW5kLWVubGlnaHRlcicpLm9uKCdtb3VzZW92ZXInLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGVuU2VsID0gJCh0aGlzKS5hdHRyKCdsZWdlbmRlbmxpZ2h0ZWQnKTsKICAgICAgICAgICAgICAgICAgICB2YXIgc3ViU2VsID0gJCh0aGlzKS5hdHRyKCdsZWdlbmRzdWJsaWdodGVkJyk7CgogICAgICAgICAgICAgICAgICAgIGQzLnNlbGVjdEFsbChzdWJTZWwpLnN0eWxlKCdzdHJva2Utb3BhY2l0eScsICcxNSUnKTsKICAgICAgICAgICAgICAgICAgICBkMy5zZWxlY3RBbGwoZW5TZWwpLnN0eWxlKCdzdHJva2Utb3BhY2l0eScsIG51bGwpOwogICAgICAgICAgICAgICAgICAgIGQzLnNlbGVjdEFsbChzdWJTZWwpLnN0eWxlKCdmaWxsLW9wYWNpdHknLCAnMTUlJyk7CiAgICAgICAgICAgICAgICAgICAgZDMuc2VsZWN0QWxsKGVuU2VsKS5zdHlsZSgnZmlsbC1vcGFjaXR5JywgbnVsbCk7CiAgICAgICAgICAgICAgICB9KS5vbignbW91c2VvdXQnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHN1YlNlbCA9ICQodGhpcykuYXR0cignbGVnZW5kc3VibGlnaHRlZCcpOwogICAgICAgICAgICAgICAgICAgIGQzLnNlbGVjdEFsbChzdWJTZWwpLnN0eWxlKCdzdHJva2Utb3BhY2l0eScsIG51bGwpOwogICAgICAgICAgICAgICAgICAgIGQzLnNlbGVjdEFsbChzdWJTZWwpLnN0eWxlKCdmaWxsLW9wYWNpdHknLCBudWxsKTsKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIHZhciB3ID0gbWF4TW96ICogd01veiArIHdUZXh0OwogICAgICAgICAgICAgICAgX3RoaXMuZ0xlZ2VuZC5hdHRyKCd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlKCcgKyAoX3RoaXMud2lkdGgoKSAtIHcgLSAyMCkgKyAnLCcgKyA0MCArICcpJykKICAgICAgICAgICAgICAgIF90aGlzLmdMZWdlbmQuc2VsZWN0QWxsKCdyZWN0LmJhY2tncm91bmQnKS5hdHRyKCd3aWR0aCcsIHcpLmF0dHIoJ2hlaWdodCcsIF90aGlzLm1vZGVsLmxlZ2VuZHMuc2l6ZSgpICogaExpbmUpOwogICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAob3B0aW9ucykgewogICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICAgICAgaWYgKHNlbGYueGF4aXNWaWV3KSB7CiAgICAgICAgICAgICAgICAgICAgc2VsZi54YXhpc1ZpZXcucmVuZGVyKCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIDsKCiAgICAgICAgICAgICAgICBfLmVhY2goXy52YWx1ZXMoc2VsZi54aWNQYW5lcyksIGZ1bmN0aW9uICh4dikgewogICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coJ211bHRpcGFuZSByZW5kZXJpbmcgTVVUTFRJIFhJQycsIHh2KQogICAgICAgICAgICAgICAgICAgIHh2LnJlbmRlcigpOwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgaWYgKHNlbGYubGVnZW5kSXNEaXNwbGF5ZWQpIHsKICAgICAgICAgICAgICAgICAgICBzZWxmLnJlbmRlckxlZ2VuZCgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICByZXR1cm4gWElDTXVsdGlQYW5lVmlldzsKICAgIH0pOwoKLyoKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCmRlZmluZSgnZmlzaHRvbmVzL3ZpZXdzL3dldC9TcGVjdHJ1bVZpZXcnLFsndW5kZXJzY29yZScsICdkMycsICcuLi9jb21tb25zL0NvbW1vbldpZGdldFZpZXcnLCAnZmlzaHRvbmVzL3ZpZXdzL3V0aWxzL0QzU2NhbGluZ0NvbnRleHQnLCAnZmlzaHRvbmVzL3ZpZXdzL3V0aWxzL0QzU2NhbGluZ0FyZWEnXSwgZnVuY3Rpb24gKF8sIGQzLCBDb21tb25XaWRnZXRWaWV3LCBEM1NjYWxpbmdDb250ZXh0LCBEM1NjYWxpbmdBcmVhKSB7CiAgICAvKgogICAgICogcHJvamVjdGVkIHBlYWtzIGNvbnRhaW5zIDMgdmFsdWVzOgogICAgICoKICAgICAqIDA6IG1vegogICAgICogMTppbnRlbnNpdHkKICAgICAqIDI6IGludGVuc2l0eSByYW5rcwogICAgICovCiAgICB2YXIgcHJvamVjdFBlYWtzID0gZnVuY3Rpb24gKGV4cFNwKSB7CiAgICAgICAgcmV0dXJuIF8uY2hhaW4oZXhwU3AuZ2V0KCdtb3pzJykpLnppcChleHBTcC5nZXQoJ2ludGVuc2l0aWVzJyksIGV4cFNwLmdldCgnaW50ZW5zaXR5UmFua3MnKSkudmFsdWUoKQoKICAgIH0KICAgIHZhciBwZWFrUmFua0NsYXNzID0gZnVuY3Rpb24gKHBrKSB7CiAgICAgICAgdmFyIGlyayA9IHBrWzJdOwogICAgICAgIHJldHVybiAncmstJyArICgoaXJrIDwgNDApID8gTWF0aC5mbG9vcihpcmsgLyAxMCkgOiAneCcpOwogICAgfQogICAgdmFyIFNwZWN0cnVtVmlldyA9IENvbW1vbldpZGdldFZpZXcuZXh0ZW5kKHsKICAgICAgICBkZWZhdWx0czogewogICAgICAgIH0sCiAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKG9wdGlvbnMpIHsKICAgICAgICAgICAgb3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCBvcHRpb25zKTsKICAgICAgICAgICAgU3BlY3RydW1WaWV3Ll9fc3VwZXJfXy5pbml0aWFsaXplLmNhbGwodGhpcywgb3B0aW9ucykKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICBzZWxmLmNvbG9yUGVha3MgPSBvcHRpb25zLmNvbG9yUGVha3M7CgogICAgICAgICAgICBzZWxmLmhTY2FsZT0yMDsKICAgICAgICAgICAgc2VsZi5idWlsZCgpOwogICAgICAgICAgICBzZWxmLm1vZGVsLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBzZWxmLmJ1aWxkKCkucmVuZGVyKCk7CiAgICAgICAgICAgIH0pCiAgICAgICAgfSwKCiAgICAgICAgYnVpbGQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuYnVpbGREYXRhKCkuYnVpbGRDb250ZXh0KCkuYnVpbGREMygpOwogICAgICAgIH0sCiAgICAgICAgYnVpbGREYXRhOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgc2VsZi5wZWFrcyA9IHByb2plY3RQZWFrcyhzZWxmLm1vZGVsKTsKCiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIH0sCiAgICAgICAgYnVpbGRDb250ZXh0OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgICAgICAgIHZhciB4TWF4ID0gc2VsZi5tb2RlbC5nZXQoJ21venMnKVtzZWxmLm1vZGVsLnNpemUoKSAtIDFdICogMS4xOwogICAgICAgICAgICB2YXIgeE1pbiA9IHNlbGYubW9kZWwuZ2V0KCdtb3pzJylbMF0gKiAwLjU7CiAgICAgICAgICAgIHZhciB5TWF4ID0gTWF0aC5tYXgoXy5tYXgoc2VsZi5tb2RlbC5nZXQoJ2ludGVuc2l0aWVzJykpKSAqIDEuMDU7CgogICAgICAgICAgICBzZWxmLnNldHVwU2NhbGluZ0NvbnRleHQoewogICAgICAgICAgICAgICAgeERvbWFpbjogW3hNaW4sIHhNYXhdLAogICAgICAgICAgICAgICAgeURvbWFpbjogWzAsIHlNYXhdLAogICAgICAgICAgICAgICAgaGVpZ2h0OiBzZWxmLmhlaWdodCgpLXNlbGYuaFNjYWxlLAogICAgICAgICAgICAgICAgd2lkdGg6IHNlbGYud2lkdGgoKQogICAgICAgICAgICB9KQoKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgfSwKICAgICAgICBidWlsZEQzOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgICAgICAgIHNlbGYudmlzID0gc2VsZi5lbC5hcHBlbmQoJ2cnKTsKICAgICAgICAgICAgc2VsZi52aXMuYXR0cignd2lkdGgnLCBzZWxmLndpZHRoKCkpLmF0dHIoJ2hlaWdodCcsIHNlbGYuaGVpZ2h0KCkpLmF0dHIoJ2NsYXNzJywgJ3NwZWN0cnVtJyk7CgogICAgICAgICAgICB2YXIgeXMgPSBzZWxmLnNjYWxpbmdDb250ZXh0LnkoKTsKCiAgICAgICAgICAgIHNlbGYucGVha3NIb2xkZXIgPSBzZWxmLnZpcy5zZWxlY3RBbGwoJ2xpbmUucGVhaycpLmRhdGEoc2VsZi5wZWFrcykuZW50ZXIoKS5hcHBlbmQoJ2xpbmUnKS5hdHRyKCdjbGFzcycsIGZ1bmN0aW9uIChwaykgewogICAgICAgICAgICAgICAgdmFyIGNsID0gJ3BlYWsgIHBlYWsteCc7CiAgICAgICAgICAgICAgICBpZiAoc2VsZi5jb2xvclBlYWtzKSB7CiAgICAgICAgICAgICAgICAgICAgY2wgKz0gJyAnICsgcGVha1JhbmtDbGFzcyhwayk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gY2w7CiAgICAgICAgICAgIH0pLmF0dHIoJ3kxJywgZnVuY3Rpb24gKHBrKSB7CiAgICAgICAgICAgICAgICByZXR1cm4geXMoMCk7CiAgICAgICAgICAgIH0pLmF0dHIoJ3kyJywgZnVuY3Rpb24gKHBrKSB7CiAgICAgICAgICAgICAgICByZXR1cm4geXMocGtbMV0pOwogICAgICAgICAgICB9KTsKCgogICAgICAgICAgICB2YXIgZ3RpdGxlcyA9IHNlbGYudmlzLmFwcGVuZCgnZycpLmF0dHIoJ2NsYXNzJywgJ3RpdGxlcycpCiAgICAgICAgICAgIGd0aXRsZXMuYXBwZW5kKCd0ZXh0JykudGV4dCgnIycgKyBzZWxmLm1vZGVsLmdldCgnc2Nhbk51bWJlcicpKS5hdHRyKCd4Jywgc2VsZi53aWR0aCgpIC0gNSkuYXR0cigneScsIDMwKS5hdHRyKCdjbGFzcycsICdzY2FuIHRvcCcpCgogICAgICAgICAgICBzZWxmLmF4aXNDb250YWluZXIgPSBzZWxmLnZpcy5hcHBlbmQoJ2cnKS5hdHRyKCdjbGFzcycsICdheGlzJykuYXR0cigndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZSgwLCcreXMoMCkrJyknKTsKCiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIH0sCiAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIHggPSBzZWxmLnNjYWxpbmdDb250ZXh0LngoKTsKCiAgICAgICAgICAgIHNlbGYudmlzLnNlbGVjdEFsbCgnbGluZS5wZWFrLXgnKS5hdHRyKCd4MScsIGZ1bmN0aW9uIChwaykgewogICAgICAgICAgICAgICAgcmV0dXJuIHgocGtbMF0pCiAgICAgICAgICAgIH0pLmF0dHIoJ3gyJywgZnVuY3Rpb24gKHBrKSB7CiAgICAgICAgICAgICAgICByZXR1cm4geChwa1swXSkKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHZhciB4QXhpcyA9IGQzLnN2Zy5heGlzKCkuc2NhbGUoeCkudGlja1NpemUoNCwgMywgMykudGlja3MoMykvLyIiLnRpY2tGb3JtYXQoZDMuZm9ybWF0KCJkIikpOwogICAgICAgICAgICBzZWxmLmF4aXNDb250YWluZXIuY2FsbCh4QXhpcyk7CiAgICAgICAgfQogICAgfSk7CgogICAgcmV0dXJuIFNwZWN0cnVtVmlldzsKCn0pCjsKLyoKICogQ2xlYXZhZ2UgZW56eW1lIHRvIGNsZWF2ZSBwcm90ZWluIHNlcXVlbmNlCiAqIHByb3BlcnRpZXM6CiAqIC0gbmFtZQogKiAtIHJ1bGU6IGEgcmVndWxhciBleHByZXNzaW9uIChzaW50cmcgb3IgUmVnRXhwIG9iamVjdCkKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCmRlZmluZSgnZmlzaHRvbmVzL21vZGVscy9kcnkvQ2xlYXZhZ2VFbnp5bWUnLFsndW5kZXJzY29yZScsICdCYWNrYm9uZSddLCBmdW5jdGlvbihfLCBCYWNrYm9uZSkgewogICAgdmFyIENsZWF2YWdlRW56eW1lID0gQmFja2JvbmUuTW9kZWwuZXh0ZW5kKHsKICAgICAgICBpZEF0dHJpYnV0ZSA6ICduYW1lJywKICAgICAgICBkZWZhdWx0cyA6IHsKICAgICAgICAgICAgbmFtZSA6ICcnLAogICAgICAgICAgICBydWxlIDogbnVsbAogICAgICAgIH0sCiAgICAgICAgc2V0IDogZnVuY3Rpb24oYXR0cnMsIG9wdGlvbnMpIHsKICAgICAgICAgICAgaWYgKF8uaXNTdHJpbmcoYXR0cnMucnVsZSkpIHsKICAgICAgICAgICAgICAgIGF0dHJzLnJ1bGUgPSBuZXcgUmVnRXhwKCBhdHRycy5ydWxlLCAnZycpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBCYWNrYm9uZS5Nb2RlbC5wcm90b3R5cGUuc2V0LmNhbGwodGhpcywgYXR0cnMsIG9wdGlvbnMpOwogICAgICAgIH0sCiAgICAgICAgaW5pdGlhbGl6ZSA6IGZ1bmN0aW9uKCkgewogICAgICAgIH0sCgogICAgICAgIHRvU3RyaW5nIDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgcmV0dXJuIHNlbGYuZ2V0KCduYW1lJykgKyBzZWxmLmdldCgncnVsZScpOwogICAgICAgIH0sCiAgICAgICAgLyoqCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gc2VxIGFuIGlucHV0IGFtaW5vIGFjaWQgc3RyaW5nIHNlcXVlbmNlCiAgICAgICAgICogQHJldHVybiB7QXJyYXl9IGEgbGlzdCBvZiBzdHJpbmcgc2VxdWVuY2VzCiAgICAgICAgICovCiAgICAgICAgY2xlYXZlIDogZnVuY3Rpb24oc2VxKSB7CiAgICAgICAgICAgIHZhciByZXQgPSBbXTsKICAgICAgICAgICAgdmFyIHJlZ2V4cCA9IG5ldyBSZWdFeHAodGhpcy5nZXQoJ3J1bGUnKS5zb3VyY2UsICdnJyk7CiAgICAgICAgICAgIHdoaWxlICggbSA9IHJlZ2V4cC5leGVjKHNlcSkpIHsKICAgICAgICAgICAgICAgIHJldC5wdXNoKG1bMF0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByZXQKICAgICAgICB9CiAgICB9KTsKICAgIHJldHVybiBDbGVhdmFnZUVuenltZTsKfSk7CgovKgogKiBlbnp5bWUgd2l0aCByZWd1bGFyIGV4cHJlc3Npb24uIFRoZXNlcyBhcmUgYSBiaXQgdWdseSwgYmVjYXVzZSBKYXZhU2NyaXB0IGRvZXMgc3VwcG9ydCBsb29rIGFoZWFkCiAqIFRoaXMgZmlsZSBpcyB0byBiZSBsb2FkZWQgYnkgY29sbGVjdGlvbnMvZHJ5L0NsZWF2YWdlRW56eW1lRGljdGlvbmFyeQogKiAKICogQ29weXJpZ2h0IChjKSAyMDEzLTItMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCgpkZWZpbmUoJ2Zpc2h0b25lcy9kYXRhL2NsZWF2YWdlRW56eW1lcycsW10sZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIFsKICAgICAgICB7CiAgICAgICAgICAgIG5hbWU6ICJ0cnlwc2luIiwKICAgICAgICAgICAgcnVsZTogJyg/OltSS118Lis/KD86W1JLXXwkKSkoPz1bXlBdfCQpJwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBuYW1lOiAiYXJnLWMiLAogICAgICAgICAgICBydWxlOiAnKD86UnwuKz8oPzpSfCQpKSg/PVteUF18JCknCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIG5hbWU6ICJjaHltb3RyeXBzaW4iLAogICAgICAgICAgICBydWxlOiAnKD86W0ZMV1ldfC4rPyg/OltGTFdZXXwkKSkoPz1bXlBdfCQpJwogICAgICAgIH0KICAgIF0KfSk7CgoKLyoKICogQSBzaW5nbGV0b24gY2xlYXZhZ2UgZW56eW1lIGNvbGxlY3Rpb24sIGxvYWRlZCBmcm9tIGRhdGEvY2xlYXZhZ2VFbnp5bWVzLmpzCiAqIAogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KCmRlZmluZSgnZmlzaHRvbmVzL2NvbGxlY3Rpb25zL2RyeS9DbGVhdmFnZUVuenltZURpY3Rpb25hcnknLFsnZmlzaHRvbmVzL21vZGVscy9kcnkvQ2xlYXZhZ2VFbnp5bWUnLCAnZmlzaHRvbmVzL2RhdGEvY2xlYXZhZ2VFbnp5bWVzJ10sIGZ1bmN0aW9uKENsZWF2YWdlRW56eW1lLCBic19lbnp5bWVzKSB7CiAgICB2YXIgQ2xlYXZhZ2VFbnp5bWVEaWN0aW9uYXJ5ID0gQmFja2JvbmUuQ29sbGVjdGlvbi5leHRlbmQoewogICAgICAgIG1vZGVsIDogQ2xlYXZhZ2VFbnp5bWUsCiAgICAgICAgZGVmYXVsdHMgOiB7CiAgICAgICAgfSwKICAgICAgICBpbml0aWFsaXplIDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgc2VsZi5hZGQoYnNfZW56eW1lcyk7CiAgICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gbmV3IENsZWF2YWdlRW56eW1lRGljdGlvbmFyeSgpOwp9KTsKCi8qCiAqIEFuIGFtaW5vIGFjaWQgc2VxdWVuY2UsIHdpdGgKICogLSBhY2Nlc3Npb25jb2RlCiAqIC0gbmFtZQogKiAtIHNlcXVlbmNlCiAqCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwpkZWZpbmUoJ2Zpc2h0b25lcy9tb2RlbHMvZHJ5L0FBU2VxdWVuY2UnLFsnanF1ZXJ5JywgJ3VuZGVyc2NvcmUnLCAnQmFja2JvbmUnXSwgZnVuY3Rpb24oJCwgXywgQmFja2JvbmUpIHsKICAgIHZhciBBQVNlcXVlbmNlID0gQmFja2JvbmUuTW9kZWwuZXh0ZW5kKHsKICAgICAgICBpZEF0dHJpYnV0ZSA6ICduYW1lJywKICAgICAgICBkZWZhdWx0cyA6IHsKICAgICAgICAgICAgbmFtZSA6IG51bGwsCiAgICAgICAgICAgIGFjY2Vzc2lvbkNvZGUgOiBudWxsLAogICAgICAgICAgICBzZXF1ZW5jZSA6IG51bGwKICAgICAgICB9LAogICAgICAgIGluaXRpYWxpemUgOiBmdW5jdGlvbigpIHsKICAgICAgICB9LAogICAgICAgIHRvU3RyaW5nIDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgcmV0dXJuIHNlbGYuZ2V0KCdhY2Nlc3Npb25jb2RlJykgKyAnfCcgKyBzZWxmLmdldCgnbmFtZScpICsgJyAoJyArIHNlbGYuZ2V0KCdzZXF1ZW5jZScpLmxlbmdoICsgJyknOwogICAgICAgIH0sCiAgICAgICAgc2l6ZSA6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgcyA9IHRoaXMuZ2V0KCdzZXF1ZW5jZScpCiAgICAgICAgICAgIGlmIChzID09IG51bGwpIHsKICAgICAgICAgICAgICAgIHJldHVybiAwCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHMubGVuZ3RoCiAgICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gQUFTZXF1ZW5jZTsKfSk7IAoKLyoKICogYSBmZXcgZGVmYXVsdCBzZXF1ZW5jZXMsIGJ1dCBhbnkgb3RoZXIgY2FuIGJlIGFkZGVkCiAqCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwpkZWZpbmUoJ2Zpc2h0b25lcy9kYXRhL2FhU2VxdWVuY2VzJyxbXSxmdW5jdGlvbigpIHsKICAgIHJldHVybiBbewogICAgICAgIG5hbWUgOiAiSDMuMSIsCiAgICAgICAgYWNjZXNzaW9uQ29kZSA6ICJQNjg0MzEiLAogICAgICAgIHNlcXVlbmNlIDogIk1BUlRLUVRBUktTVEdHS0FQUktRTEFUS0FBUktTQVBBVEdHVktLUEhSWVJQR1RWQUxSRUlSUllRS1NURUxMSVJLTFBGUVJMVlJFSUFRREZLVERMUkZRU1NBVk1BTFFFQUNFQVlMVkdMRkVEVE5MQ0FJSEFLUlZUSU1QS0RJUUxBUlJJUkdFUkEiCiAgICB9LCB7CiAgICAgICAgbmFtZSA6ICJIMy4xVCIsCiAgICAgICAgYWNjZXNzaW9uQ29kZSA6ICJRMTY2OTUiLAogICAgICAgIHNlcXVlbmNlIDogIk1BUlRLUVRBUktTVEdHS0FQUktRTEFUS1ZBUktTQVBBVEdHVktLUEhSWVJQR1RWQUxSRUlSUllRS1NURUxMSVJLTFBGUVJMTVJFSUFRREZLVERMUkZRU1NBVk1BTFFFQUNFU1lMVkdMRkVEVE5MQ1ZJSEFLUlZUSU1QS0RJUUxBUlJJUkdFUkEiCiAgICB9LCB7CiAgICAgICAgbmFtZSA6ICJIMy4yIiwKICAgICAgICBhY2Nlc3Npb25Db2RlIDogIlE3MURJMyIsCiAgICAgICAgc2VxdWVuY2UgOiAiTUFSVEtRVEFSS1NUR0dLQVBSS1FMQVRLQUFSS1NBUEFUR0dWS0tQSFJZUlBHVFZBTFJFSVJSWVFLU1RFTExJUktMUEZRUkxWUkVJQVFERktURExSRlFTU0FWTUFMUUVBU0VBWUxWR0xGRURUTkxDQUlIQUtSVlRJTVBLRElRTEFSUklSR0VSQSIKICAgIH0sIHsKICAgICAgICBuYW1lIDogIkgzLjMiLAogICAgICAgIGFjY2Vzc2lvbkNvZGUgOiAiUDg0MjQzIiwKICAgICAgICBzZXF1ZW5jZSA6ICJNQVJUS1FUQVJLU1RHR0tBUFJLUUxBVEtBQVJLU0FQU1RHR1ZLS1BIUllSUEdUVkFMUkVJUlJZUUtTVEVMTElSS0xQRlFSTFZSRUlBUURGS1RETFJGUVNBQUlHQUxRRUFTRUFZTFZHTEZFRFROTENBSUhBS1JWVElNUEtESVFMQVJSSVJHRVJBIgogICAgfSwgewogICAgICAgIG5hbWUgOiAiSDMuQyIsCiAgICAgICAgYWNjZXNzaW9uQ29kZSA6ICJRNk5YVDIiLAogICAgICAgIHNlcXVlbmNlIDogIk1BUlRLUVRBUktTVEdHS0FQUktRTEFUS0FBUktTVFBTVENHVktQSFJZUlBHVFZBTFJFSVJSWVFLU1RFTExJUktMUEZRUkxWUkVJQVFERk5URExSRlFTQUFWR0FMUUVBU0VBWUxWR0xMRURUTkxDQUlIQUtSVlRJTVBLRElRTEFSUklSR0VSQSIKICAgIH0sIHsKICAgICAgICBuYW1lIDogIkg0IiwKICAgICAgICBhY2Nlc3Npb25Db2RlIDogIlA2MjgwNSIsCiAgICAgICAgc2VxdWVuY2UgOiAiTVNHUkdLR0dLR0xHS0dHQUtSSFJLVkxSRE5JUUdJVEtQQUlSUkxBUlJHR1ZLUklTR0xJWUVFVFJHVkxLVkZMRU5WSVJEQVZUWVRFSEFLUktUVlRBTURWVllBTEtSUUdSVExZR0ZHRyIKICAgIH1dCn0pOwoKLy8gPnNwfFA2ODQzMXxIMzFfSFVNQU4gSGlzdG9uZSBIMy4xIE9TPUhvbW8gc2FwaWVucyBHTj1ISVNUMUgzQSBQRT0xIFNWPTIKLy8gTUFSVEtRVEFSS1NUR0dLQVBSS1FMQVRLQUFSS1NBUEFUR0dWS0tQSFJZUlBHVFZBTFJFSVJSWVFLU1RFTExJUktMUEZRUkxWUkVJQVFERktURExSRlFTU0FWTUFMUUVBQ0VBWUxWR0xGRURUTkxDQUlIQUtSVlRJTVBLRElRTEFSUklSR0VSQQovLyA+c3B8UTE2Njk1fEgzMVRfSFVNQU4gSGlzdG9uZSBIMy4xdCBPUz1Ib21vIHNhcGllbnMgR049SElTVDNIMyBQRT0xIFNWPTMKLy8gTUFSVEtRVEFSS1NUR0dLQVBSS1FMQVRLVkFSS1NBUEFUR0dWS0tQSFJZUlBHVFZBTFJFSVJSWVFLU1RFTExJUktMUEZRUkxNUkVJQVFERktURExSRlFTU0FWTUFMUUVBQ0VTWUxWR0xGRURUTkxDVklIQUtSVlRJTVBLRElRTEFSUklSR0VSQQoKLy8gPnNwfFE3MURJM3xIMzJfSFVNQU4gSGlzdG9uZSBIMy4yIE9TPUhvbW8gc2FwaWVucyBHTj1ISVNUMkgzQSBQRT0xIFNWPTMKLy8gTUFSVEtRVEFSS1NUR0dLQVBSS1FMQVRLQUFSS1NBUEFUR0dWS0tQSFJZUlBHVFZBTFJFSVJSWVFLU1RFTExJUktMUEZRUkxWUkVJQVFERktURExSRlFTU0FWTUFMUUVBU0VBWUxWR0xGRURUTkxDQUlIQUtSVlRJTVBLRElRTEFSUklSR0VSQQoKLy8gPnNwfFA4NDI0M3xIMzNfSFVNQU4gSGlzdG9uZSBIMy4zIE9TPUhvbW8gc2FwaWVucyBHTj1IM0YzQSBQRT0xIFNWPTIKLy8gTUFSVEtRVEFSS1NUR0dLQVBSS1FMQVRLQUFSS1NBUFNUR0dWS0tQSFJZUlBHVFZBTFJFSVJSWVFLU1RFTExJUktMUEZRUkxWUkVJQVFERktURExSRlFTQUFJR0FMUUVBU0VBWUxWR0xGRURUTkxDQUlIQUtSVlRJTVBLRElRTEFSUklSR0VSQQovLyA+c3B8UTZOWFQyfEgzQ19IVU1BTiBIaXN0b25lIEgzLjNDIE9TPUhvbW8gc2FwaWVucyBHTj1IM0YzQyBQRT0xIFNWPTMKLy8gTUFSVEtRVEFSS1NUR0dLQVBSS1FMQVRLQUFSS1NUUFNUQ0dWS1BIUllSUEdUVkFMUkVJUlJZUUtTVEVMTElSS0xQRlFSTFZSRUlBUURGTlRETFJGUVNBQVZHQUxRRUFTRUFZTFZHTExFRFROTENBSUhBS1JWVElNUEtESVFMQVJSSVJHRVJBCi8vCi8vID5zcHxQNjI4MDV8SDRfSFVNQU4gSGlzdG9uZSBINCBPUz1Ib21vIHNhcGllbnMgR049SElTVDFINEEgUEU9MSBTVj0yCi8vIE1TR1JHS0dHS0dMR0tHR0FLUkhSS1ZMUkROSVFHSVRLUEFJUlJMQVJSR0dWS1JJU0dMSVlFRVRSR1ZMS1ZGTEVOVklSREFWVFlURUhBS1JLVFZUQU1EVlZZQUxLUlFHUlRMWUdGR0cKOwovKgogKiBBIHNpbmdsZXRvbiBkaWN0aW9uYXJ5IGZvciBhIGZldyBwcm90ZWluIHNlcXVlbmNlcyAobWFpbmx5IGhpc3RvbmUgdGFpbHMsIGJ1dCBhZGQgeW91ciBvd24uLi4pCiAqIGl0IGFsbG93IHRvIGdldCBhIG5hbWUgdG8gYSBzZXF1ZW5jZSwgYnV0IGFsc28sIGlmIGEgdHJ5cHRpYyBwZXB0aWRlIHNlcXVlbmNlIGlzIHVuaXF1ZSBhY3Jvc3MgdGhlIGRpZmZlcmVudCBBQVNlcXVlbmNlLAogKiB3ZSBjYW4gcmVmZXIgdG8gaXQgbGlrZSBIMy4zSzI3CiAqCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwoKZGVmaW5lKCdmaXNodG9uZXMvY29sbGVjdGlvbnMvZHJ5L0FBU2VxdWVuY2VEaWN0aW9uYXJ5JyxbJ0JhY2tib25lJywgJ2Zpc2h0b25lcy9tb2RlbHMvZHJ5L0FBU2VxdWVuY2UnLCAnZmlzaHRvbmVzL2RhdGEvYWFTZXF1ZW5jZXMnXSwgZnVuY3Rpb24oQmFja2JvbmUsIEFBU2VxdWVuY2UsIGJzX3NlcXVlbmNlcykgewogICAgdmFyIEFBU2VxdWVuY2VEaWN0aW9uYXJ5ID0gQmFja2JvbmUuQ29sbGVjdGlvbi5leHRlbmQoewogICAgICAgIG1vZGVsIDogQUFTZXF1ZW5jZSwKICAgICAgICBkZWZhdWx0cyA6IHsKICAgICAgICB9LAogICAgICAgIGluaXRpYWxpemUgOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgc2VsZi5hZGQoYnNfc2VxdWVuY2VzKTsKICAgICAgICB9CiAgICB9KTsKICAgIHJldHVybiBuZXcgQUFTZXF1ZW5jZURpY3Rpb25hcnkoKTsKfSk7CgovKgogKiBhIEFBU2VxdWVuY2VQZXB0aWRlUHRyIG9iamVjdCB0cmFuc2Zvcm1zIHBlcHRpZGUgc2VxdWVuY2UgaW50byBhIHNob3J0ZXIgcG9pbnRlciB0byB0aGUgcHJvdGVpbnMuCiAqIFRoaXMgYWxpYXMgc2hvdWxkIGJlIHVuZXF1aXZvY2FsIHJlZ2FyZGluZyB0byB0aGUgbGlzdCBvZiBrbm93biBwcm90ZWlucyAoQUFTZXF1ZW5jZURpY3Rpb25hcnkpCiAqCiAqIFRoaXMgY2xhc3MgaXMgdXNlZCBhcyBhIHV0aWxpdHkgYnkgUnVpY2hTZXF1ZW5jZVNob3J0Y3V0ZXIKICoKICogV2Ugd2FudCB0byBnaXZlIEgzSzQgYW5kIHRoaXMga2luZCBvZiBzaG9ydGN1dCwgZ2l2ZW4gYW4gZW56eW1lLCBhbmQgaXQgcmV0dXJucyBhIHVuYW1iaWd1b3VzIHBlcHRpZGUKICogQW5kIHZpY2UgdmVyc2EsIGdpdmVuIGEgcGVwdGlkZSwgaXQgZ2l2ZXMgYmFjayB0aGUgc2hvcnRlc3QgcG9zc2libGUgcG9pbnRlcgogKgogKiBGb3IgZXhhbXBsZSwgU2VlIEFBU2VxdWVuY2VQZXB0aWRlUHRyLXRlc3QuanMgZm9yIGV4YW1wbGVzCiAqCiAqIFByb3BlcnRpZXM6CiAqIC0gY2xlYXZhZ2VFbnp5bWU6IGVpdGhlciBhIG5hbWUgcmVmZXJpbmcgdG8gdGhlIGRpY3Rpb25hcnkgb3IgYW4gb2JqZWN0CiAqCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwoKCmRlZmluZSgnZmlzaHRvbmVzL21vZGVscy9kcnkvQUFTZXF1ZW5jZVBlcHRpZGVQdHInLFsndW5kZXJzY29yZScsICdCYWNrYm9uZScsICdmaXNodG9uZXMvY29sbGVjdGlvbnMvZHJ5L0NsZWF2YWdlRW56eW1lRGljdGlvbmFyeScsICdmaXNodG9uZXMvY29sbGVjdGlvbnMvZHJ5L0FBU2VxdWVuY2VEaWN0aW9uYXJ5J10sIGZ1bmN0aW9uIChfLCBCYWNrYm9uZSwgZGljb0NFLCBkaWNvU2VxKSB7CiAgICB2YXIgQUFTZXF1ZW5jZVBlcHRpZGVQdHIgPSBCYWNrYm9uZS5Nb2RlbC5leHRlbmQoewogICAgICAgIGRlZmF1bHRzOiB7CiAgICAgICAgICAgIGNsZWF2YWdlRW56eW1lOiBudWxsLAogICAgICAgICAgICBwZXB0aWRlSW5kZXg6IHt9CiAgICAgICAgfSwKICAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgfSwKICAgICAgICBzZXQ6IGZ1bmN0aW9uIChhdHRycywgb3B0aW9ucykgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHZhciBjZSA9IG51bGw7CiAgICAgICAgICAgIGlmIChhdHRycyA9PSAnY2xlYXZhZ2VFbnp5bWUnKSB7CiAgICAgICAgICAgICAgICBpZiAoXy5pc1N0cmluZyhvcHRpb25zKSkgewogICAgICAgICAgICAgICAgICAgIGNlID0gb3B0aW9ucyA9IGRpY29DRS5nZXQob3B0aW9ucykKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAob3B0aW9ucyBpbnN0YW5jZW9mIENsZWF2YWdlRW56eW1lKSB7CiAgICAgICAgICAgICAgICAgICAgY2UgPSBvcHRpb25zOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKF8uaXNTdHJpbmcoYXR0cnMuY2xlYXZhZ2VFbnp5bWUpKSB7CiAgICAgICAgICAgICAgICBjZSA9IGF0dHJzLmNsZWF2YWdlRW56eW1lID0gZGljb0NFLmdldChhdHRycy5jbGVhdmFnZUVuenltZSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoYXR0cnMuY2xlYXZhZ2VFbnp5bWUpIHsKICAgICAgICAgICAgICAgIGNlID0gYXR0cnMuY2xlYXZhZ2VFbnp5bWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGNlICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIHNlbGYucF9yZWJ1aWxkUGVwdGlkZUluZGV4KGNlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gQmFja2JvbmUuTW9kZWwucHJvdG90eXBlLnNldC5jYWxsKHNlbGYsIGF0dHJzLCBvcHRpb25zKTsKICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiByZWJ1aWxkIHRoZSBpbmRleCBwZXB0aWRlIC0+IHNlcXVlbmNlICsgcG9zaXRpb25zCiAgICAgICAgICogQHBhcmFtIHtDbGVhdmFnZUVuenltZX0gb3B0aW9uYWwgcGFyYW1zIChkZWZhdWx0IGlzIHRoZSBjbGVhdmFnZUVuenltZSBwcm9wZXJ0eSkuIFdlIGNhbiBwYXNzIGl0IGluIGNhc2UgdGhlIGVuenltZSBwcm8gaGFzIG5vdCBiZWUgc2V0IHlldCAoc2V0dGVyIG92ZXJpZGluZykKICAgICAgICAgKi8KICAgICAgICBwX3JlYnVpbGRQZXB0aWRlSW5kZXg6IGZ1bmN0aW9uIChjZSkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHZhciBwaW5kZXggPSB7fTsKCiAgICAgICAgICAgIGNlID0gY2UgfHwgc2VsZi5nZXQoJ2NsZWF2YWdlRW56eW1lJyk7CiAgICAgICAgICAgIGlmIChjZSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIG4gPSAwOwogICAgICAgICAgICBfLmVhY2goZGljb1NlcS5tb2RlbHMsIGZ1bmN0aW9uIChhYVNlcSkgewogICAgICAgICAgICAgICAgdmFyIHBvcyA9IDA7CiAgICAgICAgICAgICAgICBfLmVhY2goY2UuY2xlYXZlKGFhU2VxLmdldCgnc2VxdWVuY2UnKSksIGZ1bmN0aW9uIChwZXB0KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHBsaXN0ID0gcGluZGV4W3BlcHRdOwogICAgICAgICAgICAgICAgICAgIGlmICghcGxpc3QpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcGluZGV4W3BlcHRdID0gW107CiAgICAgICAgICAgICAgICAgICAgICAgIHBsaXN0ID0gcGluZGV4W3BlcHRdCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHBsaXN0LnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICBhYVNlcTogYWFTZXEsCiAgICAgICAgICAgICAgICAgICAgICAgIG9mZnNldDogcG9zCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICBwb3MgKz0gcGVwdC5sZW5ndGg7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgbisrCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBzZWxmLnNldCgncGVwdGlkZUluZGV4JywgcGluZGV4KTsKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogdGFuc2Zvcm0KICAgICAgICAgKiBIMy5bMSwxVCwyXSAtPiBIMy4xCiAgICAgICAgICogSDMuMSAtPiBIMy4xCiAgICAgICAgICovCiAgICAgICAgcHRyVHJpbTogZnVuY3Rpb24gKHB0cikgewoKICAgICAgICAgICAgaWYgKG0gPSAvKC4rKVxbKC4rPyksLio/XSguKikvLmV4ZWMocHRyKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIG1bMV0gKyBtWzJdICsgbVszXQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBwdHI7CiAgICAgICAgfSwKICAgICAgICAvKioKICAgICAgICAgKiBmcm9tIHRoZSBzZXF1ZW5jZSBwb2ludGVyLCBleHRyYWN0IHRoZSBsaXN0IG9mIHByb3RlaW5zIG1hdGNoaW5nCiAgICAgICAgICogSDNLNCA9PiBhbGwgdGhlIHByb3Qgc3RhdGluZyB3aXRoIGEgbmFtZSBIMwogICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBwdHIKICAgICAgICAgKi8KICAgICAgICBwdHIyQUFTZXF1ZW5jZXM6IGZ1bmN0aW9uIChwdHIpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICB2YXIgc2VxUHRyID0gc2VsZi5wX3B0cjJzZXFBbmRQZXB0QW5jaG9yKHNlbGYucHRyVHJpbShwdHIpKS5zZXFQdHI7CgogICAgICAgICAgICBpZiAoZGljb1NlcS5nZXQoc2VxUHRyKSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gW2RpY29TZXEuZ2V0KHNlcVB0cildOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgbCA9IF8uZmlsdGVyKGRpY29TZXEubW9kZWxzLCBmdW5jdGlvbiAoYWFzZXEpIHsKICAgICAgICAgICAgICAgIHJldHVybiBhYXNlcS5nZXQoJ25hbWUnKS5pbmRleE9mKHNlcVB0cikgPT0gMAogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGlmIChsLmxlbmd0aCA9PSAwKSB7CiAgICAgICAgICAgICAgICB0aHJvdyB7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogJ0lsbGVnYWxzZXF1ZW5jZVB0ckV4Y2VwdGlvbicsCiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJ2Nhbm5vdCBmaW5kIG1hdGNoaW5nIEFBU2VxdWVuY2UgWycgKyBwdHIgKyAnXS9bJyArIHNlcVB0ciArICddJwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGw7CiAgICAgICAgfSwKICAgICAgICAvKioKICAgICAgICAgKiBmcm9tIHRoZSBzZXF1ZW5jZSBwb2ludGVyLCByZXR1cm4gb25lIG1hcCBmb3IgdGhlIHBlcHRpZGU6IHtzZXF1ZW5jZTogLi4uICwgb2Zmc2V0Oi4uLn0KICAgICAgICAgKiBJdCB3aWxsIHRoZSBiZSBwYXNzZWQgdG8gUmljaFNlcXVlbmNlU2hvcnRjdXRlciBmb3IgdGhlIGFjdHVhbFJpY2hTZXF1ZW5jZSBjcmVhdGlvbgogICAgICAgICAqCiAgICAgICAgICogSWYgdGhlIGFuc3dlciBpcyBhbWJpZ3VvdXMsIGFuIGV4Y3BldGlvbkhhbmRsZXIucmFpc2UoZXhjcGV0aW9uKSBpcyByYWlzZWQKICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBwdHIKICAgICAgICAgKi8KICAgICAgICBwdHIycGVwdGlkZTogZnVuY3Rpb24gKHB0cikgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHZhciBsU2VxdWVuY2VzID0gc2VsZi5wdHIyQUFTZXF1ZW5jZXMocHRyKTsKCiAgICAgICAgICAgIHZhciBhYXB0ciA9IHNlbGYucF9wdHIyc2VxQW5kUGVwdEFuY2hvcihwdHIpLmFhUHRyOwogICAgICAgICAgICB2YXIgbSA9IGFhcHRyLm1hdGNoKC8oW0EtWl0pKFxkKykvKQogICAgICAgICAgICB2YXIgYW5jaG9yQUEgPSBtWzFdOwogICAgICAgICAgICB2YXIgYW5jaG9yUG9zID0gcGFyc2VJbnQobVsyXSk7CgogICAgICAgICAgICB2YXIgbHBlcHQgPSBfLmNoYWluKGxTZXF1ZW5jZXMpLmNvbGxlY3QoZnVuY3Rpb24gKGFhU2VxKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5wX2NsZWF2ZWRQZXB0aWRlQXQoYWFTZXEsIGFuY2hvclBvcyk7CiAgICAgICAgICAgIH0pLnVuaXEoKS5ncm91cEJ5KGZ1bmN0aW9uIChwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcC5zZXF1ZW5jZSArICd8JyArIHAub2Zmc2V0CiAgICAgICAgICAgIH0pLnZhbHVlcygpLmNvbGxlY3QoZnVuY3Rpb24gKGwpIHsKICAgICAgICAgICAgICAgIHJldHVybiBsWzBdCiAgICAgICAgICAgIH0pLnZhbHVlKCk7CgogICAgICAgICAgICBpZiAobHBlcHQubGVuZ3RoID4gMSkgewogICAgICAgICAgICAgICAgdGhyb3cgewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICdBbWJpZ3VvdXNQdHJFeGNlcHRpb24nLAogICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdwb2ludGVyICcgKyBwdHIgKyAnIHBvaW50cyB0byBtdWx0aXBsZSBwZXB0aWRlczogJyArIF8uY29sbGVjdChscGVwdCwgZnVuY3Rpb24gKHApIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHAuc2VxdWVuY2UgKyAnQCcgKyBwLm9mZnNldAogICAgICAgICAgICAgICAgICAgIH0pLmpvaW4oJywgJykgKyAiLlxuQ2hvb3NlIGEgbGVzcyBhbWJpZ3VvdXMgcHJvdGVpbiBuYW1lIGFtb25nOiAiICsgXy5jb2xsZWN0KGxTZXF1ZW5jZXMsIGZ1bmN0aW9uIChhYVNlcSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYWFTZXEuZ2V0KCduYW1lJyk7CiAgICAgICAgICAgICAgICAgICAgfSkuam9pbignLCAnKQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgcmV0ID0gbHBlcHRbMF07CgogICAgICAgICAgICBpZiAocmV0LnNlcXVlbmNlLmNoYXJBdChhbmNob3JQb3MgLSByZXQub2Zmc2V0KSAhPSBhbmNob3JBQSkgewogICAgICAgICAgICAgICAgdGhyb3cgewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICdJbnZhbGlkUHRyRXhjZXB0aW9uJywKICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAncG9pbnRlciAnICsgcHRyICsgJyBkb2VzIG5vdCBwb2ludCB0byBhbWlub2FjaWQ6ICcgKyBhbmNob3JBQSArICcgYXQgcG9zaXRpb24gJyArIGFuY2hvclBvcyArICcgKGluIGZhY3Q6JyArIHJldC5zZXF1ZW5jZS5jaGFyQXQoYW5jaG9yUG9zIC0gcmV0Lm9mZnNldCkgKyAnKScKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiByZXQKCiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogZnJvbSBhIGxpc3Qgb2YgQUFTZXF1ZW5jZSBvciBuYW1lcywgYnVpbGQgYSBzaG9ydCBjb25jYXRlbmF0aW9uIG9uIHRoZW0KICAgICAgICAgKi8KICAgICAgICBjb25jYXRlbmF0ZU5hbWVzOiBmdW5jdGlvbiAobHNlcSkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHZhciBsTmFtZXMgPSBfLmNvbGxlY3QobHNlcSwgZnVuY3Rpb24gKG4pIHsKICAgICAgICAgICAgICAgIGlmIChfLmlzU3RyaW5nKG4pKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG4KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBuLmdldCgnbmFtZScpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgbE5hbWVzID0gbE5hbWVzLnNvcnQoKTsKCiAgICAgICAgICAgIGlmIChsTmFtZXMubGVuZ3RoIDw9IDEpIHsKICAgICAgICAgICAgICAgIHJldHVybiBsTmFtZXNbMF07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBpQ29tbW9uID0gMTsKICAgICAgICAgICAgd2hpbGUgKGlDb21tb24gPD0gbE5hbWVzWzBdLmxlbmd0aCkgewogICAgICAgICAgICAgICAgdmFyIHByZWYgPSBsTmFtZXNbMF0uc3Vic3RyKDAsIGlDb21tb24pOwoKICAgICAgICAgICAgICAgIGlmIChfLmFueShsTmFtZXMsIGZ1bmN0aW9uIChuKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG4uc3Vic3RyKDAsIGlDb21tb24pICE9IHByZWY7CiAgICAgICAgICAgICAgICB9KSkgewoKICAgICAgICAgICAgICAgICAgICBpQ29tbW9uLS07CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpQ29tbW9uKysKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgY29tbW9uID0gbE5hbWVzWzBdLnN1YnN0cigwLCBpQ29tbW9uKTsKCiAgICAgICAgICAgIHZhciBhbGxOYW1lczRjb21tb24gPSBfLmNoYWluKGRpY29TZXEubW9kZWxzKS5jb2xsZWN0KGZ1bmN0aW9uIChhYXNlcSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGFhc2VxLmdldCgnbmFtZScpCiAgICAgICAgICAgIH0pLmZpbHRlcihmdW5jdGlvbiAobikgewogICAgICAgICAgICAgICAgcmV0dXJuIG4uaW5kZXhPZihjb21tb24pID09IDAKICAgICAgICAgICAgfSkudmFsdWUoKS5zb3J0KCkKICAgICAgICAgICAgaWYgKGFsbE5hbWVzNGNvbW1vbi5sZW5ndGggPT0gbE5hbWVzLmxlbmd0aCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYucF9zaG9ydGVuTmFtZShjb21tb24pCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGNvbW1vbiArIGxOYW1lc1swXS5zdWJzdHIoaUNvbW1vbik7CgogICAgICAgICAgICAvLyByZXR1cm4gY29tbW9uICsgJ1snICsgXy5jb2xsZWN0KGxOYW1lcywgZnVuY3Rpb24obikgewogICAgICAgICAgICAvLyByZXR1cm4gbi5zdWJzdHIoaUNvbW1vbik7CiAgICAgICAgICAgIC8vIH0pLmpvaW4oJywnKSArICddJwogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIGZyb20gYSBzZXF1ZW5jZSwgcmV0dXJuIHRoZSBjbGVhdmVkIHBlcHRpZGUgY29udGFpbmVpbmcgcG9zaXRpb24gcG9zCiAgICAgICAgICogQHBhcmFtIHtBQVNlcXVlbmNlfSBhYVNlcQogICAgICAgICAqIEBwYXJhbSB7aW50fSBwb3MKICAgICAgICAgKi8KICAgICAgICBwX2NsZWF2ZWRQZXB0aWRlQXQ6IGZ1bmN0aW9uIChhYVNlcSwgcG9zKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgaWYgKHBvcyA+PSBhYVNlcS5zaXplKCkpIHsKICAgICAgICAgICAgICAgIHRocm93IHsKICAgICAgICAgICAgICAgICAgICBuYW1lOiAnSWxsZWdhbFBvc2l0aW9uT25TZXF1ZW5jZScsCiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJ3Bvc2l0aW9uICcgKyBwb3MgKyAnIGV4Y2VlZCBzaXplICcgKyBhYVNlcS5zaXplKCkgKyAnIGZvciBzZXEgJyArIGdldC5nZXQoJ25hbWUnKQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBwID0gMDsKCiAgICAgICAgICAgIHZhciByZWdleHAgPSBzZWxmLmdldCgnY2xlYXZhZ2VFbnp5bWUnKS5nZXQoJ3J1bGUnKTsKICAgICAgICAgICAgcmVnZXhwLmxhc3RJbmRleCA9IDA7CiAgICAgICAgICAgIHdoaWxlIChtID0gcmVnZXhwLmV4ZWMoYWFTZXEuZ2V0KCdzZXF1ZW5jZScpKSkgewogICAgICAgICAgICAgICAgdmFyIHBlcHQgPSBtWzBdCiAgICAgICAgICAgICAgICBwICs9IHBlcHQubGVuZ3RoOwogICAgICAgICAgICAgICAgaWYgKHAgPiBwb3MpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICBzZXF1ZW5jZTogcGVwdCwKICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0OiBwIC0gcGVwdC5sZW5ndGgKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG51bGwKICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqIGZyb20gSDJBSzI3QWNLMzZNZSAtPiB7c2VxUHRyOidIMkEnLCBhYVB0cjonSzI3J30KICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gcHRyCiAgICAgICAgICovCiAgICAgICAgcF9wdHIyc2VxQW5kUGVwdEFuY2hvcjogZnVuY3Rpb24gKHB0cikgewogICAgICAgICAgICB2YXIgcmUgPSAvXlxzKihbQS1aXSsuKj8pKFtBLVpdXGQrKS87CiAgICAgICAgICAgIHZhciBtID0gcHRyLm1hdGNoKHJlKTsKICAgICAgICAgICAgaWYgKCFtKSB7CiAgICAgICAgICAgICAgICB0aHJvdyB7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogJ0lsbGVnYWxzZXF1ZW5jZVB0ckV4Y2VwdGlvbicsCiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJyBjYW5ub3QgZXh0cmFjdCBzZXF1ZW5jZSBuYW1lIGhlYWQgIC8gQUEgcG9zIGZyb20gWycgKyBwdHIgKyAnXSB3aXRoICcgKyByZQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBzZXFQdHI6IG1bMV0sCiAgICAgICAgICAgICAgICBhYVB0cjogbVsyXQogICAgICAgICAgICB9CgogICAgICAgIH0sCiAgICAgICAgLy8gY2hlY2sgaWYgaGF2ZSB0aGVtIGFsbCBzdGF0aW5nIHdpdGggY29tbW9uIChpbiB0aGlzIGNhc2UsIHdlIGNhbiByZXR1cm4gb25seSB0aGUgY29tbW9uIHBhcnQpCiAgICAgICAgcF9zaG9ydGVuTmFtZTogZnVuY3Rpb24gKG5hbWUpIHsKICAgICAgICAgICAgdmFyIGFsbE5hbWVzID0gXy5jb2xsZWN0KGRpY29TZXEubW9kZWxzLCBmdW5jdGlvbiAoYWFzZXEpIHsKICAgICAgICAgICAgICAgIHJldHVybiBhYXNlcS5nZXQoJ25hbWUnKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgdmFyIGN1ck5hbWUgPSBuYW1lOwogICAgICAgICAgICB2YXIgaSA9IG5hbWUubGVuZ3RoIC0gMTsKICAgICAgICAgICAgd2hpbGUgKGkgPiAwKSB7CiAgICAgICAgICAgICAgICB2YXIgdHJ1bmNhdGVkID0gbmFtZS5zdWJzdHIoMCwgaSk7CiAgICAgICAgICAgICAgICBpZiAoXy5hbnkoYWxsTmFtZXMsIGZ1bmN0aW9uIChuKSB7CgogICAgICAgICAgICAgICAgICAgIHZhciBva0Z1bGwgPSBuLnN1YnN0cigwLCBuYW1lLmxlbmd0aCkgPT0gbmFtZTsKICAgICAgICAgICAgICAgICAgICB2YXIgb2tUcnVuYyA9IG4uc3Vic3RyKDAsIHRydW5jYXRlZC5sZW5ndGgpID09IHRydW5jYXRlZDsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gKCFva0Z1bGwgJiYgb2tUcnVuYykgfHwgKG9rRnVsbCAmJiAhb2tUcnVuYyk7CiAgICAgICAgICAgICAgICB9KSkgewogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaS0tOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBuYW1lLnN1YnN0cigwLCBpICsgMSkKICAgICAgICB9LAoKICAgICAgICB0b1N0cmluZzogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHJldHVybiBzZWxmLmdldCgnY2xlYXZhZ2VFbnp5bWUnKSArICcgIyBwZXB0aWRlczogJyArIF8uc2l6ZShzZWxmLmdldCgncGVwdGlkZUluZGV4JykpOwogICAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIEFBU2VxdWVuY2VQZXB0aWRlUHRyOwp9KTsKCi8qCiAqIEJ1aWxkcyBhbmQgdW5idWlsZHMgcGVwdGlkZSBzZXF1ZW5jZSBhdGxhcyBjb21wb3NpbmcKICogSW1wbGljaXRNb2RpZmllciBmb3IgbGFiZWxzCiAqIEFBU2VxdWVuY2VQZXB0aWRlUHRyIHRvIHBvaW50IGEgdHJ5cHRpYyBwZXB0aWRlIHRvIGFuIHVuYW1iaWd1b3VzIHByb3RlaW4gc2VxdWVuY2UgYW4gcG9zaXRpb24KICogdHJhbnNmb3JtIGNvbW1vbiBtb2RpZGlmaWNhdGlvbnMgaW50byBhIHNob3J0Y3V0IEFDRHtQaG9zcGhvfUVGe0RpbWV0aHlsfUcgLT4gQUNEUG9FRk1lMkcKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCmRlZmluZSgnZmlzaHRvbmVzL3NlcnZpY2VzL2RyeS9SaWNoU2VxdWVuY2VTaG9ydGN1dGVyJyxbJ2pxdWVyeScsICd1bmRlcnNjb3JlJywgJ0JhY2tib25lJywgJ2Zpc2h0b25lcy9tb2RlbHMvZHJ5L1JpY2hTZXF1ZW5jZScsICdmaXNodG9uZXMvbW9kZWxzL2RyeS9BQVNlcXVlbmNlUGVwdGlkZVB0cicsICdmaXNodG9uZXMvY29sbGVjdGlvbnMvZHJ5L0FtaW5vQWNpZERpY3Rpb25hcnknLCAnZmlzaHRvbmVzL2NvbGxlY3Rpb25zL2RyeS9SZXNpZHVlTW9kaWZpY2F0aW9uRGljdGlvbmFyeScsICdmaXNodG9uZXMvc2VydmljZXMvZHJ5L0ltcGxpY2l0TW9kaWZpZXInXSwgZnVuY3Rpb24oJCwgXywgQmFja2JvbmUsIFJpY2hTZXF1ZW5jZSwgQUFTZXF1ZW5jZVBlcHRpZGVQdHIsIGRpY29BQSwgZGljb1Jlc01vZCwgaW1wbGljaXRNb2RpZmllcikgewoKICAgIHZhciBSaWNoU2VxdWVuY2VTaG9ydGN1dGVyID0gQmFja2JvbmUuTW9kZWwuZXh0ZW5kKHsKICAgICAgICBkZWZhdWx0cyA6IHsKICAgICAgICAgICAgbW9kaWYyc2hvcnQgOiB7CiAgICAgICAgICAgICAgICAvLyAnTGFiZWw6MTNDKDYpMTVOKDIpJzonU2lsYWNrJywKICAgICAgICAgICAgICAgIC8vICdMYWJlbDoxM0MoNikxNU4oNCknOidTaWxhY3InLAogICAgICAgICAgICAgICAgUHJvcGlvbnlsIDogIlByb3AiLAogICAgICAgICAgICAgICAgJ1Byb3Bpb255bDoySCg1KScgOiAnUHJvcGQ1JywKICAgICAgICAgICAgICAgIE1ldGh5bCA6IFsnTWUnLCAnTWUxJ10sCiAgICAgICAgICAgICAgICBEaW1ldGh5bCA6ICdNZTInLAogICAgICAgICAgICAgICAgVHJpbWV0aHlsIDogJ01lMycsCiAgICAgICAgICAgICAgICBBY2V0eWwgOiAnQWMnLAogICAgICAgICAgICAgICAgUGhvc3BobyA6ICdQbycsCiAgICAgICAgICAgICAgICBHbHlHbHkgOiAnVWInCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHJlUmV2ZXJzZSA6IC8oW0EtWl0pKCg/OltBLVpdW2EtejAtOV0rKSopL2csCiAgICAgICAgICAgIHJlUmV2U3BsaXRNb2RpZiA6IC8oPzpbQS1aXVthLXowLTldKykvZwoKICAgICAgICB9LAogICAgICAgIGluaXRpYWxpemUgOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge2NsZWF2YWdlRW56eW1lOiAnYXJnLWMnfTsKICAgICAgICAgICAgc2VsZi5zZXQoJ2FhU2VxdWVuY2VQZXB0aWRlUHRyJywgbmV3IEFBU2VxdWVuY2VQZXB0aWRlUHRyKCkpOwogICAgICAgICAgICBzZWxmLmdldCgnYWFTZXF1ZW5jZVBlcHRpZGVQdHInKS5zZXQoJ2NsZWF2YWdlRW56eW1lJywgb3B0aW9ucy5jbGVhdmFnZUVuenltZSk7CiAgICAgICAgfSwKICAgICAgICBzZXQgOiBmdW5jdGlvbihhdHRycywgb3B0aW9ucykgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIGlmIChhdHRycy5tb2RpZjJzaG9ydCkgewogICAgICAgICAgICAgICAgc2VsZi5wX2luaXRfc2hvcnQybW9kaWYoYXR0cnMubW9kaWYyc2hvcnQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBCYWNrYm9uZS5Nb2RlbC5wcm90b3R5cGUuc2V0LmNhbGwodGhpcywgYXR0cnMsIG9wdGlvbnMpOwogICAgICAgIH0sCgogICAgICAgIC8vIHRoaXMuc2hvcnQybW9kaWYgPSBudWxsOwogICAgICAgIC8vIHRoaXMucF9pbml0X3Nob3J0Mm1vZGlmID0gcF9pbml0X3Nob3J0Mm1vZGlmOwogICAgICAgIHNob3J0Mm1vZGlmIDogZnVuY3Rpb24obW9kaWZTaG9yY3R1dCkgewogICAgICAgICAgICB2YXIgcm0gPSB0aGlzLmdldCgnc2hvcnQybW9kaWYnKVttb2RpZlNob3JjdHV0XTsKICAgICAgICAgICAgaWYgKCFybSkgewogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignVW5rbm93blNob3J0TW9kaWZOYW1lJywgbW9kaWZTaG9yY3R1dCwgdGhpcy5nZXQoJ3Nob3J0Mm1vZGlmJykpCiAgICAgICAgICAgICAgICB0aHJvdyB7CiAgICAgICAgICAgICAgICAgICAgbmFtZSA6ICdVbmtub3duU2hvcnRNb2RpZk5hbWUnLAogICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UgOiBtb2RpZlNob3JjdHV0CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJtOwogICAgICAgIH0sCiAgICAgICAgLyoqCiAgICAgICAgICogZnJvbSBvbmUgb2RpZiwgcmV0dXJuIHRoZSBzaG9ydCBmb3JtIG9mIGl0LgogICAgICAgICAqIFRoZSBvbmx5IHRyaWNrIGlzIHRoYXQgb25lIG1vZGlmIGNhbiBoYXZlIHNldmVyYWwgc2hvcnQgZm9ybXMgKE1ldGh5bCAtPiBNZSBhbmQgTWUxKQogICAgICAgICAqIGFuZCB3ZSBwaWNrIHRoZSBmaXJzdCBpbiB0aGUgbGlzdAogICAgICAgICAqLwogICAgICAgIG1vZGlmMnNob3J0IDogZnVuY3Rpb24ocmVzbW9kKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIHNob3J0ID0gc2VsZi5nZXQoJ21vZGlmMnNob3J0JylbcmVzbW9kLmdldCgnbmFtZScpXTsKICAgICAgICAgICAgaWYgKCFzaG9ydCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHJlc21vZC5nZXQoJ25hbWUnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gKCBzaG9ydCBpbnN0YW5jZW9mIEFycmF5KSA/IHNob3J0WzBdIDogc2hvcnQ7CiAgICAgICAgfSwKCiAgICAgICAgLyoKICAgICAgICAgKiBjb25zdHJ1Y3QgYSBtYXAgZnJvbSBzaG9ydCBuYW1lIHRvIG1vZGlmIG9iamVjdC4gSW4gY2FzZSAyIHNob3J0Y3V0IHBvaW50CiAgICAgICAgICogdG8gdGhlIHNhbWUgbW9kaWYsIHdlIHRha2UgdGhlIG9uZSB3aXRoIHRoZSBzaG9ydGVzdCBuYW1lCiAgICAgICAgICovCiAgICAgICAgcF9pbml0X3Nob3J0Mm1vZGlmIDogZnVuY3Rpb24obmV3VmFsKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIHRtcF9zaG9ydDJtb2RpZiA9IHt9OwogICAgICAgICAgICB2YXIgdG1wX21vZGlmMnNob3J0ID0gbmV3VmFsIHx8IHNlbGYuZ2V0KCdtb2RpZjJzaG9ydCcpOwogICAgICAgICAgICBmb3IgKG1vZCBpbiB0bXBfbW9kaWYyc2hvcnQpIHsKICAgICAgICAgICAgICAgIHZhciB2YWxzID0gdG1wX21vZGlmMnNob3J0W21vZF0KICAgICAgICAgICAgICAgIHZhciBsc2hvcnRzID0gKCB2YWxzIGluc3RhbmNlb2YgQXJyYXkpID8gdmFscyA6IFt2YWxzXTsKICAgICAgICAgICAgICAgIF8uZWFjaChsc2hvcnRzLCBmdW5jdGlvbihzaG9ydCkgewogICAgICAgICAgICAgICAgICAgIGlmICh0bXBfc2hvcnQybW9kaWZbc2hvcnRdICYmIHRtcF9zaG9ydDJtb2RpZltzaG9ydF0uZ2V0KCduYW1lJykubGVuZ3RoIDwgbW9kLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHRtcF9zaG9ydDJtb2RpZltzaG9ydF0gPSBkaWNvUmVzTW9kLmdldChtb2QpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfQogICAgICAgICAgICBzZWxmLnNldCgnc2hvcnQybW9kaWYnLCB0bXBfc2hvcnQybW9kaWYpOwogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiBleHRyYWN0IGxhYmVsIGF0IHRoZSBlbmQgYmV0ZXd3ZW4gY3VybHkgYnJhY2tldCBpZiBhbnkKICAgICAgICAgKiByZXR1cm4gYW4gYXJyYXkgd2l0aCB0d28gZWxlbWVudAogICAgICAgICAqIFswXTogcGVwdGlkZSBzdHJpbmcgd2l0aG91dCBhbnkgdHJlYXRtZW50CiAgICAgICAgICogWzFdOiBhbiBhcnJheSwgbWF5YmUgZW1wdHkgd2l0aCB0aGUgbGFiZWxzIGluIGFuIGFscGhhbnVtZXJpY2FsIG9yZGVyCiAgICAgICAgICovCiAgICAgICAgc3RyaW5nMnBlcHRpZGVBbmRMYWJlbHMgOiBmdW5jdGlvbihzdHIpIHsKICAgICAgICAgICAgdmFyIHJlID0gLyguKylcWyguKilcXVxzKiQvOwogICAgICAgICAgICB2YXIgbSA9IHJlLmV4ZWMoc3RyKTsKICAgICAgICAgICAgaWYgKCFtKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gW3N0ci50cmltKCksIFtdXQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBbbVsxXS50cmltKCksIG1bMl0udHJpbSgpLnNwbGl0KCcsJykuc29ydCgpXQoKICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiBmcm9tIGEgbWluaWZpZWQgc3RyaW5nLCBidWlsZCBhIGZ1bGwgUmljaFNlcXVlbmNlIHBiamVjdAogICAgICAgICAqLwogICAgICAgIHJpY2hTZXFGcm9tU3RyaW5nIDogZnVuY3Rpb24oc3RyKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgICAgICAgIHZhciB0ID0gc2VsZi5zdHJpbmcycGVwdGlkZUFuZExhYmVscyhzdHIpCiAgICAgICAgICAgIHN0ciA9IHRbMF0KICAgICAgICAgICAgdmFyIG1vZGlmTGFiZWxzID0gdFsxXTsKCiAgICAgICAgICAgIHZhciByczsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHJzID0gbmV3IFJpY2hTZXF1ZW5jZSgpLmZyb21TdHJpbmcoc3RyKQogICAgICAgICAgICB9IGNhdGNoKGUpIHsKICAgICAgICAgICAgICAgIHZhciB0bXBfc2VxID0gW10KICAgICAgICAgICAgICAgIHZhciB0bXBfcmVSZXZTcGxpdE1vZGlmID0gc2VsZi5nZXQoJ3JlUmV2U3BsaXRNb2RpZicpOwogICAgICAgICAgICAgICAgdmFyIG1hdGNoZXMgPSBuZXcgUmVnRXhwRnVsbFNwbGl0ZXIoKS5zcGxpdChzZWxmLmdldCgncmVSZXZlcnNlJyksIHN0ci50cmltKCkpCgogICAgICAgICAgICAgICAgXy5lYWNoKG1hdGNoZXMsIGZ1bmN0aW9uKG0pIHsKICAgICAgICAgICAgICAgICAgICB2YXIgcmFhID0gewogICAgICAgICAgICAgICAgICAgICAgICBhYSA6IGRpY29BQS5nZXQobVsxXSkKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIHZhciBtb2RpZlN0ciA9IG1bMl07CiAgICAgICAgICAgICAgICAgICAgaWYgKG1vZGlmU3RyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJhYS5tb2RpZmljYXRpb25zID0gW107CiAgICAgICAgICAgICAgICAgICAgICAgIF8uZWFjaChtb2RpZlN0ci5tYXRjaCh0bXBfcmVSZXZTcGxpdE1vZGlmKSwgZnVuY3Rpb24obSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmFhLm1vZGlmaWNhdGlvbnMucHVzaChzZWxmLnNob3J0Mm1vZGlmKG0pIHx8IGRpY29SZXNNb2QuZ2V0KG0pKQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdG1wX3NlcS5wdXNoKHJhYSk7CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBycyA9IG5ldyBSaWNoU2VxdWVuY2UoewogICAgICAgICAgICAgICAgICAgIHNlcXVlbmNlIDogdG1wX3NlcQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaW1wbGljaXRNb2RpZmllci5sYWJlbChtb2RpZkxhYmVscywgcnMpCiAgICAgICAgICAgIHJldHVybiByczsKCiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogVGhlIGludmVyc2Ugb2YgcmljaFNlcUZyb21TdHJpbmcKICAgICAgICAgKi8KICAgICAgICByaWNoU2VxVG9TdHJpbmcgOiBmdW5jdGlvbihyaWNoU2VxKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIHMgPSAnJzsKCiAgICAgICAgICAgIHJpY2hTZXEgPSByaWNoU2VxLmNsb25lKCkKICAgICAgICAgICAgdmFyIGxhYmVscyA9IGltcGxpY2l0TW9kaWZpZXIuZ2V0TGFiZWxzQW5kQ2xlYW4ocmljaFNlcSkKCiAgICAgICAgICAgIHZhciB0bXBfc2VxID0gcmljaFNlcS5nZXQoJ3NlcXVlbmNlJyk7CiAgICAgICAgICAgIHZhciB0bXBfbW9kaWYyc2hvcnQgPSBzZWxmLmdldCgnbW9kaWYyc2hvcnQnKTsKCiAgICAgICAgICAgIGZvciAoIGkgPSAwOyBpIDwgdG1wX3NlcS5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgcyArPSB0bXBfc2VxW2ldLmFhLmdldCgnY29kZTEnKTsKICAgICAgICAgICAgICAgIGlmICh0bXBfc2VxW2ldLm1vZGlmaWNhdGlvbnMpIHsKCiAgICAgICAgICAgICAgICAgICAgcyArPSBfLmNvbGxlY3QodG1wX3NlcVtpXS5tb2RpZmljYXRpb25zLCBmdW5jdGlvbihtKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtbmFtZSA9IHNlbGYubW9kaWYyc2hvcnQobSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtbmFtZSA9PSBtLmdldCgnbmFtZScpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKCd7JyArIG1uYW1lICsgJ30nKQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1uYW1lCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgLy9yZXR1cm4gKHRtcF9tb2RpZjJzaG9ydFttLmdldCgnbmFtZScpXSAhPSB1bmRlZmluZWQpID8gdG1wX21vZGlmMnNob3J0W20uZ2V0KCduYW1lJyldIDogKCd7JyArIG0ubmFtZSArICd9JykKICAgICAgICAgICAgICAgICAgICB9KS5qb2luKCcnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAobGFiZWxzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIHMgKz0gJyBbJyArIGxhYmVscy5qb2luKCcsJykgKyAnXSc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHM7CiAgICAgICAgfSwKICAgICAgICAvKioKICAgICAgICAgKiAnSDMuMUs5TWUnLCAnSDNLNCcsICdIMy5DSzlNZUFjJywgJ0gzSzlNZUsxNEFDJywgICdIMy5DSzlNZUFjIFtwcm9wX2QxMF0nLCByZXR1cm4gdGhlIG1vZGlmaWVkIGZ1bGwgUmljaFNlcQogICAgICAgICAqCiAgICAgICAgICovCiAgICAgICAgcmljaFNlcUZyb21TZXF1ZW5jZVB0ciA6IGZ1bmN0aW9uKHB0cikgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICAgICAgICB2YXIgdCA9IHNlbGYuc3RyaW5nMnBlcHRpZGVBbmRMYWJlbHMocHRyKQogICAgICAgICAgICBwdHIgPSB0WzBdCiAgICAgICAgICAgIHZhciBtb2RpZkxhYmVscyA9IHRbMV07CgogICAgICAgICAgICB2YXIgcGVwdCA9IHNlbGYuZ2V0KCdhYVNlcXVlbmNlUGVwdGlkZVB0cicpLnB0cjJwZXB0aWRlKHB0cik7CgogICAgICAgICAgICBpZiAocGVwdCA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgYWEgPSBwZXB0LnNlcXVlbmNlLnNwbGl0KCcnKTsKICAgICAgICAgICAgdmFyIHJlID0gLyhbQS1aXSkoXGQrKSgoPzpbQS1aXVthLXpdW2EtejAtOV0qKSopL2c7CgogICAgICAgICAgICB3aGlsZSAoIG0gPSByZS5leGVjKHB0cikpIHsKICAgICAgICAgICAgICAgIHZhciBpID0gcGFyc2VJbnQobVsyXSkgLSBwZXB0Lm9mZnNldAogICAgICAgICAgICAgICAgYWFbaV0gKz0gbVszXQogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBzZXFwcCA9IGFhLmpvaW4oJycpCgogICAgICAgICAgICB2YXIgcmljaFNlcSA9IHNlbGYucmljaFNlcUZyb21TdHJpbmcoc2VxcHApCiAgICAgICAgICAgIGltcGxpY2l0TW9kaWZpZXIubGFiZWwobW9kaWZMYWJlbHMsIHJpY2hTZXEpCiAgICAgICAgICAgIHJldHVybiByaWNoU2VxOwoKICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiBXZWxsLCB0aGF0J3MgdGhlIHJldmVyc2Ugb2YgcmljaFNlcUZyb21TZXF1ZW5jZVB0ci4KICAgICAgICAgKiBmcm9tIGEgcmljaCBzZXF1ZW5jZSwgd2UgdHJ5IHRvIGZpbmQgdGhlIHNob3J0ZXN0IHBvc3NpYmxlIHB0cgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IHJpY2hTZXEKICAgICAgICAgKi8KICAgICAgICByaWNoU2VxVG9TZXF1ZW5jZVB0ciA6IGZ1bmN0aW9uKHJpY2hTZXFPcmlnKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgICAgICAgIHZhciByaWNoU2VxID0gcmljaFNlcU9yaWcuY2xvbmUoKQogICAgICAgICAgICB2YXIgbGFiZWxzID0gaW1wbGljaXRNb2RpZmllci5nZXRMYWJlbHNBbmRDbGVhbihyaWNoU2VxKQogICAgICAgICAgICBpZiAobGFiZWxzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIGxhYmVscyA9ICcgWycgKyBsYWJlbHMuam9pbignLCcpICsgJ10nOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbGFiZWxzID0gJycKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGFhc2VxID0gXy5jb2xsZWN0KHJpY2hTZXEuZ2V0KCdzZXF1ZW5jZScpLCBmdW5jdGlvbihyYWEpIHsKICAgICAgICAgICAgICAgIHJldHVybiByYWEuYWEuZ2V0KCdjb2RlMScpOwogICAgICAgICAgICB9KS5qb2luKCcnKTsKCiAgICAgICAgICAgIHZhciByZWdTZXFMaXN0ID0gc2VsZi5nZXQoJ2FhU2VxdWVuY2VQZXB0aWRlUHRyJykuZ2V0KCdwZXB0aWRlSW5kZXgnKVthYXNlcV07CgogICAgICAgICAgICBpZiAoIXJlZ1NlcUxpc3QpIHsKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLnJpY2hTZXFUb1N0cmluZyhyaWNoU2VxKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHNlcVB0ciA9IHNlbGYuZ2V0KCdhYVNlcXVlbmNlUGVwdGlkZVB0cicpLmNvbmNhdGVuYXRlTmFtZXMoXy5jb2xsZWN0KHJlZ1NlcUxpc3QsIGZ1bmN0aW9uKHBwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcHAuYWFTZXEuZ2V0KCduYW1lJykKICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgLy9jYXB1dHJlIHRoZSBzdGFydGluZyBwb3NpdGlvbi4gbXVzdCB0aGUgc2FtZSBmb3IgYWxsIHBlcHRpZGVzCiAgICAgICAgICAgIHZhciBvZmZzZXQgPSBfLmNoYWluKHJlZ1NlcUxpc3QpLmNvbGxlY3QoZnVuY3Rpb24ocHApIHsKICAgICAgICAgICAgICAgIHJldHVybiBwcC5vZmZzZXQKICAgICAgICAgICAgfSkudW5pcSgpLnZhbHVlKCk7CiAgICAgICAgICAgIGlmIChvZmZzZXQubGVuZ3RoID4gMSkgewogICAgICAgICAgICAgICAgLy93ZSBoYXZlIGRpZmZlcmVudCBzaXplcwogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYucmljaFNlcVRvU3RyaW5nKHJpY2hTZXEpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG9mZnNldCA9IG9mZnNldFswXQoKICAgICAgICAgICAgdmFyIG1pbmlTdHIgPSAnJzsKICAgICAgICAgICAgXy5lYWNoKHJpY2hTZXEuZ2V0KCdzZXF1ZW5jZScpLCBmdW5jdGlvbihyYWEsIGkpIHsKICAgICAgICAgICAgICAgIHZhciBtb2RzID0gXy5jaGFpbihyYWEubW9kaWZpY2F0aW9ucykuY29sbGVjdChmdW5jdGlvbihtKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYubW9kaWYyc2hvcnQobSk7CiAgICAgICAgICAgICAgICB9KS52YWx1ZSgpLmpvaW4oJycpOwogICAgICAgICAgICAgICAgaWYgKG1vZHMgIT09ICcnKSB7CiAgICAgICAgICAgICAgICAgICAgbWluaVN0ciArPSByYWEuYWEuZ2V0KCdjb2RlMScpICsgKGkgKyBvZmZzZXQpICsgbW9kcwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgaWYgKG1pbmlTdHIgPT09ICcnKSB7CiAgICAgICAgICAgICAgICAvL2ZpbmQgYXQgbGVhc3Qgb25lIGx5c2luZQogICAgICAgICAgICAgICAgdmFyIGlrID0gXy5jb2xsZWN0KHJpY2hTZXEuZ2V0KCdzZXF1ZW5jZScpLCBmdW5jdGlvbihyYWEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmFhLmFhLmdldCgnY29kZTEnKQogICAgICAgICAgICAgICAgfSkuam9pbignJykuaW5kZXhPZignSycpOwogICAgICAgICAgICAgICAgaWYgKGlrID49IDApIHsKICAgICAgICAgICAgICAgICAgICBtaW5pU3RyID0gJ0snICsgKGlrICsgb2Zmc2V0KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChtaW5pU3RyID09PSAnJykgewogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYucmljaFNlcVRvU3RyaW5nKHJpY2hTZXEpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvL2JhY2sgY2hlY2sgdGhhdCB0aGUgcmV2ZXJzZSBpcyBnaXZlIHRoZSBzYW1lCiAgICAgICAgICAgIG1pbmlTdHIgPSBzZXFQdHIgKyBtaW5pU3RyICsgbGFiZWxzOwogICAgICAgICAgICB2YXIgYmFja1BlcHQgPSBzZWxmLnJpY2hTZXFGcm9tU2VxdWVuY2VQdHIobWluaVN0ciwgdHJ1ZSk7CgogICAgICAgICAgICBpZiAoIWJhY2tQZXB0LmVxdWFsc1RvKHJpY2hTZXFPcmlnKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYucmljaFNlcVRvU3RyaW5nKHJpY2hTZXFPcmlnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbWluaVN0cgogICAgICAgIH0sCiAgICAgICAgLyoqCiAgICAgICAgICogV2lsbCB0cnkgdG8gYnVpbGQgdGhlIHNlcXVlbmNlIGZyb20gYSBzZXF1ZW5jZVB0ciBvciBhIGNsYXNzaWMgc2VxdWVuY2UKICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gc3RyCiAgICAgICAgICogQHBhcmFtIHtSaWNoU2VxdWVuY2V9IGlwUmljaFNlcSwgZm9yIGlucGxhY2UgcmVwbGFjZW1lbnQgaW5zdGVhZCBvZiBjcmVhdGluZyBhIG5ldyBvbmUuLi4KICAgICAgICAgKi8KICAgICAgICByaWNoU2VxRnJvbSA6IGZ1bmN0aW9uKHN0ciwgaXBSaWNoU2VxKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT0gMykgewogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignMyBwYXJhbWV0ZXJzLCBubyBnb29kISEnKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHN0ciA9IHN0ci5yZXBsYWNlKC9eXHdcLi8sICcnKTsKICAgICAgICAgICAgc3RyID0gc3RyLnJlcGxhY2UoL1wuXHckLywgJycpOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBSaWNoU2VxdWVuY2UoKS5mcm9tU3RyaW5nKHN0cik7CiAgICAgICAgICAgIH0gY2F0Y2goZXhjKSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLnJpY2hTZXFGcm9tU2VxdWVuY2VQdHIoc3RyKQogICAgICAgICAgICAgICAgfSBjYXRjaChleGMpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgcnMgPSBzZWxmLnJpY2hTZXFGcm9tU3RyaW5nKHN0cikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcnMKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqIFdpbGwgdHJ5IHRvIGJ1aWxkIHRoZSBzZXF1ZW5jZSBmcm9tIGEgc2VxdWVuY2VQdHIgb3IgYSBjbGFzc2ljIHNlcXVlbmNlCiAgICAgICAgICogY29tcGFyZWQgdG8gcmljaFNlcUZyb20sIGlucGxhY2UgcmVwbGFjZW1lbnQgb2YgaXBSaWNoU2VxLCBpbnN0ZWFkIG9mIHJlYXRpbmcgYSBuZXcgb25lLi4uCiAgICAgICAgICogQHBhcmFtIHtSaWNoU2VxdWVuY2V9IGlwUmljaFNlcSwKICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gc3RyCiAgICAgICAgICovCiAgICAgICAgcmljaFNlcVJlYWRGcm9tIDogZnVuY3Rpb24oaXBSaWNoU2VxLCBzdHIpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICB2YXIgcnMgPSBzZWxmLnJpY2hTZXFGcm9tKHN0cik7CgogICAgICAgICAgICAvL29rLCB3ZSBjYW4gZG8gYmV0dGVyLCBidSB0aGF0IHdpbGwgZmx5IGZvciB0aGUgbW9tZW50CiAgICAgICAgICAgIGlwUmljaFNlcS5mcm9tU3RyaW5nKHJzLnRvU3RyaW5nKCkpOwogICAgICAgIH0KICAgIH0pOwoKICAgIHJldHVybiBSaWNoU2VxdWVuY2VTaG9ydGN1dGVyOwp9KTsKCi8qIQogKiBCb290c3RyYXAgdjMuMS4xIChodHRwOi8vZ2V0Ym9vdHN0cmFwLmNvbSkKICogQ29weXJpZ2h0IDIwMTEtMjAxNCBUd2l0dGVyLCBJbmMuCiAqIExpY2Vuc2VkIHVuZGVyIE1JVCAoaHR0cHM6Ly9naXRodWIuY29tL3R3YnMvYm9vdHN0cmFwL2Jsb2IvbWFzdGVyL0xJQ0VOU0UpCiAqLwppZigidW5kZWZpbmVkIj09dHlwZW9mIGpRdWVyeSl0aHJvdyBuZXcgRXJyb3IoIkJvb3RzdHJhcCdzIEphdmFTY3JpcHQgcmVxdWlyZXMgalF1ZXJ5Iik7K2Z1bmN0aW9uKGEpe2Z1bmN0aW9uIGIoKXt2YXIgYT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJib290c3RyYXAiKSxiPXtXZWJraXRUcmFuc2l0aW9uOiJ3ZWJraXRUcmFuc2l0aW9uRW5kIixNb3pUcmFuc2l0aW9uOiJ0cmFuc2l0aW9uZW5kIixPVHJhbnNpdGlvbjoib1RyYW5zaXRpb25FbmQgb3RyYW5zaXRpb25lbmQiLHRyYW5zaXRpb246InRyYW5zaXRpb25lbmQifTtmb3IodmFyIGMgaW4gYilpZih2b2lkIDAhPT1hLnN0eWxlW2NdKXJldHVybntlbmQ6YltjXX07cmV0dXJuITF9YS5mbi5lbXVsYXRlVHJhbnNpdGlvbkVuZD1mdW5jdGlvbihiKXt2YXIgYz0hMSxkPXRoaXM7YSh0aGlzKS5vbmUoYS5zdXBwb3J0LnRyYW5zaXRpb24uZW5kLGZ1bmN0aW9uKCl7Yz0hMH0pO3ZhciBlPWZ1bmN0aW9uKCl7Y3x8YShkKS50cmlnZ2VyKGEuc3VwcG9ydC50cmFuc2l0aW9uLmVuZCl9O3JldHVybiBzZXRUaW1lb3V0KGUsYiksdGhpc30sYShmdW5jdGlvbigpe2Euc3VwcG9ydC50cmFuc2l0aW9uPWIoKX0pfShqUXVlcnkpLCtmdW5jdGlvbihhKXt2YXIgYj0nW2RhdGEtZGlzbWlzcz0iYWxlcnQiXScsYz1mdW5jdGlvbihjKXthKGMpLm9uKCJjbGljayIsYix0aGlzLmNsb3NlKX07Yy5wcm90b3R5cGUuY2xvc2U9ZnVuY3Rpb24oYil7ZnVuY3Rpb24gYygpe2YudHJpZ2dlcigiY2xvc2VkLmJzLmFsZXJ0IikucmVtb3ZlKCl9dmFyIGQ9YSh0aGlzKSxlPWQuYXR0cigiZGF0YS10YXJnZXQiKTtlfHwoZT1kLmF0dHIoImhyZWYiKSxlPWUmJmUucmVwbGFjZSgvLiooPz0jW15cc10qJCkvLCIiKSk7dmFyIGY9YShlKTtiJiZiLnByZXZlbnREZWZhdWx0KCksZi5sZW5ndGh8fChmPWQuaGFzQ2xhc3MoImFsZXJ0Iik/ZDpkLnBhcmVudCgpKSxmLnRyaWdnZXIoYj1hLkV2ZW50KCJjbG9zZS5icy5hbGVydCIpKSxiLmlzRGVmYXVsdFByZXZlbnRlZCgpfHwoZi5yZW1vdmVDbGFzcygiaW4iKSxhLnN1cHBvcnQudHJhbnNpdGlvbiYmZi5oYXNDbGFzcygiZmFkZSIpP2Yub25lKGEuc3VwcG9ydC50cmFuc2l0aW9uLmVuZCxjKS5lbXVsYXRlVHJhbnNpdGlvbkVuZCgxNTApOmMoKSl9O3ZhciBkPWEuZm4uYWxlcnQ7YS5mbi5hbGVydD1mdW5jdGlvbihiKXtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGQ9YSh0aGlzKSxlPWQuZGF0YSgiYnMuYWxlcnQiKTtlfHxkLmRhdGEoImJzLmFsZXJ0IixlPW5ldyBjKHRoaXMpKSwic3RyaW5nIj09dHlwZW9mIGImJmVbYl0uY2FsbChkKX0pfSxhLmZuLmFsZXJ0LkNvbnN0cnVjdG9yPWMsYS5mbi5hbGVydC5ub0NvbmZsaWN0PWZ1bmN0aW9uKCl7cmV0dXJuIGEuZm4uYWxlcnQ9ZCx0aGlzfSxhKGRvY3VtZW50KS5vbigiY2xpY2suYnMuYWxlcnQuZGF0YS1hcGkiLGIsYy5wcm90b3R5cGUuY2xvc2UpfShqUXVlcnkpLCtmdW5jdGlvbihhKXt2YXIgYj1mdW5jdGlvbihjLGQpe3RoaXMuJGVsZW1lbnQ9YShjKSx0aGlzLm9wdGlvbnM9YS5leHRlbmQoe30sYi5ERUZBVUxUUyxkKSx0aGlzLmlzTG9hZGluZz0hMX07Yi5ERUZBVUxUUz17bG9hZGluZ1RleHQ6ImxvYWRpbmcuLi4ifSxiLnByb3RvdHlwZS5zZXRTdGF0ZT1mdW5jdGlvbihiKXt2YXIgYz0iZGlzYWJsZWQiLGQ9dGhpcy4kZWxlbWVudCxlPWQuaXMoImlucHV0Iik/InZhbCI6Imh0bWwiLGY9ZC5kYXRhKCk7Yis9IlRleHQiLGYucmVzZXRUZXh0fHxkLmRhdGEoInJlc2V0VGV4dCIsZFtlXSgpKSxkW2VdKGZbYl18fHRoaXMub3B0aW9uc1tiXSksc2V0VGltZW91dChhLnByb3h5KGZ1bmN0aW9uKCl7ImxvYWRpbmdUZXh0Ij09Yj8odGhpcy5pc0xvYWRpbmc9ITAsZC5hZGRDbGFzcyhjKS5hdHRyKGMsYykpOnRoaXMuaXNMb2FkaW5nJiYodGhpcy5pc0xvYWRpbmc9ITEsZC5yZW1vdmVDbGFzcyhjKS5yZW1vdmVBdHRyKGMpKX0sdGhpcyksMCl9LGIucHJvdG90eXBlLnRvZ2dsZT1mdW5jdGlvbigpe3ZhciBhPSEwLGI9dGhpcy4kZWxlbWVudC5jbG9zZXN0KCdbZGF0YS10b2dnbGU9ImJ1dHRvbnMiXScpO2lmKGIubGVuZ3RoKXt2YXIgYz10aGlzLiRlbGVtZW50LmZpbmQoImlucHV0Iik7InJhZGlvIj09Yy5wcm9wKCJ0eXBlIikmJihjLnByb3AoImNoZWNrZWQiKSYmdGhpcy4kZWxlbWVudC5oYXNDbGFzcygiYWN0aXZlIik/YT0hMTpiLmZpbmQoIi5hY3RpdmUiKS5yZW1vdmVDbGFzcygiYWN0aXZlIikpLGEmJmMucHJvcCgiY2hlY2tlZCIsIXRoaXMuJGVsZW1lbnQuaGFzQ2xhc3MoImFjdGl2ZSIpKS50cmlnZ2VyKCJjaGFuZ2UiKX1hJiZ0aGlzLiRlbGVtZW50LnRvZ2dsZUNsYXNzKCJhY3RpdmUiKX07dmFyIGM9YS5mbi5idXR0b247YS5mbi5idXR0b249ZnVuY3Rpb24oYyl7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBkPWEodGhpcyksZT1kLmRhdGEoImJzLmJ1dHRvbiIpLGY9Im9iamVjdCI9PXR5cGVvZiBjJiZjO2V8fGQuZGF0YSgiYnMuYnV0dG9uIixlPW5ldyBiKHRoaXMsZikpLCJ0b2dnbGUiPT1jP2UudG9nZ2xlKCk6YyYmZS5zZXRTdGF0ZShjKX0pfSxhLmZuLmJ1dHRvbi5Db25zdHJ1Y3Rvcj1iLGEuZm4uYnV0dG9uLm5vQ29uZmxpY3Q9ZnVuY3Rpb24oKXtyZXR1cm4gYS5mbi5idXR0b249Yyx0aGlzfSxhKGRvY3VtZW50KS5vbigiY2xpY2suYnMuYnV0dG9uLmRhdGEtYXBpIiwiW2RhdGEtdG9nZ2xlXj1idXR0b25dIixmdW5jdGlvbihiKXt2YXIgYz1hKGIudGFyZ2V0KTtjLmhhc0NsYXNzKCJidG4iKXx8KGM9Yy5jbG9zZXN0KCIuYnRuIikpLGMuYnV0dG9uKCJ0b2dnbGUiKSxiLnByZXZlbnREZWZhdWx0KCl9KX0oalF1ZXJ5KSwrZnVuY3Rpb24oYSl7dmFyIGI9ZnVuY3Rpb24oYixjKXt0aGlzLiRlbGVtZW50PWEoYiksdGhpcy4kaW5kaWNhdG9ycz10aGlzLiRlbGVtZW50LmZpbmQoIi5jYXJvdXNlbC1pbmRpY2F0b3JzIiksdGhpcy5vcHRpb25zPWMsdGhpcy5wYXVzZWQ9dGhpcy5zbGlkaW5nPXRoaXMuaW50ZXJ2YWw9dGhpcy4kYWN0aXZlPXRoaXMuJGl0ZW1zPW51bGwsImhvdmVyIj09dGhpcy5vcHRpb25zLnBhdXNlJiZ0aGlzLiRlbGVtZW50Lm9uKCJtb3VzZWVudGVyIixhLnByb3h5KHRoaXMucGF1c2UsdGhpcykpLm9uKCJtb3VzZWxlYXZlIixhLnByb3h5KHRoaXMuY3ljbGUsdGhpcykpfTtiLkRFRkFVTFRTPXtpbnRlcnZhbDo1ZTMscGF1c2U6ImhvdmVyIix3cmFwOiEwfSxiLnByb3RvdHlwZS5jeWNsZT1mdW5jdGlvbihiKXtyZXR1cm4gYnx8KHRoaXMucGF1c2VkPSExKSx0aGlzLmludGVydmFsJiZjbGVhckludGVydmFsKHRoaXMuaW50ZXJ2YWwpLHRoaXMub3B0aW9ucy5pbnRlcnZhbCYmIXRoaXMucGF1c2VkJiYodGhpcy5pbnRlcnZhbD1zZXRJbnRlcnZhbChhLnByb3h5KHRoaXMubmV4dCx0aGlzKSx0aGlzLm9wdGlvbnMuaW50ZXJ2YWwpKSx0aGlzfSxiLnByb3RvdHlwZS5nZXRBY3RpdmVJbmRleD1mdW5jdGlvbigpe3JldHVybiB0aGlzLiRhY3RpdmU9dGhpcy4kZWxlbWVudC5maW5kKCIuaXRlbS5hY3RpdmUiKSx0aGlzLiRpdGVtcz10aGlzLiRhY3RpdmUucGFyZW50KCkuY2hpbGRyZW4oKSx0aGlzLiRpdGVtcy5pbmRleCh0aGlzLiRhY3RpdmUpfSxiLnByb3RvdHlwZS50bz1mdW5jdGlvbihiKXt2YXIgYz10aGlzLGQ9dGhpcy5nZXRBY3RpdmVJbmRleCgpO3JldHVybiBiPnRoaXMuJGl0ZW1zLmxlbmd0aC0xfHwwPmI/dm9pZCAwOnRoaXMuc2xpZGluZz90aGlzLiRlbGVtZW50Lm9uZSgic2xpZC5icy5jYXJvdXNlbCIsZnVuY3Rpb24oKXtjLnRvKGIpfSk6ZD09Yj90aGlzLnBhdXNlKCkuY3ljbGUoKTp0aGlzLnNsaWRlKGI+ZD8ibmV4dCI6InByZXYiLGEodGhpcy4kaXRlbXNbYl0pKX0sYi5wcm90b3R5cGUucGF1c2U9ZnVuY3Rpb24oYil7cmV0dXJuIGJ8fCh0aGlzLnBhdXNlZD0hMCksdGhpcy4kZWxlbWVudC5maW5kKCIubmV4dCwgLnByZXYiKS5sZW5ndGgmJmEuc3VwcG9ydC50cmFuc2l0aW9uJiYodGhpcy4kZWxlbWVudC50cmlnZ2VyKGEuc3VwcG9ydC50cmFuc2l0aW9uLmVuZCksdGhpcy5jeWNsZSghMCkpLHRoaXMuaW50ZXJ2YWw9Y2xlYXJJbnRlcnZhbCh0aGlzLmludGVydmFsKSx0aGlzfSxiLnByb3RvdHlwZS5uZXh0PWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuc2xpZGluZz92b2lkIDA6dGhpcy5zbGlkZSgibmV4dCIpfSxiLnByb3RvdHlwZS5wcmV2PWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuc2xpZGluZz92b2lkIDA6dGhpcy5zbGlkZSgicHJldiIpfSxiLnByb3RvdHlwZS5zbGlkZT1mdW5jdGlvbihiLGMpe3ZhciBkPXRoaXMuJGVsZW1lbnQuZmluZCgiLml0ZW0uYWN0aXZlIiksZT1jfHxkW2JdKCksZj10aGlzLmludGVydmFsLGc9Im5leHQiPT1iPyJsZWZ0IjoicmlnaHQiLGg9Im5leHQiPT1iPyJmaXJzdCI6Imxhc3QiLGk9dGhpcztpZighZS5sZW5ndGgpe2lmKCF0aGlzLm9wdGlvbnMud3JhcClyZXR1cm47ZT10aGlzLiRlbGVtZW50LmZpbmQoIi5pdGVtIilbaF0oKX1pZihlLmhhc0NsYXNzKCJhY3RpdmUiKSlyZXR1cm4gdGhpcy5zbGlkaW5nPSExO3ZhciBqPWEuRXZlbnQoInNsaWRlLmJzLmNhcm91c2VsIix7cmVsYXRlZFRhcmdldDplWzBdLGRpcmVjdGlvbjpnfSk7cmV0dXJuIHRoaXMuJGVsZW1lbnQudHJpZ2dlcihqKSxqLmlzRGVmYXVsdFByZXZlbnRlZCgpP3ZvaWQgMDoodGhpcy5zbGlkaW5nPSEwLGYmJnRoaXMucGF1c2UoKSx0aGlzLiRpbmRpY2F0b3JzLmxlbmd0aCYmKHRoaXMuJGluZGljYXRvcnMuZmluZCgiLmFjdGl2ZSIpLnJlbW92ZUNsYXNzKCJhY3RpdmUiKSx0aGlzLiRlbGVtZW50Lm9uZSgic2xpZC5icy5jYXJvdXNlbCIsZnVuY3Rpb24oKXt2YXIgYj1hKGkuJGluZGljYXRvcnMuY2hpbGRyZW4oKVtpLmdldEFjdGl2ZUluZGV4KCldKTtiJiZiLmFkZENsYXNzKCJhY3RpdmUiKX0pKSxhLnN1cHBvcnQudHJhbnNpdGlvbiYmdGhpcy4kZWxlbWVudC5oYXNDbGFzcygic2xpZGUiKT8oZS5hZGRDbGFzcyhiKSxlWzBdLm9mZnNldFdpZHRoLGQuYWRkQ2xhc3MoZyksZS5hZGRDbGFzcyhnKSxkLm9uZShhLnN1cHBvcnQudHJhbnNpdGlvbi5lbmQsZnVuY3Rpb24oKXtlLnJlbW92ZUNsYXNzKFtiLGddLmpvaW4oIiAiKSkuYWRkQ2xhc3MoImFjdGl2ZSIpLGQucmVtb3ZlQ2xhc3MoWyJhY3RpdmUiLGddLmpvaW4oIiAiKSksaS5zbGlkaW5nPSExLHNldFRpbWVvdXQoZnVuY3Rpb24oKXtpLiRlbGVtZW50LnRyaWdnZXIoInNsaWQuYnMuY2Fyb3VzZWwiKX0sMCl9KS5lbXVsYXRlVHJhbnNpdGlvbkVuZCgxZTMqZC5jc3MoInRyYW5zaXRpb24tZHVyYXRpb24iKS5zbGljZSgwLC0xKSkpOihkLnJlbW92ZUNsYXNzKCJhY3RpdmUiKSxlLmFkZENsYXNzKCJhY3RpdmUiKSx0aGlzLnNsaWRpbmc9ITEsdGhpcy4kZWxlbWVudC50cmlnZ2VyKCJzbGlkLmJzLmNhcm91c2VsIikpLGYmJnRoaXMuY3ljbGUoKSx0aGlzKX07dmFyIGM9YS5mbi5jYXJvdXNlbDthLmZuLmNhcm91c2VsPWZ1bmN0aW9uKGMpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgZD1hKHRoaXMpLGU9ZC5kYXRhKCJicy5jYXJvdXNlbCIpLGY9YS5leHRlbmQoe30sYi5ERUZBVUxUUyxkLmRhdGEoKSwib2JqZWN0Ij09dHlwZW9mIGMmJmMpLGc9InN0cmluZyI9PXR5cGVvZiBjP2M6Zi5zbGlkZTtlfHxkLmRhdGEoImJzLmNhcm91c2VsIixlPW5ldyBiKHRoaXMsZikpLCJudW1iZXIiPT10eXBlb2YgYz9lLnRvKGMpOmc/ZVtnXSgpOmYuaW50ZXJ2YWwmJmUucGF1c2UoKS5jeWNsZSgpfSl9LGEuZm4uY2Fyb3VzZWwuQ29uc3RydWN0b3I9YixhLmZuLmNhcm91c2VsLm5vQ29uZmxpY3Q9ZnVuY3Rpb24oKXtyZXR1cm4gYS5mbi5jYXJvdXNlbD1jLHRoaXN9LGEoZG9jdW1lbnQpLm9uKCJjbGljay5icy5jYXJvdXNlbC5kYXRhLWFwaSIsIltkYXRhLXNsaWRlXSwgW2RhdGEtc2xpZGUtdG9dIixmdW5jdGlvbihiKXt2YXIgYyxkPWEodGhpcyksZT1hKGQuYXR0cigiZGF0YS10YXJnZXQiKXx8KGM9ZC5hdHRyKCJocmVmIikpJiZjLnJlcGxhY2UoLy4qKD89I1teXHNdKyQpLywiIikpLGY9YS5leHRlbmQoe30sZS5kYXRhKCksZC5kYXRhKCkpLGc9ZC5hdHRyKCJkYXRhLXNsaWRlLXRvIik7ZyYmKGYuaW50ZXJ2YWw9ITEpLGUuY2Fyb3VzZWwoZiksKGc9ZC5hdHRyKCJkYXRhLXNsaWRlLXRvIikpJiZlLmRhdGEoImJzLmNhcm91c2VsIikudG8oZyksYi5wcmV2ZW50RGVmYXVsdCgpfSksYSh3aW5kb3cpLm9uKCJsb2FkIixmdW5jdGlvbigpe2EoJ1tkYXRhLXJpZGU9ImNhcm91c2VsIl0nKS5lYWNoKGZ1bmN0aW9uKCl7dmFyIGI9YSh0aGlzKTtiLmNhcm91c2VsKGIuZGF0YSgpKX0pfSl9KGpRdWVyeSksK2Z1bmN0aW9uKGEpe3ZhciBiPWZ1bmN0aW9uKGMsZCl7dGhpcy4kZWxlbWVudD1hKGMpLHRoaXMub3B0aW9ucz1hLmV4dGVuZCh7fSxiLkRFRkFVTFRTLGQpLHRoaXMudHJhbnNpdGlvbmluZz1udWxsLHRoaXMub3B0aW9ucy5wYXJlbnQmJih0aGlzLiRwYXJlbnQ9YSh0aGlzLm9wdGlvbnMucGFyZW50KSksdGhpcy5vcHRpb25zLnRvZ2dsZSYmdGhpcy50b2dnbGUoKX07Yi5ERUZBVUxUUz17dG9nZ2xlOiEwfSxiLnByb3RvdHlwZS5kaW1lbnNpb249ZnVuY3Rpb24oKXt2YXIgYT10aGlzLiRlbGVtZW50Lmhhc0NsYXNzKCJ3aWR0aCIpO3JldHVybiBhPyJ3aWR0aCI6ImhlaWdodCJ9LGIucHJvdG90eXBlLnNob3c9ZnVuY3Rpb24oKXtpZighdGhpcy50cmFuc2l0aW9uaW5nJiYhdGhpcy4kZWxlbWVudC5oYXNDbGFzcygiaW4iKSl7dmFyIGI9YS5FdmVudCgic2hvdy5icy5jb2xsYXBzZSIpO2lmKHRoaXMuJGVsZW1lbnQudHJpZ2dlcihiKSwhYi5pc0RlZmF1bHRQcmV2ZW50ZWQoKSl7dmFyIGM9dGhpcy4kcGFyZW50JiZ0aGlzLiRwYXJlbnQuZmluZCgiPiAucGFuZWwgPiAuaW4iKTtpZihjJiZjLmxlbmd0aCl7dmFyIGQ9Yy5kYXRhKCJicy5jb2xsYXBzZSIpO2lmKGQmJmQudHJhbnNpdGlvbmluZylyZXR1cm47Yy5jb2xsYXBzZSgiaGlkZSIpLGR8fGMuZGF0YSgiYnMuY29sbGFwc2UiLG51bGwpfXZhciBlPXRoaXMuZGltZW5zaW9uKCk7dGhpcy4kZWxlbWVudC5yZW1vdmVDbGFzcygiY29sbGFwc2UiKS5hZGRDbGFzcygiY29sbGFwc2luZyIpW2VdKDApLHRoaXMudHJhbnNpdGlvbmluZz0xO3ZhciBmPWZ1bmN0aW9uKCl7dGhpcy4kZWxlbWVudC5yZW1vdmVDbGFzcygiY29sbGFwc2luZyIpLmFkZENsYXNzKCJjb2xsYXBzZSBpbiIpW2VdKCJhdXRvIiksdGhpcy50cmFuc2l0aW9uaW5nPTAsdGhpcy4kZWxlbWVudC50cmlnZ2VyKCJzaG93bi5icy5jb2xsYXBzZSIpfTtpZighYS5zdXBwb3J0LnRyYW5zaXRpb24pcmV0dXJuIGYuY2FsbCh0aGlzKTt2YXIgZz1hLmNhbWVsQ2FzZShbInNjcm9sbCIsZV0uam9pbigiLSIpKTt0aGlzLiRlbGVtZW50Lm9uZShhLnN1cHBvcnQudHJhbnNpdGlvbi5lbmQsYS5wcm94eShmLHRoaXMpKS5lbXVsYXRlVHJhbnNpdGlvbkVuZCgzNTApW2VdKHRoaXMuJGVsZW1lbnRbMF1bZ10pfX19LGIucHJvdG90eXBlLmhpZGU9ZnVuY3Rpb24oKXtpZighdGhpcy50cmFuc2l0aW9uaW5nJiZ0aGlzLiRlbGVtZW50Lmhhc0NsYXNzKCJpbiIpKXt2YXIgYj1hLkV2ZW50KCJoaWRlLmJzLmNvbGxhcHNlIik7aWYodGhpcy4kZWxlbWVudC50cmlnZ2VyKGIpLCFiLmlzRGVmYXVsdFByZXZlbnRlZCgpKXt2YXIgYz10aGlzLmRpbWVuc2lvbigpO3RoaXMuJGVsZW1lbnRbY10odGhpcy4kZWxlbWVudFtjXSgpKVswXS5vZmZzZXRIZWlnaHQsdGhpcy4kZWxlbWVudC5hZGRDbGFzcygiY29sbGFwc2luZyIpLnJlbW92ZUNsYXNzKCJjb2xsYXBzZSIpLnJlbW92ZUNsYXNzKCJpbiIpLHRoaXMudHJhbnNpdGlvbmluZz0xO3ZhciBkPWZ1bmN0aW9uKCl7dGhpcy50cmFuc2l0aW9uaW5nPTAsdGhpcy4kZWxlbWVudC50cmlnZ2VyKCJoaWRkZW4uYnMuY29sbGFwc2UiKS5yZW1vdmVDbGFzcygiY29sbGFwc2luZyIpLmFkZENsYXNzKCJjb2xsYXBzZSIpfTtyZXR1cm4gYS5zdXBwb3J0LnRyYW5zaXRpb24/dm9pZCB0aGlzLiRlbGVtZW50W2NdKDApLm9uZShhLnN1cHBvcnQudHJhbnNpdGlvbi5lbmQsYS5wcm94eShkLHRoaXMpKS5lbXVsYXRlVHJhbnNpdGlvbkVuZCgzNTApOmQuY2FsbCh0aGlzKX19fSxiLnByb3RvdHlwZS50b2dnbGU9ZnVuY3Rpb24oKXt0aGlzW3RoaXMuJGVsZW1lbnQuaGFzQ2xhc3MoImluIik/ImhpZGUiOiJzaG93Il0oKX07dmFyIGM9YS5mbi5jb2xsYXBzZTthLmZuLmNvbGxhcHNlPWZ1bmN0aW9uKGMpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgZD1hKHRoaXMpLGU9ZC5kYXRhKCJicy5jb2xsYXBzZSIpLGY9YS5leHRlbmQoe30sYi5ERUZBVUxUUyxkLmRhdGEoKSwib2JqZWN0Ij09dHlwZW9mIGMmJmMpOyFlJiZmLnRvZ2dsZSYmInNob3ciPT1jJiYoYz0hYyksZXx8ZC5kYXRhKCJicy5jb2xsYXBzZSIsZT1uZXcgYih0aGlzLGYpKSwic3RyaW5nIj09dHlwZW9mIGMmJmVbY10oKX0pfSxhLmZuLmNvbGxhcHNlLkNvbnN0cnVjdG9yPWIsYS5mbi5jb2xsYXBzZS5ub0NvbmZsaWN0PWZ1bmN0aW9uKCl7cmV0dXJuIGEuZm4uY29sbGFwc2U9Yyx0aGlzfSxhKGRvY3VtZW50KS5vbigiY2xpY2suYnMuY29sbGFwc2UuZGF0YS1hcGkiLCJbZGF0YS10b2dnbGU9Y29sbGFwc2VdIixmdW5jdGlvbihiKXt2YXIgYyxkPWEodGhpcyksZT1kLmF0dHIoImRhdGEtdGFyZ2V0Iil8fGIucHJldmVudERlZmF1bHQoKXx8KGM9ZC5hdHRyKCJocmVmIikpJiZjLnJlcGxhY2UoLy4qKD89I1teXHNdKyQpLywiIiksZj1hKGUpLGc9Zi5kYXRhKCJicy5jb2xsYXBzZSIpLGg9Zz8idG9nZ2xlIjpkLmRhdGEoKSxpPWQuYXR0cigiZGF0YS1wYXJlbnQiKSxqPWkmJmEoaSk7ZyYmZy50cmFuc2l0aW9uaW5nfHwoaiYmai5maW5kKCdbZGF0YS10b2dnbGU9Y29sbGFwc2VdW2RhdGEtcGFyZW50PSInK2krJyJdJykubm90KGQpLmFkZENsYXNzKCJjb2xsYXBzZWQiKSxkW2YuaGFzQ2xhc3MoImluIik/ImFkZENsYXNzIjoicmVtb3ZlQ2xhc3MiXSgiY29sbGFwc2VkIikpLGYuY29sbGFwc2UoaCl9KX0oalF1ZXJ5KSwrZnVuY3Rpb24oYSl7ZnVuY3Rpb24gYihiKXthKGQpLnJlbW92ZSgpLGEoZSkuZWFjaChmdW5jdGlvbigpe3ZhciBkPWMoYSh0aGlzKSksZT17cmVsYXRlZFRhcmdldDp0aGlzfTtkLmhhc0NsYXNzKCJvcGVuIikmJihkLnRyaWdnZXIoYj1hLkV2ZW50KCJoaWRlLmJzLmRyb3Bkb3duIixlKSksYi5pc0RlZmF1bHRQcmV2ZW50ZWQoKXx8ZC5yZW1vdmVDbGFzcygib3BlbiIpLnRyaWdnZXIoImhpZGRlbi5icy5kcm9wZG93biIsZSkpfSl9ZnVuY3Rpb24gYyhiKXt2YXIgYz1iLmF0dHIoImRhdGEtdGFyZ2V0Iik7Y3x8KGM9Yi5hdHRyKCJocmVmIiksYz1jJiYvI1tBLVphLXpdLy50ZXN0KGMpJiZjLnJlcGxhY2UoLy4qKD89I1teXHNdKiQpLywiIikpO3ZhciBkPWMmJmEoYyk7cmV0dXJuIGQmJmQubGVuZ3RoP2Q6Yi5wYXJlbnQoKX12YXIgZD0iLmRyb3Bkb3duLWJhY2tkcm9wIixlPSJbZGF0YS10b2dnbGU9ZHJvcGRvd25dIixmPWZ1bmN0aW9uKGIpe2EoYikub24oImNsaWNrLmJzLmRyb3Bkb3duIix0aGlzLnRvZ2dsZSl9O2YucHJvdG90eXBlLnRvZ2dsZT1mdW5jdGlvbihkKXt2YXIgZT1hKHRoaXMpO2lmKCFlLmlzKCIuZGlzYWJsZWQsIDpkaXNhYmxlZCIpKXt2YXIgZj1jKGUpLGc9Zi5oYXNDbGFzcygib3BlbiIpO2lmKGIoKSwhZyl7Im9udG91Y2hzdGFydCJpbiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQmJiFmLmNsb3Nlc3QoIi5uYXZiYXItbmF2IikubGVuZ3RoJiZhKCc8ZGl2IGNsYXNzPSJkcm9wZG93bi1iYWNrZHJvcCIvPicpLmluc2VydEFmdGVyKGEodGhpcykpLm9uKCJjbGljayIsYik7dmFyIGg9e3JlbGF0ZWRUYXJnZXQ6dGhpc307aWYoZi50cmlnZ2VyKGQ9YS5FdmVudCgic2hvdy5icy5kcm9wZG93biIsaCkpLGQuaXNEZWZhdWx0UHJldmVudGVkKCkpcmV0dXJuO2YudG9nZ2xlQ2xhc3MoIm9wZW4iKS50cmlnZ2VyKCJzaG93bi5icy5kcm9wZG93biIsaCksZS5mb2N1cygpfXJldHVybiExfX0sZi5wcm90b3R5cGUua2V5ZG93bj1mdW5jdGlvbihiKXtpZigvKDM4fDQwfDI3KS8udGVzdChiLmtleUNvZGUpKXt2YXIgZD1hKHRoaXMpO2lmKGIucHJldmVudERlZmF1bHQoKSxiLnN0b3BQcm9wYWdhdGlvbigpLCFkLmlzKCIuZGlzYWJsZWQsIDpkaXNhYmxlZCIpKXt2YXIgZj1jKGQpLGc9Zi5oYXNDbGFzcygib3BlbiIpO2lmKCFnfHxnJiYyNz09Yi5rZXlDb2RlKXJldHVybiAyNz09Yi53aGljaCYmZi5maW5kKGUpLmZvY3VzKCksZC5jbGljaygpO3ZhciBoPSIgbGk6bm90KC5kaXZpZGVyKTp2aXNpYmxlIGEiLGk9Zi5maW5kKCJbcm9sZT1tZW51XSIraCsiLCBbcm9sZT1saXN0Ym94XSIraCk7aWYoaS5sZW5ndGgpe3ZhciBqPWkuaW5kZXgoaS5maWx0ZXIoIjpmb2N1cyIpKTszOD09Yi5rZXlDb2RlJiZqPjAmJmotLSw0MD09Yi5rZXlDb2RlJiZqPGkubGVuZ3RoLTEmJmorKyx+anx8KGo9MCksaS5lcShqKS5mb2N1cygpfX19fTt2YXIgZz1hLmZuLmRyb3Bkb3duO2EuZm4uZHJvcGRvd249ZnVuY3Rpb24oYil7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBjPWEodGhpcyksZD1jLmRhdGEoImJzLmRyb3Bkb3duIik7ZHx8Yy5kYXRhKCJicy5kcm9wZG93biIsZD1uZXcgZih0aGlzKSksInN0cmluZyI9PXR5cGVvZiBiJiZkW2JdLmNhbGwoYyl9KX0sYS5mbi5kcm9wZG93bi5Db25zdHJ1Y3Rvcj1mLGEuZm4uZHJvcGRvd24ubm9Db25mbGljdD1mdW5jdGlvbigpe3JldHVybiBhLmZuLmRyb3Bkb3duPWcsdGhpc30sYShkb2N1bWVudCkub24oImNsaWNrLmJzLmRyb3Bkb3duLmRhdGEtYXBpIixiKS5vbigiY2xpY2suYnMuZHJvcGRvd24uZGF0YS1hcGkiLCIuZHJvcGRvd24gZm9ybSIsZnVuY3Rpb24oYSl7YS5zdG9wUHJvcGFnYXRpb24oKX0pLm9uKCJjbGljay5icy5kcm9wZG93bi5kYXRhLWFwaSIsZSxmLnByb3RvdHlwZS50b2dnbGUpLm9uKCJrZXlkb3duLmJzLmRyb3Bkb3duLmRhdGEtYXBpIixlKyIsIFtyb2xlPW1lbnVdLCBbcm9sZT1saXN0Ym94XSIsZi5wcm90b3R5cGUua2V5ZG93bil9KGpRdWVyeSksK2Z1bmN0aW9uKGEpe3ZhciBiPWZ1bmN0aW9uKGIsYyl7dGhpcy5vcHRpb25zPWMsdGhpcy4kZWxlbWVudD1hKGIpLHRoaXMuJGJhY2tkcm9wPXRoaXMuaXNTaG93bj1udWxsLHRoaXMub3B0aW9ucy5yZW1vdGUmJnRoaXMuJGVsZW1lbnQuZmluZCgiLm1vZGFsLWNvbnRlbnQiKS5sb2FkKHRoaXMub3B0aW9ucy5yZW1vdGUsYS5wcm94eShmdW5jdGlvbigpe3RoaXMuJGVsZW1lbnQudHJpZ2dlcigibG9hZGVkLmJzLm1vZGFsIil9LHRoaXMpKX07Yi5ERUZBVUxUUz17YmFja2Ryb3A6ITAsa2V5Ym9hcmQ6ITAsc2hvdzohMH0sYi5wcm90b3R5cGUudG9nZ2xlPWZ1bmN0aW9uKGEpe3JldHVybiB0aGlzW3RoaXMuaXNTaG93bj8iaGlkZSI6InNob3ciXShhKX0sYi5wcm90b3R5cGUuc2hvdz1mdW5jdGlvbihiKXt2YXIgYz10aGlzLGQ9YS5FdmVudCgic2hvdy5icy5tb2RhbCIse3JlbGF0ZWRUYXJnZXQ6Yn0pO3RoaXMuJGVsZW1lbnQudHJpZ2dlcihkKSx0aGlzLmlzU2hvd258fGQuaXNEZWZhdWx0UHJldmVudGVkKCl8fCh0aGlzLmlzU2hvd249ITAsdGhpcy5lc2NhcGUoKSx0aGlzLiRlbGVtZW50Lm9uKCJjbGljay5kaXNtaXNzLmJzLm1vZGFsIiwnW2RhdGEtZGlzbWlzcz0ibW9kYWwiXScsYS5wcm94eSh0aGlzLmhpZGUsdGhpcykpLHRoaXMuYmFja2Ryb3AoZnVuY3Rpb24oKXt2YXIgZD1hLnN1cHBvcnQudHJhbnNpdGlvbiYmYy4kZWxlbWVudC5oYXNDbGFzcygiZmFkZSIpO2MuJGVsZW1lbnQucGFyZW50KCkubGVuZ3RofHxjLiRlbGVtZW50LmFwcGVuZFRvKGRvY3VtZW50LmJvZHkpLGMuJGVsZW1lbnQuc2hvdygpLnNjcm9sbFRvcCgwKSxkJiZjLiRlbGVtZW50WzBdLm9mZnNldFdpZHRoLGMuJGVsZW1lbnQuYWRkQ2xhc3MoImluIikuYXR0cigiYXJpYS1oaWRkZW4iLCExKSxjLmVuZm9yY2VGb2N1cygpO3ZhciBlPWEuRXZlbnQoInNob3duLmJzLm1vZGFsIix7cmVsYXRlZFRhcmdldDpifSk7ZD9jLiRlbGVtZW50LmZpbmQoIi5tb2RhbC1kaWFsb2ciKS5vbmUoYS5zdXBwb3J0LnRyYW5zaXRpb24uZW5kLGZ1bmN0aW9uKCl7Yy4kZWxlbWVudC5mb2N1cygpLnRyaWdnZXIoZSl9KS5lbXVsYXRlVHJhbnNpdGlvbkVuZCgzMDApOmMuJGVsZW1lbnQuZm9jdXMoKS50cmlnZ2VyKGUpfSkpfSxiLnByb3RvdHlwZS5oaWRlPWZ1bmN0aW9uKGIpe2ImJmIucHJldmVudERlZmF1bHQoKSxiPWEuRXZlbnQoImhpZGUuYnMubW9kYWwiKSx0aGlzLiRlbGVtZW50LnRyaWdnZXIoYiksdGhpcy5pc1Nob3duJiYhYi5pc0RlZmF1bHRQcmV2ZW50ZWQoKSYmKHRoaXMuaXNTaG93bj0hMSx0aGlzLmVzY2FwZSgpLGEoZG9jdW1lbnQpLm9mZigiZm9jdXNpbi5icy5tb2RhbCIpLHRoaXMuJGVsZW1lbnQucmVtb3ZlQ2xhc3MoImluIikuYXR0cigiYXJpYS1oaWRkZW4iLCEwKS5vZmYoImNsaWNrLmRpc21pc3MuYnMubW9kYWwiKSxhLnN1cHBvcnQudHJhbnNpdGlvbiYmdGhpcy4kZWxlbWVudC5oYXNDbGFzcygiZmFkZSIpP3RoaXMuJGVsZW1lbnQub25lKGEuc3VwcG9ydC50cmFuc2l0aW9uLmVuZCxhLnByb3h5KHRoaXMuaGlkZU1vZGFsLHRoaXMpKS5lbXVsYXRlVHJhbnNpdGlvbkVuZCgzMDApOnRoaXMuaGlkZU1vZGFsKCkpfSxiLnByb3RvdHlwZS5lbmZvcmNlRm9jdXM9ZnVuY3Rpb24oKXthKGRvY3VtZW50KS5vZmYoImZvY3VzaW4uYnMubW9kYWwiKS5vbigiZm9jdXNpbi5icy5tb2RhbCIsYS5wcm94eShmdW5jdGlvbihhKXt0aGlzLiRlbGVtZW50WzBdPT09YS50YXJnZXR8fHRoaXMuJGVsZW1lbnQuaGFzKGEudGFyZ2V0KS5sZW5ndGh8fHRoaXMuJGVsZW1lbnQuZm9jdXMoKX0sdGhpcykpfSxiLnByb3RvdHlwZS5lc2NhcGU9ZnVuY3Rpb24oKXt0aGlzLmlzU2hvd24mJnRoaXMub3B0aW9ucy5rZXlib2FyZD90aGlzLiRlbGVtZW50Lm9uKCJrZXl1cC5kaXNtaXNzLmJzLm1vZGFsIixhLnByb3h5KGZ1bmN0aW9uKGEpezI3PT1hLndoaWNoJiZ0aGlzLmhpZGUoKX0sdGhpcykpOnRoaXMuaXNTaG93bnx8dGhpcy4kZWxlbWVudC5vZmYoImtleXVwLmRpc21pc3MuYnMubW9kYWwiKX0sYi5wcm90b3R5cGUuaGlkZU1vZGFsPWZ1bmN0aW9uKCl7dmFyIGE9dGhpczt0aGlzLiRlbGVtZW50LmhpZGUoKSx0aGlzLmJhY2tkcm9wKGZ1bmN0aW9uKCl7YS5yZW1vdmVCYWNrZHJvcCgpLGEuJGVsZW1lbnQudHJpZ2dlcigiaGlkZGVuLmJzLm1vZGFsIil9KX0sYi5wcm90b3R5cGUucmVtb3ZlQmFja2Ryb3A9ZnVuY3Rpb24oKXt0aGlzLiRiYWNrZHJvcCYmdGhpcy4kYmFja2Ryb3AucmVtb3ZlKCksdGhpcy4kYmFja2Ryb3A9bnVsbH0sYi5wcm90b3R5cGUuYmFja2Ryb3A9ZnVuY3Rpb24oYil7dmFyIGM9dGhpcy4kZWxlbWVudC5oYXNDbGFzcygiZmFkZSIpPyJmYWRlIjoiIjtpZih0aGlzLmlzU2hvd24mJnRoaXMub3B0aW9ucy5iYWNrZHJvcCl7dmFyIGQ9YS5zdXBwb3J0LnRyYW5zaXRpb24mJmM7aWYodGhpcy4kYmFja2Ryb3A9YSgnPGRpdiBjbGFzcz0ibW9kYWwtYmFja2Ryb3AgJytjKyciIC8+JykuYXBwZW5kVG8oZG9jdW1lbnQuYm9keSksdGhpcy4kZWxlbWVudC5vbigiY2xpY2suZGlzbWlzcy5icy5tb2RhbCIsYS5wcm94eShmdW5jdGlvbihhKXthLnRhcmdldD09PWEuY3VycmVudFRhcmdldCYmKCJzdGF0aWMiPT10aGlzLm9wdGlvbnMuYmFja2Ryb3A/dGhpcy4kZWxlbWVudFswXS5mb2N1cy5jYWxsKHRoaXMuJGVsZW1lbnRbMF0pOnRoaXMuaGlkZS5jYWxsKHRoaXMpKX0sdGhpcykpLGQmJnRoaXMuJGJhY2tkcm9wWzBdLm9mZnNldFdpZHRoLHRoaXMuJGJhY2tkcm9wLmFkZENsYXNzKCJpbiIpLCFiKXJldHVybjtkP3RoaXMuJGJhY2tkcm9wLm9uZShhLnN1cHBvcnQudHJhbnNpdGlvbi5lbmQsYikuZW11bGF0ZVRyYW5zaXRpb25FbmQoMTUwKTpiKCl9ZWxzZSF0aGlzLmlzU2hvd24mJnRoaXMuJGJhY2tkcm9wPyh0aGlzLiRiYWNrZHJvcC5yZW1vdmVDbGFzcygiaW4iKSxhLnN1cHBvcnQudHJhbnNpdGlvbiYmdGhpcy4kZWxlbWVudC5oYXNDbGFzcygiZmFkZSIpP3RoaXMuJGJhY2tkcm9wLm9uZShhLnN1cHBvcnQudHJhbnNpdGlvbi5lbmQsYikuZW11bGF0ZVRyYW5zaXRpb25FbmQoMTUwKTpiKCkpOmImJmIoKX07dmFyIGM9YS5mbi5tb2RhbDthLmZuLm1vZGFsPWZ1bmN0aW9uKGMsZCl7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBlPWEodGhpcyksZj1lLmRhdGEoImJzLm1vZGFsIiksZz1hLmV4dGVuZCh7fSxiLkRFRkFVTFRTLGUuZGF0YSgpLCJvYmplY3QiPT10eXBlb2YgYyYmYyk7Znx8ZS5kYXRhKCJicy5tb2RhbCIsZj1uZXcgYih0aGlzLGcpKSwic3RyaW5nIj09dHlwZW9mIGM/ZltjXShkKTpnLnNob3cmJmYuc2hvdyhkKX0pfSxhLmZuLm1vZGFsLkNvbnN0cnVjdG9yPWIsYS5mbi5tb2RhbC5ub0NvbmZsaWN0PWZ1bmN0aW9uKCl7cmV0dXJuIGEuZm4ubW9kYWw9Yyx0aGlzfSxhKGRvY3VtZW50KS5vbigiY2xpY2suYnMubW9kYWwuZGF0YS1hcGkiLCdbZGF0YS10b2dnbGU9Im1vZGFsIl0nLGZ1bmN0aW9uKGIpe3ZhciBjPWEodGhpcyksZD1jLmF0dHIoImhyZWYiKSxlPWEoYy5hdHRyKCJkYXRhLXRhcmdldCIpfHxkJiZkLnJlcGxhY2UoLy4qKD89I1teXHNdKyQpLywiIikpLGY9ZS5kYXRhKCJicy5tb2RhbCIpPyJ0b2dnbGUiOmEuZXh0ZW5kKHtyZW1vdGU6IS8jLy50ZXN0KGQpJiZkfSxlLmRhdGEoKSxjLmRhdGEoKSk7Yy5pcygiYSIpJiZiLnByZXZlbnREZWZhdWx0KCksZS5tb2RhbChmLHRoaXMpLm9uZSgiaGlkZSIsZnVuY3Rpb24oKXtjLmlzKCI6dmlzaWJsZSIpJiZjLmZvY3VzKCl9KX0pLGEoZG9jdW1lbnQpLm9uKCJzaG93LmJzLm1vZGFsIiwiLm1vZGFsIixmdW5jdGlvbigpe2EoZG9jdW1lbnQuYm9keSkuYWRkQ2xhc3MoIm1vZGFsLW9wZW4iKX0pLm9uKCJoaWRkZW4uYnMubW9kYWwiLCIubW9kYWwiLGZ1bmN0aW9uKCl7YShkb2N1bWVudC5ib2R5KS5yZW1vdmVDbGFzcygibW9kYWwtb3BlbiIpfSl9KGpRdWVyeSksK2Z1bmN0aW9uKGEpe3ZhciBiPWZ1bmN0aW9uKGEsYil7dGhpcy50eXBlPXRoaXMub3B0aW9ucz10aGlzLmVuYWJsZWQ9dGhpcy50aW1lb3V0PXRoaXMuaG92ZXJTdGF0ZT10aGlzLiRlbGVtZW50PW51bGwsdGhpcy5pbml0KCJ0b29sdGlwIixhLGIpfTtiLkRFRkFVTFRTPXthbmltYXRpb246ITAscGxhY2VtZW50OiJ0b3AiLHNlbGVjdG9yOiExLHRlbXBsYXRlOic8ZGl2IGNsYXNzPSJ0b29sdGlwIj48ZGl2IGNsYXNzPSJ0b29sdGlwLWFycm93Ij48L2Rpdj48ZGl2IGNsYXNzPSJ0b29sdGlwLWlubmVyIj48L2Rpdj48L2Rpdj4nLHRyaWdnZXI6ImhvdmVyIGZvY3VzIix0aXRsZToiIixkZWxheTowLGh0bWw6ITEsY29udGFpbmVyOiExfSxiLnByb3RvdHlwZS5pbml0PWZ1bmN0aW9uKGIsYyxkKXt0aGlzLmVuYWJsZWQ9ITAsdGhpcy50eXBlPWIsdGhpcy4kZWxlbWVudD1hKGMpLHRoaXMub3B0aW9ucz10aGlzLmdldE9wdGlvbnMoZCk7Zm9yKHZhciBlPXRoaXMub3B0aW9ucy50cmlnZ2VyLnNwbGl0KCIgIiksZj1lLmxlbmd0aDtmLS07KXt2YXIgZz1lW2ZdO2lmKCJjbGljayI9PWcpdGhpcy4kZWxlbWVudC5vbigiY2xpY2suIit0aGlzLnR5cGUsdGhpcy5vcHRpb25zLnNlbGVjdG9yLGEucHJveHkodGhpcy50b2dnbGUsdGhpcykpO2Vsc2UgaWYoIm1hbnVhbCIhPWcpe3ZhciBoPSJob3ZlciI9PWc/Im1vdXNlZW50ZXIiOiJmb2N1c2luIixpPSJob3ZlciI9PWc/Im1vdXNlbGVhdmUiOiJmb2N1c291dCI7dGhpcy4kZWxlbWVudC5vbihoKyIuIit0aGlzLnR5cGUsdGhpcy5vcHRpb25zLnNlbGVjdG9yLGEucHJveHkodGhpcy5lbnRlcix0aGlzKSksdGhpcy4kZWxlbWVudC5vbihpKyIuIit0aGlzLnR5cGUsdGhpcy5vcHRpb25zLnNlbGVjdG9yLGEucHJveHkodGhpcy5sZWF2ZSx0aGlzKSl9fXRoaXMub3B0aW9ucy5zZWxlY3Rvcj90aGlzLl9vcHRpb25zPWEuZXh0ZW5kKHt9LHRoaXMub3B0aW9ucyx7dHJpZ2dlcjoibWFudWFsIixzZWxlY3RvcjoiIn0pOnRoaXMuZml4VGl0bGUoKX0sYi5wcm90b3R5cGUuZ2V0RGVmYXVsdHM9ZnVuY3Rpb24oKXtyZXR1cm4gYi5ERUZBVUxUU30sYi5wcm90b3R5cGUuZ2V0T3B0aW9ucz1mdW5jdGlvbihiKXtyZXR1cm4gYj1hLmV4dGVuZCh7fSx0aGlzLmdldERlZmF1bHRzKCksdGhpcy4kZWxlbWVudC5kYXRhKCksYiksYi5kZWxheSYmIm51bWJlciI9PXR5cGVvZiBiLmRlbGF5JiYoYi5kZWxheT17c2hvdzpiLmRlbGF5LGhpZGU6Yi5kZWxheX0pLGJ9LGIucHJvdG90eXBlLmdldERlbGVnYXRlT3B0aW9ucz1mdW5jdGlvbigpe3ZhciBiPXt9LGM9dGhpcy5nZXREZWZhdWx0cygpO3JldHVybiB0aGlzLl9vcHRpb25zJiZhLmVhY2godGhpcy5fb3B0aW9ucyxmdW5jdGlvbihhLGQpe2NbYV0hPWQmJihiW2FdPWQpfSksYn0sYi5wcm90b3R5cGUuZW50ZXI9ZnVuY3Rpb24oYil7dmFyIGM9YiBpbnN0YW5jZW9mIHRoaXMuY29uc3RydWN0b3I/YjphKGIuY3VycmVudFRhcmdldClbdGhpcy50eXBlXSh0aGlzLmdldERlbGVnYXRlT3B0aW9ucygpKS5kYXRhKCJicy4iK3RoaXMudHlwZSk7cmV0dXJuIGNsZWFyVGltZW91dChjLnRpbWVvdXQpLGMuaG92ZXJTdGF0ZT0iaW4iLGMub3B0aW9ucy5kZWxheSYmYy5vcHRpb25zLmRlbGF5LnNob3c/dm9pZChjLnRpbWVvdXQ9c2V0VGltZW91dChmdW5jdGlvbigpeyJpbiI9PWMuaG92ZXJTdGF0ZSYmYy5zaG93KCl9LGMub3B0aW9ucy5kZWxheS5zaG93KSk6Yy5zaG93KCl9LGIucHJvdG90eXBlLmxlYXZlPWZ1bmN0aW9uKGIpe3ZhciBjPWIgaW5zdGFuY2VvZiB0aGlzLmNvbnN0cnVjdG9yP2I6YShiLmN1cnJlbnRUYXJnZXQpW3RoaXMudHlwZV0odGhpcy5nZXREZWxlZ2F0ZU9wdGlvbnMoKSkuZGF0YSgiYnMuIit0aGlzLnR5cGUpO3JldHVybiBjbGVhclRpbWVvdXQoYy50aW1lb3V0KSxjLmhvdmVyU3RhdGU9Im91dCIsYy5vcHRpb25zLmRlbGF5JiZjLm9wdGlvbnMuZGVsYXkuaGlkZT92b2lkKGMudGltZW91dD1zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7Im91dCI9PWMuaG92ZXJTdGF0ZSYmYy5oaWRlKCl9LGMub3B0aW9ucy5kZWxheS5oaWRlKSk6Yy5oaWRlKCl9LGIucHJvdG90eXBlLnNob3c9ZnVuY3Rpb24oKXt2YXIgYj1hLkV2ZW50KCJzaG93LmJzLiIrdGhpcy50eXBlKTtpZih0aGlzLmhhc0NvbnRlbnQoKSYmdGhpcy5lbmFibGVkKXtpZih0aGlzLiRlbGVtZW50LnRyaWdnZXIoYiksYi5pc0RlZmF1bHRQcmV2ZW50ZWQoKSlyZXR1cm47dmFyIGM9dGhpcyxkPXRoaXMudGlwKCk7dGhpcy5zZXRDb250ZW50KCksdGhpcy5vcHRpb25zLmFuaW1hdGlvbiYmZC5hZGRDbGFzcygiZmFkZSIpO3ZhciBlPSJmdW5jdGlvbiI9PXR5cGVvZiB0aGlzLm9wdGlvbnMucGxhY2VtZW50P3RoaXMub3B0aW9ucy5wbGFjZW1lbnQuY2FsbCh0aGlzLGRbMF0sdGhpcy4kZWxlbWVudFswXSk6dGhpcy5vcHRpb25zLnBsYWNlbWVudCxmPS9ccz9hdXRvP1xzPy9pLGc9Zi50ZXN0KGUpO2cmJihlPWUucmVwbGFjZShmLCIiKXx8InRvcCIpLGQuZGV0YWNoKCkuY3NzKHt0b3A6MCxsZWZ0OjAsZGlzcGxheToiYmxvY2sifSkuYWRkQ2xhc3MoZSksdGhpcy5vcHRpb25zLmNvbnRhaW5lcj9kLmFwcGVuZFRvKHRoaXMub3B0aW9ucy5jb250YWluZXIpOmQuaW5zZXJ0QWZ0ZXIodGhpcy4kZWxlbWVudCk7dmFyIGg9dGhpcy5nZXRQb3NpdGlvbigpLGk9ZFswXS5vZmZzZXRXaWR0aCxqPWRbMF0ub2Zmc2V0SGVpZ2h0O2lmKGcpe3ZhciBrPXRoaXMuJGVsZW1lbnQucGFyZW50KCksbD1lLG09ZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcHx8ZG9jdW1lbnQuYm9keS5zY3JvbGxUb3Asbj0iYm9keSI9PXRoaXMub3B0aW9ucy5jb250YWluZXI/d2luZG93LmlubmVyV2lkdGg6ay5vdXRlcldpZHRoKCksbz0iYm9keSI9PXRoaXMub3B0aW9ucy5jb250YWluZXI/d2luZG93LmlubmVySGVpZ2h0Omsub3V0ZXJIZWlnaHQoKSxwPSJib2R5Ij09dGhpcy5vcHRpb25zLmNvbnRhaW5lcj8wOmsub2Zmc2V0KCkubGVmdDtlPSJib3R0b20iPT1lJiZoLnRvcCtoLmhlaWdodCtqLW0+bz8idG9wIjoidG9wIj09ZSYmaC50b3AtbS1qPDA/ImJvdHRvbSI6InJpZ2h0Ij09ZSYmaC5yaWdodCtpPm4/ImxlZnQiOiJsZWZ0Ij09ZSYmaC5sZWZ0LWk8cD8icmlnaHQiOmUsZC5yZW1vdmVDbGFzcyhsKS5hZGRDbGFzcyhlKX12YXIgcT10aGlzLmdldENhbGN1bGF0ZWRPZmZzZXQoZSxoLGksaik7dGhpcy5hcHBseVBsYWNlbWVudChxLGUpLHRoaXMuaG92ZXJTdGF0ZT1udWxsO3ZhciByPWZ1bmN0aW9uKCl7Yy4kZWxlbWVudC50cmlnZ2VyKCJzaG93bi5icy4iK2MudHlwZSl9O2Euc3VwcG9ydC50cmFuc2l0aW9uJiZ0aGlzLiR0aXAuaGFzQ2xhc3MoImZhZGUiKT9kLm9uZShhLnN1cHBvcnQudHJhbnNpdGlvbi5lbmQscikuZW11bGF0ZVRyYW5zaXRpb25FbmQoMTUwKTpyKCl9fSxiLnByb3RvdHlwZS5hcHBseVBsYWNlbWVudD1mdW5jdGlvbihiLGMpe3ZhciBkLGU9dGhpcy50aXAoKSxmPWVbMF0ub2Zmc2V0V2lkdGgsZz1lWzBdLm9mZnNldEhlaWdodCxoPXBhcnNlSW50KGUuY3NzKCJtYXJnaW4tdG9wIiksMTApLGk9cGFyc2VJbnQoZS5jc3MoIm1hcmdpbi1sZWZ0IiksMTApO2lzTmFOKGgpJiYoaD0wKSxpc05hTihpKSYmKGk9MCksYi50b3A9Yi50b3AraCxiLmxlZnQ9Yi5sZWZ0K2ksYS5vZmZzZXQuc2V0T2Zmc2V0KGVbMF0sYS5leHRlbmQoe3VzaW5nOmZ1bmN0aW9uKGEpe2UuY3NzKHt0b3A6TWF0aC5yb3VuZChhLnRvcCksbGVmdDpNYXRoLnJvdW5kKGEubGVmdCl9KX19LGIpLDApLGUuYWRkQ2xhc3MoImluIik7dmFyIGo9ZVswXS5vZmZzZXRXaWR0aCxrPWVbMF0ub2Zmc2V0SGVpZ2h0O2lmKCJ0b3AiPT1jJiZrIT1nJiYoZD0hMCxiLnRvcD1iLnRvcCtnLWspLC9ib3R0b218dG9wLy50ZXN0KGMpKXt2YXIgbD0wO2IubGVmdDwwJiYobD0tMipiLmxlZnQsYi5sZWZ0PTAsZS5vZmZzZXQoYiksaj1lWzBdLm9mZnNldFdpZHRoLGs9ZVswXS5vZmZzZXRIZWlnaHQpLHRoaXMucmVwbGFjZUFycm93KGwtZitqLGosImxlZnQiKX1lbHNlIHRoaXMucmVwbGFjZUFycm93KGstZyxrLCJ0b3AiKTtkJiZlLm9mZnNldChiKX0sYi5wcm90b3R5cGUucmVwbGFjZUFycm93PWZ1bmN0aW9uKGEsYixjKXt0aGlzLmFycm93KCkuY3NzKGMsYT81MCooMS1hL2IpKyIlIjoiIil9LGIucHJvdG90eXBlLnNldENvbnRlbnQ9ZnVuY3Rpb24oKXt2YXIgYT10aGlzLnRpcCgpLGI9dGhpcy5nZXRUaXRsZSgpO2EuZmluZCgiLnRvb2x0aXAtaW5uZXIiKVt0aGlzLm9wdGlvbnMuaHRtbD8iaHRtbCI6InRleHQiXShiKSxhLnJlbW92ZUNsYXNzKCJmYWRlIGluIHRvcCBib3R0b20gbGVmdCByaWdodCIpfSxiLnByb3RvdHlwZS5oaWRlPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gYigpeyJpbiIhPWMuaG92ZXJTdGF0ZSYmZC5kZXRhY2goKSxjLiRlbGVtZW50LnRyaWdnZXIoImhpZGRlbi5icy4iK2MudHlwZSl9dmFyIGM9dGhpcyxkPXRoaXMudGlwKCksZT1hLkV2ZW50KCJoaWRlLmJzLiIrdGhpcy50eXBlKTtyZXR1cm4gdGhpcy4kZWxlbWVudC50cmlnZ2VyKGUpLGUuaXNEZWZhdWx0UHJldmVudGVkKCk/dm9pZCAwOihkLnJlbW92ZUNsYXNzKCJpbiIpLGEuc3VwcG9ydC50cmFuc2l0aW9uJiZ0aGlzLiR0aXAuaGFzQ2xhc3MoImZhZGUiKT9kLm9uZShhLnN1cHBvcnQudHJhbnNpdGlvbi5lbmQsYikuZW11bGF0ZVRyYW5zaXRpb25FbmQoMTUwKTpiKCksdGhpcy5ob3ZlclN0YXRlPW51bGwsdGhpcyl9LGIucHJvdG90eXBlLmZpeFRpdGxlPWZ1bmN0aW9uKCl7dmFyIGE9dGhpcy4kZWxlbWVudDsoYS5hdHRyKCJ0aXRsZSIpfHwic3RyaW5nIiE9dHlwZW9mIGEuYXR0cigiZGF0YS1vcmlnaW5hbC10aXRsZSIpKSYmYS5hdHRyKCJkYXRhLW9yaWdpbmFsLXRpdGxlIixhLmF0dHIoInRpdGxlIil8fCIiKS5hdHRyKCJ0aXRsZSIsIiIpfSxiLnByb3RvdHlwZS5oYXNDb250ZW50PWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZ2V0VGl0bGUoKX0sYi5wcm90b3R5cGUuZ2V0UG9zaXRpb249ZnVuY3Rpb24oKXt2YXIgYj10aGlzLiRlbGVtZW50WzBdO3JldHVybiBhLmV4dGVuZCh7fSwiZnVuY3Rpb24iPT10eXBlb2YgYi5nZXRCb3VuZGluZ0NsaWVudFJlY3Q/Yi5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTp7d2lkdGg6Yi5vZmZzZXRXaWR0aCxoZWlnaHQ6Yi5vZmZzZXRIZWlnaHR9LHRoaXMuJGVsZW1lbnQub2Zmc2V0KCkpfSxiLnByb3RvdHlwZS5nZXRDYWxjdWxhdGVkT2Zmc2V0PWZ1bmN0aW9uKGEsYixjLGQpe3JldHVybiJib3R0b20iPT1hP3t0b3A6Yi50b3ArYi5oZWlnaHQsbGVmdDpiLmxlZnQrYi53aWR0aC8yLWMvMn06InRvcCI9PWE/e3RvcDpiLnRvcC1kLGxlZnQ6Yi5sZWZ0K2Iud2lkdGgvMi1jLzJ9OiJsZWZ0Ij09YT97dG9wOmIudG9wK2IuaGVpZ2h0LzItZC8yLGxlZnQ6Yi5sZWZ0LWN9Ont0b3A6Yi50b3ArYi5oZWlnaHQvMi1kLzIsbGVmdDpiLmxlZnQrYi53aWR0aH19LGIucHJvdG90eXBlLmdldFRpdGxlPWZ1bmN0aW9uKCl7dmFyIGEsYj10aGlzLiRlbGVtZW50LGM9dGhpcy5vcHRpb25zO3JldHVybiBhPWIuYXR0cigiZGF0YS1vcmlnaW5hbC10aXRsZSIpfHwoImZ1bmN0aW9uIj09dHlwZW9mIGMudGl0bGU/Yy50aXRsZS5jYWxsKGJbMF0pOmMudGl0bGUpfSxiLnByb3RvdHlwZS50aXA9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy4kdGlwPXRoaXMuJHRpcHx8YSh0aGlzLm9wdGlvbnMudGVtcGxhdGUpfSxiLnByb3RvdHlwZS5hcnJvdz1mdW5jdGlvbigpe3JldHVybiB0aGlzLiRhcnJvdz10aGlzLiRhcnJvd3x8dGhpcy50aXAoKS5maW5kKCIudG9vbHRpcC1hcnJvdyIpfSxiLnByb3RvdHlwZS52YWxpZGF0ZT1mdW5jdGlvbigpe3RoaXMuJGVsZW1lbnRbMF0ucGFyZW50Tm9kZXx8KHRoaXMuaGlkZSgpLHRoaXMuJGVsZW1lbnQ9bnVsbCx0aGlzLm9wdGlvbnM9bnVsbCl9LGIucHJvdG90eXBlLmVuYWJsZT1mdW5jdGlvbigpe3RoaXMuZW5hYmxlZD0hMH0sYi5wcm90b3R5cGUuZGlzYWJsZT1mdW5jdGlvbigpe3RoaXMuZW5hYmxlZD0hMX0sYi5wcm90b3R5cGUudG9nZ2xlRW5hYmxlZD1mdW5jdGlvbigpe3RoaXMuZW5hYmxlZD0hdGhpcy5lbmFibGVkfSxiLnByb3RvdHlwZS50b2dnbGU9ZnVuY3Rpb24oYil7dmFyIGM9Yj9hKGIuY3VycmVudFRhcmdldClbdGhpcy50eXBlXSh0aGlzLmdldERlbGVnYXRlT3B0aW9ucygpKS5kYXRhKCJicy4iK3RoaXMudHlwZSk6dGhpcztjLnRpcCgpLmhhc0NsYXNzKCJpbiIpP2MubGVhdmUoYyk6Yy5lbnRlcihjKX0sYi5wcm90b3R5cGUuZGVzdHJveT1mdW5jdGlvbigpe2NsZWFyVGltZW91dCh0aGlzLnRpbWVvdXQpLHRoaXMuaGlkZSgpLiRlbGVtZW50Lm9mZigiLiIrdGhpcy50eXBlKS5yZW1vdmVEYXRhKCJicy4iK3RoaXMudHlwZSl9O3ZhciBjPWEuZm4udG9vbHRpcDthLmZuLnRvb2x0aXA9ZnVuY3Rpb24oYyl7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBkPWEodGhpcyksZT1kLmRhdGEoImJzLnRvb2x0aXAiKSxmPSJvYmplY3QiPT10eXBlb2YgYyYmYzsoZXx8ImRlc3Ryb3kiIT1jKSYmKGV8fGQuZGF0YSgiYnMudG9vbHRpcCIsZT1uZXcgYih0aGlzLGYpKSwic3RyaW5nIj09dHlwZW9mIGMmJmVbY10oKSl9KX0sYS5mbi50b29sdGlwLkNvbnN0cnVjdG9yPWIsYS5mbi50b29sdGlwLm5vQ29uZmxpY3Q9ZnVuY3Rpb24oKXtyZXR1cm4gYS5mbi50b29sdGlwPWMsdGhpc319KGpRdWVyeSksK2Z1bmN0aW9uKGEpe3ZhciBiPWZ1bmN0aW9uKGEsYil7dGhpcy5pbml0KCJwb3BvdmVyIixhLGIpfTtpZighYS5mbi50b29sdGlwKXRocm93IG5ldyBFcnJvcigiUG9wb3ZlciByZXF1aXJlcyB0b29sdGlwLmpzIik7Yi5ERUZBVUxUUz1hLmV4dGVuZCh7fSxhLmZuLnRvb2x0aXAuQ29uc3RydWN0b3IuREVGQVVMVFMse3BsYWNlbWVudDoicmlnaHQiLHRyaWdnZXI6ImNsaWNrIixjb250ZW50OiIiLHRlbXBsYXRlOic8ZGl2IGNsYXNzPSJwb3BvdmVyIj48ZGl2IGNsYXNzPSJhcnJvdyI+PC9kaXY+PGgzIGNsYXNzPSJwb3BvdmVyLXRpdGxlIj48L2gzPjxkaXYgY2xhc3M9InBvcG92ZXItY29udGVudCI+PC9kaXY+PC9kaXY+J30pLGIucHJvdG90eXBlPWEuZXh0ZW5kKHt9LGEuZm4udG9vbHRpcC5Db25zdHJ1Y3Rvci5wcm90b3R5cGUpLGIucHJvdG90eXBlLmNvbnN0cnVjdG9yPWIsYi5wcm90b3R5cGUuZ2V0RGVmYXVsdHM9ZnVuY3Rpb24oKXtyZXR1cm4gYi5ERUZBVUxUU30sYi5wcm90b3R5cGUuc2V0Q29udGVudD1mdW5jdGlvbigpe3ZhciBhPXRoaXMudGlwKCksYj10aGlzLmdldFRpdGxlKCksYz10aGlzLmdldENvbnRlbnQoKTthLmZpbmQoIi5wb3BvdmVyLXRpdGxlIilbdGhpcy5vcHRpb25zLmh0bWw/Imh0bWwiOiJ0ZXh0Il0oYiksYS5maW5kKCIucG9wb3Zlci1jb250ZW50IilbdGhpcy5vcHRpb25zLmh0bWw/InN0cmluZyI9PXR5cGVvZiBjPyJodG1sIjoiYXBwZW5kIjoidGV4dCJdKGMpLGEucmVtb3ZlQ2xhc3MoImZhZGUgdG9wIGJvdHRvbSBsZWZ0IHJpZ2h0IGluIiksYS5maW5kKCIucG9wb3Zlci10aXRsZSIpLmh0bWwoKXx8YS5maW5kKCIucG9wb3Zlci10aXRsZSIpLmhpZGUoKX0sYi5wcm90b3R5cGUuaGFzQ29udGVudD1mdW5jdGlvbigpe3JldHVybiB0aGlzLmdldFRpdGxlKCl8fHRoaXMuZ2V0Q29udGVudCgpfSxiLnByb3RvdHlwZS5nZXRDb250ZW50PWZ1bmN0aW9uKCl7dmFyIGE9dGhpcy4kZWxlbWVudCxiPXRoaXMub3B0aW9ucztyZXR1cm4gYS5hdHRyKCJkYXRhLWNvbnRlbnQiKXx8KCJmdW5jdGlvbiI9PXR5cGVvZiBiLmNvbnRlbnQ/Yi5jb250ZW50LmNhbGwoYVswXSk6Yi5jb250ZW50KX0sYi5wcm90b3R5cGUuYXJyb3c9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy4kYXJyb3c9dGhpcy4kYXJyb3d8fHRoaXMudGlwKCkuZmluZCgiLmFycm93Iil9LGIucHJvdG90eXBlLnRpcD1mdW5jdGlvbigpe3JldHVybiB0aGlzLiR0aXB8fCh0aGlzLiR0aXA9YSh0aGlzLm9wdGlvbnMudGVtcGxhdGUpKSx0aGlzLiR0aXB9O3ZhciBjPWEuZm4ucG9wb3ZlcjthLmZuLnBvcG92ZXI9ZnVuY3Rpb24oYyl7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBkPWEodGhpcyksZT1kLmRhdGEoImJzLnBvcG92ZXIiKSxmPSJvYmplY3QiPT10eXBlb2YgYyYmYzsoZXx8ImRlc3Ryb3kiIT1jKSYmKGV8fGQuZGF0YSgiYnMucG9wb3ZlciIsZT1uZXcgYih0aGlzLGYpKSwic3RyaW5nIj09dHlwZW9mIGMmJmVbY10oKSl9KX0sYS5mbi5wb3BvdmVyLkNvbnN0cnVjdG9yPWIsYS5mbi5wb3BvdmVyLm5vQ29uZmxpY3Q9ZnVuY3Rpb24oKXtyZXR1cm4gYS5mbi5wb3BvdmVyPWMsdGhpc319KGpRdWVyeSksK2Z1bmN0aW9uKGEpe2Z1bmN0aW9uIGIoYyxkKXt2YXIgZSxmPWEucHJveHkodGhpcy5wcm9jZXNzLHRoaXMpO3RoaXMuJGVsZW1lbnQ9YShhKGMpLmlzKCJib2R5Iik/d2luZG93OmMpLHRoaXMuJGJvZHk9YSgiYm9keSIpLHRoaXMuJHNjcm9sbEVsZW1lbnQ9dGhpcy4kZWxlbWVudC5vbigic2Nyb2xsLmJzLnNjcm9sbC1zcHkuZGF0YS1hcGkiLGYpLHRoaXMub3B0aW9ucz1hLmV4dGVuZCh7fSxiLkRFRkFVTFRTLGQpLHRoaXMuc2VsZWN0b3I9KHRoaXMub3B0aW9ucy50YXJnZXR8fChlPWEoYykuYXR0cigiaHJlZiIpKSYmZS5yZXBsYWNlKC8uKig/PSNbXlxzXSskKS8sIiIpfHwiIikrIiAubmF2IGxpID4gYSIsdGhpcy5vZmZzZXRzPWEoW10pLHRoaXMudGFyZ2V0cz1hKFtdKSx0aGlzLmFjdGl2ZVRhcmdldD1udWxsLHRoaXMucmVmcmVzaCgpLHRoaXMucHJvY2VzcygpfWIuREVGQVVMVFM9e29mZnNldDoxMH0sYi5wcm90b3R5cGUucmVmcmVzaD1mdW5jdGlvbigpe3ZhciBiPXRoaXMuJGVsZW1lbnRbMF09PXdpbmRvdz8ib2Zmc2V0IjoicG9zaXRpb24iO3RoaXMub2Zmc2V0cz1hKFtdKSx0aGlzLnRhcmdldHM9YShbXSk7e3ZhciBjPXRoaXM7dGhpcy4kYm9keS5maW5kKHRoaXMuc2VsZWN0b3IpLm1hcChmdW5jdGlvbigpe3ZhciBkPWEodGhpcyksZT1kLmRhdGEoInRhcmdldCIpfHxkLmF0dHIoImhyZWYiKSxmPS9eIy4vLnRlc3QoZSkmJmEoZSk7cmV0dXJuIGYmJmYubGVuZ3RoJiZmLmlzKCI6dmlzaWJsZSIpJiZbW2ZbYl0oKS50b3ArKCFhLmlzV2luZG93KGMuJHNjcm9sbEVsZW1lbnQuZ2V0KDApKSYmYy4kc2Nyb2xsRWxlbWVudC5zY3JvbGxUb3AoKSksZV1dfHxudWxsfSkuc29ydChmdW5jdGlvbihhLGIpe3JldHVybiBhWzBdLWJbMF19KS5lYWNoKGZ1bmN0aW9uKCl7Yy5vZmZzZXRzLnB1c2godGhpc1swXSksYy50YXJnZXRzLnB1c2godGhpc1sxXSl9KX19LGIucHJvdG90eXBlLnByb2Nlc3M9ZnVuY3Rpb24oKXt2YXIgYSxiPXRoaXMuJHNjcm9sbEVsZW1lbnQuc2Nyb2xsVG9wKCkrdGhpcy5vcHRpb25zLm9mZnNldCxjPXRoaXMuJHNjcm9sbEVsZW1lbnRbMF0uc2Nyb2xsSGVpZ2h0fHx0aGlzLiRib2R5WzBdLnNjcm9sbEhlaWdodCxkPWMtdGhpcy4kc2Nyb2xsRWxlbWVudC5oZWlnaHQoKSxlPXRoaXMub2Zmc2V0cyxmPXRoaXMudGFyZ2V0cyxnPXRoaXMuYWN0aXZlVGFyZ2V0O2lmKGI+PWQpcmV0dXJuIGchPShhPWYubGFzdCgpWzBdKSYmdGhpcy5hY3RpdmF0ZShhKTtpZihnJiZiPD1lWzBdKXJldHVybiBnIT0oYT1mWzBdKSYmdGhpcy5hY3RpdmF0ZShhKTtmb3IoYT1lLmxlbmd0aDthLS07KWchPWZbYV0mJmI+PWVbYV0mJighZVthKzFdfHxiPD1lW2ErMV0pJiZ0aGlzLmFjdGl2YXRlKGZbYV0pfSxiLnByb3RvdHlwZS5hY3RpdmF0ZT1mdW5jdGlvbihiKXt0aGlzLmFjdGl2ZVRhcmdldD1iLGEodGhpcy5zZWxlY3RvcikucGFyZW50c1VudGlsKHRoaXMub3B0aW9ucy50YXJnZXQsIi5hY3RpdmUiKS5yZW1vdmVDbGFzcygiYWN0aXZlIik7dmFyIGM9dGhpcy5zZWxlY3RvcisnW2RhdGEtdGFyZ2V0PSInK2IrJyJdLCcrdGhpcy5zZWxlY3RvcisnW2hyZWY9IicrYisnIl0nLGQ9YShjKS5wYXJlbnRzKCJsaSIpLmFkZENsYXNzKCJhY3RpdmUiKTtkLnBhcmVudCgiLmRyb3Bkb3duLW1lbnUiKS5sZW5ndGgmJihkPWQuY2xvc2VzdCgibGkuZHJvcGRvd24iKS5hZGRDbGFzcygiYWN0aXZlIikpLGQudHJpZ2dlcigiYWN0aXZhdGUuYnMuc2Nyb2xsc3B5Iil9O3ZhciBjPWEuZm4uc2Nyb2xsc3B5O2EuZm4uc2Nyb2xsc3B5PWZ1bmN0aW9uKGMpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgZD1hKHRoaXMpLGU9ZC5kYXRhKCJicy5zY3JvbGxzcHkiKSxmPSJvYmplY3QiPT10eXBlb2YgYyYmYztlfHxkLmRhdGEoImJzLnNjcm9sbHNweSIsZT1uZXcgYih0aGlzLGYpKSwic3RyaW5nIj09dHlwZW9mIGMmJmVbY10oKX0pfSxhLmZuLnNjcm9sbHNweS5Db25zdHJ1Y3Rvcj1iLGEuZm4uc2Nyb2xsc3B5Lm5vQ29uZmxpY3Q9ZnVuY3Rpb24oKXtyZXR1cm4gYS5mbi5zY3JvbGxzcHk9Yyx0aGlzfSxhKHdpbmRvdykub24oImxvYWQiLGZ1bmN0aW9uKCl7YSgnW2RhdGEtc3B5PSJzY3JvbGwiXScpLmVhY2goZnVuY3Rpb24oKXt2YXIgYj1hKHRoaXMpO2Iuc2Nyb2xsc3B5KGIuZGF0YSgpKX0pfSl9KGpRdWVyeSksK2Z1bmN0aW9uKGEpe3ZhciBiPWZ1bmN0aW9uKGIpe3RoaXMuZWxlbWVudD1hKGIpfTtiLnByb3RvdHlwZS5zaG93PWZ1bmN0aW9uKCl7dmFyIGI9dGhpcy5lbGVtZW50LGM9Yi5jbG9zZXN0KCJ1bDpub3QoLmRyb3Bkb3duLW1lbnUpIiksZD1iLmRhdGEoInRhcmdldCIpO2lmKGR8fChkPWIuYXR0cigiaHJlZiIpLGQ9ZCYmZC5yZXBsYWNlKC8uKig/PSNbXlxzXSokKS8sIiIpKSwhYi5wYXJlbnQoImxpIikuaGFzQ2xhc3MoImFjdGl2ZSIpKXt2YXIgZT1jLmZpbmQoIi5hY3RpdmU6bGFzdCBhIilbMF0sZj1hLkV2ZW50KCJzaG93LmJzLnRhYiIse3JlbGF0ZWRUYXJnZXQ6ZX0pO2lmKGIudHJpZ2dlcihmKSwhZi5pc0RlZmF1bHRQcmV2ZW50ZWQoKSl7dmFyIGc9YShkKTt0aGlzLmFjdGl2YXRlKGIucGFyZW50KCJsaSIpLGMpLHRoaXMuYWN0aXZhdGUoZyxnLnBhcmVudCgpLGZ1bmN0aW9uKCl7Yi50cmlnZ2VyKHt0eXBlOiJzaG93bi5icy50YWIiLHJlbGF0ZWRUYXJnZXQ6ZX0pfSl9fX0sYi5wcm90b3R5cGUuYWN0aXZhdGU9ZnVuY3Rpb24oYixjLGQpe2Z1bmN0aW9uIGUoKXtmLnJlbW92ZUNsYXNzKCJhY3RpdmUiKS5maW5kKCI+IC5kcm9wZG93bi1tZW51ID4gLmFjdGl2ZSIpLnJlbW92ZUNsYXNzKCJhY3RpdmUiKSxiLmFkZENsYXNzKCJhY3RpdmUiKSxnPyhiWzBdLm9mZnNldFdpZHRoLGIuYWRkQ2xhc3MoImluIikpOmIucmVtb3ZlQ2xhc3MoImZhZGUiKSxiLnBhcmVudCgiLmRyb3Bkb3duLW1lbnUiKSYmYi5jbG9zZXN0KCJsaS5kcm9wZG93biIpLmFkZENsYXNzKCJhY3RpdmUiKSxkJiZkKCl9dmFyIGY9Yy5maW5kKCI+IC5hY3RpdmUiKSxnPWQmJmEuc3VwcG9ydC50cmFuc2l0aW9uJiZmLmhhc0NsYXNzKCJmYWRlIik7Zz9mLm9uZShhLnN1cHBvcnQudHJhbnNpdGlvbi5lbmQsZSkuZW11bGF0ZVRyYW5zaXRpb25FbmQoMTUwKTplKCksZi5yZW1vdmVDbGFzcygiaW4iKX07dmFyIGM9YS5mbi50YWI7YS5mbi50YWI9ZnVuY3Rpb24oYyl7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBkPWEodGhpcyksZT1kLmRhdGEoImJzLnRhYiIpO2V8fGQuZGF0YSgiYnMudGFiIixlPW5ldyBiKHRoaXMpKSwic3RyaW5nIj09dHlwZW9mIGMmJmVbY10oKX0pfSxhLmZuLnRhYi5Db25zdHJ1Y3Rvcj1iLGEuZm4udGFiLm5vQ29uZmxpY3Q9ZnVuY3Rpb24oKXtyZXR1cm4gYS5mbi50YWI9Yyx0aGlzfSxhKGRvY3VtZW50KS5vbigiY2xpY2suYnMudGFiLmRhdGEtYXBpIiwnW2RhdGEtdG9nZ2xlPSJ0YWIiXSwgW2RhdGEtdG9nZ2xlPSJwaWxsIl0nLGZ1bmN0aW9uKGIpe2IucHJldmVudERlZmF1bHQoKSxhKHRoaXMpLnRhYigic2hvdyIpfSl9KGpRdWVyeSksK2Z1bmN0aW9uKGEpe3ZhciBiPWZ1bmN0aW9uKGMsZCl7dGhpcy5vcHRpb25zPWEuZXh0ZW5kKHt9LGIuREVGQVVMVFMsZCksdGhpcy4kd2luZG93PWEod2luZG93KS5vbigic2Nyb2xsLmJzLmFmZml4LmRhdGEtYXBpIixhLnByb3h5KHRoaXMuY2hlY2tQb3NpdGlvbix0aGlzKSkub24oImNsaWNrLmJzLmFmZml4LmRhdGEtYXBpIixhLnByb3h5KHRoaXMuY2hlY2tQb3NpdGlvbldpdGhFdmVudExvb3AsdGhpcykpLHRoaXMuJGVsZW1lbnQ9YShjKSx0aGlzLmFmZml4ZWQ9dGhpcy51bnBpbj10aGlzLnBpbm5lZE9mZnNldD1udWxsLHRoaXMuY2hlY2tQb3NpdGlvbigpfTtiLlJFU0VUPSJhZmZpeCBhZmZpeC10b3AgYWZmaXgtYm90dG9tIixiLkRFRkFVTFRTPXtvZmZzZXQ6MH0sYi5wcm90b3R5cGUuZ2V0UGlubmVkT2Zmc2V0PWZ1bmN0aW9uKCl7aWYodGhpcy5waW5uZWRPZmZzZXQpcmV0dXJuIHRoaXMucGlubmVkT2Zmc2V0O3RoaXMuJGVsZW1lbnQucmVtb3ZlQ2xhc3MoYi5SRVNFVCkuYWRkQ2xhc3MoImFmZml4Iik7dmFyIGE9dGhpcy4kd2luZG93LnNjcm9sbFRvcCgpLGM9dGhpcy4kZWxlbWVudC5vZmZzZXQoKTtyZXR1cm4gdGhpcy5waW5uZWRPZmZzZXQ9Yy50b3AtYX0sYi5wcm90b3R5cGUuY2hlY2tQb3NpdGlvbldpdGhFdmVudExvb3A9ZnVuY3Rpb24oKXtzZXRUaW1lb3V0KGEucHJveHkodGhpcy5jaGVja1Bvc2l0aW9uLHRoaXMpLDEpfSxiLnByb3RvdHlwZS5jaGVja1Bvc2l0aW9uPWZ1bmN0aW9uKCl7aWYodGhpcy4kZWxlbWVudC5pcygiOnZpc2libGUiKSl7dmFyIGM9YShkb2N1bWVudCkuaGVpZ2h0KCksZD10aGlzLiR3aW5kb3cuc2Nyb2xsVG9wKCksZT10aGlzLiRlbGVtZW50Lm9mZnNldCgpLGY9dGhpcy5vcHRpb25zLm9mZnNldCxnPWYudG9wLGg9Zi5ib3R0b207InRvcCI9PXRoaXMuYWZmaXhlZCYmKGUudG9wKz1kKSwib2JqZWN0IiE9dHlwZW9mIGYmJihoPWc9ZiksImZ1bmN0aW9uIj09dHlwZW9mIGcmJihnPWYudG9wKHRoaXMuJGVsZW1lbnQpKSwiZnVuY3Rpb24iPT10eXBlb2YgaCYmKGg9Zi5ib3R0b20odGhpcy4kZWxlbWVudCkpO3ZhciBpPW51bGwhPXRoaXMudW5waW4mJmQrdGhpcy51bnBpbjw9ZS50b3A/ITE6bnVsbCE9aCYmZS50b3ArdGhpcy4kZWxlbWVudC5oZWlnaHQoKT49Yy1oPyJib3R0b20iOm51bGwhPWcmJmc+PWQ/InRvcCI6ITE7aWYodGhpcy5hZmZpeGVkIT09aSl7dGhpcy51bnBpbiYmdGhpcy4kZWxlbWVudC5jc3MoInRvcCIsIiIpO3ZhciBqPSJhZmZpeCIrKGk/Ii0iK2k6IiIpLGs9YS5FdmVudChqKyIuYnMuYWZmaXgiKTt0aGlzLiRlbGVtZW50LnRyaWdnZXIoayksay5pc0RlZmF1bHRQcmV2ZW50ZWQoKXx8KHRoaXMuYWZmaXhlZD1pLHRoaXMudW5waW49ImJvdHRvbSI9PWk/dGhpcy5nZXRQaW5uZWRPZmZzZXQoKTpudWxsLHRoaXMuJGVsZW1lbnQucmVtb3ZlQ2xhc3MoYi5SRVNFVCkuYWRkQ2xhc3MoaikudHJpZ2dlcihhLkV2ZW50KGoucmVwbGFjZSgiYWZmaXgiLCJhZmZpeGVkIikpKSwiYm90dG9tIj09aSYmdGhpcy4kZWxlbWVudC5vZmZzZXQoe3RvcDpjLWgtdGhpcy4kZWxlbWVudC5oZWlnaHQoKX0pKX19fTt2YXIgYz1hLmZuLmFmZml4O2EuZm4uYWZmaXg9ZnVuY3Rpb24oYyl7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBkPWEodGhpcyksZT1kLmRhdGEoImJzLmFmZml4IiksZj0ib2JqZWN0Ij09dHlwZW9mIGMmJmM7ZXx8ZC5kYXRhKCJicy5hZmZpeCIsZT1uZXcgYih0aGlzLGYpKSwic3RyaW5nIj09dHlwZW9mIGMmJmVbY10oKX0pfSxhLmZuLmFmZml4LkNvbnN0cnVjdG9yPWIsYS5mbi5hZmZpeC5ub0NvbmZsaWN0PWZ1bmN0aW9uKCl7cmV0dXJuIGEuZm4uYWZmaXg9Yyx0aGlzfSxhKHdpbmRvdykub24oImxvYWQiLGZ1bmN0aW9uKCl7YSgnW2RhdGEtc3B5PSJhZmZpeCJdJykuZWFjaChmdW5jdGlvbigpe3ZhciBiPWEodGhpcyksYz1iLmRhdGEoKTtjLm9mZnNldD1jLm9mZnNldHx8e30sYy5vZmZzZXRCb3R0b20mJihjLm9mZnNldC5ib3R0b209Yy5vZmZzZXRCb3R0b20pLGMub2Zmc2V0VG9wJiYoYy5vZmZzZXQudG9wPWMub2Zmc2V0VG9wKSxiLmFmZml4KGMpfSl9KX0oalF1ZXJ5KTsKZGVmaW5lKCJib290c3RyYXAiLCBbImpxdWVyeSJdLCAoZnVuY3Rpb24gKGdsb2JhbCkgewogICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gZ2xvYmFsLmJvb3RzdHJhcDsKICAgIH0KfSh0aGlzKSkpOwoKLyohCiAqIHR5cGVhaGVhZC5qcyAwLjEwLjIKICogaHR0cHM6Ly9naXRodWIuY29tL3R3aXR0ZXIvdHlwZWFoZWFkLmpzCiAqIENvcHlyaWdodCAyMDEzLTIwMTQgVHdpdHRlciwgSW5jLiBhbmQgb3RoZXIgY29udHJpYnV0b3JzOyBMaWNlbnNlZCBNSVQKICovCgooZnVuY3Rpb24oJCkgewogICAgdmFyIF8gPSB7CiAgICAgICAgaXNNc2llOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIC8obXNpZXx0cmlkZW50KS9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkgPyBuYXZpZ2F0b3IudXNlckFnZW50Lm1hdGNoKC8obXNpZSB8cnY6KShcZCsoLlxkKyk/KS9pKVsyXSA6IGZhbHNlOwogICAgICAgIH0sCiAgICAgICAgaXNCbGFua1N0cmluZzogZnVuY3Rpb24oc3RyKSB7CiAgICAgICAgICAgIHJldHVybiAhc3RyIHx8IC9eXHMqJC8udGVzdChzdHIpOwogICAgICAgIH0sCiAgICAgICAgZXNjYXBlUmVnRXhDaGFyczogZnVuY3Rpb24oc3RyKSB7CiAgICAgICAgICAgIHJldHVybiBzdHIucmVwbGFjZSgvW1wtXFtcXVwvXHtcfVwoXClcKlwrXD9cLlxcXF5cJFx8XS9nLCAiXFwkJiIpOwogICAgICAgIH0sCiAgICAgICAgaXNTdHJpbmc6IGZ1bmN0aW9uKG9iaikgewogICAgICAgICAgICByZXR1cm4gdHlwZW9mIG9iaiA9PT0gInN0cmluZyI7CiAgICAgICAgfSwKICAgICAgICBpc051bWJlcjogZnVuY3Rpb24ob2JqKSB7CiAgICAgICAgICAgIHJldHVybiB0eXBlb2Ygb2JqID09PSAibnVtYmVyIjsKICAgICAgICB9LAogICAgICAgIGlzQXJyYXk6ICQuaXNBcnJheSwKICAgICAgICBpc0Z1bmN0aW9uOiAkLmlzRnVuY3Rpb24sCiAgICAgICAgaXNPYmplY3Q6ICQuaXNQbGFpbk9iamVjdCwKICAgICAgICBpc1VuZGVmaW5lZDogZnVuY3Rpb24ob2JqKSB7CiAgICAgICAgICAgIHJldHVybiB0eXBlb2Ygb2JqID09PSAidW5kZWZpbmVkIjsKICAgICAgICB9LAogICAgICAgIGJpbmQ6ICQucHJveHksCiAgICAgICAgZWFjaDogZnVuY3Rpb24oY29sbGVjdGlvbiwgY2IpIHsKICAgICAgICAgICAgJC5lYWNoKGNvbGxlY3Rpb24sIHJldmVyc2VBcmdzKTsKICAgICAgICAgICAgZnVuY3Rpb24gcmV2ZXJzZUFyZ3MoaW5kZXgsIHZhbHVlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gY2IodmFsdWUsIGluZGV4KTsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgbWFwOiAkLm1hcCwKICAgICAgICBmaWx0ZXI6ICQuZ3JlcCwKICAgICAgICBldmVyeTogZnVuY3Rpb24ob2JqLCB0ZXN0KSB7CiAgICAgICAgICAgIHZhciByZXN1bHQgPSB0cnVlOwogICAgICAgICAgICBpZiAoIW9iaikgewogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICAgICAgfQogICAgICAgICAgICAkLmVhY2gob2JqLCBmdW5jdGlvbihrZXksIHZhbCkgewogICAgICAgICAgICAgICAgaWYgKCEocmVzdWx0ID0gdGVzdC5jYWxsKG51bGwsIHZhbCwga2V5LCBvYmopKSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiAhIXJlc3VsdDsKICAgICAgICB9LAogICAgICAgIHNvbWU6IGZ1bmN0aW9uKG9iaiwgdGVzdCkgewogICAgICAgICAgICB2YXIgcmVzdWx0ID0gZmFsc2U7CiAgICAgICAgICAgIGlmICghb2JqKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgICAgICB9CiAgICAgICAgICAgICQuZWFjaChvYmosIGZ1bmN0aW9uKGtleSwgdmFsKSB7CiAgICAgICAgICAgICAgICBpZiAocmVzdWx0ID0gdGVzdC5jYWxsKG51bGwsIHZhbCwga2V5LCBvYmopKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuICEhcmVzdWx0OwogICAgICAgIH0sCiAgICAgICAgbWl4aW46ICQuZXh0ZW5kLAogICAgICAgIGdldFVuaXF1ZUlkOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIGNvdW50ZXIgPSAwOwogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gY291bnRlcisrOwogICAgICAgICAgICB9OwogICAgICAgIH0oKSwKICAgICAgICB0ZW1wbGF0aWZ5OiBmdW5jdGlvbiB0ZW1wbGF0aWZ5KG9iaikgewogICAgICAgICAgICByZXR1cm4gJC5pc0Z1bmN0aW9uKG9iaikgPyBvYmogOiB0ZW1wbGF0ZTsKICAgICAgICAgICAgZnVuY3Rpb24gdGVtcGxhdGUoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gU3RyaW5nKG9iaik7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGRlZmVyOiBmdW5jdGlvbihmbikgewogICAgICAgICAgICBzZXRUaW1lb3V0KGZuLCAwKTsKICAgICAgICB9LAogICAgICAgIGRlYm91bmNlOiBmdW5jdGlvbihmdW5jLCB3YWl0LCBpbW1lZGlhdGUpIHsKICAgICAgICAgICAgdmFyIHRpbWVvdXQsIHJlc3VsdDsKICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdmFyIGNvbnRleHQgPSB0aGlzLCBhcmdzID0gYXJndW1lbnRzLCBsYXRlciwgY2FsbE5vdzsKICAgICAgICAgICAgICAgIGxhdGVyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdGltZW91dCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFpbW1lZGlhdGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgY2FsbE5vdyA9IGltbWVkaWF0ZSAmJiAhdGltZW91dDsKICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0KTsKICAgICAgICAgICAgICAgIHRpbWVvdXQgPSBzZXRUaW1lb3V0KGxhdGVyLCB3YWl0KTsKICAgICAgICAgICAgICAgIGlmIChjYWxsTm93KSB7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgICAgIH07CiAgICAgICAgfSwKICAgICAgICB0aHJvdHRsZTogZnVuY3Rpb24oZnVuYywgd2FpdCkgewogICAgICAgICAgICB2YXIgY29udGV4dCwgYXJncywgdGltZW91dCwgcmVzdWx0LCBwcmV2aW91cywgbGF0ZXI7CiAgICAgICAgICAgIHByZXZpb3VzID0gMDsKICAgICAgICAgICAgbGF0ZXIgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHByZXZpb3VzID0gbmV3IERhdGUoKTsKICAgICAgICAgICAgICAgIHRpbWVvdXQgPSBudWxsOwogICAgICAgICAgICAgICAgcmVzdWx0ID0gZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdmFyIG5vdyA9IG5ldyBEYXRlKCksIHJlbWFpbmluZyA9IHdhaXQgLSAobm93IC0gcHJldmlvdXMpOwogICAgICAgICAgICAgICAgY29udGV4dCA9IHRoaXM7CiAgICAgICAgICAgICAgICBhcmdzID0gYXJndW1lbnRzOwogICAgICAgICAgICAgICAgaWYgKHJlbWFpbmluZyA8PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXQpOwogICAgICAgICAgICAgICAgICAgIHRpbWVvdXQgPSBudWxsOwogICAgICAgICAgICAgICAgICAgIHByZXZpb3VzID0gbm93OwogICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IGZ1bmMuYXBwbHkoY29udGV4dCwgYXJncyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCF0aW1lb3V0KSB7CiAgICAgICAgICAgICAgICAgICAgdGltZW91dCA9IHNldFRpbWVvdXQobGF0ZXIsIHJlbWFpbmluZyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgICAgICB9OwogICAgICAgIH0sCiAgICAgICAgbm9vcDogZnVuY3Rpb24oKSB7fQogICAgfTsKICAgIHZhciBodG1sID0gewogICAgICAgIHdyYXBwZXI6ICc8c3BhbiBjbGFzcz0idHdpdHRlci10eXBlYWhlYWQiPjwvc3Bhbj4nLAogICAgICAgIGRyb3Bkb3duOiAnPHNwYW4gY2xhc3M9InR0LWRyb3Bkb3duLW1lbnUiPjwvc3Bhbj4nLAogICAgICAgIGRhdGFzZXQ6ICc8ZGl2IGNsYXNzPSJ0dC1kYXRhc2V0LSVDTEFTUyUiPjwvZGl2PicsCiAgICAgICAgc3VnZ2VzdGlvbnM6ICc8c3BhbiBjbGFzcz0idHQtc3VnZ2VzdGlvbnMiPjwvc3Bhbj4nLAogICAgICAgIHN1Z2dlc3Rpb246ICc8ZGl2IGNsYXNzPSJ0dC1zdWdnZXN0aW9uIj48L2Rpdj4nCiAgICB9OwogICAgdmFyIGNzcyA9IHsKICAgICAgICB3cmFwcGVyOiB7CiAgICAgICAgICAgIHBvc2l0aW9uOiAicmVsYXRpdmUiLAogICAgICAgICAgICBkaXNwbGF5OiAiaW5saW5lLWJsb2NrIgogICAgICAgIH0sCiAgICAgICAgaGludDogewogICAgICAgICAgICBwb3NpdGlvbjogImFic29sdXRlIiwKICAgICAgICAgICAgdG9wOiAiMCIsCiAgICAgICAgICAgIGxlZnQ6ICIwIiwKICAgICAgICAgICAgYm9yZGVyQ29sb3I6ICJ0cmFuc3BhcmVudCIsCiAgICAgICAgICAgIGJveFNoYWRvdzogIm5vbmUiCiAgICAgICAgfSwKICAgICAgICBpbnB1dDogewogICAgICAgICAgICBwb3NpdGlvbjogInJlbGF0aXZlIiwKICAgICAgICAgICAgdmVydGljYWxBbGlnbjogInRvcCIsCiAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogInRyYW5zcGFyZW50IgogICAgICAgIH0sCiAgICAgICAgaW5wdXRXaXRoTm9IaW50OiB7CiAgICAgICAgICAgIHBvc2l0aW9uOiAicmVsYXRpdmUiLAogICAgICAgICAgICB2ZXJ0aWNhbEFsaWduOiAidG9wIgogICAgICAgIH0sCiAgICAgICAgZHJvcGRvd246IHsKICAgICAgICAgICAgcG9zaXRpb246ICJhYnNvbHV0ZSIsCiAgICAgICAgICAgIHRvcDogIjEwMCUiLAogICAgICAgICAgICBsZWZ0OiAiMCIsCiAgICAgICAgICAgIHpJbmRleDogIjEwMCIsCiAgICAgICAgICAgIGRpc3BsYXk6ICJub25lIgogICAgICAgIH0sCiAgICAgICAgc3VnZ2VzdGlvbnM6IHsKICAgICAgICAgICAgZGlzcGxheTogImJsb2NrIgogICAgICAgIH0sCiAgICAgICAgc3VnZ2VzdGlvbjogewogICAgICAgICAgICB3aGl0ZVNwYWNlOiAibm93cmFwIiwKICAgICAgICAgICAgY3Vyc29yOiAicG9pbnRlciIKICAgICAgICB9LAogICAgICAgIHN1Z2dlc3Rpb25DaGlsZDogewogICAgICAgICAgICB3aGl0ZVNwYWNlOiAibm9ybWFsIgogICAgICAgIH0sCiAgICAgICAgbHRyOiB7CiAgICAgICAgICAgIGxlZnQ6ICIwIiwKICAgICAgICAgICAgcmlnaHQ6ICJhdXRvIgogICAgICAgIH0sCiAgICAgICAgcnRsOiB7CiAgICAgICAgICAgIGxlZnQ6ICJhdXRvIiwKICAgICAgICAgICAgcmlnaHQ6ICIgMCIKICAgICAgICB9CiAgICB9OwogICAgaWYgKF8uaXNNc2llKCkpIHsKICAgICAgICBfLm1peGluKGNzcy5pbnB1dCwgewogICAgICAgICAgICBiYWNrZ3JvdW5kSW1hZ2U6ICJ1cmwoZGF0YTppbWFnZS9naWY7YmFzZTY0LFIwbEdPRGxoQVFBQkFJQUFBQUFBQVAvLy95SDVCQUVBQUFBQUxBQUFBQUFCQUFFQUFBSUJSQUE3KSIKICAgICAgICB9KTsKICAgIH0KICAgIGlmIChfLmlzTXNpZSgpICYmIF8uaXNNc2llKCkgPD0gNykgewogICAgICAgIF8ubWl4aW4oY3NzLmlucHV0LCB7CiAgICAgICAgICAgIG1hcmdpblRvcDogIi0xcHgiCiAgICAgICAgfSk7CiAgICB9CiAgICB2YXIgRXZlbnRCdXMgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgbmFtZXNwYWNlID0gInR5cGVhaGVhZDoiOwogICAgICAgIGZ1bmN0aW9uIEV2ZW50QnVzKG8pIHsKICAgICAgICAgICAgaWYgKCFvIHx8ICFvLmVsKSB7CiAgICAgICAgICAgICAgICAkLmVycm9yKCJFdmVudEJ1cyBpbml0aWFsaXplZCB3aXRob3V0IGVsIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy4kZWwgPSAkKG8uZWwpOwogICAgICAgIH0KICAgICAgICBfLm1peGluKEV2ZW50QnVzLnByb3RvdHlwZSwgewogICAgICAgICAgICB0cmlnZ2VyOiBmdW5jdGlvbih0eXBlKSB7CiAgICAgICAgICAgICAgICB2YXIgYXJncyA9IFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKICAgICAgICAgICAgICAgIHRoaXMuJGVsLnRyaWdnZXIobmFtZXNwYWNlICsgdHlwZSwgYXJncyk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICByZXR1cm4gRXZlbnRCdXM7CiAgICB9KCk7CiAgICB2YXIgRXZlbnRFbWl0dGVyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIHNwbGl0dGVyID0gL1xzKy8sIG5leHRUaWNrID0gZ2V0TmV4dFRpY2soKTsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBvblN5bmM6IG9uU3luYywKICAgICAgICAgICAgb25Bc3luYzogb25Bc3luYywKICAgICAgICAgICAgb2ZmOiBvZmYsCiAgICAgICAgICAgIHRyaWdnZXI6IHRyaWdnZXIKICAgICAgICB9OwogICAgICAgIGZ1bmN0aW9uIG9uKG1ldGhvZCwgdHlwZXMsIGNiLCBjb250ZXh0KSB7CiAgICAgICAgICAgIHZhciB0eXBlOwogICAgICAgICAgICBpZiAoIWNiKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfQogICAgICAgICAgICB0eXBlcyA9IHR5cGVzLnNwbGl0KHNwbGl0dGVyKTsKICAgICAgICAgICAgY2IgPSBjb250ZXh0ID8gYmluZENvbnRleHQoY2IsIGNvbnRleHQpIDogY2I7CiAgICAgICAgICAgIHRoaXMuX2NhbGxiYWNrcyA9IHRoaXMuX2NhbGxiYWNrcyB8fCB7fTsKICAgICAgICAgICAgd2hpbGUgKHR5cGUgPSB0eXBlcy5zaGlmdCgpKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9jYWxsYmFja3NbdHlwZV0gPSB0aGlzLl9jYWxsYmFja3NbdHlwZV0gfHwgewogICAgICAgICAgICAgICAgICAgIHN5bmM6IFtdLAogICAgICAgICAgICAgICAgICAgIGFzeW5jOiBbXQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIHRoaXMuX2NhbGxiYWNrc1t0eXBlXVttZXRob2RdLnB1c2goY2IpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBvbkFzeW5jKHR5cGVzLCBjYiwgY29udGV4dCkgewogICAgICAgICAgICByZXR1cm4gb24uY2FsbCh0aGlzLCAiYXN5bmMiLCB0eXBlcywgY2IsIGNvbnRleHQpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBvblN5bmModHlwZXMsIGNiLCBjb250ZXh0KSB7CiAgICAgICAgICAgIHJldHVybiBvbi5jYWxsKHRoaXMsICJzeW5jIiwgdHlwZXMsIGNiLCBjb250ZXh0KTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gb2ZmKHR5cGVzKSB7CiAgICAgICAgICAgIHZhciB0eXBlOwogICAgICAgICAgICBpZiAoIXRoaXMuX2NhbGxiYWNrcykgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdHlwZXMgPSB0eXBlcy5zcGxpdChzcGxpdHRlcik7CiAgICAgICAgICAgIHdoaWxlICh0eXBlID0gdHlwZXMuc2hpZnQoKSkgewogICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuX2NhbGxiYWNrc1t0eXBlXTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gdHJpZ2dlcih0eXBlcykgewogICAgICAgICAgICB2YXIgdHlwZSwgY2FsbGJhY2tzLCBhcmdzLCBzeW5jRmx1c2gsIGFzeW5jRmx1c2g7CiAgICAgICAgICAgIGlmICghdGhpcy5fY2FsbGJhY2tzKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfQogICAgICAgICAgICB0eXBlcyA9IHR5cGVzLnNwbGl0KHNwbGl0dGVyKTsKICAgICAgICAgICAgYXJncyA9IFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKICAgICAgICAgICAgd2hpbGUgKCh0eXBlID0gdHlwZXMuc2hpZnQoKSkgJiYgKGNhbGxiYWNrcyA9IHRoaXMuX2NhbGxiYWNrc1t0eXBlXSkpIHsKICAgICAgICAgICAgICAgIHN5bmNGbHVzaCA9IGdldEZsdXNoKGNhbGxiYWNrcy5zeW5jLCB0aGlzLCBbIHR5cGUgXS5jb25jYXQoYXJncykpOwogICAgICAgICAgICAgICAgYXN5bmNGbHVzaCA9IGdldEZsdXNoKGNhbGxiYWNrcy5hc3luYywgdGhpcywgWyB0eXBlIF0uY29uY2F0KGFyZ3MpKTsKICAgICAgICAgICAgICAgIHN5bmNGbHVzaCgpICYmIG5leHRUaWNrKGFzeW5jRmx1c2gpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBnZXRGbHVzaChjYWxsYmFja3MsIGNvbnRleHQsIGFyZ3MpIHsKICAgICAgICAgICAgcmV0dXJuIGZsdXNoOwogICAgICAgICAgICBmdW5jdGlvbiBmbHVzaCgpIHsKICAgICAgICAgICAgICAgIHZhciBjYW5jZWxsZWQ7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgIWNhbmNlbGxlZCAmJiBpIDwgY2FsbGJhY2tzLmxlbmd0aDsgaSArPSAxKSB7CiAgICAgICAgICAgICAgICAgICAgY2FuY2VsbGVkID0gY2FsbGJhY2tzW2ldLmFwcGx5KGNvbnRleHQsIGFyZ3MpID09PSBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiAhY2FuY2VsbGVkOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGdldE5leHRUaWNrKCkgewogICAgICAgICAgICB2YXIgbmV4dFRpY2tGbjsKICAgICAgICAgICAgaWYgKHdpbmRvdy5zZXRJbW1lZGlhdGUpIHsKICAgICAgICAgICAgICAgIG5leHRUaWNrRm4gPSBmdW5jdGlvbiBuZXh0VGlja1NldEltbWVkaWF0ZShmbikgewogICAgICAgICAgICAgICAgICAgIHNldEltbWVkaWF0ZShmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm4oKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBuZXh0VGlja0ZuID0gZnVuY3Rpb24gbmV4dFRpY2tTZXRUaW1lb3V0KGZuKSB7CiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm4oKTsKICAgICAgICAgICAgICAgICAgICB9LCAwKTsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG5leHRUaWNrRm47CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGJpbmRDb250ZXh0KGZuLCBjb250ZXh0KSB7CiAgICAgICAgICAgIHJldHVybiBmbi5iaW5kID8gZm4uYmluZChjb250ZXh0KSA6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgZm4uYXBwbHkoY29udGV4dCwgW10uc2xpY2UuY2FsbChhcmd1bWVudHMsIDApKTsKICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICB9KCk7CiAgICB2YXIgaGlnaGxpZ2h0ID0gZnVuY3Rpb24oZG9jKSB7CiAgICAgICAgdmFyIGRlZmF1bHRzID0gewogICAgICAgICAgICBub2RlOiBudWxsLAogICAgICAgICAgICBwYXR0ZXJuOiBudWxsLAogICAgICAgICAgICB0YWdOYW1lOiAic3Ryb25nIiwKICAgICAgICAgICAgY2xhc3NOYW1lOiBudWxsLAogICAgICAgICAgICB3b3Jkc09ubHk6IGZhbHNlLAogICAgICAgICAgICBjYXNlU2Vuc2l0aXZlOiBmYWxzZQogICAgICAgIH07CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIGhpZ2h0bGlnaHQobykgewogICAgICAgICAgICB2YXIgcmVnZXg7CiAgICAgICAgICAgIG8gPSBfLm1peGluKHt9LCBkZWZhdWx0cywgbyk7CiAgICAgICAgICAgIGlmICghby5ub2RlIHx8ICFvLnBhdHRlcm4pIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBvLnBhdHRlcm4gPSBfLmlzQXJyYXkoby5wYXR0ZXJuKSA/IG8ucGF0dGVybiA6IFsgby5wYXR0ZXJuIF07CiAgICAgICAgICAgIHJlZ2V4ID0gZ2V0UmVnZXgoby5wYXR0ZXJuLCBvLmNhc2VTZW5zaXRpdmUsIG8ud29yZHNPbmx5KTsKICAgICAgICAgICAgdHJhdmVyc2Uoby5ub2RlLCBoaWdodGxpZ2h0VGV4dE5vZGUpOwogICAgICAgICAgICBmdW5jdGlvbiBoaWdodGxpZ2h0VGV4dE5vZGUodGV4dE5vZGUpIHsKICAgICAgICAgICAgICAgIHZhciBtYXRjaCwgcGF0dGVybk5vZGU7CiAgICAgICAgICAgICAgICBpZiAobWF0Y2ggPSByZWdleC5leGVjKHRleHROb2RlLmRhdGEpKSB7CiAgICAgICAgICAgICAgICAgICAgd3JhcHBlck5vZGUgPSBkb2MuY3JlYXRlRWxlbWVudChvLnRhZ05hbWUpOwogICAgICAgICAgICAgICAgICAgIG8uY2xhc3NOYW1lICYmICh3cmFwcGVyTm9kZS5jbGFzc05hbWUgPSBvLmNsYXNzTmFtZSk7CiAgICAgICAgICAgICAgICAgICAgcGF0dGVybk5vZGUgPSB0ZXh0Tm9kZS5zcGxpdFRleHQobWF0Y2guaW5kZXgpOwogICAgICAgICAgICAgICAgICAgIHBhdHRlcm5Ob2RlLnNwbGl0VGV4dChtYXRjaFswXS5sZW5ndGgpOwogICAgICAgICAgICAgICAgICAgIHdyYXBwZXJOb2RlLmFwcGVuZENoaWxkKHBhdHRlcm5Ob2RlLmNsb25lTm9kZSh0cnVlKSk7CiAgICAgICAgICAgICAgICAgICAgdGV4dE5vZGUucGFyZW50Tm9kZS5yZXBsYWNlQ2hpbGQod3JhcHBlck5vZGUsIHBhdHRlcm5Ob2RlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiAhIW1hdGNoOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHRyYXZlcnNlKGVsLCBoaWdodGxpZ2h0VGV4dE5vZGUpIHsKICAgICAgICAgICAgICAgIHZhciBjaGlsZE5vZGUsIFRFWFRfTk9ERV9UWVBFID0gMzsKICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZWwuY2hpbGROb2Rlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgIGNoaWxkTm9kZSA9IGVsLmNoaWxkTm9kZXNbaV07CiAgICAgICAgICAgICAgICAgICAgaWYgKGNoaWxkTm9kZS5ub2RlVHlwZSA9PT0gVEVYVF9OT0RFX1RZUEUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaSArPSBoaWdodGxpZ2h0VGV4dE5vZGUoY2hpbGROb2RlKSA/IDEgOiAwOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRyYXZlcnNlKGNoaWxkTm9kZSwgaGlnaHRsaWdodFRleHROb2RlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIGZ1bmN0aW9uIGdldFJlZ2V4KHBhdHRlcm5zLCBjYXNlU2Vuc2l0aXZlLCB3b3Jkc09ubHkpIHsKICAgICAgICAgICAgdmFyIGVzY2FwZWRQYXR0ZXJucyA9IFtdLCByZWdleFN0cjsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwYXR0ZXJucy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgZXNjYXBlZFBhdHRlcm5zLnB1c2goXy5lc2NhcGVSZWdFeENoYXJzKHBhdHRlcm5zW2ldKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmVnZXhTdHIgPSB3b3Jkc09ubHkgPyAiXFxiKCIgKyBlc2NhcGVkUGF0dGVybnMuam9pbigifCIpICsgIilcXGIiIDogIigiICsgZXNjYXBlZFBhdHRlcm5zLmpvaW4oInwiKSArICIpIjsKICAgICAgICAgICAgcmV0dXJuIGNhc2VTZW5zaXRpdmUgPyBuZXcgUmVnRXhwKHJlZ2V4U3RyKSA6IG5ldyBSZWdFeHAocmVnZXhTdHIsICJpIik7CiAgICAgICAgfQogICAgfSh3aW5kb3cuZG9jdW1lbnQpOwogICAgdmFyIElucHV0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIHNwZWNpYWxLZXlDb2RlTWFwOwogICAgICAgIHNwZWNpYWxLZXlDb2RlTWFwID0gewogICAgICAgICAgICA5OiAidGFiIiwKICAgICAgICAgICAgMjc6ICJlc2MiLAogICAgICAgICAgICAzNzogImxlZnQiLAogICAgICAgICAgICAzOTogInJpZ2h0IiwKICAgICAgICAgICAgMTM6ICJlbnRlciIsCiAgICAgICAgICAgIDM4OiAidXAiLAogICAgICAgICAgICA0MDogImRvd24iCiAgICAgICAgfTsKICAgICAgICBmdW5jdGlvbiBJbnB1dChvKSB7CiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgb25CbHVyLCBvbkZvY3VzLCBvbktleWRvd24sIG9uSW5wdXQ7CiAgICAgICAgICAgIG8gPSBvIHx8IHt9OwogICAgICAgICAgICBpZiAoIW8uaW5wdXQpIHsKICAgICAgICAgICAgICAgICQuZXJyb3IoImlucHV0IGlzIG1pc3NpbmciKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBvbkJsdXIgPSBfLmJpbmQodGhpcy5fb25CbHVyLCB0aGlzKTsKICAgICAgICAgICAgb25Gb2N1cyA9IF8uYmluZCh0aGlzLl9vbkZvY3VzLCB0aGlzKTsKICAgICAgICAgICAgb25LZXlkb3duID0gXy5iaW5kKHRoaXMuX29uS2V5ZG93biwgdGhpcyk7CiAgICAgICAgICAgIG9uSW5wdXQgPSBfLmJpbmQodGhpcy5fb25JbnB1dCwgdGhpcyk7CiAgICAgICAgICAgIHRoaXMuJGhpbnQgPSAkKG8uaGludCk7CiAgICAgICAgICAgIHRoaXMuJGlucHV0ID0gJChvLmlucHV0KS5vbigiYmx1ci50dCIsIG9uQmx1cikub24oImZvY3VzLnR0Iiwgb25Gb2N1cykub24oImtleWRvd24udHQiLCBvbktleWRvd24pOwogICAgICAgICAgICBpZiAodGhpcy4kaGludC5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgIHRoaXMuc2V0SGludCA9IHRoaXMuZ2V0SGludCA9IHRoaXMuY2xlYXJIaW50ID0gdGhpcy5jbGVhckhpbnRJZkludmFsaWQgPSBfLm5vb3A7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCFfLmlzTXNpZSgpKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRpbnB1dC5vbigiaW5wdXQudHQiLCBvbklucHV0KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuJGlucHV0Lm9uKCJrZXlkb3duLnR0IGtleXByZXNzLnR0IGN1dC50dCBwYXN0ZS50dCIsIGZ1bmN0aW9uKCRlKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHNwZWNpYWxLZXlDb2RlTWFwWyRlLndoaWNoIHx8ICRlLmtleUNvZGVdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgXy5kZWZlcihfLmJpbmQodGhhdC5fb25JbnB1dCwgdGhhdCwgJGUpKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMucXVlcnkgPSB0aGlzLiRpbnB1dC52YWwoKTsKICAgICAgICAgICAgdGhpcy4kb3ZlcmZsb3dIZWxwZXIgPSBidWlsZE92ZXJmbG93SGVscGVyKHRoaXMuJGlucHV0KTsKICAgICAgICB9CiAgICAgICAgSW5wdXQubm9ybWFsaXplUXVlcnkgPSBmdW5jdGlvbihzdHIpIHsKICAgICAgICAgICAgcmV0dXJuIChzdHIgfHwgIiIpLnJlcGxhY2UoL15ccyovZywgIiIpLnJlcGxhY2UoL1xzezIsfS9nLCAiICIpOwogICAgICAgIH07CiAgICAgICAgXy5taXhpbihJbnB1dC5wcm90b3R5cGUsIEV2ZW50RW1pdHRlciwgewogICAgICAgICAgICBfb25CbHVyOiBmdW5jdGlvbiBvbkJsdXIoKSB7CiAgICAgICAgICAgICAgICB0aGlzLnJlc2V0SW5wdXRWYWx1ZSgpOwogICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCJibHVycmVkIik7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9vbkZvY3VzOiBmdW5jdGlvbiBvbkZvY3VzKCkgewogICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCJmb2N1c2VkIik7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9vbktleWRvd246IGZ1bmN0aW9uIG9uS2V5ZG93bigkZSkgewogICAgICAgICAgICAgICAgdmFyIGtleU5hbWUgPSBzcGVjaWFsS2V5Q29kZU1hcFskZS53aGljaCB8fCAkZS5rZXlDb2RlXTsKICAgICAgICAgICAgICAgIHRoaXMuX21hbmFnZVByZXZlbnREZWZhdWx0KGtleU5hbWUsICRlKTsKICAgICAgICAgICAgICAgIGlmIChrZXlOYW1lICYmIHRoaXMuX3Nob3VsZFRyaWdnZXIoa2V5TmFtZSwgJGUpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKGtleU5hbWUgKyAiS2V5ZWQiLCAkZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9vbklucHV0OiBmdW5jdGlvbiBvbklucHV0KCkgewogICAgICAgICAgICAgICAgdGhpcy5fY2hlY2tJbnB1dFZhbHVlKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9tYW5hZ2VQcmV2ZW50RGVmYXVsdDogZnVuY3Rpb24gbWFuYWdlUHJldmVudERlZmF1bHQoa2V5TmFtZSwgJGUpIHsKICAgICAgICAgICAgICAgIHZhciBwcmV2ZW50RGVmYXVsdCwgaGludFZhbHVlLCBpbnB1dFZhbHVlOwogICAgICAgICAgICAgICAgc3dpdGNoIChrZXlOYW1lKSB7CiAgICAgICAgICAgICAgICAgIGNhc2UgInRhYiI6CiAgICAgICAgICAgICAgICAgICAgaGludFZhbHVlID0gdGhpcy5nZXRIaW50KCk7CiAgICAgICAgICAgICAgICAgICAgaW5wdXRWYWx1ZSA9IHRoaXMuZ2V0SW5wdXRWYWx1ZSgpOwogICAgICAgICAgICAgICAgICAgIHByZXZlbnREZWZhdWx0ID0gaGludFZhbHVlICYmIGhpbnRWYWx1ZSAhPT0gaW5wdXRWYWx1ZSAmJiAhd2l0aE1vZGlmaWVyKCRlKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgIGNhc2UgInVwIjoKICAgICAgICAgICAgICAgICAgY2FzZSAiZG93biI6CiAgICAgICAgICAgICAgICAgICAgcHJldmVudERlZmF1bHQgPSAhd2l0aE1vZGlmaWVyKCRlKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgcHJldmVudERlZmF1bHQgPSBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHByZXZlbnREZWZhdWx0ICYmICRlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9zaG91bGRUcmlnZ2VyOiBmdW5jdGlvbiBzaG91bGRUcmlnZ2VyKGtleU5hbWUsICRlKSB7CiAgICAgICAgICAgICAgICB2YXIgdHJpZ2dlcjsKICAgICAgICAgICAgICAgIHN3aXRjaCAoa2V5TmFtZSkgewogICAgICAgICAgICAgICAgICBjYXNlICJ0YWIiOgogICAgICAgICAgICAgICAgICAgIHRyaWdnZXIgPSAhd2l0aE1vZGlmaWVyKCRlKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgdHJpZ2dlciA9IHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gdHJpZ2dlcjsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX2NoZWNrSW5wdXRWYWx1ZTogZnVuY3Rpb24gY2hlY2tJbnB1dFZhbHVlKCkgewogICAgICAgICAgICAgICAgdmFyIGlucHV0VmFsdWUsIGFyZUVxdWl2YWxlbnQsIGhhc0RpZmZlcmVudFdoaXRlc3BhY2U7CiAgICAgICAgICAgICAgICBpbnB1dFZhbHVlID0gdGhpcy5nZXRJbnB1dFZhbHVlKCk7CiAgICAgICAgICAgICAgICBhcmVFcXVpdmFsZW50ID0gYXJlUXVlcmllc0VxdWl2YWxlbnQoaW5wdXRWYWx1ZSwgdGhpcy5xdWVyeSk7CiAgICAgICAgICAgICAgICBoYXNEaWZmZXJlbnRXaGl0ZXNwYWNlID0gYXJlRXF1aXZhbGVudCA/IHRoaXMucXVlcnkubGVuZ3RoICE9PSBpbnB1dFZhbHVlLmxlbmd0aCA6IGZhbHNlOwogICAgICAgICAgICAgICAgaWYgKCFhcmVFcXVpdmFsZW50KSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCJxdWVyeUNoYW5nZWQiLCB0aGlzLnF1ZXJ5ID0gaW5wdXRWYWx1ZSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGhhc0RpZmZlcmVudFdoaXRlc3BhY2UpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXIoIndoaXRlc3BhY2VDaGFuZ2VkIiwgdGhpcy5xdWVyeSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGZvY3VzOiBmdW5jdGlvbiBmb2N1cygpIHsKICAgICAgICAgICAgICAgIHRoaXMuJGlucHV0LmZvY3VzKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGJsdXI6IGZ1bmN0aW9uIGJsdXIoKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRpbnB1dC5ibHVyKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGdldFF1ZXJ5OiBmdW5jdGlvbiBnZXRRdWVyeSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnF1ZXJ5OwogICAgICAgICAgICB9LAogICAgICAgICAgICBzZXRRdWVyeTogZnVuY3Rpb24gc2V0UXVlcnkocXVlcnkpIHsKICAgICAgICAgICAgICAgIHRoaXMucXVlcnkgPSBxdWVyeTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZ2V0SW5wdXRWYWx1ZTogZnVuY3Rpb24gZ2V0SW5wdXRWYWx1ZSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiRpbnB1dC52YWwoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2V0SW5wdXRWYWx1ZTogZnVuY3Rpb24gc2V0SW5wdXRWYWx1ZSh2YWx1ZSwgc2lsZW50KSB7CiAgICAgICAgICAgICAgICB0aGlzLiRpbnB1dC52YWwodmFsdWUpOwogICAgICAgICAgICAgICAgc2lsZW50ID8gdGhpcy5jbGVhckhpbnQoKSA6IHRoaXMuX2NoZWNrSW5wdXRWYWx1ZSgpOwogICAgICAgICAgICB9LAogICAgICAgICAgICByZXNldElucHV0VmFsdWU6IGZ1bmN0aW9uIHJlc2V0SW5wdXRWYWx1ZSgpIHsKICAgICAgICAgICAgICAgIHRoaXMuc2V0SW5wdXRWYWx1ZSh0aGlzLnF1ZXJ5LCB0cnVlKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZ2V0SGludDogZnVuY3Rpb24gZ2V0SGludCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiRoaW50LnZhbCgpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBzZXRIaW50OiBmdW5jdGlvbiBzZXRIaW50KHZhbHVlKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRoaW50LnZhbCh2YWx1ZSk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNsZWFySGludDogZnVuY3Rpb24gY2xlYXJIaW50KCkgewogICAgICAgICAgICAgICAgdGhpcy5zZXRIaW50KCIiKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgY2xlYXJIaW50SWZJbnZhbGlkOiBmdW5jdGlvbiBjbGVhckhpbnRJZkludmFsaWQoKSB7CiAgICAgICAgICAgICAgICB2YXIgdmFsLCBoaW50LCB2YWxJc1ByZWZpeE9mSGludCwgaXNWYWxpZDsKICAgICAgICAgICAgICAgIHZhbCA9IHRoaXMuZ2V0SW5wdXRWYWx1ZSgpOwogICAgICAgICAgICAgICAgaGludCA9IHRoaXMuZ2V0SGludCgpOwogICAgICAgICAgICAgICAgdmFsSXNQcmVmaXhPZkhpbnQgPSB2YWwgIT09IGhpbnQgJiYgaGludC5pbmRleE9mKHZhbCkgPT09IDA7CiAgICAgICAgICAgICAgICBpc1ZhbGlkID0gdmFsICE9PSAiIiAmJiB2YWxJc1ByZWZpeE9mSGludCAmJiAhdGhpcy5oYXNPdmVyZmxvdygpOwogICAgICAgICAgICAgICAgIWlzVmFsaWQgJiYgdGhpcy5jbGVhckhpbnQoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZ2V0TGFuZ3VhZ2VEaXJlY3Rpb246IGZ1bmN0aW9uIGdldExhbmd1YWdlRGlyZWN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuICh0aGlzLiRpbnB1dC5jc3MoImRpcmVjdGlvbiIpIHx8ICJsdHIiKS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBoYXNPdmVyZmxvdzogZnVuY3Rpb24gaGFzT3ZlcmZsb3coKSB7CiAgICAgICAgICAgICAgICB2YXIgY29uc3RyYWludCA9IHRoaXMuJGlucHV0LndpZHRoKCkgLSAyOwogICAgICAgICAgICAgICAgdGhpcy4kb3ZlcmZsb3dIZWxwZXIudGV4dCh0aGlzLmdldElucHV0VmFsdWUoKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kb3ZlcmZsb3dIZWxwZXIud2lkdGgoKSA+PSBjb25zdHJhaW50OwogICAgICAgICAgICB9LAogICAgICAgICAgICBpc0N1cnNvckF0RW5kOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHZhciB2YWx1ZUxlbmd0aCwgc2VsZWN0aW9uU3RhcnQsIHJhbmdlOwogICAgICAgICAgICAgICAgdmFsdWVMZW5ndGggPSB0aGlzLiRpbnB1dC52YWwoKS5sZW5ndGg7CiAgICAgICAgICAgICAgICBzZWxlY3Rpb25TdGFydCA9IHRoaXMuJGlucHV0WzBdLnNlbGVjdGlvblN0YXJ0OwogICAgICAgICAgICAgICAgaWYgKF8uaXNOdW1iZXIoc2VsZWN0aW9uU3RhcnQpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGVjdGlvblN0YXJ0ID09PSB2YWx1ZUxlbmd0aDsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZG9jdW1lbnQuc2VsZWN0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgcmFuZ2UgPSBkb2N1bWVudC5zZWxlY3Rpb24uY3JlYXRlUmFuZ2UoKTsKICAgICAgICAgICAgICAgICAgICByYW5nZS5tb3ZlU3RhcnQoImNoYXJhY3RlciIsIC12YWx1ZUxlbmd0aCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlTGVuZ3RoID09PSByYW5nZS50ZXh0Lmxlbmd0aDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9LAogICAgICAgICAgICBkZXN0cm95OiBmdW5jdGlvbiBkZXN0cm95KCkgewogICAgICAgICAgICAgICAgdGhpcy4kaGludC5vZmYoIi50dCIpOwogICAgICAgICAgICAgICAgdGhpcy4kaW5wdXQub2ZmKCIudHQiKTsKICAgICAgICAgICAgICAgIHRoaXMuJGhpbnQgPSB0aGlzLiRpbnB1dCA9IHRoaXMuJG92ZXJmbG93SGVscGVyID0gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHJldHVybiBJbnB1dDsKICAgICAgICBmdW5jdGlvbiBidWlsZE92ZXJmbG93SGVscGVyKCRpbnB1dCkgewogICAgICAgICAgICByZXR1cm4gJCgnPHByZSBhcmlhLWhpZGRlbj0idHJ1ZSI+PC9wcmU+JykuY3NzKHsKICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAiYWJzb2x1dGUiLAogICAgICAgICAgICAgICAgdmlzaWJpbGl0eTogImhpZGRlbiIsCiAgICAgICAgICAgICAgICB3aGl0ZVNwYWNlOiAicHJlIiwKICAgICAgICAgICAgICAgIGZvbnRGYW1pbHk6ICRpbnB1dC5jc3MoImZvbnQtZmFtaWx5IiksCiAgICAgICAgICAgICAgICBmb250U2l6ZTogJGlucHV0LmNzcygiZm9udC1zaXplIiksCiAgICAgICAgICAgICAgICBmb250U3R5bGU6ICRpbnB1dC5jc3MoImZvbnQtc3R5bGUiKSwKICAgICAgICAgICAgICAgIGZvbnRWYXJpYW50OiAkaW5wdXQuY3NzKCJmb250LXZhcmlhbnQiKSwKICAgICAgICAgICAgICAgIGZvbnRXZWlnaHQ6ICRpbnB1dC5jc3MoImZvbnQtd2VpZ2h0IiksCiAgICAgICAgICAgICAgICB3b3JkU3BhY2luZzogJGlucHV0LmNzcygid29yZC1zcGFjaW5nIiksCiAgICAgICAgICAgICAgICBsZXR0ZXJTcGFjaW5nOiAkaW5wdXQuY3NzKCJsZXR0ZXItc3BhY2luZyIpLAogICAgICAgICAgICAgICAgdGV4dEluZGVudDogJGlucHV0LmNzcygidGV4dC1pbmRlbnQiKSwKICAgICAgICAgICAgICAgIHRleHRSZW5kZXJpbmc6ICRpbnB1dC5jc3MoInRleHQtcmVuZGVyaW5nIiksCiAgICAgICAgICAgICAgICB0ZXh0VHJhbnNmb3JtOiAkaW5wdXQuY3NzKCJ0ZXh0LXRyYW5zZm9ybSIpCiAgICAgICAgICAgIH0pLmluc2VydEFmdGVyKCRpbnB1dCk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGFyZVF1ZXJpZXNFcXVpdmFsZW50KGEsIGIpIHsKICAgICAgICAgICAgcmV0dXJuIElucHV0Lm5vcm1hbGl6ZVF1ZXJ5KGEpID09PSBJbnB1dC5ub3JtYWxpemVRdWVyeShiKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gd2l0aE1vZGlmaWVyKCRlKSB7CiAgICAgICAgICAgIHJldHVybiAkZS5hbHRLZXkgfHwgJGUuY3RybEtleSB8fCAkZS5tZXRhS2V5IHx8ICRlLnNoaWZ0S2V5OwogICAgICAgIH0KICAgIH0oKTsKICAgIHZhciBEYXRhc2V0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGRhdGFzZXRLZXkgPSAidHREYXRhc2V0IiwgdmFsdWVLZXkgPSAidHRWYWx1ZSIsIGRhdHVtS2V5ID0gInR0RGF0dW0iOwogICAgICAgIGZ1bmN0aW9uIERhdGFzZXQobykgewogICAgICAgICAgICBvID0gbyB8fCB7fTsKICAgICAgICAgICAgby50ZW1wbGF0ZXMgPSBvLnRlbXBsYXRlcyB8fCB7fTsKICAgICAgICAgICAgaWYgKCFvLnNvdXJjZSkgewogICAgICAgICAgICAgICAgJC5lcnJvcigibWlzc2luZyBzb3VyY2UiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoby5uYW1lICYmICFpc1ZhbGlkTmFtZShvLm5hbWUpKSB7CiAgICAgICAgICAgICAgICAkLmVycm9yKCJpbnZhbGlkIGRhdGFzZXQgbmFtZTogIiArIG8ubmFtZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5xdWVyeSA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuaGlnaGxpZ2h0ID0gISFvLmhpZ2hsaWdodDsKICAgICAgICAgICAgdGhpcy5uYW1lID0gby5uYW1lIHx8IF8uZ2V0VW5pcXVlSWQoKTsKICAgICAgICAgICAgdGhpcy5zb3VyY2UgPSBvLnNvdXJjZTsKICAgICAgICAgICAgdGhpcy5kaXNwbGF5Rm4gPSBnZXREaXNwbGF5Rm4oby5kaXNwbGF5IHx8IG8uZGlzcGxheUtleSk7CiAgICAgICAgICAgIHRoaXMudGVtcGxhdGVzID0gZ2V0VGVtcGxhdGVzKG8udGVtcGxhdGVzLCB0aGlzLmRpc3BsYXlGbik7CiAgICAgICAgICAgIHRoaXMuJGVsID0gJChodG1sLmRhdGFzZXQucmVwbGFjZSgiJUNMQVNTJSIsIHRoaXMubmFtZSkpOwogICAgICAgIH0KICAgICAgICBEYXRhc2V0LmV4dHJhY3REYXRhc2V0TmFtZSA9IGZ1bmN0aW9uIGV4dHJhY3REYXRhc2V0TmFtZShlbCkgewogICAgICAgICAgICByZXR1cm4gJChlbCkuZGF0YShkYXRhc2V0S2V5KTsKICAgICAgICB9OwogICAgICAgIERhdGFzZXQuZXh0cmFjdFZhbHVlID0gZnVuY3Rpb24gZXh0cmFjdERhdHVtKGVsKSB7CiAgICAgICAgICAgIHJldHVybiAkKGVsKS5kYXRhKHZhbHVlS2V5KTsKICAgICAgICB9OwogICAgICAgIERhdGFzZXQuZXh0cmFjdERhdHVtID0gZnVuY3Rpb24gZXh0cmFjdERhdHVtKGVsKSB7CiAgICAgICAgICAgIHJldHVybiAkKGVsKS5kYXRhKGRhdHVtS2V5KTsKICAgICAgICB9OwogICAgICAgIF8ubWl4aW4oRGF0YXNldC5wcm90b3R5cGUsIEV2ZW50RW1pdHRlciwgewogICAgICAgICAgICBfcmVuZGVyOiBmdW5jdGlvbiByZW5kZXIocXVlcnksIHN1Z2dlc3Rpb25zKSB7CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuJGVsKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBoYXNTdWdnZXN0aW9uczsKICAgICAgICAgICAgICAgIHRoaXMuJGVsLmVtcHR5KCk7CiAgICAgICAgICAgICAgICBoYXNTdWdnZXN0aW9ucyA9IHN1Z2dlc3Rpb25zICYmIHN1Z2dlc3Rpb25zLmxlbmd0aDsKICAgICAgICAgICAgICAgIGlmICghaGFzU3VnZ2VzdGlvbnMgJiYgdGhpcy50ZW1wbGF0ZXMuZW1wdHkpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbC5odG1sKGdldEVtcHR5SHRtbCgpKS5wcmVwZW5kKHRoYXQudGVtcGxhdGVzLmhlYWRlciA/IGdldEhlYWRlckh0bWwoKSA6IG51bGwpLmFwcGVuZCh0aGF0LnRlbXBsYXRlcy5mb290ZXIgPyBnZXRGb290ZXJIdG1sKCkgOiBudWxsKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaGFzU3VnZ2VzdGlvbnMpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbC5odG1sKGdldFN1Z2dlc3Rpb25zSHRtbCgpKS5wcmVwZW5kKHRoYXQudGVtcGxhdGVzLmhlYWRlciA/IGdldEhlYWRlckh0bWwoKSA6IG51bGwpLmFwcGVuZCh0aGF0LnRlbXBsYXRlcy5mb290ZXIgPyBnZXRGb290ZXJIdG1sKCkgOiBudWxsKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMudHJpZ2dlcigicmVuZGVyZWQiKTsKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGdldEVtcHR5SHRtbCgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhhdC50ZW1wbGF0ZXMuZW1wdHkoewogICAgICAgICAgICAgICAgICAgICAgICBxdWVyeTogcXVlcnksCiAgICAgICAgICAgICAgICAgICAgICAgIGlzRW1wdHk6IHRydWUKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGdldFN1Z2dlc3Rpb25zSHRtbCgpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgJHN1Z2dlc3Rpb25zLCBub2RlczsKICAgICAgICAgICAgICAgICAgICAkc3VnZ2VzdGlvbnMgPSAkKGh0bWwuc3VnZ2VzdGlvbnMpLmNzcyhjc3Muc3VnZ2VzdGlvbnMpOwogICAgICAgICAgICAgICAgICAgIG5vZGVzID0gXy5tYXAoc3VnZ2VzdGlvbnMsIGdldFN1Z2dlc3Rpb25Ob2RlKTsKICAgICAgICAgICAgICAgICAgICAkc3VnZ2VzdGlvbnMuYXBwZW5kLmFwcGx5KCRzdWdnZXN0aW9ucywgbm9kZXMpOwogICAgICAgICAgICAgICAgICAgIHRoYXQuaGlnaGxpZ2h0ICYmIGhpZ2hsaWdodCh7CiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGU6ICRzdWdnZXN0aW9uc1swXSwKICAgICAgICAgICAgICAgICAgICAgICAgcGF0dGVybjogcXVlcnkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHN1Z2dlc3Rpb25zOwogICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGdldFN1Z2dlc3Rpb25Ob2RlKHN1Z2dlc3Rpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyICRlbDsKICAgICAgICAgICAgICAgICAgICAgICAgJGVsID0gJChodG1sLnN1Z2dlc3Rpb24pLmFwcGVuZCh0aGF0LnRlbXBsYXRlcy5zdWdnZXN0aW9uKHN1Z2dlc3Rpb24pKS5kYXRhKGRhdGFzZXRLZXksIHRoYXQubmFtZSkuZGF0YSh2YWx1ZUtleSwgdGhhdC5kaXNwbGF5Rm4oc3VnZ2VzdGlvbikpLmRhdGEoZGF0dW1LZXksIHN1Z2dlc3Rpb24pOwogICAgICAgICAgICAgICAgICAgICAgICAkZWwuY2hpbGRyZW4oKS5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5jc3MoY3NzLnN1Z2dlc3Rpb25DaGlsZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGVsOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGdldEhlYWRlckh0bWwoKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoYXQudGVtcGxhdGVzLmhlYWRlcih7CiAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXJ5OiBxdWVyeSwKICAgICAgICAgICAgICAgICAgICAgICAgaXNFbXB0eTogIWhhc1N1Z2dlc3Rpb25zCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBmdW5jdGlvbiBnZXRGb290ZXJIdG1sKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGF0LnRlbXBsYXRlcy5mb290ZXIoewogICAgICAgICAgICAgICAgICAgICAgICBxdWVyeTogcXVlcnksCiAgICAgICAgICAgICAgICAgICAgICAgIGlzRW1wdHk6ICFoYXNTdWdnZXN0aW9ucwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBnZXRSb290OiBmdW5jdGlvbiBnZXRSb290KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJGVsOwogICAgICAgICAgICB9LAogICAgICAgICAgICB1cGRhdGU6IGZ1bmN0aW9uIHVwZGF0ZShxdWVyeSkgewogICAgICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzOwogICAgICAgICAgICAgICAgdGhpcy5xdWVyeSA9IHF1ZXJ5OwogICAgICAgICAgICAgICAgdGhpcy5jYW5jZWxlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgdGhpcy5zb3VyY2UocXVlcnksIHJlbmRlcik7CiAgICAgICAgICAgICAgICBmdW5jdGlvbiByZW5kZXIoc3VnZ2VzdGlvbnMpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIXRoYXQuY2FuY2VsZWQgJiYgcXVlcnkgPT09IHRoYXQucXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5fcmVuZGVyKHF1ZXJ5LCBzdWdnZXN0aW9ucyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBjYW5jZWw6IGZ1bmN0aW9uIGNhbmNlbCgpIHsKICAgICAgICAgICAgICAgIHRoaXMuY2FuY2VsZWQgPSB0cnVlOwogICAgICAgICAgICB9LAogICAgICAgICAgICBjbGVhcjogZnVuY3Rpb24gY2xlYXIoKSB7CiAgICAgICAgICAgICAgICB0aGlzLmNhbmNlbCgpOwogICAgICAgICAgICAgICAgdGhpcy4kZWwuZW1wdHkoKTsKICAgICAgICAgICAgICAgIHRoaXMudHJpZ2dlcigicmVuZGVyZWQiKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgaXNFbXB0eTogZnVuY3Rpb24gaXNFbXB0eSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiRlbC5pcygiOmVtcHR5Iik7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uIGRlc3Ryb3koKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRlbCA9IG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICByZXR1cm4gRGF0YXNldDsKICAgICAgICBmdW5jdGlvbiBnZXREaXNwbGF5Rm4oZGlzcGxheSkgewogICAgICAgICAgICBkaXNwbGF5ID0gZGlzcGxheSB8fCAidmFsdWUiOwogICAgICAgICAgICByZXR1cm4gXy5pc0Z1bmN0aW9uKGRpc3BsYXkpID8gZGlzcGxheSA6IGRpc3BsYXlGbjsKICAgICAgICAgICAgZnVuY3Rpb24gZGlzcGxheUZuKG9iaikgewogICAgICAgICAgICAgICAgcmV0dXJuIG9ialtkaXNwbGF5XTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBnZXRUZW1wbGF0ZXModGVtcGxhdGVzLCBkaXNwbGF5Rm4pIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIGVtcHR5OiB0ZW1wbGF0ZXMuZW1wdHkgJiYgXy50ZW1wbGF0aWZ5KHRlbXBsYXRlcy5lbXB0eSksCiAgICAgICAgICAgICAgICBoZWFkZXI6IHRlbXBsYXRlcy5oZWFkZXIgJiYgXy50ZW1wbGF0aWZ5KHRlbXBsYXRlcy5oZWFkZXIpLAogICAgICAgICAgICAgICAgZm9vdGVyOiB0ZW1wbGF0ZXMuZm9vdGVyICYmIF8udGVtcGxhdGlmeSh0ZW1wbGF0ZXMuZm9vdGVyKSwKICAgICAgICAgICAgICAgIHN1Z2dlc3Rpb246IHRlbXBsYXRlcy5zdWdnZXN0aW9uIHx8IHN1Z2dlc3Rpb25UZW1wbGF0ZQogICAgICAgICAgICB9OwogICAgICAgICAgICBmdW5jdGlvbiBzdWdnZXN0aW9uVGVtcGxhdGUoY29udGV4dCkgewogICAgICAgICAgICAgICAgcmV0dXJuICI8cD4iICsgZGlzcGxheUZuKGNvbnRleHQpICsgIjwvcD4iOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGlzVmFsaWROYW1lKHN0cikgewogICAgICAgICAgICByZXR1cm4gL15bX2EtekEtWjAtOS1dKyQvLnRlc3Qoc3RyKTsKICAgICAgICB9CiAgICB9KCk7CiAgICB2YXIgRHJvcGRvd24gPSBmdW5jdGlvbigpIHsKICAgICAgICBmdW5jdGlvbiBEcm9wZG93bihvKSB7CiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgb25TdWdnZXN0aW9uQ2xpY2ssIG9uU3VnZ2VzdGlvbk1vdXNlRW50ZXIsIG9uU3VnZ2VzdGlvbk1vdXNlTGVhdmU7CiAgICAgICAgICAgIG8gPSBvIHx8IHt9OwogICAgICAgICAgICBpZiAoIW8ubWVudSkgewogICAgICAgICAgICAgICAgJC5lcnJvcigibWVudSBpcyByZXF1aXJlZCIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuaXNPcGVuID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuaXNFbXB0eSA9IHRydWU7CiAgICAgICAgICAgIHRoaXMuZGF0YXNldHMgPSBfLm1hcChvLmRhdGFzZXRzLCBpbml0aWFsaXplRGF0YXNldCk7CiAgICAgICAgICAgIG9uU3VnZ2VzdGlvbkNsaWNrID0gXy5iaW5kKHRoaXMuX29uU3VnZ2VzdGlvbkNsaWNrLCB0aGlzKTsKICAgICAgICAgICAgb25TdWdnZXN0aW9uTW91c2VFbnRlciA9IF8uYmluZCh0aGlzLl9vblN1Z2dlc3Rpb25Nb3VzZUVudGVyLCB0aGlzKTsKICAgICAgICAgICAgb25TdWdnZXN0aW9uTW91c2VMZWF2ZSA9IF8uYmluZCh0aGlzLl9vblN1Z2dlc3Rpb25Nb3VzZUxlYXZlLCB0aGlzKTsKICAgICAgICAgICAgdGhpcy4kbWVudSA9ICQoby5tZW51KS5vbigiY2xpY2sudHQiLCAiLnR0LXN1Z2dlc3Rpb24iLCBvblN1Z2dlc3Rpb25DbGljaykub24oIm1vdXNlZW50ZXIudHQiLCAiLnR0LXN1Z2dlc3Rpb24iLCBvblN1Z2dlc3Rpb25Nb3VzZUVudGVyKS5vbigibW91c2VsZWF2ZS50dCIsICIudHQtc3VnZ2VzdGlvbiIsIG9uU3VnZ2VzdGlvbk1vdXNlTGVhdmUpOwogICAgICAgICAgICBfLmVhY2godGhpcy5kYXRhc2V0cywgZnVuY3Rpb24oZGF0YXNldCkgewogICAgICAgICAgICAgICAgdGhhdC4kbWVudS5hcHBlbmQoZGF0YXNldC5nZXRSb290KCkpOwogICAgICAgICAgICAgICAgZGF0YXNldC5vblN5bmMoInJlbmRlcmVkIiwgdGhhdC5fb25SZW5kZXJlZCwgdGhhdCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBfLm1peGluKERyb3Bkb3duLnByb3RvdHlwZSwgRXZlbnRFbWl0dGVyLCB7CiAgICAgICAgICAgIF9vblN1Z2dlc3Rpb25DbGljazogZnVuY3Rpb24gb25TdWdnZXN0aW9uQ2xpY2soJGUpIHsKICAgICAgICAgICAgICAgIHRoaXMudHJpZ2dlcigic3VnZ2VzdGlvbkNsaWNrZWQiLCAkKCRlLmN1cnJlbnRUYXJnZXQpKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX29uU3VnZ2VzdGlvbk1vdXNlRW50ZXI6IGZ1bmN0aW9uIG9uU3VnZ2VzdGlvbk1vdXNlRW50ZXIoJGUpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3JlbW92ZUN1cnNvcigpOwogICAgICAgICAgICAgICAgdGhpcy5fc2V0Q3Vyc29yKCQoJGUuY3VycmVudFRhcmdldCksIHRydWUpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfb25TdWdnZXN0aW9uTW91c2VMZWF2ZTogZnVuY3Rpb24gb25TdWdnZXN0aW9uTW91c2VMZWF2ZSgpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3JlbW92ZUN1cnNvcigpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfb25SZW5kZXJlZDogZnVuY3Rpb24gb25SZW5kZXJlZCgpIHsKICAgICAgICAgICAgICAgIHRoaXMuaXNFbXB0eSA9IF8uZXZlcnkodGhpcy5kYXRhc2V0cywgaXNEYXRhc2V0RW1wdHkpOwogICAgICAgICAgICAgICAgdGhpcy5pc0VtcHR5ID8gdGhpcy5faGlkZSgpIDogdGhpcy5pc09wZW4gJiYgdGhpcy5fc2hvdygpOwogICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCJkYXRhc2V0UmVuZGVyZWQiKTsKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGlzRGF0YXNldEVtcHR5KGRhdGFzZXQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YXNldC5pc0VtcHR5KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9oaWRlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHRoaXMuJG1lbnUuaGlkZSgpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfc2hvdzogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRtZW51LmNzcygiZGlzcGxheSIsICJibG9jayIpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfZ2V0U3VnZ2VzdGlvbnM6IGZ1bmN0aW9uIGdldFN1Z2dlc3Rpb25zKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJG1lbnUuZmluZCgiLnR0LXN1Z2dlc3Rpb24iKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX2dldEN1cnNvcjogZnVuY3Rpb24gZ2V0Q3Vyc29yKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJG1lbnUuZmluZCgiLnR0LWN1cnNvciIpLmZpcnN0KCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9zZXRDdXJzb3I6IGZ1bmN0aW9uIHNldEN1cnNvcigkZWwsIHNpbGVudCkgewogICAgICAgICAgICAgICAgJGVsLmZpcnN0KCkuYWRkQ2xhc3MoInR0LWN1cnNvciIpOwogICAgICAgICAgICAgICAgIXNpbGVudCAmJiB0aGlzLnRyaWdnZXIoImN1cnNvck1vdmVkIik7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9yZW1vdmVDdXJzb3I6IGZ1bmN0aW9uIHJlbW92ZUN1cnNvcigpIHsKICAgICAgICAgICAgICAgIHRoaXMuX2dldEN1cnNvcigpLnJlbW92ZUNsYXNzKCJ0dC1jdXJzb3IiKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX21vdmVDdXJzb3I6IGZ1bmN0aW9uIG1vdmVDdXJzb3IoaW5jcmVtZW50KSB7CiAgICAgICAgICAgICAgICB2YXIgJHN1Z2dlc3Rpb25zLCAkb2xkQ3Vyc29yLCBuZXdDdXJzb3JJbmRleCwgJG5ld0N1cnNvcjsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5pc09wZW4pIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkb2xkQ3Vyc29yID0gdGhpcy5fZ2V0Q3Vyc29yKCk7CiAgICAgICAgICAgICAgICAkc3VnZ2VzdGlvbnMgPSB0aGlzLl9nZXRTdWdnZXN0aW9ucygpOwogICAgICAgICAgICAgICAgdGhpcy5fcmVtb3ZlQ3Vyc29yKCk7CiAgICAgICAgICAgICAgICBuZXdDdXJzb3JJbmRleCA9ICRzdWdnZXN0aW9ucy5pbmRleCgkb2xkQ3Vyc29yKSArIGluY3JlbWVudDsKICAgICAgICAgICAgICAgIG5ld0N1cnNvckluZGV4ID0gKG5ld0N1cnNvckluZGV4ICsgMSkgJSAoJHN1Z2dlc3Rpb25zLmxlbmd0aCArIDEpIC0gMTsKICAgICAgICAgICAgICAgIGlmIChuZXdDdXJzb3JJbmRleCA9PT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXIoImN1cnNvclJlbW92ZWQiKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG5ld0N1cnNvckluZGV4IDwgLTEpIHsKICAgICAgICAgICAgICAgICAgICBuZXdDdXJzb3JJbmRleCA9ICRzdWdnZXN0aW9ucy5sZW5ndGggLSAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5fc2V0Q3Vyc29yKCRuZXdDdXJzb3IgPSAkc3VnZ2VzdGlvbnMuZXEobmV3Q3Vyc29ySW5kZXgpKTsKICAgICAgICAgICAgICAgIHRoaXMuX2Vuc3VyZVZpc2libGUoJG5ld0N1cnNvcik7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9lbnN1cmVWaXNpYmxlOiBmdW5jdGlvbiBlbnN1cmVWaXNpYmxlKCRlbCkgewogICAgICAgICAgICAgICAgdmFyIGVsVG9wLCBlbEJvdHRvbSwgbWVudVNjcm9sbFRvcCwgbWVudUhlaWdodDsKICAgICAgICAgICAgICAgIGVsVG9wID0gJGVsLnBvc2l0aW9uKCkudG9wOwogICAgICAgICAgICAgICAgZWxCb3R0b20gPSBlbFRvcCArICRlbC5vdXRlckhlaWdodCh0cnVlKTsKICAgICAgICAgICAgICAgIG1lbnVTY3JvbGxUb3AgPSB0aGlzLiRtZW51LnNjcm9sbFRvcCgpOwogICAgICAgICAgICAgICAgbWVudUhlaWdodCA9IHRoaXMuJG1lbnUuaGVpZ2h0KCkgKyBwYXJzZUludCh0aGlzLiRtZW51LmNzcygicGFkZGluZ1RvcCIpLCAxMCkgKyBwYXJzZUludCh0aGlzLiRtZW51LmNzcygicGFkZGluZ0JvdHRvbSIpLCAxMCk7CiAgICAgICAgICAgICAgICBpZiAoZWxUb3AgPCAwKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kbWVudS5zY3JvbGxUb3AobWVudVNjcm9sbFRvcCArIGVsVG9wKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobWVudUhlaWdodCA8IGVsQm90dG9tKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kbWVudS5zY3JvbGxUb3AobWVudVNjcm9sbFRvcCArIChlbEJvdHRvbSAtIG1lbnVIZWlnaHQpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgY2xvc2U6IGZ1bmN0aW9uIGNsb3NlKCkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNPcGVuKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5pc09wZW4gPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZW1vdmVDdXJzb3IoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9oaWRlKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCJjbG9zZWQiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgb3BlbjogZnVuY3Rpb24gb3BlbigpIHsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5pc09wZW4pIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmlzT3BlbiA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgIXRoaXMuaXNFbXB0eSAmJiB0aGlzLl9zaG93KCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCJvcGVuZWQiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2V0TGFuZ3VhZ2VEaXJlY3Rpb246IGZ1bmN0aW9uIHNldExhbmd1YWdlRGlyZWN0aW9uKGRpcikgewogICAgICAgICAgICAgICAgdGhpcy4kbWVudS5jc3MoZGlyID09PSAibHRyIiA/IGNzcy5sdHIgOiBjc3MucnRsKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgbW92ZUN1cnNvclVwOiBmdW5jdGlvbiBtb3ZlQ3Vyc29yVXAoKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9tb3ZlQ3Vyc29yKC0xKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgbW92ZUN1cnNvckRvd246IGZ1bmN0aW9uIG1vdmVDdXJzb3JEb3duKCkgewogICAgICAgICAgICAgICAgdGhpcy5fbW92ZUN1cnNvcigrMSk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGdldERhdHVtRm9yU3VnZ2VzdGlvbjogZnVuY3Rpb24gZ2V0RGF0dW1Gb3JTdWdnZXN0aW9uKCRlbCkgewogICAgICAgICAgICAgICAgdmFyIGRhdHVtID0gbnVsbDsKICAgICAgICAgICAgICAgIGlmICgkZWwubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgZGF0dW0gPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJhdzogRGF0YXNldC5leHRyYWN0RGF0dW0oJGVsKSwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IERhdGFzZXQuZXh0cmFjdFZhbHVlKCRlbCksCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFzZXROYW1lOiBEYXRhc2V0LmV4dHJhY3REYXRhc2V0TmFtZSgkZWwpCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBkYXR1bTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZ2V0RGF0dW1Gb3JDdXJzb3I6IGZ1bmN0aW9uIGdldERhdHVtRm9yQ3Vyc29yKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0RGF0dW1Gb3JTdWdnZXN0aW9uKHRoaXMuX2dldEN1cnNvcigpLmZpcnN0KCkpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBnZXREYXR1bUZvclRvcFN1Z2dlc3Rpb246IGZ1bmN0aW9uIGdldERhdHVtRm9yVG9wU3VnZ2VzdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldERhdHVtRm9yU3VnZ2VzdGlvbih0aGlzLl9nZXRTdWdnZXN0aW9ucygpLmZpcnN0KCkpOwogICAgICAgICAgICB9LAogICAgICAgICAgICB1cGRhdGU6IGZ1bmN0aW9uIHVwZGF0ZShxdWVyeSkgewogICAgICAgICAgICAgICAgXy5lYWNoKHRoaXMuZGF0YXNldHMsIHVwZGF0ZURhdGFzZXQpOwogICAgICAgICAgICAgICAgZnVuY3Rpb24gdXBkYXRlRGF0YXNldChkYXRhc2V0KSB7CiAgICAgICAgICAgICAgICAgICAgZGF0YXNldC51cGRhdGUocXVlcnkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbXB0eTogZnVuY3Rpb24gZW1wdHkoKSB7CiAgICAgICAgICAgICAgICBfLmVhY2godGhpcy5kYXRhc2V0cywgY2xlYXJEYXRhc2V0KTsKICAgICAgICAgICAgICAgIHRoaXMuaXNFbXB0eSA9IHRydWU7CiAgICAgICAgICAgICAgICBmdW5jdGlvbiBjbGVhckRhdGFzZXQoZGF0YXNldCkgewogICAgICAgICAgICAgICAgICAgIGRhdGFzZXQuY2xlYXIoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgaXNWaXNpYmxlOiBmdW5jdGlvbiBpc1Zpc2libGUoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5pc09wZW4gJiYgIXRoaXMuaXNFbXB0eTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZGVzdHJveTogZnVuY3Rpb24gZGVzdHJveSgpIHsKICAgICAgICAgICAgICAgIHRoaXMuJG1lbnUub2ZmKCIudHQiKTsKICAgICAgICAgICAgICAgIHRoaXMuJG1lbnUgPSBudWxsOwogICAgICAgICAgICAgICAgXy5lYWNoKHRoaXMuZGF0YXNldHMsIGRlc3Ryb3lEYXRhc2V0KTsKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGRlc3Ryb3lEYXRhc2V0KGRhdGFzZXQpIHsKICAgICAgICAgICAgICAgICAgICBkYXRhc2V0LmRlc3Ryb3koKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHJldHVybiBEcm9wZG93bjsKICAgICAgICBmdW5jdGlvbiBpbml0aWFsaXplRGF0YXNldChvRGF0YXNldCkgewogICAgICAgICAgICByZXR1cm4gbmV3IERhdGFzZXQob0RhdGFzZXQpOwogICAgICAgIH0KICAgIH0oKTsKICAgIHZhciBUeXBlYWhlYWQgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgYXR0cnNLZXkgPSAidHRBdHRycyI7CiAgICAgICAgZnVuY3Rpb24gVHlwZWFoZWFkKG8pIHsKICAgICAgICAgICAgdmFyICRtZW51LCAkaW5wdXQsICRoaW50OwogICAgICAgICAgICBvID0gbyB8fCB7fTsKICAgICAgICAgICAgaWYgKCFvLmlucHV0KSB7CiAgICAgICAgICAgICAgICAkLmVycm9yKCJtaXNzaW5nIGlucHV0Iik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5pc0FjdGl2YXRlZCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLmF1dG9zZWxlY3QgPSAhIW8uYXV0b3NlbGVjdDsKICAgICAgICAgICAgdGhpcy5taW5MZW5ndGggPSBfLmlzTnVtYmVyKG8ubWluTGVuZ3RoKSA/IG8ubWluTGVuZ3RoIDogMTsKICAgICAgICAgICAgdGhpcy4kbm9kZSA9IGJ1aWxkRG9tU3RydWN0dXJlKG8uaW5wdXQsIG8ud2l0aEhpbnQpOwogICAgICAgICAgICAkbWVudSA9IHRoaXMuJG5vZGUuZmluZCgiLnR0LWRyb3Bkb3duLW1lbnUiKTsKICAgICAgICAgICAgJGlucHV0ID0gdGhpcy4kbm9kZS5maW5kKCIudHQtaW5wdXQiKTsKICAgICAgICAgICAgJGhpbnQgPSB0aGlzLiRub2RlLmZpbmQoIi50dC1oaW50Iik7CiAgICAgICAgICAgICRpbnB1dC5vbigiYmx1ci50dCIsIGZ1bmN0aW9uKCRlKSB7CiAgICAgICAgICAgICAgICB2YXIgYWN0aXZlLCBpc0FjdGl2ZSwgaGFzQWN0aXZlOwogICAgICAgICAgICAgICAgYWN0aXZlID0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudDsKICAgICAgICAgICAgICAgIGlzQWN0aXZlID0gJG1lbnUuaXMoYWN0aXZlKTsKICAgICAgICAgICAgICAgIGhhc0FjdGl2ZSA9ICRtZW51LmhhcyhhY3RpdmUpLmxlbmd0aCA+IDA7CiAgICAgICAgICAgICAgICBpZiAoXy5pc01zaWUoKSAmJiAoaXNBY3RpdmUgfHwgaGFzQWN0aXZlKSkgewogICAgICAgICAgICAgICAgICAgICRlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgJGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7CiAgICAgICAgICAgICAgICAgICAgXy5kZWZlcihmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGlucHV0LmZvY3VzKCk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAkbWVudS5vbigibW91c2Vkb3duLnR0IiwgZnVuY3Rpb24oJGUpIHsKICAgICAgICAgICAgICAgICRlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0aGlzLmV2ZW50QnVzID0gby5ldmVudEJ1cyB8fCBuZXcgRXZlbnRCdXMoewogICAgICAgICAgICAgICAgZWw6ICRpbnB1dAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGhpcy5kcm9wZG93biA9IG5ldyBEcm9wZG93bih7CiAgICAgICAgICAgICAgICBtZW51OiAkbWVudSwKICAgICAgICAgICAgICAgIGRhdGFzZXRzOiBvLmRhdGFzZXRzCiAgICAgICAgICAgIH0pLm9uU3luYygic3VnZ2VzdGlvbkNsaWNrZWQiLCB0aGlzLl9vblN1Z2dlc3Rpb25DbGlja2VkLCB0aGlzKS5vblN5bmMoImN1cnNvck1vdmVkIiwgdGhpcy5fb25DdXJzb3JNb3ZlZCwgdGhpcykub25TeW5jKCJjdXJzb3JSZW1vdmVkIiwgdGhpcy5fb25DdXJzb3JSZW1vdmVkLCB0aGlzKS5vblN5bmMoIm9wZW5lZCIsIHRoaXMuX29uT3BlbmVkLCB0aGlzKS5vblN5bmMoImNsb3NlZCIsIHRoaXMuX29uQ2xvc2VkLCB0aGlzKS5vbkFzeW5jKCJkYXRhc2V0UmVuZGVyZWQiLCB0aGlzLl9vbkRhdGFzZXRSZW5kZXJlZCwgdGhpcyk7CiAgICAgICAgICAgIHRoaXMuaW5wdXQgPSBuZXcgSW5wdXQoewogICAgICAgICAgICAgICAgaW5wdXQ6ICRpbnB1dCwKICAgICAgICAgICAgICAgIGhpbnQ6ICRoaW50CiAgICAgICAgICAgIH0pLm9uU3luYygiZm9jdXNlZCIsIHRoaXMuX29uRm9jdXNlZCwgdGhpcykub25TeW5jKCJibHVycmVkIiwgdGhpcy5fb25CbHVycmVkLCB0aGlzKS5vblN5bmMoImVudGVyS2V5ZWQiLCB0aGlzLl9vbkVudGVyS2V5ZWQsIHRoaXMpLm9uU3luYygidGFiS2V5ZWQiLCB0aGlzLl9vblRhYktleWVkLCB0aGlzKS5vblN5bmMoImVzY0tleWVkIiwgdGhpcy5fb25Fc2NLZXllZCwgdGhpcykub25TeW5jKCJ1cEtleWVkIiwgdGhpcy5fb25VcEtleWVkLCB0aGlzKS5vblN5bmMoImRvd25LZXllZCIsIHRoaXMuX29uRG93bktleWVkLCB0aGlzKS5vblN5bmMoImxlZnRLZXllZCIsIHRoaXMuX29uTGVmdEtleWVkLCB0aGlzKS5vblN5bmMoInJpZ2h0S2V5ZWQiLCB0aGlzLl9vblJpZ2h0S2V5ZWQsIHRoaXMpLm9uU3luYygicXVlcnlDaGFuZ2VkIiwgdGhpcy5fb25RdWVyeUNoYW5nZWQsIHRoaXMpLm9uU3luYygid2hpdGVzcGFjZUNoYW5nZWQiLCB0aGlzLl9vbldoaXRlc3BhY2VDaGFuZ2VkLCB0aGlzKTsKICAgICAgICAgICAgdGhpcy5fc2V0TGFuZ3VhZ2VEaXJlY3Rpb24oKTsKICAgICAgICB9CiAgICAgICAgXy5taXhpbihUeXBlYWhlYWQucHJvdG90eXBlLCB7CiAgICAgICAgICAgIF9vblN1Z2dlc3Rpb25DbGlja2VkOiBmdW5jdGlvbiBvblN1Z2dlc3Rpb25DbGlja2VkKHR5cGUsICRlbCkgewogICAgICAgICAgICAgICAgdmFyIGRhdHVtOwogICAgICAgICAgICAgICAgaWYgKGRhdHVtID0gdGhpcy5kcm9wZG93bi5nZXREYXR1bUZvclN1Z2dlc3Rpb24oJGVsKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX3NlbGVjdChkYXR1bSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9vbkN1cnNvck1vdmVkOiBmdW5jdGlvbiBvbkN1cnNvck1vdmVkKCkgewogICAgICAgICAgICAgICAgdmFyIGRhdHVtID0gdGhpcy5kcm9wZG93bi5nZXREYXR1bUZvckN1cnNvcigpOwogICAgICAgICAgICAgICAgdGhpcy5pbnB1dC5zZXRJbnB1dFZhbHVlKGRhdHVtLnZhbHVlLCB0cnVlKTsKICAgICAgICAgICAgICAgIHRoaXMuZXZlbnRCdXMudHJpZ2dlcigiY3Vyc29yY2hhbmdlZCIsIGRhdHVtLnJhdywgZGF0dW0uZGF0YXNldE5hbWUpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfb25DdXJzb3JSZW1vdmVkOiBmdW5jdGlvbiBvbkN1cnNvclJlbW92ZWQoKSB7CiAgICAgICAgICAgICAgICB0aGlzLmlucHV0LnJlc2V0SW5wdXRWYWx1ZSgpOwogICAgICAgICAgICAgICAgdGhpcy5fdXBkYXRlSGludCgpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfb25EYXRhc2V0UmVuZGVyZWQ6IGZ1bmN0aW9uIG9uRGF0YXNldFJlbmRlcmVkKCkgewogICAgICAgICAgICAgICAgdGhpcy5fdXBkYXRlSGludCgpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfb25PcGVuZWQ6IGZ1bmN0aW9uIG9uT3BlbmVkKCkgewogICAgICAgICAgICAgICAgdGhpcy5fdXBkYXRlSGludCgpOwogICAgICAgICAgICAgICAgdGhpcy5ldmVudEJ1cy50cmlnZ2VyKCJvcGVuZWQiKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX29uQ2xvc2VkOiBmdW5jdGlvbiBvbkNsb3NlZCgpIHsKICAgICAgICAgICAgICAgIHRoaXMuaW5wdXQuY2xlYXJIaW50KCk7CiAgICAgICAgICAgICAgICB0aGlzLmV2ZW50QnVzLnRyaWdnZXIoImNsb3NlZCIpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfb25Gb2N1c2VkOiBmdW5jdGlvbiBvbkZvY3VzZWQoKSB7CiAgICAgICAgICAgICAgICB0aGlzLmlzQWN0aXZhdGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHRoaXMuZHJvcGRvd24ub3BlbigpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfb25CbHVycmVkOiBmdW5jdGlvbiBvbkJsdXJyZWQoKSB7CiAgICAgICAgICAgICAgICB0aGlzLmlzQWN0aXZhdGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICB0aGlzLmRyb3Bkb3duLmVtcHR5KCk7CiAgICAgICAgICAgICAgICB0aGlzLmRyb3Bkb3duLmNsb3NlKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9vbkVudGVyS2V5ZWQ6IGZ1bmN0aW9uIG9uRW50ZXJLZXllZCh0eXBlLCAkZSkgewogICAgICAgICAgICAgICAgdmFyIGN1cnNvckRhdHVtLCB0b3BTdWdnZXN0aW9uRGF0dW07CiAgICAgICAgICAgICAgICBjdXJzb3JEYXR1bSA9IHRoaXMuZHJvcGRvd24uZ2V0RGF0dW1Gb3JDdXJzb3IoKTsKICAgICAgICAgICAgICAgIHRvcFN1Z2dlc3Rpb25EYXR1bSA9IHRoaXMuZHJvcGRvd24uZ2V0RGF0dW1Gb3JUb3BTdWdnZXN0aW9uKCk7CiAgICAgICAgICAgICAgICBpZiAoY3Vyc29yRGF0dW0pIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9zZWxlY3QoY3Vyc29yRGF0dW0pOwogICAgICAgICAgICAgICAgICAgICRlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuYXV0b3NlbGVjdCAmJiB0b3BTdWdnZXN0aW9uRGF0dW0pIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9zZWxlY3QodG9wU3VnZ2VzdGlvbkRhdHVtKTsKICAgICAgICAgICAgICAgICAgICAkZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBfb25UYWJLZXllZDogZnVuY3Rpb24gb25UYWJLZXllZCh0eXBlLCAkZSkgewogICAgICAgICAgICAgICAgdmFyIGRhdHVtOwogICAgICAgICAgICAgICAgaWYgKGRhdHVtID0gdGhpcy5kcm9wZG93bi5nZXREYXR1bUZvckN1cnNvcigpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2VsZWN0KGRhdHVtKTsKICAgICAgICAgICAgICAgICAgICAkZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9hdXRvY29tcGxldGUodHJ1ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9vbkVzY0tleWVkOiBmdW5jdGlvbiBvbkVzY0tleWVkKCkgewogICAgICAgICAgICAgICAgdGhpcy5kcm9wZG93bi5jbG9zZSgpOwogICAgICAgICAgICAgICAgdGhpcy5pbnB1dC5yZXNldElucHV0VmFsdWUoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX29uVXBLZXllZDogZnVuY3Rpb24gb25VcEtleWVkKCkgewogICAgICAgICAgICAgICAgdmFyIHF1ZXJ5ID0gdGhpcy5pbnB1dC5nZXRRdWVyeSgpOwogICAgICAgICAgICAgICAgdGhpcy5kcm9wZG93bi5pc0VtcHR5ICYmIHF1ZXJ5Lmxlbmd0aCA+PSB0aGlzLm1pbkxlbmd0aCA/IHRoaXMuZHJvcGRvd24udXBkYXRlKHF1ZXJ5KSA6IHRoaXMuZHJvcGRvd24ubW92ZUN1cnNvclVwKCk7CiAgICAgICAgICAgICAgICB0aGlzLmRyb3Bkb3duLm9wZW4oKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX29uRG93bktleWVkOiBmdW5jdGlvbiBvbkRvd25LZXllZCgpIHsKICAgICAgICAgICAgICAgIHZhciBxdWVyeSA9IHRoaXMuaW5wdXQuZ2V0UXVlcnkoKTsKICAgICAgICAgICAgICAgIHRoaXMuZHJvcGRvd24uaXNFbXB0eSAmJiBxdWVyeS5sZW5ndGggPj0gdGhpcy5taW5MZW5ndGggPyB0aGlzLmRyb3Bkb3duLnVwZGF0ZShxdWVyeSkgOiB0aGlzLmRyb3Bkb3duLm1vdmVDdXJzb3JEb3duKCk7CiAgICAgICAgICAgICAgICB0aGlzLmRyb3Bkb3duLm9wZW4oKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX29uTGVmdEtleWVkOiBmdW5jdGlvbiBvbkxlZnRLZXllZCgpIHsKICAgICAgICAgICAgICAgIHRoaXMuZGlyID09PSAicnRsIiAmJiB0aGlzLl9hdXRvY29tcGxldGUoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX29uUmlnaHRLZXllZDogZnVuY3Rpb24gb25SaWdodEtleWVkKCkgewogICAgICAgICAgICAgICAgdGhpcy5kaXIgPT09ICJsdHIiICYmIHRoaXMuX2F1dG9jb21wbGV0ZSgpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfb25RdWVyeUNoYW5nZWQ6IGZ1bmN0aW9uIG9uUXVlcnlDaGFuZ2VkKGUsIHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICB0aGlzLmlucHV0LmNsZWFySGludElmSW52YWxpZCgpOwogICAgICAgICAgICAgICAgcXVlcnkubGVuZ3RoID49IHRoaXMubWluTGVuZ3RoID8gdGhpcy5kcm9wZG93bi51cGRhdGUocXVlcnkpIDogdGhpcy5kcm9wZG93bi5lbXB0eSgpOwogICAgICAgICAgICAgICAgdGhpcy5kcm9wZG93bi5vcGVuKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9zZXRMYW5ndWFnZURpcmVjdGlvbigpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfb25XaGl0ZXNwYWNlQ2hhbmdlZDogZnVuY3Rpb24gb25XaGl0ZXNwYWNlQ2hhbmdlZCgpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3VwZGF0ZUhpbnQoKTsKICAgICAgICAgICAgICAgIHRoaXMuZHJvcGRvd24ub3BlbigpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfc2V0TGFuZ3VhZ2VEaXJlY3Rpb246IGZ1bmN0aW9uIHNldExhbmd1YWdlRGlyZWN0aW9uKCkgewogICAgICAgICAgICAgICAgdmFyIGRpcjsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmRpciAhPT0gKGRpciA9IHRoaXMuaW5wdXQuZ2V0TGFuZ3VhZ2VEaXJlY3Rpb24oKSkpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmRpciA9IGRpcjsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRub2RlLmNzcygiZGlyZWN0aW9uIiwgZGlyKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmRyb3Bkb3duLnNldExhbmd1YWdlRGlyZWN0aW9uKGRpcik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF91cGRhdGVIaW50OiBmdW5jdGlvbiB1cGRhdGVIaW50KCkgewogICAgICAgICAgICAgICAgdmFyIGRhdHVtLCB2YWwsIHF1ZXJ5LCBlc2NhcGVkUXVlcnksIGZyb250TWF0Y2hSZWdFeCwgbWF0Y2g7CiAgICAgICAgICAgICAgICBkYXR1bSA9IHRoaXMuZHJvcGRvd24uZ2V0RGF0dW1Gb3JUb3BTdWdnZXN0aW9uKCk7CiAgICAgICAgICAgICAgICBpZiAoZGF0dW0gJiYgdGhpcy5kcm9wZG93bi5pc1Zpc2libGUoKSAmJiAhdGhpcy5pbnB1dC5oYXNPdmVyZmxvdygpKSB7CiAgICAgICAgICAgICAgICAgICAgdmFsID0gdGhpcy5pbnB1dC5nZXRJbnB1dFZhbHVlKCk7CiAgICAgICAgICAgICAgICAgICAgcXVlcnkgPSBJbnB1dC5ub3JtYWxpemVRdWVyeSh2YWwpOwogICAgICAgICAgICAgICAgICAgIGVzY2FwZWRRdWVyeSA9IF8uZXNjYXBlUmVnRXhDaGFycyhxdWVyeSk7CiAgICAgICAgICAgICAgICAgICAgZnJvbnRNYXRjaFJlZ0V4ID0gbmV3IFJlZ0V4cCgiXig/OiIgKyBlc2NhcGVkUXVlcnkgKyAiKSguKyQpIiwgImkiKTsKICAgICAgICAgICAgICAgICAgICBtYXRjaCA9IGZyb250TWF0Y2hSZWdFeC5leGVjKGRhdHVtLnZhbHVlKTsKICAgICAgICAgICAgICAgICAgICBtYXRjaCA/IHRoaXMuaW5wdXQuc2V0SGludCh2YWwgKyBtYXRjaFsxXSkgOiB0aGlzLmlucHV0LmNsZWFySGludCgpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmlucHV0LmNsZWFySGludCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBfYXV0b2NvbXBsZXRlOiBmdW5jdGlvbiBhdXRvY29tcGxldGUobGF4Q3Vyc29yKSB7CiAgICAgICAgICAgICAgICB2YXIgaGludCwgcXVlcnksIGlzQ3Vyc29yQXRFbmQsIGRhdHVtOwogICAgICAgICAgICAgICAgaGludCA9IHRoaXMuaW5wdXQuZ2V0SGludCgpOwogICAgICAgICAgICAgICAgcXVlcnkgPSB0aGlzLmlucHV0LmdldFF1ZXJ5KCk7CiAgICAgICAgICAgICAgICBpc0N1cnNvckF0RW5kID0gbGF4Q3Vyc29yIHx8IHRoaXMuaW5wdXQuaXNDdXJzb3JBdEVuZCgpOwogICAgICAgICAgICAgICAgaWYgKGhpbnQgJiYgcXVlcnkgIT09IGhpbnQgJiYgaXNDdXJzb3JBdEVuZCkgewogICAgICAgICAgICAgICAgICAgIGRhdHVtID0gdGhpcy5kcm9wZG93bi5nZXREYXR1bUZvclRvcFN1Z2dlc3Rpb24oKTsKICAgICAgICAgICAgICAgICAgICBkYXR1bSAmJiB0aGlzLmlucHV0LnNldElucHV0VmFsdWUoZGF0dW0udmFsdWUpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZXZlbnRCdXMudHJpZ2dlcigiYXV0b2NvbXBsZXRlZCIsIGRhdHVtLnJhdywgZGF0dW0uZGF0YXNldE5hbWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBfc2VsZWN0OiBmdW5jdGlvbiBzZWxlY3QoZGF0dW0pIHsKICAgICAgICAgICAgICAgIHRoaXMuaW5wdXQuc2V0UXVlcnkoZGF0dW0udmFsdWUpOwogICAgICAgICAgICAgICAgdGhpcy5pbnB1dC5zZXRJbnB1dFZhbHVlKGRhdHVtLnZhbHVlLCB0cnVlKTsKICAgICAgICAgICAgICAgIHRoaXMuX3NldExhbmd1YWdlRGlyZWN0aW9uKCk7CiAgICAgICAgICAgICAgICB0aGlzLmV2ZW50QnVzLnRyaWdnZXIoInNlbGVjdGVkIiwgZGF0dW0ucmF3LCBkYXR1bS5kYXRhc2V0TmFtZSk7CiAgICAgICAgICAgICAgICB0aGlzLmRyb3Bkb3duLmNsb3NlKCk7CiAgICAgICAgICAgICAgICBfLmRlZmVyKF8uYmluZCh0aGlzLmRyb3Bkb3duLmVtcHR5LCB0aGlzLmRyb3Bkb3duKSk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG9wZW46IGZ1bmN0aW9uIG9wZW4oKSB7CiAgICAgICAgICAgICAgICB0aGlzLmRyb3Bkb3duLm9wZW4oKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgY2xvc2U6IGZ1bmN0aW9uIGNsb3NlKCkgewogICAgICAgICAgICAgICAgdGhpcy5kcm9wZG93bi5jbG9zZSgpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBzZXRWYWw6IGZ1bmN0aW9uIHNldFZhbCh2YWwpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzQWN0aXZhdGVkKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnB1dC5zZXRJbnB1dFZhbHVlKHZhbCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRoaXMuaW5wdXQuc2V0UXVlcnkodmFsKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmlucHV0LnNldElucHV0VmFsdWUodmFsLCB0cnVlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuX3NldExhbmd1YWdlRGlyZWN0aW9uKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGdldFZhbDogZnVuY3Rpb24gZ2V0VmFsKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaW5wdXQuZ2V0UXVlcnkoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZGVzdHJveTogZnVuY3Rpb24gZGVzdHJveSgpIHsKICAgICAgICAgICAgICAgIHRoaXMuaW5wdXQuZGVzdHJveSgpOwogICAgICAgICAgICAgICAgdGhpcy5kcm9wZG93bi5kZXN0cm95KCk7CiAgICAgICAgICAgICAgICBkZXN0cm95RG9tU3RydWN0dXJlKHRoaXMuJG5vZGUpOwogICAgICAgICAgICAgICAgdGhpcy4kbm9kZSA9IG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICByZXR1cm4gVHlwZWFoZWFkOwogICAgICAgIGZ1bmN0aW9uIGJ1aWxkRG9tU3RydWN0dXJlKGlucHV0LCB3aXRoSGludCkgewogICAgICAgICAgICB2YXIgJGlucHV0LCAkd3JhcHBlciwgJGRyb3Bkb3duLCAkaGludDsKICAgICAgICAgICAgJGlucHV0ID0gJChpbnB1dCk7CiAgICAgICAgICAgICR3cmFwcGVyID0gJChodG1sLndyYXBwZXIpLmNzcyhjc3Mud3JhcHBlcik7CiAgICAgICAgICAgICRkcm9wZG93biA9ICQoaHRtbC5kcm9wZG93bikuY3NzKGNzcy5kcm9wZG93bik7CiAgICAgICAgICAgICRoaW50ID0gJGlucHV0LmNsb25lKCkuY3NzKGNzcy5oaW50KS5jc3MoZ2V0QmFja2dyb3VuZFN0eWxlcygkaW5wdXQpKTsKICAgICAgICAgICAgJGhpbnQudmFsKCIiKS5yZW1vdmVEYXRhKCkuYWRkQ2xhc3MoInR0LWhpbnQiKS5yZW1vdmVBdHRyKCJpZCBuYW1lIHBsYWNlaG9sZGVyIikucHJvcCgiZGlzYWJsZWQiLCB0cnVlKS5hdHRyKHsKICAgICAgICAgICAgICAgIGF1dG9jb21wbGV0ZTogIm9mZiIsCiAgICAgICAgICAgICAgICBzcGVsbGNoZWNrOiAiZmFsc2UiCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAkaW5wdXQuZGF0YShhdHRyc0tleSwgewogICAgICAgICAgICAgICAgZGlyOiAkaW5wdXQuYXR0cigiZGlyIiksCiAgICAgICAgICAgICAgICBhdXRvY29tcGxldGU6ICRpbnB1dC5hdHRyKCJhdXRvY29tcGxldGUiKSwKICAgICAgICAgICAgICAgIHNwZWxsY2hlY2s6ICRpbnB1dC5hdHRyKCJzcGVsbGNoZWNrIiksCiAgICAgICAgICAgICAgICBzdHlsZTogJGlucHV0LmF0dHIoInN0eWxlIikKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICRpbnB1dC5hZGRDbGFzcygidHQtaW5wdXQiKS5hdHRyKHsKICAgICAgICAgICAgICAgIGF1dG9jb21wbGV0ZTogIm9mZiIsCiAgICAgICAgICAgICAgICBzcGVsbGNoZWNrOiBmYWxzZQogICAgICAgICAgICB9KS5jc3Mod2l0aEhpbnQgPyBjc3MuaW5wdXQgOiBjc3MuaW5wdXRXaXRoTm9IaW50KTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICEkaW5wdXQuYXR0cigiZGlyIikgJiYgJGlucHV0LmF0dHIoImRpciIsICJhdXRvIik7CiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHt9CiAgICAgICAgICAgIHJldHVybiAkaW5wdXQud3JhcCgkd3JhcHBlcikucGFyZW50KCkucHJlcGVuZCh3aXRoSGludCA/ICRoaW50IDogbnVsbCkuYXBwZW5kKCRkcm9wZG93bik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGdldEJhY2tncm91bmRTdHlsZXMoJGVsKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQXR0YWNobWVudDogJGVsLmNzcygiYmFja2dyb3VuZC1hdHRhY2htZW50IiksCiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ2xpcDogJGVsLmNzcygiYmFja2dyb3VuZC1jbGlwIiksCiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICRlbC5jc3MoImJhY2tncm91bmQtY29sb3IiKSwKICAgICAgICAgICAgICAgIGJhY2tncm91bmRJbWFnZTogJGVsLmNzcygiYmFja2dyb3VuZC1pbWFnZSIpLAogICAgICAgICAgICAgICAgYmFja2dyb3VuZE9yaWdpbjogJGVsLmNzcygiYmFja2dyb3VuZC1vcmlnaW4iKSwKICAgICAgICAgICAgICAgIGJhY2tncm91bmRQb3NpdGlvbjogJGVsLmNzcygiYmFja2dyb3VuZC1wb3NpdGlvbiIpLAogICAgICAgICAgICAgICAgYmFja2dyb3VuZFJlcGVhdDogJGVsLmNzcygiYmFja2dyb3VuZC1yZXBlYXQiKSwKICAgICAgICAgICAgICAgIGJhY2tncm91bmRTaXplOiAkZWwuY3NzKCJiYWNrZ3JvdW5kLXNpemUiKQogICAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBkZXN0cm95RG9tU3RydWN0dXJlKCRub2RlKSB7CiAgICAgICAgICAgIHZhciAkaW5wdXQgPSAkbm9kZS5maW5kKCIudHQtaW5wdXQiKTsKICAgICAgICAgICAgXy5lYWNoKCRpbnB1dC5kYXRhKGF0dHJzS2V5KSwgZnVuY3Rpb24odmFsLCBrZXkpIHsKICAgICAgICAgICAgICAgIF8uaXNVbmRlZmluZWQodmFsKSA/ICRpbnB1dC5yZW1vdmVBdHRyKGtleSkgOiAkaW5wdXQuYXR0cihrZXksIHZhbCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAkaW5wdXQuZGV0YWNoKCkucmVtb3ZlRGF0YShhdHRyc0tleSkucmVtb3ZlQ2xhc3MoInR0LWlucHV0IikuaW5zZXJ0QWZ0ZXIoJG5vZGUpOwogICAgICAgICAgICAkbm9kZS5yZW1vdmUoKTsKICAgICAgICB9CiAgICB9KCk7CiAgICAoZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIG9sZCwgdHlwZWFoZWFkS2V5LCBtZXRob2RzOwogICAgICAgIG9sZCA9ICQuZm4udHlwZWFoZWFkOwogICAgICAgIHR5cGVhaGVhZEtleSA9ICJ0dFR5cGVhaGVhZCI7CiAgICAgICAgbWV0aG9kcyA9IHsKICAgICAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gaW5pdGlhbGl6ZShvLCBkYXRhc2V0cykgewogICAgICAgICAgICAgICAgZGF0YXNldHMgPSBfLmlzQXJyYXkoZGF0YXNldHMpID8gZGF0YXNldHMgOiBbXS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSk7CiAgICAgICAgICAgICAgICBvID0gbyB8fCB7fTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goYXR0YWNoKTsKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGF0dGFjaCgpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgJGlucHV0ID0gJCh0aGlzKSwgZXZlbnRCdXMsIHR5cGVhaGVhZDsKICAgICAgICAgICAgICAgICAgICBfLmVhY2goZGF0YXNldHMsIGZ1bmN0aW9uKGQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZC5oaWdobGlnaHQgPSAhIW8uaGlnaGxpZ2h0OwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHR5cGVhaGVhZCA9IG5ldyBUeXBlYWhlYWQoewogICAgICAgICAgICAgICAgICAgICAgICBpbnB1dDogJGlucHV0LAogICAgICAgICAgICAgICAgICAgICAgICBldmVudEJ1czogZXZlbnRCdXMgPSBuZXcgRXZlbnRCdXMoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWw6ICRpbnB1dAogICAgICAgICAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgd2l0aEhpbnQ6IF8uaXNVbmRlZmluZWQoby5oaW50KSA/IHRydWUgOiAhIW8uaGludCwKICAgICAgICAgICAgICAgICAgICAgICAgbWluTGVuZ3RoOiBvLm1pbkxlbmd0aCwKICAgICAgICAgICAgICAgICAgICAgICAgYXV0b3NlbGVjdDogby5hdXRvc2VsZWN0LAogICAgICAgICAgICAgICAgICAgICAgICBkYXRhc2V0czogZGF0YXNldHMKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAkaW5wdXQuZGF0YSh0eXBlYWhlYWRLZXksIHR5cGVhaGVhZCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG9wZW46IGZ1bmN0aW9uIG9wZW4oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKG9wZW5UeXBlYWhlYWQpOwogICAgICAgICAgICAgICAgZnVuY3Rpb24gb3BlblR5cGVhaGVhZCgpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgJGlucHV0ID0gJCh0aGlzKSwgdHlwZWFoZWFkOwogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlYWhlYWQgPSAkaW5wdXQuZGF0YSh0eXBlYWhlYWRLZXkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVhaGVhZC5vcGVuKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBjbG9zZTogZnVuY3Rpb24gY2xvc2UoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGNsb3NlVHlwZWFoZWFkKTsKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGNsb3NlVHlwZWFoZWFkKCkgewogICAgICAgICAgICAgICAgICAgIHZhciAkaW5wdXQgPSAkKHRoaXMpLCB0eXBlYWhlYWQ7CiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVhaGVhZCA9ICRpbnB1dC5kYXRhKHR5cGVhaGVhZEtleSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZWFoZWFkLmNsb3NlKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICB2YWw6IGZ1bmN0aW9uIHZhbChuZXdWYWwpIHsKICAgICAgICAgICAgICAgIHJldHVybiAhYXJndW1lbnRzLmxlbmd0aCA/IGdldFZhbCh0aGlzLmZpcnN0KCkpIDogdGhpcy5lYWNoKHNldFZhbCk7CiAgICAgICAgICAgICAgICBmdW5jdGlvbiBzZXRWYWwoKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyICRpbnB1dCA9ICQodGhpcyksIHR5cGVhaGVhZDsKICAgICAgICAgICAgICAgICAgICBpZiAodHlwZWFoZWFkID0gJGlucHV0LmRhdGEodHlwZWFoZWFkS2V5KSkgewogICAgICAgICAgICAgICAgICAgICAgICB0eXBlYWhlYWQuc2V0VmFsKG5ld1ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZnVuY3Rpb24gZ2V0VmFsKCRpbnB1dCkgewogICAgICAgICAgICAgICAgICAgIHZhciB0eXBlYWhlYWQsIHF1ZXJ5OwogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlYWhlYWQgPSAkaW5wdXQuZGF0YSh0eXBlYWhlYWRLZXkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXJ5ID0gdHlwZWFoZWFkLmdldFZhbCgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gcXVlcnk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uIGRlc3Ryb3koKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKHVuYXR0YWNoKTsKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHVuYXR0YWNoKCkgewogICAgICAgICAgICAgICAgICAgIHZhciAkaW5wdXQgPSAkKHRoaXMpLCB0eXBlYWhlYWQ7CiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVhaGVhZCA9ICRpbnB1dC5kYXRhKHR5cGVhaGVhZEtleSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZWFoZWFkLmRlc3Ryb3koKTsKICAgICAgICAgICAgICAgICAgICAgICAgJGlucHV0LnJlbW92ZURhdGEodHlwZWFoZWFkS2V5KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgICQuZm4udHlwZWFoZWFkID0gZnVuY3Rpb24obWV0aG9kKSB7CiAgICAgICAgICAgIGlmIChtZXRob2RzW21ldGhvZF0pIHsKICAgICAgICAgICAgICAgIHJldHVybiBtZXRob2RzW21ldGhvZF0uYXBwbHkodGhpcywgW10uc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBtZXRob2RzLmluaXRpYWxpemUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgJC5mbi50eXBlYWhlYWQubm9Db25mbGljdCA9IGZ1bmN0aW9uIG5vQ29uZmxpY3QoKSB7CiAgICAgICAgICAgICQuZm4udHlwZWFoZWFkID0gb2xkOwogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9OwogICAgfSkoKTsKfSkod2luZG93LmpRdWVyeSk7CmRlZmluZSgidHlwZWFoZWFkIiwgZnVuY3Rpb24oKXt9KTsKCi8qIQogKiBqUXVlcnkgQ29va2llIFBsdWdpbiB2MS40LjEKICogaHR0cHM6Ly9naXRodWIuY29tL2NhcmhhcnRsL2pxdWVyeS1jb29raWUKICoKICogQ29weXJpZ2h0IDIwMTMgS2xhdXMgSGFydGwKICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlCiAqLwooZnVuY3Rpb24gKGZhY3RvcnkpIHsKCWlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHsKCQkvLyBBTUQKCQlkZWZpbmUoJ2pRdWVyeUNvb2tpZScsWydqcXVlcnknXSwgZmFjdG9yeSk7Cgl9IGVsc2UgaWYgKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JykgewoJCS8vIENvbW1vbkpTCgkJZmFjdG9yeShyZXF1aXJlKCdqcXVlcnknKSk7Cgl9IGVsc2UgewoJCS8vIEJyb3dzZXIgZ2xvYmFscwoJCWZhY3RvcnkoalF1ZXJ5KTsKCX0KfShmdW5jdGlvbiAoJCkgewoKCXZhciBwbHVzZXMgPSAvXCsvZzsKCglmdW5jdGlvbiBlbmNvZGUocykgewoJCXJldHVybiBjb25maWcucmF3ID8gcyA6IGVuY29kZVVSSUNvbXBvbmVudChzKTsKCX0KCglmdW5jdGlvbiBkZWNvZGUocykgewoJCXJldHVybiBjb25maWcucmF3ID8gcyA6IGRlY29kZVVSSUNvbXBvbmVudChzKTsKCX0KCglmdW5jdGlvbiBzdHJpbmdpZnlDb29raWVWYWx1ZSh2YWx1ZSkgewoJCXJldHVybiBlbmNvZGUoY29uZmlnLmpzb24gPyBKU09OLnN0cmluZ2lmeSh2YWx1ZSkgOiBTdHJpbmcodmFsdWUpKTsKCX0KCglmdW5jdGlvbiBwYXJzZUNvb2tpZVZhbHVlKHMpIHsKCQlpZiAocy5pbmRleE9mKCciJykgPT09IDApIHsKCQkJLy8gVGhpcyBpcyBhIHF1b3RlZCBjb29raWUgYXMgYWNjb3JkaW5nIHRvIFJGQzIwNjgsIHVuZXNjYXBlLi4uCgkJCXMgPSBzLnNsaWNlKDEsIC0xKS5yZXBsYWNlKC9cXCIvZywgJyInKS5yZXBsYWNlKC9cXFxcL2csICdcXCcpOwoJCX0KCgkJdHJ5IHsKCQkJLy8gUmVwbGFjZSBzZXJ2ZXItc2lkZSB3cml0dGVuIHBsdXNlcyB3aXRoIHNwYWNlcy4KCQkJLy8gSWYgd2UgY2FuJ3QgZGVjb2RlIHRoZSBjb29raWUsIGlnbm9yZSBpdCwgaXQncyB1bnVzYWJsZS4KCQkJLy8gSWYgd2UgY2FuJ3QgcGFyc2UgdGhlIGNvb2tpZSwgaWdub3JlIGl0LCBpdCdzIHVudXNhYmxlLgoJCQlzID0gZGVjb2RlVVJJQ29tcG9uZW50KHMucmVwbGFjZShwbHVzZXMsICcgJykpOwoJCQlyZXR1cm4gY29uZmlnLmpzb24gPyBKU09OLnBhcnNlKHMpIDogczsKCQl9IGNhdGNoKGUpIHt9Cgl9CgoJZnVuY3Rpb24gcmVhZChzLCBjb252ZXJ0ZXIpIHsKCQl2YXIgdmFsdWUgPSBjb25maWcucmF3ID8gcyA6IHBhcnNlQ29va2llVmFsdWUocyk7CgkJcmV0dXJuICQuaXNGdW5jdGlvbihjb252ZXJ0ZXIpID8gY29udmVydGVyKHZhbHVlKSA6IHZhbHVlOwoJfQoKCXZhciBjb25maWcgPSAkLmNvb2tpZSA9IGZ1bmN0aW9uIChrZXksIHZhbHVlLCBvcHRpb25zKSB7CgoJCS8vIFdyaXRlCgoJCWlmICh2YWx1ZSAhPT0gdW5kZWZpbmVkICYmICEkLmlzRnVuY3Rpb24odmFsdWUpKSB7CgkJCW9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgY29uZmlnLmRlZmF1bHRzLCBvcHRpb25zKTsKCgkJCWlmICh0eXBlb2Ygb3B0aW9ucy5leHBpcmVzID09PSAnbnVtYmVyJykgewoJCQkJdmFyIGRheXMgPSBvcHRpb25zLmV4cGlyZXMsIHQgPSBvcHRpb25zLmV4cGlyZXMgPSBuZXcgRGF0ZSgpOwoJCQkJdC5zZXRUaW1lKCt0ICsgZGF5cyAqIDg2NGUrNSk7CgkJCX0KCgkJCXJldHVybiAoZG9jdW1lbnQuY29va2llID0gWwoJCQkJZW5jb2RlKGtleSksICc9Jywgc3RyaW5naWZ5Q29va2llVmFsdWUodmFsdWUpLAoJCQkJb3B0aW9ucy5leHBpcmVzID8gJzsgZXhwaXJlcz0nICsgb3B0aW9ucy5leHBpcmVzLnRvVVRDU3RyaW5nKCkgOiAnJywgLy8gdXNlIGV4cGlyZXMgYXR0cmlidXRlLCBtYXgtYWdlIGlzIG5vdCBzdXBwb3J0ZWQgYnkgSUUKCQkJCW9wdGlvbnMucGF0aCAgICA/ICc7IHBhdGg9JyArIG9wdGlvbnMucGF0aCA6ICcnLAoJCQkJb3B0aW9ucy5kb21haW4gID8gJzsgZG9tYWluPScgKyBvcHRpb25zLmRvbWFpbiA6ICcnLAoJCQkJb3B0aW9ucy5zZWN1cmUgID8gJzsgc2VjdXJlJyA6ICcnCgkJCV0uam9pbignJykpOwoJCX0KCgkJLy8gUmVhZAoKCQl2YXIgcmVzdWx0ID0ga2V5ID8gdW5kZWZpbmVkIDoge307CgoJCS8vIFRvIHByZXZlbnQgdGhlIGZvciBsb29wIGluIHRoZSBmaXJzdCBwbGFjZSBhc3NpZ24gYW4gZW1wdHkgYXJyYXkKCQkvLyBpbiBjYXNlIHRoZXJlIGFyZSBubyBjb29raWVzIGF0IGFsbC4gQWxzbyBwcmV2ZW50cyBvZGQgcmVzdWx0IHdoZW4KCQkvLyBjYWxsaW5nICQuY29va2llKCkuCgkJdmFyIGNvb2tpZXMgPSBkb2N1bWVudC5jb29raWUgPyBkb2N1bWVudC5jb29raWUuc3BsaXQoJzsgJykgOiBbXTsKCgkJZm9yICh2YXIgaSA9IDAsIGwgPSBjb29raWVzLmxlbmd0aDsgaSA8IGw7IGkrKykgewoJCQl2YXIgcGFydHMgPSBjb29raWVzW2ldLnNwbGl0KCc9Jyk7CgkJCXZhciBuYW1lID0gZGVjb2RlKHBhcnRzLnNoaWZ0KCkpOwoJCQl2YXIgY29va2llID0gcGFydHMuam9pbignPScpOwoKCQkJaWYgKGtleSAmJiBrZXkgPT09IG5hbWUpIHsKCQkJCS8vIElmIHNlY29uZCBhcmd1bWVudCAodmFsdWUpIGlzIGEgZnVuY3Rpb24gaXQncyBhIGNvbnZlcnRlci4uLgoJCQkJcmVzdWx0ID0gcmVhZChjb29raWUsIHZhbHVlKTsKCQkJCWJyZWFrOwoJCQl9CgoJCQkvLyBQcmV2ZW50IHN0b3JpbmcgYSBjb29raWUgdGhhdCB3ZSBjb3VsZG4ndCBkZWNvZGUuCgkJCWlmICgha2V5ICYmIChjb29raWUgPSByZWFkKGNvb2tpZSkpICE9PSB1bmRlZmluZWQpIHsKCQkJCXJlc3VsdFtuYW1lXSA9IGNvb2tpZTsKCQkJfQoJCX0KCgkJcmV0dXJuIHJlc3VsdDsKCX07CgoJY29uZmlnLmRlZmF1bHRzID0ge307CgoJJC5yZW1vdmVDb29raWUgPSBmdW5jdGlvbiAoa2V5LCBvcHRpb25zKSB7CgkJaWYgKCQuY29va2llKGtleSkgPT09IHVuZGVmaW5lZCkgewoJCQlyZXR1cm4gZmFsc2U7CgkJfQoKCQkvLyBNdXN0IG5vdCBhbHRlciBvcHRpb25zLCB0aHVzIGV4dGVuZGluZyBhIGZyZXNoIG9iamVjdC4uLgoJCSQuY29va2llKGtleSwgJycsICQuZXh0ZW5kKHt9LCBvcHRpb25zLCB7IGV4cGlyZXM6IC0xIH0pKTsKCQlyZXR1cm4gISQuY29va2llKGtleSk7Cgl9OwoKfSkpOwoKLyoKICogZ2l2ZW4gYSBwYXJ0aWFsIFJpY2hTZXF1ZW5jZSBzdHJpbmcsIHJldHVybiB2YWx1ZSBhdXRvY29tcGxldGlvbiB2YWx1ZXMuCiAqIFRoaXMgY2FuIGNvdmVyOgogKiAtIGdpdmUgbWUgYSBudW1lcmljYWwgdmFsdWUsIEknbGwgcmV0dXJuIGNsb3NlIG1vZGlmaWNhdGlvbiBsaXN0CiAqIC0gZ2l2ZSBtZSBhIHBhcnRpYWwgbW9kaWZpY2F0aW9uIG5hbWUsIEknbGwgc2hvb3QgdGhlIG1hdGNoaW5nIG1vZGlmaWNhdGlvbnMKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCmRlZmluZSgnZmlzaHRvbmVzL3NlcnZpY2VzL2RyeS9SaWNoU2VxdWVuY2VBdXRvQ29tcGxldGlvbmVyJyxbJ2pxdWVyeScsICd1bmRlcnNjb3JlJywgJ0JhY2tib25lJywgJ2Zpc2h0b25lcy9jb2xsZWN0aW9ucy9kcnkvQW1pbm9BY2lkRGljdGlvbmFyeScsICdmaXNodG9uZXMvY29sbGVjdGlvbnMvZHJ5L1Jlc2lkdWVNb2RpZmljYXRpb25EaWN0aW9uYXJ5J10sIGZ1bmN0aW9uICgkLCBfLCBCYWNrYm9uZSwgZGljb0FBLCBkaWNvUmVzTW9kKSB7CgogICAgdmFyIFJpY2hTZXF1ZW5jZUF1dG9Db21wbGV0aW9uZXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgIHNlbGYubW9kaWZOYW1lcyA9IF8uY2hhaW4oZGljb1Jlc01vZC5tb2RlbHMpLmNvbGxlY3QoZnVuY3Rpb24gKHJtKSB7CiAgICAgICAgICAgIHJldHVybiBybS5nZXQoJ25hbWUnKQogICAgICAgIH0pLnNvcnQoKS52YWx1ZSgpOwoKICAgICAgICBzZWxmLm1vZGlmMm1hc3MgPSB7fQogICAgICAgIF8uZWFjaChkaWNvUmVzTW9kLm1vZGVscywgZnVuY3Rpb24gKHJtKSB7CiAgICAgICAgICAgIHNlbGYubW9kaWYybWFzc1tybS5nZXQoJ25hbWUnKV0gPSBybS5nZXQoJ21hc3MnKQogICAgICAgIH0pCiAgICB9OwoKICAgIC8qKgogICAgICogcmV0dXJuIGEgdHJ1ZSB2YWx1ZSBpZiB0aGUgY3VycmVudCB0aGVyZSBpcyBub3QgY2xvc2VlZCBjdXJseSBicmFja2V0IGJlZm9yZSB0aGUgbmV4dCBvcGVuIG9yIHRoZSBlbmQKICAgICAqIChpLmUuLCBpZiB3ZSBjYWxsIHRoYXQgZnVuY2l0b24gZnRlciBvcGVuaW5nIGEgY3VscnksIGl0IHdpbGwgdXMgaWYgd2Ugc2hhbGwgYWRkIGEgY29zZSBvbmUpCiAgICAgKiBAcGFyYW0ge09iamVjdH0gdHh0CiAgICAgKiBAcGFyYW0ge09iamVjdH0gcG9zCiAgICAgKi8KICAgIFJpY2hTZXF1ZW5jZUF1dG9Db21wbGV0aW9uZXIucHJvdG90eXBlLmNsb3NlQ3VybHkgPSBmdW5jdGlvbiAodHh0LCBwb3MpIHsKICAgICAgICB2YXIgdGFpbCA9IHR4dC5zdWJzdHJpbmcocG9zKQogICAgICAgIGlmICh0YWlsLmluZGV4T2YoJ30nKSA8IDAgfHwgKHRhaWwuaW5kZXhPZigneycpID4gMCkgJiYgKHRhaWwuaW5kZXhPZignfScpID4gdGFpbC5pbmRleE9mKCd7JykpKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH07CiAgICAvKioKICAgICAqIGdpdmVuIGEgdGV4dCBhbmQgYSBwb3N0aW9uLCBleHRyYWN0IHRoZSBwcmVmaXggdGhhdCB3aWxsIGJlIHVzZWQgYXMgYSBhbmNob3IgZm9yIGF1dG9jb21wbGV0aW9uLCBhcyB3ZWxsIGFzIHRoZSB0ZXh0IHBvc2l0aW9uIHRvIGJlIHJlcGxhY2VkIGJ5IHRoZSBhdXRvY29tcGxldGlvbmVyCiAgICAgKiBUaGluayB0aGF0IHdlIGNhbiBjb21lIGJhY2sgaW50byAgY3VybHkgYnJhY2tldHMgYW5kIHdlIHN0aWxsIHdhbnQgc29tZSBjb21wbGV0aW9uCiAgICAgKiByZXR1cm4gbnVsbCBpcyB3ZSBhcmUgbm90IGF0IGEgcG9zaXRpb24gdG8gZ2V0IGFueSByZXBsYWNlbWVudAogICAgICoKICAgICAqIGdvIGNoZWNrIGphc21pbmUgUmljaFNlcXVlbmNlQXV0b0NvbXBsZXRpb25lciUyMHJlcGxhY2VhYmxlIHRvIGdldCB0b25zIG9mIGV4YW1wbGVzCiAgICAgKiBAcGFyYW0ge09iamVjdH0gdHh0CiAgICAgKiBAcGFyYW0ge09iamVjdH0gcG9zCiAgICAgKi8KICAgIFJpY2hTZXF1ZW5jZUF1dG9Db21wbGV0aW9uZXIucHJvdG90eXBlLnJlcGxhY2VhYmxlID0gZnVuY3Rpb24gKHR4dCwgcG9zKSB7CiAgICAgICAgdmFyIGJlZm9yZSA9IHR4dC5zdWJzdHJpbmcoMCwgcG9zKQogICAgICAgIHZhciBhZnRlciA9IHR4dC5zdWJzdHJpbmcocG9zKQoKICAgICAgICBpZiAoYmVmb3JlLmluZGV4T2YoJ3snKSA8IDApIHsKICAgICAgICAgICAgLy9ub3QgZXZlbiBhbiBvcGVuIGN1cmx5LCBkb24ndCB3YXN0ZSBteSB0aW1lCiAgICAgICAgICAgIHJldHVybiBudWxsCiAgICAgICAgfQoKICAgICAgICBiZWZvcmUgPSBiZWZvcmUucmVwbGFjZSgvLipcfS8sICcnKTsKICAgICAgICBpZiAoYmVmb3JlLmluZGV4T2YoJ3snKSA8IDApIHsKICAgICAgICAgICAgLy93ZSBhcmUgbm90IGFmdGVyIGFuIG9wZW4gY3VybHkgYnJhY2tldAogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAgYmVmb3JlID0gYmVmb3JlLnJlcGxhY2UoLy4qW1x7LF0vLCAnJyk7CgogICAgICAgIGFmdGVyID0gYWZ0ZXIucmVwbGFjZSgvW1x9LF0uKi8sICcnKTsKCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgcHJlZml4OiBiZWZvcmUsCiAgICAgICAgICAgIHBvc1N0YXJ0OiBwb3MgLSBiZWZvcmUubGVuZ3RoLAogICAgICAgICAgICBwb3NFbmQ6IHBvcyArIGFmdGVyLmxlbmd0aAogICAgICAgIH0KCiAgICB9OwoKICAgIC8qKgogICAgICogZ2V0IHRoZSBsaXN0IG9mIG1vZGlmY2F0aW9uIG1hYXRjaGluZyB0aGUgcHJlZml4LiBpLmUuCiAgICAgKiBzdGFydGluZyB3aXRoIHRoZSBwcmVmaXgKICAgICAqIGNhc2UgaXMgbm90IGltcG9ydGFudAogICAgICogcHJlZml4IGNhbiBiZSBhIG1hc3MgKCsvLSAxIERhKQogICAgICogQHBhcmFtIHtPYmplY3R9IHByZWZpeAogICAgICovCiAgICBSaWNoU2VxdWVuY2VBdXRvQ29tcGxldGlvbmVyLnByb3RvdHlwZS5nZXRMaXN0ID0gZnVuY3Rpb24gKHByZWZpeCkgewogICAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgICAgdmFyIG1hc3MgPSBwYXJzZUZsb2F0KHByZWZpeCkKICAgICAgICBpZiAoXy5pc0Zpbml0ZShtYXNzKSkgewogICAgICAgICAgICB2YXIgbUluZiA9IG1hc3MgLSAxLjAKICAgICAgICAgICAgdmFyIG1TdXAgPSBtYXNzICsgMS4wCiAgICAgICAgICAgIHJldHVybiBfLmNoYWluKHNlbGYubW9kaWYybWFzcykuY29sbGVjdChmdW5jdGlvbiAobWFzcywgbmFtZSkgewogICAgICAgICAgICAgICAgaWYgKG1hc3MgPCBtSW5mIHx8IG1hc3MgPiBtU3VwKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGwKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBuYW1lCiAgICAgICAgICAgIH0pLmZpbHRlcihmdW5jdGlvbiAobikgewogICAgICAgICAgICAgICAgcmV0dXJuIG4gIT0gbnVsbAogICAgICAgICAgICB9KS52YWx1ZSgpCiAgICAgICAgfQoKICAgICAgICBwcmVmaXggPSBwcmVmaXgudG9Mb3dlckNhc2UoKTsKICAgICAgICByZXR1cm4gXy5maWx0ZXIodGhpcy5tb2RpZk5hbWVzLCBmdW5jdGlvbiAobikgewogICAgICAgICAgICByZXR1cm4gbi50b0xvd2VyQ2FzZSgpLmluZGV4T2YocHJlZml4KSA9PSAwCiAgICAgICAgfSkKICAgIH0KICAgIHJldHVybiBSaWNoU2VxdWVuY2VBdXRvQ29tcGxldGlvbmVyOwp9KTsKCi8qCiBSZXF1aXJlSlMgdGV4dCAwLjI3LjAgQ29weXJpZ2h0IChjKSAyMDEwLTIwMTEsIFRoZSBEb2pvIEZvdW5kYXRpb24gQWxsIFJpZ2h0cyBSZXNlcnZlZC4KIEF2YWlsYWJsZSB2aWEgdGhlIE1JVCBvciBuZXcgQlNEIGxpY2Vuc2UuCiBzZWU6IGh0dHA6Ly9naXRodWIuY29tL2pyYnVya2UvcmVxdWlyZWpzIGZvciBkZXRhaWxzCiovCihmdW5jdGlvbigpe3ZhciBrPVsiTXN4bWwyLlhNTEhUVFAiLCJNaWNyb3NvZnQuWE1MSFRUUCIsIk1zeG1sMi5YTUxIVFRQLjQuMCJdLG49L15ccyo8XD94bWwoXHMpK3ZlcnNpb249W1wnXCJdKFxkKSouKFxkKSpbXCdcIl0oXHMpKlw/Pi9pbSxvPS88Ym9keVtePl0qPlxzKihbXHNcU10rKVxzKjxcL2JvZHk+L2ltLGk9dHlwZW9mIGxvY2F0aW9uIT09InVuZGVmaW5lZCImJmxvY2F0aW9uLmhyZWYscD1pJiZsb2NhdGlvbi5wcm90b2NvbCYmbG9jYXRpb24ucHJvdG9jb2wucmVwbGFjZSgvXDovLCIiKSxxPWkmJmxvY2F0aW9uLmhvc3RuYW1lLHI9aSYmKGxvY2F0aW9uLnBvcnR8fHZvaWQgMCksaj1bXTtkZWZpbmUoJ3RleHQnLFtdLGZ1bmN0aW9uKCl7dmFyIGcsaCxsO3R5cGVvZiB3aW5kb3chPT0idW5kZWZpbmVkIiYmd2luZG93Lm5hdmlnYXRvciYmd2luZG93LmRvY3VtZW50P2g9ZnVuY3Rpb24oYSxiKXt2YXIgYz1nLmNyZWF0ZVhocigpO2Mub3BlbigiR0VUIixhLCEwKTtjLm9ucmVhZHlzdGF0ZWNoYW5nZT0KZnVuY3Rpb24oKXtjLnJlYWR5U3RhdGU9PT00JiZiKGMucmVzcG9uc2VUZXh0KX07Yy5zZW5kKG51bGwpfTp0eXBlb2YgcHJvY2VzcyE9PSJ1bmRlZmluZWQiJiZwcm9jZXNzLnZlcnNpb25zJiZwcm9jZXNzLnZlcnNpb25zLm5vZGU/KGw9cmVxdWlyZS5ub2RlUmVxdWlyZSgiZnMiKSxoPWZ1bmN0aW9uKGEsYil7YihsLnJlYWRGaWxlU3luYyhhLCJ1dGY4IikpfSk6dHlwZW9mIFBhY2thZ2VzIT09InVuZGVmaW5lZCImJihoPWZ1bmN0aW9uKGEsYil7dmFyIGM9bmV3IGphdmEuaW8uRmlsZShhKSxlPWphdmEubGFuZy5TeXN0ZW0uZ2V0UHJvcGVydHkoImxpbmUuc2VwYXJhdG9yIiksYz1uZXcgamF2YS5pby5CdWZmZXJlZFJlYWRlcihuZXcgamF2YS5pby5JbnB1dFN0cmVhbVJlYWRlcihuZXcgamF2YS5pby5GaWxlSW5wdXRTdHJlYW0oYyksInV0Zi04IikpLGQsZixnPSIiO3RyeXtkPW5ldyBqYXZhLmxhbmcuU3RyaW5nQnVmZmVyOyhmPWMucmVhZExpbmUoKSkmJmYubGVuZ3RoKCkmJgpmLmNoYXJBdCgwKT09PTY1Mjc5JiYoZj1mLnN1YnN0cmluZygxKSk7Zm9yKGQuYXBwZW5kKGYpOyhmPWMucmVhZExpbmUoKSkhPT1udWxsOylkLmFwcGVuZChlKSxkLmFwcGVuZChmKTtnPVN0cmluZyhkLnRvU3RyaW5nKCkpfWZpbmFsbHl7Yy5jbG9zZSgpfWIoZyl9KTtyZXR1cm4gZz17dmVyc2lvbjoiMC4yNy4wIixzdHJpcDpmdW5jdGlvbihhKXtpZihhKXt2YXIgYT1hLnJlcGxhY2UobiwiIiksYj1hLm1hdGNoKG8pO2ImJihhPWJbMV0pfWVsc2UgYT0iIjtyZXR1cm4gYX0sanNFc2NhcGU6ZnVuY3Rpb24oYSl7cmV0dXJuIGEucmVwbGFjZSgvKFsnXFxdKS9nLCJcXCQxIikucmVwbGFjZSgvW1xmXS9nLCJcXGYiKS5yZXBsYWNlKC9bXGJdL2csIlxcYiIpLnJlcGxhY2UoL1tcbl0vZywiXFxuIikucmVwbGFjZSgvW1x0XS9nLCJcXHQiKS5yZXBsYWNlKC9bXHJdL2csIlxcciIpfSxjcmVhdGVYaHI6ZnVuY3Rpb24oKXt2YXIgYSxiLGM7aWYodHlwZW9mIFhNTEh0dHBSZXF1ZXN0IT09CiJ1bmRlZmluZWQiKXJldHVybiBuZXcgWE1MSHR0cFJlcXVlc3Q7ZWxzZSBmb3IoYj0wO2I8MztiKyspe2M9a1tiXTt0cnl7YT1uZXcgQWN0aXZlWE9iamVjdChjKX1jYXRjaChlKXt9aWYoYSl7az1bY107YnJlYWt9fWlmKCFhKXRocm93IEVycm9yKCJjcmVhdGVYaHIoKTogWE1MSHR0cFJlcXVlc3Qgbm90IGF2YWlsYWJsZSIpO3JldHVybiBhfSxnZXQ6aCxwYXJzZU5hbWU6ZnVuY3Rpb24oYSl7dmFyIGI9ITEsYz1hLmluZGV4T2YoIi4iKSxlPWEuc3Vic3RyaW5nKDAsYyksYT1hLnN1YnN0cmluZyhjKzEsYS5sZW5ndGgpLGM9YS5pbmRleE9mKCIhIik7YyE9PS0xJiYoYj1hLnN1YnN0cmluZyhjKzEsYS5sZW5ndGgpLGI9Yj09PSJzdHJpcCIsYT1hLnN1YnN0cmluZygwLGMpKTtyZXR1cm57bW9kdWxlTmFtZTplLGV4dDphLHN0cmlwOmJ9fSx4ZFJlZ0V4cDovXigoXHcrKVw6KT9cL1wvKFteXC9cXF0rKS8sdXNlWGhyOmZ1bmN0aW9uKGEsYixjLGUpe3ZhciBkPWcueGRSZWdFeHAuZXhlYyhhKSwKZjtpZighZClyZXR1cm4hMDthPWRbMl07ZD1kWzNdO2Q9ZC5zcGxpdCgiOiIpO2Y9ZFsxXTtkPWRbMF07cmV0dXJuKCFhfHxhPT09YikmJighZHx8ZD09PWMpJiYoIWYmJiFkfHxmPT09ZSl9LGZpbmlzaExvYWQ6ZnVuY3Rpb24oYSxiLGMsZSxkKXtjPWI/Zy5zdHJpcChjKTpjO2QuaXNCdWlsZCYmZC5pbmxpbmVUZXh0JiYoalthXT1jKTtlKGMpfSxsb2FkOmZ1bmN0aW9uKGEsYixjLGUpe3ZhciBkPWcucGFyc2VOYW1lKGEpLGY9ZC5tb2R1bGVOYW1lKyIuIitkLmV4dCxtPWIudG9VcmwoZiksaD1lJiZlLnRleHQmJmUudGV4dC51c2VYaHJ8fGcudXNlWGhyOyFpfHxoKG0scCxxLHIpP2cuZ2V0KG0sZnVuY3Rpb24oYil7Zy5maW5pc2hMb2FkKGEsZC5zdHJpcCxiLGMsZSl9KTpiKFtmXSxmdW5jdGlvbihhKXtnLmZpbmlzaExvYWQoZC5tb2R1bGVOYW1lKyIuIitkLmV4dCxkLnN0cmlwLGEsYyxlKX0pfSx3cml0ZTpmdW5jdGlvbihhLGIsYyl7aWYoYiBpbiBqKXt2YXIgZT1nLmpzRXNjYXBlKGpbYl0pOwpjLmFzTW9kdWxlKGErIiEiK2IsImRlZmluZShmdW5jdGlvbiAoKSB7IHJldHVybiAnIitlKyInO30pO1xuIil9fSx3cml0ZUZpbGU6ZnVuY3Rpb24oYSxiLGMsZSxkKXt2YXIgYj1nLnBhcnNlTmFtZShiKSxmPWIubW9kdWxlTmFtZSsiLiIrYi5leHQsaD1jLnRvVXJsKGIubW9kdWxlTmFtZSsiLiIrYi5leHQpKyIuanMiO2cubG9hZChmLGMsZnVuY3Rpb24oKXt2YXIgYj1mdW5jdGlvbihhKXtyZXR1cm4gZShoLGEpfTtiLmFzTW9kdWxlPWZ1bmN0aW9uKGEsYil7cmV0dXJuIGUuYXNNb2R1bGUoYSxoLGIpfTtnLndyaXRlKGEsZixiLGQpfSxkKX19fSl9KSgpOwoKZGVmaW5lKCd0ZXh0IWZpc2h0b25lcy10ZW1wbGF0ZXMvZHJ5L2Zvcm1zL3JpY2hzZXF1ZW5jZS1pbnB1dC5odG1sJyxbXSxmdW5jdGlvbiAoKSB7IHJldHVybiAnPGRpdiBjbGFzcz0iaW5wdXQtYXBwZW5kIiBzdHlsZT0id2lkdGg6MTAwJSI+XG4gICAgPHNwYW4gY2xhc3M9ImdseXBoaWNvbiBnbHlwaGljb24tcXVlc3Rpb24tc2lnbiI+PC9zcGFuPlxuICAgIDxpbnB1dCBpZD0ie3tpbnB1dElkfX0iIHR5cGU9InRleHQiIGNsYXNzPSJ7e2lucHV0Q2xhc3N9fSIgcGxhY2Vob2xkZXI9Int7cGxhY2Vob2xkZXJ9fSJcbiAgICAgICAgICAgdmFsdWU9Int7dmFsdWV9fSIvPlxuXG4gICAgPGJ1dHRvbiBpZD0ie3tidXR0b25JZH19IiBjbGFzcz0ie3tidXR0b25DbGFzc319IiB0eXBlPSJidXR0b24iPnt7YnV0dG9uVGV4dH19PC9idXR0b24+XG4gICAgPHNwYW4gaWQ9Int7dmFsaWRJbmRpY2F0b3JJZH19IiBjbGFzcz0iYmFkZ2UgYmFkZ2UtaW1wb3J0YW50Ij5YPC9zcGFuPlxuPC9kaXY+Jzt9KTsKCi8qKgogKiBJbnB1dCBmaWVsZCBmb3IgIFJpY2hTZXF1ZW5jZSwgd2l0aCBhdXRvY29tcGxldGlvbgogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KZGVmaW5lKCdmaXNodG9uZXMvdmlld3MvZHJ5L2Zvcm1zL1JpY2hTZXF1ZW5jZUlucHV0JyxbJ2pxdWVyeS1wbHVzJywgJ3VuZGVyc2NvcmUnLCAnQmFja2JvbmUnLCAnZmlzaHRvbmVzL21vZGVscy9kcnkvUmljaFNlcXVlbmNlJywgJ2Zpc2h0b25lcy9zZXJ2aWNlcy9kcnkvUmljaFNlcXVlbmNlU2hvcnRjdXRlcicsICdmaXNodG9uZXMvc2VydmljZXMvZHJ5L1JpY2hTZXF1ZW5jZUF1dG9Db21wbGV0aW9uZXInLCAndGV4dCFmaXNodG9uZXMtdGVtcGxhdGVzL2RyeS9mb3Jtcy9yaWNoc2VxdWVuY2UtaW5wdXQuaHRtbCddLAogICAgZnVuY3Rpb24gKCQsIF8sIEJhY2tib25lLCBSaWNoU2VxdWVuY2UsIFJpY2hTZXF1ZW5jZVNob3J0Y3V0ZXIsIFJpY2hTZXF1ZW5jZUF1dG9Db21wbGV0aW9uZXIsIHRtcGwpIHsKCiAgICAgICAgUmljaFNlcXVlbmNlSW5wdXQgPSBCYWNrYm9uZS5WaWV3LmV4dGVuZCh7CiAgICAgICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICAgICAgICAgICAgaWYgKCFzZWxmLm1vZGVsKSB7CiAgICAgICAgICAgICAgICAgICAgc2VsZi5tb2RlbCA9IG5ldyBSaWNoU2VxdWVuY2UoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vaW5pdGlhbGl6YXRpb24gcGVyIHNlCiAgICAgICAgICAgICAgICBzZWxmLnJpY2hTZXF1ZW5jZVNob3J0Y3V0ZXIgPSBuZXcgUmljaFNlcXVlbmNlU2hvcnRjdXRlcigpOwogICAgICAgICAgICAgICAgc2VsZi5hdXRvQ29tcGxldGlvbmVyID0gbmV3IFJpY2hTZXF1ZW5jZUF1dG9Db21wbGV0aW9uZXIoKQogICAgICAgICAgICAgICAgc2VsZi5jYWxsYmFja3NJbnZhbGlkID0gW107CiAgICAgICAgICAgICAgICBzZWxmLmNhbGxiYWNrc1ZhbGlkID0gW107CiAgICAgICAgICAgICAgICBzZWxmLmNhbGxiYWNrc0NsZWFyID0gW107CgogICAgICAgICAgICAgICAgc2VsZi5hY3Rpb24gPSBvcHRpb25zICYmIG9wdGlvbnMuYWN0aW9uOwoKICAgICAgICAgICAgICAgIC8vZG9tIGNvbnN0cnVjdGlvbgogICAgICAgICAgICAgICAgdmFyIGFyZ3MgPSAkLmV4dGVuZCh7CiAgICAgICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI6ICdIM0s0LCBIMy4xSzE4QWMsIEgzLjFLMThBY0syM01lMiwgS1FUQVIsIEtBY1FUQVIsIEt7QWNldHlsYXRpb24sTWV0aHlsYXRpb259UVRBUntNZXRoeWxhdGlvbn0nLAogICAgICAgICAgICAgICAgICAgIGlucHV0Q2xhc3M6ICdmb3JtLWNvbnRyb2wnLAogICAgICAgICAgICAgICAgICAgIHZhbHVlOiAnJywKICAgICAgICAgICAgICAgICAgICBpbnB1dElkOiAncnNpLWlucHV0LScgKyBzZWxmLmNpZCwKICAgICAgICAgICAgICAgICAgICBidXR0b25DbGFzczogJ2J0bicsCiAgICAgICAgICAgICAgICAgICAgYnV0dG9uSWQ6ICdyc2ktYnV0LScgKyBzZWxmLmNpZCwKICAgICAgICAgICAgICAgICAgICBidXR0b25UZXh0OiAnYWN0aW9uJywKICAgICAgICAgICAgICAgICAgICBoaWRlQnV0dG9uOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICBoaWRlVmFsaWRJbmRpY2F0b3I6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgdmFsaWRJbmRpY2F0b3JJZDogJ3JzaS1iYWRnZS0nICsgc2VsZi5jaWQKICAgICAgICAgICAgICAgIH0sIG9wdGlvbnMpOwoKICAgICAgICAgICAgICAgIHZhciBjb250ID0gJChzZWxmLmVsKS5hcHBlbmQoJChfLnRlbXBsYXRlKHRtcGwsIGFyZ3MpKSk7CiAgICAgICAgICAgICAgICBzZWxmLmVsSW5wdXQgPSBjb250LmZpbmQoJ2lucHV0Jyk7CiAgICAgICAgICAgICAgICBzZWxmLmVsQnV0dG9uID0gY29udC5maW5kKCdidXR0b24nKTsKICAgICAgICAgICAgICAgIHNlbGYuaGlkZUluZGljYXRvciA9IGNvbnQuZmluZCgnc3Bhbi5iYWRnZScpCgoKICAgICAgICAgICAgICAgIGlmIChhcmdzLmhpZGVCdXR0b24pIHsKICAgICAgICAgICAgICAgICAgICBzZWxmLmVsQnV0dG9uLmhpZGUoKTsKICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGFyZ3MuaGlkZVZhbGlkSW5kaWNhdG9yKSB7CiAgICAgICAgICAgICAgICAgICAgc2VsZi5oaWRlSW5kaWNhdG9yLmhpZGUoKTsKICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHNlbGYuZWxJY29uID0gY29udC5maW5kKCdzcGFuLmdseXBoaWNvbicpOwogICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpewogICAgICAgICAgICAgICAgICAgIHZhciB0b3RhbFdpZHRoID0gJChzZWxmLmVsKS53aWR0aCgpOwogICAgICAgICAgICAgICAgICAgIHRvdGFsV2lkdGgtPXNlbGYuZWxCdXR0b24ub3V0ZXJXaWR0aCh0cnVlKTsKICAgICAgICAgICAgICAgICAgICB0b3RhbFdpZHRoLT1zZWxmLmhpZGVJbmRpY2F0b3Iub3V0ZXJXaWR0aCh0cnVlKTsKICAgICAgICAgICAgICAgICAgICB0b3RhbFdpZHRoLT0gc2VsZi5lbEljb24ub3V0ZXJXaWR0aCh0cnVlKTsKICAgICAgICAgICAgICAgICAgICB0b3RhbFdpZHRoLT0yMAoKICAgICAgICAgICAgICAgICAgICBzZWxmLmVsSW5wdXQud2lkdGgoJycrdG90YWxXaWR0aCsncHgnKTsKICAgICAgICAgICAgICAgIH0sMCk7CgogICAgICAgICAgICAgICAgc2VsZi5lbElucHV0LnZhbChzZWxmLm1vZGVsLnRvU3RyaW5nKCkpCgogICAgICAgICAgICAgICAgc2VsZi5lbElucHV0LnR5cGVhaGVhZCh7CiAgICAgICAgICAgICAgICAgICAgc291cmNlOiBmdW5jdGlvbiAodHh0LCBwcm9jZXNzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0eXBlYWhlYWQgPSB0aGlzOwogICAgICAgICAgICAgICAgICAgICAgICB0eXBlYWhlYWQucmVwbGFjZUNvbnRleHQgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgcENhcmV0ID0gc2VsZi5lbElucHV0WzBdLnNlbGVjdGlvblN0YXJ0CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbnNlcnRlZENoYXIgPSB0eHQuY2hhckF0KHBDYXJldCAtIDEpCgogICAgICAgICAgICAgICAgICAgICAgICAvL2Nsb3NlIHRoZSBjdXJseSBicmFja2V0IGlmIG5lZWRlZAogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5zZXJ0ZWRDaGFyID09ICd7JyAmJiBzZWxmLmF1dG9Db21wbGV0aW9uZXIuY2xvc2VDdXJseSh0eHQsIHBDYXJldCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZWxJbnB1dC52YWwodHh0LnN1YnN0cmluZygwLCBwQ2FyZXQpICsgJ30nICsgdHh0LnN1YnN0cmluZyhwQ2FyZXQpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zZXRDYXJldEF0KHBDYXJldCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlcGxhY2UgPSBzZWxmLmF1dG9Db21wbGV0aW9uZXIucmVwbGFjZWFibGUodHh0LCBwQ2FyZXQpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXBsYWNlID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVhaGVhZC5oaWRlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXBsYWNlLnByZWZpeC5sZW5ndGggPCAyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlYWhlYWQuaGlkZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVhaGVhZC5yZXBsYWNlQ29udGV4dCA9IHJlcGxhY2UKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuYXV0b0NvbXBsZXRpb25lci5nZXRMaXN0KHJlcGxhY2UucHJlZml4KQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgbWF0Y2hlcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgaGlnaGxpZ2h0ZXI6IGZ1bmN0aW9uICh0eHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHR5cGVhaGVhZCA9IHRoaXM7CgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5lbElucHV0LnZhbCgpLnN1YnN0cmluZygwLCB0eXBlYWhlYWQucmVwbGFjZUNvbnRleHQucG9zU3RhcnQpICsgJzxiPicgKyB0eHQgKyAnPC9iPicgKyBzZWxmLmVsSW5wdXQudmFsKCkuc3Vic3RyaW5nKHR5cGVhaGVhZC5yZXBsYWNlQ29udGV4dC5wb3NFbmQpCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB1cGRhdGVyOiBmdW5jdGlvbiAodHh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0eXBlYWhlYWQgPSB0aGlzOwogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNldENhcmV0U2VsZWN0aW9uKHR5cGVhaGVhZC5yZXBsYWNlQ29udGV4dC5wb3NTdGFydCwgdHlwZWFoZWFkLnJlcGxhY2VDb250ZXh0LnBvc0VuZCkKCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuZXdWYWwgPSBzZWxmLmVsSW5wdXQudmFsKCkuc3Vic3RyaW5nKDAsIHR5cGVhaGVhZC5yZXBsYWNlQ29udGV4dC5wb3NTdGFydCkgKyB0eHQgKyBzZWxmLmVsSW5wdXQudmFsKCkuc3Vic3RyaW5nKHR5cGVhaGVhZC5yZXBsYWNlQ29udGV4dC5wb3NFbmQpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZWxJbnB1dC52YWwobmV3VmFsKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnVwZGF0ZSgpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXdWYWwKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgIHZhciBwb3AgPSBzZWxmLmVsSWNvbi5wb3BvdmVyKHsKICAgICAgICAgICAgICAgICAgICBwbGFjZW1lbnQ6ICJib3R0b20iLAogICAgICAgICAgICAgICAgICAgIGh0bWw6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgdHJpZ2dlcjogJ2hvdmVyJywKICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ0hvdyB0byBlbnRlciBhIHBlcHRpZGUgIDxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0iY2xvc2UiIGRhdGEtZGlzbWlzcz0ibW9kYWwiIGFyaWEtaGlkZGVuPSJ0cnVlIicsCgogICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6ICJUaGVyZSBpcyBtb3JlIHRoYW4gb25lIHdheSB0byBkbyBpdDo8dWw+IDxsaT5zaG9ydGN1dCBhcyA8Y29kZT5IM0s5PC9jb2RlPiBvciA8Y29kZT5IMy4xSzI3PC9jb2RlPjwvbGk+PGxpPnNob3J0Y3V0IHdpdGggbW9kaWZpY2F0aW9uIGFzIDxjb2RlPkgzSzlNZTI8L2NvZGU+PC9saT48bGk+YXMgc2VxdWVuY2Ugd2l0aCBzaG9ydCBtb2RpZmljYXRpb24gPGNvZGU+UUtBY1RBUk1lPC9jb2RlPjwvbGk+PGxpPndpdGggbG9uZyB2ZXJzaW9uIG1vZGlmaWNhdGlvbiA8Y29kZT5RS3tBY2V0eWx9VEFSPC9jb2RlPjwvbGk+PGxpPndpdGggZXhwbGljaXQgbWFzcyA8Y29kZT5QRVB7MTIzNC41Njd9VElERU1lPC9jb2RlPjwvbGk+PGxpPmluIGNvbnRleHQgPGNvZGU+Ui5RS1RBUi5LPC9jb2RlPjwvbGk+PC91bD5UaGUgbW9kaWZpY2F0aW9uIGxpc3QgY2FuIGJlIGZvdW5kIDxhIGhyZWY9Jyc+c29vbjwvYT4iCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICAgICAgc2VsZi5lbElucHV0LnZhbChzZWxmLm1vZGVsLnRvU3RyaW5nKCkpOwogICAgICAgICAgICAgICAgc2VsZi5kZWxlZ2F0ZUV2ZW50cyh7CiAgICAgICAgICAgICAgICAgICAgJ2lucHV0JzogJ3VwZGF0ZScsCiAgICAgICAgICAgICAgICAgICAgJ2tleXByZXNzIGlucHV0JzogJ2lucHV0S2V5UHJlc3NlZCcsCiAgICAgICAgICAgICAgICAgICAgJ2NsaWNrIGJ1dHRvbic6ICdjYWxsQWN0aW9uJwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC8vIHNlbGYub24oJ2NoYW5nZTppbnB1dCcsIGZ1bmN0aW9uKCl7c2VsZi51cGRhdGUoKX0pOwogICAgICAgICAgICAgICAgLy8gc2VsZi5vbigna2V5cHJlc3M6aW5wdXQnLCBmdW5jdGlvbigpe3NlbGYuaW5wdXRLZXlQcmVzc2VkKCl9KTsKICAgICAgICAgICAgICAgIC8vIHNlbGYub24oJ2J1dHRvbjpjbGljaycsIGZ1bmN0aW9uKCl7c2VsZi5jYWxsQWN0aW9uKCl9KTsKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgICAgICB9LAogICAgICAgICAgICAvLyBldmVudHMgOiB7CiAgICAgICAgICAgIC8vICdpbnB1dCcgOiAndXBkYXRlJywKICAgICAgICAgICAgLy8gJ2tleXByZXNzIGlucHV0JyA6ICdpbnB1dEtleVByZXNzZWQnLAogICAgICAgICAgICAvLyAnY2xpY2sgYnV0dG9uJyA6ICdjYWxsQWN0aW9uJwogICAgICAgICAgICAvLyB9LAogICAgICAgICAgICB1cGRhdGU6IGZ1bmN0aW9uIChldnQpIHsKICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGluU3RyID0gc2VsZi5lbElucHV0LnZhbCgpLnRyaW0oKTsKICAgICAgICAgICAgICAgICAgICBpZiAoaW5TdHIgPT0gJycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgXy5lYWNoKHNlbGYuY2FsbGJhY2tzQ2xlYXIsIGZ1bmN0aW9uIChmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmKHNlbGYubW9kZWwpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBzZWxmLnJpY2hTZXF1ZW5jZVNob3J0Y3V0ZXIucmljaFNlcVJlYWRGcm9tKHNlbGYubW9kZWwsIGluU3RyKQogICAgICAgICAgICAgICAgICAgIHNlbGYuaXNWYWxpZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgc2VsZi5lbEJ1dHRvbi5yZW1vdmVDbGFzcygnYnRuLXdhcm5pbmcnKS5hZGRDbGFzcygnYnRuLXN1Y2Nlc3MnKS5hdHRyKCdkaXNhYmxlZCcsIG51bGwpOwogICAgICAgICAgICAgICAgICAgIHNlbGYuaGlkZUluZGljYXRvci5yZW1vdmVDbGFzcygnYmFkZ2UtaW1wb3J0YW50JykuYWRkQ2xhc3MoJ2JhZGdlLXN1Y2Nlc3MnKS5odG1sKCcmcmFkaWM7Jyk7CiAgICAgICAgICAgICAgICAgICAgXy5lYWNoKHNlbGYuY2FsbGJhY2tzVmFsaWQsIGZ1bmN0aW9uIChmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGYoc2VsZi5tb2RlbCkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGV4YykgewogICAgICAgICAgICAgICAgICAgIHNlbGYuaXNWYWxpZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIHNlbGYuZWxCdXR0b24uYWRkQ2xhc3MoJ2J0bi13YXJuaW5nJykucmVtb3ZlQ2xhc3MoJ2J0bi1zdWNjZXNzJykuYXR0cignZGlzYWJsZWQnLCAnZGlzYWJsZWQnKTsKICAgICAgICAgICAgICAgICAgICBzZWxmLmhpZGVJbmRpY2F0b3IucmVtb3ZlQ2xhc3MoJ2JhZGdlLXN1Y2Nlc3MnKS5hZGRDbGFzcygnYmFkZ2UtaW1wb3J0YW50JykuaHRtbCgnWCcpOwogICAgICAgICAgICAgICAgICAgIF8uZWFjaChzZWxmLmNhbGxiYWNrc0ludmFsaWQsIGZ1bmN0aW9uIChmKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGYoZXhjKQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgfSwKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIGNsaWNrIGJ1dHRvbiBpZiBlbnRlciBrZXkgaXMgcHJlc3NlZAogICAgICAgICAgICAgKi8KICAgICAgICAgICAgaW5wdXRLZXlQcmVzc2VkOiBmdW5jdGlvbiAoZXZ0KSB7CiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgICAgICBpZiAoZXZ0LmNoYXJDb2RlID09IDEzKSB7CiAgICAgICAgICAgICAgICAgICAgc2VsZi5jYWxsQWN0aW9uKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBhZGQgYSBmdW5jaXRvbiB0byBiZSBjYWxsZWQgd2hlbmV2ZXIgdGhlIGZpZWxkIGlzIGEgdmFsaWQgUmljaFNlcXVlbmNlIGRlc2NyaXB0b3IKICAgICAgICAgICAgICogYXJndW1lbnQgcGFzc2VkIHRvIHRoZSBmdW5jdGlvbiB3aWxsIGEgUmljaFNlcXVlbmNlICh0aGUgUlNJIG1vZGVsKQogICAgICAgICAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBmCiAgICAgICAgICAgICAqLwogICAgICAgICAgICBhZGRDYWxsYmFja1ZhbGlkOiBmdW5jdGlvbiAoZikgewogICAgICAgICAgICAgICAgdGhpcy5jYWxsYmFja3NWYWxpZC5wdXNoKGYpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBhZGQgYSBmdW5jaXRvbiB0byBiZSBjYWxsZWQgd2hlbmV2ZXIgdGhlIGZpZWxkIGlzIGEgSU52YWxpZCBSaWNoU2VxdWVuY2UgZGVzY3JpcHRvcgogICAgICAgICAgICAgKiBhcmcgcGFzc2VkIHRvIGZ1bmN0aW9uIGlzIHRoZSBjdXJyZW50IGV4Y2VwdGlvbgogICAgICAgICAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBmCiAgICAgICAgICAgICAqLwogICAgICAgICAgICBhZGRDYWxsYmFja0ludmFsaWQ6IGZ1bmN0aW9uIChmKSB7CiAgICAgICAgICAgICAgICB0aGlzLmNhbGxiYWNrc0ludmFsaWQucHVzaChmKQogICAgICAgICAgICB9LAogICAgICAgICAgICBhZGRDYWxsYmFja0NsZWFyOiBmdW5jdGlvbiAoZikgewogICAgICAgICAgICAgICAgdGhpcy5jYWxsYmFja3NDbGVhci5wdXNoKGYpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNhbGxBY3Rpb246IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgICAgIGlmIChzZWxmLmFjdGlvbiA9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzZWxmLmFjdGlvbihzZWxmLm1vZGVsKQogICAgICAgICAgICB9LAogICAgICAgICAgICBzZXRDYXJldEF0OiBmdW5jdGlvbiAocG9zKSB7CiAgICAgICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgICAgICB2YXIgbm9kZSA9IHNlbGYuZWxJbnB1dFswXTsKICAgICAgICAgICAgICAgIG5vZGUuc2V0U2VsZWN0aW9uUmFuZ2UocG9zLCBwb3MpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBzZXRDYXJldFNlbGVjdGlvbjogZnVuY3Rpb24gKHBTdGFydCwgcEVuZCkgewogICAgICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICAgICAgdmFyIG5vZGUgPSBzZWxmLmVsSW5wdXRbMF07CiAgICAgICAgICAgICAgICBub2RlLnNldFNlbGVjdGlvblJhbmdlKHBTdGFydCwgcEVuZCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBqdXN0IHJldHVybiB0aGUgdGV4dCBpbiB0aGUgaW5wdXQgZmllbGQKICAgICAgICAgICAgICovCiAgICAgICAgICAgIGlucHV0U2VxdWVuY2U6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmVsSW5wdXQudmFsKCkudHJpbSgpCiAgICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIHJldHVybiBSaWNoU2VxdWVuY2VJbnB1dDsKICAgIH0pOwoKLyoKICogU1ZHIHJlbmRlciBvZiB0aGVvcmV0aWNhbCBmcmFnbWVudCBvbiBhIHNlcXVlbmNlCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwoKZGVmaW5lKCdmaXNodG9uZXMvdmlld3MvZHJ5L1RoZW9PblNlcXVlbmNlVmlldycsWyd1bmRlcnNjb3JlJywgJ0JhY2tib25lJywgJ2QzJ10sIGZ1bmN0aW9uKF8sIEJhY2tib25lLCBkMykgewoKICAgIFRoZW9PblNlcXVlbmNlVmlldyA9IEJhY2tib25lLlZpZXcuZXh0ZW5kKHsKICAgICAgICBkZWZhdWx0cyA6IHsKICAgICAgICB9LAoKICAgICAgICByZW5kZXIgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICAgICAgdmFyIHRoZW9TcGVjdHJ1bSA9IHNlbGYubW9kZWw7CgogICAgICAgICAgICB2YXIgd1VuaXQgPSA2NTsKICAgICAgICAgICAgdmFyIGhVbml0ID0gMTU7CgogICAgICAgICAgICB2YXIgd2lkdGggPSAodGhlb1NwZWN0cnVtLmdldCgncmljaFNlcXVlbmNlJykuc2l6ZSgpICsgMSkgKiB3VW5pdDsKICAgICAgICAgICAgdmFyIGhlaWdodCA9ICh0aGVvU3BlY3RydW0uZ2V0KCdmcmFnU2VyaWVzJykubGVuZ3RoICsgMiApICogaFVuaXQ7CgogICAgICAgICAgICBzZWxmLnZpeiA9IGQzLnNlbGVjdChzZWxmLmVsKS5hcHBlbmQoInN2ZyIpLmF0dHIoJ2NsYXNzJywgJ2QzLXdpZGdldC10aGVvLW9uLXNlcXVlbmNlJykuYXR0cigid2lkdGgiLCB3aWR0aCkuYXR0cigiaGVpZ2h0IiwgaGVpZ2h0KTsKCiAgICAgICAgICAgIHZhciBzZXJpZXMyaSA9IHt9OwogICAgICAgICAgICB2YXIgaV9jID0gMDsKICAgICAgICAgICAgdmFyIGlfbiA9IDA7CiAgICAgICAgICAgIF8uZWFjaCh0aGVvU3BlY3RydW0uZ2V0KCdmcmFnU2VyaWVzJyksIGZ1bmN0aW9uKGZzKSB7CiAgICAgICAgICAgICAgICBpZiAoZnMgPCAnbScpIHsvLyBudGVybQogICAgICAgICAgICAgICAgICAgIGlfbiA9IGlfbiAtIDE7CiAgICAgICAgICAgICAgICAgICAgc2VyaWVzMmlbZnNdID0gaV9uOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpX2MgPSBpX2MgKyAxCiAgICAgICAgICAgICAgICAgICAgc2VyaWVzMmlbZnNdID0gaV9jOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgaV9uIC09IDAuNTsKCiAgICAgICAgICAgIHZhciByaWNoU2VxID0gdGhlb1NwZWN0cnVtLmdldCgncmljaFNlcXVlbmNlJyk7CiAgICAgICAgICAgIHNlbGYudml6LmFwcGVuZCgnZycpLnNlbGVjdEFsbCgndGV4dC5hYScpLmRhdGEocmljaFNlcS5nZXQoJ3NlcXVlbmNlJykpLmVudGVyKCkuYXBwZW5kKCd0ZXh0JykuYXR0cignY2xhc3MnLCAnYWEnKS5hdHRyKCd4JywgZnVuY3Rpb24oYWEsIGkpIHsKICAgICAgICAgICAgICAgIHJldHVybiAoaSArIDEpICogd1VuaXQ7CiAgICAgICAgICAgIH0pLmF0dHIoJ3knLCAoLWlfbiArIDAuNSkgKiBoVW5pdCkudGV4dChmdW5jdGlvbihyYWEpIHsKICAgICAgICAgICAgICAgIHJldHVybiByYWEuYWEuZ2V0KCdjb2RlMScpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHZhciBzaXplID0gcmljaFNlcS5zaXplKCk7CiAgICAgICAgICAgIHZhciBtb2RpZnMgPSBbcmljaFNlcS5nZXRNb2RpZmljYXRpb25BcnJheSgtMSldLmNvbmNhdChfLmNvbGxlY3QocmljaFNlcS5nZXQoJ3NlcXVlbmNlJyksIGZ1bmN0aW9uKHJhYSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHJhYS5tb2RpZmljYXRpb25zCiAgICAgICAgICAgIH0pKS5jb25jYXQoW3JpY2hTZXEuZ2V0TW9kaWZpY2F0aW9uQXJyYXkoc2l6ZSldKTsKICAgICAgICAgICAgc2VsZi52aXouYXBwZW5kKCdnJykuc2VsZWN0QWxsKCd0ZXh0LmFhLW1vZGlmJykuZGF0YShtb2RpZnMpLmVudGVyKCkuYXBwZW5kKCd0ZXh0JykuYXR0cignY2xhc3MnLCAnYWEtbW9kaWYnKS5hdHRyKCd4JywgZnVuY3Rpb24obW9kcywgaSkgewogICAgICAgICAgICAgICAgaWYoaT09MCl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdVbml0ICowLjQ1OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYoaT09c2l6ZSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChpLTAuNDUpKndVbml0OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGkgKiB3VW5pdDsKICAgICAgICAgICAgfSkuYXR0cigneScsICgtaV9uICsgMC41KSAqIGhVbml0ICsgMTApLnRleHQoZnVuY3Rpb24obW9kcykgewogICAgICAgICAgICAgICAgaWYgKG1vZHMgPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcnCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gXy5jb2xsZWN0KG1vZHMsIGZ1bmN0aW9uKG0pIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbS5nZXQoJ25hbWUnKTsKICAgICAgICAgICAgICAgIH0pLmpvaW4oJywnKTsKCiAgICAgICAgICAgIH0pLnN0eWxlKCd0ZXh0LWFuY2hvcicsIGZ1bmN0aW9uKG1vZHMsIGkpewogICAgICAgICAgICAgICAgaWYoaT09MCl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdlbmQnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYoaT09c2l6ZSl7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdzdGFydCc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gJ21pZGRsZScKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB2YXIgcGVhazJwb3MgPSBmdW5jdGlvbihwKSB7CiAgICAgICAgICAgICAgICB2YXIgc2VyaWVzID0gcC5zZXJpZXM7CiAgICAgICAgICAgICAgICBpZiAoc2VyaWVzIDwgJ20nKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgaXNOdGVybSA6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgIHggOiB3VW5pdCAqIChwLnBvcyArIDEuNSkgLSA3LAogICAgICAgICAgICAgICAgICAgICAgICB5IDogKHNlcmllczJpW3Nlcmllc10gLSBpX24pICogaFVuaXQKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgIGlzTnRlcm0gOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICB4IDogd1VuaXQgKiAocC5wb3MgKyAuNSkgKyA3LAogICAgICAgICAgICAgICAgICAgIHkgOiAoc2VyaWVzMmlbc2VyaWVzXSAtIGlfbiArIDEpICogaFVuaXQKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBzZWxmLnZpei5hcHBlbmQoJ2cnKS5zZWxlY3RBbGwoJ3BhdGguZnJhZ21lbnQnKS5kYXRhKHRoZW9TcGVjdHJ1bS5nZXQoJ3BlYWtzJykpLmVudGVyKCkuYXBwZW5kKCdwYXRoJykuYXR0cignY2xhc3MnLCAnZnJhZ21lbnQnKS5hdHRyKCdkJywgZnVuY3Rpb24ocCkgewogICAgICAgICAgICAgICAgdmFyIHNlcmllcyA9IHAuc2VyaWVzOwogICAgICAgICAgICAgICAgdmFyIHBvcyA9IHBlYWsycG9zKHApCiAgICAgICAgICAgICAgICBpZiAocG9zLmlzTnRlcm0pIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ00nICsgcG9zLnggKyAnLCcgKyBwb3MueSArICdsNywzIGwwLCcgKyAoaFVuaXQgLSA1KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdNJyArIHBvcy54ICsgJywnICsgcG9zLnkgKyAnbC03LC0zIGwwLCcgKyAoLWhVbml0ICsgNSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBzZWxmLnZpei5hcHBlbmQoJ2cnKS5zZWxlY3RBbGwoJ3RleHQuZnJhZy1tb3oucGVha3MnKS5kYXRhKHRoZW9TcGVjdHJ1bS5nZXQoJ3BlYWtzJykpLmVudGVyKCkuYXBwZW5kKCd0ZXh0JykuYXR0cignY2xhc3MnLCAnZnJhZy1tb3ogcGVha3MnKS5hdHRyKCd4JywgZnVuY3Rpb24ocCkgewogICAgICAgICAgICAgICAgdmFyIHBvcyA9IHBlYWsycG9zKHApOwogICAgICAgICAgICAgICAgcmV0dXJuIHBvcy54ICsgKHBvcy5pc050ZXJtID8gLTMgOiArMyk7CiAgICAgICAgICAgIH0pLmF0dHIoJ3knLCBmdW5jdGlvbihwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcGVhazJwb3MocCkueSArIDM7CiAgICAgICAgICAgIH0pLnN0eWxlKCd0ZXh0LWFuY2hvcicsIGZ1bmN0aW9uKHApIHsKICAgICAgICAgICAgICAgIHJldHVybiBwZWFrMnBvcyhwKS5pc050ZXJtID8gJ2VuZCcgOiAnc3RhcnQnOwogICAgICAgICAgICB9KS50ZXh0KGZ1bmN0aW9uKHApIHsKICAgICAgICAgICAgICAgIHJldHVybiBwLm1vei50b0ZpeGVkKDQpCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLy9hZGQgZnJhZ3NlcmllcyBuYW1lIG9uIGxlZnQvcmlnaHQgY29sdW1uCiAgICAgICAgICAgIHZhciBkU2VyaWVzTmFtZXMgPSBfLnppcChfLmtleXMoc2VyaWVzMmkpLCBfLnZhbHVlcyhzZXJpZXMyaSkpOwogICAgICAgICAgICBzZWxmLnZpei5hcHBlbmQoJ2cnKS5zZWxlY3RBbGwoJ3RleHQuZnJhZy1tb3oubGVnZW5kJykuZGF0YShkU2VyaWVzTmFtZXMpLmVudGVyKCkuYXBwZW5kKCd0ZXh0JykuYXR0cignY2xhc3MnLCAnZnJhZy1tb3ogbGVnZW5kJykuYXR0cigneCcsIGZ1bmN0aW9uKHApIHsKICAgICAgICAgICAgICAgIHJldHVybiAocFswXSA8ICdtJykgPyA1IDogKHdpZHRoIC0gNSk7CiAgICAgICAgICAgIH0pLmF0dHIoJ3knLCBmdW5jdGlvbihwKSB7CiAgICAgICAgICAgICAgICB2YXIgcGsgPSB7CiAgICAgICAgICAgICAgICAgICAgc2VyaWVzIDogcFswXSwKICAgICAgICAgICAgICAgICAgICBwb3MgOiAwCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gcGVhazJwb3MocGspLnkgKyAzOwogICAgICAgICAgICB9KS5zdHlsZSgndGV4dC1hbmNob3InLCBmdW5jdGlvbihwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gKHBbMF0gPiAnbScpID8gJ2VuZCcgOiAnc3RhcnQnOwogICAgICAgICAgICB9KS50ZXh0KGZ1bmN0aW9uKHApIHsKICAgICAgICAgICAgICAgIHJldHVybiBwWzBdOwogICAgICAgICAgICB9KTsKCiAgICAgICAgfQogICAgfSk7CgogICAgcmV0dXJuIFRoZW9PblNlcXVlbmNlVmlldzsKfSk7CgovKioKICogRXh0ZW5kcyBQZWFrTGlzdFBhaXJBbGlnbm1lbnQgZm9yIGEgcGFpciBvZiB0d28gRXhwU3BlY3RydW0KICogUHJvcGVydGllcyBhcmUKICogLSBzcGVjdHJ1bUEKICogLSBzcGVjdHJ1bUIKICoKICogYWxpZ25tZW50IGlzIHJlY29tcHV0ZWQgaWYgYW55IG9mIHRoZW0gdHJpZ2dlIGEgJ2NoYW5nZScgZXZlbnQKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCgpkZWZpbmUoJ2Zpc2h0b25lcy9tb2RlbHMvbWF0Y2gvU3BlY3RyYVBhaXJBbGlnbm1lbnQnLFsndW5kZXJzY29yZScsICcuL1BlYWtMaXN0UGFpckFsaWdubWVudCddLCBmdW5jdGlvbihfLCBQZWFrTGlzdFBhaXJBbGlnbm1lbnQpIHsKCiAgICAvKioKICAgICAqIGJ1aWxkIHRoZSBhbGlnbm1lbnQgd2l0aCBvcHRpb25zIHtyaWNoU2VxdWVuY2U6Li4uLCBleHBTcGVjdHJ1bTouLi59CiAgICAgKi8KICAgIHZhciBQU01BbGlnbm1lbnQgPSBQZWFrTGlzdFBhaXJBbGlnbm1lbnQuZXh0ZW5kKHsKICAgICAgICBpbml0aWFsaXplIDogZnVuY3Rpb24ob3B0aW9ucykgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIFBTTUFsaWdubWVudC5fX3N1cGVyX18uaW5pdGlhbGl6ZS5jYWxsKHRoaXMsIHt9KTsKICAgICAgICAgICAgc2VsZi5idWlsZCgpCgogICAgICAgICAgICBzZWxmLmdldCgnc3BlY3RydW1BJykub24oImNoYW5nZSIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgc2VsZi5idWlsZCgpCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIHNlbGYuZ2V0KCdzcGVjdHJ1bUInKS5vbigiY2hhbmdlIiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBzZWxmLmJ1aWxkKCkKICAgICAgICAgICAgfSkKICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICovCiAgICAgICAgYnVpbGQgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICAgICAgc2VsZi5zZXQoJ3BrbEEnLCBzZWxmLmdldCgnc3BlY3RydW1BJykpCiAgICAgICAgICAgIHNlbGYuc2V0KCdwa2xCJywgc2VsZi5nZXQoJ3NwZWN0cnVtQicpKQoKICAgICAgICAgICAgdmFyIG1hdGNoSW5kaWNlcyA9IHNlbGYubWF0Y2hJbmRpY2VzKCk7CgogICAgICAgICAgICB2YXIgeHBlYWtzQSA9IHNlbGYuZ2V0KCdzcGVjdHJ1bUEnKS5nZXQoJ21venMnKTsKICAgICAgICAgICAgdmFyIHhJbnRlbnNpdGllc0EgPSBzZWxmLmdldCgnc3BlY3RydW1BJykuZ2V0KCdpbnRlbnNpdHlSYW5rcycpOwogICAgICAgICAgICB2YXIgeHBlYWtzQiA9IHNlbGYuZ2V0KCdzcGVjdHJ1bUInKS5nZXQoJ21venMnKTsKICAgICAgICAgICAgdmFyIHhJbnRlbnNpdGllc0IgPSBzZWxmLmdldCgnc3BlY3RydW1CJykuZ2V0KCdpbnRlbnNpdHlSYW5rcycpOwoKICAgICAgICAgICAgdmFyIG1hdGNoZXMgPSBfLm1hcChtYXRjaEluZGljZXMsIGZ1bmN0aW9uKG1pKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgIHBrQiA6IHsKICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXggOiBtaS5pQiwKICAgICAgICAgICAgICAgICAgICAgICAgbW96IDogeHBlYWtzQlttaS5pQl0sCiAgICAgICAgICAgICAgICAgICAgICAgIGludGVuc2l0eVJhbmsgOiB4SW50ZW5zaXRpZXNCW21pLmlCXSwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHBrQSA6IHsKICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXggOiBtaS5pQSwKICAgICAgICAgICAgICAgICAgICAgICAgbW96IDogeHBlYWtzQVttaS5pQV0sCiAgICAgICAgICAgICAgICAgICAgICAgIGludGVuc2l0eVJhbmsgOiB4SW50ZW5zaXRpZXNBW21pLmlBXSwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIGVycm9yUFBNIDogbWkuZXJyb3JQUE0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICAgICAgc2VsZi5zZXQoJ21hdGNoZXMnLCBtYXRjaGVzKTsKCiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogQHJldHVybiBkaWZmZXJlbmNlIGJldHdlZW4gdGhlIGV4cGVyaW1lbnRhbCBhbmQgdGhlIHRoZW9yZXRpY2FsIHByZWN1cnNvcnMgKE1IKQogICAgICAgICAqLwogICAgICAgIGRlbHRhUHJlY01venMgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICB2YXIgeiA9IHNlbGYuZ2V0KCdleHBTcGVjdHJ1bScpLmdldCgncHJlY0NoYXJnZScpOwogICAgICAgICAgICB2YXIgdGhlbyA9IG1hc3NCdWlsZGVyLmNvbXB1dGVNYXNzUmljaFNlcXVlbmNlKHNlbGYuZ2V0KCdyaWNoU2VxdWVuY2UnKSwgeikKICAgICAgICAgICAgcmV0dXJuIChzZWxmLmdldCgnZXhwU3BlY3RydW0nKS5nZXQoJ3ByZWNNb3onKSAtIHRoZW8pICogegogICAgICAgIH0sCiAgICAgICAgLyoqCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIHt7fX0gcmVhZHkgZm9yIEpTT04KICAgICAgICAgKi8KICAgICAgICBzZXJpYWxpemUgOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICB2YXIgcmV0ID0ge307CiAgICAgICAgICAgIHJldC5leHBTcGVjdHJ1bSA9IHNlbGYuZ2V0KCdleHBTcGVjdHJ1bScpLnRvSlNPTigpCgogICAgICAgICAgICB2YXIgcnNlcSA9IHNlbGYuZ2V0KCdyaWNoU2VxdWVuY2UnKS50b1N0cmluZygpOwogICAgICAgICAgICByZXQucmljaFNlcXVlbmNlID0gcnNlcQoKICAgICAgICAgICAgcmV0LmlkID0gc2VsZi5jb21wdXRlSWQoKTsKICAgICAgICAgICAgcmV0LmFhU2VxdWVuY2UgPSBzZWxmLmdldCgncmljaFNlcXVlbmNlJykudG9BQVN0cmluZygpOwoKICAgICAgICAgICAgcmV0dXJuIHJldDsKICAgICAgICB9LAogICAgICAgIGNvbXB1dGVJZCA6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHJldHVybiBzZWxmLmdldCgnZXhwU3BlY3RydW0nKS5nZXQoJ2lkJykgKyAnfCcgKyBzZWxmLmdldCgncmljaFNlcXVlbmNlJykudG9TdHJpbmcoKQoKICAgICAgICB9LAogICAgICAgIC8qKgogICAgICAgICAqIHJldHVybiB0aGUgbnVtYmVyIG9mIHVubWFjdGhlZCBleHBlcmltZW50YWwgcGVhaywgd2l0aCBhIG1hc3MgZ3JlYXRlciB0aGFuIHRoZSBwcmVjdXJzb3IsCiAgICAgICAgICogaW50ZW5zaXR5IDwgaW5GaXJzdCBhbmQgd2l0aCB0b2wgZXJyb3IKICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gdG9sCiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGluRmlyc3QKICAgICAgICAgKi8KICAgICAgICB1bm1hdGNoZWRGYWN0b3IgOiBmdW5jdGlvbih0b2wsIGluRmlyc3QpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICB2YXIgbWF0Y2hlcyA9IHNlbGYuY2xvc2VyVGhhblBQTSh0b2wpOwoKICAgICAgICAgICAgdmFyIHBrcyA9IF8uZmlsdGVyKF8uemlwKHNlbGYuZ2V0KCdleHBTcGVjdHJ1bScpLmdldCgnbW96cycpLCBzZWxmLmdldCgnZXhwU3BlY3RydW0nKS5nZXQoJ2ludGVuc2l0eVJhbmtzJykpLCBmdW5jdGlvbihwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcFsxXSA8IGluRmlyc3QKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB2YXIgbVByZWMgPSBzZWxmLmdldCgnZXhwU3BlY3RydW0nKS5nZXQoJ3ByZWNNb3onKQogICAgICAgICAgICByZXR1cm4gXy5maWx0ZXIocGtzLCBmdW5jdGlvbihwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcFswXSA+IG1QcmVjOwogICAgICAgICAgICB9KS5sZW5ndGggLSBfLmZpbHRlcihtYXRjaGVzLCBmdW5jdGlvbihtKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gKG0uZXhwLmludGVuc2l0eVJhbmsgPCBpbkZpcnN0KSAmJiAobS5leHAubW96ID4gbVByZWMpOwogICAgICAgICAgICB9KS5sZW5ndGgKCiAgICAgICAgfQogICAgfSk7CgogICAgcmV0dXJuIFBTTUFsaWdubWVudDsKfSk7CgovKgogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KZGVmaW5lKCdmaXNodG9uZXMvdmlld3MvbWF0Y2gvU3BlY3RyYVBhaXJBbGlnbm1lbnRWaWV3JyxbJ3VuZGVyc2NvcmUnLCAnZDMnLCAnLi4vY29tbW9ucy9Db21tb25XaWRnZXRWaWV3JywgJ2Zpc2h0b25lcy92aWV3cy91dGlscy9EM1NjYWxpbmdDb250ZXh0JywgJ2Zpc2h0b25lcy92aWV3cy91dGlscy9EM1NjYWxpbmdBcmVhJ10sIGZ1bmN0aW9uKF8sIGQzLCBDb21tb25XaWRnZXRWaWV3LCBEM1NjYWxpbmdDb250ZXh0LCBEM1NjYWxpbmdBcmVhKSB7CiAgLyoKICAgKiBwcm9qZWN0ZWQgcGVha3MgY29udGFpbnMgNCB2YWx1ZXM6CiAgICoKICAgKiAwOiBtb3oKICAgKiAxOmludGVuc2l0eQogICAqIDI6IGludGVuc2l0eSByYW5rcwogICAqIDM6IGlzTWF0aGNpbmcgKCBjb25zdHJ1Y3RlZCBhdCB0aGUgYnVpbGREYXRhIHN0ZXApCiAgICovCiAgdmFyIHByb2plY3RTcGVjdHJ1bSA9IGZ1bmN0aW9uKGV4cFNwKSB7CiAgICByZXR1cm4gewogICAgICBwcmVjdXJzb3IgOiB7CiAgICAgICAgc2Nhbk51bWJlciA6IGV4cFNwLmdldCgnc2Nhbk51bWJlcicpLAogICAgICAgIGlkIDogZXhwU3AuZ2V0KCdpZCcpCiAgICAgIH0sCiAgICAgIHBlYWtzIDogXy5jaGFpbihleHBTcC5nZXQoJ21venMnKSkuemlwKGV4cFNwLmdldCgnaW50ZW5zaXRpZXMnKSwgZXhwU3AuZ2V0KCdpbnRlbnNpdHlSYW5rcycpKS52YWx1ZSgpCiAgICB9CiAgfQogIHZhciBwZWFrUmFua0NsYXNzID0gZnVuY3Rpb24ocGspIHsKICAgIHZhciBpcmsgPSBwa1syXTsKICAgIHJldHVybiAncmstJyArICgoaXJrIDwgNDApID8gTWF0aC5mbG9vcihpcmsgLyAxMCkgOiAneCcpOwogIH0KICB2YXIgU3BlY3RyYVBhaXJBbGlnbm1lbnRWaWV3ID0gQ29tbW9uV2lkZ2V0Vmlldy5leHRlbmQoewogICAgZGVmYXVsdHMgOiB7CiAgICB9LAogICAgaW5pdGlhbGl6ZSA6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgb3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCBvcHRpb25zKTsKICAgICAgU3BlY3RyYVBhaXJBbGlnbm1lbnRWaWV3Ll9fc3VwZXJfXy5pbml0aWFsaXplLmNhbGwodGhpcywgb3B0aW9ucykKICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICBzZWxmLmlzRW5oYW5jZWQgPSBvcHRpb25zLmVuaGFuY2VkOwogICAgICBzZWxmLm1heFJhbmtNYXRjaGluZ1BlYWtzID0gb3B0aW9ucy5tYXhQZWFrcyB8fCAxMDAwOwogICAgICBzZWxmLmluZGVwZW5kZW50WVNjYWxlcyA9IG9wdGlvbnMuaW5kZXBlbmRlbnRZU2NhbGVzOwogICAgICBzZWxmLmNvbG9yUGVha3MgPSBvcHRpb25zLmNvbG9yUGVha3M7CgogICAgICBzZWxmLmZyYWdUb2wgPSBvcHRpb25zLmZyYWdUb2wgfHwgMjA7CiAgICAgIHNlbGYuaGVpZ2h0TWlkZGxlWm9uZSA9IChzZWxmLmlzRW5oYW5jZWQpID8gKHNlbGYuaGVpZ2h0KCkgKiAwLjEpIDogMAoKICAgICAgc2VsZi5idWlsZCgpOwogICAgICBzZWxmLm1vZGVsLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbigpIHsKICAgICAgICBzZWxmLmJ1aWxkKCkucmVuZGVyKCk7CiAgICAgIH0pCiAgICB9LAoKICAgIGJ1aWxkIDogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiB0aGlzLmJ1aWxkRGF0YSgpLmJ1aWxkQ29udGV4dCgpLmJ1aWxkRDMoKTsKICAgIH0sCiAgICBidWlsZERhdGEgOiBmdW5jdGlvbigpIHsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICBzZWxmLnNwQSA9IHByb2plY3RTcGVjdHJ1bShzZWxmLm1vZGVsLmdldCgnc3BlY3RydW1BJykpOwogICAgICBzZWxmLnNwQiA9IHByb2plY3RTcGVjdHJ1bShzZWxmLm1vZGVsLmdldCgnc3BlY3RydW1CJykpOwoKICAgICAgaWYgKHNlbGYuaXNFbmhhbmNlZCkgewogICAgICAgIF8uZWFjaChzZWxmLm1vZGVsLmNsb3NlclRoYW5QUE0oc2VsZi5mcmFnVG9sKSwgZnVuY3Rpb24ocCkgewogICAgICAgICAgc2VsZi5zcEEucGVha3NbcC5wa0EuaW5kZXhdWzNdID0gdHJ1ZTsKICAgICAgICAgIHNlbGYuc3BCLnBlYWtzW3AucGtCLmluZGV4XVszXSA9IHRydWU7CiAgICAgICAgfSkKICAgICAgfQoKICAgICAgc2VsZi5hbGxQZWFrcyA9IHNlbGYuc3BBLnBlYWtzLm1hcChmdW5jdGlvbihwKSB7CiAgICAgICAgcFs0XSA9IDAKICAgICAgICByZXR1cm4gcDsKICAgICAgfSkuY29uY2F0KHNlbGYuc3BCLnBlYWtzLm1hcChmdW5jdGlvbihwKSB7CiAgICAgICAgcFs0XSA9IDEKICAgICAgICByZXR1cm4gcDsKICAgICAgfSkpCgogICAgICByZXR1cm4gc2VsZjsKICAgIH0sCiAgICBidWlsZENvbnRleHQgOiBmdW5jdGlvbigpIHsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgdmFyIHhNYXggPSBNYXRoLm1heChzZWxmLnNwQS5wZWFrc1tzZWxmLnNwQS5wZWFrcy5sZW5ndGgtMV1bMF0sIHNlbGYuc3BCLnBlYWtzW3NlbGYuc3BCLnBlYWtzLmxlbmd0aC0xXVswXSkgKiAxLjE7CiAgICAgIHZhciB4TWluID0gTWF0aC5tYXgoc2VsZi5zcEEucGVha3NbMF1bMF0sIHNlbGYuc3BCLnBlYWtzWzBdWzBdKSAqIDAuNTsKICAgICAgdmFyIHlNYXggPSBNYXRoLm1heChfLm1heChzZWxmLm1vZGVsLmdldCgnc3BlY3RydW1BJykuZ2V0KCdpbnRlbnNpdGllcycpKSwgXy5tYXgoc2VsZi5tb2RlbC5nZXQoJ3NwZWN0cnVtQicpLmdldCgnaW50ZW5zaXRpZXMnKSkpICogMS4wNTsKCiAgICAgIHNlbGYuc2V0dXBTY2FsaW5nQ29udGV4dCh7CiAgICAgICAgeERvbWFpbiA6IFt4TWluLCB4TWF4XSwKICAgICAgICB5RG9tYWluIDogWzAsIHlNYXhdLAogICAgICAgIGhlaWdodCA6IChzZWxmLmhlaWdodCgpIC0gc2VsZi5oZWlnaHRNaWRkbGVab25lKSAvIDIsCiAgICAgICAgd2lkdGggOiBzZWxmLndpZHRoKCkKICAgICAgfSkKCiAgICAgIHJldHVybiBzZWxmOwogICAgfSwKICAgIGJ1aWxkRDMgOiBmdW5jdGlvbigpIHsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgc2VsZi52aXMgPSBzZWxmLmVsLmFwcGVuZCgnc3ZnJyk7CiAgICAgIHNlbGYudmlzLmF0dHIoJ3dpZHRoJywgc2VsZi53aWR0aCgpKS5hdHRyKCdoZWlnaHQnLCBzZWxmLmhlaWdodCgpKS5hdHRyKCdjbGFzcycsICdzcGVjdHJhLXBhaXItYWxpZ25tZW50Jyk7CiAgICAgIHNlbGYudmlzLmFwcGVuZCgnbGluZScpLmF0dHIoJ3kxJywgc2VsZi5oZWlnaHQoKSAvIDIpLmF0dHIoJ3kyJywgc2VsZi5oZWlnaHQoKSAvIDIpLmF0dHIoJ3gxJywgMCkuYXR0cigneDInLCBzZWxmLndpZHRoKCkpLmF0dHIoJ2NsYXNzJywgJ2F4aXMnKQoKICAgICAgdmFyIHlzID0gW3NlbGYuc2NhbGluZ0NvbnRleHQueSgpLCBzZWxmLnNjYWxpbmdDb250ZXh0LnkoKV0KCiAgICAgIHlzWzFdLnJhbmdlKFsoc2VsZi5oZWlnaHQoKSArIHNlbGYuaGVpZ2h0TWlkZGxlWm9uZSkgLyAyLCBzZWxmLmhlaWdodCgpXSk7CiAgICAgIGlmIChzZWxmLmluZGVwZW5kZW50WVNjYWxlcykgewogICAgICAgIHlzWzBdLmRvbWFpbihbMCwgXy5tYXgoc2VsZi5tb2RlbC5nZXQoJ3NwZWN0cnVtQScpLmdldCgnaW50ZW5zaXRpZXMnKSkgKiAxLjA1XSkKICAgICAgICB5c1sxXS5kb21haW4oWzAsIF8ubWF4KHNlbGYubW9kZWwuZ2V0KCdzcGVjdHJ1bUInKS5nZXQoJ2ludGVuc2l0aWVzJykpICogMS4wNV0pCiAgICAgIH0KCiAgICAgIHZhciBqMHVwID0gKHNlbGYuaGVpZ2h0KCkgLSBzZWxmLmhlaWdodE1pZGRsZVpvbmUpIC8gMjsKICAgICAgdmFyIGowZG93biA9IChzZWxmLmhlaWdodCgpICsgc2VsZi5oZWlnaHRNaWRkbGVab25lKSAvIDI7CgogICAgICBzZWxmLnBlYWtzSG9sZGVyID0gc2VsZi52aXMuc2VsZWN0QWxsKCdsaW5lLnBlYWsnKS5kYXRhKHNlbGYuYWxsUGVha3MpLmVudGVyKCkuYXBwZW5kKCdsaW5lJykuYXR0cignY2xhc3MnLCBmdW5jdGlvbihwaykgewogICAgICAgIHZhciBjbCA9ICdwZWFrICBwZWFrLXgnOwogICAgICAgIGlmIChzZWxmLmNvbG9yUGVha3MpIHsKICAgICAgICAgIGNsICs9ICcgJyArIHBlYWtSYW5rQ2xhc3MocGspOwogICAgICAgIH0KICAgICAgICBpZiAoc2VsZi5pc0VuaGFuY2VkKSB7CiAgICAgICAgICBjbCArPSBwa1szXSA/ICIgbWF0Y2hlZCIgOiAiIHVubWF0Y2hlZCI7CiAgICAgICAgfQogICAgICAgIHJldHVybiBjbDsKICAgICAgfSkuYXR0cigneTEnLCBmdW5jdGlvbihwaykgewogICAgICAgIHJldHVybiB5c1twa1s0XV0oMCk7CiAgICAgICAgLy8ocGtbMV0gPiAwKSA/IGowdXAgOiBqMGRvd247CiAgICAgIH0pLmF0dHIoJ3kyJywgZnVuY3Rpb24ocGspIHsKICAgICAgICByZXR1cm4geXNbcGtbNF1dKHBrWzFdKS8vKHBrWzFdID4gMCkgPyAoajB1cCAtIHkocGtbMV0pKSA6IChqMGRvd24gKyB5KC1wa1sxXSkpOwogICAgICB9KTsKCiAgICAgIGlmIChzZWxmLmlzRW5oYW5jZWQpIHsKICAgICAgICBzZWxmLnZpcy5zZWxlY3RBbGwoJ2xpbmUucGVhay1tYXRjaCcpLmRhdGEoXy5maWx0ZXIoc2VsZi5zcEEucGVha3MuY29uY2F0KHNlbGYuc3BCLnBlYWtzKSwgZnVuY3Rpb24ocGspIHsKICAgICAgICAgIHJldHVybiBwa1szXSAmJiAocGtbMl0gPCBzZWxmLm1heFJhbmtNYXRjaGluZ1BlYWtzICk7CiAgICAgICAgfSkpLmVudGVyKCkuYXBwZW5kKCdsaW5lJykuYXR0cignY2xhc3MnLCBmdW5jdGlvbihwaykgewogICAgICAgICAgdmFyIGNsID0gJ3BlYWsgcGVhay1tYXRjaCBwZWFrLXgnOwogICAgICAgICAgY2wgKz0gJyAnICsgcGVha1JhbmtDbGFzcyhwayk7CiAgICAgICAgICByZXR1cm4gY2wKICAgICAgICB9KS5hdHRyKCd5MScsIHNlbGYuaGVpZ2h0KCkgLyAyKS5hdHRyKCd5MicsIGZ1bmN0aW9uKHBrKSB7CiAgICAgICAgICByZXR1cm4gKHBrWzRdID09IDApID8gajB1cCA6IGowZG93bjsKICAgICAgICB9KQogICAgICB9CgogICAgICB2YXIgZ3RpdGxlcyA9IHNlbGYudmlzLmFwcGVuZCgnZycpLmF0dHIoJ2NsYXNzJywgJ3RpdGxlcycpCiAgICAgIGd0aXRsZXMuYXBwZW5kKCd0ZXh0JykudGV4dCgnIycgKyBzZWxmLnNwQS5wcmVjdXJzb3Iuc2Nhbk51bWJlcikuYXR0cigneCcsIHNlbGYud2lkdGgoKSAtIDUpLmF0dHIoJ3knLCAzMCkuYXR0cignY2xhc3MnLCAnc2NhbiB0b3AnKQogICAgICBndGl0bGVzLmFwcGVuZCgndGV4dCcpLnRleHQoJyMnICsgc2VsZi5zcEIucHJlY3Vyc29yLnNjYW5OdW1iZXIpLmF0dHIoJ3gnLCBzZWxmLndpZHRoKCkgLSA1KS5hdHRyKCd5Jywgc2VsZi5oZWlnaHQoKSAtIDMwKS5hdHRyKCdjbGFzcycsICdzY2FuIGJvdHRvbScpCgogICAgICBzZWxmLmF4aXNDb250YWluZXIgPSBzZWxmLnZpcy5hcHBlbmQoJ2cnKS5hdHRyKCdjbGFzcycsICdheGlzJyk7CgogICAgICByZXR1cm4gc2VsZjsKICAgIH0sCiAgICByZW5kZXIgOiBmdW5jdGlvbigpIHsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICB2YXIgeCA9IHNlbGYuc2NhbGluZ0NvbnRleHQueCgpOwoKICAgICAgc2VsZi52aXMuc2VsZWN0QWxsKCdsaW5lLnBlYWsteCcpLmF0dHIoJ3gxJywgZnVuY3Rpb24ocGspIHsKICAgICAgICByZXR1cm4geChwa1swXSkKICAgICAgfSkuYXR0cigneDInLCBmdW5jdGlvbihwaykgewogICAgICAgIHJldHVybiB4KHBrWzBdKQogICAgICB9KTsKICAgICAgdmFyIHhBeGlzID0gZDMuc3ZnLmF4aXMoKS5zY2FsZSh4KS50aWNrU2l6ZSg2LCAwLCAwKS50aWNrcygzKS8vIiIudGlja0Zvcm1hdChkMy5mb3JtYXQoImQiKSk7CiAgICAgIHNlbGYuYXhpc0NvbnRhaW5lci5jYWxsKHhBeGlzKTsKICAgIH0KICB9KTsKCiAgcmV0dXJuIFNwZWN0cmFQYWlyQWxpZ25tZW50VmlldzsKCn0pCjsKLyoqCiAqIHRoaXMgaXMgYSBncmlkIGZvciBkaXNwbGF5aW5nIGEgc3BlY3RydW0vcGVwdGlkZSBtYXRjaC4gVGhlIGNsYXNzaWMgc3R1ZmYsIGFzCiAqIGEgaHRtbCB0YWJsZSwgYWRkaW5nIGNvbG9yIGFuZCBzby4uLgogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNCwgR2VuZW50ZWNoIEluYy4KICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KICogQXV0aG9yOiBBbGV4YW5kcmUgTWFzc2Vsb3QsIEJpb2luZm9ybWF0aWNzICYgQ29tcHV0YXRpb25hbCBCaW9sb2d5IERlcGFydG1lbnQsIEdlbmVudGVjaAogKi8KZGVmaW5lKCdmaXNodG9uZXMvdmlld3MvbWF0Y2gvTWF0Y2hHcmlkVmFsdWVzVmlldycsWyd1bmRlcnNjb3JlJywgJ0JhY2tib25lJywgJy4uL2NvbW1vbnMvQ29tbW9uV2lkZ2V0VmlldyddLCBmdW5jdGlvbiAoXywgQmFja2JvbmUsIENvbW1vbldpZGdldFZpZXcpIHsKCiAgICBNYXRjaEdyaWRWYWx1ZXNWaWV3ID0gQ29tbW9uV2lkZ2V0Vmlldy5leHRlbmQoewogICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgTWF0Y2hHcmlkVmFsdWVzVmlldy5fX3N1cGVyX18uaW5pdGlhbGl6ZS5jYWxsKHRoaXMsIGFyZ3VtZW50cykKCiAgICAgICAgICAgIG9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgb3B0aW9ucyk7CiAgICAgICAgICAgIHNlbGYuaGVpZ2h0ID0gb3B0aW9ucy5oZWlnaHQgfHwgNDAwOwogICAgICAgICAgICBzZWxmLndpZHRoID0gb3B0aW9ucy53aWR0aCB8fCAzMDA7CiAgICAgICAgICAgIHNlbGYudG9sID0gb3B0aW9ucy50b2wgfHwgNTAwOwoKICAgICAgICAgICAgc2VsZi5lbC5jbGFzc2VkKCdkMy13aWRnZXQtbWF0Y2gtZ3JpZC12YWx1ZXMnLCB0cnVlKQogICAgICAgIH0sCiAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoKSB7CgogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICAgICAgICB2YXIgdGhlb1NwZWN0cnVtID0gc2VsZi5tb2RlbC5nZXQoJ3RoZW9TcGVjdHJ1bScpOwogICAgICAgICAgICB2YXIgbmJTZXJpZXMgPSB0aGVvU3BlY3RydW0uZ2V0KCdmcmFnU2VyaWVzJykubGVuZ3RoCgogICAgICAgICAgICBzZWxmLmVsLmFwcGVuZCgncmVjdCcpLmF0dHIoJ2NsYXNzJywgJ2JhY2tncm91bmQnKS5hdHRyKCd3aWR0aCcsIHNlbGYud2lkdGgpLmF0dHIoJ2hlaWdodCcsIHNlbGYuaGVpZ2h0KQogICAgICAgICAgICAvLyBnZXQgZnJhZyBzZXJpZXMgLT4gb3JkaW5hdGUKICAgICAgICAgICAgdmFyIHNlcmllczJpID0ge307CiAgICAgICAgICAgIHZhciBpX2MgPSAwOwogICAgICAgICAgICB2YXIgaV9uID0gMDsKICAgICAgICAgICAgXy5lYWNoKHRoZW9TcGVjdHJ1bS5nZXQoJ2ZyYWdTZXJpZXMnKSwgZnVuY3Rpb24gKGZzKSB7CiAgICAgICAgICAgICAgICBpZiAoZnMgPCAnbScpIHsvLyBudGVybQogICAgICAgICAgICAgICAgICAgIGlfbiA9IGlfbiAtIDM7CiAgICAgICAgICAgICAgICAgICAgc2VyaWVzMmlbZnNdID0gaV9uICsgMjsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaV9jID0gaV9jICsgMwogICAgICAgICAgICAgICAgICAgIHNlcmllczJpW2ZzXSA9IGlfYyArIDI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLy8gd2UgaGF2ZSB0byBzY2FsZSBbMDood2lkdGggLSAyKjEwKV0geCBbMC1oZWlnaHRdIHRvIFtpX246aV9jKzFdIHgKICAgICAgICAgICAgLy8gWy0xOiB0aGVvU3BlY3RydW0ucmljaFNlcXVlbmNlLnNpemUoKV0KICAgICAgICAgICAgdmFyIHJpY2hTZXEgPSB0aGVvU3BlY3RydW0uZ2V0KCdyaWNoU2VxdWVuY2UnKTsKICAgICAgICAgICAgdmFyIHNpemUgPSByaWNoU2VxLnNpemUoKTsKCiAgICAgICAgICAgIHZhciBzY2FsZSA9IE1hdGgubWluKCgoc2VsZi53aWR0aCkgLyAoaV9jICsgMSAtIGlfbiArIDMpKSwgKHNlbGYuaGVpZ2h0IC8gKHNpemUgKyAxKSkpOwogICAgICAgICAgICB2YXIgdHJhbnNmID0gJ3NjYWxlKCcgKyBzY2FsZSArICcsJyArIHNjYWxlICsgJyksdHJhbnNsYXRlKCcgKyAoLWlfbiArIDEpICsgJywxLjcpJzsKCiAgICAgICAgICAgIHZhciBnQ29udCA9IHNlbGYuZWwuYXBwZW5kKCdnJykuYXR0cigndHJhbnNmb3JtJywgdHJhbnNmKTsKCiAgICAgICAgICAgIHZhciBmczJpID0gZnVuY3Rpb24gKGZzKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc2VyaWVzMmlbZnNdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIGRhdGEgbWF0Y2hlcwogICAgICAgICAgICB2YXIgZG1hdGNoZXMgPSBzZWxmLm1vZGVsLmNsb3NlclRoYW5QUE0oc2VsZi50b2wpOwoKICAgICAgICAgICAgZ0NvbnQuc2VsZWN0QWxsKCd0ZXh0LmFhJykuZGF0YShyaWNoU2VxLmdldCgnc2VxdWVuY2UnKSkuZW50ZXIoKS5hcHBlbmQoJ3RleHQnKS5hdHRyKCdjbGFzcycsICdhYScpLmF0dHIoJ3gnLCAxKS5hdHRyKCd5JywgZnVuY3Rpb24gKGQsIGkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBpICsgMC41CiAgICAgICAgICAgIH0pLnRleHQoZnVuY3Rpb24gKGQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBkLmFhLmdldCgnY29kZTEnKQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHZhciBtb2RpZnMgPSBbcmljaFNlcS5nZXRNb2RpZmljYXRpb25BcnJheSgtMSldLmNvbmNhdChfLmNvbGxlY3QocmljaFNlcS5nZXQoJ3NlcXVlbmNlJyksIGZ1bmN0aW9uIChyYWEpIHsKICAgICAgICAgICAgICAgIHJldHVybiByYWEubW9kaWZpY2F0aW9ucwogICAgICAgICAgICB9KSkuY29uY2F0KFtyaWNoU2VxLmdldE1vZGlmaWNhdGlvbkFycmF5KHNpemUpXSk7CiAgICAgICAgICAgIGdDb250LnNlbGVjdEFsbCgndGV4dC5hYS1tb2RpZicpLmRhdGEobW9kaWZzKS5lbnRlcigpLmFwcGVuZCgndGV4dCcpLmF0dHIoJ2NsYXNzJywgJ2FhLW1vZGlmJykuYXR0cigneCcsIDEpLmF0dHIoJ3knLCBmdW5jdGlvbiAoZCwgaSkgewogICAgICAgICAgICAgICAgaWYgKGkgPT0gc2l6ZSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBpICsgMC4zMiAtIDAuNSArIDAuNQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGkgKyAwLjMyIC0gMSArIDAuNTsKICAgICAgICAgICAgfSkudGV4dChmdW5jdGlvbiAobW9kcykgewogICAgICAgICAgICAgICAgaWYgKG1vZHMgPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICcnCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gXy5jb2xsZWN0KG1vZHMsIGZ1bmN0aW9uIChtKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG0uZ2V0KCduYW1lJyk7CiAgICAgICAgICAgICAgICB9KS5qb2luKCcsJyk7CgogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGdDb250LnNlbGVjdEFsbCgndGV4dC5zZXJpZXMnKS5kYXRhKHRoZW9TcGVjdHJ1bS5nZXQoJ2ZyYWdTZXJpZXMnKSkuZW50ZXIoKS5hcHBlbmQoJ3RleHQnKS5hdHRyKCdjbGFzcycsICdzZXJpZXMnKS5hdHRyKCd4JywgZnVuY3Rpb24gKGQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBzZXJpZXMyaVtkXTsKICAgICAgICAgICAgfSkuYXR0cigneScsIC0xKS50ZXh0KGZ1bmN0aW9uIChkKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZDsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB2YXIgcG9zbGFiID0gW107CiAgICAgICAgICAgIGZvciAoaSA9IDE7IGkgPD0gc2l6ZTsgaSsrKSB7CiAgICAgICAgICAgICAgICBwb3NsYWIucHVzaChpKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGdDb250LnNlbGVjdEFsbCgndGV4dC5wb3NsYWJlbC5udGVybScpLmRhdGEocG9zbGFiKS5lbnRlcigpLmFwcGVuZCgndGV4dCcpLmF0dHIoJ2NsYXNzJywgJ3Bvc2xhYmVsIG50ZXJtJykuYXR0cigneCcsIGlfbiAtIDAuOSkuYXR0cigneScsIGZ1bmN0aW9uIChkLCBpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gaSArIDEKICAgICAgICAgICAgfSkudGV4dChmdW5jdGlvbiAoZCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGQKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGdDb250LnNlbGVjdEFsbCgndGV4dC5wb3NsYWJlbC5jdGVybScpLmRhdGEocG9zbGFiKS5lbnRlcigpLmFwcGVuZCgndGV4dCcpLmF0dHIoJ2NsYXNzJywgJ3Bvc2xhYmVsIGN0ZXJtJykuYXR0cigneCcsIGlfYyArIDIuOSkuYXR0cigneScsIGZ1bmN0aW9uIChkLCBpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc2l6ZSAtIGkgLSAxCiAgICAgICAgICAgIH0pLnRleHQoZnVuY3Rpb24gKGQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBkCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgZ0NvbnQuc2VsZWN0QWxsKCd0ZXh0LnRoZW9mcmFnJykuZGF0YSh0aGVvU3BlY3RydW0uZ2V0KCdwZWFrcycpKS5lbnRlcigpLmFwcGVuZCgndGV4dCcpLmF0dHIoJ2NsYXNzJywgJ3RoZW9mcmFnJykuYXR0cigneCcsIGZ1bmN0aW9uIChwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc2VyaWVzMmlbcC5zZXJpZXNdCiAgICAgICAgICAgIH0pLmF0dHIoJ3knLCBmdW5jdGlvbiAocCkgewogICAgICAgICAgICAgICAgcmV0dXJuIChwLnNlcmllcyA8ICdnJykgPyAocC5wb3MgKyAxKSA6IHAucG9zCiAgICAgICAgICAgIH0pLnRleHQoZnVuY3Rpb24gKHApIHsKICAgICAgICAgICAgICAgIHJldHVybiBwLm1vei50b0ZpeGVkKDIpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGdDb250LnNlbGVjdEFsbCgncmVjdC5tYXRjaGluZycpLmRhdGEoZG1hdGNoZXMpLmVudGVyKCkuYXBwZW5kKCdyZWN0JykuYXR0cignY2xhc3MnLCBmdW5jdGlvbiAoZCkgewogICAgICAgICAgICAgICAgdmFyIGlyayA9IGQuZXhwLmludGVuc2l0eVJhbms7CiAgICAgICAgICAgICAgICByZXR1cm4gIm1hdGNoaW5nIHJrLSIgKyAoKGlyayA8IDQwKSA/IE1hdGguZmxvb3IoaXJrIC8gMTApIDogJ3gnKQogICAgICAgICAgICB9KS5hdHRyKCd4JywgZnVuY3Rpb24gKGQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBzZXJpZXMyaVtkLnRoZW8uc2VyaWVzXSAtIDIuOAogICAgICAgICAgICB9KS5hdHRyKCd5JywgZnVuY3Rpb24gKGQpIHsKICAgICAgICAgICAgICAgIHJldHVybiAoZC50aGVvLnNlcmllcyA8ICdnJykgPyAoZC50aGVvLnBvcyAtIDAuNyArIDEpIDogKGQudGhlby5wb3MgLSAwLjcpOwogICAgICAgICAgICB9KS5hdHRyKCd3aWR0aCcsIDMpLmF0dHIoJ2hlaWdodCcsIDEpOwogICAgICAgIH0KICAgIH0pOwoKICAgIHJldHVybiBNYXRjaEdyaWRWYWx1ZXNWaWV3Owp9KTsKCi8qCiAqIGEgY29tcGFjdCBpY29uaWMgdmlldyBvZiBTcGVjdHJ1bS9TcGVjdHJ1bSBhbGlnbm1lbnQKICoKICogQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQsIEdlbmVudGVjaCBJbmMuCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIEF1dGhvcjogQWxleGFuZHJlIE1hc3NlbG90LCBCaW9pbmZvcm1hdGljcyAmIENvbXB1dGF0aW9uYWwgQmlvbG9neSBEZXBhcnRtZW50LCBHZW5lbnRlY2gKICovCmRlZmluZSgnZmlzaHRvbmVzL3ZpZXdzL21hdGNoL1NwZWN0cmFQYWlyQWxpZ25tZW50SWNvbicsWyd1bmRlcnNjb3JlJywgJ2QzJywgJy4uL2NvbW1vbnMvQ29tbW9uV2lkZ2V0VmlldycsICdmaXNodG9uZXMvdXRpbHMvRGVsdGFNYXNzJywgJ2Zpc2h0b25lcy92aWV3cy91dGlscy9EM1NjYWxpbmdDb250ZXh0JywgJ2Zpc2h0b25lcy92aWV3cy91dGlscy9EM1NjYWxpbmdBcmVhJ10sIGZ1bmN0aW9uIChfLCBkMywgQ29tbW9uV2lkZ2V0VmlldywgRGVsdGFNYXNzLCBEM1NjYWxpbmdDb250ZXh0LCBEM1NjYWxpbmdBcmVhKSB7CgogICAgdmFyIHByb2plY3RTcGVjdHJ1bSA9IGZ1bmN0aW9uIChleHBTcCwgc2FtcGxlKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgcHJlY3Vyc29yOiB7CiAgICAgICAgICAgICAgICBzY2FuTnVtYmVyOiBleHBTcC5nZXQoJ3NjYW5OdW1iZXInKSwKICAgICAgICAgICAgICAgIGlkOiBleHBTcC5nZXQoJ2lkJykKICAgICAgICAgICAgfSwKICAgICAgICAgICAgcGVha3M6IF8uY2hhaW4oZXhwU3AuZ2V0KCdtb3pzJykpLnppcChleHBTcC5nZXQoJ2ludGVuc2l0aWVzJyksIGV4cFNwLmdldCgnaW50ZW5zaXR5UmFua3MnKSkubWFwKGZ1bmN0aW9uIChwLCBpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgIG1vejogcFswXSwKICAgICAgICAgICAgICAgICAgICBpbnRlbnNpdHlSYW5rOiBwWzJdLAogICAgICAgICAgICAgICAgICAgIG9yaWdJbmRleDogaSwKICAgICAgICAgICAgICAgICAgICBzYW1wbGU6IHNhbXBsZQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSkudmFsdWUoKQogICAgICAgIH0KICAgIH0KICAgIHZhciBTcGVjdHJhUGFpckFsaWdubWVudEljb24gPSBDb21tb25XaWRnZXRWaWV3LmV4dGVuZCh7CiAgICAgICAgZGVmYXVsdHM6IHsKICAgICAgICB9LAogICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgICAgICAgIG9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgb3B0aW9ucyk7CiAgICAgICAgICAgIFNwZWN0cmFQYWlyQWxpZ25tZW50SWNvbi5fX3N1cGVyX18uaW5pdGlhbGl6ZS5jYWxsKHRoaXMsIG9wdGlvbnMpCiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgICAgICAgIHNlbGYubWF4UGVha3MgPSBvcHRpb25zLm1heFBlYWtzIHx8IDUwOwogICAgICAgICAgICBzZWxmLmZyYWdUb2wgPSBvcHRpb25zLmZyYWdUb2wgfHwgMjA7CgogICAgICAgICAgICBzZWxmLmJ1aWxkKCk7CiAgICAgICAgICAgIHNlbGYubW9kZWwub24oJ2NoYW5nZScsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHNlbGYuYnVpbGQoKS5yZW5kZXIoKTsKICAgICAgICAgICAgfSkKICAgICAgICB9LAogICAgICAgIGJ1aWxkOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmJ1aWxkRGF0YSgpLmJ1aWxkQ29udGV4dCgpLmJ1aWxkRDMoKTsKICAgICAgICB9LAogICAgICAgIGJ1aWxkRGF0YTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIHNlbGYuc3BBID0gcHJvamVjdFNwZWN0cnVtKHNlbGYubW9kZWwuZ2V0KCdzcGVjdHJ1bUEnKSwgMCk7CiAgICAgICAgICAgIHNlbGYuc3BCID0gcHJvamVjdFNwZWN0cnVtKHNlbGYubW9kZWwuZ2V0KCdzcGVjdHJ1bUInKSwgMSk7CgogICAgICAgICAgICAvL2xhYmVsIHRoZSBwZWFrcwogICAgICAgICAgICB2YXIgcGtCaW5zID0gWwogICAgICAgICAgICAgICAgW10sCiAgICAgICAgICAgICAgICBbXQogICAgICAgICAgICBdCgogICAgICAgICAgICAvL29uZSBwcm9qZWN0ZWQgcGVha3MgY29udGFpbnMgW21veiwgaW50ZW5zaXR5LCBpbnRlbnNpdHlSYW5rLCBpc01hdGNoaW5nLCBzYW1wbGVOYW1lLCBvdmVyYWxsTnVtYmVyXQoKICAgICAgICAgICAgc2VsZi5zb3J0ZWRNYXRjaGVkUGVha3MgPSBfLmNoYWluKHNlbGYuc3BBLnBlYWtzLmNvbmNhdChzZWxmLnNwQi5wZWFrcykpLmZpbHRlcihmdW5jdGlvbiAocCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHAuaW50ZW5zaXR5UmFuayA8IHNlbGYubWF4UGVha3M7CiAgICAgICAgICAgIH0pLnNvcnRCeShmdW5jdGlvbiAocCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHAubW96OwogICAgICAgICAgICB9KS5tYXAoZnVuY3Rpb24gKHAsIGkpIHsKICAgICAgICAgICAgICAgIHAuYmluSW5kZXggPSBpOwogICAgICAgICAgICAgICAgcC5tYXRjaGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICBwa0JpbnNbcC5zYW1wbGVdW3Aub3JpZ0luZGV4XSA9IGk7CiAgICAgICAgICAgICAgICByZXR1cm4gcDsKICAgICAgICAgICAgfSkudmFsdWUoKTsKCiAgICAgICAgICAgIHZhciBtYXRjaGVzID0gc2VsZi5tb2RlbC5jbG9zZXJUaGFuUFBNKHNlbGYuZnJhZ1RvbCk7CiAgICAgICAgICAgIF8uZWFjaChtYXRjaGVzLCBmdW5jdGlvbiAobSkgewogICAgICAgICAgICAgICAgaWYgKChtLnBrQi5pbnRlbnNpdHlSYW5rID49IHNlbGYubWF4UGVha3MpIHx8IChtLnBrQS5pbnRlbnNpdHlSYW5rID49IHNlbGYubWF4UGVha3MpKQogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIHNlbGYuc29ydGVkTWF0Y2hlZFBlYWtzLnB1c2goewogICAgICAgICAgICAgICAgICAgIHNhbXBsZTogMSwKICAgICAgICAgICAgICAgICAgICBiaW5JbmRleDogcGtCaW5zWzBdW20ucGtBLmluZGV4XSwKICAgICAgICAgICAgICAgICAgICBpbnRlbnNpdHlSYW5rOiBtLnBrQi5pbnRlbnNpdHlSYW5rLAogICAgICAgICAgICAgICAgICAgIG1hdGNoZWQ6IHRydWUKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgc2VsZi5zb3J0ZWRNYXRjaGVkUGVha3MucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgc2FtcGxlOiAwLAogICAgICAgICAgICAgICAgICAgIGJpbkluZGV4OiBwa0JpbnNbMV1bbS5wa0IuaW5kZXhdLAogICAgICAgICAgICAgICAgICAgIGludGVuc2l0eVJhbms6IG0ucGtBLmludGVuc2l0eVJhbmssCiAgICAgICAgICAgICAgICAgICAgbWF0Y2hlZDogdHJ1ZQogICAgICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICAgICBzZWxmLnNvcnRlZE1hdGNoZWRQZWFrc1twa0JpbnNbMV1bbS5wa0IuaW5kZXhdXS5tYXRjaGVkID0gdHJ1ZQogICAgICAgICAgICAgICAgc2VsZi5zb3J0ZWRNYXRjaGVkUGVha3NbcGtCaW5zWzBdW20ucGtBLmluZGV4XV0ubWF0Y2hlZCA9IHRydWUKCgogICAgICAgICAgICB9KQoKICAgICAgICAgICAgcmV0dXJuIHNlbGY7CiAgICAgICAgfSwKICAgICAgICBidWlsZENvbnRleHQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgICAgICAgc2VsZi5zY2FsaW5nQ29udGV4dCA9IG5ldyBEM1NjYWxpbmdDb250ZXh0KHsKICAgICAgICAgICAgICAgIHhEb21haW46IFswLCAyICogc2VsZi5tYXhQZWFrc10sCiAgICAgICAgICAgICAgICB5RG9tYWluOiBbMiwgMF0sCiAgICAgICAgICAgICAgICBoZWlnaHQ6IHNlbGYuaGVpZ2h0KCksCiAgICAgICAgICAgICAgICB3aWR0aDogc2VsZi53aWR0aCgpCiAgICAgICAgICAgIH0pCgogICAgICAgICAgICByZXR1cm4gc2VsZjsKICAgICAgICB9LAogICAgICAgIGJ1aWxkRDM6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgICAgICBzZWxmLnZpcyA9IHNlbGYuZWwuYXBwZW5kKCdzdmcnKTsKICAgICAgICAgICAgc2VsZi52aXMuYXR0cignd2lkdGgnLCBzZWxmLndpZHRoKCkpLmF0dHIoJ2hlaWdodCcsIHNlbGYuaGVpZ2h0KCkpLmF0dHIoJ2NsYXNzJywgJ3NwZWN0cmEtcGFpci1pY29uJyk7CiAgICAgICAgICAgIHNlbGYudmlzLmFwcGVuZCgncmVjdCcpLmF0dHIoJ2NsYXNzJywgJ2JhY2tncm91bmQnKS5hdHRyKCdoZWlnaHQnLCAnMTAwJScpLmF0dHIoJ3dpZHRoJywgJzEwMCUnKTsKCiAgICAgICAgICAgIHNlbGYucGVha3NIb2xkZXIgPSBzZWxmLnZpcy5zZWxlY3RBbGwoJ3JlY3QucGVhay1iaW4nKS5kYXRhKHNlbGYuc29ydGVkTWF0Y2hlZFBlYWtzKS5lbnRlcigpLmFwcGVuZCgncmVjdCcpLmF0dHIoJ2NsYXNzJywgJ3BlYWstYmluJyk7CiAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgIH0sCiAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIHggPSBzZWxmLnNjYWxpbmdDb250ZXh0LngoKTsKICAgICAgICAgICAgdmFyIHkgPSBzZWxmLnNjYWxpbmdDb250ZXh0LnkoKTsKCiAgICAgICAgICAgIHNlbGYucGVha3NIb2xkZXIuYXR0cigneCcsIGZ1bmN0aW9uIChwaykgewogICAgICAgICAgICAgICAgLy8gaWYocGtbNF09PSdCJyAmJiBwWzNdKXsKICAgICAgICAgICAgICAgIC8vIHJldHVybiB4KHBrWzVdLTEpCiAgICAgICAgICAgICAgICAvLyB9CiAgICAgICAgICAgICAgICByZXR1cm4geChway5iaW5JbmRleCkKICAgICAgICAgICAgfSkuYXR0cignd2lkdGgnLCBmdW5jdGlvbiAocGspIHsKICAgICAgICAgICAgICAgIHJldHVybiB4KDEpCiAgICAgICAgICAgIH0pLmF0dHIoJ2hlaWdodCcsIHkoMSkpLmF0dHIoJ3knLCBmdW5jdGlvbiAocGspIHsKICAgICAgICAgICAgICAgIHJldHVybiB5KHBrLnNhbXBsZSkKICAgICAgICAgICAgfSkuYXR0cignY2xhc3MnLCBmdW5jdGlvbiAocGspIHsKICAgICAgICAgICAgICAgIHZhciBpcmsgPSBway5pbnRlbnNpdHlSYW5rOwogICAgICAgICAgICAgICAgdmFyIGNsID0gJ3NwZWN0cmEtcGFpci1pY29uLWJpbiByay0nICsgKChpcmsgPCA0MCkgPyBNYXRoLmZsb29yKGlyayAvIDEwKSA6ICd4Jyk7CiAgICAgICAgICAgICAgICBpZiAocGsubWF0Y2hlZCkKICAgICAgICAgICAgICAgICAgICBjbCArPSAiIG1hdGNoZWQiCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgY2wgKz0gIiB1bm1hdGNoZWQiCiAgICAgICAgICAgICAgICByZXR1cm4gY2w7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH0pOwoKICAgIHJldHVybiBTcGVjdHJhUGFpckFsaWdubWVudEljb247Cgp9KTsKLyoqCiAqIHdyYXBwIGFsbCBleHBvc2VkIGZ1bmN0aW9uIGhhbmRsZXJzIGFuZCBwcm90b3R5cGVzCiAqCiAqIHRoZXJlIGlzIHNvbWUgcmVwZXRpdGlvbiBhbmQgc29tZSBvcmRlci4gQnV0IEkgY2Fubm90IGZpZ3VyZSBvdXQgd2hhdCBpcyBoYXBwZW5pbmcgd2l0aCBhbG1vbmQsIHdoaWNoIGxvb2sgbGlrZSBpdCBkb2VzIG5vdCBpbnRlcnByZXQgJ2RlZmluZScgaW4gc29tZSBjYXNzaWMgd2F5Li4uCiAqCiAqIENvcHlyaWdodCAoYykgMjAxMy0yMDE0LCBHZW5lbnRlY2ggSW5jLgogKiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiBBdXRob3I6IEFsZXhhbmRyZSBNYXNzZWxvdCwgQmlvaW5mb3JtYXRpY3MgJiBDb21wdXRhdGlvbmFsIEJpb2xvZ3kgRGVwYXJ0bWVudCwgR2VuZW50ZWNoCiAqLwoKKGZ1bmN0aW9uICgpIHsKICAgIGRlZmluZSgnanF1ZXJ5LXBsdXMnLCBbJ2pxdWVyeScsICdib290c3RyYXAnLCAndHlwZWFoZWFkJywgJ2pRdWVyeUNvb2tpZSddLCBmdW5jdGlvbiAoJCkgewogICAgICAgIHJldHVybiAkOwogICAgfSk7CgogICAgdmFyIGV4cG9ydGVkID0gewogICAgICAgIHdldDogWydDb25maWcnLCAnZmlzaHRvbmVzL21vZGVscy93ZXQvRXhwTVNNU1NwZWN0cnVtJywgJ2Zpc2h0b25lcy9jb2xsZWN0aW9ucy93ZXQvRXhwTVNNU1NwZWN0cnVtQ29sbGVjdGlvbicsICdmaXNodG9uZXMvbW9kZWxzL3dldC9NU01TUnVuJywgJ2Zpc2h0b25lcy9tb2RlbHMvd2V0L0luamVjdGlvbicsICdmaXNodG9uZXMvbW9kZWxzL3dldC9FeHBlcmltZW50JywgJ2Zpc2h0b25lcy9jb2xsZWN0aW9ucy93ZXQvWElDQ29sbGVjdGlvbicsICdmaXNodG9uZXMvdmlld3Mvd2V0L1hJQ1ZpZXcnLCAnZmlzaHRvbmVzL3ZpZXdzL3dldC9NdWx0aVhJQ1ZpZXcnLCAnZmlzaHRvbmVzL3ZpZXdzL3dldC9YSUNNdWx0aVBhbmVWaWV3JywgJ2Zpc2h0b25lcy92aWV3cy93ZXQvU3BlY3RydW1WaWV3J10sCiAgICAgICAgZHJ5OiBbJ2Zpc2h0b25lcy9tb2RlbHMvZHJ5L1JpY2hTZXF1ZW5jZScsICdmaXNodG9uZXMvc2VydmljZXMvZHJ5L0ltcGxpY2l0TW9kaWZpZXInLCAnZmlzaHRvbmVzL3NlcnZpY2VzL2RyeS9NYXNzQnVpbGRlcicsICdmaXNodG9uZXMvc2VydmljZXMvZHJ5L1JpY2hTZXF1ZW5jZVNob3J0Y3V0ZXInLCAnZmlzaHRvbmVzL2NvbGxlY3Rpb25zL2RyeS9SZXNpZHVlTW9kaWZpY2F0aW9uRGljdGlvbmFyeScsICdmaXNodG9uZXMvY29sbGVjdGlvbnMvZHJ5L0FtaW5vQWNpZERpY3Rpb25hcnknLCAnZmlzaHRvbmVzL3ZpZXdzL2RyeS9mb3Jtcy9SaWNoU2VxdWVuY2VJbnB1dCcsICdmaXNodG9uZXMvdmlld3MvZHJ5L1RoZW9PblNlcXVlbmNlVmlldyddLAogICAgICAgIG1hdGNoOiBbJ2Zpc2h0b25lcy9tb2RlbHMvbWF0Y2gvU3BlY3RyYVBhaXJBbGlnbm1lbnQnLCAnZmlzaHRvbmVzL3ZpZXdzL21hdGNoL1NwZWN0cmFQYWlyQWxpZ25tZW50VmlldycsICdmaXNodG9uZXMvbW9kZWxzL21hdGNoL1BTTUFsaWdubWVudCcsICdmaXNodG9uZXMvdmlld3MvbWF0Y2gvTWF0Y2hTcGVjdHJ1bVZpZXcnLCAnZmlzaHRvbmVzL3ZpZXdzL21hdGNoL01hdGNoR3JpZFZhbHVlc1ZpZXcnLCAnZmlzaHRvbmVzL3ZpZXdzL21hdGNoL01hdGNoTWFwUFFWaWV3JywgJ2Zpc2h0b25lcy92aWV3cy9tYXRjaC9NYXRjaE1hcFNsaW1WaWV3JywgJ2Zpc2h0b25lcy92aWV3cy9tYXRjaC9TcGVjdHJhUGFpckFsaWdubWVudEljb24nXSwKICAgICAgICB1dGlsczogWydmaXNodG9uZXMvdmlld3MvdXRpbHMvRDNTY2FsaW5nQ29udGV4dCcsICdmaXNodG9uZXMvdXRpbHMvRGVsdGFNYXNzJ10KICAgIH0KCiAgICBjb25zdCBjbGFzc1BhdGhzID0gW107CiAgICB2YXIgYWxsID0gW107CiAgICB2YXIgdHlwZTJjYXQgPSB7fTsKCiAgICBbJ3dldCcsICdkcnknLCAnbWF0Y2gnLCAndXRpbHMnXS5mb3JFYWNoKGZ1bmN0aW9uIChjYXQpIHsKICAgICAgICB2YXIgbCA9IGV4cG9ydGVkW2NhdF07CiAgICAgICAgZm9yIChpIGluIGwpIHsKICAgICAgICAgICAgdmFyIHR5cGUgPSBsW2ldOwogICAgICAgICAgICB0eXBlMmNhdFt0eXBlXSA9IGNhdDsKICAgICAgICAgICAgYWxsLnB1c2godHlwZSk7CiAgICAgICAgfQogICAgfSk7CgogICAgdmFyIGJ1aWxkRXhwb3J0ID0gZnVuY3Rpb24gKF8pIHsKICAgICAgICB2YXIgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cyk7CiAgICAgICAgdmFyICQgPSBhcmdzLnNoaWZ0KCk7CiAgICAgICAgdmFyIGV4cCA9IHt9CiAgICAgICAgZm9yIChpIGluIGFsbCkgewogICAgICAgICAgICB2YXIgYXJnID0gYXJnc1tpXTsKICAgICAgICAgICAgdmFyIHR5cGUgPSBhbGxbaV0KICAgICAgICAgICAgdmFyIHNpbXBsZU5hbWUgPSB0eXBlLnJlcGxhY2UoLy4qXC8vLCAnJyk7CiAgICAgICAgICAgIHZhciBjYXQgPSB0eXBlMmNhdFt0eXBlXTsKCiAgICAgICAgICAgIGlmIChleHBbY2F0XSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBleHBbY2F0XSA9IHt9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGV4cFtjYXRdW3NpbXBsZU5hbWVdID0gYXJnc1tpXTsKICAgICAgICB9CiAgICAgICAgZXhwLmRlcHMgPSB7CiAgICAgICAgICAgICckJzogJAogICAgICAgIH07CiAgICAgICAgcmV0dXJuIGV4cDsKICAgIH07CgogICAgZGVmaW5lKCdNU01TSlNFeHBvcnQnLFsKICAgICAgICAnanF1ZXJ5JywKICAgICAgICAnQ29uZmlnJywgJ2Zpc2h0b25lcy9tb2RlbHMvd2V0L0V4cE1TTVNTcGVjdHJ1bScsICdmaXNodG9uZXMvY29sbGVjdGlvbnMvd2V0L0V4cE1TTVNTcGVjdHJ1bUNvbGxlY3Rpb24nLCAnZmlzaHRvbmVzL21vZGVscy93ZXQvTVNNU1J1bicsICdmaXNodG9uZXMvbW9kZWxzL3dldC9JbmplY3Rpb24nLCAnZmlzaHRvbmVzL21vZGVscy93ZXQvRXhwZXJpbWVudCcsICdmaXNodG9uZXMvY29sbGVjdGlvbnMvd2V0L1hJQ0NvbGxlY3Rpb24nLCAnZmlzaHRvbmVzL3ZpZXdzL3dldC9YSUNWaWV3JywgJ2Zpc2h0b25lcy92aWV3cy93ZXQvTXVsdGlYSUNWaWV3JywgJ2Zpc2h0b25lcy92aWV3cy93ZXQvWElDTXVsdGlQYW5lVmlldycsICdmaXNodG9uZXMvdmlld3Mvd2V0L1NwZWN0cnVtVmlldycsCiAgICAgICAgJ2Zpc2h0b25lcy9tb2RlbHMvZHJ5L1JpY2hTZXF1ZW5jZScsICdmaXNodG9uZXMvc2VydmljZXMvZHJ5L0ltcGxpY2l0TW9kaWZpZXInLCAnZmlzaHRvbmVzL3NlcnZpY2VzL2RyeS9NYXNzQnVpbGRlcicsICdmaXNodG9uZXMvc2VydmljZXMvZHJ5L1JpY2hTZXF1ZW5jZVNob3J0Y3V0ZXInLCAnZmlzaHRvbmVzL2NvbGxlY3Rpb25zL2RyeS9SZXNpZHVlTW9kaWZpY2F0aW9uRGljdGlvbmFyeScsICdmaXNodG9uZXMvY29sbGVjdGlvbnMvZHJ5L0FtaW5vQWNpZERpY3Rpb25hcnknLCAnZmlzaHRvbmVzL3ZpZXdzL2RyeS9mb3Jtcy9SaWNoU2VxdWVuY2VJbnB1dCcsICdmaXNodG9uZXMvdmlld3MvZHJ5L1RoZW9PblNlcXVlbmNlVmlldycsCiAgICAgICAgJ2Zpc2h0b25lcy9tb2RlbHMvbWF0Y2gvU3BlY3RyYVBhaXJBbGlnbm1lbnQnLCAnZmlzaHRvbmVzL3ZpZXdzL21hdGNoL1NwZWN0cmFQYWlyQWxpZ25tZW50VmlldycsICdmaXNodG9uZXMvbW9kZWxzL21hdGNoL1BTTUFsaWdubWVudCcsICdmaXNodG9uZXMvdmlld3MvbWF0Y2gvTWF0Y2hTcGVjdHJ1bVZpZXcnLCAnZmlzaHRvbmVzL3ZpZXdzL21hdGNoL01hdGNoR3JpZFZhbHVlc1ZpZXcnLCAnZmlzaHRvbmVzL3ZpZXdzL21hdGNoL01hdGNoTWFwUFFWaWV3JywgJ2Zpc2h0b25lcy92aWV3cy9tYXRjaC9NYXRjaE1hcFNsaW1WaWV3JywgJ2Zpc2h0b25lcy92aWV3cy9tYXRjaC9TcGVjdHJhUGFpckFsaWdubWVudEljb24nLAogICAgICAgICdmaXNodG9uZXMvdmlld3MvdXRpbHMvRDNTY2FsaW5nQ29udGV4dCcsICdmaXNodG9uZXMvdXRpbHMvRGVsdGFNYXNzJywKICAgIF0sIGJ1aWxkRXhwb3J0KTsKCn0pKCk7CgogICAgcmV0dXJuIHJlcXVpcmUoJ01TTVNKU0V4cG9ydCcpOwp9KSk7",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Fri, 07 Nov 2014 00:21:24 GMT",
                    "Content-Length": "898731",
                    "Date": "Fri, 07 Nov 2014 00:21:25 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}