{
    "url": "http://localhost:9999/woothemes/woocommerce/apigen/templates/woodocs/js/main.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Open redirection (DOM-based)",
    "issueType": 5243152,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based open redirection vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the target of a redirection in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause a redirection to an arbitrary external domain. This behavior can be leveraged to facilitate phishing attacks against users of the application. The ability to use an authentic application URL, targeting the correct domain with a valid SSL certificate (if SSL is used) lends credibility to the phishing attack because many users, even if they verify these features, will not notice the subsequent redirection to a different domain.<br><br><b>Note:</b> If an attacker is able to control the start of the string that is passed to the redirection API, then it may be possible to escalate this vulnerability into a JavaScript injection attack, by using a URL with the javascript: pseudo-protocol to execute arbitrary script code when the URL is processed by the browser.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based open redirection vulnerabilities is not to dynamically set redirection targets using data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing an arbitrary URL as a redirection target. In general, this is best achieved by using a whitelist of URLs that are permitted redirection targets, and strictly validating the target against this list before performing the redirection.",
    "issueDetail": "The application may be vulnerable to DOM-based open redirection. Data is read from <b>window.location.href</b> and written to <b>window.location</b> via the following statements:<ul><li>var location = window.location.href.split('/');</li><li>window.location = location.join('/');</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/woothemes/woocommerce/apigen/templates/woodocs/js/main.js",
                "path": "/woothemes/woocommerce/apigen/templates/woodocs/js/main.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC93b290aGVtZXMvd29vY29tbWVyY2UvYXBpZ2VuL3RlbXBsYXRlcy93b29kb2NzL2pzL21haW4uanMgSFRUUC8xLjENCkhvc3Q6IGxvY2FsaG9zdDo5OTk5DQoNCg==",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogODE1MQ0KQWNjZXB0LVJhbmdlczogYnl0ZXMNCkNvbnRlbnQtVHlwZTogYXBwbGljYXRpb24vamF2YXNjcmlwdA0KRGF0ZTogU3VuLCAwOSBOb3YgMjAxNCAwMzowODoyMiBHTVQNCkxhc3QtTW9kaWZpZWQ6IFN1biwgMDkgTm92IDIwMTQgMDM6MDg6MjEgR01UDQoNCi8qIQogKiBBcGlHZW4gMi44LjAgLSBBUEkgZG9jdW1lbnRhdGlvbiBnZW5lcmF0b3IgZm9yIFBIUCA1LjMrCiAqCiAqIENvcHlyaWdodCAoYykgMjAxMC0yMDExIERhdmlkIEdydWRsIChodHRwOi8vZGF2aWRncnVkbC5jb20pCiAqIENvcHlyaWdodCAoYykgMjAxMS0yMDEyIEphcm9zbGF2IEhhbnNsw61rIChodHRwczovL2dpdGh1Yi5jb20va3VrdWxpY2gpCiAqIENvcHlyaWdodCAoYykgMjAxMS0yMDEyIE9uZMWZZWogTmXFoXBvciAoaHR0cHM6Ly9naXRodWIuY29tL0FuZHJld3N2aWxsZSkKICogQ29weXJpZ2h0IChjKSAyMDEyIE9saXZpZXIgTGF2aWFsZSAoaHR0cHM6Ly9naXRodWIuY29tL29sdmx2bCkKICoKICogRm9yIHRoZSBmdWxsIGNvcHlyaWdodCBhbmQgbGljZW5zZSBpbmZvcm1hdGlvbiwgcGxlYXNlIHZpZXcKICogdGhlIGZpbGUgTElDRU5TRS5tZCB0aGF0IHdhcyBkaXN0cmlidXRlZCB3aXRoIHRoaXMgc291cmNlIGNvZGUuCiAqLwoKJChmdW5jdGlvbigpIHsKCXZhciAkZG9jdW1lbnQgPSAkKGRvY3VtZW50KTsKCXZhciAkbmF2aWdhdGlvbiA9ICQoJyNuYXZpZ2F0aW9uJyk7Cgl2YXIgbmF2aWdhdGlvbkhlaWdodCA9ICQoJyNuYXZpZ2F0aW9uJykuaGVpZ2h0KCk7Cgl2YXIgJGxlZnQgPSAkKCcjbGVmdCcpOwoJdmFyICRyaWdodCA9ICQoJyNyaWdodCcpOwoJdmFyICRyaWdodElubmVyID0gJCgnI3JpZ2h0SW5uZXInKTsKCXZhciAkc3BsaXR0ZXIgPSAkKCcjc3BsaXR0ZXInKTsKCXZhciAkZ3JvdXBzID0gJCgnI2dyb3VwcycpOwoJdmFyICRjb250ZW50ID0gJCgnI2NvbnRlbnQnKTsKCgkvLyBNZW51CgoJLy8gSGlkZSBkZWVwIHBhY2thZ2VzIGFuZCBuYW1lc3BhY2VzCgkkKCd1bCBzcGFuJywgJGdyb3VwcykuY2xpY2soZnVuY3Rpb24oZXZlbnQpIHsKCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoJCWV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOwoJCSQodGhpcykKCQkJLnRvZ2dsZUNsYXNzKCdjb2xsYXBzZWQnKQoJCQkucGFyZW50KCkKCQkJCS5uZXh0KCd1bCcpCgkJCQkJLnRvZ2dsZUNsYXNzKCdjb2xsYXBzZWQnKTsKCX0pLmNsaWNrKCk7CgoJJGFjdGl2ZSA9ICQoJ3VsIGxpLmFjdGl2ZScsICRncm91cHMpOwoJaWYgKCRhY3RpdmUubGVuZ3RoID4gMCkgewoJCS8vIE9wZW4gYWN0aXZlCgkJJCgnPiBhID4gc3BhbicsICRhY3RpdmUpLmNsaWNrKCk7Cgl9IGVsc2UgewoJCSRtYWluID0gJCgnPiB1bCA+IGxpLm1haW4nLCAkZ3JvdXBzKTsKCQlpZiAoJG1haW4ubGVuZ3RoID4gMCkgewoJCQkvLyBPcGVuIGZpcnN0IGxldmVsIG9mIHRoZSBtYWluIHByb2plY3QKCQkJJCgnPiBhID4gc3BhbicsICRtYWluKS5jbGljaygpOwoJCX0gZWxzZSB7CgkJCS8vIE9wZW4gZmlyc3QgbGV2ZWwgb2YgYWxsCgkJCSQoJz4gdWwgPiBsaSA+IGEgPiBzcGFuJywgJGdyb3VwcykuY2xpY2soKTsKCQl9Cgl9CgoJLy8gQ29udGVudAoKCS8vIFNlYXJjaCBhdXRvY29tcGxldGlvbgoJdmFyIGF1dG9jb21wbGV0ZUZvdW5kID0gZmFsc2U7Cgl2YXIgYXV0b2NvbXBsZXRlRmlsZXMgPSB7J2MnOiAnY2xhc3MnLCAnY28nOiAnY29uc3RhbnQnLCAnZic6ICdmdW5jdGlvbicsICdtJzogJ2NsYXNzJywgJ21tJzogJ2NsYXNzJywgJ3AnOiAnY2xhc3MnLCAnbXAnOiAnY2xhc3MnLCAnY2MnOiAnY2xhc3MnfTsKCXZhciAkc2VhcmNoID0gJCgnI3NlYXJjaCBpbnB1dFtuYW1lPXFdJyk7Cgkkc2VhcmNoCgkJLmF1dG9jb21wbGV0ZShBcGlHZW4uZWxlbWVudHMsIHsKCQkJbWF0Y2hDb250YWluczogdHJ1ZSwKCQkJc2Nyb2xsSGVpZ2h0OiAyMDAsCgkJCW1heDogMjAsCgkJCWZvcm1hdEl0ZW06IGZ1bmN0aW9uKGRhdGEpIHsKCQkJCXJldHVybiBkYXRhWzFdLnJlcGxhY2UoL14oLitcXCkoLispJC8sICc8c3Bhbj48c21hbGw+JDE8L3NtYWxsPiQyPC9zcGFuPicpOwoJCQl9LAoJCQlmb3JtYXRNYXRjaDogZnVuY3Rpb24oZGF0YSkgewoJCQkJcmV0dXJuIGRhdGFbMV07CgkJCX0sCgkJCWZvcm1hdFJlc3VsdDogZnVuY3Rpb24oZGF0YSkgewoJCQkJcmV0dXJuIGRhdGFbMV07CgkJCX0sCgkJCXNob3c6IGZ1bmN0aW9uKCRsaXN0KSB7CgkJCQl2YXIgJGl0ZW1zID0gJCgnbGkgc3BhbicsICRsaXN0KTsKCQkJCXZhciBtYXhXaWR0aCA9IE1hdGgubWF4LmFwcGx5KG51bGwsICRpdGVtcy5tYXAoZnVuY3Rpb24oKSB7CgkJCQkJcmV0dXJuICQodGhpcykud2lkdGgoKTsKCQkJCX0pKTsKCQkJCS8vIDEwcHggcGFkZGluZwoJCQkJJGxpc3Qud2lkdGgoTWF0aC5tYXgobWF4V2lkdGggKyAxMCwgJHNlYXJjaC5pbm5lcldpZHRoKCkpKTsKCQkJfQoJCX0pLnJlc3VsdChmdW5jdGlvbihldmVudCwgZGF0YSkgewoJCQlhdXRvY29tcGxldGVGb3VuZCA9IHRydWU7CgkJCXZhciBsb2NhdGlvbiA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmLnNwbGl0KCcvJyk7CgkJCWxvY2F0aW9uLnBvcCgpOwoJCQl2YXIgcGFydHMgPSBkYXRhWzFdLnNwbGl0KC86OnwkLyk7CgkJCXZhciBmaWxlID0gJC5zcHJpbnRmKEFwaUdlbi5jb25maWcudGVtcGxhdGVzLm1haW5bYXV0b2NvbXBsZXRlRmlsZXNbZGF0YVswXV1dLmZpbGVuYW1lLCBwYXJ0c1swXS5yZXBsYWNlKC9cKFwpLywgJycpLnJlcGxhY2UoL1teXHddL2csICcuJykpOwoJCQlpZiAocGFydHNbMV0pIHsKCQkJCWZpbGUgKz0gJyMnICsgKCdtbScgPT09IGRhdGFbMF0gfHwgJ21wJyA9PT0gZGF0YVswXSA/ICdtJyA6ICcnKSArIHBhcnRzWzFdLnJlcGxhY2UoLyhbXHddKylcKFwpLywgJ18kMScpOwoJCQl9CgkJCWxvY2F0aW9uLnB1c2goZmlsZSk7CgkJCXdpbmRvdy5sb2NhdGlvbiA9IGxvY2F0aW9uLmpvaW4oJy8nKTsKCgkJCS8vIFdvcmthcm91bmQgZm9yIE9wZXJhIGJ1ZwoJCQkkKHRoaXMpLmNsb3Nlc3QoJ2Zvcm0nKS5hdHRyKCdhY3Rpb24nLCBsb2NhdGlvbi5qb2luKCcvJykpOwoJCX0pLmNsb3Nlc3QoJ2Zvcm0nKQoJCQkuc3VibWl0KGZ1bmN0aW9uKCkgewoJCQkJdmFyIHF1ZXJ5ID0gJHNlYXJjaC52YWwoKTsKCQkJCWlmICgnJyA9PT0gcXVlcnkpIHsKCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQl9CgoJCQkJdmFyIGxhYmVsID0gJCgnI3NlYXJjaCBpbnB1dFtuYW1lPW1vcmVdJykudmFsKCk7CgkJCQlpZiAoIWF1dG9jb21wbGV0ZUZvdW5kICYmIGxhYmVsICYmIC0xID09PSBxdWVyeS5pbmRleE9mKCdtb3JlOicpKSB7CgkJCQkJJHNlYXJjaC52YWwocXVlcnkgKyAnIG1vcmU6JyArIGxhYmVsKTsKCQkJCX0KCgkJCQlyZXR1cm4gIWF1dG9jb21wbGV0ZUZvdW5kICYmICcnICE9PSAkKCcjc2VhcmNoIGlucHV0W25hbWU9Y3hdJykudmFsKCk7CgkJCX0pOwoKCS8vIFNhdmUgbmF0dXJhbCBvcmRlcgoJJCgndGFibGUuc3VtbWFyeSB0cltkYXRhLW9yZGVyXScsICRjb250ZW50KS5lYWNoKGZ1bmN0aW9uKGluZGV4KSB7CgkJZG8gewoJCQlpbmRleCA9ICcwJyArIGluZGV4OwoJCX0gd2hpbGUgKGluZGV4Lmxlbmd0aCA8IDMpOwoJCSQodGhpcykuYXR0cignZGF0YS1vcmRlci1uYXR1cmFsJywgaW5kZXgpOwoJfSk7CgoJLy8gU3dpdGNoIGJldHdlZW4gbmF0dXJhbCBhbmQgYWxwaGFiZXRpY2FsIG9yZGVyCgl2YXIgJGNhcHRpb24gPSAkKCd0YWJsZS5zdW1tYXJ5JywgJGNvbnRlbnQpCgkJLmZpbHRlcignOmhhcyh0cltkYXRhLW9yZGVyXSknKQoJCQkucHJldignaDInKTsKCSRjYXB0aW9uCgkJLmNsaWNrKGZ1bmN0aW9uKCkgewoJCQl2YXIgJHRoaXMgPSAkKHRoaXMpOwoJCQl2YXIgb3JkZXIgPSAkdGhpcy5kYXRhKCdvcmRlcicpIHx8ICduYXR1cmFsJzsKCQkJb3JkZXIgPSAnbmF0dXJhbCcgPT09IG9yZGVyID8gJ2FscGhhYmV0aWNhbCcgOiAnbmF0dXJhbCc7CgkJCSR0aGlzLmRhdGEoJ29yZGVyJywgb3JkZXIpOwoJCQkkLmNvb2tpZSgnb3JkZXInLCBvcmRlciwge2V4cGlyZXM6IDM2NX0pOwoJCQl2YXIgYXR0ciA9ICdhbHBoYWJldGljYWwnID09PSBvcmRlciA/ICdkYXRhLW9yZGVyJyA6ICdkYXRhLW9yZGVyLW5hdHVyYWwnOwoJCQkkdGhpcwoJCQkJLm5leHQoJ3RhYmxlJykKCQkJCQkuZmluZCgndHInKS5zb3J0RWxlbWVudHMoZnVuY3Rpb24oYSwgYikgewoJCQkJCQlyZXR1cm4gJChhKS5hdHRyKGF0dHIpID4gJChiKS5hdHRyKGF0dHIpID8gMSA6IC0xOwoJCQkJCX0pOwoJCQlyZXR1cm4gZmFsc2U7CgkJfSkKCQkuYWRkQ2xhc3MoJ3N3aXRjaGFibGUnKQoJCS5hdHRyKCd0aXRsZScsICdTd2l0Y2ggYmV0d2VlbiBuYXR1cmFsIGFuZCBhbHBoYWJldGljYWwgb3JkZXInKTsKCWlmICgobnVsbCA9PT0gJC5jb29raWUoJ29yZGVyJykgJiYgJ2FscGhhYmV0aWNhbCcgPT09IEFwaUdlbi5jb25maWcub3B0aW9ucy5lbGVtZW50c09yZGVyKSB8fCAnYWxwaGFiZXRpY2FsJyA9PT0gJC5jb29raWUoJ29yZGVyJykpIHsKCQkkY2FwdGlvbi5jbGljaygpOwoJfQoKCS8vIE9wZW4gZGV0YWlscwoJaWYgKEFwaUdlbi5jb25maWcub3B0aW9ucy5lbGVtZW50RGV0YWlsc0NvbGxhcHNlZCkgewoJCSQoJ3RyJywgJGNvbnRlbnQpLmZpbHRlcignOmhhcyguZGV0YWlsZWQpJykKCQkJLmNsaWNrKGZ1bmN0aW9uKCkgewoJCQkJdmFyICR0aGlzID0gJCh0aGlzKTsKCQkJCSQoJy5zaG9ydCcsICR0aGlzKS5oaWRlKCk7CgkJCQkkKCcuZGV0YWlsZWQnLCAkdGhpcykuc2hvdygpOwoJCQl9KTsKCX0KCgkvLyBTcGxpdHRlcgoJdmFyIHNwbGl0dGVyV2lkdGggPSAkc3BsaXR0ZXIud2lkdGgoKTsKCWZ1bmN0aW9uIHNldFNwbGl0dGVyUG9zaXRpb24ocG9zaXRpb24pCgl7CgkJJGxlZnQud2lkdGgocG9zaXRpb24pOwoJCSRyaWdodC5jc3MoJ21hcmdpbi1sZWZ0JywgcG9zaXRpb24gKyBzcGxpdHRlcldpZHRoKTsKCQkkc3BsaXR0ZXIuY3NzKCdsZWZ0JywgcG9zaXRpb24pOwoJfQoJZnVuY3Rpb24gc2V0TmF2aWdhdGlvblBvc2l0aW9uKCkKCXsKCQl2YXIgaGVpZ2h0ID0gJCh3aW5kb3cpLmhlaWdodCgpIC0gbmF2aWdhdGlvbkhlaWdodDsKCQkkbGVmdC5oZWlnaHQoaGVpZ2h0KTsKCQkkc3BsaXR0ZXIuaGVpZ2h0KGhlaWdodCk7CgkJJHJpZ2h0LmhlaWdodChoZWlnaHQpOwoJfQoJZnVuY3Rpb24gc2V0Q29udGVudFdpZHRoKCkKCXsKCQl2YXIgd2lkdGggPSAkcmlnaHRJbm5lci53aWR0aCgpOwoJCSRyaWdodElubmVyCgkJCS50b2dnbGVDbGFzcygnbWVkaXVtJywgd2lkdGggPD0gOTYwKQoJCQkudG9nZ2xlQ2xhc3MoJ3NtYWxsJywgd2lkdGggPD0gNjUwKTsKCX0KCSRzcGxpdHRlci5tb3VzZWRvd24oZnVuY3Rpb24oKSB7CgkJCSRzcGxpdHRlci5hZGRDbGFzcygnYWN0aXZlJyk7CgoJCQkkZG9jdW1lbnQubW91c2Vtb3ZlKGZ1bmN0aW9uKGV2ZW50KSB7CgkJCQlpZiAoZXZlbnQucGFnZVggPj0gMjMwICYmICRkb2N1bWVudC53aWR0aCgpIC0gZXZlbnQucGFnZVggPj0gNjAwICsgc3BsaXR0ZXJXaWR0aCkgewoJCQkJCXNldFNwbGl0dGVyUG9zaXRpb24oZXZlbnQucGFnZVgpOwoJCQkJCXNldENvbnRlbnRXaWR0aCgpOwoJCQkJfQoJCQl9KTsKCgkJCSQoKQoJCQkJLmFkZCgkc3BsaXR0ZXIpCgkJCQkuYWRkKCRkb2N1bWVudCkKCQkJCQkubW91c2V1cChmdW5jdGlvbigpIHsKCQkJCQkJJHNwbGl0dGVyCgkJCQkJCQkucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpCgkJCQkJCQkudW5iaW5kKCdtb3VzZXVwJyk7CgkJCQkJCSRkb2N1bWVudAoJCQkJCQkJLnVuYmluZCgnbW91c2Vtb3ZlJykKCQkJCQkJCS51bmJpbmQoJ21vdXNldXAnKTsKCgkJCQkJCSQuY29va2llKCdzcGxpdHRlcicsIHBhcnNlSW50KCRzcGxpdHRlci5jc3MoJ2xlZnQnKSksIHtleHBpcmVzOiAzNjV9KTsKCQkJCQl9KTsKCgkJCXJldHVybiBmYWxzZTsKCQl9KTsKCXZhciBzcGxpdHRlclBvc2l0aW9uID0gJC5jb29raWUoJ3NwbGl0dGVyJyk7CglpZiAobnVsbCAhPT0gc3BsaXR0ZXJQb3NpdGlvbikgewoJCXNldFNwbGl0dGVyUG9zaXRpb24ocGFyc2VJbnQoc3BsaXR0ZXJQb3NpdGlvbikpOwoJfQoJc2V0TmF2aWdhdGlvblBvc2l0aW9uKCk7CglzZXRDb250ZW50V2lkdGgoKTsKCSQod2luZG93KQoJCS5yZXNpemUoc2V0TmF2aWdhdGlvblBvc2l0aW9uKQoJCS5yZXNpemUoc2V0Q29udGVudFdpZHRoKTsKCgkvLyBTZWxlY3Qgc2VsZWN0ZWQgbGluZXMKCXZhciBtYXRjaGVzID0gd2luZG93LmxvY2F0aW9uLmhhc2guc3Vic3RyKDEpLm1hdGNoKC9eXGQrKD86LVxkKyk/KD86LFxkKyg/Oi1cZCspPykqJC8pOwoJaWYgKG51bGwgIT09IG1hdGNoZXMpIHsKCQl2YXIgbGlzdHMgPSBtYXRjaGVzWzBdLnNwbGl0KCcsJyk7CgkJZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0cy5sZW5ndGg7IGkrKykgewoJCQl2YXIgbGluZXMgPSBsaXN0c1tpXS5zcGxpdCgnLScpOwoJCQlsaW5lc1sxXSA9IGxpbmVzWzFdIHx8IGxpbmVzWzBdOwoJCQlmb3IgKHZhciBqID0gbGluZXNbMF07IGogPD0gbGluZXNbMV07IGorKykgewoJCQkJJCgnIycgKyBqKS5hZGRDbGFzcygnc2VsZWN0ZWQnKTsKCQkJfQoJCX0KCgkJdmFyICRmaXJzdExpbmUgPSAkKCcjJyArIHBhcnNlSW50KG1hdGNoZXNbMF0pKTsKCQlpZiAoJGZpcnN0TGluZS5sZW5ndGggPiAwKSB7CgkJCSRyaWdodC5zY3JvbGxUb3AoJGZpcnN0TGluZS5vZmZzZXQoKS50b3ApOwoJCX0KCX0KCgkvLyBTYXZlIHNlbGVjdGVkIGxpbmVzCgl2YXIgbGFzdExpbmU7CgkkKCdhLmwnKS5jbGljayhmdW5jdGlvbihldmVudCkgewoJCWV2ZW50LnByZXZlbnREZWZhdWx0KCk7CgoJCXZhciAkc2VsZWN0ZWRMaW5lID0gJCh0aGlzKS5wYXJlbnQoKTsKCQl2YXIgc2VsZWN0ZWRMaW5lID0gcGFyc2VJbnQoJHNlbGVjdGVkTGluZS5hdHRyKCdpZCcpKTsKCgkJaWYgKGV2ZW50LnNoaWZ0S2V5KSB7CgkJCWlmIChsYXN0TGluZSkgewoJCQkJZm9yICh2YXIgaSA9IE1hdGgubWluKHNlbGVjdGVkTGluZSwgbGFzdExpbmUpOyBpIDw9IE1hdGgubWF4KHNlbGVjdGVkTGluZSwgbGFzdExpbmUpOyBpKyspIHsKCQkJCQkkKCcjJyArIGkpLmFkZENsYXNzKCdzZWxlY3RlZCcpOwoJCQkJfQoJCQl9IGVsc2UgewoJCQkJJHNlbGVjdGVkTGluZS5hZGRDbGFzcygnc2VsZWN0ZWQnKTsKCQkJfQoJCX0gZWxzZSBpZiAoZXZlbnQuY3RybEtleSkgewoJCQkkc2VsZWN0ZWRMaW5lLnRvZ2dsZUNsYXNzKCdzZWxlY3RlZCcpOwoJCX0gZWxzZSB7CgkJCXZhciAkc2VsZWN0ZWQgPSAkKCcubC5zZWxlY3RlZCcpCgkJCQkubm90KCRzZWxlY3RlZExpbmUpCgkJCQkucmVtb3ZlQ2xhc3MoJ3NlbGVjdGVkJyk7CgkJCWlmICgkc2VsZWN0ZWQubGVuZ3RoID4gMCkgewoJCQkJJHNlbGVjdGVkTGluZS5hZGRDbGFzcygnc2VsZWN0ZWQnKTsKCQkJfSBlbHNlIHsKCQkJCSRzZWxlY3RlZExpbmUudG9nZ2xlQ2xhc3MoJ3NlbGVjdGVkJyk7CgkJCX0KCQl9CgoJCWxhc3RMaW5lID0gJHNlbGVjdGVkTGluZS5oYXNDbGFzcygnc2VsZWN0ZWQnKSA/IHNlbGVjdGVkTGluZSA6IG51bGw7CgoJCS8vIFVwZGF0ZSBoYXNoCgkJdmFyIGxpbmVzID0gJCgnLmwuc2VsZWN0ZWQnKQoJCQkubWFwKGZ1bmN0aW9uKCkgewoJCQkJcmV0dXJuIHBhcnNlSW50KCQodGhpcykuYXR0cignaWQnKSk7CgkJCX0pCgkJCS5nZXQoKQoJCQkuc29ydChmdW5jdGlvbihhLCBiKSB7CgkJCQlyZXR1cm4gYSAtIGI7CgkJCX0pOwoKCQl2YXIgaGFzaCA9IFtdOwoJCXZhciBsaXN0ID0gW107CgkJZm9yICh2YXIgaiA9IDA7IGogPCBsaW5lcy5sZW5ndGg7IGorKykgewoJCQlpZiAoMCA9PT0gaiAmJiBqICsgMSA9PT0gbGluZXMubGVuZ3RoKSB7CgkJCQloYXNoLnB1c2gobGluZXNbal0pOwoJCQl9IGVsc2UgaWYgKDAgPT09IGopIHsKCQkJCWxpc3RbMF0gPSBsaW5lc1tqXTsKCQkJfSBlbHNlIGlmIChsaW5lc1tqIC0gMV0gKyAxICE9PSBsaW5lc1tqXSAmJiBqICsgMSA9PT0gbGluZXMubGVuZ3RoKSB7CgkJCQloYXNoLnB1c2gobGlzdC5qb2luKCctJykpOwoJCQkJaGFzaC5wdXNoKGxpbmVzW2pdKTsKCQkJfSBlbHNlIGlmIChsaW5lc1tqIC0gMV0gKyAxICE9PSBsaW5lc1tqXSkgewoJCQkJaGFzaC5wdXNoKGxpc3Quam9pbignLScpKTsKCQkJCWxpc3QgPSBbbGluZXNbal1dOwoJCQl9IGVsc2UgaWYgKGogKyAxID09PSBsaW5lcy5sZW5ndGgpIHsKCQkJCWxpc3RbMV0gPSBsaW5lc1tqXTsKCQkJCWhhc2gucHVzaChsaXN0LmpvaW4oJy0nKSk7CgkJCX0gZWxzZSB7CgkJCQlsaXN0WzFdID0gbGluZXNbal07CgkJCX0KCQl9CgoJCXdpbmRvdy5sb2NhdGlvbi5oYXNoID0gaGFzaC5qb2luKCcsJyk7Cgl9KTsKfSk7Cg==",
                "body": "LyohCiAqIEFwaUdlbiAyLjguMCAtIEFQSSBkb2N1bWVudGF0aW9uIGdlbmVyYXRvciBmb3IgUEhQIDUuMysKICoKICogQ29weXJpZ2h0IChjKSAyMDEwLTIwMTEgRGF2aWQgR3J1ZGwgKGh0dHA6Ly9kYXZpZGdydWRsLmNvbSkKICogQ29weXJpZ2h0IChjKSAyMDExLTIwMTIgSmFyb3NsYXYgSGFuc2zDrWsgKGh0dHBzOi8vZ2l0aHViLmNvbS9rdWt1bGljaCkKICogQ29weXJpZ2h0IChjKSAyMDExLTIwMTIgT25kxZllaiBOZcWhcG9yIChodHRwczovL2dpdGh1Yi5jb20vQW5kcmV3c3ZpbGxlKQogKiBDb3B5cmlnaHQgKGMpIDIwMTIgT2xpdmllciBMYXZpYWxlIChodHRwczovL2dpdGh1Yi5jb20vb2x2bHZsKQogKgogKiBGb3IgdGhlIGZ1bGwgY29weXJpZ2h0IGFuZCBsaWNlbnNlIGluZm9ybWF0aW9uLCBwbGVhc2UgdmlldwogKiB0aGUgZmlsZSBMSUNFTlNFLm1kIHRoYXQgd2FzIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyBzb3VyY2UgY29kZS4KICovCgokKGZ1bmN0aW9uKCkgewoJdmFyICRkb2N1bWVudCA9ICQoZG9jdW1lbnQpOwoJdmFyICRuYXZpZ2F0aW9uID0gJCgnI25hdmlnYXRpb24nKTsKCXZhciBuYXZpZ2F0aW9uSGVpZ2h0ID0gJCgnI25hdmlnYXRpb24nKS5oZWlnaHQoKTsKCXZhciAkbGVmdCA9ICQoJyNsZWZ0Jyk7Cgl2YXIgJHJpZ2h0ID0gJCgnI3JpZ2h0Jyk7Cgl2YXIgJHJpZ2h0SW5uZXIgPSAkKCcjcmlnaHRJbm5lcicpOwoJdmFyICRzcGxpdHRlciA9ICQoJyNzcGxpdHRlcicpOwoJdmFyICRncm91cHMgPSAkKCcjZ3JvdXBzJyk7Cgl2YXIgJGNvbnRlbnQgPSAkKCcjY29udGVudCcpOwoKCS8vIE1lbnUKCgkvLyBIaWRlIGRlZXAgcGFja2FnZXMgYW5kIG5hbWVzcGFjZXMKCSQoJ3VsIHNwYW4nLCAkZ3JvdXBzKS5jbGljayhmdW5jdGlvbihldmVudCkgewoJCWV2ZW50LnByZXZlbnREZWZhdWx0KCk7CgkJZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7CgkJJCh0aGlzKQoJCQkudG9nZ2xlQ2xhc3MoJ2NvbGxhcHNlZCcpCgkJCS5wYXJlbnQoKQoJCQkJLm5leHQoJ3VsJykKCQkJCQkudG9nZ2xlQ2xhc3MoJ2NvbGxhcHNlZCcpOwoJfSkuY2xpY2soKTsKCgkkYWN0aXZlID0gJCgndWwgbGkuYWN0aXZlJywgJGdyb3Vwcyk7CglpZiAoJGFjdGl2ZS5sZW5ndGggPiAwKSB7CgkJLy8gT3BlbiBhY3RpdmUKCQkkKCc+IGEgPiBzcGFuJywgJGFjdGl2ZSkuY2xpY2soKTsKCX0gZWxzZSB7CgkJJG1haW4gPSAkKCc+IHVsID4gbGkubWFpbicsICRncm91cHMpOwoJCWlmICgkbWFpbi5sZW5ndGggPiAwKSB7CgkJCS8vIE9wZW4gZmlyc3QgbGV2ZWwgb2YgdGhlIG1haW4gcHJvamVjdAoJCQkkKCc+IGEgPiBzcGFuJywgJG1haW4pLmNsaWNrKCk7CgkJfSBlbHNlIHsKCQkJLy8gT3BlbiBmaXJzdCBsZXZlbCBvZiBhbGwKCQkJJCgnPiB1bCA+IGxpID4gYSA+IHNwYW4nLCAkZ3JvdXBzKS5jbGljaygpOwoJCX0KCX0KCgkvLyBDb250ZW50CgoJLy8gU2VhcmNoIGF1dG9jb21wbGV0aW9uCgl2YXIgYXV0b2NvbXBsZXRlRm91bmQgPSBmYWxzZTsKCXZhciBhdXRvY29tcGxldGVGaWxlcyA9IHsnYyc6ICdjbGFzcycsICdjbyc6ICdjb25zdGFudCcsICdmJzogJ2Z1bmN0aW9uJywgJ20nOiAnY2xhc3MnLCAnbW0nOiAnY2xhc3MnLCAncCc6ICdjbGFzcycsICdtcCc6ICdjbGFzcycsICdjYyc6ICdjbGFzcyd9OwoJdmFyICRzZWFyY2ggPSAkKCcjc2VhcmNoIGlucHV0W25hbWU9cV0nKTsKCSRzZWFyY2gKCQkuYXV0b2NvbXBsZXRlKEFwaUdlbi5lbGVtZW50cywgewoJCQltYXRjaENvbnRhaW5zOiB0cnVlLAoJCQlzY3JvbGxIZWlnaHQ6IDIwMCwKCQkJbWF4OiAyMCwKCQkJZm9ybWF0SXRlbTogZnVuY3Rpb24oZGF0YSkgewoJCQkJcmV0dXJuIGRhdGFbMV0ucmVwbGFjZSgvXiguK1xcKSguKykkLywgJzxzcGFuPjxzbWFsbD4kMTwvc21hbGw+JDI8L3NwYW4+Jyk7CgkJCX0sCgkJCWZvcm1hdE1hdGNoOiBmdW5jdGlvbihkYXRhKSB7CgkJCQlyZXR1cm4gZGF0YVsxXTsKCQkJfSwKCQkJZm9ybWF0UmVzdWx0OiBmdW5jdGlvbihkYXRhKSB7CgkJCQlyZXR1cm4gZGF0YVsxXTsKCQkJfSwKCQkJc2hvdzogZnVuY3Rpb24oJGxpc3QpIHsKCQkJCXZhciAkaXRlbXMgPSAkKCdsaSBzcGFuJywgJGxpc3QpOwoJCQkJdmFyIG1heFdpZHRoID0gTWF0aC5tYXguYXBwbHkobnVsbCwgJGl0ZW1zLm1hcChmdW5jdGlvbigpIHsKCQkJCQlyZXR1cm4gJCh0aGlzKS53aWR0aCgpOwoJCQkJfSkpOwoJCQkJLy8gMTBweCBwYWRkaW5nCgkJCQkkbGlzdC53aWR0aChNYXRoLm1heChtYXhXaWR0aCArIDEwLCAkc2VhcmNoLmlubmVyV2lkdGgoKSkpOwoJCQl9CgkJfSkucmVzdWx0KGZ1bmN0aW9uKGV2ZW50LCBkYXRhKSB7CgkJCWF1dG9jb21wbGV0ZUZvdW5kID0gdHJ1ZTsKCQkJdmFyIGxvY2F0aW9uID0gd2luZG93LmxvY2F0aW9uLmhyZWYuc3BsaXQoJy8nKTsKCQkJbG9jYXRpb24ucG9wKCk7CgkJCXZhciBwYXJ0cyA9IGRhdGFbMV0uc3BsaXQoLzo6fCQvKTsKCQkJdmFyIGZpbGUgPSAkLnNwcmludGYoQXBpR2VuLmNvbmZpZy50ZW1wbGF0ZXMubWFpblthdXRvY29tcGxldGVGaWxlc1tkYXRhWzBdXV0uZmlsZW5hbWUsIHBhcnRzWzBdLnJlcGxhY2UoL1woXCkvLCAnJykucmVwbGFjZSgvW15cd10vZywgJy4nKSk7CgkJCWlmIChwYXJ0c1sxXSkgewoJCQkJZmlsZSArPSAnIycgKyAoJ21tJyA9PT0gZGF0YVswXSB8fCAnbXAnID09PSBkYXRhWzBdID8gJ20nIDogJycpICsgcGFydHNbMV0ucmVwbGFjZSgvKFtcd10rKVwoXCkvLCAnXyQxJyk7CgkJCX0KCQkJbG9jYXRpb24ucHVzaChmaWxlKTsKCQkJd2luZG93LmxvY2F0aW9uID0gbG9jYXRpb24uam9pbignLycpOwoKCQkJLy8gV29ya2Fyb3VuZCBmb3IgT3BlcmEgYnVnCgkJCSQodGhpcykuY2xvc2VzdCgnZm9ybScpLmF0dHIoJ2FjdGlvbicsIGxvY2F0aW9uLmpvaW4oJy8nKSk7CgkJfSkuY2xvc2VzdCgnZm9ybScpCgkJCS5zdWJtaXQoZnVuY3Rpb24oKSB7CgkJCQl2YXIgcXVlcnkgPSAkc2VhcmNoLnZhbCgpOwoJCQkJaWYgKCcnID09PSBxdWVyeSkgewoJCQkJCXJldHVybiBmYWxzZTsKCQkJCX0KCgkJCQl2YXIgbGFiZWwgPSAkKCcjc2VhcmNoIGlucHV0W25hbWU9bW9yZV0nKS52YWwoKTsKCQkJCWlmICghYXV0b2NvbXBsZXRlRm91bmQgJiYgbGFiZWwgJiYgLTEgPT09IHF1ZXJ5LmluZGV4T2YoJ21vcmU6JykpIHsKCQkJCQkkc2VhcmNoLnZhbChxdWVyeSArICcgbW9yZTonICsgbGFiZWwpOwoJCQkJfQoKCQkJCXJldHVybiAhYXV0b2NvbXBsZXRlRm91bmQgJiYgJycgIT09ICQoJyNzZWFyY2ggaW5wdXRbbmFtZT1jeF0nKS52YWwoKTsKCQkJfSk7CgoJLy8gU2F2ZSBuYXR1cmFsIG9yZGVyCgkkKCd0YWJsZS5zdW1tYXJ5IHRyW2RhdGEtb3JkZXJdJywgJGNvbnRlbnQpLmVhY2goZnVuY3Rpb24oaW5kZXgpIHsKCQlkbyB7CgkJCWluZGV4ID0gJzAnICsgaW5kZXg7CgkJfSB3aGlsZSAoaW5kZXgubGVuZ3RoIDwgMyk7CgkJJCh0aGlzKS5hdHRyKCdkYXRhLW9yZGVyLW5hdHVyYWwnLCBpbmRleCk7Cgl9KTsKCgkvLyBTd2l0Y2ggYmV0d2VlbiBuYXR1cmFsIGFuZCBhbHBoYWJldGljYWwgb3JkZXIKCXZhciAkY2FwdGlvbiA9ICQoJ3RhYmxlLnN1bW1hcnknLCAkY29udGVudCkKCQkuZmlsdGVyKCc6aGFzKHRyW2RhdGEtb3JkZXJdKScpCgkJCS5wcmV2KCdoMicpOwoJJGNhcHRpb24KCQkuY2xpY2soZnVuY3Rpb24oKSB7CgkJCXZhciAkdGhpcyA9ICQodGhpcyk7CgkJCXZhciBvcmRlciA9ICR0aGlzLmRhdGEoJ29yZGVyJykgfHwgJ25hdHVyYWwnOwoJCQlvcmRlciA9ICduYXR1cmFsJyA9PT0gb3JkZXIgPyAnYWxwaGFiZXRpY2FsJyA6ICduYXR1cmFsJzsKCQkJJHRoaXMuZGF0YSgnb3JkZXInLCBvcmRlcik7CgkJCSQuY29va2llKCdvcmRlcicsIG9yZGVyLCB7ZXhwaXJlczogMzY1fSk7CgkJCXZhciBhdHRyID0gJ2FscGhhYmV0aWNhbCcgPT09IG9yZGVyID8gJ2RhdGEtb3JkZXInIDogJ2RhdGEtb3JkZXItbmF0dXJhbCc7CgkJCSR0aGlzCgkJCQkubmV4dCgndGFibGUnKQoJCQkJCS5maW5kKCd0cicpLnNvcnRFbGVtZW50cyhmdW5jdGlvbihhLCBiKSB7CgkJCQkJCXJldHVybiAkKGEpLmF0dHIoYXR0cikgPiAkKGIpLmF0dHIoYXR0cikgPyAxIDogLTE7CgkJCQkJfSk7CgkJCXJldHVybiBmYWxzZTsKCQl9KQoJCS5hZGRDbGFzcygnc3dpdGNoYWJsZScpCgkJLmF0dHIoJ3RpdGxlJywgJ1N3aXRjaCBiZXR3ZWVuIG5hdHVyYWwgYW5kIGFscGhhYmV0aWNhbCBvcmRlcicpOwoJaWYgKChudWxsID09PSAkLmNvb2tpZSgnb3JkZXInKSAmJiAnYWxwaGFiZXRpY2FsJyA9PT0gQXBpR2VuLmNvbmZpZy5vcHRpb25zLmVsZW1lbnRzT3JkZXIpIHx8ICdhbHBoYWJldGljYWwnID09PSAkLmNvb2tpZSgnb3JkZXInKSkgewoJCSRjYXB0aW9uLmNsaWNrKCk7Cgl9CgoJLy8gT3BlbiBkZXRhaWxzCglpZiAoQXBpR2VuLmNvbmZpZy5vcHRpb25zLmVsZW1lbnREZXRhaWxzQ29sbGFwc2VkKSB7CgkJJCgndHInLCAkY29udGVudCkuZmlsdGVyKCc6aGFzKC5kZXRhaWxlZCknKQoJCQkuY2xpY2soZnVuY3Rpb24oKSB7CgkJCQl2YXIgJHRoaXMgPSAkKHRoaXMpOwoJCQkJJCgnLnNob3J0JywgJHRoaXMpLmhpZGUoKTsKCQkJCSQoJy5kZXRhaWxlZCcsICR0aGlzKS5zaG93KCk7CgkJCX0pOwoJfQoKCS8vIFNwbGl0dGVyCgl2YXIgc3BsaXR0ZXJXaWR0aCA9ICRzcGxpdHRlci53aWR0aCgpOwoJZnVuY3Rpb24gc2V0U3BsaXR0ZXJQb3NpdGlvbihwb3NpdGlvbikKCXsKCQkkbGVmdC53aWR0aChwb3NpdGlvbik7CgkJJHJpZ2h0LmNzcygnbWFyZ2luLWxlZnQnLCBwb3NpdGlvbiArIHNwbGl0dGVyV2lkdGgpOwoJCSRzcGxpdHRlci5jc3MoJ2xlZnQnLCBwb3NpdGlvbik7Cgl9CglmdW5jdGlvbiBzZXROYXZpZ2F0aW9uUG9zaXRpb24oKQoJewoJCXZhciBoZWlnaHQgPSAkKHdpbmRvdykuaGVpZ2h0KCkgLSBuYXZpZ2F0aW9uSGVpZ2h0OwoJCSRsZWZ0LmhlaWdodChoZWlnaHQpOwoJCSRzcGxpdHRlci5oZWlnaHQoaGVpZ2h0KTsKCQkkcmlnaHQuaGVpZ2h0KGhlaWdodCk7Cgl9CglmdW5jdGlvbiBzZXRDb250ZW50V2lkdGgoKQoJewoJCXZhciB3aWR0aCA9ICRyaWdodElubmVyLndpZHRoKCk7CgkJJHJpZ2h0SW5uZXIKCQkJLnRvZ2dsZUNsYXNzKCdtZWRpdW0nLCB3aWR0aCA8PSA5NjApCgkJCS50b2dnbGVDbGFzcygnc21hbGwnLCB3aWR0aCA8PSA2NTApOwoJfQoJJHNwbGl0dGVyLm1vdXNlZG93bihmdW5jdGlvbigpIHsKCQkJJHNwbGl0dGVyLmFkZENsYXNzKCdhY3RpdmUnKTsKCgkJCSRkb2N1bWVudC5tb3VzZW1vdmUoZnVuY3Rpb24oZXZlbnQpIHsKCQkJCWlmIChldmVudC5wYWdlWCA+PSAyMzAgJiYgJGRvY3VtZW50LndpZHRoKCkgLSBldmVudC5wYWdlWCA+PSA2MDAgKyBzcGxpdHRlcldpZHRoKSB7CgkJCQkJc2V0U3BsaXR0ZXJQb3NpdGlvbihldmVudC5wYWdlWCk7CgkJCQkJc2V0Q29udGVudFdpZHRoKCk7CgkJCQl9CgkJCX0pOwoKCQkJJCgpCgkJCQkuYWRkKCRzcGxpdHRlcikKCQkJCS5hZGQoJGRvY3VtZW50KQoJCQkJCS5tb3VzZXVwKGZ1bmN0aW9uKCkgewoJCQkJCQkkc3BsaXR0ZXIKCQkJCQkJCS5yZW1vdmVDbGFzcygnYWN0aXZlJykKCQkJCQkJCS51bmJpbmQoJ21vdXNldXAnKTsKCQkJCQkJJGRvY3VtZW50CgkJCQkJCQkudW5iaW5kKCdtb3VzZW1vdmUnKQoJCQkJCQkJLnVuYmluZCgnbW91c2V1cCcpOwoKCQkJCQkJJC5jb29raWUoJ3NwbGl0dGVyJywgcGFyc2VJbnQoJHNwbGl0dGVyLmNzcygnbGVmdCcpKSwge2V4cGlyZXM6IDM2NX0pOwoJCQkJCX0pOwoKCQkJcmV0dXJuIGZhbHNlOwoJCX0pOwoJdmFyIHNwbGl0dGVyUG9zaXRpb24gPSAkLmNvb2tpZSgnc3BsaXR0ZXInKTsKCWlmIChudWxsICE9PSBzcGxpdHRlclBvc2l0aW9uKSB7CgkJc2V0U3BsaXR0ZXJQb3NpdGlvbihwYXJzZUludChzcGxpdHRlclBvc2l0aW9uKSk7Cgl9CglzZXROYXZpZ2F0aW9uUG9zaXRpb24oKTsKCXNldENvbnRlbnRXaWR0aCgpOwoJJCh3aW5kb3cpCgkJLnJlc2l6ZShzZXROYXZpZ2F0aW9uUG9zaXRpb24pCgkJLnJlc2l6ZShzZXRDb250ZW50V2lkdGgpOwoKCS8vIFNlbGVjdCBzZWxlY3RlZCBsaW5lcwoJdmFyIG1hdGNoZXMgPSB3aW5kb3cubG9jYXRpb24uaGFzaC5zdWJzdHIoMSkubWF0Y2goL15cZCsoPzotXGQrKT8oPzosXGQrKD86LVxkKyk/KSokLyk7CglpZiAobnVsbCAhPT0gbWF0Y2hlcykgewoJCXZhciBsaXN0cyA9IG1hdGNoZXNbMF0uc3BsaXQoJywnKTsKCQlmb3IgKHZhciBpID0gMDsgaSA8IGxpc3RzLmxlbmd0aDsgaSsrKSB7CgkJCXZhciBsaW5lcyA9IGxpc3RzW2ldLnNwbGl0KCctJyk7CgkJCWxpbmVzWzFdID0gbGluZXNbMV0gfHwgbGluZXNbMF07CgkJCWZvciAodmFyIGogPSBsaW5lc1swXTsgaiA8PSBsaW5lc1sxXTsgaisrKSB7CgkJCQkkKCcjJyArIGopLmFkZENsYXNzKCdzZWxlY3RlZCcpOwoJCQl9CgkJfQoKCQl2YXIgJGZpcnN0TGluZSA9ICQoJyMnICsgcGFyc2VJbnQobWF0Y2hlc1swXSkpOwoJCWlmICgkZmlyc3RMaW5lLmxlbmd0aCA+IDApIHsKCQkJJHJpZ2h0LnNjcm9sbFRvcCgkZmlyc3RMaW5lLm9mZnNldCgpLnRvcCk7CgkJfQoJfQoKCS8vIFNhdmUgc2VsZWN0ZWQgbGluZXMKCXZhciBsYXN0TGluZTsKCSQoJ2EubCcpLmNsaWNrKGZ1bmN0aW9uKGV2ZW50KSB7CgkJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCgkJdmFyICRzZWxlY3RlZExpbmUgPSAkKHRoaXMpLnBhcmVudCgpOwoJCXZhciBzZWxlY3RlZExpbmUgPSBwYXJzZUludCgkc2VsZWN0ZWRMaW5lLmF0dHIoJ2lkJykpOwoKCQlpZiAoZXZlbnQuc2hpZnRLZXkpIHsKCQkJaWYgKGxhc3RMaW5lKSB7CgkJCQlmb3IgKHZhciBpID0gTWF0aC5taW4oc2VsZWN0ZWRMaW5lLCBsYXN0TGluZSk7IGkgPD0gTWF0aC5tYXgoc2VsZWN0ZWRMaW5lLCBsYXN0TGluZSk7IGkrKykgewoJCQkJCSQoJyMnICsgaSkuYWRkQ2xhc3MoJ3NlbGVjdGVkJyk7CgkJCQl9CgkJCX0gZWxzZSB7CgkJCQkkc2VsZWN0ZWRMaW5lLmFkZENsYXNzKCdzZWxlY3RlZCcpOwoJCQl9CgkJfSBlbHNlIGlmIChldmVudC5jdHJsS2V5KSB7CgkJCSRzZWxlY3RlZExpbmUudG9nZ2xlQ2xhc3MoJ3NlbGVjdGVkJyk7CgkJfSBlbHNlIHsKCQkJdmFyICRzZWxlY3RlZCA9ICQoJy5sLnNlbGVjdGVkJykKCQkJCS5ub3QoJHNlbGVjdGVkTGluZSkKCQkJCS5yZW1vdmVDbGFzcygnc2VsZWN0ZWQnKTsKCQkJaWYgKCRzZWxlY3RlZC5sZW5ndGggPiAwKSB7CgkJCQkkc2VsZWN0ZWRMaW5lLmFkZENsYXNzKCdzZWxlY3RlZCcpOwoJCQl9IGVsc2UgewoJCQkJJHNlbGVjdGVkTGluZS50b2dnbGVDbGFzcygnc2VsZWN0ZWQnKTsKCQkJfQoJCX0KCgkJbGFzdExpbmUgPSAkc2VsZWN0ZWRMaW5lLmhhc0NsYXNzKCdzZWxlY3RlZCcpID8gc2VsZWN0ZWRMaW5lIDogbnVsbDsKCgkJLy8gVXBkYXRlIGhhc2gKCQl2YXIgbGluZXMgPSAkKCcubC5zZWxlY3RlZCcpCgkJCS5tYXAoZnVuY3Rpb24oKSB7CgkJCQlyZXR1cm4gcGFyc2VJbnQoJCh0aGlzKS5hdHRyKCdpZCcpKTsKCQkJfSkKCQkJLmdldCgpCgkJCS5zb3J0KGZ1bmN0aW9uKGEsIGIpIHsKCQkJCXJldHVybiBhIC0gYjsKCQkJfSk7CgoJCXZhciBoYXNoID0gW107CgkJdmFyIGxpc3QgPSBbXTsKCQlmb3IgKHZhciBqID0gMDsgaiA8IGxpbmVzLmxlbmd0aDsgaisrKSB7CgkJCWlmICgwID09PSBqICYmIGogKyAxID09PSBsaW5lcy5sZW5ndGgpIHsKCQkJCWhhc2gucHVzaChsaW5lc1tqXSk7CgkJCX0gZWxzZSBpZiAoMCA9PT0gaikgewoJCQkJbGlzdFswXSA9IGxpbmVzW2pdOwoJCQl9IGVsc2UgaWYgKGxpbmVzW2ogLSAxXSArIDEgIT09IGxpbmVzW2pdICYmIGogKyAxID09PSBsaW5lcy5sZW5ndGgpIHsKCQkJCWhhc2gucHVzaChsaXN0LmpvaW4oJy0nKSk7CgkJCQloYXNoLnB1c2gobGluZXNbal0pOwoJCQl9IGVsc2UgaWYgKGxpbmVzW2ogLSAxXSArIDEgIT09IGxpbmVzW2pdKSB7CgkJCQloYXNoLnB1c2gobGlzdC5qb2luKCctJykpOwoJCQkJbGlzdCA9IFtsaW5lc1tqXV07CgkJCX0gZWxzZSBpZiAoaiArIDEgPT09IGxpbmVzLmxlbmd0aCkgewoJCQkJbGlzdFsxXSA9IGxpbmVzW2pdOwoJCQkJaGFzaC5wdXNoKGxpc3Quam9pbignLScpKTsKCQkJfSBlbHNlIHsKCQkJCWxpc3RbMV0gPSBsaW5lc1tqXTsKCQkJfQoJCX0KCgkJd2luZG93LmxvY2F0aW9uLmhhc2ggPSBoYXNoLmpvaW4oJywnKTsKCX0pOwp9KTsK",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Sun, 09 Nov 2014 03:08:21 GMT",
                    "Content-Length": "8151",
                    "Date": "Sun, 09 Nov 2014 03:08:22 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}