{
    "url": "http://localhost:9999/jcbrand/converse.js/builds/converse.nojquery.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Open redirection (DOM-based)",
    "issueType": 5243152,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based open redirection vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the target of a redirection in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause a redirection to an arbitrary external domain. This behavior can be leveraged to facilitate phishing attacks against users of the application. The ability to use an authentic application URL, targeting the correct domain with a valid SSL certificate (if SSL is used) lends credibility to the phishing attack because many users, even if they verify these features, will not notice the subsequent redirection to a different domain.<br><br><b>Note:</b> If an attacker is able to control the start of the string that is passed to the redirection API, then it may be possible to escalate this vulnerability into a JavaScript injection attack, by using a URL with the javascript: pseudo-protocol to execute arbitrary script code when the URL is processed by the browser.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based open redirection vulnerabilities is not to dynamically set redirection targets using data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing an arbitrary URL as a redirection target. In general, this is best achieved by using a whitelist of URLs that are permitted redirection targets, and strictly validating the target against this list before performing the redirection.",
    "issueDetail": "The application may be vulnerable to DOM-based open redirection. Data is read from <b>location.href</b> and written to <b>location.replace()</b> via the following statements:<ul><li>var href = location.href.replace(/(javascript:|#).*$/, '');</li><li>location.replace(href + '#' + fragment);</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/jcbrand/converse.js/builds/converse.nojquery.js",
                "path": "/jcbrand/converse.js/builds/converse.nojquery.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9qY2JyYW5kL2NvbnZlcnNlLmpzL2J1aWxkcy9jb252ZXJzZS5ub2pxdWVyeS5qcyBIVFRQLzEuMQ0KSG9zdDogbG9jYWxob3N0Ojk5OTkNCg0K",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMTI5OTkwMQ0KQWNjZXB0LVJhbmdlczogYnl0ZXMNCkNvbnRlbnQtVHlwZTogYXBwbGljYXRpb24vamF2YXNjcmlwdA0KRGF0ZTogVGh1LCAwNiBOb3YgMjAxNCAxNjoyNToxNyBHTVQNCkxhc3QtTW9kaWZpZWQ6IFRodSwgMDYgTm92IDIwMTQgMTY6MjU6MTEgR01UDQoNCi8qKgogKiBAbGljZW5zZSBhbG1vbmQgMC4yLjkgQ29weXJpZ2h0IChjKSAyMDExLTIwMTQsIFRoZSBEb2pvIEZvdW5kYXRpb24gQWxsIFJpZ2h0cyBSZXNlcnZlZC4KICogQXZhaWxhYmxlIHZpYSB0aGUgTUlUIG9yIG5ldyBCU0QgbGljZW5zZS4KICogc2VlOiBodHRwOi8vZ2l0aHViLmNvbS9qcmJ1cmtlL2FsbW9uZCBmb3IgZGV0YWlscwogKi8KLy9Hb2luZyBzbG9wcHkgdG8gYXZvaWQgJ3VzZSBzdHJpY3QnIHN0cmluZyBjb3N0LCBidXQgc3RyaWN0IHByYWN0aWNlcyBzaG91bGQKLy9iZSBmb2xsb3dlZC4KLypqc2xpbnQgc2xvcHB5OiB0cnVlICovCi8qZ2xvYmFsIHNldFRpbWVvdXQ6IGZhbHNlICovCgp2YXIgcmVxdWlyZWpzLCByZXF1aXJlLCBkZWZpbmU7CihmdW5jdGlvbiAodW5kZWYpIHsKICAgIHZhciBtYWluLCByZXEsIG1ha2VNYXAsIGhhbmRsZXJzLAogICAgICAgIGRlZmluZWQgPSB7fSwKICAgICAgICB3YWl0aW5nID0ge30sCiAgICAgICAgY29uZmlnID0ge30sCiAgICAgICAgZGVmaW5pbmcgPSB7fSwKICAgICAgICBoYXNPd24gPSBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LAogICAgICAgIGFwcyA9IFtdLnNsaWNlLAogICAgICAgIGpzU3VmZml4UmVnRXhwID0gL1wuanMkLzsKCiAgICBmdW5jdGlvbiBoYXNQcm9wKG9iaiwgcHJvcCkgewogICAgICAgIHJldHVybiBoYXNPd24uY2FsbChvYmosIHByb3ApOwogICAgfQoKICAgIC8qKgogICAgICogR2l2ZW4gYSByZWxhdGl2ZSBtb2R1bGUgbmFtZSwgbGlrZSAuL3NvbWV0aGluZywgbm9ybWFsaXplIGl0IHRvCiAgICAgKiBhIHJlYWwgbmFtZSB0aGF0IGNhbiBiZSBtYXBwZWQgdG8gYSBwYXRoLgogICAgICogQHBhcmFtIHtTdHJpbmd9IG5hbWUgdGhlIHJlbGF0aXZlIG5hbWUKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBiYXNlTmFtZSBhIHJlYWwgbmFtZSB0aGF0IHRoZSBuYW1lIGFyZyBpcyByZWxhdGl2ZQogICAgICogdG8uCiAgICAgKiBAcmV0dXJucyB7U3RyaW5nfSBub3JtYWxpemVkIG5hbWUKICAgICAqLwogICAgZnVuY3Rpb24gbm9ybWFsaXplKG5hbWUsIGJhc2VOYW1lKSB7CiAgICAgICAgdmFyIG5hbWVQYXJ0cywgbmFtZVNlZ21lbnQsIG1hcFZhbHVlLCBmb3VuZE1hcCwgbGFzdEluZGV4LAogICAgICAgICAgICBmb3VuZEksIGZvdW5kU3Rhck1hcCwgc3RhckksIGksIGosIHBhcnQsCiAgICAgICAgICAgIGJhc2VQYXJ0cyA9IGJhc2VOYW1lICYmIGJhc2VOYW1lLnNwbGl0KCIvIiksCiAgICAgICAgICAgIG1hcCA9IGNvbmZpZy5tYXAsCiAgICAgICAgICAgIHN0YXJNYXAgPSAobWFwICYmIG1hcFsnKiddKSB8fCB7fTsKCiAgICAgICAgLy9BZGp1c3QgYW55IHJlbGF0aXZlIHBhdGhzLgogICAgICAgIGlmIChuYW1lICYmIG5hbWUuY2hhckF0KDApID09PSAiLiIpIHsKICAgICAgICAgICAgLy9JZiBoYXZlIGEgYmFzZSBuYW1lLCB0cnkgdG8gbm9ybWFsaXplIGFnYWluc3QgaXQsCiAgICAgICAgICAgIC8vb3RoZXJ3aXNlLCBhc3N1bWUgaXQgaXMgYSB0b3AtbGV2ZWwgcmVxdWlyZSB0aGF0IHdpbGwKICAgICAgICAgICAgLy9iZSByZWxhdGl2ZSB0byBiYXNlVXJsIGluIHRoZSBlbmQuCiAgICAgICAgICAgIGlmIChiYXNlTmFtZSkgewogICAgICAgICAgICAgICAgLy9Db252ZXJ0IGJhc2VOYW1lIHRvIGFycmF5LCBhbmQgbG9wIG9mZiB0aGUgbGFzdCBwYXJ0LAogICAgICAgICAgICAgICAgLy9zbyB0aGF0IC4gbWF0Y2hlcyB0aGF0ICJkaXJlY3RvcnkiIGFuZCBub3QgbmFtZSBvZiB0aGUgYmFzZU5hbWUncwogICAgICAgICAgICAgICAgLy9tb2R1bGUuIEZvciBpbnN0YW5jZSwgYmFzZU5hbWUgb2YgIm9uZS90d28vdGhyZWUiLCBtYXBzIHRvCiAgICAgICAgICAgICAgICAvLyJvbmUvdHdvL3RocmVlLmpzIiwgYnV0IHdlIHdhbnQgdGhlIGRpcmVjdG9yeSwgIm9uZS90d28iIGZvcgogICAgICAgICAgICAgICAgLy90aGlzIG5vcm1hbGl6YXRpb24uCiAgICAgICAgICAgICAgICBiYXNlUGFydHMgPSBiYXNlUGFydHMuc2xpY2UoMCwgYmFzZVBhcnRzLmxlbmd0aCAtIDEpOwogICAgICAgICAgICAgICAgbmFtZSA9IG5hbWUuc3BsaXQoJy8nKTsKICAgICAgICAgICAgICAgIGxhc3RJbmRleCA9IG5hbWUubGVuZ3RoIC0gMTsKCiAgICAgICAgICAgICAgICAvLyBOb2RlIC5qcyBhbGxvd2FuY2U6CiAgICAgICAgICAgICAgICBpZiAoY29uZmlnLm5vZGVJZENvbXBhdCAmJiBqc1N1ZmZpeFJlZ0V4cC50ZXN0KG5hbWVbbGFzdEluZGV4XSkpIHsKICAgICAgICAgICAgICAgICAgICBuYW1lW2xhc3RJbmRleF0gPSBuYW1lW2xhc3RJbmRleF0ucmVwbGFjZShqc1N1ZmZpeFJlZ0V4cCwgJycpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG5hbWUgPSBiYXNlUGFydHMuY29uY2F0KG5hbWUpOwoKICAgICAgICAgICAgICAgIC8vc3RhcnQgdHJpbURvdHMKICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBuYW1lLmxlbmd0aDsgaSArPSAxKSB7CiAgICAgICAgICAgICAgICAgICAgcGFydCA9IG5hbWVbaV07CiAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnQgPT09ICIuIikgewogICAgICAgICAgICAgICAgICAgICAgICBuYW1lLnNwbGljZShpLCAxKTsKICAgICAgICAgICAgICAgICAgICAgICAgaSAtPSAxOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocGFydCA9PT0gIi4uIikgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaSA9PT0gMSAmJiAobmFtZVsyXSA9PT0gJy4uJyB8fCBuYW1lWzBdID09PSAnLi4nKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9FbmQgb2YgdGhlIGxpbmUuIEtlZXAgYXQgbGVhc3Qgb25lIG5vbi1kb3QKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vcGF0aCBzZWdtZW50IGF0IHRoZSBmcm9udCBzbyBpdCBjYW4gYmUgbWFwcGVkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2NvcnJlY3RseSB0byBkaXNrLiBPdGhlcndpc2UsIHRoZXJlIGlzIGxpa2VseQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9ubyBwYXRoIG1hcHBpbmcgZm9yIGEgcGF0aCBzdGFydGluZyB3aXRoICcuLicuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL1RoaXMgY2FuIHN0aWxsIGZhaWwsIGJ1dCBjYXRjaGVzIHRoZSBtb3N0IHJlYXNvbmFibGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vdXNlcyBvZiAuLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaSA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUuc3BsaWNlKGkgLSAxLCAyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkgLT0gMjsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vZW5kIHRyaW1Eb3RzCgogICAgICAgICAgICAgICAgbmFtZSA9IG5hbWUuam9pbigiLyIpOwogICAgICAgICAgICB9IGVsc2UgaWYgKG5hbWUuaW5kZXhPZignLi8nKSA9PT0gMCkgewogICAgICAgICAgICAgICAgLy8gTm8gYmFzZU5hbWUsIHNvIHRoaXMgaXMgSUQgaXMgcmVzb2x2ZWQgcmVsYXRpdmUKICAgICAgICAgICAgICAgIC8vIHRvIGJhc2VVcmwsIHB1bGwgb2ZmIHRoZSBsZWFkaW5nIGRvdC4KICAgICAgICAgICAgICAgIG5hbWUgPSBuYW1lLnN1YnN0cmluZygyKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy9BcHBseSBtYXAgY29uZmlnIGlmIGF2YWlsYWJsZS4KICAgICAgICBpZiAoKGJhc2VQYXJ0cyB8fCBzdGFyTWFwKSAmJiBtYXApIHsKICAgICAgICAgICAgbmFtZVBhcnRzID0gbmFtZS5zcGxpdCgnLycpOwoKICAgICAgICAgICAgZm9yIChpID0gbmFtZVBhcnRzLmxlbmd0aDsgaSA+IDA7IGkgLT0gMSkgewogICAgICAgICAgICAgICAgbmFtZVNlZ21lbnQgPSBuYW1lUGFydHMuc2xpY2UoMCwgaSkuam9pbigiLyIpOwoKICAgICAgICAgICAgICAgIGlmIChiYXNlUGFydHMpIHsKICAgICAgICAgICAgICAgICAgICAvL0ZpbmQgdGhlIGxvbmdlc3QgYmFzZU5hbWUgc2VnbWVudCBtYXRjaCBpbiB0aGUgY29uZmlnLgogICAgICAgICAgICAgICAgICAgIC8vU28sIGRvIGpvaW5zIG9uIHRoZSBiaWdnZXN0IHRvIHNtYWxsZXN0IGxlbmd0aHMgb2YgYmFzZVBhcnRzLgogICAgICAgICAgICAgICAgICAgIGZvciAoaiA9IGJhc2VQYXJ0cy5sZW5ndGg7IGogPiAwOyBqIC09IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbWFwVmFsdWUgPSBtYXBbYmFzZVBhcnRzLnNsaWNlKDAsIGopLmpvaW4oJy8nKV07CgogICAgICAgICAgICAgICAgICAgICAgICAvL2Jhc2VOYW1lIHNlZ21lbnQgaGFzICBjb25maWcsIGZpbmQgaWYgaXQgaGFzIG9uZSBmb3IKICAgICAgICAgICAgICAgICAgICAgICAgLy90aGlzIG5hbWUuCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtYXBWYWx1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFwVmFsdWUgPSBtYXBWYWx1ZVtuYW1lU2VnbWVudF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobWFwVmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL01hdGNoLCB1cGRhdGUgbmFtZSB0byB0aGUgbmV3IHZhbHVlLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvdW5kTWFwID0gbWFwVmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm91bmRJID0gaTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoZm91bmRNYXApIHsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvL0NoZWNrIGZvciBhIHN0YXIgbWFwIG1hdGNoLCBidXQganVzdCBob2xkIG9uIHRvIGl0LAogICAgICAgICAgICAgICAgLy9pZiB0aGVyZSBpcyBhIHNob3J0ZXIgc2VnbWVudCBtYXRjaCBsYXRlciBpbiBhIG1hdGNoaW5nCiAgICAgICAgICAgICAgICAvL2NvbmZpZywgdGhlbiBmYXZvciBvdmVyIHRoaXMgc3RhciBtYXAuCiAgICAgICAgICAgICAgICBpZiAoIWZvdW5kU3Rhck1hcCAmJiBzdGFyTWFwICYmIHN0YXJNYXBbbmFtZVNlZ21lbnRdKSB7CiAgICAgICAgICAgICAgICAgICAgZm91bmRTdGFyTWFwID0gc3Rhck1hcFtuYW1lU2VnbWVudF07CiAgICAgICAgICAgICAgICAgICAgc3RhckkgPSBpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoIWZvdW5kTWFwICYmIGZvdW5kU3Rhck1hcCkgewogICAgICAgICAgICAgICAgZm91bmRNYXAgPSBmb3VuZFN0YXJNYXA7CiAgICAgICAgICAgICAgICBmb3VuZEkgPSBzdGFySTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGZvdW5kTWFwKSB7CiAgICAgICAgICAgICAgICBuYW1lUGFydHMuc3BsaWNlKDAsIGZvdW5kSSwgZm91bmRNYXApOwogICAgICAgICAgICAgICAgbmFtZSA9IG5hbWVQYXJ0cy5qb2luKCcvJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBuYW1lOwogICAgfQoKICAgIGZ1bmN0aW9uIG1ha2VSZXF1aXJlKHJlbE5hbWUsIGZvcmNlU3luYykgewogICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIC8vQSB2ZXJzaW9uIG9mIGEgcmVxdWlyZSBmdW5jdGlvbiB0aGF0IHBhc3NlcyBhIG1vZHVsZU5hbWUKICAgICAgICAgICAgLy92YWx1ZSBmb3IgaXRlbXMgdGhhdCBtYXkgbmVlZCB0bwogICAgICAgICAgICAvL2xvb2sgdXAgcGF0aHMgcmVsYXRpdmUgdG8gdGhlIG1vZHVsZU5hbWUKICAgICAgICAgICAgcmV0dXJuIHJlcS5hcHBseSh1bmRlZiwgYXBzLmNhbGwoYXJndW1lbnRzLCAwKS5jb25jYXQoW3JlbE5hbWUsIGZvcmNlU3luY10pKTsKICAgICAgICB9OwogICAgfQoKICAgIGZ1bmN0aW9uIG1ha2VOb3JtYWxpemUocmVsTmFtZSkgewogICAgICAgIHJldHVybiBmdW5jdGlvbiAobmFtZSkgewogICAgICAgICAgICByZXR1cm4gbm9ybWFsaXplKG5hbWUsIHJlbE5hbWUpOwogICAgICAgIH07CiAgICB9CgogICAgZnVuY3Rpb24gbWFrZUxvYWQoZGVwTmFtZSkgewogICAgICAgIHJldHVybiBmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgICAgICAgZGVmaW5lZFtkZXBOYW1lXSA9IHZhbHVlOwogICAgICAgIH07CiAgICB9CgogICAgZnVuY3Rpb24gY2FsbERlcChuYW1lKSB7CiAgICAgICAgaWYgKGhhc1Byb3Aod2FpdGluZywgbmFtZSkpIHsKICAgICAgICAgICAgdmFyIGFyZ3MgPSB3YWl0aW5nW25hbWVdOwogICAgICAgICAgICBkZWxldGUgd2FpdGluZ1tuYW1lXTsKICAgICAgICAgICAgZGVmaW5pbmdbbmFtZV0gPSB0cnVlOwogICAgICAgICAgICBtYWluLmFwcGx5KHVuZGVmLCBhcmdzKTsKICAgICAgICB9CgogICAgICAgIGlmICghaGFzUHJvcChkZWZpbmVkLCBuYW1lKSAmJiAhaGFzUHJvcChkZWZpbmluZywgbmFtZSkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyAnICsgbmFtZSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBkZWZpbmVkW25hbWVdOwogICAgfQoKICAgIC8vVHVybnMgYSBwbHVnaW4hcmVzb3VyY2UgdG8gW3BsdWdpbiwgcmVzb3VyY2VdCiAgICAvL3dpdGggdGhlIHBsdWdpbiBiZWluZyB1bmRlZmluZWQgaWYgdGhlIG5hbWUKICAgIC8vZGlkIG5vdCBoYXZlIGEgcGx1Z2luIHByZWZpeC4KICAgIGZ1bmN0aW9uIHNwbGl0UHJlZml4KG5hbWUpIHsKICAgICAgICB2YXIgcHJlZml4LAogICAgICAgICAgICBpbmRleCA9IG5hbWUgPyBuYW1lLmluZGV4T2YoJyEnKSA6IC0xOwogICAgICAgIGlmIChpbmRleCA+IC0xKSB7CiAgICAgICAgICAgIHByZWZpeCA9IG5hbWUuc3Vic3RyaW5nKDAsIGluZGV4KTsKICAgICAgICAgICAgbmFtZSA9IG5hbWUuc3Vic3RyaW5nKGluZGV4ICsgMSwgbmFtZS5sZW5ndGgpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gW3ByZWZpeCwgbmFtZV07CiAgICB9CgogICAgLyoqCiAgICAgKiBNYWtlcyBhIG5hbWUgbWFwLCBub3JtYWxpemluZyB0aGUgbmFtZSwgYW5kIHVzaW5nIGEgcGx1Z2luCiAgICAgKiBmb3Igbm9ybWFsaXphdGlvbiBpZiBuZWNlc3NhcnkuIEdyYWJzIGEgcmVmIHRvIHBsdWdpbgogICAgICogdG9vLCBhcyBhbiBvcHRpbWl6YXRpb24uCiAgICAgKi8KICAgIG1ha2VNYXAgPSBmdW5jdGlvbiAobmFtZSwgcmVsTmFtZSkgewogICAgICAgIHZhciBwbHVnaW4sCiAgICAgICAgICAgIHBhcnRzID0gc3BsaXRQcmVmaXgobmFtZSksCiAgICAgICAgICAgIHByZWZpeCA9IHBhcnRzWzBdOwoKICAgICAgICBuYW1lID0gcGFydHNbMV07CgogICAgICAgIGlmIChwcmVmaXgpIHsKICAgICAgICAgICAgcHJlZml4ID0gbm9ybWFsaXplKHByZWZpeCwgcmVsTmFtZSk7CiAgICAgICAgICAgIHBsdWdpbiA9IGNhbGxEZXAocHJlZml4KTsKICAgICAgICB9CgogICAgICAgIC8vTm9ybWFsaXplIGFjY29yZGluZwogICAgICAgIGlmIChwcmVmaXgpIHsKICAgICAgICAgICAgaWYgKHBsdWdpbiAmJiBwbHVnaW4ubm9ybWFsaXplKSB7CiAgICAgICAgICAgICAgICBuYW1lID0gcGx1Z2luLm5vcm1hbGl6ZShuYW1lLCBtYWtlTm9ybWFsaXplKHJlbE5hbWUpKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG5hbWUgPSBub3JtYWxpemUobmFtZSwgcmVsTmFtZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBuYW1lID0gbm9ybWFsaXplKG5hbWUsIHJlbE5hbWUpOwogICAgICAgICAgICBwYXJ0cyA9IHNwbGl0UHJlZml4KG5hbWUpOwogICAgICAgICAgICBwcmVmaXggPSBwYXJ0c1swXTsKICAgICAgICAgICAgbmFtZSA9IHBhcnRzWzFdOwogICAgICAgICAgICBpZiAocHJlZml4KSB7CiAgICAgICAgICAgICAgICBwbHVnaW4gPSBjYWxsRGVwKHByZWZpeCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vVXNpbmcgcmlkaWN1bG91cyBwcm9wZXJ0eSBuYW1lcyBmb3Igc3BhY2UgcmVhc29ucwogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGY6IHByZWZpeCA/IHByZWZpeCArICchJyArIG5hbWUgOiBuYW1lLCAvL2Z1bGxOYW1lCiAgICAgICAgICAgIG46IG5hbWUsCiAgICAgICAgICAgIHByOiBwcmVmaXgsCiAgICAgICAgICAgIHA6IHBsdWdpbgogICAgICAgIH07CiAgICB9OwoKICAgIGZ1bmN0aW9uIG1ha2VDb25maWcobmFtZSkgewogICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiAoY29uZmlnICYmIGNvbmZpZy5jb25maWcgJiYgY29uZmlnLmNvbmZpZ1tuYW1lXSkgfHwge307CiAgICAgICAgfTsKICAgIH0KCiAgICBoYW5kbGVycyA9IHsKICAgICAgICByZXF1aXJlOiBmdW5jdGlvbiAobmFtZSkgewogICAgICAgICAgICByZXR1cm4gbWFrZVJlcXVpcmUobmFtZSk7CiAgICAgICAgfSwKICAgICAgICBleHBvcnRzOiBmdW5jdGlvbiAobmFtZSkgewogICAgICAgICAgICB2YXIgZSA9IGRlZmluZWRbbmFtZV07CiAgICAgICAgICAgIGlmICh0eXBlb2YgZSAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgICAgICAgIHJldHVybiBlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIChkZWZpbmVkW25hbWVdID0ge30pOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBtb2R1bGU6IGZ1bmN0aW9uIChuYW1lKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBpZDogbmFtZSwKICAgICAgICAgICAgICAgIHVyaTogJycsCiAgICAgICAgICAgICAgICBleHBvcnRzOiBkZWZpbmVkW25hbWVdLAogICAgICAgICAgICAgICAgY29uZmlnOiBtYWtlQ29uZmlnKG5hbWUpCiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgfTsKCiAgICBtYWluID0gZnVuY3Rpb24gKG5hbWUsIGRlcHMsIGNhbGxiYWNrLCByZWxOYW1lKSB7CiAgICAgICAgdmFyIGNqc01vZHVsZSwgZGVwTmFtZSwgcmV0LCBtYXAsIGksCiAgICAgICAgICAgIGFyZ3MgPSBbXSwKICAgICAgICAgICAgY2FsbGJhY2tUeXBlID0gdHlwZW9mIGNhbGxiYWNrLAogICAgICAgICAgICB1c2luZ0V4cG9ydHM7CgogICAgICAgIC8vVXNlIG5hbWUgaWYgbm8gcmVsTmFtZQogICAgICAgIHJlbE5hbWUgPSByZWxOYW1lIHx8IG5hbWU7CgogICAgICAgIC8vQ2FsbCB0aGUgY2FsbGJhY2sgdG8gZGVmaW5lIHRoZSBtb2R1bGUsIGlmIG5lY2Vzc2FyeS4KICAgICAgICBpZiAoY2FsbGJhY2tUeXBlID09PSAndW5kZWZpbmVkJyB8fCBjYWxsYmFja1R5cGUgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgLy9QdWxsIG91dCB0aGUgZGVmaW5lZCBkZXBlbmRlbmNpZXMgYW5kIHBhc3MgdGhlIG9yZGVyZWQKICAgICAgICAgICAgLy92YWx1ZXMgdG8gdGhlIGNhbGxiYWNrLgogICAgICAgICAgICAvL0RlZmF1bHQgdG8gW3JlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZV0gaWYgbm8gZGVwcwogICAgICAgICAgICBkZXBzID0gIWRlcHMubGVuZ3RoICYmIGNhbGxiYWNrLmxlbmd0aCA/IFsncmVxdWlyZScsICdleHBvcnRzJywgJ21vZHVsZSddIDogZGVwczsKICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGRlcHMubGVuZ3RoOyBpICs9IDEpIHsKICAgICAgICAgICAgICAgIG1hcCA9IG1ha2VNYXAoZGVwc1tpXSwgcmVsTmFtZSk7CiAgICAgICAgICAgICAgICBkZXBOYW1lID0gbWFwLmY7CgogICAgICAgICAgICAgICAgLy9GYXN0IHBhdGggQ29tbW9uSlMgc3RhbmRhcmQgZGVwZW5kZW5jaWVzLgogICAgICAgICAgICAgICAgaWYgKGRlcE5hbWUgPT09ICJyZXF1aXJlIikgewogICAgICAgICAgICAgICAgICAgIGFyZ3NbaV0gPSBoYW5kbGVycy5yZXF1aXJlKG5hbWUpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChkZXBOYW1lID09PSAiZXhwb3J0cyIpIHsKICAgICAgICAgICAgICAgICAgICAvL0NvbW1vbkpTIG1vZHVsZSBzcGVjIDEuMQogICAgICAgICAgICAgICAgICAgIGFyZ3NbaV0gPSBoYW5kbGVycy5leHBvcnRzKG5hbWUpOwogICAgICAgICAgICAgICAgICAgIHVzaW5nRXhwb3J0cyA9IHRydWU7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGRlcE5hbWUgPT09ICJtb2R1bGUiKSB7CiAgICAgICAgICAgICAgICAgICAgLy9Db21tb25KUyBtb2R1bGUgc3BlYyAxLjEKICAgICAgICAgICAgICAgICAgICBjanNNb2R1bGUgPSBhcmdzW2ldID0gaGFuZGxlcnMubW9kdWxlKG5hbWUpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChoYXNQcm9wKGRlZmluZWQsIGRlcE5hbWUpIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhc1Byb3Aod2FpdGluZywgZGVwTmFtZSkgfHwKICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFzUHJvcChkZWZpbmluZywgZGVwTmFtZSkpIHsKICAgICAgICAgICAgICAgICAgICBhcmdzW2ldID0gY2FsbERlcChkZXBOYW1lKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobWFwLnApIHsKICAgICAgICAgICAgICAgICAgICBtYXAucC5sb2FkKG1hcC5uLCBtYWtlUmVxdWlyZShyZWxOYW1lLCB0cnVlKSwgbWFrZUxvYWQoZGVwTmFtZSksIHt9KTsKICAgICAgICAgICAgICAgICAgICBhcmdzW2ldID0gZGVmaW5lZFtkZXBOYW1lXTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKG5hbWUgKyAnIG1pc3NpbmcgJyArIGRlcE5hbWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICByZXQgPSBjYWxsYmFjayA/IGNhbGxiYWNrLmFwcGx5KGRlZmluZWRbbmFtZV0sIGFyZ3MpIDogdW5kZWZpbmVkOwoKICAgICAgICAgICAgaWYgKG5hbWUpIHsKICAgICAgICAgICAgICAgIC8vSWYgc2V0dGluZyBleHBvcnRzIHZpYSAibW9kdWxlIiBpcyBpbiBwbGF5LAogICAgICAgICAgICAgICAgLy9mYXZvciB0aGF0IG92ZXIgcmV0dXJuIHZhbHVlIGFuZCBleHBvcnRzLiBBZnRlciB0aGF0LAogICAgICAgICAgICAgICAgLy9mYXZvciBhIG5vbi11bmRlZmluZWQgcmV0dXJuIHZhbHVlIG92ZXIgZXhwb3J0cyB1c2UuCiAgICAgICAgICAgICAgICBpZiAoY2pzTW9kdWxlICYmIGNqc01vZHVsZS5leHBvcnRzICE9PSB1bmRlZiAmJgogICAgICAgICAgICAgICAgICAgICAgICBjanNNb2R1bGUuZXhwb3J0cyAhPT0gZGVmaW5lZFtuYW1lXSkgewogICAgICAgICAgICAgICAgICAgIGRlZmluZWRbbmFtZV0gPSBjanNNb2R1bGUuZXhwb3J0czsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmV0ICE9PSB1bmRlZiB8fCAhdXNpbmdFeHBvcnRzKSB7CiAgICAgICAgICAgICAgICAgICAgLy9Vc2UgdGhlIHJldHVybiB2YWx1ZSBmcm9tIHRoZSBmdW5jdGlvbi4KICAgICAgICAgICAgICAgICAgICBkZWZpbmVkW25hbWVdID0gcmV0OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChuYW1lKSB7CiAgICAgICAgICAgIC8vTWF5IGp1c3QgYmUgYW4gb2JqZWN0IGRlZmluaXRpb24gZm9yIHRoZSBtb2R1bGUuIE9ubHkKICAgICAgICAgICAgLy93b3JyeSBhYm91dCBkZWZpbmluZyBpZiBoYXZlIGEgbW9kdWxlIG5hbWUuCiAgICAgICAgICAgIGRlZmluZWRbbmFtZV0gPSBjYWxsYmFjazsKICAgICAgICB9CiAgICB9OwoKICAgIHJlcXVpcmVqcyA9IHJlcXVpcmUgPSByZXEgPSBmdW5jdGlvbiAoZGVwcywgY2FsbGJhY2ssIHJlbE5hbWUsIGZvcmNlU3luYywgYWx0KSB7CiAgICAgICAgaWYgKHR5cGVvZiBkZXBzID09PSAic3RyaW5nIikgewogICAgICAgICAgICBpZiAoaGFuZGxlcnNbZGVwc10pIHsKICAgICAgICAgICAgICAgIC8vY2FsbGJhY2sgaW4gdGhpcyBjYXNlIGlzIHJlYWxseSByZWxOYW1lCiAgICAgICAgICAgICAgICByZXR1cm4gaGFuZGxlcnNbZGVwc10oY2FsbGJhY2spOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vSnVzdCByZXR1cm4gdGhlIG1vZHVsZSB3YW50ZWQuIEluIHRoaXMgc2NlbmFyaW8sIHRoZQogICAgICAgICAgICAvL2RlcHMgYXJnIGlzIHRoZSBtb2R1bGUgbmFtZSwgYW5kIHNlY29uZCBhcmcgKGlmIHBhc3NlZCkKICAgICAgICAgICAgLy9pcyBqdXN0IHRoZSByZWxOYW1lLgogICAgICAgICAgICAvL05vcm1hbGl6ZSBtb2R1bGUgbmFtZSwgaWYgaXQgY29udGFpbnMgLiBvciAuLgogICAgICAgICAgICByZXR1cm4gY2FsbERlcChtYWtlTWFwKGRlcHMsIGNhbGxiYWNrKS5mKTsKICAgICAgICB9IGVsc2UgaWYgKCFkZXBzLnNwbGljZSkgewogICAgICAgICAgICAvL2RlcHMgaXMgYSBjb25maWcgb2JqZWN0LCBub3QgYW4gYXJyYXkuCiAgICAgICAgICAgIGNvbmZpZyA9IGRlcHM7CiAgICAgICAgICAgIGlmIChjb25maWcuZGVwcykgewogICAgICAgICAgICAgICAgcmVxKGNvbmZpZy5kZXBzLCBjb25maWcuY2FsbGJhY2spOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghY2FsbGJhY2spIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGNhbGxiYWNrLnNwbGljZSkgewogICAgICAgICAgICAgICAgLy9jYWxsYmFjayBpcyBhbiBhcnJheSwgd2hpY2ggbWVhbnMgaXQgaXMgYSBkZXBlbmRlbmN5IGxpc3QuCiAgICAgICAgICAgICAgICAvL0FkanVzdCBhcmdzIGlmIHRoZXJlIGFyZSBkZXBlbmRlbmNpZXMKICAgICAgICAgICAgICAgIGRlcHMgPSBjYWxsYmFjazsKICAgICAgICAgICAgICAgIGNhbGxiYWNrID0gcmVsTmFtZTsKICAgICAgICAgICAgICAgIHJlbE5hbWUgPSBudWxsOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZGVwcyA9IHVuZGVmOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvL1N1cHBvcnQgcmVxdWlyZShbJ2EnXSkKICAgICAgICBjYWxsYmFjayA9IGNhbGxiYWNrIHx8IGZ1bmN0aW9uICgpIHt9OwoKICAgICAgICAvL0lmIHJlbE5hbWUgaXMgYSBmdW5jdGlvbiwgaXQgaXMgYW4gZXJyYmFjayBoYW5kbGVyLAogICAgICAgIC8vc28gcmVtb3ZlIGl0LgogICAgICAgIGlmICh0eXBlb2YgcmVsTmFtZSA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICByZWxOYW1lID0gZm9yY2VTeW5jOwogICAgICAgICAgICBmb3JjZVN5bmMgPSBhbHQ7CiAgICAgICAgfQoKICAgICAgICAvL1NpbXVsYXRlIGFzeW5jIGNhbGxiYWNrOwogICAgICAgIGlmIChmb3JjZVN5bmMpIHsKICAgICAgICAgICAgbWFpbih1bmRlZiwgZGVwcywgY2FsbGJhY2ssIHJlbE5hbWUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vVXNpbmcgYSBub24temVybyB2YWx1ZSBiZWNhdXNlIG9mIGNvbmNlcm4gZm9yIHdoYXQgb2xkIGJyb3dzZXJzCiAgICAgICAgICAgIC8vZG8sIGFuZCBsYXRlc3QgYnJvd3NlcnMgInVwZ3JhZGUiIHRvIDQgaWYgbG93ZXIgdmFsdWUgaXMgdXNlZDoKICAgICAgICAgICAgLy9odHRwOi8vd3d3LndoYXR3Zy5vcmcvc3BlY3Mvd2ViLWFwcHMvY3VycmVudC13b3JrL211bHRpcGFnZS90aW1lcnMuaHRtbCNkb20td2luZG93dGltZXJzLXNldHRpbWVvdXQ6CiAgICAgICAgICAgIC8vSWYgd2FudCBhIHZhbHVlIGltbWVkaWF0ZWx5LCB1c2UgcmVxdWlyZSgnaWQnKSBpbnN0ZWFkIC0tIHNvbWV0aGluZwogICAgICAgICAgICAvL3RoYXQgd29ya3MgaW4gYWxtb25kIG9uIHRoZSBnbG9iYWwgbGV2ZWwsIGJ1dCBub3QgZ3VhcmFudGVlZCBhbmQKICAgICAgICAgICAgLy91bmxpa2VseSB0byB3b3JrIGluIG90aGVyIEFNRCBpbXBsZW1lbnRhdGlvbnMuCiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgbWFpbih1bmRlZiwgZGVwcywgY2FsbGJhY2ssIHJlbE5hbWUpOwogICAgICAgICAgICB9LCA0KTsKICAgICAgICB9CgogICAgICAgIHJldHVybiByZXE7CiAgICB9OwoKICAgIC8qKgogICAgICogSnVzdCBkcm9wcyB0aGUgY29uZmlnIG9uIHRoZSBmbG9vciwgYnV0IHJldHVybnMgcmVxIGluIGNhc2UKICAgICAqIHRoZSBjb25maWcgcmV0dXJuIHZhbHVlIGlzIHVzZWQuCiAgICAgKi8KICAgIHJlcS5jb25maWcgPSBmdW5jdGlvbiAoY2ZnKSB7CiAgICAgICAgcmV0dXJuIHJlcShjZmcpOwogICAgfTsKCiAgICAvKioKICAgICAqIEV4cG9zZSBtb2R1bGUgcmVnaXN0cnkgZm9yIGRlYnVnZ2luZyBhbmQgdG9vbGluZwogICAgICovCiAgICByZXF1aXJlanMuX2RlZmluZWQgPSBkZWZpbmVkOwoKICAgIGRlZmluZSA9IGZ1bmN0aW9uIChuYW1lLCBkZXBzLCBjYWxsYmFjaykgewoKICAgICAgICAvL1RoaXMgbW9kdWxlIG1heSBub3QgaGF2ZSBkZXBlbmRlbmNpZXMKICAgICAgICBpZiAoIWRlcHMuc3BsaWNlKSB7CiAgICAgICAgICAgIC8vZGVwcyBpcyBub3QgYW4gYXJyYXksIHNvIHByb2JhYmx5IG1lYW5zCiAgICAgICAgICAgIC8vYW4gb2JqZWN0IGxpdGVyYWwgb3IgZmFjdG9yeSBmdW5jdGlvbiBmb3IKICAgICAgICAgICAgLy90aGUgdmFsdWUuIEFkanVzdCBhcmdzLgogICAgICAgICAgICBjYWxsYmFjayA9IGRlcHM7CiAgICAgICAgICAgIGRlcHMgPSBbXTsKICAgICAgICB9CgogICAgICAgIGlmICghaGFzUHJvcChkZWZpbmVkLCBuYW1lKSAmJiAhaGFzUHJvcCh3YWl0aW5nLCBuYW1lKSkgewogICAgICAgICAgICB3YWl0aW5nW25hbWVdID0gW25hbWUsIGRlcHMsIGNhbGxiYWNrXTsKICAgICAgICB9CiAgICB9OwoKICAgIGRlZmluZS5hbWQgPSB7CiAgICAgICAgalF1ZXJ5OiB0cnVlCiAgICB9Owp9KCkpOwoKZGVmaW5lKCJjb21wb25lbnRzL2FsbW9uZC9hbG1vbmQuanMiLCBmdW5jdGlvbigpe30pOwoKZGVmaW5lKCdqcXVlcnknLCBbXSwgZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIGpRdWVyeTsKfSk7CgpkZWZpbmUoJ2pxdWVyeS1wcml2YXRlJyxbJ2pxdWVyeSddLCBmdW5jdGlvbiAoanEpIHsKICAgIHJldHVybiBqcTsKfSk7CgpkZWZpbmUoJ3V0aWxzJyxbImpxdWVyeSJdLCBmdW5jdGlvbiAoJCkgewogICAgJC5mbi5oYXNTY3JvbGxCYXIgPSBmdW5jdGlvbigpIHsKICAgICAgICBpZiAoISQuY29udGFpbnMoZG9jdW1lbnQsIHRoaXMuZ2V0KDApKSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmKHRoaXMucGFyZW50KCkuaGVpZ2h0KCkgPCB0aGlzLmdldCgwKS5zY3JvbGxIZWlnaHQpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH07CgogICAgJC5mbi5hZGRIeXBlcmxpbmtzID0gZnVuY3Rpb24gKCkgewogICAgICAgIGlmICh0aGlzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgdGhpcy5lYWNoKGZ1bmN0aW9uIChpLCBvYmopIHsKICAgICAgICAgICAgICAgIHZhciB4ID0gJChvYmopLmh0bWwoKTsKICAgICAgICAgICAgICAgIHZhciBsaXN0ID0geC5tYXRjaCgvXGIoaHR0cHM/OlwvXC98d3d3XC58aHR0cHM/OlwvXC93d3dcLilbXlxzPF17MiwyMDB9XGIvZyApOwogICAgICAgICAgICAgICAgaWYgKGxpc3QpIHsKICAgICAgICAgICAgICAgICAgICBmb3IgKGk9MDsgaTxsaXN0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwcm90ID0gbGlzdFtpXS5pbmRleE9mKCdodHRwOi8vJykgPT09IDAgfHwgbGlzdFtpXS5pbmRleE9mKCdodHRwczovLycpID09PSAwID8gJycgOiAnaHR0cDovLyc7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlc2NhcGVkX3VybCA9IGVuY29kZVVSSShkZWNvZGVVUkkobGlzdFtpXSkpLnJlcGxhY2UoL1shJygpXS9nLCBlc2NhcGUpLnJlcGxhY2UoL1wqL2csICIlMkEiKTsKICAgICAgICAgICAgICAgICAgICAgICAgeCA9IHgucmVwbGFjZShsaXN0W2ldLCAiPGEgdGFyZ2V0PSdfYmxhbmsnIGhyZWY9JyIgKyBwcm90ICsgZXNjYXBlZF91cmwgKyAiJz4iKyBsaXN0W2ldICsgIjwvYT4iICk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJChvYmopLmh0bWwoeCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpczsKICAgIH07CgogICAgdmFyIHV0aWxzID0gewogICAgICAgIC8vIFRyYW5zbGF0aW9uIG1hY2hpbmVyeQogICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICAgIF9fOiBmdW5jdGlvbiAoc3RyKSB7CiAgICAgICAgICAgIC8vIFRyYW5zbGF0aW9uIGZhY3RvcnkKICAgICAgICAgICAgaWYgKHRoaXMuaTE4biA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICB0aGlzLmkxOG4gPSBsb2NhbGVzLmVuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciB0ID0gdGhpcy5pMThuLnRyYW5zbGF0ZShzdHIpOwogICAgICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aD4xKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdC5mZXRjaC5hcHBseSh0LCBbXS5zbGljZS5jYWxsKGFyZ3VtZW50cywxKSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdC5mZXRjaCgpOwogICAgICAgICAgICB9CiAgICAgICAgfSwKCiAgICAgICAgX19fOiBmdW5jdGlvbiAoc3RyKSB7CiAgICAgICAgICAgIC8qIFhYWDogVGhpcyBpcyBwYXJ0IG9mIGEgaGFjayB0byBnZXQgZ2V0dGV4dCB0byBzY2FuIHN0cmluZ3MgdG8gYmUKICAgICAgICAgICAgICAgICogdHJhbnNsYXRlZC4gU3RyaW5ncyB3ZSBjYW5ub3Qgc2VuZCB0byB0aGUgZnVuY3Rpb24gYWJvdmUgYmVjYXVzZQogICAgICAgICAgICAgICAgKiB0aGV5IHJlcXVpcmUgdmFyaWFibGUgaW50ZXJwb2xhdGlvbiBhbmQgd2UgZG9uJ3QgeWV0IGhhdmUgdGhlCiAgICAgICAgICAgICAgICAqIHZhcmlhYmxlcyBhdCBzY2FuIHRpbWUuCiAgICAgICAgICAgICAgICAqCiAgICAgICAgICAgICAgICAqIFNlZSBhY3Rpb25JbmZvTWVzc2FnZXMKICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgIHJldHVybiBzdHI7CiAgICAgICAgfQogICAgfTsKICAgIHJldHVybiB1dGlsczsKfSk7CgovKiEKICogalF1ZXJ5IEJyb3dzZXIgUGx1Z2luIHYwLjAuNgogKiBodHRwczovL2dpdGh1Yi5jb20vZ2FiY2ViL2pxdWVyeS1icm93c2VyLXBsdWdpbgogKgogKiBPcmlnaW5hbCBqcXVlcnktYnJvd3NlciBjb2RlIENvcHlyaWdodCAyMDA1LCAyMDEzIGpRdWVyeSBGb3VuZGF0aW9uLCBJbmMuIGFuZCBvdGhlciBjb250cmlidXRvcnMKICogaHR0cDovL2pxdWVyeS5vcmcvbGljZW5zZQogKgogKiBNb2RpZmljYXRpb25zIENvcHlyaWdodCAyMDEzIEdhYnJpZWwgQ2VicmlhbgogKiBodHRwczovL2dpdGh1Yi5jb20vZ2FiY2ViCiAqCiAqIFJlbGVhc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZQogKgogKiBEYXRlOiAyMDEzLTA3LTI5VDE3OjIzOjI3LTA3OjAwCiAqLwoKKGZ1bmN0aW9uIChyb290LCBmYWN0b3J5KSB7CiAgICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7CiAgICAgICAgLy8gQU1ELiBSZWdpc3RlciBhcyBhbiBhbm9ueW1vdXMgbW9kdWxlLgogICAgICAgIGRlZmluZSgnanF1ZXJ5LmJyb3dzZXInLFsnanF1ZXJ5J10sIGZ1bmN0aW9uICgkKSB7CiAgICAgICAgICAgIGZhY3RvcnkoJCwgcm9vdCk7CiAgICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICAgIC8vIEJyb3dzZXIgZ2xvYmFscwogICAgICAgIGZhY3RvcnkoalF1ZXJ5LCByb290KTsKICAgIH0KfSh0aGlzLCBmdW5jdGlvbihqUXVlcnksIHdpbmRvdykgewogIAoKICB2YXIgbWF0Y2hlZCwgYnJvd3NlcjsKCiAgalF1ZXJ5LnVhTWF0Y2ggPSBmdW5jdGlvbiggdWEgKSB7CiAgICB1YSA9IHVhLnRvTG93ZXJDYXNlKCk7CgogIAl2YXIgbWF0Y2ggPSAvKG9wcilbXC9dKFtcdy5dKykvLmV4ZWMoIHVhICkgfHwKICAJCS8oY2hyb21lKVsgXC9dKFtcdy5dKykvLmV4ZWMoIHVhICkgfHwKICAJCS8odmVyc2lvbilbIFwvXShbXHcuXSspLiooc2FmYXJpKVsgXC9dKFtcdy5dKykvLmV4ZWMoIHVhICkgfHwKICAJCS8od2Via2l0KVsgXC9dKFtcdy5dKykvLmV4ZWMoIHVhICkgfHwKICAJCS8ob3BlcmEpKD86Lip2ZXJzaW9ufClbIFwvXShbXHcuXSspLy5leGVjKCB1YSApIHx8CiAgCQkvKG1zaWUpIChbXHcuXSspLy5leGVjKCB1YSApIHx8CiAgCQl1YS5pbmRleE9mKCJ0cmlkZW50IikgPj0gMCAmJiAvKHJ2KSg/Ojp8ICkoW1x3Ll0rKS8uZXhlYyggdWEgKSB8fAogIAkJdWEuaW5kZXhPZigiY29tcGF0aWJsZSIpIDwgMCAmJiAvKG1vemlsbGEpKD86Lio/IHJ2OihbXHcuXSspfCkvLmV4ZWMoIHVhICkgfHwKICAJCVtdOwoKICAJdmFyIHBsYXRmb3JtX21hdGNoID0gLyhpcGFkKS8uZXhlYyggdWEgKSB8fAogIAkJLyhpcGhvbmUpLy5leGVjKCB1YSApIHx8CiAgCQkvKGFuZHJvaWQpLy5leGVjKCB1YSApIHx8CiAgCQkvKHdpbmRvd3MgcGhvbmUpLy5leGVjKCB1YSApIHx8CiAgCQkvKHdpbikvLmV4ZWMoIHVhICkgfHwKICAJCS8obWFjKS8uZXhlYyggdWEgKSB8fAogIAkJLyhsaW51eCkvLmV4ZWMoIHVhICkgfHwKICAJCS8oY3JvcykvaS5leGVjKCB1YSApIHx8CiAgCQlbXTsKCiAgCXJldHVybiB7CiAgCQlicm93c2VyOiBtYXRjaFsgMyBdIHx8IG1hdGNoWyAxIF0gfHwgIiIsCiAgCQl2ZXJzaW9uOiBtYXRjaFsgMiBdIHx8ICIwIiwKICAJCXBsYXRmb3JtOiBwbGF0Zm9ybV9tYXRjaFsgMCBdIHx8ICIiCiAgCX07CiAgfTsKCiAgbWF0Y2hlZCA9IGpRdWVyeS51YU1hdGNoKCB3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudCApOwogIGJyb3dzZXIgPSB7fTsKCiAgaWYgKCBtYXRjaGVkLmJyb3dzZXIgKSB7CiAgCWJyb3dzZXJbIG1hdGNoZWQuYnJvd3NlciBdID0gdHJ1ZTsKICAJYnJvd3Nlci52ZXJzaW9uID0gbWF0Y2hlZC52ZXJzaW9uOwogIAlicm93c2VyLnZlcnNpb25OdW1iZXIgPSBwYXJzZUludChtYXRjaGVkLnZlcnNpb24pOwogIH0KCiAgaWYgKCBtYXRjaGVkLnBsYXRmb3JtICkgewogIAlicm93c2VyWyBtYXRjaGVkLnBsYXRmb3JtIF0gPSB0cnVlOwogIH0KCiAgLy8gVGhlc2UgYXJlIGFsbCBjb25zaWRlcmVkIG1vYmlsZSBwbGF0Zm9ybXMsIG1lYW5pbmcgdGhleSBydW4gYSBtb2JpbGUgYnJvd3NlcgogIGlmICggYnJvd3Nlci5hbmRyb2lkIHx8IGJyb3dzZXIuaXBhZCB8fCBicm93c2VyLmlwaG9uZSB8fCBicm93c2VyWyAid2luZG93cyBwaG9uZSIgXSApIHsKICAJYnJvd3Nlci5tb2JpbGUgPSB0cnVlOwogIH0KCiAgLy8gVGhlc2UgYXJlIGFsbCBjb25zaWRlcmVkIGRlc2t0b3AgcGxhdGZvcm1zLCBtZWFuaW5nIHRoZXkgcnVuIGEgZGVza3RvcCBicm93c2VyCiAgaWYgKCBicm93c2VyLmNyb3MgfHwgYnJvd3Nlci5tYWMgfHwgYnJvd3Nlci5saW51eCB8fCBicm93c2VyLndpbiApIHsKICAJYnJvd3Nlci5kZXNrdG9wID0gdHJ1ZTsKICB9CgogIC8vIENocm9tZSwgT3BlcmEgMTUrIGFuZCBTYWZhcmkgYXJlIHdlYmtpdCBiYXNlZCBicm93c2VycwogIGlmICggYnJvd3Nlci5jaHJvbWUgfHwgYnJvd3Nlci5vcHIgfHwgYnJvd3Nlci5zYWZhcmkgKSB7CiAgCWJyb3dzZXIud2Via2l0ID0gdHJ1ZTsKICB9CgogIC8vIElFMTEgaGFzIGEgbmV3IHRva2VuIHNvIHdlIHdpbGwgYXNzaWduIGl0IG1zaWUgdG8gYXZvaWQgYnJlYWtpbmcgY2hhbmdlcwogIGlmICggYnJvd3Nlci5ydiApCiAgewogIAl2YXIgaWUgPSAibXNpZSI7CgogIAltYXRjaGVkLmJyb3dzZXIgPSBpZTsKICAJYnJvd3NlcltpZV0gPSB0cnVlOwogIH0KCiAgLy8gT3BlcmEgMTUrIGFyZSBpZGVudGlmaWVkIGFzIG9wcgogIGlmICggYnJvd3Nlci5vcHIgKQogIHsKICAJdmFyIG9wZXJhID0gIm9wZXJhIjsKCiAgCW1hdGNoZWQuYnJvd3NlciA9IG9wZXJhOwogIAlicm93c2VyW29wZXJhXSA9IHRydWU7CiAgfQoKICAvLyBTdG9jayBBbmRyb2lkIGJyb3dzZXJzIGFyZSBtYXJrZWQgYXMgU2FmYXJpIG9uIEFuZHJvaWQuCiAgaWYgKCBicm93c2VyLnNhZmFyaSAmJiBicm93c2VyLmFuZHJvaWQgKQogIHsKICAJdmFyIGFuZHJvaWQgPSAiYW5kcm9pZCI7CgogIAltYXRjaGVkLmJyb3dzZXIgPSBhbmRyb2lkOwogIAlicm93c2VyW2FuZHJvaWRdID0gdHJ1ZTsKICB9CgogIC8vIEFzc2lnbiB0aGUgbmFtZSBhbmQgcGxhdGZvcm0gdmFyaWFibGUKICBicm93c2VyLm5hbWUgPSBtYXRjaGVkLmJyb3dzZXI7CiAgYnJvd3Nlci5wbGF0Zm9ybSA9IG1hdGNoZWQucGxhdGZvcm07CgogIGpRdWVyeS5icm93c2VyID0gYnJvd3NlcjsKICByZXR1cm4gYnJvd3NlcjsKfSkpOwoKLyoKQ3J5cHRvSlMgdjMuMS4yCmNvZGUuZ29vZ2xlLmNvbS9wL2NyeXB0by1qcwooYykgMjAwOS0yMDEzIGJ5IEplZmYgTW90dC4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KY29kZS5nb29nbGUuY29tL3AvY3J5cHRvLWpzL3dpa2kvTGljZW5zZQoqLwovKioNCiAqIENyeXB0b0pTIGNvcmUgY29tcG9uZW50cy4NCiAqLw0KdmFyIENyeXB0b0pTID0gQ3J5cHRvSlMgfHwgKGZ1bmN0aW9uIChNYXRoLCB1bmRlZmluZWQpIHsNCiAgICAvKioNCiAgICAgKiBDcnlwdG9KUyBuYW1lc3BhY2UuDQogICAgICovDQogICAgdmFyIEMgPSB7fTsNCg0KICAgIC8qKg0KICAgICAqIExpYnJhcnkgbmFtZXNwYWNlLg0KICAgICAqLw0KICAgIHZhciBDX2xpYiA9IEMubGliID0ge307DQoNCiAgICAvKioNCiAgICAgKiBCYXNlIG9iamVjdCBmb3IgcHJvdG90eXBhbCBpbmhlcml0YW5jZS4NCiAgICAgKi8NCiAgICB2YXIgQmFzZSA9IENfbGliLkJhc2UgPSAoZnVuY3Rpb24gKCkgew0KICAgICAgICBmdW5jdGlvbiBGKCkge30NCg0KICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgLyoqDQogICAgICAgICAgICAgKiBDcmVhdGVzIGEgbmV3IG9iamVjdCB0aGF0IGluaGVyaXRzIGZyb20gdGhpcyBvYmplY3QuDQogICAgICAgICAgICAgKg0KICAgICAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IG92ZXJyaWRlcyBQcm9wZXJ0aWVzIHRvIGNvcHkgaW50byB0aGUgbmV3IG9iamVjdC4NCiAgICAgICAgICAgICAqDQogICAgICAgICAgICAgKiBAcmV0dXJuIHtPYmplY3R9IFRoZSBuZXcgb2JqZWN0Lg0KICAgICAgICAgICAgICoNCiAgICAgICAgICAgICAqIEBzdGF0aWMNCiAgICAgICAgICAgICAqDQogICAgICAgICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICAgICAgICoNCiAgICAgICAgICAgICAqICAgICB2YXIgTXlUeXBlID0gQ3J5cHRvSlMubGliLkJhc2UuZXh0ZW5kKHsNCiAgICAgICAgICAgICAqICAgICAgICAgZmllbGQ6ICd2YWx1ZScsDQogICAgICAgICAgICAgKg0KICAgICAgICAgICAgICogICAgICAgICBtZXRob2Q6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAqICAgICAgICAgfQ0KICAgICAgICAgICAgICogICAgIH0pOw0KICAgICAgICAgICAgICovDQogICAgICAgICAgICBleHRlbmQ6IGZ1bmN0aW9uIChvdmVycmlkZXMpIHsNCiAgICAgICAgICAgICAgICAvLyBTcGF3bg0KICAgICAgICAgICAgICAgIEYucHJvdG90eXBlID0gdGhpczsNCiAgICAgICAgICAgICAgICB2YXIgc3VidHlwZSA9IG5ldyBGKCk7DQoNCiAgICAgICAgICAgICAgICAvLyBBdWdtZW50DQogICAgICAgICAgICAgICAgaWYgKG92ZXJyaWRlcykgew0KICAgICAgICAgICAgICAgICAgICBzdWJ0eXBlLm1peEluKG92ZXJyaWRlcyk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgLy8gQ3JlYXRlIGRlZmF1bHQgaW5pdGlhbGl6ZXINCiAgICAgICAgICAgICAgICBpZiAoIXN1YnR5cGUuaGFzT3duUHJvcGVydHkoJ2luaXQnKSkgew0KICAgICAgICAgICAgICAgICAgICBzdWJ0eXBlLmluaXQgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBzdWJ0eXBlLiRzdXBlci5pbml0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7DQogICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgLy8gSW5pdGlhbGl6ZXIncyBwcm90b3R5cGUgaXMgdGhlIHN1YnR5cGUgb2JqZWN0DQogICAgICAgICAgICAgICAgc3VidHlwZS5pbml0LnByb3RvdHlwZSA9IHN1YnR5cGU7DQoNCiAgICAgICAgICAgICAgICAvLyBSZWZlcmVuY2Ugc3VwZXJ0eXBlDQogICAgICAgICAgICAgICAgc3VidHlwZS4kc3VwZXIgPSB0aGlzOw0KDQogICAgICAgICAgICAgICAgcmV0dXJuIHN1YnR5cGU7DQogICAgICAgICAgICB9LA0KDQogICAgICAgICAgICAvKioNCiAgICAgICAgICAgICAqIEV4dGVuZHMgdGhpcyBvYmplY3QgYW5kIHJ1bnMgdGhlIGluaXQgbWV0aG9kLg0KICAgICAgICAgICAgICogQXJndW1lbnRzIHRvIGNyZWF0ZSgpIHdpbGwgYmUgcGFzc2VkIHRvIGluaXQoKS4NCiAgICAgICAgICAgICAqDQogICAgICAgICAgICAgKiBAcmV0dXJuIHtPYmplY3R9IFRoZSBuZXcgb2JqZWN0Lg0KICAgICAgICAgICAgICoNCiAgICAgICAgICAgICAqIEBzdGF0aWMNCiAgICAgICAgICAgICAqDQogICAgICAgICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICAgICAgICoNCiAgICAgICAgICAgICAqICAgICB2YXIgaW5zdGFuY2UgPSBNeVR5cGUuY3JlYXRlKCk7DQogICAgICAgICAgICAgKi8NCiAgICAgICAgICAgIGNyZWF0ZTogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgIHZhciBpbnN0YW5jZSA9IHRoaXMuZXh0ZW5kKCk7DQogICAgICAgICAgICAgICAgaW5zdGFuY2UuaW5pdC5hcHBseShpbnN0YW5jZSwgYXJndW1lbnRzKTsNCg0KICAgICAgICAgICAgICAgIHJldHVybiBpbnN0YW5jZTsNCiAgICAgICAgICAgIH0sDQoNCiAgICAgICAgICAgIC8qKg0KICAgICAgICAgICAgICogSW5pdGlhbGl6ZXMgYSBuZXdseSBjcmVhdGVkIG9iamVjdC4NCiAgICAgICAgICAgICAqIE92ZXJyaWRlIHRoaXMgbWV0aG9kIHRvIGFkZCBzb21lIGxvZ2ljIHdoZW4geW91ciBvYmplY3RzIGFyZSBjcmVhdGVkLg0KICAgICAgICAgICAgICoNCiAgICAgICAgICAgICAqIEBleGFtcGxlDQogICAgICAgICAgICAgKg0KICAgICAgICAgICAgICogICAgIHZhciBNeVR5cGUgPSBDcnlwdG9KUy5saWIuQmFzZS5leHRlbmQoew0KICAgICAgICAgICAgICogICAgICAgICBpbml0OiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgKiAgICAgICAgICAgICAvLyAuLi4NCiAgICAgICAgICAgICAqICAgICAgICAgfQ0KICAgICAgICAgICAgICogICAgIH0pOw0KICAgICAgICAgICAgICovDQogICAgICAgICAgICBpbml0OiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICB9LA0KDQogICAgICAgICAgICAvKioNCiAgICAgICAgICAgICAqIENvcGllcyBwcm9wZXJ0aWVzIGludG8gdGhpcyBvYmplY3QuDQogICAgICAgICAgICAgKg0KICAgICAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IHByb3BlcnRpZXMgVGhlIHByb3BlcnRpZXMgdG8gbWl4IGluLg0KICAgICAgICAgICAgICoNCiAgICAgICAgICAgICAqIEBleGFtcGxlDQogICAgICAgICAgICAgKg0KICAgICAgICAgICAgICogICAgIE15VHlwZS5taXhJbih7DQogICAgICAgICAgICAgKiAgICAgICAgIGZpZWxkOiAndmFsdWUnDQogICAgICAgICAgICAgKiAgICAgfSk7DQogICAgICAgICAgICAgKi8NCiAgICAgICAgICAgIG1peEluOiBmdW5jdGlvbiAocHJvcGVydGllcykgew0KICAgICAgICAgICAgICAgIGZvciAodmFyIHByb3BlcnR5TmFtZSBpbiBwcm9wZXJ0aWVzKSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChwcm9wZXJ0aWVzLmhhc093blByb3BlcnR5KHByb3BlcnR5TmFtZSkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXNbcHJvcGVydHlOYW1lXSA9IHByb3BlcnRpZXNbcHJvcGVydHlOYW1lXTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIC8vIElFIHdvbid0IGNvcHkgdG9TdHJpbmcgdXNpbmcgdGhlIGxvb3AgYWJvdmUNCiAgICAgICAgICAgICAgICBpZiAocHJvcGVydGllcy5oYXNPd25Qcm9wZXJ0eSgndG9TdHJpbmcnKSkgew0KICAgICAgICAgICAgICAgICAgICB0aGlzLnRvU3RyaW5nID0gcHJvcGVydGllcy50b1N0cmluZzsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9LA0KDQogICAgICAgICAgICAvKioNCiAgICAgICAgICAgICAqIENyZWF0ZXMgYSBjb3B5IG9mIHRoaXMgb2JqZWN0Lg0KICAgICAgICAgICAgICoNCiAgICAgICAgICAgICAqIEByZXR1cm4ge09iamVjdH0gVGhlIGNsb25lLg0KICAgICAgICAgICAgICoNCiAgICAgICAgICAgICAqIEBleGFtcGxlDQogICAgICAgICAgICAgKg0KICAgICAgICAgICAgICogICAgIHZhciBjbG9uZSA9IGluc3RhbmNlLmNsb25lKCk7DQogICAgICAgICAgICAgKi8NCiAgICAgICAgICAgIGNsb25lOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaW5pdC5wcm90b3R5cGUuZXh0ZW5kKHRoaXMpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9Ow0KICAgIH0oKSk7DQoNCiAgICAvKioNCiAgICAgKiBBbiBhcnJheSBvZiAzMi1iaXQgd29yZHMuDQogICAgICoNCiAgICAgKiBAcHJvcGVydHkge0FycmF5fSB3b3JkcyBUaGUgYXJyYXkgb2YgMzItYml0IHdvcmRzLg0KICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBzaWdCeXRlcyBUaGUgbnVtYmVyIG9mIHNpZ25pZmljYW50IGJ5dGVzIGluIHRoaXMgd29yZCBhcnJheS4NCiAgICAgKi8NCiAgICB2YXIgV29yZEFycmF5ID0gQ19saWIuV29yZEFycmF5ID0gQmFzZS5leHRlbmQoew0KICAgICAgICAvKioNCiAgICAgICAgICogSW5pdGlhbGl6ZXMgYSBuZXdseSBjcmVhdGVkIHdvcmQgYXJyYXkuDQogICAgICAgICAqDQogICAgICAgICAqIEBwYXJhbSB7QXJyYXl9IHdvcmRzIChPcHRpb25hbCkgQW4gYXJyYXkgb2YgMzItYml0IHdvcmRzLg0KICAgICAgICAgKiBAcGFyYW0ge251bWJlcn0gc2lnQnl0ZXMgKE9wdGlvbmFsKSBUaGUgbnVtYmVyIG9mIHNpZ25pZmljYW50IGJ5dGVzIGluIHRoZSB3b3Jkcy4NCiAgICAgICAgICoNCiAgICAgICAgICogQGV4YW1wbGUNCiAgICAgICAgICoNCiAgICAgICAgICogICAgIHZhciB3b3JkQXJyYXkgPSBDcnlwdG9KUy5saWIuV29yZEFycmF5LmNyZWF0ZSgpOw0KICAgICAgICAgKiAgICAgdmFyIHdvcmRBcnJheSA9IENyeXB0b0pTLmxpYi5Xb3JkQXJyYXkuY3JlYXRlKFsweDAwMDEwMjAzLCAweDA0MDUwNjA3XSk7DQogICAgICAgICAqICAgICB2YXIgd29yZEFycmF5ID0gQ3J5cHRvSlMubGliLldvcmRBcnJheS5jcmVhdGUoWzB4MDAwMTAyMDMsIDB4MDQwNTA2MDddLCA2KTsNCiAgICAgICAgICovDQogICAgICAgIGluaXQ6IGZ1bmN0aW9uICh3b3Jkcywgc2lnQnl0ZXMpIHsNCiAgICAgICAgICAgIHdvcmRzID0gdGhpcy53b3JkcyA9IHdvcmRzIHx8IFtdOw0KDQogICAgICAgICAgICBpZiAoc2lnQnl0ZXMgIT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICAgICAgdGhpcy5zaWdCeXRlcyA9IHNpZ0J5dGVzOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICB0aGlzLnNpZ0J5dGVzID0gd29yZHMubGVuZ3RoICogNDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSwNCg0KICAgICAgICAvKioNCiAgICAgICAgICogQ29udmVydHMgdGhpcyB3b3JkIGFycmF5IHRvIGEgc3RyaW5nLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcGFyYW0ge0VuY29kZXJ9IGVuY29kZXIgKE9wdGlvbmFsKSBUaGUgZW5jb2Rpbmcgc3RyYXRlZ3kgdG8gdXNlLiBEZWZhdWx0OiBDcnlwdG9KUy5lbmMuSGV4DQogICAgICAgICAqDQogICAgICAgICAqIEByZXR1cm4ge3N0cmluZ30gVGhlIHN0cmluZ2lmaWVkIHdvcmQgYXJyYXkuDQogICAgICAgICAqDQogICAgICAgICAqIEBleGFtcGxlDQogICAgICAgICAqDQogICAgICAgICAqICAgICB2YXIgc3RyaW5nID0gd29yZEFycmF5ICsgJyc7DQogICAgICAgICAqICAgICB2YXIgc3RyaW5nID0gd29yZEFycmF5LnRvU3RyaW5nKCk7DQogICAgICAgICAqICAgICB2YXIgc3RyaW5nID0gd29yZEFycmF5LnRvU3RyaW5nKENyeXB0b0pTLmVuYy5VdGY4KTsNCiAgICAgICAgICovDQogICAgICAgIHRvU3RyaW5nOiBmdW5jdGlvbiAoZW5jb2Rlcikgew0KICAgICAgICAgICAgcmV0dXJuIChlbmNvZGVyIHx8IEhleCkuc3RyaW5naWZ5KHRoaXMpOw0KICAgICAgICB9LA0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBDb25jYXRlbmF0ZXMgYSB3b3JkIGFycmF5IHRvIHRoaXMgd29yZCBhcnJheS4NCiAgICAgICAgICoNCiAgICAgICAgICogQHBhcmFtIHtXb3JkQXJyYXl9IHdvcmRBcnJheSBUaGUgd29yZCBhcnJheSB0byBhcHBlbmQuDQogICAgICAgICAqDQogICAgICAgICAqIEByZXR1cm4ge1dvcmRBcnJheX0gVGhpcyB3b3JkIGFycmF5Lg0KICAgICAgICAgKg0KICAgICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICAgKg0KICAgICAgICAgKiAgICAgd29yZEFycmF5MS5jb25jYXQod29yZEFycmF5Mik7DQogICAgICAgICAqLw0KICAgICAgICBjb25jYXQ6IGZ1bmN0aW9uICh3b3JkQXJyYXkpIHsNCiAgICAgICAgICAgIC8vIFNob3J0Y3V0cw0KICAgICAgICAgICAgdmFyIHRoaXNXb3JkcyA9IHRoaXMud29yZHM7DQogICAgICAgICAgICB2YXIgdGhhdFdvcmRzID0gd29yZEFycmF5LndvcmRzOw0KICAgICAgICAgICAgdmFyIHRoaXNTaWdCeXRlcyA9IHRoaXMuc2lnQnl0ZXM7DQogICAgICAgICAgICB2YXIgdGhhdFNpZ0J5dGVzID0gd29yZEFycmF5LnNpZ0J5dGVzOw0KDQogICAgICAgICAgICAvLyBDbGFtcCBleGNlc3MgYml0cw0KICAgICAgICAgICAgdGhpcy5jbGFtcCgpOw0KDQogICAgICAgICAgICAvLyBDb25jYXQNCiAgICAgICAgICAgIGlmICh0aGlzU2lnQnl0ZXMgJSA0KSB7DQogICAgICAgICAgICAgICAgLy8gQ29weSBvbmUgYnl0ZSBhdCBhIHRpbWUNCiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoYXRTaWdCeXRlczsgaSsrKSB7DQogICAgICAgICAgICAgICAgICAgIHZhciB0aGF0Qnl0ZSA9ICh0aGF0V29yZHNbaSA+Pj4gMl0gPj4+ICgyNCAtIChpICUgNCkgKiA4KSkgJiAweGZmOw0KICAgICAgICAgICAgICAgICAgICB0aGlzV29yZHNbKHRoaXNTaWdCeXRlcyArIGkpID4+PiAyXSB8PSB0aGF0Qnl0ZSA8PCAoMjQgLSAoKHRoaXNTaWdCeXRlcyArIGkpICUgNCkgKiA4KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9IGVsc2UgaWYgKHRoYXRXb3Jkcy5sZW5ndGggPiAweGZmZmYpIHsNCiAgICAgICAgICAgICAgICAvLyBDb3B5IG9uZSB3b3JkIGF0IGEgdGltZQ0KICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhhdFNpZ0J5dGVzOyBpICs9IDQpIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpc1dvcmRzWyh0aGlzU2lnQnl0ZXMgKyBpKSA+Pj4gMl0gPSB0aGF0V29yZHNbaSA+Pj4gMl07DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAvLyBDb3B5IGFsbCB3b3JkcyBhdCBvbmNlDQogICAgICAgICAgICAgICAgdGhpc1dvcmRzLnB1c2guYXBwbHkodGhpc1dvcmRzLCB0aGF0V29yZHMpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdGhpcy5zaWdCeXRlcyArPSB0aGF0U2lnQnl0ZXM7DQoNCiAgICAgICAgICAgIC8vIENoYWluYWJsZQ0KICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgIH0sDQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIFJlbW92ZXMgaW5zaWduaWZpY2FudCBiaXRzLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICAgKg0KICAgICAgICAgKiAgICAgd29yZEFycmF5LmNsYW1wKCk7DQogICAgICAgICAqLw0KICAgICAgICBjbGFtcDogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgLy8gU2hvcnRjdXRzDQogICAgICAgICAgICB2YXIgd29yZHMgPSB0aGlzLndvcmRzOw0KICAgICAgICAgICAgdmFyIHNpZ0J5dGVzID0gdGhpcy5zaWdCeXRlczsNCg0KICAgICAgICAgICAgLy8gQ2xhbXANCiAgICAgICAgICAgIHdvcmRzW3NpZ0J5dGVzID4+PiAyXSAmPSAweGZmZmZmZmZmIDw8ICgzMiAtIChzaWdCeXRlcyAlIDQpICogOCk7DQogICAgICAgICAgICB3b3Jkcy5sZW5ndGggPSBNYXRoLmNlaWwoc2lnQnl0ZXMgLyA0KTsNCiAgICAgICAgfSwNCg0KICAgICAgICAvKioNCiAgICAgICAgICogQ3JlYXRlcyBhIGNvcHkgb2YgdGhpcyB3b3JkIGFycmF5Lg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcmV0dXJuIHtXb3JkQXJyYXl9IFRoZSBjbG9uZS4NCiAgICAgICAgICoNCiAgICAgICAgICogQGV4YW1wbGUNCiAgICAgICAgICoNCiAgICAgICAgICogICAgIHZhciBjbG9uZSA9IHdvcmRBcnJheS5jbG9uZSgpOw0KICAgICAgICAgKi8NCiAgICAgICAgY2xvbmU6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHZhciBjbG9uZSA9IEJhc2UuY2xvbmUuY2FsbCh0aGlzKTsNCiAgICAgICAgICAgIGNsb25lLndvcmRzID0gdGhpcy53b3Jkcy5zbGljZSgwKTsNCg0KICAgICAgICAgICAgcmV0dXJuIGNsb25lOw0KICAgICAgICB9LA0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBDcmVhdGVzIGEgd29yZCBhcnJheSBmaWxsZWQgd2l0aCByYW5kb20gYnl0ZXMuDQogICAgICAgICAqDQogICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSBuQnl0ZXMgVGhlIG51bWJlciBvZiByYW5kb20gYnl0ZXMgdG8gZ2VuZXJhdGUuDQogICAgICAgICAqDQogICAgICAgICAqIEByZXR1cm4ge1dvcmRBcnJheX0gVGhlIHJhbmRvbSB3b3JkIGFycmF5Lg0KICAgICAgICAgKg0KICAgICAgICAgKiBAc3RhdGljDQogICAgICAgICAqDQogICAgICAgICAqIEBleGFtcGxlDQogICAgICAgICAqDQogICAgICAgICAqICAgICB2YXIgd29yZEFycmF5ID0gQ3J5cHRvSlMubGliLldvcmRBcnJheS5yYW5kb20oMTYpOw0KICAgICAgICAgKi8NCiAgICAgICAgcmFuZG9tOiBmdW5jdGlvbiAobkJ5dGVzKSB7DQogICAgICAgICAgICB2YXIgd29yZHMgPSBbXTsNCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbkJ5dGVzOyBpICs9IDQpIHsNCiAgICAgICAgICAgICAgICB3b3Jkcy5wdXNoKChNYXRoLnJhbmRvbSgpICogMHgxMDAwMDAwMDApIHwgMCk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBuZXcgV29yZEFycmF5LmluaXQod29yZHMsIG5CeXRlcyk7DQogICAgICAgIH0NCiAgICB9KTsNCg0KICAgIC8qKg0KICAgICAqIEVuY29kZXIgbmFtZXNwYWNlLg0KICAgICAqLw0KICAgIHZhciBDX2VuYyA9IEMuZW5jID0ge307DQoNCiAgICAvKioNCiAgICAgKiBIZXggZW5jb2Rpbmcgc3RyYXRlZ3kuDQogICAgICovDQogICAgdmFyIEhleCA9IENfZW5jLkhleCA9IHsNCiAgICAgICAgLyoqDQogICAgICAgICAqIENvbnZlcnRzIGEgd29yZCBhcnJheSB0byBhIGhleCBzdHJpbmcuDQogICAgICAgICAqDQogICAgICAgICAqIEBwYXJhbSB7V29yZEFycmF5fSB3b3JkQXJyYXkgVGhlIHdvcmQgYXJyYXkuDQogICAgICAgICAqDQogICAgICAgICAqIEByZXR1cm4ge3N0cmluZ30gVGhlIGhleCBzdHJpbmcuDQogICAgICAgICAqDQogICAgICAgICAqIEBzdGF0aWMNCiAgICAgICAgICoNCiAgICAgICAgICogQGV4YW1wbGUNCiAgICAgICAgICoNCiAgICAgICAgICogICAgIHZhciBoZXhTdHJpbmcgPSBDcnlwdG9KUy5lbmMuSGV4LnN0cmluZ2lmeSh3b3JkQXJyYXkpOw0KICAgICAgICAgKi8NCiAgICAgICAgc3RyaW5naWZ5OiBmdW5jdGlvbiAod29yZEFycmF5KSB7DQogICAgICAgICAgICAvLyBTaG9ydGN1dHMNCiAgICAgICAgICAgIHZhciB3b3JkcyA9IHdvcmRBcnJheS53b3JkczsNCiAgICAgICAgICAgIHZhciBzaWdCeXRlcyA9IHdvcmRBcnJheS5zaWdCeXRlczsNCg0KICAgICAgICAgICAgLy8gQ29udmVydA0KICAgICAgICAgICAgdmFyIGhleENoYXJzID0gW107DQogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNpZ0J5dGVzOyBpKyspIHsNCiAgICAgICAgICAgICAgICB2YXIgYml0ZSA9ICh3b3Jkc1tpID4+PiAyXSA+Pj4gKDI0IC0gKGkgJSA0KSAqIDgpKSAmIDB4ZmY7DQogICAgICAgICAgICAgICAgaGV4Q2hhcnMucHVzaCgoYml0ZSA+Pj4gNCkudG9TdHJpbmcoMTYpKTsNCiAgICAgICAgICAgICAgICBoZXhDaGFycy5wdXNoKChiaXRlICYgMHgwZikudG9TdHJpbmcoMTYpKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGhleENoYXJzLmpvaW4oJycpOw0KICAgICAgICB9LA0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBDb252ZXJ0cyBhIGhleCBzdHJpbmcgdG8gYSB3b3JkIGFycmF5Lg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gaGV4U3RyIFRoZSBoZXggc3RyaW5nLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcmV0dXJuIHtXb3JkQXJyYXl9IFRoZSB3b3JkIGFycmF5Lg0KICAgICAgICAgKg0KICAgICAgICAgKiBAc3RhdGljDQogICAgICAgICAqDQogICAgICAgICAqIEBleGFtcGxlDQogICAgICAgICAqDQogICAgICAgICAqICAgICB2YXIgd29yZEFycmF5ID0gQ3J5cHRvSlMuZW5jLkhleC5wYXJzZShoZXhTdHJpbmcpOw0KICAgICAgICAgKi8NCiAgICAgICAgcGFyc2U6IGZ1bmN0aW9uIChoZXhTdHIpIHsNCiAgICAgICAgICAgIC8vIFNob3J0Y3V0DQogICAgICAgICAgICB2YXIgaGV4U3RyTGVuZ3RoID0gaGV4U3RyLmxlbmd0aDsNCg0KICAgICAgICAgICAgLy8gQ29udmVydA0KICAgICAgICAgICAgdmFyIHdvcmRzID0gW107DQogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGhleFN0ckxlbmd0aDsgaSArPSAyKSB7DQogICAgICAgICAgICAgICAgd29yZHNbaSA+Pj4gM10gfD0gcGFyc2VJbnQoaGV4U3RyLnN1YnN0cihpLCAyKSwgMTYpIDw8ICgyNCAtIChpICUgOCkgKiA0KTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIG5ldyBXb3JkQXJyYXkuaW5pdCh3b3JkcywgaGV4U3RyTGVuZ3RoIC8gMik7DQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogTGF0aW4xIGVuY29kaW5nIHN0cmF0ZWd5Lg0KICAgICAqLw0KICAgIHZhciBMYXRpbjEgPSBDX2VuYy5MYXRpbjEgPSB7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBDb252ZXJ0cyBhIHdvcmQgYXJyYXkgdG8gYSBMYXRpbjEgc3RyaW5nLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcGFyYW0ge1dvcmRBcnJheX0gd29yZEFycmF5IFRoZSB3b3JkIGFycmF5Lg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBMYXRpbjEgc3RyaW5nLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAc3RhdGljDQogICAgICAgICAqDQogICAgICAgICAqIEBleGFtcGxlDQogICAgICAgICAqDQogICAgICAgICAqICAgICB2YXIgbGF0aW4xU3RyaW5nID0gQ3J5cHRvSlMuZW5jLkxhdGluMS5zdHJpbmdpZnkod29yZEFycmF5KTsNCiAgICAgICAgICovDQogICAgICAgIHN0cmluZ2lmeTogZnVuY3Rpb24gKHdvcmRBcnJheSkgew0KICAgICAgICAgICAgLy8gU2hvcnRjdXRzDQogICAgICAgICAgICB2YXIgd29yZHMgPSB3b3JkQXJyYXkud29yZHM7DQogICAgICAgICAgICB2YXIgc2lnQnl0ZXMgPSB3b3JkQXJyYXkuc2lnQnl0ZXM7DQoNCiAgICAgICAgICAgIC8vIENvbnZlcnQNCiAgICAgICAgICAgIHZhciBsYXRpbjFDaGFycyA9IFtdOw0KICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzaWdCeXRlczsgaSsrKSB7DQogICAgICAgICAgICAgICAgdmFyIGJpdGUgPSAod29yZHNbaSA+Pj4gMl0gPj4+ICgyNCAtIChpICUgNCkgKiA4KSkgJiAweGZmOw0KICAgICAgICAgICAgICAgIGxhdGluMUNoYXJzLnB1c2goU3RyaW5nLmZyb21DaGFyQ29kZShiaXRlKSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBsYXRpbjFDaGFycy5qb2luKCcnKTsNCiAgICAgICAgfSwNCg0KICAgICAgICAvKioNCiAgICAgICAgICogQ29udmVydHMgYSBMYXRpbjEgc3RyaW5nIHRvIGEgd29yZCBhcnJheS4NCiAgICAgICAgICoNCiAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IGxhdGluMVN0ciBUaGUgTGF0aW4xIHN0cmluZy4NCiAgICAgICAgICoNCiAgICAgICAgICogQHJldHVybiB7V29yZEFycmF5fSBUaGUgd29yZCBhcnJheS4NCiAgICAgICAgICoNCiAgICAgICAgICogQHN0YXRpYw0KICAgICAgICAgKg0KICAgICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICAgKg0KICAgICAgICAgKiAgICAgdmFyIHdvcmRBcnJheSA9IENyeXB0b0pTLmVuYy5MYXRpbjEucGFyc2UobGF0aW4xU3RyaW5nKTsNCiAgICAgICAgICovDQogICAgICAgIHBhcnNlOiBmdW5jdGlvbiAobGF0aW4xU3RyKSB7DQogICAgICAgICAgICAvLyBTaG9ydGN1dA0KICAgICAgICAgICAgdmFyIGxhdGluMVN0ckxlbmd0aCA9IGxhdGluMVN0ci5sZW5ndGg7DQoNCiAgICAgICAgICAgIC8vIENvbnZlcnQNCiAgICAgICAgICAgIHZhciB3b3JkcyA9IFtdOw0KICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsYXRpbjFTdHJMZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgICAgIHdvcmRzW2kgPj4+IDJdIHw9IChsYXRpbjFTdHIuY2hhckNvZGVBdChpKSAmIDB4ZmYpIDw8ICgyNCAtIChpICUgNCkgKiA4KTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIG5ldyBXb3JkQXJyYXkuaW5pdCh3b3JkcywgbGF0aW4xU3RyTGVuZ3RoKTsNCiAgICAgICAgfQ0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBVVEYtOCBlbmNvZGluZyBzdHJhdGVneS4NCiAgICAgKi8NCiAgICB2YXIgVXRmOCA9IENfZW5jLlV0ZjggPSB7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBDb252ZXJ0cyBhIHdvcmQgYXJyYXkgdG8gYSBVVEYtOCBzdHJpbmcuDQogICAgICAgICAqDQogICAgICAgICAqIEBwYXJhbSB7V29yZEFycmF5fSB3b3JkQXJyYXkgVGhlIHdvcmQgYXJyYXkuDQogICAgICAgICAqDQogICAgICAgICAqIEByZXR1cm4ge3N0cmluZ30gVGhlIFVURi04IHN0cmluZy4NCiAgICAgICAgICoNCiAgICAgICAgICogQHN0YXRpYw0KICAgICAgICAgKg0KICAgICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICAgKg0KICAgICAgICAgKiAgICAgdmFyIHV0ZjhTdHJpbmcgPSBDcnlwdG9KUy5lbmMuVXRmOC5zdHJpbmdpZnkod29yZEFycmF5KTsNCiAgICAgICAgICovDQogICAgICAgIHN0cmluZ2lmeTogZnVuY3Rpb24gKHdvcmRBcnJheSkgew0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KGVzY2FwZShMYXRpbjEuc3RyaW5naWZ5KHdvcmRBcnJheSkpKTsNCiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ01hbGZvcm1lZCBVVEYtOCBkYXRhJyk7DQogICAgICAgICAgICB9DQogICAgICAgIH0sDQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIENvbnZlcnRzIGEgVVRGLTggc3RyaW5nIHRvIGEgd29yZCBhcnJheS4NCiAgICAgICAgICoNCiAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IHV0ZjhTdHIgVGhlIFVURi04IHN0cmluZy4NCiAgICAgICAgICoNCiAgICAgICAgICogQHJldHVybiB7V29yZEFycmF5fSBUaGUgd29yZCBhcnJheS4NCiAgICAgICAgICoNCiAgICAgICAgICogQHN0YXRpYw0KICAgICAgICAgKg0KICAgICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICAgKg0KICAgICAgICAgKiAgICAgdmFyIHdvcmRBcnJheSA9IENyeXB0b0pTLmVuYy5VdGY4LnBhcnNlKHV0ZjhTdHJpbmcpOw0KICAgICAgICAgKi8NCiAgICAgICAgcGFyc2U6IGZ1bmN0aW9uICh1dGY4U3RyKSB7DQogICAgICAgICAgICByZXR1cm4gTGF0aW4xLnBhcnNlKHVuZXNjYXBlKGVuY29kZVVSSUNvbXBvbmVudCh1dGY4U3RyKSkpOw0KICAgICAgICB9DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIEFic3RyYWN0IGJ1ZmZlcmVkIGJsb2NrIGFsZ29yaXRobSB0ZW1wbGF0ZS4NCiAgICAgKg0KICAgICAqIFRoZSBwcm9wZXJ0eSBibG9ja1NpemUgbXVzdCBiZSBpbXBsZW1lbnRlZCBpbiBhIGNvbmNyZXRlIHN1YnR5cGUuDQogICAgICoNCiAgICAgKiBAcHJvcGVydHkge251bWJlcn0gX21pbkJ1ZmZlclNpemUgVGhlIG51bWJlciBvZiBibG9ja3MgdGhhdCBzaG91bGQgYmUga2VwdCB1bnByb2Nlc3NlZCBpbiB0aGUgYnVmZmVyLiBEZWZhdWx0OiAwDQogICAgICovDQogICAgdmFyIEJ1ZmZlcmVkQmxvY2tBbGdvcml0aG0gPSBDX2xpYi5CdWZmZXJlZEJsb2NrQWxnb3JpdGhtID0gQmFzZS5leHRlbmQoew0KICAgICAgICAvKioNCiAgICAgICAgICogUmVzZXRzIHRoaXMgYmxvY2sgYWxnb3JpdGhtJ3MgZGF0YSBidWZmZXIgdG8gaXRzIGluaXRpYWwgc3RhdGUuDQogICAgICAgICAqDQogICAgICAgICAqIEBleGFtcGxlDQogICAgICAgICAqDQogICAgICAgICAqICAgICBidWZmZXJlZEJsb2NrQWxnb3JpdGhtLnJlc2V0KCk7DQogICAgICAgICAqLw0KICAgICAgICByZXNldDogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgLy8gSW5pdGlhbCB2YWx1ZXMNCiAgICAgICAgICAgIHRoaXMuX2RhdGEgPSBuZXcgV29yZEFycmF5LmluaXQoKTsNCiAgICAgICAgICAgIHRoaXMuX25EYXRhQnl0ZXMgPSAwOw0KICAgICAgICB9LA0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBBZGRzIG5ldyBkYXRhIHRvIHRoaXMgYmxvY2sgYWxnb3JpdGhtJ3MgYnVmZmVyLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcGFyYW0ge1dvcmRBcnJheXxzdHJpbmd9IGRhdGEgVGhlIGRhdGEgdG8gYXBwZW5kLiBTdHJpbmdzIGFyZSBjb252ZXJ0ZWQgdG8gYSBXb3JkQXJyYXkgdXNpbmcgVVRGLTguDQogICAgICAgICAqDQogICAgICAgICAqIEBleGFtcGxlDQogICAgICAgICAqDQogICAgICAgICAqICAgICBidWZmZXJlZEJsb2NrQWxnb3JpdGhtLl9hcHBlbmQoJ2RhdGEnKTsNCiAgICAgICAgICogICAgIGJ1ZmZlcmVkQmxvY2tBbGdvcml0aG0uX2FwcGVuZCh3b3JkQXJyYXkpOw0KICAgICAgICAgKi8NCiAgICAgICAgX2FwcGVuZDogZnVuY3Rpb24gKGRhdGEpIHsNCiAgICAgICAgICAgIC8vIENvbnZlcnQgc3RyaW5nIHRvIFdvcmRBcnJheSwgZWxzZSBhc3N1bWUgV29yZEFycmF5IGFscmVhZHkNCiAgICAgICAgICAgIGlmICh0eXBlb2YgZGF0YSA9PSAnc3RyaW5nJykgew0KICAgICAgICAgICAgICAgIGRhdGEgPSBVdGY4LnBhcnNlKGRhdGEpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBBcHBlbmQNCiAgICAgICAgICAgIHRoaXMuX2RhdGEuY29uY2F0KGRhdGEpOw0KICAgICAgICAgICAgdGhpcy5fbkRhdGFCeXRlcyArPSBkYXRhLnNpZ0J5dGVzOw0KICAgICAgICB9LA0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBQcm9jZXNzZXMgYXZhaWxhYmxlIGRhdGEgYmxvY2tzLg0KICAgICAgICAgKg0KICAgICAgICAgKiBUaGlzIG1ldGhvZCBpbnZva2VzIF9kb1Byb2Nlc3NCbG9jayhvZmZzZXQpLCB3aGljaCBtdXN0IGJlIGltcGxlbWVudGVkIGJ5IGEgY29uY3JldGUgc3VidHlwZS4NCiAgICAgICAgICoNCiAgICAgICAgICogQHBhcmFtIHtib29sZWFufSBkb0ZsdXNoIFdoZXRoZXIgYWxsIGJsb2NrcyBhbmQgcGFydGlhbCBibG9ja3Mgc2hvdWxkIGJlIHByb2Nlc3NlZC4NCiAgICAgICAgICoNCiAgICAgICAgICogQHJldHVybiB7V29yZEFycmF5fSBUaGUgcHJvY2Vzc2VkIGRhdGEuDQogICAgICAgICAqDQogICAgICAgICAqIEBleGFtcGxlDQogICAgICAgICAqDQogICAgICAgICAqICAgICB2YXIgcHJvY2Vzc2VkRGF0YSA9IGJ1ZmZlcmVkQmxvY2tBbGdvcml0aG0uX3Byb2Nlc3MoKTsNCiAgICAgICAgICogICAgIHZhciBwcm9jZXNzZWREYXRhID0gYnVmZmVyZWRCbG9ja0FsZ29yaXRobS5fcHJvY2VzcyghISdmbHVzaCcpOw0KICAgICAgICAgKi8NCiAgICAgICAgX3Byb2Nlc3M6IGZ1bmN0aW9uIChkb0ZsdXNoKSB7DQogICAgICAgICAgICAvLyBTaG9ydGN1dHMNCiAgICAgICAgICAgIHZhciBkYXRhID0gdGhpcy5fZGF0YTsNCiAgICAgICAgICAgIHZhciBkYXRhV29yZHMgPSBkYXRhLndvcmRzOw0KICAgICAgICAgICAgdmFyIGRhdGFTaWdCeXRlcyA9IGRhdGEuc2lnQnl0ZXM7DQogICAgICAgICAgICB2YXIgYmxvY2tTaXplID0gdGhpcy5ibG9ja1NpemU7DQogICAgICAgICAgICB2YXIgYmxvY2tTaXplQnl0ZXMgPSBibG9ja1NpemUgKiA0Ow0KDQogICAgICAgICAgICAvLyBDb3VudCBibG9ja3MgcmVhZHkNCiAgICAgICAgICAgIHZhciBuQmxvY2tzUmVhZHkgPSBkYXRhU2lnQnl0ZXMgLyBibG9ja1NpemVCeXRlczsNCiAgICAgICAgICAgIGlmIChkb0ZsdXNoKSB7DQogICAgICAgICAgICAgICAgLy8gUm91bmQgdXAgdG8gaW5jbHVkZSBwYXJ0aWFsIGJsb2Nrcw0KICAgICAgICAgICAgICAgIG5CbG9ja3NSZWFkeSA9IE1hdGguY2VpbChuQmxvY2tzUmVhZHkpOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAvLyBSb3VuZCBkb3duIHRvIGluY2x1ZGUgb25seSBmdWxsIGJsb2NrcywNCiAgICAgICAgICAgICAgICAvLyBsZXNzIHRoZSBudW1iZXIgb2YgYmxvY2tzIHRoYXQgbXVzdCByZW1haW4gaW4gdGhlIGJ1ZmZlcg0KICAgICAgICAgICAgICAgIG5CbG9ja3NSZWFkeSA9IE1hdGgubWF4KChuQmxvY2tzUmVhZHkgfCAwKSAtIHRoaXMuX21pbkJ1ZmZlclNpemUsIDApOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBDb3VudCB3b3JkcyByZWFkeQ0KICAgICAgICAgICAgdmFyIG5Xb3Jkc1JlYWR5ID0gbkJsb2Nrc1JlYWR5ICogYmxvY2tTaXplOw0KDQogICAgICAgICAgICAvLyBDb3VudCBieXRlcyByZWFkeQ0KICAgICAgICAgICAgdmFyIG5CeXRlc1JlYWR5ID0gTWF0aC5taW4obldvcmRzUmVhZHkgKiA0LCBkYXRhU2lnQnl0ZXMpOw0KDQogICAgICAgICAgICAvLyBQcm9jZXNzIGJsb2Nrcw0KICAgICAgICAgICAgaWYgKG5Xb3Jkc1JlYWR5KSB7DQogICAgICAgICAgICAgICAgZm9yICh2YXIgb2Zmc2V0ID0gMDsgb2Zmc2V0IDwgbldvcmRzUmVhZHk7IG9mZnNldCArPSBibG9ja1NpemUpIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gUGVyZm9ybSBjb25jcmV0ZS1hbGdvcml0aG0gbG9naWMNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZG9Qcm9jZXNzQmxvY2soZGF0YVdvcmRzLCBvZmZzZXQpOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIC8vIFJlbW92ZSBwcm9jZXNzZWQgd29yZHMNCiAgICAgICAgICAgICAgICB2YXIgcHJvY2Vzc2VkV29yZHMgPSBkYXRhV29yZHMuc3BsaWNlKDAsIG5Xb3Jkc1JlYWR5KTsNCiAgICAgICAgICAgICAgICBkYXRhLnNpZ0J5dGVzIC09IG5CeXRlc1JlYWR5Ow0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBSZXR1cm4gcHJvY2Vzc2VkIHdvcmRzDQogICAgICAgICAgICByZXR1cm4gbmV3IFdvcmRBcnJheS5pbml0KHByb2Nlc3NlZFdvcmRzLCBuQnl0ZXNSZWFkeSk7DQogICAgICAgIH0sDQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIENyZWF0ZXMgYSBjb3B5IG9mIHRoaXMgb2JqZWN0Lg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcmV0dXJuIHtPYmplY3R9IFRoZSBjbG9uZS4NCiAgICAgICAgICoNCiAgICAgICAgICogQGV4YW1wbGUNCiAgICAgICAgICoNCiAgICAgICAgICogICAgIHZhciBjbG9uZSA9IGJ1ZmZlcmVkQmxvY2tBbGdvcml0aG0uY2xvbmUoKTsNCiAgICAgICAgICovDQogICAgICAgIGNsb25lOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICB2YXIgY2xvbmUgPSBCYXNlLmNsb25lLmNhbGwodGhpcyk7DQogICAgICAgICAgICBjbG9uZS5fZGF0YSA9IHRoaXMuX2RhdGEuY2xvbmUoKTsNCg0KICAgICAgICAgICAgcmV0dXJuIGNsb25lOw0KICAgICAgICB9LA0KDQogICAgICAgIF9taW5CdWZmZXJTaXplOiAwDQogICAgfSk7DQoNCiAgICAvKioNCiAgICAgKiBBYnN0cmFjdCBoYXNoZXIgdGVtcGxhdGUuDQogICAgICoNCiAgICAgKiBAcHJvcGVydHkge251bWJlcn0gYmxvY2tTaXplIFRoZSBudW1iZXIgb2YgMzItYml0IHdvcmRzIHRoaXMgaGFzaGVyIG9wZXJhdGVzIG9uLiBEZWZhdWx0OiAxNiAoNTEyIGJpdHMpDQogICAgICovDQogICAgdmFyIEhhc2hlciA9IENfbGliLkhhc2hlciA9IEJ1ZmZlcmVkQmxvY2tBbGdvcml0aG0uZXh0ZW5kKHsNCiAgICAgICAgLyoqDQogICAgICAgICAqIENvbmZpZ3VyYXRpb24gb3B0aW9ucy4NCiAgICAgICAgICovDQogICAgICAgIGNmZzogQmFzZS5leHRlbmQoKSwNCg0KICAgICAgICAvKioNCiAgICAgICAgICogSW5pdGlhbGl6ZXMgYSBuZXdseSBjcmVhdGVkIGhhc2hlci4NCiAgICAgICAgICoNCiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGNmZyAoT3B0aW9uYWwpIFRoZSBjb25maWd1cmF0aW9uIG9wdGlvbnMgdG8gdXNlIGZvciB0aGlzIGhhc2ggY29tcHV0YXRpb24uDQogICAgICAgICAqDQogICAgICAgICAqIEBleGFtcGxlDQogICAgICAgICAqDQogICAgICAgICAqICAgICB2YXIgaGFzaGVyID0gQ3J5cHRvSlMuYWxnby5TSEEyNTYuY3JlYXRlKCk7DQogICAgICAgICAqLw0KICAgICAgICBpbml0OiBmdW5jdGlvbiAoY2ZnKSB7DQogICAgICAgICAgICAvLyBBcHBseSBjb25maWcgZGVmYXVsdHMNCiAgICAgICAgICAgIHRoaXMuY2ZnID0gdGhpcy5jZmcuZXh0ZW5kKGNmZyk7DQoNCiAgICAgICAgICAgIC8vIFNldCBpbml0aWFsIHZhbHVlcw0KICAgICAgICAgICAgdGhpcy5yZXNldCgpOw0KICAgICAgICB9LA0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBSZXNldHMgdGhpcyBoYXNoZXIgdG8gaXRzIGluaXRpYWwgc3RhdGUuDQogICAgICAgICAqDQogICAgICAgICAqIEBleGFtcGxlDQogICAgICAgICAqDQogICAgICAgICAqICAgICBoYXNoZXIucmVzZXQoKTsNCiAgICAgICAgICovDQogICAgICAgIHJlc2V0OiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAvLyBSZXNldCBkYXRhIGJ1ZmZlcg0KICAgICAgICAgICAgQnVmZmVyZWRCbG9ja0FsZ29yaXRobS5yZXNldC5jYWxsKHRoaXMpOw0KDQogICAgICAgICAgICAvLyBQZXJmb3JtIGNvbmNyZXRlLWhhc2hlciBsb2dpYw0KICAgICAgICAgICAgdGhpcy5fZG9SZXNldCgpOw0KICAgICAgICB9LA0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBVcGRhdGVzIHRoaXMgaGFzaGVyIHdpdGggYSBtZXNzYWdlLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcGFyYW0ge1dvcmRBcnJheXxzdHJpbmd9IG1lc3NhZ2VVcGRhdGUgVGhlIG1lc3NhZ2UgdG8gYXBwZW5kLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcmV0dXJuIHtIYXNoZXJ9IFRoaXMgaGFzaGVyLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICAgKg0KICAgICAgICAgKiAgICAgaGFzaGVyLnVwZGF0ZSgnbWVzc2FnZScpOw0KICAgICAgICAgKiAgICAgaGFzaGVyLnVwZGF0ZSh3b3JkQXJyYXkpOw0KICAgICAgICAgKi8NCiAgICAgICAgdXBkYXRlOiBmdW5jdGlvbiAobWVzc2FnZVVwZGF0ZSkgew0KICAgICAgICAgICAgLy8gQXBwZW5kDQogICAgICAgICAgICB0aGlzLl9hcHBlbmQobWVzc2FnZVVwZGF0ZSk7DQoNCiAgICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgaGFzaA0KICAgICAgICAgICAgdGhpcy5fcHJvY2VzcygpOw0KDQogICAgICAgICAgICAvLyBDaGFpbmFibGUNCiAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICB9LA0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBGaW5hbGl6ZXMgdGhlIGhhc2ggY29tcHV0YXRpb24uDQogICAgICAgICAqIE5vdGUgdGhhdCB0aGUgZmluYWxpemUgb3BlcmF0aW9uIGlzIGVmZmVjdGl2ZWx5IGEgZGVzdHJ1Y3RpdmUsIHJlYWQtb25jZSBvcGVyYXRpb24uDQogICAgICAgICAqDQogICAgICAgICAqIEBwYXJhbSB7V29yZEFycmF5fHN0cmluZ30gbWVzc2FnZVVwZGF0ZSAoT3B0aW9uYWwpIEEgZmluYWwgbWVzc2FnZSB1cGRhdGUuDQogICAgICAgICAqDQogICAgICAgICAqIEByZXR1cm4ge1dvcmRBcnJheX0gVGhlIGhhc2guDQogICAgICAgICAqDQogICAgICAgICAqIEBleGFtcGxlDQogICAgICAgICAqDQogICAgICAgICAqICAgICB2YXIgaGFzaCA9IGhhc2hlci5maW5hbGl6ZSgpOw0KICAgICAgICAgKiAgICAgdmFyIGhhc2ggPSBoYXNoZXIuZmluYWxpemUoJ21lc3NhZ2UnKTsNCiAgICAgICAgICogICAgIHZhciBoYXNoID0gaGFzaGVyLmZpbmFsaXplKHdvcmRBcnJheSk7DQogICAgICAgICAqLw0KICAgICAgICBmaW5hbGl6ZTogZnVuY3Rpb24gKG1lc3NhZ2VVcGRhdGUpIHsNCiAgICAgICAgICAgIC8vIEZpbmFsIG1lc3NhZ2UgdXBkYXRlDQogICAgICAgICAgICBpZiAobWVzc2FnZVVwZGF0ZSkgew0KICAgICAgICAgICAgICAgIHRoaXMuX2FwcGVuZChtZXNzYWdlVXBkYXRlKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gUGVyZm9ybSBjb25jcmV0ZS1oYXNoZXIgbG9naWMNCiAgICAgICAgICAgIHZhciBoYXNoID0gdGhpcy5fZG9GaW5hbGl6ZSgpOw0KDQogICAgICAgICAgICByZXR1cm4gaGFzaDsNCiAgICAgICAgfSwNCg0KICAgICAgICBibG9ja1NpemU6IDUxMi8zMiwNCg0KICAgICAgICAvKioNCiAgICAgICAgICogQ3JlYXRlcyBhIHNob3J0Y3V0IGZ1bmN0aW9uIHRvIGEgaGFzaGVyJ3Mgb2JqZWN0IGludGVyZmFjZS4NCiAgICAgICAgICoNCiAgICAgICAgICogQHBhcmFtIHtIYXNoZXJ9IGhhc2hlciBUaGUgaGFzaGVyIHRvIGNyZWF0ZSBhIGhlbHBlciBmb3IuDQogICAgICAgICAqDQogICAgICAgICAqIEByZXR1cm4ge0Z1bmN0aW9ufSBUaGUgc2hvcnRjdXQgZnVuY3Rpb24uDQogICAgICAgICAqDQogICAgICAgICAqIEBzdGF0aWMNCiAgICAgICAgICoNCiAgICAgICAgICogQGV4YW1wbGUNCiAgICAgICAgICoNCiAgICAgICAgICogICAgIHZhciBTSEEyNTYgPSBDcnlwdG9KUy5saWIuSGFzaGVyLl9jcmVhdGVIZWxwZXIoQ3J5cHRvSlMuYWxnby5TSEEyNTYpOw0KICAgICAgICAgKi8NCiAgICAgICAgX2NyZWF0ZUhlbHBlcjogZnVuY3Rpb24gKGhhc2hlcikgew0KICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChtZXNzYWdlLCBjZmcpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IGhhc2hlci5pbml0KGNmZykuZmluYWxpemUobWVzc2FnZSk7DQogICAgICAgICAgICB9Ow0KICAgICAgICB9LA0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBDcmVhdGVzIGEgc2hvcnRjdXQgZnVuY3Rpb24gdG8gdGhlIEhNQUMncyBvYmplY3QgaW50ZXJmYWNlLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcGFyYW0ge0hhc2hlcn0gaGFzaGVyIFRoZSBoYXNoZXIgdG8gdXNlIGluIHRoaXMgSE1BQyBoZWxwZXIuDQogICAgICAgICAqDQogICAgICAgICAqIEByZXR1cm4ge0Z1bmN0aW9ufSBUaGUgc2hvcnRjdXQgZnVuY3Rpb24uDQogICAgICAgICAqDQogICAgICAgICAqIEBzdGF0aWMNCiAgICAgICAgICoNCiAgICAgICAgICogQGV4YW1wbGUNCiAgICAgICAgICoNCiAgICAgICAgICogICAgIHZhciBIbWFjU0hBMjU2ID0gQ3J5cHRvSlMubGliLkhhc2hlci5fY3JlYXRlSG1hY0hlbHBlcihDcnlwdG9KUy5hbGdvLlNIQTI1Nik7DQogICAgICAgICAqLw0KICAgICAgICBfY3JlYXRlSG1hY0hlbHBlcjogZnVuY3Rpb24gKGhhc2hlcikgew0KICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChtZXNzYWdlLCBrZXkpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IENfYWxnby5ITUFDLmluaXQoaGFzaGVyLCBrZXkpLmZpbmFsaXplKG1lc3NhZ2UpOw0KICAgICAgICAgICAgfTsNCiAgICAgICAgfQ0KICAgIH0pOw0KDQogICAgLyoqDQogICAgICogQWxnb3JpdGhtIG5hbWVzcGFjZS4NCiAgICAgKi8NCiAgICB2YXIgQ19hbGdvID0gQy5hbGdvID0ge307DQoNCiAgICByZXR1cm4gQzsNCn0oTWF0aCkpOw0KCmRlZmluZSgiY3J5cHRvLmNvcmUiLCBmdW5jdGlvbigpe30pOwoKLyoKQ3J5cHRvSlMgdjMuMS4yCmNvZGUuZ29vZ2xlLmNvbS9wL2NyeXB0by1qcwooYykgMjAwOS0yMDEzIGJ5IEplZmYgTW90dC4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KY29kZS5nb29nbGUuY29tL3AvY3J5cHRvLWpzL3dpa2kvTGljZW5zZQoqLwooZnVuY3Rpb24gKCkgewogICAgLy8gU2hvcnRjdXRzCiAgICB2YXIgQyA9IENyeXB0b0pTOwogICAgdmFyIENfbGliID0gQy5saWI7CiAgICB2YXIgV29yZEFycmF5ID0gQ19saWIuV29yZEFycmF5OwogICAgdmFyIENfZW5jID0gQy5lbmM7CgogICAgLyoqCiAgICAgKiBCYXNlNjQgZW5jb2Rpbmcgc3RyYXRlZ3kuCiAgICAgKi8KICAgIHZhciBCYXNlNjQgPSBDX2VuYy5CYXNlNjQgPSB7CiAgICAgICAgLyoqCiAgICAgICAgICogQ29udmVydHMgYSB3b3JkIGFycmF5IHRvIGEgQmFzZTY0IHN0cmluZy4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7V29yZEFycmF5fSB3b3JkQXJyYXkgVGhlIHdvcmQgYXJyYXkuCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBCYXNlNjQgc3RyaW5nLgogICAgICAgICAqCiAgICAgICAgICogQHN0YXRpYwogICAgICAgICAqCiAgICAgICAgICogQGV4YW1wbGUKICAgICAgICAgKgogICAgICAgICAqICAgICB2YXIgYmFzZTY0U3RyaW5nID0gQ3J5cHRvSlMuZW5jLkJhc2U2NC5zdHJpbmdpZnkod29yZEFycmF5KTsKICAgICAgICAgKi8KICAgICAgICBzdHJpbmdpZnk6IGZ1bmN0aW9uICh3b3JkQXJyYXkpIHsKICAgICAgICAgICAgLy8gU2hvcnRjdXRzCiAgICAgICAgICAgIHZhciB3b3JkcyA9IHdvcmRBcnJheS53b3JkczsKICAgICAgICAgICAgdmFyIHNpZ0J5dGVzID0gd29yZEFycmF5LnNpZ0J5dGVzOwogICAgICAgICAgICB2YXIgbWFwID0gdGhpcy5fbWFwOwoKICAgICAgICAgICAgLy8gQ2xhbXAgZXhjZXNzIGJpdHMKICAgICAgICAgICAgd29yZEFycmF5LmNsYW1wKCk7CgogICAgICAgICAgICAvLyBDb252ZXJ0CiAgICAgICAgICAgIHZhciBiYXNlNjRDaGFycyA9IFtdOwogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNpZ0J5dGVzOyBpICs9IDMpIHsKICAgICAgICAgICAgICAgIHZhciBieXRlMSA9ICh3b3Jkc1tpID4+PiAyXSAgICAgICA+Pj4gKDI0IC0gKGkgJSA0KSAqIDgpKSAgICAgICAmIDB4ZmY7CiAgICAgICAgICAgICAgICB2YXIgYnl0ZTIgPSAod29yZHNbKGkgKyAxKSA+Pj4gMl0gPj4+ICgyNCAtICgoaSArIDEpICUgNCkgKiA4KSkgJiAweGZmOwogICAgICAgICAgICAgICAgdmFyIGJ5dGUzID0gKHdvcmRzWyhpICsgMikgPj4+IDJdID4+PiAoMjQgLSAoKGkgKyAyKSAlIDQpICogOCkpICYgMHhmZjsKCiAgICAgICAgICAgICAgICB2YXIgdHJpcGxldCA9IChieXRlMSA8PCAxNikgfCAoYnl0ZTIgPDwgOCkgfCBieXRlMzsKCiAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgKGogPCA0KSAmJiAoaSArIGogKiAwLjc1IDwgc2lnQnl0ZXMpOyBqKyspIHsKICAgICAgICAgICAgICAgICAgICBiYXNlNjRDaGFycy5wdXNoKG1hcC5jaGFyQXQoKHRyaXBsZXQgPj4+ICg2ICogKDMgLSBqKSkpICYgMHgzZikpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBBZGQgcGFkZGluZwogICAgICAgICAgICB2YXIgcGFkZGluZ0NoYXIgPSBtYXAuY2hhckF0KDY0KTsKICAgICAgICAgICAgaWYgKHBhZGRpbmdDaGFyKSB7CiAgICAgICAgICAgICAgICB3aGlsZSAoYmFzZTY0Q2hhcnMubGVuZ3RoICUgNCkgewogICAgICAgICAgICAgICAgICAgIGJhc2U2NENoYXJzLnB1c2gocGFkZGluZ0NoYXIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gYmFzZTY0Q2hhcnMuam9pbignJyk7CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogQ29udmVydHMgYSBCYXNlNjQgc3RyaW5nIHRvIGEgd29yZCBhcnJheS4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBiYXNlNjRTdHIgVGhlIEJhc2U2NCBzdHJpbmcuCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIHtXb3JkQXJyYXl9IFRoZSB3b3JkIGFycmF5LgogICAgICAgICAqCiAgICAgICAgICogQHN0YXRpYwogICAgICAgICAqCiAgICAgICAgICogQGV4YW1wbGUKICAgICAgICAgKgogICAgICAgICAqICAgICB2YXIgd29yZEFycmF5ID0gQ3J5cHRvSlMuZW5jLkJhc2U2NC5wYXJzZShiYXNlNjRTdHJpbmcpOwogICAgICAgICAqLwogICAgICAgIHBhcnNlOiBmdW5jdGlvbiAoYmFzZTY0U3RyKSB7CiAgICAgICAgICAgIC8vIFNob3J0Y3V0cwogICAgICAgICAgICB2YXIgYmFzZTY0U3RyTGVuZ3RoID0gYmFzZTY0U3RyLmxlbmd0aDsKICAgICAgICAgICAgdmFyIG1hcCA9IHRoaXMuX21hcDsKCiAgICAgICAgICAgIC8vIElnbm9yZSBwYWRkaW5nCiAgICAgICAgICAgIHZhciBwYWRkaW5nQ2hhciA9IG1hcC5jaGFyQXQoNjQpOwogICAgICAgICAgICBpZiAocGFkZGluZ0NoYXIpIHsKICAgICAgICAgICAgICAgIHZhciBwYWRkaW5nSW5kZXggPSBiYXNlNjRTdHIuaW5kZXhPZihwYWRkaW5nQ2hhcik7CiAgICAgICAgICAgICAgICBpZiAocGFkZGluZ0luZGV4ICE9IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgYmFzZTY0U3RyTGVuZ3RoID0gcGFkZGluZ0luZGV4OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBDb252ZXJ0CiAgICAgICAgICAgIHZhciB3b3JkcyA9IFtdOwogICAgICAgICAgICB2YXIgbkJ5dGVzID0gMDsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBiYXNlNjRTdHJMZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKGkgJSA0KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGJpdHMxID0gbWFwLmluZGV4T2YoYmFzZTY0U3RyLmNoYXJBdChpIC0gMSkpIDw8ICgoaSAlIDQpICogMik7CiAgICAgICAgICAgICAgICAgICAgdmFyIGJpdHMyID0gbWFwLmluZGV4T2YoYmFzZTY0U3RyLmNoYXJBdChpKSkgPj4+ICg2IC0gKGkgJSA0KSAqIDIpOwogICAgICAgICAgICAgICAgICAgIHdvcmRzW25CeXRlcyA+Pj4gMl0gfD0gKGJpdHMxIHwgYml0czIpIDw8ICgyNCAtIChuQnl0ZXMgJSA0KSAqIDgpOwogICAgICAgICAgICAgICAgICAgIG5CeXRlcysrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gV29yZEFycmF5LmNyZWF0ZSh3b3JkcywgbkJ5dGVzKTsKICAgICAgICB9LAoKICAgICAgICBfbWFwOiAnQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkrLz0nCiAgICB9Owp9KCkpOwoKZGVmaW5lKCJjcnlwdG8uZW5jLWJhc2U2NCIsIFsiY3J5cHRvLmNvcmUiXSwgZnVuY3Rpb24oKXt9KTsKCihmdW5jdGlvbiAoTWF0aCkgew0KICAgIC8vIFNob3J0Y3V0cw0KICAgIHZhciBDID0gQ3J5cHRvSlM7DQogICAgdmFyIENfbGliID0gQy5saWI7DQogICAgdmFyIFdvcmRBcnJheSA9IENfbGliLldvcmRBcnJheTsNCiAgICB2YXIgSGFzaGVyID0gQ19saWIuSGFzaGVyOw0KICAgIHZhciBDX2FsZ28gPSBDLmFsZ287DQoNCiAgICAvLyBDb25zdGFudHMgdGFibGUNCiAgICB2YXIgVCA9IFtdOw0KDQogICAgLy8gQ29tcHV0ZSBjb25zdGFudHMNCiAgICAoZnVuY3Rpb24gKCkgew0KICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDY0OyBpKyspIHsNCiAgICAgICAgICAgIFRbaV0gPSAoTWF0aC5hYnMoTWF0aC5zaW4oaSArIDEpKSAqIDB4MTAwMDAwMDAwKSB8IDA7DQogICAgICAgIH0NCiAgICB9KCkpOw0KDQogICAgLyoqDQogICAgICogTUQ1IGhhc2ggYWxnb3JpdGhtLg0KICAgICAqLw0KICAgIHZhciBNRDUgPSBDX2FsZ28uTUQ1ID0gSGFzaGVyLmV4dGVuZCh7DQogICAgICAgIF9kb1Jlc2V0OiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICB0aGlzLl9oYXNoID0gbmV3IFdvcmRBcnJheS5pbml0KFsNCiAgICAgICAgICAgICAgICAweDY3NDUyMzAxLCAweGVmY2RhYjg5LA0KICAgICAgICAgICAgICAgIDB4OThiYWRjZmUsIDB4MTAzMjU0NzYNCiAgICAgICAgICAgIF0pOw0KICAgICAgICB9LA0KDQogICAgICAgIF9kb1Byb2Nlc3NCbG9jazogZnVuY3Rpb24gKE0sIG9mZnNldCkgew0KICAgICAgICAgICAgLy8gU3dhcCBlbmRpYW4NCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgMTY7IGkrKykgew0KICAgICAgICAgICAgICAgIC8vIFNob3J0Y3V0cw0KICAgICAgICAgICAgICAgIHZhciBvZmZzZXRfaSA9IG9mZnNldCArIGk7DQogICAgICAgICAgICAgICAgdmFyIE1fb2Zmc2V0X2kgPSBNW29mZnNldF9pXTsNCg0KICAgICAgICAgICAgICAgIE1bb2Zmc2V0X2ldID0gKA0KICAgICAgICAgICAgICAgICAgICAoKChNX29mZnNldF9pIDw8IDgpICB8IChNX29mZnNldF9pID4+PiAyNCkpICYgMHgwMGZmMDBmZikgfA0KICAgICAgICAgICAgICAgICAgICAoKChNX29mZnNldF9pIDw8IDI0KSB8IChNX29mZnNldF9pID4+PiA4KSkgICYgMHhmZjAwZmYwMCkNCiAgICAgICAgICAgICAgICApOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBTaG9ydGN1dHMNCiAgICAgICAgICAgIHZhciBIID0gdGhpcy5faGFzaC53b3JkczsNCg0KICAgICAgICAgICAgdmFyIE1fb2Zmc2V0XzAgID0gTVtvZmZzZXQgKyAwXTsNCiAgICAgICAgICAgIHZhciBNX29mZnNldF8xICA9IE1bb2Zmc2V0ICsgMV07DQogICAgICAgICAgICB2YXIgTV9vZmZzZXRfMiAgPSBNW29mZnNldCArIDJdOw0KICAgICAgICAgICAgdmFyIE1fb2Zmc2V0XzMgID0gTVtvZmZzZXQgKyAzXTsNCiAgICAgICAgICAgIHZhciBNX29mZnNldF80ICA9IE1bb2Zmc2V0ICsgNF07DQogICAgICAgICAgICB2YXIgTV9vZmZzZXRfNSAgPSBNW29mZnNldCArIDVdOw0KICAgICAgICAgICAgdmFyIE1fb2Zmc2V0XzYgID0gTVtvZmZzZXQgKyA2XTsNCiAgICAgICAgICAgIHZhciBNX29mZnNldF83ICA9IE1bb2Zmc2V0ICsgN107DQogICAgICAgICAgICB2YXIgTV9vZmZzZXRfOCAgPSBNW29mZnNldCArIDhdOw0KICAgICAgICAgICAgdmFyIE1fb2Zmc2V0XzkgID0gTVtvZmZzZXQgKyA5XTsNCiAgICAgICAgICAgIHZhciBNX29mZnNldF8xMCA9IE1bb2Zmc2V0ICsgMTBdOw0KICAgICAgICAgICAgdmFyIE1fb2Zmc2V0XzExID0gTVtvZmZzZXQgKyAxMV07DQogICAgICAgICAgICB2YXIgTV9vZmZzZXRfMTIgPSBNW29mZnNldCArIDEyXTsNCiAgICAgICAgICAgIHZhciBNX29mZnNldF8xMyA9IE1bb2Zmc2V0ICsgMTNdOw0KICAgICAgICAgICAgdmFyIE1fb2Zmc2V0XzE0ID0gTVtvZmZzZXQgKyAxNF07DQogICAgICAgICAgICB2YXIgTV9vZmZzZXRfMTUgPSBNW29mZnNldCArIDE1XTsNCg0KICAgICAgICAgICAgLy8gV29ya2luZyB2YXJpYWxiZXMNCiAgICAgICAgICAgIHZhciBhID0gSFswXTsNCiAgICAgICAgICAgIHZhciBiID0gSFsxXTsNCiAgICAgICAgICAgIHZhciBjID0gSFsyXTsNCiAgICAgICAgICAgIHZhciBkID0gSFszXTsNCg0KICAgICAgICAgICAgLy8gQ29tcHV0YXRpb24NCiAgICAgICAgICAgIGEgPSBGRihhLCBiLCBjLCBkLCBNX29mZnNldF8wLCAgNywgIFRbMF0pOw0KICAgICAgICAgICAgZCA9IEZGKGQsIGEsIGIsIGMsIE1fb2Zmc2V0XzEsICAxMiwgVFsxXSk7DQogICAgICAgICAgICBjID0gRkYoYywgZCwgYSwgYiwgTV9vZmZzZXRfMiwgIDE3LCBUWzJdKTsNCiAgICAgICAgICAgIGIgPSBGRihiLCBjLCBkLCBhLCBNX29mZnNldF8zLCAgMjIsIFRbM10pOw0KICAgICAgICAgICAgYSA9IEZGKGEsIGIsIGMsIGQsIE1fb2Zmc2V0XzQsICA3LCAgVFs0XSk7DQogICAgICAgICAgICBkID0gRkYoZCwgYSwgYiwgYywgTV9vZmZzZXRfNSwgIDEyLCBUWzVdKTsNCiAgICAgICAgICAgIGMgPSBGRihjLCBkLCBhLCBiLCBNX29mZnNldF82LCAgMTcsIFRbNl0pOw0KICAgICAgICAgICAgYiA9IEZGKGIsIGMsIGQsIGEsIE1fb2Zmc2V0XzcsICAyMiwgVFs3XSk7DQogICAgICAgICAgICBhID0gRkYoYSwgYiwgYywgZCwgTV9vZmZzZXRfOCwgIDcsICBUWzhdKTsNCiAgICAgICAgICAgIGQgPSBGRihkLCBhLCBiLCBjLCBNX29mZnNldF85LCAgMTIsIFRbOV0pOw0KICAgICAgICAgICAgYyA9IEZGKGMsIGQsIGEsIGIsIE1fb2Zmc2V0XzEwLCAxNywgVFsxMF0pOw0KICAgICAgICAgICAgYiA9IEZGKGIsIGMsIGQsIGEsIE1fb2Zmc2V0XzExLCAyMiwgVFsxMV0pOw0KICAgICAgICAgICAgYSA9IEZGKGEsIGIsIGMsIGQsIE1fb2Zmc2V0XzEyLCA3LCAgVFsxMl0pOw0KICAgICAgICAgICAgZCA9IEZGKGQsIGEsIGIsIGMsIE1fb2Zmc2V0XzEzLCAxMiwgVFsxM10pOw0KICAgICAgICAgICAgYyA9IEZGKGMsIGQsIGEsIGIsIE1fb2Zmc2V0XzE0LCAxNywgVFsxNF0pOw0KICAgICAgICAgICAgYiA9IEZGKGIsIGMsIGQsIGEsIE1fb2Zmc2V0XzE1LCAyMiwgVFsxNV0pOw0KDQogICAgICAgICAgICBhID0gR0coYSwgYiwgYywgZCwgTV9vZmZzZXRfMSwgIDUsICBUWzE2XSk7DQogICAgICAgICAgICBkID0gR0coZCwgYSwgYiwgYywgTV9vZmZzZXRfNiwgIDksICBUWzE3XSk7DQogICAgICAgICAgICBjID0gR0coYywgZCwgYSwgYiwgTV9vZmZzZXRfMTEsIDE0LCBUWzE4XSk7DQogICAgICAgICAgICBiID0gR0coYiwgYywgZCwgYSwgTV9vZmZzZXRfMCwgIDIwLCBUWzE5XSk7DQogICAgICAgICAgICBhID0gR0coYSwgYiwgYywgZCwgTV9vZmZzZXRfNSwgIDUsICBUWzIwXSk7DQogICAgICAgICAgICBkID0gR0coZCwgYSwgYiwgYywgTV9vZmZzZXRfMTAsIDksICBUWzIxXSk7DQogICAgICAgICAgICBjID0gR0coYywgZCwgYSwgYiwgTV9vZmZzZXRfMTUsIDE0LCBUWzIyXSk7DQogICAgICAgICAgICBiID0gR0coYiwgYywgZCwgYSwgTV9vZmZzZXRfNCwgIDIwLCBUWzIzXSk7DQogICAgICAgICAgICBhID0gR0coYSwgYiwgYywgZCwgTV9vZmZzZXRfOSwgIDUsICBUWzI0XSk7DQogICAgICAgICAgICBkID0gR0coZCwgYSwgYiwgYywgTV9vZmZzZXRfMTQsIDksICBUWzI1XSk7DQogICAgICAgICAgICBjID0gR0coYywgZCwgYSwgYiwgTV9vZmZzZXRfMywgIDE0LCBUWzI2XSk7DQogICAgICAgICAgICBiID0gR0coYiwgYywgZCwgYSwgTV9vZmZzZXRfOCwgIDIwLCBUWzI3XSk7DQogICAgICAgICAgICBhID0gR0coYSwgYiwgYywgZCwgTV9vZmZzZXRfMTMsIDUsICBUWzI4XSk7DQogICAgICAgICAgICBkID0gR0coZCwgYSwgYiwgYywgTV9vZmZzZXRfMiwgIDksICBUWzI5XSk7DQogICAgICAgICAgICBjID0gR0coYywgZCwgYSwgYiwgTV9vZmZzZXRfNywgIDE0LCBUWzMwXSk7DQogICAgICAgICAgICBiID0gR0coYiwgYywgZCwgYSwgTV9vZmZzZXRfMTIsIDIwLCBUWzMxXSk7DQoNCiAgICAgICAgICAgIGEgPSBISChhLCBiLCBjLCBkLCBNX29mZnNldF81LCAgNCwgIFRbMzJdKTsNCiAgICAgICAgICAgIGQgPSBISChkLCBhLCBiLCBjLCBNX29mZnNldF84LCAgMTEsIFRbMzNdKTsNCiAgICAgICAgICAgIGMgPSBISChjLCBkLCBhLCBiLCBNX29mZnNldF8xMSwgMTYsIFRbMzRdKTsNCiAgICAgICAgICAgIGIgPSBISChiLCBjLCBkLCBhLCBNX29mZnNldF8xNCwgMjMsIFRbMzVdKTsNCiAgICAgICAgICAgIGEgPSBISChhLCBiLCBjLCBkLCBNX29mZnNldF8xLCAgNCwgIFRbMzZdKTsNCiAgICAgICAgICAgIGQgPSBISChkLCBhLCBiLCBjLCBNX29mZnNldF80LCAgMTEsIFRbMzddKTsNCiAgICAgICAgICAgIGMgPSBISChjLCBkLCBhLCBiLCBNX29mZnNldF83LCAgMTYsIFRbMzhdKTsNCiAgICAgICAgICAgIGIgPSBISChiLCBjLCBkLCBhLCBNX29mZnNldF8xMCwgMjMsIFRbMzldKTsNCiAgICAgICAgICAgIGEgPSBISChhLCBiLCBjLCBkLCBNX29mZnNldF8xMywgNCwgIFRbNDBdKTsNCiAgICAgICAgICAgIGQgPSBISChkLCBhLCBiLCBjLCBNX29mZnNldF8wLCAgMTEsIFRbNDFdKTsNCiAgICAgICAgICAgIGMgPSBISChjLCBkLCBhLCBiLCBNX29mZnNldF8zLCAgMTYsIFRbNDJdKTsNCiAgICAgICAgICAgIGIgPSBISChiLCBjLCBkLCBhLCBNX29mZnNldF82LCAgMjMsIFRbNDNdKTsNCiAgICAgICAgICAgIGEgPSBISChhLCBiLCBjLCBkLCBNX29mZnNldF85LCAgNCwgIFRbNDRdKTsNCiAgICAgICAgICAgIGQgPSBISChkLCBhLCBiLCBjLCBNX29mZnNldF8xMiwgMTEsIFRbNDVdKTsNCiAgICAgICAgICAgIGMgPSBISChjLCBkLCBhLCBiLCBNX29mZnNldF8xNSwgMTYsIFRbNDZdKTsNCiAgICAgICAgICAgIGIgPSBISChiLCBjLCBkLCBhLCBNX29mZnNldF8yLCAgMjMsIFRbNDddKTsNCg0KICAgICAgICAgICAgYSA9IElJKGEsIGIsIGMsIGQsIE1fb2Zmc2V0XzAsICA2LCAgVFs0OF0pOw0KICAgICAgICAgICAgZCA9IElJKGQsIGEsIGIsIGMsIE1fb2Zmc2V0XzcsICAxMCwgVFs0OV0pOw0KICAgICAgICAgICAgYyA9IElJKGMsIGQsIGEsIGIsIE1fb2Zmc2V0XzE0LCAxNSwgVFs1MF0pOw0KICAgICAgICAgICAgYiA9IElJKGIsIGMsIGQsIGEsIE1fb2Zmc2V0XzUsICAyMSwgVFs1MV0pOw0KICAgICAgICAgICAgYSA9IElJKGEsIGIsIGMsIGQsIE1fb2Zmc2V0XzEyLCA2LCAgVFs1Ml0pOw0KICAgICAgICAgICAgZCA9IElJKGQsIGEsIGIsIGMsIE1fb2Zmc2V0XzMsICAxMCwgVFs1M10pOw0KICAgICAgICAgICAgYyA9IElJKGMsIGQsIGEsIGIsIE1fb2Zmc2V0XzEwLCAxNSwgVFs1NF0pOw0KICAgICAgICAgICAgYiA9IElJKGIsIGMsIGQsIGEsIE1fb2Zmc2V0XzEsICAyMSwgVFs1NV0pOw0KICAgICAgICAgICAgYSA9IElJKGEsIGIsIGMsIGQsIE1fb2Zmc2V0XzgsICA2LCAgVFs1Nl0pOw0KICAgICAgICAgICAgZCA9IElJKGQsIGEsIGIsIGMsIE1fb2Zmc2V0XzE1LCAxMCwgVFs1N10pOw0KICAgICAgICAgICAgYyA9IElJKGMsIGQsIGEsIGIsIE1fb2Zmc2V0XzYsICAxNSwgVFs1OF0pOw0KICAgICAgICAgICAgYiA9IElJKGIsIGMsIGQsIGEsIE1fb2Zmc2V0XzEzLCAyMSwgVFs1OV0pOw0KICAgICAgICAgICAgYSA9IElJKGEsIGIsIGMsIGQsIE1fb2Zmc2V0XzQsICA2LCAgVFs2MF0pOw0KICAgICAgICAgICAgZCA9IElJKGQsIGEsIGIsIGMsIE1fb2Zmc2V0XzExLCAxMCwgVFs2MV0pOw0KICAgICAgICAgICAgYyA9IElJKGMsIGQsIGEsIGIsIE1fb2Zmc2V0XzIsICAxNSwgVFs2Ml0pOw0KICAgICAgICAgICAgYiA9IElJKGIsIGMsIGQsIGEsIE1fb2Zmc2V0XzksICAyMSwgVFs2M10pOw0KDQogICAgICAgICAgICAvLyBJbnRlcm1lZGlhdGUgaGFzaCB2YWx1ZQ0KICAgICAgICAgICAgSFswXSA9IChIWzBdICsgYSkgfCAwOw0KICAgICAgICAgICAgSFsxXSA9IChIWzFdICsgYikgfCAwOw0KICAgICAgICAgICAgSFsyXSA9IChIWzJdICsgYykgfCAwOw0KICAgICAgICAgICAgSFszXSA9IChIWzNdICsgZCkgfCAwOw0KICAgICAgICB9LA0KDQogICAgICAgIF9kb0ZpbmFsaXplOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAvLyBTaG9ydGN1dHMNCiAgICAgICAgICAgIHZhciBkYXRhID0gdGhpcy5fZGF0YTsNCiAgICAgICAgICAgIHZhciBkYXRhV29yZHMgPSBkYXRhLndvcmRzOw0KDQogICAgICAgICAgICB2YXIgbkJpdHNUb3RhbCA9IHRoaXMuX25EYXRhQnl0ZXMgKiA4Ow0KICAgICAgICAgICAgdmFyIG5CaXRzTGVmdCA9IGRhdGEuc2lnQnl0ZXMgKiA4Ow0KDQogICAgICAgICAgICAvLyBBZGQgcGFkZGluZw0KICAgICAgICAgICAgZGF0YVdvcmRzW25CaXRzTGVmdCA+Pj4gNV0gfD0gMHg4MCA8PCAoMjQgLSBuQml0c0xlZnQgJSAzMik7DQoNCiAgICAgICAgICAgIHZhciBuQml0c1RvdGFsSCA9IE1hdGguZmxvb3IobkJpdHNUb3RhbCAvIDB4MTAwMDAwMDAwKTsNCiAgICAgICAgICAgIHZhciBuQml0c1RvdGFsTCA9IG5CaXRzVG90YWw7DQogICAgICAgICAgICBkYXRhV29yZHNbKCgobkJpdHNMZWZ0ICsgNjQpID4+PiA5KSA8PCA0KSArIDE1XSA9ICgNCiAgICAgICAgICAgICAgICAoKChuQml0c1RvdGFsSCA8PCA4KSAgfCAobkJpdHNUb3RhbEggPj4+IDI0KSkgJiAweDAwZmYwMGZmKSB8DQogICAgICAgICAgICAgICAgKCgobkJpdHNUb3RhbEggPDwgMjQpIHwgKG5CaXRzVG90YWxIID4+PiA4KSkgICYgMHhmZjAwZmYwMCkNCiAgICAgICAgICAgICk7DQogICAgICAgICAgICBkYXRhV29yZHNbKCgobkJpdHNMZWZ0ICsgNjQpID4+PiA5KSA8PCA0KSArIDE0XSA9ICgNCiAgICAgICAgICAgICAgICAoKChuQml0c1RvdGFsTCA8PCA4KSAgfCAobkJpdHNUb3RhbEwgPj4+IDI0KSkgJiAweDAwZmYwMGZmKSB8DQogICAgICAgICAgICAgICAgKCgobkJpdHNUb3RhbEwgPDwgMjQpIHwgKG5CaXRzVG90YWxMID4+PiA4KSkgICYgMHhmZjAwZmYwMCkNCiAgICAgICAgICAgICk7DQoNCiAgICAgICAgICAgIGRhdGEuc2lnQnl0ZXMgPSAoZGF0YVdvcmRzLmxlbmd0aCArIDEpICogNDsNCg0KICAgICAgICAgICAgLy8gSGFzaCBmaW5hbCBibG9ja3MNCiAgICAgICAgICAgIHRoaXMuX3Byb2Nlc3MoKTsNCg0KICAgICAgICAgICAgLy8gU2hvcnRjdXRzDQogICAgICAgICAgICB2YXIgaGFzaCA9IHRoaXMuX2hhc2g7DQogICAgICAgICAgICB2YXIgSCA9IGhhc2gud29yZHM7DQoNCiAgICAgICAgICAgIC8vIFN3YXAgZW5kaWFuDQogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDQ7IGkrKykgew0KICAgICAgICAgICAgICAgIC8vIFNob3J0Y3V0DQogICAgICAgICAgICAgICAgdmFyIEhfaSA9IEhbaV07DQoNCiAgICAgICAgICAgICAgICBIW2ldID0gKCgoSF9pIDw8IDgpICB8IChIX2kgPj4+IDI0KSkgJiAweDAwZmYwMGZmKSB8DQogICAgICAgICAgICAgICAgICAgICAgICgoKEhfaSA8PCAyNCkgfCAoSF9pID4+PiA4KSkgICYgMHhmZjAwZmYwMCk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIFJldHVybiBmaW5hbCBjb21wdXRlZCBoYXNoDQogICAgICAgICAgICByZXR1cm4gaGFzaDsNCiAgICAgICAgfSwNCg0KICAgICAgICBjbG9uZTogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgdmFyIGNsb25lID0gSGFzaGVyLmNsb25lLmNhbGwodGhpcyk7DQogICAgICAgICAgICBjbG9uZS5faGFzaCA9IHRoaXMuX2hhc2guY2xvbmUoKTsNCg0KICAgICAgICAgICAgcmV0dXJuIGNsb25lOw0KICAgICAgICB9DQogICAgfSk7DQoNCiAgICBmdW5jdGlvbiBGRihhLCBiLCBjLCBkLCB4LCBzLCB0KSB7DQogICAgICAgIHZhciBuID0gYSArICgoYiAmIGMpIHwgKH5iICYgZCkpICsgeCArIHQ7DQogICAgICAgIHJldHVybiAoKG4gPDwgcykgfCAobiA+Pj4gKDMyIC0gcykpKSArIGI7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gR0coYSwgYiwgYywgZCwgeCwgcywgdCkgew0KICAgICAgICB2YXIgbiA9IGEgKyAoKGIgJiBkKSB8IChjICYgfmQpKSArIHggKyB0Ow0KICAgICAgICByZXR1cm4gKChuIDw8IHMpIHwgKG4gPj4+ICgzMiAtIHMpKSkgKyBiOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIEhIKGEsIGIsIGMsIGQsIHgsIHMsIHQpIHsNCiAgICAgICAgdmFyIG4gPSBhICsgKGIgXiBjIF4gZCkgKyB4ICsgdDsNCiAgICAgICAgcmV0dXJuICgobiA8PCBzKSB8IChuID4+PiAoMzIgLSBzKSkpICsgYjsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBJSShhLCBiLCBjLCBkLCB4LCBzLCB0KSB7DQogICAgICAgIHZhciBuID0gYSArIChjIF4gKGIgfCB+ZCkpICsgeCArIHQ7DQogICAgICAgIHJldHVybiAoKG4gPDwgcykgfCAobiA+Pj4gKDMyIC0gcykpKSArIGI7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogU2hvcnRjdXQgZnVuY3Rpb24gdG8gdGhlIGhhc2hlcidzIG9iamVjdCBpbnRlcmZhY2UuDQogICAgICoNCiAgICAgKiBAcGFyYW0ge1dvcmRBcnJheXxzdHJpbmd9IG1lc3NhZ2UgVGhlIG1lc3NhZ2UgdG8gaGFzaC4NCiAgICAgKg0KICAgICAqIEByZXR1cm4ge1dvcmRBcnJheX0gVGhlIGhhc2guDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICoNCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogICAgIHZhciBoYXNoID0gQ3J5cHRvSlMuTUQ1KCdtZXNzYWdlJyk7DQogICAgICogICAgIHZhciBoYXNoID0gQ3J5cHRvSlMuTUQ1KHdvcmRBcnJheSk7DQogICAgICovDQogICAgQy5NRDUgPSBIYXNoZXIuX2NyZWF0ZUhlbHBlcihNRDUpOw0KDQogICAgLyoqDQogICAgICogU2hvcnRjdXQgZnVuY3Rpb24gdG8gdGhlIEhNQUMncyBvYmplY3QgaW50ZXJmYWNlLg0KICAgICAqDQogICAgICogQHBhcmFtIHtXb3JkQXJyYXl8c3RyaW5nfSBtZXNzYWdlIFRoZSBtZXNzYWdlIHRvIGhhc2guDQogICAgICogQHBhcmFtIHtXb3JkQXJyYXl8c3RyaW5nfSBrZXkgVGhlIHNlY3JldCBrZXkuDQogICAgICoNCiAgICAgKiBAcmV0dXJuIHtXb3JkQXJyYXl9IFRoZSBITUFDLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqICAgICB2YXIgaG1hYyA9IENyeXB0b0pTLkhtYWNNRDUobWVzc2FnZSwga2V5KTsNCiAgICAgKi8NCiAgICBDLkhtYWNNRDUgPSBIYXNoZXIuX2NyZWF0ZUhtYWNIZWxwZXIoTUQ1KTsNCn0oTWF0aCkpOw0KCmRlZmluZSgiY3J5cHRvLm1kNSIsIFsiY3J5cHRvLmNvcmUiXSwgZnVuY3Rpb24oKXt9KTsKCihmdW5jdGlvbiAoKSB7DQogICAgLy8gU2hvcnRjdXRzDQogICAgdmFyIEMgPSBDcnlwdG9KUzsNCiAgICB2YXIgQ19saWIgPSBDLmxpYjsNCiAgICB2YXIgQmFzZSA9IENfbGliLkJhc2U7DQogICAgdmFyIFdvcmRBcnJheSA9IENfbGliLldvcmRBcnJheTsNCiAgICB2YXIgQ19hbGdvID0gQy5hbGdvOw0KICAgIHZhciBNRDUgPSBDX2FsZ28uTUQ1Ow0KDQogICAgLyoqDQogICAgICogVGhpcyBrZXkgZGVyaXZhdGlvbiBmdW5jdGlvbiBpcyBtZWFudCB0byBjb25mb3JtIHdpdGggRVZQX0J5dGVzVG9LZXkuDQogICAgICogd3d3Lm9wZW5zc2wub3JnL2RvY3MvY3J5cHRvL0VWUF9CeXRlc1RvS2V5Lmh0bWwNCiAgICAgKi8NCiAgICB2YXIgRXZwS0RGID0gQ19hbGdvLkV2cEtERiA9IEJhc2UuZXh0ZW5kKHsNCiAgICAgICAgLyoqDQogICAgICAgICAqIENvbmZpZ3VyYXRpb24gb3B0aW9ucy4NCiAgICAgICAgICoNCiAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ9IGtleVNpemUgVGhlIGtleSBzaXplIGluIHdvcmRzIHRvIGdlbmVyYXRlLiBEZWZhdWx0OiA0ICgxMjggYml0cykNCiAgICAgICAgICogQHByb3BlcnR5IHtIYXNoZXJ9IGhhc2hlciBUaGUgaGFzaCBhbGdvcml0aG0gdG8gdXNlLiBEZWZhdWx0OiBNRDUNCiAgICAgICAgICogQHByb3BlcnR5IHtudW1iZXJ9IGl0ZXJhdGlvbnMgVGhlIG51bWJlciBvZiBpdGVyYXRpb25zIHRvIHBlcmZvcm0uIERlZmF1bHQ6IDENCiAgICAgICAgICovDQogICAgICAgIGNmZzogQmFzZS5leHRlbmQoew0KICAgICAgICAgICAga2V5U2l6ZTogMTI4LzMyLA0KICAgICAgICAgICAgaGFzaGVyOiBNRDUsDQogICAgICAgICAgICBpdGVyYXRpb25zOiAxDQogICAgICAgIH0pLA0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBJbml0aWFsaXplcyBhIG5ld2x5IGNyZWF0ZWQga2V5IGRlcml2YXRpb24gZnVuY3Rpb24uDQogICAgICAgICAqDQogICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjZmcgKE9wdGlvbmFsKSBUaGUgY29uZmlndXJhdGlvbiBvcHRpb25zIHRvIHVzZSBmb3IgdGhlIGRlcml2YXRpb24uDQogICAgICAgICAqDQogICAgICAgICAqIEBleGFtcGxlDQogICAgICAgICAqDQogICAgICAgICAqICAgICB2YXIga2RmID0gQ3J5cHRvSlMuYWxnby5FdnBLREYuY3JlYXRlKCk7DQogICAgICAgICAqICAgICB2YXIga2RmID0gQ3J5cHRvSlMuYWxnby5FdnBLREYuY3JlYXRlKHsga2V5U2l6ZTogOCB9KTsNCiAgICAgICAgICogICAgIHZhciBrZGYgPSBDcnlwdG9KUy5hbGdvLkV2cEtERi5jcmVhdGUoeyBrZXlTaXplOiA4LCBpdGVyYXRpb25zOiAxMDAwIH0pOw0KICAgICAgICAgKi8NCiAgICAgICAgaW5pdDogZnVuY3Rpb24gKGNmZykgew0KICAgICAgICAgICAgdGhpcy5jZmcgPSB0aGlzLmNmZy5leHRlbmQoY2ZnKTsNCiAgICAgICAgfSwNCg0KICAgICAgICAvKioNCiAgICAgICAgICogRGVyaXZlcyBhIGtleSBmcm9tIGEgcGFzc3dvcmQuDQogICAgICAgICAqDQogICAgICAgICAqIEBwYXJhbSB7V29yZEFycmF5fHN0cmluZ30gcGFzc3dvcmQgVGhlIHBhc3N3b3JkLg0KICAgICAgICAgKiBAcGFyYW0ge1dvcmRBcnJheXxzdHJpbmd9IHNhbHQgQSBzYWx0Lg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcmV0dXJuIHtXb3JkQXJyYXl9IFRoZSBkZXJpdmVkIGtleS4NCiAgICAgICAgICoNCiAgICAgICAgICogQGV4YW1wbGUNCiAgICAgICAgICoNCiAgICAgICAgICogICAgIHZhciBrZXkgPSBrZGYuY29tcHV0ZShwYXNzd29yZCwgc2FsdCk7DQogICAgICAgICAqLw0KICAgICAgICBjb21wdXRlOiBmdW5jdGlvbiAocGFzc3dvcmQsIHNhbHQpIHsNCiAgICAgICAgICAgIC8vIFNob3J0Y3V0DQogICAgICAgICAgICB2YXIgY2ZnID0gdGhpcy5jZmc7DQoNCiAgICAgICAgICAgIC8vIEluaXQgaGFzaGVyDQogICAgICAgICAgICB2YXIgaGFzaGVyID0gY2ZnLmhhc2hlci5jcmVhdGUoKTsNCg0KICAgICAgICAgICAgLy8gSW5pdGlhbCB2YWx1ZXMNCiAgICAgICAgICAgIHZhciBkZXJpdmVkS2V5ID0gV29yZEFycmF5LmNyZWF0ZSgpOw0KDQogICAgICAgICAgICAvLyBTaG9ydGN1dHMNCiAgICAgICAgICAgIHZhciBkZXJpdmVkS2V5V29yZHMgPSBkZXJpdmVkS2V5LndvcmRzOw0KICAgICAgICAgICAgdmFyIGtleVNpemUgPSBjZmcua2V5U2l6ZTsNCiAgICAgICAgICAgIHZhciBpdGVyYXRpb25zID0gY2ZnLml0ZXJhdGlvbnM7DQoNCiAgICAgICAgICAgIC8vIEdlbmVyYXRlIGtleQ0KICAgICAgICAgICAgd2hpbGUgKGRlcml2ZWRLZXlXb3Jkcy5sZW5ndGggPCBrZXlTaXplKSB7DQogICAgICAgICAgICAgICAgaWYgKGJsb2NrKSB7DQogICAgICAgICAgICAgICAgICAgIGhhc2hlci51cGRhdGUoYmxvY2spOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB2YXIgYmxvY2sgPSBoYXNoZXIudXBkYXRlKHBhc3N3b3JkKS5maW5hbGl6ZShzYWx0KTsNCiAgICAgICAgICAgICAgICBoYXNoZXIucmVzZXQoKTsNCg0KICAgICAgICAgICAgICAgIC8vIEl0ZXJhdGlvbnMNCiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IGl0ZXJhdGlvbnM7IGkrKykgew0KICAgICAgICAgICAgICAgICAgICBibG9jayA9IGhhc2hlci5maW5hbGl6ZShibG9jayk7DQogICAgICAgICAgICAgICAgICAgIGhhc2hlci5yZXNldCgpOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGRlcml2ZWRLZXkuY29uY2F0KGJsb2NrKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGRlcml2ZWRLZXkuc2lnQnl0ZXMgPSBrZXlTaXplICogNDsNCg0KICAgICAgICAgICAgcmV0dXJuIGRlcml2ZWRLZXk7DQogICAgICAgIH0NCiAgICB9KTsNCg0KICAgIC8qKg0KICAgICAqIERlcml2ZXMgYSBrZXkgZnJvbSBhIHBhc3N3b3JkLg0KICAgICAqDQogICAgICogQHBhcmFtIHtXb3JkQXJyYXl8c3RyaW5nfSBwYXNzd29yZCBUaGUgcGFzc3dvcmQuDQogICAgICogQHBhcmFtIHtXb3JkQXJyYXl8c3RyaW5nfSBzYWx0IEEgc2FsdC4NCiAgICAgKiBAcGFyYW0ge09iamVjdH0gY2ZnIChPcHRpb25hbCkgVGhlIGNvbmZpZ3VyYXRpb24gb3B0aW9ucyB0byB1c2UgZm9yIHRoaXMgY29tcHV0YXRpb24uDQogICAgICoNCiAgICAgKiBAcmV0dXJuIHtXb3JkQXJyYXl9IFRoZSBkZXJpdmVkIGtleS4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiAgICAgdmFyIGtleSA9IENyeXB0b0pTLkV2cEtERihwYXNzd29yZCwgc2FsdCk7DQogICAgICogICAgIHZhciBrZXkgPSBDcnlwdG9KUy5FdnBLREYocGFzc3dvcmQsIHNhbHQsIHsga2V5U2l6ZTogOCB9KTsNCiAgICAgKiAgICAgdmFyIGtleSA9IENyeXB0b0pTLkV2cEtERihwYXNzd29yZCwgc2FsdCwgeyBrZXlTaXplOiA4LCBpdGVyYXRpb25zOiAxMDAwIH0pOw0KICAgICAqLw0KICAgIEMuRXZwS0RGID0gZnVuY3Rpb24gKHBhc3N3b3JkLCBzYWx0LCBjZmcpIHsNCiAgICAgICAgcmV0dXJuIEV2cEtERi5jcmVhdGUoY2ZnKS5jb21wdXRlKHBhc3N3b3JkLCBzYWx0KTsNCiAgICB9Ow0KfSgpKTsNCgpkZWZpbmUoImNyeXB0by5ldnBrZGYiLCBbImNyeXB0by5tZDUiXSwgZnVuY3Rpb24oKXt9KTsKCi8qCkNyeXB0b0pTIHYzLjEuMgpjb2RlLmdvb2dsZS5jb20vcC9jcnlwdG8tanMKKGMpIDIwMDktMjAxMyBieSBKZWZmIE1vdHQuIEFsbCByaWdodHMgcmVzZXJ2ZWQuCmNvZGUuZ29vZ2xlLmNvbS9wL2NyeXB0by1qcy93aWtpL0xpY2Vuc2UKKi8KLyoqDQogKiBDaXBoZXIgY29yZSBjb21wb25lbnRzLg0KICovDQpDcnlwdG9KUy5saWIuQ2lwaGVyIHx8IChmdW5jdGlvbiAodW5kZWZpbmVkKSB7DQogICAgLy8gU2hvcnRjdXRzDQogICAgdmFyIEMgPSBDcnlwdG9KUzsNCiAgICB2YXIgQ19saWIgPSBDLmxpYjsNCiAgICB2YXIgQmFzZSA9IENfbGliLkJhc2U7DQogICAgdmFyIFdvcmRBcnJheSA9IENfbGliLldvcmRBcnJheTsNCiAgICB2YXIgQnVmZmVyZWRCbG9ja0FsZ29yaXRobSA9IENfbGliLkJ1ZmZlcmVkQmxvY2tBbGdvcml0aG07DQogICAgdmFyIENfZW5jID0gQy5lbmM7DQogICAgdmFyIFV0ZjggPSBDX2VuYy5VdGY4Ow0KICAgIHZhciBCYXNlNjQgPSBDX2VuYy5CYXNlNjQ7DQogICAgdmFyIENfYWxnbyA9IEMuYWxnbzsNCiAgICB2YXIgRXZwS0RGID0gQ19hbGdvLkV2cEtERjsNCg0KICAgIC8qKg0KICAgICAqIEFic3RyYWN0IGJhc2UgY2lwaGVyIHRlbXBsYXRlLg0KICAgICAqDQogICAgICogQHByb3BlcnR5IHtudW1iZXJ9IGtleVNpemUgVGhpcyBjaXBoZXIncyBrZXkgc2l6ZS4gRGVmYXVsdDogNCAoMTI4IGJpdHMpDQogICAgICogQHByb3BlcnR5IHtudW1iZXJ9IGl2U2l6ZSBUaGlzIGNpcGhlcidzIElWIHNpemUuIERlZmF1bHQ6IDQgKDEyOCBiaXRzKQ0KICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBfRU5DX1hGT1JNX01PREUgQSBjb25zdGFudCByZXByZXNlbnRpbmcgZW5jcnlwdGlvbiBtb2RlLg0KICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBfREVDX1hGT1JNX01PREUgQSBjb25zdGFudCByZXByZXNlbnRpbmcgZGVjcnlwdGlvbiBtb2RlLg0KICAgICAqLw0KICAgIHZhciBDaXBoZXIgPSBDX2xpYi5DaXBoZXIgPSBCdWZmZXJlZEJsb2NrQWxnb3JpdGhtLmV4dGVuZCh7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBDb25maWd1cmF0aW9uIG9wdGlvbnMuDQogICAgICAgICAqDQogICAgICAgICAqIEBwcm9wZXJ0eSB7V29yZEFycmF5fSBpdiBUaGUgSVYgdG8gdXNlIGZvciB0aGlzIG9wZXJhdGlvbi4NCiAgICAgICAgICovDQogICAgICAgIGNmZzogQmFzZS5leHRlbmQoKSwNCg0KICAgICAgICAvKioNCiAgICAgICAgICogQ3JlYXRlcyB0aGlzIGNpcGhlciBpbiBlbmNyeXB0aW9uIG1vZGUuDQogICAgICAgICAqDQogICAgICAgICAqIEBwYXJhbSB7V29yZEFycmF5fSBrZXkgVGhlIGtleS4NCiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGNmZyAoT3B0aW9uYWwpIFRoZSBjb25maWd1cmF0aW9uIG9wdGlvbnMgdG8gdXNlIGZvciB0aGlzIG9wZXJhdGlvbi4NCiAgICAgICAgICoNCiAgICAgICAgICogQHJldHVybiB7Q2lwaGVyfSBBIGNpcGhlciBpbnN0YW5jZS4NCiAgICAgICAgICoNCiAgICAgICAgICogQHN0YXRpYw0KICAgICAgICAgKg0KICAgICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICAgKg0KICAgICAgICAgKiAgICAgdmFyIGNpcGhlciA9IENyeXB0b0pTLmFsZ28uQUVTLmNyZWF0ZUVuY3J5cHRvcihrZXlXb3JkQXJyYXksIHsgaXY6IGl2V29yZEFycmF5IH0pOw0KICAgICAgICAgKi8NCiAgICAgICAgY3JlYXRlRW5jcnlwdG9yOiBmdW5jdGlvbiAoa2V5LCBjZmcpIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZSh0aGlzLl9FTkNfWEZPUk1fTU9ERSwga2V5LCBjZmcpOw0KICAgICAgICB9LA0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBDcmVhdGVzIHRoaXMgY2lwaGVyIGluIGRlY3J5cHRpb24gbW9kZS4NCiAgICAgICAgICoNCiAgICAgICAgICogQHBhcmFtIHtXb3JkQXJyYXl9IGtleSBUaGUga2V5Lg0KICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gY2ZnIChPcHRpb25hbCkgVGhlIGNvbmZpZ3VyYXRpb24gb3B0aW9ucyB0byB1c2UgZm9yIHRoaXMgb3BlcmF0aW9uLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcmV0dXJuIHtDaXBoZXJ9IEEgY2lwaGVyIGluc3RhbmNlLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAc3RhdGljDQogICAgICAgICAqDQogICAgICAgICAqIEBleGFtcGxlDQogICAgICAgICAqDQogICAgICAgICAqICAgICB2YXIgY2lwaGVyID0gQ3J5cHRvSlMuYWxnby5BRVMuY3JlYXRlRGVjcnlwdG9yKGtleVdvcmRBcnJheSwgeyBpdjogaXZXb3JkQXJyYXkgfSk7DQogICAgICAgICAqLw0KICAgICAgICBjcmVhdGVEZWNyeXB0b3I6IGZ1bmN0aW9uIChrZXksIGNmZykgew0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlKHRoaXMuX0RFQ19YRk9STV9NT0RFLCBrZXksIGNmZyk7DQogICAgICAgIH0sDQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIEluaXRpYWxpemVzIGEgbmV3bHkgY3JlYXRlZCBjaXBoZXIuDQogICAgICAgICAqDQogICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSB4Zm9ybU1vZGUgRWl0aGVyIHRoZSBlbmNyeXB0aW9uIG9yIGRlY3J5cHRpb24gdHJhbnNvcm1hdGlvbiBtb2RlIGNvbnN0YW50Lg0KICAgICAgICAgKiBAcGFyYW0ge1dvcmRBcnJheX0ga2V5IFRoZSBrZXkuDQogICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjZmcgKE9wdGlvbmFsKSBUaGUgY29uZmlndXJhdGlvbiBvcHRpb25zIHRvIHVzZSBmb3IgdGhpcyBvcGVyYXRpb24uDQogICAgICAgICAqDQogICAgICAgICAqIEBleGFtcGxlDQogICAgICAgICAqDQogICAgICAgICAqICAgICB2YXIgY2lwaGVyID0gQ3J5cHRvSlMuYWxnby5BRVMuY3JlYXRlKENyeXB0b0pTLmFsZ28uQUVTLl9FTkNfWEZPUk1fTU9ERSwga2V5V29yZEFycmF5LCB7IGl2OiBpdldvcmRBcnJheSB9KTsNCiAgICAgICAgICovDQogICAgICAgIGluaXQ6IGZ1bmN0aW9uICh4Zm9ybU1vZGUsIGtleSwgY2ZnKSB7DQogICAgICAgICAgICAvLyBBcHBseSBjb25maWcgZGVmYXVsdHMNCiAgICAgICAgICAgIHRoaXMuY2ZnID0gdGhpcy5jZmcuZXh0ZW5kKGNmZyk7DQoNCiAgICAgICAgICAgIC8vIFN0b3JlIHRyYW5zZm9ybSBtb2RlIGFuZCBrZXkNCiAgICAgICAgICAgIHRoaXMuX3hmb3JtTW9kZSA9IHhmb3JtTW9kZTsNCiAgICAgICAgICAgIHRoaXMuX2tleSA9IGtleTsNCg0KICAgICAgICAgICAgLy8gU2V0IGluaXRpYWwgdmFsdWVzDQogICAgICAgICAgICB0aGlzLnJlc2V0KCk7DQogICAgICAgIH0sDQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIFJlc2V0cyB0aGlzIGNpcGhlciB0byBpdHMgaW5pdGlhbCBzdGF0ZS4NCiAgICAgICAgICoNCiAgICAgICAgICogQGV4YW1wbGUNCiAgICAgICAgICoNCiAgICAgICAgICogICAgIGNpcGhlci5yZXNldCgpOw0KICAgICAgICAgKi8NCiAgICAgICAgcmVzZXQ6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIC8vIFJlc2V0IGRhdGEgYnVmZmVyDQogICAgICAgICAgICBCdWZmZXJlZEJsb2NrQWxnb3JpdGhtLnJlc2V0LmNhbGwodGhpcyk7DQoNCiAgICAgICAgICAgIC8vIFBlcmZvcm0gY29uY3JldGUtY2lwaGVyIGxvZ2ljDQogICAgICAgICAgICB0aGlzLl9kb1Jlc2V0KCk7DQogICAgICAgIH0sDQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIEFkZHMgZGF0YSB0byBiZSBlbmNyeXB0ZWQgb3IgZGVjcnlwdGVkLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcGFyYW0ge1dvcmRBcnJheXxzdHJpbmd9IGRhdGFVcGRhdGUgVGhlIGRhdGEgdG8gZW5jcnlwdCBvciBkZWNyeXB0Lg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcmV0dXJuIHtXb3JkQXJyYXl9IFRoZSBkYXRhIGFmdGVyIHByb2Nlc3NpbmcuDQogICAgICAgICAqDQogICAgICAgICAqIEBleGFtcGxlDQogICAgICAgICAqDQogICAgICAgICAqICAgICB2YXIgZW5jcnlwdGVkID0gY2lwaGVyLnByb2Nlc3MoJ2RhdGEnKTsNCiAgICAgICAgICogICAgIHZhciBlbmNyeXB0ZWQgPSBjaXBoZXIucHJvY2Vzcyh3b3JkQXJyYXkpOw0KICAgICAgICAgKi8NCiAgICAgICAgcHJvY2VzczogZnVuY3Rpb24gKGRhdGFVcGRhdGUpIHsNCiAgICAgICAgICAgIC8vIEFwcGVuZA0KICAgICAgICAgICAgdGhpcy5fYXBwZW5kKGRhdGFVcGRhdGUpOw0KDQogICAgICAgICAgICAvLyBQcm9jZXNzIGF2YWlsYWJsZSBibG9ja3MNCiAgICAgICAgICAgIHJldHVybiB0aGlzLl9wcm9jZXNzKCk7DQogICAgICAgIH0sDQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIEZpbmFsaXplcyB0aGUgZW5jcnlwdGlvbiBvciBkZWNyeXB0aW9uIHByb2Nlc3MuDQogICAgICAgICAqIE5vdGUgdGhhdCB0aGUgZmluYWxpemUgb3BlcmF0aW9uIGlzIGVmZmVjdGl2ZWx5IGEgZGVzdHJ1Y3RpdmUsIHJlYWQtb25jZSBvcGVyYXRpb24uDQogICAgICAgICAqDQogICAgICAgICAqIEBwYXJhbSB7V29yZEFycmF5fHN0cmluZ30gZGF0YVVwZGF0ZSBUaGUgZmluYWwgZGF0YSB0byBlbmNyeXB0IG9yIGRlY3J5cHQuDQogICAgICAgICAqDQogICAgICAgICAqIEByZXR1cm4ge1dvcmRBcnJheX0gVGhlIGRhdGEgYWZ0ZXIgZmluYWwgcHJvY2Vzc2luZy4NCiAgICAgICAgICoNCiAgICAgICAgICogQGV4YW1wbGUNCiAgICAgICAgICoNCiAgICAgICAgICogICAgIHZhciBlbmNyeXB0ZWQgPSBjaXBoZXIuZmluYWxpemUoKTsNCiAgICAgICAgICogICAgIHZhciBlbmNyeXB0ZWQgPSBjaXBoZXIuZmluYWxpemUoJ2RhdGEnKTsNCiAgICAgICAgICogICAgIHZhciBlbmNyeXB0ZWQgPSBjaXBoZXIuZmluYWxpemUod29yZEFycmF5KTsNCiAgICAgICAgICovDQogICAgICAgIGZpbmFsaXplOiBmdW5jdGlvbiAoZGF0YVVwZGF0ZSkgew0KICAgICAgICAgICAgLy8gRmluYWwgZGF0YSB1cGRhdGUNCiAgICAgICAgICAgIGlmIChkYXRhVXBkYXRlKSB7DQogICAgICAgICAgICAgICAgdGhpcy5fYXBwZW5kKGRhdGFVcGRhdGUpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBQZXJmb3JtIGNvbmNyZXRlLWNpcGhlciBsb2dpYw0KICAgICAgICAgICAgdmFyIGZpbmFsUHJvY2Vzc2VkRGF0YSA9IHRoaXMuX2RvRmluYWxpemUoKTsNCg0KICAgICAgICAgICAgcmV0dXJuIGZpbmFsUHJvY2Vzc2VkRGF0YTsNCiAgICAgICAgfSwNCg0KICAgICAgICBrZXlTaXplOiAxMjgvMzIsDQoNCiAgICAgICAgaXZTaXplOiAxMjgvMzIsDQoNCiAgICAgICAgX0VOQ19YRk9STV9NT0RFOiAxLA0KDQogICAgICAgIF9ERUNfWEZPUk1fTU9ERTogMiwNCg0KICAgICAgICAvKioNCiAgICAgICAgICogQ3JlYXRlcyBzaG9ydGN1dCBmdW5jdGlvbnMgdG8gYSBjaXBoZXIncyBvYmplY3QgaW50ZXJmYWNlLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcGFyYW0ge0NpcGhlcn0gY2lwaGVyIFRoZSBjaXBoZXIgdG8gY3JlYXRlIGEgaGVscGVyIGZvci4NCiAgICAgICAgICoNCiAgICAgICAgICogQHJldHVybiB7T2JqZWN0fSBBbiBvYmplY3Qgd2l0aCBlbmNyeXB0IGFuZCBkZWNyeXB0IHNob3J0Y3V0IGZ1bmN0aW9ucy4NCiAgICAgICAgICoNCiAgICAgICAgICogQHN0YXRpYw0KICAgICAgICAgKg0KICAgICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICAgKg0KICAgICAgICAgKiAgICAgdmFyIEFFUyA9IENyeXB0b0pTLmxpYi5DaXBoZXIuX2NyZWF0ZUhlbHBlcihDcnlwdG9KUy5hbGdvLkFFUyk7DQogICAgICAgICAqLw0KICAgICAgICBfY3JlYXRlSGVscGVyOiAoZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgZnVuY3Rpb24gc2VsZWN0Q2lwaGVyU3RyYXRlZ3koa2V5KSB7DQogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBrZXkgPT0gJ3N0cmluZycpIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFBhc3N3b3JkQmFzZWRDaXBoZXI7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFNlcmlhbGl6YWJsZUNpcGhlcjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoY2lwaGVyKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgICAgICAgICAgZW5jcnlwdDogZnVuY3Rpb24gKG1lc3NhZ2UsIGtleSwgY2ZnKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZWN0Q2lwaGVyU3RyYXRlZ3koa2V5KS5lbmNyeXB0KGNpcGhlciwgbWVzc2FnZSwga2V5LCBjZmcpOw0KICAgICAgICAgICAgICAgICAgICB9LA0KDQogICAgICAgICAgICAgICAgICAgIGRlY3J5cHQ6IGZ1bmN0aW9uIChjaXBoZXJ0ZXh0LCBrZXksIGNmZykgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGVjdENpcGhlclN0cmF0ZWd5KGtleSkuZGVjcnlwdChjaXBoZXIsIGNpcGhlcnRleHQsIGtleSwgY2ZnKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICB9Ow0KICAgICAgICB9KCkpDQogICAgfSk7DQoNCiAgICAvKioNCiAgICAgKiBBYnN0cmFjdCBiYXNlIHN0cmVhbSBjaXBoZXIgdGVtcGxhdGUuDQogICAgICoNCiAgICAgKiBAcHJvcGVydHkge251bWJlcn0gYmxvY2tTaXplIFRoZSBudW1iZXIgb2YgMzItYml0IHdvcmRzIHRoaXMgY2lwaGVyIG9wZXJhdGVzIG9uLiBEZWZhdWx0OiAxICgzMiBiaXRzKQ0KICAgICAqLw0KICAgIHZhciBTdHJlYW1DaXBoZXIgPSBDX2xpYi5TdHJlYW1DaXBoZXIgPSBDaXBoZXIuZXh0ZW5kKHsNCiAgICAgICAgX2RvRmluYWxpemU6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIC8vIFByb2Nlc3MgcGFydGlhbCBibG9ja3MNCiAgICAgICAgICAgIHZhciBmaW5hbFByb2Nlc3NlZEJsb2NrcyA9IHRoaXMuX3Byb2Nlc3MoISEnZmx1c2gnKTsNCg0KICAgICAgICAgICAgcmV0dXJuIGZpbmFsUHJvY2Vzc2VkQmxvY2tzOw0KICAgICAgICB9LA0KDQogICAgICAgIGJsb2NrU2l6ZTogMQ0KICAgIH0pOw0KDQogICAgLyoqDQogICAgICogTW9kZSBuYW1lc3BhY2UuDQogICAgICovDQogICAgdmFyIENfbW9kZSA9IEMubW9kZSA9IHt9Ow0KDQogICAgLyoqDQogICAgICogQWJzdHJhY3QgYmFzZSBibG9jayBjaXBoZXIgbW9kZSB0ZW1wbGF0ZS4NCiAgICAgKi8NCiAgICB2YXIgQmxvY2tDaXBoZXJNb2RlID0gQ19saWIuQmxvY2tDaXBoZXJNb2RlID0gQmFzZS5leHRlbmQoew0KICAgICAgICAvKioNCiAgICAgICAgICogQ3JlYXRlcyB0aGlzIG1vZGUgZm9yIGVuY3J5cHRpb24uDQogICAgICAgICAqDQogICAgICAgICAqIEBwYXJhbSB7Q2lwaGVyfSBjaXBoZXIgQSBibG9jayBjaXBoZXIgaW5zdGFuY2UuDQogICAgICAgICAqIEBwYXJhbSB7QXJyYXl9IGl2IFRoZSBJViB3b3Jkcy4NCiAgICAgICAgICoNCiAgICAgICAgICogQHN0YXRpYw0KICAgICAgICAgKg0KICAgICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICAgKg0KICAgICAgICAgKiAgICAgdmFyIG1vZGUgPSBDcnlwdG9KUy5tb2RlLkNCQy5jcmVhdGVFbmNyeXB0b3IoY2lwaGVyLCBpdi53b3Jkcyk7DQogICAgICAgICAqLw0KICAgICAgICBjcmVhdGVFbmNyeXB0b3I6IGZ1bmN0aW9uIChjaXBoZXIsIGl2KSB7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5FbmNyeXB0b3IuY3JlYXRlKGNpcGhlciwgaXYpOw0KICAgICAgICB9LA0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBDcmVhdGVzIHRoaXMgbW9kZSBmb3IgZGVjcnlwdGlvbi4NCiAgICAgICAgICoNCiAgICAgICAgICogQHBhcmFtIHtDaXBoZXJ9IGNpcGhlciBBIGJsb2NrIGNpcGhlciBpbnN0YW5jZS4NCiAgICAgICAgICogQHBhcmFtIHtBcnJheX0gaXYgVGhlIElWIHdvcmRzLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAc3RhdGljDQogICAgICAgICAqDQogICAgICAgICAqIEBleGFtcGxlDQogICAgICAgICAqDQogICAgICAgICAqICAgICB2YXIgbW9kZSA9IENyeXB0b0pTLm1vZGUuQ0JDLmNyZWF0ZURlY3J5cHRvcihjaXBoZXIsIGl2LndvcmRzKTsNCiAgICAgICAgICovDQogICAgICAgIGNyZWF0ZURlY3J5cHRvcjogZnVuY3Rpb24gKGNpcGhlciwgaXYpIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLkRlY3J5cHRvci5jcmVhdGUoY2lwaGVyLCBpdik7DQogICAgICAgIH0sDQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIEluaXRpYWxpemVzIGEgbmV3bHkgY3JlYXRlZCBtb2RlLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcGFyYW0ge0NpcGhlcn0gY2lwaGVyIEEgYmxvY2sgY2lwaGVyIGluc3RhbmNlLg0KICAgICAgICAgKiBAcGFyYW0ge0FycmF5fSBpdiBUaGUgSVYgd29yZHMuDQogICAgICAgICAqDQogICAgICAgICAqIEBleGFtcGxlDQogICAgICAgICAqDQogICAgICAgICAqICAgICB2YXIgbW9kZSA9IENyeXB0b0pTLm1vZGUuQ0JDLkVuY3J5cHRvci5jcmVhdGUoY2lwaGVyLCBpdi53b3Jkcyk7DQogICAgICAgICAqLw0KICAgICAgICBpbml0OiBmdW5jdGlvbiAoY2lwaGVyLCBpdikgew0KICAgICAgICAgICAgdGhpcy5fY2lwaGVyID0gY2lwaGVyOw0KICAgICAgICAgICAgdGhpcy5faXYgPSBpdjsNCiAgICAgICAgfQ0KICAgIH0pOw0KDQogICAgLyoqDQogICAgICogQ2lwaGVyIEJsb2NrIENoYWluaW5nIG1vZGUuDQogICAgICovDQogICAgdmFyIENCQyA9IENfbW9kZS5DQkMgPSAoZnVuY3Rpb24gKCkgew0KICAgICAgICAvKioNCiAgICAgICAgICogQWJzdHJhY3QgYmFzZSBDQkMgbW9kZS4NCiAgICAgICAgICovDQogICAgICAgIHZhciBDQkMgPSBCbG9ja0NpcGhlck1vZGUuZXh0ZW5kKCk7DQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIENCQyBlbmNyeXB0b3IuDQogICAgICAgICAqLw0KICAgICAgICBDQkMuRW5jcnlwdG9yID0gQ0JDLmV4dGVuZCh7DQogICAgICAgICAgICAvKioNCiAgICAgICAgICAgICAqIFByb2Nlc3NlcyB0aGUgZGF0YSBibG9jayBhdCBvZmZzZXQuDQogICAgICAgICAgICAgKg0KICAgICAgICAgICAgICogQHBhcmFtIHtBcnJheX0gd29yZHMgVGhlIGRhdGEgd29yZHMgdG8gb3BlcmF0ZSBvbi4NCiAgICAgICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSBvZmZzZXQgVGhlIG9mZnNldCB3aGVyZSB0aGUgYmxvY2sgc3RhcnRzLg0KICAgICAgICAgICAgICoNCiAgICAgICAgICAgICAqIEBleGFtcGxlDQogICAgICAgICAgICAgKg0KICAgICAgICAgICAgICogICAgIG1vZGUucHJvY2Vzc0Jsb2NrKGRhdGEud29yZHMsIG9mZnNldCk7DQogICAgICAgICAgICAgKi8NCiAgICAgICAgICAgIHByb2Nlc3NCbG9jazogZnVuY3Rpb24gKHdvcmRzLCBvZmZzZXQpIHsNCiAgICAgICAgICAgICAgICAvLyBTaG9ydGN1dHMNCiAgICAgICAgICAgICAgICB2YXIgY2lwaGVyID0gdGhpcy5fY2lwaGVyOw0KICAgICAgICAgICAgICAgIHZhciBibG9ja1NpemUgPSBjaXBoZXIuYmxvY2tTaXplOw0KDQogICAgICAgICAgICAgICAgLy8gWE9SIGFuZCBlbmNyeXB0DQogICAgICAgICAgICAgICAgeG9yQmxvY2suY2FsbCh0aGlzLCB3b3Jkcywgb2Zmc2V0LCBibG9ja1NpemUpOw0KICAgICAgICAgICAgICAgIGNpcGhlci5lbmNyeXB0QmxvY2sod29yZHMsIG9mZnNldCk7DQoNCiAgICAgICAgICAgICAgICAvLyBSZW1lbWJlciB0aGlzIGJsb2NrIHRvIHVzZSB3aXRoIG5leHQgYmxvY2sNCiAgICAgICAgICAgICAgICB0aGlzLl9wcmV2QmxvY2sgPSB3b3Jkcy5zbGljZShvZmZzZXQsIG9mZnNldCArIGJsb2NrU2l6ZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBDQkMgZGVjcnlwdG9yLg0KICAgICAgICAgKi8NCiAgICAgICAgQ0JDLkRlY3J5cHRvciA9IENCQy5leHRlbmQoew0KICAgICAgICAgICAgLyoqDQogICAgICAgICAgICAgKiBQcm9jZXNzZXMgdGhlIGRhdGEgYmxvY2sgYXQgb2Zmc2V0Lg0KICAgICAgICAgICAgICoNCiAgICAgICAgICAgICAqIEBwYXJhbSB7QXJyYXl9IHdvcmRzIFRoZSBkYXRhIHdvcmRzIHRvIG9wZXJhdGUgb24uDQogICAgICAgICAgICAgKiBAcGFyYW0ge251bWJlcn0gb2Zmc2V0IFRoZSBvZmZzZXQgd2hlcmUgdGhlIGJsb2NrIHN0YXJ0cy4NCiAgICAgICAgICAgICAqDQogICAgICAgICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICAgICAgICoNCiAgICAgICAgICAgICAqICAgICBtb2RlLnByb2Nlc3NCbG9jayhkYXRhLndvcmRzLCBvZmZzZXQpOw0KICAgICAgICAgICAgICovDQogICAgICAgICAgICBwcm9jZXNzQmxvY2s6IGZ1bmN0aW9uICh3b3Jkcywgb2Zmc2V0KSB7DQogICAgICAgICAgICAgICAgLy8gU2hvcnRjdXRzDQogICAgICAgICAgICAgICAgdmFyIGNpcGhlciA9IHRoaXMuX2NpcGhlcjsNCiAgICAgICAgICAgICAgICB2YXIgYmxvY2tTaXplID0gY2lwaGVyLmJsb2NrU2l6ZTsNCg0KICAgICAgICAgICAgICAgIC8vIFJlbWVtYmVyIHRoaXMgYmxvY2sgdG8gdXNlIHdpdGggbmV4dCBibG9jaw0KICAgICAgICAgICAgICAgIHZhciB0aGlzQmxvY2sgPSB3b3Jkcy5zbGljZShvZmZzZXQsIG9mZnNldCArIGJsb2NrU2l6ZSk7DQoNCiAgICAgICAgICAgICAgICAvLyBEZWNyeXB0IGFuZCBYT1INCiAgICAgICAgICAgICAgICBjaXBoZXIuZGVjcnlwdEJsb2NrKHdvcmRzLCBvZmZzZXQpOw0KICAgICAgICAgICAgICAgIHhvckJsb2NrLmNhbGwodGhpcywgd29yZHMsIG9mZnNldCwgYmxvY2tTaXplKTsNCg0KICAgICAgICAgICAgICAgIC8vIFRoaXMgYmxvY2sgYmVjb21lcyB0aGUgcHJldmlvdXMgYmxvY2sNCiAgICAgICAgICAgICAgICB0aGlzLl9wcmV2QmxvY2sgPSB0aGlzQmxvY2s7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KDQogICAgICAgIGZ1bmN0aW9uIHhvckJsb2NrKHdvcmRzLCBvZmZzZXQsIGJsb2NrU2l6ZSkgew0KICAgICAgICAgICAgLy8gU2hvcnRjdXQNCiAgICAgICAgICAgIHZhciBpdiA9IHRoaXMuX2l2Ow0KDQogICAgICAgICAgICAvLyBDaG9vc2UgbWl4aW5nIGJsb2NrDQogICAgICAgICAgICBpZiAoaXYpIHsNCiAgICAgICAgICAgICAgICB2YXIgYmxvY2sgPSBpdjsNCg0KICAgICAgICAgICAgICAgIC8vIFJlbW92ZSBJViBmb3Igc3Vic2VxdWVudCBibG9ja3MNCiAgICAgICAgICAgICAgICB0aGlzLl9pdiA9IHVuZGVmaW5lZDsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgdmFyIGJsb2NrID0gdGhpcy5fcHJldkJsb2NrOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBYT1IgYmxvY2tzDQogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGJsb2NrU2l6ZTsgaSsrKSB7DQogICAgICAgICAgICAgICAgd29yZHNbb2Zmc2V0ICsgaV0gXj0gYmxvY2tbaV07DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gQ0JDOw0KICAgIH0oKSk7DQoNCiAgICAvKioNCiAgICAgKiBQYWRkaW5nIG5hbWVzcGFjZS4NCiAgICAgKi8NCiAgICB2YXIgQ19wYWQgPSBDLnBhZCA9IHt9Ow0KDQogICAgLyoqDQogICAgICogUEtDUyAjNS83IHBhZGRpbmcgc3RyYXRlZ3kuDQogICAgICovDQogICAgdmFyIFBrY3M3ID0gQ19wYWQuUGtjczcgPSB7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBQYWRzIGRhdGEgdXNpbmcgdGhlIGFsZ29yaXRobSBkZWZpbmVkIGluIFBLQ1MgIzUvNy4NCiAgICAgICAgICoNCiAgICAgICAgICogQHBhcmFtIHtXb3JkQXJyYXl9IGRhdGEgVGhlIGRhdGEgdG8gcGFkLg0KICAgICAgICAgKiBAcGFyYW0ge251bWJlcn0gYmxvY2tTaXplIFRoZSBtdWx0aXBsZSB0aGF0IHRoZSBkYXRhIHNob3VsZCBiZSBwYWRkZWQgdG8uDQogICAgICAgICAqDQogICAgICAgICAqIEBzdGF0aWMNCiAgICAgICAgICoNCiAgICAgICAgICogQGV4YW1wbGUNCiAgICAgICAgICoNCiAgICAgICAgICogICAgIENyeXB0b0pTLnBhZC5Qa2NzNy5wYWQod29yZEFycmF5LCA0KTsNCiAgICAgICAgICovDQogICAgICAgIHBhZDogZnVuY3Rpb24gKGRhdGEsIGJsb2NrU2l6ZSkgew0KICAgICAgICAgICAgLy8gU2hvcnRjdXQNCiAgICAgICAgICAgIHZhciBibG9ja1NpemVCeXRlcyA9IGJsb2NrU2l6ZSAqIDQ7DQoNCiAgICAgICAgICAgIC8vIENvdW50IHBhZGRpbmcgYnl0ZXMNCiAgICAgICAgICAgIHZhciBuUGFkZGluZ0J5dGVzID0gYmxvY2tTaXplQnl0ZXMgLSBkYXRhLnNpZ0J5dGVzICUgYmxvY2tTaXplQnl0ZXM7DQoNCiAgICAgICAgICAgIC8vIENyZWF0ZSBwYWRkaW5nIHdvcmQNCiAgICAgICAgICAgIHZhciBwYWRkaW5nV29yZCA9IChuUGFkZGluZ0J5dGVzIDw8IDI0KSB8IChuUGFkZGluZ0J5dGVzIDw8IDE2KSB8IChuUGFkZGluZ0J5dGVzIDw8IDgpIHwgblBhZGRpbmdCeXRlczsNCg0KICAgICAgICAgICAgLy8gQ3JlYXRlIHBhZGRpbmcNCiAgICAgICAgICAgIHZhciBwYWRkaW5nV29yZHMgPSBbXTsNCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgblBhZGRpbmdCeXRlczsgaSArPSA0KSB7DQogICAgICAgICAgICAgICAgcGFkZGluZ1dvcmRzLnB1c2gocGFkZGluZ1dvcmQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdmFyIHBhZGRpbmcgPSBXb3JkQXJyYXkuY3JlYXRlKHBhZGRpbmdXb3JkcywgblBhZGRpbmdCeXRlcyk7DQoNCiAgICAgICAgICAgIC8vIEFkZCBwYWRkaW5nDQogICAgICAgICAgICBkYXRhLmNvbmNhdChwYWRkaW5nKTsNCiAgICAgICAgfSwNCg0KICAgICAgICAvKioNCiAgICAgICAgICogVW5wYWRzIGRhdGEgdGhhdCBoYWQgYmVlbiBwYWRkZWQgdXNpbmcgdGhlIGFsZ29yaXRobSBkZWZpbmVkIGluIFBLQ1MgIzUvNy4NCiAgICAgICAgICoNCiAgICAgICAgICogQHBhcmFtIHtXb3JkQXJyYXl9IGRhdGEgVGhlIGRhdGEgdG8gdW5wYWQuDQogICAgICAgICAqDQogICAgICAgICAqIEBzdGF0aWMNCiAgICAgICAgICoNCiAgICAgICAgICogQGV4YW1wbGUNCiAgICAgICAgICoNCiAgICAgICAgICogICAgIENyeXB0b0pTLnBhZC5Qa2NzNy51bnBhZCh3b3JkQXJyYXkpOw0KICAgICAgICAgKi8NCiAgICAgICAgdW5wYWQ6IGZ1bmN0aW9uIChkYXRhKSB7DQogICAgICAgICAgICAvLyBHZXQgbnVtYmVyIG9mIHBhZGRpbmcgYnl0ZXMgZnJvbSBsYXN0IGJ5dGUNCiAgICAgICAgICAgIHZhciBuUGFkZGluZ0J5dGVzID0gZGF0YS53b3Jkc1soZGF0YS5zaWdCeXRlcyAtIDEpID4+PiAyXSAmIDB4ZmY7DQoNCiAgICAgICAgICAgIC8vIFJlbW92ZSBwYWRkaW5nDQogICAgICAgICAgICBkYXRhLnNpZ0J5dGVzIC09IG5QYWRkaW5nQnl0ZXM7DQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogQWJzdHJhY3QgYmFzZSBibG9jayBjaXBoZXIgdGVtcGxhdGUuDQogICAgICoNCiAgICAgKiBAcHJvcGVydHkge251bWJlcn0gYmxvY2tTaXplIFRoZSBudW1iZXIgb2YgMzItYml0IHdvcmRzIHRoaXMgY2lwaGVyIG9wZXJhdGVzIG9uLiBEZWZhdWx0OiA0ICgxMjggYml0cykNCiAgICAgKi8NCiAgICB2YXIgQmxvY2tDaXBoZXIgPSBDX2xpYi5CbG9ja0NpcGhlciA9IENpcGhlci5leHRlbmQoew0KICAgICAgICAvKioNCiAgICAgICAgICogQ29uZmlndXJhdGlvbiBvcHRpb25zLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcHJvcGVydHkge01vZGV9IG1vZGUgVGhlIGJsb2NrIG1vZGUgdG8gdXNlLiBEZWZhdWx0OiBDQkMNCiAgICAgICAgICogQHByb3BlcnR5IHtQYWRkaW5nfSBwYWRkaW5nIFRoZSBwYWRkaW5nIHN0cmF0ZWd5IHRvIHVzZS4gRGVmYXVsdDogUGtjczcNCiAgICAgICAgICovDQogICAgICAgIGNmZzogQ2lwaGVyLmNmZy5leHRlbmQoew0KICAgICAgICAgICAgbW9kZTogQ0JDLA0KICAgICAgICAgICAgcGFkZGluZzogUGtjczcNCiAgICAgICAgfSksDQoNCiAgICAgICAgcmVzZXQ6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIC8vIFJlc2V0IGNpcGhlcg0KICAgICAgICAgICAgQ2lwaGVyLnJlc2V0LmNhbGwodGhpcyk7DQoNCiAgICAgICAgICAgIC8vIFNob3J0Y3V0cw0KICAgICAgICAgICAgdmFyIGNmZyA9IHRoaXMuY2ZnOw0KICAgICAgICAgICAgdmFyIGl2ID0gY2ZnLml2Ow0KICAgICAgICAgICAgdmFyIG1vZGUgPSBjZmcubW9kZTsNCg0KICAgICAgICAgICAgLy8gUmVzZXQgYmxvY2sgbW9kZQ0KICAgICAgICAgICAgaWYgKHRoaXMuX3hmb3JtTW9kZSA9PSB0aGlzLl9FTkNfWEZPUk1fTU9ERSkgew0KICAgICAgICAgICAgICAgIHZhciBtb2RlQ3JlYXRvciA9IG1vZGUuY3JlYXRlRW5jcnlwdG9yOw0KICAgICAgICAgICAgfSBlbHNlIC8qIGlmICh0aGlzLl94Zm9ybU1vZGUgPT0gdGhpcy5fREVDX1hGT1JNX01PREUpICovIHsNCiAgICAgICAgICAgICAgICB2YXIgbW9kZUNyZWF0b3IgPSBtb2RlLmNyZWF0ZURlY3J5cHRvcjsNCg0KICAgICAgICAgICAgICAgIC8vIEtlZXAgYXQgbGVhc3Qgb25lIGJsb2NrIGluIHRoZSBidWZmZXIgZm9yIHVucGFkZGluZw0KICAgICAgICAgICAgICAgIHRoaXMuX21pbkJ1ZmZlclNpemUgPSAxOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdGhpcy5fbW9kZSA9IG1vZGVDcmVhdG9yLmNhbGwobW9kZSwgdGhpcywgaXYgJiYgaXYud29yZHMpOw0KICAgICAgICB9LA0KDQogICAgICAgIF9kb1Byb2Nlc3NCbG9jazogZnVuY3Rpb24gKHdvcmRzLCBvZmZzZXQpIHsNCiAgICAgICAgICAgIHRoaXMuX21vZGUucHJvY2Vzc0Jsb2NrKHdvcmRzLCBvZmZzZXQpOw0KICAgICAgICB9LA0KDQogICAgICAgIF9kb0ZpbmFsaXplOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAvLyBTaG9ydGN1dA0KICAgICAgICAgICAgdmFyIHBhZGRpbmcgPSB0aGlzLmNmZy5wYWRkaW5nOw0KDQogICAgICAgICAgICAvLyBGaW5hbGl6ZQ0KICAgICAgICAgICAgaWYgKHRoaXMuX3hmb3JtTW9kZSA9PSB0aGlzLl9FTkNfWEZPUk1fTU9ERSkgew0KICAgICAgICAgICAgICAgIC8vIFBhZCBkYXRhDQogICAgICAgICAgICAgICAgcGFkZGluZy5wYWQodGhpcy5fZGF0YSwgdGhpcy5ibG9ja1NpemUpOw0KDQogICAgICAgICAgICAgICAgLy8gUHJvY2VzcyBmaW5hbCBibG9ja3MNCiAgICAgICAgICAgICAgICB2YXIgZmluYWxQcm9jZXNzZWRCbG9ja3MgPSB0aGlzLl9wcm9jZXNzKCEhJ2ZsdXNoJyk7DQogICAgICAgICAgICB9IGVsc2UgLyogaWYgKHRoaXMuX3hmb3JtTW9kZSA9PSB0aGlzLl9ERUNfWEZPUk1fTU9ERSkgKi8gew0KICAgICAgICAgICAgICAgIC8vIFByb2Nlc3MgZmluYWwgYmxvY2tzDQogICAgICAgICAgICAgICAgdmFyIGZpbmFsUHJvY2Vzc2VkQmxvY2tzID0gdGhpcy5fcHJvY2VzcyghISdmbHVzaCcpOw0KDQogICAgICAgICAgICAgICAgLy8gVW5wYWQgZGF0YQ0KICAgICAgICAgICAgICAgIHBhZGRpbmcudW5wYWQoZmluYWxQcm9jZXNzZWRCbG9ja3MpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gZmluYWxQcm9jZXNzZWRCbG9ja3M7DQogICAgICAgIH0sDQoNCiAgICAgICAgYmxvY2tTaXplOiAxMjgvMzINCiAgICB9KTsNCg0KICAgIC8qKg0KICAgICAqIEEgY29sbGVjdGlvbiBvZiBjaXBoZXIgcGFyYW1ldGVycy4NCiAgICAgKg0KICAgICAqIEBwcm9wZXJ0eSB7V29yZEFycmF5fSBjaXBoZXJ0ZXh0IFRoZSByYXcgY2lwaGVydGV4dC4NCiAgICAgKiBAcHJvcGVydHkge1dvcmRBcnJheX0ga2V5IFRoZSBrZXkgdG8gdGhpcyBjaXBoZXJ0ZXh0Lg0KICAgICAqIEBwcm9wZXJ0eSB7V29yZEFycmF5fSBpdiBUaGUgSVYgdXNlZCBpbiB0aGUgY2lwaGVyaW5nIG9wZXJhdGlvbi4NCiAgICAgKiBAcHJvcGVydHkge1dvcmRBcnJheX0gc2FsdCBUaGUgc2FsdCB1c2VkIHdpdGggYSBrZXkgZGVyaXZhdGlvbiBmdW5jdGlvbi4NCiAgICAgKiBAcHJvcGVydHkge0NpcGhlcn0gYWxnb3JpdGhtIFRoZSBjaXBoZXIgYWxnb3JpdGhtLg0KICAgICAqIEBwcm9wZXJ0eSB7TW9kZX0gbW9kZSBUaGUgYmxvY2sgbW9kZSB1c2VkIGluIHRoZSBjaXBoZXJpbmcgb3BlcmF0aW9uLg0KICAgICAqIEBwcm9wZXJ0eSB7UGFkZGluZ30gcGFkZGluZyBUaGUgcGFkZGluZyBzY2hlbWUgdXNlZCBpbiB0aGUgY2lwaGVyaW5nIG9wZXJhdGlvbi4NCiAgICAgKiBAcHJvcGVydHkge251bWJlcn0gYmxvY2tTaXplIFRoZSBibG9jayBzaXplIG9mIHRoZSBjaXBoZXIuDQogICAgICogQHByb3BlcnR5IHtGb3JtYXR9IGZvcm1hdHRlciBUaGUgZGVmYXVsdCBmb3JtYXR0aW5nIHN0cmF0ZWd5IHRvIGNvbnZlcnQgdGhpcyBjaXBoZXIgcGFyYW1zIG9iamVjdCB0byBhIHN0cmluZy4NCiAgICAgKi8NCiAgICB2YXIgQ2lwaGVyUGFyYW1zID0gQ19saWIuQ2lwaGVyUGFyYW1zID0gQmFzZS5leHRlbmQoew0KICAgICAgICAvKioNCiAgICAgICAgICogSW5pdGlhbGl6ZXMgYSBuZXdseSBjcmVhdGVkIGNpcGhlciBwYXJhbXMgb2JqZWN0Lg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gY2lwaGVyUGFyYW1zIEFuIG9iamVjdCB3aXRoIGFueSBvZiB0aGUgcG9zc2libGUgY2lwaGVyIHBhcmFtZXRlcnMuDQogICAgICAgICAqDQogICAgICAgICAqIEBleGFtcGxlDQogICAgICAgICAqDQogICAgICAgICAqICAgICB2YXIgY2lwaGVyUGFyYW1zID0gQ3J5cHRvSlMubGliLkNpcGhlclBhcmFtcy5jcmVhdGUoew0KICAgICAgICAgKiAgICAgICAgIGNpcGhlcnRleHQ6IGNpcGhlcnRleHRXb3JkQXJyYXksDQogICAgICAgICAqICAgICAgICAga2V5OiBrZXlXb3JkQXJyYXksDQogICAgICAgICAqICAgICAgICAgaXY6IGl2V29yZEFycmF5LA0KICAgICAgICAgKiAgICAgICAgIHNhbHQ6IHNhbHRXb3JkQXJyYXksDQogICAgICAgICAqICAgICAgICAgYWxnb3JpdGhtOiBDcnlwdG9KUy5hbGdvLkFFUywNCiAgICAgICAgICogICAgICAgICBtb2RlOiBDcnlwdG9KUy5tb2RlLkNCQywNCiAgICAgICAgICogICAgICAgICBwYWRkaW5nOiBDcnlwdG9KUy5wYWQuUEtDUzcsDQogICAgICAgICAqICAgICAgICAgYmxvY2tTaXplOiA0LA0KICAgICAgICAgKiAgICAgICAgIGZvcm1hdHRlcjogQ3J5cHRvSlMuZm9ybWF0Lk9wZW5TU0wNCiAgICAgICAgICogICAgIH0pOw0KICAgICAgICAgKi8NCiAgICAgICAgaW5pdDogZnVuY3Rpb24gKGNpcGhlclBhcmFtcykgew0KICAgICAgICAgICAgdGhpcy5taXhJbihjaXBoZXJQYXJhbXMpOw0KICAgICAgICB9LA0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBDb252ZXJ0cyB0aGlzIGNpcGhlciBwYXJhbXMgb2JqZWN0IHRvIGEgc3RyaW5nLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcGFyYW0ge0Zvcm1hdH0gZm9ybWF0dGVyIChPcHRpb25hbCkgVGhlIGZvcm1hdHRpbmcgc3RyYXRlZ3kgdG8gdXNlLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBzdHJpbmdpZmllZCBjaXBoZXIgcGFyYW1zLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAdGhyb3dzIEVycm9yIElmIG5laXRoZXIgdGhlIGZvcm1hdHRlciBub3IgdGhlIGRlZmF1bHQgZm9ybWF0dGVyIGlzIHNldC4NCiAgICAgICAgICoNCiAgICAgICAgICogQGV4YW1wbGUNCiAgICAgICAgICoNCiAgICAgICAgICogICAgIHZhciBzdHJpbmcgPSBjaXBoZXJQYXJhbXMgKyAnJzsNCiAgICAgICAgICogICAgIHZhciBzdHJpbmcgPSBjaXBoZXJQYXJhbXMudG9TdHJpbmcoKTsNCiAgICAgICAgICogICAgIHZhciBzdHJpbmcgPSBjaXBoZXJQYXJhbXMudG9TdHJpbmcoQ3J5cHRvSlMuZm9ybWF0Lk9wZW5TU0wpOw0KICAgICAgICAgKi8NCiAgICAgICAgdG9TdHJpbmc6IGZ1bmN0aW9uIChmb3JtYXR0ZXIpIHsNCiAgICAgICAgICAgIHJldHVybiAoZm9ybWF0dGVyIHx8IHRoaXMuZm9ybWF0dGVyKS5zdHJpbmdpZnkodGhpcyk7DQogICAgICAgIH0NCiAgICB9KTsNCg0KICAgIC8qKg0KICAgICAqIEZvcm1hdCBuYW1lc3BhY2UuDQogICAgICovDQogICAgdmFyIENfZm9ybWF0ID0gQy5mb3JtYXQgPSB7fTsNCg0KICAgIC8qKg0KICAgICAqIE9wZW5TU0wgZm9ybWF0dGluZyBzdHJhdGVneS4NCiAgICAgKi8NCiAgICB2YXIgT3BlblNTTEZvcm1hdHRlciA9IENfZm9ybWF0Lk9wZW5TU0wgPSB7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBDb252ZXJ0cyBhIGNpcGhlciBwYXJhbXMgb2JqZWN0IHRvIGFuIE9wZW5TU0wtY29tcGF0aWJsZSBzdHJpbmcuDQogICAgICAgICAqDQogICAgICAgICAqIEBwYXJhbSB7Q2lwaGVyUGFyYW1zfSBjaXBoZXJQYXJhbXMgVGhlIGNpcGhlciBwYXJhbXMgb2JqZWN0Lg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBPcGVuU1NMLWNvbXBhdGlibGUgc3RyaW5nLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAc3RhdGljDQogICAgICAgICAqDQogICAgICAgICAqIEBleGFtcGxlDQogICAgICAgICAqDQogICAgICAgICAqICAgICB2YXIgb3BlblNTTFN0cmluZyA9IENyeXB0b0pTLmZvcm1hdC5PcGVuU1NMLnN0cmluZ2lmeShjaXBoZXJQYXJhbXMpOw0KICAgICAgICAgKi8NCiAgICAgICAgc3RyaW5naWZ5OiBmdW5jdGlvbiAoY2lwaGVyUGFyYW1zKSB7DQogICAgICAgICAgICAvLyBTaG9ydGN1dHMNCiAgICAgICAgICAgIHZhciBjaXBoZXJ0ZXh0ID0gY2lwaGVyUGFyYW1zLmNpcGhlcnRleHQ7DQogICAgICAgICAgICB2YXIgc2FsdCA9IGNpcGhlclBhcmFtcy5zYWx0Ow0KDQogICAgICAgICAgICAvLyBGb3JtYXQNCiAgICAgICAgICAgIGlmIChzYWx0KSB7DQogICAgICAgICAgICAgICAgdmFyIHdvcmRBcnJheSA9IFdvcmRBcnJheS5jcmVhdGUoWzB4NTM2MTZjNzQsIDB4NjU2NDVmNWZdKS5jb25jYXQoc2FsdCkuY29uY2F0KGNpcGhlcnRleHQpOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICB2YXIgd29yZEFycmF5ID0gY2lwaGVydGV4dDsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIHdvcmRBcnJheS50b1N0cmluZyhCYXNlNjQpOw0KICAgICAgICB9LA0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBDb252ZXJ0cyBhbiBPcGVuU1NMLWNvbXBhdGlibGUgc3RyaW5nIHRvIGEgY2lwaGVyIHBhcmFtcyBvYmplY3QuDQogICAgICAgICAqDQogICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBvcGVuU1NMU3RyIFRoZSBPcGVuU1NMLWNvbXBhdGlibGUgc3RyaW5nLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcmV0dXJuIHtDaXBoZXJQYXJhbXN9IFRoZSBjaXBoZXIgcGFyYW1zIG9iamVjdC4NCiAgICAgICAgICoNCiAgICAgICAgICogQHN0YXRpYw0KICAgICAgICAgKg0KICAgICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICAgKg0KICAgICAgICAgKiAgICAgdmFyIGNpcGhlclBhcmFtcyA9IENyeXB0b0pTLmZvcm1hdC5PcGVuU1NMLnBhcnNlKG9wZW5TU0xTdHJpbmcpOw0KICAgICAgICAgKi8NCiAgICAgICAgcGFyc2U6IGZ1bmN0aW9uIChvcGVuU1NMU3RyKSB7DQogICAgICAgICAgICAvLyBQYXJzZSBiYXNlNjQNCiAgICAgICAgICAgIHZhciBjaXBoZXJ0ZXh0ID0gQmFzZTY0LnBhcnNlKG9wZW5TU0xTdHIpOw0KDQogICAgICAgICAgICAvLyBTaG9ydGN1dA0KICAgICAgICAgICAgdmFyIGNpcGhlcnRleHRXb3JkcyA9IGNpcGhlcnRleHQud29yZHM7DQoNCiAgICAgICAgICAgIC8vIFRlc3QgZm9yIHNhbHQNCiAgICAgICAgICAgIGlmIChjaXBoZXJ0ZXh0V29yZHNbMF0gPT0gMHg1MzYxNmM3NCAmJiBjaXBoZXJ0ZXh0V29yZHNbMV0gPT0gMHg2NTY0NWY1Zikgew0KICAgICAgICAgICAgICAgIC8vIEV4dHJhY3Qgc2FsdA0KICAgICAgICAgICAgICAgIHZhciBzYWx0ID0gV29yZEFycmF5LmNyZWF0ZShjaXBoZXJ0ZXh0V29yZHMuc2xpY2UoMiwgNCkpOw0KDQogICAgICAgICAgICAgICAgLy8gUmVtb3ZlIHNhbHQgZnJvbSBjaXBoZXJ0ZXh0DQogICAgICAgICAgICAgICAgY2lwaGVydGV4dFdvcmRzLnNwbGljZSgwLCA0KTsNCiAgICAgICAgICAgICAgICBjaXBoZXJ0ZXh0LnNpZ0J5dGVzIC09IDE2Ow0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gQ2lwaGVyUGFyYW1zLmNyZWF0ZSh7IGNpcGhlcnRleHQ6IGNpcGhlcnRleHQsIHNhbHQ6IHNhbHQgfSk7DQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogQSBjaXBoZXIgd3JhcHBlciB0aGF0IHJldHVybnMgY2lwaGVydGV4dCBhcyBhIHNlcmlhbGl6YWJsZSBjaXBoZXIgcGFyYW1zIG9iamVjdC4NCiAgICAgKi8NCiAgICB2YXIgU2VyaWFsaXphYmxlQ2lwaGVyID0gQ19saWIuU2VyaWFsaXphYmxlQ2lwaGVyID0gQmFzZS5leHRlbmQoew0KICAgICAgICAvKioNCiAgICAgICAgICogQ29uZmlndXJhdGlvbiBvcHRpb25zLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcHJvcGVydHkge0Zvcm1hdHRlcn0gZm9ybWF0IFRoZSBmb3JtYXR0aW5nIHN0cmF0ZWd5IHRvIGNvbnZlcnQgY2lwaGVyIHBhcmFtIG9iamVjdHMgdG8gYW5kIGZyb20gYSBzdHJpbmcuIERlZmF1bHQ6IE9wZW5TU0wNCiAgICAgICAgICovDQogICAgICAgIGNmZzogQmFzZS5leHRlbmQoew0KICAgICAgICAgICAgZm9ybWF0OiBPcGVuU1NMRm9ybWF0dGVyDQogICAgICAgIH0pLA0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBFbmNyeXB0cyBhIG1lc3NhZ2UuDQogICAgICAgICAqDQogICAgICAgICAqIEBwYXJhbSB7Q2lwaGVyfSBjaXBoZXIgVGhlIGNpcGhlciBhbGdvcml0aG0gdG8gdXNlLg0KICAgICAgICAgKiBAcGFyYW0ge1dvcmRBcnJheXxzdHJpbmd9IG1lc3NhZ2UgVGhlIG1lc3NhZ2UgdG8gZW5jcnlwdC4NCiAgICAgICAgICogQHBhcmFtIHtXb3JkQXJyYXl9IGtleSBUaGUga2V5Lg0KICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gY2ZnIChPcHRpb25hbCkgVGhlIGNvbmZpZ3VyYXRpb24gb3B0aW9ucyB0byB1c2UgZm9yIHRoaXMgb3BlcmF0aW9uLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcmV0dXJuIHtDaXBoZXJQYXJhbXN9IEEgY2lwaGVyIHBhcmFtcyBvYmplY3QuDQogICAgICAgICAqDQogICAgICAgICAqIEBzdGF0aWMNCiAgICAgICAgICoNCiAgICAgICAgICogQGV4YW1wbGUNCiAgICAgICAgICoNCiAgICAgICAgICogICAgIHZhciBjaXBoZXJ0ZXh0UGFyYW1zID0gQ3J5cHRvSlMubGliLlNlcmlhbGl6YWJsZUNpcGhlci5lbmNyeXB0KENyeXB0b0pTLmFsZ28uQUVTLCBtZXNzYWdlLCBrZXkpOw0KICAgICAgICAgKiAgICAgdmFyIGNpcGhlcnRleHRQYXJhbXMgPSBDcnlwdG9KUy5saWIuU2VyaWFsaXphYmxlQ2lwaGVyLmVuY3J5cHQoQ3J5cHRvSlMuYWxnby5BRVMsIG1lc3NhZ2UsIGtleSwgeyBpdjogaXYgfSk7DQogICAgICAgICAqICAgICB2YXIgY2lwaGVydGV4dFBhcmFtcyA9IENyeXB0b0pTLmxpYi5TZXJpYWxpemFibGVDaXBoZXIuZW5jcnlwdChDcnlwdG9KUy5hbGdvLkFFUywgbWVzc2FnZSwga2V5LCB7IGl2OiBpdiwgZm9ybWF0OiBDcnlwdG9KUy5mb3JtYXQuT3BlblNTTCB9KTsNCiAgICAgICAgICovDQogICAgICAgIGVuY3J5cHQ6IGZ1bmN0aW9uIChjaXBoZXIsIG1lc3NhZ2UsIGtleSwgY2ZnKSB7DQogICAgICAgICAgICAvLyBBcHBseSBjb25maWcgZGVmYXVsdHMNCiAgICAgICAgICAgIGNmZyA9IHRoaXMuY2ZnLmV4dGVuZChjZmcpOw0KDQogICAgICAgICAgICAvLyBFbmNyeXB0DQogICAgICAgICAgICB2YXIgZW5jcnlwdG9yID0gY2lwaGVyLmNyZWF0ZUVuY3J5cHRvcihrZXksIGNmZyk7DQogICAgICAgICAgICB2YXIgY2lwaGVydGV4dCA9IGVuY3J5cHRvci5maW5hbGl6ZShtZXNzYWdlKTsNCg0KICAgICAgICAgICAgLy8gU2hvcnRjdXQNCiAgICAgICAgICAgIHZhciBjaXBoZXJDZmcgPSBlbmNyeXB0b3IuY2ZnOw0KDQogICAgICAgICAgICAvLyBDcmVhdGUgYW5kIHJldHVybiBzZXJpYWxpemFibGUgY2lwaGVyIHBhcmFtcw0KICAgICAgICAgICAgcmV0dXJuIENpcGhlclBhcmFtcy5jcmVhdGUoew0KICAgICAgICAgICAgICAgIGNpcGhlcnRleHQ6IGNpcGhlcnRleHQsDQogICAgICAgICAgICAgICAga2V5OiBrZXksDQogICAgICAgICAgICAgICAgaXY6IGNpcGhlckNmZy5pdiwNCiAgICAgICAgICAgICAgICBhbGdvcml0aG06IGNpcGhlciwNCiAgICAgICAgICAgICAgICBtb2RlOiBjaXBoZXJDZmcubW9kZSwNCiAgICAgICAgICAgICAgICBwYWRkaW5nOiBjaXBoZXJDZmcucGFkZGluZywNCiAgICAgICAgICAgICAgICBibG9ja1NpemU6IGNpcGhlci5ibG9ja1NpemUsDQogICAgICAgICAgICAgICAgZm9ybWF0dGVyOiBjZmcuZm9ybWF0DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfSwNCg0KICAgICAgICAvKioNCiAgICAgICAgICogRGVjcnlwdHMgc2VyaWFsaXplZCBjaXBoZXJ0ZXh0Lg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcGFyYW0ge0NpcGhlcn0gY2lwaGVyIFRoZSBjaXBoZXIgYWxnb3JpdGhtIHRvIHVzZS4NCiAgICAgICAgICogQHBhcmFtIHtDaXBoZXJQYXJhbXN8c3RyaW5nfSBjaXBoZXJ0ZXh0IFRoZSBjaXBoZXJ0ZXh0IHRvIGRlY3J5cHQuDQogICAgICAgICAqIEBwYXJhbSB7V29yZEFycmF5fSBrZXkgVGhlIGtleS4NCiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGNmZyAoT3B0aW9uYWwpIFRoZSBjb25maWd1cmF0aW9uIG9wdGlvbnMgdG8gdXNlIGZvciB0aGlzIG9wZXJhdGlvbi4NCiAgICAgICAgICoNCiAgICAgICAgICogQHJldHVybiB7V29yZEFycmF5fSBUaGUgcGxhaW50ZXh0Lg0KICAgICAgICAgKg0KICAgICAgICAgKiBAc3RhdGljDQogICAgICAgICAqDQogICAgICAgICAqIEBleGFtcGxlDQogICAgICAgICAqDQogICAgICAgICAqICAgICB2YXIgcGxhaW50ZXh0ID0gQ3J5cHRvSlMubGliLlNlcmlhbGl6YWJsZUNpcGhlci5kZWNyeXB0KENyeXB0b0pTLmFsZ28uQUVTLCBmb3JtYXR0ZWRDaXBoZXJ0ZXh0LCBrZXksIHsgaXY6IGl2LCBmb3JtYXQ6IENyeXB0b0pTLmZvcm1hdC5PcGVuU1NMIH0pOw0KICAgICAgICAgKiAgICAgdmFyIHBsYWludGV4dCA9IENyeXB0b0pTLmxpYi5TZXJpYWxpemFibGVDaXBoZXIuZGVjcnlwdChDcnlwdG9KUy5hbGdvLkFFUywgY2lwaGVydGV4dFBhcmFtcywga2V5LCB7IGl2OiBpdiwgZm9ybWF0OiBDcnlwdG9KUy5mb3JtYXQuT3BlblNTTCB9KTsNCiAgICAgICAgICovDQogICAgICAgIGRlY3J5cHQ6IGZ1bmN0aW9uIChjaXBoZXIsIGNpcGhlcnRleHQsIGtleSwgY2ZnKSB7DQogICAgICAgICAgICAvLyBBcHBseSBjb25maWcgZGVmYXVsdHMNCiAgICAgICAgICAgIGNmZyA9IHRoaXMuY2ZnLmV4dGVuZChjZmcpOw0KDQogICAgICAgICAgICAvLyBDb252ZXJ0IHN0cmluZyB0byBDaXBoZXJQYXJhbXMNCiAgICAgICAgICAgIGNpcGhlcnRleHQgPSB0aGlzLl9wYXJzZShjaXBoZXJ0ZXh0LCBjZmcuZm9ybWF0KTsNCg0KICAgICAgICAgICAgLy8gRGVjcnlwdA0KICAgICAgICAgICAgdmFyIHBsYWludGV4dCA9IGNpcGhlci5jcmVhdGVEZWNyeXB0b3Ioa2V5LCBjZmcpLmZpbmFsaXplKGNpcGhlcnRleHQuY2lwaGVydGV4dCk7DQoNCiAgICAgICAgICAgIHJldHVybiBwbGFpbnRleHQ7DQogICAgICAgIH0sDQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIENvbnZlcnRzIHNlcmlhbGl6ZWQgY2lwaGVydGV4dCB0byBDaXBoZXJQYXJhbXMsDQogICAgICAgICAqIGVsc2UgYXNzdW1lZCBDaXBoZXJQYXJhbXMgYWxyZWFkeSBhbmQgcmV0dXJucyBjaXBoZXJ0ZXh0IHVuY2hhbmdlZC4NCiAgICAgICAgICoNCiAgICAgICAgICogQHBhcmFtIHtDaXBoZXJQYXJhbXN8c3RyaW5nfSBjaXBoZXJ0ZXh0IFRoZSBjaXBoZXJ0ZXh0Lg0KICAgICAgICAgKiBAcGFyYW0ge0Zvcm1hdHRlcn0gZm9ybWF0IFRoZSBmb3JtYXR0aW5nIHN0cmF0ZWd5IHRvIHVzZSB0byBwYXJzZSBzZXJpYWxpemVkIGNpcGhlcnRleHQuDQogICAgICAgICAqDQogICAgICAgICAqIEByZXR1cm4ge0NpcGhlclBhcmFtc30gVGhlIHVuc2VyaWFsaXplZCBjaXBoZXJ0ZXh0Lg0KICAgICAgICAgKg0KICAgICAgICAgKiBAc3RhdGljDQogICAgICAgICAqDQogICAgICAgICAqIEBleGFtcGxlDQogICAgICAgICAqDQogICAgICAgICAqICAgICB2YXIgY2lwaGVydGV4dFBhcmFtcyA9IENyeXB0b0pTLmxpYi5TZXJpYWxpemFibGVDaXBoZXIuX3BhcnNlKGNpcGhlcnRleHRTdHJpbmdPclBhcmFtcywgZm9ybWF0KTsNCiAgICAgICAgICovDQogICAgICAgIF9wYXJzZTogZnVuY3Rpb24gKGNpcGhlcnRleHQsIGZvcm1hdCkgew0KICAgICAgICAgICAgaWYgKHR5cGVvZiBjaXBoZXJ0ZXh0ID09ICdzdHJpbmcnKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGZvcm1hdC5wYXJzZShjaXBoZXJ0ZXh0LCB0aGlzKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGNpcGhlcnRleHQ7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9KTsNCg0KICAgIC8qKg0KICAgICAqIEtleSBkZXJpdmF0aW9uIGZ1bmN0aW9uIG5hbWVzcGFjZS4NCiAgICAgKi8NCiAgICB2YXIgQ19rZGYgPSBDLmtkZiA9IHt9Ow0KDQogICAgLyoqDQogICAgICogT3BlblNTTCBrZXkgZGVyaXZhdGlvbiBmdW5jdGlvbi4NCiAgICAgKi8NCiAgICB2YXIgT3BlblNTTEtkZiA9IENfa2RmLk9wZW5TU0wgPSB7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBEZXJpdmVzIGEga2V5IGFuZCBJViBmcm9tIGEgcGFzc3dvcmQuDQogICAgICAgICAqDQogICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBwYXNzd29yZCBUaGUgcGFzc3dvcmQgdG8gZGVyaXZlIGZyb20uDQogICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSBrZXlTaXplIFRoZSBzaXplIGluIHdvcmRzIG9mIHRoZSBrZXkgdG8gZ2VuZXJhdGUuDQogICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSBpdlNpemUgVGhlIHNpemUgaW4gd29yZHMgb2YgdGhlIElWIHRvIGdlbmVyYXRlLg0KICAgICAgICAgKiBAcGFyYW0ge1dvcmRBcnJheXxzdHJpbmd9IHNhbHQgKE9wdGlvbmFsKSBBIDY0LWJpdCBzYWx0IHRvIHVzZS4gSWYgb21pdHRlZCwgYSBzYWx0IHdpbGwgYmUgZ2VuZXJhdGVkIHJhbmRvbWx5Lg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcmV0dXJuIHtDaXBoZXJQYXJhbXN9IEEgY2lwaGVyIHBhcmFtcyBvYmplY3Qgd2l0aCB0aGUga2V5LCBJViwgYW5kIHNhbHQuDQogICAgICAgICAqDQogICAgICAgICAqIEBzdGF0aWMNCiAgICAgICAgICoNCiAgICAgICAgICogQGV4YW1wbGUNCiAgICAgICAgICoNCiAgICAgICAgICogICAgIHZhciBkZXJpdmVkUGFyYW1zID0gQ3J5cHRvSlMua2RmLk9wZW5TU0wuZXhlY3V0ZSgnUGFzc3dvcmQnLCAyNTYvMzIsIDEyOC8zMik7DQogICAgICAgICAqICAgICB2YXIgZGVyaXZlZFBhcmFtcyA9IENyeXB0b0pTLmtkZi5PcGVuU1NMLmV4ZWN1dGUoJ1Bhc3N3b3JkJywgMjU2LzMyLCAxMjgvMzIsICdzYWx0c2FsdCcpOw0KICAgICAgICAgKi8NCiAgICAgICAgZXhlY3V0ZTogZnVuY3Rpb24gKHBhc3N3b3JkLCBrZXlTaXplLCBpdlNpemUsIHNhbHQpIHsNCiAgICAgICAgICAgIC8vIEdlbmVyYXRlIHJhbmRvbSBzYWx0DQogICAgICAgICAgICBpZiAoIXNhbHQpIHsNCiAgICAgICAgICAgICAgICBzYWx0ID0gV29yZEFycmF5LnJhbmRvbSg2NC84KTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gRGVyaXZlIGtleSBhbmQgSVYNCiAgICAgICAgICAgIHZhciBrZXkgPSBFdnBLREYuY3JlYXRlKHsga2V5U2l6ZToga2V5U2l6ZSArIGl2U2l6ZSB9KS5jb21wdXRlKHBhc3N3b3JkLCBzYWx0KTsNCg0KICAgICAgICAgICAgLy8gU2VwYXJhdGUga2V5IGFuZCBJVg0KICAgICAgICAgICAgdmFyIGl2ID0gV29yZEFycmF5LmNyZWF0ZShrZXkud29yZHMuc2xpY2Uoa2V5U2l6ZSksIGl2U2l6ZSAqIDQpOw0KICAgICAgICAgICAga2V5LnNpZ0J5dGVzID0ga2V5U2l6ZSAqIDQ7DQoNCiAgICAgICAgICAgIC8vIFJldHVybiBwYXJhbXMNCiAgICAgICAgICAgIHJldHVybiBDaXBoZXJQYXJhbXMuY3JlYXRlKHsga2V5OiBrZXksIGl2OiBpdiwgc2FsdDogc2FsdCB9KTsNCiAgICAgICAgfQ0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBBIHNlcmlhbGl6YWJsZSBjaXBoZXIgd3JhcHBlciB0aGF0IGRlcml2ZXMgdGhlIGtleSBmcm9tIGEgcGFzc3dvcmQsDQogICAgICogYW5kIHJldHVybnMgY2lwaGVydGV4dCBhcyBhIHNlcmlhbGl6YWJsZSBjaXBoZXIgcGFyYW1zIG9iamVjdC4NCiAgICAgKi8NCiAgICB2YXIgUGFzc3dvcmRCYXNlZENpcGhlciA9IENfbGliLlBhc3N3b3JkQmFzZWRDaXBoZXIgPSBTZXJpYWxpemFibGVDaXBoZXIuZXh0ZW5kKHsNCiAgICAgICAgLyoqDQogICAgICAgICAqIENvbmZpZ3VyYXRpb24gb3B0aW9ucy4NCiAgICAgICAgICoNCiAgICAgICAgICogQHByb3BlcnR5IHtLREZ9IGtkZiBUaGUga2V5IGRlcml2YXRpb24gZnVuY3Rpb24gdG8gdXNlIHRvIGdlbmVyYXRlIGEga2V5IGFuZCBJViBmcm9tIGEgcGFzc3dvcmQuIERlZmF1bHQ6IE9wZW5TU0wNCiAgICAgICAgICovDQogICAgICAgIGNmZzogU2VyaWFsaXphYmxlQ2lwaGVyLmNmZy5leHRlbmQoew0KICAgICAgICAgICAga2RmOiBPcGVuU1NMS2RmDQogICAgICAgIH0pLA0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBFbmNyeXB0cyBhIG1lc3NhZ2UgdXNpbmcgYSBwYXNzd29yZC4NCiAgICAgICAgICoNCiAgICAgICAgICogQHBhcmFtIHtDaXBoZXJ9IGNpcGhlciBUaGUgY2lwaGVyIGFsZ29yaXRobSB0byB1c2UuDQogICAgICAgICAqIEBwYXJhbSB7V29yZEFycmF5fHN0cmluZ30gbWVzc2FnZSBUaGUgbWVzc2FnZSB0byBlbmNyeXB0Lg0KICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gcGFzc3dvcmQgVGhlIHBhc3N3b3JkLg0KICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gY2ZnIChPcHRpb25hbCkgVGhlIGNvbmZpZ3VyYXRpb24gb3B0aW9ucyB0byB1c2UgZm9yIHRoaXMgb3BlcmF0aW9uLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcmV0dXJuIHtDaXBoZXJQYXJhbXN9IEEgY2lwaGVyIHBhcmFtcyBvYmplY3QuDQogICAgICAgICAqDQogICAgICAgICAqIEBzdGF0aWMNCiAgICAgICAgICoNCiAgICAgICAgICogQGV4YW1wbGUNCiAgICAgICAgICoNCiAgICAgICAgICogICAgIHZhciBjaXBoZXJ0ZXh0UGFyYW1zID0gQ3J5cHRvSlMubGliLlBhc3N3b3JkQmFzZWRDaXBoZXIuZW5jcnlwdChDcnlwdG9KUy5hbGdvLkFFUywgbWVzc2FnZSwgJ3Bhc3N3b3JkJyk7DQogICAgICAgICAqICAgICB2YXIgY2lwaGVydGV4dFBhcmFtcyA9IENyeXB0b0pTLmxpYi5QYXNzd29yZEJhc2VkQ2lwaGVyLmVuY3J5cHQoQ3J5cHRvSlMuYWxnby5BRVMsIG1lc3NhZ2UsICdwYXNzd29yZCcsIHsgZm9ybWF0OiBDcnlwdG9KUy5mb3JtYXQuT3BlblNTTCB9KTsNCiAgICAgICAgICovDQogICAgICAgIGVuY3J5cHQ6IGZ1bmN0aW9uIChjaXBoZXIsIG1lc3NhZ2UsIHBhc3N3b3JkLCBjZmcpIHsNCiAgICAgICAgICAgIC8vIEFwcGx5IGNvbmZpZyBkZWZhdWx0cw0KICAgICAgICAgICAgY2ZnID0gdGhpcy5jZmcuZXh0ZW5kKGNmZyk7DQoNCiAgICAgICAgICAgIC8vIERlcml2ZSBrZXkgYW5kIG90aGVyIHBhcmFtcw0KICAgICAgICAgICAgdmFyIGRlcml2ZWRQYXJhbXMgPSBjZmcua2RmLmV4ZWN1dGUocGFzc3dvcmQsIGNpcGhlci5rZXlTaXplLCBjaXBoZXIuaXZTaXplKTsNCg0KICAgICAgICAgICAgLy8gQWRkIElWIHRvIGNvbmZpZw0KICAgICAgICAgICAgY2ZnLml2ID0gZGVyaXZlZFBhcmFtcy5pdjsNCg0KICAgICAgICAgICAgLy8gRW5jcnlwdA0KICAgICAgICAgICAgdmFyIGNpcGhlcnRleHQgPSBTZXJpYWxpemFibGVDaXBoZXIuZW5jcnlwdC5jYWxsKHRoaXMsIGNpcGhlciwgbWVzc2FnZSwgZGVyaXZlZFBhcmFtcy5rZXksIGNmZyk7DQoNCiAgICAgICAgICAgIC8vIE1peCBpbiBkZXJpdmVkIHBhcmFtcw0KICAgICAgICAgICAgY2lwaGVydGV4dC5taXhJbihkZXJpdmVkUGFyYW1zKTsNCg0KICAgICAgICAgICAgcmV0dXJuIGNpcGhlcnRleHQ7DQogICAgICAgIH0sDQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIERlY3J5cHRzIHNlcmlhbGl6ZWQgY2lwaGVydGV4dCB1c2luZyBhIHBhc3N3b3JkLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcGFyYW0ge0NpcGhlcn0gY2lwaGVyIFRoZSBjaXBoZXIgYWxnb3JpdGhtIHRvIHVzZS4NCiAgICAgICAgICogQHBhcmFtIHtDaXBoZXJQYXJhbXN8c3RyaW5nfSBjaXBoZXJ0ZXh0IFRoZSBjaXBoZXJ0ZXh0IHRvIGRlY3J5cHQuDQogICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBwYXNzd29yZCBUaGUgcGFzc3dvcmQuDQogICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjZmcgKE9wdGlvbmFsKSBUaGUgY29uZmlndXJhdGlvbiBvcHRpb25zIHRvIHVzZSBmb3IgdGhpcyBvcGVyYXRpb24uDQogICAgICAgICAqDQogICAgICAgICAqIEByZXR1cm4ge1dvcmRBcnJheX0gVGhlIHBsYWludGV4dC4NCiAgICAgICAgICoNCiAgICAgICAgICogQHN0YXRpYw0KICAgICAgICAgKg0KICAgICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICAgKg0KICAgICAgICAgKiAgICAgdmFyIHBsYWludGV4dCA9IENyeXB0b0pTLmxpYi5QYXNzd29yZEJhc2VkQ2lwaGVyLmRlY3J5cHQoQ3J5cHRvSlMuYWxnby5BRVMsIGZvcm1hdHRlZENpcGhlcnRleHQsICdwYXNzd29yZCcsIHsgZm9ybWF0OiBDcnlwdG9KUy5mb3JtYXQuT3BlblNTTCB9KTsNCiAgICAgICAgICogICAgIHZhciBwbGFpbnRleHQgPSBDcnlwdG9KUy5saWIuUGFzc3dvcmRCYXNlZENpcGhlci5kZWNyeXB0KENyeXB0b0pTLmFsZ28uQUVTLCBjaXBoZXJ0ZXh0UGFyYW1zLCAncGFzc3dvcmQnLCB7IGZvcm1hdDogQ3J5cHRvSlMuZm9ybWF0Lk9wZW5TU0wgfSk7DQogICAgICAgICAqLw0KICAgICAgICBkZWNyeXB0OiBmdW5jdGlvbiAoY2lwaGVyLCBjaXBoZXJ0ZXh0LCBwYXNzd29yZCwgY2ZnKSB7DQogICAgICAgICAgICAvLyBBcHBseSBjb25maWcgZGVmYXVsdHMNCiAgICAgICAgICAgIGNmZyA9IHRoaXMuY2ZnLmV4dGVuZChjZmcpOw0KDQogICAgICAgICAgICAvLyBDb252ZXJ0IHN0cmluZyB0byBDaXBoZXJQYXJhbXMNCiAgICAgICAgICAgIGNpcGhlcnRleHQgPSB0aGlzLl9wYXJzZShjaXBoZXJ0ZXh0LCBjZmcuZm9ybWF0KTsNCg0KICAgICAgICAgICAgLy8gRGVyaXZlIGtleSBhbmQgb3RoZXIgcGFyYW1zDQogICAgICAgICAgICB2YXIgZGVyaXZlZFBhcmFtcyA9IGNmZy5rZGYuZXhlY3V0ZShwYXNzd29yZCwgY2lwaGVyLmtleVNpemUsIGNpcGhlci5pdlNpemUsIGNpcGhlcnRleHQuc2FsdCk7DQoNCiAgICAgICAgICAgIC8vIEFkZCBJViB0byBjb25maWcNCiAgICAgICAgICAgIGNmZy5pdiA9IGRlcml2ZWRQYXJhbXMuaXY7DQoNCiAgICAgICAgICAgIC8vIERlY3J5cHQNCiAgICAgICAgICAgIHZhciBwbGFpbnRleHQgPSBTZXJpYWxpemFibGVDaXBoZXIuZGVjcnlwdC5jYWxsKHRoaXMsIGNpcGhlciwgY2lwaGVydGV4dCwgZGVyaXZlZFBhcmFtcy5rZXksIGNmZyk7DQoNCiAgICAgICAgICAgIHJldHVybiBwbGFpbnRleHQ7DQogICAgICAgIH0NCiAgICB9KTsNCn0oKSk7DQoKZGVmaW5lKCJjcnlwdG8uY2lwaGVyLWNvcmUiLCBbImNyeXB0by5lbmMtYmFzZTY0IiwiY3J5cHRvLmV2cGtkZiJdLCBmdW5jdGlvbigpe30pOwoKLyoKQ3J5cHRvSlMgdjMuMS4yCmNvZGUuZ29vZ2xlLmNvbS9wL2NyeXB0by1qcwooYykgMjAwOS0yMDEzIGJ5IEplZmYgTW90dC4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KY29kZS5nb29nbGUuY29tL3AvY3J5cHRvLWpzL3dpa2kvTGljZW5zZQoqLwooZnVuY3Rpb24gKCkgew0KICAgIC8vIFNob3J0Y3V0cw0KICAgIHZhciBDID0gQ3J5cHRvSlM7DQogICAgdmFyIENfbGliID0gQy5saWI7DQogICAgdmFyIEJsb2NrQ2lwaGVyID0gQ19saWIuQmxvY2tDaXBoZXI7DQogICAgdmFyIENfYWxnbyA9IEMuYWxnbzsNCg0KICAgIC8vIExvb2t1cCB0YWJsZXMNCiAgICB2YXIgU0JPWCA9IFtdOw0KICAgIHZhciBJTlZfU0JPWCA9IFtdOw0KICAgIHZhciBTVUJfTUlYXzAgPSBbXTsNCiAgICB2YXIgU1VCX01JWF8xID0gW107DQogICAgdmFyIFNVQl9NSVhfMiA9IFtdOw0KICAgIHZhciBTVUJfTUlYXzMgPSBbXTsNCiAgICB2YXIgSU5WX1NVQl9NSVhfMCA9IFtdOw0KICAgIHZhciBJTlZfU1VCX01JWF8xID0gW107DQogICAgdmFyIElOVl9TVUJfTUlYXzIgPSBbXTsNCiAgICB2YXIgSU5WX1NVQl9NSVhfMyA9IFtdOw0KDQogICAgLy8gQ29tcHV0ZSBsb29rdXAgdGFibGVzDQogICAgKGZ1bmN0aW9uICgpIHsNCiAgICAgICAgLy8gQ29tcHV0ZSBkb3VibGUgdGFibGUNCiAgICAgICAgdmFyIGQgPSBbXTsNCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAyNTY7IGkrKykgew0KICAgICAgICAgICAgaWYgKGkgPCAxMjgpIHsNCiAgICAgICAgICAgICAgICBkW2ldID0gaSA8PCAxOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBkW2ldID0gKGkgPDwgMSkgXiAweDExYjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vIFdhbGsgR0YoMl44KQ0KICAgICAgICB2YXIgeCA9IDA7DQogICAgICAgIHZhciB4aSA9IDA7DQogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgMjU2OyBpKyspIHsNCiAgICAgICAgICAgIC8vIENvbXB1dGUgc2JveA0KICAgICAgICAgICAgdmFyIHN4ID0geGkgXiAoeGkgPDwgMSkgXiAoeGkgPDwgMikgXiAoeGkgPDwgMykgXiAoeGkgPDwgNCk7DQogICAgICAgICAgICBzeCA9IChzeCA+Pj4gOCkgXiAoc3ggJiAweGZmKSBeIDB4NjM7DQogICAgICAgICAgICBTQk9YW3hdID0gc3g7DQogICAgICAgICAgICBJTlZfU0JPWFtzeF0gPSB4Ow0KDQogICAgICAgICAgICAvLyBDb21wdXRlIG11bHRpcGxpY2F0aW9uDQogICAgICAgICAgICB2YXIgeDIgPSBkW3hdOw0KICAgICAgICAgICAgdmFyIHg0ID0gZFt4Ml07DQogICAgICAgICAgICB2YXIgeDggPSBkW3g0XTsNCg0KICAgICAgICAgICAgLy8gQ29tcHV0ZSBzdWIgYnl0ZXMsIG1peCBjb2x1bW5zIHRhYmxlcw0KICAgICAgICAgICAgdmFyIHQgPSAoZFtzeF0gKiAweDEwMSkgXiAoc3ggKiAweDEwMTAxMDApOw0KICAgICAgICAgICAgU1VCX01JWF8wW3hdID0gKHQgPDwgMjQpIHwgKHQgPj4+IDgpOw0KICAgICAgICAgICAgU1VCX01JWF8xW3hdID0gKHQgPDwgMTYpIHwgKHQgPj4+IDE2KTsNCiAgICAgICAgICAgIFNVQl9NSVhfMlt4XSA9ICh0IDw8IDgpICB8ICh0ID4+PiAyNCk7DQogICAgICAgICAgICBTVUJfTUlYXzNbeF0gPSB0Ow0KDQogICAgICAgICAgICAvLyBDb21wdXRlIGludiBzdWIgYnl0ZXMsIGludiBtaXggY29sdW1ucyB0YWJsZXMNCiAgICAgICAgICAgIHZhciB0ID0gKHg4ICogMHgxMDEwMTAxKSBeICh4NCAqIDB4MTAwMDEpIF4gKHgyICogMHgxMDEpIF4gKHggKiAweDEwMTAxMDApOw0KICAgICAgICAgICAgSU5WX1NVQl9NSVhfMFtzeF0gPSAodCA8PCAyNCkgfCAodCA+Pj4gOCk7DQogICAgICAgICAgICBJTlZfU1VCX01JWF8xW3N4XSA9ICh0IDw8IDE2KSB8ICh0ID4+PiAxNik7DQogICAgICAgICAgICBJTlZfU1VCX01JWF8yW3N4XSA9ICh0IDw8IDgpICB8ICh0ID4+PiAyNCk7DQogICAgICAgICAgICBJTlZfU1VCX01JWF8zW3N4XSA9IHQ7DQoNCiAgICAgICAgICAgIC8vIENvbXB1dGUgbmV4dCBjb3VudGVyDQogICAgICAgICAgICBpZiAoIXgpIHsNCiAgICAgICAgICAgICAgICB4ID0geGkgPSAxOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICB4ID0geDIgXiBkW2RbZFt4OCBeIHgyXV1dOw0KICAgICAgICAgICAgICAgIHhpIF49IGRbZFt4aV1dOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfSgpKTsNCg0KICAgIC8vIFByZWNvbXB1dGVkIFJjb24gbG9va3VwDQogICAgdmFyIFJDT04gPSBbMHgwMCwgMHgwMSwgMHgwMiwgMHgwNCwgMHgwOCwgMHgxMCwgMHgyMCwgMHg0MCwgMHg4MCwgMHgxYiwgMHgzNl07DQoNCiAgICAvKioNCiAgICAgKiBBRVMgYmxvY2sgY2lwaGVyIGFsZ29yaXRobS4NCiAgICAgKi8NCiAgICB2YXIgQUVTID0gQ19hbGdvLkFFUyA9IEJsb2NrQ2lwaGVyLmV4dGVuZCh7DQogICAgICAgIF9kb1Jlc2V0OiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAvLyBTaG9ydGN1dHMNCiAgICAgICAgICAgIHZhciBrZXkgPSB0aGlzLl9rZXk7DQogICAgICAgICAgICB2YXIga2V5V29yZHMgPSBrZXkud29yZHM7DQogICAgICAgICAgICB2YXIga2V5U2l6ZSA9IGtleS5zaWdCeXRlcyAvIDQ7DQoNCiAgICAgICAgICAgIC8vIENvbXB1dGUgbnVtYmVyIG9mIHJvdW5kcw0KICAgICAgICAgICAgdmFyIG5Sb3VuZHMgPSB0aGlzLl9uUm91bmRzID0ga2V5U2l6ZSArIDYNCg0KICAgICAgICAgICAgLy8gQ29tcHV0ZSBudW1iZXIgb2Yga2V5IHNjaGVkdWxlIHJvd3MNCiAgICAgICAgICAgIHZhciBrc1Jvd3MgPSAoblJvdW5kcyArIDEpICogNDsNCg0KICAgICAgICAgICAgLy8gQ29tcHV0ZSBrZXkgc2NoZWR1bGUNCiAgICAgICAgICAgIHZhciBrZXlTY2hlZHVsZSA9IHRoaXMuX2tleVNjaGVkdWxlID0gW107DQogICAgICAgICAgICBmb3IgKHZhciBrc1JvdyA9IDA7IGtzUm93IDwga3NSb3dzOyBrc1JvdysrKSB7DQogICAgICAgICAgICAgICAgaWYgKGtzUm93IDwga2V5U2l6ZSkgew0KICAgICAgICAgICAgICAgICAgICBrZXlTY2hlZHVsZVtrc1Jvd10gPSBrZXlXb3Jkc1trc1Jvd107DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIHQgPSBrZXlTY2hlZHVsZVtrc1JvdyAtIDFdOw0KDQogICAgICAgICAgICAgICAgICAgIGlmICghKGtzUm93ICUga2V5U2l6ZSkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJvdCB3b3JkDQogICAgICAgICAgICAgICAgICAgICAgICB0ID0gKHQgPDwgOCkgfCAodCA+Pj4gMjQpOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAvLyBTdWIgd29yZA0KICAgICAgICAgICAgICAgICAgICAgICAgdCA9IChTQk9YW3QgPj4+IDI0XSA8PCAyNCkgfCAoU0JPWFsodCA+Pj4gMTYpICYgMHhmZl0gPDwgMTYpIHwgKFNCT1hbKHQgPj4+IDgpICYgMHhmZl0gPDwgOCkgfCBTQk9YW3QgJiAweGZmXTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gTWl4IFJjb24NCiAgICAgICAgICAgICAgICAgICAgICAgIHQgXj0gUkNPTlsoa3NSb3cgLyBrZXlTaXplKSB8IDBdIDw8IDI0Ow0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGtleVNpemUgPiA2ICYmIGtzUm93ICUga2V5U2l6ZSA9PSA0KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBTdWIgd29yZA0KICAgICAgICAgICAgICAgICAgICAgICAgdCA9IChTQk9YW3QgPj4+IDI0XSA8PCAyNCkgfCAoU0JPWFsodCA+Pj4gMTYpICYgMHhmZl0gPDwgMTYpIHwgKFNCT1hbKHQgPj4+IDgpICYgMHhmZl0gPDwgOCkgfCBTQk9YW3QgJiAweGZmXTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgIGtleVNjaGVkdWxlW2tzUm93XSA9IGtleVNjaGVkdWxlW2tzUm93IC0ga2V5U2l6ZV0gXiB0Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gQ29tcHV0ZSBpbnYga2V5IHNjaGVkdWxlDQogICAgICAgICAgICB2YXIgaW52S2V5U2NoZWR1bGUgPSB0aGlzLl9pbnZLZXlTY2hlZHVsZSA9IFtdOw0KICAgICAgICAgICAgZm9yICh2YXIgaW52S3NSb3cgPSAwOyBpbnZLc1JvdyA8IGtzUm93czsgaW52S3NSb3crKykgew0KICAgICAgICAgICAgICAgIHZhciBrc1JvdyA9IGtzUm93cyAtIGludktzUm93Ow0KDQogICAgICAgICAgICAgICAgaWYgKGludktzUm93ICUgNCkgew0KICAgICAgICAgICAgICAgICAgICB2YXIgdCA9IGtleVNjaGVkdWxlW2tzUm93XTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICB2YXIgdCA9IGtleVNjaGVkdWxlW2tzUm93IC0gNF07DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgaWYgKGludktzUm93IDwgNCB8fCBrc1JvdyA8PSA0KSB7DQogICAgICAgICAgICAgICAgICAgIGludktleVNjaGVkdWxlW2ludktzUm93XSA9IHQ7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgaW52S2V5U2NoZWR1bGVbaW52S3NSb3ddID0gSU5WX1NVQl9NSVhfMFtTQk9YW3QgPj4+IDI0XV0gXiBJTlZfU1VCX01JWF8xW1NCT1hbKHQgPj4+IDE2KSAmIDB4ZmZdXSBeDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIElOVl9TVUJfTUlYXzJbU0JPWFsodCA+Pj4gOCkgJiAweGZmXV0gXiBJTlZfU1VCX01JWF8zW1NCT1hbdCAmIDB4ZmZdXTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0sDQoNCiAgICAgICAgZW5jcnlwdEJsb2NrOiBmdW5jdGlvbiAoTSwgb2Zmc2V0KSB7DQogICAgICAgICAgICB0aGlzLl9kb0NyeXB0QmxvY2soTSwgb2Zmc2V0LCB0aGlzLl9rZXlTY2hlZHVsZSwgU1VCX01JWF8wLCBTVUJfTUlYXzEsIFNVQl9NSVhfMiwgU1VCX01JWF8zLCBTQk9YKTsNCiAgICAgICAgfSwNCg0KICAgICAgICBkZWNyeXB0QmxvY2s6IGZ1bmN0aW9uIChNLCBvZmZzZXQpIHsNCiAgICAgICAgICAgIC8vIFN3YXAgMm5kIGFuZCA0dGggcm93cw0KICAgICAgICAgICAgdmFyIHQgPSBNW29mZnNldCArIDFdOw0KICAgICAgICAgICAgTVtvZmZzZXQgKyAxXSA9IE1bb2Zmc2V0ICsgM107DQogICAgICAgICAgICBNW29mZnNldCArIDNdID0gdDsNCg0KICAgICAgICAgICAgdGhpcy5fZG9DcnlwdEJsb2NrKE0sIG9mZnNldCwgdGhpcy5faW52S2V5U2NoZWR1bGUsIElOVl9TVUJfTUlYXzAsIElOVl9TVUJfTUlYXzEsIElOVl9TVUJfTUlYXzIsIElOVl9TVUJfTUlYXzMsIElOVl9TQk9YKTsNCg0KICAgICAgICAgICAgLy8gSW52IHN3YXAgMm5kIGFuZCA0dGggcm93cw0KICAgICAgICAgICAgdmFyIHQgPSBNW29mZnNldCArIDFdOw0KICAgICAgICAgICAgTVtvZmZzZXQgKyAxXSA9IE1bb2Zmc2V0ICsgM107DQogICAgICAgICAgICBNW29mZnNldCArIDNdID0gdDsNCiAgICAgICAgfSwNCg0KICAgICAgICBfZG9DcnlwdEJsb2NrOiBmdW5jdGlvbiAoTSwgb2Zmc2V0LCBrZXlTY2hlZHVsZSwgU1VCX01JWF8wLCBTVUJfTUlYXzEsIFNVQl9NSVhfMiwgU1VCX01JWF8zLCBTQk9YKSB7DQogICAgICAgICAgICAvLyBTaG9ydGN1dA0KICAgICAgICAgICAgdmFyIG5Sb3VuZHMgPSB0aGlzLl9uUm91bmRzOw0KDQogICAgICAgICAgICAvLyBHZXQgaW5wdXQsIGFkZCByb3VuZCBrZXkNCiAgICAgICAgICAgIHZhciBzMCA9IE1bb2Zmc2V0XSAgICAgXiBrZXlTY2hlZHVsZVswXTsNCiAgICAgICAgICAgIHZhciBzMSA9IE1bb2Zmc2V0ICsgMV0gXiBrZXlTY2hlZHVsZVsxXTsNCiAgICAgICAgICAgIHZhciBzMiA9IE1bb2Zmc2V0ICsgMl0gXiBrZXlTY2hlZHVsZVsyXTsNCiAgICAgICAgICAgIHZhciBzMyA9IE1bb2Zmc2V0ICsgM10gXiBrZXlTY2hlZHVsZVszXTsNCg0KICAgICAgICAgICAgLy8gS2V5IHNjaGVkdWxlIHJvdyBjb3VudGVyDQogICAgICAgICAgICB2YXIga3NSb3cgPSA0Ow0KDQogICAgICAgICAgICAvLyBSb3VuZHMNCiAgICAgICAgICAgIGZvciAodmFyIHJvdW5kID0gMTsgcm91bmQgPCBuUm91bmRzOyByb3VuZCsrKSB7DQogICAgICAgICAgICAgICAgLy8gU2hpZnQgcm93cywgc3ViIGJ5dGVzLCBtaXggY29sdW1ucywgYWRkIHJvdW5kIGtleQ0KICAgICAgICAgICAgICAgIHZhciB0MCA9IFNVQl9NSVhfMFtzMCA+Pj4gMjRdIF4gU1VCX01JWF8xWyhzMSA+Pj4gMTYpICYgMHhmZl0gXiBTVUJfTUlYXzJbKHMyID4+PiA4KSAmIDB4ZmZdIF4gU1VCX01JWF8zW3MzICYgMHhmZl0gXiBrZXlTY2hlZHVsZVtrc1JvdysrXTsNCiAgICAgICAgICAgICAgICB2YXIgdDEgPSBTVUJfTUlYXzBbczEgPj4+IDI0XSBeIFNVQl9NSVhfMVsoczIgPj4+IDE2KSAmIDB4ZmZdIF4gU1VCX01JWF8yWyhzMyA+Pj4gOCkgJiAweGZmXSBeIFNVQl9NSVhfM1tzMCAmIDB4ZmZdIF4ga2V5U2NoZWR1bGVba3NSb3crK107DQogICAgICAgICAgICAgICAgdmFyIHQyID0gU1VCX01JWF8wW3MyID4+PiAyNF0gXiBTVUJfTUlYXzFbKHMzID4+PiAxNikgJiAweGZmXSBeIFNVQl9NSVhfMlsoczAgPj4+IDgpICYgMHhmZl0gXiBTVUJfTUlYXzNbczEgJiAweGZmXSBeIGtleVNjaGVkdWxlW2tzUm93KytdOw0KICAgICAgICAgICAgICAgIHZhciB0MyA9IFNVQl9NSVhfMFtzMyA+Pj4gMjRdIF4gU1VCX01JWF8xWyhzMCA+Pj4gMTYpICYgMHhmZl0gXiBTVUJfTUlYXzJbKHMxID4+PiA4KSAmIDB4ZmZdIF4gU1VCX01JWF8zW3MyICYgMHhmZl0gXiBrZXlTY2hlZHVsZVtrc1JvdysrXTsNCg0KICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBzdGF0ZQ0KICAgICAgICAgICAgICAgIHMwID0gdDA7DQogICAgICAgICAgICAgICAgczEgPSB0MTsNCiAgICAgICAgICAgICAgICBzMiA9IHQyOw0KICAgICAgICAgICAgICAgIHMzID0gdDM7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIFNoaWZ0IHJvd3MsIHN1YiBieXRlcywgYWRkIHJvdW5kIGtleQ0KICAgICAgICAgICAgdmFyIHQwID0gKChTQk9YW3MwID4+PiAyNF0gPDwgMjQpIHwgKFNCT1hbKHMxID4+PiAxNikgJiAweGZmXSA8PCAxNikgfCAoU0JPWFsoczIgPj4+IDgpICYgMHhmZl0gPDwgOCkgfCBTQk9YW3MzICYgMHhmZl0pIF4ga2V5U2NoZWR1bGVba3NSb3crK107DQogICAgICAgICAgICB2YXIgdDEgPSAoKFNCT1hbczEgPj4+IDI0XSA8PCAyNCkgfCAoU0JPWFsoczIgPj4+IDE2KSAmIDB4ZmZdIDw8IDE2KSB8IChTQk9YWyhzMyA+Pj4gOCkgJiAweGZmXSA8PCA4KSB8IFNCT1hbczAgJiAweGZmXSkgXiBrZXlTY2hlZHVsZVtrc1JvdysrXTsNCiAgICAgICAgICAgIHZhciB0MiA9ICgoU0JPWFtzMiA+Pj4gMjRdIDw8IDI0KSB8IChTQk9YWyhzMyA+Pj4gMTYpICYgMHhmZl0gPDwgMTYpIHwgKFNCT1hbKHMwID4+PiA4KSAmIDB4ZmZdIDw8IDgpIHwgU0JPWFtzMSAmIDB4ZmZdKSBeIGtleVNjaGVkdWxlW2tzUm93KytdOw0KICAgICAgICAgICAgdmFyIHQzID0gKChTQk9YW3MzID4+PiAyNF0gPDwgMjQpIHwgKFNCT1hbKHMwID4+PiAxNikgJiAweGZmXSA8PCAxNikgfCAoU0JPWFsoczEgPj4+IDgpICYgMHhmZl0gPDwgOCkgfCBTQk9YW3MyICYgMHhmZl0pIF4ga2V5U2NoZWR1bGVba3NSb3crK107DQoNCiAgICAgICAgICAgIC8vIFNldCBvdXRwdXQNCiAgICAgICAgICAgIE1bb2Zmc2V0XSAgICAgPSB0MDsNCiAgICAgICAgICAgIE1bb2Zmc2V0ICsgMV0gPSB0MTsNCiAgICAgICAgICAgIE1bb2Zmc2V0ICsgMl0gPSB0MjsNCiAgICAgICAgICAgIE1bb2Zmc2V0ICsgM10gPSB0MzsNCiAgICAgICAgfSwNCg0KICAgICAgICBrZXlTaXplOiAyNTYvMzINCiAgICB9KTsNCg0KICAgIC8qKg0KICAgICAqIFNob3J0Y3V0IGZ1bmN0aW9ucyB0byB0aGUgY2lwaGVyJ3Mgb2JqZWN0IGludGVyZmFjZS4NCiAgICAgKg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiAgICAgdmFyIGNpcGhlcnRleHQgPSBDcnlwdG9KUy5BRVMuZW5jcnlwdChtZXNzYWdlLCBrZXksIGNmZyk7DQogICAgICogICAgIHZhciBwbGFpbnRleHQgID0gQ3J5cHRvSlMuQUVTLmRlY3J5cHQoY2lwaGVydGV4dCwga2V5LCBjZmcpOw0KICAgICAqLw0KICAgIEMuQUVTID0gQmxvY2tDaXBoZXIuX2NyZWF0ZUhlbHBlcihBRVMpOw0KfSgpKTsNCgpkZWZpbmUoImNyeXB0by5hZXMiLCBbImNyeXB0by5jaXBoZXItY29yZSJdLCBmdW5jdGlvbigpe30pOwoKLyoKQ3J5cHRvSlMgdjMuMS4yCmNvZGUuZ29vZ2xlLmNvbS9wL2NyeXB0by1qcwooYykgMjAwOS0yMDEzIGJ5IEplZmYgTW90dC4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KY29kZS5nb29nbGUuY29tL3AvY3J5cHRvLWpzL3dpa2kvTGljZW5zZQoqLwooZnVuY3Rpb24gKCkgew0KICAgIC8vIFNob3J0Y3V0cw0KICAgIHZhciBDID0gQ3J5cHRvSlM7DQogICAgdmFyIENfbGliID0gQy5saWI7DQogICAgdmFyIFdvcmRBcnJheSA9IENfbGliLldvcmRBcnJheTsNCiAgICB2YXIgSGFzaGVyID0gQ19saWIuSGFzaGVyOw0KICAgIHZhciBDX2FsZ28gPSBDLmFsZ287DQoNCiAgICAvLyBSZXVzYWJsZSBvYmplY3QNCiAgICB2YXIgVyA9IFtdOw0KDQogICAgLyoqDQogICAgICogU0hBLTEgaGFzaCBhbGdvcml0aG0uDQogICAgICovDQogICAgdmFyIFNIQTEgPSBDX2FsZ28uU0hBMSA9IEhhc2hlci5leHRlbmQoew0KICAgICAgICBfZG9SZXNldDogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgdGhpcy5faGFzaCA9IG5ldyBXb3JkQXJyYXkuaW5pdChbDQogICAgICAgICAgICAgICAgMHg2NzQ1MjMwMSwgMHhlZmNkYWI4OSwNCiAgICAgICAgICAgICAgICAweDk4YmFkY2ZlLCAweDEwMzI1NDc2LA0KICAgICAgICAgICAgICAgIDB4YzNkMmUxZjANCiAgICAgICAgICAgIF0pOw0KICAgICAgICB9LA0KDQogICAgICAgIF9kb1Byb2Nlc3NCbG9jazogZnVuY3Rpb24gKE0sIG9mZnNldCkgew0KICAgICAgICAgICAgLy8gU2hvcnRjdXQNCiAgICAgICAgICAgIHZhciBIID0gdGhpcy5faGFzaC53b3JkczsNCg0KICAgICAgICAgICAgLy8gV29ya2luZyB2YXJpYWJsZXMNCiAgICAgICAgICAgIHZhciBhID0gSFswXTsNCiAgICAgICAgICAgIHZhciBiID0gSFsxXTsNCiAgICAgICAgICAgIHZhciBjID0gSFsyXTsNCiAgICAgICAgICAgIHZhciBkID0gSFszXTsNCiAgICAgICAgICAgIHZhciBlID0gSFs0XTsNCg0KICAgICAgICAgICAgLy8gQ29tcHV0YXRpb24NCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgODA7IGkrKykgew0KICAgICAgICAgICAgICAgIGlmIChpIDwgMTYpIHsNCiAgICAgICAgICAgICAgICAgICAgV1tpXSA9IE1bb2Zmc2V0ICsgaV0gfCAwOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIHZhciBuID0gV1tpIC0gM10gXiBXW2kgLSA4XSBeIFdbaSAtIDE0XSBeIFdbaSAtIDE2XTsNCiAgICAgICAgICAgICAgICAgICAgV1tpXSA9IChuIDw8IDEpIHwgKG4gPj4+IDMxKTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICB2YXIgdCA9ICgoYSA8PCA1KSB8IChhID4+PiAyNykpICsgZSArIFdbaV07DQogICAgICAgICAgICAgICAgaWYgKGkgPCAyMCkgew0KICAgICAgICAgICAgICAgICAgICB0ICs9ICgoYiAmIGMpIHwgKH5iICYgZCkpICsgMHg1YTgyNzk5OTsNCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGkgPCA0MCkgew0KICAgICAgICAgICAgICAgICAgICB0ICs9IChiIF4gYyBeIGQpICsgMHg2ZWQ5ZWJhMTsNCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGkgPCA2MCkgew0KICAgICAgICAgICAgICAgICAgICB0ICs9ICgoYiAmIGMpIHwgKGIgJiBkKSB8IChjICYgZCkpIC0gMHg3MGU0NDMyNDsNCiAgICAgICAgICAgICAgICB9IGVsc2UgLyogaWYgKGkgPCA4MCkgKi8gew0KICAgICAgICAgICAgICAgICAgICB0ICs9IChiIF4gYyBeIGQpIC0gMHgzNTlkM2UyYTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBlID0gZDsNCiAgICAgICAgICAgICAgICBkID0gYzsNCiAgICAgICAgICAgICAgICBjID0gKGIgPDwgMzApIHwgKGIgPj4+IDIpOw0KICAgICAgICAgICAgICAgIGIgPSBhOw0KICAgICAgICAgICAgICAgIGEgPSB0Ow0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBJbnRlcm1lZGlhdGUgaGFzaCB2YWx1ZQ0KICAgICAgICAgICAgSFswXSA9IChIWzBdICsgYSkgfCAwOw0KICAgICAgICAgICAgSFsxXSA9IChIWzFdICsgYikgfCAwOw0KICAgICAgICAgICAgSFsyXSA9IChIWzJdICsgYykgfCAwOw0KICAgICAgICAgICAgSFszXSA9IChIWzNdICsgZCkgfCAwOw0KICAgICAgICAgICAgSFs0XSA9IChIWzRdICsgZSkgfCAwOw0KICAgICAgICB9LA0KDQogICAgICAgIF9kb0ZpbmFsaXplOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAvLyBTaG9ydGN1dHMNCiAgICAgICAgICAgIHZhciBkYXRhID0gdGhpcy5fZGF0YTsNCiAgICAgICAgICAgIHZhciBkYXRhV29yZHMgPSBkYXRhLndvcmRzOw0KDQogICAgICAgICAgICB2YXIgbkJpdHNUb3RhbCA9IHRoaXMuX25EYXRhQnl0ZXMgKiA4Ow0KICAgICAgICAgICAgdmFyIG5CaXRzTGVmdCA9IGRhdGEuc2lnQnl0ZXMgKiA4Ow0KDQogICAgICAgICAgICAvLyBBZGQgcGFkZGluZw0KICAgICAgICAgICAgZGF0YVdvcmRzW25CaXRzTGVmdCA+Pj4gNV0gfD0gMHg4MCA8PCAoMjQgLSBuQml0c0xlZnQgJSAzMik7DQogICAgICAgICAgICBkYXRhV29yZHNbKCgobkJpdHNMZWZ0ICsgNjQpID4+PiA5KSA8PCA0KSArIDE0XSA9IE1hdGguZmxvb3IobkJpdHNUb3RhbCAvIDB4MTAwMDAwMDAwKTsNCiAgICAgICAgICAgIGRhdGFXb3Jkc1soKChuQml0c0xlZnQgKyA2NCkgPj4+IDkpIDw8IDQpICsgMTVdID0gbkJpdHNUb3RhbDsNCiAgICAgICAgICAgIGRhdGEuc2lnQnl0ZXMgPSBkYXRhV29yZHMubGVuZ3RoICogNDsNCg0KICAgICAgICAgICAgLy8gSGFzaCBmaW5hbCBibG9ja3MNCiAgICAgICAgICAgIHRoaXMuX3Byb2Nlc3MoKTsNCg0KICAgICAgICAgICAgLy8gUmV0dXJuIGZpbmFsIGNvbXB1dGVkIGhhc2gNCiAgICAgICAgICAgIHJldHVybiB0aGlzLl9oYXNoOw0KICAgICAgICB9LA0KDQogICAgICAgIGNsb25lOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICB2YXIgY2xvbmUgPSBIYXNoZXIuY2xvbmUuY2FsbCh0aGlzKTsNCiAgICAgICAgICAgIGNsb25lLl9oYXNoID0gdGhpcy5faGFzaC5jbG9uZSgpOw0KDQogICAgICAgICAgICByZXR1cm4gY2xvbmU7DQogICAgICAgIH0NCiAgICB9KTsNCg0KICAgIC8qKg0KICAgICAqIFNob3J0Y3V0IGZ1bmN0aW9uIHRvIHRoZSBoYXNoZXIncyBvYmplY3QgaW50ZXJmYWNlLg0KICAgICAqDQogICAgICogQHBhcmFtIHtXb3JkQXJyYXl8c3RyaW5nfSBtZXNzYWdlIFRoZSBtZXNzYWdlIHRvIGhhc2guDQogICAgICoNCiAgICAgKiBAcmV0dXJuIHtXb3JkQXJyYXl9IFRoZSBoYXNoLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqICAgICB2YXIgaGFzaCA9IENyeXB0b0pTLlNIQTEoJ21lc3NhZ2UnKTsNCiAgICAgKiAgICAgdmFyIGhhc2ggPSBDcnlwdG9KUy5TSEExKHdvcmRBcnJheSk7DQogICAgICovDQogICAgQy5TSEExID0gSGFzaGVyLl9jcmVhdGVIZWxwZXIoU0hBMSk7DQoNCiAgICAvKioNCiAgICAgKiBTaG9ydGN1dCBmdW5jdGlvbiB0byB0aGUgSE1BQydzIG9iamVjdCBpbnRlcmZhY2UuDQogICAgICoNCiAgICAgKiBAcGFyYW0ge1dvcmRBcnJheXxzdHJpbmd9IG1lc3NhZ2UgVGhlIG1lc3NhZ2UgdG8gaGFzaC4NCiAgICAgKiBAcGFyYW0ge1dvcmRBcnJheXxzdHJpbmd9IGtleSBUaGUgc2VjcmV0IGtleS4NCiAgICAgKg0KICAgICAqIEByZXR1cm4ge1dvcmRBcnJheX0gVGhlIEhNQUMuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICoNCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogICAgIHZhciBobWFjID0gQ3J5cHRvSlMuSG1hY1NIQTEobWVzc2FnZSwga2V5KTsNCiAgICAgKi8NCiAgICBDLkhtYWNTSEExID0gSGFzaGVyLl9jcmVhdGVIbWFjSGVscGVyKFNIQTEpOw0KfSgpKTsNCgpkZWZpbmUoImNyeXB0by5zaGExIiwgWyJjcnlwdG8uY29yZSJdLCBmdW5jdGlvbigpe30pOwoKLyoKQ3J5cHRvSlMgdjMuMS4yCmNvZGUuZ29vZ2xlLmNvbS9wL2NyeXB0by1qcwooYykgMjAwOS0yMDEzIGJ5IEplZmYgTW90dC4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KY29kZS5nb29nbGUuY29tL3AvY3J5cHRvLWpzL3dpa2kvTGljZW5zZQoqLwooZnVuY3Rpb24gKE1hdGgpIHsNCiAgICAvLyBTaG9ydGN1dHMNCiAgICB2YXIgQyA9IENyeXB0b0pTOw0KICAgIHZhciBDX2xpYiA9IEMubGliOw0KICAgIHZhciBXb3JkQXJyYXkgPSBDX2xpYi5Xb3JkQXJyYXk7DQogICAgdmFyIEhhc2hlciA9IENfbGliLkhhc2hlcjsNCiAgICB2YXIgQ19hbGdvID0gQy5hbGdvOw0KDQogICAgLy8gSW5pdGlhbGl6YXRpb24gYW5kIHJvdW5kIGNvbnN0YW50cyB0YWJsZXMNCiAgICB2YXIgSCA9IFtdOw0KICAgIHZhciBLID0gW107DQoNCiAgICAvLyBDb21wdXRlIGNvbnN0YW50cw0KICAgIChmdW5jdGlvbiAoKSB7DQogICAgICAgIGZ1bmN0aW9uIGlzUHJpbWUobikgew0KICAgICAgICAgICAgdmFyIHNxcnROID0gTWF0aC5zcXJ0KG4pOw0KICAgICAgICAgICAgZm9yICh2YXIgZmFjdG9yID0gMjsgZmFjdG9yIDw9IHNxcnROOyBmYWN0b3IrKykgew0KICAgICAgICAgICAgICAgIGlmICghKG4gJSBmYWN0b3IpKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICB9DQoNCiAgICAgICAgZnVuY3Rpb24gZ2V0RnJhY3Rpb25hbEJpdHMobikgew0KICAgICAgICAgICAgcmV0dXJuICgobiAtIChuIHwgMCkpICogMHgxMDAwMDAwMDApIHwgMDsNCiAgICAgICAgfQ0KDQogICAgICAgIHZhciBuID0gMjsNCiAgICAgICAgdmFyIG5QcmltZSA9IDA7DQogICAgICAgIHdoaWxlIChuUHJpbWUgPCA2NCkgew0KICAgICAgICAgICAgaWYgKGlzUHJpbWUobikpIHsNCiAgICAgICAgICAgICAgICBpZiAoblByaW1lIDwgOCkgew0KICAgICAgICAgICAgICAgICAgICBIW25QcmltZV0gPSBnZXRGcmFjdGlvbmFsQml0cyhNYXRoLnBvdyhuLCAxIC8gMikpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBLW25QcmltZV0gPSBnZXRGcmFjdGlvbmFsQml0cyhNYXRoLnBvdyhuLCAxIC8gMykpOw0KDQogICAgICAgICAgICAgICAgblByaW1lKys7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIG4rKzsNCiAgICAgICAgfQ0KICAgIH0oKSk7DQoNCiAgICAvLyBSZXVzYWJsZSBvYmplY3QNCiAgICB2YXIgVyA9IFtdOw0KDQogICAgLyoqDQogICAgICogU0hBLTI1NiBoYXNoIGFsZ29yaXRobS4NCiAgICAgKi8NCiAgICB2YXIgU0hBMjU2ID0gQ19hbGdvLlNIQTI1NiA9IEhhc2hlci5leHRlbmQoew0KICAgICAgICBfZG9SZXNldDogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgdGhpcy5faGFzaCA9IG5ldyBXb3JkQXJyYXkuaW5pdChILnNsaWNlKDApKTsNCiAgICAgICAgfSwNCg0KICAgICAgICBfZG9Qcm9jZXNzQmxvY2s6IGZ1bmN0aW9uIChNLCBvZmZzZXQpIHsNCiAgICAgICAgICAgIC8vIFNob3J0Y3V0DQogICAgICAgICAgICB2YXIgSCA9IHRoaXMuX2hhc2gud29yZHM7DQoNCiAgICAgICAgICAgIC8vIFdvcmtpbmcgdmFyaWFibGVzDQogICAgICAgICAgICB2YXIgYSA9IEhbMF07DQogICAgICAgICAgICB2YXIgYiA9IEhbMV07DQogICAgICAgICAgICB2YXIgYyA9IEhbMl07DQogICAgICAgICAgICB2YXIgZCA9IEhbM107DQogICAgICAgICAgICB2YXIgZSA9IEhbNF07DQogICAgICAgICAgICB2YXIgZiA9IEhbNV07DQogICAgICAgICAgICB2YXIgZyA9IEhbNl07DQogICAgICAgICAgICB2YXIgaCA9IEhbN107DQoNCiAgICAgICAgICAgIC8vIENvbXB1dGF0aW9uDQogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDY0OyBpKyspIHsNCiAgICAgICAgICAgICAgICBpZiAoaSA8IDE2KSB7DQogICAgICAgICAgICAgICAgICAgIFdbaV0gPSBNW29mZnNldCArIGldIHwgMDsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICB2YXIgZ2FtbWEweCA9IFdbaSAtIDE1XTsNCiAgICAgICAgICAgICAgICAgICAgdmFyIGdhbW1hMCAgPSAoKGdhbW1hMHggPDwgMjUpIHwgKGdhbW1hMHggPj4+IDcpKSAgXg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICgoZ2FtbWEweCA8PCAxNCkgfCAoZ2FtbWEweCA+Pj4gMTgpKSBeDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChnYW1tYTB4ID4+PiAzKTsNCg0KICAgICAgICAgICAgICAgICAgICB2YXIgZ2FtbWExeCA9IFdbaSAtIDJdOw0KICAgICAgICAgICAgICAgICAgICB2YXIgZ2FtbWExICA9ICgoZ2FtbWExeCA8PCAxNSkgfCAoZ2FtbWExeCA+Pj4gMTcpKSBeDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKChnYW1tYTF4IDw8IDEzKSB8IChnYW1tYTF4ID4+PiAxOSkpIF4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGdhbW1hMXggPj4+IDEwKTsNCg0KICAgICAgICAgICAgICAgICAgICBXW2ldID0gZ2FtbWEwICsgV1tpIC0gN10gKyBnYW1tYTEgKyBXW2kgLSAxNl07DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgdmFyIGNoICA9IChlICYgZikgXiAofmUgJiBnKTsNCiAgICAgICAgICAgICAgICB2YXIgbWFqID0gKGEgJiBiKSBeIChhICYgYykgXiAoYiAmIGMpOw0KDQogICAgICAgICAgICAgICAgdmFyIHNpZ21hMCA9ICgoYSA8PCAzMCkgfCAoYSA+Pj4gMikpIF4gKChhIDw8IDE5KSB8IChhID4+PiAxMykpIF4gKChhIDw8IDEwKSB8IChhID4+PiAyMikpOw0KICAgICAgICAgICAgICAgIHZhciBzaWdtYTEgPSAoKGUgPDwgMjYpIHwgKGUgPj4+IDYpKSBeICgoZSA8PCAyMSkgfCAoZSA+Pj4gMTEpKSBeICgoZSA8PCA3KSAgfCAoZSA+Pj4gMjUpKTsNCg0KICAgICAgICAgICAgICAgIHZhciB0MSA9IGggKyBzaWdtYTEgKyBjaCArIEtbaV0gKyBXW2ldOw0KICAgICAgICAgICAgICAgIHZhciB0MiA9IHNpZ21hMCArIG1hajsNCg0KICAgICAgICAgICAgICAgIGggPSBnOw0KICAgICAgICAgICAgICAgIGcgPSBmOw0KICAgICAgICAgICAgICAgIGYgPSBlOw0KICAgICAgICAgICAgICAgIGUgPSAoZCArIHQxKSB8IDA7DQogICAgICAgICAgICAgICAgZCA9IGM7DQogICAgICAgICAgICAgICAgYyA9IGI7DQogICAgICAgICAgICAgICAgYiA9IGE7DQogICAgICAgICAgICAgICAgYSA9ICh0MSArIHQyKSB8IDA7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIEludGVybWVkaWF0ZSBoYXNoIHZhbHVlDQogICAgICAgICAgICBIWzBdID0gKEhbMF0gKyBhKSB8IDA7DQogICAgICAgICAgICBIWzFdID0gKEhbMV0gKyBiKSB8IDA7DQogICAgICAgICAgICBIWzJdID0gKEhbMl0gKyBjKSB8IDA7DQogICAgICAgICAgICBIWzNdID0gKEhbM10gKyBkKSB8IDA7DQogICAgICAgICAgICBIWzRdID0gKEhbNF0gKyBlKSB8IDA7DQogICAgICAgICAgICBIWzVdID0gKEhbNV0gKyBmKSB8IDA7DQogICAgICAgICAgICBIWzZdID0gKEhbNl0gKyBnKSB8IDA7DQogICAgICAgICAgICBIWzddID0gKEhbN10gKyBoKSB8IDA7DQogICAgICAgIH0sDQoNCiAgICAgICAgX2RvRmluYWxpemU6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIC8vIFNob3J0Y3V0cw0KICAgICAgICAgICAgdmFyIGRhdGEgPSB0aGlzLl9kYXRhOw0KICAgICAgICAgICAgdmFyIGRhdGFXb3JkcyA9IGRhdGEud29yZHM7DQoNCiAgICAgICAgICAgIHZhciBuQml0c1RvdGFsID0gdGhpcy5fbkRhdGFCeXRlcyAqIDg7DQogICAgICAgICAgICB2YXIgbkJpdHNMZWZ0ID0gZGF0YS5zaWdCeXRlcyAqIDg7DQoNCiAgICAgICAgICAgIC8vIEFkZCBwYWRkaW5nDQogICAgICAgICAgICBkYXRhV29yZHNbbkJpdHNMZWZ0ID4+PiA1XSB8PSAweDgwIDw8ICgyNCAtIG5CaXRzTGVmdCAlIDMyKTsNCiAgICAgICAgICAgIGRhdGFXb3Jkc1soKChuQml0c0xlZnQgKyA2NCkgPj4+IDkpIDw8IDQpICsgMTRdID0gTWF0aC5mbG9vcihuQml0c1RvdGFsIC8gMHgxMDAwMDAwMDApOw0KICAgICAgICAgICAgZGF0YVdvcmRzWygoKG5CaXRzTGVmdCArIDY0KSA+Pj4gOSkgPDwgNCkgKyAxNV0gPSBuQml0c1RvdGFsOw0KICAgICAgICAgICAgZGF0YS5zaWdCeXRlcyA9IGRhdGFXb3Jkcy5sZW5ndGggKiA0Ow0KDQogICAgICAgICAgICAvLyBIYXNoIGZpbmFsIGJsb2Nrcw0KICAgICAgICAgICAgdGhpcy5fcHJvY2VzcygpOw0KDQogICAgICAgICAgICAvLyBSZXR1cm4gZmluYWwgY29tcHV0ZWQgaGFzaA0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2hhc2g7DQogICAgICAgIH0sDQoNCiAgICAgICAgY2xvbmU6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHZhciBjbG9uZSA9IEhhc2hlci5jbG9uZS5jYWxsKHRoaXMpOw0KICAgICAgICAgICAgY2xvbmUuX2hhc2ggPSB0aGlzLl9oYXNoLmNsb25lKCk7DQoNCiAgICAgICAgICAgIHJldHVybiBjbG9uZTsNCiAgICAgICAgfQ0KICAgIH0pOw0KDQogICAgLyoqDQogICAgICogU2hvcnRjdXQgZnVuY3Rpb24gdG8gdGhlIGhhc2hlcidzIG9iamVjdCBpbnRlcmZhY2UuDQogICAgICoNCiAgICAgKiBAcGFyYW0ge1dvcmRBcnJheXxzdHJpbmd9IG1lc3NhZ2UgVGhlIG1lc3NhZ2UgdG8gaGFzaC4NCiAgICAgKg0KICAgICAqIEByZXR1cm4ge1dvcmRBcnJheX0gVGhlIGhhc2guDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICoNCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogICAgIHZhciBoYXNoID0gQ3J5cHRvSlMuU0hBMjU2KCdtZXNzYWdlJyk7DQogICAgICogICAgIHZhciBoYXNoID0gQ3J5cHRvSlMuU0hBMjU2KHdvcmRBcnJheSk7DQogICAgICovDQogICAgQy5TSEEyNTYgPSBIYXNoZXIuX2NyZWF0ZUhlbHBlcihTSEEyNTYpOw0KDQogICAgLyoqDQogICAgICogU2hvcnRjdXQgZnVuY3Rpb24gdG8gdGhlIEhNQUMncyBvYmplY3QgaW50ZXJmYWNlLg0KICAgICAqDQogICAgICogQHBhcmFtIHtXb3JkQXJyYXl8c3RyaW5nfSBtZXNzYWdlIFRoZSBtZXNzYWdlIHRvIGhhc2guDQogICAgICogQHBhcmFtIHtXb3JkQXJyYXl8c3RyaW5nfSBrZXkgVGhlIHNlY3JldCBrZXkuDQogICAgICoNCiAgICAgKiBAcmV0dXJuIHtXb3JkQXJyYXl9IFRoZSBITUFDLg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqICAgICB2YXIgaG1hYyA9IENyeXB0b0pTLkhtYWNTSEEyNTYobWVzc2FnZSwga2V5KTsNCiAgICAgKi8NCiAgICBDLkhtYWNTSEEyNTYgPSBIYXNoZXIuX2NyZWF0ZUhtYWNIZWxwZXIoU0hBMjU2KTsNCn0oTWF0aCkpOw0KCmRlZmluZSgiY3J5cHRvLnNoYTI1NiIsIFsiY3J5cHRvLmNvcmUiXSwgZnVuY3Rpb24oKXt9KTsKCi8qCkNyeXB0b0pTIHYzLjEuMgpjb2RlLmdvb2dsZS5jb20vcC9jcnlwdG8tanMKKGMpIDIwMDktMjAxMyBieSBKZWZmIE1vdHQuIEFsbCByaWdodHMgcmVzZXJ2ZWQuCmNvZGUuZ29vZ2xlLmNvbS9wL2NyeXB0by1qcy93aWtpL0xpY2Vuc2UKKi8KKGZ1bmN0aW9uICgpIHsNCiAgICAvLyBTaG9ydGN1dHMNCiAgICB2YXIgQyA9IENyeXB0b0pTOw0KICAgIHZhciBDX2xpYiA9IEMubGliOw0KICAgIHZhciBCYXNlID0gQ19saWIuQmFzZTsNCiAgICB2YXIgQ19lbmMgPSBDLmVuYzsNCiAgICB2YXIgVXRmOCA9IENfZW5jLlV0Zjg7DQogICAgdmFyIENfYWxnbyA9IEMuYWxnbzsNCg0KICAgIC8qKg0KICAgICAqIEhNQUMgYWxnb3JpdGhtLg0KICAgICAqLw0KICAgIHZhciBITUFDID0gQ19hbGdvLkhNQUMgPSBCYXNlLmV4dGVuZCh7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBJbml0aWFsaXplcyBhIG5ld2x5IGNyZWF0ZWQgSE1BQy4NCiAgICAgICAgICoNCiAgICAgICAgICogQHBhcmFtIHtIYXNoZXJ9IGhhc2hlciBUaGUgaGFzaCBhbGdvcml0aG0gdG8gdXNlLg0KICAgICAgICAgKiBAcGFyYW0ge1dvcmRBcnJheXxzdHJpbmd9IGtleSBUaGUgc2VjcmV0IGtleS4NCiAgICAgICAgICoNCiAgICAgICAgICogQGV4YW1wbGUNCiAgICAgICAgICoNCiAgICAgICAgICogICAgIHZhciBobWFjSGFzaGVyID0gQ3J5cHRvSlMuYWxnby5ITUFDLmNyZWF0ZShDcnlwdG9KUy5hbGdvLlNIQTI1Niwga2V5KTsNCiAgICAgICAgICovDQogICAgICAgIGluaXQ6IGZ1bmN0aW9uIChoYXNoZXIsIGtleSkgew0KICAgICAgICAgICAgLy8gSW5pdCBoYXNoZXINCiAgICAgICAgICAgIGhhc2hlciA9IHRoaXMuX2hhc2hlciA9IG5ldyBoYXNoZXIuaW5pdCgpOw0KDQogICAgICAgICAgICAvLyBDb252ZXJ0IHN0cmluZyB0byBXb3JkQXJyYXksIGVsc2UgYXNzdW1lIFdvcmRBcnJheSBhbHJlYWR5DQogICAgICAgICAgICBpZiAodHlwZW9mIGtleSA9PSAnc3RyaW5nJykgew0KICAgICAgICAgICAgICAgIGtleSA9IFV0ZjgucGFyc2Uoa2V5KTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gU2hvcnRjdXRzDQogICAgICAgICAgICB2YXIgaGFzaGVyQmxvY2tTaXplID0gaGFzaGVyLmJsb2NrU2l6ZTsNCiAgICAgICAgICAgIHZhciBoYXNoZXJCbG9ja1NpemVCeXRlcyA9IGhhc2hlckJsb2NrU2l6ZSAqIDQ7DQoNCiAgICAgICAgICAgIC8vIEFsbG93IGFyYml0cmFyeSBsZW5ndGgga2V5cw0KICAgICAgICAgICAgaWYgKGtleS5zaWdCeXRlcyA+IGhhc2hlckJsb2NrU2l6ZUJ5dGVzKSB7DQogICAgICAgICAgICAgICAga2V5ID0gaGFzaGVyLmZpbmFsaXplKGtleSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIENsYW1wIGV4Y2VzcyBiaXRzDQogICAgICAgICAgICBrZXkuY2xhbXAoKTsNCg0KICAgICAgICAgICAgLy8gQ2xvbmUga2V5IGZvciBpbm5lciBhbmQgb3V0ZXIgcGFkcw0KICAgICAgICAgICAgdmFyIG9LZXkgPSB0aGlzLl9vS2V5ID0ga2V5LmNsb25lKCk7DQogICAgICAgICAgICB2YXIgaUtleSA9IHRoaXMuX2lLZXkgPSBrZXkuY2xvbmUoKTsNCg0KICAgICAgICAgICAgLy8gU2hvcnRjdXRzDQogICAgICAgICAgICB2YXIgb0tleVdvcmRzID0gb0tleS53b3JkczsNCiAgICAgICAgICAgIHZhciBpS2V5V29yZHMgPSBpS2V5LndvcmRzOw0KDQogICAgICAgICAgICAvLyBYT1Iga2V5cyB3aXRoIHBhZCBjb25zdGFudHMNCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaGFzaGVyQmxvY2tTaXplOyBpKyspIHsNCiAgICAgICAgICAgICAgICBvS2V5V29yZHNbaV0gXj0gMHg1YzVjNWM1YzsNCiAgICAgICAgICAgICAgICBpS2V5V29yZHNbaV0gXj0gMHgzNjM2MzYzNjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIG9LZXkuc2lnQnl0ZXMgPSBpS2V5LnNpZ0J5dGVzID0gaGFzaGVyQmxvY2tTaXplQnl0ZXM7DQoNCiAgICAgICAgICAgIC8vIFNldCBpbml0aWFsIHZhbHVlcw0KICAgICAgICAgICAgdGhpcy5yZXNldCgpOw0KICAgICAgICB9LA0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBSZXNldHMgdGhpcyBITUFDIHRvIGl0cyBpbml0aWFsIHN0YXRlLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICAgKg0KICAgICAgICAgKiAgICAgaG1hY0hhc2hlci5yZXNldCgpOw0KICAgICAgICAgKi8NCiAgICAgICAgcmVzZXQ6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIC8vIFNob3J0Y3V0DQogICAgICAgICAgICB2YXIgaGFzaGVyID0gdGhpcy5faGFzaGVyOw0KDQogICAgICAgICAgICAvLyBSZXNldA0KICAgICAgICAgICAgaGFzaGVyLnJlc2V0KCk7DQogICAgICAgICAgICBoYXNoZXIudXBkYXRlKHRoaXMuX2lLZXkpOw0KICAgICAgICB9LA0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBVcGRhdGVzIHRoaXMgSE1BQyB3aXRoIGEgbWVzc2FnZS4NCiAgICAgICAgICoNCiAgICAgICAgICogQHBhcmFtIHtXb3JkQXJyYXl8c3RyaW5nfSBtZXNzYWdlVXBkYXRlIFRoZSBtZXNzYWdlIHRvIGFwcGVuZC4NCiAgICAgICAgICoNCiAgICAgICAgICogQHJldHVybiB7SE1BQ30gVGhpcyBITUFDIGluc3RhbmNlLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICAgKg0KICAgICAgICAgKiAgICAgaG1hY0hhc2hlci51cGRhdGUoJ21lc3NhZ2UnKTsNCiAgICAgICAgICogICAgIGhtYWNIYXNoZXIudXBkYXRlKHdvcmRBcnJheSk7DQogICAgICAgICAqLw0KICAgICAgICB1cGRhdGU6IGZ1bmN0aW9uIChtZXNzYWdlVXBkYXRlKSB7DQogICAgICAgICAgICB0aGlzLl9oYXNoZXIudXBkYXRlKG1lc3NhZ2VVcGRhdGUpOw0KDQogICAgICAgICAgICAvLyBDaGFpbmFibGUNCiAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICB9LA0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBGaW5hbGl6ZXMgdGhlIEhNQUMgY29tcHV0YXRpb24uDQogICAgICAgICAqIE5vdGUgdGhhdCB0aGUgZmluYWxpemUgb3BlcmF0aW9uIGlzIGVmZmVjdGl2ZWx5IGEgZGVzdHJ1Y3RpdmUsIHJlYWQtb25jZSBvcGVyYXRpb24uDQogICAgICAgICAqDQogICAgICAgICAqIEBwYXJhbSB7V29yZEFycmF5fHN0cmluZ30gbWVzc2FnZVVwZGF0ZSAoT3B0aW9uYWwpIEEgZmluYWwgbWVzc2FnZSB1cGRhdGUuDQogICAgICAgICAqDQogICAgICAgICAqIEByZXR1cm4ge1dvcmRBcnJheX0gVGhlIEhNQUMuDQogICAgICAgICAqDQogICAgICAgICAqIEBleGFtcGxlDQogICAgICAgICAqDQogICAgICAgICAqICAgICB2YXIgaG1hYyA9IGhtYWNIYXNoZXIuZmluYWxpemUoKTsNCiAgICAgICAgICogICAgIHZhciBobWFjID0gaG1hY0hhc2hlci5maW5hbGl6ZSgnbWVzc2FnZScpOw0KICAgICAgICAgKiAgICAgdmFyIGhtYWMgPSBobWFjSGFzaGVyLmZpbmFsaXplKHdvcmRBcnJheSk7DQogICAgICAgICAqLw0KICAgICAgICBmaW5hbGl6ZTogZnVuY3Rpb24gKG1lc3NhZ2VVcGRhdGUpIHsNCiAgICAgICAgICAgIC8vIFNob3J0Y3V0DQogICAgICAgICAgICB2YXIgaGFzaGVyID0gdGhpcy5faGFzaGVyOw0KDQogICAgICAgICAgICAvLyBDb21wdXRlIEhNQUMNCiAgICAgICAgICAgIHZhciBpbm5lckhhc2ggPSBoYXNoZXIuZmluYWxpemUobWVzc2FnZVVwZGF0ZSk7DQogICAgICAgICAgICBoYXNoZXIucmVzZXQoKTsNCiAgICAgICAgICAgIHZhciBobWFjID0gaGFzaGVyLmZpbmFsaXplKHRoaXMuX29LZXkuY2xvbmUoKS5jb25jYXQoaW5uZXJIYXNoKSk7DQoNCiAgICAgICAgICAgIHJldHVybiBobWFjOw0KICAgICAgICB9DQogICAgfSk7DQp9KCkpOw0KCmRlZmluZSgiY3J5cHRvLmhtYWMiLCBbImNyeXB0by5jb3JlIl0sIGZ1bmN0aW9uKCl7fSk7CgovKgpDcnlwdG9KUyB2My4xLjIKY29kZS5nb29nbGUuY29tL3AvY3J5cHRvLWpzCihjKSAyMDA5LTIwMTMgYnkgSmVmZiBNb3R0LiBBbGwgcmlnaHRzIHJlc2VydmVkLgpjb2RlLmdvb2dsZS5jb20vcC9jcnlwdG8tanMvd2lraS9MaWNlbnNlCiovCi8qKg0KICogQSBub29wIHBhZGRpbmcgc3RyYXRlZ3kuDQogKi8NCkNyeXB0b0pTLnBhZC5Ob1BhZGRpbmcgPSB7DQogICAgcGFkOiBmdW5jdGlvbiAoKSB7DQogICAgfSwNCg0KICAgIHVucGFkOiBmdW5jdGlvbiAoKSB7DQogICAgfQ0KfTsNCgpkZWZpbmUoImNyeXB0by5wYWQtbm9wYWRkaW5nIiwgWyJjcnlwdG8uY2lwaGVyLWNvcmUiXSwgZnVuY3Rpb24oKXt9KTsKCi8qCkNyeXB0b0pTIHYzLjEuMgpjb2RlLmdvb2dsZS5jb20vcC9jcnlwdG8tanMKKGMpIDIwMDktMjAxMyBieSBKZWZmIE1vdHQuIEFsbCByaWdodHMgcmVzZXJ2ZWQuCmNvZGUuZ29vZ2xlLmNvbS9wL2NyeXB0by1qcy93aWtpL0xpY2Vuc2UKKi8KLyoqDQogKiBDb3VudGVyIGJsb2NrIG1vZGUuDQogKi8NCkNyeXB0b0pTLm1vZGUuQ1RSID0gKGZ1bmN0aW9uICgpIHsNCiAgICB2YXIgQ1RSID0gQ3J5cHRvSlMubGliLkJsb2NrQ2lwaGVyTW9kZS5leHRlbmQoKTsNCg0KICAgIHZhciBFbmNyeXB0b3IgPSBDVFIuRW5jcnlwdG9yID0gQ1RSLmV4dGVuZCh7DQogICAgICAgIHByb2Nlc3NCbG9jazogZnVuY3Rpb24gKHdvcmRzLCBvZmZzZXQpIHsNCiAgICAgICAgICAgIC8vIFNob3J0Y3V0cw0KICAgICAgICAgICAgdmFyIGNpcGhlciA9IHRoaXMuX2NpcGhlcg0KICAgICAgICAgICAgdmFyIGJsb2NrU2l6ZSA9IGNpcGhlci5ibG9ja1NpemU7DQogICAgICAgICAgICB2YXIgaXYgPSB0aGlzLl9pdjsNCiAgICAgICAgICAgIHZhciBjb3VudGVyID0gdGhpcy5fY291bnRlcjsNCg0KICAgICAgICAgICAgLy8gR2VuZXJhdGUga2V5c3RyZWFtDQogICAgICAgICAgICBpZiAoaXYpIHsNCiAgICAgICAgICAgICAgICBjb3VudGVyID0gdGhpcy5fY291bnRlciA9IGl2LnNsaWNlKDApOw0KDQogICAgICAgICAgICAgICAgLy8gUmVtb3ZlIElWIGZvciBzdWJzZXF1ZW50IGJsb2Nrcw0KICAgICAgICAgICAgICAgIHRoaXMuX2l2ID0gdW5kZWZpbmVkOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdmFyIGtleXN0cmVhbSA9IGNvdW50ZXIuc2xpY2UoMCk7DQogICAgICAgICAgICBjaXBoZXIuZW5jcnlwdEJsb2NrKGtleXN0cmVhbSwgMCk7DQoNCiAgICAgICAgICAgIC8vIEluY3JlbWVudCBjb3VudGVyDQogICAgICAgICAgICBjb3VudGVyW2Jsb2NrU2l6ZSAtIDFdID0gKGNvdW50ZXJbYmxvY2tTaXplIC0gMV0gKyAxKSB8IDANCg0KICAgICAgICAgICAgLy8gRW5jcnlwdA0KICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBibG9ja1NpemU7IGkrKykgew0KICAgICAgICAgICAgICAgIHdvcmRzW29mZnNldCArIGldIF49IGtleXN0cmVhbVtpXTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0pOw0KDQogICAgQ1RSLkRlY3J5cHRvciA9IEVuY3J5cHRvcjsNCg0KICAgIHJldHVybiBDVFI7DQp9KCkpOw0KCmRlZmluZSgiY3J5cHRvLm1vZGUtY3RyIiwgWyJjcnlwdG8uY2lwaGVyLWNvcmUiXSwgZnVuY3Rpb24oKXt9KTsKCjsoZnVuY3Rpb24gKHJvb3QsIGZhY3RvcnkpIHsKICAgIGlmICh0eXBlb2YgZGVmaW5lID09PSAiZnVuY3Rpb24iICYmIGRlZmluZS5hbWQpIHsKICAgICAgICBkZWZpbmUoJ2NyeXB0bycsWwogICAgICAgICAgICAiY3J5cHRvLmNvcmUiLAogICAgICAgICAgICAiY3J5cHRvLmVuYy1iYXNlNjQiLAogICAgICAgICAgICAiY3J5cHRvLm1kNSIsCiAgICAgICAgICAgICJjcnlwdG8uZXZwa2RmIiwKICAgICAgICAgICAgImNyeXB0by5jaXBoZXItY29yZSIsCiAgICAgICAgICAgICJjcnlwdG8uYWVzIiwKICAgICAgICAgICAgImNyeXB0by5zaGExIiwKICAgICAgICAgICAgImNyeXB0by5zaGEyNTYiLAogICAgICAgICAgICAiY3J5cHRvLmhtYWMiLAogICAgICAgICAgICAiY3J5cHRvLnBhZC1ub3BhZGRpbmciLAogICAgICAgICAgICAiY3J5cHRvLm1vZGUtY3RyIgogICAgICAgICAgICBdLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBDcnlwdG9KUzsKICAgICAgICAgICAgfQogICAgICAgICk7CiAgICB9IGVsc2UgewogICAgICAgIHJvb3QuQ3J5cHRvSlMgPSBmYWN0b3J5KCk7CiAgICB9Cn0odGhpcykpOwoKOyhmdW5jdGlvbiAocm9vdCwgZmFjdG9yeSkgewoKICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7CiAgICBkZWZpbmUoJ2JpZ2ludCcsW10sIGZhY3RvcnkuYmluZChyb290LCByb290LmNyeXB0byB8fCByb290Lm1zQ3J5cHRvKSkKICB9IGVsc2UgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnICYmIG1vZHVsZS5leHBvcnRzKSB7CiAgICBtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkocmVxdWlyZSgnY3J5cHRvJykpCiAgfSBlbHNlIHsKICAgIHJvb3QuQmlnSW50ID0gZmFjdG9yeShyb290LmNyeXB0byB8fCByb290Lm1zQ3J5cHRvKQogIH0KCn0odGhpcywgZnVuY3Rpb24gKGNyeXB0bykgewoKICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgLy8gQmlnIEludGVnZXIgTGlicmFyeSB2LiA1LjUKICAvLyBDcmVhdGVkIDIwMDAsIGxhc3QgbW9kaWZpZWQgMjAxMwogIC8vIExlZW1vbiBCYWlyZAogIC8vIHd3dy5sZWVtb24uY29tCiAgLy8KICAvLyBWZXJzaW9uIGhpc3Rvcnk6CiAgLy8gdiA1LjUgIDE3IE1hciAyMDEzCiAgLy8gICAtIHR3byBsaW5lcyBvZiBhIGZvcm0gbGlrZSAiaWYgKHg8MCkgeCs9biIgaGFkIHRoZSAiaWYiIGNoYW5nZWQgdG8gIndoaWxlIiB0bwogIC8vICAgICBoYW5kbGUgdGhlIGNhc2Ugd2hlbiB4PC1uLiAoVGhhbmtzIHRvIEphbWVzIEFuc2VsbCBmb3IgZmluZGluZyB0aGF0IGJ1ZykKICAvLyB2IDUuNCAgMyBPY3QgMjAwOQogIC8vICAgLSBhZGRlZCAidmFyIGkiIHRvIGdyZWF0ZXJTaGlmdCgpIHNvIGkgaXMgbm90IGdsb2JhbC4gKFRoYW5rcyB0byBQw6l0ZXIgU3phYsOzIGZvciBmaW5kaW5nIHRoYXQgYnVnKQogIC8vCiAgLy8gdiA1LjMgIDIxIFNlcCAyMDA5CiAgLy8gICAtIGFkZGVkIHJhbmRQcm9iUHJpbWUoaykgZm9yIHByb2JhYmxlIHByaW1lcwogIC8vICAgLSB1bnJvbGxlZCBsb29wIGluIG1vbnRfIChzbGlnaHRseSBmYXN0ZXIpCiAgLy8gICAtIG1pbGxlclJhYmluIG5vdyB0YWtlcyBhIGJpZ0ludCBwYXJhbWV0ZXIgcmF0aGVyIHRoYW4gYW4gaW50CiAgLy8KICAvLyB2IDUuMiAgMTUgU2VwIDIwMDkKICAvLyAgIC0gZml4ZWQgY2FwaXRhbGl6YXRpb24gaW4gY2FsbCB0byBpbnQyYmlnSW50IGluIHJhbmRCaWdJbnQKICAvLyAgICAgKHRoYW5rcyB0byBFbWlsaSBFdnJpcGlkb3UsIFJlaW5ob2xkIEJlaHJpbmdlciwgYW5kIFNhbXVlbCBNYWNhbGVlc2UgZm9yIGZpbmRpbmcgdGhhdCBidWcpCiAgLy8KICAvLyB2IDUuMSAgOCBPY3QgMjAwNyAKICAvLyAgIC0gcmVuYW1lZCBpbnZlcnNlTW9kSW50XyB0byBpbnZlcnNlTW9kSW50IHNpbmNlIGl0IGRvZXNuJ3QgY2hhbmdlIGl0cyBwYXJhbWV0ZXJzCiAgLy8gICAtIGFkZGVkIGZ1bmN0aW9ucyBHQ0QgYW5kIHJhbmRCaWdJbnQsIHdoaWNoIGNhbGwgR0NEXyBhbmQgcmFuZEJpZ0ludF8KICAvLyAgIC0gZml4ZWQgYSBidWcgZm91bmQgYnkgUm9iIFZpc3NlciAoc2VlIGNvbW1lbnQgd2l0aCBoaXMgbmFtZSBiZWxvdykKICAvLyAgIC0gaW1wcm92ZWQgY29tbWVudHMKICAvLwogIC8vIFRoaXMgZmlsZSBpcyBwdWJsaWMgZG9tYWluLiAgIFlvdSBjYW4gdXNlIGl0IGZvciBhbnkgcHVycG9zZSB3aXRob3V0IHJlc3RyaWN0aW9uLgogIC8vIEkgZG8gbm90IGd1YXJhbnRlZSB0aGF0IGl0IGlzIGNvcnJlY3QsIHNvIHVzZSBpdCBhdCB5b3VyIG93biByaXNrLiAgSWYgeW91IHVzZSAKICAvLyBpdCBmb3Igc29tZXRoaW5nIGludGVyZXN0aW5nLCBJJ2QgYXBwcmVjaWF0ZSBoZWFyaW5nIGFib3V0IGl0LiAgSWYgeW91IGZpbmQgCiAgLy8gYW55IGJ1Z3Mgb3IgbWFrZSBhbnkgaW1wcm92ZW1lbnRzLCBJJ2QgYXBwcmVjaWF0ZSBoZWFyaW5nIGFib3V0IHRob3NlIHRvby4KICAvLyBJdCB3b3VsZCBhbHNvIGJlIG5pY2UgaWYgbXkgbmFtZSBhbmQgVVJMIHdlcmUgbGVmdCBpbiB0aGUgY29tbWVudHMuICBCdXQgbm9uZSAKICAvLyBvZiB0aGF0IGlzIHJlcXVpcmVkLgogIC8vCiAgLy8gVGhpcyBjb2RlIGRlZmluZXMgYSBiaWdJbnQgbGlicmFyeSBmb3IgYXJiaXRyYXJ5LXByZWNpc2lvbiBpbnRlZ2Vycy4KICAvLyBBIGJpZ0ludCBpcyBhbiBhcnJheSBvZiBpbnRlZ2VycyBzdG9yaW5nIHRoZSB2YWx1ZSBpbiBjaHVua3Mgb2YgYnBlIGJpdHMsIAogIC8vIGxpdHRsZSBlbmRpYW4gKGJ1ZmZbMF0gaXMgdGhlIGxlYXN0IHNpZ25pZmljYW50IHdvcmQpLgogIC8vIE5lZ2F0aXZlIGJpZ0ludHMgYXJlIHN0b3JlZCB0d28ncyBjb21wbGVtZW50LiAgQWxtb3N0IGFsbCB0aGUgZnVuY3Rpb25zIHRyZWF0CiAgLy8gYmlnSW50cyBhcyBub25uZWdhdGl2ZS4gIFRoZSBmZXcgdGhhdCB2aWV3IHRoZW0gYXMgdHdvJ3MgY29tcGxlbWVudCBzYXkgc28KICAvLyBpbiB0aGVpciBjb21tZW50cy4gIFNvbWUgZnVuY3Rpb25zIGFzc3VtZSB0aGVpciBwYXJhbWV0ZXJzIGhhdmUgYXQgbGVhc3Qgb25lIAogIC8vIGxlYWRpbmcgemVybyBlbGVtZW50LiBGdW5jdGlvbnMgd2l0aCBhbiB1bmRlcnNjb3JlIGF0IHRoZSBlbmQgb2YgdGhlIG5hbWUgcHV0CiAgLy8gdGhlaXIgYW5zd2VyIGludG8gb25lIG9mIHRoZSBhcnJheXMgcGFzc2VkIGluLCBhbmQgaGF2ZSB1bnByZWRpY3RhYmxlIGJlaGF2aW9yIAogIC8vIGluIGNhc2Ugb2Ygb3ZlcmZsb3csIHNvIHRoZSBjYWxsZXIgbXVzdCBtYWtlIHN1cmUgdGhlIGFycmF5cyBhcmUgYmlnIGVub3VnaCB0byAKICAvLyBob2xkIHRoZSBhbnN3ZXIuICBCdXQgdGhlIGF2ZXJhZ2UgdXNlciBzaG91bGQgbmV2ZXIgaGF2ZSB0byBjYWxsIGFueSBvZiB0aGUgCiAgLy8gdW5kZXJzY29yZWQgZnVuY3Rpb25zLiAgRWFjaCBpbXBvcnRhbnQgdW5kZXJzY29yZWQgZnVuY3Rpb24gaGFzIGEgd3JhcHBlciBmdW5jdGlvbiAKICAvLyBvZiB0aGUgc2FtZSBuYW1lIHdpdGhvdXQgdGhlIHVuZGVyc2NvcmUgdGhhdCB0YWtlcyBjYXJlIG9mIHRoZSBkZXRhaWxzIGZvciB5b3UuICAKICAvLyBGb3IgZWFjaCB1bmRlcnNjb3JlZCBmdW5jdGlvbiB3aGVyZSBhIHBhcmFtZXRlciBpcyBtb2RpZmllZCwgdGhhdCBzYW1lIHZhcmlhYmxlIAogIC8vIG11c3Qgbm90IGJlIHVzZWQgYXMgYW5vdGhlciBhcmd1bWVudCB0b28uICBTbywgeW91IGNhbm5vdCBzcXVhcmUgeCBieSBkb2luZyAKICAvLyBtdWx0TW9kXyh4LHgsbikuICBZb3UgbXVzdCB1c2Ugc3F1YXJlTW9kXyh4LG4pIGluc3RlYWQsIG9yIGRvIHk9ZHVwKHgpOyBtdWx0TW9kXyh4LHksbikuCiAgLy8gT3Igc2ltcGx5IHVzZSB0aGUgbXVsdE1vZCh4LHgsbikgZnVuY3Rpb24gd2l0aG91dCB0aGUgdW5kZXJzY29yZSwgd2hlcmUKICAvLyBzdWNoIGlzc3VlcyBuZXZlciBhcmlzZSwgYmVjYXVzZSBub24tdW5kZXJzY29yZWQgZnVuY3Rpb25zIG5ldmVyIGNoYW5nZQogIC8vIHRoZWlyIHBhcmFtZXRlcnM7IHRoZXkgYWx3YXlzIGFsbG9jYXRlIG5ldyBtZW1vcnkgZm9yIHRoZSBhbnN3ZXIgdGhhdCBpcyByZXR1cm5lZC4KICAvLwogIC8vIFRoZXNlIGZ1bmN0aW9ucyBhcmUgZGVzaWduZWQgdG8gYXZvaWQgZnJlcXVlbnQgZHluYW1pYyBtZW1vcnkgYWxsb2NhdGlvbiBpbiB0aGUgaW5uZXIgbG9vcC4KICAvLyBGb3IgbW9zdCBmdW5jdGlvbnMsIGlmIGl0IG5lZWRzIGEgQmlnSW50IGFzIGEgbG9jYWwgdmFyaWFibGUgaXQgd2lsbCBhY3R1YWxseSB1c2UKICAvLyBhIGdsb2JhbCwgYW5kIHdpbGwgb25seSBhbGxvY2F0ZSB0byBpdCBvbmx5IHdoZW4gaXQncyBub3QgdGhlIHJpZ2h0IHNpemUuICBUaGlzIGVuc3VyZXMKICAvLyB0aGF0IHdoZW4gYSBmdW5jdGlvbiBpcyBjYWxsZWQgcmVwZWF0ZWRseSB3aXRoIHNhbWUtc2l6ZWQgcGFyYW1ldGVycywgaXQgb25seSBhbGxvY2F0ZXMKICAvLyBtZW1vcnkgb24gdGhlIGZpcnN0IGNhbGwuCiAgLy8KICAvLyBOb3RlIHRoYXQgZm9yIGNyeXB0b2dyYXBoaWMgcHVycG9zZXMsIHRoZSBjYWxscyB0byBNYXRoLnJhbmRvbSgpIG11c3QgCiAgLy8gYmUgcmVwbGFjZWQgd2l0aCBjYWxscyB0byBhIGJldHRlciBwc2V1ZG9yYW5kb20gbnVtYmVyIGdlbmVyYXRvci4KICAvLwogIC8vIEluIHRoZSBmb2xsb3dpbmcsICJiaWdJbnQiIG1lYW5zIGEgYmlnSW50IHdpdGggYXQgbGVhc3Qgb25lIGxlYWRpbmcgemVybyBlbGVtZW50LAogIC8vIGFuZCAiaW50ZWdlciIgbWVhbnMgYSBub25uZWdhdGl2ZSBpbnRlZ2VyIGxlc3MgdGhhbiByYWRpeC4gIEluIHNvbWUgY2FzZXMsIGludGVnZXIgCiAgLy8gY2FuIGJlIG5lZ2F0aXZlLiAgTmVnYXRpdmUgYmlnSW50cyBhcmUgMnMgY29tcGxlbWVudC4KICAvLyAKICAvLyBUaGUgZm9sbG93aW5nIGZ1bmN0aW9ucyBkbyBub3QgbW9kaWZ5IHRoZWlyIGlucHV0cy4KICAvLyBUaG9zZSByZXR1cm5pbmcgYSBiaWdJbnQsIHN0cmluZywgb3IgQXJyYXkgd2lsbCBkeW5hbWljYWxseSBhbGxvY2F0ZSBtZW1vcnkgZm9yIHRoYXQgdmFsdWUuCiAgLy8gVGhvc2UgcmV0dXJuaW5nIGEgYm9vbGVhbiB3aWxsIHJldHVybiB0aGUgaW50ZWdlciAwIChmYWxzZSkgb3IgMSAodHJ1ZSkuCiAgLy8gVGhvc2UgcmV0dXJuaW5nIGJvb2xlYW4gb3IgaW50IHdpbGwgbm90IGFsbG9jYXRlIG1lbW9yeSBleGNlcHQgcG9zc2libHkgb24gdGhlIGZpcnN0IAogIC8vIHRpbWUgdGhleSdyZSBjYWxsZWQgd2l0aCBhIGdpdmVuIHBhcmFtZXRlciBzaXplLgogIC8vIAogIC8vIGJpZ0ludCAgYWRkKHgseSkgICAgICAgICAgICAgICAvL3JldHVybiAoeCt5KSBmb3IgYmlnSW50cyB4IGFuZCB5LiAgCiAgLy8gYmlnSW50ICBhZGRJbnQoeCxuKSAgICAgICAgICAgIC8vcmV0dXJuICh4K24pIHdoZXJlIHggaXMgYSBiaWdJbnQgYW5kIG4gaXMgYW4gaW50ZWdlci4KICAvLyBzdHJpbmcgIGJpZ0ludDJzdHIoeCxiYXNlKSAgICAgLy9yZXR1cm4gYSBzdHJpbmcgZm9ybSBvZiBiaWdJbnQgeCBpbiBhIGdpdmVuIGJhc2UsIHdpdGggMiA8PSBiYXNlIDw9IDk1CiAgLy8gaW50ICAgICBiaXRTaXplKHgpICAgICAgICAgICAgIC8vcmV0dXJuIGhvdyBtYW55IGJpdHMgbG9uZyB0aGUgYmlnSW50IHggaXMsIG5vdCBjb3VudGluZyBsZWFkaW5nIHplcm9zCiAgLy8gYmlnSW50ICBkdXAoeCkgICAgICAgICAgICAgICAgIC8vcmV0dXJuIGEgY29weSBvZiBiaWdJbnQgeAogIC8vIGJvb2xlYW4gZXF1YWxzKHgseSkgICAgICAgICAgICAvL2lzIHRoZSBiaWdJbnQgeCBlcXVhbCB0byB0aGUgYmlnaW50IHk/CiAgLy8gYm9vbGVhbiBlcXVhbHNJbnQoeCx5KSAgICAgICAgIC8vaXMgYmlnaW50IHggZXF1YWwgdG8gaW50ZWdlciB5PwogIC8vIGJpZ0ludCAgZXhwYW5kKHgsbikgICAgICAgICAgICAvL3JldHVybiBhIGNvcHkgb2YgeCB3aXRoIGF0IGxlYXN0IG4gZWxlbWVudHMsIGFkZGluZyBsZWFkaW5nIHplcm9zIGlmIG5lZWRlZAogIC8vIEFycmF5ICAgZmluZFByaW1lcyhuKSAgICAgICAgICAvL3JldHVybiBhcnJheSBvZiBhbGwgcHJpbWVzIGxlc3MgdGhhbiBpbnRlZ2VyIG4KICAvLyBiaWdJbnQgIEdDRCh4LHkpICAgICAgICAgICAgICAgLy9yZXR1cm4gZ3JlYXRlc3QgY29tbW9uIGRpdmlzb3Igb2YgYmlnSW50cyB4IGFuZCB5IChlYWNoIHdpdGggc2FtZSBudW1iZXIgb2YgZWxlbWVudHMpLgogIC8vIGJvb2xlYW4gZ3JlYXRlcih4LHkpICAgICAgICAgICAvL2lzIHg+eT8gICh4IGFuZCB5IGFyZSBub25uZWdhdGl2ZSBiaWdJbnRzKQogIC8vIGJvb2xlYW4gZ3JlYXRlclNoaWZ0KHgseSxzaGlmdCkvL2lzICh4IDw8KHNoaWZ0KmJwZSkpID4geT8KICAvLyBiaWdJbnQgIGludDJiaWdJbnQodCxuLG0pICAgICAgLy9yZXR1cm4gYSBiaWdJbnQgZXF1YWwgdG8gaW50ZWdlciB0LCB3aXRoIGF0IGxlYXN0IG4gYml0cyBhbmQgbSBhcnJheSBlbGVtZW50cwogIC8vIGJpZ0ludCAgaW52ZXJzZU1vZCh4LG4pICAgICAgICAvL3JldHVybiAoeCoqKC0xKSBtb2QgbikgZm9yIGJpZ0ludHMgeCBhbmQgbi4gIElmIG5vIGludmVyc2UgZXhpc3RzLCBpdCByZXR1cm5zIG51bGwKICAvLyBpbnQgICAgIGludmVyc2VNb2RJbnQoeCxuKSAgICAgLy9yZXR1cm4geCoqKC0xKSBtb2QgbiwgZm9yIGludGVnZXJzIHggYW5kIG4uICBSZXR1cm4gMCBpZiB0aGVyZSBpcyBubyBpbnZlcnNlCiAgLy8gYm9vbGVhbiBpc1plcm8oeCkgICAgICAgICAgICAgIC8vaXMgdGhlIGJpZ0ludCB4IGVxdWFsIHRvIHplcm8/CiAgLy8gYm9vbGVhbiBtaWxsZXJSYWJpbih4LGIpICAgICAgIC8vZG9lcyBvbmUgcm91bmQgb2YgTWlsbGVyLVJhYmluIGJhc2UgaW50ZWdlciBiIHNheSB0aGF0IGJpZ0ludCB4IGlzIHBvc3NpYmx5IHByaW1lPyAoYiBpcyBiaWdJbnQsIDE8Yjx4KQogIC8vIGJvb2xlYW4gbWlsbGVyUmFiaW5JbnQoeCxiKSAgICAvL2RvZXMgb25lIHJvdW5kIG9mIE1pbGxlci1SYWJpbiBiYXNlIGludGVnZXIgYiBzYXkgdGhhdCBiaWdJbnQgeCBpcyBwb3NzaWJseSBwcmltZT8gKGIgaXMgaW50LCAgICAxPGI8eCkKICAvLyBiaWdJbnQgIG1vZCh4LG4pICAgICAgICAgICAgICAgLy9yZXR1cm4gYSBuZXcgYmlnSW50IGVxdWFsIHRvICh4IG1vZCBuKSBmb3IgYmlnSW50cyB4IGFuZCBuLgogIC8vIGludCAgICAgbW9kSW50KHgsbikgICAgICAgICAgICAvL3JldHVybiB4IG1vZCBuIGZvciBiaWdJbnQgeCBhbmQgaW50ZWdlciBuLgogIC8vIGJpZ0ludCAgbXVsdCh4LHkpICAgICAgICAgICAgICAvL3JldHVybiB4KnkgZm9yIGJpZ0ludHMgeCBhbmQgeS4gVGhpcyBpcyBmYXN0ZXIgd2hlbiB5PHguCiAgLy8gYmlnSW50ICBtdWx0TW9kKHgseSxuKSAgICAgICAgIC8vcmV0dXJuICh4KnkgbW9kIG4pIGZvciBiaWdJbnRzIHgseSxuLiAgRm9yIGdyZWF0ZXIgc3BlZWQsIGxldCB5PHguCiAgLy8gYm9vbGVhbiBuZWdhdGl2ZSh4KSAgICAgICAgICAgIC8vaXMgYmlnSW50IHggbmVnYXRpdmU/CiAgLy8gYmlnSW50ICBwb3dNb2QoeCx5LG4pICAgICAgICAgIC8vcmV0dXJuICh4Kip5IG1vZCBuKSB3aGVyZSB4LHksbiBhcmUgYmlnSW50cyBhbmQgKiogaXMgZXhwb25lbnRpYXRpb24uICAwKiowPTEuIEZhc3RlciBmb3Igb2RkIG4uCiAgLy8gYmlnSW50ICByYW5kQmlnSW50KG4scykgICAgICAgIC8vcmV0dXJuIGFuIG4tYml0IHJhbmRvbSBCaWdJbnQgKG4+PTEpLiAgSWYgcz0xLCB0aGVuIHRoZSBtb3N0IHNpZ25pZmljYW50IG9mIHRob3NlIG4gYml0cyBpcyBzZXQgdG8gMS4KICAvLyBiaWdJbnQgIHJhbmRUcnVlUHJpbWUoaykgICAgICAgLy9yZXR1cm4gYSBuZXcsIHJhbmRvbSwgay1iaXQsIHRydWUgcHJpbWUgYmlnSW50IHVzaW5nIE1hdXJlcidzIGFsZ29yaXRobS4KICAvLyBiaWdJbnQgIHJhbmRQcm9iUHJpbWUoaykgICAgICAgLy9yZXR1cm4gYSBuZXcsIHJhbmRvbSwgay1iaXQsIHByb2JhYmxlIHByaW1lIGJpZ0ludCAocHJvYmFiaWxpdHkgaXQncyBjb21wb3NpdGUgbGVzcyB0aGFuIDJeLTgwKS4KICAvLyBiaWdJbnQgIHN0cjJiaWdJbnQocyxiLG4sbSkgICAgLy9yZXR1cm4gYSBiaWdJbnQgZm9yIG51bWJlciByZXByZXNlbnRlZCBpbiBzdHJpbmcgcyBpbiBiYXNlIGIgd2l0aCBhdCBsZWFzdCBuIGJpdHMgYW5kIG0gYXJyYXkgZWxlbWVudHMKICAvLyBiaWdJbnQgIHN1Yih4LHkpICAgICAgICAgICAgICAgLy9yZXR1cm4gKHgteSkgZm9yIGJpZ0ludHMgeCBhbmQgeS4gIE5lZ2F0aXZlIGFuc3dlcnMgd2lsbCBiZSAycyBjb21wbGVtZW50CiAgLy8gYmlnSW50ICB0cmltKHgsaykgICAgICAgICAgICAgIC8vcmV0dXJuIGEgY29weSBvZiB4IHdpdGggZXhhY3RseSBrIGxlYWRpbmcgemVybyBlbGVtZW50cwogIC8vCiAgLy8KICAvLyBUaGUgZm9sbG93aW5nIGZ1bmN0aW9ucyBlYWNoIGhhdmUgYSBub24tdW5kZXJzY29yZWQgdmVyc2lvbiwgd2hpY2ggbW9zdCB1c2VycyBzaG91bGQgY2FsbCBpbnN0ZWFkLgogIC8vIFRoZXNlIGZ1bmN0aW9ucyBlYWNoIHdyaXRlIHRvIGEgc2luZ2xlIHBhcmFtZXRlciwgYW5kIHRoZSBjYWxsZXIgaXMgcmVzcG9uc2libGUgZm9yIGVuc3VyaW5nIHRoZSBhcnJheSAKICAvLyBwYXNzZWQgaW4gaXMgbGFyZ2UgZW5vdWdoIHRvIGhvbGQgdGhlIHJlc3VsdC4gCiAgLy8KICAvLyB2b2lkICAgIGFkZEludF8oeCxuKSAgICAgICAgICAvL2RvIHg9eCtuIHdoZXJlIHggaXMgYSBiaWdJbnQgYW5kIG4gaXMgYW4gaW50ZWdlcgogIC8vIHZvaWQgICAgYWRkXyh4LHkpICAgICAgICAgICAgIC8vZG8geD14K3kgZm9yIGJpZ0ludHMgeCBhbmQgeQogIC8vIHZvaWQgICAgY29weV8oeCx5KSAgICAgICAgICAgIC8vZG8geD15IG9uIGJpZ0ludHMgeCBhbmQgeQogIC8vIHZvaWQgICAgY29weUludF8oeCxuKSAgICAgICAgIC8vZG8geD1uIG9uIGJpZ0ludCB4IGFuZCBpbnRlZ2VyIG4KICAvLyB2b2lkICAgIEdDRF8oeCx5KSAgICAgICAgICAgICAvL3NldCB4IHRvIHRoZSBncmVhdGVzdCBjb21tb24gZGl2aXNvciBvZiBiaWdJbnRzIHggYW5kIHksICh5IGlzIGRlc3Ryb3llZCkuICAoVGhpcyBuZXZlciBvdmVyZmxvd3MgaXRzIGFycmF5KS4KICAvLyBib29sZWFuIGludmVyc2VNb2RfKHgsbikgICAgICAvL2RvIHg9eCoqKC0xKSBtb2QgbiwgZm9yIGJpZ0ludHMgeCBhbmQgbi4gUmV0dXJucyAxICgwKSBpZiBpbnZlcnNlIGRvZXMgKGRvZXNuJ3QpIGV4aXN0CiAgLy8gdm9pZCAgICBtb2RfKHgsbikgICAgICAgICAgICAgLy9kbyB4PXggbW9kIG4gZm9yIGJpZ0ludHMgeCBhbmQgbi4gKFRoaXMgbmV2ZXIgb3ZlcmZsb3dzIGl0cyBhcnJheSkuCiAgLy8gdm9pZCAgICBtdWx0Xyh4LHkpICAgICAgICAgICAgLy9kbyB4PXgqeSBmb3IgYmlnSW50cyB4IGFuZCB5LgogIC8vIHZvaWQgICAgbXVsdE1vZF8oeCx5LG4pICAgICAgIC8vZG8geD14KnkgIG1vZCBuIGZvciBiaWdJbnRzIHgseSxuLgogIC8vIHZvaWQgICAgcG93TW9kXyh4LHksbikgICAgICAgIC8vZG8geD14Kip5IG1vZCBuLCB3aGVyZSB4LHksbiBhcmUgYmlnSW50cyAobiBpcyBvZGQpIGFuZCAqKiBpcyBleHBvbmVudGlhdGlvbi4gIDAqKjA9MS4KICAvLyB2b2lkICAgIHJhbmRCaWdJbnRfKGIsbixzKSAgICAvL2RvIGIgPSBhbiBuLWJpdCByYW5kb20gQmlnSW50LiBpZiBzPTEsIHRoZW4gbnRoIGJpdCAobW9zdCBzaWduaWZpY2FudCBiaXQpIGlzIHNldCB0byAxLiBuPj0xLgogIC8vIHZvaWQgICAgcmFuZFRydWVQcmltZV8oYW5zLGspIC8vZG8gYW5zID0gYSByYW5kb20gay1iaXQgdHJ1ZSByYW5kb20gcHJpbWUgKG5vdCBqdXN0IHByb2JhYmxlIHByaW1lKSB3aXRoIDEgaW4gdGhlIG1zYi4KICAvLyB2b2lkICAgIHN1Yl8oeCx5KSAgICAgICAgICAgICAvL2RvIHg9eC15IGZvciBiaWdJbnRzIHggYW5kIHkuIE5lZ2F0aXZlIGFuc3dlcnMgd2lsbCBiZSAycyBjb21wbGVtZW50LgogIC8vCiAgLy8gVGhlIGZvbGxvd2luZyBmdW5jdGlvbnMgZG8gTk9UIGhhdmUgYSBub24tdW5kZXJzY29yZWQgdmVyc2lvbi4gCiAgLy8gVGhleSBlYWNoIHdyaXRlIGEgYmlnSW50IHJlc3VsdCB0byBvbmUgb3IgbW9yZSBwYXJhbWV0ZXJzLiAgVGhlIGNhbGxlciBpcyByZXNwb25zaWJsZSBmb3IKICAvLyBlbnN1cmluZyB0aGUgYXJyYXlzIHBhc3NlZCBpbiBhcmUgbGFyZ2UgZW5vdWdoIHRvIGhvbGQgdGhlIHJlc3VsdHMuIAogIC8vCiAgLy8gdm9pZCBhZGRTaGlmdF8oeCx5LHlzKSAgICAgICAvL2RvIHg9eCsoeTw8KHlzKmJwZSkpCiAgLy8gdm9pZCBjYXJyeV8oeCkgICAgICAgICAgICAgICAvL2RvIGNhcnJpZXMgYW5kIGJvcnJvd3Mgc28gZWFjaCBlbGVtZW50IG9mIHRoZSBiaWdJbnQgeCBmaXRzIGluIGJwZSBiaXRzLgogIC8vIHZvaWQgZGl2aWRlXyh4LHkscSxyKSAgICAgICAgLy9kaXZpZGUgeCBieSB5IGdpdmluZyBxdW90aWVudCBxIGFuZCByZW1haW5kZXIgcgogIC8vIGludCAgZGl2SW50Xyh4LG4pICAgICAgICAgICAgLy9kbyB4PWZsb29yKHgvbikgZm9yIGJpZ0ludCB4IGFuZCBpbnRlZ2VyIG4sIGFuZCByZXR1cm4gdGhlIHJlbWFpbmRlci4gKFRoaXMgbmV2ZXIgb3ZlcmZsb3dzIGl0cyBhcnJheSkuCiAgLy8gaW50ICBlR0NEXyh4LHksZCxhLGIpICAgICAgICAvL3NldHMgYSxiLGQgdG8gcG9zaXRpdmUgYmlnSW50cyBzdWNoIHRoYXQgZCA9IEdDRF8oeCx5KSA9IGEqeC1iKnkKICAvLyB2b2lkIGhhbHZlXyh4KSAgICAgICAgICAgICAgIC8vZG8geD1mbG9vcih8eHwvMikqc2duKHgpIGZvciBiaWdJbnQgeCBpbiAyJ3MgY29tcGxlbWVudC4gIChUaGlzIG5ldmVyIG92ZXJmbG93cyBpdHMgYXJyYXkpLgogIC8vIHZvaWQgbGVmdFNoaWZ0Xyh4LG4pICAgICAgICAgLy9sZWZ0IHNoaWZ0IGJpZ0ludCB4IGJ5IG4gYml0cy4gIG48YnBlLgogIC8vIHZvaWQgbGluQ29tYl8oeCx5LGEsYikgICAgICAgLy9kbyB4PWEqeCtiKnkgZm9yIGJpZ0ludHMgeCBhbmQgeSBhbmQgaW50ZWdlcnMgYSBhbmQgYgogIC8vIHZvaWQgbGluQ29tYlNoaWZ0Xyh4LHksYix5cykgLy9kbyB4PXgrYiooeTw8KHlzKmJwZSkpIGZvciBiaWdJbnRzIHggYW5kIHksIGFuZCBpbnRlZ2VycyBiIGFuZCB5cwogIC8vIHZvaWQgbW9udF8oeCx5LG4sbnApICAgICAgICAgLy9Nb250Z29tZXJ5IG11bHRpcGxpY2F0aW9uIChzZWUgY29tbWVudHMgd2hlcmUgdGhlIGZ1bmN0aW9uIGlzIGRlZmluZWQpCiAgLy8gdm9pZCBtdWx0SW50Xyh4LG4pICAgICAgICAgICAvL2RvIHg9eCpuIHdoZXJlIHggaXMgYSBiaWdJbnQgYW5kIG4gaXMgYW4gaW50ZWdlci4KICAvLyB2b2lkIHJpZ2h0U2hpZnRfKHgsbikgICAgICAgIC8vcmlnaHQgc2hpZnQgYmlnSW50IHggYnkgbiBiaXRzLiAoVGhpcyBuZXZlciBvdmVyZmxvd3MgaXRzIGFycmF5KS4KICAvLyB2b2lkIHNxdWFyZU1vZF8oeCxuKSAgICAgICAgIC8vZG8geD14KnggIG1vZCBuIGZvciBiaWdJbnRzIHgsbgogIC8vIHZvaWQgc3ViU2hpZnRfKHgseSx5cykgICAgICAgLy9kbyB4PXgtKHk8PCh5cypicGUpKS4gTmVnYXRpdmUgYW5zd2VycyB3aWxsIGJlIDJzIGNvbXBsZW1lbnQuCiAgLy8KICAvLyBUaGUgZm9sbG93aW5nIGZ1bmN0aW9ucyBhcmUgYmFzZWQgb24gYWxnb3JpdGhtcyBmcm9tIHRoZSBfSGFuZGJvb2sgb2YgQXBwbGllZCBDcnlwdG9ncmFwaHlfCiAgLy8gICAgcG93TW9kXygpICAgICAgICAgICA9IGFsZ29yaXRobSAxNC45NCwgTW9udGdvbWVyeSBleHBvbmVudGlhdGlvbgogIC8vICAgIGVHQ0RfLGludmVyc2VNb2RfKCkgPSBhbGdvcml0aG0gMTQuNjEsIEJpbmFyeSBleHRlbmRlZCBHQ0RfCiAgLy8gICAgR0NEXygpICAgICAgICAgICAgICA9IGFsZ29yb3RobSAxNC41NywgTGVobWVyJ3MgYWxnb3JpdGhtCiAgLy8gICAgbW9udF8oKSAgICAgICAgICAgICA9IGFsZ29yaXRobSAxNC4zNiwgTW9udGdvbWVyeSBtdWx0aXBsaWNhdGlvbgogIC8vICAgIGRpdmlkZV8oKSAgICAgICAgICAgPSBhbGdvcml0aG0gMTQuMjAgIE11bHRpcGxlLXByZWNpc2lvbiBkaXZpc2lvbgogIC8vICAgIHNxdWFyZU1vZF8oKSAgICAgICAgPSBhbGdvcml0aG0gMTQuMTYgIE11bHRpcGxlLXByZWNpc2lvbiBzcXVhcmluZwogIC8vICAgIHJhbmRUcnVlUHJpbWVfKCkgICAgPSBhbGdvcml0aG0gIDQuNjIsIE1hdXJlcidzIGFsZ29yaXRobQogIC8vICAgIG1pbGxlclJhYmluKCkgICAgICAgPSBhbGdvcml0aG0gIDQuMjQsIE1pbGxlci1SYWJpbiBhbGdvcml0aG0KICAvLwogIC8vIFByb2ZpbGluZyBzaG93czoKICAvLyAgICAgcmFuZFRydWVQcmltZV8oKSBzcGVuZHM6CiAgLy8gICAgICAgICAxMCUgb2YgaXRzIHRpbWUgaW4gY2FsbHMgdG8gcG93TW9kXygpCiAgLy8gICAgICAgICA4NSUgb2YgaXRzIHRpbWUgaW4gY2FsbHMgdG8gbWlsbGVyUmFiaW4oKQogIC8vICAgICBtaWxsZXJSYWJpbigpIHNwZW5kczoKICAvLyAgICAgICAgIDk5JSBvZiBpdHMgdGltZSBpbiBjYWxscyB0byBwb3dNb2RfKCkgICAoYWx3YXlzIHdpdGggYSBiYXNlIG9mIDIpCiAgLy8gICAgIHBvd01vZF8oKSBzcGVuZHM6CiAgLy8gICAgICAgICA5NCUgb2YgaXRzIHRpbWUgaW4gY2FsbHMgdG8gbW9udF8oKSAgKGFsbW9zdCBhbHdheXMgd2l0aCB4PT15KQogIC8vCiAgLy8gVGhpcyBzdWdnZXN0cyB0aGVyZSBhcmUgc2V2ZXJhbCB3YXlzIHRvIHNwZWVkIHVwIHRoaXMgbGlicmFyeSBzbGlnaHRseToKICAvLyAgICAgLSBjb252ZXJ0IHBvd01vZF8gdG8gdXNlIGEgTW9udGdvbWVyeSBmb3JtIG9mIGstYXJ5IHdpbmRvdyAob3IgbWF5YmUgYSBNb250Z29tZXJ5IGZvcm0gb2Ygc2xpZGluZyB3aW5kb3cpCiAgLy8gICAgICAgICAtLSB0aGlzIHNob3VsZCBlc3BlY2lhbGx5IGZvY3VzIG9uIGJlaW5nIGZhc3Qgd2hlbiByYWlzaW5nIDIgdG8gYSBwb3dlciBtb2QgbgogIC8vICAgICAtIGNvbnZlcnQgcmFuZFRydWVQcmltZV8oKSB0byB1c2UgYSBtaW5pbXVtIHIgb2YgMS8zIGluc3RlYWQgb2YgMS8yIHdpdGggdGhlIGFwcHJvcHJpYXRlIGNoYW5nZSB0byB0aGUgdGVzdAogIC8vICAgICAtIHR1bmUgdGhlIHBhcmFtZXRlcnMgaW4gcmFuZFRydWVQcmltZV8oKSwgaW5jbHVkaW5nIGMsIG0sIGFuZCByZWNMaW1pdAogIC8vICAgICAtIHNwZWVkIHVwIHRoZSBzaW5nbGUgbG9vcCBpbiBtb250XygpIHRoYXQgdGFrZXMgOTUlIG9mIHRoZSBydW50aW1lLCBwZXJoYXBzIGJ5IHJlZHVjaW5nIGNoZWNraW5nCiAgLy8gICAgICAgd2l0aGluIHRoZSBsb29wIHdoZW4gYWxsIHRoZSBwYXJhbWV0ZXJzIGFyZSB0aGUgc2FtZSBsZW5ndGguCiAgLy8KICAvLyBUaGVyZSBhcmUgc2V2ZXJhbCBpZGVhcyB0aGF0IGxvb2sgbGlrZSB0aGV5IHdvdWxkbid0IGhlbHAgbXVjaCBhdCBhbGw6CiAgLy8gICAgIC0gcmVwbGFjaW5nIHRyaWFsIGRpdmlzaW9uIGluIHJhbmRUcnVlUHJpbWVfKCkgd2l0aCBhIHNpZXZlICh0aGF0IHNwZWVkcyB1cCBzb21ldGhpbmcgdGFraW5nIGFsbW9zdCBubyB0aW1lIGFueXdheSkKICAvLyAgICAgLSBpbmNyZWFzZSBicGUgZnJvbSAxNSB0byAzMCAodGhhdCB3b3VsZCBoZWxwIGlmIHdlIGhhZCBhIDMyKjMyLT42NCBtdWx0aXBsaWVyLCBidXQgbm90IHdpdGggSmF2YVNjcmlwdCdzIDMyKjMyLT4zMikKICAvLyAgICAgLSBzcGVlZGluZyB1cCBtb250Xyh4LHksbixucCkgd2hlbiB4PT15IGJ5IGRvaW5nIGEgbm9uLW1vZHVsYXIsIG5vbi1Nb250Z29tZXJ5IHNxdWFyZQogIC8vICAgICAgIGZvbGxvd2VkIGJ5IGEgTW9udGdvbWVyeSByZWR1Y3Rpb24uICBUaGUgaW50ZXJtZWRpYXRlIGFuc3dlciB3aWxsIGJlIHR3aWNlIGFzIGxvbmcgYXMgeCwgc28gdGhhdAogIC8vICAgICAgIG1ldGhvZCB3b3VsZCBiZSBzbG93ZXIuICBUaGlzIGlzIHVuZm9ydHVuYXRlIGJlY2F1c2UgdGhlIGNvZGUgY3VycmVudGx5IHNwZW5kcyBhbG1vc3QgYWxsIG9mIGl0cyB0aW1lCiAgLy8gICAgICAgZG9pbmcgbW9udF8oeCx4LC4uLiksIGJvdGggZm9yIHJhbmRUcnVlUHJpbWVfKCkgYW5kIHBvd01vZF8oKS4gIEEgZmFzdGVyIG1ldGhvZCBmb3IgTW9udGdvbWVyeSBzcXVhcmluZwogIC8vICAgICAgIHdvdWxkIGhhdmUgYSBsYXJnZSBpbXBhY3Qgb24gdGhlIHNwZWVkIG9mIHJhbmRUcnVlUHJpbWVfKCkgYW5kIHBvd01vZF8oKS4gIEhBQyBoYXMgYSBjb3VwbGUgb2YgcG9vcmx5LXdvcmRlZAogIC8vICAgICAgIHNlbnRlbmNlcyB0aGF0IHNlZW0gdG8gaW1wbHkgaXQncyBmYXN0ZXIgdG8gZG8gYSBub24tbW9kdWxhciBzcXVhcmUgZm9sbG93ZWQgYnkgYSBzaW5nbGUKICAvLyAgICAgICBNb250Z29tZXJ5IHJlZHVjdGlvbiwgYnV0IHRoYXQncyBvYnZpb3VzbHkgd3JvbmcuCiAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAvL2dsb2JhbHMKCiAgLy8gVGhlIG51bWJlciBvZiBzaWduaWZpY2FudCBiaXRzIGluIHRoZSBmcmFjdGlvbiBvZiBhIEphdmFTY3JpcHQKICAvLyBmbG9hdGluZy1wb2ludCBudW1iZXIgaXMgNTIsIGluZGVwZW5kZW50IG9mIHBsYXRmb3JtLgogIC8vIFNlZTogaHR0cHM6Ly9naXRodWIuY29tL2FybG9scmEvb3RyL2lzc3Vlcy80MQoKICB2YXIgYnBlID0gMjY7ICAgICAgICAgIC8vIGJpdHMgc3RvcmVkIHBlciBhcnJheSBlbGVtZW50CiAgdmFyIHJhZGl4ID0gMSA8PCBicGU7ICAvLyBlcXVhbHMgMl5icGUKICB2YXIgbWFzayA9IHJhZGl4IC0gMTsgIC8vIEFORCB0aGlzIHdpdGggYW4gYXJyYXkgZWxlbWVudCB0byBjaG9wIGl0IGRvd24gdG8gYnBlIGJpdHMKCiAgLy90aGUgZGlnaXRzIGZvciBjb252ZXJ0aW5nIHRvIGRpZmZlcmVudCBiYXNlcwogIHZhciBkaWdpdHNTdHI9JzAxMjM0NTY3ODlBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWmFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6Xz0hQCMkJV4mKigpW117fXw7OiwuPD4vP2B+IFxcXCdcIistJzsKCiAgdmFyIG9uZT1pbnQyYmlnSW50KDEsMSwxKTsgICAgIC8vY29uc3RhbnQgdXNlZCBpbiBwb3dNb2RfKCkKCiAgLy90aGUgZm9sbG93aW5nIGdsb2JhbCB2YXJpYWJsZXMgYXJlIHNjcmF0Y2hwYWQgbWVtb3J5IHRvIAogIC8vcmVkdWNlIGR5bmFtaWMgbWVtb3J5IGFsbG9jYXRpb24gaW4gdGhlIGlubmVyIGxvb3AKICB2YXIgdD1uZXcgQXJyYXkoMCk7CiAgdmFyIHNzPXQ7ICAgICAgIC8vdXNlZCBpbiBtdWx0XygpCiAgdmFyIHMwPXQ7ICAgICAgIC8vdXNlZCBpbiBtdWx0TW9kXygpLCBzcXVhcmVNb2RfKCkKICB2YXIgczE9dDsgICAgICAgLy91c2VkIGluIHBvd01vZF8oKSwgbXVsdE1vZF8oKSwgc3F1YXJlTW9kXygpCiAgdmFyIHMyPXQ7ICAgICAgIC8vdXNlZCBpbiBwb3dNb2RfKCksIG11bHRNb2RfKCkKICB2YXIgczM9dDsgICAgICAgLy91c2VkIGluIHBvd01vZF8oKQogIHZhciBzND10LCBzNT10OyAvL3VzZWQgaW4gbW9kXygpCiAgdmFyIHM2PXQ7ICAgICAgIC8vdXNlZCBpbiBiaWdJbnQyc3RyKCkKICB2YXIgczc9dDsgICAgICAgLy91c2VkIGluIHBvd01vZF8oKQogIHZhciBUPXQ7ICAgICAgICAvL3VzZWQgaW4gR0NEXygpCiAgdmFyIHNhPXQ7ICAgICAgIC8vdXNlZCBpbiBtb250XygpCiAgdmFyIG1yX3gxPXQsIG1yX3I9dCwgbXJfYT10OyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy91c2VkIGluIG1pbGxlclJhYmluKCkKICB2YXIgZWdfdj10LCBlZ191PXQsIGVnX0E9dCwgZWdfQj10LCBlZ19DPXQsIGVnX0Q9dDsgICAgICAgICAgICAgICAvL3VzZWQgaW4gZUdDRF8oKSwgaW52ZXJzZU1vZF8oKQogIHZhciBtZF9xMT10LCBtZF9xMj10LCBtZF9xMz10LCBtZF9yPXQsIG1kX3IxPXQsIG1kX3IyPXQsIG1kX3R0PXQ7IC8vdXNlZCBpbiBtb2RfKCkKCiAgdmFyIHByaW1lcz10LCBwb3dzPXQsIHNfaT10LCBzX2kyPXQsIHNfUj10LCBzX3JtPXQsIHNfcT10LCBzX24xPXQ7CiAgdmFyIHNfYT10LCBzX3IyPXQsIHNfbj10LCBzX2I9dCwgc19kPXQsIHNfeDE9dCwgc194Mj10LCBzX2FhPXQ7IC8vdXNlZCBpbiByYW5kVHJ1ZVByaW1lXygpCiAgICAKICB2YXIgcnBwcmI9dDsgLy91c2VkIGluIHJhbmRQcm9iUHJpbWVSb3VuZHMoKSAod2hpY2ggYWxzbyB1c2VzICJwcmltZXMiKQoKICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgoKICAvL3JldHVybiBhcnJheSBvZiBhbGwgcHJpbWVzIGxlc3MgdGhhbiBpbnRlZ2VyIG4KICBmdW5jdGlvbiBmaW5kUHJpbWVzKG4pIHsKICAgIHZhciBpLHMscCxhbnM7CiAgICBzPW5ldyBBcnJheShuKTsKICAgIGZvciAoaT0wO2k8bjtpKyspCiAgICAgIHNbaV09MDsKICAgIHNbMF09MjsKICAgIHA9MDsgICAgLy9maXJzdCBwIGVsZW1lbnRzIG9mIHMgYXJlIHByaW1lcywgdGhlIHJlc3QgYXJlIGEgc2lldmUKICAgIGZvcig7c1twXTxuOykgeyAgICAgICAgICAgICAgICAgIC8vc1twXSBpcyB0aGUgcHRoIHByaW1lCiAgICAgIGZvcihpPXNbcF0qc1twXTsgaTxuOyBpKz1zW3BdKSAvL21hcmsgbXVsdGlwbGVzIG9mIHNbcF0KICAgICAgICBzW2ldPTE7CiAgICAgIHArKzsKICAgICAgc1twXT1zW3AtMV0rMTsKICAgICAgZm9yKDsgc1twXTxuICYmIHNbc1twXV07IHNbcF0rKyk7IC8vZmluZCBuZXh0IHByaW1lICh3aGVyZSBzW3BdPT0wKQogICAgfQogICAgYW5zPW5ldyBBcnJheShwKTsKICAgIGZvcihpPTA7aTxwO2krKykKICAgICAgYW5zW2ldPXNbaV07CiAgICByZXR1cm4gYW5zOwogIH0KCgogIC8vZG9lcyBhIHNpbmdsZSByb3VuZCBvZiBNaWxsZXItUmFiaW4gYmFzZSBiIGNvbnNpZGVyIHggdG8gYmUgYSBwb3NzaWJsZSBwcmltZT8KICAvL3ggaXMgYSBiaWdJbnQsIGFuZCBiIGlzIGFuIGludGVnZXIsIHdpdGggYjx4CiAgZnVuY3Rpb24gbWlsbGVyUmFiaW5JbnQoeCxiKSB7CiAgICBpZiAobXJfeDEubGVuZ3RoIT14Lmxlbmd0aCkgewogICAgICBtcl94MT1kdXAoeCk7CiAgICAgIG1yX3I9ZHVwKHgpOwogICAgICBtcl9hPWR1cCh4KTsKICAgIH0KCiAgICBjb3B5SW50Xyhtcl9hLGIpOwogICAgcmV0dXJuIG1pbGxlclJhYmluKHgsbXJfYSk7CiAgfQoKICAvL2RvZXMgYSBzaW5nbGUgcm91bmQgb2YgTWlsbGVyLVJhYmluIGJhc2UgYiBjb25zaWRlciB4IHRvIGJlIGEgcG9zc2libGUgcHJpbWU/CiAgLy94IGFuZCBiIGFyZSBiaWdJbnRzIHdpdGggYjx4CiAgZnVuY3Rpb24gbWlsbGVyUmFiaW4oeCxiKSB7CiAgICB2YXIgaSxqLGssczsKCiAgICBpZiAobXJfeDEubGVuZ3RoIT14Lmxlbmd0aCkgewogICAgICBtcl94MT1kdXAoeCk7CiAgICAgIG1yX3I9ZHVwKHgpOwogICAgICBtcl9hPWR1cCh4KTsKICAgIH0KCiAgICBjb3B5Xyhtcl9hLGIpOwogICAgY29weV8obXJfcix4KTsKICAgIGNvcHlfKG1yX3gxLHgpOwoKICAgIGFkZEludF8obXJfciwtMSk7CiAgICBhZGRJbnRfKG1yX3gxLC0xKTsKCiAgICAvL3M9dGhlIGhpZ2hlc3QgcG93ZXIgb2YgdHdvIHRoYXQgZGl2aWRlcyBtcl9yCgogICAgLyoKICAgIGs9MDsKICAgIGZvciAoaT0wO2k8bXJfci5sZW5ndGg7aSsrKQogICAgICBmb3IgKGo9MTtqPG1hc2s7ajw8PTEpCiAgICAgICAgaWYgKHhbaV0gJiBqKSB7CiAgICAgICAgICBzPShrPG1yX3IubGVuZ3RoK2JwZSA/IGsgOiAwKTsgCiAgICAgICAgICAgaT1tcl9yLmxlbmd0aDsKICAgICAgICAgICBqPW1hc2s7CiAgICAgICAgfSBlbHNlCiAgICAgICAgICBrKys7CiAgICAqLwoKICAgIC8qIGh0dHA6Ly93d3cuamF2YXNjcmlwdGVyLm5ldC9tYXRoL3ByaW1lcy9taWxsZXJyYWJpbmJ1Zy1iaWdpbnQ1NC5odG0gKi8KICAgIGlmIChpc1plcm8obXJfcikpIHJldHVybiAwOwogICAgZm9yIChrPTA7IG1yX3Jba109PTA7IGsrKyk7CiAgICBmb3IgKGk9MSxqPTI7IG1yX3Jba10laj09MDsgaio9MixpKysgKTsKICAgIHMgPSBrKmJwZSArIGkgLSAxOwogICAgLyogZW5kICovCgogICAgaWYgKHMpICAgICAgICAgICAgICAgIAogICAgICByaWdodFNoaWZ0Xyhtcl9yLHMpOwoKICAgIHBvd01vZF8obXJfYSxtcl9yLHgpOwoKICAgIGlmICghZXF1YWxzSW50KG1yX2EsMSkgJiYgIWVxdWFscyhtcl9hLG1yX3gxKSkgewogICAgICBqPTE7CiAgICAgIHdoaWxlIChqPD1zLTEgJiYgIWVxdWFscyhtcl9hLG1yX3gxKSkgewogICAgICAgIHNxdWFyZU1vZF8obXJfYSx4KTsKICAgICAgICBpZiAoZXF1YWxzSW50KG1yX2EsMSkpIHsKICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KICAgICAgICBqKys7CiAgICAgIH0KICAgICAgaWYgKCFlcXVhbHMobXJfYSxtcl94MSkpIHsKICAgICAgICByZXR1cm4gMDsKICAgICAgfQogICAgfQogICAgcmV0dXJuIDE7ICAKICB9CgogIC8vcmV0dXJucyBob3cgbWFueSBiaXRzIGxvbmcgdGhlIGJpZ0ludCBpcywgbm90IGNvdW50aW5nIGxlYWRpbmcgemVyb3MuCiAgZnVuY3Rpb24gYml0U2l6ZSh4KSB7CiAgICB2YXIgaix6LHc7CiAgICBmb3IgKGo9eC5sZW5ndGgtMTsgKHhbal09PTApICYmIChqPjApOyBqLS0pOwogICAgZm9yICh6PTAsdz14W2pdOyB3OyAodz4+PTEpLHorKyk7CiAgICB6Kz1icGUqajsKICAgIHJldHVybiB6OwogIH0KCiAgLy9yZXR1cm4gYSBjb3B5IG9mIHggd2l0aCBhdCBsZWFzdCBuIGVsZW1lbnRzLCBhZGRpbmcgbGVhZGluZyB6ZXJvcyBpZiBuZWVkZWQKICBmdW5jdGlvbiBleHBhbmQoeCxuKSB7CiAgICB2YXIgYW5zPWludDJiaWdJbnQoMCwoeC5sZW5ndGg+biA/IHgubGVuZ3RoIDogbikqYnBlLDApOwogICAgY29weV8oYW5zLHgpOwogICAgcmV0dXJuIGFuczsKICB9CgogIC8vcmV0dXJuIGEgay1iaXQgdHJ1ZSByYW5kb20gcHJpbWUgdXNpbmcgTWF1cmVyJ3MgYWxnb3JpdGhtLgogIGZ1bmN0aW9uIHJhbmRUcnVlUHJpbWUoaykgewogICAgdmFyIGFucz1pbnQyYmlnSW50KDAsaywwKTsKICAgIHJhbmRUcnVlUHJpbWVfKGFucyxrKTsKICAgIHJldHVybiB0cmltKGFucywxKTsKICB9CgogIC8vcmV0dXJuIGEgay1iaXQgcmFuZG9tIHByb2JhYmxlIHByaW1lIHdpdGggcHJvYmFiaWxpdHkgb2YgZXJyb3IgPCAyXi04MAogIGZ1bmN0aW9uIHJhbmRQcm9iUHJpbWUoaykgewogICAgaWYgKGs+PTYwMCkgcmV0dXJuIHJhbmRQcm9iUHJpbWVSb3VuZHMoaywyKTsgLy9udW1iZXJzIGZyb20gSEFDIHRhYmxlIDQuMwogICAgaWYgKGs+PTU1MCkgcmV0dXJuIHJhbmRQcm9iUHJpbWVSb3VuZHMoayw0KTsKICAgIGlmIChrPj01MDApIHJldHVybiByYW5kUHJvYlByaW1lUm91bmRzKGssNSk7CiAgICBpZiAoaz49NDAwKSByZXR1cm4gcmFuZFByb2JQcmltZVJvdW5kcyhrLDYpOwogICAgaWYgKGs+PTM1MCkgcmV0dXJuIHJhbmRQcm9iUHJpbWVSb3VuZHMoayw3KTsKICAgIGlmIChrPj0zMDApIHJldHVybiByYW5kUHJvYlByaW1lUm91bmRzKGssOSk7CiAgICBpZiAoaz49MjUwKSByZXR1cm4gcmFuZFByb2JQcmltZVJvdW5kcyhrLDEyKTsgLy9udW1iZXJzIGZyb20gSEFDIHRhYmxlIDQuNAogICAgaWYgKGs+PTIwMCkgcmV0dXJuIHJhbmRQcm9iUHJpbWVSb3VuZHMoaywxNSk7CiAgICBpZiAoaz49MTUwKSByZXR1cm4gcmFuZFByb2JQcmltZVJvdW5kcyhrLDE4KTsKICAgIGlmIChrPj0xMDApIHJldHVybiByYW5kUHJvYlByaW1lUm91bmRzKGssMjcpOwogICAgICAgICAgICAgICAgcmV0dXJuIHJhbmRQcm9iUHJpbWVSb3VuZHMoayw0MCk7IC8vbnVtYmVyIGZyb20gSEFDIHJlbWFyayA0LjI2IChvbmx5IGFuIGVzdGltYXRlKQogIH0KCiAgLy9yZXR1cm4gYSBrLWJpdCBwcm9iYWJsZSByYW5kb20gcHJpbWUgdXNpbmcgbiByb3VuZHMgb2YgTWlsbGVyIFJhYmluIChhZnRlciB0cmlhbCBkaXZpc2lvbiB3aXRoIHNtYWxsIHByaW1lcykKICBmdW5jdGlvbiByYW5kUHJvYlByaW1lUm91bmRzKGssbikgewogICAgdmFyIGFucywgaSwgZGl2aXNpYmxlLCBCOyAKICAgIEI9MzAwMDA7ICAvL0IgaXMgbGFyZ2VzdCBwcmltZSB0byB1c2UgaW4gdHJpYWwgZGl2aXNpb24KICAgIGFucz1pbnQyYmlnSW50KDAsaywwKTsKICAgIAogICAgLy9vcHRpbWl6YXRpb246IHRyeSBsYXJnZXIgYW5kIHNtYWxsZXIgQiB0byBmaW5kIHRoZSBiZXN0IGxpbWl0LgogICAgCiAgICBpZiAocHJpbWVzLmxlbmd0aD09MCkKICAgICAgcHJpbWVzPWZpbmRQcmltZXMoMzAwMDApOyAgLy9jaGVjayBmb3IgZGl2aXNpYmlsaXR5IGJ5IHByaW1lcyA8PTMwMDAwCgogICAgaWYgKHJwcHJiLmxlbmd0aCE9YW5zLmxlbmd0aCkKICAgICAgcnBwcmI9ZHVwKGFucyk7CgogICAgZm9yICg7OykgeyAvL2tlZXAgdHJ5aW5nIHJhbmRvbSB2YWx1ZXMgZm9yIGFucyB1bnRpbCBvbmUgYXBwZWFycyB0byBiZSBwcmltZQogICAgICAvL29wdGltaXphdGlvbjogcGljayBhIHJhbmRvbSBudW1iZXIgdGltZXMgTD0yKjMqNSouLi4qcCwgcGx1cyBhIAogICAgICAvLyAgIHJhbmRvbSBlbGVtZW50IG9mIHRoZSBsaXN0IG9mIGFsbCBudW1iZXJzIGluIFswLEwpIG5vdCBkaXZpc2libGUgYnkgYW55IHByaW1lIHVwIHRvIHAuCiAgICAgIC8vICAgVGhpcyBjYW4gcmVkdWNlIHRoZSBhbW91bnQgb2YgcmFuZG9tIG51bWJlciBnZW5lcmF0aW9uLgogICAgICAKICAgICAgcmFuZEJpZ0ludF8oYW5zLGssMCk7IC8vYW5zID0gYSByYW5kb20gb2RkIG51bWJlciB0byBjaGVjawogICAgICBhbnNbMF0gfD0gMTsgCiAgICAgIGRpdmlzaWJsZT0wOwogICAgCiAgICAgIC8vY2hlY2sgYW5zIGZvciBkaXZpc2liaWxpdHkgYnkgc21hbGwgcHJpbWVzIHVwIHRvIEIKICAgICAgZm9yIChpPTA7IChpPHByaW1lcy5sZW5ndGgpICYmIChwcmltZXNbaV08PUIpOyBpKyspCiAgICAgICAgaWYgKG1vZEludChhbnMscHJpbWVzW2ldKT09MCAmJiAhZXF1YWxzSW50KGFucyxwcmltZXNbaV0pKSB7CiAgICAgICAgICBkaXZpc2libGU9MTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0gICAgICAKICAgICAgCiAgICAgIC8vb3B0aW1pemF0aW9uOiBjaGFuZ2UgbWlsbGVyUmFiaW4gc28gdGhlIGJhc2UgY2FuIGJlIGJpZ2dlciB0aGFuIHRoZSBudW1iZXIgYmVpbmcgY2hlY2tlZCwgdGhlbiBlbGltaW5hdGUgdGhlIHdoaWxlIGhlcmUuCiAgICAgIAogICAgICAvL2RvIG4gcm91bmRzIG9mIE1pbGxlciBSYWJpbiwgd2l0aCByYW5kb20gYmFzZXMgbGVzcyB0aGFuIGFucwogICAgICBmb3IgKGk9MDsgaTxuICYmICFkaXZpc2libGU7IGkrKykgewogICAgICAgIHJhbmRCaWdJbnRfKHJwcHJiLGssMCk7CiAgICAgICAgd2hpbGUoIWdyZWF0ZXIoYW5zLHJwcHJiKSkgLy9waWNrIGEgcmFuZG9tIHJwcHJiIHRoYXQncyA8IGFucwogICAgICAgICAgcmFuZEJpZ0ludF8ocnBwcmIsaywwKTsKICAgICAgICBpZiAoIW1pbGxlclJhYmluKGFucyxycHByYikpCiAgICAgICAgICBkaXZpc2libGU9MTsKICAgICAgfQogICAgICAKICAgICAgaWYoIWRpdmlzaWJsZSkKICAgICAgICByZXR1cm4gYW5zOwogICAgfSAgCiAgfQoKICAvL3JldHVybiBhIG5ldyBiaWdJbnQgZXF1YWwgdG8gKHggbW9kIG4pIGZvciBiaWdJbnRzIHggYW5kIG4uCiAgZnVuY3Rpb24gbW9kKHgsbikgewogICAgdmFyIGFucz1kdXAoeCk7CiAgICBtb2RfKGFucyxuKTsKICAgIHJldHVybiB0cmltKGFucywxKTsKICB9CgogIC8vcmV0dXJuICh4K24pIHdoZXJlIHggaXMgYSBiaWdJbnQgYW5kIG4gaXMgYW4gaW50ZWdlci4KICBmdW5jdGlvbiBhZGRJbnQoeCxuKSB7CiAgICB2YXIgYW5zPWV4cGFuZCh4LHgubGVuZ3RoKzEpOwogICAgYWRkSW50XyhhbnMsbik7CiAgICByZXR1cm4gdHJpbShhbnMsMSk7CiAgfQoKICAvL3JldHVybiB4KnkgZm9yIGJpZ0ludHMgeCBhbmQgeS4gVGhpcyBpcyBmYXN0ZXIgd2hlbiB5PHguCiAgZnVuY3Rpb24gbXVsdCh4LHkpIHsKICAgIHZhciBhbnM9ZXhwYW5kKHgseC5sZW5ndGgreS5sZW5ndGgpOwogICAgbXVsdF8oYW5zLHkpOwogICAgcmV0dXJuIHRyaW0oYW5zLDEpOwogIH0KCiAgLy9yZXR1cm4gKHgqKnkgbW9kIG4pIHdoZXJlIHgseSxuIGFyZSBiaWdJbnRzIGFuZCAqKiBpcyBleHBvbmVudGlhdGlvbi4gIDAqKjA9MS4gRmFzdGVyIGZvciBvZGQgbi4KICBmdW5jdGlvbiBwb3dNb2QoeCx5LG4pIHsKICAgIHZhciBhbnM9ZXhwYW5kKHgsbi5sZW5ndGgpOyAgCiAgICBwb3dNb2RfKGFucyx0cmltKHksMiksdHJpbShuLDIpLDApOyAgLy90aGlzIHNob3VsZCB3b3JrIHdpdGhvdXQgdGhlIHRyaW0sIGJ1dCBkb2Vzbid0CiAgICByZXR1cm4gdHJpbShhbnMsMSk7CiAgfQoKICAvL3JldHVybiAoeC15KSBmb3IgYmlnSW50cyB4IGFuZCB5LiAgTmVnYXRpdmUgYW5zd2VycyB3aWxsIGJlIDJzIGNvbXBsZW1lbnQKICBmdW5jdGlvbiBzdWIoeCx5KSB7CiAgICB2YXIgYW5zPWV4cGFuZCh4LCh4Lmxlbmd0aD55Lmxlbmd0aCA/IHgubGVuZ3RoKzEgOiB5Lmxlbmd0aCsxKSk7IAogICAgc3ViXyhhbnMseSk7CiAgICByZXR1cm4gdHJpbShhbnMsMSk7CiAgfQoKICAvL3JldHVybiAoeCt5KSBmb3IgYmlnSW50cyB4IGFuZCB5LiAgCiAgZnVuY3Rpb24gYWRkKHgseSkgewogICAgdmFyIGFucz1leHBhbmQoeCwoeC5sZW5ndGg+eS5sZW5ndGggPyB4Lmxlbmd0aCsxIDogeS5sZW5ndGgrMSkpOyAKICAgIGFkZF8oYW5zLHkpOwogICAgcmV0dXJuIHRyaW0oYW5zLDEpOwogIH0KCiAgLy9yZXR1cm4gKHgqKigtMSkgbW9kIG4pIGZvciBiaWdJbnRzIHggYW5kIG4uICBJZiBubyBpbnZlcnNlIGV4aXN0cywgaXQgcmV0dXJucyBudWxsCiAgZnVuY3Rpb24gaW52ZXJzZU1vZCh4LG4pIHsKICAgIHZhciBhbnM9ZXhwYW5kKHgsbi5sZW5ndGgpOyAKICAgIHZhciBzOwogICAgcz1pbnZlcnNlTW9kXyhhbnMsbik7CiAgICByZXR1cm4gcyA/IHRyaW0oYW5zLDEpIDogbnVsbDsKICB9CgogIC8vcmV0dXJuICh4KnkgbW9kIG4pIGZvciBiaWdJbnRzIHgseSxuLiAgRm9yIGdyZWF0ZXIgc3BlZWQsIGxldCB5PHguCiAgZnVuY3Rpb24gbXVsdE1vZCh4LHksbikgewogICAgdmFyIGFucz1leHBhbmQoeCxuLmxlbmd0aCk7CiAgICBtdWx0TW9kXyhhbnMseSxuKTsKICAgIHJldHVybiB0cmltKGFucywxKTsKICB9CgogIC8vZ2VuZXJhdGUgYSBrLWJpdCB0cnVlIHJhbmRvbSBwcmltZSB1c2luZyBNYXVyZXIncyBhbGdvcml0aG0sCiAgLy9hbmQgcHV0IGl0IGludG8gYW5zLiAgVGhlIGJpZ0ludCBhbnMgbXVzdCBiZSBsYXJnZSBlbm91Z2ggdG8gaG9sZCBpdC4KICBmdW5jdGlvbiByYW5kVHJ1ZVByaW1lXyhhbnMsaykgewogICAgdmFyIGMsdyxtLHBtLGRkLGoscixCLGRpdmlzaWJsZSx6LHp6LHJlY1NpemUscmVjTGltaXQ7CgogICAgaWYgKHByaW1lcy5sZW5ndGg9PTApCiAgICAgIHByaW1lcz1maW5kUHJpbWVzKDMwMDAwKTsgIC8vY2hlY2sgZm9yIGRpdmlzaWJpbGl0eSBieSBwcmltZXMgPD0zMDAwMAoKICAgIGlmIChwb3dzLmxlbmd0aD09MCkgewogICAgICBwb3dzPW5ldyBBcnJheSg1MTIpOwogICAgICBmb3IgKGo9MDtqPDUxMjtqKyspIHsKICAgICAgICBwb3dzW2pdPU1hdGgucG93KDIsai81MTEuMC0xLjApOwogICAgICB9CiAgICB9CgogICAgLy9jIGFuZCBtIHNob3VsZCBiZSB0dW5lZCBmb3IgYSBwYXJ0aWN1bGFyIG1hY2hpbmUgYW5kIHZhbHVlIG9mIGssIHRvIG1heGltaXplIHNwZWVkCiAgICBjPTAuMTsgIC8vYz0wLjEgaW4gSEFDCiAgICBtPTIwOyAgIC8vZ2VuZXJhdGUgdGhpcyBrLWJpdCBudW1iZXIgYnkgZmlyc3QgcmVjdXJzaXZlbHkgZ2VuZXJhdGluZyBhIG51bWJlciB0aGF0IGhhcyBiZXR3ZWVuIGsvMiBhbmQgay1tIGJpdHMKICAgIHJlY0xpbWl0PTIwOyAvL3N0b3AgcmVjdXJzaW9uIHdoZW4gayA8PXJlY0xpbWl0LiAgTXVzdCBoYXZlIHJlY0xpbWl0ID49IDIKCiAgICBpZiAoc19pMi5sZW5ndGghPWFucy5sZW5ndGgpIHsKICAgICAgc19pMj1kdXAoYW5zKTsKICAgICAgc19SID1kdXAoYW5zKTsKICAgICAgc19uMT1kdXAoYW5zKTsKICAgICAgc19yMj1kdXAoYW5zKTsKICAgICAgc19kID1kdXAoYW5zKTsKICAgICAgc194MT1kdXAoYW5zKTsKICAgICAgc194Mj1kdXAoYW5zKTsKICAgICAgc19iID1kdXAoYW5zKTsKICAgICAgc19uID1kdXAoYW5zKTsKICAgICAgc19pID1kdXAoYW5zKTsKICAgICAgc19ybT1kdXAoYW5zKTsKICAgICAgc19xID1kdXAoYW5zKTsKICAgICAgc19hID1kdXAoYW5zKTsKICAgICAgc19hYT1kdXAoYW5zKTsKICAgIH0KCiAgICBpZiAoayA8PSByZWNMaW1pdCkgeyAgLy9nZW5lcmF0ZSBzbWFsbCByYW5kb20gcHJpbWVzIGJ5IHRyaWFsIGRpdmlzaW9uIHVwIHRvIGl0cyBzcXVhcmUgcm9vdAogICAgICBwbT0oMTw8KChrKzIpPj4xKSktMTsgLy9wbSBpcyBiaW5hcnkgbnVtYmVyIHdpdGggYWxsIG9uZXMsIGp1c3Qgb3ZlciBzcXJ0KDJeaykKICAgICAgY29weUludF8oYW5zLDApOwogICAgICBmb3IgKGRkPTE7ZGQ7KSB7CiAgICAgICAgZGQ9MDsKICAgICAgICBhbnNbMF09IDEgfCAoMTw8KGstMSkpIHwgcmFuZG9tQml0SW50KGspOyAgLy9yYW5kb20sIGstYml0LCBvZGQgaW50ZWdlciwgd2l0aCBtc2IgMQogICAgICAgIGZvciAoaj0xOyhqPHByaW1lcy5sZW5ndGgpICYmICgocHJpbWVzW2pdJnBtKT09cHJpbWVzW2pdKTtqKyspIHsgLy90cmlhbCBkaXZpc2lvbiBieSBhbGwgcHJpbWVzIDMuLi5zcXJ0KDJeaykKICAgICAgICAgIGlmICgwPT0oYW5zWzBdJXByaW1lc1tqXSkpIHsKICAgICAgICAgICAgZGQ9MTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGNhcnJ5XyhhbnMpOwogICAgICByZXR1cm47CiAgICB9CgogICAgQj1jKmsqazsgICAgLy90cnkgc21hbGwgcHJpbWVzIHVwIHRvIEIgKG9yIGFsbCB0aGUgcHJpbWVzW10gYXJyYXkgaWYgdGhlIGxhcmdlc3QgaXMgbGVzcyB0aGFuIEIpLgogICAgaWYgKGs+MiptKSAgLy9nZW5lcmF0ZSB0aGlzIGstYml0IG51bWJlciBieSBmaXJzdCByZWN1cnNpdmVseSBnZW5lcmF0aW5nIGEgbnVtYmVyIHRoYXQgaGFzIGJldHdlZW4gay8yIGFuZCBrLW0gYml0cwogICAgICBmb3IgKHI9MTsgay1rKnI8PW07ICkKICAgICAgICByPXBvd3NbcmFuZG9tQml0SW50KDkpXTsgICAvL3I9TWF0aC5wb3coMixNYXRoLnJhbmRvbSgpLTEpOwogICAgZWxzZQogICAgICByPTAuNTsKCiAgICAvL3NpbXVsYXRpb24gc3VnZ2VzdHMgdGhlIG1vcmUgY29tcGxleCBhbGdvcml0aG0gdXNpbmcgcj0uMzMzIGlzIG9ubHkgc2xpZ2h0bHkgZmFzdGVyLgoKICAgIHJlY1NpemU9TWF0aC5mbG9vcihyKmspKzE7CgogICAgcmFuZFRydWVQcmltZV8oc19xLHJlY1NpemUpOwogICAgY29weUludF8oc19pMiwwKTsKICAgIHNfaTJbTWF0aC5mbG9vcigoay0yKS9icGUpXSB8PSAoMTw8KChrLTIpJWJwZSkpOyAgIC8vc19pMj0yXihrLTIpCiAgICBkaXZpZGVfKHNfaTIsc19xLHNfaSxzX3JtKTsgICAgICAgICAgICAgICAgICAgICAgICAvL3NfaT1mbG9vcigoMl4oay0xKSkvKDJxKSkKCiAgICB6PWJpdFNpemUoc19pKTsKCiAgICBmb3IgKDs7KSB7CiAgICAgIGZvciAoOzspIHsgIC8vZ2VuZXJhdGUgei1iaXQgbnVtYmVycyB1bnRpbCBvbmUgZmFsbHMgaW4gdGhlIHJhbmdlIFswLHNfaS0xXQogICAgICAgIHJhbmRCaWdJbnRfKHNfUix6LDApOwogICAgICAgIGlmIChncmVhdGVyKHNfaSxzX1IpKQogICAgICAgICAgYnJlYWs7CiAgICAgIH0gICAgICAgICAgICAgICAgLy9ub3cgc19SIGlzIGluIHRoZSByYW5nZSBbMCxzX2ktMV0KICAgICAgYWRkSW50XyhzX1IsMSk7ICAvL25vdyBzX1IgaXMgaW4gdGhlIHJhbmdlIFsxLHNfaV0KICAgICAgYWRkXyhzX1Isc19pKTsgICAvL25vdyBzX1IgaXMgaW4gdGhlIHJhbmdlIFtzX2krMSwyKnNfaV0KCiAgICAgIGNvcHlfKHNfbixzX3EpOwogICAgICBtdWx0XyhzX24sc19SKTsgCiAgICAgIG11bHRJbnRfKHNfbiwyKTsKICAgICAgYWRkSW50XyhzX24sMSk7ICAgIC8vc19uPTIqc19SKnNfcSsxCiAgICAgIAogICAgICBjb3B5XyhzX3IyLHNfUik7CiAgICAgIG11bHRJbnRfKHNfcjIsMik7ICAvL3NfcjI9MipzX1IKCiAgICAgIC8vY2hlY2sgc19uIGZvciBkaXZpc2liaWxpdHkgYnkgc21hbGwgcHJpbWVzIHVwIHRvIEIKICAgICAgZm9yIChkaXZpc2libGU9MCxqPTA7IChqPHByaW1lcy5sZW5ndGgpICYmIChwcmltZXNbal08Qik7IGorKykKICAgICAgICBpZiAobW9kSW50KHNfbixwcmltZXNbal0pPT0wICYmICFlcXVhbHNJbnQoc19uLHByaW1lc1tqXSkpIHsKICAgICAgICAgIGRpdmlzaWJsZT0xOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfSAgICAgIAoKICAgICAgaWYgKCFkaXZpc2libGUpICAgIC8vaWYgaXQgcGFzc2VzIHNtYWxsIHByaW1lcyBjaGVjaywgdGhlbiB0cnkgYSBzaW5nbGUgTWlsbGVyLVJhYmluIGJhc2UgMgogICAgICAgIGlmICghbWlsbGVyUmFiaW5JbnQoc19uLDIpKSAvL3RoaXMgbGluZSByZXByZXNlbnRzIDc1JSBvZiB0aGUgdG90YWwgcnVudGltZSBmb3IgcmFuZFRydWVQcmltZV8gCiAgICAgICAgICBkaXZpc2libGU9MTsKCiAgICAgIGlmICghZGl2aXNpYmxlKSB7ICAvL2lmIGl0IHBhc3NlcyB0aGF0IHRlc3QsIGNvbnRpbnVlIGNoZWNraW5nIHNfbgogICAgICAgIGFkZEludF8oc19uLC0zKTsKICAgICAgICBmb3IgKGo9c19uLmxlbmd0aC0xOyhzX25bal09PTApICYmIChqPjApOyBqLS0pOyAgLy9zdHJpcCBsZWFkaW5nIHplcm9zCiAgICAgICAgZm9yICh6ej0wLHc9c19uW2pdOyB3OyAodz4+PTEpLHp6KyspOwogICAgICAgIHp6Kz1icGUqajsgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8veno9bnVtYmVyIG9mIGJpdHMgaW4gc19uLCBpZ25vcmluZyBsZWFkaW5nIHplcm9zCiAgICAgICAgZm9yICg7OykgeyAgLy9nZW5lcmF0ZSB6LWJpdCBudW1iZXJzIHVudGlsIG9uZSBmYWxscyBpbiB0aGUgcmFuZ2UgWzAsc19uLTFdCiAgICAgICAgICByYW5kQmlnSW50XyhzX2EsenosMCk7CiAgICAgICAgICBpZiAoZ3JlYXRlcihzX24sc19hKSkKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfSAgICAgICAgICAgICAgICAvL25vdyBzX2EgaXMgaW4gdGhlIHJhbmdlIFswLHNfbi0xXQogICAgICAgIGFkZEludF8oc19uLDMpOyAgLy9ub3cgc19hIGlzIGluIHRoZSByYW5nZSBbMCxzX24tNF0KICAgICAgICBhZGRJbnRfKHNfYSwyKTsgIC8vbm93IHNfYSBpcyBpbiB0aGUgcmFuZ2UgWzIsc19uLTJdCiAgICAgICAgY29weV8oc19iLHNfYSk7CiAgICAgICAgY29weV8oc19uMSxzX24pOwogICAgICAgIGFkZEludF8oc19uMSwtMSk7CiAgICAgICAgcG93TW9kXyhzX2Isc19uMSxzX24pOyAgIC8vc19iPXNfYV4oc19uLTEpIG1vZHVsbyBzX24KICAgICAgICBhZGRJbnRfKHNfYiwtMSk7CiAgICAgICAgaWYgKGlzWmVybyhzX2IpKSB7CiAgICAgICAgICBjb3B5XyhzX2Isc19hKTsKICAgICAgICAgIHBvd01vZF8oc19iLHNfcjIsc19uKTsKICAgICAgICAgIGFkZEludF8oc19iLC0xKTsKICAgICAgICAgIGNvcHlfKHNfYWEsc19uKTsKICAgICAgICAgIGNvcHlfKHNfZCxzX2IpOwogICAgICAgICAgR0NEXyhzX2Qsc19uKTsgIC8vaWYgc19iIGFuZCBzX24gYXJlIHJlbGF0aXZlbHkgcHJpbWUsIHRoZW4gc19uIGlzIGEgcHJpbWUKICAgICAgICAgIGlmIChlcXVhbHNJbnQoc19kLDEpKSB7CiAgICAgICAgICAgIGNvcHlfKGFucyxzX2FhKTsKICAgICAgICAgICAgcmV0dXJuOyAgICAgLy9pZiB3ZSd2ZSBtYWRlIGl0IHRoaXMgZmFyLCB0aGVuIHNfbiBpcyBhYnNvbHV0ZWx5IGd1YXJhbnRlZWQgdG8gYmUgcHJpbWUKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CgogIC8vUmV0dXJuIGFuIG4tYml0IHJhbmRvbSBCaWdJbnQgKG4+PTEpLiAgSWYgcz0xLCB0aGVuIHRoZSBtb3N0IHNpZ25pZmljYW50IG9mIHRob3NlIG4gYml0cyBpcyBzZXQgdG8gMS4KICBmdW5jdGlvbiByYW5kQmlnSW50KG4scykgewogICAgdmFyIGEsYjsKICAgIGE9TWF0aC5mbG9vcigobi0xKS9icGUpKzI7IC8vIyBhcnJheSBlbGVtZW50cyB0byBob2xkIHRoZSBCaWdJbnQgd2l0aCBhIGxlYWRpbmcgMCBlbGVtZW50CiAgICBiPWludDJiaWdJbnQoMCwwLGEpOwogICAgcmFuZEJpZ0ludF8oYixuLHMpOwogICAgcmV0dXJuIGI7CiAgfQoKICAvL1NldCBiIHRvIGFuIG4tYml0IHJhbmRvbSBCaWdJbnQuICBJZiBzPTEsIHRoZW4gdGhlIG1vc3Qgc2lnbmlmaWNhbnQgb2YgdGhvc2UgbiBiaXRzIGlzIHNldCB0byAxLgogIC8vQXJyYXkgYiBtdXN0IGJlIGJpZyBlbm91Z2ggdG8gaG9sZCB0aGUgcmVzdWx0LiBNdXN0IGhhdmUgbj49MQogIGZ1bmN0aW9uIHJhbmRCaWdJbnRfKGIsbixzKSB7CiAgICB2YXIgaSxhOwogICAgZm9yIChpPTA7aTxiLmxlbmd0aDtpKyspCiAgICAgIGJbaV09MDsKICAgIGE9TWF0aC5mbG9vcigobi0xKS9icGUpKzE7IC8vIyBhcnJheSBlbGVtZW50cyB0byBob2xkIHRoZSBCaWdJbnQKICAgIGZvciAoaT0wO2k8YTtpKyspIHsKICAgICAgYltpXT1yYW5kb21CaXRJbnQoYnBlKTsKICAgIH0KICAgIGJbYS0xXSAmPSAoMjw8KChuLTEpJWJwZSkpLTE7CiAgICBpZiAocz09MSkKICAgICAgYlthLTFdIHw9ICgxPDwoKG4tMSklYnBlKSk7CiAgfQoKICAvL1JldHVybiB0aGUgZ3JlYXRlc3QgY29tbW9uIGRpdmlzb3Igb2YgYmlnSW50cyB4IGFuZCB5IChlYWNoIHdpdGggc2FtZSBudW1iZXIgb2YgZWxlbWVudHMpLgogIGZ1bmN0aW9uIEdDRCh4LHkpIHsKICAgIHZhciB4Yyx5YzsKICAgIHhjPWR1cCh4KTsKICAgIHljPWR1cCh5KTsKICAgIEdDRF8oeGMseWMpOwogICAgcmV0dXJuIHhjOwogIH0KCiAgLy9zZXQgeCB0byB0aGUgZ3JlYXRlc3QgY29tbW9uIGRpdmlzb3Igb2YgYmlnSW50cyB4IGFuZCB5IChlYWNoIHdpdGggc2FtZSBudW1iZXIgb2YgZWxlbWVudHMpLgogIC8veSBpcyBkZXN0cm95ZWQuCiAgZnVuY3Rpb24gR0NEXyh4LHkpIHsKICAgIHZhciBpLHhwLHlwLEEsQixDLEQscSxzaW5nLHFwOwogICAgaWYgKFQubGVuZ3RoIT14Lmxlbmd0aCkKICAgICAgVD1kdXAoeCk7CgogICAgc2luZz0xOwogICAgd2hpbGUgKHNpbmcpIHsgLy93aGlsZSB5IGhhcyBub256ZXJvIGVsZW1lbnRzIG90aGVyIHRoYW4geVswXQogICAgICBzaW5nPTA7CiAgICAgIGZvciAoaT0xO2k8eS5sZW5ndGg7aSsrKSAvL2NoZWNrIGlmIHkgaGFzIG5vbnplcm8gZWxlbWVudHMgb3RoZXIgdGhhbiAwCiAgICAgICAgaWYgKHlbaV0pIHsKICAgICAgICAgIHNpbmc9MTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgaWYgKCFzaW5nKSBicmVhazsgLy9xdWl0IHdoZW4geSBhbGwgemVybyBlbGVtZW50cyBleGNlcHQgcG9zc2libHkgeVswXQoKICAgICAgZm9yIChpPXgubGVuZ3RoOyF4W2ldICYmIGk+PTA7aS0tKTsgIC8vZmluZCBtb3N0IHNpZ25pZmljYW50IGVsZW1lbnQgb2YgeAogICAgICB4cD14W2ldOwogICAgICB5cD15W2ldOwogICAgICBBPTE7IEI9MDsgQz0wOyBEPTE7CiAgICAgIHdoaWxlICgoeXArQykgJiYgKHlwK0QpKSB7CiAgICAgICAgcSA9TWF0aC5mbG9vcigoeHArQSkvKHlwK0MpKTsKICAgICAgICBxcD1NYXRoLmZsb29yKCh4cCtCKS8oeXArRCkpOwogICAgICAgIGlmIChxIT1xcCkKICAgICAgICAgIGJyZWFrOwogICAgICAgIHQ9IEEtcSpDOyAgIEE9QzsgICBDPXQ7ICAgIC8vICBkbyAoQSxCLHhwLCBDLEQseXApID0gKEMsRCx5cCwgQSxCLHhwKSAtIHEqKDAsMCwwLCBDLEQseXApICAgICAgCiAgICAgICAgdD0gQi1xKkQ7ICAgQj1EOyAgIEQ9dDsKICAgICAgICB0PXhwLXEqeXA7IHhwPXlwOyB5cD10OwogICAgICB9CiAgICAgIGlmIChCKSB7CiAgICAgICAgY29weV8oVCx4KTsKICAgICAgICBsaW5Db21iXyh4LHksQSxCKTsgLy94PUEqeCtCKnkKICAgICAgICBsaW5Db21iXyh5LFQsRCxDKTsgLy95PUQqeStDKlQKICAgICAgfSBlbHNlIHsKICAgICAgICBtb2RfKHgseSk7CiAgICAgICAgY29weV8oVCx4KTsKICAgICAgICBjb3B5Xyh4LHkpOwogICAgICAgIGNvcHlfKHksVCk7CiAgICAgIH0gCiAgICB9CiAgICBpZiAoeVswXT09MCkKICAgICAgcmV0dXJuOwogICAgdD1tb2RJbnQoeCx5WzBdKTsKICAgIGNvcHlJbnRfKHgseVswXSk7CiAgICB5WzBdPXQ7CiAgICB3aGlsZSAoeVswXSkgewogICAgICB4WzBdJT15WzBdOwogICAgICB0PXhbMF07IHhbMF09eVswXTsgeVswXT10OwogICAgfQogIH0KCiAgLy9kbyB4PXgqKigtMSkgbW9kIG4sIGZvciBiaWdJbnRzIHggYW5kIG4uCiAgLy9JZiBubyBpbnZlcnNlIGV4aXN0cywgaXQgc2V0cyB4IHRvIHplcm8gYW5kIHJldHVybnMgMCwgZWxzZSBpdCByZXR1cm5zIDEuCiAgLy9UaGUgeCBhcnJheSBtdXN0IGJlIGF0IGxlYXN0IGFzIGxhcmdlIGFzIHRoZSBuIGFycmF5LgogIGZ1bmN0aW9uIGludmVyc2VNb2RfKHgsbikgewogICAgdmFyIGs9MSsyKk1hdGgubWF4KHgubGVuZ3RoLG4ubGVuZ3RoKTsKCiAgICBpZighKHhbMF0mMSkgICYmICEoblswXSYxKSkgeyAgLy9pZiBib3RoIGlucHV0cyBhcmUgZXZlbiwgdGhlbiBpbnZlcnNlIGRvZXNuJ3QgZXhpc3QKICAgICAgY29weUludF8oeCwwKTsKICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgaWYgKGVnX3UubGVuZ3RoIT1rKSB7CiAgICAgIGVnX3U9bmV3IEFycmF5KGspOwogICAgICBlZ192PW5ldyBBcnJheShrKTsKICAgICAgZWdfQT1uZXcgQXJyYXkoayk7CiAgICAgIGVnX0I9bmV3IEFycmF5KGspOwogICAgICBlZ19DPW5ldyBBcnJheShrKTsKICAgICAgZWdfRD1uZXcgQXJyYXkoayk7CiAgICB9CgogICAgY29weV8oZWdfdSx4KTsKICAgIGNvcHlfKGVnX3Ysbik7CiAgICBjb3B5SW50XyhlZ19BLDEpOwogICAgY29weUludF8oZWdfQiwwKTsKICAgIGNvcHlJbnRfKGVnX0MsMCk7CiAgICBjb3B5SW50XyhlZ19ELDEpOwogICAgZm9yICg7OykgewogICAgICB3aGlsZSghKGVnX3VbMF0mMSkpIHsgIC8vd2hpbGUgZWdfdSBpcyBldmVuCiAgICAgICAgaGFsdmVfKGVnX3UpOwogICAgICAgIGlmICghKGVnX0FbMF0mMSkgJiYgIShlZ19CWzBdJjEpKSB7IC8vaWYgZWdfQT09ZWdfQj09MCBtb2QgMgogICAgICAgICAgaGFsdmVfKGVnX0EpOwogICAgICAgICAgaGFsdmVfKGVnX0IpOyAgICAgIAogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBhZGRfKGVnX0Esbik7ICBoYWx2ZV8oZWdfQSk7CiAgICAgICAgICBzdWJfKGVnX0IseCk7ICBoYWx2ZV8oZWdfQik7CiAgICAgICAgfQogICAgICB9CgogICAgICB3aGlsZSAoIShlZ192WzBdJjEpKSB7ICAvL3doaWxlIGVnX3YgaXMgZXZlbgogICAgICAgIGhhbHZlXyhlZ192KTsKICAgICAgICBpZiAoIShlZ19DWzBdJjEpICYmICEoZWdfRFswXSYxKSkgeyAvL2lmIGVnX0M9PWVnX0Q9PTAgbW9kIDIKICAgICAgICAgIGhhbHZlXyhlZ19DKTsKICAgICAgICAgIGhhbHZlXyhlZ19EKTsgICAgICAKICAgICAgICB9IGVsc2UgewogICAgICAgICAgYWRkXyhlZ19DLG4pOyAgaGFsdmVfKGVnX0MpOwogICAgICAgICAgc3ViXyhlZ19ELHgpOyAgaGFsdmVfKGVnX0QpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKCFncmVhdGVyKGVnX3YsZWdfdSkpIHsgLy9lZ192IDw9IGVnX3UKICAgICAgICBzdWJfKGVnX3UsZWdfdik7CiAgICAgICAgc3ViXyhlZ19BLGVnX0MpOwogICAgICAgIHN1Yl8oZWdfQixlZ19EKTsKICAgICAgfSBlbHNlIHsgICAgICAgICAgICAgICAgICAgLy9lZ192ID4gZWdfdQogICAgICAgIHN1Yl8oZWdfdixlZ191KTsKICAgICAgICBzdWJfKGVnX0MsZWdfQSk7CiAgICAgICAgc3ViXyhlZ19ELGVnX0IpOwogICAgICB9CgogICAgICBpZiAoZXF1YWxzSW50KGVnX3UsMCkpIHsKICAgICAgICB3aGlsZSAobmVnYXRpdmUoZWdfQykpIC8vbWFrZSBzdXJlIGFuc3dlciBpcyBub25uZWdhdGl2ZQogICAgICAgICAgYWRkXyhlZ19DLG4pOwogICAgICAgIGNvcHlfKHgsZWdfQyk7CgogICAgICAgIGlmICghZXF1YWxzSW50KGVnX3YsMSkpIHsgLy9pZiBHQ0RfKHgsbikhPTEsIHRoZW4gdGhlcmUgaXMgbm8gaW52ZXJzZQogICAgICAgICAgY29weUludF8oeCwwKTsKICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KICAgICAgICByZXR1cm4gMTsKICAgICAgfQogICAgfQogIH0KCiAgLy9yZXR1cm4geCoqKC0xKSBtb2QgbiwgZm9yIGludGVnZXJzIHggYW5kIG4uICBSZXR1cm4gMCBpZiB0aGVyZSBpcyBubyBpbnZlcnNlCiAgZnVuY3Rpb24gaW52ZXJzZU1vZEludCh4LG4pIHsKICAgIHZhciBhPTEsYj0wLHQ7CiAgICBmb3IgKDs7KSB7CiAgICAgIGlmICh4PT0xKSByZXR1cm4gYTsKICAgICAgaWYgKHg9PTApIHJldHVybiAwOwogICAgICBiLT1hKk1hdGguZmxvb3Iobi94KTsKICAgICAgbiU9eDsKCiAgICAgIGlmIChuPT0xKSByZXR1cm4gYjsgLy90byBhdm9pZCBuZWdhdGl2ZXMsIGNoYW5nZSB0aGlzIGIgdG8gbi1iLCBhbmQgZWFjaCAtPSB0byArPQogICAgICBpZiAobj09MCkgcmV0dXJuIDA7CiAgICAgIGEtPWIqTWF0aC5mbG9vcih4L24pOwogICAgICB4JT1uOwogICAgfQogIH0KCiAgLy90aGlzIGRlcHJlY2F0ZWQgZnVuY3Rpb24gaXMgZm9yIGJhY2t3YXJkIGNvbXBhdGliaWxpdHkgb25seS4gCiAgZnVuY3Rpb24gaW52ZXJzZU1vZEludF8oeCxuKSB7CiAgICAgcmV0dXJuIGludmVyc2VNb2RJbnQoeCxuKTsKICB9CgoKICAvL0dpdmVuIHBvc2l0aXZlIGJpZ0ludHMgeCBhbmQgeSwgY2hhbmdlIHRoZSBiaWdpbnRzIHYsIGEsIGFuZCBiIHRvIHBvc2l0aXZlIGJpZ0ludHMgc3VjaCB0aGF0OgogIC8vICAgICB2ID0gR0NEXyh4LHkpID0gYSp4LWIqeQogIC8vVGhlIGJpZ0ludHMgdiwgYSwgYiwgbXVzdCBoYXZlIGV4YWN0bHkgYXMgbWFueSBlbGVtZW50cyBhcyB0aGUgbGFyZ2VyIG9mIHggYW5kIHkuCiAgZnVuY3Rpb24gZUdDRF8oeCx5LHYsYSxiKSB7CiAgICB2YXIgZz0wOwogICAgdmFyIGs9TWF0aC5tYXgoeC5sZW5ndGgseS5sZW5ndGgpOwogICAgaWYgKGVnX3UubGVuZ3RoIT1rKSB7CiAgICAgIGVnX3U9bmV3IEFycmF5KGspOwogICAgICBlZ19BPW5ldyBBcnJheShrKTsKICAgICAgZWdfQj1uZXcgQXJyYXkoayk7CiAgICAgIGVnX0M9bmV3IEFycmF5KGspOwogICAgICBlZ19EPW5ldyBBcnJheShrKTsKICAgIH0KICAgIHdoaWxlKCEoeFswXSYxKSAgJiYgISh5WzBdJjEpKSB7ICAvL3doaWxlIHggYW5kIHkgYm90aCBldmVuCiAgICAgIGhhbHZlXyh4KTsKICAgICAgaGFsdmVfKHkpOwogICAgICBnKys7CiAgICB9CiAgICBjb3B5XyhlZ191LHgpOwogICAgY29weV8odix5KTsKICAgIGNvcHlJbnRfKGVnX0EsMSk7CiAgICBjb3B5SW50XyhlZ19CLDApOwogICAgY29weUludF8oZWdfQywwKTsKICAgIGNvcHlJbnRfKGVnX0QsMSk7CiAgICBmb3IgKDs7KSB7CiAgICAgIHdoaWxlKCEoZWdfdVswXSYxKSkgeyAgLy93aGlsZSB1IGlzIGV2ZW4KICAgICAgICBoYWx2ZV8oZWdfdSk7CiAgICAgICAgaWYgKCEoZWdfQVswXSYxKSAmJiAhKGVnX0JbMF0mMSkpIHsgLy9pZiBBPT1CPT0wIG1vZCAyCiAgICAgICAgICBoYWx2ZV8oZWdfQSk7CiAgICAgICAgICBoYWx2ZV8oZWdfQik7ICAgICAgCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGFkZF8oZWdfQSx5KTsgIGhhbHZlXyhlZ19BKTsKICAgICAgICAgIHN1Yl8oZWdfQix4KTsgIGhhbHZlXyhlZ19CKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHdoaWxlICghKHZbMF0mMSkpIHsgIC8vd2hpbGUgdiBpcyBldmVuCiAgICAgICAgaGFsdmVfKHYpOwogICAgICAgIGlmICghKGVnX0NbMF0mMSkgJiYgIShlZ19EWzBdJjEpKSB7IC8vaWYgQz09RD09MCBtb2QgMgogICAgICAgICAgaGFsdmVfKGVnX0MpOwogICAgICAgICAgaGFsdmVfKGVnX0QpOyAgICAgIAogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBhZGRfKGVnX0MseSk7ICBoYWx2ZV8oZWdfQyk7CiAgICAgICAgICBzdWJfKGVnX0QseCk7ICBoYWx2ZV8oZWdfRCk7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoIWdyZWF0ZXIodixlZ191KSkgeyAvL3Y8PXUKICAgICAgICBzdWJfKGVnX3Usdik7CiAgICAgICAgc3ViXyhlZ19BLGVnX0MpOwogICAgICAgIHN1Yl8oZWdfQixlZ19EKTsKICAgICAgfSBlbHNlIHsgICAgICAgICAgICAgICAgLy92PnUKICAgICAgICBzdWJfKHYsZWdfdSk7CiAgICAgICAgc3ViXyhlZ19DLGVnX0EpOwogICAgICAgIHN1Yl8oZWdfRCxlZ19CKTsKICAgICAgfQogICAgICBpZiAoZXF1YWxzSW50KGVnX3UsMCkpIHsKICAgICAgICB3aGlsZSAobmVnYXRpdmUoZWdfQykpIHsgICAvL21ha2Ugc3VyZSBhIChDKSBpcyBub25uZWdhdGl2ZQogICAgICAgICAgYWRkXyhlZ19DLHkpOwogICAgICAgICAgc3ViXyhlZ19ELHgpOwogICAgICAgIH0KICAgICAgICBtdWx0SW50XyhlZ19ELC0xKTsgIC8vL21ha2Ugc3VyZSBiIChEKSBpcyBub25uZWdhdGl2ZQogICAgICAgIGNvcHlfKGEsZWdfQyk7CiAgICAgICAgY29weV8oYixlZ19EKTsKICAgICAgICBsZWZ0U2hpZnRfKHYsZyk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICB9CiAgfQoKCiAgLy9pcyBiaWdJbnQgeCBuZWdhdGl2ZT8KICBmdW5jdGlvbiBuZWdhdGl2ZSh4KSB7CiAgICByZXR1cm4gKCh4W3gubGVuZ3RoLTFdPj4oYnBlLTEpKSYxKTsKICB9CgoKICAvL2lzICh4IDw8IChzaGlmdCpicGUpKSA+IHk/CiAgLy94IGFuZCB5IGFyZSBub25uZWdhdGl2ZSBiaWdJbnRzCiAgLy9zaGlmdCBpcyBhIG5vbm5lZ2F0aXZlIGludGVnZXIKICBmdW5jdGlvbiBncmVhdGVyU2hpZnQoeCx5LHNoaWZ0KSB7CiAgICB2YXIgaSwga3g9eC5sZW5ndGgsIGt5PXkubGVuZ3RoOwogICAgdmFyIGs9KChreCtzaGlmdCk8a3kpID8gKGt4K3NoaWZ0KSA6IGt5OwogICAgZm9yIChpPWt5LTEtc2hpZnQ7IGk8a3ggJiYgaT49MDsgaSsrKSAKICAgICAgaWYgKHhbaV0+MCkKICAgICAgICByZXR1cm4gMTsgLy9pZiB0aGVyZSBhcmUgbm9uemVyb3MgaW4geCB0byB0aGUgbGVmdCBvZiB0aGUgZmlyc3QgY29sdW1uIG9mIHksIHRoZW4geCBpcyBiaWdnZXIKICAgIGZvciAoaT1reC0xK3NoaWZ0OyBpPGt5OyBpKyspCiAgICAgIGlmICh5W2ldPjApCiAgICAgICAgcmV0dXJuIDA7IC8vaWYgdGhlcmUgYXJlIG5vbnplcm9zIGluIHkgdG8gdGhlIGxlZnQgb2YgdGhlIGZpcnN0IGNvbHVtbiBvZiB4LCB0aGVuIHggaXMgbm90IGJpZ2dlcgogICAgZm9yIChpPWstMTsgaT49c2hpZnQ7IGktLSkKICAgICAgaWYgICAgICAoeFtpLXNoaWZ0XT55W2ldKSByZXR1cm4gMTsKICAgICAgZWxzZSBpZiAoeFtpLXNoaWZ0XTx5W2ldKSByZXR1cm4gMDsKICAgIHJldHVybiAwOwogIH0KCiAgLy9pcyB4ID4geT8gKHggYW5kIHkgYm90aCBub25uZWdhdGl2ZSkKICBmdW5jdGlvbiBncmVhdGVyKHgseSkgewogICAgdmFyIGk7CiAgICB2YXIgaz0oeC5sZW5ndGg8eS5sZW5ndGgpID8geC5sZW5ndGggOiB5Lmxlbmd0aDsKCiAgICBmb3IgKGk9eC5sZW5ndGg7aTx5Lmxlbmd0aDtpKyspCiAgICAgIGlmICh5W2ldKQogICAgICAgIHJldHVybiAwOyAgLy95IGhhcyBtb3JlIGRpZ2l0cwoKICAgIGZvciAoaT15Lmxlbmd0aDtpPHgubGVuZ3RoO2krKykKICAgICAgaWYgKHhbaV0pCiAgICAgICAgcmV0dXJuIDE7ICAvL3ggaGFzIG1vcmUgZGlnaXRzCgogICAgZm9yIChpPWstMTtpPj0wO2ktLSkKICAgICAgaWYgKHhbaV0+eVtpXSkKICAgICAgICByZXR1cm4gMTsKICAgICAgZWxzZSBpZiAoeFtpXTx5W2ldKQogICAgICAgIHJldHVybiAwOwogICAgcmV0dXJuIDA7CiAgfQoKICAvL2RpdmlkZSB4IGJ5IHkgZ2l2aW5nIHF1b3RpZW50IHEgYW5kIHJlbWFpbmRlciByLiAgKHE9Zmxvb3IoeC95KSwgIHI9eCBtb2QgeSkuICBBbGwgNCBhcmUgYmlnaW50cy4KICAvL3ggbXVzdCBoYXZlIGF0IGxlYXN0IG9uZSBsZWFkaW5nIHplcm8gZWxlbWVudC4KICAvL3kgbXVzdCBiZSBub256ZXJvLgogIC8vcSBhbmQgciBtdXN0IGJlIGFycmF5cyB0aGF0IGFyZSBleGFjdGx5IHRoZSBzYW1lIGxlbmd0aCBhcyB4LiAoT3IgcSBjYW4gaGF2ZSBtb3JlKS4KICAvL011c3QgaGF2ZSB4Lmxlbmd0aCA+PSB5Lmxlbmd0aCA+PSAyLgogIGZ1bmN0aW9uIGRpdmlkZV8oeCx5LHEscikgewogICAgdmFyIGt4LCBreTsKICAgIHZhciBpLGoseTEseTIsYyxhLGI7CiAgICBjb3B5XyhyLHgpOwogICAgZm9yIChreT15Lmxlbmd0aDt5W2t5LTFdPT0wO2t5LS0pOyAvL2t5IGlzIG51bWJlciBvZiBlbGVtZW50cyBpbiB5LCBub3QgaW5jbHVkaW5nIGxlYWRpbmcgemVyb3MKCiAgICAvL25vcm1hbGl6ZTogZW5zdXJlIHRoZSBtb3N0IHNpZ25pZmljYW50IGVsZW1lbnQgb2YgeSBoYXMgaXRzIGhpZ2hlc3QgYml0IHNldCAgCiAgICBiPXlba3ktMV07CiAgICBmb3IgKGE9MDsgYjsgYSsrKQogICAgICBiPj49MTsgIAogICAgYT1icGUtYTsgIC8vYSBpcyBob3cgbWFueSBiaXRzIHRvIHNoaWZ0IHNvIHRoYXQgdGhlIGhpZ2ggb3JkZXIgYml0IG9mIHkgaXMgbGVmdG1vc3QgaW4gaXRzIGFycmF5IGVsZW1lbnQKICAgIGxlZnRTaGlmdF8oeSxhKTsgIC8vbXVsdGlwbHkgYm90aCBieSAxPDxhIG5vdywgdGhlbiBkaXZpZGUgYm90aCBieSB0aGF0IGF0IHRoZSBlbmQKICAgIGxlZnRTaGlmdF8ocixhKTsKCiAgICAvL1JvYiBWaXNzZXIgZGlzY292ZXJlZCBhIGJ1ZzogdGhlIGZvbGxvd2luZyBsaW5lIHdhcyBvcmlnaW5hbGx5IGp1c3QgYmVmb3JlIHRoZSBub3JtYWxpemF0aW9uLgogICAgZm9yIChreD1yLmxlbmd0aDtyW2t4LTFdPT0wICYmIGt4Pmt5O2t4LS0pOyAvL2t4IGlzIG51bWJlciBvZiBlbGVtZW50cyBpbiBub3JtYWxpemVkIHgsIG5vdCBpbmNsdWRpbmcgbGVhZGluZyB6ZXJvcwoKICAgIGNvcHlJbnRfKHEsMCk7ICAgICAgICAgICAgICAgICAgICAgIC8vIHE9MAogICAgd2hpbGUgKCFncmVhdGVyU2hpZnQoeSxyLGt4LWt5KSkgeyAgLy8gd2hpbGUgKGxlZnRTaGlmdF8oeSxreC1reSkgPD0gcikgewogICAgICBzdWJTaGlmdF8ocix5LGt4LWt5KTsgICAgICAgICAgICAgLy8gICByPXItbGVmdFNoaWZ0Xyh5LGt4LWt5KQogICAgICBxW2t4LWt5XSsrOyAgICAgICAgICAgICAgICAgICAgICAgLy8gICBxW2t4LWt5XSsrOwogICAgfSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gfQoKICAgIGZvciAoaT1reC0xOyBpPj1reTsgaS0tKSB7CiAgICAgIGlmIChyW2ldPT15W2t5LTFdKQogICAgICAgIHFbaS1reV09bWFzazsKICAgICAgZWxzZQogICAgICAgIHFbaS1reV09TWF0aC5mbG9vcigocltpXSpyYWRpeCtyW2ktMV0pL3lba3ktMV0pOwoKICAgICAgLy9UaGUgZm9sbG93aW5nIGZvcig7OykgbG9vcCBpcyBlcXVpdmFsZW50IHRvIHRoZSBjb21tZW50ZWQgd2hpbGUgbG9vcCwgCiAgICAgIC8vZXhjZXB0IHRoYXQgdGhlIHVuY29tbWVudGVkIHZlcnNpb24gYXZvaWRzIG92ZXJmbG93LgogICAgICAvL1RoZSBjb21tZW50ZWQgbG9vcCBjb21lcyBmcm9tIEhBQywgd2hpY2ggYXNzdW1lcyByWy0xXT09eVstMV09PTAKICAgICAgLy8gIHdoaWxlIChxW2kta3ldKih5W2t5LTFdKnJhZGl4K3lba3ktMl0pID4gcltpXSpyYWRpeCpyYWRpeCtyW2ktMV0qcmFkaXgrcltpLTJdKQogICAgICAvLyAgICBxW2kta3ldLS07ICAgIAogICAgICBmb3IgKDs7KSB7CiAgICAgICAgeTI9KGt5PjEgPyB5W2t5LTJdIDogMCkqcVtpLWt5XTsKICAgICAgICBjPXkyOwogICAgICAgIHkyPXkyICYgbWFzazsKICAgICAgICBjID0gKGMgLSB5MikgLyByYWRpeDsKICAgICAgICB5MT1jK3FbaS1reV0qeVtreS0xXTsKICAgICAgICBjPXkxOwogICAgICAgIHkxPXkxICYgbWFzazsKICAgICAgICBjID0gKGMgLSB5MSkgLyByYWRpeDsKCiAgICAgICAgaWYgKGM9PXJbaV0gPyB5MT09cltpLTFdID8geTI+KGk+MSA/IHJbaS0yXSA6IDApIDogeTE+cltpLTFdIDogYz5yW2ldKSAKICAgICAgICAgIHFbaS1reV0tLTsKICAgICAgICBlbHNlCiAgICAgICAgICBicmVhazsKICAgICAgfQoKICAgICAgbGluQ29tYlNoaWZ0XyhyLHksLXFbaS1reV0saS1reSk7ICAgIC8vcj1yLXFbaS1reV0qbGVmdFNoaWZ0Xyh5LGkta3kpCiAgICAgIGlmIChuZWdhdGl2ZShyKSkgewogICAgICAgIGFkZFNoaWZ0XyhyLHksaS1reSk7ICAgICAgICAgLy9yPXIrbGVmdFNoaWZ0Xyh5LGkta3kpCiAgICAgICAgcVtpLWt5XS0tOwogICAgICB9CiAgICB9CgogICAgcmlnaHRTaGlmdF8oeSxhKTsgIC8vdW5kbyB0aGUgbm9ybWFsaXphdGlvbiBzdGVwCiAgICByaWdodFNoaWZ0XyhyLGEpOyAgLy91bmRvIHRoZSBub3JtYWxpemF0aW9uIHN0ZXAKICB9CgogIC8vZG8gY2FycmllcyBhbmQgYm9ycm93cyBzbyBlYWNoIGVsZW1lbnQgb2YgdGhlIGJpZ0ludCB4IGZpdHMgaW4gYnBlIGJpdHMuCiAgZnVuY3Rpb24gY2FycnlfKHgpIHsKICAgIHZhciBpLGssYyxiOwogICAgaz14Lmxlbmd0aDsKICAgIGM9MDsKICAgIGZvciAoaT0wO2k8aztpKyspIHsKICAgICAgYys9eFtpXTsKICAgICAgYj0wOwogICAgICBpZiAoYzwwKSB7CiAgICAgICAgYiA9IGMgJiBtYXNrOwogICAgICAgIGIgPSAtKChjIC0gYikgLyByYWRpeCk7CiAgICAgICAgYys9YipyYWRpeDsKICAgICAgfQogICAgICB4W2ldPWMgJiBtYXNrOwogICAgICBjID0gKChjIC0geFtpXSkgLyByYWRpeCkgLSBiOwogICAgfQogIH0KCiAgLy9yZXR1cm4geCBtb2QgbiBmb3IgYmlnSW50IHggYW5kIGludGVnZXIgbi4KICBmdW5jdGlvbiBtb2RJbnQoeCxuKSB7CiAgICB2YXIgaSxjPTA7CiAgICBmb3IgKGk9eC5sZW5ndGgtMTsgaT49MDsgaS0tKQogICAgICBjPShjKnJhZGl4K3hbaV0pJW47CiAgICByZXR1cm4gYzsKICB9CgogIC8vY29udmVydCB0aGUgaW50ZWdlciB0IGludG8gYSBiaWdJbnQgd2l0aCBhdCBsZWFzdCB0aGUgZ2l2ZW4gbnVtYmVyIG9mIGJpdHMuCiAgLy90aGUgcmV0dXJuZWQgYXJyYXkgc3RvcmVzIHRoZSBiaWdJbnQgaW4gYnBlLWJpdCBjaHVua3MsIGxpdHRsZSBlbmRpYW4gKGJ1ZmZbMF0gaXMgbGVhc3Qgc2lnbmlmaWNhbnQgd29yZCkKICAvL1BhZCB0aGUgYXJyYXkgd2l0aCBsZWFkaW5nIHplcm9zIHNvIHRoYXQgaXQgaGFzIGF0IGxlYXN0IG1pblNpemUgZWxlbWVudHMuCiAgLy9UaGVyZSB3aWxsIGFsd2F5cyBiZSBhdCBsZWFzdCBvbmUgbGVhZGluZyAwIGVsZW1lbnQuCiAgZnVuY3Rpb24gaW50MmJpZ0ludCh0LGJpdHMsbWluU2l6ZSkgeyAgIAogICAgdmFyIGksaywgYnVmZjsKICAgIGs9TWF0aC5jZWlsKGJpdHMvYnBlKSsxOwogICAgaz1taW5TaXplPmsgPyBtaW5TaXplIDogazsKICAgIGJ1ZmY9bmV3IEFycmF5KGspOwogICAgY29weUludF8oYnVmZix0KTsKICAgIHJldHVybiBidWZmOwogIH0KCiAgLy9yZXR1cm4gdGhlIGJpZ0ludCBnaXZlbiBhIHN0cmluZyByZXByZXNlbnRhdGlvbiBpbiBhIGdpdmVuIGJhc2UuICAKICAvL1BhZCB0aGUgYXJyYXkgd2l0aCBsZWFkaW5nIHplcm9zIHNvIHRoYXQgaXQgaGFzIGF0IGxlYXN0IG1pblNpemUgZWxlbWVudHMuCiAgLy9JZiBiYXNlPS0xLCB0aGVuIGl0IHJlYWRzIGluIGEgc3BhY2Utc2VwYXJhdGVkIGxpc3Qgb2YgYXJyYXkgZWxlbWVudHMgaW4gZGVjaW1hbC4KICAvL1RoZSBhcnJheSB3aWxsIGFsd2F5cyBoYXZlIGF0IGxlYXN0IG9uZSBsZWFkaW5nIHplcm8sIHVubGVzcyBiYXNlPS0xLgogIGZ1bmN0aW9uIHN0cjJiaWdJbnQocyxiYXNlLG1pblNpemUpIHsKICAgIHZhciBkLCBpLCBqLCB4LCB5LCBrazsKICAgIHZhciBrPXMubGVuZ3RoOwogICAgaWYgKGJhc2U9PS0xKSB7IC8vY29tbWEtc2VwYXJhdGVkIGxpc3Qgb2YgYXJyYXkgZWxlbWVudHMgaW4gZGVjaW1hbAogICAgICB4PW5ldyBBcnJheSgwKTsKICAgICAgZm9yICg7OykgewogICAgICAgIHk9bmV3IEFycmF5KHgubGVuZ3RoKzEpOwogICAgICAgIGZvciAoaT0wO2k8eC5sZW5ndGg7aSsrKQogICAgICAgICAgeVtpKzFdPXhbaV07CiAgICAgICAgeVswXT1wYXJzZUludChzLDEwKTsKICAgICAgICB4PXk7CiAgICAgICAgZD1zLmluZGV4T2YoJywnLDApOwogICAgICAgIGlmIChkPDEpIAogICAgICAgICAgYnJlYWs7CiAgICAgICAgcz1zLnN1YnN0cmluZyhkKzEpOwogICAgICAgIGlmIChzLmxlbmd0aD09MCkKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGlmICh4Lmxlbmd0aDxtaW5TaXplKSB7CiAgICAgICAgeT1uZXcgQXJyYXkobWluU2l6ZSk7CiAgICAgICAgY29weV8oeSx4KTsKICAgICAgICByZXR1cm4geTsKICAgICAgfQogICAgICByZXR1cm4geDsKICAgIH0KCiAgICAvLyBsb2cyKGJhc2UpKmsKICAgIHZhciBiYiA9IGJhc2UsIHAgPSAwOwogICAgdmFyIGIgPSBiYXNlID09IDEgPyBrIDogMDsKICAgIHdoaWxlIChiYiA+IDEpIHsKICAgICAgaWYgKGJiICYgMSkgcCA9IDE7CiAgICAgIGIgKz0gazsKICAgICAgYmIgPj49IDE7CiAgICB9CiAgICBiICs9IHAqazsKCiAgICB4PWludDJiaWdJbnQoMCxiLDApOwogICAgZm9yIChpPTA7aTxrO2krKykgewogICAgICBkPWRpZ2l0c1N0ci5pbmRleE9mKHMuc3Vic3RyaW5nKGksaSsxKSwwKTsKICAgICAgaWYgKGJhc2U8PTM2ICYmIGQ+PTM2KSAgLy9jb252ZXJ0IGxvd2VyY2FzZSB0byB1cHBlcmNhc2UgaWYgYmFzZTw9MzYKICAgICAgICBkLT0yNjsKICAgICAgaWYgKGQ+PWJhc2UgfHwgZDwwKSB7ICAgLy9zdG9wIGF0IGZpcnN0IGlsbGVnYWwgY2hhcmFjdGVyCiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgbXVsdEludF8oeCxiYXNlKTsKICAgICAgYWRkSW50Xyh4LGQpOwogICAgfQoKICAgIGZvciAoaz14Lmxlbmd0aDtrPjAgJiYgIXhbay0xXTtrLS0pOyAvL3N0cmlwIG9mZiBsZWFkaW5nIHplcm9zCiAgICBrPW1pblNpemU+aysxID8gbWluU2l6ZSA6IGsrMTsKICAgIHk9bmV3IEFycmF5KGspOwogICAga2s9azx4Lmxlbmd0aCA/IGsgOiB4Lmxlbmd0aDsKICAgIGZvciAoaT0wO2k8a2s7aSsrKQogICAgICB5W2ldPXhbaV07CiAgICBmb3IgKDtpPGs7aSsrKQogICAgICB5W2ldPTA7CiAgICByZXR1cm4geTsKICB9CgogIC8vaXMgYmlnaW50IHggZXF1YWwgdG8gaW50ZWdlciB5PwogIC8veSBtdXN0IGhhdmUgbGVzcyB0aGFuIGJwZSBiaXRzCiAgZnVuY3Rpb24gZXF1YWxzSW50KHgseSkgewogICAgdmFyIGk7CiAgICBpZiAoeFswXSE9eSkKICAgICAgcmV0dXJuIDA7CiAgICBmb3IgKGk9MTtpPHgubGVuZ3RoO2krKykKICAgICAgaWYgKHhbaV0pCiAgICAgICAgcmV0dXJuIDA7CiAgICByZXR1cm4gMTsKICB9CgogIC8vYXJlIGJpZ2ludHMgeCBhbmQgeSBlcXVhbD8KICAvL3RoaXMgd29ya3MgZXZlbiBpZiB4IGFuZCB5IGFyZSBkaWZmZXJlbnQgbGVuZ3RocyBhbmQgaGF2ZSBhcmJpdHJhcmlseSBtYW55IGxlYWRpbmcgemVyb3MKICBmdW5jdGlvbiBlcXVhbHMoeCx5KSB7CiAgICB2YXIgaTsKICAgIHZhciBrPXgubGVuZ3RoPHkubGVuZ3RoID8geC5sZW5ndGggOiB5Lmxlbmd0aDsKICAgIGZvciAoaT0wO2k8aztpKyspCiAgICAgIGlmICh4W2ldIT15W2ldKQogICAgICAgIHJldHVybiAwOwogICAgaWYgKHgubGVuZ3RoPnkubGVuZ3RoKSB7CiAgICAgIGZvciAoO2k8eC5sZW5ndGg7aSsrKQogICAgICAgIGlmICh4W2ldKQogICAgICAgICAgcmV0dXJuIDA7CiAgICB9IGVsc2UgewogICAgICBmb3IgKDtpPHkubGVuZ3RoO2krKykKICAgICAgICBpZiAoeVtpXSkKICAgICAgICAgIHJldHVybiAwOwogICAgfQogICAgcmV0dXJuIDE7CiAgfQoKICAvL2lzIHRoZSBiaWdJbnQgeCBlcXVhbCB0byB6ZXJvPwogIGZ1bmN0aW9uIGlzWmVybyh4KSB7CiAgICB2YXIgaTsKICAgIGZvciAoaT0wO2k8eC5sZW5ndGg7aSsrKQogICAgICBpZiAoeFtpXSkKICAgICAgICByZXR1cm4gMDsKICAgIHJldHVybiAxOwogIH0KCiAgLy9jb252ZXJ0IGEgYmlnSW50IGludG8gYSBzdHJpbmcgaW4gYSBnaXZlbiBiYXNlLCBmcm9tIGJhc2UgMiB1cCB0byBiYXNlIDk1LgogIC8vQmFzZSAtMSBwcmludHMgdGhlIGNvbnRlbnRzIG9mIHRoZSBhcnJheSByZXByZXNlbnRpbmcgdGhlIG51bWJlci4KICBmdW5jdGlvbiBiaWdJbnQyc3RyKHgsYmFzZSkgewogICAgdmFyIGksdCxzPSIiOwoKICAgIGlmIChzNi5sZW5ndGghPXgubGVuZ3RoKSAKICAgICAgczY9ZHVwKHgpOwogICAgZWxzZQogICAgICBjb3B5XyhzNix4KTsKCiAgICBpZiAoYmFzZT09LTEpIHsgLy9yZXR1cm4gdGhlIGxpc3Qgb2YgYXJyYXkgY29udGVudHMKICAgICAgZm9yIChpPXgubGVuZ3RoLTE7aT4wO2ktLSkKICAgICAgICBzKz14W2ldKycsJzsKICAgICAgcys9eFswXTsKICAgIH0KICAgIGVsc2UgeyAvL3JldHVybiBpdCBpbiB0aGUgZ2l2ZW4gYmFzZQogICAgICB3aGlsZSAoIWlzWmVybyhzNikpIHsKICAgICAgICB0PWRpdkludF8oczYsYmFzZSk7ICAvL3Q9czYgJSBiYXNlOyBzNj1mbG9vcihzNi9iYXNlKTsKICAgICAgICBzPWRpZ2l0c1N0ci5zdWJzdHJpbmcodCx0KzEpK3M7CiAgICAgIH0KICAgIH0KICAgIGlmIChzLmxlbmd0aD09MCkKICAgICAgcz0iMCI7CiAgICByZXR1cm4gczsKICB9CgogIC8vcmV0dXJucyBhIGR1cGxpY2F0ZSBvZiBiaWdJbnQgeAogIGZ1bmN0aW9uIGR1cCh4KSB7CiAgICB2YXIgaSwgYnVmZjsKICAgIGJ1ZmY9bmV3IEFycmF5KHgubGVuZ3RoKTsKICAgIGNvcHlfKGJ1ZmYseCk7CiAgICByZXR1cm4gYnVmZjsKICB9CgogIC8vZG8geD15IG9uIGJpZ0ludHMgeCBhbmQgeS4gIHggbXVzdCBiZSBhbiBhcnJheSBhdCBsZWFzdCBhcyBiaWcgYXMgeSAobm90IGNvdW50aW5nIHRoZSBsZWFkaW5nIHplcm9zIGluIHkpLgogIGZ1bmN0aW9uIGNvcHlfKHgseSkgewogICAgdmFyIGk7CiAgICB2YXIgaz14Lmxlbmd0aDx5Lmxlbmd0aCA/IHgubGVuZ3RoIDogeS5sZW5ndGg7CiAgICBmb3IgKGk9MDtpPGs7aSsrKQogICAgICB4W2ldPXlbaV07CiAgICBmb3IgKGk9aztpPHgubGVuZ3RoO2krKykKICAgICAgeFtpXT0wOwogIH0KCiAgLy9kbyB4PXkgb24gYmlnSW50IHggYW5kIGludGVnZXIgeS4gIAogIGZ1bmN0aW9uIGNvcHlJbnRfKHgsbikgewogICAgdmFyIGksYzsKICAgIGZvciAoYz1uLGk9MDtpPHgubGVuZ3RoO2krKykgewogICAgICB4W2ldPWMgJiBtYXNrOwogICAgICBjPj49YnBlOwogICAgfQogIH0KCiAgLy9kbyB4PXgrbiB3aGVyZSB4IGlzIGEgYmlnSW50IGFuZCBuIGlzIGFuIGludGVnZXIuCiAgLy94IG11c3QgYmUgbGFyZ2UgZW5vdWdoIHRvIGhvbGQgdGhlIHJlc3VsdC4KICBmdW5jdGlvbiBhZGRJbnRfKHgsbikgewogICAgdmFyIGksayxjLGI7CiAgICB4WzBdKz1uOwogICAgaz14Lmxlbmd0aDsKICAgIGM9MDsKICAgIGZvciAoaT0wO2k8aztpKyspIHsKICAgICAgYys9eFtpXTsKICAgICAgYj0wOwogICAgICBpZiAoYzwwKSB7CiAgICAgICAgYiA9IGMgJiBtYXNrOwogICAgICAgIGIgPSAtKChjIC0gYikgLyByYWRpeCk7CiAgICAgICAgYys9YipyYWRpeDsKICAgICAgfQogICAgICB4W2ldPWMgJiBtYXNrOwogICAgICBjID0gKChjIC0geFtpXSkgLyByYWRpeCkgLSBiOwogICAgICBpZiAoIWMpIHJldHVybjsgLy9zdG9wIGNhcnJ5aW5nIGFzIHNvb24gYXMgdGhlIGNhcnJ5IGlzIHplcm8KICAgIH0KICB9CgogIC8vcmlnaHQgc2hpZnQgYmlnSW50IHggYnkgbiBiaXRzLgogIGZ1bmN0aW9uIHJpZ2h0U2hpZnRfKHgsbikgewogICAgdmFyIGk7CiAgICB2YXIgaz1NYXRoLmZsb29yKG4vYnBlKTsKICAgIGlmIChrKSB7CiAgICAgIGZvciAoaT0wO2k8eC5sZW5ndGgtaztpKyspIC8vcmlnaHQgc2hpZnQgeCBieSBrIGVsZW1lbnRzCiAgICAgICAgeFtpXT14W2kra107CiAgICAgIGZvciAoO2k8eC5sZW5ndGg7aSsrKQogICAgICAgIHhbaV09MDsKICAgICAgbiU9YnBlOwogICAgfQogICAgZm9yIChpPTA7aTx4Lmxlbmd0aC0xO2krKykgewogICAgICB4W2ldPW1hc2sgJiAoKHhbaSsxXTw8KGJwZS1uKSkgfCAoeFtpXT4+bikpOwogICAgfQogICAgeFtpXT4+PW47CiAgfQoKICAvL2RvIHg9Zmxvb3IofHh8LzIpKnNnbih4KSBmb3IgYmlnSW50IHggaW4gMidzIGNvbXBsZW1lbnQKICBmdW5jdGlvbiBoYWx2ZV8oeCkgewogICAgdmFyIGk7CiAgICBmb3IgKGk9MDtpPHgubGVuZ3RoLTE7aSsrKSB7CiAgICAgIHhbaV09bWFzayAmICgoeFtpKzFdPDwoYnBlLTEpKSB8ICh4W2ldPj4xKSk7CiAgICB9CiAgICB4W2ldPSh4W2ldPj4xKSB8ICh4W2ldICYgKHJhZGl4Pj4xKSk7ICAvL21vc3Qgc2lnbmlmaWNhbnQgYml0IHN0YXlzIHRoZSBzYW1lCiAgfQoKICAvL2xlZnQgc2hpZnQgYmlnSW50IHggYnkgbiBiaXRzLgogIGZ1bmN0aW9uIGxlZnRTaGlmdF8oeCxuKSB7CiAgICB2YXIgaTsKICAgIHZhciBrPU1hdGguZmxvb3Iobi9icGUpOwogICAgaWYgKGspIHsKICAgICAgZm9yIChpPXgubGVuZ3RoOyBpPj1rOyBpLS0pIC8vbGVmdCBzaGlmdCB4IGJ5IGsgZWxlbWVudHMKICAgICAgICB4W2ldPXhbaS1rXTsKICAgICAgZm9yICg7aT49MDtpLS0pCiAgICAgICAgeFtpXT0wOyAgCiAgICAgIG4lPWJwZTsKICAgIH0KICAgIGlmICghbikKICAgICAgcmV0dXJuOwogICAgZm9yIChpPXgubGVuZ3RoLTE7aT4wO2ktLSkgewogICAgICB4W2ldPW1hc2sgJiAoKHhbaV08PG4pIHwgKHhbaS0xXT4+KGJwZS1uKSkpOwogICAgfQogICAgeFtpXT1tYXNrICYgKHhbaV08PG4pOwogIH0KCiAgLy9kbyB4PXgqbiB3aGVyZSB4IGlzIGEgYmlnSW50IGFuZCBuIGlzIGFuIGludGVnZXIuCiAgLy94IG11c3QgYmUgbGFyZ2UgZW5vdWdoIHRvIGhvbGQgdGhlIHJlc3VsdC4KICBmdW5jdGlvbiBtdWx0SW50Xyh4LG4pIHsKICAgIHZhciBpLGssYyxiOwogICAgaWYgKCFuKQogICAgICByZXR1cm47CiAgICBrPXgubGVuZ3RoOwogICAgYz0wOwogICAgZm9yIChpPTA7aTxrO2krKykgewogICAgICBjKz14W2ldKm47CiAgICAgIGI9MDsKICAgICAgaWYgKGM8MCkgewogICAgICAgIGIgPSBjICYgbWFzazsKICAgICAgICBiID0gLSgoYyAtIGIpIC8gcmFkaXgpOwogICAgICAgIGMrPWIqcmFkaXg7CiAgICAgIH0KICAgICAgeFtpXT1jICYgbWFzazsKICAgICAgYyA9ICgoYyAtIHhbaV0pIC8gcmFkaXgpIC0gYjsKICAgIH0KICB9CgogIC8vZG8geD1mbG9vcih4L24pIGZvciBiaWdJbnQgeCBhbmQgaW50ZWdlciBuLCBhbmQgcmV0dXJuIHRoZSByZW1haW5kZXIKICBmdW5jdGlvbiBkaXZJbnRfKHgsbikgewogICAgdmFyIGkscj0wLHM7CiAgICBmb3IgKGk9eC5sZW5ndGgtMTtpPj0wO2ktLSkgewogICAgICBzPXIqcmFkaXgreFtpXTsKICAgICAgeFtpXT1NYXRoLmZsb29yKHMvbik7CiAgICAgIHI9cyVuOwogICAgfQogICAgcmV0dXJuIHI7CiAgfQoKICAvL2RvIHRoZSBsaW5lYXIgY29tYmluYXRpb24geD1hKngrYip5IGZvciBiaWdJbnRzIHggYW5kIHksIGFuZCBpbnRlZ2VycyBhIGFuZCBiLgogIC8veCBtdXN0IGJlIGxhcmdlIGVub3VnaCB0byBob2xkIHRoZSBhbnN3ZXIuCiAgZnVuY3Rpb24gbGluQ29tYl8oeCx5LGEsYikgewogICAgdmFyIGksYyxrLGtrOwogICAgaz14Lmxlbmd0aDx5Lmxlbmd0aCA/IHgubGVuZ3RoIDogeS5sZW5ndGg7CiAgICBraz14Lmxlbmd0aDsKICAgIGZvciAoYz0wLGk9MDtpPGs7aSsrKSB7CiAgICAgIGMrPWEqeFtpXStiKnlbaV07CiAgICAgIHhbaV09YyAmIG1hc2s7CiAgICAgIGMgPSAoYyAtIHhbaV0pIC8gcmFkaXg7CiAgICB9CiAgICBmb3IgKGk9aztpPGtrO2krKykgewogICAgICBjKz1hKnhbaV07CiAgICAgIHhbaV09YyAmIG1hc2s7CiAgICAgIGMgPSAoYyAtIHhbaV0pIC8gcmFkaXg7CiAgICB9CiAgfQoKICAvL2RvIHRoZSBsaW5lYXIgY29tYmluYXRpb24geD1hKngrYiooeTw8KHlzKmJwZSkpIGZvciBiaWdJbnRzIHggYW5kIHksIGFuZCBpbnRlZ2VycyBhLCBiIGFuZCB5cy4KICAvL3ggbXVzdCBiZSBsYXJnZSBlbm91Z2ggdG8gaG9sZCB0aGUgYW5zd2VyLgogIGZ1bmN0aW9uIGxpbkNvbWJTaGlmdF8oeCx5LGIseXMpIHsKICAgIHZhciBpLGMsayxrazsKICAgIGs9eC5sZW5ndGg8eXMreS5sZW5ndGggPyB4Lmxlbmd0aCA6IHlzK3kubGVuZ3RoOwogICAga2s9eC5sZW5ndGg7CiAgICBmb3IgKGM9MCxpPXlzO2k8aztpKyspIHsKICAgICAgYys9eFtpXStiKnlbaS15c107CiAgICAgIHhbaV09YyAmIG1hc2s7CiAgICAgIGMgPSAoYyAtIHhbaV0pIC8gcmFkaXg7CiAgICB9CiAgICBmb3IgKGk9aztjICYmIGk8a2s7aSsrKSB7CiAgICAgIGMrPXhbaV07CiAgICAgIHhbaV09YyAmIG1hc2s7CiAgICAgIGMgPSAoYyAtIHhbaV0pIC8gcmFkaXg7CiAgICB9CiAgfQoKICAvL2RvIHg9eCsoeTw8KHlzKmJwZSkpIGZvciBiaWdJbnRzIHggYW5kIHksIGFuZCBpbnRlZ2VycyBhLGIgYW5kIHlzLgogIC8veCBtdXN0IGJlIGxhcmdlIGVub3VnaCB0byBob2xkIHRoZSBhbnN3ZXIuCiAgZnVuY3Rpb24gYWRkU2hpZnRfKHgseSx5cykgewogICAgdmFyIGksYyxrLGtrOwogICAgaz14Lmxlbmd0aDx5cyt5Lmxlbmd0aCA/IHgubGVuZ3RoIDogeXMreS5sZW5ndGg7CiAgICBraz14Lmxlbmd0aDsKICAgIGZvciAoYz0wLGk9eXM7aTxrO2krKykgewogICAgICBjKz14W2ldK3lbaS15c107CiAgICAgIHhbaV09YyAmIG1hc2s7CiAgICAgIGMgPSAoYyAtIHhbaV0pIC8gcmFkaXg7CiAgICB9CiAgICBmb3IgKGk9aztjICYmIGk8a2s7aSsrKSB7CiAgICAgIGMrPXhbaV07CiAgICAgIHhbaV09YyAmIG1hc2s7CiAgICAgIGMgPSAoYyAtIHhbaV0pIC8gcmFkaXg7CiAgICB9CiAgfQoKICAvL2RvIHg9eC0oeTw8KHlzKmJwZSkpIGZvciBiaWdJbnRzIHggYW5kIHksIGFuZCBpbnRlZ2VycyBhLGIgYW5kIHlzLgogIC8veCBtdXN0IGJlIGxhcmdlIGVub3VnaCB0byBob2xkIHRoZSBhbnN3ZXIuCiAgZnVuY3Rpb24gc3ViU2hpZnRfKHgseSx5cykgewogICAgdmFyIGksYyxrLGtrOwogICAgaz14Lmxlbmd0aDx5cyt5Lmxlbmd0aCA/IHgubGVuZ3RoIDogeXMreS5sZW5ndGg7CiAgICBraz14Lmxlbmd0aDsKICAgIGZvciAoYz0wLGk9eXM7aTxrO2krKykgewogICAgICBjKz14W2ldLXlbaS15c107CiAgICAgIHhbaV09YyAmIG1hc2s7CiAgICAgIGMgPSAoYyAtIHhbaV0pIC8gcmFkaXg7CiAgICB9CiAgICBmb3IgKGk9aztjICYmIGk8a2s7aSsrKSB7CiAgICAgIGMrPXhbaV07CiAgICAgIHhbaV09YyAmIG1hc2s7CiAgICAgIGMgPSAoYyAtIHhbaV0pIC8gcmFkaXg7CiAgICB9CiAgfQoKICAvL2RvIHg9eC15IGZvciBiaWdJbnRzIHggYW5kIHkuCiAgLy94IG11c3QgYmUgbGFyZ2UgZW5vdWdoIHRvIGhvbGQgdGhlIGFuc3dlci4KICAvL25lZ2F0aXZlIGFuc3dlcnMgd2lsbCBiZSAycyBjb21wbGVtZW50CiAgZnVuY3Rpb24gc3ViXyh4LHkpIHsKICAgIHZhciBpLGMsayxrazsKICAgIGs9eC5sZW5ndGg8eS5sZW5ndGggPyB4Lmxlbmd0aCA6IHkubGVuZ3RoOwogICAgZm9yIChjPTAsaT0wO2k8aztpKyspIHsKICAgICAgYys9eFtpXS15W2ldOwogICAgICB4W2ldPWMgJiBtYXNrOwogICAgICBjID0gKGMgLSB4W2ldKSAvIHJhZGl4OwogICAgfQogICAgZm9yIChpPWs7YyAmJiBpPHgubGVuZ3RoO2krKykgewogICAgICBjKz14W2ldOwogICAgICB4W2ldPWMgJiBtYXNrOwogICAgICBjID0gKGMgLSB4W2ldKSAvIHJhZGl4OwogICAgfQogIH0KCiAgLy9kbyB4PXgreSBmb3IgYmlnSW50cyB4IGFuZCB5LgogIC8veCBtdXN0IGJlIGxhcmdlIGVub3VnaCB0byBob2xkIHRoZSBhbnN3ZXIuCiAgZnVuY3Rpb24gYWRkXyh4LHkpIHsKICAgIHZhciBpLGMsayxrazsKICAgIGs9eC5sZW5ndGg8eS5sZW5ndGggPyB4Lmxlbmd0aCA6IHkubGVuZ3RoOwogICAgZm9yIChjPTAsaT0wO2k8aztpKyspIHsKICAgICAgYys9eFtpXSt5W2ldOwogICAgICB4W2ldPWMgJiBtYXNrOwogICAgICBjID0gKGMgLSB4W2ldKSAvIHJhZGl4OwogICAgfQogICAgZm9yIChpPWs7YyAmJiBpPHgubGVuZ3RoO2krKykgewogICAgICBjKz14W2ldOwogICAgICB4W2ldPWMgJiBtYXNrOwogICAgICBjID0gKGMgLSB4W2ldKSAvIHJhZGl4OwogICAgfQogIH0KCiAgLy9kbyB4PXgqeSBmb3IgYmlnSW50cyB4IGFuZCB5LiAgVGhpcyBpcyBmYXN0ZXIgd2hlbiB5PHguCiAgZnVuY3Rpb24gbXVsdF8oeCx5KSB7CiAgICB2YXIgaTsKICAgIGlmIChzcy5sZW5ndGghPTIqeC5sZW5ndGgpCiAgICAgIHNzPW5ldyBBcnJheSgyKngubGVuZ3RoKTsKICAgIGNvcHlJbnRfKHNzLDApOwogICAgZm9yIChpPTA7aTx5Lmxlbmd0aDtpKyspCiAgICAgIGlmICh5W2ldKQogICAgICAgIGxpbkNvbWJTaGlmdF8oc3MseCx5W2ldLGkpOyAgIC8vc3M9MSpzcyt5W2ldKih4PDwoaSpicGUpKQogICAgY29weV8oeCxzcyk7CiAgfQoKICAvL2RvIHg9eCBtb2QgbiBmb3IgYmlnSW50cyB4IGFuZCBuLgogIGZ1bmN0aW9uIG1vZF8oeCxuKSB7CiAgICBpZiAoczQubGVuZ3RoIT14Lmxlbmd0aCkKICAgICAgczQ9ZHVwKHgpOwogICAgZWxzZQogICAgICBjb3B5XyhzNCx4KTsKICAgIGlmIChzNS5sZW5ndGghPXgubGVuZ3RoKQogICAgICBzNT1kdXAoeCk7ICAKICAgIGRpdmlkZV8oczQsbixzNSx4KTsgIC8veCA9IHJlbWFpbmRlciBvZiBzNCAvIG4KICB9CgogIC8vZG8geD14KnkgbW9kIG4gZm9yIGJpZ0ludHMgeCx5LG4uCiAgLy9mb3IgZ3JlYXRlciBzcGVlZCwgbGV0IHk8eC4KICBmdW5jdGlvbiBtdWx0TW9kXyh4LHksbikgewogICAgdmFyIGk7CiAgICBpZiAoczAubGVuZ3RoIT0yKngubGVuZ3RoKQogICAgICBzMD1uZXcgQXJyYXkoMip4Lmxlbmd0aCk7CiAgICBjb3B5SW50XyhzMCwwKTsKICAgIGZvciAoaT0wO2k8eS5sZW5ndGg7aSsrKQogICAgICBpZiAoeVtpXSkKICAgICAgICBsaW5Db21iU2hpZnRfKHMwLHgseVtpXSxpKTsgICAvL3MwPTEqczAreVtpXSooeDw8KGkqYnBlKSkKICAgIG1vZF8oczAsbik7CiAgICBjb3B5Xyh4LHMwKTsKICB9CgogIC8vZG8geD14KnggbW9kIG4gZm9yIGJpZ0ludHMgeCxuLgogIGZ1bmN0aW9uIHNxdWFyZU1vZF8oeCxuKSB7CiAgICB2YXIgaSxqLGQsYyxreCxrbixrOwogICAgZm9yIChreD14Lmxlbmd0aDsga3g+MCAmJiAheFtreC0xXTsga3gtLSk7ICAvL2lnbm9yZSBsZWFkaW5nIHplcm9zIGluIHgKICAgIGs9a3g+bi5sZW5ndGggPyAyKmt4IDogMipuLmxlbmd0aDsgLy9rPSMgZWxlbWVudHMgaW4gdGhlIHByb2R1Y3QsIHdoaWNoIGlzIHR3aWNlIHRoZSBlbGVtZW50cyBpbiB0aGUgbGFyZ2VyIG9mIHggYW5kIG4KICAgIGlmIChzMC5sZW5ndGghPWspIAogICAgICBzMD1uZXcgQXJyYXkoayk7CiAgICBjb3B5SW50XyhzMCwwKTsKICAgIGZvciAoaT0wO2k8a3g7aSsrKSB7CiAgICAgIGM9czBbMippXSt4W2ldKnhbaV07CiAgICAgIHMwWzIqaV09YyAmIG1hc2s7CiAgICAgIGMgPSAoYyAtIHMwWzIqaV0pIC8gcmFkaXg7CiAgICAgIGZvciAoaj1pKzE7ajxreDtqKyspIHsKICAgICAgICBjPXMwW2kral0rMip4W2ldKnhbal0rYzsKICAgICAgICBzMFtpK2pdPShjICYgbWFzayk7CiAgICAgICAgYyA9IChjIC0gczBbaStqXSkgLyByYWRpeDsKICAgICAgfQogICAgICBzMFtpK2t4XT1jOwogICAgfQogICAgbW9kXyhzMCxuKTsKICAgIGNvcHlfKHgsczApOwogIH0KCiAgLy9yZXR1cm4geCB3aXRoIGV4YWN0bHkgayBsZWFkaW5nIHplcm8gZWxlbWVudHMKICBmdW5jdGlvbiB0cmltKHgsaykgewogICAgdmFyIGkseTsKICAgIGZvciAoaT14Lmxlbmd0aDsgaT4wICYmICF4W2ktMV07IGktLSk7CiAgICB5PW5ldyBBcnJheShpK2spOwogICAgY29weV8oeSx4KTsKICAgIHJldHVybiB5OwogIH0KCiAgLy9kbyB4PXgqKnkgbW9kIG4sIHdoZXJlIHgseSxuIGFyZSBiaWdJbnRzIGFuZCAqKiBpcyBleHBvbmVudGlhdGlvbi4gIDAqKjA9MS4KICAvL3RoaXMgaXMgZmFzdGVyIHdoZW4gbiBpcyBvZGQuICB4IHVzdWFsbHkgbmVlZHMgdG8gaGF2ZSBhcyBtYW55IGVsZW1lbnRzIGFzIG4uCiAgZnVuY3Rpb24gcG93TW9kXyh4LHksbikgewogICAgdmFyIGsxLGsyLGtuLG5wOwogICAgaWYoczcubGVuZ3RoIT1uLmxlbmd0aCkKICAgICAgczc9ZHVwKG4pOwoKICAgIC8vZm9yIGV2ZW4gbW9kdWx1cywgdXNlIGEgc2ltcGxlIHNxdWFyZS1hbmQtbXVsdGlwbHkgYWxnb3JpdGhtLAogICAgLy9yYXRoZXIgdGhhbiB1c2luZyB0aGUgbW9yZSBjb21wbGV4IE1vbnRnb21lcnkgYWxnb3JpdGhtLgogICAgaWYgKChuWzBdJjEpPT0wKSB7CiAgICAgIGNvcHlfKHM3LHgpOwogICAgICBjb3B5SW50Xyh4LDEpOwogICAgICB3aGlsZSghZXF1YWxzSW50KHksMCkpIHsKICAgICAgICBpZiAoeVswXSYxKQogICAgICAgICAgbXVsdE1vZF8oeCxzNyxuKTsKICAgICAgICBkaXZJbnRfKHksMik7CiAgICAgICAgc3F1YXJlTW9kXyhzNyxuKTsgCiAgICAgIH0KICAgICAgcmV0dXJuOwogICAgfQoKICAgIC8vY2FsY3VsYXRlIG5wIGZyb20gbiBmb3IgdGhlIE1vbnRnb21lcnkgbXVsdGlwbGljYXRpb25zCiAgICBjb3B5SW50XyhzNywwKTsKICAgIGZvciAoa249bi5sZW5ndGg7a24+MCAmJiAhbltrbi0xXTtrbi0tKTsKICAgIG5wPXJhZGl4LWludmVyc2VNb2RJbnQobW9kSW50KG4scmFkaXgpLHJhZGl4KTsKICAgIHM3W2tuXT0xOwogICAgbXVsdE1vZF8oeCAsczcsbik7ICAgLy8geCA9IHggKiAyKiooa24qYnApIG1vZCBuCgogICAgaWYgKHMzLmxlbmd0aCE9eC5sZW5ndGgpCiAgICAgIHMzPWR1cCh4KTsKICAgIGVsc2UKICAgICAgY29weV8oczMseCk7CgogICAgZm9yIChrMT15Lmxlbmd0aC0xO2sxPjAgJiAheVtrMV07IGsxLS0pOyAgLy9rMT1maXJzdCBub256ZXJvIGVsZW1lbnQgb2YgeQogICAgaWYgKHlbazFdPT0wKSB7ICAvL2FueXRoaW5nIHRvIHRoZSAwdGggcG93ZXIgaXMgMQogICAgICBjb3B5SW50Xyh4LDEpOwogICAgICByZXR1cm47CiAgICB9CiAgICBmb3IgKGsyPTE8PChicGUtMSk7azIgJiYgISh5W2sxXSAmIGsyKTsgazI+Pj0xKTsgIC8vazI9cG9zaXRpb24gb2YgZmlyc3QgMSBiaXQgaW4geVtrMV0KICAgIGZvciAoOzspIHsKICAgICAgaWYgKCEoazI+Pj0xKSkgeyAgLy9sb29rIGF0IG5leHQgYml0IG9mIHkKICAgICAgICBrMS0tOwogICAgICAgIGlmIChrMTwwKSB7CiAgICAgICAgICBtb250Xyh4LG9uZSxuLG5wKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgazI9MTw8KGJwZS0xKTsKICAgICAgfSAgICAKICAgICAgbW9udF8oeCx4LG4sbnApOwoKICAgICAgaWYgKGsyICYgeVtrMV0pIC8vaWYgbmV4dCBiaXQgaXMgYSAxCiAgICAgICAgbW9udF8oeCxzMyxuLG5wKTsKICAgIH0KICB9CgoKICAvL2RvIHg9eCp5KlJpIG1vZCBuIGZvciBiaWdJbnRzIHgseSxuLCAKICAvLyAgd2hlcmUgUmkgPSAyKiooLWtuKmJwZSkgbW9kIG4sIGFuZCBrbiBpcyB0aGUgCiAgLy8gIG51bWJlciBvZiBlbGVtZW50cyBpbiB0aGUgbiBhcnJheSwgbm90IAogIC8vICBjb3VudGluZyBsZWFkaW5nIHplcm9zLiAgCiAgLy94IGFycmF5IG11c3QgaGF2ZSBhdCBsZWFzdCBhcyBtYW55IGVsZW1udHMgYXMgdGhlIG4gYXJyYXkKICAvL0l0J3MgT0sgaWYgeCBhbmQgeSBhcmUgdGhlIHNhbWUgdmFyaWFibGUuCiAgLy9tdXN0IGhhdmU6CiAgLy8gIHgseSA8IG4KICAvLyAgbiBpcyBvZGQKICAvLyAgbnAgPSAtKG5eKC0xKSkgbW9kIHJhZGl4CiAgZnVuY3Rpb24gbW9udF8oeCx5LG4sbnApIHsKICAgIHZhciBpLGosYyx1aSx0LHQyLGtzOwogICAgdmFyIGtuPW4ubGVuZ3RoOwogICAgdmFyIGt5PXkubGVuZ3RoOwoKICAgIGlmIChzYS5sZW5ndGghPWtuKQogICAgICBzYT1uZXcgQXJyYXkoa24pOwogICAgICAKICAgIGNvcHlJbnRfKHNhLDApOwoKICAgIGZvciAoO2tuPjAgJiYgbltrbi0xXT09MDtrbi0tKTsgLy9pZ25vcmUgbGVhZGluZyB6ZXJvcyBvZiBuCiAgICBmb3IgKDtreT4wICYmIHlba3ktMV09PTA7a3ktLSk7IC8vaWdub3JlIGxlYWRpbmcgemVyb3Mgb2YgeQogICAga3M9c2EubGVuZ3RoLTE7IC8vc2Egd2lsbCBuZXZlciBoYXZlIG1vcmUgdGhhbiB0aGlzIG1hbnkgbm9uemVybyBlbGVtZW50cy4gIAoKICAgIC8vdGhlIGZvbGxvd2luZyBsb29wIGNvbnN1bWVzIDk1JSBvZiB0aGUgcnVudGltZSBmb3IgcmFuZFRydWVQcmltZV8oKSBhbmQgcG93TW9kXygpIGZvciBsYXJnZSBudW1iZXJzCiAgICBmb3IgKGk9MDsgaTxrbjsgaSsrKSB7CiAgICAgIHQ9c2FbMF0reFtpXSp5WzBdOwogICAgICB1aT0oKHQgJiBtYXNrKSAqIG5wKSAmIG1hc2s7ICAvL3RoZSBpbm5lciAiJiBtYXNrIiB3YXMgbmVlZGVkIG9uIFNhZmFyaSAoYnV0IG5vdCBNU0lFKSBhdCBvbmUgdGltZQogICAgICBjPSh0K3VpKm5bMF0pOwogICAgICBjID0gKGMgLSAoYyAmIG1hc2spKSAvIHJhZGl4OwogICAgICB0PXhbaV07CiAgICAgIAogICAgICAvL2RvIHNhPShzYSt4W2ldKnkrdWkqbikvYiAgIHdoZXJlIGI9MioqYnBlLiAgTG9vcCBpcyB1bnJvbGxlZCA1LWZvbGQgZm9yIHNwZWVkCiAgICAgIGo9MTsKICAgICAgZm9yICg7ajxreS00OykgewogICAgICAgIGMrPXNhW2pdK3VpKm5bal0rdCp5W2pdOyB0Mj1zYVtqLTFdPWMgJiBtYXNrOyBjPShjLXQyKS9yYWRpeDsgaisrOwogICAgICAgIGMrPXNhW2pdK3VpKm5bal0rdCp5W2pdOyB0Mj1zYVtqLTFdPWMgJiBtYXNrOyBjPShjLXQyKS9yYWRpeDsgaisrOwogICAgICAgIGMrPXNhW2pdK3VpKm5bal0rdCp5W2pdOyB0Mj1zYVtqLTFdPWMgJiBtYXNrOyBjPShjLXQyKS9yYWRpeDsgaisrOwogICAgICAgIGMrPXNhW2pdK3VpKm5bal0rdCp5W2pdOyB0Mj1zYVtqLTFdPWMgJiBtYXNrOyBjPShjLXQyKS9yYWRpeDsgaisrOwogICAgICAgIGMrPXNhW2pdK3VpKm5bal0rdCp5W2pdOyB0Mj1zYVtqLTFdPWMgJiBtYXNrOyBjPShjLXQyKS9yYWRpeDsgaisrOwogICAgICB9CiAgICAgIGZvciAoO2o8a3k7KSAgIHsKICAgICAgICBjKz1zYVtqXSt1aSpuW2pdK3QqeVtqXTsgdDI9c2Fbai0xXT1jICYgbWFzazsgYz0oYy10MikvcmFkaXg7IGorKzsKICAgICAgfQogICAgICBmb3IgKDtqPGtuLTQ7KSB7CiAgICAgICAgYys9c2Fbal0rdWkqbltqXTsgICAgICAgIHQyPXNhW2otMV09YyAmIG1hc2s7IGM9KGMtdDIpL3JhZGl4OyBqKys7CiAgICAgICAgYys9c2Fbal0rdWkqbltqXTsgICAgICAgIHQyPXNhW2otMV09YyAmIG1hc2s7IGM9KGMtdDIpL3JhZGl4OyBqKys7CiAgICAgICAgYys9c2Fbal0rdWkqbltqXTsgICAgICAgIHQyPXNhW2otMV09YyAmIG1hc2s7IGM9KGMtdDIpL3JhZGl4OyBqKys7CiAgICAgICAgYys9c2Fbal0rdWkqbltqXTsgICAgICAgIHQyPXNhW2otMV09YyAmIG1hc2s7IGM9KGMtdDIpL3JhZGl4OyBqKys7CiAgICAgICAgYys9c2Fbal0rdWkqbltqXTsgICAgICAgIHQyPXNhW2otMV09YyAmIG1hc2s7IGM9KGMtdDIpL3JhZGl4OyBqKys7CiAgICAgIH0KICAgICAgZm9yICg7ajxrbjspICAgewogICAgICAgIGMrPXNhW2pdK3VpKm5bal07ICAgICAgICB0Mj1zYVtqLTFdPWMgJiBtYXNrOyBjPShjLXQyKS9yYWRpeDsgaisrOwogICAgICB9CiAgICAgIGZvciAoO2o8a3M7KSAgIHsKICAgICAgICBjKz1zYVtqXTsgICAgICAgICAgICAgICAgdDI9c2Fbai0xXT1jICYgbWFzazsgYz0oYy10MikvcmFkaXg7IGorKzsKICAgICAgfQogICAgICBzYVtqLTFdPWMgJiBtYXNrOwogICAgfQoKICAgIGlmICghZ3JlYXRlcihuLHNhKSkKICAgICAgc3ViXyhzYSxuKTsKICAgIGNvcHlfKHgsc2EpOwogIH0KCgogIC8vIG90ci5qcyBhZGRpdGlvbnMKCgogIC8vIGNvbXB1dGVzIG51bSAvIGRlbiBtb2QgbgogIGZ1bmN0aW9uIGRpdk1vZChudW0sIGRlbiwgbikgewogICAgcmV0dXJuIG11bHRNb2QobnVtLCBpbnZlcnNlTW9kKGRlbiwgbiksIG4pCiAgfQoKICAvLyBjb21wdXRlcyBvbmUgLSB0d28gbW9kIG4KICBmdW5jdGlvbiBzdWJNb2Qob25lLCB0d28sIG4pIHsKICAgIG9uZSA9IG1vZChvbmUsIG4pCiAgICB0d28gPSBtb2QodHdvLCBuKQogICAgaWYgKGdyZWF0ZXIodHdvLCBvbmUpKSBvbmUgPSBhZGQob25lLCBuKQogICAgcmV0dXJuIHN1YihvbmUsIHR3bykKICB9CgogIC8vIGNvbXB1dGVzIDJebSBhcyBhIGJpZ0ludAogIGZ1bmN0aW9uIHR3b1RvVGhlKG0pIHsKICAgIHZhciBiID0gTWF0aC5mbG9vcihtIC8gYnBlKSArIDIKICAgIHZhciB0ID0gbmV3IEFycmF5KGIpCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGI7IGkrKykgdFtpXSA9IDAKICAgIHRbYiAtIDJdID0gMSA8PCAobSAlIGJwZSkKICAgIHJldHVybiB0CiAgfQoKICAvLyBjYWNoZSB0aGVzZSByZXN1bHRzIGZvciBmYXN0ZXIgbG9va3VwCiAgdmFyIF9udW0yYmluID0gKGZ1bmN0aW9uICgpIHsKICAgIHZhciBpID0gMCwgX251bTJiaW49IHt9CiAgICBmb3IgKDsgaSA8IDB4MTAwOyArK2kpIHsKICAgICAgX251bTJiaW5baV0gPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGkpICAvLyAwIC0+ICJcMDAiCiAgICB9CiAgICByZXR1cm4gX251bTJiaW4KICB9KCkpCgogIC8vIHNlcmlhbGl6ZSBhIGJpZ0ludCB0byBhbiBhc2NpaSBzdHJpbmcKICAvLyBwYWRkZWQgdXAgdG8gcGFkIGxlbmd0aAogIGZ1bmN0aW9uIGJpZ0ludDJiaXRzKGJpLCBwYWQpIHsKICAgIHBhZCB8fCAocGFkID0gMCkKICAgIGJpID0gZHVwKGJpKQogICAgdmFyIGJhID0gJycKICAgIHdoaWxlICghaXNaZXJvKGJpKSkgewogICAgICBiYSA9IF9udW0yYmluW2JpWzBdICYgMHhmZl0gKyBiYQogICAgICByaWdodFNoaWZ0XyhiaSwgOCkKICAgIH0KICAgIHdoaWxlIChiYS5sZW5ndGggPCBwYWQpIHsKICAgICAgYmEgPSAnXHgwMCcgKyBiYQogICAgfQogICAgcmV0dXJuIGJhCiAgfQoKICAvLyBjb252ZXJ0cyBhIGJ5dGUgYXJyYXkgdG8gYSBiaWdJbnQKICBmdW5jdGlvbiBiYTJiaWdJbnQoZGF0YSkgewogICAgdmFyIG1waSA9IHN0cjJiaWdJbnQoJzAnLCAxMCwgZGF0YS5sZW5ndGgpCiAgICBkYXRhLmZvckVhY2goZnVuY3Rpb24gKGQsIGkpIHsKICAgICAgaWYgKGkpIGxlZnRTaGlmdF8obXBpLCA4KQogICAgICBtcGlbMF0gfD0gZAogICAgfSkKICAgIHJldHVybiBtcGkKICB9CgogIC8vIHJldHVybnMgYSBmdW5jdGlvbiB0aGF0IHJldHVybnMgYW4gYXJyYXkgb2YgbiBieXRlcwogIHZhciByYW5kb21CeXRlcyA9IChmdW5jdGlvbiAoKSB7CgogICAgLy8gaW4gbm9kZQogICAgaWYgKCB0eXBlb2YgY3J5cHRvICE9PSAndW5kZWZpbmVkJyAmJgogICAgICB0eXBlb2YgY3J5cHRvLnJhbmRvbUJ5dGVzID09PSAnZnVuY3Rpb24nICkgewogICAgICByZXR1cm4gZnVuY3Rpb24gKG4pIHsKICAgICAgICB0cnkgewogICAgICAgICAgdmFyIGJ1ZiA9IGNyeXB0by5yYW5kb21CeXRlcyhuKQogICAgICAgIH0gY2F0Y2ggKGUpIHsgdGhyb3cgZSB9CiAgICAgICAgcmV0dXJuIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGJ1ZiwgMCkKICAgICAgfQogICAgfQoKICAgIC8vIGluIGJyb3dzZXIKICAgIGVsc2UgaWYgKCB0eXBlb2YgY3J5cHRvICE9PSAndW5kZWZpbmVkJyAmJgogICAgICB0eXBlb2YgY3J5cHRvLmdldFJhbmRvbVZhbHVlcyA9PT0gJ2Z1bmN0aW9uJyApIHsKICAgICAgcmV0dXJuIGZ1bmN0aW9uIChuKSB7CiAgICAgICAgdmFyIGJ1ZiA9IG5ldyBVaW50OEFycmF5KG4pCiAgICAgICAgY3J5cHRvLmdldFJhbmRvbVZhbHVlcyhidWYpCiAgICAgICAgcmV0dXJuIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGJ1ZiwgMCkKICAgICAgfQogICAgfQoKICAgIC8vIGVycgogICAgZWxzZSB7CiAgICAgIGNvbnNvbGUubG9nKCdLZXlzIHNob3VsZCBub3QgYmUgZ2VuZXJhdGVkIHdpdGhvdXQgQ1NQUk5HLicpOwogICAgICByZXR1cm47CiAgICAgIC8vIHRocm93IG5ldyBFcnJvcignS2V5cyBzaG91bGQgbm90IGJlIGdlbmVyYXRlZCB3aXRob3V0IENTUFJORy4nKQogICAgfQoKICB9KCkpCgogIC8vIFNhbHNhIDIwIGluIHdlYndvcmtlciBuZWVkcyBhIDQwIGJ5dGUgc2VlZAogIGZ1bmN0aW9uIGdldFNlZWQoKSB7CiAgICByZXR1cm4gcmFuZG9tQnl0ZXMoNDApCiAgfQoKICAvLyByZXR1cm5zIGEgc2luZ2xlIHJhbmRvbSBieXRlCiAgZnVuY3Rpb24gcmFuZG9tQnl0ZSgpIHsKICAgIHJldHVybiByYW5kb21CeXRlcygxKVswXQogIH0KCiAgLy8gcmV0dXJucyBhIGstYml0IHJhbmRvbSBpbnRlZ2VyCiAgZnVuY3Rpb24gcmFuZG9tQml0SW50KGspIHsKICAgIGlmIChrID4gMzEpIHRocm93IG5ldyBFcnJvcigiVG9vIG1hbnkgYml0cy4iKQogICAgdmFyIGkgPSAwLCByID0gMAogICAgdmFyIGIgPSBNYXRoLmZsb29yKGsgLyA4KQogICAgdmFyIG1hc2sgPSAoMSA8PCAoayAlIDgpKSAtIDEKICAgIGlmIChtYXNrKSByID0gcmFuZG9tQnl0ZSgpICYgbWFzawogICAgZm9yICg7IGkgPCBiOyBpKyspCiAgICAgIHIgPSAoMjU2ICogcikgKyByYW5kb21CeXRlKCkKICAgIHJldHVybiByCiAgfQoKICByZXR1cm4gewogICAgICBzdHIyYmlnSW50ICAgIDogc3RyMmJpZ0ludAogICAgLCBiaWdJbnQyc3RyICAgIDogYmlnSW50MnN0cgogICAgLCBpbnQyYmlnSW50ICAgIDogaW50MmJpZ0ludAogICAgLCBtdWx0TW9kICAgICAgIDogbXVsdE1vZAogICAgLCBwb3dNb2QgICAgICAgIDogcG93TW9kCiAgICAsIGludmVyc2VNb2QgICAgOiBpbnZlcnNlTW9kCiAgICAsIHJhbmRCaWdJbnQgICAgOiByYW5kQmlnSW50CiAgICAsIHJhbmRCaWdJbnRfICAgOiByYW5kQmlnSW50XwogICAgLCBlcXVhbHMgICAgICAgIDogZXF1YWxzCiAgICAsIGVxdWFsc0ludCAgICAgOiBlcXVhbHNJbnQKICAgICwgc3ViICAgICAgICAgICA6IHN1YgogICAgLCBtb2QgICAgICAgICAgIDogbW9kCiAgICAsIG1vZEludCAgICAgICAgOiBtb2RJbnQKICAgICwgbXVsdCAgICAgICAgICA6IG11bHQKICAgICwgZGl2SW50XyAgICAgICA6IGRpdkludF8KICAgICwgcmlnaHRTaGlmdF8gICA6IHJpZ2h0U2hpZnRfCiAgICAsIGR1cCAgICAgICAgICAgOiBkdXAKICAgICwgZ3JlYXRlciAgICAgICA6IGdyZWF0ZXIKICAgICwgYWRkICAgICAgICAgICA6IGFkZAogICAgLCBpc1plcm8gICAgICAgIDogaXNaZXJvCiAgICAsIGJpdFNpemUgICAgICAgOiBiaXRTaXplCiAgICAsIG1pbGxlclJhYmluICAgOiBtaWxsZXJSYWJpbgogICAgLCBkaXZpZGVfICAgICAgIDogZGl2aWRlXwogICAgLCB0cmltICAgICAgICAgIDogdHJpbQogICAgLCBwcmltZXMgICAgICAgIDogcHJpbWVzCiAgICAsIGZpbmRQcmltZXMgICAgOiBmaW5kUHJpbWVzCiAgICAsIGdldFNlZWQgICAgICAgOiBnZXRTZWVkCiAgICAsIGRpdk1vZCAgICAgICAgOiBkaXZNb2QKICAgICwgc3ViTW9kICAgICAgICA6IHN1Yk1vZAogICAgLCB0d29Ub1RoZSAgICAgIDogdHdvVG9UaGUKICAgICwgYmlnSW50MmJpdHMgICA6IGJpZ0ludDJiaXRzCiAgICAsIGJhMmJpZ0ludCAgICAgOiBiYTJiaWdJbnQKICB9Cgp9KSkKOwovKiEKICogRXZlbnRFbWl0dGVyIHY0LjIuMyAtIGdpdC5pby9lZQogKiBPbGl2ZXIgQ2FsZHdlbGwKICogTUlUIGxpY2Vuc2UKICogQHByZXNlcnZlCiAqLwoKKGZ1bmN0aW9uICgpIHsKCQoKCS8qKgoJICogQ2xhc3MgZm9yIG1hbmFnaW5nIGV2ZW50cy4KCSAqIENhbiBiZSBleHRlbmRlZCB0byBwcm92aWRlIGV2ZW50IGZ1bmN0aW9uYWxpdHkgaW4gb3RoZXIgY2xhc3Nlcy4KCSAqCgkgKiBAY2xhc3MgRXZlbnRFbWl0dGVyIE1hbmFnZXMgZXZlbnQgcmVnaXN0ZXJpbmcgYW5kIGVtaXR0aW5nLgoJICovCglmdW5jdGlvbiBFdmVudEVtaXR0ZXIoKSB7fQoKCS8vIFNob3J0Y3V0cyB0byBpbXByb3ZlIHNwZWVkIGFuZCBzaXplCgoJLy8gRWFzeSBhY2Nlc3MgdG8gdGhlIHByb3RvdHlwZQoJdmFyIHByb3RvID0gRXZlbnRFbWl0dGVyLnByb3RvdHlwZTsKCgkvKioKCSAqIEZpbmRzIHRoZSBpbmRleCBvZiB0aGUgbGlzdGVuZXIgZm9yIHRoZSBldmVudCBpbiBpdCdzIHN0b3JhZ2UgYXJyYXkuCgkgKgoJICogQHBhcmFtIHtGdW5jdGlvbltdfSBsaXN0ZW5lcnMgQXJyYXkgb2YgbGlzdGVuZXJzIHRvIHNlYXJjaCB0aHJvdWdoLgoJICogQHBhcmFtIHtGdW5jdGlvbn0gbGlzdGVuZXIgTWV0aG9kIHRvIGxvb2sgZm9yLgoJICogQHJldHVybiB7TnVtYmVyfSBJbmRleCBvZiB0aGUgc3BlY2lmaWVkIGxpc3RlbmVyLCAtMSBpZiBub3QgZm91bmQKCSAqIEBhcGkgcHJpdmF0ZQoJICovCglmdW5jdGlvbiBpbmRleE9mTGlzdGVuZXIobGlzdGVuZXJzLCBsaXN0ZW5lcikgewoJCXZhciBpID0gbGlzdGVuZXJzLmxlbmd0aDsKCQl3aGlsZSAoaS0tKSB7CgkJCWlmIChsaXN0ZW5lcnNbaV0ubGlzdGVuZXIgPT09IGxpc3RlbmVyKSB7CgkJCQlyZXR1cm4gaTsKCQkJfQoJCX0KCgkJcmV0dXJuIC0xOwoJfQoKCS8qKgoJICogQWxpYXMgYSBtZXRob2Qgd2hpbGUga2VlcGluZyB0aGUgY29udGV4dCBjb3JyZWN0LCB0byBhbGxvdyBmb3Igb3ZlcndyaXRpbmcgb2YgdGFyZ2V0IG1ldGhvZC4KCSAqCgkgKiBAcGFyYW0ge1N0cmluZ30gbmFtZSBUaGUgbmFtZSBvZiB0aGUgdGFyZ2V0IG1ldGhvZC4KCSAqIEByZXR1cm4ge0Z1bmN0aW9ufSBUaGUgYWxpYXNlZCBtZXRob2QKCSAqIEBhcGkgcHJpdmF0ZQoJICovCglmdW5jdGlvbiBhbGlhcyhuYW1lKSB7CgkJcmV0dXJuIGZ1bmN0aW9uIGFsaWFzQ2xvc3VyZSgpIHsKCQkJcmV0dXJuIHRoaXNbbmFtZV0uYXBwbHkodGhpcywgYXJndW1lbnRzKTsKCQl9OwoJfQoKCS8qKgoJICogUmV0dXJucyB0aGUgbGlzdGVuZXIgYXJyYXkgZm9yIHRoZSBzcGVjaWZpZWQgZXZlbnQuCgkgKiBXaWxsIGluaXRpYWxpc2UgdGhlIGV2ZW50IG9iamVjdCBhbmQgbGlzdGVuZXIgYXJyYXlzIGlmIHJlcXVpcmVkLgoJICogV2lsbCByZXR1cm4gYW4gb2JqZWN0IGlmIHlvdSB1c2UgYSByZWdleCBzZWFyY2guIFRoZSBvYmplY3QgY29udGFpbnMga2V5cyBmb3IgZWFjaCBtYXRjaGVkIGV2ZW50LiBTbyAvYmFbcnpdLyBtaWdodCByZXR1cm4gYW4gb2JqZWN0IGNvbnRhaW5pbmcgYmFyIGFuZCBiYXouIEJ1dCBvbmx5IGlmIHlvdSBoYXZlIGVpdGhlciBkZWZpbmVkIHRoZW0gd2l0aCBkZWZpbmVFdmVudCBvciBhZGRlZCBzb21lIGxpc3RlbmVycyB0byB0aGVtLgoJICogRWFjaCBwcm9wZXJ0eSBpbiB0aGUgb2JqZWN0IHJlc3BvbnNlIGlzIGFuIGFycmF5IG9mIGxpc3RlbmVyIGZ1bmN0aW9ucy4KCSAqCgkgKiBAcGFyYW0ge1N0cmluZ3xSZWdFeHB9IGV2dCBOYW1lIG9mIHRoZSBldmVudCB0byByZXR1cm4gdGhlIGxpc3RlbmVycyBmcm9tLgoJICogQHJldHVybiB7RnVuY3Rpb25bXXxPYmplY3R9IEFsbCBsaXN0ZW5lciBmdW5jdGlvbnMgZm9yIHRoZSBldmVudC4KCSAqLwoJcHJvdG8uZ2V0TGlzdGVuZXJzID0gZnVuY3Rpb24gZ2V0TGlzdGVuZXJzKGV2dCkgewoJCXZhciBldmVudHMgPSB0aGlzLl9nZXRFdmVudHMoKTsKCQl2YXIgcmVzcG9uc2U7CgkJdmFyIGtleTsKCgkJLy8gUmV0dXJuIGEgY29uY2F0ZW5hdGVkIGFycmF5IG9mIGFsbCBtYXRjaGluZyBldmVudHMgaWYKCQkvLyB0aGUgc2VsZWN0b3IgaXMgYSByZWd1bGFyIGV4cHJlc3Npb24uCgkJaWYgKHR5cGVvZiBldnQgPT09ICdvYmplY3QnKSB7CgkJCXJlc3BvbnNlID0ge307CgkJCWZvciAoa2V5IGluIGV2ZW50cykgewoJCQkJaWYgKGV2ZW50cy5oYXNPd25Qcm9wZXJ0eShrZXkpICYmIGV2dC50ZXN0KGtleSkpIHsKCQkJCQlyZXNwb25zZVtrZXldID0gZXZlbnRzW2tleV07CgkJCQl9CgkJCX0KCQl9CgkJZWxzZSB7CgkJCXJlc3BvbnNlID0gZXZlbnRzW2V2dF0gfHwgKGV2ZW50c1tldnRdID0gW10pOwoJCX0KCgkJcmV0dXJuIHJlc3BvbnNlOwoJfTsKCgkvKioKCSAqIFRha2VzIGEgbGlzdCBvZiBsaXN0ZW5lciBvYmplY3RzIGFuZCBmbGF0dGVucyBpdCBpbnRvIGEgbGlzdCBvZiBsaXN0ZW5lciBmdW5jdGlvbnMuCgkgKgoJICogQHBhcmFtIHtPYmplY3RbXX0gbGlzdGVuZXJzIFJhdyBsaXN0ZW5lciBvYmplY3RzLgoJICogQHJldHVybiB7RnVuY3Rpb25bXX0gSnVzdCB0aGUgbGlzdGVuZXIgZnVuY3Rpb25zLgoJICovCglwcm90by5mbGF0dGVuTGlzdGVuZXJzID0gZnVuY3Rpb24gZmxhdHRlbkxpc3RlbmVycyhsaXN0ZW5lcnMpIHsKCQl2YXIgZmxhdExpc3RlbmVycyA9IFtdOwoJCXZhciBpOwoKCQlmb3IgKGkgPSAwOyBpIDwgbGlzdGVuZXJzLmxlbmd0aDsgaSArPSAxKSB7CgkJCWZsYXRMaXN0ZW5lcnMucHVzaChsaXN0ZW5lcnNbaV0ubGlzdGVuZXIpOwoJCX0KCgkJcmV0dXJuIGZsYXRMaXN0ZW5lcnM7Cgl9OwoKCS8qKgoJICogRmV0Y2hlcyB0aGUgcmVxdWVzdGVkIGxpc3RlbmVycyB2aWEgZ2V0TGlzdGVuZXJzIGJ1dCB3aWxsIGFsd2F5cyByZXR1cm4gdGhlIHJlc3VsdHMgaW5zaWRlIGFuIG9iamVjdC4gVGhpcyBpcyBtYWlubHkgZm9yIGludGVybmFsIHVzZSBidXQgb3RoZXJzIG1heSBmaW5kIGl0IHVzZWZ1bC4KCSAqCgkgKiBAcGFyYW0ge1N0cmluZ3xSZWdFeHB9IGV2dCBOYW1lIG9mIHRoZSBldmVudCB0byByZXR1cm4gdGhlIGxpc3RlbmVycyBmcm9tLgoJICogQHJldHVybiB7T2JqZWN0fSBBbGwgbGlzdGVuZXIgZnVuY3Rpb25zIGZvciBhbiBldmVudCBpbiBhbiBvYmplY3QuCgkgKi8KCXByb3RvLmdldExpc3RlbmVyc0FzT2JqZWN0ID0gZnVuY3Rpb24gZ2V0TGlzdGVuZXJzQXNPYmplY3QoZXZ0KSB7CgkJdmFyIGxpc3RlbmVycyA9IHRoaXMuZ2V0TGlzdGVuZXJzKGV2dCk7CgkJdmFyIHJlc3BvbnNlOwoKCQlpZiAobGlzdGVuZXJzIGluc3RhbmNlb2YgQXJyYXkpIHsKCQkJcmVzcG9uc2UgPSB7fTsKCQkJcmVzcG9uc2VbZXZ0XSA9IGxpc3RlbmVyczsKCQl9CgoJCXJldHVybiByZXNwb25zZSB8fCBsaXN0ZW5lcnM7Cgl9OwoKCS8qKgoJICogQWRkcyBhIGxpc3RlbmVyIGZ1bmN0aW9uIHRvIHRoZSBzcGVjaWZpZWQgZXZlbnQuCgkgKiBUaGUgbGlzdGVuZXIgd2lsbCBub3QgYmUgYWRkZWQgaWYgaXQgaXMgYSBkdXBsaWNhdGUuCgkgKiBJZiB0aGUgbGlzdGVuZXIgcmV0dXJucyB0cnVlIHRoZW4gaXQgd2lsbCBiZSByZW1vdmVkIGFmdGVyIGl0IGlzIGNhbGxlZC4KCSAqIElmIHlvdSBwYXNzIGEgcmVndWxhciBleHByZXNzaW9uIGFzIHRoZSBldmVudCBuYW1lIHRoZW4gdGhlIGxpc3RlbmVyIHdpbGwgYmUgYWRkZWQgdG8gYWxsIGV2ZW50cyB0aGF0IG1hdGNoIGl0LgoJICoKCSAqIEBwYXJhbSB7U3RyaW5nfFJlZ0V4cH0gZXZ0IE5hbWUgb2YgdGhlIGV2ZW50IHRvIGF0dGFjaCB0aGUgbGlzdGVuZXIgdG8uCgkgKiBAcGFyYW0ge0Z1bmN0aW9ufSBsaXN0ZW5lciBNZXRob2QgdG8gYmUgY2FsbGVkIHdoZW4gdGhlIGV2ZW50IGlzIGVtaXR0ZWQuIElmIHRoZSBmdW5jdGlvbiByZXR1cm5zIHRydWUgdGhlbiBpdCB3aWxsIGJlIHJlbW92ZWQgYWZ0ZXIgY2FsbGluZy4KCSAqIEByZXR1cm4ge09iamVjdH0gQ3VycmVudCBpbnN0YW5jZSBvZiBFdmVudEVtaXR0ZXIgZm9yIGNoYWluaW5nLgoJICovCglwcm90by5hZGRMaXN0ZW5lciA9IGZ1bmN0aW9uIGFkZExpc3RlbmVyKGV2dCwgbGlzdGVuZXIpIHsKCQl2YXIgbGlzdGVuZXJzID0gdGhpcy5nZXRMaXN0ZW5lcnNBc09iamVjdChldnQpOwoJCXZhciBsaXN0ZW5lcklzV3JhcHBlZCA9IHR5cGVvZiBsaXN0ZW5lciA9PT0gJ29iamVjdCc7CgkJdmFyIGtleTsKCgkJZm9yIChrZXkgaW4gbGlzdGVuZXJzKSB7CgkJCWlmIChsaXN0ZW5lcnMuaGFzT3duUHJvcGVydHkoa2V5KSAmJiBpbmRleE9mTGlzdGVuZXIobGlzdGVuZXJzW2tleV0sIGxpc3RlbmVyKSA9PT0gLTEpIHsKCQkJCWxpc3RlbmVyc1trZXldLnB1c2gobGlzdGVuZXJJc1dyYXBwZWQgPyBsaXN0ZW5lciA6IHsKCQkJCQlsaXN0ZW5lcjogbGlzdGVuZXIsCgkJCQkJb25jZTogZmFsc2UKCQkJCX0pOwoJCQl9CgkJfQoKCQlyZXR1cm4gdGhpczsKCX07CgoJLyoqCgkgKiBBbGlhcyBvZiBhZGRMaXN0ZW5lcgoJICovCglwcm90by5vbiA9IGFsaWFzKCdhZGRMaXN0ZW5lcicpOwoKCS8qKgoJICogU2VtaS1hbGlhcyBvZiBhZGRMaXN0ZW5lci4gSXQgd2lsbCBhZGQgYSBsaXN0ZW5lciB0aGF0IHdpbGwgYmUKCSAqIGF1dG9tYXRpY2FsbHkgcmVtb3ZlZCBhZnRlciBpdCdzIGZpcnN0IGV4ZWN1dGlvbi4KCSAqCgkgKiBAcGFyYW0ge1N0cmluZ3xSZWdFeHB9IGV2dCBOYW1lIG9mIHRoZSBldmVudCB0byBhdHRhY2ggdGhlIGxpc3RlbmVyIHRvLgoJICogQHBhcmFtIHtGdW5jdGlvbn0gbGlzdGVuZXIgTWV0aG9kIHRvIGJlIGNhbGxlZCB3aGVuIHRoZSBldmVudCBpcyBlbWl0dGVkLiBJZiB0aGUgZnVuY3Rpb24gcmV0dXJucyB0cnVlIHRoZW4gaXQgd2lsbCBiZSByZW1vdmVkIGFmdGVyIGNhbGxpbmcuCgkgKiBAcmV0dXJuIHtPYmplY3R9IEN1cnJlbnQgaW5zdGFuY2Ugb2YgRXZlbnRFbWl0dGVyIGZvciBjaGFpbmluZy4KCSAqLwoJcHJvdG8uYWRkT25jZUxpc3RlbmVyID0gZnVuY3Rpb24gYWRkT25jZUxpc3RlbmVyKGV2dCwgbGlzdGVuZXIpIHsKCQlyZXR1cm4gdGhpcy5hZGRMaXN0ZW5lcihldnQsIHsKCQkJbGlzdGVuZXI6IGxpc3RlbmVyLAoJCQlvbmNlOiB0cnVlCgkJfSk7Cgl9OwoKCS8qKgoJICogQWxpYXMgb2YgYWRkT25jZUxpc3RlbmVyLgoJICovCglwcm90by5vbmNlID0gYWxpYXMoJ2FkZE9uY2VMaXN0ZW5lcicpOwoKCS8qKgoJICogRGVmaW5lcyBhbiBldmVudCBuYW1lLiBUaGlzIGlzIHJlcXVpcmVkIGlmIHlvdSB3YW50IHRvIHVzZSBhIHJlZ2V4IHRvIGFkZCBhIGxpc3RlbmVyIHRvIG11bHRpcGxlIGV2ZW50cyBhdCBvbmNlLiBJZiB5b3UgZG9uJ3QgZG8gdGhpcyB0aGVuIGhvdyBkbyB5b3UgZXhwZWN0IGl0IHRvIGtub3cgd2hhdCBldmVudCB0byBhZGQgdG8/IFNob3VsZCBpdCBqdXN0IGFkZCB0byBldmVyeSBwb3NzaWJsZSBtYXRjaCBmb3IgYSByZWdleD8gTm8uIFRoYXQgaXMgc2NhcnkgYW5kIGJhZC4KCSAqIFlvdSBuZWVkIHRvIHRlbGwgaXQgd2hhdCBldmVudCBuYW1lcyBzaG91bGQgYmUgbWF0Y2hlZCBieSBhIHJlZ2V4LgoJICoKCSAqIEBwYXJhbSB7U3RyaW5nfSBldnQgTmFtZSBvZiB0aGUgZXZlbnQgdG8gY3JlYXRlLgoJICogQHJldHVybiB7T2JqZWN0fSBDdXJyZW50IGluc3RhbmNlIG9mIEV2ZW50RW1pdHRlciBmb3IgY2hhaW5pbmcuCgkgKi8KCXByb3RvLmRlZmluZUV2ZW50ID0gZnVuY3Rpb24gZGVmaW5lRXZlbnQoZXZ0KSB7CgkJdGhpcy5nZXRMaXN0ZW5lcnMoZXZ0KTsKCQlyZXR1cm4gdGhpczsKCX07CgoJLyoqCgkgKiBVc2VzIGRlZmluZUV2ZW50IHRvIGRlZmluZSBtdWx0aXBsZSBldmVudHMuCgkgKgoJICogQHBhcmFtIHtTdHJpbmdbXX0gZXZ0cyBBbiBhcnJheSBvZiBldmVudCBuYW1lcyB0byBkZWZpbmUuCgkgKiBAcmV0dXJuIHtPYmplY3R9IEN1cnJlbnQgaW5zdGFuY2Ugb2YgRXZlbnRFbWl0dGVyIGZvciBjaGFpbmluZy4KCSAqLwoJcHJvdG8uZGVmaW5lRXZlbnRzID0gZnVuY3Rpb24gZGVmaW5lRXZlbnRzKGV2dHMpIHsKCQlmb3IgKHZhciBpID0gMDsgaSA8IGV2dHMubGVuZ3RoOyBpICs9IDEpIHsKCQkJdGhpcy5kZWZpbmVFdmVudChldnRzW2ldKTsKCQl9CgkJcmV0dXJuIHRoaXM7Cgl9OwoKCS8qKgoJICogUmVtb3ZlcyBhIGxpc3RlbmVyIGZ1bmN0aW9uIGZyb20gdGhlIHNwZWNpZmllZCBldmVudC4KCSAqIFdoZW4gcGFzc2VkIGEgcmVndWxhciBleHByZXNzaW9uIGFzIHRoZSBldmVudCBuYW1lLCBpdCB3aWxsIHJlbW92ZSB0aGUgbGlzdGVuZXIgZnJvbSBhbGwgZXZlbnRzIHRoYXQgbWF0Y2ggaXQuCgkgKgoJICogQHBhcmFtIHtTdHJpbmd8UmVnRXhwfSBldnQgTmFtZSBvZiB0aGUgZXZlbnQgdG8gcmVtb3ZlIHRoZSBsaXN0ZW5lciBmcm9tLgoJICogQHBhcmFtIHtGdW5jdGlvbn0gbGlzdGVuZXIgTWV0aG9kIHRvIHJlbW92ZSBmcm9tIHRoZSBldmVudC4KCSAqIEByZXR1cm4ge09iamVjdH0gQ3VycmVudCBpbnN0YW5jZSBvZiBFdmVudEVtaXR0ZXIgZm9yIGNoYWluaW5nLgoJICovCglwcm90by5yZW1vdmVMaXN0ZW5lciA9IGZ1bmN0aW9uIHJlbW92ZUxpc3RlbmVyKGV2dCwgbGlzdGVuZXIpIHsKCQl2YXIgbGlzdGVuZXJzID0gdGhpcy5nZXRMaXN0ZW5lcnNBc09iamVjdChldnQpOwoJCXZhciBpbmRleDsKCQl2YXIga2V5OwoKCQlmb3IgKGtleSBpbiBsaXN0ZW5lcnMpIHsKCQkJaWYgKGxpc3RlbmVycy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7CgkJCQlpbmRleCA9IGluZGV4T2ZMaXN0ZW5lcihsaXN0ZW5lcnNba2V5XSwgbGlzdGVuZXIpOwoKCQkJCWlmIChpbmRleCAhPT0gLTEpIHsKCQkJCQlsaXN0ZW5lcnNba2V5XS5zcGxpY2UoaW5kZXgsIDEpOwoJCQkJfQoJCQl9CgkJfQoKCQlyZXR1cm4gdGhpczsKCX07CgoJLyoqCgkgKiBBbGlhcyBvZiByZW1vdmVMaXN0ZW5lcgoJICovCglwcm90by5vZmYgPSBhbGlhcygncmVtb3ZlTGlzdGVuZXInKTsKCgkvKioKCSAqIEFkZHMgbGlzdGVuZXJzIGluIGJ1bGsgdXNpbmcgdGhlIG1hbmlwdWxhdGVMaXN0ZW5lcnMgbWV0aG9kLgoJICogSWYgeW91IHBhc3MgYW4gb2JqZWN0IGFzIHRoZSBzZWNvbmQgYXJndW1lbnQgeW91IGNhbiBhZGQgdG8gbXVsdGlwbGUgZXZlbnRzIGF0IG9uY2UuIFRoZSBvYmplY3Qgc2hvdWxkIGNvbnRhaW4ga2V5IHZhbHVlIHBhaXJzIG9mIGV2ZW50cyBhbmQgbGlzdGVuZXJzIG9yIGxpc3RlbmVyIGFycmF5cy4gWW91IGNhbiBhbHNvIHBhc3MgaXQgYW4gZXZlbnQgbmFtZSBhbmQgYW4gYXJyYXkgb2YgbGlzdGVuZXJzIHRvIGJlIGFkZGVkLgoJICogWW91IGNhbiBhbHNvIHBhc3MgaXQgYSByZWd1bGFyIGV4cHJlc3Npb24gdG8gYWRkIHRoZSBhcnJheSBvZiBsaXN0ZW5lcnMgdG8gYWxsIGV2ZW50cyB0aGF0IG1hdGNoIGl0LgoJICogWWVhaCwgdGhpcyBmdW5jdGlvbiBkb2VzIHF1aXRlIGEgYml0LiBUaGF0J3MgcHJvYmFibHkgYSBiYWQgdGhpbmcuCgkgKgoJICogQHBhcmFtIHtTdHJpbmd8T2JqZWN0fFJlZ0V4cH0gZXZ0IEFuIGV2ZW50IG5hbWUgaWYgeW91IHdpbGwgcGFzcyBhbiBhcnJheSBvZiBsaXN0ZW5lcnMgbmV4dC4gQW4gb2JqZWN0IGlmIHlvdSB3aXNoIHRvIGFkZCB0byBtdWx0aXBsZSBldmVudHMgYXQgb25jZS4KCSAqIEBwYXJhbSB7RnVuY3Rpb25bXX0gW2xpc3RlbmVyc10gQW4gb3B0aW9uYWwgYXJyYXkgb2YgbGlzdGVuZXIgZnVuY3Rpb25zIHRvIGFkZC4KCSAqIEByZXR1cm4ge09iamVjdH0gQ3VycmVudCBpbnN0YW5jZSBvZiBFdmVudEVtaXR0ZXIgZm9yIGNoYWluaW5nLgoJICovCglwcm90by5hZGRMaXN0ZW5lcnMgPSBmdW5jdGlvbiBhZGRMaXN0ZW5lcnMoZXZ0LCBsaXN0ZW5lcnMpIHsKCQkvLyBQYXNzIHRocm91Z2ggdG8gbWFuaXB1bGF0ZUxpc3RlbmVycwoJCXJldHVybiB0aGlzLm1hbmlwdWxhdGVMaXN0ZW5lcnMoZmFsc2UsIGV2dCwgbGlzdGVuZXJzKTsKCX07CgoJLyoqCgkgKiBSZW1vdmVzIGxpc3RlbmVycyBpbiBidWxrIHVzaW5nIHRoZSBtYW5pcHVsYXRlTGlzdGVuZXJzIG1ldGhvZC4KCSAqIElmIHlvdSBwYXNzIGFuIG9iamVjdCBhcyB0aGUgc2Vjb25kIGFyZ3VtZW50IHlvdSBjYW4gcmVtb3ZlIGZyb20gbXVsdGlwbGUgZXZlbnRzIGF0IG9uY2UuIFRoZSBvYmplY3Qgc2hvdWxkIGNvbnRhaW4ga2V5IHZhbHVlIHBhaXJzIG9mIGV2ZW50cyBhbmQgbGlzdGVuZXJzIG9yIGxpc3RlbmVyIGFycmF5cy4KCSAqIFlvdSBjYW4gYWxzbyBwYXNzIGl0IGFuIGV2ZW50IG5hbWUgYW5kIGFuIGFycmF5IG9mIGxpc3RlbmVycyB0byBiZSByZW1vdmVkLgoJICogWW91IGNhbiBhbHNvIHBhc3MgaXQgYSByZWd1bGFyIGV4cHJlc3Npb24gdG8gcmVtb3ZlIHRoZSBsaXN0ZW5lcnMgZnJvbSBhbGwgZXZlbnRzIHRoYXQgbWF0Y2ggaXQuCgkgKgoJICogQHBhcmFtIHtTdHJpbmd8T2JqZWN0fFJlZ0V4cH0gZXZ0IEFuIGV2ZW50IG5hbWUgaWYgeW91IHdpbGwgcGFzcyBhbiBhcnJheSBvZiBsaXN0ZW5lcnMgbmV4dC4gQW4gb2JqZWN0IGlmIHlvdSB3aXNoIHRvIHJlbW92ZSBmcm9tIG11bHRpcGxlIGV2ZW50cyBhdCBvbmNlLgoJICogQHBhcmFtIHtGdW5jdGlvbltdfSBbbGlzdGVuZXJzXSBBbiBvcHRpb25hbCBhcnJheSBvZiBsaXN0ZW5lciBmdW5jdGlvbnMgdG8gcmVtb3ZlLgoJICogQHJldHVybiB7T2JqZWN0fSBDdXJyZW50IGluc3RhbmNlIG9mIEV2ZW50RW1pdHRlciBmb3IgY2hhaW5pbmcuCgkgKi8KCXByb3RvLnJlbW92ZUxpc3RlbmVycyA9IGZ1bmN0aW9uIHJlbW92ZUxpc3RlbmVycyhldnQsIGxpc3RlbmVycykgewoJCS8vIFBhc3MgdGhyb3VnaCB0byBtYW5pcHVsYXRlTGlzdGVuZXJzCgkJcmV0dXJuIHRoaXMubWFuaXB1bGF0ZUxpc3RlbmVycyh0cnVlLCBldnQsIGxpc3RlbmVycyk7Cgl9OwoKCS8qKgoJICogRWRpdHMgbGlzdGVuZXJzIGluIGJ1bGsuIFRoZSBhZGRMaXN0ZW5lcnMgYW5kIHJlbW92ZUxpc3RlbmVycyBtZXRob2RzIGJvdGggdXNlIHRoaXMgdG8gZG8gdGhlaXIgam9iLiBZb3Ugc2hvdWxkIHJlYWxseSB1c2UgdGhvc2UgaW5zdGVhZCwgdGhpcyBpcyBhIGxpdHRsZSBsb3dlciBsZXZlbC4KCSAqIFRoZSBmaXJzdCBhcmd1bWVudCB3aWxsIGRldGVybWluZSBpZiB0aGUgbGlzdGVuZXJzIGFyZSByZW1vdmVkICh0cnVlKSBvciBhZGRlZCAoZmFsc2UpLgoJICogSWYgeW91IHBhc3MgYW4gb2JqZWN0IGFzIHRoZSBzZWNvbmQgYXJndW1lbnQgeW91IGNhbiBhZGQvcmVtb3ZlIGZyb20gbXVsdGlwbGUgZXZlbnRzIGF0IG9uY2UuIFRoZSBvYmplY3Qgc2hvdWxkIGNvbnRhaW4ga2V5IHZhbHVlIHBhaXJzIG9mIGV2ZW50cyBhbmQgbGlzdGVuZXJzIG9yIGxpc3RlbmVyIGFycmF5cy4KCSAqIFlvdSBjYW4gYWxzbyBwYXNzIGl0IGFuIGV2ZW50IG5hbWUgYW5kIGFuIGFycmF5IG9mIGxpc3RlbmVycyB0byBiZSBhZGRlZC9yZW1vdmVkLgoJICogWW91IGNhbiBhbHNvIHBhc3MgaXQgYSByZWd1bGFyIGV4cHJlc3Npb24gdG8gbWFuaXB1bGF0ZSB0aGUgbGlzdGVuZXJzIG9mIGFsbCBldmVudHMgdGhhdCBtYXRjaCBpdC4KCSAqCgkgKiBAcGFyYW0ge0Jvb2xlYW59IHJlbW92ZSBUcnVlIGlmIHlvdSB3YW50IHRvIHJlbW92ZSBsaXN0ZW5lcnMsIGZhbHNlIGlmIHlvdSB3YW50IHRvIGFkZC4KCSAqIEBwYXJhbSB7U3RyaW5nfE9iamVjdHxSZWdFeHB9IGV2dCBBbiBldmVudCBuYW1lIGlmIHlvdSB3aWxsIHBhc3MgYW4gYXJyYXkgb2YgbGlzdGVuZXJzIG5leHQuIEFuIG9iamVjdCBpZiB5b3Ugd2lzaCB0byBhZGQvcmVtb3ZlIGZyb20gbXVsdGlwbGUgZXZlbnRzIGF0IG9uY2UuCgkgKiBAcGFyYW0ge0Z1bmN0aW9uW119IFtsaXN0ZW5lcnNdIEFuIG9wdGlvbmFsIGFycmF5IG9mIGxpc3RlbmVyIGZ1bmN0aW9ucyB0byBhZGQvcmVtb3ZlLgoJICogQHJldHVybiB7T2JqZWN0fSBDdXJyZW50IGluc3RhbmNlIG9mIEV2ZW50RW1pdHRlciBmb3IgY2hhaW5pbmcuCgkgKi8KCXByb3RvLm1hbmlwdWxhdGVMaXN0ZW5lcnMgPSBmdW5jdGlvbiBtYW5pcHVsYXRlTGlzdGVuZXJzKHJlbW92ZSwgZXZ0LCBsaXN0ZW5lcnMpIHsKCQl2YXIgaTsKCQl2YXIgdmFsdWU7CgkJdmFyIHNpbmdsZSA9IHJlbW92ZSA/IHRoaXMucmVtb3ZlTGlzdGVuZXIgOiB0aGlzLmFkZExpc3RlbmVyOwoJCXZhciBtdWx0aXBsZSA9IHJlbW92ZSA/IHRoaXMucmVtb3ZlTGlzdGVuZXJzIDogdGhpcy5hZGRMaXN0ZW5lcnM7CgoJCS8vIElmIGV2dCBpcyBhbiBvYmplY3QgdGhlbiBwYXNzIGVhY2ggb2YgaXQncyBwcm9wZXJ0aWVzIHRvIHRoaXMgbWV0aG9kCgkJaWYgKHR5cGVvZiBldnQgPT09ICdvYmplY3QnICYmICEoZXZ0IGluc3RhbmNlb2YgUmVnRXhwKSkgewoJCQlmb3IgKGkgaW4gZXZ0KSB7CgkJCQlpZiAoZXZ0Lmhhc093blByb3BlcnR5KGkpICYmICh2YWx1ZSA9IGV2dFtpXSkpIHsKCQkJCQkvLyBQYXNzIHRoZSBzaW5nbGUgbGlzdGVuZXIgc3RyYWlnaHQgdGhyb3VnaCB0byB0aGUgc2luZ3VsYXIgbWV0aG9kCgkJCQkJaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykgewoJCQkJCQlzaW5nbGUuY2FsbCh0aGlzLCBpLCB2YWx1ZSk7CgkJCQkJfQoJCQkJCWVsc2UgewoJCQkJCQkvLyBPdGhlcndpc2UgcGFzcyBiYWNrIHRvIHRoZSBtdWx0aXBsZSBmdW5jdGlvbgoJCQkJCQltdWx0aXBsZS5jYWxsKHRoaXMsIGksIHZhbHVlKTsKCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgkJZWxzZSB7CgkJCS8vIFNvIGV2dCBtdXN0IGJlIGEgc3RyaW5nCgkJCS8vIEFuZCBsaXN0ZW5lcnMgbXVzdCBiZSBhbiBhcnJheSBvZiBsaXN0ZW5lcnMKCQkJLy8gTG9vcCBvdmVyIGl0IGFuZCBwYXNzIGVhY2ggb25lIHRvIHRoZSBtdWx0aXBsZSBtZXRob2QKCQkJaSA9IGxpc3RlbmVycy5sZW5ndGg7CgkJCXdoaWxlIChpLS0pIHsKCQkJCXNpbmdsZS5jYWxsKHRoaXMsIGV2dCwgbGlzdGVuZXJzW2ldKTsKCQkJfQoJCX0KCgkJcmV0dXJuIHRoaXM7Cgl9OwoKCS8qKgoJICogUmVtb3ZlcyBhbGwgbGlzdGVuZXJzIGZyb20gYSBzcGVjaWZpZWQgZXZlbnQuCgkgKiBJZiB5b3UgZG8gbm90IHNwZWNpZnkgYW4gZXZlbnQgdGhlbiBhbGwgbGlzdGVuZXJzIHdpbGwgYmUgcmVtb3ZlZC4KCSAqIFRoYXQgbWVhbnMgZXZlcnkgZXZlbnQgd2lsbCBiZSBlbXB0aWVkLgoJICogWW91IGNhbiBhbHNvIHBhc3MgYSByZWdleCB0byByZW1vdmUgYWxsIGV2ZW50cyB0aGF0IG1hdGNoIGl0LgoJICoKCSAqIEBwYXJhbSB7U3RyaW5nfFJlZ0V4cH0gW2V2dF0gT3B0aW9uYWwgbmFtZSBvZiB0aGUgZXZlbnQgdG8gcmVtb3ZlIGFsbCBsaXN0ZW5lcnMgZm9yLiBXaWxsIHJlbW92ZSBmcm9tIGV2ZXJ5IGV2ZW50IGlmIG5vdCBwYXNzZWQuCgkgKiBAcmV0dXJuIHtPYmplY3R9IEN1cnJlbnQgaW5zdGFuY2Ugb2YgRXZlbnRFbWl0dGVyIGZvciBjaGFpbmluZy4KCSAqLwoJcHJvdG8ucmVtb3ZlRXZlbnQgPSBmdW5jdGlvbiByZW1vdmVFdmVudChldnQpIHsKCQl2YXIgdHlwZSA9IHR5cGVvZiBldnQ7CgkJdmFyIGV2ZW50cyA9IHRoaXMuX2dldEV2ZW50cygpOwoJCXZhciBrZXk7CgoJCS8vIFJlbW92ZSBkaWZmZXJlbnQgdGhpbmdzIGRlcGVuZGluZyBvbiB0aGUgc3RhdGUgb2YgZXZ0CgkJaWYgKHR5cGUgPT09ICdzdHJpbmcnKSB7CgkJCS8vIFJlbW92ZSBhbGwgbGlzdGVuZXJzIGZvciB0aGUgc3BlY2lmaWVkIGV2ZW50CgkJCWRlbGV0ZSBldmVudHNbZXZ0XTsKCQl9CgkJZWxzZSBpZiAodHlwZSA9PT0gJ29iamVjdCcpIHsKCQkJLy8gUmVtb3ZlIGFsbCBldmVudHMgbWF0Y2hpbmcgdGhlIHJlZ2V4LgoJCQlmb3IgKGtleSBpbiBldmVudHMpIHsKCQkJCWlmIChldmVudHMuaGFzT3duUHJvcGVydHkoa2V5KSAmJiBldnQudGVzdChrZXkpKSB7CgkJCQkJZGVsZXRlIGV2ZW50c1trZXldOwoJCQkJfQoJCQl9CgkJfQoJCWVsc2UgewoJCQkvLyBSZW1vdmUgYWxsIGxpc3RlbmVycyBpbiBhbGwgZXZlbnRzCgkJCWRlbGV0ZSB0aGlzLl9ldmVudHM7CgkJfQoKCQlyZXR1cm4gdGhpczsKCX07CgoJLyoqCgkgKiBFbWl0cyBhbiBldmVudCBvZiB5b3VyIGNob2ljZS4KCSAqIFdoZW4gZW1pdHRlZCwgZXZlcnkgbGlzdGVuZXIgYXR0YWNoZWQgdG8gdGhhdCBldmVudCB3aWxsIGJlIGV4ZWN1dGVkLgoJICogSWYgeW91IHBhc3MgdGhlIG9wdGlvbmFsIGFyZ3VtZW50IGFycmF5IHRoZW4gdGhvc2UgYXJndW1lbnRzIHdpbGwgYmUgcGFzc2VkIHRvIGV2ZXJ5IGxpc3RlbmVyIHVwb24gZXhlY3V0aW9uLgoJICogQmVjYXVzZSBpdCB1c2VzIGBhcHBseWAsIHlvdXIgYXJyYXkgb2YgYXJndW1lbnRzIHdpbGwgYmUgcGFzc2VkIGFzIGlmIHlvdSB3cm90ZSB0aGVtIG91dCBzZXBhcmF0ZWx5LgoJICogU28gdGhleSB3aWxsIG5vdCBhcnJpdmUgd2l0aGluIHRoZSBhcnJheSBvbiB0aGUgb3RoZXIgc2lkZSwgdGhleSB3aWxsIGJlIHNlcGFyYXRlLgoJICogWW91IGNhbiBhbHNvIHBhc3MgYSByZWd1bGFyIGV4cHJlc3Npb24gdG8gZW1pdCB0byBhbGwgZXZlbnRzIHRoYXQgbWF0Y2ggaXQuCgkgKgoJICogQHBhcmFtIHtTdHJpbmd8UmVnRXhwfSBldnQgTmFtZSBvZiB0aGUgZXZlbnQgdG8gZW1pdCBhbmQgZXhlY3V0ZSBsaXN0ZW5lcnMgZm9yLgoJICogQHBhcmFtIHtBcnJheX0gW2FyZ3NdIE9wdGlvbmFsIGFycmF5IG9mIGFyZ3VtZW50cyB0byBiZSBwYXNzZWQgdG8gZWFjaCBsaXN0ZW5lci4KCSAqIEByZXR1cm4ge09iamVjdH0gQ3VycmVudCBpbnN0YW5jZSBvZiBFdmVudEVtaXR0ZXIgZm9yIGNoYWluaW5nLgoJICovCglwcm90by5lbWl0RXZlbnQgPSBmdW5jdGlvbiBlbWl0RXZlbnQoZXZ0LCBhcmdzKSB7CgkJdmFyIGxpc3RlbmVycyA9IHRoaXMuZ2V0TGlzdGVuZXJzQXNPYmplY3QoZXZ0KTsKCQl2YXIgbGlzdGVuZXI7CgkJdmFyIGk7CgkJdmFyIGtleTsKCQl2YXIgcmVzcG9uc2U7CgoJCWZvciAoa2V5IGluIGxpc3RlbmVycykgewoJCQlpZiAobGlzdGVuZXJzLmhhc093blByb3BlcnR5KGtleSkpIHsKCQkJCWkgPSBsaXN0ZW5lcnNba2V5XS5sZW5ndGg7CgoJCQkJd2hpbGUgKGktLSkgewoJCQkJCS8vIElmIHRoZSBsaXN0ZW5lciByZXR1cm5zIHRydWUgdGhlbiBpdCBzaGFsbCBiZSByZW1vdmVkIGZyb20gdGhlIGV2ZW50CgkJCQkJLy8gVGhlIGZ1bmN0aW9uIGlzIGV4ZWN1dGVkIGVpdGhlciB3aXRoIGEgYmFzaWMgY2FsbCBvciBhbiBhcHBseSBpZiB0aGVyZSBpcyBhbiBhcmdzIGFycmF5CgkJCQkJbGlzdGVuZXIgPSBsaXN0ZW5lcnNba2V5XVtpXTsKCgkJCQkJaWYgKGxpc3RlbmVyLm9uY2UgPT09IHRydWUpIHsKCQkJCQkJdGhpcy5yZW1vdmVMaXN0ZW5lcihldnQsIGxpc3RlbmVyLmxpc3RlbmVyKTsKCQkJCQl9CgoJCQkJCXJlc3BvbnNlID0gbGlzdGVuZXIubGlzdGVuZXIuYXBwbHkodGhpcywgYXJncyB8fCBbXSk7CgoJCQkJCWlmIChyZXNwb25zZSA9PT0gdGhpcy5fZ2V0T25jZVJldHVyblZhbHVlKCkpIHsKCQkJCQkJdGhpcy5yZW1vdmVMaXN0ZW5lcihldnQsIGxpc3RlbmVyLmxpc3RlbmVyKTsKCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgoJCXJldHVybiB0aGlzOwoJfTsKCgkvKioKCSAqIEFsaWFzIG9mIGVtaXRFdmVudAoJICovCglwcm90by50cmlnZ2VyID0gYWxpYXMoJ2VtaXRFdmVudCcpOwoKCS8qKgoJICogU3VidGx5IGRpZmZlcmVudCBmcm9tIGVtaXRFdmVudCBpbiB0aGF0IGl0IHdpbGwgcGFzcyBpdHMgYXJndW1lbnRzIG9uIHRvIHRoZSBsaXN0ZW5lcnMsIGFzIG9wcG9zZWQgdG8gdGFraW5nIGEgc2luZ2xlIGFycmF5IG9mIGFyZ3VtZW50cyB0byBwYXNzIG9uLgoJICogQXMgd2l0aCBlbWl0RXZlbnQsIHlvdSBjYW4gcGFzcyBhIHJlZ2V4IGluIHBsYWNlIG9mIHRoZSBldmVudCBuYW1lIHRvIGVtaXQgdG8gYWxsIGV2ZW50cyB0aGF0IG1hdGNoIGl0LgoJICoKCSAqIEBwYXJhbSB7U3RyaW5nfFJlZ0V4cH0gZXZ0IE5hbWUgb2YgdGhlIGV2ZW50IHRvIGVtaXQgYW5kIGV4ZWN1dGUgbGlzdGVuZXJzIGZvci4KCSAqIEBwYXJhbSB7Li4uKn0gT3B0aW9uYWwgYWRkaXRpb25hbCBhcmd1bWVudHMgdG8gYmUgcGFzc2VkIHRvIGVhY2ggbGlzdGVuZXIuCgkgKiBAcmV0dXJuIHtPYmplY3R9IEN1cnJlbnQgaW5zdGFuY2Ugb2YgRXZlbnRFbWl0dGVyIGZvciBjaGFpbmluZy4KCSAqLwoJcHJvdG8uZW1pdCA9IGZ1bmN0aW9uIGVtaXQoZXZ0KSB7CgkJdmFyIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpOwoJCXJldHVybiB0aGlzLmVtaXRFdmVudChldnQsIGFyZ3MpOwoJfTsKCgkvKioKCSAqIFNldHMgdGhlIGN1cnJlbnQgdmFsdWUgdG8gY2hlY2sgYWdhaW5zdCB3aGVuIGV4ZWN1dGluZyBsaXN0ZW5lcnMuIElmIGEKCSAqIGxpc3RlbmVycyByZXR1cm4gdmFsdWUgbWF0Y2hlcyB0aGUgb25lIHNldCBoZXJlIHRoZW4gaXQgd2lsbCBiZSByZW1vdmVkCgkgKiBhZnRlciBleGVjdXRpb24uIFRoaXMgdmFsdWUgZGVmYXVsdHMgdG8gdHJ1ZS4KCSAqCgkgKiBAcGFyYW0geyp9IHZhbHVlIFRoZSBuZXcgdmFsdWUgdG8gY2hlY2sgZm9yIHdoZW4gZXhlY3V0aW5nIGxpc3RlbmVycy4KCSAqIEByZXR1cm4ge09iamVjdH0gQ3VycmVudCBpbnN0YW5jZSBvZiBFdmVudEVtaXR0ZXIgZm9yIGNoYWluaW5nLgoJICovCglwcm90by5zZXRPbmNlUmV0dXJuVmFsdWUgPSBmdW5jdGlvbiBzZXRPbmNlUmV0dXJuVmFsdWUodmFsdWUpIHsKCQl0aGlzLl9vbmNlUmV0dXJuVmFsdWUgPSB2YWx1ZTsKCQlyZXR1cm4gdGhpczsKCX07CgoJLyoqCgkgKiBGZXRjaGVzIHRoZSBjdXJyZW50IHZhbHVlIHRvIGNoZWNrIGFnYWluc3Qgd2hlbiBleGVjdXRpbmcgbGlzdGVuZXJzLiBJZgoJICogdGhlIGxpc3RlbmVycyByZXR1cm4gdmFsdWUgbWF0Y2hlcyB0aGlzIG9uZSB0aGVuIGl0IHNob3VsZCBiZSByZW1vdmVkCgkgKiBhdXRvbWF0aWNhbGx5LiBJdCB3aWxsIHJldHVybiB0cnVlIGJ5IGRlZmF1bHQuCgkgKgoJICogQHJldHVybiB7KnxCb29sZWFufSBUaGUgY3VycmVudCB2YWx1ZSB0byBjaGVjayBmb3Igb3IgdGhlIGRlZmF1bHQsIHRydWUuCgkgKiBAYXBpIHByaXZhdGUKCSAqLwoJcHJvdG8uX2dldE9uY2VSZXR1cm5WYWx1ZSA9IGZ1bmN0aW9uIF9nZXRPbmNlUmV0dXJuVmFsdWUoKSB7CgkJaWYgKHRoaXMuaGFzT3duUHJvcGVydHkoJ19vbmNlUmV0dXJuVmFsdWUnKSkgewoJCQlyZXR1cm4gdGhpcy5fb25jZVJldHVyblZhbHVlOwoJCX0KCQllbHNlIHsKCQkJcmV0dXJuIHRydWU7CgkJfQoJfTsKCgkvKioKCSAqIEZldGNoZXMgdGhlIGV2ZW50cyBvYmplY3QgYW5kIGNyZWF0ZXMgb25lIGlmIHJlcXVpcmVkLgoJICoKCSAqIEByZXR1cm4ge09iamVjdH0gVGhlIGV2ZW50cyBzdG9yYWdlIG9iamVjdC4KCSAqIEBhcGkgcHJpdmF0ZQoJICovCglwcm90by5fZ2V0RXZlbnRzID0gZnVuY3Rpb24gX2dldEV2ZW50cygpIHsKCQlyZXR1cm4gdGhpcy5fZXZlbnRzIHx8ICh0aGlzLl9ldmVudHMgPSB7fSk7Cgl9OwoKCS8vIEV4cG9zZSB0aGUgY2xhc3MgZWl0aGVyIHZpYSBBTUQsIENvbW1vbkpTIG9yIHRoZSBnbG9iYWwgb2JqZWN0CglpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7CgkJZGVmaW5lKCdldmVudGVtaXR0ZXInLFtdLGZ1bmN0aW9uICgpIHsKCQkJcmV0dXJuIEV2ZW50RW1pdHRlcjsKCQl9KTsKCX0KCWVsc2UgaWYgKHR5cGVvZiBtb2R1bGUgPT09ICdvYmplY3QnICYmIG1vZHVsZS5leHBvcnRzKXsKCQltb2R1bGUuZXhwb3J0cyA9IEV2ZW50RW1pdHRlcjsKCX0KCWVsc2UgewoJCXRoaXMuRXZlbnRFbWl0dGVyID0gRXZlbnRFbWl0dGVyOwoJfQp9LmNhbGwodGhpcykpOwoKLyohCgogIG90ci5qcyB2MC4yLjEyIC0gMjAxNC0wNC0xNQogIChjKSAyMDE0IC0gQXJsbyBCcmVhdWx0IDxhcmxvbHJhQGdtYWlsLmNvbT4KICBGcmVlbHkgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIE1QTCB2Mi4wIGxpY2Vuc2UuCgogIFRoaXMgZmlsZSBpcyBjb25jYXRlbmF0ZWQgZm9yIHRoZSBicm93c2VyLgogIFBsZWFzZSBzZWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9hcmxvbHJhL290cgoKKi8KCjsoZnVuY3Rpb24gKHJvb3QsIGZhY3RvcnkpIHsKCiAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkgewogICAgZGVmaW5lKCdvdHInLFsKICAgICAgICAianF1ZXJ5IiwKICAgICAgICAianF1ZXJ5LmJyb3dzZXIiLAogICAgICAgICJiaWdpbnQiLAogICAgICAgICJjcnlwdG8iLAogICAgICAgICJldmVudGVtaXR0ZXIiCiAgICBdLCBmdW5jdGlvbiAoJCwgZHVtbXksIEJpZ0ludCwgQ3J5cHRvSlMsIEV2ZW50RW1pdHRlcikgewogICAgICBpZiAoJC5icm93c2VyLm1zaWUpIHsKICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICAgIH0KICAgICAgdmFyIHJvb3QgPSB7CiAgICAgICAgICBCaWdJbnQ6IEJpZ0ludAogICAgICAgICwgQ3J5cHRvSlM6IENyeXB0b0pTCiAgICAgICAgLCBFdmVudEVtaXR0ZXI6IEV2ZW50RW1pdHRlcgogICAgICAgICwgT1RSOiB7fQogICAgICAgICwgRFNBOiB7fQogICAgICB9CiAgICAgIHJldHVybiBmYWN0b3J5LmNhbGwocm9vdCkKICAgIH0pCiAgfSBlbHNlIHsKICAgIHJvb3QuT1RSID0ge30KICAgIHJvb3QuRFNBID0ge30KICAgIGZhY3RvcnkuY2FsbChyb290KQogIH0KCn0odGhpcywgZnVuY3Rpb24gKCkgewoKOyhmdW5jdGlvbiAoKSB7CiAgCgogIHZhciByb290ID0gdGhpcwoKICB2YXIgQ09OU1QgPSB7CgogICAgLy8gZGlmZmllLWhlaWxtYW4KICAgICAgTiA6ICdGRkZGRkZGRkZGRkZGRkZGQzkwRkRBQTIyMTY4QzIzNEM0QzY2MjhCODBEQzFDRDEyOTAyNEUwODhBNjdDQzc0MDIwQkJFQTYzQjEzOUIyMjUxNEEwODc5OEUzNDA0RERFRjk1MTlCM0NEM0E0MzFCMzAyQjBBNkRGMjVGMTQzNzRGRTEzNTZENkQ1MUMyNDVFNDg1QjU3NjYyNUU3RUM2RjQ0QzQyRTlBNjM3RUQ2QjBCRkY1Q0I2RjQwNkI3RURFRTM4NkJGQjVBODk5RkE1QUU5RjI0MTE3QzRCMUZFNjQ5Mjg2NjUxRUNFNDVCM0RDMjAwN0NCOEExNjNCRjA1OThEQTQ4MzYxQzU1RDM5QTY5MTYzRkE4RkQyNENGNUY4MzY1NUQyM0RDQTNBRDk2MUM2MkYzNTYyMDg1NTJCQjlFRDUyOTA3NzA5Njk2NkQ2NzBDMzU0RTRBQkM5ODA0RjE3NDZDMDhDQTIzNzMyN0ZGRkZGRkZGRkZGRkZGRkYnCiAgICAsIEcgOiAnMicKCiAgICAvLyBvdHIgbWVzc2FnZSBzdGF0ZXMKICAgICwgTVNHU1RBVEVfUExBSU5URVhUIDogMAogICAgLCBNU0dTVEFURV9FTkNSWVBURUQgOiAxCiAgICAsIE1TR1NUQVRFX0ZJTklTSEVEICA6IDIKCiAgICAvLyBvdHIgYXV0aCBzdGF0ZXMKICAgICwgQVVUSFNUQVRFX05PTkUgICAgICAgICAgICAgICA6IDAKICAgICwgQVVUSFNUQVRFX0FXQUlUSU5HX0RIS0VZICAgICA6IDEKICAgICwgQVVUSFNUQVRFX0FXQUlUSU5HX1JFVkVBTFNJRyA6IDIKICAgICwgQVVUSFNUQVRFX0FXQUlUSU5HX1NJRyAgICAgICA6IDMKCiAgICAvLyB3aGl0ZXNwYWNlIHRhZ3MKICAgICwgV0hJVEVTUEFDRV9UQUcgICAgOiAnXHgyMFx4MDlceDIwXHgyMFx4MDlceDA5XHgwOVx4MDlceDIwXHgwOVx4MjBceDA5XHgyMFx4MDlceDIwXHgyMCcKICAgICwgV0hJVEVTUEFDRV9UQUdfVjIgOiAnXHgyMFx4MjBceDA5XHgwOVx4MjBceDIwXHgwOVx4MjAnCiAgICAsIFdISVRFU1BBQ0VfVEFHX1YzIDogJ1x4MjBceDIwXHgwOVx4MDlceDIwXHgyMFx4MDlceDA5JwoKICAgIC8vIG90ciB0YWdzCiAgICAsIE9UUl9UQUcgICAgICAgOiAnP09UUicKICAgICwgT1RSX1ZFUlNJT05fMSA6ICdceDAwXHgwMScKICAgICwgT1RSX1ZFUlNJT05fMiA6ICdceDAwXHgwMicKICAgICwgT1RSX1ZFUlNJT05fMyA6ICdceDAwXHgwMycKCiAgICAvLyBzbXAgbWFjaGluZSBzdGF0ZXMKICAgICwgU01QU1RBVEVfRVhQRUNUMCA6IDAKICAgICwgU01QU1RBVEVfRVhQRUNUMSA6IDEKICAgICwgU01QU1RBVEVfRVhQRUNUMiA6IDIKICAgICwgU01QU1RBVEVfRVhQRUNUMyA6IDMKICAgICwgU01QU1RBVEVfRVhQRUNUNCA6IDQKCiAgICAvLyB1bnN0YW5kYXJkIHN0YXR1cyBjb2RlcwogICAgLCBTVEFUVVNfU0VORF9RVUVSWSAgOiAwCiAgICAsIFNUQVRVU19BS0VfSU5JVCAgICA6IDEKICAgICwgU1RBVFVTX0FLRV9TVUNDRVNTIDogMgogICAgLCBTVEFUVVNfRU5EX09UUiAgICAgOiAzCgogIH0KCiAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnICYmIG1vZHVsZS5leHBvcnRzKSB7CiAgICBtb2R1bGUuZXhwb3J0cyA9IENPTlNUCiAgfSBlbHNlIHsKICAgIHJvb3QuT1RSLkNPTlNUID0gQ09OU1QKICB9Cgp9KS5jYWxsKHRoaXMpCjsoZnVuY3Rpb24gKCkgewogIAoKICB2YXIgcm9vdCA9IHRoaXMKCiAgdmFyIEhMUCA9IHt9LCBDcnlwdG9KUywgQmlnSW50CiAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnICYmIG1vZHVsZS5leHBvcnRzKSB7CiAgICBtb2R1bGUuZXhwb3J0cyA9IEhMUCA9IHt9CiAgICBDcnlwdG9KUyA9IHJlcXVpcmUoJy4uL3ZlbmRvci9jcnlwdG8uanMnKQogICAgQmlnSW50ID0gcmVxdWlyZSgnLi4vdmVuZG9yL2JpZ2ludC5qcycpCiAgfSBlbHNlIHsKICAgIGlmIChyb290Lk9UUikgcm9vdC5PVFIuSExQID0gSExQCiAgICBpZiAocm9vdC5EU0EpIHJvb3QuRFNBLkhMUCA9IEhMUAogICAgQ3J5cHRvSlMgPSByb290LkNyeXB0b0pTCiAgICBCaWdJbnQgPSByb290LkJpZ0ludAogIH0KCiAgLy8gZGF0YSB0eXBlcyAoYnl0ZSBsZW5ndGhzKQogIHZhciBEVFMgPSB7CiAgICAgIEJZVEUgIDogMQogICAgLCBTSE9SVCA6IDIKICAgICwgSU5UICAgOiA0CiAgICAsIENUUiAgIDogOAogICAgLCBNQUMgICA6IDIwCiAgICAsIFNJRyAgIDogNDAKICB9CgogIC8vIG90ciBtZXNzYWdlIHdyYXBwZXIgYmVnaW4gYW5kIGVuZAogIHZhciBXUkFQUEVSX0JFR0lOID0gIj9PVFIiCiAgICAsIFdSQVBQRVJfRU5EICAgPSAiLiIKCiAgdmFyIFRXTyA9IEJpZ0ludC5zdHIyYmlnSW50KCcyJywgMTApCgogIEhMUC5kZWJ1ZyA9IGZ1bmN0aW9uIChtc2cpIHsKICAgIC8vIHVzZWQgYXMgSExQLmRlYnVnLmNhbGwoY3R4LCBtc2cpCiAgICBpZiAoIHRoaXMuZGVidWcgJiYKICAgICAgICAgdHlwZW9mIHRoaXMuZGVidWcgIT09ICdmdW5jdGlvbicgJiYKICAgICAgICAgdHlwZW9mIGNvbnNvbGUgIT09ICd1bmRlZmluZWQnCiAgICApIGNvbnNvbGUubG9nKG1zZykKICB9CgogIEhMUC5leHRlbmQgPSBmdW5jdGlvbiAoY2hpbGQsIHBhcmVudCkgewogICAgZm9yICh2YXIga2V5IGluIHBhcmVudCkgewogICAgICBpZiAoT2JqZWN0Lmhhc093blByb3BlcnR5LmNhbGwocGFyZW50LCBrZXkpKQogICAgICAgIGNoaWxkW2tleV0gPSBwYXJlbnRba2V5XQogICAgfQogICAgZnVuY3Rpb24gQ3RvcigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGNoaWxkIH0KICAgIEN0b3IucHJvdG90eXBlID0gcGFyZW50LnByb3RvdHlwZQogICAgY2hpbGQucHJvdG90eXBlID0gbmV3IEN0b3IoKQogICAgY2hpbGQuX19zdXBlcl9fID0gcGFyZW50LnByb3RvdHlwZQogIH0KCiAgLy8gY29uc3RhbnQtdGltZSBzdHJpbmcgY29tcGFyaXNvbgogIEhMUC5jb21wYXJlID0gZnVuY3Rpb24gKHN0cjEsIHN0cjIpIHsKICAgIGlmIChzdHIxLmxlbmd0aCAhPT0gc3RyMi5sZW5ndGgpCiAgICAgIHJldHVybiBmYWxzZQogICAgdmFyIGkgPSAwLCByZXN1bHQgPSAwCiAgICBmb3IgKDsgaSA8IHN0cjEubGVuZ3RoOyBpKyspCiAgICAgIHJlc3VsdCB8PSBzdHIxW2ldLmNoYXJDb2RlQXQoMCkgXiBzdHIyW2ldLmNoYXJDb2RlQXQoMCkKICAgIHJldHVybiByZXN1bHQgPT09IDAKICB9CgogIEhMUC5yYW5kb21FeHBvbmVudCA9IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiBCaWdJbnQucmFuZEJpZ0ludCgxNTM2KQogIH0KCiAgSExQLnNtcEhhc2ggPSBmdW5jdGlvbiAodmVyc2lvbiwgZm1waSwgc21waSkgewogICAgdmFyIHNoYTI1NiA9IENyeXB0b0pTLmFsZ28uU0hBMjU2LmNyZWF0ZSgpCiAgICBzaGEyNTYudXBkYXRlKENyeXB0b0pTLmVuYy5MYXRpbjEucGFyc2UoSExQLnBhY2tCeXRlcyh2ZXJzaW9uLCBEVFMuQllURSkpKQogICAgc2hhMjU2LnVwZGF0ZShDcnlwdG9KUy5lbmMuTGF0aW4xLnBhcnNlKEhMUC5wYWNrTVBJKGZtcGkpKSkKICAgIGlmIChzbXBpKSBzaGEyNTYudXBkYXRlKENyeXB0b0pTLmVuYy5MYXRpbjEucGFyc2UoSExQLnBhY2tNUEkoc21waSkpKQogICAgdmFyIGhhc2ggPSBzaGEyNTYuZmluYWxpemUoKQogICAgcmV0dXJuIEhMUC5iaXRzMmJpZ0ludChoYXNoLnRvU3RyaW5nKENyeXB0b0pTLmVuYy5MYXRpbjEpKQogIH0KCiAgSExQLm1ha2VNYWMgPSBmdW5jdGlvbiAoYWVzY3RyLCBtKSB7CiAgICB2YXIgcGFzcyA9IENyeXB0b0pTLmVuYy5MYXRpbjEucGFyc2UobSkKICAgIHZhciBtYWMgPSBDcnlwdG9KUy5IbWFjU0hBMjU2KENyeXB0b0pTLmVuYy5MYXRpbjEucGFyc2UoYWVzY3RyKSwgcGFzcykKICAgIHJldHVybiBITFAubWFzayhtYWMudG9TdHJpbmcoQ3J5cHRvSlMuZW5jLkxhdGluMSksIDAsIDE2MCkKICB9CgogIEhMUC5tYWtlMU1hYyA9IGZ1bmN0aW9uIChhZXNjdHIsIG0pIHsKICAgIHZhciBwYXNzID0gQ3J5cHRvSlMuZW5jLkxhdGluMS5wYXJzZShtKQogICAgdmFyIG1hYyA9IENyeXB0b0pTLkhtYWNTSEExKENyeXB0b0pTLmVuYy5MYXRpbjEucGFyc2UoYWVzY3RyKSwgcGFzcykKICAgIHJldHVybiBtYWMudG9TdHJpbmcoQ3J5cHRvSlMuZW5jLkxhdGluMSkKICB9CgogIEhMUC5lbmNyeXB0QWVzID0gZnVuY3Rpb24gKG1zZywgYywgaXYpIHsKICAgIHZhciBvcHRzID0gewogICAgICAgIG1vZGU6IENyeXB0b0pTLm1vZGUuQ1RSCiAgICAgICwgaXY6IENyeXB0b0pTLmVuYy5MYXRpbjEucGFyc2UoaXYpCiAgICAgICwgcGFkZGluZzogQ3J5cHRvSlMucGFkLk5vUGFkZGluZwogICAgfQogICAgdmFyIGFlc2N0ciA9IENyeXB0b0pTLkFFUy5lbmNyeXB0KAogICAgICAgIG1zZwogICAgICAsIENyeXB0b0pTLmVuYy5MYXRpbjEucGFyc2UoYykKICAgICAgLCBvcHRzCiAgICApCiAgICB2YXIgYWVzY3RyX2RlY29kZWQgPSBDcnlwdG9KUy5lbmMuQmFzZTY0LnBhcnNlKGFlc2N0ci50b1N0cmluZygpKQogICAgcmV0dXJuIENyeXB0b0pTLmVuYy5MYXRpbjEuc3RyaW5naWZ5KGFlc2N0cl9kZWNvZGVkKQogIH0KCiAgSExQLmRlY3J5cHRBZXMgPSBmdW5jdGlvbiAobXNnLCBjLCBpdikgewogICAgbXNnID0gQ3J5cHRvSlMuZW5jLkxhdGluMS5wYXJzZShtc2cpCiAgICB2YXIgb3B0cyA9IHsKICAgICAgICBtb2RlOiBDcnlwdG9KUy5tb2RlLkNUUgogICAgICAsIGl2OiBDcnlwdG9KUy5lbmMuTGF0aW4xLnBhcnNlKGl2KQogICAgICAsIHBhZGRpbmc6IENyeXB0b0pTLnBhZC5Ob1BhZGRpbmcKICAgIH0KICAgIHJldHVybiBDcnlwdG9KUy5BRVMuZGVjcnlwdCgKICAgICAgICBDcnlwdG9KUy5lbmMuQmFzZTY0LnN0cmluZ2lmeShtc2cpCiAgICAgICwgQ3J5cHRvSlMuZW5jLkxhdGluMS5wYXJzZShjKQogICAgICAsIG9wdHMKICAgICkKICB9CgogIEhMUC5tdWx0UG93TW9kID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQsIGUpIHsKICAgIHJldHVybiBCaWdJbnQubXVsdE1vZChCaWdJbnQucG93TW9kKGEsIGIsIGUpLCBCaWdJbnQucG93TW9kKGMsIGQsIGUpLCBlKQogIH0KCiAgSExQLlpLUCA9IGZ1bmN0aW9uICh2LCBjLCBkLCBlKSB7CiAgICByZXR1cm4gQmlnSW50LmVxdWFscyhjLCBITFAuc21wSGFzaCh2LCBkLCBlKSkKICB9CgogIC8vIGdyZWF0ZXIgdGhhbiwgb3IgZXF1YWwKICBITFAuR1RPRSA9IGZ1bmN0aW9uIChhLCBiKSB7CiAgICByZXR1cm4gKEJpZ0ludC5lcXVhbHMoYSwgYikgfHwgQmlnSW50LmdyZWF0ZXIoYSwgYikpCiAgfQoKICBITFAuYmV0d2VlbiA9IGZ1bmN0aW9uICh4LCBhLCBiKSB7CiAgICByZXR1cm4gKEJpZ0ludC5ncmVhdGVyKHgsIGEpICYmIEJpZ0ludC5ncmVhdGVyKGIsIHgpKQogIH0KCiAgSExQLmNoZWNrR3JvdXAgPSBmdW5jdGlvbiAoZywgTl9NSU5VU18yKSB7CiAgICByZXR1cm4gSExQLkdUT0UoZywgVFdPKSAmJiBITFAuR1RPRShOX01JTlVTXzIsIGcpCiAgfQoKICBITFAuaDEgPSBmdW5jdGlvbiAoYiwgc2VjYnl0ZXMpIHsKICAgIHZhciBzaGExID0gQ3J5cHRvSlMuYWxnby5TSEExLmNyZWF0ZSgpCiAgICBzaGExLnVwZGF0ZShDcnlwdG9KUy5lbmMuTGF0aW4xLnBhcnNlKGIpKQogICAgc2hhMS51cGRhdGUoQ3J5cHRvSlMuZW5jLkxhdGluMS5wYXJzZShzZWNieXRlcykpCiAgICByZXR1cm4gKHNoYTEuZmluYWxpemUoKSkudG9TdHJpbmcoQ3J5cHRvSlMuZW5jLkxhdGluMSkKICB9CgogIEhMUC5oMiA9IGZ1bmN0aW9uIChiLCBzZWNieXRlcykgewogICAgdmFyIHNoYTI1NiA9IENyeXB0b0pTLmFsZ28uU0hBMjU2LmNyZWF0ZSgpCiAgICBzaGEyNTYudXBkYXRlKENyeXB0b0pTLmVuYy5MYXRpbjEucGFyc2UoYikpCiAgICBzaGEyNTYudXBkYXRlKENyeXB0b0pTLmVuYy5MYXRpbjEucGFyc2Uoc2VjYnl0ZXMpKQogICAgcmV0dXJuIChzaGEyNTYuZmluYWxpemUoKSkudG9TdHJpbmcoQ3J5cHRvSlMuZW5jLkxhdGluMSkKICB9CgogIEhMUC5tYXNrID0gZnVuY3Rpb24gKGJ5dGVzLCBzdGFydCwgbikgewogICAgcmV0dXJuIGJ5dGVzLnN1YnN0cihzdGFydCAvIDgsIG4gLyA4KQogIH0KCiAgdmFyIF90b1N0cmluZyA9IFN0cmluZy5mcm9tQ2hhckNvZGU7CiAgSExQLnBhY2tCeXRlcyA9IGZ1bmN0aW9uICh2YWwsIGJ5dGVzKSB7CiAgICB2YWwgPSB2YWwudG9TdHJpbmcoMTYpCiAgICB2YXIgbmV4LCByZXMgPSAnJyAgLy8gYmlnLWVuZGlhbiwgdW5zaWduZWQgbG9uZwogICAgZm9yICg7IGJ5dGVzID4gMDsgYnl0ZXMtLSkgewogICAgICBuZXggPSB2YWwubGVuZ3RoID8gdmFsLnN1YnN0cigtMiwgMikgOiAnMCcKICAgICAgdmFsID0gdmFsLnN1YnN0cigwLCB2YWwubGVuZ3RoIC0gMikKICAgICAgcmVzID0gX3RvU3RyaW5nKHBhcnNlSW50KG5leCwgMTYpKSArIHJlcwogICAgfQogICAgcmV0dXJuIHJlcwogIH0KCiAgSExQLnBhY2tJTlQgPSBmdW5jdGlvbiAoZCkgewogICAgcmV0dXJuIEhMUC5wYWNrQnl0ZXMoZCwgRFRTLklOVCkKICB9CgogIEhMUC5wYWNrQ3RyID0gZnVuY3Rpb24gKGQpIHsKICAgIHJldHVybiBITFAucGFkQ3RyKEhMUC5wYWNrQnl0ZXMoZCwgRFRTLkNUUikpCiAgfQoKICBITFAucGFkQ3RyID0gZnVuY3Rpb24gKGN0cikgewogICAgcmV0dXJuIGN0ciArICdceDAwXHgwMFx4MDBceDAwXHgwMFx4MDBceDAwXHgwMCcKICB9CgogIEhMUC51bnBhY2tDdHIgPSBmdW5jdGlvbiAoZCkgewogICAgZCA9IEhMUC50b0J5dGVBcnJheShkLnN1YnN0cmluZygwLCA4KSkKICAgIHJldHVybiBITFAudW5wYWNrKGQpCiAgfQoKICBITFAudW5wYWNrID0gZnVuY3Rpb24gKGFycikgewogICAgdmFyIHZhbCA9IDAsIGkgPSAwLCBsZW4gPSBhcnIubGVuZ3RoCiAgICBmb3IgKDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgIHZhbCA9ICh2YWwgKiAyNTYpICsgYXJyW2ldCiAgICB9CiAgICByZXR1cm4gdmFsCiAgfQoKICBITFAucGFja0RhdGEgPSBmdW5jdGlvbiAoZCkgewogICAgcmV0dXJuIEhMUC5wYWNrSU5UKGQubGVuZ3RoKSArIGQKICB9CgogIEhMUC5iaXRzMmJpZ0ludCA9IGZ1bmN0aW9uIChiaXRzKSB7CiAgICBiaXRzID0gSExQLnRvQnl0ZUFycmF5KGJpdHMpCiAgICByZXR1cm4gQmlnSW50LmJhMmJpZ0ludChiaXRzKQogIH0KCiAgSExQLnBhY2tNUEkgPSBmdW5jdGlvbiAobXBpKSB7CiAgICByZXR1cm4gSExQLnBhY2tEYXRhKEJpZ0ludC5iaWdJbnQyYml0cyhCaWdJbnQudHJpbShtcGksIDApKSkKICB9CgogIEhMUC5wYWNrU0hPUlQgPSBmdW5jdGlvbiAoc2hvcnQpIHsKICAgIHJldHVybiBITFAucGFja0J5dGVzKHNob3J0LCBEVFMuU0hPUlQpCiAgfQoKICBITFAudW5wYWNrU0hPUlQgPSBmdW5jdGlvbiAoc2hvcnQpIHsKICAgIHNob3J0ID0gSExQLnRvQnl0ZUFycmF5KHNob3J0KQogICAgcmV0dXJuIEhMUC51bnBhY2soc2hvcnQpCiAgfQoKICBITFAucGFja1RMViA9IGZ1bmN0aW9uICh0eXBlLCB2YWx1ZSkgewogICAgcmV0dXJuIEhMUC5wYWNrU0hPUlQodHlwZSkgKyBITFAucGFja1NIT1JUKHZhbHVlLmxlbmd0aCkgKyB2YWx1ZQogIH0KCiAgSExQLnJlYWRMZW4gPSBmdW5jdGlvbiAobXNnKSB7CiAgICBtc2cgPSBITFAudG9CeXRlQXJyYXkobXNnLnN1YnN0cmluZygwLCA0KSkKICAgIHJldHVybiBITFAudW5wYWNrKG1zZykKICB9CgogIEhMUC5yZWFkRGF0YSA9IGZ1bmN0aW9uIChkYXRhKSB7CiAgICB2YXIgbiA9IEhMUC51bnBhY2soZGF0YS5zcGxpY2UoMCwgNCkpCiAgICByZXR1cm4gW24sIGRhdGFdCiAgfQoKICBITFAucmVhZE1QSSA9IGZ1bmN0aW9uIChkYXRhKSB7CiAgICBkYXRhID0gSExQLnRvQnl0ZUFycmF5KGRhdGEpCiAgICBkYXRhID0gSExQLnJlYWREYXRhKGRhdGEpCiAgICByZXR1cm4gQmlnSW50LmJhMmJpZ0ludChkYXRhWzFdKQogIH0KCiAgSExQLnBhY2tNUElzID0gZnVuY3Rpb24gKGFycikgewogICAgcmV0dXJuIGFyci5yZWR1Y2UoZnVuY3Rpb24gKHBydiwgY3VyKSB7CiAgICAgIHJldHVybiBwcnYgKyBITFAucGFja01QSShjdXIpCiAgICB9LCAnJykKICB9CgogIEhMUC51bnBhY2tNUElzID0gZnVuY3Rpb24gKG51bSwgbXBpcykgewogICAgdmFyIGkgPSAwLCBhcnIgPSBbXQogICAgZm9yICg7IGkgPCBudW07IGkrKykgYXJyLnB1c2goJ01QSScpCiAgICByZXR1cm4gKEhMUC5zcGxpdHlwZShhcnIsIG1waXMpKS5tYXAoZnVuY3Rpb24gKG0pIHsKICAgICAgcmV0dXJuIEhMUC5yZWFkTVBJKG0pCiAgICB9KQogIH0KCiAgSExQLndyYXBNc2cgPSBmdW5jdGlvbiAobXNnLCBmcywgdjMsIG91cl9pdCwgdGhlaXJfaXQpIHsKICAgIG1zZyA9IENyeXB0b0pTLmVuYy5CYXNlNjQuc3RyaW5naWZ5KENyeXB0b0pTLmVuYy5MYXRpbjEucGFyc2UobXNnKSkKICAgIG1zZyA9IFdSQVBQRVJfQkVHSU4gKyAiOiIgKyBtc2cgKyBXUkFQUEVSX0VORAoKICAgIHZhciBpdHMKICAgIGlmICh2MykgewogICAgICBpdHMgPSAnfCcKICAgICAgaXRzICs9IChITFAucmVhZExlbihvdXJfaXQpKS50b1N0cmluZygxNikKICAgICAgaXRzICs9ICd8JwogICAgICBpdHMgKz0gKEhMUC5yZWFkTGVuKHRoZWlyX2l0KSkudG9TdHJpbmcoMTYpCiAgICB9CgogICAgaWYgKCFmcykgcmV0dXJuIFtudWxsLCBtc2ddCgogICAgdmFyIG4gPSBNYXRoLmNlaWwobXNnLmxlbmd0aCAvIGZzKQogICAgaWYgKG4gPiA2NTUzNSkgcmV0dXJuIFsnVG9vIG1hbnkgZnJhZ21lbnRzJ10KICAgIGlmIChuID09IDEpIHJldHVybiBbbnVsbCwgbXNnXQoKICAgIHZhciBrLCBiaSwgZWksIGZyYWcsIG1mLCBtZnMgPSBbXQogICAgZm9yIChrID0gMTsgayA8PSBuOyBrKyspIHsKICAgICAgYmkgPSAoayAtIDEpICogZnMKICAgICAgZWkgPSBrICogZnMKICAgICAgZnJhZyA9IG1zZy5zbGljZShiaSwgZWkpCiAgICAgIG1mID0gV1JBUFBFUl9CRUdJTgogICAgICBpZiAodjMpIG1mICs9IGl0cwogICAgICBtZiArPSAnLCcgKyBrICsgJywnCiAgICAgIG1mICs9IG4gKyAnLCcKICAgICAgbWYgKz0gZnJhZyArICcsJwogICAgICBtZnMucHVzaChtZikKICAgIH0KCiAgICByZXR1cm4gW251bGwsIG1mc10KICB9CgogIEhMUC5zcGxpdHlwZSA9IGZ1bmN0aW9uIHNwbGl0eXBlKGFyciwgbXNnKSB7CiAgICB2YXIgZGF0YSA9IFtdCiAgICBhcnIuZm9yRWFjaChmdW5jdGlvbiAoYSkgewogICAgICB2YXIgc3RyCiAgICAgIHN3aXRjaCAoYSkgewogICAgICAgIGNhc2UgJ1BVQktFWSc6CiAgICAgICAgICBzdHIgPSBzcGxpdHlwZShbJ1NIT1JUJywgJ01QSScsICdNUEknLCAnTVBJJywgJ01QSSddLCBtc2cpLmpvaW4oJycpCiAgICAgICAgICBicmVhawogICAgICAgIGNhc2UgJ0RBVEEnOiAgLy8gZmFsbHMgdGhyb3VnaAogICAgICAgIGNhc2UgJ01QSSc6CiAgICAgICAgICBzdHIgPSBtc2cuc3Vic3RyaW5nKDAsIEhMUC5yZWFkTGVuKG1zZykgKyA0KQogICAgICAgICAgYnJlYWsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgc3RyID0gbXNnLnN1YnN0cmluZygwLCBEVFNbYV0pCiAgICAgIH0KICAgICAgZGF0YS5wdXNoKHN0cikKICAgICAgbXNnID0gbXNnLnN1YnN0cmluZyhzdHIubGVuZ3RoKQogICAgfSkKICAgIHJldHVybiBkYXRhCiAgfQoKICAvLyBodHRwczovL2dpdGh1Yi5jb20vbXNncGFjay9tc2dwYWNrLWphdmFzY3JpcHQvYmxvYi9tYXN0ZXIvbXNncGFjay5qcwoKICB2YXIgX2JpbjJudW0gPSAoZnVuY3Rpb24gKCkgewogICAgdmFyIGkgPSAwLCBfYmluMm51bSA9IHt9CiAgICBmb3IgKDsgaSA8IDB4MTAwOyArK2kpIHsKICAgICAgX2JpbjJudW1bU3RyaW5nLmZyb21DaGFyQ29kZShpKV0gPSBpICAvLyAiXDAwIiAtPiAweDAwCiAgICB9CiAgICBmb3IgKGkgPSAweDgwOyBpIDwgMHgxMDA7ICsraSkgeyAgLy8gW1dlYmtpdF1bR2Vja29dCiAgICAgIF9iaW4ybnVtW1N0cmluZy5mcm9tQ2hhckNvZGUoMHhmNzAwICsgaSldID0gaSAgLy8gIlxmNzgwIiAtPiAweDgwCiAgICB9CiAgICByZXR1cm4gX2JpbjJudW0KICB9KCkpCgogIEhMUC50b0J5dGVBcnJheSA9IGZ1bmN0aW9uIChkYXRhKSB7CiAgICB2YXIgcnYgPSBbXQogICAgICAsIGFyeSA9IGRhdGEuc3BsaXQoIiIpCiAgICAgICwgaSA9IC0xCiAgICAgICwgaXogPSBhcnkubGVuZ3RoCiAgICAgICwgcmVtYWluID0gaXogJSA4CgogICAgd2hpbGUgKHJlbWFpbi0tKSB7CiAgICAgICsraQogICAgICBydltpXSA9IF9iaW4ybnVtW2FyeVtpXV0KICAgIH0KICAgIHJlbWFpbiA9IGl6ID4+IDMKICAgIHdoaWxlIChyZW1haW4tLSkgewogICAgICBydi5wdXNoKF9iaW4ybnVtW2FyeVsrK2ldXSwgX2JpbjJudW1bYXJ5WysraV1dLAogICAgICAgICAgICAgIF9iaW4ybnVtW2FyeVsrK2ldXSwgX2JpbjJudW1bYXJ5WysraV1dLAogICAgICAgICAgICAgIF9iaW4ybnVtW2FyeVsrK2ldXSwgX2JpbjJudW1bYXJ5WysraV1dLAogICAgICAgICAgICAgIF9iaW4ybnVtW2FyeVsrK2ldXSwgX2JpbjJudW1bYXJ5WysraV1dKQogICAgfQogICAgcmV0dXJuIHJ2CiAgfQoKfSkuY2FsbCh0aGlzKQo7KGZ1bmN0aW9uICgpIHsKICAKCiAgdmFyIHJvb3QgPSB0aGlzCgogIHZhciBDcnlwdG9KUywgQmlnSW50LCBXb3JrZXIsIFdXUGF0aCwgSExQCiAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnICYmIG1vZHVsZS5leHBvcnRzKSB7CiAgICBtb2R1bGUuZXhwb3J0cyA9IERTQQogICAgQ3J5cHRvSlMgPSByZXF1aXJlKCcuLi92ZW5kb3IvY3J5cHRvLmpzJykKICAgIEJpZ0ludCA9IHJlcXVpcmUoJy4uL3ZlbmRvci9iaWdpbnQuanMnKQogICAgV1dQYXRoID0gcmVxdWlyZSgncGF0aCcpLmpvaW4oX19kaXJuYW1lLCAnL2RzYS13ZWJ3b3JrZXIuanMnKQogICAgSExQID0gcmVxdWlyZSgnLi9oZWxwZXJzLmpzJykKICB9IGVsc2UgewogICAgLy8gY29weSBvdmVyIGFuZCBleHBvc2UgaW50ZXJuYWxzCiAgICBPYmplY3Qua2V5cyhyb290LkRTQSkuZm9yRWFjaChmdW5jdGlvbiAoaykgewogICAgICBEU0Fba10gPSByb290LkRTQVtrXQogICAgfSkKICAgIHJvb3QuRFNBID0gRFNBCiAgICBDcnlwdG9KUyA9IHJvb3QuQ3J5cHRvSlMKICAgIEJpZ0ludCA9IHJvb3QuQmlnSW50CiAgICBXb3JrZXIgPSByb290LldvcmtlcgogICAgV1dQYXRoID0gJ2RzYS13ZWJ3b3JrZXIuanMnCiAgICBITFAgPSBEU0EuSExQCiAgfQoKICB2YXIgWkVSTyA9IEJpZ0ludC5zdHIyYmlnSW50KCcwJywgMTApCiAgICAsIE9ORSA9IEJpZ0ludC5zdHIyYmlnSW50KCcxJywgMTApCiAgICAsIFRXTyA9IEJpZ0ludC5zdHIyYmlnSW50KCcyJywgMTApCiAgICAsIEtFWV9UWVBFID0gJ1x4MDBceDAwJwoKICB2YXIgREVCVUcgPSBmYWxzZQogIGZ1bmN0aW9uIHRpbWVyKCkgewogICAgdmFyIHN0YXJ0ID0gKG5ldyBEYXRlKCkpLmdldFRpbWUoKQogICAgcmV0dXJuIGZ1bmN0aW9uIChzKSB7CiAgICAgIGlmICghREVCVUcgfHwgdHlwZW9mIGNvbnNvbGUgPT09ICd1bmRlZmluZWQnKSByZXR1cm4KICAgICAgdmFyIHQgPSAobmV3IERhdGUoKSkuZ2V0VGltZSgpCiAgICAgIGNvbnNvbGUubG9nKHMgKyAnOiAnICsgKHQgLSBzdGFydCkpCiAgICAgIHN0YXJ0ID0gdAogICAgfQogIH0KCiAgZnVuY3Rpb24gbWFrZVJhbmRvbShtaW4sIG1heCkgewogICAgdmFyIGMgPSBCaWdJbnQucmFuZEJpZ0ludChCaWdJbnQuYml0U2l6ZShtYXgpKQogICAgaWYgKCFITFAuYmV0d2VlbihjLCBtaW4sIG1heCkpIHJldHVybiBtYWtlUmFuZG9tKG1pbiwgbWF4KQogICAgcmV0dXJuIGMKICB9CgogIC8vIGFsdGVyZWQgQmlnSW50LnJhbmRQcm9iUHJpbWUoKQogIC8vIG4gcm91bmRzIG9mIE1pbGxlciBSYWJpbiAoYWZ0ZXIgdHJpYWwgZGl2aXNpb24gd2l0aCBzbWFsbCBwcmltZXMpCiAgdmFyIHJwcHJiID0gW10KICBmdW5jdGlvbiBpc1Byb2JQcmltZShrLCBuKSB7CiAgICB2YXIgaSwgQiA9IDMwMDAwLCBsID0gQmlnSW50LmJpdFNpemUoaykKICAgIHZhciBwcmltZXMgPSBCaWdJbnQucHJpbWVzCgogICAgaWYgKHByaW1lcy5sZW5ndGggPT09IDApCiAgICAgIHByaW1lcyA9IEJpZ0ludC5maW5kUHJpbWVzKEIpCgogICAgaWYgKHJwcHJiLmxlbmd0aCAhPSBrLmxlbmd0aCkKICAgICAgcnBwcmIgPSBCaWdJbnQuZHVwKGspCgogICAgLy8gY2hlY2sgYW5zIGZvciBkaXZpc2liaWxpdHkgYnkgc21hbGwgcHJpbWVzIHVwIHRvIEIKICAgIGZvciAoaSA9IDA7IChpIDwgcHJpbWVzLmxlbmd0aCkgJiYgKHByaW1lc1tpXSA8PSBCKTsgaSsrKQogICAgICBpZiAoQmlnSW50Lm1vZEludChrLCBwcmltZXNbaV0pID09PSAwICYmICFCaWdJbnQuZXF1YWxzSW50KGssIHByaW1lc1tpXSkpCiAgICAgICAgcmV0dXJuIDAKCiAgICAvLyBkbyBuIHJvdW5kcyBvZiBNaWxsZXIgUmFiaW4sIHdpdGggcmFuZG9tIGJhc2VzIGxlc3MgdGhhbiBrCiAgICBmb3IgKGkgPSAwOyBpIDwgbjsgaSsrKSB7CiAgICAgIEJpZ0ludC5yYW5kQmlnSW50XyhycHByYiwgbCwgMCkKICAgICAgd2hpbGUoIUJpZ0ludC5ncmVhdGVyKGssIHJwcHJiKSkgIC8vIHBpY2sgYSByYW5kb20gcnBwcmIgdGhhdCdzIDwgawogICAgICAgIEJpZ0ludC5yYW5kQmlnSW50XyhycHByYiwgbCwgMCkKICAgICAgaWYgKCFCaWdJbnQubWlsbGVyUmFiaW4oaywgcnBwcmIpKQogICAgICAgIHJldHVybiAwCiAgICB9CgogICAgcmV0dXJuIDEKICB9CgogIHZhciBiaXRfbGVuZ3RocyA9IHsKICAgICAgJzEwMjQnOiB7IE46IDE2MCwgcmVwZWF0OiA0MCB9ICAvLyA0MHggc2hvdWxkIGdpdmUgMl4tODAgY29uZmlkZW5jZQogICAgLCAnMjA0OCc6IHsgTjogMjI0LCByZXBlYXQ6IDU2IH0KICB9CgogIHZhciBwcmltZXMgPSB7fQoKICAvLyBmb2xsb3dzIGdvIGxhbmcgaHR0cDovL2dvbGFuZy5vcmcvc3JjL3BrZy9jcnlwdG8vZHNhL2RzYS5nbwogIC8vIGZpcHMgdmVyc2lvbiB3YXMgcmVtb3ZlZCBpbiAwYzk5YWYwZGYzZTcKICBmdW5jdGlvbiBnZW5lcmF0ZVByaW1lcyhiaXRfbGVuZ3RoKSB7CgogICAgdmFyIHQgPSB0aW1lcigpICAvLyBmb3IgZGVidWdnaW5nCgogICAgLy8gbnVtYmVyIG9mIE1SIHRlc3RzIHRvIHBlcmZvcm0KICAgIHZhciByZXBlYXQgPSBiaXRfbGVuZ3Roc1tiaXRfbGVuZ3RoXS5yZXBlYXQKCiAgICB2YXIgTiA9IGJpdF9sZW5ndGhzW2JpdF9sZW5ndGhdLk4KCiAgICB2YXIgTE0xID0gQmlnSW50LnR3b1RvVGhlKGJpdF9sZW5ndGggLSAxKQogICAgdmFyIGJsNCA9IDQgKiBiaXRfbGVuZ3RoCiAgICB2YXIgYnJrID0gZmFsc2UKCiAgICB2YXIgcSwgcCwgcmVtLCBjb3VudGVyCiAgICBmb3IgKDs7KSB7CgogICAgICBxID0gQmlnSW50LnJhbmRCaWdJbnQoTiwgMSkKICAgICAgcVswXSB8PSAxCgogICAgICBpZiAoIWlzUHJvYlByaW1lKHEsIHJlcGVhdCkpIGNvbnRpbnVlCiAgICAgIHQoJ3EnKQoKICAgICAgZm9yIChjb3VudGVyID0gMDsgY291bnRlciA8IGJsNDsgY291bnRlcisrKSB7CiAgICAgICAgcCA9IEJpZ0ludC5yYW5kQmlnSW50KGJpdF9sZW5ndGgsIDEpCiAgICAgICAgcFswXSB8PSAxCgogICAgICAgIHJlbSA9IEJpZ0ludC5tb2QocCwgcSkKICAgICAgICByZW0gPSBCaWdJbnQuc3ViKHJlbSwgT05FKQogICAgICAgIHAgPSBCaWdJbnQuc3ViKHAsIHJlbSkKCiAgICAgICAgaWYgKEJpZ0ludC5ncmVhdGVyKExNMSwgcCkpIGNvbnRpbnVlCiAgICAgICAgaWYgKCFpc1Byb2JQcmltZShwLCByZXBlYXQpKSBjb250aW51ZQoKICAgICAgICB0KCdwJykKICAgICAgICBwcmltZXNbYml0X2xlbmd0aF0gPSB7IHA6IHAsIHE6IHEgfQogICAgICAgIGJyayA9IHRydWUKICAgICAgICBicmVhawogICAgICB9CgogICAgICBpZiAoYnJrKSBicmVhawogICAgfQoKICAgIHZhciBoID0gQmlnSW50LmR1cChUV08pCiAgICB2YXIgcG0xID0gQmlnSW50LnN1YihwLCBPTkUpCiAgICB2YXIgZSA9IEJpZ0ludC5tdWx0TW9kKHBtMSwgQmlnSW50LmludmVyc2VNb2QocSwgcCksIHApCgogICAgdmFyIGcKICAgIGZvciAoOzspIHsKICAgICAgZyA9IEJpZ0ludC5wb3dNb2QoaCwgZSwgcCkKICAgICAgaWYgKEJpZ0ludC5lcXVhbHMoZywgT05FKSkgewogICAgICAgIGggPSBCaWdJbnQuYWRkKGgsIE9ORSkKICAgICAgICBjb250aW51ZQogICAgICB9CiAgICAgIHByaW1lc1tiaXRfbGVuZ3RoXS5nID0gZwogICAgICB0KCdnJykKICAgICAgcmV0dXJuCiAgICB9CgogICAgdGhyb3cgbmV3IEVycm9yKCdVbnJlYWNoYWJsZSEnKQogIH0KCiAgZnVuY3Rpb24gRFNBKG9iaiwgb3B0cykgewogICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIERTQSkpIHJldHVybiBuZXcgRFNBKG9iaiwgb3B0cykKCiAgICAvLyBvcHRpb25zCiAgICBvcHRzID0gb3B0cyB8fCB7fQoKICAgIC8vIGluaGVyaXQKICAgIGlmIChvYmopIHsKICAgICAgdmFyIHNlbGYgPSB0aGlzCiAgICAgIDtbJ3AnLCAncScsICdnJywgJ3knLCAneCddLmZvckVhY2goZnVuY3Rpb24gKHByb3ApIHsKICAgICAgICBzZWxmW3Byb3BdID0gb2JqW3Byb3BdCiAgICAgIH0pCiAgICAgIHRoaXMudHlwZSA9IG9iai50eXBlIHx8IEtFWV9UWVBFCiAgICAgIHJldHVybgogICAgfQoKICAgIC8vIGRlZmF1bHQgdG8gMTAyNAogICAgdmFyIGJpdF9sZW5ndGggPSBwYXJzZUludChvcHRzLmJpdF9sZW5ndGggPyBvcHRzLmJpdF9sZW5ndGggOiAxMDI0LCAxMCkKCiAgICBpZiAoIWJpdF9sZW5ndGhzW2JpdF9sZW5ndGhdKQogICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Vuc3VwcG9ydGVkIGJpdCBsZW5ndGguJykKCiAgICAvLyBzZXQgcHJpbWVzCiAgICBpZiAoIXByaW1lc1tiaXRfbGVuZ3RoXSkKICAgICAgZ2VuZXJhdGVQcmltZXMoYml0X2xlbmd0aCkKCiAgICB0aGlzLnAgPSBwcmltZXNbYml0X2xlbmd0aF0ucAogICAgdGhpcy5xID0gcHJpbWVzW2JpdF9sZW5ndGhdLnEKICAgIHRoaXMuZyA9IHByaW1lc1tiaXRfbGVuZ3RoXS5nCgogICAgLy8ga2V5IHR5cGUKICAgIHRoaXMudHlwZSA9IEtFWV9UWVBFCgogICAgLy8gcHJpdmF0ZSBrZXkKICAgIHRoaXMueCA9IG1ha2VSYW5kb20oWkVSTywgdGhpcy5xKQoKICAgIC8vIHB1YmxpYyBrZXlzIChwLCBxLCBnLCB5KQogICAgdGhpcy55ID0gQmlnSW50LnBvd01vZCh0aGlzLmcsIHRoaXMueCwgdGhpcy5wKQoKICAgIC8vIG5vY2FjaGU/CiAgICBpZiAob3B0cy5ub2NhY2hlKSBwcmltZXNbYml0X2xlbmd0aF0gPSBudWxsCiAgfQoKICBEU0EucHJvdG90eXBlID0gewoKICAgIGNvbnN0cnVjdG9yOiBEU0EsCgogICAgcGFja1B1YmxpYzogZnVuY3Rpb24gKCkgewogICAgICB2YXIgc3RyID0gdGhpcy50eXBlCiAgICAgIHN0ciArPSBITFAucGFja01QSSh0aGlzLnApCiAgICAgIHN0ciArPSBITFAucGFja01QSSh0aGlzLnEpCiAgICAgIHN0ciArPSBITFAucGFja01QSSh0aGlzLmcpCiAgICAgIHN0ciArPSBITFAucGFja01QSSh0aGlzLnkpCiAgICAgIHJldHVybiBzdHIKICAgIH0sCgogICAgcGFja1ByaXZhdGU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIHN0ciA9IHRoaXMucGFja1B1YmxpYygpICsgSExQLnBhY2tNUEkodGhpcy54KQogICAgICBzdHIgPSBDcnlwdG9KUy5lbmMuTGF0aW4xLnBhcnNlKHN0cikKICAgICAgcmV0dXJuIHN0ci50b1N0cmluZyhDcnlwdG9KUy5lbmMuQmFzZTY0KQogICAgfSwKCiAgICAvLyBodHRwOi8vd3d3LmltcGVyaWFsdmlvbGV0Lm9yZy8yMDEzLzA2LzE1L3N1ZGRlbmRlYXRoZW50cm9weS5odG1sCiAgICBnZW5lcmF0ZU5vbmNlOiBmdW5jdGlvbiAobSkgewogICAgICB2YXIgcHJpdiA9IEJpZ0ludC5iaWdJbnQyYml0cyhCaWdJbnQudHJpbSh0aGlzLngsIDApKQogICAgICB2YXIgcmFuZCA9IEJpZ0ludC5iaWdJbnQyYml0cyhCaWdJbnQucmFuZEJpZ0ludCgyNTYpKQoKICAgICAgdmFyIHNoYTI1NiA9IENyeXB0b0pTLmFsZ28uU0hBMjU2LmNyZWF0ZSgpCiAgICAgIHNoYTI1Ni51cGRhdGUoQ3J5cHRvSlMuZW5jLkxhdGluMS5wYXJzZShwcml2KSkKICAgICAgc2hhMjU2LnVwZGF0ZShtKQogICAgICBzaGEyNTYudXBkYXRlKENyeXB0b0pTLmVuYy5MYXRpbjEucGFyc2UocmFuZCkpCgogICAgICB2YXIgaGFzaCA9IHNoYTI1Ni5maW5hbGl6ZSgpCiAgICAgIGhhc2ggPSBITFAuYml0czJiaWdJbnQoaGFzaC50b1N0cmluZyhDcnlwdG9KUy5lbmMuTGF0aW4xKSkKICAgICAgQmlnSW50LnJpZ2h0U2hpZnRfKGhhc2gsIDI1NiAtIEJpZ0ludC5iaXRTaXplKHRoaXMucSkpCgogICAgICByZXR1cm4gSExQLmJldHdlZW4oaGFzaCwgWkVSTywgdGhpcy5xKSA/IGhhc2ggOiB0aGlzLmdlbmVyYXRlTm9uY2UobSkKICAgIH0sCgogICAgc2lnbjogZnVuY3Rpb24gKG0pIHsKICAgICAgbSA9IENyeXB0b0pTLmVuYy5MYXRpbjEucGFyc2UobSkKICAgICAgdmFyIGIgPSBCaWdJbnQuc3RyMmJpZ0ludChtLnRvU3RyaW5nKENyeXB0b0pTLmVuYy5IZXgpLCAxNikKICAgICAgdmFyIGssIHIgPSBaRVJPLCBzID0gWkVSTwogICAgICB3aGlsZSAoQmlnSW50LmlzWmVybyhzKSB8fCBCaWdJbnQuaXNaZXJvKHIpKSB7CiAgICAgICAgayA9IHRoaXMuZ2VuZXJhdGVOb25jZShtKQogICAgICAgIHIgPSBCaWdJbnQubW9kKEJpZ0ludC5wb3dNb2QodGhpcy5nLCBrLCB0aGlzLnApLCB0aGlzLnEpCiAgICAgICAgaWYgKEJpZ0ludC5pc1plcm8ocikpIGNvbnRpbnVlCiAgICAgICAgcyA9IEJpZ0ludC5pbnZlcnNlTW9kKGssIHRoaXMucSkKICAgICAgICBzID0gQmlnSW50Lm11bHQocywgQmlnSW50LmFkZChiLCBCaWdJbnQubXVsdCh0aGlzLngsIHIpKSkKICAgICAgICBzID0gQmlnSW50Lm1vZChzLCB0aGlzLnEpCiAgICAgIH0KICAgICAgcmV0dXJuIFtyLCBzXQogICAgfSwKCiAgICBmaW5nZXJwcmludDogZnVuY3Rpb24gKCkgewogICAgICB2YXIgcGsgPSB0aGlzLnBhY2tQdWJsaWMoKQogICAgICBpZiAodGhpcy50eXBlID09PSBLRVlfVFlQRSkgcGsgPSBway5zdWJzdHJpbmcoMikKICAgICAgcGsgPSBDcnlwdG9KUy5lbmMuTGF0aW4xLnBhcnNlKHBrKQogICAgICByZXR1cm4gQ3J5cHRvSlMuU0hBMShwaykudG9TdHJpbmcoQ3J5cHRvSlMuZW5jLkhleCkKICAgIH0KCiAgfQoKICBEU0EucGFyc2VQdWJsaWMgPSBmdW5jdGlvbiAoc3RyLCBwcml2KSB7CiAgICB2YXIgZmllbGRzID0gWydTSE9SVCcsICdNUEknLCAnTVBJJywgJ01QSScsICdNUEknXQogICAgaWYgKHByaXYpIGZpZWxkcy5wdXNoKCdNUEknKQogICAgc3RyID0gSExQLnNwbGl0eXBlKGZpZWxkcywgc3RyKQogICAgdmFyIG9iaiA9IHsKICAgICAgICB0eXBlOiBzdHJbMF0KICAgICAgLCBwOiBITFAucmVhZE1QSShzdHJbMV0pCiAgICAgICwgcTogSExQLnJlYWRNUEkoc3RyWzJdKQogICAgICAsIGc6IEhMUC5yZWFkTVBJKHN0clszXSkKICAgICAgLCB5OiBITFAucmVhZE1QSShzdHJbNF0pCiAgICB9CiAgICBpZiAocHJpdikgb2JqLnggPSBITFAucmVhZE1QSShzdHJbNV0pCiAgICByZXR1cm4gbmV3IERTQShvYmopCiAgfQoKICBmdW5jdGlvbiB0b2tlbml6ZVN0cihzdHIpIHsKICAgIHZhciBzdGFydCwgZW5kCgogICAgc3RhcnQgPSBzdHIuaW5kZXhPZigiKCIpCiAgICBlbmQgPSBzdHIubGFzdEluZGV4T2YoIikiKQoKICAgIGlmIChzdGFydCA8IDAgfHwgZW5kIDwgMCkKICAgICAgdGhyb3cgbmV3IEVycm9yKCJNYWxmb3JtZWQgUy1FeHByZXNzaW9uIikKCiAgICBzdHIgPSBzdHIuc3Vic3RyaW5nKHN0YXJ0ICsgMSwgZW5kKQoKICAgIHZhciBzcGx0ID0gc3RyLnNlYXJjaCgvXHMvKQogICAgdmFyIG9iaiA9IHsKICAgICAgICB0eXBlOiBzdHIuc3Vic3RyaW5nKDAsIHNwbHQpCiAgICAgICwgdmFsOiBbXQogICAgfQoKICAgIHN0ciA9IHN0ci5zdWJzdHJpbmcoc3BsdCArIDEsIGVuZCkKICAgIHN0YXJ0ID0gc3RyLmluZGV4T2YoIigiKQoKICAgIGlmIChzdGFydCA8IDApIG9iai52YWwucHVzaChzdHIpCiAgICBlbHNlIHsKCiAgICAgIHZhciBpLCBsZW4sIHNzLCBlcwogICAgICB3aGlsZSAoc3RhcnQgPiAtMSkgewogICAgICAgIGkgPSBzdGFydCArIDEKICAgICAgICBsZW4gPSBzdHIubGVuZ3RoCiAgICAgICAgZm9yIChzcyA9IDEsIGVzID0gMDsgaSA8IGxlbiAmJiBlcyA8IHNzOyBpKyspIHsKICAgICAgICAgIGlmIChzdHJbaV0gPT09ICIoIikgc3MrKwogICAgICAgICAgaWYgKHN0cltpXSA9PT0gIikiKSBlcysrCiAgICAgICAgfQogICAgICAgIG9iai52YWwucHVzaCh0b2tlbml6ZVN0cihzdHIuc3Vic3RyaW5nKHN0YXJ0LCArK2kpKSkKICAgICAgICBzdHIgPSBzdHIuc3Vic3RyaW5nKCsraSkKICAgICAgICBzdGFydCA9IHN0ci5pbmRleE9mKCIoIikKICAgICAgfQoKICAgIH0KICAgIHJldHVybiBvYmoKICB9CgogIGZ1bmN0aW9uIHBhcnNlTGlib3RyKG9iaikgewogICAgaWYgKCFvYmoudHlwZSkgdGhyb3cgbmV3IEVycm9yKCJQYXJzZSBlcnJvci4iKQoKICAgIHZhciBvLCB2YWwKICAgIGlmIChvYmoudHlwZSA9PT0gInByaXZrZXlzIikgewogICAgICBvID0gW10KICAgICAgb2JqLnZhbC5mb3JFYWNoKGZ1bmN0aW9uIChpKSB7CiAgICAgICAgby5wdXNoKHBhcnNlTGlib3RyKGkpKQogICAgICB9KQogICAgICByZXR1cm4gbwogICAgfQoKICAgIG8gPSB7fQogICAgb2JqLnZhbC5mb3JFYWNoKGZ1bmN0aW9uIChpKSB7CgogICAgICB2YWwgPSBpLnZhbFswXQogICAgICBpZiAodHlwZW9mIHZhbCA9PT0gInN0cmluZyIpIHsKCiAgICAgICAgaWYgKHZhbC5pbmRleE9mKCIjIikgPT09IDApIHsKICAgICAgICAgIHZhbCA9IHZhbC5zdWJzdHJpbmcoMSwgdmFsLmxhc3RJbmRleE9mKCIjIikpCiAgICAgICAgICB2YWwgPSBCaWdJbnQuc3RyMmJpZ0ludCh2YWwsIDE2KQogICAgICAgIH0KCiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFsID0gcGFyc2VMaWJvdHIoaSkKICAgICAgfQoKICAgICAgb1tpLnR5cGVdID0gdmFsCiAgICB9KQoKICAgIHJldHVybiBvCiAgfQoKICBEU0EucGFyc2VQcml2YXRlID0gZnVuY3Rpb24gKHN0ciwgbGlib3RyKSB7CiAgICBpZiAoIWxpYm90cikgewogICAgICBzdHIgPSBDcnlwdG9KUy5lbmMuQmFzZTY0LnBhcnNlKHN0cikKICAgICAgc3RyID0gc3RyLnRvU3RyaW5nKENyeXB0b0pTLmVuYy5MYXRpbjEpCiAgICAgIHJldHVybiBEU0EucGFyc2VQdWJsaWMoc3RyLCB0cnVlKQogICAgfQogICAgLy8gb25seSByZXR1cm5pbmcgdGhlIGZpcnN0IGtleSBmb3VuZAogICAgcmV0dXJuIHBhcnNlTGlib3RyKHRva2VuaXplU3RyKHN0cikpWzBdWyJwcml2YXRlLWtleSJdLmRzYQogIH0KCiAgRFNBLnZlcmlmeSA9IGZ1bmN0aW9uIChrZXksIG0sIHIsIHMpIHsKICAgIGlmICghSExQLmJldHdlZW4ociwgWkVSTywga2V5LnEpIHx8ICFITFAuYmV0d2VlbihzLCBaRVJPLCBrZXkucSkpCiAgICAgIHJldHVybiBmYWxzZQoKICAgIHZhciBobSA9IENyeXB0b0pTLmVuYy5MYXRpbjEucGFyc2UobSkgIC8vIENyeXB0b0pTLlNIQTEobSkKICAgIGhtID0gQmlnSW50LnN0cjJiaWdJbnQoaG0udG9TdHJpbmcoQ3J5cHRvSlMuZW5jLkhleCksIDE2KQoKICAgIHZhciB3ID0gQmlnSW50LmludmVyc2VNb2Qocywga2V5LnEpCiAgICB2YXIgdTEgPSBCaWdJbnQubXVsdE1vZChobSwgdywga2V5LnEpCiAgICB2YXIgdTIgPSBCaWdJbnQubXVsdE1vZChyLCB3LCBrZXkucSkKCiAgICB1MSA9IEJpZ0ludC5wb3dNb2Qoa2V5LmcsIHUxLCBrZXkucCkKICAgIHUyID0gQmlnSW50LnBvd01vZChrZXkueSwgdTIsIGtleS5wKQoKICAgIHZhciB2ID0gQmlnSW50Lm1vZChCaWdJbnQubXVsdE1vZCh1MSwgdTIsIGtleS5wKSwga2V5LnEpCgogICAgcmV0dXJuIEJpZ0ludC5lcXVhbHModiwgcikKICB9CgogIERTQS5jcmVhdGVJbldlYldvcmtlciA9IGZ1bmN0aW9uIChvcHRpb25zLCBjYikgewogICAgdmFyIG9wdHMgPSB7CiAgICAgICAgcGF0aDogV1dQYXRoCiAgICAgICwgc2VlZDogQmlnSW50LmdldFNlZWQKICAgIH0KICAgIGlmIChvcHRpb25zICYmIHR5cGVvZiBvcHRpb25zID09PSAnb2JqZWN0JykKICAgICAgT2JqZWN0LmtleXMob3B0aW9ucykuZm9yRWFjaChmdW5jdGlvbiAoaykgewogICAgICAgIG9wdHNba10gPSBvcHRpb25zW2tdCiAgICAgIH0pCgogICAgLy8gbG9hZCBvcHRpb25hbCBkZXAuIGluIG5vZGUKICAgIGlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyAmJiBtb2R1bGUuZXhwb3J0cykKICAgICAgV29ya2VyID0gcmVxdWlyZSgnd2Vid29ya2VyLXRocmVhZHMnKS5Xb3JrZXIKCiAgICB2YXIgd29ya2VyID0gbmV3IFdvcmtlcihvcHRzLnBhdGgpCiAgICB3b3JrZXIub25tZXNzYWdlID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdmFyIGRhdGEgPSBlLmRhdGEKICAgICAgc3dpdGNoIChkYXRhLnR5cGUpIHsKICAgICAgICBjYXNlICJkZWJ1ZyI6CiAgICAgICAgICBpZiAoIURFQlVHIHx8IHR5cGVvZiBjb25zb2xlID09PSAndW5kZWZpbmVkJykgcmV0dXJuCiAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhLnZhbCkKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImRhdGEiOgogICAgICAgICAgd29ya2VyLnRlcm1pbmF0ZSgpCiAgICAgICAgICBjYihEU0EucGFyc2VQcml2YXRlKGRhdGEudmFsKSkKICAgICAgICAgIGJyZWFrOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlVucmVjb2duaXplZCB0eXBlLiIpCiAgICAgIH0KICAgIH0KICAgIHdvcmtlci5wb3N0TWVzc2FnZSh7CiAgICAgICAgc2VlZDogb3B0cy5zZWVkKCkKICAgICAgLCBpbXBvcnRzOiBvcHRzLmltcG9ydHMKICAgICAgLCBkZWJ1ZzogREVCVUcKICAgIH0pCiAgfQoKfSkuY2FsbCh0aGlzKQo7KGZ1bmN0aW9uICgpIHsKICAKCiAgdmFyIHJvb3QgPSB0aGlzCgogIHZhciBQYXJzZSA9IHt9LCBDcnlwdG9KUywgQ09OU1QsIEhMUAogIGlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyAmJiBtb2R1bGUuZXhwb3J0cykgewogICAgbW9kdWxlLmV4cG9ydHMgPSBQYXJzZQogICAgQ3J5cHRvSlMgPSByZXF1aXJlKCcuLi92ZW5kb3IvY3J5cHRvLmpzJykKICAgIENPTlNUID0gcmVxdWlyZSgnLi9jb25zdC5qcycpCiAgICBITFAgPSByZXF1aXJlKCcuL2hlbHBlcnMuanMnKQogIH0gZWxzZSB7CiAgICByb290Lk9UUi5QYXJzZSA9IFBhcnNlCiAgICBDcnlwdG9KUyA9IHJvb3QuQ3J5cHRvSlMKICAgIENPTlNUID0gcm9vdC5PVFIuQ09OU1QKICAgIEhMUCA9IHJvb3QuT1RSLkhMUAogIH0KCiAgLy8gd2hpdGVzcGFjZSB0YWdzCiAgdmFyIHRhZ3MgPSB7fQogIHRhZ3NbQ09OU1QuV0hJVEVTUEFDRV9UQUdfVjJdID0gQ09OU1QuT1RSX1ZFUlNJT05fMgogIHRhZ3NbQ09OU1QuV0hJVEVTUEFDRV9UQUdfVjNdID0gQ09OU1QuT1RSX1ZFUlNJT05fMwoKICBQYXJzZS5wYXJzZU1zZyA9IGZ1bmN0aW9uIChvdHIsIG1zZykgewoKICAgIHZhciB2ZXIgPSBbXQoKICAgIC8vIGlzIHRoaXMgb3RyPwogICAgdmFyIHN0YXJ0ID0gbXNnLmluZGV4T2YoQ09OU1QuT1RSX1RBRykKICAgIGlmICghfnN0YXJ0KSB7CgogICAgICAvLyByZXN0YXJ0IGZyYWdtZW50cwogICAgICB0aGlzLmluaXRGcmFnbWVudChvdHIpCgogICAgICAvLyB3aGl0ZXNwYWNlIHRhZ3MKICAgICAgaW5kID0gbXNnLmluZGV4T2YoQ09OU1QuV0hJVEVTUEFDRV9UQUcpCgogICAgICBpZiAofmluZCkgewoKICAgICAgICBtc2cgPSBtc2cuc3BsaXQoJycpCiAgICAgICAgbXNnLnNwbGljZShpbmQsIDE2KQoKICAgICAgICB2YXIgdGFnLCBsZW4gPSBtc2cubGVuZ3RoCiAgICAgICAgZm9yICg7IGluZCA8IGxlbjspIHsKICAgICAgICAgIHRhZyA9IG1zZy5zbGljZShpbmQsIGluZCArIDgpLmpvaW4oJycpCiAgICAgICAgICBpZiAoT2JqZWN0Lmhhc093blByb3BlcnR5LmNhbGwodGFncywgdGFnKSkgewogICAgICAgICAgICBtc2cuc3BsaWNlKGluZCwgOCkKICAgICAgICAgICAgdmVyLnB1c2godGFnc1t0YWddKQogICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgfQogICAgICAgICAgaW5kICs9IDgKICAgICAgICB9CgogICAgICAgIG1zZyA9IG1zZy5qb2luKCcnKQoKICAgICAgfQoKICAgICAgcmV0dXJuIHsgbXNnOiBtc2csIHZlcjogdmVyIH0KICAgIH0KCiAgICB2YXIgaW5kID0gc3RhcnQgKyBDT05TVC5PVFJfVEFHLmxlbmd0aAogICAgdmFyIGNvbSA9IG1zZ1tpbmRdCgogICAgLy8gbWVzc2FnZSBmcmFnbWVudAogICAgaWYgKGNvbSA9PT0gJywnIHx8IGNvbSA9PT0gJ3wnKSB7CiAgICAgIHJldHVybiB0aGlzLm1zZ0ZyYWdtZW50KG90ciwgbXNnLnN1YnN0cmluZyhpbmQgKyAxKSwgKGNvbSA9PT0gJ3wnKSkKICAgIH0KCiAgICB0aGlzLmluaXRGcmFnbWVudChvdHIpCgogICAgLy8gcXVlcnkgbWVzc2FnZQogICAgaWYgKH5bJz8nLCAndiddLmluZGV4T2YoY29tKSkgewoKICAgICAgLy8gdmVyc2lvbiAxCiAgICAgIGlmIChtc2dbaW5kXSA9PT0gJz8nKSB7CiAgICAgICAgdmVyLnB1c2goQ09OU1QuT1RSX1ZFUlNJT05fMSkKICAgICAgICBpbmQgKz0gMQogICAgICB9CgogICAgICAvLyBvdGhlciB2ZXJzaW9ucwogICAgICB2YXIgdmVycyA9IHsKICAgICAgICAgICcyJzogQ09OU1QuT1RSX1ZFUlNJT05fMgogICAgICAgICwgJzMnOiBDT05TVC5PVFJfVkVSU0lPTl8zCiAgICAgIH0KICAgICAgdmFyIHFzID0gbXNnLnN1YnN0cmluZyhpbmQgKyAxKQogICAgICB2YXIgcWkgPSBxcy5pbmRleE9mKCc/JykKCiAgICAgIGlmIChxaSA+PSAxKSB7CiAgICAgICAgcXMgPSBxcy5zdWJzdHJpbmcoMCwgcWkpLnNwbGl0KCcnKQogICAgICAgIGlmIChtc2dbaW5kXSA9PT0gJ3YnKSB7CiAgICAgICAgICBxcy5mb3JFYWNoKGZ1bmN0aW9uIChxKSB7CiAgICAgICAgICAgIGlmIChPYmplY3QuaGFzT3duUHJvcGVydHkuY2FsbCh2ZXJzLCBxKSkgdmVyLnB1c2godmVyc1txXSkKICAgICAgICAgIH0pCiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4geyBjbHM6ICdxdWVyeScsIHZlcjogdmVyIH0KICAgIH0KCiAgICAvLyBvdHIgbWVzc2FnZQogICAgaWYgKGNvbSA9PT0gJzonKSB7CgogICAgICBpbmQgKz0gMQoKICAgICAgdmFyIGluZm8gPSBtc2cuc3Vic3RyaW5nKGluZCwgaW5kICsgNCkKICAgICAgaWYgKGluZm8ubGVuZ3RoIDwgNCkgcmV0dXJuIHsgbXNnOiBtc2cgfQogICAgICBpbmZvID0gQ3J5cHRvSlMuZW5jLkJhc2U2NC5wYXJzZShpbmZvKS50b1N0cmluZyhDcnlwdG9KUy5lbmMuTGF0aW4xKQoKICAgICAgdmFyIHZlcnNpb24gPSBpbmZvLnN1YnN0cmluZygwLCAyKQogICAgICB2YXIgdHlwZSA9IGluZm8uc3Vic3RyaW5nKDIpCgogICAgICAvLyBzdXBwb3J0aW5nIG90ciB2ZXJzaW9ucyAyIGFuZCAzCiAgICAgIGlmICghb3RyWydBTExPV19WJyArIEhMUC51bnBhY2tTSE9SVCh2ZXJzaW9uKV0pIHJldHVybiB7IG1zZzogbXNnIH0KCiAgICAgIGluZCArPSA0CgogICAgICB2YXIgZW5kID0gbXNnLnN1YnN0cmluZyhpbmQpLmluZGV4T2YoJy4nKQogICAgICBpZiAoIX5lbmQpIHJldHVybiB7IG1zZzogbXNnIH0KCiAgICAgIG1zZyA9IENyeXB0b0pTLmVuYy5CYXNlNjQucGFyc2UobXNnLnN1YnN0cmluZyhpbmQsIGluZCArIGVuZCkpCiAgICAgIG1zZyA9IENyeXB0b0pTLmVuYy5MYXRpbjEuc3RyaW5naWZ5KG1zZykKCiAgICAgIC8vIGluc3RhbmNlIHRhZ3MKICAgICAgdmFyIGluc3RhbmNlX3RhZ3MKICAgICAgaWYgKHZlcnNpb24gPT09IENPTlNULk9UUl9WRVJTSU9OXzMpIHsKICAgICAgICBpbnN0YW5jZV90YWdzID0gbXNnLnN1YnN0cmluZygwLCA4KQogICAgICAgIG1zZyA9IG1zZy5zdWJzdHJpbmcoOCkKICAgICAgfQoKICAgICAgdmFyIGNscwogICAgICBpZiAoflsnXHgwMicsICdceDBhJywgJ1x4MTEnLCAnXHgxMiddLmluZGV4T2YodHlwZSkpIHsKICAgICAgICBjbHMgPSAnYWtlJwogICAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICdceDAzJykgewogICAgICAgIGNscyA9ICdkYXRhJwogICAgICB9CgogICAgICByZXR1cm4gewogICAgICAgICAgdmVyc2lvbjogdmVyc2lvbgogICAgICAgICwgdHlwZTogdHlwZQogICAgICAgICwgbXNnOiBtc2cKICAgICAgICAsIGNsczogY2xzCiAgICAgICAgLCBpbnN0YW5jZV90YWdzOiBpbnN0YW5jZV90YWdzCiAgICAgIH0KICAgIH0KCiAgICAvLyBlcnJvciBtZXNzYWdlCiAgICBpZiAobXNnLnN1YnN0cmluZyhpbmQsIGluZCArIDcpID09PSAnIEVycm9yOicpIHsKICAgICAgaWYgKG90ci5FUlJPUl9TVEFSVF9BS0UpIHsKICAgICAgICBvdHIuc2VuZFF1ZXJ5TXNnKCkKICAgICAgfQogICAgICByZXR1cm4geyBtc2c6IG1zZy5zdWJzdHJpbmcoaW5kICsgNyksIGNsczogJ2Vycm9yJyB9CiAgICB9CgogICAgcmV0dXJuIHsgbXNnOiBtc2cgfQogIH0KCiAgUGFyc2UuaW5pdEZyYWdtZW50ID0gZnVuY3Rpb24gKG90cikgewogICAgb3RyLmZyYWdtZW50ID0geyBzOiAnJywgajogMCwgazogMCB9CiAgfQoKICBQYXJzZS5tc2dGcmFnbWVudCA9IGZ1bmN0aW9uIChvdHIsIG1zZywgdjMpIHsKCiAgICBtc2cgPSBtc2cuc3BsaXQoJywnKQoKICAgIC8vIGluc3RhbmNlIHRhZ3MKICAgIGlmICh2MykgewogICAgICB2YXIgaXRzID0gbXNnLnNoaWZ0KCkuc3BsaXQoJ3wnKQogICAgICB2YXIgdGhlaXJfaXQgPSBITFAucGFja0lOVChwYXJzZUludChpdHNbMF0sIDE2KSkKICAgICAgdmFyIG91cl9pdCA9IEhMUC5wYWNrSU5UKHBhcnNlSW50KGl0c1sxXSwgMTYpKQogICAgICBpZiAob3RyLmNoZWNrSW5zdGFuY2VUYWdzKHRoZWlyX2l0ICsgb3VyX2l0KSkgcmV0dXJuICAvLyBpZ25vcmUKICAgIH0KCiAgICBpZiAobXNnLmxlbmd0aCA8IDQgfHwKICAgICAgaXNOYU4ocGFyc2VJbnQobXNnWzBdLCAxMCkpIHx8CiAgICAgIGlzTmFOKHBhcnNlSW50KG1zZ1sxXSwgMTApKQogICAgKSByZXR1cm4KCiAgICB2YXIgayA9IHBhcnNlSW50KG1zZ1swXSwgMTApCiAgICB2YXIgbiA9IHBhcnNlSW50KG1zZ1sxXSwgMTApCiAgICBtc2cgPSBtc2dbMl0KCiAgICBpZiAobiA8IGsgfHwgbiA9PT0gMCB8fCBrID09PSAwKSB7CiAgICAgIHRoaXMuaW5pdEZyYWdtZW50KG90cikKICAgICAgcmV0dXJuCiAgICB9CgogICAgaWYgKGsgPT09IDEpIHsKICAgICAgdGhpcy5pbml0RnJhZ21lbnQob3RyKQogICAgICBvdHIuZnJhZ21lbnQgPSB7IGs6IDEsIG46IG4sIHM6IG1zZyB9CiAgICB9IGVsc2UgaWYgKG4gPT09IG90ci5mcmFnbWVudC5uICYmIGsgPT09IChvdHIuZnJhZ21lbnQuayArIDEpKSB7CiAgICAgIG90ci5mcmFnbWVudC5zICs9IG1zZwogICAgICBvdHIuZnJhZ21lbnQuayArPSAxCiAgICB9IGVsc2UgewogICAgICB0aGlzLmluaXRGcmFnbWVudChvdHIpCiAgICB9CgogICAgaWYgKG4gPT09IGspIHsKICAgICAgbXNnID0gb3RyLmZyYWdtZW50LnMKICAgICAgdGhpcy5pbml0RnJhZ21lbnQob3RyKQogICAgICByZXR1cm4gdGhpcy5wYXJzZU1zZyhvdHIsIG1zZykKICAgIH0KCiAgICByZXR1cm4KICB9Cgp9KS5jYWxsKHRoaXMpCjsoZnVuY3Rpb24gKCkgewogIAoKICB2YXIgcm9vdCA9IHRoaXMKCiAgdmFyIENyeXB0b0pTLCBCaWdJbnQsIENPTlNULCBITFAsIERTQQogIGlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyAmJiBtb2R1bGUuZXhwb3J0cykgewogICAgbW9kdWxlLmV4cG9ydHMgPSBBS0UKICAgIENyeXB0b0pTID0gcmVxdWlyZSgnLi4vdmVuZG9yL2NyeXB0by5qcycpCiAgICBCaWdJbnQgPSByZXF1aXJlKCcuLi92ZW5kb3IvYmlnaW50LmpzJykKICAgIENPTlNUID0gcmVxdWlyZSgnLi9jb25zdC5qcycpCiAgICBITFAgPSByZXF1aXJlKCcuL2hlbHBlcnMuanMnKQogICAgRFNBID0gcmVxdWlyZSgnLi9kc2EuanMnKQogIH0gZWxzZSB7CiAgICByb290Lk9UUi5BS0UgPSBBS0UKICAgIENyeXB0b0pTID0gcm9vdC5DcnlwdG9KUwogICAgQmlnSW50ID0gcm9vdC5CaWdJbnQKICAgIENPTlNUID0gcm9vdC5PVFIuQ09OU1QKICAgIEhMUCA9IHJvb3QuT1RSLkhMUAogICAgRFNBID0gcm9vdC5EU0EKICB9CgogIC8vIGRpZmZpZS1oZWxsbWFuIG1vZHVsdXMKICAvLyBzZWUgZ3JvdXAgNSwgUkZDIDM1MjYKICB2YXIgTiA9IEJpZ0ludC5zdHIyYmlnSW50KENPTlNULk4sIDE2KQogIHZhciBOX01JTlVTXzIgPSBCaWdJbnQuc3ViKE4sIEJpZ0ludC5zdHIyYmlnSW50KCcyJywgMTApKQoKICBmdW5jdGlvbiBoTWFjKGd4LCBneSwgcGssIGtpZCwgbSkgewogICAgdmFyIHBhc3MgPSBDcnlwdG9KUy5lbmMuTGF0aW4xLnBhcnNlKG0pCiAgICB2YXIgaG1hYyA9IENyeXB0b0pTLmFsZ28uSE1BQy5jcmVhdGUoQ3J5cHRvSlMuYWxnby5TSEEyNTYsIHBhc3MpCiAgICBobWFjLnVwZGF0ZShDcnlwdG9KUy5lbmMuTGF0aW4xLnBhcnNlKEhMUC5wYWNrTVBJKGd4KSkpCiAgICBobWFjLnVwZGF0ZShDcnlwdG9KUy5lbmMuTGF0aW4xLnBhcnNlKEhMUC5wYWNrTVBJKGd5KSkpCiAgICBobWFjLnVwZGF0ZShDcnlwdG9KUy5lbmMuTGF0aW4xLnBhcnNlKHBrKSkKICAgIGhtYWMudXBkYXRlKENyeXB0b0pTLmVuYy5MYXRpbjEucGFyc2Uoa2lkKSkKICAgIHJldHVybiAoaG1hYy5maW5hbGl6ZSgpKS50b1N0cmluZyhDcnlwdG9KUy5lbmMuTGF0aW4xKQogIH0KCiAgLy8gQUtFIGNvbnN0cnVjdG9yCiAgZnVuY3Rpb24gQUtFKG90cikgewogICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIEFLRSkpIHJldHVybiBuZXcgQUtFKG90cikKCiAgICAvLyBvdHIgaW5zdGFuY2UKICAgIHRoaXMub3RyID0gb3RyCgogICAgLy8gb3VyIGtleXMKICAgIHRoaXMub3VyX2RoID0gb3RyLm91cl9vbGRfZGgKICAgIHRoaXMub3VyX2tleWlkID0gb3RyLm91cl9rZXlpZCAtIDEKCiAgICAvLyB0aGVpciBrZXlzCiAgICB0aGlzLnRoZWlyX3kgPSBudWxsCiAgICB0aGlzLnRoZWlyX2tleWlkID0gbnVsbAogICAgdGhpcy50aGVpcl9wcml2X3BrID0gbnVsbAoKICAgIC8vIHN0YXRlCiAgICB0aGlzLnNzaWQgPSBudWxsCiAgICB0aGlzLnRyYW5zbWl0dGVkUlMgPSBmYWxzZQogICAgdGhpcy5yID0gbnVsbAoKICAgIC8vIGJpbmQgbWV0aG9kcwogICAgdmFyIHNlbGYgPSB0aGlzCiAgICA7WydzZW5kTXNnJ10uZm9yRWFjaChmdW5jdGlvbiAobWV0aCkgewogICAgICBzZWxmW21ldGhdID0gc2VsZlttZXRoXS5iaW5kKHNlbGYpCiAgICB9KQogIH0KCiAgQUtFLnByb3RvdHlwZSA9IHsKCiAgICBjb25zdHJ1Y3RvcjogQUtFLAoKICAgIGNyZWF0ZUtleXM6IGZ1bmN0aW9uKGcpIHsKICAgICAgdmFyIHMgPSBCaWdJbnQucG93TW9kKGcsIHRoaXMub3VyX2RoLnByaXZhdGVLZXksIE4pCiAgICAgIHZhciBzZWNieXRlcyA9IEhMUC5wYWNrTVBJKHMpCiAgICAgIHRoaXMuc3NpZCA9IEhMUC5tYXNrKEhMUC5oMignXHgwMCcsIHNlY2J5dGVzKSwgMCwgNjQpICAvLyBmaXJzdCA2NC1iaXRzCiAgICAgIHZhciB0bXAgPSBITFAuaDIoJ1x4MDEnLCBzZWNieXRlcykKICAgICAgdGhpcy5jID0gSExQLm1hc2sodG1wLCAwLCAxMjgpICAvLyBmaXJzdCAxMjgtYml0cwogICAgICB0aGlzLmNfcHJpbWUgPSBITFAubWFzayh0bXAsIDEyOCwgMTI4KSAgLy8gc2Vjb25kIDEyOC1iaXRzCiAgICAgIHRoaXMubTEgPSBITFAuaDIoJ1x4MDInLCBzZWNieXRlcykKICAgICAgdGhpcy5tMiA9IEhMUC5oMignXHgwMycsIHNlY2J5dGVzKQogICAgICB0aGlzLm0xX3ByaW1lID0gSExQLmgyKCdceDA0Jywgc2VjYnl0ZXMpCiAgICAgIHRoaXMubTJfcHJpbWUgPSBITFAuaDIoJ1x4MDUnLCBzZWNieXRlcykKICAgIH0sCgogICAgdmVyaWZ5U2lnbk1hYzogZnVuY3Rpb24gKG1hYywgYWVzY3RyLCBtMiwgYywgdGhlaXJfeSwgb3VyX2RoX3BrLCBtMSwgY3RyKSB7CiAgICAgIC8vIHZlcmlmeSBtYWMKICAgICAgdmFyIHZtYWMgPSBITFAubWFrZU1hYyhhZXNjdHIsIG0yKQogICAgICBpZiAoIUhMUC5jb21wYXJlKG1hYywgdm1hYykpCiAgICAgICAgcmV0dXJuIFsnTUFDcyBkbyBub3QgbWF0Y2guJ10KCiAgICAgIC8vIGRlY3J5cHQgeAogICAgICB2YXIgeCA9IEhMUC5kZWNyeXB0QWVzKGFlc2N0ci5zdWJzdHJpbmcoNCksIGMsIGN0cikKICAgICAgeCA9IEhMUC5zcGxpdHlwZShbJ1BVQktFWScsICdJTlQnLCAnU0lHJ10sIHgudG9TdHJpbmcoQ3J5cHRvSlMuZW5jLkxhdGluMSkpCgogICAgICB2YXIgbSA9IGhNYWModGhlaXJfeSwgb3VyX2RoX3BrLCB4WzBdLCB4WzFdLCBtMSkKICAgICAgdmFyIHB1YiA9IERTQS5wYXJzZVB1YmxpYyh4WzBdKQoKICAgICAgdmFyIHIgPSBITFAuYml0czJiaWdJbnQoeFsyXS5zdWJzdHJpbmcoMCwgMjApKQogICAgICB2YXIgcyA9IEhMUC5iaXRzMmJpZ0ludCh4WzJdLnN1YnN0cmluZygyMCkpCgogICAgICAvLyB2ZXJpZnkgc2lnbiBtCiAgICAgIGlmICghRFNBLnZlcmlmeShwdWIsIG0sIHIsIHMpKSByZXR1cm4gWydDYW5ub3QgdmVyaWZ5IHNpZ25hdHVyZSBvZiBtLiddCgogICAgICByZXR1cm4gW251bGwsIEhMUC5yZWFkTGVuKHhbMV0pLCBwdWJdCiAgICB9LAoKICAgIG1ha2VNOiBmdW5jdGlvbiAodGhlaXJfeSwgbTEsIGMsIG0yKSB7CiAgICAgIHZhciBwayA9IHRoaXMub3RyLnByaXYucGFja1B1YmxpYygpCiAgICAgIHZhciBraWQgPSBITFAucGFja0lOVCh0aGlzLm91cl9rZXlpZCkKICAgICAgdmFyIG0gPSBoTWFjKHRoaXMub3VyX2RoLnB1YmxpY0tleSwgdGhlaXJfeSwgcGssIGtpZCwgbTEpCiAgICAgIG0gPSB0aGlzLm90ci5wcml2LnNpZ24obSkKICAgICAgdmFyIG1zZyA9IHBrICsga2lkCiAgICAgIG1zZyArPSBCaWdJbnQuYmlnSW50MmJpdHMobVswXSwgMjApICAvLyBwYWQgdG8gMjAgYnl0ZXMKICAgICAgbXNnICs9IEJpZ0ludC5iaWdJbnQyYml0cyhtWzFdLCAyMCkKICAgICAgbXNnID0gQ3J5cHRvSlMuZW5jLkxhdGluMS5wYXJzZShtc2cpCiAgICAgIHZhciBhZXNjdHIgPSBITFAucGFja0RhdGEoSExQLmVuY3J5cHRBZXMobXNnLCBjLCBITFAucGFja0N0cigwKSkpCiAgICAgIHZhciBtYWMgPSBITFAubWFrZU1hYyhhZXNjdHIsIG0yKQogICAgICByZXR1cm4gYWVzY3RyICsgbWFjCiAgICB9LAoKICAgIGFrZVN1Y2Nlc3M6IGZ1bmN0aW9uICh2ZXJzaW9uKSB7CiAgICAgIEhMUC5kZWJ1Zy5jYWxsKHRoaXMub3RyLCAnc3VjY2VzcycpCgogICAgICBpZiAoQmlnSW50LmVxdWFscyh0aGlzLnRoZWlyX3ksIHRoaXMub3VyX2RoLnB1YmxpY0tleSkpCiAgICAgICAgcmV0dXJuIHRoaXMub3RyLmVycm9yKCdlcXVhbCBrZXlzIC0gd2UgaGF2ZSBhIHByb2JsZW0uJywgdHJ1ZSkKCiAgICAgIHRoaXMub3RyLm91cl9vbGRfZGggPSB0aGlzLm91cl9kaAogICAgICB0aGlzLm90ci50aGVpcl9wcml2X3BrID0gdGhpcy50aGVpcl9wcml2X3BrCgogICAgICBpZiAoISgKICAgICAgICAodGhpcy50aGVpcl9rZXlpZCA9PT0gdGhpcy5vdHIudGhlaXJfa2V5aWQgJiYKICAgICAgICAgQmlnSW50LmVxdWFscyh0aGlzLnRoZWlyX3ksIHRoaXMub3RyLnRoZWlyX3kpKSB8fAogICAgICAgICh0aGlzLnRoZWlyX2tleWlkID09PSAodGhpcy5vdHIudGhlaXJfa2V5aWQgLSAxKSAmJgogICAgICAgICBCaWdJbnQuZXF1YWxzKHRoaXMudGhlaXJfeSwgdGhpcy5vdHIudGhlaXJfb2xkX3kpKQogICAgICApKSB7CgogICAgICAgIHRoaXMub3RyLnRoZWlyX3kgPSB0aGlzLnRoZWlyX3kKICAgICAgICB0aGlzLm90ci50aGVpcl9vbGRfeSA9IG51bGwKICAgICAgICB0aGlzLm90ci50aGVpcl9rZXlpZCA9IHRoaXMudGhlaXJfa2V5aWQKCiAgICAgICAgLy8gcm90YXRlIGtleXMKICAgICAgICB0aGlzLm90ci5zZXNzS2V5c1swXSA9IFsgbmV3IHRoaXMub3RyLkRIU2Vzc2lvbigKICAgICAgICAgICAgdGhpcy5vdHIub3VyX2RoCiAgICAgICAgICAsIHRoaXMub3RyLnRoZWlyX3kKICAgICAgICApLCBudWxsIF0KICAgICAgICB0aGlzLm90ci5zZXNzS2V5c1sxXSA9IFsgbmV3IHRoaXMub3RyLkRIU2Vzc2lvbigKICAgICAgICAgICAgdGhpcy5vdHIub3VyX29sZF9kaAogICAgICAgICAgLCB0aGlzLm90ci50aGVpcl95CiAgICAgICAgKSwgbnVsbCBdCgogICAgICB9CgogICAgICAvLyBha2UgaW5mbwogICAgICB0aGlzLm90ci5zc2lkID0gdGhpcy5zc2lkCiAgICAgIHRoaXMub3RyLnRyYW5zbWl0dGVkUlMgPSB0aGlzLnRyYW5zbWl0dGVkUlMKICAgICAgdGhpcy5vdHJfdmVyc2lvbiA9IHZlcnNpb24KCiAgICAgIC8vIGdvIGVuY3J5cHRlZAogICAgICB0aGlzLm90ci5hdXRoc3RhdGUgPSBDT05TVC5BVVRIU1RBVEVfTk9ORQogICAgICB0aGlzLm90ci5tc2dzdGF0ZSA9IENPTlNULk1TR1NUQVRFX0VOQ1JZUFRFRAoKICAgICAgLy8gbnVsbCBvdXQgdmFsdWVzCiAgICAgIHRoaXMuciA9IG51bGwKICAgICAgdGhpcy5teWhhc2hlZCA9IG51bGwKICAgICAgdGhpcy5kaGNvbW1pdCA9IG51bGwKICAgICAgdGhpcy5lbmNyeXB0ZWQgPSBudWxsCiAgICAgIHRoaXMuaGFzaGVkID0gbnVsbAoKICAgICAgdGhpcy5vdHIudHJpZ2dlcignc3RhdHVzJywgW0NPTlNULlNUQVRVU19BS0VfU1VDQ0VTU10pCgogICAgICAvLyBzZW5kIHN0b3JlZCBtc2dzCiAgICAgIHRoaXMub3RyLnNlbmRTdG9yZWQoKQogICAgfSwKCiAgICBoYW5kbGVBS0U6IGZ1bmN0aW9uIChtc2cpIHsKICAgICAgdmFyIHNlbmQsIHZzbSwgdHlwZQogICAgICB2YXIgdmVyc2lvbiA9IG1zZy52ZXJzaW9uCgogICAgICBzd2l0Y2ggKG1zZy50eXBlKSB7CgogICAgICAgIGNhc2UgJ1x4MDInOgogICAgICAgICAgSExQLmRlYnVnLmNhbGwodGhpcy5vdHIsICdkLWgga2V5IG1lc3NhZ2UnKQoKICAgICAgICAgIG1zZyA9IEhMUC5zcGxpdHlwZShbJ0RBVEEnLCAnREFUQSddLCBtc2cubXNnKQoKICAgICAgICAgIGlmICh0aGlzLm90ci5hdXRoc3RhdGUgPT09IENPTlNULkFVVEhTVEFURV9BV0FJVElOR19ESEtFWSkgewogICAgICAgICAgICB2YXIgb3VySGFzaCA9IEhMUC5yZWFkTVBJKHRoaXMubXloYXNoZWQpCiAgICAgICAgICAgIHZhciB0aGVpckhhc2ggPSBITFAucmVhZE1QSShtc2dbMV0pCiAgICAgICAgICAgIGlmIChCaWdJbnQuZ3JlYXRlcihvdXJIYXNoLCB0aGVpckhhc2gpKSB7CiAgICAgICAgICAgICAgdHlwZSA9ICdceDAyJwogICAgICAgICAgICAgIHNlbmQgPSB0aGlzLmRoY29tbWl0CiAgICAgICAgICAgICAgYnJlYWsgIC8vIGlnbm9yZQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIC8vIGZvcmdldAogICAgICAgICAgICAgIHRoaXMub3VyX2RoID0gdGhpcy5vdHIuZGgoKQogICAgICAgICAgICAgIHRoaXMub3RyLmF1dGhzdGF0ZSA9IENPTlNULkFVVEhTVEFURV9OT05FCiAgICAgICAgICAgICAgdGhpcy5yID0gbnVsbAogICAgICAgICAgICAgIHRoaXMubXloYXNoZWQgPSBudWxsCiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSBpZiAoCiAgICAgICAgICAgIHRoaXMub3RyLmF1dGhzdGF0ZSA9PT0gQ09OU1QuQVVUSFNUQVRFX0FXQUlUSU5HX1NJRwogICAgICAgICAgKSB0aGlzLm91cl9kaCA9IHRoaXMub3RyLmRoKCkKCiAgICAgICAgICB0aGlzLm90ci5hdXRoc3RhdGUgPSBDT05TVC5BVVRIU1RBVEVfQVdBSVRJTkdfUkVWRUFMU0lHCgogICAgICAgICAgdGhpcy5lbmNyeXB0ZWQgPSBtc2dbMF0uc3Vic3RyaW5nKDQpCiAgICAgICAgICB0aGlzLmhhc2hlZCA9IG1zZ1sxXS5zdWJzdHJpbmcoNCkKCiAgICAgICAgICB0eXBlID0gJ1x4MGEnCiAgICAgICAgICBzZW5kID0gSExQLnBhY2tNUEkodGhpcy5vdXJfZGgucHVibGljS2V5KQogICAgICAgICAgYnJlYWsKCiAgICAgICAgY2FzZSAnXHgwYSc6CiAgICAgICAgICBITFAuZGVidWcuY2FsbCh0aGlzLm90ciwgJ3JldmVhbCBzaWduYXR1cmUgbWVzc2FnZScpCgogICAgICAgICAgbXNnID0gSExQLnNwbGl0eXBlKFsnTVBJJ10sIG1zZy5tc2cpCgogICAgICAgICAgaWYgKHRoaXMub3RyLmF1dGhzdGF0ZSAhPT0gQ09OU1QuQVVUSFNUQVRFX0FXQUlUSU5HX0RIS0VZKSB7CiAgICAgICAgICAgIGlmICh0aGlzLm90ci5hdXRoc3RhdGUgPT09IENPTlNULkFVVEhTVEFURV9BV0FJVElOR19TSUcpIHsKICAgICAgICAgICAgICBpZiAoIUJpZ0ludC5lcXVhbHModGhpcy50aGVpcl95LCBITFAucmVhZE1QSShtc2dbMF0pKSkgcmV0dXJuCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcmV0dXJuICAvLyBpZ25vcmUKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMub3RyLmF1dGhzdGF0ZSA9IENPTlNULkFVVEhTVEFURV9BV0FJVElOR19TSUcKCiAgICAgICAgICB0aGlzLnRoZWlyX3kgPSBITFAucmVhZE1QSShtc2dbMF0pCgogICAgICAgICAgLy8gdmVyaWZ5IGd5IGlzIGxlZ2FsIDIgPD0gZ3kgPD0gTi0yCiAgICAgICAgICBpZiAoIUhMUC5jaGVja0dyb3VwKHRoaXMudGhlaXJfeSwgTl9NSU5VU18yKSkKICAgICAgICAgICAgcmV0dXJuIHRoaXMub3RyLmVycm9yKCdJbGxlZ2FsIGdeeS4nLCB0cnVlKQoKICAgICAgICAgIHRoaXMuY3JlYXRlS2V5cyh0aGlzLnRoZWlyX3kpCgogICAgICAgICAgdHlwZSA9ICdceDExJwogICAgICAgICAgc2VuZCA9IEhMUC5wYWNrTVBJKHRoaXMucikKICAgICAgICAgIHNlbmQgKz0gdGhpcy5tYWtlTSh0aGlzLnRoZWlyX3ksIHRoaXMubTEsIHRoaXMuYywgdGhpcy5tMikKCiAgICAgICAgICB0aGlzLm0xID0gbnVsbAogICAgICAgICAgdGhpcy5tMiA9IG51bGwKICAgICAgICAgIHRoaXMuYyA9IG51bGwKICAgICAgICAgIGJyZWFrCgogICAgICAgIGNhc2UgJ1x4MTEnOgogICAgICAgICAgSExQLmRlYnVnLmNhbGwodGhpcy5vdHIsICdzaWduYXR1cmUgbWVzc2FnZScpCgogICAgICAgICAgaWYgKHRoaXMub3RyLmF1dGhzdGF0ZSAhPT0gQ09OU1QuQVVUSFNUQVRFX0FXQUlUSU5HX1JFVkVBTFNJRykKICAgICAgICAgICAgcmV0dXJuICAvLyBpZ25vcmUKCiAgICAgICAgICBtc2cgPSBITFAuc3BsaXR5cGUoWydEQVRBJywgJ0RBVEEnLCAnTUFDJ10sIG1zZy5tc2cpCgogICAgICAgICAgdGhpcy5yID0gSExQLnJlYWRNUEkobXNnWzBdKQoKICAgICAgICAgIC8vIGRlY3J5cHQgdGhlaXJfeQogICAgICAgICAgdmFyIGtleSA9IENyeXB0b0pTLmVuYy5IZXgucGFyc2UoQmlnSW50LmJpZ0ludDJzdHIodGhpcy5yLCAxNikpCiAgICAgICAgICBrZXkgPSBDcnlwdG9KUy5lbmMuTGF0aW4xLnN0cmluZ2lmeShrZXkpCgogICAgICAgICAgdmFyIGd4bXBpID0gSExQLmRlY3J5cHRBZXModGhpcy5lbmNyeXB0ZWQsIGtleSwgSExQLnBhY2tDdHIoMCkpCiAgICAgICAgICBneG1waSA9IGd4bXBpLnRvU3RyaW5nKENyeXB0b0pTLmVuYy5MYXRpbjEpCgogICAgICAgICAgdGhpcy50aGVpcl95ID0gSExQLnJlYWRNUEkoZ3htcGkpCgogICAgICAgICAgLy8gdmVyaWZ5IGhhc2gKICAgICAgICAgIHZhciBoYXNoID0gQ3J5cHRvSlMuU0hBMjU2KENyeXB0b0pTLmVuYy5MYXRpbjEucGFyc2UoZ3htcGkpKQoKICAgICAgICAgIGlmICghSExQLmNvbXBhcmUodGhpcy5oYXNoZWQsIGhhc2gudG9TdHJpbmcoQ3J5cHRvSlMuZW5jLkxhdGluMSkpKQogICAgICAgICAgICByZXR1cm4gdGhpcy5vdHIuZXJyb3IoJ0hhc2hlZCBnXnggZG9lcyBub3QgbWF0Y2guJywgdHJ1ZSkKCiAgICAgICAgICAvLyB2ZXJpZnkgZ3ggaXMgbGVnYWwgMiA8PSBnXnggPD0gTi0yCiAgICAgICAgICBpZiAoIUhMUC5jaGVja0dyb3VwKHRoaXMudGhlaXJfeSwgTl9NSU5VU18yKSkKICAgICAgICAgICAgcmV0dXJuIHRoaXMub3RyLmVycm9yKCdJbGxlZ2FsIGdeeC4nLCB0cnVlKQoKICAgICAgICAgIHRoaXMuY3JlYXRlS2V5cyh0aGlzLnRoZWlyX3kpCgogICAgICAgICAgdnNtID0gdGhpcy52ZXJpZnlTaWduTWFjKAogICAgICAgICAgICAgIG1zZ1syXQogICAgICAgICAgICAsIG1zZ1sxXQogICAgICAgICAgICAsIHRoaXMubTIKICAgICAgICAgICAgLCB0aGlzLmMKICAgICAgICAgICAgLCB0aGlzLnRoZWlyX3kKICAgICAgICAgICAgLCB0aGlzLm91cl9kaC5wdWJsaWNLZXkKICAgICAgICAgICAgLCB0aGlzLm0xCiAgICAgICAgICAgICwgSExQLnBhY2tDdHIoMCkKICAgICAgICAgICkKICAgICAgICAgIGlmICh2c21bMF0pIHJldHVybiB0aGlzLm90ci5lcnJvcih2c21bMF0sIHRydWUpCgogICAgICAgICAgLy8gc3RvcmUgdGhlaXIga2V5CiAgICAgICAgICB0aGlzLnRoZWlyX2tleWlkID0gdnNtWzFdCiAgICAgICAgICB0aGlzLnRoZWlyX3ByaXZfcGsgPSB2c21bMl0KCiAgICAgICAgICBzZW5kID0gdGhpcy5tYWtlTSgKICAgICAgICAgICAgICB0aGlzLnRoZWlyX3kKICAgICAgICAgICAgLCB0aGlzLm0xX3ByaW1lCiAgICAgICAgICAgICwgdGhpcy5jX3ByaW1lCiAgICAgICAgICAgICwgdGhpcy5tMl9wcmltZQogICAgICAgICAgKQoKICAgICAgICAgIHRoaXMubTEgPSBudWxsCiAgICAgICAgICB0aGlzLm0yID0gbnVsbAogICAgICAgICAgdGhpcy5tMV9wcmltZSA9IG51bGwKICAgICAgICAgIHRoaXMubTJfcHJpbWUgPSBudWxsCiAgICAgICAgICB0aGlzLmMgPSBudWxsCiAgICAgICAgICB0aGlzLmNfcHJpbWUgPSBudWxsCgogICAgICAgICAgdGhpcy5zZW5kTXNnKHZlcnNpb24sICdceDEyJywgc2VuZCkKICAgICAgICAgIHRoaXMuYWtlU3VjY2Vzcyh2ZXJzaW9uKQogICAgICAgICAgcmV0dXJuCgogICAgICAgIGNhc2UgJ1x4MTInOgogICAgICAgICAgSExQLmRlYnVnLmNhbGwodGhpcy5vdHIsICdkYXRhIG1lc3NhZ2UnKQoKICAgICAgICAgIGlmICh0aGlzLm90ci5hdXRoc3RhdGUgIT09IENPTlNULkFVVEhTVEFURV9BV0FJVElOR19TSUcpCiAgICAgICAgICAgIHJldHVybiAgLy8gaWdub3JlCgogICAgICAgICAgbXNnID0gSExQLnNwbGl0eXBlKFsnREFUQScsICdNQUMnXSwgbXNnLm1zZykKCiAgICAgICAgICB2c20gPSB0aGlzLnZlcmlmeVNpZ25NYWMoCiAgICAgICAgICAgICAgbXNnWzFdCiAgICAgICAgICAgICwgbXNnWzBdCiAgICAgICAgICAgICwgdGhpcy5tMl9wcmltZQogICAgICAgICAgICAsIHRoaXMuY19wcmltZQogICAgICAgICAgICAsIHRoaXMudGhlaXJfeQogICAgICAgICAgICAsIHRoaXMub3VyX2RoLnB1YmxpY0tleQogICAgICAgICAgICAsIHRoaXMubTFfcHJpbWUKICAgICAgICAgICAgLCBITFAucGFja0N0cigwKQogICAgICAgICAgKQogICAgICAgICAgaWYgKHZzbVswXSkgcmV0dXJuIHRoaXMub3RyLmVycm9yKHZzbVswXSwgdHJ1ZSkKCiAgICAgICAgICAvLyBzdG9yZSB0aGVpciBrZXkKICAgICAgICAgIHRoaXMudGhlaXJfa2V5aWQgPSB2c21bMV0KICAgICAgICAgIHRoaXMudGhlaXJfcHJpdl9wayA9IHZzbVsyXQoKICAgICAgICAgIHRoaXMubTFfcHJpbWUgPSBudWxsCiAgICAgICAgICB0aGlzLm0yX3ByaW1lID0gbnVsbAogICAgICAgICAgdGhpcy5jX3ByaW1lID0gbnVsbAoKICAgICAgICAgIHRoaXMudHJhbnNtaXR0ZWRSUyA9IHRydWUKICAgICAgICAgIHRoaXMuYWtlU3VjY2Vzcyh2ZXJzaW9uKQogICAgICAgICAgcmV0dXJuCgogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICByZXR1cm4gIC8vIGlnbm9yZQoKICAgICAgfQoKICAgICAgdGhpcy5zZW5kTXNnKHZlcnNpb24sIHR5cGUsIHNlbmQpCiAgICB9LAoKICAgIHNlbmRNc2c6IGZ1bmN0aW9uICh2ZXJzaW9uLCB0eXBlLCBtc2cpIHsKICAgICAgdmFyIHNlbmQgPSB2ZXJzaW9uICsgdHlwZQogICAgICB2YXIgdjMgPSAodmVyc2lvbiA9PT0gQ09OU1QuT1RSX1ZFUlNJT05fMykKCiAgICAgIC8vIGluc3RhbmNlIHRhZ3MgZm9yIHYzCiAgICAgIGlmICh2MykgewogICAgICAgIEhMUC5kZWJ1Zy5jYWxsKHRoaXMub3RyLCAnaW5zdGFuY2UgdGFncycpCiAgICAgICAgc2VuZCArPSB0aGlzLm90ci5vdXJfaW5zdGFuY2VfdGFnCiAgICAgICAgc2VuZCArPSB0aGlzLm90ci50aGVpcl9pbnN0YW5jZV90YWcKICAgICAgfQoKICAgICAgc2VuZCArPSBtc2cKCiAgICAgIC8vIGZyYWdtZW50IG1lc3NhZ2UgaWYgbmVjZXNzYXJ5CiAgICAgIHNlbmQgPSBITFAud3JhcE1zZygKICAgICAgICAgIHNlbmQKICAgICAgICAsIHRoaXMub3RyLmZyYWdtZW50X3NpemUKICAgICAgICAsIHYzCiAgICAgICAgLCB0aGlzLm90ci5vdXJfaW5zdGFuY2VfdGFnCiAgICAgICAgLCB0aGlzLm90ci50aGVpcl9pbnN0YW5jZV90YWcKICAgICAgKQogICAgICBpZiAoc2VuZFswXSkgcmV0dXJuIHRoaXMub3RyLmVycm9yKHNlbmRbMF0pCgogICAgICB0aGlzLm90ci5pbyhzZW5kWzFdKQogICAgfSwKCiAgICBpbml0aWF0ZUFLRTogZnVuY3Rpb24gKHZlcnNpb24pIHsKICAgICAgSExQLmRlYnVnLmNhbGwodGhpcy5vdHIsICdkLWggY29tbWl0IG1lc3NhZ2UnKQoKICAgICAgdGhpcy5vdHIudHJpZ2dlcignc3RhdHVzJywgW0NPTlNULlNUQVRVU19BS0VfSU5JVF0pCgogICAgICB0aGlzLm90ci5hdXRoc3RhdGUgPSBDT05TVC5BVVRIU1RBVEVfQVdBSVRJTkdfREhLRVkKCiAgICAgIHZhciBneG1waSA9IEhMUC5wYWNrTVBJKHRoaXMub3VyX2RoLnB1YmxpY0tleSkKICAgICAgZ3htcGkgPSBDcnlwdG9KUy5lbmMuTGF0aW4xLnBhcnNlKGd4bXBpKQoKICAgICAgdGhpcy5yID0gQmlnSW50LnJhbmRCaWdJbnQoMTI4KQogICAgICB2YXIga2V5ID0gQ3J5cHRvSlMuZW5jLkhleC5wYXJzZShCaWdJbnQuYmlnSW50MnN0cih0aGlzLnIsIDE2KSkKICAgICAga2V5ID0gQ3J5cHRvSlMuZW5jLkxhdGluMS5zdHJpbmdpZnkoa2V5KQoKICAgICAgdGhpcy5teWhhc2hlZCA9IENyeXB0b0pTLlNIQTI1NihneG1waSkKICAgICAgdGhpcy5teWhhc2hlZCA9IEhMUC5wYWNrRGF0YSh0aGlzLm15aGFzaGVkLnRvU3RyaW5nKENyeXB0b0pTLmVuYy5MYXRpbjEpKQoKICAgICAgdGhpcy5kaGNvbW1pdCA9IEhMUC5wYWNrRGF0YShITFAuZW5jcnlwdEFlcyhneG1waSwga2V5LCBITFAucGFja0N0cigwKSkpCiAgICAgIHRoaXMuZGhjb21taXQgKz0gdGhpcy5teWhhc2hlZAoKICAgICAgdGhpcy5zZW5kTXNnKHZlcnNpb24sICdceDAyJywgdGhpcy5kaGNvbW1pdCkKICAgIH0KCiAgfQoKfSkuY2FsbCh0aGlzKQo7KGZ1bmN0aW9uICgpIHsKICAKCiAgdmFyIHJvb3QgPSB0aGlzCgogIHZhciBDcnlwdG9KUywgQmlnSW50LCAgRXZlbnRFbWl0dGVyLCBDT05TVCwgSExQCiAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnICYmIG1vZHVsZS5leHBvcnRzKSB7CiAgICBtb2R1bGUuZXhwb3J0cyA9IFNNCiAgICBDcnlwdG9KUyA9IHJlcXVpcmUoJy4uL3ZlbmRvci9jcnlwdG8uanMnKQogICAgQmlnSW50ID0gcmVxdWlyZSgnLi4vdmVuZG9yL2JpZ2ludC5qcycpCiAgICBFdmVudEVtaXR0ZXIgPSByZXF1aXJlKCcuLi92ZW5kb3IvZXZlbnRlbWl0dGVyLmpzJykKICAgIENPTlNUID0gcmVxdWlyZSgnLi9jb25zdC5qcycpCiAgICBITFAgPSByZXF1aXJlKCcuL2hlbHBlcnMuanMnKQogIH0gZWxzZSB7CiAgICByb290Lk9UUi5TTSA9IFNNCiAgICBDcnlwdG9KUyA9IHJvb3QuQ3J5cHRvSlMKICAgIEJpZ0ludCA9IHJvb3QuQmlnSW50CiAgICBFdmVudEVtaXR0ZXIgPSByb290LkV2ZW50RW1pdHRlcgogICAgQ09OU1QgPSByb290Lk9UUi5DT05TVAogICAgSExQID0gcm9vdC5PVFIuSExQCiAgfQoKICAvLyBkaWZmaWUtaGVsbG1hbiBtb2R1bHVzIGFuZCBnZW5lcmF0b3IKICAvLyBzZWUgZ3JvdXAgNSwgUkZDIDM1MjYKICB2YXIgRyA9IEJpZ0ludC5zdHIyYmlnSW50KENPTlNULkcsIDEwKQogIHZhciBOID0gQmlnSW50LnN0cjJiaWdJbnQoQ09OU1QuTiwgMTYpCiAgdmFyIE5fTUlOVVNfMiA9IEJpZ0ludC5zdWIoTiwgQmlnSW50LnN0cjJiaWdJbnQoJzInLCAxMCkpCgogIC8vIHRvIGNhbGN1bGF0ZSBEJ3MgZm9yIHplcm8ta25vd2xlZGdlIHByb29mcwogIHZhciBRID0gQmlnSW50LnN1YihOLCBCaWdJbnQuc3RyMmJpZ0ludCgnMScsIDEwKSkKICBCaWdJbnQuZGl2SW50XyhRLCAyKSAgLy8gbWVoCgogIGZ1bmN0aW9uIFNNKHJlcXMpIHsKICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBTTSkpIHJldHVybiBuZXcgU00ocmVxcykKCiAgICB0aGlzLnZlcnNpb24gPSAxCgogICAgdGhpcy5vdXJfZnAgPSByZXFzLm91cl9mcAogICAgdGhpcy50aGVpcl9mcCA9IHJlcXMudGhlaXJfZnAKICAgIHRoaXMuc3NpZCA9IHJlcXMuc3NpZAoKICAgIHRoaXMuZGVidWcgPSAhIXJlcXMuZGVidWcKCiAgICAvLyBpbml0aWFsIHN0YXRlCiAgICB0aGlzLmluaXQoKQogIH0KCiAgLy8gaW5oZXJpdCBmcm9tIEVFCiAgSExQLmV4dGVuZChTTSwgRXZlbnRFbWl0dGVyKQoKICAvLyBzZXQgdGhlIGluaXRpYWwgdmFsdWVzCiAgLy8gYWxzbyB1c2VkIHdoZW4gYWJvcnRpbmcKICBTTS5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMuc21wc3RhdGUgPSBDT05TVC5TTVBTVEFURV9FWFBFQ1QxCiAgICB0aGlzLnNlY3JldCA9IG51bGwKICB9CgogIFNNLnByb3RvdHlwZS5tYWtlU2VjcmV0ID0gZnVuY3Rpb24gKG91ciwgc2VjcmV0KSB7CiAgICB2YXIgc2hhMjU2ID0gQ3J5cHRvSlMuYWxnby5TSEEyNTYuY3JlYXRlKCkKICAgIHNoYTI1Ni51cGRhdGUoQ3J5cHRvSlMuZW5jLkxhdGluMS5wYXJzZShITFAucGFja0J5dGVzKHRoaXMudmVyc2lvbiwgMSkpKQogICAgc2hhMjU2LnVwZGF0ZShDcnlwdG9KUy5lbmMuSGV4LnBhcnNlKG91ciA/IHRoaXMub3VyX2ZwIDogdGhpcy50aGVpcl9mcCkpCiAgICBzaGEyNTYudXBkYXRlKENyeXB0b0pTLmVuYy5IZXgucGFyc2Uob3VyID8gdGhpcy50aGVpcl9mcCA6IHRoaXMub3VyX2ZwKSkKICAgIHNoYTI1Ni51cGRhdGUoQ3J5cHRvSlMuZW5jLkxhdGluMS5wYXJzZSh0aGlzLnNzaWQpKQogICAgc2hhMjU2LnVwZGF0ZShDcnlwdG9KUy5lbmMuTGF0aW4xLnBhcnNlKHNlY3JldCkpCiAgICB2YXIgaGFzaCA9IHNoYTI1Ni5maW5hbGl6ZSgpCiAgICB0aGlzLnNlY3JldCA9IEhMUC5iaXRzMmJpZ0ludChoYXNoLnRvU3RyaW5nKENyeXB0b0pTLmVuYy5MYXRpbjEpKQogIH0KCiAgU00ucHJvdG90eXBlLm1ha2VHMnMgPSBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLmEyID0gSExQLnJhbmRvbUV4cG9uZW50KCkKICAgIHRoaXMuYTMgPSBITFAucmFuZG9tRXhwb25lbnQoKQogICAgdGhpcy5nMmEgPSBCaWdJbnQucG93TW9kKEcsIHRoaXMuYTIsIE4pCiAgICB0aGlzLmczYSA9IEJpZ0ludC5wb3dNb2QoRywgdGhpcy5hMywgTikKICAgIGlmICggIUhMUC5jaGVja0dyb3VwKHRoaXMuZzJhLCBOX01JTlVTXzIpIHx8CiAgICAgICAgICFITFAuY2hlY2tHcm91cCh0aGlzLmczYSwgTl9NSU5VU18yKQogICAgKSB0aGlzLm1ha2VHMnMoKQogIH0KCiAgU00ucHJvdG90eXBlLmNvbXB1dGVHcyA9IGZ1bmN0aW9uIChnMmEsIGczYSkgewogICAgdGhpcy5nMiA9IEJpZ0ludC5wb3dNb2QoZzJhLCB0aGlzLmEyLCBOKQogICAgdGhpcy5nMyA9IEJpZ0ludC5wb3dNb2QoZzNhLCB0aGlzLmEzLCBOKQogIH0KCiAgU00ucHJvdG90eXBlLmNvbXB1dGVQUSA9IGZ1bmN0aW9uIChyKSB7CiAgICB0aGlzLnAgPSBCaWdJbnQucG93TW9kKHRoaXMuZzMsIHIsIE4pCiAgICB0aGlzLnEgPSBITFAubXVsdFBvd01vZChHLCByLCB0aGlzLmcyLCB0aGlzLnNlY3JldCwgTikKICB9CgogIFNNLnByb3RvdHlwZS5jb21wdXRlUiA9IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMuciA9IEJpZ0ludC5wb3dNb2QodGhpcy5Rb1EsIHRoaXMuYTMsIE4pCiAgfQoKICBTTS5wcm90b3R5cGUuY29tcHV0ZVJhYiA9IGZ1bmN0aW9uIChyKSB7CiAgICByZXR1cm4gQmlnSW50LnBvd01vZChyLCB0aGlzLmEzLCBOKQogIH0KCiAgU00ucHJvdG90eXBlLmNvbXB1dGVDID0gZnVuY3Rpb24gKHYsIHIpIHsKICAgIHJldHVybiBITFAuc21wSGFzaCh2LCBCaWdJbnQucG93TW9kKEcsIHIsIE4pKQogIH0KCiAgU00ucHJvdG90eXBlLmNvbXB1dGVEID0gZnVuY3Rpb24gKHIsIGEsIGMpIHsKICAgIHJldHVybiBCaWdJbnQuc3ViTW9kKHIsIEJpZ0ludC5tdWx0TW9kKGEsIGMsIFEpLCBRKQogIH0KCiAgLy8gdGhlIGJ1bGsgb2YgdGhlIHdvcmsKICBTTS5wcm90b3R5cGUuaGFuZGxlU00gPSBmdW5jdGlvbiAobXNnKSB7CiAgICB2YXIgc2VuZCwgcjIsIHIzLCByNywgdDEsIHQyLCB0MywgdDQsIHJhYiwgdG1wMiwgY1IsIGQ3LCBtcywgdHJ1c3QKCiAgICB2YXIgZXhwZWN0U3RhdGVzID0gewogICAgICAgIDI6IENPTlNULlNNUFNUQVRFX0VYUEVDVDEKICAgICAgLCAzOiBDT05TVC5TTVBTVEFURV9FWFBFQ1QyCiAgICAgICwgNDogQ09OU1QuU01QU1RBVEVfRVhQRUNUMwogICAgICAsIDU6IENPTlNULlNNUFNUQVRFX0VYUEVDVDQKICAgICAgLCA3OiBDT05TVC5TTVBTVEFURV9FWFBFQ1QxCiAgICB9CgogICAgaWYgKG1zZy50eXBlID09PSA2KSB7CiAgICAgIHRoaXMuaW5pdCgpCiAgICAgIHRoaXMudHJpZ2dlcignYWJvcnQnKQogICAgICByZXR1cm4KICAgIH0KCiAgICAvLyBhYm9ydCEgdGhlcmUgd2FzIGFuIGVycm9yCiAgICBpZiAodGhpcy5zbXBzdGF0ZSAhPT0gZXhwZWN0U3RhdGVzW21zZy50eXBlXSkKICAgICAgcmV0dXJuIHRoaXMuYWJvcnQoKQoKICAgIHN3aXRjaCAodGhpcy5zbXBzdGF0ZSkgewoKICAgICAgY2FzZSBDT05TVC5TTVBTVEFURV9FWFBFQ1QxOgogICAgICAgIEhMUC5kZWJ1Zy5jYWxsKHRoaXMsICdzbXAgdGx2IDInKQoKICAgICAgICAvLyB1c2VyIHNwZWNpZmllZCBxdWVzdGlvbgogICAgICAgIHZhciBpbmQsIHF1ZXN0aW9uCiAgICAgICAgaWYgKG1zZy50eXBlID09PSA3KSB7CiAgICAgICAgICBpbmQgPSBtc2cubXNnLmluZGV4T2YoJ1x4MDAnKQogICAgICAgICAgcXVlc3Rpb24gPSBtc2cubXNnLnN1YnN0cmluZygwLCBpbmQpCiAgICAgICAgICBtc2cubXNnID0gbXNnLm1zZy5zdWJzdHJpbmcoaW5kICsgMSkKICAgICAgICB9CgogICAgICAgIC8vIDA6ZzJhLCAxOmMyLCAyOmQyLCAzOmczYSwgNDpjMywgNTpkMwogICAgICAgIG1zID0gSExQLnJlYWRMZW4obXNnLm1zZy5zdWJzdHIoMCwgNCkpCiAgICAgICAgaWYgKG1zICE9PSA2KSByZXR1cm4gdGhpcy5hYm9ydCgpCiAgICAgICAgbXNnID0gSExQLnVucGFja01QSXMoNiwgbXNnLm1zZy5zdWJzdHJpbmcoNCkpCgogICAgICAgIGlmICggIUhMUC5jaGVja0dyb3VwKG1zZ1swXSwgTl9NSU5VU18yKSB8fAogICAgICAgICAgICAgIUhMUC5jaGVja0dyb3VwKG1zZ1szXSwgTl9NSU5VU18yKQogICAgICAgICkgcmV0dXJuIHRoaXMuYWJvcnQoKQoKICAgICAgICAvLyB2ZXJpZnkgem5wJ3MKICAgICAgICBpZiAoIUhMUC5aS1AoMSwgbXNnWzFdLCBITFAubXVsdFBvd01vZChHLCBtc2dbMl0sIG1zZ1swXSwgbXNnWzFdLCBOKSkpCiAgICAgICAgICByZXR1cm4gdGhpcy5hYm9ydCgpCgogICAgICAgIGlmICghSExQLlpLUCgyLCBtc2dbNF0sIEhMUC5tdWx0UG93TW9kKEcsIG1zZ1s1XSwgbXNnWzNdLCBtc2dbNF0sIE4pKSkKICAgICAgICAgIHJldHVybiB0aGlzLmFib3J0KCkKCiAgICAgICAgdGhpcy5nM2FvID0gbXNnWzNdICAvLyBzYXZlIGZvciBsYXRlcgoKICAgICAgICB0aGlzLm1ha2VHMnMoKQoKICAgICAgICAvLyB6ZXJvLWtub3dsZWRnZSBwcm9vZiB0aGF0IHRoZSBleHBvbmVudHMKICAgICAgICAvLyBhc3NvY2lhdGVkIHdpdGggZzJhICYgZzNhIGFyZSBrbm93bgogICAgICAgIHIyID0gSExQLnJhbmRvbUV4cG9uZW50KCkKICAgICAgICByMyA9IEhMUC5yYW5kb21FeHBvbmVudCgpCiAgICAgICAgdGhpcy5jMiA9IHRoaXMuY29tcHV0ZUMoMywgcjIpCiAgICAgICAgdGhpcy5jMyA9IHRoaXMuY29tcHV0ZUMoNCwgcjMpCiAgICAgICAgdGhpcy5kMiA9IHRoaXMuY29tcHV0ZUQocjIsIHRoaXMuYTIsIHRoaXMuYzIpCiAgICAgICAgdGhpcy5kMyA9IHRoaXMuY29tcHV0ZUQocjMsIHRoaXMuYTMsIHRoaXMuYzMpCgogICAgICAgIHRoaXMuY29tcHV0ZUdzKG1zZ1swXSwgbXNnWzNdKQoKICAgICAgICB0aGlzLnNtcHN0YXRlID0gQ09OU1QuU01QU1RBVEVfRVhQRUNUMAoKICAgICAgICAvLyBhc3N1bWUgdXRmOCBxdWVzdGlvbgogICAgICAgIHF1ZXN0aW9uID0gQ3J5cHRvSlMuZW5jLkxhdGluMQogICAgICAgICAgLnBhcnNlKHF1ZXN0aW9uKQogICAgICAgICAgLnRvU3RyaW5nKENyeXB0b0pTLmVuYy5VdGY4KQoKICAgICAgICAvLyBpbnZva2UgcXVlc3Rpb24KICAgICAgICB0aGlzLnRyaWdnZXIoJ3F1ZXN0aW9uJywgW3F1ZXN0aW9uXSkKICAgICAgICByZXR1cm4KCiAgICAgIGNhc2UgQ09OU1QuU01QU1RBVEVfRVhQRUNUMjoKICAgICAgICBITFAuZGVidWcuY2FsbCh0aGlzLCAnc21wIHRsdiAzJykKCiAgICAgICAgLy8gMDpnMmEsIDE6YzIsIDI6ZDIsIDM6ZzNhLCA0OmMzLCA1OmQzLCA2OnAsIDc6cSwgODpjUCwgOTpkNSwgMTA6ZDYKICAgICAgICBtcyA9IEhMUC5yZWFkTGVuKG1zZy5tc2cuc3Vic3RyKDAsIDQpKQogICAgICAgIGlmIChtcyAhPT0gMTEpIHJldHVybiB0aGlzLmFib3J0KCkKICAgICAgICBtc2cgPSBITFAudW5wYWNrTVBJcygxMSwgbXNnLm1zZy5zdWJzdHJpbmcoNCkpCgogICAgICAgIGlmICggIUhMUC5jaGVja0dyb3VwKG1zZ1swXSwgTl9NSU5VU18yKSB8fAogICAgICAgICAgICAgIUhMUC5jaGVja0dyb3VwKG1zZ1szXSwgTl9NSU5VU18yKSB8fAogICAgICAgICAgICAgIUhMUC5jaGVja0dyb3VwKG1zZ1s2XSwgTl9NSU5VU18yKSB8fAogICAgICAgICAgICAgIUhMUC5jaGVja0dyb3VwKG1zZ1s3XSwgTl9NSU5VU18yKQogICAgICAgICkgcmV0dXJuIHRoaXMuYWJvcnQoKQoKICAgICAgICAvLyB2ZXJpZnkgem5wIG9mIGMzIC8gYzMKICAgICAgICBpZiAoIUhMUC5aS1AoMywgbXNnWzFdLCBITFAubXVsdFBvd01vZChHLCBtc2dbMl0sIG1zZ1swXSwgbXNnWzFdLCBOKSkpCiAgICAgICAgICByZXR1cm4gdGhpcy5hYm9ydCgpCgogICAgICAgIGlmICghSExQLlpLUCg0LCBtc2dbNF0sIEhMUC5tdWx0UG93TW9kKEcsIG1zZ1s1XSwgbXNnWzNdLCBtc2dbNF0sIE4pKSkKICAgICAgICAgIHJldHVybiB0aGlzLmFib3J0KCkKCiAgICAgICAgdGhpcy5nM2FvID0gbXNnWzNdICAvLyBzYXZlIGZvciBsYXRlcgoKICAgICAgICB0aGlzLmNvbXB1dGVHcyhtc2dbMF0sIG1zZ1szXSkKCiAgICAgICAgLy8gdmVyaWZ5IHpucCBvZiBjUAogICAgICAgIHQxID0gSExQLm11bHRQb3dNb2QodGhpcy5nMywgbXNnWzldLCBtc2dbNl0sIG1zZ1s4XSwgTikKICAgICAgICB0MiA9IEhMUC5tdWx0UG93TW9kKEcsIG1zZ1s5XSwgdGhpcy5nMiwgbXNnWzEwXSwgTikKICAgICAgICB0MiA9IEJpZ0ludC5tdWx0TW9kKHQyLCBCaWdJbnQucG93TW9kKG1zZ1s3XSwgbXNnWzhdLCBOKSwgTikKCiAgICAgICAgaWYgKCFITFAuWktQKDUsIG1zZ1s4XSwgdDEsIHQyKSkKICAgICAgICAgIHJldHVybiB0aGlzLmFib3J0KCkKCiAgICAgICAgdmFyIHI0ID0gSExQLnJhbmRvbUV4cG9uZW50KCkKICAgICAgICB0aGlzLmNvbXB1dGVQUShyNCkKCiAgICAgICAgLy8gemVyby1rbm93bGVkZ2UgcHJvb2YgdGhhdCBQICYgUQogICAgICAgIC8vIHdlcmUgZ2VuZXJhdGVkIGFjY29yZGluZyB0byB0aGUgcHJvdG9jb2wKICAgICAgICB2YXIgcjUgPSBITFAucmFuZG9tRXhwb25lbnQoKQogICAgICAgIHZhciByNiA9IEhMUC5yYW5kb21FeHBvbmVudCgpCiAgICAgICAgdmFyIHRtcCA9IEhMUC5tdWx0UG93TW9kKEcsIHI1LCB0aGlzLmcyLCByNiwgTikKICAgICAgICB2YXIgY1AgPSBITFAuc21wSGFzaCg2LCBCaWdJbnQucG93TW9kKHRoaXMuZzMsIHI1LCBOKSwgdG1wKQogICAgICAgIHZhciBkNSA9IHRoaXMuY29tcHV0ZUQocjUsIHI0LCBjUCkKICAgICAgICB2YXIgZDYgPSB0aGlzLmNvbXB1dGVEKHI2LCB0aGlzLnNlY3JldCwgY1ApCgogICAgICAgIC8vIHN0b3JlIHRoZXNlCiAgICAgICAgdGhpcy5Rb1EgPSBCaWdJbnQuZGl2TW9kKHRoaXMucSwgbXNnWzddLCBOKQogICAgICAgIHRoaXMuUG9QID0gQmlnSW50LmRpdk1vZCh0aGlzLnAsIG1zZ1s2XSwgTikKCiAgICAgICAgdGhpcy5jb21wdXRlUigpCgogICAgICAgIC8vIHplcm8ta25vd2xlZGdlIHByb29mIHRoYXQgUgogICAgICAgIC8vIHdhcyBnZW5lcmF0ZWQgYWNjb3JkaW5nIHRvIHRoZSBwcm90b2NvbAogICAgICAgIHI3ID0gSExQLnJhbmRvbUV4cG9uZW50KCkKICAgICAgICB0bXAyID0gQmlnSW50LnBvd01vZCh0aGlzLlFvUSwgcjcsIE4pCiAgICAgICAgY1IgPSBITFAuc21wSGFzaCg3LCBCaWdJbnQucG93TW9kKEcsIHI3LCBOKSwgdG1wMikKICAgICAgICBkNyA9IHRoaXMuY29tcHV0ZUQocjcsIHRoaXMuYTMsIGNSKQoKICAgICAgICB0aGlzLnNtcHN0YXRlID0gQ09OU1QuU01QU1RBVEVfRVhQRUNUNAoKICAgICAgICBzZW5kID0gSExQLnBhY2tJTlQoOCkgKyBITFAucGFja01QSXMoWwogICAgICAgICAgICB0aGlzLnAKICAgICAgICAgICwgdGhpcy5xCiAgICAgICAgICAsIGNQCiAgICAgICAgICAsIGQ1CiAgICAgICAgICAsIGQ2CiAgICAgICAgICAsIHRoaXMucgogICAgICAgICAgLCBjUgogICAgICAgICAgLCBkNwogICAgICAgIF0pCgogICAgICAgIC8vIFRMVgogICAgICAgIHNlbmQgPSBITFAucGFja1RMVig0LCBzZW5kKQogICAgICAgIGJyZWFrCgogICAgICBjYXNlIENPTlNULlNNUFNUQVRFX0VYUEVDVDM6CiAgICAgICAgSExQLmRlYnVnLmNhbGwodGhpcywgJ3NtcCB0bHYgNCcpCgogICAgICAgIC8vIDA6cCwgMTpxLCAyOmNQLCAzOmQ1LCA0OmQ2LCA1OnIsIDY6Y1IsIDc6ZDcKICAgICAgICBtcyA9IEhMUC5yZWFkTGVuKG1zZy5tc2cuc3Vic3RyKDAsIDQpKQogICAgICAgIGlmIChtcyAhPT0gOCkgcmV0dXJuIHRoaXMuYWJvcnQoKQogICAgICAgIG1zZyA9IEhMUC51bnBhY2tNUElzKDgsIG1zZy5tc2cuc3Vic3RyaW5nKDQpKQoKICAgICAgICBpZiAoICFITFAuY2hlY2tHcm91cChtc2dbMF0sIE5fTUlOVVNfMikgfHwKICAgICAgICAgICAgICFITFAuY2hlY2tHcm91cChtc2dbMV0sIE5fTUlOVVNfMikgfHwKICAgICAgICAgICAgICFITFAuY2hlY2tHcm91cChtc2dbNV0sIE5fTUlOVVNfMikKICAgICAgICApIHJldHVybiB0aGlzLmFib3J0KCkKCiAgICAgICAgLy8gdmVyaWZ5IHpucCBvZiBjUAogICAgICAgIHQxID0gSExQLm11bHRQb3dNb2QodGhpcy5nMywgbXNnWzNdLCBtc2dbMF0sIG1zZ1syXSwgTikKICAgICAgICB0MiA9IEhMUC5tdWx0UG93TW9kKEcsIG1zZ1szXSwgdGhpcy5nMiwgbXNnWzRdLCBOKQogICAgICAgIHQyID0gQmlnSW50Lm11bHRNb2QodDIsIEJpZ0ludC5wb3dNb2QobXNnWzFdLCBtc2dbMl0sIE4pLCBOKQoKICAgICAgICBpZiAoIUhMUC5aS1AoNiwgbXNnWzJdLCB0MSwgdDIpKQogICAgICAgICAgcmV0dXJuIHRoaXMuYWJvcnQoKQoKICAgICAgICAvLyB2ZXJpZnkgem5wIG9mIGNSCiAgICAgICAgdDMgPSBITFAubXVsdFBvd01vZChHLCBtc2dbN10sIHRoaXMuZzNhbywgbXNnWzZdLCBOKQogICAgICAgIHRoaXMuUW9RID0gQmlnSW50LmRpdk1vZChtc2dbMV0sIHRoaXMucSwgTikgIC8vIHNhdmUgUSBvdmVyIFEKICAgICAgICB0NCA9IEhMUC5tdWx0UG93TW9kKHRoaXMuUW9RLCBtc2dbN10sIG1zZ1s1XSwgbXNnWzZdLCBOKQoKICAgICAgICBpZiAoIUhMUC5aS1AoNywgbXNnWzZdLCB0MywgdDQpKQogICAgICAgICAgcmV0dXJuIHRoaXMuYWJvcnQoKQoKICAgICAgICB0aGlzLmNvbXB1dGVSKCkKCiAgICAgICAgLy8gemVyby1rbm93bGVkZ2UgcHJvb2YgdGhhdCBSCiAgICAgICAgLy8gd2FzIGdlbmVyYXRlZCBhY2NvcmRpbmcgdG8gdGhlIHByb3RvY29sCiAgICAgICAgcjcgPSBITFAucmFuZG9tRXhwb25lbnQoKQogICAgICAgIHRtcDIgPSBCaWdJbnQucG93TW9kKHRoaXMuUW9RLCByNywgTikKICAgICAgICBjUiA9IEhMUC5zbXBIYXNoKDgsIEJpZ0ludC5wb3dNb2QoRywgcjcsIE4pLCB0bXAyKQogICAgICAgIGQ3ID0gdGhpcy5jb21wdXRlRChyNywgdGhpcy5hMywgY1IpCgogICAgICAgIHNlbmQgPSBITFAucGFja0lOVCgzKSArIEhMUC5wYWNrTVBJcyhbIHRoaXMuciwgY1IsIGQ3IF0pCiAgICAgICAgc2VuZCA9IEhMUC5wYWNrVExWKDUsIHNlbmQpCgogICAgICAgIHJhYiA9IHRoaXMuY29tcHV0ZVJhYihtc2dbNV0pCiAgICAgICAgdHJ1c3QgPSAhIUJpZ0ludC5lcXVhbHMocmFiLCBCaWdJbnQuZGl2TW9kKG1zZ1swXSwgdGhpcy5wLCBOKSkKCiAgICAgICAgdGhpcy50cmlnZ2VyKCd0cnVzdCcsIFt0cnVzdCwgJ2Fuc3dlcmVkJ10pCiAgICAgICAgdGhpcy5pbml0KCkKICAgICAgICBicmVhawoKICAgICAgY2FzZSBDT05TVC5TTVBTVEFURV9FWFBFQ1Q0OgogICAgICAgIEhMUC5kZWJ1Zy5jYWxsKHRoaXMsICdzbXAgdGx2IDUnKQoKICAgICAgICAvLyAwOnIsIDE6Y1IsIDI6ZDcKICAgICAgICBtcyA9IEhMUC5yZWFkTGVuKG1zZy5tc2cuc3Vic3RyKDAsIDQpKQogICAgICAgIGlmIChtcyAhPT0gMykgcmV0dXJuIHRoaXMuYWJvcnQoKQogICAgICAgIG1zZyA9IEhMUC51bnBhY2tNUElzKDMsIG1zZy5tc2cuc3Vic3RyaW5nKDQpKQoKICAgICAgICBpZiAoIUhMUC5jaGVja0dyb3VwKG1zZ1swXSwgTl9NSU5VU18yKSkgcmV0dXJuIHRoaXMuYWJvcnQoKQoKICAgICAgICAvLyB2ZXJpZnkgem5wIG9mIGNSCiAgICAgICAgdDMgPSBITFAubXVsdFBvd01vZChHLCBtc2dbMl0sIHRoaXMuZzNhbywgbXNnWzFdLCBOKQogICAgICAgIHQ0ID0gSExQLm11bHRQb3dNb2QodGhpcy5Rb1EsIG1zZ1syXSwgbXNnWzBdLCBtc2dbMV0sIE4pCiAgICAgICAgaWYgKCFITFAuWktQKDgsIG1zZ1sxXSwgdDMsIHQ0KSkKICAgICAgICAgIHJldHVybiB0aGlzLmFib3J0KCkKCiAgICAgICAgcmFiID0gdGhpcy5jb21wdXRlUmFiKG1zZ1swXSkKICAgICAgICB0cnVzdCA9ICEhQmlnSW50LmVxdWFscyhyYWIsIHRoaXMuUG9QKQoKICAgICAgICB0aGlzLnRyaWdnZXIoJ3RydXN0JywgW3RydXN0LCAnYXNrZWQnXSkKICAgICAgICB0aGlzLmluaXQoKQogICAgICAgIHJldHVybgoKICAgIH0KCiAgICB0aGlzLnNlbmRNc2coc2VuZCkKICB9CgogIC8vIHNlbmQgYSBtZXNzYWdlCiAgU00ucHJvdG90eXBlLnNlbmRNc2cgPSBmdW5jdGlvbiAoc2VuZCkgewogICAgdGhpcy50cmlnZ2VyKCdzZW5kJywgW3RoaXMuc3NpZCwgJ1x4MDAnICsgc2VuZF0pCiAgfQoKICBTTS5wcm90b3R5cGUucmN2U2VjcmV0ID0gZnVuY3Rpb24gKHNlY3JldCwgcXVlc3Rpb24pIHsKICAgIEhMUC5kZWJ1Zy5jYWxsKHRoaXMsICdyZWNlaXZlIHNlY3JldCcpCgogICAgdmFyIGZuLCBvdXIgPSBmYWxzZQogICAgaWYgKHRoaXMuc21wc3RhdGUgPT09IENPTlNULlNNUFNUQVRFX0VYUEVDVDApIHsKICAgICAgZm4gPSB0aGlzLmFuc3dlcgogICAgfSBlbHNlIHsKICAgICAgZm4gPSB0aGlzLmluaXRpYXRlCiAgICAgIG91ciA9IHRydWUKICAgIH0KCiAgICB0aGlzLm1ha2VTZWNyZXQob3VyLCBzZWNyZXQpCiAgICBmbi5jYWxsKHRoaXMsIHF1ZXN0aW9uKQogIH0KCiAgU00ucHJvdG90eXBlLmFuc3dlciA9IGZ1bmN0aW9uICgpIHsKICAgIEhMUC5kZWJ1Zy5jYWxsKHRoaXMsICdzbXAgYW5zd2VyJykKCiAgICB2YXIgcjQgPSBITFAucmFuZG9tRXhwb25lbnQoKQogICAgdGhpcy5jb21wdXRlUFEocjQpCgogICAgLy8gemVyby1rbm93bGVkZ2UgcHJvb2YgdGhhdCBQICYgUQogICAgLy8gd2VyZSBnZW5lcmF0ZWQgYWNjb3JkaW5nIHRvIHRoZSBwcm90b2NvbAogICAgdmFyIHI1ID0gSExQLnJhbmRvbUV4cG9uZW50KCkKICAgIHZhciByNiA9IEhMUC5yYW5kb21FeHBvbmVudCgpCiAgICB2YXIgdG1wID0gSExQLm11bHRQb3dNb2QoRywgcjUsIHRoaXMuZzIsIHI2LCBOKQogICAgdmFyIGNQID0gSExQLnNtcEhhc2goNSwgQmlnSW50LnBvd01vZCh0aGlzLmczLCByNSwgTiksIHRtcCkKICAgIHZhciBkNSA9IHRoaXMuY29tcHV0ZUQocjUsIHI0LCBjUCkKICAgIHZhciBkNiA9IHRoaXMuY29tcHV0ZUQocjYsIHRoaXMuc2VjcmV0LCBjUCkKCiAgICB0aGlzLnNtcHN0YXRlID0gQ09OU1QuU01QU1RBVEVfRVhQRUNUMwoKICAgIHZhciBzZW5kID0gSExQLnBhY2tJTlQoMTEpICsgSExQLnBhY2tNUElzKFsKICAgICAgICB0aGlzLmcyYQogICAgICAsIHRoaXMuYzIKICAgICAgLCB0aGlzLmQyCiAgICAgICwgdGhpcy5nM2EKICAgICAgLCB0aGlzLmMzCiAgICAgICwgdGhpcy5kMwogICAgICAsIHRoaXMucAogICAgICAsIHRoaXMucQogICAgICAsIGNQCiAgICAgICwgZDUKICAgICAgLCBkNgogICAgXSkKCiAgICB0aGlzLnNlbmRNc2coSExQLnBhY2tUTFYoMywgc2VuZCkpCiAgfQoKICBTTS5wcm90b3R5cGUuaW5pdGlhdGUgPSBmdW5jdGlvbiAocXVlc3Rpb24pIHsKICAgIEhMUC5kZWJ1Zy5jYWxsKHRoaXMsICdzbXAgaW5pdGlhdGUnKQoKICAgIGlmICh0aGlzLnNtcHN0YXRlICE9PSBDT05TVC5TTVBTVEFURV9FWFBFQ1QxKQogICAgICB0aGlzLmFib3J0KCkgIC8vIGFib3J0ICsgcmVzdGFydAoKICAgIHRoaXMubWFrZUcycygpCgogICAgLy8gemVyby1rbm93bGVkZ2UgcHJvb2YgdGhhdCB0aGUgZXhwb25lbnRzCiAgICAvLyBhc3NvY2lhdGVkIHdpdGggZzJhICYgZzNhIGFyZSBrbm93bgogICAgdmFyIHIyID0gSExQLnJhbmRvbUV4cG9uZW50KCkKICAgIHZhciByMyA9IEhMUC5yYW5kb21FeHBvbmVudCgpCiAgICB0aGlzLmMyID0gdGhpcy5jb21wdXRlQygxLCByMikKICAgIHRoaXMuYzMgPSB0aGlzLmNvbXB1dGVDKDIsIHIzKQogICAgdGhpcy5kMiA9IHRoaXMuY29tcHV0ZUQocjIsIHRoaXMuYTIsIHRoaXMuYzIpCiAgICB0aGlzLmQzID0gdGhpcy5jb21wdXRlRChyMywgdGhpcy5hMywgdGhpcy5jMykKCiAgICAvLyBzZXQgdGhlIG5leHQgZXhwZWN0ZWQgc3RhdGUKICAgIHRoaXMuc21wc3RhdGUgPSBDT05TVC5TTVBTVEFURV9FWFBFQ1QyCgogICAgdmFyIHNlbmQgPSAnJwogICAgdmFyIHR5cGUgPSAyCgogICAgaWYgKHF1ZXN0aW9uKSB7CiAgICAgIHNlbmQgKz0gcXVlc3Rpb24KICAgICAgc2VuZCArPSAnXHgwMCcKICAgICAgdHlwZSA9IDcKICAgIH0KCiAgICBzZW5kICs9IEhMUC5wYWNrSU5UKDYpICsgSExQLnBhY2tNUElzKFsKICAgICAgICB0aGlzLmcyYQogICAgICAsIHRoaXMuYzIKICAgICAgLCB0aGlzLmQyCiAgICAgICwgdGhpcy5nM2EKICAgICAgLCB0aGlzLmMzCiAgICAgICwgdGhpcy5kMwogICAgXSkKCiAgICB0aGlzLnNlbmRNc2coSExQLnBhY2tUTFYodHlwZSwgc2VuZCkpCiAgfQoKICBTTS5wcm90b3R5cGUuYWJvcnQgPSBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLmluaXQoKQogICAgdGhpcy5zZW5kTXNnKEhMUC5wYWNrVExWKDYsICcnKSkKICAgIHRoaXMudHJpZ2dlcignYWJvcnQnKQogIH0KCn0pLmNhbGwodGhpcykKOyhmdW5jdGlvbiAoKSB7CiAgCgogIHZhciByb290ID0gdGhpcwoKICB2YXIgQ3J5cHRvSlMsIEJpZ0ludCwgRXZlbnRFbWl0dGVyLCBXb3JrZXIsIFNNV1BhdGgKICAgICwgQ09OU1QsIEhMUCwgUGFyc2UsIEFLRSwgU00sIERTQQogIGlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyAmJiBtb2R1bGUuZXhwb3J0cykgewogICAgbW9kdWxlLmV4cG9ydHMgPSBPVFIKICAgIENyeXB0b0pTID0gcmVxdWlyZSgnLi4vdmVuZG9yL2NyeXB0by5qcycpCiAgICBCaWdJbnQgPSByZXF1aXJlKCcuLi92ZW5kb3IvYmlnaW50LmpzJykKICAgIEV2ZW50RW1pdHRlciA9IHJlcXVpcmUoJy4uL3ZlbmRvci9ldmVudGVtaXR0ZXIuanMnKQogICAgU01XUGF0aCA9IHJlcXVpcmUoJ3BhdGgnKS5qb2luKF9fZGlybmFtZSwgJy9zbS13ZWJ3b3JrZXIuanMnKQogICAgQ09OU1QgPSByZXF1aXJlKCcuL2NvbnN0LmpzJykKICAgIEhMUCA9IHJlcXVpcmUoJy4vaGVscGVycy5qcycpCiAgICBQYXJzZSA9IHJlcXVpcmUoJy4vcGFyc2UuanMnKQogICAgQUtFID0gcmVxdWlyZSgnLi9ha2UuanMnKQogICAgU00gPSByZXF1aXJlKCcuL3NtLmpzJykKICAgIERTQSA9IHJlcXVpcmUoJy4vZHNhLmpzJykKICAgIC8vIGV4cG9zZSBDT05TVCBmb3IgY29uc2lzdGVuY3kgd2l0aCBkb2NzCiAgICBPVFIuQ09OU1QgPSBDT05TVAogIH0gZWxzZSB7CiAgICAvLyBjb3B5IG92ZXIgYW5kIGV4cG9zZSBpbnRlcm5hbHMKICAgIE9iamVjdC5rZXlzKHJvb3QuT1RSKS5mb3JFYWNoKGZ1bmN0aW9uIChrKSB7CiAgICAgIE9UUltrXSA9IHJvb3QuT1RSW2tdCiAgICB9KQogICAgcm9vdC5PVFIgPSBPVFIKICAgIENyeXB0b0pTID0gcm9vdC5DcnlwdG9KUwogICAgQmlnSW50ID0gcm9vdC5CaWdJbnQKICAgIEV2ZW50RW1pdHRlciA9IHJvb3QuRXZlbnRFbWl0dGVyCiAgICBXb3JrZXIgPSByb290LldvcmtlcgogICAgU01XUGF0aCA9ICdzbS13ZWJ3b3JrZXIuanMnCiAgICBDT05TVCA9IE9UUi5DT05TVAogICAgSExQID0gT1RSLkhMUAogICAgUGFyc2UgPSBPVFIuUGFyc2UKICAgIEFLRSA9IE9UUi5BS0UKICAgIFNNID0gT1RSLlNNCiAgICBEU0EgPSByb290LkRTQQogIH0KCiAgLy8gZGlmZmllLWhlbGxtYW4gbW9kdWx1cyBhbmQgZ2VuZXJhdG9yCiAgLy8gc2VlIGdyb3VwIDUsIFJGQyAzNTI2CiAgdmFyIEcgPSBCaWdJbnQuc3RyMmJpZ0ludChDT05TVC5HLCAxMCkKICB2YXIgTiA9IEJpZ0ludC5zdHIyYmlnSW50KENPTlNULk4sIDE2KQoKICAvLyBKYXZhU2NyaXB0IGludGVnZXJzCiAgdmFyIE1BWF9JTlQgPSBNYXRoLnBvdygyLCA1MykgLSAxICAvLyBkb3VibGVzCiAgdmFyIE1BWF9VSU5UID0gTWF0aC5wb3coMiwgMzEpIC0gMSAgLy8gYml0d2lzZSBvcGVyYXRvcnMKCiAgLy8gT1RSIGNvbnRydWN0b3IKICBmdW5jdGlvbiBPVFIob3B0aW9ucykgewogICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIE9UUikpIHJldHVybiBuZXcgT1RSKG9wdGlvbnMpCgogICAgLy8gb3B0aW9ucwogICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge30KCiAgICAvLyBwcml2YXRlIGtleXMKICAgIGlmIChvcHRpb25zLnByaXYgJiYgIShvcHRpb25zLnByaXYgaW5zdGFuY2VvZiBEU0EpKQogICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlcXVpcmVzIGxvbmctbGl2ZWQgRFNBIGtleS4nKQoKICAgIHRoaXMucHJpdiA9IG9wdGlvbnMucHJpdiA/IG9wdGlvbnMucHJpdiA6IG5ldyBEU0EoKQoKICAgIHRoaXMuZnJhZ21lbnRfc2l6ZSA9IG9wdGlvbnMuZnJhZ21lbnRfc2l6ZSB8fCAwCiAgICBpZiAodGhpcy5mcmFnbWVudF9zaXplIDwgMCkKICAgICAgdGhyb3cgbmV3IEVycm9yKCdGcmFnbWVudCBzaXplIG11c3QgYmUgYSBwb3NpdGl2ZSBpbnRlZ2VyLicpCgogICAgdGhpcy5zZW5kX2ludGVydmFsID0gb3B0aW9ucy5zZW5kX2ludGVydmFsIHx8IDAKICAgIGlmICh0aGlzLnNlbmRfaW50ZXJ2YWwgPCAwKQogICAgICB0aHJvdyBuZXcgRXJyb3IoJ1NlbmQgaW50ZXJ2YWwgbXVzdCBiZSBhIHBvc2l0aXZlIGludGVnZXIuJykKCiAgICB0aGlzLm91dGdvaW5nID0gW10KCiAgICAvLyBpbnN0YW5jZSB0YWcKICAgIHRoaXMub3VyX2luc3RhbmNlX3RhZyA9IG9wdGlvbnMuaW5zdGFuY2VfdGFnIHx8IE9UUi5tYWtlSW5zdGFuY2VUYWcoKQoKICAgIC8vIGRlYnVnCiAgICB0aGlzLmRlYnVnID0gISFvcHRpb25zLmRlYnVnCgogICAgLy8gc21wIGluIHdlYndvcmtlciBvcHRpb25zCiAgICAvLyB0aGlzIGlzIHN0aWxsIGV4cGVyaW1lbnRhbCBhbmQgdW5kb2N1bWVudGVkCiAgICB0aGlzLnNtdyA9IG9wdGlvbnMuc213CgogICAgLy8gaW5pdCB2YWxzCiAgICB0aGlzLmluaXQoKQoKICAgIC8vIGJpbmQgbWV0aG9kcwogICAgdmFyIHNlbGYgPSB0aGlzCiAgICA7WydzZW5kTXNnJywgJ3JlY2VpdmVNc2cnXS5mb3JFYWNoKGZ1bmN0aW9uIChtZXRoKSB7CiAgICAgIHNlbGZbbWV0aF0gPSBzZWxmW21ldGhdLmJpbmQoc2VsZikKICAgIH0pCgogICAgRXZlbnRFbWl0dGVyLmNhbGwodGhpcykKICB9CgogIC8vIGluaGVyaXQgZnJvbSBFRQogIEhMUC5leHRlbmQoT1RSLCBFdmVudEVtaXR0ZXIpCgogIC8vIGFkZCB0byBwcm90b3R5cGUKICBPVFIucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbiAoKSB7CgogICAgdGhpcy5tc2dzdGF0ZSA9IENPTlNULk1TR1NUQVRFX1BMQUlOVEVYVAogICAgdGhpcy5hdXRoc3RhdGUgPSBDT05TVC5BVVRIU1RBVEVfTk9ORQoKICAgIHRoaXMuQUxMT1dfVjIgPSB0cnVlCiAgICB0aGlzLkFMTE9XX1YzID0gdHJ1ZQoKICAgIHRoaXMuUkVRVUlSRV9FTkNSWVBUSU9OID0gZmFsc2UKICAgIHRoaXMuU0VORF9XSElURVNQQUNFX1RBRyA9IGZhbHNlCiAgICB0aGlzLldISVRFU1BBQ0VfU1RBUlRfQUtFID0gZmFsc2UKICAgIHRoaXMuRVJST1JfU1RBUlRfQUtFID0gZmFsc2UKCiAgICBQYXJzZS5pbml0RnJhZ21lbnQodGhpcykKCiAgICAvLyB0aGVpciBrZXlzCiAgICB0aGlzLnRoZWlyX3kgPSBudWxsCiAgICB0aGlzLnRoZWlyX29sZF95ID0gbnVsbAogICAgdGhpcy50aGVpcl9rZXlpZCA9IDAKICAgIHRoaXMudGhlaXJfcHJpdl9wayA9IG51bGwKICAgIHRoaXMudGhlaXJfaW5zdGFuY2VfdGFnID0gJ1x4MDBceDAwXHgwMFx4MDAnCgogICAgLy8gb3VyIGtleXMKICAgIHRoaXMub3VyX2RoID0gdGhpcy5kaCgpCiAgICB0aGlzLm91cl9vbGRfZGggPSB0aGlzLmRoKCkKICAgIHRoaXMub3VyX2tleWlkID0gMgoKICAgIC8vIHNlc3Npb24ga2V5cwogICAgdGhpcy5zZXNzS2V5cyA9IFsgbmV3IEFycmF5KDIpLCBuZXcgQXJyYXkoMikgXQoKICAgIC8vIHNhdmVkCiAgICB0aGlzLnN0b3JlZE1ncyA9IFtdCiAgICB0aGlzLm9sZE1hY0tleXMgPSBbXQoKICAgIC8vIHNtcAogICAgdGhpcy5zbSA9IG51bGwgIC8vIGluaXRpYWxpemVkIGFmdGVyIEFLRQoKICAgIC8vIHdoZW4gYWtlIGlzIGNvbXBsZXRlCiAgICAvLyBzYXZlIHRoZWlyIGtleXMgYW5kIHRoZSBzZXNzaW9uCiAgICB0aGlzLl9ha2VJbml0KCkKCiAgICAvLyByZWNlaXZlIHBsYWludGV4dCBtZXNzYWdlIHNpbmNlIHN3aXRjaGluZyB0byBwbGFpbnRleHQKICAgIC8vIHVzZWQgdG8gZGVjaWRlIHdoZW4gdG8gc3RvcCBzZW5kaW5nIHB0IHRhZ3Mgd2hlbiBTRU5EX1dISVRFU1BBQ0VfVEFHCiAgICB0aGlzLnJlY2VpdmVkUGxhaW50ZXh0ID0gZmFsc2UKCiAgfQoKICBPVFIucHJvdG90eXBlLl9ha2VJbml0ID0gZnVuY3Rpb24gKCkgewogICAgdGhpcy5ha2UgPSBuZXcgQUtFKHRoaXMpCiAgICB0aGlzLnRyYW5zbWl0dGVkUlMgPSBmYWxzZQogICAgdGhpcy5zc2lkID0gbnVsbAogIH0KCiAgLy8gc21wIG92ZXIgd2Vid29ya2VyCiAgT1RSLnByb3RvdHlwZS5fU01XID0gZnVuY3Rpb24gKG90ciwgcmVxcykgewogICAgdGhpcy5vdHIgPSBvdHIKICAgIHZhciBvcHRzID0gewogICAgICAgIHBhdGg6IFNNV1BhdGgKICAgICAgLCBzZWVkOiBCaWdJbnQuZ2V0U2VlZAogICAgfQogICAgaWYgKHR5cGVvZiBvdHIuc213ID09PSAnb2JqZWN0JykKICAgICAgT2JqZWN0LmtleXMob3RyLnNtdykuZm9yRWFjaChmdW5jdGlvbiAoaykgewogICAgICAgIG9wdHNba10gPSBvdHIuc213W2tdCiAgICAgIH0pCgogICAgLy8gbG9hZCBvcHRpb25hbCBkZXAuIGluIG5vZGUKICAgIGlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyAmJiBtb2R1bGUuZXhwb3J0cykKICAgICAgV29ya2VyID0gcmVxdWlyZSgnd2Vid29ya2VyLXRocmVhZHMnKS5Xb3JrZXIKCiAgICB0aGlzLndvcmtlciA9IG5ldyBXb3JrZXIob3B0cy5wYXRoKQogICAgdmFyIHNlbGYgPSB0aGlzCiAgICB0aGlzLndvcmtlci5vbm1lc3NhZ2UgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgZCA9IGUuZGF0YQogICAgICBpZiAoIWQpIHJldHVybgogICAgICBzZWxmLnRyaWdnZXIoZC5tZXRob2QsIGQuYXJncykKICAgIH0KICAgIHRoaXMud29ya2VyLnBvc3RNZXNzYWdlKHsKICAgICAgICB0eXBlOiAnc2VlZCcKICAgICAgLCBzZWVkOiBvcHRzLnNlZWQoKQogICAgICAsIGltcG9ydHM6IG9wdHMuaW1wb3J0cwogICAgfSkKICAgIHRoaXMud29ya2VyLnBvc3RNZXNzYWdlKHsKICAgICAgICB0eXBlOiAnaW5pdCcKICAgICAgLCByZXFzOiByZXFzCiAgICB9KQogIH0KCiAgLy8gaW5oZXJpdCBmcm9tIEVFCiAgSExQLmV4dGVuZChPVFIucHJvdG90eXBlLl9TTVcsIEV2ZW50RW1pdHRlcikKCiAgLy8gc2hpbSBzbSBtZXRob2RzCiAgO1snaGFuZGxlU00nLCAncmN2U2VjcmV0JywgJ2Fib3J0J10uZm9yRWFjaChmdW5jdGlvbiAobSkgewogICAgT1RSLnByb3RvdHlwZS5fU01XLnByb3RvdHlwZVttXSA9IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy53b3JrZXIucG9zdE1lc3NhZ2UoewogICAgICAgICAgdHlwZTogJ21ldGhvZCcKICAgICAgICAsIG1ldGhvZDogbQogICAgICAgICwgYXJnczogQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAwKQogICAgICB9KQogICAgfQogIH0pCgogIE9UUi5wcm90b3R5cGUuX3NtSW5pdCA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciByZXFzID0gewogICAgICAgIHNzaWQ6IHRoaXMuc3NpZAogICAgICAsIG91cl9mcDogdGhpcy5wcml2LmZpbmdlcnByaW50KCkKICAgICAgLCB0aGVpcl9mcDogdGhpcy50aGVpcl9wcml2X3BrLmZpbmdlcnByaW50KCkKICAgICAgLCBkZWJ1ZzogdGhpcy5kZWJ1ZwogICAgfQogICAgaWYgKHRoaXMuc213KSB7CiAgICAgIGlmICh0aGlzLnNtKSB0aGlzLnNtLndvcmtlci50ZXJtaW5hdGUoKSAgLy8gZGVzdHJveSBwcmV2IHdlYndvcmtlcgogICAgICB0aGlzLnNtID0gbmV3IHRoaXMuX1NNVyh0aGlzLCByZXFzKQogICAgfSBlbHNlIHsKICAgICAgdGhpcy5zbSA9IG5ldyBTTShyZXFzKQogICAgfQogICAgdmFyIHNlbGYgPSB0aGlzCiAgICA7Wyd0cnVzdCcsICdhYm9ydCcsICdxdWVzdGlvbiddLmZvckVhY2goZnVuY3Rpb24gKGUpIHsKICAgICAgc2VsZi5zbS5vbihlLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgc2VsZi50cmlnZ2VyKCdzbXAnLCBbZV0uY29uY2F0KEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cykpKQogICAgICB9KQogICAgfSkKICAgIHRoaXMuc20ub24oJ3NlbmQnLCBmdW5jdGlvbiAoc3NpZCwgc2VuZCkgewogICAgICBpZiAoc2VsZi5zc2lkID09PSBzc2lkKSB7CiAgICAgICAgc2VuZCA9IHNlbGYucHJlcGFyZU1zZyhzZW5kKQogICAgICAgIHNlbGYuaW8oc2VuZCkKICAgICAgfQogICAgfSkKICB9CgogIE9UUi5wcm90b3R5cGUuaW8gPSBmdW5jdGlvbiAobXNnLCBtZXRhKSB7CgogICAgLy8gYnVmZmVyCiAgICBtc2cgPSAoW10uY29uY2F0KG1zZykpLm1hcChmdW5jdGlvbihtKXsKICAgICAgIHJldHVybiB7IG1zZzogbSwgbWV0YTogbWV0YSB9CiAgICB9KQogICAgdGhpcy5vdXRnb2luZyA9IHRoaXMub3V0Z29pbmcuY29uY2F0KG1zZykKCiAgICB2YXIgc2VsZiA9IHRoaXMKICAgIDsoZnVuY3Rpb24gc2VuZChmaXJzdCkgewogICAgICBpZiAoIWZpcnN0KSB7CiAgICAgICAgaWYgKCFzZWxmLm91dGdvaW5nLmxlbmd0aCkgcmV0dXJuCiAgICAgICAgdmFyIGVsZW0gPSBzZWxmLm91dGdvaW5nLnNoaWZ0KCkKICAgICAgICBzZWxmLnRyaWdnZXIoJ2lvJywgW2VsZW0ubXNnLCBlbGVtLm1ldGFdKQogICAgICB9CiAgICAgIHNldFRpbWVvdXQoc2VuZCwgZmlyc3QgPyAwIDogc2VsZi5zZW5kX2ludGVydmFsKQogICAgfSh0cnVlKSkKCiAgfQoKICBPVFIucHJvdG90eXBlLmRoID0gZnVuY3Rpb24gZGgoKSB7CiAgICB2YXIga2V5cyA9IHsgcHJpdmF0ZUtleTogQmlnSW50LnJhbmRCaWdJbnQoMzIwKSB9CiAgICBrZXlzLnB1YmxpY0tleSA9IEJpZ0ludC5wb3dNb2QoRywga2V5cy5wcml2YXRlS2V5LCBOKQogICAgcmV0dXJuIGtleXMKICB9CgogIC8vIHNlc3Npb24gY29uc3RydWN0b3IKICBPVFIucHJvdG90eXBlLkRIU2Vzc2lvbiA9IGZ1bmN0aW9uIERIU2Vzc2lvbihvdXJfZGgsIHRoZWlyX3kpIHsKICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBESFNlc3Npb24pKSByZXR1cm4gbmV3IERIU2Vzc2lvbihvdXJfZGgsIHRoZWlyX3kpCgogICAgLy8gc2hhcmVkIHNlY3JldAogICAgdmFyIHMgPSBCaWdJbnQucG93TW9kKHRoZWlyX3ksIG91cl9kaC5wcml2YXRlS2V5LCBOKQogICAgdmFyIHNlY2J5dGVzID0gSExQLnBhY2tNUEkocykKCiAgICAvLyBzZXNzaW9uIGlkCiAgICB0aGlzLmlkID0gSExQLm1hc2soSExQLmgyKCdceDAwJywgc2VjYnl0ZXMpLCAwLCA2NCkgIC8vIGZpcnN0IDY0LWJpdHMKCiAgICAvLyBhcmUgd2UgdGhlIGhpZ2ggb3IgbG93IGVuZCBvZiB0aGUgY29ubmVjdGlvbj8KICAgIHZhciBzcSA9IEJpZ0ludC5ncmVhdGVyKG91cl9kaC5wdWJsaWNLZXksIHRoZWlyX3kpCiAgICB2YXIgc2VuZGJ5dGUgPSBzcSA/ICdceDAxJyA6ICdceDAyJwogICAgdmFyIHJjdmJ5dGUgID0gc3EgPyAnXHgwMicgOiAnXHgwMScKCiAgICAvLyBzZW5kaW5nIGFuZCByZWNlaXZpbmcga2V5cwogICAgdGhpcy5zZW5kZW5jID0gSExQLm1hc2soSExQLmgxKHNlbmRieXRlLCBzZWNieXRlcyksIDAsIDEyOCkgIC8vIGYxNiBieXRlcwogICAgdGhpcy5zZW5kbWFjID0gQ3J5cHRvSlMuU0hBMShDcnlwdG9KUy5lbmMuTGF0aW4xLnBhcnNlKHRoaXMuc2VuZGVuYykpCiAgICB0aGlzLnNlbmRtYWMgPSB0aGlzLnNlbmRtYWMudG9TdHJpbmcoQ3J5cHRvSlMuZW5jLkxhdGluMSkKCiAgICB0aGlzLnJjdmVuYyA9IEhMUC5tYXNrKEhMUC5oMShyY3ZieXRlLCBzZWNieXRlcyksIDAsIDEyOCkKICAgIHRoaXMucmN2bWFjID0gQ3J5cHRvSlMuU0hBMShDcnlwdG9KUy5lbmMuTGF0aW4xLnBhcnNlKHRoaXMucmN2ZW5jKSkKICAgIHRoaXMucmN2bWFjID0gdGhpcy5yY3ZtYWMudG9TdHJpbmcoQ3J5cHRvSlMuZW5jLkxhdGluMSkKICAgIHRoaXMucmN2bWFjdXNlZCA9IGZhbHNlCgogICAgLy8gZXh0cmEgc3ltbWV0cmljIGtleQogICAgdGhpcy5leHRyYV9zeW1rZXkgPSBITFAuaDIoJ1x4ZmYnLCBzZWNieXRlcykKCiAgICAvLyBjb3VudGVycwogICAgdGhpcy5zZW5kX2NvdW50ZXIgPSAwCiAgICB0aGlzLnJjdl9jb3VudGVyID0gMAogIH0KCiAgT1RSLnByb3RvdHlwZS5yb3RhdGVPdXJLZXlzID0gZnVuY3Rpb24gKCkgewoKICAgIC8vIHJldmVhbCBvbGQgbWFjIGtleXMKICAgIHZhciBzZWxmID0gdGhpcwogICAgdGhpcy5zZXNzS2V5c1sxXS5mb3JFYWNoKGZ1bmN0aW9uIChzaykgewogICAgICBpZiAoc2sgJiYgc2sucmN2bWFjdXNlZCkgc2VsZi5vbGRNYWNLZXlzLnB1c2goc2sucmN2bWFjKQogICAgfSkKCiAgICAvLyByb3RhdGUgb3VyIGtleXMKICAgIHRoaXMub3VyX29sZF9kaCA9IHRoaXMub3VyX2RoCiAgICB0aGlzLm91cl9kaCA9IHRoaXMuZGgoKQogICAgdGhpcy5vdXJfa2V5aWQgKz0gMQoKICAgIHRoaXMuc2Vzc0tleXNbMV1bMF0gPSB0aGlzLnNlc3NLZXlzWzBdWzBdCiAgICB0aGlzLnNlc3NLZXlzWzFdWzFdID0gdGhpcy5zZXNzS2V5c1swXVsxXQogICAgdGhpcy5zZXNzS2V5c1swXSA9IFsKICAgICAgICB0aGlzLnRoZWlyX3kgPwogICAgICAgICAgICBuZXcgdGhpcy5ESFNlc3Npb24odGhpcy5vdXJfZGgsIHRoaXMudGhlaXJfeSkgOiBudWxsCiAgICAgICwgdGhpcy50aGVpcl9vbGRfeSA/CiAgICAgICAgICAgIG5ldyB0aGlzLkRIU2Vzc2lvbih0aGlzLm91cl9kaCwgdGhpcy50aGVpcl9vbGRfeSkgOiBudWxsCiAgICBdCgogIH0KCiAgT1RSLnByb3RvdHlwZS5yb3RhdGVUaGVpcktleXMgPSBmdW5jdGlvbiAodGhlaXJfeSkgewoKICAgIC8vIGluY3JlbWVudCB0aGVpciBrZXlpZAogICAgdGhpcy50aGVpcl9rZXlpZCArPSAxCgogICAgLy8gcmV2ZWFsIG9sZCBtYWMga2V5cwogICAgdmFyIHNlbGYgPSB0aGlzCiAgICB0aGlzLnNlc3NLZXlzLmZvckVhY2goZnVuY3Rpb24gKHNrKSB7CiAgICAgIGlmIChza1sxXSAmJiBza1sxXS5yY3ZtYWN1c2VkKSBzZWxmLm9sZE1hY0tleXMucHVzaChza1sxXS5yY3ZtYWMpCiAgICB9KQoKICAgIC8vIHJvdGF0ZSB0aGVpciBrZXlzIC8gc2Vzc2lvbgogICAgdGhpcy50aGVpcl9vbGRfeSA9IHRoaXMudGhlaXJfeQogICAgdGhpcy5zZXNzS2V5c1swXVsxXSA9IHRoaXMuc2Vzc0tleXNbMF1bMF0KICAgIHRoaXMuc2Vzc0tleXNbMV1bMV0gPSB0aGlzLnNlc3NLZXlzWzFdWzBdCgogICAgLy8gbmV3IGtleXMgLyBzZXNzaW9ucwogICAgdGhpcy50aGVpcl95ID0gdGhlaXJfeQogICAgdGhpcy5zZXNzS2V5c1swXVswXSA9IG5ldyB0aGlzLkRIU2Vzc2lvbih0aGlzLm91cl9kaCwgdGhpcy50aGVpcl95KQogICAgdGhpcy5zZXNzS2V5c1sxXVswXSA9IG5ldyB0aGlzLkRIU2Vzc2lvbih0aGlzLm91cl9vbGRfZGgsIHRoaXMudGhlaXJfeSkKCiAgfQoKICBPVFIucHJvdG90eXBlLnByZXBhcmVNc2cgPSBmdW5jdGlvbiAobXNnLCBlc2spIHsKICAgIGlmICh0aGlzLm1zZ3N0YXRlICE9PSBDT05TVC5NU0dTVEFURV9FTkNSWVBURUQgfHwgdGhpcy50aGVpcl9rZXlpZCA9PT0gMCkKICAgICAgcmV0dXJuIHRoaXMuZXJyb3IoJ05vdCByZWFkeSB0byBlbmNyeXB0LicpCgogICAgdmFyIHNlc3NLZXlzID0gdGhpcy5zZXNzS2V5c1sxXVswXQoKICAgIGlmIChzZXNzS2V5cy5zZW5kX2NvdW50ZXIgPj0gTUFYX0lOVCkKICAgICAgcmV0dXJuIHRoaXMuZXJyb3IoJ1Nob3VsZCBoYXZlIHJla2V5ZWQgYnkgbm93LicpCgogICAgc2Vzc0tleXMuc2VuZF9jb3VudGVyICs9IDEKCiAgICB2YXIgY3RyID0gSExQLnBhY2tDdHIoc2Vzc0tleXMuc2VuZF9jb3VudGVyKQoKICAgIHZhciBzZW5kID0gdGhpcy5ha2Uub3RyX3ZlcnNpb24gKyAnXHgwMycgIC8vIHZlcnNpb24gYW5kIHR5cGUKICAgIHZhciB2MyA9ICh0aGlzLmFrZS5vdHJfdmVyc2lvbiA9PT0gQ09OU1QuT1RSX1ZFUlNJT05fMykKCiAgICBpZiAodjMpIHsKICAgICAgc2VuZCArPSB0aGlzLm91cl9pbnN0YW5jZV90YWcKICAgICAgc2VuZCArPSB0aGlzLnRoZWlyX2luc3RhbmNlX3RhZwogICAgfQoKICAgIHNlbmQgKz0gJ1x4MDAnICAvLyBmbGFnCiAgICBzZW5kICs9IEhMUC5wYWNrSU5UKHRoaXMub3VyX2tleWlkIC0gMSkKICAgIHNlbmQgKz0gSExQLnBhY2tJTlQodGhpcy50aGVpcl9rZXlpZCkKICAgIHNlbmQgKz0gSExQLnBhY2tNUEkodGhpcy5vdXJfZGgucHVibGljS2V5KQogICAgc2VuZCArPSBjdHIuc3Vic3RyaW5nKDAsIDgpCgogICAgaWYgKE1hdGguY2VpbChtc2cubGVuZ3RoIC8gOCkgPj0gTUFYX1VJTlQpICAvLyAqIDE2IC8gMTI4CiAgICAgIHJldHVybiB0aGlzLmVycm9yKCdNZXNzYWdlIGlzIHRvbyBsb25nLicpCgogICAgdmFyIGFlcyA9IEhMUC5lbmNyeXB0QWVzKAogICAgICAgIENyeXB0b0pTLmVuYy5MYXRpbjEucGFyc2UobXNnKQogICAgICAsIHNlc3NLZXlzLnNlbmRlbmMKICAgICAgLCBjdHIKICAgICkKCiAgICBzZW5kICs9IEhMUC5wYWNrRGF0YShhZXMpCiAgICBzZW5kICs9IEhMUC5tYWtlMU1hYyhzZW5kLCBzZXNzS2V5cy5zZW5kbWFjKQogICAgc2VuZCArPSBITFAucGFja0RhdGEodGhpcy5vbGRNYWNLZXlzLnNwbGljZSgwKS5qb2luKCcnKSkKCiAgICBzZW5kID0gSExQLndyYXBNc2coCiAgICAgICAgc2VuZAogICAgICAsIHRoaXMuZnJhZ21lbnRfc2l6ZQogICAgICAsIHYzCiAgICAgICwgdGhpcy5vdXJfaW5zdGFuY2VfdGFnCiAgICAgICwgdGhpcy50aGVpcl9pbnN0YW5jZV90YWcKICAgICkKICAgIGlmIChzZW5kWzBdKSByZXR1cm4gdGhpcy5lcnJvcihzZW5kWzBdKQoKICAgIC8vIGVtaXQgZXh0cmEgc3ltbWV0cmljIGtleQogICAgaWYgKGVzaykgdGhpcy50cmlnZ2VyKCdmaWxlJywgWydzZW5kJywgc2Vzc0tleXMuZXh0cmFfc3lta2V5LCBlc2tdKQoKICAgIHJldHVybiBzZW5kWzFdCiAgfQoKICBPVFIucHJvdG90eXBlLmhhbmRsZURhdGFNc2cgPSBmdW5jdGlvbiAobXNnKSB7CiAgICB2YXIgdnQgPSBtc2cudmVyc2lvbiArIG1zZy50eXBlCgogICAgaWYgKHRoaXMuYWtlLm90cl92ZXJzaW9uID09PSBDT05TVC5PVFJfVkVSU0lPTl8zKQogICAgICB2dCArPSBtc2cuaW5zdGFuY2VfdGFncwoKICAgIHZhciB0eXBlcyA9IFsnQllURScsICdJTlQnLCAnSU5UJywgJ01QSScsICdDVFInLCAnREFUQScsICdNQUMnLCAnREFUQSddCiAgICBtc2cgPSBITFAuc3BsaXR5cGUodHlwZXMsIG1zZy5tc2cpCgogICAgLy8gaWdub3JlIGZsYWcKICAgIHZhciBpZ24gPSAobXNnWzBdID09PSAnXHgwMScpCgogICAgaWYgKHRoaXMubXNnc3RhdGUgIT09IENPTlNULk1TR1NUQVRFX0VOQ1JZUFRFRCB8fCBtc2cubGVuZ3RoICE9PSA4KSB7CiAgICAgIGlmICghaWduKSB0aGlzLmVycm9yKCdSZWNlaXZlZCBhbiB1bnJlYWRhYmxlIGVuY3J5cHRlZCBtZXNzYWdlLicsIHRydWUpCiAgICAgIHJldHVybgogICAgfQoKICAgIHZhciBvdXJfa2V5aWQgPSB0aGlzLm91cl9rZXlpZCAtIEhMUC5yZWFkTGVuKG1zZ1syXSkKICAgIHZhciB0aGVpcl9rZXlpZCA9IHRoaXMudGhlaXJfa2V5aWQgLSBITFAucmVhZExlbihtc2dbMV0pCgogICAgaWYgKG91cl9rZXlpZCA8IDAgfHwgb3VyX2tleWlkID4gMSkgewogICAgICBpZiAoIWlnbikgdGhpcy5lcnJvcignTm90IG9mIG91ciBsYXRlc3Qga2V5cy4nLCB0cnVlKQogICAgICByZXR1cm4KICAgIH0KCiAgICBpZiAodGhlaXJfa2V5aWQgPCAwIHx8IHRoZWlyX2tleWlkID4gMSkgewogICAgICBpZiAoIWlnbikgdGhpcy5lcnJvcignTm90IG9mIHlvdXIgbGF0ZXN0IGtleXMuJywgdHJ1ZSkKICAgICAgcmV0dXJuCiAgICB9CgogICAgdmFyIHRoZWlyX3kgPSB0aGVpcl9rZXlpZCA/IHRoaXMudGhlaXJfb2xkX3kgOiB0aGlzLnRoZWlyX3kKCiAgICBpZiAodGhlaXJfa2V5aWQgPT09IDEgJiYgIXRoZWlyX3kpIHsKICAgICAgaWYgKCFpZ24pIHRoaXMuZXJyb3IoJ0RvIG5vdCBoYXZlIHRoYXQga2V5LicpCiAgICAgIHJldHVybgogICAgfQoKICAgIHZhciBzZXNzS2V5cyA9IHRoaXMuc2Vzc0tleXNbb3VyX2tleWlkXVt0aGVpcl9rZXlpZF0KCiAgICB2YXIgY3RyID0gSExQLnVucGFja0N0cihtc2dbNF0pCiAgICBpZiAoY3RyIDw9IHNlc3NLZXlzLnJjdl9jb3VudGVyKSB7CiAgICAgIGlmICghaWduKSB0aGlzLmVycm9yKCdDb3VudGVyIGluIG1lc3NhZ2UgaXMgbm90IGxhcmdlci4nKQogICAgICByZXR1cm4KICAgIH0KICAgIHNlc3NLZXlzLnJjdl9jb3VudGVyID0gY3RyCgogICAgLy8gdmVyaWZ5IG1hYwogICAgdnQgKz0gbXNnLnNsaWNlKDAsIDYpLmpvaW4oJycpCiAgICB2YXIgdm1hYyA9IEhMUC5tYWtlMU1hYyh2dCwgc2Vzc0tleXMucmN2bWFjKQoKICAgIGlmICghSExQLmNvbXBhcmUobXNnWzZdLCB2bWFjKSkgewogICAgICBpZiAoIWlnbikgdGhpcy5lcnJvcignTUFDcyBkbyBub3QgbWF0Y2guJykKICAgICAgcmV0dXJuCiAgICB9CiAgICBzZXNzS2V5cy5yY3ZtYWN1c2VkID0gdHJ1ZQoKICAgIHZhciBvdXQgPSBITFAuZGVjcnlwdEFlcygKICAgICAgICBtc2dbNV0uc3Vic3RyaW5nKDQpCiAgICAgICwgc2Vzc0tleXMucmN2ZW5jCiAgICAgICwgSExQLnBhZEN0cihtc2dbNF0pCiAgICApCiAgICBvdXQgPSBvdXQudG9TdHJpbmcoQ3J5cHRvSlMuZW5jLkxhdGluMSkKCiAgICBpZiAoIW91cl9rZXlpZCkgdGhpcy5yb3RhdGVPdXJLZXlzKCkKICAgIGlmICghdGhlaXJfa2V5aWQpIHRoaXMucm90YXRlVGhlaXJLZXlzKEhMUC5yZWFkTVBJKG1zZ1szXSkpCgogICAgLy8gcGFyc2UgVExWcwogICAgdmFyIGluZCA9IG91dC5pbmRleE9mKCdceDAwJykKICAgIGlmICh+aW5kKSB7CiAgICAgIHRoaXMuaGFuZGxlVExWcyhvdXQuc3Vic3RyaW5nKGluZCArIDEpLCBzZXNzS2V5cykKICAgICAgb3V0ID0gb3V0LnN1YnN0cmluZygwLCBpbmQpCiAgICB9CgogICAgb3V0ID0gQ3J5cHRvSlMuZW5jLkxhdGluMS5wYXJzZShvdXQpCiAgICByZXR1cm4gb3V0LnRvU3RyaW5nKENyeXB0b0pTLmVuYy5VdGY4KQogIH0KCiAgT1RSLnByb3RvdHlwZS5oYW5kbGVUTFZzID0gZnVuY3Rpb24gKHRsdnMsIHNlc3NLZXlzKSB7CiAgICB2YXIgdHlwZSwgbGVuLCBtc2cKICAgIGZvciAoOyB0bHZzLmxlbmd0aDsgKSB7CiAgICAgIHR5cGUgPSBITFAudW5wYWNrU0hPUlQodGx2cy5zdWJzdHIoMCwgMikpCiAgICAgIGxlbiA9IEhMUC51bnBhY2tTSE9SVCh0bHZzLnN1YnN0cigyLCAyKSkKCiAgICAgIG1zZyA9IHRsdnMuc3Vic3RyKDQsIGxlbikKCiAgICAgIC8vIFRPRE86IGhhbmRsZSBwYXRob2xvZ2ljYWwgY2FzZXMgYmV0dGVyCiAgICAgIGlmIChtc2cubGVuZ3RoIDwgbGVuKSBicmVhawoKICAgICAgc3dpdGNoICh0eXBlKSB7CiAgICAgICAgY2FzZSAxOgogICAgICAgICAgLy8gRGlzY29ubmVjdGVkCiAgICAgICAgICB0aGlzLm1zZ3N0YXRlID0gQ09OU1QuTVNHU1RBVEVfRklOSVNIRUQKICAgICAgICAgIHRoaXMudHJpZ2dlcignc3RhdHVzJywgW0NPTlNULlNUQVRVU19FTkRfT1RSXSkKICAgICAgICAgIGJyZWFrCiAgICAgICAgY2FzZSAyOiBjYXNlIDM6IGNhc2UgNDoKICAgICAgICBjYXNlIDU6IGNhc2UgNjogY2FzZSA3OgogICAgICAgICAgLy8gU01QCiAgICAgICAgICBpZiAodGhpcy5tc2dzdGF0ZSAhPT0gQ09OU1QuTVNHU1RBVEVfRU5DUllQVEVEKSB7CiAgICAgICAgICAgIGlmICh0aGlzLnNtKSB0aGlzLnNtLmFib3J0KCkKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICB9CiAgICAgICAgICBpZiAoIXRoaXMuc20pIHRoaXMuX3NtSW5pdCgpCiAgICAgICAgICB0aGlzLnNtLmhhbmRsZVNNKHsgbXNnOiBtc2csIHR5cGU6IHR5cGUgfSkKICAgICAgICAgIGJyZWFrCiAgICAgICAgY2FzZSA4OgogICAgICAgICAgLy8gdXRmOCBmaWxlbmFtZXMKICAgICAgICAgIG1zZyA9IG1zZy5zdWJzdHJpbmcoNCkgLy8gcmVtb3ZlIDQtYnl0ZSBpbmRpY2F0aW9uCiAgICAgICAgICBtc2cgPSBDcnlwdG9KUy5lbmMuTGF0aW4xLnBhcnNlKG1zZykKICAgICAgICAgIG1zZyA9IG1zZy50b1N0cmluZyhDcnlwdG9KUy5lbmMuVXRmOCkKCiAgICAgICAgICAvLyBFeHRyYSBTeW1rZXkKICAgICAgICAgIHRoaXMudHJpZ2dlcignZmlsZScsIFsncmVjZWl2ZScsIHNlc3NLZXlzLmV4dHJhX3N5bWtleSwgbXNnXSkKICAgICAgICAgIGJyZWFrCiAgICAgIH0KCiAgICAgIHRsdnMgPSB0bHZzLnN1YnN0cmluZyg0ICsgbGVuKQogICAgfQogIH0KCiAgT1RSLnByb3RvdHlwZS5zbXBTZWNyZXQgPSBmdW5jdGlvbiAoc2VjcmV0LCBxdWVzdGlvbikgewogICAgaWYgKHRoaXMubXNnc3RhdGUgIT09IENPTlNULk1TR1NUQVRFX0VOQ1JZUFRFRCkKICAgICAgcmV0dXJuIHRoaXMuZXJyb3IoJ011c3QgYmUgZW5jcnlwdGVkIGZvciBTTVAuJykKCiAgICBpZiAodHlwZW9mIHNlY3JldCAhPT0gJ3N0cmluZycgfHwgc2VjcmV0Lmxlbmd0aCA8IDEpCiAgICAgIHJldHVybiB0aGlzLmVycm9yKCdTZWNyZXQgaXMgcmVxdWlyZWQuJykKCiAgICBpZiAoIXRoaXMuc20pIHRoaXMuX3NtSW5pdCgpCgogICAgLy8gdXRmOCBpbnB1dHMKICAgIHNlY3JldCA9IENyeXB0b0pTLmVuYy5VdGY4LnBhcnNlKHNlY3JldCkudG9TdHJpbmcoQ3J5cHRvSlMuZW5jLkxhdGluMSkKICAgIHF1ZXN0aW9uID0gQ3J5cHRvSlMuZW5jLlV0ZjgucGFyc2UocXVlc3Rpb24pLnRvU3RyaW5nKENyeXB0b0pTLmVuYy5MYXRpbjEpCgogICAgdGhpcy5zbS5yY3ZTZWNyZXQoc2VjcmV0LCBxdWVzdGlvbikKICB9CgogIE9UUi5wcm90b3R5cGUuc2VuZFF1ZXJ5TXNnID0gZnVuY3Rpb24gKCkgewogICAgdmFyIHZlcnNpb25zID0ge30KICAgICAgLCBtc2cgPSBDT05TVC5PVFJfVEFHCgogICAgaWYgKHRoaXMuQUxMT1dfVjIpIHZlcnNpb25zWycyJ10gPSB0cnVlCiAgICBpZiAodGhpcy5BTExPV19WMykgdmVyc2lvbnNbJzMnXSA9IHRydWUKCiAgICAvLyBidXQgd2UgZG9uJ3QgYWxsb3cgdjEKICAgIC8vIGlmICh2ZXJzaW9uc1snMSddKSBtc2cgKz0gJz8nCgogICAgdmFyIHZzID0gT2JqZWN0LmtleXModmVyc2lvbnMpCiAgICBpZiAodnMubGVuZ3RoKSB7CiAgICAgIG1zZyArPSAndicKICAgICAgdnMuZm9yRWFjaChmdW5jdGlvbiAodikgewogICAgICAgIGlmICh2ICE9PSAnMScpIG1zZyArPSB2CiAgICAgIH0pCiAgICAgIG1zZyArPSAnPycKICAgIH0KCiAgICB0aGlzLmlvKG1zZykKICAgIHRoaXMudHJpZ2dlcignc3RhdHVzJywgW0NPTlNULlNUQVRVU19TRU5EX1FVRVJZXSkKICB9CgogIE9UUi5wcm90b3R5cGUuc2VuZE1zZyA9IGZ1bmN0aW9uIChtc2csIG1ldGEpIHsKICAgIGlmICggdGhpcy5SRVFVSVJFX0VOQ1JZUFRJT04gfHwKICAgICAgICAgdGhpcy5tc2dzdGF0ZSAhPT0gQ09OU1QuTVNHU1RBVEVfUExBSU5URVhUCiAgICApIHsKICAgICAgbXNnID0gQ3J5cHRvSlMuZW5jLlV0ZjgucGFyc2UobXNnKQogICAgICBtc2cgPSBtc2cudG9TdHJpbmcoQ3J5cHRvSlMuZW5jLkxhdGluMSkKICAgIH0KCiAgICBzd2l0Y2ggKHRoaXMubXNnc3RhdGUpIHsKICAgICAgY2FzZSBDT05TVC5NU0dTVEFURV9QTEFJTlRFWFQ6CiAgICAgICAgaWYgKHRoaXMuUkVRVUlSRV9FTkNSWVBUSU9OKSB7CiAgICAgICAgICB0aGlzLnN0b3JlZE1ncy5wdXNoKHttc2c6IG1zZywgbWV0YTogbWV0YX0pCiAgICAgICAgICB0aGlzLnNlbmRRdWVyeU1zZygpCiAgICAgICAgICByZXR1cm4KICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMuU0VORF9XSElURVNQQUNFX1RBRyAmJiAhdGhpcy5yZWNlaXZlZFBsYWludGV4dCkgewogICAgICAgICAgbXNnICs9IENPTlNULldISVRFU1BBQ0VfVEFHICAvLyAxNiBieXRlIHRhZwogICAgICAgICAgaWYgKHRoaXMuQUxMT1dfVjMpIG1zZyArPSBDT05TVC5XSElURVNQQUNFX1RBR19WMwogICAgICAgICAgaWYgKHRoaXMuQUxMT1dfVjIpIG1zZyArPSBDT05TVC5XSElURVNQQUNFX1RBR19WMgogICAgICAgIH0KICAgICAgICBicmVhawogICAgICBjYXNlIENPTlNULk1TR1NUQVRFX0ZJTklTSEVEOgogICAgICAgIHRoaXMuc3RvcmVkTWdzLnB1c2goe21zZzogbXNnLCBtZXRhOiBtZXRhfSkKICAgICAgICB0aGlzLmVycm9yKCdNZXNzYWdlIGNhbm5vdCBiZSBzZW50IGF0IHRoaXMgdGltZS4nKQogICAgICAgIHJldHVybgogICAgICBjYXNlIENPTlNULk1TR1NUQVRFX0VOQ1JZUFRFRDoKICAgICAgICBtc2cgPSB0aGlzLnByZXBhcmVNc2cobXNnKQogICAgICAgIGJyZWFrCiAgICAgIGRlZmF1bHQ6CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdVbmtub3duIG1lc3NhZ2Ugc3RhdGUuJykKICAgIH0KCiAgICBpZiAobXNnKSB0aGlzLmlvKG1zZywgbWV0YSkKICB9CgogIE9UUi5wcm90b3R5cGUucmVjZWl2ZU1zZyA9IGZ1bmN0aW9uIChtc2cpIHsKCiAgICAvLyBwYXJzZSB0eXBlCiAgICBtc2cgPSBQYXJzZS5wYXJzZU1zZyh0aGlzLCBtc2cpCgogICAgaWYgKCFtc2cpIHJldHVybgoKICAgIHN3aXRjaCAobXNnLmNscykgewogICAgICBjYXNlICdlcnJvcic6CiAgICAgICAgdGhpcy5lcnJvcihtc2cubXNnKQogICAgICAgIHJldHVybgogICAgICBjYXNlICdha2UnOgogICAgICAgIGlmICggbXNnLnZlcnNpb24gPT09IENPTlNULk9UUl9WRVJTSU9OXzMgJiYKICAgICAgICAgIHRoaXMuY2hlY2tJbnN0YW5jZVRhZ3MobXNnLmluc3RhbmNlX3RhZ3MpCiAgICAgICAgKSByZXR1cm4gIC8vIGlnbm9yZQogICAgICAgIHRoaXMuYWtlLmhhbmRsZUFLRShtc2cpCiAgICAgICAgcmV0dXJuCiAgICAgIGNhc2UgJ2RhdGEnOgogICAgICAgIGlmICggbXNnLnZlcnNpb24gPT09IENPTlNULk9UUl9WRVJTSU9OXzMgJiYKICAgICAgICAgIHRoaXMuY2hlY2tJbnN0YW5jZVRhZ3MobXNnLmluc3RhbmNlX3RhZ3MpCiAgICAgICAgKSByZXR1cm4gIC8vIGlnbm9yZQogICAgICAgIG1zZy5tc2cgPSB0aGlzLmhhbmRsZURhdGFNc2cobXNnKQogICAgICAgIG1zZy5lbmNyeXB0ZWQgPSB0cnVlCiAgICAgICAgYnJlYWsKICAgICAgY2FzZSAncXVlcnknOgogICAgICAgIGlmICh0aGlzLm1zZ3N0YXRlID09PSBDT05TVC5NU0dTVEFURV9FTkNSWVBURUQpIHRoaXMuX2FrZUluaXQoKQogICAgICAgIHRoaXMuZG9BS0UobXNnKQogICAgICAgIGJyZWFrCiAgICAgIGRlZmF1bHQ6CiAgICAgICAgLy8gY2hlY2sgZm9yIGVuY3J5cHRlZAogICAgICAgIGlmICggdGhpcy5SRVFVSVJFX0VOQ1JZUFRJT04gfHwKICAgICAgICAgICAgIHRoaXMubXNnc3RhdGUgIT09IENPTlNULk1TR1NUQVRFX1BMQUlOVEVYVAogICAgICAgICkgdGhpcy5lcnJvcignUmVjZWl2ZWQgYW4gdW5lbmNyeXB0ZWQgbWVzc2FnZS4nKQoKICAgICAgICAvLyByZWNlaXZlZCBhIHBsYWludGV4dCBtZXNzYWdlCiAgICAgICAgLy8gc3RvcCBzZW5kaW5nIHRoZSB3aGl0ZXNwYWNlIHRhZwogICAgICAgIHRoaXMucmVjZWl2ZWRQbGFpbnRleHQgPSB0cnVlCgogICAgICAgIC8vIHJlY2VpdmVkIGEgd2hpdGVzcGFjZSB0YWcKICAgICAgICBpZiAodGhpcy5XSElURVNQQUNFX1NUQVJUX0FLRSAmJiBtc2cudmVyLmxlbmd0aCA+IDApCiAgICAgICAgICB0aGlzLmRvQUtFKG1zZykKICAgIH0KCiAgICBpZiAobXNnLm1zZykgdGhpcy50cmlnZ2VyKCd1aScsIFttc2cubXNnLCAhIW1zZy5lbmNyeXB0ZWRdKQogIH0KCiAgT1RSLnByb3RvdHlwZS5jaGVja0luc3RhbmNlVGFncyA9IGZ1bmN0aW9uIChpdCkgewogICAgdmFyIHRoZWlyX2l0ID0gSExQLnJlYWRMZW4oaXQuc3Vic3RyKDAsIDQpKQogICAgdmFyIG91cl9pdCA9IEhMUC5yZWFkTGVuKGl0LnN1YnN0cig0LCA0KSkKCiAgICBpZiAob3VyX2l0ICYmIG91cl9pdCAhPT0gSExQLnJlYWRMZW4odGhpcy5vdXJfaW5zdGFuY2VfdGFnKSkKICAgICAgcmV0dXJuIHRydWUKCiAgICBpZiAoSExQLnJlYWRMZW4odGhpcy50aGVpcl9pbnN0YW5jZV90YWcpKSB7CiAgICAgIGlmIChITFAucmVhZExlbih0aGlzLnRoZWlyX2luc3RhbmNlX3RhZykgIT09IHRoZWlyX2l0KSByZXR1cm4gdHJ1ZQogICAgfSBlbHNlIHsKICAgICAgaWYgKHRoZWlyX2l0IDwgMTAwKSByZXR1cm4gdHJ1ZQogICAgICB0aGlzLnRoZWlyX2luc3RhbmNlX3RhZyA9IEhMUC5wYWNrSU5UKHRoZWlyX2l0KQogICAgfQogIH0KCiAgT1RSLnByb3RvdHlwZS5kb0FLRSA9IGZ1bmN0aW9uIChtc2cpIHsKICAgIGlmICh0aGlzLkFMTE9XX1YzICYmIH5tc2cudmVyLmluZGV4T2YoQ09OU1QuT1RSX1ZFUlNJT05fMykpIHsKICAgICAgdGhpcy5ha2UuaW5pdGlhdGVBS0UoQ09OU1QuT1RSX1ZFUlNJT05fMykKICAgIH0gZWxzZSBpZiAodGhpcy5BTExPV19WMiAmJiB+bXNnLnZlci5pbmRleE9mKENPTlNULk9UUl9WRVJTSU9OXzIpKSB7CiAgICAgIHRoaXMuYWtlLmluaXRpYXRlQUtFKENPTlNULk9UUl9WRVJTSU9OXzIpCiAgICB9IGVsc2UgewogICAgICAvLyBpcyB0aGlzIGFuIGVycm9yPwogICAgICB0aGlzLmVycm9yKCdPVFIgY29udmVyc2F0aW9uIHJlcXVlc3RlZCwgJyArCiAgICAgICAgJ2J1dCBubyBjb21wYXRpYmxlIHByb3RvY29sIHZlcnNpb24gZm91bmQuJykKICAgIH0KICB9CgogIE9UUi5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbiAoZXJyLCBzZW5kKSB7CiAgICBpZiAoc2VuZCkgewogICAgICBpZiAoIXRoaXMuZGVidWcpIGVyciA9ICJBbiBPVFIgZXJyb3IgaGFzIG9jY3VycmVkLiIKICAgICAgZXJyID0gJz9PVFIgRXJyb3I6JyArIGVycgogICAgICB0aGlzLmlvKGVycikKICAgICAgcmV0dXJuCiAgICB9CiAgICB0aGlzLnRyaWdnZXIoJ2Vycm9yJywgW2Vycl0pCiAgfQoKICBPVFIucHJvdG90eXBlLnNlbmRTdG9yZWQgPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgc2VsZiA9IHRoaXMKICAgIDsodGhpcy5zdG9yZWRNZ3Muc3BsaWNlKDApKS5mb3JFYWNoKGZ1bmN0aW9uIChlbGVtKSB7CiAgICAgIHZhciBtc2cgPSBzZWxmLnByZXBhcmVNc2coZWxlbS5tc2cpCiAgICAgIHNlbGYuaW8obXNnLCBlbGVtLm1ldGEpCiAgICB9KQogIH0KCiAgT1RSLnByb3RvdHlwZS5zZW5kRmlsZSA9IGZ1bmN0aW9uIChmaWxlbmFtZSkgewogICAgaWYgKHRoaXMubXNnc3RhdGUgIT09IENPTlNULk1TR1NUQVRFX0VOQ1JZUFRFRCkKICAgICAgcmV0dXJuIHRoaXMuZXJyb3IoJ05vdCByZWFkeSB0byBlbmNyeXB0LicpCgogICAgaWYgKHRoaXMuYWtlLm90cl92ZXJzaW9uICE9PSBDT05TVC5PVFJfVkVSU0lPTl8zKQogICAgICByZXR1cm4gdGhpcy5lcnJvcignUHJvdG9jb2wgdjMgcmVxdWlyZWQuJykKCiAgICBpZiAoIWZpbGVuYW1lKSByZXR1cm4gdGhpcy5lcnJvcignUGxlYXNlIHNwZWNpZnkgYSBmaWxlbmFtZS4nKQoKICAgIC8vIHV0ZjggZmlsZW5hbWVzCiAgICB2YXIgbDFuYW1lID0gQ3J5cHRvSlMuZW5jLlV0ZjgucGFyc2UoZmlsZW5hbWUpCiAgICBsMW5hbWUgPSBsMW5hbWUudG9TdHJpbmcoQ3J5cHRvSlMuZW5jLkxhdGluMSkKCiAgICBpZiAobDFuYW1lLmxlbmd0aCA+PSA2NTUzMikgcmV0dXJuIHRoaXMuZXJyb3IoJ2ZpbGVuYW1lIGlzIHRvbyBsb25nLicpCgogICAgdmFyIG1zZyA9ICdceDAwJyAgLy8gbnVsbCBieXRlCiAgICBtc2cgKz0gJ1x4MDBceDA4JyAgLy8gdHlwZSA4IHRsdgogICAgbXNnICs9IEhMUC5wYWNrU0hPUlQoNCArIGwxbmFtZS5sZW5ndGgpICAvLyBsZW5ndGggb2YgdmFsdWUKICAgIG1zZyArPSAnXHgwMFx4MDBceDAwXHgwMScgIC8vIGZvdXIgYnl0ZXMgaW5kaWNhdGluZyBmaWxlCiAgICBtc2cgKz0gbDFuYW1lCgogICAgbXNnID0gdGhpcy5wcmVwYXJlTXNnKG1zZywgZmlsZW5hbWUpCiAgICB0aGlzLmlvKG1zZykKICB9CgogIE9UUi5wcm90b3R5cGUuZW5kT3RyID0gZnVuY3Rpb24gKCkgewogICAgaWYgKHRoaXMubXNnc3RhdGUgPT09IENPTlNULk1TR1NUQVRFX0VOQ1JZUFRFRCkgewogICAgICB0aGlzLnNlbmRNc2coJ1x4MDBceDAwXHgwMVx4MDBceDAwJykKICAgICAgaWYgKHRoaXMuc20pIHsKICAgICAgICBpZiAodGhpcy5zbXcpIHRoaXMuc20ud29ya2VyLnRlcm1pbmF0ZSgpICAvLyBkZXN0cm95IHdlYndvcmtlcgogICAgICAgIHRoaXMuc20gPSBudWxsCiAgICAgIH0KICAgIH0KICAgIHRoaXMubXNnc3RhdGUgPSBDT05TVC5NU0dTVEFURV9QTEFJTlRFWFQKICAgIHRoaXMucmVjZWl2ZWRQbGFpbnRleHQgPSBmYWxzZQogICAgdGhpcy50cmlnZ2VyKCdzdGF0dXMnLCBbQ09OU1QuU1RBVFVTX0VORF9PVFJdKQogIH0KCiAgLy8gYXR0YWNoIG1ldGhvZHMKCiAgT1RSLm1ha2VJbnN0YW5jZVRhZyA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciBudW0gPSBCaWdJbnQucmFuZEJpZ0ludCgzMikKICAgIGlmIChCaWdJbnQuZ3JlYXRlcihCaWdJbnQuc3RyMmJpZ0ludCgnMTAwJywgMTYpLCBudW0pKQogICAgICByZXR1cm4gT1RSLm1ha2VJbnN0YW5jZVRhZygpCiAgICByZXR1cm4gSExQLnBhY2tJTlQocGFyc2VJbnQoQmlnSW50LmJpZ0ludDJzdHIobnVtLCAxMCksIDEwKSkKICB9Cgp9KS5jYWxsKHRoaXMpCgoKICByZXR1cm4gewogICAgICBPVFI6IHRoaXMuT1RSCiAgICAsIERTQTogdGhpcy5EU0EKICB9Cgp9KSkKOwovLyEgbW9tZW50LmpzCi8vISB2ZXJzaW9uIDogMi42LjAKLy8hIGF1dGhvcnMgOiBUaW0gV29vZCwgSXNrcmVuIENoZXJuZXYsIE1vbWVudC5qcyBjb250cmlidXRvcnMKLy8hIGxpY2Vuc2UgOiBNSVQKLy8hIG1vbWVudGpzLmNvbQoKKGZ1bmN0aW9uICh1bmRlZmluZWQpIHsKCiAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAgICAgQ29uc3RhbnRzCiAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCgogICAgdmFyIG1vbWVudCwKICAgICAgICBWRVJTSU9OID0gIjIuNi4wIiwKICAgICAgICAvLyB0aGUgZ2xvYmFsLXNjb3BlIHRoaXMgaXMgTk9UIHRoZSBnbG9iYWwgb2JqZWN0IGluIE5vZGUuanMKICAgICAgICBnbG9iYWxTY29wZSA9IHR5cGVvZiBnbG9iYWwgIT09ICd1bmRlZmluZWQnID8gZ2xvYmFsIDogdGhpcywKICAgICAgICBvbGRHbG9iYWxNb21lbnQsCiAgICAgICAgcm91bmQgPSBNYXRoLnJvdW5kLAogICAgICAgIGksCgogICAgICAgIFlFQVIgPSAwLAogICAgICAgIE1PTlRIID0gMSwKICAgICAgICBEQVRFID0gMiwKICAgICAgICBIT1VSID0gMywKICAgICAgICBNSU5VVEUgPSA0LAogICAgICAgIFNFQ09ORCA9IDUsCiAgICAgICAgTUlMTElTRUNPTkQgPSA2LAoKICAgICAgICAvLyBpbnRlcm5hbCBzdG9yYWdlIGZvciBsYW5ndWFnZSBjb25maWcgZmlsZXMKICAgICAgICBsYW5ndWFnZXMgPSB7fSwKCiAgICAgICAgLy8gbW9tZW50IGludGVybmFsIHByb3BlcnRpZXMKICAgICAgICBtb21lbnRQcm9wZXJ0aWVzID0gewogICAgICAgICAgICBfaXNBTW9tZW50T2JqZWN0OiBudWxsLAogICAgICAgICAgICBfaSA6IG51bGwsCiAgICAgICAgICAgIF9mIDogbnVsbCwKICAgICAgICAgICAgX2wgOiBudWxsLAogICAgICAgICAgICBfc3RyaWN0IDogbnVsbCwKICAgICAgICAgICAgX2lzVVRDIDogbnVsbCwKICAgICAgICAgICAgX29mZnNldCA6IG51bGwsICAvLyBvcHRpb25hbC4gQ29tYmluZSB3aXRoIF9pc1VUQwogICAgICAgICAgICBfcGYgOiBudWxsLAogICAgICAgICAgICBfbGFuZyA6IG51bGwgIC8vIG9wdGlvbmFsCiAgICAgICAgfSwKCiAgICAgICAgLy8gY2hlY2sgZm9yIG5vZGVKUwogICAgICAgIGhhc01vZHVsZSA9ICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyAmJiBtb2R1bGUuZXhwb3J0cyksCgogICAgICAgIC8vIEFTUC5ORVQganNvbiBkYXRlIGZvcm1hdCByZWdleAogICAgICAgIGFzcE5ldEpzb25SZWdleCA9IC9eXC8/RGF0ZVwoKFwtP1xkKykvaSwKICAgICAgICBhc3BOZXRUaW1lU3Bhbkpzb25SZWdleCA9IC8oXC0pPyg/OihcZCopXC4pPyhcZCspXDooXGQrKSg/Olw6KFxkKylcLj8oXGR7M30pPyk/LywKCiAgICAgICAgLy8gZnJvbSBodHRwOi8vZG9jcy5jbG9zdXJlLWxpYnJhcnkuZ29vZ2xlY29kZS5jb20vZ2l0L2Nsb3N1cmVfZ29vZ19kYXRlX2RhdGUuanMuc291cmNlLmh0bWwKICAgICAgICAvLyBzb21ld2hhdCBtb3JlIGluIGxpbmUgd2l0aCA0LjQuMy4yIDIwMDQgc3BlYywgYnV0IGFsbG93cyBkZWNpbWFsIGFueXdoZXJlCiAgICAgICAgaXNvRHVyYXRpb25SZWdleCA9IC9eKC0pP1AoPzooPzooWzAtOSwuXSopWSk/KD86KFswLTksLl0qKU0pPyg/OihbMC05LC5dKilEKT8oPzpUKD86KFswLTksLl0qKUgpPyg/OihbMC05LC5dKilNKT8oPzooWzAtOSwuXSopUyk/KT98KFswLTksLl0qKVcpJC8sCgogICAgICAgIC8vIGZvcm1hdCB0b2tlbnMKICAgICAgICBmb3JtYXR0aW5nVG9rZW5zID0gLyhcW1teXFtdKlxdKXwoXFwpPyhNb3xNTT9NP00/fERvfERERG98REQ/RD9EP3xkZGQ/ZD98ZG8/fHdbb3x3XT98V1tvfFddP3xRfFlZWVlZWXxZWVlZWXxZWVlZfFlZfGdnKGdnZz8pP3xHRyhHR0c/KT98ZXxFfGF8QXxoaD98SEg/fG1tP3xzcz98U3sxLDR9fFh8eno/fFpaP3wuKS9nLAogICAgICAgIGxvY2FsRm9ybWF0dGluZ1Rva2VucyA9IC8oXFtbXlxbXSpcXSl8KFxcKT8oTFR8TEw/TD9MP3xsezEsNH0pL2csCgogICAgICAgIC8vIHBhcnNpbmcgdG9rZW4gcmVnZXhlcwogICAgICAgIHBhcnNlVG9rZW5PbmVPclR3b0RpZ2l0cyA9IC9cZFxkPy8sIC8vIDAgLSA5OQogICAgICAgIHBhcnNlVG9rZW5PbmVUb1RocmVlRGlnaXRzID0gL1xkezEsM30vLCAvLyAwIC0gOTk5CiAgICAgICAgcGFyc2VUb2tlbk9uZVRvRm91ckRpZ2l0cyA9IC9cZHsxLDR9LywgLy8gMCAtIDk5OTkKICAgICAgICBwYXJzZVRva2VuT25lVG9TaXhEaWdpdHMgPSAvWytcLV0/XGR7MSw2fS8sIC8vIC05OTksOTk5IC0gOTk5LDk5OQogICAgICAgIHBhcnNlVG9rZW5EaWdpdHMgPSAvXGQrLywgLy8gbm9uemVybyBudW1iZXIgb2YgZGlnaXRzCiAgICAgICAgcGFyc2VUb2tlbldvcmQgPSAvWzAtOV0qWydhLXpcdTAwQTAtXHUwNUZGXHUwNzAwLVx1RDdGRlx1RjkwMC1cdUZEQ0ZcdUZERjAtXHVGRkVGXSt8W1x1MDYwMC1cdTA2RkZcL10rKFxzKj9bXHUwNjAwLVx1MDZGRl0rKXsxLDJ9L2ksIC8vIGFueSB3b3JkIChvciB0d28pIGNoYXJhY3RlcnMgb3IgbnVtYmVycyBpbmNsdWRpbmcgdHdvL3RocmVlIHdvcmQgbW9udGggaW4gYXJhYmljLgogICAgICAgIHBhcnNlVG9rZW5UaW1lem9uZSA9IC9afFtcK1wtXVxkXGQ6P1xkXGQvZ2ksIC8vICswMDowMCAtMDA6MDAgKzAwMDAgLTAwMDAgb3IgWgogICAgICAgIHBhcnNlVG9rZW5UID0gL1QvaSwgLy8gVCAoSVNPIHNlcGFyYXRvcikKICAgICAgICBwYXJzZVRva2VuVGltZXN0YW1wTXMgPSAvW1wrXC1dP1xkKyhcLlxkezEsM30pPy8sIC8vIDEyMzQ1Njc4OSAxMjM0NTY3ODkuMTIzCiAgICAgICAgcGFyc2VUb2tlbk9yZGluYWwgPSAvXGR7MSwyfS8sCgogICAgICAgIC8vc3RyaWN0IHBhcnNpbmcgcmVnZXhlcwogICAgICAgIHBhcnNlVG9rZW5PbmVEaWdpdCA9IC9cZC8sIC8vIDAgLSA5CiAgICAgICAgcGFyc2VUb2tlblR3b0RpZ2l0cyA9IC9cZFxkLywgLy8gMDAgLSA5OQogICAgICAgIHBhcnNlVG9rZW5UaHJlZURpZ2l0cyA9IC9cZHszfS8sIC8vIDAwMCAtIDk5OQogICAgICAgIHBhcnNlVG9rZW5Gb3VyRGlnaXRzID0gL1xkezR9LywgLy8gMDAwMCAtIDk5OTkKICAgICAgICBwYXJzZVRva2VuU2l4RGlnaXRzID0gL1srLV0/XGR7Nn0vLCAvLyAtOTk5LDk5OSAtIDk5OSw5OTkKICAgICAgICBwYXJzZVRva2VuU2lnbmVkTnVtYmVyID0gL1srLV0/XGQrLywgLy8gLWluZiAtIGluZgoKICAgICAgICAvLyBpc28gODYwMSByZWdleAogICAgICAgIC8vIDAwMDAtMDAtMDAgMDAwMC1XMDAgb3IgMDAwMC1XMDAtMCArIFQgKyAwMCBvciAwMDowMCBvciAwMDowMDowMCBvciAwMDowMDowMC4wMDAgKyArMDA6MDAgb3IgKzAwMDAgb3IgKzAwKQogICAgICAgIGlzb1JlZ2V4ID0gL15ccyooPzpbKy1dXGR7Nn18XGR7NH0pLSg/OihcZFxkLVxkXGQpfChXXGRcZCQpfChXXGRcZC1cZCl8KFxkXGRcZCkpKChUfCApKFxkXGQoOlxkXGQoOlxkXGQoXC5cZCspPyk/KT8pPyhbXCtcLV1cZFxkKD86Oj9cZFxkKT98XHMqWik/KT8kLywKCiAgICAgICAgaXNvRm9ybWF0ID0gJ1lZWVktTU0tRERUSEg6bW06c3NaJywKCiAgICAgICAgaXNvRGF0ZXMgPSBbCiAgICAgICAgICAgIFsnWVlZWVlZLU1NLUREJywgL1srLV1cZHs2fS1cZHsyfS1cZHsyfS9dLAogICAgICAgICAgICBbJ1lZWVktTU0tREQnLCAvXGR7NH0tXGR7Mn0tXGR7Mn0vXSwKICAgICAgICAgICAgWydHR0dHLVtXXVdXLUUnLCAvXGR7NH0tV1xkezJ9LVxkL10sCiAgICAgICAgICAgIFsnR0dHRy1bV11XVycsIC9cZHs0fS1XXGR7Mn0vXSwKICAgICAgICAgICAgWydZWVlZLURERCcsIC9cZHs0fS1cZHszfS9dCiAgICAgICAgXSwKCiAgICAgICAgLy8gaXNvIHRpbWUgZm9ybWF0cyBhbmQgcmVnZXhlcwogICAgICAgIGlzb1RpbWVzID0gWwogICAgICAgICAgICBbJ0hIOm1tOnNzLlNTU1MnLCAvKFR8IClcZFxkOlxkXGQ6XGRcZFwuXGQrL10sCiAgICAgICAgICAgIFsnSEg6bW06c3MnLCAvKFR8IClcZFxkOlxkXGQ6XGRcZC9dLAogICAgICAgICAgICBbJ0hIOm1tJywgLyhUfCApXGRcZDpcZFxkL10sCiAgICAgICAgICAgIFsnSEgnLCAvKFR8IClcZFxkL10KICAgICAgICBdLAoKICAgICAgICAvLyB0aW1lem9uZSBjaHVua2VyICIrMTA6MDAiID4gWyIxMCIsICIwMCJdIG9yICItMTUzMCIgPiBbIi0xNSIsICIzMCJdCiAgICAgICAgcGFyc2VUaW1lem9uZUNodW5rZXIgPSAvKFtcK1wtXXxcZFxkKS9naSwKCiAgICAgICAgLy8gZ2V0dGVyIGFuZCBzZXR0ZXIgbmFtZXMKICAgICAgICBwcm94eUdldHRlcnNBbmRTZXR0ZXJzID0gJ0RhdGV8SG91cnN8TWludXRlc3xTZWNvbmRzfE1pbGxpc2Vjb25kcycuc3BsaXQoJ3wnKSwKICAgICAgICB1bml0TWlsbGlzZWNvbmRGYWN0b3JzID0gewogICAgICAgICAgICAnTWlsbGlzZWNvbmRzJyA6IDEsCiAgICAgICAgICAgICdTZWNvbmRzJyA6IDFlMywKICAgICAgICAgICAgJ01pbnV0ZXMnIDogNmU0LAogICAgICAgICAgICAnSG91cnMnIDogMzZlNSwKICAgICAgICAgICAgJ0RheXMnIDogODY0ZTUsCiAgICAgICAgICAgICdNb250aHMnIDogMjU5MmU2LAogICAgICAgICAgICAnWWVhcnMnIDogMzE1MzZlNgogICAgICAgIH0sCgogICAgICAgIHVuaXRBbGlhc2VzID0gewogICAgICAgICAgICBtcyA6ICdtaWxsaXNlY29uZCcsCiAgICAgICAgICAgIHMgOiAnc2Vjb25kJywKICAgICAgICAgICAgbSA6ICdtaW51dGUnLAogICAgICAgICAgICBoIDogJ2hvdXInLAogICAgICAgICAgICBkIDogJ2RheScsCiAgICAgICAgICAgIEQgOiAnZGF0ZScsCiAgICAgICAgICAgIHcgOiAnd2VlaycsCiAgICAgICAgICAgIFcgOiAnaXNvV2VlaycsCiAgICAgICAgICAgIE0gOiAnbW9udGgnLAogICAgICAgICAgICBRIDogJ3F1YXJ0ZXInLAogICAgICAgICAgICB5IDogJ3llYXInLAogICAgICAgICAgICBEREQgOiAnZGF5T2ZZZWFyJywKICAgICAgICAgICAgZSA6ICd3ZWVrZGF5JywKICAgICAgICAgICAgRSA6ICdpc29XZWVrZGF5JywKICAgICAgICAgICAgZ2c6ICd3ZWVrWWVhcicsCiAgICAgICAgICAgIEdHOiAnaXNvV2Vla1llYXInCiAgICAgICAgfSwKCiAgICAgICAgY2FtZWxGdW5jdGlvbnMgPSB7CiAgICAgICAgICAgIGRheW9meWVhciA6ICdkYXlPZlllYXInLAogICAgICAgICAgICBpc293ZWVrZGF5IDogJ2lzb1dlZWtkYXknLAogICAgICAgICAgICBpc293ZWVrIDogJ2lzb1dlZWsnLAogICAgICAgICAgICB3ZWVreWVhciA6ICd3ZWVrWWVhcicsCiAgICAgICAgICAgIGlzb3dlZWt5ZWFyIDogJ2lzb1dlZWtZZWFyJwogICAgICAgIH0sCgogICAgICAgIC8vIGZvcm1hdCBmdW5jdGlvbiBzdHJpbmdzCiAgICAgICAgZm9ybWF0RnVuY3Rpb25zID0ge30sCgogICAgICAgIC8vIHRva2VucyB0byBvcmRpbmFsaXplIGFuZCBwYWQKICAgICAgICBvcmRpbmFsaXplVG9rZW5zID0gJ0RERCB3IFcgTSBEIGQnLnNwbGl0KCcgJyksCiAgICAgICAgcGFkZGVkVG9rZW5zID0gJ00gRCBIIGggbSBzIHcgVycuc3BsaXQoJyAnKSwKCiAgICAgICAgZm9ybWF0VG9rZW5GdW5jdGlvbnMgPSB7CiAgICAgICAgICAgIE0gICAgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5tb250aCgpICsgMTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgTU1NICA6IGZ1bmN0aW9uIChmb3JtYXQpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmxhbmcoKS5tb250aHNTaG9ydCh0aGlzLCBmb3JtYXQpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBNTU1NIDogZnVuY3Rpb24gKGZvcm1hdCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubGFuZygpLm1vbnRocyh0aGlzLCBmb3JtYXQpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBEICAgIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGF0ZSgpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBEREQgIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGF5T2ZZZWFyKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGQgICAgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5kYXkoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZGQgICA6IGZ1bmN0aW9uIChmb3JtYXQpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmxhbmcoKS53ZWVrZGF5c01pbih0aGlzLCBmb3JtYXQpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBkZGQgIDogZnVuY3Rpb24gKGZvcm1hdCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubGFuZygpLndlZWtkYXlzU2hvcnQodGhpcywgZm9ybWF0KTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZGRkZCA6IGZ1bmN0aW9uIChmb3JtYXQpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmxhbmcoKS53ZWVrZGF5cyh0aGlzLCBmb3JtYXQpOwogICAgICAgICAgICB9LAogICAgICAgICAgICB3ICAgIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMud2VlaygpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBXICAgIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaXNvV2VlaygpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBZWSAgIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGxlZnRaZXJvRmlsbCh0aGlzLnllYXIoKSAlIDEwMCwgMik7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFlZWVkgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbGVmdFplcm9GaWxsKHRoaXMueWVhcigpLCA0KTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgWVlZWVkgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbGVmdFplcm9GaWxsKHRoaXMueWVhcigpLCA1KTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgWVlZWVlZIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIHkgPSB0aGlzLnllYXIoKSwgc2lnbiA9IHkgPj0gMCA/ICcrJyA6ICctJzsKICAgICAgICAgICAgICAgIHJldHVybiBzaWduICsgbGVmdFplcm9GaWxsKE1hdGguYWJzKHkpLCA2KTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZ2cgICA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBsZWZ0WmVyb0ZpbGwodGhpcy53ZWVrWWVhcigpICUgMTAwLCAyKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZ2dnZyA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBsZWZ0WmVyb0ZpbGwodGhpcy53ZWVrWWVhcigpLCA0KTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZ2dnZ2cgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbGVmdFplcm9GaWxsKHRoaXMud2Vla1llYXIoKSwgNSk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIEdHICAgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbGVmdFplcm9GaWxsKHRoaXMuaXNvV2Vla1llYXIoKSAlIDEwMCwgMik7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIEdHR0cgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbGVmdFplcm9GaWxsKHRoaXMuaXNvV2Vla1llYXIoKSwgNCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIEdHR0dHIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGxlZnRaZXJvRmlsbCh0aGlzLmlzb1dlZWtZZWFyKCksIDUpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBlIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMud2Vla2RheSgpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBFIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaXNvV2Vla2RheSgpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBhICAgIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubGFuZygpLm1lcmlkaWVtKHRoaXMuaG91cnMoKSwgdGhpcy5taW51dGVzKCksIHRydWUpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBBICAgIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubGFuZygpLm1lcmlkaWVtKHRoaXMuaG91cnMoKSwgdGhpcy5taW51dGVzKCksIGZhbHNlKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgSCAgICA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmhvdXJzKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGggICAgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5ob3VycygpICUgMTIgfHwgMTI7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG0gICAgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5taW51dGVzKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHMgICAgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zZWNvbmRzKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFMgICAgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdG9JbnQodGhpcy5taWxsaXNlY29uZHMoKSAvIDEwMCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFNTICAgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbGVmdFplcm9GaWxsKHRvSW50KHRoaXMubWlsbGlzZWNvbmRzKCkgLyAxMCksIDIpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBTU1MgIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGxlZnRaZXJvRmlsbCh0aGlzLm1pbGxpc2Vjb25kcygpLCAzKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgU1NTUyA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBsZWZ0WmVyb0ZpbGwodGhpcy5taWxsaXNlY29uZHMoKSwgMyk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFogICAgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB2YXIgYSA9IC10aGlzLnpvbmUoKSwKICAgICAgICAgICAgICAgICAgICBiID0gIisiOwogICAgICAgICAgICAgICAgaWYgKGEgPCAwKSB7CiAgICAgICAgICAgICAgICAgICAgYSA9IC1hOwogICAgICAgICAgICAgICAgICAgIGIgPSAiLSI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gYiArIGxlZnRaZXJvRmlsbCh0b0ludChhIC8gNjApLCAyKSArICI6IiArIGxlZnRaZXJvRmlsbCh0b0ludChhKSAlIDYwLCAyKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgWlogICA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBhID0gLXRoaXMuem9uZSgpLAogICAgICAgICAgICAgICAgICAgIGIgPSAiKyI7CiAgICAgICAgICAgICAgICBpZiAoYSA8IDApIHsKICAgICAgICAgICAgICAgICAgICBhID0gLWE7CiAgICAgICAgICAgICAgICAgICAgYiA9ICItIjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBiICsgbGVmdFplcm9GaWxsKHRvSW50KGEgLyA2MCksIDIpICsgbGVmdFplcm9GaWxsKHRvSW50KGEpICUgNjAsIDIpOwogICAgICAgICAgICB9LAogICAgICAgICAgICB6IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuem9uZUFiYnIoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgenogOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy56b25lTmFtZSgpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBYICAgIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMudW5peCgpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBRIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucXVhcnRlcigpOwogICAgICAgICAgICB9CiAgICAgICAgfSwKCiAgICAgICAgbGlzdHMgPSBbJ21vbnRocycsICdtb250aHNTaG9ydCcsICd3ZWVrZGF5cycsICd3ZWVrZGF5c1Nob3J0JywgJ3dlZWtkYXlzTWluJ107CgogICAgZnVuY3Rpb24gZGVmYXVsdFBhcnNpbmdGbGFncygpIHsKICAgICAgICAvLyBXZSBuZWVkIHRvIGRlZXAgY2xvbmUgdGhpcyBvYmplY3QsIGFuZCBlczUgc3RhbmRhcmQgaXMgbm90IHZlcnkKICAgICAgICAvLyBoZWxwZnVsLgogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGVtcHR5IDogZmFsc2UsCiAgICAgICAgICAgIHVudXNlZFRva2VucyA6IFtdLAogICAgICAgICAgICB1bnVzZWRJbnB1dCA6IFtdLAogICAgICAgICAgICBvdmVyZmxvdyA6IC0yLAogICAgICAgICAgICBjaGFyc0xlZnRPdmVyIDogMCwKICAgICAgICAgICAgbnVsbElucHV0IDogZmFsc2UsCiAgICAgICAgICAgIGludmFsaWRNb250aCA6IG51bGwsCiAgICAgICAgICAgIGludmFsaWRGb3JtYXQgOiBmYWxzZSwKICAgICAgICAgICAgdXNlckludmFsaWRhdGVkIDogZmFsc2UsCiAgICAgICAgICAgIGlzbzogZmFsc2UKICAgICAgICB9OwogICAgfQoKICAgIGZ1bmN0aW9uIGRlcHJlY2F0ZShtc2csIGZuKSB7CiAgICAgICAgdmFyIGZpcnN0VGltZSA9IHRydWU7CiAgICAgICAgZnVuY3Rpb24gcHJpbnRNc2coKSB7CiAgICAgICAgICAgIGlmIChtb21lbnQuc3VwcHJlc3NEZXByZWNhdGlvbldhcm5pbmdzID09PSBmYWxzZSAmJgogICAgICAgICAgICAgICAgICAgIHR5cGVvZiBjb25zb2xlICE9PSAndW5kZWZpbmVkJyAmJiBjb25zb2xlLndhcm4pIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybigiRGVwcmVjYXRpb24gd2FybmluZzogIiArIG1zZyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGV4dGVuZChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGlmIChmaXJzdFRpbWUpIHsKICAgICAgICAgICAgICAgIHByaW50TXNnKCk7CiAgICAgICAgICAgICAgICBmaXJzdFRpbWUgPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZm4uYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICB9LCBmbik7CiAgICB9CgogICAgZnVuY3Rpb24gcGFkVG9rZW4oZnVuYywgY291bnQpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgcmV0dXJuIGxlZnRaZXJvRmlsbChmdW5jLmNhbGwodGhpcywgYSksIGNvdW50KTsKICAgICAgICB9OwogICAgfQogICAgZnVuY3Rpb24gb3JkaW5hbGl6ZVRva2VuKGZ1bmMsIHBlcmlvZCkgewogICAgICAgIHJldHVybiBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5sYW5nKCkub3JkaW5hbChmdW5jLmNhbGwodGhpcywgYSksIHBlcmlvZCk7CiAgICAgICAgfTsKICAgIH0KCiAgICB3aGlsZSAob3JkaW5hbGl6ZVRva2Vucy5sZW5ndGgpIHsKICAgICAgICBpID0gb3JkaW5hbGl6ZVRva2Vucy5wb3AoKTsKICAgICAgICBmb3JtYXRUb2tlbkZ1bmN0aW9uc1tpICsgJ28nXSA9IG9yZGluYWxpemVUb2tlbihmb3JtYXRUb2tlbkZ1bmN0aW9uc1tpXSwgaSk7CiAgICB9CiAgICB3aGlsZSAocGFkZGVkVG9rZW5zLmxlbmd0aCkgewogICAgICAgIGkgPSBwYWRkZWRUb2tlbnMucG9wKCk7CiAgICAgICAgZm9ybWF0VG9rZW5GdW5jdGlvbnNbaSArIGldID0gcGFkVG9rZW4oZm9ybWF0VG9rZW5GdW5jdGlvbnNbaV0sIDIpOwogICAgfQogICAgZm9ybWF0VG9rZW5GdW5jdGlvbnMuRERERCA9IHBhZFRva2VuKGZvcm1hdFRva2VuRnVuY3Rpb25zLkRERCwgMyk7CgoKICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAgICAgICBDb25zdHJ1Y3RvcnMKICAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCiAgICBmdW5jdGlvbiBMYW5ndWFnZSgpIHsKCiAgICB9CgogICAgLy8gTW9tZW50IHByb3RvdHlwZSBvYmplY3QKICAgIGZ1bmN0aW9uIE1vbWVudChjb25maWcpIHsKICAgICAgICBjaGVja092ZXJmbG93KGNvbmZpZyk7CiAgICAgICAgZXh0ZW5kKHRoaXMsIGNvbmZpZyk7CiAgICB9CgogICAgLy8gRHVyYXRpb24gQ29uc3RydWN0b3IKICAgIGZ1bmN0aW9uIER1cmF0aW9uKGR1cmF0aW9uKSB7CiAgICAgICAgdmFyIG5vcm1hbGl6ZWRJbnB1dCA9IG5vcm1hbGl6ZU9iamVjdFVuaXRzKGR1cmF0aW9uKSwKICAgICAgICAgICAgeWVhcnMgPSBub3JtYWxpemVkSW5wdXQueWVhciB8fCAwLAogICAgICAgICAgICBxdWFydGVycyA9IG5vcm1hbGl6ZWRJbnB1dC5xdWFydGVyIHx8IDAsCiAgICAgICAgICAgIG1vbnRocyA9IG5vcm1hbGl6ZWRJbnB1dC5tb250aCB8fCAwLAogICAgICAgICAgICB3ZWVrcyA9IG5vcm1hbGl6ZWRJbnB1dC53ZWVrIHx8IDAsCiAgICAgICAgICAgIGRheXMgPSBub3JtYWxpemVkSW5wdXQuZGF5IHx8IDAsCiAgICAgICAgICAgIGhvdXJzID0gbm9ybWFsaXplZElucHV0LmhvdXIgfHwgMCwKICAgICAgICAgICAgbWludXRlcyA9IG5vcm1hbGl6ZWRJbnB1dC5taW51dGUgfHwgMCwKICAgICAgICAgICAgc2Vjb25kcyA9IG5vcm1hbGl6ZWRJbnB1dC5zZWNvbmQgfHwgMCwKICAgICAgICAgICAgbWlsbGlzZWNvbmRzID0gbm9ybWFsaXplZElucHV0Lm1pbGxpc2Vjb25kIHx8IDA7CgogICAgICAgIC8vIHJlcHJlc2VudGF0aW9uIGZvciBkYXRlQWRkUmVtb3ZlCiAgICAgICAgdGhpcy5fbWlsbGlzZWNvbmRzID0gK21pbGxpc2Vjb25kcyArCiAgICAgICAgICAgIHNlY29uZHMgKiAxZTMgKyAvLyAxMDAwCiAgICAgICAgICAgIG1pbnV0ZXMgKiA2ZTQgKyAvLyAxMDAwICogNjAKICAgICAgICAgICAgaG91cnMgKiAzNmU1OyAvLyAxMDAwICogNjAgKiA2MAogICAgICAgIC8vIEJlY2F1c2Ugb2YgZGF0ZUFkZFJlbW92ZSB0cmVhdHMgMjQgaG91cnMgYXMgZGlmZmVyZW50IGZyb20gYQogICAgICAgIC8vIGRheSB3aGVuIHdvcmtpbmcgYXJvdW5kIERTVCwgd2UgbmVlZCB0byBzdG9yZSB0aGVtIHNlcGFyYXRlbHkKICAgICAgICB0aGlzLl9kYXlzID0gK2RheXMgKwogICAgICAgICAgICB3ZWVrcyAqIDc7CiAgICAgICAgLy8gSXQgaXMgaW1wb3NzaWJsZSB0cmFuc2xhdGUgbW9udGhzIGludG8gZGF5cyB3aXRob3V0IGtub3dpbmcKICAgICAgICAvLyB3aGljaCBtb250aHMgeW91IGFyZSBhcmUgdGFsa2luZyBhYm91dCwgc28gd2UgaGF2ZSB0byBzdG9yZQogICAgICAgIC8vIGl0IHNlcGFyYXRlbHkuCiAgICAgICAgdGhpcy5fbW9udGhzID0gK21vbnRocyArCiAgICAgICAgICAgIHF1YXJ0ZXJzICogMyArCiAgICAgICAgICAgIHllYXJzICogMTI7CgogICAgICAgIHRoaXMuX2RhdGEgPSB7fTsKCiAgICAgICAgdGhpcy5fYnViYmxlKCk7CiAgICB9CgogICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgICAgIEhlbHBlcnMKICAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCgogICAgZnVuY3Rpb24gZXh0ZW5kKGEsIGIpIHsKICAgICAgICBmb3IgKHZhciBpIGluIGIpIHsKICAgICAgICAgICAgaWYgKGIuaGFzT3duUHJvcGVydHkoaSkpIHsKICAgICAgICAgICAgICAgIGFbaV0gPSBiW2ldOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoYi5oYXNPd25Qcm9wZXJ0eSgidG9TdHJpbmciKSkgewogICAgICAgICAgICBhLnRvU3RyaW5nID0gYi50b1N0cmluZzsKICAgICAgICB9CgogICAgICAgIGlmIChiLmhhc093blByb3BlcnR5KCJ2YWx1ZU9mIikpIHsKICAgICAgICAgICAgYS52YWx1ZU9mID0gYi52YWx1ZU9mOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGE7CiAgICB9CgogICAgZnVuY3Rpb24gY2xvbmVNb21lbnQobSkgewogICAgICAgIHZhciByZXN1bHQgPSB7fSwgaTsKICAgICAgICBmb3IgKGkgaW4gbSkgewogICAgICAgICAgICBpZiAobS5oYXNPd25Qcm9wZXJ0eShpKSAmJiBtb21lbnRQcm9wZXJ0aWVzLmhhc093blByb3BlcnR5KGkpKSB7CiAgICAgICAgICAgICAgICByZXN1bHRbaV0gPSBtW2ldOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgfQoKICAgIGZ1bmN0aW9uIGFic1JvdW5kKG51bWJlcikgewogICAgICAgIGlmIChudW1iZXIgPCAwKSB7CiAgICAgICAgICAgIHJldHVybiBNYXRoLmNlaWwobnVtYmVyKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gTWF0aC5mbG9vcihudW1iZXIpOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBsZWZ0IHplcm8gZmlsbCBhIG51bWJlcgogICAgLy8gc2VlIGh0dHA6Ly9qc3BlcmYuY29tL2xlZnQtemVyby1maWxsaW5nIGZvciBwZXJmb3JtYW5jZSBjb21wYXJpc29uCiAgICBmdW5jdGlvbiBsZWZ0WmVyb0ZpbGwobnVtYmVyLCB0YXJnZXRMZW5ndGgsIGZvcmNlU2lnbikgewogICAgICAgIHZhciBvdXRwdXQgPSAnJyArIE1hdGguYWJzKG51bWJlciksCiAgICAgICAgICAgIHNpZ24gPSBudW1iZXIgPj0gMDsKCiAgICAgICAgd2hpbGUgKG91dHB1dC5sZW5ndGggPCB0YXJnZXRMZW5ndGgpIHsKICAgICAgICAgICAgb3V0cHV0ID0gJzAnICsgb3V0cHV0OwogICAgICAgIH0KICAgICAgICByZXR1cm4gKHNpZ24gPyAoZm9yY2VTaWduID8gJysnIDogJycpIDogJy0nKSArIG91dHB1dDsKICAgIH0KCiAgICAvLyBoZWxwZXIgZnVuY3Rpb24gZm9yIF8uYWRkVGltZSBhbmQgXy5zdWJ0cmFjdFRpbWUKICAgIGZ1bmN0aW9uIGFkZE9yU3VidHJhY3REdXJhdGlvbkZyb21Nb21lbnQobW9tLCBkdXJhdGlvbiwgaXNBZGRpbmcsIHVwZGF0ZU9mZnNldCkgewogICAgICAgIHZhciBtaWxsaXNlY29uZHMgPSBkdXJhdGlvbi5fbWlsbGlzZWNvbmRzLAogICAgICAgICAgICBkYXlzID0gZHVyYXRpb24uX2RheXMsCiAgICAgICAgICAgIG1vbnRocyA9IGR1cmF0aW9uLl9tb250aHM7CiAgICAgICAgdXBkYXRlT2Zmc2V0ID0gdXBkYXRlT2Zmc2V0ID09IG51bGwgPyB0cnVlIDogdXBkYXRlT2Zmc2V0OwoKICAgICAgICBpZiAobWlsbGlzZWNvbmRzKSB7CiAgICAgICAgICAgIG1vbS5fZC5zZXRUaW1lKCttb20uX2QgKyBtaWxsaXNlY29uZHMgKiBpc0FkZGluZyk7CiAgICAgICAgfQogICAgICAgIGlmIChkYXlzKSB7CiAgICAgICAgICAgIHJhd1NldHRlcihtb20sICdEYXRlJywgcmF3R2V0dGVyKG1vbSwgJ0RhdGUnKSArIGRheXMgKiBpc0FkZGluZyk7CiAgICAgICAgfQogICAgICAgIGlmIChtb250aHMpIHsKICAgICAgICAgICAgcmF3TW9udGhTZXR0ZXIobW9tLCByYXdHZXR0ZXIobW9tLCAnTW9udGgnKSArIG1vbnRocyAqIGlzQWRkaW5nKTsKICAgICAgICB9CiAgICAgICAgaWYgKHVwZGF0ZU9mZnNldCkgewogICAgICAgICAgICBtb21lbnQudXBkYXRlT2Zmc2V0KG1vbSwgZGF5cyB8fCBtb250aHMpOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBjaGVjayBpZiBpcyBhbiBhcnJheQogICAgZnVuY3Rpb24gaXNBcnJheShpbnB1dCkgewogICAgICAgIHJldHVybiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoaW5wdXQpID09PSAnW29iamVjdCBBcnJheV0nOwogICAgfQoKICAgIGZ1bmN0aW9uIGlzRGF0ZShpbnB1dCkgewogICAgICAgIHJldHVybiAgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGlucHV0KSA9PT0gJ1tvYmplY3QgRGF0ZV0nIHx8CiAgICAgICAgICAgICAgICBpbnB1dCBpbnN0YW5jZW9mIERhdGU7CiAgICB9CgogICAgLy8gY29tcGFyZSB0d28gYXJyYXlzLCByZXR1cm4gdGhlIG51bWJlciBvZiBkaWZmZXJlbmNlcwogICAgZnVuY3Rpb24gY29tcGFyZUFycmF5cyhhcnJheTEsIGFycmF5MiwgZG9udENvbnZlcnQpIHsKICAgICAgICB2YXIgbGVuID0gTWF0aC5taW4oYXJyYXkxLmxlbmd0aCwgYXJyYXkyLmxlbmd0aCksCiAgICAgICAgICAgIGxlbmd0aERpZmYgPSBNYXRoLmFicyhhcnJheTEubGVuZ3RoIC0gYXJyYXkyLmxlbmd0aCksCiAgICAgICAgICAgIGRpZmZzID0gMCwKICAgICAgICAgICAgaTsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgICAgaWYgKChkb250Q29udmVydCAmJiBhcnJheTFbaV0gIT09IGFycmF5MltpXSkgfHwKICAgICAgICAgICAgICAgICghZG9udENvbnZlcnQgJiYgdG9JbnQoYXJyYXkxW2ldKSAhPT0gdG9JbnQoYXJyYXkyW2ldKSkpIHsKICAgICAgICAgICAgICAgIGRpZmZzKys7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGRpZmZzICsgbGVuZ3RoRGlmZjsKICAgIH0KCiAgICBmdW5jdGlvbiBub3JtYWxpemVVbml0cyh1bml0cykgewogICAgICAgIGlmICh1bml0cykgewogICAgICAgICAgICB2YXIgbG93ZXJlZCA9IHVuaXRzLnRvTG93ZXJDYXNlKCkucmVwbGFjZSgvKC4pcyQvLCAnJDEnKTsKICAgICAgICAgICAgdW5pdHMgPSB1bml0QWxpYXNlc1t1bml0c10gfHwgY2FtZWxGdW5jdGlvbnNbbG93ZXJlZF0gfHwgbG93ZXJlZDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHVuaXRzOwogICAgfQoKICAgIGZ1bmN0aW9uIG5vcm1hbGl6ZU9iamVjdFVuaXRzKGlucHV0T2JqZWN0KSB7CiAgICAgICAgdmFyIG5vcm1hbGl6ZWRJbnB1dCA9IHt9LAogICAgICAgICAgICBub3JtYWxpemVkUHJvcCwKICAgICAgICAgICAgcHJvcDsKCiAgICAgICAgZm9yIChwcm9wIGluIGlucHV0T2JqZWN0KSB7CiAgICAgICAgICAgIGlmIChpbnB1dE9iamVjdC5oYXNPd25Qcm9wZXJ0eShwcm9wKSkgewogICAgICAgICAgICAgICAgbm9ybWFsaXplZFByb3AgPSBub3JtYWxpemVVbml0cyhwcm9wKTsKICAgICAgICAgICAgICAgIGlmIChub3JtYWxpemVkUHJvcCkgewogICAgICAgICAgICAgICAgICAgIG5vcm1hbGl6ZWRJbnB1dFtub3JtYWxpemVkUHJvcF0gPSBpbnB1dE9iamVjdFtwcm9wXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG5vcm1hbGl6ZWRJbnB1dDsKICAgIH0KCiAgICBmdW5jdGlvbiBtYWtlTGlzdChmaWVsZCkgewogICAgICAgIHZhciBjb3VudCwgc2V0dGVyOwoKICAgICAgICBpZiAoZmllbGQuaW5kZXhPZignd2VlaycpID09PSAwKSB7CiAgICAgICAgICAgIGNvdW50ID0gNzsKICAgICAgICAgICAgc2V0dGVyID0gJ2RheSc7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKGZpZWxkLmluZGV4T2YoJ21vbnRoJykgPT09IDApIHsKICAgICAgICAgICAgY291bnQgPSAxMjsKICAgICAgICAgICAgc2V0dGVyID0gJ21vbnRoJzsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIG1vbWVudFtmaWVsZF0gPSBmdW5jdGlvbiAoZm9ybWF0LCBpbmRleCkgewogICAgICAgICAgICB2YXIgaSwgZ2V0dGVyLAogICAgICAgICAgICAgICAgbWV0aG9kID0gbW9tZW50LmZuLl9sYW5nW2ZpZWxkXSwKICAgICAgICAgICAgICAgIHJlc3VsdHMgPSBbXTsKCiAgICAgICAgICAgIGlmICh0eXBlb2YgZm9ybWF0ID09PSAnbnVtYmVyJykgewogICAgICAgICAgICAgICAgaW5kZXggPSBmb3JtYXQ7CiAgICAgICAgICAgICAgICBmb3JtYXQgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGdldHRlciA9IGZ1bmN0aW9uIChpKSB7CiAgICAgICAgICAgICAgICB2YXIgbSA9IG1vbWVudCgpLnV0YygpLnNldChzZXR0ZXIsIGkpOwogICAgICAgICAgICAgICAgcmV0dXJuIG1ldGhvZC5jYWxsKG1vbWVudC5mbi5fbGFuZywgbSwgZm9ybWF0IHx8ICcnKTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIGlmIChpbmRleCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0dGVyKGluZGV4KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0cy5wdXNoKGdldHRlcihpKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0czsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICB9CgogICAgZnVuY3Rpb24gdG9JbnQoYXJndW1lbnRGb3JDb2VyY2lvbikgewogICAgICAgIHZhciBjb2VyY2VkTnVtYmVyID0gK2FyZ3VtZW50Rm9yQ29lcmNpb24sCiAgICAgICAgICAgIHZhbHVlID0gMDsKCiAgICAgICAgaWYgKGNvZXJjZWROdW1iZXIgIT09IDAgJiYgaXNGaW5pdGUoY29lcmNlZE51bWJlcikpIHsKICAgICAgICAgICAgaWYgKGNvZXJjZWROdW1iZXIgPj0gMCkgewogICAgICAgICAgICAgICAgdmFsdWUgPSBNYXRoLmZsb29yKGNvZXJjZWROdW1iZXIpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdmFsdWUgPSBNYXRoLmNlaWwoY29lcmNlZE51bWJlcik7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBkYXlzSW5Nb250aCh5ZWFyLCBtb250aCkgewogICAgICAgIHJldHVybiBuZXcgRGF0ZShEYXRlLlVUQyh5ZWFyLCBtb250aCArIDEsIDApKS5nZXRVVENEYXRlKCk7CiAgICB9CgogICAgZnVuY3Rpb24gd2Vla3NJblllYXIoeWVhciwgZG93LCBkb3kpIHsKICAgICAgICByZXR1cm4gd2Vla09mWWVhcihtb21lbnQoW3llYXIsIDExLCAzMSArIGRvdyAtIGRveV0pLCBkb3csIGRveSkud2VlazsKICAgIH0KCiAgICBmdW5jdGlvbiBkYXlzSW5ZZWFyKHllYXIpIHsKICAgICAgICByZXR1cm4gaXNMZWFwWWVhcih5ZWFyKSA/IDM2NiA6IDM2NTsKICAgIH0KCiAgICBmdW5jdGlvbiBpc0xlYXBZZWFyKHllYXIpIHsKICAgICAgICByZXR1cm4gKHllYXIgJSA0ID09PSAwICYmIHllYXIgJSAxMDAgIT09IDApIHx8IHllYXIgJSA0MDAgPT09IDA7CiAgICB9CgogICAgZnVuY3Rpb24gY2hlY2tPdmVyZmxvdyhtKSB7CiAgICAgICAgdmFyIG92ZXJmbG93OwogICAgICAgIGlmIChtLl9hICYmIG0uX3BmLm92ZXJmbG93ID09PSAtMikgewogICAgICAgICAgICBvdmVyZmxvdyA9CiAgICAgICAgICAgICAgICBtLl9hW01PTlRIXSA8IDAgfHwgbS5fYVtNT05USF0gPiAxMSA/IE1PTlRIIDoKICAgICAgICAgICAgICAgIG0uX2FbREFURV0gPCAxIHx8IG0uX2FbREFURV0gPiBkYXlzSW5Nb250aChtLl9hW1lFQVJdLCBtLl9hW01PTlRIXSkgPyBEQVRFIDoKICAgICAgICAgICAgICAgIG0uX2FbSE9VUl0gPCAwIHx8IG0uX2FbSE9VUl0gPiAyMyA/IEhPVVIgOgogICAgICAgICAgICAgICAgbS5fYVtNSU5VVEVdIDwgMCB8fCBtLl9hW01JTlVURV0gPiA1OSA/IE1JTlVURSA6CiAgICAgICAgICAgICAgICBtLl9hW1NFQ09ORF0gPCAwIHx8IG0uX2FbU0VDT05EXSA+IDU5ID8gU0VDT05EIDoKICAgICAgICAgICAgICAgIG0uX2FbTUlMTElTRUNPTkRdIDwgMCB8fCBtLl9hW01JTExJU0VDT05EXSA+IDk5OSA/IE1JTExJU0VDT05EIDoKICAgICAgICAgICAgICAgIC0xOwoKICAgICAgICAgICAgaWYgKG0uX3BmLl9vdmVyZmxvd0RheU9mWWVhciAmJiAob3ZlcmZsb3cgPCBZRUFSIHx8IG92ZXJmbG93ID4gREFURSkpIHsKICAgICAgICAgICAgICAgIG92ZXJmbG93ID0gREFURTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbS5fcGYub3ZlcmZsb3cgPSBvdmVyZmxvdzsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gaXNWYWxpZChtKSB7CiAgICAgICAgaWYgKG0uX2lzVmFsaWQgPT0gbnVsbCkgewogICAgICAgICAgICBtLl9pc1ZhbGlkID0gIWlzTmFOKG0uX2QuZ2V0VGltZSgpKSAmJgogICAgICAgICAgICAgICAgbS5fcGYub3ZlcmZsb3cgPCAwICYmCiAgICAgICAgICAgICAgICAhbS5fcGYuZW1wdHkgJiYKICAgICAgICAgICAgICAgICFtLl9wZi5pbnZhbGlkTW9udGggJiYKICAgICAgICAgICAgICAgICFtLl9wZi5udWxsSW5wdXQgJiYKICAgICAgICAgICAgICAgICFtLl9wZi5pbnZhbGlkRm9ybWF0ICYmCiAgICAgICAgICAgICAgICAhbS5fcGYudXNlckludmFsaWRhdGVkOwoKICAgICAgICAgICAgaWYgKG0uX3N0cmljdCkgewogICAgICAgICAgICAgICAgbS5faXNWYWxpZCA9IG0uX2lzVmFsaWQgJiYKICAgICAgICAgICAgICAgICAgICBtLl9wZi5jaGFyc0xlZnRPdmVyID09PSAwICYmCiAgICAgICAgICAgICAgICAgICAgbS5fcGYudW51c2VkVG9rZW5zLmxlbmd0aCA9PT0gMDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gbS5faXNWYWxpZDsKICAgIH0KCiAgICBmdW5jdGlvbiBub3JtYWxpemVMYW5ndWFnZShrZXkpIHsKICAgICAgICByZXR1cm4ga2V5ID8ga2V5LnRvTG93ZXJDYXNlKCkucmVwbGFjZSgnXycsICctJykgOiBrZXk7CiAgICB9CgogICAgLy8gUmV0dXJuIGEgbW9tZW50IGZyb20gaW5wdXQsIHRoYXQgaXMgbG9jYWwvdXRjL3pvbmUgZXF1aXZhbGVudCB0byBtb2RlbC4KICAgIGZ1bmN0aW9uIG1ha2VBcyhpbnB1dCwgbW9kZWwpIHsKICAgICAgICByZXR1cm4gbW9kZWwuX2lzVVRDID8gbW9tZW50KGlucHV0KS56b25lKG1vZGVsLl9vZmZzZXQgfHwgMCkgOgogICAgICAgICAgICBtb21lbnQoaW5wdXQpLmxvY2FsKCk7CiAgICB9CgogICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgICAgIExhbmd1YWdlcwogICAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwoKCiAgICBleHRlbmQoTGFuZ3VhZ2UucHJvdG90eXBlLCB7CgogICAgICAgIHNldCA6IGZ1bmN0aW9uIChjb25maWcpIHsKICAgICAgICAgICAgdmFyIHByb3AsIGk7CiAgICAgICAgICAgIGZvciAoaSBpbiBjb25maWcpIHsKICAgICAgICAgICAgICAgIHByb3AgPSBjb25maWdbaV07CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHByb3AgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzW2ldID0gcHJvcDsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpc1snXycgKyBpXSA9IHByb3A7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9LAoKICAgICAgICBfbW9udGhzIDogIkphbnVhcnlfRmVicnVhcnlfTWFyY2hfQXByaWxfTWF5X0p1bmVfSnVseV9BdWd1c3RfU2VwdGVtYmVyX09jdG9iZXJfTm92ZW1iZXJfRGVjZW1iZXIiLnNwbGl0KCJfIiksCiAgICAgICAgbW9udGhzIDogZnVuY3Rpb24gKG0pIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX21vbnRoc1ttLm1vbnRoKCldOwogICAgICAgIH0sCgogICAgICAgIF9tb250aHNTaG9ydCA6ICJKYW5fRmViX01hcl9BcHJfTWF5X0p1bl9KdWxfQXVnX1NlcF9PY3RfTm92X0RlYyIuc3BsaXQoIl8iKSwKICAgICAgICBtb250aHNTaG9ydCA6IGZ1bmN0aW9uIChtKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9tb250aHNTaG9ydFttLm1vbnRoKCldOwogICAgICAgIH0sCgogICAgICAgIG1vbnRoc1BhcnNlIDogZnVuY3Rpb24gKG1vbnRoTmFtZSkgewogICAgICAgICAgICB2YXIgaSwgbW9tLCByZWdleDsKCiAgICAgICAgICAgIGlmICghdGhpcy5fbW9udGhzUGFyc2UpIHsKICAgICAgICAgICAgICAgIHRoaXMuX21vbnRoc1BhcnNlID0gW107CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCAxMjsgaSsrKSB7CiAgICAgICAgICAgICAgICAvLyBtYWtlIHRoZSByZWdleCBpZiB3ZSBkb24ndCBoYXZlIGl0IGFscmVhZHkKICAgICAgICAgICAgICAgIGlmICghdGhpcy5fbW9udGhzUGFyc2VbaV0pIHsKICAgICAgICAgICAgICAgICAgICBtb20gPSBtb21lbnQudXRjKFsyMDAwLCBpXSk7CiAgICAgICAgICAgICAgICAgICAgcmVnZXggPSAnXicgKyB0aGlzLm1vbnRocyhtb20sICcnKSArICd8XicgKyB0aGlzLm1vbnRoc1Nob3J0KG1vbSwgJycpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX21vbnRoc1BhcnNlW2ldID0gbmV3IFJlZ0V4cChyZWdleC5yZXBsYWNlKCcuJywgJycpLCAnaScpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy8gdGVzdCB0aGUgcmVnZXgKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9tb250aHNQYXJzZVtpXS50ZXN0KG1vbnRoTmFtZSkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0sCgogICAgICAgIF93ZWVrZGF5cyA6ICJTdW5kYXlfTW9uZGF5X1R1ZXNkYXlfV2VkbmVzZGF5X1RodXJzZGF5X0ZyaWRheV9TYXR1cmRheSIuc3BsaXQoIl8iKSwKICAgICAgICB3ZWVrZGF5cyA6IGZ1bmN0aW9uIChtKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl93ZWVrZGF5c1ttLmRheSgpXTsKICAgICAgICB9LAoKICAgICAgICBfd2Vla2RheXNTaG9ydCA6ICJTdW5fTW9uX1R1ZV9XZWRfVGh1X0ZyaV9TYXQiLnNwbGl0KCJfIiksCiAgICAgICAgd2Vla2RheXNTaG9ydCA6IGZ1bmN0aW9uIChtKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl93ZWVrZGF5c1Nob3J0W20uZGF5KCldOwogICAgICAgIH0sCgogICAgICAgIF93ZWVrZGF5c01pbiA6ICJTdV9Nb19UdV9XZV9UaF9Gcl9TYSIuc3BsaXQoIl8iKSwKICAgICAgICB3ZWVrZGF5c01pbiA6IGZ1bmN0aW9uIChtKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl93ZWVrZGF5c01pblttLmRheSgpXTsKICAgICAgICB9LAoKICAgICAgICB3ZWVrZGF5c1BhcnNlIDogZnVuY3Rpb24gKHdlZWtkYXlOYW1lKSB7CiAgICAgICAgICAgIHZhciBpLCBtb20sIHJlZ2V4OwoKICAgICAgICAgICAgaWYgKCF0aGlzLl93ZWVrZGF5c1BhcnNlKSB7CiAgICAgICAgICAgICAgICB0aGlzLl93ZWVrZGF5c1BhcnNlID0gW107CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCA3OyBpKyspIHsKICAgICAgICAgICAgICAgIC8vIG1ha2UgdGhlIHJlZ2V4IGlmIHdlIGRvbid0IGhhdmUgaXQgYWxyZWFkeQogICAgICAgICAgICAgICAgaWYgKCF0aGlzLl93ZWVrZGF5c1BhcnNlW2ldKSB7CiAgICAgICAgICAgICAgICAgICAgbW9tID0gbW9tZW50KFsyMDAwLCAxXSkuZGF5KGkpOwogICAgICAgICAgICAgICAgICAgIHJlZ2V4ID0gJ14nICsgdGhpcy53ZWVrZGF5cyhtb20sICcnKSArICd8XicgKyB0aGlzLndlZWtkYXlzU2hvcnQobW9tLCAnJykgKyAnfF4nICsgdGhpcy53ZWVrZGF5c01pbihtb20sICcnKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl93ZWVrZGF5c1BhcnNlW2ldID0gbmV3IFJlZ0V4cChyZWdleC5yZXBsYWNlKCcuJywgJycpLCAnaScpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy8gdGVzdCB0aGUgcmVnZXgKICAgICAgICAgICAgICAgIGlmICh0aGlzLl93ZWVrZGF5c1BhcnNlW2ldLnRlc3Qod2Vla2RheU5hbWUpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9LAoKICAgICAgICBfbG9uZ0RhdGVGb3JtYXQgOiB7CiAgICAgICAgICAgIExUIDogImg6bW0gQSIsCiAgICAgICAgICAgIEwgOiAiTU0vREQvWVlZWSIsCiAgICAgICAgICAgIExMIDogIk1NTU0gRCBZWVlZIiwKICAgICAgICAgICAgTExMIDogIk1NTU0gRCBZWVlZIExUIiwKICAgICAgICAgICAgTExMTCA6ICJkZGRkLCBNTU1NIEQgWVlZWSBMVCIKICAgICAgICB9LAogICAgICAgIGxvbmdEYXRlRm9ybWF0IDogZnVuY3Rpb24gKGtleSkgewogICAgICAgICAgICB2YXIgb3V0cHV0ID0gdGhpcy5fbG9uZ0RhdGVGb3JtYXRba2V5XTsKICAgICAgICAgICAgaWYgKCFvdXRwdXQgJiYgdGhpcy5fbG9uZ0RhdGVGb3JtYXRba2V5LnRvVXBwZXJDYXNlKCldKSB7CiAgICAgICAgICAgICAgICBvdXRwdXQgPSB0aGlzLl9sb25nRGF0ZUZvcm1hdFtrZXkudG9VcHBlckNhc2UoKV0ucmVwbGFjZSgvTU1NTXxNTXxERHxkZGRkL2csIGZ1bmN0aW9uICh2YWwpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsLnNsaWNlKDEpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB0aGlzLl9sb25nRGF0ZUZvcm1hdFtrZXldID0gb3V0cHV0OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBvdXRwdXQ7CiAgICAgICAgfSwKCiAgICAgICAgaXNQTSA6IGZ1bmN0aW9uIChpbnB1dCkgewogICAgICAgICAgICAvLyBJRTggUXVpcmtzIE1vZGUgJiBJRTcgU3RhbmRhcmRzIE1vZGUgZG8gbm90IGFsbG93IGFjY2Vzc2luZyBzdHJpbmdzIGxpa2UgYXJyYXlzCiAgICAgICAgICAgIC8vIFVzaW5nIGNoYXJBdCBzaG91bGQgYmUgbW9yZSBjb21wYXRpYmxlLgogICAgICAgICAgICByZXR1cm4gKChpbnB1dCArICcnKS50b0xvd2VyQ2FzZSgpLmNoYXJBdCgwKSA9PT0gJ3AnKTsKICAgICAgICB9LAoKICAgICAgICBfbWVyaWRpZW1QYXJzZSA6IC9bYXBdXC4/bT9cLj8vaSwKICAgICAgICBtZXJpZGllbSA6IGZ1bmN0aW9uIChob3VycywgbWludXRlcywgaXNMb3dlcikgewogICAgICAgICAgICBpZiAoaG91cnMgPiAxMSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGlzTG93ZXIgPyAncG0nIDogJ1BNJzsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBpc0xvd2VyID8gJ2FtJyA6ICdBTSc7CiAgICAgICAgICAgIH0KICAgICAgICB9LAoKICAgICAgICBfY2FsZW5kYXIgOiB7CiAgICAgICAgICAgIHNhbWVEYXkgOiAnW1RvZGF5IGF0XSBMVCcsCiAgICAgICAgICAgIG5leHREYXkgOiAnW1RvbW9ycm93IGF0XSBMVCcsCiAgICAgICAgICAgIG5leHRXZWVrIDogJ2RkZGQgW2F0XSBMVCcsCiAgICAgICAgICAgIGxhc3REYXkgOiAnW1llc3RlcmRheSBhdF0gTFQnLAogICAgICAgICAgICBsYXN0V2VlayA6ICdbTGFzdF0gZGRkZCBbYXRdIExUJywKICAgICAgICAgICAgc2FtZUVsc2UgOiAnTCcKICAgICAgICB9LAogICAgICAgIGNhbGVuZGFyIDogZnVuY3Rpb24gKGtleSwgbW9tKSB7CiAgICAgICAgICAgIHZhciBvdXRwdXQgPSB0aGlzLl9jYWxlbmRhcltrZXldOwogICAgICAgICAgICByZXR1cm4gdHlwZW9mIG91dHB1dCA9PT0gJ2Z1bmN0aW9uJyA/IG91dHB1dC5hcHBseShtb20pIDogb3V0cHV0OwogICAgICAgIH0sCgogICAgICAgIF9yZWxhdGl2ZVRpbWUgOiB7CiAgICAgICAgICAgIGZ1dHVyZSA6ICJpbiAlcyIsCiAgICAgICAgICAgIHBhc3QgOiAiJXMgYWdvIiwKICAgICAgICAgICAgcyA6ICJhIGZldyBzZWNvbmRzIiwKICAgICAgICAgICAgbSA6ICJhIG1pbnV0ZSIsCiAgICAgICAgICAgIG1tIDogIiVkIG1pbnV0ZXMiLAogICAgICAgICAgICBoIDogImFuIGhvdXIiLAogICAgICAgICAgICBoaCA6ICIlZCBob3VycyIsCiAgICAgICAgICAgIGQgOiAiYSBkYXkiLAogICAgICAgICAgICBkZCA6ICIlZCBkYXlzIiwKICAgICAgICAgICAgTSA6ICJhIG1vbnRoIiwKICAgICAgICAgICAgTU0gOiAiJWQgbW9udGhzIiwKICAgICAgICAgICAgeSA6ICJhIHllYXIiLAogICAgICAgICAgICB5eSA6ICIlZCB5ZWFycyIKICAgICAgICB9LAogICAgICAgIHJlbGF0aXZlVGltZSA6IGZ1bmN0aW9uIChudW1iZXIsIHdpdGhvdXRTdWZmaXgsIHN0cmluZywgaXNGdXR1cmUpIHsKICAgICAgICAgICAgdmFyIG91dHB1dCA9IHRoaXMuX3JlbGF0aXZlVGltZVtzdHJpbmddOwogICAgICAgICAgICByZXR1cm4gKHR5cGVvZiBvdXRwdXQgPT09ICdmdW5jdGlvbicpID8KICAgICAgICAgICAgICAgIG91dHB1dChudW1iZXIsIHdpdGhvdXRTdWZmaXgsIHN0cmluZywgaXNGdXR1cmUpIDoKICAgICAgICAgICAgICAgIG91dHB1dC5yZXBsYWNlKC8lZC9pLCBudW1iZXIpOwogICAgICAgIH0sCiAgICAgICAgcGFzdEZ1dHVyZSA6IGZ1bmN0aW9uIChkaWZmLCBvdXRwdXQpIHsKICAgICAgICAgICAgdmFyIGZvcm1hdCA9IHRoaXMuX3JlbGF0aXZlVGltZVtkaWZmID4gMCA/ICdmdXR1cmUnIDogJ3Bhc3QnXTsKICAgICAgICAgICAgcmV0dXJuIHR5cGVvZiBmb3JtYXQgPT09ICdmdW5jdGlvbicgPyBmb3JtYXQob3V0cHV0KSA6IGZvcm1hdC5yZXBsYWNlKC8lcy9pLCBvdXRwdXQpOwogICAgICAgIH0sCgogICAgICAgIG9yZGluYWwgOiBmdW5jdGlvbiAobnVtYmVyKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9vcmRpbmFsLnJlcGxhY2UoIiVkIiwgbnVtYmVyKTsKICAgICAgICB9LAogICAgICAgIF9vcmRpbmFsIDogIiVkIiwKCiAgICAgICAgcHJlcGFyc2UgOiBmdW5jdGlvbiAoc3RyaW5nKSB7CiAgICAgICAgICAgIHJldHVybiBzdHJpbmc7CiAgICAgICAgfSwKCiAgICAgICAgcG9zdGZvcm1hdCA6IGZ1bmN0aW9uIChzdHJpbmcpIHsKICAgICAgICAgICAgcmV0dXJuIHN0cmluZzsKICAgICAgICB9LAoKICAgICAgICB3ZWVrIDogZnVuY3Rpb24gKG1vbSkgewogICAgICAgICAgICByZXR1cm4gd2Vla09mWWVhcihtb20sIHRoaXMuX3dlZWsuZG93LCB0aGlzLl93ZWVrLmRveSkud2VlazsKICAgICAgICB9LAoKICAgICAgICBfd2VlayA6IHsKICAgICAgICAgICAgZG93IDogMCwgLy8gU3VuZGF5IGlzIHRoZSBmaXJzdCBkYXkgb2YgdGhlIHdlZWsuCiAgICAgICAgICAgIGRveSA6IDYgIC8vIFRoZSB3ZWVrIHRoYXQgY29udGFpbnMgSmFuIDFzdCBpcyB0aGUgZmlyc3Qgd2VlayBvZiB0aGUgeWVhci4KICAgICAgICB9LAoKICAgICAgICBfaW52YWxpZERhdGU6ICdJbnZhbGlkIGRhdGUnLAogICAgICAgIGludmFsaWREYXRlOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pbnZhbGlkRGF0ZTsKICAgICAgICB9CiAgICB9KTsKCiAgICAvLyBMb2FkcyBhIGxhbmd1YWdlIGRlZmluaXRpb24gaW50byB0aGUgYGxhbmd1YWdlc2AgY2FjaGUuICBUaGUgZnVuY3Rpb24KICAgIC8vIHRha2VzIGEga2V5IGFuZCBvcHRpb25hbGx5IHZhbHVlcy4gIElmIG5vdCBpbiB0aGUgYnJvd3NlciBhbmQgbm8gdmFsdWVzCiAgICAvLyBhcmUgcHJvdmlkZWQsIGl0IHdpbGwgbG9hZCB0aGUgbGFuZ3VhZ2UgZmlsZSBtb2R1bGUuICBBcyBhIGNvbnZlbmllbmNlLAogICAgLy8gdGhpcyBmdW5jdGlvbiBhbHNvIHJldHVybnMgdGhlIGxhbmd1YWdlIHZhbHVlcy4KICAgIGZ1bmN0aW9uIGxvYWRMYW5nKGtleSwgdmFsdWVzKSB7CiAgICAgICAgdmFsdWVzLmFiYnIgPSBrZXk7CiAgICAgICAgaWYgKCFsYW5ndWFnZXNba2V5XSkgewogICAgICAgICAgICBsYW5ndWFnZXNba2V5XSA9IG5ldyBMYW5ndWFnZSgpOwogICAgICAgIH0KICAgICAgICBsYW5ndWFnZXNba2V5XS5zZXQodmFsdWVzKTsKICAgICAgICByZXR1cm4gbGFuZ3VhZ2VzW2tleV07CiAgICB9CgogICAgLy8gUmVtb3ZlIGEgbGFuZ3VhZ2UgZnJvbSB0aGUgYGxhbmd1YWdlc2AgY2FjaGUuIE1vc3RseSB1c2VmdWwgaW4gdGVzdHMuCiAgICBmdW5jdGlvbiB1bmxvYWRMYW5nKGtleSkgewogICAgICAgIGRlbGV0ZSBsYW5ndWFnZXNba2V5XTsKICAgIH0KCiAgICAvLyBEZXRlcm1pbmVzIHdoaWNoIGxhbmd1YWdlIGRlZmluaXRpb24gdG8gdXNlIGFuZCByZXR1cm5zIGl0LgogICAgLy8KICAgIC8vIFdpdGggbm8gcGFyYW1ldGVycywgaXQgd2lsbCByZXR1cm4gdGhlIGdsb2JhbCBsYW5ndWFnZS4gIElmIHlvdQogICAgLy8gcGFzcyBpbiBhIGxhbmd1YWdlIGtleSwgc3VjaCBhcyAnZW4nLCBpdCB3aWxsIHJldHVybiB0aGUKICAgIC8vIGRlZmluaXRpb24gZm9yICdlbicsIHNvIGxvbmcgYXMgJ2VuJyBoYXMgYWxyZWFkeSBiZWVuIGxvYWRlZCB1c2luZwogICAgLy8gbW9tZW50LmxhbmcuCiAgICBmdW5jdGlvbiBnZXRMYW5nRGVmaW5pdGlvbihrZXkpIHsKICAgICAgICB2YXIgaSA9IDAsIGosIGxhbmcsIG5leHQsIHNwbGl0LAogICAgICAgICAgICBnZXQgPSBmdW5jdGlvbiAoaykgewogICAgICAgICAgICAgICAgaWYgKCFsYW5ndWFnZXNba10gJiYgaGFzTW9kdWxlKSB7CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWlyZSgnLi9sYW5nLycgKyBrKTsKICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7IH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBsYW5ndWFnZXNba107CiAgICAgICAgICAgIH07CgogICAgICAgIGlmICgha2V5KSB7CiAgICAgICAgICAgIHJldHVybiBtb21lbnQuZm4uX2xhbmc7CiAgICAgICAgfQoKICAgICAgICBpZiAoIWlzQXJyYXkoa2V5KSkgewogICAgICAgICAgICAvL3Nob3J0LWNpcmN1aXQgZXZlcnl0aGluZyBlbHNlCiAgICAgICAgICAgIGxhbmcgPSBnZXQoa2V5KTsKICAgICAgICAgICAgaWYgKGxhbmcpIHsKICAgICAgICAgICAgICAgIHJldHVybiBsYW5nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGtleSA9IFtrZXldOwogICAgICAgIH0KCiAgICAgICAgLy9waWNrIHRoZSBsYW5ndWFnZSBmcm9tIHRoZSBhcnJheQogICAgICAgIC8vdHJ5IFsnZW4tYXUnLCAnZW4tZ2InXSBhcyAnZW4tYXUnLCAnZW4tZ2InLCAnZW4nLCBhcyBpbiBtb3ZlIHRocm91Z2ggdGhlIGxpc3QgdHJ5aW5nIGVhY2gKICAgICAgICAvL3N1YnN0cmluZyBmcm9tIG1vc3Qgc3BlY2lmaWMgdG8gbGVhc3QsIGJ1dCBtb3ZlIHRvIHRoZSBuZXh0IGFycmF5IGl0ZW0gaWYgaXQncyBhIG1vcmUgc3BlY2lmaWMgdmFyaWFudCB0aGFuIHRoZSBjdXJyZW50IHJvb3QKICAgICAgICB3aGlsZSAoaSA8IGtleS5sZW5ndGgpIHsKICAgICAgICAgICAgc3BsaXQgPSBub3JtYWxpemVMYW5ndWFnZShrZXlbaV0pLnNwbGl0KCctJyk7CiAgICAgICAgICAgIGogPSBzcGxpdC5sZW5ndGg7CiAgICAgICAgICAgIG5leHQgPSBub3JtYWxpemVMYW5ndWFnZShrZXlbaSArIDFdKTsKICAgICAgICAgICAgbmV4dCA9IG5leHQgPyBuZXh0LnNwbGl0KCctJykgOiBudWxsOwogICAgICAgICAgICB3aGlsZSAoaiA+IDApIHsKICAgICAgICAgICAgICAgIGxhbmcgPSBnZXQoc3BsaXQuc2xpY2UoMCwgaikuam9pbignLScpKTsKICAgICAgICAgICAgICAgIGlmIChsYW5nKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGxhbmc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAobmV4dCAmJiBuZXh0Lmxlbmd0aCA+PSBqICYmIGNvbXBhcmVBcnJheXMoc3BsaXQsIG5leHQsIHRydWUpID49IGogLSAxKSB7CiAgICAgICAgICAgICAgICAgICAgLy90aGUgbmV4dCBhcnJheSBpdGVtIGlzIGJldHRlciB0aGFuIGEgc2hhbGxvd2VyIHN1YnN0cmluZyBvZiB0aGlzIG9uZQogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgai0tOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGkrKzsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG1vbWVudC5mbi5fbGFuZzsKICAgIH0KCiAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAgICAgRm9ybWF0dGluZwogICAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwoKCiAgICBmdW5jdGlvbiByZW1vdmVGb3JtYXR0aW5nVG9rZW5zKGlucHV0KSB7CiAgICAgICAgaWYgKGlucHV0Lm1hdGNoKC9cW1tcc1xTXS8pKSB7CiAgICAgICAgICAgIHJldHVybiBpbnB1dC5yZXBsYWNlKC9eXFt8XF0kL2csICIiKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGlucHV0LnJlcGxhY2UoL1xcL2csICIiKTsKICAgIH0KCiAgICBmdW5jdGlvbiBtYWtlRm9ybWF0RnVuY3Rpb24oZm9ybWF0KSB7CiAgICAgICAgdmFyIGFycmF5ID0gZm9ybWF0Lm1hdGNoKGZvcm1hdHRpbmdUb2tlbnMpLCBpLCBsZW5ndGg7CgogICAgICAgIGZvciAoaSA9IDAsIGxlbmd0aCA9IGFycmF5Lmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChmb3JtYXRUb2tlbkZ1bmN0aW9uc1thcnJheVtpXV0pIHsKICAgICAgICAgICAgICAgIGFycmF5W2ldID0gZm9ybWF0VG9rZW5GdW5jdGlvbnNbYXJyYXlbaV1dOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgYXJyYXlbaV0gPSByZW1vdmVGb3JtYXR0aW5nVG9rZW5zKGFycmF5W2ldKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChtb20pIHsKICAgICAgICAgICAgdmFyIG91dHB1dCA9ICIiOwogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIG91dHB1dCArPSBhcnJheVtpXSBpbnN0YW5jZW9mIEZ1bmN0aW9uID8gYXJyYXlbaV0uY2FsbChtb20sIGZvcm1hdCkgOiBhcnJheVtpXTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gb3V0cHV0OwogICAgICAgIH07CiAgICB9CgogICAgLy8gZm9ybWF0IGRhdGUgdXNpbmcgbmF0aXZlIGRhdGUgb2JqZWN0CiAgICBmdW5jdGlvbiBmb3JtYXRNb21lbnQobSwgZm9ybWF0KSB7CgogICAgICAgIGlmICghbS5pc1ZhbGlkKCkpIHsKICAgICAgICAgICAgcmV0dXJuIG0ubGFuZygpLmludmFsaWREYXRlKCk7CiAgICAgICAgfQoKICAgICAgICBmb3JtYXQgPSBleHBhbmRGb3JtYXQoZm9ybWF0LCBtLmxhbmcoKSk7CgogICAgICAgIGlmICghZm9ybWF0RnVuY3Rpb25zW2Zvcm1hdF0pIHsKICAgICAgICAgICAgZm9ybWF0RnVuY3Rpb25zW2Zvcm1hdF0gPSBtYWtlRm9ybWF0RnVuY3Rpb24oZm9ybWF0KTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBmb3JtYXRGdW5jdGlvbnNbZm9ybWF0XShtKTsKICAgIH0KCiAgICBmdW5jdGlvbiBleHBhbmRGb3JtYXQoZm9ybWF0LCBsYW5nKSB7CiAgICAgICAgdmFyIGkgPSA1OwoKICAgICAgICBmdW5jdGlvbiByZXBsYWNlTG9uZ0RhdGVGb3JtYXRUb2tlbnMoaW5wdXQpIHsKICAgICAgICAgICAgcmV0dXJuIGxhbmcubG9uZ0RhdGVGb3JtYXQoaW5wdXQpIHx8IGlucHV0OwogICAgICAgIH0KCiAgICAgICAgbG9jYWxGb3JtYXR0aW5nVG9rZW5zLmxhc3RJbmRleCA9IDA7CiAgICAgICAgd2hpbGUgKGkgPj0gMCAmJiBsb2NhbEZvcm1hdHRpbmdUb2tlbnMudGVzdChmb3JtYXQpKSB7CiAgICAgICAgICAgIGZvcm1hdCA9IGZvcm1hdC5yZXBsYWNlKGxvY2FsRm9ybWF0dGluZ1Rva2VucywgcmVwbGFjZUxvbmdEYXRlRm9ybWF0VG9rZW5zKTsKICAgICAgICAgICAgbG9jYWxGb3JtYXR0aW5nVG9rZW5zLmxhc3RJbmRleCA9IDA7CiAgICAgICAgICAgIGkgLT0gMTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBmb3JtYXQ7CiAgICB9CgoKICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAgICAgICBQYXJzaW5nCiAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCgoKICAgIC8vIGdldCB0aGUgcmVnZXggdG8gZmluZCB0aGUgbmV4dCB0b2tlbgogICAgZnVuY3Rpb24gZ2V0UGFyc2VSZWdleEZvclRva2VuKHRva2VuLCBjb25maWcpIHsKICAgICAgICB2YXIgYSwgc3RyaWN0ID0gY29uZmlnLl9zdHJpY3Q7CiAgICAgICAgc3dpdGNoICh0b2tlbikgewogICAgICAgIGNhc2UgJ1EnOgogICAgICAgICAgICByZXR1cm4gcGFyc2VUb2tlbk9uZURpZ2l0OwogICAgICAgIGNhc2UgJ0REREQnOgogICAgICAgICAgICByZXR1cm4gcGFyc2VUb2tlblRocmVlRGlnaXRzOwogICAgICAgIGNhc2UgJ1lZWVknOgogICAgICAgIGNhc2UgJ0dHR0cnOgogICAgICAgIGNhc2UgJ2dnZ2cnOgogICAgICAgICAgICByZXR1cm4gc3RyaWN0ID8gcGFyc2VUb2tlbkZvdXJEaWdpdHMgOiBwYXJzZVRva2VuT25lVG9Gb3VyRGlnaXRzOwogICAgICAgIGNhc2UgJ1knOgogICAgICAgIGNhc2UgJ0cnOgogICAgICAgIGNhc2UgJ2cnOgogICAgICAgICAgICByZXR1cm4gcGFyc2VUb2tlblNpZ25lZE51bWJlcjsKICAgICAgICBjYXNlICdZWVlZWVknOgogICAgICAgIGNhc2UgJ1lZWVlZJzoKICAgICAgICBjYXNlICdHR0dHRyc6CiAgICAgICAgY2FzZSAnZ2dnZ2cnOgogICAgICAgICAgICByZXR1cm4gc3RyaWN0ID8gcGFyc2VUb2tlblNpeERpZ2l0cyA6IHBhcnNlVG9rZW5PbmVUb1NpeERpZ2l0czsKICAgICAgICBjYXNlICdTJzoKICAgICAgICAgICAgaWYgKHN0cmljdCkgeyByZXR1cm4gcGFyc2VUb2tlbk9uZURpZ2l0OyB9CiAgICAgICAgICAgIC8qIGZhbGxzIHRocm91Z2ggKi8KICAgICAgICBjYXNlICdTUyc6CiAgICAgICAgICAgIGlmIChzdHJpY3QpIHsgcmV0dXJuIHBhcnNlVG9rZW5Ud29EaWdpdHM7IH0KICAgICAgICAgICAgLyogZmFsbHMgdGhyb3VnaCAqLwogICAgICAgIGNhc2UgJ1NTUyc6CiAgICAgICAgICAgIGlmIChzdHJpY3QpIHsgcmV0dXJuIHBhcnNlVG9rZW5UaHJlZURpZ2l0czsgfQogICAgICAgICAgICAvKiBmYWxscyB0aHJvdWdoICovCiAgICAgICAgY2FzZSAnREREJzoKICAgICAgICAgICAgcmV0dXJuIHBhcnNlVG9rZW5PbmVUb1RocmVlRGlnaXRzOwogICAgICAgIGNhc2UgJ01NTSc6CiAgICAgICAgY2FzZSAnTU1NTSc6CiAgICAgICAgY2FzZSAnZGQnOgogICAgICAgIGNhc2UgJ2RkZCc6CiAgICAgICAgY2FzZSAnZGRkZCc6CiAgICAgICAgICAgIHJldHVybiBwYXJzZVRva2VuV29yZDsKICAgICAgICBjYXNlICdhJzoKICAgICAgICBjYXNlICdBJzoKICAgICAgICAgICAgcmV0dXJuIGdldExhbmdEZWZpbml0aW9uKGNvbmZpZy5fbCkuX21lcmlkaWVtUGFyc2U7CiAgICAgICAgY2FzZSAnWCc6CiAgICAgICAgICAgIHJldHVybiBwYXJzZVRva2VuVGltZXN0YW1wTXM7CiAgICAgICAgY2FzZSAnWic6CiAgICAgICAgY2FzZSAnWlonOgogICAgICAgICAgICByZXR1cm4gcGFyc2VUb2tlblRpbWV6b25lOwogICAgICAgIGNhc2UgJ1QnOgogICAgICAgICAgICByZXR1cm4gcGFyc2VUb2tlblQ7CiAgICAgICAgY2FzZSAnU1NTUyc6CiAgICAgICAgICAgIHJldHVybiBwYXJzZVRva2VuRGlnaXRzOwogICAgICAgIGNhc2UgJ01NJzoKICAgICAgICBjYXNlICdERCc6CiAgICAgICAgY2FzZSAnWVknOgogICAgICAgIGNhc2UgJ0dHJzoKICAgICAgICBjYXNlICdnZyc6CiAgICAgICAgY2FzZSAnSEgnOgogICAgICAgIGNhc2UgJ2hoJzoKICAgICAgICBjYXNlICdtbSc6CiAgICAgICAgY2FzZSAnc3MnOgogICAgICAgIGNhc2UgJ3d3JzoKICAgICAgICBjYXNlICdXVyc6CiAgICAgICAgICAgIHJldHVybiBzdHJpY3QgPyBwYXJzZVRva2VuVHdvRGlnaXRzIDogcGFyc2VUb2tlbk9uZU9yVHdvRGlnaXRzOwogICAgICAgIGNhc2UgJ00nOgogICAgICAgIGNhc2UgJ0QnOgogICAgICAgIGNhc2UgJ2QnOgogICAgICAgIGNhc2UgJ0gnOgogICAgICAgIGNhc2UgJ2gnOgogICAgICAgIGNhc2UgJ20nOgogICAgICAgIGNhc2UgJ3MnOgogICAgICAgIGNhc2UgJ3cnOgogICAgICAgIGNhc2UgJ1cnOgogICAgICAgIGNhc2UgJ2UnOgogICAgICAgIGNhc2UgJ0UnOgogICAgICAgICAgICByZXR1cm4gcGFyc2VUb2tlbk9uZU9yVHdvRGlnaXRzOwogICAgICAgIGNhc2UgJ0RvJzoKICAgICAgICAgICAgcmV0dXJuIHBhcnNlVG9rZW5PcmRpbmFsOwogICAgICAgIGRlZmF1bHQgOgogICAgICAgICAgICBhID0gbmV3IFJlZ0V4cChyZWdleHBFc2NhcGUodW5lc2NhcGVGb3JtYXQodG9rZW4ucmVwbGFjZSgnXFwnLCAnJykpLCAiaSIpKTsKICAgICAgICAgICAgcmV0dXJuIGE7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHRpbWV6b25lTWludXRlc0Zyb21TdHJpbmcoc3RyaW5nKSB7CiAgICAgICAgc3RyaW5nID0gc3RyaW5nIHx8ICIiOwogICAgICAgIHZhciBwb3NzaWJsZVR6TWF0Y2hlcyA9IChzdHJpbmcubWF0Y2gocGFyc2VUb2tlblRpbWV6b25lKSB8fCBbXSksCiAgICAgICAgICAgIHR6Q2h1bmsgPSBwb3NzaWJsZVR6TWF0Y2hlc1twb3NzaWJsZVR6TWF0Y2hlcy5sZW5ndGggLSAxXSB8fCBbXSwKICAgICAgICAgICAgcGFydHMgPSAodHpDaHVuayArICcnKS5tYXRjaChwYXJzZVRpbWV6b25lQ2h1bmtlcikgfHwgWyctJywgMCwgMF0sCiAgICAgICAgICAgIG1pbnV0ZXMgPSArKHBhcnRzWzFdICogNjApICsgdG9JbnQocGFydHNbMl0pOwoKICAgICAgICByZXR1cm4gcGFydHNbMF0gPT09ICcrJyA/IC1taW51dGVzIDogbWludXRlczsKICAgIH0KCiAgICAvLyBmdW5jdGlvbiB0byBjb252ZXJ0IHN0cmluZyBpbnB1dCB0byBkYXRlCiAgICBmdW5jdGlvbiBhZGRUaW1lVG9BcnJheUZyb21Ub2tlbih0b2tlbiwgaW5wdXQsIGNvbmZpZykgewogICAgICAgIHZhciBhLCBkYXRlUGFydEFycmF5ID0gY29uZmlnLl9hOwoKICAgICAgICBzd2l0Y2ggKHRva2VuKSB7CiAgICAgICAgLy8gUVVBUlRFUgogICAgICAgIGNhc2UgJ1EnOgogICAgICAgICAgICBpZiAoaW5wdXQgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgZGF0ZVBhcnRBcnJheVtNT05USF0gPSAodG9JbnQoaW5wdXQpIC0gMSkgKiAzOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIC8vIE1PTlRICiAgICAgICAgY2FzZSAnTScgOiAvLyBmYWxsIHRocm91Z2ggdG8gTU0KICAgICAgICBjYXNlICdNTScgOgogICAgICAgICAgICBpZiAoaW5wdXQgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgZGF0ZVBhcnRBcnJheVtNT05USF0gPSB0b0ludChpbnB1dCkgLSAxOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJ01NTScgOiAvLyBmYWxsIHRocm91Z2ggdG8gTU1NTQogICAgICAgIGNhc2UgJ01NTU0nIDoKICAgICAgICAgICAgYSA9IGdldExhbmdEZWZpbml0aW9uKGNvbmZpZy5fbCkubW9udGhzUGFyc2UoaW5wdXQpOwogICAgICAgICAgICAvLyBpZiB3ZSBkaWRuJ3QgZmluZCBhIG1vbnRoIG5hbWUsIG1hcmsgdGhlIGRhdGUgYXMgaW52YWxpZC4KICAgICAgICAgICAgaWYgKGEgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgZGF0ZVBhcnRBcnJheVtNT05USF0gPSBhOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29uZmlnLl9wZi5pbnZhbGlkTW9udGggPSBpbnB1dDsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICAvLyBEQVkgT0YgTU9OVEgKICAgICAgICBjYXNlICdEJyA6IC8vIGZhbGwgdGhyb3VnaCB0byBERAogICAgICAgIGNhc2UgJ0REJyA6CiAgICAgICAgICAgIGlmIChpbnB1dCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBkYXRlUGFydEFycmF5W0RBVEVdID0gdG9JbnQoaW5wdXQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJ0RvJyA6CiAgICAgICAgICAgIGlmIChpbnB1dCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBkYXRlUGFydEFycmF5W0RBVEVdID0gdG9JbnQocGFyc2VJbnQoaW5wdXQsIDEwKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgLy8gREFZIE9GIFlFQVIKICAgICAgICBjYXNlICdEREQnIDogLy8gZmFsbCB0aHJvdWdoIHRvIEREREQKICAgICAgICBjYXNlICdEREREJyA6CiAgICAgICAgICAgIGlmIChpbnB1dCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBjb25maWcuX2RheU9mWWVhciA9IHRvSW50KGlucHV0KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgLy8gWUVBUgogICAgICAgIGNhc2UgJ1lZJyA6CiAgICAgICAgICAgIGRhdGVQYXJ0QXJyYXlbWUVBUl0gPSBtb21lbnQucGFyc2VUd29EaWdpdFllYXIoaW5wdXQpOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICdZWVlZJyA6CiAgICAgICAgY2FzZSAnWVlZWVknIDoKICAgICAgICBjYXNlICdZWVlZWVknIDoKICAgICAgICAgICAgZGF0ZVBhcnRBcnJheVtZRUFSXSA9IHRvSW50KGlucHV0KTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgLy8gQU0gLyBQTQogICAgICAgIGNhc2UgJ2EnIDogLy8gZmFsbCB0aHJvdWdoIHRvIEEKICAgICAgICBjYXNlICdBJyA6CiAgICAgICAgICAgIGNvbmZpZy5faXNQbSA9IGdldExhbmdEZWZpbml0aW9uKGNvbmZpZy5fbCkuaXNQTShpbnB1dCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIC8vIDI0IEhPVVIKICAgICAgICBjYXNlICdIJyA6IC8vIGZhbGwgdGhyb3VnaCB0byBoaAogICAgICAgIGNhc2UgJ0hIJyA6IC8vIGZhbGwgdGhyb3VnaCB0byBoaAogICAgICAgIGNhc2UgJ2gnIDogLy8gZmFsbCB0aHJvdWdoIHRvIGhoCiAgICAgICAgY2FzZSAnaGgnIDoKICAgICAgICAgICAgZGF0ZVBhcnRBcnJheVtIT1VSXSA9IHRvSW50KGlucHV0KTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgLy8gTUlOVVRFCiAgICAgICAgY2FzZSAnbScgOiAvLyBmYWxsIHRocm91Z2ggdG8gbW0KICAgICAgICBjYXNlICdtbScgOgogICAgICAgICAgICBkYXRlUGFydEFycmF5W01JTlVURV0gPSB0b0ludChpbnB1dCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIC8vIFNFQ09ORAogICAgICAgIGNhc2UgJ3MnIDogLy8gZmFsbCB0aHJvdWdoIHRvIHNzCiAgICAgICAgY2FzZSAnc3MnIDoKICAgICAgICAgICAgZGF0ZVBhcnRBcnJheVtTRUNPTkRdID0gdG9JbnQoaW5wdXQpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAvLyBNSUxMSVNFQ09ORAogICAgICAgIGNhc2UgJ1MnIDoKICAgICAgICBjYXNlICdTUycgOgogICAgICAgIGNhc2UgJ1NTUycgOgogICAgICAgIGNhc2UgJ1NTU1MnIDoKICAgICAgICAgICAgZGF0ZVBhcnRBcnJheVtNSUxMSVNFQ09ORF0gPSB0b0ludCgoJzAuJyArIGlucHV0KSAqIDEwMDApOwogICAgICAgICAgICBicmVhazsKICAgICAgICAvLyBVTklYIFRJTUVTVEFNUCBXSVRIIE1TCiAgICAgICAgY2FzZSAnWCc6CiAgICAgICAgICAgIGNvbmZpZy5fZCA9IG5ldyBEYXRlKHBhcnNlRmxvYXQoaW5wdXQpICogMTAwMCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIC8vIFRJTUVaT05FCiAgICAgICAgY2FzZSAnWicgOiAvLyBmYWxsIHRocm91Z2ggdG8gWloKICAgICAgICBjYXNlICdaWicgOgogICAgICAgICAgICBjb25maWcuX3VzZVVUQyA9IHRydWU7CiAgICAgICAgICAgIGNvbmZpZy5fdHptID0gdGltZXpvbmVNaW51dGVzRnJvbVN0cmluZyhpbnB1dCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJ3cnOgogICAgICAgIGNhc2UgJ3d3JzoKICAgICAgICBjYXNlICdXJzoKICAgICAgICBjYXNlICdXVyc6CiAgICAgICAgY2FzZSAnZCc6CiAgICAgICAgY2FzZSAnZGQnOgogICAgICAgIGNhc2UgJ2RkZCc6CiAgICAgICAgY2FzZSAnZGRkZCc6CiAgICAgICAgY2FzZSAnZSc6CiAgICAgICAgY2FzZSAnRSc6CiAgICAgICAgICAgIHRva2VuID0gdG9rZW4uc3Vic3RyKDAsIDEpOwogICAgICAgICAgICAvKiBmYWxscyB0aHJvdWdoICovCiAgICAgICAgY2FzZSAnZ2cnOgogICAgICAgIGNhc2UgJ2dnZ2cnOgogICAgICAgIGNhc2UgJ0dHJzoKICAgICAgICBjYXNlICdHR0dHJzoKICAgICAgICBjYXNlICdHR0dHRyc6CiAgICAgICAgICAgIHRva2VuID0gdG9rZW4uc3Vic3RyKDAsIDIpOwogICAgICAgICAgICBpZiAoaW5wdXQpIHsKICAgICAgICAgICAgICAgIGNvbmZpZy5fdyA9IGNvbmZpZy5fdyB8fCB7fTsKICAgICAgICAgICAgICAgIGNvbmZpZy5fd1t0b2tlbl0gPSBpbnB1dDsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICB9CgogICAgLy8gY29udmVydCBhbiBhcnJheSB0byBhIGRhdGUuCiAgICAvLyB0aGUgYXJyYXkgc2hvdWxkIG1pcnJvciB0aGUgcGFyYW1ldGVycyBiZWxvdwogICAgLy8gbm90ZTogYWxsIHZhbHVlcyBwYXN0IHRoZSB5ZWFyIGFyZSBvcHRpb25hbCBhbmQgd2lsbCBkZWZhdWx0IHRvIHRoZSBsb3dlc3QgcG9zc2libGUgdmFsdWUuCiAgICAvLyBbeWVhciwgbW9udGgsIGRheSAsIGhvdXIsIG1pbnV0ZSwgc2Vjb25kLCBtaWxsaXNlY29uZF0KICAgIGZ1bmN0aW9uIGRhdGVGcm9tQ29uZmlnKGNvbmZpZykgewogICAgICAgIHZhciBpLCBkYXRlLCBpbnB1dCA9IFtdLCBjdXJyZW50RGF0ZSwKICAgICAgICAgICAgeWVhclRvVXNlLCBmaXhZZWFyLCB3LCB0ZW1wLCBsYW5nLCB3ZWVrZGF5LCB3ZWVrOwoKICAgICAgICBpZiAoY29uZmlnLl9kKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGN1cnJlbnREYXRlID0gY3VycmVudERhdGVBcnJheShjb25maWcpOwoKICAgICAgICAvL2NvbXB1dGUgZGF5IG9mIHRoZSB5ZWFyIGZyb20gd2Vla3MgYW5kIHdlZWtkYXlzCiAgICAgICAgaWYgKGNvbmZpZy5fdyAmJiBjb25maWcuX2FbREFURV0gPT0gbnVsbCAmJiBjb25maWcuX2FbTU9OVEhdID09IG51bGwpIHsKICAgICAgICAgICAgZml4WWVhciA9IGZ1bmN0aW9uICh2YWwpIHsKICAgICAgICAgICAgICAgIHZhciBpbnRWYWwgPSBwYXJzZUludCh2YWwsIDEwKTsKICAgICAgICAgICAgICAgIHJldHVybiB2YWwgPwogICAgICAgICAgICAgICAgICAodmFsLmxlbmd0aCA8IDMgPyAoaW50VmFsID4gNjggPyAxOTAwICsgaW50VmFsIDogMjAwMCArIGludFZhbCkgOiBpbnRWYWwpIDoKICAgICAgICAgICAgICAgICAgKGNvbmZpZy5fYVtZRUFSXSA9PSBudWxsID8gbW9tZW50KCkud2Vla1llYXIoKSA6IGNvbmZpZy5fYVtZRUFSXSk7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICB3ID0gY29uZmlnLl93OwogICAgICAgICAgICBpZiAody5HRyAhPSBudWxsIHx8IHcuVyAhPSBudWxsIHx8IHcuRSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICB0ZW1wID0gZGF5T2ZZZWFyRnJvbVdlZWtzKGZpeFllYXIody5HRyksIHcuVyB8fCAxLCB3LkUsIDQsIDEpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgbGFuZyA9IGdldExhbmdEZWZpbml0aW9uKGNvbmZpZy5fbCk7CiAgICAgICAgICAgICAgICB3ZWVrZGF5ID0gdy5kICE9IG51bGwgPyAgcGFyc2VXZWVrZGF5KHcuZCwgbGFuZykgOgogICAgICAgICAgICAgICAgICAody5lICE9IG51bGwgPyAgcGFyc2VJbnQody5lLCAxMCkgKyBsYW5nLl93ZWVrLmRvdyA6IDApOwoKICAgICAgICAgICAgICAgIHdlZWsgPSBwYXJzZUludCh3LncsIDEwKSB8fCAxOwoKICAgICAgICAgICAgICAgIC8vaWYgd2UncmUgcGFyc2luZyAnZCcsIHRoZW4gdGhlIGxvdyBkYXkgbnVtYmVycyBtYXkgYmUgbmV4dCB3ZWVrCiAgICAgICAgICAgICAgICBpZiAody5kICE9IG51bGwgJiYgd2Vla2RheSA8IGxhbmcuX3dlZWsuZG93KSB7CiAgICAgICAgICAgICAgICAgICAgd2VlaysrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRlbXAgPSBkYXlPZlllYXJGcm9tV2Vla3MoZml4WWVhcih3LmdnKSwgd2Vlaywgd2Vla2RheSwgbGFuZy5fd2Vlay5kb3ksIGxhbmcuX3dlZWsuZG93KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29uZmlnLl9hW1lFQVJdID0gdGVtcC55ZWFyOwogICAgICAgICAgICBjb25maWcuX2RheU9mWWVhciA9IHRlbXAuZGF5T2ZZZWFyOwogICAgICAgIH0KCiAgICAgICAgLy9pZiB0aGUgZGF5IG9mIHRoZSB5ZWFyIGlzIHNldCwgZmlndXJlIG91dCB3aGF0IGl0IGlzCiAgICAgICAgaWYgKGNvbmZpZy5fZGF5T2ZZZWFyKSB7CiAgICAgICAgICAgIHllYXJUb1VzZSA9IGNvbmZpZy5fYVtZRUFSXSA9PSBudWxsID8gY3VycmVudERhdGVbWUVBUl0gOiBjb25maWcuX2FbWUVBUl07CgogICAgICAgICAgICBpZiAoY29uZmlnLl9kYXlPZlllYXIgPiBkYXlzSW5ZZWFyKHllYXJUb1VzZSkpIHsKICAgICAgICAgICAgICAgIGNvbmZpZy5fcGYuX292ZXJmbG93RGF5T2ZZZWFyID0gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZGF0ZSA9IG1ha2VVVENEYXRlKHllYXJUb1VzZSwgMCwgY29uZmlnLl9kYXlPZlllYXIpOwogICAgICAgICAgICBjb25maWcuX2FbTU9OVEhdID0gZGF0ZS5nZXRVVENNb250aCgpOwogICAgICAgICAgICBjb25maWcuX2FbREFURV0gPSBkYXRlLmdldFVUQ0RhdGUoKTsKICAgICAgICB9CgogICAgICAgIC8vIERlZmF1bHQgdG8gY3VycmVudCBkYXRlLgogICAgICAgIC8vICogaWYgbm8geWVhciwgbW9udGgsIGRheSBvZiBtb250aCBhcmUgZ2l2ZW4sIGRlZmF1bHQgdG8gdG9kYXkKICAgICAgICAvLyAqIGlmIGRheSBvZiBtb250aCBpcyBnaXZlbiwgZGVmYXVsdCBtb250aCBhbmQgeWVhcgogICAgICAgIC8vICogaWYgbW9udGggaXMgZ2l2ZW4sIGRlZmF1bHQgb25seSB5ZWFyCiAgICAgICAgLy8gKiBpZiB5ZWFyIGlzIGdpdmVuLCBkb24ndCBkZWZhdWx0IGFueXRoaW5nCiAgICAgICAgZm9yIChpID0gMDsgaSA8IDMgJiYgY29uZmlnLl9hW2ldID09IG51bGw7ICsraSkgewogICAgICAgICAgICBjb25maWcuX2FbaV0gPSBpbnB1dFtpXSA9IGN1cnJlbnREYXRlW2ldOwogICAgICAgIH0KCiAgICAgICAgLy8gWmVybyBvdXQgd2hhdGV2ZXIgd2FzIG5vdCBkZWZhdWx0ZWQsIGluY2x1ZGluZyB0aW1lCiAgICAgICAgZm9yICg7IGkgPCA3OyBpKyspIHsKICAgICAgICAgICAgY29uZmlnLl9hW2ldID0gaW5wdXRbaV0gPSAoY29uZmlnLl9hW2ldID09IG51bGwpID8gKGkgPT09IDIgPyAxIDogMCkgOiBjb25maWcuX2FbaV07CiAgICAgICAgfQoKICAgICAgICAvLyBhZGQgdGhlIG9mZnNldHMgdG8gdGhlIHRpbWUgdG8gYmUgcGFyc2VkIHNvIHRoYXQgd2UgY2FuIGhhdmUgYSBjbGVhbiBhcnJheSBmb3IgY2hlY2tpbmcgaXNWYWxpZAogICAgICAgIGlucHV0W0hPVVJdICs9IHRvSW50KChjb25maWcuX3R6bSB8fCAwKSAvIDYwKTsKICAgICAgICBpbnB1dFtNSU5VVEVdICs9IHRvSW50KChjb25maWcuX3R6bSB8fCAwKSAlIDYwKTsKCiAgICAgICAgY29uZmlnLl9kID0gKGNvbmZpZy5fdXNlVVRDID8gbWFrZVVUQ0RhdGUgOiBtYWtlRGF0ZSkuYXBwbHkobnVsbCwgaW5wdXQpOwogICAgfQoKICAgIGZ1bmN0aW9uIGRhdGVGcm9tT2JqZWN0KGNvbmZpZykgewogICAgICAgIHZhciBub3JtYWxpemVkSW5wdXQ7CgogICAgICAgIGlmIChjb25maWcuX2QpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgbm9ybWFsaXplZElucHV0ID0gbm9ybWFsaXplT2JqZWN0VW5pdHMoY29uZmlnLl9pKTsKICAgICAgICBjb25maWcuX2EgPSBbCiAgICAgICAgICAgIG5vcm1hbGl6ZWRJbnB1dC55ZWFyLAogICAgICAgICAgICBub3JtYWxpemVkSW5wdXQubW9udGgsCiAgICAgICAgICAgIG5vcm1hbGl6ZWRJbnB1dC5kYXksCiAgICAgICAgICAgIG5vcm1hbGl6ZWRJbnB1dC5ob3VyLAogICAgICAgICAgICBub3JtYWxpemVkSW5wdXQubWludXRlLAogICAgICAgICAgICBub3JtYWxpemVkSW5wdXQuc2Vjb25kLAogICAgICAgICAgICBub3JtYWxpemVkSW5wdXQubWlsbGlzZWNvbmQKICAgICAgICBdOwoKICAgICAgICBkYXRlRnJvbUNvbmZpZyhjb25maWcpOwogICAgfQoKICAgIGZ1bmN0aW9uIGN1cnJlbnREYXRlQXJyYXkoY29uZmlnKSB7CiAgICAgICAgdmFyIG5vdyA9IG5ldyBEYXRlKCk7CiAgICAgICAgaWYgKGNvbmZpZy5fdXNlVVRDKSB7CiAgICAgICAgICAgIHJldHVybiBbCiAgICAgICAgICAgICAgICBub3cuZ2V0VVRDRnVsbFllYXIoKSwKICAgICAgICAgICAgICAgIG5vdy5nZXRVVENNb250aCgpLAogICAgICAgICAgICAgICAgbm93LmdldFVUQ0RhdGUoKQogICAgICAgICAgICBdOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBbbm93LmdldEZ1bGxZZWFyKCksIG5vdy5nZXRNb250aCgpLCBub3cuZ2V0RGF0ZSgpXTsKICAgICAgICB9CiAgICB9CgogICAgLy8gZGF0ZSBmcm9tIHN0cmluZyBhbmQgZm9ybWF0IHN0cmluZwogICAgZnVuY3Rpb24gbWFrZURhdGVGcm9tU3RyaW5nQW5kRm9ybWF0KGNvbmZpZykgewoKICAgICAgICBjb25maWcuX2EgPSBbXTsKICAgICAgICBjb25maWcuX3BmLmVtcHR5ID0gdHJ1ZTsKCiAgICAgICAgLy8gVGhpcyBhcnJheSBpcyB1c2VkIHRvIG1ha2UgYSBEYXRlLCBlaXRoZXIgd2l0aCBgbmV3IERhdGVgIG9yIGBEYXRlLlVUQ2AKICAgICAgICB2YXIgbGFuZyA9IGdldExhbmdEZWZpbml0aW9uKGNvbmZpZy5fbCksCiAgICAgICAgICAgIHN0cmluZyA9ICcnICsgY29uZmlnLl9pLAogICAgICAgICAgICBpLCBwYXJzZWRJbnB1dCwgdG9rZW5zLCB0b2tlbiwgc2tpcHBlZCwKICAgICAgICAgICAgc3RyaW5nTGVuZ3RoID0gc3RyaW5nLmxlbmd0aCwKICAgICAgICAgICAgdG90YWxQYXJzZWRJbnB1dExlbmd0aCA9IDA7CgogICAgICAgIHRva2VucyA9IGV4cGFuZEZvcm1hdChjb25maWcuX2YsIGxhbmcpLm1hdGNoKGZvcm1hdHRpbmdUb2tlbnMpIHx8IFtdOwoKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdG9rZW5zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHRva2VuID0gdG9rZW5zW2ldOwogICAgICAgICAgICBwYXJzZWRJbnB1dCA9IChzdHJpbmcubWF0Y2goZ2V0UGFyc2VSZWdleEZvclRva2VuKHRva2VuLCBjb25maWcpKSB8fCBbXSlbMF07CiAgICAgICAgICAgIGlmIChwYXJzZWRJbnB1dCkgewogICAgICAgICAgICAgICAgc2tpcHBlZCA9IHN0cmluZy5zdWJzdHIoMCwgc3RyaW5nLmluZGV4T2YocGFyc2VkSW5wdXQpKTsKICAgICAgICAgICAgICAgIGlmIChza2lwcGVkLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBjb25maWcuX3BmLnVudXNlZElucHV0LnB1c2goc2tpcHBlZCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzdHJpbmcgPSBzdHJpbmcuc2xpY2Uoc3RyaW5nLmluZGV4T2YocGFyc2VkSW5wdXQpICsgcGFyc2VkSW5wdXQubGVuZ3RoKTsKICAgICAgICAgICAgICAgIHRvdGFsUGFyc2VkSW5wdXRMZW5ndGggKz0gcGFyc2VkSW5wdXQubGVuZ3RoOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIGRvbid0IHBhcnNlIGlmIGl0J3Mgbm90IGEga25vd24gdG9rZW4KICAgICAgICAgICAgaWYgKGZvcm1hdFRva2VuRnVuY3Rpb25zW3Rva2VuXSkgewogICAgICAgICAgICAgICAgaWYgKHBhcnNlZElucHV0KSB7CiAgICAgICAgICAgICAgICAgICAgY29uZmlnLl9wZi5lbXB0eSA9IGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgY29uZmlnLl9wZi51bnVzZWRUb2tlbnMucHVzaCh0b2tlbik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBhZGRUaW1lVG9BcnJheUZyb21Ub2tlbih0b2tlbiwgcGFyc2VkSW5wdXQsIGNvbmZpZyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAoY29uZmlnLl9zdHJpY3QgJiYgIXBhcnNlZElucHV0KSB7CiAgICAgICAgICAgICAgICBjb25maWcuX3BmLnVudXNlZFRva2Vucy5wdXNoKHRva2VuKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gYWRkIHJlbWFpbmluZyB1bnBhcnNlZCBpbnB1dCBsZW5ndGggdG8gdGhlIHN0cmluZwogICAgICAgIGNvbmZpZy5fcGYuY2hhcnNMZWZ0T3ZlciA9IHN0cmluZ0xlbmd0aCAtIHRvdGFsUGFyc2VkSW5wdXRMZW5ndGg7CiAgICAgICAgaWYgKHN0cmluZy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIGNvbmZpZy5fcGYudW51c2VkSW5wdXQucHVzaChzdHJpbmcpOwogICAgICAgIH0KCiAgICAgICAgLy8gaGFuZGxlIGFtIHBtCiAgICAgICAgaWYgKGNvbmZpZy5faXNQbSAmJiBjb25maWcuX2FbSE9VUl0gPCAxMikgewogICAgICAgICAgICBjb25maWcuX2FbSE9VUl0gKz0gMTI7CiAgICAgICAgfQogICAgICAgIC8vIGlmIGlzIDEyIGFtLCBjaGFuZ2UgaG91cnMgdG8gMAogICAgICAgIGlmIChjb25maWcuX2lzUG0gPT09IGZhbHNlICYmIGNvbmZpZy5fYVtIT1VSXSA9PT0gMTIpIHsKICAgICAgICAgICAgY29uZmlnLl9hW0hPVVJdID0gMDsKICAgICAgICB9CgogICAgICAgIGRhdGVGcm9tQ29uZmlnKGNvbmZpZyk7CiAgICAgICAgY2hlY2tPdmVyZmxvdyhjb25maWcpOwogICAgfQoKICAgIGZ1bmN0aW9uIHVuZXNjYXBlRm9ybWF0KHMpIHsKICAgICAgICByZXR1cm4gcy5yZXBsYWNlKC9cXChcWyl8XFwoXF0pfFxbKFteXF1cW10qKVxdfFxcKC4pL2csIGZ1bmN0aW9uIChtYXRjaGVkLCBwMSwgcDIsIHAzLCBwNCkgewogICAgICAgICAgICByZXR1cm4gcDEgfHwgcDIgfHwgcDMgfHwgcDQ7CiAgICAgICAgfSk7CiAgICB9CgogICAgLy8gQ29kZSBmcm9tIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMzU2MTQ5My9pcy10aGVyZS1hLXJlZ2V4cC1lc2NhcGUtZnVuY3Rpb24taW4tamF2YXNjcmlwdAogICAgZnVuY3Rpb24gcmVnZXhwRXNjYXBlKHMpIHsKICAgICAgICByZXR1cm4gcy5yZXBsYWNlKC9bLVwvXFxeJCorPy4oKXxbXF17fV0vZywgJ1xcJCYnKTsKICAgIH0KCiAgICAvLyBkYXRlIGZyb20gc3RyaW5nIGFuZCBhcnJheSBvZiBmb3JtYXQgc3RyaW5ncwogICAgZnVuY3Rpb24gbWFrZURhdGVGcm9tU3RyaW5nQW5kQXJyYXkoY29uZmlnKSB7CiAgICAgICAgdmFyIHRlbXBDb25maWcsCiAgICAgICAgICAgIGJlc3RNb21lbnQsCgogICAgICAgICAgICBzY29yZVRvQmVhdCwKICAgICAgICAgICAgaSwKICAgICAgICAgICAgY3VycmVudFNjb3JlOwoKICAgICAgICBpZiAoY29uZmlnLl9mLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICBjb25maWcuX3BmLmludmFsaWRGb3JtYXQgPSB0cnVlOwogICAgICAgICAgICBjb25maWcuX2QgPSBuZXcgRGF0ZShOYU4pOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY29uZmlnLl9mLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGN1cnJlbnRTY29yZSA9IDA7CiAgICAgICAgICAgIHRlbXBDb25maWcgPSBleHRlbmQoe30sIGNvbmZpZyk7CiAgICAgICAgICAgIHRlbXBDb25maWcuX3BmID0gZGVmYXVsdFBhcnNpbmdGbGFncygpOwogICAgICAgICAgICB0ZW1wQ29uZmlnLl9mID0gY29uZmlnLl9mW2ldOwogICAgICAgICAgICBtYWtlRGF0ZUZyb21TdHJpbmdBbmRGb3JtYXQodGVtcENvbmZpZyk7CgogICAgICAgICAgICBpZiAoIWlzVmFsaWQodGVtcENvbmZpZykpIHsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBpZiB0aGVyZSBpcyBhbnkgaW5wdXQgdGhhdCB3YXMgbm90IHBhcnNlZCBhZGQgYSBwZW5hbHR5IGZvciB0aGF0IGZvcm1hdAogICAgICAgICAgICBjdXJyZW50U2NvcmUgKz0gdGVtcENvbmZpZy5fcGYuY2hhcnNMZWZ0T3ZlcjsKCiAgICAgICAgICAgIC8vb3IgdG9rZW5zCiAgICAgICAgICAgIGN1cnJlbnRTY29yZSArPSB0ZW1wQ29uZmlnLl9wZi51bnVzZWRUb2tlbnMubGVuZ3RoICogMTA7CgogICAgICAgICAgICB0ZW1wQ29uZmlnLl9wZi5zY29yZSA9IGN1cnJlbnRTY29yZTsKCiAgICAgICAgICAgIGlmIChzY29yZVRvQmVhdCA9PSBudWxsIHx8IGN1cnJlbnRTY29yZSA8IHNjb3JlVG9CZWF0KSB7CiAgICAgICAgICAgICAgICBzY29yZVRvQmVhdCA9IGN1cnJlbnRTY29yZTsKICAgICAgICAgICAgICAgIGJlc3RNb21lbnQgPSB0ZW1wQ29uZmlnOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBleHRlbmQoY29uZmlnLCBiZXN0TW9tZW50IHx8IHRlbXBDb25maWcpOwogICAgfQoKICAgIC8vIGRhdGUgZnJvbSBpc28gZm9ybWF0CiAgICBmdW5jdGlvbiBtYWtlRGF0ZUZyb21TdHJpbmcoY29uZmlnKSB7CiAgICAgICAgdmFyIGksIGwsCiAgICAgICAgICAgIHN0cmluZyA9IGNvbmZpZy5faSwKICAgICAgICAgICAgbWF0Y2ggPSBpc29SZWdleC5leGVjKHN0cmluZyk7CgogICAgICAgIGlmIChtYXRjaCkgewogICAgICAgICAgICBjb25maWcuX3BmLmlzbyA9IHRydWU7CiAgICAgICAgICAgIGZvciAoaSA9IDAsIGwgPSBpc29EYXRlcy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChpc29EYXRlc1tpXVsxXS5leGVjKHN0cmluZykpIHsKICAgICAgICAgICAgICAgICAgICAvLyBtYXRjaFs1XSBzaG91bGQgYmUgIlQiIG9yIHVuZGVmaW5lZAogICAgICAgICAgICAgICAgICAgIGNvbmZpZy5fZiA9IGlzb0RhdGVzW2ldWzBdICsgKG1hdGNoWzZdIHx8ICIgIik7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yIChpID0gMCwgbCA9IGlzb1RpbWVzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKGlzb1RpbWVzW2ldWzFdLmV4ZWMoc3RyaW5nKSkgewogICAgICAgICAgICAgICAgICAgIGNvbmZpZy5fZiArPSBpc29UaW1lc1tpXVswXTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoc3RyaW5nLm1hdGNoKHBhcnNlVG9rZW5UaW1lem9uZSkpIHsKICAgICAgICAgICAgICAgIGNvbmZpZy5fZiArPSAiWiI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbWFrZURhdGVGcm9tU3RyaW5nQW5kRm9ybWF0KGNvbmZpZyk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBtb21lbnQuY3JlYXRlRnJvbUlucHV0RmFsbGJhY2soY29uZmlnKTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gbWFrZURhdGVGcm9tSW5wdXQoY29uZmlnKSB7CiAgICAgICAgdmFyIGlucHV0ID0gY29uZmlnLl9pLAogICAgICAgICAgICBtYXRjaGVkID0gYXNwTmV0SnNvblJlZ2V4LmV4ZWMoaW5wdXQpOwoKICAgICAgICBpZiAoaW5wdXQgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBjb25maWcuX2QgPSBuZXcgRGF0ZSgpOwogICAgICAgIH0gZWxzZSBpZiAobWF0Y2hlZCkgewogICAgICAgICAgICBjb25maWcuX2QgPSBuZXcgRGF0ZSgrbWF0Y2hlZFsxXSk7CiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgaW5wdXQgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgIG1ha2VEYXRlRnJvbVN0cmluZyhjb25maWcpOwogICAgICAgIH0gZWxzZSBpZiAoaXNBcnJheShpbnB1dCkpIHsKICAgICAgICAgICAgY29uZmlnLl9hID0gaW5wdXQuc2xpY2UoMCk7CiAgICAgICAgICAgIGRhdGVGcm9tQ29uZmlnKGNvbmZpZyk7CiAgICAgICAgfSBlbHNlIGlmIChpc0RhdGUoaW5wdXQpKSB7CiAgICAgICAgICAgIGNvbmZpZy5fZCA9IG5ldyBEYXRlKCtpbnB1dCk7CiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YoaW5wdXQpID09PSAnb2JqZWN0JykgewogICAgICAgICAgICBkYXRlRnJvbU9iamVjdChjb25maWcpOwogICAgICAgIH0gZWxzZSBpZiAodHlwZW9mKGlucHV0KSA9PT0gJ251bWJlcicpIHsKICAgICAgICAgICAgLy8gZnJvbSBtaWxsaXNlY29uZHMKICAgICAgICAgICAgY29uZmlnLl9kID0gbmV3IERhdGUoaW5wdXQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG1vbWVudC5jcmVhdGVGcm9tSW5wdXRGYWxsYmFjayhjb25maWcpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBtYWtlRGF0ZSh5LCBtLCBkLCBoLCBNLCBzLCBtcykgewogICAgICAgIC8vY2FuJ3QganVzdCBhcHBseSgpIHRvIGNyZWF0ZSBhIGRhdGU6CiAgICAgICAgLy9odHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzE4MTM0OC9pbnN0YW50aWF0aW5nLWEtamF2YXNjcmlwdC1vYmplY3QtYnktY2FsbGluZy1wcm90b3R5cGUtY29uc3RydWN0b3ItYXBwbHkKICAgICAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKHksIG0sIGQsIGgsIE0sIHMsIG1zKTsKCiAgICAgICAgLy90aGUgZGF0ZSBjb25zdHJ1Y3RvciBkb2Vzbid0IGFjY2VwdCB5ZWFycyA8IDE5NzAKICAgICAgICBpZiAoeSA8IDE5NzApIHsKICAgICAgICAgICAgZGF0ZS5zZXRGdWxsWWVhcih5KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGRhdGU7CiAgICB9CgogICAgZnVuY3Rpb24gbWFrZVVUQ0RhdGUoeSkgewogICAgICAgIHZhciBkYXRlID0gbmV3IERhdGUoRGF0ZS5VVEMuYXBwbHkobnVsbCwgYXJndW1lbnRzKSk7CiAgICAgICAgaWYgKHkgPCAxOTcwKSB7CiAgICAgICAgICAgIGRhdGUuc2V0VVRDRnVsbFllYXIoeSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBkYXRlOwogICAgfQoKICAgIGZ1bmN0aW9uIHBhcnNlV2Vla2RheShpbnB1dCwgbGFuZ3VhZ2UpIHsKICAgICAgICBpZiAodHlwZW9mIGlucHV0ID09PSAnc3RyaW5nJykgewogICAgICAgICAgICBpZiAoIWlzTmFOKGlucHV0KSkgewogICAgICAgICAgICAgICAgaW5wdXQgPSBwYXJzZUludChpbnB1dCwgMTApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgaW5wdXQgPSBsYW5ndWFnZS53ZWVrZGF5c1BhcnNlKGlucHV0KTsKICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgaW5wdXQgIT09ICdudW1iZXInKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGlucHV0OwogICAgfQoKICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAgICAgICBSZWxhdGl2ZSBUaW1lCiAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCgoKICAgIC8vIGhlbHBlciBmdW5jdGlvbiBmb3IgbW9tZW50LmZuLmZyb20sIG1vbWVudC5mbi5mcm9tTm93LCBhbmQgbW9tZW50LmR1cmF0aW9uLmZuLmh1bWFuaXplCiAgICBmdW5jdGlvbiBzdWJzdGl0dXRlVGltZUFnbyhzdHJpbmcsIG51bWJlciwgd2l0aG91dFN1ZmZpeCwgaXNGdXR1cmUsIGxhbmcpIHsKICAgICAgICByZXR1cm4gbGFuZy5yZWxhdGl2ZVRpbWUobnVtYmVyIHx8IDEsICEhd2l0aG91dFN1ZmZpeCwgc3RyaW5nLCBpc0Z1dHVyZSk7CiAgICB9CgogICAgZnVuY3Rpb24gcmVsYXRpdmVUaW1lKG1pbGxpc2Vjb25kcywgd2l0aG91dFN1ZmZpeCwgbGFuZykgewogICAgICAgIHZhciBzZWNvbmRzID0gcm91bmQoTWF0aC5hYnMobWlsbGlzZWNvbmRzKSAvIDEwMDApLAogICAgICAgICAgICBtaW51dGVzID0gcm91bmQoc2Vjb25kcyAvIDYwKSwKICAgICAgICAgICAgaG91cnMgPSByb3VuZChtaW51dGVzIC8gNjApLAogICAgICAgICAgICBkYXlzID0gcm91bmQoaG91cnMgLyAyNCksCiAgICAgICAgICAgIHllYXJzID0gcm91bmQoZGF5cyAvIDM2NSksCiAgICAgICAgICAgIGFyZ3MgPSBzZWNvbmRzIDwgNDUgJiYgWydzJywgc2Vjb25kc10gfHwKICAgICAgICAgICAgICAgIG1pbnV0ZXMgPT09IDEgJiYgWydtJ10gfHwKICAgICAgICAgICAgICAgIG1pbnV0ZXMgPCA0NSAmJiBbJ21tJywgbWludXRlc10gfHwKICAgICAgICAgICAgICAgIGhvdXJzID09PSAxICYmIFsnaCddIHx8CiAgICAgICAgICAgICAgICBob3VycyA8IDIyICYmIFsnaGgnLCBob3Vyc10gfHwKICAgICAgICAgICAgICAgIGRheXMgPT09IDEgJiYgWydkJ10gfHwKICAgICAgICAgICAgICAgIGRheXMgPD0gMjUgJiYgWydkZCcsIGRheXNdIHx8CiAgICAgICAgICAgICAgICBkYXlzIDw9IDQ1ICYmIFsnTSddIHx8CiAgICAgICAgICAgICAgICBkYXlzIDwgMzQ1ICYmIFsnTU0nLCByb3VuZChkYXlzIC8gMzApXSB8fAogICAgICAgICAgICAgICAgeWVhcnMgPT09IDEgJiYgWyd5J10gfHwgWyd5eScsIHllYXJzXTsKICAgICAgICBhcmdzWzJdID0gd2l0aG91dFN1ZmZpeDsKICAgICAgICBhcmdzWzNdID0gbWlsbGlzZWNvbmRzID4gMDsKICAgICAgICBhcmdzWzRdID0gbGFuZzsKICAgICAgICByZXR1cm4gc3Vic3RpdHV0ZVRpbWVBZ28uYXBwbHkoe30sIGFyZ3MpOwogICAgfQoKCiAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAgICAgV2VlayBvZiBZZWFyCiAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCgoKICAgIC8vIGZpcnN0RGF5T2ZXZWVrICAgICAgIDAgPSBzdW4sIDYgPSBzYXQKICAgIC8vICAgICAgICAgICAgICAgICAgICAgIHRoZSBkYXkgb2YgdGhlIHdlZWsgdGhhdCBzdGFydHMgdGhlIHdlZWsKICAgIC8vICAgICAgICAgICAgICAgICAgICAgICh1c3VhbGx5IHN1bmRheSBvciBtb25kYXkpCiAgICAvLyBmaXJzdERheU9mV2Vla09mWWVhciAwID0gc3VuLCA2ID0gc2F0CiAgICAvLyAgICAgICAgICAgICAgICAgICAgICB0aGUgZmlyc3Qgd2VlayBpcyB0aGUgd2VlayB0aGF0IGNvbnRhaW5zIHRoZSBmaXJzdAogICAgLy8gICAgICAgICAgICAgICAgICAgICAgb2YgdGhpcyBkYXkgb2YgdGhlIHdlZWsKICAgIC8vICAgICAgICAgICAgICAgICAgICAgIChlZy4gSVNPIHdlZWtzIHVzZSB0aHVyc2RheSAoNCkpCiAgICBmdW5jdGlvbiB3ZWVrT2ZZZWFyKG1vbSwgZmlyc3REYXlPZldlZWssIGZpcnN0RGF5T2ZXZWVrT2ZZZWFyKSB7CiAgICAgICAgdmFyIGVuZCA9IGZpcnN0RGF5T2ZXZWVrT2ZZZWFyIC0gZmlyc3REYXlPZldlZWssCiAgICAgICAgICAgIGRheXNUb0RheU9mV2VlayA9IGZpcnN0RGF5T2ZXZWVrT2ZZZWFyIC0gbW9tLmRheSgpLAogICAgICAgICAgICBhZGp1c3RlZE1vbWVudDsKCgogICAgICAgIGlmIChkYXlzVG9EYXlPZldlZWsgPiBlbmQpIHsKICAgICAgICAgICAgZGF5c1RvRGF5T2ZXZWVrIC09IDc7CiAgICAgICAgfQoKICAgICAgICBpZiAoZGF5c1RvRGF5T2ZXZWVrIDwgZW5kIC0gNykgewogICAgICAgICAgICBkYXlzVG9EYXlPZldlZWsgKz0gNzsKICAgICAgICB9CgogICAgICAgIGFkanVzdGVkTW9tZW50ID0gbW9tZW50KG1vbSkuYWRkKCdkJywgZGF5c1RvRGF5T2ZXZWVrKTsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICB3ZWVrOiBNYXRoLmNlaWwoYWRqdXN0ZWRNb21lbnQuZGF5T2ZZZWFyKCkgLyA3KSwKICAgICAgICAgICAgeWVhcjogYWRqdXN0ZWRNb21lbnQueWVhcigpCiAgICAgICAgfTsKICAgIH0KCiAgICAvL2h0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvSVNPX3dlZWtfZGF0ZSNDYWxjdWxhdGluZ19hX2RhdGVfZ2l2ZW5fdGhlX3llYXIuMkNfd2Vla19udW1iZXJfYW5kX3dlZWtkYXkKICAgIGZ1bmN0aW9uIGRheU9mWWVhckZyb21XZWVrcyh5ZWFyLCB3ZWVrLCB3ZWVrZGF5LCBmaXJzdERheU9mV2Vla09mWWVhciwgZmlyc3REYXlPZldlZWspIHsKICAgICAgICB2YXIgZCA9IG1ha2VVVENEYXRlKHllYXIsIDAsIDEpLmdldFVUQ0RheSgpLCBkYXlzVG9BZGQsIGRheU9mWWVhcjsKCiAgICAgICAgd2Vla2RheSA9IHdlZWtkYXkgIT0gbnVsbCA/IHdlZWtkYXkgOiBmaXJzdERheU9mV2VlazsKICAgICAgICBkYXlzVG9BZGQgPSBmaXJzdERheU9mV2VlayAtIGQgKyAoZCA+IGZpcnN0RGF5T2ZXZWVrT2ZZZWFyID8gNyA6IDApIC0gKGQgPCBmaXJzdERheU9mV2VlayA/IDcgOiAwKTsKICAgICAgICBkYXlPZlllYXIgPSA3ICogKHdlZWsgLSAxKSArICh3ZWVrZGF5IC0gZmlyc3REYXlPZldlZWspICsgZGF5c1RvQWRkICsgMTsKCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgeWVhcjogZGF5T2ZZZWFyID4gMCA/IHllYXIgOiB5ZWFyIC0gMSwKICAgICAgICAgICAgZGF5T2ZZZWFyOiBkYXlPZlllYXIgPiAwID8gIGRheU9mWWVhciA6IGRheXNJblllYXIoeWVhciAtIDEpICsgZGF5T2ZZZWFyCiAgICAgICAgfTsKICAgIH0KCiAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAgICAgVG9wIExldmVsIEZ1bmN0aW9ucwogICAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwoKICAgIGZ1bmN0aW9uIG1ha2VNb21lbnQoY29uZmlnKSB7CiAgICAgICAgdmFyIGlucHV0ID0gY29uZmlnLl9pLAogICAgICAgICAgICBmb3JtYXQgPSBjb25maWcuX2Y7CgogICAgICAgIGlmIChpbnB1dCA9PT0gbnVsbCB8fCAoZm9ybWF0ID09PSB1bmRlZmluZWQgJiYgaW5wdXQgPT09ICcnKSkgewogICAgICAgICAgICByZXR1cm4gbW9tZW50LmludmFsaWQoe251bGxJbnB1dDogdHJ1ZX0pOwogICAgICAgIH0KCiAgICAgICAgaWYgKHR5cGVvZiBpbnB1dCA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgY29uZmlnLl9pID0gaW5wdXQgPSBnZXRMYW5nRGVmaW5pdGlvbigpLnByZXBhcnNlKGlucHV0KTsKICAgICAgICB9CgogICAgICAgIGlmIChtb21lbnQuaXNNb21lbnQoaW5wdXQpKSB7CiAgICAgICAgICAgIGNvbmZpZyA9IGNsb25lTW9tZW50KGlucHV0KTsKCiAgICAgICAgICAgIGNvbmZpZy5fZCA9IG5ldyBEYXRlKCtpbnB1dC5fZCk7CiAgICAgICAgfSBlbHNlIGlmIChmb3JtYXQpIHsKICAgICAgICAgICAgaWYgKGlzQXJyYXkoZm9ybWF0KSkgewogICAgICAgICAgICAgICAgbWFrZURhdGVGcm9tU3RyaW5nQW5kQXJyYXkoY29uZmlnKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG1ha2VEYXRlRnJvbVN0cmluZ0FuZEZvcm1hdChjb25maWcpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbWFrZURhdGVGcm9tSW5wdXQoY29uZmlnKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBuZXcgTW9tZW50KGNvbmZpZyk7CiAgICB9CgogICAgbW9tZW50ID0gZnVuY3Rpb24gKGlucHV0LCBmb3JtYXQsIGxhbmcsIHN0cmljdCkgewogICAgICAgIHZhciBjOwoKICAgICAgICBpZiAodHlwZW9mKGxhbmcpID09PSAiYm9vbGVhbiIpIHsKICAgICAgICAgICAgc3RyaWN0ID0gbGFuZzsKICAgICAgICAgICAgbGFuZyA9IHVuZGVmaW5lZDsKICAgICAgICB9CiAgICAgICAgLy8gb2JqZWN0IGNvbnN0cnVjdGlvbiBtdXN0IGJlIGRvbmUgdGhpcyB3YXkuCiAgICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL21vbWVudC9tb21lbnQvaXNzdWVzLzE0MjMKICAgICAgICBjID0ge307CiAgICAgICAgYy5faXNBTW9tZW50T2JqZWN0ID0gdHJ1ZTsKICAgICAgICBjLl9pID0gaW5wdXQ7CiAgICAgICAgYy5fZiA9IGZvcm1hdDsKICAgICAgICBjLl9sID0gbGFuZzsKICAgICAgICBjLl9zdHJpY3QgPSBzdHJpY3Q7CiAgICAgICAgYy5faXNVVEMgPSBmYWxzZTsKICAgICAgICBjLl9wZiA9IGRlZmF1bHRQYXJzaW5nRmxhZ3MoKTsKCiAgICAgICAgcmV0dXJuIG1ha2VNb21lbnQoYyk7CiAgICB9OwoKICAgIG1vbWVudC5zdXBwcmVzc0RlcHJlY2F0aW9uV2FybmluZ3MgPSBmYWxzZTsKCiAgICBtb21lbnQuY3JlYXRlRnJvbUlucHV0RmFsbGJhY2sgPSBkZXByZWNhdGUoCiAgICAgICAgICAgICJtb21lbnQgY29uc3RydWN0aW9uIGZhbGxzIGJhY2sgdG8ganMgRGF0ZS4gVGhpcyBpcyAiICsKICAgICAgICAgICAgImRpc2NvdXJhZ2VkIGFuZCB3aWxsIGJlIHJlbW92ZWQgaW4gdXBjb21pbmcgbWFqb3IgIiArCiAgICAgICAgICAgICJyZWxlYXNlLiBQbGVhc2UgcmVmZXIgdG8gIiArCiAgICAgICAgICAgICJodHRwczovL2dpdGh1Yi5jb20vbW9tZW50L21vbWVudC9pc3N1ZXMvMTQwNyBmb3IgbW9yZSBpbmZvLiIsCiAgICAgICAgICAgIGZ1bmN0aW9uIChjb25maWcpIHsKICAgICAgICBjb25maWcuX2QgPSBuZXcgRGF0ZShjb25maWcuX2kpOwogICAgfSk7CgogICAgLy8gY3JlYXRpbmcgd2l0aCB1dGMKICAgIG1vbWVudC51dGMgPSBmdW5jdGlvbiAoaW5wdXQsIGZvcm1hdCwgbGFuZywgc3RyaWN0KSB7CiAgICAgICAgdmFyIGM7CgogICAgICAgIGlmICh0eXBlb2YobGFuZykgPT09ICJib29sZWFuIikgewogICAgICAgICAgICBzdHJpY3QgPSBsYW5nOwogICAgICAgICAgICBsYW5nID0gdW5kZWZpbmVkOwogICAgICAgIH0KICAgICAgICAvLyBvYmplY3QgY29uc3RydWN0aW9uIG11c3QgYmUgZG9uZSB0aGlzIHdheS4KICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vbW9tZW50L21vbWVudC9pc3N1ZXMvMTQyMwogICAgICAgIGMgPSB7fTsKICAgICAgICBjLl9pc0FNb21lbnRPYmplY3QgPSB0cnVlOwogICAgICAgIGMuX3VzZVVUQyA9IHRydWU7CiAgICAgICAgYy5faXNVVEMgPSB0cnVlOwogICAgICAgIGMuX2wgPSBsYW5nOwogICAgICAgIGMuX2kgPSBpbnB1dDsKICAgICAgICBjLl9mID0gZm9ybWF0OwogICAgICAgIGMuX3N0cmljdCA9IHN0cmljdDsKICAgICAgICBjLl9wZiA9IGRlZmF1bHRQYXJzaW5nRmxhZ3MoKTsKCiAgICAgICAgcmV0dXJuIG1ha2VNb21lbnQoYykudXRjKCk7CiAgICB9OwoKICAgIC8vIGNyZWF0aW5nIHdpdGggdW5peCB0aW1lc3RhbXAgKGluIHNlY29uZHMpCiAgICBtb21lbnQudW5peCA9IGZ1bmN0aW9uIChpbnB1dCkgewogICAgICAgIHJldHVybiBtb21lbnQoaW5wdXQgKiAxMDAwKTsKICAgIH07CgogICAgLy8gZHVyYXRpb24KICAgIG1vbWVudC5kdXJhdGlvbiA9IGZ1bmN0aW9uIChpbnB1dCwga2V5KSB7CiAgICAgICAgdmFyIGR1cmF0aW9uID0gaW5wdXQsCiAgICAgICAgICAgIC8vIG1hdGNoaW5nIGFnYWluc3QgcmVnZXhwIGlzIGV4cGVuc2l2ZSwgZG8gaXQgb24gZGVtYW5kCiAgICAgICAgICAgIG1hdGNoID0gbnVsbCwKICAgICAgICAgICAgc2lnbiwKICAgICAgICAgICAgcmV0LAogICAgICAgICAgICBwYXJzZUlzbzsKCiAgICAgICAgaWYgKG1vbWVudC5pc0R1cmF0aW9uKGlucHV0KSkgewogICAgICAgICAgICBkdXJhdGlvbiA9IHsKICAgICAgICAgICAgICAgIG1zOiBpbnB1dC5fbWlsbGlzZWNvbmRzLAogICAgICAgICAgICAgICAgZDogaW5wdXQuX2RheXMsCiAgICAgICAgICAgICAgICBNOiBpbnB1dC5fbW9udGhzCiAgICAgICAgICAgIH07CiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgaW5wdXQgPT09ICdudW1iZXInKSB7CiAgICAgICAgICAgIGR1cmF0aW9uID0ge307CiAgICAgICAgICAgIGlmIChrZXkpIHsKICAgICAgICAgICAgICAgIGR1cmF0aW9uW2tleV0gPSBpbnB1dDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGR1cmF0aW9uLm1pbGxpc2Vjb25kcyA9IGlucHV0OwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmICghIShtYXRjaCA9IGFzcE5ldFRpbWVTcGFuSnNvblJlZ2V4LmV4ZWMoaW5wdXQpKSkgewogICAgICAgICAgICBzaWduID0gKG1hdGNoWzFdID09PSAiLSIpID8gLTEgOiAxOwogICAgICAgICAgICBkdXJhdGlvbiA9IHsKICAgICAgICAgICAgICAgIHk6IDAsCiAgICAgICAgICAgICAgICBkOiB0b0ludChtYXRjaFtEQVRFXSkgKiBzaWduLAogICAgICAgICAgICAgICAgaDogdG9JbnQobWF0Y2hbSE9VUl0pICogc2lnbiwKICAgICAgICAgICAgICAgIG06IHRvSW50KG1hdGNoW01JTlVURV0pICogc2lnbiwKICAgICAgICAgICAgICAgIHM6IHRvSW50KG1hdGNoW1NFQ09ORF0pICogc2lnbiwKICAgICAgICAgICAgICAgIG1zOiB0b0ludChtYXRjaFtNSUxMSVNFQ09ORF0pICogc2lnbgogICAgICAgICAgICB9OwogICAgICAgIH0gZWxzZSBpZiAoISEobWF0Y2ggPSBpc29EdXJhdGlvblJlZ2V4LmV4ZWMoaW5wdXQpKSkgewogICAgICAgICAgICBzaWduID0gKG1hdGNoWzFdID09PSAiLSIpID8gLTEgOiAxOwogICAgICAgICAgICBwYXJzZUlzbyA9IGZ1bmN0aW9uIChpbnApIHsKICAgICAgICAgICAgICAgIC8vIFdlJ2Qgbm9ybWFsbHkgdXNlIH5+aW5wIGZvciB0aGlzLCBidXQgdW5mb3J0dW5hdGVseSBpdCBhbHNvCiAgICAgICAgICAgICAgICAvLyBjb252ZXJ0cyBmbG9hdHMgdG8gaW50cy4KICAgICAgICAgICAgICAgIC8vIGlucCBtYXkgYmUgdW5kZWZpbmVkLCBzbyBjYXJlZnVsIGNhbGxpbmcgcmVwbGFjZSBvbiBpdC4KICAgICAgICAgICAgICAgIHZhciByZXMgPSBpbnAgJiYgcGFyc2VGbG9hdChpbnAucmVwbGFjZSgnLCcsICcuJykpOwogICAgICAgICAgICAgICAgLy8gYXBwbHkgc2lnbiB3aGlsZSB3ZSdyZSBhdCBpdAogICAgICAgICAgICAgICAgcmV0dXJuIChpc05hTihyZXMpID8gMCA6IHJlcykgKiBzaWduOwogICAgICAgICAgICB9OwogICAgICAgICAgICBkdXJhdGlvbiA9IHsKICAgICAgICAgICAgICAgIHk6IHBhcnNlSXNvKG1hdGNoWzJdKSwKICAgICAgICAgICAgICAgIE06IHBhcnNlSXNvKG1hdGNoWzNdKSwKICAgICAgICAgICAgICAgIGQ6IHBhcnNlSXNvKG1hdGNoWzRdKSwKICAgICAgICAgICAgICAgIGg6IHBhcnNlSXNvKG1hdGNoWzVdKSwKICAgICAgICAgICAgICAgIG06IHBhcnNlSXNvKG1hdGNoWzZdKSwKICAgICAgICAgICAgICAgIHM6IHBhcnNlSXNvKG1hdGNoWzddKSwKICAgICAgICAgICAgICAgIHc6IHBhcnNlSXNvKG1hdGNoWzhdKQogICAgICAgICAgICB9OwogICAgICAgIH0KCiAgICAgICAgcmV0ID0gbmV3IER1cmF0aW9uKGR1cmF0aW9uKTsKCiAgICAgICAgaWYgKG1vbWVudC5pc0R1cmF0aW9uKGlucHV0KSAmJiBpbnB1dC5oYXNPd25Qcm9wZXJ0eSgnX2xhbmcnKSkgewogICAgICAgICAgICByZXQuX2xhbmcgPSBpbnB1dC5fbGFuZzsKICAgICAgICB9CgogICAgICAgIHJldHVybiByZXQ7CiAgICB9OwoKICAgIC8vIHZlcnNpb24gbnVtYmVyCiAgICBtb21lbnQudmVyc2lvbiA9IFZFUlNJT047CgogICAgLy8gZGVmYXVsdCBmb3JtYXQKICAgIG1vbWVudC5kZWZhdWx0Rm9ybWF0ID0gaXNvRm9ybWF0OwoKICAgIC8vIFBsdWdpbnMgdGhhdCBhZGQgcHJvcGVydGllcyBzaG91bGQgYWxzbyBhZGQgdGhlIGtleSBoZXJlIChudWxsIHZhbHVlKSwKICAgIC8vIHNvIHdlIGNhbiBwcm9wZXJseSBjbG9uZSBvdXJzZWx2ZXMuCiAgICBtb21lbnQubW9tZW50UHJvcGVydGllcyA9IG1vbWVudFByb3BlcnRpZXM7CgogICAgLy8gVGhpcyBmdW5jdGlvbiB3aWxsIGJlIGNhbGxlZCB3aGVuZXZlciBhIG1vbWVudCBpcyBtdXRhdGVkLgogICAgLy8gSXQgaXMgaW50ZW5kZWQgdG8ga2VlcCB0aGUgb2Zmc2V0IGluIHN5bmMgd2l0aCB0aGUgdGltZXpvbmUuCiAgICBtb21lbnQudXBkYXRlT2Zmc2V0ID0gZnVuY3Rpb24gKCkge307CgogICAgLy8gVGhpcyBmdW5jdGlvbiB3aWxsIGxvYWQgbGFuZ3VhZ2VzIGFuZCB0aGVuIHNldCB0aGUgZ2xvYmFsIGxhbmd1YWdlLiAgSWYKICAgIC8vIG5vIGFyZ3VtZW50cyBhcmUgcGFzc2VkIGluLCBpdCB3aWxsIHNpbXBseSByZXR1cm4gdGhlIGN1cnJlbnQgZ2xvYmFsCiAgICAvLyBsYW5ndWFnZSBrZXkuCiAgICBtb21lbnQubGFuZyA9IGZ1bmN0aW9uIChrZXksIHZhbHVlcykgewogICAgICAgIHZhciByOwogICAgICAgIGlmICgha2V5KSB7CiAgICAgICAgICAgIHJldHVybiBtb21lbnQuZm4uX2xhbmcuX2FiYnI7CiAgICAgICAgfQogICAgICAgIGlmICh2YWx1ZXMpIHsKICAgICAgICAgICAgbG9hZExhbmcobm9ybWFsaXplTGFuZ3VhZ2Uoa2V5KSwgdmFsdWVzKTsKICAgICAgICB9IGVsc2UgaWYgKHZhbHVlcyA9PT0gbnVsbCkgewogICAgICAgICAgICB1bmxvYWRMYW5nKGtleSk7CiAgICAgICAgICAgIGtleSA9ICdlbic7CiAgICAgICAgfSBlbHNlIGlmICghbGFuZ3VhZ2VzW2tleV0pIHsKICAgICAgICAgICAgZ2V0TGFuZ0RlZmluaXRpb24oa2V5KTsKICAgICAgICB9CiAgICAgICAgciA9IG1vbWVudC5kdXJhdGlvbi5mbi5fbGFuZyA9IG1vbWVudC5mbi5fbGFuZyA9IGdldExhbmdEZWZpbml0aW9uKGtleSk7CiAgICAgICAgcmV0dXJuIHIuX2FiYnI7CiAgICB9OwoKICAgIC8vIHJldHVybnMgbGFuZ3VhZ2UgZGF0YQogICAgbW9tZW50LmxhbmdEYXRhID0gZnVuY3Rpb24gKGtleSkgewogICAgICAgIGlmIChrZXkgJiYga2V5Ll9sYW5nICYmIGtleS5fbGFuZy5fYWJicikgewogICAgICAgICAgICBrZXkgPSBrZXkuX2xhbmcuX2FiYnI7CiAgICAgICAgfQogICAgICAgIHJldHVybiBnZXRMYW5nRGVmaW5pdGlvbihrZXkpOwogICAgfTsKCiAgICAvLyBjb21wYXJlIG1vbWVudCBvYmplY3QKICAgIG1vbWVudC5pc01vbWVudCA9IGZ1bmN0aW9uIChvYmopIHsKICAgICAgICByZXR1cm4gb2JqIGluc3RhbmNlb2YgTW9tZW50IHx8CiAgICAgICAgICAgIChvYmogIT0gbnVsbCAmJiAgb2JqLmhhc093blByb3BlcnR5KCdfaXNBTW9tZW50T2JqZWN0JykpOwogICAgfTsKCiAgICAvLyBmb3IgdHlwZWNoZWNraW5nIER1cmF0aW9uIG9iamVjdHMKICAgIG1vbWVudC5pc0R1cmF0aW9uID0gZnVuY3Rpb24gKG9iaikgewogICAgICAgIHJldHVybiBvYmogaW5zdGFuY2VvZiBEdXJhdGlvbjsKICAgIH07CgogICAgZm9yIChpID0gbGlzdHMubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHsKICAgICAgICBtYWtlTGlzdChsaXN0c1tpXSk7CiAgICB9CgogICAgbW9tZW50Lm5vcm1hbGl6ZVVuaXRzID0gZnVuY3Rpb24gKHVuaXRzKSB7CiAgICAgICAgcmV0dXJuIG5vcm1hbGl6ZVVuaXRzKHVuaXRzKTsKICAgIH07CgogICAgbW9tZW50LmludmFsaWQgPSBmdW5jdGlvbiAoZmxhZ3MpIHsKICAgICAgICB2YXIgbSA9IG1vbWVudC51dGMoTmFOKTsKICAgICAgICBpZiAoZmxhZ3MgIT0gbnVsbCkgewogICAgICAgICAgICBleHRlbmQobS5fcGYsIGZsYWdzKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIG0uX3BmLnVzZXJJbnZhbGlkYXRlZCA9IHRydWU7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbTsKICAgIH07CgogICAgbW9tZW50LnBhcnNlWm9uZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gbW9tZW50LmFwcGx5KG51bGwsIGFyZ3VtZW50cykucGFyc2Vab25lKCk7CiAgICB9OwoKICAgIG1vbWVudC5wYXJzZVR3b0RpZ2l0WWVhciA9IGZ1bmN0aW9uIChpbnB1dCkgewogICAgICAgIHJldHVybiB0b0ludChpbnB1dCkgKyAodG9JbnQoaW5wdXQpID4gNjggPyAxOTAwIDogMjAwMCk7CiAgICB9OwoKICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAgICAgICBNb21lbnQgUHJvdG90eXBlCiAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCgoKICAgIGV4dGVuZChtb21lbnQuZm4gPSBNb21lbnQucHJvdG90eXBlLCB7CgogICAgICAgIGNsb25lIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gbW9tZW50KHRoaXMpOwogICAgICAgIH0sCgogICAgICAgIHZhbHVlT2YgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiArdGhpcy5fZCArICgodGhpcy5fb2Zmc2V0IHx8IDApICogNjAwMDApOwogICAgICAgIH0sCgogICAgICAgIHVuaXggOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBNYXRoLmZsb29yKCt0aGlzIC8gMTAwMCk7CiAgICAgICAgfSwKCiAgICAgICAgdG9TdHJpbmcgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmNsb25lKCkubGFuZygnZW4nKS5mb3JtYXQoImRkZCBNTU0gREQgWVlZWSBISDptbTpzcyBbR01UXVpaIik7CiAgICAgICAgfSwKCiAgICAgICAgdG9EYXRlIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fb2Zmc2V0ID8gbmV3IERhdGUoK3RoaXMpIDogdGhpcy5fZDsKICAgICAgICB9LAoKICAgICAgICB0b0lTT1N0cmluZyA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIG0gPSBtb21lbnQodGhpcykudXRjKCk7CiAgICAgICAgICAgIGlmICgwIDwgbS55ZWFyKCkgJiYgbS55ZWFyKCkgPD0gOTk5OSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZvcm1hdE1vbWVudChtLCAnWVlZWS1NTS1ERFtUXUhIOm1tOnNzLlNTU1taXScpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIGZvcm1hdE1vbWVudChtLCAnWVlZWVlZLU1NLUREW1RdSEg6bW06c3MuU1NTW1pdJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAoKICAgICAgICB0b0FycmF5IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgbSA9IHRoaXM7CiAgICAgICAgICAgIHJldHVybiBbCiAgICAgICAgICAgICAgICBtLnllYXIoKSwKICAgICAgICAgICAgICAgIG0ubW9udGgoKSwKICAgICAgICAgICAgICAgIG0uZGF0ZSgpLAogICAgICAgICAgICAgICAgbS5ob3VycygpLAogICAgICAgICAgICAgICAgbS5taW51dGVzKCksCiAgICAgICAgICAgICAgICBtLnNlY29uZHMoKSwKICAgICAgICAgICAgICAgIG0ubWlsbGlzZWNvbmRzKCkKICAgICAgICAgICAgXTsKICAgICAgICB9LAoKICAgICAgICBpc1ZhbGlkIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gaXNWYWxpZCh0aGlzKTsKICAgICAgICB9LAoKICAgICAgICBpc0RTVFNoaWZ0ZWQgOiBmdW5jdGlvbiAoKSB7CgogICAgICAgICAgICBpZiAodGhpcy5fYSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaXNWYWxpZCgpICYmIGNvbXBhcmVBcnJheXModGhpcy5fYSwgKHRoaXMuX2lzVVRDID8gbW9tZW50LnV0Yyh0aGlzLl9hKSA6IG1vbWVudCh0aGlzLl9hKSkudG9BcnJheSgpKSA+IDA7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9LAoKICAgICAgICBwYXJzaW5nRmxhZ3MgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBleHRlbmQoe30sIHRoaXMuX3BmKTsKICAgICAgICB9LAoKICAgICAgICBpbnZhbGlkQXQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3BmLm92ZXJmbG93OwogICAgICAgIH0sCgogICAgICAgIHV0YyA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuem9uZSgwKTsKICAgICAgICB9LAoKICAgICAgICBsb2NhbCA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdGhpcy56b25lKDApOwogICAgICAgICAgICB0aGlzLl9pc1VUQyA9IGZhbHNlOwogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9LAoKICAgICAgICBmb3JtYXQgOiBmdW5jdGlvbiAoaW5wdXRTdHJpbmcpIHsKICAgICAgICAgICAgdmFyIG91dHB1dCA9IGZvcm1hdE1vbWVudCh0aGlzLCBpbnB1dFN0cmluZyB8fCBtb21lbnQuZGVmYXVsdEZvcm1hdCk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmxhbmcoKS5wb3N0Zm9ybWF0KG91dHB1dCk7CiAgICAgICAgfSwKCiAgICAgICAgYWRkIDogZnVuY3Rpb24gKGlucHV0LCB2YWwpIHsKICAgICAgICAgICAgdmFyIGR1cjsKICAgICAgICAgICAgLy8gc3dpdGNoIGFyZ3MgdG8gc3VwcG9ydCBhZGQoJ3MnLCAxKSBhbmQgYWRkKDEsICdzJykKICAgICAgICAgICAgaWYgKHR5cGVvZiBpbnB1dCA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgICAgIGR1ciA9IG1vbWVudC5kdXJhdGlvbigrdmFsLCBpbnB1dCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBkdXIgPSBtb21lbnQuZHVyYXRpb24oaW5wdXQsIHZhbCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYWRkT3JTdWJ0cmFjdER1cmF0aW9uRnJvbU1vbWVudCh0aGlzLCBkdXIsIDEpOwogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9LAoKICAgICAgICBzdWJ0cmFjdCA6IGZ1bmN0aW9uIChpbnB1dCwgdmFsKSB7CiAgICAgICAgICAgIHZhciBkdXI7CiAgICAgICAgICAgIC8vIHN3aXRjaCBhcmdzIHRvIHN1cHBvcnQgc3VidHJhY3QoJ3MnLCAxKSBhbmQgc3VidHJhY3QoMSwgJ3MnKQogICAgICAgICAgICBpZiAodHlwZW9mIGlucHV0ID09PSAnc3RyaW5nJykgewogICAgICAgICAgICAgICAgZHVyID0gbW9tZW50LmR1cmF0aW9uKCt2YWwsIGlucHV0KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGR1ciA9IG1vbWVudC5kdXJhdGlvbihpbnB1dCwgdmFsKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBhZGRPclN1YnRyYWN0RHVyYXRpb25Gcm9tTW9tZW50KHRoaXMsIGR1ciwgLTEpOwogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9LAoKICAgICAgICBkaWZmIDogZnVuY3Rpb24gKGlucHV0LCB1bml0cywgYXNGbG9hdCkgewogICAgICAgICAgICB2YXIgdGhhdCA9IG1ha2VBcyhpbnB1dCwgdGhpcyksCiAgICAgICAgICAgICAgICB6b25lRGlmZiA9ICh0aGlzLnpvbmUoKSAtIHRoYXQuem9uZSgpKSAqIDZlNCwKICAgICAgICAgICAgICAgIGRpZmYsIG91dHB1dDsKCiAgICAgICAgICAgIHVuaXRzID0gbm9ybWFsaXplVW5pdHModW5pdHMpOwoKICAgICAgICAgICAgaWYgKHVuaXRzID09PSAneWVhcicgfHwgdW5pdHMgPT09ICdtb250aCcpIHsKICAgICAgICAgICAgICAgIC8vIGF2ZXJhZ2UgbnVtYmVyIG9mIGRheXMgaW4gdGhlIG1vbnRocyBpbiB0aGUgZ2l2ZW4gZGF0ZXMKICAgICAgICAgICAgICAgIGRpZmYgPSAodGhpcy5kYXlzSW5Nb250aCgpICsgdGhhdC5kYXlzSW5Nb250aCgpKSAqIDQzMmU1OyAvLyAyNCAqIDYwICogNjAgKiAxMDAwIC8gMgogICAgICAgICAgICAgICAgLy8gZGlmZmVyZW5jZSBpbiBtb250aHMKICAgICAgICAgICAgICAgIG91dHB1dCA9ICgodGhpcy55ZWFyKCkgLSB0aGF0LnllYXIoKSkgKiAxMikgKyAodGhpcy5tb250aCgpIC0gdGhhdC5tb250aCgpKTsKICAgICAgICAgICAgICAgIC8vIGFkanVzdCBieSB0YWtpbmcgZGlmZmVyZW5jZSBpbiBkYXlzLCBhdmVyYWdlIG51bWJlciBvZiBkYXlzCiAgICAgICAgICAgICAgICAvLyBhbmQgZHN0IGluIHRoZSBnaXZlbiBtb250aHMuCiAgICAgICAgICAgICAgICBvdXRwdXQgKz0gKCh0aGlzIC0gbW9tZW50KHRoaXMpLnN0YXJ0T2YoJ21vbnRoJykpIC0KICAgICAgICAgICAgICAgICAgICAgICAgKHRoYXQgLSBtb21lbnQodGhhdCkuc3RhcnRPZignbW9udGgnKSkpIC8gZGlmZjsKICAgICAgICAgICAgICAgIC8vIHNhbWUgYXMgYWJvdmUgYnV0IHdpdGggem9uZXMsIHRvIG5lZ2F0ZSBhbGwgZHN0CiAgICAgICAgICAgICAgICBvdXRwdXQgLT0gKCh0aGlzLnpvbmUoKSAtIG1vbWVudCh0aGlzKS5zdGFydE9mKCdtb250aCcpLnpvbmUoKSkgLQogICAgICAgICAgICAgICAgICAgICAgICAodGhhdC56b25lKCkgLSBtb21lbnQodGhhdCkuc3RhcnRPZignbW9udGgnKS56b25lKCkpKSAqIDZlNCAvIGRpZmY7CiAgICAgICAgICAgICAgICBpZiAodW5pdHMgPT09ICd5ZWFyJykgewogICAgICAgICAgICAgICAgICAgIG91dHB1dCA9IG91dHB1dCAvIDEyOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZGlmZiA9ICh0aGlzIC0gdGhhdCk7CiAgICAgICAgICAgICAgICBvdXRwdXQgPSB1bml0cyA9PT0gJ3NlY29uZCcgPyBkaWZmIC8gMWUzIDogLy8gMTAwMAogICAgICAgICAgICAgICAgICAgIHVuaXRzID09PSAnbWludXRlJyA/IGRpZmYgLyA2ZTQgOiAvLyAxMDAwICogNjAKICAgICAgICAgICAgICAgICAgICB1bml0cyA9PT0gJ2hvdXInID8gZGlmZiAvIDM2ZTUgOiAvLyAxMDAwICogNjAgKiA2MAogICAgICAgICAgICAgICAgICAgIHVuaXRzID09PSAnZGF5JyA/IChkaWZmIC0gem9uZURpZmYpIC8gODY0ZTUgOiAvLyAxMDAwICogNjAgKiA2MCAqIDI0LCBuZWdhdGUgZHN0CiAgICAgICAgICAgICAgICAgICAgdW5pdHMgPT09ICd3ZWVrJyA/IChkaWZmIC0gem9uZURpZmYpIC8gNjA0OGU1IDogLy8gMTAwMCAqIDYwICogNjAgKiAyNCAqIDcsIG5lZ2F0ZSBkc3QKICAgICAgICAgICAgICAgICAgICBkaWZmOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBhc0Zsb2F0ID8gb3V0cHV0IDogYWJzUm91bmQob3V0cHV0KTsKICAgICAgICB9LAoKICAgICAgICBmcm9tIDogZnVuY3Rpb24gKHRpbWUsIHdpdGhvdXRTdWZmaXgpIHsKICAgICAgICAgICAgcmV0dXJuIG1vbWVudC5kdXJhdGlvbih0aGlzLmRpZmYodGltZSkpLmxhbmcodGhpcy5sYW5nKCkuX2FiYnIpLmh1bWFuaXplKCF3aXRob3V0U3VmZml4KTsKICAgICAgICB9LAoKICAgICAgICBmcm9tTm93IDogZnVuY3Rpb24gKHdpdGhvdXRTdWZmaXgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZnJvbShtb21lbnQoKSwgd2l0aG91dFN1ZmZpeCk7CiAgICAgICAgfSwKCiAgICAgICAgY2FsZW5kYXIgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIC8vIFdlIHdhbnQgdG8gY29tcGFyZSB0aGUgc3RhcnQgb2YgdG9kYXksIHZzIHRoaXMuCiAgICAgICAgICAgIC8vIEdldHRpbmcgc3RhcnQtb2YtdG9kYXkgZGVwZW5kcyBvbiB3aGV0aGVyIHdlJ3JlIHpvbmUnZCBvciBub3QuCiAgICAgICAgICAgIHZhciBzb2QgPSBtYWtlQXMobW9tZW50KCksIHRoaXMpLnN0YXJ0T2YoJ2RheScpLAogICAgICAgICAgICAgICAgZGlmZiA9IHRoaXMuZGlmZihzb2QsICdkYXlzJywgdHJ1ZSksCiAgICAgICAgICAgICAgICBmb3JtYXQgPSBkaWZmIDwgLTYgPyAnc2FtZUVsc2UnIDoKICAgICAgICAgICAgICAgICAgICBkaWZmIDwgLTEgPyAnbGFzdFdlZWsnIDoKICAgICAgICAgICAgICAgICAgICBkaWZmIDwgMCA/ICdsYXN0RGF5JyA6CiAgICAgICAgICAgICAgICAgICAgZGlmZiA8IDEgPyAnc2FtZURheScgOgogICAgICAgICAgICAgICAgICAgIGRpZmYgPCAyID8gJ25leHREYXknIDoKICAgICAgICAgICAgICAgICAgICBkaWZmIDwgNyA/ICduZXh0V2VlaycgOiAnc2FtZUVsc2UnOwogICAgICAgICAgICByZXR1cm4gdGhpcy5mb3JtYXQodGhpcy5sYW5nKCkuY2FsZW5kYXIoZm9ybWF0LCB0aGlzKSk7CiAgICAgICAgfSwKCiAgICAgICAgaXNMZWFwWWVhciA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGlzTGVhcFllYXIodGhpcy55ZWFyKCkpOwogICAgICAgIH0sCgogICAgICAgIGlzRFNUIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gKHRoaXMuem9uZSgpIDwgdGhpcy5jbG9uZSgpLm1vbnRoKDApLnpvbmUoKSB8fAogICAgICAgICAgICAgICAgdGhpcy56b25lKCkgPCB0aGlzLmNsb25lKCkubW9udGgoNSkuem9uZSgpKTsKICAgICAgICB9LAoKICAgICAgICBkYXkgOiBmdW5jdGlvbiAoaW5wdXQpIHsKICAgICAgICAgICAgdmFyIGRheSA9IHRoaXMuX2lzVVRDID8gdGhpcy5fZC5nZXRVVENEYXkoKSA6IHRoaXMuX2QuZ2V0RGF5KCk7CiAgICAgICAgICAgIGlmIChpbnB1dCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBpbnB1dCA9IHBhcnNlV2Vla2RheShpbnB1dCwgdGhpcy5sYW5nKCkpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYWRkKHsgZCA6IGlucHV0IC0gZGF5IH0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIGRheTsKICAgICAgICAgICAgfQogICAgICAgIH0sCgogICAgICAgIG1vbnRoIDogbWFrZUFjY2Vzc29yKCdNb250aCcsIHRydWUpLAoKICAgICAgICBzdGFydE9mOiBmdW5jdGlvbiAodW5pdHMpIHsKICAgICAgICAgICAgdW5pdHMgPSBub3JtYWxpemVVbml0cyh1bml0cyk7CiAgICAgICAgICAgIC8vIHRoZSBmb2xsb3dpbmcgc3dpdGNoIGludGVudGlvbmFsbHkgb21pdHMgYnJlYWsga2V5d29yZHMKICAgICAgICAgICAgLy8gdG8gdXRpbGl6ZSBmYWxsaW5nIHRocm91Z2ggdGhlIGNhc2VzLgogICAgICAgICAgICBzd2l0Y2ggKHVuaXRzKSB7CiAgICAgICAgICAgIGNhc2UgJ3llYXInOgogICAgICAgICAgICAgICAgdGhpcy5tb250aCgwKTsKICAgICAgICAgICAgICAgIC8qIGZhbGxzIHRocm91Z2ggKi8KICAgICAgICAgICAgY2FzZSAncXVhcnRlcic6CiAgICAgICAgICAgIGNhc2UgJ21vbnRoJzoKICAgICAgICAgICAgICAgIHRoaXMuZGF0ZSgxKTsKICAgICAgICAgICAgICAgIC8qIGZhbGxzIHRocm91Z2ggKi8KICAgICAgICAgICAgY2FzZSAnd2Vlayc6CiAgICAgICAgICAgIGNhc2UgJ2lzb1dlZWsnOgogICAgICAgICAgICBjYXNlICdkYXknOgogICAgICAgICAgICAgICAgdGhpcy5ob3VycygwKTsKICAgICAgICAgICAgICAgIC8qIGZhbGxzIHRocm91Z2ggKi8KICAgICAgICAgICAgY2FzZSAnaG91cic6CiAgICAgICAgICAgICAgICB0aGlzLm1pbnV0ZXMoMCk7CiAgICAgICAgICAgICAgICAvKiBmYWxscyB0aHJvdWdoICovCiAgICAgICAgICAgIGNhc2UgJ21pbnV0ZSc6CiAgICAgICAgICAgICAgICB0aGlzLnNlY29uZHMoMCk7CiAgICAgICAgICAgICAgICAvKiBmYWxscyB0aHJvdWdoICovCiAgICAgICAgICAgIGNhc2UgJ3NlY29uZCc6CiAgICAgICAgICAgICAgICB0aGlzLm1pbGxpc2Vjb25kcygwKTsKICAgICAgICAgICAgICAgIC8qIGZhbGxzIHRocm91Z2ggKi8KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gd2Vla3MgYXJlIGEgc3BlY2lhbCBjYXNlCiAgICAgICAgICAgIGlmICh1bml0cyA9PT0gJ3dlZWsnKSB7CiAgICAgICAgICAgICAgICB0aGlzLndlZWtkYXkoMCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodW5pdHMgPT09ICdpc29XZWVrJykgewogICAgICAgICAgICAgICAgdGhpcy5pc29XZWVrZGF5KDEpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBxdWFydGVycyBhcmUgYWxzbyBzcGVjaWFsCiAgICAgICAgICAgIGlmICh1bml0cyA9PT0gJ3F1YXJ0ZXInKSB7CiAgICAgICAgICAgICAgICB0aGlzLm1vbnRoKE1hdGguZmxvb3IodGhpcy5tb250aCgpIC8gMykgKiAzKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfSwKCiAgICAgICAgZW5kT2Y6IGZ1bmN0aW9uICh1bml0cykgewogICAgICAgICAgICB1bml0cyA9IG5vcm1hbGl6ZVVuaXRzKHVuaXRzKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3RhcnRPZih1bml0cykuYWRkKCh1bml0cyA9PT0gJ2lzb1dlZWsnID8gJ3dlZWsnIDogdW5pdHMpLCAxKS5zdWJ0cmFjdCgnbXMnLCAxKTsKICAgICAgICB9LAoKICAgICAgICBpc0FmdGVyOiBmdW5jdGlvbiAoaW5wdXQsIHVuaXRzKSB7CiAgICAgICAgICAgIHVuaXRzID0gdHlwZW9mIHVuaXRzICE9PSAndW5kZWZpbmVkJyA/IHVuaXRzIDogJ21pbGxpc2Vjb25kJzsKICAgICAgICAgICAgcmV0dXJuICt0aGlzLmNsb25lKCkuc3RhcnRPZih1bml0cykgPiArbW9tZW50KGlucHV0KS5zdGFydE9mKHVuaXRzKTsKICAgICAgICB9LAoKICAgICAgICBpc0JlZm9yZTogZnVuY3Rpb24gKGlucHV0LCB1bml0cykgewogICAgICAgICAgICB1bml0cyA9IHR5cGVvZiB1bml0cyAhPT0gJ3VuZGVmaW5lZCcgPyB1bml0cyA6ICdtaWxsaXNlY29uZCc7CiAgICAgICAgICAgIHJldHVybiArdGhpcy5jbG9uZSgpLnN0YXJ0T2YodW5pdHMpIDwgK21vbWVudChpbnB1dCkuc3RhcnRPZih1bml0cyk7CiAgICAgICAgfSwKCiAgICAgICAgaXNTYW1lOiBmdW5jdGlvbiAoaW5wdXQsIHVuaXRzKSB7CiAgICAgICAgICAgIHVuaXRzID0gdW5pdHMgfHwgJ21zJzsKICAgICAgICAgICAgcmV0dXJuICt0aGlzLmNsb25lKCkuc3RhcnRPZih1bml0cykgPT09ICttYWtlQXMoaW5wdXQsIHRoaXMpLnN0YXJ0T2YodW5pdHMpOwogICAgICAgIH0sCgogICAgICAgIG1pbjogZnVuY3Rpb24gKG90aGVyKSB7CiAgICAgICAgICAgIG90aGVyID0gbW9tZW50LmFwcGx5KG51bGwsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgIHJldHVybiBvdGhlciA8IHRoaXMgPyB0aGlzIDogb3RoZXI7CiAgICAgICAgfSwKCiAgICAgICAgbWF4OiBmdW5jdGlvbiAob3RoZXIpIHsKICAgICAgICAgICAgb3RoZXIgPSBtb21lbnQuYXBwbHkobnVsbCwgYXJndW1lbnRzKTsKICAgICAgICAgICAgcmV0dXJuIG90aGVyID4gdGhpcyA/IHRoaXMgOiBvdGhlcjsKICAgICAgICB9LAoKICAgICAgICAvLyBrZWVwVGltZSA9IHRydWUgbWVhbnMgb25seSBjaGFuZ2UgdGhlIHRpbWV6b25lLCB3aXRob3V0IGFmZmVjdGluZwogICAgICAgIC8vIHRoZSBsb2NhbCBob3VyLiBTbyA1OjMxOjI2ICswMzAwIC0tW3pvbmUoMiwgdHJ1ZSldLS0+IDU6MzE6MjYgKzAyMDAKICAgICAgICAvLyBJdCBpcyBwb3NzaWJsZSB0aGF0IDU6MzE6MjYgZG9lc24ndCBleGlzdCBpbnQgem9uZSArMDIwMCwgc28gd2UKICAgICAgICAvLyBhZGp1c3QgdGhlIHRpbWUgYXMgbmVlZGVkLCB0byBiZSB2YWxpZC4KICAgICAgICAvLwogICAgICAgIC8vIEtlZXBpbmcgdGhlIHRpbWUgYWN0dWFsbHkgYWRkcy9zdWJ0cmFjdHMgKG9uZSBob3VyKQogICAgICAgIC8vIGZyb20gdGhlIGFjdHVhbCByZXByZXNlbnRlZCB0aW1lLiBUaGF0IGlzIHdoeSB3ZSBjYWxsIHVwZGF0ZU9mZnNldAogICAgICAgIC8vIGEgc2Vjb25kIHRpbWUuIEluIGNhc2UgaXQgd2FudHMgdXMgdG8gY2hhbmdlIHRoZSBvZmZzZXQgYWdhaW4KICAgICAgICAvLyBfY2hhbmdlSW5Qcm9ncmVzcyA9PSB0cnVlIGNhc2UsIHRoZW4gd2UgaGF2ZSB0byBhZGp1c3QsIGJlY2F1c2UKICAgICAgICAvLyB0aGVyZSBpcyBubyBzdWNoIHRpbWUgaW4gdGhlIGdpdmVuIHRpbWV6b25lLgogICAgICAgIHpvbmUgOiBmdW5jdGlvbiAoaW5wdXQsIGtlZXBUaW1lKSB7CiAgICAgICAgICAgIHZhciBvZmZzZXQgPSB0aGlzLl9vZmZzZXQgfHwgMDsKICAgICAgICAgICAgaWYgKGlucHV0ICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgaW5wdXQgPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQgPSB0aW1lem9uZU1pbnV0ZXNGcm9tU3RyaW5nKGlucHV0KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChNYXRoLmFicyhpbnB1dCkgPCAxNikgewogICAgICAgICAgICAgICAgICAgIGlucHV0ID0gaW5wdXQgKiA2MDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuX29mZnNldCA9IGlucHV0OwogICAgICAgICAgICAgICAgdGhpcy5faXNVVEMgPSB0cnVlOwogICAgICAgICAgICAgICAgaWYgKG9mZnNldCAhPT0gaW5wdXQpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIWtlZXBUaW1lIHx8IHRoaXMuX2NoYW5nZUluUHJvZ3Jlc3MpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYWRkT3JTdWJ0cmFjdER1cmF0aW9uRnJvbU1vbWVudCh0aGlzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vbWVudC5kdXJhdGlvbihvZmZzZXQgLSBpbnB1dCwgJ20nKSwgMSwgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIXRoaXMuX2NoYW5nZUluUHJvZ3Jlc3MpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fY2hhbmdlSW5Qcm9ncmVzcyA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIG1vbWVudC51cGRhdGVPZmZzZXQodGhpcywgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2NoYW5nZUluUHJvZ3Jlc3MgPSBudWxsOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9pc1VUQyA/IG9mZnNldCA6IHRoaXMuX2QuZ2V0VGltZXpvbmVPZmZzZXQoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9LAoKICAgICAgICB6b25lQWJiciA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lzVVRDID8gIlVUQyIgOiAiIjsKICAgICAgICB9LAoKICAgICAgICB6b25lTmFtZSA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lzVVRDID8gIkNvb3JkaW5hdGVkIFVuaXZlcnNhbCBUaW1lIiA6ICIiOwogICAgICAgIH0sCgogICAgICAgIHBhcnNlWm9uZSA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX3R6bSkgewogICAgICAgICAgICAgICAgdGhpcy56b25lKHRoaXMuX3R6bSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHRoaXMuX2kgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgICAgICB0aGlzLnpvbmUodGhpcy5faSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfSwKCiAgICAgICAgaGFzQWxpZ25lZEhvdXJPZmZzZXQgOiBmdW5jdGlvbiAoaW5wdXQpIHsKICAgICAgICAgICAgaWYgKCFpbnB1dCkgewogICAgICAgICAgICAgICAgaW5wdXQgPSAwOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgaW5wdXQgPSBtb21lbnQoaW5wdXQpLnpvbmUoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuICh0aGlzLnpvbmUoKSAtIGlucHV0KSAlIDYwID09PSAwOwogICAgICAgIH0sCgogICAgICAgIGRheXNJbk1vbnRoIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gZGF5c0luTW9udGgodGhpcy55ZWFyKCksIHRoaXMubW9udGgoKSk7CiAgICAgICAgfSwKCiAgICAgICAgZGF5T2ZZZWFyIDogZnVuY3Rpb24gKGlucHV0KSB7CiAgICAgICAgICAgIHZhciBkYXlPZlllYXIgPSByb3VuZCgobW9tZW50KHRoaXMpLnN0YXJ0T2YoJ2RheScpIC0gbW9tZW50KHRoaXMpLnN0YXJ0T2YoJ3llYXInKSkgLyA4NjRlNSkgKyAxOwogICAgICAgICAgICByZXR1cm4gaW5wdXQgPT0gbnVsbCA/IGRheU9mWWVhciA6IHRoaXMuYWRkKCJkIiwgKGlucHV0IC0gZGF5T2ZZZWFyKSk7CiAgICAgICAgfSwKCiAgICAgICAgcXVhcnRlciA6IGZ1bmN0aW9uIChpbnB1dCkgewogICAgICAgICAgICByZXR1cm4gaW5wdXQgPT0gbnVsbCA/IE1hdGguY2VpbCgodGhpcy5tb250aCgpICsgMSkgLyAzKSA6IHRoaXMubW9udGgoKGlucHV0IC0gMSkgKiAzICsgdGhpcy5tb250aCgpICUgMyk7CiAgICAgICAgfSwKCiAgICAgICAgd2Vla1llYXIgOiBmdW5jdGlvbiAoaW5wdXQpIHsKICAgICAgICAgICAgdmFyIHllYXIgPSB3ZWVrT2ZZZWFyKHRoaXMsIHRoaXMubGFuZygpLl93ZWVrLmRvdywgdGhpcy5sYW5nKCkuX3dlZWsuZG95KS55ZWFyOwogICAgICAgICAgICByZXR1cm4gaW5wdXQgPT0gbnVsbCA/IHllYXIgOiB0aGlzLmFkZCgieSIsIChpbnB1dCAtIHllYXIpKTsKICAgICAgICB9LAoKICAgICAgICBpc29XZWVrWWVhciA6IGZ1bmN0aW9uIChpbnB1dCkgewogICAgICAgICAgICB2YXIgeWVhciA9IHdlZWtPZlllYXIodGhpcywgMSwgNCkueWVhcjsKICAgICAgICAgICAgcmV0dXJuIGlucHV0ID09IG51bGwgPyB5ZWFyIDogdGhpcy5hZGQoInkiLCAoaW5wdXQgLSB5ZWFyKSk7CiAgICAgICAgfSwKCiAgICAgICAgd2VlayA6IGZ1bmN0aW9uIChpbnB1dCkgewogICAgICAgICAgICB2YXIgd2VlayA9IHRoaXMubGFuZygpLndlZWsodGhpcyk7CiAgICAgICAgICAgIHJldHVybiBpbnB1dCA9PSBudWxsID8gd2VlayA6IHRoaXMuYWRkKCJkIiwgKGlucHV0IC0gd2VlaykgKiA3KTsKICAgICAgICB9LAoKICAgICAgICBpc29XZWVrIDogZnVuY3Rpb24gKGlucHV0KSB7CiAgICAgICAgICAgIHZhciB3ZWVrID0gd2Vla09mWWVhcih0aGlzLCAxLCA0KS53ZWVrOwogICAgICAgICAgICByZXR1cm4gaW5wdXQgPT0gbnVsbCA/IHdlZWsgOiB0aGlzLmFkZCgiZCIsIChpbnB1dCAtIHdlZWspICogNyk7CiAgICAgICAgfSwKCiAgICAgICAgd2Vla2RheSA6IGZ1bmN0aW9uIChpbnB1dCkgewogICAgICAgICAgICB2YXIgd2Vla2RheSA9ICh0aGlzLmRheSgpICsgNyAtIHRoaXMubGFuZygpLl93ZWVrLmRvdykgJSA3OwogICAgICAgICAgICByZXR1cm4gaW5wdXQgPT0gbnVsbCA/IHdlZWtkYXkgOiB0aGlzLmFkZCgiZCIsIGlucHV0IC0gd2Vla2RheSk7CiAgICAgICAgfSwKCiAgICAgICAgaXNvV2Vla2RheSA6IGZ1bmN0aW9uIChpbnB1dCkgewogICAgICAgICAgICAvLyBiZWhhdmVzIHRoZSBzYW1lIGFzIG1vbWVudCNkYXkgZXhjZXB0CiAgICAgICAgICAgIC8vIGFzIGEgZ2V0dGVyLCByZXR1cm5zIDcgaW5zdGVhZCBvZiAwICgxLTcgcmFuZ2UgaW5zdGVhZCBvZiAwLTYpCiAgICAgICAgICAgIC8vIGFzIGEgc2V0dGVyLCBzdW5kYXkgc2hvdWxkIGJlbG9uZyB0byB0aGUgcHJldmlvdXMgd2Vlay4KICAgICAgICAgICAgcmV0dXJuIGlucHV0ID09IG51bGwgPyB0aGlzLmRheSgpIHx8IDcgOiB0aGlzLmRheSh0aGlzLmRheSgpICUgNyA/IGlucHV0IDogaW5wdXQgLSA3KTsKICAgICAgICB9LAoKICAgICAgICBpc29XZWVrc0luWWVhciA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIHdlZWtzSW5ZZWFyKHRoaXMueWVhcigpLCAxLCA0KTsKICAgICAgICB9LAoKICAgICAgICB3ZWVrc0luWWVhciA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHdlZWtJbmZvID0gdGhpcy5fbGFuZy5fd2VlazsKICAgICAgICAgICAgcmV0dXJuIHdlZWtzSW5ZZWFyKHRoaXMueWVhcigpLCB3ZWVrSW5mby5kb3csIHdlZWtJbmZvLmRveSk7CiAgICAgICAgfSwKCiAgICAgICAgZ2V0IDogZnVuY3Rpb24gKHVuaXRzKSB7CiAgICAgICAgICAgIHVuaXRzID0gbm9ybWFsaXplVW5pdHModW5pdHMpOwogICAgICAgICAgICByZXR1cm4gdGhpc1t1bml0c10oKTsKICAgICAgICB9LAoKICAgICAgICBzZXQgOiBmdW5jdGlvbiAodW5pdHMsIHZhbHVlKSB7CiAgICAgICAgICAgIHVuaXRzID0gbm9ybWFsaXplVW5pdHModW5pdHMpOwogICAgICAgICAgICBpZiAodHlwZW9mIHRoaXNbdW5pdHNdID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgICAgICB0aGlzW3VuaXRzXSh2YWx1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfSwKCiAgICAgICAgLy8gSWYgcGFzc2VkIGEgbGFuZ3VhZ2Uga2V5LCBpdCB3aWxsIHNldCB0aGUgbGFuZ3VhZ2UgZm9yIHRoaXMKICAgICAgICAvLyBpbnN0YW5jZS4gIE90aGVyd2lzZSwgaXQgd2lsbCByZXR1cm4gdGhlIGxhbmd1YWdlIGNvbmZpZ3VyYXRpb24KICAgICAgICAvLyB2YXJpYWJsZXMgZm9yIHRoaXMgaW5zdGFuY2UuCiAgICAgICAgbGFuZyA6IGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICAgICAgaWYgKGtleSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fbGFuZzsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuX2xhbmcgPSBnZXRMYW5nRGVmaW5pdGlvbihrZXkpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9KTsKCiAgICBmdW5jdGlvbiByYXdNb250aFNldHRlcihtb20sIHZhbHVlKSB7CiAgICAgICAgdmFyIGRheU9mTW9udGg7CgogICAgICAgIC8vIFRPRE86IE1vdmUgdGhpcyBvdXQgb2YgaGVyZSEKICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykgewogICAgICAgICAgICB2YWx1ZSA9IG1vbS5sYW5nKCkubW9udGhzUGFyc2UodmFsdWUpOwogICAgICAgICAgICAvLyBUT0RPOiBBbm90aGVyIHNpbGVudCBmYWlsdXJlPwogICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlICE9PSAnbnVtYmVyJykgewogICAgICAgICAgICAgICAgcmV0dXJuIG1vbTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZGF5T2ZNb250aCA9IE1hdGgubWluKG1vbS5kYXRlKCksCiAgICAgICAgICAgICAgICBkYXlzSW5Nb250aChtb20ueWVhcigpLCB2YWx1ZSkpOwogICAgICAgIG1vbS5fZFsnc2V0JyArIChtb20uX2lzVVRDID8gJ1VUQycgOiAnJykgKyAnTW9udGgnXSh2YWx1ZSwgZGF5T2ZNb250aCk7CiAgICAgICAgcmV0dXJuIG1vbTsKICAgIH0KCiAgICBmdW5jdGlvbiByYXdHZXR0ZXIobW9tLCB1bml0KSB7CiAgICAgICAgcmV0dXJuIG1vbS5fZFsnZ2V0JyArIChtb20uX2lzVVRDID8gJ1VUQycgOiAnJykgKyB1bml0XSgpOwogICAgfQoKICAgIGZ1bmN0aW9uIHJhd1NldHRlcihtb20sIHVuaXQsIHZhbHVlKSB7CiAgICAgICAgaWYgKHVuaXQgPT09ICdNb250aCcpIHsKICAgICAgICAgICAgcmV0dXJuIHJhd01vbnRoU2V0dGVyKG1vbSwgdmFsdWUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBtb20uX2RbJ3NldCcgKyAobW9tLl9pc1VUQyA/ICdVVEMnIDogJycpICsgdW5pdF0odmFsdWUpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBtYWtlQWNjZXNzb3IodW5pdCwga2VlcFRpbWUpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgICAgIGlmICh2YWx1ZSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICByYXdTZXR0ZXIodGhpcywgdW5pdCwgdmFsdWUpOwogICAgICAgICAgICAgICAgbW9tZW50LnVwZGF0ZU9mZnNldCh0aGlzLCBrZWVwVGltZSk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiByYXdHZXR0ZXIodGhpcywgdW5pdCk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgfQoKICAgIG1vbWVudC5mbi5taWxsaXNlY29uZCA9IG1vbWVudC5mbi5taWxsaXNlY29uZHMgPSBtYWtlQWNjZXNzb3IoJ01pbGxpc2Vjb25kcycsIGZhbHNlKTsKICAgIG1vbWVudC5mbi5zZWNvbmQgPSBtb21lbnQuZm4uc2Vjb25kcyA9IG1ha2VBY2Nlc3NvcignU2Vjb25kcycsIGZhbHNlKTsKICAgIG1vbWVudC5mbi5taW51dGUgPSBtb21lbnQuZm4ubWludXRlcyA9IG1ha2VBY2Nlc3NvcignTWludXRlcycsIGZhbHNlKTsKICAgIC8vIFNldHRpbmcgdGhlIGhvdXIgc2hvdWxkIGtlZXAgdGhlIHRpbWUsIGJlY2F1c2UgdGhlIHVzZXIgZXhwbGljaXRseQogICAgLy8gc3BlY2lmaWVkIHdoaWNoIGhvdXIgaGUgd2FudHMuIFNvIHRyeWluZyB0byBtYWludGFpbiB0aGUgc2FtZSBob3VyIChpbgogICAgLy8gYSBuZXcgdGltZXpvbmUpIG1ha2VzIHNlbnNlLiBBZGRpbmcvc3VidHJhY3RpbmcgaG91cnMgZG9lcyBub3QgZm9sbG93CiAgICAvLyB0aGlzIHJ1bGUuCiAgICBtb21lbnQuZm4uaG91ciA9IG1vbWVudC5mbi5ob3VycyA9IG1ha2VBY2Nlc3NvcignSG91cnMnLCB0cnVlKTsKICAgIC8vIG1vbWVudC5mbi5tb250aCBpcyBkZWZpbmVkIHNlcGFyYXRlbHkKICAgIG1vbWVudC5mbi5kYXRlID0gbWFrZUFjY2Vzc29yKCdEYXRlJywgdHJ1ZSk7CiAgICBtb21lbnQuZm4uZGF0ZXMgPSBkZXByZWNhdGUoImRhdGVzIGFjY2Vzc29yIGlzIGRlcHJlY2F0ZWQuIFVzZSBkYXRlIGluc3RlYWQuIiwgbWFrZUFjY2Vzc29yKCdEYXRlJywgdHJ1ZSkpOwogICAgbW9tZW50LmZuLnllYXIgPSBtYWtlQWNjZXNzb3IoJ0Z1bGxZZWFyJywgdHJ1ZSk7CiAgICBtb21lbnQuZm4ueWVhcnMgPSBkZXByZWNhdGUoInllYXJzIGFjY2Vzc29yIGlzIGRlcHJlY2F0ZWQuIFVzZSB5ZWFyIGluc3RlYWQuIiwgbWFrZUFjY2Vzc29yKCdGdWxsWWVhcicsIHRydWUpKTsKCiAgICAvLyBhZGQgcGx1cmFsIG1ldGhvZHMKICAgIG1vbWVudC5mbi5kYXlzID0gbW9tZW50LmZuLmRheTsKICAgIG1vbWVudC5mbi5tb250aHMgPSBtb21lbnQuZm4ubW9udGg7CiAgICBtb21lbnQuZm4ud2Vla3MgPSBtb21lbnQuZm4ud2VlazsKICAgIG1vbWVudC5mbi5pc29XZWVrcyA9IG1vbWVudC5mbi5pc29XZWVrOwogICAgbW9tZW50LmZuLnF1YXJ0ZXJzID0gbW9tZW50LmZuLnF1YXJ0ZXI7CgogICAgLy8gYWRkIGFsaWFzZWQgZm9ybWF0IG1ldGhvZHMKICAgIG1vbWVudC5mbi50b0pTT04gPSBtb21lbnQuZm4udG9JU09TdHJpbmc7CgogICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgICAgIER1cmF0aW9uIFByb3RvdHlwZQogICAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwoKCiAgICBleHRlbmQobW9tZW50LmR1cmF0aW9uLmZuID0gRHVyYXRpb24ucHJvdG90eXBlLCB7CgogICAgICAgIF9idWJibGUgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBtaWxsaXNlY29uZHMgPSB0aGlzLl9taWxsaXNlY29uZHMsCiAgICAgICAgICAgICAgICBkYXlzID0gdGhpcy5fZGF5cywKICAgICAgICAgICAgICAgIG1vbnRocyA9IHRoaXMuX21vbnRocywKICAgICAgICAgICAgICAgIGRhdGEgPSB0aGlzLl9kYXRhLAogICAgICAgICAgICAgICAgc2Vjb25kcywgbWludXRlcywgaG91cnMsIHllYXJzOwoKICAgICAgICAgICAgLy8gVGhlIGZvbGxvd2luZyBjb2RlIGJ1YmJsZXMgdXAgdmFsdWVzLCBzZWUgdGhlIHRlc3RzIGZvcgogICAgICAgICAgICAvLyBleGFtcGxlcyBvZiB3aGF0IHRoYXQgbWVhbnMuCiAgICAgICAgICAgIGRhdGEubWlsbGlzZWNvbmRzID0gbWlsbGlzZWNvbmRzICUgMTAwMDsKCiAgICAgICAgICAgIHNlY29uZHMgPSBhYnNSb3VuZChtaWxsaXNlY29uZHMgLyAxMDAwKTsKICAgICAgICAgICAgZGF0YS5zZWNvbmRzID0gc2Vjb25kcyAlIDYwOwoKICAgICAgICAgICAgbWludXRlcyA9IGFic1JvdW5kKHNlY29uZHMgLyA2MCk7CiAgICAgICAgICAgIGRhdGEubWludXRlcyA9IG1pbnV0ZXMgJSA2MDsKCiAgICAgICAgICAgIGhvdXJzID0gYWJzUm91bmQobWludXRlcyAvIDYwKTsKICAgICAgICAgICAgZGF0YS5ob3VycyA9IGhvdXJzICUgMjQ7CgogICAgICAgICAgICBkYXlzICs9IGFic1JvdW5kKGhvdXJzIC8gMjQpOwogICAgICAgICAgICBkYXRhLmRheXMgPSBkYXlzICUgMzA7CgogICAgICAgICAgICBtb250aHMgKz0gYWJzUm91bmQoZGF5cyAvIDMwKTsKICAgICAgICAgICAgZGF0YS5tb250aHMgPSBtb250aHMgJSAxMjsKCiAgICAgICAgICAgIHllYXJzID0gYWJzUm91bmQobW9udGhzIC8gMTIpOwogICAgICAgICAgICBkYXRhLnllYXJzID0geWVhcnM7CiAgICAgICAgfSwKCiAgICAgICAgd2Vla3MgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBhYnNSb3VuZCh0aGlzLmRheXMoKSAvIDcpOwogICAgICAgIH0sCgogICAgICAgIHZhbHVlT2YgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9taWxsaXNlY29uZHMgKwogICAgICAgICAgICAgIHRoaXMuX2RheXMgKiA4NjRlNSArCiAgICAgICAgICAgICAgKHRoaXMuX21vbnRocyAlIDEyKSAqIDI1OTJlNiArCiAgICAgICAgICAgICAgdG9JbnQodGhpcy5fbW9udGhzIC8gMTIpICogMzE1MzZlNjsKICAgICAgICB9LAoKICAgICAgICBodW1hbml6ZSA6IGZ1bmN0aW9uICh3aXRoU3VmZml4KSB7CiAgICAgICAgICAgIHZhciBkaWZmZXJlbmNlID0gK3RoaXMsCiAgICAgICAgICAgICAgICBvdXRwdXQgPSByZWxhdGl2ZVRpbWUoZGlmZmVyZW5jZSwgIXdpdGhTdWZmaXgsIHRoaXMubGFuZygpKTsKCiAgICAgICAgICAgIGlmICh3aXRoU3VmZml4KSB7CiAgICAgICAgICAgICAgICBvdXRwdXQgPSB0aGlzLmxhbmcoKS5wYXN0RnV0dXJlKGRpZmZlcmVuY2UsIG91dHB1dCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB0aGlzLmxhbmcoKS5wb3N0Zm9ybWF0KG91dHB1dCk7CiAgICAgICAgfSwKCiAgICAgICAgYWRkIDogZnVuY3Rpb24gKGlucHV0LCB2YWwpIHsKICAgICAgICAgICAgLy8gc3VwcG9ydHMgb25seSAyLjAtc3R5bGUgYWRkKDEsICdzJykgb3IgYWRkKG1vbWVudCkKICAgICAgICAgICAgdmFyIGR1ciA9IG1vbWVudC5kdXJhdGlvbihpbnB1dCwgdmFsKTsKCiAgICAgICAgICAgIHRoaXMuX21pbGxpc2Vjb25kcyArPSBkdXIuX21pbGxpc2Vjb25kczsKICAgICAgICAgICAgdGhpcy5fZGF5cyArPSBkdXIuX2RheXM7CiAgICAgICAgICAgIHRoaXMuX21vbnRocyArPSBkdXIuX21vbnRoczsKCiAgICAgICAgICAgIHRoaXMuX2J1YmJsZSgpOwoKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfSwKCiAgICAgICAgc3VidHJhY3QgOiBmdW5jdGlvbiAoaW5wdXQsIHZhbCkgewogICAgICAgICAgICB2YXIgZHVyID0gbW9tZW50LmR1cmF0aW9uKGlucHV0LCB2YWwpOwoKICAgICAgICAgICAgdGhpcy5fbWlsbGlzZWNvbmRzIC09IGR1ci5fbWlsbGlzZWNvbmRzOwogICAgICAgICAgICB0aGlzLl9kYXlzIC09IGR1ci5fZGF5czsKICAgICAgICAgICAgdGhpcy5fbW9udGhzIC09IGR1ci5fbW9udGhzOwoKICAgICAgICAgICAgdGhpcy5fYnViYmxlKCk7CgogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9LAoKICAgICAgICBnZXQgOiBmdW5jdGlvbiAodW5pdHMpIHsKICAgICAgICAgICAgdW5pdHMgPSBub3JtYWxpemVVbml0cyh1bml0cyk7CiAgICAgICAgICAgIHJldHVybiB0aGlzW3VuaXRzLnRvTG93ZXJDYXNlKCkgKyAncyddKCk7CiAgICAgICAgfSwKCiAgICAgICAgYXMgOiBmdW5jdGlvbiAodW5pdHMpIHsKICAgICAgICAgICAgdW5pdHMgPSBub3JtYWxpemVVbml0cyh1bml0cyk7CiAgICAgICAgICAgIHJldHVybiB0aGlzWydhcycgKyB1bml0cy5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHVuaXRzLnNsaWNlKDEpICsgJ3MnXSgpOwogICAgICAgIH0sCgogICAgICAgIGxhbmcgOiBtb21lbnQuZm4ubGFuZywKCiAgICAgICAgdG9Jc29TdHJpbmcgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIC8vIGluc3BpcmVkIGJ5IGh0dHBzOi8vZ2l0aHViLmNvbS9kb3JkaWxsZS9tb21lbnQtaXNvZHVyYXRpb24vYmxvYi9tYXN0ZXIvbW9tZW50Lmlzb2R1cmF0aW9uLmpzCiAgICAgICAgICAgIHZhciB5ZWFycyA9IE1hdGguYWJzKHRoaXMueWVhcnMoKSksCiAgICAgICAgICAgICAgICBtb250aHMgPSBNYXRoLmFicyh0aGlzLm1vbnRocygpKSwKICAgICAgICAgICAgICAgIGRheXMgPSBNYXRoLmFicyh0aGlzLmRheXMoKSksCiAgICAgICAgICAgICAgICBob3VycyA9IE1hdGguYWJzKHRoaXMuaG91cnMoKSksCiAgICAgICAgICAgICAgICBtaW51dGVzID0gTWF0aC5hYnModGhpcy5taW51dGVzKCkpLAogICAgICAgICAgICAgICAgc2Vjb25kcyA9IE1hdGguYWJzKHRoaXMuc2Vjb25kcygpICsgdGhpcy5taWxsaXNlY29uZHMoKSAvIDEwMDApOwoKICAgICAgICAgICAgaWYgKCF0aGlzLmFzU2Vjb25kcygpKSB7CiAgICAgICAgICAgICAgICAvLyB0aGlzIGlzIHRoZSBzYW1lIGFzIEMjJ3MgKE5vZGEpIGFuZCBweXRob24gKGlzb2RhdGUpLi4uCiAgICAgICAgICAgICAgICAvLyBidXQgbm90IG90aGVyIEpTIChnb29nLmRhdGUpCiAgICAgICAgICAgICAgICByZXR1cm4gJ1AwRCc7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiAodGhpcy5hc1NlY29uZHMoKSA8IDAgPyAnLScgOiAnJykgKwogICAgICAgICAgICAgICAgJ1AnICsKICAgICAgICAgICAgICAgICh5ZWFycyA/IHllYXJzICsgJ1knIDogJycpICsKICAgICAgICAgICAgICAgIChtb250aHMgPyBtb250aHMgKyAnTScgOiAnJykgKwogICAgICAgICAgICAgICAgKGRheXMgPyBkYXlzICsgJ0QnIDogJycpICsKICAgICAgICAgICAgICAgICgoaG91cnMgfHwgbWludXRlcyB8fCBzZWNvbmRzKSA/ICdUJyA6ICcnKSArCiAgICAgICAgICAgICAgICAoaG91cnMgPyBob3VycyArICdIJyA6ICcnKSArCiAgICAgICAgICAgICAgICAobWludXRlcyA/IG1pbnV0ZXMgKyAnTScgOiAnJykgKwogICAgICAgICAgICAgICAgKHNlY29uZHMgPyBzZWNvbmRzICsgJ1MnIDogJycpOwogICAgICAgIH0KICAgIH0pOwoKICAgIGZ1bmN0aW9uIG1ha2VEdXJhdGlvbkdldHRlcihuYW1lKSB7CiAgICAgICAgbW9tZW50LmR1cmF0aW9uLmZuW25hbWVdID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZGF0YVtuYW1lXTsKICAgICAgICB9OwogICAgfQoKICAgIGZ1bmN0aW9uIG1ha2VEdXJhdGlvbkFzR2V0dGVyKG5hbWUsIGZhY3RvcikgewogICAgICAgIG1vbWVudC5kdXJhdGlvbi5mblsnYXMnICsgbmFtZV0gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiArdGhpcyAvIGZhY3RvcjsKICAgICAgICB9OwogICAgfQoKICAgIGZvciAoaSBpbiB1bml0TWlsbGlzZWNvbmRGYWN0b3JzKSB7CiAgICAgICAgaWYgKHVuaXRNaWxsaXNlY29uZEZhY3RvcnMuaGFzT3duUHJvcGVydHkoaSkpIHsKICAgICAgICAgICAgbWFrZUR1cmF0aW9uQXNHZXR0ZXIoaSwgdW5pdE1pbGxpc2Vjb25kRmFjdG9yc1tpXSk7CiAgICAgICAgICAgIG1ha2VEdXJhdGlvbkdldHRlcihpLnRvTG93ZXJDYXNlKCkpOwogICAgICAgIH0KICAgIH0KCiAgICBtYWtlRHVyYXRpb25Bc0dldHRlcignV2Vla3MnLCA2MDQ4ZTUpOwogICAgbW9tZW50LmR1cmF0aW9uLmZuLmFzTW9udGhzID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiAoK3RoaXMgLSB0aGlzLnllYXJzKCkgKiAzMTUzNmU2KSAvIDI1OTJlNiArIHRoaXMueWVhcnMoKSAqIDEyOwogICAgfTsKCgogICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgICAgIERlZmF1bHQgTGFuZwogICAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwoKCiAgICAvLyBTZXQgZGVmYXVsdCBsYW5ndWFnZSwgb3RoZXIgbGFuZ3VhZ2VzIHdpbGwgaW5oZXJpdCBmcm9tIEVuZ2xpc2guCiAgICBtb21lbnQubGFuZygnZW4nLCB7CiAgICAgICAgb3JkaW5hbCA6IGZ1bmN0aW9uIChudW1iZXIpIHsKICAgICAgICAgICAgdmFyIGIgPSBudW1iZXIgJSAxMCwKICAgICAgICAgICAgICAgIG91dHB1dCA9ICh0b0ludChudW1iZXIgJSAxMDAgLyAxMCkgPT09IDEpID8gJ3RoJyA6CiAgICAgICAgICAgICAgICAoYiA9PT0gMSkgPyAnc3QnIDoKICAgICAgICAgICAgICAgIChiID09PSAyKSA/ICduZCcgOgogICAgICAgICAgICAgICAgKGIgPT09IDMpID8gJ3JkJyA6ICd0aCc7CiAgICAgICAgICAgIHJldHVybiBudW1iZXIgKyBvdXRwdXQ7CiAgICAgICAgfQogICAgfSk7CgogICAgLyogRU1CRURfTEFOR1VBR0VTICovCgogICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgICAgIEV4cG9zaW5nIE1vbWVudAogICAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwoKICAgIGZ1bmN0aW9uIG1ha2VHbG9iYWwoc2hvdWxkRGVwcmVjYXRlKSB7CiAgICAgICAgLypnbG9iYWwgZW5kZXI6ZmFsc2UgKi8KICAgICAgICBpZiAodHlwZW9mIGVuZGVyICE9PSAndW5kZWZpbmVkJykgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIG9sZEdsb2JhbE1vbWVudCA9IGdsb2JhbFNjb3BlLm1vbWVudDsKICAgICAgICBpZiAoc2hvdWxkRGVwcmVjYXRlKSB7CiAgICAgICAgICAgIGdsb2JhbFNjb3BlLm1vbWVudCA9IGRlcHJlY2F0ZSgKICAgICAgICAgICAgICAgICAgICAiQWNjZXNzaW5nIE1vbWVudCB0aHJvdWdoIHRoZSBnbG9iYWwgc2NvcGUgaXMgIiArCiAgICAgICAgICAgICAgICAgICAgImRlcHJlY2F0ZWQsIGFuZCB3aWxsIGJlIHJlbW92ZWQgaW4gYW4gdXBjb21pbmcgIiArCiAgICAgICAgICAgICAgICAgICAgInJlbGVhc2UuIiwKICAgICAgICAgICAgICAgICAgICBtb21lbnQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGdsb2JhbFNjb3BlLm1vbWVudCA9IG1vbWVudDsKICAgICAgICB9CiAgICB9CgogICAgLy8gQ29tbW9uSlMgbW9kdWxlIGlzIGRlZmluZWQKICAgIGlmIChoYXNNb2R1bGUpIHsKICAgICAgICBtb2R1bGUuZXhwb3J0cyA9IG1vbWVudDsKICAgIH0gZWxzZSBpZiAodHlwZW9mIGRlZmluZSA9PT0gImZ1bmN0aW9uIiAmJiBkZWZpbmUuYW1kKSB7CiAgICAgICAgZGVmaW5lKCJtb21lbnQiLCBbJ3JlcXVpcmUnLCdleHBvcnRzJywnbW9kdWxlJ10sZnVuY3Rpb24gKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewogICAgICAgICAgICBpZiAobW9kdWxlLmNvbmZpZyAmJiBtb2R1bGUuY29uZmlnKCkgJiYgbW9kdWxlLmNvbmZpZygpLm5vR2xvYmFsID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgICAvLyByZWxlYXNlIHRoZSBnbG9iYWwgdmFyaWFibGUKICAgICAgICAgICAgICAgIGdsb2JhbFNjb3BlLm1vbWVudCA9IG9sZEdsb2JhbE1vbWVudDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIG1vbWVudDsKICAgICAgICB9KTsKICAgICAgICBtYWtlR2xvYmFsKHRydWUpOwogICAgfSBlbHNlIHsKICAgICAgICBtYWtlR2xvYmFsKCk7CiAgICB9Cn0pLmNhbGwodGhpcyk7CgovKgpqZWQuanMKdjAuNS4wYmV0YQoKaHR0cHM6Ly9naXRodWIuY29tL1NsZXhBeHRvbi9KZWQKLS0tLS0tLS0tLS0KQSBnZXR0ZXh0IGNvbXBhdGlibGUgaTE4biBsaWJyYXJ5IGZvciBtb2Rlcm4gSmF2YVNjcmlwdCBBcHBsaWNhdGlvbnMKCmJ5IEFsZXggU2V4dG9uIC0gQWxleFNleHRvbiBbYXRdIGdtYWlsIC0gQFNsZXhBeHRvbgpXVEZQTCBsaWNlbnNlIGZvciB1c2UKRG9qbyBDTEEgZm9yIGNvbnRyaWJ1dGlvbnMKCkplZCBvZmZlcnMgdGhlIGVudGlyZSBhcHBsaWNhYmxlIEdOVSBnZXR0ZXh0IHNwZWMnZCBzZXQgb2YKZnVuY3Rpb25zLCBidXQgYWxzbyBvZmZlcnMgc29tZSBuaWNlciB3cmFwcGVycyBhcm91bmQgdGhlbS4KVGhlIGFwaSBmb3IgZ2V0dGV4dCB3YXMgd3JpdHRlbiBmb3IgYSBsYW5ndWFnZSB3aXRoIG5vIGZ1bmN0aW9uCm92ZXJsb2FkaW5nLCBzbyBKZWQgYWxsb3dzIGEgbGl0dGxlIG1vcmUgb2YgdGhhdC4KCk1hbnkgdGhhbmtzIHRvIEpvc2h1YSBJLiBNaWxsZXIgLSB1bnJ0c3RAY3Bhbi5vcmcgLSB3aG8gd3JvdGUKZ2V0dGV4dC5qcyBiYWNrIGluIDIwMDguIEkgd2FzIGFibGUgdG8gdmV0IGEgbG90IG9mIG15IGlkZWFzCmFnYWluc3QgaGlzLiBJIGFsc28gbWFkZSBzdXJlIEplZCBwYXNzZWQgYWdhaW5zdCBoaXMgdGVzdHMKaW4gb3JkZXIgdG8gb2ZmZXIgZWFzeSB1cGdyYWRlcyAtLSBqc2dldHRleHQuYmVybGlvcy5kZQoqLwooZnVuY3Rpb24gKHJvb3QsIHVuZGVmKSB7CgogIC8vIFNldCB1cCBzb21lIHVuZGVyc2NvcmUtc3R5bGUgZnVuY3Rpb25zLCBpZiB5b3UgYWxyZWFkeSBoYXZlCiAgLy8gdW5kZXJzY29yZSwgZmVlbCBmcmVlIHRvIGRlbGV0ZSB0aGlzIHNlY3Rpb24sIGFuZCB1c2UgaXQKICAvLyBkaXJlY3RseSwgaG93ZXZlciwgdGhlIGFtb3VudCBvZiBmdW5jdGlvbnMgdXNlZCBkb2Vzbid0CiAgLy8gd2FycmFudCBoYXZpbmcgdW5kZXJzY29yZSBhcyBhIGZ1bGwgZGVwZW5kZW5jeS4KICAvLyBVbmRlcnNjb3JlIDEuMy4wIHdhcyB1c2VkIHRvIHBvcnQgYW5kIGlzIGxpY2Vuc2VkCiAgLy8gdW5kZXIgdGhlIE1JVCBMaWNlbnNlIGJ5IEplcmVteSBBc2hrZW5hcy4KICB2YXIgQXJyYXlQcm90byAgICA9IEFycmF5LnByb3RvdHlwZSwKICAgICAgT2JqUHJvdG8gICAgICA9IE9iamVjdC5wcm90b3R5cGUsCiAgICAgIHNsaWNlICAgICAgICAgPSBBcnJheVByb3RvLnNsaWNlLAogICAgICBoYXNPd25Qcm9wICAgID0gT2JqUHJvdG8uaGFzT3duUHJvcGVydHksCiAgICAgIG5hdGl2ZUZvckVhY2ggPSBBcnJheVByb3RvLmZvckVhY2gsCiAgICAgIGJyZWFrZXIgICAgICAgPSB7fTsKCiAgLy8gV2UncmUgbm90IHVzaW5nIHRoZSBPT1Agc3R5bGUgXyBzbyB3ZSBkb24ndCBuZWVkIHRoZQogIC8vIGV4dHJhIGxldmVsIG9mIGluZGlyZWN0aW9uLiBUaGlzIHN0aWxsIG1lYW5zIHRoYXQgeW91CiAgLy8gc3ViIG91dCBmb3IgcmVhbCBgX2AgdGhvdWdoLgogIHZhciBfID0gewogICAgZm9yRWFjaCA6IGZ1bmN0aW9uKCBvYmosIGl0ZXJhdG9yLCBjb250ZXh0ICkgewogICAgICB2YXIgaSwgbCwga2V5OwogICAgICBpZiAoIG9iaiA9PT0gbnVsbCApIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICggbmF0aXZlRm9yRWFjaCAmJiBvYmouZm9yRWFjaCA9PT0gbmF0aXZlRm9yRWFjaCApIHsKICAgICAgICBvYmouZm9yRWFjaCggaXRlcmF0b3IsIGNvbnRleHQgKTsKICAgICAgfQogICAgICBlbHNlIGlmICggb2JqLmxlbmd0aCA9PT0gK29iai5sZW5ndGggKSB7CiAgICAgICAgZm9yICggaSA9IDAsIGwgPSBvYmoubGVuZ3RoOyBpIDwgbDsgaSsrICkgewogICAgICAgICAgaWYgKCBpIGluIG9iaiAmJiBpdGVyYXRvci5jYWxsKCBjb250ZXh0LCBvYmpbaV0sIGksIG9iaiApID09PSBicmVha2VyICkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGVsc2UgewogICAgICAgIGZvciAoIGtleSBpbiBvYmopIHsKICAgICAgICAgIGlmICggaGFzT3duUHJvcC5jYWxsKCBvYmosIGtleSApICkgewogICAgICAgICAgICBpZiAoIGl0ZXJhdG9yLmNhbGwgKGNvbnRleHQsIG9ialtrZXldLCBrZXksIG9iaiApID09PSBicmVha2VyICkgewogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGV4dGVuZCA6IGZ1bmN0aW9uKCBvYmogKSB7CiAgICAgIHRoaXMuZm9yRWFjaCggc2xpY2UuY2FsbCggYXJndW1lbnRzLCAxICksIGZ1bmN0aW9uICggc291cmNlICkgewogICAgICAgIGZvciAoIHZhciBwcm9wIGluIHNvdXJjZSApIHsKICAgICAgICAgIG9ialtwcm9wXSA9IHNvdXJjZVtwcm9wXTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICByZXR1cm4gb2JqOwogICAgfQogIH07CiAgLy8gRU5EIE1pbmlhdHVyZSB1bmRlcnNjb3JlIGltcGwKCiAgLy8gSmVkIGlzIGEgY29uc3RydWN0b3IgZnVuY3Rpb24KICB2YXIgSmVkID0gZnVuY3Rpb24gKCBvcHRpb25zICkgewogICAgLy8gU29tZSBtaW5pbWFsIGRlZmF1bHRzCiAgICB0aGlzLmRlZmF1bHRzID0gewogICAgICAibG9jYWxlX2RhdGEiIDogewogICAgICAgICJtZXNzYWdlcyIgOiB7CiAgICAgICAgICAiIiA6IHsKICAgICAgICAgICAgImRvbWFpbiIgICAgICAgOiAibWVzc2FnZXMiLAogICAgICAgICAgICAibGFuZyIgICAgICAgICA6ICJlbiIsCiAgICAgICAgICAgICJwbHVyYWxfZm9ybXMiIDogIm5wbHVyYWxzPTI7IHBsdXJhbD0obiAhPSAxKTsiCiAgICAgICAgICB9CiAgICAgICAgICAvLyBUaGVyZSBhcmUgbm8gZGVmYXVsdCBrZXlzLCB0aG91Z2gKICAgICAgICB9CiAgICAgIH0sCiAgICAgIC8vIFRoZSBkZWZhdWx0IGRvbWFpbiBpZiBvbmUgaXMgbWlzc2luZwogICAgICAiZG9tYWluIiA6ICJtZXNzYWdlcyIKICAgIH07CgogICAgLy8gTWl4IGluIHRoZSBzZW50IG9wdGlvbnMgd2l0aCB0aGUgZGVmYXVsdCBvcHRpb25zCiAgICB0aGlzLm9wdGlvbnMgPSBfLmV4dGVuZCgge30sIHRoaXMuZGVmYXVsdHMsIG9wdGlvbnMgKTsKICAgIHRoaXMudGV4dGRvbWFpbiggdGhpcy5vcHRpb25zLmRvbWFpbiApOwoKICAgIGlmICggb3B0aW9ucy5kb21haW4gJiYgISB0aGlzLm9wdGlvbnMubG9jYWxlX2RhdGFbIHRoaXMub3B0aW9ucy5kb21haW4gXSApIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdUZXh0IGRvbWFpbiBzZXQgdG8gbm9uLWV4aXN0ZW50IGRvbWFpbjogYCcgKyBvcHRpb25zLmRvbWFpbiArICdgJyk7CiAgICB9CiAgfTsKCiAgLy8gVGhlIGdldHRleHQgc3BlYyBzZXRzIHRoaXMgY2hhcmFjdGVyIGFzIHRoZSBkZWZhdWx0CiAgLy8gZGVsaW1pdGVyIGZvciBjb250ZXh0IGxvb2t1cHMuCiAgLy8gZS5nLjogY29udGV4dFx1MDAwNGtleQogIC8vIElmIHlvdXIgdHJhbnNsYXRpb24gY29tcGFueSB1c2VzIHNvbWV0aGluZyBkaWZmZXJlbnQsCiAgLy8ganVzdCBjaGFuZ2UgdGhpcyBhdCBhbnkgdGltZSBhbmQgaXQgd2lsbCB1c2UgdGhhdCBpbnN0ZWFkLgogIEplZC5jb250ZXh0X2RlbGltaXRlciA9IFN0cmluZy5mcm9tQ2hhckNvZGUoIDQgKTsKCiAgZnVuY3Rpb24gZ2V0UGx1cmFsRm9ybUZ1bmMgKCBwbHVyYWxfZm9ybV9zdHJpbmcgKSB7CiAgICByZXR1cm4gSmVkLlBGLmNvbXBpbGUoIHBsdXJhbF9mb3JtX3N0cmluZyB8fCAibnBsdXJhbHM9MjsgcGx1cmFsPShuICE9IDEpOyIpOwogIH0KCiAgZnVuY3Rpb24gQ2hhaW4oIGtleSwgaTE4biApewogICAgdGhpcy5fa2V5ID0ga2V5OwogICAgdGhpcy5faTE4biA9IGkxOG47CiAgfQoKICAvLyBDcmVhdGUgYSBjaGFpbmFibGUgYXBpIGZvciBhZGRpbmcgYXJncyBwcmV0dGlseQogIF8uZXh0ZW5kKCBDaGFpbi5wcm90b3R5cGUsIHsKICAgIG9uRG9tYWluIDogZnVuY3Rpb24gKCBkb21haW4gKSB7CiAgICAgIHRoaXMuX2RvbWFpbiA9IGRvbWFpbjsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAogICAgd2l0aENvbnRleHQgOiBmdW5jdGlvbiAoIGNvbnRleHQgKSB7CiAgICAgIHRoaXMuX2NvbnRleHQgPSBjb250ZXh0OwogICAgICByZXR1cm4gdGhpczsKICAgIH0sCiAgICBpZlBsdXJhbCA6IGZ1bmN0aW9uICggbnVtLCBwa2V5ICkgewogICAgICB0aGlzLl92YWwgPSBudW07CiAgICAgIHRoaXMuX3BrZXkgPSBwa2V5OwogICAgICByZXR1cm4gdGhpczsKICAgIH0sCiAgICBmZXRjaCA6IGZ1bmN0aW9uICggc0FyciApIHsKICAgICAgaWYgKCB7fS50b1N0cmluZy5jYWxsKCBzQXJyICkgIT0gJ1tvYmplY3QgQXJyYXldJyApIHsKICAgICAgICBzQXJyID0gW10uc2xpY2UuY2FsbChhcmd1bWVudHMpOwogICAgICB9CiAgICAgIHJldHVybiAoIHNBcnIgJiYgc0Fyci5sZW5ndGggPyBKZWQuc3ByaW50ZiA6IGZ1bmN0aW9uKHgpeyByZXR1cm4geDsgfSApKAogICAgICAgIHRoaXMuX2kxOG4uZGNucGdldHRleHQodGhpcy5fZG9tYWluLCB0aGlzLl9jb250ZXh0LCB0aGlzLl9rZXksIHRoaXMuX3BrZXksIHRoaXMuX3ZhbCksCiAgICAgICAgc0FycgogICAgICApOwogICAgfQogIH0pOwoKICAvLyBBZGQgZnVuY3Rpb25zIHRvIHRoZSBKZWQgcHJvdG90eXBlLgogIC8vIFRoZXNlIHdpbGwgYmUgdGhlIGZ1bmN0aW9ucyBvbiB0aGUgb2JqZWN0IHRoYXQncyByZXR1cm5lZAogIC8vIGZyb20gY3JlYXRpbmcgYSBgbmV3IEplZCgpYAogIC8vIFRoZXNlIHNlZW0gcmVkdW5kYW50LCBidXQgdGhleSBnemlwIHByZXR0eSB3ZWxsLgogIF8uZXh0ZW5kKCBKZWQucHJvdG90eXBlLCB7CiAgICAvLyBUaGUgc2V4aWVyIGFwaSBzdGFydCBwb2ludAogICAgdHJhbnNsYXRlIDogZnVuY3Rpb24gKCBrZXkgKSB7CiAgICAgIHJldHVybiBuZXcgQ2hhaW4oIGtleSwgdGhpcyApOwogICAgfSwKCiAgICB0ZXh0ZG9tYWluIDogZnVuY3Rpb24gKCBkb21haW4gKSB7CiAgICAgIGlmICggISBkb21haW4gKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3RleHRkb21haW47CiAgICAgIH0KICAgICAgdGhpcy5fdGV4dGRvbWFpbiA9IGRvbWFpbjsKICAgIH0sCgogICAgZ2V0dGV4dCA6IGZ1bmN0aW9uICgga2V5ICkgewogICAgICByZXR1cm4gdGhpcy5kY25wZ2V0dGV4dC5jYWxsKCB0aGlzLCB1bmRlZiwgdW5kZWYsIGtleSApOwogICAgfSwKCiAgICBkZ2V0dGV4dCA6IGZ1bmN0aW9uICggZG9tYWluLCBrZXkgKSB7CiAgICAgcmV0dXJuIHRoaXMuZGNucGdldHRleHQuY2FsbCggdGhpcywgZG9tYWluLCB1bmRlZiwga2V5ICk7CiAgICB9LAoKICAgIGRjZ2V0dGV4dCA6IGZ1bmN0aW9uICggZG9tYWluICwga2V5IC8qLCBjYXRlZ29yeSAqLyApIHsKICAgICAgLy8gSWdub3JlcyB0aGUgY2F0ZWdvcnkgYW55d2F5cwogICAgICByZXR1cm4gdGhpcy5kY25wZ2V0dGV4dC5jYWxsKCB0aGlzLCBkb21haW4sIHVuZGVmLCBrZXkgKTsKICAgIH0sCgogICAgbmdldHRleHQgOiBmdW5jdGlvbiAoIHNrZXksIHBrZXksIHZhbCApIHsKICAgICAgcmV0dXJuIHRoaXMuZGNucGdldHRleHQuY2FsbCggdGhpcywgdW5kZWYsIHVuZGVmLCBza2V5LCBwa2V5LCB2YWwgKTsKICAgIH0sCgogICAgZG5nZXR0ZXh0IDogZnVuY3Rpb24gKCBkb21haW4sIHNrZXksIHBrZXksIHZhbCApIHsKICAgICAgcmV0dXJuIHRoaXMuZGNucGdldHRleHQuY2FsbCggdGhpcywgZG9tYWluLCB1bmRlZiwgc2tleSwgcGtleSwgdmFsICk7CiAgICB9LAoKICAgIGRjbmdldHRleHQgOiBmdW5jdGlvbiAoIGRvbWFpbiwgc2tleSwgcGtleSwgdmFsLyosIGNhdGVnb3J5ICovKSB7CiAgICAgIHJldHVybiB0aGlzLmRjbnBnZXR0ZXh0LmNhbGwoIHRoaXMsIGRvbWFpbiwgdW5kZWYsIHNrZXksIHBrZXksIHZhbCApOwogICAgfSwKCiAgICBwZ2V0dGV4dCA6IGZ1bmN0aW9uICggY29udGV4dCwga2V5ICkgewogICAgICByZXR1cm4gdGhpcy5kY25wZ2V0dGV4dC5jYWxsKCB0aGlzLCB1bmRlZiwgY29udGV4dCwga2V5ICk7CiAgICB9LAoKICAgIGRwZ2V0dGV4dCA6IGZ1bmN0aW9uICggZG9tYWluLCBjb250ZXh0LCBrZXkgKSB7CiAgICAgIHJldHVybiB0aGlzLmRjbnBnZXR0ZXh0LmNhbGwoIHRoaXMsIGRvbWFpbiwgY29udGV4dCwga2V5ICk7CiAgICB9LAoKICAgIGRjcGdldHRleHQgOiBmdW5jdGlvbiAoIGRvbWFpbiwgY29udGV4dCwga2V5LyosIGNhdGVnb3J5ICovKSB7CiAgICAgIHJldHVybiB0aGlzLmRjbnBnZXR0ZXh0LmNhbGwoIHRoaXMsIGRvbWFpbiwgY29udGV4dCwga2V5ICk7CiAgICB9LAoKICAgIG5wZ2V0dGV4dCA6IGZ1bmN0aW9uICggY29udGV4dCwgc2tleSwgcGtleSwgdmFsICkgewogICAgICByZXR1cm4gdGhpcy5kY25wZ2V0dGV4dC5jYWxsKCB0aGlzLCB1bmRlZiwgY29udGV4dCwgc2tleSwgcGtleSwgdmFsICk7CiAgICB9LAoKICAgIGRucGdldHRleHQgOiBmdW5jdGlvbiAoIGRvbWFpbiwgY29udGV4dCwgc2tleSwgcGtleSwgdmFsICkgewogICAgICByZXR1cm4gdGhpcy5kY25wZ2V0dGV4dC5jYWxsKCB0aGlzLCBkb21haW4sIGNvbnRleHQsIHNrZXksIHBrZXksIHZhbCApOwogICAgfSwKCiAgICAvLyBUaGUgbW9zdCBmdWxseSBxdWFsaWZpZWQgZ2V0dGV4dCBmdW5jdGlvbi4gSXQgaGFzIGV2ZXJ5IG9wdGlvbi4KICAgIC8vIFNpbmNlIGl0IGhhcyBldmVyeSBvcHRpb24sIHdlIGNhbiB1c2UgaXQgZnJvbSBldmVyeSBvdGhlciBtZXRob2QuCiAgICAvLyBUaGlzIGlzIHRoZSBicmVhZCBhbmQgYnV0dGVyLgogICAgLy8gVGVjaG5pY2FsbHkgdGhlcmUgc2hvdWxkIGJlIG9uZSBtb3JlIGFyZ3VtZW50IGluIHRoaXMgZnVuY3Rpb24gZm9yICdDYXRlZ29yeScsCiAgICAvLyBidXQgc2luY2Ugd2UgbmV2ZXIgdXNlIGl0LCB3ZSBtaWdodCBhcyB3ZWxsIG5vdCB3YXN0ZSB0aGUgYnl0ZXMgdG8gZGVmaW5lIGl0LgogICAgZGNucGdldHRleHQgOiBmdW5jdGlvbiAoIGRvbWFpbiwgY29udGV4dCwgc2luZ3VsYXJfa2V5LCBwbHVyYWxfa2V5LCB2YWwgKSB7CiAgICAgIC8vIFNldCBzb21lIGRlZmF1bHRzCgogICAgICBwbHVyYWxfa2V5ID0gcGx1cmFsX2tleSB8fCBzaW5ndWxhcl9rZXk7CgogICAgICAvLyBVc2UgdGhlIGdsb2JhbCBkb21haW4gZGVmYXVsdCBpZiBvbmUKICAgICAgLy8gaXNuJ3QgZXhwbGljaXRseSBwYXNzZWQgaW4KICAgICAgZG9tYWluID0gZG9tYWluIHx8IHRoaXMuX3RleHRkb21haW47CgogICAgICAvLyBEZWZhdWx0IHRoZSB2YWx1ZSB0byB0aGUgc2luZ3VsYXIgY2FzZQogICAgICB2YWwgPSB0eXBlb2YgdmFsID09ICd1bmRlZmluZWQnID8gMSA6IHZhbDsKCiAgICAgIHZhciBmYWxsYmFjazsKCiAgICAgIC8vIEhhbmRsZSBzcGVjaWFsIGNhc2VzCgogICAgICAvLyBObyBvcHRpb25zIGZvdW5kCiAgICAgIGlmICggISB0aGlzLm9wdGlvbnMgKSB7CiAgICAgICAgLy8gVGhlcmUncyBsaWtlbHkgc29tZXRoaW5nIHdyb25nLCBidXQgd2UnbGwgcmV0dXJuIHRoZSBjb3JyZWN0IGtleSBmb3IgZW5nbGlzaAogICAgICAgIC8vIFdlIGRvIHRoaXMgYnkgaW5zdGFudGlhdGluZyBhIGJyYW5kIG5ldyBKZWQgaW5zdGFuY2Ugd2l0aCB0aGUgZGVmYXVsdCBzZXQKICAgICAgICAvLyBmb3IgZXZlcnl0aGluZyB0aGF0IGNvdWxkIGJlIGJyb2tlbi4KICAgICAgICBmYWxsYmFjayA9IG5ldyBKZWQoKTsKICAgICAgICByZXR1cm4gZmFsbGJhY2suZGNucGdldHRleHQuY2FsbCggZmFsbGJhY2ssIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCBzaW5ndWxhcl9rZXksIHBsdXJhbF9rZXksIHZhbCApOwogICAgICB9CgogICAgICAvLyBObyB0cmFuc2xhdGlvbiBkYXRhIHByb3ZpZGVkCiAgICAgIGlmICggISB0aGlzLm9wdGlvbnMubG9jYWxlX2RhdGEgKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyBsb2NhbGUgZGF0YSBwcm92aWRlZC4nKTsKICAgICAgfQoKICAgICAgaWYgKCAhIHRoaXMub3B0aW9ucy5sb2NhbGVfZGF0YVsgZG9tYWluIF0gKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdEb21haW4gYCcgKyBkb21haW4gKyAnYCB3YXMgbm90IGZvdW5kLicpOwogICAgICB9CgogICAgICBpZiAoICEgdGhpcy5vcHRpb25zLmxvY2FsZV9kYXRhWyBkb21haW4gXVsgIiIgXSApIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIGxvY2FsZSBtZXRhIGluZm9ybWF0aW9uIHByb3ZpZGVkLicpOwogICAgICB9CgogICAgICAvLyBNYWtlIHN1cmUgd2UgaGF2ZSBhIHRydXRoeSBrZXkuIE90aGVyd2lzZSB3ZSBtaWdodCBzdGFydCBsb29raW5nCiAgICAgIC8vIGludG8gdGhlIGVtcHR5IHN0cmluZyBrZXksIHdoaWNoIGlzIHRoZSBvcHRpb25zIGZvciB0aGUgbG9jYWxlCiAgICAgIC8vIGRhdGEuCiAgICAgIGlmICggISBzaW5ndWxhcl9rZXkgKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyB0cmFuc2xhdGlvbiBrZXkgZm91bmQuJyk7CiAgICAgIH0KCiAgICAgIC8vIEhhbmRsZSBpbnZhbGlkIG51bWJlcnMsIGJ1dCB0cnkgY2FzdGluZyBzdHJpbmdzIGZvciBnb29kIG1lYXN1cmUKICAgICAgaWYgKCB0eXBlb2YgdmFsICE9ICdudW1iZXInICkgewogICAgICAgIHZhbCA9IHBhcnNlSW50KCB2YWwsIDEwICk7CgogICAgICAgIGlmICggaXNOYU4oIHZhbCApICkgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgbnVtYmVyIHRoYXQgd2FzIHBhc3NlZCBpbiBpcyBub3QgYSBudW1iZXIuJyk7CiAgICAgICAgfQogICAgICB9CgogICAgICB2YXIga2V5ICA9IGNvbnRleHQgPyBjb250ZXh0ICsgSmVkLmNvbnRleHRfZGVsaW1pdGVyICsgc2luZ3VsYXJfa2V5IDogc2luZ3VsYXJfa2V5LAogICAgICAgICAgbG9jYWxlX2RhdGEgPSB0aGlzLm9wdGlvbnMubG9jYWxlX2RhdGEsCiAgICAgICAgICBkaWN0ID0gbG9jYWxlX2RhdGFbIGRvbWFpbiBdLAogICAgICAgICAgcGx1cmFsRm9ybXMgPSBkaWN0WyIiXS5wbHVyYWxfZm9ybXMgfHwgKGxvY2FsZV9kYXRhLm1lc3NhZ2VzIHx8IHRoaXMuZGVmYXVsdHMubG9jYWxlX2RhdGEubWVzc2FnZXMpWyIiXS5wbHVyYWxfZm9ybXMsCiAgICAgICAgICB2YWxfaWR4ID0gZ2V0UGx1cmFsRm9ybUZ1bmMocGx1cmFsRm9ybXMpKHZhbCkgKyAxLAogICAgICAgICAgdmFsX2xpc3QsCiAgICAgICAgICByZXM7CgogICAgICAvLyBUaHJvdyBhbiBlcnJvciBpZiBhIGRvbWFpbiBpc24ndCBmb3VuZAogICAgICBpZiAoICEgZGljdCApIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIGRvbWFpbiBuYW1lZCBgJyArIGRvbWFpbiArICdgIGNvdWxkIGJlIGZvdW5kLicpOwogICAgICB9CgogICAgICB2YWxfbGlzdCA9IGRpY3RbIGtleSBdOwoKICAgICAgLy8gSWYgdGhlcmUgaXMgbm8gbWF0Y2gsIHRoZW4gcmV2ZXJ0IGJhY2sgdG8KICAgICAgLy8gZW5nbGlzaCBzdHlsZSBzaW5ndWxhci9wbHVyYWwgd2l0aCB0aGUga2V5cyBwYXNzZWQgaW4uCiAgICAgIGlmICggISB2YWxfbGlzdCB8fCB2YWxfaWR4ID49IHZhbF9saXN0Lmxlbmd0aCApIHsKICAgICAgICBpZiAodGhpcy5vcHRpb25zLm1pc3Npbmdfa2V5X2NhbGxiYWNrKSB7CiAgICAgICAgICB0aGlzLm9wdGlvbnMubWlzc2luZ19rZXlfY2FsbGJhY2soa2V5KTsKICAgICAgICB9CiAgICAgICAgcmVzID0gWyBudWxsLCBzaW5ndWxhcl9rZXksIHBsdXJhbF9rZXkgXTsKICAgICAgICByZXR1cm4gcmVzWyBnZXRQbHVyYWxGb3JtRnVuYyhwbHVyYWxGb3JtcykoIHZhbCApICsgMSBdOwogICAgICB9CgogICAgICByZXMgPSB2YWxfbGlzdFsgdmFsX2lkeCBdOwoKICAgICAgLy8gVGhpcyBpbmNsdWRlcyBlbXB0eSBzdHJpbmdzIG9uIHB1cnBvc2UKICAgICAgaWYgKCAhIHJlcyAgKSB7CiAgICAgICAgcmVzID0gWyBudWxsLCBzaW5ndWxhcl9rZXksIHBsdXJhbF9rZXkgXTsKICAgICAgICByZXR1cm4gcmVzWyBnZXRQbHVyYWxGb3JtRnVuYyhwbHVyYWxGb3JtcykoIHZhbCApICsgMSBdOwogICAgICB9CiAgICAgIHJldHVybiByZXM7CiAgICB9CiAgfSk7CgoKICAvLyBXZSBhZGQgaW4gc3ByaW50ZiBjYXBhYmlsaXRpZXMgZm9yIHBvc3QgdHJhbnNsYXRpb24gdmFsdWUgaW50ZXJvbGF0aW9uCiAgLy8gVGhpcyBpcyBub3QgaW50ZXJuYWxseSB1c2VkLCBzbyB5b3UgY2FuIHJlbW92ZSBpdCBpZiB5b3UgaGF2ZSB0aGlzCiAgLy8gYXZhaWxhYmxlIHNvbWV3aGVyZSBlbHNlLCBvciB3YW50IHRvIHVzZSBhIGRpZmZlcmVudCBzeXN0ZW0uCgogIC8vIFdlIF9zbGlnaHRseV8gbW9kaWZ5IHRoZSBub3JtYWwgc3ByaW50ZiBiZWhhdmlvciB0byBtb3JlIGdyYWNlZnVsbHkgaGFuZGxlCiAgLy8gdW5kZWZpbmVkIHZhbHVlcy4KCiAgLyoqCiAgIHNwcmludGYoKSBmb3IgSmF2YVNjcmlwdCAwLjctYmV0YTEKICAgaHR0cDovL3d3dy5kaXZlaW50b2phdmFzY3JpcHQuY29tL3Byb2plY3RzL2phdmFzY3JpcHQtc3ByaW50ZgoKICAgQ29weXJpZ2h0IChjKSBBbGV4YW5kcnUgTWFyYXN0ZWFudSA8YWxleGFob2xpYyBbYXQpIGdtYWlsIChkb3RdIGNvbT4KICAgQWxsIHJpZ2h0cyByZXNlcnZlZC4KCiAgIFJlZGlzdHJpYnV0aW9uIGFuZCB1c2UgaW4gc291cmNlIGFuZCBiaW5hcnkgZm9ybXMsIHdpdGggb3Igd2l0aG91dAogICBtb2RpZmljYXRpb24sIGFyZSBwZXJtaXR0ZWQgcHJvdmlkZWQgdGhhdCB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnMgYXJlIG1ldDoKICAgICAgICogUmVkaXN0cmlidXRpb25zIG9mIHNvdXJjZSBjb2RlIG11c3QgcmV0YWluIHRoZSBhYm92ZSBjb3B5cmlnaHQKICAgICAgICAgbm90aWNlLCB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyLgogICAgICAgKiBSZWRpc3RyaWJ1dGlvbnMgaW4gYmluYXJ5IGZvcm0gbXVzdCByZXByb2R1Y2UgdGhlIGFib3ZlIGNvcHlyaWdodAogICAgICAgICBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIgaW4gdGhlCiAgICAgICAgIGRvY3VtZW50YXRpb24gYW5kL29yIG90aGVyIG1hdGVyaWFscyBwcm92aWRlZCB3aXRoIHRoZSBkaXN0cmlidXRpb24uCiAgICAgICAqIE5laXRoZXIgdGhlIG5hbWUgb2Ygc3ByaW50ZigpIGZvciBKYXZhU2NyaXB0IG5vciB0aGUKICAgICAgICAgbmFtZXMgb2YgaXRzIGNvbnRyaWJ1dG9ycyBtYXkgYmUgdXNlZCB0byBlbmRvcnNlIG9yIHByb21vdGUgcHJvZHVjdHMKICAgICAgICAgZGVyaXZlZCBmcm9tIHRoaXMgc29mdHdhcmUgd2l0aG91dCBzcGVjaWZpYyBwcmlvciB3cml0dGVuIHBlcm1pc3Npb24uCgogICBUSElTIFNPRlRXQVJFIElTIFBST1ZJREVEIEJZIFRIRSBDT1BZUklHSFQgSE9MREVSUyBBTkQgQ09OVFJJQlVUT1JTICJBUyBJUyIgQU5ECiAgIEFOWSBFWFBSRVNTIE9SIElNUExJRUQgV0FSUkFOVElFUywgSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFRIRSBJTVBMSUVECiAgIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZIEFORCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBUkUKICAgRElTQ0xBSU1FRC4gSU4gTk8gRVZFTlQgU0hBTEwgQWxleGFuZHJ1IE1hcmFzdGVhbnUgQkUgTElBQkxFIEZPUiBBTlkKICAgRElSRUNULCBJTkRJUkVDVCwgSU5DSURFTlRBTCwgU1BFQ0lBTCwgRVhFTVBMQVJZLCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVMKICAgKElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBQUk9DVVJFTUVOVCBPRiBTVUJTVElUVVRFIEdPT0RTIE9SIFNFUlZJQ0VTOwogICBMT1NTIE9GIFVTRSwgREFUQSwgT1IgUFJPRklUUzsgT1IgQlVTSU5FU1MgSU5URVJSVVBUSU9OKSBIT1dFVkVSIENBVVNFRCBBTkQKICAgT04gQU5ZIFRIRU9SWSBPRiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQ09OVFJBQ1QsIFNUUklDVCBMSUFCSUxJVFksIE9SIFRPUlQKICAgKElOQ0xVRElORyBORUdMSUdFTkNFIE9SIE9USEVSV0lTRSkgQVJJU0lORyBJTiBBTlkgV0FZIE9VVCBPRiBUSEUgVVNFIE9GIFRISVMKICAgU09GVFdBUkUsIEVWRU4gSUYgQURWSVNFRCBPRiBUSEUgUE9TU0lCSUxJVFkgT0YgU1VDSCBEQU1BR0UuCiAgKi8KICB2YXIgc3ByaW50ZiA9IChmdW5jdGlvbigpIHsKICAgIGZ1bmN0aW9uIGdldF90eXBlKHZhcmlhYmxlKSB7CiAgICAgIHJldHVybiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodmFyaWFibGUpLnNsaWNlKDgsIC0xKS50b0xvd2VyQ2FzZSgpOwogICAgfQogICAgZnVuY3Rpb24gc3RyX3JlcGVhdChpbnB1dCwgbXVsdGlwbGllcikgewogICAgICBmb3IgKHZhciBvdXRwdXQgPSBbXTsgbXVsdGlwbGllciA+IDA7IG91dHB1dFstLW11bHRpcGxpZXJdID0gaW5wdXQpIHsvKiBkbyBub3RoaW5nICovfQogICAgICByZXR1cm4gb3V0cHV0LmpvaW4oJycpOwogICAgfQoKICAgIHZhciBzdHJfZm9ybWF0ID0gZnVuY3Rpb24oKSB7CiAgICAgIGlmICghc3RyX2Zvcm1hdC5jYWNoZS5oYXNPd25Qcm9wZXJ0eShhcmd1bWVudHNbMF0pKSB7CiAgICAgICAgc3RyX2Zvcm1hdC5jYWNoZVthcmd1bWVudHNbMF1dID0gc3RyX2Zvcm1hdC5wYXJzZShhcmd1bWVudHNbMF0pOwogICAgICB9CiAgICAgIHJldHVybiBzdHJfZm9ybWF0LmZvcm1hdC5jYWxsKG51bGwsIHN0cl9mb3JtYXQuY2FjaGVbYXJndW1lbnRzWzBdXSwgYXJndW1lbnRzKTsKICAgIH07CgogICAgc3RyX2Zvcm1hdC5mb3JtYXQgPSBmdW5jdGlvbihwYXJzZV90cmVlLCBhcmd2KSB7CiAgICAgIHZhciBjdXJzb3IgPSAxLCB0cmVlX2xlbmd0aCA9IHBhcnNlX3RyZWUubGVuZ3RoLCBub2RlX3R5cGUgPSAnJywgYXJnLCBvdXRwdXQgPSBbXSwgaSwgaywgbWF0Y2gsIHBhZCwgcGFkX2NoYXJhY3RlciwgcGFkX2xlbmd0aDsKICAgICAgZm9yIChpID0gMDsgaSA8IHRyZWVfbGVuZ3RoOyBpKyspIHsKICAgICAgICBub2RlX3R5cGUgPSBnZXRfdHlwZShwYXJzZV90cmVlW2ldKTsKICAgICAgICBpZiAobm9kZV90eXBlID09PSAnc3RyaW5nJykgewogICAgICAgICAgb3V0cHV0LnB1c2gocGFyc2VfdHJlZVtpXSk7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKG5vZGVfdHlwZSA9PT0gJ2FycmF5JykgewogICAgICAgICAgbWF0Y2ggPSBwYXJzZV90cmVlW2ldOyAvLyBjb252ZW5pZW5jZSBwdXJwb3NlcyBvbmx5CiAgICAgICAgICBpZiAobWF0Y2hbMl0pIHsgLy8ga2V5d29yZCBhcmd1bWVudAogICAgICAgICAgICBhcmcgPSBhcmd2W2N1cnNvcl07CiAgICAgICAgICAgIGZvciAoayA9IDA7IGsgPCBtYXRjaFsyXS5sZW5ndGg7IGsrKykgewogICAgICAgICAgICAgIGlmICghYXJnLmhhc093blByb3BlcnR5KG1hdGNoWzJdW2tdKSkgewogICAgICAgICAgICAgICAgdGhyb3coc3ByaW50ZignW3NwcmludGZdIHByb3BlcnR5ICIlcyIgZG9lcyBub3QgZXhpc3QnLCBtYXRjaFsyXVtrXSkpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBhcmcgPSBhcmdbbWF0Y2hbMl1ba11dOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBlbHNlIGlmIChtYXRjaFsxXSkgeyAvLyBwb3NpdGlvbmFsIGFyZ3VtZW50IChleHBsaWNpdCkKICAgICAgICAgICAgYXJnID0gYXJndlttYXRjaFsxXV07CiAgICAgICAgICB9CiAgICAgICAgICBlbHNlIHsgLy8gcG9zaXRpb25hbCBhcmd1bWVudCAoaW1wbGljaXQpCiAgICAgICAgICAgIGFyZyA9IGFyZ3ZbY3Vyc29yKytdOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICgvW15zXS8udGVzdChtYXRjaFs4XSkgJiYgKGdldF90eXBlKGFyZykgIT0gJ251bWJlcicpKSB7CiAgICAgICAgICAgIHRocm93KHNwcmludGYoJ1tzcHJpbnRmXSBleHBlY3RpbmcgbnVtYmVyIGJ1dCBmb3VuZCAlcycsIGdldF90eXBlKGFyZykpKTsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyBKZWQgRURJVAogICAgICAgICAgaWYgKCB0eXBlb2YgYXJnID09ICd1bmRlZmluZWQnIHx8IGFyZyA9PT0gbnVsbCApIHsKICAgICAgICAgICAgYXJnID0gJyc7CiAgICAgICAgICB9CiAgICAgICAgICAvLyBKZWQgRURJVAoKICAgICAgICAgIHN3aXRjaCAobWF0Y2hbOF0pIHsKICAgICAgICAgICAgY2FzZSAnYic6IGFyZyA9IGFyZy50b1N0cmluZygyKTsgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ2MnOiBhcmcgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGFyZyk7IGJyZWFrOwogICAgICAgICAgICBjYXNlICdkJzogYXJnID0gcGFyc2VJbnQoYXJnLCAxMCk7IGJyZWFrOwogICAgICAgICAgICBjYXNlICdlJzogYXJnID0gbWF0Y2hbN10gPyBhcmcudG9FeHBvbmVudGlhbChtYXRjaFs3XSkgOiBhcmcudG9FeHBvbmVudGlhbCgpOyBicmVhazsKICAgICAgICAgICAgY2FzZSAnZic6IGFyZyA9IG1hdGNoWzddID8gcGFyc2VGbG9hdChhcmcpLnRvRml4ZWQobWF0Y2hbN10pIDogcGFyc2VGbG9hdChhcmcpOyBicmVhazsKICAgICAgICAgICAgY2FzZSAnbyc6IGFyZyA9IGFyZy50b1N0cmluZyg4KTsgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ3MnOiBhcmcgPSAoKGFyZyA9IFN0cmluZyhhcmcpKSAmJiBtYXRjaFs3XSA/IGFyZy5zdWJzdHJpbmcoMCwgbWF0Y2hbN10pIDogYXJnKTsgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ3UnOiBhcmcgPSBNYXRoLmFicyhhcmcpOyBicmVhazsKICAgICAgICAgICAgY2FzZSAneCc6IGFyZyA9IGFyZy50b1N0cmluZygxNik7IGJyZWFrOwogICAgICAgICAgICBjYXNlICdYJzogYXJnID0gYXJnLnRvU3RyaW5nKDE2KS50b1VwcGVyQ2FzZSgpOyBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIGFyZyA9ICgvW2RlZl0vLnRlc3QobWF0Y2hbOF0pICYmIG1hdGNoWzNdICYmIGFyZyA+PSAwID8gJysnKyBhcmcgOiBhcmcpOwogICAgICAgICAgcGFkX2NoYXJhY3RlciA9IG1hdGNoWzRdID8gbWF0Y2hbNF0gPT0gJzAnID8gJzAnIDogbWF0Y2hbNF0uY2hhckF0KDEpIDogJyAnOwogICAgICAgICAgcGFkX2xlbmd0aCA9IG1hdGNoWzZdIC0gU3RyaW5nKGFyZykubGVuZ3RoOwogICAgICAgICAgcGFkID0gbWF0Y2hbNl0gPyBzdHJfcmVwZWF0KHBhZF9jaGFyYWN0ZXIsIHBhZF9sZW5ndGgpIDogJyc7CiAgICAgICAgICBvdXRwdXQucHVzaChtYXRjaFs1XSA/IGFyZyArIHBhZCA6IHBhZCArIGFyZyk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBvdXRwdXQuam9pbignJyk7CiAgICB9OwoKICAgIHN0cl9mb3JtYXQuY2FjaGUgPSB7fTsKCiAgICBzdHJfZm9ybWF0LnBhcnNlID0gZnVuY3Rpb24oZm10KSB7CiAgICAgIHZhciBfZm10ID0gZm10LCBtYXRjaCA9IFtdLCBwYXJzZV90cmVlID0gW10sIGFyZ19uYW1lcyA9IDA7CiAgICAgIHdoaWxlIChfZm10KSB7CiAgICAgICAgaWYgKChtYXRjaCA9IC9eW15ceDI1XSsvLmV4ZWMoX2ZtdCkpICE9PSBudWxsKSB7CiAgICAgICAgICBwYXJzZV90cmVlLnB1c2gobWF0Y2hbMF0pOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmICgobWF0Y2ggPSAvXlx4MjV7Mn0vLmV4ZWMoX2ZtdCkpICE9PSBudWxsKSB7CiAgICAgICAgICBwYXJzZV90cmVlLnB1c2goJyUnKTsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAoKG1hdGNoID0gL15ceDI1KD86KFsxLTldXGQqKVwkfFwoKFteXCldKylcKSk/KFwrKT8oMHwnW14kXSk/KC0pPyhcZCspPyg/OlwuKFxkKykpPyhbYi1mb3N1eFhdKS8uZXhlYyhfZm10KSkgIT09IG51bGwpIHsKICAgICAgICAgIGlmIChtYXRjaFsyXSkgewogICAgICAgICAgICBhcmdfbmFtZXMgfD0gMTsKICAgICAgICAgICAgdmFyIGZpZWxkX2xpc3QgPSBbXSwgcmVwbGFjZW1lbnRfZmllbGQgPSBtYXRjaFsyXSwgZmllbGRfbWF0Y2ggPSBbXTsKICAgICAgICAgICAgaWYgKChmaWVsZF9tYXRjaCA9IC9eKFthLXpfXVthLXpfXGRdKikvaS5leGVjKHJlcGxhY2VtZW50X2ZpZWxkKSkgIT09IG51bGwpIHsKICAgICAgICAgICAgICBmaWVsZF9saXN0LnB1c2goZmllbGRfbWF0Y2hbMV0pOwogICAgICAgICAgICAgIHdoaWxlICgocmVwbGFjZW1lbnRfZmllbGQgPSByZXBsYWNlbWVudF9maWVsZC5zdWJzdHJpbmcoZmllbGRfbWF0Y2hbMF0ubGVuZ3RoKSkgIT09ICcnKSB7CiAgICAgICAgICAgICAgICBpZiAoKGZpZWxkX21hdGNoID0gL15cLihbYS16X11bYS16X1xkXSopL2kuZXhlYyhyZXBsYWNlbWVudF9maWVsZCkpICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgIGZpZWxkX2xpc3QucHVzaChmaWVsZF9tYXRjaFsxXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIGlmICgoZmllbGRfbWF0Y2ggPSAvXlxbKFxkKylcXS8uZXhlYyhyZXBsYWNlbWVudF9maWVsZCkpICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgIGZpZWxkX2xpc3QucHVzaChmaWVsZF9tYXRjaFsxXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgdGhyb3coJ1tzcHJpbnRmXSBodWg/Jyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgIHRocm93KCdbc3ByaW50Zl0gaHVoPycpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG1hdGNoWzJdID0gZmllbGRfbGlzdDsKICAgICAgICAgIH0KICAgICAgICAgIGVsc2UgewogICAgICAgICAgICBhcmdfbmFtZXMgfD0gMjsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChhcmdfbmFtZXMgPT09IDMpIHsKICAgICAgICAgICAgdGhyb3coJ1tzcHJpbnRmXSBtaXhpbmcgcG9zaXRpb25hbCBhbmQgbmFtZWQgcGxhY2Vob2xkZXJzIGlzIG5vdCAoeWV0KSBzdXBwb3J0ZWQnKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhcnNlX3RyZWUucHVzaChtYXRjaCk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgdGhyb3coJ1tzcHJpbnRmXSBodWg/Jyk7CiAgICAgICAgfQogICAgICAgIF9mbXQgPSBfZm10LnN1YnN0cmluZyhtYXRjaFswXS5sZW5ndGgpOwogICAgICB9CiAgICAgIHJldHVybiBwYXJzZV90cmVlOwogICAgfTsKCiAgICByZXR1cm4gc3RyX2Zvcm1hdDsKICB9KSgpOwoKICB2YXIgdnNwcmludGYgPSBmdW5jdGlvbihmbXQsIGFyZ3YpIHsKICAgIGFyZ3YudW5zaGlmdChmbXQpOwogICAgcmV0dXJuIHNwcmludGYuYXBwbHkobnVsbCwgYXJndik7CiAgfTsKCiAgSmVkLnBhcnNlX3BsdXJhbCA9IGZ1bmN0aW9uICggcGx1cmFsX2Zvcm1zLCBuICkgewogICAgcGx1cmFsX2Zvcm1zID0gcGx1cmFsX2Zvcm1zLnJlcGxhY2UoL24vZywgbik7CiAgICByZXR1cm4gSmVkLnBhcnNlX2V4cHJlc3Npb24ocGx1cmFsX2Zvcm1zKTsKICB9OwoKICBKZWQuc3ByaW50ZiA9IGZ1bmN0aW9uICggZm10LCBhcmdzICkgewogICAgaWYgKCB7fS50b1N0cmluZy5jYWxsKCBhcmdzICkgPT0gJ1tvYmplY3QgQXJyYXldJyApIHsKICAgICAgcmV0dXJuIHZzcHJpbnRmKCBmbXQsIFtdLnNsaWNlLmNhbGwoYXJncykgKTsKICAgIH0KICAgIHJldHVybiBzcHJpbnRmLmFwcGx5KHRoaXMsIFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzKSApOwogIH07CgogIEplZC5wcm90b3R5cGUuc3ByaW50ZiA9IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiBKZWQuc3ByaW50Zi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogIH07CiAgLy8gRU5EIHNwcmludGYgSW1wbGVtZW50YXRpb24KCiAgLy8gU3RhcnQgdGhlIFBsdXJhbCBmb3JtcyBzZWN0aW9uCiAgLy8gVGhpcyBpcyBhIGZ1bGwgcGx1cmFsIGZvcm0gZXhwcmVzc2lvbiBwYXJzZXIuIEl0IGlzIHVzZWQgdG8gYXZvaWQKICAvLyBydW5uaW5nICdldmFsJyBvciAnbmV3IEZ1bmN0aW9uJyBkaXJlY3RseSBhZ2FpbnN0IHRoZSBwbHVyYWwKICAvLyBmb3Jtcy4KICAvLwogIC8vIFRoaXMgY2FuIGJlIGltcG9ydGFudCBpZiB5b3UgZ2V0IHRyYW5zbGF0aW9ucyBkb25lIHRocm91Z2ggYSAzcmQKICAvLyBwYXJ0eSB2ZW5kb3IuIEkgZW5jb3VyYWdlIHlvdSB0byB1c2UgdGhpcyBpbnN0ZWFkLCBob3dldmVyLCBJCiAgLy8gYWxzbyB3aWxsIHByb3ZpZGUgYSAncHJlY29tcGlsZXInIHRoYXQgeW91IGNhbiB1c2UgYXQgYnVpbGQgdGltZQogIC8vIHRvIG91dHB1dCB2YWxpZC9zYWZlIGZ1bmN0aW9uIHJlcHJlc2VudGF0aW9ucyBvZiB0aGUgcGx1cmFsIGZvcm0KICAvLyBleHByZXNzaW9ucy4gVGhpcyBtZWFucyB5b3UgY2FuIGJ1aWxkIHRoaXMgY29kZSBvdXQgZm9yIHRoZSBtb3N0CiAgLy8gcGFydC4KICBKZWQuUEYgPSB7fTsKCiAgSmVkLlBGLnBhcnNlID0gZnVuY3Rpb24gKCBwICkgewogICAgdmFyIHBsdXJhbF9zdHIgPSBKZWQuUEYuZXh0cmFjdFBsdXJhbEV4cHIoIHAgKTsKICAgIHJldHVybiBKZWQuUEYucGFyc2VyLnBhcnNlLmNhbGwoSmVkLlBGLnBhcnNlciwgcGx1cmFsX3N0cik7CiAgfTsKCiAgSmVkLlBGLmNvbXBpbGUgPSBmdW5jdGlvbiAoIHAgKSB7CiAgICAvLyBIYW5kbGUgdHJ1ZXMgYW5kIGZhbHNlcyBhcyAwIGFuZCAxCiAgICBmdW5jdGlvbiBpbXBseSggdmFsICkgewogICAgICByZXR1cm4gKHZhbCA9PT0gdHJ1ZSA/IDEgOiB2YWwgPyB2YWwgOiAwKTsKICAgIH0KCiAgICB2YXIgYXN0ID0gSmVkLlBGLnBhcnNlKCBwICk7CiAgICByZXR1cm4gZnVuY3Rpb24gKCBuICkgewogICAgICByZXR1cm4gaW1wbHkoIEplZC5QRi5pbnRlcnByZXRlciggYXN0ICkoIG4gKSApOwogICAgfTsKICB9OwoKICBKZWQuUEYuaW50ZXJwcmV0ZXIgPSBmdW5jdGlvbiAoIGFzdCApIHsKICAgIHJldHVybiBmdW5jdGlvbiAoIG4gKSB7CiAgICAgIHZhciByZXM7CiAgICAgIHN3aXRjaCAoIGFzdC50eXBlICkgewogICAgICAgIGNhc2UgJ0dST1VQJzoKICAgICAgICAgIHJldHVybiBKZWQuUEYuaW50ZXJwcmV0ZXIoIGFzdC5leHByICkoIG4gKTsKICAgICAgICBjYXNlICdURVJOQVJZJzoKICAgICAgICAgIGlmICggSmVkLlBGLmludGVycHJldGVyKCBhc3QuZXhwciApKCBuICkgKSB7CiAgICAgICAgICAgIHJldHVybiBKZWQuUEYuaW50ZXJwcmV0ZXIoIGFzdC50cnV0aHkgKSggbiApOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIEplZC5QRi5pbnRlcnByZXRlciggYXN0LmZhbHNleSApKCBuICk7CiAgICAgICAgY2FzZSAnT1InOgogICAgICAgICAgcmV0dXJuIEplZC5QRi5pbnRlcnByZXRlciggYXN0LmxlZnQgKSggbiApIHx8IEplZC5QRi5pbnRlcnByZXRlciggYXN0LnJpZ2h0ICkoIG4gKTsKICAgICAgICBjYXNlICdBTkQnOgogICAgICAgICAgcmV0dXJuIEplZC5QRi5pbnRlcnByZXRlciggYXN0LmxlZnQgKSggbiApICYmIEplZC5QRi5pbnRlcnByZXRlciggYXN0LnJpZ2h0ICkoIG4gKTsKICAgICAgICBjYXNlICdMVCc6CiAgICAgICAgICByZXR1cm4gSmVkLlBGLmludGVycHJldGVyKCBhc3QubGVmdCApKCBuICkgPCBKZWQuUEYuaW50ZXJwcmV0ZXIoIGFzdC5yaWdodCApKCBuICk7CiAgICAgICAgY2FzZSAnR1QnOgogICAgICAgICAgcmV0dXJuIEplZC5QRi5pbnRlcnByZXRlciggYXN0LmxlZnQgKSggbiApID4gSmVkLlBGLmludGVycHJldGVyKCBhc3QucmlnaHQgKSggbiApOwogICAgICAgIGNhc2UgJ0xURSc6CiAgICAgICAgICByZXR1cm4gSmVkLlBGLmludGVycHJldGVyKCBhc3QubGVmdCApKCBuICkgPD0gSmVkLlBGLmludGVycHJldGVyKCBhc3QucmlnaHQgKSggbiApOwogICAgICAgIGNhc2UgJ0dURSc6CiAgICAgICAgICByZXR1cm4gSmVkLlBGLmludGVycHJldGVyKCBhc3QubGVmdCApKCBuICkgPj0gSmVkLlBGLmludGVycHJldGVyKCBhc3QucmlnaHQgKSggbiApOwogICAgICAgIGNhc2UgJ0VRJzoKICAgICAgICAgIHJldHVybiBKZWQuUEYuaW50ZXJwcmV0ZXIoIGFzdC5sZWZ0ICkoIG4gKSA9PSBKZWQuUEYuaW50ZXJwcmV0ZXIoIGFzdC5yaWdodCApKCBuICk7CiAgICAgICAgY2FzZSAnTkVRJzoKICAgICAgICAgIHJldHVybiBKZWQuUEYuaW50ZXJwcmV0ZXIoIGFzdC5sZWZ0ICkoIG4gKSAhPSBKZWQuUEYuaW50ZXJwcmV0ZXIoIGFzdC5yaWdodCApKCBuICk7CiAgICAgICAgY2FzZSAnTU9EJzoKICAgICAgICAgIHJldHVybiBKZWQuUEYuaW50ZXJwcmV0ZXIoIGFzdC5sZWZ0ICkoIG4gKSAlIEplZC5QRi5pbnRlcnByZXRlciggYXN0LnJpZ2h0ICkoIG4gKTsKICAgICAgICBjYXNlICdWQVInOgogICAgICAgICAgcmV0dXJuIG47CiAgICAgICAgY2FzZSAnTlVNJzoKICAgICAgICAgIHJldHVybiBhc3QudmFsOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgVG9rZW4gZm91bmQuIik7CiAgICAgIH0KICAgIH07CiAgfTsKCiAgSmVkLlBGLmV4dHJhY3RQbHVyYWxFeHByID0gZnVuY3Rpb24gKCBwICkgewogICAgLy8gdHJpbSBmaXJzdAogICAgcCA9IHAucmVwbGFjZSgvXlxzXHMqLywgJycpLnJlcGxhY2UoL1xzXHMqJC8sICcnKTsKCiAgICBpZiAoISAvO1xzKiQvLnRlc3QocCkpIHsKICAgICAgcCA9IHAuY29uY2F0KCc7Jyk7CiAgICB9CgogICAgdmFyIG5wbHVyYWxzX3JlID0gL25wbHVyYWxzXD0oXGQrKTsvLAogICAgICAgIHBsdXJhbF9yZSA9IC9wbHVyYWxcPSguKik7LywKICAgICAgICBucGx1cmFsc19tYXRjaGVzID0gcC5tYXRjaCggbnBsdXJhbHNfcmUgKSwKICAgICAgICByZXMgPSB7fSwKICAgICAgICBwbHVyYWxfbWF0Y2hlczsKCiAgICAvLyBGaW5kIHRoZSBucGx1cmFscyBudW1iZXIKICAgIGlmICggbnBsdXJhbHNfbWF0Y2hlcy5sZW5ndGggPiAxICkgewogICAgICByZXMubnBsdXJhbHMgPSBucGx1cmFsc19tYXRjaGVzWzFdOwogICAgfQogICAgZWxzZSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignbnBsdXJhbHMgbm90IGZvdW5kIGluIHBsdXJhbF9mb3JtcyBzdHJpbmc6ICcgKyBwICk7CiAgICB9CgogICAgLy8gcmVtb3ZlIHRoYXQgZGF0YSB0byBnZXQgdG8gdGhlIGZvcm11bGEKICAgIHAgPSBwLnJlcGxhY2UoIG5wbHVyYWxzX3JlLCAiIiApOwogICAgcGx1cmFsX21hdGNoZXMgPSBwLm1hdGNoKCBwbHVyYWxfcmUgKTsKCiAgICBpZiAoISggcGx1cmFsX21hdGNoZXMgJiYgcGx1cmFsX21hdGNoZXMubGVuZ3RoID4gMSApICkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ2BwbHVyYWxgIGV4cHJlc3Npb24gbm90IGZvdW5kOiAnICsgcCk7CiAgICB9CiAgICByZXR1cm4gcGx1cmFsX21hdGNoZXNbIDEgXTsKICB9OwoKICAvKiBKaXNvbiBnZW5lcmF0ZWQgcGFyc2VyICovCiAgSmVkLlBGLnBhcnNlciA9IChmdW5jdGlvbigpewoKdmFyIHBhcnNlciA9IHt0cmFjZTogZnVuY3Rpb24gdHJhY2UoKSB7IH0sCnl5OiB7fSwKc3ltYm9sc186IHsiZXJyb3IiOjIsImV4cHJlc3Npb25zIjozLCJlIjo0LCJFT0YiOjUsIj8iOjYsIjoiOjcsInx8Ijo4LCImJiI6OSwiPCI6MTAsIjw9IjoxMSwiPiI6MTIsIj49IjoxMywiIT0iOjE0LCI9PSI6MTUsIiUiOjE2LCIoIjoxNywiKSI6MTgsIm4iOjE5LCJOVU1CRVIiOjIwLCIkYWNjZXB0IjowLCIkZW5kIjoxfSwKdGVybWluYWxzXzogezI6ImVycm9yIiw1OiJFT0YiLDY6Ij8iLDc6IjoiLDg6Inx8Iiw5OiImJiIsMTA6IjwiLDExOiI8PSIsMTI6Ij4iLDEzOiI+PSIsMTQ6IiE9IiwxNToiPT0iLDE2OiIlIiwxNzoiKCIsMTg6IikiLDE5OiJuIiwyMDoiTlVNQkVSIn0sCnByb2R1Y3Rpb25zXzogWzAsWzMsMl0sWzQsNV0sWzQsM10sWzQsM10sWzQsM10sWzQsM10sWzQsM10sWzQsM10sWzQsM10sWzQsM10sWzQsM10sWzQsM10sWzQsMV0sWzQsMV1dLApwZXJmb3JtQWN0aW9uOiBmdW5jdGlvbiBhbm9ueW1vdXMoeXl0ZXh0LHl5bGVuZyx5eWxpbmVubyx5eSx5eXN0YXRlLCQkLF8kKSB7Cgp2YXIgJDAgPSAkJC5sZW5ndGggLSAxOwpzd2l0Y2ggKHl5c3RhdGUpIHsKY2FzZSAxOiByZXR1cm4geyB0eXBlIDogJ0dST1VQJywgZXhwcjogJCRbJDAtMV0gfTsgCmJyZWFrOwpjYXNlIDI6dGhpcy4kID0geyB0eXBlOiAnVEVSTkFSWScsIGV4cHI6ICQkWyQwLTRdLCB0cnV0aHkgOiAkJFskMC0yXSwgZmFsc2V5OiAkJFskMF0gfTsgCmJyZWFrOwpjYXNlIDM6dGhpcy4kID0geyB0eXBlOiAiT1IiLCBsZWZ0OiAkJFskMC0yXSwgcmlnaHQ6ICQkWyQwXSB9OwpicmVhazsKY2FzZSA0OnRoaXMuJCA9IHsgdHlwZTogIkFORCIsIGxlZnQ6ICQkWyQwLTJdLCByaWdodDogJCRbJDBdIH07CmJyZWFrOwpjYXNlIDU6dGhpcy4kID0geyB0eXBlOiAnTFQnLCBsZWZ0OiAkJFskMC0yXSwgcmlnaHQ6ICQkWyQwXSB9OyAKYnJlYWs7CmNhc2UgNjp0aGlzLiQgPSB7IHR5cGU6ICdMVEUnLCBsZWZ0OiAkJFskMC0yXSwgcmlnaHQ6ICQkWyQwXSB9OwpicmVhazsKY2FzZSA3OnRoaXMuJCA9IHsgdHlwZTogJ0dUJywgbGVmdDogJCRbJDAtMl0sIHJpZ2h0OiAkJFskMF0gfTsKYnJlYWs7CmNhc2UgODp0aGlzLiQgPSB7IHR5cGU6ICdHVEUnLCBsZWZ0OiAkJFskMC0yXSwgcmlnaHQ6ICQkWyQwXSB9OwpicmVhazsKY2FzZSA5OnRoaXMuJCA9IHsgdHlwZTogJ05FUScsIGxlZnQ6ICQkWyQwLTJdLCByaWdodDogJCRbJDBdIH07CmJyZWFrOwpjYXNlIDEwOnRoaXMuJCA9IHsgdHlwZTogJ0VRJywgbGVmdDogJCRbJDAtMl0sIHJpZ2h0OiAkJFskMF0gfTsKYnJlYWs7CmNhc2UgMTE6dGhpcy4kID0geyB0eXBlOiAnTU9EJywgbGVmdDogJCRbJDAtMl0sIHJpZ2h0OiAkJFskMF0gfTsKYnJlYWs7CmNhc2UgMTI6dGhpcy4kID0geyB0eXBlOiAnR1JPVVAnLCBleHByOiAkJFskMC0xXSB9OyAKYnJlYWs7CmNhc2UgMTM6dGhpcy4kID0geyB0eXBlOiAnVkFSJyB9OyAKYnJlYWs7CmNhc2UgMTQ6dGhpcy4kID0geyB0eXBlOiAnTlVNJywgdmFsOiBOdW1iZXIoeXl0ZXh0KSB9OyAKYnJlYWs7Cn0KfSwKdGFibGU6IFt7MzoxLDQ6MiwxNzpbMSwzXSwxOTpbMSw0XSwyMDpbMSw1XX0sezE6WzNdfSx7NTpbMSw2XSw2OlsxLDddLDg6WzEsOF0sOTpbMSw5XSwxMDpbMSwxMF0sMTE6WzEsMTFdLDEyOlsxLDEyXSwxMzpbMSwxM10sMTQ6WzEsMTRdLDE1OlsxLDE1XSwxNjpbMSwxNl19LHs0OjE3LDE3OlsxLDNdLDE5OlsxLDRdLDIwOlsxLDVdfSx7NTpbMiwxM10sNjpbMiwxM10sNzpbMiwxM10sODpbMiwxM10sOTpbMiwxM10sMTA6WzIsMTNdLDExOlsyLDEzXSwxMjpbMiwxM10sMTM6WzIsMTNdLDE0OlsyLDEzXSwxNTpbMiwxM10sMTY6WzIsMTNdLDE4OlsyLDEzXX0sezU6WzIsMTRdLDY6WzIsMTRdLDc6WzIsMTRdLDg6WzIsMTRdLDk6WzIsMTRdLDEwOlsyLDE0XSwxMTpbMiwxNF0sMTI6WzIsMTRdLDEzOlsyLDE0XSwxNDpbMiwxNF0sMTU6WzIsMTRdLDE2OlsyLDE0XSwxODpbMiwxNF19LHsxOlsyLDFdfSx7NDoxOCwxNzpbMSwzXSwxOTpbMSw0XSwyMDpbMSw1XX0sezQ6MTksMTc6WzEsM10sMTk6WzEsNF0sMjA6WzEsNV19LHs0OjIwLDE3OlsxLDNdLDE5OlsxLDRdLDIwOlsxLDVdfSx7NDoyMSwxNzpbMSwzXSwxOTpbMSw0XSwyMDpbMSw1XX0sezQ6MjIsMTc6WzEsM10sMTk6WzEsNF0sMjA6WzEsNV19LHs0OjIzLDE3OlsxLDNdLDE5OlsxLDRdLDIwOlsxLDVdfSx7NDoyNCwxNzpbMSwzXSwxOTpbMSw0XSwyMDpbMSw1XX0sezQ6MjUsMTc6WzEsM10sMTk6WzEsNF0sMjA6WzEsNV19LHs0OjI2LDE3OlsxLDNdLDE5OlsxLDRdLDIwOlsxLDVdfSx7NDoyNywxNzpbMSwzXSwxOTpbMSw0XSwyMDpbMSw1XX0sezY6WzEsN10sODpbMSw4XSw5OlsxLDldLDEwOlsxLDEwXSwxMTpbMSwxMV0sMTI6WzEsMTJdLDEzOlsxLDEzXSwxNDpbMSwxNF0sMTU6WzEsMTVdLDE2OlsxLDE2XSwxODpbMSwyOF19LHs2OlsxLDddLDc6WzEsMjldLDg6WzEsOF0sOTpbMSw5XSwxMDpbMSwxMF0sMTE6WzEsMTFdLDEyOlsxLDEyXSwxMzpbMSwxM10sMTQ6WzEsMTRdLDE1OlsxLDE1XSwxNjpbMSwxNl19LHs1OlsyLDNdLDY6WzIsM10sNzpbMiwzXSw4OlsyLDNdLDk6WzEsOV0sMTA6WzEsMTBdLDExOlsxLDExXSwxMjpbMSwxMl0sMTM6WzEsMTNdLDE0OlsxLDE0XSwxNTpbMSwxNV0sMTY6WzEsMTZdLDE4OlsyLDNdfSx7NTpbMiw0XSw2OlsyLDRdLDc6WzIsNF0sODpbMiw0XSw5OlsyLDRdLDEwOlsxLDEwXSwxMTpbMSwxMV0sMTI6WzEsMTJdLDEzOlsxLDEzXSwxNDpbMSwxNF0sMTU6WzEsMTVdLDE2OlsxLDE2XSwxODpbMiw0XX0sezU6WzIsNV0sNjpbMiw1XSw3OlsyLDVdLDg6WzIsNV0sOTpbMiw1XSwxMDpbMiw1XSwxMTpbMiw1XSwxMjpbMiw1XSwxMzpbMiw1XSwxNDpbMiw1XSwxNTpbMiw1XSwxNjpbMSwxNl0sMTg6WzIsNV19LHs1OlsyLDZdLDY6WzIsNl0sNzpbMiw2XSw4OlsyLDZdLDk6WzIsNl0sMTA6WzIsNl0sMTE6WzIsNl0sMTI6WzIsNl0sMTM6WzIsNl0sMTQ6WzIsNl0sMTU6WzIsNl0sMTY6WzEsMTZdLDE4OlsyLDZdfSx7NTpbMiw3XSw2OlsyLDddLDc6WzIsN10sODpbMiw3XSw5OlsyLDddLDEwOlsyLDddLDExOlsyLDddLDEyOlsyLDddLDEzOlsyLDddLDE0OlsyLDddLDE1OlsyLDddLDE2OlsxLDE2XSwxODpbMiw3XX0sezU6WzIsOF0sNjpbMiw4XSw3OlsyLDhdLDg6WzIsOF0sOTpbMiw4XSwxMDpbMiw4XSwxMTpbMiw4XSwxMjpbMiw4XSwxMzpbMiw4XSwxNDpbMiw4XSwxNTpbMiw4XSwxNjpbMSwxNl0sMTg6WzIsOF19LHs1OlsyLDldLDY6WzIsOV0sNzpbMiw5XSw4OlsyLDldLDk6WzIsOV0sMTA6WzIsOV0sMTE6WzIsOV0sMTI6WzIsOV0sMTM6WzIsOV0sMTQ6WzIsOV0sMTU6WzIsOV0sMTY6WzEsMTZdLDE4OlsyLDldfSx7NTpbMiwxMF0sNjpbMiwxMF0sNzpbMiwxMF0sODpbMiwxMF0sOTpbMiwxMF0sMTA6WzIsMTBdLDExOlsyLDEwXSwxMjpbMiwxMF0sMTM6WzIsMTBdLDE0OlsyLDEwXSwxNTpbMiwxMF0sMTY6WzEsMTZdLDE4OlsyLDEwXX0sezU6WzIsMTFdLDY6WzIsMTFdLDc6WzIsMTFdLDg6WzIsMTFdLDk6WzIsMTFdLDEwOlsyLDExXSwxMTpbMiwxMV0sMTI6WzIsMTFdLDEzOlsyLDExXSwxNDpbMiwxMV0sMTU6WzIsMTFdLDE2OlsyLDExXSwxODpbMiwxMV19LHs1OlsyLDEyXSw2OlsyLDEyXSw3OlsyLDEyXSw4OlsyLDEyXSw5OlsyLDEyXSwxMDpbMiwxMl0sMTE6WzIsMTJdLDEyOlsyLDEyXSwxMzpbMiwxMl0sMTQ6WzIsMTJdLDE1OlsyLDEyXSwxNjpbMiwxMl0sMTg6WzIsMTJdfSx7NDozMCwxNzpbMSwzXSwxOTpbMSw0XSwyMDpbMSw1XX0sezU6WzIsMl0sNjpbMSw3XSw3OlsyLDJdLDg6WzEsOF0sOTpbMSw5XSwxMDpbMSwxMF0sMTE6WzEsMTFdLDEyOlsxLDEyXSwxMzpbMSwxM10sMTQ6WzEsMTRdLDE1OlsxLDE1XSwxNjpbMSwxNl0sMTg6WzIsMl19XSwKZGVmYXVsdEFjdGlvbnM6IHs2OlsyLDFdfSwKcGFyc2VFcnJvcjogZnVuY3Rpb24gcGFyc2VFcnJvcihzdHIsIGhhc2gpIHsKICAgIHRocm93IG5ldyBFcnJvcihzdHIpOwp9LApwYXJzZTogZnVuY3Rpb24gcGFyc2UoaW5wdXQpIHsKICAgIHZhciBzZWxmID0gdGhpcywKICAgICAgICBzdGFjayA9IFswXSwKICAgICAgICB2c3RhY2sgPSBbbnVsbF0sIC8vIHNlbWFudGljIHZhbHVlIHN0YWNrCiAgICAgICAgbHN0YWNrID0gW10sIC8vIGxvY2F0aW9uIHN0YWNrCiAgICAgICAgdGFibGUgPSB0aGlzLnRhYmxlLAogICAgICAgIHl5dGV4dCA9ICcnLAogICAgICAgIHl5bGluZW5vID0gMCwKICAgICAgICB5eWxlbmcgPSAwLAogICAgICAgIHJlY292ZXJpbmcgPSAwLAogICAgICAgIFRFUlJPUiA9IDIsCiAgICAgICAgRU9GID0gMTsKCiAgICAvL3RoaXMucmVkdWN0aW9uQ291bnQgPSB0aGlzLnNoaWZ0Q291bnQgPSAwOwoKICAgIHRoaXMubGV4ZXIuc2V0SW5wdXQoaW5wdXQpOwogICAgdGhpcy5sZXhlci55eSA9IHRoaXMueXk7CiAgICB0aGlzLnl5LmxleGVyID0gdGhpcy5sZXhlcjsKICAgIGlmICh0eXBlb2YgdGhpcy5sZXhlci55eWxsb2MgPT0gJ3VuZGVmaW5lZCcpCiAgICAgICAgdGhpcy5sZXhlci55eWxsb2MgPSB7fTsKICAgIHZhciB5eWxvYyA9IHRoaXMubGV4ZXIueXlsbG9jOwogICAgbHN0YWNrLnB1c2goeXlsb2MpOwoKICAgIGlmICh0eXBlb2YgdGhpcy55eS5wYXJzZUVycm9yID09PSAnZnVuY3Rpb24nKQogICAgICAgIHRoaXMucGFyc2VFcnJvciA9IHRoaXMueXkucGFyc2VFcnJvcjsKCiAgICBmdW5jdGlvbiBwb3BTdGFjayAobikgewogICAgICAgIHN0YWNrLmxlbmd0aCA9IHN0YWNrLmxlbmd0aCAtIDIqbjsKICAgICAgICB2c3RhY2subGVuZ3RoID0gdnN0YWNrLmxlbmd0aCAtIG47CiAgICAgICAgbHN0YWNrLmxlbmd0aCA9IGxzdGFjay5sZW5ndGggLSBuOwogICAgfQoKICAgIGZ1bmN0aW9uIGxleCgpIHsKICAgICAgICB2YXIgdG9rZW47CiAgICAgICAgdG9rZW4gPSBzZWxmLmxleGVyLmxleCgpIHx8IDE7IC8vICRlbmQgPSAxCiAgICAgICAgLy8gaWYgdG9rZW4gaXNuJ3QgaXRzIG51bWVyaWMgdmFsdWUsIGNvbnZlcnQKICAgICAgICBpZiAodHlwZW9mIHRva2VuICE9PSAnbnVtYmVyJykgewogICAgICAgICAgICB0b2tlbiA9IHNlbGYuc3ltYm9sc19bdG9rZW5dIHx8IHRva2VuOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdG9rZW47CiAgICB9CgogICAgdmFyIHN5bWJvbCwgcHJlRXJyb3JTeW1ib2wsIHN0YXRlLCBhY3Rpb24sIGEsIHIsIHl5dmFsPXt9LHAsbGVuLG5ld1N0YXRlLCBleHBlY3RlZDsKICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgLy8gcmV0cmVpdmUgc3RhdGUgbnVtYmVyIGZyb20gdG9wIG9mIHN0YWNrCiAgICAgICAgc3RhdGUgPSBzdGFja1tzdGFjay5sZW5ndGgtMV07CgogICAgICAgIC8vIHVzZSBkZWZhdWx0IGFjdGlvbnMgaWYgYXZhaWxhYmxlCiAgICAgICAgaWYgKHRoaXMuZGVmYXVsdEFjdGlvbnNbc3RhdGVdKSB7CiAgICAgICAgICAgIGFjdGlvbiA9IHRoaXMuZGVmYXVsdEFjdGlvbnNbc3RhdGVdOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmIChzeW1ib2wgPT0gbnVsbCkKICAgICAgICAgICAgICAgIHN5bWJvbCA9IGxleCgpOwogICAgICAgICAgICAvLyByZWFkIGFjdGlvbiBmb3IgY3VycmVudCBzdGF0ZSBhbmQgZmlyc3QgaW5wdXQKICAgICAgICAgICAgYWN0aW9uID0gdGFibGVbc3RhdGVdICYmIHRhYmxlW3N0YXRlXVtzeW1ib2xdOwogICAgICAgIH0KCiAgICAgICAgLy8gaGFuZGxlIHBhcnNlIGVycm9yCiAgICAgICAgX2hhbmRsZV9lcnJvcjoKICAgICAgICBpZiAodHlwZW9mIGFjdGlvbiA9PT0gJ3VuZGVmaW5lZCcgfHwgIWFjdGlvbi5sZW5ndGggfHwgIWFjdGlvblswXSkgewoKICAgICAgICAgICAgaWYgKCFyZWNvdmVyaW5nKSB7CiAgICAgICAgICAgICAgICAvLyBSZXBvcnQgZXJyb3IKICAgICAgICAgICAgICAgIGV4cGVjdGVkID0gW107CiAgICAgICAgICAgICAgICBmb3IgKHAgaW4gdGFibGVbc3RhdGVdKSBpZiAodGhpcy50ZXJtaW5hbHNfW3BdICYmIHAgPiAyKSB7CiAgICAgICAgICAgICAgICAgICAgZXhwZWN0ZWQucHVzaCgiJyIrdGhpcy50ZXJtaW5hbHNfW3BdKyInIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB2YXIgZXJyU3RyID0gJyc7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5sZXhlci5zaG93UG9zaXRpb24pIHsKICAgICAgICAgICAgICAgICAgICBlcnJTdHIgPSAnUGFyc2UgZXJyb3Igb24gbGluZSAnKyh5eWxpbmVubysxKSsiOlxuIit0aGlzLmxleGVyLnNob3dQb3NpdGlvbigpKyJcbkV4cGVjdGluZyAiK2V4cGVjdGVkLmpvaW4oJywgJykgKyAiLCBnb3QgJyIgKyB0aGlzLnRlcm1pbmFsc19bc3ltYm9sXSsgIiciOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBlcnJTdHIgPSAnUGFyc2UgZXJyb3Igb24gbGluZSAnKyh5eWxpbmVubysxKSsiOiBVbmV4cGVjdGVkICIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHN5bWJvbCA9PSAxIC8qRU9GKi8gPyAiZW5kIG9mIGlucHV0IiA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoIiciKyh0aGlzLnRlcm1pbmFsc19bc3ltYm9sXSB8fCBzeW1ib2wpKyInIikpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5wYXJzZUVycm9yKGVyclN0ciwKICAgICAgICAgICAgICAgICAgICB7dGV4dDogdGhpcy5sZXhlci5tYXRjaCwgdG9rZW46IHRoaXMudGVybWluYWxzX1tzeW1ib2xdIHx8IHN5bWJvbCwgbGluZTogdGhpcy5sZXhlci55eWxpbmVubywgbG9jOiB5eWxvYywgZXhwZWN0ZWQ6IGV4cGVjdGVkfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGp1c3QgcmVjb3ZlcmVkIGZyb20gYW5vdGhlciBlcnJvcgogICAgICAgICAgICBpZiAocmVjb3ZlcmluZyA9PSAzKSB7CiAgICAgICAgICAgICAgICBpZiAoc3ltYm9sID09IEVPRikgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihlcnJTdHIgfHwgJ1BhcnNpbmcgaGFsdGVkLicpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIGRpc2NhcmQgY3VycmVudCBsb29rYWhlYWQgYW5kIGdyYWIgYW5vdGhlcgogICAgICAgICAgICAgICAgeXlsZW5nID0gdGhpcy5sZXhlci55eWxlbmc7CiAgICAgICAgICAgICAgICB5eXRleHQgPSB0aGlzLmxleGVyLnl5dGV4dDsKICAgICAgICAgICAgICAgIHl5bGluZW5vID0gdGhpcy5sZXhlci55eWxpbmVubzsKICAgICAgICAgICAgICAgIHl5bG9jID0gdGhpcy5sZXhlci55eWxsb2M7CiAgICAgICAgICAgICAgICBzeW1ib2wgPSBsZXgoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gdHJ5IHRvIHJlY292ZXIgZnJvbSBlcnJvcgogICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgLy8gY2hlY2sgZm9yIGVycm9yIHJlY292ZXJ5IHJ1bGUgaW4gdGhpcyBzdGF0ZQogICAgICAgICAgICAgICAgaWYgKChURVJST1IudG9TdHJpbmcoKSkgaW4gdGFibGVbc3RhdGVdKSB7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoc3RhdGUgPT0gMCkgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihlcnJTdHIgfHwgJ1BhcnNpbmcgaGFsdGVkLicpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcG9wU3RhY2soMSk7CiAgICAgICAgICAgICAgICBzdGF0ZSA9IHN0YWNrW3N0YWNrLmxlbmd0aC0xXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHJlRXJyb3JTeW1ib2wgPSBzeW1ib2w7IC8vIHNhdmUgdGhlIGxvb2thaGVhZCB0b2tlbgogICAgICAgICAgICBzeW1ib2wgPSBURVJST1I7ICAgICAgICAgLy8gaW5zZXJ0IGdlbmVyaWMgZXJyb3Igc3ltYm9sIGFzIG5ldyBsb29rYWhlYWQKICAgICAgICAgICAgc3RhdGUgPSBzdGFja1tzdGFjay5sZW5ndGgtMV07CiAgICAgICAgICAgIGFjdGlvbiA9IHRhYmxlW3N0YXRlXSAmJiB0YWJsZVtzdGF0ZV1bVEVSUk9SXTsKICAgICAgICAgICAgcmVjb3ZlcmluZyA9IDM7IC8vIGFsbG93IDMgcmVhbCBzeW1ib2xzIHRvIGJlIHNoaWZ0ZWQgYmVmb3JlIHJlcG9ydGluZyBhIG5ldyBlcnJvcgogICAgICAgIH0KCiAgICAgICAgLy8gdGhpcyBzaG91bGRuJ3QgaGFwcGVuLCB1bmxlc3MgcmVzb2x2ZSBkZWZhdWx0cyBhcmUgb2ZmCiAgICAgICAgaWYgKGFjdGlvblswXSBpbnN0YW5jZW9mIEFycmF5ICYmIGFjdGlvbi5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUGFyc2UgRXJyb3I6IG11bHRpcGxlIGFjdGlvbnMgcG9zc2libGUgYXQgc3RhdGU6ICcrc3RhdGUrJywgdG9rZW46ICcrc3ltYm9sKTsKICAgICAgICB9CgogICAgICAgIHN3aXRjaCAoYWN0aW9uWzBdKSB7CgogICAgICAgICAgICBjYXNlIDE6IC8vIHNoaWZ0CiAgICAgICAgICAgICAgICAvL3RoaXMuc2hpZnRDb3VudCsrOwoKICAgICAgICAgICAgICAgIHN0YWNrLnB1c2goc3ltYm9sKTsKICAgICAgICAgICAgICAgIHZzdGFjay5wdXNoKHRoaXMubGV4ZXIueXl0ZXh0KTsKICAgICAgICAgICAgICAgIGxzdGFjay5wdXNoKHRoaXMubGV4ZXIueXlsbG9jKTsKICAgICAgICAgICAgICAgIHN0YWNrLnB1c2goYWN0aW9uWzFdKTsgLy8gcHVzaCBzdGF0ZQogICAgICAgICAgICAgICAgc3ltYm9sID0gbnVsbDsKICAgICAgICAgICAgICAgIGlmICghcHJlRXJyb3JTeW1ib2wpIHsgLy8gbm9ybWFsIGV4ZWN1dGlvbi9ubyBlcnJvcgogICAgICAgICAgICAgICAgICAgIHl5bGVuZyA9IHRoaXMubGV4ZXIueXlsZW5nOwogICAgICAgICAgICAgICAgICAgIHl5dGV4dCA9IHRoaXMubGV4ZXIueXl0ZXh0OwogICAgICAgICAgICAgICAgICAgIHl5bGluZW5vID0gdGhpcy5sZXhlci55eWxpbmVubzsKICAgICAgICAgICAgICAgICAgICB5eWxvYyA9IHRoaXMubGV4ZXIueXlsbG9jOwogICAgICAgICAgICAgICAgICAgIGlmIChyZWNvdmVyaW5nID4gMCkKICAgICAgICAgICAgICAgICAgICAgICAgcmVjb3ZlcmluZy0tOwogICAgICAgICAgICAgICAgfSBlbHNlIHsgLy8gZXJyb3IganVzdCBvY2N1cnJlZCwgcmVzdW1lIG9sZCBsb29rYWhlYWQgZi8gYmVmb3JlIGVycm9yCiAgICAgICAgICAgICAgICAgICAgc3ltYm9sID0gcHJlRXJyb3JTeW1ib2w7CiAgICAgICAgICAgICAgICAgICAgcHJlRXJyb3JTeW1ib2wgPSBudWxsOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIDI6IC8vIHJlZHVjZQogICAgICAgICAgICAgICAgLy90aGlzLnJlZHVjdGlvbkNvdW50Kys7CgogICAgICAgICAgICAgICAgbGVuID0gdGhpcy5wcm9kdWN0aW9uc19bYWN0aW9uWzFdXVsxXTsKCiAgICAgICAgICAgICAgICAvLyBwZXJmb3JtIHNlbWFudGljIGFjdGlvbgogICAgICAgICAgICAgICAgeXl2YWwuJCA9IHZzdGFja1t2c3RhY2subGVuZ3RoLWxlbl07IC8vIGRlZmF1bHQgdG8gJCQgPSAkMQogICAgICAgICAgICAgICAgLy8gZGVmYXVsdCBsb2NhdGlvbiwgdXNlcyBmaXJzdCB0b2tlbiBmb3IgZmlyc3RzLCBsYXN0IGZvciBsYXN0cwogICAgICAgICAgICAgICAgeXl2YWwuXyQgPSB7CiAgICAgICAgICAgICAgICAgICAgZmlyc3RfbGluZTogbHN0YWNrW2xzdGFjay5sZW5ndGgtKGxlbnx8MSldLmZpcnN0X2xpbmUsCiAgICAgICAgICAgICAgICAgICAgbGFzdF9saW5lOiBsc3RhY2tbbHN0YWNrLmxlbmd0aC0xXS5sYXN0X2xpbmUsCiAgICAgICAgICAgICAgICAgICAgZmlyc3RfY29sdW1uOiBsc3RhY2tbbHN0YWNrLmxlbmd0aC0obGVufHwxKV0uZmlyc3RfY29sdW1uLAogICAgICAgICAgICAgICAgICAgIGxhc3RfY29sdW1uOiBsc3RhY2tbbHN0YWNrLmxlbmd0aC0xXS5sYXN0X2NvbHVtbgogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIHIgPSB0aGlzLnBlcmZvcm1BY3Rpb24uY2FsbCh5eXZhbCwgeXl0ZXh0LCB5eWxlbmcsIHl5bGluZW5vLCB0aGlzLnl5LCBhY3Rpb25bMV0sIHZzdGFjaywgbHN0YWNrKTsKCiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHIgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHI7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gcG9wIG9mZiBzdGFjawogICAgICAgICAgICAgICAgaWYgKGxlbikgewogICAgICAgICAgICAgICAgICAgIHN0YWNrID0gc3RhY2suc2xpY2UoMCwtMSpsZW4qMik7CiAgICAgICAgICAgICAgICAgICAgdnN0YWNrID0gdnN0YWNrLnNsaWNlKDAsIC0xKmxlbik7CiAgICAgICAgICAgICAgICAgICAgbHN0YWNrID0gbHN0YWNrLnNsaWNlKDAsIC0xKmxlbik7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgc3RhY2sucHVzaCh0aGlzLnByb2R1Y3Rpb25zX1thY3Rpb25bMV1dWzBdKTsgICAgLy8gcHVzaCBub250ZXJtaW5hbCAocmVkdWNlKQogICAgICAgICAgICAgICAgdnN0YWNrLnB1c2goeXl2YWwuJCk7CiAgICAgICAgICAgICAgICBsc3RhY2sucHVzaCh5eXZhbC5fJCk7CiAgICAgICAgICAgICAgICAvLyBnb3RvIG5ldyBzdGF0ZSA9IHRhYmxlW1NUQVRFXVtOT05URVJNSU5BTF0KICAgICAgICAgICAgICAgIG5ld1N0YXRlID0gdGFibGVbc3RhY2tbc3RhY2subGVuZ3RoLTJdXVtzdGFja1tzdGFjay5sZW5ndGgtMV1dOwogICAgICAgICAgICAgICAgc3RhY2sucHVzaChuZXdTdGF0ZSk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgMzogLy8gYWNjZXB0CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgfQoKICAgIHJldHVybiB0cnVlOwp9fTsvKiBKaXNvbiBnZW5lcmF0ZWQgbGV4ZXIgKi8KdmFyIGxleGVyID0gKGZ1bmN0aW9uKCl7Cgp2YXIgbGV4ZXIgPSAoe0VPRjoxLApwYXJzZUVycm9yOmZ1bmN0aW9uIHBhcnNlRXJyb3Ioc3RyLCBoYXNoKSB7CiAgICAgICAgaWYgKHRoaXMueXkucGFyc2VFcnJvcikgewogICAgICAgICAgICB0aGlzLnl5LnBhcnNlRXJyb3Ioc3RyLCBoYXNoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3Ioc3RyKTsKICAgICAgICB9CiAgICB9LApzZXRJbnB1dDpmdW5jdGlvbiAoaW5wdXQpIHsKICAgICAgICB0aGlzLl9pbnB1dCA9IGlucHV0OwogICAgICAgIHRoaXMuX21vcmUgPSB0aGlzLl9sZXNzID0gdGhpcy5kb25lID0gZmFsc2U7CiAgICAgICAgdGhpcy55eWxpbmVubyA9IHRoaXMueXlsZW5nID0gMDsKICAgICAgICB0aGlzLnl5dGV4dCA9IHRoaXMubWF0Y2hlZCA9IHRoaXMubWF0Y2ggPSAnJzsKICAgICAgICB0aGlzLmNvbmRpdGlvblN0YWNrID0gWydJTklUSUFMJ107CiAgICAgICAgdGhpcy55eWxsb2MgPSB7Zmlyc3RfbGluZToxLGZpcnN0X2NvbHVtbjowLGxhc3RfbGluZToxLGxhc3RfY29sdW1uOjB9OwogICAgICAgIHJldHVybiB0aGlzOwogICAgfSwKaW5wdXQ6ZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBjaCA9IHRoaXMuX2lucHV0WzBdOwogICAgICAgIHRoaXMueXl0ZXh0Kz1jaDsKICAgICAgICB0aGlzLnl5bGVuZysrOwogICAgICAgIHRoaXMubWF0Y2grPWNoOwogICAgICAgIHRoaXMubWF0Y2hlZCs9Y2g7CiAgICAgICAgdmFyIGxpbmVzID0gY2gubWF0Y2goL1xuLyk7CiAgICAgICAgaWYgKGxpbmVzKSB0aGlzLnl5bGluZW5vKys7CiAgICAgICAgdGhpcy5faW5wdXQgPSB0aGlzLl9pbnB1dC5zbGljZSgxKTsKICAgICAgICByZXR1cm4gY2g7CiAgICB9LAp1bnB1dDpmdW5jdGlvbiAoY2gpIHsKICAgICAgICB0aGlzLl9pbnB1dCA9IGNoICsgdGhpcy5faW5wdXQ7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAptb3JlOmZ1bmN0aW9uICgpIHsKICAgICAgICB0aGlzLl9tb3JlID0gdHJ1ZTsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0sCnBhc3RJbnB1dDpmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHBhc3QgPSB0aGlzLm1hdGNoZWQuc3Vic3RyKDAsIHRoaXMubWF0Y2hlZC5sZW5ndGggLSB0aGlzLm1hdGNoLmxlbmd0aCk7CiAgICAgICAgcmV0dXJuIChwYXN0Lmxlbmd0aCA+IDIwID8gJy4uLic6JycpICsgcGFzdC5zdWJzdHIoLTIwKS5yZXBsYWNlKC9cbi9nLCAiIik7CiAgICB9LAp1cGNvbWluZ0lucHV0OmZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgbmV4dCA9IHRoaXMubWF0Y2g7CiAgICAgICAgaWYgKG5leHQubGVuZ3RoIDwgMjApIHsKICAgICAgICAgICAgbmV4dCArPSB0aGlzLl9pbnB1dC5zdWJzdHIoMCwgMjAtbmV4dC5sZW5ndGgpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gKG5leHQuc3Vic3RyKDAsMjApKyhuZXh0Lmxlbmd0aCA+IDIwID8gJy4uLic6JycpKS5yZXBsYWNlKC9cbi9nLCAiIik7CiAgICB9LApzaG93UG9zaXRpb246ZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBwcmUgPSB0aGlzLnBhc3RJbnB1dCgpOwogICAgICAgIHZhciBjID0gbmV3IEFycmF5KHByZS5sZW5ndGggKyAxKS5qb2luKCItIik7CiAgICAgICAgcmV0dXJuIHByZSArIHRoaXMudXBjb21pbmdJbnB1dCgpICsgIlxuIiArIGMrIl4iOwogICAgfSwKbmV4dDpmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKHRoaXMuZG9uZSkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5FT0Y7CiAgICAgICAgfQogICAgICAgIGlmICghdGhpcy5faW5wdXQpIHRoaXMuZG9uZSA9IHRydWU7CgogICAgICAgIHZhciB0b2tlbiwKICAgICAgICAgICAgbWF0Y2gsCiAgICAgICAgICAgIGNvbCwKICAgICAgICAgICAgbGluZXM7CiAgICAgICAgaWYgKCF0aGlzLl9tb3JlKSB7CiAgICAgICAgICAgIHRoaXMueXl0ZXh0ID0gJyc7CiAgICAgICAgICAgIHRoaXMubWF0Y2ggPSAnJzsKICAgICAgICB9CiAgICAgICAgdmFyIHJ1bGVzID0gdGhpcy5fY3VycmVudFJ1bGVzKCk7CiAgICAgICAgZm9yICh2YXIgaT0wO2kgPCBydWxlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBtYXRjaCA9IHRoaXMuX2lucHV0Lm1hdGNoKHRoaXMucnVsZXNbcnVsZXNbaV1dKTsKICAgICAgICAgICAgaWYgKG1hdGNoKSB7CiAgICAgICAgICAgICAgICBsaW5lcyA9IG1hdGNoWzBdLm1hdGNoKC9cbi4qL2cpOwogICAgICAgICAgICAgICAgaWYgKGxpbmVzKSB0aGlzLnl5bGluZW5vICs9IGxpbmVzLmxlbmd0aDsKICAgICAgICAgICAgICAgIHRoaXMueXlsbG9jID0ge2ZpcnN0X2xpbmU6IHRoaXMueXlsbG9jLmxhc3RfbGluZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RfbGluZTogdGhpcy55eWxpbmVubysxLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyc3RfY29sdW1uOiB0aGlzLnl5bGxvYy5sYXN0X2NvbHVtbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RfY29sdW1uOiBsaW5lcyA/IGxpbmVzW2xpbmVzLmxlbmd0aC0xXS5sZW5ndGgtMSA6IHRoaXMueXlsbG9jLmxhc3RfY29sdW1uICsgbWF0Y2hbMF0ubGVuZ3RofQogICAgICAgICAgICAgICAgdGhpcy55eXRleHQgKz0gbWF0Y2hbMF07CiAgICAgICAgICAgICAgICB0aGlzLm1hdGNoICs9IG1hdGNoWzBdOwogICAgICAgICAgICAgICAgdGhpcy5tYXRjaGVzID0gbWF0Y2g7CiAgICAgICAgICAgICAgICB0aGlzLnl5bGVuZyA9IHRoaXMueXl0ZXh0Lmxlbmd0aDsKICAgICAgICAgICAgICAgIHRoaXMuX21vcmUgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHRoaXMuX2lucHV0ID0gdGhpcy5faW5wdXQuc2xpY2UobWF0Y2hbMF0ubGVuZ3RoKTsKICAgICAgICAgICAgICAgIHRoaXMubWF0Y2hlZCArPSBtYXRjaFswXTsKICAgICAgICAgICAgICAgIHRva2VuID0gdGhpcy5wZXJmb3JtQWN0aW9uLmNhbGwodGhpcywgdGhpcy55eSwgdGhpcywgcnVsZXNbaV0sdGhpcy5jb25kaXRpb25TdGFja1t0aGlzLmNvbmRpdGlvblN0YWNrLmxlbmd0aC0xXSk7CiAgICAgICAgICAgICAgICBpZiAodG9rZW4pIHJldHVybiB0b2tlbjsKICAgICAgICAgICAgICAgIGVsc2UgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLl9pbnB1dCA9PT0gIiIpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuRU9GOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMucGFyc2VFcnJvcignTGV4aWNhbCBlcnJvciBvbiBsaW5lICcrKHRoaXMueXlsaW5lbm8rMSkrJy4gVW5yZWNvZ25pemVkIHRleHQuXG4nK3RoaXMuc2hvd1Bvc2l0aW9uKCksIAogICAgICAgICAgICAgICAgICAgIHt0ZXh0OiAiIiwgdG9rZW46IG51bGwsIGxpbmU6IHRoaXMueXlsaW5lbm99KTsKICAgICAgICB9CiAgICB9LApsZXg6ZnVuY3Rpb24gbGV4KCkgewogICAgICAgIHZhciByID0gdGhpcy5uZXh0KCk7CiAgICAgICAgaWYgKHR5cGVvZiByICE9PSAndW5kZWZpbmVkJykgewogICAgICAgICAgICByZXR1cm4gcjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gdGhpcy5sZXgoKTsKICAgICAgICB9CiAgICB9LApiZWdpbjpmdW5jdGlvbiBiZWdpbihjb25kaXRpb24pIHsKICAgICAgICB0aGlzLmNvbmRpdGlvblN0YWNrLnB1c2goY29uZGl0aW9uKTsKICAgIH0sCnBvcFN0YXRlOmZ1bmN0aW9uIHBvcFN0YXRlKCkgewogICAgICAgIHJldHVybiB0aGlzLmNvbmRpdGlvblN0YWNrLnBvcCgpOwogICAgfSwKX2N1cnJlbnRSdWxlczpmdW5jdGlvbiBfY3VycmVudFJ1bGVzKCkgewogICAgICAgIHJldHVybiB0aGlzLmNvbmRpdGlvbnNbdGhpcy5jb25kaXRpb25TdGFja1t0aGlzLmNvbmRpdGlvblN0YWNrLmxlbmd0aC0xXV0ucnVsZXM7CiAgICB9LAp0b3BTdGF0ZTpmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY29uZGl0aW9uU3RhY2tbdGhpcy5jb25kaXRpb25TdGFjay5sZW5ndGgtMl07CiAgICB9LApwdXNoU3RhdGU6ZnVuY3Rpb24gYmVnaW4oY29uZGl0aW9uKSB7CiAgICAgICAgdGhpcy5iZWdpbihjb25kaXRpb24pOwogICAgfX0pOwpsZXhlci5wZXJmb3JtQWN0aW9uID0gZnVuY3Rpb24gYW5vbnltb3VzKHl5LHl5XywkYXZvaWRpbmdfbmFtZV9jb2xsaXNpb25zLFlZX1NUQVJUKSB7Cgp2YXIgWVlTVEFURT1ZWV9TVEFSVDsKc3dpdGNoKCRhdm9pZGluZ19uYW1lX2NvbGxpc2lvbnMpIHsKY2FzZSAwOi8qIHNraXAgd2hpdGVzcGFjZSAqLwpicmVhazsKY2FzZSAxOnJldHVybiAyMApicmVhazsKY2FzZSAyOnJldHVybiAxOQpicmVhazsKY2FzZSAzOnJldHVybiA4CmJyZWFrOwpjYXNlIDQ6cmV0dXJuIDkKYnJlYWs7CmNhc2UgNTpyZXR1cm4gNgpicmVhazsKY2FzZSA2OnJldHVybiA3CmJyZWFrOwpjYXNlIDc6cmV0dXJuIDExCmJyZWFrOwpjYXNlIDg6cmV0dXJuIDEzCmJyZWFrOwpjYXNlIDk6cmV0dXJuIDEwCmJyZWFrOwpjYXNlIDEwOnJldHVybiAxMgpicmVhazsKY2FzZSAxMTpyZXR1cm4gMTQKYnJlYWs7CmNhc2UgMTI6cmV0dXJuIDE1CmJyZWFrOwpjYXNlIDEzOnJldHVybiAxNgpicmVhazsKY2FzZSAxNDpyZXR1cm4gMTcKYnJlYWs7CmNhc2UgMTU6cmV0dXJuIDE4CmJyZWFrOwpjYXNlIDE2OnJldHVybiA1CmJyZWFrOwpjYXNlIDE3OnJldHVybiAnSU5WQUxJRCcKYnJlYWs7Cn0KfTsKbGV4ZXIucnVsZXMgPSBbL15ccysvLC9eWzAtOV0rKFwuWzAtOV0rKT9cYi8sL15uXGIvLC9eXHxcfC8sL14mJi8sL15cPy8sL146LywvXjw9LywvXj49LywvXjwvLC9ePi8sL14hPS8sL149PS8sL14lLywvXlwoLywvXlwpLywvXiQvLC9eLi9dOwpsZXhlci5jb25kaXRpb25zID0geyJJTklUSUFMIjp7InJ1bGVzIjpbMCwxLDIsMyw0LDUsNiw3LDgsOSwxMCwxMSwxMiwxMywxNCwxNSwxNiwxN10sImluY2x1c2l2ZSI6dHJ1ZX19O3JldHVybiBsZXhlcjt9KSgpCnBhcnNlci5sZXhlciA9IGxleGVyOwpyZXR1cm4gcGFyc2VyOwp9KSgpOwovLyBFbmQgcGFyc2VyCgogIC8vIEhhbmRsZSBub2RlLCBhbWQsIGFuZCBnbG9iYWwgc3lzdGVtcwogIGlmICh0eXBlb2YgZXhwb3J0cyAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgIGlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyAmJiBtb2R1bGUuZXhwb3J0cykgewogICAgICBleHBvcnRzID0gbW9kdWxlLmV4cG9ydHMgPSBKZWQ7CiAgICB9CiAgICBleHBvcnRzLkplZCA9IEplZDsKICB9CiAgZWxzZSB7CiAgICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7CiAgICAgIGRlZmluZSgnamVkJywgW10sZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIEplZDsKICAgICAgfSk7CiAgICB9CiAgICAvLyBMZWFrIGEgZ2xvYmFsIHJlZ2FyZGxlc3Mgb2YgbW9kdWxlIHN5c3RlbQogICAgcm9vdFsnSmVkJ10gPSBKZWQ7CiAgfQoKfSkodGhpcyk7CgooZnVuY3Rpb24gKHJvb3QsIGZhY3RvcnkpIHsKICAgIHZhciB0cmFuc2xhdGlvbnMgPSB7CiAgICAgICAgImRvbWFpbiI6ICJjb252ZXJzZSIsCiAgICAgICAgImxvY2FsZV9kYXRhIjogewogICAgICAgICAgICAiY29udmVyc2UiOiB7CiAgICAgICAgICAgICAgICAiIjogewogICAgICAgICAgICAgICAgICAgICJQcm9qZWN0LUlkLVZlcnNpb24iOiAiQ29udmVyc2UuanMgMC40IiwKICAgICAgICAgICAgICAgICAgICAiUmVwb3J0LU1zZ2lkLUJ1Z3MtVG8iOiAiIiwKICAgICAgICAgICAgICAgICAgICAiUE9ULUNyZWF0aW9uLURhdGUiOiAiMjAxMy0wOS0xNSAyMTo1NSswMjAwIiwKICAgICAgICAgICAgICAgICAgICAiUE8tUmV2aXNpb24tRGF0ZSI6ICIyMDEzLTA5LTE1IDIxOjU2KzAyMDAiLAogICAgICAgICAgICAgICAgICAgICJMYXN0LVRyYW5zbGF0b3IiOiAiSkMgQnJhbmQgPGpjQG9wa29kZS5jb20+IiwKICAgICAgICAgICAgICAgICAgICAiTGFuZ3VhZ2UtVGVhbSI6ICJBZnJpa2FhbnMiLAogICAgICAgICAgICAgICAgICAgICJMYW5ndWFnZSI6ICJhZiIsCiAgICAgICAgICAgICAgICAgICAgIk1JTUUtVmVyc2lvbiI6ICIxLjAiLAogICAgICAgICAgICAgICAgICAgICJDb250ZW50LVR5cGUiOiAidGV4dC9wbGFpbjsgY2hhcnNldD1VVEYtOCIsCiAgICAgICAgICAgICAgICAgICAgIkNvbnRlbnQtVHJhbnNmZXItRW5jb2RpbmciOiAiOGJpdCIsCiAgICAgICAgICAgICAgICAgICAgImRvbWFpbiI6ICJjb252ZXJzZSIsCiAgICAgICAgICAgICAgICAgICAgImxhbmciOiAiYWYiLAogICAgICAgICAgICAgICAgICAgICJwbHVyYWxfZm9ybXMiOiAibnBsdXJhbHM9MjsgcGx1cmFsPShuICE9IDEpOyIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAidW5lbmNyeXB0ZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAibmllLXByaXZhYXQiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgInVudmVyaWZpZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAib25nZXZlcmlmaWVlciIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAidmVyaWZpZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAicHJpdmFhdCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiZmluaXNoZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiYWZnZXNsdWl0IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJEaXNjb25uZWN0ZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVmVyYmluZHVuZyBvbmRlcmJyZWVrIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJFcnJvciI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJGb3V0IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb25uZWN0aW5nIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlZlcmJpbmQgdGFucyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ29ubmVjdGlvbiBGYWlsZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVmVyYmluZGluZyBoZXQgZ2VmYWFsIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJBdXRoZW50aWNhdGluZyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJCZXNpZyBvbSB0ZSBiZWtyYWd0aWciCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkF1dGhlbnRpY2F0aW9uIEZhaWxlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJCZWtyYWd0aWdpbmcgaGV0IGdlZmFhbCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiRGlzY29ubmVjdGluZyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJPbmRlcmJyZWVrIHZlcmJpbmRpbmciCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJlLWVzdGFibGlzaGluZyBlbmNyeXB0ZWQgc2Vzc2lvbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJIZXJzdGVsIHZlcnNsZXV0ZWxkZSBzZXNzaWUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgYnJvd3NlciBuZWVkcyB0byBnZW5lcmF0ZSBhIHByaXZhdGUga2V5LCB3aGljaCB3aWxsIGJlIHVzZWQgaW4geW91ciBlbmNyeXB0ZWQgY2hhdCBzZXNzaW9uLiBUaGlzIGNhbiB0YWtlIHVwIHRvIDMwIHNlY29uZHMgZHVyaW5nIHdoaWNoIHlvdXIgYnJvd3NlciBtaWdodCBmcmVlemUgYW5kIGJlY29tZSB1bnJlc3BvbnNpdmUuIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkRpZSB3ZWJibGFhaWVyIG1vZXQgJ24gcHJpdmF0ZSBzbGV1dGVsIHZpciBkaWUgdmVyc2xldXRlbGRlIGtsZXRzLXNlc3NpZSBnZW5lcmVlci4gRGl0IGthbiB0b3QgMzAgc2Vrb25kZXMgZHV1ciwgd2FhcnR5ZGVu0ZUgZGllIHdlYmJsYWFpZXIgbWFnIHZyaWVzIGVuIG5pZSByZWFnZWVyIG5pZS4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlByaXZhdGUga2V5IGdlbmVyYXRlZC4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiUHJpdmF0ZSBzbGV1dGVsIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJBdXRoZW50aWNhdGlvbiByZXF1ZXN0IGZyb20gJTEkc1xuXG5Zb3VyIGJ1ZGR5IGlzIGF0dGVtcHRpbmcgdG8gdmVyaWZ5IHlvdXIgaWRlbnRpdHksIGJ5IGFza2luZyB5b3UgdGhlIHF1ZXN0aW9uIGJlbG93LlxuXG4lMiRzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlZlcmlmaWthc2llIHZlcnNvZWsgdmFuICAlMSRzXG5cblUgZ2VzcHJla3NtYWF0IHByb2JlZXIgb20gdSBpZGVudGl0ZWl0IHRlIHZlcmlmaWVlciwgZGV1ciBkaWUgdm9sZ2VuZGUgdnJhYWcgdGUgdnJhIFxuXG4lMiRzIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb3VsZCBub3QgdmVyaWZ5IHRoaXMgdXNlcidzIGlkZW50aWZ5LiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJLb24gbmllIGhpZXJkaWUgZ2VicnVpa2VyIHNlIGlkZW50aXRpZWQgdmVyaWZpZWVyIG5pZS4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlBlcnNvbmFsIG1lc3NhZ2UiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiUGVyc29vbmxpa2UgYm9vZHNrYXAiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlN0YXJ0IGVuY3J5cHRlZCBjb252ZXJzYXRpb24iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQmVnaW4gdmVyc2xldXRlbGRlIGdlc3ByZWsiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJlZnJlc2ggZW5jcnlwdGVkIGNvbnZlcnNhdGlvbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJWZXJmcmlzIHZlcnNsZXV0ZWxkZSBnZXNwcmVrIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJFbmQgZW5jcnlwdGVkIGNvbnZlcnNhdGlvbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJCZcOraW5kaWcgdmVyc2xldXRlbGRlIGdlc3ByZWsiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlZlcmlmeSB3aXRoIFNNUCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJWZXJpZmllZXIgbWV0IFNNUCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVmVyaWZ5IHdpdGggZmluZ2VycHJpbnRzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlZlcmlmaWVlciBtZXQgdmluZ2VyYWZkcnVra2UiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIldoYXQncyB0aGlzPyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJXYXQgaXMgaGllcmRpZT8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIm1lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgImVrIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTaG93IHRoaXMgbWVudSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJWZXJ0b29uIGhpZXJkaWUga2V1c2VseXMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIldyaXRlIGluIHRoZSB0aGlyZCBwZXJzb24iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU2tyeWYgaW4gZGllIGRlcmRlIHBlcnNvb24iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJlbW92ZSBtZXNzYWdlcyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJWZXJ3eWRlciBib29kc2thcHBlIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG1lc3NhZ2UgY291bGQgbm90IGJlIHNlbnQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVSBib29kc2thcCBrb24gbmllIGdlc3R1dXIgd29yZCBuaWUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIldlIHJlY2VpdmVkIGFuIHVuZW5jcnlwdGVkIG1lc3NhZ2UiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiT25zIGhldCAnbiBvbnZlcnNsZXV0ZWxkZSBib29kc2thcCBvbnR2YW5nIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJXZSByZWNlaXZlZCBhbiB1bnJlYWRhYmxlIGVuY3J5cHRlZCBtZXNzYWdlIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk9ucyBoZXQgJ24gb25sZWVzYmFyZSB2ZXJzbGV1dGVsZGUgYm9vZHNrYXAgb250dmFuZyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyB1c2VyIGhhcyByZXF1ZXN0ZWQgYW4gZW5jcnlwdGVkIHNlc3Npb24uIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkhpZXJkaWUgZ2VicnVpa2VyIHZlcnNvZWsgJ24gdmVyc2xldXRlbGRlIHNlc3NpZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiSGVyZSBhcmUgdGhlIGZpbmdlcnByaW50cywgcGxlYXNlIGNvbmZpcm0gdGhlbSB3aXRoICUxJHMsIG91dHNpZGUgb2YgdGhpcyBjaGF0LlxuXG5GaW5nZXJwcmludCBmb3IgeW91LCAlMiRzOiAlMyRzXG5cbkZpbmdlcnByaW50IGZvciAlMSRzOiAlNCRzXG5cbklmIHlvdSBoYXZlIGNvbmZpcm1lZCB0aGF0IHRoZSBmaW5nZXJwcmludHMgbWF0Y2gsIGNsaWNrIE9LLCBvdGhlcndpc2UgY2xpY2sgQ2FuY2VsLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJIaWVyIGlzIGRpZSB2aW5nZXJhZmRydWtrZSwgYmV2ZXN0aWcgaHVsbGUgbWV0ICUxJHMsIGJ1aXRlIGhpZXJkaWUga2xldHNrYW5hYWwgXG5cblUgdmluZ2VyYWZkcnVrLCAlMiRzOiAlMyRzXG5cblZpbmdlcmFmZHJ1ayB2aXIgJTEkczogJTQkc1xuXG5JbmRpZW4gdSBkaWUgdmluZ2VyYWZkcnVra2UgYmV2ZXN0aWcgaGV0LCBrbGlrIE9LLCBhbmRlcnNpbmRzIGtsaWsgS2Fuc2VsbGVlciIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91IHdpbGwgYmUgcHJvbXB0ZWQgdG8gcHJvdmlkZSBhIHNlY3VyaXR5IHF1ZXN0aW9uIGFuZCB0aGVuIGFuIGFuc3dlciB0byB0aGF0IHF1ZXN0aW9uLlxuXG5Zb3VyIGJ1ZGR5IHdpbGwgdGhlbiBiZSBwcm9tcHRlZCB0aGUgc2FtZSBxdWVzdGlvbiBhbmQgaWYgdGhleSB0eXBlIHRoZSBleGFjdCBzYW1lIGFuc3dlciAoY2FzZSBzZW5zaXRpdmUpLCB0aGVpciBpZGVudGl0eSB3aWxsIGhhdmUgYmVlbiB2ZXJpZmllZC4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRGFhciBzYWwgdmFuIHUgdmVyd2FnIHdvcmQgb20gJ24gc2VrdXJpdGVpdHN2cmFhZyB0ZSBzdGVsLCBlbiBkYW4gb29rIGRpZSBhbnR3b29yZCB0b3QgZGFhcmRpZSB2cmFhZyB0ZSB2ZXJza2FmLlxuXG5VIGdlc3ByZWtzbWFhdCBzYWwgZGFuIGRhYXJkaWUgdnJhYWcgZ2VzdGVsIHdvcmQsIGVuIGluZGllbiBodWxsZSBwcmVzaWVzIGRpZXNlbGZkZSBhbnR3b29yZCAoaG9vZmxldHRlcnMgdGVsKSB2ZXJza2FmLCBzYWwgaHVsIGlkZW50aXRlaXQgZ2V2ZXJpZmllZXIgd2Vlcy4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIldoYXQgaXMgeW91ciBzZWN1cml0eSBxdWVzdGlvbj8iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiV2F0IGlzIHUgc2VrdXJpdGVpdHN2cmFhZz8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIldoYXQgaXMgdGhlIGFuc3dlciB0byB0aGUgc2VjdXJpdHkgcXVlc3Rpb24/IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIldhdCBpcyBkaWUgYW50d29vcmQgdG90IGRpZSBzZWt1cml0ZWl0c3ZyYWFnPyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiSW52YWxpZCBhdXRoZW50aWNhdGlvbiBzY2hlbWUgcHJvdmlkZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiT25nZWxkaWdlIHZlcmlmaWthc2llbWV0b2RlIHZlcnNrYWYiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgbWVzc2FnZXMgYXJlIG5vdCBlbmNyeXB0ZWQgYW55bW9yZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJVIGJvb2Rza2FwcGUgaXMgbmllIG1lZXIgdmVyc2xldXRlbCBuaWUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgbWVzc2FnZXMgYXJlIG5vdyBlbmNyeXB0ZWQgYnV0IHlvdXIgYnVkZHkncyBpZGVudGl0eSBoYXMgbm90IGJlZW4gdmVyaWZpZWQuIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlUgYm9vZHNrYXBwZSBpcyBub3cgdmVyc2xldXRlbCBtYWFyIHUgZ2VzcHJla3NtYWF0IHNlIGlkZW50aXRlaXQgaXMgbm9nIG9uc2VrZXIuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIGJ1ZGR5J3MgaWRlbnRpZnkgaGFzIGJlZW4gdmVyaWZpZWQuIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlUgZ2VzcHJla3NtYWF0IHNlIGlkZW50aXRlaXQgaXMgZ2V2ZXJpZmllZXIuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIGJ1ZGR5IGhhcyBlbmRlZCBlbmNyeXB0aW9uIG9uIHRoZWlyIGVuZCwgeW91IHNob3VsZCBkbyB0aGUgc2FtZS4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVSBnZXNwcmVrc21hYXQgaGV0IHZlcnNsZXV0ZWxpbmcgZ2VzdGFhaywgdSBiZWhvb3J0IG5vdSBkaWVzZWxmZGUgdGUgZG9lbi4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgbWVzc2FnZXMgYXJlIG5vdCBlbmNyeXB0ZWQuIENsaWNrIGhlcmUgdG8gZW5hYmxlIE9UUiBlbmNyeXB0aW9uLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJVIGJvb2Rza2FwcGUgaXMgbmllIHZlcnNsZXV0ZWwgbmllLiBLbGlrIGhpZXIgb20gT1RSIHZlcnNsZXV0ZWxpbmcgdGUgYWt0aXZlZXIuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG1lc3NhZ2VzIGFyZSBlbmNyeXB0ZWQsIGJ1dCB5b3VyIGJ1ZGR5IGhhcyBub3QgYmVlbiB2ZXJpZmllZC4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVSBib29kc2thcHBlIGlzIHZlcnNsZXV0ZWwsIG1hYXIgdSBnZXNwcmVrc21hYXQgc2UgaWRlbnRpdGVpdCBpcyBub3Qgb25zZWtlci4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgbWVzc2FnZXMgYXJlIGVuY3J5cHRlZCBhbmQgeW91ciBidWRkeSB2ZXJpZmllZC4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVSBib29kc2thcHBlIGlzIHZlcnNsZXV0ZWwgZW4gdSBnZXNwcmVrc21hYXQgc2UgaWRlbnRpdGVpdCBnZXZlcmlmaWVlci4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgYnVkZHkgaGFzIGNsb3NlZCB0aGVpciBlbmQgb2YgdGhlIHByaXZhdGUgc2Vzc2lvbiwgeW91IHNob3VsZCBkbyB0aGUgc2FtZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJVIGdlc3ByZWtzbWFhdCBoZXQgZGllIHByaXZhdGUgc2Vzc2llIGdlc3RhYWsuIFUgYmVob29ydCBkaWVzZWxmZGUgdGUgZG9lbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ29udGFjdHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiS29udGFrdGUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk9ubGluZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJBYW5nZW1lbGQiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkJ1c3kiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQmVzaWciCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkF3YXkiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQWZ3ZXNpZyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiT2ZmbGluZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJBZmdlbWVsZCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgdG8gYWRkIG5ldyBjaGF0IGNvbnRhY3RzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIktsaWVrIG9tIG51d2Uga2xldHNrb250YWt0ZSBieSB0ZSB2b2VnIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJBZGQgYSBjb250YWN0IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlZvZWcgJ24ga29udGFrIGJ5IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb250YWN0IHVzZXJuYW1lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIktvbmFrIGdlYnJ1aWtlcnNuYWFtIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJBZGQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVm9lZyBieSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ29udGFjdCBuYW1lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIktvbnRha25hYW0iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNlYXJjaCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTb2VrIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJObyB1c2VycyBmb3VuZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJHZWVuIGdlYnJ1aWtlcnMgZ2V2aW5kIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDbGljayB0byBhZGQgYXMgYSBjaGF0IGNvbnRhY3QiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiS2xpZWsgb20gYXMga2xldHNrb250YWsgYnkgdGUgdm9lZyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgdG8gb3BlbiB0aGlzIHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiS2xpZWsgb20gaGllcmRpZSBrbGV0c2thbWVyIHRlIG9wZW4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNob3cgbW9yZSBpbmZvcm1hdGlvbiBvbiB0aGlzIHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiV3lzIG1lZXIgaW5saWd0aW5nIGFhbmdhYW5kZSBoaWVyZGllIGtsZXRza2FtZXIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkRlc2NyaXB0aW9uOiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJCZXNrcnl3aW5nOiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiT2NjdXBhbnRzOiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJEZWVsbmVtZXJzOiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiRmVhdHVyZXM6IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkVpZW5za2FwcGU6IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSZXF1aXJlcyBhdXRoZW50aWNhdGlvbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJCZW5vZGlnIG1hZ3RpZ2luZyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiSGlkZGVuIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlZlcnNrdWlsIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSZXF1aXJlcyBhbiBpbnZpdGF0aW9uIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkJlbm9kaWcgJ24gdWl0bm9kaWdpbmciCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk1vZGVyYXRlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJHZW1vZGVyZWVyIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJOb24tYW5vbnltb3VzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk5pZS1hbm9uaWVtIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJPcGVuIHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiT29wIGtsZXRza2FtZXIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlBlcm1hbmVudCByb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlBlcm1hbmVudGUga2FtZXIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlB1YmxpYyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJQdWJsaWVrIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTZW1pLWFub255bW91cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJEZWVscyBhbm9uaWVtIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUZW1wb3Jhcnkgcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJUeWRlbGlrZSBrYW1lciIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVW5tb2RlcmF0ZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiT25nZW1vZGVyZWVyIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSb29tcyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJLYW1lcnMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJvb20gbmFtZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJLYW1lciBuYWFtIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJOaWNrbmFtZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJCeW5hYW0iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNlcnZlciI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJCZWRpZW5lciIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiSm9pbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTbHVpdCBhYW4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNob3cgcm9vbXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiV3lzIGthbWVycyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTm8gcm9vbXMgb24gJTEkcyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJHZWVuIGthbWVycyBvcCAlMSRzIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSb29tcyBvbiAlMSRzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkthbWVycyBvcCAlMSRzIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTZXQgY2hhdHJvb20gdG9waWMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU3RlbCBrbGV0c2thbWVyIG9uZGVyd2VycCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiS2ljayB1c2VyIGZyb20gY2hhdHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU2tvcCBnZWJydWlrZXIgdWl0IGRpZSBrbGV0c2thbWVyIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJCYW4gdXNlciBmcm9tIGNoYXRyb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlZlcmJhbiBnZWJydWlrZXIgdmFudWl0IGRpZSBrbGV0c2thbWVyIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJNZXNzYWdlIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkJvb2Rza2FwIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTYXZlIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlN0b29yIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDYW5jZWwiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiS2Fuc2VsZWVyIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJBbiBlcnJvciBvY2N1cnJlZCB3aGlsZSB0cnlpbmcgdG8gc2F2ZSB0aGUgZm9ybS4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQSBmb3V0IGhldCB2b29yZ2Vrb20gdGVyd3lsIHByb2JlZXIgaXMgb20gZGllIHZvcm0gdGUgc3Rvb3IuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIGNoYXRyb29tIHJlcXVpcmVzIGEgcGFzc3dvcmQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSGllZGllIGtsZXRza2FtZXIgYmVub2RpZyAnbiB3YWd3b29yZCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUGFzc3dvcmQ6ICI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJXYWd3b29yZDoiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlN1Ym1pdCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJEaWVuIGluIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gaXMgbm90IGFub255bW91cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJIaWVyZGllIHZlcnRyZWsgaXMgbmllIGFub25pZW0gbmllIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gbm93IHNob3dzIHVuYXZhaWxhYmxlIG1lbWJlcnMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSGllcmRpZSB2ZXJ0cmVrIHd5cyBub3Ugb25iZXNraWtiYXJlIGxlZGUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBkb2VzIG5vdCBzaG93IHVuYXZhaWxhYmxlIG1lbWJlcnMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSGllcmRpZSB2ZXJ0cmVrIHd5cyBuaWUgb25iZXNraWtiYXJlIGxlZGUgbmllIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJOb24tcHJpdmFjeS1yZWxhdGVkIHJvb20gY29uZmlndXJhdGlvbiBoYXMgY2hhbmdlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJOaWUtcHJpdmFhdGhlaWR2ZXJ3YW50ZSBrYW1lciBpbnN0ZWxsaW5ncyBoZXQgdmVyYW5kZXIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJvb20gbG9nZ2luZyBpcyBub3cgZW5hYmxlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJLYW1lciBsb2cgaXMgbm91IGFhbmdlc2tha2VsIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSb29tIGxvZ2dpbmcgaXMgbm93IGRpc2FibGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkthbWVyIGxvZyBpcyBub3UgYWZnZXNrYWtlbCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyByb29tIGlzIG5vdyBub24tYW5vbnltb3VzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkhpZWRpZSBrYW1lciBpcyBub3UgbmllIGFub25pZW0gbmllIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gaXMgbm93IHNlbWktYW5vbnltb3VzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkhpZXJkaWUga2FtZXIgaXMgbm91IGdlZGVlbHRlbGlrIGFub25pZW0iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBpcyBub3cgZnVsbHktYW5vbnltb3VzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkhpZXJkaWUga2FtZXIgaXMgbm91IHRlbiB2b2xsZSBhbm9uaWVtIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJBIG5ldyByb29tIGhhcyBiZWVuIGNyZWF0ZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiJ24gTnV3ZSBrYW1lciBpcyBnZXNrZXAiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgbmlja25hbWUgaGFzIGJlZW4gY2hhbmdlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJKb3UgYnluYWFtIGlzIHZlcmFuZGVyIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gaGFzIGJlZW4gYmFubmVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIjxzdHJvbmc+JTEkczwvc3Ryb25nPiBpcyB2ZXJiYW4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIjxzdHJvbmc+JTEkczwvc3Ryb25nPiBoYXMgYmVlbiBraWNrZWQgb3V0IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIjxzdHJvbmc+JTEkczwvc3Ryb25nPiBpcyB1aXRnZXNrb3AiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIjxzdHJvbmc+JTEkczwvc3Ryb25nPiBoYXMgYmVlbiByZW1vdmVkIGJlY2F1c2Ugb2YgYW4gYWZmaWxpYXRpb24gY2hhbmdlIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIjxzdHJvbmc+JTEkczwvc3Ryb25nPiBpcyB2ZXJ3eWRlciBhLmcudiAnbiB2ZXJhbmRlcmluZyB2YW4gYWZmaWxpYXNpZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IGhhcyBiZWVuIHJlbW92ZWQgZm9yIG5vdCBiZWluZyBhIG1lbWJlciI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gaXMgbmllICduIGxpZCBuaWUsIGVuIGR1cyB2ZXJ3eWRlciIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91IGhhdmUgYmVlbiBiYW5uZWQgZnJvbSB0aGlzIHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSnkgaXMgdWl0IGRpZSBrYW1lciB2ZXJiYW4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdSBoYXZlIGJlZW4ga2lja2VkIGZyb20gdGhpcyByb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkp5IGlzIHVpdCBkaWUga2FtZXIgZ2Vza29wIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3UgaGF2ZSBiZWVuIHJlbW92ZWQgZnJvbSB0aGlzIHJvb20gYmVjYXVzZSBvZiBhbiBhZmZpbGlhdGlvbiBjaGFuZ2UiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSnkgaXMgdmFudWl0IGRpZSBrYW1lciB2ZXJ3eWRlciBhLmcudiAnbiB2ZXJhbmRlcmluZyB2YW4gYWZmaWxpYXNpZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91IGhhdmUgYmVlbiByZW1vdmVkIGZyb20gdGhpcyByb29tIGJlY2F1c2UgdGhlIHJvb20gaGFzIGNoYW5nZWQgdG8gbWVtYmVycy1vbmx5IGFuZCB5b3UncmUgbm90IGEgbWVtYmVyIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkp5IGlzIHZhbnVpdCBkaWUga2FtZXIgdmVyd3lkZXIgb21kYXQgZGllIGthbWVyIG5vdSBzbGVncyB0b3QgbGVkZSBiZXBlcmsgd29yZCBlbiBqeSBuaWUgJ24gbGlkIGlzIG5pZS4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdSBoYXZlIGJlZW4gcmVtb3ZlZCBmcm9tIHRoaXMgcm9vbSBiZWNhdXNlIHRoZSBNVUMgKE11bHRpLXVzZXIgY2hhdCkgc2VydmljZSBpcyBiZWluZyBzaHV0IGRvd24uIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkp5IGlzIHZhbiBoaWVyZGllIGthbWVyIHZlcnd5ZGVyIGFhbmdlc2llbiBkaWUgTVVDIChNdWx0aS11c2VyIGNoYXQpIGRpZW5zIG5vdSBhZmdlc2tha2VsIHdvcmQuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3UgYXJlIG5vdCBvbiB0aGUgbWVtYmVyIGxpc3Qgb2YgdGhpcyByb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkp5IGlzIG5pZSBvcCBkaWUgbGVkZWx5cyB2YW4gaGllcmRpZSBrYW1lciBuaWUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk5vIG5pY2tuYW1lIHdhcyBzcGVjaWZpZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiR2VlbiBieW5hYW0gdmVyc2thZiBuaWUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdSBhcmUgbm90IGFsbG93ZWQgdG8gY3JlYXRlIG5ldyByb29tcyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJKeSB3b3JkIG5pZSB0b2VnZWxhYXQgb20gbm9nIGthbWVycyB0ZSBza2VwIG5pZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBuaWNrbmFtZSBkb2Vzbid0IGNvbmZvcm0gdG8gdGhpcyByb29tJ3MgcG9saWNpZXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSm91IGJ5bmFhbSB2b2xkb2VuIG5pZSBhYW4gZGllIGthbWVyIHNlIGJlbGVpZCBuaWUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgbmlja25hbWUgaXMgYWxyZWFkeSB0YWtlbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJKb3UgYnluYWFtIGlzIHJlZWRzIGdlbmVlbSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyByb29tIGRvZXMgbm90ICh5ZXQpIGV4aXN0IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkhpZXJkaWUga2FtZXIgYmVzdGFhbiB0YW5zIChub2cpIG5pZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyByb29tIGhhcyByZWFjaGVkIGl0J3MgbWF4aW11bSBudW1iZXIgb2Ygb2NjdXBhbnRzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkhpZXJkaWUga2FtZXIgaGV0IHN5IG1ha3NpbXVtIGFhbnRhbCBkZWVsbmVtZXJzIGJlcmVpayIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVG9waWMgc2V0IGJ5ICUxJHMgdG86ICUyJHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiT25kZXJ3ZXJwIGRldXIgJTEkcyBieWdld2VyayBuYTogJTIkcyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyB1c2VyIGlzIGEgbW9kZXJhdG9yIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkhpZXJkaWUgZ2VicnVpa2VyIGlzICduIG1vZGVyYXRvciIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyB1c2VyIGNhbiBzZW5kIG1lc3NhZ2VzIGluIHRoaXMgcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJIaWVyZGllIGdlYnJ1aWtlciBrYW4gYm9vZHNrYXBwZSBuYSBkaWUga2FtZXIgc3R1dXIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgdXNlciBjYW4gTk9UIHNlbmQgbWVzc2FnZXMgaW4gdGhpcyByb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkhpZXJkaWUgZ2VicnVpa2VyIGthbiBOSUUgYm9vZHNrYXBwZSBuYSBkaWUga2FtZXIgc3R1dXIgbmllIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDbGljayB0byBjaGF0IHdpdGggdGhpcyBjb250YWN0IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIktsaWVrIG9tIG1ldCBoaWVyZGllIGtvbnRhayB0ZSBrbGV0cyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgdG8gcmVtb3ZlIHRoaXMgY29udGFjdCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJLbGllayBvbSBoaWVyZGllIGtvbnRhayB0ZSB2ZXJ3eWRlciIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyBjb250YWN0IGlzIGJ1c3kiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSGllcmRpZSBwZXJzb29uIGlzIGJlc2lnIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIGNvbnRhY3QgaXMgb25saW5lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkhpZXJkaWUgcGVyc29vbiBpcyBhYW5seW4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgY29udGFjdCBpcyBvZmZsaW5lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkhpZXJkaWUgcGVyc29vbiBpcyBhZmx5biIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyBjb250YWN0IGlzIHVuYXZhaWxhYmxlIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkhpZXJkaWUgcGVyc29vbiBpcyBvbmJlc2tpa2JhYXIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgY29udGFjdCBpcyBhd2F5IGZvciBhbiBleHRlbmRlZCBwZXJpb2QiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSGllcmRpZSBwZXJzb29uIGlzIHZpciBsYW5rIGFmd2VzaWciCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgY29udGFjdCBpcyBhd2F5IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkhpZXJkaWUgcGVyc29vbiBpcyBhZndlc2lnIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb250YWN0IHJlcXVlc3RzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIktvbnRhayB2ZXJzb2VrZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTXkgY29udGFjdHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTXkga29udGFrdGUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlBlbmRpbmcgY29udGFjdHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSGFuZ2VuZGUga29udGFrdGUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkN1c3RvbSBzdGF0dXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRG9lbGdlbWFha3RlIHN0YXR1cyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgdG8gY2hhbmdlIHlvdXIgY2hhdCBzdGF0dXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiS2xpZWsgb20gam91IGtsZXRzLXN0YXR1cyB0ZSB2ZXJhbmRlciIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgaGVyZSB0byB3cml0ZSBhIGN1c3RvbSBzdGF0dXMgbWVzc2FnZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJLbGllayBoaWVyIG9tIGpvdSBlaWUgc3RhdHVzYm9vZHNrYXAgdGUgc2tyeWYiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIm9ubGluZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJhYW5nZW1lbGQiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgImJ1c3kiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiYmVzaWciCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgImF3YXkgZm9yIGxvbmciOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAidmlyIGxhbmsgYWZ3ZXNpZyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiYXdheSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJhZndlc2lnIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJJIGFtICUxJHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRWsgaXMgJTEkcyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU2lnbiBpbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJUZWtlbiBpbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWE1QUC9KYWJiZXIgVXNlcm5hbWU6IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlhNUFAvSmFiYmVyIEdlYnJ1aWtlcnNuYWFtOiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUGFzc3dvcmQ6IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIldhZ3dvb3JkIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJMb2cgSW4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTWVsZCBhYW4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkJPU0ggU2VydmljZSBVUkw6IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkJPU0ggYmVkaWVuZXIgVVJMIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJPbmxpbmUgQ29udGFjdHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiS29udGFrdGUgYWFuZ2VtZWxkIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb25uZWN0ZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVmVyYmluZCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQXR0YWNoZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiR2VoZWciCiAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkgewogICAgICAgIGRlZmluZSgiYWYiLCBbJ2plZCddLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBmYWN0b3J5KG5ldyBKZWQodHJhbnNsYXRpb25zKSk7CiAgICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICAgIGlmICghd2luZG93LmxvY2FsZXMpIHsKICAgICAgICAgICAgd2luZG93LmxvY2FsZXMgPSB7fTsKICAgICAgICB9CiAgICAgICAgd2luZG93LmxvY2FsZXMuYWYgPSBmYWN0b3J5KG5ldyBKZWQodHJhbnNsYXRpb25zKSk7CiAgICB9Cn0odGhpcywgZnVuY3Rpb24gKGFmKSB7IAogICAgcmV0dXJuIGFmOyAKfSkpOwoKKGZ1bmN0aW9uIChyb290LCBmYWN0b3J5KSB7CiAgICB2YXIgdHJhbnNsYXRpb25zID0gewogICAgICAgICJkb21haW4iOiAiY29udmVyc2UiLAogICAgICAgICJsb2NhbGVfZGF0YSI6IHsKICAgICAgICAgICAgImNvbnZlcnNlIjogewogICAgICAgICAgICAgICAgIiI6IHsKICAgICAgICAgICAgICAgICAgICAiUHJvamVjdC1JZC1WZXJzaW9uIjogIkNvbnZlcnNlLmpzIDAuNCIsCiAgICAgICAgICAgICAgICAgICAgIlJlcG9ydC1Nc2dpZC1CdWdzLVRvIjogIiIsCiAgICAgICAgICAgICAgICAgICAgIlBPVC1DcmVhdGlvbi1EYXRlIjogIjIwMTMtMDktMTUgMjE6NTUrMDIwMCIsCiAgICAgICAgICAgICAgICAgICAgIlBPLVJldmlzaW9uLURhdGUiOiAiMjAxMy0wOS0xNSAyMjowMyswMjAwIiwKICAgICAgICAgICAgICAgICAgICAiTGFzdC1UcmFuc2xhdG9yIjogIkpDIEJyYW5kIDxqY0BvcGtvZGUuY29tPiIsCiAgICAgICAgICAgICAgICAgICAgIkxhbmd1YWdlLVRlYW0iOiAiR2VybWFuIiwKICAgICAgICAgICAgICAgICAgICAiTGFuZ3VhZ2UiOiAiZGUiLAogICAgICAgICAgICAgICAgICAgICJNSU1FLVZlcnNpb24iOiAiMS4wIiwKICAgICAgICAgICAgICAgICAgICAiQ29udGVudC1UeXBlIjogInRleHQvcGxhaW47IGNoYXJzZXQ9VVRGLTgiLAogICAgICAgICAgICAgICAgICAgICJDb250ZW50LVRyYW5zZmVyLUVuY29kaW5nIjogIjhiaXQiLAogICAgICAgICAgICAgICAgICAgICJQbHVyYWwtRm9ybXMiOiAibnBsdXJhbHM9MjsgcGx1cmFsPShuICE9IDEpOyIsCiAgICAgICAgICAgICAgICAgICAgImRvbWFpbiI6ICJjb252ZXJzZSIsCiAgICAgICAgICAgICAgICAgICAgImxhbmciOiAiZGUiLAogICAgICAgICAgICAgICAgICAgICJwbHVyYWxfZm9ybXMiOiAibnBsdXJhbHM9MjsgcGx1cmFsPShuICE9IDEpOyIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAidW5lbmNyeXB0ZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJ1bnZlcmlmaWVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAidmVyaWZpZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJmaW5pc2hlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkRpc2Nvbm5lY3RlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJWZXJiaW5kdW5nIHVudGVyYnJvY2hlbi4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkVycm9yIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkZlaGxlciIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ29ubmVjdGluZyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJWZXJiaW5kdW5nc2F1ZmJhdSDigKYiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNvbm5lY3Rpb24gRmFpbGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkVudGZlcm50ZSBWZXJiaW5kdW5nIGZlaGxnZXNjaGxhZ2VuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJBdXRoZW50aWNhdGluZyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJBdXRoZW50aWZpemllcnVuZyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQXV0aGVudGljYXRpb24gRmFpbGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkF1dGhlbnRpZml6aWVydW5nIGdlc2NoZWl0ZXJ0IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJEaXNjb25uZWN0aW5nIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlRyZW5uZSBWZXJiaW5kdW5nIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSZS1lc3RhYmxpc2hpbmcgZW5jcnlwdGVkIHNlc3Npb24iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIGJyb3dzZXIgbmVlZHMgdG8gZ2VuZXJhdGUgYSBwcml2YXRlIGtleSwgd2hpY2ggd2lsbCBiZSB1c2VkIGluIHlvdXIgZW5jcnlwdGVkIGNoYXQgc2Vzc2lvbi4gVGhpcyBjYW4gdGFrZSB1cCB0byAzMCBzZWNvbmRzIGR1cmluZyB3aGljaCB5b3VyIGJyb3dzZXIgbWlnaHQgZnJlZXplIGFuZCBiZWNvbWUgdW5yZXNwb25zaXZlLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlByaXZhdGUga2V5IGdlbmVyYXRlZC4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJBdXRoZW50aWNhdGlvbiByZXF1ZXN0IGZyb20gJTEkc1xuXG5Zb3VyIGJ1ZGR5IGlzIGF0dGVtcHRpbmcgdG8gdmVyaWZ5IHlvdXIgaWRlbnRpdHksIGJ5IGFza2luZyB5b3UgdGhlIHF1ZXN0aW9uIGJlbG93LlxuXG4lMiRzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ291bGQgbm90IHZlcmlmeSB0aGlzIHVzZXIncyBpZGVudGlmeS4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJQZXJzb25hbCBtZXNzYWdlIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlBlcnPDtm5saWNoZSBOYWNocmljaHQiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlN0YXJ0IGVuY3J5cHRlZCBjb252ZXJzYXRpb24iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSZWZyZXNoIGVuY3J5cHRlZCBjb252ZXJzYXRpb24iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJFbmQgZW5jcnlwdGVkIGNvbnZlcnNhdGlvbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlZlcmlmeSB3aXRoIFNNUCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlZlcmlmeSB3aXRoIGZpbmdlcnByaW50cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIldoYXQncyB0aGlzPyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIm1lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkljaCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU2hvdyB0aGlzIG1lbnUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRGllc2VzIE1lbsO8IGFuemVpZ2VuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJXcml0ZSBpbiB0aGUgdGhpcmQgcGVyc29uIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkluIGRlciBkcml0dGVuIFBlcnNvbiBzY2hyZWliZW4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJlbW92ZSBtZXNzYWdlcyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJOYWNocmljaHRlbiBlbnRmZXJuZW4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgbWVzc2FnZSBjb3VsZCBub3QgYmUgc2VudCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIldlIHJlY2VpdmVkIGFuIHVuZW5jcnlwdGVkIG1lc3NhZ2UiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJXZSByZWNlaXZlZCBhbiB1bnJlYWRhYmxlIGVuY3J5cHRlZCBtZXNzYWdlIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyB1c2VyIGhhcyByZXF1ZXN0ZWQgYW4gZW5jcnlwdGVkIHNlc3Npb24uIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiSGVyZSBhcmUgdGhlIGZpbmdlcnByaW50cywgcGxlYXNlIGNvbmZpcm0gdGhlbSB3aXRoICUxJHMsIG91dHNpZGUgb2YgdGhpcyBjaGF0LlxuXG5GaW5nZXJwcmludCBmb3IgeW91LCAlMiRzOiAlMyRzXG5cbkZpbmdlcnByaW50IGZvciAlMSRzOiAlNCRzXG5cbklmIHlvdSBoYXZlIGNvbmZpcm1lZCB0aGF0IHRoZSBmaW5nZXJwcmludHMgbWF0Y2gsIGNsaWNrIE9LLCBvdGhlcndpc2UgY2xpY2sgQ2FuY2VsLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdSB3aWxsIGJlIHByb21wdGVkIHRvIHByb3ZpZGUgYSBzZWN1cml0eSBxdWVzdGlvbiBhbmQgdGhlbiBhbiBhbnN3ZXIgdG8gdGhhdCBxdWVzdGlvbi5cblxuWW91ciBidWRkeSB3aWxsIHRoZW4gYmUgcHJvbXB0ZWQgdGhlIHNhbWUgcXVlc3Rpb24gYW5kIGlmIHRoZXkgdHlwZSB0aGUgZXhhY3Qgc2FtZSBhbnN3ZXIgKGNhc2Ugc2Vuc2l0aXZlKSwgdGhlaXIgaWRlbnRpdHkgd2lsbCBoYXZlIGJlZW4gdmVyaWZpZWQuIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiV2hhdCBpcyB5b3VyIHNlY3VyaXR5IHF1ZXN0aW9uPyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIldoYXQgaXMgdGhlIGFuc3dlciB0byB0aGUgc2VjdXJpdHkgcXVlc3Rpb24/IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiSW52YWxpZCBhdXRoZW50aWNhdGlvbiBzY2hlbWUgcHJvdmlkZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG1lc3NhZ2VzIGFyZSBub3QgZW5jcnlwdGVkIGFueW1vcmUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG1lc3NhZ2VzIGFyZSBub3cgZW5jcnlwdGVkIGJ1dCB5b3VyIGJ1ZGR5J3MgaWRlbnRpdHkgaGFzIG5vdCBiZWVuIHZlcmlmaWVkLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgYnVkZHkncyBpZGVudGlmeSBoYXMgYmVlbiB2ZXJpZmllZC4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIGJ1ZGR5IGhhcyBlbmRlZCBlbmNyeXB0aW9uIG9uIHRoZWlyIGVuZCwgeW91IHNob3VsZCBkbyB0aGUgc2FtZS4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG1lc3NhZ2VzIGFyZSBub3QgZW5jcnlwdGVkLiBDbGljayBoZXJlIHRvIGVuYWJsZSBPVFIgZW5jcnlwdGlvbi4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG1lc3NhZ2VzIGFyZSBlbmNyeXB0ZWQsIGJ1dCB5b3VyIGJ1ZGR5IGhhcyBub3QgYmVlbiB2ZXJpZmllZC4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG1lc3NhZ2VzIGFyZSBlbmNyeXB0ZWQgYW5kIHlvdXIgYnVkZHkgdmVyaWZpZWQuIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBidWRkeSBoYXMgY2xvc2VkIHRoZWlyIGVuZCBvZiB0aGUgcHJpdmF0ZSBzZXNzaW9uLCB5b3Ugc2hvdWxkIGRvIHRoZSBzYW1lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ29udGFjdHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiS29udGFrdGUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk9ubGluZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJPbmxpbmUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkJ1c3kiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQmVzY2jDpGZ0aWNodCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQXdheSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJBYndlc2VuZCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiT2ZmbGluZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJBYmdlbWVsZGV0IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDbGljayB0byBhZGQgbmV3IGNoYXQgY29udGFjdHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiS2xpY2tlbiBTaWUsIHVtIGVpbmVuIG5ldWVuIEtvbnRha3QgaGluenV6dWbDvGdlbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQWRkIGEgY29udGFjdCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJLb250YWt0ZSBoaW56dWbDvGdlbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ29udGFjdCB1c2VybmFtZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJCZW51dHplcm5hbWUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkFkZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJIaW56dWbDvGdlbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ29udGFjdCBuYW1lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk5hbWUgZGVzIEtvbnRha3RzIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTZWFyY2giOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU3VjaGUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk5vIHVzZXJzIGZvdW5kIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIktlaW5lIEJlbnV0emVyIGdlZnVuZGVuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDbGljayB0byBhZGQgYXMgYSBjaGF0IGNvbnRhY3QiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSGllciBrbGlja2VuIHVtIGFscyBLb250YWt0IGhpbnp1enVmw7xnZW4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNsaWNrIHRvIG9wZW4gdGhpcyByb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkhpZXIga2xpY2tlbiB1bSBkaWVzZW4gUmF1bSB6dSDDtmZmbmVuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTaG93IG1vcmUgaW5mb3JtYXRpb24gb24gdGhpcyByb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk1laHIgSW5mb3JtYXRpb24gw7xiZXIgZGllc2VuIFJhdW0gemVpZ2VuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJEZXNjcmlwdGlvbjoiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQmVzY2hyZWlidW5nIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJPY2N1cGFudHM6IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlRlaWxuZWhtZXIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkZlYXR1cmVzOiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJGdW5rdGlvbmVuOiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUmVxdWlyZXMgYXV0aGVudGljYXRpb24iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQXV0aGVudGlmaXppZXJ1bmcgZXJmb3JkZXJsaWNoIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJIaWRkZW4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVmVyc3RlY2t0IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSZXF1aXJlcyBhbiBpbnZpdGF0aW9uIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkVpbmxhZHVuZyBlcmZvcmRlcmxpY2giCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk1vZGVyYXRlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJNb2RlcmllcnQiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk5vbi1hbm9ueW1vdXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTmljaHQgYW5vbnltIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJPcGVuIHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiT2ZmZW5lciBSYXVtIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJQZXJtYW5lbnQgcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJEYXVlcmhhZnRlciBSYXVtIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJQdWJsaWMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiw5ZmZmVudGxpY2giCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNlbWktYW5vbnltb3VzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlRlaWxzIGFub255bSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGVtcG9yYXJ5IHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVm9yw7xiZXJnZWhlbmRlciBSYXVtIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJVbm1vZGVyYXRlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJVbm1vZGVyaWVydCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUm9vbXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiUsOkdW1lIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSb29tIG5hbWUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiUmF1bW5hbWUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk5pY2tuYW1lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlNwaXR6bmFtZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU2VydmVyIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlNlcnZlciIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiSm9pbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJCZWl0cmV0ZW4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNob3cgcm9vbXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiUsOkdW1lIGFuemVpZ2VuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJObyByb29tcyBvbiAlMSRzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIktlaW5lIFLDpHVtZSBhdWYgJTEkcyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUm9vbXMgb24gJTEkcyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJSw6R1bWUgYXVmICUxJHMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNldCBjaGF0cm9vbSB0b3BpYyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDaGF0cmF1bSBUaGVtYSBmZXN0bGVnZW4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIktpY2sgdXNlciBmcm9tIGNoYXRyb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIldlcmZlIGVpbmVuIEJlbnV0emVyIGF1cyBkZW0gUmF1bS4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkJhbiB1c2VyIGZyb20gY2hhdHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVmVyYmFubmUgZWluZW4gQmVudXR6ZXIgYXVzIGRlbSBSYXVtLiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTWVzc2FnZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJOYWNocmljaHQiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNhdmUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU3BlaWNoZXJuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDYW5jZWwiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQWJicmVjaGVuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJBbiBlcnJvciBvY2N1cnJlZCB3aGlsZSB0cnlpbmcgdG8gc2F2ZSB0aGUgZm9ybS4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQmVpbSBTcGVpY2hlcm4gZGVyIEZvcm11bGFyIGlzIGVpbiBGZWhsZXIgYXVmZ2V0cmV0ZW4uIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIGNoYXRyb29tIHJlcXVpcmVzIGEgcGFzc3dvcmQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiUGFzc3dvcnQgd2lyZCBmw7xyIGRpZSBBbm1lbGR1bmcgYmVuw7Z0aWd0LiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUGFzc3dvcmQ6ICI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJQYXNzd29ydDogIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTdWJtaXQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRWlucmVpY2hlbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyByb29tIGlzIG5vdCBhbm9ueW1vdXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRGllc2VyIFJhdW0gaXN0IG5pY2h0IGFub255bSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyByb29tIG5vdyBzaG93cyB1bmF2YWlsYWJsZSBtZW1iZXJzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkRpZXNlciBSYXVtIHplaWd0IGpldHp0IHVuZmVyZsO8Z2JhcmUgTWl0Z2xpZWRlciIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyByb29tIGRvZXMgbm90IHNob3cgdW5hdmFpbGFibGUgbWVtYmVycyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJEaWVzZXIgUmF1bSB6ZWlndCBuaWNodCB1bnZlcmbDvGdiYXJlIE1pdGdsaWVkZXIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk5vbi1wcml2YWN5LXJlbGF0ZWQgcm9vbSBjb25maWd1cmF0aW9uIGhhcyBjaGFuZ2VkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkRpZSBLb25maWd1cmF0aW9uLCBkaWUgbmljaHQgYXVmIGRpZSBQcml2YXRzcGjDpHJlIGJlem9nZW4gaXN0LCBoYXQgc2ljaCBnZcOkbmRlcnQiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJvb20gbG9nZ2luZyBpcyBub3cgZW5hYmxlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJadWvDvG5mdGlnZSBOYWNocmljaHRlbiBkaWVzZXMgUmF1bXMgd2VyZGVuIHByb3Rva29sbGllcnQuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSb29tIGxvZ2dpbmcgaXMgbm93IGRpc2FibGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlp1a8O8bmZ0aWdlIE5hY2hyaWNodGVuIGRpZXNlcyBSYXVtcyB3ZXJkZW4gbmljaHQgcHJvdG9rb2xsaWVydC4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBpcyBub3cgbm9uLWFub255bW91cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJEaWVzZXIgUmF1bSBpc3QgamV0enQgbmljaHQgYW5vbnltIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gaXMgbm93IHNlbWktYW5vbnltb3VzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkRpZXNlciBSYXVtIGlzdCBqZXR6dCB0ZWlscyBhbm9ueW0iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBpcyBub3cgZnVsbHktYW5vbnltb3VzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkRpZXNlciBSYXVtIGlzdCBqZXR6dCBhbm9ueW0iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkEgbmV3IHJvb20gaGFzIGJlZW4gY3JlYXRlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJFaW5lbiBuZXVlbiBSYXVtIGlzdCBlcnN0ZWxsZW4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgbmlja25hbWUgaGFzIGJlZW4gY2hhbmdlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTcGl0em5hbWUgZmVzdGdlbGVnZW4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIjxzdHJvbmc+JTEkczwvc3Ryb25nPiBoYXMgYmVlbiBiYW5uZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IGlzdCB2ZXJiYW5udCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IGhhcyBiZWVuIGtpY2tlZCBvdXQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IGlzdCBoaW5hdXNnZXdvcmZlbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IGhhcyBiZWVuIHJlbW92ZWQgYmVjYXVzZSBvZiBhbiBhZmZpbGlhdGlvbiBjaGFuZ2UiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IHd1cmRlIHdlZ2VuIGVpbmVyIFp1Z2Vow7ZyaWdrZWl0c8OkbmRlcnVuZyBlbnRmZXJudCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IGhhcyBiZWVuIHJlbW92ZWQgZm9yIG5vdCBiZWluZyBhIG1lbWJlciI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gaXN0IGtlaW4gTWl0Z2xpZWQgdW5kIHd1cmRlIGRhaGVyIGVudGZlcm50IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3UgaGF2ZSBiZWVuIGJhbm5lZCBmcm9tIHRoaXMgcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTaWUgc2luZCBhdXMgZGllc2VtIFJhdW0gdmVyYmFubnQgd29yZGVuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3UgaGF2ZSBiZWVuIGtpY2tlZCBmcm9tIHRoaXMgcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTaWUgd3VyZGVuIGF1cyBkaWVzZW0gUmF1bSBoaW5hdXNnZXdvcmZlbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91IGhhdmUgYmVlbiByZW1vdmVkIGZyb20gdGhpcyByb29tIGJlY2F1c2Ugb2YgYW4gYWZmaWxpYXRpb24gY2hhbmdlIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlNpZSB3dXJkZW4gd2VnZW4gZWluZXIgWnVnZWjDtnJpZ2tlaXRzw6RuZGVydW5nIGVudGZlcm50IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3UgaGF2ZSBiZWVuIHJlbW92ZWQgZnJvbSB0aGlzIHJvb20gYmVjYXVzZSB0aGUgcm9vbSBoYXMgY2hhbmdlZCB0byBtZW1iZXJzLW9ubHkgYW5kIHlvdSdyZSBub3QgYSBtZW1iZXIiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU2llIHd1cmRlbiBhdXMgZGllc2VtIFJhdW0gZW50ZmVybnQgZGEgU2llIGtlaW4gTWl0Z2xpZWQgc2luZC4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdSBoYXZlIGJlZW4gcmVtb3ZlZCBmcm9tIHRoaXMgcm9vbSBiZWNhdXNlIHRoZSBNVUMgKE11bHRpLXVzZXIgY2hhdCkgc2VydmljZSBpcyBiZWluZyBzaHV0IGRvd24uIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlNpZSB3ZXJkZW4gYXVzIGRpZXNlbSBSYXVtIGVudGZlcm50IGRhIGRlciBNVUMgKE11bGktdXNlciBjaGF0KSBEaWVuc3QgZ2VyYWRlIGFiZ2VzY2hhbHRlbiB3aXJkLiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91IGFyZSBub3Qgb24gdGhlIG1lbWJlciBsaXN0IG9mIHRoaXMgcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTaWUgc2luZCBuaWNodCBhdWYgZGVyIE1pdGdsaWVkZXJsaXN0ZSBkaWVzZXMgUmF1bXMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk5vIG5pY2tuYW1lIHdhcyBzcGVjaWZpZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiS2VpbiBTcGl0em5hbWUgZmVzdGdlbGVndCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91IGFyZSBub3QgYWxsb3dlZCB0byBjcmVhdGUgbmV3IHJvb21zIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkVzIGlzdCBJaG5lbiBuaWNodCBlcmxhdWJ0LCBuZXVlIFLDpHVtZSBhbnp1bGVnZW4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgbmlja25hbWUgZG9lc24ndCBjb25mb3JtIHRvIHRoaXMgcm9vbSdzIHBvbGljaWVzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlVuZ8O8bHRpZ2VyIFNwaXR6bmFtZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBuaWNrbmFtZSBpcyBhbHJlYWR5IHRha2VuIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIklocmUgU3BpdHpuYW1lIGV4aXN0aWVydCBiZXJlaXRzLiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyByb29tIGRvZXMgbm90ICh5ZXQpIGV4aXN0IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkRpZXNlciBSYXVtIGV4aXN0aWVydCAobm9jaCkgbmljaHQiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBoYXMgcmVhY2hlZCBpdCdzIG1heGltdW0gbnVtYmVyIG9mIG9jY3VwYW50cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJEaWVzZXIgUmF1bSBoYXQgZGllIG1heGltYWxlIE1pdGdsaWVkZXJhbnphaGwgZXJyZWljaHQiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRvcGljIHNldCBieSAlMSRzIHRvOiAlMiRzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiUxJHMgaGF0IGRhcyBUaGVtYSB6dSBcIiUyJHNcIiBhYmdlw6RuZGVydCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyB1c2VyIGlzIGEgbW9kZXJhdG9yIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkRpZXNlciBCZW51dHplciBpc3QgZWluIE1vZGVyYXRvciIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyB1c2VyIGNhbiBzZW5kIG1lc3NhZ2VzIGluIHRoaXMgcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJEaWVzZXIgQmVudXR6ZXIga2FubiBOYWNocmljaHRlbiBpbiBkaWVzZW0gUmF1bSB2ZXJzY2hpY2tlbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyB1c2VyIGNhbiBOT1Qgc2VuZCBtZXNzYWdlcyBpbiB0aGlzIHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRGllc2VyIEJlbnV0emVyIGthbm4ga2VpbmUgTmFjaHJpY2h0ZW4gaW4gZGllc2VtIFJhdW0gdmVyc2NoaWNrZW4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNsaWNrIHRvIGNoYXQgd2l0aCB0aGlzIGNvbnRhY3QiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSGllciBrbGlja2VuIHVtIG1pdCBkaWVzZW0gS29udGFrdCB6dSBjaGF0dGVuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDbGljayB0byByZW1vdmUgdGhpcyBjb250YWN0IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkhpZXIga2xpY2tlbiB1bSBkaWVzZW4gS29udGFrdCB6dSBlbnRmZXJuZW4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgY29udGFjdCBpcyBidXN5IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkRpZXNlciBLb250YWt0IGlzdCBiZXNjaMOkZnRpY2h0IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIGNvbnRhY3QgaXMgb25saW5lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkRpZXNlciBLb250YWt0IGlzdCBvbmxpbmUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgY29udGFjdCBpcyBvZmZsaW5lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkRpZXNlciBLb250YWt0IGlzdCBvZmZsaW5lIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIGNvbnRhY3QgaXMgdW5hdmFpbGFibGUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRGllc2VyIEtvbnRha3QgaXN0IG5pY2h0IHZlcmbDvGdiYXIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgY29udGFjdCBpcyBhd2F5IGZvciBhbiBleHRlbmRlZCBwZXJpb2QiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRGllc2VyIEtvbnRha3QgaXMgZsO8ciBsw6RuZ2VyZSBaZWl0IGFid2VzZW5kIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIGNvbnRhY3QgaXMgYXdheSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJEaWVzZXIgS29udGFrdCBpc3QgYWJ3ZXNlbmQiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNvbnRhY3QgcmVxdWVzdHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiS29udGFrdGFuZnJhZ2VuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJNeSBjb250YWN0cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJNZWluZSBLb250YWt0ZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUGVuZGluZyBjb250YWN0cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJVbmJlc3TDpHRpZ3RlIEtvbnRha3RlIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDdXN0b20gc3RhdHVzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlN0YXR1cy1OYWNocmljaHQiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNsaWNrIHRvIGNoYW5nZSB5b3VyIGNoYXQgc3RhdHVzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIktsaWNrZW4gU2llLCB1bSBpaHJlciBTdGF0dXMgdG8gw6RuZGVybiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgaGVyZSB0byB3cml0ZSBhIGN1c3RvbSBzdGF0dXMgbWVzc2FnZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJLbGlja2VuIFNpZSBoaWVyLCB1bSBpaHJlciBTdGF0dXMtTmFjaHJpY2h0IHRvIMOkbmRlcm4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIm9ubGluZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJvbmxpbmUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgImJ1c3kiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiYmVzY2jDpGZ0aWNodCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiYXdheSBmb3IgbG9uZyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJsw6RuZ2VyIGFid2VzZW5kIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJhd2F5IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgImFid2VzZW5kIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJJIGFtICUxJHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSWNoIGJpbiAlMSRzIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTaWduIGluIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkFubWVsZGVuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJYTVBQL0phYmJlciBVc2VybmFtZToiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiWE1QUC9KYWJiZXIgQmVudXR6ZXJuYW1lIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJQYXNzd29yZDoiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiUGFzc3dvcnQ6IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJMb2cgSW4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQW5tZWxkZW4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkJPU0ggU2VydmljZSBVUkw6IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkJPU0ggIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJPbmxpbmUgQ29udGFjdHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiT25saW5lLUtvbnRha3RlIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICIlMSRzIGlzIHR5cGluZyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIlMSRzIHRpcHB0IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb25uZWN0ZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVmVyYnVuZGVuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJBdHRhY2hlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJBbmdlaMOkbmd0IgogICAgICAgICAgICAgICAgXQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIGlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHsKICAgICAgICBkZWZpbmUoImRlIiwgWydqZWQnXSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gZmFjdG9yeShuZXcgSmVkKHRyYW5zbGF0aW9ucykpOwogICAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgICBpZiAoIXdpbmRvdy5sb2NhbGVzKSB7CiAgICAgICAgICAgIHdpbmRvdy5sb2NhbGVzID0ge307CiAgICAgICAgfQogICAgICAgIHdpbmRvdy5sb2NhbGVzLmRlID0gZmFjdG9yeShuZXcgSmVkKHRyYW5zbGF0aW9ucykpOwogICAgfQp9KHRoaXMsIGZ1bmN0aW9uIChkZSkgeyAKICAgIHJldHVybiBkZTsgCn0pKTsKCihmdW5jdGlvbiAocm9vdCwgZmFjdG9yeSkgewogICAgdmFyIHRyYW5zbGF0aW9ucyA9IHsKICAgICAgICAiZG9tYWluIjogImNvbnZlcnNlIiwKICAgICAgICAibG9jYWxlX2RhdGEiOiB7CiAgICAgICAgICAgICJjb252ZXJzZSI6IHsKICAgICAgICAgICAgICAgICIiOiB7CiAgICAgICAgICAgICAgICAgICAgImRvbWFpbiI6ICJjb252ZXJzZSIsCiAgICAgICAgICAgICAgICAgICAgImxhbmciOiAiZW4iLAogICAgICAgICAgICAgICAgICAgICJwbHVyYWxfZm9ybXMiOiAibnBsdXJhbHM9MjsgcGx1cmFsPShuICE9IDEpOyIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7CiAgICAgICAgZGVmaW5lKCJlbiIsIFsnamVkJ10sIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkobmV3IEplZCh0cmFuc2xhdGlvbnMpKTsKICAgICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKCF3aW5kb3cubG9jYWxlcykgewogICAgICAgICAgICB3aW5kb3cubG9jYWxlcyA9IHt9OwogICAgICAgIH0KICAgICAgICB3aW5kb3cubG9jYWxlcy5lbiA9IGZhY3RvcnkobmV3IEplZCh0cmFuc2xhdGlvbnMpKTsKICAgIH0KfSh0aGlzLCBmdW5jdGlvbiAoZW4pIHsgCiAgICByZXR1cm4gZW47Cn0pKTsKCihmdW5jdGlvbiAocm9vdCwgZmFjdG9yeSkgewogICAgdmFyIHRyYW5zbGF0aW9ucyA9IHsKICAgICAgICAiZG9tYWluIjogImNvbnZlcnNlIiwKICAgICAgICAibG9jYWxlX2RhdGEiOiB7CiAgICAgICAgICAgICJjb252ZXJzZSI6IHsKICAgICAgICAgICAgICAgICIiOiB7CiAgICAgICAgICAgICAgICAgICAgIlByb2plY3QtSWQtVmVyc2lvbiI6ICJDb252ZXJzZS5qcyAwLjQiLAogICAgICAgICAgICAgICAgICAgICJSZXBvcnQtTXNnaWQtQnVncy1UbyI6ICIiLAogICAgICAgICAgICAgICAgICAgICJQT1QtQ3JlYXRpb24tRGF0ZSI6ICIyMDEzLTA5LTE1IDIxOjU1KzAyMDAiLAogICAgICAgICAgICAgICAgICAgICJQTy1SZXZpc2lvbi1EYXRlIjogIjIwMTMtMDktMTUgMjE6NTkrMDIwMCIsCiAgICAgICAgICAgICAgICAgICAgIkxhc3QtVHJhbnNsYXRvciI6ICJKYXZpZXIgTG9wZXogPG1AamF2aWVyLmlvPiIsCiAgICAgICAgICAgICAgICAgICAgIkxhbmd1YWdlLVRlYW0iOiAiRVMgPExMQGxpLm9yZz4iLAogICAgICAgICAgICAgICAgICAgICJMYW5ndWFnZSI6ICJlcyIsCiAgICAgICAgICAgICAgICAgICAgIk1JTUUtVmVyc2lvbiI6ICIxLjAiLAogICAgICAgICAgICAgICAgICAgICJDb250ZW50LVR5cGUiOiAidGV4dC9wbGFpbjsgY2hhcnNldD1VVEYtOCIsCiAgICAgICAgICAgICAgICAgICAgIkNvbnRlbnQtVHJhbnNmZXItRW5jb2RpbmciOiAiOGJpdCIsCiAgICAgICAgICAgICAgICAgICAgIlBsdXJhbC1Gb3JtcyI6ICJucGx1cmFscz0yOyBwbHVyYWw9KG4gIT0gMSk7IiwKICAgICAgICAgICAgICAgICAgICAicGx1cmFsX2Zvcm1zIjogIm5wbHVyYWxzPTI7IHBsdXJhbD0obiAhPSAxKTsiLAogICAgICAgICAgICAgICAgICAgICJsYW5nIjogImVzIiwKICAgICAgICAgICAgICAgICAgICAiTGFuZ3VhZ2UtQ29kZSI6ICJlcyIsCiAgICAgICAgICAgICAgICAgICAgIkxhbmd1YWdlLU5hbWUiOiAiRXNwYcOxb2wiLAogICAgICAgICAgICAgICAgICAgICJQcmVmZXJyZWQtRW5jb2RpbmdzIjogInV0Zi04IGxhdGluMSIsCiAgICAgICAgICAgICAgICAgICAgIkRvbWFpbiI6ICJjb252ZXJzZSIsCiAgICAgICAgICAgICAgICAgICAgImRvbWFpbiI6ICJjb252ZXJzZSIsCiAgICAgICAgICAgICAgICAgICAgIlgtSXMtRmFsbGJhY2stRm9yIjogImVzLWFyIGVzLWJvIGVzLWNsIGVzLWNvIGVzLWNyIGVzLWRvIGVzLWVjIGVzLWVzIGVzLXN2IGVzLWd0IGVzLWhuIGVzLW14IGVzLW5pIGVzLXBhIGVzLXB5IGVzLXBlIGVzLXByIGVzLXVzIGVzLXV5IGVzLXZlIgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJ1bmVuY3J5cHRlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJ0ZXh0byBwbGFubyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAidW52ZXJpZmllZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJzaW4gdmVyaWZpY2FyIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJ2ZXJpZmllZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJ2ZXJpZmljYWRvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJmaW5pc2hlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJmaW5hbGl6YWRvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJEaXNjb25uZWN0ZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRGVzY29uZWN0YWRvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJFcnJvciI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJFcnJvciIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ29ubmVjdGluZyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDb25lY3RhbmRvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb25uZWN0aW9uIEZhaWxlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJMYSBjb25leGnDs24gZmFsbMOzIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJBdXRoZW50aWNhdGluZyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJBdXRlbnRpY2FuZG8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkF1dGhlbnRpY2F0aW9uIEZhaWxlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJMYSBhdXRlbnRpY2FjacOzbiBmYWxsw7MiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkRpc2Nvbm5lY3RpbmciOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRGVzY29uZWN0YW5kbyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUmUtZXN0YWJsaXNoaW5nIGVuY3J5cHRlZCBzZXNzaW9uIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlJlLWVzdGFibGVjaWVuZG8gc2VzacOzbiBjaWZyYWRhIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIGJyb3dzZXIgbmVlZHMgdG8gZ2VuZXJhdGUgYSBwcml2YXRlIGtleSwgd2hpY2ggd2lsbCBiZSB1c2VkIGluIHlvdXIgZW5jcnlwdGVkIGNoYXQgc2Vzc2lvbi4gVGhpcyBjYW4gdGFrZSB1cCB0byAzMCBzZWNvbmRzIGR1cmluZyB3aGljaCB5b3VyIGJyb3dzZXIgbWlnaHQgZnJlZXplIGFuZCBiZWNvbWUgdW5yZXNwb25zaXZlLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTdSBuYXZlZ2Fkb3IgZ2VuZXJhcsOhIHVuYSBsbGF2ZSBwcml2YWRhIHBhcmEgdXNhcnNlIGVuIGxhIHNlc2nDs24gY2lmcmFkYS4gRXN0byBwdWVkZSB0b21hciBoYXN0YSAzMCBzZWd1bmRvLCBkdXJhbnRlIGVzdGUgdGllbXBvIHN1IG5hdmVnYWRvciBwdWVkZSBkZWphciBkZSByZXNwb25kZXIuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJQcml2YXRlIGtleSBnZW5lcmF0ZWQuIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkxsYXZlIHByaXZhZGEgZ2VuZXJhZGEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkF1dGhlbnRpY2F0aW9uIHJlcXVlc3QgZnJvbSAlMSRzXG5cbllvdXIgYnVkZHkgaXMgYXR0ZW1wdGluZyB0byB2ZXJpZnkgeW91ciBpZGVudGl0eSwgYnkgYXNraW5nIHlvdSB0aGUgcXVlc3Rpb24gYmVsb3cuXG5cbiUyJHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiUGV0aWNpw7NuIGRlIGF1dGVudGljYWNpw7NuIGRlICUxJHNcblxuU3UgY29udGFjdG8gaW50ZW50YSB2ZXJpZmljYXIgc3UgaWRlbnRpZGFkIGhhY2llbmRvIGxhIHNpZ3VpZW50ZSBwcmVndW50YS5cblxuJTIkcyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ291bGQgbm90IHZlcmlmeSB0aGlzIHVzZXIncyBpZGVudGlmeS4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTm8gc2UgcHVkbyB2ZXJpZmljYXIgbGEgaWRlbnRpZGFkIGRlIGVzdGUgdXN1YXJpbyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUGVyc29uYWwgbWVzc2FnZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJNZW5zYWplIHBlcnNvbmFsIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTdGFydCBlbmNyeXB0ZWQgY29udmVyc2F0aW9uIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkluaWNpYXIgc2VzacOzbiBjaWZyYWRhIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSZWZyZXNoIGVuY3J5cHRlZCBjb252ZXJzYXRpb24iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQWN0dWFsaXphciBzZXNpw7NuIGNpZnJhZGEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkVuZCBlbmNyeXB0ZWQgY29udmVyc2F0aW9uIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkZpbmFsaXphciBzZXNpw7NuIGNpZnJhZGEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlZlcmlmeSB3aXRoIFNNUCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJWZXJpZmljYXIgY29uIFNNUCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVmVyaWZ5IHdpdGggZmluZ2VycHJpbnRzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlZlcmlmaWNhciBjb24gaWRlbnRpZmljYWRvcmVzIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJXaGF0J3MgdGhpcz8iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiwr9RdcOpIGVzIGVzdG8/IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJtZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJ5byIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU2hvdyB0aGlzIG1lbnUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTW9zdHJhciBlc3RlIG1lbsO6IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJXcml0ZSBpbiB0aGUgdGhpcmQgcGVyc29uIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkVzY3JpYmlyIGVuIHRlcmNlcmEgcGVyc29uYSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUmVtb3ZlIG1lc3NhZ2VzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkVsaW1pbmFyIG1lbnNhamVzIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG1lc3NhZ2UgY291bGQgbm90IGJlIHNlbnQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU3UgbWVuc2FqZSBubyBzZSBwdWRvIGVudmlhciIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiV2UgcmVjZWl2ZWQgYW4gdW5lbmNyeXB0ZWQgbWVzc2FnZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTZSByZWNpYsOtbyB1biBtZW5zYWplIHNpbiBjaWZyYXIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIldlIHJlY2VpdmVkIGFuIHVucmVhZGFibGUgZW5jcnlwdGVkIG1lc3NhZ2UiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU2UgcmVjaWLDrW8gdW4gbWVuc2FqZSBjaWZyYWRvIGNvcnJ1cHRvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHVzZXIgaGFzIHJlcXVlc3RlZCBhbiBlbmNyeXB0ZWQgc2Vzc2lvbi4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRWwgdXN1YXJpbyBoYSBzb2xpY2l0YWRvIHVuYSBzZXNpw7NuIGNpZnJhZGEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkhlcmUgYXJlIHRoZSBmaW5nZXJwcmludHMsIHBsZWFzZSBjb25maXJtIHRoZW0gd2l0aCAlMSRzLCBvdXRzaWRlIG9mIHRoaXMgY2hhdC5cblxuRmluZ2VycHJpbnQgZm9yIHlvdSwgJTIkczogJTMkc1xuXG5GaW5nZXJwcmludCBmb3IgJTEkczogJTQkc1xuXG5JZiB5b3UgaGF2ZSBjb25maXJtZWQgdGhhdCB0aGUgZmluZ2VycHJpbnRzIG1hdGNoLCBjbGljayBPSywgb3RoZXJ3aXNlIGNsaWNrIENhbmNlbC4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICJQb3IgZmF2b3IgY29uZmlybWUgbG9zIGlkZW50aWZpY2Fkb3JlcyBkZSAlMSRzIGZ1ZXJhIGRlIGVzdGUgY2hhdFxuXG4uIFN1IGlkZW50aWZpY2Fkb3IgZXMsICUyJHM6ICUzJHNcblxuLiBFbCBpZGVudGlmaWNhZG9yIGRlICUxJHMgZXM6ICU0JHNcblxuLiBEZXNwdcOpcyBkZSBjb25maXJtYXIgbG9zIGlkZW50aWZpY2Fkb3JlcyBoYWdhIGNsaWNrIGVuIE9LLCBjYW5jZWxlIHNpIG5vIGNvbmN1ZXJkYW4uIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3Ugd2lsbCBiZSBwcm9tcHRlZCB0byBwcm92aWRlIGEgc2VjdXJpdHkgcXVlc3Rpb24gYW5kIHRoZW4gYW4gYW5zd2VyIHRvIHRoYXQgcXVlc3Rpb24uXG5cbllvdXIgYnVkZHkgd2lsbCB0aGVuIGJlIHByb21wdGVkIHRoZSBzYW1lIHF1ZXN0aW9uIGFuZCBpZiB0aGV5IHR5cGUgdGhlIGV4YWN0IHNhbWUgYW5zd2VyIChjYXNlIHNlbnNpdGl2ZSksIHRoZWlyIGlkZW50aXR5IHdpbGwgaGF2ZSBiZWVuIHZlcmlmaWVkLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTZSBsZSBzb2xpY2l0YXLDoSB1bmEgcHJlZ3VudGEgZGUgc2VndXJpZGFkLlxuXG4uIExhIHByZWd1bnRhIHF1ZSByZXNwb25kYSBzZSBsZSBoYXLDoSBhIHN1IGNvbnRhY3RvLCBzaSBsYXMgcmVzcHVlc3RhcyBjb25jdWVyZGFuIChjdWlkYW5kbyBtYXnDunNjdWxhcy9taW7DunNjdWxhcykgc3UgaWRlbnRpZGFkIHF1ZWRhcsOhIHZlcmlmaWNhZGEuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJXaGF0IGlzIHlvdXIgc2VjdXJpdHkgcXVlc3Rpb24/IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkludHJvZHV6Y2Egc3UgcHJlZ3VudGEgZGUgc2VndXJpZGFkIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJXaGF0IGlzIHRoZSBhbnN3ZXIgdG8gdGhlIHNlY3VyaXR5IHF1ZXN0aW9uPyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJJbnRyb2R1emNhIGxhIHJlc3B1ZXN0YSBhIHN1IHByZWd1bnRhIGRlIHNlZ3VyaWRhZCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiSW52YWxpZCBhdXRoZW50aWNhdGlvbiBzY2hlbWUgcHJvdmlkZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRXNxdWVtYSBkZSBhdXRlbnRpY2FjacOzbiBpbnbDoWxpZG8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgbWVzc2FnZXMgYXJlIG5vdCBlbmNyeXB0ZWQgYW55bW9yZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTdXMgbWVuc2FqZXMgaGFuIGRlamFkbyBkZSBjaWZyYXJzZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBtZXNzYWdlcyBhcmUgbm93IGVuY3J5cHRlZCBidXQgeW91ciBidWRkeSdzIGlkZW50aXR5IGhhcyBub3QgYmVlbiB2ZXJpZmllZC4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU3VzIG1lbnNhamVzIGVzdMOhbiBhaG9yYSBjaWZyYWRvcyBwZXJvIGxhIGlkZW50aWRhZCBkZSBzdSBjb250YWN0byBubyBoYSBzaWRvIHZlcmlmaWNhZGEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgYnVkZHkncyBpZGVudGlmeSBoYXMgYmVlbiB2ZXJpZmllZC4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTGEgaWRlbnRpZGFkIGRlIHN1IGNvbnRhY3RvIGhhIHNpZG8gY29uZmlybWFkYSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBidWRkeSBoYXMgZW5kZWQgZW5jcnlwdGlvbiBvbiB0aGVpciBlbmQsIHlvdSBzaG91bGQgZG8gdGhlIHNhbWUuIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlN1IGNvbnRhY3RvIGZpbmFsaXrDsyBsYSBzZXNpw7NuIGNpZnJhZGEsIGRlYmVyw61hIGhhY2VyIGxvIG1pc21vIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG1lc3NhZ2VzIGFyZSBub3QgZW5jcnlwdGVkLiBDbGljayBoZXJlIHRvIGVuYWJsZSBPVFIgZW5jcnlwdGlvbi4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU3VzIG1lbnNhamVzIG5vIGVzdMOhbiBjaWZyYWRvcy4gSGFnYSBjbGljayBhcXXDrSBwYXJhIGhhYmlsaXRhciBlbCBjaWZyYWRvIE9UUiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBtZXNzYWdlcyBhcmUgZW5jcnlwdGVkLCBidXQgeW91ciBidWRkeSBoYXMgbm90IGJlZW4gdmVyaWZpZWQuIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlN1cyBtZW5zYWplcyBlc3TDoW4gY2lmcmFkb3MgcGVybyBsYSBpZGVudGlkYWQgZGUgc3UgY29udGFjdG8gbm8gaGEgc2lkbyB2ZXJpZmljYWRhIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG1lc3NhZ2VzIGFyZSBlbmNyeXB0ZWQgYW5kIHlvdXIgYnVkZHkgdmVyaWZpZWQuIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlN1cyBtZW5zYWplcyBlc3TDoW4gY2lmcmFkb3MgeSBzdSBjb250YWN0byBoYSBzaWRvIHZlcmlmaWNhZG8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgYnVkZHkgaGFzIGNsb3NlZCB0aGVpciBlbmQgb2YgdGhlIHByaXZhdGUgc2Vzc2lvbiwgeW91IHNob3VsZCBkbyB0aGUgc2FtZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTdSBjb250YWN0byBmaW5hbGl6w7MgbGEgc2VzacOzbiBjaWZyYWRhLCBkZWJlcsOtYSBoYWNlciBsbyBtaXNtbyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ29udGFjdHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQ29udGFjdG9zIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJPbmxpbmUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRW4gbGluZWEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkJ1c3kiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiT2N1cGFkbyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQXdheSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJBdXNlbnRlIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJPZmZsaW5lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkRlc2NvbmVjdGFkbyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgdG8gYWRkIG5ldyBjaGF0IGNvbnRhY3RzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkhhZ2EgY2xpY2sgcGFyYSBhZ3JlZ2FyIG51ZXZvcyBjb250YWN0b3MgYWwgY2hhdCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQWRkIGEgY29udGFjdCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJBZ3JlZ2FyIHVuIGNvbnRhY3RvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb250YWN0IHVzZXJuYW1lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk5vbWJyZSBkZSB1c3VhcmlvIGRlIGNvbnRhY3RvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJBZGQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQWdyZWdhciIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ29udGFjdCBuYW1lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk5vbWJyZSBkZSBjb250YWN0byIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU2VhcmNoIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkLDunNxdWVkYSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTm8gdXNlcnMgZm91bmQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU2luIHVzdWFyaW9zIGVuY29udHJhZG9zIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDbGljayB0byBhZGQgYXMgYSBjaGF0IGNvbnRhY3QiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSGFnYSBjbGljayBwYXJhIGFncmVnYXIgY29tbyBjb250YWN0byBkZSBjaGF0IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDbGljayB0byBvcGVuIHRoaXMgcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJIYWdhIGNsaWNrIHBhcmEgYWJyaXIgZXN0YSBzYWxhIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTaG93IG1vcmUgaW5mb3JtYXRpb24gb24gdGhpcyByb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk1vc3RyYXIgbcOhcyBpbmZvcm1hY2nDs24gZW4gZXN0YSBzYWxhIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJEZXNjcmlwdGlvbjoiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRGVzY3JpcGNpw7NuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJPY2N1cGFudHM6IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk9jdXBhbnRlczoiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkZlYXR1cmVzOiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDYXJhY3RlcsOtc3RpY2FzOiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUmVxdWlyZXMgYXV0aGVudGljYXRpb24iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQXV0ZW50aWNhY2nDs24gcmVxdWVyaWRhIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJIaWRkZW4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiT2N1bHRvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSZXF1aXJlcyBhbiBpbnZpdGF0aW9uIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlJlcXVpZXJlIHVuYSBpbnZpdGFjacOzbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTW9kZXJhdGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk1vZGVyYWRvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJOb24tYW5vbnltb3VzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk5vIGFuw7NuaW1vIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJPcGVuIHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQWJyaXIgc2FsYSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUGVybWFuZW50IHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU2FsYSBwZXJtYW5lbnRlIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJQdWJsaWMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiUHVibGljbyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU2VtaS1hbm9ueW1vdXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU2VtaSBhbsOzbmltbyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGVtcG9yYXJ5IHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU2FsYSB0ZW1wb3JhbCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVW5tb2RlcmF0ZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU2luIG1vZGVyYXIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJvb21zIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlNhbGFzIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSb29tIG5hbWUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTm9tYnJlIGRlIHNhbGEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk5pY2tuYW1lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkFwb2RvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTZXJ2ZXIiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU2Vydmlkb3IiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkpvaW4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVW5pcnNlIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTaG93IHJvb21zIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk1vc3RyYXIgc2FsYXMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk5vIHJvb21zIG9uICUxJHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU2luIHNhbGFzIGVuICUxJHMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJvb21zIG9uICUxJHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU2FsYXMgZW4gJTEkcyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU2V0IGNoYXRyb29tIHRvcGljIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkRlZmluaXIgdGVtYSBkZSBzYWxhIGRlIGNoYXQiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIktpY2sgdXNlciBmcm9tIGNoYXRyb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkV4cHVsc2FyIHVzdWFyaW8gZGUgc2FsYSBkZSBjaGF0LiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQmFuIHVzZXIgZnJvbSBjaGF0cm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJCbG9xdWVhciB1c3VhcmlvIGRlIHNhbGEgZGUgY2hhdC4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk1lc3NhZ2UiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTWVuc2FqZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU2F2ZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJHdWFyZGFyIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDYW5jZWwiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQ2FuY2VsYXIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkFuIGVycm9yIG9jY3VycmVkIHdoaWxlIHRyeWluZyB0byBzYXZlIHRoZSBmb3JtLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJVbiBlcnJvciBvY3VycsOtbyBtaWVudHJhcyBzZSBndWFyZGFiYSBlbCBmb3JtdWxhcmlvLiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyBjaGF0cm9vbSByZXF1aXJlcyBhIHBhc3N3b3JkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkVzdGEgc2FsYSBkZSBjaGF0IHJlcXVpZXJlIHVuYSBjb250cmFzZcOxYS4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlBhc3N3b3JkOiAiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQ29udHJhc2XDsWE6ICIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU3VibWl0IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkVudmlhciIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyByb29tIGlzIG5vdCBhbm9ueW1vdXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRXN0YSBzYWxhIG5vIGVzIHBhcmEgdXN1YXJpb3MgYW7Ds25pbW9zIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gbm93IHNob3dzIHVuYXZhaWxhYmxlIG1lbWJlcnMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRXN0YSBzYWxhIGFob3JhIG11ZXN0cmEgbG9zIG1pZW1icm9zIG5vIGRpc3BvbmlibGVzIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gZG9lcyBub3Qgc2hvdyB1bmF2YWlsYWJsZSBtZW1iZXJzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkVzdGEgc2FsYSBubyBtdWVzdHJhIGxvcyBtaWVtYnJvcyBubyBkaXNwb25pYmxlcyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTm9uLXByaXZhY3ktcmVsYXRlZCByb29tIGNvbmZpZ3VyYXRpb24gaGFzIGNoYW5nZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVW5hIGNvbmZpZ3VyYWNpw7NuIGRlIGxhIHNhbGEgbm8gcmVsYWNpb25hZGEgY29uIGxhIHByaXZhY2lkYWQgaGEgc2lkbyBjYW1iaWFkYSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUm9vbSBsb2dnaW5nIGlzIG5vdyBlbmFibGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkVsIHJlZ2lzdHJvIGRlIGxhIHNhbGEgYWhvcmEgZXN0w6EgaGFiaWxpdGFkbyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUm9vbSBsb2dnaW5nIGlzIG5vdyBkaXNhYmxlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJFbCByZWdpc3RybyBkZSBsYSBzYWxhIGFob3JhIGVzdMOhIGRlc2hhYmlsaXRhZG8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBpcyBub3cgbm9uLWFub255bW91cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJFc3RhIHNhbGEgYWhvcmEgZXMgcMO6YmxpY2EiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBpcyBub3cgc2VtaS1hbm9ueW1vdXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRXN0YSBzYWxhIGFob3JhIGVzIHNlbWktYW7Ds25pbWEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBpcyBub3cgZnVsbHktYW5vbnltb3VzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkVzdGEgc2FsYSBhaG9yYSBlcyBjb21wbGV0YW1lbnRlIGFuw7NuaW1hIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJBIG5ldyByb29tIGhhcyBiZWVuIGNyZWF0ZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVW5hIG51ZXZhIHNhbGEgaGEgc2lkbyBjcmVhZGEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgbmlja25hbWUgaGFzIGJlZW4gY2hhbmdlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTdSBhcG9kbyBoYSBzaWRvIGNhbWJpYWRvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gaGFzIGJlZW4gYmFubmVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIjxzdHJvbmc+JTEkczwvc3Ryb25nPiBoYSBzaWRvIGJsb3F1ZWFkbyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IGhhcyBiZWVuIGtpY2tlZCBvdXQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IGhhIHNpZG8gZXhwdWxzYWRvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gaGFzIGJlZW4gcmVtb3ZlZCBiZWNhdXNlIG9mIGFuIGFmZmlsaWF0aW9uIGNoYW5nZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gaGEgc2lkbyBlbGltaW5hZG8gZGViaWRvIGEgdW4gY2FtYmlvIGRlIGFmaWxpYWNpw7NuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gaGFzIGJlZW4gcmVtb3ZlZCBmb3Igbm90IGJlaW5nIGEgbWVtYmVyIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIjxzdHJvbmc+JTEkczwvc3Ryb25nPiBoYSBzaWRvIGVsaW1pbmFkbyBkZWJpZG8gYSBxdWUgbm8gZXMgbWllbWJybyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91IGhhdmUgYmVlbiBiYW5uZWQgZnJvbSB0aGlzIHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVXN0ZWQgaGEgc2lkbyBibG9xdWVhZG8gZGUgZXN0YSBzYWxhIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3UgaGF2ZSBiZWVuIGtpY2tlZCBmcm9tIHRoaXMgcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJVc3RlZCBoYSBzaWRvIGV4cHVsc2FkbyBkZSBlc3RhIHNhbGEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdSBoYXZlIGJlZW4gcmVtb3ZlZCBmcm9tIHRoaXMgcm9vbSBiZWNhdXNlIG9mIGFuIGFmZmlsaWF0aW9uIGNoYW5nZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJVc3RlZCBoYSBzaWRvIGVsaW1pbmFkbyBkZSBlc3RhIHNhbGEgZGViaWRvIGEgdW4gY2FtYmlvIGRlIGFmaWxpYWNpw7NuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3UgaGF2ZSBiZWVuIHJlbW92ZWQgZnJvbSB0aGlzIHJvb20gYmVjYXVzZSB0aGUgcm9vbSBoYXMgY2hhbmdlZCB0byBtZW1iZXJzLW9ubHkgYW5kIHlvdSdyZSBub3QgYSBtZW1iZXIiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVXN0ZWQgaGEgc2lkbyBlbGltaW5hZG8gZGUgZXN0YSBzYWxhIGRlYmlkbyBhIHF1ZSBsYSBzYWxhIGNhbWJpbyBzdSBjb25maWd1cmFjacOzbiBhIHNvbG8tbWllbWJyb3MgeSB1c3RlZCBubyBlcyB1biBtaWVtYnJvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3UgaGF2ZSBiZWVuIHJlbW92ZWQgZnJvbSB0aGlzIHJvb20gYmVjYXVzZSB0aGUgTVVDIChNdWx0aS11c2VyIGNoYXQpIHNlcnZpY2UgaXMgYmVpbmcgc2h1dCBkb3duLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJVc3RlZCBoYSBzaWRvIGVsaW1pbmFkbyBkZSBlc3RhIHNhbGEgZGViaWRvIGEgcXVlIGVsIHNlcnZpY2lvIE1VQyAoTXVsdGktdXNlciBjaGF0KSBlc3TDoSBkZXNoYWJpbGl0YWRvLiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91IGFyZSBub3Qgb24gdGhlIG1lbWJlciBsaXN0IG9mIHRoaXMgcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJVc3RlZCBubyBlc3TDoSBlbiBsYSBsaXN0YSBkZSBtaWVtYnJvcyBkZSBlc3RhIHNhbGEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk5vIG5pY2tuYW1lIHdhcyBzcGVjaWZpZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU2luIGFwb2RvIGVzcGVjaWZpY2FkbyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91IGFyZSBub3QgYWxsb3dlZCB0byBjcmVhdGUgbmV3IHJvb21zIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlVzdGVkIG5vIGVzdGEgYXV0b3JpemFkbyBwYXJhIGNyZWFyIG51ZXZhcyBzYWxhcyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBuaWNrbmFtZSBkb2Vzbid0IGNvbmZvcm0gdG8gdGhpcyByb29tJ3MgcG9saWNpZXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU3UgYXBvZG8gbm8gc2UgYWp1c3RhIGEgbGEgcG9sw610aWNhIGRlIGVzdGEgc2FsYSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBuaWNrbmFtZSBpcyBhbHJlYWR5IHRha2VuIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlN1IGFwb2RvIHlhIGhhIHNpZG8gdG9tYW5kbyBwb3Igb3RybyB1c3VhcmlvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gZG9lcyBub3QgKHlldCkgZXhpc3QiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRXN0YSBzYWxhIChhw7puKSBubyBleGlzdGUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBoYXMgcmVhY2hlZCBpdCdzIG1heGltdW0gbnVtYmVyIG9mIG9jY3VwYW50cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJFc3RhIHNhbGEgaGEgYWxjYW56YWRvIHN1IG7Dum1lcm8gbcOheGltbyBkZSBvY3VwYW50ZXMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRvcGljIHNldCBieSAlMSRzIHRvOiAlMiRzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlRlbWEgZmlqYWRvIHBvciAlMSRzIGE6ICUyJHMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgdXNlciBpcyBhIG1vZGVyYXRvciI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJFc3RlIHVzdWFyaW8gZXMgdW4gbW9kZXJhZG9yIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHVzZXIgY2FuIHNlbmQgbWVzc2FnZXMgaW4gdGhpcyByb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkVzdGUgdXN1YXJpbyBwdWVkZSBlbnZpYXIgbWVuc2FqZXMgZW4gZXN0YSBzYWxhIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHVzZXIgY2FuIE5PVCBzZW5kIG1lc3NhZ2VzIGluIHRoaXMgcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJFc3RlIHVzdWFyaW8gTk8gcHVlZGUgZW52aWFyIG1lbnNhamVzIGVuIGVzdGEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNsaWNrIHRvIGNoYXQgd2l0aCB0aGlzIGNvbnRhY3QiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSGFnYSBjbGljayBwYXJhIGNvbnZlcnNhciBjb24gZXN0ZSBjb250YWN0byIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgdG8gcmVtb3ZlIHRoaXMgY29udGFjdCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJIYWdhIGNsaWNrIHBhcmEgZWxpbWluYXIgZXN0ZSBjb250YWN0byIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyBjb250YWN0IGlzIGJ1c3kiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRXN0ZSBjb250YWN0byBlc3TDoSBvY3VwYWRvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIGNvbnRhY3QgaXMgb25saW5lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkVzdGUgY29udGFjdG8gZXN0w6EgZW4gbMOtbmVhIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIGNvbnRhY3QgaXMgb2ZmbGluZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJFc3RlIGNvbnRhY3RvIGVzdMOhIGRlc2NvbmVjdGFkbyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyBjb250YWN0IGlzIHVuYXZhaWxhYmxlIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkVzdGUgY29udGFjdG8gbm8gZXN0w6EgZGlzcG9uaWJsZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyBjb250YWN0IGlzIGF3YXkgZm9yIGFuIGV4dGVuZGVkIHBlcmlvZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJFc3RlIGNvbnRhY3RvIGVzdMOhIGF1c2VudGUgcG9yIHVuIGxhcmdvIHBlcmlvZG8gZGUgdGllbXBvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIGNvbnRhY3QgaXMgYXdheSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJFc3RlIGNvbnRhY3RvIGVzdMOhIGF1c2VudGUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNvbnRhY3QgcmVxdWVzdHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU29saWNpdHVkZXMgZGUgY29udGFjdG8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk15IGNvbnRhY3RzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk1pcyBjb250YWN0b3MiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlBlbmRpbmcgY29udGFjdHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQ29udGFjdG9zIHBlbmRpZW50ZXMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkN1c3RvbSBzdGF0dXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiUGVyc29uYWxpemFyIGVzdGF0dXMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNsaWNrIHRvIGNoYW5nZSB5b3VyIGNoYXQgc3RhdHVzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkhhZ2EgY2xpY2sgcGFyYSBjYW1iaWFyIHN1IGVzdGF0dXMgZGUgY2hhdCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgaGVyZSB0byB3cml0ZSBhIGN1c3RvbSBzdGF0dXMgbWVzc2FnZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJIYWdhIGNsaWNrIHBhcmEgZXNjcmliaXIgdW4gbWVuc2FqZSBkZSBlc3RhdHVzIHBlcnNvbmFsaXphZG8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIm9ubGluZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJlbiBsw61uZWEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgImJ1c3kiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAib2N1cGFkbyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiYXdheSBmb3IgbG9uZyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJhdXNlbnRlIHBvciBtdWNobyB0aWVtcG8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgImF3YXkiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiYXVzZW50ZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiSSBhbSAlMSRzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkVzdG95ICUxJHMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNpZ24gaW4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiUmVnaXN0cmFyIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJYTVBQL0phYmJlciBVc2VybmFtZToiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTm9tYnJlIGRlIHVzdWFyaW8gWE1QUC9KYWJiZXIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlBhc3N3b3JkOiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDb250cmFzZcOxYToiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkxvZyBJbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJJbmljaWFyIHNlc2nDs24iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkJPU0ggU2VydmljZSBVUkw6IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlVSTCBkZWwgc2VydmljaW8gQk9TSDoiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk9ubGluZSBDb250YWN0cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJFbiBsw61uZWEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNvbm5lY3RlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDb25lY3RhZG8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkF0dGFjaGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkFkanVudGFkbyIKICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7CiAgICAgICAgZGVmaW5lKCJlcyIsIFsnamVkJ10sIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkobmV3IEplZCh0cmFuc2xhdGlvbnMpKTsKICAgICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKCF3aW5kb3cubG9jYWxlcykgewogICAgICAgICAgICB3aW5kb3cubG9jYWxlcyA9IHt9OwogICAgICAgIH0KICAgICAgICB3aW5kb3cubG9jYWxlcy5lcyA9IGZhY3RvcnkobmV3IEplZCh0cmFuc2xhdGlvbnMpKTsKICAgIH0KfSh0aGlzLCBmdW5jdGlvbiAoZXMpIHsgCiAgICByZXR1cm4gZXM7IAp9KSk7CgooZnVuY3Rpb24gKHJvb3QsIGZhY3RvcnkpIHsKICAgIHZhciB0cmFuc2xhdGlvbnMgPSB7CiAgICAgICAgImRvbWFpbiI6ICJjb252ZXJzZSIsCiAgICAgICAgImxvY2FsZV9kYXRhIjogewogICAgICAgICAgICAiY29udmVyc2UiOiB7CiAgICAgICAgICAgICAgICAiIjogewogICAgICAgICAgICAgICAgICAgICJQcm9qZWN0LUlkLVZlcnNpb24iOiAiQ29udmVyc2UuanMgMC40IiwKICAgICAgICAgICAgICAgICAgICAiUmVwb3J0LU1zZ2lkLUJ1Z3MtVG8iOiAiIiwKICAgICAgICAgICAgICAgICAgICAiUE9ULUNyZWF0aW9uLURhdGUiOiAiMjAxMy0wOS0xNSAyMTo1NSswMjAwIiwKICAgICAgICAgICAgICAgICAgICAiUE8tUmV2aXNpb24tRGF0ZSI6ICIyMDEzLTA5LTE1IDIxOjU4KzAyMDAiLAogICAgICAgICAgICAgICAgICAgICJMYW5ndWFnZS1UZWFtIjogIkZSIDxMTEBsaS5vcmc+IiwKICAgICAgICAgICAgICAgICAgICAiTGFuZ3VhZ2UiOiAiZnIiLAogICAgICAgICAgICAgICAgICAgICJNSU1FLVZlcnNpb24iOiAiMS4wIiwKICAgICAgICAgICAgICAgICAgICAiQ29udGVudC1UeXBlIjogInRleHQvcGxhaW47IGNoYXJzZXQ9VVRGLTgiLAogICAgICAgICAgICAgICAgICAgICJDb250ZW50LVRyYW5zZmVyLUVuY29kaW5nIjogIjhiaXQiLAogICAgICAgICAgICAgICAgICAgICJQbHVyYWwtRm9ybXMiOiAibnBsdXJhbHM9MjsgcGx1cmFsPShuICE9IDEpOyIsCiAgICAgICAgICAgICAgICAgICAgInBsdXJhbF9mb3JtcyI6ICJucGx1cmFscz0yOyBwbHVyYWw9KG4gIT0gMSk7IiwKICAgICAgICAgICAgICAgICAgICAibGFuZyI6ICJmciIsCiAgICAgICAgICAgICAgICAgICAgIkxhbmd1YWdlLUNvZGUiOiAiZnIiLAogICAgICAgICAgICAgICAgICAgICJQcmVmZXJyZWQtRW5jb2RpbmdzIjogInV0Zi04IGxhdGluMSIsCiAgICAgICAgICAgICAgICAgICAgIkRvbWFpbiI6ICJjb252ZXJzZSIsCiAgICAgICAgICAgICAgICAgICAgImRvbWFpbiI6ICJjb252ZXJzZSIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAidW5lbmNyeXB0ZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJ1bnZlcmlmaWVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAidmVyaWZpZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJmaW5pc2hlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkRpc2Nvbm5lY3RlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJEw6ljb25uZWN0w6kiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkVycm9yIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkVycmV1ciIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ29ubmVjdGluZyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDb25uZWN0aW9uIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb25uZWN0aW9uIEZhaWxlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJMYSBjb25uZWN0aW9uIGEgw6ljaG91w6kiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkF1dGhlbnRpY2F0aW5nIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkF1dGhlbnRpZmljYXRpb24iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkF1dGhlbnRpY2F0aW9uIEZhaWxlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJMJ2F1dGhlbnRpZmljYXRpb24gYSDDqWNob3XDqSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiRGlzY29ubmVjdGluZyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJEw6ljb25uZWN0aW9uIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSZS1lc3RhYmxpc2hpbmcgZW5jcnlwdGVkIHNlc3Npb24iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIGJyb3dzZXIgbmVlZHMgdG8gZ2VuZXJhdGUgYSBwcml2YXRlIGtleSwgd2hpY2ggd2lsbCBiZSB1c2VkIGluIHlvdXIgZW5jcnlwdGVkIGNoYXQgc2Vzc2lvbi4gVGhpcyBjYW4gdGFrZSB1cCB0byAzMCBzZWNvbmRzIGR1cmluZyB3aGljaCB5b3VyIGJyb3dzZXIgbWlnaHQgZnJlZXplIGFuZCBiZWNvbWUgdW5yZXNwb25zaXZlLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlByaXZhdGUga2V5IGdlbmVyYXRlZC4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJBdXRoZW50aWNhdGlvbiByZXF1ZXN0IGZyb20gJTEkc1xuXG5Zb3VyIGJ1ZGR5IGlzIGF0dGVtcHRpbmcgdG8gdmVyaWZ5IHlvdXIgaWRlbnRpdHksIGJ5IGFza2luZyB5b3UgdGhlIHF1ZXN0aW9uIGJlbG93LlxuXG4lMiRzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ291bGQgbm90IHZlcmlmeSB0aGlzIHVzZXIncyBpZGVudGlmeS4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJQZXJzb25hbCBtZXNzYWdlIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk1lc3NhZ2UgcGVyc29ubmVsIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTdGFydCBlbmNyeXB0ZWQgY29udmVyc2F0aW9uIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUmVmcmVzaCBlbmNyeXB0ZWQgY29udmVyc2F0aW9uIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiRW5kIGVuY3J5cHRlZCBjb252ZXJzYXRpb24iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJWZXJpZnkgd2l0aCBTTVAiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJWZXJpZnkgd2l0aCBmaW5nZXJwcmludHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJXaGF0J3MgdGhpcz8iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJtZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNob3cgdGhpcyBtZW51IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkFmZmljaGVyIGNlIG1lbnUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIldyaXRlIGluIHRoZSB0aGlyZCBwZXJzb24iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiw4ljcmlyZSDDoCBsYSB0cm9pc2nDqG1lIHBlcnNvbm5lIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSZW1vdmUgbWVzc2FnZXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRWZmYWNlciBsZXMgbWVzc2FnZXMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgbWVzc2FnZSBjb3VsZCBub3QgYmUgc2VudCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIldlIHJlY2VpdmVkIGFuIHVuZW5jcnlwdGVkIG1lc3NhZ2UiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJXZSByZWNlaXZlZCBhbiB1bnJlYWRhYmxlIGVuY3J5cHRlZCBtZXNzYWdlIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyB1c2VyIGhhcyByZXF1ZXN0ZWQgYW4gZW5jcnlwdGVkIHNlc3Npb24uIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiSGVyZSBhcmUgdGhlIGZpbmdlcnByaW50cywgcGxlYXNlIGNvbmZpcm0gdGhlbSB3aXRoICUxJHMsIG91dHNpZGUgb2YgdGhpcyBjaGF0LlxuXG5GaW5nZXJwcmludCBmb3IgeW91LCAlMiRzOiAlMyRzXG5cbkZpbmdlcnByaW50IGZvciAlMSRzOiAlNCRzXG5cbklmIHlvdSBoYXZlIGNvbmZpcm1lZCB0aGF0IHRoZSBmaW5nZXJwcmludHMgbWF0Y2gsIGNsaWNrIE9LLCBvdGhlcndpc2UgY2xpY2sgQ2FuY2VsLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdSB3aWxsIGJlIHByb21wdGVkIHRvIHByb3ZpZGUgYSBzZWN1cml0eSBxdWVzdGlvbiBhbmQgdGhlbiBhbiBhbnN3ZXIgdG8gdGhhdCBxdWVzdGlvbi5cblxuWW91ciBidWRkeSB3aWxsIHRoZW4gYmUgcHJvbXB0ZWQgdGhlIHNhbWUgcXVlc3Rpb24gYW5kIGlmIHRoZXkgdHlwZSB0aGUgZXhhY3Qgc2FtZSBhbnN3ZXIgKGNhc2Ugc2Vuc2l0aXZlKSwgdGhlaXIgaWRlbnRpdHkgd2lsbCBoYXZlIGJlZW4gdmVyaWZpZWQuIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiV2hhdCBpcyB5b3VyIHNlY3VyaXR5IHF1ZXN0aW9uPyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIldoYXQgaXMgdGhlIGFuc3dlciB0byB0aGUgc2VjdXJpdHkgcXVlc3Rpb24/IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiSW52YWxpZCBhdXRoZW50aWNhdGlvbiBzY2hlbWUgcHJvdmlkZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG1lc3NhZ2VzIGFyZSBub3QgZW5jcnlwdGVkIGFueW1vcmUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG1lc3NhZ2VzIGFyZSBub3cgZW5jcnlwdGVkIGJ1dCB5b3VyIGJ1ZGR5J3MgaWRlbnRpdHkgaGFzIG5vdCBiZWVuIHZlcmlmaWVkLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgYnVkZHkncyBpZGVudGlmeSBoYXMgYmVlbiB2ZXJpZmllZC4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIGJ1ZGR5IGhhcyBlbmRlZCBlbmNyeXB0aW9uIG9uIHRoZWlyIGVuZCwgeW91IHNob3VsZCBkbyB0aGUgc2FtZS4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG1lc3NhZ2VzIGFyZSBub3QgZW5jcnlwdGVkLiBDbGljayBoZXJlIHRvIGVuYWJsZSBPVFIgZW5jcnlwdGlvbi4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG1lc3NhZ2VzIGFyZSBlbmNyeXB0ZWQsIGJ1dCB5b3VyIGJ1ZGR5IGhhcyBub3QgYmVlbiB2ZXJpZmllZC4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG1lc3NhZ2VzIGFyZSBlbmNyeXB0ZWQgYW5kIHlvdXIgYnVkZHkgdmVyaWZpZWQuIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBidWRkeSBoYXMgY2xvc2VkIHRoZWlyIGVuZCBvZiB0aGUgcHJpdmF0ZSBzZXNzaW9uLCB5b3Ugc2hvdWxkIGRvIHRoZSBzYW1lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ29udGFjdHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQ29udGFjdHMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk9ubGluZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJFbiBsaWduZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQnVzeSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJPY2N1cMOpIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJBd2F5IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkFic2VudCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiT2ZmbGluZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJEw6ljb25uZWN0w6kiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNsaWNrIHRvIGFkZCBuZXcgY2hhdCBjb250YWN0cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDbGlxdWV6IHBvdXIgYWpvdXRlciBkZSBub3V2ZWF1eCBjb250YWN0cyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQWRkIGEgY29udGFjdCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJBam91dGVyIHVuIGNvbnRhY3QiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNvbnRhY3QgdXNlcm5hbWUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTm9tIGR1IGNvbnRhY3QiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkFkZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJBam91dGVyIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb250YWN0IG5hbWUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTm9tIGR1IGNvbnRhY3QiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNlYXJjaCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJSZWNoZXJjaGVyIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJObyB1c2VycyBmb3VuZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJBdWN1biB1dGlsaXNhdGV1ciB0cm91dsOpIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDbGljayB0byBhZGQgYXMgYSBjaGF0IGNvbnRhY3QiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQ2xpcXVlciBwb3VyIGFqb3V0ZXIgYXV4IGNvbnRhY3RzIGRlIGNoYXQiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNsaWNrIHRvIG9wZW4gdGhpcyByb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkNsaXF1ZXIgcG91ciBvdXZyaXIgY2Ugc2Fsb24iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNob3cgbW9yZSBpbmZvcm1hdGlvbiBvbiB0aGlzIHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQWZmaWNoZXIgZGF2YW50YWdlIGQnaW5mb3JtYXRpb25zIHN1ciBjZSBzYWxvbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiRGVzY3JpcHRpb246IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkRlc2NyaXB0aW9uIDoiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk9jY3VwYW50czoiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiUGFydGljaXBhbnRzIDoiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkZlYXR1cmVzOiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDYXJhY3TDqXJpc3RpcXVlcyA6IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSZXF1aXJlcyBhdXRoZW50aWNhdGlvbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJOw6ljZXNzaXRlIHVuZSBhdXRoZW50aWZpY2F0aW9uIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJIaWRkZW4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTWFzcXXDqSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUmVxdWlyZXMgYW4gaW52aXRhdGlvbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJOw6ljZXNzaXRlIHVuZSBpbnZpdGF0aW9uIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJNb2RlcmF0ZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTW9kw6lyw6kiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk5vbi1hbm9ueW1vdXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTm9uLWFub255bWUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk9wZW4gcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJPdXZyaXIgdW4gc2Fsb24iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlBlcm1hbmVudCByb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlNhbG9uIHBlcm1hbmVudCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUHVibGljIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlB1YmxpYyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU2VtaS1hbm9ueW1vdXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU2VtaS1hbm9ueW1lIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUZW1wb3Jhcnkgcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTYWxvbiB0ZW1wb3JhaXJlIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJVbm1vZGVyYXRlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJOb24gbW9kw6lyw6kiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJvb21zIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlNhbG9ucyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUm9vbSBuYW1lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk51bcOpcm8gZGUgc2Fsb24iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk5pY2tuYW1lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkFsaWFzIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTZXJ2ZXIiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU2VydmV1ciIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiSm9pbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJSZWpvaW5kcmUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNob3cgcm9vbXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQWZmaWNoZXIgbGVzIHNhbG9ucyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTm8gcm9vbXMgb24gJTEkcyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJBdWN1biBzYWxvbiBkYW5zICUxJHMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJvb21zIG9uICUxJHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU2Fsb25zIGRhbnMgJTEkcyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU2V0IGNoYXRyb29tIHRvcGljIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkluZGlxdWVyIGxlIHN1amV0IGR1IHNhbG9uIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJLaWNrIHVzZXIgZnJvbSBjaGF0cm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJFeHB1bHNlciBsJ3V0aWxpc2F0ZXVyIGR1IHNhbG9uLiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQmFuIHVzZXIgZnJvbSBjaGF0cm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJCYW5uaXIgbCd1dGlsaXNhdGV1ciBkdSBzYWxvbi4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk1lc3NhZ2UiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTWVzc2FnZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU2F2ZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJFbnJlZ2lzdHJlciIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ2FuY2VsIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkFubnVsZXIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkFuIGVycm9yIG9jY3VycmVkIHdoaWxlIHRyeWluZyB0byBzYXZlIHRoZSBmb3JtLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJVbmUgZXJyZXVyIGVzdCBzdXJ2ZW51ZSBsb3JzIGRlIGwnZW5yZWdpc3RyZW1lbnQgZHUgZm9ybXVsYWlyZS4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgY2hhdHJvb20gcmVxdWlyZXMgYSBwYXNzd29yZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDZSBzYWxvbiBuw6ljZXNzaXRlIHVuIG1vdCBkZSBwYXNzZS4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlBhc3N3b3JkOiAiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTW90IGRlIHBhc3NlIDogIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTdWJtaXQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU291bWV0dHJlIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gaXMgbm90IGFub255bW91cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDZSBzYWxvbiBuJ2VzdCBwYXMgYW5vbnltZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyByb29tIG5vdyBzaG93cyB1bmF2YWlsYWJsZSBtZW1iZXJzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkNlIHNhbG9uIGFmZmljaGUgbWFpbnRlbmFudCBkZXMgbWVtYnJlcyBpbmRpc3BvbmlibGVzIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gZG9lcyBub3Qgc2hvdyB1bmF2YWlsYWJsZSBtZW1iZXJzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkNlIHNhbG9uIG4nYWZmaWNoZSBwYXMgbGVzIG1lbWJyZXMgaW5kaXNwb25pYmxlcyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTm9uLXByaXZhY3ktcmVsYXRlZCByb29tIGNvbmZpZ3VyYXRpb24gaGFzIGNoYW5nZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTGVzIHBhcmFtw6h0cmVzIGR1IHNhbG9uIG5vbiBsacOpcyDDoCBsYSBjb25maWRlbnRpYWxpdMOpIG9udCDDqXTDqSBtb2RpZmnDqXMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJvb20gbG9nZ2luZyBpcyBub3cgZW5hYmxlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJMZSBsb2dnaW5nIGR1IHNhbG9uIGVzdCBhY3RpdsOpIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSb29tIGxvZ2dpbmcgaXMgbm93IGRpc2FibGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkxlIGxvZ2dpbmcgZHUgc2Fsb24gZXN0IGTDqXNhY3RpdsOpIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gaXMgbm93IG5vbi1hbm9ueW1vdXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQ2Ugc2Fsb24gZXN0IG1haW50ZW5hbnQgbm9uLWFub255bWUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBpcyBub3cgc2VtaS1hbm9ueW1vdXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQ2Ugc2Fsb24gZXN0IG1haW50ZW5hbnQgc2VtaS1hbm9ueW1lIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gaXMgbm93IGZ1bGx5LWFub255bW91cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDZSBzYWxvbiBlc3QgbWFpbnRlbmFudCBlbnRpw6hyZW1lbnQgYW5vbnltZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQSBuZXcgcm9vbSBoYXMgYmVlbiBjcmVhdGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlVuIG5vdXZlYXUgc2Fsb24gYSDDqXTDqSBjcsOpw6kiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgbmlja25hbWUgaGFzIGJlZW4gY2hhbmdlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJWb3RyZSBhbGlhcyBhIMOpdMOpIG1vZGlmacOpIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gaGFzIGJlZW4gYmFubmVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIjxzdHJvbmc+JTEkczwvc3Ryb25nPiBhIMOpdMOpIGJhbm5pIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gaGFzIGJlZW4ga2lja2VkIG91dCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gYSDDqXTDqSBleHB1bHPDqSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IGhhcyBiZWVuIHJlbW92ZWQgYmVjYXVzZSBvZiBhbiBhZmZpbGlhdGlvbiBjaGFuZ2UiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IGEgw6l0w6kgc3VwcHJpbcOpIMOgIGNhdXNlIGQndW4gY2hhbmdlbWVudCBkJ2FmZmlsaWF0aW9uIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gaGFzIGJlZW4gcmVtb3ZlZCBmb3Igbm90IGJlaW5nIGEgbWVtYmVyIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIjxzdHJvbmc+JTEkczwvc3Ryb25nPiBhIMOpdMOpIHN1cHByaW3DqSBjYXIgaWwgbidlc3QgcGFzIG1lbWJyZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91IGhhdmUgYmVlbiBiYW5uZWQgZnJvbSB0aGlzIHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVm91cyBhdmV6IMOpdMOpIGJhbm5pIGRlIGNlIHNhbG9uIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3UgaGF2ZSBiZWVuIGtpY2tlZCBmcm9tIHRoaXMgcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJWb3VzIGF2ZXogw6l0w6kgZXhwdWxzw6kgZGUgY2Ugc2Fsb24iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdSBoYXZlIGJlZW4gcmVtb3ZlZCBmcm9tIHRoaXMgcm9vbSBiZWNhdXNlIG9mIGFuIGFmZmlsaWF0aW9uIGNoYW5nZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJWb3VzIGF2ZXogw6l0w6kgcmV0aXLDqSBkZSBjZSBzYWxvbiBkdSBmYWl0IGQndW4gY2hhbmdlbWVudCBkJ2FmZmlsaWF0aW9uIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3UgaGF2ZSBiZWVuIHJlbW92ZWQgZnJvbSB0aGlzIHJvb20gYmVjYXVzZSB0aGUgcm9vbSBoYXMgY2hhbmdlZCB0byBtZW1iZXJzLW9ubHkgYW5kIHlvdSdyZSBub3QgYSBtZW1iZXIiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVm91cyBhdmV6IMOpdMOpIHJldGlyw6kgZGUgY2Ugc2Fsb24gcGFyY2UgcXVlIGNlIHNhbG9uIGVzdCBkZXZlbnUgcsOpc2VydsOpIGF1eCBtZW1icmVzIGV0IHZvdXMgbifDqnRlcyBwYXMgbWVtYnJlIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3UgaGF2ZSBiZWVuIHJlbW92ZWQgZnJvbSB0aGlzIHJvb20gYmVjYXVzZSB0aGUgTVVDIChNdWx0aS11c2VyIGNoYXQpIHNlcnZpY2UgaXMgYmVpbmcgc2h1dCBkb3duLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJWb3VzIGF2ZXogw6l0w6kgcmV0aXLDqSBkZSBjZSBzYWxvbiBwYXJjZSBxdWUgbGUgc2VydmljZSBkZSBjaGF0IG11bHRpLXV0aWxpc2F0ZXVyIGEgw6l0w6kgZMOpc2FjdGl2w6kuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3UgYXJlIG5vdCBvbiB0aGUgbWVtYmVyIGxpc3Qgb2YgdGhpcyByb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlZvdXMgbifDqnRlcyBwYXMgZGFucyBsYSBsaXN0ZSBkZXMgbWVtYnJlcyBkZSBjZSBzYWxvbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTm8gbmlja25hbWUgd2FzIHNwZWNpZmllZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJBdWN1biBhbGlhcyBuJ2Egw6l0w6kgaW5kaXF1w6kiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdSBhcmUgbm90IGFsbG93ZWQgdG8gY3JlYXRlIG5ldyByb29tcyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJWb3VzIG4nw6p0ZXMgcGFzIGF1dG9yaXPDqSDDoCBjcsOpZXIgZGVzIHNhbG9ucyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBuaWNrbmFtZSBkb2Vzbid0IGNvbmZvcm0gdG8gdGhpcyByb29tJ3MgcG9saWNpZXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVm90cmUgYWxpYXMgbidlc3QgcGFzIGNvbmZvcm1lIMOgIGxhIHBvbGl0aXF1ZSBkZSBjZSBzYWxvbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBuaWNrbmFtZSBpcyBhbHJlYWR5IHRha2VuIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlZvdHJlIGFsaWFzIGVzdCBkw6lqw6AgdXRpbGlzw6kiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBkb2VzIG5vdCAoeWV0KSBleGlzdCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDZSBzYWxvbiBuJ2V4aXN0ZSBwYXMgZW5jb3JlIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gaGFzIHJlYWNoZWQgaXQncyBtYXhpbXVtIG51bWJlciBvZiBvY2N1cGFudHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQ2Ugc2Fsb24gYSBhdHRlaW50IGxhIGxpbWl0ZSBtYXhpbWFsZSBkJ29jY3VwYW50cyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVG9waWMgc2V0IGJ5ICUxJHMgdG86ICUyJHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTGUgc3VqZXQgJyUxJHMnIGEgw6l0w6kgZMOpZmluaSBwYXIgJTIkcyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyB1c2VyIGlzIGEgbW9kZXJhdG9yIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkNldCB1dGlsaXNhdGV1ciBlc3QgbW9kw6lyYXRldXIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgdXNlciBjYW4gc2VuZCBtZXNzYWdlcyBpbiB0aGlzIHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQ2V0IHV0aWxpc2F0ZXVyIHBldXQgZW52b3llciBkZXMgbWVzc2FnZXMgZGFucyBjZSBzYWxvbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyB1c2VyIGNhbiBOT1Qgc2VuZCBtZXNzYWdlcyBpbiB0aGlzIHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQ2V0IHV0aWxpc2F0ZXVyIG5lIHBldXQgUEFTIGVudm95ZXIgZGUgbWVzc2FnZXMgZGFucyBjZSBzYWxvbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgdG8gY2hhdCB3aXRoIHRoaXMgY29udGFjdCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDbGlxdWV6IHBvdXIgZGlzY3V0ZXIgYXZlYyBjZSBjb250YWN0IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDbGljayB0byByZW1vdmUgdGhpcyBjb250YWN0IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkNsaXF1ZXogcG91ciBzdXBwcmltZXIgY2UgY29udGFjdCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyBjb250YWN0IGlzIGJ1c3kiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIGNvbnRhY3QgaXMgb25saW5lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyBjb250YWN0IGlzIG9mZmxpbmUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIGNvbnRhY3QgaXMgdW5hdmFpbGFibGUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQ2Ugc2Fsb24gYWZmaWNoZSBtYWludGVuYW50IGRlcyBtZW1icmVzIGluZGlzcG9uaWJsZXMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgY29udGFjdCBpcyBhd2F5IGZvciBhbiBleHRlbmRlZCBwZXJpb2QiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIGNvbnRhY3QgaXMgYXdheSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNvbnRhY3QgcmVxdWVzdHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRGVtYW5kZXMgZGUgY29udGFjdHMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk15IGNvbnRhY3RzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk1lcyBjb250YWN0cyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUGVuZGluZyBjb250YWN0cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDb250YWN0cyBlbiBhdHRlbnRlIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDdXN0b20gc3RhdHVzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlN0YXR1dCBwZXJzb25uZWwiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNsaWNrIHRvIGNoYW5nZSB5b3VyIGNoYXQgc3RhdHVzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkNsaXF1ZXogcG91ciBjaGFuZ2VyIHZvdHJlIHN0YXR1dCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgaGVyZSB0byB3cml0ZSBhIGN1c3RvbSBzdGF0dXMgbWVzc2FnZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDbGlxdWV6IGljaSBwb3VyIGluZGlxdWVyIHZvdHJlIHN0YXR1dCBwZXJzb25uZWwiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIm9ubGluZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJlbiBsaWduZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiYnVzeSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJvY2N1cMOpIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJhd2F5IGZvciBsb25nIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgImFic2VudCBwb3VyIHVuZSBsb25ndWUgZHVyw6llIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJhd2F5IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgImFic2VudCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiSSBhbSAlMSRzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkplIHN1aXMgJTEkcyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU2lnbiBpbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTJ2luc2NyaXJlIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJYTVBQL0phYmJlciBVc2VybmFtZToiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTm9tIGQndXRpbGlzYXRldXIgWE1QUC9KYWJiZXIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlBhc3N3b3JkOiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJNb3QgZGUgcGFzc2UgOiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTG9nIEluIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlNlIGNvbm5lY3RlciIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQk9TSCBTZXJ2aWNlIFVSTDoiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVVJMIGR1IHNlcnZpY2UgQk9TSDoiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk9ubGluZSBDb250YWN0cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDb250YWN0cyBlbiBsaWduZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ29ubmVjdGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkNvbm5lY3TDqSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQXR0YWNoZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQXR0YWNow6kiCiAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkgewogICAgICAgIGRlZmluZSgiZnIiLCBbJ2plZCddLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBmYWN0b3J5KG5ldyBKZWQodHJhbnNsYXRpb25zKSk7CiAgICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICAgIGlmICghd2luZG93LmxvY2FsZXMpIHsKICAgICAgICAgICAgd2luZG93LmxvY2FsZXMgPSB7fTsKICAgICAgICB9CiAgICAgICAgd2luZG93LmxvY2FsZXMuZnIgPSBmYWN0b3J5KG5ldyBKZWQodHJhbnNsYXRpb25zKSk7CiAgICB9Cn0odGhpcywgZnVuY3Rpb24gKGZyKSB7CiAgICByZXR1cm4gZnI7Cn0pKTsKCihmdW5jdGlvbiAocm9vdCwgZmFjdG9yeSkgewogICAgdmFyIHRyYW5zbGF0aW9ucyA9IHsKICAgICAgICAiZG9tYWluIjogImNvbnZlcnNlIiwKICAgICAgICAibG9jYWxlX2RhdGEiOiB7CiAgICAgICAgICAgICJjb252ZXJzZSI6IHsKICAgICAgICAgICAgICAgICIiOiB7CiAgICAgICAgICAgICAgICAgICAgInByb2plY3QtaWQtdmVyc2lvbiI6ICJDb252ZXJzZS5qcyAwLjguMSIsCiAgICAgICAgICAgICAgICAgICAgInJlcG9ydC1tc2dpZC1idWdzLXRvIjogIiIsCiAgICAgICAgICAgICAgICAgICAgInBvdC1jcmVhdGlvbi1kYXRlIjogIjIwMTQtMDgtMjUgMTQ6MzcrMDIwMCIsCiAgICAgICAgICAgICAgICAgICAgInBvLXJldmlzaW9uLWRhdGUiOiAiMjAxNC0wMi0yMSAwNjowNyswMjAwIiwKICAgICAgICAgICAgICAgICAgICAibGFzdC10cmFuc2xhdG9yIjogIkdyZWVuTHVuYXIgPEdyZWVuTHVuYXJAZ2l0aHViLmNvbT4iLAogICAgICAgICAgICAgICAgICAgICJsYW5ndWFnZS10ZWFtIjogIlJhaHV0IDxodHRwOi8vc291cmNlZm9yZ2UubmV0L3Byb2plY3RzL3JhaHV0Lz4iLAogICAgICAgICAgICAgICAgICAgICJsYW5ndWFnZSI6ICJoZSIsCiAgICAgICAgICAgICAgICAgICAgIm1pbWUtdmVyc2lvbiI6ICIxLjAiLAogICAgICAgICAgICAgICAgICAgICJjb250ZW50LXR5cGUiOiAidGV4dC9wbGFpbjsgY2hhcnNldD1VVEYtOCIsCiAgICAgICAgICAgICAgICAgICAgImNvbnRlbnQtdHJhbnNmZXItZW5jb2RpbmciOiAiOGJpdCIsCiAgICAgICAgICAgICAgICAgICAgIngtZ2VuZXJhdG9yIjogIlBvZWRpdCAxLjUuMSIsCiAgICAgICAgICAgICAgICAgICAgInBsdXJhbC1mb3JtcyI6ICJucGx1cmFscz0yOyBwbHVyYWw9KG4gIT0gMSk7IgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJ1bmVuY3J5cHRlZCI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsItec15Ag157Xldem16TXoNeqIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJ1bnZlcmlmaWVkIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15zXkCDXnteQ15XXnteq16oiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgInZlcmlmaWVkIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi157XkNeV157XqteqIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJmaW5pc2hlZCI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsItee15XXktee16jXqiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyBjb250YWN0IGlzIGJ1c3kiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXkNeZ16kg16fXqdeoINeW15Qg16LXodeV16ciCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgY29udGFjdCBpcyBvbmxpbmUiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXkNeZ16kg16fXqdeoINeW15Qg157Xp9eV15XXnyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyBjb250YWN0IGlzIG9mZmxpbmUiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXkNeZ16kg16fXqdeoINeW15Qg15zXkCDXnten15XXldefIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIGNvbnRhY3QgaXMgdW5hdmFpbGFibGUiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXkNeZ16kg16fXqdeoINeW15Qg15zXkCDXltee15nXnyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyBjb250YWN0IGlzIGF3YXkgZm9yIGFuIGV4dGVuZGVkIHBlcmlvZCI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteQ15nXqSDXp9ep16gg15bXlCDXoNei15PXqCDXnNee16nXmiDXltee158g157XnteV16nXmiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyBjb250YWN0IGlzIGF3YXkiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXkNeZ16kg16fXqdeoINeW15Qg15TXmdeg15Ug16DXoteT16giCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNsaWNrIHRvIGhpZGUgdGhlc2UgY29udGFjdHMiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXnNeX16Ug15vXk9eZINec15TXodeq15nXqCDXkNeqINeQ16DXqdeZINen16nXqCDXkNec15QiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk15IGNvbnRhY3RzIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15DXoNep15kg15TXp9ep16gg16nXnNeZIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJQZW5kaW5nIGNvbnRhY3RzIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15DXoNep15kg16fXqdeoINee157XqteZ16DXmdedIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb250YWN0IHJlcXVlc3RzIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15HXp9ep15XXqiDXkNeZ16kg16fXqdeoIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJVbmdyb3VwZWQiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXnNec15Ag16fXkdeV16bXlCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ29udGFjdHMiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXkNeg16nXmSDXp9ep16giCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkdyb3VwcyI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIten15HXldem15XXqiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUmVjb25uZWN0aW5nIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15vXoteqINee16rXl9eR16giCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkRpc2Nvbm5lY3RlZCI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsItee16DXldeq16ciCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkVycm9yIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi16nXkteZ15DXlCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ29ubmVjdGluZyI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteb16LXqiDXnteq15fXkdeoIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb25uZWN0aW9uIEZhaWxlZCI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteX15nXkdeV16gg16DXm9ep15wiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkF1dGhlbnRpY2F0aW5nIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15vXoteqINee15DXnteqIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJBdXRoZW50aWNhdGlvbiBGYWlsZWQiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXkNeZ157XldeqINeg15vXqdecIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJEaXNjb25uZWN0aW5nIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15vXoteqINee16rXoNeq16ciCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk9ubGluZSBDb250YWN0cyI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteQ16DXqdeZINen16nXqCDXnten15XXldeg15nXnSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUmUtZXN0YWJsaXNoaW5nIGVuY3J5cHRlZCBzZXNzaW9uIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15HXodehINee15fXk9epINeZ16nXmdeR15Qg157Xldem16TXoNeqIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJHZW5lcmF0aW5nIHByaXZhdGUga2V5LiI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteb16LXqiDXntek15nXpyDXntek16rXlyDXpNeo15jXmS4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgYnJvd3NlciBtaWdodCBiZWNvbWUgdW5yZXNwb25zaXZlLiI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteU15PXpNeT16TXnyDXqdec15og16LXqdeV15kg16nXnNeQINec15TXkteZ15EuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJBdXRoZW50aWNhdGlvbiByZXF1ZXN0IGZyb20gJTEkc1xuXG5Zb3VyIGJ1ZGR5IGlzIGF0dGVtcHRpbmcgdG8gdmVyaWZ5IHlvdXIgaWRlbnRpdHksIGJ5IGFza2luZyB5b3UgdGhlIHF1ZXN0aW9uIGJlbG93LlxuXG4lMiRzIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15HXp9ep16og15DXmdee15XXqiDXnteQ16ogJTEkc1xuXG7XlNeQ15nXqdeZ15XXqiDXqdeb16DXkteTINee16DXodeUINec15DXnteqINeQ16og15TXlteU15XXqiDXqdec15osINeR16LXlteo16og16nXkNeZ15zXqiDXqdeQ15zXlCDXnNeU15zXny5cblxuJTIkcyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ291bGQgbm90IHZlcmlmeSB0aGlzIHVzZXIncyBpZGVudGlmeS4iOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXnNeQINeU15nXqteUINeQ16TXqdeo15XXqiDXnNeQ157XqiDXkNeqINeW15TXldeqINee16nXqtee16kg15bXlC4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkV4Y2hhbmdpbmcgcHJpdmF0ZSBrZXkgd2l0aCBidWRkeS4iOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXntee15nXqCDXntek16rXlyDXpNeo15jXmSDXotedINeQ15nXqSDXp9ep16guIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJQZXJzb25hbCBtZXNzYWdlIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15TXldeT16LXlCDXkNeZ16nXmdeqIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gY2xlYXIgdGhlIG1lc3NhZ2VzIGZyb20gdGhpcyByb29tPyI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteU15DXnSDXkNeq15Qg15HXmNeV15cg15vXmSDXkdeo16bXldeg15og15zXmNeU16gg15DXqiDXlNeU15XXk9ei15XXqiDXnteq15XXmiDXl9eT16gg15bXlD8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIm1lIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15DXoNeZIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJpcyB0eXBpbmciOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXnten15zXmdeTL9eUINeb16LXqiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiaGFzIHN0b3BwZWQgdHlwaW5nIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15fXk9ecL9eUINee15zXlNen15zXmdeTIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTaG93IHRoaXMgbWVudSI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteU16bXkiDXkNeqINeq16TXqNeZ15gg15bXlCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiV3JpdGUgaW4gdGhlIHRoaXJkIHBlcnNvbiI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteb16rXldeRINeR15LXldejINeU16nXnNeZ16nXmSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUmVtb3ZlIG1lc3NhZ2VzIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15TXodeoINeU15XXk9ei15XXqiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIGNsZWFyIHRoZSBtZXNzYWdlcyBmcm9tIHRoaXMgY2hhdCBib3g/IjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15TXkNedINeQ16rXlCDXkdeY15XXlyDXm9eZINeR16jXpteV16DXmiDXnNeY15TXqCDXkNeqINeU15TXldeT16LXldeqINee16rXldeaINeq15nXkdeqINep15nXl9eUINeW15Q/IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG1lc3NhZ2UgY291bGQgbm90IGJlIHNlbnQiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXlNeU15XXk9ei15Qg16nXnNeaINec15Ag15TXmdeq15Qg15nXm9eV15zXlCDXnNeU15nXqdec15ciCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIldlIHJlY2VpdmVkIGFuIHVuZW5jcnlwdGVkIG1lc3NhZ2UiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXkNeg15fXoNeVINen15nXkdec16DXlSDXlNeV15PXoteUINec15Ag157Xldem16TXoNeqIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJXZSByZWNlaXZlZCBhbiB1bnJlYWRhYmxlIGVuY3J5cHRlZCBtZXNzYWdlIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15DXoNeX16DXlSDXp9eZ15HXnNeg15Ug15TXldeT16LXlCDXnteV16bXpNeg16og15zXkCDXp9eo15nXkNeUIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHVzZXIgaGFzIHJlcXVlc3RlZCBhbiBlbmNyeXB0ZWQgc2Vzc2lvbi4iOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXntep16rXntepINeW15Qg15HXmden16kg15nXqdeZ15HXlCDXnteV16bXpNeg16ouIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJIZXJlIGFyZSB0aGUgZmluZ2VycHJpbnRzLCBwbGVhc2UgY29uZmlybSB0aGVtIHdpdGggJTEkcywgb3V0c2lkZSBvZiB0aGlzIGNoYXQuXG5cbkZpbmdlcnByaW50IGZvciB5b3UsICUyJHM6ICUzJHNcblxuRmluZ2VycHJpbnQgZm9yICUxJHM6ICU0JHNcblxuSWYgeW91IGhhdmUgY29uZmlybWVkIHRoYXQgdGhlIGZpbmdlcnByaW50cyBtYXRjaCwgY2xpY2sgT0ssIG90aGVyd2lzZSBjbGljayBDYW5jZWwuIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15TXqNeZINeY15HXmdei15XXqiDXlNeQ16bXkdeiLCDXkNeg15Ag15DXnteqINeQ15XXqtefINei150gJTEkcywg157Xl9eV16Ug15zXqdeZ15fXlCDXlteVLlxuXG7XmNeR15nXoteqINeQ16bXkdeiINei15HXldeo15osICUyJHM6ICUzJHNcblxu15jXkdeZ16LXqiDXkNem15HXoiDXoteR15XXqCAlMSRzOiAlNCRzXG5cbteU15nXlCDXldeQ15nXnteq16og15vXmSDXmNeR15nXoteV16og15TXkNem15HXoiDXqteV15DXnteV16osINec15fXpSDXkNeZ16nXldeoIChPSyksINeQ15fXqNeqINec15fXpSDXkdeZ15jXldecIChDYW5jZWwpLiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91IHdpbGwgYmUgcHJvbXB0ZWQgdG8gcHJvdmlkZSBhIHNlY3VyaXR5IHF1ZXN0aW9uIGFuZCB0aGVuIGFuIGFuc3dlciB0byB0aGF0IHF1ZXN0aW9uLlxuXG5Zb3VyIGJ1ZGR5IHdpbGwgdGhlbiBiZSBwcm9tcHRlZCB0aGUgc2FtZSBxdWVzdGlvbiBhbmQgaWYgdGhleSB0eXBlIHRoZSBleGFjdCBzYW1lIGFuc3dlciAoY2FzZSBzZW5zaXRpdmUpLCB0aGVpciBpZGVudGl0eSB3aWxsIGJlIHZlcmlmaWVkLiI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteQ16rXlCDXqteq15HXp9epINec16HXpNenINep15DXnNeqINeQ15HXmNeX15Qg15XXnNeQ15fXqNeZ15Qg16rXqdeV15HXlCDXnNep15DXnNeUINeU15bXlS5cblxu15TXkNeZ16nXmdeV16og16nXm9eg15LXkyDXqteq15HXp9epINei15XXkdeoINeW15DXqiDXnNeQ15XXqteUINep15DXnNeqINeQ15HXmNeX15Qg15XXkNedINeW15Ug16rXp9ec15nXk9eVINeQ16og15DXqiDXkNeV16rXlCDXlNeq16nXldeR15Qg15HXnteT15XXmdenIChjYXNlIHNlbnNpdGl2ZSksINeW15TXldeq15Qg16rXkNeV157Xqi4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIldoYXQgaXMgeW91ciBzZWN1cml0eSBxdWVzdGlvbj8iOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXnteU15kg16nXkNec16og15TXkNeR15jXl9eUINep15zXmj8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIldoYXQgaXMgdGhlIGFuc3dlciB0byB0aGUgc2VjdXJpdHkgcXVlc3Rpb24/IjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi157XlNeZINeU16rXqdeV15HXlCDXnNep15DXnNeqINeU15DXkdeY15fXlD8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkludmFsaWQgYXV0aGVudGljYXRpb24gc2NoZW1lIHByb3ZpZGVkIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi16HXldek16fXlCDXodeb15nXnteqINeQ15nXnteV16og16nXkteV15nXlCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBtZXNzYWdlcyBhcmUgbm90IGVuY3J5cHRlZCBhbnltb3JlIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15TXlNeV15PXoteV16og16nXnNeaINeQ15nXoNefINee15XXptek16DXldeqINei15XXkyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBtZXNzYWdlcyBhcmUgbm93IGVuY3J5cHRlZCBidXQgeW91ciBidWRkeSdzIGlkZW50aXR5IGhhcyBub3QgYmVlbiB2ZXJpZmllZC4iOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXlNeU15XXk9ei15XXqiDXqdec15og157Xldem16TXoNeV16og15vXoteqINeQ15og15bXlNeV16og15TXkNeZ16nXmdeV16og16nXm9eg15LXkyDXmNeo150g15DXldee16rXlC4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgYnVkZHkncyBpZGVudGlmeSBoYXMgYmVlbiB2ZXJpZmllZC4iOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXlteU15XXqiDXlNeQ15nXqdeZ15XXqiDXqdeb16DXkteTINeQ15XXnteq15QuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIGJ1ZGR5IGhhcyBlbmRlZCBlbmNyeXB0aW9uIG9uIHRoZWlyIGVuZCwgeW91IHNob3VsZCBkbyB0aGUgc2FtZS4iOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXlNeQ15nXqdeZ15XXqiDXqdeb16DXkteTINeh15nXmdee15Qg15TXptek16DXlCDXkden16bXlCDXqdec15QsINei15zXmdeaINec16LXqdeV16og15DXqiDXkNeV16rXlSDXlNeT15HXqC4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgbWVzc2FnZXMgYXJlIG5vdCBlbmNyeXB0ZWQuIENsaWNrIGhlcmUgdG8gZW5hYmxlIE9UUiBlbmNyeXB0aW9uLiI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteU15TXldeT16LXldeqINep15zXmiDXkNeZ16DXnyDXnteV16bXpNeg15XXqi4g15zXl9elINeb15DXnyDXm9eT15kg15zXkNek16nXqCBPVFIuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG1lc3NhZ2VzIGFyZSBlbmNyeXB0ZWQsIGJ1dCB5b3VyIGJ1ZGR5IGhhcyBub3QgYmVlbiB2ZXJpZmllZC4iOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXlNeU15XXk9ei15XXqiDXqdec15og157Xldem16TXoNeV16og15vXoteqLCDXkNeaINeU15DXmdep15nXldeqINep15vXoNeS15Mg15jXqNedINeQ15XXnteq15QuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG1lc3NhZ2VzIGFyZSBlbmNyeXB0ZWQgYW5kIHlvdXIgYnVkZHkgdmVyaWZpZWQuIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15TXlNeV15PXoteV16og16nXnNeaINee15XXptek16DXldeqINeb16LXqiDXldeU15DXmdep15nXldeqINep15vXoNeS15Mg15DXldee16rXlC4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgYnVkZHkgaGFzIGNsb3NlZCB0aGVpciBlbmQgb2YgdGhlIHByaXZhdGUgc2Vzc2lvbiwgeW91IHNob3VsZCBkbyB0aGUgc2FtZSI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteU15DXmdep15nXldeqINep15vXoNeS15Mg16HXkteo15Qg15DXqiDXp9em15Qg15TXmdep15nXkdeUINeU16TXqNeY15nXqiDXqdec15QsINei15zXmdeaINec16LXqdeV16og15DXqiDXkNeV16rXlSDXlNeT15HXqCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiRW5kIGVuY3J5cHRlZCBjb252ZXJzYXRpb24iOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXodeZ15nXnSDXmdep15nXkdeUINee15XXptek16DXqiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUmVmcmVzaCBlbmNyeXB0ZWQgY29udmVyc2F0aW9uIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi16jXoteg158g15nXqdeZ15HXlCDXnteV16bXpNeg16oiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlN0YXJ0IGVuY3J5cHRlZCBjb252ZXJzYXRpb24iOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXlNeq15fXnCDXmdep15nXkdeUINee15XXptek16DXqiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVmVyaWZ5IHdpdGggZmluZ2VycHJpbnRzIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15DXnteqINeR16LXlteo16og15jXkdeZ16LXldeqINeQ16bXkdeiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJWZXJpZnkgd2l0aCBTTVAiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXkNee16og15HXoteW16jXqiBTTVAiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIldoYXQncyB0aGlzPyI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsItee15Qg15bXlD8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk9ubGluZSI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsItee16fXldeV158iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkJ1c3kiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXoteh15XXpyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQXdheSI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteg16LXk9eoIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJPZmZsaW5lIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15HXnNeq15kg157Xp9eV15XXnyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ29udGFjdCBuYW1lIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi16nXnSDXkNeZ16kg16fXqdeoIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTZWFyY2giOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXl9eZ16TXldepIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb250YWN0IHVzZXJuYW1lIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi16nXnSDXntep16rXntepINeQ15nXqSDXp9ep16giCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkFkZCI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteU15XXodejIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDbGljayB0byBhZGQgbmV3IGNoYXQgY29udGFjdHMiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXnNeX16Ug15vXk9eZINec15TXldeh15nXoyDXkNeg16nXmSDXp9ep16gg16nXmdeX15Qg15fXk9ep15nXnSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQWRkIGEgY29udGFjdCI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteU15XXodejINeQ15nXqSDXp9ep16giCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk5vIHVzZXJzIGZvdW5kIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15zXkCDXoNee16bXkNeVINee16nXqtee16nXmdedIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDbGljayB0byBhZGQgYXMgYSBjaGF0IGNvbnRhY3QiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXnNeX16Ug15vXk9eZINec15TXldeh15nXoyDXkdeq15XXqCDXkNeZ16kg16fXqdeoINep15nXl9eUIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSb29tIG5hbWUiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXqdedINeX15PXqCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTmlja25hbWUiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXqdedINeb15nXoNeV15kiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNlcnZlciI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsItep16jXqiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiSm9pbiI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteU16bXmNeo16MiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNob3cgcm9vbXMiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXlNem15Ig15fXk9eo15nXnSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUm9vbXMiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXl9eT16jXmdedIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJObyByb29tcyBvbiAlMSRzIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15DXmdefINeX15PXqNeZ150g16LXnCAlMSRzIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSb29tcyBvbiAlMSRzIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15fXk9eo15nXnSDXotecICUxJHMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNsaWNrIHRvIG9wZW4gdGhpcyByb29tIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15zXl9elINeb15PXmSDXnNek16rXldeXINeQ16og15fXk9eoINeW15QiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNob3cgbW9yZSBpbmZvcm1hdGlvbiBvbiB0aGlzIHJvb20iOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXlNem15Ig16LXldeTINee15nXk9eiINeQ15XXk9eV16og15fXk9eoINeW15QiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkRlc2NyaXB0aW9uOiI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteq15nXkNeV16g6IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJPY2N1cGFudHM6IjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi16DXldeb15fXmdedOiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiRmVhdHVyZXM6IjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi16rXm9eV16DXldeqOiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUmVxdWlyZXMgYXV0aGVudGljYXRpb24iOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXntem16jXmdeaINeQ15nXqdeV16giCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkhpZGRlbiI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteg16HXqteoIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSZXF1aXJlcyBhbiBpbnZpdGF0aW9uIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi157Xpteo15nXmiDXlNeW157XoNeUIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJNb2RlcmF0ZWQiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXnteR15XXp9eoIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJOb24tYW5vbnltb3VzIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15zXkCDXkNeg15XXoNeZ157XmSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiT3BlbiByb29tIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15fXk9eoINek16rXldeXIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJQZXJtYW5lbnQgcm9vbSI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteX15PXqCDXptee15nXqteUIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJQdWJsaWMiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXpNeV157XkdeZIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTZW1pLWFub255bW91cyI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteQ16DXldeg15nXnteZINec157Xl9em15QiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRlbXBvcmFyeSByb29tIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15fXk9eoINeW157XoNeZIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJVbm1vZGVyYXRlZCI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsItec15Ag157XkdeV16fXqCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU2V0IGNoYXRyb29tIHRvcGljIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi16fXkdeiINeg15XXqdeQINeX15PXqCDXqdeZ15fXlCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiS2ljayB1c2VyIGZyb20gY2hhdHJvb20iOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXkdei15gg157Xqdeq157XqSDXnteq15XXmiDXl9eT16gg16nXmdeX15QiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkJhbiB1c2VyIGZyb20gY2hhdHJvb20iOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXkNeh15XXqCDXntep16rXntepINee16rXldeaINeX15PXqCDXqdeZ15fXlCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTWVzc2FnZSI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteU15XXk9ei15QiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNhdmUiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXqdee15XXqCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ2FuY2VsIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15HXmdeY15XXnCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQW4gZXJyb3Igb2NjdXJyZWQgd2hpbGUgdHJ5aW5nIHRvIHNhdmUgdGhlIGZvcm0uIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15DXmdeo16LXlCDXqdeS15nXkNeUINeR157XlNec15og16DXmdeh15nXldefINep157Xmdeo16og15TXmNeV16TXoS4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgY2hhdHJvb20gcmVxdWlyZXMgYSBwYXNzd29yZCI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteX15PXqCDXqdeZ15fXlCDXlteUINee16bXqNeZ15og16HXmdeh157XlCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUGFzc3dvcmQ6ICI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteh15nXodee15Q6ICIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU3VibWl0IjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi16nXnNeXIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gaXMgbm90IGFub255bW91cyI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteX15PXqCDXlteUINeQ15nXoNeVINeQ16DXldeg15nXnteZIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gbm93IHNob3dzIHVuYXZhaWxhYmxlIG1lbWJlcnMiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXl9eT16gg15bXlCDXm9ei16og157XpteZ15Ig15fXkdeo15nXnSDXnNeQINeW157Xmdeg15nXnSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyByb29tIGRvZXMgbm90IHNob3cgdW5hdmFpbGFibGUgbWVtYmVycyI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteX15PXqCDXlteUINec15Ag157XpteZ15Ig15fXkdeo15nXnSDXnNeQINeW157Xmdeg15nXnSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTm9uLXByaXZhY3ktcmVsYXRlZCByb29tIGNvbmZpZ3VyYXRpb24gaGFzIGNoYW5nZWQiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXqtem15XXqNeqINeX15PXqCDXkNep16gg15zXkC3Xp9ep15XXqNeULdeR16TXqNeY15nXldeqINep15XXoNeq15QiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJvb20gbG9nZ2luZyBpcyBub3cgZW5hYmxlZCI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteZ15XXntefINeX15PXqCDXlNeZ16DXlSDXnteV16TXotecINeb16LXqiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUm9vbSBsb2dnaW5nIGlzIG5vdyBkaXNhYmxlZCI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteZ15XXntefINeX15PXqCDXlNeZ16DXlSDXnteg15XXmNeo15wg15vXoteqIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gaXMgbm93IG5vbi1hbm9ueW1vdXMiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXl9eT16gg15bXlCDXkNeZ16DXlSDXkNeg15XXoNeZ157XmSDXm9ei16oiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBpcyBub3cgc2VtaS1hbm9ueW1vdXMiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXl9eT16gg15bXlCDXlNeZ16DXlSDXkNeg15XXoNeZ157XmSDXnNee15fXpteUINeb16LXqiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyByb29tIGlzIG5vdyBmdWxseS1hbm9ueW1vdXMiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXl9eT16gg15bXlCDXlNeZ16DXlSDXkNeg15XXoNeZ157XmSDXnNeX15zXldeY15nXnyDXm9ei16oiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkEgbmV3IHJvb20gaGFzIGJlZW4gY3JlYXRlZCI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteX15PXqCDXl9eT16kg16DXldem16giCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgbmlja25hbWUgaGFzIGJlZW4gY2hhbmdlZCI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsItep150g15TXm9eZ16DXldeZINep15zXmiDXqdeV16DXlCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IGhhcyBiZWVuIGJhbm5lZCI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIjxzdHJvbmc+JTEkczwvc3Ryb25nPiDXoNeQ16HXqCjXlCkiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIjxzdHJvbmc+JTEkczwvc3Ryb25nPiBoYXMgYmVlbiBraWNrZWQgb3V0IjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwiPHN0cm9uZz4lMSRzPC9zdHJvbmc+INeg15HXoteYKNeUKSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IGhhcyBiZWVuIHJlbW92ZWQgYmVjYXVzZSBvZiBhbiBhZmZpbGlhdGlvbiBjaGFuZ2UiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCI8c3Ryb25nPiUxJHM8L3N0cm9uZz4g15TXldeh16jXlCjXlCkg157XqdeV150g16nXmdeg15XXmSDXqdeZ15XXmiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IGhhcyBiZWVuIHJlbW92ZWQgZm9yIG5vdCBiZWluZyBhIG1lbWJlciI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIjxzdHJvbmc+JTEkczwvc3Ryb25nPiDXlNeV16HXqCjXlCkg157XqdeV150g15DXmSDXlNeZ157XpteQ15XXqiDXkdee16HXkteo16og157Xotee15Mg16nXnCDXl9eR16giCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdSBoYXZlIGJlZW4gYmFubmVkIGZyb20gdGhpcyByb29tIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi16DXkNeh16jXqiDXnteq15XXmiDXl9eT16gg15bXlCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91IGhhdmUgYmVlbiBraWNrZWQgZnJvbSB0aGlzIHJvb20iOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXoNeR16LXmNeqINee16rXldeaINeX15PXqCDXlteUIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3UgaGF2ZSBiZWVuIHJlbW92ZWQgZnJvbSB0aGlzIHJvb20gYmVjYXVzZSBvZiBhbiBhZmZpbGlhdGlvbiBjaGFuZ2UiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXlNeV16HXqNeqINee16rXldeaINeX15PXqCDXlteUINee16nXldedINep15nXoNeV15kg16nXmdeV15oiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdSBoYXZlIGJlZW4gcmVtb3ZlZCBmcm9tIHRoaXMgcm9vbSBiZWNhdXNlIHRoZSByb29tIGhhcyBjaGFuZ2VkIHRvIG1lbWJlcnMtb25seSBhbmQgeW91J3JlIG5vdCBhIG1lbWJlciI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteU15XXodeo16og157XqteV15og15fXk9eoINeW15Qg157XqdeV150g16nXlNeX15PXqCDXqdeV16DXlCDXnNeX15HXqNeZ150t15HXnNeR15Mg15XXkNeZ16DXmiDXkdee16LXnteTINep15wg15fXkdeoIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3UgaGF2ZSBiZWVuIHJlbW92ZWQgZnJvbSB0aGlzIHJvb20gYmVjYXVzZSB0aGUgTVVDIChNdWx0aS11c2VyIGNoYXQpIHNlcnZpY2UgaXMgYmVpbmcgc2h1dCBkb3duLiI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteU15XXodeo16og157XqteV15og15fXk9eoINeW15Qg157XqdeV150g16nXqdeZ16jXldeqINep157XtNeeICjXqdeZ15fXlCDXnteo15XXkdeqINee16nXqtee16nXmdedKSDXlteUINeb16LXqiDXntem15XXmSDXkdeU15zXmdeb15kg16HXkteZ16jXlC4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdSBhcmUgbm90IG9uIHRoZSBtZW1iZXIgbGlzdCBvZiB0aGlzIHJvb20iOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXkNeZ16DXmiDXkdeo16nXmdee16og15TXl9eR16jXmdedINep15wg15fXk9eoINeW15QiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk5vIG5pY2tuYW1lIHdhcyBzcGVjaWZpZWQiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXnNeQINem15XXmdefINep15XXnSDXqdedINeb15nXoNeV15kiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdSBhcmUgbm90IGFsbG93ZWQgdG8gY3JlYXRlIG5ldyByb29tcyI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteQ15nXnyDXnNeaINeo16nXldeqINec15nXpteV16gg15fXk9eo15nXnSDXl9eT16nXmdedIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG5pY2tuYW1lIGRvZXNuJ3QgY29uZm9ybSB0byB0aGlzIHJvb20ncyBwb2xpY2llcyI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsItep150g15TXm9eZ16DXldeZINep15zXmiDXnNeQINeq15XXkNedINeQ16og15TXnteT15nXoNeV15nXldeqINep15wg15fXk9eoINeW15QiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgbmlja25hbWUgaXMgYWxyZWFkeSB0YWtlbiI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsItep150g15TXm9eZ16DXldeZINep15zXmiDXlNeZ16DXlSDXqtek15XXoSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyByb29tIGRvZXMgbm90ICh5ZXQpIGV4aXN0IjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15fXk9eoINeW15QgKNei15PXmdeZ158pINec15Ag16fXmdeZ150iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBoYXMgcmVhY2hlZCBpdCdzIG1heGltdW0gbnVtYmVyIG9mIG9jY3VwYW50cyI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteX15PXqCDXlteUINeU15LXmdeiINec16HXoyDXlNeg15XXm9eX15nXnSDXlNee16jXkdeZINep15zXlSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVG9waWMgc2V0IGJ5ICUxJHMgdG86ICUyJHMiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXoNeV16nXkCDXl9eT16gg15bXlCDXoNen15HXoiDXotecINeZ15PXmSAlMSRzINeQ15w6ICUyJHMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgdXNlciBpcyBhIG1vZGVyYXRvciI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsItee16nXqtee16kg15bXlCDXlNeZ16DXlSDXkNeX16jXkNeZIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHVzZXIgY2FuIHNlbmQgbWVzc2FnZXMgaW4gdGhpcyByb29tIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi157Xqdeq157XqSDXlteUINee16HXldeS15wg15zXqdec15XXlyDXlNeV15PXoteV16og15HXqteV15og15fXk9eoINeW15QiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgdXNlciBjYW4gTk9UIHNlbmQgbWVzc2FnZXMgaW4gdGhpcyByb29tIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi157Xqdeq157XqSDXlteUIO+spe+soSDXnteh15XXktecINec16nXnNeV15cg15TXldeT16LXldeqINeR16rXldeaINeX15PXqCDXlteUIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDbGljayB0byByZXN0b3JlIHRoaXMgY2hhdCI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsItec15fXpSDXm9eT15kg15zXqdeX15bXqCDXkNeqINep15nXl9eUINeW15UiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk1pbmltaXplZCI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsItee157XldeW16LXqCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIHJlbW92ZSB0aGlzIGNvbnRhY3Q/IjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15TXkNedINeQ16rXlCDXkdeY15XXlyDXm9eZINeR16jXpteV16DXmiDXnNeU16HXmdeoINeQ16og15DXmdepINen16nXqCDXlteUPyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIGRlY2xpbmUgdGhpcyBjb250YWN0IHJlcXVlc3Q/IjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15TXkNedINeQ16rXlCDXkdeY15XXlyDXm9eZINeR16jXpteV16DXmiDXnNeh16jXkSDXkNeqINeR16fXqdeqINeQ15nXqSDXp9ep16gg15bXlD8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNsaWNrIHRvIHJlbW92ZSB0aGlzIGNvbnRhY3QiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXnNeX16Ug15vXk9eZINec15TXodeZ16gg15DXqiDXkNeZ16kg16fXqdeoINeW15QiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNsaWNrIHRvIGFjY2VwdCB0aGlzIGNvbnRhY3QgcmVxdWVzdCI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsItec15fXpSDXm9eT15kg15zXp9eR15wg15DXqiDXkden16nXqiDXkNeZ16kg16fXqdeoINeW15QiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNsaWNrIHRvIGRlY2xpbmUgdGhpcyBjb250YWN0IHJlcXVlc3QiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXnNeX16Ug15vXk9eZINec16HXqNeRINeQ16og15HXp9ep16og15DXmdepINen16nXqCDXlteUIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDbGljayB0byBjaGF0IHdpdGggdGhpcyBjb250YWN0IjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15zXl9elINeb15PXmSDXnNep15XXl9eXINei150g15DXmdepINen16nXqCDXlteUIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUeXBlIHRvIGZpbHRlciI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteU16fXnNeTINeb15PXmSDXnNeh16DXnyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ3VzdG9tIHN0YXR1cyI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsItee16bXkSDXnteV16rXkNedIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJvbmxpbmUiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXnten15XXldefIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJidXN5IjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi16LXodeV16ciCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgImF3YXkgZm9yIGxvbmciOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXoNei15PXqCDXnNeW157XnyDXnteUIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJhd2F5IjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi16DXoteT16giCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkkgYW0gJTEkcyI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsItee16bXkdeZINeb16LXqiDXlNeZ16DXlSAlMSRzIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDbGljayBoZXJlIHRvIHdyaXRlIGEgY3VzdG9tIHN0YXR1cyBtZXNzYWdlIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15zXl9elINeb15DXnyDXm9eT15kg15zXm9eq15XXkSDXlNeV15PXoteqINee16bXkSDXnteV16rXkNee16oiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNsaWNrIHRvIGNoYW5nZSB5b3VyIGNoYXQgc3RhdHVzIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15zXl9elINeb15PXmSDXnNep16DXldeqINeQ16og15TXldeT16LXqiDXlNep15nXl9eUINep15zXmiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWE1QUC9KYWJiZXIgVXNlcm5hbWU6IjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi16nXnSDXntep16rXntepIFhNUFAvSmFiYmVyOiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUGFzc3dvcmQ6IjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi16HXmdeh157XlDoiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkxvZyBJbiI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteb16DXmdeh15QiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNpZ24gaW4iOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXlNeq15fXkdeo15XXqiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVG9nZ2xlIGNoYXQiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXlNek16LXnCDXqdeZ15ciCiAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkgewogICAgICAgIGRlZmluZSgiaGUiLCBbJ2plZCddLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBmYWN0b3J5KG5ldyBKZWQodHJhbnNsYXRpb25zKSk7CiAgICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICAgIGlmICghd2luZG93LmxvY2FsZXMpIHsKICAgICAgICAgICAgd2luZG93LmxvY2FsZXMgPSB7fTsKICAgICAgICB9CiAgICAgICAgd2luZG93LmxvY2FsZXMuaGUgPSBmYWN0b3J5KG5ldyBKZWQodHJhbnNsYXRpb25zKSk7CiAgICB9Cn0odGhpcywgZnVuY3Rpb24gKGhlKSB7CiAgICByZXR1cm4gaGU7Cn0pKTsKCihmdW5jdGlvbihyb290LCBmYWN0b3J5KSB7Cgl2YXIgdHJhbnNsYXRpb25zID0gewoJCSJkb21haW4iIDogImNvbnZlcnNlIiwKCQkibG9jYWxlX2RhdGEiIDogewoJCQkiY29udmVyc2UiIDogewoJCQkJIiIgOiB7CgkJCQkJIlByb2plY3QtSWQtVmVyc2lvbiIgOiAiQ29udmVyc2UuanMgMC40IiwKCQkJCQkiUmVwb3J0LU1zZ2lkLUJ1Z3MtVG8iIDogIiIsCgkJCQkJIlBPVC1DcmVhdGlvbi1EYXRlIiA6ICIyMDEzLTA5LTI0IDIzOjIyKzAyMDAiLAoJCQkJCSJQTy1SZXZpc2lvbi1EYXRlIiA6ICIyMDEzLTA5LTI1IDIyOjQyKzAyMDAiLAoJCQkJCSJMYXN0LVRyYW5zbGF0b3IiIDogIktyaXN6dGlhbiBLb21wYXIgPHczaG9zdEB3M2hvc3QuaHU+IiwKCQkJCQkiTGFuZ3VhZ2UtVGVhbSIgOiAiSHVuZ2FyaWFuIiwKCQkJCQkiTGFuZ3VhZ2UiIDogImh1IiwKCQkJCQkiTUlNRS1WZXJzaW9uIiA6ICIxLjAiLAoJCQkJCSJDb250ZW50LVR5cGUiIDogInRleHQvcGxhaW47IGNoYXJzZXQ9VVRGLTgiLAoJCQkJCSJDb250ZW50LVRyYW5zZmVyLUVuY29kaW5nIiA6ICI4Yml0IiwKCQkJCQkiZG9tYWluIiA6ICJjb252ZXJzZSIsCgkJCQkJImxhbmciIDogImh1IiwKCQkJCQkicGx1cmFsX2Zvcm1zIiA6ICJucGx1cmFscz0yOyBwbHVyYWw9KG4gIT0gMSk7IgoJCQkJfSwKCQkJCSJEaXNjb25uZWN0ZWQiIDogWyBudWxsLCAiU3rDqXRrYXBjc29sdmEiIF0sCgkJCQkiRXJyb3IiIDogWyBudWxsLCAiSGliYSIgXSwKCQkJCSJDb25uZWN0aW5nIiA6IFsgbnVsbCwgIkthcGNzb2zDs2TDoXMiIF0sCgkJCQkiQ29ubmVjdGlvbiBGYWlsZWQiIDogWyBudWxsLCAiS2FwY3NvbMOzZMOhc2kgaGliYSIgXSwKCQkJCSJBdXRoZW50aWNhdGluZyIgOiBbIG51bGwsICJBem9ub3PDrXTDoXMiIF0sCgkJCQkiQXV0aGVudGljYXRpb24gRmFpbGVkIiA6IFsgbnVsbCwgIkF6b25vc8OtdMOhc2kgaGliYSIgXSwKCQkJCSJEaXNjb25uZWN0aW5nIiA6IFsgbnVsbCwgIlN6w6l0a2FwY3NvbMOhcyIgXSwKCQkJCSJtZSIgOiBbIG51bGwsICLDqW4iIF0sCgkJCQkiJTEkcyBpcyB0eXBpbmciIDogWyBudWxsLCAiJTEkcyBnw6lwZWwiIF0sCgkJCQkiU2hvdyB0aGlzIG1lbnUiIDogWyBudWxsLCAiTXV0YXNkIGV6dCBhIG1lbsO8dCIgXSwKCQkJCSJXcml0ZSBpbiB0aGUgdGhpcmQgcGVyc29uIiA6IFsgbnVsbCwgIiIgXSwKCQkJCSJSZW1vdmUgbWVzc2FnZXMiIDogWyBudWxsLCAiw5x6ZW5ldCB0w7ZybMOpc2UiIF0sCgkJCQkiUGVyc29uYWwgbWVzc2FnZSIgOiBbIG51bGwsICJTYWrDoXQgw7x6ZW5ldCIgXSwKCQkJCSJDb250YWN0cyIgOiBbIG51bGwsICJLYXBjc29sYXRvayIgXSwKCQkJCSJPbmxpbmUiIDogWyBudWxsLCAiRWzDqXJoZXTFkSIgXSwKCQkJCSJCdXN5IiA6IFsgbnVsbCwgIkZvZ2xhbHQiIF0sCgkJCQkiQXdheSIgOiBbIG51bGwsICJUw6F2b2wiIF0sCgkJCQkiT2ZmbGluZSIgOiBbIG51bGwsICJOZW0gZWzDqXJoZXTFkSIgXSwKCQkJCSJDbGljayB0byBhZGQgbmV3IGNoYXQgY29udGFjdHMiIDogWyBudWxsLAoJCQkJCQkiw5pqIGthcGNzb2xhdG9rIGhvenrDoWFkw6FzYSIgXSwKCQkJCSJBZGQgYSBjb250YWN0IiA6IFsgbnVsbCwgIsOaaiBrYXBjc29sYXQiIF0sCgkJCQkiQ29udGFjdCB1c2VybmFtZSIgOiBbIG51bGwsICJGZWxoYXN6bsOhbMOzbsOpdiIgXSwKCQkJCSJBZGQiIDogWyBudWxsLCAiSG96esOhYWTDoXMiIF0sCgkJCQkiQ29udGFjdCBuYW1lIiA6IFsgbnVsbCwgIkthcGNzb2xhdCBuZXZlIiBdLAoJCQkJIlNlYXJjaCIgOiBbIG51bGwsICJLZXJlc8OpcyIgXSwKCQkJCSJObyB1c2VycyBmb3VuZCIgOiBbIG51bGwsICJOaW5jcyB0YWzDoWxhdCIgXSwKCQkJCSJDbGljayB0byBhZGQgYXMgYSBjaGF0IGNvbnRhY3QiIDogWyBudWxsLAoJCQkJCQkiQ3NldmVnxZEga2FwY3NvbGF0a8OpbnQgaG96esOhYWQiIF0sCgkJCQkiQ2xpY2sgdG8gb3BlbiB0aGlzIHJvb20iIDogWyBudWxsLCAiQmVsw6lww6lzIGEgY3NldmVnxZEgc3pvYsOhYmEiIF0sCgkJCQkiU2hvdyBtb3JlIGluZm9ybWF0aW9uIG9uIHRoaXMgcm9vbSIgOiBbIG51bGwsCgkJCQkJCSJUb3bDoWJiaSBpbmZvcm3DoWNpw7NrIGEgY3NldmVnxZEgc3pvYsOhcsOzbCIgXSwKCQkJCSJEZXNjcmlwdGlvbjoiIDogWyBudWxsLCAiTGXDrXLDoXM6IiBdLAoJCQkJIk9jY3VwYW50czoiIDogWyBudWxsLCAiSmVsZW5sZXbFkWs6IiBdLAoJCQkJIkZlYXR1cmVzOiIgOiBbIG51bGwsICJUdWxhamRvbnPDoWdvayIgXSwKCQkJCSJSZXF1aXJlcyBhdXRoZW50aWNhdGlvbiIgOiBbIG51bGwsICJBem9ub3PDrXTDoXMgc3rDvGtzw6lnZXMiIF0sCgkJCQkiSGlkZGVuIiA6IFsgbnVsbCwgIlJlanRldHQiIF0sCgkJCQkiUmVxdWlyZXMgYW4gaW52aXRhdGlvbiIgOiBbIG51bGwsICJNZWdow612w6FzIHN6w7xrc8OpZ2VzIiBdLAoJCQkJIk1vZGVyYXRlZCIgOiBbIG51bGwsICJNb2RlcsOhbHQiIF0sCgkJCQkiTm9uLWFub255bW91cyIgOiBbIG51bGwsICJORU0gbsOpdnRlbGVuIiBdLAoJCQkJIk9wZW4gcm9vbSIgOiBbIG51bGwsICJOeWl0b3R0IHN6b2JhIiBdLAoJCQkJIlBlcm1hbmVudCByb29tIiA6IFsgbnVsbCwgIsOBbGxhbmTDsyBzem9iYSIgXSwKCQkJCSJQdWJsaWMiIDogWyBudWxsLCAiTnnDrWx2w6Fub3MiIF0sCgkJCQkiU2VtaS1hbm9ueW1vdXMiIDogWyBudWxsLCAiRsOpbGlnIG7DqXZ0ZWxlbiIgXSwKCQkJCSJUZW1wb3Jhcnkgcm9vbSIgOiBbIG51bGwsICJJZGVpZ2xlbmVzIHN6b2JhIiBdLAoJCQkJIlVubW9kZXJhdGVkIiA6IFsgbnVsbCwgIk1vZGVyw6FsYXRsYW4iIF0sCgkJCQkiUm9vbXMiIDogWyBudWxsLCAiU3pvYsOhayIgXSwKCQkJCSJSb29tIG5hbWUiIDogWyBudWxsLCAiQSBzem9iYSBuZXZlIiBdLAoJCQkJIk5pY2tuYW1lIiA6IFsgbnVsbCwgIkJlY2Vuw6l2IiBdLAoJCQkJIlNlcnZlciIgOiBbIG51bGwsICJTemVydmVyIiBdLAoJCQkJIkpvaW4iIDogWyBudWxsLCAiQ3NhdGxha296w6FzIiBdLAoJCQkJIlNob3cgcm9vbXMiIDogWyBudWxsLCAiTMOpdGV6xZEgc3pvYsOhayIgXSwKCQkJCSJObyByb29tcyBvbiAlMSRzIiA6IFsgbnVsbCwKCQkJCQkJIk5pbmNzIGNzZXZlZ8WRIHN6b2JhIGEoeikgJTEkcyBzemVydmVyZW4iIF0sCgkJCQkiUm9vbXMgb24gJTEkcyIgOiBbIG51bGwsICJDc2V2ZWfFkSBzem9iw6FrIGEoeikgJTEkcyBzemVydmVyZW4iIF0sCgkJCQkiU2V0IGNoYXRyb29tIHRvcGljIiA6IFsgbnVsbCwgIkNzZXZlZ8WRc3pvYmEgdMOpbWEgYmXDoWxsw610w6FzIiBdLAoJCQkJIktpY2sgdXNlciBmcm9tIGNoYXRyb29tIiA6IFsgbnVsbCwKCQkJCQkJIkZlbGhhc3puw6Fsw7Mga2lsw6lwdGV0w6lzZSBhIGNzZXZlZ8WRIHN6b2LDoWLDs2wiIF0sCgkJCQkiQmFuIHVzZXIgZnJvbSBjaGF0cm9vbSIgOiBbIG51bGwsCgkJCQkJCSJGZWxoYXN6bsOhbMOzIGtpdMOtbHTDoXNhIGEgY3NldmVnxZEgc3pvYsOhYsOzbCIgXSwKCQkJCSJNZXNzYWdlIiA6IFsgbnVsbCwgIsOcemVuZXQiIF0sCgkJCQkiU2F2ZSIgOiBbIG51bGwsICJNZW50w6lzIiBdLAoJCQkJIkNhbmNlbCIgOiBbIG51bGwsICJNw6lnc2VtIiBdLAoJCQkJIkFuIGVycm9yIG9jY3VycmVkIHdoaWxlIHRyeWluZyB0byBzYXZlIHRoZSBmb3JtLiIgOiBbIG51bGwsCgkJCQkJCSJIaWJhIHTDtnJ0w6ludCBheiBhZGF0b2sgbWVudMOpc2Uga8O2emJlbi4iIF0sCgkJCQkiVGhpcyBjaGF0cm9vbSByZXF1aXJlcyBhIHBhc3N3b3JkIiA6IFsgbnVsbCwKCQkJCQkJIkEgY3NldmVnxZEgc3pvYmEgYmVsw6lww6lzaGV6IGplbHN6w7Mgc3rDvGtzw6lnZXMiIF0sCgkJCQkiUGFzc3dvcmQ6ICIgOiBbIG51bGwsICJKZWxzesOzOiIgXSwKCQkJCSJTdWJtaXQiIDogWyBudWxsLCAiS8O8bGTDqXMiIF0sCgkJCQkiVGhpcyByb29tIGlzIG5vdCBhbm9ueW1vdXMiIDogWyBudWxsLAoJCQkJCQkiRXogYSBzem9iYSBORU0gbsOpdnRlbGVuIiBdLAoJCQkJIlRoaXMgcm9vbSBub3cgc2hvd3MgdW5hdmFpbGFibGUgbWVtYmVycyIgOiBbIG51bGwsCgkJCQkJCSJFeiBhIHN6b2JhIG11dGF0amEgYXogZWzDqXJoZXRldGxlbiB0YWdva2F0IiBdLAoJCQkJIlRoaXMgcm9vbSBkb2VzIG5vdCBzaG93IHVuYXZhaWxhYmxlIG1lbWJlcnMiIDogWyBudWxsLAoJCQkJCQkiRXogYSBzem9iYSBuZW0gbXV0YXRqYSBheiBlbMOpcmhldGV0bGVuIHRhZ29rYXQiIF0sCgkJCQkiTm9uLXByaXZhY3ktcmVsYXRlZCByb29tIGNvbmZpZ3VyYXRpb24gaGFzIGNoYW5nZWQiIDogWyBudWxsLAoJCQkJCQkiQSBzem9iYSDDoWx0YWzDoW5vcyBrb25maWd1csOhY2nDs2phIG3Ds2Rvc3VsdCIgXSwKCQkJCSJSb29tIGxvZ2dpbmcgaXMgbm93IGVuYWJsZWQiIDogWyBudWxsLAoJCQkJCQkiQSBzem9iw6FiYSBhIGJlbMOpcMOpcyBsZWhldHPDqWdlcyIgXSwKCQkJCSJSb29tIGxvZ2dpbmcgaXMgbm93IGRpc2FibGVkIiA6IFsgbnVsbCwKCQkJCQkJIkEgc3pvYsOhYmEgYSBiZWzDqXDDqXMgc3rDvG5ldGVsIiBdLAoJCQkJIlRoaXMgcm9vbSBpcyBub3cgbm9uLWFub255bW91cyIgOiBbIG51bGwsCgkJCQkJCSJFeiBhIHN6b2JhIG1vc3QgTkVNIG7DqXZ0ZWxlbiIgXSwKCQkJCSJUaGlzIHJvb20gaXMgbm93IHNlbWktYW5vbnltb3VzIiA6IFsgbnVsbCwKCQkJCQkJIkV6IGEgc3pvYmEgbW9zdCBmw6lsaWcgbsOpdnRlbGVuIiBdLAoJCQkJIlRoaXMgcm9vbSBpcyBub3cgZnVsbHktYW5vbnltb3VzIiA6IFsgbnVsbCwKCQkJCQkJIkV6IGEgc3pvYmEgbW9zdCB0ZWxqZXNlbiBuw6l2dGVsZW4iIF0sCgkJCQkiQSBuZXcgcm9vbSBoYXMgYmVlbiBjcmVhdGVkIiA6IFsgbnVsbCwKCQkJCQkJIkzDqXRyZWrDtnR0IGVneSDDumogY3NldmVnxZEgc3pvYmEiIF0sCgkJCQkiWW91ciBuaWNrbmFtZSBoYXMgYmVlbiBjaGFuZ2VkIiA6IFsgbnVsbCwKCQkJCQkJIkEgYmVjZW5ldmVkIG3Ds2Rvc8OtdMOhc3JhIGtlcsO8bHQiIF0sCgkJCQkiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IGhhcyBiZWVuIGJhbm5lZCIgOiBbIG51bGwsCgkJCQkJCSJBIHN6b2LDoWLDs2wga2l0w61sdHZhOiA8c3Ryb25nPiUxJHM8L3N0cm9uZz4iIF0sCgkJCQkiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IGhhcyBiZWVuIGtpY2tlZCBvdXQiIDogWyBudWxsLAoJCQkJCQkiQSBzem9iw6Fiw7NsIGtpZG9idmE6IDxzdHJvbmc+JTEkczwvc3Ryb25nPiIgXSwKCQkJCSI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gaGFzIGJlZW4gcmVtb3ZlZCBiZWNhdXNlIG9mIGFuIGFmZmlsaWF0aW9uIGNoYW5nZSIgOiBbCgkJCQkJCW51bGwsCgkJCQkJCSJUYWdsaXN0YSBtw7Nkb3PDrXTDoXMgbWlhdHQgYSBzem9iw6Fiw7NsIGtpbMOpcHRldHZlOiA8c3Ryb25nPiUxJHM8L3N0cm9uZz4iIF0sCgkJCQkiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IGhhcyBiZWVuIHJlbW92ZWQgZm9yIG5vdCBiZWluZyBhIG1lbWJlciIgOiBbCgkJCQkJCW51bGwsCgkJCQkJCSJBIHRhZ2xpc3TDoW4gbmVtIHN6ZXJlcGVsIMOtZ3kgYSBzem9iw6Fiw7NsIGtpbMOpcHRldHZlOiA8c3Ryb25nPiUxJHM8L3N0cm9uZz4iIF0sCgkJCQkiWW91IGhhdmUgYmVlbiBiYW5uZWQgZnJvbSB0aGlzIHJvb20iIDogWyBudWxsLAoJCQkJCQkiS2kgbGV0dMOpbCB0w61sdHZhIGViYsWRbCBhIHN6b2LDoWLDs2wiIF0sCgkJCQkiWW91IGhhdmUgYmVlbiBraWNrZWQgZnJvbSB0aGlzIHJvb20iIDogWyBudWxsLAoJCQkJCQkiS2kgbGV0dMOpbCBkb2J2YSBlYmLFkWwgYSBzem9iw6Fiw7NsIiBdLAoJCQkJIllvdSBoYXZlIGJlZW4gcmVtb3ZlZCBmcm9tIHRoaXMgcm9vbSBiZWNhdXNlIG9mIGFuIGFmZmlsaWF0aW9uIGNoYW5nZSIgOiBbCgkJCQkJCW51bGwsCgkJCQkJCSJUYWdsaXN0YSBtw7Nkb3PDrXTDoXMgbWlhdHQga2lsw6lwdGV0dMO8bmsgYSBjc2V2ZWfFkSBzem9iw6Fiw7NsIiBdLAoJCQkJIllvdSBoYXZlIGJlZW4gcmVtb3ZlZCBmcm9tIHRoaXMgcm9vbSBiZWNhdXNlIHRoZSByb29tIGhhcyBjaGFuZ2VkIHRvIG1lbWJlcnMtb25seSBhbmQgeW91J3JlIG5vdCBhIG1lbWJlciIgOiBbCgkJCQkJCW51bGwsCgkJCQkJCSJLaWzDqXB0ZXR0w7xuayBhIGNzZXZlZ8WRIHN6b2LDoWLDs2wsIG1lcnQgbW9zdGFudMOzbCBjc2FrIGEgdGFnbGlzdMOhbiBzemVyZXBsxZFrIGxlaGV0bmVrIGplbGVuLiIgXSwKCQkJCSJZb3UgaGF2ZSBiZWVuIHJlbW92ZWQgZnJvbSB0aGlzIHJvb20gYmVjYXVzZSB0aGUgTVVDIChNdWx0aS11c2VyIGNoYXQpIHNlcnZpY2UgaXMgYmVpbmcgc2h1dCBkb3duLiIgOiBbCgkJCQkJCW51bGwsCgkJCQkJCSJLaWzDqXB0ZXR0w7xuayBhIGNzZXZlZ8WRIHN6b2LDoWLDs2wsIG1lcnQgYSBNVUMgKE11bHRpLVVzZXIgQ2hhdCkgc3pvbGfDoWx0YXTDoXMgbGXDoWxsw610w6FzcmEga2Vyw7xsdC4iIF0sCgkJCQkiWW91IGFyZSBub3Qgb24gdGhlIG1lbWJlciBsaXN0IG9mIHRoaXMgcm9vbSIgOiBbIG51bGwsCgkJCQkJCSJOZW0gc3plcmVwZWxzeiBhIGNzZXZlZ8WRIHN6b2JhIHRhZ2xpc3TDoWrDoW4iIF0sCgkJCQkiTm8gbmlja25hbWUgd2FzIHNwZWNpZmllZCIgOiBbIG51bGwsCgkJCQkJCSJOZW0gbGV0dCBtZWdhZHZhIGJlY2Vuw6l2IiBdLAoJCQkJIllvdSBhcmUgbm90IGFsbG93ZWQgdG8gY3JlYXRlIG5ldyByb29tcyIgOiBbIG51bGwsCgkJCQkJCSJOZW0gbGVoZXQgw7pqIGNzZXZlZ8WRIHN6b2LDoXQgbMOpdHJlaG96bmkiIF0sCgkJCQkiWW91ciBuaWNrbmFtZSBkb2Vzbid0IGNvbmZvcm0gdG8gdGhpcyByb29tJ3MgcG9saWNpZXMiIDogWwoJCQkJCQludWxsLAoJCQkJCQkiQSBiZWNlbmV2ZWQgw7x0a8O2emlrIGEgY3NldmVnxZEgc3pvYmEgc3phYsOhbHl6YXRhaXZhbCIgXSwKCQkJCSJZb3VyIG5pY2tuYW1lIGlzIGFscmVhZHkgdGFrZW4iIDogWyBudWxsLAoJCQkJCQkiQSBiZWNlbmV2ZWRldCBtw6FyIHZhbGFraSBoYXN6bsOhbGphIiBdLAoJCQkJIlRoaXMgcm9vbSBkb2VzIG5vdCAoeWV0KSBleGlzdCIgOiBbIG51bGwsCgkJCQkJCSJFeiBhIHN6b2JhIChtw6lnKSBuZW0gbMOpdGV6aWsiIF0sCgkJCQkiVGhpcyByb29tIGhhcyByZWFjaGVkIGl0J3MgbWF4aW11bSBudW1iZXIgb2Ygb2NjdXBhbnRzIiA6IFsKCQkJCQkJbnVsbCwKCQkJCQkJIkV6IGEgY3NldmVnxZEgc3pvYmEgZWzDqXJ0ZSBhIG1heGltw6FsaXMgamVsZW5sZXbFkWsgc3rDoW3DoXQiIF0sCgkJCQkiVG9waWMgc2V0IGJ5ICUxJHMgdG86ICUyJHMiIDogWyBudWxsLAoJCQkJCQkiQSBrw7Z2ZXRrZXrFkSB0w6ltw6F0IMOhbGzDrXRvdHRhIGJlICUxJHM6ICUyJHMiIF0sCgkJCQkiVGhpcyB1c2VyIGlzIGEgbW9kZXJhdG9yIiA6IFsgbnVsbCwKCQkJCQkJIkV6IGEgZmVsaGFzem7DoWzDsyBlZ3kgbW9kZXLDoXRvciIgXSwKCQkJCSJUaGlzIHVzZXIgY2FuIHNlbmQgbWVzc2FnZXMgaW4gdGhpcyByb29tIiA6IFsgbnVsbCwKCQkJCQkJIkV6IGEgZmVsaGFzem7DoWzDsyBrw7xsZGhldCDDvHplbmV0ZXQgZWJiZSBhIHN6b2LDoWJhIiBdLAoJCQkJIlRoaXMgdXNlciBjYW4gTk9UIHNlbmQgbWVzc2FnZXMgaW4gdGhpcyByb29tIiA6IFsgbnVsbCwKCQkJCQkJIkV6IGEgZmVsaGFzem7DoWzDsyBORU0ga8O8bGRoZXQgw7x6ZW5ldGV0IGViYmUgYSBzem9iw6FiYSIgXSwKCQkJCSJDbGljayB0byBjaGF0IHdpdGggdGhpcyBjb250YWN0IiA6IFsgbnVsbCwKCQkJCQkJIkNzZXZlZ8OpcyBpbmTDrXTDoXNhIGV6emVsIGEga2FwY3NvbGF0dW5ra2FsIiBdLAoJCQkJIkNsaWNrIHRvIHJlbW92ZSB0aGlzIGNvbnRhY3QiIDogWyBudWxsLCAiQSBrYXBjc29sYXQgdMO2cmzDqXNlIiBdLAoJCQkJIlRoaXMgY29udGFjdCBpcyBidXN5IiA6IFsgbnVsbCwgIkVsZm9nbGFsdCIgXSwKCQkJCSJUaGlzIGNvbnRhY3QgaXMgb25saW5lIiA6IFsgbnVsbCwgIk9ubGluZSIgXSwKCQkJCSJUaGlzIGNvbnRhY3QgaXMgb2ZmbGluZSIgOiBbIG51bGwsICJOaW5jcyBiZWplbGVudGtlenZlIiBdLAoJCQkJIlRoaXMgY29udGFjdCBpcyB1bmF2YWlsYWJsZSIgOiBbIG51bGwsICJFbMOpcmhldGV0bGVuIiBdLAoJCQkJIlRoaXMgY29udGFjdCBpcyBhd2F5IGZvciBhbiBleHRlbmRlZCBwZXJpb2QiIDogWyBudWxsLAoJCQkJCQkiSG9zc3phYmIgaWRlamUgdMOhdm9sIiBdLAoJCQkJIlRoaXMgY29udGFjdCBpcyBhd2F5IiA6IFsgbnVsbCwgIlTDoXZvbCIgXSwKCQkJCSJDb250YWN0IHJlcXVlc3RzIiA6IFsgbnVsbCwgIkthcGNzb2xhdCBmZWx2w6l0ZWxpIGvDqXLDqXMiIF0sCgkJCQkiTXkgY29udGFjdHMiIDogWyBudWxsLCAiS2FwY3NvbGF0b2s6IiBdLAoJCQkJIlBlbmRpbmcgY29udGFjdHMiIDogWyBudWxsLCAiRsO8Z2fFkWJlbiBsZXbFkSBrYXBjc29sYXRvayIgXSwKCQkJCSJDdXN0b20gc3RhdHVzIiA6IFsgbnVsbCwgIkVneWVkaSBzdMOhdHVzeiIgXSwKCQkJCSJDbGljayB0byBjaGFuZ2UgeW91ciBjaGF0IHN0YXR1cyIgOiBbIG51bGwsCgkJCQkJCSJTYWrDoXQgc3TDoXR1c3ogYmXDoWxsw610w6FzYSIgXSwKCQkJCSJDbGljayBoZXJlIHRvIHdyaXRlIGEgY3VzdG9tIHN0YXR1cyBtZXNzYWdlIiA6IFsgbnVsbCwKCQkJCQkJIkVneWVkaSBzdMOhdHVzeiDDvHplbmV0IMOtcsOhc2EiIF0sCgkJCQkib25saW5lIiA6IFsgbnVsbCwgIm9ubGluZSIgXSwKCQkJCSJidXN5IiA6IFsgbnVsbCwgImVsZm9nbGFsdCIgXSwKCQkJCSJhd2F5IGZvciBsb25nIiA6IFsgbnVsbCwgImhvc3N6w7ogaWRlamUgdMOhdm9sIiBdLAoJCQkJImF3YXkiIDogWyBudWxsLCAidMOhdm9sIiBdLAoJCQkJIkkgYW0gJTEkcyIgOiBbIG51bGwsICIlMSRzIHZhZ3lvayIgXSwKCQkJCSJTaWduIGluIiA6IFsgbnVsbCwgIkJlbMOpcMOpcyIgXSwKCQkJCSJYTVBQL0phYmJlciBVc2VybmFtZToiIDogWyBudWxsLCAiWE1QUC9KYWJiZXIgYXpvbm9zw610w7M6IiBdLAoJCQkJIlBhc3N3b3JkOiIgOiBbIG51bGwsICJKZWxzesOzOiIgXSwKCQkJCSJMb2cgSW4iIDogWyBudWxsLCAiQmVsw6lww6lzIiBdLAoJCQkJIkJPU0ggU2VydmljZSBVUkw6IiA6IFsgbnVsbCwgIkJPU0ggc3plcnZlciBVUkwiIF0sCgkJCQkiT25saW5lIENvbnRhY3RzIiA6IFsgbnVsbCwgIk9ubGluZSBrYXBjc29sYXRvayIgXQoJCQl9CgkJfQoJfTsKCWlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHsKCQlkZWZpbmUoImh1IiwgWyAnamVkJyBdLCBmdW5jdGlvbigpIHsKCQkJcmV0dXJuIGZhY3RvcnkobmV3IEplZCh0cmFuc2xhdGlvbnMpKTsKCQl9KTsKCX0gZWxzZSB7CgkJaWYgKCF3aW5kb3cubG9jYWxlcykgewoJCQl3aW5kb3cubG9jYWxlcyA9IHt9OwoJCX0KCQl3aW5kb3cubG9jYWxlcy5odSA9IGZhY3RvcnkobmV3IEplZCh0cmFuc2xhdGlvbnMpKTsKCX0KfSh0aGlzLCBmdW5jdGlvbihodSkgewoJcmV0dXJuIGh1Owp9KSk7CgooZnVuY3Rpb24ocm9vdCwgZmFjdG9yeSkgewogICAgdmFyIHRyYW5zbGF0aW9ucyA9IHsKICAgICAgICAiZG9tYWluIjogImNvbnZlcnNlIiwKICAgICAgICAibG9jYWxlX2RhdGEiOiB7CiAgICAgICAgICAgICJjb252ZXJzZSI6IHsKICAgICAgICAgICAgICAgICIiOiB7CiAgICAgICAgICAgICAgICAgICAgInByb2plY3QtaWQtdmVyc2lvbiI6ICJDb252ZXJzZS5qcyAwLjcuMCIsCiAgICAgICAgICAgICAgICAgICAgInJlcG9ydC1tc2dpZC1idWdzLXRvIjogIiIsCiAgICAgICAgICAgICAgICAgICAgInBvdC1jcmVhdGlvbi1kYXRlIjogIjIwMTQtMDEtMjIgMTc6MDcrMDIwMCIsCiAgICAgICAgICAgICAgICAgICAgInBvLXJldmlzaW9uLWRhdGUiOiAiMjAxNC0wMS0yNSAyMTozMCswNzAwIiwKICAgICAgICAgICAgICAgICAgICAibGFzdC10cmFuc2xhdG9yIjogIlByaXlhZGkgSW1hbiBOdXJjYWh5byA8cHJpeWFkaUBwcml5YWRpLm5ldD4iLAogICAgICAgICAgICAgICAgICAgICJsYW5ndWFnZS10ZWFtIjogIkJhaGFzYSBJbmRvbmVzaWEiLAogICAgICAgICAgICAgICAgICAgICJtaW1lLXZlcnNpb24iOiAiMS4wIiwKICAgICAgICAgICAgICAgICAgICAiY29udGVudC10eXBlIjogInRleHQvcGxhaW47IGNoYXJzZXQ9VVRGLTgiLAogICAgICAgICAgICAgICAgICAgICJjb250ZW50LXRyYW5zZmVyLWVuY29kaW5nIjogIjhiaXQiLAogICAgICAgICAgICAgICAgICAgICJsYW5ndWFnZSI6ICJpZCIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAidW5lbmNyeXB0ZWQiOiBbbnVsbCwgInRhayBkaWVua3JpcHNpIl0sCiAgICAgICAgICAgICAgICAidW52ZXJpZmllZCI6IFtudWxsLCAidGFrIGRpdmVyaWZpa2FzaSJdLAogICAgICAgICAgICAgICAgInZlcmlmaWVkIjogW251bGwsICJkaXZlcmlmaWthc2kiXSwKICAgICAgICAgICAgICAgICJmaW5pc2hlZCI6IFtudWxsLCAic2VsZXNhaSJdLAogICAgICAgICAgICAgICAgIlRoaXMgY29udGFjdCBpcyBidXN5IjogW251bGwsICJUZW1hbiBpbmkgc2VkYW5nIHNpYnVrIl0sCiAgICAgICAgICAgICAgICAiVGhpcyBjb250YWN0IGlzIG9ubGluZSI6IFtudWxsLCAiVGVtYW4gaW5pIHRlcmh1YnVuZyJdLAogICAgICAgICAgICAgICAgIlRoaXMgY29udGFjdCBpcyBvZmZsaW5lIjogW251bGwsICJUZW1hbiBpbmkgdGlkYWsgdGVyaHVidW5nIl0sCiAgICAgICAgICAgICAgICAiVGhpcyBjb250YWN0IGlzIHVuYXZhaWxhYmxlIjogW251bGwsICJUZW1hbiBpbmkgdGlkYWsgdGVyc2VkaWEiXSwKICAgICAgICAgICAgICAgICJUaGlzIGNvbnRhY3QgaXMgYXdheSBmb3IgYW4gZXh0ZW5kZWQgcGVyaW9kIjogW251bGwsICJUZW1hbiBpbmkgdGlkYWsgZGkgdGVtcGF0IHVudHVrIHdha3R1IHlhbmcgbGFtYSJdLAogICAgICAgICAgICAgICAgIlRoaXMgY29udGFjdCBpcyBhd2F5IjogW251bGwsICJUZW1hbiBpbmkgdGlkYWsgZGkgdGVtcGF0Il0sCiAgICAgICAgICAgICAgICAiRGlzY29ubmVjdGVkIjogW251bGwsICJUZXJwdXR1cyJdLAogICAgICAgICAgICAgICAgIkVycm9yIjogW251bGwsICJLZXNhbGFoYW4iXSwKICAgICAgICAgICAgICAgICJDb25uZWN0aW5nIjogW251bGwsICJNZW55YW1idW5nIl0sCiAgICAgICAgICAgICAgICAiQ29ubmVjdGlvbiBGYWlsZWQiOiBbbnVsbCwgIkdhZ2FsIE1lbnlhbWJ1bmciXSwKICAgICAgICAgICAgICAgICJBdXRoZW50aWNhdGluZyI6IFtudWxsLCAiTWVsYWt1a2FuIG90ZW50aWthc2kiXSwKICAgICAgICAgICAgICAgICJBdXRoZW50aWNhdGlvbiBGYWlsZWQiOiBbbnVsbCwgIk90ZW50aWthc2kgZ2FnYWwiXSwKICAgICAgICAgICAgICAgICJEaXNjb25uZWN0aW5nIjogW251bGwsICJNZW11dHVza2FuIGh1YnVuZ2FuIl0sCiAgICAgICAgICAgICAgICAiT25saW5lIENvbnRhY3RzIjogW251bGwsICJUZW1hbiB5YW5nIFRlcmh1YnVuZyJdLAogICAgICAgICAgICAgICAgIlJlLWVzdGFibGlzaGluZyBlbmNyeXB0ZWQgc2Vzc2lvbiI6IFtudWxsLCAiTWVueWFtYnVuZyBrZW1iYWxpIHNlc2kgdGVyZW5rcmlwc2kiXSwKICAgICAgICAgICAgICAgICJZb3VyIGJyb3dzZXIgbmVlZHMgdG8gZ2VuZXJhdGUgYSBwcml2YXRlIGtleSwgd2hpY2ggd2lsbCBiZSB1c2VkIGluIHlvdXIgZW5jcnlwdGVkIGNoYXQgc2Vzc2lvbi4gVGhpcyBjYW4gdGFrZSB1cCB0byAzMCBzZWNvbmRzIGR1cmluZyB3aGljaCB5b3VyIGJyb3dzZXIgbWlnaHQgZnJlZXplIGFuZCBiZWNvbWUgdW5yZXNwb25zaXZlLiI6IFtudWxsLCAiUGVyYW1iYWggYW5kYSBwZXJsdSBtZW1idWF0IGt1bmNpIHByaXZhdCwgeWFuZyBha2FuIGRpZ3VuYWthbiBwYWRhIHNlc2kgcGVyYmluY2FuZ2FuIGFuZGEuIEluaSBha2FuIG1lbWJ1dHVoa2FuIHdha3R1IHNhbXBhaSAzMCBkZXRpaywgZGFuIHNlbGFtYSBpdHUgcGVyYW1iYWggbXVuZ2tpbiBha2FuIHRpZGFrIHJlc3BvbnNpZi4iXSwKICAgICAgICAgICAgICAgICJQcml2YXRlIGtleSBnZW5lcmF0ZWQuIjogW251bGwsICJLdW5jaSBwcml2YXQgYmVyaGFzaWwgZGlidWF0LiJdLAogICAgICAgICAgICAgICAgIkF1dGhlbnRpY2F0aW9uIHJlcXVlc3QgZnJvbSAlMSRzXG5cbllvdXIgYnVkZHkgaXMgYXR0ZW1wdGluZyB0byB2ZXJpZnkgeW91ciBpZGVudGl0eSwgYnkgYXNraW5nIHlvdSB0aGUgcXVlc3Rpb24gYmVsb3cuXG5cbiUyJHMiOiBbbnVsbCwgIlBlcm1pbnRhYW4gb3RlbnRpa2FzaSBkYXJpICUxJHNcblxuVGVtYW4gYW5kYSBtZW5jb2JhIHVudHVrIG1lbGFrdWthbiB2ZXJpZmlrYXNpIGlkZW50aXRhcyBhbmRhIGRlbmdhbiBjYXJhIG1lbmFueWFrYW4gcGVydGFueWFhbiBkaSBiYXdhaCBpbmkuXG5cbiUyJHMiXSwKICAgICAgICAgICAgICAgICJDb3VsZCBub3QgdmVyaWZ5IHRoaXMgdXNlcidzIGlkZW50aWZ5LiI6IFtudWxsLCAiVGFrIGRhcGF0IG1lbGFrdWthbiB2ZXJpZmlrYXNpIGlkZW50aXRhcyBwZW5nZ3VuYSBpbmkuIl0sCiAgICAgICAgICAgICAgICAiUGVyc29uYWwgbWVzc2FnZSI6IFtudWxsLCAiUGVzYW4gcHJpYmFkaSJdLAogICAgICAgICAgICAgICAgIlN0YXJ0IGVuY3J5cHRlZCBjb252ZXJzYXRpb24iOiBbbnVsbCwgIk11bGFpIHNlc2kgdGVyZW5rcmlwc2kiXSwKICAgICAgICAgICAgICAgICJSZWZyZXNoIGVuY3J5cHRlZCBjb252ZXJzYXRpb24iOiBbbnVsbCwgIlNldGVsIHVsYW5nIHBlcmNha2FwYW4gdGVyZW5rcmlwc2kiXSwKICAgICAgICAgICAgICAgICJFbmQgZW5jcnlwdGVkIGNvbnZlcnNhdGlvbiI6IFtudWxsLCAiU3VkYWhpIHBlcmNha2FwYW4gdGVyZW5rcmlwc2kiXSwKICAgICAgICAgICAgICAgICJWZXJpZnkgd2l0aCBTTVAiOiBbbnVsbCwgIlZlcmlmaWthc2kgbWVuZ2d1bmFrYW4gU01QIl0sCiAgICAgICAgICAgICAgICAiVmVyaWZ5IHdpdGggZmluZ2VycHJpbnRzIjogW251bGwsICJWZXJpZmlrYXNpIG1lbmdndW5ha2FuIHNpZGlrIGphcmkiXSwKICAgICAgICAgICAgICAgICJXaGF0J3MgdGhpcz8iOiBbbnVsbCwgIkFwYWthaCBpbmk/Il0sCiAgICAgICAgICAgICAgICAibWUiOiBbbnVsbCwgInNheWEiXSwKICAgICAgICAgICAgICAgICJTaG93IHRoaXMgbWVudSI6IFtudWxsLCAiVGFtcGlsa2FuIG1lbnUgaW5pIl0sCiAgICAgICAgICAgICAgICAiV3JpdGUgaW4gdGhlIHRoaXJkIHBlcnNvbiI6IFtudWxsLCAiVHVsaXMgaW5pIG1lbmdndW5ha2FuIGJhaGFzYSBwaWhhayBrZXRpZ2EiXSwKICAgICAgICAgICAgICAgICJSZW1vdmUgbWVzc2FnZXMiOiBbbnVsbCwgIkhhcHVzIHBlc2FuIl0sCiAgICAgICAgICAgICAgICAiWW91ciBtZXNzYWdlIGNvdWxkIG5vdCBiZSBzZW50IjogW251bGwsICJQZXNhbiBhbmRhIHRhayBkYXBhdCBkaWtpcmltIl0sCiAgICAgICAgICAgICAgICAiV2UgcmVjZWl2ZWQgYW4gdW5lbmNyeXB0ZWQgbWVzc2FnZSI6IFtudWxsLCAiS2FtaSBtZW5lcmltYSBwZXNhbiB0ZXJlbmtyaXBzaSJdLAogICAgICAgICAgICAgICAgIldlIHJlY2VpdmVkIGFuIHVucmVhZGFibGUgZW5jcnlwdGVkIG1lc3NhZ2UiOiBbbnVsbCwgIkthbWkgbWVuZXJpbWEgcGVzYW4gdGVyZW5rcmlwc2kgeWFuZyBnYWdhbCBkaWJhY2EiXSwKICAgICAgICAgICAgICAgICJUaGlzIHVzZXIgaGFzIHJlcXVlc3RlZCBhbiBlbmNyeXB0ZWQgc2Vzc2lvbi4iOiBbbnVsbCwgIlBlbmdndW5hIGluaSBtZW1pbnRhIHNlc2kgdGVyZW5rcmlwc2kiXSwKICAgICAgICAgICAgICAgICJIZXJlIGFyZSB0aGUgZmluZ2VycHJpbnRzLCBwbGVhc2UgY29uZmlybSB0aGVtIHdpdGggJTEkcywgb3V0c2lkZSBvZiB0aGlzIGNoYXQuXG5cbkZpbmdlcnByaW50IGZvciB5b3UsICUyJHM6ICUzJHNcblxuRmluZ2VycHJpbnQgZm9yICUxJHM6ICU0JHNcblxuSWYgeW91IGhhdmUgY29uZmlybWVkIHRoYXQgdGhlIGZpbmdlcnByaW50cyBtYXRjaCwgY2xpY2sgT0ssIG90aGVyd2lzZSBjbGljayBDYW5jZWwuIjogW251bGwsICJJbmkgYWRhbGFoIHNpZGlrIGphcmkgYW5kYSwga29uZmlybWFzaWthbiBiZXJzYW1hIG1lcmVrYSBkZW5nYW4gJTEkcywgZGkgbHVhciBwZXJjYWthcGFuIGluaS5cblxuU2lkaWsgamFyaSB1bnR1ayBhbmRhLCAlMiRzOiAlMyRzXG5cblNpZGlrIGphcmkgdW50dWsgJTEkczogJTQkc1xuXG5KaWthIGFuZGEgYmlzYSBtZW5na29uZmlybWFzaSBzaWRpayBqYWRpIGNvY29rLCBrbGlrIExhbmp1dGthbiwgamlrYSB0aWRhayBrbGlrIEJhdGFsLiJdLAogICAgICAgICAgICAgICAgIllvdSB3aWxsIGJlIHByb21wdGVkIHRvIHByb3ZpZGUgYSBzZWN1cml0eSBxdWVzdGlvbiBhbmQgdGhlbiBhbiBhbnN3ZXIgdG8gdGhhdCBxdWVzdGlvbi5cblxuWW91ciBidWRkeSB3aWxsIHRoZW4gYmUgcHJvbXB0ZWQgdGhlIHNhbWUgcXVlc3Rpb24gYW5kIGlmIHRoZXkgdHlwZSB0aGUgZXhhY3Qgc2FtZSBhbnN3ZXIgKGNhc2Ugc2Vuc2l0aXZlKSwgdGhlaXIgaWRlbnRpdHkgd2lsbCBoYXZlIGJlZW4gdmVyaWZpZWQuIjogW251bGwsICJBbmRhIGFrYW4gZGl0YW55YWthbiBwZXJ0YW55YWFuIHVudHVrIGtlYW1hbmFuIGJlc2VydGEgamF3YWJhbiB1bnR1ayBwZXJ0YW55YWFuIHRlcnNlYnV0LlxuXG5UZW1hbiBhbmRhIGFrYW4gZGl0YW55YWthbiBwZXJ0YW55YWFuIHlhbmcgc2FtYSBkYW4gamlrYSBkaWEgbWVtYmVyaWthbiBqYXdhYmFuIHlhbmcgc2FtYSAoaHVydWYga2FwaXRhbCBkaXBlcmhhdGlrYW4pLCBpZGVudGl0YXMgbWVyZWthIGRpdmVyaWZpa2FzaS4iXSwKICAgICAgICAgICAgICAgICJXaGF0IGlzIHlvdXIgc2VjdXJpdHkgcXVlc3Rpb24/IjogW251bGwsICJBcGFrYWggcGVydGFueWFhbiBrZWFtYW5hbiBhbmRhPyJdLAogICAgICAgICAgICAgICAgIldoYXQgaXMgdGhlIGFuc3dlciB0byB0aGUgc2VjdXJpdHkgcXVlc3Rpb24/IjogW251bGwsICJBcGEgamF3YWJhbiBkYXJpIHBlcnRhbnlhYW4ga2VhbWFuYW4gdGVyc2VidXQ/Il0sCiAgICAgICAgICAgICAgICAiSW52YWxpZCBhdXRoZW50aWNhdGlvbiBzY2hlbWUgcHJvdmlkZWQiOiBbbnVsbCwgIlNrZW1hIG90ZW50aWthc2kgc2FsYWgiXSwKICAgICAgICAgICAgICAgICJZb3VyIG1lc3NhZ2VzIGFyZSBub3QgZW5jcnlwdGVkIGFueW1vcmUiOiBbbnVsbCwgIlBlc2FuIGFuZGEgdGlkYWsgbGFnaSB0ZXJlbmtyaXBzaSJdLAogICAgICAgICAgICAgICAgIllvdXIgbWVzc2FnZXMgYXJlIG5vdyBlbmNyeXB0ZWQgYnV0IHlvdXIgYnVkZHkncyBpZGVudGl0eSBoYXMgbm90IGJlZW4gdmVyaWZpZWQuIjogW251bGwsICJQZXNhbiBhbmRhIHNla2FyYW5nIHRlcmVua3JpcHNpLCBuYW11biBpZGVudGl0YXMgdGVtYW4gYW5kYSBiZWx1bSBkYXBhdCBkaXZlcmlmaWthc2kuIl0sCiAgICAgICAgICAgICAgICAiWW91ciBidWRkeSdzIGlkZW50aWZ5IGhhcyBiZWVuIHZlcmlmaWVkLiI6IFtudWxsLCAiSWRlbnRpdGFzIHRlbWFuIGFuZGEgdGVsYWggZGl2ZXJpZmlrYXNpLiJdLAogICAgICAgICAgICAgICAgIllvdXIgYnVkZHkgaGFzIGVuZGVkIGVuY3J5cHRpb24gb24gdGhlaXIgZW5kLCB5b3Ugc2hvdWxkIGRvIHRoZSBzYW1lLiI6IFtudWxsLCAiVGVtYW4gYW5kYSBtZW5naGVudGlrYW4gcGVyY2FrYXBhbiB0ZXJlbmtyaXBzaSwgYW5kYSBzZWJhaWtueWEgbWVsYWt1a2FuIGhhbCB5YW5nIHNhbWEuIl0sCiAgICAgICAgICAgICAgICAiWW91ciBtZXNzYWdlcyBhcmUgbm90IGVuY3J5cHRlZC4gQ2xpY2sgaGVyZSB0byBlbmFibGUgT1RSIGVuY3J5cHRpb24uIjogW251bGwsICJQZXNhbiBhbmRhIHRhayB0ZXJlbmtyaXBzaS4gS2xpayBkaSBzaW5pIHVudHVrIG1lbnlhbGFrYW4gZW5rcmlwc2kgT1RSLiJdLAogICAgICAgICAgICAgICAgIllvdXIgbWVzc2FnZXMgYXJlIGVuY3J5cHRlZCwgYnV0IHlvdXIgYnVkZHkgaGFzIG5vdCBiZWVuIHZlcmlmaWVkLiI6IFtudWxsLCAiUGVzYW4gYW5kYSB0ZXJlbmtyaXBzaSwgdGV0YXBpIHRlbWFuIGFuZGEgYmVsdW0gZGl2ZXJpZmlrYXNpLiJdLAogICAgICAgICAgICAgICAgIllvdXIgbWVzc2FnZXMgYXJlIGVuY3J5cHRlZCBhbmQgeW91ciBidWRkeSB2ZXJpZmllZC4iOiBbbnVsbCwgIlBlc2FuIGFuZGEgdGVyZW5rcmlwc2kgZGFuIHRlbWFuIGFuZGEgdGVsYWggZGl2ZXJpZmlrYXNpLiJdLAogICAgICAgICAgICAgICAgIllvdXIgYnVkZHkgaGFzIGNsb3NlZCB0aGVpciBlbmQgb2YgdGhlIHByaXZhdGUgc2Vzc2lvbiwgeW91IHNob3VsZCBkbyB0aGUgc2FtZSI6IFtudWxsLCAiVGVtYW4gYW5kYSB0ZWxhaCBtZW1hdGlrYW4gc2VzaSB0ZXJlbmtyaXBzaSwgZGFuIGFuZGEganVnYSBzZWJhaWtueWEgbWVsYWt1a2FuIGhhbCB5YW5nIHNhbWEiXSwKICAgICAgICAgICAgICAgICJDb250YWN0cyI6IFtudWxsLCAiVGVtYW4iXSwKICAgICAgICAgICAgICAgICJPbmxpbmUiOiBbbnVsbCwgIlRlcmh1YnVuZyJdLAogICAgICAgICAgICAgICAgIkJ1c3kiOiBbbnVsbCwgIlNpYnVrIl0sCiAgICAgICAgICAgICAgICAiQXdheSI6IFtudWxsLCAiUGVyZ2kiXSwKICAgICAgICAgICAgICAgICJPZmZsaW5lIjogW251bGwsICJUYWsgVGVyaHVidW5nIl0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgdG8gYWRkIG5ldyBjaGF0IGNvbnRhY3RzIjogW251bGwsICJLbGlrIHVudHVrIG1lbmFtYmFoa2FuIHRlbWFuIGJhcnUiXSwKICAgICAgICAgICAgICAgICJBZGQgYSBjb250YWN0IjogW251bGwsICJUYW1iYWggdGVtYW4iXSwKICAgICAgICAgICAgICAgICJDb250YWN0IHVzZXJuYW1lIjogW251bGwsICJVc2VybmFtZSB0ZW1hbiJdLAogICAgICAgICAgICAgICAgIkFkZCI6IFtudWxsLCAiVGFtYmFoIl0sCiAgICAgICAgICAgICAgICAiQ29udGFjdCBuYW1lIjogW251bGwsICJOYW1hIHRlbWFuIl0sCiAgICAgICAgICAgICAgICAiU2VhcmNoIjogW251bGwsICJDYXJpIl0sCiAgICAgICAgICAgICAgICAiTm8gdXNlcnMgZm91bmQiOiBbbnVsbCwgIlBlbmdndW5hIHRhayBkaXRlbXVrYW4iXSwKICAgICAgICAgICAgICAgICJDbGljayB0byBhZGQgYXMgYSBjaGF0IGNvbnRhY3QiOiBbbnVsbCwgIktsaWsgdW50dWsgbWVuYW1iYWhrYW4gc2ViYWdhaSB0ZW1hbiJdLAogICAgICAgICAgICAgICAgIkNsaWNrIHRvIG9wZW4gdGhpcyByb29tIjogW251bGwsICJLbGlrIHVudHVrIG1lbWJ1a2EgcnVhbmdhbiBpbmkiXSwKICAgICAgICAgICAgICAgICJTaG93IG1vcmUgaW5mb3JtYXRpb24gb24gdGhpcyByb29tIjogW251bGwsICJUYW1waWxrYW4gaW5mb3JtYXNpIHJ1YW5nYW4gaW5pIl0sCiAgICAgICAgICAgICAgICAiRGVzY3JpcHRpb246IjogW251bGwsICJLZXRlcmFuZ2FuOiJdLAogICAgICAgICAgICAgICAgIk9jY3VwYW50czoiOiBbbnVsbCwgIlBlbmdodW5pOiJdLAogICAgICAgICAgICAgICAgIkZlYXR1cmVzOiI6IFtudWxsLCAiRml0dXI6Il0sCiAgICAgICAgICAgICAgICAiUmVxdWlyZXMgYXV0aGVudGljYXRpb24iOiBbbnVsbCwgIk1lbWJ1dHVoa2FuIG90ZW50aWthc2kiXSwKICAgICAgICAgICAgICAgICJIaWRkZW4iOiBbbnVsbCwgIlRlcnNlbWJ1bnlpIl0sCiAgICAgICAgICAgICAgICAiUmVxdWlyZXMgYW4gaW52aXRhdGlvbiI6IFtudWxsLCAiTWVtYnV0dWhrYW4gdW5kYW5nYW4iXSwKICAgICAgICAgICAgICAgICJNb2RlcmF0ZWQiOiBbbnVsbCwgIkRpbW9kZXJhc2kiXSwKICAgICAgICAgICAgICAgICJOb24tYW5vbnltb3VzIjogW251bGwsICJUaWRhayBhbm9uaW0iXSwKICAgICAgICAgICAgICAgICJPcGVuIHJvb20iOiBbbnVsbCwgIlJ1YW5nYW4gdGVyYnVrYSJdLAogICAgICAgICAgICAgICAgIlBlcm1hbmVudCByb29tIjogW251bGwsICJSdWFuZ2FuIHBlcm1hbmVuIl0sCiAgICAgICAgICAgICAgICAiUHVibGljIjogW251bGwsICJVbXVtIl0sCiAgICAgICAgICAgICAgICAiU2VtaS1hbm9ueW1vdXMiOiBbbnVsbCwgIlNlbWktYW5vbmltIl0sCiAgICAgICAgICAgICAgICAiVGVtcG9yYXJ5IHJvb20iOiBbbnVsbCwgIlJ1YW5nYW4gc2VtZW50YXJhIl0sCiAgICAgICAgICAgICAgICAiVW5tb2RlcmF0ZWQiOiBbbnVsbCwgIlRhayBkaW1vZGVyYXNpIl0sCiAgICAgICAgICAgICAgICAiUm9vbXMiOiBbbnVsbCwgIlJ1YW5nYW4iXSwKICAgICAgICAgICAgICAgICJSb29tIG5hbWUiOiBbbnVsbCwgIk5hbWEgcnVhbmdhbiJdLAogICAgICAgICAgICAgICAgIk5pY2tuYW1lIjogW251bGwsICJOYW1hIHBhbmdnaWxhbiJdLAogICAgICAgICAgICAgICAgIlNlcnZlciI6IFtudWxsLCAiU2VydmVyIl0sCiAgICAgICAgICAgICAgICAiSm9pbiI6IFtudWxsLCAiSWt1dGkiXSwKICAgICAgICAgICAgICAgICJTaG93IHJvb21zIjogW251bGwsICJQZXJsaWhhdGthbiBydWFuZ2FuIl0sCiAgICAgICAgICAgICAgICAiTm8gcm9vbXMgb24gJTEkcyI6IFtudWxsLCAiVGFrIGFkYSBydWFuZ2FuIGRpICUxJHMiXSwKICAgICAgICAgICAgICAgICJSb29tcyBvbiAlMSRzIjogW251bGwsICJSdWFuZ2FuIGRpICUxJHMiXSwKICAgICAgICAgICAgICAgICJTZXQgY2hhdHJvb20gdG9waWMiOiBbbnVsbCwgIlNldGVsIHRvcGlrIHJ1YW5nYW4iXSwKICAgICAgICAgICAgICAgICJLaWNrIHVzZXIgZnJvbSBjaGF0cm9vbSI6IFtudWxsLCAiVGVuZGFuZyBwZW5nZ3VuYSBkYXJpIHJ1YW5nYW4iXSwKICAgICAgICAgICAgICAgICJCYW4gdXNlciBmcm9tIGNoYXRyb29tIjogW251bGwsICJMYXJhbmcgcGVuZ2d1bmEgZGFyaSBydWFuZ2FuIl0sCiAgICAgICAgICAgICAgICAiTWVzc2FnZSI6IFtudWxsLCAiUGVzYW4iXSwKICAgICAgICAgICAgICAgICJTYXZlIjogW251bGwsICJTaW1wYW4iXSwKICAgICAgICAgICAgICAgICJDYW5jZWwiOiBbbnVsbCwgIkJhdGFsIl0sCiAgICAgICAgICAgICAgICAiQW4gZXJyb3Igb2NjdXJyZWQgd2hpbGUgdHJ5aW5nIHRvIHNhdmUgdGhlIGZvcm0uIjogW251bGwsICJLZXNhbGFoYW4gdGVyamFkaSBzYWF0IG1lbnlpbXBhbiBmb3JtdWxpciBpbmkuIl0sCiAgICAgICAgICAgICAgICAiVGhpcyBjaGF0cm9vbSByZXF1aXJlcyBhIHBhc3N3b3JkIjogW251bGwsICJSdWFuZ2FuIGluaSBtZW1idXR1aGthbiBrYXRhIHNhbmRpIl0sCiAgICAgICAgICAgICAgICAiUGFzc3dvcmQ6ICI6IFtudWxsLCAiS2F0YSBzYW5kaTogIl0sCiAgICAgICAgICAgICAgICAiU3VibWl0IjogW251bGwsICJLaXJpbSJdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBpcyBub3QgYW5vbnltb3VzIjogW251bGwsICJSdWFuZ2FuIGluaSB0aWRhayBhbm9uaW0iXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gbm93IHNob3dzIHVuYXZhaWxhYmxlIG1lbWJlcnMiOiBbbnVsbCwgIlJ1YW5nYW4gaW5pIG1lbmFtcGlsa2FuIGFuZ2dvdGEgeWFuZyB0YWsgdGVyc2VkaWEiXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gZG9lcyBub3Qgc2hvdyB1bmF2YWlsYWJsZSBtZW1iZXJzIjogW251bGwsICJSdWFuZ2FuIGluaSB0aWRhayBtZW5hbXBpbGthbiBhbmdnb3RhIHlhbmcgdGFrIHRlcnNlZGlhIl0sCiAgICAgICAgICAgICAgICAiTm9uLXByaXZhY3ktcmVsYXRlZCByb29tIGNvbmZpZ3VyYXRpb24gaGFzIGNoYW5nZWQiOiBbbnVsbCwgIktvbmZpZ3VyYXNpIHJ1YW5nYW4geWFuZyB0YWsgYmVyaHVidW5nYW4gZGVuZ2FuIHByaXZhc2kgdGVsYWggZGl1YmFoIl0sCiAgICAgICAgICAgICAgICAiUm9vbSBsb2dnaW5nIGlzIG5vdyBlbmFibGVkIjogW251bGwsICJQZW5jYXRhdGFuIGRpIHJ1YW5nYW4gaW5pIHNla2FyYW5nIGRpbnlhbGFrYW4iXSwKICAgICAgICAgICAgICAgICJSb29tIGxvZ2dpbmcgaXMgbm93IGRpc2FibGVkIjogW251bGwsICJQZW5jYXRhdGFuIGRpIHJ1YW5nYW4gaW5pIHNla2FyYW5nIGRpbWF0aWthbiJdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBpcyBub3cgbm9uLWFub255bW91cyI6IFtudWxsLCAiUnVhbmdhbiBpbmkgc2VrYXJhbmcgdGFrLWFub25pbSJdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBpcyBub3cgc2VtaS1hbm9ueW1vdXMiOiBbbnVsbCwgIlJ1YW5nYW4gaW5pIHNla2FyYW5nIHNlbWktYW5vbmltIl0sCiAgICAgICAgICAgICAgICAiVGhpcyByb29tIGlzIG5vdyBmdWxseS1hbm9ueW1vdXMiOiBbbnVsbCwgIlJ1YW5nYW4gaW5pIHNla2FyYW5nIGFub25pbSJdLAogICAgICAgICAgICAgICAgIkEgbmV3IHJvb20gaGFzIGJlZW4gY3JlYXRlZCI6IFtudWxsLCAiUnVhbmdhbiBiYXJ1IHRlbGFoIGRpYnVhdCJdLAogICAgICAgICAgICAgICAgIllvdXIgbmlja25hbWUgaGFzIGJlZW4gY2hhbmdlZCI6IFtudWxsLCAiTmFtYSBwYW5nZ2lsYW4gYW5kYSB0ZWxhaCBkaXViYWgiXSwKICAgICAgICAgICAgICAgICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gaGFzIGJlZW4gYmFubmVkIjogW251bGwsICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gdGVsYWggZGljZWthbCJdLAogICAgICAgICAgICAgICAgIjxzdHJvbmc+JTEkczwvc3Ryb25nPiBoYXMgYmVlbiBraWNrZWQgb3V0IjogW251bGwsICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gdGVsYWggZGl0ZW5kYW5nIGtlbHVhciJdLAogICAgICAgICAgICAgICAgIjxzdHJvbmc+JTEkczwvc3Ryb25nPiBoYXMgYmVlbiByZW1vdmVkIGJlY2F1c2Ugb2YgYW4gYWZmaWxpYXRpb24gY2hhbmdlIjogW251bGwsICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gdGVsYWggZGloYXB1cyBrYXJlbmEgcGVydWJhaGFuIGFmaWxpYXNpIl0sCiAgICAgICAgICAgICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IGhhcyBiZWVuIHJlbW92ZWQgZm9yIG5vdCBiZWluZyBhIG1lbWJlciI6IFtudWxsLCAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IHRlbGFoIGRpaGFwdXMga2FyZW5hIGJ1a2FuIGFuZ2dvdGEiXSwKICAgICAgICAgICAgICAgICJZb3UgaGF2ZSBiZWVuIGJhbm5lZCBmcm9tIHRoaXMgcm9vbSI6IFtudWxsLCAiQW5kYSB0ZWxhaCBkaWNla2FsIGRhcmkgcnVhbmdhbiBpbmkiXSwKICAgICAgICAgICAgICAgICJZb3UgaGF2ZSBiZWVuIGtpY2tlZCBmcm9tIHRoaXMgcm9vbSI6IFtudWxsLCAiQW5kYSB0ZWxhaCBkaXRlbmRhbmcgZGFyaSBydWFuZ2FuIGluaSJdLAogICAgICAgICAgICAgICAgIllvdSBoYXZlIGJlZW4gcmVtb3ZlZCBmcm9tIHRoaXMgcm9vbSBiZWNhdXNlIG9mIGFuIGFmZmlsaWF0aW9uIGNoYW5nZSI6IFtudWxsLCAiQW5kYSB0ZWxhaCBkaWhhcHVzIGRhcmkgcnVhbmdhbiBpbmkga2FyZW5hIHBlcnViYWhhbiBhZmlsaWFzaSJdLAogICAgICAgICAgICAgICAgIllvdSBoYXZlIGJlZW4gcmVtb3ZlZCBmcm9tIHRoaXMgcm9vbSBiZWNhdXNlIHRoZSByb29tIGhhcyBjaGFuZ2VkIHRvIG1lbWJlcnMtb25seSBhbmQgeW91J3JlIG5vdCBhIG1lbWJlciI6IFtudWxsLCAiQW5kYSB0ZWxhaCBkaWhhcHVzIGRhcmkgcnVhbmdhbiBpbmkga2FyZW5hIHJ1YW5nYW4gaW5pIGhhbnlhIHRlcmJ1a2EgdW50dWsgYW5nZ290YSBkYW4gYW5kYSBidWthbiBhbmdnb3RhIl0sCiAgICAgICAgICAgICAgICAiWW91IGhhdmUgYmVlbiByZW1vdmVkIGZyb20gdGhpcyByb29tIGJlY2F1c2UgdGhlIE1VQyAoTXVsdGktdXNlciBjaGF0KSBzZXJ2aWNlIGlzIGJlaW5nIHNodXQgZG93bi4iOiBbbnVsbCwgIkFuZGEgdGVsYWggZGloYXB1cyBkYXJpIHJ1YW5nYW4gaW5pIGthcmVuYSBsYXlhbmFuIE1VQyAoTXVsdGktdXNlciBjaGF0KSB0ZWxhaCBkaW1hdGlrYW4uIl0sCiAgICAgICAgICAgICAgICAiWW91IGFyZSBub3Qgb24gdGhlIG1lbWJlciBsaXN0IG9mIHRoaXMgcm9vbSI6IFtudWxsLCAiQW5kYSBidWthbiBhbmdnb3RhIGRhcmkgcnVhbmdhbiBpbmkiXSwKICAgICAgICAgICAgICAgICJObyBuaWNrbmFtZSB3YXMgc3BlY2lmaWVkIjogW251bGwsICJOYW1hIHBhbmdnaWxhbiBiZWx1bSBkaXRlbnR1a2FuIl0sCiAgICAgICAgICAgICAgICAiWW91IGFyZSBub3QgYWxsb3dlZCB0byBjcmVhdGUgbmV3IHJvb21zIjogW251bGwsICJBbmRhIHRhayBkaWl6aW5rYW4gdW50dWsgbWVtYnVhdCBydWFuZ2FuIGJhcnUiXSwKICAgICAgICAgICAgICAgICJZb3VyIG5pY2tuYW1lIGRvZXNuJ3QgY29uZm9ybSB0byB0aGlzIHJvb20ncyBwb2xpY2llcyI6IFtudWxsLCAiTmFtYSBwYW5nZ2lsYW4gYW5kYSB0aWRhayBzZXN1YWkgYXR1cmFuIHJ1YW5nYW4gaW5pIl0sCiAgICAgICAgICAgICAgICAiWW91ciBuaWNrbmFtZSBpcyBhbHJlYWR5IHRha2VuIjogW251bGwsICJOYW1hIHBhbmdnaWxhbiBhbmRhIHRlbGFoIGRpZ3VuYWthbiBvcmFuZyBsYWluIl0sCiAgICAgICAgICAgICAgICAiVGhpcyByb29tIGRvZXMgbm90ICh5ZXQpIGV4aXN0IjogW251bGwsICJSdWFuZ2FuIGluaSBiZWx1bSBkaWJ1YXQiXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gaGFzIHJlYWNoZWQgaXQncyBtYXhpbXVtIG51bWJlciBvZiBvY2N1cGFudHMiOiBbbnVsbCwgIlJ1YW5nYW4gaW5pIHRlbGFoIG1lbmNhcGFpIGp1bWxhaCBwZW5naHVuaSBtYWtzaW11bSJdLAogICAgICAgICAgICAgICAgIlRvcGljIHNldCBieSAlMSRzIHRvOiAlMiRzIjogW251bGwsICJUb3BpayBkaWdhbnRpIG9sZWggJTEkcyBtZW5qYWRpOiAlMiRzIl0sCiAgICAgICAgICAgICAgICAiVGhpcyB1c2VyIGlzIGEgbW9kZXJhdG9yIjogW251bGwsICJQZW5nZ3VuYSBpbmkgYWRhbGFoIG1vZGVyYXRvciJdLAogICAgICAgICAgICAgICAgIlRoaXMgdXNlciBjYW4gc2VuZCBtZXNzYWdlcyBpbiB0aGlzIHJvb20iOiBbbnVsbCwgIlBlbmdndW5hIGluaSBkYXBhdCBtZW5naXJpbSBwZXNhbiBkaSBydWFuZ2FuIGluaSJdLAogICAgICAgICAgICAgICAgIlRoaXMgdXNlciBjYW4gTk9UIHNlbmQgbWVzc2FnZXMgaW4gdGhpcyByb29tIjogW251bGwsICJQZW5nZ3VuYSBpbmkgdGFrIGRhcGF0IG1lbmdpcmltIHBlc2FuIGRpIHJ1YW5nYW4gaW5pIl0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgdG8gY2hhdCB3aXRoIHRoaXMgY29udGFjdCI6IFtudWxsLCAiS2xpayB1bnR1ayBtdWxhaSBwZXJiaW5qYW5nYW4gZGVuZ2FuIHRlbWFuIGluaSJdLAogICAgICAgICAgICAgICAgIkNsaWNrIHRvIHJlbW92ZSB0aGlzIGNvbnRhY3QiOiBbbnVsbCwgIktsaWsgdW50dWsgbWVuZ2hhcHVzIHRlbWFuIGluaSJdLAogICAgICAgICAgICAgICAgIkNvbnRhY3QgcmVxdWVzdHMiOiBbbnVsbCwgIlBlcm1pbnRhYW4gcGVydGVtYW5hbiJdLAogICAgICAgICAgICAgICAgIk15IGNvbnRhY3RzIjogW251bGwsICJUZW1hbiBzYXlhIl0sCiAgICAgICAgICAgICAgICAiUGVuZGluZyBjb250YWN0cyI6IFtudWxsLCAiVGVtYW4geWFuZyBtZW51bmdndSJdLAogICAgICAgICAgICAgICAgIkN1c3RvbSBzdGF0dXMiOiBbbnVsbCwgIlN0YXR1cyBrdXN0b20iXSwKICAgICAgICAgICAgICAgICJDbGljayB0byBjaGFuZ2UgeW91ciBjaGF0IHN0YXR1cyI6IFtudWxsLCAiS2xpayB1bnR1ayBtZW5nZ2FudGkgc3RhdHVzIl0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgaGVyZSB0byB3cml0ZSBhIGN1c3RvbSBzdGF0dXMgbWVzc2FnZSI6IFtudWxsLCAiS2xpayB1bnR1ayBtZW51bGlzIHN0YXR1cyBrdXN0b20iXSwKICAgICAgICAgICAgICAgICJvbmxpbmUiOiBbbnVsbCwgInRlcmh1YnVuZyJdLAogICAgICAgICAgICAgICAgImJ1c3kiOiBbbnVsbCwgInNpYnVrIl0sCiAgICAgICAgICAgICAgICAiYXdheSBmb3IgbG9uZyI6IFtudWxsLCAibGFtYSB0YWsgZGkgdGVtcGF0Il0sCiAgICAgICAgICAgICAgICAiYXdheSI6IFtudWxsLCAidGFrIGRpIHRlbXBhdCJdLAogICAgICAgICAgICAgICAgIkkgYW0gJTEkcyI6IFtudWxsLCAiU2F5YSAlMSRzIl0sCiAgICAgICAgICAgICAgICAiU2lnbiBpbiI6IFtudWxsLCAiTWFzdWsiXSwKICAgICAgICAgICAgICAgICJYTVBQL0phYmJlciBVc2VybmFtZToiOiBbbnVsbCwgIk5hbWEgcGVuZ2d1bmEgWE1QUC9KYWJiZXI6Il0sCiAgICAgICAgICAgICAgICAiUGFzc3dvcmQ6IjogW251bGwsICJLYXRhIHNhbmRpOiJdLAogICAgICAgICAgICAgICAgIkxvZyBJbiI6IFtudWxsLCAiTWFzdWsiXSwKICAgICAgICAgICAgICAgICJCT1NIIFNlcnZpY2UgVVJMOiI6IFtudWxsLCAiVVJMIExheWFuYW4gQk9TSDoiXQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIGlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHsKICAgICAgICBkZWZpbmUoImlkIiwgWydqZWQnXSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gZmFjdG9yeShuZXcgSmVkKHRyYW5zbGF0aW9ucykpOwogICAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgICBpZiAoIXdpbmRvdy5sb2NhbGVzKSB7CiAgICAgICAgICAgIHdpbmRvdy5sb2NhbGVzID0ge307CiAgICAgICAgfQogICAgICAgIHdpbmRvdy5sb2NhbGVzLmlkID0gZmFjdG9yeShuZXcgSmVkKHRyYW5zbGF0aW9ucykpOwogICAgfQp9KHRoaXMsIGZ1bmN0aW9uIChpZCkgeyAKICAgIHJldHVybiBpZDsgCn0pKTsKCihmdW5jdGlvbiAocm9vdCwgZmFjdG9yeSkgewogICAgdmFyIHRyYW5zbGF0aW9ucyA9IHsKICAgICAgICAiZG9tYWluIjogImNvbnZlcnNlIiwKICAgICAgICAibG9jYWxlX2RhdGEiOiB7CiAgICAgICAgICAgICJjb252ZXJzZSI6IHsKICAgICAgICAgICAgICAgICIiOiB7CiAgICAgICAgICAgICAgICAgICAgIlByb2plY3QtSWQtVmVyc2lvbiI6ICJDb252ZXJzZS5qcyAwLjQiLAogICAgICAgICAgICAgICAgICAgICJSZXBvcnQtTXNnaWQtQnVncy1UbyI6ICIiLAogICAgICAgICAgICAgICAgICAgICJQT1QtQ3JlYXRpb24tRGF0ZSI6ICIyMDEzLTA5LTE1IDIxOjU1KzAyMDAiLAogICAgICAgICAgICAgICAgICAgICJQTy1SZXZpc2lvbi1EYXRlIjogIjIwMTMtMDktMTUgMjI6MDArMDIwMCIsCiAgICAgICAgICAgICAgICAgICAgIkxhc3QtVHJhbnNsYXRvciI6ICJGYWJpbyBCYXMgPGN0cmxhbHRjYUBnbWFpbC5jb20+IiwKICAgICAgICAgICAgICAgICAgICAiTGFuZ3VhZ2UtVGVhbSI6ICJJdGFsaWFuIiwKICAgICAgICAgICAgICAgICAgICAiTGFuZ3VhZ2UiOiAiaXQiLAogICAgICAgICAgICAgICAgICAgICJNSU1FLVZlcnNpb24iOiAiMS4wIiwKICAgICAgICAgICAgICAgICAgICAiQ29udGVudC1UeXBlIjogInRleHQvcGxhaW47IGNoYXJzZXQ9VVRGLTgiLAogICAgICAgICAgICAgICAgICAgICJDb250ZW50LVRyYW5zZmVyLUVuY29kaW5nIjogIjhiaXQiLAogICAgICAgICAgICAgICAgICAgICJQbHVyYWwtRm9ybXMiOiAibnBsdXJhbHM9MjsgcGx1cmFsPShuICE9IDEpOyIsCiAgICAgICAgICAgICAgICAgICAgImRvbWFpbiI6ICJjb252ZXJzZSIsCiAgICAgICAgICAgICAgICAgICAgImxhbmciOiAiaXQiLAogICAgICAgICAgICAgICAgICAgICJwbHVyYWxfZm9ybXMiOiAibnBsdXJhbHM9MjsgcGx1cmFsPShuICE9IDEpOyIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAidW5lbmNyeXB0ZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJ1bnZlcmlmaWVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAidmVyaWZpZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJmaW5pc2hlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkRpc2Nvbm5lY3RlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJEaXNjb25uZXNzbyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiRXJyb3IiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRXJyb3JlIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb25uZWN0aW5nIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkNvbm5lc3Npb25lIGluIGNvcnNvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb25uZWN0aW9uIEZhaWxlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDb25uZXNzaW9uZSBmYWxsaXRhIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJBdXRoZW50aWNhdGluZyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJBdXRlbnRpY2F6aW9uZSBpbiBjb3JzbyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQXV0aGVudGljYXRpb24gRmFpbGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkF1dGVudGljYXppb25lIGZhbGxpdGEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkRpc2Nvbm5lY3RpbmciOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRGlzY29ubmVzc2lvbmUgaW4gY29yc28iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJlLWVzdGFibGlzaGluZyBlbmNyeXB0ZWQgc2Vzc2lvbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgYnJvd3NlciBuZWVkcyB0byBnZW5lcmF0ZSBhIHByaXZhdGUga2V5LCB3aGljaCB3aWxsIGJlIHVzZWQgaW4geW91ciBlbmNyeXB0ZWQgY2hhdCBzZXNzaW9uLiBUaGlzIGNhbiB0YWtlIHVwIHRvIDMwIHNlY29uZHMgZHVyaW5nIHdoaWNoIHlvdXIgYnJvd3NlciBtaWdodCBmcmVlemUgYW5kIGJlY29tZSB1bnJlc3BvbnNpdmUuIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUHJpdmF0ZSBrZXkgZ2VuZXJhdGVkLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkF1dGhlbnRpY2F0aW9uIHJlcXVlc3QgZnJvbSAlMSRzXG5cbllvdXIgYnVkZHkgaXMgYXR0ZW1wdGluZyB0byB2ZXJpZnkgeW91ciBpZGVudGl0eSwgYnkgYXNraW5nIHlvdSB0aGUgcXVlc3Rpb24gYmVsb3cuXG5cbiUyJHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb3VsZCBub3QgdmVyaWZ5IHRoaXMgdXNlcidzIGlkZW50aWZ5LiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlBlcnNvbmFsIG1lc3NhZ2UiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTWVzc2FnZ2lvIHBlcnNvbmFsZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU3RhcnQgZW5jcnlwdGVkIGNvbnZlcnNhdGlvbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJlZnJlc2ggZW5jcnlwdGVkIGNvbnZlcnNhdGlvbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkVuZCBlbmNyeXB0ZWQgY29udmVyc2F0aW9uIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVmVyaWZ5IHdpdGggU01QIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVmVyaWZ5IHdpdGggZmluZ2VycHJpbnRzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiV2hhdCdzIHRoaXM/IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAibWUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTaG93IHRoaXMgbWVudSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJNb3N0cmEgcXVlc3RvIG1lbnUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIldyaXRlIGluIHRoZSB0aGlyZCBwZXJzb24iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU2NyaXZpIGluIHRlcnphIHBlcnNvbmEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJlbW92ZSBtZXNzYWdlcyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJSaW11b3ZpIG1lc3NhZ2dpIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG1lc3NhZ2UgY291bGQgbm90IGJlIHNlbnQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJXZSByZWNlaXZlZCBhbiB1bmVuY3J5cHRlZCBtZXNzYWdlIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiV2UgcmVjZWl2ZWQgYW4gdW5yZWFkYWJsZSBlbmNyeXB0ZWQgbWVzc2FnZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgdXNlciBoYXMgcmVxdWVzdGVkIGFuIGVuY3J5cHRlZCBzZXNzaW9uLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkhlcmUgYXJlIHRoZSBmaW5nZXJwcmludHMsIHBsZWFzZSBjb25maXJtIHRoZW0gd2l0aCAlMSRzLCBvdXRzaWRlIG9mIHRoaXMgY2hhdC5cblxuRmluZ2VycHJpbnQgZm9yIHlvdSwgJTIkczogJTMkc1xuXG5GaW5nZXJwcmludCBmb3IgJTEkczogJTQkc1xuXG5JZiB5b3UgaGF2ZSBjb25maXJtZWQgdGhhdCB0aGUgZmluZ2VycHJpbnRzIG1hdGNoLCBjbGljayBPSywgb3RoZXJ3aXNlIGNsaWNrIENhbmNlbC4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3Ugd2lsbCBiZSBwcm9tcHRlZCB0byBwcm92aWRlIGEgc2VjdXJpdHkgcXVlc3Rpb24gYW5kIHRoZW4gYW4gYW5zd2VyIHRvIHRoYXQgcXVlc3Rpb24uXG5cbllvdXIgYnVkZHkgd2lsbCB0aGVuIGJlIHByb21wdGVkIHRoZSBzYW1lIHF1ZXN0aW9uIGFuZCBpZiB0aGV5IHR5cGUgdGhlIGV4YWN0IHNhbWUgYW5zd2VyIChjYXNlIHNlbnNpdGl2ZSksIHRoZWlyIGlkZW50aXR5IHdpbGwgaGF2ZSBiZWVuIHZlcmlmaWVkLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIldoYXQgaXMgeW91ciBzZWN1cml0eSBxdWVzdGlvbj8iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJXaGF0IGlzIHRoZSBhbnN3ZXIgdG8gdGhlIHNlY3VyaXR5IHF1ZXN0aW9uPyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkludmFsaWQgYXV0aGVudGljYXRpb24gc2NoZW1lIHByb3ZpZGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBtZXNzYWdlcyBhcmUgbm90IGVuY3J5cHRlZCBhbnltb3JlIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBtZXNzYWdlcyBhcmUgbm93IGVuY3J5cHRlZCBidXQgeW91ciBidWRkeSdzIGlkZW50aXR5IGhhcyBub3QgYmVlbiB2ZXJpZmllZC4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIGJ1ZGR5J3MgaWRlbnRpZnkgaGFzIGJlZW4gdmVyaWZpZWQuIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBidWRkeSBoYXMgZW5kZWQgZW5jcnlwdGlvbiBvbiB0aGVpciBlbmQsIHlvdSBzaG91bGQgZG8gdGhlIHNhbWUuIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBtZXNzYWdlcyBhcmUgbm90IGVuY3J5cHRlZC4gQ2xpY2sgaGVyZSB0byBlbmFibGUgT1RSIGVuY3J5cHRpb24uIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBtZXNzYWdlcyBhcmUgZW5jcnlwdGVkLCBidXQgeW91ciBidWRkeSBoYXMgbm90IGJlZW4gdmVyaWZpZWQuIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBtZXNzYWdlcyBhcmUgZW5jcnlwdGVkIGFuZCB5b3VyIGJ1ZGR5IHZlcmlmaWVkLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgYnVkZHkgaGFzIGNsb3NlZCB0aGVpciBlbmQgb2YgdGhlIHByaXZhdGUgc2Vzc2lvbiwgeW91IHNob3VsZCBkbyB0aGUgc2FtZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNvbnRhY3RzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkNvbnRhdHRpIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJPbmxpbmUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSW4gbGluZWEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkJ1c3kiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiT2NjdXBhdG8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkF3YXkiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQXNzZW50ZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiT2ZmbGluZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJOb24gaW4gbGluZWEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNsaWNrIHRvIGFkZCBuZXcgY2hhdCBjb250YWN0cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDbGljY2EgcGVyIGFnZ2l1bmdlcmUgbnVvdmkgY29udGF0dGkgYWxsYSBjaGF0IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJBZGQgYSBjb250YWN0IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkFnZ2l1bmdpIGNvbnRhdHRpIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb250YWN0IHVzZXJuYW1lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk5vbWUgdXRlbnRlIGRlbCBjb250YXR0byIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQWRkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkFnZ2l1bmdpIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb250YWN0IG5hbWUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTm9tZSBkZWwgY29udGF0dG8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNlYXJjaCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDZXJjYSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTm8gdXNlcnMgZm91bmQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTmVzc3VuIHV0ZW50ZSB0cm92YXRvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDbGljayB0byBhZGQgYXMgYSBjaGF0IGNvbnRhY3QiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQ2xpY2NhIHBlciBhZ2dpdW5nZXJlIGlsIGNvbnRhdHRvIGFsbGEgY2hhdCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgdG8gb3BlbiB0aGlzIHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQ2xpY2NhIHBlciBhcHJpcmUgcXVlc3RhIHN0YW56YSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU2hvdyBtb3JlIGluZm9ybWF0aW9uIG9uIHRoaXMgcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJNb3N0cmEgcGnDuSBpbmZvcm1hemlvbmkgc3UgcXVlc3RhIHN0YW56YSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiRGVzY3JpcHRpb246IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkRlc2NyaXppb25lOiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiT2NjdXBhbnRzOiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJVdGVudGkgcHJlc2VudGk6IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJGZWF0dXJlczoiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRnVuemlvbmFsaXTDoDoiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJlcXVpcmVzIGF1dGhlbnRpY2F0aW9uIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlJpY2hpZWRlIGF1dGVudGljYXppb25lIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJIaWRkZW4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTmFzY29zdGEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJlcXVpcmVzIGFuIGludml0YXRpb24iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiUmljaGllZGUgdW4gaW52aXRvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJNb2RlcmF0ZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTW9kZXJhdGEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk5vbi1hbm9ueW1vdXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTm9uLWFub25pbWEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk9wZW4gcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTdGFuemEgYXBlcnRhIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJQZXJtYW5lbnQgcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTdGFuemEgcGVybWFuZW50ZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUHVibGljIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlB1YmJsaWNhIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTZW1pLWFub255bW91cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTZW1pLWFub25pbWEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRlbXBvcmFyeSByb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlN0YW56YSB0ZW1wb3JhbmVhIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJVbm1vZGVyYXRlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJOb24gbW9kZXJhdGEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJvb21zIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlN0YW56ZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUm9vbSBuYW1lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk5vbWUgc3RhbnphIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJOaWNrbmFtZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTb3ByYW5ub21lIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTZXJ2ZXIiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU2VydmVyIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJKb2luIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkVudHJhIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTaG93IHJvb21zIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk1vc3RyYSBzdGFuemUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk5vIHJvb21zIG9uICUxJHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTmVzc3VuYSBzdGFuemEgc3UgJTEkcyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUm9vbXMgb24gJTEkcyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTdGFuemUgc3UgJTEkcyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU2V0IGNoYXRyb29tIHRvcGljIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkNhbWJpYSBvZ2dldHRvIGRlbGxhIHN0YW56YSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiS2ljayB1c2VyIGZyb20gY2hhdHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRXNwZWxsaSB1dGVudGUgZGFsbGEgc3RhbnphIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJCYW4gdXNlciBmcm9tIGNoYXRyb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkJhbmRpc2NpIHV0ZW50ZSBkYWxsYSBzdGFuemEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk1lc3NhZ2UiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTWVzc2FnZ2lvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTYXZlIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlNhbHZhIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDYW5jZWwiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQW5udWxsYSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQW4gZXJyb3Igb2NjdXJyZWQgd2hpbGUgdHJ5aW5nIHRvIHNhdmUgdGhlIGZvcm0uIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkVycm9yZSBkdXJhbnRlIGlsIHNhbHZhdGFnZ2lvIGRlbCBtb2R1bG8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgY2hhdHJvb20gcmVxdWlyZXMgYSBwYXNzd29yZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJRdWVzdGEgc3RhbnphIHJpY2hpZWRlIHVuYSBwYXNzd29yZCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUGFzc3dvcmQ6ICI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJQYXNzd29yZDogIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTdWJtaXQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSW52aWEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBpcyBub3QgYW5vbnltb3VzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlF1ZXN0YSBzdGFuemEgbm9uIMOoIGFub25pbWEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBub3cgc2hvd3MgdW5hdmFpbGFibGUgbWVtYmVycyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJRdWVzdGEgc3RhbnphIG1vc3RyYSBpIG1lbWJyaSBub24gZGlzcG9uaWJpbGkgYWwgbW9tZW50byIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyByb29tIGRvZXMgbm90IHNob3cgdW5hdmFpbGFibGUgbWVtYmVycyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJRdWVzdGEgc3RhbnphIG5vbiBtb3N0cmEgaSBtZW1icmkgbm9uIGRpc3BvbmliaWxpIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJOb24tcHJpdmFjeS1yZWxhdGVkIHJvb20gY29uZmlndXJhdGlvbiBoYXMgY2hhbmdlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJVbmEgY29uZmlndXJhemlvbmUgZGVsbGEgc3RhbnphIG5vbiBsZWdhdGEgYWxsYSBwcml2YWN5IMOoIHN0YXRhIG1vZGlmaWNhdGEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJvb20gbG9nZ2luZyBpcyBub3cgZW5hYmxlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJMYSByZWdpc3RyYXppb25lIMOoIGFiaWxpdGF0YSBuZWxsYSBzdGFuemEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJvb20gbG9nZ2luZyBpcyBub3cgZGlzYWJsZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTGEgcmVnaXN0cmF6aW9uZSDDqCBkaXNhYmlsaXRhdGEgbmVsbGEgc3RhbnphIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gaXMgbm93IG5vbi1hbm9ueW1vdXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiUXVlc3RhIHN0YW56YSDDqCBub24tYW5vbmltYSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyByb29tIGlzIG5vdyBzZW1pLWFub255bW91cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJRdWVzdGEgc3RhbnphIMOoIHNlbWktYW5vbmltYSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyByb29tIGlzIG5vdyBmdWxseS1hbm9ueW1vdXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiUXVlc3RhIHN0YW56YSDDqCBjb21wbGV0YW1lbnRlLWFub25pbWEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkEgbmV3IHJvb20gaGFzIGJlZW4gY3JlYXRlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJVbmEgbnVvdmEgc3RhbnphIMOoIHN0YXRhIGNyZWF0YSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBuaWNrbmFtZSBoYXMgYmVlbiBjaGFuZ2VkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIklsIHR1byBzb3ByYW5ub21lIMOoIHN0YXRvIGNhbWJpYXRvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gaGFzIGJlZW4gYmFubmVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIjxzdHJvbmc+JTEkczwvc3Ryb25nPiDDqCBzdGF0byBiYW5kaXRvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gaGFzIGJlZW4ga2lja2VkIG91dCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gw6ggc3RhdG8gZXNwdWxzbyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IGhhcyBiZWVuIHJlbW92ZWQgYmVjYXVzZSBvZiBhbiBhZmZpbGlhdGlvbiBjaGFuZ2UiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IMOoIHN0YXRvIHJpbW9zc28gYSBjYXVzYSBkaSB1biBjYW1iaW8gZGkgYWZmaWxpYXppb25lIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gaGFzIGJlZW4gcmVtb3ZlZCBmb3Igbm90IGJlaW5nIGEgbWVtYmVyIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIjxzdHJvbmc+JTEkczwvc3Ryb25nPiDDqCBzdGF0byByaW1vc3NvIGluIHF1YW50byBub24gbWVtYnJvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3UgaGF2ZSBiZWVuIGJhbm5lZCBmcm9tIHRoaXMgcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTZWkgc3RhdG8gYmFuZGl0byBkYSBxdWVzdGEgc3RhbnphIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3UgaGF2ZSBiZWVuIGtpY2tlZCBmcm9tIHRoaXMgcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTZWkgc3RhdG8gZXNwdWxzbyBkYSBxdWVzdGEgc3RhbnphIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3UgaGF2ZSBiZWVuIHJlbW92ZWQgZnJvbSB0aGlzIHJvb20gYmVjYXVzZSBvZiBhbiBhZmZpbGlhdGlvbiBjaGFuZ2UiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU2VpIHN0YXRvIHJpbW9zc28gZGEgcXVlc3RhIHN0YW56YSBhIGNhdXNhIGRpIHVuIGNhbWJpbyBkaSBhZmZpbGlhemlvbmUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdSBoYXZlIGJlZW4gcmVtb3ZlZCBmcm9tIHRoaXMgcm9vbSBiZWNhdXNlIHRoZSByb29tIGhhcyBjaGFuZ2VkIHRvIG1lbWJlcnMtb25seSBhbmQgeW91J3JlIG5vdCBhIG1lbWJlciI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTZWkgc3RhdG8gcmltb3NzbyBkYSBxdWVzdGEgc3RhbnphIHBvaWNow6kgb3JhIGxhIHN0YW56YSBhY2NldHRhIHNvbG8gbWVtYnJpIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3UgaGF2ZSBiZWVuIHJlbW92ZWQgZnJvbSB0aGlzIHJvb20gYmVjYXVzZSB0aGUgTVVDIChNdWx0aS11c2VyIGNoYXQpIHNlcnZpY2UgaXMgYmVpbmcgc2h1dCBkb3duLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTZWkgc3RhdG8gcmltb3NzbyBkYSBxdWVzdGEgc3RhbnphIHBvaWNow6kgaWwgc2Vydml6aW8gTVVDIChDaGF0IG11bHRpIHV0ZW50ZSkgw6ggaW4gZmFzZSBkaSBzcGVnbmltZW50byIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91IGFyZSBub3Qgb24gdGhlIG1lbWJlciBsaXN0IG9mIHRoaXMgcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJOb24gc2VpIG5lbGxhIGxpc3RhIGRlaSBtZW1icmkgZGkgcXVlc3RhIHN0YW56YSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTm8gbmlja25hbWUgd2FzIHNwZWNpZmllZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJOZXNzdW4gc29wcmFubm9tZSBzcGVjaWZpY2F0byIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91IGFyZSBub3QgYWxsb3dlZCB0byBjcmVhdGUgbmV3IHJvb21zIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk5vbiB0aSDDqCBwZXJtZXNzbyBjcmVhcmUgbnVvdmUgc3RhbnplIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG5pY2tuYW1lIGRvZXNuJ3QgY29uZm9ybSB0byB0aGlzIHJvb20ncyBwb2xpY2llcyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJJbCB0dW8gc29wcmFubm9tZSBub24gw6ggY29uZm9ybWUgYWxsZSByZWdvbGUgZGkgcXVlc3RhIHN0YW56YSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBuaWNrbmFtZSBpcyBhbHJlYWR5IHRha2VuIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIklsIHR1byBzb3ByYW5ub21lIMOoIGdpw6AgdXRpbGl6emF0byIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyByb29tIGRvZXMgbm90ICh5ZXQpIGV4aXN0IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlF1ZXN0YSBzdGFuemEgbm9uIGVzaXN0ZSAocGVyIG9yYSkiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBoYXMgcmVhY2hlZCBpdCdzIG1heGltdW0gbnVtYmVyIG9mIG9jY3VwYW50cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJRdWVzdGEgc3RhbnphIGhhIHJhZ2dpdW50byBpbCBsaW1pdGUgbWFzc2ltbyBkaSB1dGVudGkiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRvcGljIHNldCBieSAlMSRzIHRvOiAlMiRzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlRvcGljIGltcG9zdGF0byBkYSAlMSRzIGE6ICUyJHMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgdXNlciBpcyBhIG1vZGVyYXRvciI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJRdWVzdG8gdXRlbnRlIMOoIHVuIG1vZGVyYXRvcmUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgdXNlciBjYW4gc2VuZCBtZXNzYWdlcyBpbiB0aGlzIHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiUXVlc3RvIHV0ZW50ZSBwdcOyIGludmlhcmUgbWVzc2FnZ2kgaW4gcXVlc3RhIHN0YW56YSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyB1c2VyIGNhbiBOT1Qgc2VuZCBtZXNzYWdlcyBpbiB0aGlzIHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiUXVlc3RvIHV0ZW50ZSBOT04gcHXDsiBpbnZpYXJlIG1lc3NhZ2dpIGluIHF1ZXN0YSBzdGFuemEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNsaWNrIHRvIGNoYXQgd2l0aCB0aGlzIGNvbnRhY3QiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQ2xpY2NhIHBlciBwYXJsYXJlIGNvbiBxdWVzdG8gY29udGF0dG8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNsaWNrIHRvIHJlbW92ZSB0aGlzIGNvbnRhY3QiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQ2xpY2NhIHBlciByaW11b3ZlcmUgcXVlc3RvIGNvbnRhdHRvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIGNvbnRhY3QgaXMgYnVzeSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgY29udGFjdCBpcyBvbmxpbmUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIGNvbnRhY3QgaXMgb2ZmbGluZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgY29udGFjdCBpcyB1bmF2YWlsYWJsZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJRdWVzdGEgc3RhbnphIG1vc3RyYSBpIG1lbWJyaSBub24gZGlzcG9uaWJpbGkgYWwgbW9tZW50byIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyBjb250YWN0IGlzIGF3YXkgZm9yIGFuIGV4dGVuZGVkIHBlcmlvZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgY29udGFjdCBpcyBhd2F5IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ29udGFjdCByZXF1ZXN0cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJSaWNoaWVzdGUgZGVpIGNvbnRhdHRpIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJNeSBjb250YWN0cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJJIG1pZWkgY29udGF0dGkiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlBlbmRpbmcgY29udGFjdHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQ29udGF0dGkgaW4gYXR0ZXNhIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDdXN0b20gc3RhdHVzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlN0YXRvIHBlcnNvbmFsaXp6YXRvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDbGljayB0byBjaGFuZ2UgeW91ciBjaGF0IHN0YXR1cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDbGljY2EgcGVyIGNhbWJpYXJlIGlsIHR1byBzdGF0byIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgaGVyZSB0byB3cml0ZSBhIGN1c3RvbSBzdGF0dXMgbWVzc2FnZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDbGljY2EgcXVpIHBlciBzY3JpdmVyZSB1biBtZXNzYWdnaW8gZGkgc3RhdG8gcGVyc29uYWxpenphdG8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIm9ubGluZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJpbiBsaW5lYSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiYnVzeSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJvY2N1cGF0byIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiYXdheSBmb3IgbG9uZyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJhc3NlbnRlIGRhIG1vbHRvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJhd2F5IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgImFzc2VudGUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkkgYW0gJTEkcyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTb25vICUxJHMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNpZ24gaW4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQWNjZXNzbyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWE1QUC9KYWJiZXIgVXNlcm5hbWU6IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk5vbWUgdXRlbnRlOiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUGFzc3dvcmQ6IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlBhc3N3b3JkOiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTG9nIEluIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkVudHJhIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJCT1NIIFNlcnZpY2UgVVJMOiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJJbmRpcml6em8gc2Vydml6aW8gQk9TSDoiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk9ubGluZSBDb250YWN0cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDb250YXR0aSBpbiBsaW5lYSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ29ubmVjdGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkNvbm5lc3NvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJBdHRhY2hlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJBbGxlZ2F0byIKICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7CiAgICAgICAgZGVmaW5lKCJpdCIsIFsnamVkJ10sIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkobmV3IEplZCh0cmFuc2xhdGlvbnMpKTsKICAgICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKCF3aW5kb3cubG9jYWxlcykgewogICAgICAgICAgICB3aW5kb3cubG9jYWxlcyA9IHt9OwogICAgICAgIH0KICAgICAgICB3aW5kb3cubG9jYWxlcy5pdCA9IGZhY3RvcnkobmV3IEplZCh0cmFuc2xhdGlvbnMpKTsKICAgIH0KfSh0aGlzLCBmdW5jdGlvbiAoaXQpIHsgCiAgICByZXR1cm4gaXQ7IAp9KSk7CgooZnVuY3Rpb24gKHJvb3QsIGZhY3RvcnkpIHsKICAgIHZhciB0cmFuc2xhdGlvbnMgPSB7CiAgICAgICAgImRvbWFpbiI6ICJjb252ZXJzZSIsCiAgICAgICAgImxvY2FsZV9kYXRhIjogewogICAgICAgICAgICAiY29udmVyc2UiOiB7CiAgICAgICAgICAgICAgICAiIjogewogICAgICAgICAgICAgICAgICAgICJQcm9qZWN0LUlkLVZlcnNpb24iOiAiQ29udmVyc2UuanMgMC40IiwKICAgICAgICAgICAgICAgICAgICAiUmVwb3J0LU1zZ2lkLUJ1Z3MtVG8iOiAiIiwKICAgICAgICAgICAgICAgICAgICAiUE9ULUNyZWF0aW9uLURhdGUiOiAiMjAxNC0wMS0wNyAxMToxMiswOTAwIiwKICAgICAgICAgICAgICAgICAgICAiUE8tUmV2aXNpb24tRGF0ZSI6ICIyMDE0LTAxLTA3IDExOjMyKzA5MDAiLAogICAgICAgICAgICAgICAgICAgICJMYXN0LVRyYW5zbGF0b3IiOiAiTWFrbyBOIDxtYWtvQHBhc2Vyby5uZXQ+IiwKICAgICAgICAgICAgICAgICAgICAiTGFuZ3VhZ2UtVGVhbSI6ICJMYW5ndWFnZSBKQSIsCiAgICAgICAgICAgICAgICAgICAgIkxhbmd1YWdlIjogIkpBIiwKICAgICAgICAgICAgICAgICAgICAiTUlNRS1WZXJzaW9uIjogIjEuMCIsCiAgICAgICAgICAgICAgICAgICAgIkNvbnRlbnQtVHlwZSI6ICJ0ZXh0L3BsYWluOyBjaGFyc2V0PVVURi04IiwKICAgICAgICAgICAgICAgICAgICAiQ29udGVudC1UcmFuc2Zlci1FbmNvZGluZyI6ICI4Yml0IiwKICAgICAgICAgICAgICAgICAgICAiUGx1cmFsLUZvcm1zIjogIm5wbHVyYWxzPTE7IHBsdXJhbD0wOyIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAidW5lbmNyeXB0ZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi5pqX5Y+35YyW44GV44KM44Gm44GE44G+44Gb44KTIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJ1bnZlcmlmaWVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuaknOiovOOBleOCjOOBpuOBhOOBvuOBm+OCkyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAidmVyaWZpZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi5qSc6Ki844GV44KM44G+44GX44GfIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJmaW5pc2hlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLlrozkuoYiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgY29udGFjdCBpcyBidXN5IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuOBk+OBruebuOaJi+WFiOOBr+WPluOCiui+vOOBv+S4reOBp+OBmSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyBjb250YWN0IGlzIG9ubGluZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLjgZPjga7nm7jmiYvlhYjjga/lnKjluK3jgZfjgabjgYTjgb7jgZkiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgY29udGFjdCBpcyBvZmZsaW5lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuOBk+OBruebuOaJi+WFiOOBr+OCquODleODqeOCpOODs+OBp+OBmSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyBjb250YWN0IGlzIHVuYXZhaWxhYmxlIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuOBk+OBruebuOaJi+WFiOOBr+S4jemAmuOBp+OBmSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyBjb250YWN0IGlzIGF3YXkgZm9yIGFuIGV4dGVuZGVkIHBlcmlvZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLjgZPjga7nm7jmiYvlhYjjga/kuI3lnKjjgafjgZkiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgY29udGFjdCBpcyBhd2F5IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuOBk+OBruebuOaJi+WFiOOBr+mbouW4reS4reOBp+OBmSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiRGlzY29ubmVjdGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuWIh+aWreS4rSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiRXJyb3IiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi44Ko44Op44O8IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb25uZWN0aW5nIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuaOpee2muS4reOBp+OBmSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ29ubmVjdGlvbiBGYWlsZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi5o6l57aa44Gr5aSx5pWX44GX44G+44GX44GfIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJBdXRoZW50aWNhdGluZyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLoqo3oqLzkuK0iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkF1dGhlbnRpY2F0aW9uIEZhaWxlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLoqo3oqLzjgavlpLHmlZciCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkRpc2Nvbm5lY3RpbmciOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi5YiH5patIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJPbmxpbmUgQ29udGFjdHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi44Kq44Oz44Op44Kk44Oz44Gu55u45omL5YWIIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSZS1lc3RhYmxpc2hpbmcgZW5jcnlwdGVkIHNlc3Npb24iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi5pqX5Y+35YyW44K744OD44K344On44Oz44Gu5YaN5o6l57aaIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIGJyb3dzZXIgbmVlZHMgdG8gZ2VuZXJhdGUgYSBwcml2YXRlIGtleSwgd2hpY2ggd2lsbCBiZSB1c2VkIGluIHlvdXIgZW5jcnlwdGVkIGNoYXQgc2Vzc2lvbi4gVGhpcyBjYW4gdGFrZSB1cCB0byAzMCBzZWNvbmRzIGR1cmluZyB3aGljaCB5b3VyIGJyb3dzZXIgbWlnaHQgZnJlZXplIGFuZCBiZWNvbWUgdW5yZXNwb25zaXZlLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLmmpflj7fljJbjg4Hjg6Pjg4Pjg4jjgafkvb/nlKjjgZnjgovnp5jlr4bpjbXjgpLnlJ/miJDjgZnjgovlv4XopoHjgYzjgYLjgorjgb7jgZnjgILjgZPjgozjgavjga8zMOenkuOBu+OBqeOBi+OBi+OCiuOAgeOBneOBruOBguOBhOOBoOODluODqeOCpuOCtuOBjOODleODquODvOOCuuOBl+OBpuWPjeW/nOOBl+OBquOBhOOBi+OCguOBl+OCjOOBvuOBm+OCk+OAgiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUHJpdmF0ZSBrZXkgZ2VuZXJhdGVkLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLnp5jlr4bpjbXjgpLnlJ/miJDjgZfjgb7jgZfjgZ/jgIIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkF1dGhlbnRpY2F0aW9uIHJlcXVlc3QgZnJvbSAlMSRzXG5cbllvdXIgYnVkZHkgaXMgYXR0ZW1wdGluZyB0byB2ZXJpZnkgeW91ciBpZGVudGl0eSwgYnkgYXNraW5nIHlvdSB0aGUgcXVlc3Rpb24gYmVsb3cuXG5cbiUyJHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiJTEkcyDjgYvjgonjga7oqo3oqLzjga7jg6rjgq/jgqjjgrnjg4hcblxu55u45omL44Gv44GC44Gq44Gf44Gu5pys5Lq65oCn44KS5qSc6Ki844GX44KI44GG44Go44GX44Gm44GE44G+44GZ44CC5qyh44Gu6LOq5ZWP44Gr562U44GI44Gm44GP44Gg44GV44GE44CCXG5cbiUyJHMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNvdWxkIG5vdCB2ZXJpZnkgdGhpcyB1c2VyJ3MgaWRlbnRpZnkuIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuOBk+OBruODpuODvOOCtuODvOOBruacrOS6uuaAp+OCkuaknOiovOOBp+OBjeOBvuOBm+OCk+OBp+OBl+OBn+OAgiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUGVyc29uYWwgbWVzc2FnZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLnp4Hkv6EiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlN0YXJ0IGVuY3J5cHRlZCBjb252ZXJzYXRpb24iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi5pqX5Y+35YyW44GV44KM44Gf5Lya6Kmx44KS6ZaL5aeLIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSZWZyZXNoIGVuY3J5cHRlZCBjb252ZXJzYXRpb24iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi5pqX5Y+35YyW44GV44KM44Gf5Lya6Kmx44KS44Oq44OV44Os44OD44K344OlIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJFbmQgZW5jcnlwdGVkIGNvbnZlcnNhdGlvbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLmmpflj7fljJbjgZXjgozjgZ/kvJroqbHjgpLntYLkuoYiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlZlcmlmeSB3aXRoIFNNUCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTTVAg44Gn5qSc6Ki8IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJWZXJpZnkgd2l0aCBmaW5nZXJwcmludHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi6Y215oyH57SL44Gn5qSc6Ki8IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJXaGF0J3MgdGhpcz8iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi44GT44KM44Gv5L2V44Gn44GZ44GLPyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAibWUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi56eBIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTaG93IHRoaXMgbWVudSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLjgZPjga7jg6Hjg4vjg6Xjg7zjgpLooajnpLoiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIldyaXRlIGluIHRoZSB0aGlyZCBwZXJzb24iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi56ys5LiJ6ICF44Gr5pu444GPIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSZW1vdmUgbWVzc2FnZXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi44Oh44OD44K744O844K444KS5YmK6ZmkIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG1lc3NhZ2UgY291bGQgbm90IGJlIHNlbnQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi44Oh44OD44K744O844K444KS6YCB5L+h44Gn44GN44G+44Gb44KT44Gn44GX44GfIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJXZSByZWNlaXZlZCBhbiB1bmVuY3J5cHRlZCBtZXNzYWdlIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuaal+WPt+WMluOBleOCjOOBpuOBhOOBquOBhOODoeODg+OCu+ODvOOCuOOCkuWPl+S/oeOBl+OBvuOBl+OBnyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiV2UgcmVjZWl2ZWQgYW4gdW5yZWFkYWJsZSBlbmNyeXB0ZWQgbWVzc2FnZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLoqq3jgoHjgarjgYTmmpflj7fljJbjg6Hjg4Pjgrvjg7zjgrjjgpLlj5fkv6HjgZfjgb7jgZfjgZ8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgdXNlciBoYXMgcmVxdWVzdGVkIGFuIGVuY3J5cHRlZCBzZXNzaW9uLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLjgZPjga7jg6bjg7zjgrbjg7zjga/mmpflj7fljJbjgrvjg4Pjgrfjg6fjg7PjgpLmsYLjgoHjgabjgYTjgb7jgZnjgIIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkhlcmUgYXJlIHRoZSBmaW5nZXJwcmludHMsIHBsZWFzZSBjb25maXJtIHRoZW0gd2l0aCAlMSRzLCBvdXRzaWRlIG9mIHRoaXMgY2hhdC5cblxuRmluZ2VycHJpbnQgZm9yIHlvdSwgJTIkczogJTMkc1xuXG5GaW5nZXJwcmludCBmb3IgJTEkczogJTQkc1xuXG5JZiB5b3UgaGF2ZSBjb25maXJtZWQgdGhhdCB0aGUgZmluZ2VycHJpbnRzIG1hdGNoLCBjbGljayBPSywgb3RoZXJ3aXNlIGNsaWNrIENhbmNlbC4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi44GT44KM44Gv6Y215oyH57SL44Gn44GZ44CC44OB44Oj44OD44OI5Lul5aSW44Gu5pa55rOV44Gn44GT44KM44KJ44KSICUxJHMg44Go56K66KqN44GX44Gm44GP44Gg44GV44GE44CCXG5cbuOBguOBquOBnyAlMiRzIOOBrumNteaMh+e0izogJTMkc1xuXG4lMSRzIOOBrumNteaMh+e0izogJTQkc1xuXG7norroqo3jgZfjgabjgIHpjbXmjIfntIvjgYzmraPjgZfjgZHjgozjgbDjgIxPS+OAjeOCkuOAgeato+OBl+OBj+OBquOBkeOCjOOBsOOAjOOCreODo+ODs+OCu+ODq+OAjeOCkuOCr+ODquODg+OCr+OBl+OBpuOBj+OBoOOBleOBhOOAgiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91IHdpbGwgYmUgcHJvbXB0ZWQgdG8gcHJvdmlkZSBhIHNlY3VyaXR5IHF1ZXN0aW9uIGFuZCB0aGVuIGFuIGFuc3dlciB0byB0aGF0IHF1ZXN0aW9uLlxuXG5Zb3VyIGJ1ZGR5IHdpbGwgdGhlbiBiZSBwcm9tcHRlZCB0aGUgc2FtZSBxdWVzdGlvbiBhbmQgaWYgdGhleSB0eXBlIHRoZSBleGFjdCBzYW1lIGFuc3dlciAoY2FzZSBzZW5zaXRpdmUpLCB0aGVpciBpZGVudGl0eSB3aWxsIGhhdmUgYmVlbiB2ZXJpZmllZC4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi56eY5a+G44Gu6LOq5ZWP44KS5YWl5Yqb44GX44CB44Gd44KM44Gr5a++44GX44Gm562U44GI44KL44KI44GG44Gr5L+D44GV44KM44G+44GZ44CCXG5cbuebuOaJi+OBq+OCguOAgeWQjOOBmOizquWVj+OBjOihqOekuuOBleOCjOOAgeato+OBl+OBj+WQjOOBmOetlCjlpKfmloflrZfjg7vlsI/mloflrZfjga/ljLrliKXjgZXjgozjgb7jgZkp44KS5YWl5Yqb44GZ44KL44GT44Go44Gn44CB5pys5Lq65oCn44KS5qSc6Ki844GX44G+44GZ44CCIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJXaGF0IGlzIHlvdXIgc2VjdXJpdHkgcXVlc3Rpb24/IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuenmOWvhuOBruizquWVj+OBr+OBquOCk+OBp+OBmeOBiz8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIldoYXQgaXMgdGhlIGFuc3dlciB0byB0aGUgc2VjdXJpdHkgcXVlc3Rpb24/IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuenmOWvhuOBruizquWVj+OBruetlOOBr+OBquOCk+OBp+OBmeOBiz8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkludmFsaWQgYXV0aGVudGljYXRpb24gc2NoZW1lIHByb3ZpZGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuiqjeiovOOBruaWueW8j+OBjOato+OBl+OBj+OBguOCiuOBvuOBm+OCkyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBtZXNzYWdlcyBhcmUgbm90IGVuY3J5cHRlZCBhbnltb3JlIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuODoeODg+OCu+ODvOOCuOOBr+OCguOBhuaal+WPt+WMluOBleOCjOOBvuOBm+OCkyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBtZXNzYWdlcyBhcmUgbm93IGVuY3J5cHRlZCBidXQgeW91ciBidWRkeSdzIGlkZW50aXR5IGhhcyBub3QgYmVlbiB2ZXJpZmllZC4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi44Oh44OD44K744O844K444Gv5pqX5Y+35YyW44GV44KM44G+44GZ44GM44CB55u45omL44GM5pys5Lq644Gn44GC44KL44GT44Go44Gv5qSc6Ki844GV44KM44Gm44GE44G+44Gb44KT44CCIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIGJ1ZGR5J3MgaWRlbnRpZnkgaGFzIGJlZW4gdmVyaWZpZWQuIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuebuOaJi+OBruacrOS6uuaAp+OCkuaknOiovOOBl+OBvuOBl+OBn+OAgiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBidWRkeSBoYXMgZW5kZWQgZW5jcnlwdGlvbiBvbiB0aGVpciBlbmQsIHlvdSBzaG91bGQgZG8gdGhlIHNhbWUuIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuebuOaJi+OBr+OAgeaal+WPt+WMluOCkue1guS6huOBl+OBvuOBl+OBn+OAguOBguOBquOBn+OCguOBneOCjOOBq+WQiOOCj+OBm+OCi+W/heimgeOBjOOBguOCiuOBvuOBmeOAgiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBtZXNzYWdlcyBhcmUgbm90IGVuY3J5cHRlZC4gQ2xpY2sgaGVyZSB0byBlbmFibGUgT1RSIGVuY3J5cHRpb24uIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuODoeODg+OCu+ODvOOCuOOBr+aal+WPt+WMluOBleOCjOOBvuOBm+OCk+OAgk9UUiDmmpflj7fljJbjgpLmnInlirnjgavjgZnjgovjgavjga/jgZPjgZPjgpLjgq/jg6rjg4Pjgq/jgZfjgabjgY/jgaDjgZXjgYTjgIIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgbWVzc2FnZXMgYXJlIGVuY3J5cHRlZCwgYnV0IHlvdXIgYnVkZHkgaGFzIG5vdCBiZWVuIHZlcmlmaWVkLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLjg6Hjg4Pjgrvjg7zjgrjjga/mmpflj7fljJbjgZXjgozjgb7jgZnjgYzjgIHnm7jmiYvjga/mpJzoqLzjgZXjgozjgabjgYTjgb7jgZvjgpPjgIIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgbWVzc2FnZXMgYXJlIGVuY3J5cHRlZCBhbmQgeW91ciBidWRkeSB2ZXJpZmllZC4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi44Oh44OD44K744O844K444Gv5pqX5Y+35YyW44GV44KM44CB55u45omL44KC5qSc6Ki844GV44KM44Gm44GE44G+44GZ44CCIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIGJ1ZGR5IGhhcyBjbG9zZWQgdGhlaXIgZW5kIG9mIHRoZSBwcml2YXRlIHNlc3Npb24sIHlvdSBzaG91bGQgZG8gdGhlIHNhbWUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi55u45omL44Gv56eB5L+h44KS57WC5LqG44GX44G+44GX44Gf44CC44GC44Gq44Gf44KC5ZCM44GY44KI44GG44Gr44GX44Gm44GP44Gg44GV44GEIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb250YWN0cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLnm7jmiYvlhYgiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk9ubGluZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLjgqrjg7Pjg6njgqTjg7MiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkJ1c3kiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi5Y+W44KK6L6844G/5LitIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJBd2F5IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIumbouW4reS4rSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiT2ZmbGluZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLjgqrjg5Xjg6njgqTjg7MiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNsaWNrIHRvIGFkZCBuZXcgY2hhdCBjb250YWN0cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLjgq/jg6rjg4Pjgq/jgZfjgabmlrDjgZfjgYTjg4Hjg6Pjg4Pjg4jjga7nm7jmiYvlhYjjgpLov73liqAiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkFkZCBhIGNvbnRhY3QiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi55u45omL5YWI44KS6L+95YqgIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb250YWN0IHVzZXJuYW1lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuebuOaJi+WFiOOBruWQjeWJjSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQWRkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIui/veWKoCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ29udGFjdCBuYW1lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuWQjeWJjSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU2VhcmNoIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuaknOe0oiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTm8gdXNlcnMgZm91bmQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi44Om44O844K244O844GM6KaL44Gk44GL44KK44G+44Gb44KTIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDbGljayB0byBhZGQgYXMgYSBjaGF0IGNvbnRhY3QiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi44Kv44Oq44OD44Kv44GX44Gm44OB44Oj44OD44OI44Gu55u45omL5YWI44Go44GX44Gm6L+95YqgIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDbGljayB0byBvcGVuIHRoaXMgcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLjgq/jg6rjg4Pjgq/jgZfjgabjgZPjga7oq4foqbHlrqTjgpLplovjgY8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNob3cgbW9yZSBpbmZvcm1hdGlvbiBvbiB0aGlzIHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi44GT44Gu6KuH6Kmx5a6k44Gr44Gk44GE44Gm44Gu6Kmz57Sw44KS6KaL44KLIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJEZXNjcmlwdGlvbjoiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi6Kqs5piOOiAiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk9jY3VwYW50czoiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi5YWl5a6k6ICFOiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiRmVhdHVyZXM6IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIueJueW+tDoiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJlcXVpcmVzIGF1dGhlbnRpY2F0aW9uIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuiqjeiovOOBruimgeaxgiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiSGlkZGVuIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIumdnuihqOekuiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUmVxdWlyZXMgYW4gaW52aXRhdGlvbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLmi5vlvoXjga7opoHmsYIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk1vZGVyYXRlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLnmbroqIDliLbpmZAiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk5vbi1hbm9ueW1vdXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi6Z2e5Yy/5ZCNIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJPcGVuIHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi6ZaL5pS+6KuH6Kmx5a6kIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJQZXJtYW5lbnQgcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLluLjoqK3oq4foqbHlrqQiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlB1YmxpYyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLlhazplovoq4foqbHlrqQiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNlbWktYW5vbnltb3VzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuWNiuWMv+WQjSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGVtcG9yYXJ5IHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi6Ieo5pmC6KuH6Kmx5a6kIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJVbm1vZGVyYXRlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLnmbroqIDliLbpmZDjgarjgZciCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJvb21zIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuirh+ipseWupCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUm9vbSBuYW1lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuirh+ipseWupOOBruWQjeWJjSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTmlja25hbWUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi44OL44OD44Kv44ON44O844OgIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTZXJ2ZXIiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi44K144O844OQ44O8IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJKb2luIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuWFpeWupCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU2hvdyByb29tcyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLoq4foqbHlrqTkuIDopqfjgpLopovjgosiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk5vIHJvb21zIG9uICUxJHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiJTEkcyDjgavoq4foqbHlrqTjga/jgYLjgorjgb7jgZvjgpMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJvb21zIG9uICUxJHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiJTEkcyDjga7oq4foqbHlrqTkuIDopqciCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNldCBjaGF0cm9vbSB0b3BpYyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLoq4foqbHlrqTjga7oqbHpoYzjgpLoqK3lrpoiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIktpY2sgdXNlciBmcm9tIGNoYXRyb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuODpuODvOOCtuODvOOCkuirh+ipseWupOOBi+OCiei5tOOCiuWHuuOBmSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQmFuIHVzZXIgZnJvbSBjaGF0cm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLjg6bjg7zjgrbjg7zjgpLoq4foqbHlrqTjgYvjgonnt6DjgoHlh7rjgZkiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk1lc3NhZ2UiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi44Oh44OD44K744O844K4IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTYXZlIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuS/neWtmCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ2FuY2VsIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuOCreODo+ODs+OCu+ODqyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQW4gZXJyb3Igb2NjdXJyZWQgd2hpbGUgdHJ5aW5nIHRvIHNhdmUgdGhlIGZvcm0uIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuODleOCqeODvOODoOOCkuS/neWtmOOBmeOCi+mam+OBq+OCqOODqeODvOOBjOeZuueUn+OBl+OBvuOBl+OBn+OAgiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyBjaGF0cm9vbSByZXF1aXJlcyBhIHBhc3N3b3JkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuOBk+OBruirh+ipseWupOOBq+OBr+ODkeOCueODr+ODvOODieOBjOW/heimgeOBp+OBmSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUGFzc3dvcmQ6ICI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLjg5Hjgrnjg6/jg7zjg4k6IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTdWJtaXQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi6YCB5L+hIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gaXMgbm90IGFub255bW91cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLjgZPjga7oq4foqbHlrqTjga/pnZ7ljL/lkI3jgafjgZkiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBub3cgc2hvd3MgdW5hdmFpbGFibGUgbWVtYmVycyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLjgZPjga7oq4foqbHlrqTjga/jg6Hjg7Pjg5Djg7zku6XlpJbjgavjgoLopovjgYjjgb7jgZkiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBkb2VzIG5vdCBzaG93IHVuYXZhaWxhYmxlIG1lbWJlcnMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi44GT44Gu6KuH6Kmx5a6k44Gv44Oh44Oz44OQ44O85Lul5aSW44Gr44Gv6KaL44GI44G+44Gb44KTIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJOb24tcHJpdmFjeS1yZWxhdGVkIHJvb20gY29uZmlndXJhdGlvbiBoYXMgY2hhbmdlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLoq4foqbHlrqTjga7oqK3lrpoo44OX44Op44Kk44OQ44K344O844Gr54Sh6Zai5L+CKeOBjOWkieabtOOBleOCjOOBvuOBl+OBnyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUm9vbSBsb2dnaW5nIGlzIG5vdyBlbmFibGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuirh+ipseWupOOBruiomOmMsuOCkuWPluOCiuOBr+OBmOOCgeOBvuOBmSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUm9vbSBsb2dnaW5nIGlzIG5vdyBkaXNhYmxlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLoq4foqbHlrqTjga7oqJjpjLLjgpLmraLjgoHjgb7jgZkiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBpcyBub3cgbm9uLWFub255bW91cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLjgZPjga7oq4foqbHlrqTjga/jgZ/jgaDjgYTjgb7pnZ7ljL/lkI3jgafjgZkiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBpcyBub3cgc2VtaS1hbm9ueW1vdXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi44GT44Gu6KuH6Kmx5a6k44Gv44Gf44Gg44GE44G+5Y2K5Yy/5ZCN44Gn44GZIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gaXMgbm93IGZ1bGx5LWFub255bW91cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLjgZPjga7oq4foqbHlrqTjga/jgZ/jgaDjgYTjgb7ljL/lkI3jgafjgZkiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkEgbmV3IHJvb20gaGFzIGJlZW4gY3JlYXRlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLmlrDjgZfjgYToq4foqbHlrqTjgYzkvZzmiJDjgZXjgozjgb7jgZfjgZ8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgbmlja25hbWUgaGFzIGJlZW4gY2hhbmdlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLjg4vjg4Pjgq/jg43jg7zjg6DjgpLlpInmm7TjgZfjgb7jgZfjgZ8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIjxzdHJvbmc+JTEkczwvc3Ryb25nPiBoYXMgYmVlbiBiYW5uZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IOOCkue3oOOCgeWHuuOBl+OBvuOBl+OBnyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IGhhcyBiZWVuIGtpY2tlZCBvdXQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IOOCkui5tOOCiuWHuuOBl+OBvuOBl+OBnyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IGhhcyBiZWVuIHJlbW92ZWQgYmVjYXVzZSBvZiBhbiBhZmZpbGlhdGlvbiBjaGFuZ2UiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi5YiG5o6M44Gu5aSJ5pu044Gu44Gf44KB44CBPHN0cm9uZz4lMSRzPC9zdHJvbmc+IOOCkuWJiumZpOOBl+OBvuOBl+OBnyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IGhhcyBiZWVuIHJlbW92ZWQgZm9yIG5vdCBiZWluZyBhIG1lbWJlciI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLjg6Hjg7Pjg5Djg7zjgafjgarjgY/jgarjgaPjgZ/jgZ/jgoHjgIE8c3Ryb25nPiUxJHM8L3N0cm9uZz4g44KS5YmK6Zmk44GX44G+44GX44GfIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3UgaGF2ZSBiZWVuIGJhbm5lZCBmcm9tIHRoaXMgcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLjgZPjga7oq4foqbHlrqTjgYvjgonnt6DjgoHlh7rjgZXjgozjgb7jgZfjgZ8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdSBoYXZlIGJlZW4ga2lja2VkIGZyb20gdGhpcyByb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuOBk+OBruirh+ipseWupOOBi+OCiei5tOOCiuWHuuOBleOCjOOBvuOBl+OBnyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91IGhhdmUgYmVlbiByZW1vdmVkIGZyb20gdGhpcyByb29tIGJlY2F1c2Ugb2YgYW4gYWZmaWxpYXRpb24gY2hhbmdlIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuWIhuaOjOOBruWkieabtOOBruOBn+OCgeOAgeOBk+OBruirh+ipseWupOOBi+OCieWJiumZpOOBleOCjOOBvuOBl+OBnyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91IGhhdmUgYmVlbiByZW1vdmVkIGZyb20gdGhpcyByb29tIGJlY2F1c2UgdGhlIHJvb20gaGFzIGNoYW5nZWQgdG8gbWVtYmVycy1vbmx5IGFuZCB5b3UncmUgbm90IGEgbWVtYmVyIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuirh+ipseWupOOBjOODoeODs+ODkOODvOWItuOBq+WkieabtOOBleOCjOOBvuOBl+OBn+OAguODoeODs+ODkOODvOOBp+OBr+OBquOBhOOBn+OCgeOAgeOBk+OBruirh+ipseWupOOBi+OCieWJiumZpOOBleOCjOOBvuOBl+OBnyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91IGhhdmUgYmVlbiByZW1vdmVkIGZyb20gdGhpcyByb29tIGJlY2F1c2UgdGhlIE1VQyAoTXVsdGktdXNlciBjaGF0KSBzZXJ2aWNlIGlzIGJlaW5nIHNodXQgZG93bi4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTVVDKOOCsOODq+ODvOODl+ODgeODo+ODg+ODiCnjga7jgrXjg7zjg5PjgrnjgYzlgZzmraLjgZfjgZ/jgZ/jgoHjgIHjgZPjga7oq4foqbHlrqTjgYvjgonliYrpmaTjgZXjgozjgb7jgZfjgZ/jgIIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdSBhcmUgbm90IG9uIHRoZSBtZW1iZXIgbGlzdCBvZiB0aGlzIHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi44GT44Gu6KuH6Kmx5a6k44Gu44Oh44Oz44OQ44O85LiA6Kan44Gr44GE44G+44Gb44KTIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJObyBuaWNrbmFtZSB3YXMgc3BlY2lmaWVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuODi+ODg+OCr+ODjeODvOODoOOBjOOBguOCiuOBvuOBm+OCkyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91IGFyZSBub3QgYWxsb3dlZCB0byBjcmVhdGUgbmV3IHJvb21zIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuaWsOOBl+OBhOirh+ipseWupOOCkuS9nOaIkOOBmeOCi+aoqemZkOOBjOOBguOCiuOBvuOBm+OCkyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBuaWNrbmFtZSBkb2Vzbid0IGNvbmZvcm0gdG8gdGhpcyByb29tJ3MgcG9saWNpZXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi44OL44OD44Kv44ON44O844Og44GM44GT44Gu6KuH6Kmx5a6k44Gu44Od44Oq44K344O844Gr5b6T44Gj44Gm44GE44G+44Gb44KTIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG5pY2tuYW1lIGlzIGFscmVhZHkgdGFrZW4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi44OL44OD44Kv44ON44O844Og44Gv5pei44Gr5L2/44KP44KM44Gm44GE44G+44GZIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gZG9lcyBub3QgKHlldCkgZXhpc3QiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi44GT44Gu6KuH6Kmx5a6k44Gv5a2Y5Zyo44GX44G+44Gb44KTIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gaGFzIHJlYWNoZWQgaXQncyBtYXhpbXVtIG51bWJlciBvZiBvY2N1cGFudHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi44GT44Gu6KuH6Kmx5a6k44Gv5YWl5a6k6ICF5pWw44Gu5LiK6ZmQ44Gr6YGU44GX44Gm44GE44G+44GZIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUb3BpYyBzZXQgYnkgJTEkcyB0bzogJTIkcyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIlMSRzIOOBjOipsemhjOOCkuioreWumuOBl+OBvuOBl+OBnzogJTIkcyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyB1c2VyIGlzIGEgbW9kZXJhdG9yIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuOBk+OBruODpuODvOOCtuODvOOBr+WPuOS8muiAheOBp+OBmSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyB1c2VyIGNhbiBzZW5kIG1lc3NhZ2VzIGluIHRoaXMgcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLjgZPjga7jg6bjg7zjgrbjg7zjga/jgZPjga7oq4foqbHlrqTjgafnmbroqIDjgafjgY3jgb7jgZkiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgdXNlciBjYW4gTk9UIHNlbmQgbWVzc2FnZXMgaW4gdGhpcyByb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuOBk+OBruODpuODvOOCtuODvOOBr+OBk+OBruirh+ipseWupOOBp+eZuuiogOOBp+OBjeOBvuOBm+OCkyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgdG8gY2hhdCB3aXRoIHRoaXMgY29udGFjdCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLjgq/jg6rjg4Pjgq/jgZfjgabjgZPjga7nm7jmiYvlhYjjgajjg4Hjg6Pjg4Pjg4giCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNsaWNrIHRvIHJlbW92ZSB0aGlzIGNvbnRhY3QiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi44Kv44Oq44OD44Kv44GX44Gm44GT44Gu55u45omL5YWI44KS5YmK6ZmkIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb250YWN0IHJlcXVlc3RzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuS8muipseOBq+WRvOOBs+WHuuOBlyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTXkgY29udGFjdHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi55u45omL5YWI5LiA6KanIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJQZW5kaW5nIGNvbnRhY3RzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuS/neeVmeS4reOBruebuOaJi+WFiCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ3VzdG9tIHN0YXR1cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLni6zoh6rjga7lnKjluK3nirbms4EiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNsaWNrIHRvIGNoYW5nZSB5b3VyIGNoYXQgc3RhdHVzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuOCr+ODquODg+OCr+OBl+OBpuOAgeWcqOW4reeKtuazgeOCkuWkieabtCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgaGVyZSB0byB3cml0ZSBhIGN1c3RvbSBzdGF0dXMgbWVzc2FnZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLnirbms4Hjg6Hjg4Pjgrvjg7zjgrjjgpLlhaXlipvjgZnjgovjgavjga/jgIHjgZPjgZPjgpLjgq/jg6rjg4Pjgq8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIm9ubGluZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLlnKjluK0iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgImJ1c3kiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi5Y+W44KK6L6844G/5LitIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJhd2F5IGZvciBsb25nIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuS4jeWcqCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiYXdheSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLpm6LluK3kuK0iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkkgYW0gJTEkcyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLnp4Hjga/jgYTjgb4gJTEkcyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU2lnbiBpbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLjgrXjgqTjg7PjgqTjg7MiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlhNUFAvSmFiYmVyIFVzZXJuYW1lOiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJYTVBQL0phYmJlciDjg6bjg7zjgrbjg7zlkI06IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJQYXNzd29yZDoiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi44OR44K544Ov44O844OJOiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTG9nIEluIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuODreOCsOOCpOODsyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQk9TSCBTZXJ2aWNlIFVSTDoiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQk9TSCDjgrXjg7zjg5PjgrkgVVJMOiIKICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7CiAgICAgICAgZGVmaW5lKCJqYSIsIFsnamVkJ10sIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkobmV3IEplZCh0cmFuc2xhdGlvbnMpKTsKICAgICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKCF3aW5kb3cubG9jYWxlcykgewogICAgICAgICAgICB3aW5kb3cubG9jYWxlcyA9IHt9OwogICAgICAgIH0KICAgICAgICB3aW5kb3cubG9jYWxlcy5qYSA9IGZhY3RvcnkobmV3IEplZCh0cmFuc2xhdGlvbnMpKTsKICAgIH0KfSh0aGlzLCBmdW5jdGlvbiAoamEpIHsgCiAgICByZXR1cm4gamE7IAp9KSk7CgooZnVuY3Rpb24gKHJvb3QsIGZhY3RvcnkpIHsKICAgIHZhciB0cmFuc2xhdGlvbnMgPSB7CiAgICAgICAgImRvbWFpbiI6ICJjb252ZXJzZSIsCiAgICAgICAgImxvY2FsZV9kYXRhIjogewogICAgICAgICAgICAiY29udmVyc2UiOiB7CiAgICAgICAgICAgICAgICAiIjogewogICAgICAgICAgICAgICAgICAgICJQcm9qZWN0LUlkLVZlcnNpb24iOiAiQ29udmVyc2UuanMgMC40IiwKICAgICAgICAgICAgICAgICAgICAiUmVwb3J0LU1zZ2lkLUJ1Z3MtVG8iOiAiIiwKICAgICAgICAgICAgICAgICAgICAiUE9ULUNyZWF0aW9uLURhdGUiOiAiMjAxMy0wOS0xNSAyMTo1NSswMjAwIiwKICAgICAgICAgICAgICAgICAgICAiUE8tUmV2aXNpb24tRGF0ZSI6ICIyMDEzLTA5LTE1IDIyOjAzKzAyMDAiLAogICAgICAgICAgICAgICAgICAgICJMYXN0LVRyYW5zbGF0b3IiOiAiTWFhcnRlbiBLbGluZyA8bWFhcnRlbkBmb3VyZGlnaXRzLm5sPiIsCiAgICAgICAgICAgICAgICAgICAgIkxhbmd1YWdlLVRlYW0iOiAiRHV0Y2giLAogICAgICAgICAgICAgICAgICAgICJMYW5ndWFnZSI6ICJubCIsCiAgICAgICAgICAgICAgICAgICAgIk1JTUUtVmVyc2lvbiI6ICIxLjAiLAogICAgICAgICAgICAgICAgICAgICJDb250ZW50LVR5cGUiOiAidGV4dC9wbGFpbjsgY2hhcnNldD1VVEYtOCIsCiAgICAgICAgICAgICAgICAgICAgIkNvbnRlbnQtVHJhbnNmZXItRW5jb2RpbmciOiAiOGJpdCIsCiAgICAgICAgICAgICAgICAgICAgIlBsdXJhbC1Gb3JtcyI6ICJucGx1cmFscz0yOyBwbHVyYWw9KG4gIT0gMSk7IiwKICAgICAgICAgICAgICAgICAgICAiZG9tYWluIjogImNvbnZlcnNlIiwKICAgICAgICAgICAgICAgICAgICAibGFuZyI6ICJubCIsCiAgICAgICAgICAgICAgICAgICAgInBsdXJhbF9mb3JtcyI6ICJucGx1cmFscz0yOyBwbHVyYWw9KG4gIT0gMSk7IgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJ1bmVuY3J5cHRlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJvbmdlY29kZWVyZGUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgInVudmVyaWZpZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAibmlldCBnZXZlcmlmaWVlcmQiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgInZlcmlmaWVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgImdldmVyaWZpZWVyZCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiZmluaXNoZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAia2xhYXIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkRpc2Nvbm5lY3RlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJWZXJiaW5kaW5nIHZlcmJyb2tlbi4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkVycm9yIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkVycm9yIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb25uZWN0aW5nIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlZlcmJpbmRlbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ29ubmVjdGlvbiBGYWlsZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVmVyYmluZGVuIG1pc2x1a3QiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkF1dGhlbnRpY2F0aW5nIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkF1dGhlbnRpY2VyZW4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkF1dGhlbnRpY2F0aW9uIEZhaWxlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJBdXRoZW50aWNlcmVuIG1pc2x1a3QiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkRpc2Nvbm5lY3RpbmciOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSZS1lc3RhYmxpc2hpbmcgZW5jcnlwdGVkIHNlc3Npb24iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQmV6aWcgdmVyc2xldXRlbGRlIHNlc3NpZSB0ZSBoZXJzdGVsbGVuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIGJyb3dzZXIgbmVlZHMgdG8gZ2VuZXJhdGUgYSBwcml2YXRlIGtleSwgd2hpY2ggd2lsbCBiZSB1c2VkIGluIHlvdXIgZW5jcnlwdGVkIGNoYXQgc2Vzc2lvbi4gVGhpcyBjYW4gdGFrZSB1cCB0byAzMCBzZWNvbmRzIGR1cmluZyB3aGljaCB5b3VyIGJyb3dzZXIgbWlnaHQgZnJlZXplIGFuZCBiZWNvbWUgdW5yZXNwb25zaXZlLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlByaXZhdGUga2V5IGdlbmVyYXRlZC4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiUHJpdmF0ZSBrZXkgZ2VnZW5lcmVlcmQuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJBdXRoZW50aWNhdGlvbiByZXF1ZXN0IGZyb20gJTEkc1xuXG5Zb3VyIGJ1ZGR5IGlzIGF0dGVtcHRpbmcgdG8gdmVyaWZ5IHlvdXIgaWRlbnRpdHksIGJ5IGFza2luZyB5b3UgdGhlIHF1ZXN0aW9uIGJlbG93LlxuXG4lMiRzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ291bGQgbm90IHZlcmlmeSB0aGlzIHVzZXIncyBpZGVudGlmeS4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTmlldCBrb24gZGUgaWRlbnRpdGVpdCB2YW4gZGV6ZSBnZWJydWlrZXIgbmlldCBpZGVudGlmaWNlcmVuLiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUGVyc29uYWwgbWVzc2FnZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJQZXJzb29ubGlqayBiZXJpY2h0IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTdGFydCBlbmNyeXB0ZWQgY29udmVyc2F0aW9uIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlN0YXJ0IGVuY3J5cHRlZCBnZXNwcmVrIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSZWZyZXNoIGVuY3J5cHRlZCBjb252ZXJzYXRpb24iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVmVydmVycyBlbmNyeXB0ZWQgZ2VzcHJlayIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiRW5kIGVuY3J5cHRlZCBjb252ZXJzYXRpb24iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQmVlaW5kaWcgZW5jcnlwdGVkIGdlc3ByZWsiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlZlcmlmeSB3aXRoIFNNUCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlZlcmlmeSB3aXRoIGZpbmdlcnByaW50cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIldoYXQncyB0aGlzPyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJXYXQgaXMgZGl0PyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAibWUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiaWt6ZWxmIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTaG93IHRoaXMgbWVudSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJUb29uIGRpdCBtZW51IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJXcml0ZSBpbiB0aGUgdGhpcmQgcGVyc29uIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlNjaHJpamYgaW4gZGUgM2RlIHBlcnNvb24iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJlbW92ZSBtZXNzYWdlcyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJWZXJ3aWpkZXIgYmVyaWNodCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBtZXNzYWdlIGNvdWxkIG5vdCBiZSBzZW50IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkplIGJlcmljaHQga29uIG5pZXQgd29yZGVuIHZlcnpvbmRlbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiV2UgcmVjZWl2ZWQgYW4gdW5lbmNyeXB0ZWQgbWVzc2FnZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJXZSBvbnR2aW5nZW4gZWVuIHVuZW5jcnlwdGVkIGJlcmljaHQgIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJXZSByZWNlaXZlZCBhbiB1bnJlYWRhYmxlIGVuY3J5cHRlZCBtZXNzYWdlIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIldlIG9udHZhbmdlbiBlZW4gb25sZWVzYmFhciB1bmVuY3J5cHRlZCBiZXJpY2h0IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHVzZXIgaGFzIHJlcXVlc3RlZCBhbiBlbmNyeXB0ZWQgc2Vzc2lvbi4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRGV6ZSBnZWJydWlrZXIgaGVlZnQgZWVuIGVuY3J5cHRlZCBzZXNzaWUgYWFuZ2V2cmFhZ2QuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJIZXJlIGFyZSB0aGUgZmluZ2VycHJpbnRzLCBwbGVhc2UgY29uZmlybSB0aGVtIHdpdGggJTEkcywgb3V0c2lkZSBvZiB0aGlzIGNoYXQuXG5cbkZpbmdlcnByaW50IGZvciB5b3UsICUyJHM6ICUzJHNcblxuRmluZ2VycHJpbnQgZm9yICUxJHM6ICU0JHNcblxuSWYgeW91IGhhdmUgY29uZmlybWVkIHRoYXQgdGhlIGZpbmdlcnByaW50cyBtYXRjaCwgY2xpY2sgT0ssIG90aGVyd2lzZSBjbGljayBDYW5jZWwuIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91IHdpbGwgYmUgcHJvbXB0ZWQgdG8gcHJvdmlkZSBhIHNlY3VyaXR5IHF1ZXN0aW9uIGFuZCB0aGVuIGFuIGFuc3dlciB0byB0aGF0IHF1ZXN0aW9uLlxuXG5Zb3VyIGJ1ZGR5IHdpbGwgdGhlbiBiZSBwcm9tcHRlZCB0aGUgc2FtZSBxdWVzdGlvbiBhbmQgaWYgdGhleSB0eXBlIHRoZSBleGFjdCBzYW1lIGFuc3dlciAoY2FzZSBzZW5zaXRpdmUpLCB0aGVpciBpZGVudGl0eSB3aWxsIGhhdmUgYmVlbiB2ZXJpZmllZC4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJXaGF0IGlzIHlvdXIgc2VjdXJpdHkgcXVlc3Rpb24/IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIldhdCBpcyBqb3Ugc2VyaWN1cnkgdnJhYWc/IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJXaGF0IGlzIHRoZSBhbnN3ZXIgdG8gdGhlIHNlY3VyaXR5IHF1ZXN0aW9uPyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJXYXQgaXMgaGV0IGFudHdvb3JkIG9wIGRlIHNlY3VyaXR5IHZyYWFnPyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiSW52YWxpZCBhdXRoZW50aWNhdGlvbiBzY2hlbWUgcHJvdmlkZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG1lc3NhZ2VzIGFyZSBub3QgZW5jcnlwdGVkIGFueW1vcmUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSmUgYmVyaWNodGVuIHppam4gbmlldCBtZWVyIGVuY3J5cHRlZCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBtZXNzYWdlcyBhcmUgbm93IGVuY3J5cHRlZCBidXQgeW91ciBidWRkeSdzIGlkZW50aXR5IGhhcyBub3QgYmVlbiB2ZXJpZmllZC4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIGJ1ZGR5J3MgaWRlbnRpZnkgaGFzIGJlZW4gdmVyaWZpZWQuIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkpvdSBjb250YWN0IGlzIGdldmVyaWZpZWVyZCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBidWRkeSBoYXMgZW5kZWQgZW5jcnlwdGlvbiBvbiB0aGVpciBlbmQsIHlvdSBzaG91bGQgZG8gdGhlIHNhbWUuIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkpvdSBjb250YWN0IGhlZWZ0IGVuY3J5cHRpb24gYWFuc3RhYW4sIGplIG1vZXQgaGV0IHplbGZkZSBkb2VuLiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBtZXNzYWdlcyBhcmUgbm90IGVuY3J5cHRlZC4gQ2xpY2sgaGVyZSB0byBlbmFibGUgT1RSIGVuY3J5cHRpb24uIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkpvdSBiZXJpY2h0IGlzIG5pZXQgZW5jcnlwdGVkLiBLTGlrIGhpZXIgb20gT1JDIGVuY3J5dGlvbiBhYW4gdGUgemV0dGVuLiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBtZXNzYWdlcyBhcmUgZW5jcnlwdGVkLCBidXQgeW91ciBidWRkeSBoYXMgbm90IGJlZW4gdmVyaWZpZWQuIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkpvdSBiZXJpY2h0ZW4gemlqbiBlbmNyeXB0ZWQsIG1hYXIgamUgY29udGFjdCBpcyBuaWV0IGdldmVyaWZpZWVyZC4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgbWVzc2FnZXMgYXJlIGVuY3J5cHRlZCBhbmQgeW91ciBidWRkeSB2ZXJpZmllZC4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSm91IGJlcmljaHQgaXMgZW5jcnlwdGVkIGVuIGpvdSBjb250YWN0IGlzIGdldmVyaWZpZWVyZC4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgYnVkZHkgaGFzIGNsb3NlZCB0aGVpciBlbmQgb2YgdGhlIHByaXZhdGUgc2Vzc2lvbiwgeW91IHNob3VsZCBkbyB0aGUgc2FtZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNvbnRhY3RzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkNvbnRhY3RlbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiT25saW5lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk9ubGluZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQnVzeSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJCZXpldCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQXdheSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJBZndlemlnIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJPZmZsaW5lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgdG8gYWRkIG5ldyBjaGF0IGNvbnRhY3RzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIktsaWsgb20gbmlldXdlIGNvbnRhY3RlbiB0b2UgdGUgdm9lZ2VuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJBZGQgYSBjb250YWN0IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlZvZWcgY29udGFjdCB0b2UiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNvbnRhY3QgdXNlcm5hbWUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQ29udGFjdCBnZWJydWlrZXJuYWFtIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJBZGQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVG9ldm9lZ2VuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb250YWN0IG5hbWUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQ29udGFjdCBuYWFtIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTZWFyY2giOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiWm9la2VuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJObyB1c2VycyBmb3VuZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJHZWVuIGdlYnJ1aWtlcnMgZ2V2b25kZW4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNsaWNrIHRvIGFkZCBhcyBhIGNoYXQgY29udGFjdCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJLbGlrIG9tIGNvbnRhY3QgdG9lIHRlIHZvZWdlbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgdG8gb3BlbiB0aGlzIHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiS2xpayBvbSByb29tIHRlIG9wZW5lbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU2hvdyBtb3JlIGluZm9ybWF0aW9uIG9uIHRoaXMgcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJUb29uIG1lZXIgaW5mb3JtYXRpZSBvdmVyIGRlemUgcm9vbSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiRGVzY3JpcHRpb246IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkJlc2NocmlqdmluZyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiT2NjdXBhbnRzOiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJEZWVsbmVtZXJzOiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiRmVhdHVyZXM6IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkZ1bmN0aWVzOiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUmVxdWlyZXMgYXV0aGVudGljYXRpb24iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVmVyaWZpY2F0aWUgdmVyZWlzdCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiSGlkZGVuIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlZlcmJvcmdlbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUmVxdWlyZXMgYW4gaW52aXRhdGlvbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJWZXJpZXN0IGVlbiB1aXRub2RpZ2luZyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTW9kZXJhdGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkdlbW9kZXJlZXJkIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJOb24tYW5vbnltb3VzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk5pZXQgYW5ub25pZW0iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk9wZW4gcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJPcGVuIHJvb20iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlBlcm1hbmVudCByb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkJsaWp2ZW5kIHJvb20iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlB1YmxpYyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJQdWJsaWVrIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTZW1pLWFub255bW91cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTZW1pIGFubm9uaWVtIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUZW1wb3Jhcnkgcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJUaWpkZWxpamtlIHJvb20iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlVubW9kZXJhdGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk5pZXQgZ2Vtb2RlcmVlcmQiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJvb21zIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlJvb21zIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSb29tIG5hbWUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiUm9vbSBuYWFtIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJOaWNrbmFtZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJOaWNrbmFtZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU2VydmVyIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlNlcnZlciIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiSm9pbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJEZWVsbmVtZW4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNob3cgcm9vbXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVG9vbiByb29tcyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTm8gcm9vbXMgb24gJTEkcyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJHZWVuIHJvb20gb3AgJTEkcyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUm9vbXMgb24gJTEkcyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJSb29tIG9wICUxJHMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNldCBjaGF0cm9vbSB0b3BpYyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJaZXQgY2hhdHJvb20gdG9waWMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIktpY2sgdXNlciBmcm9tIGNoYXRyb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkdvZWkgZ2VicnVpa2VyIHVpdCBjaGF0cm9vbSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQmFuIHVzZXIgZnJvbSBjaGF0cm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJCYW4gZ2VicnVpa2VyIHZhbiBjaGF0cm9vbSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTWVzc2FnZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJCZXJpY2h0IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTYXZlIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk9wc2xhYW4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNhbmNlbCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJBbm51bGVyZW4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkFuIGVycm9yIG9jY3VycmVkIHdoaWxlIHRyeWluZyB0byBzYXZlIHRoZSBmb3JtLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJFZW4gZXJyb3IgdGlqZGVucyBoZXQgb3BzbGFhbiB2YW4gaGV0IGZvcm11bGllci4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgY2hhdHJvb20gcmVxdWlyZXMgYSBwYXNzd29yZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDaGF0cm9vbSBoZWVmdCBlZW4gd2FjaHR3b29yZCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUGFzc3dvcmQ6ICI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJXYWNodHdvb3JkOiAiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlN1Ym1pdCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJJbmRpZW5lbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyByb29tIGlzIG5vdCBhbm9ueW1vdXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRGV6ZSByb29tIGlzIG5pZXQgYW5ub25pZW0iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBub3cgc2hvd3MgdW5hdmFpbGFibGUgbWVtYmVycyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBkb2VzIG5vdCBzaG93IHVuYXZhaWxhYmxlIG1lbWJlcnMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJOb24tcHJpdmFjeS1yZWxhdGVkIHJvb20gY29uZmlndXJhdGlvbiBoYXMgY2hhbmdlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJvb20gbG9nZ2luZyBpcyBub3cgZW5hYmxlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJvb20gbG9nZ2luZyBpcyBub3cgZGlzYWJsZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gaXMgbm93IG5vbi1hbm9ueW1vdXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRGV6ZSByb29tIGlzIG51IG5pZXQgYW5ub25pZW0iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBpcyBub3cgc2VtaS1hbm9ueW1vdXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRGV6ZSByb29tIGlzIG51IHNlbWllIGFubm9uaWVtIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gaXMgbm93IGZ1bGx5LWFub255bW91cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJEZXplIHJvb20gaXMgbnUgdm9sbGVkaWcgYW5ub25pZW0iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkEgbmV3IHJvb20gaGFzIGJlZW4gY3JlYXRlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJFZW4gbmlldXdlIHJvb20gaXMgZ2VtYWFrdCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBuaWNrbmFtZSBoYXMgYmVlbiBjaGFuZ2VkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkplIG5pY2tuYW1lIGlzIHZlcmFuZGVyZCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IGhhcyBiZWVuIGJhbm5lZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gaXMgdmVyYmFubmVuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gaGFzIGJlZW4ga2lja2VkIG91dCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gaGFzIGJlZW4ga2lja2VkIG91dCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IGhhcyBiZWVuIHJlbW92ZWQgYmVjYXVzZSBvZiBhbiBhZmZpbGlhdGlvbiBjaGFuZ2UiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gaGFzIGJlZW4gcmVtb3ZlZCBmb3Igbm90IGJlaW5nIGEgbWVtYmVyIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91IGhhdmUgYmVlbiBiYW5uZWQgZnJvbSB0aGlzIHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSmUgYmVudCB2ZXJiYW5uZW4gdWl0IGRlemUgcm9vbSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91IGhhdmUgYmVlbiBraWNrZWQgZnJvbSB0aGlzIHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSmUgYmVudCB1aXQgZGUgcm9vbSBnZWdvb2lkIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3UgaGF2ZSBiZWVuIHJlbW92ZWQgZnJvbSB0aGlzIHJvb20gYmVjYXVzZSBvZiBhbiBhZmZpbGlhdGlvbiBjaGFuZ2UiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3UgaGF2ZSBiZWVuIHJlbW92ZWQgZnJvbSB0aGlzIHJvb20gYmVjYXVzZSB0aGUgcm9vbSBoYXMgY2hhbmdlZCB0byBtZW1iZXJzLW9ubHkgYW5kIHlvdSdyZSBub3QgYSBtZW1iZXIiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3UgaGF2ZSBiZWVuIHJlbW92ZWQgZnJvbSB0aGlzIHJvb20gYmVjYXVzZSB0aGUgTVVDIChNdWx0aS11c2VyIGNoYXQpIHNlcnZpY2UgaXMgYmVpbmcgc2h1dCBkb3duLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdSBhcmUgbm90IG9uIHRoZSBtZW1iZXIgbGlzdCBvZiB0aGlzIHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSmUgYmVudCBuaWV0IGVlbiBnZWJydWlrZXIgdmFuIGRlemUgcm9vbSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTm8gbmlja25hbWUgd2FzIHNwZWNpZmllZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJHZWVuIG5pY2tuYW1lIGluZ2VnZXZlbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91IGFyZSBub3QgYWxsb3dlZCB0byBjcmVhdGUgbmV3IHJvb21zIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkplIGJlbnQgbmlldCB0b2VnZXN0YWFuIG5pZXV3ZSByb29tcyB0ZSBtYWtlbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBuaWNrbmFtZSBkb2Vzbid0IGNvbmZvcm0gdG8gdGhpcyByb29tJ3MgcG9saWNpZXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSmUgbmlja25hbWUgaXMgbmlldCBjb25mb3JtIHBvbGljeSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBuaWNrbmFtZSBpcyBhbHJlYWR5IHRha2VuIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkplIG5pY2tuYW1lIGJlc3RhYXQgYWwiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBkb2VzIG5vdCAoeWV0KSBleGlzdCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJEZXplIHJvb20gYmVzdGFhdCBuaWV0IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gaGFzIHJlYWNoZWQgaXQncyBtYXhpbXVtIG51bWJlciBvZiBvY2N1cGFudHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRGV6ZSByb29tIGhlZWZ0IGhldCBtYXhpbWFsZSBhYW50YWwgZ2VicnVpa2VycyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVG9waWMgc2V0IGJ5ICUxJHMgdG86ICUyJHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHVzZXIgaXMgYSBtb2RlcmF0b3IiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRGl0IGlzIGVlbiBtb2RlcmF0b3IiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgdXNlciBjYW4gc2VuZCBtZXNzYWdlcyBpbiB0aGlzIHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRGV6ZSBnZWJydWlrZXIga2FuIGJlcmljaHRlbiBzdHVyZW4gaW4gZGV6ZSByb29tIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHVzZXIgY2FuIE5PVCBzZW5kIG1lc3NhZ2VzIGluIHRoaXMgcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJEZXplIGdlYnJ1aWtlciBrYW4gTklFVCBlZW4gYmVyaWNodCBzdHVyZW4gaW4gZGV6ZSByb29tIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDbGljayB0byBjaGF0IHdpdGggdGhpcyBjb250YWN0IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIktsaWsgb20gdGUgY2hhdHRlbiBtZXQgY29udGFjdCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgdG8gcmVtb3ZlIHRoaXMgY29udGFjdCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJLbGlrIG9tIGNvbnRhY3QgdGUgdmVyd2lqZGVyZW4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgY29udGFjdCBpcyBidXN5IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkNvbnRhY3QgaXMgYmV6ZXQiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgY29udGFjdCBpcyBvbmxpbmUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQ29udGFjdCBpcyBvbmxpbmUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgY29udGFjdCBpcyBvZmZsaW5lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkNvbnRhY3QgaXMgb2ZmbGluZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyBjb250YWN0IGlzIHVuYXZhaWxhYmxlIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkNvbnRhY3QgaXMgbmlldCBiZXNjaGlrYmFhciIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyBjb250YWN0IGlzIGF3YXkgZm9yIGFuIGV4dGVuZGVkIHBlcmlvZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDb250YWN0IGlzIGFmd2V6aWcgdm9vciBsYW5nZSBwZXJpb2RlIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIGNvbnRhY3QgaXMgYXdheSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDb25hY3QgaXMgYWZ3ZXppZyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ29udGFjdCByZXF1ZXN0cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDb250YWN0IHVpdG5vZGlnaW5nIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJNeSBjb250YWN0cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJNaWpuIGNvbnRhY3RzIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJQZW5kaW5nIGNvbnRhY3RzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkNvbmFjdGVuIGluIGFmd2FjaHRpbmcgdmFuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDdXN0b20gc3RhdHVzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgdG8gY2hhbmdlIHlvdXIgY2hhdCBzdGF0dXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiS2xpayBoaWVyIG9tIHN0YXR1cyB0ZSB3aWp6aWdlbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgaGVyZSB0byB3cml0ZSBhIGN1c3RvbSBzdGF0dXMgbWVzc2FnZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJLbGlrIGhpZXIgb20gY3VzdG9tIHN0YXR1cyBiZXJpY2h0IHRlIG1ha2VuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJvbmxpbmUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAib25saW5lIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJidXN5IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgImJlemV0IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJhd2F5IGZvciBsb25nIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgImFmd2V6aWcgbGFuZ2UgdGlqZCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiYXdheSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJhZndlemlnIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJJIGFtICUxJHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSWsgYmVuICUxJHMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNpZ24gaW4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQWFubWVsZGVuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJYTVBQL0phYmJlciBVc2VybmFtZToiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiWE1QUC9KYWJiZXIgVXNlcm5hbWU6IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJQYXNzd29yZDoiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiV2FjaHR3b29yZDoiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkxvZyBJbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJBYW5tZWxkZW4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkJPU0ggU2VydmljZSBVUkw6IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiT25saW5lIENvbnRhY3RzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk9ubGluZSBDb250YWN0ZW4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIiUxJHMgaXMgdHlwaW5nIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiUxJHMgaXMgYWFuIHR5cGVuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb25uZWN0ZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVmVyYm9uZGVuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJBdHRhY2hlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJCaWpsYWdlIgogICAgICAgICAgICAgICAgXQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIGlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHsKICAgICAgICBkZWZpbmUoIm5sIiwgWydqZWQnXSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gZmFjdG9yeShuZXcgSmVkKHRyYW5zbGF0aW9ucykpOwogICAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgICBpZiAoIXdpbmRvdy5sb2NhbGVzKSB7CiAgICAgICAgICAgIHdpbmRvdy5sb2NhbGVzID0ge307CiAgICAgICAgfQogICAgICAgIHdpbmRvdy5sb2NhbGVzLm5sID0gZmFjdG9yeShuZXcgSmVkKHRyYW5zbGF0aW9ucykpOwogICAgfQp9KHRoaXMsIGZ1bmN0aW9uIChubCkgeyAKICAgIHJldHVybiBubDsgCn0pKTsKCihmdW5jdGlvbiAocm9vdCwgZmFjdG9yeSkgewogICAgdmFyIHRyYW5zbGF0aW9ucyA9IHsKICAgICAgICAiZG9tYWluIjogImNvbnZlcnNlIiwKICAgICAgICAibG9jYWxlX2RhdGEiOiB7CiAgICAgICAgICAgICJjb252ZXJzZSI6IHsKICAgICAgICAgICAgICAgICIiOiB7CiAgICAgICAgICAgICAgICAgICAgIlByb2plY3QtSWQtVmVyc2lvbiI6ICJDb252ZXJzZS5qcyAwLjYuMyIsCiAgICAgICAgICAgICAgICAgICAgIlJlcG9ydC1Nc2dpZC1CdWdzLVRvIjogIiIsCiAgICAgICAgICAgICAgICAgICAgIlBPVC1DcmVhdGlvbi1EYXRlIjogIjIwMTMtMDktMTUgMjE6NTUrMDIwMCIsCiAgICAgICAgICAgICAgICAgICAgIlBPLVJldmlzaW9uLURhdGUiOiAiMjAxNC0wNy0wNyAxMTowMiswMjAwIiwKICAgICAgICAgICAgICAgICAgICAiTGFzdC1UcmFuc2xhdG9yIjogIkFsYW4gTWVpcmEgPGFsYW5AZW5nYXJ0ZS5jb20+IiwKICAgICAgICAgICAgICAgICAgICAiTGFuZ3VhZ2UtVGVhbSI6ICJCcmF6aWxpYW4gUG9ydHVndWVzZSIsCiAgICAgICAgICAgICAgICAgICAgIkxhbmd1YWdlIjogInB0X0JSIiwKICAgICAgICAgICAgICAgICAgICAiTUlNRS1WZXJzaW9uIjogIjEuMCIsCiAgICAgICAgICAgICAgICAgICAgIkNvbnRlbnQtVHlwZSI6ICJ0ZXh0L3BsYWluOyBjaGFyc2V0PVVURi04IiwKICAgICAgICAgICAgICAgICAgICAiQ29udGVudC1UcmFuc2Zlci1FbmNvZGluZyI6ICI4Yml0IiwKICAgICAgICAgICAgICAgICAgICAiUGx1cmFsLUZvcm1zIjogIm5wbHVyYWxzPTI7IHBsdXJhbD0obiA+IDEpOyIsCiAgICAgICAgICAgICAgICAgICAgImRvbWFpbiI6ICJjb252ZXJzZSIsCiAgICAgICAgICAgICAgICAgICAgImxhbmciOiAicHRfQlIiLAogICAgICAgICAgICAgICAgICAgICJwbHVyYWxfZm9ybXMiOiAibnBsdXJhbHM9MjsgcGx1cmFsPShuICE9IDEpOyIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAidW5lbmNyeXB0ZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAibsOjby1jcmlwdG9ncmFmYWRvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJ1bnZlcmlmaWVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIm7Do28tdmVyaWZpY2FkbyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAidmVyaWZpZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAibsOjby12ZXJpZmljYWRvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJmaW5pc2hlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJmaW5hbGl6YWRvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJEaXNjb25uZWN0ZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRGVzY29uZWN0YWRvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJFcnJvciI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJFcnJvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb25uZWN0aW5nIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkNvbmVjdGFuZG8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNvbm5lY3Rpb24gRmFpbGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkZhbGhhIGRlIGNvbmV4w6NvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJBdXRoZW50aWNhdGluZyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJBdXRlbnRpY2FuZG8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkF1dGhlbnRpY2F0aW9uIEZhaWxlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJGYWxoYSBkZSBhdXRlbnRpY2HDp8OjbyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiRGlzY29ubmVjdGluZyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJEZXNjb25lY3RhbmRvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSZS1lc3RhYmxpc2hpbmcgZW5jcnlwdGVkIHNlc3Npb24iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiUmVlc3RhYmVsZWNlbmRvIHNlc3PDo28gY3JpcHRvZ3JhZmFkYSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBicm93c2VyIG5lZWRzIHRvIGdlbmVyYXRlIGEgcHJpdmF0ZSBrZXksIHdoaWNoIHdpbGwgYmUgdXNlZCBpbiB5b3VyIGVuY3J5cHRlZCBjaGF0IHNlc3Npb24uIFRoaXMgY2FuIHRha2UgdXAgdG8gMzAgc2Vjb25kcyBkdXJpbmcgd2hpY2ggeW91ciBicm93c2VyIG1pZ2h0IGZyZWV6ZSBhbmQgYmVjb21lIHVucmVzcG9uc2l2ZS4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU2V1IG5hdmVnYWRvciBwcmVjaXNhIGdlcmFyIHVtYSBjaGF2ZS1wcml2YWRhLCBxdWUgc2Vyw6EgdXNhZGEgZW0gc3VhIHNlc3PDo28gY3JpcHRvZ3JhZmFkYSBkZSBiYXRlLXBhcG8uIElzc28gcG9kZSBsZXZhciBhdMOpIDMwIHNlZ3VuZG9zIGR1cmFudGUgb3MgcXVhaXMgc2V1IG5hdmVnYWRvciBwb2RlcsOhIHNlIHRyYXZhciBvdSBuw6NvIHJlc3BvbmRlci4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlByaXZhdGUga2V5IGdlbmVyYXRlZC4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQ2hhdmUtcHJpdmFkYSBnZXJhZGE6IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJBdXRoZW50aWNhdGlvbiByZXF1ZXN0IGZyb20gJTEkc1xuXG5Zb3VyIGJ1ZGR5IGlzIGF0dGVtcHRpbmcgdG8gdmVyaWZ5IHlvdXIgaWRlbnRpdHksIGJ5IGFza2luZyB5b3UgdGhlIHF1ZXN0aW9uIGJlbG93LlxuXG4lMiRzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlBlZGlkbyBkZSBhdXRlbnRpY2HDp8OjbyBkZSAlJHNcblxuU2V1IGNvbnRhdG8gZXN0w6EgdGVudGFuZG8gdmVyaWZpY2FyIHN1YSBpZGVudGlkYWRlLCBwZXJndW50YW5kbyBhIHF1ZXN0w6NvIGFiYWl4by5cblxuJTIkcyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ291bGQgbm90IHZlcmlmeSB0aGlzIHVzZXIncyBpZGVudGlmeS4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTsOjbyBmb2kgcG9zc8OtdmVsIHZlcmlmaWNhciBhIGlkZW50aWRhZGUgZGVzdGUgdXN1w6FyaW8uIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJQZXJzb25hbCBtZXNzYWdlIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk1lbnNhZ2VtIHBlc3NvYWwiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlN0YXJ0IGVuY3J5cHRlZCBjb252ZXJzYXRpb24iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSW5pY2lhciBjb252ZXJzYSBjcmlwdG9ncmFmYWRhIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSZWZyZXNoIGVuY3J5cHRlZCBjb252ZXJzYXRpb24iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQXR1YWxpemFyIGNvbnZlcnNhIGNyaXB0b2dyYWZhZGEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkVuZCBlbmNyeXB0ZWQgY29udmVyc2F0aW9uIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkZpbmFsaXphciBjb252ZXJzYSBjcmlwdG9ncmFmYWRhIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJWZXJpZnkgd2l0aCBTTVAiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVmVyaWZpY2FyIGNvbSBTTVAiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlZlcmlmeSB3aXRoIGZpbmdlcnByaW50cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJWZXJpZmljYXIgY29tIGFzc2luYXR1cmEgZGlnaXRhbCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiV2hhdCdzIHRoaXM/IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk8gcXVlIMOpIGlzc28/IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJtZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJldSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU2hvdyB0aGlzIG1lbnUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTW9zdHJhciBvIG1lbnUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIldyaXRlIGluIHRoZSB0aGlyZCBwZXJzb24iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRXNjcmV2ZXIgZW0gdGVyY2VpcmEgcGVzc29hIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSZW1vdmUgbWVzc2FnZXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiUmVtb3ZlciBtZW5zYWdlbnMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgbWVzc2FnZSBjb3VsZCBub3QgYmUgc2VudCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTdWEgbWVuc2FnZW0gbsOjbyBww7RkZSBzZXIgZW52aWFkYSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiV2UgcmVjZWl2ZWQgYW4gdW5lbmNyeXB0ZWQgbWVzc2FnZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJSZWNlYmVtb3MgdW1hIG1lbnNhZ2VtIG7Do28tY3JpcHRvZ3JhZmFkYSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiV2UgcmVjZWl2ZWQgYW4gdW5yZWFkYWJsZSBlbmNyeXB0ZWQgbWVzc2FnZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJSZWNlYmVtb3MgdW1hIG1lbnNhZ2VtIG7Do28tY3JpcHRvZ3JhZmFkYSBpbGVnw612ZWwiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgdXNlciBoYXMgcmVxdWVzdGVkIGFuIGVuY3J5cHRlZCBzZXNzaW9uLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJVc3XDoXJpbyBwZWRpdSB1bWEgc2Vzc8OjbyBjcmlwdG9ncmFmYWRhLiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiSGVyZSBhcmUgdGhlIGZpbmdlcnByaW50cywgcGxlYXNlIGNvbmZpcm0gdGhlbSB3aXRoICUxJHMsIG91dHNpZGUgb2YgdGhpcyBjaGF0LlxuXG5GaW5nZXJwcmludCBmb3IgeW91LCAlMiRzOiAlMyRzXG5cbkZpbmdlcnByaW50IGZvciAlMSRzOiAlNCRzXG5cbklmIHlvdSBoYXZlIGNvbmZpcm1lZCB0aGF0IHRoZSBmaW5nZXJwcmludHMgbWF0Y2gsIGNsaWNrIE9LLCBvdGhlcndpc2UgY2xpY2sgQ2FuY2VsLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJBcXVpIGVzdMOjbyBhcyBhc3NpbmF0dXJhcyBkaWdpdGFpcywgcG9yIGZhdm9yIGNvbmZpcm1lIGVsYXMgY29tICUxJHMsIGZvcmEgZGVzdGUgY2hhdC5cblxuQXNzaW5hdHVyYXMgcGFyYSB2b2PDqiwgJTIkczogJTMkc1xuXG5Bc3NpbmF0dXJhcyBwYXJhICUxJHM6ICU0JHNcblxuU2Ugdm9jw6ogdGl2ZXIgY29uZmlybWFkbyBxdWUgYXMgYXNzaW5hdHVyYXMgY29uZmVyZW0sIGNsaXF1ZSBPSywgY2FzbyBjb250csOhcmlvLCBjbGlxdWUgQ2FuY2VsLiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91IHdpbGwgYmUgcHJvbXB0ZWQgdG8gcHJvdmlkZSBhIHNlY3VyaXR5IHF1ZXN0aW9uIGFuZCB0aGVuIGFuIGFuc3dlciB0byB0aGF0IHF1ZXN0aW9uLlxuXG5Zb3VyIGJ1ZGR5IHdpbGwgdGhlbiBiZSBwcm9tcHRlZCB0aGUgc2FtZSBxdWVzdGlvbiBhbmQgaWYgdGhleSB0eXBlIHRoZSBleGFjdCBzYW1lIGFuc3dlciAoY2FzZSBzZW5zaXRpdmUpLCB0aGVpciBpZGVudGl0eSB3aWxsIGhhdmUgYmVlbiB2ZXJpZmllZC4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU2Vyw6Egc29saWNpdGFkbyBxdWUgdm9jw6ogaW5mb3JtZSB1bWEgcGVyZ3VudGEgZGUgc2VndXJhbsOnYSBlIHRhbWLDqW0gdW1hIHJlc3Bvc3RhLlxuXG5Ow7NzIGlyZW1vcywgZW50w6NvLCB0cmFuc2ZlaXIgYSBwZXJndW50YSBwYXJhIHNldSBjb250YXRvIGUgY2FzbyBlbGUgZW52aWUgY29ycmV0YW1lbnRlIGEgbWVzbWEgcmVzcG9zdGEgKGNhc28gc2Vuc2l0aXZvKSwgYSBpZGVudGlkYWRlIGRlbGUgc2Vyw6EgdmVyaWZpY2FkYS4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIldoYXQgaXMgeW91ciBzZWN1cml0eSBxdWVzdGlvbj8iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiUXVhbCDDqSBhIHN1YSBwZXJndW50YSBkZSBzZWd1cmFuw6dhPyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiV2hhdCBpcyB0aGUgYW5zd2VyIHRvIHRoZSBzZWN1cml0eSBxdWVzdGlvbj8iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiUXVhbCDDqSBhIHJlc3Bvc3RhIHBhcmEgYSBwZXJndW50YSBkZSBzZWd1cmFuw6dhPyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiSW52YWxpZCBhdXRoZW50aWNhdGlvbiBzY2hlbWUgcHJvdmlkZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU2NoZW1hIGRlIGF1dGVudGljYcOnw6NvIGZvcm5lY2lkbyDDqSBpbnbDoWxpZG8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgbWVzc2FnZXMgYXJlIG5vdCBlbmNyeXB0ZWQgYW55bW9yZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTdWFzIG1lbnNhZ2VucyBuw6NvIGVzdMOjbyBtYWlzIGNyaXB0b2dyYWZhZGFzIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG1lc3NhZ2VzIGFyZSBub3cgZW5jcnlwdGVkIGJ1dCB5b3VyIGJ1ZGR5J3MgaWRlbnRpdHkgaGFzIG5vdCBiZWVuIHZlcmlmaWVkLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTdWFzIG1lbnNhZ2VucyBlc3TDo28gYWdvcmEgY3JpcHRvZ3JhZmFkYXMgbWFzIGEgaWRlbnRpZGFkZSBkbyBjb250YXRvIG7Do28gZm9pIGNvbmZpcm1hZGEuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIGJ1ZGR5J3MgaWRlbnRpZnkgaGFzIGJlZW4gdmVyaWZpZWQuIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkEgaWRlbnRpZGFkZSBkbyBjb250YXRvIGZvaSB2ZXJpZmljYWRhLiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBidWRkeSBoYXMgZW5kZWQgZW5jcnlwdGlvbiBvbiB0aGVpciBlbmQsIHlvdSBzaG91bGQgZG8gdGhlIHNhbWUuIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlNldSBjb250YXRvIHBhcm91IGRlIHVzYXIgY3JpcHRvZ3JhZmlhLCB2b2PDqiBkZXZlcmlhIGZhemVyIG8gbWVzbW8uIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG1lc3NhZ2VzIGFyZSBub3QgZW5jcnlwdGVkLiBDbGljayBoZXJlIHRvIGVuYWJsZSBPVFIgZW5jcnlwdGlvbi4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU3VhcyBtZW5zYWdlbnMgbsOjbyBlc3TDo28gY3JpcHRvZ3JhZmFkYXMuIENsaXF1ZSBhcXVpIHBhcmEgaGFiaWxpdGFyIGNyaXB0b2dyYWZpYSBPVFIuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG1lc3NhZ2VzIGFyZSBlbmNyeXB0ZWQsIGJ1dCB5b3VyIGJ1ZGR5IGhhcyBub3QgYmVlbiB2ZXJpZmllZC4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU3VhcyBtZW5zYWdlbnMgZXN0w6NvIGNyaXB0b2dyYWZhZGFzLCBtYXMgc2V1IGNvbnRhdG8gbsOjbyBmb2kgdmVyaWZpY2Fkby4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgbWVzc2FnZXMgYXJlIGVuY3J5cHRlZCBhbmQgeW91ciBidWRkeSB2ZXJpZmllZC4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU3VhcyBtZW5zYWdlbnMgZXN0w6NvIGNyaXB0b2dyYWZhZGFzIGUgc2V1IGNvbnRhdG8gdmVyaWZpY2Fkby4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgYnVkZHkgaGFzIGNsb3NlZCB0aGVpciBlbmQgb2YgdGhlIHByaXZhdGUgc2Vzc2lvbiwgeW91IHNob3VsZCBkbyB0aGUgc2FtZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTZXUgY29udGF0byBmZWNob3UgYSBzZXNzw6NvIHByaXZhZGEsIHZvY8OqIGRldmVyaWEgZmF6ZXIgbyBtZXNtbyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ29udGFjdHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQ29udGF0b3MiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk9ubGluZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJPbmxpbmUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkJ1c3kiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiT2N1cGFkbyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQXdheSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJBdXNlbnRlIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJPZmZsaW5lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk9mZmxpbmUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNsaWNrIHRvIGFkZCBuZXcgY2hhdCBjb250YWN0cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDbGlxdWUgcGFyYSBhZGljaW9uYXIgbm92b3MgY29udGF0b3MgYW8gY2hhdCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQWRkIGEgY29udGFjdCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJBZGljaW9uYXIgY29udGF0byIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ29udGFjdCB1c2VybmFtZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJVc3XDoXJpbyBkbyBjb250YXR0IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJBZGQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQWRpY2lvbmFyIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb250YWN0IG5hbWUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTm9tZSBkbyBjb250YXRvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTZWFyY2giOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiUHJvY3VyYXIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk5vIHVzZXJzIGZvdW5kIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk7Do28gZm9yYW0gZW5jb250cmFkb3MgdXN1w6FyaW9zIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDbGljayB0byBhZGQgYXMgYSBjaGF0IGNvbnRhY3QiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQ2xpcXVlIHBhcmEgYWRpY2lvbmFyIGNvbW8gdW0gY29udGF0byBkbyBjaGF0IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDbGljayB0byBvcGVuIHRoaXMgcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDTGlxdWUgcGFyYSBhYnJpciBhIHNhbGEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNob3cgbW9yZSBpbmZvcm1hdGlvbiBvbiB0aGlzIHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTW9zdHJhciBtYWlzIGluZm9ybWHDp8O1ZXMgbmVzc2Egc2FsYSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiRGVzY3JpcHRpb246IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkRlc2NyacOnw6NvOiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiT2NjdXBhbnRzOiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJPY3VwYW50ZXM6IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJGZWF0dXJlczoiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiUmVjdXJzb3M6IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSZXF1aXJlcyBhdXRoZW50aWNhdGlvbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJSZXF1ZXIgYXV0ZW50aWNhw6fDo28iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkhpZGRlbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJFc2NvbmRpZG8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJlcXVpcmVzIGFuIGludml0YXRpb24iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiUmVxdWVyIHVtIGNvbnZpdGUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk1vZGVyYXRlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJNb2RlcmFkbyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTm9uLWFub255bW91cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJOw6NvIGFuw7RuaW1vIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJPcGVuIHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU2FsYSBhYmVydGEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlBlcm1hbmVudCByb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlNhbGEgcGVybWFuZW50ZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUHVibGljIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlDDumJsaWNvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTZW1pLWFub255bW91cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTZW1pIGFuw7RuaW1vIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUZW1wb3Jhcnkgcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTYWxhIHRlbXBvcsOhcmlhIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJVbm1vZGVyYXRlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTZW0gbW9kZXJhw6fDo28iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJvb21zIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlNhbGFzIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSb29tIG5hbWUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTm9tZSBkYSBzYWxhIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJOaWNrbmFtZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJBcGVsaWRvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTZXJ2ZXIiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU2VydmVyIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJKb2luIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkVudHJhciIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU2hvdyByb29tcyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJNb3N0YXIgc2FsYXMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk5vIHJvb21zIG9uICUxJHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU2VtIHNhbGFzIGVtICUxJHMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJvb21zIG9uICUxJHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU2FsYXMgZW0gJTEkcyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU2V0IGNoYXRyb29tIHRvcGljIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkRlZmluaXIgdMOzcGljbyBkbyBjaGF0IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJLaWNrIHVzZXIgZnJvbSBjaGF0cm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJFeHB1bHNhciB1c3XDoXJpbyBkbyBjaGF0IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJCYW4gdXNlciBmcm9tIGNoYXRyb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkJhbmlyIHVzdcOhcmlvIGRvIGNoYXQiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk1lc3NhZ2UiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTWVuc2FnZW0iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNhdmUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU2FsdmFyIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDYW5jZWwiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQ2FuY2VsYXIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkFuIGVycm9yIG9jY3VycmVkIHdoaWxlIHRyeWluZyB0byBzYXZlIHRoZSBmb3JtLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJPY29ycmV1IHVtIGVycm8gZW5xdWFudG8gdGVudGF2YSBzYWx2YXIgbyBmb3JtdWzDoXJpbyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyBjaGF0cm9vbSByZXF1aXJlcyBhIHBhc3N3b3JkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkVzc2UgY2hhdCBwcmVjaXNhIGRlIHNlbmhhIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJQYXNzd29yZDogIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlNlbmhhOiAiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlN1Ym1pdCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJFbnZpYXIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBpcyBub3QgYW5vbnltb3VzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkVzc2Egc2FsYSBuw6NvIMOpIGFuw7RuaW1hIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gbm93IHNob3dzIHVuYXZhaWxhYmxlIG1lbWJlcnMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQWdvcmEgZXN0YSBzYWxhIG1vc3RyYSBtZW1icm9zIGluZGlzcG9uw612ZWlzIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gZG9lcyBub3Qgc2hvdyB1bmF2YWlsYWJsZSBtZW1iZXJzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkVzc2Egc2FsYSBuw6NvIG1vc3RyYSBtZW1icm9zIGluZGlzcG9uw612ZWlzIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJOb24tcHJpdmFjeS1yZWxhdGVkIHJvb20gY29uZmlndXJhdGlvbiBoYXMgY2hhbmdlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDb25maWd1cmHDp8O1cyBuw6NvIHJlbGFjaW9uYWRhcyDDoCBwcml2YWNpZGFkZSBtdWRhcmFtIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSb29tIGxvZ2dpbmcgaXMgbm93IGVuYWJsZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTyBsb2cgZGEgc2FsYSBlc3TDoSBhdGl2YWRvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSb29tIGxvZ2dpbmcgaXMgbm93IGRpc2FibGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk8gbG9nIGRhIHNhbGEgZXN0w6EgZGVzYXRpdmFkbyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyByb29tIGlzIG5vdyBub24tYW5vbnltb3VzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkVzc2Ugc2FsYSDDqSBuw6NvIGFuw7RuaW1hIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gaXMgbm93IHNlbWktYW5vbnltb3VzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkVzc2Egc2FsYSBhZ29yYSDDqSBzZW1pIGFuw7RuaW1hIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gaXMgbm93IGZ1bGx5LWFub255bW91cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJFc3NhIHNhbGEgYWdvcmEgw6kgdG90YWxtZW50ZSBhbsO0bmltYSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQSBuZXcgcm9vbSBoYXMgYmVlbiBjcmVhdGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlVtYSBub3ZhIHNhbGEgZm9pIGNyaWFkYSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBuaWNrbmFtZSBoYXMgYmVlbiBjaGFuZ2VkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlNldSBhcGVsaWRvIGZvaSBtdWRhZG8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIjxzdHJvbmc+JTEkczwvc3Ryb25nPiBoYXMgYmVlbiBiYW5uZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IGZvaSBiYW5pZG8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIjxzdHJvbmc+JTEkczwvc3Ryb25nPiBoYXMgYmVlbiBraWNrZWQgb3V0IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIjxzdHJvbmc+JTEkczwvc3Ryb25nPiBmb2kgZXhwdWxzbyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IGhhcyBiZWVuIHJlbW92ZWQgYmVjYXVzZSBvZiBhbiBhZmZpbGlhdGlvbiBjaGFuZ2UiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiPHNydG9uZz4lMSRzPC9zdHJvbmc+IGZvaSByZW1vdmlkbyBwb3IgY2F1c2EgZGUgdHJvY2EgZGUgYXNzb2NpYcOnw6NvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gaGFzIGJlZW4gcmVtb3ZlZCBmb3Igbm90IGJlaW5nIGEgbWVtYmVyIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIjxzdHJvbmc+JTEkczwvc3Ryb25nPiBmb2kgcmVtb3ZpZG8gcG9yIG7Do28gc2VyIHVtIG1lbWJybyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91IGhhdmUgYmVlbiBiYW5uZWQgZnJvbSB0aGlzIHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVm9jw6ogZm9pIGJhbmlkbyBkZXNzYSBzYWxhIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3UgaGF2ZSBiZWVuIGtpY2tlZCBmcm9tIHRoaXMgcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJWb2PDqiBmb2kgZXhwdWxzbyBkZXNzYSBzYWxhIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3UgaGF2ZSBiZWVuIHJlbW92ZWQgZnJvbSB0aGlzIHJvb20gYmVjYXVzZSBvZiBhbiBhZmZpbGlhdGlvbiBjaGFuZ2UiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVm9jw6ogZm9pIHJlbW92aWRvIGRhIHNhbGEgZGV2aWRvIGEgdW1hIG11ZGFuw6dhIGRlIGFzc29jaWHDp8OjbyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91IGhhdmUgYmVlbiByZW1vdmVkIGZyb20gdGhpcyByb29tIGJlY2F1c2UgdGhlIHJvb20gaGFzIGNoYW5nZWQgdG8gbWVtYmVycy1vbmx5IGFuZCB5b3UncmUgbm90IGEgbWVtYmVyIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlZvY8OqIGZvaSByZW1vdmlkbyBkYSBzYWxhIHBvcnF1ZSBlbGEgZm9pIG11ZGFkYSBwYXJhIHNvbWVudGUgbWVtYnJvc2Ugdm9jw6ogbsOjbyDDqSB1bSBtZW1icm8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdSBoYXZlIGJlZW4gcmVtb3ZlZCBmcm9tIHRoaXMgcm9vbSBiZWNhdXNlIHRoZSBNVUMgKE11bHRpLXVzZXIgY2hhdCkgc2VydmljZSBpcyBiZWluZyBzaHV0IGRvd24uIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlZvY8OqIGZvaSByZW1vdmlkbyBkYSBzYWxhIGRldmlkbyBhIE1VQyAoTXVsdGktdXNlciBjaGF0KW8gc2VydmnDp28gZXN0w6Egc2VuZG8gZGVzbGlnYWRvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3UgYXJlIG5vdCBvbiB0aGUgbWVtYmVyIGxpc3Qgb2YgdGhpcyByb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlZvY8OqIG7Do28gw6kgbWVtYnJvIGRlc3NhIHNhbGEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk5vIG5pY2tuYW1lIHdhcyBzcGVjaWZpZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVm9jw6ogbsOjbyBlc2NvbGhldSB1bSBhcGVsaWRvICIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91IGFyZSBub3QgYWxsb3dlZCB0byBjcmVhdGUgbmV3IHJvb21zIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlZvY8OqIG7Do28gdGVtIHBlcm1pdGnDp8OjbyBkZSBjcmlhciBub3ZhcyBzYWxhcyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBuaWNrbmFtZSBkb2Vzbid0IGNvbmZvcm0gdG8gdGhpcyByb29tJ3MgcG9saWNpZXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU2V1IGFwZWxpZG8gbsOjbyBlc3TDoSBkZSBhY29yZG8gY29tIGFzIHJlZ3JhcyBkYSBzYWxhIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG5pY2tuYW1lIGlzIGFscmVhZHkgdGFrZW4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU2V1IGFwZWxpZG8gasOhIGZvaSBlc2NvbGhpZG8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBkb2VzIG5vdCAoeWV0KSBleGlzdCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJBIHNhbGEgbsOjbyBleGlzdGUgKGFpbmRhKSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyByb29tIGhhcyByZWFjaGVkIGl0J3MgbWF4aW11bSBudW1iZXIgb2Ygb2NjdXBhbnRzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkEgc2FsYSBhdGluZ2l1IG8gbsO6bWVybyBtw6F4aW1vIGRlIG9jdXBhbnRlcyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVG9waWMgc2V0IGJ5ICUxJHMgdG86ICUyJHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVG9waWNvIGRlZmluaWRvIHBvciAlMSRzIHBhcmE6ICUyJHMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgdXNlciBpcyBhIG1vZGVyYXRvciI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJFc3NlIHVzdcOhcmlvIMOpIG8gbW9kZXJhZG9yIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHVzZXIgY2FuIHNlbmQgbWVzc2FnZXMgaW4gdGhpcyByb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkVzc2UgdXN1w6FyaW8gcG9kZSBlbnZpYXIgbWVuc2FnZW5zIG5lc3NhIHNhbGEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgdXNlciBjYW4gTk9UIHNlbmQgbWVzc2FnZXMgaW4gdGhpcyByb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkVzc2UgdXN1w6FyaW8gTsODTyBwb2RlIGVudmlhciBtZW5zYWdlbnMgbmVzc2Egc2FsYSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgdG8gY2hhdCB3aXRoIHRoaXMgY29udGFjdCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDbGlxdWUgcGFyYSBjb252ZXJzYXIgY29tIG8gY29udGF0byIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgdG8gcmVtb3ZlIHRoaXMgY29udGFjdCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDbGlxdWUgcGFyYSByZW1vdmVyIG8gY29udGF0byIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyBjb250YWN0IGlzIGJ1c3kiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRXN0ZSBjb250YXRvIGVzdMOhIG9jdXBhZG8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgY29udGFjdCBpcyBvbmxpbmUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRXN0ZSBjb250YXRvIGVzdMOhIG9ubGluZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyBjb250YWN0IGlzIG9mZmxpbmUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRXN0ZSBjb250YXRvIGVzdMOhIG9mZmxpbmUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgY29udGFjdCBpcyB1bmF2YWlsYWJsZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJFc3RlIGNvbnRhdG8gZXN0w6EgaW5kaXNwb27DrXZlbCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyBjb250YWN0IGlzIGF3YXkgZm9yIGFuIGV4dGVuZGVkIHBlcmlvZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJFc3RlIGNvbnRhdG8gZXN0w6EgYXVzZW50ZSBwb3IgdW0gbG9uZ28gcGVyw61vZG8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgY29udGFjdCBpcyBhd2F5IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkVzdGUgY29udGF0byBlc3TDoSBhdXNlbnRlIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb250YWN0IHJlcXVlc3RzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlNvbGljaXRhw6fDo28gZGUgY29udGF0b3MiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk15IGNvbnRhY3RzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk1ldXMgY29udGF0b3MiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlBlbmRpbmcgY29udGFjdHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQ29udGFkb3MgcGVuZGVudGVzIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDdXN0b20gc3RhdHVzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlN0YXR1cyBjdXN0b21pemFkbyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgdG8gY2hhbmdlIHlvdXIgY2hhdCBzdGF0dXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQ2xpcXVlIHBhcmEgbXVkYXIgc2V1IHN0YXR1cyBubyBjaGF0IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDbGljayBoZXJlIHRvIHdyaXRlIGEgY3VzdG9tIHN0YXR1cyBtZXNzYWdlIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkNsaXF1ZSBhcXVpIHBhcmEgY3VzdG9taXphciBhIG1lbnNhZ2VtIGRlIHN0YXR1cyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAib25saW5lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIm9ubGluZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiYnVzeSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJvY3VwYWRvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJhd2F5IGZvciBsb25nIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgImF1c2VudGUgYSBiYXN0YW50ZSB0ZW1wbyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiYXdheSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJhdXNlbnRlIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJJIGFtICUxJHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRXN0b3UgJTEkcyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU2lnbiBpbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDb25lY3Rhci1zZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWE1QUC9KYWJiZXIgVXNlcm5hbWU6IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlVzdcOhcmlvIFhNUFAvSmFiYmVyOiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUGFzc3dvcmQ6IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlNlbmhhOiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTG9nIEluIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkVudHJhciIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQk9TSCBTZXJ2aWNlIFVSTDoiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVVJMIGRlIHNlcnZpw6dvIEJPU0g6IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJPbmxpbmUgQ29udGFjdHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQ29udGF0b3Mgb25saW5lIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICIlMSRzIGlzIHR5cGluZyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIlMSRzIGVzdMOhIGRpZ2l0YW5kbyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ29ubmVjdGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkNvbmVjdGFkbyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQXR0YWNoZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQW5leGFkbyIKICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7CiAgICAgICAgZGVmaW5lKCJwdF9CUiIsIFsnamVkJ10sIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkobmV3IEplZCh0cmFuc2xhdGlvbnMpKTsKICAgICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKCF3aW5kb3cubG9jYWxlcykgewogICAgICAgICAgICB3aW5kb3cubG9jYWxlcyA9IHt9OwogICAgICAgIH0KICAgICAgICB3aW5kb3cubG9jYWxlcy5wdF9CUiA9IGZhY3RvcnkobmV3IEplZCh0cmFuc2xhdGlvbnMpKTsKICAgIH0KICB9KHRoaXMsIGZ1bmN0aW9uIChpMThuKSB7CiAgICAgIHJldHVybiBpMThuOwogIH0pCik7CgooZnVuY3Rpb24gKHJvb3QsIGZhY3RvcnkpIHsKICAgIHZhciB0cmFuc2xhdGlvbnMgPSB7CiAgICAgICAgImRvbWFpbiI6ICJjb252ZXJzZSIsCiAgICAgICAgImxvY2FsZV9kYXRhIjoKCgp7CiAgICJjb252ZXJzZSI6IHsKICAgICAgIiI6IHsKICAgICAgICAgIlByb2plY3QtSWQtVmVyc2lvbiI6ICJDb252ZXJzZS5qcyAwLjQiLAogICAgICAgICAiUmVwb3J0LU1zZ2lkLUJ1Z3MtVG8iOiAiIiwKICAgICAgICAgIlBPVC1DcmVhdGlvbi1EYXRlIjogIjIwMTMtMDktMTUgMjI6MDYrMDIwMCIsCiAgICAgICAgICJQTy1SZXZpc2lvbi1EYXRlIjogIjIwMTMtMDktMjkgMTc6MjQrMDMwMCIsCiAgICAgICAgICJMYXN0LVRyYW5zbGF0b3IiOiAiQm9yaXMgS29jaGVyb3YgPGJrQHJhc2tvbi5vcmc+IiwKICAgICAgICAgIkxhbmd1YWdlLVRlYW0iOiAiPGJrQHJhc2tvbi5ydT4iLAogICAgICAgICAiTGFuZ3VhZ2UiOiAicnUiLAogICAgICAgICAiTUlNRS1WZXJzaW9uIjogIjEuMCIsCiAgICAgICAgICJDb250ZW50LVR5cGUiOiAidGV4dC9wbGFpbjsgY2hhcnNldD1VVEYtOCIsCiAgICAgICAgICJDb250ZW50LVRyYW5zZmVyLUVuY29kaW5nIjogIjhiaXQiLAogICAgICAgICAiWC1HZW5lcmF0b3IiOiAiUG9lZGl0IDEuNS41IgogICAgICB9LAogICAgICAidW5lbmNyeXB0ZWQiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQvdC1INC30LDRiNC40YTRgNC+0LLQsNC90L4iCiAgICAgIF0sCiAgICAgICJ1bnZlcmlmaWVkIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0L3QtdC/0YDQvtCy0LXRgNC10L3QviIKICAgICAgXSwKICAgICAgInZlcmlmaWVkIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0L/RgNC+0LLQtdGA0LXQvdC+IgogICAgICBdLAogICAgICAiZmluaXNoZWQiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQt9Cw0LrQvtC90YfQtdC90L4iCiAgICAgIF0sCiAgICAgICJEaXNjb25uZWN0ZWQiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQntGC0LrQu9GO0YfQtdC90L4iCiAgICAgIF0sCiAgICAgICJFcnJvciI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCe0YjQuNCx0LrQsCIKICAgICAgXSwKICAgICAgIkNvbm5lY3RpbmciOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQodC+0LXQtNC40L3QtdC90LjQtSIKICAgICAgXSwKICAgICAgIkNvbm5lY3Rpb24gRmFpbGVkIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0J3QtSDRg9C00LDQu9C+0YHRjCDRgdC+0LXQtNC40L3QuNGC0YHRjyIKICAgICAgXSwKICAgICAgIkF1dGhlbnRpY2F0aW5nIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0JDQstGC0L7RgNC40LfQsNGG0LjRjyIKICAgICAgXSwKICAgICAgIkF1dGhlbnRpY2F0aW9uIEZhaWxlZCI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCd0LUg0YPQtNCw0LvQvtGB0Ywg0LDQstGC0L7RgNC40LfQvtCy0LDRgtGM0YHRjyIKICAgICAgXSwKICAgICAgIkRpc2Nvbm5lY3RpbmciOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQntGC0LrQu9GO0YfQsNC10LzRgdGPIgogICAgICBdLAogICAgICAiUHJpdmF0ZSBrZXkgZ2VuZXJhdGVkLiI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCf0YDQuNCy0LDRgtC90YvQuSDQutC70Y7RhyDRgdCz0LXQvdC10YDQuNGA0L7QstCw0L0uIgogICAgICBdLAogICAgICAiUGVyc29uYWwgbWVzc2FnZSI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCS0LLQtdC00LjRgtC1INGB0L7QvtCx0YnQtdC90LjQtSIKICAgICAgXSwKICAgICAgIldoYXQncyB0aGlzPyI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCn0YLQviDRjdGC0L4/IgogICAgICBdLAogICAgICAibWUiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQryIKICAgICAgXSwKICAgICAgIlNob3cgdGhpcyBtZW51IjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0J/QvtC60LDQt9Cw0YLRjCDRjdGC0L4g0LzQtdC90Y4iCiAgICAgIF0sCiAgICAgICJSZW1vdmUgbWVzc2FnZXMiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQo9C00LDQu9C40YLRjCDRgdC+0L7QsdGJ0LXQvdC40Y8iCiAgICAgIF0sCiAgICAgICJZb3VyIG1lc3NhZ2UgY291bGQgbm90IGJlIHNlbnQiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQktCw0YjQtSDRgdC+0L7QsdGJ0LXQvdC40LUg0L3QtSDQv9C+0YHQu9Cw0L3QviIKICAgICAgXSwKICAgICAgIllvdXIgbWVzc2FnZXMgYXJlIG5vdCBlbmNyeXB0ZWQgYW55bW9yZSI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCS0LDRiNC4INGB0L7QvtCx0YnQtdC90LjRjyDQsdC+0LvRjNGI0LUg0L3QtSDRiNC40YTRgNGD0Y7RgtGB0Y8iCiAgICAgIF0sCiAgICAgICJZb3VyIG1lc3NhZ2VzIGFyZSBub3cgZW5jcnlwdGVkIGJ1dCB5b3VyIGJ1ZGR5J3MgaWRlbnRpdHkgaGFzIG5vdCBiZWVuIHZlcmlmaWVkLiI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCS0LDRiNC4INGB0L7QvtCx0YnQtdC90LjRjyDRiNC40YTRgNGD0Y7RgtGB0Y8sINC90L4g0LLQsNGI0LAg0YPRh9GR0YLQvdCw0Y8g0LfQsNC/0LjRgdGMINC90LUg0L/RgNC+0LLQtdGA0LXQvdCwINCy0LDRiNC40Lwg0YHQvtCx0LXRgdC10LTQvdC40LrQvtC8LiIKICAgICAgXSwKICAgICAgIllvdXIgYnVkZHkncyBpZGVudGlmeSBoYXMgYmVlbiB2ZXJpZmllZC4iOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQktCw0YjQsCDRg9GH0ZHRgtC90LDRjyDQt9Cw0L/QuNGB0Ywg0L/RgNC+0LLQtdGA0LXQvdCwINCy0LDRiNC40Lwg0YHQvtCx0LXRgdC10LTQvdC40LrQvtC8LiIKICAgICAgXSwKICAgICAgIllvdXIgbWVzc2FnZXMgYXJlIG5vdCBlbmNyeXB0ZWQuIENsaWNrIGhlcmUgdG8gZW5hYmxlIE9UUiBlbmNyeXB0aW9uLiI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCS0LDRiNC4INGB0L7QvtCx0YnQtdC90LjRjyDQvdC1INGI0LjRhNGA0YPRjtGC0YHRjy4g0J3QsNC20LzQuNGC0LUg0LfQtNC10YHRjCDRh9GC0L7QsdGLINC90LDRgdGC0YDQvtC40YLRjCDRiNC40YTRgNC+0LLQsNC90LjQtS4iCiAgICAgIF0sCiAgICAgICJZb3VyIG1lc3NhZ2VzIGFyZSBlbmNyeXB0ZWQsIGJ1dCB5b3VyIGJ1ZGR5IGhhcyBub3QgYmVlbiB2ZXJpZmllZC4iOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQktCw0YjQuCDRgdC+0L7QsdGJ0LXQvdC40Y8g0YjQuNGE0YDRg9GO0YLRgdGPLCDQvdC+INCy0LDRiCDQutC+0L3RgtCw0LrRgiDQvdC1INC/0YDQvtCy0LXRgNC10L0uIgogICAgICBdLAogICAgICAiWW91ciBtZXNzYWdlcyBhcmUgZW5jcnlwdGVkIGFuZCB5b3VyIGJ1ZGR5IHZlcmlmaWVkLiI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCS0LDRiNC4INGB0L7QvtCx0YnQtdC90LjRjyDRiNC40YTRgNGD0Y7RgtGB0Y8g0Lgg0LLQsNGIINC60L7QvdGC0LDQutGCINC/0YDQvtCy0LXRgNC10L0iCiAgICAgIF0sCiAgICAgICJDb250YWN0cyI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCa0L7QvdGC0LDQutGC0YsiCiAgICAgIF0sCiAgICAgICJPbmxpbmUiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQkiDRgdC10YLQuCIKICAgICAgXSwKICAgICAgIkJ1c3kiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQl9Cw0L3Rj9GCIgogICAgICBdLAogICAgICAiQXdheSI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCe0YLQvtGI0ZHQuyIKICAgICAgXSwKICAgICAgIk9mZmxpbmUiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQndC1INCyINGB0LXRgtC4IgogICAgICBdLAogICAgICAiQ2xpY2sgdG8gYWRkIG5ldyBjaGF0IGNvbnRhY3RzIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0JTQvtCx0LDQstC40YLRjCDQvdC+0LLRg9GOINC60L7QvdGE0LXRgNC10L3RhtC40Y4iCiAgICAgIF0sCiAgICAgICJBZGQgYSBjb250YWN0IjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0JTQvtCx0LDQstGC0Ywg0LrQvtC90YLQsNC60YIiCiAgICAgIF0sCiAgICAgICJDb250YWN0IHVzZXJuYW1lIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0JjQvNGPINC/0L7Qu9GM0LfQvtCy0LDRgtC10LvRjyIKICAgICAgXSwKICAgICAgIkFkZCI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCU0L7QsdCw0LLQuNGC0YwiCiAgICAgIF0sCiAgICAgICJDb250YWN0IG5hbWUiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQmNC80Y8g0LrQvtC90YLQsNC60YLQsCIKICAgICAgXSwKICAgICAgIlNlYXJjaCI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCf0L7QuNGB0LoiCiAgICAgIF0sCiAgICAgICJObyB1c2VycyBmb3VuZCI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCf0L7Qu9GM0LfQvtCy0LDRgtC10LvQuCDQvdC1INC90LDQudC00LXQvdGLIgogICAgICBdLAogICAgICAiQ2xpY2sgdG8gYWRkIGFzIGEgY2hhdCBjb250YWN0IjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0JTQvtCx0LDQstC40YLRjCDQutC+0L3RgtCw0LrRgiIKICAgICAgXSwKICAgICAgIkNsaWNrIHRvIG9wZW4gdGhpcyByb29tIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0JfQsNC50YLQuCDQsiDQutC+0L3RhNC10YDQtdC90YbQuNGOIgogICAgICBdLAogICAgICAiU2hvdyBtb3JlIGluZm9ybWF0aW9uIG9uIHRoaXMgcm9vbSI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCf0L7QutCw0LfQsNGC0Ywg0LHQvtC70YzRiNC1INC40L3RhNC+0YDQvNCw0YbQuNC4INC+0LEg0Y3RgtC+0Lkg0LrQvtC90YTQtdGA0LXQvdGG0LjQuCIKICAgICAgXSwKICAgICAgIkRlc2NyaXB0aW9uOiI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCe0L/QuNGB0LDQvdC40LU6IgogICAgICBdLAogICAgICAiT2NjdXBhbnRzOiI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCj0YfQsNGB0YLQvdC40LrQuDoiCiAgICAgIF0sCiAgICAgICJGZWF0dXJlczoiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQodCy0L7QudGB0YLQstCwOiIKICAgICAgXSwKICAgICAgIlJlcXVpcmVzIGF1dGhlbnRpY2F0aW9uIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0KLRgNC10LHRg9C10YLRgdGPINCw0LLRgtC+0YDQuNC30LDRhtC40Y8iCiAgICAgIF0sCiAgICAgICJIaWRkZW4iOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQodC60YDRi9GC0L4iCiAgICAgIF0sCiAgICAgICJSZXF1aXJlcyBhbiBpbnZpdGF0aW9uIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0KLRgNC10LHRg9C10YLRgdGPINC/0YDQuNCz0LvQsNGI0LXQvdC40LUiCiAgICAgIF0sCiAgICAgICJNb2RlcmF0ZWQiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQnNC+0LTQtdGA0LjRgNGD0LXQvNCw0Y8iCiAgICAgIF0sCiAgICAgICJOb24tYW5vbnltb3VzIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0J3QtSDQsNC90L7QvdC40LzQvdCw0Y8iCiAgICAgIF0sCiAgICAgICJPcGVuIHJvb20iOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQntGC0LrRgNGL0YLRjCDQutC+0L3RhNC10YDQtdC90YbQuNGOIgogICAgICBdLAogICAgICAiUGVybWFuZW50IHJvb20iOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQn9C10YDQvNCw0L3QtdC90YLQvdCw0Y8g0LrQvtC90YTQtdGA0LXQvdGG0LjRjyIKICAgICAgXSwKICAgICAgIlB1YmxpYyI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCf0YPQsdC70LjRh9C90YvQuSIKICAgICAgXSwKICAgICAgIlNlbWktYW5vbnltb3VzIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0KfQsNGB0YLQuNGH0L3QviDQsNC90L7QvdC40LzQvdCw0Y8iCiAgICAgIF0sCiAgICAgICJUZW1wb3Jhcnkgcm9vbSI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCS0YDQtdC80LXQvdC90LDRjyDQutC+0L3RhNC10YDQtdC90YbQuNGPIgogICAgICBdLAogICAgICAiVW5tb2RlcmF0ZWQiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQndC10LzQvtC00LXRgNC40YDRg9C10LzQsNGPIgogICAgICBdLAogICAgICAiUm9vbXMiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQmtC+0L3RhNC10YAuIgogICAgICBdLAogICAgICAiUm9vbSBuYW1lIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0JjQvNGPINC60L7QvdGE0LXRgNC10L3RhtC40LgiCiAgICAgIF0sCiAgICAgICJOaWNrbmFtZSI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCf0YHQtdCy0LTQvtC90LjQvCIKICAgICAgXSwKICAgICAgIlNlcnZlciI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCh0LXRgNCy0LXRgCIKICAgICAgXSwKICAgICAgIkpvaW4iOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQn9C+0LTQutC70Y7Rh9C40YLRjNGB0Y8iCiAgICAgIF0sCiAgICAgICJTaG93IHJvb21zIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0J7QsdC90L7QstC40YLRjCIKICAgICAgXSwKICAgICAgIk5vIHJvb21zIG9uICUxJHMiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQndC10YIg0LTQvtGB0YLRg9C/0L3Ri9GFINC60L7QvdGE0LXRgNC10L3RhtC40LkgJTEkcyIKICAgICAgXSwKICAgICAgIlJvb21zIG9uICUxJHMiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQmtC+0L3RhNC10YDQtdC90YbQuNC4ICUxJHM6IgogICAgICBdLAogICAgICAiU2V0IGNoYXRyb29tIHRvcGljIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0KPRgdGC0LDQvdC+0LLQuNGC0Ywg0YLQtdC80YMiCiAgICAgIF0sCiAgICAgICJLaWNrIHVzZXIgZnJvbSBjaGF0cm9vbSI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCe0YLQutC70Y7Rh9C40YLRjCDQv9C+0LvRjNC30L7QstCw0YLQtdC70Y8g0L7RgiDQutC90L7RhNC10YAuIgogICAgICBdLAogICAgICAiQmFuIHVzZXIgZnJvbSBjaGF0cm9vbSI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCX0LDQsdCw0L3QuNGC0Ywg0L/QvtC70YzQt9C+0LLQsNGC0LXQu9GPINCyINGN0YLQvtC5INC60L7QvdGELiIKICAgICAgXSwKICAgICAgIk1lc3NhZ2UiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQodC+0L7QsdGJ0LXQvdC40LUiCiAgICAgIF0sCiAgICAgICJTYXZlIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0KHQvtGF0YDQsNC90LjRgtGMIgogICAgICBdLAogICAgICAiQ2FuY2VsIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0J7RgtC80LXQvdC40YLRjCIKICAgICAgXSwKICAgICAgIkFuIGVycm9yIG9jY3VycmVkIHdoaWxlIHRyeWluZyB0byBzYXZlIHRoZSBmb3JtLiI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCf0YDQuCDRgdC+0YXRgNCw0L3QtdC90LjQtSDRhNC+0YDQvNGLINC/0YDQvtC40LfQvtGI0LvQsCDQvtGI0LjQsdC60LAuIgogICAgICBdLAogICAgICAiVGhpcyBjaGF0cm9vbSByZXF1aXJlcyBhIHBhc3N3b3JkIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0JTQu9GPINC00L7RgdGC0YPQv9CwINCyINC60L7QvdGE0LXRgC4g0L3QtdC+0LHRhdC+0LTQuNC8INC/0LDRgNC+0LvRjC4iCiAgICAgIF0sCiAgICAgICJQYXNzd29yZDogIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0J/QsNGA0L7Qu9GMOiAiCiAgICAgIF0sCiAgICAgICJTdWJtaXQiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQntGC0L/RgNCw0LLQuNGC0YwiCiAgICAgIF0sCiAgICAgICJUaGlzIHJvb20gaXMgbm90IGFub255bW91cyI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCt0YLQsCDQutC+0LzQvdCw0YLQsCDQvdC1INCw0L3QvtC90LjQvNC90LDRjyIKICAgICAgXSwKICAgICAgIlRoaXMgcm9vbSBub3cgc2hvd3MgdW5hdmFpbGFibGUgbWVtYmVycyI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCt0YLQsCDQutC+0LzQvdCw0YLQsCDQv9C+0LrQsNC30YvQstCw0LXRgiDQtNC+0YHRgtGD0L/QvdGL0YUg0YHQvtCx0LXRgdC10LTQvdC40LrQvtCyIgogICAgICBdLAogICAgICAiVGhpcyByb29tIGRvZXMgbm90IHNob3cgdW5hdmFpbGFibGUgbWVtYmVycyI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCt0YLQsCDQutC+0LzQvdCw0YLQsCDQvdC1INC/0L7QutCw0LfRi9Cy0LDQtdGCINC90LXQtNC+0YHRgtGD0L/QvdGL0YUg0YHQvtCx0LXRgdC10LTQvdC40LrQvtCyIgogICAgICBdLAogICAgICAiVGhpcyByb29tIGlzIG5vdyBub24tYW5vbnltb3VzIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0K3RgtCwINC60L7QvNC90LDRgtCwINC90LUg0LDQvdC+0L3QuNC80L3QsNGPIgogICAgICBdLAogICAgICAiVGhpcyByb29tIGlzIG5vdyBzZW1pLWFub255bW91cyI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCt0YLQsCDQutC+0LzQvdCw0YLQsCDRh9Cw0YHRgtC40YfQvdC+INCw0L3QvtC90LjQvNC90LDRjyIKICAgICAgXSwKICAgICAgIlRoaXMgcm9vbSBpcyBub3cgZnVsbHktYW5vbnltb3VzIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0K3RgtCwINC60L7QvNC90LDRgtCwINGB0YLQsNC70LAg0L/QvtC70L3QvtGB0YLRjNGOINCw0L3QvtC90LjQvNC90L7QuSIKICAgICAgXSwKICAgICAgIkEgbmV3IHJvb20gaGFzIGJlZW4gY3JlYXRlZCI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCd0L7QstCw0Y8g0LrQvtC80L3QsNGC0LAg0LHRi9C70LAg0YHQvtC30LTQsNC90LAiCiAgICAgIF0sCiAgICAgICJZb3VyIG5pY2tuYW1lIGhhcyBiZWVuIGNoYW5nZWQiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQktCw0Ygg0L/RgdC10LLQtNC+0L3QuNC8INGD0LbQtSDQuNGB0L/QvtC70YzQt9GD0LXRgtGB0Y8g0LTRgNGD0LPQuNC8INC/0L7Qu9GM0LfQvtCy0LDRgtC10LvQtdC8IgogICAgICBdLAogICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IGhhcyBiZWVuIGJhbm5lZCI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgIjxzdHJvbmc+JTEkczwvc3Ryb25nPiDQt9Cw0LHQsNC90LXQvSIKICAgICAgXSwKICAgICAgIjxzdHJvbmc+JTEkczwvc3Ryb25nPiBoYXMgYmVlbiBraWNrZWQgb3V0IjogWwogICAgICAgICBudWxsLAogICAgICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+INCy0YvQtNCy0L7RgNC10L0iCiAgICAgIF0sCiAgICAgICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gaGFzIGJlZW4gcmVtb3ZlZCBiZWNhdXNlIG9mIGFuIGFmZmlsaWF0aW9uIGNoYW5nZSI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgIjxzdHJvbmc+JTEkczwvc3Ryb25nPiBoYXMgYmVlbiByZW1vdmVkIGJlY2F1c2Ugb2YgYW4gYWZmaWxpYXRpb24gY2hhbmdlIgogICAgICBdLAogICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IGhhcyBiZWVuIHJlbW92ZWQgZm9yIG5vdCBiZWluZyBhIG1lbWJlciI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgIjxzdHJvbmc+JTEkczwvc3Ryb25nPiDRg9C00LDQu9GR0L0g0L/QvtGC0L7QvNGDINGH0YLQviDQvdC1INGD0YfQsNGB0YLQvdC40LoiCiAgICAgIF0sCiAgICAgICJZb3UgaGF2ZSBiZWVuIGJhbm5lZCBmcm9tIHRoaXMgcm9vbSI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCS0LDQvCDQt9Cw0L/RgNC10YnQtdC90L4g0L/QvtC00LrQu9GO0YfQsNGC0YHRjyDQuiDRjdGC0L7QuSDQutC+0L3RhNC10YDQtdC90YbQuNC4IgogICAgICBdLAogICAgICAiWW91IGhhdmUgYmVlbiBraWNrZWQgZnJvbSB0aGlzIHJvb20iOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQktCw0Lwg0LfQsNC/0YDQtdGJ0LXQvdC+INC/0L7QtNC60LvRjtGH0LDRgtGB0Y8g0Log0Y3RgtC+0Lkg0LrQvtC90YTQtdGA0LXQvdGG0LjQuCIKICAgICAgXSwKICAgICAgIllvdSBoYXZlIGJlZW4gcmVtb3ZlZCBmcm9tIHRoaXMgcm9vbSBiZWNhdXNlIG9mIGFuIGFmZmlsaWF0aW9uIGNoYW5nZSI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgIjxzdHJvbmc+JTEkczwvc3Ryb25nPiDRg9C00LDQu9GR0L0g0L/QvtGC0L7QvNGDINGH0YLQviDQuNC30LzQtdC90LjQu9C40YHRjCDQv9GA0LDQstCwIgogICAgICBdLAogICAgICAiWW91IGhhdmUgYmVlbiByZW1vdmVkIGZyb20gdGhpcyByb29tIGJlY2F1c2UgdGhlIHJvb20gaGFzIGNoYW5nZWQgdG8gbWVtYmVycy1vbmx5IGFuZCB5b3UncmUgbm90IGEgbWVtYmVyIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0JLRiyDQvtGC0LrQu9GO0YfQtdC90Ysg0L7RgiDRjdGC0L7QuSDQutC+0L3RhNC10YDQtdC90YbQuNC4INC/0L7RgtC+0LzRgyDRh9GC0L4g0YDQtdC20LjQvCDQuNC30LzQtdC90LjQu9GB0Y86INGC0L7Qu9GM0LrQvi3Rg9GH0LDRgdGC0L3QuNC60LgiCiAgICAgIF0sCiAgICAgICJZb3UgaGF2ZSBiZWVuIHJlbW92ZWQgZnJvbSB0aGlzIHJvb20gYmVjYXVzZSB0aGUgTVVDIChNdWx0aS11c2VyIGNoYXQpIHNlcnZpY2UgaXMgYmVpbmcgc2h1dCBkb3duLiI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCS0Ysg0L7RgtC60LvRjtGH0LXQvdGLINC+0YIg0Y3RgtC+0Lkg0LrQvtC90YTQtdGA0LXQvdGG0LjQuCDQv9C+0YLQvtC80YMg0YfRgtC+INGB0LXRgNCy0LjRgdGMINC60L7QvdGE0LXRgNC10L3RhtC40Lkg0LLRi9C60LvRjtGH0LXQvS4iCiAgICAgIF0sCiAgICAgICJZb3UgYXJlIG5vdCBvbiB0aGUgbWVtYmVyIGxpc3Qgb2YgdGhpcyByb29tIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0JLQsNGBINC90LXRgiDQsiDRgdC/0LjRgdC60LUg0Y3RgtC+0Lkg0LrQvtC90YTQtdGA0LXQvdGG0LjQuCIKICAgICAgXSwKICAgICAgIk5vIG5pY2tuYW1lIHdhcyBzcGVjaWZpZWQiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQktGLINC90LUg0YPQutCw0LfQsNC70Lgg0L/RgdC10LLQtNC+0L3QuNC8IgogICAgICBdLAogICAgICAiWW91IGFyZSBub3QgYWxsb3dlZCB0byBjcmVhdGUgbmV3IHJvb21zIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0JLRiyDQvdC1INC40LzQtdC10YLQtSDQv9GA0LDQstCwINGB0L7Qt9C00LDQstCw0YLRjCDQutC+0L3RhNC10YAuIgogICAgICBdLAogICAgICAiWW91ciBuaWNrbmFtZSBkb2Vzbid0IGNvbmZvcm0gdG8gdGhpcyByb29tJ3MgcG9saWNpZXMiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQn9GB0LXQstC00L7QvdC40Lwg0L3QtSDRgdC+0LPQu9Cw0YHRg9C10YLRgdGPINGBINC/0YDQsNCy0LjQu9Cw0LzQuCDQutC+0L3RhNC10YAuIgogICAgICBdLAogICAgICAiWW91ciBuaWNrbmFtZSBpcyBhbHJlYWR5IHRha2VuIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0JLQsNGIINC90LjQuiDRg9C20LUg0LjRgdC/0L7Qu9GM0LfRg9C10YLRgdGPINC00YDRg9Cz0LjQvCDQv9C+0LvRjNC30L7QstCw0YLQtdC70LXQvCIKICAgICAgXSwKICAgICAgIlRoaXMgcm9vbSBkb2VzIG5vdCAoeWV0KSBleGlzdCI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCt0YLQsCDQutC+0LzQvdCw0YLQsCDQvdC1INGB0YPRidC10YHRgtCy0YPQtdGCIgogICAgICBdLAogICAgICAiVGhpcyByb29tIGhhcyByZWFjaGVkIGl0J3MgbWF4aW11bSBudW1iZXIgb2Ygb2NjdXBhbnRzIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0JrQvtC90YTQtdGA0LXQvdGG0LjRjyDQtNC+0YHRgtC40LPQu9CwINC80LDQutGB0LjQvNCw0LvRjNC90L7Qs9C+INC60L7Qu9C40YfQtdGB0YLQstCwINGD0YfQsNGB0YLQvdC40LrQvtCyIgogICAgICBdLAogICAgICAiVG9waWMgc2V0IGJ5ICUxJHMgdG86ICUyJHMiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQotC10LzQsCAlMiRzINGD0YHRgtCw0YLQvdC+0LLQu9C10L3QsCAlMSRzIgogICAgICBdLAogICAgICAiVGhpcyB1c2VyIGlzIGEgbW9kZXJhdG9yIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0JzQvtC00LXRgNCw0YLQvtGAIgogICAgICBdLAogICAgICAiVGhpcyB1c2VyIGNhbiBzZW5kIG1lc3NhZ2VzIGluIHRoaXMgcm9vbSI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCh0L7QsdC10YHQtdC00L3QuNC6IgogICAgICBdLAogICAgICAiVGhpcyB1c2VyIGNhbiBOT1Qgc2VuZCBtZXNzYWdlcyBpbiB0aGlzIHJvb20iOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQn9C+0LvRjNC30L7QstCw0YLQtdC70Ywg0L3QtSDQvNC+0LbQtdGCINC/0L7RgdGL0LvQsNGC0Ywg0YHQvtC+0LHRidC10L3QuNGPINCyINGN0YLRgyDQutC+0LzQvdCw0YLRgyIKICAgICAgXSwKICAgICAgIkNsaWNrIHRvIGNoYXQgd2l0aCB0aGlzIGNvbnRhY3QiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQndCw0YfQsNGC0Ywg0L7QsdGJ0LXQvdC40LUiCiAgICAgIF0sCiAgICAgICJDbGljayB0byByZW1vdmUgdGhpcyBjb250YWN0IjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0KPQtNCw0LvQuNGC0Ywg0LrQvtC90YLQsNC60YIiCiAgICAgIF0sCiAgICAgICJUaGlzIGNvbnRhY3QgaXMgYnVzeSI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCX0LDQvdGP0YIiCiAgICAgIF0sCiAgICAgICJUaGlzIGNvbnRhY3QgaXMgb25saW5lIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0JIg0YHQtdGC0LgiCiAgICAgIF0sCiAgICAgICJUaGlzIGNvbnRhY3QgaXMgb2ZmbGluZSI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCd0LUg0LIg0YHQtdGC0LgiCiAgICAgIF0sCiAgICAgICJUaGlzIGNvbnRhY3QgaXMgdW5hdmFpbGFibGUiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQndC1INC00L7RgdGC0YPQv9C10L0iCiAgICAgIF0sCiAgICAgICJUaGlzIGNvbnRhY3QgaXMgYXdheSBmb3IgYW4gZXh0ZW5kZWQgcGVyaW9kIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0J3QsCDQtNC+0LvQs9C+INC+0YLQvtGI0ZHQuyIKICAgICAgXSwKICAgICAgIlRoaXMgY29udGFjdCBpcyBhd2F5IjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0J7RgtC+0YjRkdC7IgogICAgICBdLAogICAgICAiQ29udGFjdCByZXF1ZXN0cyI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCX0LDQv9GA0L7RgdGLINC90LAg0LDQstGC0L7RgNC40LfQsNGG0LjRjiIKICAgICAgXSwKICAgICAgIk15IGNvbnRhY3RzIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0JrQvtC90YLQsNC60YLRiyIKICAgICAgXSwKICAgICAgIlBlbmRpbmcgY29udGFjdHMiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQodC+0LHQtdGB0LXQtNC90LjQutC4INC+0LbQuNC00LDRjtGJ0LjQtSDQsNCy0YLQvtGA0LjQt9Cw0YbQuNC4IgogICAgICBdLAogICAgICAiQ3VzdG9tIHN0YXR1cyI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCf0YDQvtC40LfQstC+0LvRjNC90YvQuSDRgdGC0LDRgtGD0YEiCiAgICAgIF0sCiAgICAgICJDbGljayB0byBjaGFuZ2UgeW91ciBjaGF0IHN0YXR1cyI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCY0LfQvNC10L3QuNGC0Ywg0LLQsNGIINGB0YLQsNGC0YPRgSIKICAgICAgXSwKICAgICAgIkNsaWNrIGhlcmUgdG8gd3JpdGUgYSBjdXN0b20gc3RhdHVzIG1lc3NhZ2UiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQoNC10LTQsNC60YLQuNGA0L7QstCw0YLRjCDQv9GA0L7QuNC30LLQvtC70YzQvdGL0Lkg0YHRgtCw0YLRg9GBIgogICAgICBdLAogICAgICAib25saW5lIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0L3QsCDRgdCy0Y/Qt9C4IgogICAgICBdLAogICAgICAiYnVzeSI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItC30LDQvdGP0YIiCiAgICAgIF0sCiAgICAgICJhd2F5IGZvciBsb25nIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0L7RgtC+0YjRkdC7INC90LAg0LTQvtC70LPQviIKICAgICAgXSwKICAgICAgImF3YXkiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQvtGC0L7RiNGR0LsiCiAgICAgIF0sCiAgICAgICJJIGFtICUxJHMiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICIlMSRzIgogICAgICBdLAogICAgICAiU2lnbiBpbiI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCf0L7QtNC/0LjRgdCw0YLRjCIKICAgICAgXSwKICAgICAgIlhNUFAvSmFiYmVyIFVzZXJuYW1lOiI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgIkpJRDoiCiAgICAgIF0sCiAgICAgICJQYXNzd29yZDoiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQn9Cw0YDQvtC70Yw6IgogICAgICBdLAogICAgICAiTG9nIEluIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0JLQvtC50YLQuCIKICAgICAgXSwKICAgICAgIk9ubGluZSBDb250YWN0cyI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgIkPQv9C40YHQvtC6INGB0L7QsdC10YHQtdC00L3QuNC60L7QsiIKICAgICAgXQogICB9Cn0KCgoKICAgIH07CiAgICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7CiAgICAgICAgZGVmaW5lKCJydSIsIFsnamVkJ10sIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkobmV3IEplZCh0cmFuc2xhdGlvbnMpKTsKICAgICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKCF3aW5kb3cubG9jYWxlcykgewogICAgICAgICAgICB3aW5kb3cubG9jYWxlcyA9IHt9OwogICAgICAgIH0KICAgICAgICB3aW5kb3cubG9jYWxlcy5ydSA9IGZhY3RvcnkobmV3IEplZCh0cmFuc2xhdGlvbnMpKTsKICAgIH0KfSh0aGlzLCBmdW5jdGlvbiAocnUpIHsKICAgIHJldHVybiBydTsKfSkpOwoKKGZ1bmN0aW9uIChyb290LCBmYWN0b3J5KSB7CiAgICB2YXIgdHJhbnNsYXRpb25zID0gewogICAgICAgICJkb21haW4iOiAiY29udmVyc2UiLAogICAgICAgICJsb2NhbGVfZGF0YSI6IHsKICAgICAgICAgICAgImNvbnZlcnNlIjogewogICAgICAgICAgICAgICAgIiI6IHsKICAgICAgICAgICAgICAgICAgICAiUHJvamVjdC1JZC1WZXJzaW9uIjogIkNvbnZlcnNlLmpzIDAuOCIsCiAgICAgICAgICAgICAgICAgICAgIlJlcG9ydC1Nc2dpZC1CdWdzLVRvIjogIiIsCiAgICAgICAgICAgICAgICAgICAgIlBPVC1DcmVhdGlvbi1EYXRlIjogIjIwMTQtMDEtMDcgMTE6MTIrMDkwMCIsCiAgICAgICAgICAgICAgICAgICAgIlBPLVJldmlzaW9uLURhdGUiOiAiMjAxNC0wMS0wNyAxMTozMiswOTAwIiwKICAgICAgICAgICAgICAgICAgICAiTGFzdC1UcmFuc2xhdG9yIjogIkh1eGlzdXogSHUgPGh1eGlzdXpAZ21haWwuY29tPiIsCiAgICAgICAgICAgICAgICAgICAgIkxhbmd1YWdlLVRlYW0iOiAiTGFuZ3VhZ2UgemgiLAogICAgICAgICAgICAgICAgICAgICJMYW5ndWFnZSI6ICJ6aCIsCiAgICAgICAgICAgICAgICAgICAgIk1JTUUtVmVyc2lvbiI6ICIxLjAiLAogICAgICAgICAgICAgICAgICAgICJDb250ZW50LVR5cGUiOiAidGV4dC9wbGFpbjsgY2hhcnNldD1VVEYtOCIsCiAgICAgICAgICAgICAgICAgICAgIkNvbnRlbnQtVHJhbnNmZXItRW5jb2RpbmciOiAiOGJpdCIsCiAgICAgICAgICAgICAgICAgICAgIlBsdXJhbC1Gb3JtcyI6ICJucGx1cmFscz0xOyBwbHVyYWw9MDsiCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgInVuZW5jcnlwdGVkIjogW251bGwsIuacquWKoOWvhiJdLAogICAgICAgICAgICAgICAgInVudmVyaWZpZWQiOiBbbnVsbCwi5pyq6aqM6K+BIl0sCiAgICAgICAgICAgICAgICAidmVyaWZpZWQiOiBbbnVsbCwi5bey6aqM6K+BIl0sCiAgICAgICAgICAgICAgICAiZmluaXNoZWQiOiBbbnVsbCwi57uT5p2f5LqGIl0sCiAgICAgICAgICAgICAgICAiVGhpcyBjb250YWN0IGlzIGJ1c3kiOiBbbnVsbCwi5a+55pa55b+Z56KM5LitIl0sCiAgICAgICAgICAgICAgICAiVGhpcyBjb250YWN0IGlzIG9ubGluZSI6IFtudWxsLCLlr7nmlrnlnKjnur/kuK0iXSwKICAgICAgICAgICAgICAgICJUaGlzIGNvbnRhY3QgaXMgb2ZmbGluZSI6IFtudWxsLCLlr7nmlrnlt7LkuIvnur8iXSwKICAgICAgICAgICAgICAgICJUaGlzIGNvbnRhY3QgaXMgdW5hdmFpbGFibGUiOiBbbnVsbCwi5a+55pa55YWN5omT5omwIl0sCiAgICAgICAgICAgICAgICAiVGhpcyBjb250YWN0IGlzIGF3YXkgZm9yIGFuIGV4dGVuZGVkIHBlcmlvZCI6IFtudWxsLCLlr7nmlrnmmoLml7bnprvlvIAiXSwKICAgICAgICAgICAgICAgICJUaGlzIGNvbnRhY3QgaXMgYXdheSI6IFtudWxsLCLlr7nmlrnnprvlvIAiXSwKICAgICAgICAgICAgICAgICJEaXNjb25uZWN0ZWQiOiBbbnVsbCwi6L+e5o6l5bey5pat5byAIl0sCiAgICAgICAgICAgICAgICAiRXJyb3IiOiBbbnVsbCwi6ZSZ6K+vIl0sCiAgICAgICAgICAgICAgICAiQ29ubmVjdGluZyI6IFtudWxsLCLov57mjqXkuK0iXSwKICAgICAgICAgICAgICAgICJDb25uZWN0aW9uIEZhaWxlZCI6IFtudWxsLCLov57mjqXlpLHotKUiXSwKICAgICAgICAgICAgICAgICJBdXRoZW50aWNhdGluZyI6IFtudWxsLCLpqozor4HkuK0iXSwKICAgICAgICAgICAgICAgICJBdXRoZW50aWNhdGlvbiBGYWlsZWQiOiBbbnVsbCwi6aqM6K+B5aSx6LSlIl0sCiAgICAgICAgICAgICAgICAiRGlzY29ubmVjdGluZyI6IFtudWxsLCLmlq3lvIDpk77mjqXkuK0iXSwKICAgICAgICAgICAgICAgICJPbmxpbmUgQ29udGFjdHMiOiBbbnVsbCwi5Zyo57q/5aW95Y+LIl0sCiAgICAgICAgICAgICAgICAiUmUtZXN0YWJsaXNoaW5nIGVuY3J5cHRlZCBzZXNzaW9uIjogW251bGwsIumHjeaWsOW7uueri+WKoOWvhuS8muivnSJdLAogICAgICAgICAgICAgICAgIkdlbmVyYXRpbmcgcHJpdmF0ZSBrZXkuIjogW251bGwsIuato+WcqOeUn+aIkOengemSpSJdLAogICAgICAgICAgICAgICAgIllvdXIgYnJvd3NlciBtaWdodCBiZWNvbWUgdW5yZXNwb25zaXZlLiI6IFtudWxsLCLmgqjnmoTmtY/op4jlmajlj6/og73kvJrmmoLml7bml6Dlk43lupQiXSwKICAgICAgICAgICAgICAgICJBdXRoZW50aWNhdGlvbiByZXF1ZXN0IGZyb20gJTEkc1xuXG5Zb3VyIGJ1ZGR5IGlzIGF0dGVtcHRpbmcgdG8gdmVyaWZ5IHlvdXIgaWRlbnRpdHksIGJ5IGFza2luZyB5b3UgdGhlIHF1ZXN0aW9uIGJlbG93LlxuXG4lMiRzIjogW251bGwsIuadpeiHqiUxJHPnmoTpqozor4Hor7fmsYIgXG5cbuWvueaWueato+WcqOivleWbvumqjOivgeaCqOeahOS/oeaBr++8jOivt+WbnuetlOWmguS4i+mXrumimO+8mlxuXG4lMiRzIl0sCiAgICAgICAgICAgICAgICAiQ291bGQgbm90IHZlcmlmeSB0aGlzIHVzZXIncyBpZGVudGlmeS4iOiBbbnVsbCwi5peg5rOV6aqM6K+B5a+55pa55L+h5oGv44CCIl0sCiAgICAgICAgICAgICAgICAiRXhjaGFuZ2luZyBwcml2YXRlIGtleSB3aXRoIGJ1ZGR5LiI6IFtudWxsLCLmraPlnKjkuI7lr7nmlrnkuqTmjaLnp4HpkqUiXSwKICAgICAgICAgICAgICAgICJQZXJzb25hbCBtZXNzYWdlIjogW251bGwsIuengeS/oSJdLAogICAgICAgICAgICAgICAgIm1lIjogW251bGwsIuaIkSJdLAogICAgICAgICAgICAgICAgIlNob3cgdGhpcyBtZW51IjogW251bGwsIuaYvuekuuatpOmhueiPnOWNlSJdLAogICAgICAgICAgICAgICAgIldyaXRlIGluIHRoZSB0aGlyZCBwZXJzb24iOiBbbnVsbCwi5Lul56ys5LiJ6ICF6Lqr5Lu95YaZIl0sCiAgICAgICAgICAgICAgICAiUmVtb3ZlIG1lc3NhZ2VzIjogW251bGwsIuenu+mZpOa2iOaBryJdLAogICAgICAgICAgICAgICAgIkFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBjbGVhciB0aGUgbWVzc2FnZXMgZnJvbSB0aGlzIGNoYXQgYm94PyI6IFtudWxsLCLkvaDnoa7lrprmuIXpmaTmraTmrKHnmoTogYrlpKnorrDlvZXlkJfvvJ8iXSwKICAgICAgICAgICAgICAgICJZb3VyIG1lc3NhZ2UgY291bGQgbm90IGJlIHNlbnQiOiBbbnVsbCwi5oKo55qE5raI5oGv5peg5rOV6YCB5Ye6Il0sCiAgICAgICAgICAgICAgICAiV2UgcmVjZWl2ZWQgYW4gdW5lbmNyeXB0ZWQgbWVzc2FnZSI6IFtudWxsLCLmiJHku6zmlLbliLDkuobkuIDmnaHmnKrliqDlr4bnmoTkv6Hmga8iXSwKICAgICAgICAgICAgICAgICJXZSByZWNlaXZlZCBhbiB1bnJlYWRhYmxlIGVuY3J5cHRlZCBtZXNzYWdlIjogW251bGwsIuaIkeS7rOaUtuWIsOS4gOadoeaXoOazleivu+WPlueahOS/oeaBryJdLAogICAgICAgICAgICAgICAgIlRoaXMgdXNlciBoYXMgcmVxdWVzdGVkIGFuIGVuY3J5cHRlZCBzZXNzaW9uLiI6IFtudWxsLCLmraTnlKjmiLfor7fmsYLkuobkuIDkuKrliqDlr4bkvJror53jgIIiXSwKICAgICAgICAgICAgICAgICJIZXJlIGFyZSB0aGUgZmluZ2VycHJpbnRzLCBwbGVhc2UgY29uZmlybSB0aGVtIHdpdGggJTEkcywgb3V0c2lkZSBvZiB0aGlzIGNoYXQuXG5cbkZpbmdlcnByaW50IGZvciB5b3UsICUyJHM6ICUzJHNcblxuRmluZ2VycHJpbnQgZm9yICUxJHM6ICU0JHNcblxuSWYgeW91IGhhdmUgY29uZmlybWVkIHRoYXQgdGhlIGZpbmdlcnByaW50cyBtYXRjaCwgY2xpY2sgT0ssIG90aGVyd2lzZSBjbGljayBDYW5jZWwuIjogW251bGwsIui/memHjOaYr+aMh+e6ueOAguivt+S4jiAlMSRzIOehruiupOOAglxuXG7mgqjnmoQgJTIkcyDmjIfnurk6ICUzJHNcblxuJTEkcyDnmoTmjIfnurk6ICU0JHNcblxu5aaC5p6c56Gu6K6k56ym5ZCI77yM6K+354K55Ye7T0vvvIzlkKbliJnngrnlh7vlj5bmtogiXSwKICAgICAgICAgICAgICAgICJXaGF0IGlzIHlvdXIgc2VjdXJpdHkgcXVlc3Rpb24/IjogW251bGwsIuaCqOeahOWuieWFqOmXrumimOaYrz8iXSwKICAgICAgICAgICAgICAgICJXaGF0IGlzIHRoZSBhbnN3ZXIgdG8gdGhlIHNlY3VyaXR5IHF1ZXN0aW9uPyI6IFtudWxsLCLmraTlronlhajpl67popjnmoTnrZTmoYjmmK8/Il0sCiAgICAgICAgICAgICAgICAiSW52YWxpZCBhdXRoZW50aWNhdGlvbiBzY2hlbWUgcHJvdmlkZWQiOiBbbnVsbCwi6Z2e5rOV55qE6K6k6K+B5pa55byPIl0sCiAgICAgICAgICAgICAgICAiWW91ciBtZXNzYWdlcyBhcmUgbm90IGVuY3J5cHRlZCBhbnltb3JlIjogW251bGwsIuaCqOeahOa2iOaBr+WwhuS4jeWGjeiiq+WKoOWvhiJdLAogICAgICAgICAgICAgICAgIllvdXIgbWVzc2FnZXMgYXJlIG5vdyBlbmNyeXB0ZWQgYnV0IHlvdXIgYnVkZHkncyBpZGVudGl0eSBoYXMgbm90IGJlZW4gdmVyaWZpZWQuIjogW251bGwsIuaCqOeahOa2iOaBr+eOsOW3suWKoOWvhu+8jOS9huaYr+WvueaWuei6q+S7veWwmuacqumqjOivgSJdLAogICAgICAgICAgICAgICAgIllvdXIgYnVkZHkncyBpZGVudGlmeSBoYXMgYmVlbiB2ZXJpZmllZC4iOiBbbnVsbCwi5a+55pa555qE6Lqr5Lu95bey6YCa6L+H6aqM6K+B44CCIl0sCiAgICAgICAgICAgICAgICAiWW91ciBidWRkeSBoYXMgZW5kZWQgZW5jcnlwdGlvbiBvbiB0aGVpciBlbmQsIHlvdSBzaG91bGQgZG8gdGhlIHNhbWUuIjogW251bGwsIuWvueaWueW3sue7k+adn+WKoOWvhu+8jOaCqOS5n+mcgOimgeWBmuWQjOagt+eahOaTjeS9nOOAgiJdLAogICAgICAgICAgICAgICAgIllvdXIgbWVzc2FnZXMgYXJlIG5vdCBlbmNyeXB0ZWQuIENsaWNrIGhlcmUgdG8gZW5hYmxlIE9UUiBlbmNyeXB0aW9uLiI6IFtudWxsLCLmgqjnmoTmtojmga/mnKrliqDlr4bjgILngrnlh7vov5nph4zmnaXlkK/nlKhPVFLliqDlr4YiXSwKICAgICAgICAgICAgICAgICJZb3VyIG1lc3NhZ2VzIGFyZSBlbmNyeXB0ZWQsIGJ1dCB5b3VyIGJ1ZGR5IGhhcyBub3QgYmVlbiB2ZXJpZmllZC4iOiBbbnVsbCwi5oKo55qE5raI5oGv5bey5Yqg5a+G77yM5L2G5a+55pa55pyq6YCa6L+H6aqM6K+BIl0sCiAgICAgICAgICAgICAgICAiWW91ciBtZXNzYWdlcyBhcmUgZW5jcnlwdGVkIGFuZCB5b3VyIGJ1ZGR5IHZlcmlmaWVkLiI6IFtudWxsLCLmgqjnmoTmtojmga/lt7LliqDlr4bvvIzlr7nmlrnlt7Lpqozor4HjgIIiXSwKICAgICAgICAgICAgICAgICJZb3VyIGJ1ZGR5IGhhcyBjbG9zZWQgdGhlaXIgZW5kIG9mIHRoZSBwcml2YXRlIHNlc3Npb24sIHlvdSBzaG91bGQgZG8gdGhlIHNhbWUiOiBbbnVsbCwi5a+55pa55bey5YWz6Zet56eB5pyJ5Lya6K+d77yM5oKo5Lmf5bqU6K+l5YWz6ZetIl0sCiAgICAgICAgICAgICAgICAiRW5kIGVuY3J5cHRlZCBjb252ZXJzYXRpb24iOiBbbnVsbCwi57uT5p2f5Yqg5a+G55qE5Lya6K+dIl0sCiAgICAgICAgICAgICAgICAiUmVmcmVzaCBlbmNyeXB0ZWQgY29udmVyc2F0aW9uIjogW251bGwsIuWIt+aWsOWKoOWvhueahOS8muivnSJdLAogICAgICAgICAgICAgICAgIlN0YXJ0IGVuY3J5cHRlZCBjb252ZXJzYXRpb24iOiBbbnVsbCwi5byA5aeL5Yqg5a+G55qE5Lya6K+dIl0sCiAgICAgICAgICAgICAgICAiVmVyaWZ5IHdpdGggZmluZ2VycHJpbnRzIjogW251bGwsIumqjOivgeaMh+e6uSJdLAogICAgICAgICAgICAgICAgIlZlcmlmeSB3aXRoIFNNUCI6IFtudWxsLCLpqozor4FTTVAiXSwKICAgICAgICAgICAgICAgICJXaGF0J3MgdGhpcz8iOiBbbnVsbCwi6L+Z5piv5LuA5LmIPyJdLAogICAgICAgICAgICAgICAgIk9ubGluZSI6IFtudWxsLCLlnKjnur8iXSwKICAgICAgICAgICAgICAgICJCdXN5IjogW251bGwsIuW/meeijOS4rSJdLAogICAgICAgICAgICAgICAgIkF3YXkiOiBbbnVsbCwi56a75byAIl0sCiAgICAgICAgICAgICAgICAiT2ZmbGluZSI6IFtudWxsLCLnprvnur8iXSwKICAgICAgICAgICAgICAgICJDb250YWN0cyI6IFtudWxsLCLogZTns7vkuroiXSwKICAgICAgICAgICAgICAgICJDb250YWN0IG5hbWUiOiBbbnVsbCwi6IGU57O75Lq65ZCN56ewIl0sCiAgICAgICAgICAgICAgICAiU2VhcmNoIjogW251bGwsIuaQnOe0oiJdLAogICAgICAgICAgICAgICAgIkNvbnRhY3QgdXNlcm5hbWUiOiBbbnVsbCwi6IGU57O75Lq65aeT5ZCNIl0sCiAgICAgICAgICAgICAgICAiQWRkIjogW251bGwsIua3u+WKoCJdLAogICAgICAgICAgICAgICAgIkNsaWNrIHRvIGFkZCBuZXcgY2hhdCBjb250YWN0cyI6IFtudWxsLCLngrnlh7vmt7vliqDmlrDogZTns7vkuroiXSwKICAgICAgICAgICAgICAgICJBZGQgYSBjb250YWN0IjogW251bGwsIua3u+WKoOiBlOezu+S6uiJdLAogICAgICAgICAgICAgICAgIk5vIHVzZXJzIGZvdW5kIjogW251bGwsIuacquaJvuWIsOeUqOaItyJdLAogICAgICAgICAgICAgICAgIkNsaWNrIHRvIGFkZCBhcyBhIGNoYXQgY29udGFjdCI6IFtudWxsLCLngrnlh7vmt7vliqDkuLrlpb3lj4siXSwKICAgICAgICAgICAgICAgICJSb29tIG5hbWUiOiBbbnVsbCwi6IGK5aSp5a6k5ZCN56ewIl0sCiAgICAgICAgICAgICAgICAiTmlja25hbWUiOiBbbnVsbCwi5pi156ewIl0sCiAgICAgICAgICAgICAgICAiU2VydmVyIjogW251bGwsIuacjeWKoeWZqCJdLAogICAgICAgICAgICAgICAgIkpvaW4iOiBbbnVsbCwi5Yqg5YWlIl0sCiAgICAgICAgICAgICAgICAiU2hvdyByb29tcyI6IFtudWxsLCLmmL7npLrmiYDmnInogYrlpKnlrqQiXSwKICAgICAgICAgICAgICAgICJSb29tcyI6IFtudWxsLCLogYrlpKnlrqQiXSwKICAgICAgICAgICAgICAgICJObyByb29tcyBvbiAlMSRzIjogW251bGwsIiUxJHMg5LiK5rKh5pyJ6IGK5aSp5a6kIl0sCiAgICAgICAgICAgICAgICAiUm9vbXMgb24gJTEkcyI6IFtudWxsLCIlMSRzIOS4iueahOiBiuWkqeWupCJdLAogICAgICAgICAgICAgICAgIkNsaWNrIHRvIG9wZW4gdGhpcyByb29tIjogW251bGwsIuaJk+W8gOiBiuWkqeWupCJdLAogICAgICAgICAgICAgICAgIlNob3cgbW9yZSBpbmZvcm1hdGlvbiBvbiB0aGlzIHJvb20iOiBbbnVsbCwi5pi+56S65qyh6IGK5aSp5a6k55qE5pu05aSa5L+h5oGvIl0sCiAgICAgICAgICAgICAgICAiRGVzY3JpcHRpb246IjogW251bGwsIuaPj+i/sDogIl0sCiAgICAgICAgICAgICAgICAiT2NjdXBhbnRzOiI6IFtudWxsLCLmiJDlkZg6Il0sCiAgICAgICAgICAgICAgICAiRmVhdHVyZXM6IjogW251bGwsIueJueaApzoiXSwKICAgICAgICAgICAgICAgICJSZXF1aXJlcyBhdXRoZW50aWNhdGlvbiI6IFtudWxsLCLpnIDopoHpqozor4EiXSwKICAgICAgICAgICAgICAgICJIaWRkZW4iOiBbbnVsbCwi6ZqQ6JeP55qEIl0sCiAgICAgICAgICAgICAgICAiUmVxdWlyZXMgYW4gaW52aXRhdGlvbiI6IFtudWxsLCLpnIDopoHooqvpgoDor7ciXSwKICAgICAgICAgICAgICAgICJNb2RlcmF0ZWQiOiBbbnVsbCwi5Y+R6KiA5Y+X6ZmQIl0sCiAgICAgICAgICAgICAgICAiTm9uLWFub255bW91cyI6IFtudWxsLCLpnZ7ljL/lkI0iXSwKICAgICAgICAgICAgICAgICJPcGVuIHJvb20iOiBbbnVsbCwi5omT5byA6IGK5aSp5a6kIl0sCiAgICAgICAgICAgICAgICAiUGVybWFuZW50IHJvb20iOiBbbnVsbCwi5rC45LmF6IGK5aSp5a6kIl0sCiAgICAgICAgICAgICAgICAiUHVibGljIjogW251bGwsIuWFrOW8gOeahCJdLAogICAgICAgICAgICAgICAgIlNlbWktYW5vbnltb3VzIjogW251bGwsIuWNiuWMv+WQjSJdLAogICAgICAgICAgICAgICAgIlRlbXBvcmFyeSByb29tIjogW251bGwsIuS4tOaXtuiBiuWkqeWupCJdLAogICAgICAgICAgICAgICAgIlVubW9kZXJhdGVkIjogW251bGwsIuaXoOWPkeiogOmZkOWItiJdLAogICAgICAgICAgICAgICAgIlNldCBjaGF0cm9vbSB0b3BpYyI6IFtudWxsLCLorr7nva7miL/pl7TkuLvpopgiXSwKICAgICAgICAgICAgICAgICJLaWNrIHVzZXIgZnJvbSBjaGF0cm9vbSI6IFtudWxsLCLmiornlKjmiLfouKLlh7rmiL/pl7QiXSwKICAgICAgICAgICAgICAgICJCYW4gdXNlciBmcm9tIGNoYXRyb29tIjogW251bGwsIumYu+atouatpOeUqOaIt+i/m+WFpeaIv+mXtCJdLAogICAgICAgICAgICAgICAgIk1lc3NhZ2UiOiBbbnVsbCwi5L+h5oGvIl0sCiAgICAgICAgICAgICAgICAiU2F2ZSI6IFtudWxsLCLkv53lrZgiXSwKICAgICAgICAgICAgICAgICJDYW5jZWwiOiBbbnVsbCwi5Y+W5raIIl0sCiAgICAgICAgICAgICAgICAiQW4gZXJyb3Igb2NjdXJyZWQgd2hpbGUgdHJ5aW5nIHRvIHNhdmUgdGhlIGZvcm0uIjogW251bGwsIuS/neWtmOihqOWNleaYr+WHuumUmeOAgiJdLAogICAgICAgICAgICAgICAgIlRoaXMgY2hhdHJvb20gcmVxdWlyZXMgYSBwYXNzd29yZCI6IFtudWxsLCLmraTogYrlpKnlrqTpnIDopoHlr4bnoIEiXSwKICAgICAgICAgICAgICAgICJQYXNzd29yZDogIjogW251bGwsIuWvhueggToiXSwKICAgICAgICAgICAgICAgICJTdWJtaXQiOiBbbnVsbCwi5Y+R6YCBIl0sCiAgICAgICAgICAgICAgICAiVGhpcyByb29tIGlzIG5vdCBhbm9ueW1vdXMiOiBbbnVsbCwi5q2k5Li66Z2e5Yy/5ZCN6IGK5aSp5a6kIl0sCiAgICAgICAgICAgICAgICAiVGhpcyByb29tIG5vdyBzaG93cyB1bmF2YWlsYWJsZSBtZW1iZXJzIjogW251bGwsIuatpOiBiuWkqeWupOaYvuekuuS4jeWPr+eUqOeUqOaItyJdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBkb2VzIG5vdCBzaG93IHVuYXZhaWxhYmxlIG1lbWJlcnMiOiBbbnVsbCwi5q2k6IGK5aSp5a6k5LiN5pi+56S65LiN5Y+v55So55So5oi3Il0sCiAgICAgICAgICAgICAgICAiTm9uLXByaXZhY3ktcmVsYXRlZCByb29tIGNvbmZpZ3VyYXRpb24gaGFzIGNoYW5nZWQiOiBbbnVsbCwi5q2k6IGK5aSp5a6k6K6+572uKOmdnuengeWvhuaApynlt7LmlLnlj5giXSwKICAgICAgICAgICAgICAgICJSb29tIGxvZ2dpbmcgaXMgbm93IGVuYWJsZWQiOiBbbnVsbCwi6IGK5aSp5a6k6IGK5aSp6K6w5b2V5bey5ZCv55SoIl0sCiAgICAgICAgICAgICAgICAiUm9vbSBsb2dnaW5nIGlzIG5vdyBkaXNhYmxlZCI6IFtudWxsLCLogYrlpKnlrqTogYrlpKnorrDlvZXlt7LnpoHnlKgiXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gaXMgbm93IG5vbi1hbm9ueW1vdXMiOiBbbnVsbCwi5q2k6IGK5aSp5a6k6Z2e5Yy/5ZCNIl0sCiAgICAgICAgICAgICAgICAiVGhpcyByb29tIGlzIG5vdyBzZW1pLWFub255bW91cyI6IFtudWxsLCLmraTogYrlpKnlrqTljYrljL/lkI0iXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gaXMgbm93IGZ1bGx5LWFub255bW91cyI6IFtudWxsLCLmraTogYrlpKnlrqTlrozlhajljL/lkI0iXSwKICAgICAgICAgICAgICAgICJBIG5ldyByb29tIGhhcyBiZWVuIGNyZWF0ZWQiOiBbbnVsbCwi5paw6IGK5aSp5a6k5bey5Yib5bu6Il0sCiAgICAgICAgICAgICAgICAiWW91ciBuaWNrbmFtZSBoYXMgYmVlbiBjaGFuZ2VkIjogW251bGwsIuaCqOeahOaYteensOiiq+abtOaUueS6hiJdLAogICAgICAgICAgICAgICAgIjxzdHJvbmc+JTEkczwvc3Ryb25nPiBoYXMgYmVlbiBiYW5uZWQiOiBbbnVsbCwiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IOW3suiiq+emgeatoiJdLAogICAgICAgICAgICAgICAgIjxzdHJvbmc+JTEkczwvc3Ryb25nPiBoYXMgYmVlbiBraWNrZWQgb3V0IjogW251bGwsIjxzdHJvbmc+JTEkczwvc3Ryb25nPiDlt7LooqvouKLlh7oiXSwKICAgICAgICAgICAgICAgICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gaGFzIGJlZW4gcmVtb3ZlZCBiZWNhdXNlIG9mIGFuIGFmZmlsaWF0aW9uIGNoYW5nZSI6IFtudWxsLCLnlLHkuo7lhbPns7vop6PpmaTjgIE8c3Ryb25nPiUxJHM8L3N0cm9uZz4g5bey6KKr56e76ZmkIl0sCiAgICAgICAgICAgICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IGhhcyBiZWVuIHJlbW92ZWQgZm9yIG5vdCBiZWluZyBhIG1lbWJlciI6IFtudWxsLCLnlLHkuo7kuI3mmK/miJDlkZjjgIE8c3Ryb25nPiUxJHM8L3N0cm9uZz4g5bey6KKr56e76ZmkIl0sCiAgICAgICAgICAgICAgICAiWW91IGhhdmUgYmVlbiBiYW5uZWQgZnJvbSB0aGlzIHJvb20iOiBbbnVsbCwi5oKo5bey6KKr5q2k6IGK5aSp5a6k56aB5q2i5YWl5YaFIl0sCiAgICAgICAgICAgICAgICAiWW91IGhhdmUgYmVlbiBraWNrZWQgZnJvbSB0aGlzIHJvb20iOiBbbnVsbCwi5oKo5bey6KKr6Lii5Ye65qyh5oi/6Ze0Il0sCiAgICAgICAgICAgICAgICAiWW91IGhhdmUgYmVlbiByZW1vdmVkIGZyb20gdGhpcyByb29tIGJlY2F1c2Ugb2YgYW4gYWZmaWxpYXRpb24gY2hhbmdlIjogW251bGwsIueUseS6juWFs+ezu+WPmOWMlu+8jOaCqOW3suiiq+enu+mZpOatpOaIv+mXtCJdLAogICAgICAgICAgICAgICAgIllvdSBoYXZlIGJlZW4gcmVtb3ZlZCBmcm9tIHRoaXMgcm9vbSBiZWNhdXNlIHRoZSByb29tIGhhcyBjaGFuZ2VkIHRvIG1lbWJlcnMtb25seSBhbmQgeW91J3JlIG5vdCBhIG1lbWJlciI6IFtudWxsLCLmgqjlt7Looqvnp7vpmaTmraTmiL/pl7Tlm6DkuLrmraTmiL/pl7Tmm7TmlLnkuLrlj6rlhYHorrjmiJDlkZjliqDlhaXvvIzogIzmgqjpnZ7miJDlkZgiXSwKICAgICAgICAgICAgICAgICJZb3UgaGF2ZSBiZWVuIHJlbW92ZWQgZnJvbSB0aGlzIHJvb20gYmVjYXVzZSB0aGUgTVVDIChNdWx0aS11c2VyIGNoYXQpIHNlcnZpY2UgaXMgYmVpbmcgc2h1dCBkb3duLiI6IFtudWxsLCLnlLHkuo7mnI3liqHkuI3lj6/nlKjvvIzmgqjlt7Looqvnp7vpmaTmraTmiL/pl7TjgIIiXSwKICAgICAgICAgICAgICAgICJZb3UgYXJlIG5vdCBvbiB0aGUgbWVtYmVyIGxpc3Qgb2YgdGhpcyByb29tIjogW251bGwsIuaCqOW5tumdnuatpOaIv+mXtOaIkOWRmCJdLAogICAgICAgICAgICAgICAgIk5vIG5pY2tuYW1lIHdhcyBzcGVjaWZpZWQiOiBbbnVsbCwi5pyq5oyH5a6a5pi156ewIl0sCiAgICAgICAgICAgICAgICAiWW91IGFyZSBub3QgYWxsb3dlZCB0byBjcmVhdGUgbmV3IHJvb21zIjogW251bGwsIuaCqOWPr+atpOWIm+W7uuaWsOaIv+mXtOS6hiJdLAogICAgICAgICAgICAgICAgIllvdXIgbmlja25hbWUgZG9lc24ndCBjb25mb3JtIHRvIHRoaXMgcm9vbSdzIHBvbGljaWVzIjogW251bGwsIuaCqOeahOaYteensOS4jeespuWQiOatpOaIv+mXtOagh+WHhiJdLAogICAgICAgICAgICAgICAgIllvdXIgbmlja25hbWUgaXMgYWxyZWFkeSB0YWtlbiI6IFtudWxsLCLmgqjnmoTmmLXnp7Dlt7LooqvljaDnlKgiXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gZG9lcyBub3QgKHlldCkgZXhpc3QiOiBbbnVsbCwi5q2k5oi/6Ze05LiN5a2Y5ZyoIl0sCiAgICAgICAgICAgICAgICAiVGhpcyByb29tIGhhcyByZWFjaGVkIGl0J3MgbWF4aW11bSBudW1iZXIgb2Ygb2NjdXBhbnRzIjogW251bGwsIuatpOaIv+mXtOS6uuaVsOW3sui+vuS4iue6vyJdLAogICAgICAgICAgICAgICAgIlRvcGljIHNldCBieSAlMSRzIHRvOiAlMiRzIjogW251bGwsIiUxJHMg6K6+572u6K+d6aKY5Li6OiAlMiRzIl0sCiAgICAgICAgICAgICAgICAiVGhpcyB1c2VyIGlzIGEgbW9kZXJhdG9yIjogW251bGwsIuatpOeUqOaIt+aYr+S4u+aMgeS6uiJdLAogICAgICAgICAgICAgICAgIlRoaXMgdXNlciBjYW4gc2VuZCBtZXNzYWdlcyBpbiB0aGlzIHJvb20iOiBbbnVsbCwi5q2k55So5oi35Zyo6L+Z5oi/6Ze06YeM5Y+v5Y+R5raI5oGvIl0sCiAgICAgICAgICAgICAgICAiVGhpcyB1c2VyIGNhbiBOT1Qgc2VuZCBtZXNzYWdlcyBpbiB0aGlzIHJvb20iOiBbbnVsbCwi5q2k55So5oi35LiN5Y+v5Zyo5q2k5oi/6Ze05Y+R5raI5oGvIl0sCiAgICAgICAgICAgICAgICAiTWluaW1pemVkIjogW251bGwsIuacgOWwj+WMlueahCJdLAogICAgICAgICAgICAgICAgIkNsaWNrIHRvIHJlbW92ZSB0aGlzIGNvbnRhY3QiOiBbbnVsbCwi54K55Ye756e76Zmk6IGU57O75Lq6Il0sCiAgICAgICAgICAgICAgICAiQWNjZXB0IjogW251bGwsIuaOpeWPlyJdLAogICAgICAgICAgICAgICAgIkNsaWNrIHRvIGNoYXQgd2l0aCB0aGlzIGNvbnRhY3QiOiBbbnVsbCwi54K55Ye75LiO5a+55pa55Lqk6LCIIl0sCiAgICAgICAgICAgICAgICAiTXkgY29udGFjdHMiOiBbbnVsbCwi5oiR55qE5aW95Y+L5YiX6KGoIl0sCiAgICAgICAgICAgICAgICAiQ29udGFjdCByZXF1ZXN0cyI6IFtudWxsLCLmnaXoh6rlpb3lj4vnmoTor7fmsYIiXSwKICAgICAgICAgICAgICAgICJQZW5kaW5nIGNvbnRhY3RzIjogW251bGwsIuS/neeVmeS4reeahOiBlOezu+S6uiJdLAogICAgICAgICAgICAgICAgIkN1c3RvbSBzdGF0dXMiOiBbbnVsbCwiRElZ54q25oCBIl0sCiAgICAgICAgICAgICAgICAib25saW5lIjogW251bGwsIuWcqOe6vyJdLAogICAgICAgICAgICAgICAgImJ1c3kiOiBbbnVsbCwi5b+Z56KMIl0sCiAgICAgICAgICAgICAgICAiYXdheSBmb3IgbG9uZyI6IFtudWxsLCLplb/ml7bpl7TnprvlvIAiXSwKICAgICAgICAgICAgICAgICJhd2F5IjogW251bGwsIuemu+W8gCJdLAogICAgICAgICAgICAgICAgIkkgYW0gJTEkcyI6IFtudWxsLCLmiJHnjrDlnKglMSRzIl0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgaGVyZSB0byB3cml0ZSBhIGN1c3RvbSBzdGF0dXMgbWVzc2FnZSI6IFtudWxsLCLngrnlh7vov5nph4zvvIzloavlhpnnirbmgIHkv6Hmga8iXSwKICAgICAgICAgICAgICAgICJDbGljayB0byBjaGFuZ2UgeW91ciBjaGF0IHN0YXR1cyI6IFtudWxsLCLngrnlh7vov5nph4zmlLnlj5jogYrlpKnnirbmgIEiXSwKICAgICAgICAgICAgICAgICJYTVBQL0phYmJlciBVc2VybmFtZToiOiBbbnVsbCwiWE1QUC9KYWJiZXLnlKjmiLflkI06Il0sCiAgICAgICAgICAgICAgICAiUGFzc3dvcmQ6IjogW251bGwsIuWvhueggToiXSwKICAgICAgICAgICAgICAgICJMb2cgSW4iOiBbbnVsbCwi55m75b2VIl0sCiAgICAgICAgICAgICAgICAiU2lnbiBpbiI6IFtudWxsLCLnmbvlvZUiXSwKICAgICAgICAgICAgICAgICJUb2dnbGUgY2hhdCI6IFtudWxsLCLmipjlj6DogYrlpKnnqpflj6MiXQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIGlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHsKICAgICAgICBkZWZpbmUoInpoIiwgWydqZWQnXSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gZmFjdG9yeShuZXcgSmVkKHRyYW5zbGF0aW9ucykpOwogICAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgICBpZiAoIXdpbmRvdy5sb2NhbGVzKSB7CiAgICAgICAgICAgIHdpbmRvdy5sb2NhbGVzID0ge307CiAgICAgICAgfQogICAgICAgIHdpbmRvdy5sb2NhbGVzLnpoID0gZmFjdG9yeShuZXcgSmVkKHRyYW5zbGF0aW9ucykpOwogICAgfQp9KHRoaXMsIGZ1bmN0aW9uICh6aCkgewogICAgcmV0dXJuIHpoOwp9KSk7CgovKgogKiBUaGlzIGZpbGUgc3BlY2lmaWVzIHRoZSBsYW5ndWFnZSBkZXBlbmRlbmNpZXMuCiAqCiAqIFRyYW5zbGF0aW9ucyB0YWtlIHVwIGEgbG90IG9mIHNwYWNlIGFuZCB5b3UgYXJlIHRoZXJlZm9yZSBhZHZpc2VkIHRvIHJlbW92ZQogKiBmcm9tIGhlcmUgYW55IGxhbmd1YWdlcyB0aGF0IHlvdSBkb24ndCBuZWVkLgogKi8KCihmdW5jdGlvbiAocm9vdCwgZmFjdG9yeSkgewogICAgZGVmaW5lKCJsb2NhbGVzIiwgWwogICAgICAgICdqZWQnLAogICAgICAgICdhZicsCiAgICAgICAgJ2RlJywKICAgICAgICAnZW4nLAogICAgICAgICdlcycsCiAgICAgICAgJ2ZyJywKICAgICAgICAnaGUnLAogICAgICAgICdodScsCiAgICAgICAgJ2lkJywKICAgICAgICAnaXQnLAogICAgICAgICdqYScsCiAgICAgICAgJ25sJywKICAgICAgICAncHRfQlInLAogICAgICAgICdydScsCiAgICAgICAgJ3poJwogICAgICAgIF0sIGZ1bmN0aW9uIChqZWQsIGFmLCBkZSwgZW4sIGVzLCBmciwgaGUsIGh1LCBpZCwgaXQsIGphLCBubCwgcHRfQlIsIHJ1LCB6aCkgewogICAgICAgICAgICByb290LmxvY2FsZXMgPSB7CiAgICAgICAgICAgICAgICAnYWYnOiBhZiwKICAgICAgICAgICAgICAgICdkZSc6IGRlLAogICAgICAgICAgICAgICAgJ2VuJzogZW4sCiAgICAgICAgICAgICAgICAnZXMnOiBlcywKICAgICAgICAgICAgICAgICdmcic6IGZyLAogICAgICAgICAgICAgICAgJ2hlJzogaGUsCiAgICAgICAgICAgICAgICAnaHUnOiBodSwKICAgICAgICAgICAgICAgICdpZCc6IGlkLAogICAgICAgICAgICAgICAgJ2l0JzogaXQsCiAgICAgICAgICAgICAgICAnamEnOiBqYSwKICAgICAgICAgICAgICAgICdubCc6IG5sLAogICAgICAgICAgICAgICAgJ3B0LWJyJzogcHRfQlIsCiAgICAgICAgICAgICAgICAncnUnOiBydSwKICAgICAgICAgICAgICAgICd6aCc6emgKICAgICAgICAgICAgfTsKICAgICAgICB9KTsKfSkodGhpcyk7CgovLyAgICAgVW5kZXJzY29yZS5qcyAxLjYuMAovLyAgICAgaHR0cDovL3VuZGVyc2NvcmVqcy5vcmcKLy8gICAgIChjKSAyMDA5LTIwMTQgSmVyZW15IEFzaGtlbmFzLCBEb2N1bWVudENsb3VkIGFuZCBJbnZlc3RpZ2F0aXZlIFJlcG9ydGVycyAmIEVkaXRvcnMKLy8gICAgIFVuZGVyc2NvcmUgbWF5IGJlIGZyZWVseSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UuCgooZnVuY3Rpb24oKSB7CgogIC8vIEJhc2VsaW5lIHNldHVwCiAgLy8gLS0tLS0tLS0tLS0tLS0KCiAgLy8gRXN0YWJsaXNoIHRoZSByb290IG9iamVjdCwgYHdpbmRvd2AgaW4gdGhlIGJyb3dzZXIsIG9yIGBleHBvcnRzYCBvbiB0aGUgc2VydmVyLgogIHZhciByb290ID0gdGhpczsKCiAgLy8gU2F2ZSB0aGUgcHJldmlvdXMgdmFsdWUgb2YgdGhlIGBfYCB2YXJpYWJsZS4KICB2YXIgcHJldmlvdXNVbmRlcnNjb3JlID0gcm9vdC5fOwoKICAvLyBFc3RhYmxpc2ggdGhlIG9iamVjdCB0aGF0IGdldHMgcmV0dXJuZWQgdG8gYnJlYWsgb3V0IG9mIGEgbG9vcCBpdGVyYXRpb24uCiAgdmFyIGJyZWFrZXIgPSB7fTsKCiAgLy8gU2F2ZSBieXRlcyBpbiB0aGUgbWluaWZpZWQgKGJ1dCBub3QgZ3ppcHBlZCkgdmVyc2lvbjoKICB2YXIgQXJyYXlQcm90byA9IEFycmF5LnByb3RvdHlwZSwgT2JqUHJvdG8gPSBPYmplY3QucHJvdG90eXBlLCBGdW5jUHJvdG8gPSBGdW5jdGlvbi5wcm90b3R5cGU7CgogIC8vIENyZWF0ZSBxdWljayByZWZlcmVuY2UgdmFyaWFibGVzIGZvciBzcGVlZCBhY2Nlc3MgdG8gY29yZSBwcm90b3R5cGVzLgogIHZhcgogICAgcHVzaCAgICAgICAgICAgICA9IEFycmF5UHJvdG8ucHVzaCwKICAgIHNsaWNlICAgICAgICAgICAgPSBBcnJheVByb3RvLnNsaWNlLAogICAgY29uY2F0ICAgICAgICAgICA9IEFycmF5UHJvdG8uY29uY2F0LAogICAgdG9TdHJpbmcgICAgICAgICA9IE9ialByb3RvLnRvU3RyaW5nLAogICAgaGFzT3duUHJvcGVydHkgICA9IE9ialByb3RvLmhhc093blByb3BlcnR5OwoKICAvLyBBbGwgKipFQ01BU2NyaXB0IDUqKiBuYXRpdmUgZnVuY3Rpb24gaW1wbGVtZW50YXRpb25zIHRoYXQgd2UgaG9wZSB0byB1c2UKICAvLyBhcmUgZGVjbGFyZWQgaGVyZS4KICB2YXIKICAgIG5hdGl2ZUZvckVhY2ggICAgICA9IEFycmF5UHJvdG8uZm9yRWFjaCwKICAgIG5hdGl2ZU1hcCAgICAgICAgICA9IEFycmF5UHJvdG8ubWFwLAogICAgbmF0aXZlUmVkdWNlICAgICAgID0gQXJyYXlQcm90by5yZWR1Y2UsCiAgICBuYXRpdmVSZWR1Y2VSaWdodCAgPSBBcnJheVByb3RvLnJlZHVjZVJpZ2h0LAogICAgbmF0aXZlRmlsdGVyICAgICAgID0gQXJyYXlQcm90by5maWx0ZXIsCiAgICBuYXRpdmVFdmVyeSAgICAgICAgPSBBcnJheVByb3RvLmV2ZXJ5LAogICAgbmF0aXZlU29tZSAgICAgICAgID0gQXJyYXlQcm90by5zb21lLAogICAgbmF0aXZlSW5kZXhPZiAgICAgID0gQXJyYXlQcm90by5pbmRleE9mLAogICAgbmF0aXZlTGFzdEluZGV4T2YgID0gQXJyYXlQcm90by5sYXN0SW5kZXhPZiwKICAgIG5hdGl2ZUlzQXJyYXkgICAgICA9IEFycmF5LmlzQXJyYXksCiAgICBuYXRpdmVLZXlzICAgICAgICAgPSBPYmplY3Qua2V5cywKICAgIG5hdGl2ZUJpbmQgICAgICAgICA9IEZ1bmNQcm90by5iaW5kOwoKICAvLyBDcmVhdGUgYSBzYWZlIHJlZmVyZW5jZSB0byB0aGUgVW5kZXJzY29yZSBvYmplY3QgZm9yIHVzZSBiZWxvdy4KICB2YXIgXyA9IGZ1bmN0aW9uKG9iaikgewogICAgaWYgKG9iaiBpbnN0YW5jZW9mIF8pIHJldHVybiBvYmo7CiAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgXykpIHJldHVybiBuZXcgXyhvYmopOwogICAgdGhpcy5fd3JhcHBlZCA9IG9iajsKICB9OwoKICAvLyBFeHBvcnQgdGhlIFVuZGVyc2NvcmUgb2JqZWN0IGZvciAqKk5vZGUuanMqKiwgd2l0aAogIC8vIGJhY2t3YXJkcy1jb21wYXRpYmlsaXR5IGZvciB0aGUgb2xkIGByZXF1aXJlKClgIEFQSS4gSWYgd2UncmUgaW4KICAvLyB0aGUgYnJvd3NlciwgYWRkIGBfYCBhcyBhIGdsb2JhbCBvYmplY3QgdmlhIGEgc3RyaW5nIGlkZW50aWZpZXIsCiAgLy8gZm9yIENsb3N1cmUgQ29tcGlsZXIgImFkdmFuY2VkIiBtb2RlLgogIGlmICh0eXBlb2YgZXhwb3J0cyAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgIGlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyAmJiBtb2R1bGUuZXhwb3J0cykgewogICAgICBleHBvcnRzID0gbW9kdWxlLmV4cG9ydHMgPSBfOwogICAgfQogICAgZXhwb3J0cy5fID0gXzsKICB9IGVsc2UgewogICAgcm9vdC5fID0gXzsKICB9CgogIC8vIEN1cnJlbnQgdmVyc2lvbi4KICBfLlZFUlNJT04gPSAnMS42LjAnOwoKICAvLyBDb2xsZWN0aW9uIEZ1bmN0aW9ucwogIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tCgogIC8vIFRoZSBjb3JuZXJzdG9uZSwgYW4gYGVhY2hgIGltcGxlbWVudGF0aW9uLCBha2EgYGZvckVhY2hgLgogIC8vIEhhbmRsZXMgb2JqZWN0cyB3aXRoIHRoZSBidWlsdC1pbiBgZm9yRWFjaGAsIGFycmF5cywgYW5kIHJhdyBvYmplY3RzLgogIC8vIERlbGVnYXRlcyB0byAqKkVDTUFTY3JpcHQgNSoqJ3MgbmF0aXZlIGBmb3JFYWNoYCBpZiBhdmFpbGFibGUuCiAgdmFyIGVhY2ggPSBfLmVhY2ggPSBfLmZvckVhY2ggPSBmdW5jdGlvbihvYmosIGl0ZXJhdG9yLCBjb250ZXh0KSB7CiAgICBpZiAob2JqID09IG51bGwpIHJldHVybiBvYmo7CiAgICBpZiAobmF0aXZlRm9yRWFjaCAmJiBvYmouZm9yRWFjaCA9PT0gbmF0aXZlRm9yRWFjaCkgewogICAgICBvYmouZm9yRWFjaChpdGVyYXRvciwgY29udGV4dCk7CiAgICB9IGVsc2UgaWYgKG9iai5sZW5ndGggPT09ICtvYmoubGVuZ3RoKSB7CiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBvYmoubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAoaXRlcmF0b3IuY2FsbChjb250ZXh0LCBvYmpbaV0sIGksIG9iaikgPT09IGJyZWFrZXIpIHJldHVybjsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgdmFyIGtleXMgPSBfLmtleXMob2JqKTsKICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IGtleXMubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAoaXRlcmF0b3IuY2FsbChjb250ZXh0LCBvYmpba2V5c1tpXV0sIGtleXNbaV0sIG9iaikgPT09IGJyZWFrZXIpIHJldHVybjsKICAgICAgfQogICAgfQogICAgcmV0dXJuIG9iajsKICB9OwoKICAvLyBSZXR1cm4gdGhlIHJlc3VsdHMgb2YgYXBwbHlpbmcgdGhlIGl0ZXJhdG9yIHRvIGVhY2ggZWxlbWVudC4KICAvLyBEZWxlZ2F0ZXMgdG8gKipFQ01BU2NyaXB0IDUqKidzIG5hdGl2ZSBgbWFwYCBpZiBhdmFpbGFibGUuCiAgXy5tYXAgPSBfLmNvbGxlY3QgPSBmdW5jdGlvbihvYmosIGl0ZXJhdG9yLCBjb250ZXh0KSB7CiAgICB2YXIgcmVzdWx0cyA9IFtdOwogICAgaWYgKG9iaiA9PSBudWxsKSByZXR1cm4gcmVzdWx0czsKICAgIGlmIChuYXRpdmVNYXAgJiYgb2JqLm1hcCA9PT0gbmF0aXZlTWFwKSByZXR1cm4gb2JqLm1hcChpdGVyYXRvciwgY29udGV4dCk7CiAgICBlYWNoKG9iaiwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBsaXN0KSB7CiAgICAgIHJlc3VsdHMucHVzaChpdGVyYXRvci5jYWxsKGNvbnRleHQsIHZhbHVlLCBpbmRleCwgbGlzdCkpOwogICAgfSk7CiAgICByZXR1cm4gcmVzdWx0czsKICB9OwoKICB2YXIgcmVkdWNlRXJyb3IgPSAnUmVkdWNlIG9mIGVtcHR5IGFycmF5IHdpdGggbm8gaW5pdGlhbCB2YWx1ZSc7CgogIC8vICoqUmVkdWNlKiogYnVpbGRzIHVwIGEgc2luZ2xlIHJlc3VsdCBmcm9tIGEgbGlzdCBvZiB2YWx1ZXMsIGFrYSBgaW5qZWN0YCwKICAvLyBvciBgZm9sZGxgLiBEZWxlZ2F0ZXMgdG8gKipFQ01BU2NyaXB0IDUqKidzIG5hdGl2ZSBgcmVkdWNlYCBpZiBhdmFpbGFibGUuCiAgXy5yZWR1Y2UgPSBfLmZvbGRsID0gXy5pbmplY3QgPSBmdW5jdGlvbihvYmosIGl0ZXJhdG9yLCBtZW1vLCBjb250ZXh0KSB7CiAgICB2YXIgaW5pdGlhbCA9IGFyZ3VtZW50cy5sZW5ndGggPiAyOwogICAgaWYgKG9iaiA9PSBudWxsKSBvYmogPSBbXTsKICAgIGlmIChuYXRpdmVSZWR1Y2UgJiYgb2JqLnJlZHVjZSA9PT0gbmF0aXZlUmVkdWNlKSB7CiAgICAgIGlmIChjb250ZXh0KSBpdGVyYXRvciA9IF8uYmluZChpdGVyYXRvciwgY29udGV4dCk7CiAgICAgIHJldHVybiBpbml0aWFsID8gb2JqLnJlZHVjZShpdGVyYXRvciwgbWVtbykgOiBvYmoucmVkdWNlKGl0ZXJhdG9yKTsKICAgIH0KICAgIGVhY2gob2JqLCBmdW5jdGlvbih2YWx1ZSwgaW5kZXgsIGxpc3QpIHsKICAgICAgaWYgKCFpbml0aWFsKSB7CiAgICAgICAgbWVtbyA9IHZhbHVlOwogICAgICAgIGluaXRpYWwgPSB0cnVlOwogICAgICB9IGVsc2UgewogICAgICAgIG1lbW8gPSBpdGVyYXRvci5jYWxsKGNvbnRleHQsIG1lbW8sIHZhbHVlLCBpbmRleCwgbGlzdCk7CiAgICAgIH0KICAgIH0pOwogICAgaWYgKCFpbml0aWFsKSB0aHJvdyBuZXcgVHlwZUVycm9yKHJlZHVjZUVycm9yKTsKICAgIHJldHVybiBtZW1vOwogIH07CgogIC8vIFRoZSByaWdodC1hc3NvY2lhdGl2ZSB2ZXJzaW9uIG9mIHJlZHVjZSwgYWxzbyBrbm93biBhcyBgZm9sZHJgLgogIC8vIERlbGVnYXRlcyB0byAqKkVDTUFTY3JpcHQgNSoqJ3MgbmF0aXZlIGByZWR1Y2VSaWdodGAgaWYgYXZhaWxhYmxlLgogIF8ucmVkdWNlUmlnaHQgPSBfLmZvbGRyID0gZnVuY3Rpb24ob2JqLCBpdGVyYXRvciwgbWVtbywgY29udGV4dCkgewogICAgdmFyIGluaXRpYWwgPSBhcmd1bWVudHMubGVuZ3RoID4gMjsKICAgIGlmIChvYmogPT0gbnVsbCkgb2JqID0gW107CiAgICBpZiAobmF0aXZlUmVkdWNlUmlnaHQgJiYgb2JqLnJlZHVjZVJpZ2h0ID09PSBuYXRpdmVSZWR1Y2VSaWdodCkgewogICAgICBpZiAoY29udGV4dCkgaXRlcmF0b3IgPSBfLmJpbmQoaXRlcmF0b3IsIGNvbnRleHQpOwogICAgICByZXR1cm4gaW5pdGlhbCA/IG9iai5yZWR1Y2VSaWdodChpdGVyYXRvciwgbWVtbykgOiBvYmoucmVkdWNlUmlnaHQoaXRlcmF0b3IpOwogICAgfQogICAgdmFyIGxlbmd0aCA9IG9iai5sZW5ndGg7CiAgICBpZiAobGVuZ3RoICE9PSArbGVuZ3RoKSB7CiAgICAgIHZhciBrZXlzID0gXy5rZXlzKG9iaik7CiAgICAgIGxlbmd0aCA9IGtleXMubGVuZ3RoOwogICAgfQogICAgZWFjaChvYmosIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCwgbGlzdCkgewogICAgICBpbmRleCA9IGtleXMgPyBrZXlzWy0tbGVuZ3RoXSA6IC0tbGVuZ3RoOwogICAgICBpZiAoIWluaXRpYWwpIHsKICAgICAgICBtZW1vID0gb2JqW2luZGV4XTsKICAgICAgICBpbml0aWFsID0gdHJ1ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBtZW1vID0gaXRlcmF0b3IuY2FsbChjb250ZXh0LCBtZW1vLCBvYmpbaW5kZXhdLCBpbmRleCwgbGlzdCk7CiAgICAgIH0KICAgIH0pOwogICAgaWYgKCFpbml0aWFsKSB0aHJvdyBuZXcgVHlwZUVycm9yKHJlZHVjZUVycm9yKTsKICAgIHJldHVybiBtZW1vOwogIH07CgogIC8vIFJldHVybiB0aGUgZmlyc3QgdmFsdWUgd2hpY2ggcGFzc2VzIGEgdHJ1dGggdGVzdC4gQWxpYXNlZCBhcyBgZGV0ZWN0YC4KICBfLmZpbmQgPSBfLmRldGVjdCA9IGZ1bmN0aW9uKG9iaiwgcHJlZGljYXRlLCBjb250ZXh0KSB7CiAgICB2YXIgcmVzdWx0OwogICAgYW55KG9iaiwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBsaXN0KSB7CiAgICAgIGlmIChwcmVkaWNhdGUuY2FsbChjb250ZXh0LCB2YWx1ZSwgaW5kZXgsIGxpc3QpKSB7CiAgICAgICAgcmVzdWx0ID0gdmFsdWU7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIHJlc3VsdDsKICB9OwoKICAvLyBSZXR1cm4gYWxsIHRoZSBlbGVtZW50cyB0aGF0IHBhc3MgYSB0cnV0aCB0ZXN0LgogIC8vIERlbGVnYXRlcyB0byAqKkVDTUFTY3JpcHQgNSoqJ3MgbmF0aXZlIGBmaWx0ZXJgIGlmIGF2YWlsYWJsZS4KICAvLyBBbGlhc2VkIGFzIGBzZWxlY3RgLgogIF8uZmlsdGVyID0gXy5zZWxlY3QgPSBmdW5jdGlvbihvYmosIHByZWRpY2F0ZSwgY29udGV4dCkgewogICAgdmFyIHJlc3VsdHMgPSBbXTsKICAgIGlmIChvYmogPT0gbnVsbCkgcmV0dXJuIHJlc3VsdHM7CiAgICBpZiAobmF0aXZlRmlsdGVyICYmIG9iai5maWx0ZXIgPT09IG5hdGl2ZUZpbHRlcikgcmV0dXJuIG9iai5maWx0ZXIocHJlZGljYXRlLCBjb250ZXh0KTsKICAgIGVhY2gob2JqLCBmdW5jdGlvbih2YWx1ZSwgaW5kZXgsIGxpc3QpIHsKICAgICAgaWYgKHByZWRpY2F0ZS5jYWxsKGNvbnRleHQsIHZhbHVlLCBpbmRleCwgbGlzdCkpIHJlc3VsdHMucHVzaCh2YWx1ZSk7CiAgICB9KTsKICAgIHJldHVybiByZXN1bHRzOwogIH07CgogIC8vIFJldHVybiBhbGwgdGhlIGVsZW1lbnRzIGZvciB3aGljaCBhIHRydXRoIHRlc3QgZmFpbHMuCiAgXy5yZWplY3QgPSBmdW5jdGlvbihvYmosIHByZWRpY2F0ZSwgY29udGV4dCkgewogICAgcmV0dXJuIF8uZmlsdGVyKG9iaiwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBsaXN0KSB7CiAgICAgIHJldHVybiAhcHJlZGljYXRlLmNhbGwoY29udGV4dCwgdmFsdWUsIGluZGV4LCBsaXN0KTsKICAgIH0sIGNvbnRleHQpOwogIH07CgogIC8vIERldGVybWluZSB3aGV0aGVyIGFsbCBvZiB0aGUgZWxlbWVudHMgbWF0Y2ggYSB0cnV0aCB0ZXN0LgogIC8vIERlbGVnYXRlcyB0byAqKkVDTUFTY3JpcHQgNSoqJ3MgbmF0aXZlIGBldmVyeWAgaWYgYXZhaWxhYmxlLgogIC8vIEFsaWFzZWQgYXMgYGFsbGAuCiAgXy5ldmVyeSA9IF8uYWxsID0gZnVuY3Rpb24ob2JqLCBwcmVkaWNhdGUsIGNvbnRleHQpIHsKICAgIHByZWRpY2F0ZSB8fCAocHJlZGljYXRlID0gXy5pZGVudGl0eSk7CiAgICB2YXIgcmVzdWx0ID0gdHJ1ZTsKICAgIGlmIChvYmogPT0gbnVsbCkgcmV0dXJuIHJlc3VsdDsKICAgIGlmIChuYXRpdmVFdmVyeSAmJiBvYmouZXZlcnkgPT09IG5hdGl2ZUV2ZXJ5KSByZXR1cm4gb2JqLmV2ZXJ5KHByZWRpY2F0ZSwgY29udGV4dCk7CiAgICBlYWNoKG9iaiwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBsaXN0KSB7CiAgICAgIGlmICghKHJlc3VsdCA9IHJlc3VsdCAmJiBwcmVkaWNhdGUuY2FsbChjb250ZXh0LCB2YWx1ZSwgaW5kZXgsIGxpc3QpKSkgcmV0dXJuIGJyZWFrZXI7CiAgICB9KTsKICAgIHJldHVybiAhIXJlc3VsdDsKICB9OwoKICAvLyBEZXRlcm1pbmUgaWYgYXQgbGVhc3Qgb25lIGVsZW1lbnQgaW4gdGhlIG9iamVjdCBtYXRjaGVzIGEgdHJ1dGggdGVzdC4KICAvLyBEZWxlZ2F0ZXMgdG8gKipFQ01BU2NyaXB0IDUqKidzIG5hdGl2ZSBgc29tZWAgaWYgYXZhaWxhYmxlLgogIC8vIEFsaWFzZWQgYXMgYGFueWAuCiAgdmFyIGFueSA9IF8uc29tZSA9IF8uYW55ID0gZnVuY3Rpb24ob2JqLCBwcmVkaWNhdGUsIGNvbnRleHQpIHsKICAgIHByZWRpY2F0ZSB8fCAocHJlZGljYXRlID0gXy5pZGVudGl0eSk7CiAgICB2YXIgcmVzdWx0ID0gZmFsc2U7CiAgICBpZiAob2JqID09IG51bGwpIHJldHVybiByZXN1bHQ7CiAgICBpZiAobmF0aXZlU29tZSAmJiBvYmouc29tZSA9PT0gbmF0aXZlU29tZSkgcmV0dXJuIG9iai5zb21lKHByZWRpY2F0ZSwgY29udGV4dCk7CiAgICBlYWNoKG9iaiwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBsaXN0KSB7CiAgICAgIGlmIChyZXN1bHQgfHwgKHJlc3VsdCA9IHByZWRpY2F0ZS5jYWxsKGNvbnRleHQsIHZhbHVlLCBpbmRleCwgbGlzdCkpKSByZXR1cm4gYnJlYWtlcjsKICAgIH0pOwogICAgcmV0dXJuICEhcmVzdWx0OwogIH07CgogIC8vIERldGVybWluZSBpZiB0aGUgYXJyYXkgb3Igb2JqZWN0IGNvbnRhaW5zIGEgZ2l2ZW4gdmFsdWUgKHVzaW5nIGA9PT1gKS4KICAvLyBBbGlhc2VkIGFzIGBpbmNsdWRlYC4KICBfLmNvbnRhaW5zID0gXy5pbmNsdWRlID0gZnVuY3Rpb24ob2JqLCB0YXJnZXQpIHsKICAgIGlmIChvYmogPT0gbnVsbCkgcmV0dXJuIGZhbHNlOwogICAgaWYgKG5hdGl2ZUluZGV4T2YgJiYgb2JqLmluZGV4T2YgPT09IG5hdGl2ZUluZGV4T2YpIHJldHVybiBvYmouaW5kZXhPZih0YXJnZXQpICE9IC0xOwogICAgcmV0dXJuIGFueShvYmosIGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgIHJldHVybiB2YWx1ZSA9PT0gdGFyZ2V0OwogICAgfSk7CiAgfTsKCiAgLy8gSW52b2tlIGEgbWV0aG9kICh3aXRoIGFyZ3VtZW50cykgb24gZXZlcnkgaXRlbSBpbiBhIGNvbGxlY3Rpb24uCiAgXy5pbnZva2UgPSBmdW5jdGlvbihvYmosIG1ldGhvZCkgewogICAgdmFyIGFyZ3MgPSBzbGljZS5jYWxsKGFyZ3VtZW50cywgMik7CiAgICB2YXIgaXNGdW5jID0gXy5pc0Z1bmN0aW9uKG1ldGhvZCk7CiAgICByZXR1cm4gXy5tYXAob2JqLCBmdW5jdGlvbih2YWx1ZSkgewogICAgICByZXR1cm4gKGlzRnVuYyA/IG1ldGhvZCA6IHZhbHVlW21ldGhvZF0pLmFwcGx5KHZhbHVlLCBhcmdzKTsKICAgIH0pOwogIH07CgogIC8vIENvbnZlbmllbmNlIHZlcnNpb24gb2YgYSBjb21tb24gdXNlIGNhc2Ugb2YgYG1hcGA6IGZldGNoaW5nIGEgcHJvcGVydHkuCiAgXy5wbHVjayA9IGZ1bmN0aW9uKG9iaiwga2V5KSB7CiAgICByZXR1cm4gXy5tYXAob2JqLCBfLnByb3BlcnR5KGtleSkpOwogIH07CgogIC8vIENvbnZlbmllbmNlIHZlcnNpb24gb2YgYSBjb21tb24gdXNlIGNhc2Ugb2YgYGZpbHRlcmA6IHNlbGVjdGluZyBvbmx5IG9iamVjdHMKICAvLyBjb250YWluaW5nIHNwZWNpZmljIGBrZXk6dmFsdWVgIHBhaXJzLgogIF8ud2hlcmUgPSBmdW5jdGlvbihvYmosIGF0dHJzKSB7CiAgICByZXR1cm4gXy5maWx0ZXIob2JqLCBfLm1hdGNoZXMoYXR0cnMpKTsKICB9OwoKICAvLyBDb252ZW5pZW5jZSB2ZXJzaW9uIG9mIGEgY29tbW9uIHVzZSBjYXNlIG9mIGBmaW5kYDogZ2V0dGluZyB0aGUgZmlyc3Qgb2JqZWN0CiAgLy8gY29udGFpbmluZyBzcGVjaWZpYyBga2V5OnZhbHVlYCBwYWlycy4KICBfLmZpbmRXaGVyZSA9IGZ1bmN0aW9uKG9iaiwgYXR0cnMpIHsKICAgIHJldHVybiBfLmZpbmQob2JqLCBfLm1hdGNoZXMoYXR0cnMpKTsKICB9OwoKICAvLyBSZXR1cm4gdGhlIG1heGltdW0gZWxlbWVudCBvciAoZWxlbWVudC1iYXNlZCBjb21wdXRhdGlvbikuCiAgLy8gQ2FuJ3Qgb3B0aW1pemUgYXJyYXlzIG9mIGludGVnZXJzIGxvbmdlciB0aGFuIDY1LDUzNSBlbGVtZW50cy4KICAvLyBTZWUgW1dlYktpdCBCdWcgODA3OTddKGh0dHBzOi8vYnVncy53ZWJraXQub3JnL3Nob3dfYnVnLmNnaT9pZD04MDc5NykKICBfLm1heCA9IGZ1bmN0aW9uKG9iaiwgaXRlcmF0b3IsIGNvbnRleHQpIHsKICAgIGlmICghaXRlcmF0b3IgJiYgXy5pc0FycmF5KG9iaikgJiYgb2JqWzBdID09PSArb2JqWzBdICYmIG9iai5sZW5ndGggPCA2NTUzNSkgewogICAgICByZXR1cm4gTWF0aC5tYXguYXBwbHkoTWF0aCwgb2JqKTsKICAgIH0KICAgIHZhciByZXN1bHQgPSAtSW5maW5pdHksIGxhc3RDb21wdXRlZCA9IC1JbmZpbml0eTsKICAgIGVhY2gob2JqLCBmdW5jdGlvbih2YWx1ZSwgaW5kZXgsIGxpc3QpIHsKICAgICAgdmFyIGNvbXB1dGVkID0gaXRlcmF0b3IgPyBpdGVyYXRvci5jYWxsKGNvbnRleHQsIHZhbHVlLCBpbmRleCwgbGlzdCkgOiB2YWx1ZTsKICAgICAgaWYgKGNvbXB1dGVkID4gbGFzdENvbXB1dGVkKSB7CiAgICAgICAgcmVzdWx0ID0gdmFsdWU7CiAgICAgICAgbGFzdENvbXB1dGVkID0gY29tcHV0ZWQ7CiAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIHJlc3VsdDsKICB9OwoKICAvLyBSZXR1cm4gdGhlIG1pbmltdW0gZWxlbWVudCAob3IgZWxlbWVudC1iYXNlZCBjb21wdXRhdGlvbikuCiAgXy5taW4gPSBmdW5jdGlvbihvYmosIGl0ZXJhdG9yLCBjb250ZXh0KSB7CiAgICBpZiAoIWl0ZXJhdG9yICYmIF8uaXNBcnJheShvYmopICYmIG9ialswXSA9PT0gK29ialswXSAmJiBvYmoubGVuZ3RoIDwgNjU1MzUpIHsKICAgICAgcmV0dXJuIE1hdGgubWluLmFwcGx5KE1hdGgsIG9iaik7CiAgICB9CiAgICB2YXIgcmVzdWx0ID0gSW5maW5pdHksIGxhc3RDb21wdXRlZCA9IEluZmluaXR5OwogICAgZWFjaChvYmosIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCwgbGlzdCkgewogICAgICB2YXIgY29tcHV0ZWQgPSBpdGVyYXRvciA/IGl0ZXJhdG9yLmNhbGwoY29udGV4dCwgdmFsdWUsIGluZGV4LCBsaXN0KSA6IHZhbHVlOwogICAgICBpZiAoY29tcHV0ZWQgPCBsYXN0Q29tcHV0ZWQpIHsKICAgICAgICByZXN1bHQgPSB2YWx1ZTsKICAgICAgICBsYXN0Q29tcHV0ZWQgPSBjb21wdXRlZDsKICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gcmVzdWx0OwogIH07CgogIC8vIFNodWZmbGUgYW4gYXJyYXksIHVzaW5nIHRoZSBtb2Rlcm4gdmVyc2lvbiBvZiB0aGUKICAvLyBbRmlzaGVyLVlhdGVzIHNodWZmbGVdKGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvRmlzaGVy4oCTWWF0ZXNfc2h1ZmZsZSkuCiAgXy5zaHVmZmxlID0gZnVuY3Rpb24ob2JqKSB7CiAgICB2YXIgcmFuZDsKICAgIHZhciBpbmRleCA9IDA7CiAgICB2YXIgc2h1ZmZsZWQgPSBbXTsKICAgIGVhY2gob2JqLCBmdW5jdGlvbih2YWx1ZSkgewogICAgICByYW5kID0gXy5yYW5kb20oaW5kZXgrKyk7CiAgICAgIHNodWZmbGVkW2luZGV4IC0gMV0gPSBzaHVmZmxlZFtyYW5kXTsKICAgICAgc2h1ZmZsZWRbcmFuZF0gPSB2YWx1ZTsKICAgIH0pOwogICAgcmV0dXJuIHNodWZmbGVkOwogIH07CgogIC8vIFNhbXBsZSAqKm4qKiByYW5kb20gdmFsdWVzIGZyb20gYSBjb2xsZWN0aW9uLgogIC8vIElmICoqbioqIGlzIG5vdCBzcGVjaWZpZWQsIHJldHVybnMgYSBzaW5nbGUgcmFuZG9tIGVsZW1lbnQuCiAgLy8gVGhlIGludGVybmFsIGBndWFyZGAgYXJndW1lbnQgYWxsb3dzIGl0IHRvIHdvcmsgd2l0aCBgbWFwYC4KICBfLnNhbXBsZSA9IGZ1bmN0aW9uKG9iaiwgbiwgZ3VhcmQpIHsKICAgIGlmIChuID09IG51bGwgfHwgZ3VhcmQpIHsKICAgICAgaWYgKG9iai5sZW5ndGggIT09ICtvYmoubGVuZ3RoKSBvYmogPSBfLnZhbHVlcyhvYmopOwogICAgICByZXR1cm4gb2JqW18ucmFuZG9tKG9iai5sZW5ndGggLSAxKV07CiAgICB9CiAgICByZXR1cm4gXy5zaHVmZmxlKG9iaikuc2xpY2UoMCwgTWF0aC5tYXgoMCwgbikpOwogIH07CgogIC8vIEFuIGludGVybmFsIGZ1bmN0aW9uIHRvIGdlbmVyYXRlIGxvb2t1cCBpdGVyYXRvcnMuCiAgdmFyIGxvb2t1cEl0ZXJhdG9yID0gZnVuY3Rpb24odmFsdWUpIHsKICAgIGlmICh2YWx1ZSA9PSBudWxsKSByZXR1cm4gXy5pZGVudGl0eTsKICAgIGlmIChfLmlzRnVuY3Rpb24odmFsdWUpKSByZXR1cm4gdmFsdWU7CiAgICByZXR1cm4gXy5wcm9wZXJ0eSh2YWx1ZSk7CiAgfTsKCiAgLy8gU29ydCB0aGUgb2JqZWN0J3MgdmFsdWVzIGJ5IGEgY3JpdGVyaW9uIHByb2R1Y2VkIGJ5IGFuIGl0ZXJhdG9yLgogIF8uc29ydEJ5ID0gZnVuY3Rpb24ob2JqLCBpdGVyYXRvciwgY29udGV4dCkgewogICAgaXRlcmF0b3IgPSBsb29rdXBJdGVyYXRvcihpdGVyYXRvcik7CiAgICByZXR1cm4gXy5wbHVjayhfLm1hcChvYmosIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCwgbGlzdCkgewogICAgICByZXR1cm4gewogICAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgICBpbmRleDogaW5kZXgsCiAgICAgICAgY3JpdGVyaWE6IGl0ZXJhdG9yLmNhbGwoY29udGV4dCwgdmFsdWUsIGluZGV4LCBsaXN0KQogICAgICB9OwogICAgfSkuc29ydChmdW5jdGlvbihsZWZ0LCByaWdodCkgewogICAgICB2YXIgYSA9IGxlZnQuY3JpdGVyaWE7CiAgICAgIHZhciBiID0gcmlnaHQuY3JpdGVyaWE7CiAgICAgIGlmIChhICE9PSBiKSB7CiAgICAgICAgaWYgKGEgPiBiIHx8IGEgPT09IHZvaWQgMCkgcmV0dXJuIDE7CiAgICAgICAgaWYgKGEgPCBiIHx8IGIgPT09IHZvaWQgMCkgcmV0dXJuIC0xOwogICAgICB9CiAgICAgIHJldHVybiBsZWZ0LmluZGV4IC0gcmlnaHQuaW5kZXg7CiAgICB9KSwgJ3ZhbHVlJyk7CiAgfTsKCiAgLy8gQW4gaW50ZXJuYWwgZnVuY3Rpb24gdXNlZCBmb3IgYWdncmVnYXRlICJncm91cCBieSIgb3BlcmF0aW9ucy4KICB2YXIgZ3JvdXAgPSBmdW5jdGlvbihiZWhhdmlvcikgewogICAgcmV0dXJuIGZ1bmN0aW9uKG9iaiwgaXRlcmF0b3IsIGNvbnRleHQpIHsKICAgICAgdmFyIHJlc3VsdCA9IHt9OwogICAgICBpdGVyYXRvciA9IGxvb2t1cEl0ZXJhdG9yKGl0ZXJhdG9yKTsKICAgICAgZWFjaChvYmosIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCkgewogICAgICAgIHZhciBrZXkgPSBpdGVyYXRvci5jYWxsKGNvbnRleHQsIHZhbHVlLCBpbmRleCwgb2JqKTsKICAgICAgICBiZWhhdmlvcihyZXN1bHQsIGtleSwgdmFsdWUpOwogICAgICB9KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH07CiAgfTsKCiAgLy8gR3JvdXBzIHRoZSBvYmplY3QncyB2YWx1ZXMgYnkgYSBjcml0ZXJpb24uIFBhc3MgZWl0aGVyIGEgc3RyaW5nIGF0dHJpYnV0ZQogIC8vIHRvIGdyb3VwIGJ5LCBvciBhIGZ1bmN0aW9uIHRoYXQgcmV0dXJucyB0aGUgY3JpdGVyaW9uLgogIF8uZ3JvdXBCeSA9IGdyb3VwKGZ1bmN0aW9uKHJlc3VsdCwga2V5LCB2YWx1ZSkgewogICAgXy5oYXMocmVzdWx0LCBrZXkpID8gcmVzdWx0W2tleV0ucHVzaCh2YWx1ZSkgOiByZXN1bHRba2V5XSA9IFt2YWx1ZV07CiAgfSk7CgogIC8vIEluZGV4ZXMgdGhlIG9iamVjdCdzIHZhbHVlcyBieSBhIGNyaXRlcmlvbiwgc2ltaWxhciB0byBgZ3JvdXBCeWAsIGJ1dCBmb3IKICAvLyB3aGVuIHlvdSBrbm93IHRoYXQgeW91ciBpbmRleCB2YWx1ZXMgd2lsbCBiZSB1bmlxdWUuCiAgXy5pbmRleEJ5ID0gZ3JvdXAoZnVuY3Rpb24ocmVzdWx0LCBrZXksIHZhbHVlKSB7CiAgICByZXN1bHRba2V5XSA9IHZhbHVlOwogIH0pOwoKICAvLyBDb3VudHMgaW5zdGFuY2VzIG9mIGFuIG9iamVjdCB0aGF0IGdyb3VwIGJ5IGEgY2VydGFpbiBjcml0ZXJpb24uIFBhc3MKICAvLyBlaXRoZXIgYSBzdHJpbmcgYXR0cmlidXRlIHRvIGNvdW50IGJ5LCBvciBhIGZ1bmN0aW9uIHRoYXQgcmV0dXJucyB0aGUKICAvLyBjcml0ZXJpb24uCiAgXy5jb3VudEJ5ID0gZ3JvdXAoZnVuY3Rpb24ocmVzdWx0LCBrZXkpIHsKICAgIF8uaGFzKHJlc3VsdCwga2V5KSA/IHJlc3VsdFtrZXldKysgOiByZXN1bHRba2V5XSA9IDE7CiAgfSk7CgogIC8vIFVzZSBhIGNvbXBhcmF0b3IgZnVuY3Rpb24gdG8gZmlndXJlIG91dCB0aGUgc21hbGxlc3QgaW5kZXggYXQgd2hpY2gKICAvLyBhbiBvYmplY3Qgc2hvdWxkIGJlIGluc2VydGVkIHNvIGFzIHRvIG1haW50YWluIG9yZGVyLiBVc2VzIGJpbmFyeSBzZWFyY2guCiAgXy5zb3J0ZWRJbmRleCA9IGZ1bmN0aW9uKGFycmF5LCBvYmosIGl0ZXJhdG9yLCBjb250ZXh0KSB7CiAgICBpdGVyYXRvciA9IGxvb2t1cEl0ZXJhdG9yKGl0ZXJhdG9yKTsKICAgIHZhciB2YWx1ZSA9IGl0ZXJhdG9yLmNhbGwoY29udGV4dCwgb2JqKTsKICAgIHZhciBsb3cgPSAwLCBoaWdoID0gYXJyYXkubGVuZ3RoOwogICAgd2hpbGUgKGxvdyA8IGhpZ2gpIHsKICAgICAgdmFyIG1pZCA9IChsb3cgKyBoaWdoKSA+Pj4gMTsKICAgICAgaXRlcmF0b3IuY2FsbChjb250ZXh0LCBhcnJheVttaWRdKSA8IHZhbHVlID8gbG93ID0gbWlkICsgMSA6IGhpZ2ggPSBtaWQ7CiAgICB9CiAgICByZXR1cm4gbG93OwogIH07CgogIC8vIFNhZmVseSBjcmVhdGUgYSByZWFsLCBsaXZlIGFycmF5IGZyb20gYW55dGhpbmcgaXRlcmFibGUuCiAgXy50b0FycmF5ID0gZnVuY3Rpb24ob2JqKSB7CiAgICBpZiAoIW9iaikgcmV0dXJuIFtdOwogICAgaWYgKF8uaXNBcnJheShvYmopKSByZXR1cm4gc2xpY2UuY2FsbChvYmopOwogICAgaWYgKG9iai5sZW5ndGggPT09ICtvYmoubGVuZ3RoKSByZXR1cm4gXy5tYXAob2JqLCBfLmlkZW50aXR5KTsKICAgIHJldHVybiBfLnZhbHVlcyhvYmopOwogIH07CgogIC8vIFJldHVybiB0aGUgbnVtYmVyIG9mIGVsZW1lbnRzIGluIGFuIG9iamVjdC4KICBfLnNpemUgPSBmdW5jdGlvbihvYmopIHsKICAgIGlmIChvYmogPT0gbnVsbCkgcmV0dXJuIDA7CiAgICByZXR1cm4gKG9iai5sZW5ndGggPT09ICtvYmoubGVuZ3RoKSA/IG9iai5sZW5ndGggOiBfLmtleXMob2JqKS5sZW5ndGg7CiAgfTsKCiAgLy8gQXJyYXkgRnVuY3Rpb25zCiAgLy8gLS0tLS0tLS0tLS0tLS0tCgogIC8vIEdldCB0aGUgZmlyc3QgZWxlbWVudCBvZiBhbiBhcnJheS4gUGFzc2luZyAqKm4qKiB3aWxsIHJldHVybiB0aGUgZmlyc3QgTgogIC8vIHZhbHVlcyBpbiB0aGUgYXJyYXkuIEFsaWFzZWQgYXMgYGhlYWRgIGFuZCBgdGFrZWAuIFRoZSAqKmd1YXJkKiogY2hlY2sKICAvLyBhbGxvd3MgaXQgdG8gd29yayB3aXRoIGBfLm1hcGAuCiAgXy5maXJzdCA9IF8uaGVhZCA9IF8udGFrZSA9IGZ1bmN0aW9uKGFycmF5LCBuLCBndWFyZCkgewogICAgaWYgKGFycmF5ID09IG51bGwpIHJldHVybiB2b2lkIDA7CiAgICBpZiAoKG4gPT0gbnVsbCkgfHwgZ3VhcmQpIHJldHVybiBhcnJheVswXTsKICAgIGlmIChuIDwgMCkgcmV0dXJuIFtdOwogICAgcmV0dXJuIHNsaWNlLmNhbGwoYXJyYXksIDAsIG4pOwogIH07CgogIC8vIFJldHVybnMgZXZlcnl0aGluZyBidXQgdGhlIGxhc3QgZW50cnkgb2YgdGhlIGFycmF5LiBFc3BlY2lhbGx5IHVzZWZ1bCBvbgogIC8vIHRoZSBhcmd1bWVudHMgb2JqZWN0LiBQYXNzaW5nICoqbioqIHdpbGwgcmV0dXJuIGFsbCB0aGUgdmFsdWVzIGluCiAgLy8gdGhlIGFycmF5LCBleGNsdWRpbmcgdGhlIGxhc3QgTi4gVGhlICoqZ3VhcmQqKiBjaGVjayBhbGxvd3MgaXQgdG8gd29yayB3aXRoCiAgLy8gYF8ubWFwYC4KICBfLmluaXRpYWwgPSBmdW5jdGlvbihhcnJheSwgbiwgZ3VhcmQpIHsKICAgIHJldHVybiBzbGljZS5jYWxsKGFycmF5LCAwLCBhcnJheS5sZW5ndGggLSAoKG4gPT0gbnVsbCkgfHwgZ3VhcmQgPyAxIDogbikpOwogIH07CgogIC8vIEdldCB0aGUgbGFzdCBlbGVtZW50IG9mIGFuIGFycmF5LiBQYXNzaW5nICoqbioqIHdpbGwgcmV0dXJuIHRoZSBsYXN0IE4KICAvLyB2YWx1ZXMgaW4gdGhlIGFycmF5LiBUaGUgKipndWFyZCoqIGNoZWNrIGFsbG93cyBpdCB0byB3b3JrIHdpdGggYF8ubWFwYC4KICBfLmxhc3QgPSBmdW5jdGlvbihhcnJheSwgbiwgZ3VhcmQpIHsKICAgIGlmIChhcnJheSA9PSBudWxsKSByZXR1cm4gdm9pZCAwOwogICAgaWYgKChuID09IG51bGwpIHx8IGd1YXJkKSByZXR1cm4gYXJyYXlbYXJyYXkubGVuZ3RoIC0gMV07CiAgICByZXR1cm4gc2xpY2UuY2FsbChhcnJheSwgTWF0aC5tYXgoYXJyYXkubGVuZ3RoIC0gbiwgMCkpOwogIH07CgogIC8vIFJldHVybnMgZXZlcnl0aGluZyBidXQgdGhlIGZpcnN0IGVudHJ5IG9mIHRoZSBhcnJheS4gQWxpYXNlZCBhcyBgdGFpbGAgYW5kIGBkcm9wYC4KICAvLyBFc3BlY2lhbGx5IHVzZWZ1bCBvbiB0aGUgYXJndW1lbnRzIG9iamVjdC4gUGFzc2luZyBhbiAqKm4qKiB3aWxsIHJldHVybgogIC8vIHRoZSByZXN0IE4gdmFsdWVzIGluIHRoZSBhcnJheS4gVGhlICoqZ3VhcmQqKgogIC8vIGNoZWNrIGFsbG93cyBpdCB0byB3b3JrIHdpdGggYF8ubWFwYC4KICBfLnJlc3QgPSBfLnRhaWwgPSBfLmRyb3AgPSBmdW5jdGlvbihhcnJheSwgbiwgZ3VhcmQpIHsKICAgIHJldHVybiBzbGljZS5jYWxsKGFycmF5LCAobiA9PSBudWxsKSB8fCBndWFyZCA/IDEgOiBuKTsKICB9OwoKICAvLyBUcmltIG91dCBhbGwgZmFsc3kgdmFsdWVzIGZyb20gYW4gYXJyYXkuCiAgXy5jb21wYWN0ID0gZnVuY3Rpb24oYXJyYXkpIHsKICAgIHJldHVybiBfLmZpbHRlcihhcnJheSwgXy5pZGVudGl0eSk7CiAgfTsKCiAgLy8gSW50ZXJuYWwgaW1wbGVtZW50YXRpb24gb2YgYSByZWN1cnNpdmUgYGZsYXR0ZW5gIGZ1bmN0aW9uLgogIHZhciBmbGF0dGVuID0gZnVuY3Rpb24oaW5wdXQsIHNoYWxsb3csIG91dHB1dCkgewogICAgaWYgKHNoYWxsb3cgJiYgXy5ldmVyeShpbnB1dCwgXy5pc0FycmF5KSkgewogICAgICByZXR1cm4gY29uY2F0LmFwcGx5KG91dHB1dCwgaW5wdXQpOwogICAgfQogICAgZWFjaChpbnB1dCwgZnVuY3Rpb24odmFsdWUpIHsKICAgICAgaWYgKF8uaXNBcnJheSh2YWx1ZSkgfHwgXy5pc0FyZ3VtZW50cyh2YWx1ZSkpIHsKICAgICAgICBzaGFsbG93ID8gcHVzaC5hcHBseShvdXRwdXQsIHZhbHVlKSA6IGZsYXR0ZW4odmFsdWUsIHNoYWxsb3csIG91dHB1dCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgb3V0cHV0LnB1c2godmFsdWUpOwogICAgICB9CiAgICB9KTsKICAgIHJldHVybiBvdXRwdXQ7CiAgfTsKCiAgLy8gRmxhdHRlbiBvdXQgYW4gYXJyYXksIGVpdGhlciByZWN1cnNpdmVseSAoYnkgZGVmYXVsdCksIG9yIGp1c3Qgb25lIGxldmVsLgogIF8uZmxhdHRlbiA9IGZ1bmN0aW9uKGFycmF5LCBzaGFsbG93KSB7CiAgICByZXR1cm4gZmxhdHRlbihhcnJheSwgc2hhbGxvdywgW10pOwogIH07CgogIC8vIFJldHVybiBhIHZlcnNpb24gb2YgdGhlIGFycmF5IHRoYXQgZG9lcyBub3QgY29udGFpbiB0aGUgc3BlY2lmaWVkIHZhbHVlKHMpLgogIF8ud2l0aG91dCA9IGZ1bmN0aW9uKGFycmF5KSB7CiAgICByZXR1cm4gXy5kaWZmZXJlbmNlKGFycmF5LCBzbGljZS5jYWxsKGFyZ3VtZW50cywgMSkpOwogIH07CgogIC8vIFNwbGl0IGFuIGFycmF5IGludG8gdHdvIGFycmF5czogb25lIHdob3NlIGVsZW1lbnRzIGFsbCBzYXRpc2Z5IHRoZSBnaXZlbgogIC8vIHByZWRpY2F0ZSwgYW5kIG9uZSB3aG9zZSBlbGVtZW50cyBhbGwgZG8gbm90IHNhdGlzZnkgdGhlIHByZWRpY2F0ZS4KICBfLnBhcnRpdGlvbiA9IGZ1bmN0aW9uKGFycmF5LCBwcmVkaWNhdGUpIHsKICAgIHZhciBwYXNzID0gW10sIGZhaWwgPSBbXTsKICAgIGVhY2goYXJyYXksIGZ1bmN0aW9uKGVsZW0pIHsKICAgICAgKHByZWRpY2F0ZShlbGVtKSA/IHBhc3MgOiBmYWlsKS5wdXNoKGVsZW0pOwogICAgfSk7CiAgICByZXR1cm4gW3Bhc3MsIGZhaWxdOwogIH07CgogIC8vIFByb2R1Y2UgYSBkdXBsaWNhdGUtZnJlZSB2ZXJzaW9uIG9mIHRoZSBhcnJheS4gSWYgdGhlIGFycmF5IGhhcyBhbHJlYWR5CiAgLy8gYmVlbiBzb3J0ZWQsIHlvdSBoYXZlIHRoZSBvcHRpb24gb2YgdXNpbmcgYSBmYXN0ZXIgYWxnb3JpdGhtLgogIC8vIEFsaWFzZWQgYXMgYHVuaXF1ZWAuCiAgXy51bmlxID0gXy51bmlxdWUgPSBmdW5jdGlvbihhcnJheSwgaXNTb3J0ZWQsIGl0ZXJhdG9yLCBjb250ZXh0KSB7CiAgICBpZiAoXy5pc0Z1bmN0aW9uKGlzU29ydGVkKSkgewogICAgICBjb250ZXh0ID0gaXRlcmF0b3I7CiAgICAgIGl0ZXJhdG9yID0gaXNTb3J0ZWQ7CiAgICAgIGlzU29ydGVkID0gZmFsc2U7CiAgICB9CiAgICB2YXIgaW5pdGlhbCA9IGl0ZXJhdG9yID8gXy5tYXAoYXJyYXksIGl0ZXJhdG9yLCBjb250ZXh0KSA6IGFycmF5OwogICAgdmFyIHJlc3VsdHMgPSBbXTsKICAgIHZhciBzZWVuID0gW107CiAgICBlYWNoKGluaXRpYWwsIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCkgewogICAgICBpZiAoaXNTb3J0ZWQgPyAoIWluZGV4IHx8IHNlZW5bc2Vlbi5sZW5ndGggLSAxXSAhPT0gdmFsdWUpIDogIV8uY29udGFpbnMoc2VlbiwgdmFsdWUpKSB7CiAgICAgICAgc2Vlbi5wdXNoKHZhbHVlKTsKICAgICAgICByZXN1bHRzLnB1c2goYXJyYXlbaW5kZXhdKTsKICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gcmVzdWx0czsKICB9OwoKICAvLyBQcm9kdWNlIGFuIGFycmF5IHRoYXQgY29udGFpbnMgdGhlIHVuaW9uOiBlYWNoIGRpc3RpbmN0IGVsZW1lbnQgZnJvbSBhbGwgb2YKICAvLyB0aGUgcGFzc2VkLWluIGFycmF5cy4KICBfLnVuaW9uID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gXy51bmlxKF8uZmxhdHRlbihhcmd1bWVudHMsIHRydWUpKTsKICB9OwoKICAvLyBQcm9kdWNlIGFuIGFycmF5IHRoYXQgY29udGFpbnMgZXZlcnkgaXRlbSBzaGFyZWQgYmV0d2VlbiBhbGwgdGhlCiAgLy8gcGFzc2VkLWluIGFycmF5cy4KICBfLmludGVyc2VjdGlvbiA9IGZ1bmN0aW9uKGFycmF5KSB7CiAgICB2YXIgcmVzdCA9IHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKICAgIHJldHVybiBfLmZpbHRlcihfLnVuaXEoYXJyYXkpLCBmdW5jdGlvbihpdGVtKSB7CiAgICAgIHJldHVybiBfLmV2ZXJ5KHJlc3QsIGZ1bmN0aW9uKG90aGVyKSB7CiAgICAgICAgcmV0dXJuIF8uY29udGFpbnMob3RoZXIsIGl0ZW0pOwogICAgICB9KTsKICAgIH0pOwogIH07CgogIC8vIFRha2UgdGhlIGRpZmZlcmVuY2UgYmV0d2VlbiBvbmUgYXJyYXkgYW5kIGEgbnVtYmVyIG9mIG90aGVyIGFycmF5cy4KICAvLyBPbmx5IHRoZSBlbGVtZW50cyBwcmVzZW50IGluIGp1c3QgdGhlIGZpcnN0IGFycmF5IHdpbGwgcmVtYWluLgogIF8uZGlmZmVyZW5jZSA9IGZ1bmN0aW9uKGFycmF5KSB7CiAgICB2YXIgcmVzdCA9IGNvbmNhdC5hcHBseShBcnJheVByb3RvLCBzbGljZS5jYWxsKGFyZ3VtZW50cywgMSkpOwogICAgcmV0dXJuIF8uZmlsdGVyKGFycmF5LCBmdW5jdGlvbih2YWx1ZSl7IHJldHVybiAhXy5jb250YWlucyhyZXN0LCB2YWx1ZSk7IH0pOwogIH07CgogIC8vIFppcCB0b2dldGhlciBtdWx0aXBsZSBsaXN0cyBpbnRvIGEgc2luZ2xlIGFycmF5IC0tIGVsZW1lbnRzIHRoYXQgc2hhcmUKICAvLyBhbiBpbmRleCBnbyB0b2dldGhlci4KICBfLnppcCA9IGZ1bmN0aW9uKCkgewogICAgdmFyIGxlbmd0aCA9IF8ubWF4KF8ucGx1Y2soYXJndW1lbnRzLCAnbGVuZ3RoJykuY29uY2F0KDApKTsKICAgIHZhciByZXN1bHRzID0gbmV3IEFycmF5KGxlbmd0aCk7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgIHJlc3VsdHNbaV0gPSBfLnBsdWNrKGFyZ3VtZW50cywgJycgKyBpKTsKICAgIH0KICAgIHJldHVybiByZXN1bHRzOwogIH07CgogIC8vIENvbnZlcnRzIGxpc3RzIGludG8gb2JqZWN0cy4gUGFzcyBlaXRoZXIgYSBzaW5nbGUgYXJyYXkgb2YgYFtrZXksIHZhbHVlXWAKICAvLyBwYWlycywgb3IgdHdvIHBhcmFsbGVsIGFycmF5cyBvZiB0aGUgc2FtZSBsZW5ndGggLS0gb25lIG9mIGtleXMsIGFuZCBvbmUgb2YKICAvLyB0aGUgY29ycmVzcG9uZGluZyB2YWx1ZXMuCiAgXy5vYmplY3QgPSBmdW5jdGlvbihsaXN0LCB2YWx1ZXMpIHsKICAgIGlmIChsaXN0ID09IG51bGwpIHJldHVybiB7fTsKICAgIHZhciByZXN1bHQgPSB7fTsKICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBsaXN0Lmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgIGlmICh2YWx1ZXMpIHsKICAgICAgICByZXN1bHRbbGlzdFtpXV0gPSB2YWx1ZXNbaV07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmVzdWx0W2xpc3RbaV1bMF1dID0gbGlzdFtpXVsxXTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9OwoKICAvLyBJZiB0aGUgYnJvd3NlciBkb2Vzbid0IHN1cHBseSB1cyB3aXRoIGluZGV4T2YgKEknbSBsb29raW5nIGF0IHlvdSwgKipNU0lFKiopLAogIC8vIHdlIG5lZWQgdGhpcyBmdW5jdGlvbi4gUmV0dXJuIHRoZSBwb3NpdGlvbiBvZiB0aGUgZmlyc3Qgb2NjdXJyZW5jZSBvZiBhbgogIC8vIGl0ZW0gaW4gYW4gYXJyYXksIG9yIC0xIGlmIHRoZSBpdGVtIGlzIG5vdCBpbmNsdWRlZCBpbiB0aGUgYXJyYXkuCiAgLy8gRGVsZWdhdGVzIHRvICoqRUNNQVNjcmlwdCA1KioncyBuYXRpdmUgYGluZGV4T2ZgIGlmIGF2YWlsYWJsZS4KICAvLyBJZiB0aGUgYXJyYXkgaXMgbGFyZ2UgYW5kIGFscmVhZHkgaW4gc29ydCBvcmRlciwgcGFzcyBgdHJ1ZWAKICAvLyBmb3IgKippc1NvcnRlZCoqIHRvIHVzZSBiaW5hcnkgc2VhcmNoLgogIF8uaW5kZXhPZiA9IGZ1bmN0aW9uKGFycmF5LCBpdGVtLCBpc1NvcnRlZCkgewogICAgaWYgKGFycmF5ID09IG51bGwpIHJldHVybiAtMTsKICAgIHZhciBpID0gMCwgbGVuZ3RoID0gYXJyYXkubGVuZ3RoOwogICAgaWYgKGlzU29ydGVkKSB7CiAgICAgIGlmICh0eXBlb2YgaXNTb3J0ZWQgPT0gJ251bWJlcicpIHsKICAgICAgICBpID0gKGlzU29ydGVkIDwgMCA/IE1hdGgubWF4KDAsIGxlbmd0aCArIGlzU29ydGVkKSA6IGlzU29ydGVkKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpID0gXy5zb3J0ZWRJbmRleChhcnJheSwgaXRlbSk7CiAgICAgICAgcmV0dXJuIGFycmF5W2ldID09PSBpdGVtID8gaSA6IC0xOwogICAgICB9CiAgICB9CiAgICBpZiAobmF0aXZlSW5kZXhPZiAmJiBhcnJheS5pbmRleE9mID09PSBuYXRpdmVJbmRleE9mKSByZXR1cm4gYXJyYXkuaW5kZXhPZihpdGVtLCBpc1NvcnRlZCk7CiAgICBmb3IgKDsgaSA8IGxlbmd0aDsgaSsrKSBpZiAoYXJyYXlbaV0gPT09IGl0ZW0pIHJldHVybiBpOwogICAgcmV0dXJuIC0xOwogIH07CgogIC8vIERlbGVnYXRlcyB0byAqKkVDTUFTY3JpcHQgNSoqJ3MgbmF0aXZlIGBsYXN0SW5kZXhPZmAgaWYgYXZhaWxhYmxlLgogIF8ubGFzdEluZGV4T2YgPSBmdW5jdGlvbihhcnJheSwgaXRlbSwgZnJvbSkgewogICAgaWYgKGFycmF5ID09IG51bGwpIHJldHVybiAtMTsKICAgIHZhciBoYXNJbmRleCA9IGZyb20gIT0gbnVsbDsKICAgIGlmIChuYXRpdmVMYXN0SW5kZXhPZiAmJiBhcnJheS5sYXN0SW5kZXhPZiA9PT0gbmF0aXZlTGFzdEluZGV4T2YpIHsKICAgICAgcmV0dXJuIGhhc0luZGV4ID8gYXJyYXkubGFzdEluZGV4T2YoaXRlbSwgZnJvbSkgOiBhcnJheS5sYXN0SW5kZXhPZihpdGVtKTsKICAgIH0KICAgIHZhciBpID0gKGhhc0luZGV4ID8gZnJvbSA6IGFycmF5Lmxlbmd0aCk7CiAgICB3aGlsZSAoaS0tKSBpZiAoYXJyYXlbaV0gPT09IGl0ZW0pIHJldHVybiBpOwogICAgcmV0dXJuIC0xOwogIH07CgogIC8vIEdlbmVyYXRlIGFuIGludGVnZXIgQXJyYXkgY29udGFpbmluZyBhbiBhcml0aG1ldGljIHByb2dyZXNzaW9uLiBBIHBvcnQgb2YKICAvLyB0aGUgbmF0aXZlIFB5dGhvbiBgcmFuZ2UoKWAgZnVuY3Rpb24uIFNlZQogIC8vIFt0aGUgUHl0aG9uIGRvY3VtZW50YXRpb25dKGh0dHA6Ly9kb2NzLnB5dGhvbi5vcmcvbGlicmFyeS9mdW5jdGlvbnMuaHRtbCNyYW5nZSkuCiAgXy5yYW5nZSA9IGZ1bmN0aW9uKHN0YXJ0LCBzdG9wLCBzdGVwKSB7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8PSAxKSB7CiAgICAgIHN0b3AgPSBzdGFydCB8fCAwOwogICAgICBzdGFydCA9IDA7CiAgICB9CiAgICBzdGVwID0gYXJndW1lbnRzWzJdIHx8IDE7CgogICAgdmFyIGxlbmd0aCA9IE1hdGgubWF4KE1hdGguY2VpbCgoc3RvcCAtIHN0YXJ0KSAvIHN0ZXApLCAwKTsKICAgIHZhciBpZHggPSAwOwogICAgdmFyIHJhbmdlID0gbmV3IEFycmF5KGxlbmd0aCk7CgogICAgd2hpbGUoaWR4IDwgbGVuZ3RoKSB7CiAgICAgIHJhbmdlW2lkeCsrXSA9IHN0YXJ0OwogICAgICBzdGFydCArPSBzdGVwOwogICAgfQoKICAgIHJldHVybiByYW5nZTsKICB9OwoKICAvLyBGdW5jdGlvbiAoYWhlbSkgRnVuY3Rpb25zCiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tCgogIC8vIFJldXNhYmxlIGNvbnN0cnVjdG9yIGZ1bmN0aW9uIGZvciBwcm90b3R5cGUgc2V0dGluZy4KICB2YXIgY3RvciA9IGZ1bmN0aW9uKCl7fTsKCiAgLy8gQ3JlYXRlIGEgZnVuY3Rpb24gYm91bmQgdG8gYSBnaXZlbiBvYmplY3QgKGFzc2lnbmluZyBgdGhpc2AsIGFuZCBhcmd1bWVudHMsCiAgLy8gb3B0aW9uYWxseSkuIERlbGVnYXRlcyB0byAqKkVDTUFTY3JpcHQgNSoqJ3MgbmF0aXZlIGBGdW5jdGlvbi5iaW5kYCBpZgogIC8vIGF2YWlsYWJsZS4KICBfLmJpbmQgPSBmdW5jdGlvbihmdW5jLCBjb250ZXh0KSB7CiAgICB2YXIgYXJncywgYm91bmQ7CiAgICBpZiAobmF0aXZlQmluZCAmJiBmdW5jLmJpbmQgPT09IG5hdGl2ZUJpbmQpIHJldHVybiBuYXRpdmVCaW5kLmFwcGx5KGZ1bmMsIHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSk7CiAgICBpZiAoIV8uaXNGdW5jdGlvbihmdW5jKSkgdGhyb3cgbmV3IFR5cGVFcnJvcjsKICAgIGFyZ3MgPSBzbGljZS5jYWxsKGFyZ3VtZW50cywgMik7CiAgICByZXR1cm4gYm91bmQgPSBmdW5jdGlvbigpIHsKICAgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIGJvdW5kKSkgcmV0dXJuIGZ1bmMuYXBwbHkoY29udGV4dCwgYXJncy5jb25jYXQoc2xpY2UuY2FsbChhcmd1bWVudHMpKSk7CiAgICAgIGN0b3IucHJvdG90eXBlID0gZnVuYy5wcm90b3R5cGU7CiAgICAgIHZhciBzZWxmID0gbmV3IGN0b3I7CiAgICAgIGN0b3IucHJvdG90eXBlID0gbnVsbDsKICAgICAgdmFyIHJlc3VsdCA9IGZ1bmMuYXBwbHkoc2VsZiwgYXJncy5jb25jYXQoc2xpY2UuY2FsbChhcmd1bWVudHMpKSk7CiAgICAgIGlmIChPYmplY3QocmVzdWx0KSA9PT0gcmVzdWx0KSByZXR1cm4gcmVzdWx0OwogICAgICByZXR1cm4gc2VsZjsKICAgIH07CiAgfTsKCiAgLy8gUGFydGlhbGx5IGFwcGx5IGEgZnVuY3Rpb24gYnkgY3JlYXRpbmcgYSB2ZXJzaW9uIHRoYXQgaGFzIGhhZCBzb21lIG9mIGl0cwogIC8vIGFyZ3VtZW50cyBwcmUtZmlsbGVkLCB3aXRob3V0IGNoYW5naW5nIGl0cyBkeW5hbWljIGB0aGlzYCBjb250ZXh0LiBfIGFjdHMKICAvLyBhcyBhIHBsYWNlaG9sZGVyLCBhbGxvd2luZyBhbnkgY29tYmluYXRpb24gb2YgYXJndW1lbnRzIHRvIGJlIHByZS1maWxsZWQuCiAgXy5wYXJ0aWFsID0gZnVuY3Rpb24oZnVuYykgewogICAgdmFyIGJvdW5kQXJncyA9IHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgdmFyIHBvc2l0aW9uID0gMDsKICAgICAgdmFyIGFyZ3MgPSBib3VuZEFyZ3Muc2xpY2UoKTsKICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IGFyZ3MubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAoYXJnc1tpXSA9PT0gXykgYXJnc1tpXSA9IGFyZ3VtZW50c1twb3NpdGlvbisrXTsKICAgICAgfQogICAgICB3aGlsZSAocG9zaXRpb24gPCBhcmd1bWVudHMubGVuZ3RoKSBhcmdzLnB1c2goYXJndW1lbnRzW3Bvc2l0aW9uKytdKTsKICAgICAgcmV0dXJuIGZ1bmMuYXBwbHkodGhpcywgYXJncyk7CiAgICB9OwogIH07CgogIC8vIEJpbmQgYSBudW1iZXIgb2YgYW4gb2JqZWN0J3MgbWV0aG9kcyB0byB0aGF0IG9iamVjdC4gUmVtYWluaW5nIGFyZ3VtZW50cwogIC8vIGFyZSB0aGUgbWV0aG9kIG5hbWVzIHRvIGJlIGJvdW5kLiBVc2VmdWwgZm9yIGVuc3VyaW5nIHRoYXQgYWxsIGNhbGxiYWNrcwogIC8vIGRlZmluZWQgb24gYW4gb2JqZWN0IGJlbG9uZyB0byBpdC4KICBfLmJpbmRBbGwgPSBmdW5jdGlvbihvYmopIHsKICAgIHZhciBmdW5jcyA9IHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKICAgIGlmIChmdW5jcy5sZW5ndGggPT09IDApIHRocm93IG5ldyBFcnJvcignYmluZEFsbCBtdXN0IGJlIHBhc3NlZCBmdW5jdGlvbiBuYW1lcycpOwogICAgZWFjaChmdW5jcywgZnVuY3Rpb24oZikgeyBvYmpbZl0gPSBfLmJpbmQob2JqW2ZdLCBvYmopOyB9KTsKICAgIHJldHVybiBvYmo7CiAgfTsKCiAgLy8gTWVtb2l6ZSBhbiBleHBlbnNpdmUgZnVuY3Rpb24gYnkgc3RvcmluZyBpdHMgcmVzdWx0cy4KICBfLm1lbW9pemUgPSBmdW5jdGlvbihmdW5jLCBoYXNoZXIpIHsKICAgIHZhciBtZW1vID0ge307CiAgICBoYXNoZXIgfHwgKGhhc2hlciA9IF8uaWRlbnRpdHkpOwogICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICB2YXIga2V5ID0gaGFzaGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIHJldHVybiBfLmhhcyhtZW1vLCBrZXkpID8gbWVtb1trZXldIDogKG1lbW9ba2V5XSA9IGZ1bmMuYXBwbHkodGhpcywgYXJndW1lbnRzKSk7CiAgICB9OwogIH07CgogIC8vIERlbGF5cyBhIGZ1bmN0aW9uIGZvciB0aGUgZ2l2ZW4gbnVtYmVyIG9mIG1pbGxpc2Vjb25kcywgYW5kIHRoZW4gY2FsbHMKICAvLyBpdCB3aXRoIHRoZSBhcmd1bWVudHMgc3VwcGxpZWQuCiAgXy5kZWxheSA9IGZ1bmN0aW9uKGZ1bmMsIHdhaXQpIHsKICAgIHZhciBhcmdzID0gc2xpY2UuY2FsbChhcmd1bWVudHMsIDIpOwogICAgcmV0dXJuIHNldFRpbWVvdXQoZnVuY3Rpb24oKXsgcmV0dXJuIGZ1bmMuYXBwbHkobnVsbCwgYXJncyk7IH0sIHdhaXQpOwogIH07CgogIC8vIERlZmVycyBhIGZ1bmN0aW9uLCBzY2hlZHVsaW5nIGl0IHRvIHJ1biBhZnRlciB0aGUgY3VycmVudCBjYWxsIHN0YWNrIGhhcwogIC8vIGNsZWFyZWQuCiAgXy5kZWZlciA9IGZ1bmN0aW9uKGZ1bmMpIHsKICAgIHJldHVybiBfLmRlbGF5LmFwcGx5KF8sIFtmdW5jLCAxXS5jb25jYXQoc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpKSk7CiAgfTsKCiAgLy8gUmV0dXJucyBhIGZ1bmN0aW9uLCB0aGF0LCB3aGVuIGludm9rZWQsIHdpbGwgb25seSBiZSB0cmlnZ2VyZWQgYXQgbW9zdCBvbmNlCiAgLy8gZHVyaW5nIGEgZ2l2ZW4gd2luZG93IG9mIHRpbWUuIE5vcm1hbGx5LCB0aGUgdGhyb3R0bGVkIGZ1bmN0aW9uIHdpbGwgcnVuCiAgLy8gYXMgbXVjaCBhcyBpdCBjYW4sIHdpdGhvdXQgZXZlciBnb2luZyBtb3JlIHRoYW4gb25jZSBwZXIgYHdhaXRgIGR1cmF0aW9uOwogIC8vIGJ1dCBpZiB5b3UnZCBsaWtlIHRvIGRpc2FibGUgdGhlIGV4ZWN1dGlvbiBvbiB0aGUgbGVhZGluZyBlZGdlLCBwYXNzCiAgLy8gYHtsZWFkaW5nOiBmYWxzZX1gLiBUbyBkaXNhYmxlIGV4ZWN1dGlvbiBvbiB0aGUgdHJhaWxpbmcgZWRnZSwgZGl0dG8uCiAgXy50aHJvdHRsZSA9IGZ1bmN0aW9uKGZ1bmMsIHdhaXQsIG9wdGlvbnMpIHsKICAgIHZhciBjb250ZXh0LCBhcmdzLCByZXN1bHQ7CiAgICB2YXIgdGltZW91dCA9IG51bGw7CiAgICB2YXIgcHJldmlvdXMgPSAwOwogICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTsKICAgIHZhciBsYXRlciA9IGZ1bmN0aW9uKCkgewogICAgICBwcmV2aW91cyA9IG9wdGlvbnMubGVhZGluZyA9PT0gZmFsc2UgPyAwIDogXy5ub3coKTsKICAgICAgdGltZW91dCA9IG51bGw7CiAgICAgIHJlc3VsdCA9IGZ1bmMuYXBwbHkoY29udGV4dCwgYXJncyk7CiAgICAgIGNvbnRleHQgPSBhcmdzID0gbnVsbDsKICAgIH07CiAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBub3cgPSBfLm5vdygpOwogICAgICBpZiAoIXByZXZpb3VzICYmIG9wdGlvbnMubGVhZGluZyA9PT0gZmFsc2UpIHByZXZpb3VzID0gbm93OwogICAgICB2YXIgcmVtYWluaW5nID0gd2FpdCAtIChub3cgLSBwcmV2aW91cyk7CiAgICAgIGNvbnRleHQgPSB0aGlzOwogICAgICBhcmdzID0gYXJndW1lbnRzOwogICAgICBpZiAocmVtYWluaW5nIDw9IDApIHsKICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dCk7CiAgICAgICAgdGltZW91dCA9IG51bGw7CiAgICAgICAgcHJldmlvdXMgPSBub3c7CiAgICAgICAgcmVzdWx0ID0gZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTsKICAgICAgICBjb250ZXh0ID0gYXJncyA9IG51bGw7CiAgICAgIH0gZWxzZSBpZiAoIXRpbWVvdXQgJiYgb3B0aW9ucy50cmFpbGluZyAhPT0gZmFsc2UpIHsKICAgICAgICB0aW1lb3V0ID0gc2V0VGltZW91dChsYXRlciwgcmVtYWluaW5nKTsKICAgICAgfQogICAgICByZXR1cm4gcmVzdWx0OwogICAgfTsKICB9OwoKICAvLyBSZXR1cm5zIGEgZnVuY3Rpb24sIHRoYXQsIGFzIGxvbmcgYXMgaXQgY29udGludWVzIHRvIGJlIGludm9rZWQsIHdpbGwgbm90CiAgLy8gYmUgdHJpZ2dlcmVkLiBUaGUgZnVuY3Rpb24gd2lsbCBiZSBjYWxsZWQgYWZ0ZXIgaXQgc3RvcHMgYmVpbmcgY2FsbGVkIGZvcgogIC8vIE4gbWlsbGlzZWNvbmRzLiBJZiBgaW1tZWRpYXRlYCBpcyBwYXNzZWQsIHRyaWdnZXIgdGhlIGZ1bmN0aW9uIG9uIHRoZQogIC8vIGxlYWRpbmcgZWRnZSwgaW5zdGVhZCBvZiB0aGUgdHJhaWxpbmcuCiAgXy5kZWJvdW5jZSA9IGZ1bmN0aW9uKGZ1bmMsIHdhaXQsIGltbWVkaWF0ZSkgewogICAgdmFyIHRpbWVvdXQsIGFyZ3MsIGNvbnRleHQsIHRpbWVzdGFtcCwgcmVzdWx0OwoKICAgIHZhciBsYXRlciA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgbGFzdCA9IF8ubm93KCkgLSB0aW1lc3RhbXA7CiAgICAgIGlmIChsYXN0IDwgd2FpdCkgewogICAgICAgIHRpbWVvdXQgPSBzZXRUaW1lb3V0KGxhdGVyLCB3YWl0IC0gbGFzdCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGltZW91dCA9IG51bGw7CiAgICAgICAgaWYgKCFpbW1lZGlhdGUpIHsKICAgICAgICAgIHJlc3VsdCA9IGZ1bmMuYXBwbHkoY29udGV4dCwgYXJncyk7CiAgICAgICAgICBjb250ZXh0ID0gYXJncyA9IG51bGw7CiAgICAgICAgfQogICAgICB9CiAgICB9OwoKICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgY29udGV4dCA9IHRoaXM7CiAgICAgIGFyZ3MgPSBhcmd1bWVudHM7CiAgICAgIHRpbWVzdGFtcCA9IF8ubm93KCk7CiAgICAgIHZhciBjYWxsTm93ID0gaW1tZWRpYXRlICYmICF0aW1lb3V0OwogICAgICBpZiAoIXRpbWVvdXQpIHsKICAgICAgICB0aW1lb3V0ID0gc2V0VGltZW91dChsYXRlciwgd2FpdCk7CiAgICAgIH0KICAgICAgaWYgKGNhbGxOb3cpIHsKICAgICAgICByZXN1bHQgPSBmdW5jLmFwcGx5KGNvbnRleHQsIGFyZ3MpOwogICAgICAgIGNvbnRleHQgPSBhcmdzID0gbnVsbDsKICAgICAgfQoKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH07CiAgfTsKCiAgLy8gUmV0dXJucyBhIGZ1bmN0aW9uIHRoYXQgd2lsbCBiZSBleGVjdXRlZCBhdCBtb3N0IG9uZSB0aW1lLCBubyBtYXR0ZXIgaG93CiAgLy8gb2Z0ZW4geW91IGNhbGwgaXQuIFVzZWZ1bCBmb3IgbGF6eSBpbml0aWFsaXphdGlvbi4KICBfLm9uY2UgPSBmdW5jdGlvbihmdW5jKSB7CiAgICB2YXIgcmFuID0gZmFsc2UsIG1lbW87CiAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgIGlmIChyYW4pIHJldHVybiBtZW1vOwogICAgICByYW4gPSB0cnVlOwogICAgICBtZW1vID0gZnVuYy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICBmdW5jID0gbnVsbDsKICAgICAgcmV0dXJuIG1lbW87CiAgICB9OwogIH07CgogIC8vIFJldHVybnMgdGhlIGZpcnN0IGZ1bmN0aW9uIHBhc3NlZCBhcyBhbiBhcmd1bWVudCB0byB0aGUgc2Vjb25kLAogIC8vIGFsbG93aW5nIHlvdSB0byBhZGp1c3QgYXJndW1lbnRzLCBydW4gY29kZSBiZWZvcmUgYW5kIGFmdGVyLCBhbmQKICAvLyBjb25kaXRpb25hbGx5IGV4ZWN1dGUgdGhlIG9yaWdpbmFsIGZ1bmN0aW9uLgogIF8ud3JhcCA9IGZ1bmN0aW9uKGZ1bmMsIHdyYXBwZXIpIHsKICAgIHJldHVybiBfLnBhcnRpYWwod3JhcHBlciwgZnVuYyk7CiAgfTsKCiAgLy8gUmV0dXJucyBhIGZ1bmN0aW9uIHRoYXQgaXMgdGhlIGNvbXBvc2l0aW9uIG9mIGEgbGlzdCBvZiBmdW5jdGlvbnMsIGVhY2gKICAvLyBjb25zdW1pbmcgdGhlIHJldHVybiB2YWx1ZSBvZiB0aGUgZnVuY3Rpb24gdGhhdCBmb2xsb3dzLgogIF8uY29tcG9zZSA9IGZ1bmN0aW9uKCkgewogICAgdmFyIGZ1bmNzID0gYXJndW1lbnRzOwogICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICB2YXIgYXJncyA9IGFyZ3VtZW50czsKICAgICAgZm9yICh2YXIgaSA9IGZ1bmNzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgYXJncyA9IFtmdW5jc1tpXS5hcHBseSh0aGlzLCBhcmdzKV07CiAgICAgIH0KICAgICAgcmV0dXJuIGFyZ3NbMF07CiAgICB9OwogIH07CgogIC8vIFJldHVybnMgYSBmdW5jdGlvbiB0aGF0IHdpbGwgb25seSBiZSBleGVjdXRlZCBhZnRlciBiZWluZyBjYWxsZWQgTiB0aW1lcy4KICBfLmFmdGVyID0gZnVuY3Rpb24odGltZXMsIGZ1bmMpIHsKICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgaWYgKC0tdGltZXMgPCAxKSB7CiAgICAgICAgcmV0dXJuIGZ1bmMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQogICAgfTsKICB9OwoKICAvLyBPYmplY3QgRnVuY3Rpb25zCiAgLy8gLS0tLS0tLS0tLS0tLS0tLQoKICAvLyBSZXRyaWV2ZSB0aGUgbmFtZXMgb2YgYW4gb2JqZWN0J3MgcHJvcGVydGllcy4KICAvLyBEZWxlZ2F0ZXMgdG8gKipFQ01BU2NyaXB0IDUqKidzIG5hdGl2ZSBgT2JqZWN0LmtleXNgCiAgXy5rZXlzID0gZnVuY3Rpb24ob2JqKSB7CiAgICBpZiAoIV8uaXNPYmplY3Qob2JqKSkgcmV0dXJuIFtdOwogICAgaWYgKG5hdGl2ZUtleXMpIHJldHVybiBuYXRpdmVLZXlzKG9iaik7CiAgICB2YXIga2V5cyA9IFtdOwogICAgZm9yICh2YXIga2V5IGluIG9iaikgaWYgKF8uaGFzKG9iaiwga2V5KSkga2V5cy5wdXNoKGtleSk7CiAgICByZXR1cm4ga2V5czsKICB9OwoKICAvLyBSZXRyaWV2ZSB0aGUgdmFsdWVzIG9mIGFuIG9iamVjdCdzIHByb3BlcnRpZXMuCiAgXy52YWx1ZXMgPSBmdW5jdGlvbihvYmopIHsKICAgIHZhciBrZXlzID0gXy5rZXlzKG9iaik7CiAgICB2YXIgbGVuZ3RoID0ga2V5cy5sZW5ndGg7CiAgICB2YXIgdmFsdWVzID0gbmV3IEFycmF5KGxlbmd0aCk7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgIHZhbHVlc1tpXSA9IG9ialtrZXlzW2ldXTsKICAgIH0KICAgIHJldHVybiB2YWx1ZXM7CiAgfTsKCiAgLy8gQ29udmVydCBhbiBvYmplY3QgaW50byBhIGxpc3Qgb2YgYFtrZXksIHZhbHVlXWAgcGFpcnMuCiAgXy5wYWlycyA9IGZ1bmN0aW9uKG9iaikgewogICAgdmFyIGtleXMgPSBfLmtleXMob2JqKTsKICAgIHZhciBsZW5ndGggPSBrZXlzLmxlbmd0aDsKICAgIHZhciBwYWlycyA9IG5ldyBBcnJheShsZW5ndGgpOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICBwYWlyc1tpXSA9IFtrZXlzW2ldLCBvYmpba2V5c1tpXV1dOwogICAgfQogICAgcmV0dXJuIHBhaXJzOwogIH07CgogIC8vIEludmVydCB0aGUga2V5cyBhbmQgdmFsdWVzIG9mIGFuIG9iamVjdC4gVGhlIHZhbHVlcyBtdXN0IGJlIHNlcmlhbGl6YWJsZS4KICBfLmludmVydCA9IGZ1bmN0aW9uKG9iaikgewogICAgdmFyIHJlc3VsdCA9IHt9OwogICAgdmFyIGtleXMgPSBfLmtleXMob2JqKTsKICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBrZXlzLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgIHJlc3VsdFtvYmpba2V5c1tpXV1dID0ga2V5c1tpXTsKICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfTsKCiAgLy8gUmV0dXJuIGEgc29ydGVkIGxpc3Qgb2YgdGhlIGZ1bmN0aW9uIG5hbWVzIGF2YWlsYWJsZSBvbiB0aGUgb2JqZWN0LgogIC8vIEFsaWFzZWQgYXMgYG1ldGhvZHNgCiAgXy5mdW5jdGlvbnMgPSBfLm1ldGhvZHMgPSBmdW5jdGlvbihvYmopIHsKICAgIHZhciBuYW1lcyA9IFtdOwogICAgZm9yICh2YXIga2V5IGluIG9iaikgewogICAgICBpZiAoXy5pc0Z1bmN0aW9uKG9ialtrZXldKSkgbmFtZXMucHVzaChrZXkpOwogICAgfQogICAgcmV0dXJuIG5hbWVzLnNvcnQoKTsKICB9OwoKICAvLyBFeHRlbmQgYSBnaXZlbiBvYmplY3Qgd2l0aCBhbGwgdGhlIHByb3BlcnRpZXMgaW4gcGFzc2VkLWluIG9iamVjdChzKS4KICBfLmV4dGVuZCA9IGZ1bmN0aW9uKG9iaikgewogICAgZWFjaChzbGljZS5jYWxsKGFyZ3VtZW50cywgMSksIGZ1bmN0aW9uKHNvdXJjZSkgewogICAgICBpZiAoc291cmNlKSB7CiAgICAgICAgZm9yICh2YXIgcHJvcCBpbiBzb3VyY2UpIHsKICAgICAgICAgIG9ialtwcm9wXSA9IHNvdXJjZVtwcm9wXTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIG9iajsKICB9OwoKICAvLyBSZXR1cm4gYSBjb3B5IG9mIHRoZSBvYmplY3Qgb25seSBjb250YWluaW5nIHRoZSB3aGl0ZWxpc3RlZCBwcm9wZXJ0aWVzLgogIF8ucGljayA9IGZ1bmN0aW9uKG9iaikgewogICAgdmFyIGNvcHkgPSB7fTsKICAgIHZhciBrZXlzID0gY29uY2F0LmFwcGx5KEFycmF5UHJvdG8sIHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSk7CiAgICBlYWNoKGtleXMsIGZ1bmN0aW9uKGtleSkgewogICAgICBpZiAoa2V5IGluIG9iaikgY29weVtrZXldID0gb2JqW2tleV07CiAgICB9KTsKICAgIHJldHVybiBjb3B5OwogIH07CgogICAvLyBSZXR1cm4gYSBjb3B5IG9mIHRoZSBvYmplY3Qgd2l0aG91dCB0aGUgYmxhY2tsaXN0ZWQgcHJvcGVydGllcy4KICBfLm9taXQgPSBmdW5jdGlvbihvYmopIHsKICAgIHZhciBjb3B5ID0ge307CiAgICB2YXIga2V5cyA9IGNvbmNhdC5hcHBseShBcnJheVByb3RvLCBzbGljZS5jYWxsKGFyZ3VtZW50cywgMSkpOwogICAgZm9yICh2YXIga2V5IGluIG9iaikgewogICAgICBpZiAoIV8uY29udGFpbnMoa2V5cywga2V5KSkgY29weVtrZXldID0gb2JqW2tleV07CiAgICB9CiAgICByZXR1cm4gY29weTsKICB9OwoKICAvLyBGaWxsIGluIGEgZ2l2ZW4gb2JqZWN0IHdpdGggZGVmYXVsdCBwcm9wZXJ0aWVzLgogIF8uZGVmYXVsdHMgPSBmdW5jdGlvbihvYmopIHsKICAgIGVhY2goc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpLCBmdW5jdGlvbihzb3VyY2UpIHsKICAgICAgaWYgKHNvdXJjZSkgewogICAgICAgIGZvciAodmFyIHByb3AgaW4gc291cmNlKSB7CiAgICAgICAgICBpZiAob2JqW3Byb3BdID09PSB2b2lkIDApIG9ialtwcm9wXSA9IHNvdXJjZVtwcm9wXTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIG9iajsKICB9OwoKICAvLyBDcmVhdGUgYSAoc2hhbGxvdy1jbG9uZWQpIGR1cGxpY2F0ZSBvZiBhbiBvYmplY3QuCiAgXy5jbG9uZSA9IGZ1bmN0aW9uKG9iaikgewogICAgaWYgKCFfLmlzT2JqZWN0KG9iaikpIHJldHVybiBvYmo7CiAgICByZXR1cm4gXy5pc0FycmF5KG9iaikgPyBvYmouc2xpY2UoKSA6IF8uZXh0ZW5kKHt9LCBvYmopOwogIH07CgogIC8vIEludm9rZXMgaW50ZXJjZXB0b3Igd2l0aCB0aGUgb2JqLCBhbmQgdGhlbiByZXR1cm5zIG9iai4KICAvLyBUaGUgcHJpbWFyeSBwdXJwb3NlIG9mIHRoaXMgbWV0aG9kIGlzIHRvICJ0YXAgaW50byIgYSBtZXRob2QgY2hhaW4sIGluCiAgLy8gb3JkZXIgdG8gcGVyZm9ybSBvcGVyYXRpb25zIG9uIGludGVybWVkaWF0ZSByZXN1bHRzIHdpdGhpbiB0aGUgY2hhaW4uCiAgXy50YXAgPSBmdW5jdGlvbihvYmosIGludGVyY2VwdG9yKSB7CiAgICBpbnRlcmNlcHRvcihvYmopOwogICAgcmV0dXJuIG9iajsKICB9OwoKICAvLyBJbnRlcm5hbCByZWN1cnNpdmUgY29tcGFyaXNvbiBmdW5jdGlvbiBmb3IgYGlzRXF1YWxgLgogIHZhciBlcSA9IGZ1bmN0aW9uKGEsIGIsIGFTdGFjaywgYlN0YWNrKSB7CiAgICAvLyBJZGVudGljYWwgb2JqZWN0cyBhcmUgZXF1YWwuIGAwID09PSAtMGAsIGJ1dCB0aGV5IGFyZW4ndCBpZGVudGljYWwuCiAgICAvLyBTZWUgdGhlIFtIYXJtb255IGBlZ2FsYCBwcm9wb3NhbF0oaHR0cDovL3dpa2kuZWNtYXNjcmlwdC5vcmcvZG9rdS5waHA/aWQ9aGFybW9ueTplZ2FsKS4KICAgIGlmIChhID09PSBiKSByZXR1cm4gYSAhPT0gMCB8fCAxIC8gYSA9PSAxIC8gYjsKICAgIC8vIEEgc3RyaWN0IGNvbXBhcmlzb24gaXMgbmVjZXNzYXJ5IGJlY2F1c2UgYG51bGwgPT0gdW5kZWZpbmVkYC4KICAgIGlmIChhID09IG51bGwgfHwgYiA9PSBudWxsKSByZXR1cm4gYSA9PT0gYjsKICAgIC8vIFVud3JhcCBhbnkgd3JhcHBlZCBvYmplY3RzLgogICAgaWYgKGEgaW5zdGFuY2VvZiBfKSBhID0gYS5fd3JhcHBlZDsKICAgIGlmIChiIGluc3RhbmNlb2YgXykgYiA9IGIuX3dyYXBwZWQ7CiAgICAvLyBDb21wYXJlIGBbW0NsYXNzXV1gIG5hbWVzLgogICAgdmFyIGNsYXNzTmFtZSA9IHRvU3RyaW5nLmNhbGwoYSk7CiAgICBpZiAoY2xhc3NOYW1lICE9IHRvU3RyaW5nLmNhbGwoYikpIHJldHVybiBmYWxzZTsKICAgIHN3aXRjaCAoY2xhc3NOYW1lKSB7CiAgICAgIC8vIFN0cmluZ3MsIG51bWJlcnMsIGRhdGVzLCBhbmQgYm9vbGVhbnMgYXJlIGNvbXBhcmVkIGJ5IHZhbHVlLgogICAgICBjYXNlICdbb2JqZWN0IFN0cmluZ10nOgogICAgICAgIC8vIFByaW1pdGl2ZXMgYW5kIHRoZWlyIGNvcnJlc3BvbmRpbmcgb2JqZWN0IHdyYXBwZXJzIGFyZSBlcXVpdmFsZW50OyB0aHVzLCBgIjUiYCBpcwogICAgICAgIC8vIGVxdWl2YWxlbnQgdG8gYG5ldyBTdHJpbmcoIjUiKWAuCiAgICAgICAgcmV0dXJuIGEgPT0gU3RyaW5nKGIpOwogICAgICBjYXNlICdbb2JqZWN0IE51bWJlcl0nOgogICAgICAgIC8vIGBOYU5gcyBhcmUgZXF1aXZhbGVudCwgYnV0IG5vbi1yZWZsZXhpdmUuIEFuIGBlZ2FsYCBjb21wYXJpc29uIGlzIHBlcmZvcm1lZCBmb3IKICAgICAgICAvLyBvdGhlciBudW1lcmljIHZhbHVlcy4KICAgICAgICByZXR1cm4gYSAhPSArYSA/IGIgIT0gK2IgOiAoYSA9PSAwID8gMSAvIGEgPT0gMSAvIGIgOiBhID09ICtiKTsKICAgICAgY2FzZSAnW29iamVjdCBEYXRlXSc6CiAgICAgIGNhc2UgJ1tvYmplY3QgQm9vbGVhbl0nOgogICAgICAgIC8vIENvZXJjZSBkYXRlcyBhbmQgYm9vbGVhbnMgdG8gbnVtZXJpYyBwcmltaXRpdmUgdmFsdWVzLiBEYXRlcyBhcmUgY29tcGFyZWQgYnkgdGhlaXIKICAgICAgICAvLyBtaWxsaXNlY29uZCByZXByZXNlbnRhdGlvbnMuIE5vdGUgdGhhdCBpbnZhbGlkIGRhdGVzIHdpdGggbWlsbGlzZWNvbmQgcmVwcmVzZW50YXRpb25zCiAgICAgICAgLy8gb2YgYE5hTmAgYXJlIG5vdCBlcXVpdmFsZW50LgogICAgICAgIHJldHVybiArYSA9PSArYjsKICAgICAgLy8gUmVnRXhwcyBhcmUgY29tcGFyZWQgYnkgdGhlaXIgc291cmNlIHBhdHRlcm5zIGFuZCBmbGFncy4KICAgICAgY2FzZSAnW29iamVjdCBSZWdFeHBdJzoKICAgICAgICByZXR1cm4gYS5zb3VyY2UgPT0gYi5zb3VyY2UgJiYKICAgICAgICAgICAgICAgYS5nbG9iYWwgPT0gYi5nbG9iYWwgJiYKICAgICAgICAgICAgICAgYS5tdWx0aWxpbmUgPT0gYi5tdWx0aWxpbmUgJiYKICAgICAgICAgICAgICAgYS5pZ25vcmVDYXNlID09IGIuaWdub3JlQ2FzZTsKICAgIH0KICAgIGlmICh0eXBlb2YgYSAhPSAnb2JqZWN0JyB8fCB0eXBlb2YgYiAhPSAnb2JqZWN0JykgcmV0dXJuIGZhbHNlOwogICAgLy8gQXNzdW1lIGVxdWFsaXR5IGZvciBjeWNsaWMgc3RydWN0dXJlcy4gVGhlIGFsZ29yaXRobSBmb3IgZGV0ZWN0aW5nIGN5Y2xpYwogICAgLy8gc3RydWN0dXJlcyBpcyBhZGFwdGVkIGZyb20gRVMgNS4xIHNlY3Rpb24gMTUuMTIuMywgYWJzdHJhY3Qgb3BlcmF0aW9uIGBKT2AuCiAgICB2YXIgbGVuZ3RoID0gYVN0YWNrLmxlbmd0aDsKICAgIHdoaWxlIChsZW5ndGgtLSkgewogICAgICAvLyBMaW5lYXIgc2VhcmNoLiBQZXJmb3JtYW5jZSBpcyBpbnZlcnNlbHkgcHJvcG9ydGlvbmFsIHRvIHRoZSBudW1iZXIgb2YKICAgICAgLy8gdW5pcXVlIG5lc3RlZCBzdHJ1Y3R1cmVzLgogICAgICBpZiAoYVN0YWNrW2xlbmd0aF0gPT0gYSkgcmV0dXJuIGJTdGFja1tsZW5ndGhdID09IGI7CiAgICB9CiAgICAvLyBPYmplY3RzIHdpdGggZGlmZmVyZW50IGNvbnN0cnVjdG9ycyBhcmUgbm90IGVxdWl2YWxlbnQsIGJ1dCBgT2JqZWN0YHMKICAgIC8vIGZyb20gZGlmZmVyZW50IGZyYW1lcyBhcmUuCiAgICB2YXIgYUN0b3IgPSBhLmNvbnN0cnVjdG9yLCBiQ3RvciA9IGIuY29uc3RydWN0b3I7CiAgICBpZiAoYUN0b3IgIT09IGJDdG9yICYmICEoXy5pc0Z1bmN0aW9uKGFDdG9yKSAmJiAoYUN0b3IgaW5zdGFuY2VvZiBhQ3RvcikgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfLmlzRnVuY3Rpb24oYkN0b3IpICYmIChiQ3RvciBpbnN0YW5jZW9mIGJDdG9yKSkKICAgICAgICAgICAgICAgICAgICAgICAgJiYgKCdjb25zdHJ1Y3RvcicgaW4gYSAmJiAnY29uc3RydWN0b3InIGluIGIpKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIC8vIEFkZCB0aGUgZmlyc3Qgb2JqZWN0IHRvIHRoZSBzdGFjayBvZiB0cmF2ZXJzZWQgb2JqZWN0cy4KICAgIGFTdGFjay5wdXNoKGEpOwogICAgYlN0YWNrLnB1c2goYik7CiAgICB2YXIgc2l6ZSA9IDAsIHJlc3VsdCA9IHRydWU7CiAgICAvLyBSZWN1cnNpdmVseSBjb21wYXJlIG9iamVjdHMgYW5kIGFycmF5cy4KICAgIGlmIChjbGFzc05hbWUgPT0gJ1tvYmplY3QgQXJyYXldJykgewogICAgICAvLyBDb21wYXJlIGFycmF5IGxlbmd0aHMgdG8gZGV0ZXJtaW5lIGlmIGEgZGVlcCBjb21wYXJpc29uIGlzIG5lY2Vzc2FyeS4KICAgICAgc2l6ZSA9IGEubGVuZ3RoOwogICAgICByZXN1bHQgPSBzaXplID09IGIubGVuZ3RoOwogICAgICBpZiAocmVzdWx0KSB7CiAgICAgICAgLy8gRGVlcCBjb21wYXJlIHRoZSBjb250ZW50cywgaWdub3Jpbmcgbm9uLW51bWVyaWMgcHJvcGVydGllcy4KICAgICAgICB3aGlsZSAoc2l6ZS0tKSB7CiAgICAgICAgICBpZiAoIShyZXN1bHQgPSBlcShhW3NpemVdLCBiW3NpemVdLCBhU3RhY2ssIGJTdGFjaykpKSBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIC8vIERlZXAgY29tcGFyZSBvYmplY3RzLgogICAgICBmb3IgKHZhciBrZXkgaW4gYSkgewogICAgICAgIGlmIChfLmhhcyhhLCBrZXkpKSB7CiAgICAgICAgICAvLyBDb3VudCB0aGUgZXhwZWN0ZWQgbnVtYmVyIG9mIHByb3BlcnRpZXMuCiAgICAgICAgICBzaXplKys7CiAgICAgICAgICAvLyBEZWVwIGNvbXBhcmUgZWFjaCBtZW1iZXIuCiAgICAgICAgICBpZiAoIShyZXN1bHQgPSBfLmhhcyhiLCBrZXkpICYmIGVxKGFba2V5XSwgYltrZXldLCBhU3RhY2ssIGJTdGFjaykpKSBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgICAgLy8gRW5zdXJlIHRoYXQgYm90aCBvYmplY3RzIGNvbnRhaW4gdGhlIHNhbWUgbnVtYmVyIG9mIHByb3BlcnRpZXMuCiAgICAgIGlmIChyZXN1bHQpIHsKICAgICAgICBmb3IgKGtleSBpbiBiKSB7CiAgICAgICAgICBpZiAoXy5oYXMoYiwga2V5KSAmJiAhKHNpemUtLSkpIGJyZWFrOwogICAgICAgIH0KICAgICAgICByZXN1bHQgPSAhc2l6ZTsKICAgICAgfQogICAgfQogICAgLy8gUmVtb3ZlIHRoZSBmaXJzdCBvYmplY3QgZnJvbSB0aGUgc3RhY2sgb2YgdHJhdmVyc2VkIG9iamVjdHMuCiAgICBhU3RhY2sucG9wKCk7CiAgICBiU3RhY2sucG9wKCk7CiAgICByZXR1cm4gcmVzdWx0OwogIH07CgogIC8vIFBlcmZvcm0gYSBkZWVwIGNvbXBhcmlzb24gdG8gY2hlY2sgaWYgdHdvIG9iamVjdHMgYXJlIGVxdWFsLgogIF8uaXNFcXVhbCA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgIHJldHVybiBlcShhLCBiLCBbXSwgW10pOwogIH07CgogIC8vIElzIGEgZ2l2ZW4gYXJyYXksIHN0cmluZywgb3Igb2JqZWN0IGVtcHR5PwogIC8vIEFuICJlbXB0eSIgb2JqZWN0IGhhcyBubyBlbnVtZXJhYmxlIG93bi1wcm9wZXJ0aWVzLgogIF8uaXNFbXB0eSA9IGZ1bmN0aW9uKG9iaikgewogICAgaWYgKG9iaiA9PSBudWxsKSByZXR1cm4gdHJ1ZTsKICAgIGlmIChfLmlzQXJyYXkob2JqKSB8fCBfLmlzU3RyaW5nKG9iaikpIHJldHVybiBvYmoubGVuZ3RoID09PSAwOwogICAgZm9yICh2YXIga2V5IGluIG9iaikgaWYgKF8uaGFzKG9iaiwga2V5KSkgcmV0dXJuIGZhbHNlOwogICAgcmV0dXJuIHRydWU7CiAgfTsKCiAgLy8gSXMgYSBnaXZlbiB2YWx1ZSBhIERPTSBlbGVtZW50PwogIF8uaXNFbGVtZW50ID0gZnVuY3Rpb24ob2JqKSB7CiAgICByZXR1cm4gISEob2JqICYmIG9iai5ub2RlVHlwZSA9PT0gMSk7CiAgfTsKCiAgLy8gSXMgYSBnaXZlbiB2YWx1ZSBhbiBhcnJheT8KICAvLyBEZWxlZ2F0ZXMgdG8gRUNNQTUncyBuYXRpdmUgQXJyYXkuaXNBcnJheQogIF8uaXNBcnJheSA9IG5hdGl2ZUlzQXJyYXkgfHwgZnVuY3Rpb24ob2JqKSB7CiAgICByZXR1cm4gdG9TdHJpbmcuY2FsbChvYmopID09ICdbb2JqZWN0IEFycmF5XSc7CiAgfTsKCiAgLy8gSXMgYSBnaXZlbiB2YXJpYWJsZSBhbiBvYmplY3Q/CiAgXy5pc09iamVjdCA9IGZ1bmN0aW9uKG9iaikgewogICAgcmV0dXJuIG9iaiA9PT0gT2JqZWN0KG9iaik7CiAgfTsKCiAgLy8gQWRkIHNvbWUgaXNUeXBlIG1ldGhvZHM6IGlzQXJndW1lbnRzLCBpc0Z1bmN0aW9uLCBpc1N0cmluZywgaXNOdW1iZXIsIGlzRGF0ZSwgaXNSZWdFeHAuCiAgZWFjaChbJ0FyZ3VtZW50cycsICdGdW5jdGlvbicsICdTdHJpbmcnLCAnTnVtYmVyJywgJ0RhdGUnLCAnUmVnRXhwJ10sIGZ1bmN0aW9uKG5hbWUpIHsKICAgIF9bJ2lzJyArIG5hbWVdID0gZnVuY3Rpb24ob2JqKSB7CiAgICAgIHJldHVybiB0b1N0cmluZy5jYWxsKG9iaikgPT0gJ1tvYmplY3QgJyArIG5hbWUgKyAnXSc7CiAgICB9OwogIH0pOwoKICAvLyBEZWZpbmUgYSBmYWxsYmFjayB2ZXJzaW9uIG9mIHRoZSBtZXRob2QgaW4gYnJvd3NlcnMgKGFoZW0sIElFKSwgd2hlcmUKICAvLyB0aGVyZSBpc24ndCBhbnkgaW5zcGVjdGFibGUgIkFyZ3VtZW50cyIgdHlwZS4KICBpZiAoIV8uaXNBcmd1bWVudHMoYXJndW1lbnRzKSkgewogICAgXy5pc0FyZ3VtZW50cyA9IGZ1bmN0aW9uKG9iaikgewogICAgICByZXR1cm4gISEob2JqICYmIF8uaGFzKG9iaiwgJ2NhbGxlZScpKTsKICAgIH07CiAgfQoKICAvLyBPcHRpbWl6ZSBgaXNGdW5jdGlvbmAgaWYgYXBwcm9wcmlhdGUuCiAgaWYgKHR5cGVvZiAoLy4vKSAhPT0gJ2Z1bmN0aW9uJykgewogICAgXy5pc0Z1bmN0aW9uID0gZnVuY3Rpb24ob2JqKSB7CiAgICAgIHJldHVybiB0eXBlb2Ygb2JqID09PSAnZnVuY3Rpb24nOwogICAgfTsKICB9CgogIC8vIElzIGEgZ2l2ZW4gb2JqZWN0IGEgZmluaXRlIG51bWJlcj8KICBfLmlzRmluaXRlID0gZnVuY3Rpb24ob2JqKSB7CiAgICByZXR1cm4gaXNGaW5pdGUob2JqKSAmJiAhaXNOYU4ocGFyc2VGbG9hdChvYmopKTsKICB9OwoKICAvLyBJcyB0aGUgZ2l2ZW4gdmFsdWUgYE5hTmA/IChOYU4gaXMgdGhlIG9ubHkgbnVtYmVyIHdoaWNoIGRvZXMgbm90IGVxdWFsIGl0c2VsZikuCiAgXy5pc05hTiA9IGZ1bmN0aW9uKG9iaikgewogICAgcmV0dXJuIF8uaXNOdW1iZXIob2JqKSAmJiBvYmogIT0gK29iajsKICB9OwoKICAvLyBJcyBhIGdpdmVuIHZhbHVlIGEgYm9vbGVhbj8KICBfLmlzQm9vbGVhbiA9IGZ1bmN0aW9uKG9iaikgewogICAgcmV0dXJuIG9iaiA9PT0gdHJ1ZSB8fCBvYmogPT09IGZhbHNlIHx8IHRvU3RyaW5nLmNhbGwob2JqKSA9PSAnW29iamVjdCBCb29sZWFuXSc7CiAgfTsKCiAgLy8gSXMgYSBnaXZlbiB2YWx1ZSBlcXVhbCB0byBudWxsPwogIF8uaXNOdWxsID0gZnVuY3Rpb24ob2JqKSB7CiAgICByZXR1cm4gb2JqID09PSBudWxsOwogIH07CgogIC8vIElzIGEgZ2l2ZW4gdmFyaWFibGUgdW5kZWZpbmVkPwogIF8uaXNVbmRlZmluZWQgPSBmdW5jdGlvbihvYmopIHsKICAgIHJldHVybiBvYmogPT09IHZvaWQgMDsKICB9OwoKICAvLyBTaG9ydGN1dCBmdW5jdGlvbiBmb3IgY2hlY2tpbmcgaWYgYW4gb2JqZWN0IGhhcyBhIGdpdmVuIHByb3BlcnR5IGRpcmVjdGx5CiAgLy8gb24gaXRzZWxmIChpbiBvdGhlciB3b3Jkcywgbm90IG9uIGEgcHJvdG90eXBlKS4KICBfLmhhcyA9IGZ1bmN0aW9uKG9iaiwga2V5KSB7CiAgICByZXR1cm4gaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSk7CiAgfTsKCiAgLy8gVXRpbGl0eSBGdW5jdGlvbnMKICAvLyAtLS0tLS0tLS0tLS0tLS0tLQoKICAvLyBSdW4gVW5kZXJzY29yZS5qcyBpbiAqbm9Db25mbGljdCogbW9kZSwgcmV0dXJuaW5nIHRoZSBgX2AgdmFyaWFibGUgdG8gaXRzCiAgLy8gcHJldmlvdXMgb3duZXIuIFJldHVybnMgYSByZWZlcmVuY2UgdG8gdGhlIFVuZGVyc2NvcmUgb2JqZWN0LgogIF8ubm9Db25mbGljdCA9IGZ1bmN0aW9uKCkgewogICAgcm9vdC5fID0gcHJldmlvdXNVbmRlcnNjb3JlOwogICAgcmV0dXJuIHRoaXM7CiAgfTsKCiAgLy8gS2VlcCB0aGUgaWRlbnRpdHkgZnVuY3Rpb24gYXJvdW5kIGZvciBkZWZhdWx0IGl0ZXJhdG9ycy4KICBfLmlkZW50aXR5ID0gZnVuY3Rpb24odmFsdWUpIHsKICAgIHJldHVybiB2YWx1ZTsKICB9OwoKICBfLmNvbnN0YW50ID0gZnVuY3Rpb24odmFsdWUpIHsKICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH07CiAgfTsKCiAgXy5wcm9wZXJ0eSA9IGZ1bmN0aW9uKGtleSkgewogICAgcmV0dXJuIGZ1bmN0aW9uKG9iaikgewogICAgICByZXR1cm4gb2JqW2tleV07CiAgICB9OwogIH07CgogIC8vIFJldHVybnMgYSBwcmVkaWNhdGUgZm9yIGNoZWNraW5nIHdoZXRoZXIgYW4gb2JqZWN0IGhhcyBhIGdpdmVuIHNldCBvZiBga2V5OnZhbHVlYCBwYWlycy4KICBfLm1hdGNoZXMgPSBmdW5jdGlvbihhdHRycykgewogICAgcmV0dXJuIGZ1bmN0aW9uKG9iaikgewogICAgICBpZiAob2JqID09PSBhdHRycykgcmV0dXJuIHRydWU7IC8vYXZvaWQgY29tcGFyaW5nIGFuIG9iamVjdCB0byBpdHNlbGYuCiAgICAgIGZvciAodmFyIGtleSBpbiBhdHRycykgewogICAgICAgIGlmIChhdHRyc1trZXldICE9PSBvYmpba2V5XSkKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICB9OwoKICAvLyBSdW4gYSBmdW5jdGlvbiAqKm4qKiB0aW1lcy4KICBfLnRpbWVzID0gZnVuY3Rpb24obiwgaXRlcmF0b3IsIGNvbnRleHQpIHsKICAgIHZhciBhY2N1bSA9IEFycmF5KE1hdGgubWF4KDAsIG4pKTsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbjsgaSsrKSBhY2N1bVtpXSA9IGl0ZXJhdG9yLmNhbGwoY29udGV4dCwgaSk7CiAgICByZXR1cm4gYWNjdW07CiAgfTsKCiAgLy8gUmV0dXJuIGEgcmFuZG9tIGludGVnZXIgYmV0d2VlbiBtaW4gYW5kIG1heCAoaW5jbHVzaXZlKS4KICBfLnJhbmRvbSA9IGZ1bmN0aW9uKG1pbiwgbWF4KSB7CiAgICBpZiAobWF4ID09IG51bGwpIHsKICAgICAgbWF4ID0gbWluOwogICAgICBtaW4gPSAwOwogICAgfQogICAgcmV0dXJuIG1pbiArIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChtYXggLSBtaW4gKyAxKSk7CiAgfTsKCiAgLy8gQSAocG9zc2libHkgZmFzdGVyKSB3YXkgdG8gZ2V0IHRoZSBjdXJyZW50IHRpbWVzdGFtcCBhcyBhbiBpbnRlZ2VyLgogIF8ubm93ID0gRGF0ZS5ub3cgfHwgZnVuY3Rpb24oKSB7IHJldHVybiBuZXcgRGF0ZSgpLmdldFRpbWUoKTsgfTsKCiAgLy8gTGlzdCBvZiBIVE1MIGVudGl0aWVzIGZvciBlc2NhcGluZy4KICB2YXIgZW50aXR5TWFwID0gewogICAgZXNjYXBlOiB7CiAgICAgICcmJzogJyZhbXA7JywKICAgICAgJzwnOiAnJmx0OycsCiAgICAgICc+JzogJyZndDsnLAogICAgICAnIic6ICcmcXVvdDsnLAogICAgICAiJyI6ICcmI3gyNzsnCiAgICB9CiAgfTsKICBlbnRpdHlNYXAudW5lc2NhcGUgPSBfLmludmVydChlbnRpdHlNYXAuZXNjYXBlKTsKCiAgLy8gUmVnZXhlcyBjb250YWluaW5nIHRoZSBrZXlzIGFuZCB2YWx1ZXMgbGlzdGVkIGltbWVkaWF0ZWx5IGFib3ZlLgogIHZhciBlbnRpdHlSZWdleGVzID0gewogICAgZXNjYXBlOiAgIG5ldyBSZWdFeHAoJ1snICsgXy5rZXlzKGVudGl0eU1hcC5lc2NhcGUpLmpvaW4oJycpICsgJ10nLCAnZycpLAogICAgdW5lc2NhcGU6IG5ldyBSZWdFeHAoJygnICsgXy5rZXlzKGVudGl0eU1hcC51bmVzY2FwZSkuam9pbignfCcpICsgJyknLCAnZycpCiAgfTsKCiAgLy8gRnVuY3Rpb25zIGZvciBlc2NhcGluZyBhbmQgdW5lc2NhcGluZyBzdHJpbmdzIHRvL2Zyb20gSFRNTCBpbnRlcnBvbGF0aW9uLgogIF8uZWFjaChbJ2VzY2FwZScsICd1bmVzY2FwZSddLCBmdW5jdGlvbihtZXRob2QpIHsKICAgIF9bbWV0aG9kXSA9IGZ1bmN0aW9uKHN0cmluZykgewogICAgICBpZiAoc3RyaW5nID09IG51bGwpIHJldHVybiAnJzsKICAgICAgcmV0dXJuICgnJyArIHN0cmluZykucmVwbGFjZShlbnRpdHlSZWdleGVzW21ldGhvZF0sIGZ1bmN0aW9uKG1hdGNoKSB7CiAgICAgICAgcmV0dXJuIGVudGl0eU1hcFttZXRob2RdW21hdGNoXTsKICAgICAgfSk7CiAgICB9OwogIH0pOwoKICAvLyBJZiB0aGUgdmFsdWUgb2YgdGhlIG5hbWVkIGBwcm9wZXJ0eWAgaXMgYSBmdW5jdGlvbiB0aGVuIGludm9rZSBpdCB3aXRoIHRoZQogIC8vIGBvYmplY3RgIGFzIGNvbnRleHQ7IG90aGVyd2lzZSwgcmV0dXJuIGl0LgogIF8ucmVzdWx0ID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgewogICAgaWYgKG9iamVjdCA9PSBudWxsKSByZXR1cm4gdm9pZCAwOwogICAgdmFyIHZhbHVlID0gb2JqZWN0W3Byb3BlcnR5XTsKICAgIHJldHVybiBfLmlzRnVuY3Rpb24odmFsdWUpID8gdmFsdWUuY2FsbChvYmplY3QpIDogdmFsdWU7CiAgfTsKCiAgLy8gQWRkIHlvdXIgb3duIGN1c3RvbSBmdW5jdGlvbnMgdG8gdGhlIFVuZGVyc2NvcmUgb2JqZWN0LgogIF8ubWl4aW4gPSBmdW5jdGlvbihvYmopIHsKICAgIGVhY2goXy5mdW5jdGlvbnMob2JqKSwgZnVuY3Rpb24obmFtZSkgewogICAgICB2YXIgZnVuYyA9IF9bbmFtZV0gPSBvYmpbbmFtZV07CiAgICAgIF8ucHJvdG90eXBlW25hbWVdID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGFyZ3MgPSBbdGhpcy5fd3JhcHBlZF07CiAgICAgICAgcHVzaC5hcHBseShhcmdzLCBhcmd1bWVudHMpOwogICAgICAgIHJldHVybiByZXN1bHQuY2FsbCh0aGlzLCBmdW5jLmFwcGx5KF8sIGFyZ3MpKTsKICAgICAgfTsKICAgIH0pOwogIH07CgogIC8vIEdlbmVyYXRlIGEgdW5pcXVlIGludGVnZXIgaWQgKHVuaXF1ZSB3aXRoaW4gdGhlIGVudGlyZSBjbGllbnQgc2Vzc2lvbikuCiAgLy8gVXNlZnVsIGZvciB0ZW1wb3JhcnkgRE9NIGlkcy4KICB2YXIgaWRDb3VudGVyID0gMDsKICBfLnVuaXF1ZUlkID0gZnVuY3Rpb24ocHJlZml4KSB7CiAgICB2YXIgaWQgPSArK2lkQ291bnRlciArICcnOwogICAgcmV0dXJuIHByZWZpeCA/IHByZWZpeCArIGlkIDogaWQ7CiAgfTsKCiAgLy8gQnkgZGVmYXVsdCwgVW5kZXJzY29yZSB1c2VzIEVSQi1zdHlsZSB0ZW1wbGF0ZSBkZWxpbWl0ZXJzLCBjaGFuZ2UgdGhlCiAgLy8gZm9sbG93aW5nIHRlbXBsYXRlIHNldHRpbmdzIHRvIHVzZSBhbHRlcm5hdGl2ZSBkZWxpbWl0ZXJzLgogIF8udGVtcGxhdGVTZXR0aW5ncyA9IHsKICAgIGV2YWx1YXRlICAgIDogLzwlKFtcc1xTXSs/KSU+L2csCiAgICBpbnRlcnBvbGF0ZSA6IC88JT0oW1xzXFNdKz8pJT4vZywKICAgIGVzY2FwZSAgICAgIDogLzwlLShbXHNcU10rPyklPi9nCiAgfTsKCiAgLy8gV2hlbiBjdXN0b21pemluZyBgdGVtcGxhdGVTZXR0aW5nc2AsIGlmIHlvdSBkb24ndCB3YW50IHRvIGRlZmluZSBhbgogIC8vIGludGVycG9sYXRpb24sIGV2YWx1YXRpb24gb3IgZXNjYXBpbmcgcmVnZXgsIHdlIG5lZWQgb25lIHRoYXQgaXMKICAvLyBndWFyYW50ZWVkIG5vdCB0byBtYXRjaC4KICB2YXIgbm9NYXRjaCA9IC8oLileLzsKCiAgLy8gQ2VydGFpbiBjaGFyYWN0ZXJzIG5lZWQgdG8gYmUgZXNjYXBlZCBzbyB0aGF0IHRoZXkgY2FuIGJlIHB1dCBpbnRvIGEKICAvLyBzdHJpbmcgbGl0ZXJhbC4KICB2YXIgZXNjYXBlcyA9IHsKICAgICInIjogICAgICAiJyIsCiAgICAnXFwnOiAgICAgJ1xcJywKICAgICdccic6ICAgICAncicsCiAgICAnXG4nOiAgICAgJ24nLAogICAgJ1x0JzogICAgICd0JywKICAgICdcdTIwMjgnOiAndTIwMjgnLAogICAgJ1x1MjAyOSc6ICd1MjAyOScKICB9OwoKICB2YXIgZXNjYXBlciA9IC9cXHwnfFxyfFxufFx0fFx1MjAyOHxcdTIwMjkvZzsKCiAgLy8gSmF2YVNjcmlwdCBtaWNyby10ZW1wbGF0aW5nLCBzaW1pbGFyIHRvIEpvaG4gUmVzaWcncyBpbXBsZW1lbnRhdGlvbi4KICAvLyBVbmRlcnNjb3JlIHRlbXBsYXRpbmcgaGFuZGxlcyBhcmJpdHJhcnkgZGVsaW1pdGVycywgcHJlc2VydmVzIHdoaXRlc3BhY2UsCiAgLy8gYW5kIGNvcnJlY3RseSBlc2NhcGVzIHF1b3RlcyB3aXRoaW4gaW50ZXJwb2xhdGVkIGNvZGUuCiAgXy50ZW1wbGF0ZSA9IGZ1bmN0aW9uKHRleHQsIGRhdGEsIHNldHRpbmdzKSB7CiAgICB2YXIgcmVuZGVyOwogICAgc2V0dGluZ3MgPSBfLmRlZmF1bHRzKHt9LCBzZXR0aW5ncywgXy50ZW1wbGF0ZVNldHRpbmdzKTsKCiAgICAvLyBDb21iaW5lIGRlbGltaXRlcnMgaW50byBvbmUgcmVndWxhciBleHByZXNzaW9uIHZpYSBhbHRlcm5hdGlvbi4KICAgIHZhciBtYXRjaGVyID0gbmV3IFJlZ0V4cChbCiAgICAgIChzZXR0aW5ncy5lc2NhcGUgfHwgbm9NYXRjaCkuc291cmNlLAogICAgICAoc2V0dGluZ3MuaW50ZXJwb2xhdGUgfHwgbm9NYXRjaCkuc291cmNlLAogICAgICAoc2V0dGluZ3MuZXZhbHVhdGUgfHwgbm9NYXRjaCkuc291cmNlCiAgICBdLmpvaW4oJ3wnKSArICd8JCcsICdnJyk7CgogICAgLy8gQ29tcGlsZSB0aGUgdGVtcGxhdGUgc291cmNlLCBlc2NhcGluZyBzdHJpbmcgbGl0ZXJhbHMgYXBwcm9wcmlhdGVseS4KICAgIHZhciBpbmRleCA9IDA7CiAgICB2YXIgc291cmNlID0gIl9fcCs9JyI7CiAgICB0ZXh0LnJlcGxhY2UobWF0Y2hlciwgZnVuY3Rpb24obWF0Y2gsIGVzY2FwZSwgaW50ZXJwb2xhdGUsIGV2YWx1YXRlLCBvZmZzZXQpIHsKICAgICAgc291cmNlICs9IHRleHQuc2xpY2UoaW5kZXgsIG9mZnNldCkKICAgICAgICAucmVwbGFjZShlc2NhcGVyLCBmdW5jdGlvbihtYXRjaCkgeyByZXR1cm4gJ1xcJyArIGVzY2FwZXNbbWF0Y2hdOyB9KTsKCiAgICAgIGlmIChlc2NhcGUpIHsKICAgICAgICBzb3VyY2UgKz0gIicrXG4oKF9fdD0oIiArIGVzY2FwZSArICIpKT09bnVsbD8nJzpfLmVzY2FwZShfX3QpKStcbiciOwogICAgICB9CiAgICAgIGlmIChpbnRlcnBvbGF0ZSkgewogICAgICAgIHNvdXJjZSArPSAiJytcbigoX190PSgiICsgaW50ZXJwb2xhdGUgKyAiKSk9PW51bGw/Jyc6X190KStcbiciOwogICAgICB9CiAgICAgIGlmIChldmFsdWF0ZSkgewogICAgICAgIHNvdXJjZSArPSAiJztcbiIgKyBldmFsdWF0ZSArICJcbl9fcCs9JyI7CiAgICAgIH0KICAgICAgaW5kZXggPSBvZmZzZXQgKyBtYXRjaC5sZW5ndGg7CiAgICAgIHJldHVybiBtYXRjaDsKICAgIH0pOwogICAgc291cmNlICs9ICInO1xuIjsKCiAgICAvLyBJZiBhIHZhcmlhYmxlIGlzIG5vdCBzcGVjaWZpZWQsIHBsYWNlIGRhdGEgdmFsdWVzIGluIGxvY2FsIHNjb3BlLgogICAgaWYgKCFzZXR0aW5ncy52YXJpYWJsZSkgc291cmNlID0gJ3dpdGgob2JqfHx7fSl7XG4nICsgc291cmNlICsgJ31cbic7CgogICAgc291cmNlID0gInZhciBfX3QsX19wPScnLF9faj1BcnJheS5wcm90b3R5cGUuam9pbiwiICsKICAgICAgInByaW50PWZ1bmN0aW9uKCl7X19wKz1fX2ouY2FsbChhcmd1bWVudHMsJycpO307XG4iICsKICAgICAgc291cmNlICsgInJldHVybiBfX3A7XG4iOwoKICAgIHRyeSB7CiAgICAgIHJlbmRlciA9IG5ldyBGdW5jdGlvbihzZXR0aW5ncy52YXJpYWJsZSB8fCAnb2JqJywgJ18nLCBzb3VyY2UpOwogICAgfSBjYXRjaCAoZSkgewogICAgICBlLnNvdXJjZSA9IHNvdXJjZTsKICAgICAgdGhyb3cgZTsKICAgIH0KCiAgICBpZiAoZGF0YSkgcmV0dXJuIHJlbmRlcihkYXRhLCBfKTsKICAgIHZhciB0ZW1wbGF0ZSA9IGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgcmV0dXJuIHJlbmRlci5jYWxsKHRoaXMsIGRhdGEsIF8pOwogICAgfTsKCiAgICAvLyBQcm92aWRlIHRoZSBjb21waWxlZCBmdW5jdGlvbiBzb3VyY2UgYXMgYSBjb252ZW5pZW5jZSBmb3IgcHJlY29tcGlsYXRpb24uCiAgICB0ZW1wbGF0ZS5zb3VyY2UgPSAnZnVuY3Rpb24oJyArIChzZXR0aW5ncy52YXJpYWJsZSB8fCAnb2JqJykgKyAnKXtcbicgKyBzb3VyY2UgKyAnfSc7CgogICAgcmV0dXJuIHRlbXBsYXRlOwogIH07CgogIC8vIEFkZCBhICJjaGFpbiIgZnVuY3Rpb24sIHdoaWNoIHdpbGwgZGVsZWdhdGUgdG8gdGhlIHdyYXBwZXIuCiAgXy5jaGFpbiA9IGZ1bmN0aW9uKG9iaikgewogICAgcmV0dXJuIF8ob2JqKS5jaGFpbigpOwogIH07CgogIC8vIE9PUAogIC8vIC0tLS0tLS0tLS0tLS0tLQogIC8vIElmIFVuZGVyc2NvcmUgaXMgY2FsbGVkIGFzIGEgZnVuY3Rpb24sIGl0IHJldHVybnMgYSB3cmFwcGVkIG9iamVjdCB0aGF0CiAgLy8gY2FuIGJlIHVzZWQgT08tc3R5bGUuIFRoaXMgd3JhcHBlciBob2xkcyBhbHRlcmVkIHZlcnNpb25zIG9mIGFsbCB0aGUKICAvLyB1bmRlcnNjb3JlIGZ1bmN0aW9ucy4gV3JhcHBlZCBvYmplY3RzIG1heSBiZSBjaGFpbmVkLgoKICAvLyBIZWxwZXIgZnVuY3Rpb24gdG8gY29udGludWUgY2hhaW5pbmcgaW50ZXJtZWRpYXRlIHJlc3VsdHMuCiAgdmFyIHJlc3VsdCA9IGZ1bmN0aW9uKG9iaikgewogICAgcmV0dXJuIHRoaXMuX2NoYWluID8gXyhvYmopLmNoYWluKCkgOiBvYmo7CiAgfTsKCiAgLy8gQWRkIGFsbCBvZiB0aGUgVW5kZXJzY29yZSBmdW5jdGlvbnMgdG8gdGhlIHdyYXBwZXIgb2JqZWN0LgogIF8ubWl4aW4oXyk7CgogIC8vIEFkZCBhbGwgbXV0YXRvciBBcnJheSBmdW5jdGlvbnMgdG8gdGhlIHdyYXBwZXIuCiAgZWFjaChbJ3BvcCcsICdwdXNoJywgJ3JldmVyc2UnLCAnc2hpZnQnLCAnc29ydCcsICdzcGxpY2UnLCAndW5zaGlmdCddLCBmdW5jdGlvbihuYW1lKSB7CiAgICB2YXIgbWV0aG9kID0gQXJyYXlQcm90b1tuYW1lXTsKICAgIF8ucHJvdG90eXBlW25hbWVdID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBvYmogPSB0aGlzLl93cmFwcGVkOwogICAgICBtZXRob2QuYXBwbHkob2JqLCBhcmd1bWVudHMpOwogICAgICBpZiAoKG5hbWUgPT0gJ3NoaWZ0JyB8fCBuYW1lID09ICdzcGxpY2UnKSAmJiBvYmoubGVuZ3RoID09PSAwKSBkZWxldGUgb2JqWzBdOwogICAgICByZXR1cm4gcmVzdWx0LmNhbGwodGhpcywgb2JqKTsKICAgIH07CiAgfSk7CgogIC8vIEFkZCBhbGwgYWNjZXNzb3IgQXJyYXkgZnVuY3Rpb25zIHRvIHRoZSB3cmFwcGVyLgogIGVhY2goWydjb25jYXQnLCAnam9pbicsICdzbGljZSddLCBmdW5jdGlvbihuYW1lKSB7CiAgICB2YXIgbWV0aG9kID0gQXJyYXlQcm90b1tuYW1lXTsKICAgIF8ucHJvdG90eXBlW25hbWVdID0gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiByZXN1bHQuY2FsbCh0aGlzLCBtZXRob2QuYXBwbHkodGhpcy5fd3JhcHBlZCwgYXJndW1lbnRzKSk7CiAgICB9OwogIH0pOwoKICBfLmV4dGVuZChfLnByb3RvdHlwZSwgewoKICAgIC8vIFN0YXJ0IGNoYWluaW5nIGEgd3JhcHBlZCBVbmRlcnNjb3JlIG9iamVjdC4KICAgIGNoYWluOiBmdW5jdGlvbigpIHsKICAgICAgdGhpcy5fY2hhaW4gPSB0cnVlOwogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLy8gRXh0cmFjdHMgdGhlIHJlc3VsdCBmcm9tIGEgd3JhcHBlZCBhbmQgY2hhaW5lZCBvYmplY3QuCiAgICB2YWx1ZTogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiB0aGlzLl93cmFwcGVkOwogICAgfQoKICB9KTsKCiAgLy8gQU1EIHJlZ2lzdHJhdGlvbiBoYXBwZW5zIGF0IHRoZSBlbmQgZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBBTUQgbG9hZGVycwogIC8vIHRoYXQgbWF5IG5vdCBlbmZvcmNlIG5leHQtdHVybiBzZW1hbnRpY3Mgb24gbW9kdWxlcy4gRXZlbiB0aG91Z2ggZ2VuZXJhbAogIC8vIHByYWN0aWNlIGZvciBBTUQgcmVnaXN0cmF0aW9uIGlzIHRvIGJlIGFub255bW91cywgdW5kZXJzY29yZSByZWdpc3RlcnMKICAvLyBhcyBhIG5hbWVkIG1vZHVsZSBiZWNhdXNlLCBsaWtlIGpRdWVyeSwgaXQgaXMgYSBiYXNlIGxpYnJhcnkgdGhhdCBpcwogIC8vIHBvcHVsYXIgZW5vdWdoIHRvIGJlIGJ1bmRsZWQgaW4gYSB0aGlyZCBwYXJ0eSBsaWIsIGJ1dCBub3QgYmUgcGFydCBvZgogIC8vIGFuIEFNRCBsb2FkIHJlcXVlc3QuIFRob3NlIGNhc2VzIGNvdWxkIGdlbmVyYXRlIGFuIGVycm9yIHdoZW4gYW4KICAvLyBhbm9ueW1vdXMgZGVmaW5lKCkgaXMgY2FsbGVkIG91dHNpZGUgb2YgYSBsb2FkZXIgcmVxdWVzdC4KICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7CiAgICBkZWZpbmUoJ3VuZGVyc2NvcmUnLCBbXSwgZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBfOwogICAgfSk7CiAgfQp9KS5jYWxsKHRoaXMpOwoKLy8gICAgIEJhY2tib25lLmpzIDEuMS4yCgovLyAgICAgKGMpIDIwMTAtMjAxNCBKZXJlbXkgQXNoa2VuYXMsIERvY3VtZW50Q2xvdWQgYW5kIEludmVzdGlnYXRpdmUgUmVwb3J0ZXJzICYgRWRpdG9ycwovLyAgICAgQmFja2JvbmUgbWF5IGJlIGZyZWVseSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UuCi8vICAgICBGb3IgYWxsIGRldGFpbHMgYW5kIGRvY3VtZW50YXRpb246Ci8vICAgICBodHRwOi8vYmFja2JvbmVqcy5vcmcKCihmdW5jdGlvbihyb290LCBmYWN0b3J5KSB7CgogIC8vIFNldCB1cCBCYWNrYm9uZSBhcHByb3ByaWF0ZWx5IGZvciB0aGUgZW52aXJvbm1lbnQuIFN0YXJ0IHdpdGggQU1ELgogIGlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHsKICAgIGRlZmluZSgnYmFja2JvbmUnLFsndW5kZXJzY29yZScsICdqcXVlcnknLCAnZXhwb3J0cyddLCBmdW5jdGlvbihfLCAkLCBleHBvcnRzKSB7CiAgICAgIC8vIEV4cG9ydCBnbG9iYWwgZXZlbiBpbiBBTUQgY2FzZSBpbiBjYXNlIHRoaXMgc2NyaXB0IGlzIGxvYWRlZCB3aXRoCiAgICAgIC8vIG90aGVycyB0aGF0IG1heSBzdGlsbCBleHBlY3QgYSBnbG9iYWwgQmFja2JvbmUuCiAgICAgIHJvb3QuQmFja2JvbmUgPSBmYWN0b3J5KHJvb3QsIGV4cG9ydHMsIF8sICQpOwogICAgfSk7CgogIC8vIE5leHQgZm9yIE5vZGUuanMgb3IgQ29tbW9uSlMuIGpRdWVyeSBtYXkgbm90IGJlIG5lZWRlZCBhcyBhIG1vZHVsZS4KICB9IGVsc2UgaWYgKHR5cGVvZiBleHBvcnRzICE9PSAndW5kZWZpbmVkJykgewogICAgdmFyIF8gPSByZXF1aXJlKCd1bmRlcnNjb3JlJyk7CiAgICBmYWN0b3J5KHJvb3QsIGV4cG9ydHMsIF8pOwoKICAvLyBGaW5hbGx5LCBhcyBhIGJyb3dzZXIgZ2xvYmFsLgogIH0gZWxzZSB7CiAgICByb290LkJhY2tib25lID0gZmFjdG9yeShyb290LCB7fSwgcm9vdC5fLCAocm9vdC5qUXVlcnkgfHwgcm9vdC5aZXB0byB8fCByb290LmVuZGVyIHx8IHJvb3QuJCkpOwogIH0KCn0odGhpcywgZnVuY3Rpb24ocm9vdCwgQmFja2JvbmUsIF8sICQpIHsKCiAgLy8gSW5pdGlhbCBTZXR1cAogIC8vIC0tLS0tLS0tLS0tLS0KCiAgLy8gU2F2ZSB0aGUgcHJldmlvdXMgdmFsdWUgb2YgdGhlIGBCYWNrYm9uZWAgdmFyaWFibGUsIHNvIHRoYXQgaXQgY2FuIGJlCiAgLy8gcmVzdG9yZWQgbGF0ZXIgb24sIGlmIGBub0NvbmZsaWN0YCBpcyB1c2VkLgogIHZhciBwcmV2aW91c0JhY2tib25lID0gcm9vdC5CYWNrYm9uZTsKCiAgLy8gQ3JlYXRlIGxvY2FsIHJlZmVyZW5jZXMgdG8gYXJyYXkgbWV0aG9kcyB3ZSdsbCB3YW50IHRvIHVzZSBsYXRlci4KICB2YXIgYXJyYXkgPSBbXTsKICB2YXIgcHVzaCA9IGFycmF5LnB1c2g7CiAgdmFyIHNsaWNlID0gYXJyYXkuc2xpY2U7CiAgdmFyIHNwbGljZSA9IGFycmF5LnNwbGljZTsKCiAgLy8gQ3VycmVudCB2ZXJzaW9uIG9mIHRoZSBsaWJyYXJ5LiBLZWVwIGluIHN5bmMgd2l0aCBgcGFja2FnZS5qc29uYC4KICBCYWNrYm9uZS5WRVJTSU9OID0gJzEuMS4yJzsKCiAgLy8gRm9yIEJhY2tib25lJ3MgcHVycG9zZXMsIGpRdWVyeSwgWmVwdG8sIEVuZGVyLCBvciBNeSBMaWJyYXJ5IChraWRkaW5nKSBvd25zCiAgLy8gdGhlIGAkYCB2YXJpYWJsZS4KICBCYWNrYm9uZS4kID0gJDsKCiAgLy8gUnVucyBCYWNrYm9uZS5qcyBpbiAqbm9Db25mbGljdCogbW9kZSwgcmV0dXJuaW5nIHRoZSBgQmFja2JvbmVgIHZhcmlhYmxlCiAgLy8gdG8gaXRzIHByZXZpb3VzIG93bmVyLiBSZXR1cm5zIGEgcmVmZXJlbmNlIHRvIHRoaXMgQmFja2JvbmUgb2JqZWN0LgogIEJhY2tib25lLm5vQ29uZmxpY3QgPSBmdW5jdGlvbigpIHsKICAgIHJvb3QuQmFja2JvbmUgPSBwcmV2aW91c0JhY2tib25lOwogICAgcmV0dXJuIHRoaXM7CiAgfTsKCiAgLy8gVHVybiBvbiBgZW11bGF0ZUhUVFBgIHRvIHN1cHBvcnQgbGVnYWN5IEhUVFAgc2VydmVycy4gU2V0dGluZyB0aGlzIG9wdGlvbgogIC8vIHdpbGwgZmFrZSBgIlBBVENIImAsIGAiUFVUImAgYW5kIGAiREVMRVRFImAgcmVxdWVzdHMgdmlhIHRoZSBgX21ldGhvZGAgcGFyYW1ldGVyIGFuZAogIC8vIHNldCBhIGBYLUh0dHAtTWV0aG9kLU92ZXJyaWRlYCBoZWFkZXIuCiAgQmFja2JvbmUuZW11bGF0ZUhUVFAgPSBmYWxzZTsKCiAgLy8gVHVybiBvbiBgZW11bGF0ZUpTT05gIHRvIHN1cHBvcnQgbGVnYWN5IHNlcnZlcnMgdGhhdCBjYW4ndCBkZWFsIHdpdGggZGlyZWN0CiAgLy8gYGFwcGxpY2F0aW9uL2pzb25gIHJlcXVlc3RzIC4uLiB3aWxsIGVuY29kZSB0aGUgYm9keSBhcwogIC8vIGBhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWRgIGluc3RlYWQgYW5kIHdpbGwgc2VuZCB0aGUgbW9kZWwgaW4gYQogIC8vIGZvcm0gcGFyYW0gbmFtZWQgYG1vZGVsYC4KICBCYWNrYm9uZS5lbXVsYXRlSlNPTiA9IGZhbHNlOwoKICAvLyBCYWNrYm9uZS5FdmVudHMKICAvLyAtLS0tLS0tLS0tLS0tLS0KCiAgLy8gQSBtb2R1bGUgdGhhdCBjYW4gYmUgbWl4ZWQgaW4gdG8gKmFueSBvYmplY3QqIGluIG9yZGVyIHRvIHByb3ZpZGUgaXQgd2l0aAogIC8vIGN1c3RvbSBldmVudHMuIFlvdSBtYXkgYmluZCB3aXRoIGBvbmAgb3IgcmVtb3ZlIHdpdGggYG9mZmAgY2FsbGJhY2sKICAvLyBmdW5jdGlvbnMgdG8gYW4gZXZlbnQ7IGB0cmlnZ2VyYC1pbmcgYW4gZXZlbnQgZmlyZXMgYWxsIGNhbGxiYWNrcyBpbgogIC8vIHN1Y2Nlc3Npb24uCiAgLy8KICAvLyAgICAgdmFyIG9iamVjdCA9IHt9OwogIC8vICAgICBfLmV4dGVuZChvYmplY3QsIEJhY2tib25lLkV2ZW50cyk7CiAgLy8gICAgIG9iamVjdC5vbignZXhwYW5kJywgZnVuY3Rpb24oKXsgYWxlcnQoJ2V4cGFuZGVkJyk7IH0pOwogIC8vICAgICBvYmplY3QudHJpZ2dlcignZXhwYW5kJyk7CiAgLy8KICB2YXIgRXZlbnRzID0gQmFja2JvbmUuRXZlbnRzID0gewoKICAgIC8vIEJpbmQgYW4gZXZlbnQgdG8gYSBgY2FsbGJhY2tgIGZ1bmN0aW9uLiBQYXNzaW5nIGAiYWxsImAgd2lsbCBiaW5kCiAgICAvLyB0aGUgY2FsbGJhY2sgdG8gYWxsIGV2ZW50cyBmaXJlZC4KICAgIG9uOiBmdW5jdGlvbihuYW1lLCBjYWxsYmFjaywgY29udGV4dCkgewogICAgICBpZiAoIWV2ZW50c0FwaSh0aGlzLCAnb24nLCBuYW1lLCBbY2FsbGJhY2ssIGNvbnRleHRdKSB8fCAhY2FsbGJhY2spIHJldHVybiB0aGlzOwogICAgICB0aGlzLl9ldmVudHMgfHwgKHRoaXMuX2V2ZW50cyA9IHt9KTsKICAgICAgdmFyIGV2ZW50cyA9IHRoaXMuX2V2ZW50c1tuYW1lXSB8fCAodGhpcy5fZXZlbnRzW25hbWVdID0gW10pOwogICAgICBldmVudHMucHVzaCh7Y2FsbGJhY2s6IGNhbGxiYWNrLCBjb250ZXh0OiBjb250ZXh0LCBjdHg6IGNvbnRleHQgfHwgdGhpc30pOwogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLy8gQmluZCBhbiBldmVudCB0byBvbmx5IGJlIHRyaWdnZXJlZCBhIHNpbmdsZSB0aW1lLiBBZnRlciB0aGUgZmlyc3QgdGltZQogICAgLy8gdGhlIGNhbGxiYWNrIGlzIGludm9rZWQsIGl0IHdpbGwgYmUgcmVtb3ZlZC4KICAgIG9uY2U6IGZ1bmN0aW9uKG5hbWUsIGNhbGxiYWNrLCBjb250ZXh0KSB7CiAgICAgIGlmICghZXZlbnRzQXBpKHRoaXMsICdvbmNlJywgbmFtZSwgW2NhbGxiYWNrLCBjb250ZXh0XSkgfHwgIWNhbGxiYWNrKSByZXR1cm4gdGhpczsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICB2YXIgb25jZSA9IF8ub25jZShmdW5jdGlvbigpIHsKICAgICAgICBzZWxmLm9mZihuYW1lLCBvbmNlKTsKICAgICAgICBjYWxsYmFjay5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9KTsKICAgICAgb25jZS5fY2FsbGJhY2sgPSBjYWxsYmFjazsKICAgICAgcmV0dXJuIHRoaXMub24obmFtZSwgb25jZSwgY29udGV4dCk7CiAgICB9LAoKICAgIC8vIFJlbW92ZSBvbmUgb3IgbWFueSBjYWxsYmFja3MuIElmIGBjb250ZXh0YCBpcyBudWxsLCByZW1vdmVzIGFsbAogICAgLy8gY2FsbGJhY2tzIHdpdGggdGhhdCBmdW5jdGlvbi4gSWYgYGNhbGxiYWNrYCBpcyBudWxsLCByZW1vdmVzIGFsbAogICAgLy8gY2FsbGJhY2tzIGZvciB0aGUgZXZlbnQuIElmIGBuYW1lYCBpcyBudWxsLCByZW1vdmVzIGFsbCBib3VuZAogICAgLy8gY2FsbGJhY2tzIGZvciBhbGwgZXZlbnRzLgogICAgb2ZmOiBmdW5jdGlvbihuYW1lLCBjYWxsYmFjaywgY29udGV4dCkgewogICAgICB2YXIgcmV0YWluLCBldiwgZXZlbnRzLCBuYW1lcywgaSwgbCwgaiwgazsKICAgICAgaWYgKCF0aGlzLl9ldmVudHMgfHwgIWV2ZW50c0FwaSh0aGlzLCAnb2ZmJywgbmFtZSwgW2NhbGxiYWNrLCBjb250ZXh0XSkpIHJldHVybiB0aGlzOwogICAgICBpZiAoIW5hbWUgJiYgIWNhbGxiYWNrICYmICFjb250ZXh0KSB7CiAgICAgICAgdGhpcy5fZXZlbnRzID0gdm9pZCAwOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIG5hbWVzID0gbmFtZSA/IFtuYW1lXSA6IF8ua2V5cyh0aGlzLl9ldmVudHMpOwogICAgICBmb3IgKGkgPSAwLCBsID0gbmFtZXMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgbmFtZSA9IG5hbWVzW2ldOwogICAgICAgIGlmIChldmVudHMgPSB0aGlzLl9ldmVudHNbbmFtZV0pIHsKICAgICAgICAgIHRoaXMuX2V2ZW50c1tuYW1lXSA9IHJldGFpbiA9IFtdOwogICAgICAgICAgaWYgKGNhbGxiYWNrIHx8IGNvbnRleHQpIHsKICAgICAgICAgICAgZm9yIChqID0gMCwgayA9IGV2ZW50cy5sZW5ndGg7IGogPCBrOyBqKyspIHsKICAgICAgICAgICAgICBldiA9IGV2ZW50c1tqXTsKICAgICAgICAgICAgICBpZiAoKGNhbGxiYWNrICYmIGNhbGxiYWNrICE9PSBldi5jYWxsYmFjayAmJiBjYWxsYmFjayAhPT0gZXYuY2FsbGJhY2suX2NhbGxiYWNrKSB8fAogICAgICAgICAgICAgICAgICAoY29udGV4dCAmJiBjb250ZXh0ICE9PSBldi5jb250ZXh0KSkgewogICAgICAgICAgICAgICAgcmV0YWluLnB1c2goZXYpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgaWYgKCFyZXRhaW4ubGVuZ3RoKSBkZWxldGUgdGhpcy5fZXZlbnRzW25hbWVdOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAoKICAgIC8vIFRyaWdnZXIgb25lIG9yIG1hbnkgZXZlbnRzLCBmaXJpbmcgYWxsIGJvdW5kIGNhbGxiYWNrcy4gQ2FsbGJhY2tzIGFyZQogICAgLy8gcGFzc2VkIHRoZSBzYW1lIGFyZ3VtZW50cyBhcyBgdHJpZ2dlcmAgaXMsIGFwYXJ0IGZyb20gdGhlIGV2ZW50IG5hbWUKICAgIC8vICh1bmxlc3MgeW91J3JlIGxpc3RlbmluZyBvbiBgImFsbCJgLCB3aGljaCB3aWxsIGNhdXNlIHlvdXIgY2FsbGJhY2sgdG8KICAgIC8vIHJlY2VpdmUgdGhlIHRydWUgbmFtZSBvZiB0aGUgZXZlbnQgYXMgdGhlIGZpcnN0IGFyZ3VtZW50KS4KICAgIHRyaWdnZXI6IGZ1bmN0aW9uKG5hbWUpIHsKICAgICAgaWYgKCF0aGlzLl9ldmVudHMpIHJldHVybiB0aGlzOwogICAgICB2YXIgYXJncyA9IHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKICAgICAgaWYgKCFldmVudHNBcGkodGhpcywgJ3RyaWdnZXInLCBuYW1lLCBhcmdzKSkgcmV0dXJuIHRoaXM7CiAgICAgIHZhciBldmVudHMgPSB0aGlzLl9ldmVudHNbbmFtZV07CiAgICAgIHZhciBhbGxFdmVudHMgPSB0aGlzLl9ldmVudHMuYWxsOwogICAgICBpZiAoZXZlbnRzKSB0cmlnZ2VyRXZlbnRzKGV2ZW50cywgYXJncyk7CiAgICAgIGlmIChhbGxFdmVudHMpIHRyaWdnZXJFdmVudHMoYWxsRXZlbnRzLCBhcmd1bWVudHMpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLy8gVGVsbCB0aGlzIG9iamVjdCB0byBzdG9wIGxpc3RlbmluZyB0byBlaXRoZXIgc3BlY2lmaWMgZXZlbnRzIC4uLiBvcgogICAgLy8gdG8gZXZlcnkgb2JqZWN0IGl0J3MgY3VycmVudGx5IGxpc3RlbmluZyB0by4KICAgIHN0b3BMaXN0ZW5pbmc6IGZ1bmN0aW9uKG9iaiwgbmFtZSwgY2FsbGJhY2spIHsKICAgICAgdmFyIGxpc3RlbmluZ1RvID0gdGhpcy5fbGlzdGVuaW5nVG87CiAgICAgIGlmICghbGlzdGVuaW5nVG8pIHJldHVybiB0aGlzOwogICAgICB2YXIgcmVtb3ZlID0gIW5hbWUgJiYgIWNhbGxiYWNrOwogICAgICBpZiAoIWNhbGxiYWNrICYmIHR5cGVvZiBuYW1lID09PSAnb2JqZWN0JykgY2FsbGJhY2sgPSB0aGlzOwogICAgICBpZiAob2JqKSAobGlzdGVuaW5nVG8gPSB7fSlbb2JqLl9saXN0ZW5JZF0gPSBvYmo7CiAgICAgIGZvciAodmFyIGlkIGluIGxpc3RlbmluZ1RvKSB7CiAgICAgICAgb2JqID0gbGlzdGVuaW5nVG9baWRdOwogICAgICAgIG9iai5vZmYobmFtZSwgY2FsbGJhY2ssIHRoaXMpOwogICAgICAgIGlmIChyZW1vdmUgfHwgXy5pc0VtcHR5KG9iai5fZXZlbnRzKSkgZGVsZXRlIHRoaXMuX2xpc3RlbmluZ1RvW2lkXTsKICAgICAgfQogICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAgfTsKCiAgLy8gUmVndWxhciBleHByZXNzaW9uIHVzZWQgdG8gc3BsaXQgZXZlbnQgc3RyaW5ncy4KICB2YXIgZXZlbnRTcGxpdHRlciA9IC9ccysvOwoKICAvLyBJbXBsZW1lbnQgZmFuY3kgZmVhdHVyZXMgb2YgdGhlIEV2ZW50cyBBUEkgc3VjaCBhcyBtdWx0aXBsZSBldmVudAogIC8vIG5hbWVzIGAiY2hhbmdlIGJsdXIiYCBhbmQgalF1ZXJ5LXN0eWxlIGV2ZW50IG1hcHMgYHtjaGFuZ2U6IGFjdGlvbn1gCiAgLy8gaW4gdGVybXMgb2YgdGhlIGV4aXN0aW5nIEFQSS4KICB2YXIgZXZlbnRzQXBpID0gZnVuY3Rpb24ob2JqLCBhY3Rpb24sIG5hbWUsIHJlc3QpIHsKICAgIGlmICghbmFtZSkgcmV0dXJuIHRydWU7CgogICAgLy8gSGFuZGxlIGV2ZW50IG1hcHMuCiAgICBpZiAodHlwZW9mIG5hbWUgPT09ICdvYmplY3QnKSB7CiAgICAgIGZvciAodmFyIGtleSBpbiBuYW1lKSB7CiAgICAgICAgb2JqW2FjdGlvbl0uYXBwbHkob2JqLCBba2V5LCBuYW1lW2tleV1dLmNvbmNhdChyZXN0KSk7CiAgICAgIH0KICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8vIEhhbmRsZSBzcGFjZSBzZXBhcmF0ZWQgZXZlbnQgbmFtZXMuCiAgICBpZiAoZXZlbnRTcGxpdHRlci50ZXN0KG5hbWUpKSB7CiAgICAgIHZhciBuYW1lcyA9IG5hbWUuc3BsaXQoZXZlbnRTcGxpdHRlcik7CiAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gbmFtZXMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgb2JqW2FjdGlvbl0uYXBwbHkob2JqLCBbbmFtZXNbaV1dLmNvbmNhdChyZXN0KSk7CiAgICAgIH0KICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHJldHVybiB0cnVlOwogIH07CgogIC8vIEEgZGlmZmljdWx0LXRvLWJlbGlldmUsIGJ1dCBvcHRpbWl6ZWQgaW50ZXJuYWwgZGlzcGF0Y2ggZnVuY3Rpb24gZm9yCiAgLy8gdHJpZ2dlcmluZyBldmVudHMuIFRyaWVzIHRvIGtlZXAgdGhlIHVzdWFsIGNhc2VzIHNwZWVkeSAobW9zdCBpbnRlcm5hbAogIC8vIEJhY2tib25lIGV2ZW50cyBoYXZlIDMgYXJndW1lbnRzKS4KICB2YXIgdHJpZ2dlckV2ZW50cyA9IGZ1bmN0aW9uKGV2ZW50cywgYXJncykgewogICAgdmFyIGV2LCBpID0gLTEsIGwgPSBldmVudHMubGVuZ3RoLCBhMSA9IGFyZ3NbMF0sIGEyID0gYXJnc1sxXSwgYTMgPSBhcmdzWzJdOwogICAgc3dpdGNoIChhcmdzLmxlbmd0aCkgewogICAgICBjYXNlIDA6IHdoaWxlICgrK2kgPCBsKSAoZXYgPSBldmVudHNbaV0pLmNhbGxiYWNrLmNhbGwoZXYuY3R4KTsgcmV0dXJuOwogICAgICBjYXNlIDE6IHdoaWxlICgrK2kgPCBsKSAoZXYgPSBldmVudHNbaV0pLmNhbGxiYWNrLmNhbGwoZXYuY3R4LCBhMSk7IHJldHVybjsKICAgICAgY2FzZSAyOiB3aGlsZSAoKytpIDwgbCkgKGV2ID0gZXZlbnRzW2ldKS5jYWxsYmFjay5jYWxsKGV2LmN0eCwgYTEsIGEyKTsgcmV0dXJuOwogICAgICBjYXNlIDM6IHdoaWxlICgrK2kgPCBsKSAoZXYgPSBldmVudHNbaV0pLmNhbGxiYWNrLmNhbGwoZXYuY3R4LCBhMSwgYTIsIGEzKTsgcmV0dXJuOwogICAgICBkZWZhdWx0OiB3aGlsZSAoKytpIDwgbCkgKGV2ID0gZXZlbnRzW2ldKS5jYWxsYmFjay5hcHBseShldi5jdHgsIGFyZ3MpOyByZXR1cm47CiAgICB9CiAgfTsKCiAgdmFyIGxpc3Rlbk1ldGhvZHMgPSB7bGlzdGVuVG86ICdvbicsIGxpc3RlblRvT25jZTogJ29uY2UnfTsKCiAgLy8gSW52ZXJzaW9uLW9mLWNvbnRyb2wgdmVyc2lvbnMgb2YgYG9uYCBhbmQgYG9uY2VgLiBUZWxsICp0aGlzKiBvYmplY3QgdG8KICAvLyBsaXN0ZW4gdG8gYW4gZXZlbnQgaW4gYW5vdGhlciBvYmplY3QgLi4uIGtlZXBpbmcgdHJhY2sgb2Ygd2hhdCBpdCdzCiAgLy8gbGlzdGVuaW5nIHRvLgogIF8uZWFjaChsaXN0ZW5NZXRob2RzLCBmdW5jdGlvbihpbXBsZW1lbnRhdGlvbiwgbWV0aG9kKSB7CiAgICBFdmVudHNbbWV0aG9kXSA9IGZ1bmN0aW9uKG9iaiwgbmFtZSwgY2FsbGJhY2spIHsKICAgICAgdmFyIGxpc3RlbmluZ1RvID0gdGhpcy5fbGlzdGVuaW5nVG8gfHwgKHRoaXMuX2xpc3RlbmluZ1RvID0ge30pOwogICAgICB2YXIgaWQgPSBvYmouX2xpc3RlbklkIHx8IChvYmouX2xpc3RlbklkID0gXy51bmlxdWVJZCgnbCcpKTsKICAgICAgbGlzdGVuaW5nVG9baWRdID0gb2JqOwogICAgICBpZiAoIWNhbGxiYWNrICYmIHR5cGVvZiBuYW1lID09PSAnb2JqZWN0JykgY2FsbGJhY2sgPSB0aGlzOwogICAgICBvYmpbaW1wbGVtZW50YXRpb25dKG5hbWUsIGNhbGxiYWNrLCB0aGlzKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9OwogIH0pOwoKICAvLyBBbGlhc2VzIGZvciBiYWNrd2FyZHMgY29tcGF0aWJpbGl0eS4KICBFdmVudHMuYmluZCAgID0gRXZlbnRzLm9uOwogIEV2ZW50cy51bmJpbmQgPSBFdmVudHMub2ZmOwoKICAvLyBBbGxvdyB0aGUgYEJhY2tib25lYCBvYmplY3QgdG8gc2VydmUgYXMgYSBnbG9iYWwgZXZlbnQgYnVzLCBmb3IgZm9sa3Mgd2hvCiAgLy8gd2FudCBnbG9iYWwgInB1YnN1YiIgaW4gYSBjb252ZW5pZW50IHBsYWNlLgogIF8uZXh0ZW5kKEJhY2tib25lLCBFdmVudHMpOwoKICAvLyBCYWNrYm9uZS5Nb2RlbAogIC8vIC0tLS0tLS0tLS0tLS0tCgogIC8vIEJhY2tib25lICoqTW9kZWxzKiogYXJlIHRoZSBiYXNpYyBkYXRhIG9iamVjdCBpbiB0aGUgZnJhbWV3b3JrIC0tCiAgLy8gZnJlcXVlbnRseSByZXByZXNlbnRpbmcgYSByb3cgaW4gYSB0YWJsZSBpbiBhIGRhdGFiYXNlIG9uIHlvdXIgc2VydmVyLgogIC8vIEEgZGlzY3JldGUgY2h1bmsgb2YgZGF0YSBhbmQgYSBidW5jaCBvZiB1c2VmdWwsIHJlbGF0ZWQgbWV0aG9kcyBmb3IKICAvLyBwZXJmb3JtaW5nIGNvbXB1dGF0aW9ucyBhbmQgdHJhbnNmb3JtYXRpb25zIG9uIHRoYXQgZGF0YS4KCiAgLy8gQ3JlYXRlIGEgbmV3IG1vZGVsIHdpdGggdGhlIHNwZWNpZmllZCBhdHRyaWJ1dGVzLiBBIGNsaWVudCBpZCAoYGNpZGApCiAgLy8gaXMgYXV0b21hdGljYWxseSBnZW5lcmF0ZWQgYW5kIGFzc2lnbmVkIGZvciB5b3UuCiAgdmFyIE1vZGVsID0gQmFja2JvbmUuTW9kZWwgPSBmdW5jdGlvbihhdHRyaWJ1dGVzLCBvcHRpb25zKSB7CiAgICB2YXIgYXR0cnMgPSBhdHRyaWJ1dGVzIHx8IHt9OwogICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTsKICAgIHRoaXMuY2lkID0gXy51bmlxdWVJZCgnYycpOwogICAgdGhpcy5hdHRyaWJ1dGVzID0ge307CiAgICBpZiAob3B0aW9ucy5jb2xsZWN0aW9uKSB0aGlzLmNvbGxlY3Rpb24gPSBvcHRpb25zLmNvbGxlY3Rpb247CiAgICBpZiAob3B0aW9ucy5wYXJzZSkgYXR0cnMgPSB0aGlzLnBhcnNlKGF0dHJzLCBvcHRpb25zKSB8fCB7fTsKICAgIGF0dHJzID0gXy5kZWZhdWx0cyh7fSwgYXR0cnMsIF8ucmVzdWx0KHRoaXMsICdkZWZhdWx0cycpKTsKICAgIHRoaXMuc2V0KGF0dHJzLCBvcHRpb25zKTsKICAgIHRoaXMuY2hhbmdlZCA9IHt9OwogICAgdGhpcy5pbml0aWFsaXplLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgfTsKCiAgLy8gQXR0YWNoIGFsbCBpbmhlcml0YWJsZSBtZXRob2RzIHRvIHRoZSBNb2RlbCBwcm90b3R5cGUuCiAgXy5leHRlbmQoTW9kZWwucHJvdG90eXBlLCBFdmVudHMsIHsKCiAgICAvLyBBIGhhc2ggb2YgYXR0cmlidXRlcyB3aG9zZSBjdXJyZW50IGFuZCBwcmV2aW91cyB2YWx1ZSBkaWZmZXIuCiAgICBjaGFuZ2VkOiBudWxsLAoKICAgIC8vIFRoZSB2YWx1ZSByZXR1cm5lZCBkdXJpbmcgdGhlIGxhc3QgZmFpbGVkIHZhbGlkYXRpb24uCiAgICB2YWxpZGF0aW9uRXJyb3I6IG51bGwsCgogICAgLy8gVGhlIGRlZmF1bHQgbmFtZSBmb3IgdGhlIEpTT04gYGlkYCBhdHRyaWJ1dGUgaXMgYCJpZCJgLiBNb25nb0RCIGFuZAogICAgLy8gQ291Y2hEQiB1c2VycyBtYXkgd2FudCB0byBzZXQgdGhpcyB0byBgIl9pZCJgLgogICAgaWRBdHRyaWJ1dGU6ICdpZCcsCgogICAgLy8gSW5pdGlhbGl6ZSBpcyBhbiBlbXB0eSBmdW5jdGlvbiBieSBkZWZhdWx0LiBPdmVycmlkZSBpdCB3aXRoIHlvdXIgb3duCiAgICAvLyBpbml0aWFsaXphdGlvbiBsb2dpYy4KICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uKCl7fSwKCiAgICAvLyBSZXR1cm4gYSBjb3B5IG9mIHRoZSBtb2RlbCdzIGBhdHRyaWJ1dGVzYCBvYmplY3QuCiAgICB0b0pTT046IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgcmV0dXJuIF8uY2xvbmUodGhpcy5hdHRyaWJ1dGVzKTsKICAgIH0sCgogICAgLy8gUHJveHkgYEJhY2tib25lLnN5bmNgIGJ5IGRlZmF1bHQgLS0gYnV0IG92ZXJyaWRlIHRoaXMgaWYgeW91IG5lZWQKICAgIC8vIGN1c3RvbSBzeW5jaW5nIHNlbWFudGljcyBmb3IgKnRoaXMqIHBhcnRpY3VsYXIgbW9kZWwuCiAgICBzeW5jOiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIEJhY2tib25lLnN5bmMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIH0sCgogICAgLy8gR2V0IHRoZSB2YWx1ZSBvZiBhbiBhdHRyaWJ1dGUuCiAgICBnZXQ6IGZ1bmN0aW9uKGF0dHIpIHsKICAgICAgcmV0dXJuIHRoaXMuYXR0cmlidXRlc1thdHRyXTsKICAgIH0sCgogICAgLy8gR2V0IHRoZSBIVE1MLWVzY2FwZWQgdmFsdWUgb2YgYW4gYXR0cmlidXRlLgogICAgZXNjYXBlOiBmdW5jdGlvbihhdHRyKSB7CiAgICAgIHJldHVybiBfLmVzY2FwZSh0aGlzLmdldChhdHRyKSk7CiAgICB9LAoKICAgIC8vIFJldHVybnMgYHRydWVgIGlmIHRoZSBhdHRyaWJ1dGUgY29udGFpbnMgYSB2YWx1ZSB0aGF0IGlzIG5vdCBudWxsCiAgICAvLyBvciB1bmRlZmluZWQuCiAgICBoYXM6IGZ1bmN0aW9uKGF0dHIpIHsKICAgICAgcmV0dXJuIHRoaXMuZ2V0KGF0dHIpICE9IG51bGw7CiAgICB9LAoKICAgIC8vIFNldCBhIGhhc2ggb2YgbW9kZWwgYXR0cmlidXRlcyBvbiB0aGUgb2JqZWN0LCBmaXJpbmcgYCJjaGFuZ2UiYC4gVGhpcyBpcwogICAgLy8gdGhlIGNvcmUgcHJpbWl0aXZlIG9wZXJhdGlvbiBvZiBhIG1vZGVsLCB1cGRhdGluZyB0aGUgZGF0YSBhbmQgbm90aWZ5aW5nCiAgICAvLyBhbnlvbmUgd2hvIG5lZWRzIHRvIGtub3cgYWJvdXQgdGhlIGNoYW5nZSBpbiBzdGF0ZS4gVGhlIGhlYXJ0IG9mIHRoZSBiZWFzdC4KICAgIHNldDogZnVuY3Rpb24oa2V5LCB2YWwsIG9wdGlvbnMpIHsKICAgICAgdmFyIGF0dHIsIGF0dHJzLCB1bnNldCwgY2hhbmdlcywgc2lsZW50LCBjaGFuZ2luZywgcHJldiwgY3VycmVudDsKICAgICAgaWYgKGtleSA9PSBudWxsKSByZXR1cm4gdGhpczsKCiAgICAgIC8vIEhhbmRsZSBib3RoIGAia2V5IiwgdmFsdWVgIGFuZCBge2tleTogdmFsdWV9YCAtc3R5bGUgYXJndW1lbnRzLgogICAgICBpZiAodHlwZW9mIGtleSA9PT0gJ29iamVjdCcpIHsKICAgICAgICBhdHRycyA9IGtleTsKICAgICAgICBvcHRpb25zID0gdmFsOwogICAgICB9IGVsc2UgewogICAgICAgIChhdHRycyA9IHt9KVtrZXldID0gdmFsOwogICAgICB9CgogICAgICBvcHRpb25zIHx8IChvcHRpb25zID0ge30pOwoKICAgICAgLy8gUnVuIHZhbGlkYXRpb24uCiAgICAgIGlmICghdGhpcy5fdmFsaWRhdGUoYXR0cnMsIG9wdGlvbnMpKSByZXR1cm4gZmFsc2U7CgogICAgICAvLyBFeHRyYWN0IGF0dHJpYnV0ZXMgYW5kIG9wdGlvbnMuCiAgICAgIHVuc2V0ICAgICAgICAgICA9IG9wdGlvbnMudW5zZXQ7CiAgICAgIHNpbGVudCAgICAgICAgICA9IG9wdGlvbnMuc2lsZW50OwogICAgICBjaGFuZ2VzICAgICAgICAgPSBbXTsKICAgICAgY2hhbmdpbmcgICAgICAgID0gdGhpcy5fY2hhbmdpbmc7CiAgICAgIHRoaXMuX2NoYW5naW5nICA9IHRydWU7CgogICAgICBpZiAoIWNoYW5naW5nKSB7CiAgICAgICAgdGhpcy5fcHJldmlvdXNBdHRyaWJ1dGVzID0gXy5jbG9uZSh0aGlzLmF0dHJpYnV0ZXMpOwogICAgICAgIHRoaXMuY2hhbmdlZCA9IHt9OwogICAgICB9CiAgICAgIGN1cnJlbnQgPSB0aGlzLmF0dHJpYnV0ZXMsIHByZXYgPSB0aGlzLl9wcmV2aW91c0F0dHJpYnV0ZXM7CgogICAgICAvLyBDaGVjayBmb3IgY2hhbmdlcyBvZiBgaWRgLgogICAgICBpZiAodGhpcy5pZEF0dHJpYnV0ZSBpbiBhdHRycykgdGhpcy5pZCA9IGF0dHJzW3RoaXMuaWRBdHRyaWJ1dGVdOwoKICAgICAgLy8gRm9yIGVhY2ggYHNldGAgYXR0cmlidXRlLCB1cGRhdGUgb3IgZGVsZXRlIHRoZSBjdXJyZW50IHZhbHVlLgogICAgICBmb3IgKGF0dHIgaW4gYXR0cnMpIHsKICAgICAgICB2YWwgPSBhdHRyc1thdHRyXTsKICAgICAgICBpZiAoIV8uaXNFcXVhbChjdXJyZW50W2F0dHJdLCB2YWwpKSBjaGFuZ2VzLnB1c2goYXR0cik7CiAgICAgICAgaWYgKCFfLmlzRXF1YWwocHJldlthdHRyXSwgdmFsKSkgewogICAgICAgICAgdGhpcy5jaGFuZ2VkW2F0dHJdID0gdmFsOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBkZWxldGUgdGhpcy5jaGFuZ2VkW2F0dHJdOwogICAgICAgIH0KICAgICAgICB1bnNldCA/IGRlbGV0ZSBjdXJyZW50W2F0dHJdIDogY3VycmVudFthdHRyXSA9IHZhbDsKICAgICAgfQoKICAgICAgLy8gVHJpZ2dlciBhbGwgcmVsZXZhbnQgYXR0cmlidXRlIGNoYW5nZXMuCiAgICAgIGlmICghc2lsZW50KSB7CiAgICAgICAgaWYgKGNoYW5nZXMubGVuZ3RoKSB0aGlzLl9wZW5kaW5nID0gb3B0aW9uczsKICAgICAgICBmb3IgKHZhciBpID0gMCwgbCA9IGNoYW5nZXMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICB0aGlzLnRyaWdnZXIoJ2NoYW5nZTonICsgY2hhbmdlc1tpXSwgdGhpcywgY3VycmVudFtjaGFuZ2VzW2ldXSwgb3B0aW9ucyk7CiAgICAgICAgfQogICAgICB9CgogICAgICAvLyBZb3UgbWlnaHQgYmUgd29uZGVyaW5nIHdoeSB0aGVyZSdzIGEgYHdoaWxlYCBsb29wIGhlcmUuIENoYW5nZXMgY2FuCiAgICAgIC8vIGJlIHJlY3Vyc2l2ZWx5IG5lc3RlZCB3aXRoaW4gYCJjaGFuZ2UiYCBldmVudHMuCiAgICAgIGlmIChjaGFuZ2luZykgcmV0dXJuIHRoaXM7CiAgICAgIGlmICghc2lsZW50KSB7CiAgICAgICAgd2hpbGUgKHRoaXMuX3BlbmRpbmcpIHsKICAgICAgICAgIG9wdGlvbnMgPSB0aGlzLl9wZW5kaW5nOwogICAgICAgICAgdGhpcy5fcGVuZGluZyA9IGZhbHNlOwogICAgICAgICAgdGhpcy50cmlnZ2VyKCdjaGFuZ2UnLCB0aGlzLCBvcHRpb25zKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhpcy5fcGVuZGluZyA9IGZhbHNlOwogICAgICB0aGlzLl9jaGFuZ2luZyA9IGZhbHNlOwogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLy8gUmVtb3ZlIGFuIGF0dHJpYnV0ZSBmcm9tIHRoZSBtb2RlbCwgZmlyaW5nIGAiY2hhbmdlImAuIGB1bnNldGAgaXMgYSBub29wCiAgICAvLyBpZiB0aGUgYXR0cmlidXRlIGRvZXNuJ3QgZXhpc3QuCiAgICB1bnNldDogZnVuY3Rpb24oYXR0ciwgb3B0aW9ucykgewogICAgICByZXR1cm4gdGhpcy5zZXQoYXR0ciwgdm9pZCAwLCBfLmV4dGVuZCh7fSwgb3B0aW9ucywge3Vuc2V0OiB0cnVlfSkpOwogICAgfSwKCiAgICAvLyBDbGVhciBhbGwgYXR0cmlidXRlcyBvbiB0aGUgbW9kZWwsIGZpcmluZyBgImNoYW5nZSJgLgogICAgY2xlYXI6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgdmFyIGF0dHJzID0ge307CiAgICAgIGZvciAodmFyIGtleSBpbiB0aGlzLmF0dHJpYnV0ZXMpIGF0dHJzW2tleV0gPSB2b2lkIDA7CiAgICAgIHJldHVybiB0aGlzLnNldChhdHRycywgXy5leHRlbmQoe30sIG9wdGlvbnMsIHt1bnNldDogdHJ1ZX0pKTsKICAgIH0sCgogICAgLy8gRGV0ZXJtaW5lIGlmIHRoZSBtb2RlbCBoYXMgY2hhbmdlZCBzaW5jZSB0aGUgbGFzdCBgImNoYW5nZSJgIGV2ZW50LgogICAgLy8gSWYgeW91IHNwZWNpZnkgYW4gYXR0cmlidXRlIG5hbWUsIGRldGVybWluZSBpZiB0aGF0IGF0dHJpYnV0ZSBoYXMgY2hhbmdlZC4KICAgIGhhc0NoYW5nZWQ6IGZ1bmN0aW9uKGF0dHIpIHsKICAgICAgaWYgKGF0dHIgPT0gbnVsbCkgcmV0dXJuICFfLmlzRW1wdHkodGhpcy5jaGFuZ2VkKTsKICAgICAgcmV0dXJuIF8uaGFzKHRoaXMuY2hhbmdlZCwgYXR0cik7CiAgICB9LAoKICAgIC8vIFJldHVybiBhbiBvYmplY3QgY29udGFpbmluZyBhbGwgdGhlIGF0dHJpYnV0ZXMgdGhhdCBoYXZlIGNoYW5nZWQsIG9yCiAgICAvLyBmYWxzZSBpZiB0aGVyZSBhcmUgbm8gY2hhbmdlZCBhdHRyaWJ1dGVzLiBVc2VmdWwgZm9yIGRldGVybWluaW5nIHdoYXQKICAgIC8vIHBhcnRzIG9mIGEgdmlldyBuZWVkIHRvIGJlIHVwZGF0ZWQgYW5kL29yIHdoYXQgYXR0cmlidXRlcyBuZWVkIHRvIGJlCiAgICAvLyBwZXJzaXN0ZWQgdG8gdGhlIHNlcnZlci4gVW5zZXQgYXR0cmlidXRlcyB3aWxsIGJlIHNldCB0byB1bmRlZmluZWQuCiAgICAvLyBZb3UgY2FuIGFsc28gcGFzcyBhbiBhdHRyaWJ1dGVzIG9iamVjdCB0byBkaWZmIGFnYWluc3QgdGhlIG1vZGVsLAogICAgLy8gZGV0ZXJtaW5pbmcgaWYgdGhlcmUgKndvdWxkIGJlKiBhIGNoYW5nZS4KICAgIGNoYW5nZWRBdHRyaWJ1dGVzOiBmdW5jdGlvbihkaWZmKSB7CiAgICAgIGlmICghZGlmZikgcmV0dXJuIHRoaXMuaGFzQ2hhbmdlZCgpID8gXy5jbG9uZSh0aGlzLmNoYW5nZWQpIDogZmFsc2U7CiAgICAgIHZhciB2YWwsIGNoYW5nZWQgPSBmYWxzZTsKICAgICAgdmFyIG9sZCA9IHRoaXMuX2NoYW5naW5nID8gdGhpcy5fcHJldmlvdXNBdHRyaWJ1dGVzIDogdGhpcy5hdHRyaWJ1dGVzOwogICAgICBmb3IgKHZhciBhdHRyIGluIGRpZmYpIHsKICAgICAgICBpZiAoXy5pc0VxdWFsKG9sZFthdHRyXSwgKHZhbCA9IGRpZmZbYXR0cl0pKSkgY29udGludWU7CiAgICAgICAgKGNoYW5nZWQgfHwgKGNoYW5nZWQgPSB7fSkpW2F0dHJdID0gdmFsOwogICAgICB9CiAgICAgIHJldHVybiBjaGFuZ2VkOwogICAgfSwKCiAgICAvLyBHZXQgdGhlIHByZXZpb3VzIHZhbHVlIG9mIGFuIGF0dHJpYnV0ZSwgcmVjb3JkZWQgYXQgdGhlIHRpbWUgdGhlIGxhc3QKICAgIC8vIGAiY2hhbmdlImAgZXZlbnQgd2FzIGZpcmVkLgogICAgcHJldmlvdXM6IGZ1bmN0aW9uKGF0dHIpIHsKICAgICAgaWYgKGF0dHIgPT0gbnVsbCB8fCAhdGhpcy5fcHJldmlvdXNBdHRyaWJ1dGVzKSByZXR1cm4gbnVsbDsKICAgICAgcmV0dXJuIHRoaXMuX3ByZXZpb3VzQXR0cmlidXRlc1thdHRyXTsKICAgIH0sCgogICAgLy8gR2V0IGFsbCBvZiB0aGUgYXR0cmlidXRlcyBvZiB0aGUgbW9kZWwgYXQgdGhlIHRpbWUgb2YgdGhlIHByZXZpb3VzCiAgICAvLyBgImNoYW5nZSJgIGV2ZW50LgogICAgcHJldmlvdXNBdHRyaWJ1dGVzOiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIF8uY2xvbmUodGhpcy5fcHJldmlvdXNBdHRyaWJ1dGVzKTsKICAgIH0sCgogICAgLy8gRmV0Y2ggdGhlIG1vZGVsIGZyb20gdGhlIHNlcnZlci4gSWYgdGhlIHNlcnZlcidzIHJlcHJlc2VudGF0aW9uIG9mIHRoZQogICAgLy8gbW9kZWwgZGlmZmVycyBmcm9tIGl0cyBjdXJyZW50IGF0dHJpYnV0ZXMsIHRoZXkgd2lsbCBiZSBvdmVycmlkZGVuLAogICAgLy8gdHJpZ2dlcmluZyBhIGAiY2hhbmdlImAgZXZlbnQuCiAgICBmZXRjaDogZnVuY3Rpb24ob3B0aW9ucykgewogICAgICBvcHRpb25zID0gb3B0aW9ucyA/IF8uY2xvbmUob3B0aW9ucykgOiB7fTsKICAgICAgaWYgKG9wdGlvbnMucGFyc2UgPT09IHZvaWQgMCkgb3B0aW9ucy5wYXJzZSA9IHRydWU7CiAgICAgIHZhciBtb2RlbCA9IHRoaXM7CiAgICAgIHZhciBzdWNjZXNzID0gb3B0aW9ucy5zdWNjZXNzOwogICAgICBvcHRpb25zLnN1Y2Nlc3MgPSBmdW5jdGlvbihyZXNwKSB7CiAgICAgICAgaWYgKCFtb2RlbC5zZXQobW9kZWwucGFyc2UocmVzcCwgb3B0aW9ucyksIG9wdGlvbnMpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgaWYgKHN1Y2Nlc3MpIHN1Y2Nlc3MobW9kZWwsIHJlc3AsIG9wdGlvbnMpOwogICAgICAgIG1vZGVsLnRyaWdnZXIoJ3N5bmMnLCBtb2RlbCwgcmVzcCwgb3B0aW9ucyk7CiAgICAgIH07CiAgICAgIHdyYXBFcnJvcih0aGlzLCBvcHRpb25zKTsKICAgICAgcmV0dXJuIHRoaXMuc3luYygncmVhZCcsIHRoaXMsIG9wdGlvbnMpOwogICAgfSwKCiAgICAvLyBTZXQgYSBoYXNoIG9mIG1vZGVsIGF0dHJpYnV0ZXMsIGFuZCBzeW5jIHRoZSBtb2RlbCB0byB0aGUgc2VydmVyLgogICAgLy8gSWYgdGhlIHNlcnZlciByZXR1cm5zIGFuIGF0dHJpYnV0ZXMgaGFzaCB0aGF0IGRpZmZlcnMsIHRoZSBtb2RlbCdzCiAgICAvLyBzdGF0ZSB3aWxsIGJlIGBzZXRgIGFnYWluLgogICAgc2F2ZTogZnVuY3Rpb24oa2V5LCB2YWwsIG9wdGlvbnMpIHsKICAgICAgdmFyIGF0dHJzLCBtZXRob2QsIHhociwgYXR0cmlidXRlcyA9IHRoaXMuYXR0cmlidXRlczsKCiAgICAgIC8vIEhhbmRsZSBib3RoIGAia2V5IiwgdmFsdWVgIGFuZCBge2tleTogdmFsdWV9YCAtc3R5bGUgYXJndW1lbnRzLgogICAgICBpZiAoa2V5ID09IG51bGwgfHwgdHlwZW9mIGtleSA9PT0gJ29iamVjdCcpIHsKICAgICAgICBhdHRycyA9IGtleTsKICAgICAgICBvcHRpb25zID0gdmFsOwogICAgICB9IGVsc2UgewogICAgICAgIChhdHRycyA9IHt9KVtrZXldID0gdmFsOwogICAgICB9CgogICAgICBvcHRpb25zID0gXy5leHRlbmQoe3ZhbGlkYXRlOiB0cnVlfSwgb3B0aW9ucyk7CgogICAgICAvLyBJZiB3ZSdyZSBub3Qgd2FpdGluZyBhbmQgYXR0cmlidXRlcyBleGlzdCwgc2F2ZSBhY3RzIGFzCiAgICAgIC8vIGBzZXQoYXR0cikuc2F2ZShudWxsLCBvcHRzKWAgd2l0aCB2YWxpZGF0aW9uLiBPdGhlcndpc2UsIGNoZWNrIGlmCiAgICAgIC8vIHRoZSBtb2RlbCB3aWxsIGJlIHZhbGlkIHdoZW4gdGhlIGF0dHJpYnV0ZXMsIGlmIGFueSwgYXJlIHNldC4KICAgICAgaWYgKGF0dHJzICYmICFvcHRpb25zLndhaXQpIHsKICAgICAgICBpZiAoIXRoaXMuc2V0KGF0dHJzLCBvcHRpb25zKSkgcmV0dXJuIGZhbHNlOwogICAgICB9IGVsc2UgewogICAgICAgIGlmICghdGhpcy5fdmFsaWRhdGUoYXR0cnMsIG9wdGlvbnMpKSByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIC8vIFNldCB0ZW1wb3JhcnkgYXR0cmlidXRlcyBpZiBge3dhaXQ6IHRydWV9YC4KICAgICAgaWYgKGF0dHJzICYmIG9wdGlvbnMud2FpdCkgewogICAgICAgIHRoaXMuYXR0cmlidXRlcyA9IF8uZXh0ZW5kKHt9LCBhdHRyaWJ1dGVzLCBhdHRycyk7CiAgICAgIH0KCiAgICAgIC8vIEFmdGVyIGEgc3VjY2Vzc2Z1bCBzZXJ2ZXItc2lkZSBzYXZlLCB0aGUgY2xpZW50IGlzIChvcHRpb25hbGx5KQogICAgICAvLyB1cGRhdGVkIHdpdGggdGhlIHNlcnZlci1zaWRlIHN0YXRlLgogICAgICBpZiAob3B0aW9ucy5wYXJzZSA9PT0gdm9pZCAwKSBvcHRpb25zLnBhcnNlID0gdHJ1ZTsKICAgICAgdmFyIG1vZGVsID0gdGhpczsKICAgICAgdmFyIHN1Y2Nlc3MgPSBvcHRpb25zLnN1Y2Nlc3M7CiAgICAgIG9wdGlvbnMuc3VjY2VzcyA9IGZ1bmN0aW9uKHJlc3ApIHsKICAgICAgICAvLyBFbnN1cmUgYXR0cmlidXRlcyBhcmUgcmVzdG9yZWQgZHVyaW5nIHN5bmNocm9ub3VzIHNhdmVzLgogICAgICAgIG1vZGVsLmF0dHJpYnV0ZXMgPSBhdHRyaWJ1dGVzOwogICAgICAgIHZhciBzZXJ2ZXJBdHRycyA9IG1vZGVsLnBhcnNlKHJlc3AsIG9wdGlvbnMpOwogICAgICAgIGlmIChvcHRpb25zLndhaXQpIHNlcnZlckF0dHJzID0gXy5leHRlbmQoYXR0cnMgfHwge30sIHNlcnZlckF0dHJzKTsKICAgICAgICBpZiAoXy5pc09iamVjdChzZXJ2ZXJBdHRycykgJiYgIW1vZGVsLnNldChzZXJ2ZXJBdHRycywgb3B0aW9ucykpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKHN1Y2Nlc3MpIHN1Y2Nlc3MobW9kZWwsIHJlc3AsIG9wdGlvbnMpOwogICAgICAgIG1vZGVsLnRyaWdnZXIoJ3N5bmMnLCBtb2RlbCwgcmVzcCwgb3B0aW9ucyk7CiAgICAgIH07CiAgICAgIHdyYXBFcnJvcih0aGlzLCBvcHRpb25zKTsKCiAgICAgIG1ldGhvZCA9IHRoaXMuaXNOZXcoKSA/ICdjcmVhdGUnIDogKG9wdGlvbnMucGF0Y2ggPyAncGF0Y2gnIDogJ3VwZGF0ZScpOwogICAgICBpZiAobWV0aG9kID09PSAncGF0Y2gnKSBvcHRpb25zLmF0dHJzID0gYXR0cnM7CiAgICAgIHhociA9IHRoaXMuc3luYyhtZXRob2QsIHRoaXMsIG9wdGlvbnMpOwoKICAgICAgLy8gUmVzdG9yZSBhdHRyaWJ1dGVzLgogICAgICBpZiAoYXR0cnMgJiYgb3B0aW9ucy53YWl0KSB0aGlzLmF0dHJpYnV0ZXMgPSBhdHRyaWJ1dGVzOwoKICAgICAgcmV0dXJuIHhocjsKICAgIH0sCgogICAgLy8gRGVzdHJveSB0aGlzIG1vZGVsIG9uIHRoZSBzZXJ2ZXIgaWYgaXQgd2FzIGFscmVhZHkgcGVyc2lzdGVkLgogICAgLy8gT3B0aW1pc3RpY2FsbHkgcmVtb3ZlcyB0aGUgbW9kZWwgZnJvbSBpdHMgY29sbGVjdGlvbiwgaWYgaXQgaGFzIG9uZS4KICAgIC8vIElmIGB3YWl0OiB0cnVlYCBpcyBwYXNzZWQsIHdhaXRzIGZvciB0aGUgc2VydmVyIHRvIHJlc3BvbmQgYmVmb3JlIHJlbW92YWwuCiAgICBkZXN0cm95OiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgIG9wdGlvbnMgPSBvcHRpb25zID8gXy5jbG9uZShvcHRpb25zKSA6IHt9OwogICAgICB2YXIgbW9kZWwgPSB0aGlzOwogICAgICB2YXIgc3VjY2VzcyA9IG9wdGlvbnMuc3VjY2VzczsKCiAgICAgIHZhciBkZXN0cm95ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgbW9kZWwudHJpZ2dlcignZGVzdHJveScsIG1vZGVsLCBtb2RlbC5jb2xsZWN0aW9uLCBvcHRpb25zKTsKICAgICAgfTsKCiAgICAgIG9wdGlvbnMuc3VjY2VzcyA9IGZ1bmN0aW9uKHJlc3ApIHsKICAgICAgICBpZiAob3B0aW9ucy53YWl0IHx8IG1vZGVsLmlzTmV3KCkpIGRlc3Ryb3koKTsKICAgICAgICBpZiAoc3VjY2Vzcykgc3VjY2Vzcyhtb2RlbCwgcmVzcCwgb3B0aW9ucyk7CiAgICAgICAgaWYgKCFtb2RlbC5pc05ldygpKSBtb2RlbC50cmlnZ2VyKCdzeW5jJywgbW9kZWwsIHJlc3AsIG9wdGlvbnMpOwogICAgICB9OwoKICAgICAgaWYgKHRoaXMuaXNOZXcoKSkgewogICAgICAgIG9wdGlvbnMuc3VjY2VzcygpOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICB3cmFwRXJyb3IodGhpcywgb3B0aW9ucyk7CgogICAgICB2YXIgeGhyID0gdGhpcy5zeW5jKCdkZWxldGUnLCB0aGlzLCBvcHRpb25zKTsKICAgICAgaWYgKCFvcHRpb25zLndhaXQpIGRlc3Ryb3koKTsKICAgICAgcmV0dXJuIHhocjsKICAgIH0sCgogICAgLy8gRGVmYXVsdCBVUkwgZm9yIHRoZSBtb2RlbCdzIHJlcHJlc2VudGF0aW9uIG9uIHRoZSBzZXJ2ZXIgLS0gaWYgeW91J3JlCiAgICAvLyB1c2luZyBCYWNrYm9uZSdzIHJlc3RmdWwgbWV0aG9kcywgb3ZlcnJpZGUgdGhpcyB0byBjaGFuZ2UgdGhlIGVuZHBvaW50CiAgICAvLyB0aGF0IHdpbGwgYmUgY2FsbGVkLgogICAgdXJsOiBmdW5jdGlvbigpIHsKICAgICAgdmFyIGJhc2UgPQogICAgICAgIF8ucmVzdWx0KHRoaXMsICd1cmxSb290JykgfHwKICAgICAgICBfLnJlc3VsdCh0aGlzLmNvbGxlY3Rpb24sICd1cmwnKSB8fAogICAgICAgIHVybEVycm9yKCk7CiAgICAgIGlmICh0aGlzLmlzTmV3KCkpIHJldHVybiBiYXNlOwogICAgICByZXR1cm4gYmFzZS5yZXBsYWNlKC8oW15cL10pJC8sICckMS8nKSArIGVuY29kZVVSSUNvbXBvbmVudCh0aGlzLmlkKTsKICAgIH0sCgogICAgLy8gKipwYXJzZSoqIGNvbnZlcnRzIGEgcmVzcG9uc2UgaW50byB0aGUgaGFzaCBvZiBhdHRyaWJ1dGVzIHRvIGJlIGBzZXRgIG9uCiAgICAvLyB0aGUgbW9kZWwuIFRoZSBkZWZhdWx0IGltcGxlbWVudGF0aW9uIGlzIGp1c3QgdG8gcGFzcyB0aGUgcmVzcG9uc2UgYWxvbmcuCiAgICBwYXJzZTogZnVuY3Rpb24ocmVzcCwgb3B0aW9ucykgewogICAgICByZXR1cm4gcmVzcDsKICAgIH0sCgogICAgLy8gQ3JlYXRlIGEgbmV3IG1vZGVsIHdpdGggaWRlbnRpY2FsIGF0dHJpYnV0ZXMgdG8gdGhpcyBvbmUuCiAgICBjbG9uZTogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3Rvcih0aGlzLmF0dHJpYnV0ZXMpOwogICAgfSwKCiAgICAvLyBBIG1vZGVsIGlzIG5ldyBpZiBpdCBoYXMgbmV2ZXIgYmVlbiBzYXZlZCB0byB0aGUgc2VydmVyLCBhbmQgbGFja3MgYW4gaWQuCiAgICBpc05ldzogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiAhdGhpcy5oYXModGhpcy5pZEF0dHJpYnV0ZSk7CiAgICB9LAoKICAgIC8vIENoZWNrIGlmIHRoZSBtb2RlbCBpcyBjdXJyZW50bHkgaW4gYSB2YWxpZCBzdGF0ZS4KICAgIGlzVmFsaWQ6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgcmV0dXJuIHRoaXMuX3ZhbGlkYXRlKHt9LCBfLmV4dGVuZChvcHRpb25zIHx8IHt9LCB7IHZhbGlkYXRlOiB0cnVlIH0pKTsKICAgIH0sCgogICAgLy8gUnVuIHZhbGlkYXRpb24gYWdhaW5zdCB0aGUgbmV4dCBjb21wbGV0ZSBzZXQgb2YgbW9kZWwgYXR0cmlidXRlcywKICAgIC8vIHJldHVybmluZyBgdHJ1ZWAgaWYgYWxsIGlzIHdlbGwuIE90aGVyd2lzZSwgZmlyZSBhbiBgImludmFsaWQiYCBldmVudC4KICAgIF92YWxpZGF0ZTogZnVuY3Rpb24oYXR0cnMsIG9wdGlvbnMpIHsKICAgICAgaWYgKCFvcHRpb25zLnZhbGlkYXRlIHx8ICF0aGlzLnZhbGlkYXRlKSByZXR1cm4gdHJ1ZTsKICAgICAgYXR0cnMgPSBfLmV4dGVuZCh7fSwgdGhpcy5hdHRyaWJ1dGVzLCBhdHRycyk7CiAgICAgIHZhciBlcnJvciA9IHRoaXMudmFsaWRhdGlvbkVycm9yID0gdGhpcy52YWxpZGF0ZShhdHRycywgb3B0aW9ucykgfHwgbnVsbDsKICAgICAgaWYgKCFlcnJvcikgcmV0dXJuIHRydWU7CiAgICAgIHRoaXMudHJpZ2dlcignaW52YWxpZCcsIHRoaXMsIGVycm9yLCBfLmV4dGVuZChvcHRpb25zLCB7dmFsaWRhdGlvbkVycm9yOiBlcnJvcn0pKTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICB9KTsKCiAgLy8gVW5kZXJzY29yZSBtZXRob2RzIHRoYXQgd2Ugd2FudCB0byBpbXBsZW1lbnQgb24gdGhlIE1vZGVsLgogIHZhciBtb2RlbE1ldGhvZHMgPSBbJ2tleXMnLCAndmFsdWVzJywgJ3BhaXJzJywgJ2ludmVydCcsICdwaWNrJywgJ29taXQnXTsKCiAgLy8gTWl4IGluIGVhY2ggVW5kZXJzY29yZSBtZXRob2QgYXMgYSBwcm94eSB0byBgTW9kZWwjYXR0cmlidXRlc2AuCiAgXy5lYWNoKG1vZGVsTWV0aG9kcywgZnVuY3Rpb24obWV0aG9kKSB7CiAgICBNb2RlbC5wcm90b3R5cGVbbWV0aG9kXSA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgYXJncyA9IHNsaWNlLmNhbGwoYXJndW1lbnRzKTsKICAgICAgYXJncy51bnNoaWZ0KHRoaXMuYXR0cmlidXRlcyk7CiAgICAgIHJldHVybiBfW21ldGhvZF0uYXBwbHkoXywgYXJncyk7CiAgICB9OwogIH0pOwoKICAvLyBCYWNrYm9uZS5Db2xsZWN0aW9uCiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLQoKICAvLyBJZiBtb2RlbHMgdGVuZCB0byByZXByZXNlbnQgYSBzaW5nbGUgcm93IG9mIGRhdGEsIGEgQmFja2JvbmUgQ29sbGVjdGlvbiBpcwogIC8vIG1vcmUgYW5hbGFnb3VzIHRvIGEgdGFibGUgZnVsbCBvZiBkYXRhIC4uLiBvciBhIHNtYWxsIHNsaWNlIG9yIHBhZ2Ugb2YgdGhhdAogIC8vIHRhYmxlLCBvciBhIGNvbGxlY3Rpb24gb2Ygcm93cyB0aGF0IGJlbG9uZyB0b2dldGhlciBmb3IgYSBwYXJ0aWN1bGFyIHJlYXNvbgogIC8vIC0tIGFsbCBvZiB0aGUgbWVzc2FnZXMgaW4gdGhpcyBwYXJ0aWN1bGFyIGZvbGRlciwgYWxsIG9mIHRoZSBkb2N1bWVudHMKICAvLyBiZWxvbmdpbmcgdG8gdGhpcyBwYXJ0aWN1bGFyIGF1dGhvciwgYW5kIHNvIG9uLiBDb2xsZWN0aW9ucyBtYWludGFpbgogIC8vIGluZGV4ZXMgb2YgdGhlaXIgbW9kZWxzLCBib3RoIGluIG9yZGVyLCBhbmQgZm9yIGxvb2t1cCBieSBgaWRgLgoKICAvLyBDcmVhdGUgYSBuZXcgKipDb2xsZWN0aW9uKiosIHBlcmhhcHMgdG8gY29udGFpbiBhIHNwZWNpZmljIHR5cGUgb2YgYG1vZGVsYC4KICAvLyBJZiBhIGBjb21wYXJhdG9yYCBpcyBzcGVjaWZpZWQsIHRoZSBDb2xsZWN0aW9uIHdpbGwgbWFpbnRhaW4KICAvLyBpdHMgbW9kZWxzIGluIHNvcnQgb3JkZXIsIGFzIHRoZXkncmUgYWRkZWQgYW5kIHJlbW92ZWQuCiAgdmFyIENvbGxlY3Rpb24gPSBCYWNrYm9uZS5Db2xsZWN0aW9uID0gZnVuY3Rpb24obW9kZWxzLCBvcHRpb25zKSB7CiAgICBvcHRpb25zIHx8IChvcHRpb25zID0ge30pOwogICAgaWYgKG9wdGlvbnMubW9kZWwpIHRoaXMubW9kZWwgPSBvcHRpb25zLm1vZGVsOwogICAgaWYgKG9wdGlvbnMuY29tcGFyYXRvciAhPT0gdm9pZCAwKSB0aGlzLmNvbXBhcmF0b3IgPSBvcHRpb25zLmNvbXBhcmF0b3I7CiAgICB0aGlzLl9yZXNldCgpOwogICAgdGhpcy5pbml0aWFsaXplLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICBpZiAobW9kZWxzKSB0aGlzLnJlc2V0KG1vZGVscywgXy5leHRlbmQoe3NpbGVudDogdHJ1ZX0sIG9wdGlvbnMpKTsKICB9OwoKICAvLyBEZWZhdWx0IG9wdGlvbnMgZm9yIGBDb2xsZWN0aW9uI3NldGAuCiAgdmFyIHNldE9wdGlvbnMgPSB7YWRkOiB0cnVlLCByZW1vdmU6IHRydWUsIG1lcmdlOiB0cnVlfTsKICB2YXIgYWRkT3B0aW9ucyA9IHthZGQ6IHRydWUsIHJlbW92ZTogZmFsc2V9OwoKICAvLyBEZWZpbmUgdGhlIENvbGxlY3Rpb24ncyBpbmhlcml0YWJsZSBtZXRob2RzLgogIF8uZXh0ZW5kKENvbGxlY3Rpb24ucHJvdG90eXBlLCBFdmVudHMsIHsKCiAgICAvLyBUaGUgZGVmYXVsdCBtb2RlbCBmb3IgYSBjb2xsZWN0aW9uIGlzIGp1c3QgYSAqKkJhY2tib25lLk1vZGVsKiouCiAgICAvLyBUaGlzIHNob3VsZCBiZSBvdmVycmlkZGVuIGluIG1vc3QgY2FzZXMuCiAgICBtb2RlbDogTW9kZWwsCgogICAgLy8gSW5pdGlhbGl6ZSBpcyBhbiBlbXB0eSBmdW5jdGlvbiBieSBkZWZhdWx0LiBPdmVycmlkZSBpdCB3aXRoIHlvdXIgb3duCiAgICAvLyBpbml0aWFsaXphdGlvbiBsb2dpYy4KICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uKCl7fSwKCiAgICAvLyBUaGUgSlNPTiByZXByZXNlbnRhdGlvbiBvZiBhIENvbGxlY3Rpb24gaXMgYW4gYXJyYXkgb2YgdGhlCiAgICAvLyBtb2RlbHMnIGF0dHJpYnV0ZXMuCiAgICB0b0pTT046IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgcmV0dXJuIHRoaXMubWFwKGZ1bmN0aW9uKG1vZGVsKXsgcmV0dXJuIG1vZGVsLnRvSlNPTihvcHRpb25zKTsgfSk7CiAgICB9LAoKICAgIC8vIFByb3h5IGBCYWNrYm9uZS5zeW5jYCBieSBkZWZhdWx0LgogICAgc3luYzogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBCYWNrYm9uZS5zeW5jLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICB9LAoKICAgIC8vIEFkZCBhIG1vZGVsLCBvciBsaXN0IG9mIG1vZGVscyB0byB0aGUgc2V0LgogICAgYWRkOiBmdW5jdGlvbihtb2RlbHMsIG9wdGlvbnMpIHsKICAgICAgcmV0dXJuIHRoaXMuc2V0KG1vZGVscywgXy5leHRlbmQoe21lcmdlOiBmYWxzZX0sIG9wdGlvbnMsIGFkZE9wdGlvbnMpKTsKICAgIH0sCgogICAgLy8gUmVtb3ZlIGEgbW9kZWwsIG9yIGEgbGlzdCBvZiBtb2RlbHMgZnJvbSB0aGUgc2V0LgogICAgcmVtb3ZlOiBmdW5jdGlvbihtb2RlbHMsIG9wdGlvbnMpIHsKICAgICAgdmFyIHNpbmd1bGFyID0gIV8uaXNBcnJheShtb2RlbHMpOwogICAgICBtb2RlbHMgPSBzaW5ndWxhciA/IFttb2RlbHNdIDogXy5jbG9uZShtb2RlbHMpOwogICAgICBvcHRpb25zIHx8IChvcHRpb25zID0ge30pOwogICAgICB2YXIgaSwgbCwgaW5kZXgsIG1vZGVsOwogICAgICBmb3IgKGkgPSAwLCBsID0gbW9kZWxzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIG1vZGVsID0gbW9kZWxzW2ldID0gdGhpcy5nZXQobW9kZWxzW2ldKTsKICAgICAgICBpZiAoIW1vZGVsKSBjb250aW51ZTsKICAgICAgICBkZWxldGUgdGhpcy5fYnlJZFttb2RlbC5pZF07CiAgICAgICAgZGVsZXRlIHRoaXMuX2J5SWRbbW9kZWwuY2lkXTsKICAgICAgICBpbmRleCA9IHRoaXMuaW5kZXhPZihtb2RlbCk7CiAgICAgICAgdGhpcy5tb2RlbHMuc3BsaWNlKGluZGV4LCAxKTsKICAgICAgICB0aGlzLmxlbmd0aC0tOwogICAgICAgIGlmICghb3B0aW9ucy5zaWxlbnQpIHsKICAgICAgICAgIG9wdGlvbnMuaW5kZXggPSBpbmRleDsKICAgICAgICAgIG1vZGVsLnRyaWdnZXIoJ3JlbW92ZScsIG1vZGVsLCB0aGlzLCBvcHRpb25zKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5fcmVtb3ZlUmVmZXJlbmNlKG1vZGVsLCBvcHRpb25zKTsKICAgICAgfQogICAgICByZXR1cm4gc2luZ3VsYXIgPyBtb2RlbHNbMF0gOiBtb2RlbHM7CiAgICB9LAoKICAgIC8vIFVwZGF0ZSBhIGNvbGxlY3Rpb24gYnkgYHNldGAtaW5nIGEgbmV3IGxpc3Qgb2YgbW9kZWxzLCBhZGRpbmcgbmV3IG9uZXMsCiAgICAvLyByZW1vdmluZyBtb2RlbHMgdGhhdCBhcmUgbm8gbG9uZ2VyIHByZXNlbnQsIGFuZCBtZXJnaW5nIG1vZGVscyB0aGF0CiAgICAvLyBhbHJlYWR5IGV4aXN0IGluIHRoZSBjb2xsZWN0aW9uLCBhcyBuZWNlc3NhcnkuIFNpbWlsYXIgdG8gKipNb2RlbCNzZXQqKiwKICAgIC8vIHRoZSBjb3JlIG9wZXJhdGlvbiBmb3IgdXBkYXRpbmcgdGhlIGRhdGEgY29udGFpbmVkIGJ5IHRoZSBjb2xsZWN0aW9uLgogICAgc2V0OiBmdW5jdGlvbihtb2RlbHMsIG9wdGlvbnMpIHsKICAgICAgb3B0aW9ucyA9IF8uZGVmYXVsdHMoe30sIG9wdGlvbnMsIHNldE9wdGlvbnMpOwogICAgICBpZiAob3B0aW9ucy5wYXJzZSkgbW9kZWxzID0gdGhpcy5wYXJzZShtb2RlbHMsIG9wdGlvbnMpOwogICAgICB2YXIgc2luZ3VsYXIgPSAhXy5pc0FycmF5KG1vZGVscyk7CiAgICAgIG1vZGVscyA9IHNpbmd1bGFyID8gKG1vZGVscyA/IFttb2RlbHNdIDogW10pIDogXy5jbG9uZShtb2RlbHMpOwogICAgICB2YXIgaSwgbCwgaWQsIG1vZGVsLCBhdHRycywgZXhpc3RpbmcsIHNvcnQ7CiAgICAgIHZhciBhdCA9IG9wdGlvbnMuYXQ7CiAgICAgIHZhciB0YXJnZXRNb2RlbCA9IHRoaXMubW9kZWw7CiAgICAgIHZhciBzb3J0YWJsZSA9IHRoaXMuY29tcGFyYXRvciAmJiAoYXQgPT0gbnVsbCkgJiYgb3B0aW9ucy5zb3J0ICE9PSBmYWxzZTsKICAgICAgdmFyIHNvcnRBdHRyID0gXy5pc1N0cmluZyh0aGlzLmNvbXBhcmF0b3IpID8gdGhpcy5jb21wYXJhdG9yIDogbnVsbDsKICAgICAgdmFyIHRvQWRkID0gW10sIHRvUmVtb3ZlID0gW10sIG1vZGVsTWFwID0ge307CiAgICAgIHZhciBhZGQgPSBvcHRpb25zLmFkZCwgbWVyZ2UgPSBvcHRpb25zLm1lcmdlLCByZW1vdmUgPSBvcHRpb25zLnJlbW92ZTsKICAgICAgdmFyIG9yZGVyID0gIXNvcnRhYmxlICYmIGFkZCAmJiByZW1vdmUgPyBbXSA6IGZhbHNlOwoKICAgICAgLy8gVHVybiBiYXJlIG9iamVjdHMgaW50byBtb2RlbCByZWZlcmVuY2VzLCBhbmQgcHJldmVudCBpbnZhbGlkIG1vZGVscwogICAgICAvLyBmcm9tIGJlaW5nIGFkZGVkLgogICAgICBmb3IgKGkgPSAwLCBsID0gbW9kZWxzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIGF0dHJzID0gbW9kZWxzW2ldIHx8IHt9OwogICAgICAgIGlmIChhdHRycyBpbnN0YW5jZW9mIE1vZGVsKSB7CiAgICAgICAgICBpZCA9IG1vZGVsID0gYXR0cnM7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlkID0gYXR0cnNbdGFyZ2V0TW9kZWwucHJvdG90eXBlLmlkQXR0cmlidXRlIHx8ICdpZCddOwogICAgICAgIH0KCiAgICAgICAgLy8gSWYgYSBkdXBsaWNhdGUgaXMgZm91bmQsIHByZXZlbnQgaXQgZnJvbSBiZWluZyBhZGRlZCBhbmQKICAgICAgICAvLyBvcHRpb25hbGx5IG1lcmdlIGl0IGludG8gdGhlIGV4aXN0aW5nIG1vZGVsLgogICAgICAgIGlmIChleGlzdGluZyA9IHRoaXMuZ2V0KGlkKSkgewogICAgICAgICAgaWYgKHJlbW92ZSkgbW9kZWxNYXBbZXhpc3RpbmcuY2lkXSA9IHRydWU7CiAgICAgICAgICBpZiAobWVyZ2UpIHsKICAgICAgICAgICAgYXR0cnMgPSBhdHRycyA9PT0gbW9kZWwgPyBtb2RlbC5hdHRyaWJ1dGVzIDogYXR0cnM7CiAgICAgICAgICAgIGlmIChvcHRpb25zLnBhcnNlKSBhdHRycyA9IGV4aXN0aW5nLnBhcnNlKGF0dHJzLCBvcHRpb25zKTsKICAgICAgICAgICAgZXhpc3Rpbmcuc2V0KGF0dHJzLCBvcHRpb25zKTsKICAgICAgICAgICAgaWYgKHNvcnRhYmxlICYmICFzb3J0ICYmIGV4aXN0aW5nLmhhc0NoYW5nZWQoc29ydEF0dHIpKSBzb3J0ID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICAgIG1vZGVsc1tpXSA9IGV4aXN0aW5nOwoKICAgICAgICAvLyBJZiB0aGlzIGlzIGEgbmV3LCB2YWxpZCBtb2RlbCwgcHVzaCBpdCB0byB0aGUgYHRvQWRkYCBsaXN0LgogICAgICAgIH0gZWxzZSBpZiAoYWRkKSB7CiAgICAgICAgICBtb2RlbCA9IG1vZGVsc1tpXSA9IHRoaXMuX3ByZXBhcmVNb2RlbChhdHRycywgb3B0aW9ucyk7CiAgICAgICAgICBpZiAoIW1vZGVsKSBjb250aW51ZTsKICAgICAgICAgIHRvQWRkLnB1c2gobW9kZWwpOwogICAgICAgICAgdGhpcy5fYWRkUmVmZXJlbmNlKG1vZGVsLCBvcHRpb25zKTsKICAgICAgICB9CgogICAgICAgIC8vIERvIG5vdCBhZGQgbXVsdGlwbGUgbW9kZWxzIHdpdGggdGhlIHNhbWUgYGlkYC4KICAgICAgICBtb2RlbCA9IGV4aXN0aW5nIHx8IG1vZGVsOwogICAgICAgIGlmIChvcmRlciAmJiAobW9kZWwuaXNOZXcoKSB8fCAhbW9kZWxNYXBbbW9kZWwuaWRdKSkgb3JkZXIucHVzaChtb2RlbCk7CiAgICAgICAgbW9kZWxNYXBbbW9kZWwuaWRdID0gdHJ1ZTsKICAgICAgfQoKICAgICAgLy8gUmVtb3ZlIG5vbmV4aXN0ZW50IG1vZGVscyBpZiBhcHByb3ByaWF0ZS4KICAgICAgaWYgKHJlbW92ZSkgewogICAgICAgIGZvciAoaSA9IDAsIGwgPSB0aGlzLmxlbmd0aDsgaSA8IGw7ICsraSkgewogICAgICAgICAgaWYgKCFtb2RlbE1hcFsobW9kZWwgPSB0aGlzLm1vZGVsc1tpXSkuY2lkXSkgdG9SZW1vdmUucHVzaChtb2RlbCk7CiAgICAgICAgfQogICAgICAgIGlmICh0b1JlbW92ZS5sZW5ndGgpIHRoaXMucmVtb3ZlKHRvUmVtb3ZlLCBvcHRpb25zKTsKICAgICAgfQoKICAgICAgLy8gU2VlIGlmIHNvcnRpbmcgaXMgbmVlZGVkLCB1cGRhdGUgYGxlbmd0aGAgYW5kIHNwbGljZSBpbiBuZXcgbW9kZWxzLgogICAgICBpZiAodG9BZGQubGVuZ3RoIHx8IChvcmRlciAmJiBvcmRlci5sZW5ndGgpKSB7CiAgICAgICAgaWYgKHNvcnRhYmxlKSBzb3J0ID0gdHJ1ZTsKICAgICAgICB0aGlzLmxlbmd0aCArPSB0b0FkZC5sZW5ndGg7CiAgICAgICAgaWYgKGF0ICE9IG51bGwpIHsKICAgICAgICAgIGZvciAoaSA9IDAsIGwgPSB0b0FkZC5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICAgICAgdGhpcy5tb2RlbHMuc3BsaWNlKGF0ICsgaSwgMCwgdG9BZGRbaV0pOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAob3JkZXIpIHRoaXMubW9kZWxzLmxlbmd0aCA9IDA7CiAgICAgICAgICB2YXIgb3JkZXJlZE1vZGVscyA9IG9yZGVyIHx8IHRvQWRkOwogICAgICAgICAgZm9yIChpID0gMCwgbCA9IG9yZGVyZWRNb2RlbHMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICAgIHRoaXMubW9kZWxzLnB1c2gob3JkZXJlZE1vZGVsc1tpXSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICAvLyBTaWxlbnRseSBzb3J0IHRoZSBjb2xsZWN0aW9uIGlmIGFwcHJvcHJpYXRlLgogICAgICBpZiAoc29ydCkgdGhpcy5zb3J0KHtzaWxlbnQ6IHRydWV9KTsKCiAgICAgIC8vIFVubGVzcyBzaWxlbmNlZCwgaXQncyB0aW1lIHRvIGZpcmUgYWxsIGFwcHJvcHJpYXRlIGFkZC9zb3J0IGV2ZW50cy4KICAgICAgaWYgKCFvcHRpb25zLnNpbGVudCkgewogICAgICAgIGZvciAoaSA9IDAsIGwgPSB0b0FkZC5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICAgIChtb2RlbCA9IHRvQWRkW2ldKS50cmlnZ2VyKCdhZGQnLCBtb2RlbCwgdGhpcywgb3B0aW9ucyk7CiAgICAgICAgfQogICAgICAgIGlmIChzb3J0IHx8IChvcmRlciAmJiBvcmRlci5sZW5ndGgpKSB0aGlzLnRyaWdnZXIoJ3NvcnQnLCB0aGlzLCBvcHRpb25zKTsKICAgICAgfQoKICAgICAgLy8gUmV0dXJuIHRoZSBhZGRlZCAob3IgbWVyZ2VkKSBtb2RlbCAob3IgbW9kZWxzKS4KICAgICAgcmV0dXJuIHNpbmd1bGFyID8gbW9kZWxzWzBdIDogbW9kZWxzOwogICAgfSwKCiAgICAvLyBXaGVuIHlvdSBoYXZlIG1vcmUgaXRlbXMgdGhhbiB5b3Ugd2FudCB0byBhZGQgb3IgcmVtb3ZlIGluZGl2aWR1YWxseSwKICAgIC8vIHlvdSBjYW4gcmVzZXQgdGhlIGVudGlyZSBzZXQgd2l0aCBhIG5ldyBsaXN0IG9mIG1vZGVscywgd2l0aG91dCBmaXJpbmcKICAgIC8vIGFueSBncmFudWxhciBgYWRkYCBvciBgcmVtb3ZlYCBldmVudHMuIEZpcmVzIGByZXNldGAgd2hlbiBmaW5pc2hlZC4KICAgIC8vIFVzZWZ1bCBmb3IgYnVsayBvcGVyYXRpb25zIGFuZCBvcHRpbWl6YXRpb25zLgogICAgcmVzZXQ6IGZ1bmN0aW9uKG1vZGVscywgb3B0aW9ucykgewogICAgICBvcHRpb25zIHx8IChvcHRpb25zID0ge30pOwogICAgICBmb3IgKHZhciBpID0gMCwgbCA9IHRoaXMubW9kZWxzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIHRoaXMuX3JlbW92ZVJlZmVyZW5jZSh0aGlzLm1vZGVsc1tpXSwgb3B0aW9ucyk7CiAgICAgIH0KICAgICAgb3B0aW9ucy5wcmV2aW91c01vZGVscyA9IHRoaXMubW9kZWxzOwogICAgICB0aGlzLl9yZXNldCgpOwogICAgICBtb2RlbHMgPSB0aGlzLmFkZChtb2RlbHMsIF8uZXh0ZW5kKHtzaWxlbnQ6IHRydWV9LCBvcHRpb25zKSk7CiAgICAgIGlmICghb3B0aW9ucy5zaWxlbnQpIHRoaXMudHJpZ2dlcigncmVzZXQnLCB0aGlzLCBvcHRpb25zKTsKICAgICAgcmV0dXJuIG1vZGVsczsKICAgIH0sCgogICAgLy8gQWRkIGEgbW9kZWwgdG8gdGhlIGVuZCBvZiB0aGUgY29sbGVjdGlvbi4KICAgIHB1c2g6IGZ1bmN0aW9uKG1vZGVsLCBvcHRpb25zKSB7CiAgICAgIHJldHVybiB0aGlzLmFkZChtb2RlbCwgXy5leHRlbmQoe2F0OiB0aGlzLmxlbmd0aH0sIG9wdGlvbnMpKTsKICAgIH0sCgogICAgLy8gUmVtb3ZlIGEgbW9kZWwgZnJvbSB0aGUgZW5kIG9mIHRoZSBjb2xsZWN0aW9uLgogICAgcG9wOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgIHZhciBtb2RlbCA9IHRoaXMuYXQodGhpcy5sZW5ndGggLSAxKTsKICAgICAgdGhpcy5yZW1vdmUobW9kZWwsIG9wdGlvbnMpOwogICAgICByZXR1cm4gbW9kZWw7CiAgICB9LAoKICAgIC8vIEFkZCBhIG1vZGVsIHRvIHRoZSBiZWdpbm5pbmcgb2YgdGhlIGNvbGxlY3Rpb24uCiAgICB1bnNoaWZ0OiBmdW5jdGlvbihtb2RlbCwgb3B0aW9ucykgewogICAgICByZXR1cm4gdGhpcy5hZGQobW9kZWwsIF8uZXh0ZW5kKHthdDogMH0sIG9wdGlvbnMpKTsKICAgIH0sCgogICAgLy8gUmVtb3ZlIGEgbW9kZWwgZnJvbSB0aGUgYmVnaW5uaW5nIG9mIHRoZSBjb2xsZWN0aW9uLgogICAgc2hpZnQ6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgdmFyIG1vZGVsID0gdGhpcy5hdCgwKTsKICAgICAgdGhpcy5yZW1vdmUobW9kZWwsIG9wdGlvbnMpOwogICAgICByZXR1cm4gbW9kZWw7CiAgICB9LAoKICAgIC8vIFNsaWNlIG91dCBhIHN1Yi1hcnJheSBvZiBtb2RlbHMgZnJvbSB0aGUgY29sbGVjdGlvbi4KICAgIHNsaWNlOiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIHNsaWNlLmFwcGx5KHRoaXMubW9kZWxzLCBhcmd1bWVudHMpOwogICAgfSwKCiAgICAvLyBHZXQgYSBtb2RlbCBmcm9tIHRoZSBzZXQgYnkgaWQuCiAgICBnZXQ6IGZ1bmN0aW9uKG9iaikgewogICAgICBpZiAob2JqID09IG51bGwpIHJldHVybiB2b2lkIDA7CiAgICAgIHJldHVybiB0aGlzLl9ieUlkW29ial0gfHwgdGhpcy5fYnlJZFtvYmouaWRdIHx8IHRoaXMuX2J5SWRbb2JqLmNpZF07CiAgICB9LAoKICAgIC8vIEdldCB0aGUgbW9kZWwgYXQgdGhlIGdpdmVuIGluZGV4LgogICAgYXQ6IGZ1bmN0aW9uKGluZGV4KSB7CiAgICAgIHJldHVybiB0aGlzLm1vZGVsc1tpbmRleF07CiAgICB9LAoKICAgIC8vIFJldHVybiBtb2RlbHMgd2l0aCBtYXRjaGluZyBhdHRyaWJ1dGVzLiBVc2VmdWwgZm9yIHNpbXBsZSBjYXNlcyBvZgogICAgLy8gYGZpbHRlcmAuCiAgICB3aGVyZTogZnVuY3Rpb24oYXR0cnMsIGZpcnN0KSB7CiAgICAgIGlmIChfLmlzRW1wdHkoYXR0cnMpKSByZXR1cm4gZmlyc3QgPyB2b2lkIDAgOiBbXTsKICAgICAgcmV0dXJuIHRoaXNbZmlyc3QgPyAnZmluZCcgOiAnZmlsdGVyJ10oZnVuY3Rpb24obW9kZWwpIHsKICAgICAgICBmb3IgKHZhciBrZXkgaW4gYXR0cnMpIHsKICAgICAgICAgIGlmIChhdHRyc1trZXldICE9PSBtb2RlbC5nZXQoa2V5KSkgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfSk7CiAgICB9LAoKICAgIC8vIFJldHVybiB0aGUgZmlyc3QgbW9kZWwgd2l0aCBtYXRjaGluZyBhdHRyaWJ1dGVzLiBVc2VmdWwgZm9yIHNpbXBsZSBjYXNlcwogICAgLy8gb2YgYGZpbmRgLgogICAgZmluZFdoZXJlOiBmdW5jdGlvbihhdHRycykgewogICAgICByZXR1cm4gdGhpcy53aGVyZShhdHRycywgdHJ1ZSk7CiAgICB9LAoKICAgIC8vIEZvcmNlIHRoZSBjb2xsZWN0aW9uIHRvIHJlLXNvcnQgaXRzZWxmLiBZb3UgZG9uJ3QgbmVlZCB0byBjYWxsIHRoaXMgdW5kZXIKICAgIC8vIG5vcm1hbCBjaXJjdW1zdGFuY2VzLCBhcyB0aGUgc2V0IHdpbGwgbWFpbnRhaW4gc29ydCBvcmRlciBhcyBlYWNoIGl0ZW0KICAgIC8vIGlzIGFkZGVkLgogICAgc29ydDogZnVuY3Rpb24ob3B0aW9ucykgewogICAgICBpZiAoIXRoaXMuY29tcGFyYXRvcikgdGhyb3cgbmV3IEVycm9yKCdDYW5ub3Qgc29ydCBhIHNldCB3aXRob3V0IGEgY29tcGFyYXRvcicpOwogICAgICBvcHRpb25zIHx8IChvcHRpb25zID0ge30pOwoKICAgICAgLy8gUnVuIHNvcnQgYmFzZWQgb24gdHlwZSBvZiBgY29tcGFyYXRvcmAuCiAgICAgIGlmIChfLmlzU3RyaW5nKHRoaXMuY29tcGFyYXRvcikgfHwgdGhpcy5jb21wYXJhdG9yLmxlbmd0aCA9PT0gMSkgewogICAgICAgIHRoaXMubW9kZWxzID0gdGhpcy5zb3J0QnkodGhpcy5jb21wYXJhdG9yLCB0aGlzKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLm1vZGVscy5zb3J0KF8uYmluZCh0aGlzLmNvbXBhcmF0b3IsIHRoaXMpKTsKICAgICAgfQoKICAgICAgaWYgKCFvcHRpb25zLnNpbGVudCkgdGhpcy50cmlnZ2VyKCdzb3J0JywgdGhpcywgb3B0aW9ucyk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvLyBQbHVjayBhbiBhdHRyaWJ1dGUgZnJvbSBlYWNoIG1vZGVsIGluIHRoZSBjb2xsZWN0aW9uLgogICAgcGx1Y2s6IGZ1bmN0aW9uKGF0dHIpIHsKICAgICAgcmV0dXJuIF8uaW52b2tlKHRoaXMubW9kZWxzLCAnZ2V0JywgYXR0cik7CiAgICB9LAoKICAgIC8vIEZldGNoIHRoZSBkZWZhdWx0IHNldCBvZiBtb2RlbHMgZm9yIHRoaXMgY29sbGVjdGlvbiwgcmVzZXR0aW5nIHRoZQogICAgLy8gY29sbGVjdGlvbiB3aGVuIHRoZXkgYXJyaXZlLiBJZiBgcmVzZXQ6IHRydWVgIGlzIHBhc3NlZCwgdGhlIHJlc3BvbnNlCiAgICAvLyBkYXRhIHdpbGwgYmUgcGFzc2VkIHRocm91Z2ggdGhlIGByZXNldGAgbWV0aG9kIGluc3RlYWQgb2YgYHNldGAuCiAgICBmZXRjaDogZnVuY3Rpb24ob3B0aW9ucykgewogICAgICBvcHRpb25zID0gb3B0aW9ucyA/IF8uY2xvbmUob3B0aW9ucykgOiB7fTsKICAgICAgaWYgKG9wdGlvbnMucGFyc2UgPT09IHZvaWQgMCkgb3B0aW9ucy5wYXJzZSA9IHRydWU7CiAgICAgIHZhciBzdWNjZXNzID0gb3B0aW9ucy5zdWNjZXNzOwogICAgICB2YXIgY29sbGVjdGlvbiA9IHRoaXM7CiAgICAgIG9wdGlvbnMuc3VjY2VzcyA9IGZ1bmN0aW9uKHJlc3ApIHsKICAgICAgICB2YXIgbWV0aG9kID0gb3B0aW9ucy5yZXNldCA/ICdyZXNldCcgOiAnc2V0JzsKICAgICAgICBjb2xsZWN0aW9uW21ldGhvZF0ocmVzcCwgb3B0aW9ucyk7CiAgICAgICAgaWYgKHN1Y2Nlc3MpIHN1Y2Nlc3MoY29sbGVjdGlvbiwgcmVzcCwgb3B0aW9ucyk7CiAgICAgICAgY29sbGVjdGlvbi50cmlnZ2VyKCdzeW5jJywgY29sbGVjdGlvbiwgcmVzcCwgb3B0aW9ucyk7CiAgICAgIH07CiAgICAgIHdyYXBFcnJvcih0aGlzLCBvcHRpb25zKTsKICAgICAgcmV0dXJuIHRoaXMuc3luYygncmVhZCcsIHRoaXMsIG9wdGlvbnMpOwogICAgfSwKCiAgICAvLyBDcmVhdGUgYSBuZXcgaW5zdGFuY2Ugb2YgYSBtb2RlbCBpbiB0aGlzIGNvbGxlY3Rpb24uIEFkZCB0aGUgbW9kZWwgdG8gdGhlCiAgICAvLyBjb2xsZWN0aW9uIGltbWVkaWF0ZWx5LCB1bmxlc3MgYHdhaXQ6IHRydWVgIGlzIHBhc3NlZCwgaW4gd2hpY2ggY2FzZSB3ZQogICAgLy8gd2FpdCBmb3IgdGhlIHNlcnZlciB0byBhZ3JlZS4KICAgIGNyZWF0ZTogZnVuY3Rpb24obW9kZWwsIG9wdGlvbnMpIHsKICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgPyBfLmNsb25lKG9wdGlvbnMpIDoge307CiAgICAgIGlmICghKG1vZGVsID0gdGhpcy5fcHJlcGFyZU1vZGVsKG1vZGVsLCBvcHRpb25zKSkpIHJldHVybiBmYWxzZTsKICAgICAgaWYgKCFvcHRpb25zLndhaXQpIHRoaXMuYWRkKG1vZGVsLCBvcHRpb25zKTsKICAgICAgdmFyIGNvbGxlY3Rpb24gPSB0aGlzOwogICAgICB2YXIgc3VjY2VzcyA9IG9wdGlvbnMuc3VjY2VzczsKICAgICAgb3B0aW9ucy5zdWNjZXNzID0gZnVuY3Rpb24obW9kZWwsIHJlc3ApIHsKICAgICAgICBpZiAob3B0aW9ucy53YWl0KSBjb2xsZWN0aW9uLmFkZChtb2RlbCwgb3B0aW9ucyk7CiAgICAgICAgaWYgKHN1Y2Nlc3MpIHN1Y2Nlc3MobW9kZWwsIHJlc3AsIG9wdGlvbnMpOwogICAgICB9OwogICAgICBtb2RlbC5zYXZlKG51bGwsIG9wdGlvbnMpOwogICAgICByZXR1cm4gbW9kZWw7CiAgICB9LAoKICAgIC8vICoqcGFyc2UqKiBjb252ZXJ0cyBhIHJlc3BvbnNlIGludG8gYSBsaXN0IG9mIG1vZGVscyB0byBiZSBhZGRlZCB0byB0aGUKICAgIC8vIGNvbGxlY3Rpb24uIFRoZSBkZWZhdWx0IGltcGxlbWVudGF0aW9uIGlzIGp1c3QgdG8gcGFzcyBpdCB0aHJvdWdoLgogICAgcGFyc2U6IGZ1bmN0aW9uKHJlc3AsIG9wdGlvbnMpIHsKICAgICAgcmV0dXJuIHJlc3A7CiAgICB9LAoKICAgIC8vIENyZWF0ZSBhIG5ldyBjb2xsZWN0aW9uIHdpdGggYW4gaWRlbnRpY2FsIGxpc3Qgb2YgbW9kZWxzIGFzIHRoaXMgb25lLgogICAgY2xvbmU6IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IodGhpcy5tb2RlbHMpOwogICAgfSwKCiAgICAvLyBQcml2YXRlIG1ldGhvZCB0byByZXNldCBhbGwgaW50ZXJuYWwgc3RhdGUuIENhbGxlZCB3aGVuIHRoZSBjb2xsZWN0aW9uCiAgICAvLyBpcyBmaXJzdCBpbml0aWFsaXplZCBvciByZXNldC4KICAgIF9yZXNldDogZnVuY3Rpb24oKSB7CiAgICAgIHRoaXMubGVuZ3RoID0gMDsKICAgICAgdGhpcy5tb2RlbHMgPSBbXTsKICAgICAgdGhpcy5fYnlJZCAgPSB7fTsKICAgIH0sCgogICAgLy8gUHJlcGFyZSBhIGhhc2ggb2YgYXR0cmlidXRlcyAob3Igb3RoZXIgbW9kZWwpIHRvIGJlIGFkZGVkIHRvIHRoaXMKICAgIC8vIGNvbGxlY3Rpb24uCiAgICBfcHJlcGFyZU1vZGVsOiBmdW5jdGlvbihhdHRycywgb3B0aW9ucykgewogICAgICBpZiAoYXR0cnMgaW5zdGFuY2VvZiBNb2RlbCkgcmV0dXJuIGF0dHJzOwogICAgICBvcHRpb25zID0gb3B0aW9ucyA/IF8uY2xvbmUob3B0aW9ucykgOiB7fTsKICAgICAgb3B0aW9ucy5jb2xsZWN0aW9uID0gdGhpczsKICAgICAgdmFyIG1vZGVsID0gbmV3IHRoaXMubW9kZWwoYXR0cnMsIG9wdGlvbnMpOwogICAgICBpZiAoIW1vZGVsLnZhbGlkYXRpb25FcnJvcikgcmV0dXJuIG1vZGVsOwogICAgICB0aGlzLnRyaWdnZXIoJ2ludmFsaWQnLCB0aGlzLCBtb2RlbC52YWxpZGF0aW9uRXJyb3IsIG9wdGlvbnMpOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9LAoKICAgIC8vIEludGVybmFsIG1ldGhvZCB0byBjcmVhdGUgYSBtb2RlbCdzIHRpZXMgdG8gYSBjb2xsZWN0aW9uLgogICAgX2FkZFJlZmVyZW5jZTogZnVuY3Rpb24obW9kZWwsIG9wdGlvbnMpIHsKICAgICAgdGhpcy5fYnlJZFttb2RlbC5jaWRdID0gbW9kZWw7CiAgICAgIGlmIChtb2RlbC5pZCAhPSBudWxsKSB0aGlzLl9ieUlkW21vZGVsLmlkXSA9IG1vZGVsOwogICAgICBpZiAoIW1vZGVsLmNvbGxlY3Rpb24pIG1vZGVsLmNvbGxlY3Rpb24gPSB0aGlzOwogICAgICBtb2RlbC5vbignYWxsJywgdGhpcy5fb25Nb2RlbEV2ZW50LCB0aGlzKTsKICAgIH0sCgogICAgLy8gSW50ZXJuYWwgbWV0aG9kIHRvIHNldmVyIGEgbW9kZWwncyB0aWVzIHRvIGEgY29sbGVjdGlvbi4KICAgIF9yZW1vdmVSZWZlcmVuY2U6IGZ1bmN0aW9uKG1vZGVsLCBvcHRpb25zKSB7CiAgICAgIGlmICh0aGlzID09PSBtb2RlbC5jb2xsZWN0aW9uKSBkZWxldGUgbW9kZWwuY29sbGVjdGlvbjsKICAgICAgbW9kZWwub2ZmKCdhbGwnLCB0aGlzLl9vbk1vZGVsRXZlbnQsIHRoaXMpOwogICAgfSwKCiAgICAvLyBJbnRlcm5hbCBtZXRob2QgY2FsbGVkIGV2ZXJ5IHRpbWUgYSBtb2RlbCBpbiB0aGUgc2V0IGZpcmVzIGFuIGV2ZW50LgogICAgLy8gU2V0cyBuZWVkIHRvIHVwZGF0ZSB0aGVpciBpbmRleGVzIHdoZW4gbW9kZWxzIGNoYW5nZSBpZHMuIEFsbCBvdGhlcgogICAgLy8gZXZlbnRzIHNpbXBseSBwcm94eSB0aHJvdWdoLiAiYWRkIiBhbmQgInJlbW92ZSIgZXZlbnRzIHRoYXQgb3JpZ2luYXRlCiAgICAvLyBpbiBvdGhlciBjb2xsZWN0aW9ucyBhcmUgaWdub3JlZC4KICAgIF9vbk1vZGVsRXZlbnQ6IGZ1bmN0aW9uKGV2ZW50LCBtb2RlbCwgY29sbGVjdGlvbiwgb3B0aW9ucykgewogICAgICBpZiAoKGV2ZW50ID09PSAnYWRkJyB8fCBldmVudCA9PT0gJ3JlbW92ZScpICYmIGNvbGxlY3Rpb24gIT09IHRoaXMpIHJldHVybjsKICAgICAgaWYgKGV2ZW50ID09PSAnZGVzdHJveScpIHRoaXMucmVtb3ZlKG1vZGVsLCBvcHRpb25zKTsKICAgICAgaWYgKG1vZGVsICYmIGV2ZW50ID09PSAnY2hhbmdlOicgKyBtb2RlbC5pZEF0dHJpYnV0ZSkgewogICAgICAgIGRlbGV0ZSB0aGlzLl9ieUlkW21vZGVsLnByZXZpb3VzKG1vZGVsLmlkQXR0cmlidXRlKV07CiAgICAgICAgaWYgKG1vZGVsLmlkICE9IG51bGwpIHRoaXMuX2J5SWRbbW9kZWwuaWRdID0gbW9kZWw7CiAgICAgIH0KICAgICAgdGhpcy50cmlnZ2VyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICB9CgogIH0pOwoKICAvLyBVbmRlcnNjb3JlIG1ldGhvZHMgdGhhdCB3ZSB3YW50IHRvIGltcGxlbWVudCBvbiB0aGUgQ29sbGVjdGlvbi4KICAvLyA5MCUgb2YgdGhlIGNvcmUgdXNlZnVsbmVzcyBvZiBCYWNrYm9uZSBDb2xsZWN0aW9ucyBpcyBhY3R1YWxseSBpbXBsZW1lbnRlZAogIC8vIHJpZ2h0IGhlcmU6CiAgdmFyIG1ldGhvZHMgPSBbJ2ZvckVhY2gnLCAnZWFjaCcsICdtYXAnLCAnY29sbGVjdCcsICdyZWR1Y2UnLCAnZm9sZGwnLAogICAgJ2luamVjdCcsICdyZWR1Y2VSaWdodCcsICdmb2xkcicsICdmaW5kJywgJ2RldGVjdCcsICdmaWx0ZXInLCAnc2VsZWN0JywKICAgICdyZWplY3QnLCAnZXZlcnknLCAnYWxsJywgJ3NvbWUnLCAnYW55JywgJ2luY2x1ZGUnLCAnY29udGFpbnMnLCAnaW52b2tlJywKICAgICdtYXgnLCAnbWluJywgJ3RvQXJyYXknLCAnc2l6ZScsICdmaXJzdCcsICdoZWFkJywgJ3Rha2UnLCAnaW5pdGlhbCcsICdyZXN0JywKICAgICd0YWlsJywgJ2Ryb3AnLCAnbGFzdCcsICd3aXRob3V0JywgJ2RpZmZlcmVuY2UnLCAnaW5kZXhPZicsICdzaHVmZmxlJywKICAgICdsYXN0SW5kZXhPZicsICdpc0VtcHR5JywgJ2NoYWluJywgJ3NhbXBsZSddOwoKICAvLyBNaXggaW4gZWFjaCBVbmRlcnNjb3JlIG1ldGhvZCBhcyBhIHByb3h5IHRvIGBDb2xsZWN0aW9uI21vZGVsc2AuCiAgXy5lYWNoKG1ldGhvZHMsIGZ1bmN0aW9uKG1ldGhvZCkgewogICAgQ29sbGVjdGlvbi5wcm90b3R5cGVbbWV0aG9kXSA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgYXJncyA9IHNsaWNlLmNhbGwoYXJndW1lbnRzKTsKICAgICAgYXJncy51bnNoaWZ0KHRoaXMubW9kZWxzKTsKICAgICAgcmV0dXJuIF9bbWV0aG9kXS5hcHBseShfLCBhcmdzKTsKICAgIH07CiAgfSk7CgogIC8vIFVuZGVyc2NvcmUgbWV0aG9kcyB0aGF0IHRha2UgYSBwcm9wZXJ0eSBuYW1lIGFzIGFuIGFyZ3VtZW50LgogIHZhciBhdHRyaWJ1dGVNZXRob2RzID0gWydncm91cEJ5JywgJ2NvdW50QnknLCAnc29ydEJ5JywgJ2luZGV4QnknXTsKCiAgLy8gVXNlIGF0dHJpYnV0ZXMgaW5zdGVhZCBvZiBwcm9wZXJ0aWVzLgogIF8uZWFjaChhdHRyaWJ1dGVNZXRob2RzLCBmdW5jdGlvbihtZXRob2QpIHsKICAgIENvbGxlY3Rpb24ucHJvdG90eXBlW21ldGhvZF0gPSBmdW5jdGlvbih2YWx1ZSwgY29udGV4dCkgewogICAgICB2YXIgaXRlcmF0b3IgPSBfLmlzRnVuY3Rpb24odmFsdWUpID8gdmFsdWUgOiBmdW5jdGlvbihtb2RlbCkgewogICAgICAgIHJldHVybiBtb2RlbC5nZXQodmFsdWUpOwogICAgICB9OwogICAgICByZXR1cm4gX1ttZXRob2RdKHRoaXMubW9kZWxzLCBpdGVyYXRvciwgY29udGV4dCk7CiAgICB9OwogIH0pOwoKICAvLyBCYWNrYm9uZS5WaWV3CiAgLy8gLS0tLS0tLS0tLS0tLQoKICAvLyBCYWNrYm9uZSBWaWV3cyBhcmUgYWxtb3N0IG1vcmUgY29udmVudGlvbiB0aGFuIHRoZXkgYXJlIGFjdHVhbCBjb2RlLiBBIFZpZXcKICAvLyBpcyBzaW1wbHkgYSBKYXZhU2NyaXB0IG9iamVjdCB0aGF0IHJlcHJlc2VudHMgYSBsb2dpY2FsIGNodW5rIG9mIFVJIGluIHRoZQogIC8vIERPTS4gVGhpcyBtaWdodCBiZSBhIHNpbmdsZSBpdGVtLCBhbiBlbnRpcmUgbGlzdCwgYSBzaWRlYmFyIG9yIHBhbmVsLCBvcgogIC8vIGV2ZW4gdGhlIHN1cnJvdW5kaW5nIGZyYW1lIHdoaWNoIHdyYXBzIHlvdXIgd2hvbGUgYXBwLiBEZWZpbmluZyBhIGNodW5rIG9mCiAgLy8gVUkgYXMgYSAqKlZpZXcqKiBhbGxvd3MgeW91IHRvIGRlZmluZSB5b3VyIERPTSBldmVudHMgZGVjbGFyYXRpdmVseSwgd2l0aG91dAogIC8vIGhhdmluZyB0byB3b3JyeSBhYm91dCByZW5kZXIgb3JkZXIgLi4uIGFuZCBtYWtlcyBpdCBlYXN5IGZvciB0aGUgdmlldyB0bwogIC8vIHJlYWN0IHRvIHNwZWNpZmljIGNoYW5nZXMgaW4gdGhlIHN0YXRlIG9mIHlvdXIgbW9kZWxzLgoKICAvLyBDcmVhdGluZyBhIEJhY2tib25lLlZpZXcgY3JlYXRlcyBpdHMgaW5pdGlhbCBlbGVtZW50IG91dHNpZGUgb2YgdGhlIERPTSwKICAvLyBpZiBhbiBleGlzdGluZyBlbGVtZW50IGlzIG5vdCBwcm92aWRlZC4uLgogIHZhciBWaWV3ID0gQmFja2JvbmUuVmlldyA9IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgIHRoaXMuY2lkID0gXy51bmlxdWVJZCgndmlldycpOwogICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTsKICAgIF8uZXh0ZW5kKHRoaXMsIF8ucGljayhvcHRpb25zLCB2aWV3T3B0aW9ucykpOwogICAgdGhpcy5fZW5zdXJlRWxlbWVudCgpOwogICAgdGhpcy5pbml0aWFsaXplLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICB0aGlzLmRlbGVnYXRlRXZlbnRzKCk7CiAgfTsKCiAgLy8gQ2FjaGVkIHJlZ2V4IHRvIHNwbGl0IGtleXMgZm9yIGBkZWxlZ2F0ZWAuCiAgdmFyIGRlbGVnYXRlRXZlbnRTcGxpdHRlciA9IC9eKFxTKylccyooLiopJC87CgogIC8vIExpc3Qgb2YgdmlldyBvcHRpb25zIHRvIGJlIG1lcmdlZCBhcyBwcm9wZXJ0aWVzLgogIHZhciB2aWV3T3B0aW9ucyA9IFsnbW9kZWwnLCAnY29sbGVjdGlvbicsICdlbCcsICdpZCcsICdhdHRyaWJ1dGVzJywgJ2NsYXNzTmFtZScsICd0YWdOYW1lJywgJ2V2ZW50cyddOwoKICAvLyBTZXQgdXAgYWxsIGluaGVyaXRhYmxlICoqQmFja2JvbmUuVmlldyoqIHByb3BlcnRpZXMgYW5kIG1ldGhvZHMuCiAgXy5leHRlbmQoVmlldy5wcm90b3R5cGUsIEV2ZW50cywgewoKICAgIC8vIFRoZSBkZWZhdWx0IGB0YWdOYW1lYCBvZiBhIFZpZXcncyBlbGVtZW50IGlzIGAiZGl2ImAuCiAgICB0YWdOYW1lOiAnZGl2JywKCiAgICAvLyBqUXVlcnkgZGVsZWdhdGUgZm9yIGVsZW1lbnQgbG9va3VwLCBzY29wZWQgdG8gRE9NIGVsZW1lbnRzIHdpdGhpbiB0aGUKICAgIC8vIGN1cnJlbnQgdmlldy4gVGhpcyBzaG91bGQgYmUgcHJlZmVycmVkIHRvIGdsb2JhbCBsb29rdXBzIHdoZXJlIHBvc3NpYmxlLgogICAgJDogZnVuY3Rpb24oc2VsZWN0b3IpIHsKICAgICAgcmV0dXJuIHRoaXMuJGVsLmZpbmQoc2VsZWN0b3IpOwogICAgfSwKCiAgICAvLyBJbml0aWFsaXplIGlzIGFuIGVtcHR5IGZ1bmN0aW9uIGJ5IGRlZmF1bHQuIE92ZXJyaWRlIGl0IHdpdGggeW91ciBvd24KICAgIC8vIGluaXRpYWxpemF0aW9uIGxvZ2ljLgogICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKXt9LAoKICAgIC8vICoqcmVuZGVyKiogaXMgdGhlIGNvcmUgZnVuY3Rpb24gdGhhdCB5b3VyIHZpZXcgc2hvdWxkIG92ZXJyaWRlLCBpbiBvcmRlcgogICAgLy8gdG8gcG9wdWxhdGUgaXRzIGVsZW1lbnQgKGB0aGlzLmVsYCksIHdpdGggdGhlIGFwcHJvcHJpYXRlIEhUTUwuIFRoZQogICAgLy8gY29udmVudGlvbiBpcyBmb3IgKipyZW5kZXIqKiB0byBhbHdheXMgcmV0dXJuIGB0aGlzYC4KICAgIHJlbmRlcjogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvLyBSZW1vdmUgdGhpcyB2aWV3IGJ5IHRha2luZyB0aGUgZWxlbWVudCBvdXQgb2YgdGhlIERPTSwgYW5kIHJlbW92aW5nIGFueQogICAgLy8gYXBwbGljYWJsZSBCYWNrYm9uZS5FdmVudHMgbGlzdGVuZXJzLgogICAgcmVtb3ZlOiBmdW5jdGlvbigpIHsKICAgICAgdGhpcy4kZWwucmVtb3ZlKCk7CiAgICAgIHRoaXMuc3RvcExpc3RlbmluZygpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLy8gQ2hhbmdlIHRoZSB2aWV3J3MgZWxlbWVudCAoYHRoaXMuZWxgIHByb3BlcnR5KSwgaW5jbHVkaW5nIGV2ZW50CiAgICAvLyByZS1kZWxlZ2F0aW9uLgogICAgc2V0RWxlbWVudDogZnVuY3Rpb24oZWxlbWVudCwgZGVsZWdhdGUpIHsKICAgICAgaWYgKHRoaXMuJGVsKSB0aGlzLnVuZGVsZWdhdGVFdmVudHMoKTsKICAgICAgdGhpcy4kZWwgPSBlbGVtZW50IGluc3RhbmNlb2YgQmFja2JvbmUuJCA/IGVsZW1lbnQgOiBCYWNrYm9uZS4kKGVsZW1lbnQpOwogICAgICB0aGlzLmVsID0gdGhpcy4kZWxbMF07CiAgICAgIGlmIChkZWxlZ2F0ZSAhPT0gZmFsc2UpIHRoaXMuZGVsZWdhdGVFdmVudHMoKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAoKICAgIC8vIFNldCBjYWxsYmFja3MsIHdoZXJlIGB0aGlzLmV2ZW50c2AgaXMgYSBoYXNoIG9mCiAgICAvLwogICAgLy8gKnsiZXZlbnQgc2VsZWN0b3IiOiAiY2FsbGJhY2sifSoKICAgIC8vCiAgICAvLyAgICAgewogICAgLy8gICAgICAgJ21vdXNlZG93biAudGl0bGUnOiAgJ2VkaXQnLAogICAgLy8gICAgICAgJ2NsaWNrIC5idXR0b24nOiAgICAgJ3NhdmUnLAogICAgLy8gICAgICAgJ2NsaWNrIC5vcGVuJzogICAgICAgZnVuY3Rpb24oZSkgeyAuLi4gfQogICAgLy8gICAgIH0KICAgIC8vCiAgICAvLyBwYWlycy4gQ2FsbGJhY2tzIHdpbGwgYmUgYm91bmQgdG8gdGhlIHZpZXcsIHdpdGggYHRoaXNgIHNldCBwcm9wZXJseS4KICAgIC8vIFVzZXMgZXZlbnQgZGVsZWdhdGlvbiBmb3IgZWZmaWNpZW5jeS4KICAgIC8vIE9taXR0aW5nIHRoZSBzZWxlY3RvciBiaW5kcyB0aGUgZXZlbnQgdG8gYHRoaXMuZWxgLgogICAgLy8gVGhpcyBvbmx5IHdvcmtzIGZvciBkZWxlZ2F0ZS1hYmxlIGV2ZW50czogbm90IGBmb2N1c2AsIGBibHVyYCwgYW5kCiAgICAvLyBub3QgYGNoYW5nZWAsIGBzdWJtaXRgLCBhbmQgYHJlc2V0YCBpbiBJbnRlcm5ldCBFeHBsb3Jlci4KICAgIGRlbGVnYXRlRXZlbnRzOiBmdW5jdGlvbihldmVudHMpIHsKICAgICAgaWYgKCEoZXZlbnRzIHx8IChldmVudHMgPSBfLnJlc3VsdCh0aGlzLCAnZXZlbnRzJykpKSkgcmV0dXJuIHRoaXM7CiAgICAgIHRoaXMudW5kZWxlZ2F0ZUV2ZW50cygpOwogICAgICBmb3IgKHZhciBrZXkgaW4gZXZlbnRzKSB7CiAgICAgICAgdmFyIG1ldGhvZCA9IGV2ZW50c1trZXldOwogICAgICAgIGlmICghXy5pc0Z1bmN0aW9uKG1ldGhvZCkpIG1ldGhvZCA9IHRoaXNbZXZlbnRzW2tleV1dOwogICAgICAgIGlmICghbWV0aG9kKSBjb250aW51ZTsKCiAgICAgICAgdmFyIG1hdGNoID0ga2V5Lm1hdGNoKGRlbGVnYXRlRXZlbnRTcGxpdHRlcik7CiAgICAgICAgdmFyIGV2ZW50TmFtZSA9IG1hdGNoWzFdLCBzZWxlY3RvciA9IG1hdGNoWzJdOwogICAgICAgIG1ldGhvZCA9IF8uYmluZChtZXRob2QsIHRoaXMpOwogICAgICAgIGV2ZW50TmFtZSArPSAnLmRlbGVnYXRlRXZlbnRzJyArIHRoaXMuY2lkOwogICAgICAgIGlmIChzZWxlY3RvciA9PT0gJycpIHsKICAgICAgICAgIHRoaXMuJGVsLm9uKGV2ZW50TmFtZSwgbWV0aG9kKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy4kZWwub24oZXZlbnROYW1lLCBzZWxlY3RvciwgbWV0aG9kKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAoKICAgIC8vIENsZWFycyBhbGwgY2FsbGJhY2tzIHByZXZpb3VzbHkgYm91bmQgdG8gdGhlIHZpZXcgd2l0aCBgZGVsZWdhdGVFdmVudHNgLgogICAgLy8gWW91IHVzdWFsbHkgZG9uJ3QgbmVlZCB0byB1c2UgdGhpcywgYnV0IG1heSB3aXNoIHRvIGlmIHlvdSBoYXZlIG11bHRpcGxlCiAgICAvLyBCYWNrYm9uZSB2aWV3cyBhdHRhY2hlZCB0byB0aGUgc2FtZSBET00gZWxlbWVudC4KICAgIHVuZGVsZWdhdGVFdmVudHM6IGZ1bmN0aW9uKCkgewogICAgICB0aGlzLiRlbC5vZmYoJy5kZWxlZ2F0ZUV2ZW50cycgKyB0aGlzLmNpZCk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvLyBFbnN1cmUgdGhhdCB0aGUgVmlldyBoYXMgYSBET00gZWxlbWVudCB0byByZW5kZXIgaW50by4KICAgIC8vIElmIGB0aGlzLmVsYCBpcyBhIHN0cmluZywgcGFzcyBpdCB0aHJvdWdoIGAkKClgLCB0YWtlIHRoZSBmaXJzdAogICAgLy8gbWF0Y2hpbmcgZWxlbWVudCwgYW5kIHJlLWFzc2lnbiBpdCB0byBgZWxgLiBPdGhlcndpc2UsIGNyZWF0ZQogICAgLy8gYW4gZWxlbWVudCBmcm9tIHRoZSBgaWRgLCBgY2xhc3NOYW1lYCBhbmQgYHRhZ05hbWVgIHByb3BlcnRpZXMuCiAgICBfZW5zdXJlRWxlbWVudDogZnVuY3Rpb24oKSB7CiAgICAgIGlmICghdGhpcy5lbCkgewogICAgICAgIHZhciBhdHRycyA9IF8uZXh0ZW5kKHt9LCBfLnJlc3VsdCh0aGlzLCAnYXR0cmlidXRlcycpKTsKICAgICAgICBpZiAodGhpcy5pZCkgYXR0cnMuaWQgPSBfLnJlc3VsdCh0aGlzLCAnaWQnKTsKICAgICAgICBpZiAodGhpcy5jbGFzc05hbWUpIGF0dHJzWydjbGFzcyddID0gXy5yZXN1bHQodGhpcywgJ2NsYXNzTmFtZScpOwogICAgICAgIHZhciAkZWwgPSBCYWNrYm9uZS4kKCc8JyArIF8ucmVzdWx0KHRoaXMsICd0YWdOYW1lJykgKyAnPicpLmF0dHIoYXR0cnMpOwogICAgICAgIHRoaXMuc2V0RWxlbWVudCgkZWwsIGZhbHNlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnNldEVsZW1lbnQoXy5yZXN1bHQodGhpcywgJ2VsJyksIGZhbHNlKTsKICAgICAgfQogICAgfQoKICB9KTsKCiAgLy8gQmFja2JvbmUuc3luYwogIC8vIC0tLS0tLS0tLS0tLS0KCiAgLy8gT3ZlcnJpZGUgdGhpcyBmdW5jdGlvbiB0byBjaGFuZ2UgdGhlIG1hbm5lciBpbiB3aGljaCBCYWNrYm9uZSBwZXJzaXN0cwogIC8vIG1vZGVscyB0byB0aGUgc2VydmVyLiBZb3Ugd2lsbCBiZSBwYXNzZWQgdGhlIHR5cGUgb2YgcmVxdWVzdCwgYW5kIHRoZQogIC8vIG1vZGVsIGluIHF1ZXN0aW9uLiBCeSBkZWZhdWx0LCBtYWtlcyBhIFJFU1RmdWwgQWpheCByZXF1ZXN0CiAgLy8gdG8gdGhlIG1vZGVsJ3MgYHVybCgpYC4gU29tZSBwb3NzaWJsZSBjdXN0b21pemF0aW9ucyBjb3VsZCBiZToKICAvLwogIC8vICogVXNlIGBzZXRUaW1lb3V0YCB0byBiYXRjaCByYXBpZC1maXJlIHVwZGF0ZXMgaW50byBhIHNpbmdsZSByZXF1ZXN0LgogIC8vICogU2VuZCB1cCB0aGUgbW9kZWxzIGFzIFhNTCBpbnN0ZWFkIG9mIEpTT04uCiAgLy8gKiBQZXJzaXN0IG1vZGVscyB2aWEgV2ViU29ja2V0cyBpbnN0ZWFkIG9mIEFqYXguCiAgLy8KICAvLyBUdXJuIG9uIGBCYWNrYm9uZS5lbXVsYXRlSFRUUGAgaW4gb3JkZXIgdG8gc2VuZCBgUFVUYCBhbmQgYERFTEVURWAgcmVxdWVzdHMKICAvLyBhcyBgUE9TVGAsIHdpdGggYSBgX21ldGhvZGAgcGFyYW1ldGVyIGNvbnRhaW5pbmcgdGhlIHRydWUgSFRUUCBtZXRob2QsCiAgLy8gYXMgd2VsbCBhcyBhbGwgcmVxdWVzdHMgd2l0aCB0aGUgYm9keSBhcyBgYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkYAogIC8vIGluc3RlYWQgb2YgYGFwcGxpY2F0aW9uL2pzb25gIHdpdGggdGhlIG1vZGVsIGluIGEgcGFyYW0gbmFtZWQgYG1vZGVsYC4KICAvLyBVc2VmdWwgd2hlbiBpbnRlcmZhY2luZyB3aXRoIHNlcnZlci1zaWRlIGxhbmd1YWdlcyBsaWtlICoqUEhQKiogdGhhdCBtYWtlCiAgLy8gaXQgZGlmZmljdWx0IHRvIHJlYWQgdGhlIGJvZHkgb2YgYFBVVGAgcmVxdWVzdHMuCiAgQmFja2JvbmUuc3luYyA9IGZ1bmN0aW9uKG1ldGhvZCwgbW9kZWwsIG9wdGlvbnMpIHsKICAgIHZhciB0eXBlID0gbWV0aG9kTWFwW21ldGhvZF07CgogICAgLy8gRGVmYXVsdCBvcHRpb25zLCB1bmxlc3Mgc3BlY2lmaWVkLgogICAgXy5kZWZhdWx0cyhvcHRpb25zIHx8IChvcHRpb25zID0ge30pLCB7CiAgICAgIGVtdWxhdGVIVFRQOiBCYWNrYm9uZS5lbXVsYXRlSFRUUCwKICAgICAgZW11bGF0ZUpTT046IEJhY2tib25lLmVtdWxhdGVKU09OCiAgICB9KTsKCiAgICAvLyBEZWZhdWx0IEpTT04tcmVxdWVzdCBvcHRpb25zLgogICAgdmFyIHBhcmFtcyA9IHt0eXBlOiB0eXBlLCBkYXRhVHlwZTogJ2pzb24nfTsKCiAgICAvLyBFbnN1cmUgdGhhdCB3ZSBoYXZlIGEgVVJMLgogICAgaWYgKCFvcHRpb25zLnVybCkgewogICAgICBwYXJhbXMudXJsID0gXy5yZXN1bHQobW9kZWwsICd1cmwnKSB8fCB1cmxFcnJvcigpOwogICAgfQoKICAgIC8vIEVuc3VyZSB0aGF0IHdlIGhhdmUgdGhlIGFwcHJvcHJpYXRlIHJlcXVlc3QgZGF0YS4KICAgIGlmIChvcHRpb25zLmRhdGEgPT0gbnVsbCAmJiBtb2RlbCAmJiAobWV0aG9kID09PSAnY3JlYXRlJyB8fCBtZXRob2QgPT09ICd1cGRhdGUnIHx8IG1ldGhvZCA9PT0gJ3BhdGNoJykpIHsKICAgICAgcGFyYW1zLmNvbnRlbnRUeXBlID0gJ2FwcGxpY2F0aW9uL2pzb24nOwogICAgICBwYXJhbXMuZGF0YSA9IEpTT04uc3RyaW5naWZ5KG9wdGlvbnMuYXR0cnMgfHwgbW9kZWwudG9KU09OKG9wdGlvbnMpKTsKICAgIH0KCiAgICAvLyBGb3Igb2xkZXIgc2VydmVycywgZW11bGF0ZSBKU09OIGJ5IGVuY29kaW5nIHRoZSByZXF1ZXN0IGludG8gYW4gSFRNTC1mb3JtLgogICAgaWYgKG9wdGlvbnMuZW11bGF0ZUpTT04pIHsKICAgICAgcGFyYW1zLmNvbnRlbnRUeXBlID0gJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCc7CiAgICAgIHBhcmFtcy5kYXRhID0gcGFyYW1zLmRhdGEgPyB7bW9kZWw6IHBhcmFtcy5kYXRhfSA6IHt9OwogICAgfQoKICAgIC8vIEZvciBvbGRlciBzZXJ2ZXJzLCBlbXVsYXRlIEhUVFAgYnkgbWltaWNraW5nIHRoZSBIVFRQIG1ldGhvZCB3aXRoIGBfbWV0aG9kYAogICAgLy8gQW5kIGFuIGBYLUhUVFAtTWV0aG9kLU92ZXJyaWRlYCBoZWFkZXIuCiAgICBpZiAob3B0aW9ucy5lbXVsYXRlSFRUUCAmJiAodHlwZSA9PT0gJ1BVVCcgfHwgdHlwZSA9PT0gJ0RFTEVURScgfHwgdHlwZSA9PT0gJ1BBVENIJykpIHsKICAgICAgcGFyYW1zLnR5cGUgPSAnUE9TVCc7CiAgICAgIGlmIChvcHRpb25zLmVtdWxhdGVKU09OKSBwYXJhbXMuZGF0YS5fbWV0aG9kID0gdHlwZTsKICAgICAgdmFyIGJlZm9yZVNlbmQgPSBvcHRpb25zLmJlZm9yZVNlbmQ7CiAgICAgIG9wdGlvbnMuYmVmb3JlU2VuZCA9IGZ1bmN0aW9uKHhocikgewogICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKCdYLUhUVFAtTWV0aG9kLU92ZXJyaWRlJywgdHlwZSk7CiAgICAgICAgaWYgKGJlZm9yZVNlbmQpIHJldHVybiBiZWZvcmVTZW5kLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH07CiAgICB9CgogICAgLy8gRG9uJ3QgcHJvY2VzcyBkYXRhIG9uIGEgbm9uLUdFVCByZXF1ZXN0LgogICAgaWYgKHBhcmFtcy50eXBlICE9PSAnR0VUJyAmJiAhb3B0aW9ucy5lbXVsYXRlSlNPTikgewogICAgICBwYXJhbXMucHJvY2Vzc0RhdGEgPSBmYWxzZTsKICAgIH0KCiAgICAvLyBJZiB3ZSdyZSBzZW5kaW5nIGEgYFBBVENIYCByZXF1ZXN0LCBhbmQgd2UncmUgaW4gYW4gb2xkIEludGVybmV0IEV4cGxvcmVyCiAgICAvLyB0aGF0IHN0aWxsIGhhcyBBY3RpdmVYIGVuYWJsZWQgYnkgZGVmYXVsdCwgb3ZlcnJpZGUgalF1ZXJ5IHRvIHVzZSB0aGF0CiAgICAvLyBmb3IgWEhSIGluc3RlYWQuIFJlbW92ZSB0aGlzIGxpbmUgd2hlbiBqUXVlcnkgc3VwcG9ydHMgYFBBVENIYCBvbiBJRTguCiAgICBpZiAocGFyYW1zLnR5cGUgPT09ICdQQVRDSCcgJiYgbm9YaHJQYXRjaCkgewogICAgICBwYXJhbXMueGhyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIG5ldyBBY3RpdmVYT2JqZWN0KCJNaWNyb3NvZnQuWE1MSFRUUCIpOwogICAgICB9OwogICAgfQoKICAgIC8vIE1ha2UgdGhlIHJlcXVlc3QsIGFsbG93aW5nIHRoZSB1c2VyIHRvIG92ZXJyaWRlIGFueSBBamF4IG9wdGlvbnMuCiAgICB2YXIgeGhyID0gb3B0aW9ucy54aHIgPSBCYWNrYm9uZS5hamF4KF8uZXh0ZW5kKHBhcmFtcywgb3B0aW9ucykpOwogICAgbW9kZWwudHJpZ2dlcigncmVxdWVzdCcsIG1vZGVsLCB4aHIsIG9wdGlvbnMpOwogICAgcmV0dXJuIHhocjsKICB9OwoKICB2YXIgbm9YaHJQYXRjaCA9CiAgICB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJiAhIXdpbmRvdy5BY3RpdmVYT2JqZWN0ICYmCiAgICAgICEod2luZG93LlhNTEh0dHBSZXF1ZXN0ICYmIChuZXcgWE1MSHR0cFJlcXVlc3QpLmRpc3BhdGNoRXZlbnQpOwoKICAvLyBNYXAgZnJvbSBDUlVEIHRvIEhUVFAgZm9yIG91ciBkZWZhdWx0IGBCYWNrYm9uZS5zeW5jYCBpbXBsZW1lbnRhdGlvbi4KICB2YXIgbWV0aG9kTWFwID0gewogICAgJ2NyZWF0ZSc6ICdQT1NUJywKICAgICd1cGRhdGUnOiAnUFVUJywKICAgICdwYXRjaCc6ICAnUEFUQ0gnLAogICAgJ2RlbGV0ZSc6ICdERUxFVEUnLAogICAgJ3JlYWQnOiAgICdHRVQnCiAgfTsKCiAgLy8gU2V0IHRoZSBkZWZhdWx0IGltcGxlbWVudGF0aW9uIG9mIGBCYWNrYm9uZS5hamF4YCB0byBwcm94eSB0aHJvdWdoIHRvIGAkYC4KICAvLyBPdmVycmlkZSB0aGlzIGlmIHlvdSdkIGxpa2UgdG8gdXNlIGEgZGlmZmVyZW50IGxpYnJhcnkuCiAgQmFja2JvbmUuYWpheCA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIEJhY2tib25lLiQuYWpheC5hcHBseShCYWNrYm9uZS4kLCBhcmd1bWVudHMpOwogIH07CgogIC8vIEJhY2tib25lLlJvdXRlcgogIC8vIC0tLS0tLS0tLS0tLS0tLQoKICAvLyBSb3V0ZXJzIG1hcCBmYXV4LVVSTHMgdG8gYWN0aW9ucywgYW5kIGZpcmUgZXZlbnRzIHdoZW4gcm91dGVzIGFyZQogIC8vIG1hdGNoZWQuIENyZWF0aW5nIGEgbmV3IG9uZSBzZXRzIGl0cyBgcm91dGVzYCBoYXNoLCBpZiBub3Qgc2V0IHN0YXRpY2FsbHkuCiAgdmFyIFJvdXRlciA9IEJhY2tib25lLlJvdXRlciA9IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgIG9wdGlvbnMgfHwgKG9wdGlvbnMgPSB7fSk7CiAgICBpZiAob3B0aW9ucy5yb3V0ZXMpIHRoaXMucm91dGVzID0gb3B0aW9ucy5yb3V0ZXM7CiAgICB0aGlzLl9iaW5kUm91dGVzKCk7CiAgICB0aGlzLmluaXRpYWxpemUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICB9OwoKICAvLyBDYWNoZWQgcmVndWxhciBleHByZXNzaW9ucyBmb3IgbWF0Y2hpbmcgbmFtZWQgcGFyYW0gcGFydHMgYW5kIHNwbGF0dGVkCiAgLy8gcGFydHMgb2Ygcm91dGUgc3RyaW5ncy4KICB2YXIgb3B0aW9uYWxQYXJhbSA9IC9cKCguKj8pXCkvZzsKICB2YXIgbmFtZWRQYXJhbSAgICA9IC8oXChcPyk/Olx3Ky9nOwogIHZhciBzcGxhdFBhcmFtICAgID0gL1wqXHcrL2c7CiAgdmFyIGVzY2FwZVJlZ0V4cCAgPSAvW1wte31cW1xdKz8uLFxcXF4kfCNcc10vZzsKCiAgLy8gU2V0IHVwIGFsbCBpbmhlcml0YWJsZSAqKkJhY2tib25lLlJvdXRlcioqIHByb3BlcnRpZXMgYW5kIG1ldGhvZHMuCiAgXy5leHRlbmQoUm91dGVyLnByb3RvdHlwZSwgRXZlbnRzLCB7CgogICAgLy8gSW5pdGlhbGl6ZSBpcyBhbiBlbXB0eSBmdW5jdGlvbiBieSBkZWZhdWx0LiBPdmVycmlkZSBpdCB3aXRoIHlvdXIgb3duCiAgICAvLyBpbml0aWFsaXphdGlvbiBsb2dpYy4KICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uKCl7fSwKCiAgICAvLyBNYW51YWxseSBiaW5kIGEgc2luZ2xlIG5hbWVkIHJvdXRlIHRvIGEgY2FsbGJhY2suIEZvciBleGFtcGxlOgogICAgLy8KICAgIC8vICAgICB0aGlzLnJvdXRlKCdzZWFyY2gvOnF1ZXJ5L3A6bnVtJywgJ3NlYXJjaCcsIGZ1bmN0aW9uKHF1ZXJ5LCBudW0pIHsKICAgIC8vICAgICAgIC4uLgogICAgLy8gICAgIH0pOwogICAgLy8KICAgIHJvdXRlOiBmdW5jdGlvbihyb3V0ZSwgbmFtZSwgY2FsbGJhY2spIHsKICAgICAgaWYgKCFfLmlzUmVnRXhwKHJvdXRlKSkgcm91dGUgPSB0aGlzLl9yb3V0ZVRvUmVnRXhwKHJvdXRlKTsKICAgICAgaWYgKF8uaXNGdW5jdGlvbihuYW1lKSkgewogICAgICAgIGNhbGxiYWNrID0gbmFtZTsKICAgICAgICBuYW1lID0gJyc7CiAgICAgIH0KICAgICAgaWYgKCFjYWxsYmFjaykgY2FsbGJhY2sgPSB0aGlzW25hbWVdOwogICAgICB2YXIgcm91dGVyID0gdGhpczsKICAgICAgQmFja2JvbmUuaGlzdG9yeS5yb3V0ZShyb3V0ZSwgZnVuY3Rpb24oZnJhZ21lbnQpIHsKICAgICAgICB2YXIgYXJncyA9IHJvdXRlci5fZXh0cmFjdFBhcmFtZXRlcnMocm91dGUsIGZyYWdtZW50KTsKICAgICAgICByb3V0ZXIuZXhlY3V0ZShjYWxsYmFjaywgYXJncyk7CiAgICAgICAgcm91dGVyLnRyaWdnZXIuYXBwbHkocm91dGVyLCBbJ3JvdXRlOicgKyBuYW1lXS5jb25jYXQoYXJncykpOwogICAgICAgIHJvdXRlci50cmlnZ2VyKCdyb3V0ZScsIG5hbWUsIGFyZ3MpOwogICAgICAgIEJhY2tib25lLmhpc3RvcnkudHJpZ2dlcigncm91dGUnLCByb3V0ZXIsIG5hbWUsIGFyZ3MpOwogICAgICB9KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAoKICAgIC8vIEV4ZWN1dGUgYSByb3V0ZSBoYW5kbGVyIHdpdGggdGhlIHByb3ZpZGVkIHBhcmFtZXRlcnMuICBUaGlzIGlzIGFuCiAgICAvLyBleGNlbGxlbnQgcGxhY2UgdG8gZG8gcHJlLXJvdXRlIHNldHVwIG9yIHBvc3Qtcm91dGUgY2xlYW51cC4KICAgIGV4ZWN1dGU6IGZ1bmN0aW9uKGNhbGxiYWNrLCBhcmdzKSB7CiAgICAgIGlmIChjYWxsYmFjaykgY2FsbGJhY2suYXBwbHkodGhpcywgYXJncyk7CiAgICB9LAoKICAgIC8vIFNpbXBsZSBwcm94eSB0byBgQmFja2JvbmUuaGlzdG9yeWAgdG8gc2F2ZSBhIGZyYWdtZW50IGludG8gdGhlIGhpc3RvcnkuCiAgICBuYXZpZ2F0ZTogZnVuY3Rpb24oZnJhZ21lbnQsIG9wdGlvbnMpIHsKICAgICAgQmFja2JvbmUuaGlzdG9yeS5uYXZpZ2F0ZShmcmFnbWVudCwgb3B0aW9ucyk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvLyBCaW5kIGFsbCBkZWZpbmVkIHJvdXRlcyB0byBgQmFja2JvbmUuaGlzdG9yeWAuIFdlIGhhdmUgdG8gcmV2ZXJzZSB0aGUKICAgIC8vIG9yZGVyIG9mIHRoZSByb3V0ZXMgaGVyZSB0byBzdXBwb3J0IGJlaGF2aW9yIHdoZXJlIHRoZSBtb3N0IGdlbmVyYWwKICAgIC8vIHJvdXRlcyBjYW4gYmUgZGVmaW5lZCBhdCB0aGUgYm90dG9tIG9mIHRoZSByb3V0ZSBtYXAuCiAgICBfYmluZFJvdXRlczogZnVuY3Rpb24oKSB7CiAgICAgIGlmICghdGhpcy5yb3V0ZXMpIHJldHVybjsKICAgICAgdGhpcy5yb3V0ZXMgPSBfLnJlc3VsdCh0aGlzLCAncm91dGVzJyk7CiAgICAgIHZhciByb3V0ZSwgcm91dGVzID0gXy5rZXlzKHRoaXMucm91dGVzKTsKICAgICAgd2hpbGUgKChyb3V0ZSA9IHJvdXRlcy5wb3AoKSkgIT0gbnVsbCkgewogICAgICAgIHRoaXMucm91dGUocm91dGUsIHRoaXMucm91dGVzW3JvdXRlXSk7CiAgICAgIH0KICAgIH0sCgogICAgLy8gQ29udmVydCBhIHJvdXRlIHN0cmluZyBpbnRvIGEgcmVndWxhciBleHByZXNzaW9uLCBzdWl0YWJsZSBmb3IgbWF0Y2hpbmcKICAgIC8vIGFnYWluc3QgdGhlIGN1cnJlbnQgbG9jYXRpb24gaGFzaC4KICAgIF9yb3V0ZVRvUmVnRXhwOiBmdW5jdGlvbihyb3V0ZSkgewogICAgICByb3V0ZSA9IHJvdXRlLnJlcGxhY2UoZXNjYXBlUmVnRXhwLCAnXFwkJicpCiAgICAgICAgICAgICAgICAgICAucmVwbGFjZShvcHRpb25hbFBhcmFtLCAnKD86JDEpPycpCiAgICAgICAgICAgICAgICAgICAucmVwbGFjZShuYW1lZFBhcmFtLCBmdW5jdGlvbihtYXRjaCwgb3B0aW9uYWwpIHsKICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9wdGlvbmFsID8gbWF0Y2ggOiAnKFteLz9dKyknOwogICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKHNwbGF0UGFyYW0sICcoW14/XSo/KScpOwogICAgICByZXR1cm4gbmV3IFJlZ0V4cCgnXicgKyByb3V0ZSArICcoPzpcXD8oW1xcc1xcU10qKSk/JCcpOwogICAgfSwKCiAgICAvLyBHaXZlbiBhIHJvdXRlLCBhbmQgYSBVUkwgZnJhZ21lbnQgdGhhdCBpdCBtYXRjaGVzLCByZXR1cm4gdGhlIGFycmF5IG9mCiAgICAvLyBleHRyYWN0ZWQgZGVjb2RlZCBwYXJhbWV0ZXJzLiBFbXB0eSBvciB1bm1hdGNoZWQgcGFyYW1ldGVycyB3aWxsIGJlCiAgICAvLyB0cmVhdGVkIGFzIGBudWxsYCB0byBub3JtYWxpemUgY3Jvc3MtYnJvd3NlciBiZWhhdmlvci4KICAgIF9leHRyYWN0UGFyYW1ldGVyczogZnVuY3Rpb24ocm91dGUsIGZyYWdtZW50KSB7CiAgICAgIHZhciBwYXJhbXMgPSByb3V0ZS5leGVjKGZyYWdtZW50KS5zbGljZSgxKTsKICAgICAgcmV0dXJuIF8ubWFwKHBhcmFtcywgZnVuY3Rpb24ocGFyYW0sIGkpIHsKICAgICAgICAvLyBEb24ndCBkZWNvZGUgdGhlIHNlYXJjaCBwYXJhbXMuCiAgICAgICAgaWYgKGkgPT09IHBhcmFtcy5sZW5ndGggLSAxKSByZXR1cm4gcGFyYW0gfHwgbnVsbDsKICAgICAgICByZXR1cm4gcGFyYW0gPyBkZWNvZGVVUklDb21wb25lbnQocGFyYW0pIDogbnVsbDsKICAgICAgfSk7CiAgICB9CgogIH0pOwoKICAvLyBCYWNrYm9uZS5IaXN0b3J5CiAgLy8gLS0tLS0tLS0tLS0tLS0tLQoKICAvLyBIYW5kbGVzIGNyb3NzLWJyb3dzZXIgaGlzdG9yeSBtYW5hZ2VtZW50LCBiYXNlZCBvbiBlaXRoZXIKICAvLyBbcHVzaFN0YXRlXShodHRwOi8vZGl2ZWludG9odG1sNS5pbmZvL2hpc3RvcnkuaHRtbCkgYW5kIHJlYWwgVVJMcywgb3IKICAvLyBbb25oYXNoY2hhbmdlXShodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL0RPTS93aW5kb3cub25oYXNoY2hhbmdlKQogIC8vIGFuZCBVUkwgZnJhZ21lbnRzLiBJZiB0aGUgYnJvd3NlciBzdXBwb3J0cyBuZWl0aGVyIChvbGQgSUUsIG5hdGNoKSwKICAvLyBmYWxscyBiYWNrIHRvIHBvbGxpbmcuCiAgdmFyIEhpc3RvcnkgPSBCYWNrYm9uZS5IaXN0b3J5ID0gZnVuY3Rpb24oKSB7CiAgICB0aGlzLmhhbmRsZXJzID0gW107CiAgICBfLmJpbmRBbGwodGhpcywgJ2NoZWNrVXJsJyk7CgogICAgLy8gRW5zdXJlIHRoYXQgYEhpc3RvcnlgIGNhbiBiZSB1c2VkIG91dHNpZGUgb2YgdGhlIGJyb3dzZXIuCiAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgdGhpcy5sb2NhdGlvbiA9IHdpbmRvdy5sb2NhdGlvbjsKICAgICAgdGhpcy5oaXN0b3J5ID0gd2luZG93Lmhpc3Rvcnk7CiAgICB9CiAgfTsKCiAgLy8gQ2FjaGVkIHJlZ2V4IGZvciBzdHJpcHBpbmcgYSBsZWFkaW5nIGhhc2gvc2xhc2ggYW5kIHRyYWlsaW5nIHNwYWNlLgogIHZhciByb3V0ZVN0cmlwcGVyID0gL15bI1wvXXxccyskL2c7CgogIC8vIENhY2hlZCByZWdleCBmb3Igc3RyaXBwaW5nIGxlYWRpbmcgYW5kIHRyYWlsaW5nIHNsYXNoZXMuCiAgdmFyIHJvb3RTdHJpcHBlciA9IC9eXC8rfFwvKyQvZzsKCiAgLy8gQ2FjaGVkIHJlZ2V4IGZvciBkZXRlY3RpbmcgTVNJRS4KICB2YXIgaXNFeHBsb3JlciA9IC9tc2llIFtcdy5dKy87CgogIC8vIENhY2hlZCByZWdleCBmb3IgcmVtb3ZpbmcgYSB0cmFpbGluZyBzbGFzaC4KICB2YXIgdHJhaWxpbmdTbGFzaCA9IC9cLyQvOwoKICAvLyBDYWNoZWQgcmVnZXggZm9yIHN0cmlwcGluZyB1cmxzIG9mIGhhc2guCiAgdmFyIHBhdGhTdHJpcHBlciA9IC8jLiokLzsKCiAgLy8gSGFzIHRoZSBoaXN0b3J5IGhhbmRsaW5nIGFscmVhZHkgYmVlbiBzdGFydGVkPwogIEhpc3Rvcnkuc3RhcnRlZCA9IGZhbHNlOwoKICAvLyBTZXQgdXAgYWxsIGluaGVyaXRhYmxlICoqQmFja2JvbmUuSGlzdG9yeSoqIHByb3BlcnRpZXMgYW5kIG1ldGhvZHMuCiAgXy5leHRlbmQoSGlzdG9yeS5wcm90b3R5cGUsIEV2ZW50cywgewoKICAgIC8vIFRoZSBkZWZhdWx0IGludGVydmFsIHRvIHBvbGwgZm9yIGhhc2ggY2hhbmdlcywgaWYgbmVjZXNzYXJ5LCBpcwogICAgLy8gdHdlbnR5IHRpbWVzIGEgc2Vjb25kLgogICAgaW50ZXJ2YWw6IDUwLAoKICAgIC8vIEFyZSB3ZSBhdCB0aGUgYXBwIHJvb3Q/CiAgICBhdFJvb3Q6IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gdGhpcy5sb2NhdGlvbi5wYXRobmFtZS5yZXBsYWNlKC9bXlwvXSQvLCAnJCYvJykgPT09IHRoaXMucm9vdDsKICAgIH0sCgogICAgLy8gR2V0cyB0aGUgdHJ1ZSBoYXNoIHZhbHVlLiBDYW5ub3QgdXNlIGxvY2F0aW9uLmhhc2ggZGlyZWN0bHkgZHVlIHRvIGJ1ZwogICAgLy8gaW4gRmlyZWZveCB3aGVyZSBsb2NhdGlvbi5oYXNoIHdpbGwgYWx3YXlzIGJlIGRlY29kZWQuCiAgICBnZXRIYXNoOiBmdW5jdGlvbih3aW5kb3cpIHsKICAgICAgdmFyIG1hdGNoID0gKHdpbmRvdyB8fCB0aGlzKS5sb2NhdGlvbi5ocmVmLm1hdGNoKC8jKC4qKSQvKTsKICAgICAgcmV0dXJuIG1hdGNoID8gbWF0Y2hbMV0gOiAnJzsKICAgIH0sCgogICAgLy8gR2V0IHRoZSBjcm9zcy1icm93c2VyIG5vcm1hbGl6ZWQgVVJMIGZyYWdtZW50LCBlaXRoZXIgZnJvbSB0aGUgVVJMLAogICAgLy8gdGhlIGhhc2gsIG9yIHRoZSBvdmVycmlkZS4KICAgIGdldEZyYWdtZW50OiBmdW5jdGlvbihmcmFnbWVudCwgZm9yY2VQdXNoU3RhdGUpIHsKICAgICAgaWYgKGZyYWdtZW50ID09IG51bGwpIHsKICAgICAgICBpZiAodGhpcy5faGFzUHVzaFN0YXRlIHx8ICF0aGlzLl93YW50c0hhc2hDaGFuZ2UgfHwgZm9yY2VQdXNoU3RhdGUpIHsKICAgICAgICAgIGZyYWdtZW50ID0gZGVjb2RlVVJJKHRoaXMubG9jYXRpb24ucGF0aG5hbWUgKyB0aGlzLmxvY2F0aW9uLnNlYXJjaCk7CiAgICAgICAgICB2YXIgcm9vdCA9IHRoaXMucm9vdC5yZXBsYWNlKHRyYWlsaW5nU2xhc2gsICcnKTsKICAgICAgICAgIGlmICghZnJhZ21lbnQuaW5kZXhPZihyb290KSkgZnJhZ21lbnQgPSBmcmFnbWVudC5zbGljZShyb290Lmxlbmd0aCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGZyYWdtZW50ID0gdGhpcy5nZXRIYXNoKCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBmcmFnbWVudC5yZXBsYWNlKHJvdXRlU3RyaXBwZXIsICcnKTsKICAgIH0sCgogICAgLy8gU3RhcnQgdGhlIGhhc2ggY2hhbmdlIGhhbmRsaW5nLCByZXR1cm5pbmcgYHRydWVgIGlmIHRoZSBjdXJyZW50IFVSTCBtYXRjaGVzCiAgICAvLyBhbiBleGlzdGluZyByb3V0ZSwgYW5kIGBmYWxzZWAgb3RoZXJ3aXNlLgogICAgc3RhcnQ6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgaWYgKEhpc3Rvcnkuc3RhcnRlZCkgdGhyb3cgbmV3IEVycm9yKCJCYWNrYm9uZS5oaXN0b3J5IGhhcyBhbHJlYWR5IGJlZW4gc3RhcnRlZCIpOwogICAgICBIaXN0b3J5LnN0YXJ0ZWQgPSB0cnVlOwoKICAgICAgLy8gRmlndXJlIG91dCB0aGUgaW5pdGlhbCBjb25maWd1cmF0aW9uLiBEbyB3ZSBuZWVkIGFuIGlmcmFtZT8KICAgICAgLy8gSXMgcHVzaFN0YXRlIGRlc2lyZWQgLi4uIGlzIGl0IGF2YWlsYWJsZT8KICAgICAgdGhpcy5vcHRpb25zICAgICAgICAgID0gXy5leHRlbmQoe3Jvb3Q6ICcvJ30sIHRoaXMub3B0aW9ucywgb3B0aW9ucyk7CiAgICAgIHRoaXMucm9vdCAgICAgICAgICAgICA9IHRoaXMub3B0aW9ucy5yb290OwogICAgICB0aGlzLl93YW50c0hhc2hDaGFuZ2UgPSB0aGlzLm9wdGlvbnMuaGFzaENoYW5nZSAhPT0gZmFsc2U7CiAgICAgIHRoaXMuX3dhbnRzUHVzaFN0YXRlICA9ICEhdGhpcy5vcHRpb25zLnB1c2hTdGF0ZTsKICAgICAgdGhpcy5faGFzUHVzaFN0YXRlICAgID0gISEodGhpcy5vcHRpb25zLnB1c2hTdGF0ZSAmJiB0aGlzLmhpc3RvcnkgJiYgdGhpcy5oaXN0b3J5LnB1c2hTdGF0ZSk7CiAgICAgIHZhciBmcmFnbWVudCAgICAgICAgICA9IHRoaXMuZ2V0RnJhZ21lbnQoKTsKICAgICAgdmFyIGRvY01vZGUgICAgICAgICAgID0gZG9jdW1lbnQuZG9jdW1lbnRNb2RlOwogICAgICB2YXIgb2xkSUUgICAgICAgICAgICAgPSAoaXNFeHBsb3Jlci5leGVjKG5hdmlnYXRvci51c2VyQWdlbnQudG9Mb3dlckNhc2UoKSkgJiYgKCFkb2NNb2RlIHx8IGRvY01vZGUgPD0gNykpOwoKICAgICAgLy8gTm9ybWFsaXplIHJvb3QgdG8gYWx3YXlzIGluY2x1ZGUgYSBsZWFkaW5nIGFuZCB0cmFpbGluZyBzbGFzaC4KICAgICAgdGhpcy5yb290ID0gKCcvJyArIHRoaXMucm9vdCArICcvJykucmVwbGFjZShyb290U3RyaXBwZXIsICcvJyk7CgogICAgICBpZiAob2xkSUUgJiYgdGhpcy5fd2FudHNIYXNoQ2hhbmdlKSB7CiAgICAgICAgdmFyIGZyYW1lID0gQmFja2JvbmUuJCgnPGlmcmFtZSBzcmM9ImphdmFzY3JpcHQ6MCIgdGFiaW5kZXg9Ii0xIj4nKTsKICAgICAgICB0aGlzLmlmcmFtZSA9IGZyYW1lLmhpZGUoKS5hcHBlbmRUbygnYm9keScpWzBdLmNvbnRlbnRXaW5kb3c7CiAgICAgICAgdGhpcy5uYXZpZ2F0ZShmcmFnbWVudCk7CiAgICAgIH0KCiAgICAgIC8vIERlcGVuZGluZyBvbiB3aGV0aGVyIHdlJ3JlIHVzaW5nIHB1c2hTdGF0ZSBvciBoYXNoZXMsIGFuZCB3aGV0aGVyCiAgICAgIC8vICdvbmhhc2hjaGFuZ2UnIGlzIHN1cHBvcnRlZCwgZGV0ZXJtaW5lIGhvdyB3ZSBjaGVjayB0aGUgVVJMIHN0YXRlLgogICAgICBpZiAodGhpcy5faGFzUHVzaFN0YXRlKSB7CiAgICAgICAgQmFja2JvbmUuJCh3aW5kb3cpLm9uKCdwb3BzdGF0ZScsIHRoaXMuY2hlY2tVcmwpOwogICAgICB9IGVsc2UgaWYgKHRoaXMuX3dhbnRzSGFzaENoYW5nZSAmJiAoJ29uaGFzaGNoYW5nZScgaW4gd2luZG93KSAmJiAhb2xkSUUpIHsKICAgICAgICBCYWNrYm9uZS4kKHdpbmRvdykub24oJ2hhc2hjaGFuZ2UnLCB0aGlzLmNoZWNrVXJsKTsKICAgICAgfSBlbHNlIGlmICh0aGlzLl93YW50c0hhc2hDaGFuZ2UpIHsKICAgICAgICB0aGlzLl9jaGVja1VybEludGVydmFsID0gc2V0SW50ZXJ2YWwodGhpcy5jaGVja1VybCwgdGhpcy5pbnRlcnZhbCk7CiAgICAgIH0KCiAgICAgIC8vIERldGVybWluZSBpZiB3ZSBuZWVkIHRvIGNoYW5nZSB0aGUgYmFzZSB1cmwsIGZvciBhIHB1c2hTdGF0ZSBsaW5rCiAgICAgIC8vIG9wZW5lZCBieSBhIG5vbi1wdXNoU3RhdGUgYnJvd3Nlci4KICAgICAgdGhpcy5mcmFnbWVudCA9IGZyYWdtZW50OwogICAgICB2YXIgbG9jID0gdGhpcy5sb2NhdGlvbjsKCiAgICAgIC8vIFRyYW5zaXRpb24gZnJvbSBoYXNoQ2hhbmdlIHRvIHB1c2hTdGF0ZSBvciB2aWNlIHZlcnNhIGlmIGJvdGggYXJlCiAgICAgIC8vIHJlcXVlc3RlZC4KICAgICAgaWYgKHRoaXMuX3dhbnRzSGFzaENoYW5nZSAmJiB0aGlzLl93YW50c1B1c2hTdGF0ZSkgewoKICAgICAgICAvLyBJZiB3ZSd2ZSBzdGFydGVkIG9mZiB3aXRoIGEgcm91dGUgZnJvbSBhIGBwdXNoU3RhdGVgLWVuYWJsZWQKICAgICAgICAvLyBicm93c2VyLCBidXQgd2UncmUgY3VycmVudGx5IGluIGEgYnJvd3NlciB0aGF0IGRvZXNuJ3Qgc3VwcG9ydCBpdC4uLgogICAgICAgIGlmICghdGhpcy5faGFzUHVzaFN0YXRlICYmICF0aGlzLmF0Um9vdCgpKSB7CiAgICAgICAgICB0aGlzLmZyYWdtZW50ID0gdGhpcy5nZXRGcmFnbWVudChudWxsLCB0cnVlKTsKICAgICAgICAgIHRoaXMubG9jYXRpb24ucmVwbGFjZSh0aGlzLnJvb3QgKyAnIycgKyB0aGlzLmZyYWdtZW50KTsKICAgICAgICAgIC8vIFJldHVybiBpbW1lZGlhdGVseSBhcyBicm93c2VyIHdpbGwgZG8gcmVkaXJlY3QgdG8gbmV3IHVybAogICAgICAgICAgcmV0dXJuIHRydWU7CgogICAgICAgIC8vIE9yIGlmIHdlJ3ZlIHN0YXJ0ZWQgb3V0IHdpdGggYSBoYXNoLWJhc2VkIHJvdXRlLCBidXQgd2UncmUgY3VycmVudGx5CiAgICAgICAgLy8gaW4gYSBicm93c2VyIHdoZXJlIGl0IGNvdWxkIGJlIGBwdXNoU3RhdGVgLWJhc2VkIGluc3RlYWQuLi4KICAgICAgICB9IGVsc2UgaWYgKHRoaXMuX2hhc1B1c2hTdGF0ZSAmJiB0aGlzLmF0Um9vdCgpICYmIGxvYy5oYXNoKSB7CiAgICAgICAgICB0aGlzLmZyYWdtZW50ID0gdGhpcy5nZXRIYXNoKCkucmVwbGFjZShyb3V0ZVN0cmlwcGVyLCAnJyk7CiAgICAgICAgICB0aGlzLmhpc3RvcnkucmVwbGFjZVN0YXRlKHt9LCBkb2N1bWVudC50aXRsZSwgdGhpcy5yb290ICsgdGhpcy5mcmFnbWVudCk7CiAgICAgICAgfQoKICAgICAgfQoKICAgICAgaWYgKCF0aGlzLm9wdGlvbnMuc2lsZW50KSByZXR1cm4gdGhpcy5sb2FkVXJsKCk7CiAgICB9LAoKICAgIC8vIERpc2FibGUgQmFja2JvbmUuaGlzdG9yeSwgcGVyaGFwcyB0ZW1wb3JhcmlseS4gTm90IHVzZWZ1bCBpbiBhIHJlYWwgYXBwLAogICAgLy8gYnV0IHBvc3NpYmx5IHVzZWZ1bCBmb3IgdW5pdCB0ZXN0aW5nIFJvdXRlcnMuCiAgICBzdG9wOiBmdW5jdGlvbigpIHsKICAgICAgQmFja2JvbmUuJCh3aW5kb3cpLm9mZigncG9wc3RhdGUnLCB0aGlzLmNoZWNrVXJsKS5vZmYoJ2hhc2hjaGFuZ2UnLCB0aGlzLmNoZWNrVXJsKTsKICAgICAgaWYgKHRoaXMuX2NoZWNrVXJsSW50ZXJ2YWwpIGNsZWFySW50ZXJ2YWwodGhpcy5fY2hlY2tVcmxJbnRlcnZhbCk7CiAgICAgIEhpc3Rvcnkuc3RhcnRlZCA9IGZhbHNlOwogICAgfSwKCiAgICAvLyBBZGQgYSByb3V0ZSB0byBiZSB0ZXN0ZWQgd2hlbiB0aGUgZnJhZ21lbnQgY2hhbmdlcy4gUm91dGVzIGFkZGVkIGxhdGVyCiAgICAvLyBtYXkgb3ZlcnJpZGUgcHJldmlvdXMgcm91dGVzLgogICAgcm91dGU6IGZ1bmN0aW9uKHJvdXRlLCBjYWxsYmFjaykgewogICAgICB0aGlzLmhhbmRsZXJzLnVuc2hpZnQoe3JvdXRlOiByb3V0ZSwgY2FsbGJhY2s6IGNhbGxiYWNrfSk7CiAgICB9LAoKICAgIC8vIENoZWNrcyB0aGUgY3VycmVudCBVUkwgdG8gc2VlIGlmIGl0IGhhcyBjaGFuZ2VkLCBhbmQgaWYgaXQgaGFzLAogICAgLy8gY2FsbHMgYGxvYWRVcmxgLCBub3JtYWxpemluZyBhY3Jvc3MgdGhlIGhpZGRlbiBpZnJhbWUuCiAgICBjaGVja1VybDogZnVuY3Rpb24oZSkgewogICAgICB2YXIgY3VycmVudCA9IHRoaXMuZ2V0RnJhZ21lbnQoKTsKICAgICAgaWYgKGN1cnJlbnQgPT09IHRoaXMuZnJhZ21lbnQgJiYgdGhpcy5pZnJhbWUpIHsKICAgICAgICBjdXJyZW50ID0gdGhpcy5nZXRGcmFnbWVudCh0aGlzLmdldEhhc2godGhpcy5pZnJhbWUpKTsKICAgICAgfQogICAgICBpZiAoY3VycmVudCA9PT0gdGhpcy5mcmFnbWVudCkgcmV0dXJuIGZhbHNlOwogICAgICBpZiAodGhpcy5pZnJhbWUpIHRoaXMubmF2aWdhdGUoY3VycmVudCk7CiAgICAgIHRoaXMubG9hZFVybCgpOwogICAgfSwKCiAgICAvLyBBdHRlbXB0IHRvIGxvYWQgdGhlIGN1cnJlbnQgVVJMIGZyYWdtZW50LiBJZiBhIHJvdXRlIHN1Y2NlZWRzIHdpdGggYQogICAgLy8gbWF0Y2gsIHJldHVybnMgYHRydWVgLiBJZiBubyBkZWZpbmVkIHJvdXRlcyBtYXRjaGVzIHRoZSBmcmFnbWVudCwKICAgIC8vIHJldHVybnMgYGZhbHNlYC4KICAgIGxvYWRVcmw6IGZ1bmN0aW9uKGZyYWdtZW50KSB7CiAgICAgIGZyYWdtZW50ID0gdGhpcy5mcmFnbWVudCA9IHRoaXMuZ2V0RnJhZ21lbnQoZnJhZ21lbnQpOwogICAgICByZXR1cm4gXy5hbnkodGhpcy5oYW5kbGVycywgZnVuY3Rpb24oaGFuZGxlcikgewogICAgICAgIGlmIChoYW5kbGVyLnJvdXRlLnRlc3QoZnJhZ21lbnQpKSB7CiAgICAgICAgICBoYW5kbGVyLmNhbGxiYWNrKGZyYWdtZW50KTsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAoKICAgIC8vIFNhdmUgYSBmcmFnbWVudCBpbnRvIHRoZSBoYXNoIGhpc3RvcnksIG9yIHJlcGxhY2UgdGhlIFVSTCBzdGF0ZSBpZiB0aGUKICAgIC8vICdyZXBsYWNlJyBvcHRpb24gaXMgcGFzc2VkLiBZb3UgYXJlIHJlc3BvbnNpYmxlIGZvciBwcm9wZXJseSBVUkwtZW5jb2RpbmcKICAgIC8vIHRoZSBmcmFnbWVudCBpbiBhZHZhbmNlLgogICAgLy8KICAgIC8vIFRoZSBvcHRpb25zIG9iamVjdCBjYW4gY29udGFpbiBgdHJpZ2dlcjogdHJ1ZWAgaWYgeW91IHdpc2ggdG8gaGF2ZSB0aGUKICAgIC8vIHJvdXRlIGNhbGxiYWNrIGJlIGZpcmVkIChub3QgdXN1YWxseSBkZXNpcmFibGUpLCBvciBgcmVwbGFjZTogdHJ1ZWAsIGlmCiAgICAvLyB5b3Ugd2lzaCB0byBtb2RpZnkgdGhlIGN1cnJlbnQgVVJMIHdpdGhvdXQgYWRkaW5nIGFuIGVudHJ5IHRvIHRoZSBoaXN0b3J5LgogICAgbmF2aWdhdGU6IGZ1bmN0aW9uKGZyYWdtZW50LCBvcHRpb25zKSB7CiAgICAgIGlmICghSGlzdG9yeS5zdGFydGVkKSByZXR1cm4gZmFsc2U7CiAgICAgIGlmICghb3B0aW9ucyB8fCBvcHRpb25zID09PSB0cnVlKSBvcHRpb25zID0ge3RyaWdnZXI6ICEhb3B0aW9uc307CgogICAgICB2YXIgdXJsID0gdGhpcy5yb290ICsgKGZyYWdtZW50ID0gdGhpcy5nZXRGcmFnbWVudChmcmFnbWVudCB8fCAnJykpOwoKICAgICAgLy8gU3RyaXAgdGhlIGhhc2ggZm9yIG1hdGNoaW5nLgogICAgICBmcmFnbWVudCA9IGZyYWdtZW50LnJlcGxhY2UocGF0aFN0cmlwcGVyLCAnJyk7CgogICAgICBpZiAodGhpcy5mcmFnbWVudCA9PT0gZnJhZ21lbnQpIHJldHVybjsKICAgICAgdGhpcy5mcmFnbWVudCA9IGZyYWdtZW50OwoKICAgICAgLy8gRG9uJ3QgaW5jbHVkZSBhIHRyYWlsaW5nIHNsYXNoIG9uIHRoZSByb290LgogICAgICBpZiAoZnJhZ21lbnQgPT09ICcnICYmIHVybCAhPT0gJy8nKSB1cmwgPSB1cmwuc2xpY2UoMCwgLTEpOwoKICAgICAgLy8gSWYgcHVzaFN0YXRlIGlzIGF2YWlsYWJsZSwgd2UgdXNlIGl0IHRvIHNldCB0aGUgZnJhZ21lbnQgYXMgYSByZWFsIFVSTC4KICAgICAgaWYgKHRoaXMuX2hhc1B1c2hTdGF0ZSkgewogICAgICAgIHRoaXMuaGlzdG9yeVtvcHRpb25zLnJlcGxhY2UgPyAncmVwbGFjZVN0YXRlJyA6ICdwdXNoU3RhdGUnXSh7fSwgZG9jdW1lbnQudGl0bGUsIHVybCk7CgogICAgICAvLyBJZiBoYXNoIGNoYW5nZXMgaGF2ZW4ndCBiZWVuIGV4cGxpY2l0bHkgZGlzYWJsZWQsIHVwZGF0ZSB0aGUgaGFzaAogICAgICAvLyBmcmFnbWVudCB0byBzdG9yZSBoaXN0b3J5LgogICAgICB9IGVsc2UgaWYgKHRoaXMuX3dhbnRzSGFzaENoYW5nZSkgewogICAgICAgIHRoaXMuX3VwZGF0ZUhhc2godGhpcy5sb2NhdGlvbiwgZnJhZ21lbnQsIG9wdGlvbnMucmVwbGFjZSk7CiAgICAgICAgaWYgKHRoaXMuaWZyYW1lICYmIChmcmFnbWVudCAhPT0gdGhpcy5nZXRGcmFnbWVudCh0aGlzLmdldEhhc2godGhpcy5pZnJhbWUpKSkpIHsKICAgICAgICAgIC8vIE9wZW5pbmcgYW5kIGNsb3NpbmcgdGhlIGlmcmFtZSB0cmlja3MgSUU3IGFuZCBlYXJsaWVyIHRvIHB1c2ggYQogICAgICAgICAgLy8gaGlzdG9yeSBlbnRyeSBvbiBoYXNoLXRhZyBjaGFuZ2UuICBXaGVuIHJlcGxhY2UgaXMgdHJ1ZSwgd2UgZG9uJ3QKICAgICAgICAgIC8vIHdhbnQgdGhpcy4KICAgICAgICAgIGlmKCFvcHRpb25zLnJlcGxhY2UpIHRoaXMuaWZyYW1lLmRvY3VtZW50Lm9wZW4oKS5jbG9zZSgpOwogICAgICAgICAgdGhpcy5fdXBkYXRlSGFzaCh0aGlzLmlmcmFtZS5sb2NhdGlvbiwgZnJhZ21lbnQsIG9wdGlvbnMucmVwbGFjZSk7CiAgICAgICAgfQoKICAgICAgLy8gSWYgeW91J3ZlIHRvbGQgdXMgdGhhdCB5b3UgZXhwbGljaXRseSBkb24ndCB3YW50IGZhbGxiYWNrIGhhc2hjaGFuZ2UtCiAgICAgIC8vIGJhc2VkIGhpc3RvcnksIHRoZW4gYG5hdmlnYXRlYCBiZWNvbWVzIGEgcGFnZSByZWZyZXNoLgogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiB0aGlzLmxvY2F0aW9uLmFzc2lnbih1cmwpOwogICAgICB9CiAgICAgIGlmIChvcHRpb25zLnRyaWdnZXIpIHJldHVybiB0aGlzLmxvYWRVcmwoZnJhZ21lbnQpOwogICAgfSwKCiAgICAvLyBVcGRhdGUgdGhlIGhhc2ggbG9jYXRpb24sIGVpdGhlciByZXBsYWNpbmcgdGhlIGN1cnJlbnQgZW50cnksIG9yIGFkZGluZwogICAgLy8gYSBuZXcgb25lIHRvIHRoZSBicm93c2VyIGhpc3RvcnkuCiAgICBfdXBkYXRlSGFzaDogZnVuY3Rpb24obG9jYXRpb24sIGZyYWdtZW50LCByZXBsYWNlKSB7CiAgICAgIGlmIChyZXBsYWNlKSB7CiAgICAgICAgdmFyIGhyZWYgPSBsb2NhdGlvbi5ocmVmLnJlcGxhY2UoLyhqYXZhc2NyaXB0OnwjKS4qJC8sICcnKTsKICAgICAgICBsb2NhdGlvbi5yZXBsYWNlKGhyZWYgKyAnIycgKyBmcmFnbWVudCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gU29tZSBicm93c2VycyByZXF1aXJlIHRoYXQgYGhhc2hgIGNvbnRhaW5zIGEgbGVhZGluZyAjLgogICAgICAgIGxvY2F0aW9uLmhhc2ggPSAnIycgKyBmcmFnbWVudDsKICAgICAgfQogICAgfQoKICB9KTsKCiAgLy8gQ3JlYXRlIHRoZSBkZWZhdWx0IEJhY2tib25lLmhpc3RvcnkuCiAgQmFja2JvbmUuaGlzdG9yeSA9IG5ldyBIaXN0b3J5OwoKICAvLyBIZWxwZXJzCiAgLy8gLS0tLS0tLQoKICAvLyBIZWxwZXIgZnVuY3Rpb24gdG8gY29ycmVjdGx5IHNldCB1cCB0aGUgcHJvdG90eXBlIGNoYWluLCBmb3Igc3ViY2xhc3Nlcy4KICAvLyBTaW1pbGFyIHRvIGBnb29nLmluaGVyaXRzYCwgYnV0IHVzZXMgYSBoYXNoIG9mIHByb3RvdHlwZSBwcm9wZXJ0aWVzIGFuZAogIC8vIGNsYXNzIHByb3BlcnRpZXMgdG8gYmUgZXh0ZW5kZWQuCiAgdmFyIGV4dGVuZCA9IGZ1bmN0aW9uKHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7CiAgICB2YXIgcGFyZW50ID0gdGhpczsKICAgIHZhciBjaGlsZDsKCiAgICAvLyBUaGUgY29uc3RydWN0b3IgZnVuY3Rpb24gZm9yIHRoZSBuZXcgc3ViY2xhc3MgaXMgZWl0aGVyIGRlZmluZWQgYnkgeW91CiAgICAvLyAodGhlICJjb25zdHJ1Y3RvciIgcHJvcGVydHkgaW4geW91ciBgZXh0ZW5kYCBkZWZpbml0aW9uKSwgb3IgZGVmYXVsdGVkCiAgICAvLyBieSB1cyB0byBzaW1wbHkgY2FsbCB0aGUgcGFyZW50J3MgY29uc3RydWN0b3IuCiAgICBpZiAocHJvdG9Qcm9wcyAmJiBfLmhhcyhwcm90b1Byb3BzLCAnY29uc3RydWN0b3InKSkgewogICAgICBjaGlsZCA9IHByb3RvUHJvcHMuY29uc3RydWN0b3I7CiAgICB9IGVsc2UgewogICAgICBjaGlsZCA9IGZ1bmN0aW9uKCl7IHJldHVybiBwYXJlbnQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsgfTsKICAgIH0KCiAgICAvLyBBZGQgc3RhdGljIHByb3BlcnRpZXMgdG8gdGhlIGNvbnN0cnVjdG9yIGZ1bmN0aW9uLCBpZiBzdXBwbGllZC4KICAgIF8uZXh0ZW5kKGNoaWxkLCBwYXJlbnQsIHN0YXRpY1Byb3BzKTsKCiAgICAvLyBTZXQgdGhlIHByb3RvdHlwZSBjaGFpbiB0byBpbmhlcml0IGZyb20gYHBhcmVudGAsIHdpdGhvdXQgY2FsbGluZwogICAgLy8gYHBhcmVudGAncyBjb25zdHJ1Y3RvciBmdW5jdGlvbi4KICAgIHZhciBTdXJyb2dhdGUgPSBmdW5jdGlvbigpeyB0aGlzLmNvbnN0cnVjdG9yID0gY2hpbGQ7IH07CiAgICBTdXJyb2dhdGUucHJvdG90eXBlID0gcGFyZW50LnByb3RvdHlwZTsKICAgIGNoaWxkLnByb3RvdHlwZSA9IG5ldyBTdXJyb2dhdGU7CgogICAgLy8gQWRkIHByb3RvdHlwZSBwcm9wZXJ0aWVzIChpbnN0YW5jZSBwcm9wZXJ0aWVzKSB0byB0aGUgc3ViY2xhc3MsCiAgICAvLyBpZiBzdXBwbGllZC4KICAgIGlmIChwcm90b1Byb3BzKSBfLmV4dGVuZChjaGlsZC5wcm90b3R5cGUsIHByb3RvUHJvcHMpOwoKICAgIC8vIFNldCBhIGNvbnZlbmllbmNlIHByb3BlcnR5IGluIGNhc2UgdGhlIHBhcmVudCdzIHByb3RvdHlwZSBpcyBuZWVkZWQKICAgIC8vIGxhdGVyLgogICAgY2hpbGQuX19zdXBlcl9fID0gcGFyZW50LnByb3RvdHlwZTsKCiAgICByZXR1cm4gY2hpbGQ7CiAgfTsKCiAgLy8gU2V0IHVwIGluaGVyaXRhbmNlIGZvciB0aGUgbW9kZWwsIGNvbGxlY3Rpb24sIHJvdXRlciwgdmlldyBhbmQgaGlzdG9yeS4KICBNb2RlbC5leHRlbmQgPSBDb2xsZWN0aW9uLmV4dGVuZCA9IFJvdXRlci5leHRlbmQgPSBWaWV3LmV4dGVuZCA9IEhpc3RvcnkuZXh0ZW5kID0gZXh0ZW5kOwoKICAvLyBUaHJvdyBhbiBlcnJvciB3aGVuIGEgVVJMIGlzIG5lZWRlZCwgYW5kIG5vbmUgaXMgc3VwcGxpZWQuCiAgdmFyIHVybEVycm9yID0gZnVuY3Rpb24oKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoJ0EgInVybCIgcHJvcGVydHkgb3IgZnVuY3Rpb24gbXVzdCBiZSBzcGVjaWZpZWQnKTsKICB9OwoKICAvLyBXcmFwIGFuIG9wdGlvbmFsIGVycm9yIGNhbGxiYWNrIHdpdGggYSBmYWxsYmFjayBlcnJvciBldmVudC4KICB2YXIgd3JhcEVycm9yID0gZnVuY3Rpb24obW9kZWwsIG9wdGlvbnMpIHsKICAgIHZhciBlcnJvciA9IG9wdGlvbnMuZXJyb3I7CiAgICBvcHRpb25zLmVycm9yID0gZnVuY3Rpb24ocmVzcCkgewogICAgICBpZiAoZXJyb3IpIGVycm9yKG1vZGVsLCByZXNwLCBvcHRpb25zKTsKICAgICAgbW9kZWwudHJpZ2dlcignZXJyb3InLCBtb2RlbCwgcmVzcCwgb3B0aW9ucyk7CiAgICB9OwogIH07CgogIHJldHVybiBCYWNrYm9uZTsKCn0pKTsKCi8qKgogKiBCYWNrYm9uZSBsb2NhbFN0b3JhZ2UgYW5kIHNlc3Npb25TdG9yYWdlIEFkYXB0ZXIKICogVmVyc2lvbiAwLjAuMQogKgogKiBodHRwczovL2dpdGh1Yi5jb20vamNicmFuZC9CYWNrYm9uZS5icm93c2VyU3RvcmFnZQogKi8KKGZ1bmN0aW9uIChyb290LCBmYWN0b3J5KSB7CiAgaWYgKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgcmVxdWlyZSA9PT0gJ2Z1bmN0aW9uJykgewogICAgbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KHJlcXVpcmUoImJhY2tib25lIiksIHJlcXVpcmUoJ3VuZGVyc2NvcmUnKSk7CiAgfSBlbHNlIGlmICh0eXBlb2YgZGVmaW5lID09PSAiZnVuY3Rpb24iICYmIGRlZmluZS5hbWQpIHsKICAgIC8vIEFNRC4gUmVnaXN0ZXIgYXMgYW4gYW5vbnltb3VzIG1vZHVsZS4KICAgIGRlZmluZSgnYmFja2JvbmUuYnJvd3NlclN0b3JhZ2UnLFsiYmFja2JvbmUiLCAidW5kZXJzY29yZSJdLCBmdW5jdGlvbihCYWNrYm9uZSwgXykgewogICAgICAvLyBVc2UgZ2xvYmFsIHZhcmlhYmxlcyBpZiB0aGUgbG9jYWxzIGFyZSB1bmRlZmluZWQuCiAgICAgIHJldHVybiBmYWN0b3J5KEJhY2tib25lIHx8IHJvb3QuQmFja2JvbmUsIF8gfHwgcm9vdC5fKTsKICAgIH0pOwogIH0gZWxzZSB7CiAgICBmYWN0b3J5KEJhY2tib25lLCBfKTsKICB9Cn0odGhpcywgZnVuY3Rpb24oQmFja2JvbmUsIF8pIHsKLy8gQSBzaW1wbGUgbW9kdWxlIHRvIHJlcGxhY2UgYEJhY2tib25lLnN5bmNgIHdpdGggKmJyb3dzZXIgc3RvcmFnZSotYmFzZWQKLy8gcGVyc2lzdGVuY2UuIE1vZGVscyBhcmUgZ2l2ZW4gR1VJRFMsIGFuZCBzYXZlZCBpbnRvIGEgSlNPTiBvYmplY3QuIFNpbXBsZQovLyBhcyB0aGF0LgoKLy8gSG9sZCByZWZlcmVuY2UgdG8gVW5kZXJzY29yZS5qcyBhbmQgQmFja2JvbmUuanMgaW4gdGhlIGNsb3N1cmUgaW4gb3JkZXIKLy8gdG8gbWFrZSB0aGluZ3Mgd29yayBldmVuIGlmIHRoZXkgYXJlIHJlbW92ZWQgZnJvbSB0aGUgZ2xvYmFsIG5hbWVzcGFjZQoKLy8gR2VuZXJhdGUgZm91ciByYW5kb20gaGV4IGRpZ2l0cy4KZnVuY3Rpb24gUzQoKSB7CiAgIHJldHVybiAoKCgxK01hdGgucmFuZG9tKCkpKjB4MTAwMDApfDApLnRvU3RyaW5nKDE2KS5zdWJzdHJpbmcoMSk7Cn0KCi8vIEdlbmVyYXRlIGEgcHNldWRvLUdVSUQgYnkgY29uY2F0ZW5hdGluZyByYW5kb20gaGV4YWRlY2ltYWwuCmZ1bmN0aW9uIGd1aWQoKSB7CiAgIHJldHVybiAoUzQoKStTNCgpKyItIitTNCgpKyItIitTNCgpKyItIitTNCgpKyItIitTNCgpK1M0KCkrUzQoKSk7Cn0KCmZ1bmN0aW9uIGNvbnRhaW5zKGFycmF5LCBpdGVtKSB7CiAgdmFyIGkgPSBhcnJheS5sZW5ndGg7CiAgd2hpbGUgKGktLSkgaWYgKGFycmF5W2ldID09PSBpdGVtKSByZXR1cm4gdHJ1ZTsKICByZXR1cm4gZmFsc2U7Cn0KCmZ1bmN0aW9uIGV4dGVuZChvYmosIHByb3BzKSB7CiAgZm9yICh2YXIga2V5IGluIHByb3BzKSB7IG9ialtrZXldID0gcHJvcHNba2V5XTsgfQogIHJldHVybiBvYmo7Cn0KCmZ1bmN0aW9uIF9icm93c2VyU3RvcmFnZSAobmFtZSwgc2VyaWFsaXplciwgdHlwZSkgewogICAgdmFyIF9zdG9yZTsKICAgIGlmICh0eXBlID09PSAnbG9jYWwnICYmICF3aW5kb3cubG9jYWxTdG9yYWdlICkgewogICAgICAgIHRocm93ICJCYWNrYm9uZS5icm93c2VyU3RvcmFnZTogRW52aXJvbm1lbnQgZG9lcyBub3Qgc3VwcG9ydCBsb2NhbFN0b3JhZ2UuIjsKICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ3Nlc3Npb24nICYmICF3aW5kb3cuc2Vzc2lvblN0b3JhZ2UgKSB7CiAgICAgICAgdGhyb3cgIkJhY2tib25lLmJyb3dzZXJTdG9yYWdlOiBFbnZpcm9ubWVudCBkb2VzIG5vdCBzdXBwb3J0IHNlc3Npb25TdG9yYWdlLiI7CiAgICB9CiAgICB0aGlzLm5hbWUgPSBuYW1lOwogICAgdGhpcy5zZXJpYWxpemVyID0gc2VyaWFsaXplciB8fCB7CiAgICAgICAgc2VyaWFsaXplOiBmdW5jdGlvbihpdGVtKSB7CiAgICAgICAgcmV0dXJuIF8uaXNPYmplY3QoaXRlbSkgPyBKU09OLnN0cmluZ2lmeShpdGVtKSA6IGl0ZW07CiAgICAgICAgfSwKICAgICAgICAvLyBmaXggZm9yICJpbGxlZ2FsIGFjY2VzcyIgZXJyb3Igb24gQW5kcm9pZCB3aGVuIEpTT04ucGFyc2UgaXMgcGFzc2VkIG51bGwKICAgICAgICBkZXNlcmlhbGl6ZTogZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICByZXR1cm4gZGF0YSAmJiBKU09OLnBhcnNlKGRhdGEpOwogICAgICAgIH0KICAgIH07CgogICAgaWYgKHR5cGUgPT09ICdzZXNzaW9uJykgewogICAgICAgIHRoaXMuc3RvcmUgPSB3aW5kb3cuc2Vzc2lvblN0b3JhZ2U7CiAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICdsb2NhbCcpIHsKICAgICAgICB0aGlzLnN0b3JlID0gd2luZG93LmxvY2FsU3RvcmFnZTsKICAgIH0gZWxzZSB7CiAgICAgICAgdGhyb3cgIkJhY2tib25lLmJyb3dzZXJTdG9yYWdlOiBObyBzdG9yYWdlIHR5cGUgd2FzIHNwZWNpZmllZCI7CiAgICB9CiAgICBfc3RvcmUgPSB0aGlzLnN0b3JlLmdldEl0ZW0odGhpcy5uYW1lKTsKICAgIHRoaXMucmVjb3JkcyA9IChfc3RvcmUgJiYgX3N0b3JlLnNwbGl0KCIsIikpIHx8IFtdOwp9CgovLyBPdXIgU3RvcmUgaXMgcmVwcmVzZW50ZWQgYnkgYSBzaW5nbGUgSlMgb2JqZWN0IGluICpsb2NhbFN0b3JhZ2UqIG9yICpzZXNzaW9uU3RvcmFnZSouCi8vIENyZWF0ZSBpdCB3aXRoIGEgbWVhbmluZ2Z1bCBuYW1lLCBsaWtlIHRoZSBuYW1lIHlvdSdkIGdpdmUgYSB0YWJsZS4KQmFja2JvbmUuQnJvd3NlclN0b3JhZ2UgPSB7CiAgICBsb2NhbDogZnVuY3Rpb24gKG5hbWUsIHNlcmlhbGl6ZXIpIHsKICAgICAgICByZXR1cm4gX2Jyb3dzZXJTdG9yYWdlLmJpbmQodGhpcywgbmFtZSwgc2VyaWFsaXplciwgJ2xvY2FsJykoKTsKICAgIH0sCiAgICBzZXNzaW9uOiBmdW5jdGlvbiAobmFtZSwgc2VyaWFsaXplcikgewogICAgICAgIHJldHVybiBfYnJvd3NlclN0b3JhZ2UuYmluZCh0aGlzLCBuYW1lLCBzZXJpYWxpemVyLCAnc2Vzc2lvbicpKCk7CiAgICB9Cn07CgovLyBUaGUgYnJvd3NlcidzIGxvY2FsIGFuZCBzZXNzaW9uIHN0b3JlcyB3aWxsIGJlIGV4dGVuZGVkIHdpdGggdGhpcyBvYmouCnZhciBfZXh0ZW5zaW9uID0gewoKICAvLyBTYXZlIHRoZSBjdXJyZW50IHN0YXRlIG9mIHRoZSAqKlN0b3JlKioKICBzYXZlOiBmdW5jdGlvbigpIHsKICAgIHRoaXMuc3RvcmUuc2V0SXRlbSh0aGlzLm5hbWUsIHRoaXMucmVjb3Jkcy5qb2luKCIsIikpOwogIH0sCgogIC8vIEFkZCBhIG1vZGVsLCBnaXZpbmcgaXQgYSAoaG9wZWZ1bGx5KS11bmlxdWUgR1VJRCwgaWYgaXQgZG9lc24ndCBhbHJlYWR5CiAgLy8gaGF2ZSBhbiBpZCBvZiBpdCdzIG93bi4KICBjcmVhdGU6IGZ1bmN0aW9uKG1vZGVsKSB7CiAgICBpZiAoIW1vZGVsLmlkKSB7CiAgICAgIG1vZGVsLmlkID0gZ3VpZCgpOwogICAgICBtb2RlbC5zZXQobW9kZWwuaWRBdHRyaWJ1dGUsIG1vZGVsLmlkKTsKICAgIH0KICAgIHRoaXMuc3RvcmUuc2V0SXRlbSh0aGlzLl9pdGVtTmFtZShtb2RlbC5pZCksIHRoaXMuc2VyaWFsaXplci5zZXJpYWxpemUobW9kZWwpKTsKICAgIHRoaXMucmVjb3Jkcy5wdXNoKG1vZGVsLmlkLnRvU3RyaW5nKCkpOwogICAgdGhpcy5zYXZlKCk7CiAgICByZXR1cm4gdGhpcy5maW5kKG1vZGVsKSAhPT0gZmFsc2U7CiAgfSwKCiAgLy8gVXBkYXRlIGEgbW9kZWwgYnkgcmVwbGFjaW5nIGl0cyBjb3B5IGluIGB0aGlzLmRhdGFgLgogIHVwZGF0ZTogZnVuY3Rpb24obW9kZWwpIHsKICAgIHRoaXMuc3RvcmUuc2V0SXRlbSh0aGlzLl9pdGVtTmFtZShtb2RlbC5pZCksIHRoaXMuc2VyaWFsaXplci5zZXJpYWxpemUobW9kZWwpKTsKICAgIHZhciBtb2RlbElkID0gbW9kZWwuaWQudG9TdHJpbmcoKTsKICAgIGlmICghY29udGFpbnModGhpcy5yZWNvcmRzLCBtb2RlbElkKSkgewogICAgICB0aGlzLnJlY29yZHMucHVzaChtb2RlbElkKTsKICAgICAgdGhpcy5zYXZlKCk7CiAgICB9CiAgICByZXR1cm4gdGhpcy5maW5kKG1vZGVsKSAhPT0gZmFsc2U7CiAgfSwKCiAgLy8gUmV0cmlldmUgYSBtb2RlbCBmcm9tIGB0aGlzLmRhdGFgIGJ5IGlkLgogIGZpbmQ6IGZ1bmN0aW9uKG1vZGVsKSB7CiAgICByZXR1cm4gdGhpcy5zZXJpYWxpemVyLmRlc2VyaWFsaXplKHRoaXMuc3RvcmUuZ2V0SXRlbSh0aGlzLl9pdGVtTmFtZShtb2RlbC5pZCkpKTsKICB9LAoKICAvLyBSZXR1cm4gdGhlIGFycmF5IG9mIGFsbCBtb2RlbHMgY3VycmVudGx5IGluIHN0b3JhZ2UuCiAgZmluZEFsbDogZnVuY3Rpb24oKSB7CiAgICB2YXIgcmVzdWx0ID0gW107CiAgICBmb3IgKHZhciBpID0gMCwgaWQsIGRhdGE7IGkgPCB0aGlzLnJlY29yZHMubGVuZ3RoOyBpKyspIHsKICAgICAgaWQgPSB0aGlzLnJlY29yZHNbaV07CiAgICAgIGRhdGEgPSB0aGlzLnNlcmlhbGl6ZXIuZGVzZXJpYWxpemUodGhpcy5zdG9yZS5nZXRJdGVtKHRoaXMuX2l0ZW1OYW1lKGlkKSkpOwogICAgICBpZiAoZGF0YSAhPT0gbnVsbCkgcmVzdWx0LnB1c2goZGF0YSk7CiAgICB9CiAgICByZXR1cm4gcmVzdWx0OwogIH0sCgogIC8vIERlbGV0ZSBhIG1vZGVsIGZyb20gYHRoaXMuZGF0YWAsIHJldHVybmluZyBpdC4KICBkZXN0cm95OiBmdW5jdGlvbihtb2RlbCkgewogICAgdGhpcy5zdG9yZS5yZW1vdmVJdGVtKHRoaXMuX2l0ZW1OYW1lKG1vZGVsLmlkKSk7CiAgICB2YXIgbW9kZWxJZCA9IG1vZGVsLmlkLnRvU3RyaW5nKCk7CiAgICBmb3IgKHZhciBpID0gMCwgaWQ7IGkgPCB0aGlzLnJlY29yZHMubGVuZ3RoOyBpKyspIHsKICAgICAgaWYgKHRoaXMucmVjb3Jkc1tpXSA9PT0gbW9kZWxJZCkgewogICAgICAgIHRoaXMucmVjb3Jkcy5zcGxpY2UoaSwgMSk7CiAgICAgIH0KICAgIH0KICAgIHRoaXMuc2F2ZSgpOwogICAgcmV0dXJuIG1vZGVsOwogIH0sCgogIGJyb3dzZXJTdG9yYWdlOiBmdW5jdGlvbigpIHsKICAgIHJldHVybiB7CiAgICAgICAgc2Vzc2lvbjogc2Vzc2lvblN0b3JhZ2UsCiAgICAgICAgbG9jYWw6IGxvY2FsU3RvcmFnZQogICAgfTsKICB9LAoKICAvLyBDbGVhciBicm93c2VyU3RvcmFnZSBmb3Igc3BlY2lmaWMgY29sbGVjdGlvbi4KICBfY2xlYXI6IGZ1bmN0aW9uKCkgewogICAgdmFyIGxvY2FsID0gdGhpcy5zdG9yZSwKICAgICAgaXRlbVJlID0gbmV3IFJlZ0V4cCgiXiIgKyB0aGlzLm5hbWUgKyAiLSIpOwoKICAgIC8vIFJlbW92ZSBpZC10cmFja2luZyBpdGVtIChlLmcuLCAiZm9vIikuCiAgICBsb2NhbC5yZW1vdmVJdGVtKHRoaXMubmFtZSk7CgogICAgLy8gTWF0Y2ggYWxsIGRhdGEgaXRlbXMgKGUuZy4sICJmb28tSUQiKSBhbmQgcmVtb3ZlLgogICAgZm9yICh2YXIgayBpbiBsb2NhbCkgewogICAgICBpZiAoaXRlbVJlLnRlc3QoaykpIHsKICAgICAgICBsb2NhbC5yZW1vdmVJdGVtKGspOwogICAgICB9CiAgICB9CgogICAgdGhpcy5yZWNvcmRzLmxlbmd0aCA9IDA7CiAgfSwKCiAgLy8gU2l6ZSBvZiBicm93c2VyU3RvcmFnZS4KICBfc3RvcmFnZVNpemU6IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIHRoaXMuc3RvcmUubGVuZ3RoOwogIH0sCgogIF9pdGVtTmFtZTogZnVuY3Rpb24oaWQpIHsKICAgIHJldHVybiB0aGlzLm5hbWUrIi0iK2lkOwogIH0KCn07CgpleHRlbmQoQmFja2JvbmUuQnJvd3NlclN0b3JhZ2Uuc2Vzc2lvbi5wcm90b3R5cGUsIF9leHRlbnNpb24pOwpleHRlbmQoQmFja2JvbmUuQnJvd3NlclN0b3JhZ2UubG9jYWwucHJvdG90eXBlLCBfZXh0ZW5zaW9uKTsKCi8vIGxvY2FsU3luYyBkZWxlZ2F0ZSB0byB0aGUgbW9kZWwgb3IgY29sbGVjdGlvbidzCi8vICpicm93c2VyU3RvcmFnZSogcHJvcGVydHksIHdoaWNoIHNob3VsZCBiZSBhbiBpbnN0YW5jZSBvZiBgU3RvcmVgLgovLyB3aW5kb3cuU3RvcmUuc3luYyBhbmQgQmFja2JvbmUubG9jYWxTeW5jIGlzIGRlcHJlY2F0ZWQsIHVzZSBCYWNrYm9uZS5Ccm93c2VyU3RvcmFnZS5zeW5jIGluc3RlYWQKQmFja2JvbmUuQnJvd3NlclN0b3JhZ2Uuc3luYyA9IEJhY2tib25lLmxvY2FsU3luYyA9IGZ1bmN0aW9uKG1ldGhvZCwgbW9kZWwsIG9wdGlvbnMpIHsKICB2YXIgc3RvcmUgPSBtb2RlbC5icm93c2VyU3RvcmFnZSB8fCBtb2RlbC5jb2xsZWN0aW9uLmJyb3dzZXJTdG9yYWdlOwoKICB2YXIgcmVzcCwgZXJyb3JNZXNzYWdlOwogIC8vSWYgJCBpcyBoYXZpbmcgRGVmZXJyZWQgLSB1c2UgaXQuCiAgdmFyIHN5bmNEZmQgPSBCYWNrYm9uZS4kID8KICAgIChCYWNrYm9uZS4kLkRlZmVycmVkICYmIEJhY2tib25lLiQuRGVmZXJyZWQoKSkgOgogICAgKEJhY2tib25lLkRlZmVycmVkICYmIEJhY2tib25lLkRlZmVycmVkKCkpOwoKICB0cnkgewoKICAgIHN3aXRjaCAobWV0aG9kKSB7CiAgICAgIGNhc2UgInJlYWQiOgogICAgICAgIHJlc3AgPSBtb2RlbC5pZCAhPT0gdW5kZWZpbmVkID8gc3RvcmUuZmluZChtb2RlbCkgOiBzdG9yZS5maW5kQWxsKCk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgImNyZWF0ZSI6CiAgICAgICAgcmVzcCA9IHN0b3JlLmNyZWF0ZShtb2RlbCk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgInVwZGF0ZSI6CiAgICAgICAgcmVzcCA9IHN0b3JlLnVwZGF0ZShtb2RlbCk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgImRlbGV0ZSI6CiAgICAgICAgcmVzcCA9IHN0b3JlLmRlc3Ryb3kobW9kZWwpOwogICAgICAgIGJyZWFrOwogICAgfQoKICB9IGNhdGNoKGVycm9yKSB7CiAgICBpZiAoZXJyb3IuY29kZSA9PT0gMjIgJiYgc3RvcmUuX3N0b3JhZ2VTaXplKCkgPT09IDApCiAgICAgIGVycm9yTWVzc2FnZSA9ICJQcml2YXRlIGJyb3dzaW5nIGlzIHVuc3VwcG9ydGVkIjsKICAgIGVsc2UKICAgICAgZXJyb3JNZXNzYWdlID0gZXJyb3IubWVzc2FnZTsKICB9CgogIGlmIChyZXNwKSB7CiAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLnN1Y2Nlc3MpIHsKICAgICAgaWYgKEJhY2tib25lLlZFUlNJT04gPT09ICIwLjkuMTAiKSB7CiAgICAgICAgb3B0aW9ucy5zdWNjZXNzKG1vZGVsLCByZXNwLCBvcHRpb25zKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBvcHRpb25zLnN1Y2Nlc3MocmVzcCk7CiAgICAgIH0KICAgIH0KICAgIGlmIChzeW5jRGZkKSB7CiAgICAgIHN5bmNEZmQucmVzb2x2ZShyZXNwKTsKICAgIH0KCiAgfSBlbHNlIHsKICAgIGVycm9yTWVzc2FnZSA9IGVycm9yTWVzc2FnZSA/IGVycm9yTWVzc2FnZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogIlJlY29yZCBOb3QgRm91bmQiOwoKICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMuZXJyb3IpCiAgICAgIGlmIChCYWNrYm9uZS5WRVJTSU9OID09PSAiMC45LjEwIikgewogICAgICAgIG9wdGlvbnMuZXJyb3IobW9kZWwsIGVycm9yTWVzc2FnZSwgb3B0aW9ucyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgb3B0aW9ucy5lcnJvcihlcnJvck1lc3NhZ2UpOwogICAgICB9CgogICAgaWYgKHN5bmNEZmQpCiAgICAgIHN5bmNEZmQucmVqZWN0KGVycm9yTWVzc2FnZSk7CiAgfQoKICAvLyBhZGQgY29tcGF0aWJpbGl0eSB3aXRoICQuYWpheAogIC8vIGFsd2F5cyBleGVjdXRlIGNhbGxiYWNrIGZvciBzdWNjZXNzIGFuZCBlcnJvcgogIGlmIChvcHRpb25zICYmIG9wdGlvbnMuY29tcGxldGUpIG9wdGlvbnMuY29tcGxldGUocmVzcCk7CgogIHJldHVybiBzeW5jRGZkICYmIHN5bmNEZmQucHJvbWlzZSgpOwp9OwoKQmFja2JvbmUuYWpheFN5bmMgPSBCYWNrYm9uZS5zeW5jOwoKQmFja2JvbmUuZ2V0U3luY01ldGhvZCA9IGZ1bmN0aW9uKG1vZGVsKSB7CiAgaWYobW9kZWwuYnJvd3NlclN0b3JhZ2UgfHwgKG1vZGVsLmNvbGxlY3Rpb24gJiYgbW9kZWwuY29sbGVjdGlvbi5icm93c2VyU3RvcmFnZSkpIHsKICAgIHJldHVybiBCYWNrYm9uZS5sb2NhbFN5bmM7CiAgfQogIHJldHVybiBCYWNrYm9uZS5hamF4U3luYzsKfTsKCi8vIE92ZXJyaWRlICdCYWNrYm9uZS5zeW5jJyB0byBkZWZhdWx0IHRvIGxvY2FsU3luYywKLy8gdGhlIG9yaWdpbmFsICdCYWNrYm9uZS5zeW5jJyBpcyBzdGlsbCBhdmFpbGFibGUgaW4gJ0JhY2tib25lLmFqYXhTeW5jJwpCYWNrYm9uZS5zeW5jID0gZnVuY3Rpb24obWV0aG9kLCBtb2RlbCwgb3B0aW9ucykgewogIHJldHVybiBCYWNrYm9uZS5nZXRTeW5jTWV0aG9kKG1vZGVsKS5hcHBseSh0aGlzLCBbbWV0aG9kLCBtb2RlbCwgb3B0aW9uc10pOwp9OwoKcmV0dXJuIEJhY2tib25lLkJyb3dzZXJTdG9yYWdlOwp9KSk7CgovKiEKICogQmFja2JvbmUuT3ZlcnZpZXcgCiAqCiAqIENvcHlyaWdodCAoYykgMjAxNCwgSkMgQnJhbmQgPGpjQG9wa29kZS5jb20+CiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBNb3ppbGxhIFB1YmxpYyBMaWNlbnNlIChNUEwpIAogKi8KCihmdW5jdGlvbiAocm9vdCwgZmFjdG9yeSkgewogICAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkgewogICAgICAgIGRlZmluZSgnYmFja2JvbmUub3ZlcnZpZXcnLFsidW5kZXJzY29yZSIsICJiYWNrYm9uZSJdLAogICAgICAgICAgICBmdW5jdGlvbihfLCBCYWNrYm9uZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkoXyB8fCByb290Ll8sIEJhY2tib25lIHx8IHJvb3QuQmFja2JvbmUpOwogICAgICAgICAgICB9CiAgICAgICAgKTsKICAgfSBlbHNlIHsKICAgICAgLy8gUmVxdWlyZUpTIGlzbid0IGJlaW5nIHVzZWQuCiAgICAgIC8vIEFzc3VtZSB1bmRlcnNjb3JlIGFuZCBiYWNrYm9uZSBhcmUgbG9hZGVkIGluIDxzY3JpcHQ+IHRhZ3MKICAgICAgZmFjdG9yeShfLCBCYWNrYm9uZSk7CiAgIH0KfSh0aGlzLCBmdW5jdGlvbiAoXywgQmFja2JvbmUpIHsKICAgIAogICAgdmFyIE92ZXJ2aWV3ID0gQmFja2JvbmUuT3ZlcnZpZXcgPSBmdW5jdGlvbiAob3B0aW9ucykgewogICAgICAgIC8qIEFuIE92ZXJ2aWV3IGlzIGEgVmlldyB0aGF0IGNvbnRhaW5zIGFuZCBrZWVwcyB0cmFjayBvZiBzdWItdmlld3MuCiAgICAgICAgICogS2luZCBvZiBsaWtlIHdoYXQgYSBDb2xsZWN0aW9uIGlzIHRvIGEgTW9kZWwuCiAgICAgICAgICovCiAgICAgICAgdmFyIHZpZXdzID0ge307CiAgICAgICAgdGhpcy5rZXlzID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gXy5rZXlzKHZpZXdzKSB9OwogICAgICAgIHRoaXMuZ2V0QWxsID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdmlld3M7IH07CiAgICAgICAgdGhpcy5nZXQgPSBmdW5jdGlvbiAoaWQpIHsgcmV0dXJuIHZpZXdzW2lkXTsgfTsKICAgICAgICB0aGlzLmFkZCA9IGZ1bmN0aW9uIChpZCwgdmlldykgewogICAgICAgICAgICB2aWV3c1tpZF0gPSB2aWV3OwogICAgICAgICAgICByZXR1cm4gdmlldzsKICAgICAgICB9OwogICAgICAgIHRoaXMucmVtb3ZlID0gZnVuY3Rpb24gKGlkKSB7CiAgICAgICAgICAgIHZhciB2aWV3ID0gdmlld3NbaWRdOwogICAgICAgICAgICBpZiAodmlldykgewogICAgICAgICAgICAgICAgZGVsZXRlIHZpZXdzW2lkXTsKICAgICAgICAgICAgICAgIHZpZXcucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gdmlldzsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgdGhpcy5yZW1vdmVBbGwgPSBmdW5jdGlvbiAoaWQpIHsKICAgICAgICAgICAgXy5lYWNoKF8ua2V5cyh2aWV3cyksIHRoaXMucmVtb3ZlKTsKICAgICAgICB9OwoKICAgICAgICBCYWNrYm9uZS5WaWV3LmFwcGx5KHRoaXMsIEFycmF5LnByb3RvdHlwZS5zbGljZS5hcHBseShhcmd1bWVudHMpKTsKICAgIH07CiAgICBfLmV4dGVuZChPdmVydmlldy5wcm90b3R5cGUsIEJhY2tib25lLlZpZXcucHJvdG90eXBlKTsKICAgIE92ZXJ2aWV3LmV4dGVuZCA9IEJhY2tib25lLlZpZXcuZXh0ZW5kOwogICAgcmV0dXJuIEJhY2tib25lLk92ZXJ2aWV3Owp9KSk7CgovKiEKICogdHlwZWFoZWFkLmpzIDAuMTAuNQogKiBodHRwczovL2dpdGh1Yi5jb20vdHdpdHRlci90eXBlYWhlYWQuanMKICogQ29weXJpZ2h0IDIwMTMtMjAxNCBUd2l0dGVyLCBJbmMuIGFuZCBvdGhlciBjb250cmlidXRvcnM7IExpY2Vuc2VkIE1JVAogKi8KCihmdW5jdGlvbiAocm9vdCwgZmFjdG9yeSkgewogICAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkgewogICAgICAgIC8vIEFNRC4gUmVnaXN0ZXIgYXMgYW4gYW5vbnltb3VzIG1vZHVsZS4KICAgICAgICBkZWZpbmUoJ3R5cGVhaGVhZCcsWydqcXVlcnknXSwgZnVuY3Rpb24gKCQpIHsKICAgICAgICAgICAgZmFjdG9yeSgkLCByb290KTsKICAgICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgICAgLy8gQnJvd3NlciBnbG9iYWxzCiAgICAgICAgZmFjdG9yeShqUXVlcnksIHJvb3QpOwogICAgfQp9KHRoaXMsIGZ1bmN0aW9uKCQsIHdpbmRvdykgewogICAgdmFyIF8gPSBmdW5jdGlvbigpIHsKICAgICAgICAKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBpc01zaWU6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIC8obXNpZXx0cmlkZW50KS9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkgPyBuYXZpZ2F0b3IudXNlckFnZW50Lm1hdGNoKC8obXNpZSB8cnY6KShcZCsoLlxkKyk/KS9pKVsyXSA6IGZhbHNlOwogICAgICAgICAgICB9LAogICAgICAgICAgICBpc0JsYW5rU3RyaW5nOiBmdW5jdGlvbihzdHIpIHsKICAgICAgICAgICAgICAgIHJldHVybiAhc3RyIHx8IC9eXHMqJC8udGVzdChzdHIpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBlc2NhcGVSZWdFeENoYXJzOiBmdW5jdGlvbihzdHIpIHsKICAgICAgICAgICAgICAgIHJldHVybiBzdHIucmVwbGFjZSgvW1wtXFtcXVwvXHtcfVwoXClcKlwrXD9cLlxcXF5cJFx8XS9nLCAiXFwkJiIpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBpc1N0cmluZzogZnVuY3Rpb24ob2JqKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHlwZW9mIG9iaiA9PT0gInN0cmluZyI7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGlzTnVtYmVyOiBmdW5jdGlvbihvYmopIHsKICAgICAgICAgICAgICAgIHJldHVybiB0eXBlb2Ygb2JqID09PSAibnVtYmVyIjsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgaXNBcnJheTogJC5pc0FycmF5LAogICAgICAgICAgICBpc0Z1bmN0aW9uOiAkLmlzRnVuY3Rpb24sCiAgICAgICAgICAgIGlzT2JqZWN0OiAkLmlzUGxhaW5PYmplY3QsCiAgICAgICAgICAgIGlzVW5kZWZpbmVkOiBmdW5jdGlvbihvYmopIHsKICAgICAgICAgICAgICAgIHJldHVybiB0eXBlb2Ygb2JqID09PSAidW5kZWZpbmVkIjsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgdG9TdHI6IGZ1bmN0aW9uIHRvU3RyKHMpIHsKICAgICAgICAgICAgICAgIHJldHVybiBfLmlzVW5kZWZpbmVkKHMpIHx8IHMgPT09IG51bGwgPyAiIiA6IHMgKyAiIjsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgYmluZDogJC5wcm94eSwKICAgICAgICAgICAgZWFjaDogZnVuY3Rpb24oY29sbGVjdGlvbiwgY2IpIHsKICAgICAgICAgICAgICAgICQuZWFjaChjb2xsZWN0aW9uLCByZXZlcnNlQXJncyk7CiAgICAgICAgICAgICAgICBmdW5jdGlvbiByZXZlcnNlQXJncyhpbmRleCwgdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2IodmFsdWUsIGluZGV4KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgbWFwOiAkLm1hcCwKICAgICAgICAgICAgZmlsdGVyOiAkLmdyZXAsCiAgICAgICAgICAgIGV2ZXJ5OiBmdW5jdGlvbihvYmosIHRlc3QpIHsKICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSB0cnVlOwogICAgICAgICAgICAgICAgaWYgKCFvYmopIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJC5lYWNoKG9iaiwgZnVuY3Rpb24oa2V5LCB2YWwpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIShyZXN1bHQgPSB0ZXN0LmNhbGwobnVsbCwgdmFsLCBrZXksIG9iaikpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHJldHVybiAhIXJlc3VsdDsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc29tZTogZnVuY3Rpb24ob2JqLCB0ZXN0KSB7CiAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gZmFsc2U7CiAgICAgICAgICAgICAgICBpZiAoIW9iaikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkLmVhY2gob2JqLCBmdW5jdGlvbihrZXksIHZhbCkgewogICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQgPSB0ZXN0LmNhbGwobnVsbCwgdmFsLCBrZXksIG9iaikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuICEhcmVzdWx0OwogICAgICAgICAgICB9LAogICAgICAgICAgICBtaXhpbjogJC5leHRlbmQsCiAgICAgICAgICAgIGdldFVuaXF1ZUlkOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHZhciBjb3VudGVyID0gMDsKICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY291bnRlcisrOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSgpLAogICAgICAgICAgICB0ZW1wbGF0aWZ5OiBmdW5jdGlvbiB0ZW1wbGF0aWZ5KG9iaikgewogICAgICAgICAgICAgICAgcmV0dXJuICQuaXNGdW5jdGlvbihvYmopID8gb2JqIDogdGVtcGxhdGU7CiAgICAgICAgICAgICAgICBmdW5jdGlvbiB0ZW1wbGF0ZSgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gU3RyaW5nKG9iaik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRlZmVyOiBmdW5jdGlvbihmbikgewogICAgICAgICAgICAgICAgc2V0VGltZW91dChmbiwgMCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRlYm91bmNlOiBmdW5jdGlvbihmdW5jLCB3YWl0LCBpbW1lZGlhdGUpIHsKICAgICAgICAgICAgICAgIHZhciB0aW1lb3V0LCByZXN1bHQ7CiAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbnRleHQgPSB0aGlzLCBhcmdzID0gYXJndW1lbnRzLCBsYXRlciwgY2FsbE5vdzsKICAgICAgICAgICAgICAgICAgICBsYXRlciA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aW1lb3V0ID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFpbW1lZGlhdGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IGZ1bmMuYXBwbHkoY29udGV4dCwgYXJncyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGNhbGxOb3cgPSBpbW1lZGlhdGUgJiYgIXRpbWVvdXQ7CiAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXQpOwogICAgICAgICAgICAgICAgICAgIHRpbWVvdXQgPSBzZXRUaW1lb3V0KGxhdGVyLCB3YWl0KTsKICAgICAgICAgICAgICAgICAgICBpZiAoY2FsbE5vdykgewogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBmdW5jLmFwcGx5KGNvbnRleHQsIGFyZ3MpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgdGhyb3R0bGU6IGZ1bmN0aW9uKGZ1bmMsIHdhaXQpIHsKICAgICAgICAgICAgICAgIHZhciBjb250ZXh0LCBhcmdzLCB0aW1lb3V0LCByZXN1bHQsIHByZXZpb3VzLCBsYXRlcjsKICAgICAgICAgICAgICAgIHByZXZpb3VzID0gMDsKICAgICAgICAgICAgICAgIGxhdGVyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgcHJldmlvdXMgPSBuZXcgRGF0ZSgpOwogICAgICAgICAgICAgICAgICAgIHRpbWVvdXQgPSBudWxsOwogICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IGZ1bmMuYXBwbHkoY29udGV4dCwgYXJncyk7CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBub3cgPSBuZXcgRGF0ZSgpLCByZW1haW5pbmcgPSB3YWl0IC0gKG5vdyAtIHByZXZpb3VzKTsKICAgICAgICAgICAgICAgICAgICBjb250ZXh0ID0gdGhpczsKICAgICAgICAgICAgICAgICAgICBhcmdzID0gYXJndW1lbnRzOwogICAgICAgICAgICAgICAgICAgIGlmIChyZW1haW5pbmcgPD0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVvdXQgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICBwcmV2aW91cyA9IG5vdzsKICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCF0aW1lb3V0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVvdXQgPSBzZXRUaW1lb3V0KGxhdGVyLCByZW1haW5pbmcpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgbm9vcDogZnVuY3Rpb24oKSB7fQogICAgICAgIH07CiAgICB9KCk7CiAgICB2YXIgaHRtbCA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHdyYXBwZXI6ICc8c3BhbiBjbGFzcz0idHdpdHRlci10eXBlYWhlYWQiPjwvc3Bhbj4nLAogICAgICAgICAgICBkcm9wZG93bjogJzxzcGFuIGNsYXNzPSJ0dC1kcm9wZG93bi1tZW51Ij48L3NwYW4+JywKICAgICAgICAgICAgZGF0YXNldDogJzxkaXYgY2xhc3M9InR0LWRhdGFzZXQtJUNMQVNTJSI+PC9kaXY+JywKICAgICAgICAgICAgc3VnZ2VzdGlvbnM6ICc8c3BhbiBjbGFzcz0idHQtc3VnZ2VzdGlvbnMiPjwvc3Bhbj4nLAogICAgICAgICAgICBzdWdnZXN0aW9uOiAnPGRpdiBjbGFzcz0idHQtc3VnZ2VzdGlvbiI+PC9kaXY+JwogICAgICAgIH07CiAgICB9KCk7CiAgICB2YXIgY3NzID0gZnVuY3Rpb24oKSB7CiAgICAgICAgCiAgICAgICAgdmFyIGNzcyA9IHsKICAgICAgICAgICAgd3JhcHBlcjogewogICAgICAgICAgICAgICAgcG9zaXRpb246ICJyZWxhdGl2ZSIsCiAgICAgICAgICAgICAgICBkaXNwbGF5OiAiaW5saW5lLWJsb2NrIgogICAgICAgICAgICB9LAogICAgICAgICAgICBoaW50OiB7CiAgICAgICAgICAgICAgICBwb3NpdGlvbjogImFic29sdXRlIiwKICAgICAgICAgICAgICAgIHRvcDogIjAiLAogICAgICAgICAgICAgICAgbGVmdDogIjAiLAogICAgICAgICAgICAgICAgYm9yZGVyQ29sb3I6ICJ0cmFuc3BhcmVudCIsCiAgICAgICAgICAgICAgICBib3hTaGFkb3c6ICJub25lIiwKICAgICAgICAgICAgICAgIG9wYWNpdHk6ICIxIgogICAgICAgICAgICB9LAogICAgICAgICAgICBpbnB1dDogewogICAgICAgICAgICAgICAgcG9zaXRpb246ICJyZWxhdGl2ZSIsCiAgICAgICAgICAgICAgICB2ZXJ0aWNhbEFsaWduOiAidG9wIiwKICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogInRyYW5zcGFyZW50IgogICAgICAgICAgICB9LAogICAgICAgICAgICBpbnB1dFdpdGhOb0hpbnQ6IHsKICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAicmVsYXRpdmUiLAogICAgICAgICAgICAgICAgdmVydGljYWxBbGlnbjogInRvcCIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZHJvcGRvd246IHsKICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAiYWJzb2x1dGUiLAogICAgICAgICAgICAgICAgdG9wOiAiMTAwJSIsCiAgICAgICAgICAgICAgICBsZWZ0OiAiMCIsCiAgICAgICAgICAgICAgICB6SW5kZXg6ICIxMDAiLAogICAgICAgICAgICAgICAgZGlzcGxheTogIm5vbmUiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHN1Z2dlc3Rpb25zOiB7CiAgICAgICAgICAgICAgICBkaXNwbGF5OiAiYmxvY2siCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHN1Z2dlc3Rpb246IHsKICAgICAgICAgICAgICAgIHdoaXRlU3BhY2U6ICJub3dyYXAiLAogICAgICAgICAgICAgICAgY3Vyc29yOiAicG9pbnRlciIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc3VnZ2VzdGlvbkNoaWxkOiB7CiAgICAgICAgICAgICAgICB3aGl0ZVNwYWNlOiAibm9ybWFsIgogICAgICAgICAgICB9LAogICAgICAgICAgICBsdHI6IHsKICAgICAgICAgICAgICAgIGxlZnQ6ICIwIiwKICAgICAgICAgICAgICAgIHJpZ2h0OiAiYXV0byIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgcnRsOiB7CiAgICAgICAgICAgICAgICBsZWZ0OiAiYXV0byIsCiAgICAgICAgICAgICAgICByaWdodDogIiAwIgogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBpZiAoXy5pc01zaWUoKSkgewogICAgICAgICAgICBfLm1peGluKGNzcy5pbnB1dCwgewogICAgICAgICAgICAgICAgYmFja2dyb3VuZEltYWdlOiAidXJsKGRhdGE6aW1hZ2UvZ2lmO2Jhc2U2NCxSMGxHT0RsaEFRQUJBSUFBQUFBQUFQLy8veUg1QkFFQUFBQUFMQUFBQUFBQkFBRUFBQUlCUkFBNykiCiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBpZiAoXy5pc01zaWUoKSAmJiBfLmlzTXNpZSgpIDw9IDcpIHsKICAgICAgICAgICAgXy5taXhpbihjc3MuaW5wdXQsIHsKICAgICAgICAgICAgICAgIG1hcmdpblRvcDogIi0xcHgiCiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gY3NzOwogICAgfSgpOwogICAgdmFyIEV2ZW50QnVzID0gZnVuY3Rpb24oKSB7CiAgICAgICAgCiAgICAgICAgdmFyIG5hbWVzcGFjZSA9ICJ0eXBlYWhlYWQ6IjsKICAgICAgICBmdW5jdGlvbiBFdmVudEJ1cyhvKSB7CiAgICAgICAgICAgIGlmICghbyB8fCAhby5lbCkgewogICAgICAgICAgICAgICAgJC5lcnJvcigiRXZlbnRCdXMgaW5pdGlhbGl6ZWQgd2l0aG91dCBlbCIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuJGVsID0gJChvLmVsKTsKICAgICAgICB9CiAgICAgICAgXy5taXhpbihFdmVudEJ1cy5wcm90b3R5cGUsIHsKICAgICAgICAgICAgdHJpZ2dlcjogZnVuY3Rpb24odHlwZSkgewogICAgICAgICAgICAgICAgdmFyIGFyZ3MgPSBbXS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSk7CiAgICAgICAgICAgICAgICB0aGlzLiRlbC50cmlnZ2VyKG5hbWVzcGFjZSArIHR5cGUsIGFyZ3MpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIEV2ZW50QnVzOwogICAgfSgpOwogICAgdmFyIEV2ZW50RW1pdHRlciA9IGZ1bmN0aW9uKCkgewogICAgICAgIAogICAgICAgIHZhciBzcGxpdHRlciA9IC9ccysvLCBuZXh0VGljayA9IGdldE5leHRUaWNrKCk7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgb25TeW5jOiBvblN5bmMsCiAgICAgICAgICAgIG9uQXN5bmM6IG9uQXN5bmMsCiAgICAgICAgICAgIG9mZjogb2ZmLAogICAgICAgICAgICB0cmlnZ2VyOiB0cmlnZ2VyCiAgICAgICAgfTsKICAgICAgICBmdW5jdGlvbiBvbihtZXRob2QsIHR5cGVzLCBjYiwgY29udGV4dCkgewogICAgICAgICAgICB2YXIgdHlwZTsKICAgICAgICAgICAgaWYgKCFjYikgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdHlwZXMgPSB0eXBlcy5zcGxpdChzcGxpdHRlcik7CiAgICAgICAgICAgIGNiID0gY29udGV4dCA/IGJpbmRDb250ZXh0KGNiLCBjb250ZXh0KSA6IGNiOwogICAgICAgICAgICB0aGlzLl9jYWxsYmFja3MgPSB0aGlzLl9jYWxsYmFja3MgfHwge307CiAgICAgICAgICAgIHdoaWxlICh0eXBlID0gdHlwZXMuc2hpZnQoKSkgewogICAgICAgICAgICAgICAgdGhpcy5fY2FsbGJhY2tzW3R5cGVdID0gdGhpcy5fY2FsbGJhY2tzW3R5cGVdIHx8IHsKICAgICAgICAgICAgICAgICAgICBzeW5jOiBbXSwKICAgICAgICAgICAgICAgICAgICBhc3luYzogW10KICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB0aGlzLl9jYWxsYmFja3NbdHlwZV1bbWV0aG9kXS5wdXNoKGNiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gb25Bc3luYyh0eXBlcywgY2IsIGNvbnRleHQpIHsKICAgICAgICAgICAgcmV0dXJuIG9uLmNhbGwodGhpcywgImFzeW5jIiwgdHlwZXMsIGNiLCBjb250ZXh0KTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gb25TeW5jKHR5cGVzLCBjYiwgY29udGV4dCkgewogICAgICAgICAgICByZXR1cm4gb24uY2FsbCh0aGlzLCAic3luYyIsIHR5cGVzLCBjYiwgY29udGV4dCk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIG9mZih0eXBlcykgewogICAgICAgICAgICB2YXIgdHlwZTsKICAgICAgICAgICAgaWYgKCF0aGlzLl9jYWxsYmFja3MpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHR5cGVzID0gdHlwZXMuc3BsaXQoc3BsaXR0ZXIpOwogICAgICAgICAgICB3aGlsZSAodHlwZSA9IHR5cGVzLnNoaWZ0KCkpIHsKICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLl9jYWxsYmFja3NbdHlwZV07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHRyaWdnZXIodHlwZXMpIHsKICAgICAgICAgICAgdmFyIHR5cGUsIGNhbGxiYWNrcywgYXJncywgc3luY0ZsdXNoLCBhc3luY0ZsdXNoOwogICAgICAgICAgICBpZiAoIXRoaXMuX2NhbGxiYWNrcykgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdHlwZXMgPSB0eXBlcy5zcGxpdChzcGxpdHRlcik7CiAgICAgICAgICAgIGFyZ3MgPSBbXS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSk7CiAgICAgICAgICAgIHdoaWxlICgodHlwZSA9IHR5cGVzLnNoaWZ0KCkpICYmIChjYWxsYmFja3MgPSB0aGlzLl9jYWxsYmFja3NbdHlwZV0pKSB7CiAgICAgICAgICAgICAgICBzeW5jRmx1c2ggPSBnZXRGbHVzaChjYWxsYmFja3Muc3luYywgdGhpcywgWyB0eXBlIF0uY29uY2F0KGFyZ3MpKTsKICAgICAgICAgICAgICAgIGFzeW5jRmx1c2ggPSBnZXRGbHVzaChjYWxsYmFja3MuYXN5bmMsIHRoaXMsIFsgdHlwZSBdLmNvbmNhdChhcmdzKSk7CiAgICAgICAgICAgICAgICBzeW5jRmx1c2goKSAmJiBuZXh0VGljayhhc3luY0ZsdXNoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gZ2V0Rmx1c2goY2FsbGJhY2tzLCBjb250ZXh0LCBhcmdzKSB7CiAgICAgICAgICAgIHJldHVybiBmbHVzaDsKICAgICAgICAgICAgZnVuY3Rpb24gZmx1c2goKSB7CiAgICAgICAgICAgICAgICB2YXIgY2FuY2VsbGVkOwogICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IGNhbGxiYWNrcy5sZW5ndGg7ICFjYW5jZWxsZWQgJiYgaSA8IGxlbjsgaSArPSAxKSB7CiAgICAgICAgICAgICAgICAgICAgY2FuY2VsbGVkID0gY2FsbGJhY2tzW2ldLmFwcGx5KGNvbnRleHQsIGFyZ3MpID09PSBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiAhY2FuY2VsbGVkOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGdldE5leHRUaWNrKCkgewogICAgICAgICAgICB2YXIgbmV4dFRpY2tGbjsKICAgICAgICAgICAgaWYgKHdpbmRvdy5zZXRJbW1lZGlhdGUpIHsKICAgICAgICAgICAgICAgIG5leHRUaWNrRm4gPSBmdW5jdGlvbiBuZXh0VGlja1NldEltbWVkaWF0ZShmbikgewogICAgICAgICAgICAgICAgICAgIHNldEltbWVkaWF0ZShmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm4oKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBuZXh0VGlja0ZuID0gZnVuY3Rpb24gbmV4dFRpY2tTZXRUaW1lb3V0KGZuKSB7CiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm4oKTsKICAgICAgICAgICAgICAgICAgICB9LCAwKTsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG5leHRUaWNrRm47CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGJpbmRDb250ZXh0KGZuLCBjb250ZXh0KSB7CiAgICAgICAgICAgIHJldHVybiBmbi5iaW5kID8gZm4uYmluZChjb250ZXh0KSA6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgZm4uYXBwbHkoY29udGV4dCwgW10uc2xpY2UuY2FsbChhcmd1bWVudHMsIDApKTsKICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICB9KCk7CiAgICB2YXIgaGlnaGxpZ2h0ID0gZnVuY3Rpb24oZG9jKSB7CiAgICAgICAgCiAgICAgICAgdmFyIGRlZmF1bHRzID0gewogICAgICAgICAgICBub2RlOiBudWxsLAogICAgICAgICAgICBwYXR0ZXJuOiBudWxsLAogICAgICAgICAgICB0YWdOYW1lOiAic3Ryb25nIiwKICAgICAgICAgICAgY2xhc3NOYW1lOiBudWxsLAogICAgICAgICAgICB3b3Jkc09ubHk6IGZhbHNlLAogICAgICAgICAgICBjYXNlU2Vuc2l0aXZlOiBmYWxzZQogICAgICAgIH07CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIGhpZ2h0bGlnaHQobykgewogICAgICAgICAgICB2YXIgcmVnZXg7CiAgICAgICAgICAgIG8gPSBfLm1peGluKHt9LCBkZWZhdWx0cywgbyk7CiAgICAgICAgICAgIGlmICghby5ub2RlIHx8ICFvLnBhdHRlcm4pIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBvLnBhdHRlcm4gPSBfLmlzQXJyYXkoby5wYXR0ZXJuKSA/IG8ucGF0dGVybiA6IFsgby5wYXR0ZXJuIF07CiAgICAgICAgICAgIHJlZ2V4ID0gZ2V0UmVnZXgoby5wYXR0ZXJuLCBvLmNhc2VTZW5zaXRpdmUsIG8ud29yZHNPbmx5KTsKICAgICAgICAgICAgdHJhdmVyc2Uoby5ub2RlLCBoaWdodGxpZ2h0VGV4dE5vZGUpOwogICAgICAgICAgICBmdW5jdGlvbiBoaWdodGxpZ2h0VGV4dE5vZGUodGV4dE5vZGUpIHsKICAgICAgICAgICAgICAgIHZhciBtYXRjaCwgcGF0dGVybk5vZGUsIHdyYXBwZXJOb2RlOwogICAgICAgICAgICAgICAgaWYgKG1hdGNoID0gcmVnZXguZXhlYyh0ZXh0Tm9kZS5kYXRhKSkgewogICAgICAgICAgICAgICAgICAgIHdyYXBwZXJOb2RlID0gZG9jLmNyZWF0ZUVsZW1lbnQoby50YWdOYW1lKTsKICAgICAgICAgICAgICAgICAgICBvLmNsYXNzTmFtZSAmJiAod3JhcHBlck5vZGUuY2xhc3NOYW1lID0gby5jbGFzc05hbWUpOwogICAgICAgICAgICAgICAgICAgIHBhdHRlcm5Ob2RlID0gdGV4dE5vZGUuc3BsaXRUZXh0KG1hdGNoLmluZGV4KTsKICAgICAgICAgICAgICAgICAgICBwYXR0ZXJuTm9kZS5zcGxpdFRleHQobWF0Y2hbMF0ubGVuZ3RoKTsKICAgICAgICAgICAgICAgICAgICB3cmFwcGVyTm9kZS5hcHBlbmRDaGlsZChwYXR0ZXJuTm9kZS5jbG9uZU5vZGUodHJ1ZSkpOwogICAgICAgICAgICAgICAgICAgIHRleHROb2RlLnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKHdyYXBwZXJOb2RlLCBwYXR0ZXJuTm9kZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gISFtYXRjaDsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiB0cmF2ZXJzZShlbCwgaGlnaHRsaWdodFRleHROb2RlKSB7CiAgICAgICAgICAgICAgICB2YXIgY2hpbGROb2RlLCBURVhUX05PREVfVFlQRSA9IDM7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGVsLmNoaWxkTm9kZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBjaGlsZE5vZGUgPSBlbC5jaGlsZE5vZGVzW2ldOwogICAgICAgICAgICAgICAgICAgIGlmIChjaGlsZE5vZGUubm9kZVR5cGUgPT09IFRFWFRfTk9ERV9UWVBFKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGkgKz0gaGlnaHRsaWdodFRleHROb2RlKGNoaWxkTm9kZSkgPyAxIDogMDsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB0cmF2ZXJzZShjaGlsZE5vZGUsIGhpZ2h0bGlnaHRUZXh0Tm9kZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBmdW5jdGlvbiBnZXRSZWdleChwYXR0ZXJucywgY2FzZVNlbnNpdGl2ZSwgd29yZHNPbmx5KSB7CiAgICAgICAgICAgIHZhciBlc2NhcGVkUGF0dGVybnMgPSBbXSwgcmVnZXhTdHI7CiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBwYXR0ZXJucy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgICAgICAgZXNjYXBlZFBhdHRlcm5zLnB1c2goXy5lc2NhcGVSZWdFeENoYXJzKHBhdHRlcm5zW2ldKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmVnZXhTdHIgPSB3b3Jkc09ubHkgPyAiXFxiKCIgKyBlc2NhcGVkUGF0dGVybnMuam9pbigifCIpICsgIilcXGIiIDogIigiICsgZXNjYXBlZFBhdHRlcm5zLmpvaW4oInwiKSArICIpIjsKICAgICAgICAgICAgcmV0dXJuIGNhc2VTZW5zaXRpdmUgPyBuZXcgUmVnRXhwKHJlZ2V4U3RyKSA6IG5ldyBSZWdFeHAocmVnZXhTdHIsICJpIik7CiAgICAgICAgfQogICAgfSh3aW5kb3cuZG9jdW1lbnQpOwogICAgdmFyIElucHV0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgCiAgICAgICAgdmFyIHNwZWNpYWxLZXlDb2RlTWFwOwogICAgICAgIHNwZWNpYWxLZXlDb2RlTWFwID0gewogICAgICAgICAgICA5OiAidGFiIiwKICAgICAgICAgICAgMjc6ICJlc2MiLAogICAgICAgICAgICAzNzogImxlZnQiLAogICAgICAgICAgICAzOTogInJpZ2h0IiwKICAgICAgICAgICAgMTM6ICJlbnRlciIsCiAgICAgICAgICAgIDM4OiAidXAiLAogICAgICAgICAgICA0MDogImRvd24iCiAgICAgICAgfTsKICAgICAgICBmdW5jdGlvbiBJbnB1dChvKSB7CiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgb25CbHVyLCBvbkZvY3VzLCBvbktleWRvd24sIG9uSW5wdXQ7CiAgICAgICAgICAgIG8gPSBvIHx8IHt9OwogICAgICAgICAgICBpZiAoIW8uaW5wdXQpIHsKICAgICAgICAgICAgICAgICQuZXJyb3IoImlucHV0IGlzIG1pc3NpbmciKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBvbkJsdXIgPSBfLmJpbmQodGhpcy5fb25CbHVyLCB0aGlzKTsKICAgICAgICAgICAgb25Gb2N1cyA9IF8uYmluZCh0aGlzLl9vbkZvY3VzLCB0aGlzKTsKICAgICAgICAgICAgb25LZXlkb3duID0gXy5iaW5kKHRoaXMuX29uS2V5ZG93biwgdGhpcyk7CiAgICAgICAgICAgIG9uSW5wdXQgPSBfLmJpbmQodGhpcy5fb25JbnB1dCwgdGhpcyk7CiAgICAgICAgICAgIHRoaXMuJGhpbnQgPSAkKG8uaGludCk7CiAgICAgICAgICAgIHRoaXMuJGlucHV0ID0gJChvLmlucHV0KS5vbigiYmx1ci50dCIsIG9uQmx1cikub24oImZvY3VzLnR0Iiwgb25Gb2N1cykub24oImtleWRvd24udHQiLCBvbktleWRvd24pOwogICAgICAgICAgICBpZiAodGhpcy4kaGludC5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgIHRoaXMuc2V0SGludCA9IHRoaXMuZ2V0SGludCA9IHRoaXMuY2xlYXJIaW50ID0gdGhpcy5jbGVhckhpbnRJZkludmFsaWQgPSBfLm5vb3A7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCFfLmlzTXNpZSgpKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRpbnB1dC5vbigiaW5wdXQudHQiLCBvbklucHV0KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuJGlucHV0Lm9uKCJrZXlkb3duLnR0IGtleXByZXNzLnR0IGN1dC50dCBwYXN0ZS50dCIsIGZ1bmN0aW9uKCRlKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHNwZWNpYWxLZXlDb2RlTWFwWyRlLndoaWNoIHx8ICRlLmtleUNvZGVdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgXy5kZWZlcihfLmJpbmQodGhhdC5fb25JbnB1dCwgdGhhdCwgJGUpKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMucXVlcnkgPSB0aGlzLiRpbnB1dC52YWwoKTsKICAgICAgICAgICAgdGhpcy4kb3ZlcmZsb3dIZWxwZXIgPSBidWlsZE92ZXJmbG93SGVscGVyKHRoaXMuJGlucHV0KTsKICAgICAgICB9CiAgICAgICAgSW5wdXQubm9ybWFsaXplUXVlcnkgPSBmdW5jdGlvbihzdHIpIHsKICAgICAgICAgICAgcmV0dXJuIChzdHIgfHwgIiIpLnJlcGxhY2UoL15ccyovZywgIiIpLnJlcGxhY2UoL1xzezIsfS9nLCAiICIpOwogICAgICAgIH07CiAgICAgICAgXy5taXhpbihJbnB1dC5wcm90b3R5cGUsIEV2ZW50RW1pdHRlciwgewogICAgICAgICAgICBfb25CbHVyOiBmdW5jdGlvbiBvbkJsdXIoKSB7CiAgICAgICAgICAgICAgICB0aGlzLnJlc2V0SW5wdXRWYWx1ZSgpOwogICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCJibHVycmVkIik7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9vbkZvY3VzOiBmdW5jdGlvbiBvbkZvY3VzKCkgewogICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCJmb2N1c2VkIik7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9vbktleWRvd246IGZ1bmN0aW9uIG9uS2V5ZG93bigkZSkgewogICAgICAgICAgICAgICAgdmFyIGtleU5hbWUgPSBzcGVjaWFsS2V5Q29kZU1hcFskZS53aGljaCB8fCAkZS5rZXlDb2RlXTsKICAgICAgICAgICAgICAgIHRoaXMuX21hbmFnZVByZXZlbnREZWZhdWx0KGtleU5hbWUsICRlKTsKICAgICAgICAgICAgICAgIGlmIChrZXlOYW1lICYmIHRoaXMuX3Nob3VsZFRyaWdnZXIoa2V5TmFtZSwgJGUpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKGtleU5hbWUgKyAiS2V5ZWQiLCAkZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9vbklucHV0OiBmdW5jdGlvbiBvbklucHV0KCkgewogICAgICAgICAgICAgICAgdGhpcy5fY2hlY2tJbnB1dFZhbHVlKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9tYW5hZ2VQcmV2ZW50RGVmYXVsdDogZnVuY3Rpb24gbWFuYWdlUHJldmVudERlZmF1bHQoa2V5TmFtZSwgJGUpIHsKICAgICAgICAgICAgICAgIHZhciBwcmV2ZW50RGVmYXVsdCwgaGludFZhbHVlLCBpbnB1dFZhbHVlOwogICAgICAgICAgICAgICAgc3dpdGNoIChrZXlOYW1lKSB7CiAgICAgICAgICAgICAgICAgIGNhc2UgInRhYiI6CiAgICAgICAgICAgICAgICAgICAgaGludFZhbHVlID0gdGhpcy5nZXRIaW50KCk7CiAgICAgICAgICAgICAgICAgICAgaW5wdXRWYWx1ZSA9IHRoaXMuZ2V0SW5wdXRWYWx1ZSgpOwogICAgICAgICAgICAgICAgICAgIHByZXZlbnREZWZhdWx0ID0gaGludFZhbHVlICYmIGhpbnRWYWx1ZSAhPT0gaW5wdXRWYWx1ZSAmJiAhd2l0aE1vZGlmaWVyKCRlKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgIGNhc2UgInVwIjoKICAgICAgICAgICAgICAgICAgY2FzZSAiZG93biI6CiAgICAgICAgICAgICAgICAgICAgcHJldmVudERlZmF1bHQgPSAhd2l0aE1vZGlmaWVyKCRlKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgcHJldmVudERlZmF1bHQgPSBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHByZXZlbnREZWZhdWx0ICYmICRlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9zaG91bGRUcmlnZ2VyOiBmdW5jdGlvbiBzaG91bGRUcmlnZ2VyKGtleU5hbWUsICRlKSB7CiAgICAgICAgICAgICAgICB2YXIgdHJpZ2dlcjsKICAgICAgICAgICAgICAgIHN3aXRjaCAoa2V5TmFtZSkgewogICAgICAgICAgICAgICAgICBjYXNlICJ0YWIiOgogICAgICAgICAgICAgICAgICAgIHRyaWdnZXIgPSAhd2l0aE1vZGlmaWVyKCRlKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgdHJpZ2dlciA9IHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gdHJpZ2dlcjsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX2NoZWNrSW5wdXRWYWx1ZTogZnVuY3Rpb24gY2hlY2tJbnB1dFZhbHVlKCkgewogICAgICAgICAgICAgICAgdmFyIGlucHV0VmFsdWUsIGFyZUVxdWl2YWxlbnQsIGhhc0RpZmZlcmVudFdoaXRlc3BhY2U7CiAgICAgICAgICAgICAgICBpbnB1dFZhbHVlID0gdGhpcy5nZXRJbnB1dFZhbHVlKCk7CiAgICAgICAgICAgICAgICBhcmVFcXVpdmFsZW50ID0gYXJlUXVlcmllc0VxdWl2YWxlbnQoaW5wdXRWYWx1ZSwgdGhpcy5xdWVyeSk7CiAgICAgICAgICAgICAgICBoYXNEaWZmZXJlbnRXaGl0ZXNwYWNlID0gYXJlRXF1aXZhbGVudCA/IHRoaXMucXVlcnkubGVuZ3RoICE9PSBpbnB1dFZhbHVlLmxlbmd0aCA6IGZhbHNlOwogICAgICAgICAgICAgICAgdGhpcy5xdWVyeSA9IGlucHV0VmFsdWU7CiAgICAgICAgICAgICAgICBpZiAoIWFyZUVxdWl2YWxlbnQpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXIoInF1ZXJ5Q2hhbmdlZCIsIHRoaXMucXVlcnkpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChoYXNEaWZmZXJlbnRXaGl0ZXNwYWNlKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCJ3aGl0ZXNwYWNlQ2hhbmdlZCIsIHRoaXMucXVlcnkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBmb2N1czogZnVuY3Rpb24gZm9jdXMoKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRpbnB1dC5mb2N1cygpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBibHVyOiBmdW5jdGlvbiBibHVyKCkgewogICAgICAgICAgICAgICAgdGhpcy4kaW5wdXQuYmx1cigpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBnZXRRdWVyeTogZnVuY3Rpb24gZ2V0UXVlcnkoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5xdWVyeTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2V0UXVlcnk6IGZ1bmN0aW9uIHNldFF1ZXJ5KHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICB0aGlzLnF1ZXJ5ID0gcXVlcnk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGdldElucHV0VmFsdWU6IGZ1bmN0aW9uIGdldElucHV0VmFsdWUoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kaW5wdXQudmFsKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNldElucHV0VmFsdWU6IGZ1bmN0aW9uIHNldElucHV0VmFsdWUodmFsdWUsIHNpbGVudCkgewogICAgICAgICAgICAgICAgdGhpcy4kaW5wdXQudmFsKHZhbHVlKTsKICAgICAgICAgICAgICAgIHNpbGVudCA/IHRoaXMuY2xlYXJIaW50KCkgOiB0aGlzLl9jaGVja0lucHV0VmFsdWUoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgcmVzZXRJbnB1dFZhbHVlOiBmdW5jdGlvbiByZXNldElucHV0VmFsdWUoKSB7CiAgICAgICAgICAgICAgICB0aGlzLnNldElucHV0VmFsdWUodGhpcy5xdWVyeSwgdHJ1ZSk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGdldEhpbnQ6IGZ1bmN0aW9uIGdldEhpbnQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kaGludC52YWwoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2V0SGludDogZnVuY3Rpb24gc2V0SGludCh2YWx1ZSkgewogICAgICAgICAgICAgICAgdGhpcy4kaGludC52YWwodmFsdWUpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBjbGVhckhpbnQ6IGZ1bmN0aW9uIGNsZWFySGludCgpIHsKICAgICAgICAgICAgICAgIHRoaXMuc2V0SGludCgiIik7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNsZWFySGludElmSW52YWxpZDogZnVuY3Rpb24gY2xlYXJIaW50SWZJbnZhbGlkKCkgewogICAgICAgICAgICAgICAgdmFyIHZhbCwgaGludCwgdmFsSXNQcmVmaXhPZkhpbnQsIGlzVmFsaWQ7CiAgICAgICAgICAgICAgICB2YWwgPSB0aGlzLmdldElucHV0VmFsdWUoKTsKICAgICAgICAgICAgICAgIGhpbnQgPSB0aGlzLmdldEhpbnQoKTsKICAgICAgICAgICAgICAgIHZhbElzUHJlZml4T2ZIaW50ID0gdmFsICE9PSBoaW50ICYmIGhpbnQuaW5kZXhPZih2YWwpID09PSAwOwogICAgICAgICAgICAgICAgaXNWYWxpZCA9IHZhbCAhPT0gIiIgJiYgdmFsSXNQcmVmaXhPZkhpbnQgJiYgIXRoaXMuaGFzT3ZlcmZsb3coKTsKICAgICAgICAgICAgICAgICFpc1ZhbGlkICYmIHRoaXMuY2xlYXJIaW50KCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGdldExhbmd1YWdlRGlyZWN0aW9uOiBmdW5jdGlvbiBnZXRMYW5ndWFnZURpcmVjdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiAodGhpcy4kaW5wdXQuY3NzKCJkaXJlY3Rpb24iKSB8fCAibHRyIikudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgaGFzT3ZlcmZsb3c6IGZ1bmN0aW9uIGhhc092ZXJmbG93KCkgewogICAgICAgICAgICAgICAgdmFyIGNvbnN0cmFpbnQgPSB0aGlzLiRpbnB1dC53aWR0aCgpIC0gMjsKICAgICAgICAgICAgICAgIHRoaXMuJG92ZXJmbG93SGVscGVyLnRleHQodGhpcy5nZXRJbnB1dFZhbHVlKCkpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJG92ZXJmbG93SGVscGVyLndpZHRoKCkgPj0gY29uc3RyYWludDsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgaXNDdXJzb3JBdEVuZDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB2YXIgdmFsdWVMZW5ndGgsIHNlbGVjdGlvblN0YXJ0LCByYW5nZTsKICAgICAgICAgICAgICAgIHZhbHVlTGVuZ3RoID0gdGhpcy4kaW5wdXQudmFsKCkubGVuZ3RoOwogICAgICAgICAgICAgICAgc2VsZWN0aW9uU3RhcnQgPSB0aGlzLiRpbnB1dFswXS5zZWxlY3Rpb25TdGFydDsKICAgICAgICAgICAgICAgIGlmIChfLmlzTnVtYmVyKHNlbGVjdGlvblN0YXJ0KSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxlY3Rpb25TdGFydCA9PT0gdmFsdWVMZW5ndGg7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGRvY3VtZW50LnNlbGVjdGlvbikgewogICAgICAgICAgICAgICAgICAgIHJhbmdlID0gZG9jdW1lbnQuc2VsZWN0aW9uLmNyZWF0ZVJhbmdlKCk7CiAgICAgICAgICAgICAgICAgICAgcmFuZ2UubW92ZVN0YXJ0KCJjaGFyYWN0ZXIiLCAtdmFsdWVMZW5ndGgpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZUxlbmd0aCA9PT0gcmFuZ2UudGV4dC5sZW5ndGg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZGVzdHJveTogZnVuY3Rpb24gZGVzdHJveSgpIHsKICAgICAgICAgICAgICAgIHRoaXMuJGhpbnQub2ZmKCIudHQiKTsKICAgICAgICAgICAgICAgIHRoaXMuJGlucHV0Lm9mZigiLnR0Iik7CiAgICAgICAgICAgICAgICB0aGlzLiRoaW50ID0gdGhpcy4kaW5wdXQgPSB0aGlzLiRvdmVyZmxvd0hlbHBlciA9IG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICByZXR1cm4gSW5wdXQ7CiAgICAgICAgZnVuY3Rpb24gYnVpbGRPdmVyZmxvd0hlbHBlcigkaW5wdXQpIHsKICAgICAgICAgICAgcmV0dXJuICQoJzxwcmUgYXJpYS1oaWRkZW49InRydWUiPjwvcHJlPicpLmNzcyh7CiAgICAgICAgICAgICAgICBwb3NpdGlvbjogImFic29sdXRlIiwKICAgICAgICAgICAgICAgIHZpc2liaWxpdHk6ICJoaWRkZW4iLAogICAgICAgICAgICAgICAgd2hpdGVTcGFjZTogInByZSIsCiAgICAgICAgICAgICAgICBmb250RmFtaWx5OiAkaW5wdXQuY3NzKCJmb250LWZhbWlseSIpLAogICAgICAgICAgICAgICAgZm9udFNpemU6ICRpbnB1dC5jc3MoImZvbnQtc2l6ZSIpLAogICAgICAgICAgICAgICAgZm9udFN0eWxlOiAkaW5wdXQuY3NzKCJmb250LXN0eWxlIiksCiAgICAgICAgICAgICAgICBmb250VmFyaWFudDogJGlucHV0LmNzcygiZm9udC12YXJpYW50IiksCiAgICAgICAgICAgICAgICBmb250V2VpZ2h0OiAkaW5wdXQuY3NzKCJmb250LXdlaWdodCIpLAogICAgICAgICAgICAgICAgd29yZFNwYWNpbmc6ICRpbnB1dC5jc3MoIndvcmQtc3BhY2luZyIpLAogICAgICAgICAgICAgICAgbGV0dGVyU3BhY2luZzogJGlucHV0LmNzcygibGV0dGVyLXNwYWNpbmciKSwKICAgICAgICAgICAgICAgIHRleHRJbmRlbnQ6ICRpbnB1dC5jc3MoInRleHQtaW5kZW50IiksCiAgICAgICAgICAgICAgICB0ZXh0UmVuZGVyaW5nOiAkaW5wdXQuY3NzKCJ0ZXh0LXJlbmRlcmluZyIpLAogICAgICAgICAgICAgICAgdGV4dFRyYW5zZm9ybTogJGlucHV0LmNzcygidGV4dC10cmFuc2Zvcm0iKQogICAgICAgICAgICB9KS5pbnNlcnRBZnRlcigkaW5wdXQpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBhcmVRdWVyaWVzRXF1aXZhbGVudChhLCBiKSB7CiAgICAgICAgICAgIHJldHVybiBJbnB1dC5ub3JtYWxpemVRdWVyeShhKSA9PT0gSW5wdXQubm9ybWFsaXplUXVlcnkoYik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHdpdGhNb2RpZmllcigkZSkgewogICAgICAgICAgICByZXR1cm4gJGUuYWx0S2V5IHx8ICRlLmN0cmxLZXkgfHwgJGUubWV0YUtleSB8fCAkZS5zaGlmdEtleTsKICAgICAgICB9CiAgICB9KCk7CiAgICB2YXIgRGF0YXNldCA9IGZ1bmN0aW9uKCkgewogICAgICAgIAogICAgICAgIHZhciBkYXRhc2V0S2V5ID0gInR0RGF0YXNldCIsIHZhbHVlS2V5ID0gInR0VmFsdWUiLCBkYXR1bUtleSA9ICJ0dERhdHVtIjsKICAgICAgICBmdW5jdGlvbiBEYXRhc2V0KG8pIHsKICAgICAgICAgICAgbyA9IG8gfHwge307CiAgICAgICAgICAgIG8udGVtcGxhdGVzID0gby50ZW1wbGF0ZXMgfHwge307CiAgICAgICAgICAgIGlmICghby5zb3VyY2UpIHsKICAgICAgICAgICAgICAgICQuZXJyb3IoIm1pc3Npbmcgc291cmNlIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG8ubmFtZSAmJiAhaXNWYWxpZE5hbWUoby5uYW1lKSkgewogICAgICAgICAgICAgICAgJC5lcnJvcigiaW52YWxpZCBkYXRhc2V0IG5hbWU6ICIgKyBvLm5hbWUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMucXVlcnkgPSBudWxsOwogICAgICAgICAgICB0aGlzLmhpZ2hsaWdodCA9ICEhby5oaWdobGlnaHQ7CiAgICAgICAgICAgIHRoaXMubmFtZSA9IG8ubmFtZSB8fCBfLmdldFVuaXF1ZUlkKCk7CiAgICAgICAgICAgIHRoaXMuc291cmNlID0gby5zb3VyY2U7CiAgICAgICAgICAgIHRoaXMuZGlzcGxheUZuID0gZ2V0RGlzcGxheUZuKG8uZGlzcGxheSB8fCBvLmRpc3BsYXlLZXkpOwogICAgICAgICAgICB0aGlzLnRlbXBsYXRlcyA9IGdldFRlbXBsYXRlcyhvLnRlbXBsYXRlcywgdGhpcy5kaXNwbGF5Rm4pOwogICAgICAgICAgICB0aGlzLiRlbCA9ICQoaHRtbC5kYXRhc2V0LnJlcGxhY2UoIiVDTEFTUyUiLCB0aGlzLm5hbWUpKTsKICAgICAgICB9CiAgICAgICAgRGF0YXNldC5leHRyYWN0RGF0YXNldE5hbWUgPSBmdW5jdGlvbiBleHRyYWN0RGF0YXNldE5hbWUoZWwpIHsKICAgICAgICAgICAgcmV0dXJuICQoZWwpLmRhdGEoZGF0YXNldEtleSk7CiAgICAgICAgfTsKICAgICAgICBEYXRhc2V0LmV4dHJhY3RWYWx1ZSA9IGZ1bmN0aW9uIGV4dHJhY3REYXR1bShlbCkgewogICAgICAgICAgICByZXR1cm4gJChlbCkuZGF0YSh2YWx1ZUtleSk7CiAgICAgICAgfTsKICAgICAgICBEYXRhc2V0LmV4dHJhY3REYXR1bSA9IGZ1bmN0aW9uIGV4dHJhY3REYXR1bShlbCkgewogICAgICAgICAgICByZXR1cm4gJChlbCkuZGF0YShkYXR1bUtleSk7CiAgICAgICAgfTsKICAgICAgICBfLm1peGluKERhdGFzZXQucHJvdG90eXBlLCBFdmVudEVtaXR0ZXIsIHsKICAgICAgICAgICAgX3JlbmRlcjogZnVuY3Rpb24gcmVuZGVyKHF1ZXJ5LCBzdWdnZXN0aW9ucykgewogICAgICAgICAgICAgICAgaWYgKCF0aGlzLiRlbCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgaGFzU3VnZ2VzdGlvbnM7CiAgICAgICAgICAgICAgICB0aGlzLiRlbC5lbXB0eSgpOwogICAgICAgICAgICAgICAgaGFzU3VnZ2VzdGlvbnMgPSBzdWdnZXN0aW9ucyAmJiBzdWdnZXN0aW9ucy5sZW5ndGg7CiAgICAgICAgICAgICAgICBpZiAoIWhhc1N1Z2dlc3Rpb25zICYmIHRoaXMudGVtcGxhdGVzLmVtcHR5KSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kZWwuaHRtbChnZXRFbXB0eUh0bWwoKSkucHJlcGVuZCh0aGF0LnRlbXBsYXRlcy5oZWFkZXIgPyBnZXRIZWFkZXJIdG1sKCkgOiBudWxsKS5hcHBlbmQodGhhdC50ZW1wbGF0ZXMuZm9vdGVyID8gZ2V0Rm9vdGVySHRtbCgpIDogbnVsbCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGhhc1N1Z2dlc3Rpb25zKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kZWwuaHRtbChnZXRTdWdnZXN0aW9uc0h0bWwoKSkucHJlcGVuZCh0aGF0LnRlbXBsYXRlcy5oZWFkZXIgPyBnZXRIZWFkZXJIdG1sKCkgOiBudWxsKS5hcHBlbmQodGhhdC50ZW1wbGF0ZXMuZm9vdGVyID8gZ2V0Rm9vdGVySHRtbCgpIDogbnVsbCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXIoInJlbmRlcmVkIik7CiAgICAgICAgICAgICAgICBmdW5jdGlvbiBnZXRFbXB0eUh0bWwoKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoYXQudGVtcGxhdGVzLmVtcHR5KHsKICAgICAgICAgICAgICAgICAgICAgICAgcXVlcnk6IHF1ZXJ5LAogICAgICAgICAgICAgICAgICAgICAgICBpc0VtcHR5OiB0cnVlCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBmdW5jdGlvbiBnZXRTdWdnZXN0aW9uc0h0bWwoKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyICRzdWdnZXN0aW9ucywgbm9kZXM7CiAgICAgICAgICAgICAgICAgICAgJHN1Z2dlc3Rpb25zID0gJChodG1sLnN1Z2dlc3Rpb25zKS5jc3MoY3NzLnN1Z2dlc3Rpb25zKTsKICAgICAgICAgICAgICAgICAgICBub2RlcyA9IF8ubWFwKHN1Z2dlc3Rpb25zLCBnZXRTdWdnZXN0aW9uTm9kZSk7CiAgICAgICAgICAgICAgICAgICAgJHN1Z2dlc3Rpb25zLmFwcGVuZC5hcHBseSgkc3VnZ2VzdGlvbnMsIG5vZGVzKTsKICAgICAgICAgICAgICAgICAgICB0aGF0LmhpZ2hsaWdodCAmJiBoaWdobGlnaHQoewogICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICJ0dC1oaWdobGlnaHQiLAogICAgICAgICAgICAgICAgICAgICAgICBub2RlOiAkc3VnZ2VzdGlvbnNbMF0sCiAgICAgICAgICAgICAgICAgICAgICAgIHBhdHRlcm46IHF1ZXJ5CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRzdWdnZXN0aW9uczsKICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiBnZXRTdWdnZXN0aW9uTm9kZShzdWdnZXN0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciAkZWw7CiAgICAgICAgICAgICAgICAgICAgICAgICRlbCA9ICQoaHRtbC5zdWdnZXN0aW9uKS5hcHBlbmQodGhhdC50ZW1wbGF0ZXMuc3VnZ2VzdGlvbihzdWdnZXN0aW9uKSkuZGF0YShkYXRhc2V0S2V5LCB0aGF0Lm5hbWUpLmRhdGEodmFsdWVLZXksIHRoYXQuZGlzcGxheUZuKHN1Z2dlc3Rpb24pKS5kYXRhKGRhdHVtS2V5LCBzdWdnZXN0aW9uKTsKICAgICAgICAgICAgICAgICAgICAgICAgJGVsLmNoaWxkcmVuKCkuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykuY3NzKGNzcy5zdWdnZXN0aW9uQ2hpbGQpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRlbDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBmdW5jdGlvbiBnZXRIZWFkZXJIdG1sKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGF0LnRlbXBsYXRlcy5oZWFkZXIoewogICAgICAgICAgICAgICAgICAgICAgICBxdWVyeTogcXVlcnksCiAgICAgICAgICAgICAgICAgICAgICAgIGlzRW1wdHk6ICFoYXNTdWdnZXN0aW9ucwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZnVuY3Rpb24gZ2V0Rm9vdGVySHRtbCgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhhdC50ZW1wbGF0ZXMuZm9vdGVyKHsKICAgICAgICAgICAgICAgICAgICAgICAgcXVlcnk6IHF1ZXJ5LAogICAgICAgICAgICAgICAgICAgICAgICBpc0VtcHR5OiAhaGFzU3VnZ2VzdGlvbnMKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgZ2V0Um9vdDogZnVuY3Rpb24gZ2V0Um9vdCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiRlbDsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgdXBkYXRlOiBmdW5jdGlvbiB1cGRhdGUocXVlcnkpIHsKICAgICAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpczsKICAgICAgICAgICAgICAgIHRoaXMucXVlcnkgPSBxdWVyeTsKICAgICAgICAgICAgICAgIHRoaXMuY2FuY2VsZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHRoaXMuc291cmNlKHF1ZXJ5LCByZW5kZXIpOwogICAgICAgICAgICAgICAgZnVuY3Rpb24gcmVuZGVyKHN1Z2dlc3Rpb25zKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGF0LmNhbmNlbGVkICYmIHF1ZXJ5ID09PSB0aGF0LnF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuX3JlbmRlcihxdWVyeSwgc3VnZ2VzdGlvbnMpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgY2FuY2VsOiBmdW5jdGlvbiBjYW5jZWwoKSB7CiAgICAgICAgICAgICAgICB0aGlzLmNhbmNlbGVkID0gdHJ1ZTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgY2xlYXI6IGZ1bmN0aW9uIGNsZWFyKCkgewogICAgICAgICAgICAgICAgdGhpcy5jYW5jZWwoKTsKICAgICAgICAgICAgICAgIHRoaXMuJGVsLmVtcHR5KCk7CiAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXIoInJlbmRlcmVkIik7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGlzRW1wdHk6IGZ1bmN0aW9uIGlzRW1wdHkoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kZWwuaXMoIjplbXB0eSIpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBkZXN0cm95OiBmdW5jdGlvbiBkZXN0cm95KCkgewogICAgICAgICAgICAgICAgdGhpcy4kZWwgPSBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIERhdGFzZXQ7CiAgICAgICAgZnVuY3Rpb24gZ2V0RGlzcGxheUZuKGRpc3BsYXkpIHsKICAgICAgICAgICAgZGlzcGxheSA9IGRpc3BsYXkgfHwgInZhbHVlIjsKICAgICAgICAgICAgcmV0dXJuIF8uaXNGdW5jdGlvbihkaXNwbGF5KSA/IGRpc3BsYXkgOiBkaXNwbGF5Rm47CiAgICAgICAgICAgIGZ1bmN0aW9uIGRpc3BsYXlGbihvYmopIHsKICAgICAgICAgICAgICAgIHJldHVybiBvYmpbZGlzcGxheV07CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gZ2V0VGVtcGxhdGVzKHRlbXBsYXRlcywgZGlzcGxheUZuKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBlbXB0eTogdGVtcGxhdGVzLmVtcHR5ICYmIF8udGVtcGxhdGlmeSh0ZW1wbGF0ZXMuZW1wdHkpLAogICAgICAgICAgICAgICAgaGVhZGVyOiB0ZW1wbGF0ZXMuaGVhZGVyICYmIF8udGVtcGxhdGlmeSh0ZW1wbGF0ZXMuaGVhZGVyKSwKICAgICAgICAgICAgICAgIGZvb3RlcjogdGVtcGxhdGVzLmZvb3RlciAmJiBfLnRlbXBsYXRpZnkodGVtcGxhdGVzLmZvb3RlciksCiAgICAgICAgICAgICAgICBzdWdnZXN0aW9uOiB0ZW1wbGF0ZXMuc3VnZ2VzdGlvbiB8fCBzdWdnZXN0aW9uVGVtcGxhdGUKICAgICAgICAgICAgfTsKICAgICAgICAgICAgZnVuY3Rpb24gc3VnZ2VzdGlvblRlbXBsYXRlKGNvbnRleHQpIHsKICAgICAgICAgICAgICAgIHJldHVybiAiPHA+IiArIGRpc3BsYXlGbihjb250ZXh0KSArICI8L3A+IjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBpc1ZhbGlkTmFtZShzdHIpIHsKICAgICAgICAgICAgcmV0dXJuIC9eW19hLXpBLVowLTktXSskLy50ZXN0KHN0cik7CiAgICAgICAgfQogICAgfSgpOwogICAgdmFyIERyb3Bkb3duID0gZnVuY3Rpb24oKSB7CiAgICAgICAgCiAgICAgICAgZnVuY3Rpb24gRHJvcGRvd24obykgewogICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIG9uU3VnZ2VzdGlvbkNsaWNrLCBvblN1Z2dlc3Rpb25Nb3VzZUVudGVyLCBvblN1Z2dlc3Rpb25Nb3VzZUxlYXZlOwogICAgICAgICAgICBvID0gbyB8fCB7fTsKICAgICAgICAgICAgaWYgKCFvLm1lbnUpIHsKICAgICAgICAgICAgICAgICQuZXJyb3IoIm1lbnUgaXMgcmVxdWlyZWQiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLmlzT3BlbiA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLmlzRW1wdHkgPSB0cnVlOwogICAgICAgICAgICB0aGlzLmRhdGFzZXRzID0gXy5tYXAoby5kYXRhc2V0cywgaW5pdGlhbGl6ZURhdGFzZXQpOwogICAgICAgICAgICBvblN1Z2dlc3Rpb25DbGljayA9IF8uYmluZCh0aGlzLl9vblN1Z2dlc3Rpb25DbGljaywgdGhpcyk7CiAgICAgICAgICAgIG9uU3VnZ2VzdGlvbk1vdXNlRW50ZXIgPSBfLmJpbmQodGhpcy5fb25TdWdnZXN0aW9uTW91c2VFbnRlciwgdGhpcyk7CiAgICAgICAgICAgIG9uU3VnZ2VzdGlvbk1vdXNlTGVhdmUgPSBfLmJpbmQodGhpcy5fb25TdWdnZXN0aW9uTW91c2VMZWF2ZSwgdGhpcyk7CiAgICAgICAgICAgIHRoaXMuJG1lbnUgPSAkKG8ubWVudSkub24oImNsaWNrLnR0IiwgIi50dC1zdWdnZXN0aW9uIiwgb25TdWdnZXN0aW9uQ2xpY2spLm9uKCJtb3VzZWVudGVyLnR0IiwgIi50dC1zdWdnZXN0aW9uIiwgb25TdWdnZXN0aW9uTW91c2VFbnRlcikub24oIm1vdXNlbGVhdmUudHQiLCAiLnR0LXN1Z2dlc3Rpb24iLCBvblN1Z2dlc3Rpb25Nb3VzZUxlYXZlKTsKICAgICAgICAgICAgXy5lYWNoKHRoaXMuZGF0YXNldHMsIGZ1bmN0aW9uKGRhdGFzZXQpIHsKICAgICAgICAgICAgICAgIHRoYXQuJG1lbnUuYXBwZW5kKGRhdGFzZXQuZ2V0Um9vdCgpKTsKICAgICAgICAgICAgICAgIGRhdGFzZXQub25TeW5jKCJyZW5kZXJlZCIsIHRoYXQuX29uUmVuZGVyZWQsIHRoYXQpOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgXy5taXhpbihEcm9wZG93bi5wcm90b3R5cGUsIEV2ZW50RW1pdHRlciwgewogICAgICAgICAgICBfb25TdWdnZXN0aW9uQ2xpY2s6IGZ1bmN0aW9uIG9uU3VnZ2VzdGlvbkNsaWNrKCRlKSB7CiAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXIoInN1Z2dlc3Rpb25DbGlja2VkIiwgJCgkZS5jdXJyZW50VGFyZ2V0KSk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9vblN1Z2dlc3Rpb25Nb3VzZUVudGVyOiBmdW5jdGlvbiBvblN1Z2dlc3Rpb25Nb3VzZUVudGVyKCRlKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9yZW1vdmVDdXJzb3IoKTsKICAgICAgICAgICAgICAgIHRoaXMuX3NldEN1cnNvcigkKCRlLmN1cnJlbnRUYXJnZXQpLCB0cnVlKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX29uU3VnZ2VzdGlvbk1vdXNlTGVhdmU6IGZ1bmN0aW9uIG9uU3VnZ2VzdGlvbk1vdXNlTGVhdmUoKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9yZW1vdmVDdXJzb3IoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX29uUmVuZGVyZWQ6IGZ1bmN0aW9uIG9uUmVuZGVyZWQoKSB7CiAgICAgICAgICAgICAgICB0aGlzLmlzRW1wdHkgPSBfLmV2ZXJ5KHRoaXMuZGF0YXNldHMsIGlzRGF0YXNldEVtcHR5KTsKICAgICAgICAgICAgICAgIHRoaXMuaXNFbXB0eSA/IHRoaXMuX2hpZGUoKSA6IHRoaXMuaXNPcGVuICYmIHRoaXMuX3Nob3coKTsKICAgICAgICAgICAgICAgIHRoaXMudHJpZ2dlcigiZGF0YXNldFJlbmRlcmVkIik7CiAgICAgICAgICAgICAgICBmdW5jdGlvbiBpc0RhdGFzZXRFbXB0eShkYXRhc2V0KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFzZXQuaXNFbXB0eSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBfaGlkZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRtZW51LmhpZGUoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX3Nob3c6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdGhpcy4kbWVudS5jc3MoImRpc3BsYXkiLCAiYmxvY2siKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX2dldFN1Z2dlc3Rpb25zOiBmdW5jdGlvbiBnZXRTdWdnZXN0aW9ucygpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiRtZW51LmZpbmQoIi50dC1zdWdnZXN0aW9uIik7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9nZXRDdXJzb3I6IGZ1bmN0aW9uIGdldEN1cnNvcigpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiRtZW51LmZpbmQoIi50dC1jdXJzb3IiKS5maXJzdCgpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfc2V0Q3Vyc29yOiBmdW5jdGlvbiBzZXRDdXJzb3IoJGVsLCBzaWxlbnQpIHsKICAgICAgICAgICAgICAgICRlbC5maXJzdCgpLmFkZENsYXNzKCJ0dC1jdXJzb3IiKTsKICAgICAgICAgICAgICAgICFzaWxlbnQgJiYgdGhpcy50cmlnZ2VyKCJjdXJzb3JNb3ZlZCIpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfcmVtb3ZlQ3Vyc29yOiBmdW5jdGlvbiByZW1vdmVDdXJzb3IoKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9nZXRDdXJzb3IoKS5yZW1vdmVDbGFzcygidHQtY3Vyc29yIik7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9tb3ZlQ3Vyc29yOiBmdW5jdGlvbiBtb3ZlQ3Vyc29yKGluY3JlbWVudCkgewogICAgICAgICAgICAgICAgdmFyICRzdWdnZXN0aW9ucywgJG9sZEN1cnNvciwgbmV3Q3Vyc29ySW5kZXgsICRuZXdDdXJzb3I7CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuaXNPcGVuKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJG9sZEN1cnNvciA9IHRoaXMuX2dldEN1cnNvcigpOwogICAgICAgICAgICAgICAgJHN1Z2dlc3Rpb25zID0gdGhpcy5fZ2V0U3VnZ2VzdGlvbnMoKTsKICAgICAgICAgICAgICAgIHRoaXMuX3JlbW92ZUN1cnNvcigpOwogICAgICAgICAgICAgICAgbmV3Q3Vyc29ySW5kZXggPSAkc3VnZ2VzdGlvbnMuaW5kZXgoJG9sZEN1cnNvcikgKyBpbmNyZW1lbnQ7CiAgICAgICAgICAgICAgICBuZXdDdXJzb3JJbmRleCA9IChuZXdDdXJzb3JJbmRleCArIDEpICUgKCRzdWdnZXN0aW9ucy5sZW5ndGggKyAxKSAtIDE7CiAgICAgICAgICAgICAgICBpZiAobmV3Q3Vyc29ySW5kZXggPT09IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCJjdXJzb3JSZW1vdmVkIik7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChuZXdDdXJzb3JJbmRleCA8IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgbmV3Q3Vyc29ySW5kZXggPSAkc3VnZ2VzdGlvbnMubGVuZ3RoIC0gMTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuX3NldEN1cnNvcigkbmV3Q3Vyc29yID0gJHN1Z2dlc3Rpb25zLmVxKG5ld0N1cnNvckluZGV4KSk7CiAgICAgICAgICAgICAgICB0aGlzLl9lbnN1cmVWaXNpYmxlKCRuZXdDdXJzb3IpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfZW5zdXJlVmlzaWJsZTogZnVuY3Rpb24gZW5zdXJlVmlzaWJsZSgkZWwpIHsKICAgICAgICAgICAgICAgIHZhciBlbFRvcCwgZWxCb3R0b20sIG1lbnVTY3JvbGxUb3AsIG1lbnVIZWlnaHQ7CiAgICAgICAgICAgICAgICBlbFRvcCA9ICRlbC5wb3NpdGlvbigpLnRvcDsKICAgICAgICAgICAgICAgIGVsQm90dG9tID0gZWxUb3AgKyAkZWwub3V0ZXJIZWlnaHQodHJ1ZSk7CiAgICAgICAgICAgICAgICBtZW51U2Nyb2xsVG9wID0gdGhpcy4kbWVudS5zY3JvbGxUb3AoKTsKICAgICAgICAgICAgICAgIG1lbnVIZWlnaHQgPSB0aGlzLiRtZW51LmhlaWdodCgpICsgcGFyc2VJbnQodGhpcy4kbWVudS5jc3MoInBhZGRpbmdUb3AiKSwgMTApICsgcGFyc2VJbnQodGhpcy4kbWVudS5jc3MoInBhZGRpbmdCb3R0b20iKSwgMTApOwogICAgICAgICAgICAgICAgaWYgKGVsVG9wIDwgMCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuJG1lbnUuc2Nyb2xsVG9wKG1lbnVTY3JvbGxUb3AgKyBlbFRvcCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG1lbnVIZWlnaHQgPCBlbEJvdHRvbSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuJG1lbnUuc2Nyb2xsVG9wKG1lbnVTY3JvbGxUb3AgKyAoZWxCb3R0b20gLSBtZW51SGVpZ2h0KSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNsb3NlOiBmdW5jdGlvbiBjbG9zZSgpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzT3BlbikgewogICAgICAgICAgICAgICAgICAgIHRoaXMuaXNPcGVuID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVtb3ZlQ3Vyc29yKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5faGlkZSgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMudHJpZ2dlcigiY2xvc2VkIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG9wZW46IGZ1bmN0aW9uIG9wZW4oKSB7CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuaXNPcGVuKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5pc09wZW4gPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICF0aGlzLmlzRW1wdHkgJiYgdGhpcy5fc2hvdygpOwogICAgICAgICAgICAgICAgICAgIHRoaXMudHJpZ2dlcigib3BlbmVkIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNldExhbmd1YWdlRGlyZWN0aW9uOiBmdW5jdGlvbiBzZXRMYW5ndWFnZURpcmVjdGlvbihkaXIpIHsKICAgICAgICAgICAgICAgIHRoaXMuJG1lbnUuY3NzKGRpciA9PT0gImx0ciIgPyBjc3MubHRyIDogY3NzLnJ0bCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG1vdmVDdXJzb3JVcDogZnVuY3Rpb24gbW92ZUN1cnNvclVwKCkgewogICAgICAgICAgICAgICAgdGhpcy5fbW92ZUN1cnNvcigtMSk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG1vdmVDdXJzb3JEb3duOiBmdW5jdGlvbiBtb3ZlQ3Vyc29yRG93bigpIHsKICAgICAgICAgICAgICAgIHRoaXMuX21vdmVDdXJzb3IoKzEpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBnZXREYXR1bUZvclN1Z2dlc3Rpb246IGZ1bmN0aW9uIGdldERhdHVtRm9yU3VnZ2VzdGlvbigkZWwpIHsKICAgICAgICAgICAgICAgIHZhciBkYXR1bSA9IG51bGw7CiAgICAgICAgICAgICAgICBpZiAoJGVsLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgIGRhdHVtID0gewogICAgICAgICAgICAgICAgICAgICAgICByYXc6IERhdGFzZXQuZXh0cmFjdERhdHVtKCRlbCksCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBEYXRhc2V0LmV4dHJhY3RWYWx1ZSgkZWwpLAogICAgICAgICAgICAgICAgICAgICAgICBkYXRhc2V0TmFtZTogRGF0YXNldC5leHRyYWN0RGF0YXNldE5hbWUoJGVsKQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gZGF0dW07CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGdldERhdHVtRm9yQ3Vyc29yOiBmdW5jdGlvbiBnZXREYXR1bUZvckN1cnNvcigpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldERhdHVtRm9yU3VnZ2VzdGlvbih0aGlzLl9nZXRDdXJzb3IoKS5maXJzdCgpKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZ2V0RGF0dW1Gb3JUb3BTdWdnZXN0aW9uOiBmdW5jdGlvbiBnZXREYXR1bUZvclRvcFN1Z2dlc3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXREYXR1bUZvclN1Z2dlc3Rpb24odGhpcy5fZ2V0U3VnZ2VzdGlvbnMoKS5maXJzdCgpKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgdXBkYXRlOiBmdW5jdGlvbiB1cGRhdGUocXVlcnkpIHsKICAgICAgICAgICAgICAgIF8uZWFjaCh0aGlzLmRhdGFzZXRzLCB1cGRhdGVEYXRhc2V0KTsKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHVwZGF0ZURhdGFzZXQoZGF0YXNldCkgewogICAgICAgICAgICAgICAgICAgIGRhdGFzZXQudXBkYXRlKHF1ZXJ5KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgZW1wdHk6IGZ1bmN0aW9uIGVtcHR5KCkgewogICAgICAgICAgICAgICAgXy5lYWNoKHRoaXMuZGF0YXNldHMsIGNsZWFyRGF0YXNldCk7CiAgICAgICAgICAgICAgICB0aGlzLmlzRW1wdHkgPSB0cnVlOwogICAgICAgICAgICAgICAgZnVuY3Rpb24gY2xlYXJEYXRhc2V0KGRhdGFzZXQpIHsKICAgICAgICAgICAgICAgICAgICBkYXRhc2V0LmNsZWFyKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGlzVmlzaWJsZTogZnVuY3Rpb24gaXNWaXNpYmxlKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaXNPcGVuICYmICF0aGlzLmlzRW1wdHk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uIGRlc3Ryb3koKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRtZW51Lm9mZigiLnR0Iik7CiAgICAgICAgICAgICAgICB0aGlzLiRtZW51ID0gbnVsbDsKICAgICAgICAgICAgICAgIF8uZWFjaCh0aGlzLmRhdGFzZXRzLCBkZXN0cm95RGF0YXNldCk7CiAgICAgICAgICAgICAgICBmdW5jdGlvbiBkZXN0cm95RGF0YXNldChkYXRhc2V0KSB7CiAgICAgICAgICAgICAgICAgICAgZGF0YXNldC5kZXN0cm95KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICByZXR1cm4gRHJvcGRvd247CiAgICAgICAgZnVuY3Rpb24gaW5pdGlhbGl6ZURhdGFzZXQob0RhdGFzZXQpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBEYXRhc2V0KG9EYXRhc2V0KTsKICAgICAgICB9CiAgICB9KCk7CiAgICB2YXIgVHlwZWFoZWFkID0gZnVuY3Rpb24oKSB7CiAgICAgICAgCiAgICAgICAgdmFyIGF0dHJzS2V5ID0gInR0QXR0cnMiOwogICAgICAgIGZ1bmN0aW9uIFR5cGVhaGVhZChvKSB7CiAgICAgICAgICAgIHZhciAkbWVudSwgJGlucHV0LCAkaGludDsKICAgICAgICAgICAgbyA9IG8gfHwge307CiAgICAgICAgICAgIGlmICghby5pbnB1dCkgewogICAgICAgICAgICAgICAgJC5lcnJvcigibWlzc2luZyBpbnB1dCIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuaXNBY3RpdmF0ZWQgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5hdXRvc2VsZWN0ID0gISFvLmF1dG9zZWxlY3Q7CiAgICAgICAgICAgIHRoaXMubWluTGVuZ3RoID0gXy5pc051bWJlcihvLm1pbkxlbmd0aCkgPyBvLm1pbkxlbmd0aCA6IDE7CiAgICAgICAgICAgIHRoaXMuJG5vZGUgPSBidWlsZERvbShvLmlucHV0LCBvLndpdGhIaW50KTsKICAgICAgICAgICAgJG1lbnUgPSB0aGlzLiRub2RlLmZpbmQoIi50dC1kcm9wZG93bi1tZW51Iik7CiAgICAgICAgICAgICRpbnB1dCA9IHRoaXMuJG5vZGUuZmluZCgiLnR0LWlucHV0Iik7CiAgICAgICAgICAgICRoaW50ID0gdGhpcy4kbm9kZS5maW5kKCIudHQtaGludCIpOwogICAgICAgICAgICAkaW5wdXQub24oImJsdXIudHQiLCBmdW5jdGlvbigkZSkgewogICAgICAgICAgICAgICAgdmFyIGFjdGl2ZSwgaXNBY3RpdmUsIGhhc0FjdGl2ZTsKICAgICAgICAgICAgICAgIGFjdGl2ZSA9IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQ7CiAgICAgICAgICAgICAgICBpc0FjdGl2ZSA9ICRtZW51LmlzKGFjdGl2ZSk7CiAgICAgICAgICAgICAgICBoYXNBY3RpdmUgPSAkbWVudS5oYXMoYWN0aXZlKS5sZW5ndGggPiAwOwogICAgICAgICAgICAgICAgaWYgKF8uaXNNc2llKCkgJiYgKGlzQWN0aXZlIHx8IGhhc0FjdGl2ZSkpIHsKICAgICAgICAgICAgICAgICAgICAkZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgICAgICRlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpOwogICAgICAgICAgICAgICAgICAgIF8uZGVmZXIoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRpbnB1dC5mb2N1cygpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgJG1lbnUub24oIm1vdXNlZG93bi50dCIsIGZ1bmN0aW9uKCRlKSB7CiAgICAgICAgICAgICAgICAkZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGhpcy5ldmVudEJ1cyA9IG8uZXZlbnRCdXMgfHwgbmV3IEV2ZW50QnVzKHsKICAgICAgICAgICAgICAgIGVsOiAkaW5wdXQKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRoaXMuZHJvcGRvd24gPSBuZXcgRHJvcGRvd24oewogICAgICAgICAgICAgICAgbWVudTogJG1lbnUsCiAgICAgICAgICAgICAgICBkYXRhc2V0czogby5kYXRhc2V0cwogICAgICAgICAgICB9KS5vblN5bmMoInN1Z2dlc3Rpb25DbGlja2VkIiwgdGhpcy5fb25TdWdnZXN0aW9uQ2xpY2tlZCwgdGhpcykub25TeW5jKCJjdXJzb3JNb3ZlZCIsIHRoaXMuX29uQ3Vyc29yTW92ZWQsIHRoaXMpLm9uU3luYygiY3Vyc29yUmVtb3ZlZCIsIHRoaXMuX29uQ3Vyc29yUmVtb3ZlZCwgdGhpcykub25TeW5jKCJvcGVuZWQiLCB0aGlzLl9vbk9wZW5lZCwgdGhpcykub25TeW5jKCJjbG9zZWQiLCB0aGlzLl9vbkNsb3NlZCwgdGhpcykub25Bc3luYygiZGF0YXNldFJlbmRlcmVkIiwgdGhpcy5fb25EYXRhc2V0UmVuZGVyZWQsIHRoaXMpOwogICAgICAgICAgICB0aGlzLmlucHV0ID0gbmV3IElucHV0KHsKICAgICAgICAgICAgICAgIGlucHV0OiAkaW5wdXQsCiAgICAgICAgICAgICAgICBoaW50OiAkaGludAogICAgICAgICAgICB9KS5vblN5bmMoImZvY3VzZWQiLCB0aGlzLl9vbkZvY3VzZWQsIHRoaXMpLm9uU3luYygiYmx1cnJlZCIsIHRoaXMuX29uQmx1cnJlZCwgdGhpcykub25TeW5jKCJlbnRlcktleWVkIiwgdGhpcy5fb25FbnRlcktleWVkLCB0aGlzKS5vblN5bmMoInRhYktleWVkIiwgdGhpcy5fb25UYWJLZXllZCwgdGhpcykub25TeW5jKCJlc2NLZXllZCIsIHRoaXMuX29uRXNjS2V5ZWQsIHRoaXMpLm9uU3luYygidXBLZXllZCIsIHRoaXMuX29uVXBLZXllZCwgdGhpcykub25TeW5jKCJkb3duS2V5ZWQiLCB0aGlzLl9vbkRvd25LZXllZCwgdGhpcykub25TeW5jKCJsZWZ0S2V5ZWQiLCB0aGlzLl9vbkxlZnRLZXllZCwgdGhpcykub25TeW5jKCJyaWdodEtleWVkIiwgdGhpcy5fb25SaWdodEtleWVkLCB0aGlzKS5vblN5bmMoInF1ZXJ5Q2hhbmdlZCIsIHRoaXMuX29uUXVlcnlDaGFuZ2VkLCB0aGlzKS5vblN5bmMoIndoaXRlc3BhY2VDaGFuZ2VkIiwgdGhpcy5fb25XaGl0ZXNwYWNlQ2hhbmdlZCwgdGhpcyk7CiAgICAgICAgICAgIHRoaXMuX3NldExhbmd1YWdlRGlyZWN0aW9uKCk7CiAgICAgICAgfQogICAgICAgIF8ubWl4aW4oVHlwZWFoZWFkLnByb3RvdHlwZSwgewogICAgICAgICAgICBfb25TdWdnZXN0aW9uQ2xpY2tlZDogZnVuY3Rpb24gb25TdWdnZXN0aW9uQ2xpY2tlZCh0eXBlLCAkZWwpIHsKICAgICAgICAgICAgICAgIHZhciBkYXR1bTsKICAgICAgICAgICAgICAgIGlmIChkYXR1bSA9IHRoaXMuZHJvcGRvd24uZ2V0RGF0dW1Gb3JTdWdnZXN0aW9uKCRlbCkpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9zZWxlY3QoZGF0dW0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBfb25DdXJzb3JNb3ZlZDogZnVuY3Rpb24gb25DdXJzb3JNb3ZlZCgpIHsKICAgICAgICAgICAgICAgIHZhciBkYXR1bSA9IHRoaXMuZHJvcGRvd24uZ2V0RGF0dW1Gb3JDdXJzb3IoKTsKICAgICAgICAgICAgICAgIHRoaXMuaW5wdXQuc2V0SW5wdXRWYWx1ZShkYXR1bS52YWx1ZSwgdHJ1ZSk7CiAgICAgICAgICAgICAgICB0aGlzLmV2ZW50QnVzLnRyaWdnZXIoImN1cnNvcmNoYW5nZWQiLCBkYXR1bS5yYXcsIGRhdHVtLmRhdGFzZXROYW1lKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX29uQ3Vyc29yUmVtb3ZlZDogZnVuY3Rpb24gb25DdXJzb3JSZW1vdmVkKCkgewogICAgICAgICAgICAgICAgdGhpcy5pbnB1dC5yZXNldElucHV0VmFsdWUoKTsKICAgICAgICAgICAgICAgIHRoaXMuX3VwZGF0ZUhpbnQoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX29uRGF0YXNldFJlbmRlcmVkOiBmdW5jdGlvbiBvbkRhdGFzZXRSZW5kZXJlZCgpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3VwZGF0ZUhpbnQoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX29uT3BlbmVkOiBmdW5jdGlvbiBvbk9wZW5lZCgpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3VwZGF0ZUhpbnQoKTsKICAgICAgICAgICAgICAgIHRoaXMuZXZlbnRCdXMudHJpZ2dlcigib3BlbmVkIik7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9vbkNsb3NlZDogZnVuY3Rpb24gb25DbG9zZWQoKSB7CiAgICAgICAgICAgICAgICB0aGlzLmlucHV0LmNsZWFySGludCgpOwogICAgICAgICAgICAgICAgdGhpcy5ldmVudEJ1cy50cmlnZ2VyKCJjbG9zZWQiKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX29uRm9jdXNlZDogZnVuY3Rpb24gb25Gb2N1c2VkKCkgewogICAgICAgICAgICAgICAgdGhpcy5pc0FjdGl2YXRlZCA9IHRydWU7CiAgICAgICAgICAgICAgICB0aGlzLmRyb3Bkb3duLm9wZW4oKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX29uQmx1cnJlZDogZnVuY3Rpb24gb25CbHVycmVkKCkgewogICAgICAgICAgICAgICAgdGhpcy5pc0FjdGl2YXRlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgdGhpcy5kcm9wZG93bi5lbXB0eSgpOwogICAgICAgICAgICAgICAgdGhpcy5kcm9wZG93bi5jbG9zZSgpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfb25FbnRlcktleWVkOiBmdW5jdGlvbiBvbkVudGVyS2V5ZWQodHlwZSwgJGUpIHsKICAgICAgICAgICAgICAgIHZhciBjdXJzb3JEYXR1bSwgdG9wU3VnZ2VzdGlvbkRhdHVtOwogICAgICAgICAgICAgICAgY3Vyc29yRGF0dW0gPSB0aGlzLmRyb3Bkb3duLmdldERhdHVtRm9yQ3Vyc29yKCk7CiAgICAgICAgICAgICAgICB0b3BTdWdnZXN0aW9uRGF0dW0gPSB0aGlzLmRyb3Bkb3duLmdldERhdHVtRm9yVG9wU3VnZ2VzdGlvbigpOwogICAgICAgICAgICAgICAgaWYgKGN1cnNvckRhdHVtKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2VsZWN0KGN1cnNvckRhdHVtKTsKICAgICAgICAgICAgICAgICAgICAkZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmF1dG9zZWxlY3QgJiYgdG9wU3VnZ2VzdGlvbkRhdHVtKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2VsZWN0KHRvcFN1Z2dlc3Rpb25EYXR1bSk7CiAgICAgICAgICAgICAgICAgICAgJGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgX29uVGFiS2V5ZWQ6IGZ1bmN0aW9uIG9uVGFiS2V5ZWQodHlwZSwgJGUpIHsKICAgICAgICAgICAgICAgIHZhciBkYXR1bTsKICAgICAgICAgICAgICAgIGlmIChkYXR1bSA9IHRoaXMuZHJvcGRvd24uZ2V0RGF0dW1Gb3JDdXJzb3IoKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX3NlbGVjdChkYXR1bSk7CiAgICAgICAgICAgICAgICAgICAgJGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYXV0b2NvbXBsZXRlKHRydWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBfb25Fc2NLZXllZDogZnVuY3Rpb24gb25Fc2NLZXllZCgpIHsKICAgICAgICAgICAgICAgIHRoaXMuZHJvcGRvd24uY2xvc2UoKTsKICAgICAgICAgICAgICAgIHRoaXMuaW5wdXQucmVzZXRJbnB1dFZhbHVlKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9vblVwS2V5ZWQ6IGZ1bmN0aW9uIG9uVXBLZXllZCgpIHsKICAgICAgICAgICAgICAgIHZhciBxdWVyeSA9IHRoaXMuaW5wdXQuZ2V0UXVlcnkoKTsKICAgICAgICAgICAgICAgIHRoaXMuZHJvcGRvd24uaXNFbXB0eSAmJiBxdWVyeS5sZW5ndGggPj0gdGhpcy5taW5MZW5ndGggPyB0aGlzLmRyb3Bkb3duLnVwZGF0ZShxdWVyeSkgOiB0aGlzLmRyb3Bkb3duLm1vdmVDdXJzb3JVcCgpOwogICAgICAgICAgICAgICAgdGhpcy5kcm9wZG93bi5vcGVuKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9vbkRvd25LZXllZDogZnVuY3Rpb24gb25Eb3duS2V5ZWQoKSB7CiAgICAgICAgICAgICAgICB2YXIgcXVlcnkgPSB0aGlzLmlucHV0LmdldFF1ZXJ5KCk7CiAgICAgICAgICAgICAgICB0aGlzLmRyb3Bkb3duLmlzRW1wdHkgJiYgcXVlcnkubGVuZ3RoID49IHRoaXMubWluTGVuZ3RoID8gdGhpcy5kcm9wZG93bi51cGRhdGUocXVlcnkpIDogdGhpcy5kcm9wZG93bi5tb3ZlQ3Vyc29yRG93bigpOwogICAgICAgICAgICAgICAgdGhpcy5kcm9wZG93bi5vcGVuKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9vbkxlZnRLZXllZDogZnVuY3Rpb24gb25MZWZ0S2V5ZWQoKSB7CiAgICAgICAgICAgICAgICB0aGlzLmRpciA9PT0gInJ0bCIgJiYgdGhpcy5fYXV0b2NvbXBsZXRlKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9vblJpZ2h0S2V5ZWQ6IGZ1bmN0aW9uIG9uUmlnaHRLZXllZCgpIHsKICAgICAgICAgICAgICAgIHRoaXMuZGlyID09PSAibHRyIiAmJiB0aGlzLl9hdXRvY29tcGxldGUoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX29uUXVlcnlDaGFuZ2VkOiBmdW5jdGlvbiBvblF1ZXJ5Q2hhbmdlZChlLCBxdWVyeSkgewogICAgICAgICAgICAgICAgdGhpcy5pbnB1dC5jbGVhckhpbnRJZkludmFsaWQoKTsKICAgICAgICAgICAgICAgIHF1ZXJ5Lmxlbmd0aCA+PSB0aGlzLm1pbkxlbmd0aCA/IHRoaXMuZHJvcGRvd24udXBkYXRlKHF1ZXJ5KSA6IHRoaXMuZHJvcGRvd24uZW1wdHkoKTsKICAgICAgICAgICAgICAgIHRoaXMuZHJvcGRvd24ub3BlbigpOwogICAgICAgICAgICAgICAgdGhpcy5fc2V0TGFuZ3VhZ2VEaXJlY3Rpb24oKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX29uV2hpdGVzcGFjZUNoYW5nZWQ6IGZ1bmN0aW9uIG9uV2hpdGVzcGFjZUNoYW5nZWQoKSB7CiAgICAgICAgICAgICAgICB0aGlzLl91cGRhdGVIaW50KCk7CiAgICAgICAgICAgICAgICB0aGlzLmRyb3Bkb3duLm9wZW4oKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX3NldExhbmd1YWdlRGlyZWN0aW9uOiBmdW5jdGlvbiBzZXRMYW5ndWFnZURpcmVjdGlvbigpIHsKICAgICAgICAgICAgICAgIHZhciBkaXI7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5kaXIgIT09IChkaXIgPSB0aGlzLmlucHV0LmdldExhbmd1YWdlRGlyZWN0aW9uKCkpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXIgPSBkaXI7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kbm9kZS5jc3MoImRpcmVjdGlvbiIsIGRpcik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5kcm9wZG93bi5zZXRMYW5ndWFnZURpcmVjdGlvbihkaXIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBfdXBkYXRlSGludDogZnVuY3Rpb24gdXBkYXRlSGludCgpIHsKICAgICAgICAgICAgICAgIHZhciBkYXR1bSwgdmFsLCBxdWVyeSwgZXNjYXBlZFF1ZXJ5LCBmcm9udE1hdGNoUmVnRXgsIG1hdGNoOwogICAgICAgICAgICAgICAgZGF0dW0gPSB0aGlzLmRyb3Bkb3duLmdldERhdHVtRm9yVG9wU3VnZ2VzdGlvbigpOwogICAgICAgICAgICAgICAgaWYgKGRhdHVtICYmIHRoaXMuZHJvcGRvd24uaXNWaXNpYmxlKCkgJiYgIXRoaXMuaW5wdXQuaGFzT3ZlcmZsb3coKSkgewogICAgICAgICAgICAgICAgICAgIHZhbCA9IHRoaXMuaW5wdXQuZ2V0SW5wdXRWYWx1ZSgpOwogICAgICAgICAgICAgICAgICAgIHF1ZXJ5ID0gSW5wdXQubm9ybWFsaXplUXVlcnkodmFsKTsKICAgICAgICAgICAgICAgICAgICBlc2NhcGVkUXVlcnkgPSBfLmVzY2FwZVJlZ0V4Q2hhcnMocXVlcnkpOwogICAgICAgICAgICAgICAgICAgIGZyb250TWF0Y2hSZWdFeCA9IG5ldyBSZWdFeHAoIl4oPzoiICsgZXNjYXBlZFF1ZXJ5ICsgIikoLiskKSIsICJpIik7CiAgICAgICAgICAgICAgICAgICAgbWF0Y2ggPSBmcm9udE1hdGNoUmVnRXguZXhlYyhkYXR1bS52YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgbWF0Y2ggPyB0aGlzLmlucHV0LnNldEhpbnQodmFsICsgbWF0Y2hbMV0pIDogdGhpcy5pbnB1dC5jbGVhckhpbnQoKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnB1dC5jbGVhckhpbnQoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgX2F1dG9jb21wbGV0ZTogZnVuY3Rpb24gYXV0b2NvbXBsZXRlKGxheEN1cnNvcikgewogICAgICAgICAgICAgICAgdmFyIGhpbnQsIHF1ZXJ5LCBpc0N1cnNvckF0RW5kLCBkYXR1bTsKICAgICAgICAgICAgICAgIGhpbnQgPSB0aGlzLmlucHV0LmdldEhpbnQoKTsKICAgICAgICAgICAgICAgIHF1ZXJ5ID0gdGhpcy5pbnB1dC5nZXRRdWVyeSgpOwogICAgICAgICAgICAgICAgaXNDdXJzb3JBdEVuZCA9IGxheEN1cnNvciB8fCB0aGlzLmlucHV0LmlzQ3Vyc29yQXRFbmQoKTsKICAgICAgICAgICAgICAgIGlmIChoaW50ICYmIHF1ZXJ5ICE9PSBoaW50ICYmIGlzQ3Vyc29yQXRFbmQpIHsKICAgICAgICAgICAgICAgICAgICBkYXR1bSA9IHRoaXMuZHJvcGRvd24uZ2V0RGF0dW1Gb3JUb3BTdWdnZXN0aW9uKCk7CiAgICAgICAgICAgICAgICAgICAgZGF0dW0gJiYgdGhpcy5pbnB1dC5zZXRJbnB1dFZhbHVlKGRhdHVtLnZhbHVlKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmV2ZW50QnVzLnRyaWdnZXIoImF1dG9jb21wbGV0ZWQiLCBkYXR1bS5yYXcsIGRhdHVtLmRhdGFzZXROYW1lKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgX3NlbGVjdDogZnVuY3Rpb24gc2VsZWN0KGRhdHVtKSB7CiAgICAgICAgICAgICAgICB0aGlzLmlucHV0LnNldFF1ZXJ5KGRhdHVtLnZhbHVlKTsKICAgICAgICAgICAgICAgIHRoaXMuaW5wdXQuc2V0SW5wdXRWYWx1ZShkYXR1bS52YWx1ZSwgdHJ1ZSk7CiAgICAgICAgICAgICAgICB0aGlzLl9zZXRMYW5ndWFnZURpcmVjdGlvbigpOwogICAgICAgICAgICAgICAgdGhpcy5ldmVudEJ1cy50cmlnZ2VyKCJzZWxlY3RlZCIsIGRhdHVtLnJhdywgZGF0dW0uZGF0YXNldE5hbWUpOwogICAgICAgICAgICAgICAgdGhpcy5kcm9wZG93bi5jbG9zZSgpOwogICAgICAgICAgICAgICAgXy5kZWZlcihfLmJpbmQodGhpcy5kcm9wZG93bi5lbXB0eSwgdGhpcy5kcm9wZG93bikpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBvcGVuOiBmdW5jdGlvbiBvcGVuKCkgewogICAgICAgICAgICAgICAgdGhpcy5kcm9wZG93bi5vcGVuKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNsb3NlOiBmdW5jdGlvbiBjbG9zZSgpIHsKICAgICAgICAgICAgICAgIHRoaXMuZHJvcGRvd24uY2xvc2UoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2V0VmFsOiBmdW5jdGlvbiBzZXRWYWwodmFsKSB7CiAgICAgICAgICAgICAgICB2YWwgPSBfLnRvU3RyKHZhbCk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc0FjdGl2YXRlZCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuaW5wdXQuc2V0SW5wdXRWYWx1ZSh2YWwpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmlucHV0LnNldFF1ZXJ5KHZhbCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnB1dC5zZXRJbnB1dFZhbHVlKHZhbCwgdHJ1ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLl9zZXRMYW5ndWFnZURpcmVjdGlvbigpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBnZXRWYWw6IGZ1bmN0aW9uIGdldFZhbCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmlucHV0LmdldFF1ZXJ5KCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uIGRlc3Ryb3koKSB7CiAgICAgICAgICAgICAgICB0aGlzLmlucHV0LmRlc3Ryb3koKTsKICAgICAgICAgICAgICAgIHRoaXMuZHJvcGRvd24uZGVzdHJveSgpOwogICAgICAgICAgICAgICAgZGVzdHJveURvbVN0cnVjdHVyZSh0aGlzLiRub2RlKTsKICAgICAgICAgICAgICAgIHRoaXMuJG5vZGUgPSBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIFR5cGVhaGVhZDsKICAgICAgICBmdW5jdGlvbiBidWlsZERvbShpbnB1dCwgd2l0aEhpbnQpIHsKICAgICAgICAgICAgdmFyICRpbnB1dCwgJHdyYXBwZXIsICRkcm9wZG93biwgJGhpbnQ7CiAgICAgICAgICAgICRpbnB1dCA9ICQoaW5wdXQpOwogICAgICAgICAgICAkd3JhcHBlciA9ICQoaHRtbC53cmFwcGVyKS5jc3MoY3NzLndyYXBwZXIpOwogICAgICAgICAgICAkZHJvcGRvd24gPSAkKGh0bWwuZHJvcGRvd24pLmNzcyhjc3MuZHJvcGRvd24pOwogICAgICAgICAgICAkaGludCA9ICRpbnB1dC5jbG9uZSgpLmNzcyhjc3MuaGludCkuY3NzKGdldEJhY2tncm91bmRTdHlsZXMoJGlucHV0KSk7CiAgICAgICAgICAgICRoaW50LnZhbCgiIikucmVtb3ZlRGF0YSgpLmFkZENsYXNzKCJ0dC1oaW50IikucmVtb3ZlQXR0cigiaWQgbmFtZSBwbGFjZWhvbGRlciByZXF1aXJlZCIpLnByb3AoInJlYWRvbmx5IiwgdHJ1ZSkuYXR0cih7CiAgICAgICAgICAgICAgICBhdXRvY29tcGxldGU6ICJvZmYiLAogICAgICAgICAgICAgICAgc3BlbGxjaGVjazogImZhbHNlIiwKICAgICAgICAgICAgICAgIHRhYmluZGV4OiAtMQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgJGlucHV0LmRhdGEoYXR0cnNLZXksIHsKICAgICAgICAgICAgICAgIGRpcjogJGlucHV0LmF0dHIoImRpciIpLAogICAgICAgICAgICAgICAgYXV0b2NvbXBsZXRlOiAkaW5wdXQuYXR0cigiYXV0b2NvbXBsZXRlIiksCiAgICAgICAgICAgICAgICBzcGVsbGNoZWNrOiAkaW5wdXQuYXR0cigic3BlbGxjaGVjayIpLAogICAgICAgICAgICAgICAgc3R5bGU6ICRpbnB1dC5hdHRyKCJzdHlsZSIpCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAkaW5wdXQuYWRkQ2xhc3MoInR0LWlucHV0IikuYXR0cih7CiAgICAgICAgICAgICAgICBhdXRvY29tcGxldGU6ICJvZmYiLAogICAgICAgICAgICAgICAgc3BlbGxjaGVjazogZmFsc2UKICAgICAgICAgICAgfSkuY3NzKHdpdGhIaW50ID8gY3NzLmlucHV0IDogY3NzLmlucHV0V2l0aE5vSGludCk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAhJGlucHV0LmF0dHIoImRpciIpICYmICRpbnB1dC5hdHRyKCJkaXIiLCAiYXV0byIpOwogICAgICAgICAgICB9IGNhdGNoIChlKSB7fQogICAgICAgICAgICByZXR1cm4gJGlucHV0LndyYXAoJHdyYXBwZXIpLnBhcmVudCgpLnByZXBlbmQod2l0aEhpbnQgPyAkaGludCA6IG51bGwpLmFwcGVuZCgkZHJvcGRvd24pOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBnZXRCYWNrZ3JvdW5kU3R5bGVzKCRlbCkgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgYmFja2dyb3VuZEF0dGFjaG1lbnQ6ICRlbC5jc3MoImJhY2tncm91bmQtYXR0YWNobWVudCIpLAogICAgICAgICAgICAgICAgYmFja2dyb3VuZENsaXA6ICRlbC5jc3MoImJhY2tncm91bmQtY2xpcCIpLAogICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAkZWwuY3NzKCJiYWNrZ3JvdW5kLWNvbG9yIiksCiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kSW1hZ2U6ICRlbC5jc3MoImJhY2tncm91bmQtaW1hZ2UiKSwKICAgICAgICAgICAgICAgIGJhY2tncm91bmRPcmlnaW46ICRlbC5jc3MoImJhY2tncm91bmQtb3JpZ2luIiksCiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kUG9zaXRpb246ICRlbC5jc3MoImJhY2tncm91bmQtcG9zaXRpb24iKSwKICAgICAgICAgICAgICAgIGJhY2tncm91bmRSZXBlYXQ6ICRlbC5jc3MoImJhY2tncm91bmQtcmVwZWF0IiksCiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kU2l6ZTogJGVsLmNzcygiYmFja2dyb3VuZC1zaXplIikKICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gZGVzdHJveURvbVN0cnVjdHVyZSgkbm9kZSkgewogICAgICAgICAgICB2YXIgJGlucHV0ID0gJG5vZGUuZmluZCgiLnR0LWlucHV0Iik7CiAgICAgICAgICAgIF8uZWFjaCgkaW5wdXQuZGF0YShhdHRyc0tleSksIGZ1bmN0aW9uKHZhbCwga2V5KSB7CiAgICAgICAgICAgICAgICBfLmlzVW5kZWZpbmVkKHZhbCkgPyAkaW5wdXQucmVtb3ZlQXR0cihrZXkpIDogJGlucHV0LmF0dHIoa2V5LCB2YWwpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgJGlucHV0LmRldGFjaCgpLnJlbW92ZURhdGEoYXR0cnNLZXkpLnJlbW92ZUNsYXNzKCJ0dC1pbnB1dCIpLmluc2VydEFmdGVyKCRub2RlKTsKICAgICAgICAgICAgJG5vZGUucmVtb3ZlKCk7CiAgICAgICAgfQogICAgfSgpOwogICAgKGZ1bmN0aW9uKCkgewogICAgICAgIAogICAgICAgIHZhciBvbGQsIHR5cGVhaGVhZEtleSwgbWV0aG9kczsKICAgICAgICBvbGQgPSAkLmZuLnR5cGVhaGVhZDsKICAgICAgICB0eXBlYWhlYWRLZXkgPSAidHRUeXBlYWhlYWQiOwogICAgICAgIG1ldGhvZHMgPSB7CiAgICAgICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIGluaXRpYWxpemUobywgZGF0YXNldHMpIHsKICAgICAgICAgICAgICAgIGRhdGFzZXRzID0gXy5pc0FycmF5KGRhdGFzZXRzKSA/IGRhdGFzZXRzIDogW10uc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpOwogICAgICAgICAgICAgICAgbyA9IG8gfHwge307CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGF0dGFjaCk7CiAgICAgICAgICAgICAgICBmdW5jdGlvbiBhdHRhY2goKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyICRpbnB1dCA9ICQodGhpcyksIGV2ZW50QnVzLCB0eXBlYWhlYWQ7CiAgICAgICAgICAgICAgICAgICAgXy5lYWNoKGRhdGFzZXRzLCBmdW5jdGlvbihkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGQuaGlnaGxpZ2h0ID0gISFvLmhpZ2hsaWdodDsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB0eXBlYWhlYWQgPSBuZXcgVHlwZWFoZWFkKHsKICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXQ6ICRpbnB1dCwKICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnRCdXM6IGV2ZW50QnVzID0gbmV3IEV2ZW50QnVzKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsOiAkaW5wdXQKICAgICAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgICAgICAgIHdpdGhIaW50OiBfLmlzVW5kZWZpbmVkKG8uaGludCkgPyB0cnVlIDogISFvLmhpbnQsCiAgICAgICAgICAgICAgICAgICAgICAgIG1pbkxlbmd0aDogby5taW5MZW5ndGgsCiAgICAgICAgICAgICAgICAgICAgICAgIGF1dG9zZWxlY3Q6IG8uYXV0b3NlbGVjdCwKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YXNldHM6IGRhdGFzZXRzCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgJGlucHV0LmRhdGEodHlwZWFoZWFkS2V5LCB0eXBlYWhlYWQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBvcGVuOiBmdW5jdGlvbiBvcGVuKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChvcGVuVHlwZWFoZWFkKTsKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIG9wZW5UeXBlYWhlYWQoKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyICRpbnB1dCA9ICQodGhpcyksIHR5cGVhaGVhZDsKICAgICAgICAgICAgICAgICAgICBpZiAodHlwZWFoZWFkID0gJGlucHV0LmRhdGEodHlwZWFoZWFkS2V5KSkgewogICAgICAgICAgICAgICAgICAgICAgICB0eXBlYWhlYWQub3BlbigpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgY2xvc2U6IGZ1bmN0aW9uIGNsb3NlKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChjbG9zZVR5cGVhaGVhZCk7CiAgICAgICAgICAgICAgICBmdW5jdGlvbiBjbG9zZVR5cGVhaGVhZCgpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgJGlucHV0ID0gJCh0aGlzKSwgdHlwZWFoZWFkOwogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlYWhlYWQgPSAkaW5wdXQuZGF0YSh0eXBlYWhlYWRLZXkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVhaGVhZC5jbG9zZSgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgdmFsOiBmdW5jdGlvbiB2YWwobmV3VmFsKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gIWFyZ3VtZW50cy5sZW5ndGggPyBnZXRWYWwodGhpcy5maXJzdCgpKSA6IHRoaXMuZWFjaChzZXRWYWwpOwogICAgICAgICAgICAgICAgZnVuY3Rpb24gc2V0VmFsKCkgewogICAgICAgICAgICAgICAgICAgIHZhciAkaW5wdXQgPSAkKHRoaXMpLCB0eXBlYWhlYWQ7CiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVhaGVhZCA9ICRpbnB1dC5kYXRhKHR5cGVhaGVhZEtleSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZWFoZWFkLnNldFZhbChuZXdWYWwpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGdldFZhbCgkaW5wdXQpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgdHlwZWFoZWFkLCBxdWVyeTsKICAgICAgICAgICAgICAgICAgICBpZiAodHlwZWFoZWFkID0gJGlucHV0LmRhdGEodHlwZWFoZWFkS2V5KSkgewogICAgICAgICAgICAgICAgICAgICAgICBxdWVyeSA9IHR5cGVhaGVhZC5nZXRWYWwoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHF1ZXJ5OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBkZXN0cm95OiBmdW5jdGlvbiBkZXN0cm95KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaCh1bmF0dGFjaCk7CiAgICAgICAgICAgICAgICBmdW5jdGlvbiB1bmF0dGFjaCgpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgJGlucHV0ID0gJCh0aGlzKSwgdHlwZWFoZWFkOwogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlYWhlYWQgPSAkaW5wdXQuZGF0YSh0eXBlYWhlYWRLZXkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVhaGVhZC5kZXN0cm95KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICRpbnB1dC5yZW1vdmVEYXRhKHR5cGVhaGVhZEtleSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICAkLmZuLnR5cGVhaGVhZCA9IGZ1bmN0aW9uKG1ldGhvZCkgewogICAgICAgICAgICB2YXIgdHRzOwogICAgICAgICAgICBpZiAobWV0aG9kc1ttZXRob2RdICYmIG1ldGhvZCAhPT0gImluaXRpYWxpemUiKSB7CiAgICAgICAgICAgICAgICB0dHMgPSB0aGlzLmZpbHRlcihmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gISEkKHRoaXMpLmRhdGEodHlwZWFoZWFkS2V5KTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuIG1ldGhvZHNbbWV0aG9kXS5hcHBseSh0dHMsIFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbWV0aG9kcy5pbml0aWFsaXplLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgICQuZm4udHlwZWFoZWFkLm5vQ29uZmxpY3QgPSBmdW5jdGlvbiBub0NvbmZsaWN0KCkgewogICAgICAgICAgICAkLmZuLnR5cGVhaGVhZCA9IG9sZDsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfTsKICAgIH0pKCk7CiAgICByZXR1cm4ge307Cn0pKTsKCi8vIFRoaXMgY29kZSB3YXMgd3JpdHRlbiBieSBUeWxlciBBa2lucyBhbmQgaGFzIGJlZW4gcGxhY2VkIGluIHRoZQovLyBwdWJsaWMgZG9tYWluLiAgSXQgd291bGQgYmUgbmljZSBpZiB5b3UgbGVmdCB0aGlzIGhlYWRlciBpbnRhY3QuCi8vIEJhc2U2NCBjb2RlIGZyb20gVHlsZXIgQWtpbnMgLS0gaHR0cDovL3J1bWtpbi5jb20KCnZhciBCYXNlNjQgPSAoZnVuY3Rpb24gKCkgewogICAgdmFyIGtleVN0ciA9ICJBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWmFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MDEyMzQ1Njc4OSsvPSI7CgogICAgdmFyIG9iaiA9IHsKICAgICAgICAvKioKICAgICAgICAgKiBFbmNvZGVzIGEgc3RyaW5nIGluIGJhc2U2NAogICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBpbnB1dCBUaGUgc3RyaW5nIHRvIGVuY29kZSBpbiBiYXNlNjQuCiAgICAgICAgICovCiAgICAgICAgZW5jb2RlOiBmdW5jdGlvbiAoaW5wdXQpIHsKICAgICAgICAgICAgdmFyIG91dHB1dCA9ICIiOwogICAgICAgICAgICB2YXIgY2hyMSwgY2hyMiwgY2hyMzsKICAgICAgICAgICAgdmFyIGVuYzEsIGVuYzIsIGVuYzMsIGVuYzQ7CiAgICAgICAgICAgIHZhciBpID0gMDsKCiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgIGNocjEgPSBpbnB1dC5jaGFyQ29kZUF0KGkrKyk7CiAgICAgICAgICAgICAgICBjaHIyID0gaW5wdXQuY2hhckNvZGVBdChpKyspOwogICAgICAgICAgICAgICAgY2hyMyA9IGlucHV0LmNoYXJDb2RlQXQoaSsrKTsKCiAgICAgICAgICAgICAgICBlbmMxID0gY2hyMSA+PiAyOwogICAgICAgICAgICAgICAgZW5jMiA9ICgoY2hyMSAmIDMpIDw8IDQpIHwgKGNocjIgPj4gNCk7CiAgICAgICAgICAgICAgICBlbmMzID0gKChjaHIyICYgMTUpIDw8IDIpIHwgKGNocjMgPj4gNik7CiAgICAgICAgICAgICAgICBlbmM0ID0gY2hyMyAmIDYzOwoKICAgICAgICAgICAgICAgIGlmIChpc05hTihjaHIyKSkgewogICAgICAgICAgICAgICAgICAgIGVuYzMgPSBlbmM0ID0gNjQ7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGlzTmFOKGNocjMpKSB7CiAgICAgICAgICAgICAgICAgICAgZW5jNCA9IDY0OwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG91dHB1dCA9IG91dHB1dCArIGtleVN0ci5jaGFyQXQoZW5jMSkgKyBrZXlTdHIuY2hhckF0KGVuYzIpICsKICAgICAgICAgICAgICAgICAgICBrZXlTdHIuY2hhckF0KGVuYzMpICsga2V5U3RyLmNoYXJBdChlbmM0KTsKICAgICAgICAgICAgfSB3aGlsZSAoaSA8IGlucHV0Lmxlbmd0aCk7CgogICAgICAgICAgICByZXR1cm4gb3V0cHV0OwogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIERlY29kZXMgYSBiYXNlNjQgc3RyaW5nLgogICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBpbnB1dCBUaGUgc3RyaW5nIHRvIGRlY29kZS4KICAgICAgICAgKi8KICAgICAgICBkZWNvZGU6IGZ1bmN0aW9uIChpbnB1dCkgewogICAgICAgICAgICB2YXIgb3V0cHV0ID0gIiI7CiAgICAgICAgICAgIHZhciBjaHIxLCBjaHIyLCBjaHIzOwogICAgICAgICAgICB2YXIgZW5jMSwgZW5jMiwgZW5jMywgZW5jNDsKICAgICAgICAgICAgdmFyIGkgPSAwOwoKICAgICAgICAgICAgLy8gcmVtb3ZlIGFsbCBjaGFyYWN0ZXJzIHRoYXQgYXJlIG5vdCBBLVosIGEteiwgMC05LCArLCAvLCBvciA9CiAgICAgICAgICAgIGlucHV0ID0gaW5wdXQucmVwbGFjZSgvW15BLVphLXowLTlcK1wvXD1dL2csICIiKTsKCiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgIGVuYzEgPSBrZXlTdHIuaW5kZXhPZihpbnB1dC5jaGFyQXQoaSsrKSk7CiAgICAgICAgICAgICAgICBlbmMyID0ga2V5U3RyLmluZGV4T2YoaW5wdXQuY2hhckF0KGkrKykpOwogICAgICAgICAgICAgICAgZW5jMyA9IGtleVN0ci5pbmRleE9mKGlucHV0LmNoYXJBdChpKyspKTsKICAgICAgICAgICAgICAgIGVuYzQgPSBrZXlTdHIuaW5kZXhPZihpbnB1dC5jaGFyQXQoaSsrKSk7CgogICAgICAgICAgICAgICAgY2hyMSA9IChlbmMxIDw8IDIpIHwgKGVuYzIgPj4gNCk7CiAgICAgICAgICAgICAgICBjaHIyID0gKChlbmMyICYgMTUpIDw8IDQpIHwgKGVuYzMgPj4gMik7CiAgICAgICAgICAgICAgICBjaHIzID0gKChlbmMzICYgMykgPDwgNikgfCBlbmM0OwoKICAgICAgICAgICAgICAgIG91dHB1dCA9IG91dHB1dCArIFN0cmluZy5mcm9tQ2hhckNvZGUoY2hyMSk7CgogICAgICAgICAgICAgICAgaWYgKGVuYzMgIT0gNjQpIHsKICAgICAgICAgICAgICAgICAgICBvdXRwdXQgPSBvdXRwdXQgKyBTdHJpbmcuZnJvbUNoYXJDb2RlKGNocjIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGVuYzQgIT0gNjQpIHsKICAgICAgICAgICAgICAgICAgICBvdXRwdXQgPSBvdXRwdXQgKyBTdHJpbmcuZnJvbUNoYXJDb2RlKGNocjMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IHdoaWxlIChpIDwgaW5wdXQubGVuZ3RoKTsKCiAgICAgICAgICAgIHJldHVybiBvdXRwdXQ7CiAgICAgICAgfQogICAgfTsKCiAgICByZXR1cm4gb2JqOwp9KSgpOwoKLyoKICogQSBKYXZhU2NyaXB0IGltcGxlbWVudGF0aW9uIG9mIHRoZSBTZWN1cmUgSGFzaCBBbGdvcml0aG0sIFNIQS0xLCBhcyBkZWZpbmVkCiAqIGluIEZJUFMgUFVCIDE4MC0xCiAqIFZlcnNpb24gMi4xYSBDb3B5cmlnaHQgUGF1bCBKb2huc3RvbiAyMDAwIC0gMjAwMi4KICogT3RoZXIgY29udHJpYnV0b3JzOiBHcmVnIEhvbHQsIEFuZHJldyBLZXBlcnQsIFlkbmFyLCBMb3N0aW5ldAogKiBEaXN0cmlidXRlZCB1bmRlciB0aGUgQlNEIExpY2Vuc2UKICogU2VlIGh0dHA6Ly9wYWpob21lLm9yZy51ay9jcnlwdC9tZDUgZm9yIGRldGFpbHMuCiAqLwoKLyogU29tZSBmdW5jdGlvbnMgYW5kIHZhcmlhYmxlcyBoYXZlIGJlZW4gc3RyaXBwZWQgZm9yIHVzZSB3aXRoIFN0cm9waGUgKi8KCi8qCiAqIFRoZXNlIGFyZSB0aGUgZnVuY3Rpb25zIHlvdSdsbCB1c3VhbGx5IHdhbnQgdG8gY2FsbAogKiBUaGV5IHRha2Ugc3RyaW5nIGFyZ3VtZW50cyBhbmQgcmV0dXJuIGVpdGhlciBoZXggb3IgYmFzZS02NCBlbmNvZGVkIHN0cmluZ3MKICovCmZ1bmN0aW9uIGI2NF9zaGExKHMpe3JldHVybiBiaW5iMmI2NChjb3JlX3NoYTEoc3RyMmJpbmIocykscy5sZW5ndGggKiA4KSk7fQpmdW5jdGlvbiBzdHJfc2hhMShzKXtyZXR1cm4gYmluYjJzdHIoY29yZV9zaGExKHN0cjJiaW5iKHMpLHMubGVuZ3RoICogOCkpO30KZnVuY3Rpb24gYjY0X2htYWNfc2hhMShrZXksIGRhdGEpeyByZXR1cm4gYmluYjJiNjQoY29yZV9obWFjX3NoYTEoa2V5LCBkYXRhKSk7fQpmdW5jdGlvbiBzdHJfaG1hY19zaGExKGtleSwgZGF0YSl7IHJldHVybiBiaW5iMnN0cihjb3JlX2htYWNfc2hhMShrZXksIGRhdGEpKTt9CgovKgogKiBDYWxjdWxhdGUgdGhlIFNIQS0xIG9mIGFuIGFycmF5IG9mIGJpZy1lbmRpYW4gd29yZHMsIGFuZCBhIGJpdCBsZW5ndGgKICovCmZ1bmN0aW9uIGNvcmVfc2hhMSh4LCBsZW4pCnsKICAvKiBhcHBlbmQgcGFkZGluZyAqLwogIHhbbGVuID4+IDVdIHw9IDB4ODAgPDwgKDI0IC0gbGVuICUgMzIpOwogIHhbKChsZW4gKyA2NCA+PiA5KSA8PCA0KSArIDE1XSA9IGxlbjsKCiAgdmFyIHcgPSBuZXcgQXJyYXkoODApOwogIHZhciBhID0gIDE3MzI1ODQxOTM7CiAgdmFyIGIgPSAtMjcxNzMzODc5OwogIHZhciBjID0gLTE3MzI1ODQxOTQ7CiAgdmFyIGQgPSAgMjcxNzMzODc4OwogIHZhciBlID0gLTEwMDk1ODk3NzY7CgogIHZhciBpLCBqLCB0LCBvbGRhLCBvbGRiLCBvbGRjLCBvbGRkLCBvbGRlOwogIGZvciAoaSA9IDA7IGkgPCB4Lmxlbmd0aDsgaSArPSAxNikKICB7CiAgICBvbGRhID0gYTsKICAgIG9sZGIgPSBiOwogICAgb2xkYyA9IGM7CiAgICBvbGRkID0gZDsKICAgIG9sZGUgPSBlOwoKICAgIGZvciAoaiA9IDA7IGogPCA4MDsgaisrKQogICAgewogICAgICBpZiAoaiA8IDE2KSB7IHdbal0gPSB4W2kgKyBqXTsgfQogICAgICBlbHNlIHsgd1tqXSA9IHJvbCh3W2otM10gXiB3W2otOF0gXiB3W2otMTRdIF4gd1tqLTE2XSwgMSk7IH0KICAgICAgdCA9IHNhZmVfYWRkKHNhZmVfYWRkKHJvbChhLCA1KSwgc2hhMV9mdChqLCBiLCBjLCBkKSksCiAgICAgICAgICAgICAgICAgICAgICAgc2FmZV9hZGQoc2FmZV9hZGQoZSwgd1tqXSksIHNoYTFfa3QoaikpKTsKICAgICAgZSA9IGQ7CiAgICAgIGQgPSBjOwogICAgICBjID0gcm9sKGIsIDMwKTsKICAgICAgYiA9IGE7CiAgICAgIGEgPSB0OwogICAgfQoKICAgIGEgPSBzYWZlX2FkZChhLCBvbGRhKTsKICAgIGIgPSBzYWZlX2FkZChiLCBvbGRiKTsKICAgIGMgPSBzYWZlX2FkZChjLCBvbGRjKTsKICAgIGQgPSBzYWZlX2FkZChkLCBvbGRkKTsKICAgIGUgPSBzYWZlX2FkZChlLCBvbGRlKTsKICB9CiAgcmV0dXJuIFthLCBiLCBjLCBkLCBlXTsKfQoKLyoKICogUGVyZm9ybSB0aGUgYXBwcm9wcmlhdGUgdHJpcGxldCBjb21iaW5hdGlvbiBmdW5jdGlvbiBmb3IgdGhlIGN1cnJlbnQKICogaXRlcmF0aW9uCiAqLwpmdW5jdGlvbiBzaGExX2Z0KHQsIGIsIGMsIGQpCnsKICBpZiAodCA8IDIwKSB7IHJldHVybiAoYiAmIGMpIHwgKCh+YikgJiBkKTsgfQogIGlmICh0IDwgNDApIHsgcmV0dXJuIGIgXiBjIF4gZDsgfQogIGlmICh0IDwgNjApIHsgcmV0dXJuIChiICYgYykgfCAoYiAmIGQpIHwgKGMgJiBkKTsgfQogIHJldHVybiBiIF4gYyBeIGQ7Cn0KCi8qCiAqIERldGVybWluZSB0aGUgYXBwcm9wcmlhdGUgYWRkaXRpdmUgY29uc3RhbnQgZm9yIHRoZSBjdXJyZW50IGl0ZXJhdGlvbgogKi8KZnVuY3Rpb24gc2hhMV9rdCh0KQp7CiAgcmV0dXJuICh0IDwgMjApID8gIDE1MTg1MDAyNDkgOiAodCA8IDQwKSA/ICAxODU5Nzc1MzkzIDoKICAgICAgICAgKHQgPCA2MCkgPyAtMTg5NDAwNzU4OCA6IC04OTk0OTc1MTQ7Cn0KCi8qCiAqIENhbGN1bGF0ZSB0aGUgSE1BQy1TSEExIG9mIGEga2V5IGFuZCBzb21lIGRhdGEKICovCmZ1bmN0aW9uIGNvcmVfaG1hY19zaGExKGtleSwgZGF0YSkKewogIHZhciBia2V5ID0gc3RyMmJpbmIoa2V5KTsKICBpZiAoYmtleS5sZW5ndGggPiAxNikgeyBia2V5ID0gY29yZV9zaGExKGJrZXksIGtleS5sZW5ndGggKiA4KTsgfQoKICB2YXIgaXBhZCA9IG5ldyBBcnJheSgxNiksIG9wYWQgPSBuZXcgQXJyYXkoMTYpOwogIGZvciAodmFyIGkgPSAwOyBpIDwgMTY7IGkrKykKICB7CiAgICBpcGFkW2ldID0gYmtleVtpXSBeIDB4MzYzNjM2MzY7CiAgICBvcGFkW2ldID0gYmtleVtpXSBeIDB4NUM1QzVDNUM7CiAgfQoKICB2YXIgaGFzaCA9IGNvcmVfc2hhMShpcGFkLmNvbmNhdChzdHIyYmluYihkYXRhKSksIDUxMiArIGRhdGEubGVuZ3RoICogOCk7CiAgcmV0dXJuIGNvcmVfc2hhMShvcGFkLmNvbmNhdChoYXNoKSwgNTEyICsgMTYwKTsKfQoKLyoKICogQWRkIGludGVnZXJzLCB3cmFwcGluZyBhdCAyXjMyLiBUaGlzIHVzZXMgMTYtYml0IG9wZXJhdGlvbnMgaW50ZXJuYWxseQogKiB0byB3b3JrIGFyb3VuZCBidWdzIGluIHNvbWUgSlMgaW50ZXJwcmV0ZXJzLgogKi8KZnVuY3Rpb24gc2FmZV9hZGQoeCwgeSkKewogIHZhciBsc3cgPSAoeCAmIDB4RkZGRikgKyAoeSAmIDB4RkZGRik7CiAgdmFyIG1zdyA9ICh4ID4+IDE2KSArICh5ID4+IDE2KSArIChsc3cgPj4gMTYpOwogIHJldHVybiAobXN3IDw8IDE2KSB8IChsc3cgJiAweEZGRkYpOwp9CgovKgogKiBCaXR3aXNlIHJvdGF0ZSBhIDMyLWJpdCBudW1iZXIgdG8gdGhlIGxlZnQuCiAqLwpmdW5jdGlvbiByb2wobnVtLCBjbnQpCnsKICByZXR1cm4gKG51bSA8PCBjbnQpIHwgKG51bSA+Pj4gKDMyIC0gY250KSk7Cn0KCi8qCiAqIENvbnZlcnQgYW4gOC1iaXQgb3IgMTYtYml0IHN0cmluZyB0byBhbiBhcnJheSBvZiBiaWctZW5kaWFuIHdvcmRzCiAqIEluIDgtYml0IGZ1bmN0aW9uLCBjaGFyYWN0ZXJzID4yNTUgaGF2ZSB0aGVpciBoaS1ieXRlIHNpbGVudGx5IGlnbm9yZWQuCiAqLwpmdW5jdGlvbiBzdHIyYmluYihzdHIpCnsKICB2YXIgYmluID0gW107CiAgdmFyIG1hc2sgPSAyNTU7CiAgZm9yICh2YXIgaSA9IDA7IGkgPCBzdHIubGVuZ3RoICogODsgaSArPSA4KQogIHsKICAgIGJpbltpPj41XSB8PSAoc3RyLmNoYXJDb2RlQXQoaSAvIDgpICYgbWFzaykgPDwgKDI0IC0gaSUzMik7CiAgfQogIHJldHVybiBiaW47Cn0KCi8qCiAqIENvbnZlcnQgYW4gYXJyYXkgb2YgYmlnLWVuZGlhbiB3b3JkcyB0byBhIHN0cmluZwogKi8KZnVuY3Rpb24gYmluYjJzdHIoYmluKQp7CiAgdmFyIHN0ciA9ICIiOwogIHZhciBtYXNrID0gMjU1OwogIGZvciAodmFyIGkgPSAwOyBpIDwgYmluLmxlbmd0aCAqIDMyOyBpICs9IDgpCiAgewogICAgc3RyICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoKGJpbltpPj41XSA+Pj4gKDI0IC0gaSUzMikpICYgbWFzayk7CiAgfQogIHJldHVybiBzdHI7Cn0KCi8qCiAqIENvbnZlcnQgYW4gYXJyYXkgb2YgYmlnLWVuZGlhbiB3b3JkcyB0byBhIGJhc2UtNjQgc3RyaW5nCiAqLwpmdW5jdGlvbiBiaW5iMmI2NChiaW5hcnJheSkKewogIHZhciB0YWIgPSAiQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkrLyI7CiAgdmFyIHN0ciA9ICIiOwogIHZhciB0cmlwbGV0LCBqOwogIGZvciAodmFyIGkgPSAwOyBpIDwgYmluYXJyYXkubGVuZ3RoICogNDsgaSArPSAzKQogIHsKICAgIHRyaXBsZXQgPSAoKChiaW5hcnJheVtpICAgPj4gMl0gPj4gOCAqICgzIC0gIGkgICAlNCkpICYgMHhGRikgPDwgMTYpIHwKICAgICAgICAgICAgICAoKChiaW5hcnJheVtpKzEgPj4gMl0gPj4gOCAqICgzIC0gKGkrMSklNCkpICYgMHhGRikgPDwgOCApIHwKICAgICAgICAgICAgICAgKChiaW5hcnJheVtpKzIgPj4gMl0gPj4gOCAqICgzIC0gKGkrMiklNCkpICYgMHhGRik7CiAgICBmb3IgKGogPSAwOyBqIDwgNDsgaisrKQogICAgewogICAgICBpZiAoaSAqIDggKyBqICogNiA+IGJpbmFycmF5Lmxlbmd0aCAqIDMyKSB7IHN0ciArPSAiPSI7IH0KICAgICAgZWxzZSB7IHN0ciArPSB0YWIuY2hhckF0KCh0cmlwbGV0ID4+IDYqKDMtaikpICYgMHgzRik7IH0KICAgIH0KICB9CiAgcmV0dXJuIHN0cjsKfQoKLyoKICogQSBKYXZhU2NyaXB0IGltcGxlbWVudGF0aW9uIG9mIHRoZSBSU0EgRGF0YSBTZWN1cml0eSwgSW5jLiBNRDUgTWVzc2FnZQogKiBEaWdlc3QgQWxnb3JpdGhtLCBhcyBkZWZpbmVkIGluIFJGQyAxMzIxLgogKiBWZXJzaW9uIDIuMSBDb3B5cmlnaHQgKEMpIFBhdWwgSm9obnN0b24gMTk5OSAtIDIwMDIuCiAqIE90aGVyIGNvbnRyaWJ1dG9yczogR3JlZyBIb2x0LCBBbmRyZXcgS2VwZXJ0LCBZZG5hciwgTG9zdGluZXQKICogRGlzdHJpYnV0ZWQgdW5kZXIgdGhlIEJTRCBMaWNlbnNlCiAqIFNlZSBodHRwOi8vcGFqaG9tZS5vcmcudWsvY3J5cHQvbWQ1IGZvciBtb3JlIGluZm8uCiAqLwoKLyoKICogRXZlcnl0aGluZyB0aGF0IGlzbid0IHVzZWQgYnkgU3Ryb3BoZSBoYXMgYmVlbiBzdHJpcHBlZCBoZXJlIQogKi8KCnZhciBNRDUgPSAoZnVuY3Rpb24gKCkgewogICAgLyoKICAgICAqIEFkZCBpbnRlZ2Vycywgd3JhcHBpbmcgYXQgMl4zMi4gVGhpcyB1c2VzIDE2LWJpdCBvcGVyYXRpb25zIGludGVybmFsbHkKICAgICAqIHRvIHdvcmsgYXJvdW5kIGJ1Z3MgaW4gc29tZSBKUyBpbnRlcnByZXRlcnMuCiAgICAgKi8KICAgIHZhciBzYWZlX2FkZCA9IGZ1bmN0aW9uICh4LCB5KSB7CiAgICAgICAgdmFyIGxzdyA9ICh4ICYgMHhGRkZGKSArICh5ICYgMHhGRkZGKTsKICAgICAgICB2YXIgbXN3ID0gKHggPj4gMTYpICsgKHkgPj4gMTYpICsgKGxzdyA+PiAxNik7CiAgICAgICAgcmV0dXJuIChtc3cgPDwgMTYpIHwgKGxzdyAmIDB4RkZGRik7CiAgICB9OwoKICAgIC8qCiAgICAgKiBCaXR3aXNlIHJvdGF0ZSBhIDMyLWJpdCBudW1iZXIgdG8gdGhlIGxlZnQuCiAgICAgKi8KICAgIHZhciBiaXRfcm9sID0gZnVuY3Rpb24gKG51bSwgY250KSB7CiAgICAgICAgcmV0dXJuIChudW0gPDwgY250KSB8IChudW0gPj4+ICgzMiAtIGNudCkpOwogICAgfTsKCiAgICAvKgogICAgICogQ29udmVydCBhIHN0cmluZyB0byBhbiBhcnJheSBvZiBsaXR0bGUtZW5kaWFuIHdvcmRzCiAgICAgKi8KICAgIHZhciBzdHIyYmlubCA9IGZ1bmN0aW9uIChzdHIpIHsKICAgICAgICB2YXIgYmluID0gW107CiAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IHN0ci5sZW5ndGggKiA4OyBpICs9IDgpCiAgICAgICAgewogICAgICAgICAgICBiaW5baT4+NV0gfD0gKHN0ci5jaGFyQ29kZUF0KGkgLyA4KSAmIDI1NSkgPDwgKGklMzIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYmluOwogICAgfTsKCiAgICAvKgogICAgICogQ29udmVydCBhbiBhcnJheSBvZiBsaXR0bGUtZW5kaWFuIHdvcmRzIHRvIGEgc3RyaW5nCiAgICAgKi8KICAgIHZhciBiaW5sMnN0ciA9IGZ1bmN0aW9uIChiaW4pIHsKICAgICAgICB2YXIgc3RyID0gIiI7CiAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IGJpbi5sZW5ndGggKiAzMjsgaSArPSA4KQogICAgICAgIHsKICAgICAgICAgICAgc3RyICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoKGJpbltpPj41XSA+Pj4gKGkgJSAzMikpICYgMjU1KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHN0cjsKICAgIH07CgogICAgLyoKICAgICAqIENvbnZlcnQgYW4gYXJyYXkgb2YgbGl0dGxlLWVuZGlhbiB3b3JkcyB0byBhIGhleCBzdHJpbmcuCiAgICAgKi8KICAgIHZhciBiaW5sMmhleCA9IGZ1bmN0aW9uIChiaW5hcnJheSkgewogICAgICAgIHZhciBoZXhfdGFiID0gIjAxMjM0NTY3ODlhYmNkZWYiOwogICAgICAgIHZhciBzdHIgPSAiIjsKICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgYmluYXJyYXkubGVuZ3RoICogNDsgaSsrKQogICAgICAgIHsKICAgICAgICAgICAgc3RyICs9IGhleF90YWIuY2hhckF0KChiaW5hcnJheVtpPj4yXSA+PiAoKGklNCkqOCs0KSkgJiAweEYpICsKICAgICAgICAgICAgICAgIGhleF90YWIuY2hhckF0KChiaW5hcnJheVtpPj4yXSA+PiAoKGklNCkqOCAgKSkgJiAweEYpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gc3RyOwogICAgfTsKCiAgICAvKgogICAgICogVGhlc2UgZnVuY3Rpb25zIGltcGxlbWVudCB0aGUgZm91ciBiYXNpYyBvcGVyYXRpb25zIHRoZSBhbGdvcml0aG0gdXNlcy4KICAgICAqLwogICAgdmFyIG1kNV9jbW4gPSBmdW5jdGlvbiAocSwgYSwgYiwgeCwgcywgdCkgewogICAgICAgIHJldHVybiBzYWZlX2FkZChiaXRfcm9sKHNhZmVfYWRkKHNhZmVfYWRkKGEsIHEpLHNhZmVfYWRkKHgsIHQpKSwgcyksYik7CiAgICB9OwoKICAgIHZhciBtZDVfZmYgPSBmdW5jdGlvbiAoYSwgYiwgYywgZCwgeCwgcywgdCkgewogICAgICAgIHJldHVybiBtZDVfY21uKChiICYgYykgfCAoKH5iKSAmIGQpLCBhLCBiLCB4LCBzLCB0KTsKICAgIH07CgogICAgdmFyIG1kNV9nZyA9IGZ1bmN0aW9uIChhLCBiLCBjLCBkLCB4LCBzLCB0KSB7CiAgICAgICAgcmV0dXJuIG1kNV9jbW4oKGIgJiBkKSB8IChjICYgKH5kKSksIGEsIGIsIHgsIHMsIHQpOwogICAgfTsKCiAgICB2YXIgbWQ1X2hoID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQsIHgsIHMsIHQpIHsKICAgICAgICByZXR1cm4gbWQ1X2NtbihiIF4gYyBeIGQsIGEsIGIsIHgsIHMsIHQpOwogICAgfTsKCiAgICB2YXIgbWQ1X2lpID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQsIHgsIHMsIHQpIHsKICAgICAgICByZXR1cm4gbWQ1X2NtbihjIF4gKGIgfCAofmQpKSwgYSwgYiwgeCwgcywgdCk7CiAgICB9OwoKICAgIC8qCiAgICAgKiBDYWxjdWxhdGUgdGhlIE1ENSBvZiBhbiBhcnJheSBvZiBsaXR0bGUtZW5kaWFuIHdvcmRzLCBhbmQgYSBiaXQgbGVuZ3RoCiAgICAgKi8KICAgIHZhciBjb3JlX21kNSA9IGZ1bmN0aW9uICh4LCBsZW4pIHsKICAgICAgICAvKiBhcHBlbmQgcGFkZGluZyAqLwogICAgICAgIHhbbGVuID4+IDVdIHw9IDB4ODAgPDwgKChsZW4pICUgMzIpOwogICAgICAgIHhbKCgobGVuICsgNjQpID4+PiA5KSA8PCA0KSArIDE0XSA9IGxlbjsKCiAgICAgICAgdmFyIGEgPSAgMTczMjU4NDE5MzsKICAgICAgICB2YXIgYiA9IC0yNzE3MzM4Nzk7CiAgICAgICAgdmFyIGMgPSAtMTczMjU4NDE5NDsKICAgICAgICB2YXIgZCA9ICAyNzE3MzM4Nzg7CgogICAgICAgIHZhciBvbGRhLCBvbGRiLCBvbGRjLCBvbGRkOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgeC5sZW5ndGg7IGkgKz0gMTYpCiAgICAgICAgewogICAgICAgICAgICBvbGRhID0gYTsKICAgICAgICAgICAgb2xkYiA9IGI7CiAgICAgICAgICAgIG9sZGMgPSBjOwogICAgICAgICAgICBvbGRkID0gZDsKCiAgICAgICAgICAgIGEgPSBtZDVfZmYoYSwgYiwgYywgZCwgeFtpKyAwXSwgNyAsIC02ODA4NzY5MzYpOwogICAgICAgICAgICBkID0gbWQ1X2ZmKGQsIGEsIGIsIGMsIHhbaSsgMV0sIDEyLCAtMzg5NTY0NTg2KTsKICAgICAgICAgICAgYyA9IG1kNV9mZihjLCBkLCBhLCBiLCB4W2krIDJdLCAxNywgIDYwNjEwNTgxOSk7CiAgICAgICAgICAgIGIgPSBtZDVfZmYoYiwgYywgZCwgYSwgeFtpKyAzXSwgMjIsIC0xMDQ0NTI1MzMwKTsKICAgICAgICAgICAgYSA9IG1kNV9mZihhLCBiLCBjLCBkLCB4W2krIDRdLCA3ICwgLTE3NjQxODg5Nyk7CiAgICAgICAgICAgIGQgPSBtZDVfZmYoZCwgYSwgYiwgYywgeFtpKyA1XSwgMTIsICAxMjAwMDgwNDI2KTsKICAgICAgICAgICAgYyA9IG1kNV9mZihjLCBkLCBhLCBiLCB4W2krIDZdLCAxNywgLTE0NzMyMzEzNDEpOwogICAgICAgICAgICBiID0gbWQ1X2ZmKGIsIGMsIGQsIGEsIHhbaSsgN10sIDIyLCAtNDU3MDU5ODMpOwogICAgICAgICAgICBhID0gbWQ1X2ZmKGEsIGIsIGMsIGQsIHhbaSsgOF0sIDcgLCAgMTc3MDAzNTQxNik7CiAgICAgICAgICAgIGQgPSBtZDVfZmYoZCwgYSwgYiwgYywgeFtpKyA5XSwgMTIsIC0xOTU4NDE0NDE3KTsKICAgICAgICAgICAgYyA9IG1kNV9mZihjLCBkLCBhLCBiLCB4W2krMTBdLCAxNywgLTQyMDYzKTsKICAgICAgICAgICAgYiA9IG1kNV9mZihiLCBjLCBkLCBhLCB4W2krMTFdLCAyMiwgLTE5OTA0MDQxNjIpOwogICAgICAgICAgICBhID0gbWQ1X2ZmKGEsIGIsIGMsIGQsIHhbaSsxMl0sIDcgLCAgMTgwNDYwMzY4Mik7CiAgICAgICAgICAgIGQgPSBtZDVfZmYoZCwgYSwgYiwgYywgeFtpKzEzXSwgMTIsIC00MDM0MTEwMSk7CiAgICAgICAgICAgIGMgPSBtZDVfZmYoYywgZCwgYSwgYiwgeFtpKzE0XSwgMTcsIC0xNTAyMDAyMjkwKTsKICAgICAgICAgICAgYiA9IG1kNV9mZihiLCBjLCBkLCBhLCB4W2krMTVdLCAyMiwgIDEyMzY1MzUzMjkpOwoKICAgICAgICAgICAgYSA9IG1kNV9nZyhhLCBiLCBjLCBkLCB4W2krIDFdLCA1ICwgLTE2NTc5NjUxMCk7CiAgICAgICAgICAgIGQgPSBtZDVfZ2coZCwgYSwgYiwgYywgeFtpKyA2XSwgOSAsIC0xMDY5NTAxNjMyKTsKICAgICAgICAgICAgYyA9IG1kNV9nZyhjLCBkLCBhLCBiLCB4W2krMTFdLCAxNCwgIDY0MzcxNzcxMyk7CiAgICAgICAgICAgIGIgPSBtZDVfZ2coYiwgYywgZCwgYSwgeFtpKyAwXSwgMjAsIC0zNzM4OTczMDIpOwogICAgICAgICAgICBhID0gbWQ1X2dnKGEsIGIsIGMsIGQsIHhbaSsgNV0sIDUgLCAtNzAxNTU4NjkxKTsKICAgICAgICAgICAgZCA9IG1kNV9nZyhkLCBhLCBiLCBjLCB4W2krMTBdLCA5ICwgIDM4MDE2MDgzKTsKICAgICAgICAgICAgYyA9IG1kNV9nZyhjLCBkLCBhLCBiLCB4W2krMTVdLCAxNCwgLTY2MDQ3ODMzNSk7CiAgICAgICAgICAgIGIgPSBtZDVfZ2coYiwgYywgZCwgYSwgeFtpKyA0XSwgMjAsIC00MDU1Mzc4NDgpOwogICAgICAgICAgICBhID0gbWQ1X2dnKGEsIGIsIGMsIGQsIHhbaSsgOV0sIDUgLCAgNTY4NDQ2NDM4KTsKICAgICAgICAgICAgZCA9IG1kNV9nZyhkLCBhLCBiLCBjLCB4W2krMTRdLCA5ICwgLTEwMTk4MDM2OTApOwogICAgICAgICAgICBjID0gbWQ1X2dnKGMsIGQsIGEsIGIsIHhbaSsgM10sIDE0LCAtMTg3MzYzOTYxKTsKICAgICAgICAgICAgYiA9IG1kNV9nZyhiLCBjLCBkLCBhLCB4W2krIDhdLCAyMCwgIDExNjM1MzE1MDEpOwogICAgICAgICAgICBhID0gbWQ1X2dnKGEsIGIsIGMsIGQsIHhbaSsxM10sIDUgLCAtMTQ0NDY4MTQ2Nyk7CiAgICAgICAgICAgIGQgPSBtZDVfZ2coZCwgYSwgYiwgYywgeFtpKyAyXSwgOSAsIC01MTQwMzc4NCk7CiAgICAgICAgICAgIGMgPSBtZDVfZ2coYywgZCwgYSwgYiwgeFtpKyA3XSwgMTQsICAxNzM1MzI4NDczKTsKICAgICAgICAgICAgYiA9IG1kNV9nZyhiLCBjLCBkLCBhLCB4W2krMTJdLCAyMCwgLTE5MjY2MDc3MzQpOwoKICAgICAgICAgICAgYSA9IG1kNV9oaChhLCBiLCBjLCBkLCB4W2krIDVdLCA0ICwgLTM3ODU1OCk7CiAgICAgICAgICAgIGQgPSBtZDVfaGgoZCwgYSwgYiwgYywgeFtpKyA4XSwgMTEsIC0yMDIyNTc0NDYzKTsKICAgICAgICAgICAgYyA9IG1kNV9oaChjLCBkLCBhLCBiLCB4W2krMTFdLCAxNiwgIDE4MzkwMzA1NjIpOwogICAgICAgICAgICBiID0gbWQ1X2hoKGIsIGMsIGQsIGEsIHhbaSsxNF0sIDIzLCAtMzUzMDk1NTYpOwogICAgICAgICAgICBhID0gbWQ1X2hoKGEsIGIsIGMsIGQsIHhbaSsgMV0sIDQgLCAtMTUzMDk5MjA2MCk7CiAgICAgICAgICAgIGQgPSBtZDVfaGgoZCwgYSwgYiwgYywgeFtpKyA0XSwgMTEsICAxMjcyODkzMzUzKTsKICAgICAgICAgICAgYyA9IG1kNV9oaChjLCBkLCBhLCBiLCB4W2krIDddLCAxNiwgLTE1NTQ5NzYzMik7CiAgICAgICAgICAgIGIgPSBtZDVfaGgoYiwgYywgZCwgYSwgeFtpKzEwXSwgMjMsIC0xMDk0NzMwNjQwKTsKICAgICAgICAgICAgYSA9IG1kNV9oaChhLCBiLCBjLCBkLCB4W2krMTNdLCA0ICwgIDY4MTI3OTE3NCk7CiAgICAgICAgICAgIGQgPSBtZDVfaGgoZCwgYSwgYiwgYywgeFtpKyAwXSwgMTEsIC0zNTg1MzcyMjIpOwogICAgICAgICAgICBjID0gbWQ1X2hoKGMsIGQsIGEsIGIsIHhbaSsgM10sIDE2LCAtNzIyNTIxOTc5KTsKICAgICAgICAgICAgYiA9IG1kNV9oaChiLCBjLCBkLCBhLCB4W2krIDZdLCAyMywgIDc2MDI5MTg5KTsKICAgICAgICAgICAgYSA9IG1kNV9oaChhLCBiLCBjLCBkLCB4W2krIDldLCA0ICwgLTY0MDM2NDQ4Nyk7CiAgICAgICAgICAgIGQgPSBtZDVfaGgoZCwgYSwgYiwgYywgeFtpKzEyXSwgMTEsIC00MjE4MTU4MzUpOwogICAgICAgICAgICBjID0gbWQ1X2hoKGMsIGQsIGEsIGIsIHhbaSsxNV0sIDE2LCAgNTMwNzQyNTIwKTsKICAgICAgICAgICAgYiA9IG1kNV9oaChiLCBjLCBkLCBhLCB4W2krIDJdLCAyMywgLTk5NTMzODY1MSk7CgogICAgICAgICAgICBhID0gbWQ1X2lpKGEsIGIsIGMsIGQsIHhbaSsgMF0sIDYgLCAtMTk4NjMwODQ0KTsKICAgICAgICAgICAgZCA9IG1kNV9paShkLCBhLCBiLCBjLCB4W2krIDddLCAxMCwgIDExMjY4OTE0MTUpOwogICAgICAgICAgICBjID0gbWQ1X2lpKGMsIGQsIGEsIGIsIHhbaSsxNF0sIDE1LCAtMTQxNjM1NDkwNSk7CiAgICAgICAgICAgIGIgPSBtZDVfaWkoYiwgYywgZCwgYSwgeFtpKyA1XSwgMjEsIC01NzQzNDA1NSk7CiAgICAgICAgICAgIGEgPSBtZDVfaWkoYSwgYiwgYywgZCwgeFtpKzEyXSwgNiAsICAxNzAwNDg1NTcxKTsKICAgICAgICAgICAgZCA9IG1kNV9paShkLCBhLCBiLCBjLCB4W2krIDNdLCAxMCwgLTE4OTQ5ODY2MDYpOwogICAgICAgICAgICBjID0gbWQ1X2lpKGMsIGQsIGEsIGIsIHhbaSsxMF0sIDE1LCAtMTA1MTUyMyk7CiAgICAgICAgICAgIGIgPSBtZDVfaWkoYiwgYywgZCwgYSwgeFtpKyAxXSwgMjEsIC0yMDU0OTIyNzk5KTsKICAgICAgICAgICAgYSA9IG1kNV9paShhLCBiLCBjLCBkLCB4W2krIDhdLCA2ICwgIDE4NzMzMTMzNTkpOwogICAgICAgICAgICBkID0gbWQ1X2lpKGQsIGEsIGIsIGMsIHhbaSsxNV0sIDEwLCAtMzA2MTE3NDQpOwogICAgICAgICAgICBjID0gbWQ1X2lpKGMsIGQsIGEsIGIsIHhbaSsgNl0sIDE1LCAtMTU2MDE5ODM4MCk7CiAgICAgICAgICAgIGIgPSBtZDVfaWkoYiwgYywgZCwgYSwgeFtpKzEzXSwgMjEsICAxMzA5MTUxNjQ5KTsKICAgICAgICAgICAgYSA9IG1kNV9paShhLCBiLCBjLCBkLCB4W2krIDRdLCA2ICwgLTE0NTUyMzA3MCk7CiAgICAgICAgICAgIGQgPSBtZDVfaWkoZCwgYSwgYiwgYywgeFtpKzExXSwgMTAsIC0xMTIwMjEwMzc5KTsKICAgICAgICAgICAgYyA9IG1kNV9paShjLCBkLCBhLCBiLCB4W2krIDJdLCAxNSwgIDcxODc4NzI1OSk7CiAgICAgICAgICAgIGIgPSBtZDVfaWkoYiwgYywgZCwgYSwgeFtpKyA5XSwgMjEsIC0zNDM0ODU1NTEpOwoKICAgICAgICAgICAgYSA9IHNhZmVfYWRkKGEsIG9sZGEpOwogICAgICAgICAgICBiID0gc2FmZV9hZGQoYiwgb2xkYik7CiAgICAgICAgICAgIGMgPSBzYWZlX2FkZChjLCBvbGRjKTsKICAgICAgICAgICAgZCA9IHNhZmVfYWRkKGQsIG9sZGQpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gW2EsIGIsIGMsIGRdOwogICAgfTsKCgogICAgdmFyIG9iaiA9IHsKICAgICAgICAvKgogICAgICAgICAqIFRoZXNlIGFyZSB0aGUgZnVuY3Rpb25zIHlvdSdsbCB1c3VhbGx5IHdhbnQgdG8gY2FsbC4KICAgICAgICAgKiBUaGV5IHRha2Ugc3RyaW5nIGFyZ3VtZW50cyBhbmQgcmV0dXJuIGVpdGhlciBoZXggb3IgYmFzZS02NCBlbmNvZGVkCiAgICAgICAgICogc3RyaW5ncy4KICAgICAgICAgKi8KICAgICAgICBoZXhkaWdlc3Q6IGZ1bmN0aW9uIChzKSB7CiAgICAgICAgICAgIHJldHVybiBiaW5sMmhleChjb3JlX21kNShzdHIyYmlubChzKSwgcy5sZW5ndGggKiA4KSk7CiAgICAgICAgfSwKCiAgICAgICAgaGFzaDogZnVuY3Rpb24gKHMpIHsKICAgICAgICAgICAgcmV0dXJuIGJpbmwyc3RyKGNvcmVfbWQ1KHN0cjJiaW5sKHMpLCBzLmxlbmd0aCAqIDgpKTsKICAgICAgICB9CiAgICB9OwoKICAgIHJldHVybiBvYmo7Cn0pKCk7CgovKgogICAgVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgTUlUIGxpY2Vuc2UuCiAgICBQbGVhc2Ugc2VlIHRoZSBMSUNFTlNFIGZpbGUgZm9yIGRldGFpbHMuCgogICAgQ29weXJpZ2h0IDIwMDYtMjAwOCwgT0dHLCBMTEMKKi8KCi8qIGpzaGludCB1bmRlZjogdHJ1ZSwgdW51c2VkOiB0cnVlOiwgbm9hcmc6IHRydWUsIGxhdGVkZWY6IHRydWUgKi8KLypnbG9iYWwgZG9jdW1lbnQsIHdpbmRvdywgc2V0VGltZW91dCwgY2xlYXJUaW1lb3V0LCBjb25zb2xlLAogICAgQWN0aXZlWE9iamVjdCwgQmFzZTY0LCBNRDUsIERPTVBhcnNlciAqLwovLyBmcm9tIHNoYTEuanMKLypnbG9iYWwgY29yZV9obWFjX3NoYTEsIGJpbmIyc3RyLCBzdHJfaG1hY19zaGExLCBzdHJfc2hhMSwgYjY0X2htYWNfc2hhMSovCgovKiogRmlsZTogc3Ryb3BoZS5qcwogKiAgQSBKYXZhU2NyaXB0IGxpYnJhcnkgZm9yIFhNUFAgQk9TSC9YTVBQIG92ZXIgV2Vic29ja2V0LgogKgogKiAgVGhpcyBpcyB0aGUgSmF2YVNjcmlwdCB2ZXJzaW9uIG9mIHRoZSBTdHJvcGhlIGxpYnJhcnkuICBTaW5jZSBKYXZhU2NyaXB0CiAqICBoYWQgbm8gZmFjaWxpdGllcyBmb3IgcGVyc2lzdGVudCBUQ1AgY29ubmVjdGlvbnMsIHRoaXMgbGlicmFyeSB1c2VzCiAqICBCaWRpcmVjdGlvbmFsLXN0cmVhbXMgT3ZlciBTeW5jaHJvbm91cyBIVFRQIChCT1NIKSB0byBlbXVsYXRlCiAqICBhIHBlcnNpc3RlbnQsIHN0YXRlZnVsLCB0d28td2F5IGNvbm5lY3Rpb24gdG8gYW4gWE1QUCBzZXJ2ZXIuICBNb3JlCiAqICBpbmZvcm1hdGlvbiBvbiBCT1NIIGNhbiBiZSBmb3VuZCBpbiBYRVAgMTI0LgogKgogKiAgVGhpcyB2ZXJzaW9uIG9mIFN0cm9waGUgYWxzbyB3b3JrcyB3aXRoIFdlYlNvY2tldHMuCiAqICBGb3IgbW9yZSBpbmZvcm1hdGlvbiBvbiBYTVBQLW92ZXIgV2ViU29ja2V0IHNlZSB0aGlzIFJGQyBkcmFmdDoKICogIGh0dHA6Ly90b29scy5pZXRmLm9yZy9odG1sL2RyYWZ0LWlldGYteG1wcC13ZWJzb2NrZXQtMDAKICovCgovKiogUHJpdmF0ZUZ1bmN0aW9uOiBGdW5jdGlvbi5wcm90b3R5cGUuYmluZAogKiAgQmluZCBhIGZ1bmN0aW9uIHRvIGFuIGluc3RhbmNlLgogKgogKiAgVGhpcyBGdW5jdGlvbiBvYmplY3QgZXh0ZW5zaW9uIG1ldGhvZCBjcmVhdGVzIGEgYm91bmQgbWV0aG9kIHNpbWlsYXIKICogIHRvIHRob3NlIGluIFB5dGhvbi4gIFRoaXMgbWVhbnMgdGhhdCB0aGUgJ3RoaXMnIG9iamVjdCB3aWxsIHBvaW50CiAqICB0byB0aGUgaW5zdGFuY2UgeW91IHdhbnQuICBTZWUKICogIDxhIGhyZWY9J2h0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuL0phdmFTY3JpcHQvUmVmZXJlbmNlL0dsb2JhbF9PYmplY3RzL0Z1bmN0aW9uL2JpbmQnPk1EQydzIGJpbmQoKSBkb2N1bWVudGF0aW9uPC9hPiBhbmQKICogIDxhIGhyZWY9J2h0dHA6Ly9iZW5qYW1pbi5zbWVkYmVyZ3MudXMvYmxvZy8yMDA3LTAxLTAzL2JvdW5kLWZ1bmN0aW9ucy1hbmQtZnVuY3Rpb24taW1wb3J0cy1pbi1qYXZhc2NyaXB0Lyc+Qm91bmQgRnVuY3Rpb25zIGFuZCBGdW5jdGlvbiBJbXBvcnRzIGluIEphdmFTY3JpcHQ8L2E+CiAqICBmb3IgYSBjb21wbGV0ZSBleHBsYW5hdGlvbi4KICoKICogIFRoaXMgZXh0ZW5zaW9uIGFscmVhZHkgZXhpc3RzIGluIHNvbWUgYnJvd3NlcnMgKG5hbWVseSwgRmlyZWZveCAzKSwgYnV0CiAqICB3ZSBwcm92aWRlIGl0IHRvIHN1cHBvcnQgdGhvc2UgdGhhdCBkb24ndC4KICoKICogIFBhcmFtZXRlcnM6CiAqICAgIChPYmplY3QpIG9iaiAtIFRoZSBvYmplY3QgdGhhdCB3aWxsIGJlY29tZSAndGhpcycgaW4gdGhlIGJvdW5kIGZ1bmN0aW9uLgogKiAgICAoT2JqZWN0KSBhcmdOIC0gQW4gb3B0aW9uIGFyZ3VtZW50IHRoYXQgd2lsbCBiZSBwcmVwZW5kZWQgdG8gdGhlCiAqICAgICAgYXJndW1lbnRzIGdpdmVuIGZvciB0aGUgZnVuY3Rpb24gY2FsbAogKgogKiAgUmV0dXJuczoKICogICAgVGhlIGJvdW5kIGZ1bmN0aW9uLgogKi8KaWYgKCFGdW5jdGlvbi5wcm90b3R5cGUuYmluZCkgewogICAgRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQgPSBmdW5jdGlvbiAob2JqIC8qLCBhcmcxLCBhcmcyLCAuLi4gKi8pCiAgICB7CiAgICAgICAgdmFyIGZ1bmMgPSB0aGlzOwogICAgICAgIHZhciBfc2xpY2UgPSBBcnJheS5wcm90b3R5cGUuc2xpY2U7CiAgICAgICAgdmFyIF9jb25jYXQgPSBBcnJheS5wcm90b3R5cGUuY29uY2F0OwogICAgICAgIHZhciBfYXJncyA9IF9zbGljZS5jYWxsKGFyZ3VtZW50cywgMSk7CgogICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBmdW5jLmFwcGx5KG9iaiA/IG9iaiA6IHRoaXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb25jYXQuY2FsbChfYXJncywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9zbGljZS5jYWxsKGFyZ3VtZW50cywgMCkpKTsKICAgICAgICB9OwogICAgfTsKfQoKLyoqIFByaXZhdGVGdW5jdGlvbjogQXJyYXkucHJvdG90eXBlLmluZGV4T2YKICogIFJldHVybiB0aGUgaW5kZXggb2YgYW4gb2JqZWN0IGluIGFuIGFycmF5LgogKgogKiAgVGhpcyBmdW5jdGlvbiBpcyBub3Qgc3VwcGxpZWQgYnkgc29tZSBKYXZhU2NyaXB0IGltcGxlbWVudGF0aW9ucywgc28KICogIHdlIHByb3ZpZGUgaXQgaWYgaXQgaXMgbWlzc2luZy4gIFRoaXMgY29kZSBpcyBmcm9tOgogKiAgaHR0cDovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9Fbi9Db3JlX0phdmFTY3JpcHRfMS41X1JlZmVyZW5jZTpPYmplY3RzOkFycmF5OmluZGV4T2YKICoKICogIFBhcmFtZXRlcnM6CiAqICAgIChPYmplY3QpIGVsdCAtIFRoZSBvYmplY3QgdG8gbG9vayBmb3IuCiAqICAgIChJbnRlZ2VyKSBmcm9tIC0gVGhlIGluZGV4IGZyb20gd2hpY2ggdG8gc3RhcnQgbG9va2luZy4gKG9wdGlvbmFsKS4KICoKICogIFJldHVybnM6CiAqICAgIFRoZSBpbmRleCBvZiBlbHQgaW4gdGhlIGFycmF5IG9yIC0xIGlmIG5vdCBmb3VuZC4KICovCmlmICghQXJyYXkucHJvdG90eXBlLmluZGV4T2YpCnsKICAgIEFycmF5LnByb3RvdHlwZS5pbmRleE9mID0gZnVuY3Rpb24oZWx0IC8qLCBmcm9tKi8pCiAgICB7CiAgICAgICAgdmFyIGxlbiA9IHRoaXMubGVuZ3RoOwoKICAgICAgICB2YXIgZnJvbSA9IE51bWJlcihhcmd1bWVudHNbMV0pIHx8IDA7CiAgICAgICAgZnJvbSA9IChmcm9tIDwgMCkgPyBNYXRoLmNlaWwoZnJvbSkgOiBNYXRoLmZsb29yKGZyb20pOwogICAgICAgIGlmIChmcm9tIDwgMCkgewogICAgICAgICAgICBmcm9tICs9IGxlbjsKICAgICAgICB9CgogICAgICAgIGZvciAoOyBmcm9tIDwgbGVuOyBmcm9tKyspIHsKICAgICAgICAgICAgaWYgKGZyb20gaW4gdGhpcyAmJiB0aGlzW2Zyb21dID09PSBlbHQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmcm9tOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gLTE7CiAgICB9Owp9CgovKiBBbGwgb2YgdGhlIFN0cm9waGUgZ2xvYmFscyBhcmUgZGVmaW5lZCBpbiB0aGlzIHNwZWNpYWwgZnVuY3Rpb24gYmVsb3cgc28KICogdGhhdCByZWZlcmVuY2VzIHRvIHRoZSBnbG9iYWxzIGJlY29tZSBjbG9zdXJlcy4gIFRoaXMgd2lsbCBlbnN1cmUgdGhhdAogKiBvbiBwYWdlIHJlbG9hZCwgdGhlc2UgcmVmZXJlbmNlcyB3aWxsIHN0aWxsIGJlIGF2YWlsYWJsZSB0byBjYWxsYmFja3MKICogdGhhdCBhcmUgc3RpbGwgZXhlY3V0aW5nLgogKi8KCihmdW5jdGlvbiAoY2FsbGJhY2spIHsKdmFyIFN0cm9waGU7CgovKiogRnVuY3Rpb246ICRidWlsZAogKiAgQ3JlYXRlIGEgU3Ryb3BoZS5CdWlsZGVyLgogKiAgVGhpcyBpcyBhbiBhbGlhcyBmb3IgJ25ldyBTdHJvcGhlLkJ1aWxkZXIobmFtZSwgYXR0cnMpJy4KICoKICogIFBhcmFtZXRlcnM6CiAqICAgIChTdHJpbmcpIG5hbWUgLSBUaGUgcm9vdCBlbGVtZW50IG5hbWUuCiAqICAgIChPYmplY3QpIGF0dHJzIC0gVGhlIGF0dHJpYnV0ZXMgZm9yIHRoZSByb290IGVsZW1lbnQgaW4gb2JqZWN0IG5vdGF0aW9uLgogKgogKiAgUmV0dXJuczoKICogICAgQSBuZXcgU3Ryb3BoZS5CdWlsZGVyIG9iamVjdC4KICovCmZ1bmN0aW9uICRidWlsZChuYW1lLCBhdHRycykgeyByZXR1cm4gbmV3IFN0cm9waGUuQnVpbGRlcihuYW1lLCBhdHRycyk7IH0KLyoqIEZ1bmN0aW9uOiAkbXNnCiAqICBDcmVhdGUgYSBTdHJvcGhlLkJ1aWxkZXIgd2l0aCBhIDxtZXNzYWdlLz4gZWxlbWVudCBhcyB0aGUgcm9vdC4KICoKICogIFBhcm1hZXRlcnM6CiAqICAgIChPYmplY3QpIGF0dHJzIC0gVGhlIDxtZXNzYWdlLz4gZWxlbWVudCBhdHRyaWJ1dGVzIGluIG9iamVjdCBub3RhdGlvbi4KICoKICogIFJldHVybnM6CiAqICAgIEEgbmV3IFN0cm9waGUuQnVpbGRlciBvYmplY3QuCiAqLwpmdW5jdGlvbiAkbXNnKGF0dHJzKSB7IHJldHVybiBuZXcgU3Ryb3BoZS5CdWlsZGVyKCJtZXNzYWdlIiwgYXR0cnMpOyB9Ci8qKiBGdW5jdGlvbjogJGlxCiAqICBDcmVhdGUgYSBTdHJvcGhlLkJ1aWxkZXIgd2l0aCBhbiA8aXEvPiBlbGVtZW50IGFzIHRoZSByb290LgogKgogKiAgUGFyYW1ldGVyczoKICogICAgKE9iamVjdCkgYXR0cnMgLSBUaGUgPGlxLz4gZWxlbWVudCBhdHRyaWJ1dGVzIGluIG9iamVjdCBub3RhdGlvbi4KICoKICogIFJldHVybnM6CiAqICAgIEEgbmV3IFN0cm9waGUuQnVpbGRlciBvYmplY3QuCiAqLwpmdW5jdGlvbiAkaXEoYXR0cnMpIHsgcmV0dXJuIG5ldyBTdHJvcGhlLkJ1aWxkZXIoImlxIiwgYXR0cnMpOyB9Ci8qKiBGdW5jdGlvbjogJHByZXMKICogIENyZWF0ZSBhIFN0cm9waGUuQnVpbGRlciB3aXRoIGEgPHByZXNlbmNlLz4gZWxlbWVudCBhcyB0aGUgcm9vdC4KICoKICogIFBhcmFtZXRlcnM6CiAqICAgIChPYmplY3QpIGF0dHJzIC0gVGhlIDxwcmVzZW5jZS8+IGVsZW1lbnQgYXR0cmlidXRlcyBpbiBvYmplY3Qgbm90YXRpb24uCiAqCiAqICBSZXR1cm5zOgogKiAgICBBIG5ldyBTdHJvcGhlLkJ1aWxkZXIgb2JqZWN0LgogKi8KZnVuY3Rpb24gJHByZXMoYXR0cnMpIHsgcmV0dXJuIG5ldyBTdHJvcGhlLkJ1aWxkZXIoInByZXNlbmNlIiwgYXR0cnMpOyB9CgovKiogQ2xhc3M6IFN0cm9waGUKICogIEFuIG9iamVjdCBjb250YWluZXIgZm9yIGFsbCBTdHJvcGhlIGxpYnJhcnkgZnVuY3Rpb25zLgogKgogKiAgVGhpcyBjbGFzcyBpcyBqdXN0IGEgY29udGFpbmVyIGZvciBhbGwgdGhlIG9iamVjdHMgYW5kIGNvbnN0YW50cwogKiAgdXNlZCBpbiB0aGUgbGlicmFyeS4gIEl0IGlzIG5vdCBtZWFudCB0byBiZSBpbnN0YW50aWF0ZWQsIGJ1dCB0bwogKiAgcHJvdmlkZSBhIG5hbWVzcGFjZSBmb3IgbGlicmFyeSBvYmplY3RzLCBjb25zdGFudHMsIGFuZCBmdW5jdGlvbnMuCiAqLwpTdHJvcGhlID0gewogICAgLyoqIENvbnN0YW50OiBWRVJTSU9OCiAgICAgKiAgVGhlIHZlcnNpb24gb2YgdGhlIFN0cm9waGUgbGlicmFyeS4gVW5yZWxlYXNlZCBidWlsZHMgd2lsbCBoYXZlCiAgICAgKiAgYSB2ZXJzaW9uIG9mIGhlYWQtSEFTSCB3aGVyZSBIQVNIIGlzIGEgcGFydGlhbCByZXZpc2lvbi4KICAgICAqLwogICAgVkVSU0lPTjogIjEuMS4zIiwKCiAgICAvKiogQ29uc3RhbnRzOiBYTVBQIE5hbWVzcGFjZSBDb25zdGFudHMKICAgICAqICBDb21tb24gbmFtZXNwYWNlIGNvbnN0YW50cyBmcm9tIHRoZSBYTVBQIFJGQ3MgYW5kIFhFUHMuCiAgICAgKgogICAgICogIE5TLkhUVFBCSU5EIC0gSFRUUCBCSU5EIG5hbWVzcGFjZSBmcm9tIFhFUCAxMjQuCiAgICAgKiAgTlMuQk9TSCAtIEJPU0ggbmFtZXNwYWNlIGZyb20gWEVQIDIwNi4KICAgICAqICBOUy5DTElFTlQgLSBNYWluIFhNUFAgY2xpZW50IG5hbWVzcGFjZS4KICAgICAqICBOUy5BVVRIIC0gTGVnYWN5IGF1dGhlbnRpY2F0aW9uIG5hbWVzcGFjZS4KICAgICAqICBOUy5ST1NURVIgLSBSb3N0ZXIgb3BlcmF0aW9ucyBuYW1lc3BhY2UuCiAgICAgKiAgTlMuUFJPRklMRSAtIFByb2ZpbGUgbmFtZXNwYWNlLgogICAgICogIE5TLkRJU0NPX0lORk8gLSBTZXJ2aWNlIGRpc2NvdmVyeSBpbmZvIG5hbWVzcGFjZSBmcm9tIFhFUCAzMC4KICAgICAqICBOUy5ESVNDT19JVEVNUyAtIFNlcnZpY2UgZGlzY292ZXJ5IGl0ZW1zIG5hbWVzcGFjZSBmcm9tIFhFUCAzMC4KICAgICAqICBOUy5NVUMgLSBNdWx0aS1Vc2VyIENoYXQgbmFtZXNwYWNlIGZyb20gWEVQIDQ1LgogICAgICogIE5TLlNBU0wgLSBYTVBQIFNBU0wgbmFtZXNwYWNlIGZyb20gUkZDIDM5MjAuCiAgICAgKiAgTlMuU1RSRUFNIC0gWE1QUCBTdHJlYW1zIG5hbWVzcGFjZSBmcm9tIFJGQyAzOTIwLgogICAgICogIE5TLkJJTkQgLSBYTVBQIEJpbmRpbmcgbmFtZXNwYWNlIGZyb20gUkZDIDM5MjAuCiAgICAgKiAgTlMuU0VTU0lPTiAtIFhNUFAgU2Vzc2lvbiBuYW1lc3BhY2UgZnJvbSBSRkMgMzkyMC4KICAgICAqICBOUy5YSFRNTF9JTSAtIFhIVE1MLUlNIG5hbWVzcGFjZSBmcm9tIFhFUCA3MS4KICAgICAqICBOUy5YSFRNTCAtIFhIVE1MIGJvZHkgbmFtZXNwYWNlIGZyb20gWEVQIDcxLgogICAgICovCiAgICBOUzogewogICAgICAgIEhUVFBCSU5EOiAiaHR0cDovL2phYmJlci5vcmcvcHJvdG9jb2wvaHR0cGJpbmQiLAogICAgICAgIEJPU0g6ICJ1cm46eG1wcDp4Ym9zaCIsCiAgICAgICAgQ0xJRU5UOiAiamFiYmVyOmNsaWVudCIsCiAgICAgICAgQVVUSDogImphYmJlcjppcTphdXRoIiwKICAgICAgICBST1NURVI6ICJqYWJiZXI6aXE6cm9zdGVyIiwKICAgICAgICBQUk9GSUxFOiAiamFiYmVyOmlxOnByb2ZpbGUiLAogICAgICAgIERJU0NPX0lORk86ICJodHRwOi8vamFiYmVyLm9yZy9wcm90b2NvbC9kaXNjbyNpbmZvIiwKICAgICAgICBESVNDT19JVEVNUzogImh0dHA6Ly9qYWJiZXIub3JnL3Byb3RvY29sL2Rpc2NvI2l0ZW1zIiwKICAgICAgICBNVUM6ICJodHRwOi8vamFiYmVyLm9yZy9wcm90b2NvbC9tdWMiLAogICAgICAgIFNBU0w6ICJ1cm46aWV0ZjpwYXJhbXM6eG1sOm5zOnhtcHAtc2FzbCIsCiAgICAgICAgU1RSRUFNOiAiaHR0cDovL2V0aGVyeC5qYWJiZXIub3JnL3N0cmVhbXMiLAogICAgICAgIEJJTkQ6ICJ1cm46aWV0ZjpwYXJhbXM6eG1sOm5zOnhtcHAtYmluZCIsCiAgICAgICAgU0VTU0lPTjogInVybjppZXRmOnBhcmFtczp4bWw6bnM6eG1wcC1zZXNzaW9uIiwKICAgICAgICBWRVJTSU9OOiAiamFiYmVyOmlxOnZlcnNpb24iLAogICAgICAgIFNUQU5aQVM6ICJ1cm46aWV0ZjpwYXJhbXM6eG1sOm5zOnhtcHAtc3RhbnphcyIsCiAgICAgICAgWEhUTUxfSU06ICJodHRwOi8vamFiYmVyLm9yZy9wcm90b2NvbC94aHRtbC1pbSIsCiAgICAgICAgWEhUTUw6ICJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIgogICAgfSwKCgogICAgLyoqIENvbnN0YW50czogWEhUTUxfSU0gTmFtZXNwYWNlCiAgICAgKiAgY29udGFpbnMgYWxsb3dlZCB0YWdzLCB0YWcgYXR0cmlidXRlcywgYW5kIGNzcyBwcm9wZXJ0aWVzLgogICAgICogIFVzZWQgaW4gdGhlIGNyZWF0ZUh0bWwgZnVuY3Rpb24gdG8gZmlsdGVyIGluY29taW5nIGh0bWwgaW50byB0aGUgYWxsb3dlZCBYSFRNTC1JTSBzdWJzZXQuCiAgICAgKiAgU2VlIGh0dHA6Ly94bXBwLm9yZy9leHRlbnNpb25zL3hlcC0wMDcxLmh0bWwjcHJvZmlsZS1zdW1tYXJ5IGZvciB0aGUgbGlzdCBvZiByZWNvbW1lbmRlZAogICAgICogIGFsbG93ZWQgdGFncyBhbmQgdGhlaXIgYXR0cmlidXRlcy4KICAgICAqLwogICAgWEhUTUw6IHsKICAgICAgICAgICAgICAgIHRhZ3M6IFsnYScsJ2Jsb2NrcXVvdGUnLCdicicsJ2NpdGUnLCdlbScsJ2ltZycsJ2xpJywnb2wnLCdwJywnc3BhbicsJ3N0cm9uZycsJ3VsJywnYm9keSddLAogICAgICAgICAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgICAgICAgICAgICAgICAnYSc6ICAgICAgICAgIFsnaHJlZiddLAogICAgICAgICAgICAgICAgICAgICAgICAnYmxvY2txdW90ZSc6IFsnc3R5bGUnXSwKICAgICAgICAgICAgICAgICAgICAgICAgJ2JyJzogICAgICAgICBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgJ2NpdGUnOiAgICAgICBbJ3N0eWxlJ10sCiAgICAgICAgICAgICAgICAgICAgICAgICdlbSc6ICAgICAgICAgW10sCiAgICAgICAgICAgICAgICAgICAgICAgICdpbWcnOiAgICAgICAgWydzcmMnLCAnYWx0JywgJ3N0eWxlJywgJ2hlaWdodCcsICd3aWR0aCddLAogICAgICAgICAgICAgICAgICAgICAgICAnbGknOiAgICAgICAgIFsnc3R5bGUnXSwKICAgICAgICAgICAgICAgICAgICAgICAgJ29sJzogICAgICAgICBbJ3N0eWxlJ10sCiAgICAgICAgICAgICAgICAgICAgICAgICdwJzogICAgICAgICAgWydzdHlsZSddLAogICAgICAgICAgICAgICAgICAgICAgICAnc3Bhbic6ICAgICAgIFsnc3R5bGUnXSwKICAgICAgICAgICAgICAgICAgICAgICAgJ3N0cm9uZyc6ICAgICBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgJ3VsJzogICAgICAgICBbJ3N0eWxlJ10sCiAgICAgICAgICAgICAgICAgICAgICAgICdib2R5JzogICAgICAgW10KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBjc3M6IFsnYmFja2dyb3VuZC1jb2xvcicsJ2NvbG9yJywnZm9udC1mYW1pbHknLCdmb250LXNpemUnLCdmb250LXN0eWxlJywnZm9udC13ZWlnaHQnLCdtYXJnaW4tbGVmdCcsJ21hcmdpbi1yaWdodCcsJ3RleHQtYWxpZ24nLCd0ZXh0LWRlY29yYXRpb24nXSwKICAgICAgICAgICAgICAgIHZhbGlkVGFnOiBmdW5jdGlvbih0YWcpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCBTdHJvcGhlLlhIVE1MLnRhZ3MubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZih0YWcgPT0gU3Ryb3BoZS5YSFRNTC50YWdzW2ldKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHZhbGlkQXR0cmlidXRlOiBmdW5jdGlvbih0YWcsIGF0dHJpYnV0ZSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYodHlwZW9mIFN0cm9waGUuWEhUTUwuYXR0cmlidXRlc1t0YWddICE9PSAndW5kZWZpbmVkJyAmJiBTdHJvcGhlLlhIVE1MLmF0dHJpYnV0ZXNbdGFnXS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IFN0cm9waGUuWEhUTUwuYXR0cmlidXRlc1t0YWddLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihhdHRyaWJ1dGUgPT0gU3Ryb3BoZS5YSFRNTC5hdHRyaWJ1dGVzW3RhZ11baV0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB2YWxpZENTUzogZnVuY3Rpb24oc3R5bGUpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCBTdHJvcGhlLlhIVE1MLmNzcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHN0eWxlID09IFN0cm9waGUuWEhUTUwuY3NzW2ldKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgfSwKCiAgICAvKiogQ29uc3RhbnRzOiBDb25uZWN0aW9uIFN0YXR1cyBDb25zdGFudHMKICAgICAqICBDb25uZWN0aW9uIHN0YXR1cyBjb25zdGFudHMgZm9yIHVzZSBieSB0aGUgY29ubmVjdGlvbiBoYW5kbGVyCiAgICAgKiAgY2FsbGJhY2suCiAgICAgKgogICAgICogIFN0YXR1cy5FUlJPUiAtIEFuIGVycm9yIGhhcyBvY2N1cnJlZAogICAgICogIFN0YXR1cy5DT05ORUNUSU5HIC0gVGhlIGNvbm5lY3Rpb24gaXMgY3VycmVudGx5IGJlaW5nIG1hZGUKICAgICAqICBTdGF0dXMuQ09OTkZBSUwgLSBUaGUgY29ubmVjdGlvbiBhdHRlbXB0IGZhaWxlZAogICAgICogIFN0YXR1cy5BVVRIRU5USUNBVElORyAtIFRoZSBjb25uZWN0aW9uIGlzIGF1dGhlbnRpY2F0aW5nCiAgICAgKiAgU3RhdHVzLkFVVEhGQUlMIC0gVGhlIGF1dGhlbnRpY2F0aW9uIGF0dGVtcHQgZmFpbGVkCiAgICAgKiAgU3RhdHVzLkNPTk5FQ1RFRCAtIFRoZSBjb25uZWN0aW9uIGhhcyBzdWNjZWVkZWQKICAgICAqICBTdGF0dXMuRElTQ09OTkVDVEVEIC0gVGhlIGNvbm5lY3Rpb24gaGFzIGJlZW4gdGVybWluYXRlZAogICAgICogIFN0YXR1cy5ESVNDT05ORUNUSU5HIC0gVGhlIGNvbm5lY3Rpb24gaXMgY3VycmVudGx5IGJlaW5nIHRlcm1pbmF0ZWQKICAgICAqICBTdGF0dXMuQVRUQUNIRUQgLSBUaGUgY29ubmVjdGlvbiBoYXMgYmVlbiBhdHRhY2hlZAogICAgICovCiAgICBTdGF0dXM6IHsKICAgICAgICBFUlJPUjogMCwKICAgICAgICBDT05ORUNUSU5HOiAxLAogICAgICAgIENPTk5GQUlMOiAyLAogICAgICAgIEFVVEhFTlRJQ0FUSU5HOiAzLAogICAgICAgIEFVVEhGQUlMOiA0LAogICAgICAgIENPTk5FQ1RFRDogNSwKICAgICAgICBESVNDT05ORUNURUQ6IDYsCiAgICAgICAgRElTQ09OTkVDVElORzogNywKICAgICAgICBBVFRBQ0hFRDogOAogICAgfSwKCiAgICAvKiogQ29uc3RhbnRzOiBMb2cgTGV2ZWwgQ29uc3RhbnRzCiAgICAgKiAgTG9nZ2luZyBsZXZlbCBpbmRpY2F0b3JzLgogICAgICoKICAgICAqICBMb2dMZXZlbC5ERUJVRyAtIERlYnVnIG91dHB1dAogICAgICogIExvZ0xldmVsLklORk8gLSBJbmZvcm1hdGlvbmFsIG91dHB1dAogICAgICogIExvZ0xldmVsLldBUk4gLSBXYXJuaW5ncwogICAgICogIExvZ0xldmVsLkVSUk9SIC0gRXJyb3JzCiAgICAgKiAgTG9nTGV2ZWwuRkFUQUwgLSBGYXRhbCBlcnJvcnMKICAgICAqLwogICAgTG9nTGV2ZWw6IHsKICAgICAgICBERUJVRzogMCwKICAgICAgICBJTkZPOiAxLAogICAgICAgIFdBUk46IDIsCiAgICAgICAgRVJST1I6IDMsCiAgICAgICAgRkFUQUw6IDQKICAgIH0sCgogICAgLyoqIFByaXZhdGVDb25zdGFudHM6IERPTSBFbGVtZW50IFR5cGUgQ29uc3RhbnRzCiAgICAgKiAgRE9NIGVsZW1lbnQgdHlwZXMuCiAgICAgKgogICAgICogIEVsZW1lbnRUeXBlLk5PUk1BTCAtIE5vcm1hbCBlbGVtZW50LgogICAgICogIEVsZW1lbnRUeXBlLlRFWFQgLSBUZXh0IGRhdGEgZWxlbWVudC4KICAgICAqICBFbGVtZW50VHlwZS5GUkFHTUVOVCAtIFhIVE1MIGZyYWdtZW50IGVsZW1lbnQuCiAgICAgKi8KICAgIEVsZW1lbnRUeXBlOiB7CiAgICAgICAgTk9STUFMOiAxLAogICAgICAgIFRFWFQ6IDMsCiAgICAgICAgQ0RBVEE6IDQsCiAgICAgICAgRlJBR01FTlQ6IDExCiAgICB9LAoKICAgIC8qKiBQcml2YXRlQ29uc3RhbnRzOiBUaW1lb3V0IFZhbHVlcwogICAgICogIFRpbWVvdXQgdmFsdWVzIGZvciBlcnJvciBzdGF0ZXMuICBUaGVzZSB2YWx1ZXMgYXJlIGluIHNlY29uZHMuCiAgICAgKiAgVGhlc2Ugc2hvdWxkIG5vdCBiZSBjaGFuZ2VkIHVubGVzcyB5b3Uga25vdyBleGFjdGx5IHdoYXQgeW91IGFyZQogICAgICogIGRvaW5nLgogICAgICoKICAgICAqICBUSU1FT1VUIC0gVGltZW91dCBtdWx0aXBsaWVyLiBBIHdhaXRpbmcgcmVxdWVzdCB3aWxsIGJlIGNvbnNpZGVyZWQKICAgICAqICAgICAgZmFpbGVkIGFmdGVyIE1hdGguZmxvb3IoVElNRU9VVCAqIHdhaXQpIHNlY29uZHMgaGF2ZSBlbGFwc2VkLgogICAgICogICAgICBUaGlzIGRlZmF1bHRzIHRvIDEuMSwgYW5kIHdpdGggZGVmYXVsdCB3YWl0LCA2NiBzZWNvbmRzLgogICAgICogIFNFQ09OREFSWV9USU1FT1VUIC0gU2Vjb25kYXJ5IHRpbWVvdXQgbXVsdGlwbGllci4gSW4gY2FzZXMgd2hlcmUKICAgICAqICAgICAgU3Ryb3BoZSBjYW4gZGV0ZWN0IGVhcmx5IGZhaWx1cmUsIGl0IHdpbGwgY29uc2lkZXIgdGhlIHJlcXVlc3QKICAgICAqICAgICAgZmFpbGVkIGlmIGl0IGRvZXNuJ3QgcmV0dXJuIGFmdGVyCiAgICAgKiAgICAgIE1hdGguZmxvb3IoU0VDT05EQVJZX1RJTUVPVVQgKiB3YWl0KSBzZWNvbmRzIGhhdmUgZWxhcHNlZC4KICAgICAqICAgICAgVGhpcyBkZWZhdWx0cyB0byAwLjEsIGFuZCB3aXRoIGRlZmF1bHQgd2FpdCwgNiBzZWNvbmRzLgogICAgICovCiAgICBUSU1FT1VUOiAxLjEsCiAgICBTRUNPTkRBUllfVElNRU9VVDogMC4xLAoKICAgIC8qKiBGdW5jdGlvbjogYWRkTmFtZXNwYWNlCiAgICAgKiAgVGhpcyBmdW5jdGlvbiBpcyB1c2VkIHRvIGV4dGVuZCB0aGUgY3VycmVudCBuYW1lc3BhY2VzIGluCiAgICAgKiAgU3Ryb3BoZS5OUy4gIEl0IHRha2VzIGEga2V5IGFuZCBhIHZhbHVlIHdpdGggdGhlIGtleSBiZWluZyB0aGUKICAgICAqICBuYW1lIG9mIHRoZSBuZXcgbmFtZXNwYWNlLCB3aXRoIGl0cyBhY3R1YWwgdmFsdWUuCiAgICAgKiAgRm9yIGV4YW1wbGU6CiAgICAgKiAgU3Ryb3BoZS5hZGROYW1lc3BhY2UoJ1BVQlNVQicsICJodHRwOi8vamFiYmVyLm9yZy9wcm90b2NvbC9wdWJzdWIiKTsKICAgICAqCiAgICAgKiAgUGFyYW1ldGVyczoKICAgICAqICAgIChTdHJpbmcpIG5hbWUgLSBUaGUgbmFtZSB1bmRlciB3aGljaCB0aGUgbmFtZXNwYWNlIHdpbGwgYmUKICAgICAqICAgICAgcmVmZXJlbmNlZCB1bmRlciBTdHJvcGhlLk5TCiAgICAgKiAgICAoU3RyaW5nKSB2YWx1ZSAtIFRoZSBhY3R1YWwgbmFtZXNwYWNlLgogICAgICovCiAgICBhZGROYW1lc3BhY2U6IGZ1bmN0aW9uIChuYW1lLCB2YWx1ZSkKICAgIHsKICAgICAgU3Ryb3BoZS5OU1tuYW1lXSA9IHZhbHVlOwogICAgfSwKCiAgICAvKiogRnVuY3Rpb246IGZvckVhY2hDaGlsZAogICAgICogIE1hcCBhIGZ1bmN0aW9uIG92ZXIgc29tZSBvciBhbGwgY2hpbGQgZWxlbWVudHMgb2YgYSBnaXZlbiBlbGVtZW50LgogICAgICoKICAgICAqICBUaGlzIGlzIGEgc21hbGwgY29udmVuaWVuY2UgZnVuY3Rpb24gZm9yIG1hcHBpbmcgYSBmdW5jdGlvbiBvdmVyCiAgICAgKiAgc29tZSBvciBhbGwgb2YgdGhlIGNoaWxkcmVuIG9mIGFuIGVsZW1lbnQuICBJZiBlbGVtTmFtZSBpcyBudWxsLCBhbGwKICAgICAqICBjaGlsZHJlbiB3aWxsIGJlIHBhc3NlZCB0byB0aGUgZnVuY3Rpb24sIG90aGVyd2lzZSBvbmx5IGNoaWxkcmVuCiAgICAgKiAgd2hvc2UgdGFnIG5hbWVzIG1hdGNoIGVsZW1OYW1lIHdpbGwgYmUgcGFzc2VkLgogICAgICoKICAgICAqICBQYXJhbWV0ZXJzOgogICAgICogICAgKFhNTEVsZW1lbnQpIGVsZW0gLSBUaGUgZWxlbWVudCB0byBvcGVyYXRlIG9uLgogICAgICogICAgKFN0cmluZykgZWxlbU5hbWUgLSBUaGUgY2hpbGQgZWxlbWVudCB0YWcgbmFtZSBmaWx0ZXIuCiAgICAgKiAgICAoRnVuY3Rpb24pIGZ1bmMgLSBUaGUgZnVuY3Rpb24gdG8gYXBwbHkgdG8gZWFjaCBjaGlsZC4gIFRoaXMKICAgICAqICAgICAgZnVuY3Rpb24gc2hvdWxkIHRha2UgYSBzaW5nbGUgYXJndW1lbnQsIGEgRE9NIGVsZW1lbnQuCiAgICAgKi8KICAgIGZvckVhY2hDaGlsZDogZnVuY3Rpb24gKGVsZW0sIGVsZW1OYW1lLCBmdW5jKQogICAgewogICAgICAgIHZhciBpLCBjaGlsZE5vZGU7CgogICAgICAgIGZvciAoaSA9IDA7IGkgPCBlbGVtLmNoaWxkTm9kZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY2hpbGROb2RlID0gZWxlbS5jaGlsZE5vZGVzW2ldOwogICAgICAgICAgICBpZiAoY2hpbGROb2RlLm5vZGVUeXBlID09IFN0cm9waGUuRWxlbWVudFR5cGUuTk9STUFMICYmCiAgICAgICAgICAgICAgICAoIWVsZW1OYW1lIHx8IHRoaXMuaXNUYWdFcXVhbChjaGlsZE5vZGUsIGVsZW1OYW1lKSkpIHsKICAgICAgICAgICAgICAgIGZ1bmMoY2hpbGROb2RlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0sCgogICAgLyoqIEZ1bmN0aW9uOiBpc1RhZ0VxdWFsCiAgICAgKiAgQ29tcGFyZSBhbiBlbGVtZW50J3MgdGFnIG5hbWUgd2l0aCBhIHN0cmluZy4KICAgICAqCiAgICAgKiAgVGhpcyBmdW5jdGlvbiBpcyBjYXNlIGluc2Vuc2l0aXZlLgogICAgICoKICAgICAqICBQYXJhbWV0ZXJzOgogICAgICogICAgKFhNTEVsZW1lbnQpIGVsIC0gQSBET00gZWxlbWVudC4KICAgICAqICAgIChTdHJpbmcpIG5hbWUgLSBUaGUgZWxlbWVudCBuYW1lLgogICAgICoKICAgICAqICBSZXR1cm5zOgogICAgICogICAgdHJ1ZSBpZiB0aGUgZWxlbWVudCdzIHRhZyBuYW1lIG1hdGNoZXMgX2VsXywgYW5kIGZhbHNlCiAgICAgKiAgICBvdGhlcndpc2UuCiAgICAgKi8KICAgIGlzVGFnRXF1YWw6IGZ1bmN0aW9uIChlbCwgbmFtZSkKICAgIHsKICAgICAgICByZXR1cm4gZWwudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09IG5hbWUudG9Mb3dlckNhc2UoKTsKICAgIH0sCgogICAgLyoqIFByaXZhdGVWYXJpYWJsZTogX3htbEdlbmVyYXRvcgogICAgICogIF9Qcml2YXRlXyB2YXJpYWJsZSB0aGF0IGNhY2hlcyBhIERPTSBkb2N1bWVudCB0bwogICAgICogIGdlbmVyYXRlIGVsZW1lbnRzLgogICAgICovCiAgICBfeG1sR2VuZXJhdG9yOiBudWxsLAoKICAgIC8qKiBQcml2YXRlRnVuY3Rpb246IF9tYWtlR2VuZXJhdG9yCiAgICAgKiAgX1ByaXZhdGVfIGZ1bmN0aW9uIHRoYXQgY3JlYXRlcyBhIGR1bW15IFhNTCBET00gZG9jdW1lbnQgdG8gc2VydmUgYXMKICAgICAqICBhbiBlbGVtZW50IGFuZCB0ZXh0IG5vZGUgZ2VuZXJhdG9yLgogICAgICovCiAgICBfbWFrZUdlbmVyYXRvcjogZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBkb2M7CgogICAgICAgIC8vIElFOSBkb2VzIGltcGxlbWVudCBjcmVhdGVEb2N1bWVudCgpOyBob3dldmVyLCB1c2luZyBpdCB3aWxsIGNhdXNlIHRoZSBicm93c2VyIHRvIGxlYWsgbWVtb3J5IG9uIHBhZ2UgdW5sb2FkLgogICAgICAgIC8vIEhlcmUsIHdlIHRlc3QgZm9yIHByZXNlbmNlIG9mIGNyZWF0ZURvY3VtZW50KCkgcGx1cyBJRSdzIHByb3ByaWV0YXJ5IGRvY3VtZW50TW9kZSBhdHRyaWJ1dGUsIHdoaWNoIHdvdWxkIGJlCiAgICAgICAgICAgICAgICAvLyBsZXNzIHRoYW4gMTAgaW4gdGhlIGNhc2Ugb2YgSUU5IGFuZCBiZWxvdy4KICAgICAgICBpZiAoZG9jdW1lbnQuaW1wbGVtZW50YXRpb24uY3JlYXRlRG9jdW1lbnQgPT09IHVuZGVmaW5lZCB8fAogICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5pbXBsZW1lbnRhdGlvbi5jcmVhdGVEb2N1bWVudCAmJiBkb2N1bWVudC5kb2N1bWVudE1vZGUgJiYgZG9jdW1lbnQuZG9jdW1lbnRNb2RlIDwgMTApIHsKICAgICAgICAgICAgZG9jID0gdGhpcy5fZ2V0SUVYbWxEb20oKTsKICAgICAgICAgICAgZG9jLmFwcGVuZENoaWxkKGRvYy5jcmVhdGVFbGVtZW50KCdzdHJvcGhlJykpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGRvYyA9IGRvY3VtZW50LmltcGxlbWVudGF0aW9uCiAgICAgICAgICAgICAgICAuY3JlYXRlRG9jdW1lbnQoJ2phYmJlcjpjbGllbnQnLCAnc3Ryb3BoZScsIG51bGwpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGRvYzsKICAgIH0sCgogICAgLyoqIEZ1bmN0aW9uOiB4bWxHZW5lcmF0b3IKICAgICAqICBHZXQgdGhlIERPTSBkb2N1bWVudCB0byBnZW5lcmF0ZSBlbGVtZW50cy4KICAgICAqCiAgICAgKiAgUmV0dXJuczoKICAgICAqICAgIFRoZSBjdXJyZW50bHkgdXNlZCBET00gZG9jdW1lbnQuCiAgICAgKi8KICAgIHhtbEdlbmVyYXRvcjogZnVuY3Rpb24gKCkgewogICAgICAgIGlmICghU3Ryb3BoZS5feG1sR2VuZXJhdG9yKSB7CiAgICAgICAgICAgIFN0cm9waGUuX3htbEdlbmVyYXRvciA9IFN0cm9waGUuX21ha2VHZW5lcmF0b3IoKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIFN0cm9waGUuX3htbEdlbmVyYXRvcjsKICAgIH0sCgogICAgLyoqIFByaXZhdGVGdW5jdGlvbjogX2dldElFWG1sRG9tCiAgICAgKiAgR2V0cyBJRSB4bWwgZG9jIG9iamVjdAogICAgICoKICAgICAqICBSZXR1cm5zOgogICAgICogICAgQSBNaWNyb3NvZnQgWE1MIERPTSBPYmplY3QKICAgICAqICBTZWUgQWxzbzoKICAgICAqICAgIGh0dHA6Ly9tc2RuLm1pY3Jvc29mdC5jb20vZW4tdXMvbGlicmFyeS9tczc1NzgzNyUyOFZTLjg1JTI5LmFzcHgKICAgICAqLwogICAgX2dldElFWG1sRG9tIDogZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGRvYyA9IG51bGw7CiAgICAgICAgdmFyIGRvY1N0cmluZ3MgPSBbCiAgICAgICAgICAgICJNc3htbDIuRE9NRG9jdW1lbnQuNi4wIiwKICAgICAgICAgICAgIk1zeG1sMi5ET01Eb2N1bWVudC41LjAiLAogICAgICAgICAgICAiTXN4bWwyLkRPTURvY3VtZW50LjQuMCIsCiAgICAgICAgICAgICJNU1hNTDIuRE9NRG9jdW1lbnQuMy4wIiwKICAgICAgICAgICAgIk1TWE1MMi5ET01Eb2N1bWVudCIsCiAgICAgICAgICAgICJNU1hNTC5ET01Eb2N1bWVudCIsCiAgICAgICAgICAgICJNaWNyb3NvZnQuWE1MRE9NIgogICAgICAgIF07CgogICAgICAgIGZvciAodmFyIGQgPSAwOyBkIDwgZG9jU3RyaW5ncy5sZW5ndGg7IGQrKykgewogICAgICAgICAgICBpZiAoZG9jID09PSBudWxsKSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGRvYyA9IG5ldyBBY3RpdmVYT2JqZWN0KGRvY1N0cmluZ3NbZF0pOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgICAgIGRvYyA9IG51bGw7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGRvYzsKICAgIH0sCgogICAgLyoqIEZ1bmN0aW9uOiB4bWxFbGVtZW50CiAgICAgKiAgQ3JlYXRlIGFuIFhNTCBET00gZWxlbWVudC4KICAgICAqCiAgICAgKiAgVGhpcyBmdW5jdGlvbiBjcmVhdGVzIGFuIFhNTCBET00gZWxlbWVudCBjb3JyZWN0bHkgYWNyb3NzIGFsbAogICAgICogIGltcGxlbWVudGF0aW9ucy4gTm90ZSB0aGF0IHRoZXNlIGFyZSBub3QgSFRNTCBET00gZWxlbWVudHMsIHdoaWNoCiAgICAgKiAgYXJlbid0IGFwcHJvcHJpYXRlIGZvciBYTVBQIHN0YW56YXMuCiAgICAgKgogICAgICogIFBhcmFtZXRlcnM6CiAgICAgKiAgICAoU3RyaW5nKSBuYW1lIC0gVGhlIG5hbWUgZm9yIHRoZSBlbGVtZW50LgogICAgICogICAgKEFycmF5fE9iamVjdCkgYXR0cnMgLSBBbiBvcHRpb25hbCBhcnJheSBvciBvYmplY3QgY29udGFpbmluZwogICAgICogICAgICBrZXkvdmFsdWUgcGFpcnMgdG8gdXNlIGFzIGVsZW1lbnQgYXR0cmlidXRlcy4gVGhlIG9iamVjdCBzaG91bGQKICAgICAqICAgICAgYmUgaW4gdGhlIGZvcm1hdCB7J2tleSc6ICd2YWx1ZSd9IG9yIHtrZXk6ICd2YWx1ZSd9LiBUaGUgYXJyYXkKICAgICAqICAgICAgc2hvdWxkIGhhdmUgdGhlIGZvcm1hdCBbWydrZXkxJywgJ3ZhbHVlMSddLCBbJ2tleTInLCAndmFsdWUyJ11dLgogICAgICogICAgKFN0cmluZykgdGV4dCAtIFRoZSB0ZXh0IGNoaWxkIGRhdGEgZm9yIHRoZSBlbGVtZW50LgogICAgICoKICAgICAqICBSZXR1cm5zOgogICAgICogICAgQSBuZXcgWE1MIERPTSBlbGVtZW50LgogICAgICovCiAgICB4bWxFbGVtZW50OiBmdW5jdGlvbiAobmFtZSkKICAgIHsKICAgICAgICBpZiAoIW5hbWUpIHsgcmV0dXJuIG51bGw7IH0KCiAgICAgICAgdmFyIG5vZGUgPSBTdHJvcGhlLnhtbEdlbmVyYXRvcigpLmNyZWF0ZUVsZW1lbnQobmFtZSk7CgogICAgICAgIC8vIEZJWE1FOiB0aGlzIHNob3VsZCB0aHJvdyBlcnJvcnMgaWYgYXJncyBhcmUgdGhlIHdyb25nIHR5cGUgb3IKICAgICAgICAvLyB0aGVyZSBhcmUgbW9yZSB0aGFuIHR3byBvcHRpb25hbCBhcmdzCiAgICAgICAgdmFyIGEsIGksIGs7CiAgICAgICAgZm9yIChhID0gMTsgYSA8IGFyZ3VtZW50cy5sZW5ndGg7IGErKykgewogICAgICAgICAgICBpZiAoIWFyZ3VtZW50c1thXSkgeyBjb250aW51ZTsgfQogICAgICAgICAgICBpZiAodHlwZW9mKGFyZ3VtZW50c1thXSkgPT0gInN0cmluZyIgfHwKICAgICAgICAgICAgICAgIHR5cGVvZihhcmd1bWVudHNbYV0pID09ICJudW1iZXIiKSB7CiAgICAgICAgICAgICAgICBub2RlLmFwcGVuZENoaWxkKFN0cm9waGUueG1sVGV4dE5vZGUoYXJndW1lbnRzW2FdKSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mKGFyZ3VtZW50c1thXSkgPT0gIm9iamVjdCIgJiYKICAgICAgICAgICAgICAgICAgICAgICB0eXBlb2YoYXJndW1lbnRzW2FdLnNvcnQpID09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBhcmd1bWVudHNbYV0ubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mKGFyZ3VtZW50c1thXVtpXSkgPT0gIm9iamVjdCIgJiYKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZW9mKGFyZ3VtZW50c1thXVtpXS5zb3J0KSA9PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUuc2V0QXR0cmlidXRlKGFyZ3VtZW50c1thXVtpXVswXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJndW1lbnRzW2FdW2ldWzFdKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mKGFyZ3VtZW50c1thXSkgPT0gIm9iamVjdCIpIHsKICAgICAgICAgICAgICAgIGZvciAoayBpbiBhcmd1bWVudHNbYV0pIHsKICAgICAgICAgICAgICAgICAgICBpZiAoYXJndW1lbnRzW2FdLmhhc093blByb3BlcnR5KGspKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUuc2V0QXR0cmlidXRlKGssIGFyZ3VtZW50c1thXVtrXSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbm9kZTsKICAgIH0sCgogICAgLyogIEZ1bmN0aW9uOiB4bWxlc2NhcGUKICAgICAqICBFeGNhcGVzIGludmFsaWQgeG1sIGNoYXJhY3RlcnMuCiAgICAgKgogICAgICogIFBhcmFtZXRlcnM6CiAgICAgKiAgICAgKFN0cmluZykgdGV4dCAtIHRleHQgdG8gZXNjYXBlLgogICAgICoKICAgICAqICBSZXR1cm5zOgogICAgICogICAgICBFc2NhcGVkIHRleHQuCiAgICAgKi8KICAgIHhtbGVzY2FwZTogZnVuY3Rpb24odGV4dCkKICAgIHsKICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC9cJi9nLCAiJmFtcDsiKTsKICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC88L2csICAiJmx0OyIpOwogICAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoLz4vZywgICImZ3Q7Iik7CiAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZSgvJy9nLCAgIiZhcG9zOyIpOwogICAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoLyIvZywgICImcXVvdDsiKTsKICAgICAgICByZXR1cm4gdGV4dDsKICAgIH0sCgogICAgLyoqIEZ1bmN0aW9uOiB4bWxUZXh0Tm9kZQogICAgICogIENyZWF0ZXMgYW4gWE1MIERPTSB0ZXh0IG5vZGUuCiAgICAgKgogICAgICogIFByb3ZpZGVzIGEgY3Jvc3MgaW1wbGVtZW50YXRpb24gdmVyc2lvbiBvZiBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZS4KICAgICAqCiAgICAgKiAgUGFyYW1ldGVyczoKICAgICAqICAgIChTdHJpbmcpIHRleHQgLSBUaGUgY29udGVudCBvZiB0aGUgdGV4dCBub2RlLgogICAgICoKICAgICAqICBSZXR1cm5zOgogICAgICogICAgQSBuZXcgWE1MIERPTSB0ZXh0IG5vZGUuCiAgICAgKi8KICAgIHhtbFRleHROb2RlOiBmdW5jdGlvbiAodGV4dCkKICAgIHsKICAgICAgICByZXR1cm4gU3Ryb3BoZS54bWxHZW5lcmF0b3IoKS5jcmVhdGVUZXh0Tm9kZSh0ZXh0KTsKICAgIH0sCgogICAgLyoqIEZ1bmN0aW9uOiB4bWxIdG1sTm9kZQogICAgICogIENyZWF0ZXMgYW4gWE1MIERPTSBodG1sIG5vZGUuCiAgICAgKgogICAgICogIFBhcmFtZXRlcnM6CiAgICAgKiAgICAoU3RyaW5nKSBodG1sIC0gVGhlIGNvbnRlbnQgb2YgdGhlIGh0bWwgbm9kZS4KICAgICAqCiAgICAgKiAgUmV0dXJuczoKICAgICAqICAgIEEgbmV3IFhNTCBET00gdGV4dCBub2RlLgogICAgICovCiAgICB4bWxIdG1sTm9kZTogZnVuY3Rpb24gKGh0bWwpCiAgICB7CiAgICAgICAgdmFyIG5vZGU7CiAgICAgICAgLy9lbnN1cmUgdGV4dCBpcyBlc2NhcGVkCiAgICAgICAgaWYgKHdpbmRvdy5ET01QYXJzZXIpIHsKICAgICAgICAgICAgdmFyIHBhcnNlciA9IG5ldyBET01QYXJzZXIoKTsKICAgICAgICAgICAgbm9kZSA9IHBhcnNlci5wYXJzZUZyb21TdHJpbmcoaHRtbCwgInRleHQveG1sIik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbm9kZSA9IG5ldyBBY3RpdmVYT2JqZWN0KCJNaWNyb3NvZnQuWE1MRE9NIik7CiAgICAgICAgICAgIG5vZGUuYXN5bmM9ImZhbHNlIjsKICAgICAgICAgICAgbm9kZS5sb2FkWE1MKGh0bWwpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbm9kZTsKICAgIH0sCgogICAgLyoqIEZ1bmN0aW9uOiBnZXRUZXh0CiAgICAgKiAgR2V0IHRoZSBjb25jYXRlbmF0aW9uIG9mIGFsbCB0ZXh0IGNoaWxkcmVuIG9mIGFuIGVsZW1lbnQuCiAgICAgKgogICAgICogIFBhcmFtZXRlcnM6CiAgICAgKiAgICAoWE1MRWxlbWVudCkgZWxlbSAtIEEgRE9NIGVsZW1lbnQuCiAgICAgKgogICAgICogIFJldHVybnM6CiAgICAgKiAgICBBIFN0cmluZyB3aXRoIHRoZSBjb25jYXRlbmF0ZWQgdGV4dCBvZiBhbGwgdGV4dCBlbGVtZW50IGNoaWxkcmVuLgogICAgICovCiAgICBnZXRUZXh0OiBmdW5jdGlvbiAoZWxlbSkKICAgIHsKICAgICAgICBpZiAoIWVsZW0pIHsgcmV0dXJuIG51bGw7IH0KCiAgICAgICAgdmFyIHN0ciA9ICIiOwogICAgICAgIGlmIChlbGVtLmNoaWxkTm9kZXMubGVuZ3RoID09PSAwICYmIGVsZW0ubm9kZVR5cGUgPT0KICAgICAgICAgICAgU3Ryb3BoZS5FbGVtZW50VHlwZS5URVhUKSB7CiAgICAgICAgICAgIHN0ciArPSBlbGVtLm5vZGVWYWx1ZTsKICAgICAgICB9CgogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZWxlbS5jaGlsZE5vZGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChlbGVtLmNoaWxkTm9kZXNbaV0ubm9kZVR5cGUgPT0gU3Ryb3BoZS5FbGVtZW50VHlwZS5URVhUKSB7CiAgICAgICAgICAgICAgICBzdHIgKz0gZWxlbS5jaGlsZE5vZGVzW2ldLm5vZGVWYWx1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIFN0cm9waGUueG1sZXNjYXBlKHN0cik7CiAgICB9LAoKICAgIC8qKiBGdW5jdGlvbjogY29weUVsZW1lbnQKICAgICAqICBDb3B5IGFuIFhNTCBET00gZWxlbWVudC4KICAgICAqCiAgICAgKiAgVGhpcyBmdW5jdGlvbiBjb3BpZXMgYSBET00gZWxlbWVudCBhbmQgYWxsIGl0cyBkZXNjZW5kYW50cyBhbmQgcmV0dXJucwogICAgICogIHRoZSBuZXcgY29weS4KICAgICAqCiAgICAgKiAgUGFyYW1ldGVyczoKICAgICAqICAgIChYTUxFbGVtZW50KSBlbGVtIC0gQSBET00gZWxlbWVudC4KICAgICAqCiAgICAgKiAgUmV0dXJuczoKICAgICAqICAgIEEgbmV3LCBjb3BpZWQgRE9NIGVsZW1lbnQgdHJlZS4KICAgICAqLwogICAgY29weUVsZW1lbnQ6IGZ1bmN0aW9uIChlbGVtKQogICAgewogICAgICAgIHZhciBpLCBlbDsKICAgICAgICBpZiAoZWxlbS5ub2RlVHlwZSA9PSBTdHJvcGhlLkVsZW1lbnRUeXBlLk5PUk1BTCkgewogICAgICAgICAgICBlbCA9IFN0cm9waGUueG1sRWxlbWVudChlbGVtLnRhZ05hbWUpOwoKICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGVsZW0uYXR0cmlidXRlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgZWwuc2V0QXR0cmlidXRlKGVsZW0uYXR0cmlidXRlc1tpXS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW0uYXR0cmlidXRlc1tpXS52YWx1ZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBlbGVtLmNoaWxkTm9kZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGVsLmFwcGVuZENoaWxkKFN0cm9waGUuY29weUVsZW1lbnQoZWxlbS5jaGlsZE5vZGVzW2ldKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKGVsZW0ubm9kZVR5cGUgPT0gU3Ryb3BoZS5FbGVtZW50VHlwZS5URVhUKSB7CiAgICAgICAgICAgIGVsID0gU3Ryb3BoZS54bWxHZW5lcmF0b3IoKS5jcmVhdGVUZXh0Tm9kZShlbGVtLm5vZGVWYWx1ZSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZWw7CiAgICB9LAoKCiAgICAvKiogRnVuY3Rpb246IGNyZWF0ZUh0bWwKICAgICAqICBDb3B5IGFuIEhUTUwgRE9NIGVsZW1lbnQgaW50byBhbiBYTUwgRE9NLgogICAgICoKICAgICAqICBUaGlzIGZ1bmN0aW9uIGNvcGllcyBhIERPTSBlbGVtZW50IGFuZCBhbGwgaXRzIGRlc2NlbmRhbnRzIGFuZCByZXR1cm5zCiAgICAgKiAgdGhlIG5ldyBjb3B5LgogICAgICoKICAgICAqICBQYXJhbWV0ZXJzOgogICAgICogICAgKEhUTUxFbGVtZW50KSBlbGVtIC0gQSBET00gZWxlbWVudC4KICAgICAqCiAgICAgKiAgUmV0dXJuczoKICAgICAqICAgIEEgbmV3LCBjb3BpZWQgRE9NIGVsZW1lbnQgdHJlZS4KICAgICAqLwogICAgY3JlYXRlSHRtbDogZnVuY3Rpb24gKGVsZW0pCiAgICB7CiAgICAgICAgdmFyIGksIGVsLCBqLCB0YWcsIGF0dHJpYnV0ZSwgdmFsdWUsIGNzcywgY3NzQXR0cnMsIGF0dHIsIGNzc05hbWUsIGNzc1ZhbHVlOwogICAgICAgIGlmIChlbGVtLm5vZGVUeXBlID09IFN0cm9waGUuRWxlbWVudFR5cGUuTk9STUFMKSB7CiAgICAgICAgICAgIHRhZyA9IGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgaWYoU3Ryb3BoZS5YSFRNTC52YWxpZFRhZyh0YWcpKSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGVsID0gU3Ryb3BoZS54bWxFbGVtZW50KHRhZyk7CiAgICAgICAgICAgICAgICAgICAgZm9yKGkgPSAwOyBpIDwgU3Ryb3BoZS5YSFRNTC5hdHRyaWJ1dGVzW3RhZ10ubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlID0gU3Ryb3BoZS5YSFRNTC5hdHRyaWJ1dGVzW3RhZ11baV07CiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gZWxlbS5nZXRBdHRyaWJ1dGUoYXR0cmlidXRlKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYodHlwZW9mIHZhbHVlID09ICd1bmRlZmluZWQnIHx8IHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSAnJyB8fCB2YWx1ZSA9PT0gZmFsc2UgfHwgdmFsdWUgPT09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGF0dHJpYnV0ZSA9PSAnc3R5bGUnICYmIHR5cGVvZiB2YWx1ZSA9PSAnb2JqZWN0JykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYodHlwZW9mIHZhbHVlLmNzc1RleHQgIT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHZhbHVlLmNzc1RleHQ7IC8vIHdlJ3JlIGRlYWxpbmcgd2l0aCBJRSwgbmVlZCB0byBnZXQgQ1NTIG91dAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGZpbHRlciBvdXQgaW52YWxpZCBjc3Mgc3R5bGVzCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGF0dHJpYnV0ZSA9PSAnc3R5bGUnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjc3MgPSBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNzc0F0dHJzID0gdmFsdWUuc3BsaXQoJzsnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcihqID0gMDsgaiA8IGNzc0F0dHJzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0ciA9IGNzc0F0dHJzW2pdLnNwbGl0KCc6Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3NzTmFtZSA9IGF0dHJbMF0ucmVwbGFjZSgvXlxzKi8sICIiKS5yZXBsYWNlKC9ccyokLywgIiIpLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoU3Ryb3BoZS5YSFRNTC52YWxpZENTUyhjc3NOYW1lKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjc3NWYWx1ZSA9IGF0dHJbMV0ucmVwbGFjZSgvXlxzKi8sICIiKS5yZXBsYWNlKC9ccyokLywgIiIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjc3MucHVzaChjc3NOYW1lICsgJzogJyArIGNzc1ZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihjc3MubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gY3NzLmpvaW4oJzsgJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWwuc2V0QXR0cmlidXRlKGF0dHJpYnV0ZSwgdmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWwuc2V0QXR0cmlidXRlKGF0dHJpYnV0ZSwgdmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgZWxlbS5jaGlsZE5vZGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsLmFwcGVuZENoaWxkKFN0cm9waGUuY3JlYXRlSHRtbChlbGVtLmNoaWxkTm9kZXNbaV0pKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGNhdGNoKGUpIHsgLy8gaW52YWxpZCBlbGVtZW50cwogICAgICAgICAgICAgICAgICBlbCA9IFN0cm9waGUueG1sVGV4dE5vZGUoJycpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZWwgPSBTdHJvcGhlLnhtbEdlbmVyYXRvcigpLmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTsKICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBlbGVtLmNoaWxkTm9kZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBlbC5hcHBlbmRDaGlsZChTdHJvcGhlLmNyZWF0ZUh0bWwoZWxlbS5jaGlsZE5vZGVzW2ldKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKGVsZW0ubm9kZVR5cGUgPT0gU3Ryb3BoZS5FbGVtZW50VHlwZS5GUkFHTUVOVCkgewogICAgICAgICAgICBlbCA9IFN0cm9waGUueG1sR2VuZXJhdG9yKCkuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpOwogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgZWxlbS5jaGlsZE5vZGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBlbC5hcHBlbmRDaGlsZChTdHJvcGhlLmNyZWF0ZUh0bWwoZWxlbS5jaGlsZE5vZGVzW2ldKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKGVsZW0ubm9kZVR5cGUgPT0gU3Ryb3BoZS5FbGVtZW50VHlwZS5URVhUKSB7CiAgICAgICAgICAgIGVsID0gU3Ryb3BoZS54bWxUZXh0Tm9kZShlbGVtLm5vZGVWYWx1ZSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZWw7CiAgICB9LAoKICAgIC8qKiBGdW5jdGlvbjogZXNjYXBlTm9kZQogICAgICogIEVzY2FwZSB0aGUgbm9kZSBwYXJ0IChhbHNvIGNhbGxlZCBsb2NhbCBwYXJ0KSBvZiBhIEpJRC4KICAgICAqCiAgICAgKiAgUGFyYW1ldGVyczoKICAgICAqICAgIChTdHJpbmcpIG5vZGUgLSBBIG5vZGUgKG9yIGxvY2FsIHBhcnQpLgogICAgICoKICAgICAqICBSZXR1cm5zOgogICAgICogICAgQW4gZXNjYXBlZCBub2RlIChvciBsb2NhbCBwYXJ0KS4KICAgICAqLwogICAgZXNjYXBlTm9kZTogZnVuY3Rpb24gKG5vZGUpCiAgICB7CiAgICAgICAgcmV0dXJuIG5vZGUucmVwbGFjZSgvXlxzK3xccyskL2csICcnKQogICAgICAgICAgICAucmVwbGFjZSgvXFwvZywgICJcXDVjIikKICAgICAgICAgICAgLnJlcGxhY2UoLyAvZywgICAiXFwyMCIpCiAgICAgICAgICAgIC5yZXBsYWNlKC9cIi9nLCAgIlxcMjIiKQogICAgICAgICAgICAucmVwbGFjZSgvXCYvZywgICJcXDI2IikKICAgICAgICAgICAgLnJlcGxhY2UoL1wnL2csICAiXFwyNyIpCiAgICAgICAgICAgIC5yZXBsYWNlKC9cLy9nLCAgIlxcMmYiKQogICAgICAgICAgICAucmVwbGFjZSgvOi9nLCAgICJcXDNhIikKICAgICAgICAgICAgLnJlcGxhY2UoLzwvZywgICAiXFwzYyIpCiAgICAgICAgICAgIC5yZXBsYWNlKC8+L2csICAgIlxcM2UiKQogICAgICAgICAgICAucmVwbGFjZSgvQC9nLCAgICJcXDQwIik7CiAgICB9LAoKICAgIC8qKiBGdW5jdGlvbjogdW5lc2NhcGVOb2RlCiAgICAgKiAgVW5lc2NhcGUgYSBub2RlIHBhcnQgKGFsc28gY2FsbGVkIGxvY2FsIHBhcnQpIG9mIGEgSklELgogICAgICoKICAgICAqICBQYXJhbWV0ZXJzOgogICAgICogICAgKFN0cmluZykgbm9kZSAtIEEgbm9kZSAob3IgbG9jYWwgcGFydCkuCiAgICAgKgogICAgICogIFJldHVybnM6CiAgICAgKiAgICBBbiB1bmVzY2FwZWQgbm9kZSAob3IgbG9jYWwgcGFydCkuCiAgICAgKi8KICAgIHVuZXNjYXBlTm9kZTogZnVuY3Rpb24gKG5vZGUpCiAgICB7CiAgICAgICAgcmV0dXJuIG5vZGUucmVwbGFjZSgvXFwyMC9nLCAiICIpCiAgICAgICAgICAgIC5yZXBsYWNlKC9cXDIyL2csICciJykKICAgICAgICAgICAgLnJlcGxhY2UoL1xcMjYvZywgIiYiKQogICAgICAgICAgICAucmVwbGFjZSgvXFwyNy9nLCAiJyIpCiAgICAgICAgICAgIC5yZXBsYWNlKC9cXDJmL2csICIvIikKICAgICAgICAgICAgLnJlcGxhY2UoL1xcM2EvZywgIjoiKQogICAgICAgICAgICAucmVwbGFjZSgvXFwzYy9nLCAiPCIpCiAgICAgICAgICAgIC5yZXBsYWNlKC9cXDNlL2csICI+IikKICAgICAgICAgICAgLnJlcGxhY2UoL1xcNDAvZywgIkAiKQogICAgICAgICAgICAucmVwbGFjZSgvXFw1Yy9nLCAiXFwiKTsKICAgIH0sCgogICAgLyoqIEZ1bmN0aW9uOiBnZXROb2RlRnJvbUppZAogICAgICogIEdldCB0aGUgbm9kZSBwb3J0aW9uIG9mIGEgSklEIFN0cmluZy4KICAgICAqCiAgICAgKiAgUGFyYW1ldGVyczoKICAgICAqICAgIChTdHJpbmcpIGppZCAtIEEgSklELgogICAgICoKICAgICAqICBSZXR1cm5zOgogICAgICogICAgQSBTdHJpbmcgY29udGFpbmluZyB0aGUgbm9kZS4KICAgICAqLwogICAgZ2V0Tm9kZUZyb21KaWQ6IGZ1bmN0aW9uIChqaWQpCiAgICB7CiAgICAgICAgaWYgKGppZC5pbmRleE9mKCJAIikgPCAwKSB7IHJldHVybiBudWxsOyB9CiAgICAgICAgcmV0dXJuIGppZC5zcGxpdCgiQCIpWzBdOwogICAgfSwKCiAgICAvKiogRnVuY3Rpb246IGdldERvbWFpbkZyb21KaWQKICAgICAqICBHZXQgdGhlIGRvbWFpbiBwb3J0aW9uIG9mIGEgSklEIFN0cmluZy4KICAgICAqCiAgICAgKiAgUGFyYW1ldGVyczoKICAgICAqICAgIChTdHJpbmcpIGppZCAtIEEgSklELgogICAgICoKICAgICAqICBSZXR1cm5zOgogICAgICogICAgQSBTdHJpbmcgY29udGFpbmluZyB0aGUgZG9tYWluLgogICAgICovCiAgICBnZXREb21haW5Gcm9tSmlkOiBmdW5jdGlvbiAoamlkKQogICAgewogICAgICAgIHZhciBiYXJlID0gU3Ryb3BoZS5nZXRCYXJlSmlkRnJvbUppZChqaWQpOwogICAgICAgIGlmIChiYXJlLmluZGV4T2YoIkAiKSA8IDApIHsKICAgICAgICAgICAgcmV0dXJuIGJhcmU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFyIHBhcnRzID0gYmFyZS5zcGxpdCgiQCIpOwogICAgICAgICAgICBwYXJ0cy5zcGxpY2UoMCwgMSk7CiAgICAgICAgICAgIHJldHVybiBwYXJ0cy5qb2luKCdAJyk7CiAgICAgICAgfQogICAgfSwKCiAgICAvKiogRnVuY3Rpb246IGdldFJlc291cmNlRnJvbUppZAogICAgICogIEdldCB0aGUgcmVzb3VyY2UgcG9ydGlvbiBvZiBhIEpJRCBTdHJpbmcuCiAgICAgKgogICAgICogIFBhcmFtZXRlcnM6CiAgICAgKiAgICAoU3RyaW5nKSBqaWQgLSBBIEpJRC4KICAgICAqCiAgICAgKiAgUmV0dXJuczoKICAgICAqICAgIEEgU3RyaW5nIGNvbnRhaW5pbmcgdGhlIHJlc291cmNlLgogICAgICovCiAgICBnZXRSZXNvdXJjZUZyb21KaWQ6IGZ1bmN0aW9uIChqaWQpCiAgICB7CiAgICAgICAgdmFyIHMgPSBqaWQuc3BsaXQoIi8iKTsKICAgICAgICBpZiAocy5sZW5ndGggPCAyKSB7IHJldHVybiBudWxsOyB9CiAgICAgICAgcy5zcGxpY2UoMCwgMSk7CiAgICAgICAgcmV0dXJuIHMuam9pbignLycpOwogICAgfSwKCiAgICAvKiogRnVuY3Rpb246IGdldEJhcmVKaWRGcm9tSmlkCiAgICAgKiAgR2V0IHRoZSBiYXJlIEpJRCBmcm9tIGEgSklEIFN0cmluZy4KICAgICAqCiAgICAgKiAgUGFyYW1ldGVyczoKICAgICAqICAgIChTdHJpbmcpIGppZCAtIEEgSklELgogICAgICoKICAgICAqICBSZXR1cm5zOgogICAgICogICAgQSBTdHJpbmcgY29udGFpbmluZyB0aGUgYmFyZSBKSUQuCiAgICAgKi8KICAgIGdldEJhcmVKaWRGcm9tSmlkOiBmdW5jdGlvbiAoamlkKQogICAgewogICAgICAgIHJldHVybiBqaWQgPyBqaWQuc3BsaXQoIi8iKVswXSA6IG51bGw7CiAgICB9LAoKICAgIC8qKiBGdW5jdGlvbjogbG9nCiAgICAgKiAgVXNlciBvdmVycmlkZWFibGUgbG9nZ2luZyBmdW5jdGlvbi4KICAgICAqCiAgICAgKiAgVGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgd2hlbmV2ZXIgdGhlIFN0cm9waGUgbGlicmFyeSBjYWxscyBhbnkKICAgICAqICBvZiB0aGUgbG9nZ2luZyBmdW5jdGlvbnMuICBUaGUgZGVmYXVsdCBpbXBsZW1lbnRhdGlvbiBvZiB0aGlzCiAgICAgKiAgZnVuY3Rpb24gZG9lcyBub3RoaW5nLiAgSWYgY2xpZW50IGNvZGUgd2lzaGVzIHRvIGhhbmRsZSB0aGUgbG9nZ2luZwogICAgICogIG1lc3NhZ2VzLCBpdCBzaG91bGQgb3ZlcnJpZGUgdGhpcyB3aXRoCiAgICAgKiAgPiBTdHJvcGhlLmxvZyA9IGZ1bmN0aW9uIChsZXZlbCwgbXNnKSB7CiAgICAgKiAgPiAgICh1c2VyIGNvZGUgaGVyZSkKICAgICAqICA+IH07CiAgICAgKgogICAgICogIFBsZWFzZSBub3RlIHRoYXQgZGF0YSBzZW50IGFuZCByZWNlaXZlZCBvdmVyIHRoZSB3aXJlIGlzIGxvZ2dlZAogICAgICogIHZpYSBTdHJvcGhlLkNvbm5lY3Rpb24ucmF3SW5wdXQoKSBhbmQgU3Ryb3BoZS5Db25uZWN0aW9uLnJhd091dHB1dCgpLgogICAgICoKICAgICAqICBUaGUgZGlmZmVyZW50IGxldmVscyBhbmQgdGhlaXIgbWVhbmluZ3MgYXJlCiAgICAgKgogICAgICogICAgREVCVUcgLSBNZXNzYWdlcyB1c2VmdWwgZm9yIGRlYnVnZ2luZyBwdXJwb3Nlcy4KICAgICAqICAgIElORk8gLSBJbmZvcm1hdGlvbmFsIG1lc3NhZ2VzLiAgVGhpcyBpcyBtb3N0bHkgaW5mb3JtYXRpb24gbGlrZQogICAgICogICAgICAnZGlzY29ubmVjdCB3YXMgY2FsbGVkJyBvciAnU0FTTCBhdXRoIHN1Y2NlZWRlZCcuCiAgICAgKiAgICBXQVJOIC0gV2FybmluZ3MgYWJvdXQgcG90ZW50aWFsIHByb2JsZW1zLiAgVGhpcyBpcyBtb3N0bHkgdXNlZAogICAgICogICAgICB0byByZXBvcnQgdHJhbnNpZW50IGNvbm5lY3Rpb24gZXJyb3JzIGxpa2UgcmVxdWVzdCB0aW1lb3V0cy4KICAgICAqICAgIEVSUk9SIC0gU29tZSBlcnJvciBvY2N1cnJlZC4KICAgICAqICAgIEZBVEFMIC0gQSBub24tcmVjb3ZlcmFibGUgZmF0YWwgZXJyb3Igb2NjdXJyZWQuCiAgICAgKgogICAgICogIFBhcmFtZXRlcnM6CiAgICAgKiAgICAoSW50ZWdlcikgbGV2ZWwgLSBUaGUgbG9nIGxldmVsIG9mIHRoZSBsb2cgbWVzc2FnZS4gIFRoaXMgd2lsbAogICAgICogICAgICBiZSBvbmUgb2YgdGhlIHZhbHVlcyBpbiBTdHJvcGhlLkxvZ0xldmVsLgogICAgICogICAgKFN0cmluZykgbXNnIC0gVGhlIGxvZyBtZXNzYWdlLgogICAgICovCiAgICAvKiBqc2hpbnQgaWdub3JlOnN0YXJ0ICovCiAgICBsb2c6IGZ1bmN0aW9uIChsZXZlbCwgbXNnKQogICAgewogICAgICAgIHJldHVybjsKICAgIH0sCiAgICAvKiBqc2hpbnQgaWdub3JlOmVuZCAqLwoKICAgIC8qKiBGdW5jdGlvbjogZGVidWcKICAgICAqICBMb2cgYSBtZXNzYWdlIGF0IHRoZSBTdHJvcGhlLkxvZ0xldmVsLkRFQlVHIGxldmVsLgogICAgICoKICAgICAqICBQYXJhbWV0ZXJzOgogICAgICogICAgKFN0cmluZykgbXNnIC0gVGhlIGxvZyBtZXNzYWdlLgogICAgICovCiAgICBkZWJ1ZzogZnVuY3Rpb24obXNnKQogICAgewogICAgICAgIHRoaXMubG9nKHRoaXMuTG9nTGV2ZWwuREVCVUcsIG1zZyk7CiAgICB9LAoKICAgIC8qKiBGdW5jdGlvbjogaW5mbwogICAgICogIExvZyBhIG1lc3NhZ2UgYXQgdGhlIFN0cm9waGUuTG9nTGV2ZWwuSU5GTyBsZXZlbC4KICAgICAqCiAgICAgKiAgUGFyYW1ldGVyczoKICAgICAqICAgIChTdHJpbmcpIG1zZyAtIFRoZSBsb2cgbWVzc2FnZS4KICAgICAqLwogICAgaW5mbzogZnVuY3Rpb24gKG1zZykKICAgIHsKICAgICAgICB0aGlzLmxvZyh0aGlzLkxvZ0xldmVsLklORk8sIG1zZyk7CiAgICB9LAoKICAgIC8qKiBGdW5jdGlvbjogd2FybgogICAgICogIExvZyBhIG1lc3NhZ2UgYXQgdGhlIFN0cm9waGUuTG9nTGV2ZWwuV0FSTiBsZXZlbC4KICAgICAqCiAgICAgKiAgUGFyYW1ldGVyczoKICAgICAqICAgIChTdHJpbmcpIG1zZyAtIFRoZSBsb2cgbWVzc2FnZS4KICAgICAqLwogICAgd2FybjogZnVuY3Rpb24gKG1zZykKICAgIHsKICAgICAgICB0aGlzLmxvZyh0aGlzLkxvZ0xldmVsLldBUk4sIG1zZyk7CiAgICB9LAoKICAgIC8qKiBGdW5jdGlvbjogZXJyb3IKICAgICAqICBMb2cgYSBtZXNzYWdlIGF0IHRoZSBTdHJvcGhlLkxvZ0xldmVsLkVSUk9SIGxldmVsLgogICAgICoKICAgICAqICBQYXJhbWV0ZXJzOgogICAgICogICAgKFN0cmluZykgbXNnIC0gVGhlIGxvZyBtZXNzYWdlLgogICAgICovCiAgICBlcnJvcjogZnVuY3Rpb24gKG1zZykKICAgIHsKICAgICAgICB0aGlzLmxvZyh0aGlzLkxvZ0xldmVsLkVSUk9SLCBtc2cpOwogICAgfSwKCiAgICAvKiogRnVuY3Rpb246IGZhdGFsCiAgICAgKiAgTG9nIGEgbWVzc2FnZSBhdCB0aGUgU3Ryb3BoZS5Mb2dMZXZlbC5GQVRBTCBsZXZlbC4KICAgICAqCiAgICAgKiAgUGFyYW1ldGVyczoKICAgICAqICAgIChTdHJpbmcpIG1zZyAtIFRoZSBsb2cgbWVzc2FnZS4KICAgICAqLwogICAgZmF0YWw6IGZ1bmN0aW9uIChtc2cpCiAgICB7CiAgICAgICAgdGhpcy5sb2codGhpcy5Mb2dMZXZlbC5GQVRBTCwgbXNnKTsKICAgIH0sCgogICAgLyoqIEZ1bmN0aW9uOiBzZXJpYWxpemUKICAgICAqICBSZW5kZXIgYSBET00gZWxlbWVudCBhbmQgYWxsIGRlc2NlbmRhbnRzIHRvIGEgU3RyaW5nLgogICAgICoKICAgICAqICBQYXJhbWV0ZXJzOgogICAgICogICAgKFhNTEVsZW1lbnQpIGVsZW0gLSBBIERPTSBlbGVtZW50LgogICAgICoKICAgICAqICBSZXR1cm5zOgogICAgICogICAgVGhlIHNlcmlhbGl6ZWQgZWxlbWVudCB0cmVlIGFzIGEgU3RyaW5nLgogICAgICovCiAgICBzZXJpYWxpemU6IGZ1bmN0aW9uIChlbGVtKQogICAgewogICAgICAgIHZhciByZXN1bHQ7CgogICAgICAgIGlmICghZWxlbSkgeyByZXR1cm4gbnVsbDsgfQoKICAgICAgICBpZiAodHlwZW9mKGVsZW0udHJlZSkgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgZWxlbSA9IGVsZW0udHJlZSgpOwogICAgICAgIH0KCiAgICAgICAgdmFyIG5vZGVOYW1lID0gZWxlbS5ub2RlTmFtZTsKICAgICAgICB2YXIgaSwgY2hpbGQ7CgogICAgICAgIGlmIChlbGVtLmdldEF0dHJpYnV0ZSgiX3JlYWxuYW1lIikpIHsKICAgICAgICAgICAgbm9kZU5hbWUgPSBlbGVtLmdldEF0dHJpYnV0ZSgiX3JlYWxuYW1lIik7CiAgICAgICAgfQoKICAgICAgICByZXN1bHQgPSAiPCIgKyBub2RlTmFtZTsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgZWxlbS5hdHRyaWJ1dGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgIGlmKGVsZW0uYXR0cmlidXRlc1tpXS5ub2RlTmFtZSAhPSAiX3JlYWxuYW1lIikgewogICAgICAgICAgICAgICAgIHJlc3VsdCArPSAiICIgKyBlbGVtLmF0dHJpYnV0ZXNbaV0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSArCiAgICAgICAgICAgICAgICAiPSciICsgZWxlbS5hdHRyaWJ1dGVzW2ldLnZhbHVlCiAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoLyYvZywgIiZhbXA7IikKICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvXCcvZywgIiZhcG9zOyIpCiAgICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoLz4vZywgIiZndDsiKQogICAgICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC88L2csICImbHQ7IikgKyAiJyI7CiAgICAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChlbGVtLmNoaWxkTm9kZXMubGVuZ3RoID4gMCkgewogICAgICAgICAgICByZXN1bHQgKz0gIj4iOwogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgZWxlbS5jaGlsZE5vZGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBjaGlsZCA9IGVsZW0uY2hpbGROb2Rlc1tpXTsKICAgICAgICAgICAgICAgIHN3aXRjaCggY2hpbGQubm9kZVR5cGUgKXsKICAgICAgICAgICAgICAgICAgY2FzZSBTdHJvcGhlLkVsZW1lbnRUeXBlLk5PUk1BTDoKICAgICAgICAgICAgICAgICAgICAvLyBub3JtYWwgZWxlbWVudCwgc28gcmVjdXJzZQogICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBTdHJvcGhlLnNlcmlhbGl6ZShjaGlsZCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIGNhc2UgU3Ryb3BoZS5FbGVtZW50VHlwZS5URVhUOgogICAgICAgICAgICAgICAgICAgIC8vIHRleHQgZWxlbWVudCB0byBlc2NhcGUgdmFsdWVzCiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IFN0cm9waGUueG1sZXNjYXBlKGNoaWxkLm5vZGVWYWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIGNhc2UgU3Ryb3BoZS5FbGVtZW50VHlwZS5DREFUQToKICAgICAgICAgICAgICAgICAgICAvLyBjZGF0YSBzZWN0aW9uIHNvIGRvbid0IGVzY2FwZSB2YWx1ZXMKICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gIjwhW0NEQVRBWyIrY2hpbGQubm9kZVZhbHVlKyJdXT4iOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJlc3VsdCArPSAiPC8iICsgbm9kZU5hbWUgKyAiPiI7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmVzdWx0ICs9ICIvPiI7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgfSwKCiAgICAvKiogUHJpdmF0ZVZhcmlhYmxlOiBfcmVxdWVzdElkCiAgICAgKiAgX1ByaXZhdGVfIHZhcmlhYmxlIHRoYXQga2VlcHMgdHJhY2sgb2YgdGhlIHJlcXVlc3QgaWRzIGZvcgogICAgICogIGNvbm5lY3Rpb25zLgogICAgICovCiAgICBfcmVxdWVzdElkOiAwLAoKICAgIC8qKiBQcml2YXRlVmFyaWFibGU6IFN0cm9waGUuY29ubmVjdGlvblBsdWdpbnMKICAgICAqICBfUHJpdmF0ZV8gdmFyaWFibGUgVXNlZCB0byBzdG9yZSBwbHVnaW4gbmFtZXMgdGhhdCBuZWVkCiAgICAgKiAgaW5pdGlhbGl6YXRpb24gb24gU3Ryb3BoZS5Db25uZWN0aW9uIGNvbnN0cnVjdGlvbi4KICAgICAqLwogICAgX2Nvbm5lY3Rpb25QbHVnaW5zOiB7fSwKCiAgICAvKiogRnVuY3Rpb246IGFkZENvbm5lY3Rpb25QbHVnaW4KICAgICAqICBFeHRlbmRzIHRoZSBTdHJvcGhlLkNvbm5lY3Rpb24gb2JqZWN0IHdpdGggdGhlIGdpdmVuIHBsdWdpbi4KICAgICAqCiAgICAgKiAgUGFyYW1ldGVyczoKICAgICAqICAgIChTdHJpbmcpIG5hbWUgLSBUaGUgbmFtZSBvZiB0aGUgZXh0ZW5zaW9uLgogICAgICogICAgKE9iamVjdCkgcHR5cGUgLSBUaGUgcGx1Z2luJ3MgcHJvdG90eXBlLgogICAgICovCiAgICBhZGRDb25uZWN0aW9uUGx1Z2luOiBmdW5jdGlvbiAobmFtZSwgcHR5cGUpCiAgICB7CiAgICAgICAgU3Ryb3BoZS5fY29ubmVjdGlvblBsdWdpbnNbbmFtZV0gPSBwdHlwZTsKICAgIH0KfTsKCi8qKiBDbGFzczogU3Ryb3BoZS5CdWlsZGVyCiAqICBYTUwgRE9NIGJ1aWxkZXIuCiAqCiAqICBUaGlzIG9iamVjdCBwcm92aWRlcyBhbiBpbnRlcmZhY2Ugc2ltaWxhciB0byBKUXVlcnkgYnV0IGZvciBidWlsZGluZwogKiAgRE9NIGVsZW1lbnQgZWFzaWx5IGFuZCByYXBpZGx5LiAgQWxsIHRoZSBmdW5jdGlvbnMgZXhjZXB0IGZvciB0b1N0cmluZygpCiAqICBhbmQgdHJlZSgpIHJldHVybiB0aGUgb2JqZWN0LCBzbyBjYWxscyBjYW4gYmUgY2hhaW5lZC4gIEhlcmUncyBhbgogKiAgZXhhbXBsZSB1c2luZyB0aGUgJGlxKCkgYnVpbGRlciBoZWxwZXIuCiAqICA+ICRpcSh7dG86ICd5b3UnLCBmcm9tOiAnbWUnLCB0eXBlOiAnZ2V0JywgaWQ6ICcxJ30pCiAqICA+ICAgICAuYygncXVlcnknLCB7eG1sbnM6ICdzdHJvcGhlOmV4YW1wbGUnfSkKICogID4gICAgIC5jKCdleGFtcGxlJykKICogID4gICAgIC50b1N0cmluZygpCiAqICBUaGUgYWJvdmUgZ2VuZXJhdGVzIHRoaXMgWE1MIGZyYWdtZW50CiAqICA+IDxpcSB0bz0neW91JyBmcm9tPSdtZScgdHlwZT0nZ2V0JyBpZD0nMSc+CiAqICA+ICAgPHF1ZXJ5IHhtbG5zPSdzdHJvcGhlOmV4YW1wbGUnPgogKiAgPiAgICAgPGV4YW1wbGUvPgogKiAgPiAgIDwvcXVlcnk+CiAqICA+IDwvaXE+CiAqICBUaGUgY29ycmVzcG9uZGluZyBET00gbWFuaXB1bGF0aW9ucyB0byBnZXQgYSBzaW1pbGFyIGZyYWdtZW50IHdvdWxkIGJlCiAqICBhIGxvdCBtb3JlIHRlZGlvdXMgYW5kIHByb2JhYmx5IGludm9sdmUgc2V2ZXJhbCBoZWxwZXIgdmFyaWFibGVzLgogKgogKiAgU2luY2UgYWRkaW5nIGNoaWxkcmVuIG1ha2VzIG5ldyBvcGVyYXRpb25zIG9wZXJhdGUgb24gdGhlIGNoaWxkLCB1cCgpCiAqICBpcyBwcm92aWRlZCB0byB0cmF2ZXJzZSB1cCB0aGUgdHJlZS4gIFRvIGFkZCB0d28gY2hpbGRyZW4sIGRvCiAqICA+IGJ1aWxkZXIuYygnY2hpbGQxJywgLi4uKS51cCgpLmMoJ2NoaWxkMicsIC4uLikKICogIFRoZSBuZXh0IG9wZXJhdGlvbiBvbiB0aGUgQnVpbGRlciB3aWxsIGJlIHJlbGF0aXZlIHRvIHRoZSBzZWNvbmQgY2hpbGQuCiAqLwoKLyoqIENvbnN0cnVjdG9yOiBTdHJvcGhlLkJ1aWxkZXIKICogIENyZWF0ZSBhIFN0cm9waGUuQnVpbGRlciBvYmplY3QuCiAqCiAqICBUaGUgYXR0cmlidXRlcyBzaG91bGQgYmUgcGFzc2VkIGluIG9iamVjdCBub3RhdGlvbi4gIEZvciBleGFtcGxlCiAqICA+IHZhciBiID0gbmV3IEJ1aWxkZXIoJ21lc3NhZ2UnLCB7dG86ICd5b3UnLCBmcm9tOiAnbWUnfSk7CiAqICBvcgogKiAgPiB2YXIgYiA9IG5ldyBCdWlsZGVyKCdtZXNzc2FnZScsIHsneG1sOmxhbmcnOiAnZW4nfSk7CiAqCiAqICBQYXJhbWV0ZXJzOgogKiAgICAoU3RyaW5nKSBuYW1lIC0gVGhlIG5hbWUgb2YgdGhlIHJvb3QgZWxlbWVudC4KICogICAgKE9iamVjdCkgYXR0cnMgLSBUaGUgYXR0cmlidXRlcyBmb3IgdGhlIHJvb3QgZWxlbWVudCBpbiBvYmplY3Qgbm90YXRpb24uCiAqCiAqICBSZXR1cm5zOgogKiAgICBBIG5ldyBTdHJvcGhlLkJ1aWxkZXIuCiAqLwpTdHJvcGhlLkJ1aWxkZXIgPSBmdW5jdGlvbiAobmFtZSwgYXR0cnMpCnsKICAgIC8vIFNldCBjb3JyZWN0IG5hbWVzcGFjZSBmb3IgamFiYmVyOmNsaWVudCBlbGVtZW50cwogICAgaWYgKG5hbWUgPT0gInByZXNlbmNlIiB8fCBuYW1lID09ICJtZXNzYWdlIiB8fCBuYW1lID09ICJpcSIpIHsKICAgICAgICBpZiAoYXR0cnMgJiYgIWF0dHJzLnhtbG5zKSB7CiAgICAgICAgICAgIGF0dHJzLnhtbG5zID0gU3Ryb3BoZS5OUy5DTElFTlQ7CiAgICAgICAgfSBlbHNlIGlmICghYXR0cnMpIHsKICAgICAgICAgICAgYXR0cnMgPSB7eG1sbnM6IFN0cm9waGUuTlMuQ0xJRU5UfTsKICAgICAgICB9CiAgICB9CgogICAgLy8gSG9sZHMgdGhlIHRyZWUgYmVpbmcgYnVpbHQuCiAgICB0aGlzLm5vZGVUcmVlID0gU3Ryb3BoZS54bWxFbGVtZW50KG5hbWUsIGF0dHJzKTsKCiAgICAvLyBQb2ludHMgdG8gdGhlIGN1cnJlbnQgb3BlcmF0aW9uIG5vZGUuCiAgICB0aGlzLm5vZGUgPSB0aGlzLm5vZGVUcmVlOwp9OwoKU3Ryb3BoZS5CdWlsZGVyLnByb3RvdHlwZSA9IHsKICAgIC8qKiBGdW5jdGlvbjogdHJlZQogICAgICogIFJldHVybiB0aGUgRE9NIHRyZWUuCiAgICAgKgogICAgICogIFRoaXMgZnVuY3Rpb24gcmV0dXJucyB0aGUgY3VycmVudCBET00gdHJlZSBhcyBhbiBlbGVtZW50IG9iamVjdC4gIFRoaXMKICAgICAqICBpcyBzdWl0YWJsZSBmb3IgcGFzc2luZyB0byBmdW5jdGlvbnMgbGlrZSBTdHJvcGhlLkNvbm5lY3Rpb24uc2VuZCgpLgogICAgICoKICAgICAqICBSZXR1cm5zOgogICAgICogICAgVGhlIERPTSB0cmVlIGFzIGEgZWxlbWVudCBvYmplY3QuCiAgICAgKi8KICAgIHRyZWU6IGZ1bmN0aW9uICgpCiAgICB7CiAgICAgICAgcmV0dXJuIHRoaXMubm9kZVRyZWU7CiAgICB9LAoKICAgIC8qKiBGdW5jdGlvbjogdG9TdHJpbmcKICAgICAqICBTZXJpYWxpemUgdGhlIERPTSB0cmVlIHRvIGEgU3RyaW5nLgogICAgICoKICAgICAqICBUaGlzIGZ1bmN0aW9uIHJldHVybnMgYSBzdHJpbmcgc2VyaWFsaXphdGlvbiBvZiB0aGUgY3VycmVudCBET00KICAgICAqICB0cmVlLiAgSXQgaXMgb2Z0ZW4gdXNlZCBpbnRlcm5hbGx5IHRvIHBhc3MgZGF0YSB0byBhCiAgICAgKiAgU3Ryb3BoZS5SZXF1ZXN0IG9iamVjdC4KICAgICAqCiAgICAgKiAgUmV0dXJuczoKICAgICAqICAgIFRoZSBzZXJpYWxpemVkIERPTSB0cmVlIGluIGEgU3RyaW5nLgogICAgICovCiAgICB0b1N0cmluZzogZnVuY3Rpb24gKCkKICAgIHsKICAgICAgICByZXR1cm4gU3Ryb3BoZS5zZXJpYWxpemUodGhpcy5ub2RlVHJlZSk7CiAgICB9LAoKICAgIC8qKiBGdW5jdGlvbjogdXAKICAgICAqICBNYWtlIHRoZSBjdXJyZW50IHBhcmVudCBlbGVtZW50IHRoZSBuZXcgY3VycmVudCBlbGVtZW50LgogICAgICoKICAgICAqICBUaGlzIGZ1bmN0aW9uIGlzIG9mdGVuIHVzZWQgYWZ0ZXIgYygpIHRvIHRyYXZlcnNlIGJhY2sgdXAgdGhlIHRyZWUuCiAgICAgKiAgRm9yIGV4YW1wbGUsIHRvIGFkZCB0d28gY2hpbGRyZW4gdG8gdGhlIHNhbWUgZWxlbWVudAogICAgICogID4gYnVpbGRlci5jKCdjaGlsZDEnLCB7fSkudXAoKS5jKCdjaGlsZDInLCB7fSk7CiAgICAgKgogICAgICogIFJldHVybnM6CiAgICAgKiAgICBUaGUgU3RvcGhlLkJ1aWxkZXIgb2JqZWN0LgogICAgICovCiAgICB1cDogZnVuY3Rpb24gKCkKICAgIHsKICAgICAgICB0aGlzLm5vZGUgPSB0aGlzLm5vZGUucGFyZW50Tm9kZTsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLyoqIEZ1bmN0aW9uOiBhdHRycwogICAgICogIEFkZCBvciBtb2RpZnkgYXR0cmlidXRlcyBvZiB0aGUgY3VycmVudCBlbGVtZW50LgogICAgICoKICAgICAqICBUaGUgYXR0cmlidXRlcyBzaG91bGQgYmUgcGFzc2VkIGluIG9iamVjdCBub3RhdGlvbi4gIFRoaXMgZnVuY3Rpb24KICAgICAqICBkb2VzIG5vdCBtb3ZlIHRoZSBjdXJyZW50IGVsZW1lbnQgcG9pbnRlci4KICAgICAqCiAgICAgKiAgUGFyYW1ldGVyczoKICAgICAqICAgIChPYmplY3QpIG1vcmVhdHRycyAtIFRoZSBhdHRyaWJ1dGVzIHRvIGFkZC9tb2RpZnkgaW4gb2JqZWN0IG5vdGF0aW9uLgogICAgICoKICAgICAqICBSZXR1cm5zOgogICAgICogICAgVGhlIFN0cm9waGUuQnVpbGRlciBvYmplY3QuCiAgICAgKi8KICAgIGF0dHJzOiBmdW5jdGlvbiAobW9yZWF0dHJzKQogICAgewogICAgICAgIGZvciAodmFyIGsgaW4gbW9yZWF0dHJzKSB7CiAgICAgICAgICAgIGlmIChtb3JlYXR0cnMuaGFzT3duUHJvcGVydHkoaykpIHsKICAgICAgICAgICAgICAgIHRoaXMubm9kZS5zZXRBdHRyaWJ1dGUoaywgbW9yZWF0dHJzW2tdKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLyoqIEZ1bmN0aW9uOiBjCiAgICAgKiAgQWRkIGEgY2hpbGQgdG8gdGhlIGN1cnJlbnQgZWxlbWVudCBhbmQgbWFrZSBpdCB0aGUgbmV3IGN1cnJlbnQKICAgICAqICBlbGVtZW50LgogICAgICoKICAgICAqICBUaGlzIGZ1bmN0aW9uIG1vdmVzIHRoZSBjdXJyZW50IGVsZW1lbnQgcG9pbnRlciB0byB0aGUgY2hpbGQsCiAgICAgKiAgdW5sZXNzIHRleHQgaXMgcHJvdmlkZWQuICBJZiB5b3UgbmVlZCB0byBhZGQgYW5vdGhlciBjaGlsZCwgaXQKICAgICAqICBpcyBuZWNlc3NhcnkgdG8gdXNlIHVwKCkgdG8gZ28gYmFjayB0byB0aGUgcGFyZW50IGluIHRoZSB0cmVlLgogICAgICoKICAgICAqICBQYXJhbWV0ZXJzOgogICAgICogICAgKFN0cmluZykgbmFtZSAtIFRoZSBuYW1lIG9mIHRoZSBjaGlsZC4KICAgICAqICAgIChPYmplY3QpIGF0dHJzIC0gVGhlIGF0dHJpYnV0ZXMgb2YgdGhlIGNoaWxkIGluIG9iamVjdCBub3RhdGlvbi4KICAgICAqICAgIChTdHJpbmcpIHRleHQgLSBUaGUgdGV4dCB0byBhZGQgdG8gdGhlIGNoaWxkLgogICAgICoKICAgICAqICBSZXR1cm5zOgogICAgICogICAgVGhlIFN0cm9waGUuQnVpbGRlciBvYmplY3QuCiAgICAgKi8KICAgIGM6IGZ1bmN0aW9uIChuYW1lLCBhdHRycywgdGV4dCkKICAgIHsKICAgICAgICB2YXIgY2hpbGQgPSBTdHJvcGhlLnhtbEVsZW1lbnQobmFtZSwgYXR0cnMsIHRleHQpOwogICAgICAgIHRoaXMubm9kZS5hcHBlbmRDaGlsZChjaGlsZCk7CiAgICAgICAgaWYgKCF0ZXh0KSB7CiAgICAgICAgICAgIHRoaXMubm9kZSA9IGNoaWxkOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLyoqIEZ1bmN0aW9uOiBjbm9kZQogICAgICogIEFkZCBhIGNoaWxkIHRvIHRoZSBjdXJyZW50IGVsZW1lbnQgYW5kIG1ha2UgaXQgdGhlIG5ldyBjdXJyZW50CiAgICAgKiAgZWxlbWVudC4KICAgICAqCiAgICAgKiAgVGhpcyBmdW5jdGlvbiBpcyB0aGUgc2FtZSBhcyBjKCkgZXhjZXB0IHRoYXQgaW5zdGVhZCBvZiB1c2luZyBhCiAgICAgKiAgbmFtZSBhbmQgYW4gYXR0cmlidXRlcyBvYmplY3QgdG8gY3JlYXRlIHRoZSBjaGlsZCBpdCB1c2VzIGFuCiAgICAgKiAgZXhpc3RpbmcgRE9NIGVsZW1lbnQgb2JqZWN0LgogICAgICoKICAgICAqICBQYXJhbWV0ZXJzOgogICAgICogICAgKFhNTEVsZW1lbnQpIGVsZW0gLSBBIERPTSBlbGVtZW50LgogICAgICoKICAgICAqICBSZXR1cm5zOgogICAgICogICAgVGhlIFN0cm9waGUuQnVpbGRlciBvYmplY3QuCiAgICAgKi8KICAgIGNub2RlOiBmdW5jdGlvbiAoZWxlbSkKICAgIHsKICAgICAgICB2YXIgaW1wTm9kZTsKICAgICAgICB2YXIgeG1sR2VuID0gU3Ryb3BoZS54bWxHZW5lcmF0b3IoKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBpbXBOb2RlID0gKHhtbEdlbi5pbXBvcnROb2RlICE9PSB1bmRlZmluZWQpOwogICAgICAgIH0KICAgICAgICBjYXRjaCAoZSkgewogICAgICAgICAgICBpbXBOb2RlID0gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHZhciBuZXdFbGVtID0gaW1wTm9kZSA/CiAgICAgICAgICAgICAgICAgICAgICB4bWxHZW4uaW1wb3J0Tm9kZShlbGVtLCB0cnVlKSA6CiAgICAgICAgICAgICAgICAgICAgICBTdHJvcGhlLmNvcHlFbGVtZW50KGVsZW0pOwogICAgICAgIHRoaXMubm9kZS5hcHBlbmRDaGlsZChuZXdFbGVtKTsKICAgICAgICB0aGlzLm5vZGUgPSBuZXdFbGVtOwogICAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvKiogRnVuY3Rpb246IHQKICAgICAqICBBZGQgYSBjaGlsZCB0ZXh0IGVsZW1lbnQuCiAgICAgKgogICAgICogIFRoaXMgKmRvZXMgbm90KiBtYWtlIHRoZSBjaGlsZCB0aGUgbmV3IGN1cnJlbnQgZWxlbWVudCBzaW5jZSB0aGVyZQogICAgICogIGFyZSBubyBjaGlsZHJlbiBvZiB0ZXh0IGVsZW1lbnRzLgogICAgICoKICAgICAqICBQYXJhbWV0ZXJzOgogICAgICogICAgKFN0cmluZykgdGV4dCAtIFRoZSB0ZXh0IGRhdGEgdG8gYXBwZW5kIHRvIHRoZSBjdXJyZW50IGVsZW1lbnQuCiAgICAgKgogICAgICogIFJldHVybnM6CiAgICAgKiAgICBUaGUgU3Ryb3BoZS5CdWlsZGVyIG9iamVjdC4KICAgICAqLwogICAgdDogZnVuY3Rpb24gKHRleHQpCiAgICB7CiAgICAgICAgdmFyIGNoaWxkID0gU3Ryb3BoZS54bWxUZXh0Tm9kZSh0ZXh0KTsKICAgICAgICB0aGlzLm5vZGUuYXBwZW5kQ2hpbGQoY2hpbGQpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvKiogRnVuY3Rpb246IGgKICAgICAqICBSZXBsYWNlIGN1cnJlbnQgZWxlbWVudCBjb250ZW50cyB3aXRoIHRoZSBIVE1MIHBhc3NlZCBpbi4KICAgICAqCiAgICAgKiAgVGhpcyAqZG9lcyBub3QqIG1ha2UgdGhlIGNoaWxkIHRoZSBuZXcgY3VycmVudCBlbGVtZW50CiAgICAgKgogICAgICogIFBhcmFtZXRlcnM6CiAgICAgKiAgICAoU3RyaW5nKSBodG1sIC0gVGhlIGh0bWwgdG8gaW5zZXJ0IGFzIGNvbnRlbnRzIG9mIGN1cnJlbnQgZWxlbWVudC4KICAgICAqCiAgICAgKiAgUmV0dXJuczoKICAgICAqICAgIFRoZSBTdHJvcGhlLkJ1aWxkZXIgb2JqZWN0LgogICAgICovCiAgICBoOiBmdW5jdGlvbiAoaHRtbCkKICAgIHsKICAgICAgICB2YXIgZnJhZ21lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdib2R5Jyk7CgogICAgICAgIC8vIGZvcmNlIHRoZSBicm93c2VyIHRvIHRyeSBhbmQgZml4IGFueSBpbnZhbGlkIEhUTUwgdGFncwogICAgICAgIGZyYWdtZW50LmlubmVySFRNTCA9IGh0bWw7CgogICAgICAgIC8vIGNvcHkgY2xlYW5lZCBodG1sIGludG8gYW4geG1sIGRvbQogICAgICAgIHZhciB4aHRtbCA9IFN0cm9waGUuY3JlYXRlSHRtbChmcmFnbWVudCk7CgogICAgICAgIHdoaWxlKHhodG1sLmNoaWxkTm9kZXMubGVuZ3RoID4gMCkgewogICAgICAgICAgICB0aGlzLm5vZGUuYXBwZW5kQ2hpbGQoeGh0bWwuY2hpbGROb2Rlc1swXSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzOwogICAgfQp9OwoKLyoqIFByaXZhdGVDbGFzczogU3Ryb3BoZS5IYW5kbGVyCiAqICBfUHJpdmF0ZV8gaGVscGVyIGNsYXNzIGZvciBtYW5hZ2luZyBzdGFuemEgaGFuZGxlcnMuCiAqCiAqICBBIFN0cm9waGUuSGFuZGxlciBlbmNhcHN1bGF0ZXMgYSB1c2VyIHByb3ZpZGVkIGNhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlCiAqICBleGVjdXRlZCB3aGVuIG1hdGNoaW5nIHN0YW56YXMgYXJlIHJlY2VpdmVkIGJ5IHRoZSBjb25uZWN0aW9uLgogKiAgSGFuZGxlcnMgY2FuIGJlIGVpdGhlciBvbmUtb2ZmIG9yIHBlcnNpc3RhbnQgZGVwZW5kaW5nIG9uIHRoZWlyCiAqICByZXR1cm4gdmFsdWUuIFJldHVybmluZyB0cnVlIHdpbGwgY2F1c2UgYSBIYW5kbGVyIHRvIHJlbWFpbiBhY3RpdmUsIGFuZAogKiAgcmV0dXJuaW5nIGZhbHNlIHdpbGwgcmVtb3ZlIHRoZSBIYW5kbGVyLgogKgogKiAgVXNlcnMgd2lsbCBub3QgdXNlIFN0cm9waGUuSGFuZGxlciBvYmplY3RzIGRpcmVjdGx5LCBidXQgaW5zdGVhZCB0aGV5CiAqICB3aWxsIHVzZSBTdHJvcGhlLkNvbm5lY3Rpb24uYWRkSGFuZGxlcigpIGFuZAogKiAgU3Ryb3BoZS5Db25uZWN0aW9uLmRlbGV0ZUhhbmRsZXIoKS4KICovCgovKiogUHJpdmF0ZUNvbnN0cnVjdG9yOiBTdHJvcGhlLkhhbmRsZXIKICogIENyZWF0ZSBhbmQgaW5pdGlhbGl6ZSBhIG5ldyBTdHJvcGhlLkhhbmRsZXIuCiAqCiAqICBQYXJhbWV0ZXJzOgogKiAgICAoRnVuY3Rpb24pIGhhbmRsZXIgLSBBIGZ1bmN0aW9uIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGhhbmRsZXIgaXMgcnVuLgogKiAgICAoU3RyaW5nKSBucyAtIFRoZSBuYW1lc3BhY2UgdG8gbWF0Y2guCiAqICAgIChTdHJpbmcpIG5hbWUgLSBUaGUgZWxlbWVudCBuYW1lIHRvIG1hdGNoLgogKiAgICAoU3RyaW5nKSB0eXBlIC0gVGhlIGVsZW1lbnQgdHlwZSB0byBtYXRjaC4KICogICAgKFN0cmluZykgaWQgLSBUaGUgZWxlbWVudCBpZCBhdHRyaWJ1dGUgdG8gbWF0Y2guCiAqICAgIChTdHJpbmcpIGZyb20gLSBUaGUgZWxlbWVudCBmcm9tIGF0dHJpYnV0ZSB0byBtYXRjaC4KICogICAgKE9iamVjdCkgb3B0aW9ucyAtIEhhbmRsZXIgb3B0aW9ucwogKgogKiAgUmV0dXJuczoKICogICAgQSBuZXcgU3Ryb3BoZS5IYW5kbGVyIG9iamVjdC4KICovClN0cm9waGUuSGFuZGxlciA9IGZ1bmN0aW9uIChoYW5kbGVyLCBucywgbmFtZSwgdHlwZSwgaWQsIGZyb20sIG9wdGlvbnMpCnsKICAgIHRoaXMuaGFuZGxlciA9IGhhbmRsZXI7CiAgICB0aGlzLm5zID0gbnM7CiAgICB0aGlzLm5hbWUgPSBuYW1lOwogICAgdGhpcy50eXBlID0gdHlwZTsKICAgIHRoaXMuaWQgPSBpZDsKICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnMgfHwge21hdGNoQmFyZTogZmFsc2V9OwoKICAgIC8vIGRlZmF1bHQgbWF0Y2hCYXJlIHRvIGZhbHNlIGlmIHVuZGVmaW5lZAogICAgaWYgKCF0aGlzLm9wdGlvbnMubWF0Y2hCYXJlKSB7CiAgICAgICAgdGhpcy5vcHRpb25zLm1hdGNoQmFyZSA9IGZhbHNlOwogICAgfQoKICAgIGlmICh0aGlzLm9wdGlvbnMubWF0Y2hCYXJlKSB7CiAgICAgICAgdGhpcy5mcm9tID0gZnJvbSA/IFN0cm9waGUuZ2V0QmFyZUppZEZyb21KaWQoZnJvbSkgOiBudWxsOwogICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmZyb20gPSBmcm9tOwogICAgfQoKICAgIC8vIHdoZXRoZXIgdGhlIGhhbmRsZXIgaXMgYSB1c2VyIGhhbmRsZXIgb3IgYSBzeXN0ZW0gaGFuZGxlcgogICAgdGhpcy51c2VyID0gdHJ1ZTsKfTsKClN0cm9waGUuSGFuZGxlci5wcm90b3R5cGUgPSB7CiAgICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiBpc01hdGNoCiAgICAgKiAgVGVzdHMgaWYgYSBzdGFuemEgbWF0Y2hlcyB0aGUgU3Ryb3BoZS5IYW5kbGVyLgogICAgICoKICAgICAqICBQYXJhbWV0ZXJzOgogICAgICogICAgKFhNTEVsZW1lbnQpIGVsZW0gLSBUaGUgWE1MIGVsZW1lbnQgdG8gdGVzdC4KICAgICAqCiAgICAgKiAgUmV0dXJuczoKICAgICAqICAgIHRydWUgaWYgdGhlIHN0YW56YSBtYXRjaGVzIGFuZCBmYWxzZSBvdGhlcndpc2UuCiAgICAgKi8KICAgIGlzTWF0Y2g6IGZ1bmN0aW9uIChlbGVtKQogICAgewogICAgICAgIHZhciBuc01hdGNoOwogICAgICAgIHZhciBmcm9tID0gbnVsbDsKCiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5tYXRjaEJhcmUpIHsKICAgICAgICAgICAgZnJvbSA9IFN0cm9waGUuZ2V0QmFyZUppZEZyb21KaWQoZWxlbS5nZXRBdHRyaWJ1dGUoJ2Zyb20nKSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZnJvbSA9IGVsZW0uZ2V0QXR0cmlidXRlKCdmcm9tJyk7CiAgICAgICAgfQoKICAgICAgICBuc01hdGNoID0gZmFsc2U7CiAgICAgICAgaWYgKCF0aGlzLm5zKSB7CiAgICAgICAgICAgIG5zTWF0Y2ggPSB0cnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpczsKICAgICAgICAgICAgU3Ryb3BoZS5mb3JFYWNoQ2hpbGQoZWxlbSwgbnVsbCwgZnVuY3Rpb24gKGVsZW0pIHsKICAgICAgICAgICAgICAgIGlmIChlbGVtLmdldEF0dHJpYnV0ZSgieG1sbnMiKSA9PSB0aGF0Lm5zKSB7CiAgICAgICAgICAgICAgICAgICAgbnNNYXRjaCA9IHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgbnNNYXRjaCA9IG5zTWF0Y2ggfHwgZWxlbS5nZXRBdHRyaWJ1dGUoInhtbG5zIikgPT0gdGhpcy5uczsKICAgICAgICB9CgogICAgICAgIGlmIChuc01hdGNoICYmCiAgICAgICAgICAgICghdGhpcy5uYW1lIHx8IFN0cm9waGUuaXNUYWdFcXVhbChlbGVtLCB0aGlzLm5hbWUpKSAmJgogICAgICAgICAgICAoIXRoaXMudHlwZSB8fCBlbGVtLmdldEF0dHJpYnV0ZSgidHlwZSIpID09IHRoaXMudHlwZSkgJiYKICAgICAgICAgICAgKCF0aGlzLmlkIHx8IGVsZW0uZ2V0QXR0cmlidXRlKCJpZCIpID09IHRoaXMuaWQpICYmCiAgICAgICAgICAgICghdGhpcy5mcm9tIHx8IGZyb20gPT0gdGhpcy5mcm9tKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9LAoKICAgIC8qKiBQcml2YXRlRnVuY3Rpb246IHJ1bgogICAgICogIFJ1biB0aGUgY2FsbGJhY2sgb24gYSBtYXRjaGluZyBzdGFuemEuCiAgICAgKgogICAgICogIFBhcmFtZXRlcnM6CiAgICAgKiAgICAoWE1MRWxlbWVudCkgZWxlbSAtIFRoZSBET00gZWxlbWVudCB0aGF0IHRyaWdnZXJlZCB0aGUKICAgICAqICAgICAgU3Ryb3BoZS5IYW5kbGVyLgogICAgICoKICAgICAqICBSZXR1cm5zOgogICAgICogICAgQSBib29sZWFuIGluZGljYXRpbmcgaWYgdGhlIGhhbmRsZXIgc2hvdWxkIHJlbWFpbiBhY3RpdmUuCiAgICAgKi8KICAgIHJ1bjogZnVuY3Rpb24gKGVsZW0pCiAgICB7CiAgICAgICAgdmFyIHJlc3VsdCA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmVzdWx0ID0gdGhpcy5oYW5kbGVyKGVsZW0pOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgaWYgKGUuc291cmNlVVJMKSB7CiAgICAgICAgICAgICAgICBTdHJvcGhlLmZhdGFsKCJlcnJvcjogIiArIHRoaXMuaGFuZGxlciArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICIgIiArIGUuc291cmNlVVJMICsgIjoiICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5saW5lICsgIiAtICIgKyBlLm5hbWUgKyAiOiAiICsgZS5tZXNzYWdlKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChlLmZpbGVOYW1lKSB7CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mKGNvbnNvbGUpICE9ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS50cmFjZSgpOwogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IodGhpcy5oYW5kbGVyLCAiIC0gZXJyb3IgLSAiLCBlLCBlLm1lc3NhZ2UpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgU3Ryb3BoZS5mYXRhbCgiZXJyb3I6ICIgKyB0aGlzLmhhbmRsZXIgKyAiICIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLmZpbGVOYW1lICsgIjoiICsgZS5saW5lTnVtYmVyICsgIiAtICIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLm5hbWUgKyAiOiAiICsgZS5tZXNzYWdlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIFN0cm9waGUuZmF0YWwoImVycm9yOiAiICsgZS5tZXNzYWdlICsgIlxuIiArIGUuc3RhY2spOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aHJvdyBlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0sCgogICAgLyoqIFByaXZhdGVGdW5jdGlvbjogdG9TdHJpbmcKICAgICAqICBHZXQgYSBTdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIFN0cm9waGUuSGFuZGxlciBvYmplY3QuCiAgICAgKgogICAgICogIFJldHVybnM6CiAgICAgKiAgICBBIFN0cmluZy4KICAgICAqLwogICAgdG9TdHJpbmc6IGZ1bmN0aW9uICgpCiAgICB7CiAgICAgICAgcmV0dXJuICJ7SGFuZGxlcjogIiArIHRoaXMuaGFuZGxlciArICIoIiArIHRoaXMubmFtZSArICIsIiArCiAgICAgICAgICAgIHRoaXMuaWQgKyAiLCIgKyB0aGlzLm5zICsgIil9IjsKICAgIH0KfTsKCi8qKiBQcml2YXRlQ2xhc3M6IFN0cm9waGUuVGltZWRIYW5kbGVyCiAqICBfUHJpdmF0ZV8gaGVscGVyIGNsYXNzIGZvciBtYW5hZ2luZyB0aW1lZCBoYW5kbGVycy4KICoKICogIEEgU3Ryb3BoZS5UaW1lZEhhbmRsZXIgZW5jYXBzdWxhdGVzIGEgdXNlciBwcm92aWRlZCBjYWxsYmFjayB0aGF0CiAqICBzaG91bGQgYmUgY2FsbGVkIGFmdGVyIGEgY2VydGFpbiBwZXJpb2Qgb2YgdGltZSBvciBhdCByZWd1bGFyCiAqICBpbnRlcnZhbHMuICBUaGUgcmV0dXJuIHZhbHVlIG9mIHRoZSBjYWxsYmFjayBkZXRlcm1pbmVzIHdoZXRoZXIgdGhlCiAqICBTdHJvcGhlLlRpbWVkSGFuZGxlciB3aWxsIGNvbnRpbnVlIHRvIGZpcmUuCiAqCiAqICBVc2VycyB3aWxsIG5vdCB1c2UgU3Ryb3BoZS5UaW1lZEhhbmRsZXIgb2JqZWN0cyBkaXJlY3RseSwgYnV0IGluc3RlYWQKICogIHRoZXkgd2lsbCB1c2UgU3Ryb3BoZS5Db25uZWN0aW9uLmFkZFRpbWVkSGFuZGxlcigpIGFuZAogKiAgU3Ryb3BoZS5Db25uZWN0aW9uLmRlbGV0ZVRpbWVkSGFuZGxlcigpLgogKi8KCi8qKiBQcml2YXRlQ29uc3RydWN0b3I6IFN0cm9waGUuVGltZWRIYW5kbGVyCiAqICBDcmVhdGUgYW5kIGluaXRpYWxpemUgYSBuZXcgU3Ryb3BoZS5UaW1lZEhhbmRsZXIgb2JqZWN0LgogKgogKiAgUGFyYW1ldGVyczoKICogICAgKEludGVnZXIpIHBlcmlvZCAtIFRoZSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzIHRvIHdhaXQgYmVmb3JlIHRoZQogKiAgICAgIGhhbmRsZXIgaXMgY2FsbGVkLgogKiAgICAoRnVuY3Rpb24pIGhhbmRsZXIgLSBUaGUgY2FsbGJhY2sgdG8gcnVuIHdoZW4gdGhlIGhhbmRsZXIgZmlyZXMuICBUaGlzCiAqICAgICAgZnVuY3Rpb24gc2hvdWxkIHRha2Ugbm8gYXJndW1lbnRzLgogKgogKiAgUmV0dXJuczoKICogICAgQSBuZXcgU3Ryb3BoZS5UaW1lZEhhbmRsZXIgb2JqZWN0LgogKi8KU3Ryb3BoZS5UaW1lZEhhbmRsZXIgPSBmdW5jdGlvbiAocGVyaW9kLCBoYW5kbGVyKQp7CiAgICB0aGlzLnBlcmlvZCA9IHBlcmlvZDsKICAgIHRoaXMuaGFuZGxlciA9IGhhbmRsZXI7CgogICAgdGhpcy5sYXN0Q2FsbGVkID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7CiAgICB0aGlzLnVzZXIgPSB0cnVlOwp9OwoKU3Ryb3BoZS5UaW1lZEhhbmRsZXIucHJvdG90eXBlID0gewogICAgLyoqIFByaXZhdGVGdW5jdGlvbjogcnVuCiAgICAgKiAgUnVuIHRoZSBjYWxsYmFjayBmb3IgdGhlIFN0cm9waGUuVGltZWRIYW5kbGVyLgogICAgICoKICAgICAqICBSZXR1cm5zOgogICAgICogICAgdHJ1ZSBpZiB0aGUgU3Ryb3BoZS5UaW1lZEhhbmRsZXIgc2hvdWxkIGJlIGNhbGxlZCBhZ2FpbiwgYW5kIGZhbHNlCiAgICAgKiAgICAgIG90aGVyd2lzZS4KICAgICAqLwogICAgcnVuOiBmdW5jdGlvbiAoKQogICAgewogICAgICAgIHRoaXMubGFzdENhbGxlZCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOwogICAgICAgIHJldHVybiB0aGlzLmhhbmRsZXIoKTsKICAgIH0sCgogICAgLyoqIFByaXZhdGVGdW5jdGlvbjogcmVzZXQKICAgICAqICBSZXNldCB0aGUgbGFzdCBjYWxsZWQgdGltZSBmb3IgdGhlIFN0cm9waGUuVGltZWRIYW5kbGVyLgogICAgICovCiAgICByZXNldDogZnVuY3Rpb24gKCkKICAgIHsKICAgICAgICB0aGlzLmxhc3RDYWxsZWQgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTsKICAgIH0sCgogICAgLyoqIFByaXZhdGVGdW5jdGlvbjogdG9TdHJpbmcKICAgICAqICBHZXQgYSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIFN0cm9waGUuVGltZWRIYW5kbGVyIG9iamVjdC4KICAgICAqCiAgICAgKiAgUmV0dXJuczoKICAgICAqICAgIFRoZSBzdHJpbmcgcmVwcmVzZW50YXRpb24uCiAgICAgKi8KICAgIHRvU3RyaW5nOiBmdW5jdGlvbiAoKQogICAgewogICAgICAgIHJldHVybiAie1RpbWVkSGFuZGxlcjogIiArIHRoaXMuaGFuZGxlciArICIoIiArIHRoaXMucGVyaW9kICsiKX0iOwogICAgfQp9OwoKLyoqIENsYXNzOiBTdHJvcGhlLkNvbm5lY3Rpb24KICogIFhNUFAgQ29ubmVjdGlvbiBtYW5hZ2VyLgogKgogKiAgVGhpcyBjbGFzcyBpcyB0aGUgbWFpbiBwYXJ0IG9mIFN0cm9waGUuICBJdCBtYW5hZ2VzIGEgQk9TSCBjb25uZWN0aW9uCiAqICB0byBhbiBYTVBQIHNlcnZlciBhbmQgZGlzcGF0Y2hlcyBldmVudHMgdG8gdGhlIHVzZXIgY2FsbGJhY2tzIGFzCiAqICBkYXRhIGFycml2ZXMuICBJdCBzdXBwb3J0cyBTQVNMIFBMQUlOLCBTQVNMIERJR0VTVC1NRDUsIFNBU0wgU0NSQU0tU0hBMQogKiAgYW5kIGxlZ2FjeSBhdXRoZW50aWNhdGlvbi4KICoKICogIEFmdGVyIGNyZWF0aW5nIGEgU3Ryb3BoZS5Db25uZWN0aW9uIG9iamVjdCwgdGhlIHVzZXIgd2lsbCB0eXBpY2FsbHkKICogIGNhbGwgY29ubmVjdCgpIHdpdGggYSB1c2VyIHN1cHBsaWVkIGNhbGxiYWNrIHRvIGhhbmRsZSBjb25uZWN0aW9uIGxldmVsCiAqICBldmVudHMgbGlrZSBhdXRoZW50aWNhdGlvbiBmYWlsdXJlLCBkaXNjb25uZWN0aW9uLCBvciBjb25uZWN0aW9uCiAqICBjb21wbGV0ZS4KICoKICogIFRoZSB1c2VyIHdpbGwgYWxzbyBoYXZlIHNldmVyYWwgZXZlbnQgaGFuZGxlcnMgZGVmaW5lZCBieSB1c2luZwogKiAgYWRkSGFuZGxlcigpIGFuZCBhZGRUaW1lZEhhbmRsZXIoKS4gIFRoZXNlIHdpbGwgYWxsb3cgdGhlIHVzZXIgY29kZSB0bwogKiAgcmVzcG9uZCB0byBpbnRlcmVzdGluZyBzdGFuemFzIG9yIGRvIHNvbWV0aGluZyBwZXJpb2RpY2FsbHkgd2l0aCB0aGUKICogIGNvbm5lY3Rpb24uICBUaGVzZSBoYW5kbGVycyB3aWxsIGJlIGFjdGl2ZSBvbmNlIGF1dGhlbnRpY2F0aW9uIGlzCiAqICBmaW5pc2hlZC4KICoKICogIFRvIHNlbmQgZGF0YSB0byB0aGUgY29ubmVjdGlvbiwgdXNlIHNlbmQoKS4KICovCgovKiogQ29uc3RydWN0b3I6IFN0cm9waGUuQ29ubmVjdGlvbgogKiAgQ3JlYXRlIGFuZCBpbml0aWFsaXplIGEgU3Ryb3BoZS5Db25uZWN0aW9uIG9iamVjdC4KICoKICogIFRoZSB0cmFuc3BvcnQtcHJvdG9jb2wgZm9yIHRoaXMgY29ubmVjdGlvbiB3aWxsIGJlIGNob3NlbiBhdXRvbWF0aWNhbGx5CiAqICBiYXNlZCBvbiB0aGUgZ2l2ZW4gc2VydmljZSBwYXJhbWV0ZXIuIFVSTHMgc3RhcnRpbmcgd2l0aCAid3M6Ly8iIG9yCiAqICAid3NzOi8vIiB3aWxsIHVzZSBXZWJTb2NrZXRzLCBVUkxzIHN0YXJ0aW5nIHdpdGggImh0dHA6Ly8iLCAiaHR0cHM6Ly8iCiAqICBvciB3aXRob3V0IGEgcHJvdG9jb2wgd2lsbCB1c2UgQk9TSC4KICoKICogIFRvIG1ha2UgU3Ryb3BoZSBjb25uZWN0IHRvIHRoZSBjdXJyZW50IGhvc3QgeW91IGNhbiBsZWF2ZSBvdXQgdGhlIHByb3RvY29sCiAqICBhbmQgaG9zdCBwYXJ0IGFuZCBqdXN0IHBhc3MgdGhlIHBhdGgsIGUuZy4KICoKICogID4gdmFyIGNvbm4gPSBuZXcgU3Ryb3BoZS5Db25uZWN0aW9uKCIvaHR0cC1iaW5kLyIpOwogKgogKiAgV2ViU29ja2V0IG9wdGlvbnM6CiAqCiAqICBJZiB5b3Ugd2FudCB0byBjb25uZWN0IHRvIHRoZSBjdXJyZW50IGhvc3Qgd2l0aCBhIFdlYlNvY2tldCBjb25uZWN0aW9uIHlvdQogKiAgY2FuIHRlbGwgU3Ryb3BoZSB0byB1c2UgV2ViU29ja2V0cyB0aHJvdWdoIGEgInByb3RvY29sIiBhdHRyaWJ1dGUgaW4gdGhlCiAqICBvcHRpb25hbCBvcHRpb25zIHBhcmFtZXRlci4gVmFsaWQgdmFsdWVzIGFyZSAid3MiIGZvciBXZWJTb2NrZXQgYW5kICJ3c3MiCiAqICBmb3IgU2VjdXJlIFdlYlNvY2tldC4KICogIFNvIHRvIGNvbm5lY3QgdG8gIndzczovL0NVUlJFTlRfSE9TVE5BTUUveG1wcC13ZWJzb2NrZXQiIHlvdSB3b3VsZCBjYWxsCiAqCiAqICA+IHZhciBjb25uID0gbmV3IFN0cm9waGUuQ29ubmVjdGlvbigiL3htcHAtd2Vic29ja2V0LyIsIHtwcm90b2NvbDogIndzcyJ9KTsKICoKICogIE5vdGUgdGhhdCByZWxhdGl2ZSBVUkxzIF9OT1RfIHN0YXJ0aW5nIHdpdGggYSAiLyIgd2lsbCBhbHNvIGluY2x1ZGUgdGhlIHBhdGgKICogIG9mIHRoZSBjdXJyZW50IHNpdGUuCiAqCiAqICBBbHNvIGJlY2F1c2UgZG93bmdyYWRpbmcgc2VjdXJpdHkgaXMgbm90IHBlcm1pdHRlZCBieSBicm93c2Vycywgd2hlbiB1c2luZwogKiAgcmVsYXRpdmUgVVJMcyBib3RoIEJPU0ggYW5kIFdlYlNvY2tldCBjb25uZWN0aW9ucyB3aWxsIHVzZSB0aGVpciBzZWN1cmUKICogIHZhcmlhbnRzIGlmIHRoZSBjdXJyZW50IGNvbm5lY3Rpb24gdG8gdGhlIHNpdGUgaXMgYWxzbyBzZWN1cmUgKGh0dHBzKS4KICoKICogIEJPU0ggb3B0aW9uczoKICoKICogIGJ5IGFkZGluZyAic3luYyIgdG8gdGhlIG9wdGlvbnMsIHlvdSBjYW4gY29udHJvbCBpZiByZXF1ZXN0cyB3aWxsCiAqICBiZSBtYWRlIHN5bmNocm9ub3VzbHkgb3Igbm90LiBUaGUgZGVmYXVsdCBiZWhhdmlvdXIgaXMgYXN5bmNocm9ub3VzLgogKiAgSWYgeW91IHdhbnQgdG8gbWFrZSByZXF1ZXN0cyBzeW5jaHJvbm91cywgbWFrZSAic3luYyIgZXZhbHVhdGUgdG8gdHJ1ZToKICogID4gdmFyIGNvbm4gPSBuZXcgU3Ryb3BoZS5Db25uZWN0aW9uKCIvaHR0cC1iaW5kLyIsIHtzeW5jOiB0cnVlfSk7CiAqICBZb3UgY2FuIGFsc28gdG9nZ2xlIHRoaXMgb24gYW4gYWxyZWFkeSBlc3RhYmxpc2hlZCBjb25uZWN0aW9uOgogKiAgPiBjb25uLm9wdGlvbnMuc3luYyA9IHRydWU7CiAqCiAqCiAqICBQYXJhbWV0ZXJzOgogKiAgICAoU3RyaW5nKSBzZXJ2aWNlIC0gVGhlIEJPU0ggb3IgV2ViU29ja2V0IHNlcnZpY2UgVVJMLgogKiAgICAoT2JqZWN0KSBvcHRpb25zIC0gQSBoYXNoIG9mIGNvbmZpZ3VyYXRpb24gb3B0aW9ucwogKgogKiAgUmV0dXJuczoKICogICAgQSBuZXcgU3Ryb3BoZS5Db25uZWN0aW9uIG9iamVjdC4KICovClN0cm9waGUuQ29ubmVjdGlvbiA9IGZ1bmN0aW9uIChzZXJ2aWNlLCBvcHRpb25zKQp7CiAgICAvLyBUaGUgc2VydmljZSBVUkwKICAgIHRoaXMuc2VydmljZSA9IHNlcnZpY2U7CgogICAgLy8gQ29uZmlndXJhdGlvbiBvcHRpb25zCiAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwogICAgdmFyIHByb3RvID0gdGhpcy5vcHRpb25zLnByb3RvY29sIHx8ICIiOwoKICAgIC8vIFNlbGVjdCBwcm90b2NhbCBiYXNlZCBvbiBzZXJ2aWNlIG9yIG9wdGlvbnMKICAgIGlmIChzZXJ2aWNlLmluZGV4T2YoIndzOiIpID09PSAwIHx8IHNlcnZpY2UuaW5kZXhPZigid3NzOiIpID09PSAwIHx8CiAgICAgICAgICAgIHByb3RvLmluZGV4T2YoIndzIikgPT09IDApIHsKICAgICAgICB0aGlzLl9wcm90byA9IG5ldyBTdHJvcGhlLldlYnNvY2tldCh0aGlzKTsKICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5fcHJvdG8gPSBuZXcgU3Ryb3BoZS5Cb3NoKHRoaXMpOwogICAgfQogICAgLyogVGhlIGNvbm5lY3RlZCBKSUQuICovCiAgICB0aGlzLmppZCA9ICIiOwogICAgLyogdGhlIEpJRHMgZG9tYWluICovCiAgICB0aGlzLmRvbWFpbiA9IG51bGw7CiAgICAvKiBzdHJlYW06ZmVhdHVyZXMgKi8KICAgIHRoaXMuZmVhdHVyZXMgPSBudWxsOwoKICAgIC8vIFNBU0wKICAgIHRoaXMuX3Nhc2xfZGF0YSA9IHt9OwogICAgdGhpcy5kb19zZXNzaW9uID0gZmFsc2U7CiAgICB0aGlzLmRvX2JpbmQgPSBmYWxzZTsKCiAgICAvLyBoYW5kbGVyIGxpc3RzCiAgICB0aGlzLnRpbWVkSGFuZGxlcnMgPSBbXTsKICAgIHRoaXMuaGFuZGxlcnMgPSBbXTsKICAgIHRoaXMucmVtb3ZlVGltZWRzID0gW107CiAgICB0aGlzLnJlbW92ZUhhbmRsZXJzID0gW107CiAgICB0aGlzLmFkZFRpbWVkcyA9IFtdOwogICAgdGhpcy5hZGRIYW5kbGVycyA9IFtdOwoKICAgIHRoaXMuX2F1dGhlbnRpY2F0aW9uID0ge307CiAgICB0aGlzLl9pZGxlVGltZW91dCA9IG51bGw7CiAgICB0aGlzLl9kaXNjb25uZWN0VGltZW91dCA9IG51bGw7CgogICAgdGhpcy5kb19hdXRoZW50aWNhdGlvbiA9IHRydWU7CiAgICB0aGlzLmF1dGhlbnRpY2F0ZWQgPSBmYWxzZTsKICAgIHRoaXMuZGlzY29ubmVjdGluZyA9IGZhbHNlOwogICAgdGhpcy5jb25uZWN0ZWQgPSBmYWxzZTsKCiAgICB0aGlzLmVycm9ycyA9IDA7CgogICAgdGhpcy5wYXVzZWQgPSBmYWxzZTsKCiAgICB0aGlzLl9kYXRhID0gW107CiAgICB0aGlzLl91bmlxdWVJZCA9IDA7CgogICAgdGhpcy5fc2FzbF9zdWNjZXNzX2hhbmRsZXIgPSBudWxsOwogICAgdGhpcy5fc2FzbF9mYWlsdXJlX2hhbmRsZXIgPSBudWxsOwogICAgdGhpcy5fc2FzbF9jaGFsbGVuZ2VfaGFuZGxlciA9IG51bGw7CgogICAgLy8gTWF4IHJldHJpZXMgYmVmb3JlIGRpc2Nvbm5lY3RpbmcKICAgIHRoaXMubWF4UmV0cmllcyA9IDU7CgogICAgLy8gc2V0dXAgb25JZGxlIGNhbGxiYWNrIGV2ZXJ5IDEvMTB0aCBvZiBhIHNlY29uZAogICAgdGhpcy5faWRsZVRpbWVvdXQgPSBzZXRUaW1lb3V0KHRoaXMuX29uSWRsZS5iaW5kKHRoaXMpLCAxMDApOwoKICAgIC8vIGluaXRpYWxpemUgcGx1Z2lucwogICAgZm9yICh2YXIgayBpbiBTdHJvcGhlLl9jb25uZWN0aW9uUGx1Z2lucykgewogICAgICAgIGlmIChTdHJvcGhlLl9jb25uZWN0aW9uUGx1Z2lucy5oYXNPd25Qcm9wZXJ0eShrKSkgewogICAgICAgICAgICB2YXIgcHR5cGUgPSBTdHJvcGhlLl9jb25uZWN0aW9uUGx1Z2luc1trXTsKICAgICAgICAgICAgLy8ganNsaW50IGNvbXBsYWludHMgYWJvdXQgdGhlIGJlbG93IGxpbmUsIGJ1dCB0aGlzIGlzIGZpbmUKICAgICAgICAgICAgdmFyIEYgPSBmdW5jdGlvbiAoKSB7fTsgLy8ganNoaW50IGlnbm9yZTpsaW5lCiAgICAgICAgICAgIEYucHJvdG90eXBlID0gcHR5cGU7CiAgICAgICAgICAgIHRoaXNba10gPSBuZXcgRigpOwogICAgICAgICAgICB0aGlzW2tdLmluaXQodGhpcyk7CiAgICAgICAgfQogICAgfQp9OwoKU3Ryb3BoZS5Db25uZWN0aW9uLnByb3RvdHlwZSA9IHsKICAgIC8qKiBGdW5jdGlvbjogcmVzZXQKICAgICAqICBSZXNldCB0aGUgY29ubmVjdGlvbi4KICAgICAqCiAgICAgKiAgVGhpcyBmdW5jdGlvbiBzaG91bGQgYmUgY2FsbGVkIGFmdGVyIGEgY29ubmVjdGlvbiBpcyBkaXNjb25uZWN0ZWQKICAgICAqICBiZWZvcmUgdGhhdCBjb25uZWN0aW9uIGlzIHJldXNlZC4KICAgICAqLwogICAgcmVzZXQ6IGZ1bmN0aW9uICgpCiAgICB7CiAgICAgICAgdGhpcy5fcHJvdG8uX3Jlc2V0KCk7CgogICAgICAgIC8vIFNBU0wKICAgICAgICB0aGlzLmRvX3Nlc3Npb24gPSBmYWxzZTsKICAgICAgICB0aGlzLmRvX2JpbmQgPSBmYWxzZTsKCiAgICAgICAgLy8gaGFuZGxlciBsaXN0cwogICAgICAgIHRoaXMudGltZWRIYW5kbGVycyA9IFtdOwogICAgICAgIHRoaXMuaGFuZGxlcnMgPSBbXTsKICAgICAgICB0aGlzLnJlbW92ZVRpbWVkcyA9IFtdOwogICAgICAgIHRoaXMucmVtb3ZlSGFuZGxlcnMgPSBbXTsKICAgICAgICB0aGlzLmFkZFRpbWVkcyA9IFtdOwogICAgICAgIHRoaXMuYWRkSGFuZGxlcnMgPSBbXTsKICAgICAgICB0aGlzLl9hdXRoZW50aWNhdGlvbiA9IHt9OwoKICAgICAgICB0aGlzLmF1dGhlbnRpY2F0ZWQgPSBmYWxzZTsKICAgICAgICB0aGlzLmRpc2Nvbm5lY3RpbmcgPSBmYWxzZTsKICAgICAgICB0aGlzLmNvbm5lY3RlZCA9IGZhbHNlOwoKICAgICAgICB0aGlzLmVycm9ycyA9IDA7CgogICAgICAgIHRoaXMuX3JlcXVlc3RzID0gW107CiAgICAgICAgdGhpcy5fdW5pcXVlSWQgPSAwOwogICAgfSwKCiAgICAvKiogRnVuY3Rpb246IHBhdXNlCiAgICAgKiAgUGF1c2UgdGhlIHJlcXVlc3QgbWFuYWdlci4KICAgICAqCiAgICAgKiAgVGhpcyB3aWxsIHByZXZlbnQgU3Ryb3BoZSBmcm9tIHNlbmRpbmcgYW55IG1vcmUgcmVxdWVzdHMgdG8gdGhlCiAgICAgKiAgc2VydmVyLiAgVGhpcyBpcyB2ZXJ5IHVzZWZ1bCBmb3IgdGVtcG9yYXJpbHkgcGF1c2luZwogICAgICogIEJPU0gtQ29ubmVjdGlvbnMgd2hpbGUgYSBsb3Qgb2Ygc2VuZCgpIGNhbGxzIGFyZSBoYXBwZW5pbmcgcXVpY2tseS4KICAgICAqICBUaGlzIGNhdXNlcyBTdHJvcGhlIHRvIHNlbmQgdGhlIGRhdGEgaW4gYSBzaW5nbGUgcmVxdWVzdCwgc2F2aW5nCiAgICAgKiAgbWFueSByZXF1ZXN0IHRyaXBzLgogICAgICovCiAgICBwYXVzZTogZnVuY3Rpb24gKCkKICAgIHsKICAgICAgICB0aGlzLnBhdXNlZCA9IHRydWU7CiAgICB9LAoKICAgIC8qKiBGdW5jdGlvbjogcmVzdW1lCiAgICAgKiAgUmVzdW1lIHRoZSByZXF1ZXN0IG1hbmFnZXIuCiAgICAgKgogICAgICogIFRoaXMgcmVzdW1lcyBhZnRlciBwYXVzZSgpIGhhcyBiZWVuIGNhbGxlZC4KICAgICAqLwogICAgcmVzdW1lOiBmdW5jdGlvbiAoKQogICAgewogICAgICAgIHRoaXMucGF1c2VkID0gZmFsc2U7CiAgICB9LAoKICAgIC8qKiBGdW5jdGlvbjogZ2V0VW5pcXVlSWQKICAgICAqICBHZW5lcmF0ZSBhIHVuaXF1ZSBJRCBmb3IgdXNlIGluIDxpcS8+IGVsZW1lbnRzLgogICAgICoKICAgICAqICBBbGwgPGlxLz4gc3RhbnphcyBhcmUgcmVxdWlyZWQgdG8gaGF2ZSB1bmlxdWUgaWQgYXR0cmlidXRlcy4gIFRoaXMKICAgICAqICBmdW5jdGlvbiBtYWtlcyBjcmVhdGluZyB0aGVzZSBlYXN5LiAgRWFjaCBjb25uZWN0aW9uIGluc3RhbmNlIGhhcwogICAgICogIGEgY291bnRlciB3aGljaCBzdGFydHMgZnJvbSB6ZXJvLCBhbmQgdGhlIHZhbHVlIG9mIHRoaXMgY291bnRlcgogICAgICogIHBsdXMgYSBjb2xvbiBmb2xsb3dlZCBieSB0aGUgc3VmZml4IGJlY29tZXMgdGhlIHVuaXF1ZSBpZC4gSWYgbm8KICAgICAqICBzdWZmaXggaXMgc3VwcGxpZWQsIHRoZSBjb3VudGVyIGlzIHVzZWQgYXMgdGhlIHVuaXF1ZSBpZC4KICAgICAqCiAgICAgKiAgU3VmZml4ZXMgYXJlIHVzZWQgdG8gbWFrZSBkZWJ1Z2dpbmcgZWFzaWVyIHdoZW4gcmVhZGluZyB0aGUgc3RyZWFtCiAgICAgKiAgZGF0YSwgYW5kIHRoZWlyIHVzZSBpcyByZWNvbW1lbmRlZC4gIFRoZSBjb3VudGVyIHJlc2V0cyB0byAwIGZvcgogICAgICogIGV2ZXJ5IG5ldyBjb25uZWN0aW9uIGZvciB0aGUgc2FtZSByZWFzb24uICBGb3IgY29ubmVjdGlvbnMgdG8gdGhlCiAgICAgKiAgc2FtZSBzZXJ2ZXIgdGhhdCBhdXRoZW50aWNhdGUgdGhlIHNhbWUgd2F5LCBhbGwgdGhlIGlkcyBzaG91bGQgYmUKICAgICAqICB0aGUgc2FtZSwgd2hpY2ggbWFrZXMgaXQgZWFzeSB0byBzZWUgY2hhbmdlcy4gIFRoaXMgaXMgdXNlZnVsIGZvcgogICAgICogIGF1dG9tYXRlZCB0ZXN0aW5nIGFzIHdlbGwuCiAgICAgKgogICAgICogIFBhcmFtZXRlcnM6CiAgICAgKiAgICAoU3RyaW5nKSBzdWZmaXggLSBBIG9wdGlvbmFsIHN1ZmZpeCB0byBhcHBlbmQgdG8gdGhlIGlkLgogICAgICoKICAgICAqICBSZXR1cm5zOgogICAgICogICAgQSB1bmlxdWUgc3RyaW5nIHRvIGJlIHVzZWQgZm9yIHRoZSBpZCBhdHRyaWJ1dGUuCiAgICAgKi8KICAgIGdldFVuaXF1ZUlkOiBmdW5jdGlvbiAoc3VmZml4KQogICAgewogICAgICAgIGlmICh0eXBlb2Yoc3VmZml4KSA9PSAic3RyaW5nIiB8fCB0eXBlb2Yoc3VmZml4KSA9PSAibnVtYmVyIikgewogICAgICAgICAgICByZXR1cm4gKyt0aGlzLl91bmlxdWVJZCArICI6IiArIHN1ZmZpeDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gKyt0aGlzLl91bmlxdWVJZCArICIiOwogICAgICAgIH0KICAgIH0sCgogICAgLyoqIEZ1bmN0aW9uOiBjb25uZWN0CiAgICAgKiAgU3RhcnRzIHRoZSBjb25uZWN0aW9uIHByb2Nlc3MuCiAgICAgKgogICAgICogIEFzIHRoZSBjb25uZWN0aW9uIHByb2Nlc3MgcHJvY2VlZHMsIHRoZSB1c2VyIHN1cHBsaWVkIGNhbGxiYWNrIHdpbGwKICAgICAqICBiZSB0cmlnZ2VyZWQgbXVsdGlwbGUgdGltZXMgd2l0aCBzdGF0dXMgdXBkYXRlcy4gIFRoZSBjYWxsYmFjawogICAgICogIHNob3VsZCB0YWtlIHR3byBhcmd1bWVudHMgLSB0aGUgc3RhdHVzIGNvZGUgYW5kIHRoZSBlcnJvciBjb25kaXRpb24uCiAgICAgKgogICAgICogIFRoZSBzdGF0dXMgY29kZSB3aWxsIGJlIG9uZSBvZiB0aGUgdmFsdWVzIGluIHRoZSBTdHJvcGhlLlN0YXR1cwogICAgICogIGNvbnN0YW50cy4gIFRoZSBlcnJvciBjb25kaXRpb24gd2lsbCBiZSBvbmUgb2YgdGhlIGNvbmRpdGlvbnMKICAgICAqICBkZWZpbmVkIGluIFJGQyAzOTIwIG9yIHRoZSBjb25kaXRpb24gJ3N0cm9waGUtcGFyc2VyZXJyb3InLgogICAgICoKICAgICAqICBUaGUgUGFyYW1ldGVycyBfd2FpdF8sIF9ob2xkXyBhbmQgX3JvdXRlXyBhcmUgb3B0aW9uYWwgYW5kIG9ubHkgcmVsZXZhbnQKICAgICAqICBmb3IgQk9TSCBjb25uZWN0aW9ucy4gUGxlYXNlIHNlZSBYRVAgMTI0IGZvciBhIG1vcmUgZGV0YWlsZWQgZXhwbGFuYXRpb24KICAgICAqICBvZiB0aGUgb3B0aW9uYWwgcGFyYW1ldGVycy4KICAgICAqCiAgICAgKiAgUGFyYW1ldGVyczoKICAgICAqICAgIChTdHJpbmcpIGppZCAtIFRoZSB1c2VyJ3MgSklELiAgVGhpcyBtYXkgYmUgYSBiYXJlIEpJRCwKICAgICAqICAgICAgb3IgYSBmdWxsIEpJRC4gIElmIGEgbm9kZSBpcyBub3Qgc3VwcGxpZWQsIFNBU0wgQU5PTllNT1VTCiAgICAgKiAgICAgIGF1dGhlbnRpY2F0aW9uIHdpbGwgYmUgYXR0ZW1wdGVkLgogICAgICogICAgKFN0cmluZykgcGFzcyAtIFRoZSB1c2VyJ3MgcGFzc3dvcmQuCiAgICAgKiAgICAoRnVuY3Rpb24pIGNhbGxiYWNrIC0gVGhlIGNvbm5lY3QgY2FsbGJhY2sgZnVuY3Rpb24uCiAgICAgKiAgICAoSW50ZWdlcikgd2FpdCAtIFRoZSBvcHRpb25hbCBIVFRQQklORCB3YWl0IHZhbHVlLiAgVGhpcyBpcyB0aGUKICAgICAqICAgICAgdGltZSB0aGUgc2VydmVyIHdpbGwgd2FpdCBiZWZvcmUgcmV0dXJuaW5nIGFuIGVtcHR5IHJlc3VsdCBmb3IKICAgICAqICAgICAgYSByZXF1ZXN0LiAgVGhlIGRlZmF1bHQgc2V0dGluZyBvZiA2MCBzZWNvbmRzIGlzIHJlY29tbWVuZGVkLgogICAgICogICAgKEludGVnZXIpIGhvbGQgLSBUaGUgb3B0aW9uYWwgSFRUUEJJTkQgaG9sZCB2YWx1ZS4gIFRoaXMgaXMgdGhlCiAgICAgKiAgICAgIG51bWJlciBvZiBjb25uZWN0aW9ucyB0aGUgc2VydmVyIHdpbGwgaG9sZCBhdCBvbmUgdGltZS4gIFRoaXMKICAgICAqICAgICAgc2hvdWxkIGFsbW9zdCBhbHdheXMgYmUgc2V0IHRvIDEgKHRoZSBkZWZhdWx0KS4KICAgICAqICAgIChTdHJpbmcpIHJvdXRlIC0gVGhlIG9wdGlvbmFsIHJvdXRlIHZhbHVlLgogICAgICovCiAgICBjb25uZWN0OiBmdW5jdGlvbiAoamlkLCBwYXNzLCBjYWxsYmFjaywgd2FpdCwgaG9sZCwgcm91dGUpCiAgICB7CiAgICAgICAgdGhpcy5qaWQgPSBqaWQ7CiAgICAgICAgLyoqIFZhcmlhYmxlOiBhdXRoemlkCiAgICAgICAgICogIEF1dGhvcml6YXRpb24gaWRlbnRpdHkuCiAgICAgICAgICovCiAgICAgICAgdGhpcy5hdXRoemlkID0gU3Ryb3BoZS5nZXRCYXJlSmlkRnJvbUppZCh0aGlzLmppZCk7CiAgICAgICAgLyoqIFZhcmlhYmxlOiBhdXRoY2lkCiAgICAgICAgICogIEF1dGhlbnRpY2F0aW9uIGlkZW50aXR5IChVc2VyIG5hbWUpLgogICAgICAgICAqLwogICAgICAgIHRoaXMuYXV0aGNpZCA9IFN0cm9waGUuZ2V0Tm9kZUZyb21KaWQodGhpcy5qaWQpOwogICAgICAgIC8qKiBWYXJpYWJsZTogcGFzcwogICAgICAgICAqICBBdXRoZW50aWNhdGlvbiBpZGVudGl0eSAoVXNlciBwYXNzd29yZCkuCiAgICAgICAgICovCiAgICAgICAgdGhpcy5wYXNzID0gcGFzczsKICAgICAgICAvKiogVmFyaWFibGU6IHNlcnZ0eXBlCiAgICAgICAgICogIERpZ2VzdCBNRDUgY29tcGF0aWJpbGl0eS4KICAgICAgICAgKi8KICAgICAgICB0aGlzLnNlcnZ0eXBlID0gInhtcHAiOwogICAgICAgIHRoaXMuY29ubmVjdF9jYWxsYmFjayA9IGNhbGxiYWNrOwogICAgICAgIHRoaXMuZGlzY29ubmVjdGluZyA9IGZhbHNlOwogICAgICAgIHRoaXMuY29ubmVjdGVkID0gZmFsc2U7CiAgICAgICAgdGhpcy5hdXRoZW50aWNhdGVkID0gZmFsc2U7CiAgICAgICAgdGhpcy5lcnJvcnMgPSAwOwoKICAgICAgICAvLyBwYXJzZSBqaWQgZm9yIGRvbWFpbgogICAgICAgIHRoaXMuZG9tYWluID0gU3Ryb3BoZS5nZXREb21haW5Gcm9tSmlkKHRoaXMuamlkKTsKCiAgICAgICAgdGhpcy5fY2hhbmdlQ29ubmVjdFN0YXR1cyhTdHJvcGhlLlN0YXR1cy5DT05ORUNUSU5HLCBudWxsKTsKCiAgICAgICAgdGhpcy5fcHJvdG8uX2Nvbm5lY3Qod2FpdCwgaG9sZCwgcm91dGUpOwogICAgfSwKCiAgICAvKiogRnVuY3Rpb246IGF0dGFjaAogICAgICogIEF0dGFjaCB0byBhbiBhbHJlYWR5IGNyZWF0ZWQgYW5kIGF1dGhlbnRpY2F0ZWQgQk9TSCBzZXNzaW9uLgogICAgICoKICAgICAqICBUaGlzIGZ1bmN0aW9uIGlzIHByb3ZpZGVkIHRvIGFsbG93IFN0cm9waGUgdG8gYXR0YWNoIHRvIEJPU0gKICAgICAqICBzZXNzaW9ucyB3aGljaCBoYXZlIGJlZW4gY3JlYXRlZCBleHRlcm5hbGx5LCBwZXJoYXBzIGJ5IGEgV2ViCiAgICAgKiAgYXBwbGljYXRpb24uICBUaGlzIGlzIG9mdGVuIHVzZWQgdG8gc3VwcG9ydCBhdXRvLWxvZ2luIHR5cGUgZmVhdHVyZXMKICAgICAqICB3aXRob3V0IHB1dHRpbmcgdXNlciBjcmVkZW50aWFscyBpbnRvIHRoZSBwYWdlLgogICAgICoKICAgICAqICBQYXJhbWV0ZXJzOgogICAgICogICAgKFN0cmluZykgamlkIC0gVGhlIGZ1bGwgSklEIHRoYXQgaXMgYm91bmQgYnkgdGhlIHNlc3Npb24uCiAgICAgKiAgICAoU3RyaW5nKSBzaWQgLSBUaGUgU0lEIG9mIHRoZSBCT1NIIHNlc3Npb24uCiAgICAgKiAgICAoU3RyaW5nKSByaWQgLSBUaGUgY3VycmVudCBSSUQgb2YgdGhlIEJPU0ggc2Vzc2lvbi4gIFRoaXMgUklECiAgICAgKiAgICAgIHdpbGwgYmUgdXNlZCBieSB0aGUgbmV4dCByZXF1ZXN0LgogICAgICogICAgKEZ1bmN0aW9uKSBjYWxsYmFjayBUaGUgY29ubmVjdCBjYWxsYmFjayBmdW5jdGlvbi4KICAgICAqICAgIChJbnRlZ2VyKSB3YWl0IC0gVGhlIG9wdGlvbmFsIEhUVFBCSU5EIHdhaXQgdmFsdWUuICBUaGlzIGlzIHRoZQogICAgICogICAgICB0aW1lIHRoZSBzZXJ2ZXIgd2lsbCB3YWl0IGJlZm9yZSByZXR1cm5pbmcgYW4gZW1wdHkgcmVzdWx0IGZvcgogICAgICogICAgICBhIHJlcXVlc3QuICBUaGUgZGVmYXVsdCBzZXR0aW5nIG9mIDYwIHNlY29uZHMgaXMgcmVjb21tZW5kZWQuCiAgICAgKiAgICAgIE90aGVyIHNldHRpbmdzIHdpbGwgcmVxdWlyZSB0d2Vha3MgdG8gdGhlIFN0cm9waGUuVElNRU9VVCB2YWx1ZS4KICAgICAqICAgIChJbnRlZ2VyKSBob2xkIC0gVGhlIG9wdGlvbmFsIEhUVFBCSU5EIGhvbGQgdmFsdWUuICBUaGlzIGlzIHRoZQogICAgICogICAgICBudW1iZXIgb2YgY29ubmVjdGlvbnMgdGhlIHNlcnZlciB3aWxsIGhvbGQgYXQgb25lIHRpbWUuICBUaGlzCiAgICAgKiAgICAgIHNob3VsZCBhbG1vc3QgYWx3YXlzIGJlIHNldCB0byAxICh0aGUgZGVmYXVsdCkuCiAgICAgKiAgICAoSW50ZWdlcikgd2luZCAtIFRoZSBvcHRpb25hbCBIVFRCSU5EIHdpbmRvdyB2YWx1ZS4gIFRoaXMgaXMgdGhlCiAgICAgKiAgICAgIGFsbG93ZWQgcmFuZ2Ugb2YgcmVxdWVzdCBpZHMgdGhhdCBhcmUgdmFsaWQuICBUaGUgZGVmYXVsdCBpcyA1LgogICAgICovCiAgICBhdHRhY2g6IGZ1bmN0aW9uIChqaWQsIHNpZCwgcmlkLCBjYWxsYmFjaywgd2FpdCwgaG9sZCwgd2luZCkKICAgIHsKICAgICAgICB0aGlzLl9wcm90by5fYXR0YWNoKGppZCwgc2lkLCByaWQsIGNhbGxiYWNrLCB3YWl0LCBob2xkLCB3aW5kKTsKICAgIH0sCgogICAgLyoqIEZ1bmN0aW9uOiB4bWxJbnB1dAogICAgICogIFVzZXIgb3ZlcnJpZGVhYmxlIGZ1bmN0aW9uIHRoYXQgcmVjZWl2ZXMgWE1MIGRhdGEgY29taW5nIGludG8gdGhlCiAgICAgKiAgY29ubmVjdGlvbi4KICAgICAqCiAgICAgKiAgVGhlIGRlZmF1bHQgZnVuY3Rpb24gZG9lcyBub3RoaW5nLiAgVXNlciBjb2RlIGNhbiBvdmVycmlkZSB0aGlzIHdpdGgKICAgICAqICA+IFN0cm9waGUuQ29ubmVjdGlvbi54bWxJbnB1dCA9IGZ1bmN0aW9uIChlbGVtKSB7CiAgICAgKiAgPiAgICh1c2VyIGNvZGUpCiAgICAgKiAgPiB9OwogICAgICoKICAgICAqICBEdWUgdG8gbGltaXRhdGlvbnMgb2YgY3VycmVudCBCcm93c2VycycgWE1MLVBhcnNlcnMgdGhlIG9wZW5pbmcgYW5kIGNsb3NpbmcKICAgICAqICA8c3RyZWFtPiB0YWcgZm9yIFdlYlNvY2tldC1Db25ub2N0aW9ucyB3aWxsIGJlIHBhc3NlZCBhcyBzZWxmY2xvc2luZyBoZXJlLgogICAgICoKICAgICAqICBCT1NILUNvbm5lY3Rpb25zIHdpbGwgaGF2ZSBhbGwgc3RhbnphcyB3cmFwcGVkIGluIGEgPGJvZHk+IHRhZy4gU2VlCiAgICAgKiAgPFN0cm9waGUuQm9zaC5zdHJpcD4gaWYgeW91IHdhbnQgdG8gc3RyaXAgdGhpcyB0YWcuCiAgICAgKgogICAgICogIFBhcmFtZXRlcnM6CiAgICAgKiAgICAoWE1MRWxlbWVudCkgZWxlbSAtIFRoZSBYTUwgZGF0YSByZWNlaXZlZCBieSB0aGUgY29ubmVjdGlvbi4KICAgICAqLwogICAgLyoganNoaW50IHVudXNlZDpmYWxzZSAqLwogICAgeG1sSW5wdXQ6IGZ1bmN0aW9uIChlbGVtKQogICAgewogICAgICAgIHJldHVybjsKICAgIH0sCiAgICAvKiBqc2hpbnQgdW51c2VkOnRydWUgKi8KCiAgICAvKiogRnVuY3Rpb246IHhtbE91dHB1dAogICAgICogIFVzZXIgb3ZlcnJpZGVhYmxlIGZ1bmN0aW9uIHRoYXQgcmVjZWl2ZXMgWE1MIGRhdGEgc2VudCB0byB0aGUKICAgICAqICBjb25uZWN0aW9uLgogICAgICoKICAgICAqICBUaGUgZGVmYXVsdCBmdW5jdGlvbiBkb2VzIG5vdGhpbmcuICBVc2VyIGNvZGUgY2FuIG92ZXJyaWRlIHRoaXMgd2l0aAogICAgICogID4gU3Ryb3BoZS5Db25uZWN0aW9uLnhtbE91dHB1dCA9IGZ1bmN0aW9uIChlbGVtKSB7CiAgICAgKiAgPiAgICh1c2VyIGNvZGUpCiAgICAgKiAgPiB9OwogICAgICoKICAgICAqICBEdWUgdG8gbGltaXRhdGlvbnMgb2YgY3VycmVudCBCcm93c2VycycgWE1MLVBhcnNlcnMgdGhlIG9wZW5pbmcgYW5kIGNsb3NpbmcKICAgICAqICA8c3RyZWFtPiB0YWcgZm9yIFdlYlNvY2tldC1Db25ub2N0aW9ucyB3aWxsIGJlIHBhc3NlZCBhcyBzZWxmY2xvc2luZyBoZXJlLgogICAgICoKICAgICAqICBCT1NILUNvbm5lY3Rpb25zIHdpbGwgaGF2ZSBhbGwgc3RhbnphcyB3cmFwcGVkIGluIGEgPGJvZHk+IHRhZy4gU2VlCiAgICAgKiAgPFN0cm9waGUuQm9zaC5zdHJpcD4gaWYgeW91IHdhbnQgdG8gc3RyaXAgdGhpcyB0YWcuCiAgICAgKgogICAgICogIFBhcmFtZXRlcnM6CiAgICAgKiAgICAoWE1MRWxlbWVudCkgZWxlbSAtIFRoZSBYTUxkYXRhIHNlbnQgYnkgdGhlIGNvbm5lY3Rpb24uCiAgICAgKi8KICAgIC8qIGpzaGludCB1bnVzZWQ6ZmFsc2UgKi8KICAgIHhtbE91dHB1dDogZnVuY3Rpb24gKGVsZW0pCiAgICB7CiAgICAgICAgcmV0dXJuOwogICAgfSwKICAgIC8qIGpzaGludCB1bnVzZWQ6dHJ1ZSAqLwoKICAgIC8qKiBGdW5jdGlvbjogcmF3SW5wdXQKICAgICAqICBVc2VyIG92ZXJyaWRlYWJsZSBmdW5jdGlvbiB0aGF0IHJlY2VpdmVzIHJhdyBkYXRhIGNvbWluZyBpbnRvIHRoZQogICAgICogIGNvbm5lY3Rpb24uCiAgICAgKgogICAgICogIFRoZSBkZWZhdWx0IGZ1bmN0aW9uIGRvZXMgbm90aGluZy4gIFVzZXIgY29kZSBjYW4gb3ZlcnJpZGUgdGhpcyB3aXRoCiAgICAgKiAgPiBTdHJvcGhlLkNvbm5lY3Rpb24ucmF3SW5wdXQgPSBmdW5jdGlvbiAoZGF0YSkgewogICAgICogID4gICAodXNlciBjb2RlKQogICAgICogID4gfTsKICAgICAqCiAgICAgKiAgUGFyYW1ldGVyczoKICAgICAqICAgIChTdHJpbmcpIGRhdGEgLSBUaGUgZGF0YSByZWNlaXZlZCBieSB0aGUgY29ubmVjdGlvbi4KICAgICAqLwogICAgLyoganNoaW50IHVudXNlZDpmYWxzZSAqLwogICAgcmF3SW5wdXQ6IGZ1bmN0aW9uIChkYXRhKQogICAgewogICAgICAgIHJldHVybjsKICAgIH0sCiAgICAvKiBqc2hpbnQgdW51c2VkOnRydWUgKi8KCiAgICAvKiogRnVuY3Rpb246IHJhd091dHB1dAogICAgICogIFVzZXIgb3ZlcnJpZGVhYmxlIGZ1bmN0aW9uIHRoYXQgcmVjZWl2ZXMgcmF3IGRhdGEgc2VudCB0byB0aGUKICAgICAqICBjb25uZWN0aW9uLgogICAgICoKICAgICAqICBUaGUgZGVmYXVsdCBmdW5jdGlvbiBkb2VzIG5vdGhpbmcuICBVc2VyIGNvZGUgY2FuIG92ZXJyaWRlIHRoaXMgd2l0aAogICAgICogID4gU3Ryb3BoZS5Db25uZWN0aW9uLnJhd091dHB1dCA9IGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgKiAgPiAgICh1c2VyIGNvZGUpCiAgICAgKiAgPiB9OwogICAgICoKICAgICAqICBQYXJhbWV0ZXJzOgogICAgICogICAgKFN0cmluZykgZGF0YSAtIFRoZSBkYXRhIHNlbnQgYnkgdGhlIGNvbm5lY3Rpb24uCiAgICAgKi8KICAgIC8qIGpzaGludCB1bnVzZWQ6ZmFsc2UgKi8KICAgIHJhd091dHB1dDogZnVuY3Rpb24gKGRhdGEpCiAgICB7CiAgICAgICAgcmV0dXJuOwogICAgfSwKICAgIC8qIGpzaGludCB1bnVzZWQ6dHJ1ZSAqLwoKICAgIC8qKiBGdW5jdGlvbjogc2VuZAogICAgICogIFNlbmQgYSBzdGFuemEuCiAgICAgKgogICAgICogIFRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIHRvIHB1c2ggZGF0YSBvbnRvIHRoZSBzZW5kIHF1ZXVlIHRvCiAgICAgKiAgZ28gb3V0IG92ZXIgdGhlIHdpcmUuICBXaGVuZXZlciBhIHJlcXVlc3QgaXMgc2VudCB0byB0aGUgQk9TSAogICAgICogIHNlcnZlciwgYWxsIHBlbmRpbmcgZGF0YSBpcyBzZW50IGFuZCB0aGUgcXVldWUgaXMgZmx1c2hlZC4KICAgICAqCiAgICAgKiAgUGFyYW1ldGVyczoKICAgICAqICAgIChYTUxFbGVtZW50IHwKICAgICAqICAgICBbWE1MRWxlbWVudF0gfAogICAgICogICAgIFN0cm9waGUuQnVpbGRlcikgZWxlbSAtIFRoZSBzdGFuemEgdG8gc2VuZC4KICAgICAqLwogICAgc2VuZDogZnVuY3Rpb24gKGVsZW0pCiAgICB7CiAgICAgICAgaWYgKGVsZW0gPT09IG51bGwpIHsgcmV0dXJuIDsgfQogICAgICAgIGlmICh0eXBlb2YoZWxlbS5zb3J0KSA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGVsZW0ubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIHRoaXMuX3F1ZXVlRGF0YShlbGVtW2ldKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAodHlwZW9mKGVsZW0udHJlZSkgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgdGhpcy5fcXVldWVEYXRhKGVsZW0udHJlZSgpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLl9xdWV1ZURhdGEoZWxlbSk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLl9wcm90by5fc2VuZCgpOwogICAgfSwKCiAgICAvKiogRnVuY3Rpb246IGZsdXNoCiAgICAgKiAgSW1tZWRpYXRlbHkgc2VuZCBhbnkgcGVuZGluZyBvdXRnb2luZyBkYXRhLgogICAgICoKICAgICAqICBOb3JtYWxseSBzZW5kKCkgcXVldWVzIG91dGdvaW5nIGRhdGEgdW50aWwgdGhlIG5leHQgaWRsZSBwZXJpb2QKICAgICAqICAoMTAwbXMpLCB3aGljaCBvcHRpbWl6ZXMgbmV0d29yayB1c2UgaW4gdGhlIGNvbW1vbiBjYXNlcyB3aGVuCiAgICAgKiAgc2V2ZXJhbCBzZW5kKClzIGFyZSBjYWxsZWQgaW4gc3VjY2Vzc2lvbi4gZmx1c2goKSBjYW4gYmUgdXNlZCB0bwogICAgICogIGltbWVkaWF0ZWx5IHNlbmQgYWxsIHBlbmRpbmcgZGF0YS4KICAgICAqLwogICAgZmx1c2g6IGZ1bmN0aW9uICgpCiAgICB7CiAgICAgICAgLy8gY2FuY2VsIHRoZSBwZW5kaW5nIGlkbGUgcGVyaW9kIGFuZCBydW4gdGhlIGlkbGUgZnVuY3Rpb24KICAgICAgICAvLyBpbW1lZGlhdGVseQogICAgICAgIGNsZWFyVGltZW91dCh0aGlzLl9pZGxlVGltZW91dCk7CiAgICAgICAgdGhpcy5fb25JZGxlKCk7CiAgICB9LAoKICAgIC8qKiBGdW5jdGlvbjogc2VuZElRCiAgICAgKiAgSGVscGVyIGZ1bmN0aW9uIHRvIHNlbmQgSVEgc3Rhbnphcy4KICAgICAqCiAgICAgKiAgUGFyYW1ldGVyczoKICAgICAqICAgIChYTUxFbGVtZW50KSBlbGVtIC0gVGhlIHN0YW56YSB0byBzZW5kLgogICAgICogICAgKEZ1bmN0aW9uKSBjYWxsYmFjayAtIFRoZSBjYWxsYmFjayBmdW5jdGlvbiBmb3IgYSBzdWNjZXNzZnVsIHJlcXVlc3QuCiAgICAgKiAgICAoRnVuY3Rpb24pIGVycmJhY2sgLSBUaGUgY2FsbGJhY2sgZnVuY3Rpb24gZm9yIGEgZmFpbGVkIG9yIHRpbWVkCiAgICAgKiAgICAgIG91dCByZXF1ZXN0LiAgT24gdGltZW91dCwgdGhlIHN0YW56YSB3aWxsIGJlIG51bGwuCiAgICAgKiAgICAoSW50ZWdlcikgdGltZW91dCAtIFRoZSB0aW1lIHNwZWNpZmllZCBpbiBtaWxsaXNlY29uZHMgZm9yIGEKICAgICAqICAgICAgdGltZW91dCB0byBvY2N1ci4KICAgICAqCiAgICAgKiAgUmV0dXJuczoKICAgICAqICAgIFRoZSBpZCB1c2VkIHRvIHNlbmQgdGhlIElRLgogICAgKi8KICAgIHNlbmRJUTogZnVuY3Rpb24oZWxlbSwgY2FsbGJhY2ssIGVycmJhY2ssIHRpbWVvdXQpIHsKICAgICAgICB2YXIgdGltZW91dEhhbmRsZXIgPSBudWxsOwogICAgICAgIHZhciB0aGF0ID0gdGhpczsKCiAgICAgICAgaWYgKHR5cGVvZihlbGVtLnRyZWUpID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICAgIGVsZW0gPSBlbGVtLnRyZWUoKTsKICAgICAgICB9CiAgICAgICAgdmFyIGlkID0gZWxlbS5nZXRBdHRyaWJ1dGUoJ2lkJyk7CgogICAgICAgIC8vIGluamVjdCBpZCBpZiBub3QgZm91bmQKICAgICAgICBpZiAoIWlkKSB7CiAgICAgICAgICAgIGlkID0gdGhpcy5nZXRVbmlxdWVJZCgic2VuZElRIik7CiAgICAgICAgICAgIGVsZW0uc2V0QXR0cmlidXRlKCJpZCIsIGlkKTsKICAgICAgICB9CgogICAgICAgIHZhciBoYW5kbGVyID0gdGhpcy5hZGRIYW5kbGVyKGZ1bmN0aW9uIChzdGFuemEpIHsKICAgICAgICAgICAgLy8gcmVtb3ZlIHRpbWVvdXQgaGFuZGxlciBpZiB0aGVyZSBpcyBvbmUKICAgICAgICAgICAgaWYgKHRpbWVvdXRIYW5kbGVyKSB7CiAgICAgICAgICAgICAgICB0aGF0LmRlbGV0ZVRpbWVkSGFuZGxlcih0aW1lb3V0SGFuZGxlcik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBpcXR5cGUgPSBzdGFuemEuZ2V0QXR0cmlidXRlKCd0eXBlJyk7CiAgICAgICAgICAgIGlmIChpcXR5cGUgPT0gJ3Jlc3VsdCcpIHsKICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykgewogICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKHN0YW56YSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAoaXF0eXBlID09ICdlcnJvcicpIHsKICAgICAgICAgICAgICAgIGlmIChlcnJiYWNrKSB7CiAgICAgICAgICAgICAgICAgICAgZXJyYmFjayhzdGFuemEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhyb3cgewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJvcGhlRXJyb3IiLAogICAgICAgICAgICBtZXNzYWdlOiAiR290IGJhZCBJUSB0eXBlIG9mICIgKyBpcXR5cGUKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICB9LCBudWxsLCAnaXEnLCBudWxsLCBpZCk7CgogICAgICAgIC8vIGlmIHRpbWVvdXQgc3BlY2lmaWVkLCBzZXR1cCB0aW1lb3V0IGhhbmRsZXIuCiAgICAgICAgaWYgKHRpbWVvdXQpIHsKICAgICAgICAgICAgdGltZW91dEhhbmRsZXIgPSB0aGlzLmFkZFRpbWVkSGFuZGxlcih0aW1lb3V0LCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAvLyBnZXQgcmlkIG9mIG5vcm1hbCBoYW5kbGVyCiAgICAgICAgICAgICAgICB0aGF0LmRlbGV0ZUhhbmRsZXIoaGFuZGxlcik7CgogICAgICAgICAgICAgICAgLy8gY2FsbCBlcnJiYWNrIG9uIHRpbWVvdXQgd2l0aCBudWxsIHN0YW56YQogICAgICAgICAgICAgICAgaWYgKGVycmJhY2spIHsKICAgICAgICAgICAgICAgICAgICBlcnJiYWNrKG51bGwpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIHRoaXMuc2VuZChlbGVtKTsKCiAgICAgICAgcmV0dXJuIGlkOwogICAgfSwKCiAgICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiBfcXVldWVEYXRhCiAgICAgKiAgUXVldWUgb3V0Z29pbmcgZGF0YSBmb3IgbGF0ZXIgc2VuZGluZy4gIEFsc28gZW5zdXJlcyB0aGF0IHRoZSBkYXRhCiAgICAgKiAgaXMgYSBET01FbGVtZW50LgogICAgICovCiAgICBfcXVldWVEYXRhOiBmdW5jdGlvbiAoZWxlbWVudCkgewogICAgICAgIGlmIChlbGVtZW50ID09PSBudWxsIHx8CiAgICAgICAgICAgICFlbGVtZW50LnRhZ05hbWUgfHwKICAgICAgICAgICAgIWVsZW1lbnQuY2hpbGROb2RlcykgewogICAgICAgICAgICB0aHJvdyB7CiAgICAgICAgICAgICAgICBuYW1lOiAiU3Ryb3BoZUVycm9yIiwKICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICJDYW5ub3QgcXVldWUgbm9uLURPTUVsZW1lbnQuIgogICAgICAgICAgICB9OwogICAgICAgIH0KCiAgICAgICAgdGhpcy5fZGF0YS5wdXNoKGVsZW1lbnQpOwogICAgfSwKCiAgICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiBfc2VuZFJlc3RhcnQKICAgICAqICBTZW5kIGFuIHhtcHA6cmVzdGFydCBzdGFuemEuCiAgICAgKi8KICAgIF9zZW5kUmVzdGFydDogZnVuY3Rpb24gKCkKICAgIHsKICAgICAgICB0aGlzLl9kYXRhLnB1c2goInJlc3RhcnQiKTsKCiAgICAgICAgdGhpcy5fcHJvdG8uX3NlbmRSZXN0YXJ0KCk7CgogICAgICAgIHRoaXMuX2lkbGVUaW1lb3V0ID0gc2V0VGltZW91dCh0aGlzLl9vbklkbGUuYmluZCh0aGlzKSwgMTAwKTsKICAgIH0sCgogICAgLyoqIEZ1bmN0aW9uOiBhZGRUaW1lZEhhbmRsZXIKICAgICAqICBBZGQgYSB0aW1lZCBoYW5kbGVyIHRvIHRoZSBjb25uZWN0aW9uLgogICAgICoKICAgICAqICBUaGlzIGZ1bmN0aW9uIGFkZHMgYSB0aW1lZCBoYW5kbGVyLiAgVGhlIHByb3ZpZGVkIGhhbmRsZXIgd2lsbAogICAgICogIGJlIGNhbGxlZCBldmVyeSBwZXJpb2QgbWlsbGlzZWNvbmRzIHVudGlsIGl0IHJldHVybnMgZmFsc2UsCiAgICAgKiAgdGhlIGNvbm5lY3Rpb24gaXMgdGVybWluYXRlZCwgb3IgdGhlIGhhbmRsZXIgaXMgcmVtb3ZlZC4gIEhhbmRsZXJzCiAgICAgKiAgdGhhdCB3aXNoIHRvIGNvbnRpbnVlIGJlaW5nIGludm9rZWQgc2hvdWxkIHJldHVybiB0cnVlLgogICAgICoKICAgICAqICBCZWNhdXNlIG9mIG1ldGhvZCBiaW5kaW5nIGl0IGlzIG5lY2Vzc2FyeSB0byBzYXZlIHRoZSByZXN1bHQgb2YKICAgICAqICB0aGlzIGZ1bmN0aW9uIGlmIHlvdSB3aXNoIHRvIHJlbW92ZSBhIGhhbmRsZXIgd2l0aAogICAgICogIGRlbGV0ZVRpbWVkSGFuZGxlcigpLgogICAgICoKICAgICAqICBOb3RlIHRoYXQgdXNlciBoYW5kbGVycyBhcmUgbm90IGFjdGl2ZSB1bnRpbCBhdXRoZW50aWNhdGlvbiBpcwogICAgICogIHN1Y2Nlc3NmdWwuCiAgICAgKgogICAgICogIFBhcmFtZXRlcnM6CiAgICAgKiAgICAoSW50ZWdlcikgcGVyaW9kIC0gVGhlIHBlcmlvZCBvZiB0aGUgaGFuZGxlci4KICAgICAqICAgIChGdW5jdGlvbikgaGFuZGxlciAtIFRoZSBjYWxsYmFjayBmdW5jdGlvbi4KICAgICAqCiAgICAgKiAgUmV0dXJuczoKICAgICAqICAgIEEgcmVmZXJlbmNlIHRvIHRoZSBoYW5kbGVyIHRoYXQgY2FuIGJlIHVzZWQgdG8gcmVtb3ZlIGl0LgogICAgICovCiAgICBhZGRUaW1lZEhhbmRsZXI6IGZ1bmN0aW9uIChwZXJpb2QsIGhhbmRsZXIpCiAgICB7CiAgICAgICAgdmFyIHRoYW5kID0gbmV3IFN0cm9waGUuVGltZWRIYW5kbGVyKHBlcmlvZCwgaGFuZGxlcik7CiAgICAgICAgdGhpcy5hZGRUaW1lZHMucHVzaCh0aGFuZCk7CiAgICAgICAgcmV0dXJuIHRoYW5kOwogICAgfSwKCiAgICAvKiogRnVuY3Rpb246IGRlbGV0ZVRpbWVkSGFuZGxlcgogICAgICogIERlbGV0ZSBhIHRpbWVkIGhhbmRsZXIgZm9yIGEgY29ubmVjdGlvbi4KICAgICAqCiAgICAgKiAgVGhpcyBmdW5jdGlvbiByZW1vdmVzIGEgdGltZWQgaGFuZGxlciBmcm9tIHRoZSBjb25uZWN0aW9uLiAgVGhlCiAgICAgKiAgaGFuZFJlZiBwYXJhbWV0ZXIgaXMgKm5vdCogdGhlIGZ1bmN0aW9uIHBhc3NlZCB0byBhZGRUaW1lZEhhbmRsZXIoKSwKICAgICAqICBidXQgaXMgdGhlIHJlZmVyZW5jZSByZXR1cm5lZCBmcm9tIGFkZFRpbWVkSGFuZGxlcigpLgogICAgICoKICAgICAqICBQYXJhbWV0ZXJzOgogICAgICogICAgKFN0cm9waGUuVGltZWRIYW5kbGVyKSBoYW5kUmVmIC0gVGhlIGhhbmRsZXIgcmVmZXJlbmNlLgogICAgICovCiAgICBkZWxldGVUaW1lZEhhbmRsZXI6IGZ1bmN0aW9uIChoYW5kUmVmKQogICAgewogICAgICAgIC8vIHRoaXMgbXVzdCBiZSBkb25lIGluIHRoZSBJZGxlIGxvb3Agc28gdGhhdCB3ZSBkb24ndCBjaGFuZ2UKICAgICAgICAvLyB0aGUgaGFuZGxlcnMgZHVyaW5nIGl0ZXJhdGlvbgogICAgICAgIHRoaXMucmVtb3ZlVGltZWRzLnB1c2goaGFuZFJlZik7CiAgICB9LAoKICAgIC8qKiBGdW5jdGlvbjogYWRkSGFuZGxlcgogICAgICogIEFkZCBhIHN0YW56YSBoYW5kbGVyIGZvciB0aGUgY29ubmVjdGlvbi4KICAgICAqCiAgICAgKiAgVGhpcyBmdW5jdGlvbiBhZGRzIGEgc3RhbnphIGhhbmRsZXIgdG8gdGhlIGNvbm5lY3Rpb24uICBUaGUKICAgICAqICBoYW5kbGVyIGNhbGxiYWNrIHdpbGwgYmUgY2FsbGVkIGZvciBhbnkgc3RhbnphIHRoYXQgbWF0Y2hlcwogICAgICogIHRoZSBwYXJhbWV0ZXJzLiAgTm90ZSB0aGF0IGlmIG11bHRpcGxlIHBhcmFtZXRlcnMgYXJlIHN1cHBsaWVkLAogICAgICogIHRoZXkgbXVzdCBhbGwgbWF0Y2ggZm9yIHRoZSBoYW5kbGVyIHRvIGJlIGludm9rZWQuCiAgICAgKgogICAgICogIFRoZSBoYW5kbGVyIHdpbGwgcmVjZWl2ZSB0aGUgc3RhbnphIHRoYXQgdHJpZ2dlcmVkIGl0IGFzIGl0cyBhcmd1bWVudC4KICAgICAqICBUaGUgaGFuZGxlciBzaG91bGQgcmV0dXJuIHRydWUgaWYgaXQgaXMgdG8gYmUgaW52b2tlZCBhZ2FpbjsKICAgICAqICByZXR1cm5pbmcgZmFsc2Ugd2lsbCByZW1vdmUgdGhlIGhhbmRsZXIgYWZ0ZXIgaXQgcmV0dXJucy4KICAgICAqCiAgICAgKiAgQXMgYSBjb252ZW5pZW5jZSwgdGhlIG5zIHBhcmFtZXRlcnMgYXBwbGllcyB0byB0aGUgdG9wIGxldmVsIGVsZW1lbnQKICAgICAqICBhbmQgYWxzbyBhbnkgb2YgaXRzIGltbWVkaWF0ZSBjaGlsZHJlbi4gIFRoaXMgaXMgcHJpbWFyaWx5IHRvIG1ha2UKICAgICAqICBtYXRjaGluZyAvaXEvcXVlcnkgZWxlbWVudHMgZWFzeS4KICAgICAqCiAgICAgKiAgVGhlIG9wdGlvbnMgYXJndW1lbnQgY29udGFpbnMgaGFuZGxlciBtYXRjaGluZyBmbGFncyB0aGF0IGFmZmVjdCBob3cKICAgICAqICBtYXRjaGVzIGFyZSBkZXRlcm1pbmVkLiBDdXJyZW50bHkgdGhlIG9ubHkgZmxhZyBpcyBtYXRjaEJhcmUgKGEKICAgICAqICBib29sZWFuKS4gV2hlbiBtYXRjaEJhcmUgaXMgdHJ1ZSwgdGhlIGZyb20gcGFyYW1ldGVyIGFuZCB0aGUgZnJvbQogICAgICogIGF0dHJpYnV0ZSBvbiB0aGUgc3RhbnphIHdpbGwgYmUgbWF0Y2hlZCBhcyBiYXJlIEpJRHMgaW5zdGVhZCBvZgogICAgICogIGZ1bGwgSklEcy4gVG8gdXNlIHRoaXMsIHBhc3Mge21hdGNoQmFyZTogdHJ1ZX0gYXMgdGhlIHZhbHVlIG9mCiAgICAgKiAgb3B0aW9ucy4gVGhlIGRlZmF1bHQgdmFsdWUgZm9yIG1hdGNoQmFyZSBpcyBmYWxzZS4KICAgICAqCiAgICAgKiAgVGhlIHJldHVybiB2YWx1ZSBzaG91bGQgYmUgc2F2ZWQgaWYgeW91IHdpc2ggdG8gcmVtb3ZlIHRoZSBoYW5kbGVyCiAgICAgKiAgd2l0aCBkZWxldGVIYW5kbGVyKCkuCiAgICAgKgogICAgICogIFBhcmFtZXRlcnM6CiAgICAgKiAgICAoRnVuY3Rpb24pIGhhbmRsZXIgLSBUaGUgdXNlciBjYWxsYmFjay4KICAgICAqICAgIChTdHJpbmcpIG5zIC0gVGhlIG5hbWVzcGFjZSB0byBtYXRjaC4KICAgICAqICAgIChTdHJpbmcpIG5hbWUgLSBUaGUgc3RhbnphIG5hbWUgdG8gbWF0Y2guCiAgICAgKiAgICAoU3RyaW5nKSB0eXBlIC0gVGhlIHN0YW56YSB0eXBlIGF0dHJpYnV0ZSB0byBtYXRjaC4KICAgICAqICAgIChTdHJpbmcpIGlkIC0gVGhlIHN0YW56YSBpZCBhdHRyaWJ1dGUgdG8gbWF0Y2guCiAgICAgKiAgICAoU3RyaW5nKSBmcm9tIC0gVGhlIHN0YW56YSBmcm9tIGF0dHJpYnV0ZSB0byBtYXRjaC4KICAgICAqICAgIChTdHJpbmcpIG9wdGlvbnMgLSBUaGUgaGFuZGxlciBvcHRpb25zCiAgICAgKgogICAgICogIFJldHVybnM6CiAgICAgKiAgICBBIHJlZmVyZW5jZSB0byB0aGUgaGFuZGxlciB0aGF0IGNhbiBiZSB1c2VkIHRvIHJlbW92ZSBpdC4KICAgICAqLwogICAgYWRkSGFuZGxlcjogZnVuY3Rpb24gKGhhbmRsZXIsIG5zLCBuYW1lLCB0eXBlLCBpZCwgZnJvbSwgb3B0aW9ucykKICAgIHsKICAgICAgICB2YXIgaGFuZCA9IG5ldyBTdHJvcGhlLkhhbmRsZXIoaGFuZGxlciwgbnMsIG5hbWUsIHR5cGUsIGlkLCBmcm9tLCBvcHRpb25zKTsKICAgICAgICB0aGlzLmFkZEhhbmRsZXJzLnB1c2goaGFuZCk7CiAgICAgICAgcmV0dXJuIGhhbmQ7CiAgICB9LAoKICAgIC8qKiBGdW5jdGlvbjogZGVsZXRlSGFuZGxlcgogICAgICogIERlbGV0ZSBhIHN0YW56YSBoYW5kbGVyIGZvciBhIGNvbm5lY3Rpb24uCiAgICAgKgogICAgICogIFRoaXMgZnVuY3Rpb24gcmVtb3ZlcyBhIHN0YW56YSBoYW5kbGVyIGZyb20gdGhlIGNvbm5lY3Rpb24uICBUaGUKICAgICAqICBoYW5kUmVmIHBhcmFtZXRlciBpcyAqbm90KiB0aGUgZnVuY3Rpb24gcGFzc2VkIHRvIGFkZEhhbmRsZXIoKSwKICAgICAqICBidXQgaXMgdGhlIHJlZmVyZW5jZSByZXR1cm5lZCBmcm9tIGFkZEhhbmRsZXIoKS4KICAgICAqCiAgICAgKiAgUGFyYW1ldGVyczoKICAgICAqICAgIChTdHJvcGhlLkhhbmRsZXIpIGhhbmRSZWYgLSBUaGUgaGFuZGxlciByZWZlcmVuY2UuCiAgICAgKi8KICAgIGRlbGV0ZUhhbmRsZXI6IGZ1bmN0aW9uIChoYW5kUmVmKQogICAgewogICAgICAgIC8vIHRoaXMgbXVzdCBiZSBkb25lIGluIHRoZSBJZGxlIGxvb3Agc28gdGhhdCB3ZSBkb24ndCBjaGFuZ2UKICAgICAgICAvLyB0aGUgaGFuZGxlcnMgZHVyaW5nIGl0ZXJhdGlvbgogICAgICAgIHRoaXMucmVtb3ZlSGFuZGxlcnMucHVzaChoYW5kUmVmKTsKICAgIH0sCgogICAgLyoqIEZ1bmN0aW9uOiBkaXNjb25uZWN0CiAgICAgKiAgU3RhcnQgdGhlIGdyYWNlZnVsIGRpc2Nvbm5lY3Rpb24gcHJvY2Vzcy4KICAgICAqCiAgICAgKiAgVGhpcyBmdW5jdGlvbiBzdGFydHMgdGhlIGRpc2Nvbm5lY3Rpb24gcHJvY2Vzcy4gIFRoaXMgcHJvY2VzcyBzdGFydHMKICAgICAqICBieSBzZW5kaW5nIHVuYXZhaWxhYmxlIHByZXNlbmNlIGFuZCBzZW5kaW5nIEJPU0ggYm9keSBvZiB0eXBlCiAgICAgKiAgdGVybWluYXRlLiAgQSB0aW1lb3V0IGhhbmRsZXIgbWFrZXMgc3VyZSB0aGF0IGRpc2Nvbm5lY3Rpb24gaGFwcGVucwogICAgICogIGV2ZW4gaWYgdGhlIEJPU0ggc2VydmVyIGRvZXMgbm90IHJlc3BvbmQuCiAgICAgKgogICAgICogIFRoZSB1c2VyIHN1cHBsaWVkIGNvbm5lY3Rpb24gY2FsbGJhY2sgd2lsbCBiZSBub3RpZmllZCBvZiB0aGUKICAgICAqICBwcm9ncmVzcyBhcyB0aGlzIHByb2Nlc3MgaGFwcGVucy4KICAgICAqCiAgICAgKiAgUGFyYW1ldGVyczoKICAgICAqICAgIChTdHJpbmcpIHJlYXNvbiAtIFRoZSByZWFzb24gdGhlIGRpc2Nvbm5lY3QgaXMgb2NjdXJpbmcuCiAgICAgKi8KICAgIGRpc2Nvbm5lY3Q6IGZ1bmN0aW9uIChyZWFzb24pCiAgICB7CiAgICAgICAgdGhpcy5fY2hhbmdlQ29ubmVjdFN0YXR1cyhTdHJvcGhlLlN0YXR1cy5ESVNDT05ORUNUSU5HLCByZWFzb24pOwoKICAgICAgICBTdHJvcGhlLmluZm8oIkRpc2Nvbm5lY3Qgd2FzIGNhbGxlZCBiZWNhdXNlOiAiICsgcmVhc29uKTsKICAgICAgICBpZiAodGhpcy5jb25uZWN0ZWQpIHsKICAgICAgICAgICAgdmFyIHByZXMgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5kaXNjb25uZWN0aW5nID0gdHJ1ZTsKICAgICAgICAgICAgaWYgKHRoaXMuYXV0aGVudGljYXRlZCkgewogICAgICAgICAgICAgICAgcHJlcyA9ICRwcmVzKHsKICAgICAgICAgICAgICAgICAgICB4bWxuczogU3Ryb3BoZS5OUy5DTElFTlQsCiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3VuYXZhaWxhYmxlJwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gc2V0dXAgdGltZW91dCBoYW5kbGVyCiAgICAgICAgICAgIHRoaXMuX2Rpc2Nvbm5lY3RUaW1lb3V0ID0gdGhpcy5fYWRkU3lzVGltZWRIYW5kbGVyKAogICAgICAgICAgICAgICAgMzAwMCwgdGhpcy5fb25EaXNjb25uZWN0VGltZW91dC5iaW5kKHRoaXMpKTsKICAgICAgICAgICAgdGhpcy5fcHJvdG8uX2Rpc2Nvbm5lY3QocHJlcyk7CiAgICAgICAgfQogICAgfSwKCiAgICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiBfY2hhbmdlQ29ubmVjdFN0YXR1cwogICAgICogIF9Qcml2YXRlXyBoZWxwZXIgZnVuY3Rpb24gdGhhdCBtYWtlcyBzdXJlIHBsdWdpbnMgYW5kIHRoZSB1c2VyJ3MKICAgICAqICBjYWxsYmFjayBhcmUgbm90aWZpZWQgb2YgY29ubmVjdGlvbiBzdGF0dXMgY2hhbmdlcy4KICAgICAqCiAgICAgKiAgUGFyYW1ldGVyczoKICAgICAqICAgIChJbnRlZ2VyKSBzdGF0dXMgLSB0aGUgbmV3IGNvbm5lY3Rpb24gc3RhdHVzLCBvbmUgb2YgdGhlIHZhbHVlcwogICAgICogICAgICBpbiBTdHJvcGhlLlN0YXR1cwogICAgICogICAgKFN0cmluZykgY29uZGl0aW9uIC0gdGhlIGVycm9yIGNvbmRpdGlvbiBvciBudWxsCiAgICAgKi8KICAgIF9jaGFuZ2VDb25uZWN0U3RhdHVzOiBmdW5jdGlvbiAoc3RhdHVzLCBjb25kaXRpb24pCiAgICB7CiAgICAgICAgLy8gbm90aWZ5IGFsbCBwbHVnaW5zIGxpc3RlbmluZyBmb3Igc3RhdHVzIGNoYW5nZXMKICAgICAgICBmb3IgKHZhciBrIGluIFN0cm9waGUuX2Nvbm5lY3Rpb25QbHVnaW5zKSB7CiAgICAgICAgICAgIGlmIChTdHJvcGhlLl9jb25uZWN0aW9uUGx1Z2lucy5oYXNPd25Qcm9wZXJ0eShrKSkgewogICAgICAgICAgICAgICAgdmFyIHBsdWdpbiA9IHRoaXNba107CiAgICAgICAgICAgICAgICBpZiAocGx1Z2luLnN0YXR1c0NoYW5nZWQpIHsKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICBwbHVnaW4uc3RhdHVzQ2hhbmdlZChzdGF0dXMsIGNvbmRpdGlvbik7CiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIFN0cm9waGUuZXJyb3IoIiIgKyBrICsgIiBwbHVnaW4gY2F1c2VkIGFuIGV4Y2VwdGlvbiAiICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiY2hhbmdpbmcgc3RhdHVzOiAiICsgZXJyKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIG5vdGlmeSB0aGUgdXNlcidzIGNhbGxiYWNrCiAgICAgICAgaWYgKHRoaXMuY29ubmVjdF9jYWxsYmFjaykgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgdGhpcy5jb25uZWN0X2NhbGxiYWNrKHN0YXR1cywgY29uZGl0aW9uKTsKICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgU3Ryb3BoZS5lcnJvcigiVXNlciBjb25uZWN0aW9uIGNhbGxiYWNrIGNhdXNlZCBhbiAiICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImV4Y2VwdGlvbjogIiArIGUpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSwKCiAgICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiBfZG9EaXNjb25uZWN0CiAgICAgKiAgX1ByaXZhdGVfIGZ1bmN0aW9uIHRvIGRpc2Nvbm5lY3QuCiAgICAgKgogICAgICogIFRoaXMgaXMgdGhlIGxhc3QgcGllY2Ugb2YgdGhlIGRpc2Nvbm5lY3Rpb24gbG9naWMuICBUaGlzIHJlc2V0cyB0aGUKICAgICAqICBjb25uZWN0aW9uIGFuZCBhbGVydHMgdGhlIHVzZXIncyBjb25uZWN0aW9uIGNhbGxiYWNrLgogICAgICovCiAgICBfZG9EaXNjb25uZWN0OiBmdW5jdGlvbiAoKQogICAgewogICAgICAgIC8vIENhbmNlbCBEaXNjb25uZWN0IFRpbWVvdXQKICAgICAgICBpZiAodGhpcy5fZGlzY29ubmVjdFRpbWVvdXQgIT09IG51bGwpIHsKICAgICAgICAgICAgdGhpcy5kZWxldGVUaW1lZEhhbmRsZXIodGhpcy5fZGlzY29ubmVjdFRpbWVvdXQpOwogICAgICAgICAgICB0aGlzLl9kaXNjb25uZWN0VGltZW91dCA9IG51bGw7CiAgICAgICAgfQoKICAgICAgICBTdHJvcGhlLmluZm8oIl9kb0Rpc2Nvbm5lY3Qgd2FzIGNhbGxlZCIpOwogICAgICAgIHRoaXMuX3Byb3RvLl9kb0Rpc2Nvbm5lY3QoKTsKCiAgICAgICAgdGhpcy5hdXRoZW50aWNhdGVkID0gZmFsc2U7CiAgICAgICAgdGhpcy5kaXNjb25uZWN0aW5nID0gZmFsc2U7CgogICAgICAgIC8vIGRlbGV0ZSBoYW5kbGVycwogICAgICAgIHRoaXMuaGFuZGxlcnMgPSBbXTsKICAgICAgICB0aGlzLnRpbWVkSGFuZGxlcnMgPSBbXTsKICAgICAgICB0aGlzLnJlbW92ZVRpbWVkcyA9IFtdOwogICAgICAgIHRoaXMucmVtb3ZlSGFuZGxlcnMgPSBbXTsKICAgICAgICB0aGlzLmFkZFRpbWVkcyA9IFtdOwogICAgICAgIHRoaXMuYWRkSGFuZGxlcnMgPSBbXTsKCiAgICAgICAgLy8gdGVsbCB0aGUgcGFyZW50IHdlIGRpc2Nvbm5lY3RlZAogICAgICAgIHRoaXMuX2NoYW5nZUNvbm5lY3RTdGF0dXMoU3Ryb3BoZS5TdGF0dXMuRElTQ09OTkVDVEVELCBudWxsKTsKICAgICAgICB0aGlzLmNvbm5lY3RlZCA9IGZhbHNlOwogICAgfSwKCiAgICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiBfZGF0YVJlY3YKICAgICAqICBfUHJpdmF0ZV8gaGFuZGxlciB0byBwcm9jZXNzZXMgaW5jb21pbmcgZGF0YSBmcm9tIHRoZSB0aGUgY29ubmVjdGlvbi4KICAgICAqCiAgICAgKiAgRXhjZXB0IGZvciBfY29ubmVjdF9jYiBoYW5kbGluZyB0aGUgaW5pdGlhbCBjb25uZWN0aW9uIHJlcXVlc3QsCiAgICAgKiAgdGhpcyBmdW5jdGlvbiBoYW5kbGVzIHRoZSBpbmNvbWluZyBkYXRhIGZvciBhbGwgcmVxdWVzdHMuICBUaGlzCiAgICAgKiAgZnVuY3Rpb24gYWxzbyBmaXJlcyBzdGFuemEgaGFuZGxlcnMgdGhhdCBtYXRjaCBlYWNoIGluY29taW5nCiAgICAgKiAgc3RhbnphLgogICAgICoKICAgICAqICBQYXJhbWV0ZXJzOgogICAgICogICAgKFN0cm9waGUuUmVxdWVzdCkgcmVxIC0gVGhlIHJlcXVlc3QgdGhhdCBoYXMgZGF0YSByZWFkeS4KICAgICAqICAgIChzdHJpbmcpIHJlcSAtIFRoZSBzdGFuemEgYSByYXcgc3RyaW5nIChvcHRpb25hKS4KICAgICAqLwogICAgX2RhdGFSZWN2OiBmdW5jdGlvbiAocmVxLCByYXcpCiAgICB7CiAgICAgICAgU3Ryb3BoZS5pbmZvKCJfZGF0YVJlY3YgY2FsbGVkIik7CiAgICAgICAgdmFyIGVsZW0gPSB0aGlzLl9wcm90by5fcmVxVG9EYXRhKHJlcSk7CiAgICAgICAgaWYgKGVsZW0gPT09IG51bGwpIHsgcmV0dXJuOyB9CgogICAgICAgIGlmICh0aGlzLnhtbElucHV0ICE9PSBTdHJvcGhlLkNvbm5lY3Rpb24ucHJvdG90eXBlLnhtbElucHV0KSB7CiAgICAgICAgICAgIGlmIChlbGVtLm5vZGVOYW1lID09PSB0aGlzLl9wcm90by5zdHJpcCAmJiBlbGVtLmNoaWxkTm9kZXMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICB0aGlzLnhtbElucHV0KGVsZW0uY2hpbGROb2Rlc1swXSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLnhtbElucHV0KGVsZW0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLnJhd0lucHV0ICE9PSBTdHJvcGhlLkNvbm5lY3Rpb24ucHJvdG90eXBlLnJhd0lucHV0KSB7CiAgICAgICAgICAgIGlmIChyYXcpIHsKICAgICAgICAgICAgICAgIHRoaXMucmF3SW5wdXQocmF3KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMucmF3SW5wdXQoU3Ryb3BoZS5zZXJpYWxpemUoZWxlbSkpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyByZW1vdmUgaGFuZGxlcnMgc2NoZWR1bGVkIGZvciBkZWxldGlvbgogICAgICAgIHZhciBpLCBoYW5kOwogICAgICAgIHdoaWxlICh0aGlzLnJlbW92ZUhhbmRsZXJzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgaGFuZCA9IHRoaXMucmVtb3ZlSGFuZGxlcnMucG9wKCk7CiAgICAgICAgICAgIGkgPSB0aGlzLmhhbmRsZXJzLmluZGV4T2YoaGFuZCk7CiAgICAgICAgICAgIGlmIChpID49IDApIHsKICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlcnMuc3BsaWNlKGksIDEpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBhZGQgaGFuZGxlcnMgc2NoZWR1bGVkIGZvciBhZGRpdGlvbgogICAgICAgIHdoaWxlICh0aGlzLmFkZEhhbmRsZXJzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgdGhpcy5oYW5kbGVycy5wdXNoKHRoaXMuYWRkSGFuZGxlcnMucG9wKCkpOwogICAgICAgIH0KCiAgICAgICAgLy8gaGFuZGxlIGdyYWNlZnVsIGRpc2Nvbm5lY3QKICAgICAgICBpZiAodGhpcy5kaXNjb25uZWN0aW5nICYmIHRoaXMuX3Byb3RvLl9lbXB0eVF1ZXVlKCkpIHsKICAgICAgICAgICAgdGhpcy5fZG9EaXNjb25uZWN0KCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciB0eXAgPSBlbGVtLmdldEF0dHJpYnV0ZSgidHlwZSIpOwogICAgICAgIHZhciBjb25kLCBjb25mbGljdDsKICAgICAgICBpZiAodHlwICE9PSBudWxsICYmIHR5cCA9PSAidGVybWluYXRlIikgewogICAgICAgICAgICAvLyBEb24ndCBwcm9jZXNzIHN0YW56YXMgdGhhdCBjb21lIGluIGFmdGVyIGRpc2Nvbm5lY3QKICAgICAgICAgICAgaWYgKHRoaXMuZGlzY29ubmVjdGluZykgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBhbiBlcnJvciBvY2N1cnJlZAogICAgICAgICAgICBjb25kID0gZWxlbS5nZXRBdHRyaWJ1dGUoImNvbmRpdGlvbiIpOwogICAgICAgICAgICBjb25mbGljdCA9IGVsZW0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoImNvbmZsaWN0Iik7CiAgICAgICAgICAgIGlmIChjb25kICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoY29uZCA9PSAicmVtb3RlLXN0cmVhbS1lcnJvciIgJiYgY29uZmxpY3QubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIGNvbmQgPSAiY29uZmxpY3QiOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5fY2hhbmdlQ29ubmVjdFN0YXR1cyhTdHJvcGhlLlN0YXR1cy5DT05ORkFJTCwgY29uZCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLl9jaGFuZ2VDb25uZWN0U3RhdHVzKFN0cm9waGUuU3RhdHVzLkNPTk5GQUlMLCAidW5rbm93biIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuZGlzY29ubmVjdCgndW5rbm93biBzdHJlYW0tZXJyb3InKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gc2VuZCBlYWNoIGluY29taW5nIHN0YW56YSB0aHJvdWdoIHRoZSBoYW5kbGVyIGNoYWluCiAgICAgICAgdmFyIHRoYXQgPSB0aGlzOwogICAgICAgIFN0cm9waGUuZm9yRWFjaENoaWxkKGVsZW0sIG51bGwsIGZ1bmN0aW9uIChjaGlsZCkgewogICAgICAgICAgICB2YXIgaSwgbmV3TGlzdDsKICAgICAgICAgICAgLy8gcHJvY2VzcyBoYW5kbGVycwogICAgICAgICAgICBuZXdMaXN0ID0gdGhhdC5oYW5kbGVyczsKICAgICAgICAgICAgdGhhdC5oYW5kbGVycyA9IFtdOwogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbmV3TGlzdC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgdmFyIGhhbmQgPSBuZXdMaXN0W2ldOwogICAgICAgICAgICAgICAgLy8gZW5jYXBzdWxhdGUgJ2hhbmRsZXIucnVuJyBub3QgdG8gbG9zZSB0aGUgd2hvbGUgaGFuZGxlciBsaXN0IGlmCiAgICAgICAgICAgICAgICAvLyBvbmUgb2YgdGhlIGhhbmRsZXJzIHRocm93cyBhbiBleGNlcHRpb24KICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGhhbmQuaXNNYXRjaChjaGlsZCkgJiYKICAgICAgICAgICAgICAgICAgICAgICAgKHRoYXQuYXV0aGVudGljYXRlZCB8fCAhaGFuZC51c2VyKSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaGFuZC5ydW4oY2hpbGQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGF0LmhhbmRsZXJzLnB1c2goaGFuZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB0aGF0LmhhbmRsZXJzLnB1c2goaGFuZCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBjYXRjaChlKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gaWYgdGhlIGhhbmRsZXIgdGhyb3dzIGFuIGV4Y2VwdGlvbiwgd2UgY29uc2lkZXIgaXQgYXMgZmFsc2UKICAgICAgICAgICAgICAgICAgICBTdHJvcGhlLndhcm4oJ1JlbW92aW5nIFN0cm9waGUgaGFuZGxlcnMgZHVlIHRvIHVuY2F1Z2h0IGV4Y2VwdGlvbjogJyArIGUubWVzc2FnZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0sCgoKICAgIC8qKiBBdHRyaWJ1dGU6IG1lY2hhbmlzbXMKICAgICAqICBTQVNMIE1lY2hhbmlzbXMgYXZhaWxhYmxlIGZvciBDb25uY2VjdGlvbi4KICAgICAqLwogICAgbWVjaGFuaXNtczoge30sCgogICAgLyoqIFByaXZhdGVGdW5jdGlvbjogX2Nvbm5lY3RfY2IKICAgICAqICBfUHJpdmF0ZV8gaGFuZGxlciBmb3IgaW5pdGlhbCBjb25uZWN0aW9uIHJlcXVlc3QuCiAgICAgKgogICAgICogIFRoaXMgaGFuZGxlciBpcyB1c2VkIHRvIHByb2Nlc3MgdGhlIGluaXRpYWwgY29ubmVjdGlvbiByZXF1ZXN0CiAgICAgKiAgcmVzcG9uc2UgZnJvbSB0aGUgQk9TSCBzZXJ2ZXIuIEl0IGlzIHVzZWQgdG8gc2V0IHVwIGF1dGhlbnRpY2F0aW9uCiAgICAgKiAgaGFuZGxlcnMgYW5kIHN0YXJ0IHRoZSBhdXRoZW50aWNhdGlvbiBwcm9jZXNzLgogICAgICoKICAgICAqICBTQVNMIGF1dGhlbnRpY2F0aW9uIHdpbGwgYmUgYXR0ZW1wdGVkIGlmIGF2YWlsYWJsZSwgb3RoZXJ3aXNlCiAgICAgKiAgdGhlIGNvZGUgd2lsbCBmYWxsIGJhY2sgdG8gbGVnYWN5IGF1dGhlbnRpY2F0aW9uLgogICAgICoKICAgICAqICBQYXJhbWV0ZXJzOgogICAgICogICAgKFN0cm9waGUuUmVxdWVzdCkgcmVxIC0gVGhlIGN1cnJlbnQgcmVxdWVzdC4KICAgICAqICAgIChGdW5jdGlvbikgX2NhbGxiYWNrIC0gbG93IGxldmVsICh4bXBwKSBjb25uZWN0IGNhbGxiYWNrIGZ1bmN0aW9uLgogICAgICogICAgICBVc2VmdWwgZm9yIHBsdWdpbnMgd2l0aCB0aGVpciBvd24geG1wcCBjb25uZWN0IGNhbGxiYWNrICh3aGVuIHRoZWlyKQogICAgICogICAgICB3YW50IHRvIGRvIHNvbWV0aGluZyBzcGVjaWFsKS4KICAgICAqLwogICAgX2Nvbm5lY3RfY2I6IGZ1bmN0aW9uIChyZXEsIF9jYWxsYmFjaywgcmF3KQogICAgewogICAgICAgIFN0cm9waGUuaW5mbygiX2Nvbm5lY3RfY2Igd2FzIGNhbGxlZCIpOwoKICAgICAgICB0aGlzLmNvbm5lY3RlZCA9IHRydWU7CgogICAgICAgIHZhciBib2R5V3JhcCA9IHRoaXMuX3Byb3RvLl9yZXFUb0RhdGEocmVxKTsKICAgICAgICBpZiAoIWJvZHlXcmFwKSB7IHJldHVybjsgfQoKICAgICAgICBpZiAodGhpcy54bWxJbnB1dCAhPT0gU3Ryb3BoZS5Db25uZWN0aW9uLnByb3RvdHlwZS54bWxJbnB1dCkgewogICAgICAgICAgICBpZiAoYm9keVdyYXAubm9kZU5hbWUgPT09IHRoaXMuX3Byb3RvLnN0cmlwICYmIGJvZHlXcmFwLmNoaWxkTm9kZXMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICB0aGlzLnhtbElucHV0KGJvZHlXcmFwLmNoaWxkTm9kZXNbMF0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy54bWxJbnB1dChib2R5V3JhcCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMucmF3SW5wdXQgIT09IFN0cm9waGUuQ29ubmVjdGlvbi5wcm90b3R5cGUucmF3SW5wdXQpIHsKICAgICAgICAgICAgaWYgKHJhdykgewogICAgICAgICAgICAgICAgdGhpcy5yYXdJbnB1dChyYXcpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5yYXdJbnB1dChTdHJvcGhlLnNlcmlhbGl6ZShib2R5V3JhcCkpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB2YXIgY29ubmNoZWNrID0gdGhpcy5fcHJvdG8uX2Nvbm5lY3RfY2IoYm9keVdyYXApOwogICAgICAgIGlmIChjb25uY2hlY2sgPT09IFN0cm9waGUuU3RhdHVzLkNPTk5GQUlMKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHRoaXMuX2F1dGhlbnRpY2F0aW9uLnNhc2xfc2NyYW1fc2hhMSA9IGZhbHNlOwogICAgICAgIHRoaXMuX2F1dGhlbnRpY2F0aW9uLnNhc2xfcGxhaW4gPSBmYWxzZTsKICAgICAgICB0aGlzLl9hdXRoZW50aWNhdGlvbi5zYXNsX2RpZ2VzdF9tZDUgPSBmYWxzZTsKICAgICAgICB0aGlzLl9hdXRoZW50aWNhdGlvbi5zYXNsX2Fub255bW91cyA9IGZhbHNlOwoKICAgICAgICB0aGlzLl9hdXRoZW50aWNhdGlvbi5sZWdhY3lfYXV0aCA9IGZhbHNlOwoKICAgICAgICAvLyBDaGVjayBmb3IgdGhlIHN0cmVhbTpmZWF0dXJlcyB0YWcKICAgICAgICB2YXIgaGFzRmVhdHVyZXMgPSBib2R5V3JhcC5nZXRFbGVtZW50c0J5VGFnTmFtZSgic3RyZWFtOmZlYXR1cmVzIikubGVuZ3RoID4gMDsKICAgICAgICBpZiAoIWhhc0ZlYXR1cmVzKSB7CiAgICAgICAgICAgIGhhc0ZlYXR1cmVzID0gYm9keVdyYXAuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImZlYXR1cmVzIikubGVuZ3RoID4gMDsKICAgICAgICB9CiAgICAgICAgdmFyIG1lY2hhbmlzbXMgPSBib2R5V3JhcC5nZXRFbGVtZW50c0J5VGFnTmFtZSgibWVjaGFuaXNtIik7CiAgICAgICAgdmFyIG1hdGNoZWQgPSBbXTsKICAgICAgICB2YXIgaSwgbWVjaCwgZm91bmRfYXV0aGVudGljYXRpb24gPSBmYWxzZTsKICAgICAgICBpZiAoIWhhc0ZlYXR1cmVzKSB7CiAgICAgICAgICAgIHRoaXMuX3Byb3RvLl9ub19hdXRoX3JlY2VpdmVkKF9jYWxsYmFjayk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKG1lY2hhbmlzbXMubGVuZ3RoID4gMCkgewogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbWVjaGFuaXNtcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgbWVjaCA9IFN0cm9waGUuZ2V0VGV4dChtZWNoYW5pc21zW2ldKTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLm1lY2hhbmlzbXNbbWVjaF0pIG1hdGNoZWQucHVzaCh0aGlzLm1lY2hhbmlzbXNbbWVjaF0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHRoaXMuX2F1dGhlbnRpY2F0aW9uLmxlZ2FjeV9hdXRoID0KICAgICAgICAgICAgYm9keVdyYXAuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImF1dGgiKS5sZW5ndGggPiAwOwogICAgICAgIGZvdW5kX2F1dGhlbnRpY2F0aW9uID0gdGhpcy5fYXV0aGVudGljYXRpb24ubGVnYWN5X2F1dGggfHwKICAgICAgICAgICAgbWF0Y2hlZC5sZW5ndGggPiAwOwogICAgICAgIGlmICghZm91bmRfYXV0aGVudGljYXRpb24pIHsKICAgICAgICAgICAgdGhpcy5fcHJvdG8uX25vX2F1dGhfcmVjZWl2ZWQoX2NhbGxiYWNrKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAodGhpcy5kb19hdXRoZW50aWNhdGlvbiAhPT0gZmFsc2UpCiAgICAgICAgICAgIHRoaXMuYXV0aGVudGljYXRlKG1hdGNoZWQpOwogICAgfSwKCiAgICAvKiogRnVuY3Rpb246IGF1dGhlbnRpY2F0ZQogICAgICogU2V0IHVwIGF1dGhlbnRpY2F0aW9uCiAgICAgKgogICAgICogIENvbnRpdW51ZXMgdGhlIGluaXRpYWwgY29ubmVjdGlvbiByZXF1ZXN0IGJ5IHNldHRpbmcgdXAgYXV0aGVudGljYXRpb24KICAgICAqICBoYW5kbGVycyBhbmQgc3RhcnQgdGhlIGF1dGhlbnRpY2F0aW9uIHByb2Nlc3MuCiAgICAgKgogICAgICogIFNBU0wgYXV0aGVudGljYXRpb24gd2lsbCBiZSBhdHRlbXB0ZWQgaWYgYXZhaWxhYmxlLCBvdGhlcndpc2UKICAgICAqICB0aGUgY29kZSB3aWxsIGZhbGwgYmFjayB0byBsZWdhY3kgYXV0aGVudGljYXRpb24uCiAgICAgKgogICAgICovCiAgICBhdXRoZW50aWNhdGU6IGZ1bmN0aW9uIChtYXRjaGVkKQogICAgewogICAgICB2YXIgaTsKICAgICAgLy8gU29ydGluZyBtYXRjaGVkIG1lY2hhbmlzbXMgYWNjb3JkaW5nIHRvIHByaW9yaXR5LgogICAgICBmb3IgKGkgPSAwOyBpIDwgbWF0Y2hlZC5sZW5ndGggLSAxOyArK2kpIHsKICAgICAgICB2YXIgaGlnaGVyID0gaTsKICAgICAgICBmb3IgKHZhciBqID0gaSArIDE7IGogPCBtYXRjaGVkLmxlbmd0aDsgKytqKSB7CiAgICAgICAgICBpZiAobWF0Y2hlZFtqXS5wcm90b3R5cGUucHJpb3JpdHkgPiBtYXRjaGVkW2hpZ2hlcl0ucHJvdG90eXBlLnByaW9yaXR5KSB7CiAgICAgICAgICAgIGhpZ2hlciA9IGo7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChoaWdoZXIgIT0gaSkgewogICAgICAgICAgdmFyIHN3YXAgPSBtYXRjaGVkW2ldOwogICAgICAgICAgbWF0Y2hlZFtpXSA9IG1hdGNoZWRbaGlnaGVyXTsKICAgICAgICAgIG1hdGNoZWRbaGlnaGVyXSA9IHN3YXA7CiAgICAgICAgfQogICAgICB9CgogICAgICAvLyBydW4gZWFjaCBtZWNoYW5pc20KICAgICAgdmFyIG1lY2hhbmlzbV9mb3VuZCA9IGZhbHNlOwogICAgICBmb3IgKGkgPSAwOyBpIDwgbWF0Y2hlZC5sZW5ndGg7ICsraSkgewogICAgICAgIGlmICghbWF0Y2hlZFtpXS50ZXN0KHRoaXMpKSBjb250aW51ZTsKCiAgICAgICAgdGhpcy5fc2FzbF9zdWNjZXNzX2hhbmRsZXIgPSB0aGlzLl9hZGRTeXNIYW5kbGVyKAogICAgICAgICAgdGhpcy5fc2FzbF9zdWNjZXNzX2NiLmJpbmQodGhpcyksIG51bGwsCiAgICAgICAgICAic3VjY2VzcyIsIG51bGwsIG51bGwpOwogICAgICAgIHRoaXMuX3Nhc2xfZmFpbHVyZV9oYW5kbGVyID0gdGhpcy5fYWRkU3lzSGFuZGxlcigKICAgICAgICAgIHRoaXMuX3Nhc2xfZmFpbHVyZV9jYi5iaW5kKHRoaXMpLCBudWxsLAogICAgICAgICAgImZhaWx1cmUiLCBudWxsLCBudWxsKTsKICAgICAgICB0aGlzLl9zYXNsX2NoYWxsZW5nZV9oYW5kbGVyID0gdGhpcy5fYWRkU3lzSGFuZGxlcigKICAgICAgICAgIHRoaXMuX3Nhc2xfY2hhbGxlbmdlX2NiLmJpbmQodGhpcyksIG51bGwsCiAgICAgICAgICAiY2hhbGxlbmdlIiwgbnVsbCwgbnVsbCk7CgogICAgICAgIHRoaXMuX3Nhc2xfbWVjaGFuaXNtID0gbmV3IG1hdGNoZWRbaV0oKTsKICAgICAgICB0aGlzLl9zYXNsX21lY2hhbmlzbS5vblN0YXJ0KHRoaXMpOwoKICAgICAgICB2YXIgcmVxdWVzdF9hdXRoX2V4Y2hhbmdlID0gJGJ1aWxkKCJhdXRoIiwgewogICAgICAgICAgeG1sbnM6IFN0cm9waGUuTlMuU0FTTCwKICAgICAgICAgIG1lY2hhbmlzbTogdGhpcy5fc2FzbF9tZWNoYW5pc20ubmFtZQogICAgICAgIH0pOwoKICAgICAgICBpZiAodGhpcy5fc2FzbF9tZWNoYW5pc20uaXNDbGllbnRGaXJzdCkgewogICAgICAgICAgdmFyIHJlc3BvbnNlID0gdGhpcy5fc2FzbF9tZWNoYW5pc20ub25DaGFsbGVuZ2UodGhpcywgbnVsbCk7CiAgICAgICAgICByZXF1ZXN0X2F1dGhfZXhjaGFuZ2UudChCYXNlNjQuZW5jb2RlKHJlc3BvbnNlKSk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLnNlbmQocmVxdWVzdF9hdXRoX2V4Y2hhbmdlLnRyZWUoKSk7CgogICAgICAgIG1lY2hhbmlzbV9mb3VuZCA9IHRydWU7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KCiAgICAgIGlmICghbWVjaGFuaXNtX2ZvdW5kKSB7CiAgICAgICAgLy8gaWYgbm9uZSBvZiB0aGUgbWVjaGFuaXNtIHdvcmtlZAogICAgICAgIGlmIChTdHJvcGhlLmdldE5vZGVGcm9tSmlkKHRoaXMuamlkKSA9PT0gbnVsbCkgewogICAgICAgICAgICAvLyB3ZSBkb24ndCBoYXZlIGEgbm9kZSwgd2hpY2ggaXMgcmVxdWlyZWQgZm9yIG5vbi1hbm9ueW1vdXMKICAgICAgICAgICAgLy8gY2xpZW50IGNvbm5lY3Rpb25zCiAgICAgICAgICAgIHRoaXMuX2NoYW5nZUNvbm5lY3RTdGF0dXMoU3Ryb3BoZS5TdGF0dXMuQ09OTkZBSUwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3gtc3Ryb3BoZS1iYWQtbm9uLWFub24tamlkJyk7CiAgICAgICAgICAgIHRoaXMuZGlzY29ubmVjdCgneC1zdHJvcGhlLWJhZC1ub24tYW5vbi1qaWQnKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgLy8gZmFsbCBiYWNrIHRvIGxlZ2FjeSBhdXRoZW50aWNhdGlvbgogICAgICAgICAgdGhpcy5fY2hhbmdlQ29ubmVjdFN0YXR1cyhTdHJvcGhlLlN0YXR1cy5BVVRIRU5USUNBVElORywgbnVsbCk7CiAgICAgICAgICB0aGlzLl9hZGRTeXNIYW5kbGVyKHRoaXMuX2F1dGgxX2NiLmJpbmQodGhpcyksIG51bGwsIG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bGwsICJfYXV0aF8xIik7CgogICAgICAgICAgdGhpcy5zZW5kKCRpcSh7CiAgICAgICAgICAgIHR5cGU6ICJnZXQiLAogICAgICAgICAgICB0bzogdGhpcy5kb21haW4sCiAgICAgICAgICAgIGlkOiAiX2F1dGhfMSIKICAgICAgICAgIH0pLmMoInF1ZXJ5IiwgewogICAgICAgICAgICB4bWxuczogU3Ryb3BoZS5OUy5BVVRICiAgICAgICAgICB9KS5jKCJ1c2VybmFtZSIsIHt9KS50KFN0cm9waGUuZ2V0Tm9kZUZyb21KaWQodGhpcy5qaWQpKS50cmVlKCkpOwogICAgICAgIH0KICAgICAgfQoKICAgIH0sCgogICAgX3Nhc2xfY2hhbGxlbmdlX2NiOiBmdW5jdGlvbihlbGVtKSB7CiAgICAgIHZhciBjaGFsbGVuZ2UgPSBCYXNlNjQuZGVjb2RlKFN0cm9waGUuZ2V0VGV4dChlbGVtKSk7CiAgICAgIHZhciByZXNwb25zZSA9IHRoaXMuX3Nhc2xfbWVjaGFuaXNtLm9uQ2hhbGxlbmdlKHRoaXMsIGNoYWxsZW5nZSk7CgogICAgICB2YXIgc3RhbnphID0gJGJ1aWxkKCdyZXNwb25zZScsIHsKICAgICAgICAgIHhtbG5zOiBTdHJvcGhlLk5TLlNBU0wKICAgICAgfSk7CiAgICAgIGlmIChyZXNwb25zZSAhPT0gIiIpIHsKICAgICAgICBzdGFuemEudChCYXNlNjQuZW5jb2RlKHJlc3BvbnNlKSk7CiAgICAgIH0KICAgICAgdGhpcy5zZW5kKHN0YW56YS50cmVlKCkpOwoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9LAoKICAgIC8qKiBQcml2YXRlRnVuY3Rpb246IF9hdXRoMV9jYgogICAgICogIF9Qcml2YXRlXyBoYW5kbGVyIGZvciBsZWdhY3kgYXV0aGVudGljYXRpb24uCiAgICAgKgogICAgICogIFRoaXMgaGFuZGxlciBpcyBjYWxsZWQgaW4gcmVzcG9uc2UgdG8gdGhlIGluaXRpYWwgPGlxIHR5cGU9J2dldCcvPgogICAgICogIGZvciBsZWdhY3kgYXV0aGVudGljYXRpb24uICBJdCBidWlsZHMgYW4gYXV0aGVudGljYXRpb24gPGlxLz4gYW5kCiAgICAgKiAgc2VuZHMgaXQsIGNyZWF0aW5nIGEgaGFuZGxlciAoY2FsbGluZyBiYWNrIHRvIF9hdXRoMl9jYigpKSB0bwogICAgICogIGhhbmRsZSB0aGUgcmVzdWx0CiAgICAgKgogICAgICogIFBhcmFtZXRlcnM6CiAgICAgKiAgICAoWE1MRWxlbWVudCkgZWxlbSAtIFRoZSBzdGFuemEgdGhhdCB0cmlnZ2VyZWQgdGhlIGNhbGxiYWNrLgogICAgICoKICAgICAqICBSZXR1cm5zOgogICAgICogICAgZmFsc2UgdG8gcmVtb3ZlIHRoZSBoYW5kbGVyLgogICAgICovCiAgICAvKiBqc2hpbnQgdW51c2VkOmZhbHNlICovCiAgICBfYXV0aDFfY2I6IGZ1bmN0aW9uIChlbGVtKQogICAgewogICAgICAgIC8vIGJ1aWxkIHBsYWludGV4dCBhdXRoIGlxCiAgICAgICAgdmFyIGlxID0gJGlxKHt0eXBlOiAic2V0IiwgaWQ6ICJfYXV0aF8yIn0pCiAgICAgICAgICAgIC5jKCdxdWVyeScsIHt4bWxuczogU3Ryb3BoZS5OUy5BVVRIfSkKICAgICAgICAgICAgLmMoJ3VzZXJuYW1lJywge30pLnQoU3Ryb3BoZS5nZXROb2RlRnJvbUppZCh0aGlzLmppZCkpCiAgICAgICAgICAgIC51cCgpCiAgICAgICAgICAgIC5jKCdwYXNzd29yZCcpLnQodGhpcy5wYXNzKTsKCiAgICAgICAgaWYgKCFTdHJvcGhlLmdldFJlc291cmNlRnJvbUppZCh0aGlzLmppZCkpIHsKICAgICAgICAgICAgLy8gc2luY2UgdGhlIHVzZXIgaGFzIG5vdCBzdXBwbGllZCBhIHJlc291cmNlLCB3ZSBwaWNrCiAgICAgICAgICAgIC8vIGEgZGVmYXVsdCBvbmUgaGVyZS4gIHVubGlrZSBvdGhlciBhdXRoIG1ldGhvZHMsIHRoZSBzZXJ2ZXIKICAgICAgICAgICAgLy8gY2Fubm90IGRvIHRoaXMgZm9yIHVzLgogICAgICAgICAgICB0aGlzLmppZCA9IFN0cm9waGUuZ2V0QmFyZUppZEZyb21KaWQodGhpcy5qaWQpICsgJy9zdHJvcGhlJzsKICAgICAgICB9CiAgICAgICAgaXEudXAoKS5jKCdyZXNvdXJjZScsIHt9KS50KFN0cm9waGUuZ2V0UmVzb3VyY2VGcm9tSmlkKHRoaXMuamlkKSk7CgogICAgICAgIHRoaXMuX2FkZFN5c0hhbmRsZXIodGhpcy5fYXV0aDJfY2IuYmluZCh0aGlzKSwgbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bGwsIG51bGwsICJfYXV0aF8yIik7CgogICAgICAgIHRoaXMuc2VuZChpcS50cmVlKCkpOwoKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9LAogICAgLyoganNoaW50IHVudXNlZDp0cnVlICovCgogICAgLyoqIFByaXZhdGVGdW5jdGlvbjogX3Nhc2xfc3VjY2Vzc19jYgogICAgICogIF9Qcml2YXRlXyBoYW5kbGVyIGZvciBzdWNjZXNmdWwgU0FTTCBhdXRoZW50aWNhdGlvbi4KICAgICAqCiAgICAgKiAgUGFyYW1ldGVyczoKICAgICAqICAgIChYTUxFbGVtZW50KSBlbGVtIC0gVGhlIG1hdGNoaW5nIHN0YW56YS4KICAgICAqCiAgICAgKiAgUmV0dXJuczoKICAgICAqICAgIGZhbHNlIHRvIHJlbW92ZSB0aGUgaGFuZGxlci4KICAgICAqLwogICAgX3Nhc2xfc3VjY2Vzc19jYjogZnVuY3Rpb24gKGVsZW0pCiAgICB7CiAgICAgICAgaWYgKHRoaXMuX3Nhc2xfZGF0YVsic2VydmVyLXNpZ25hdHVyZSJdKSB7CiAgICAgICAgICAgIHZhciBzZXJ2ZXJTaWduYXR1cmU7CiAgICAgICAgICAgIHZhciBzdWNjZXNzID0gQmFzZTY0LmRlY29kZShTdHJvcGhlLmdldFRleHQoZWxlbSkpOwogICAgICAgICAgICB2YXIgYXR0cmliTWF0Y2ggPSAvKFthLXpdKyk9KFteLF0rKSgsfCQpLzsKICAgICAgICAgICAgdmFyIG1hdGNoZXMgPSBzdWNjZXNzLm1hdGNoKGF0dHJpYk1hdGNoKTsKICAgICAgICAgICAgaWYgKG1hdGNoZXNbMV0gPT0gInYiKSB7CiAgICAgICAgICAgICAgICBzZXJ2ZXJTaWduYXR1cmUgPSBtYXRjaGVzWzJdOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoc2VydmVyU2lnbmF0dXJlICE9IHRoaXMuX3Nhc2xfZGF0YVsic2VydmVyLXNpZ25hdHVyZSJdKSB7CiAgICAgICAgICAgICAgLy8gcmVtb3ZlIG9sZCBoYW5kbGVycwogICAgICAgICAgICAgIHRoaXMuZGVsZXRlSGFuZGxlcih0aGlzLl9zYXNsX2ZhaWx1cmVfaGFuZGxlcik7CiAgICAgICAgICAgICAgdGhpcy5fc2FzbF9mYWlsdXJlX2hhbmRsZXIgPSBudWxsOwogICAgICAgICAgICAgIGlmICh0aGlzLl9zYXNsX2NoYWxsZW5nZV9oYW5kbGVyKSB7CiAgICAgICAgICAgICAgICB0aGlzLmRlbGV0ZUhhbmRsZXIodGhpcy5fc2FzbF9jaGFsbGVuZ2VfaGFuZGxlcik7CiAgICAgICAgICAgICAgICB0aGlzLl9zYXNsX2NoYWxsZW5nZV9oYW5kbGVyID0gbnVsbDsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHRoaXMuX3Nhc2xfZGF0YSA9IHt9OwogICAgICAgICAgICAgIHJldHVybiB0aGlzLl9zYXNsX2ZhaWx1cmVfY2IobnVsbCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIFN0cm9waGUuaW5mbygiU0FTTCBhdXRoZW50aWNhdGlvbiBzdWNjZWVkZWQuIik7CgogICAgICAgIGlmKHRoaXMuX3Nhc2xfbWVjaGFuaXNtKQogICAgICAgICAgdGhpcy5fc2FzbF9tZWNoYW5pc20ub25TdWNjZXNzKCk7CgogICAgICAgIC8vIHJlbW92ZSBvbGQgaGFuZGxlcnMKICAgICAgICB0aGlzLmRlbGV0ZUhhbmRsZXIodGhpcy5fc2FzbF9mYWlsdXJlX2hhbmRsZXIpOwogICAgICAgIHRoaXMuX3Nhc2xfZmFpbHVyZV9oYW5kbGVyID0gbnVsbDsKICAgICAgICBpZiAodGhpcy5fc2FzbF9jaGFsbGVuZ2VfaGFuZGxlcikgewogICAgICAgICAgICB0aGlzLmRlbGV0ZUhhbmRsZXIodGhpcy5fc2FzbF9jaGFsbGVuZ2VfaGFuZGxlcik7CiAgICAgICAgICAgIHRoaXMuX3Nhc2xfY2hhbGxlbmdlX2hhbmRsZXIgPSBudWxsOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5fYWRkU3lzSGFuZGxlcih0aGlzLl9zYXNsX2F1dGgxX2NiLmJpbmQodGhpcyksIG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAic3RyZWFtOmZlYXR1cmVzIiwgbnVsbCwgbnVsbCk7CgogICAgICAgIC8vIHdlIG11c3Qgc2VuZCBhbiB4bXBwOnJlc3RhcnQgbm93CiAgICAgICAgdGhpcy5fc2VuZFJlc3RhcnQoKTsKCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSwKCiAgICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiBfc2FzbF9hdXRoMV9jYgogICAgICogIF9Qcml2YXRlXyBoYW5kbGVyIHRvIHN0YXJ0IHN0cmVhbSBiaW5kaW5nLgogICAgICoKICAgICAqICBQYXJhbWV0ZXJzOgogICAgICogICAgKFhNTEVsZW1lbnQpIGVsZW0gLSBUaGUgbWF0Y2hpbmcgc3RhbnphLgogICAgICoKICAgICAqICBSZXR1cm5zOgogICAgICogICAgZmFsc2UgdG8gcmVtb3ZlIHRoZSBoYW5kbGVyLgogICAgICovCiAgICBfc2FzbF9hdXRoMV9jYjogZnVuY3Rpb24gKGVsZW0pCiAgICB7CiAgICAgICAgLy8gc2F2ZSBzdHJlYW06ZmVhdHVyZXMgZm9yIGZ1dHVyZSB1c2FnZQogICAgICAgIHRoaXMuZmVhdHVyZXMgPSBlbGVtOwoKICAgICAgICB2YXIgaSwgY2hpbGQ7CgogICAgICAgIGZvciAoaSA9IDA7IGkgPCBlbGVtLmNoaWxkTm9kZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY2hpbGQgPSBlbGVtLmNoaWxkTm9kZXNbaV07CiAgICAgICAgICAgIGlmIChjaGlsZC5ub2RlTmFtZSA9PSAnYmluZCcpIHsKICAgICAgICAgICAgICAgIHRoaXMuZG9fYmluZCA9IHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChjaGlsZC5ub2RlTmFtZSA9PSAnc2Vzc2lvbicpIHsKICAgICAgICAgICAgICAgIHRoaXMuZG9fc2Vzc2lvbiA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICghdGhpcy5kb19iaW5kKSB7CiAgICAgICAgICAgIHRoaXMuX2NoYW5nZUNvbm5lY3RTdGF0dXMoU3Ryb3BoZS5TdGF0dXMuQVVUSEZBSUwsIG51bGwpOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5fYWRkU3lzSGFuZGxlcih0aGlzLl9zYXNsX2JpbmRfY2IuYmluZCh0aGlzKSwgbnVsbCwgbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBudWxsLCAiX2JpbmRfYXV0aF8yIik7CgogICAgICAgICAgICB2YXIgcmVzb3VyY2UgPSBTdHJvcGhlLmdldFJlc291cmNlRnJvbUppZCh0aGlzLmppZCk7CiAgICAgICAgICAgIGlmIChyZXNvdXJjZSkgewogICAgICAgICAgICAgICAgdGhpcy5zZW5kKCRpcSh7dHlwZTogInNldCIsIGlkOiAiX2JpbmRfYXV0aF8yIn0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgLmMoJ2JpbmQnLCB7eG1sbnM6IFN0cm9waGUuTlMuQklORH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgLmMoJ3Jlc291cmNlJywge30pLnQocmVzb3VyY2UpLnRyZWUoKSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLnNlbmQoJGlxKHt0eXBlOiAic2V0IiwgaWQ6ICJfYmluZF9hdXRoXzIifSkKICAgICAgICAgICAgICAgICAgICAgICAgICAuYygnYmluZCcsIHt4bWxuczogU3Ryb3BoZS5OUy5CSU5EfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAudHJlZSgpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSwKCiAgICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiBfc2FzbF9iaW5kX2NiCiAgICAgKiAgX1ByaXZhdGVfIGhhbmRsZXIgZm9yIGJpbmRpbmcgcmVzdWx0IGFuZCBzZXNzaW9uIHN0YXJ0LgogICAgICoKICAgICAqICBQYXJhbWV0ZXJzOgogICAgICogICAgKFhNTEVsZW1lbnQpIGVsZW0gLSBUaGUgbWF0Y2hpbmcgc3RhbnphLgogICAgICoKICAgICAqICBSZXR1cm5zOgogICAgICogICAgZmFsc2UgdG8gcmVtb3ZlIHRoZSBoYW5kbGVyLgogICAgICovCiAgICBfc2FzbF9iaW5kX2NiOiBmdW5jdGlvbiAoZWxlbSkKICAgIHsKICAgICAgICBpZiAoZWxlbS5nZXRBdHRyaWJ1dGUoInR5cGUiKSA9PSAiZXJyb3IiKSB7CiAgICAgICAgICAgIFN0cm9waGUuaW5mbygiU0FTTCBiaW5kaW5nIGZhaWxlZC4iKTsKICAgICAgICAgICAgdmFyIGNvbmZsaWN0ID0gZWxlbS5nZXRFbGVtZW50c0J5VGFnTmFtZSgiY29uZmxpY3QiKSwgY29uZGl0aW9uOwogICAgICAgICAgICBpZiAoY29uZmxpY3QubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgY29uZGl0aW9uID0gJ2NvbmZsaWN0JzsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLl9jaGFuZ2VDb25uZWN0U3RhdHVzKFN0cm9waGUuU3RhdHVzLkFVVEhGQUlMLCBjb25kaXRpb24pOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICAvLyBUT0RPIC0gbmVlZCB0byBncmFiIGVycm9ycwogICAgICAgIHZhciBiaW5kID0gZWxlbS5nZXRFbGVtZW50c0J5VGFnTmFtZSgiYmluZCIpOwogICAgICAgIHZhciBqaWROb2RlOwogICAgICAgIGlmIChiaW5kLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgLy8gR3JhYiBqaWQKICAgICAgICAgICAgamlkTm9kZSA9IGJpbmRbMF0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoImppZCIpOwogICAgICAgICAgICBpZiAoamlkTm9kZS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLmppZCA9IFN0cm9waGUuZ2V0VGV4dChqaWROb2RlWzBdKTsKCiAgICAgICAgICAgICAgICBpZiAodGhpcy5kb19zZXNzaW9uKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYWRkU3lzSGFuZGxlcih0aGlzLl9zYXNsX3Nlc3Npb25fY2IuYmluZCh0aGlzKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bGwsIG51bGwsIG51bGwsICJfc2Vzc2lvbl9hdXRoXzIiKTsKCiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZW5kKCRpcSh7dHlwZTogInNldCIsIGlkOiAiX3Nlc3Npb25fYXV0aF8yIn0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYygnc2Vzc2lvbicsIHt4bWxuczogU3Ryb3BoZS5OUy5TRVNTSU9OfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50cmVlKCkpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmF1dGhlbnRpY2F0ZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2NoYW5nZUNvbm5lY3RTdGF0dXMoU3Ryb3BoZS5TdGF0dXMuQ09OTkVDVEVELCBudWxsKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIFN0cm9waGUuaW5mbygiU0FTTCBiaW5kaW5nIGZhaWxlZC4iKTsKICAgICAgICAgICAgdGhpcy5fY2hhbmdlQ29ubmVjdFN0YXR1cyhTdHJvcGhlLlN0YXR1cy5BVVRIRkFJTCwgbnVsbCk7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICB9LAoKICAgIC8qKiBQcml2YXRlRnVuY3Rpb246IF9zYXNsX3Nlc3Npb25fY2IKICAgICAqICBfUHJpdmF0ZV8gaGFuZGxlciB0byBmaW5pc2ggc3VjY2Vzc2Z1bCBTQVNMIGNvbm5lY3Rpb24uCiAgICAgKgogICAgICogIFRoaXMgc2V0cyBDb25uZWN0aW9uLmF1dGhlbnRpY2F0ZWQgdG8gdHJ1ZSBvbiBzdWNjZXNzLCB3aGljaAogICAgICogIHN0YXJ0cyB0aGUgcHJvY2Vzc2luZyBvZiB1c2VyIGhhbmRsZXJzLgogICAgICoKICAgICAqICBQYXJhbWV0ZXJzOgogICAgICogICAgKFhNTEVsZW1lbnQpIGVsZW0gLSBUaGUgbWF0Y2hpbmcgc3RhbnphLgogICAgICoKICAgICAqICBSZXR1cm5zOgogICAgICogICAgZmFsc2UgdG8gcmVtb3ZlIHRoZSBoYW5kbGVyLgogICAgICovCiAgICBfc2FzbF9zZXNzaW9uX2NiOiBmdW5jdGlvbiAoZWxlbSkKICAgIHsKICAgICAgICBpZiAoZWxlbS5nZXRBdHRyaWJ1dGUoInR5cGUiKSA9PSAicmVzdWx0IikgewogICAgICAgICAgICB0aGlzLmF1dGhlbnRpY2F0ZWQgPSB0cnVlOwogICAgICAgICAgICB0aGlzLl9jaGFuZ2VDb25uZWN0U3RhdHVzKFN0cm9waGUuU3RhdHVzLkNPTk5FQ1RFRCwgbnVsbCk7CiAgICAgICAgfSBlbHNlIGlmIChlbGVtLmdldEF0dHJpYnV0ZSgidHlwZSIpID09ICJlcnJvciIpIHsKICAgICAgICAgICAgU3Ryb3BoZS5pbmZvKCJTZXNzaW9uIGNyZWF0aW9uIGZhaWxlZC4iKTsKICAgICAgICAgICAgdGhpcy5fY2hhbmdlQ29ubmVjdFN0YXR1cyhTdHJvcGhlLlN0YXR1cy5BVVRIRkFJTCwgbnVsbCk7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0sCgogICAgLyoqIFByaXZhdGVGdW5jdGlvbjogX3Nhc2xfZmFpbHVyZV9jYgogICAgICogIF9Qcml2YXRlXyBoYW5kbGVyIGZvciBTQVNMIGF1dGhlbnRpY2F0aW9uIGZhaWx1cmUuCiAgICAgKgogICAgICogIFBhcmFtZXRlcnM6CiAgICAgKiAgICAoWE1MRWxlbWVudCkgZWxlbSAtIFRoZSBtYXRjaGluZyBzdGFuemEuCiAgICAgKgogICAgICogIFJldHVybnM6CiAgICAgKiAgICBmYWxzZSB0byByZW1vdmUgdGhlIGhhbmRsZXIuCiAgICAgKi8KICAgIC8qIGpzaGludCB1bnVzZWQ6ZmFsc2UgKi8KICAgIF9zYXNsX2ZhaWx1cmVfY2I6IGZ1bmN0aW9uIChlbGVtKQogICAgewogICAgICAgIC8vIGRlbGV0ZSB1bm5lZWRlZCBoYW5kbGVycwogICAgICAgIGlmICh0aGlzLl9zYXNsX3N1Y2Nlc3NfaGFuZGxlcikgewogICAgICAgICAgICB0aGlzLmRlbGV0ZUhhbmRsZXIodGhpcy5fc2FzbF9zdWNjZXNzX2hhbmRsZXIpOwogICAgICAgICAgICB0aGlzLl9zYXNsX3N1Y2Nlc3NfaGFuZGxlciA9IG51bGw7CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLl9zYXNsX2NoYWxsZW5nZV9oYW5kbGVyKSB7CiAgICAgICAgICAgIHRoaXMuZGVsZXRlSGFuZGxlcih0aGlzLl9zYXNsX2NoYWxsZW5nZV9oYW5kbGVyKTsKICAgICAgICAgICAgdGhpcy5fc2FzbF9jaGFsbGVuZ2VfaGFuZGxlciA9IG51bGw7CiAgICAgICAgfQoKICAgICAgICBpZih0aGlzLl9zYXNsX21lY2hhbmlzbSkKICAgICAgICAgIHRoaXMuX3Nhc2xfbWVjaGFuaXNtLm9uRmFpbHVyZSgpOwogICAgICAgIHRoaXMuX2NoYW5nZUNvbm5lY3RTdGF0dXMoU3Ryb3BoZS5TdGF0dXMuQVVUSEZBSUwsIG51bGwpOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0sCiAgICAvKiBqc2hpbnQgdW51c2VkOnRydWUgKi8KCiAgICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiBfYXV0aDJfY2IKICAgICAqICBfUHJpdmF0ZV8gaGFuZGxlciB0byBmaW5pc2ggbGVnYWN5IGF1dGhlbnRpY2F0aW9uLgogICAgICoKICAgICAqICBUaGlzIGhhbmRsZXIgaXMgY2FsbGVkIHdoZW4gdGhlIHJlc3VsdCBmcm9tIHRoZSBqYWJiZXI6aXE6YXV0aAogICAgICogIDxpcS8+IHN0YW56YSBpcyByZXR1cm5lZC4KICAgICAqCiAgICAgKiAgUGFyYW1ldGVyczoKICAgICAqICAgIChYTUxFbGVtZW50KSBlbGVtIC0gVGhlIHN0YW56YSB0aGF0IHRyaWdnZXJlZCB0aGUgY2FsbGJhY2suCiAgICAgKgogICAgICogIFJldHVybnM6CiAgICAgKiAgICBmYWxzZSB0byByZW1vdmUgdGhlIGhhbmRsZXIuCiAgICAgKi8KICAgIF9hdXRoMl9jYjogZnVuY3Rpb24gKGVsZW0pCiAgICB7CiAgICAgICAgaWYgKGVsZW0uZ2V0QXR0cmlidXRlKCJ0eXBlIikgPT0gInJlc3VsdCIpIHsKICAgICAgICAgICAgdGhpcy5hdXRoZW50aWNhdGVkID0gdHJ1ZTsKICAgICAgICAgICAgdGhpcy5fY2hhbmdlQ29ubmVjdFN0YXR1cyhTdHJvcGhlLlN0YXR1cy5DT05ORUNURUQsIG51bGwpOwogICAgICAgIH0gZWxzZSBpZiAoZWxlbS5nZXRBdHRyaWJ1dGUoInR5cGUiKSA9PSAiZXJyb3IiKSB7CiAgICAgICAgICAgIHRoaXMuX2NoYW5nZUNvbm5lY3RTdGF0dXMoU3Ryb3BoZS5TdGF0dXMuQVVUSEZBSUwsIG51bGwpOwogICAgICAgICAgICB0aGlzLmRpc2Nvbm5lY3QoJ2F1dGhlbnRpY2F0aW9uIGZhaWxlZCcpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSwKCiAgICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiBfYWRkU3lzVGltZWRIYW5kbGVyCiAgICAgKiAgX1ByaXZhdGVfIGZ1bmN0aW9uIHRvIGFkZCBhIHN5c3RlbSBsZXZlbCB0aW1lZCBoYW5kbGVyLgogICAgICoKICAgICAqICBUaGlzIGZ1bmN0aW9uIGlzIHVzZWQgdG8gYWRkIGEgU3Ryb3BoZS5UaW1lZEhhbmRsZXIgZm9yIHRoZQogICAgICogIGxpYnJhcnkgY29kZS4gIFN5c3RlbSB0aW1lZCBoYW5kbGVycyBhcmUgYWxsb3dlZCB0byBydW4gYmVmb3JlCiAgICAgKiAgYXV0aGVudGljYXRpb24gaXMgY29tcGxldGUuCiAgICAgKgogICAgICogIFBhcmFtZXRlcnM6CiAgICAgKiAgICAoSW50ZWdlcikgcGVyaW9kIC0gVGhlIHBlcmlvZCBvZiB0aGUgaGFuZGxlci4KICAgICAqICAgIChGdW5jdGlvbikgaGFuZGxlciAtIFRoZSBjYWxsYmFjayBmdW5jdGlvbi4KICAgICAqLwogICAgX2FkZFN5c1RpbWVkSGFuZGxlcjogZnVuY3Rpb24gKHBlcmlvZCwgaGFuZGxlcikKICAgIHsKICAgICAgICB2YXIgdGhhbmQgPSBuZXcgU3Ryb3BoZS5UaW1lZEhhbmRsZXIocGVyaW9kLCBoYW5kbGVyKTsKICAgICAgICB0aGFuZC51c2VyID0gZmFsc2U7CiAgICAgICAgdGhpcy5hZGRUaW1lZHMucHVzaCh0aGFuZCk7CiAgICAgICAgcmV0dXJuIHRoYW5kOwogICAgfSwKCiAgICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiBfYWRkU3lzSGFuZGxlcgogICAgICogIF9Qcml2YXRlXyBmdW5jdGlvbiB0byBhZGQgYSBzeXN0ZW0gbGV2ZWwgc3RhbnphIGhhbmRsZXIuCiAgICAgKgogICAgICogIFRoaXMgZnVuY3Rpb24gaXMgdXNlZCB0byBhZGQgYSBTdHJvcGhlLkhhbmRsZXIgZm9yIHRoZQogICAgICogIGxpYnJhcnkgY29kZS4gIFN5c3RlbSBzdGFuemEgaGFuZGxlcnMgYXJlIGFsbG93ZWQgdG8gcnVuIGJlZm9yZQogICAgICogIGF1dGhlbnRpY2F0aW9uIGlzIGNvbXBsZXRlLgogICAgICoKICAgICAqICBQYXJhbWV0ZXJzOgogICAgICogICAgKEZ1bmN0aW9uKSBoYW5kbGVyIC0gVGhlIGNhbGxiYWNrIGZ1bmN0aW9uLgogICAgICogICAgKFN0cmluZykgbnMgLSBUaGUgbmFtZXNwYWNlIHRvIG1hdGNoLgogICAgICogICAgKFN0cmluZykgbmFtZSAtIFRoZSBzdGFuemEgbmFtZSB0byBtYXRjaC4KICAgICAqICAgIChTdHJpbmcpIHR5cGUgLSBUaGUgc3RhbnphIHR5cGUgYXR0cmlidXRlIHRvIG1hdGNoLgogICAgICogICAgKFN0cmluZykgaWQgLSBUaGUgc3RhbnphIGlkIGF0dHJpYnV0ZSB0byBtYXRjaC4KICAgICAqLwogICAgX2FkZFN5c0hhbmRsZXI6IGZ1bmN0aW9uIChoYW5kbGVyLCBucywgbmFtZSwgdHlwZSwgaWQpCiAgICB7CiAgICAgICAgdmFyIGhhbmQgPSBuZXcgU3Ryb3BoZS5IYW5kbGVyKGhhbmRsZXIsIG5zLCBuYW1lLCB0eXBlLCBpZCk7CiAgICAgICAgaGFuZC51c2VyID0gZmFsc2U7CiAgICAgICAgdGhpcy5hZGRIYW5kbGVycy5wdXNoKGhhbmQpOwogICAgICAgIHJldHVybiBoYW5kOwogICAgfSwKCiAgICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiBfb25EaXNjb25uZWN0VGltZW91dAogICAgICogIF9Qcml2YXRlXyB0aW1lb3V0IGhhbmRsZXIgZm9yIGhhbmRsaW5nIG5vbi1ncmFjZWZ1bCBkaXNjb25uZWN0aW9uLgogICAgICoKICAgICAqICBJZiB0aGUgZ3JhY2VmdWwgZGlzY29ubmVjdCBwcm9jZXNzIGRvZXMgbm90IGNvbXBsZXRlIHdpdGhpbiB0aGUKICAgICAqICB0aW1lIGFsbG90dGVkLCB0aGlzIGhhbmRsZXIgZmluaXNoZXMgdGhlIGRpc2Nvbm5lY3QgYW55d2F5LgogICAgICoKICAgICAqICBSZXR1cm5zOgogICAgICogICAgZmFsc2UgdG8gcmVtb3ZlIHRoZSBoYW5kbGVyLgogICAgICovCiAgICBfb25EaXNjb25uZWN0VGltZW91dDogZnVuY3Rpb24gKCkKICAgIHsKICAgICAgICBTdHJvcGhlLmluZm8oIl9vbkRpc2Nvbm5lY3RUaW1lb3V0IHdhcyBjYWxsZWQiKTsKCiAgICAgICAgdGhpcy5fcHJvdG8uX29uRGlzY29ubmVjdFRpbWVvdXQoKTsKCiAgICAgICAgLy8gYWN0dWFsbHkgZGlzY29ubmVjdAogICAgICAgIHRoaXMuX2RvRGlzY29ubmVjdCgpOwoKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9LAoKICAgIC8qKiBQcml2YXRlRnVuY3Rpb246IF9vbklkbGUKICAgICAqICBfUHJpdmF0ZV8gaGFuZGxlciB0byBwcm9jZXNzIGV2ZW50cyBkdXJpbmcgaWRsZSBjeWNsZS4KICAgICAqCiAgICAgKiAgVGhpcyBoYW5kbGVyIGlzIGNhbGxlZCBldmVyeSAxMDBtcyB0byBmaXJlIHRpbWVkIGhhbmRsZXJzIHRoYXQKICAgICAqICBhcmUgcmVhZHkgYW5kIGtlZXAgcG9sbCByZXF1ZXN0cyBnb2luZy4KICAgICAqLwogICAgX29uSWRsZTogZnVuY3Rpb24gKCkKICAgIHsKICAgICAgICB2YXIgaSwgdGhhbmQsIHNpbmNlLCBuZXdMaXN0OwoKICAgICAgICAvLyBhZGQgdGltZWQgaGFuZGxlcnMgc2NoZWR1bGVkIGZvciBhZGRpdGlvbgogICAgICAgIC8vIE5PVEU6IHdlIGFkZCBiZWZvcmUgcmVtb3ZlIGluIHRoZSBjYXNlIGEgdGltZWQgaGFuZGxlciBpcwogICAgICAgIC8vIGFkZGVkIGFuZCB0aGVuIGRlbGV0ZWQgYmVmb3JlIHRoZSBuZXh0IF9vbklkbGUoKSBjYWxsLgogICAgICAgIHdoaWxlICh0aGlzLmFkZFRpbWVkcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHRoaXMudGltZWRIYW5kbGVycy5wdXNoKHRoaXMuYWRkVGltZWRzLnBvcCgpKTsKICAgICAgICB9CgogICAgICAgIC8vIHJlbW92ZSB0aW1lZCBoYW5kbGVycyB0aGF0IGhhdmUgYmVlbiBzY2hlZHVsZWQgZm9yIGRlbGV0aW9uCiAgICAgICAgd2hpbGUgKHRoaXMucmVtb3ZlVGltZWRzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgdGhhbmQgPSB0aGlzLnJlbW92ZVRpbWVkcy5wb3AoKTsKICAgICAgICAgICAgaSA9IHRoaXMudGltZWRIYW5kbGVycy5pbmRleE9mKHRoYW5kKTsKICAgICAgICAgICAgaWYgKGkgPj0gMCkgewogICAgICAgICAgICAgICAgdGhpcy50aW1lZEhhbmRsZXJzLnNwbGljZShpLCAxKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gY2FsbCByZWFkeSB0aW1lZCBoYW5kbGVycwogICAgICAgIHZhciBub3cgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTsKICAgICAgICBuZXdMaXN0ID0gW107CiAgICAgICAgZm9yIChpID0gMDsgaSA8IHRoaXMudGltZWRIYW5kbGVycy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB0aGFuZCA9IHRoaXMudGltZWRIYW5kbGVyc1tpXTsKICAgICAgICAgICAgaWYgKHRoaXMuYXV0aGVudGljYXRlZCB8fCAhdGhhbmQudXNlcikgewogICAgICAgICAgICAgICAgc2luY2UgPSB0aGFuZC5sYXN0Q2FsbGVkICsgdGhhbmQucGVyaW9kOwogICAgICAgICAgICAgICAgaWYgKHNpbmNlIC0gbm93IDw9IDApIHsKICAgICAgICAgICAgICAgICAgICBpZiAodGhhbmQucnVuKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmV3TGlzdC5wdXNoKHRoYW5kKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIG5ld0xpc3QucHVzaCh0aGFuZCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdGhpcy50aW1lZEhhbmRsZXJzID0gbmV3TGlzdDsKCiAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuX2lkbGVUaW1lb3V0KTsKCiAgICAgICAgdGhpcy5fcHJvdG8uX29uSWRsZSgpOwoKICAgICAgICAvLyByZWFjdGl2YXRlIHRoZSB0aW1lciBvbmx5IGlmIGNvbm5lY3RlZAogICAgICAgIGlmICh0aGlzLmNvbm5lY3RlZCkgewogICAgICAgICAgICB0aGlzLl9pZGxlVGltZW91dCA9IHNldFRpbWVvdXQodGhpcy5fb25JZGxlLmJpbmQodGhpcyksIDEwMCk7CiAgICAgICAgfQogICAgfQp9OwoKaWYgKGNhbGxiYWNrKSB7CiAgICBjYWxsYmFjayhTdHJvcGhlLCAkYnVpbGQsICRtc2csICRpcSwgJHByZXMpOwp9CgovKiogQ2xhc3M6IFN0cm9waGUuU0FTTE1lY2hhbmlzbQogKgogKiAgZW5jYXBzdWxhdGVzIFNBU0wgYXV0aGVudGljYXRpb24gbWVjaGFuaXNtcy4KICoKICogIFVzZXIgY29kZSBtYXkgb3ZlcnJpZGUgdGhlIHByaW9yaXR5IGZvciBlYWNoIG1lY2hhbmlzbSBvciBkaXNhYmxlIGl0IGNvbXBsZXRlbHkuCiAqICBTZWUgPHByaW9yaXR5PiBmb3IgaW5mb3JtYXRpb24gYWJvdXQgY2hhbmdpbmcgcHJpb3JpdHkgYW5kIDx0ZXN0PiBmb3IgaW5mb3JtYXRpYW4gb24KICogIGhvdyB0byBkaXNhYmxlIGEgbWVjaGFuaXNtLgogKgogKiAgQnkgZGVmYXVsdCwgYWxsIG1lY2hhbmlzbXMgYXJlIGVuYWJsZWQgYW5kIHRoZSBwcmlvcml0aWVzIGFyZQogKgogKiAgU0NSQU0tU0hBMSAtIDQwCiAqICBESUdFU1QtTUQ1IC0gMzAKICogIFBsYWluIC0gMjAKICovCgovKioKICogUHJpdmF0ZUNvbnN0cnVjdG9yOiBTdHJvcGhlLlNBU0xNZWNoYW5pc20KICogU0FTTCBhdXRoIG1lY2hhbmlzbSBhYnN0cmFjdGlvbi4KICoKICogIFBhcmFtZXRlcnM6CiAqICAgIChTdHJpbmcpIG5hbWUgLSBTQVNMIE1lY2hhbmlzbSBuYW1lLgogKiAgICAoQm9vbGVhbikgaXNDbGllbnRGaXJzdCAtIElmIGNsaWVudCBzaG91bGQgc2VuZCByZXNwb25zZSBmaXJzdCB3aXRob3V0IGNoYWxsZW5nZS4KICogICAgKE51bWJlcikgcHJpb3JpdHkgLSBQcmlvcml0eS4KICoKICogIFJldHVybnM6CiAqICAgIEEgbmV3IFN0cm9waGUuU0FTTE1lY2hhbmlzbSBvYmplY3QuCiAqLwpTdHJvcGhlLlNBU0xNZWNoYW5pc20gPSBmdW5jdGlvbihuYW1lLCBpc0NsaWVudEZpcnN0LCBwcmlvcml0eSkgewogIC8qKiBQcml2YXRlVmFyaWFibGU6IG5hbWUKICAgKiAgTWVjaGFuaXNtIG5hbWUuCiAgICovCiAgdGhpcy5uYW1lID0gbmFtZTsKICAvKiogUHJpdmF0ZVZhcmlhYmxlOiBpc0NsaWVudEZpcnN0CiAgICogIElmIGNsaWVudCBzZW5kcyByZXNwb25zZSB3aXRob3V0IGluaXRpYWwgc2VydmVyIGNoYWxsZW5nZS4KICAgKi8KICB0aGlzLmlzQ2xpZW50Rmlyc3QgPSBpc0NsaWVudEZpcnN0OwogIC8qKiBWYXJpYWJsZTogcHJpb3JpdHkKICAgKiAgRGV0ZXJtaW5lcyB3aGljaCA8U0FTTE1lY2hhbmlzbT4gaXMgY2hvc2VuIGZvciBhdXRoZW50aWNhdGlvbiAoSGlnaGVyIGlzIGJldHRlcikuCiAgICogIFVzZXJzIG1heSBvdmVycmlkZSB0aGlzIHRvIHByaW9yaXRpemUgbWVjaGFuaXNtcyBkaWZmZXJlbnRseS4KICAgKgogICAqICBJbiB0aGUgZGVmYXVsdCBjb25maWd1cmF0aW9uIHRoZSBwcmlvcml0aWVzIGFyZQogICAqCiAgICogIFNDUkFNLVNIQTEgLSA0MAogICAqICBESUdFU1QtTUQ1IC0gMzAKICAgKiAgUGxhaW4gLSAyMAogICAqCiAgICogIEV4YW1wbGU6IChUaGlzIHdpbGwgY2F1c2UgU3Ryb3BoZSB0byBjaG9vc2UgdGhlIG1lY2hhbmlzbSB0aGF0IHRoZSBzZXJ2ZXIgc2VudCBmaXJzdCkKICAgKgogICAqICA+IFN0cm9waGUuU0FTTE1ENS5wcmlvcml0eSA9IFN0cm9waGUuU0FTTFNIQTEucHJpb3JpdHk7CiAgICoKICAgKiAgU2VlIDxTQVNMIG1lY2hhbmlzbXM+IGZvciBhIGxpc3Qgb2YgYXZhaWxhYmxlIG1lY2hhbmlzbXMuCiAgICoKICAgKi8KICB0aGlzLnByaW9yaXR5ID0gcHJpb3JpdHk7Cn07CgpTdHJvcGhlLlNBU0xNZWNoYW5pc20ucHJvdG90eXBlID0gewogIC8qKgogICAqICBGdW5jdGlvbjogdGVzdAogICAqICBDaGVja3MgaWYgbWVjaGFuaXNtIGFibGUgdG8gcnVuLgogICAqICBUbyBkaXNhYmxlIGEgbWVjaGFuaXNtLCBtYWtlIHRoaXMgcmV0dXJuIGZhbHNlOwogICAqCiAgICogIFRvIGRpc2FibGUgcGxhaW4gYXV0aGVudGljYXRpb24gcnVuCiAgICogID4gU3Ryb3BoZS5TQVNMUGxhaW4udGVzdCA9IGZ1bmN0aW9uKCkgewogICAqICA+ICAgcmV0dXJuIGZhbHNlOwogICAqICA+IH0KICAgKgogICAqICBTZWUgPFNBU0wgbWVjaGFuaXNtcz4gZm9yIGEgbGlzdCBvZiBhdmFpbGFibGUgbWVjaGFuaXNtcy4KICAgKgogICAqICBQYXJhbWV0ZXJzOgogICAqICAgIChTdHJvcGhlLkNvbm5lY3Rpb24pIGNvbm5lY3Rpb24gLSBUYXJnZXQgQ29ubmVjdGlvbi4KICAgKgogICAqICBSZXR1cm5zOgogICAqICAgIChCb29sZWFuKSBJZiBtZWNoYW5pc20gd2FzIGFibGUgdG8gcnVuLgogICAqLwogIC8qIGpzaGludCB1bnVzZWQ6ZmFsc2UgKi8KICB0ZXN0OiBmdW5jdGlvbihjb25uZWN0aW9uKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9LAogIC8qIGpzaGludCB1bnVzZWQ6dHJ1ZSAqLwoKICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiBvblN0YXJ0CiAgICogIENhbGxlZCBiZWZvcmUgc3RhcnRpbmcgbWVjaGFuaXNtIG9uIHNvbWUgY29ubmVjdGlvbi4KICAgKgogICAqICBQYXJhbWV0ZXJzOgogICAqICAgIChTdHJvcGhlLkNvbm5lY3Rpb24pIGNvbm5lY3Rpb24gLSBUYXJnZXQgQ29ubmVjdGlvbi4KICAgKi8KICBvblN0YXJ0OiBmdW5jdGlvbihjb25uZWN0aW9uKQogIHsKICAgIHRoaXMuX2Nvbm5lY3Rpb24gPSBjb25uZWN0aW9uOwogIH0sCgogIC8qKiBQcml2YXRlRnVuY3Rpb246IG9uQ2hhbGxlbmdlCiAgICogIENhbGxlZCBieSBwcm90b2NvbCBpbXBsZW1lbnRhdGlvbiBvbiBpbmNvbWluZyBjaGFsbGVuZ2UuIElmIGNsaWVudCBpcwogICAqICBmaXJzdCAoaXNDbGllbnRGaXJzdCA9PSB0cnVlKSBjaGFsbGVuZ2Ugd2lsbCBiZSBudWxsIG9uIHRoZSBmaXJzdCBjYWxsLgogICAqCiAgICogIFBhcmFtZXRlcnM6CiAgICogICAgKFN0cm9waGUuQ29ubmVjdGlvbikgY29ubmVjdGlvbiAtIFRhcmdldCBDb25uZWN0aW9uLgogICAqICAgIChTdHJpbmcpIGNoYWxsZW5nZSAtIGN1cnJlbnQgY2hhbGxlbmdlIHRvIGhhbmRsZS4KICAgKgogICAqICBSZXR1cm5zOgogICAqICAgIChTdHJpbmcpIE1lY2hhbmlzbSByZXNwb25zZS4KICAgKi8KICAvKiBqc2hpbnQgdW51c2VkOmZhbHNlICovCiAgb25DaGFsbGVuZ2U6IGZ1bmN0aW9uKGNvbm5lY3Rpb24sIGNoYWxsZW5nZSkgewogICAgdGhyb3cgbmV3IEVycm9yKCJZb3Ugc2hvdWxkIGltcGxlbWVudCBjaGFsbGVuZ2UgaGFuZGxpbmchIik7CiAgfSwKICAvKiBqc2hpbnQgdW51c2VkOnRydWUgKi8KCiAgLyoqIFByaXZhdGVGdW5jdGlvbjogb25GYWlsdXJlCiAgICogIFByb3RvY29sIGluZm9ybXMgbWVjaGFuaXNtIGltcGxlbWVudGF0aW9uIGFib3V0IFNBU0wgZmFpbHVyZS4KICAgKi8KICBvbkZhaWx1cmU6IGZ1bmN0aW9uKCkgewogICAgdGhpcy5fY29ubmVjdGlvbiA9IG51bGw7CiAgfSwKCiAgLyoqIFByaXZhdGVGdW5jdGlvbjogb25TdWNjZXNzCiAgICogIFByb3RvY29sIGluZm9ybXMgbWVjaGFuaXNtIGltcGxlbWVudGF0aW9uIGFib3V0IFNBU0wgc3VjY2Vzcy4KICAgKi8KICBvblN1Y2Nlc3M6IGZ1bmN0aW9uKCkgewogICAgdGhpcy5fY29ubmVjdGlvbiA9IG51bGw7CiAgfQp9OwoKICAvKiogQ29uc3RhbnRzOiBTQVNMIG1lY2hhbmlzbXMKICAgKiAgQXZhaWxhYmxlIGF1dGhlbnRpY2F0aW9uIG1lY2hhbmlzbXMKICAgKgogICAqICBTdHJvcGhlLlNBU0xBbm9ueW1vdXMgLSBTQVNMIEFub255bW91cyBhdXRoZW50aWNhdGlvbi4KICAgKiAgU3Ryb3BoZS5TQVNMUGxhaW4gLSBTQVNMIFBsYWluIGF1dGhlbnRpY2F0aW9uLgogICAqICBTdHJvcGhlLlNBU0xNRDUgLSBTQVNMIERpZ2VzdC1NRDUgYXV0aGVudGljYXRpb24KICAgKiAgU3Ryb3BoZS5TQVNMU0hBMSAtIFNBU0wgU0NSQU0tU0hBMSBhdXRoZW50aWNhdGlvbgogICAqLwoKLy8gQnVpbGRpbmcgU0FTTCBjYWxsYmFja3MKCi8qKiBQcml2YXRlQ29uc3RydWN0b3I6IFNBU0xBbm9ueW1vdXMKICogIFNBU0wgQW5vbnltb3VzIGF1dGhlbnRpY2F0aW9uLgogKi8KU3Ryb3BoZS5TQVNMQW5vbnltb3VzID0gZnVuY3Rpb24oKSB7fTsKClN0cm9waGUuU0FTTEFub255bW91cy5wcm90b3R5cGUgPSBuZXcgU3Ryb3BoZS5TQVNMTWVjaGFuaXNtKCJBTk9OWU1PVVMiLCBmYWxzZSwgMTApOwoKU3Ryb3BoZS5TQVNMQW5vbnltb3VzLnRlc3QgPSBmdW5jdGlvbihjb25uZWN0aW9uKSB7CiAgcmV0dXJuIGNvbm5lY3Rpb24uYXV0aGNpZCA9PT0gbnVsbDsKfTsKClN0cm9waGUuQ29ubmVjdGlvbi5wcm90b3R5cGUubWVjaGFuaXNtc1tTdHJvcGhlLlNBU0xBbm9ueW1vdXMucHJvdG90eXBlLm5hbWVdID0gU3Ryb3BoZS5TQVNMQW5vbnltb3VzOwoKLyoqIFByaXZhdGVDb25zdHJ1Y3RvcjogU0FTTFBsYWluCiAqICBTQVNMIFBsYWluIGF1dGhlbnRpY2F0aW9uLgogKi8KU3Ryb3BoZS5TQVNMUGxhaW4gPSBmdW5jdGlvbigpIHt9OwoKU3Ryb3BoZS5TQVNMUGxhaW4ucHJvdG90eXBlID0gbmV3IFN0cm9waGUuU0FTTE1lY2hhbmlzbSgiUExBSU4iLCB0cnVlLCAyMCk7CgpTdHJvcGhlLlNBU0xQbGFpbi50ZXN0ID0gZnVuY3Rpb24oY29ubmVjdGlvbikgewogIHJldHVybiBjb25uZWN0aW9uLmF1dGhjaWQgIT09IG51bGw7Cn07CgpTdHJvcGhlLlNBU0xQbGFpbi5wcm90b3R5cGUub25DaGFsbGVuZ2UgPSBmdW5jdGlvbihjb25uZWN0aW9uKSB7CiAgdmFyIGF1dGhfc3RyID0gY29ubmVjdGlvbi5hdXRoemlkOwogIGF1dGhfc3RyID0gYXV0aF9zdHIgKyAiXHUwMDAwIjsKICBhdXRoX3N0ciA9IGF1dGhfc3RyICsgY29ubmVjdGlvbi5hdXRoY2lkOwogIGF1dGhfc3RyID0gYXV0aF9zdHIgKyAiXHUwMDAwIjsKICBhdXRoX3N0ciA9IGF1dGhfc3RyICsgY29ubmVjdGlvbi5wYXNzOwogIHJldHVybiBhdXRoX3N0cjsKfTsKClN0cm9waGUuQ29ubmVjdGlvbi5wcm90b3R5cGUubWVjaGFuaXNtc1tTdHJvcGhlLlNBU0xQbGFpbi5wcm90b3R5cGUubmFtZV0gPSBTdHJvcGhlLlNBU0xQbGFpbjsKCi8qKiBQcml2YXRlQ29uc3RydWN0b3I6IFNBU0xTSEExCiAqICBTQVNMIFNDUkFNIFNIQSAxIGF1dGhlbnRpY2F0aW9uLgogKi8KU3Ryb3BoZS5TQVNMU0hBMSA9IGZ1bmN0aW9uKCkge307CgovKiBURVNUOgogKiBUaGlzIGlzIGEgc2ltcGxlIGV4YW1wbGUgb2YgYSBTQ1JBTS1TSEEtMSBhdXRoZW50aWNhdGlvbiBleGNoYW5nZQogKiB3aGVuIHRoZSBjbGllbnQgZG9lc24ndCBzdXBwb3J0IGNoYW5uZWwgYmluZGluZ3MgKHVzZXJuYW1lICd1c2VyJyBhbmQKICogcGFzc3dvcmQgJ3BlbmNpbCcgYXJlIHVzZWQpOgogKgogKiBDOiBuLCxuPXVzZXIscj1meWtvK2QybGJiRmdPTlJ2OXFreGRhd0wKICogUzogcj1meWtvK2QybGJiRmdPTlJ2OXFreGRhd0wzcmZjTkhZSlkxWlZ2V1ZzN2oscz1RU1hDUitRNnNlazhiZjkyLAogKiBpPTQwOTYKICogQzogYz1iaXdzLHI9ZnlrbytkMmxiYkZnT05Sdjlxa3hkYXdMM3JmY05IWUpZMVpWdldWczdqLAogKiBwPXYwWDh2M0J6MlQwQ0pHYkpReUYwWCtISTRUcz0KICogUzogdj1ybUY5cHFWOFM3c3VBb1pXamE0ZEpSa0ZzS1E9CiAqCiAqLwoKU3Ryb3BoZS5TQVNMU0hBMS5wcm90b3R5cGUgPSBuZXcgU3Ryb3BoZS5TQVNMTWVjaGFuaXNtKCJTQ1JBTS1TSEEtMSIsIHRydWUsIDQwKTsKClN0cm9waGUuU0FTTFNIQTEudGVzdCA9IGZ1bmN0aW9uKGNvbm5lY3Rpb24pIHsKICByZXR1cm4gY29ubmVjdGlvbi5hdXRoY2lkICE9PSBudWxsOwp9OwoKU3Ryb3BoZS5TQVNMU0hBMS5wcm90b3R5cGUub25DaGFsbGVuZ2UgPSBmdW5jdGlvbihjb25uZWN0aW9uLCBjaGFsbGVuZ2UsIHRlc3RfY25vbmNlKSB7CiAgdmFyIGNub25jZSA9IHRlc3RfY25vbmNlIHx8IE1ENS5oZXhkaWdlc3QoTWF0aC5yYW5kb20oKSAqIDEyMzQ1Njc4OTApOwoKICB2YXIgYXV0aF9zdHIgPSAibj0iICsgY29ubmVjdGlvbi5hdXRoY2lkOwogIGF1dGhfc3RyICs9ICIscj0iOwogIGF1dGhfc3RyICs9IGNub25jZTsKCiAgY29ubmVjdGlvbi5fc2FzbF9kYXRhLmNub25jZSA9IGNub25jZTsKICBjb25uZWN0aW9uLl9zYXNsX2RhdGFbImNsaWVudC1maXJzdC1tZXNzYWdlLWJhcmUiXSA9IGF1dGhfc3RyOwoKICBhdXRoX3N0ciA9ICJuLCwiICsgYXV0aF9zdHI7CgogIHRoaXMub25DaGFsbGVuZ2UgPSBmdW5jdGlvbiAoY29ubmVjdGlvbiwgY2hhbGxlbmdlKQogIHsKICAgIHZhciBub25jZSwgc2FsdCwgaXRlciwgSGksIFUsIFVfb2xkLCBpLCBrOwogICAgdmFyIGNsaWVudEtleSwgc2VydmVyS2V5LCBjbGllbnRTaWduYXR1cmU7CiAgICB2YXIgcmVzcG9uc2VUZXh0ID0gImM9Yml3cywiOwogICAgdmFyIGF1dGhNZXNzYWdlID0gY29ubmVjdGlvbi5fc2FzbF9kYXRhWyJjbGllbnQtZmlyc3QtbWVzc2FnZS1iYXJlIl0gKyAiLCIgKwogICAgICBjaGFsbGVuZ2UgKyAiLCI7CiAgICB2YXIgY25vbmNlID0gY29ubmVjdGlvbi5fc2FzbF9kYXRhLmNub25jZTsKICAgIHZhciBhdHRyaWJNYXRjaCA9IC8oW2Etel0rKT0oW14sXSspKCx8JCkvOwoKICAgIHdoaWxlIChjaGFsbGVuZ2UubWF0Y2goYXR0cmliTWF0Y2gpKSB7CiAgICAgIHZhciBtYXRjaGVzID0gY2hhbGxlbmdlLm1hdGNoKGF0dHJpYk1hdGNoKTsKICAgICAgY2hhbGxlbmdlID0gY2hhbGxlbmdlLnJlcGxhY2UobWF0Y2hlc1swXSwgIiIpOwogICAgICBzd2l0Y2ggKG1hdGNoZXNbMV0pIHsKICAgICAgY2FzZSAiciI6CiAgICAgICAgbm9uY2UgPSBtYXRjaGVzWzJdOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJzIjoKICAgICAgICBzYWx0ID0gbWF0Y2hlc1syXTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAiaSI6CiAgICAgICAgaXRlciA9IG1hdGNoZXNbMl07CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KCiAgICBpZiAobm9uY2Uuc3Vic3RyKDAsIGNub25jZS5sZW5ndGgpICE9PSBjbm9uY2UpIHsKICAgICAgY29ubmVjdGlvbi5fc2FzbF9kYXRhID0ge307CiAgICAgIHJldHVybiBjb25uZWN0aW9uLl9zYXNsX2ZhaWx1cmVfY2IoKTsKICAgIH0KCiAgICByZXNwb25zZVRleHQgKz0gInI9IiArIG5vbmNlOwogICAgYXV0aE1lc3NhZ2UgKz0gcmVzcG9uc2VUZXh0OwoKICAgIHNhbHQgPSBCYXNlNjQuZGVjb2RlKHNhbHQpOwogICAgc2FsdCArPSAiXHgwMFx4MDBceDAwXHgwMSI7CgogICAgSGkgPSBVX29sZCA9IGNvcmVfaG1hY19zaGExKGNvbm5lY3Rpb24ucGFzcywgc2FsdCk7CiAgICBmb3IgKGkgPSAxOyBpIDwgaXRlcjsgaSsrKSB7CiAgICAgIFUgPSBjb3JlX2htYWNfc2hhMShjb25uZWN0aW9uLnBhc3MsIGJpbmIyc3RyKFVfb2xkKSk7CiAgICAgIGZvciAoayA9IDA7IGsgPCA1OyBrKyspIHsKICAgICAgICBIaVtrXSBePSBVW2tdOwogICAgICB9CiAgICAgIFVfb2xkID0gVTsKICAgIH0KICAgIEhpID0gYmluYjJzdHIoSGkpOwoKICAgIGNsaWVudEtleSA9IGNvcmVfaG1hY19zaGExKEhpLCAiQ2xpZW50IEtleSIpOwogICAgc2VydmVyS2V5ID0gc3RyX2htYWNfc2hhMShIaSwgIlNlcnZlciBLZXkiKTsKICAgIGNsaWVudFNpZ25hdHVyZSA9IGNvcmVfaG1hY19zaGExKHN0cl9zaGExKGJpbmIyc3RyKGNsaWVudEtleSkpLCBhdXRoTWVzc2FnZSk7CiAgICBjb25uZWN0aW9uLl9zYXNsX2RhdGFbInNlcnZlci1zaWduYXR1cmUiXSA9IGI2NF9obWFjX3NoYTEoc2VydmVyS2V5LCBhdXRoTWVzc2FnZSk7CgogICAgZm9yIChrID0gMDsgayA8IDU7IGsrKykgewogICAgICBjbGllbnRLZXlba10gXj0gY2xpZW50U2lnbmF0dXJlW2tdOwogICAgfQoKICAgIHJlc3BvbnNlVGV4dCArPSAiLHA9IiArIEJhc2U2NC5lbmNvZGUoYmluYjJzdHIoY2xpZW50S2V5KSk7CgogICAgcmV0dXJuIHJlc3BvbnNlVGV4dDsKICB9LmJpbmQodGhpcyk7CgogIHJldHVybiBhdXRoX3N0cjsKfTsKClN0cm9waGUuQ29ubmVjdGlvbi5wcm90b3R5cGUubWVjaGFuaXNtc1tTdHJvcGhlLlNBU0xTSEExLnByb3RvdHlwZS5uYW1lXSA9IFN0cm9waGUuU0FTTFNIQTE7CgovKiogUHJpdmF0ZUNvbnN0cnVjdG9yOiBTQVNMTUQ1CiAqICBTQVNMIERJR0VTVCBNRDUgYXV0aGVudGljYXRpb24uCiAqLwpTdHJvcGhlLlNBU0xNRDUgPSBmdW5jdGlvbigpIHt9OwoKU3Ryb3BoZS5TQVNMTUQ1LnByb3RvdHlwZSA9IG5ldyBTdHJvcGhlLlNBU0xNZWNoYW5pc20oIkRJR0VTVC1NRDUiLCBmYWxzZSwgMzApOwoKU3Ryb3BoZS5TQVNMTUQ1LnRlc3QgPSBmdW5jdGlvbihjb25uZWN0aW9uKSB7CiAgcmV0dXJuIGNvbm5lY3Rpb24uYXV0aGNpZCAhPT0gbnVsbDsKfTsKCi8qKiBQcml2YXRlRnVuY3Rpb246IF9xdW90ZQogKiAgX1ByaXZhdGVfIHV0aWxpdHkgZnVuY3Rpb24gdG8gYmFja3NsYXNoIGVzY2FwZSBhbmQgcXVvdGUgc3RyaW5ncy4KICoKICogIFBhcmFtZXRlcnM6CiAqICAgIChTdHJpbmcpIHN0ciAtIFRoZSBzdHJpbmcgdG8gYmUgcXVvdGVkLgogKgogKiAgUmV0dXJuczoKICogICAgcXVvdGVkIHN0cmluZwogKi8KU3Ryb3BoZS5TQVNMTUQ1LnByb3RvdHlwZS5fcXVvdGUgPSBmdW5jdGlvbiAoc3RyKQogIHsKICAgIHJldHVybiAnIicgKyBzdHIucmVwbGFjZSgvXFwvZywgIlxcXFwiKS5yZXBsYWNlKC8iL2csICdcXCInKSArICciJzsKICAgIC8vIiBlbmQgc3RyaW5nIHdvcmthcm91bmQgZm9yIGVtYWNzCiAgfTsKCgpTdHJvcGhlLlNBU0xNRDUucHJvdG90eXBlLm9uQ2hhbGxlbmdlID0gZnVuY3Rpb24oY29ubmVjdGlvbiwgY2hhbGxlbmdlLCB0ZXN0X2Nub25jZSkgewogIHZhciBhdHRyaWJNYXRjaCA9IC8oW2Etel0rKT0oIlteIl0rInxbXiwiXSspKD86LHwkKS87CiAgdmFyIGNub25jZSA9IHRlc3RfY25vbmNlIHx8IE1ENS5oZXhkaWdlc3QoIiIgKyAoTWF0aC5yYW5kb20oKSAqIDEyMzQ1Njc4OTApKTsKICB2YXIgcmVhbG0gPSAiIjsKICB2YXIgaG9zdCA9IG51bGw7CiAgdmFyIG5vbmNlID0gIiI7CiAgdmFyIHFvcCA9ICIiOwogIHZhciBtYXRjaGVzOwoKICB3aGlsZSAoY2hhbGxlbmdlLm1hdGNoKGF0dHJpYk1hdGNoKSkgewogICAgbWF0Y2hlcyA9IGNoYWxsZW5nZS5tYXRjaChhdHRyaWJNYXRjaCk7CiAgICBjaGFsbGVuZ2UgPSBjaGFsbGVuZ2UucmVwbGFjZShtYXRjaGVzWzBdLCAiIik7CiAgICBtYXRjaGVzWzJdID0gbWF0Y2hlc1syXS5yZXBsYWNlKC9eIiguKykiJC8sICIkMSIpOwogICAgc3dpdGNoIChtYXRjaGVzWzFdKSB7CiAgICBjYXNlICJyZWFsbSI6CiAgICAgIHJlYWxtID0gbWF0Y2hlc1syXTsKICAgICAgYnJlYWs7CiAgICBjYXNlICJub25jZSI6CiAgICAgIG5vbmNlID0gbWF0Y2hlc1syXTsKICAgICAgYnJlYWs7CiAgICBjYXNlICJxb3AiOgogICAgICBxb3AgPSBtYXRjaGVzWzJdOwogICAgICBicmVhazsKICAgIGNhc2UgImhvc3QiOgogICAgICBob3N0ID0gbWF0Y2hlc1syXTsKICAgICAgYnJlYWs7CiAgICB9CiAgfQoKICB2YXIgZGlnZXN0X3VyaSA9IGNvbm5lY3Rpb24uc2VydnR5cGUgKyAiLyIgKyBjb25uZWN0aW9uLmRvbWFpbjsKICBpZiAoaG9zdCAhPT0gbnVsbCkgewogICAgZGlnZXN0X3VyaSA9IGRpZ2VzdF91cmkgKyAiLyIgKyBob3N0OwogIH0KCiAgdmFyIEExID0gTUQ1Lmhhc2goY29ubmVjdGlvbi5hdXRoY2lkICsKICAgICAgICAgICAgICAgICAgICAiOiIgKyByZWFsbSArICI6IiArIHRoaXMuX2Nvbm5lY3Rpb24ucGFzcykgKwogICAgIjoiICsgbm9uY2UgKyAiOiIgKyBjbm9uY2U7CiAgdmFyIEEyID0gJ0FVVEhFTlRJQ0FURTonICsgZGlnZXN0X3VyaTsKCiAgdmFyIHJlc3BvbnNlVGV4dCA9ICIiOwogIHJlc3BvbnNlVGV4dCArPSAnY2hhcnNldD11dGYtOCwnOwogIHJlc3BvbnNlVGV4dCArPSAndXNlcm5hbWU9JyArCiAgICB0aGlzLl9xdW90ZShjb25uZWN0aW9uLmF1dGhjaWQpICsgJywnOwogIHJlc3BvbnNlVGV4dCArPSAncmVhbG09JyArIHRoaXMuX3F1b3RlKHJlYWxtKSArICcsJzsKICByZXNwb25zZVRleHQgKz0gJ25vbmNlPScgKyB0aGlzLl9xdW90ZShub25jZSkgKyAnLCc7CiAgcmVzcG9uc2VUZXh0ICs9ICduYz0wMDAwMDAwMSwnOwogIHJlc3BvbnNlVGV4dCArPSAnY25vbmNlPScgKyB0aGlzLl9xdW90ZShjbm9uY2UpICsgJywnOwogIHJlc3BvbnNlVGV4dCArPSAnZGlnZXN0LXVyaT0nICsgdGhpcy5fcXVvdGUoZGlnZXN0X3VyaSkgKyAnLCc7CiAgcmVzcG9uc2VUZXh0ICs9ICdyZXNwb25zZT0nICsgTUQ1LmhleGRpZ2VzdChNRDUuaGV4ZGlnZXN0KEExKSArICI6IiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub25jZSArICI6MDAwMDAwMDE6IiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbm9uY2UgKyAiOmF1dGg6IiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNRDUuaGV4ZGlnZXN0KEEyKSkgKyAiLCI7CiAgcmVzcG9uc2VUZXh0ICs9ICdxb3A9YXV0aCc7CgogIHRoaXMub25DaGFsbGVuZ2UgPSBmdW5jdGlvbiAoKQogIHsKICAgIHJldHVybiAiIjsKICB9LmJpbmQodGhpcyk7CgogIHJldHVybiByZXNwb25zZVRleHQ7Cn07CgpTdHJvcGhlLkNvbm5lY3Rpb24ucHJvdG90eXBlLm1lY2hhbmlzbXNbU3Ryb3BoZS5TQVNMTUQ1LnByb3RvdHlwZS5uYW1lXSA9IFN0cm9waGUuU0FTTE1ENTsKCn0pKGZ1bmN0aW9uICgpIHsKICAgIHdpbmRvdy5TdHJvcGhlID0gYXJndW1lbnRzWzBdOwogICAgd2luZG93LiRidWlsZCA9IGFyZ3VtZW50c1sxXTsKICAgIHdpbmRvdy4kbXNnID0gYXJndW1lbnRzWzJdOwogICAgd2luZG93LiRpcSA9IGFyZ3VtZW50c1szXTsKICAgIHdpbmRvdy4kcHJlcyA9IGFyZ3VtZW50c1s0XTsKfSk7CgovKgogICAgVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgTUlUIGxpY2Vuc2UuCiAgICBQbGVhc2Ugc2VlIHRoZSBMSUNFTlNFIGZpbGUgZm9yIGRldGFpbHMuCgogICAgQ29weXJpZ2h0IDIwMDYtMjAwOCwgT0dHLCBMTEMKKi8KCi8qIGpzaGludCB1bmRlZjogdHJ1ZSwgdW51c2VkOiB0cnVlOiwgbm9hcmc6IHRydWUsIGxhdGVkZWY6IHRydWUgKi8KLypnbG9iYWwgd2luZG93LCBzZXRUaW1lb3V0LCBjbGVhclRpbWVvdXQsCiAgICBYTUxIdHRwUmVxdWVzdCwgQWN0aXZlWE9iamVjdCwKICAgIFN0cm9waGUsICRidWlsZCAqLwoKCi8qKiBQcml2YXRlQ2xhc3M6IFN0cm9waGUuUmVxdWVzdAogKiAgX1ByaXZhdGVfIGhlbHBlciBjbGFzcyB0aGF0IHByb3ZpZGVzIGEgY3Jvc3MgaW1wbGVtZW50YXRpb24gYWJzdHJhY3Rpb24KICogIGZvciBhIEJPU0ggcmVsYXRlZCBYTUxIdHRwUmVxdWVzdC4KICoKICogIFRoZSBTdHJvcGhlLlJlcXVlc3QgY2xhc3MgaXMgdXNlZCBpbnRlcm5hbGx5IHRvIGVuY2Fwc3VsYXRlIEJPU0ggcmVxdWVzdAogKiAgaW5mb3JtYXRpb24uICBJdCBpcyBub3QgbWVhbnQgdG8gYmUgdXNlZCBmcm9tIHVzZXIncyBjb2RlLgogKi8KCi8qKiBQcml2YXRlQ29uc3RydWN0b3I6IFN0cm9waGUuUmVxdWVzdAogKiAgQ3JlYXRlIGFuZCBpbml0aWFsaXplIGEgbmV3IFN0cm9waGUuUmVxdWVzdCBvYmplY3QuCiAqCiAqICBQYXJhbWV0ZXJzOgogKiAgICAoWE1MRWxlbWVudCkgZWxlbSAtIFRoZSBYTUwgZGF0YSB0byBiZSBzZW50IGluIHRoZSByZXF1ZXN0LgogKiAgICAoRnVuY3Rpb24pIGZ1bmMgLSBUaGUgZnVuY3Rpb24gdGhhdCB3aWxsIGJlIGNhbGxlZCB3aGVuIHRoZQogKiAgICAgIFhNTEh0dHBSZXF1ZXN0IHJlYWR5U3RhdGUgY2hhbmdlcy4KICogICAgKEludGVnZXIpIHJpZCAtIFRoZSBCT1NIIHJpZCBhdHRyaWJ1dGUgYXNzb2NpYXRlZCB3aXRoIHRoaXMgcmVxdWVzdC4KICogICAgKEludGVnZXIpIHNlbmRzIC0gVGhlIG51bWJlciBvZiB0aW1lcyB0aGlzIHNhbWUgcmVxdWVzdCBoYXMgYmVlbgogKiAgICAgIHNlbnQuCiAqLwpTdHJvcGhlLlJlcXVlc3QgPSBmdW5jdGlvbiAoZWxlbSwgZnVuYywgcmlkLCBzZW5kcykKewogICAgdGhpcy5pZCA9ICsrU3Ryb3BoZS5fcmVxdWVzdElkOwogICAgdGhpcy54bWxEYXRhID0gZWxlbTsKICAgIHRoaXMuZGF0YSA9IFN0cm9waGUuc2VyaWFsaXplKGVsZW0pOwogICAgLy8gc2F2ZSBvcmlnaW5hbCBmdW5jdGlvbiBpbiBjYXNlIHdlIG5lZWQgdG8gbWFrZSBhIG5ldyByZXF1ZXN0CiAgICAvLyBmcm9tIHRoaXMgb25lLgogICAgdGhpcy5vcmlnRnVuYyA9IGZ1bmM7CiAgICB0aGlzLmZ1bmMgPSBmdW5jOwogICAgdGhpcy5yaWQgPSByaWQ7CiAgICB0aGlzLmRhdGUgPSBOYU47CiAgICB0aGlzLnNlbmRzID0gc2VuZHMgfHwgMDsKICAgIHRoaXMuYWJvcnQgPSBmYWxzZTsKICAgIHRoaXMuZGVhZCA9IG51bGw7CgogICAgdGhpcy5hZ2UgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKCF0aGlzLmRhdGUpIHsgcmV0dXJuIDA7IH0KICAgICAgICB2YXIgbm93ID0gbmV3IERhdGUoKTsKICAgICAgICByZXR1cm4gKG5vdyAtIHRoaXMuZGF0ZSkgLyAxMDAwOwogICAgfTsKICAgIHRoaXMudGltZURlYWQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKCF0aGlzLmRlYWQpIHsgcmV0dXJuIDA7IH0KICAgICAgICB2YXIgbm93ID0gbmV3IERhdGUoKTsKICAgICAgICByZXR1cm4gKG5vdyAtIHRoaXMuZGVhZCkgLyAxMDAwOwogICAgfTsKICAgIHRoaXMueGhyID0gdGhpcy5fbmV3WEhSKCk7Cn07CgpTdHJvcGhlLlJlcXVlc3QucHJvdG90eXBlID0gewogICAgLyoqIFByaXZhdGVGdW5jdGlvbjogZ2V0UmVzcG9uc2UKICAgICAqICBHZXQgYSByZXNwb25zZSBmcm9tIHRoZSB1bmRlcmx5aW5nIFhNTEh0dHBSZXF1ZXN0LgogICAgICoKICAgICAqICBUaGlzIGZ1bmN0aW9uIGF0dGVtcHRzIHRvIGdldCBhIHJlc3BvbnNlIGZyb20gdGhlIHJlcXVlc3QgYW5kIGNoZWNrcwogICAgICogIGZvciBlcnJvcnMuCiAgICAgKgogICAgICogIFRocm93czoKICAgICAqICAgICJwYXJzZXJlcnJvciIgLSBBIHBhcnNlciBlcnJvciBvY2N1cmVkLgogICAgICoKICAgICAqICBSZXR1cm5zOgogICAgICogICAgVGhlIERPTSBlbGVtZW50IHRyZWUgb2YgdGhlIHJlc3BvbnNlLgogICAgICovCiAgICBnZXRSZXNwb25zZTogZnVuY3Rpb24gKCkKICAgIHsKICAgICAgICB2YXIgbm9kZSA9IG51bGw7CiAgICAgICAgaWYgKHRoaXMueGhyLnJlc3BvbnNlWE1MICYmIHRoaXMueGhyLnJlc3BvbnNlWE1MLmRvY3VtZW50RWxlbWVudCkgewogICAgICAgICAgICBub2RlID0gdGhpcy54aHIucmVzcG9uc2VYTUwuZG9jdW1lbnRFbGVtZW50OwogICAgICAgICAgICBpZiAobm9kZS50YWdOYW1lID09ICJwYXJzZXJlcnJvciIpIHsKICAgICAgICAgICAgICAgIFN0cm9waGUuZXJyb3IoImludmFsaWQgcmVzcG9uc2UgcmVjZWl2ZWQiKTsKICAgICAgICAgICAgICAgIFN0cm9waGUuZXJyb3IoInJlc3BvbnNlVGV4dDogIiArIHRoaXMueGhyLnJlc3BvbnNlVGV4dCk7CiAgICAgICAgICAgICAgICBTdHJvcGhlLmVycm9yKCJyZXNwb25zZVhNTDogIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFN0cm9waGUuc2VyaWFsaXplKHRoaXMueGhyLnJlc3BvbnNlWE1MKSk7CiAgICAgICAgICAgICAgICB0aHJvdyAicGFyc2VyZXJyb3IiOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnhoci5yZXNwb25zZVRleHQpIHsKICAgICAgICAgICAgU3Ryb3BoZS5lcnJvcigiaW52YWxpZCByZXNwb25zZSByZWNlaXZlZCIpOwogICAgICAgICAgICBTdHJvcGhlLmVycm9yKCJyZXNwb25zZVRleHQ6ICIgKyB0aGlzLnhoci5yZXNwb25zZVRleHQpOwogICAgICAgICAgICBTdHJvcGhlLmVycm9yKCJyZXNwb25zZVhNTDogIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgU3Ryb3BoZS5zZXJpYWxpemUodGhpcy54aHIucmVzcG9uc2VYTUwpKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBub2RlOwogICAgfSwKCiAgICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiBfbmV3WEhSCiAgICAgKiAgX1ByaXZhdGVfIGhlbHBlciBmdW5jdGlvbiB0byBjcmVhdGUgWE1MSHR0cFJlcXVlc3RzLgogICAgICoKICAgICAqICBUaGlzIGZ1bmN0aW9uIGNyZWF0ZXMgWE1MSHR0cFJlcXVlc3RzIGFjcm9zcyBhbGwgaW1wbGVtZW50YXRpb25zLgogICAgICoKICAgICAqICBSZXR1cm5zOgogICAgICogICAgQSBuZXcgWE1MSHR0cFJlcXVlc3QuCiAgICAgKi8KICAgIF9uZXdYSFI6IGZ1bmN0aW9uICgpCiAgICB7CiAgICAgICAgdmFyIHhociA9IG51bGw7CiAgICAgICAgaWYgKHdpbmRvdy5YTUxIdHRwUmVxdWVzdCkgewogICAgICAgICAgICB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKICAgICAgICAgICAgaWYgKHhoci5vdmVycmlkZU1pbWVUeXBlKSB7CiAgICAgICAgICAgICAgICB4aHIub3ZlcnJpZGVNaW1lVHlwZSgidGV4dC94bWwiKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAod2luZG93LkFjdGl2ZVhPYmplY3QpIHsKICAgICAgICAgICAgeGhyID0gbmV3IEFjdGl2ZVhPYmplY3QoIk1pY3Jvc29mdC5YTUxIVFRQIik7CiAgICAgICAgfQoKICAgICAgICAvLyB1c2UgRnVuY3Rpb24uYmluZCgpIHRvIHByZXBlbmQgb3Vyc2VsdmVzIGFzIGFuIGFyZ3VtZW50CiAgICAgICAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IHRoaXMuZnVuYy5iaW5kKG51bGwsIHRoaXMpOwoKICAgICAgICByZXR1cm4geGhyOwogICAgfQp9OwoKLyoqIENsYXNzOiBTdHJvcGhlLkJvc2gKICogIF9Qcml2YXRlXyBoZWxwZXIgY2xhc3MgdGhhdCBoYW5kbGVzIEJPU0ggQ29ubmVjdGlvbnMKICoKICogIFRoZSBTdHJvcGhlLkJvc2ggY2xhc3MgaXMgdXNlZCBpbnRlcm5hbGx5IGJ5IFN0cm9waGUuQ29ubmVjdGlvbgogKiAgdG8gZW5jYXBzdWxhdGUgQk9TSCBzZXNzaW9ucy4gSXQgaXMgbm90IG1lYW50IHRvIGJlIHVzZWQgZnJvbSB1c2VyJ3MgY29kZS4KICovCgovKiogRmlsZTogYm9zaC5qcwogKiAgQSBKYXZhU2NyaXB0IGxpYnJhcnkgdG8gZW5hYmxlIEJPU0ggaW4gU3Ryb3BoZWpzLgogKgogKiAgdGhpcyBsaWJyYXJ5IHVzZXMgQmlkaXJlY3Rpb25hbC1zdHJlYW1zIE92ZXIgU3luY2hyb25vdXMgSFRUUCAoQk9TSCkKICogIHRvIGVtdWxhdGUgYSBwZXJzaXN0ZW50LCBzdGF0ZWZ1bCwgdHdvLXdheSBjb25uZWN0aW9uIHRvIGFuIFhNUFAgc2VydmVyLgogKiAgTW9yZSBpbmZvcm1hdGlvbiBvbiBCT1NIIGNhbiBiZSBmb3VuZCBpbiBYRVAgMTI0LgogKi8KCi8qKiBQcml2YXRlQ29uc3RydWN0b3I6IFN0cm9waGUuQm9zaAogKiAgQ3JlYXRlIGFuZCBpbml0aWFsaXplIGEgU3Ryb3BoZS5Cb3NoIG9iamVjdC4KICoKICogIFBhcmFtZXRlcnM6CiAqICAgIChTdHJvcGhlLkNvbm5lY3Rpb24pIGNvbm5lY3Rpb24gLSBUaGUgU3Ryb3BoZS5Db25uZWN0aW9uIHRoYXQgd2lsbCB1c2UgQk9TSC4KICoKICogIFJldHVybnM6CiAqICAgIEEgbmV3IFN0cm9waGUuQm9zaCBvYmplY3QuCiAqLwpTdHJvcGhlLkJvc2ggPSBmdW5jdGlvbihjb25uZWN0aW9uKSB7CiAgICB0aGlzLl9jb25uID0gY29ubmVjdGlvbjsKICAgIC8qIHJlcXVlc3QgaWQgZm9yIGJvZHkgdGFncyAqLwogICAgdGhpcy5yaWQgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiA0Mjk0OTY3Mjk1KTsKICAgIC8qIFRoZSBjdXJyZW50IHNlc3Npb24gSUQuICovCiAgICB0aGlzLnNpZCA9IG51bGw7CgogICAgLy8gZGVmYXVsdCBCT1NIIHZhbHVlcwogICAgdGhpcy5ob2xkID0gMTsKICAgIHRoaXMud2FpdCA9IDYwOwogICAgdGhpcy53aW5kb3cgPSA1OwoKICAgIHRoaXMuX3JlcXVlc3RzID0gW107Cn07CgpTdHJvcGhlLkJvc2gucHJvdG90eXBlID0gewogICAgLyoqIFZhcmlhYmxlOiBzdHJpcAogICAgICoKICAgICAqICBCT1NILUNvbm5lY3Rpb25zIHdpbGwgaGF2ZSBhbGwgc3RhbnphcyB3cmFwcGVkIGluIGEgPGJvZHk+IHRhZyB3aGVuCiAgICAgKiAgcGFzc2VkIHRvIDxTdHJvcGhlLkNvbm5lY3Rpb24ueG1sSW5wdXQ+IG9yIDxTdHJvcGhlLkNvbm5lY3Rpb24ueG1sT3V0cHV0Pi4KICAgICAqICBUbyBzdHJpcCB0aGlzIHRhZywgVXNlciBjb2RlIGNhbiBzZXQgPFN0cm9waGUuQm9zaC5zdHJpcD4gdG8gImJvZHkiOgogICAgICoKICAgICAqICA+IFN0cm9waGUuQm9zaC5wcm90b3R5cGUuc3RyaXAgPSAiYm9keSI7CiAgICAgKgogICAgICogIFRoaXMgd2lsbCBlbmFibGUgc3RyaXBwaW5nIG9mIHRoZSBib2R5IHRhZyBpbiBib3RoCiAgICAgKiAgPFN0cm9waGUuQ29ubmVjdGlvbi54bWxJbnB1dD4gYW5kIDxTdHJvcGhlLkNvbm5lY3Rpb24ueG1sT3V0cHV0Pi4KICAgICAqLwogICAgc3RyaXA6IG51bGwsCgogICAgLyoqIFByaXZhdGVGdW5jdGlvbjogX2J1aWxkQm9keQogICAgICogIF9Qcml2YXRlXyBoZWxwZXIgZnVuY3Rpb24gdG8gZ2VuZXJhdGUgdGhlIDxib2R5Lz4gd3JhcHBlciBmb3IgQk9TSC4KICAgICAqCiAgICAgKiAgUmV0dXJuczoKICAgICAqICAgIEEgU3Ryb3BoZS5CdWlsZGVyIHdpdGggYSA8Ym9keS8+IGVsZW1lbnQuCiAgICAgKi8KICAgIF9idWlsZEJvZHk6IGZ1bmN0aW9uICgpCiAgICB7CiAgICAgICAgdmFyIGJvZHlXcmFwID0gJGJ1aWxkKCdib2R5JywgewogICAgICAgICAgICByaWQ6IHRoaXMucmlkKyssCiAgICAgICAgICAgIHhtbG5zOiBTdHJvcGhlLk5TLkhUVFBCSU5ECiAgICAgICAgfSk7CgogICAgICAgIGlmICh0aGlzLnNpZCAhPT0gbnVsbCkgewogICAgICAgICAgICBib2R5V3JhcC5hdHRycyh7c2lkOiB0aGlzLnNpZH0pOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGJvZHlXcmFwOwogICAgfSwKCiAgICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiBfcmVzZXQKICAgICAqICBSZXNldCB0aGUgY29ubmVjdGlvbi4KICAgICAqCiAgICAgKiAgVGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgYnkgdGhlIHJlc2V0IGZ1bmN0aW9uIG9mIHRoZSBTdHJvcGhlIENvbm5lY3Rpb24KICAgICAqLwogICAgX3Jlc2V0OiBmdW5jdGlvbiAoKQogICAgewogICAgICAgIHRoaXMucmlkID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogNDI5NDk2NzI5NSk7CiAgICAgICAgdGhpcy5zaWQgPSBudWxsOwogICAgfSwKCiAgICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiBfY29ubmVjdAogICAgICogIF9Qcml2YXRlXyBmdW5jdGlvbiB0aGF0IGluaXRpYWxpemVzIHRoZSBCT1NIIGNvbm5lY3Rpb24uCiAgICAgKgogICAgICogIENyZWF0ZXMgYW5kIHNlbmRzIHRoZSBSZXF1ZXN0IHRoYXQgaW5pdGlhbGl6ZXMgdGhlIEJPU0ggY29ubmVjdGlvbi4KICAgICAqLwogICAgX2Nvbm5lY3Q6IGZ1bmN0aW9uICh3YWl0LCBob2xkLCByb3V0ZSkKICAgIHsKICAgICAgICB0aGlzLndhaXQgPSB3YWl0IHx8IHRoaXMud2FpdDsKICAgICAgICB0aGlzLmhvbGQgPSBob2xkIHx8IHRoaXMuaG9sZDsKCiAgICAgICAgLy8gYnVpbGQgdGhlIGJvZHkgdGFnCiAgICAgICAgdmFyIGJvZHkgPSB0aGlzLl9idWlsZEJvZHkoKS5hdHRycyh7CiAgICAgICAgICAgIHRvOiB0aGlzLl9jb25uLmRvbWFpbiwKICAgICAgICAgICAgInhtbDpsYW5nIjogImVuIiwKICAgICAgICAgICAgd2FpdDogdGhpcy53YWl0LAogICAgICAgICAgICBob2xkOiB0aGlzLmhvbGQsCiAgICAgICAgICAgIGNvbnRlbnQ6ICJ0ZXh0L3htbDsgY2hhcnNldD11dGYtOCIsCiAgICAgICAgICAgIHZlcjogIjEuNiIsCiAgICAgICAgICAgICJ4bXBwOnZlcnNpb24iOiAiMS4wIiwKICAgICAgICAgICAgInhtbG5zOnhtcHAiOiBTdHJvcGhlLk5TLkJPU0gKICAgICAgICB9KTsKCiAgICAgICAgaWYocm91dGUpewogICAgICAgICAgICBib2R5LmF0dHJzKHsKICAgICAgICAgICAgICAgIHJvdXRlOiByb3V0ZQogICAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIHZhciBfY29ubmVjdF9jYiA9IHRoaXMuX2Nvbm4uX2Nvbm5lY3RfY2I7CgogICAgICAgIHRoaXMuX3JlcXVlc3RzLnB1c2goCiAgICAgICAgICAgIG5ldyBTdHJvcGhlLlJlcXVlc3QoYm9keS50cmVlKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fb25SZXF1ZXN0U3RhdGVDaGFuZ2UuYmluZCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcywgX2Nvbm5lY3RfY2IuYmluZCh0aGlzLl9jb25uKSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9keS50cmVlKCkuZ2V0QXR0cmlidXRlKCJyaWQiKSkpOwogICAgICAgIHRoaXMuX3Rocm90dGxlZFJlcXVlc3RIYW5kbGVyKCk7CiAgICB9LAoKICAgIC8qKiBQcml2YXRlRnVuY3Rpb246IF9hdHRhY2gKICAgICAqICBBdHRhY2ggdG8gYW4gYWxyZWFkeSBjcmVhdGVkIGFuZCBhdXRoZW50aWNhdGVkIEJPU0ggc2Vzc2lvbi4KICAgICAqCiAgICAgKiAgVGhpcyBmdW5jdGlvbiBpcyBwcm92aWRlZCB0byBhbGxvdyBTdHJvcGhlIHRvIGF0dGFjaCB0byBCT1NICiAgICAgKiAgc2Vzc2lvbnMgd2hpY2ggaGF2ZSBiZWVuIGNyZWF0ZWQgZXh0ZXJuYWxseSwgcGVyaGFwcyBieSBhIFdlYgogICAgICogIGFwcGxpY2F0aW9uLiAgVGhpcyBpcyBvZnRlbiB1c2VkIHRvIHN1cHBvcnQgYXV0by1sb2dpbiB0eXBlIGZlYXR1cmVzCiAgICAgKiAgd2l0aG91dCBwdXR0aW5nIHVzZXIgY3JlZGVudGlhbHMgaW50byB0aGUgcGFnZS4KICAgICAqCiAgICAgKiAgUGFyYW1ldGVyczoKICAgICAqICAgIChTdHJpbmcpIGppZCAtIFRoZSBmdWxsIEpJRCB0aGF0IGlzIGJvdW5kIGJ5IHRoZSBzZXNzaW9uLgogICAgICogICAgKFN0cmluZykgc2lkIC0gVGhlIFNJRCBvZiB0aGUgQk9TSCBzZXNzaW9uLgogICAgICogICAgKFN0cmluZykgcmlkIC0gVGhlIGN1cnJlbnQgUklEIG9mIHRoZSBCT1NIIHNlc3Npb24uICBUaGlzIFJJRAogICAgICogICAgICB3aWxsIGJlIHVzZWQgYnkgdGhlIG5leHQgcmVxdWVzdC4KICAgICAqICAgIChGdW5jdGlvbikgY2FsbGJhY2sgVGhlIGNvbm5lY3QgY2FsbGJhY2sgZnVuY3Rpb24uCiAgICAgKiAgICAoSW50ZWdlcikgd2FpdCAtIFRoZSBvcHRpb25hbCBIVFRQQklORCB3YWl0IHZhbHVlLiAgVGhpcyBpcyB0aGUKICAgICAqICAgICAgdGltZSB0aGUgc2VydmVyIHdpbGwgd2FpdCBiZWZvcmUgcmV0dXJuaW5nIGFuIGVtcHR5IHJlc3VsdCBmb3IKICAgICAqICAgICAgYSByZXF1ZXN0LiAgVGhlIGRlZmF1bHQgc2V0dGluZyBvZiA2MCBzZWNvbmRzIGlzIHJlY29tbWVuZGVkLgogICAgICogICAgICBPdGhlciBzZXR0aW5ncyB3aWxsIHJlcXVpcmUgdHdlYWtzIHRvIHRoZSBTdHJvcGhlLlRJTUVPVVQgdmFsdWUuCiAgICAgKiAgICAoSW50ZWdlcikgaG9sZCAtIFRoZSBvcHRpb25hbCBIVFRQQklORCBob2xkIHZhbHVlLiAgVGhpcyBpcyB0aGUKICAgICAqICAgICAgbnVtYmVyIG9mIGNvbm5lY3Rpb25zIHRoZSBzZXJ2ZXIgd2lsbCBob2xkIGF0IG9uZSB0aW1lLiAgVGhpcwogICAgICogICAgICBzaG91bGQgYWxtb3N0IGFsd2F5cyBiZSBzZXQgdG8gMSAodGhlIGRlZmF1bHQpLgogICAgICogICAgKEludGVnZXIpIHdpbmQgLSBUaGUgb3B0aW9uYWwgSFRUQklORCB3aW5kb3cgdmFsdWUuICBUaGlzIGlzIHRoZQogICAgICogICAgICBhbGxvd2VkIHJhbmdlIG9mIHJlcXVlc3QgaWRzIHRoYXQgYXJlIHZhbGlkLiAgVGhlIGRlZmF1bHQgaXMgNS4KICAgICAqLwogICAgX2F0dGFjaDogZnVuY3Rpb24gKGppZCwgc2lkLCByaWQsIGNhbGxiYWNrLCB3YWl0LCBob2xkLCB3aW5kKQogICAgewogICAgICAgIHRoaXMuX2Nvbm4uamlkID0gamlkOwogICAgICAgIHRoaXMuc2lkID0gc2lkOwogICAgICAgIHRoaXMucmlkID0gcmlkOwoKICAgICAgICB0aGlzLl9jb25uLmNvbm5lY3RfY2FsbGJhY2sgPSBjYWxsYmFjazsKCiAgICAgICAgdGhpcy5fY29ubi5kb21haW4gPSBTdHJvcGhlLmdldERvbWFpbkZyb21KaWQodGhpcy5fY29ubi5qaWQpOwoKICAgICAgICB0aGlzLl9jb25uLmF1dGhlbnRpY2F0ZWQgPSB0cnVlOwogICAgICAgIHRoaXMuX2Nvbm4uY29ubmVjdGVkID0gdHJ1ZTsKCiAgICAgICAgdGhpcy53YWl0ID0gd2FpdCB8fCB0aGlzLndhaXQ7CiAgICAgICAgdGhpcy5ob2xkID0gaG9sZCB8fCB0aGlzLmhvbGQ7CiAgICAgICAgdGhpcy53aW5kb3cgPSB3aW5kIHx8IHRoaXMud2luZG93OwoKICAgICAgICB0aGlzLl9jb25uLl9jaGFuZ2VDb25uZWN0U3RhdHVzKFN0cm9waGUuU3RhdHVzLkFUVEFDSEVELCBudWxsKTsKICAgIH0sCgogICAgLyoqIFByaXZhdGVGdW5jdGlvbjogX2Nvbm5lY3RfY2IKICAgICAqICBfUHJpdmF0ZV8gaGFuZGxlciBmb3IgaW5pdGlhbCBjb25uZWN0aW9uIHJlcXVlc3QuCiAgICAgKgogICAgICogIFRoaXMgaGFuZGxlciBpcyB1c2VkIHRvIHByb2Nlc3MgdGhlIEJvc2gtcGFydCBvZiB0aGUgaW5pdGlhbCByZXF1ZXN0LgogICAgICogIFBhcmFtZXRlcnM6CiAgICAgKiAgICAoU3Ryb3BoZS5SZXF1ZXN0KSBib2R5V3JhcCAtIFRoZSByZWNlaXZlZCBzdGFuemEuCiAgICAgKi8KICAgIF9jb25uZWN0X2NiOiBmdW5jdGlvbiAoYm9keVdyYXApCiAgICB7CiAgICAgICAgdmFyIHR5cCA9IGJvZHlXcmFwLmdldEF0dHJpYnV0ZSgidHlwZSIpOwogICAgICAgIHZhciBjb25kLCBjb25mbGljdDsKICAgICAgICBpZiAodHlwICE9PSBudWxsICYmIHR5cCA9PSAidGVybWluYXRlIikgewogICAgICAgICAgICAvLyBhbiBlcnJvciBvY2N1cnJlZAogICAgICAgICAgICBTdHJvcGhlLmVycm9yKCJCT1NILUNvbm5lY3Rpb24gZmFpbGVkOiAiICsgY29uZCk7CiAgICAgICAgICAgIGNvbmQgPSBib2R5V3JhcC5nZXRBdHRyaWJ1dGUoImNvbmRpdGlvbiIpOwogICAgICAgICAgICBjb25mbGljdCA9IGJvZHlXcmFwLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJjb25mbGljdCIpOwogICAgICAgICAgICBpZiAoY29uZCAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKGNvbmQgPT0gInJlbW90ZS1zdHJlYW0tZXJyb3IiICYmIGNvbmZsaWN0Lmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBjb25kID0gImNvbmZsaWN0IjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuX2Nvbm4uX2NoYW5nZUNvbm5lY3RTdGF0dXMoU3Ryb3BoZS5TdGF0dXMuQ09OTkZBSUwsIGNvbmQpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5fY29ubi5fY2hhbmdlQ29ubmVjdFN0YXR1cyhTdHJvcGhlLlN0YXR1cy5DT05ORkFJTCwgInVua25vd24iKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLl9jb25uLl9kb0Rpc2Nvbm5lY3QoKTsKICAgICAgICAgICAgcmV0dXJuIFN0cm9waGUuU3RhdHVzLkNPTk5GQUlMOwogICAgICAgIH0KCiAgICAgICAgLy8gY2hlY2sgdG8gbWFrZSBzdXJlIHdlIGRvbid0IG92ZXJ3cml0ZSB0aGVzZSBpZiBfY29ubmVjdF9jYiBpcwogICAgICAgIC8vIGNhbGxlZCBtdWx0aXBsZSB0aW1lcyBpbiB0aGUgY2FzZSBvZiBtaXNzaW5nIHN0cmVhbTpmZWF0dXJlcwogICAgICAgIGlmICghdGhpcy5zaWQpIHsKICAgICAgICAgICAgdGhpcy5zaWQgPSBib2R5V3JhcC5nZXRBdHRyaWJ1dGUoInNpZCIpOwogICAgICAgIH0KICAgICAgICB2YXIgd2luZCA9IGJvZHlXcmFwLmdldEF0dHJpYnV0ZSgncmVxdWVzdHMnKTsKICAgICAgICBpZiAod2luZCkgeyB0aGlzLndpbmRvdyA9IHBhcnNlSW50KHdpbmQsIDEwKTsgfQogICAgICAgIHZhciBob2xkID0gYm9keVdyYXAuZ2V0QXR0cmlidXRlKCdob2xkJyk7CiAgICAgICAgaWYgKGhvbGQpIHsgdGhpcy5ob2xkID0gcGFyc2VJbnQoaG9sZCwgMTApOyB9CiAgICAgICAgdmFyIHdhaXQgPSBib2R5V3JhcC5nZXRBdHRyaWJ1dGUoJ3dhaXQnKTsKICAgICAgICBpZiAod2FpdCkgeyB0aGlzLndhaXQgPSBwYXJzZUludCh3YWl0LCAxMCk7IH0KICAgIH0sCgogICAgLyoqIFByaXZhdGVGdW5jdGlvbjogX2Rpc2Nvbm5lY3QKICAgICAqICBfUHJpdmF0ZV8gcGFydCBvZiBDb25uZWN0aW9uLmRpc2Nvbm5lY3QgZm9yIEJvc2gKICAgICAqCiAgICAgKiAgUGFyYW1ldGVyczoKICAgICAqICAgIChSZXF1ZXN0KSBwcmVzIC0gVGhpcyBzdGFuemEgd2lsbCBiZSBzZW50IGJlZm9yZSBkaXNjb25uZWN0aW5nLgogICAgICovCiAgICBfZGlzY29ubmVjdDogZnVuY3Rpb24gKHByZXMpCiAgICB7CiAgICAgICAgdGhpcy5fc2VuZFRlcm1pbmF0ZShwcmVzKTsKICAgIH0sCgogICAgLyoqIFByaXZhdGVGdW5jdGlvbjogX2RvRGlzY29ubmVjdAogICAgICogIF9Qcml2YXRlXyBmdW5jdGlvbiB0byBkaXNjb25uZWN0LgogICAgICoKICAgICAqICBSZXNldHMgdGhlIFNJRCBhbmQgUklELgogICAgICovCiAgICBfZG9EaXNjb25uZWN0OiBmdW5jdGlvbiAoKQogICAgewogICAgICAgIHRoaXMuc2lkID0gbnVsbDsKICAgICAgICB0aGlzLnJpZCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDQyOTQ5NjcyOTUpOwogICAgfSwKCiAgICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiBfZW1wdHlRdWV1ZQogICAgICogX1ByaXZhdGVfIGZ1bmN0aW9uIHRvIGNoZWNrIGlmIHRoZSBSZXF1ZXN0IHF1ZXVlIGlzIGVtcHR5LgogICAgICoKICAgICAqICBSZXR1cm5zOgogICAgICogICAgVHJ1ZSwgaWYgdGhlcmUgYXJlIG5vIFJlcXVlc3RzIHF1ZXVlZCwgRmFsc2Ugb3RoZXJ3aXNlLgogICAgICovCiAgICBfZW1wdHlRdWV1ZTogZnVuY3Rpb24gKCkKICAgIHsKICAgICAgICByZXR1cm4gdGhpcy5fcmVxdWVzdHMubGVuZ3RoID09PSAwOwogICAgfSwKCiAgICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiBfaGl0RXJyb3IKICAgICAqICBfUHJpdmF0ZV8gZnVuY3Rpb24gdG8gaGFuZGxlIHRoZSBlcnJvciBjb3VudC4KICAgICAqCiAgICAgKiAgUmVxdWVzdHMgYXJlIHJlc2VudCBhdXRvbWF0aWNhbGx5IHVudGlsIHRoZWlyIGVycm9yIGNvdW50IHJlYWNoZXMKICAgICAqICA1LiAgRWFjaCB0aW1lIGFuIGVycm9yIGlzIGVuY291bnRlcmVkLCB0aGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCB0bwogICAgICogIGluY3JlbWVudCB0aGUgY291bnQgYW5kIGRpc2Nvbm5lY3QgaWYgdGhlIGNvdW50IGlzIHRvbyBoaWdoLgogICAgICoKICAgICAqICBQYXJhbWV0ZXJzOgogICAgICogICAgKEludGVnZXIpIHJlcVN0YXR1cyAtIFRoZSByZXF1ZXN0IHN0YXR1cy4KICAgICAqLwogICAgX2hpdEVycm9yOiBmdW5jdGlvbiAocmVxU3RhdHVzKQogICAgewogICAgICAgIHRoaXMuZXJyb3JzKys7CiAgICAgICAgU3Ryb3BoZS53YXJuKCJyZXF1ZXN0IGVycm9yZWQsIHN0YXR1czogIiArIHJlcVN0YXR1cyArCiAgICAgICAgICAgICAgICAgICAgICIsIG51bWJlciBvZiBlcnJvcnM6ICIgKyB0aGlzLmVycm9ycyk7CiAgICAgICAgaWYgKHRoaXMuZXJyb3JzID4gNCkgewogICAgICAgICAgICB0aGlzLl9vbkRpc2Nvbm5lY3RUaW1lb3V0KCk7CiAgICAgICAgfQogICAgfSwKCiAgICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiBfbm9fYXV0aF9yZWNlaXZlZAogICAgICoKICAgICAqIENhbGxlZCBvbiBzdHJlYW0gc3RhcnQvcmVzdGFydCB3aGVuIG5vIHN0cmVhbTpmZWF0dXJlcwogICAgICogaGFzIGJlZW4gcmVjZWl2ZWQgYW5kIHNlbmRzIGEgYmxhbmsgcG9sbCByZXF1ZXN0LgogICAgICovCiAgICBfbm9fYXV0aF9yZWNlaXZlZDogZnVuY3Rpb24gKF9jYWxsYmFjaykKICAgIHsKICAgICAgICBpZiAoX2NhbGxiYWNrKSB7CiAgICAgICAgICAgIF9jYWxsYmFjayA9IF9jYWxsYmFjay5iaW5kKHRoaXMuX2Nvbm4pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIF9jYWxsYmFjayA9IHRoaXMuX2Nvbm4uX2Nvbm5lY3RfY2IuYmluZCh0aGlzLl9jb25uKTsKICAgICAgICB9CiAgICAgICAgdmFyIGJvZHkgPSB0aGlzLl9idWlsZEJvZHkoKTsKICAgICAgICB0aGlzLl9yZXF1ZXN0cy5wdXNoKAogICAgICAgICAgICAgICAgbmV3IFN0cm9waGUuUmVxdWVzdChib2R5LnRyZWUoKSwKICAgICAgICAgICAgICAgICAgICB0aGlzLl9vblJlcXVlc3RTdGF0ZUNoYW5nZS5iaW5kKAogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLCBfY2FsbGJhY2suYmluZCh0aGlzLl9jb25uKSksCiAgICAgICAgICAgICAgICAgICAgYm9keS50cmVlKCkuZ2V0QXR0cmlidXRlKCJyaWQiKSkpOwogICAgICAgIHRoaXMuX3Rocm90dGxlZFJlcXVlc3RIYW5kbGVyKCk7CiAgICB9LAoKICAgIC8qKiBQcml2YXRlRnVuY3Rpb246IF9vbkRpc2Nvbm5lY3RUaW1lb3V0CiAgICAgKiAgX1ByaXZhdGVfIHRpbWVvdXQgaGFuZGxlciBmb3IgaGFuZGxpbmcgbm9uLWdyYWNlZnVsIGRpc2Nvbm5lY3Rpb24uCiAgICAgKgogICAgICogIENhbmNlbHMgYWxsIHJlbWFpbmluZyBSZXF1ZXN0cyBhbmQgY2xlYXJzIHRoZSBxdWV1ZS4KICAgICAqLwogICAgX29uRGlzY29ubmVjdFRpbWVvdXQ6IGZ1bmN0aW9uICgpCiAgICB7CiAgICAgICAgdmFyIHJlcTsKICAgICAgICB3aGlsZSAodGhpcy5fcmVxdWVzdHMubGVuZ3RoID4gMCkgewogICAgICAgICAgICByZXEgPSB0aGlzLl9yZXF1ZXN0cy5wb3AoKTsKICAgICAgICAgICAgcmVxLmFib3J0ID0gdHJ1ZTsKICAgICAgICAgICAgcmVxLnhoci5hYm9ydCgpOwogICAgICAgICAgICAvLyBqc2xpbnQgY29tcGxhaW5zLCBidXQgdGhpcyBpcyBmaW5lLiBzZXR0aW5nIHRvIGVtcHR5IGZ1bmMKICAgICAgICAgICAgLy8gaXMgbmVjZXNzYXJ5IGZvciBJRTYKICAgICAgICAgICAgcmVxLnhoci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbiAoKSB7fTsgLy8ganNoaW50IGlnbm9yZTpsaW5lCiAgICAgICAgfQogICAgfSwKCiAgICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiBfb25JZGxlCiAgICAgKiAgX1ByaXZhdGVfIGhhbmRsZXIgY2FsbGVkIGJ5IFN0cm9waGUuQ29ubmVjdGlvbi5fb25JZGxlCiAgICAgKgogICAgICogIFNlbmRzIGFsbCBxdWV1ZWQgUmVxdWVzdHMgb3IgcG9sbHMgd2l0aCBlbXB0eSBSZXF1ZXN0IGlmIHRoZXJlIGFyZSBub25lLgogICAgICovCiAgICBfb25JZGxlOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGRhdGEgPSB0aGlzLl9jb25uLl9kYXRhOwoKICAgICAgICAvLyBpZiBubyByZXF1ZXN0cyBhcmUgaW4gcHJvZ3Jlc3MsIHBvbGwKICAgICAgICBpZiAodGhpcy5fY29ubi5hdXRoZW50aWNhdGVkICYmIHRoaXMuX3JlcXVlc3RzLmxlbmd0aCA9PT0gMCAmJgogICAgICAgICAgICBkYXRhLmxlbmd0aCA9PT0gMCAmJiAhdGhpcy5fY29ubi5kaXNjb25uZWN0aW5nKSB7CiAgICAgICAgICAgIFN0cm9waGUuaW5mbygibm8gcmVxdWVzdHMgZHVyaW5nIGlkbGUgY3ljbGUsIHNlbmRpbmcgIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAiYmxhbmsgcmVxdWVzdCIpOwogICAgICAgICAgICBkYXRhLnB1c2gobnVsbCk7CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5fcmVxdWVzdHMubGVuZ3RoIDwgMiAmJiBkYXRhLmxlbmd0aCA+IDAgJiYKICAgICAgICAgICAgIXRoaXMuX2Nvbm4ucGF1c2VkKSB7CiAgICAgICAgICAgIHZhciBib2R5ID0gdGhpcy5fYnVpbGRCb2R5KCk7CiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKGRhdGFbaV0gIT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YVtpXSA9PT0gInJlc3RhcnQiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGJvZHkuYXR0cnMoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG86IHRoaXMuX2Nvbm4uZG9tYWluLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgInhtbDpsYW5nIjogImVuIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ4bXBwOnJlc3RhcnQiOiAidHJ1ZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAieG1sbnM6eG1wcCI6IFN0cm9waGUuTlMuQk9TSAogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBib2R5LmNub2RlKGRhdGFbaV0pLnVwKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLl9jb25uLl9kYXRhOwogICAgICAgICAgICB0aGlzLl9jb25uLl9kYXRhID0gW107CiAgICAgICAgICAgIHRoaXMuX3JlcXVlc3RzLnB1c2goCiAgICAgICAgICAgICAgICBuZXcgU3Ryb3BoZS5SZXF1ZXN0KGJvZHkudHJlZSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9vblJlcXVlc3RTdGF0ZUNoYW5nZS5iaW5kKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcywgdGhpcy5fY29ubi5fZGF0YVJlY3YuYmluZCh0aGlzLl9jb25uKSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvZHkudHJlZSgpLmdldEF0dHJpYnV0ZSgicmlkIikpKTsKICAgICAgICAgICAgdGhpcy5fcHJvY2Vzc1JlcXVlc3QodGhpcy5fcmVxdWVzdHMubGVuZ3RoIC0gMSk7CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5fcmVxdWVzdHMubGVuZ3RoID4gMCkgewogICAgICAgICAgICB2YXIgdGltZV9lbGFwc2VkID0gdGhpcy5fcmVxdWVzdHNbMF0uYWdlKCk7CiAgICAgICAgICAgIGlmICh0aGlzLl9yZXF1ZXN0c1swXS5kZWFkICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fcmVxdWVzdHNbMF0udGltZURlYWQoKSA+CiAgICAgICAgICAgICAgICAgICAgTWF0aC5mbG9vcihTdHJvcGhlLlNFQ09OREFSWV9USU1FT1VUICogdGhpcy53YWl0KSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX3Rocm90dGxlZFJlcXVlc3RIYW5kbGVyKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh0aW1lX2VsYXBzZWQgPiBNYXRoLmZsb29yKFN0cm9waGUuVElNRU9VVCAqIHRoaXMud2FpdCkpIHsKICAgICAgICAgICAgICAgIFN0cm9waGUud2FybigiUmVxdWVzdCAiICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZXF1ZXN0c1swXS5pZCArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIiB0aW1lZCBvdXQsIG92ZXIgIiArIE1hdGguZmxvb3IoU3Ryb3BoZS5USU1FT1VUICogdGhpcy53YWl0KSArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIiBzZWNvbmRzIHNpbmNlIGxhc3QgYWN0aXZpdHkiKTsKICAgICAgICAgICAgICAgIHRoaXMuX3Rocm90dGxlZFJlcXVlc3RIYW5kbGVyKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9LAoKICAgIC8qKiBQcml2YXRlRnVuY3Rpb246IF9vblJlcXVlc3RTdGF0ZUNoYW5nZQogICAgICogIF9Qcml2YXRlXyBoYW5kbGVyIGZvciBTdHJvcGhlLlJlcXVlc3Qgc3RhdGUgY2hhbmdlcy4KICAgICAqCiAgICAgKiAgVGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgd2hlbiB0aGUgWE1MSHR0cFJlcXVlc3QgcmVhZHlTdGF0ZSBjaGFuZ2VzLgogICAgICogIEl0IGNvbnRhaW5zIGEgbG90IG9mIGVycm9yIGhhbmRsaW5nIGxvZ2ljIGZvciB0aGUgbWFueSB3YXlzIHRoYXQKICAgICAqICByZXF1ZXN0cyBjYW4gZmFpbCwgYW5kIGNhbGxzIHRoZSByZXF1ZXN0IGNhbGxiYWNrIHdoZW4gcmVxdWVzdHMKICAgICAqICBzdWNjZWVkLgogICAgICoKICAgICAqICBQYXJhbWV0ZXJzOgogICAgICogICAgKEZ1bmN0aW9uKSBmdW5jIC0gVGhlIGhhbmRsZXIgZm9yIHRoZSByZXF1ZXN0LgogICAgICogICAgKFN0cm9waGUuUmVxdWVzdCkgcmVxIC0gVGhlIHJlcXVlc3QgdGhhdCBpcyBjaGFuZ2luZyByZWFkeVN0YXRlLgogICAgICovCiAgICBfb25SZXF1ZXN0U3RhdGVDaGFuZ2U6IGZ1bmN0aW9uIChmdW5jLCByZXEpCiAgICB7CiAgICAgICAgU3Ryb3BoZS5kZWJ1ZygicmVxdWVzdCBpZCAiICsgcmVxLmlkICsKICAgICAgICAgICAgICAgICAgICAgICIuIiArIHJlcS5zZW5kcyArICIgc3RhdGUgY2hhbmdlZCB0byAiICsKICAgICAgICAgICAgICAgICAgICAgIHJlcS54aHIucmVhZHlTdGF0ZSk7CgogICAgICAgIGlmIChyZXEuYWJvcnQpIHsKICAgICAgICAgICAgcmVxLmFib3J0ID0gZmFsc2U7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIHJlcXVlc3QgY29tcGxldGUKICAgICAgICB2YXIgcmVxU3RhdHVzOwogICAgICAgIGlmIChyZXEueGhyLnJlYWR5U3RhdGUgPT0gNCkgewogICAgICAgICAgICByZXFTdGF0dXMgPSAwOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgcmVxU3RhdHVzID0gcmVxLnhoci5zdGF0dXM7CiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgIC8vIGlnbm9yZSBlcnJvcnMgZnJvbSB1bmRlZmluZWQgc3RhdHVzIGF0dHJpYnV0ZS4gIHdvcmtzCiAgICAgICAgICAgICAgICAvLyBhcm91bmQgYSBicm93c2VyIGJ1ZwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodHlwZW9mKHJlcVN0YXR1cykgPT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgICAgIHJlcVN0YXR1cyA9IDA7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh0aGlzLmRpc2Nvbm5lY3RpbmcpIHsKICAgICAgICAgICAgICAgIGlmIChyZXFTdGF0dXMgPj0gNDAwKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5faGl0RXJyb3IocmVxU3RhdHVzKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciByZXFJczAgPSAodGhpcy5fcmVxdWVzdHNbMF0gPT0gcmVxKTsKICAgICAgICAgICAgdmFyIHJlcUlzMSA9ICh0aGlzLl9yZXF1ZXN0c1sxXSA9PSByZXEpOwoKICAgICAgICAgICAgaWYgKChyZXFTdGF0dXMgPiAwICYmIHJlcVN0YXR1cyA8IDUwMCkgfHwgcmVxLnNlbmRzID4gNSkgewogICAgICAgICAgICAgICAgLy8gcmVtb3ZlIGZyb20gaW50ZXJuYWwgcXVldWUKICAgICAgICAgICAgICAgIHRoaXMuX3JlbW92ZVJlcXVlc3QocmVxKTsKICAgICAgICAgICAgICAgIFN0cm9waGUuZGVidWcoInJlcXVlc3QgaWQgIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5pZCArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICIgc2hvdWxkIG5vdyBiZSByZW1vdmVkIik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIHJlcXVlc3Qgc3VjY2VlZGVkCiAgICAgICAgICAgIGlmIChyZXFTdGF0dXMgPT0gMjAwKSB7CiAgICAgICAgICAgICAgICAvLyBpZiByZXF1ZXN0IDEgZmluaXNoZWQsIG9yIHJlcXVlc3QgMCBmaW5pc2hlZCBhbmQgcmVxdWVzdAogICAgICAgICAgICAgICAgLy8gMSBpcyBvdmVyIFN0cm9waGUuU0VDT05EQVJZX1RJTUVPVVQgc2Vjb25kcyBvbGQsIHdlIG5lZWQgdG8KICAgICAgICAgICAgICAgIC8vIHJlc3RhcnQgdGhlIG90aGVyIC0gYm90aCB3aWxsIGJlIGluIHRoZSBmaXJzdCBzcG90LCBhcyB0aGUKICAgICAgICAgICAgICAgIC8vIGNvbXBsZXRlZCByZXF1ZXN0IGhhcyBiZWVuIHJlbW92ZWQgZnJvbSB0aGUgcXVldWUgYWxyZWFkeQogICAgICAgICAgICAgICAgaWYgKHJlcUlzMSB8fAogICAgICAgICAgICAgICAgICAgIChyZXFJczAgJiYgdGhpcy5fcmVxdWVzdHMubGVuZ3RoID4gMCAmJgogICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZXF1ZXN0c1swXS5hZ2UoKSA+IE1hdGguZmxvb3IoU3Ryb3BoZS5TRUNPTkRBUllfVElNRU9VVCAqIHRoaXMud2FpdCkpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVzdGFydFJlcXVlc3QoMCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBjYWxsIGhhbmRsZXIKICAgICAgICAgICAgICAgIFN0cm9waGUuZGVidWcoInJlcXVlc3QgaWQgIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5pZCArICIuIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5zZW5kcyArICIgZ290IDIwMCIpOwogICAgICAgICAgICAgICAgZnVuYyhyZXEpOwogICAgICAgICAgICAgICAgdGhpcy5lcnJvcnMgPSAwOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgU3Ryb3BoZS5lcnJvcigicmVxdWVzdCBpZCAiICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLmlkICsgIi4iICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLnNlbmRzICsgIiBlcnJvciAiICsgcmVxU3RhdHVzICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIiBoYXBwZW5lZCIpOwogICAgICAgICAgICAgICAgaWYgKHJlcVN0YXR1cyA9PT0gMCB8fAogICAgICAgICAgICAgICAgICAgIChyZXFTdGF0dXMgPj0gNDAwICYmIHJlcVN0YXR1cyA8IDYwMCkgfHwKICAgICAgICAgICAgICAgICAgICByZXFTdGF0dXMgPj0gMTIwMDApIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9oaXRFcnJvcihyZXFTdGF0dXMpOwogICAgICAgICAgICAgICAgICAgIGlmIChyZXFTdGF0dXMgPj0gNDAwICYmIHJlcVN0YXR1cyA8IDUwMCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9jb25uLl9jaGFuZ2VDb25uZWN0U3RhdHVzKFN0cm9waGUuU3RhdHVzLkRJU0NPTk5FQ1RJTkcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2Nvbm4uX2RvRGlzY29ubmVjdCgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCEoKHJlcVN0YXR1cyA+IDAgJiYgcmVxU3RhdHVzIDwgNTAwKSB8fAogICAgICAgICAgICAgICAgICByZXEuc2VuZHMgPiA1KSkgewogICAgICAgICAgICAgICAgdGhpcy5fdGhyb3R0bGVkUmVxdWVzdEhhbmRsZXIoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0sCgogICAgLyoqIFByaXZhdGVGdW5jdGlvbjogX3Byb2Nlc3NSZXF1ZXN0CiAgICAgKiAgX1ByaXZhdGVfIGZ1bmN0aW9uIHRvIHByb2Nlc3MgYSByZXF1ZXN0IGluIHRoZSBxdWV1ZS4KICAgICAqCiAgICAgKiAgVGhpcyBmdW5jdGlvbiB0YWtlcyByZXF1ZXN0cyBvZmYgdGhlIHF1ZXVlIGFuZCBzZW5kcyB0aGVtIGFuZAogICAgICogIHJlc3RhcnRzIGRlYWQgcmVxdWVzdHMuCiAgICAgKgogICAgICogIFBhcmFtZXRlcnM6CiAgICAgKiAgICAoSW50ZWdlcikgaSAtIFRoZSBpbmRleCBvZiB0aGUgcmVxdWVzdCBpbiB0aGUgcXVldWUuCiAgICAgKi8KICAgIF9wcm9jZXNzUmVxdWVzdDogZnVuY3Rpb24gKGkpCiAgICB7CiAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgIHZhciByZXEgPSB0aGlzLl9yZXF1ZXN0c1tpXTsKICAgICAgICB2YXIgcmVxU3RhdHVzID0gLTE7CgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChyZXEueGhyLnJlYWR5U3RhdGUgPT0gNCkgewogICAgICAgICAgICAgICAgcmVxU3RhdHVzID0gcmVxLnhoci5zdGF0dXM7CiAgICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIFN0cm9waGUuZXJyb3IoImNhdWdodCBhbiBlcnJvciBpbiBfcmVxdWVzdHNbIiArIGkgKwogICAgICAgICAgICAgICAgICAgICAgICAgICJdLCByZXFTdGF0dXM6ICIgKyByZXFTdGF0dXMpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHR5cGVvZihyZXFTdGF0dXMpID09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgIHJlcVN0YXR1cyA9IC0xOwogICAgICAgIH0KCiAgICAgICAgLy8gbWFrZSBzdXJlIHdlIGxpbWl0IHRoZSBudW1iZXIgb2YgcmV0cmllcwogICAgICAgIGlmIChyZXEuc2VuZHMgPiB0aGlzLm1heFJldHJpZXMpIHsKICAgICAgICAgICAgdGhpcy5fb25EaXNjb25uZWN0VGltZW91dCgpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2YXIgdGltZV9lbGFwc2VkID0gcmVxLmFnZSgpOwogICAgICAgIHZhciBwcmltYXJ5VGltZW91dCA9ICghaXNOYU4odGltZV9lbGFwc2VkKSAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lX2VsYXBzZWQgPiBNYXRoLmZsb29yKFN0cm9waGUuVElNRU9VVCAqIHRoaXMud2FpdCkpOwogICAgICAgIHZhciBzZWNvbmRhcnlUaW1lb3V0ID0gKHJlcS5kZWFkICE9PSBudWxsICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLnRpbWVEZWFkKCkgPiBNYXRoLmZsb29yKFN0cm9waGUuU0VDT05EQVJZX1RJTUVPVVQgKiB0aGlzLndhaXQpKTsKICAgICAgICB2YXIgcmVxdWVzdENvbXBsZXRlZFdpdGhTZXJ2ZXJFcnJvciA9IChyZXEueGhyLnJlYWR5U3RhdGUgPT0gNCAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChyZXFTdGF0dXMgPCAxIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcVN0YXR1cyA+PSA1MDApKTsKICAgICAgICBpZiAocHJpbWFyeVRpbWVvdXQgfHwgc2Vjb25kYXJ5VGltZW91dCB8fAogICAgICAgICAgICByZXF1ZXN0Q29tcGxldGVkV2l0aFNlcnZlckVycm9yKSB7CiAgICAgICAgICAgIGlmIChzZWNvbmRhcnlUaW1lb3V0KSB7CiAgICAgICAgICAgICAgICBTdHJvcGhlLmVycm9yKCJSZXF1ZXN0ICIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZXF1ZXN0c1tpXS5pZCArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICIgdGltZWQgb3V0IChzZWNvbmRhcnkpLCByZXN0YXJ0aW5nIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmVxLmFib3J0ID0gdHJ1ZTsKICAgICAgICAgICAgcmVxLnhoci5hYm9ydCgpOwogICAgICAgICAgICAvLyBzZXR0aW5nIHRvIG51bGwgZmFpbHMgb24gSUU2LCBzbyBzZXQgdG8gZW1wdHkgZnVuY3Rpb24KICAgICAgICAgICAgcmVxLnhoci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbiAoKSB7fTsKICAgICAgICAgICAgdGhpcy5fcmVxdWVzdHNbaV0gPSBuZXcgU3Ryb3BoZS5SZXF1ZXN0KHJlcS54bWxEYXRhLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLm9yaWdGdW5jLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLnJpZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5zZW5kcyk7CiAgICAgICAgICAgIHJlcSA9IHRoaXMuX3JlcXVlc3RzW2ldOwogICAgICAgIH0KCiAgICAgICAgaWYgKHJlcS54aHIucmVhZHlTdGF0ZSA9PT0gMCkgewogICAgICAgICAgICBTdHJvcGhlLmRlYnVnKCJyZXF1ZXN0IGlkICIgKyByZXEuaWQgKwogICAgICAgICAgICAgICAgICAgICAgICAgICIuIiArIHJlcS5zZW5kcyArICIgcG9zdGluZyIpOwoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHJlcS54aHIub3BlbigiUE9TVCIsIHRoaXMuX2Nvbm4uc2VydmljZSwgdGhpcy5fY29ubi5vcHRpb25zLnN5bmMgPyBmYWxzZSA6IHRydWUpOwogICAgICAgICAgICB9IGNhdGNoIChlMikgewogICAgICAgICAgICAgICAgU3Ryb3BoZS5lcnJvcigiWEhSIG9wZW4gZmFpbGVkLiIpOwogICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9jb25uLmNvbm5lY3RlZCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX2Nvbm4uX2NoYW5nZUNvbm5lY3RTdGF0dXMoU3Ryb3BoZS5TdGF0dXMuQ09OTkZBSUwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiYmFkLXNlcnZpY2UiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuX2Nvbm4uZGlzY29ubmVjdCgpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBGaXJlcyB0aGUgWEhSIHJlcXVlc3QgLS0gbWF5IGJlIGludm9rZWQgaW1tZWRpYXRlbHkKICAgICAgICAgICAgLy8gb3Igb24gYSBncmFkdWFsbHkgZXhwYW5kaW5nIHJldHJ5IHdpbmRvdyBmb3IgcmVjb25uZWN0cwogICAgICAgICAgICB2YXIgc2VuZEZ1bmMgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXEuZGF0ZSA9IG5ldyBEYXRlKCk7CiAgICAgICAgICAgICAgICBpZiAoc2VsZi5fY29ubi5vcHRpb25zLmN1c3RvbUhlYWRlcnMpewogICAgICAgICAgICAgICAgICAgIHZhciBoZWFkZXJzID0gc2VsZi5fY29ubi5vcHRpb25zLmN1c3RvbUhlYWRlcnM7CiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaGVhZGVyIGluIGhlYWRlcnMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGhlYWRlcnMuaGFzT3duUHJvcGVydHkoaGVhZGVyKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLnhoci5zZXRSZXF1ZXN0SGVhZGVyKGhlYWRlciwgaGVhZGVyc1toZWFkZXJdKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJlcS54aHIuc2VuZChyZXEuZGF0YSk7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICAvLyBJbXBsZW1lbnQgcHJvZ3Jlc3NpdmUgYmFja29mZiBmb3IgcmVjb25uZWN0cyAtLQogICAgICAgICAgICAvLyBGaXJzdCByZXRyeSAoc2VuZCA9PSAxKSBzaG91bGQgYWxzbyBiZSBpbnN0YW50YW5lb3VzCiAgICAgICAgICAgIGlmIChyZXEuc2VuZHMgPiAxKSB7CiAgICAgICAgICAgICAgICAvLyBVc2luZyBhIGN1YmUgb2YgdGhlIHJldHJ5IG51bWJlciBjcmVhdGVzIGEgbmljZWx5CiAgICAgICAgICAgICAgICAvLyBleHBhbmRpbmcgcmV0cnkgd2luZG93CiAgICAgICAgICAgICAgICB2YXIgYmFja29mZiA9IE1hdGgubWluKE1hdGguZmxvb3IoU3Ryb3BoZS5USU1FT1VUICogdGhpcy53YWl0KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTWF0aC5wb3cocmVxLnNlbmRzLCAzKSkgKiAxMDAwOwogICAgICAgICAgICAgICAgc2V0VGltZW91dChzZW5kRnVuYywgYmFja29mZik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBzZW5kRnVuYygpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXEuc2VuZHMrKzsKCiAgICAgICAgICAgIGlmICh0aGlzLl9jb25uLnhtbE91dHB1dCAhPT0gU3Ryb3BoZS5Db25uZWN0aW9uLnByb3RvdHlwZS54bWxPdXRwdXQpIHsKICAgICAgICAgICAgICAgIGlmIChyZXEueG1sRGF0YS5ub2RlTmFtZSA9PT0gdGhpcy5zdHJpcCAmJiByZXEueG1sRGF0YS5jaGlsZE5vZGVzLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX2Nvbm4ueG1sT3V0cHV0KHJlcS54bWxEYXRhLmNoaWxkTm9kZXNbMF0pOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9jb25uLnhtbE91dHB1dChyZXEueG1sRGF0YSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHRoaXMuX2Nvbm4ucmF3T3V0cHV0ICE9PSBTdHJvcGhlLkNvbm5lY3Rpb24ucHJvdG90eXBlLnJhd091dHB1dCkgewogICAgICAgICAgICAgICAgdGhpcy5fY29ubi5yYXdPdXRwdXQocmVxLmRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgU3Ryb3BoZS5kZWJ1ZygiX3Byb2Nlc3NSZXF1ZXN0OiAiICsKICAgICAgICAgICAgICAgICAgICAgICAgICAoaSA9PT0gMCA/ICJmaXJzdCIgOiAic2Vjb25kIikgKwogICAgICAgICAgICAgICAgICAgICAgICAgICIgcmVxdWVzdCBoYXMgcmVhZHlTdGF0ZSBvZiAiICsKICAgICAgICAgICAgICAgICAgICAgICAgICByZXEueGhyLnJlYWR5U3RhdGUpOwogICAgICAgIH0KICAgIH0sCgogICAgLyoqIFByaXZhdGVGdW5jdGlvbjogX3JlbW92ZVJlcXVlc3QKICAgICAqICBfUHJpdmF0ZV8gZnVuY3Rpb24gdG8gcmVtb3ZlIGEgcmVxdWVzdCBmcm9tIHRoZSBxdWV1ZS4KICAgICAqCiAgICAgKiAgUGFyYW1ldGVyczoKICAgICAqICAgIChTdHJvcGhlLlJlcXVlc3QpIHJlcSAtIFRoZSByZXF1ZXN0IHRvIHJlbW92ZS4KICAgICAqLwogICAgX3JlbW92ZVJlcXVlc3Q6IGZ1bmN0aW9uIChyZXEpCiAgICB7CiAgICAgICAgU3Ryb3BoZS5kZWJ1ZygicmVtb3ZpbmcgcmVxdWVzdCIpOwoKICAgICAgICB2YXIgaTsKICAgICAgICBmb3IgKGkgPSB0aGlzLl9yZXF1ZXN0cy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICAgICAgICBpZiAocmVxID09IHRoaXMuX3JlcXVlc3RzW2ldKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9yZXF1ZXN0cy5zcGxpY2UoaSwgMSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIElFNiBmYWlscyBvbiBzZXR0aW5nIHRvIG51bGwsIHNvIHNldCB0byBlbXB0eSBmdW5jdGlvbgogICAgICAgIHJlcS54aHIub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24gKCkge307CgogICAgICAgIHRoaXMuX3Rocm90dGxlZFJlcXVlc3RIYW5kbGVyKCk7CiAgICB9LAoKICAgIC8qKiBQcml2YXRlRnVuY3Rpb246IF9yZXN0YXJ0UmVxdWVzdAogICAgICogIF9Qcml2YXRlXyBmdW5jdGlvbiB0byByZXN0YXJ0IGEgcmVxdWVzdCB0aGF0IGlzIHByZXN1bWVkIGRlYWQuCiAgICAgKgogICAgICogIFBhcmFtZXRlcnM6CiAgICAgKiAgICAoSW50ZWdlcikgaSAtIFRoZSBpbmRleCBvZiB0aGUgcmVxdWVzdCBpbiB0aGUgcXVldWUuCiAgICAgKi8KICAgIF9yZXN0YXJ0UmVxdWVzdDogZnVuY3Rpb24gKGkpCiAgICB7CiAgICAgICAgdmFyIHJlcSA9IHRoaXMuX3JlcXVlc3RzW2ldOwogICAgICAgIGlmIChyZXEuZGVhZCA9PT0gbnVsbCkgewogICAgICAgICAgICByZXEuZGVhZCA9IG5ldyBEYXRlKCk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLl9wcm9jZXNzUmVxdWVzdChpKTsKICAgIH0sCgogICAgLyoqIFByaXZhdGVGdW5jdGlvbjogX3JlcVRvRGF0YQogICAgICogX1ByaXZhdGVfIGZ1bmN0aW9uIHRvIGdldCBhIHN0YW56YSBvdXQgb2YgYSByZXF1ZXN0LgogICAgICoKICAgICAqIFRyaWVzIHRvIGV4dHJhY3QgYSBzdGFuemEgb3V0IG9mIGEgUmVxdWVzdCBPYmplY3QuCiAgICAgKiBXaGVuIHRoaXMgZmFpbHMgdGhlIGN1cnJlbnQgY29ubmVjdGlvbiB3aWxsIGJlIGRpc2Nvbm5lY3RlZC4KICAgICAqCiAgICAgKiAgUGFyYW1ldGVyczoKICAgICAqICAgIChPYmplY3QpIHJlcSAtIFRoZSBSZXF1ZXN0LgogICAgICoKICAgICAqICBSZXR1cm5zOgogICAgICogICAgVGhlIHN0YW56YSB0aGF0IHdhcyBwYXNzZWQuCiAgICAgKi8KICAgIF9yZXFUb0RhdGE6IGZ1bmN0aW9uIChyZXEpCiAgICB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIHJlcS5nZXRSZXNwb25zZSgpOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgaWYgKGUgIT0gInBhcnNlcmVycm9yIikgeyB0aHJvdyBlOyB9CiAgICAgICAgICAgIHRoaXMuX2Nvbm4uZGlzY29ubmVjdCgic3Ryb3BoZS1wYXJzZXJlcnJvciIpOwogICAgICAgIH0KICAgIH0sCgogICAgLyoqIFByaXZhdGVGdW5jdGlvbjogX3NlbmRUZXJtaW5hdGUKICAgICAqICBfUHJpdmF0ZV8gZnVuY3Rpb24gdG8gc2VuZCBpbml0aWFsIGRpc2Nvbm5lY3Qgc2VxdWVuY2UuCiAgICAgKgogICAgICogIFRoaXMgaXMgdGhlIGZpcnN0IHN0ZXAgaW4gYSBncmFjZWZ1bCBkaXNjb25uZWN0LiAgSXQgc2VuZHMKICAgICAqICB0aGUgQk9TSCBzZXJ2ZXIgYSB0ZXJtaW5hdGUgYm9keSBhbmQgaW5jbHVkZXMgYW4gdW5hdmFpbGFibGUKICAgICAqICBwcmVzZW5jZSBpZiBhdXRoZW50aWNhdGlvbiBoYXMgY29tcGxldGVkLgogICAgICovCiAgICBfc2VuZFRlcm1pbmF0ZTogZnVuY3Rpb24gKHByZXMpCiAgICB7CiAgICAgICAgU3Ryb3BoZS5pbmZvKCJfc2VuZFRlcm1pbmF0ZSB3YXMgY2FsbGVkIik7CiAgICAgICAgdmFyIGJvZHkgPSB0aGlzLl9idWlsZEJvZHkoKS5hdHRycyh7dHlwZTogInRlcm1pbmF0ZSJ9KTsKCiAgICAgICAgaWYgKHByZXMpIHsKICAgICAgICAgICAgYm9keS5jbm9kZShwcmVzLnRyZWUoKSk7CiAgICAgICAgfQoKICAgICAgICB2YXIgcmVxID0gbmV3IFN0cm9waGUuUmVxdWVzdChib2R5LnRyZWUoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9vblJlcXVlc3RTdGF0ZUNoYW5nZS5iaW5kKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLCB0aGlzLl9jb25uLl9kYXRhUmVjdi5iaW5kKHRoaXMuX2Nvbm4pKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib2R5LnRyZWUoKS5nZXRBdHRyaWJ1dGUoInJpZCIpKTsKCiAgICAgICAgdGhpcy5fcmVxdWVzdHMucHVzaChyZXEpOwogICAgICAgIHRoaXMuX3Rocm90dGxlZFJlcXVlc3RIYW5kbGVyKCk7CiAgICB9LAoKICAgIC8qKiBQcml2YXRlRnVuY3Rpb246IF9zZW5kCiAgICAgKiAgX1ByaXZhdGVfIHBhcnQgb2YgdGhlIENvbm5lY3Rpb24uc2VuZCBmdW5jdGlvbiBmb3IgQk9TSAogICAgICoKICAgICAqIEp1c3QgdHJpZ2dlcnMgdGhlIFJlcXVlc3RIYW5kbGVyIHRvIHNlbmQgdGhlIG1lc3NhZ2VzIHRoYXQgYXJlIGluIHRoZSBxdWV1ZQogICAgICovCiAgICBfc2VuZDogZnVuY3Rpb24gKCkgewogICAgICAgIGNsZWFyVGltZW91dCh0aGlzLl9jb25uLl9pZGxlVGltZW91dCk7CiAgICAgICAgdGhpcy5fdGhyb3R0bGVkUmVxdWVzdEhhbmRsZXIoKTsKICAgICAgICB0aGlzLl9jb25uLl9pZGxlVGltZW91dCA9IHNldFRpbWVvdXQodGhpcy5fY29ubi5fb25JZGxlLmJpbmQodGhpcy5fY29ubiksIDEwMCk7CiAgICB9LAoKICAgIC8qKiBQcml2YXRlRnVuY3Rpb246IF9zZW5kUmVzdGFydAogICAgICoKICAgICAqICBTZW5kIGFuIHhtcHA6cmVzdGFydCBzdGFuemEuCiAgICAgKi8KICAgIF9zZW5kUmVzdGFydDogZnVuY3Rpb24gKCkKICAgIHsKICAgICAgICB0aGlzLl90aHJvdHRsZWRSZXF1ZXN0SGFuZGxlcigpOwogICAgICAgIGNsZWFyVGltZW91dCh0aGlzLl9jb25uLl9pZGxlVGltZW91dCk7CiAgICB9LAoKICAgIC8qKiBQcml2YXRlRnVuY3Rpb246IF90aHJvdHRsZWRSZXF1ZXN0SGFuZGxlcgogICAgICogIF9Qcml2YXRlXyBmdW5jdGlvbiB0byB0aHJvdHRsZSByZXF1ZXN0cyB0byB0aGUgY29ubmVjdGlvbiB3aW5kb3cuCiAgICAgKgogICAgICogIFRoaXMgZnVuY3Rpb24gbWFrZXMgc3VyZSB3ZSBkb24ndCBzZW5kIHJlcXVlc3RzIHNvIGZhc3QgdGhhdCB0aGUKICAgICAqICByZXF1ZXN0IGlkcyBvdmVyZmxvdyB0aGUgY29ubmVjdGlvbiB3aW5kb3cgaW4gdGhlIGNhc2UgdGhhdCBvbmUKICAgICAqICByZXF1ZXN0IGRpZWQuCiAgICAgKi8KICAgIF90aHJvdHRsZWRSZXF1ZXN0SGFuZGxlcjogZnVuY3Rpb24gKCkKICAgIHsKICAgICAgICBpZiAoIXRoaXMuX3JlcXVlc3RzKSB7CiAgICAgICAgICAgIFN0cm9waGUuZGVidWcoIl90aHJvdHRsZWRSZXF1ZXN0SGFuZGxlciBjYWxsZWQgd2l0aCAiICsKICAgICAgICAgICAgICAgICAgICAgICAgICAidW5kZWZpbmVkIHJlcXVlc3RzIik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgU3Ryb3BoZS5kZWJ1ZygiX3Rocm90dGxlZFJlcXVlc3RIYW5kbGVyIGNhbGxlZCB3aXRoICIgKwogICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlcXVlc3RzLmxlbmd0aCArICIgcmVxdWVzdHMiKTsKICAgICAgICB9CgogICAgICAgIGlmICghdGhpcy5fcmVxdWVzdHMgfHwgdGhpcy5fcmVxdWVzdHMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmICh0aGlzLl9yZXF1ZXN0cy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHRoaXMuX3Byb2Nlc3NSZXF1ZXN0KDApOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRoaXMuX3JlcXVlc3RzLmxlbmd0aCA+IDEgJiYKICAgICAgICAgICAgTWF0aC5hYnModGhpcy5fcmVxdWVzdHNbMF0ucmlkIC0KICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVxdWVzdHNbMV0ucmlkKSA8IHRoaXMud2luZG93KSB7CiAgICAgICAgICAgIHRoaXMuX3Byb2Nlc3NSZXF1ZXN0KDEpOwogICAgICAgIH0KICAgIH0KfTsKCi8qCiAgICBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBNSVQgbGljZW5zZS4KICAgIFBsZWFzZSBzZWUgdGhlIExJQ0VOU0UgZmlsZSBmb3IgZGV0YWlscy4KCiAgICBDb3B5cmlnaHQgMjAwNi0yMDA4LCBPR0csIExMQwoqLwoKLyoganNoaW50IHVuZGVmOiB0cnVlLCB1bnVzZWQ6IHRydWU6LCBub2FyZzogdHJ1ZSwgbGF0ZWRlZjogdHJ1ZSAqLwovKmdsb2JhbCBkb2N1bWVudCwgd2luZG93LCBjbGVhclRpbWVvdXQsIFdlYlNvY2tldCwKICAgIERPTVBhcnNlciwgU3Ryb3BoZSwgJGJ1aWxkICovCgovKiogQ2xhc3M6IFN0cm9waGUuV2ViU29ja2V0CiAqICBfUHJpdmF0ZV8gaGVscGVyIGNsYXNzIHRoYXQgaGFuZGxlcyBXZWJTb2NrZXQgQ29ubmVjdGlvbnMKICoKICogIFRoZSBTdHJvcGhlLldlYlNvY2tldCBjbGFzcyBpcyB1c2VkIGludGVybmFsbHkgYnkgU3Ryb3BoZS5Db25uZWN0aW9uCiAqICB0byBlbmNhcHN1bGF0ZSBXZWJTb2NrZXQgc2Vzc2lvbnMuIEl0IGlzIG5vdCBtZWFudCB0byBiZSB1c2VkIGZyb20gdXNlcidzIGNvZGUuCiAqLwoKLyoqIEZpbGU6IHdlYnNvY2tldC5qcwogKiAgQSBKYXZhU2NyaXB0IGxpYnJhcnkgdG8gZW5hYmxlIFhNUFAgb3ZlciBXZWJzb2NrZXQgaW4gU3Ryb3BoZWpzLgogKgogKiAgVGhpcyBmaWxlIGltcGxlbWVudHMgWE1QUCBvdmVyIFdlYlNvY2tldHMgZm9yIFN0cm9waGVqcy4KICogIElmIGEgQ29ubmVjdGlvbiBpcyBlc3RhYmxpc2hlZCB3aXRoIGEgV2Vic29ja2V0IHVybCAod3M6Ly8uLi4pCiAqICBTdHJvcGhlIHdpbGwgdXNlIFdlYlNvY2tldHMuCiAqICBGb3IgbW9yZSBpbmZvcm1hdGlvbiBvbiBYTVBQLW92ZXIgV2ViU29ja2V0IHNlZSB0aGlzIFJGQyBkcmFmdDoKICogIGh0dHA6Ly90b29scy5pZXRmLm9yZy9odG1sL2RyYWZ0LWlldGYteG1wcC13ZWJzb2NrZXQtMDAKICoKICogIFdlYlNvY2tldCBzdXBwb3J0IGltcGxlbWVudGVkIGJ5IEFuZHJlYXMgR3V0aCAoYW5kcmVhcy5ndXRoQHJ3dGgtYWFjaGVuLmRlKQogKi8KCi8qKiBQcml2YXRlQ29uc3RydWN0b3I6IFN0cm9waGUuV2Vic29ja2V0CiAqICBDcmVhdGUgYW5kIGluaXRpYWxpemUgYSBTdHJvcGhlLldlYlNvY2tldCBvYmplY3QuCiAqICBDdXJyZW50bHkgb25seSBzZXRzIHRoZSBjb25uZWN0aW9uIE9iamVjdC4KICoKICogIFBhcmFtZXRlcnM6CiAqICAgIChTdHJvcGhlLkNvbm5lY3Rpb24pIGNvbm5lY3Rpb24gLSBUaGUgU3Ryb3BoZS5Db25uZWN0aW9uIHRoYXQgd2lsbCB1c2UgV2ViU29ja2V0cy4KICoKICogIFJldHVybnM6CiAqICAgIEEgbmV3IFN0cm9waGUuV2ViU29ja2V0IG9iamVjdC4KICovClN0cm9waGUuV2Vic29ja2V0ID0gZnVuY3Rpb24oY29ubmVjdGlvbikgewogICAgdGhpcy5fY29ubiA9IGNvbm5lY3Rpb247CiAgICB0aGlzLnN0cmlwID0gInN0cmVhbTpzdHJlYW0iOwoKICAgIHZhciBzZXJ2aWNlID0gY29ubmVjdGlvbi5zZXJ2aWNlOwogICAgaWYgKHNlcnZpY2UuaW5kZXhPZigid3M6IikgIT09IDAgJiYgc2VydmljZS5pbmRleE9mKCJ3c3M6IikgIT09IDApIHsKICAgICAgICAvLyBJZiB0aGUgc2VydmljZSBpcyBub3QgYW4gYWJzb2x1dGUgVVJMLCBhc3N1bWUgaXQgaXMgYSBwYXRoIGFuZCBwdXQgdGhlIGFic29sdXRlCiAgICAgICAgLy8gVVJMIHRvZ2V0aGVyIGZyb20gb3B0aW9ucywgY3VycmVudCBVUkwgYW5kIHRoZSBwYXRoLgogICAgICAgIHZhciBuZXdfc2VydmljZSA9ICIiOwoKICAgICAgICBpZiAoY29ubmVjdGlvbi5vcHRpb25zLnByb3RvY29sID09PSAid3MiICYmIHdpbmRvdy5sb2NhdGlvbi5wcm90b2NvbCAhPT0gImh0dHBzOiIpIHsKICAgICAgICAgICAgbmV3X3NlcnZpY2UgKz0gIndzIjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBuZXdfc2VydmljZSArPSAid3NzIjsKICAgICAgICB9CgogICAgICAgIG5ld19zZXJ2aWNlICs9ICI6Ly8iICsgd2luZG93LmxvY2F0aW9uLmhvc3Q7CgogICAgICAgIGlmIChzZXJ2aWNlLmluZGV4T2YoIi8iKSAhPT0gMCkgewogICAgICAgICAgICBuZXdfc2VydmljZSArPSB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUgKyBzZXJ2aWNlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG5ld19zZXJ2aWNlICs9IHNlcnZpY2U7CiAgICAgICAgfQoKICAgICAgICBjb25uZWN0aW9uLnNlcnZpY2UgPSBuZXdfc2VydmljZTsKICAgIH0KfTsKClN0cm9waGUuV2Vic29ja2V0LnByb3RvdHlwZSA9IHsKICAgIC8qKiBQcml2YXRlRnVuY3Rpb246IF9idWlsZFN0cmVhbQogICAgICogIF9Qcml2YXRlXyBoZWxwZXIgZnVuY3Rpb24gdG8gZ2VuZXJhdGUgdGhlIDxzdHJlYW0+IHN0YXJ0IHRhZyBmb3IgV2ViU29ja2V0cwogICAgICoKICAgICAqICBSZXR1cm5zOgogICAgICogICAgQSBTdHJvcGhlLkJ1aWxkZXIgd2l0aCBhIDxzdHJlYW0+IGVsZW1lbnQuCiAgICAgKi8KICAgIF9idWlsZFN0cmVhbTogZnVuY3Rpb24gKCkKICAgIHsKICAgICAgICByZXR1cm4gJGJ1aWxkKCJzdHJlYW06c3RyZWFtIiwgewogICAgICAgICAgICAidG8iOiB0aGlzLl9jb25uLmRvbWFpbiwKICAgICAgICAgICAgInhtbG5zIjogU3Ryb3BoZS5OUy5DTElFTlQsCiAgICAgICAgICAgICJ4bWxuczpzdHJlYW0iOiBTdHJvcGhlLk5TLlNUUkVBTSwKICAgICAgICAgICAgInZlcnNpb24iOiAnMS4wJwogICAgICAgIH0pOwogICAgfSwKCiAgICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiBfY2hlY2tfc3RyZWFtZXJyb3IKICAgICAqIF9Qcml2YXRlXyBjaGVja3MgYSBtZXNzYWdlIGZvciBzdHJlYW06ZXJyb3IKICAgICAqCiAgICAgKiAgUGFyYW1ldGVyczoKICAgICAqICAgIChTdHJvcGhlLlJlcXVlc3QpIGJvZHlXcmFwIC0gVGhlIHJlY2VpdmVkIHN0YW56YS4KICAgICAqICAgIGNvbm5lY3RzdGF0dXMgLSBUaGUgQ29ubmVjdFN0YXR1cyB0aGF0IHdpbGwgYmUgc2V0IG9uIGVycm9yLgogICAgICogIFJldHVybnM6CiAgICAgKiAgICAgdHJ1ZSBpZiB0aGVyZSB3YXMgYSBzdHJlYW1lcnJvciwgZmFsc2Ugb3RoZXJ3aXNlLgogICAgICovCiAgICBfY2hlY2tfc3RyZWFtZXJyb3I6IGZ1bmN0aW9uIChib2R5V3JhcCwgY29ubmVjdHN0YXR1cykgewogICAgICAgIHZhciBlcnJvcnMgPSBib2R5V3JhcC5nZXRFbGVtZW50c0J5VGFnTmFtZSgic3RyZWFtOmVycm9yIik7CiAgICAgICAgaWYgKGVycm9ycy5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICB2YXIgZXJyb3IgPSBlcnJvcnNbMF07CgogICAgICAgIHZhciBjb25kaXRpb24gPSAiIjsKICAgICAgICB2YXIgdGV4dCA9ICIiOwoKICAgICAgICB2YXIgbnMgPSAidXJuOmlldGY6cGFyYW1zOnhtbDpuczp4bXBwLXN0cmVhbXMiOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZXJyb3IuY2hpbGROb2Rlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB2YXIgZSA9IGVycm9yLmNoaWxkTm9kZXNbaV07CiAgICAgICAgICAgIGlmIChlLmdldEF0dHJpYnV0ZSgieG1sbnMiKSAhPT0gbnMpIHsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9IGlmIChlLm5vZGVOYW1lID09PSAidGV4dCIpIHsKICAgICAgICAgICAgICAgIHRleHQgPSBlLnRleHRDb250ZW50OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29uZGl0aW9uID0gZS5ub2RlTmFtZTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdmFyIGVycm9yU3RyaW5nID0gIldlYlNvY2tldCBzdHJlYW0gZXJyb3I6ICI7CgogICAgICAgIGlmIChjb25kaXRpb24pIHsKICAgICAgICAgICAgZXJyb3JTdHJpbmcgKz0gY29uZGl0aW9uOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGVycm9yU3RyaW5nICs9ICJ1bmtub3duIjsKICAgICAgICB9CgogICAgICAgIGlmICh0ZXh0KSB7CiAgICAgICAgICAgIGVycm9yU3RyaW5nICs9ICIgLSAiICsgY29uZGl0aW9uOwogICAgICAgIH0KCiAgICAgICAgU3Ryb3BoZS5lcnJvcihlcnJvclN0cmluZyk7CgogICAgICAgIC8vIGNsb3NlIHRoZSBjb25uZWN0aW9uIG9uIHN0cmVhbV9lcnJvcgogICAgICAgIHRoaXMuX2Nvbm4uX2NoYW5nZUNvbm5lY3RTdGF0dXMoY29ubmVjdHN0YXR1cywgY29uZGl0aW9uKTsKICAgICAgICB0aGlzLl9jb25uLl9kb0Rpc2Nvbm5lY3QoKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0sCgogICAgLyoqIFByaXZhdGVGdW5jdGlvbjogX3Jlc2V0CiAgICAgKiAgUmVzZXQgdGhlIGNvbm5lY3Rpb24uCiAgICAgKgogICAgICogIFRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIGJ5IHRoZSByZXNldCBmdW5jdGlvbiBvZiB0aGUgU3Ryb3BoZSBDb25uZWN0aW9uLgogICAgICogIElzIG5vdCBuZWVkZWQgYnkgV2ViU29ja2V0cy4KICAgICAqLwogICAgX3Jlc2V0OiBmdW5jdGlvbiAoKQogICAgewogICAgICAgIHJldHVybjsKICAgIH0sCgogICAgLyoqIFByaXZhdGVGdW5jdGlvbjogX2Nvbm5lY3QKICAgICAqICBfUHJpdmF0ZV8gZnVuY3Rpb24gY2FsbGVkIGJ5IFN0cm9waGUuQ29ubmVjdGlvbi5jb25uZWN0CiAgICAgKgogICAgICogIENyZWF0ZXMgYSBXZWJTb2NrZXQgZm9yIGEgY29ubmVjdGlvbiBhbmQgYXNzaWducyBDYWxsYmFja3MgdG8gaXQuCiAgICAgKiAgRG9lcyBub3RoaW5nIGlmIHRoZXJlIGFscmVhZHkgaXMgYSBXZWJTb2NrZXQuCiAgICAgKi8KICAgIF9jb25uZWN0OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgLy8gRW5zdXJlIHRoYXQgdGhlcmUgaXMgbm8gb3BlbiBXZWJTb2NrZXQgZnJvbSBhIHByZXZpb3VzIENvbm5lY3Rpb24uCiAgICAgICAgdGhpcy5fY2xvc2VTb2NrZXQoKTsKCiAgICAgICAgLy8gQ3JlYXRlIHRoZSBuZXcgV29iU29ja2V0CiAgICAgICAgdGhpcy5zb2NrZXQgPSBuZXcgV2ViU29ja2V0KHRoaXMuX2Nvbm4uc2VydmljZSwgInhtcHAiKTsKICAgICAgICB0aGlzLnNvY2tldC5vbm9wZW4gPSB0aGlzLl9vbk9wZW4uYmluZCh0aGlzKTsKICAgICAgICB0aGlzLnNvY2tldC5vbmVycm9yID0gdGhpcy5fb25FcnJvci5iaW5kKHRoaXMpOwogICAgICAgIHRoaXMuc29ja2V0Lm9uY2xvc2UgPSB0aGlzLl9vbkNsb3NlLmJpbmQodGhpcyk7CiAgICAgICAgdGhpcy5zb2NrZXQub25tZXNzYWdlID0gdGhpcy5fY29ubmVjdF9jYl93cmFwcGVyLmJpbmQodGhpcyk7CiAgICB9LAoKICAgIC8qKiBQcml2YXRlRnVuY3Rpb246IF9jb25uZWN0X2NiCiAgICAgKiAgX1ByaXZhdGVfIGZ1bmN0aW9uIGNhbGxlZCBieSBTdHJvcGhlLkNvbm5lY3Rpb24uX2Nvbm5lY3RfY2IKICAgICAqCiAgICAgKiBjaGVja3MgZm9yIHN0cmVhbTplcnJvcgogICAgICoKICAgICAqICBQYXJhbWV0ZXJzOgogICAgICogICAgKFN0cm9waGUuUmVxdWVzdCkgYm9keVdyYXAgLSBUaGUgcmVjZWl2ZWQgc3RhbnphLgogICAgICovCiAgICBfY29ubmVjdF9jYjogZnVuY3Rpb24oYm9keVdyYXApIHsKICAgICAgICB2YXIgZXJyb3IgPSB0aGlzLl9jaGVja19zdHJlYW1lcnJvcihib2R5V3JhcCwgU3Ryb3BoZS5TdGF0dXMuQ09OTkZBSUwpOwogICAgICAgIGlmIChlcnJvcikgewogICAgICAgICAgICByZXR1cm4gU3Ryb3BoZS5TdGF0dXMuQ09OTkZBSUw7CiAgICAgICAgfQogICAgfSwKCiAgICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiBfaGFuZGxlU3RyZWFtU3RhcnQKICAgICAqIF9Qcml2YXRlXyBmdW5jdGlvbiB0aGF0IGNoZWNrcyB0aGUgb3BlbmluZyBzdHJlYW06c3RyZWFtIHRhZyBmb3IgZXJyb3JzLgogICAgICoKICAgICAqIERpc2Nvbm5lY3RzIGlmIHRoZXJlIGlzIGFuIGVycm9yIGFuZCByZXR1cm5zIGZhbHNlLCB0cnVlIG90aGVyd2lzZS4KICAgICAqCiAgICAgKiAgUGFyYW1ldGVyczoKICAgICAqICAgIChOb2RlKSBtZXNzYWdlIC0gU3RhbnphIGNvbnRhaW5pbmcgdGhlIHN0cmVhbTpzdHJlYW0uCiAgICAgKi8KICAgIF9oYW5kbGVTdHJlYW1TdGFydDogZnVuY3Rpb24obWVzc2FnZSkgewogICAgICAgIHZhciBlcnJvciA9IGZhbHNlOwogICAgICAgIC8vIENoZWNrIGZvciBlcnJvcnMgaW4gdGhlIHN0cmVhbTpzdHJlYW0gdGFnCiAgICAgICAgdmFyIG5zID0gbWVzc2FnZS5nZXRBdHRyaWJ1dGUoInhtbG5zIik7CiAgICAgICAgaWYgKHR5cGVvZiBucyAhPT0gInN0cmluZyIpIHsKICAgICAgICAgICAgZXJyb3IgPSAiTWlzc2luZyB4bWxucyBpbiBzdHJlYW06c3RyZWFtIjsKICAgICAgICB9IGVsc2UgaWYgKG5zICE9PSBTdHJvcGhlLk5TLkNMSUVOVCkgewogICAgICAgICAgICBlcnJvciA9ICJXcm9uZyB4bWxucyBpbiBzdHJlYW06c3RyZWFtOiAiICsgbnM7CiAgICAgICAgfQoKICAgICAgICB2YXIgbnNfc3RyZWFtID0gbWVzc2FnZS5uYW1lc3BhY2VVUkk7CiAgICAgICAgaWYgKHR5cGVvZiBuc19zdHJlYW0gIT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgIGVycm9yID0gIk1pc3NpbmcgeG1sbnM6c3RyZWFtIGluIHN0cmVhbTpzdHJlYW0iOwogICAgICAgIH0gZWxzZSBpZiAobnNfc3RyZWFtICE9PSBTdHJvcGhlLk5TLlNUUkVBTSkgewogICAgICAgICAgICBlcnJvciA9ICJXcm9uZyB4bWxuczpzdHJlYW0gaW4gc3RyZWFtOnN0cmVhbTogIiArIG5zX3N0cmVhbTsKICAgICAgICB9CgogICAgICAgIHZhciB2ZXIgPSBtZXNzYWdlLmdldEF0dHJpYnV0ZSgidmVyc2lvbiIpOwogICAgICAgIGlmICh0eXBlb2YgdmVyICE9PSAic3RyaW5nIikgewogICAgICAgICAgICBlcnJvciA9ICJNaXNzaW5nIHZlcnNpb24gaW4gc3RyZWFtOnN0cmVhbSI7CiAgICAgICAgfSBlbHNlIGlmICh2ZXIgIT09ICIxLjAiKSB7CiAgICAgICAgICAgIGVycm9yID0gIldyb25nIHZlcnNpb24gaW4gc3RyZWFtOnN0cmVhbTogIiArIHZlcjsKICAgICAgICB9CgogICAgICAgIGlmIChlcnJvcikgewogICAgICAgICAgICB0aGlzLl9jb25uLl9jaGFuZ2VDb25uZWN0U3RhdHVzKFN0cm9waGUuU3RhdHVzLkNPTk5GQUlMLCBlcnJvcik7CiAgICAgICAgICAgIHRoaXMuX2Nvbm4uX2RvRGlzY29ubmVjdCgpOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0sCgogICAgLyoqIFByaXZhdGVGdW5jdGlvbjogX2Nvbm5lY3RfY2Jfd3JhcHBlcgogICAgICogX1ByaXZhdGVfIGZ1bmN0aW9uIHRoYXQgaGFuZGxlcyB0aGUgZmlyc3QgY29ubmVjdGlvbiBtZXNzYWdlcy4KICAgICAqCiAgICAgKiBPbiByZWNlaXZpbmcgYW4gb3BlbmluZyBzdHJlYW0gdGFnIHRoaXMgY2FsbGJhY2sgcmVwbGFjZXMgaXRzZWxmIHdpdGggdGhlIHJlYWwKICAgICAqIG1lc3NhZ2UgaGFuZGxlci4gT24gcmVjZWl2aW5nIGEgc3RyZWFtIGVycm9yIHRoZSBjb25uZWN0aW9uIGlzIHRlcm1pbmF0ZWQuCiAgICAgKi8KICAgIF9jb25uZWN0X2NiX3dyYXBwZXI6IGZ1bmN0aW9uKG1lc3NhZ2UpIHsKICAgICAgICBpZiAobWVzc2FnZS5kYXRhLmluZGV4T2YoIjxzdHJlYW06c3RyZWFtICIpID09PSAwIHx8IG1lc3NhZ2UuZGF0YS5pbmRleE9mKCI8P3htbCIpID09PSAwKSB7CiAgICAgICAgICAgIC8vIFN0cmlwIHRoZSBYTUwgRGVjbGFyYXRpb24sIGlmIHRoZXJlIGlzIG9uZQogICAgICAgICAgICB2YXIgZGF0YSA9IG1lc3NhZ2UuZGF0YS5yZXBsYWNlKC9eKDxcPy4qP1w/PlxzKikqLywgIiIpOwogICAgICAgICAgICBpZiAoZGF0YSA9PT0gJycpIHJldHVybjsKCiAgICAgICAgICAgIC8vTWFrZSB0aGUgaW5pdGlhbCBzdHJlYW06c3RyZWFtIHNlbGZjbG9zaW5nIHRvIHBhcnNlIGl0IHdpdGhvdXQgYSBTQVggcGFyc2VyLgogICAgICAgICAgICBkYXRhID0gbWVzc2FnZS5kYXRhLnJlcGxhY2UoLzxzdHJlYW06c3RyZWFtICguKlteXC9dKT4vLCAiPHN0cmVhbTpzdHJlYW0gJDEvPiIpOwoKICAgICAgICAgICAgdmFyIHN0cmVhbVN0YXJ0ID0gbmV3IERPTVBhcnNlcigpLnBhcnNlRnJvbVN0cmluZyhkYXRhLCAidGV4dC94bWwiKS5kb2N1bWVudEVsZW1lbnQ7CiAgICAgICAgICAgIHRoaXMuX2Nvbm4ueG1sSW5wdXQoc3RyZWFtU3RhcnQpOwogICAgICAgICAgICB0aGlzLl9jb25uLnJhd0lucHV0KG1lc3NhZ2UuZGF0YSk7CgogICAgICAgICAgICAvL19oYW5kbGVTdHJlYW1TdGVhcnQgd2lsbCBjaGVjayBmb3IgWE1MIGVycm9ycyBhbmQgZGlzY29ubmVjdCBvbiBlcnJvcgogICAgICAgICAgICBpZiAodGhpcy5faGFuZGxlU3RyZWFtU3RhcnQoc3RyZWFtU3RhcnQpKSB7CgogICAgICAgICAgICAgICAgLy9fY29ubmVjdF9jYiB3aWxsIGNoZWNrIGZvciBzdHJlYW06ZXJyb3IgYW5kIGRpc2Nvbm5lY3Qgb24gZXJyb3IKICAgICAgICAgICAgICAgIHRoaXMuX2Nvbm5lY3RfY2Ioc3RyZWFtU3RhcnQpOwoKICAgICAgICAgICAgICAgIC8vIGVuc3VyZSByZWNlaXZlZCBzdHJlYW06c3RyZWFtIGlzIE5PVCBzZWxmY2xvc2luZyBhbmQgc2F2ZSBpdCBmb3IgZm9sbG93aW5nIG1lc3NhZ2VzCiAgICAgICAgICAgICAgICB0aGlzLnN0cmVhbVN0YXJ0ID0gbWVzc2FnZS5kYXRhLnJlcGxhY2UoL148c3RyZWFtOiguKilcLz4kLywgIjxzdHJlYW06JDE+Iik7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKG1lc3NhZ2UuZGF0YSA9PT0gIjwvc3RyZWFtOnN0cmVhbT4iKSB7CiAgICAgICAgICAgIHRoaXMuX2Nvbm4ucmF3SW5wdXQobWVzc2FnZS5kYXRhKTsKICAgICAgICAgICAgdGhpcy5fY29ubi54bWxJbnB1dChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzdHJlYW06c3RyZWFtIikpOwogICAgICAgICAgICB0aGlzLl9jb25uLl9jaGFuZ2VDb25uZWN0U3RhdHVzKFN0cm9waGUuU3RhdHVzLkNPTk5GQUlMLCAiUmVjZWl2ZWQgY2xvc2luZyBzdHJlYW0iKTsKICAgICAgICAgICAgdGhpcy5fY29ubi5fZG9EaXNjb25uZWN0KCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2YXIgc3RyaW5nID0gdGhpcy5fc3RyZWFtV3JhcChtZXNzYWdlLmRhdGEpOwogICAgICAgICAgICB2YXIgZWxlbSA9IG5ldyBET01QYXJzZXIoKS5wYXJzZUZyb21TdHJpbmcoc3RyaW5nLCAidGV4dC94bWwiKS5kb2N1bWVudEVsZW1lbnQ7CiAgICAgICAgICAgIHRoaXMuc29ja2V0Lm9ubWVzc2FnZSA9IHRoaXMuX29uTWVzc2FnZS5iaW5kKHRoaXMpOwogICAgICAgICAgICB0aGlzLl9jb25uLl9jb25uZWN0X2NiKGVsZW0sIG51bGwsIG1lc3NhZ2UuZGF0YSk7CiAgICAgICAgfQogICAgfSwKCiAgICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiBfZGlzY29ubmVjdAogICAgICogIF9Qcml2YXRlXyBmdW5jdGlvbiBjYWxsZWQgYnkgU3Ryb3BoZS5Db25uZWN0aW9uLmRpc2Nvbm5lY3QKICAgICAqCiAgICAgKiAgRGlzY29ubmVjdHMgYW5kIHNlbmRzIGEgbGFzdCBzdGFuemEgaWYgb25lIGlzIGdpdmVuCiAgICAgKgogICAgICogIFBhcmFtZXRlcnM6CiAgICAgKiAgICAoUmVxdWVzdCkgcHJlcyAtIFRoaXMgc3RhbnphIHdpbGwgYmUgc2VudCBiZWZvcmUgZGlzY29ubmVjdGluZy4KICAgICAqLwogICAgX2Rpc2Nvbm5lY3Q6IGZ1bmN0aW9uIChwcmVzKQogICAgewogICAgICAgIGlmICh0aGlzLnNvY2tldC5yZWFkeVN0YXRlICE9PSBXZWJTb2NrZXQuQ0xPU0VEKSB7CiAgICAgICAgICAgIGlmIChwcmVzKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9jb25uLnNlbmQocHJlcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIGNsb3NlID0gJzwvc3RyZWFtOnN0cmVhbT4nOwogICAgICAgICAgICB0aGlzLl9jb25uLnhtbE91dHB1dChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzdHJlYW06c3RyZWFtIikpOwogICAgICAgICAgICB0aGlzLl9jb25uLnJhd091dHB1dChjbG9zZSk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICB0aGlzLnNvY2tldC5zZW5kKGNsb3NlKTsKICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgU3Ryb3BoZS5pbmZvKCJDb3VsZG4ndCBzZW5kIGNsb3Npbmcgc3RyZWFtIHRhZy4iKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdGhpcy5fY29ubi5fZG9EaXNjb25uZWN0KCk7CiAgICB9LAoKICAgIC8qKiBQcml2YXRlRnVuY3Rpb246IF9kb0Rpc2Nvbm5lY3QKICAgICAqICBfUHJpdmF0ZV8gZnVuY3Rpb24gdG8gZGlzY29ubmVjdC4KICAgICAqCiAgICAgKiAgSnVzdCBjbG9zZXMgdGhlIFNvY2tldCBmb3IgV2ViU29ja2V0cwogICAgICovCiAgICBfZG9EaXNjb25uZWN0OiBmdW5jdGlvbiAoKQogICAgewogICAgICAgIFN0cm9waGUuaW5mbygiV2ViU29ja2V0cyBfZG9EaXNjb25uZWN0IHdhcyBjYWxsZWQiKTsKICAgICAgICB0aGlzLl9jbG9zZVNvY2tldCgpOwogICAgfSwKCiAgICAvKiogUHJpdmF0ZUZ1bmN0aW9uIF9zdHJlYW1XcmFwCiAgICAgKiAgX1ByaXZhdGVfIGhlbHBlciBmdW5jdGlvbiB0byB3cmFwIGEgc3RhbnphIGluIGEgPHN0cmVhbT4gdGFnLgogICAgICogIFRoaXMgaXMgdXNlZCBzbyBTdHJvcGhlIGNhbiBwcm9jZXNzIHN0YW56YXMgZnJvbSBXZWJTb2NrZXRzIGxpa2UgQk9TSAogICAgICovCiAgICBfc3RyZWFtV3JhcDogZnVuY3Rpb24gKHN0YW56YSkKICAgIHsKICAgICAgICByZXR1cm4gdGhpcy5zdHJlYW1TdGFydCArIHN0YW56YSArICc8L3N0cmVhbTpzdHJlYW0+JzsKICAgIH0sCgoKICAgIC8qKiBQcml2YXRlRnVuY3Rpb246IF9jbG9zZVNvY2tldAogICAgICogIF9Qcml2YXRlXyBmdW5jdGlvbiB0byBjbG9zZSB0aGUgV2ViU29ja2V0LgogICAgICoKICAgICAqICBDbG9zZXMgdGhlIHNvY2tldCBpZiBpdCBpcyBzdGlsbCBvcGVuIGFuZCBkZWxldGVzIGl0CiAgICAgKi8KICAgIF9jbG9zZVNvY2tldDogZnVuY3Rpb24gKCkKICAgIHsKICAgICAgICBpZiAodGhpcy5zb2NrZXQpIHsgdHJ5IHsKICAgICAgICAgICAgdGhpcy5zb2NrZXQuY2xvc2UoKTsKICAgICAgICB9IGNhdGNoIChlKSB7fSB9CiAgICAgICAgdGhpcy5zb2NrZXQgPSBudWxsOwogICAgfSwKCiAgICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiBfZW1wdHlRdWV1ZQogICAgICogX1ByaXZhdGVfIGZ1bmN0aW9uIHRvIGNoZWNrIGlmIHRoZSBtZXNzYWdlIHF1ZXVlIGlzIGVtcHR5LgogICAgICoKICAgICAqICBSZXR1cm5zOgogICAgICogICAgVHJ1ZSwgYmVjYXVzZSBXZWJTb2NrZXQgbWVzc2FnZXMgYXJlIHNlbmQgaW1tZWRpYXRlbHkgYWZ0ZXIgcXVldWVpbmcuCiAgICAgKi8KICAgIF9lbXB0eVF1ZXVlOiBmdW5jdGlvbiAoKQogICAgewogICAgICAgIHJldHVybiB0cnVlOwogICAgfSwKCiAgICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiBfb25DbG9zZQogICAgICogX1ByaXZhdGVfIGZ1bmN0aW9uIHRvIGhhbmRsZSB3ZWJzb2NrZXRzIGNsb3NpbmcuCiAgICAgKgogICAgICogTm90aGluZyB0byBkbyBoZXJlIGZvciBXZWJTb2NrZXRzCiAgICAgKi8KICAgIF9vbkNsb3NlOiBmdW5jdGlvbigpIHsKICAgICAgICBpZih0aGlzLl9jb25uLmNvbm5lY3RlZCAmJiAhdGhpcy5fY29ubi5kaXNjb25uZWN0aW5nKSB7CiAgICAgICAgICAgIFN0cm9waGUuZXJyb3IoIldlYnNvY2tldCBjbG9zZWQgdW5leGNlY3RlZGx5Iik7CiAgICAgICAgICAgIHRoaXMuX2Nvbm4uX2RvRGlzY29ubmVjdCgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIFN0cm9waGUuaW5mbygiV2Vic29ja2V0IGNsb3NlZCIpOwogICAgICAgIH0KICAgIH0sCgogICAgLyoqIFByaXZhdGVGdW5jdGlvbjogX25vX2F1dGhfcmVjZWl2ZWQKICAgICAqCiAgICAgKiBDYWxsZWQgb24gc3RyZWFtIHN0YXJ0L3Jlc3RhcnQgd2hlbiBubyBzdHJlYW06ZmVhdHVyZXMKICAgICAqIGhhcyBiZWVuIHJlY2VpdmVkLgogICAgICovCiAgICBfbm9fYXV0aF9yZWNlaXZlZDogZnVuY3Rpb24gKF9jYWxsYmFjaykKICAgIHsKICAgICAgICBTdHJvcGhlLmVycm9yKCJTZXJ2ZXIgZGlkIG5vdCBzZW5kIGFueSBhdXRoIG1ldGhvZHMiKTsKICAgICAgICB0aGlzLl9jb25uLl9jaGFuZ2VDb25uZWN0U3RhdHVzKFN0cm9waGUuU3RhdHVzLkNPTk5GQUlMLCAiU2VydmVyIGRpZCBub3Qgc2VuZCBhbnkgYXV0aCBtZXRob2RzIik7CiAgICAgICAgaWYgKF9jYWxsYmFjaykgewogICAgICAgICAgICBfY2FsbGJhY2sgPSBfY2FsbGJhY2suYmluZCh0aGlzLl9jb25uKTsKICAgICAgICAgICAgX2NhbGxiYWNrKCk7CiAgICAgICAgfQogICAgICAgIHRoaXMuX2Nvbm4uX2RvRGlzY29ubmVjdCgpOwogICAgfSwKCiAgICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiBfb25EaXNjb25uZWN0VGltZW91dAogICAgICogIF9Qcml2YXRlXyB0aW1lb3V0IGhhbmRsZXIgZm9yIGhhbmRsaW5nIG5vbi1ncmFjZWZ1bCBkaXNjb25uZWN0aW9uLgogICAgICoKICAgICAqICBUaGlzIGRvZXMgbm90aGluZyBmb3IgV2ViU29ja2V0cwogICAgICovCiAgICBfb25EaXNjb25uZWN0VGltZW91dDogZnVuY3Rpb24gKCkge30sCgogICAgLyoqIFByaXZhdGVGdW5jdGlvbjogX29uRXJyb3IKICAgICAqIF9Qcml2YXRlXyBmdW5jdGlvbiB0byBoYW5kbGUgd2Vic29ja2V0cyBlcnJvcnMuCiAgICAgKgogICAgICogUGFyYW1ldGVyczoKICAgICAqIChPYmplY3QpIGVycm9yIC0gVGhlIHdlYnNvY2tldCBlcnJvci4KICAgICAqLwogICAgX29uRXJyb3I6IGZ1bmN0aW9uKGVycm9yKSB7CiAgICAgICAgU3Ryb3BoZS5lcnJvcigiV2Vic29ja2V0IGVycm9yICIgKyBlcnJvcik7CiAgICAgICAgdGhpcy5fY29ubi5fY2hhbmdlQ29ubmVjdFN0YXR1cyhTdHJvcGhlLlN0YXR1cy5DT05ORkFJTCwgIlRoZSBXZWJTb2NrZXQgY29ubmVjdGlvbiBjb3VsZCBub3QgYmUgZXN0YWJsaXNoZWQgd2FzIGRpc2Nvbm5lY3RlZC4iKTsKICAgICAgICB0aGlzLl9kaXNjb25uZWN0KCk7CiAgICB9LAoKICAgIC8qKiBQcml2YXRlRnVuY3Rpb246IF9vbklkbGUKICAgICAqICBfUHJpdmF0ZV8gZnVuY3Rpb24gY2FsbGVkIGJ5IFN0cm9waGUuQ29ubmVjdGlvbi5fb25JZGxlCiAgICAgKgogICAgICogIHNlbmRzIGFsbCBxdWV1ZWQgc3RhbnphcwogICAgICovCiAgICBfb25JZGxlOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGRhdGEgPSB0aGlzLl9jb25uLl9kYXRhOwogICAgICAgIGlmIChkYXRhLmxlbmd0aCA+IDAgJiYgIXRoaXMuX2Nvbm4ucGF1c2VkKSB7CiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKGRhdGFbaV0gIT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgc3RhbnphLCByYXdTdGFuemE7CiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGFbaV0gPT09ICJyZXN0YXJ0IikgewogICAgICAgICAgICAgICAgICAgICAgICBzdGFuemEgPSB0aGlzLl9idWlsZFN0cmVhbSgpOwogICAgICAgICAgICAgICAgICAgICAgICByYXdTdGFuemEgPSB0aGlzLl9yZW1vdmVDbG9zaW5nVGFnKHN0YW56YSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0YW56YSA9IHN0YW56YS50cmVlKCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3RhbnphID0gZGF0YVtpXTsKICAgICAgICAgICAgICAgICAgICAgICAgcmF3U3RhbnphID0gU3Ryb3BoZS5zZXJpYWxpemUoc3RhbnphKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY29ubi54bWxPdXRwdXQoc3RhbnphKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9jb25uLnJhd091dHB1dChyYXdTdGFuemEpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuc29ja2V0LnNlbmQocmF3U3RhbnphKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLl9jb25uLl9kYXRhID0gW107CiAgICAgICAgfQogICAgfSwKCiAgICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiBfb25NZXNzYWdlCiAgICAgKiBfUHJpdmF0ZV8gZnVuY3Rpb24gdG8gaGFuZGxlIHdlYnNvY2tldHMgbWVzc2FnZXMuCiAgICAgKgogICAgICogVGhpcyBmdW5jdGlvbiBwYXJzZXMgZWFjaCBvZiB0aGUgbWVzc2FnZXMgYXMgaWYgdGhleSBhcmUgZnVsbCBkb2N1bWVudHMuIFtUT0RPIDogV2UgbWF5IGFjdHVhbGx5IHdhbnQgdG8gdXNlIGEgU0FYIFB1c2ggcGFyc2VyXS4KICAgICAqCiAgICAgKiBTaW5jZSBhbGwgWE1QUCB0cmFmZmljIHN0YXJ0cyB3aXRoICI8c3RyZWFtOnN0cmVhbSB2ZXJzaW9uPScxLjAnIHhtbDpsYW5nPSdlbicgeG1sbnM9J2phYmJlcjpjbGllbnQnIHhtbG5zOnN0cmVhbT0naHR0cDovL2V0aGVyeC5qYWJiZXIub3JnL3N0cmVhbXMnIGlkPSczNjk3Mzk1NDYzJyBmcm9tPSdTRVJWRVInPiIKICAgICAqIFRoZSBmaXJzdCBzdGFuemEgd2lsbCBhbHdheXMgZmFpbCB0byBiZSBwYXJzZWQuLi4KICAgICAqIEFkZHRpb25uYWx5LCB0aGUgc2Vjb25kcyBzdGFuemEgd2lsbCBhbHdheXMgYmUgYSA8c3RyZWFtOmZlYXR1cmVzPiB3aXRoIHRoZSBzdHJlYW0gTlMgZGVmaW5lZCBpbiB0aGUgcHJldmlvdXMgc3RhbnphLi4uIHNvIHdlIG5lZWQgdG8gJ2ZvcmNlJyB0aGUgaW5jbHVzaW9uIG9mIHRoZSBOUyBpbiB0aGlzIHN0YW56YSEKICAgICAqCiAgICAgKiBQYXJhbWV0ZXJzOgogICAgICogKHN0cmluZykgbWVzc2FnZSAtIFRoZSB3ZWJzb2NrZXQgbWVzc2FnZS4KICAgICAqLwogICAgX29uTWVzc2FnZTogZnVuY3Rpb24obWVzc2FnZSkgewogICAgICAgIHZhciBlbGVtLCBkYXRhOwogICAgICAgIC8vIGNoZWNrIGZvciBjbG9zaW5nIHN0cmVhbQogICAgICAgIGlmIChtZXNzYWdlLmRhdGEgPT09ICI8L3N0cmVhbTpzdHJlYW0+IikgewogICAgICAgICAgICB2YXIgY2xvc2UgPSAiPC9zdHJlYW06c3RyZWFtPiI7CiAgICAgICAgICAgIHRoaXMuX2Nvbm4ucmF3SW5wdXQoY2xvc2UpOwogICAgICAgICAgICB0aGlzLl9jb25uLnhtbElucHV0KGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInN0cmVhbTpzdHJlYW0iKSk7CiAgICAgICAgICAgIGlmICghdGhpcy5fY29ubi5kaXNjb25uZWN0aW5nKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9jb25uLl9kb0Rpc2Nvbm5lY3QoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfSBlbHNlIGlmIChtZXNzYWdlLmRhdGEuc2VhcmNoKCI8c3RyZWFtOnN0cmVhbSAiKSA9PT0gMCkgewogICAgICAgICAgICAvL01ha2UgdGhlIGluaXRpYWwgc3RyZWFtOnN0cmVhbSBzZWxmY2xvc2luZyB0byBwYXJzZSBpdCB3aXRob3V0IGEgU0FYIHBhcnNlci4KICAgICAgICAgICAgZGF0YSA9IG1lc3NhZ2UuZGF0YS5yZXBsYWNlKC88c3RyZWFtOnN0cmVhbSAoLipbXlwvXSk+LywgIjxzdHJlYW06c3RyZWFtICQxLz4iKTsKICAgICAgICAgICAgZWxlbSA9IG5ldyBET01QYXJzZXIoKS5wYXJzZUZyb21TdHJpbmcoZGF0YSwgInRleHQveG1sIikuZG9jdW1lbnRFbGVtZW50OwoKICAgICAgICAgICAgaWYgKCF0aGlzLl9oYW5kbGVTdHJlYW1TdGFydChlbGVtKSkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZGF0YSA9IHRoaXMuX3N0cmVhbVdyYXAobWVzc2FnZS5kYXRhKTsKICAgICAgICAgICAgZWxlbSA9IG5ldyBET01QYXJzZXIoKS5wYXJzZUZyb21TdHJpbmcoZGF0YSwgInRleHQveG1sIikuZG9jdW1lbnRFbGVtZW50OwogICAgICAgIH0KCiAgICAgICAgaWYgKHRoaXMuX2NoZWNrX3N0cmVhbWVycm9yKGVsZW0sIFN0cm9waGUuU3RhdHVzLkVSUk9SKSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvL2hhbmRsZSB1bmF2YWlsYWJsZSBwcmVzZW5jZSBzdGFuemEgYmVmb3JlIGRpc2Nvbm5lY3RpbmcKICAgICAgICBpZiAodGhpcy5fY29ubi5kaXNjb25uZWN0aW5nICYmCiAgICAgICAgICAgICAgICBlbGVtLmZpcnN0Q2hpbGQubm9kZU5hbWUgPT09ICJwcmVzZW5jZSIgJiYKICAgICAgICAgICAgICAgIGVsZW0uZmlyc3RDaGlsZC5nZXRBdHRyaWJ1dGUoInR5cGUiKSA9PT0gInVuYXZhaWxhYmxlIikgewogICAgICAgICAgICB0aGlzLl9jb25uLnhtbElucHV0KGVsZW0pOwogICAgICAgICAgICB0aGlzLl9jb25uLnJhd0lucHV0KFN0cm9waGUuc2VyaWFsaXplKGVsZW0pKTsKICAgICAgICAgICAgLy8gaWYgd2UgYXJlIGFscmVhZHkgZGlzY29ubmVjdGluZyB3ZSB3aWxsIGlnbm9yZSB0aGUgdW5hdmFpbGFibGUgc3RhbnphIGFuZAogICAgICAgICAgICAvLyB3YWl0IGZvciB0aGUgPC9zdHJlYW06c3RyZWFtPiB0YWcgYmVmb3JlIHdlIGNsb3NlIHRoZSBjb25uZWN0aW9uCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdGhpcy5fY29ubi5fZGF0YVJlY3YoZWxlbSwgbWVzc2FnZS5kYXRhKTsKICAgIH0sCgogICAgLyoqIFByaXZhdGVGdW5jdGlvbjogX29uT3BlbgogICAgICogX1ByaXZhdGVfIGZ1bmN0aW9uIHRvIGhhbmRsZSB3ZWJzb2NrZXRzIGNvbm5lY3Rpb24gc2V0dXAuCiAgICAgKgogICAgICogVGhlIG9wZW5pbmcgc3RyZWFtIHRhZyBpcyBzZW50IGhlcmUuCiAgICAgKi8KICAgIF9vbk9wZW46IGZ1bmN0aW9uKCkgewogICAgICAgIFN0cm9waGUuaW5mbygiV2Vic29ja2V0IG9wZW4iKTsKICAgICAgICB2YXIgc3RhcnQgPSB0aGlzLl9idWlsZFN0cmVhbSgpOwogICAgICAgIHRoaXMuX2Nvbm4ueG1sT3V0cHV0KHN0YXJ0LnRyZWUoKSk7CgogICAgICAgIHZhciBzdGFydFN0cmluZyA9IHRoaXMuX3JlbW92ZUNsb3NpbmdUYWcoc3RhcnQpOwogICAgICAgIHRoaXMuX2Nvbm4ucmF3T3V0cHV0KHN0YXJ0U3RyaW5nKTsKICAgICAgICB0aGlzLnNvY2tldC5zZW5kKHN0YXJ0U3RyaW5nKTsKICAgIH0sCgogICAgLyoqIFByaXZhdGVGdW5jdGlvbjogX3JlbW92ZUNsb3NpbmdUYWcKICAgICAqICBfUHJpdmF0ZV8gZnVuY3Rpb24gdG8gTWFrZSB0aGUgZmlyc3QgPHN0cmVhbTpzdHJlYW0+IG5vbi1zZWxmY2xvc2luZwogICAgICoKICAgICAqICBQYXJhbWV0ZXJzOgogICAgICogICAgICAoT2JqZWN0KSBlbGVtIC0gVGhlIDxzdHJlYW06c3RyZWFtPiB0YWcuCiAgICAgKgogICAgICogIFJldHVybnM6CiAgICAgKiAgICAgIFRoZSBzdHJlYW06c3RyZWFtIHRhZyBhcyBTdHJpbmcKICAgICAqLwogICAgX3JlbW92ZUNsb3NpbmdUYWc6IGZ1bmN0aW9uKGVsZW0pIHsKICAgICAgICB2YXIgc3RyaW5nID0gU3Ryb3BoZS5zZXJpYWxpemUoZWxlbSk7CiAgICAgICAgc3RyaW5nID0gc3RyaW5nLnJlcGxhY2UoLzwoc3RyZWFtOnN0cmVhbSAuKlteXC9dKVwvPiQvLCAiPCQxPiIpOwogICAgICAgIHJldHVybiBzdHJpbmc7CiAgICB9LAoKICAgIC8qKiBQcml2YXRlRnVuY3Rpb246IF9yZXFUb0RhdGEKICAgICAqIF9Qcml2YXRlXyBmdW5jdGlvbiB0byBnZXQgYSBzdGFuemEgb3V0IG9mIGEgcmVxdWVzdC4KICAgICAqCiAgICAgKiBXZWJTb2NrZXRzIGRvbid0IHVzZSByZXF1ZXN0cywgc28gdGhlIHBhc3NlZCBhcmd1bWVudCBpcyBqdXN0IHJldHVybmVkLgogICAgICoKICAgICAqICBQYXJhbWV0ZXJzOgogICAgICogICAgKE9iamVjdCkgc3RhbnphIC0gVGhlIHN0YW56YS4KICAgICAqCiAgICAgKiAgUmV0dXJuczoKICAgICAqICAgIFRoZSBzdGFuemEgdGhhdCB3YXMgcGFzc2VkLgogICAgICovCiAgICBfcmVxVG9EYXRhOiBmdW5jdGlvbiAoc3RhbnphKQogICAgewogICAgICAgIHJldHVybiBzdGFuemE7CiAgICB9LAoKICAgIC8qKiBQcml2YXRlRnVuY3Rpb246IF9zZW5kCiAgICAgKiAgX1ByaXZhdGVfIHBhcnQgb2YgdGhlIENvbm5lY3Rpb24uc2VuZCBmdW5jdGlvbiBmb3IgV2ViU29ja2V0CiAgICAgKgogICAgICogSnVzdCBmbHVzaGVzIHRoZSBtZXNzYWdlcyB0aGF0IGFyZSBpbiB0aGUgcXVldWUKICAgICAqLwogICAgX3NlbmQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICB0aGlzLl9jb25uLmZsdXNoKCk7CiAgICB9LAoKICAgIC8qKiBQcml2YXRlRnVuY3Rpb246IF9zZW5kUmVzdGFydAogICAgICoKICAgICAqICBTZW5kIGFuIHhtcHA6cmVzdGFydCBzdGFuemEuCiAgICAgKi8KICAgIF9zZW5kUmVzdGFydDogZnVuY3Rpb24gKCkKICAgIHsKICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5fY29ubi5faWRsZVRpbWVvdXQpOwogICAgICAgIHRoaXMuX2Nvbm4uX29uSWRsZS5iaW5kKHRoaXMuX2Nvbm4pKCk7CiAgICB9Cn07CgpkZWZpbmUoInN0cm9waGUiLCAoZnVuY3Rpb24gKGdsb2JhbCkgewogICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgcmV0LCBmbjsKICAgICAgICByZXR1cm4gcmV0IHx8IGdsb2JhbC5TdHJvcGhlOwogICAgfTsKfSh0aGlzKSkpOwoKLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjguMAoKLyoKICpQbHVnaW4gdG8gaW1wbGVtZW50IHRoZSBNVUMgZXh0ZW5zaW9uLgogICBodHRwOi8veG1wcC5vcmcvZXh0ZW5zaW9ucy94ZXAtMDA0NS5odG1sCiAqUHJldmlvdXMgQXV0aG9yOgogICAgTmF0aGFuIFpvcm4gPG5hdGhhbi56b3JuQGdtYWlsLmNvbT4KICpDb21wbGV0ZSBDb2ZmZWVTY3JpcHQgcmV3cml0ZToKICAgIEFuZHJlYXMgR3V0aCA8Z3V0aEBkYmlzLnJ3dGgtYWFjaGVuLmRlPgogKi8KCihmdW5jdGlvbigpIHsKICB2YXIgT2NjdXBhbnQsIFJvb21Db25maWcsIFhtcHBSb29tLAogICAgX19oYXNQcm9wID0ge30uaGFzT3duUHJvcGVydHksCiAgICBfX2JpbmQgPSBmdW5jdGlvbihmbiwgbWUpeyByZXR1cm4gZnVuY3Rpb24oKXsgcmV0dXJuIGZuLmFwcGx5KG1lLCBhcmd1bWVudHMpOyB9OyB9OwoKICBTdHJvcGhlLmFkZENvbm5lY3Rpb25QbHVnaW4oJ211YycsIHsKICAgIF9jb25uZWN0aW9uOiBudWxsLAogICAgcm9vbXM6IHt9LAogICAgcm9vbU5hbWVzOiBbXSwKCiAgICAvKkZ1bmN0aW9uCiAgICBJbml0aWFsaXplIHRoZSBNVUMgcGx1Z2luLiBTZXRzIHRoZSBjb3JyZWN0IGNvbm5lY3Rpb24gb2JqZWN0IGFuZAogICAgZXh0ZW5kcyB0aGUgbmFtZXNhY2UuCiAgICAgKi8KICAgIGluaXQ6IGZ1bmN0aW9uKGNvbm4pIHsKICAgICAgdGhpcy5fY29ubmVjdGlvbiA9IGNvbm47CiAgICAgIHRoaXMuX211Y19oYW5kbGVyID0gbnVsbDsKICAgICAgU3Ryb3BoZS5hZGROYW1lc3BhY2UoJ01VQ19PV05FUicsIFN0cm9waGUuTlMuTVVDICsgIiNvd25lciIpOwogICAgICBTdHJvcGhlLmFkZE5hbWVzcGFjZSgnTVVDX0FETUlOJywgU3Ryb3BoZS5OUy5NVUMgKyAiI2FkbWluIik7CiAgICAgIFN0cm9waGUuYWRkTmFtZXNwYWNlKCdNVUNfVVNFUicsIFN0cm9waGUuTlMuTVVDICsgIiN1c2VyIik7CiAgICAgIFN0cm9waGUuYWRkTmFtZXNwYWNlKCdNVUNfUk9PTUNPTkYnLCBTdHJvcGhlLk5TLk1VQyArICIjcm9vbWNvbmZpZyIpOwogICAgICByZXR1cm4gU3Ryb3BoZS5hZGROYW1lc3BhY2UoJ01VQ19SRUdJU1RFUicsICJqYWJiZXI6aXE6cmVnaXN0ZXIiKTsKICAgIH0sCgogICAgLypGdW5jdGlvbgogICAgSm9pbiBhIG11bHRpLXVzZXIgY2hhdCByb29tCiAgICBQYXJhbWV0ZXJzOgogICAgKFN0cmluZykgcm9vbSAtIFRoZSBtdWx0aS11c2VyIGNoYXQgcm9vbSB0byBqb2luLgogICAgKFN0cmluZykgbmljayAtIFRoZSBuaWNrbmFtZSB0byB1c2UgaW4gdGhlIGNoYXQgcm9vbS4gT3B0aW9uYWwKICAgIChGdW5jdGlvbikgbXNnX2hhbmRsZXJfY2IgLSBUaGUgZnVuY3Rpb24gY2FsbCB0byBoYW5kbGUgbWVzc2FnZXMgZnJvbSB0aGUKICAgIHNwZWNpZmllZCBjaGF0IHJvb20uCiAgICAoRnVuY3Rpb24pIHByZXNfaGFuZGxlcl9jYiAtIFRoZSBmdW5jdGlvbiBjYWxsIGJhY2sgdG8gaGFuZGxlIHByZXNlbmNlCiAgICBpbiB0aGUgY2hhdCByb29tLgogICAgKEZ1bmN0aW9uKSByb3N0ZXJfY2IgLSBUaGUgZnVuY3Rpb24gY2FsbCB0byBoYW5kbGUgcm9zdGVyIGluZm8gaW4gdGhlIGNoYXQgcm9vbQogICAgKFN0cmluZykgcGFzc3dvcmQgLSBUaGUgb3B0aW9uYWwgcGFzc3dvcmQgdG8gdXNlLiAocGFzc3dvcmQgcHJvdGVjdGVkCiAgICByb29tcyBvbmx5KQogICAgKE9iamVjdCkgaGlzdG9yeV9hdHRycyAtIE9wdGlvbmFsIGF0dHJpYnV0ZXMgZm9yIHJldHJpZXZpbmcgaGlzdG9yeQogICAgKFhNTCBET00gRWxlbWVudCkgZXh0ZW5kZWRfcHJlc2VuY2UgLSBPcHRpb25hbCBYTUwgZm9yIGV4dGVuZGluZyBwcmVzZW5jZQogICAgICovCiAgICBqb2luOiBmdW5jdGlvbihyb29tLCBuaWNrLCBtc2dfaGFuZGxlcl9jYiwgcHJlc19oYW5kbGVyX2NiLCByb3N0ZXJfY2IsIHBhc3N3b3JkLCBoaXN0b3J5X2F0dHJzKSB7CiAgICAgIHZhciBtc2csIHJvb21fbmljazsKICAgICAgcm9vbV9uaWNrID0gdGhpcy50ZXN0X2FwcGVuZF9uaWNrKHJvb20sIG5pY2spOwogICAgICBtc2cgPSAkcHJlcyh7CiAgICAgICAgZnJvbTogdGhpcy5fY29ubmVjdGlvbi5qaWQsCiAgICAgICAgdG86IHJvb21fbmljawogICAgICB9KS5jKCJ4IiwgewogICAgICAgIHhtbG5zOiBTdHJvcGhlLk5TLk1VQwogICAgICB9KTsKICAgICAgaWYgKGhpc3RvcnlfYXR0cnMgIT0gbnVsbCkgewogICAgICAgIG1zZyA9IG1zZy5jKCJoaXN0b3J5IiwgaGlzdG9yeV9hdHRycykudXAoKTsKICAgICAgfQogICAgICBpZiAocGFzc3dvcmQgIT0gbnVsbCkgewogICAgICAgIG1zZy5jbm9kZShTdHJvcGhlLnhtbEVsZW1lbnQoInBhc3N3b3JkIiwgW10sIHBhc3N3b3JkKSk7CiAgICAgIH0KICAgICAgaWYgKHR5cGVvZiBleHRlbmRlZF9wcmVzZW5jZSAhPT0gInVuZGVmaW5lZCIgJiYgZXh0ZW5kZWRfcHJlc2VuY2UgIT09IG51bGwpIHsKICAgICAgICBtc2cudXAuY25vZGUoZXh0ZW5kZWRfcHJlc2VuY2UpOwogICAgICB9CiAgICAgIGlmICh0aGlzLl9tdWNfaGFuZGxlciA9PSBudWxsKSB7CiAgICAgICAgdGhpcy5fbXVjX2hhbmRsZXIgPSB0aGlzLl9jb25uZWN0aW9uLmFkZEhhbmRsZXIoKGZ1bmN0aW9uKF90aGlzKSB7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oc3RhbnphKSB7CiAgICAgICAgICAgIHZhciBmcm9tLCBoYW5kbGVyLCBoYW5kbGVycywgaWQsIHJvb21uYW1lLCB4LCB4bWxucywgeHF1ZXJ5LCBfaSwgX2xlbjsKICAgICAgICAgICAgZnJvbSA9IHN0YW56YS5nZXRBdHRyaWJ1dGUoJ2Zyb20nKTsKICAgICAgICAgICAgaWYgKCFmcm9tKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcm9vbW5hbWUgPSBmcm9tLnNwbGl0KCIvIilbMF07CiAgICAgICAgICAgIGlmICghX3RoaXMucm9vbXNbcm9vbW5hbWVdKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcm9vbSA9IF90aGlzLnJvb21zW3Jvb21uYW1lXTsKICAgICAgICAgICAgaGFuZGxlcnMgPSB7fTsKICAgICAgICAgICAgaWYgKHN0YW56YS5ub2RlTmFtZSA9PT0gIm1lc3NhZ2UiKSB7CiAgICAgICAgICAgICAgaGFuZGxlcnMgPSByb29tLl9tZXNzYWdlX2hhbmRsZXJzOwogICAgICAgICAgICB9IGVsc2UgaWYgKHN0YW56YS5ub2RlTmFtZSA9PT0gInByZXNlbmNlIikgewogICAgICAgICAgICAgIHhxdWVyeSA9IHN0YW56YS5nZXRFbGVtZW50c0J5VGFnTmFtZSgieCIpOwogICAgICAgICAgICAgIGlmICh4cXVlcnkubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSB4cXVlcnkubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHsKICAgICAgICAgICAgICAgICAgeCA9IHhxdWVyeVtfaV07CiAgICAgICAgICAgICAgICAgIHhtbG5zID0geC5nZXRBdHRyaWJ1dGUoInhtbG5zIik7CiAgICAgICAgICAgICAgICAgIGlmICh4bWxucyAmJiB4bWxucy5tYXRjaChTdHJvcGhlLk5TLk1VQykpIHsKICAgICAgICAgICAgICAgICAgICBoYW5kbGVycyA9IHJvb20uX3ByZXNlbmNlX2hhbmRsZXJzOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAoaWQgaW4gaGFuZGxlcnMpIHsKICAgICAgICAgICAgICBoYW5kbGVyID0gaGFuZGxlcnNbaWRdOwogICAgICAgICAgICAgIGlmICghaGFuZGxlcihzdGFuemEsIHJvb20pKSB7CiAgICAgICAgICAgICAgICBkZWxldGUgaGFuZGxlcnNbaWRdOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH07CiAgICAgICAgfSkodGhpcykpOwogICAgICB9CiAgICAgIGlmICghdGhpcy5yb29tcy5oYXNPd25Qcm9wZXJ0eShyb29tKSkgewogICAgICAgIHRoaXMucm9vbXNbcm9vbV0gPSBuZXcgWG1wcFJvb20odGhpcywgcm9vbSwgbmljaywgcGFzc3dvcmQpOwogICAgICAgIHRoaXMucm9vbU5hbWVzLnB1c2gocm9vbSk7CiAgICAgIH0KICAgICAgaWYgKHByZXNfaGFuZGxlcl9jYikgewogICAgICAgIHRoaXMucm9vbXNbcm9vbV0uYWRkSGFuZGxlcigncHJlc2VuY2UnLCBwcmVzX2hhbmRsZXJfY2IpOwogICAgICB9CiAgICAgIGlmIChtc2dfaGFuZGxlcl9jYikgewogICAgICAgIHRoaXMucm9vbXNbcm9vbV0uYWRkSGFuZGxlcignbWVzc2FnZScsIG1zZ19oYW5kbGVyX2NiKTsKICAgICAgfQogICAgICBpZiAocm9zdGVyX2NiKSB7CiAgICAgICAgdGhpcy5yb29tc1tyb29tXS5hZGRIYW5kbGVyKCdyb3N0ZXInLCByb3N0ZXJfY2IpOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLl9jb25uZWN0aW9uLnNlbmQobXNnKTsKICAgIH0sCgogICAgLypGdW5jdGlvbgogICAgTGVhdmUgYSBtdWx0aS11c2VyIGNoYXQgcm9vbQogICAgUGFyYW1ldGVyczoKICAgIChTdHJpbmcpIHJvb20gLSBUaGUgbXVsdGktdXNlciBjaGF0IHJvb20gdG8gbGVhdmUuCiAgICAoU3RyaW5nKSBuaWNrIC0gVGhlIG5pY2sgbmFtZSB1c2VkIGluIHRoZSByb29tLgogICAgKEZ1bmN0aW9uKSBoYW5kbGVyX2NiIC0gT3B0aW9uYWwgZnVuY3Rpb24gdG8gaGFuZGxlIHRoZSBzdWNjZXNzZnVsIGxlYXZlLgogICAgKFN0cmluZykgZXhpdF9tc2cgLSBvcHRpb25hbCBleGl0IG1lc3NhZ2UuCiAgICBSZXR1cm5zOgogICAgaXFpZCAtIFRoZSB1bmlxdWUgaWQgZm9yIHRoZSByb29tIGxlYXZlLgogICAgICovCiAgICBsZWF2ZTogZnVuY3Rpb24ocm9vbSwgbmljaywgaGFuZGxlcl9jYiwgZXhpdF9tc2cpIHsKICAgICAgdmFyIGlkLCBwcmVzZW5jZSwgcHJlc2VuY2VpZCwgcm9vbV9uaWNrOwogICAgICBpZCA9IHRoaXMucm9vbU5hbWVzLmluZGV4T2Yocm9vbSk7CiAgICAgIGRlbGV0ZSB0aGlzLnJvb21zW3Jvb21dOwogICAgICBpZiAoaWQgPj0gMCkgewogICAgICAgIHRoaXMucm9vbU5hbWVzLnNwbGljZShpZCwgMSk7CiAgICAgICAgaWYgKHRoaXMucm9vbU5hbWVzLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgdGhpcy5fY29ubmVjdGlvbi5kZWxldGVIYW5kbGVyKHRoaXMuX211Y19oYW5kbGVyKTsKICAgICAgICAgIHRoaXMuX211Y19oYW5kbGVyID0gbnVsbDsKICAgICAgICB9CiAgICAgIH0KICAgICAgcm9vbV9uaWNrID0gdGhpcy50ZXN0X2FwcGVuZF9uaWNrKHJvb20sIG5pY2spOwogICAgICBwcmVzZW5jZWlkID0gdGhpcy5fY29ubmVjdGlvbi5nZXRVbmlxdWVJZCgpOwogICAgICBwcmVzZW5jZSA9ICRwcmVzKHsKICAgICAgICB0eXBlOiAidW5hdmFpbGFibGUiLAogICAgICAgIGlkOiBwcmVzZW5jZWlkLAogICAgICAgIGZyb206IHRoaXMuX2Nvbm5lY3Rpb24uamlkLAogICAgICAgIHRvOiByb29tX25pY2sKICAgICAgfSk7CiAgICAgIGlmIChleGl0X21zZyAhPSBudWxsKSB7CiAgICAgICAgcHJlc2VuY2UuYygic3RhdHVzIiwgZXhpdF9tc2cpOwogICAgICB9CiAgICAgIGlmIChoYW5kbGVyX2NiICE9IG51bGwpIHsKICAgICAgICB0aGlzLl9jb25uZWN0aW9uLmFkZEhhbmRsZXIoaGFuZGxlcl9jYiwgbnVsbCwgInByZXNlbmNlIiwgbnVsbCwgcHJlc2VuY2VpZCk7CiAgICAgIH0KICAgICAgdGhpcy5fY29ubmVjdGlvbi5zZW5kKHByZXNlbmNlKTsKICAgICAgcmV0dXJuIHByZXNlbmNlaWQ7CiAgICB9LAoKICAgIC8qRnVuY3Rpb24KICAgIFBhcmFtZXRlcnM6CiAgICAoU3RyaW5nKSByb29tIC0gVGhlIG11bHRpLXVzZXIgY2hhdCByb29tIG5hbWUuCiAgICAoU3RyaW5nKSBuaWNrIC0gVGhlIG5pY2sgbmFtZSB1c2VkIGluIHRoZSBjaGF0IHJvb20uCiAgICAoU3RyaW5nKSBtZXNzYWdlIC0gVGhlIHBsYWludGV4dCBtZXNzYWdlIHRvIHNlbmQgdG8gdGhlIHJvb20uCiAgICAoU3RyaW5nKSBodG1sX21lc3NhZ2UgLSBUaGUgbWVzc2FnZSB0byBzZW5kIHRvIHRoZSByb29tIHdpdGggaHRtbCBtYXJrdXAuCiAgICAoU3RyaW5nKSB0eXBlIC0gImdyb3VwY2hhdCIgZm9yIGdyb3VwIGNoYXQgbWVzc2FnZXMgbwogICAgICAgICAgICAgICAgICAgICJjaGF0IiBmb3IgcHJpdmF0ZSBjaGF0IG1lc3NhZ2VzCiAgICBSZXR1cm5zOgogICAgbXNnaXEgLSB0aGUgdW5pcXVlIGlkIHVzZWQgdG8gc2VuZCB0aGUgbWVzc2FnZQogICAgICovCiAgICBtZXNzYWdlOiBmdW5jdGlvbihyb29tLCBuaWNrLCBtZXNzYWdlLCBodG1sX21lc3NhZ2UsIHR5cGUsIG1zZ2lkKSB7CiAgICAgIHZhciBtc2csIHBhcmVudCwgcm9vbV9uaWNrOwogICAgICByb29tX25pY2sgPSB0aGlzLnRlc3RfYXBwZW5kX25pY2socm9vbSwgbmljayk7CiAgICAgIHR5cGUgPSB0eXBlIHx8IChuaWNrICE9IG51bGwgPyAiY2hhdCIgOiAiZ3JvdXBjaGF0Iik7CiAgICAgIG1zZ2lkID0gbXNnaWQgfHwgdGhpcy5fY29ubmVjdGlvbi5nZXRVbmlxdWVJZCgpOwogICAgICBtc2cgPSAkbXNnKHsKICAgICAgICB0bzogcm9vbV9uaWNrLAogICAgICAgIGZyb206IHRoaXMuX2Nvbm5lY3Rpb24uamlkLAogICAgICAgIHR5cGU6IHR5cGUsCiAgICAgICAgaWQ6IG1zZ2lkCiAgICAgIH0pLmMoImJvZHkiLCB7CiAgICAgICAgeG1sbnM6IFN0cm9waGUuTlMuQ0xJRU5UCiAgICAgIH0pLnQobWVzc2FnZSk7CiAgICAgIG1zZy51cCgpOwogICAgICBpZiAoaHRtbF9tZXNzYWdlICE9IG51bGwpIHsKICAgICAgICBtc2cuYygiaHRtbCIsIHsKICAgICAgICAgIHhtbG5zOiBTdHJvcGhlLk5TLlhIVE1MX0lNCiAgICAgICAgfSkuYygiYm9keSIsIHsKICAgICAgICAgIHhtbG5zOiBTdHJvcGhlLk5TLlhIVE1MCiAgICAgICAgfSkuaChodG1sX21lc3NhZ2UpOwogICAgICAgIGlmIChtc2cubm9kZS5jaGlsZE5vZGVzLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgcGFyZW50ID0gbXNnLm5vZGUucGFyZW50Tm9kZTsKICAgICAgICAgIG1zZy51cCgpLnVwKCk7CiAgICAgICAgICBtc2cubm9kZS5yZW1vdmVDaGlsZChwYXJlbnQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBtc2cudXAoKS51cCgpOwogICAgICAgIH0KICAgICAgfQogICAgICBtc2cuYygieCIsIHsKICAgICAgICB4bWxuczogImphYmJlcjp4OmV2ZW50IgogICAgICB9KS5jKCJjb21wb3NpbmciKTsKICAgICAgdGhpcy5fY29ubmVjdGlvbi5zZW5kKG1zZyk7CiAgICAgIHJldHVybiBtc2dpZDsKICAgIH0sCgogICAgLypGdW5jdGlvbgogICAgQ29udmVuaWVuY2UgRnVuY3Rpb24gdG8gc2VuZCBhIE1lc3NhZ2UgdG8gYWxsIE9jY3VwYW50cwogICAgUGFyYW1ldGVyczoKICAgIChTdHJpbmcpIHJvb20gLSBUaGUgbXVsdGktdXNlciBjaGF0IHJvb20gbmFtZS4KICAgIChTdHJpbmcpIG1lc3NhZ2UgLSBUaGUgcGxhaW50ZXh0IG1lc3NhZ2UgdG8gc2VuZCB0byB0aGUgcm9vbS4KICAgIChTdHJpbmcpIGh0bWxfbWVzc2FnZSAtIFRoZSBtZXNzYWdlIHRvIHNlbmQgdG8gdGhlIHJvb20gd2l0aCBodG1sIG1hcmt1cC4KICAgIChTdHJpbmcpIG1zZ2lkIC0gT3B0aW9uYWwgdW5pcXVlIElEIHdoaWNoIHdpbGwgYmUgc2V0IGFzIHRoZSAnaWQnIGF0dHJpYnV0ZSBvZiB0aGUgc3RhbnphCiAgICBSZXR1cm5zOgogICAgbXNnaXEgLSB0aGUgdW5pcXVlIGlkIHVzZWQgdG8gc2VuZCB0aGUgbWVzc2FnZQogICAgICovCiAgICBncm91cGNoYXQ6IGZ1bmN0aW9uKHJvb20sIG1lc3NhZ2UsIGh0bWxfbWVzc2FnZSwgbXNnaWQpIHsKICAgICAgcmV0dXJuIHRoaXMubWVzc2FnZShyb29tLCBudWxsLCBtZXNzYWdlLCBodG1sX21lc3NhZ2UsIHZvaWQgMCwgbXNnaWQpOwogICAgfSwKCiAgICAvKkZ1bmN0aW9uCiAgICBTZW5kIGEgbWVkaWF0ZWQgaW52aXRhdGlvbi4KICAgIFBhcmFtZXRlcnM6CiAgICAoU3RyaW5nKSByb29tIC0gVGhlIG11bHRpLXVzZXIgY2hhdCByb29tIG5hbWUuCiAgICAoU3RyaW5nKSByZWNlaXZlciAtIFRoZSBpbnZpdGF0aW9uJ3MgcmVjZWl2ZXIuCiAgICAoU3RyaW5nKSByZWFzb24gLSBPcHRpb25hbCByZWFzb24gZm9yIGpvaW5pbmcgdGhlIHJvb20uCiAgICBSZXR1cm5zOgogICAgbXNnaXEgLSB0aGUgdW5pcXVlIGlkIHVzZWQgdG8gc2VuZCB0aGUgaW52aXRhdGlvbgogICAgICovCiAgICBpbnZpdGU6IGZ1bmN0aW9uKHJvb20sIHJlY2VpdmVyLCByZWFzb24pIHsKICAgICAgdmFyIGludml0YXRpb24sIG1zZ2lkOwogICAgICBtc2dpZCA9IHRoaXMuX2Nvbm5lY3Rpb24uZ2V0VW5pcXVlSWQoKTsKICAgICAgaW52aXRhdGlvbiA9ICRtc2coewogICAgICAgIGZyb206IHRoaXMuX2Nvbm5lY3Rpb24uamlkLAogICAgICAgIHRvOiByb29tLAogICAgICAgIGlkOiBtc2dpZAogICAgICB9KS5jKCd4JywgewogICAgICAgIHhtbG5zOiBTdHJvcGhlLk5TLk1VQ19VU0VSCiAgICAgIH0pLmMoJ2ludml0ZScsIHsKICAgICAgICB0bzogcmVjZWl2ZXIKICAgICAgfSk7CiAgICAgIGlmIChyZWFzb24gIT0gbnVsbCkgewogICAgICAgIGludml0YXRpb24uYygncmVhc29uJywgcmVhc29uKTsKICAgICAgfQogICAgICB0aGlzLl9jb25uZWN0aW9uLnNlbmQoaW52aXRhdGlvbik7CiAgICAgIHJldHVybiBtc2dpZDsKICAgIH0sCgogICAgLypGdW5jdGlvbgogICAgU2VuZCBhIG1lZGlhdGVkIG11bHRpcGxlIGludml0YXRpb24uCiAgICBQYXJhbWV0ZXJzOgogICAgKFN0cmluZykgcm9vbSAtIFRoZSBtdWx0aS11c2VyIGNoYXQgcm9vbSBuYW1lLgogICAgKEFycmF5KSByZWNlaXZlcnMgLSBUaGUgaW52aXRhdGlvbidzIHJlY2VpdmVycy4KICAgIChTdHJpbmcpIHJlYXNvbiAtIE9wdGlvbmFsIHJlYXNvbiBmb3Igam9pbmluZyB0aGUgcm9vbS4KICAgIFJldHVybnM6CiAgICBtc2dpcSAtIHRoZSB1bmlxdWUgaWQgdXNlZCB0byBzZW5kIHRoZSBpbnZpdGF0aW9uCiAgICAgKi8KICAgIG11bHRpcGxlSW52aXRlczogZnVuY3Rpb24ocm9vbSwgcmVjZWl2ZXJzLCByZWFzb24pIHsKICAgICAgdmFyIGludml0YXRpb24sIG1zZ2lkLCByZWNlaXZlciwgX2ksIF9sZW47CiAgICAgIG1zZ2lkID0gdGhpcy5fY29ubmVjdGlvbi5nZXRVbmlxdWVJZCgpOwogICAgICBpbnZpdGF0aW9uID0gJG1zZyh7CiAgICAgICAgZnJvbTogdGhpcy5fY29ubmVjdGlvbi5qaWQsCiAgICAgICAgdG86IHJvb20sCiAgICAgICAgaWQ6IG1zZ2lkCiAgICAgIH0pLmMoJ3gnLCB7CiAgICAgICAgeG1sbnM6IFN0cm9waGUuTlMuTVVDX1VTRVIKICAgICAgfSk7CiAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gcmVjZWl2ZXJzLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7CiAgICAgICAgcmVjZWl2ZXIgPSByZWNlaXZlcnNbX2ldOwogICAgICAgIGludml0YXRpb24uYygnaW52aXRlJywgewogICAgICAgICAgdG86IHJlY2VpdmVyCiAgICAgICAgfSk7CiAgICAgICAgaWYgKHJlYXNvbiAhPSBudWxsKSB7CiAgICAgICAgICBpbnZpdGF0aW9uLmMoJ3JlYXNvbicsIHJlYXNvbik7CiAgICAgICAgICBpbnZpdGF0aW9uLnVwKCk7CiAgICAgICAgfQogICAgICAgIGludml0YXRpb24udXAoKTsKICAgICAgfQogICAgICB0aGlzLl9jb25uZWN0aW9uLnNlbmQoaW52aXRhdGlvbik7CiAgICAgIHJldHVybiBtc2dpZDsKICAgIH0sCgogICAgLypGdW5jdGlvbgogICAgU2VuZCBhIGRpcmVjdCBpbnZpdGF0aW9uLgogICAgUGFyYW1ldGVyczoKICAgIChTdHJpbmcpIHJvb20gLSBUaGUgbXVsdGktdXNlciBjaGF0IHJvb20gbmFtZS4KICAgIChTdHJpbmcpIHJlY2VpdmVyIC0gVGhlIGludml0YXRpb24ncyByZWNlaXZlci4KICAgIChTdHJpbmcpIHJlYXNvbiAtIE9wdGlvbmFsIHJlYXNvbiBmb3Igam9pbmluZyB0aGUgcm9vbS4KICAgIChTdHJpbmcpIHBhc3N3b3JkIC0gT3B0aW9uYWwgcGFzc3dvcmQgZm9yIHRoZSByb29tLgogICAgUmV0dXJuczoKICAgIG1zZ2lxIC0gdGhlIHVuaXF1ZSBpZCB1c2VkIHRvIHNlbmQgdGhlIGludml0YXRpb24KICAgICAqLwogICAgZGlyZWN0SW52aXRlOiBmdW5jdGlvbihyb29tLCByZWNlaXZlciwgcmVhc29uLCBwYXNzd29yZCkgewogICAgICB2YXIgYXR0cnMsIGludml0YXRpb24sIG1zZ2lkOwogICAgICBtc2dpZCA9IHRoaXMuX2Nvbm5lY3Rpb24uZ2V0VW5pcXVlSWQoKTsKICAgICAgYXR0cnMgPSB7CiAgICAgICAgeG1sbnM6ICdqYWJiZXI6eDpjb25mZXJlbmNlJywKICAgICAgICBqaWQ6IHJvb20KICAgICAgfTsKICAgICAgaWYgKHJlYXNvbiAhPSBudWxsKSB7CiAgICAgICAgYXR0cnMucmVhc29uID0gcmVhc29uOwogICAgICB9CiAgICAgIGlmIChwYXNzd29yZCAhPSBudWxsKSB7CiAgICAgICAgYXR0cnMucGFzc3dvcmQgPSBwYXNzd29yZDsKICAgICAgfQogICAgICBpbnZpdGF0aW9uID0gJG1zZyh7CiAgICAgICAgZnJvbTogdGhpcy5fY29ubmVjdGlvbi5qaWQsCiAgICAgICAgdG86IHJlY2VpdmVyLAogICAgICAgIGlkOiBtc2dpZAogICAgICB9KS5jKCd4JywgYXR0cnMpOwogICAgICB0aGlzLl9jb25uZWN0aW9uLnNlbmQoaW52aXRhdGlvbik7CiAgICAgIHJldHVybiBtc2dpZDsKICAgIH0sCgogICAgLypGdW5jdGlvbgogICAgUXVlcmllcyBhIHJvb20gZm9yIGEgbGlzdCBvZiBvY2N1cGFudHMKICAgIChTdHJpbmcpIHJvb20gLSBUaGUgbXVsdGktdXNlciBjaGF0IHJvb20gbmFtZS4KICAgIChGdW5jdGlvbikgc3VjY2Vzc19jYiAtIE9wdGlvbmFsIGZ1bmN0aW9uIHRvIGhhbmRsZSB0aGUgaW5mby4KICAgIChGdW5jdGlvbikgZXJyb3JfY2IgLSBPcHRpb25hbCBmdW5jdGlvbiB0byBoYW5kbGUgYW4gZXJyb3IuCiAgICBSZXR1cm5zOgogICAgaWQgLSB0aGUgdW5pcXVlIGlkIHVzZWQgdG8gc2VuZCB0aGUgaW5mbyByZXF1ZXN0CiAgICAgKi8KICAgIHF1ZXJ5T2NjdXBhbnRzOiBmdW5jdGlvbihyb29tLCBzdWNjZXNzX2NiLCBlcnJvcl9jYikgewogICAgICB2YXIgYXR0cnMsIGluZm87CiAgICAgIGF0dHJzID0gewogICAgICAgIHhtbG5zOiBTdHJvcGhlLk5TLkRJU0NPX0lURU1TCiAgICAgIH07CiAgICAgIGluZm8gPSAkaXEoewogICAgICAgIGZyb206IHRoaXMuX2Nvbm5lY3Rpb24uamlkLAogICAgICAgIHRvOiByb29tLAogICAgICAgIHR5cGU6ICdnZXQnCiAgICAgIH0pLmMoJ3F1ZXJ5JywgYXR0cnMpOwogICAgICByZXR1cm4gdGhpcy5fY29ubmVjdGlvbi5zZW5kSVEoaW5mbywgc3VjY2Vzc19jYiwgZXJyb3JfY2IpOwogICAgfSwKCiAgICAvKkZ1bmN0aW9uCiAgICBTdGFydCBhIHJvb20gY29uZmlndXJhdGlvbi4KICAgIFBhcmFtZXRlcnM6CiAgICAoU3RyaW5nKSByb29tIC0gVGhlIG11bHRpLXVzZXIgY2hhdCByb29tIG5hbWUuCiAgICAoRnVuY3Rpb24pIGhhbmRsZXJfY2IgLSBPcHRpb25hbCBmdW5jdGlvbiB0byBoYW5kbGUgdGhlIGNvbmZpZyBmb3JtLgogICAgUmV0dXJuczoKICAgIGlkIC0gdGhlIHVuaXF1ZSBpZCB1c2VkIHRvIHNlbmQgdGhlIGNvbmZpZ3VyYXRpb24gcmVxdWVzdAogICAgICovCiAgICBjb25maWd1cmU6IGZ1bmN0aW9uKHJvb20sIGhhbmRsZXJfY2IsIGVycm9yX2NiKSB7CiAgICAgIHZhciBjb25maWcsIHN0YW56YTsKICAgICAgY29uZmlnID0gJGlxKHsKICAgICAgICB0bzogcm9vbSwKICAgICAgICB0eXBlOiAiZ2V0IgogICAgICB9KS5jKCJxdWVyeSIsIHsKICAgICAgICB4bWxuczogU3Ryb3BoZS5OUy5NVUNfT1dORVIKICAgICAgfSk7CiAgICAgIHN0YW56YSA9IGNvbmZpZy50cmVlKCk7CiAgICAgIHJldHVybiB0aGlzLl9jb25uZWN0aW9uLnNlbmRJUShzdGFuemEsIGhhbmRsZXJfY2IsIGVycm9yX2NiKTsKICAgIH0sCgogICAgLypGdW5jdGlvbgogICAgQ2FuY2VsIHRoZSByb29tIGNvbmZpZ3VyYXRpb24KICAgIFBhcmFtZXRlcnM6CiAgICAoU3RyaW5nKSByb29tIC0gVGhlIG11bHRpLXVzZXIgY2hhdCByb29tIG5hbWUuCiAgICBSZXR1cm5zOgogICAgaWQgLSB0aGUgdW5pcXVlIGlkIHVzZWQgdG8gY2FuY2VsIHRoZSBjb25maWd1cmF0aW9uLgogICAgICovCiAgICBjYW5jZWxDb25maWd1cmU6IGZ1bmN0aW9uKHJvb20pIHsKICAgICAgdmFyIGNvbmZpZywgc3RhbnphOwogICAgICBjb25maWcgPSAkaXEoewogICAgICAgIHRvOiByb29tLAogICAgICAgIHR5cGU6ICJzZXQiCiAgICAgIH0pLmMoInF1ZXJ5IiwgewogICAgICAgIHhtbG5zOiBTdHJvcGhlLk5TLk1VQ19PV05FUgogICAgICB9KS5jKCJ4IiwgewogICAgICAgIHhtbG5zOiAiamFiYmVyOng6ZGF0YSIsCiAgICAgICAgdHlwZTogImNhbmNlbCIKICAgICAgfSk7CiAgICAgIHN0YW56YSA9IGNvbmZpZy50cmVlKCk7CiAgICAgIHJldHVybiB0aGlzLl9jb25uZWN0aW9uLnNlbmRJUShzdGFuemEpOwogICAgfSwKCiAgICAvKkZ1bmN0aW9uCiAgICBTYXZlIGEgcm9vbSBjb25maWd1cmF0aW9uLgogICAgUGFyYW1ldGVyczoKICAgIChTdHJpbmcpIHJvb20gLSBUaGUgbXVsdGktdXNlciBjaGF0IHJvb20gbmFtZS4KICAgIChBcnJheSkgY29uZmlnLSBGb3JtIE9iamVjdCBvciBhbiBhcnJheSBvZiBmb3JtIGVsZW1lbnRzIHVzZWQgdG8gY29uZmlndXJlIHRoZSByb29tLgogICAgUmV0dXJuczoKICAgIGlkIC0gdGhlIHVuaXF1ZSBpZCB1c2VkIHRvIHNhdmUgdGhlIGNvbmZpZ3VyYXRpb24uCiAgICAgKi8KICAgIHNhdmVDb25maWd1cmF0aW9uOiBmdW5jdGlvbihyb29tLCBjb25maWcsIHN1Y2Nlc3NfY2IsIGVycm9yX2NiKSB7CiAgICAgIHZhciBjb25mLCBpcSwgc3RhbnphLCBfaSwgX2xlbjsKICAgICAgaXEgPSAkaXEoewogICAgICAgIHRvOiByb29tLAogICAgICAgIHR5cGU6ICJzZXQiCiAgICAgIH0pLmMoInF1ZXJ5IiwgewogICAgICAgIHhtbG5zOiBTdHJvcGhlLk5TLk1VQ19PV05FUgogICAgICB9KTsKICAgICAgaWYgKHR5cGVvZiBGb3JtICE9PSAidW5kZWZpbmVkIiAmJiBjb25maWcgaW5zdGFuY2VvZiBGb3JtKSB7CiAgICAgICAgY29uZmlnLnR5cGUgPSAic3VibWl0IjsKICAgICAgICBpcS5jbm9kZShjb25maWcudG9YTUwoKSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaXEuYygieCIsIHsKICAgICAgICAgIHhtbG5zOiAiamFiYmVyOng6ZGF0YSIsCiAgICAgICAgICB0eXBlOiAic3VibWl0IgogICAgICAgIH0pOwogICAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gY29uZmlnLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7CiAgICAgICAgICBjb25mID0gY29uZmlnW19pXTsKICAgICAgICAgIGlxLmNub2RlKGNvbmYpLnVwKCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHN0YW56YSA9IGlxLnRyZWUoKTsKICAgICAgcmV0dXJuIHRoaXMuX2Nvbm5lY3Rpb24uc2VuZElRKHN0YW56YSwgc3VjY2Vzc19jYiwgZXJyb3JfY2IpOwogICAgfSwKCiAgICAvKkZ1bmN0aW9uCiAgICBQYXJhbWV0ZXJzOgogICAgKFN0cmluZykgcm9vbSAtIFRoZSBtdWx0aS11c2VyIGNoYXQgcm9vbSBuYW1lLgogICAgUmV0dXJuczoKICAgIGlkIC0gdGhlIHVuaXF1ZSBpZCB1c2VkIHRvIGNyZWF0ZSB0aGUgY2hhdCByb29tLgogICAgICovCiAgICBjcmVhdGVJbnN0YW50Um9vbTogZnVuY3Rpb24ocm9vbSwgc3VjY2Vzc19jYiwgZXJyb3JfY2IpIHsKICAgICAgdmFyIHJvb21pcTsKICAgICAgcm9vbWlxID0gJGlxKHsKICAgICAgICB0bzogcm9vbSwKICAgICAgICB0eXBlOiAic2V0IgogICAgICB9KS5jKCJxdWVyeSIsIHsKICAgICAgICB4bWxuczogU3Ryb3BoZS5OUy5NVUNfT1dORVIKICAgICAgfSkuYygieCIsIHsKICAgICAgICB4bWxuczogImphYmJlcjp4OmRhdGEiLAogICAgICAgIHR5cGU6ICJzdWJtaXQiCiAgICAgIH0pOwogICAgICByZXR1cm4gdGhpcy5fY29ubmVjdGlvbi5zZW5kSVEocm9vbWlxLnRyZWUoKSwgc3VjY2Vzc19jYiwgZXJyb3JfY2IpOwogICAgfSwKCiAgICAvKkZ1bmN0aW9uCiAgICBQYXJhbWV0ZXJzOgogICAgKFN0cmluZykgcm9vbSAtIFRoZSBtdWx0aS11c2VyIGNoYXQgcm9vbSBuYW1lLgogICAgKE9iamVjdCkgY29uZmlnIC0gdGhlIGNvbmZpZ3VyYXRpb24uIGV4OiB7Im11YyNyb29tY29uZmlnX3B1YmxpY3Jvb20iOiAiMCIsICJtdWMjcm9vbWNvbmZpZ19wZXJzaXN0ZW50cm9vbSI6ICIxIn0KICAgIFJldHVybnM6CiAgICBpZCAtIHRoZSB1bmlxdWUgaWQgdXNlZCB0byBjcmVhdGUgdGhlIGNoYXQgcm9vbS4KICAgICAqLwogICAgY3JlYXRlQ29uZmlndXJlZFJvb206IGZ1bmN0aW9uKHJvb20sIGNvbmZpZywgc3VjY2Vzc19jYiwgZXJyb3JfY2IpIHsKICAgICAgdmFyIGssIHJvb21pcSwgdjsKICAgICAgcm9vbWlxID0gJGlxKHsKICAgICAgICB0bzogcm9vbSwKICAgICAgICB0eXBlOiAic2V0IgogICAgICB9KS5jKCJxdWVyeSIsIHsKICAgICAgICB4bWxuczogU3Ryb3BoZS5OUy5NVUNfT1dORVIKICAgICAgfSkuYygieCIsIHsKICAgICAgICB4bWxuczogImphYmJlcjp4OmRhdGEiLAogICAgICAgIHR5cGU6ICJzdWJtaXQiCiAgICAgIH0pOwogICAgICByb29taXEuYygnZmllbGQnLCB7CiAgICAgICAgJ3Zhcic6ICdGT1JNX1RZUEUnCiAgICAgIH0pLmMoJ3ZhbHVlJykudCgnaHR0cDovL2phYmJlci5vcmcvcHJvdG9jb2wvbXVjI3Jvb21jb25maWcnKS51cCgpLnVwKCk7CiAgICAgIGZvciAoayBpbiBjb25maWcpIHsKICAgICAgICBpZiAoIV9faGFzUHJvcC5jYWxsKGNvbmZpZywgaykpIGNvbnRpbnVlOwogICAgICAgIHYgPSBjb25maWdba107CiAgICAgICAgcm9vbWlxLmMoJ2ZpZWxkJywgewogICAgICAgICAgJ3Zhcic6IGsKICAgICAgICB9KS5jKCd2YWx1ZScpLnQodikudXAoKS51cCgpOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLl9jb25uZWN0aW9uLnNlbmRJUShyb29taXEudHJlZSgpLCBzdWNjZXNzX2NiLCBlcnJvcl9jYik7CiAgICB9LAoKICAgIC8qRnVuY3Rpb24KICAgIFNldCB0aGUgdG9waWMgb2YgdGhlIGNoYXQgcm9vbS4KICAgIFBhcmFtZXRlcnM6CiAgICAoU3RyaW5nKSByb29tIC0gVGhlIG11bHRpLXVzZXIgY2hhdCByb29tIG5hbWUuCiAgICAoU3RyaW5nKSB0b3BpYyAtIFRvcGljIG1lc3NhZ2UuCiAgICAgKi8KICAgIHNldFRvcGljOiBmdW5jdGlvbihyb29tLCB0b3BpYykgewogICAgICB2YXIgbXNnOwogICAgICBtc2cgPSAkbXNnKHsKICAgICAgICB0bzogcm9vbSwKICAgICAgICBmcm9tOiB0aGlzLl9jb25uZWN0aW9uLmppZCwKICAgICAgICB0eXBlOiAiZ3JvdXBjaGF0IgogICAgICB9KS5jKCJzdWJqZWN0IiwgewogICAgICAgIHhtbG5zOiAiamFiYmVyOmNsaWVudCIKICAgICAgfSkudCh0b3BpYyk7CiAgICAgIHJldHVybiB0aGlzLl9jb25uZWN0aW9uLnNlbmQobXNnLnRyZWUoKSk7CiAgICB9LAoKICAgIC8qRnVuY3Rpb24KICAgIEludGVybmFsIEZ1bmN0aW9uIHRoYXQgQ2hhbmdlcyB0aGUgcm9sZSBvciBhZmZpbGlhdGlvbiBvZiBhIG1lbWJlcgogICAgb2YgYSBNVUMgcm9vbS4gVGhpcyBmdW5jdGlvbiBpcyB1c2VkIGJ5IG1vZGlmeVJvbGUgYW5kIG1vZGlmeUFmZmlsaWF0aW9uLgogICAgVGhlIG1vZGlmaWNhdGlvbiBjYW4gb25seSBiZSBkb25lIGJ5IGEgcm9vbSBtb2RlcmF0b3IuIEFuIGVycm9yIHdpbGwgYmUKICAgIHJldHVybmVkIGlmIHRoZSB1c2VyIGRvZXNuJ3QgaGF2ZSBwZXJtaXNzaW9uLgogICAgUGFyYW1ldGVyczoKICAgIChTdHJpbmcpIHJvb20gLSBUaGUgbXVsdGktdXNlciBjaGF0IHJvb20gbmFtZS4KICAgIChPYmplY3QpIGl0ZW0gLSBPYmplY3Qgd2l0aCBuaWNrIGFuZCByb2xlIG9yIGppZCBhbmQgYWZmaWxpYXRpb24gYXR0cmlidXRlCiAgICAoU3RyaW5nKSByZWFzb24gLSBPcHRpb25hbCByZWFzb24gZm9yIHRoZSBjaGFuZ2UuCiAgICAoRnVuY3Rpb24pIGhhbmRsZXJfY2IgLSBPcHRpb25hbCBjYWxsYmFjayBmb3Igc3VjY2VzcwogICAgKEZ1bmN0aW9uKSBlcnJvcl9jYiAtIE9wdGlvbmFsIGNhbGxiYWNrIGZvciBlcnJvcgogICAgUmV0dXJuczoKICAgIGlxIC0gdGhlIGlkIG9mIHRoZSBtb2RlIGNoYW5nZSByZXF1ZXN0LgogICAgICovCiAgICBfbW9kaWZ5UHJpdmlsZWdlOiBmdW5jdGlvbihyb29tLCBpdGVtLCByZWFzb24sIGhhbmRsZXJfY2IsIGVycm9yX2NiKSB7CiAgICAgIHZhciBpcTsKICAgICAgaXEgPSAkaXEoewogICAgICAgIHRvOiByb29tLAogICAgICAgIHR5cGU6ICJzZXQiCiAgICAgIH0pLmMoInF1ZXJ5IiwgewogICAgICAgIHhtbG5zOiBTdHJvcGhlLk5TLk1VQ19BRE1JTgogICAgICB9KS5jbm9kZShpdGVtLm5vZGUpOwogICAgICBpZiAocmVhc29uICE9IG51bGwpIHsKICAgICAgICBpcS5jKCJyZWFzb24iLCByZWFzb24pOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLl9jb25uZWN0aW9uLnNlbmRJUShpcS50cmVlKCksIGhhbmRsZXJfY2IsIGVycm9yX2NiKTsKICAgIH0sCgogICAgLypGdW5jdGlvbgogICAgQ2hhbmdlcyB0aGUgcm9sZSBvZiBhIG1lbWJlciBvZiBhIE1VQyByb29tLgogICAgVGhlIG1vZGlmaWNhdGlvbiBjYW4gb25seSBiZSBkb25lIGJ5IGEgcm9vbSBtb2RlcmF0b3IuIEFuIGVycm9yIHdpbGwgYmUKICAgIHJldHVybmVkIGlmIHRoZSB1c2VyIGRvZXNuJ3QgaGF2ZSBwZXJtaXNzaW9uLgogICAgUGFyYW1ldGVyczoKICAgIChTdHJpbmcpIHJvb20gLSBUaGUgbXVsdGktdXNlciBjaGF0IHJvb20gbmFtZS4KICAgIChTdHJpbmcpIG5pY2sgLSBUaGUgbmljayBuYW1lIG9mIHRoZSB1c2VyIHRvIG1vZGlmeS4KICAgIChTdHJpbmcpIHJvbGUgLSBUaGUgbmV3IHJvbGUgb2YgdGhlIHVzZXIuCiAgICAoU3RyaW5nKSBhZmZpbGlhdGlvbiAtIFRoZSBuZXcgYWZmaWxpYXRpb24gb2YgdGhlIHVzZXIuCiAgICAoU3RyaW5nKSByZWFzb24gLSBPcHRpb25hbCByZWFzb24gZm9yIHRoZSBjaGFuZ2UuCiAgICAoRnVuY3Rpb24pIGhhbmRsZXJfY2IgLSBPcHRpb25hbCBjYWxsYmFjayBmb3Igc3VjY2VzcwogICAgKEZ1bmN0aW9uKSBlcnJvcl9jYiAtIE9wdGlvbmFsIGNhbGxiYWNrIGZvciBlcnJvcgogICAgUmV0dXJuczoKICAgIGlxIC0gdGhlIGlkIG9mIHRoZSBtb2RlIGNoYW5nZSByZXF1ZXN0LgogICAgICovCiAgICBtb2RpZnlSb2xlOiBmdW5jdGlvbihyb29tLCBuaWNrLCByb2xlLCByZWFzb24sIGhhbmRsZXJfY2IsIGVycm9yX2NiKSB7CiAgICAgIHZhciBpdGVtOwogICAgICBpdGVtID0gJGJ1aWxkKCJpdGVtIiwgewogICAgICAgIG5pY2s6IG5pY2ssCiAgICAgICAgcm9sZTogcm9sZQogICAgICB9KTsKICAgICAgcmV0dXJuIHRoaXMuX21vZGlmeVByaXZpbGVnZShyb29tLCBpdGVtLCByZWFzb24sIGhhbmRsZXJfY2IsIGVycm9yX2NiKTsKICAgIH0sCiAgICBraWNrOiBmdW5jdGlvbihyb29tLCBuaWNrLCByZWFzb24sIGhhbmRsZXJfY2IsIGVycm9yX2NiKSB7CiAgICAgIHJldHVybiB0aGlzLm1vZGlmeVJvbGUocm9vbSwgbmljaywgJ25vbmUnLCByZWFzb24sIGhhbmRsZXJfY2IsIGVycm9yX2NiKTsKICAgIH0sCiAgICB2b2ljZTogZnVuY3Rpb24ocm9vbSwgbmljaywgcmVhc29uLCBoYW5kbGVyX2NiLCBlcnJvcl9jYikgewogICAgICByZXR1cm4gdGhpcy5tb2RpZnlSb2xlKHJvb20sIG5pY2ssICdwYXJ0aWNpcGFudCcsIHJlYXNvbiwgaGFuZGxlcl9jYiwgZXJyb3JfY2IpOwogICAgfSwKICAgIG11dGU6IGZ1bmN0aW9uKHJvb20sIG5pY2ssIHJlYXNvbiwgaGFuZGxlcl9jYiwgZXJyb3JfY2IpIHsKICAgICAgcmV0dXJuIHRoaXMubW9kaWZ5Um9sZShyb29tLCBuaWNrLCAndmlzaXRvcicsIHJlYXNvbiwgaGFuZGxlcl9jYiwgZXJyb3JfY2IpOwogICAgfSwKICAgIG9wOiBmdW5jdGlvbihyb29tLCBuaWNrLCByZWFzb24sIGhhbmRsZXJfY2IsIGVycm9yX2NiKSB7CiAgICAgIHJldHVybiB0aGlzLm1vZGlmeVJvbGUocm9vbSwgbmljaywgJ21vZGVyYXRvcicsIHJlYXNvbiwgaGFuZGxlcl9jYiwgZXJyb3JfY2IpOwogICAgfSwKICAgIGRlb3A6IGZ1bmN0aW9uKHJvb20sIG5pY2ssIHJlYXNvbiwgaGFuZGxlcl9jYiwgZXJyb3JfY2IpIHsKICAgICAgcmV0dXJuIHRoaXMubW9kaWZ5Um9sZShyb29tLCBuaWNrLCAncGFydGljaXBhbnQnLCByZWFzb24sIGhhbmRsZXJfY2IsIGVycm9yX2NiKTsKICAgIH0sCgogICAgLypGdW5jdGlvbgogICAgQ2hhbmdlcyB0aGUgYWZmaWxpYXRpb24gb2YgYSBtZW1iZXIgb2YgYSBNVUMgcm9vbS4KICAgIFRoZSBtb2RpZmljYXRpb24gY2FuIG9ubHkgYmUgZG9uZSBieSBhIHJvb20gbW9kZXJhdG9yLiBBbiBlcnJvciB3aWxsIGJlCiAgICByZXR1cm5lZCBpZiB0aGUgdXNlciBkb2Vzbid0IGhhdmUgcGVybWlzc2lvbi4KICAgIFBhcmFtZXRlcnM6CiAgICAoU3RyaW5nKSByb29tIC0gVGhlIG11bHRpLXVzZXIgY2hhdCByb29tIG5hbWUuCiAgICAoU3RyaW5nKSBqaWQgIC0gVGhlIGppZCBvZiB0aGUgdXNlciB0byBtb2RpZnkuCiAgICAoU3RyaW5nKSBhZmZpbGlhdGlvbiAtIFRoZSBuZXcgYWZmaWxpYXRpb24gb2YgdGhlIHVzZXIuCiAgICAoU3RyaW5nKSByZWFzb24gLSBPcHRpb25hbCByZWFzb24gZm9yIHRoZSBjaGFuZ2UuCiAgICAoRnVuY3Rpb24pIGhhbmRsZXJfY2IgLSBPcHRpb25hbCBjYWxsYmFjayBmb3Igc3VjY2VzcwogICAgKEZ1bmN0aW9uKSBlcnJvcl9jYiAtIE9wdGlvbmFsIGNhbGxiYWNrIGZvciBlcnJvcgogICAgUmV0dXJuczoKICAgIGlxIC0gdGhlIGlkIG9mIHRoZSBtb2RlIGNoYW5nZSByZXF1ZXN0LgogICAgICovCiAgICBtb2RpZnlBZmZpbGlhdGlvbjogZnVuY3Rpb24ocm9vbSwgamlkLCBhZmZpbGlhdGlvbiwgcmVhc29uLCBoYW5kbGVyX2NiLCBlcnJvcl9jYikgewogICAgICB2YXIgaXRlbTsKICAgICAgaXRlbSA9ICRidWlsZCgiaXRlbSIsIHsKICAgICAgICBqaWQ6IGppZCwKICAgICAgICBhZmZpbGlhdGlvbjogYWZmaWxpYXRpb24KICAgICAgfSk7CiAgICAgIHJldHVybiB0aGlzLl9tb2RpZnlQcml2aWxlZ2Uocm9vbSwgaXRlbSwgcmVhc29uLCBoYW5kbGVyX2NiLCBlcnJvcl9jYik7CiAgICB9LAogICAgYmFuOiBmdW5jdGlvbihyb29tLCBqaWQsIHJlYXNvbiwgaGFuZGxlcl9jYiwgZXJyb3JfY2IpIHsKICAgICAgcmV0dXJuIHRoaXMubW9kaWZ5QWZmaWxpYXRpb24ocm9vbSwgamlkLCAnb3V0Y2FzdCcsIHJlYXNvbiwgaGFuZGxlcl9jYiwgZXJyb3JfY2IpOwogICAgfSwKICAgIG1lbWJlcjogZnVuY3Rpb24ocm9vbSwgamlkLCByZWFzb24sIGhhbmRsZXJfY2IsIGVycm9yX2NiKSB7CiAgICAgIHJldHVybiB0aGlzLm1vZGlmeUFmZmlsaWF0aW9uKHJvb20sIGppZCwgJ21lbWJlcicsIHJlYXNvbiwgaGFuZGxlcl9jYiwgZXJyb3JfY2IpOwogICAgfSwKICAgIHJldm9rZTogZnVuY3Rpb24ocm9vbSwgamlkLCByZWFzb24sIGhhbmRsZXJfY2IsIGVycm9yX2NiKSB7CiAgICAgIHJldHVybiB0aGlzLm1vZGlmeUFmZmlsaWF0aW9uKHJvb20sIGppZCwgJ25vbmUnLCByZWFzb24sIGhhbmRsZXJfY2IsIGVycm9yX2NiKTsKICAgIH0sCiAgICBvd25lcjogZnVuY3Rpb24ocm9vbSwgamlkLCByZWFzb24sIGhhbmRsZXJfY2IsIGVycm9yX2NiKSB7CiAgICAgIHJldHVybiB0aGlzLm1vZGlmeUFmZmlsaWF0aW9uKHJvb20sIGppZCwgJ293bmVyJywgcmVhc29uLCBoYW5kbGVyX2NiLCBlcnJvcl9jYik7CiAgICB9LAogICAgYWRtaW46IGZ1bmN0aW9uKHJvb20sIGppZCwgcmVhc29uLCBoYW5kbGVyX2NiLCBlcnJvcl9jYikgewogICAgICByZXR1cm4gdGhpcy5tb2RpZnlBZmZpbGlhdGlvbihyb29tLCBqaWQsICdhZG1pbicsIHJlYXNvbiwgaGFuZGxlcl9jYiwgZXJyb3JfY2IpOwogICAgfSwKCiAgICAvKkZ1bmN0aW9uCiAgICBDaGFuZ2UgdGhlIGN1cnJlbnQgdXNlcnMgbmljayBuYW1lLgogICAgUGFyYW1ldGVyczoKICAgIChTdHJpbmcpIHJvb20gLSBUaGUgbXVsdGktdXNlciBjaGF0IHJvb20gbmFtZS4KICAgIChTdHJpbmcpIHVzZXIgLSBUaGUgbmV3IG5pY2sgbmFtZS4KICAgICAqLwogICAgY2hhbmdlTmljazogZnVuY3Rpb24ocm9vbSwgdXNlcikgewogICAgICB2YXIgcHJlc2VuY2UsIHJvb21fbmljazsKICAgICAgcm9vbV9uaWNrID0gdGhpcy50ZXN0X2FwcGVuZF9uaWNrKHJvb20sIHVzZXIpOwogICAgICBwcmVzZW5jZSA9ICRwcmVzKHsKICAgICAgICBmcm9tOiB0aGlzLl9jb25uZWN0aW9uLmppZCwKICAgICAgICB0bzogcm9vbV9uaWNrLAogICAgICAgIGlkOiB0aGlzLl9jb25uZWN0aW9uLmdldFVuaXF1ZUlkKCkKICAgICAgfSk7CiAgICAgIHJldHVybiB0aGlzLl9jb25uZWN0aW9uLnNlbmQocHJlc2VuY2UudHJlZSgpKTsKICAgIH0sCgogICAgLypGdW5jdGlvbgogICAgQ2hhbmdlIHRoZSBjdXJyZW50IHVzZXJzIHN0YXR1cy4KICAgIFBhcmFtZXRlcnM6CiAgICAoU3RyaW5nKSByb29tIC0gVGhlIG11bHRpLXVzZXIgY2hhdCByb29tIG5hbWUuCiAgICAoU3RyaW5nKSB1c2VyIC0gVGhlIGN1cnJlbnQgbmljay4KICAgIChTdHJpbmcpIHNob3cgLSBUaGUgbmV3IHNob3ctdGV4dC4KICAgIChTdHJpbmcpIHN0YXR1cyAtIFRoZSBuZXcgc3RhdHVzLXRleHQuCiAgICAgKi8KICAgIHNldFN0YXR1czogZnVuY3Rpb24ocm9vbSwgdXNlciwgc2hvdywgc3RhdHVzKSB7CiAgICAgIHZhciBwcmVzZW5jZSwgcm9vbV9uaWNrOwogICAgICByb29tX25pY2sgPSB0aGlzLnRlc3RfYXBwZW5kX25pY2socm9vbSwgdXNlcik7CiAgICAgIHByZXNlbmNlID0gJHByZXMoewogICAgICAgIGZyb206IHRoaXMuX2Nvbm5lY3Rpb24uamlkLAogICAgICAgIHRvOiByb29tX25pY2sKICAgICAgfSk7CiAgICAgIGlmIChzaG93ICE9IG51bGwpIHsKICAgICAgICBwcmVzZW5jZS5jKCdzaG93Jywgc2hvdykudXAoKTsKICAgICAgfQogICAgICBpZiAoc3RhdHVzICE9IG51bGwpIHsKICAgICAgICBwcmVzZW5jZS5jKCdzdGF0dXMnLCBzdGF0dXMpOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLl9jb25uZWN0aW9uLnNlbmQocHJlc2VuY2UudHJlZSgpKTsKICAgIH0sCgogICAgLypGdW5jdGlvbgogICAgUmVnaXN0ZXJpbmcgd2l0aCBhIHJvb20uCiAgICBAc2VlIGh0dHA6Ly94bXBwLm9yZy9leHRlbnNpb25zL3hlcC0wMDQ1Lmh0bWwjcmVnaXN0ZXIKICAgIFBhcmFtZXRlcnM6CiAgICAoU3RyaW5nKSByb29tIC0gVGhlIG11bHRpLXVzZXIgY2hhdCByb29tIG5hbWUuCiAgICAoRnVuY3Rpb24pIGhhbmRsZV9jYiAtIEZ1bmN0aW9uIHRvIGNhbGwgZm9yIHJvb20gbGlzdCByZXR1cm4uCiAgICAoRnVuY3Rpb24pIGVycm9yX2NiIC0gRnVuY3Rpb24gdG8gY2FsbCBvbiBlcnJvci4KICAgICAqLwogICAgcmVnaXN0cmF0aW9uUmVxdWVzdDogZnVuY3Rpb24ocm9vbSwgaGFuZGxlX2NiLCBlcnJvcl9jYikgewogICAgICB2YXIgaXE7CiAgICAgIGlxID0gJGlxKHsKICAgICAgICB0bzogcm9vbSwKICAgICAgICBmcm9tOiB0aGlzLl9jb25uZWN0aW9uLmppZCwKICAgICAgICB0eXBlOiAiZ2V0IgogICAgICB9KS5jKCJxdWVyeSIsIHsKICAgICAgICB4bWxuczogU3Ryb3BoZS5OUy5NVUNfUkVHSVNURVIKICAgICAgfSk7CiAgICAgIHJldHVybiB0aGlzLl9jb25uZWN0aW9uLnNlbmRJUShpcSwgZnVuY3Rpb24oc3RhbnphKSB7CiAgICAgICAgdmFyICRmaWVsZCwgJGZpZWxkcywgZmllbGQsIGZpZWxkcywgbGVuZ3RoLCBfaSwgX2xlbjsKICAgICAgICAkZmllbGRzID0gc3RhbnphLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdmaWVsZCcpOwogICAgICAgIGxlbmd0aCA9ICRmaWVsZHMubGVuZ3RoOwogICAgICAgIGZpZWxkcyA9IHsKICAgICAgICAgIHJlcXVpcmVkOiBbXSwKICAgICAgICAgIG9wdGlvbmFsOiBbXQogICAgICAgIH07CiAgICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSAkZmllbGRzLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7CiAgICAgICAgICAkZmllbGQgPSAkZmllbGRzW19pXTsKICAgICAgICAgIGZpZWxkID0gewogICAgICAgICAgICAidmFyIjogJGZpZWxkLmdldEF0dHJpYnV0ZSgndmFyJyksCiAgICAgICAgICAgIGxhYmVsOiAkZmllbGQuZ2V0QXR0cmlidXRlKCdsYWJlbCcpLAogICAgICAgICAgICB0eXBlOiAkZmllbGQuZ2V0QXR0cmlidXRlKCd0eXBlJykKICAgICAgICAgIH07CiAgICAgICAgICBpZiAoJGZpZWxkLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdyZXF1aXJlZCcpLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgZmllbGRzLnJlcXVpcmVkLnB1c2goZmllbGQpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZmllbGRzLm9wdGlvbmFsLnB1c2goZmllbGQpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gaGFuZGxlX2NiKGZpZWxkcyk7CiAgICAgIH0sIGVycm9yX2NiKTsKICAgIH0sCgogICAgLypGdW5jdGlvbgogICAgU3VibWl0cyByZWdpc3RyYXRpb24gZm9ybS4KICAgIFBhcmFtZXRlcnM6CiAgICAoU3RyaW5nKSByb29tIC0gVGhlIG11bHRpLXVzZXIgY2hhdCByb29tIG5hbWUuCiAgICAoRnVuY3Rpb24pIGhhbmRsZV9jYiAtIEZ1bmN0aW9uIHRvIGNhbGwgZm9yIHJvb20gbGlzdCByZXR1cm4uCiAgICAoRnVuY3Rpb24pIGVycm9yX2NiIC0gRnVuY3Rpb24gdG8gY2FsbCBvbiBlcnJvci4KICAgICAqLwogICAgc3VibWl0UmVnaXN0cmF0aW9uRm9ybTogZnVuY3Rpb24ocm9vbSwgZmllbGRzLCBoYW5kbGVfY2IsIGVycm9yX2NiKSB7CiAgICAgIHZhciBpcSwga2V5LCB2YWw7CiAgICAgIGlxID0gJGlxKHsKICAgICAgICB0bzogcm9vbSwKICAgICAgICB0eXBlOiAic2V0IgogICAgICB9KS5jKCJxdWVyeSIsIHsKICAgICAgICB4bWxuczogU3Ryb3BoZS5OUy5NVUNfUkVHSVNURVIKICAgICAgfSk7CiAgICAgIGlxLmMoIngiLCB7CiAgICAgICAgeG1sbnM6ICJqYWJiZXI6eDpkYXRhIiwKICAgICAgICB0eXBlOiAic3VibWl0IgogICAgICB9KTsKICAgICAgaXEuYygnZmllbGQnLCB7CiAgICAgICAgJ3Zhcic6ICdGT1JNX1RZUEUnCiAgICAgIH0pLmMoJ3ZhbHVlJykudCgnaHR0cDovL2phYmJlci5vcmcvcHJvdG9jb2wvbXVjI3JlZ2lzdGVyJykudXAoKS51cCgpOwogICAgICBmb3IgKGtleSBpbiBmaWVsZHMpIHsKICAgICAgICB2YWwgPSBmaWVsZHNba2V5XTsKICAgICAgICBpcS5jKCdmaWVsZCcsIHsKICAgICAgICAgICd2YXInOiBrZXkKICAgICAgICB9KS5jKCd2YWx1ZScpLnQodmFsKS51cCgpLnVwKCk7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMuX2Nvbm5lY3Rpb24uc2VuZElRKGlxLCBoYW5kbGVfY2IsIGVycm9yX2NiKTsKICAgIH0sCgogICAgLypGdW5jdGlvbgogICAgTGlzdCBhbGwgY2hhdCByb29tIGF2YWlsYWJsZSBvbiBhIHNlcnZlci4KICAgIFBhcmFtZXRlcnM6CiAgICAoU3RyaW5nKSBzZXJ2ZXIgLSBuYW1lIG9mIGNoYXQgc2VydmVyLgogICAgKFN0cmluZykgaGFuZGxlX2NiIC0gRnVuY3Rpb24gdG8gY2FsbCBmb3Igcm9vbSBsaXN0IHJldHVybi4KICAgIChTdHJpbmcpIGVycm9yX2NiIC0gRnVuY3Rpb24gdG8gY2FsbCBvbiBlcnJvci4KICAgICAqLwogICAgbGlzdFJvb21zOiBmdW5jdGlvbihzZXJ2ZXIsIGhhbmRsZV9jYiwgZXJyb3JfY2IpIHsKICAgICAgdmFyIGlxOwogICAgICBpcSA9ICRpcSh7CiAgICAgICAgdG86IHNlcnZlciwKICAgICAgICBmcm9tOiB0aGlzLl9jb25uZWN0aW9uLmppZCwKICAgICAgICB0eXBlOiAiZ2V0IgogICAgICB9KS5jKCJxdWVyeSIsIHsKICAgICAgICB4bWxuczogU3Ryb3BoZS5OUy5ESVNDT19JVEVNUwogICAgICB9KTsKICAgICAgcmV0dXJuIHRoaXMuX2Nvbm5lY3Rpb24uc2VuZElRKGlxLCBoYW5kbGVfY2IsIGVycm9yX2NiKTsKICAgIH0sCiAgICB0ZXN0X2FwcGVuZF9uaWNrOiBmdW5jdGlvbihyb29tLCBuaWNrKSB7CiAgICAgIHZhciBkb21haW4sIG5vZGU7CiAgICAgIG5vZGUgPSBTdHJvcGhlLmVzY2FwZU5vZGUoU3Ryb3BoZS5nZXROb2RlRnJvbUppZChyb29tKSk7CiAgICAgIGRvbWFpbiA9IFN0cm9waGUuZ2V0RG9tYWluRnJvbUppZChyb29tKTsKICAgICAgcmV0dXJuIG5vZGUgKyAiQCIgKyBkb21haW4gKyAobmljayAhPSBudWxsID8gIi8iICsgbmljayA6ICIiKTsKICAgIH0KICB9KTsKCiAgWG1wcFJvb20gPSAoZnVuY3Rpb24oKSB7CiAgICBmdW5jdGlvbiBYbXBwUm9vbShjbGllbnQsIG5hbWUsIG5pY2ssIHBhc3N3b3JkKSB7CiAgICAgIHRoaXMuY2xpZW50ID0gY2xpZW50OwogICAgICB0aGlzLm5hbWUgPSBuYW1lOwogICAgICB0aGlzLm5pY2sgPSBuaWNrOwogICAgICB0aGlzLnBhc3N3b3JkID0gcGFzc3dvcmQ7CiAgICAgIHRoaXMuX3Jvb21Sb3N0ZXJIYW5kbGVyID0gX19iaW5kKHRoaXMuX3Jvb21Sb3N0ZXJIYW5kbGVyLCB0aGlzKTsKICAgICAgdGhpcy5fYWRkT2NjdXBhbnQgPSBfX2JpbmQodGhpcy5fYWRkT2NjdXBhbnQsIHRoaXMpOwogICAgICB0aGlzLnJvc3RlciA9IHt9OwogICAgICB0aGlzLl9tZXNzYWdlX2hhbmRsZXJzID0ge307CiAgICAgIHRoaXMuX3ByZXNlbmNlX2hhbmRsZXJzID0ge307CiAgICAgIHRoaXMuX3Jvc3Rlcl9oYW5kbGVycyA9IHt9OwogICAgICB0aGlzLl9oYW5kbGVyX2lkcyA9IDA7CiAgICAgIGlmIChjbGllbnQubXVjKSB7CiAgICAgICAgdGhpcy5jbGllbnQgPSBjbGllbnQubXVjOwogICAgICB9CiAgICAgIHRoaXMubmFtZSA9IFN0cm9waGUuZ2V0QmFyZUppZEZyb21KaWQobmFtZSk7CiAgICAgIHRoaXMuYWRkSGFuZGxlcigncHJlc2VuY2UnLCB0aGlzLl9yb29tUm9zdGVySGFuZGxlcik7CiAgICB9CgogICAgWG1wcFJvb20ucHJvdG90eXBlLmpvaW4gPSBmdW5jdGlvbihtc2dfaGFuZGxlcl9jYiwgcHJlc19oYW5kbGVyX2NiLCByb3N0ZXJfY2IpIHsKICAgICAgcmV0dXJuIHRoaXMuY2xpZW50LmpvaW4odGhpcy5uYW1lLCB0aGlzLm5pY2ssIG1zZ19oYW5kbGVyX2NiLCBwcmVzX2hhbmRsZXJfY2IsIHJvc3Rlcl9jYiwgdGhpcy5wYXNzd29yZCk7CiAgICB9OwoKICAgIFhtcHBSb29tLnByb3RvdHlwZS5sZWF2ZSA9IGZ1bmN0aW9uKGhhbmRsZXJfY2IsIG1lc3NhZ2UpIHsKICAgICAgdGhpcy5jbGllbnQubGVhdmUodGhpcy5uYW1lLCB0aGlzLm5pY2ssIGhhbmRsZXJfY2IsIG1lc3NhZ2UpOwogICAgICByZXR1cm4gZGVsZXRlIHRoaXMuY2xpZW50LnJvb21zW3RoaXMubmFtZV07CiAgICB9OwoKICAgIFhtcHBSb29tLnByb3RvdHlwZS5tZXNzYWdlID0gZnVuY3Rpb24obmljaywgbWVzc2FnZSwgaHRtbF9tZXNzYWdlLCB0eXBlKSB7CiAgICAgIHJldHVybiB0aGlzLmNsaWVudC5tZXNzYWdlKHRoaXMubmFtZSwgbmljaywgbWVzc2FnZSwgaHRtbF9tZXNzYWdlLCB0eXBlKTsKICAgIH07CgogICAgWG1wcFJvb20ucHJvdG90eXBlLmdyb3VwY2hhdCA9IGZ1bmN0aW9uKG1lc3NhZ2UsIGh0bWxfbWVzc2FnZSkgewogICAgICByZXR1cm4gdGhpcy5jbGllbnQuZ3JvdXBjaGF0KHRoaXMubmFtZSwgbWVzc2FnZSwgaHRtbF9tZXNzYWdlKTsKICAgIH07CgogICAgWG1wcFJvb20ucHJvdG90eXBlLmludml0ZSA9IGZ1bmN0aW9uKHJlY2VpdmVyLCByZWFzb24pIHsKICAgICAgcmV0dXJuIHRoaXMuY2xpZW50Lmludml0ZSh0aGlzLm5hbWUsIHJlY2VpdmVyLCByZWFzb24pOwogICAgfTsKCiAgICBYbXBwUm9vbS5wcm90b3R5cGUubXVsdGlwbGVJbnZpdGVzID0gZnVuY3Rpb24ocmVjZWl2ZXJzLCByZWFzb24pIHsKICAgICAgcmV0dXJuIHRoaXMuY2xpZW50Lmludml0ZSh0aGlzLm5hbWUsIHJlY2VpdmVycywgcmVhc29uKTsKICAgIH07CgogICAgWG1wcFJvb20ucHJvdG90eXBlLmRpcmVjdEludml0ZSA9IGZ1bmN0aW9uKHJlY2VpdmVyLCByZWFzb24pIHsKICAgICAgcmV0dXJuIHRoaXMuY2xpZW50LmRpcmVjdEludml0ZSh0aGlzLm5hbWUsIHJlY2VpdmVyLCByZWFzb24sIHRoaXMucGFzc3dvcmQpOwogICAgfTsKCiAgICBYbXBwUm9vbS5wcm90b3R5cGUuY29uZmlndXJlID0gZnVuY3Rpb24oaGFuZGxlcl9jYikgewogICAgICByZXR1cm4gdGhpcy5jbGllbnQuY29uZmlndXJlKHRoaXMubmFtZSwgaGFuZGxlcl9jYik7CiAgICB9OwoKICAgIFhtcHBSb29tLnByb3RvdHlwZS5jYW5jZWxDb25maWd1cmUgPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIHRoaXMuY2xpZW50LmNhbmNlbENvbmZpZ3VyZSh0aGlzLm5hbWUpOwogICAgfTsKCiAgICBYbXBwUm9vbS5wcm90b3R5cGUuc2F2ZUNvbmZpZ3VyYXRpb24gPSBmdW5jdGlvbihjb25maWcpIHsKICAgICAgcmV0dXJuIHRoaXMuY2xpZW50LnNhdmVDb25maWd1cmF0aW9uKHRoaXMubmFtZSwgY29uZmlnKTsKICAgIH07CgogICAgWG1wcFJvb20ucHJvdG90eXBlLnF1ZXJ5T2NjdXBhbnRzID0gZnVuY3Rpb24oc3VjY2Vzc19jYiwgZXJyb3JfY2IpIHsKICAgICAgcmV0dXJuIHRoaXMuY2xpZW50LnF1ZXJ5T2NjdXBhbnRzKHRoaXMubmFtZSwgc3VjY2Vzc19jYiwgZXJyb3JfY2IpOwogICAgfTsKCiAgICBYbXBwUm9vbS5wcm90b3R5cGUuc2V0VG9waWMgPSBmdW5jdGlvbih0b3BpYykgewogICAgICByZXR1cm4gdGhpcy5jbGllbnQuc2V0VG9waWModGhpcy5uYW1lLCB0b3BpYyk7CiAgICB9OwoKICAgIFhtcHBSb29tLnByb3RvdHlwZS5tb2RpZnlSb2xlID0gZnVuY3Rpb24obmljaywgcm9sZSwgcmVhc29uLCBzdWNjZXNzX2NiLCBlcnJvcl9jYikgewogICAgICByZXR1cm4gdGhpcy5jbGllbnQubW9kaWZ5Um9sZSh0aGlzLm5hbWUsIG5pY2ssIHJvbGUsIHJlYXNvbiwgc3VjY2Vzc19jYiwgZXJyb3JfY2IpOwogICAgfTsKCiAgICBYbXBwUm9vbS5wcm90b3R5cGUua2ljayA9IGZ1bmN0aW9uKG5pY2ssIHJlYXNvbiwgaGFuZGxlcl9jYiwgZXJyb3JfY2IpIHsKICAgICAgcmV0dXJuIHRoaXMuY2xpZW50LmtpY2sodGhpcy5uYW1lLCBuaWNrLCByZWFzb24sIGhhbmRsZXJfY2IsIGVycm9yX2NiKTsKICAgIH07CgogICAgWG1wcFJvb20ucHJvdG90eXBlLnZvaWNlID0gZnVuY3Rpb24obmljaywgcmVhc29uLCBoYW5kbGVyX2NiLCBlcnJvcl9jYikgewogICAgICByZXR1cm4gdGhpcy5jbGllbnQudm9pY2UodGhpcy5uYW1lLCBuaWNrLCByZWFzb24sIGhhbmRsZXJfY2IsIGVycm9yX2NiKTsKICAgIH07CgogICAgWG1wcFJvb20ucHJvdG90eXBlLm11dGUgPSBmdW5jdGlvbihuaWNrLCByZWFzb24sIGhhbmRsZXJfY2IsIGVycm9yX2NiKSB7CiAgICAgIHJldHVybiB0aGlzLmNsaWVudC5tdXRlKHRoaXMubmFtZSwgbmljaywgcmVhc29uLCBoYW5kbGVyX2NiLCBlcnJvcl9jYik7CiAgICB9OwoKICAgIFhtcHBSb29tLnByb3RvdHlwZS5vcCA9IGZ1bmN0aW9uKG5pY2ssIHJlYXNvbiwgaGFuZGxlcl9jYiwgZXJyb3JfY2IpIHsKICAgICAgcmV0dXJuIHRoaXMuY2xpZW50Lm9wKHRoaXMubmFtZSwgbmljaywgcmVhc29uLCBoYW5kbGVyX2NiLCBlcnJvcl9jYik7CiAgICB9OwoKICAgIFhtcHBSb29tLnByb3RvdHlwZS5kZW9wID0gZnVuY3Rpb24obmljaywgcmVhc29uLCBoYW5kbGVyX2NiLCBlcnJvcl9jYikgewogICAgICByZXR1cm4gdGhpcy5jbGllbnQuZGVvcCh0aGlzLm5hbWUsIG5pY2ssIHJlYXNvbiwgaGFuZGxlcl9jYiwgZXJyb3JfY2IpOwogICAgfTsKCiAgICBYbXBwUm9vbS5wcm90b3R5cGUubW9kaWZ5QWZmaWxpYXRpb24gPSBmdW5jdGlvbihqaWQsIGFmZmlsaWF0aW9uLCByZWFzb24sIHN1Y2Nlc3NfY2IsIGVycm9yX2NiKSB7CiAgICAgIHJldHVybiB0aGlzLmNsaWVudC5tb2RpZnlBZmZpbGlhdGlvbih0aGlzLm5hbWUsIGppZCwgYWZmaWxpYXRpb24sIHJlYXNvbiwgc3VjY2Vzc19jYiwgZXJyb3JfY2IpOwogICAgfTsKCiAgICBYbXBwUm9vbS5wcm90b3R5cGUuYmFuID0gZnVuY3Rpb24oamlkLCByZWFzb24sIGhhbmRsZXJfY2IsIGVycm9yX2NiKSB7CiAgICAgIHJldHVybiB0aGlzLmNsaWVudC5iYW4odGhpcy5uYW1lLCBqaWQsIHJlYXNvbiwgaGFuZGxlcl9jYiwgZXJyb3JfY2IpOwogICAgfTsKCiAgICBYbXBwUm9vbS5wcm90b3R5cGUubWVtYmVyID0gZnVuY3Rpb24oamlkLCByZWFzb24sIGhhbmRsZXJfY2IsIGVycm9yX2NiKSB7CiAgICAgIHJldHVybiB0aGlzLmNsaWVudC5tZW1iZXIodGhpcy5uYW1lLCBqaWQsIHJlYXNvbiwgaGFuZGxlcl9jYiwgZXJyb3JfY2IpOwogICAgfTsKCiAgICBYbXBwUm9vbS5wcm90b3R5cGUucmV2b2tlID0gZnVuY3Rpb24oamlkLCByZWFzb24sIGhhbmRsZXJfY2IsIGVycm9yX2NiKSB7CiAgICAgIHJldHVybiB0aGlzLmNsaWVudC5yZXZva2UodGhpcy5uYW1lLCBqaWQsIHJlYXNvbiwgaGFuZGxlcl9jYiwgZXJyb3JfY2IpOwogICAgfTsKCiAgICBYbXBwUm9vbS5wcm90b3R5cGUub3duZXIgPSBmdW5jdGlvbihqaWQsIHJlYXNvbiwgaGFuZGxlcl9jYiwgZXJyb3JfY2IpIHsKICAgICAgcmV0dXJuIHRoaXMuY2xpZW50Lm93bmVyKHRoaXMubmFtZSwgamlkLCByZWFzb24sIGhhbmRsZXJfY2IsIGVycm9yX2NiKTsKICAgIH07CgogICAgWG1wcFJvb20ucHJvdG90eXBlLmFkbWluID0gZnVuY3Rpb24oamlkLCByZWFzb24sIGhhbmRsZXJfY2IsIGVycm9yX2NiKSB7CiAgICAgIHJldHVybiB0aGlzLmNsaWVudC5hZG1pbih0aGlzLm5hbWUsIGppZCwgcmVhc29uLCBoYW5kbGVyX2NiLCBlcnJvcl9jYik7CiAgICB9OwoKICAgIFhtcHBSb29tLnByb3RvdHlwZS5jaGFuZ2VOaWNrID0gZnVuY3Rpb24obmljaykgewogICAgICB0aGlzLm5pY2sgPSBuaWNrOwogICAgICByZXR1cm4gdGhpcy5jbGllbnQuY2hhbmdlTmljayh0aGlzLm5hbWUsIG5pY2spOwogICAgfTsKCiAgICBYbXBwUm9vbS5wcm90b3R5cGUuc2V0U3RhdHVzID0gZnVuY3Rpb24oc2hvdywgc3RhdHVzKSB7CiAgICAgIHJldHVybiB0aGlzLmNsaWVudC5zZXRTdGF0dXModGhpcy5uYW1lLCB0aGlzLm5pY2ssIHNob3csIHN0YXR1cyk7CiAgICB9OwoKCiAgICAvKkZ1bmN0aW9uCiAgICBBZGRzIGEgaGFuZGxlciB0byB0aGUgTVVDIHJvb20uCiAgICAgIFBhcmFtZXRlcnM6CiAgICAoU3RyaW5nKSBoYW5kbGVyX3R5cGUgLSAnbWVzc2FnZScsICdwcmVzZW5jZScgb3IgJ3Jvc3RlcicuCiAgICAoRnVuY3Rpb24pIGhhbmRsZXIgLSBUaGUgaGFuZGxlciBmdW5jdGlvbi4KICAgIFJldHVybnM6CiAgICBpZCAtIHRoZSBpZCBvZiBoYW5kbGVyLgogICAgICovCgogICAgWG1wcFJvb20ucHJvdG90eXBlLmFkZEhhbmRsZXIgPSBmdW5jdGlvbihoYW5kbGVyX3R5cGUsIGhhbmRsZXIpIHsKICAgICAgdmFyIGlkOwogICAgICBpZCA9IHRoaXMuX2hhbmRsZXJfaWRzKys7CiAgICAgIHN3aXRjaCAoaGFuZGxlcl90eXBlKSB7CiAgICAgICAgY2FzZSAncHJlc2VuY2UnOgogICAgICAgICAgdGhpcy5fcHJlc2VuY2VfaGFuZGxlcnNbaWRdID0gaGFuZGxlcjsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJ21lc3NhZ2UnOgogICAgICAgICAgdGhpcy5fbWVzc2FnZV9oYW5kbGVyc1tpZF0gPSBoYW5kbGVyOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAncm9zdGVyJzoKICAgICAgICAgIHRoaXMuX3Jvc3Rlcl9oYW5kbGVyc1tpZF0gPSBoYW5kbGVyOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIHRoaXMuX2hhbmRsZXJfaWRzLS07CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICByZXR1cm4gaWQ7CiAgICB9OwoKCiAgICAvKkZ1bmN0aW9uCiAgICBSZW1vdmVzIGEgaGFuZGxlciBmcm9tIHRoZSBNVUMgcm9vbS4KICAgIFRoaXMgZnVuY3Rpb24gdGFrZXMgT05MWSBpZHMgcmV0dXJuZWQgYnkgdGhlIGFkZEhhbmRsZXIgZnVuY3Rpb24KICAgIG9mIHRoaXMgcm9vbS4gcGFzc2luZyBoYW5kbGVyIGlkcyByZXR1cm5lZCBieSBjb25uZWN0aW9uLmFkZEhhbmRsZXIKICAgIG1heSBicmFrZSB0aGluZ3MhCiAgICAgIFBhcmFtZXRlcnM6CiAgICAobnVtYmVyKSBpZCAtIHRoZSBpZCBvZiB0aGUgaGFuZGxlcgogICAgICovCgogICAgWG1wcFJvb20ucHJvdG90eXBlLnJlbW92ZUhhbmRsZXIgPSBmdW5jdGlvbihpZCkgewogICAgICBkZWxldGUgdGhpcy5fcHJlc2VuY2VfaGFuZGxlcnNbaWRdOwogICAgICBkZWxldGUgdGhpcy5fbWVzc2FnZV9oYW5kbGVyc1tpZF07CiAgICAgIHJldHVybiBkZWxldGUgdGhpcy5fcm9zdGVyX2hhbmRsZXJzW2lkXTsKICAgIH07CgoKICAgIC8qRnVuY3Rpb24KICAgIENyZWF0ZXMgYW5kIGFkZHMgYW4gT2NjdXBhbnQgdG8gdGhlIFJvb20gUm9zdGVyLgogICAgICBQYXJhbWV0ZXJzOgogICAgKE9iamVjdCkgZGF0YSAtIHRoZSBkYXRhIHRoZSBPY2N1cGFudCBpcyBmaWxsZWQgd2l0aAogICAgUmV0dXJuczoKICAgIG9jYyAtIHRoZSBjcmVhdGVkIE9jY3VwYW50LgogICAgICovCgogICAgWG1wcFJvb20ucHJvdG90eXBlLl9hZGRPY2N1cGFudCA9IGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgdmFyIG9jYzsKICAgICAgb2NjID0gbmV3IE9jY3VwYW50KGRhdGEsIHRoaXMpOwogICAgICB0aGlzLnJvc3RlcltvY2Mubmlja10gPSBvY2M7CiAgICAgIHJldHVybiBvY2M7CiAgICB9OwoKCiAgICAvKkZ1bmN0aW9uCiAgICBUaGUgc3RhbmRhcmQgaGFuZGxlciB0aGF0IG1hbmFnZWQgdGhlIFJvb20gUm9zdGVyLgogICAgICBQYXJhbWV0ZXJzOgogICAgKE9iamVjdCkgcHJlcyAtIHRoZSBwcmVzZW5jZSBzdGFuemEgY29udGFpbmluZyB1c2VyIGluZm9ybWF0aW9uCiAgICAgKi8KCiAgICBYbXBwUm9vbS5wcm90b3R5cGUuX3Jvb21Sb3N0ZXJIYW5kbGVyID0gZnVuY3Rpb24ocHJlcykgewogICAgICB2YXIgZGF0YSwgaGFuZGxlciwgaWQsIG5ld25pY2ssIG5pY2ssIF9yZWY7CiAgICAgIGRhdGEgPSBYbXBwUm9vbS5fcGFyc2VQcmVzZW5jZShwcmVzKTsKICAgICAgbmljayA9IGRhdGEubmljazsKICAgICAgbmV3bmljayA9IGRhdGEubmV3bmljayB8fCBudWxsOwogICAgICBzd2l0Y2ggKGRhdGEudHlwZSkgewogICAgICAgIGNhc2UgJ2Vycm9yJzoKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIGNhc2UgJ3VuYXZhaWxhYmxlJzoKICAgICAgICAgIGlmIChuZXduaWNrKSB7CiAgICAgICAgICAgIGRhdGEubmljayA9IG5ld25pY2s7CiAgICAgICAgICAgIGlmICh0aGlzLnJvc3RlcltuaWNrXSAmJiB0aGlzLnJvc3RlcltuZXduaWNrXSkgewogICAgICAgICAgICAgIHRoaXMucm9zdGVyW25pY2tdLnVwZGF0ZSh0aGlzLnJvc3RlcltuZXduaWNrXSk7CiAgICAgICAgICAgICAgdGhpcy5yb3N0ZXJbbmV3bmlja10gPSB0aGlzLnJvc3RlcltuaWNrXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy5yb3N0ZXJbbmlja10gJiYgIXRoaXMucm9zdGVyW25ld25pY2tdKSB7CiAgICAgICAgICAgICAgdGhpcy5yb3N0ZXJbbmV3bmlja10gPSB0aGlzLnJvc3RlcltuaWNrXS51cGRhdGUoZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGRlbGV0ZSB0aGlzLnJvc3RlcltuaWNrXTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICBpZiAodGhpcy5yb3N0ZXJbbmlja10pIHsKICAgICAgICAgICAgdGhpcy5yb3N0ZXJbbmlja10udXBkYXRlKGRhdGEpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5fYWRkT2NjdXBhbnQoZGF0YSk7CiAgICAgICAgICB9CiAgICAgIH0KICAgICAgX3JlZiA9IHRoaXMuX3Jvc3Rlcl9oYW5kbGVyczsKICAgICAgZm9yIChpZCBpbiBfcmVmKSB7CiAgICAgICAgaGFuZGxlciA9IF9yZWZbaWRdOwogICAgICAgIGlmICghaGFuZGxlcih0aGlzLnJvc3RlciwgdGhpcykpIHsKICAgICAgICAgIGRlbGV0ZSB0aGlzLl9yb3N0ZXJfaGFuZGxlcnNbaWRdOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gdHJ1ZTsKICAgIH07CgoKICAgIC8qRnVuY3Rpb24KICAgIFBhcnNlcyBhIHByZXNlbmNlIHN0YW56YQogICAgICBQYXJhbWV0ZXJzOgogICAgKE9iamVjdCkgZGF0YSAtIHRoZSBkYXRhIGV4dHJhY3RlZCBmcm9tIHRoZSBwcmVzZW5jZSBzdGFuemEKICAgICAqLwoKICAgIFhtcHBSb29tLl9wYXJzZVByZXNlbmNlID0gZnVuY3Rpb24ocHJlcykgewogICAgICB2YXIgYywgYzIsIGRhdGEsIF9pLCBfaiwgX2xlbiwgX2xlbjEsIF9yZWYsIF9yZWYxOwogICAgICBkYXRhID0ge307CiAgICAgIGRhdGEubmljayA9IFN0cm9waGUuZ2V0UmVzb3VyY2VGcm9tSmlkKHByZXMuZ2V0QXR0cmlidXRlKCJmcm9tIikpOwogICAgICBkYXRhLnR5cGUgPSBwcmVzLmdldEF0dHJpYnV0ZSgidHlwZSIpOwogICAgICBkYXRhLnN0YXRlcyA9IFtdOwogICAgICBfcmVmID0gcHJlcy5jaGlsZE5vZGVzOwogICAgICBmb3IgKF9pID0gMCwgX2xlbiA9IF9yZWYubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHsKICAgICAgICBjID0gX3JlZltfaV07CiAgICAgICAgc3dpdGNoIChjLm5vZGVOYW1lKSB7CiAgICAgICAgICBjYXNlICJzdGF0dXMiOgogICAgICAgICAgICBkYXRhLnN0YXR1cyA9IGMudGV4dENvbnRlbnQgfHwgbnVsbDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICJzaG93IjoKICAgICAgICAgICAgZGF0YS5zaG93ID0gYy50ZXh0Q29udGVudCB8fCBudWxsOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgIngiOgogICAgICAgICAgICBpZiAoYy5nZXRBdHRyaWJ1dGUoInhtbG5zIikgPT09IFN0cm9waGUuTlMuTVVDX1VTRVIpIHsKICAgICAgICAgICAgICBfcmVmMSA9IGMuY2hpbGROb2RlczsKICAgICAgICAgICAgICBmb3IgKF9qID0gMCwgX2xlbjEgPSBfcmVmMS5sZW5ndGg7IF9qIDwgX2xlbjE7IF9qKyspIHsKICAgICAgICAgICAgICAgIGMyID0gX3JlZjFbX2pdOwogICAgICAgICAgICAgICAgc3dpdGNoIChjMi5ub2RlTmFtZSkgewogICAgICAgICAgICAgICAgICBjYXNlICJpdGVtIjoKICAgICAgICAgICAgICAgICAgICBkYXRhLmFmZmlsaWF0aW9uID0gYzIuZ2V0QXR0cmlidXRlKCJhZmZpbGlhdGlvbiIpOwogICAgICAgICAgICAgICAgICAgIGRhdGEucm9sZSA9IGMyLmdldEF0dHJpYnV0ZSgicm9sZSIpOwogICAgICAgICAgICAgICAgICAgIGRhdGEuamlkID0gYzIuZ2V0QXR0cmlidXRlKCJqaWQiKTsKICAgICAgICAgICAgICAgICAgICBkYXRhLm5ld25pY2sgPSBjMi5nZXRBdHRyaWJ1dGUoIm5pY2siKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgY2FzZSAic3RhdHVzIjoKICAgICAgICAgICAgICAgICAgICBpZiAoYzIuZ2V0QXR0cmlidXRlKCJjb2RlIikpIHsKICAgICAgICAgICAgICAgICAgICAgIGRhdGEuc3RhdGVzLnB1c2goYzIuZ2V0QXR0cmlidXRlKCJjb2RlIikpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIGRhdGE7CiAgICB9OwoKICAgIHJldHVybiBYbXBwUm9vbTsKCiAgfSkoKTsKCiAgUm9vbUNvbmZpZyA9IChmdW5jdGlvbigpIHsKICAgIGZ1bmN0aW9uIFJvb21Db25maWcoaW5mbykgewogICAgICB0aGlzLnBhcnNlID0gX19iaW5kKHRoaXMucGFyc2UsIHRoaXMpOwogICAgICBpZiAoaW5mbyAhPSBudWxsKSB7CiAgICAgICAgdGhpcy5wYXJzZShpbmZvKTsKICAgICAgfQogICAgfQoKICAgIFJvb21Db25maWcucHJvdG90eXBlLnBhcnNlID0gZnVuY3Rpb24ocmVzdWx0KSB7CiAgICAgIHZhciBhdHRyLCBhdHRycywgY2hpbGQsIGZpZWxkLCBpZGVudGl0eSwgcXVlcnksIF9pLCBfaiwgX2ssIF9sZW4sIF9sZW4xLCBfbGVuMiwgX3JlZjsKICAgICAgcXVlcnkgPSByZXN1bHQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoInF1ZXJ5IilbMF0uY2hpbGROb2RlczsKICAgICAgdGhpcy5pZGVudGl0aWVzID0gW107CiAgICAgIHRoaXMuZmVhdHVyZXMgPSBbXTsKICAgICAgdGhpcy54ID0gW107CiAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gcXVlcnkubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHsKICAgICAgICBjaGlsZCA9IHF1ZXJ5W19pXTsKICAgICAgICBhdHRycyA9IGNoaWxkLmF0dHJpYnV0ZXM7CiAgICAgICAgc3dpdGNoIChjaGlsZC5ub2RlTmFtZSkgewogICAgICAgICAgY2FzZSAiaWRlbnRpdHkiOgogICAgICAgICAgICBpZGVudGl0eSA9IHt9OwogICAgICAgICAgICBmb3IgKF9qID0gMCwgX2xlbjEgPSBhdHRycy5sZW5ndGg7IF9qIDwgX2xlbjE7IF9qKyspIHsKICAgICAgICAgICAgICBhdHRyID0gYXR0cnNbX2pdOwogICAgICAgICAgICAgIGlkZW50aXR5W2F0dHIubmFtZV0gPSBhdHRyLnRleHRDb250ZW50OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuaWRlbnRpdGllcy5wdXNoKGlkZW50aXR5KTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICJmZWF0dXJlIjoKICAgICAgICAgICAgdGhpcy5mZWF0dXJlcy5wdXNoKGNoaWxkLmdldEF0dHJpYnV0ZSgidmFyIikpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgIngiOgogICAgICAgICAgICBpZiAoKCFjaGlsZC5jaGlsZE5vZGVzWzBdLmdldEF0dHJpYnV0ZSgidmFyIikgPT09ICdGT1JNX1RZUEUnKSB8fCAoIWNoaWxkLmNoaWxkTm9kZXNbMF0uZ2V0QXR0cmlidXRlKCJ0eXBlIikgPT09ICdoaWRkZW4nKSkgewogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIF9yZWYgPSBjaGlsZC5jaGlsZE5vZGVzOwogICAgICAgICAgICBmb3IgKF9rID0gMCwgX2xlbjIgPSBfcmVmLmxlbmd0aDsgX2sgPCBfbGVuMjsgX2srKykgewogICAgICAgICAgICAgIGZpZWxkID0gX3JlZltfa107CiAgICAgICAgICAgICAgaWYgKCFmaWVsZC5hdHRyaWJ1dGVzLnR5cGUpIHsKICAgICAgICAgICAgICAgIHRoaXMueC5wdXNoKHsKICAgICAgICAgICAgICAgICAgInZhciI6IGZpZWxkLmdldEF0dHJpYnV0ZSgidmFyIiksCiAgICAgICAgICAgICAgICAgIGxhYmVsOiBmaWVsZC5nZXRBdHRyaWJ1dGUoImxhYmVsIikgfHwgIiIsCiAgICAgICAgICAgICAgICAgIHZhbHVlOiBmaWVsZC5maXJzdENoaWxkLnRleHRDb250ZW50IHx8ICIiCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIHsKICAgICAgICAiaWRlbnRpdGllcyI6IHRoaXMuaWRlbnRpdGllcywKICAgICAgICAiZmVhdHVyZXMiOiB0aGlzLmZlYXR1cmVzLAogICAgICAgICJ4IjogdGhpcy54CiAgICAgIH07CiAgICB9OwoKICAgIHJldHVybiBSb29tQ29uZmlnOwoKICB9KSgpOwoKICBPY2N1cGFudCA9IChmdW5jdGlvbigpIHsKICAgIGZ1bmN0aW9uIE9jY3VwYW50KGRhdGEsIHJvb20pIHsKICAgICAgdGhpcy5yb29tID0gcm9vbTsKICAgICAgdGhpcy51cGRhdGUgPSBfX2JpbmQodGhpcy51cGRhdGUsIHRoaXMpOwogICAgICB0aGlzLmFkbWluID0gX19iaW5kKHRoaXMuYWRtaW4sIHRoaXMpOwogICAgICB0aGlzLm93bmVyID0gX19iaW5kKHRoaXMub3duZXIsIHRoaXMpOwogICAgICB0aGlzLnJldm9rZSA9IF9fYmluZCh0aGlzLnJldm9rZSwgdGhpcyk7CiAgICAgIHRoaXMubWVtYmVyID0gX19iaW5kKHRoaXMubWVtYmVyLCB0aGlzKTsKICAgICAgdGhpcy5iYW4gPSBfX2JpbmQodGhpcy5iYW4sIHRoaXMpOwogICAgICB0aGlzLm1vZGlmeUFmZmlsaWF0aW9uID0gX19iaW5kKHRoaXMubW9kaWZ5QWZmaWxpYXRpb24sIHRoaXMpOwogICAgICB0aGlzLmRlb3AgPSBfX2JpbmQodGhpcy5kZW9wLCB0aGlzKTsKICAgICAgdGhpcy5vcCA9IF9fYmluZCh0aGlzLm9wLCB0aGlzKTsKICAgICAgdGhpcy5tdXRlID0gX19iaW5kKHRoaXMubXV0ZSwgdGhpcyk7CiAgICAgIHRoaXMudm9pY2UgPSBfX2JpbmQodGhpcy52b2ljZSwgdGhpcyk7CiAgICAgIHRoaXMua2ljayA9IF9fYmluZCh0aGlzLmtpY2ssIHRoaXMpOwogICAgICB0aGlzLm1vZGlmeVJvbGUgPSBfX2JpbmQodGhpcy5tb2RpZnlSb2xlLCB0aGlzKTsKICAgICAgdGhpcy51cGRhdGUoZGF0YSk7CiAgICB9CgogICAgT2NjdXBhbnQucHJvdG90eXBlLm1vZGlmeVJvbGUgPSBmdW5jdGlvbihyb2xlLCByZWFzb24sIHN1Y2Nlc3NfY2IsIGVycm9yX2NiKSB7CiAgICAgIHJldHVybiB0aGlzLnJvb20ubW9kaWZ5Um9sZSh0aGlzLm5pY2ssIHJvbGUsIHJlYXNvbiwgc3VjY2Vzc19jYiwgZXJyb3JfY2IpOwogICAgfTsKCiAgICBPY2N1cGFudC5wcm90b3R5cGUua2ljayA9IGZ1bmN0aW9uKHJlYXNvbiwgaGFuZGxlcl9jYiwgZXJyb3JfY2IpIHsKICAgICAgcmV0dXJuIHRoaXMucm9vbS5raWNrKHRoaXMubmljaywgcmVhc29uLCBoYW5kbGVyX2NiLCBlcnJvcl9jYik7CiAgICB9OwoKICAgIE9jY3VwYW50LnByb3RvdHlwZS52b2ljZSA9IGZ1bmN0aW9uKHJlYXNvbiwgaGFuZGxlcl9jYiwgZXJyb3JfY2IpIHsKICAgICAgcmV0dXJuIHRoaXMucm9vbS52b2ljZSh0aGlzLm5pY2ssIHJlYXNvbiwgaGFuZGxlcl9jYiwgZXJyb3JfY2IpOwogICAgfTsKCiAgICBPY2N1cGFudC5wcm90b3R5cGUubXV0ZSA9IGZ1bmN0aW9uKHJlYXNvbiwgaGFuZGxlcl9jYiwgZXJyb3JfY2IpIHsKICAgICAgcmV0dXJuIHRoaXMucm9vbS5tdXRlKHRoaXMubmljaywgcmVhc29uLCBoYW5kbGVyX2NiLCBlcnJvcl9jYik7CiAgICB9OwoKICAgIE9jY3VwYW50LnByb3RvdHlwZS5vcCA9IGZ1bmN0aW9uKHJlYXNvbiwgaGFuZGxlcl9jYiwgZXJyb3JfY2IpIHsKICAgICAgcmV0dXJuIHRoaXMucm9vbS5vcCh0aGlzLm5pY2ssIHJlYXNvbiwgaGFuZGxlcl9jYiwgZXJyb3JfY2IpOwogICAgfTsKCiAgICBPY2N1cGFudC5wcm90b3R5cGUuZGVvcCA9IGZ1bmN0aW9uKHJlYXNvbiwgaGFuZGxlcl9jYiwgZXJyb3JfY2IpIHsKICAgICAgcmV0dXJuIHRoaXMucm9vbS5kZW9wKHRoaXMubmljaywgcmVhc29uLCBoYW5kbGVyX2NiLCBlcnJvcl9jYik7CiAgICB9OwoKICAgIE9jY3VwYW50LnByb3RvdHlwZS5tb2RpZnlBZmZpbGlhdGlvbiA9IGZ1bmN0aW9uKGFmZmlsaWF0aW9uLCByZWFzb24sIHN1Y2Nlc3NfY2IsIGVycm9yX2NiKSB7CiAgICAgIHJldHVybiB0aGlzLnJvb20ubW9kaWZ5QWZmaWxpYXRpb24odGhpcy5qaWQsIGFmZmlsaWF0aW9uLCByZWFzb24sIHN1Y2Nlc3NfY2IsIGVycm9yX2NiKTsKICAgIH07CgogICAgT2NjdXBhbnQucHJvdG90eXBlLmJhbiA9IGZ1bmN0aW9uKHJlYXNvbiwgaGFuZGxlcl9jYiwgZXJyb3JfY2IpIHsKICAgICAgcmV0dXJuIHRoaXMucm9vbS5iYW4odGhpcy5qaWQsIHJlYXNvbiwgaGFuZGxlcl9jYiwgZXJyb3JfY2IpOwogICAgfTsKCiAgICBPY2N1cGFudC5wcm90b3R5cGUubWVtYmVyID0gZnVuY3Rpb24ocmVhc29uLCBoYW5kbGVyX2NiLCBlcnJvcl9jYikgewogICAgICByZXR1cm4gdGhpcy5yb29tLm1lbWJlcih0aGlzLmppZCwgcmVhc29uLCBoYW5kbGVyX2NiLCBlcnJvcl9jYik7CiAgICB9OwoKICAgIE9jY3VwYW50LnByb3RvdHlwZS5yZXZva2UgPSBmdW5jdGlvbihyZWFzb24sIGhhbmRsZXJfY2IsIGVycm9yX2NiKSB7CiAgICAgIHJldHVybiB0aGlzLnJvb20ucmV2b2tlKHRoaXMuamlkLCByZWFzb24sIGhhbmRsZXJfY2IsIGVycm9yX2NiKTsKICAgIH07CgogICAgT2NjdXBhbnQucHJvdG90eXBlLm93bmVyID0gZnVuY3Rpb24ocmVhc29uLCBoYW5kbGVyX2NiLCBlcnJvcl9jYikgewogICAgICByZXR1cm4gdGhpcy5yb29tLm93bmVyKHRoaXMuamlkLCByZWFzb24sIGhhbmRsZXJfY2IsIGVycm9yX2NiKTsKICAgIH07CgogICAgT2NjdXBhbnQucHJvdG90eXBlLmFkbWluID0gZnVuY3Rpb24ocmVhc29uLCBoYW5kbGVyX2NiLCBlcnJvcl9jYikgewogICAgICByZXR1cm4gdGhpcy5yb29tLmFkbWluKHRoaXMuamlkLCByZWFzb24sIGhhbmRsZXJfY2IsIGVycm9yX2NiKTsKICAgIH07CgogICAgT2NjdXBhbnQucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgdGhpcy5uaWNrID0gZGF0YS5uaWNrIHx8IG51bGw7CiAgICAgIHRoaXMuYWZmaWxpYXRpb24gPSBkYXRhLmFmZmlsaWF0aW9uIHx8IG51bGw7CiAgICAgIHRoaXMucm9sZSA9IGRhdGEucm9sZSB8fCBudWxsOwogICAgICB0aGlzLmppZCA9IGRhdGEuamlkIHx8IG51bGw7CiAgICAgIHRoaXMuc3RhdHVzID0gZGF0YS5zdGF0dXMgfHwgbnVsbDsKICAgICAgdGhpcy5zaG93ID0gZGF0YS5zaG93IHx8IG51bGw7CiAgICAgIHJldHVybiB0aGlzOwogICAgfTsKCiAgICByZXR1cm4gT2NjdXBhbnQ7CgogIH0pKCk7Cgp9KS5jYWxsKHRoaXMpOwoKZGVmaW5lKCJzdHJvcGhlLm11YyIsIFsic3Ryb3BoZSJdLCBmdW5jdGlvbigpe30pOwoKLyoKICBDb3B5cmlnaHQgMjAxMCwgRnJhbsOnb2lzIGRlIE1ldHogPGZyYW5jb2lzQDJtZXR6LmZyPgoqLwovKioKICogUm9zdGVyIFBsdWdpbgogKiBBbGxvdyBlYXNpbHkgcm9zdGVyIG1hbmFnZW1lbnQKICoKICogIEZlYXR1cmVzCiAqICAqIEdldCByb3N0ZXIgZnJvbSBzZXJ2ZXIKICogICogaGFuZGxlIHByZXNlbmNlCiAqICAqIGhhbmRsZSByb3N0ZXIgaXEKICogICogc3Vic2NyaWJlL3Vuc3Vic2NyaWJlCiAqICAqIGF1dGhvcml6ZS91bmF1dGhvcml6ZQogKiAgKiByb3N0ZXIgdmVyc2lvbmluZyAoeGVwIDIzNykKICovClN0cm9waGUuYWRkQ29ubmVjdGlvblBsdWdpbigncm9zdGVyJywKewogICAgLyoqIEZ1bmN0aW9uOiBpbml0CiAgICAgKiBQbHVnaW4gaW5pdAogICAgICoKICAgICAqIFBhcmFtZXRlcnM6CiAgICAgKiAgIChTdHJvcGhlLkNvbm5lY3Rpb24pIGNvbm4gLSBTdHJvcGhlIGNvbm5lY3Rpb24KICAgICAqLwogICAgaW5pdDogZnVuY3Rpb24oY29ubikKICAgIHsKICAgICAgICB0aGlzLl9jb25uZWN0aW9uID0gY29ubjsKICAgICAgICB0aGlzLl9jYWxsYmFja3MgPSBbXTsKICAgICAgICAvKiogUHJvcGVydHk6IGl0ZW1zCiAgICAgICAgICogIFJvc3RlciBpdGVtcwogICAgICAgICAqICBbCiAgICAgICAgICogICAgewogICAgICAgICAqICAgICAgICBuYW1lICAgICAgICAgOiAiIiwKICAgICAgICAgKiAgICAgICAgamlkICAgICAgICAgIDogIiIsCiAgICAgICAgICogICAgICAgIHN1YnNjcmlwdGlvbiA6ICIiLAogICAgICAgICAqICAgICAgICBhc2sgICAgICAgICAgOiAiIiwKICAgICAgICAgKiAgICAgICAgZ3JvdXBzICAgICAgIDogWyIiLCAiIl0sCiAgICAgICAgICogICAgICAgIHJlc291cmNlcyAgICA6IHsKICAgICAgICAgKiAgICAgICAgICAgIG15cmVzb3VyY2UgOiB7CiAgICAgICAgICogICAgICAgICAgICAgICAgc2hvdyAgIDogIiIsCiAgICAgICAgICogICAgICAgICAgICAgICAgc3RhdHVzIDogIiIsCiAgICAgICAgICogICAgICAgICAgICAgICAgcHJpb3JpdHkgOiAiIgogICAgICAgICAqICAgICAgICAgICAgfQogICAgICAgICAqICAgICAgICB9CiAgICAgICAgICogICAgfQogICAgICAgICAqIF0KICAgICAgICAgKi8KICAgICAgICB0aGlzLml0ZW1zID0gW107CiAgICAgICAgLyoqIFByb3BlcnR5OiB2ZXIKICAgICAgICAqIGN1cnJlbnQgcm9zdGVyIHJldmlzaW9uCiAgICAgICAgKiBhbHdheXMgbnVsbCBpZiBzZXJ2ZXIgZG9lc24ndCBzdXBwb3J0IHhlcCAyMzcKICAgICAgICAqLwogICAgICAgIHRoaXMudmVyID0gbnVsbDsKICAgICAgICAvLyBPdmVycmlkZSB0aGUgY29ubmVjdCBhbmQgYXR0YWNoIG1ldGhvZHMgdG8gYWx3YXlzIGFkZCBwcmVzZW5jZSBhbmQgcm9zdGVyIGhhbmRsZXJzLgogICAgICAgIC8vIFRoZXkgYXJlIHJlbW92ZWQgd2hlbiB0aGUgY29ubmVjdGlvbiBkaXNjb25uZWN0cywgc28gbXVzdCBiZSBhZGRlZCBvbiBjb25uZWN0aW9uLgogICAgICAgIHZhciBvbGRDYWxsYmFjaywgcm9zdGVyID0gdGhpcywgX2Nvbm5lY3QgPSBjb25uLmNvbm5lY3QsIF9hdHRhY2ggPSBjb25uLmF0dGFjaDsKICAgICAgICB2YXIgbmV3Q2FsbGJhY2sgPSBmdW5jdGlvbihzdGF0dXMpCiAgICAgICAgewogICAgICAgICAgICBpZiAoc3RhdHVzID09IFN0cm9waGUuU3RhdHVzLkFUVEFDSEVEIHx8IHN0YXR1cyA9PSBTdHJvcGhlLlN0YXR1cy5DT05ORUNURUQpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHRyeQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIC8vIFByZXNlbmNlIHN1YnNjcmlwdGlvbgogICAgICAgICAgICAgICAgICAgIGNvbm4uYWRkSGFuZGxlcihyb3N0ZXIuX29uUmVjZWl2ZVByZXNlbmNlLmJpbmQocm9zdGVyKSwgbnVsbCwgJ3ByZXNlbmNlJywgbnVsbCwgbnVsbCwgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgY29ubi5hZGRIYW5kbGVyKHJvc3Rlci5fb25SZWNlaXZlSVEuYmluZChyb3N0ZXIpLCBTdHJvcGhlLk5TLlJPU1RFUiwgJ2lxJywgInNldCIsIG51bGwsIG51bGwpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2F0Y2ggKGUpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgU3Ryb3BoZS5lcnJvcihlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodHlwZW9mIG9sZENhbGxiYWNrID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICAgICAgICBvbGRDYWxsYmFjay5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBjb25uLmNvbm5lY3QgPSBmdW5jdGlvbihqaWQsIHBhc3MsIGNhbGxiYWNrLCB3YWl0LCBob2xkKQogICAgICAgIHsKICAgICAgICAgICAgb2xkQ2FsbGJhY2sgPSBjYWxsYmFjazsKICAgICAgICAgICAgaWYgKHR5cGVvZiBqaWQgID09ICJ1bmRlZmluZWQiKQogICAgICAgICAgICAgICAgamlkICA9IG51bGw7CiAgICAgICAgICAgIGlmICh0eXBlb2YgcGFzcyA9PSAidW5kZWZpbmVkIikKICAgICAgICAgICAgICAgIHBhc3MgPSBudWxsOwogICAgICAgICAgICBjYWxsYmFjayA9IG5ld0NhbGxiYWNrOwogICAgICAgICAgICBfY29ubmVjdC5hcHBseShjb25uLCBbamlkLCBwYXNzLCBjYWxsYmFjaywgd2FpdCwgaG9sZF0pOwogICAgICAgIH07CiAgICAgICAgY29ubi5hdHRhY2ggPSBmdW5jdGlvbihqaWQsIHNpZCwgcmlkLCBjYWxsYmFjaywgd2FpdCwgaG9sZCwgd2luZCkKICAgICAgICB7CiAgICAgICAgICAgIG9sZENhbGxiYWNrID0gY2FsbGJhY2s7CiAgICAgICAgICAgIGlmICh0eXBlb2YgamlkID09ICJ1bmRlZmluZWQiKQogICAgICAgICAgICAgICAgamlkID0gbnVsbDsKICAgICAgICAgICAgaWYgKHR5cGVvZiBzaWQgPT0gInVuZGVmaW5lZCIpCiAgICAgICAgICAgICAgICBzaWQgPSBudWxsOwogICAgICAgICAgICBpZiAodHlwZW9mIHJpZCA9PSAidW5kZWZpbmVkIikKICAgICAgICAgICAgICAgIHJpZCA9IG51bGw7CiAgICAgICAgICAgIGNhbGxiYWNrID0gbmV3Q2FsbGJhY2s7CiAgICAgICAgICAgIF9hdHRhY2guYXBwbHkoY29ubiwgW2ppZCwgc2lkLCByaWQsIGNhbGxiYWNrLCB3YWl0LCBob2xkLCB3aW5kXSk7CiAgICAgICAgfTsKCiAgICAgICAgU3Ryb3BoZS5hZGROYW1lc3BhY2UoJ1JPU1RFUl9WRVInLCAndXJuOnhtcHA6ZmVhdHVyZXM6cm9zdGVydmVyJyk7CiAgICAgICAgU3Ryb3BoZS5hZGROYW1lc3BhY2UoJ05JQ0snLCAnaHR0cDovL2phYmJlci5vcmcvcHJvdG9jb2wvbmljaycpOwogICAgfSwKICAgIC8qKiBGdW5jdGlvbjogc3VwcG9ydFZlcnNpb25pbmcKICAgICAqIHJldHVybiB0cnVlIGlmIHJvc3RlciB2ZXJzaW9uaW5nIGlzIGVuYWJsZWQgb24gc2VydmVyCiAgICAgKi8KICAgIHN1cHBvcnRWZXJzaW9uaW5nOiBmdW5jdGlvbigpCiAgICB7CiAgICAgICAgcmV0dXJuICh0aGlzLl9jb25uZWN0aW9uLmZlYXR1cmVzICYmIHRoaXMuX2Nvbm5lY3Rpb24uZmVhdHVyZXMuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3ZlcicpLmxlbmd0aCA+IDApOwogICAgfSwKICAgIC8qKiBGdW5jdGlvbjogZ2V0CiAgICAgKiBHZXQgUm9zdGVyIG9uIHNlcnZlcgogICAgICoKICAgICAqIFBhcmFtZXRlcnM6CiAgICAgKiAgIChGdW5jdGlvbikgdXNlckNhbGxiYWNrIC0gY2FsbGJhY2sgb24gcm9zdGVyIHJlc3VsdAogICAgICogICAoU3RyaW5nKSB2ZXIgLSBjdXJyZW50IHJldiBvZiByb3N0ZXIKICAgICAqICAgICAgKG9ubHkgdXNlZCBpZiByb3N0ZXIgdmVyc2lvbmluZyBpcyBlbmFibGVkKQogICAgICogICAoQXJyYXkpIGl0ZW1zIC0gaW5pdGlhbCBpdGVtcyBvZiB2ZXIKICAgICAqICAgICAgKG9ubHkgdXNlZCBpZiByb3N0ZXIgdmVyc2lvbmluZyBpcyBlbmFibGVkKQogICAgICogICAgIEluIGJyb3dzZXIgY29udGV4dCB5b3UgY2FuIHVzZSBzZXNzaW9uU3RvcmFnZQogICAgICogICAgIHRvIHN0b3JlIHlvdXIgcm9zdGVyIGluIGpzb24gKEpTT04uc3RyaW5naWZ5KCkpCiAgICAgKi8KICAgIGdldDogZnVuY3Rpb24odXNlckNhbGxiYWNrLCB2ZXIsIGl0ZW1zKQogICAgewogICAgICAgIHZhciBhdHRycyA9IHt4bWxuczogU3Ryb3BoZS5OUy5ST1NURVJ9OwogICAgICAgIGlmICh0aGlzLnN1cHBvcnRWZXJzaW9uaW5nKCkpCiAgICAgICAgewogICAgICAgICAgICAvLyBlbXB0eSByZXYgYmVjYXVzZSBpIHdhbnQgYW4gcmV2IGF0dHJpYnV0ZSBpbiB0aGUgcmVzdWx0CiAgICAgICAgICAgIGF0dHJzLnZlciA9IHZlciB8fCAnJzsKICAgICAgICAgICAgdGhpcy5pdGVtcyA9IGl0ZW1zIHx8IFtdOwogICAgICAgIH0KICAgICAgICB2YXIgaXEgPSAkaXEoe3R5cGU6ICdnZXQnLCAgJ2lkJyA6IHRoaXMuX2Nvbm5lY3Rpb24uZ2V0VW5pcXVlSWQoJ3Jvc3RlcicpfSkuYygncXVlcnknLCBhdHRycyk7CiAgICAgICAgcmV0dXJuIHRoaXMuX2Nvbm5lY3Rpb24uc2VuZElRKGlxLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX29uUmVjZWl2ZVJvc3RlclN1Y2Nlc3MuYmluZCh0aGlzLCB1c2VyQ2FsbGJhY2spLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX29uUmVjZWl2ZVJvc3RlckVycm9yLmJpbmQodGhpcywgdXNlckNhbGxiYWNrKSk7CiAgICB9LAogICAgLyoqIEZ1bmN0aW9uOiByZWdpc3RlckNhbGxiYWNrCiAgICAgKiByZWdpc3RlciBjYWxsYmFjayBvbiByb3N0ZXIgKHByZXNlbmNlIGFuZCBpcSkKICAgICAqCiAgICAgKiBQYXJhbWV0ZXJzOgogICAgICogICAoRnVuY3Rpb24pIGNhbGxfYmFjawogICAgICovCiAgICByZWdpc3RlckNhbGxiYWNrOiBmdW5jdGlvbihjYWxsX2JhY2spCiAgICB7CiAgICAgICAgdGhpcy5fY2FsbGJhY2tzLnB1c2goY2FsbF9iYWNrKTsKICAgIH0sCiAgICAvKiogRnVuY3Rpb246IGZpbmRJdGVtCiAgICAgKiBGaW5kIGl0ZW0gYnkgSklECiAgICAgKgogICAgICogUGFyYW1ldGVyczoKICAgICAqICAgICAoU3RyaW5nKSBqaWQKICAgICAqLwogICAgZmluZEl0ZW0gOiBmdW5jdGlvbihqaWQpCiAgICB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLml0ZW1zLmxlbmd0aDsgaSsrKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5pdGVtc1tpXSAmJiB0aGlzLml0ZW1zW2ldLmppZCA9PSBqaWQpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaXRlbXNbaV07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlKQogICAgICAgIHsKICAgICAgICAgICAgU3Ryb3BoZS5lcnJvcihlKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSwKICAgIC8qKiBGdW5jdGlvbjogcmVtb3ZlSXRlbQogICAgICogUmVtb3ZlIGl0ZW0gYnkgSklECiAgICAgKgogICAgICogUGFyYW1ldGVyczoKICAgICAqICAgICAoU3RyaW5nKSBqaWQKICAgICAqLwogICAgcmVtb3ZlSXRlbSA6IGZ1bmN0aW9uKGppZCkKICAgIHsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuaXRlbXMubGVuZ3RoOyBpKyspCiAgICAgICAgewogICAgICAgICAgICBpZiAodGhpcy5pdGVtc1tpXSAmJiB0aGlzLml0ZW1zW2ldLmppZCA9PSBqaWQpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHRoaXMuaXRlbXMuc3BsaWNlKGksIDEpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSwKICAgIC8qKiBGdW5jdGlvbjogc3Vic2NyaWJlCiAgICAgKiBTdWJzY3JpYmUgcHJlc2VuY2UKICAgICAqCiAgICAgKiBQYXJhbWV0ZXJzOgogICAgICogICAgIChTdHJpbmcpIGppZAogICAgICogICAgIChTdHJpbmcpIG1lc3NhZ2UgKG9wdGlvbmFsKQogICAgICogICAgIChTdHJpbmcpIG5pY2sgIChvcHRpb25hbCkKICAgICAqLwogICAgc3Vic2NyaWJlOiBmdW5jdGlvbihqaWQsIG1lc3NhZ2UsIG5pY2spIHsKICAgICAgICB2YXIgcHJlcyA9ICRwcmVzKHt0bzogamlkLCB0eXBlOiAic3Vic2NyaWJlIn0pOwogICAgICAgIGlmIChtZXNzYWdlICYmIG1lc3NhZ2UgIT09ICIiKSB7CiAgICAgICAgICAgIHByZXMuYygic3RhdHVzIikudChtZXNzYWdlKS51cCgpOwogICAgICAgIH0KICAgICAgICBpZiAobmljayAmJiBuaWNrICE9PSAiIikgewogICAgICAgICAgICBwcmVzLmMoJ25pY2snLCB7J3htbG5zJzogU3Ryb3BoZS5OUy5OSUNLfSkudChuaWNrKS51cCgpOwogICAgICAgIH0KICAgICAgICB0aGlzLl9jb25uZWN0aW9uLnNlbmQocHJlcyk7CiAgICB9LAogICAgLyoqIEZ1bmN0aW9uOiB1bnN1YnNjcmliZQogICAgICogVW5zdWJzY3JpYmUgcHJlc2VuY2UKICAgICAqCiAgICAgKiBQYXJhbWV0ZXJzOgogICAgICogICAgIChTdHJpbmcpIGppZAogICAgICogICAgIChTdHJpbmcpIG1lc3NhZ2UKICAgICAqLwogICAgdW5zdWJzY3JpYmU6IGZ1bmN0aW9uKGppZCwgbWVzc2FnZSkKICAgIHsKICAgICAgICB2YXIgcHJlcyA9ICRwcmVzKHt0bzogamlkLCB0eXBlOiAidW5zdWJzY3JpYmUifSk7CiAgICAgICAgaWYgKG1lc3NhZ2UgJiYgbWVzc2FnZSAhPT0gIiIpCiAgICAgICAgICAgIHByZXMuYygic3RhdHVzIikudChtZXNzYWdlKTsKICAgICAgICB0aGlzLl9jb25uZWN0aW9uLnNlbmQocHJlcyk7CiAgICB9LAogICAgLyoqIEZ1bmN0aW9uOiBhdXRob3JpemUKICAgICAqIEF1dGhvcml6ZSBwcmVzZW5jZSBzdWJzY3JpcHRpb24KICAgICAqCiAgICAgKiBQYXJhbWV0ZXJzOgogICAgICogICAgIChTdHJpbmcpIGppZAogICAgICogICAgIChTdHJpbmcpIG1lc3NhZ2UKICAgICAqLwogICAgYXV0aG9yaXplOiBmdW5jdGlvbihqaWQsIG1lc3NhZ2UpCiAgICB7CiAgICAgICAgdmFyIHByZXMgPSAkcHJlcyh7dG86IGppZCwgdHlwZTogInN1YnNjcmliZWQifSk7CiAgICAgICAgaWYgKG1lc3NhZ2UgJiYgbWVzc2FnZSAhPT0gIiIpCiAgICAgICAgICAgIHByZXMuYygic3RhdHVzIikudChtZXNzYWdlKTsKICAgICAgICB0aGlzLl9jb25uZWN0aW9uLnNlbmQocHJlcyk7CiAgICB9LAogICAgLyoqIEZ1bmN0aW9uOiB1bmF1dGhvcml6ZQogICAgICogVW5hdXRob3JpemUgcHJlc2VuY2Ugc3Vic2NyaXB0aW9uCiAgICAgKgogICAgICogUGFyYW1ldGVyczoKICAgICAqICAgICAoU3RyaW5nKSBqaWQKICAgICAqICAgICAoU3RyaW5nKSBtZXNzYWdlCiAgICAgKi8KICAgIHVuYXV0aG9yaXplOiBmdW5jdGlvbihqaWQsIG1lc3NhZ2UpCiAgICB7CiAgICAgICAgdmFyIHByZXMgPSAkcHJlcyh7dG86IGppZCwgdHlwZTogInVuc3Vic2NyaWJlZCJ9KTsKICAgICAgICBpZiAobWVzc2FnZSAmJiBtZXNzYWdlICE9PSAiIikKICAgICAgICAgICAgcHJlcy5jKCJzdGF0dXMiKS50KG1lc3NhZ2UpOwogICAgICAgIHRoaXMuX2Nvbm5lY3Rpb24uc2VuZChwcmVzKTsKICAgIH0sCiAgICAvKiogRnVuY3Rpb246IGFkZAogICAgICogQWRkIHJvc3RlciBpdGVtCiAgICAgKgogICAgICogUGFyYW1ldGVyczoKICAgICAqICAgKFN0cmluZykgamlkIC0gaXRlbSBqaWQKICAgICAqICAgKFN0cmluZykgbmFtZSAtIG5hbWUKICAgICAqICAgKEFycmF5KSBncm91cHMKICAgICAqICAgKEZ1bmN0aW9uKSBjYWxsX2JhY2sKICAgICAqLwogICAgYWRkOiBmdW5jdGlvbihqaWQsIG5hbWUsIGdyb3VwcywgY2FsbF9iYWNrKQogICAgewogICAgICAgIHZhciBpcSA9ICRpcSh7dHlwZTogJ3NldCd9KS5jKCdxdWVyeScsIHt4bWxuczogU3Ryb3BoZS5OUy5ST1NURVJ9KS5jKCdpdGVtJywge2ppZDogamlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IG5hbWV9KTsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGdyb3Vwcy5sZW5ndGg7IGkrKykKICAgICAgICB7CiAgICAgICAgICAgIGlxLmMoJ2dyb3VwJykudChncm91cHNbaV0pLnVwKCk7CiAgICAgICAgfQogICAgICAgIHRoaXMuX2Nvbm5lY3Rpb24uc2VuZElRKGlxLCBjYWxsX2JhY2ssIGNhbGxfYmFjayk7CiAgICB9LAogICAgLyoqIEZ1bmN0aW9uOiB1cGRhdGUKICAgICAqIFVwZGF0ZSByb3N0ZXIgaXRlbQogICAgICoKICAgICAqIFBhcmFtZXRlcnM6CiAgICAgKiAgIChTdHJpbmcpIGppZCAtIGl0ZW0gamlkCiAgICAgKiAgIChTdHJpbmcpIG5hbWUgLSBuYW1lCiAgICAgKiAgIChBcnJheSkgZ3JvdXBzCiAgICAgKiAgIChGdW5jdGlvbikgY2FsbF9iYWNrCiAgICAgKi8KICAgIHVwZGF0ZTogZnVuY3Rpb24oamlkLCBuYW1lLCBncm91cHMsIGNhbGxfYmFjaykKICAgIHsKICAgICAgICB2YXIgaXRlbSA9IHRoaXMuZmluZEl0ZW0oamlkKTsKICAgICAgICBpZiAoIWl0ZW0pCiAgICAgICAgewogICAgICAgICAgICB0aHJvdyAiaXRlbSBub3QgZm91bmQiOwogICAgICAgIH0KICAgICAgICB2YXIgbmV3TmFtZSA9IG5hbWUgfHwgaXRlbS5uYW1lOwogICAgICAgIHZhciBuZXdHcm91cHMgPSBncm91cHMgfHwgaXRlbS5ncm91cHM7CiAgICAgICAgdmFyIGlxID0gJGlxKHt0eXBlOiAnc2V0J30pLmMoJ3F1ZXJ5Jywge3htbG5zOiBTdHJvcGhlLk5TLlJPU1RFUn0pLmMoJ2l0ZW0nLCB7amlkOiBpdGVtLmppZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBuZXdOYW1lfSk7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBuZXdHcm91cHMubGVuZ3RoOyBpKyspCiAgICAgICAgewogICAgICAgICAgICBpcS5jKCdncm91cCcpLnQobmV3R3JvdXBzW2ldKS51cCgpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpcy5fY29ubmVjdGlvbi5zZW5kSVEoaXEsIGNhbGxfYmFjaywgY2FsbF9iYWNrKTsKICAgIH0sCiAgICAvKiogRnVuY3Rpb246IHJlbW92ZQogICAgICogUmVtb3ZlIHJvc3RlciBpdGVtCiAgICAgKgogICAgICogUGFyYW1ldGVyczoKICAgICAqICAgKFN0cmluZykgamlkIC0gaXRlbSBqaWQKICAgICAqICAgKEZ1bmN0aW9uKSBjYWxsX2JhY2sKICAgICAqLwogICAgcmVtb3ZlOiBmdW5jdGlvbihqaWQsIGNhbGxfYmFjaykKICAgIHsKICAgICAgICB2YXIgaXRlbSA9IHRoaXMuZmluZEl0ZW0oamlkKTsKICAgICAgICBpZiAoIWl0ZW0pCiAgICAgICAgewogICAgICAgICAgICB0aHJvdyAiaXRlbSBub3QgZm91bmQiOwogICAgICAgIH0KICAgICAgICB2YXIgaXEgPSAkaXEoe3R5cGU6ICdzZXQnfSkuYygncXVlcnknLCB7eG1sbnM6IFN0cm9waGUuTlMuUk9TVEVSfSkuYygnaXRlbScsIHtqaWQ6IGl0ZW0uamlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1YnNjcmlwdGlvbjogInJlbW92ZSJ9KTsKICAgICAgICB0aGlzLl9jb25uZWN0aW9uLnNlbmRJUShpcSwgY2FsbF9iYWNrLCBjYWxsX2JhY2spOwogICAgfSwKICAgIC8qKiBQcml2YXRlRnVuY3Rpb246IF9vblJlY2VpdmVSb3N0ZXJTdWNjZXNzCiAgICAgKgogICAgICovCiAgICBfb25SZWNlaXZlUm9zdGVyU3VjY2VzczogZnVuY3Rpb24odXNlckNhbGxiYWNrLCBzdGFuemEpCiAgICB7CiAgICAgICAgdGhpcy5fdXBkYXRlSXRlbXMoc3RhbnphKTsKICAgICAgICBpZiAodHlwZW9mIHVzZXJDYWxsYmFjayA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICB1c2VyQ2FsbGJhY2sodGhpcy5pdGVtcyk7CiAgICAgICAgfQogICAgfSwKICAgIC8qKiBQcml2YXRlRnVuY3Rpb246IF9vblJlY2VpdmVSb3N0ZXJFcnJvcgogICAgICoKICAgICAqLwogICAgX29uUmVjZWl2ZVJvc3RlckVycm9yOiBmdW5jdGlvbih1c2VyQ2FsbGJhY2ssIHN0YW56YSkKICAgIHsKICAgICAgICB1c2VyQ2FsbGJhY2sodGhpcy5pdGVtcyk7CiAgICB9LAogICAgLyoqIFByaXZhdGVGdW5jdGlvbjogX29uUmVjZWl2ZVByZXNlbmNlCiAgICAgKiBIYW5kbGUgcHJlc2VuY2UKICAgICAqLwogICAgX29uUmVjZWl2ZVByZXNlbmNlIDogZnVuY3Rpb24ocHJlc2VuY2UpCiAgICB7CiAgICAgICAgLy8gVE9ETzogZnJvbSBpcyBvcHRpb25hbAogICAgICAgIHZhciBqaWQgPSBwcmVzZW5jZS5nZXRBdHRyaWJ1dGUoJ2Zyb20nKTsKICAgICAgICB2YXIgZnJvbSA9IFN0cm9waGUuZ2V0QmFyZUppZEZyb21KaWQoamlkKTsKICAgICAgICB2YXIgaXRlbSA9IHRoaXMuZmluZEl0ZW0oZnJvbSk7CiAgICAgICAgLy8gbm90IGluIHJvc3RlcgogICAgICAgIGlmICghaXRlbSkKICAgICAgICB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICB2YXIgdHlwZSA9IHByZXNlbmNlLmdldEF0dHJpYnV0ZSgndHlwZScpOwogICAgICAgIGlmICh0eXBlID09ICd1bmF2YWlsYWJsZScpCiAgICAgICAgewogICAgICAgICAgICBkZWxldGUgaXRlbS5yZXNvdXJjZXNbU3Ryb3BoZS5nZXRSZXNvdXJjZUZyb21KaWQoamlkKV07CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKCF0eXBlKQogICAgICAgIHsKICAgICAgICAgICAgLy8gVE9ETzogYWRkIHRpbWVzdGFtcAogICAgICAgICAgICBpdGVtLnJlc291cmNlc1tTdHJvcGhlLmdldFJlc291cmNlRnJvbUppZChqaWQpXSA9IHsKICAgICAgICAgICAgICAgIHNob3cgICAgIDogKHByZXNlbmNlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdzaG93JykubGVuZ3RoICE9PSAwKSA/IFN0cm9waGUuZ2V0VGV4dChwcmVzZW5jZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc2hvdycpWzBdKSA6ICIiLAogICAgICAgICAgICAgICAgc3RhdHVzICAgOiAocHJlc2VuY2UuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3N0YXR1cycpLmxlbmd0aCAhPT0gMCkgPyBTdHJvcGhlLmdldFRleHQocHJlc2VuY2UuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3N0YXR1cycpWzBdKSA6ICIiLAogICAgICAgICAgICAgICAgcHJpb3JpdHkgOiAocHJlc2VuY2UuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3ByaW9yaXR5JykubGVuZ3RoICE9PSAwKSA/IFN0cm9waGUuZ2V0VGV4dChwcmVzZW5jZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgncHJpb3JpdHknKVswXSkgOiAiIgogICAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICBlbHNlCiAgICAgICAgewogICAgICAgICAgICAvLyBTdGFuemEgaXMgbm90IGEgcHJlc2VuY2Ugbm90aWZpY2F0aW9uLiAoSXQncyBwcm9iYWJseSBhIHN1YnNjcmlwdGlvbiB0eXBlIHN0YW56YS4pCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICB0aGlzLl9jYWxsX2JhY2tzKHRoaXMuaXRlbXMsIGl0ZW0pOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfSwKICAgIC8qKiBQcml2YXRlRnVuY3Rpb246IF9jYWxsX2JhY2tzCiAgICAgKgogICAgICovCiAgICBfY2FsbF9iYWNrcyA6IGZ1bmN0aW9uKGl0ZW1zLCBpdGVtKQogICAgewogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5fY2FsbGJhY2tzLmxlbmd0aDsgaSsrKSAvLyBbXS5mb3JFYWNoIG15IGxvdmUgLi4uCiAgICAgICAgewogICAgICAgICAgICB0aGlzLl9jYWxsYmFja3NbaV0oaXRlbXMsIGl0ZW0pOwogICAgICAgIH0KICAgIH0sCiAgICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiBfb25SZWNlaXZlSVEKICAgICAqIEhhbmRsZSByb3N0ZXIgcHVzaC4KICAgICAqLwogICAgX29uUmVjZWl2ZUlRIDogZnVuY3Rpb24oaXEpCiAgICB7CiAgICAgICAgdmFyIGlkID0gaXEuZ2V0QXR0cmlidXRlKCdpZCcpOwogICAgICAgIHZhciBmcm9tID0gaXEuZ2V0QXR0cmlidXRlKCdmcm9tJyk7CiAgICAgICAgLy8gUmVjZWl2aW5nIGNsaWVudCBNVVNUIGlnbm9yZSBzdGFuemEgdW5sZXNzIGl0IGhhcyBubyBmcm9tIG9yIGZyb20gPSB1c2VyJ3MgSklELgogICAgICAgIGlmIChmcm9tICYmIGZyb20gIT09ICIiICYmIGZyb20gIT0gdGhpcy5fY29ubmVjdGlvbi5qaWQgJiYgZnJvbSAhPSBTdHJvcGhlLmdldEJhcmVKaWRGcm9tSmlkKHRoaXMuX2Nvbm5lY3Rpb24uamlkKSkKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgdmFyIGlxcmVzdWx0ID0gJGlxKHt0eXBlOiAncmVzdWx0JywgaWQ6IGlkLCBmcm9tOiB0aGlzLl9jb25uZWN0aW9uLmppZH0pOwogICAgICAgIHRoaXMuX2Nvbm5lY3Rpb24uc2VuZChpcXJlc3VsdCk7CiAgICAgICAgdGhpcy5fdXBkYXRlSXRlbXMoaXEpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfSwKICAgIC8qKiBQcml2YXRlRnVuY3Rpb246IF91cGRhdGVJdGVtcwogICAgICogVXBkYXRlIGl0ZW1zIGZyb20gaXEKICAgICAqLwogICAgX3VwZGF0ZUl0ZW1zIDogZnVuY3Rpb24oaXEpCiAgICB7CiAgICAgICAgdmFyIHF1ZXJ5ID0gaXEuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3F1ZXJ5Jyk7CiAgICAgICAgaWYgKHF1ZXJ5Lmxlbmd0aCAhPT0gMCkKICAgICAgICB7CiAgICAgICAgICAgIHRoaXMudmVyID0gcXVlcnkuaXRlbSgwKS5nZXRBdHRyaWJ1dGUoJ3ZlcicpOwogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgICAgIFN0cm9waGUuZm9yRWFjaENoaWxkKHF1ZXJ5Lml0ZW0oMCksICdpdGVtJywKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChpdGVtKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIHNlbGYuX3VwZGF0ZUl0ZW0oaXRlbSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5fY2FsbF9iYWNrcyh0aGlzLml0ZW1zKTsKICAgIH0sCiAgICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiBfdXBkYXRlSXRlbQogICAgICogVXBkYXRlIGludGVybmFsIHJlcHJlc2VudGF0aW9uIG9mIHJvc3RlciBpdGVtCiAgICAgKi8KICAgIF91cGRhdGVJdGVtIDogZnVuY3Rpb24oaXRlbSkKICAgIHsKICAgICAgICB2YXIgamlkICAgICAgICAgICA9IGl0ZW0uZ2V0QXR0cmlidXRlKCJqaWQiKTsKICAgICAgICB2YXIgbmFtZSAgICAgICAgICA9IGl0ZW0uZ2V0QXR0cmlidXRlKCJuYW1lIik7CiAgICAgICAgdmFyIHN1YnNjcmlwdGlvbiAgPSBpdGVtLmdldEF0dHJpYnV0ZSgic3Vic2NyaXB0aW9uIik7CiAgICAgICAgdmFyIGFzayAgICAgICAgICAgPSBpdGVtLmdldEF0dHJpYnV0ZSgiYXNrIik7CiAgICAgICAgdmFyIGdyb3VwcyAgICAgICAgPSBbXTsKICAgICAgICBTdHJvcGhlLmZvckVhY2hDaGlsZChpdGVtLCAnZ3JvdXAnLAogICAgICAgICAgICBmdW5jdGlvbihncm91cCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgZ3JvdXBzLnB1c2goU3Ryb3BoZS5nZXRUZXh0KGdyb3VwKSk7CiAgICAgICAgICAgIH0KICAgICAgICApOwoKICAgICAgICBpZiAoc3Vic2NyaXB0aW9uID09ICJyZW1vdmUiKQogICAgICAgIHsKICAgICAgICAgICAgdGhpcy5yZW1vdmVJdGVtKGppZCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGl0ZW0gPSB0aGlzLmZpbmRJdGVtKGppZCk7CiAgICAgICAgaWYgKCFpdGVtKQogICAgICAgIHsKICAgICAgICAgICAgdGhpcy5pdGVtcy5wdXNoKHsKICAgICAgICAgICAgICAgIG5hbWUgICAgICAgICA6IG5hbWUsCiAgICAgICAgICAgICAgICBqaWQgICAgICAgICAgOiBqaWQsCiAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb24gOiBzdWJzY3JpcHRpb24sCiAgICAgICAgICAgICAgICBhc2sgICAgICAgICAgOiBhc2ssCiAgICAgICAgICAgICAgICBncm91cHMgICAgICAgOiBncm91cHMsCiAgICAgICAgICAgICAgICByZXNvdXJjZXMgICAgOiB7fQogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgaXRlbS5uYW1lID0gbmFtZTsKICAgICAgICAgICAgaXRlbS5zdWJzY3JpcHRpb24gPSBzdWJzY3JpcHRpb247CiAgICAgICAgICAgIGl0ZW0uYXNrID0gYXNrOwogICAgICAgICAgICBpdGVtLmdyb3VwcyA9IGdyb3VwczsKICAgICAgICB9CiAgICB9Cn0pOwoKZGVmaW5lKCJzdHJvcGhlLnJvc3RlciIsIFsic3Ryb3BoZSJdLCBmdW5jdGlvbigpe30pOwoKLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjMuMwovKgpQbHVnaW4gdG8gaW1wbGVtZW50IHRoZSB2Q2FyZCBleHRlbnNpb24uCmh0dHA6Ly94bXBwLm9yZy9leHRlbnNpb25zL3hlcC0wMDU0Lmh0bWwKCkF1dGhvcjogTmF0aGFuIFpvcm4gKG5hdGhhbi56b3JuQGdtYWlsLmNvbSkKQ29mZmVlU2NyaXB0IHBvcnQ6IEFuZHJlYXMgR3V0aCAoZ3V0aEBkYmlzLnJ3dGgtYWFjaGVuLmRlKQoqLwoKLyoganNsaW50IGNvbmZpZ3VyYXRpb246CiovCgovKiBnbG9iYWwgZG9jdW1lbnQsIHdpbmRvdywgc2V0VGltZW91dCwgY2xlYXJUaW1lb3V0LCBjb25zb2xlLAogICAgWE1MSHR0cFJlcXVlc3QsIEFjdGl2ZVhPYmplY3QsCiAgICBCYXNlNjQsIE1ENSwKICAgIFN0cm9waGUsICRidWlsZCwgJG1zZywgJGlxLCAkcHJlcwoqLwoKdmFyIGJ1aWxkSXE7CgpidWlsZElxID0gZnVuY3Rpb24odHlwZSwgamlkLCB2Q2FyZEVsKSB7CiAgdmFyIGlxOwogIGlxID0gJGlxKGppZCA/IHsKICAgIHR5cGU6IHR5cGUsCiAgICB0bzogamlkCiAgfSA6IHsKICAgIHR5cGU6IHR5cGUKICB9KTsKICBpcS5jKCJ2Q2FyZCIsIHsKICAgIHhtbG5zOiBTdHJvcGhlLk5TLlZDQVJECiAgfSk7CiAgaWYgKHZDYXJkRWwpIHsKICAgIGlxLmNub2RlKHZDYXJkRWwpOwogIH0KICByZXR1cm4gaXE7Cn07CgpTdHJvcGhlLmFkZENvbm5lY3Rpb25QbHVnaW4oJ3ZjYXJkJywgewogIF9jb25uZWN0aW9uOiBudWxsLAogIGluaXQ6IGZ1bmN0aW9uKGNvbm4pIHsKICAgIHRoaXMuX2Nvbm5lY3Rpb24gPSBjb25uOwogICAgcmV0dXJuIFN0cm9waGUuYWRkTmFtZXNwYWNlKCdWQ0FSRCcsICd2Y2FyZC10ZW1wJyk7CiAgfSwKICAvKkZ1bmN0aW9uCiAgICBSZXRyaWV2ZSBhIHZDYXJkIGZvciBhIEpJRC9FbnRpdHkKICAgIFBhcmFtZXRlcnM6CiAgICAoRnVuY3Rpb24pIGhhbmRsZXJfY2IgLSBUaGUgY2FsbGJhY2sgZnVuY3Rpb24gdXNlZCB0byBoYW5kbGUgdGhlIHJlcXVlc3QuCiAgICAoU3RyaW5nKSBqaWQgLSBvcHRpb25hbCAtIFRoZSBuYW1lIG9mIHRoZSBlbnRpdHkgdG8gcmVxdWVzdCB0aGUgdkNhcmQKICAgICAgIElmIG5vIGppZCBpcyBnaXZlbiwgdGhpcyBmdW5jdGlvbiByZXRyaWV2ZXMgdGhlIGN1cnJlbnQgdXNlcidzIHZjYXJkLgogICovCgogIGdldDogZnVuY3Rpb24oaGFuZGxlcl9jYiwgamlkLCBlcnJvcl9jYikgewogICAgdmFyIGlxOwogICAgaXEgPSBidWlsZElxKCJnZXQiLCBqaWQpOwogICAgcmV0dXJuIHRoaXMuX2Nvbm5lY3Rpb24uc2VuZElRKGlxLCBoYW5kbGVyX2NiLCBlcnJvcl9jYik7CiAgfSwKICAvKiBGdW5jdGlvbgogICAgICBTZXQgYW4gZW50aXR5J3MgdkNhcmQuCiAgKi8KCiAgc2V0OiBmdW5jdGlvbihoYW5kbGVyX2NiLCB2Q2FyZEVsLCBqaWQsIGVycm9yX2NiKSB7CiAgICB2YXIgaXE7CiAgICBpcSA9IGJ1aWxkSXEoInNldCIsIGppZCwgdkNhcmRFbCk7CiAgICByZXR1cm4gdGhpcy5fY29ubmVjdGlvbi5zZW5kSVEoaXEsIGhhbmRsZXJfY2IsIGVycm9yX3JiKTsKICB9Cn0pOwoKZGVmaW5lKCJzdHJvcGhlLnZjYXJkIiwgWyJzdHJvcGhlIl0sIGZ1bmN0aW9uKCl7fSk7CgovKgogIENvcHlyaWdodCAyMDEwLCBGcmFuw6dvaXMgZGUgTWV0eiA8ZnJhbmNvaXNAMm1ldHouZnI+CiovCgovKioKICogRGlzY28gU3Ryb3BoZSBQbHVnaW4KICogSW1wbGVtZW50IGh0dHA6Ly94bXBwLm9yZy9leHRlbnNpb25zL3hlcC0wMDMwLmh0bWwKICogVE9ETzogbWFuYWdlIG5vZGUgaGllcmFyY2hpZXMsIGFuZCBub2RlIG9uIGluZm8gcmVxdWVzdAogKi8KU3Ryb3BoZS5hZGRDb25uZWN0aW9uUGx1Z2luKCdkaXNjbycsCnsKICAgIF9jb25uZWN0aW9uOiBudWxsLAogICAgX2lkZW50aXRpZXMgOiBbXSwKICAgIF9mZWF0dXJlcyA6IFtdLAogICAgX2l0ZW1zIDogW10sCiAgICAvKiogRnVuY3Rpb246IGluaXQKICAgICAqIFBsdWdpbiBpbml0CiAgICAgKgogICAgICogUGFyYW1ldGVyczoKICAgICAqICAgKFN0cm9waGUuQ29ubmVjdGlvbikgY29ubiAtIFN0cm9waGUgY29ubmVjdGlvbgogICAgICovCiAgICBpbml0OiBmdW5jdGlvbihjb25uKQogICAgewogICAgdGhpcy5fY29ubmVjdGlvbiA9IGNvbm47CiAgICAgICAgdGhpcy5faWRlbnRpdGllcyA9IFtdOwogICAgICAgIHRoaXMuX2ZlYXR1cmVzICAgPSBbXTsKICAgICAgICB0aGlzLl9pdGVtcyAgICAgID0gW107CiAgICAgICAgLy8gZGlzY28gaW5mbwogICAgICAgIGNvbm4uYWRkSGFuZGxlcih0aGlzLl9vbkRpc2NvSW5mby5iaW5kKHRoaXMpLCBTdHJvcGhlLk5TLkRJU0NPX0lORk8sICdpcScsICdnZXQnLCBudWxsLCBudWxsKTsKICAgICAgICAvLyBkaXNjbyBpdGVtcwogICAgICAgIGNvbm4uYWRkSGFuZGxlcih0aGlzLl9vbkRpc2NvSXRlbXMuYmluZCh0aGlzKSwgU3Ryb3BoZS5OUy5ESVNDT19JVEVNUywgJ2lxJywgJ2dldCcsIG51bGwsIG51bGwpOwogICAgfSwKICAgIC8qKiBGdW5jdGlvbjogYWRkSWRlbnRpdHkKICAgICAqIFNlZSBodHRwOi8veG1wcC5vcmcvcmVnaXN0cmFyL2Rpc2NvLWNhdGVnb3JpZXMuaHRtbAogICAgICogUGFyYW1ldGVyczoKICAgICAqICAgKFN0cmluZykgY2F0ZWdvcnkgLSBjYXRlZ29yeSBvZiBpZGVudGl0eSAobGlrZSBjbGllbnQsIGF1dG9tYXRpb24sIGV0YyAuLi4pCiAgICAgKiAgIChTdHJpbmcpIHR5cGUgLSB0eXBlIG9mIGlkZW50aXR5IChsaWtlIHBjLCB3ZWIsIGJvdCAsIGV0YyAuLi4pCiAgICAgKiAgIChTdHJpbmcpIG5hbWUgLSBuYW1lIG9mIGlkZW50aXR5IGluIG5hdHVyYWwgbGFuZ3VhZ2UKICAgICAqICAgKFN0cmluZykgbGFuZyAtIGxhbmcgb2YgbmFtZSBwYXJhbWV0ZXIKICAgICAqCiAgICAgKiBSZXR1cm5zOgogICAgICogICBCb29sZWFuCiAgICAgKi8KICAgIGFkZElkZW50aXR5OiBmdW5jdGlvbihjYXRlZ29yeSwgdHlwZSwgbmFtZSwgbGFuZykKICAgIHsKICAgICAgICBmb3IgKHZhciBpPTA7IGk8dGhpcy5faWRlbnRpdGllcy5sZW5ndGg7IGkrKykKICAgICAgICB7CiAgICAgICAgICAgIGlmICh0aGlzLl9pZGVudGl0aWVzW2ldLmNhdGVnb3J5ID09IGNhdGVnb3J5ICYmCiAgICAgICAgICAgICAgICB0aGlzLl9pZGVudGl0aWVzW2ldLnR5cGUgPT0gdHlwZSAmJgogICAgICAgICAgICAgICAgdGhpcy5faWRlbnRpdGllc1tpXS5uYW1lID09IG5hbWUgJiYKICAgICAgICAgICAgICAgIHRoaXMuX2lkZW50aXRpZXNbaV0ubGFuZyA9PSBsYW5nKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdGhpcy5faWRlbnRpdGllcy5wdXNoKHtjYXRlZ29yeTogY2F0ZWdvcnksIHR5cGU6IHR5cGUsIG5hbWU6IG5hbWUsIGxhbmc6IGxhbmd9KTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0sCiAgICAvKiogRnVuY3Rpb246IGFkZEZlYXR1cmUKICAgICAqCiAgICAgKiBQYXJhbWV0ZXJzOgogICAgICogICAoU3RyaW5nKSB2YXJfbmFtZSAtIGZlYXR1cmUgbmFtZSAobGlrZSBqYWJiZXI6aXE6dmVyc2lvbikKICAgICAqCiAgICAgKiBSZXR1cm5zOgogICAgICogICBib29sZWFuCiAgICAgKi8KICAgIGFkZEZlYXR1cmU6IGZ1bmN0aW9uKHZhcl9uYW1lKQogICAgewogICAgICAgIGZvciAodmFyIGk9MDsgaTx0aGlzLl9mZWF0dXJlcy5sZW5ndGg7IGkrKykKICAgICAgICB7CiAgICAgICAgICAgICBpZiAodGhpcy5fZmVhdHVyZXNbaV0gPT0gdmFyX25hbWUpCiAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICB0aGlzLl9mZWF0dXJlcy5wdXNoKHZhcl9uYW1lKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0sCiAgICAvKiogRnVuY3Rpb246IHJlbW92ZUZlYXR1cmUKICAgICAqCiAgICAgKiBQYXJhbWV0ZXJzOgogICAgICogICAoU3RyaW5nKSB2YXJfbmFtZSAtIGZlYXR1cmUgbmFtZSAobGlrZSBqYWJiZXI6aXE6dmVyc2lvbikKICAgICAqCiAgICAgKiBSZXR1cm5zOgogICAgICogICBib29sZWFuCiAgICAgKi8KICAgIHJlbW92ZUZlYXR1cmU6IGZ1bmN0aW9uKHZhcl9uYW1lKQogICAgewogICAgICAgIGZvciAodmFyIGk9MDsgaTx0aGlzLl9mZWF0dXJlcy5sZW5ndGg7IGkrKykKICAgICAgICB7CiAgICAgICAgICAgICBpZiAodGhpcy5fZmVhdHVyZXNbaV0gPT09IHZhcl9uYW1lKXsKICAgICAgICAgICAgICAgICB0aGlzLl9mZWF0dXJlcy5zcGxpY2UoaSwxKQogICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9LAogICAgLyoqIEZ1bmN0aW9uOiBhZGRJdGVtCiAgICAgKgogICAgICogUGFyYW1ldGVyczoKICAgICAqICAgKFN0cmluZykgamlkCiAgICAgKiAgIChTdHJpbmcpIG5hbWUKICAgICAqICAgKFN0cmluZykgbm9kZQogICAgICogICAoRnVuY3Rpb24pIGNhbGxfYmFjawogICAgICoKICAgICAqIFJldHVybnM6CiAgICAgKiAgIGJvb2xlYW4KICAgICAqLwogICAgYWRkSXRlbTogZnVuY3Rpb24oamlkLCBuYW1lLCBub2RlLCBjYWxsX2JhY2spCiAgICB7CiAgICAgICAgaWYgKG5vZGUgJiYgIWNhbGxfYmFjaykKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIHRoaXMuX2l0ZW1zLnB1c2goe2ppZDogamlkLCBuYW1lOiBuYW1lLCBub2RlOiBub2RlLCBjYWxsX2JhY2s6IGNhbGxfYmFja30pOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfSwKICAgIC8qKiBGdW5jdGlvbjogaW5mbwogICAgICogSW5mbyBxdWVyeQogICAgICoKICAgICAqIFBhcmFtZXRlcnM6CiAgICAgKiAgIChGdW5jdGlvbikgY2FsbF9iYWNrCiAgICAgKiAgIChTdHJpbmcpIGppZAogICAgICogICAoU3RyaW5nKSBub2RlCiAgICAgKi8KICAgIGluZm86IGZ1bmN0aW9uKGppZCwgbm9kZSwgc3VjY2VzcywgZXJyb3IsIHRpbWVvdXQpCiAgICB7CiAgICAgICAgdmFyIGF0dHJzID0ge3htbG5zOiBTdHJvcGhlLk5TLkRJU0NPX0lORk99OwogICAgICAgIGlmIChub2RlKQogICAgICAgICAgICBhdHRycy5ub2RlID0gbm9kZTsKCiAgICAgICAgdmFyIGluZm8gPSAkaXEoe2Zyb206dGhpcy5fY29ubmVjdGlvbi5qaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICB0bzpqaWQsIHR5cGU6J2dldCd9KS5jKCdxdWVyeScsIGF0dHJzKTsKICAgICAgICB0aGlzLl9jb25uZWN0aW9uLnNlbmRJUShpbmZvLCBzdWNjZXNzLCBlcnJvciwgdGltZW91dCk7CiAgICB9LAogICAgLyoqIEZ1bmN0aW9uOiBpdGVtcwogICAgICogSXRlbXMgcXVlcnkKICAgICAqCiAgICAgKiBQYXJhbWV0ZXJzOgogICAgICogICAoRnVuY3Rpb24pIGNhbGxfYmFjawogICAgICogICAoU3RyaW5nKSBqaWQKICAgICAqICAgKFN0cmluZykgbm9kZQogICAgICovCiAgICBpdGVtczogZnVuY3Rpb24oamlkLCBub2RlLCBzdWNjZXNzLCBlcnJvciwgdGltZW91dCkKICAgIHsKICAgICAgICB2YXIgYXR0cnMgPSB7eG1sbnM6IFN0cm9waGUuTlMuRElTQ09fSVRFTVN9OwogICAgICAgIGlmIChub2RlKQogICAgICAgICAgICBhdHRycy5ub2RlID0gbm9kZTsKCiAgICAgICAgdmFyIGl0ZW1zID0gJGlxKHtmcm9tOnRoaXMuX2Nvbm5lY3Rpb24uamlkLAogICAgICAgICAgICAgICAgICAgICAgICAgdG86amlkLCB0eXBlOidnZXQnfSkuYygncXVlcnknLCBhdHRycyk7CiAgICAgICAgdGhpcy5fY29ubmVjdGlvbi5zZW5kSVEoaXRlbXMsIHN1Y2Nlc3MsIGVycm9yLCB0aW1lb3V0KTsKICAgIH0sCgogICAgLyoqIFByaXZhdGVGdW5jdGlvbjogX2J1aWxkSVFSZXN1bHQKICAgICAqLwogICAgX2J1aWxkSVFSZXN1bHQ6IGZ1bmN0aW9uKHN0YW56YSwgcXVlcnlfYXR0cnMpCiAgICB7CiAgICAgICAgdmFyIGlkICAgPSAgc3RhbnphLmdldEF0dHJpYnV0ZSgnaWQnKTsKICAgICAgICB2YXIgZnJvbSA9IHN0YW56YS5nZXRBdHRyaWJ1dGUoJ2Zyb20nKTsKICAgICAgICB2YXIgaXFyZXN1bHQgPSAkaXEoe3R5cGU6ICdyZXN1bHQnLCBpZDogaWR9KTsKCiAgICAgICAgaWYgKGZyb20gIT09IG51bGwpIHsKICAgICAgICAgICAgaXFyZXN1bHQuYXR0cnMoe3RvOiBmcm9tfSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gaXFyZXN1bHQuYygncXVlcnknLCBxdWVyeV9hdHRycyk7CiAgICB9LAoKICAgIC8qKiBQcml2YXRlRnVuY3Rpb246IF9vbkRpc2NvSW5mbwogICAgICogQ2FsbGVkIHdoZW4gcmVjZWl2ZSBpbmZvIHJlcXVlc3QKICAgICAqLwogICAgX29uRGlzY29JbmZvOiBmdW5jdGlvbihzdGFuemEpCiAgICB7CiAgICAgICAgdmFyIG5vZGUgPSBzdGFuemEuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3F1ZXJ5JylbMF0uZ2V0QXR0cmlidXRlKCdub2RlJyk7CiAgICAgICAgdmFyIGF0dHJzID0ge3htbG5zOiBTdHJvcGhlLk5TLkRJU0NPX0lORk99OwogICAgICAgIGlmIChub2RlKQogICAgICAgIHsKICAgICAgICAgICAgYXR0cnMubm9kZSA9IG5vZGU7CiAgICAgICAgfQogICAgICAgIHZhciBpcXJlc3VsdCA9IHRoaXMuX2J1aWxkSVFSZXN1bHQoc3RhbnphLCBhdHRycyk7CiAgICAgICAgZm9yICh2YXIgaT0wOyBpPHRoaXMuX2lkZW50aXRpZXMubGVuZ3RoOyBpKyspCiAgICAgICAgewogICAgICAgICAgICB2YXIgYXR0cnMgPSB7Y2F0ZWdvcnk6IHRoaXMuX2lkZW50aXRpZXNbaV0uY2F0ZWdvcnksCiAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlICAgIDogdGhpcy5faWRlbnRpdGllc1tpXS50eXBlfTsKICAgICAgICAgICAgaWYgKHRoaXMuX2lkZW50aXRpZXNbaV0ubmFtZSkKICAgICAgICAgICAgICAgIGF0dHJzLm5hbWUgPSB0aGlzLl9pZGVudGl0aWVzW2ldLm5hbWU7CiAgICAgICAgICAgIGlmICh0aGlzLl9pZGVudGl0aWVzW2ldLmxhbmcpCiAgICAgICAgICAgICAgICBhdHRyc1sneG1sOmxhbmcnXSA9IHRoaXMuX2lkZW50aXRpZXNbaV0ubGFuZzsKICAgICAgICAgICAgaXFyZXN1bHQuYygnaWRlbnRpdHknLCBhdHRycykudXAoKTsKICAgICAgICB9CiAgICAgICAgZm9yICh2YXIgaT0wOyBpPHRoaXMuX2ZlYXR1cmVzLmxlbmd0aDsgaSsrKQogICAgICAgIHsKICAgICAgICAgICAgaXFyZXN1bHQuYygnZmVhdHVyZScsIHsndmFyJzp0aGlzLl9mZWF0dXJlc1tpXX0pLnVwKCk7CiAgICAgICAgfQogICAgICAgIHRoaXMuX2Nvbm5lY3Rpb24uc2VuZChpcXJlc3VsdC50cmVlKCkpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfSwKICAgIC8qKiBQcml2YXRlRnVuY3Rpb246IF9vbkRpc2NvSXRlbXMKICAgICAqIENhbGxlZCB3aGVuIHJlY2VpdmUgaXRlbXMgcmVxdWVzdAogICAgICovCiAgICBfb25EaXNjb0l0ZW1zOiBmdW5jdGlvbihzdGFuemEpCiAgICB7CiAgICAgICAgdmFyIHF1ZXJ5X2F0dHJzID0ge3htbG5zOiBTdHJvcGhlLk5TLkRJU0NPX0lURU1TfTsKICAgICAgICB2YXIgbm9kZSA9IHN0YW56YS5nZXRFbGVtZW50c0J5VGFnTmFtZSgncXVlcnknKVswXS5nZXRBdHRyaWJ1dGUoJ25vZGUnKTsKICAgICAgICBpZiAobm9kZSkKICAgICAgICB7CiAgICAgICAgICAgIHF1ZXJ5X2F0dHJzLm5vZGUgPSBub2RlOwogICAgICAgICAgICB2YXIgaXRlbXMgPSBbXTsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLl9pdGVtcy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2l0ZW1zW2ldLm5vZGUgPT0gbm9kZSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBpdGVtcyA9IHRoaXMuX2l0ZW1zW2ldLmNhbGxfYmFjayhzdGFuemEpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgIHZhciBpdGVtcyA9IHRoaXMuX2l0ZW1zOwogICAgICAgIH0KICAgICAgICB2YXIgaXFyZXN1bHQgPSB0aGlzLl9idWlsZElRUmVzdWx0KHN0YW56YSwgcXVlcnlfYXR0cnMpOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaXRlbXMubGVuZ3RoOyBpKyspCiAgICAgICAgewogICAgICAgICAgICB2YXIgYXR0cnMgPSB7amlkOiAgaXRlbXNbaV0uamlkfTsKICAgICAgICAgICAgaWYgKGl0ZW1zW2ldLm5hbWUpCiAgICAgICAgICAgICAgICBhdHRycy5uYW1lID0gaXRlbXNbaV0ubmFtZTsKICAgICAgICAgICAgaWYgKGl0ZW1zW2ldLm5vZGUpCiAgICAgICAgICAgICAgICBhdHRycy5ub2RlID0gaXRlbXNbaV0ubm9kZTsKICAgICAgICAgICAgaXFyZXN1bHQuYygnaXRlbScsIGF0dHJzKS51cCgpOwogICAgICAgIH0KICAgICAgICB0aGlzLl9jb25uZWN0aW9uLnNlbmQoaXFyZXN1bHQudHJlZSgpKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KfSk7CgpkZWZpbmUoInN0cm9waGUuZGlzY28iLCBbInN0cm9waGUiXSwgZnVuY3Rpb24oKXt9KTsKCmRlZmluZSgiY29udmVyc2UtZGVwZW5kZW5jaWVzIiwgWwogICAgImpxdWVyeSIsCiAgICAidXRpbHMiLAogICAgIm90ciIsCiAgICAibW9tZW50IiwKICAgICJsb2NhbGVzIiwKICAgICJiYWNrYm9uZS5icm93c2VyU3RvcmFnZSIsCiAgICAiYmFja2JvbmUub3ZlcnZpZXciLAogICAgImpxdWVyeS5icm93c2VyIiwKICAgICJ0eXBlYWhlYWQiLAogICAgInN0cm9waGUiLAogICAgInN0cm9waGUubXVjIiwKICAgICJzdHJvcGhlLnJvc3RlciIsCiAgICAic3Ryb3BoZS52Y2FyZCIsCiAgICAic3Ryb3BoZS5kaXNjbyIKXSwgZnVuY3Rpb24oJCwgdXRpbHMsIG90ciwgbW9tZW50KSB7CiAgICByZXR1cm4gewogICAgICAgICdqUXVlcnknOiAkLAogICAgICAgICdtb21lbnQnOiBtb21lbnQsCiAgICAgICAgJ290cic6IG90ciwKICAgICAgICAndXRpbHMnOiB1dGlscwogICAgfTsKfSk7CgovKioKICogQGxpY2Vuc2UgUmVxdWlyZUpTIHRleHQgMi4wLjEyIENvcHlyaWdodCAoYykgMjAxMC0yMDE0LCBUaGUgRG9qbyBGb3VuZGF0aW9uIEFsbCBSaWdodHMgUmVzZXJ2ZWQuCiAqIEF2YWlsYWJsZSB2aWEgdGhlIE1JVCBvciBuZXcgQlNEIGxpY2Vuc2UuCiAqIHNlZTogaHR0cDovL2dpdGh1Yi5jb20vcmVxdWlyZWpzL3RleHQgZm9yIGRldGFpbHMKICovCi8qanNsaW50IHJlZ2V4cDogdHJ1ZSAqLwovKmdsb2JhbCByZXF1aXJlLCBYTUxIdHRwUmVxdWVzdCwgQWN0aXZlWE9iamVjdCwKICBkZWZpbmUsIHdpbmRvdywgcHJvY2VzcywgUGFja2FnZXMsCiAgamF2YSwgbG9jYXRpb24sIENvbXBvbmVudHMsIEZpbGVVdGlscyAqLwoKZGVmaW5lKCd0ZXh0JyxbJ21vZHVsZSddLCBmdW5jdGlvbiAobW9kdWxlKSB7CiAgICAKCiAgICB2YXIgdGV4dCwgZnMsIENjLCBDaSwgeHBjSXNXaW5kb3dzLAogICAgICAgIHByb2dJZHMgPSBbJ01zeG1sMi5YTUxIVFRQJywgJ01pY3Jvc29mdC5YTUxIVFRQJywgJ01zeG1sMi5YTUxIVFRQLjQuMCddLAogICAgICAgIHhtbFJlZ0V4cCA9IC9eXHMqPFw/eG1sKFxzKSt2ZXJzaW9uPVtcJ1wiXShcZCkqLihcZCkqW1wnXCJdKFxzKSpcPz4vaW0sCiAgICAgICAgYm9keVJlZ0V4cCA9IC88Ym9keVtePl0qPlxzKihbXHNcU10rKVxzKjxcL2JvZHk+L2ltLAogICAgICAgIGhhc0xvY2F0aW9uID0gdHlwZW9mIGxvY2F0aW9uICE9PSAndW5kZWZpbmVkJyAmJiBsb2NhdGlvbi5ocmVmLAogICAgICAgIGRlZmF1bHRQcm90b2NvbCA9IGhhc0xvY2F0aW9uICYmIGxvY2F0aW9uLnByb3RvY29sICYmIGxvY2F0aW9uLnByb3RvY29sLnJlcGxhY2UoL1w6LywgJycpLAogICAgICAgIGRlZmF1bHRIb3N0TmFtZSA9IGhhc0xvY2F0aW9uICYmIGxvY2F0aW9uLmhvc3RuYW1lLAogICAgICAgIGRlZmF1bHRQb3J0ID0gaGFzTG9jYXRpb24gJiYgKGxvY2F0aW9uLnBvcnQgfHwgdW5kZWZpbmVkKSwKICAgICAgICBidWlsZE1hcCA9IHt9LAogICAgICAgIG1hc3RlckNvbmZpZyA9IChtb2R1bGUuY29uZmlnICYmIG1vZHVsZS5jb25maWcoKSkgfHwge307CgogICAgdGV4dCA9IHsKICAgICAgICB2ZXJzaW9uOiAnMi4wLjEyJywKCiAgICAgICAgc3RyaXA6IGZ1bmN0aW9uIChjb250ZW50KSB7CiAgICAgICAgICAgIC8vU3RyaXBzIDw/eG1sIC4uLj8+IGRlY2xhcmF0aW9ucyBzbyB0aGF0IGV4dGVybmFsIFNWRyBhbmQgWE1MCiAgICAgICAgICAgIC8vZG9jdW1lbnRzIGNhbiBiZSBhZGRlZCB0byBhIGRvY3VtZW50IHdpdGhvdXQgd29ycnkuIEFsc28sIGlmIHRoZSBzdHJpbmcKICAgICAgICAgICAgLy9pcyBhbiBIVE1MIGRvY3VtZW50LCBvbmx5IHRoZSBwYXJ0IGluc2lkZSB0aGUgYm9keSB0YWcgaXMgcmV0dXJuZWQuCiAgICAgICAgICAgIGlmIChjb250ZW50KSB7CiAgICAgICAgICAgICAgICBjb250ZW50ID0gY29udGVudC5yZXBsYWNlKHhtbFJlZ0V4cCwgIiIpOwogICAgICAgICAgICAgICAgdmFyIG1hdGNoZXMgPSBjb250ZW50Lm1hdGNoKGJvZHlSZWdFeHApOwogICAgICAgICAgICAgICAgaWYgKG1hdGNoZXMpIHsKICAgICAgICAgICAgICAgICAgICBjb250ZW50ID0gbWF0Y2hlc1sxXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnRlbnQgPSAiIjsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gY29udGVudDsKICAgICAgICB9LAoKICAgICAgICBqc0VzY2FwZTogZnVuY3Rpb24gKGNvbnRlbnQpIHsKICAgICAgICAgICAgcmV0dXJuIGNvbnRlbnQucmVwbGFjZSgvKFsnXFxdKS9nLCAnXFwkMScpCiAgICAgICAgICAgICAgICAucmVwbGFjZSgvW1xmXS9nLCAiXFxmIikKICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9bXGJdL2csICJcXGIiKQogICAgICAgICAgICAgICAgLnJlcGxhY2UoL1tcbl0vZywgIlxcbiIpCiAgICAgICAgICAgICAgICAucmVwbGFjZSgvW1x0XS9nLCAiXFx0IikKICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9bXHJdL2csICJcXHIiKQogICAgICAgICAgICAgICAgLnJlcGxhY2UoL1tcdTIwMjhdL2csICJcXHUyMDI4IikKICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9bXHUyMDI5XS9nLCAiXFx1MjAyOSIpOwogICAgICAgIH0sCgogICAgICAgIGNyZWF0ZVhocjogbWFzdGVyQ29uZmlnLmNyZWF0ZVhociB8fCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIC8vV291bGQgbG92ZSB0byBkdW1wIHRoZSBBY3RpdmVYIGNyYXAgaW4gaGVyZS4gTmVlZCBJRSA2IHRvIGRpZSBmaXJzdC4KICAgICAgICAgICAgdmFyIHhociwgaSwgcHJvZ0lkOwogICAgICAgICAgICBpZiAodHlwZW9mIFhNTEh0dHBSZXF1ZXN0ICE9PSAidW5kZWZpbmVkIikgewogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBYTUxIdHRwUmVxdWVzdCgpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBBY3RpdmVYT2JqZWN0ICE9PSAidW5kZWZpbmVkIikgewogICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IDM7IGkgKz0gMSkgewogICAgICAgICAgICAgICAgICAgIHByb2dJZCA9IHByb2dJZHNbaV07CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgeGhyID0gbmV3IEFjdGl2ZVhPYmplY3QocHJvZ0lkKTsKICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7fQoKICAgICAgICAgICAgICAgICAgICBpZiAoeGhyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHByb2dJZHMgPSBbcHJvZ0lkXTsgIC8vIHNvIGZhc3RlciBuZXh0IHRpbWUKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4geGhyOwogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIFBhcnNlcyBhIHJlc291cmNlIG5hbWUgaW50byBpdHMgY29tcG9uZW50IHBhcnRzLiBSZXNvdXJjZSBuYW1lcwogICAgICAgICAqIGxvb2sgbGlrZTogbW9kdWxlL25hbWUuZXh0IXN0cmlwLCB3aGVyZSB0aGUgIXN0cmlwIHBhcnQgaXMKICAgICAgICAgKiBvcHRpb25hbC4KICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gbmFtZSB0aGUgcmVzb3VyY2UgbmFtZQogICAgICAgICAqIEByZXR1cm5zIHtPYmplY3R9IHdpdGggcHJvcGVydGllcyAibW9kdWxlTmFtZSIsICJleHQiIGFuZCAic3RyaXAiCiAgICAgICAgICogd2hlcmUgc3RyaXAgaXMgYSBib29sZWFuLgogICAgICAgICAqLwogICAgICAgIHBhcnNlTmFtZTogZnVuY3Rpb24gKG5hbWUpIHsKICAgICAgICAgICAgdmFyIG1vZE5hbWUsIGV4dCwgdGVtcCwKICAgICAgICAgICAgICAgIHN0cmlwID0gZmFsc2UsCiAgICAgICAgICAgICAgICBpbmRleCA9IG5hbWUuaW5kZXhPZigiLiIpLAogICAgICAgICAgICAgICAgaXNSZWxhdGl2ZSA9IG5hbWUuaW5kZXhPZignLi8nKSA9PT0gMCB8fAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUuaW5kZXhPZignLi4vJykgPT09IDA7CgogICAgICAgICAgICBpZiAoaW5kZXggIT09IC0xICYmICghaXNSZWxhdGl2ZSB8fCBpbmRleCA+IDEpKSB7CiAgICAgICAgICAgICAgICBtb2ROYW1lID0gbmFtZS5zdWJzdHJpbmcoMCwgaW5kZXgpOwogICAgICAgICAgICAgICAgZXh0ID0gbmFtZS5zdWJzdHJpbmcoaW5kZXggKyAxLCBuYW1lLmxlbmd0aCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBtb2ROYW1lID0gbmFtZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGVtcCA9IGV4dCB8fCBtb2ROYW1lOwogICAgICAgICAgICBpbmRleCA9IHRlbXAuaW5kZXhPZigiISIpOwogICAgICAgICAgICBpZiAoaW5kZXggIT09IC0xKSB7CiAgICAgICAgICAgICAgICAvL1B1bGwgb2ZmIHRoZSBzdHJpcCBhcmcuCiAgICAgICAgICAgICAgICBzdHJpcCA9IHRlbXAuc3Vic3RyaW5nKGluZGV4ICsgMSkgPT09ICJzdHJpcCI7CiAgICAgICAgICAgICAgICB0ZW1wID0gdGVtcC5zdWJzdHJpbmcoMCwgaW5kZXgpOwogICAgICAgICAgICAgICAgaWYgKGV4dCkgewogICAgICAgICAgICAgICAgICAgIGV4dCA9IHRlbXA7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIG1vZE5hbWUgPSB0ZW1wOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgbW9kdWxlTmFtZTogbW9kTmFtZSwKICAgICAgICAgICAgICAgIGV4dDogZXh0LAogICAgICAgICAgICAgICAgc3RyaXA6IHN0cmlwCiAgICAgICAgICAgIH07CiAgICAgICAgfSwKCiAgICAgICAgeGRSZWdFeHA6IC9eKChcdyspXDopP1wvXC8oW15cL1xcXSspLywKCiAgICAgICAgLyoqCiAgICAgICAgICogSXMgYW4gVVJMIG9uIGFub3RoZXIgZG9tYWluLiBPbmx5IHdvcmtzIGZvciBicm93c2VyIHVzZSwgcmV0dXJucwogICAgICAgICAqIGZhbHNlIGluIG5vbi1icm93c2VyIGVudmlyb25tZW50cy4gT25seSB1c2VkIHRvIGtub3cgaWYgYW4KICAgICAgICAgKiBvcHRpbWl6ZWQgLmpzIHZlcnNpb24gb2YgYSB0ZXh0IHJlc291cmNlIHNob3VsZCBiZSBsb2FkZWQKICAgICAgICAgKiBpbnN0ZWFkLgogICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSB1cmwKICAgICAgICAgKiBAcmV0dXJucyBCb29sZWFuCiAgICAgICAgICovCiAgICAgICAgdXNlWGhyOiBmdW5jdGlvbiAodXJsLCBwcm90b2NvbCwgaG9zdG5hbWUsIHBvcnQpIHsKICAgICAgICAgICAgdmFyIHVQcm90b2NvbCwgdUhvc3ROYW1lLCB1UG9ydCwKICAgICAgICAgICAgICAgIG1hdGNoID0gdGV4dC54ZFJlZ0V4cC5leGVjKHVybCk7CiAgICAgICAgICAgIGlmICghbWF0Y2gpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHVQcm90b2NvbCA9IG1hdGNoWzJdOwogICAgICAgICAgICB1SG9zdE5hbWUgPSBtYXRjaFszXTsKCiAgICAgICAgICAgIHVIb3N0TmFtZSA9IHVIb3N0TmFtZS5zcGxpdCgnOicpOwogICAgICAgICAgICB1UG9ydCA9IHVIb3N0TmFtZVsxXTsKICAgICAgICAgICAgdUhvc3ROYW1lID0gdUhvc3ROYW1lWzBdOwoKICAgICAgICAgICAgcmV0dXJuICghdVByb3RvY29sIHx8IHVQcm90b2NvbCA9PT0gcHJvdG9jb2wpICYmCiAgICAgICAgICAgICAgICAgICAoIXVIb3N0TmFtZSB8fCB1SG9zdE5hbWUudG9Mb3dlckNhc2UoKSA9PT0gaG9zdG5hbWUudG9Mb3dlckNhc2UoKSkgJiYKICAgICAgICAgICAgICAgICAgICgoIXVQb3J0ICYmICF1SG9zdE5hbWUpIHx8IHVQb3J0ID09PSBwb3J0KTsKICAgICAgICB9LAoKICAgICAgICBmaW5pc2hMb2FkOiBmdW5jdGlvbiAobmFtZSwgc3RyaXAsIGNvbnRlbnQsIG9uTG9hZCkgewogICAgICAgICAgICBjb250ZW50ID0gc3RyaXAgPyB0ZXh0LnN0cmlwKGNvbnRlbnQpIDogY29udGVudDsKICAgICAgICAgICAgaWYgKG1hc3RlckNvbmZpZy5pc0J1aWxkKSB7CiAgICAgICAgICAgICAgICBidWlsZE1hcFtuYW1lXSA9IGNvbnRlbnQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgb25Mb2FkKGNvbnRlbnQpOwogICAgICAgIH0sCgogICAgICAgIGxvYWQ6IGZ1bmN0aW9uIChuYW1lLCByZXEsIG9uTG9hZCwgY29uZmlnKSB7CiAgICAgICAgICAgIC8vTmFtZSBoYXMgZm9ybWF0OiBzb21lLm1vZHVsZS5maWxleHQhc3RyaXAKICAgICAgICAgICAgLy9UaGUgc3RyaXAgcGFydCBpcyBvcHRpb25hbC4KICAgICAgICAgICAgLy9pZiBzdHJpcCBpcyBwcmVzZW50LCB0aGVuIHRoYXQgbWVhbnMgb25seSBnZXQgdGhlIHN0cmluZyBjb250ZW50cwogICAgICAgICAgICAvL2luc2lkZSBhIGJvZHkgdGFnIGluIGFuIEhUTUwgc3RyaW5nLiBGb3IgWE1ML1NWRyBjb250ZW50IGl0IG1lYW5zCiAgICAgICAgICAgIC8vcmVtb3ZpbmcgdGhlIDw/eG1sIC4uLj8+IGRlY2xhcmF0aW9ucyBzbyB0aGUgY29udGVudCBjYW4gYmUgaW5zZXJ0ZWQKICAgICAgICAgICAgLy9pbnRvIHRoZSBjdXJyZW50IGRvYyB3aXRob3V0IHByb2JsZW1zLgoKICAgICAgICAgICAgLy8gRG8gbm90IGJvdGhlciB3aXRoIHRoZSB3b3JrIGlmIGEgYnVpbGQgYW5kIHRleHQgd2lsbAogICAgICAgICAgICAvLyBub3QgYmUgaW5saW5lZC4KICAgICAgICAgICAgaWYgKGNvbmZpZyAmJiBjb25maWcuaXNCdWlsZCAmJiAhY29uZmlnLmlubGluZVRleHQpIHsKICAgICAgICAgICAgICAgIG9uTG9hZCgpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBtYXN0ZXJDb25maWcuaXNCdWlsZCA9IGNvbmZpZyAmJiBjb25maWcuaXNCdWlsZDsKCiAgICAgICAgICAgIHZhciBwYXJzZWQgPSB0ZXh0LnBhcnNlTmFtZShuYW1lKSwKICAgICAgICAgICAgICAgIG5vblN0cmlwTmFtZSA9IHBhcnNlZC5tb2R1bGVOYW1lICsKICAgICAgICAgICAgICAgICAgICAocGFyc2VkLmV4dCA/ICcuJyArIHBhcnNlZC5leHQgOiAnJyksCiAgICAgICAgICAgICAgICB1cmwgPSByZXEudG9Vcmwobm9uU3RyaXBOYW1lKSwKICAgICAgICAgICAgICAgIHVzZVhociA9IChtYXN0ZXJDb25maWcudXNlWGhyKSB8fAogICAgICAgICAgICAgICAgICAgICAgICAgdGV4dC51c2VYaHI7CgogICAgICAgICAgICAvLyBEbyBub3QgbG9hZCBpZiBpdCBpcyBhbiBlbXB0eTogdXJsCiAgICAgICAgICAgIGlmICh1cmwuaW5kZXhPZignZW1wdHk6JykgPT09IDApIHsKICAgICAgICAgICAgICAgIG9uTG9hZCgpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvL0xvYWQgdGhlIHRleHQuIFVzZSBYSFIgaWYgcG9zc2libGUgYW5kIGluIGEgYnJvd3Nlci4KICAgICAgICAgICAgaWYgKCFoYXNMb2NhdGlvbiB8fCB1c2VYaHIodXJsLCBkZWZhdWx0UHJvdG9jb2wsIGRlZmF1bHRIb3N0TmFtZSwgZGVmYXVsdFBvcnQpKSB7CiAgICAgICAgICAgICAgICB0ZXh0LmdldCh1cmwsIGZ1bmN0aW9uIChjb250ZW50KSB7CiAgICAgICAgICAgICAgICAgICAgdGV4dC5maW5pc2hMb2FkKG5hbWUsIHBhcnNlZC5zdHJpcCwgY29udGVudCwgb25Mb2FkKTsKICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHsKICAgICAgICAgICAgICAgICAgICBpZiAob25Mb2FkLmVycm9yKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9uTG9hZC5lcnJvcihlcnIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy9OZWVkIHRvIGZldGNoIHRoZSByZXNvdXJjZSBhY3Jvc3MgZG9tYWlucy4gQXNzdW1lCiAgICAgICAgICAgICAgICAvL3RoZSByZXNvdXJjZSBoYXMgYmVlbiBvcHRpbWl6ZWQgaW50byBhIEpTIG1vZHVsZS4gRmV0Y2gKICAgICAgICAgICAgICAgIC8vYnkgdGhlIG1vZHVsZSBuYW1lICsgZXh0ZW5zaW9uLCBidXQgZG8gbm90IGluY2x1ZGUgdGhlCiAgICAgICAgICAgICAgICAvLyFzdHJpcCBwYXJ0IHRvIGF2b2lkIGZpbGUgc3lzdGVtIGlzc3Vlcy4KICAgICAgICAgICAgICAgIHJlcShbbm9uU3RyaXBOYW1lXSwgZnVuY3Rpb24gKGNvbnRlbnQpIHsKICAgICAgICAgICAgICAgICAgICB0ZXh0LmZpbmlzaExvYWQocGFyc2VkLm1vZHVsZU5hbWUgKyAnLicgKyBwYXJzZWQuZXh0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZWQuc3RyaXAsIGNvbnRlbnQsIG9uTG9hZCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0sCgogICAgICAgIHdyaXRlOiBmdW5jdGlvbiAocGx1Z2luTmFtZSwgbW9kdWxlTmFtZSwgd3JpdGUsIGNvbmZpZykgewogICAgICAgICAgICBpZiAoYnVpbGRNYXAuaGFzT3duUHJvcGVydHkobW9kdWxlTmFtZSkpIHsKICAgICAgICAgICAgICAgIHZhciBjb250ZW50ID0gdGV4dC5qc0VzY2FwZShidWlsZE1hcFttb2R1bGVOYW1lXSk7CiAgICAgICAgICAgICAgICB3cml0ZS5hc01vZHVsZShwbHVnaW5OYW1lICsgIiEiICsgbW9kdWxlTmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJkZWZpbmUoZnVuY3Rpb24gKCkgeyByZXR1cm4gJyIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIic7fSk7XG4iKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCgogICAgICAgIHdyaXRlRmlsZTogZnVuY3Rpb24gKHBsdWdpbk5hbWUsIG1vZHVsZU5hbWUsIHJlcSwgd3JpdGUsIGNvbmZpZykgewogICAgICAgICAgICB2YXIgcGFyc2VkID0gdGV4dC5wYXJzZU5hbWUobW9kdWxlTmFtZSksCiAgICAgICAgICAgICAgICBleHRQYXJ0ID0gcGFyc2VkLmV4dCA/ICcuJyArIHBhcnNlZC5leHQgOiAnJywKICAgICAgICAgICAgICAgIG5vblN0cmlwTmFtZSA9IHBhcnNlZC5tb2R1bGVOYW1lICsgZXh0UGFydCwKICAgICAgICAgICAgICAgIC8vVXNlIGEgJy5qcycgZmlsZSBuYW1lIHNvIHRoYXQgaXQgaW5kaWNhdGVzIGl0IGlzIGEKICAgICAgICAgICAgICAgIC8vc2NyaXB0IHRoYXQgY2FuIGJlIGxvYWRlZCBhY3Jvc3MgZG9tYWlucy4KICAgICAgICAgICAgICAgIGZpbGVOYW1lID0gcmVxLnRvVXJsKHBhcnNlZC5tb2R1bGVOYW1lICsgZXh0UGFydCkgKyAnLmpzJzsKCiAgICAgICAgICAgIC8vTGV2ZXJhZ2Ugb3duIGxvYWQoKSBtZXRob2QgdG8gbG9hZCBwbHVnaW4gdmFsdWUsIGJ1dCBvbmx5CiAgICAgICAgICAgIC8vd3JpdGUgb3V0IHZhbHVlcyB0aGF0IGRvIG5vdCBoYXZlIHRoZSBzdHJpcCBhcmd1bWVudCwKICAgICAgICAgICAgLy90byBhdm9pZCBhbnkgcG90ZW50aWFsIGlzc3VlcyB3aXRoICEgaW4gZmlsZSBuYW1lcy4KICAgICAgICAgICAgdGV4dC5sb2FkKG5vblN0cmlwTmFtZSwgcmVxLCBmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgICAgICAgICAgIC8vVXNlIG93biB3cml0ZSgpIG1ldGhvZCB0byBjb25zdHJ1Y3QgZnVsbCBtb2R1bGUgdmFsdWUuCiAgICAgICAgICAgICAgICAvL0J1dCBuZWVkIHRvIGNyZWF0ZSBzaGVsbCB0aGF0IHRyYW5zbGF0ZXMgd3JpdGVGaWxlJ3MKICAgICAgICAgICAgICAgIC8vd3JpdGUoKSB0byB0aGUgcmlnaHQgaW50ZXJmYWNlLgogICAgICAgICAgICAgICAgdmFyIHRleHRXcml0ZSA9IGZ1bmN0aW9uIChjb250ZW50cykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB3cml0ZShmaWxlTmFtZSwgY29udGVudHMpOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIHRleHRXcml0ZS5hc01vZHVsZSA9IGZ1bmN0aW9uIChtb2R1bGVOYW1lLCBjb250ZW50cykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB3cml0ZS5hc01vZHVsZShtb2R1bGVOYW1lLCBmaWxlTmFtZSwgY29udGVudHMpOwogICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICB0ZXh0LndyaXRlKHBsdWdpbk5hbWUsIG5vblN0cmlwTmFtZSwgdGV4dFdyaXRlLCBjb25maWcpOwogICAgICAgICAgICB9LCBjb25maWcpOwogICAgICAgIH0KICAgIH07CgogICAgaWYgKG1hc3RlckNvbmZpZy5lbnYgPT09ICdub2RlJyB8fCAoIW1hc3RlckNvbmZpZy5lbnYgJiYKICAgICAgICAgICAgdHlwZW9mIHByb2Nlc3MgIT09ICJ1bmRlZmluZWQiICYmCiAgICAgICAgICAgIHByb2Nlc3MudmVyc2lvbnMgJiYKICAgICAgICAgICAgISFwcm9jZXNzLnZlcnNpb25zLm5vZGUgJiYKICAgICAgICAgICAgIXByb2Nlc3MudmVyc2lvbnNbJ25vZGUtd2Via2l0J10pKSB7CiAgICAgICAgLy9Vc2luZyBzcGVjaWFsIHJlcXVpcmUubm9kZVJlcXVpcmUsIHNvbWV0aGluZyBhZGRlZCBieSByLmpzLgogICAgICAgIGZzID0gcmVxdWlyZS5ub2RlUmVxdWlyZSgnZnMnKTsKCiAgICAgICAgdGV4dC5nZXQgPSBmdW5jdGlvbiAodXJsLCBjYWxsYmFjaywgZXJyYmFjaykgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgdmFyIGZpbGUgPSBmcy5yZWFkRmlsZVN5bmModXJsLCAndXRmOCcpOwogICAgICAgICAgICAgICAgLy9SZW1vdmUgQk9NIChCeXRlIE1hcmsgT3JkZXIpIGZyb20gdXRmOCBmaWxlcyBpZiBpdCBpcyB0aGVyZS4KICAgICAgICAgICAgICAgIGlmIChmaWxlLmluZGV4T2YoJ1x1RkVGRicpID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgZmlsZSA9IGZpbGUuc3Vic3RyaW5nKDEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2FsbGJhY2soZmlsZSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgIGlmIChlcnJiYWNrKSB7CiAgICAgICAgICAgICAgICAgICAgZXJyYmFjayhlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH07CiAgICB9IGVsc2UgaWYgKG1hc3RlckNvbmZpZy5lbnYgPT09ICd4aHInIHx8ICghbWFzdGVyQ29uZmlnLmVudiAmJgogICAgICAgICAgICB0ZXh0LmNyZWF0ZVhocigpKSkgewogICAgICAgIHRleHQuZ2V0ID0gZnVuY3Rpb24gKHVybCwgY2FsbGJhY2ssIGVycmJhY2ssIGhlYWRlcnMpIHsKICAgICAgICAgICAgdmFyIHhociA9IHRleHQuY3JlYXRlWGhyKCksIGhlYWRlcjsKICAgICAgICAgICAgeGhyLm9wZW4oJ0dFVCcsIHVybCwgdHJ1ZSk7CgogICAgICAgICAgICAvL0FsbG93IHBsdWdpbnMgZGlyZWN0IGFjY2VzcyB0byB4aHIgaGVhZGVycwogICAgICAgICAgICBpZiAoaGVhZGVycykgewogICAgICAgICAgICAgICAgZm9yIChoZWFkZXIgaW4gaGVhZGVycykgewogICAgICAgICAgICAgICAgICAgIGlmIChoZWFkZXJzLmhhc093blByb3BlcnR5KGhlYWRlcikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoaGVhZGVyLnRvTG93ZXJDYXNlKCksIGhlYWRlcnNbaGVhZGVyXSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvL0FsbG93IG92ZXJyaWRlcyBzcGVjaWZpZWQgaW4gY29uZmlnCiAgICAgICAgICAgIGlmIChtYXN0ZXJDb25maWcub25YaHIpIHsKICAgICAgICAgICAgICAgIG1hc3RlckNvbmZpZy5vblhocih4aHIsIHVybCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHhoci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbiAoZXZ0KSB7CiAgICAgICAgICAgICAgICB2YXIgc3RhdHVzLCBlcnI7CiAgICAgICAgICAgICAgICAvL0RvIG5vdCBleHBsaWNpdGx5IGhhbmRsZSBlcnJvcnMsIHRob3NlIHNob3VsZCBiZQogICAgICAgICAgICAgICAgLy92aXNpYmxlIHZpYSBjb25zb2xlIG91dHB1dCBpbiB0aGUgYnJvd3Nlci4KICAgICAgICAgICAgICAgIGlmICh4aHIucmVhZHlTdGF0ZSA9PT0gNCkgewogICAgICAgICAgICAgICAgICAgIHN0YXR1cyA9IHhoci5zdGF0dXMgfHwgMDsKICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdHVzID4gMzk5ICYmIHN0YXR1cyA8IDYwMCkgewogICAgICAgICAgICAgICAgICAgICAgICAvL0FuIGh0dHAgNHh4IG9yIDV4eCBlcnJvci4gU2lnbmFsIGFuIGVycm9yLgogICAgICAgICAgICAgICAgICAgICAgICBlcnIgPSBuZXcgRXJyb3IodXJsICsgJyBIVFRQIHN0YXR1czogJyArIHN0YXR1cyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVyci54aHIgPSB4aHI7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlcnJiYWNrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJiYWNrKGVycik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayh4aHIucmVzcG9uc2VUZXh0KTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmIChtYXN0ZXJDb25maWcub25YaHJDb21wbGV0ZSkgewogICAgICAgICAgICAgICAgICAgICAgICBtYXN0ZXJDb25maWcub25YaHJDb21wbGV0ZSh4aHIsIHVybCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgICAgICB4aHIuc2VuZChudWxsKTsKICAgICAgICB9OwogICAgfSBlbHNlIGlmIChtYXN0ZXJDb25maWcuZW52ID09PSAncmhpbm8nIHx8ICghbWFzdGVyQ29uZmlnLmVudiAmJgogICAgICAgICAgICB0eXBlb2YgUGFja2FnZXMgIT09ICd1bmRlZmluZWQnICYmIHR5cGVvZiBqYXZhICE9PSAndW5kZWZpbmVkJykpIHsKICAgICAgICAvL1doeSBKYXZhLCB3aHkgaXMgdGhpcyBzbyBhd2t3YXJkPwogICAgICAgIHRleHQuZ2V0ID0gZnVuY3Rpb24gKHVybCwgY2FsbGJhY2spIHsKICAgICAgICAgICAgdmFyIHN0cmluZ0J1ZmZlciwgbGluZSwKICAgICAgICAgICAgICAgIGVuY29kaW5nID0gInV0Zi04IiwKICAgICAgICAgICAgICAgIGZpbGUgPSBuZXcgamF2YS5pby5GaWxlKHVybCksCiAgICAgICAgICAgICAgICBsaW5lU2VwYXJhdG9yID0gamF2YS5sYW5nLlN5c3RlbS5nZXRQcm9wZXJ0eSgibGluZS5zZXBhcmF0b3IiKSwKICAgICAgICAgICAgICAgIGlucHV0ID0gbmV3IGphdmEuaW8uQnVmZmVyZWRSZWFkZXIobmV3IGphdmEuaW8uSW5wdXRTdHJlYW1SZWFkZXIobmV3IGphdmEuaW8uRmlsZUlucHV0U3RyZWFtKGZpbGUpLCBlbmNvZGluZykpLAogICAgICAgICAgICAgICAgY29udGVudCA9ICcnOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgc3RyaW5nQnVmZmVyID0gbmV3IGphdmEubGFuZy5TdHJpbmdCdWZmZXIoKTsKICAgICAgICAgICAgICAgIGxpbmUgPSBpbnB1dC5yZWFkTGluZSgpOwoKICAgICAgICAgICAgICAgIC8vIEJ5dGUgT3JkZXIgTWFyayAoQk9NKSAtIFRoZSBVbmljb2RlIFN0YW5kYXJkLCB2ZXJzaW9uIDMuMCwgcGFnZSAzMjQKICAgICAgICAgICAgICAgIC8vIGh0dHA6Ly93d3cudW5pY29kZS5vcmcvZmFxL3V0Zl9ib20uaHRtbAoKICAgICAgICAgICAgICAgIC8vIE5vdGUgdGhhdCB3aGVuIHdlIHVzZSB1dGYtOCwgdGhlIEJPTSBzaG91bGQgYXBwZWFyIGFzICJFRiBCQiBCRiIsIGJ1dCBpdCBkb2Vzbid0IGR1ZSB0byB0aGlzIGJ1ZyBpbiB0aGUgSkRLOgogICAgICAgICAgICAgICAgLy8gaHR0cDovL2J1Z3Muc3VuLmNvbS9idWdkYXRhYmFzZS92aWV3X2J1Zy5kbz9idWdfaWQ9NDUwODA1OAogICAgICAgICAgICAgICAgaWYgKGxpbmUgJiYgbGluZS5sZW5ndGgoKSAmJiBsaW5lLmNoYXJBdCgwKSA9PT0gMHhmZWZmKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gRWF0IHRoZSBCT00sIHNpbmNlIHdlJ3ZlIGFscmVhZHkgZm91bmQgdGhlIGVuY29kaW5nIG9uIHRoaXMgZmlsZSwKICAgICAgICAgICAgICAgICAgICAvLyBhbmQgd2UgcGxhbiB0byBjb25jYXRlbmF0aW5nIHRoaXMgYnVmZmVyIHdpdGggb3RoZXJzOyB0aGUgQk9NIHNob3VsZAogICAgICAgICAgICAgICAgICAgIC8vIG9ubHkgYXBwZWFyIGF0IHRoZSB0b3Agb2YgYSBmaWxlLgogICAgICAgICAgICAgICAgICAgIGxpbmUgPSBsaW5lLnN1YnN0cmluZygxKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAobGluZSAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIHN0cmluZ0J1ZmZlci5hcHBlbmQobGluZSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgd2hpbGUgKChsaW5lID0gaW5wdXQucmVhZExpbmUoKSkgIT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBzdHJpbmdCdWZmZXIuYXBwZW5kKGxpbmVTZXBhcmF0b3IpOwogICAgICAgICAgICAgICAgICAgIHN0cmluZ0J1ZmZlci5hcHBlbmQobGluZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvL01ha2Ugc3VyZSB3ZSByZXR1cm4gYSBKYXZhU2NyaXB0IHN0cmluZyBhbmQgbm90IGEgSmF2YSBzdHJpbmcuCiAgICAgICAgICAgICAgICBjb250ZW50ID0gU3RyaW5nKHN0cmluZ0J1ZmZlci50b1N0cmluZygpKTsgLy9TdHJpbmcKICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIGlucHV0LmNsb3NlKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FsbGJhY2soY29udGVudCk7CiAgICAgICAgfTsKICAgIH0gZWxzZSBpZiAobWFzdGVyQ29uZmlnLmVudiA9PT0gJ3hwY29ubmVjdCcgfHwgKCFtYXN0ZXJDb25maWcuZW52ICYmCiAgICAgICAgICAgIHR5cGVvZiBDb21wb25lbnRzICE9PSAndW5kZWZpbmVkJyAmJiBDb21wb25lbnRzLmNsYXNzZXMgJiYKICAgICAgICAgICAgQ29tcG9uZW50cy5pbnRlcmZhY2VzKSkgewogICAgICAgIC8vQXZlcnQgeW91ciBnYXplIQogICAgICAgIENjID0gQ29tcG9uZW50cy5jbGFzc2VzOwogICAgICAgIENpID0gQ29tcG9uZW50cy5pbnRlcmZhY2VzOwogICAgICAgIENvbXBvbmVudHMudXRpbHNbJ2ltcG9ydCddKCdyZXNvdXJjZTovL2dyZS9tb2R1bGVzL0ZpbGVVdGlscy5qc20nKTsKICAgICAgICB4cGNJc1dpbmRvd3MgPSAoJ0Btb3ppbGxhLm9yZy93aW5kb3dzLXJlZ2lzdHJ5LWtleTsxJyBpbiBDYyk7CgogICAgICAgIHRleHQuZ2V0ID0gZnVuY3Rpb24gKHVybCwgY2FsbGJhY2spIHsKICAgICAgICAgICAgdmFyIGluU3RyZWFtLCBjb252ZXJ0U3RyZWFtLCBmaWxlT2JqLAogICAgICAgICAgICAgICAgcmVhZERhdGEgPSB7fTsKCiAgICAgICAgICAgIGlmICh4cGNJc1dpbmRvd3MpIHsKICAgICAgICAgICAgICAgIHVybCA9IHVybC5yZXBsYWNlKC9cLy9nLCAnXFwnKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZmlsZU9iaiA9IG5ldyBGaWxlVXRpbHMuRmlsZSh1cmwpOwoKICAgICAgICAgICAgLy9YUENPTSwgeW91IHNvIGNyYXp5CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBpblN0cmVhbSA9IENjWydAbW96aWxsYS5vcmcvbmV0d29yay9maWxlLWlucHV0LXN0cmVhbTsxJ10KICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNyZWF0ZUluc3RhbmNlKENpLm5zSUZpbGVJbnB1dFN0cmVhbSk7CiAgICAgICAgICAgICAgICBpblN0cmVhbS5pbml0KGZpbGVPYmosIDEsIDAsIGZhbHNlKTsKCiAgICAgICAgICAgICAgICBjb252ZXJ0U3RyZWFtID0gQ2NbJ0Btb3ppbGxhLm9yZy9pbnRsL2NvbnZlcnRlci1pbnB1dC1zdHJlYW07MSddCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNyZWF0ZUluc3RhbmNlKENpLm5zSUNvbnZlcnRlcklucHV0U3RyZWFtKTsKICAgICAgICAgICAgICAgIGNvbnZlcnRTdHJlYW0uaW5pdChpblN0cmVhbSwgInV0Zi04IiwgaW5TdHJlYW0uYXZhaWxhYmxlKCksCiAgICAgICAgICAgICAgICBDaS5uc0lDb252ZXJ0ZXJJbnB1dFN0cmVhbS5ERUZBVUxUX1JFUExBQ0VNRU5UX0NIQVJBQ1RFUik7CgogICAgICAgICAgICAgICAgY29udmVydFN0cmVhbS5yZWFkU3RyaW5nKGluU3RyZWFtLmF2YWlsYWJsZSgpLCByZWFkRGF0YSk7CiAgICAgICAgICAgICAgICBjb252ZXJ0U3RyZWFtLmNsb3NlKCk7CiAgICAgICAgICAgICAgICBpblN0cmVhbS5jbG9zZSgpOwogICAgICAgICAgICAgICAgY2FsbGJhY2socmVhZERhdGEudmFsdWUpOwogICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoKGZpbGVPYmogJiYgZmlsZU9iai5wYXRoIHx8ICcnKSArICc6ICcgKyBlKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICB9CiAgICByZXR1cm4gdGV4dDsKfSk7CgovLyBSZXF1aXJlSlMgVW5kZXJzY29yZUpTIHRlbXBsYXRlIHBsdWdpbgovLyBodHRwOi8vZ2l0aHViLmNvbS9qZnBhcmFkaXMvcmVxdWlyZWpzLXRwbAovLwovLyBBbiBhbHRlcm5hdGl2ZSB0byBodHRwOi8vZ2l0aHViLmNvbS9aZWVBZ2VuY3kvcmVxdWlyZWpzLXRwbAovLwovLyBVc2luZyBVbmRlcnNjb3JlSlMgbWljcm8tdGVtcGxhdGVzIGF0IGh0dHA6Ly91bmRlcnNjb3JlanMub3JnLyN0ZW1wbGF0ZQovLyBVc2luZyBhbmQgUmVxdWlyZUpTIHRleHQuanMgYXQgaHR0cDovL3JlcXVpcmVqcy5vcmcvZG9jcy9hcGkuaHRtbCN0ZXh0Ci8vIEBhdXRob3IgSkYgUGFyYWRpcwovLyBAdmVyc2lvbiAwLjAuMgovLwovLyBSZWxlYXNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UKLy8KLy8gVXNhZ2U6Ci8vICAgcmVxdWlyZShbJ2JhY2tib25lJywgJ3RwbCFteXRlbXBsYXRlJ10sIGZ1bmN0aW9uIChCYWNrYm9uZSwgbXl0ZW1wbGF0ZSkgewovLyAgICAgcmV0dXJuIEJhY2tib25lLlZpZXcuZXh0ZW5kKHsKLy8gICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKXsKLy8gICAgICAgICB0aGlzLnJlbmRlcigpOwovLyAgICAgICB9LAovLyAgICAgICByZW5kZXI6IGZ1bmN0aW9uKCl7Ci8vICAgICAgICAgdGhpcy4kZWwuaHRtbChteXRlbXBsYXRlKHttZXNzYWdlOiAnaGVsbG8nfSkpOwovLyAgICAgfSk7Ci8vICAgfSk7Ci8vCi8vIENvbmZpZ3VyYXRpb246IChvcHRpb25hbCkKLy8gICByZXF1aXJlLmNvbmZpZyh7Ci8vICAgICB0cGw6IHsKLy8gICAgICAgZXh0ZW5zaW9uOiAnLnRwbCcgLy8gZGVmYXVsdCA9ICcuaHRtbCcKLy8gICAgIH0KLy8gICB9KTsKCi8qanNsaW50IG5vbWVuOiB0cnVlICovCi8qZ2xvYmFsIGRlZmluZTogZmFsc2UgKi8KCmRlZmluZSgndHBsJyxbJ3RleHQnLCAndW5kZXJzY29yZSddLCBmdW5jdGlvbiAodGV4dCwgXykgewogICAgCgogICAgdmFyIGJ1aWxkTWFwID0ge30sCiAgICAgICAgYnVpbGRUZW1wbGF0ZVNvdXJjZSA9ICJkZWZpbmUoJ3twbHVnaW5OYW1lfSF7bW9kdWxlTmFtZX0nLCBmdW5jdGlvbiAoKSB7IHJldHVybiB7c291cmNlfTsgfSk7XG4iOwoKICAgIHJldHVybiB7CiAgICAgICAgdmVyc2lvbjogJzAuMC4yJywKCiAgICAgICAgbG9hZDogZnVuY3Rpb24gKG1vZHVsZU5hbWUsIHBhcmVudFJlcXVpcmUsIG9ubG9hZCwgY29uZmlnKSB7CgogICAgICAgICAgICBpZiAoY29uZmlnLnRwbCAmJiBjb25maWcudHBsLnRlbXBsYXRlU2V0dGluZ3MpIHsKICAgICAgICAgICAgICAgIF8udGVtcGxhdGVTZXR0aW5ncyA9IGNvbmZpZy50cGwudGVtcGxhdGVTZXR0aW5nczsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGJ1aWxkTWFwW21vZHVsZU5hbWVdKSB7CiAgICAgICAgICAgICAgICBvbmxvYWQoYnVpbGRNYXBbbW9kdWxlTmFtZV0pOwoKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHZhciBleHQgPSAoY29uZmlnLnRwbCAmJiBjb25maWcudHBsLmV4dGVuc2lvbikgfHwgJy5odG1sJzsKICAgICAgICAgICAgICAgIHZhciBwYXRoID0gKGNvbmZpZy50cGwgJiYgY29uZmlnLnRwbC5wYXRoKSB8fCAnJzsKICAgICAgICAgICAgICAgIHRleHQubG9hZChwYXRoICsgbW9kdWxlTmFtZSArIGV4dCwgcGFyZW50UmVxdWlyZSwgZnVuY3Rpb24gKHNvdXJjZSkgewogICAgICAgICAgICAgICAgICAgIGJ1aWxkTWFwW21vZHVsZU5hbWVdID0gXy50ZW1wbGF0ZShzb3VyY2UpOwogICAgICAgICAgICAgICAgICAgIG9ubG9hZChidWlsZE1hcFttb2R1bGVOYW1lXSk7CiAgICAgICAgICAgICAgICB9LCBjb25maWcpOwogICAgICAgICAgICB9CiAgICAgICAgfSwKCiAgICAgICAgd3JpdGU6IGZ1bmN0aW9uIChwbHVnaW5OYW1lLCBtb2R1bGVOYW1lLCB3cml0ZSkgewogICAgICAgICAgICB2YXIgYnVpbGQgPSBidWlsZE1hcFttb2R1bGVOYW1lXSwKICAgICAgICAgICAgICAgIHNvdXJjZSA9IGJ1aWxkICYmIGJ1aWxkLnNvdXJjZTsKICAgICAgICAgICAgaWYgKHNvdXJjZSkgewogICAgICAgICAgICAgICAgd3JpdGUuYXNNb2R1bGUocGx1Z2luTmFtZSArICchJyArIG1vZHVsZU5hbWUsCiAgICAgICAgICAgICAgICAgICAgYnVpbGRUZW1wbGF0ZVNvdXJjZQogICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKCd7cGx1Z2luTmFtZX0nLCBwbHVnaW5OYW1lKQogICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKCd7bW9kdWxlTmFtZX0nLCBtb2R1bGVOYW1lKQogICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKCd7c291cmNlfScsIHNvdXJjZSkpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKfSk7CgoKZGVmaW5lKCd0cGwhYWN0aW9uJywgW10sZnVuY3Rpb24gKCkgeyByZXR1cm4gZnVuY3Rpb24ob2JqKXsKdmFyIF9fdCxfX3A9JycsX19qPUFycmF5LnByb3RvdHlwZS5qb2luLHByaW50PWZ1bmN0aW9uKCl7X19wKz1fX2ouY2FsbChhcmd1bWVudHMsJycpO307CndpdGgob2JqfHx7fSl7Cl9fcCs9JzxkaXYgY2xhc3M9ImNoYXQtbWVzc2FnZSAnKwooKF9fdD0oZXh0cmFfY2xhc3NlcykpPT1udWxsPycnOl9fdCkrCiciPlxuICAgIDxzcGFuIGNsYXNzPSJjaGF0LW1lc3NhZ2UtJysKKChfX3Q9KHNlbmRlcikpPT1udWxsPycnOl9fdCkrCiciPicrCigoX190PSh0aW1lKSk9PW51bGw/Jyc6X190KSsKJyAqKicrCigoX190PSh1c2VybmFtZSkpPT1udWxsPycnOl9fdCkrCicgPC9zcGFuPlxuICAgIDxzcGFuIGNsYXNzPSJjaGF0LW1lc3NhZ2UtY29udGVudCI+JysKKChfX3Q9KG1lc3NhZ2UpKT09bnVsbD8nJzpfX3QpKwonPC9zcGFuPlxuPC9kaXY+XG4nOwp9CnJldHVybiBfX3A7Cn07IH0pOwoKCmRlZmluZSgndHBsIWFkZF9jb250YWN0X2Ryb3Bkb3duJywgW10sZnVuY3Rpb24gKCkgeyByZXR1cm4gZnVuY3Rpb24ob2JqKXsKdmFyIF9fdCxfX3A9JycsX19qPUFycmF5LnByb3RvdHlwZS5qb2luLHByaW50PWZ1bmN0aW9uKCl7X19wKz1fX2ouY2FsbChhcmd1bWVudHMsJycpO307CndpdGgob2JqfHx7fSl7Cl9fcCs9JzxkbCBjbGFzcz0iYWRkLWNvbnZlcnNlLWNvbnRhY3QgZHJvcGRvd24iPlxuICAgIDxkdCBpZD0ieG1wcC1jb250YWN0LXNlYXJjaCIgY2xhc3M9ImZhbmN5LWRyb3Bkb3duIj5cbiAgICAgICAgPGEgY2xhc3M9InRvZ2dsZS14bXBwLWNvbnRhY3QtZm9ybSIgaHJlZj0iIyJcbiAgICAgICAgICAgIHRpdGxlPSInKwooKF9fdD0obGFiZWxfY2xpY2tfdG9fY2hhdCkpPT1udWxsPycnOl9fdCkrCiciPlxuICAgICAgICA8c3BhbiBjbGFzcz0iaWNvbi1wbHVzIj48L3NwYW4+JysKKChfX3Q9KGxhYmVsX2FkZF9jb250YWN0KSk9PW51bGw/Jyc6X190KSsKJzwvYT5cbiAgICA8L2R0PlxuICAgIDxkZCBjbGFzcz0ic2VhcmNoLXhtcHAiIHN0eWxlPSJkaXNwbGF5Om5vbmUiPjx1bD48L3VsPjwvZGQ+XG48L2RsPlxuJzsKfQpyZXR1cm4gX19wOwp9OyB9KTsKCgpkZWZpbmUoJ3RwbCFhZGRfY29udGFjdF9mb3JtJywgW10sZnVuY3Rpb24gKCkgeyByZXR1cm4gZnVuY3Rpb24ob2JqKXsKdmFyIF9fdCxfX3A9JycsX19qPUFycmF5LnByb3RvdHlwZS5qb2luLHByaW50PWZ1bmN0aW9uKCl7X19wKz1fX2ouY2FsbChhcmd1bWVudHMsJycpO307CndpdGgob2JqfHx7fSl7Cl9fcCs9JzxsaT5cbiAgICA8Zm9ybSBjbGFzcz0iYWRkLXhtcHAtY29udGFjdCI+XG4gICAgICAgIDxpbnB1dCB0eXBlPSJ0ZXh0IlxuICAgICAgICAgICAgbmFtZT0iaWRlbnRpZmllciJcbiAgICAgICAgICAgIGNsYXNzPSJ1c2VybmFtZSJcbiAgICAgICAgICAgIHBsYWNlaG9sZGVyPSInKwooKF9fdD0obGFiZWxfY29udGFjdF91c2VybmFtZSkpPT1udWxsPycnOl9fdCkrCiciLz5cbiAgICAgICAgPGJ1dHRvbiB0eXBlPSJzdWJtaXQiPicrCigoX190PShsYWJlbF9hZGQpKT09bnVsbD8nJzpfX3QpKwonPC9idXR0b24+XG4gICAgPC9mb3JtPlxuPC9saT5cbic7Cn0KcmV0dXJuIF9fcDsKfTsgfSk7CgoKZGVmaW5lKCd0cGwhY2hhbmdlX3N0YXR1c19tZXNzYWdlJywgW10sZnVuY3Rpb24gKCkgeyByZXR1cm4gZnVuY3Rpb24ob2JqKXsKdmFyIF9fdCxfX3A9JycsX19qPUFycmF5LnByb3RvdHlwZS5qb2luLHByaW50PWZ1bmN0aW9uKCl7X19wKz1fX2ouY2FsbChhcmd1bWVudHMsJycpO307CndpdGgob2JqfHx7fSl7Cl9fcCs9Jzxmb3JtIGlkPSJzZXQtY3VzdG9tLXhtcHAtc3RhdHVzIj5cbiAgICA8aW5wdXQgdHlwZT0idGV4dCIgY2xhc3M9ImN1c3RvbS14bXBwLXN0YXR1cyIgJysKKChfX3Q9KHN0YXR1c19tZXNzYWdlKSk9PW51bGw/Jyc6X190KSsKJ1xuICAgICAgICBwbGFjZWhvbGRlcj0iJysKKChfX3Q9KGxhYmVsX2N1c3RvbV9zdGF0dXMpKT09bnVsbD8nJzpfX3QpKwonIi8+XG4gICAgPGJ1dHRvbiB0eXBlPSJzdWJtaXQiPicrCigoX190PShsYWJlbF9zYXZlKSk9PW51bGw/Jyc6X190KSsKJzwvYnV0dG9uPlxuPC9mb3JtPlxuJzsKfQpyZXR1cm4gX19wOwp9OyB9KTsKCgpkZWZpbmUoJ3RwbCFjaGF0X3N0YXR1cycsIFtdLGZ1bmN0aW9uICgpIHsgcmV0dXJuIGZ1bmN0aW9uKG9iail7CnZhciBfX3QsX19wPScnLF9faj1BcnJheS5wcm90b3R5cGUuam9pbixwcmludD1mdW5jdGlvbigpe19fcCs9X19qLmNhbGwoYXJndW1lbnRzLCcnKTt9Owp3aXRoKG9ianx8e30pewpfX3ArPSc8ZGl2IGNsYXNzPSJ4bXBwLXN0YXR1cyI+XG4gICAgPGEgY2xhc3M9ImNob29zZS14bXBwLXN0YXR1cyAnKwooKF9fdD0oY2hhdF9zdGF0dXMpKT09bnVsbD8nJzpfX3QpKwonIlxuICAgICAgIGRhdGEtdmFsdWU9IicrCigoX190PShzdGF0dXNfbWVzc2FnZSkpPT1udWxsPycnOl9fdCkrCiciXG4gICAgICAgaHJlZj0iIyIgdGl0bGU9IicrCigoX190PShkZXNjX2NoYW5nZV9zdGF0dXMpKT09bnVsbD8nJzpfX3QpKwonIj5cblxuICAgICAgICA8c3BhbiBjbGFzcz0iaWNvbi0nKwooKF9fdD0oY2hhdF9zdGF0dXMpKT09bnVsbD8nJzpfX3QpKwonIj48L3NwYW4+JysKKChfX3Q9KHN0YXR1c19tZXNzYWdlKSk9PW51bGw/Jyc6X190KSsKJ1xuICAgIDwvYT5cbiAgICA8YSBjbGFzcz0iY2hhbmdlLXhtcHAtc3RhdHVzLW1lc3NhZ2UgaWNvbi1wZW5jaWwiXG4gICAgICAgIGhyZWY9IiMiXG4gICAgICAgIHRpdGxlPSInKwooKF9fdD0oZGVzY19jdXN0b21fc3RhdHVzKSk9PW51bGw/Jyc6X190KSsKJyI+PC9hPlxuPC9kaXY+XG4nOwp9CnJldHVybiBfX3A7Cn07IH0pOwoKCmRlZmluZSgndHBsIWNoYXRhcmVhJywgW10sZnVuY3Rpb24gKCkgeyByZXR1cm4gZnVuY3Rpb24ob2JqKXsKdmFyIF9fdCxfX3A9JycsX19qPUFycmF5LnByb3RvdHlwZS5qb2luLHByaW50PWZ1bmN0aW9uKCl7X19wKz1fX2ouY2FsbChhcmd1bWVudHMsJycpO307CndpdGgob2JqfHx7fSl7Cl9fcCs9JzxkaXYgY2xhc3M9ImNoYXQtYXJlYSI+XG4gICAgPGRpdiBjbGFzcz0iY2hhdC1jb250ZW50Ij48L2Rpdj5cbiAgICA8Zm9ybSBjbGFzcz0ic2VuZFhNUFBNZXNzYWdlIiBhY3Rpb249IiIgbWV0aG9kPSJwb3N0Ij5cbiAgICAgICAgJzsKIGlmIChzaG93X3Rvb2xiYXIpIHsgCl9fcCs9J1xuICAgICAgICAgICAgPHVsIGNsYXNzPSJjaGF0LXRvb2xiYXIgbm8tdGV4dC1zZWxlY3QiPjwvdWw+XG4gICAgICAgICc7CiB9IApfX3ArPSdcbiAgICAgICAgPHRleHRhcmVhIHR5cGU9InRleHQiIGNsYXNzPSJjaGF0LXRleHRhcmVhIiBcbiAgICAgICAgICAgIHBsYWNlaG9sZGVyPSInKwooKF9fdD0obGFiZWxfbWVzc2FnZSkpPT1udWxsPycnOl9fdCkrCiciLz5cbiAgICA8L2Zvcm0+XG48L2Rpdj5cbic7Cn0KcmV0dXJuIF9fcDsKfTsgfSk7CgoKZGVmaW5lKCd0cGwhY2hhdGJveCcsIFtdLGZ1bmN0aW9uICgpIHsgcmV0dXJuIGZ1bmN0aW9uKG9iail7CnZhciBfX3QsX19wPScnLF9faj1BcnJheS5wcm90b3R5cGUuam9pbixwcmludD1mdW5jdGlvbigpe19fcCs9X19qLmNhbGwoYXJndW1lbnRzLCcnKTt9Owp3aXRoKG9ianx8e30pewpfX3ArPSc8ZGl2IGNsYXNzPSJib3gtZmx5b3V0IiBzdHlsZT0iaGVpZ2h0OiAnKwooKF9fdD0oaGVpZ2h0KSk9PW51bGw/Jyc6X190KSsKJ3B4Ij5cbiAgICA8ZGl2IGNsYXNzPSJkcmFncmVzaXplIGRyYWdyZXNpemUtdG0iPjwvZGl2PlxuICAgIDxkaXYgY2xhc3M9ImNoYXQtaGVhZCBjaGF0LWhlYWQtY2hhdGJveCI+XG4gICAgICAgIDxhIGNsYXNzPSJjbG9zZS1jaGF0Ym94LWJ1dHRvbiBpY29uLWNsb3NlIj48L2E+XG4gICAgICAgIDxhIGNsYXNzPSJ0b2dnbGUtY2hhdGJveC1idXR0b24gaWNvbi1taW51cyI+PC9hPlxuICAgICAgICA8ZGl2IGNsYXNzPSJjaGF0LXRpdGxlIj5cbiAgICAgICAgICAgICc7CiBpZiAodXJsKSB7IApfX3ArPSdcbiAgICAgICAgICAgICAgICA8YSBocmVmPSInKwooKF9fdD0odXJsKSk9PW51bGw/Jyc6X190KSsKJyIgdGFyZ2V0PSJfYmxhbmsiIGNsYXNzPSJ1c2VyIj5cbiAgICAgICAgICAgICc7CiB9IApfX3ArPSdcbiAgICAgICAgICAgICAgICAgICAgJysKKChfX3Q9KCBmdWxsbmFtZSApKT09bnVsbD8nJzpfX3QpKwonXG4gICAgICAgICAgICAnOwogaWYgKHVybCkgeyAKX19wKz0nXG4gICAgICAgICAgICAgICAgPC9hPlxuICAgICAgICAgICAgJzsKIH0gCl9fcCs9J1xuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPHAgY2xhc3M9InVzZXItY3VzdG9tLW1lc3NhZ2UiPjxwLz5cbiAgICA8L2Rpdj5cbiAgICA8ZGl2IGNsYXNzPSJjaGF0LWJvZHkiPlxuICAgICAgICA8ZGl2IGNsYXNzPSJjaGF0LWNvbnRlbnQiPjwvZGl2PlxuICAgICAgICA8Zm9ybSBjbGFzcz0ic2VuZFhNUFBNZXNzYWdlIiBhY3Rpb249IiIgbWV0aG9kPSJwb3N0Ij5cbiAgICAgICAgICAgICc7CiBpZiAoc2hvd190b29sYmFyKSB7IApfX3ArPSdcbiAgICAgICAgICAgICAgICA8dWwgY2xhc3M9ImNoYXQtdG9vbGJhciBuby10ZXh0LXNlbGVjdCI+PC91bD5cbiAgICAgICAgICAgICc7CiB9IApfX3ArPSdcbiAgICAgICAgPHRleHRhcmVhXG4gICAgICAgICAgICB0eXBlPSJ0ZXh0IlxuICAgICAgICAgICAgY2xhc3M9ImNoYXQtdGV4dGFyZWEiXG4gICAgICAgICAgICBwbGFjZWhvbGRlcj0iJysKKChfX3Q9KGxhYmVsX3BlcnNvbmFsX21lc3NhZ2UpKT09bnVsbD8nJzpfX3QpKwonIi8+XG4gICAgICAgIDwvZm9ybT5cbiAgICA8L2Rpdj5cbjwvZGl2PlxuJzsKfQpyZXR1cm4gX19wOwp9OyB9KTsKCgpkZWZpbmUoJ3RwbCFjaGF0cm9vbScsIFtdLGZ1bmN0aW9uICgpIHsgcmV0dXJuIGZ1bmN0aW9uKG9iail7CnZhciBfX3QsX19wPScnLF9faj1BcnJheS5wcm90b3R5cGUuam9pbixwcmludD1mdW5jdGlvbigpe19fcCs9X19qLmNhbGwoYXJndW1lbnRzLCcnKTt9Owp3aXRoKG9ianx8e30pewpfX3ArPSc8ZGl2IGNsYXNzPSJib3gtZmx5b3V0IiBzdHlsZT0iaGVpZ2h0OiAnKwooKF9fdD0oaGVpZ2h0KSk9PW51bGw/Jyc6X190KSsKJ3B4IlxuICAgICc7CiBpZiAobWluaW1pemVkKSB7IApfX3ArPScgc3R5bGU9ImRpc3BsYXk6bm9uZSIgJzsKIH0gCl9fcCs9Jz5cbiAgICA8ZGl2IGNsYXNzPSJkcmFncmVzaXplIGRyYWdyZXNpemUtdG0iPjwvZGl2PlxuICAgIDxkaXYgY2xhc3M9ImNoYXQtaGVhZCBjaGF0LWhlYWQtY2hhdHJvb20iPlxuICAgICAgICA8YSBjbGFzcz0iY2xvc2UtY2hhdGJveC1idXR0b24gaWNvbi1jbG9zZSI+PC9hPlxuICAgICAgICA8YSBjbGFzcz0idG9nZ2xlLWNoYXRib3gtYnV0dG9uIGljb24tbWludXMiPjwvYT5cbiAgICAgICAgPGEgY2xhc3M9ImNvbmZpZ3VyZS1jaGF0cm9vbS1idXR0b24gaWNvbi13cmVuY2giIHN0eWxlPSJkaXNwbGF5Om5vbmUiPjwvYT5cbiAgICAgICAgPGRpdiBjbGFzcz0iY2hhdC10aXRsZSI+ICcrCigoX190PSggbmFtZSApKT09bnVsbD8nJzpfX3QpKwonIDwvZGl2PlxuICAgICAgICA8cCBjbGFzcz0iY2hhdHJvb20tdG9waWMiPjxwLz5cbiAgICA8L2Rpdj5cbiAgICA8ZGl2IGNsYXNzPSJjaGF0LWJvZHkiPjxzcGFuIGNsYXNzPSJzcGlubmVyIGNlbnRlcmVkIi8+PC9kaXY+XG48L2Rpdj5cbic7Cn0KcmV0dXJuIF9fcDsKfTsgfSk7CgoKZGVmaW5lKCd0cGwhY2hhdHJvb21fcGFzc3dvcmRfZm9ybScsIFtdLGZ1bmN0aW9uICgpIHsgcmV0dXJuIGZ1bmN0aW9uKG9iail7CnZhciBfX3QsX19wPScnLF9faj1BcnJheS5wcm90b3R5cGUuam9pbixwcmludD1mdW5jdGlvbigpe19fcCs9X19qLmNhbGwoYXJndW1lbnRzLCcnKTt9Owp3aXRoKG9ianx8e30pewpfX3ArPSc8ZGl2IGNsYXNzPSJjaGF0cm9vbS1mb3JtLWNvbnRhaW5lciI+XG4gICAgPGZvcm0gY2xhc3M9ImNoYXRyb29tLWZvcm0iPlxuICAgICAgICA8bGVnZW5kPicrCigoX190PShoZWFkaW5nKSk9PW51bGw/Jyc6X190KSsKJzwvbGVnZW5kPlxuICAgICAgICA8bGFiZWw+JysKKChfX3Q9KGxhYmVsX3Bhc3N3b3JkKSk9PW51bGw/Jyc6X190KSsKJzxpbnB1dCB0eXBlPSJwYXNzd29yZCIgbmFtZT0icGFzc3dvcmQiLz48L2xhYmVsPlxuICAgICAgICA8aW5wdXQgdHlwZT0ic3VibWl0IiB2YWx1ZT0iJysKKChfX3Q9KGxhYmVsX3N1Ym1pdCkpPT1udWxsPycnOl9fdCkrCiciLz5cbiAgICA8L2Zvcm0+XG48L2Rpdj5cbic7Cn0KcmV0dXJuIF9fcDsKfTsgfSk7CgoKZGVmaW5lKCd0cGwhY2hhdHJvb21fc2lkZWJhcicsIFtdLGZ1bmN0aW9uICgpIHsgcmV0dXJuIGZ1bmN0aW9uKG9iail7CnZhciBfX3QsX19wPScnLF9faj1BcnJheS5wcm90b3R5cGUuam9pbixwcmludD1mdW5jdGlvbigpe19fcCs9X19qLmNhbGwoYXJndW1lbnRzLCcnKTt9Owp3aXRoKG9ianx8e30pewpfX3ArPSc8IS0tIDxkaXYgY2xhc3M9InBhcnRpY2lwYW50cyI+IC0tPlxuPGZvcm0gY2xhc3M9InJvb20taW52aXRlIj5cbiAgICA8aW5wdXQgY2xhc3M9Imludml0ZWQtY29udGFjdCIgcGxhY2Vob2xkZXI9IicrCigoX190PShsYWJlbF9pbnZpdGF0aW9uKSk9PW51bGw/Jyc6X190KSsKJyIgdHlwZT0idGV4dCIvPlxuPC9mb3JtPlxuPGxhYmVsPicrCigoX190PShsYWJlbF9vY2N1cGFudHMpKT09bnVsbD8nJzpfX3QpKwonOjwvbGFiZWw+XG48dWwgY2xhc3M9InBhcnRpY2lwYW50LWxpc3QiPjwvdWw+XG48IS0tIDwvZGl2PiAtLT5cbic7Cn0KcmV0dXJuIF9fcDsKfTsgfSk7CgoKZGVmaW5lKCd0cGwhY2hhdHJvb21zX3RhYicsIFtdLGZ1bmN0aW9uICgpIHsgcmV0dXJuIGZ1bmN0aW9uKG9iail7CnZhciBfX3QsX19wPScnLF9faj1BcnJheS5wcm90b3R5cGUuam9pbixwcmludD1mdW5jdGlvbigpe19fcCs9X19qLmNhbGwoYXJndW1lbnRzLCcnKTt9Owp3aXRoKG9ianx8e30pewpfX3ArPSc8bGk+PGEgY2xhc3M9InMiIGhyZWY9IiNjaGF0cm9vbXMiPicrCigoX190PShsYWJlbF9yb29tcykpPT1udWxsPycnOl9fdCkrCic8L2E+PC9saT5cbic7Cn0KcmV0dXJuIF9fcDsKfTsgfSk7CgoKZGVmaW5lKCd0cGwhY2hhdHNfcGFuZWwnLCBbXSxmdW5jdGlvbiAoKSB7IHJldHVybiBmdW5jdGlvbihvYmopewp2YXIgX190LF9fcD0nJyxfX2o9QXJyYXkucHJvdG90eXBlLmpvaW4scHJpbnQ9ZnVuY3Rpb24oKXtfX3ArPV9fai5jYWxsKGFyZ3VtZW50cywnJyk7fTsKd2l0aChvYmp8fHt9KXsKX19wKz0nPGRpdiBpZD0ibWluaW1pemVkLWNoYXRzIj5cbiAgICA8YSBpZD0idG9nZ2xlLW1pbmltaXplZC1jaGF0cyIgaHJlZj0iIyI+PC9hPlxuICAgIDxkaXYgY2xhc3M9Im1pbmltaXplZC1jaGF0cy1mbHlvdXQiPjwvZGl2PlxuPC9kaXY+XG4nOwp9CnJldHVybiBfX3A7Cn07IH0pOwoKCmRlZmluZSgndHBsIWNob29zZV9zdGF0dXMnLCBbXSxmdW5jdGlvbiAoKSB7IHJldHVybiBmdW5jdGlvbihvYmopewp2YXIgX190LF9fcD0nJyxfX2o9QXJyYXkucHJvdG90eXBlLmpvaW4scHJpbnQ9ZnVuY3Rpb24oKXtfX3ArPV9fai5jYWxsKGFyZ3VtZW50cywnJyk7fTsKd2l0aChvYmp8fHt9KXsKX19wKz0nPGRsIGlkPSJ0YXJnZXQiIGNsYXNzPSJkcm9wZG93biI+XG4gICAgPGR0IGlkPSJmYW5jeS14bXBwLXN0YXR1cy1zZWxlY3QiIGNsYXNzPSJmYW5jeS1kcm9wZG93biI+PC9kdD5cbiAgICA8ZGQ+PHVsIGNsYXNzPSJ4bXBwLXN0YXR1cy1tZW51Ij48L3VsPjwvZGQ+XG48L2RsPlxuJzsKfQpyZXR1cm4gX19wOwp9OyB9KTsKCgpkZWZpbmUoJ3RwbCFjb250YWN0c19wYW5lbCcsIFtdLGZ1bmN0aW9uICgpIHsgcmV0dXJuIGZ1bmN0aW9uKG9iail7CnZhciBfX3QsX19wPScnLF9faj1BcnJheS5wcm90b3R5cGUuam9pbixwcmludD1mdW5jdGlvbigpe19fcCs9X19qLmNhbGwoYXJndW1lbnRzLCcnKTt9Owp3aXRoKG9ianx8e30pewpfX3ArPSc8Zm9ybSBjbGFzcz0ic2V0LXhtcHAtc3RhdHVzIiBhY3Rpb249IiIgbWV0aG9kPSJwb3N0Ij5cbiAgICA8c3BhbiBpZD0ieG1wcC1zdGF0dXMtaG9sZGVyIj5cbiAgICAgICAgPHNlbGVjdCBpZD0ic2VsZWN0LXhtcHAtc3RhdHVzIiBzdHlsZT0iZGlzcGxheTpub25lIj5cbiAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9Im9ubGluZSI+JysKKChfX3Q9KGxhYmVsX29ubGluZSkpPT1udWxsPycnOl9fdCkrCic8L29wdGlvbj5cbiAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9ImRuZCI+JysKKChfX3Q9KGxhYmVsX2J1c3kpKT09bnVsbD8nJzpfX3QpKwonPC9vcHRpb24+XG4gICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJhd2F5Ij4nKwooKF9fdD0obGFiZWxfYXdheSkpPT1udWxsPycnOl9fdCkrCic8L29wdGlvbj5cbiAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9Im9mZmxpbmUiPicrCigoX190PShsYWJlbF9vZmZsaW5lKSk9PW51bGw/Jyc6X190KSsKJzwvb3B0aW9uPlxuICAgICAgICAgICAgJzsKIGlmIChhbGxvd19sb2dvdXQpICB7IApfX3ArPSdcbiAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9ImxvZ291dCI+JysKKChfX3Q9KGxhYmVsX2xvZ291dCkpPT1udWxsPycnOl9fdCkrCic8L29wdGlvbj5cbiAgICAgICAgICAgICc7CiB9IApfX3ArPSdcbiAgICAgICAgPC9zZWxlY3Q+XG4gICAgPC9zcGFuPlxuPC9mb3JtPlxuJzsKfQpyZXR1cm4gX19wOwp9OyB9KTsKCgpkZWZpbmUoJ3RwbCFjb250YWN0c190YWInLCBbXSxmdW5jdGlvbiAoKSB7IHJldHVybiBmdW5jdGlvbihvYmopewp2YXIgX190LF9fcD0nJyxfX2o9QXJyYXkucHJvdG90eXBlLmpvaW4scHJpbnQ9ZnVuY3Rpb24oKXtfX3ArPV9fai5jYWxsKGFyZ3VtZW50cywnJyk7fTsKd2l0aChvYmp8fHt9KXsKX19wKz0nPGxpPjxhIGNsYXNzPSJzIGN1cnJlbnQiIGhyZWY9IiN1c2VycyI+JysKKChfX3Q9KGxhYmVsX2NvbnRhY3RzKSk9PW51bGw/Jyc6X190KSsKJzwvYT48L2xpPlxuJzsKfQpyZXR1cm4gX19wOwp9OyB9KTsKCgpkZWZpbmUoJ3RwbCFjb250cm9sYm94JywgW10sZnVuY3Rpb24gKCkgeyByZXR1cm4gZnVuY3Rpb24ob2JqKXsKdmFyIF9fdCxfX3A9JycsX19qPUFycmF5LnByb3RvdHlwZS5qb2luLHByaW50PWZ1bmN0aW9uKCl7X19wKz1fX2ouY2FsbChhcmd1bWVudHMsJycpO307CndpdGgob2JqfHx7fSl7Cl9fcCs9JzxkaXYgY2xhc3M9ImJveC1mbHlvdXQiIHN0eWxlPSJoZWlnaHQ6ICcrCigoX190PShoZWlnaHQpKT09bnVsbD8nJzpfX3QpKwoncHgiPlxuICAgIDxkaXYgY2xhc3M9ImRyYWdyZXNpemUgZHJhZ3Jlc2l6ZS10bSI+PC9kaXY+XG4gICAgPGRpdiBjbGFzcz0iY2hhdC1oZWFkIGNvbnRyb2xib3gtaGVhZCI+XG4gICAgICAgIDx1bCBpZD0iY29udHJvbGJveC10YWJzIj48L3VsPlxuICAgICAgICA8YSBjbGFzcz0iY2xvc2UtY2hhdGJveC1idXR0b24gaWNvbi1jbG9zZSI+PC9hPlxuICAgIDwvZGl2PlxuICAgIDxkaXYgY2xhc3M9ImNvbnRyb2xib3gtcGFuZXMiPjwvZGl2PlxuPC9kaXY+XG4nOwp9CnJldHVybiBfX3A7Cn07IH0pOwoKCmRlZmluZSgndHBsIWNvbnRyb2xib3hfdG9nZ2xlJywgW10sZnVuY3Rpb24gKCkgeyByZXR1cm4gZnVuY3Rpb24ob2JqKXsKdmFyIF9fdCxfX3A9JycsX19qPUFycmF5LnByb3RvdHlwZS5qb2luLHByaW50PWZ1bmN0aW9uKCl7X19wKz1fX2ouY2FsbChhcmd1bWVudHMsJycpO307CndpdGgob2JqfHx7fSl7Cl9fcCs9JzxzcGFuIGNsYXNzPSJjb25uLWZlZWRiYWNrIj4nKwooKF9fdD0obGFiZWxfdG9nZ2xlKSk9PW51bGw/Jyc6X190KSsKJzwvc3Bhbj5cbjxzcGFuIHN0eWxlPSJkaXNwbGF5OiBub25lIiBpZD0ib25saW5lLWNvdW50Ij4oMCk8L3NwYW4+XG4nOwp9CnJldHVybiBfX3A7Cn07IH0pOwoKCmRlZmluZSgndHBsIWZpZWxkJywgW10sZnVuY3Rpb24gKCkgeyByZXR1cm4gZnVuY3Rpb24ob2JqKXsKdmFyIF9fdCxfX3A9JycsX19qPUFycmF5LnByb3RvdHlwZS5qb2luLHByaW50PWZ1bmN0aW9uKCl7X19wKz1fX2ouY2FsbChhcmd1bWVudHMsJycpO307CndpdGgob2JqfHx7fSl7Cl9fcCs9JzxmaWVsZCB2YXI9IicrCigoX190PShuYW1lKSk9PW51bGw/Jyc6X190KSsKJyI+PHZhbHVlPicrCigoX190PSh2YWx1ZSkpPT1udWxsPycnOl9fdCkrCic8L3ZhbHVlPjwvZmllbGQ+XG4nOwp9CnJldHVybiBfX3A7Cn07IH0pOwoKCmRlZmluZSgndHBsIWZvcm1fY2hlY2tib3gnLCBbXSxmdW5jdGlvbiAoKSB7IHJldHVybiBmdW5jdGlvbihvYmopewp2YXIgX190LF9fcD0nJyxfX2o9QXJyYXkucHJvdG90eXBlLmpvaW4scHJpbnQ9ZnVuY3Rpb24oKXtfX3ArPV9fai5jYWxsKGFyZ3VtZW50cywnJyk7fTsKd2l0aChvYmp8fHt9KXsKX19wKz0nPGxhYmVsPicrCigoX190PShsYWJlbCkpPT1udWxsPycnOl9fdCkrCic8aW5wdXQgbmFtZT0iJysKKChfX3Q9KG5hbWUpKT09bnVsbD8nJzpfX3QpKwonIiB0eXBlPSInKwooKF9fdD0odHlwZSkpPT1udWxsPycnOl9fdCkrCiciICcrCigoX190PShjaGVja2VkKSk9PW51bGw/Jyc6X190KSsKJz48L2xhYmVsPlxuJzsKfQpyZXR1cm4gX19wOwp9OyB9KTsKCgpkZWZpbmUoJ3RwbCFmb3JtX2lucHV0JywgW10sZnVuY3Rpb24gKCkgeyByZXR1cm4gZnVuY3Rpb24ob2JqKXsKdmFyIF9fdCxfX3A9JycsX19qPUFycmF5LnByb3RvdHlwZS5qb2luLHByaW50PWZ1bmN0aW9uKCl7X19wKz1fX2ouY2FsbChhcmd1bWVudHMsJycpO307CndpdGgob2JqfHx7fSl7Cl9fcCs9JzxsYWJlbD4nKwooKF9fdD0obGFiZWwpKT09bnVsbD8nJzpfX3QpKwonPGlucHV0IG5hbWU9IicrCigoX190PShuYW1lKSk9PW51bGw/Jyc6X190KSsKJyIgdHlwZT0iJysKKChfX3Q9KHR5cGUpKT09bnVsbD8nJzpfX3QpKwonIiB2YWx1ZT0iJysKKChfX3Q9KHZhbHVlKSk9PW51bGw/Jyc6X190KSsKJyI+PC9sYWJlbD5cbic7Cn0KcmV0dXJuIF9fcDsKfTsgfSk7CgoKZGVmaW5lKCd0cGwhZm9ybV9zZWxlY3QnLCBbXSxmdW5jdGlvbiAoKSB7IHJldHVybiBmdW5jdGlvbihvYmopewp2YXIgX190LF9fcD0nJyxfX2o9QXJyYXkucHJvdG90eXBlLmpvaW4scHJpbnQ9ZnVuY3Rpb24oKXtfX3ArPV9fai5jYWxsKGFyZ3VtZW50cywnJyk7fTsKd2l0aChvYmp8fHt9KXsKX19wKz0nPGxhYmVsPicrCigoX190PShsYWJlbCkpPT1udWxsPycnOl9fdCkrCic8c2VsZWN0IG5hbWU9IicrCigoX190PShuYW1lKSk9PW51bGw/Jyc6X190KSsKJyI+JysKKChfX3Q9KG9wdGlvbnMpKT09bnVsbD8nJzpfX3QpKwonPC9zZWxlY3Q+PC9sYWJlbD5cbic7Cn0KcmV0dXJuIF9fcDsKfTsgfSk7CgoKZGVmaW5lKCd0cGwhZ3JvdXBfaGVhZGVyJywgW10sZnVuY3Rpb24gKCkgeyByZXR1cm4gZnVuY3Rpb24ob2JqKXsKdmFyIF9fdCxfX3A9JycsX19qPUFycmF5LnByb3RvdHlwZS5qb2luLHByaW50PWZ1bmN0aW9uKCl7X19wKz1fX2ouY2FsbChhcmd1bWVudHMsJycpO307CndpdGgob2JqfHx7fSl7Cl9fcCs9JzxhIGhyZWY9IiMiIGNsYXNzPSJncm91cC10b2dnbGUgaWNvbi0nKwooKF9fdD0odG9nZ2xlX3N0YXRlKSk9PW51bGw/Jyc6X190KSsKJyIgdGl0bGU9IicrCigoX190PShkZXNjX2dyb3VwX3RvZ2dsZSkpPT1udWxsPycnOl9fdCkrCiciPicrCigoX190PShsYWJlbF9ncm91cCkpPT1udWxsPycnOl9fdCkrCic8L2E+XG4nOwp9CnJldHVybiBfX3A7Cn07IH0pOwoKCmRlZmluZSgndHBsIWluZm8nLCBbXSxmdW5jdGlvbiAoKSB7IHJldHVybiBmdW5jdGlvbihvYmopewp2YXIgX190LF9fcD0nJyxfX2o9QXJyYXkucHJvdG90eXBlLmpvaW4scHJpbnQ9ZnVuY3Rpb24oKXtfX3ArPV9fai5jYWxsKGFyZ3VtZW50cywnJyk7fTsKd2l0aChvYmp8fHt9KXsKX19wKz0nPGRpdiBjbGFzcz0iY2hhdC1pbmZvIj4nKwooKF9fdD0obWVzc2FnZSkpPT1udWxsPycnOl9fdCkrCic8L2Rpdj5cbic7Cn0KcmV0dXJuIF9fcDsKfTsgfSk7CgoKZGVmaW5lKCd0cGwhbG9naW5fcGFuZWwnLCBbXSxmdW5jdGlvbiAoKSB7IHJldHVybiBmdW5jdGlvbihvYmopewp2YXIgX190LF9fcD0nJyxfX2o9QXJyYXkucHJvdG90eXBlLmpvaW4scHJpbnQ9ZnVuY3Rpb24oKXtfX3ArPV9fai5jYWxsKGFyZ3VtZW50cywnJyk7fTsKd2l0aChvYmp8fHt9KXsKX19wKz0nPGZvcm0gaWQ9ImNvbnZlcnNlLWxvZ2luIiBtZXRob2Q9InBvc3QiPlxuICAgIDxsYWJlbD4nKwooKF9fdD0obGFiZWxfdXNlcm5hbWUpKT09bnVsbD8nJzpfX3QpKwonPC9sYWJlbD5cbiAgICA8aW5wdXQgdHlwZT0idXNlcm5hbWUiIG5hbWU9ImppZCIgcGxhY2Vob2xkZXI9IlVzZXJuYW1lIj5cbiAgICA8bGFiZWw+JysKKChfX3Q9KGxhYmVsX3Bhc3N3b3JkKSk9PW51bGw/Jyc6X190KSsKJzwvbGFiZWw+XG4gICAgPGlucHV0IHR5cGU9InBhc3N3b3JkIiBuYW1lPSJwYXNzd29yZCIgcGxhY2Vob2xkZXI9IlBhc3N3b3JkIj5cbiAgICA8aW5wdXQgY2xhc3M9ImxvZ2luLXN1Ym1pdCIgdHlwZT0ic3VibWl0IiB2YWx1ZT0iJysKKChfX3Q9KGxhYmVsX2xvZ2luKSk9PW51bGw/Jyc6X190KSsKJyI+XG4gICAgPHNwYW4gY2xhc3M9ImNvbm4tZmVlZGJhY2siPjwvc3Bhbj5cbjwvZm9ybT5cbic7Cn0KcmV0dXJuIF9fcDsKfTsgfSk7CgoKZGVmaW5lKCd0cGwhbG9naW5fdGFiJywgW10sZnVuY3Rpb24gKCkgeyByZXR1cm4gZnVuY3Rpb24ob2JqKXsKdmFyIF9fdCxfX3A9JycsX19qPUFycmF5LnByb3RvdHlwZS5qb2luLHByaW50PWZ1bmN0aW9uKCl7X19wKz1fX2ouY2FsbChhcmd1bWVudHMsJycpO307CndpdGgob2JqfHx7fSl7Cl9fcCs9JzxsaT48YSBjbGFzcz0iY3VycmVudCIgaHJlZj0iI2xvZ2luIj4nKwooKF9fdD0obGFiZWxfc2lnbl9pbikpPT1udWxsPycnOl9fdCkrCic8L2E+PC9saT5cbic7Cn0KcmV0dXJuIF9fcDsKfTsgfSk7CgoKZGVmaW5lKCd0cGwhbWVzc2FnZScsIFtdLGZ1bmN0aW9uICgpIHsgcmV0dXJuIGZ1bmN0aW9uKG9iail7CnZhciBfX3QsX19wPScnLF9faj1BcnJheS5wcm90b3R5cGUuam9pbixwcmludD1mdW5jdGlvbigpe19fcCs9X19qLmNhbGwoYXJndW1lbnRzLCcnKTt9Owp3aXRoKG9ianx8e30pewpfX3ArPSc8ZGl2IGNsYXNzPSJjaGF0LW1lc3NhZ2UgJysKKChfX3Q9KGV4dHJhX2NsYXNzZXMpKT09bnVsbD8nJzpfX3QpKwonIj5cbiAgICA8c3BhbiBjbGFzcz0iY2hhdC1tZXNzYWdlLScrCigoX190PShzZW5kZXIpKT09bnVsbD8nJzpfX3QpKwonIj4nKwooKF9fdD0odGltZSkpPT1udWxsPycnOl9fdCkrCicgJysKKChfX3Q9KHVzZXJuYW1lKSk9PW51bGw/Jyc6X190KSsKJzombmJzcDs8L3NwYW4+XG4gICAgPHNwYW4gY2xhc3M9ImNoYXQtbWVzc2FnZS1jb250ZW50Ij4nKwooKF9fdD0obWVzc2FnZSkpPT1udWxsPycnOl9fdCkrCic8L3NwYW4+XG48L2Rpdj5cbic7Cn0KcmV0dXJuIF9fcDsKfTsgfSk7CgoKZGVmaW5lKCd0cGwhbmV3X2RheScsIFtdLGZ1bmN0aW9uICgpIHsgcmV0dXJuIGZ1bmN0aW9uKG9iail7CnZhciBfX3QsX19wPScnLF9faj1BcnJheS5wcm90b3R5cGUuam9pbixwcmludD1mdW5jdGlvbigpe19fcCs9X19qLmNhbGwoYXJndW1lbnRzLCcnKTt9Owp3aXRoKG9ianx8e30pewpfX3ArPSc8dGltZSBjbGFzcz0iY2hhdC1kYXRlIiBkYXRldGltZT0iJysKKChfX3Q9KGlzb2RhdGUpKT09bnVsbD8nJzpfX3QpKwonIj4nKwooKF9fdD0oZGF0ZXN0cmluZykpPT1udWxsPycnOl9fdCkrCic8L3RpbWU+XG4nOwp9CnJldHVybiBfX3A7Cn07IH0pOwoKCmRlZmluZSgndHBsIW9jY3VwYW50JywgW10sZnVuY3Rpb24gKCkgeyByZXR1cm4gZnVuY3Rpb24ob2JqKXsKdmFyIF9fdCxfX3A9JycsX19qPUFycmF5LnByb3RvdHlwZS5qb2luLHByaW50PWZ1bmN0aW9uKCl7X19wKz1fX2ouY2FsbChhcmd1bWVudHMsJycpO307CndpdGgob2JqfHx7fSl7Cl9fcCs9JzxsaSBjbGFzcz0iJysKKChfX3Q9KHJvbGUpKT09bnVsbD8nJzpfX3QpKwonIlxuICAgICc7CiBpZiAocm9sZSA9PT0gIm1vZGVyYXRvciIpIHsgCl9fcCs9J1xuICAgICAgIHRpdGxlPSInKwooKF9fdD0oZGVzY19tb2RlcmF0b3IpKT09bnVsbD8nJzpfX3QpKwonIlxuICAgICc7CiB9IApfX3ArPSdcbiAgICAnOwogaWYgKHJvbGUgPT09ICJwYXJ0aWNpcGFudCIpIHsgCl9fcCs9J1xuICAgICAgIHRpdGxlPSInKwooKF9fdD0oZGVzY19wYXJ0aWNpcGFudCkpPT1udWxsPycnOl9fdCkrCiciXG4gICAgJzsKIH0gCl9fcCs9J1xuICAgICc7CiBpZiAocm9sZSA9PT0gInZpc2l0b3IiKSB7IApfX3ArPSdcbiAgICAgICB0aXRsZT0iJysKKChfX3Q9KGRlc2NfdmlzaXRvcikpPT1udWxsPycnOl9fdCkrCiciXG4gICAgJzsKIH0gCl9fcCs9J1xuPicrCigoX190PShuaWNrKSk9PW51bGw/Jyc6X190KSsKJzwvbGk+XG4nOwp9CnJldHVybiBfX3A7Cn07IH0pOwoKCmRlZmluZSgndHBsIXBlbmRpbmdfY29udGFjdCcsIFtdLGZ1bmN0aW9uICgpIHsgcmV0dXJuIGZ1bmN0aW9uKG9iail7CnZhciBfX3QsX19wPScnLF9faj1BcnJheS5wcm90b3R5cGUuam9pbixwcmludD1mdW5jdGlvbigpe19fcCs9X19qLmNhbGwoYXJndW1lbnRzLCcnKTt9Owp3aXRoKG9ianx8e30pewpfX3ArPSc8c3BhbiBjbGFzcz0icGVuZGluZy1jb250YWN0LW5hbWUiPicrCigoX190PShmdWxsbmFtZSkpPT1udWxsPycnOl9fdCkrCic8L3NwYW4+IDxhIGNsYXNzPSJyZW1vdmUteG1wcC1jb250YWN0IGljb24tcmVtb3ZlIiB0aXRsZT0iJysKKChfX3Q9KGRlc2NfcmVtb3ZlKSk9PW51bGw/Jyc6X190KSsKJyIgaHJlZj0iIyI+PC9hPlxuJzsKfQpyZXR1cm4gX19wOwp9OyB9KTsKCgpkZWZpbmUoJ3RwbCFwZW5kaW5nX2NvbnRhY3RzJywgW10sZnVuY3Rpb24gKCkgeyByZXR1cm4gZnVuY3Rpb24ob2JqKXsKdmFyIF9fdCxfX3A9JycsX19qPUFycmF5LnByb3RvdHlwZS5qb2luLHByaW50PWZ1bmN0aW9uKCl7X19wKz1fX2ouY2FsbChhcmd1bWVudHMsJycpO307CndpdGgob2JqfHx7fSl7Cl9fcCs9JzxkdCBpZD0icGVuZGluZy14bXBwLWNvbnRhY3RzIj48YSBocmVmPSIjIiBjbGFzcz0iZ3JvdXAtdG9nZ2xlIGljb24tJysKKChfX3Q9KHRvZ2dsZV9zdGF0ZSkpPT1udWxsPycnOl9fdCkrCiciIHRpdGxlPSInKwooKF9fdD0oZGVzY19ncm91cF90b2dnbGUpKT09bnVsbD8nJzpfX3QpKwonIj4nKwooKF9fdD0obGFiZWxfcGVuZGluZ19jb250YWN0cykpPT1udWxsPycnOl9fdCkrCic8L2E+PC9kdD5cbic7Cn0KcmV0dXJuIF9fcDsKfTsgfSk7CgoKZGVmaW5lKCd0cGwhcmVxdWVzdGluZ19jb250YWN0JywgW10sZnVuY3Rpb24gKCkgeyByZXR1cm4gZnVuY3Rpb24ob2JqKXsKdmFyIF9fdCxfX3A9JycsX19qPUFycmF5LnByb3RvdHlwZS5qb2luLHByaW50PWZ1bmN0aW9uKCl7X19wKz1fX2ouY2FsbChhcmd1bWVudHMsJycpO307CndpdGgob2JqfHx7fSl7Cl9fcCs9JzxzcGFuIGNsYXNzPSJyZXEtY29udGFjdC1uYW1lIj4nKwooKF9fdD0oZnVsbG5hbWUpKT09bnVsbD8nJzpfX3QpKwonPC9zcGFuPlxuPHNwYW4gY2xhc3M9InJlcXVlc3QtYWN0aW9ucyI+XG4gICAgPGEgY2xhc3M9ImFjY2VwdC14bXBwLXJlcXVlc3QgaWNvbi1jaGVja21hcmsiIHRpdGxlPSInKwooKF9fdD0oZGVzY19hY2NlcHQpKT09bnVsbD8nJzpfX3QpKwonIiBocmVmPSIjIj48L2E+XG4gICAgPGEgY2xhc3M9ImRlY2xpbmUteG1wcC1yZXF1ZXN0IGljb24tY2xvc2UiIHRpdGxlPSInKwooKF9fdD0oZGVzY19kZWNsaW5lKSk9PW51bGw/Jyc6X190KSsKJyIgaHJlZj0iIyI+PC9hPlxuPC9zcGFuPlxuJzsKfQpyZXR1cm4gX19wOwp9OyB9KTsKCgpkZWZpbmUoJ3RwbCFyZXF1ZXN0aW5nX2NvbnRhY3RzJywgW10sZnVuY3Rpb24gKCkgeyByZXR1cm4gZnVuY3Rpb24ob2JqKXsKdmFyIF9fdCxfX3A9JycsX19qPUFycmF5LnByb3RvdHlwZS5qb2luLHByaW50PWZ1bmN0aW9uKCl7X19wKz1fX2ouY2FsbChhcmd1bWVudHMsJycpO307CndpdGgob2JqfHx7fSl7Cl9fcCs9JzxkdCBpZD0ieG1wcC1jb250YWN0LXJlcXVlc3RzIj48YSBocmVmPSIjIiBjbGFzcz0iZ3JvdXAtdG9nZ2xlIGljb24tJysKKChfX3Q9KHRvZ2dsZV9zdGF0ZSkpPT1udWxsPycnOl9fdCkrCiciIHRpdGxlPSInKwooKF9fdD0oZGVzY19ncm91cF90b2dnbGUpKT09bnVsbD8nJzpfX3QpKwonIj4nKwooKF9fdD0obGFiZWxfY29udGFjdF9yZXF1ZXN0cykpPT1udWxsPycnOl9fdCkrCic8L2E+PC9kdD5cbic7Cn0KcmV0dXJuIF9fcDsKfTsgfSk7CgoKZGVmaW5lKCd0cGwhcm9vbV9kZXNjcmlwdGlvbicsIFtdLGZ1bmN0aW9uICgpIHsgcmV0dXJuIGZ1bmN0aW9uKG9iail7CnZhciBfX3QsX19wPScnLF9faj1BcnJheS5wcm90b3R5cGUuam9pbixwcmludD1mdW5jdGlvbigpe19fcCs9X19qLmNhbGwoYXJndW1lbnRzLCcnKTt9Owp3aXRoKG9ianx8e30pewpfX3ArPSc8IS0tIEZJWE1FOiBjaGVjayBtYXJrdXAgaW4gbW9ja3VwIC0tPlxuPGRpdiBjbGFzcz0icm9vbS1pbmZvIj5cbjxwIGNsYXNzPSJyb29tLWluZm8iPjxzdHJvbmc+JysKKChfX3Q9KGxhYmVsX2Rlc2MpKT09bnVsbD8nJzpfX3QpKwonPC9zdHJvbmc+ICcrCigoX190PShkZXNjKSk9PW51bGw/Jyc6X190KSsKJzwvcD5cbjxwIGNsYXNzPSJyb29tLWluZm8iPjxzdHJvbmc+JysKKChfX3Q9KGxhYmVsX29jYykpPT1udWxsPycnOl9fdCkrCic8L3N0cm9uZz4gJysKKChfX3Q9KG9jYykpPT1udWxsPycnOl9fdCkrCic8L3A+XG48cCBjbGFzcz0icm9vbS1pbmZvIj48c3Ryb25nPicrCigoX190PShsYWJlbF9mZWF0dXJlcykpPT1udWxsPycnOl9fdCkrCic8L3N0cm9uZz5cbiAgICA8dWw+XG4gICAgICAgICc7CiBpZiAocGFzc3dvcmRwcm90ZWN0ZWQpIHsgCl9fcCs9J1xuICAgICAgICA8bGkgY2xhc3M9InJvb20taW5mbyBsb2NrZWQiPicrCigoX190PShsYWJlbF9yZXF1aXJlc19hdXRoKSk9PW51bGw/Jyc6X190KSsKJzwvbGk+XG4gICAgICAgICc7CiB9IApfX3ArPSdcbiAgICAgICAgJzsKIGlmIChoaWRkZW4pIHsgCl9fcCs9J1xuICAgICAgICA8bGkgY2xhc3M9InJvb20taW5mbyI+JysKKChfX3Q9KGxhYmVsX2hpZGRlbikpPT1udWxsPycnOl9fdCkrCic8L2xpPlxuICAgICAgICAnOwogfSAKX19wKz0nXG4gICAgICAgICc7CiBpZiAobWVtYmVyc29ubHkpIHsgCl9fcCs9J1xuICAgICAgICA8bGkgY2xhc3M9InJvb20taW5mbyI+JysKKChfX3Q9KGxhYmVsX3JlcXVpcmVzX2ludml0ZSkpPT1udWxsPycnOl9fdCkrCic8L2xpPlxuICAgICAgICAnOwogfSAKX19wKz0nXG4gICAgICAgICc7CiBpZiAobW9kZXJhdGVkKSB7IApfX3ArPSdcbiAgICAgICAgPGxpIGNsYXNzPSJyb29tLWluZm8iPicrCigoX190PShsYWJlbF9tb2RlcmF0ZWQpKT09bnVsbD8nJzpfX3QpKwonPC9saT5cbiAgICAgICAgJzsKIH0gCl9fcCs9J1xuICAgICAgICAnOwogaWYgKG5vbmFub255bW91cykgeyAKX19wKz0nXG4gICAgICAgIDxsaSBjbGFzcz0icm9vbS1pbmZvIj4nKwooKF9fdD0obGFiZWxfbm9uX2Fub24pKT09bnVsbD8nJzpfX3QpKwonPC9saT5cbiAgICAgICAgJzsKIH0gCl9fcCs9J1xuICAgICAgICAnOwogaWYgKG9wZW4pIHsgCl9fcCs9J1xuICAgICAgICA8bGkgY2xhc3M9InJvb20taW5mbyI+JysKKChfX3Q9KGxhYmVsX29wZW5fcm9vbSkpPT1udWxsPycnOl9fdCkrCic8L2xpPlxuICAgICAgICAnOwogfSAKX19wKz0nXG4gICAgICAgICc7CiBpZiAocGVyc2lzdGVudCkgeyAKX19wKz0nXG4gICAgICAgIDxsaSBjbGFzcz0icm9vbS1pbmZvIj4nKwooKF9fdD0obGFiZWxfcGVybWFuZW50X3Jvb20pKT09bnVsbD8nJzpfX3QpKwonPC9saT5cbiAgICAgICAgJzsKIH0gCl9fcCs9J1xuICAgICAgICAnOwogaWYgKHB1YmxpY3Jvb20pIHsgCl9fcCs9J1xuICAgICAgICA8bGkgY2xhc3M9InJvb20taW5mbyI+JysKKChfX3Q9KGxhYmVsX3B1YmxpYykpPT1udWxsPycnOl9fdCkrCic8L2xpPlxuICAgICAgICAnOwogfSAKX19wKz0nXG4gICAgICAgICc7CiBpZiAoc2VtaWFub255bW91cykgeyAKX19wKz0nXG4gICAgICAgIDxsaSBjbGFzcz0icm9vbS1pbmZvIj4nKwooKF9fdD0obGFiZWxfc2VtaV9hbm9uKSk9PW51bGw/Jyc6X190KSsKJzwvbGk+XG4gICAgICAgICc7CiB9IApfX3ArPSdcbiAgICAgICAgJzsKIGlmICh0ZW1wb3JhcnkpIHsgCl9fcCs9J1xuICAgICAgICA8bGkgY2xhc3M9InJvb20taW5mbyI+JysKKChfX3Q9KGxhYmVsX3RlbXBfcm9vbSkpPT1udWxsPycnOl9fdCkrCic8L2xpPlxuICAgICAgICAnOwogfSAKX19wKz0nXG4gICAgICAgICc7CiBpZiAodW5tb2RlcmF0ZWQpIHsgCl9fcCs9J1xuICAgICAgICA8bGkgY2xhc3M9InJvb20taW5mbyI+JysKKChfX3Q9KGxhYmVsX3VubW9kZXJhdGVkKSk9PW51bGw/Jyc6X190KSsKJzwvbGk+XG4gICAgICAgICc7CiB9IApfX3ArPSdcbiAgICA8L3VsPlxuPC9wPlxuPC9kaXY+XG4nOwp9CnJldHVybiBfX3A7Cn07IH0pOwoKCmRlZmluZSgndHBsIXJvb21faXRlbScsIFtdLGZ1bmN0aW9uICgpIHsgcmV0dXJuIGZ1bmN0aW9uKG9iail7CnZhciBfX3QsX19wPScnLF9faj1BcnJheS5wcm90b3R5cGUuam9pbixwcmludD1mdW5jdGlvbigpe19fcCs9X19qLmNhbGwoYXJndW1lbnRzLCcnKTt9Owp3aXRoKG9ianx8e30pewpfX3ArPSc8ZGQgY2xhc3M9ImF2YWlsYWJsZS1jaGF0cm9vbSI+XG48YSBjbGFzcz0ib3Blbi1yb29tIiBkYXRhLXJvb20tamlkPSInKwooKF9fdD0oamlkKSk9PW51bGw/Jyc6X190KSsKJyJcbiAgIHRpdGxlPSInKwooKF9fdD0ob3Blbl90aXRsZSkpPT1udWxsPycnOl9fdCkrCiciIGhyZWY9IiMiPicrCigoX190PShuYW1lKSk9PW51bGw/Jyc6X190KSsKJzwvYT5cbjxhIGNsYXNzPSJyb29tLWluZm8gaWNvbi1yb29tLWluZm8iIGRhdGEtcm9vbS1qaWQ9IicrCigoX190PShqaWQpKT09bnVsbD8nJzpfX3QpKwonIlxuICAgdGl0bGU9IicrCigoX190PShpbmZvX3RpdGxlKSk9PW51bGw/Jyc6X190KSsKJyIgaHJlZj0iIyI+Jm5ic3A7PC9hPlxuPC9kZD5cbic7Cn0KcmV0dXJuIF9fcDsKfTsgfSk7CgoKZGVmaW5lKCd0cGwhcm9vbV9wYW5lbCcsIFtdLGZ1bmN0aW9uICgpIHsgcmV0dXJuIGZ1bmN0aW9uKG9iail7CnZhciBfX3QsX19wPScnLF9faj1BcnJheS5wcm90b3R5cGUuam9pbixwcmludD1mdW5jdGlvbigpe19fcCs9X19qLmNhbGwoYXJndW1lbnRzLCcnKTt9Owp3aXRoKG9ianx8e30pewpfX3ArPSc8Zm9ybSBjbGFzcz0iYWRkLWNoYXRyb29tIiBhY3Rpb249IiIgbWV0aG9kPSJwb3N0Ij5cbiAgICA8aW5wdXQgdHlwZT0idGV4dCIgbmFtZT0iY2hhdHJvb20iIGNsYXNzPSJuZXctY2hhdHJvb20tbmFtZSJcbiAgICAgICAgcGxhY2Vob2xkZXI9IicrCigoX190PShsYWJlbF9yb29tX25hbWUpKT09bnVsbD8nJzpfX3QpKwonIi8+XG4gICAgPGlucHV0IHR5cGU9InRleHQiIG5hbWU9Im5pY2siIGNsYXNzPSJuZXctY2hhdHJvb20tbmljayJcbiAgICAgICAgcGxhY2Vob2xkZXI9IicrCigoX190PShsYWJlbF9uaWNrbmFtZSkpPT1udWxsPycnOl9fdCkrCiciLz5cbiAgICA8aW5wdXQgdHlwZT0iJysKKChfX3Q9KHNlcnZlcl9pbnB1dF90eXBlKSk9PW51bGw/Jyc6X190KSsKJyIgbmFtZT0ic2VydmVyIiBjbGFzcz0ibmV3LWNoYXRyb29tLXNlcnZlciJcbiAgICAgICAgcGxhY2Vob2xkZXI9IicrCigoX190PShsYWJlbF9zZXJ2ZXIpKT09bnVsbD8nJzpfX3QpKwonIi8+XG4gICAgPGlucHV0IHR5cGU9InN1Ym1pdCIgbmFtZT0iam9pbiIgdmFsdWU9IicrCigoX190PShsYWJlbF9qb2luKSk9PW51bGw/Jyc6X190KSsKJyIvPlxuICAgIDxpbnB1dCB0eXBlPSJidXR0b24iIG5hbWU9InNob3ciIGlkPSJzaG93LXJvb21zIiB2YWx1ZT0iJysKKChfX3Q9KGxhYmVsX3Nob3dfcm9vbXMpKT09bnVsbD8nJzpfX3QpKwonIi8+XG48L2Zvcm0+XG48ZGwgaWQ9ImF2YWlsYWJsZS1jaGF0cm9vbXMiPjwvZGw+XG4nOwp9CnJldHVybiBfX3A7Cn07IH0pOwoKCmRlZmluZSgndHBsIXJvc3RlcicsIFtdLGZ1bmN0aW9uICgpIHsgcmV0dXJuIGZ1bmN0aW9uKG9iail7CnZhciBfX3QsX19wPScnLF9faj1BcnJheS5wcm90b3R5cGUuam9pbixwcmludD1mdW5jdGlvbigpe19fcCs9X19qLmNhbGwoYXJndW1lbnRzLCcnKTt9Owp3aXRoKG9ianx8e30pewpfX3ArPSc8aW5wdXQgc3R5bGU9ImRpc3BsYXk6IG5vbmU7IiBjbGFzcz0icm9zdGVyLWZpbHRlciIgcGxhY2Vob2xkZXI9IicrCigoX190PShwbGFjZWhvbGRlcikpPT1udWxsPycnOl9fdCkrCiciPlxuPHNlbGVjdCBzdHlsZT0iZGlzcGxheTogbm9uZTsiIGNsYXNzPSJmaWx0ZXItdHlwZSI+XG4gICAgPG9wdGlvbiB2YWx1ZT0iY29udGFjdHMiPicrCigoX190PShsYWJlbF9jb250YWN0cykpPT1udWxsPycnOl9fdCkrCic8L29wdGlvbj5cbiAgICA8b3B0aW9uIHZhbHVlPSJncm91cHMiPicrCigoX190PShsYWJlbF9ncm91cHMpKT09bnVsbD8nJzpfX3QpKwonPC9vcHRpb24+XG48L3NlbGVjdD5cbic7Cn0KcmV0dXJuIF9fcDsKfTsgfSk7CgoKZGVmaW5lKCd0cGwhcm9zdGVyX2l0ZW0nLCBbXSxmdW5jdGlvbiAoKSB7IHJldHVybiBmdW5jdGlvbihvYmopewp2YXIgX190LF9fcD0nJyxfX2o9QXJyYXkucHJvdG90eXBlLmpvaW4scHJpbnQ9ZnVuY3Rpb24oKXtfX3ArPV9fai5jYWxsKGFyZ3VtZW50cywnJyk7fTsKd2l0aChvYmp8fHt9KXsKX19wKz0nPGEgY2xhc3M9Im9wZW4tY2hhdCIgdGl0bGU9IicrCigoX190PShkZXNjX2NoYXQpKT09bnVsbD8nJzpfX3QpKwonIiBocmVmPSIjIj48c3BhbiBjbGFzcz0iaWNvbi0nKwooKF9fdD0oY2hhdF9zdGF0dXMpKT09bnVsbD8nJzpfX3QpKwonIiB0aXRsZT0iJysKKChfX3Q9KGRlc2Nfc3RhdHVzKSk9PW51bGw/Jyc6X190KSsKJyI+PC9zcGFuPicrCigoX190PShmdWxsbmFtZSkpPT1udWxsPycnOl9fdCkrCic8L2E+XG48YSBjbGFzcz0icmVtb3ZlLXhtcHAtY29udGFjdCBpY29uLXJlbW92ZSIgdGl0bGU9IicrCigoX190PShkZXNjX3JlbW92ZSkpPT1udWxsPycnOl9fdCkrCiciIGhyZWY9IiMiPjwvYT5cbic7Cn0KcmV0dXJuIF9fcDsKfTsgfSk7CgoKZGVmaW5lKCd0cGwhc2VsZWN0X29wdGlvbicsIFtdLGZ1bmN0aW9uICgpIHsgcmV0dXJuIGZ1bmN0aW9uKG9iail7CnZhciBfX3QsX19wPScnLF9faj1BcnJheS5wcm90b3R5cGUuam9pbixwcmludD1mdW5jdGlvbigpe19fcCs9X19qLmNhbGwoYXJndW1lbnRzLCcnKTt9Owp3aXRoKG9ianx8e30pewpfX3ArPSc8b3B0aW9uIHZhbHVlPSInKwooKF9fdD0odmFsdWUpKT09bnVsbD8nJzpfX3QpKwonIj4nKwooKF9fdD0obGFiZWwpKT09bnVsbD8nJzpfX3QpKwonPC9vcHRpb24+XG4nOwp9CnJldHVybiBfX3A7Cn07IH0pOwoKCmRlZmluZSgndHBsIXNlYXJjaF9jb250YWN0JywgW10sZnVuY3Rpb24gKCkgeyByZXR1cm4gZnVuY3Rpb24ob2JqKXsKdmFyIF9fdCxfX3A9JycsX19qPUFycmF5LnByb3RvdHlwZS5qb2luLHByaW50PWZ1bmN0aW9uKCl7X19wKz1fX2ouY2FsbChhcmd1bWVudHMsJycpO307CndpdGgob2JqfHx7fSl7Cl9fcCs9JzxsaT5cbiAgICA8Zm9ybSBjbGFzcz0ic2VhcmNoLXhtcHAtY29udGFjdCI+XG4gICAgICAgIDxpbnB1dCB0eXBlPSJ0ZXh0IlxuICAgICAgICAgICAgbmFtZT0iaWRlbnRpZmllciJcbiAgICAgICAgICAgIGNsYXNzPSJ1c2VybmFtZSJcbiAgICAgICAgICAgIHBsYWNlaG9sZGVyPSInKwooKF9fdD0obGFiZWxfY29udGFjdF9uYW1lKSk9PW51bGw/Jyc6X190KSsKJyIvPlxuICAgICAgICA8YnV0dG9uIHR5cGU9InN1Ym1pdCI+JysKKChfX3Q9KGxhYmVsX3NlYXJjaCkpPT1udWxsPycnOl9fdCkrCic8L2J1dHRvbj5cbiAgICA8L2Zvcm0+XG48L2xpPlxuJzsKfQpyZXR1cm4gX19wOwp9OyB9KTsKCgpkZWZpbmUoJ3RwbCFzdGF0dXNfb3B0aW9uJywgW10sZnVuY3Rpb24gKCkgeyByZXR1cm4gZnVuY3Rpb24ob2JqKXsKdmFyIF9fdCxfX3A9JycsX19qPUFycmF5LnByb3RvdHlwZS5qb2luLHByaW50PWZ1bmN0aW9uKCl7X19wKz1fX2ouY2FsbChhcmd1bWVudHMsJycpO307CndpdGgob2JqfHx7fSl7Cl9fcCs9JzxsaT5cbiAgICA8YSBocmVmPSIjIiBjbGFzcz0iJysKKChfX3Q9KCB2YWx1ZSApKT09bnVsbD8nJzpfX3QpKwonIiBkYXRhLXZhbHVlPSInKwooKF9fdD0oIHZhbHVlICkpPT1udWxsPycnOl9fdCkrCiciPlxuICAgICAgICA8c3BhbiBjbGFzcz0iaWNvbi0nKwooKF9fdD0oIHZhbHVlICkpPT1udWxsPycnOl9fdCkrCiciPjwvc3Bhbj5cbiAgICAgICAgJysKKChfX3Q9KCB0ZXh0ICkpPT1udWxsPycnOl9fdCkrCidcbiAgICA8L2E+XG48L2xpPlxuJzsKfQpyZXR1cm4gX19wOwp9OyB9KTsKCgpkZWZpbmUoJ3RwbCF0b2dnbGVfY2hhdHMnLCBbXSxmdW5jdGlvbiAoKSB7IHJldHVybiBmdW5jdGlvbihvYmopewp2YXIgX190LF9fcD0nJyxfX2o9QXJyYXkucHJvdG90eXBlLmpvaW4scHJpbnQ9ZnVuY3Rpb24oKXtfX3ArPV9fai5jYWxsKGFyZ3VtZW50cywnJyk7fTsKd2l0aChvYmp8fHt9KXsKX19wKz0nJysKKChfX3Q9KE1pbmltaXplZCkpPT1udWxsPycnOl9fdCkrCicgPHNwYW4gaWQ9Im1pbmltaXplZC1jb3VudCI+KCcrCigoX190PShudW1fbWluaW1pemVkKSk9PW51bGw/Jyc6X190KSsKJyk8L3NwYW4+XG48c3BhbiBjbGFzcz0idW5yZWFkLW1lc3NhZ2UtY291bnQiXG4gICAgJzsKIGlmICghbnVtX3VucmVhZCkgeyAKX19wKz0nIHN0eWxlPSJkaXNwbGF5OiBub25lIiAnOwogfSAKX19wKz0nXG4gICAgaHJlZj0iIyI+JysKKChfX3Q9KG51bV91bnJlYWQpKT09bnVsbD8nJzpfX3QpKwonPC9zcGFuPlxuJzsKfQpyZXR1cm4gX19wOwp9OyB9KTsKCgpkZWZpbmUoJ3RwbCF0b29sYmFyJywgW10sZnVuY3Rpb24gKCkgeyByZXR1cm4gZnVuY3Rpb24ob2JqKXsKdmFyIF9fdCxfX3A9JycsX19qPUFycmF5LnByb3RvdHlwZS5qb2luLHByaW50PWZ1bmN0aW9uKCl7X19wKz1fX2ouY2FsbChhcmd1bWVudHMsJycpO307CndpdGgob2JqfHx7fSl7Cl9fcCs9Jyc7CiBpZiAoc2hvd19lbW90aWNvbnMpICB7IApfX3ArPSdcbiAgICA8bGkgY2xhc3M9InRvZ2dsZS1zbWlsZXkgaWNvbi1oYXBweSIgdGl0bGU9Ikluc2VydCBhIHNtaWxlcnkiPlxuICAgICAgICA8dWw+XG4gICAgICAgICAgICA8bGk+PGEgY2xhc3M9Imljb24tc21pbGV5IiBocmVmPSIjIiBkYXRhLWVtb3RpY29uPSI6KSI+PC9hPjwvbGk+XG4gICAgICAgICAgICA8bGk+PGEgY2xhc3M9Imljb24td2luayIgaHJlZj0iIyIgZGF0YS1lbW90aWNvbj0iOykiPjwvYT48L2xpPlxuICAgICAgICAgICAgPGxpPjxhIGNsYXNzPSJpY29uLWdyaW4iIGhyZWY9IiMiIGRhdGEtZW1vdGljb249IjpEIj48L2E+PC9saT5cbiAgICAgICAgICAgIDxsaT48YSBjbGFzcz0iaWNvbi10b25ndWUiIGhyZWY9IiMiIGRhdGEtZW1vdGljb249IjpQIj48L2E+PC9saT5cbiAgICAgICAgICAgIDxsaT48YSBjbGFzcz0iaWNvbi1jb29sIiBocmVmPSIjIiBkYXRhLWVtb3RpY29uPSI4KSI+PC9hPjwvbGk+XG4gICAgICAgICAgICA8bGk+PGEgY2xhc3M9Imljb24tZXZpbCIgaHJlZj0iIyIgZGF0YS1lbW90aWNvbj0iPjopIj48L2E+PC9saT5cbiAgICAgICAgICAgIDxsaT48YSBjbGFzcz0iaWNvbi1jb25mdXNlZCIgaHJlZj0iIyIgZGF0YS1lbW90aWNvbj0iOlMiPjwvYT48L2xpPlxuICAgICAgICAgICAgPGxpPjxhIGNsYXNzPSJpY29uLXdvbmRlcmluZyIgaHJlZj0iIyIgZGF0YS1lbW90aWNvbj0iOlxcIj48L2E+PC9saT5cbiAgICAgICAgICAgIDxsaT48YSBjbGFzcz0iaWNvbi1hbmdyeSIgaHJlZj0iIyIgZGF0YS1lbW90aWNvbj0iPjooIj48L2E+PC9saT5cbiAgICAgICAgICAgIDxsaT48YSBjbGFzcz0iaWNvbi1zYWQiIGhyZWY9IiMiIGRhdGEtZW1vdGljb249IjooIj48L2E+PC9saT5cbiAgICAgICAgICAgIDxsaT48YSBjbGFzcz0iaWNvbi1zaG9ja2VkIiBocmVmPSIjIiBkYXRhLWVtb3RpY29uPSI6TyI+PC9hPjwvbGk+XG4gICAgICAgICAgICA8bGk+PGEgY2xhc3M9Imljb24tdGh1bWJzLXVwIiBocmVmPSIjIiBkYXRhLWVtb3RpY29uPSIoXi5eKWIiPjwvYT48L2xpPlxuICAgICAgICAgICAgPGxpPjxhIGNsYXNzPSJpY29uLWhlYXJ0IiBocmVmPSIjIiBkYXRhLWVtb3RpY29uPSI8MyI+PC9hPjwvbGk+XG4gICAgICAgIDwvdWw+XG4gICAgPC9saT5cbic7CiB9IApfX3ArPSdcbic7CiBpZiAoc2hvd19jYWxsX2J1dHRvbikgIHsgCl9fcCs9J1xuPGxpIGNsYXNzPSJ0b2dnbGUtY2FsbCI+PGEgY2xhc3M9Imljb24tcGhvbmUiIHRpdGxlPSInKwooKF9fdD0obGFiZWxfc3RhcnRfY2FsbCkpPT1udWxsPycnOl9fdCkrCiciPjwvYT48L2xpPlxuJzsKIH0gCl9fcCs9J1xuJzsKIGlmIChzaG93X3BhcnRpY2lwYW50c190b2dnbGUpICB7IApfX3ArPSdcbjxsaSBjbGFzcz0idG9nZ2xlLXBhcnRpY2lwYW50cyI+PGEgY2xhc3M9Imljb24taGlkZS11c2VycyIgdGl0bGU9IicrCigoX190PShsYWJlbF9oaWRlX3BhcnRpY2lwYW50cykpPT1udWxsPycnOl9fdCkrCiciPjwvYT48L2xpPlxuJzsKIH0gCl9fcCs9J1xuJzsKIGlmIChzaG93X2NsZWFyX2J1dHRvbikgIHsgCl9fcCs9J1xuPGxpIGNsYXNzPSJ0b2dnbGUtY2xlYXIiPjxhIGNsYXNzPSJpY29uLXJlbW92ZSIgdGl0bGU9IicrCigoX190PShsYWJlbF9jbGVhcikpPT1udWxsPycnOl9fdCkrCiciPjwvYT48L2xpPlxuJzsKIH0gCl9fcCs9J1xuJzsKIGlmIChhbGxvd19vdHIpICB7IApfX3ArPSdcbiAgICA8bGkgY2xhc3M9InRvZ2dsZS1vdHIgJysKKChfX3Q9KG90cl9zdGF0dXNfY2xhc3MpKT09bnVsbD8nJzpfX3QpKwonIiB0aXRsZT0iJysKKChfX3Q9KG90cl90b29sdGlwKSk9PW51bGw/Jyc6X190KSsKJyI+XG4gICAgICAgIDxzcGFuIGNsYXNzPSJjaGF0LXRvb2xiYXItdGV4dCI+JysKKChfX3Q9KG90cl90cmFuc2xhdGVkX3N0YXR1cykpPT1udWxsPycnOl9fdCkrCic8L3NwYW4+XG4gICAgICAgICc7CiBpZiAob3RyX3N0YXR1cyA9PSBVTkVOQ1JZUFRFRCkgeyAKX19wKz0nXG4gICAgICAgICAgICA8c3BhbiBjbGFzcz0iaWNvbi11bmxvY2tlZCI+PC9zcGFuPlxuICAgICAgICAnOwogfSAKX19wKz0nXG4gICAgICAgICc7CiBpZiAob3RyX3N0YXR1cyA9PSBVTlZFUklGSUVEKSB7IApfX3ArPSdcbiAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJpY29uLWxvY2siPjwvc3Bhbj5cbiAgICAgICAgJzsKIH0gCl9fcCs9J1xuICAgICAgICAnOwogaWYgKG90cl9zdGF0dXMgPT0gVkVSSUZJRUQpIHsgCl9fcCs9J1xuICAgICAgICAgICAgPHNwYW4gY2xhc3M9Imljb24tbG9jayI+PC9zcGFuPlxuICAgICAgICAnOwogfSAKX19wKz0nXG4gICAgICAgICc7CiBpZiAob3RyX3N0YXR1cyA9PSBGSU5JU0hFRCkgeyAKX19wKz0nXG4gICAgICAgICAgICA8c3BhbiBjbGFzcz0iaWNvbi11bmxvY2tlZCI+PC9zcGFuPlxuICAgICAgICAnOwogfSAKX19wKz0nXG4gICAgICAgIDx1bD5cbiAgICAgICAgICAgICc7CiBpZiAob3RyX3N0YXR1cyA9PSBVTkVOQ1JZUFRFRCkgeyAKX19wKz0nXG4gICAgICAgICAgICAgICA8bGk+PGEgY2xhc3M9InN0YXJ0LW90ciIgaHJlZj0iIyI+JysKKChfX3Q9KGxhYmVsX3N0YXJ0X2VuY3J5cHRlZF9jb252ZXJzYXRpb24pKT09bnVsbD8nJzpfX3QpKwonPC9hPjwvbGk+XG4gICAgICAgICAgICAnOwogfSAKX19wKz0nXG4gICAgICAgICAgICAnOwogaWYgKG90cl9zdGF0dXMgIT0gVU5FTkNSWVBURUQpIHsgCl9fcCs9J1xuICAgICAgICAgICAgICAgPGxpPjxhIGNsYXNzPSJzdGFydC1vdHIiIGhyZWY9IiMiPicrCigoX190PShsYWJlbF9yZWZyZXNoX2VuY3J5cHRlZF9jb252ZXJzYXRpb24pKT09bnVsbD8nJzpfX3QpKwonPC9hPjwvbGk+XG4gICAgICAgICAgICAgICA8bGk+PGEgY2xhc3M9ImVuZC1vdHIiIGhyZWY9IiMiPicrCigoX190PShsYWJlbF9lbmRfZW5jcnlwdGVkX2NvbnZlcnNhdGlvbikpPT1udWxsPycnOl9fdCkrCic8L2E+PC9saT5cbiAgICAgICAgICAgICAgIDxsaT48YSBjbGFzcz0iYXV0aC1vdHIiIGRhdGEtc2NoZW1lPSJzbXAiIGhyZWY9IiMiPicrCigoX190PShsYWJlbF92ZXJpZnlfd2l0aF9zbXApKT09bnVsbD8nJzpfX3QpKwonPC9hPjwvbGk+XG4gICAgICAgICAgICAnOwogfSAKX19wKz0nXG4gICAgICAgICAgICAnOwogaWYgKG90cl9zdGF0dXMgPT0gVU5WRVJJRklFRCkgeyAKX19wKz0nXG4gICAgICAgICAgICAgICA8bGk+PGEgY2xhc3M9ImF1dGgtb3RyIiBkYXRhLXNjaGVtZT0iZmluZ2VycHJpbnQiIGhyZWY9IiMiPicrCigoX190PShsYWJlbF92ZXJpZnlfd2l0aF9maW5nZXJwcmludHMpKT09bnVsbD8nJzpfX3QpKwonPC9hPjwvbGk+XG4gICAgICAgICAgICAnOwogfSAKX19wKz0nXG4gICAgICAgICAgICA8bGk+PGEgaHJlZj0iaHR0cDovL3d3dy5jeXBoZXJwdW5rcy5jYS9vdHIvaGVscC8zLjIuMC9sZXZlbHMucGhwIiB0YXJnZXQ9Il9ibGFuayI+JysKKChfX3Q9KGxhYmVsX3doYXRzX3RoaXMpKT09bnVsbD8nJzpfX3QpKwonPC9hPjwvbGk+XG4gICAgICAgIDwvdWw+XG4gICAgPC9saT5cbic7CiB9IApfX3ArPSdcbic7Cn0KcmV0dXJuIF9fcDsKfTsgfSk7CgoKZGVmaW5lKCd0cGwhdHJpbW1lZF9jaGF0JywgW10sZnVuY3Rpb24gKCkgeyByZXR1cm4gZnVuY3Rpb24ob2JqKXsKdmFyIF9fdCxfX3A9JycsX19qPUFycmF5LnByb3RvdHlwZS5qb2luLHByaW50PWZ1bmN0aW9uKCl7X19wKz1fX2ouY2FsbChhcmd1bWVudHMsJycpO307CndpdGgob2JqfHx7fSl7Cl9fcCs9JzxhIGNsYXNzPSJjbG9zZS1jaGF0Ym94LWJ1dHRvbiBpY29uLWNsb3NlIj48L2E+XG48YSBjbGFzcz0iY2hhdC1oZWFkLW1lc3NhZ2UtY291bnQiIFxuICAgICc7CiBpZiAoIW51bV91bnJlYWQpIHsgCl9fcCs9JyBzdHlsZT0iZGlzcGxheTogbm9uZSIgJzsKIH0gCl9fcCs9J1xuICAgIGhyZWY9IiMiPicrCigoX190PShudW1fdW5yZWFkKSk9PW51bGw/Jyc6X190KSsKJzwvYT5cbjxhIGhyZWY9IiMiIGNsYXNzPSJyZXN0b3JlLWNoYXQiIHRpdGxlPSInKwooKF9fdD0odG9vbHRpcCkpPT1udWxsPycnOl9fdCkrCiciPlxuICAgICcrCigoX190PSggdGl0bGUgKSk9PW51bGw/Jyc6X190KSsKJ1xuPC9hPlxuJzsKfQpyZXR1cm4gX19wOwp9OyB9KTsKCmRlZmluZSgiY29udmVyc2UtdGVtcGxhdGVzIiwgWwogICAgInRwbCFhY3Rpb24iLAogICAgInRwbCFhZGRfY29udGFjdF9kcm9wZG93biIsCiAgICAidHBsIWFkZF9jb250YWN0X2Zvcm0iLAogICAgInRwbCFjaGFuZ2Vfc3RhdHVzX21lc3NhZ2UiLAogICAgInRwbCFjaGF0X3N0YXR1cyIsCiAgICAidHBsIWNoYXRhcmVhIiwKICAgICJ0cGwhY2hhdGJveCIsCiAgICAidHBsIWNoYXRyb29tIiwKICAgICJ0cGwhY2hhdHJvb21fcGFzc3dvcmRfZm9ybSIsCiAgICAidHBsIWNoYXRyb29tX3NpZGViYXIiLAogICAgInRwbCFjaGF0cm9vbXNfdGFiIiwKICAgICJ0cGwhY2hhdHNfcGFuZWwiLAogICAgInRwbCFjaG9vc2Vfc3RhdHVzIiwKICAgICJ0cGwhY29udGFjdHNfcGFuZWwiLAogICAgInRwbCFjb250YWN0c190YWIiLAogICAgInRwbCFjb250cm9sYm94IiwKICAgICJ0cGwhY29udHJvbGJveF90b2dnbGUiLAogICAgInRwbCFmaWVsZCIsCiAgICAidHBsIWZvcm1fY2hlY2tib3giLAogICAgInRwbCFmb3JtX2lucHV0IiwKICAgICJ0cGwhZm9ybV9zZWxlY3QiLAogICAgInRwbCFncm91cF9oZWFkZXIiLAogICAgInRwbCFpbmZvIiwKICAgICJ0cGwhbG9naW5fcGFuZWwiLAogICAgInRwbCFsb2dpbl90YWIiLAogICAgInRwbCFtZXNzYWdlIiwKICAgICJ0cGwhbmV3X2RheSIsCiAgICAidHBsIW9jY3VwYW50IiwKICAgICJ0cGwhcGVuZGluZ19jb250YWN0IiwKICAgICJ0cGwhcGVuZGluZ19jb250YWN0cyIsCiAgICAidHBsIXJlcXVlc3RpbmdfY29udGFjdCIsCiAgICAidHBsIXJlcXVlc3RpbmdfY29udGFjdHMiLAogICAgInRwbCFyb29tX2Rlc2NyaXB0aW9uIiwKICAgICJ0cGwhcm9vbV9pdGVtIiwKICAgICJ0cGwhcm9vbV9wYW5lbCIsCiAgICAidHBsIXJvc3RlciIsCiAgICAidHBsIXJvc3Rlcl9pdGVtIiwKICAgICJ0cGwhc2VsZWN0X29wdGlvbiIsCiAgICAidHBsIXNlYXJjaF9jb250YWN0IiwKICAgICJ0cGwhc3RhdHVzX29wdGlvbiIsCiAgICAidHBsIXRvZ2dsZV9jaGF0cyIsCiAgICAidHBsIXRvb2xiYXIiLAogICAgInRwbCF0cmltbWVkX2NoYXQiCl0sIGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiB7CiAgICAgICAgYWN0aW9uOiAgICAgICAgICAgICAgICAgYXJndW1lbnRzWzBdLAogICAgICAgIGFkZF9jb250YWN0X2Ryb3Bkb3duOiAgIGFyZ3VtZW50c1sxXSwKICAgICAgICBhZGRfY29udGFjdF9mb3JtOiAgICAgICBhcmd1bWVudHNbMl0sCiAgICAgICAgY2hhbmdlX3N0YXR1c19tZXNzYWdlOiAgYXJndW1lbnRzWzNdLAogICAgICAgIGNoYXRfc3RhdHVzOiAgICAgICAgICAgIGFyZ3VtZW50c1s0XSwKICAgICAgICBjaGF0YXJlYTogICAgICAgICAgICAgICBhcmd1bWVudHNbNV0sCiAgICAgICAgY2hhdGJveDogICAgICAgICAgICAgICAgYXJndW1lbnRzWzZdLAogICAgICAgIGNoYXRyb29tOiAgICAgICAgICAgICAgIGFyZ3VtZW50c1s3XSwKICAgICAgICBjaGF0cm9vbV9wYXNzd29yZF9mb3JtOiBhcmd1bWVudHNbOF0sCiAgICAgICAgY2hhdHJvb21fc2lkZWJhcjogICAgICAgYXJndW1lbnRzWzldLAogICAgICAgIGNoYXRyb29tc190YWI6ICAgICAgICAgIGFyZ3VtZW50c1sxMF0sCiAgICAgICAgY2hhdHNfcGFuZWw6ICAgICAgICAgICAgYXJndW1lbnRzWzExXSwKICAgICAgICBjaG9vc2Vfc3RhdHVzOiAgICAgICAgICBhcmd1bWVudHNbMTJdLAogICAgICAgIGNvbnRhY3RzX3BhbmVsOiAgICAgICAgIGFyZ3VtZW50c1sxM10sCiAgICAgICAgY29udGFjdHNfdGFiOiAgICAgICAgICAgYXJndW1lbnRzWzE0XSwKICAgICAgICBjb250cm9sYm94OiAgICAgICAgICAgICBhcmd1bWVudHNbMTVdLAogICAgICAgIGNvbnRyb2xib3hfdG9nZ2xlOiAgICAgIGFyZ3VtZW50c1sxNl0sCiAgICAgICAgZmllbGQ6ICAgICAgICAgICAgICAgICAgYXJndW1lbnRzWzE3XSwKICAgICAgICBmb3JtX2NoZWNrYm94OiAgICAgICAgICBhcmd1bWVudHNbMThdLAogICAgICAgIGZvcm1faW5wdXQ6ICAgICAgICAgICAgIGFyZ3VtZW50c1sxOV0sCiAgICAgICAgZm9ybV9zZWxlY3Q6ICAgICAgICAgICAgYXJndW1lbnRzWzIwXSwKICAgICAgICBncm91cF9oZWFkZXI6ICAgICAgICAgICBhcmd1bWVudHNbMjFdLAogICAgICAgIGluZm86ICAgICAgICAgICAgICAgICAgIGFyZ3VtZW50c1syMl0sCiAgICAgICAgbG9naW5fcGFuZWw6ICAgICAgICAgICAgYXJndW1lbnRzWzIzXSwKICAgICAgICBsb2dpbl90YWI6ICAgICAgICAgICAgICBhcmd1bWVudHNbMjRdLAogICAgICAgIG1lc3NhZ2U6ICAgICAgICAgICAgICAgIGFyZ3VtZW50c1syNV0sCiAgICAgICAgbmV3X2RheTogICAgICAgICAgICAgICAgYXJndW1lbnRzWzI2XSwKICAgICAgICBvY2N1cGFudDogICAgICAgICAgICAgICBhcmd1bWVudHNbMjddLAogICAgICAgIHBlbmRpbmdfY29udGFjdDogICAgICAgIGFyZ3VtZW50c1syOF0sCiAgICAgICAgcGVuZGluZ19jb250YWN0czogICAgICAgYXJndW1lbnRzWzI5XSwKICAgICAgICByZXF1ZXN0aW5nX2NvbnRhY3Q6ICAgICBhcmd1bWVudHNbMzBdLAogICAgICAgIHJlcXVlc3RpbmdfY29udGFjdHM6ICAgIGFyZ3VtZW50c1szMV0sCiAgICAgICAgcm9vbV9kZXNjcmlwdGlvbjogICAgICAgYXJndW1lbnRzWzMyXSwKICAgICAgICByb29tX2l0ZW06ICAgICAgICAgICAgICBhcmd1bWVudHNbMzNdLAogICAgICAgIHJvb21fcGFuZWw6ICAgICAgICAgICAgIGFyZ3VtZW50c1szNF0sCiAgICAgICAgcm9zdGVyOiAgICAgICAgICAgICAgICAgYXJndW1lbnRzWzM1XSwKICAgICAgICByb3N0ZXJfaXRlbTogICAgICAgICAgICBhcmd1bWVudHNbMzZdLAogICAgICAgIHNlbGVjdF9vcHRpb246ICAgICAgICAgIGFyZ3VtZW50c1szN10sCiAgICAgICAgc2VhcmNoX2NvbnRhY3Q6ICAgICAgICAgYXJndW1lbnRzWzM4XSwKICAgICAgICBzdGF0dXNfb3B0aW9uOiAgICAgICAgICBhcmd1bWVudHNbMzldLAogICAgICAgIHRvZ2dsZV9jaGF0czogICAgICAgICAgIGFyZ3VtZW50c1s0MF0sCiAgICAgICAgdG9vbGJhcjogICAgICAgICAgICAgICAgYXJndW1lbnRzWzQxXSwKICAgICAgICB0cmltbWVkX2NoYXQ6ICAgICAgICAgICBhcmd1bWVudHNbNDJdCiAgICB9Owp9KTsKCi8qIQogKiBDb252ZXJzZS5qcyAoV2ViLWJhc2VkIFhNUFAgaW5zdGFudCBtZXNzYWdpbmcgY2xpZW50KQogKiBodHRwOi8vY29udmVyc2Vqcy5vcmcKICoKICogQ29weXJpZ2h0IChjKSAyMDEyLCBKYW4tQ2FyZWwgQnJhbmQgPGpjQG9wa29kZS5jb20+CiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBNb3ppbGxhIFB1YmxpYyBMaWNlbnNlIChNUEwpCiAqLwoKLy8gQU1EL2dsb2JhbCByZWdpc3RyYXRpb25zCihmdW5jdGlvbiAocm9vdCwgZmFjdG9yeSkgewogICAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkgewogICAgICAgIGRlZmluZSgiY29udmVyc2UiLAogICAgICAgICAgICAgIFsiY29udmVyc2UtZGVwZW5kZW5jaWVzIiwgImNvbnZlcnNlLXRlbXBsYXRlcyJdLAogICAgICAgICAgICBmdW5jdGlvbiAoZGVwZW5kZW5jaWVzLCB0ZW1wbGF0ZXMpIHsKICAgICAgICAgICAgICAgIHZhciBvdHIgPSBkZXBlbmRlbmNpZXMub3RyOwogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBvdHIgIT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkoCiAgICAgICAgICAgICAgICAgICAgICAgIGRlcGVuZGVuY2llcy5qUXVlcnksCiAgICAgICAgICAgICAgICAgICAgICAgIF8sCiAgICAgICAgICAgICAgICAgICAgICAgIG90ci5PVFIsCiAgICAgICAgICAgICAgICAgICAgICAgIG90ci5EU0EsCiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlcywKICAgICAgICAgICAgICAgICAgICAgICAgZGVwZW5kZW5jaWVzLm1vbWVudCwKICAgICAgICAgICAgICAgICAgICAgICAgZGVwZW5kZW5jaWVzLnV0aWxzCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkoCiAgICAgICAgICAgICAgICAgICAgICAgIGRlcGVuZGVuY2llcy5qUXVlcnksCiAgICAgICAgICAgICAgICAgICAgICAgIF8sCiAgICAgICAgICAgICAgICAgICAgICAgIHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgICAgICAgdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZXMsCiAgICAgICAgICAgICAgICAgICAgICAgIGRlcGVuZGVuY2llcy5tb21lbnQsCiAgICAgICAgICAgICAgICAgICAgICAgIGRlcGVuZGVuY2llcy51dGlscwogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICApOwogICAgfSBlbHNlIHsKICAgICAgICByb290LmNvbnZlcnNlID0gZmFjdG9yeShqUXVlcnksIF8sIE9UUiwgRFNBLCBKU1QsIG1vbWVudCwgdXRpbHMpOwogICAgfQp9KHRoaXMsIGZ1bmN0aW9uICgkLCBfLCBPVFIsIERTQSwgdGVtcGxhdGVzLCBtb21lbnQsIHV0aWxzKSB7CiAgICAvLyAKICAgIC8vIENhbm5vdCB1c2UgdGhpcyBkdWUgdG8gU2FmYXJpIGJ1Zy4KICAgIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vamNicmFuZC9jb252ZXJzZS5qcy9pc3N1ZXMvMTk2CiAgICBpZiAodHlwZW9mIGNvbnNvbGUgPT09ICJ1bmRlZmluZWQiIHx8IHR5cGVvZiBjb25zb2xlLmxvZyA9PT0gInVuZGVmaW5lZCIpIHsKICAgICAgICBjb25zb2xlID0geyBsb2c6IGZ1bmN0aW9uICgpIHt9LCBlcnJvcjogZnVuY3Rpb24gKCkge30gfTsKICAgIH0KCiAgICAvLyBDb25maWd1cmF0aW9uIG9mIHVuZGVyc2NvcmUgdGVtcGxhdGVzICh0aGlzIGNvbmZpZyBpcyBkaXN0aWN0IHRvIHRoZQogICAgLy8gY29uZmlnIG9mIHJlcXVpcmVqcy10cGwgaW4gbWFpbi5qcykuIFRoaXMgb25lIGlzIGZvciBub3JtYWwgaW5saW5lCiAgICAvLyB0ZW1wbGF0ZXMuCiAgICAvLyBVc2UgTXVzdGFjaGUgc3R5bGUgc3ludGF4IGZvciB2YXJpYWJsZSBpbnRlcnBvbGF0aW9uCiAgICBfLnRlbXBsYXRlU2V0dGluZ3MgPSB7CiAgICAgICAgZXZhbHVhdGUgOiAvXHtcWyhbXHNcU10rPylcXVx9L2csCiAgICAgICAgaW50ZXJwb2xhdGUgOiAvXHtceyhbXHNcU10rPylcfVx9L2cKICAgIH07CgogICAgdmFyIGNvbnRhaW5zID0gZnVuY3Rpb24gKGF0dHIsIHF1ZXJ5KSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgIGlmICh0eXBlb2YgYXR0ciA9PT0gJ29iamVjdCcpIHsKICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgXy5lYWNoKGF0dHIsIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZSB8fCBpdGVtLmdldChhKS50b0xvd2VyQ2FzZSgpLmluZGV4T2YocXVlcnkudG9Mb3dlckNhc2UoKSkgIT09IC0xOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGF0dHIgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gaXRlbS5nZXQoYXR0cikudG9Mb3dlckNhc2UoKS5pbmRleE9mKHF1ZXJ5LnRvTG93ZXJDYXNlKCkpICE9PSAtMTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignV3JvbmcgYXR0cmlidXRlIHR5cGUuIE11c3QgYmUgc3RyaW5nIG9yIGFycmF5LicpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgIH07CiAgICBjb250YWlucy5ub3QgPSBmdW5jdGlvbiAoYXR0ciwgcXVlcnkpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgcmV0dXJuICEoY29udGFpbnMoYXR0ciwgcXVlcnkpKGl0ZW0pKTsKICAgICAgICB9OwogICAgfTsKCiAgICAvLyBYWFg6IHRoZXNlIGNhbiBwZXJoYXBzIGJlIG1vdmVkIHRvIHNyYy9wb2x5ZmlsbHMuanMKICAgIFN0cmluZy5wcm90b3R5cGUuc3BsaXRPbmNlID0gZnVuY3Rpb24gKGRlbGltaXRlcikgewogICAgICAgIHZhciBjb21wb25lbnRzID0gdGhpcy5zcGxpdChkZWxpbWl0ZXIpOwogICAgICAgIHJldHVybiBbY29tcG9uZW50cy5zaGlmdCgpLCBjb21wb25lbnRzLmpvaW4oZGVsaW1pdGVyKV07CiAgICB9OwoKICAgICQuZm4uYWRkRW1vdGljb25zID0gZnVuY3Rpb24gKCkgewogICAgICAgIGlmIChjb252ZXJzZS52aXNpYmxlX3Rvb2xiYXJfYnV0dG9ucy5lbW90aWNvbnMpIHsKICAgICAgICAgICAgaWYgKHRoaXMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgdGhpcy5lYWNoKGZ1bmN0aW9uIChpLCBvYmopIHsKICAgICAgICAgICAgICAgICAgICB2YXIgdGV4dCA9ICQob2JqKS5odG1sKCk7CiAgICAgICAgICAgICAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZSgvJmd0OzpcKS9nLCAnPHNwYW4gY2xhc3M9ImVtb3RpY29uIGljb24tZXZpbCI+PC9zcGFuPicpOwogICAgICAgICAgICAgICAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoLzpcKS9nLCAnPHNwYW4gY2xhc3M9ImVtb3RpY29uIGljb24tc21pbGV5Ij48L3NwYW4+Jyk7CiAgICAgICAgICAgICAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZSgvOlwtXCkvZywgJzxzcGFuIGNsYXNzPSJlbW90aWNvbiBpY29uLXNtaWxleSI+PC9zcGFuPicpOwogICAgICAgICAgICAgICAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoLztcKS9nLCAnPHNwYW4gY2xhc3M9ImVtb3RpY29uIGljb24td2luayI+PC9zcGFuPicpOwogICAgICAgICAgICAgICAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoLztcLVwpL2csICc8c3BhbiBjbGFzcz0iZW1vdGljb24gaWNvbi13aW5rIj48L3NwYW4+Jyk7CiAgICAgICAgICAgICAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZSgvOkQvZywgJzxzcGFuIGNsYXNzPSJlbW90aWNvbiBpY29uLWdyaW4iPjwvc3Bhbj4nKTsKICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC86XC1EL2csICc8c3BhbiBjbGFzcz0iZW1vdGljb24gaWNvbi1ncmluIj48L3NwYW4+Jyk7CiAgICAgICAgICAgICAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZSgvOlAvZywgJzxzcGFuIGNsYXNzPSJlbW90aWNvbiBpY29uLXRvbmd1ZSI+PC9zcGFuPicpOwogICAgICAgICAgICAgICAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoLzpcLVAvZywgJzxzcGFuIGNsYXNzPSJlbW90aWNvbiBpY29uLXRvbmd1ZSI+PC9zcGFuPicpOwogICAgICAgICAgICAgICAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoLzpwL2csICc8c3BhbiBjbGFzcz0iZW1vdGljb24gaWNvbi10b25ndWUiPjwvc3Bhbj4nKTsKICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC86XC1wL2csICc8c3BhbiBjbGFzcz0iZW1vdGljb24gaWNvbi10b25ndWUiPjwvc3Bhbj4nKTsKICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC84XCkvZywgJzxzcGFuIGNsYXNzPSJlbW90aWNvbiBpY29uLWNvb2wiPjwvc3Bhbj4nKTsKICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC86Uy9nLCAnPHNwYW4gY2xhc3M9ImVtb3RpY29uIGljb24tY29uZnVzZWQiPjwvc3Bhbj4nKTsKICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC86XFwvZywgJzxzcGFuIGNsYXNzPSJlbW90aWNvbiBpY29uLXdvbmRlcmluZyI+PC9zcGFuPicpOwogICAgICAgICAgICAgICAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoLzpcLyAvZywgJzxzcGFuIGNsYXNzPSJlbW90aWNvbiBpY29uLXdvbmRlcmluZyI+PC9zcGFuPicpOwogICAgICAgICAgICAgICAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoLyZndDs6XCgvZywgJzxzcGFuIGNsYXNzPSJlbW90aWNvbiBpY29uLWFuZ3J5Ij48L3NwYW4+Jyk7CiAgICAgICAgICAgICAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZSgvOlwoL2csICc8c3BhbiBjbGFzcz0iZW1vdGljb24gaWNvbi1zYWQiPjwvc3Bhbj4nKTsKICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC86XC1cKC9nLCAnPHNwYW4gY2xhc3M9ImVtb3RpY29uIGljb24tc2FkIj48L3NwYW4+Jyk7CiAgICAgICAgICAgICAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZSgvOk8vZywgJzxzcGFuIGNsYXNzPSJlbW90aWNvbiBpY29uLXNob2NrZWQiPjwvc3Bhbj4nKTsKICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC86XC1PL2csICc8c3BhbiBjbGFzcz0iZW1vdGljb24gaWNvbi1zaG9ja2VkIj48L3NwYW4+Jyk7CiAgICAgICAgICAgICAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZSgvXD1cLU8vZywgJzxzcGFuIGNsYXNzPSJlbW90aWNvbiBpY29uLXNob2NrZWQiPjwvc3Bhbj4nKTsKICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC9cKFxeLlxeXCliL2csICc8c3BhbiBjbGFzcz0iZW1vdGljb24gaWNvbi10aHVtYnMtdXAiPjwvc3Bhbj4nKTsKICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC8mbHQ7My9nLCAnPHNwYW4gY2xhc3M9ImVtb3RpY29uIGljb24taGVhcnQiPjwvc3Bhbj4nKTsKICAgICAgICAgICAgICAgICAgICAkKG9iaikuaHRtbCh0ZXh0KTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzOwogICAgfTsKCiAgICB2YXIgcGxheU5vdGlmaWNhdGlvbiA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgYXVkaW87CiAgICAgICAgaWYgKGNvbnZlcnNlLnBsYXlfc291bmRzICYmIHR5cGVvZiBBdWRpbyAhPT0gInVuZGVmaW5lZCIpewogICAgICAgICAgICBhdWRpbyA9IG5ldyBBdWRpbygic291bmRzL21zZ19yZWNlaXZlZC5vZ2ciKTsKICAgICAgICAgICAgaWYgKGF1ZGlvLmNhblBsYXlUeXBlKCcvYXVkaW8vb2dnJykpIHsKICAgICAgICAgICAgICAgIGF1ZGlvLnBsYXkoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGF1ZGlvID0gbmV3IEF1ZGlvKCIvc291bmRzL21zZ19yZWNlaXZlZC5tcDMiKTsKICAgICAgICAgICAgICAgIGF1ZGlvLnBsYXkoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CgogICAgdmFyIGNvbnZlcnNlID0gewogICAgICAgIHBsdWdpbnM6IHt9LAogICAgICAgIHRlbXBsYXRlczogdGVtcGxhdGVzLAogICAgICAgIGVtaXQ6IGZ1bmN0aW9uIChldnQsIGRhdGEpIHsKICAgICAgICAgICAgJCh0aGlzKS50cmlnZ2VyKGV2dCwgZGF0YSk7CiAgICAgICAgfSwKICAgICAgICBvbmNlOiBmdW5jdGlvbiAoZXZ0LCBoYW5kbGVyKSB7CiAgICAgICAgICAgICQodGhpcykub25lKGV2dCwgaGFuZGxlcik7CiAgICAgICAgfSwKICAgICAgICBvbjogZnVuY3Rpb24gKGV2dCwgaGFuZGxlcikgewogICAgICAgICAgICAkKHRoaXMpLmJpbmQoZXZ0LCBoYW5kbGVyKTsKICAgICAgICB9LAogICAgICAgIG9mZjogZnVuY3Rpb24gKGV2dCwgaGFuZGxlcikgewogICAgICAgICAgICAkKHRoaXMpLnVuYmluZChldnQsIGhhbmRsZXIpOwogICAgICAgIH0sCiAgICAgICAgcmVmcmVzaFdlYmtpdDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAvKiBUaGlzIHdvcmtzIGFyb3VuZCBhIHdlYmtpdCBidWcuIFJlZnJlc2ggdGhlIGJyb3dzZXIncyB2aWV3cG9ydCwKICAgICAgICAgICAgKiBvdGhlcndpc2UgY2hhdGJveGVzIGFyZSBub3QgbW92ZWQgYWxvbmcgd2hlbiBvbmUgaXMgY2xvc2VkLgogICAgICAgICAgICAqLwogICAgICAgICAgICBpZiAoJC5icm93c2VyLndlYmtpdCkgewogICAgICAgICAgICAgICAgdmFyIGNvbnZlcnNlanMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29udmVyc2VqcycpOwogICAgICAgICAgICAgICAgY29udmVyc2Vqcy5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICAgICAgY29udmVyc2Vqcy5vZmZzZXRIZWlnaHQgPSBjb252ZXJzZWpzLm9mZnNldEhlaWdodDsKICAgICAgICAgICAgICAgIGNvbnZlcnNlanMuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwoKICAgIGNvbnZlcnNlLmluaXRpYWxpemUgPSBmdW5jdGlvbiAoc2V0dGluZ3MsIGNhbGxiYWNrKSB7CiAgICAgICAgdmFyIGNvbnZlcnNlID0gdGhpczsKCiAgICAgICAgLy8gQ29uc3RhbnRzCiAgICAgICAgLy8gLS0tLS0tLS0tCiAgICAgICAgdmFyIFVORU5DUllQVEVEID0gMDsKICAgICAgICB2YXIgVU5WRVJJRklFRD0gMTsKICAgICAgICB2YXIgVkVSSUZJRUQ9IDI7CiAgICAgICAgdmFyIEZJTklTSEVEID0gMzsKICAgICAgICB2YXIgS0VZID0gewogICAgICAgICAgICBFTlRFUjogMTMKICAgICAgICB9OwogICAgICAgIHZhciBTVEFUVVNfV0VJR0hUUyA9IHsKICAgICAgICAgICAgJ29mZmxpbmUnOiAgICAgIDYsCiAgICAgICAgICAgICd1bmF2YWlsYWJsZSc6ICA1LAogICAgICAgICAgICAneGEnOiAgICAgICAgICAgNCwKICAgICAgICAgICAgJ2F3YXknOiAgICAgICAgIDMsCiAgICAgICAgICAgICdkbmQnOiAgICAgICAgICAyLAogICAgICAgICAgICAnb25saW5lJzogICAgICAgMQogICAgICAgIH07CgogICAgICAgIHZhciBJTkFDVElWRSA9ICdpbmFjdGl2ZSc7CiAgICAgICAgdmFyIEFDVElWRSA9ICdhY3RpdmUnOwogICAgICAgIHZhciBDT01QT1NJTkcgPSAnY29tcG9zaW5nJzsKICAgICAgICB2YXIgUEFVU0VEID0gJ3BhdXNlZCc7CiAgICAgICAgdmFyIEdPTkUgPSAnZ29uZSc7CgogICAgICAgIHZhciBIQVNfQ1NQUk5HID0gKCh0eXBlb2YgY3J5cHRvICE9PSAndW5kZWZpbmVkJykgJiYKICAgICAgICAgICAgKCh0eXBlb2YgY3J5cHRvLnJhbmRvbUJ5dGVzID09PSAnZnVuY3Rpb24nKSB8fAogICAgICAgICAgICAgICAgKHR5cGVvZiBjcnlwdG8uZ2V0UmFuZG9tVmFsdWVzID09PSAnZnVuY3Rpb24nKQogICAgICAgICkpOwogICAgICAgIHZhciBIQVNfQ1JZUFRPID0gSEFTX0NTUFJORyAmJiAoCiAgICAgICAgICAgICh0eXBlb2YgQ3J5cHRvSlMgIT09ICJ1bmRlZmluZWQiKSAmJgogICAgICAgICAgICAodHlwZW9mIE9UUiAhPT0gInVuZGVmaW5lZCIpICYmCiAgICAgICAgICAgICh0eXBlb2YgRFNBICE9PSAidW5kZWZpbmVkIikKICAgICAgICApOwoKICAgICAgICB2YXIgT1BFTkVEID0gJ29wZW5lZCc7CiAgICAgICAgdmFyIENMT1NFRCA9ICdjbG9zZWQnOwoKICAgICAgICAvLyBEZWZhdWx0IGNvbmZpZ3VyYXRpb24gdmFsdWVzCiAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICAgIHRoaXMuYWxsb3dfY29udGFjdF9yZXF1ZXN0cyA9IHRydWU7CiAgICAgICAgdGhpcy5hbGxvd19kcmFncmVzaXplID0gdHJ1ZTsKICAgICAgICB0aGlzLmFsbG93X2xvZ291dCA9IHRydWU7CiAgICAgICAgdGhpcy5hbGxvd19tdWMgPSB0cnVlOwogICAgICAgIHRoaXMuYWxsb3dfb3RyID0gdHJ1ZTsKICAgICAgICB0aGlzLmFuaW1hdGUgPSB0cnVlOwogICAgICAgIHRoaXMuYXV0b19saXN0X3Jvb21zID0gZmFsc2U7CiAgICAgICAgdGhpcy5hdXRvX3JlY29ubmVjdCA9IGZhbHNlOwogICAgICAgIHRoaXMuYXV0b19zdWJzY3JpYmUgPSBmYWxzZTsKICAgICAgICB0aGlzLmJvc2hfc2VydmljZV91cmwgPSB1bmRlZmluZWQ7IC8vIFRoZSBCT1NIIGNvbm5lY3Rpb24gbWFuYWdlciBVUkwuCiAgICAgICAgdGhpcy5jYWNoZV9vdHJfa2V5ID0gZmFsc2U7CiAgICAgICAgdGhpcy5kZWJ1ZyA9IGZhbHNlOwogICAgICAgIHRoaXMuZGVmYXVsdF9ib3hfaGVpZ2h0ID0gMzI0OyAvLyBUaGUgZGVmYXVsdCBoZWlnaHQsIGluIHBpeGVscywgZm9yIHRoZSBjb250cm9sIGJveCwgY2hhdCBib3hlcyBhbmQgY2hhdHJvb21zLgogICAgICAgIHRoaXMuZXhwb3NlX3JpZF9hbmRfc2lkID0gZmFsc2U7CiAgICAgICAgdGhpcy5mb3J3YXJkX21lc3NhZ2VzID0gZmFsc2U7CiAgICAgICAgdGhpcy5oaWRlX211Y19zZXJ2ZXIgPSBmYWxzZTsKICAgICAgICB0aGlzLmkxOG4gPSBsb2NhbGVzLmVuOwogICAgICAgIHRoaXMua2VlcGFsaXZlID0gZmFsc2U7CiAgICAgICAgdGhpcy5tZXNzYWdlX2NhcmJvbnMgPSBmYWxzZTsKICAgICAgICB0aGlzLm5vX3RyaW1taW5nID0gZmFsc2U7IC8vIFNldCB0byB0cnVlIGZvciBwaGFudG9tanMgdGVzdHMgKHdoZXJlIGJyb3dzZXIgYXBwYXJlbnRseSBoYXMgbm8gd2lkdGgpCiAgICAgICAgdGhpcy5wbGF5X3NvdW5kcyA9IGZhbHNlOwogICAgICAgIHRoaXMucHJlYmluZCA9IGZhbHNlOwogICAgICAgIHRoaXMucm9zdGVyX2dyb3VwcyA9IGZhbHNlOwogICAgICAgIHRoaXMuc2hvd19jb250cm9sYm94X2J5X2RlZmF1bHQgPSBmYWxzZTsKICAgICAgICB0aGlzLnNob3dfb25seV9vbmxpbmVfdXNlcnMgPSBmYWxzZTsKICAgICAgICB0aGlzLnNob3dfdG9vbGJhciA9IHRydWU7CiAgICAgICAgdGhpcy5zdG9yYWdlID0gJ3Nlc3Npb24nOwogICAgICAgIHRoaXMudXNlX290cl9ieV9kZWZhdWx0ID0gZmFsc2U7CiAgICAgICAgdGhpcy51c2VfdmNhcmRzID0gdHJ1ZTsKICAgICAgICB0aGlzLnZpc2libGVfdG9vbGJhcl9idXR0b25zID0gewogICAgICAgICAgICAnZW1vdGljb25zJzogdHJ1ZSwKICAgICAgICAgICAgJ2NhbGwnOiBmYWxzZSwKICAgICAgICAgICAgJ2NsZWFyJzogdHJ1ZSwKICAgICAgICAgICAgJ3RvZ2dsZV9wYXJ0aWNpcGFudHMnOiB0cnVlCiAgICAgICAgfTsKICAgICAgICB0aGlzLnhocl9jdXN0b21fc3RhdHVzID0gZmFsc2U7CiAgICAgICAgdGhpcy54aHJfY3VzdG9tX3N0YXR1c191cmwgPSAnJzsKICAgICAgICB0aGlzLnhocl91c2VyX3NlYXJjaCA9IGZhbHNlOwogICAgICAgIHRoaXMueGhyX3VzZXJfc2VhcmNoX3VybCA9ICcnOwoKICAgICAgICAvLyBBbGxvdyBvbmx5IHdoaXRlbGlzdGVkIGNvbmZpZ3VyYXRpb24gYXR0cmlidXRlcyB0byBiZSBvdmVyd3JpdHRlbgogICAgICAgIF8uZXh0ZW5kKHRoaXMsIF8ucGljayhzZXR0aW5ncywgWwogICAgICAgICAgICAnYWxsb3dfY29udGFjdF9yZXF1ZXN0cycsCiAgICAgICAgICAgICdhbGxvd19kcmFncmVzaXplJywKICAgICAgICAgICAgJ2FsbG93X2xvZ291dCcsCiAgICAgICAgICAgICdhbGxvd19tdWMnLAogICAgICAgICAgICAnYWxsb3dfb3RyJywKICAgICAgICAgICAgJ2FuaW1hdGUnLAogICAgICAgICAgICAnYXV0b19saXN0X3Jvb21zJywKICAgICAgICAgICAgJ2F1dG9fcmVjb25uZWN0JywKICAgICAgICAgICAgJ2F1dG9fc3Vic2NyaWJlJywKICAgICAgICAgICAgJ2Jvc2hfc2VydmljZV91cmwnLAogICAgICAgICAgICAnY2FjaGVfb3RyX2tleScsCiAgICAgICAgICAgICdjb25uZWN0aW9uJywKICAgICAgICAgICAgJ2RlYnVnJywKICAgICAgICAgICAgJ2RlZmF1bHRfYm94X2hlaWdodCcsCiAgICAgICAgICAgICdrZWVwYWxpdmUnLAogICAgICAgICAgICAnbWVzc2FnZV9jYXJib25zJywKICAgICAgICAgICAgJ2V4cG9zZV9yaWRfYW5kX3NpZCcsCiAgICAgICAgICAgICdmb3J3YXJkX21lc3NhZ2VzJywKICAgICAgICAgICAgJ2Z1bGxuYW1lJywKICAgICAgICAgICAgJ2hpZGVfbXVjX3NlcnZlcicsCiAgICAgICAgICAgICdpMThuJywKICAgICAgICAgICAgJ2ppZCcsCiAgICAgICAgICAgICdub190cmltbWluZycsCiAgICAgICAgICAgICdwbGF5X3NvdW5kcycsCiAgICAgICAgICAgICdwcmViaW5kJywKICAgICAgICAgICAgJ3JpZCcsCiAgICAgICAgICAgICdyb3N0ZXJfZ3JvdXBzJywKICAgICAgICAgICAgJ3Nob3dfY29udHJvbGJveF9ieV9kZWZhdWx0JywKICAgICAgICAgICAgJ3Nob3dfb25seV9vbmxpbmVfdXNlcnMnLAogICAgICAgICAgICAnc2hvd190b29sYmFyJywKICAgICAgICAgICAgJ3NpZCcsCiAgICAgICAgICAgICdzdG9yYWdlJywKICAgICAgICAgICAgJ3VzZV9vdHJfYnlfZGVmYXVsdCcsCiAgICAgICAgICAgICd1c2VfdmNhcmRzJywKICAgICAgICAgICAgJ3hocl9jdXN0b21fc3RhdHVzJywKICAgICAgICAgICAgJ3hocl9jdXN0b21fc3RhdHVzX3VybCcsCiAgICAgICAgICAgICd4aHJfdXNlcl9zZWFyY2gnLAogICAgICAgICAgICAneGhyX3VzZXJfc2VhcmNoX3VybCcKICAgICAgICBdKSk7CiAgICAgICAgaWYgKHNldHRpbmdzLnZpc2libGVfdG9vbGJhcl9idXR0b25zKSB7CiAgICAgICAgICAgIF8uZXh0ZW5kKAogICAgICAgICAgICAgICAgdGhpcy52aXNpYmxlX3Rvb2xiYXJfYnV0dG9ucywKICAgICAgICAgICAgICAgIF8ucGljayhzZXR0aW5ncy52aXNpYmxlX3Rvb2xiYXJfYnV0dG9ucywgWwogICAgICAgICAgICAgICAgICAgICdlbW90aWNvbnMnLCAnY2FsbCcsICdjbGVhcicsICd0b2dnbGVfcGFydGljaXBhbnRzJwogICAgICAgICAgICAgICAgXQogICAgICAgICAgICApKTsKICAgICAgICB9CiAgICAgICAgJC5meC5vZmYgPSAhdGhpcy5hbmltYXRlOwoKICAgICAgICAvLyBPbmx5IGFsbG93IE9UUiBpZiB3ZSBoYXZlIHRoZSBjYXBhYmlsaXR5CiAgICAgICAgdGhpcy5hbGxvd19vdHIgPSB0aGlzLmFsbG93X290ciAmJiBIQVNfQ1JZUFRPOwoKICAgICAgICAvLyBPbmx5IHVzZSBPVFIgYnkgZGVmYXVsdCBpZiBhbGxvdyBPVFIgaXMgZW5hYmxlZCB0byBiZWdpbiB3aXRoCiAgICAgICAgdGhpcy51c2Vfb3RyX2J5X2RlZmF1bHQgPSB0aGlzLnVzZV9vdHJfYnlfZGVmYXVsdCAmJiB0aGlzLmFsbG93X290cjsKCiAgICAgICAgLy8gVHJhbnNsYXRpb24gbWFjaGluZXJ5CiAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgICAgdmFyIF9fID0gJC5wcm94eSh1dGlscy5fXywgdGhpcyk7CiAgICAgICAgdmFyIF9fXyA9IHV0aWxzLl9fXzsKICAgICAgICAvLyBUcmFuc2xhdGlvbiBhd2FyZSBjb25zdGFudHMKICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAgICB2YXIgT1RSX0NMQVNTX01BUFBJTkcgPSB7fTsKICAgICAgICBPVFJfQ0xBU1NfTUFQUElOR1tVTkVOQ1JZUFRFRF0gPSAndW5lbmNyeXB0ZWQnOwogICAgICAgIE9UUl9DTEFTU19NQVBQSU5HW1VOVkVSSUZJRURdID0gJ3VudmVyaWZpZWQnOwogICAgICAgIE9UUl9DTEFTU19NQVBQSU5HW1ZFUklGSUVEXSA9ICd2ZXJpZmllZCc7CiAgICAgICAgT1RSX0NMQVNTX01BUFBJTkdbRklOSVNIRURdID0gJ2ZpbmlzaGVkJzsKCiAgICAgICAgdmFyIE9UUl9UUkFOU0xBVEVEX01BUFBJTkcgID0ge307CiAgICAgICAgT1RSX1RSQU5TTEFURURfTUFQUElOR1tVTkVOQ1JZUFRFRF0gPSBfXygndW5lbmNyeXB0ZWQnKTsKICAgICAgICBPVFJfVFJBTlNMQVRFRF9NQVBQSU5HW1VOVkVSSUZJRURdID0gX18oJ3VudmVyaWZpZWQnKTsKICAgICAgICBPVFJfVFJBTlNMQVRFRF9NQVBQSU5HW1ZFUklGSUVEXSA9IF9fKCd2ZXJpZmllZCcpOwogICAgICAgIE9UUl9UUkFOU0xBVEVEX01BUFBJTkdbRklOSVNIRURdID0gX18oJ2ZpbmlzaGVkJyk7CgogICAgICAgIHZhciBTVEFUVVNFUyA9IHsKICAgICAgICAgICAgJ2RuZCc6IF9fKCdUaGlzIGNvbnRhY3QgaXMgYnVzeScpLAogICAgICAgICAgICAnb25saW5lJzogX18oJ1RoaXMgY29udGFjdCBpcyBvbmxpbmUnKSwKICAgICAgICAgICAgJ29mZmxpbmUnOiBfXygnVGhpcyBjb250YWN0IGlzIG9mZmxpbmUnKSwKICAgICAgICAgICAgJ3VuYXZhaWxhYmxlJzogX18oJ1RoaXMgY29udGFjdCBpcyB1bmF2YWlsYWJsZScpLAogICAgICAgICAgICAneGEnOiBfXygnVGhpcyBjb250YWN0IGlzIGF3YXkgZm9yIGFuIGV4dGVuZGVkIHBlcmlvZCcpLAogICAgICAgICAgICAnYXdheSc6IF9fKCdUaGlzIGNvbnRhY3QgaXMgYXdheScpCiAgICAgICAgfTsKICAgICAgICB2YXIgREVTQ19HUk9VUF9UT0dHTEUgPSBfXygnQ2xpY2sgdG8gaGlkZSB0aGVzZSBjb250YWN0cycpOwoKICAgICAgICB2YXIgSEVBREVSX0NVUlJFTlRfQ09OVEFDVFMgPSAgX18oJ015IGNvbnRhY3RzJyk7CiAgICAgICAgdmFyIEhFQURFUl9QRU5ESU5HX0NPTlRBQ1RTID0gX18oJ1BlbmRpbmcgY29udGFjdHMnKTsKICAgICAgICB2YXIgSEVBREVSX1JFUVVFU1RJTkdfQ09OVEFDVFMgPSBfXygnQ29udGFjdCByZXF1ZXN0cycpOwogICAgICAgIHZhciBIRUFERVJfVU5HUk9VUEVEID0gX18oJ1VuZ3JvdXBlZCcpOwoKICAgICAgICB2YXIgTEFCRUxfQ09OVEFDVFMgPSBfXygnQ29udGFjdHMnKTsKICAgICAgICB2YXIgTEFCRUxfR1JPVVBTID0gX18oJ0dyb3VwcycpOwoKICAgICAgICB2YXIgSEVBREVSX1dFSUdIVFMgPSB7fTsKICAgICAgICBIRUFERVJfV0VJR0hUU1tIRUFERVJfQ1VSUkVOVF9DT05UQUNUU10gICAgPSAwOwogICAgICAgIEhFQURFUl9XRUlHSFRTW0hFQURFUl9VTkdST1VQRURdICAgICAgICAgICA9IDE7CiAgICAgICAgSEVBREVSX1dFSUdIVFNbSEVBREVSX1JFUVVFU1RJTkdfQ09OVEFDVFNdID0gMjsKICAgICAgICBIRUFERVJfV0VJR0hUU1tIRUFERVJfUEVORElOR19DT05UQUNUU10gICAgPSAzOwoKICAgICAgICAvLyBNb2R1bGUtbGV2ZWwgdmFyaWFibGVzCiAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICAgIHRoaXMuY2FsbGJhY2sgPSBjYWxsYmFjayB8fCBmdW5jdGlvbiAoKSB7fTsKICAgICAgICB0aGlzLmluaXRpYWxfcHJlc2VuY2Vfc2VudCA9IDA7CiAgICAgICAgdGhpcy5tc2dfY291bnRlciA9IDA7CgogICAgICAgIC8vIE1vZHVsZS1sZXZlbCBmdW5jdGlvbnMKICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgICAgdGhpcy5naXZlRmVlZGJhY2sgPSBmdW5jdGlvbiAobWVzc2FnZSwga2xhc3MpIHsKICAgICAgICAgICAgJCgnLmNvbm4tZmVlZGJhY2snKS5hdHRyKCdjbGFzcycsICdjb25uLWZlZWRiYWNrJykudGV4dChtZXNzYWdlKTsKICAgICAgICAgICAgaWYgKGtsYXNzKSB7CiAgICAgICAgICAgICAgICAkKCcuY29ubi1mZWVkYmFjaycpLmFkZENsYXNzKGtsYXNzKTsKICAgICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIHRoaXMubG9nID0gZnVuY3Rpb24gKHR4dCwgbGV2ZWwpIHsKICAgICAgICAgICAgaWYgKHRoaXMuZGVidWcpIHsKICAgICAgICAgICAgICAgIGlmIChsZXZlbCA9PSAnZXJyb3InKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0VSUk9SOiAnK3R4dCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHR4dCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICB0aGlzLmdldFZDYXJkID0gZnVuY3Rpb24gKGppZCwgY2FsbGJhY2ssIGVycmJhY2spIHsKICAgICAgICAgICAgaWYgKCF0aGlzLnVzZV92Y2FyZHMpIHsKICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykgewogICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGppZCwgamlkKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb252ZXJzZS5jb25uZWN0aW9uLnZjYXJkLmdldCgKICAgICAgICAgICAgICAgICQucHJveHkoZnVuY3Rpb24gKGlxKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gU3VjY2Vzc2Z1bCBjYWxsYmFjawogICAgICAgICAgICAgICAgICAgIHZhciAkdmNhcmQgPSAkKGlxKS5maW5kKCd2Q2FyZCcpOwogICAgICAgICAgICAgICAgICAgIHZhciBmdWxsbmFtZSA9ICR2Y2FyZC5maW5kKCdGTicpLnRleHQoKSwKICAgICAgICAgICAgICAgICAgICAgICAgaW1nID0gJHZjYXJkLmZpbmQoJ0JJTlZBTCcpLnRleHQoKSwKICAgICAgICAgICAgICAgICAgICAgICAgaW1nX3R5cGUgPSAkdmNhcmQuZmluZCgnVFlQRScpLnRleHQoKSwKICAgICAgICAgICAgICAgICAgICAgICAgdXJsID0gJHZjYXJkLmZpbmQoJ1VSTCcpLnRleHQoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoamlkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb250YWN0ID0gY29udmVyc2Uucm9zdGVyLmdldChqaWQpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29udGFjdCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsbG5hbWUgPSBfLmlzRW1wdHkoZnVsbG5hbWUpPyBjb250YWN0LmdldCgnZnVsbG5hbWUnKSB8fCBqaWQ6IGZ1bGxuYW1lOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGFjdC5zYXZlKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZnVsbG5hbWUnOiBmdWxsbmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnaW1hZ2VfdHlwZSc6IGltZ190eXBlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdpbWFnZSc6IGltZywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAndXJsJzogdXJsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd2Y2FyZF91cGRhdGVkJzogbW9tZW50KCkuZm9ybWF0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykgewogICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhqaWQsIGZ1bGxuYW1lLCBpbWcsIGltZ190eXBlLCB1cmwpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sIHRoaXMpLAogICAgICAgICAgICAgICAgamlkLAogICAgICAgICAgICAgICAgZnVuY3Rpb24gKGlxKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gRXJyb3IgY2FsbGJhY2sKICAgICAgICAgICAgICAgICAgICB2YXIgY29udGFjdCA9IGNvbnZlcnNlLnJvc3Rlci5nZXQoamlkKTsKICAgICAgICAgICAgICAgICAgICBpZiAoY29udGFjdCkgewogICAgICAgICAgICAgICAgICAgICAgICBjb250YWN0LnNhdmUoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3ZjYXJkX3VwZGF0ZWQnOiBtb21lbnQoKS5mb3JtYXQoKQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKGVycmJhY2spIHsKICAgICAgICAgICAgICAgICAgICAgICAgZXJyYmFjayhqaWQsIGlxKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICk7CiAgICAgICAgfTsKCiAgICAgICAgdGhpcy5yZWNvbm5lY3QgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGNvbnZlcnNlLmdpdmVGZWVkYmFjayhfXygnUmVjb25uZWN0aW5nJyksICdlcnJvcicpOwogICAgICAgICAgICBjb252ZXJzZS5lbWl0KCdyZWNvbm5lY3QnKTsKICAgICAgICAgICAgaWYgKCFjb252ZXJzZS5wcmViaW5kKSB7CiAgICAgICAgICAgICAgICB0aGlzLmNvbm5lY3Rpb24uY29ubmVjdCgKICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbm5lY3Rpb24uamlkLAogICAgICAgICAgICAgICAgICAgIHRoaXMuY29ubmVjdGlvbi5wYXNzLAogICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChzdGF0dXMsIGNvbmRpdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS5vbkNvbm5lY3Qoc3RhdHVzLCBjb25kaXRpb24sIHRydWUpOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25uZWN0aW9uLndhaXQsCiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25uZWN0aW9uLmhvbGQsCiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25uZWN0aW9uLnJvdXRlCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgdGhpcy5yZW5kZXJMb2dpblBhbmVsID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICBjb252ZXJzZS5fdGVhckRvd24oKTsKICAgICAgICAgICAgdmFyIHZpZXcgPSBjb252ZXJzZS5jaGF0Ym94dmlld3MuZ2V0KCdjb250cm9sYm94Jyk7CiAgICAgICAgICAgIHZpZXcubW9kZWwuc2V0KHtjb25uZWN0ZWQ6ZmFsc2V9KTsKICAgICAgICAgICAgdmlldy5yZW5kZXJMb2dpblBhbmVsKCk7CiAgICAgICAgfTsKCiAgICAgICAgdGhpcy5vbkNvbm5lY3QgPSBmdW5jdGlvbiAoc3RhdHVzLCBjb25kaXRpb24sIHJlY29ubmVjdCkgewogICAgICAgICAgICB2YXIgJGJ1dHRvbiwgJGZvcm07CiAgICAgICAgICAgIGlmICgoc3RhdHVzID09PSBTdHJvcGhlLlN0YXR1cy5DT05ORUNURUQpIHx8CiAgICAgICAgICAgICAgICAoc3RhdHVzID09PSBTdHJvcGhlLlN0YXR1cy5BVFRBQ0hFRCkpIHsKICAgICAgICAgICAgICAgIGlmICgodHlwZW9mIHJlY29ubmVjdCAhPT0gJ3VuZGVmaW5lZCcpICYmIChyZWNvbm5lY3QpKSB7CiAgICAgICAgICAgICAgICAgICAgY29udmVyc2UubG9nKHN0YXR1cyA9PT0gU3Ryb3BoZS5TdGF0dXMuQ09OTkVDVEVEID8gJ1JlY29ubmVjdGVkJyA6ICdSZWF0dGFjaGVkJyk7CiAgICAgICAgICAgICAgICAgICAgY29udmVyc2Uub25SZWNvbm5lY3RlZCgpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS5sb2coc3RhdHVzID09PSBTdHJvcGhlLlN0YXR1cy5DT05ORUNURUQgPyAnQ29ubmVjdGVkJyA6ICdBdHRhY2hlZCcpOwogICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLm9uQ29ubmVjdGVkKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAoc3RhdHVzID09PSBTdHJvcGhlLlN0YXR1cy5ESVNDT05ORUNURUQpIHsKICAgICAgICAgICAgICAgIGNvbnZlcnNlLmdpdmVGZWVkYmFjayhfXygnRGlzY29ubmVjdGVkJyksICdlcnJvcicpOwogICAgICAgICAgICAgICAgaWYgKGNvbnZlcnNlLmF1dG9fcmVjb25uZWN0KSB7CiAgICAgICAgICAgICAgICAgICAgY29udmVyc2UucmVjb25uZWN0KCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLnJlbmRlckxvZ2luUGFuZWwoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChzdGF0dXMgPT09IFN0cm9waGUuU3RhdHVzLkVycm9yKSB7CiAgICAgICAgICAgICAgICBjb252ZXJzZS5yZW5kZXJMb2dpblBhbmVsKCk7CiAgICAgICAgICAgICAgICBjb252ZXJzZS5naXZlRmVlZGJhY2soX18oJ0Vycm9yJyksICdlcnJvcicpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHN0YXR1cyA9PT0gU3Ryb3BoZS5TdGF0dXMuQ09OTkVDVElORykgewogICAgICAgICAgICAgICAgY29udmVyc2UuZ2l2ZUZlZWRiYWNrKF9fKCdDb25uZWN0aW5nJykpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHN0YXR1cyA9PT0gU3Ryb3BoZS5TdGF0dXMuQ09OTkZBSUwpIHsKICAgICAgICAgICAgICAgIGNvbnZlcnNlLnJlbmRlckxvZ2luUGFuZWwoKTsKICAgICAgICAgICAgICAgIGNvbnZlcnNlLmdpdmVGZWVkYmFjayhfXygnQ29ubmVjdGlvbiBGYWlsZWQnKSwgJ2Vycm9yJyk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoc3RhdHVzID09PSBTdHJvcGhlLlN0YXR1cy5BVVRIRU5USUNBVElORykgewogICAgICAgICAgICAgICAgY29udmVyc2UuZ2l2ZUZlZWRiYWNrKF9fKCdBdXRoZW50aWNhdGluZycpKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChzdGF0dXMgPT09IFN0cm9waGUuU3RhdHVzLkFVVEhGQUlMKSB7CiAgICAgICAgICAgICAgICBjb252ZXJzZS5yZW5kZXJMb2dpblBhbmVsKCk7CiAgICAgICAgICAgICAgICBjb252ZXJzZS5naXZlRmVlZGJhY2soX18oJ0F1dGhlbnRpY2F0aW9uIEZhaWxlZCcpLCAnZXJyb3InKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChzdGF0dXMgPT09IFN0cm9waGUuU3RhdHVzLkRJU0NPTk5FQ1RJTkcpIHsKICAgICAgICAgICAgICAgIGlmICghY29udmVyc2UuY29ubmVjdGlvbi5jb25uZWN0ZWQpIHsKICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS5yZW5kZXJMb2dpblBhbmVsKCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLmdpdmVGZWVkYmFjayhfXygnRGlzY29ubmVjdGluZycpLCAnZXJyb3InKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIHRoaXMuYXBwbHlIZWlnaHRSZXNpc3RhbmNlID0gZnVuY3Rpb24gKGhlaWdodCkgewogICAgICAgICAgICAvKiBUaGlzIG1ldGhvZCBhcHBsaWVzIHNvbWUgcmVzaXN0YW5jZS9ncmF2aXR5IGFyb3VuZCB0aGUKICAgICAgICAgICAgICogImRlZmF1bHRfYm94X2hlaWdodCIuIElmICJoZWlnaHQiIGlzIGNsb3NlIGVub3VnaCB0bwogICAgICAgICAgICAgKiBkZWZhdWx0X2JveF9oZWlnaHQsIHRoZW4gdGhhdCBpcyByZXR1cm5lZCBpbnN0ZWFkLgogICAgICAgICAgICAgKi8KICAgICAgICAgICAgaWYgKHR5cGVvZiBoZWlnaHQgPT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gY29udmVyc2UuZGVmYXVsdF9ib3hfaGVpZ2h0OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciByZXNpc3RhbmNlID0gMTA7CiAgICAgICAgICAgIGlmICgoaGVpZ2h0ICE9PSBjb252ZXJzZS5kZWZhdWx0X2JveF9oZWlnaHQpICYmCiAgICAgICAgICAgICAgICAoTWF0aC5hYnMoaGVpZ2h0IC0gY29udmVyc2UuZGVmYXVsdF9ib3hfaGVpZ2h0KSA8IHJlc2lzdGFuY2UpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gY29udmVyc2UuZGVmYXVsdF9ib3hfaGVpZ2h0OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBoZWlnaHQ7CiAgICAgICAgfTsKCiAgICAgICAgdGhpcy51cGRhdGVNc2dDb3VudGVyID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICBpZiAodGhpcy5tc2dfY291bnRlciA+IDApIHsKICAgICAgICAgICAgICAgIGlmIChkb2N1bWVudC50aXRsZS5zZWFyY2goL15NZXNzYWdlcyBcKFxkK1wpIC8pID09IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQudGl0bGUgPSAiTWVzc2FnZXMgKCIgKyB0aGlzLm1zZ19jb3VudGVyICsgIikgIiArIGRvY3VtZW50LnRpdGxlOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC50aXRsZSA9IGRvY3VtZW50LnRpdGxlLnJlcGxhY2UoL15NZXNzYWdlcyBcKFxkK1wpIC8sICJNZXNzYWdlcyAoIiArIHRoaXMubXNnX2NvdW50ZXIgKyAiKSAiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHdpbmRvdy5ibHVyKCk7CiAgICAgICAgICAgICAgICB3aW5kb3cuZm9jdXMoKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChkb2N1bWVudC50aXRsZS5zZWFyY2goL15NZXNzYWdlcyBcKFxkK1wpIC8pICE9IC0xKSB7CiAgICAgICAgICAgICAgICBkb2N1bWVudC50aXRsZSA9IGRvY3VtZW50LnRpdGxlLnJlcGxhY2UoL15NZXNzYWdlcyBcKFxkK1wpIC8sICIiKTsKICAgICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIHRoaXMuaW5jcmVtZW50TXNnQ291bnRlciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdGhpcy5tc2dfY291bnRlciArPSAxOwogICAgICAgICAgICB0aGlzLnVwZGF0ZU1zZ0NvdW50ZXIoKTsKICAgICAgICB9OwoKICAgICAgICB0aGlzLmNsZWFyTXNnQ291bnRlciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdGhpcy5tc2dfY291bnRlciA9IDA7CiAgICAgICAgICAgIHRoaXMudXBkYXRlTXNnQ291bnRlcigpOwogICAgICAgIH07CgogICAgICAgIHRoaXMuaW5pdFN0YXR1cyA9IGZ1bmN0aW9uIChjYWxsYmFjaykgewogICAgICAgICAgICB0aGlzLnhtcHBzdGF0dXMgPSBuZXcgdGhpcy5YTVBQU3RhdHVzKCk7CiAgICAgICAgICAgIHZhciBpZCA9IGI2NF9zaGExKCdjb252ZXJzZS54bXBwc3RhdHVzLScrY29udmVyc2UuYmFyZV9qaWQpOwogICAgICAgICAgICB0aGlzLnhtcHBzdGF0dXMuaWQgPSBpZDsgLy8gQXBwZWFycyB0byBiZSBuZWNlc3NhcnkgZm9yIGJhY2tib25lLmJyb3dzZXJTdG9yYWdlCiAgICAgICAgICAgIHRoaXMueG1wcHN0YXR1cy5icm93c2VyU3RvcmFnZSA9IG5ldyBCYWNrYm9uZS5Ccm93c2VyU3RvcmFnZVtjb252ZXJzZS5zdG9yYWdlXShpZCk7CiAgICAgICAgICAgIHRoaXMueG1wcHN0YXR1cy5mZXRjaCh7c3VjY2VzczogY2FsbGJhY2ssIGVycm9yOiBjYWxsYmFja30pOwogICAgICAgIH07CgogICAgICAgIHRoaXMuaW5pdFNlc3Npb24gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHRoaXMuc2Vzc2lvbiA9IG5ldyB0aGlzLkJPU0hTZXNzaW9uKCk7CiAgICAgICAgICAgIHZhciBpZCA9IGI2NF9zaGExKCdjb252ZXJzZS5ib3NoLXNlc3Npb24nKTsKICAgICAgICAgICAgdGhpcy5zZXNzaW9uLmlkID0gaWQ7IC8vIEFwcGVhcnMgdG8gYmUgbmVjZXNzYXJ5IGZvciBiYWNrYm9uZS5icm93c2VyU3RvcmFnZQogICAgICAgICAgICB0aGlzLnNlc3Npb24uYnJvd3NlclN0b3JhZ2UgPSBuZXcgQmFja2JvbmUuQnJvd3NlclN0b3JhZ2VbY29udmVyc2Uuc3RvcmFnZV0oaWQpOwogICAgICAgICAgICB0aGlzLnNlc3Npb24uZmV0Y2goKTsKICAgICAgICAgICAgJCh3aW5kb3cpLm9uKCdiZWZvcmV1bmxvYWQnLCAkLnByb3h5KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGlmIChjb252ZXJzZS5jb25uZWN0aW9uLmNvbm5lY3RlZCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0U2Vzc2lvbigpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmNsZWFyU2Vzc2lvbigpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCB0aGlzKSk7CiAgICAgICAgfTsKCiAgICAgICAgdGhpcy5jbGVhclNlc3Npb24gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHRoaXMucm9zdGVyLmJyb3dzZXJTdG9yYWdlLl9jbGVhcigpOwogICAgICAgICAgICB0aGlzLnNlc3Npb24uYnJvd3NlclN0b3JhZ2UuX2NsZWFyKCk7CiAgICAgICAgICAgIC8vIFhYWDogdGhpcyBzaG91bGQgcGVyaGFwcyBnbyBpbnRvIHRoZSBiZWZvcmV1bmxvYWQgaGFuZGxlcgogICAgICAgICAgICBjb252ZXJzZS5jaGF0Ym94ZXMuZ2V0KCdjb250cm9sYm94Jykuc2F2ZSh7J2Nvbm5lY3RlZCc6IGZhbHNlfSk7CiAgICAgICAgfTsKCiAgICAgICAgdGhpcy5zZXRTZXNzaW9uID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICBpZiAodGhpcy5rZWVwYWxpdmUpIHsKICAgICAgICAgICAgICAgIHRoaXMuc2Vzc2lvbi5zYXZlKHsKICAgICAgICAgICAgICAgICAgICBqaWQ6IHRoaXMuY29ubmVjdGlvbi5qaWQsCiAgICAgICAgICAgICAgICAgICAgcmlkOiB0aGlzLmNvbm5lY3Rpb24uX3Byb3RvLnJpZCwKICAgICAgICAgICAgICAgICAgICBzaWQ6IHRoaXMuY29ubmVjdGlvbi5fcHJvdG8uc2lkCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIHRoaXMubG9nT3V0ID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICBjb252ZXJzZS5jaGF0Ym94dmlld3MuY2xvc2VBbGxDaGF0Qm94ZXMoZmFsc2UpOwogICAgICAgICAgICBjb252ZXJzZS5jbGVhclNlc3Npb24oKTsKICAgICAgICAgICAgY29udmVyc2UuY29ubmVjdGlvbi5kaXNjb25uZWN0KCk7CiAgICAgICAgICAgIGNvbnZlcnNlLmNvbm5lY3Rpb24ucmVzZXQoKTsKICAgICAgICB9OwoKICAgICAgICB0aGlzLnJlZ2lzdGVyR2xvYmFsRXZlbnRIYW5kbGVycyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgJChkb2N1bWVudCkuY2xpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgaWYgKCQoJy50b2dnbGUtb3RyIHVsJykuaXMoJzp2aXNpYmxlJykpIHsKICAgICAgICAgICAgICAgICAgICAkKCcudG9nZ2xlLW90ciB1bCcsIHRoaXMpLnNsaWRlVXAoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICgkKCcudG9nZ2xlLXNtaWxleSB1bCcpLmlzKCc6dmlzaWJsZScpKSB7CiAgICAgICAgICAgICAgICAgICAgJCgnLnRvZ2dsZS1zbWlsZXkgdWwnLCB0aGlzKS5zbGlkZVVwKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgJChkb2N1bWVudCkub24oJ21vdXNlbW92ZScsICQucHJveHkoZnVuY3Rpb24gKGV2KSB7CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMucmVzaXplZF9jaGF0Ym94IHx8ICF0aGlzLmFsbG93X2RyYWdyZXNpemUpIHsgcmV0dXJuIHRydWU7IH0KICAgICAgICAgICAgICAgIGV2LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICB0aGlzLnJlc2l6ZWRfY2hhdGJveC5yZXNpemVDaGF0Qm94KGV2KTsKICAgICAgICAgICAgfSwgdGhpcykpOwoKICAgICAgICAgICAgJChkb2N1bWVudCkub24oJ21vdXNldXAnLCAkLnByb3h5KGZ1bmN0aW9uIChldikgewogICAgICAgICAgICAgICAgaWYgKCF0aGlzLnJlc2l6ZWRfY2hhdGJveCB8fCAhdGhpcy5hbGxvd19kcmFncmVzaXplKSB7IHJldHVybiB0cnVlOyB9CiAgICAgICAgICAgICAgICBldi5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgdmFyIGhlaWdodCA9IHRoaXMuYXBwbHlIZWlnaHRSZXNpc3RhbmNlKHRoaXMucmVzaXplZF9jaGF0Ym94LmhlaWdodCk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5jb25uZWN0aW9uLmNvbm5lY3RlZCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMucmVzaXplZF9jaGF0Ym94Lm1vZGVsLnNhdmUoeydoZWlnaHQnOiBoZWlnaHR9KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXNpemVkX2NoYXRib3gubW9kZWwuc2V0KHsnaGVpZ2h0JzogaGVpZ2h0fSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLnJlc2l6ZWRfY2hhdGJveCA9IG51bGw7CiAgICAgICAgICAgIH0sIHRoaXMpKTsKCiAgICAgICAgICAgICQod2luZG93KS5vbigiYmx1ciBmb2N1cyIsICQucHJveHkoZnVuY3Rpb24gKGV2KSB7CiAgICAgICAgICAgICAgICBpZiAoKHRoaXMud2luZG93U3RhdGUgIT0gZXYudHlwZSkgJiYgKGV2LnR5cGUgPT0gJ2ZvY3VzJykpIHsKICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS5jbGVhck1zZ0NvdW50ZXIoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMud2luZG93U3RhdGUgPSBldi50eXBlOwogICAgICAgICAgICB9LHRoaXMpKTsKCiAgICAgICAgICAgICQod2luZG93KS5vbigicmVzaXplIiwgXy5kZWJvdW5jZSgkLnByb3h5KGZ1bmN0aW9uIChldikgewogICAgICAgICAgICAgICAgdGhpcy5jaGF0Ym94dmlld3MudHJpbUNoYXRzKCk7CiAgICAgICAgICAgIH0sdGhpcyksIDIwMCkpOwogICAgICAgIH07CgogICAgICAgIHRoaXMub25SZWNvbm5lY3RlZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgLy8gV2UgbmVlZCB0byByZS1yZWdpc3RlciBhbGwgdGhlIGV2ZW50IGhhbmRsZXJzIG9uIHRoZSBuZXdseQogICAgICAgICAgICAvLyBjcmVhdGVkIGNvbm5lY3Rpb24uCiAgICAgICAgICAgIHRoaXMuaW5pdFN0YXR1cygkLnByb3h5KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHRoaXMucmVnaXN0ZXJSb3N0ZXJYSGFuZGxlcigpOwogICAgICAgICAgICAgICAgdGhpcy5yZWdpc3RlclByZXNlbmNlSGFuZGxlcigpOwogICAgICAgICAgICAgICAgdGhpcy5jaGF0Ym94ZXMucmVnaXN0ZXJNZXNzYWdlSGFuZGxlcigpOwogICAgICAgICAgICAgICAgY29udmVyc2UueG1wcHN0YXR1cy5zZW5kUHJlc2VuY2UoKTsKICAgICAgICAgICAgICAgIHRoaXMuZ2l2ZUZlZWRiYWNrKF9fKCdPbmxpbmUgQ29udGFjdHMnKSk7CiAgICAgICAgICAgIH0sIHRoaXMpKTsKICAgICAgICB9OwoKICAgICAgICB0aGlzLmVuYWJsZUNhcmJvbnMgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIC8qIEFzayB0aGUgWE1QUCBzZXJ2ZXIgdG8gZW5hYmxlIE1lc3NhZ2UgQ2FyYm9ucwogICAgICAgICAgICAgKiBTZWUgWEVQLTAyODAgaHR0cHM6Ly94bXBwLm9yZy9leHRlbnNpb25zL3hlcC0wMjgwLmh0bWwjZW5hYmxpbmcKICAgICAgICAgICAgICovCiAgICAgICAgICAgIGlmICghdGhpcy5tZXNzYWdlX2NhcmJvbnMpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgY2FyYm9uc19pcSA9IG5ldyBTdHJvcGhlLkJ1aWxkZXIoJ2lxJywgewogICAgICAgICAgICAgICAgZnJvbTogdGhpcy5jb25uZWN0aW9uLmppZCwKICAgICAgICAgICAgICAgIGlkOiAnZW5hYmxlY2FyYm9ucycsCiAgICAgICAgICAgICAgICB0eXBlOiAnc2V0JwogICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgLmMoJ2VuYWJsZScsIHt4bWxuczogJ3Vybjp4bXBwOmNhcmJvbnM6Mid9KTsKICAgICAgICAgICAgdGhpcy5jb25uZWN0aW9uLnNlbmQoY2FyYm9uc19pcSk7CiAgICAgICAgICAgIHRoaXMuY29ubmVjdGlvbi5hZGRIYW5kbGVyKGZ1bmN0aW9uIChpcSkgewogICAgICAgICAgICAgICAgLy9UT0RPOiBjaGVjayBpZiBjYXJib25zIHdhcyBlbmFibGVkOgogICAgICAgICAgICB9LCBudWxsLCAiaXEiLCBudWxsLCAiZW5hYmxlY2FyYm9ucyIpOwogICAgICAgIH07CgogICAgICAgIHRoaXMub25Db25uZWN0ZWQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmRlYnVnKSB7CiAgICAgICAgICAgICAgICB0aGlzLmNvbm5lY3Rpb24ueG1sSW5wdXQgPSBmdW5jdGlvbiAoYm9keSkgeyBjb25zb2xlLmxvZyhib2R5KTsgfTsKICAgICAgICAgICAgICAgIHRoaXMuY29ubmVjdGlvbi54bWxPdXRwdXQgPSBmdW5jdGlvbiAoYm9keSkgeyBjb25zb2xlLmxvZyhib2R5KTsgfTsKICAgICAgICAgICAgICAgIFN0cm9waGUubG9nID0gZnVuY3Rpb24gKGxldmVsLCBtc2cpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhsZXZlbCsnICcrbXNnKTsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBTdHJvcGhlLmVycm9yID0gZnVuY3Rpb24gKG1zZykgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdFUlJPUjogJyttc2cpOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBXaGVuIHJlY29ubmVjdGluZywgdGhlcmUgbWlnaHQgYmUgc29tZSBvcGVuIGNoYXQgYm94ZXMuIFdlIGRvbid0CiAgICAgICAgICAgIC8vIGtub3cgd2hldGhlciB0aGVzZSBib3hlcyBhcmUgb2YgdGhlIHNhbWUgYWNjb3VudCBvciBub3QsIHNvIHdlCiAgICAgICAgICAgIC8vIGNsb3NlIHRoZW0gbm93LgogICAgICAgICAgICB0aGlzLmNoYXRib3h2aWV3cy5jbG9zZUFsbENoYXRCb3hlcygpOwogICAgICAgICAgICB0aGlzLnNldFNlc3Npb24oKTsKICAgICAgICAgICAgdGhpcy5qaWQgPSB0aGlzLmNvbm5lY3Rpb24uamlkOwogICAgICAgICAgICB0aGlzLmJhcmVfamlkID0gU3Ryb3BoZS5nZXRCYXJlSmlkRnJvbUppZCh0aGlzLmNvbm5lY3Rpb24uamlkKTsKICAgICAgICAgICAgdGhpcy5kb21haW4gPSBTdHJvcGhlLmdldERvbWFpbkZyb21KaWQodGhpcy5jb25uZWN0aW9uLmppZCk7CiAgICAgICAgICAgIHRoaXMubWluaW1pemVkX2NoYXRzID0gbmV3IGNvbnZlcnNlLk1pbmltaXplZENoYXRzKHttb2RlbDogdGhpcy5jaGF0Ym94ZXN9KTsKICAgICAgICAgICAgdGhpcy5mZWF0dXJlcyA9IG5ldyB0aGlzLkZlYXR1cmVzKCk7CiAgICAgICAgICAgIHRoaXMuZW5hYmxlQ2FyYm9ucygpOwogICAgICAgICAgICB0aGlzLmluaXRTdGF0dXMoJC5wcm94eShmdW5jdGlvbiAoKSB7CgogICAgICAgICAgICAgICAgdGhpcy5jaGF0Ym94ZXMub25Db25uZWN0ZWQoKTsKICAgICAgICAgICAgICAgIHRoaXMuZ2l2ZUZlZWRiYWNrKF9fKCdPbmxpbmUgQ29udGFjdHMnKSk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5jYWxsYmFjaykgewogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmNvbm5lY3Rpb24uc2VydmljZSA9PT0gJ2phc21pbmUgdGVzdHMnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFhYWDogQ2FsbCBiYWNrIHdpdGggdGhlIGludGVybmFsIGNvbnZlcnNlIG9iamVjdC4gVGhpcwogICAgICAgICAgICAgICAgICAgICAgICAvLyBvYmplY3Qgc2hvdWxkIG5ldmVyIGJlIGV4cG9zZWQgdG8gcHJvZHVjdGlvbiBzeXN0ZW1zLgogICAgICAgICAgICAgICAgICAgICAgICAvLyAnamFzbWluZSB0ZXN0cycgaXMgYW4gaW52YWxpZCBodHRwIGJpbmQgc2VydmljZSB2YWx1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgLy8gc28gd2UncmUgc3VyZSB0aGF0IHRoaXMgaXMganVzdCBmb3IgdGVzdHMuCiAgICAgICAgICAgICAgICAgICAgICAgIC8vCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRPRE86IFdlIG1pZ2h0IG5lZWQgdG8gY29uc2lkZXIgd2Vic29ja2V0cywgd2hpY2gKICAgICAgICAgICAgICAgICAgICAgICAgLy8gcHJvYmFibHkgd29uJ3QgdXNlIHRoZSAnc2VydmljZScgYXR0ci4gQ3VycmVudAogICAgICAgICAgICAgICAgICAgICAgICAvLyBzdHJvcGhlLmpzIHZlcnNpb24gdXNlZCBieSBjb252ZXJzZS5qcyBkb2Vzbid0IHN1cHBvcnQKICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2Vic29ja2V0cy4KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jYWxsYmFjayh0aGlzKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jYWxsYmFjaygpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgdGhpcykpOwogICAgICAgICAgICBjb252ZXJzZS5lbWl0KCdyZWFkeScpOwogICAgICAgIH07CgogICAgICAgIC8vIEJhY2tib25lIE1vZGVscyBhbmQgVmlld3MKICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgICAgdGhpcy5PVFIgPSBCYWNrYm9uZS5Nb2RlbC5leHRlbmQoewogICAgICAgICAgICAvLyBBIG1vZGVsIGZvciBtYW5hZ2luZyBPVFIgc2V0dGluZ3MuCiAgICAgICAgICAgIGdldFNlc3Npb25QYXNzcGhyYXNlOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBpZiAoY29udmVyc2UucHJlYmluZCkgewogICAgICAgICAgICAgICAgICAgIHZhciBrZXkgPSBiNjRfc2hhMShjb252ZXJzZS5jb25uZWN0aW9uLmppZCksCiAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MgPSB3aW5kb3cuc2Vzc2lvblN0b3JhZ2Vba2V5XTsKICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHBhc3MgPT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkqNDI5NDk2NzI5NSkudG9TdHJpbmcoKTsKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LnNlc3Npb25TdG9yYWdlW2tleV0gPSBwYXNzOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFzczsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbnZlcnNlLmNvbm5lY3Rpb24ucGFzczsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGdlbmVyYXRlUHJpdmF0ZUtleTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIGtleSA9IG5ldyBEU0EoKTsKICAgICAgICAgICAgICAgIHZhciBqaWQgPSBjb252ZXJzZS5jb25uZWN0aW9uLmppZDsKICAgICAgICAgICAgICAgIGlmIChjb252ZXJzZS5jYWNoZV9vdHJfa2V5KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGNpcGhlciA9IENyeXB0b0pTLmxpYi5QYXNzd29yZEJhc2VkQ2lwaGVyOwogICAgICAgICAgICAgICAgICAgIHZhciBwYXNzID0gdGhpcy5nZXRTZXNzaW9uUGFzc3BocmFzZSgpOwogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgcGFzcyAhPT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gRW5jcnlwdCB0aGUga2V5IGFuZCBzZXQgaW4gc2Vzc2lvblN0b3JhZ2UuIEFsc28gc3RvcmUgaW5zdGFuY2UgdGFnLgogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuc2Vzc2lvblN0b3JhZ2VbYjY0X3NoYTEoamlkKydwcml2X2tleScpXSA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaXBoZXIuZW5jcnlwdChDcnlwdG9KUy5hbGdvLkFFUywga2V5LnBhY2tQcml2YXRlKCksIHBhc3MpLnRvU3RyaW5nKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5zZXNzaW9uU3RvcmFnZVtiNjRfc2hhMShqaWQrJ2luc3RhbmNlX3RhZycpXSA9IGluc3RhbmNlX3RhZzsKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LnNlc3Npb25TdG9yYWdlW2I2NF9zaGExKGppZCsncGFzc19jaGVjaycpXSA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaXBoZXIuZW5jcnlwdChDcnlwdG9KUy5hbGdvLkFFUywgJ21hdGNoJywgcGFzcykudG9TdHJpbmcoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4ga2V5OwogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIHRoaXMuTWVzc2FnZSA9IEJhY2tib25lLk1vZGVsOwogICAgICAgIHRoaXMuTWVzc2FnZXMgPSBCYWNrYm9uZS5Db2xsZWN0aW9uLmV4dGVuZCh7CiAgICAgICAgICAgIG1vZGVsOiBjb252ZXJzZS5NZXNzYWdlCiAgICAgICAgfSk7CgogICAgICAgIHRoaXMuQ2hhdEJveCA9IEJhY2tib25lLk1vZGVsLmV4dGVuZCh7CiAgICAgICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBoZWlnaHQgPSBjb252ZXJzZS5hcHBseUhlaWdodFJlc2lzdGFuY2UodGhpcy5nZXQoJ2hlaWdodCcpKTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmdldCgnYm94X2lkJykgIT09ICdjb250cm9sYm94JykgewogICAgICAgICAgICAgICAgICAgIHRoaXMubWVzc2FnZXMgPSBuZXcgY29udmVyc2UuTWVzc2FnZXMoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLm1lc3NhZ2VzLmJyb3dzZXJTdG9yYWdlID0gbmV3IEJhY2tib25lLkJyb3dzZXJTdG9yYWdlW2NvbnZlcnNlLnN0b3JhZ2VdKAogICAgICAgICAgICAgICAgICAgICAgICBiNjRfc2hhMSgnY29udmVyc2UubWVzc2FnZXMnK3RoaXMuZ2V0KCdqaWQnKStjb252ZXJzZS5iYXJlX2ppZCkpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuc2F2ZSh7CiAgICAgICAgICAgICAgICAgICAgICAgICdib3hfaWQnIDogYjY0X3NoYTEodGhpcy5nZXQoJ2ppZCcpKSwKICAgICAgICAgICAgICAgICAgICAgICAgJ2hlaWdodCc6IGhlaWdodCwKICAgICAgICAgICAgICAgICAgICAgICAgJ21pbmltaXplZCc6IHRoaXMuZ2V0KCdtaW5pbWl6ZWQnKSB8fCBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgJ290cl9zdGF0dXMnOiB0aGlzLmdldCgnb3RyX3N0YXR1cycpIHx8IFVORU5DUllQVEVELAogICAgICAgICAgICAgICAgICAgICAgICAndGltZV9taW5pbWl6ZWQnOiB0aGlzLmdldCgndGltZV9taW5pbWl6ZWQnKSB8fCBtb21lbnQoKSwKICAgICAgICAgICAgICAgICAgICAgICAgJ3RpbWVfb3BlbmVkJzogdGhpcy5nZXQoJ3RpbWVfb3BlbmVkJykgfHwgbW9tZW50KCkudmFsdWVPZigpLAogICAgICAgICAgICAgICAgICAgICAgICAndXNlcl9pZCcgOiBTdHJvcGhlLmdldE5vZGVGcm9tSmlkKHRoaXMuZ2V0KCdqaWQnKSksCiAgICAgICAgICAgICAgICAgICAgICAgICdudW1fdW5yZWFkJzogdGhpcy5nZXQoJ251bV91bnJlYWQnKSB8fCAwLAogICAgICAgICAgICAgICAgICAgICAgICAndXJsJzogJycKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXQoewogICAgICAgICAgICAgICAgICAgICAgICAnaGVpZ2h0JzogaGVpZ2h0LAogICAgICAgICAgICAgICAgICAgICAgICAndGltZV9vcGVuZWQnOiBtb21lbnQoMCkudmFsdWVPZigpLAogICAgICAgICAgICAgICAgICAgICAgICAnbnVtX3VucmVhZCc6IHRoaXMuZ2V0KCdudW1fdW5yZWFkJykgfHwgMAogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgbWF4aW1pemU6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHRoaXMuc2F2ZSh7CiAgICAgICAgICAgICAgICAgICAgJ21pbmltaXplZCc6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICd0aW1lX29wZW5lZCc6IG1vbWVudCgpLnZhbHVlT2YoKQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBtaW5pbWl6ZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdGhpcy5zYXZlKHsKICAgICAgICAgICAgICAgICAgICAnbWluaW1pemVkJzogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAndGltZV9taW5pbWl6ZWQnOiBtb21lbnQoKS5mb3JtYXQoKQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBnZXRTZXNzaW9uOiBmdW5jdGlvbiAoY2FsbGJhY2spIHsKICAgICAgICAgICAgICAgIHZhciBjaXBoZXIgPSBDcnlwdG9KUy5saWIuUGFzc3dvcmRCYXNlZENpcGhlcjsKICAgICAgICAgICAgICAgIHZhciByZXN1bHQsIHBhc3MsIGluc3RhbmNlX3RhZywgc2F2ZWRfa2V5LCBwYXNzX2NoZWNrOwogICAgICAgICAgICAgICAgaWYgKGNvbnZlcnNlLmNhY2hlX290cl9rZXkpIHsKICAgICAgICAgICAgICAgICAgICBwYXNzID0gY29udmVyc2Uub3RyLmdldFNlc3Npb25QYXNzcGhyYXNlKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBwYXNzICE9PSAidW5kZWZpbmVkIikgewogICAgICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZV90YWcgPSB3aW5kb3cuc2Vzc2lvblN0b3JhZ2VbYjY0X3NoYTEodGhpcy5pZCsnaW5zdGFuY2VfdGFnJyldOwogICAgICAgICAgICAgICAgICAgICAgICBzYXZlZF9rZXkgPSB3aW5kb3cuc2Vzc2lvblN0b3JhZ2VbYjY0X3NoYTEodGhpcy5pZCsncHJpdl9rZXknKV07CiAgICAgICAgICAgICAgICAgICAgICAgIHBhc3NfY2hlY2sgPSB3aW5kb3cuc2Vzc2lvblN0b3JhZ2VbYjY0X3NoYTEodGhpcy5jb25uZWN0aW9uLmppZCsncGFzc19jaGVjaycpXTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNhdmVkX2tleSAmJiBpbnN0YW5jZV90YWcgJiYgdHlwZW9mIHBhc3NfY2hlY2sgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGVjcnlwdGVkID0gY2lwaGVyLmRlY3J5cHQoQ3J5cHRvSlMuYWxnby5BRVMsIHNhdmVkX2tleSwgcGFzcyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIga2V5ID0gRFNBLnBhcnNlUHJpdmF0ZShkZWNyeXB0ZWQudG9TdHJpbmcoQ3J5cHRvSlMuZW5jLkxhdGluMSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNpcGhlci5kZWNyeXB0KENyeXB0b0pTLmFsZ28uQUVTLCBwYXNzX2NoZWNrLCBwYXNzKS50b1N0cmluZyhDcnlwdG9KUy5lbmMuTGF0aW4xKSA9PT0gJ21hdGNoJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFZlcmlmaWVkIHRoYXQgdGhlIHBhc3NwaHJhc2UgaXMgc3RpbGwgdGhlIHNhbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXIoJ3Nob3dIZWxwTWVzc2FnZXMnLCBbX18oJ1JlLWVzdGFibGlzaGluZyBlbmNyeXB0ZWQgc2Vzc2lvbicpXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAna2V5Jzoga2V5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnaW5zdGFuY2VfdGFnJzogaW5zdGFuY2VfdGFnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOyAvLyBPdXIgd29yayBpcyBkb25lIGhlcmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vIFdlIG5lZWQgdG8gZ2VuZXJhdGUgYSBuZXcga2V5IGFuZCBpbnN0YW5jZSB0YWcKICAgICAgICAgICAgICAgIHRoaXMudHJpZ2dlcignc2hvd0hlbHBNZXNzYWdlcycsIFsKICAgICAgICAgICAgICAgICAgICBfXygnR2VuZXJhdGluZyBwcml2YXRlIGtleS4nKSwKICAgICAgICAgICAgICAgICAgICBfXygnWW91ciBicm93c2VyIG1pZ2h0IGJlY29tZSB1bnJlc3BvbnNpdmUuJyldLAogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgdHJ1ZSAvLyBzaG93IHNwaW5uZXIKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayh7CiAgICAgICAgICAgICAgICAgICAgICAgICdrZXknOiBjb252ZXJzZS5vdHIuZ2VuZXJhdGVQcml2YXRlS2V5LmFwcGx5KHRoaXMpLAogICAgICAgICAgICAgICAgICAgICAgICAnaW5zdGFuY2VfdGFnJzogT1RSLm1ha2VJbnN0YW5jZVRhZygpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9LCA1MDApOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgdXBkYXRlT1RSU3RhdHVzOiBmdW5jdGlvbiAoc3RhdGUpIHsKICAgICAgICAgICAgICAgIHN3aXRjaCAoc3RhdGUpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlIE9UUi5DT05TVC5TVEFUVVNfQUtFX1NVQ0NFU1M6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm90ci5tc2dzdGF0ZSA9PT0gT1RSLkNPTlNULk1TR1NUQVRFX0VOQ1JZUFRFRCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zYXZlKHsnb3RyX3N0YXR1cyc6IFVOVkVSSUZJRUR9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIE9UUi5DT05TVC5TVEFUVVNfRU5EX09UUjoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMub3RyLm1zZ3N0YXRlID09PSBPVFIuQ09OU1QuTVNHU1RBVEVfRklOSVNIRUQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2F2ZSh7J290cl9zdGF0dXMnOiBGSU5JU0hFRH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMub3RyLm1zZ3N0YXRlID09PSBPVFIuQ09OU1QuTVNHU1RBVEVfUExBSU5URVhUKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNhdmUoeydvdHJfc3RhdHVzJzogVU5FTkNSWVBURUR9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIG9uU01QOiBmdW5jdGlvbiAodHlwZSwgZGF0YSkgewogICAgICAgICAgICAgICAgLy8gRXZlbnQgaGFuZGxlciBmb3IgU01QIChTb2NpYWxpc3QncyBNaWxsaW9uYWlyZSBQcm90b2NvbCkKICAgICAgICAgICAgICAgIC8vIHVzZWQgYnkgT1RSIChvZmYtdGhlLXJlY29yZCkuCiAgICAgICAgICAgICAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlICdxdWVzdGlvbic6CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub3RyLnNtcFNlY3JldChwcm9tcHQoX18oCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnQXV0aGVudGljYXRpb24gcmVxdWVzdCBmcm9tICUxJHNcblxuWW91ciBidWRkeSBpcyBhdHRlbXB0aW5nIHRvIHZlcmlmeSB5b3VyIGlkZW50aXR5LCBieSBhc2tpbmcgeW91IHRoZSBxdWVzdGlvbiBiZWxvdy5cblxuJTIkcycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbdGhpcy5nZXQoJ2Z1bGxuYW1lJyksIGRhdGFdKSkpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICd0cnVzdCc6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNhdmUoeydvdHJfc3RhdHVzJzogVkVSSUZJRUR9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJpZ2dlcigKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc2hvd0hlbHBNZXNzYWdlcycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW19fKCJDb3VsZCBub3QgdmVyaWZ5IHRoaXMgdXNlcidzIGlkZW50aWZ5LiIpXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZXJyb3InKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2F2ZSh7J290cl9zdGF0dXMnOiBVTlZFUklGSUVEfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdVbmtub3duIHR5cGUuJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBpbml0aWF0ZU9UUjogZnVuY3Rpb24gKHF1ZXJ5X21zZykgewogICAgICAgICAgICAgICAgLy8gU2V0cyB1cCBhbiBPVFIgb2JqZWN0IHRocm91Z2ggd2hpY2ggd2UgY2FuIHNlbmQgYW5kIHJlY2VpdmUKICAgICAgICAgICAgICAgIC8vIGVuY3J5cHRlZCBtZXNzYWdlcy4KICAgICAgICAgICAgICAgIC8vCiAgICAgICAgICAgICAgICAvLyBJZiAncXVlcnlfbXNnJyBpcyBwYXNzZWQgaW4sIGl0IG1lYW5zIHRoZXJlIGlzIGFuIGFscmVhZCBpbmNvbWluZwogICAgICAgICAgICAgICAgLy8gcXVlcnkgbWVzc2FnZSBmcm9tIG91ciBidWRkeS4gT3RoZXJ3aXNlLCBpdCBpcyB1cyB3aG8gd2lsbAogICAgICAgICAgICAgICAgLy8gc2VuZCB0aGUgcXVlcnkgbWVzc2FnZSB0byB0aGVtLgogICAgICAgICAgICAgICAgdGhpcy5zYXZlKHsnb3RyX3N0YXR1cyc6IFVORU5DUllQVEVEfSk7CiAgICAgICAgICAgICAgICB2YXIgc2Vzc2lvbiA9IHRoaXMuZ2V0U2Vzc2lvbigkLnByb3h5KGZ1bmN0aW9uIChzZXNzaW9uKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5vdHIgPSBuZXcgT1RSKHsKICAgICAgICAgICAgICAgICAgICAgICAgZnJhZ21lbnRfc2l6ZTogMTQwLAogICAgICAgICAgICAgICAgICAgICAgICBzZW5kX2ludGVydmFsOiAyMDAsCiAgICAgICAgICAgICAgICAgICAgICAgIHByaXY6IHNlc3Npb24ua2V5LAogICAgICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZV90YWc6IHNlc3Npb24uaW5zdGFuY2VfdGFnLAogICAgICAgICAgICAgICAgICAgICAgICBkZWJ1ZzogdGhpcy5kZWJ1ZwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHRoaXMub3RyLm9uKCdzdGF0dXMnLCAkLnByb3h5KHRoaXMudXBkYXRlT1RSU3RhdHVzLCB0aGlzKSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5vdHIub24oJ3NtcCcsICQucHJveHkodGhpcy5vblNNUCwgdGhpcykpOwoKICAgICAgICAgICAgICAgICAgICB0aGlzLm90ci5vbigndWknLCAkLnByb3h5KGZ1bmN0aW9uIChtc2cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCdzaG93UmVjZWl2ZWRPVFJNZXNzYWdlJywgbXNnKTsKICAgICAgICAgICAgICAgICAgICB9LCB0aGlzKSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5vdHIub24oJ2lvJywgJC5wcm94eShmdW5jdGlvbiAobXNnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJpZ2dlcignc2VuZE1lc3NhZ2VTdGFuemEnLCBtc2cpOwogICAgICAgICAgICAgICAgICAgIH0sIHRoaXMpKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLm90ci5vbignZXJyb3InLCAkLnByb3h5KGZ1bmN0aW9uIChtc2cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCdzaG93T1RSRXJyb3InLCBtc2cpOwogICAgICAgICAgICAgICAgICAgIH0sIHRoaXMpKTsKCiAgICAgICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCdzaG93SGVscE1lc3NhZ2VzJywgW19fKCdFeGNoYW5naW5nIHByaXZhdGUga2V5IHdpdGggYnVkZHkuJyldKTsKICAgICAgICAgICAgICAgICAgICBpZiAocXVlcnlfbXNnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub3RyLnJlY2VpdmVNc2cocXVlcnlfbXNnKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm90ci5zZW5kUXVlcnlNc2coKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCB0aGlzKSk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBlbmRPVFI6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLm90cikgewogICAgICAgICAgICAgICAgICAgIHRoaXMub3RyLmVuZE90cigpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5zYXZlKHsnb3RyX3N0YXR1cyc6IFVORU5DUllQVEVEfSk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBjcmVhdGVNZXNzYWdlOiBmdW5jdGlvbiAoJG1lc3NhZ2UpIHsKICAgICAgICAgICAgICAgIHZhciBib2R5ID0gJG1lc3NhZ2UuY2hpbGRyZW4oJ2JvZHknKS50ZXh0KCksCiAgICAgICAgICAgICAgICAgICAgY29tcG9zaW5nID0gJG1lc3NhZ2UuZmluZCgnY29tcG9zaW5nJyksCiAgICAgICAgICAgICAgICAgICAgcGF1c2VkID0gJG1lc3NhZ2UuZmluZCgncGF1c2VkJyksCiAgICAgICAgICAgICAgICAgICAgZGVsYXllZCA9ICRtZXNzYWdlLmZpbmQoJ2RlbGF5JykubGVuZ3RoID4gMCwKICAgICAgICAgICAgICAgICAgICBmdWxsbmFtZSA9IHRoaXMuZ2V0KCdmdWxsbmFtZScpLAogICAgICAgICAgICAgICAgICAgIGlzX2dyb3VwY2hhdCA9ICRtZXNzYWdlLmF0dHIoJ3R5cGUnKSA9PT0gJ2dyb3VwY2hhdCcsCiAgICAgICAgICAgICAgICAgICAgbXNnaWQgPSAkbWVzc2FnZS5hdHRyKCdpZCcpLAogICAgICAgICAgICAgICAgICAgIHN0YW1wLCB0aW1lLCBzZW5kZXIsIGZyb207CgogICAgICAgICAgICAgICAgaWYgKGlzX2dyb3VwY2hhdCkgewogICAgICAgICAgICAgICAgICAgIGZyb20gPSBTdHJvcGhlLnVuZXNjYXBlTm9kZShTdHJvcGhlLmdldFJlc291cmNlRnJvbUppZCgkbWVzc2FnZS5hdHRyKCdmcm9tJykpKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgZnJvbSA9IFN0cm9waGUuZ2V0QmFyZUppZEZyb21KaWQoJG1lc3NhZ2UuYXR0cignZnJvbScpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGZ1bGxuYW1lID0gKF8uaXNFbXB0eShmdWxsbmFtZSk/IGZyb206IGZ1bGxuYW1lKS5zcGxpdCgnICcpWzBdOwoKICAgICAgICAgICAgICAgIGlmICghYm9keSkgewogICAgICAgICAgICAgICAgICAgIGlmIChjb21wb3NpbmcubGVuZ3RoIHx8IHBhdXNlZC5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gRklYTUU6IHVzZSBvbmUgYXR0cmlidXRlIGZvciBjaGF0IHN0YXRlcyAoZS5nLgogICAgICAgICAgICAgICAgICAgICAgICAvLyBjaGF0c3RhdGUpIGluc3RlYWQgb2Ygc2F2aW5nICdwYXVzZWQnIGFuZAogICAgICAgICAgICAgICAgICAgICAgICAvLyAnY29tcG9zaW5nJyBzZXBhcmF0ZWx5LgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1lc3NhZ2VzLmFkZCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdWxsbmFtZTogZnVsbG5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZW5kZXI6ICd0aGVtJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGF5ZWQ6IGRlbGF5ZWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lOiBtb21lbnQoKS5mb3JtYXQoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBvc2luZzogY29tcG9zaW5nLmxlbmd0aCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdXNlZDogcGF1c2VkLmxlbmd0aAogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmIChkZWxheWVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0YW1wID0gJG1lc3NhZ2UuZmluZCgnZGVsYXknKS5hdHRyKCdzdGFtcCcpOwogICAgICAgICAgICAgICAgICAgICAgICB0aW1lID0gc3RhbXA7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGltZSA9IG1vbWVudCgpLmZvcm1hdCgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoKGlzX2dyb3VwY2hhdCAmJiBmcm9tID09PSB0aGlzLmdldCgnbmljaycpKSB8fCAoIWlzX2dyb3VwY2hhdCAmJiBmcm9tID09IGNvbnZlcnNlLmJhcmVfamlkKSkgewogICAgICAgICAgICAgICAgICAgICAgICBzZW5kZXIgPSAnbWUnOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRlciA9ICd0aGVtJzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdGhpcy5tZXNzYWdlcy5jcmVhdGUoewogICAgICAgICAgICAgICAgICAgICAgICBmdWxsbmFtZTogZnVsbG5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRlcjogc2VuZGVyLAogICAgICAgICAgICAgICAgICAgICAgICBkZWxheWVkOiBkZWxheWVkLAogICAgICAgICAgICAgICAgICAgICAgICB0aW1lOiB0aW1lLAogICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBib2R5LAogICAgICAgICAgICAgICAgICAgICAgICBtc2dpZDogbXNnaWQKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHJlY2VpdmVNZXNzYWdlOiBmdW5jdGlvbiAoJG1lc3NhZ2UpIHsKICAgICAgICAgICAgICAgIHZhciAkYm9keSA9ICRtZXNzYWdlLmNoaWxkcmVuKCdib2R5Jyk7CiAgICAgICAgICAgICAgICB2YXIgdGV4dCA9ICgkYm9keS5sZW5ndGggPiAwID8gJGJvZHkudGV4dCgpIDogdW5kZWZpbmVkKTsKICAgICAgICAgICAgICAgIGlmICgoIXRleHQpIHx8ICghY29udmVyc2UuYWxsb3dfb3RyKSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZU1lc3NhZ2UoJG1lc3NhZ2UpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHRleHQubWF0Y2goL15cP09UUnYyMz8vKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuaW5pdGlhdGVPVFIodGV4dCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmIChfLmNvbnRhaW5zKFtVTlZFUklGSUVELCBWRVJJRklFRF0sIHRoaXMuZ2V0KCdvdHJfc3RhdHVzJykpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub3RyLnJlY2VpdmVNc2codGV4dCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRleHQubWF0Y2goL15cP09UUi8pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMub3RyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbml0aWF0ZU9UUih0ZXh0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vdHIucmVjZWl2ZU1zZyh0ZXh0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE5vcm1hbCB1bmVuY3J5cHRlZCBtZXNzYWdlLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jcmVhdGVNZXNzYWdlKCRtZXNzYWdlKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICB0aGlzLkNoYXRCb3hWaWV3ID0gQmFja2JvbmUuVmlldy5leHRlbmQoewogICAgICAgICAgICBsZW5ndGg6IDIwMCwKICAgICAgICAgICAgdGFnTmFtZTogJ2RpdicsCiAgICAgICAgICAgIGNsYXNzTmFtZTogJ2NoYXRib3gnLAogICAgICAgICAgICBpc19jaGF0cm9vbTogZmFsc2UsICAvLyBUaGlzIGlzIG5vdCBhIG11bHRpLXVzZXIgY2hhdHJvb20KCiAgICAgICAgICAgIGV2ZW50czogewogICAgICAgICAgICAgICAgJ2NsaWNrIC5jbG9zZS1jaGF0Ym94LWJ1dHRvbic6ICdjbG9zZScsCiAgICAgICAgICAgICAgICAnY2xpY2sgLnRvZ2dsZS1jaGF0Ym94LWJ1dHRvbic6ICdtaW5pbWl6ZScsCiAgICAgICAgICAgICAgICAna2V5cHJlc3MgdGV4dGFyZWEuY2hhdC10ZXh0YXJlYSc6ICdrZXlQcmVzc2VkJywKICAgICAgICAgICAgICAgICdjbGljayAudG9nZ2xlLXNtaWxleSc6ICd0b2dnbGVFbW90aWNvbk1lbnUnLAogICAgICAgICAgICAgICAgJ2NsaWNrIC50b2dnbGUtc21pbGV5IHVsIGxpJzogJ2luc2VydEVtb3RpY29uJywKICAgICAgICAgICAgICAgICdjbGljayAudG9nZ2xlLWNsZWFyJzogJ2NsZWFyTWVzc2FnZXMnLAogICAgICAgICAgICAgICAgJ2NsaWNrIC50b2dnbGUtb3RyJzogJ3RvZ2dsZU9UUk1lbnUnLAogICAgICAgICAgICAgICAgJ2NsaWNrIC5zdGFydC1vdHInOiAnc3RhcnRPVFJGcm9tVG9vbGJhcicsCiAgICAgICAgICAgICAgICAnY2xpY2sgLmVuZC1vdHInOiAnZW5kT1RSJywKICAgICAgICAgICAgICAgICdjbGljayAuYXV0aC1vdHInOiAnYXV0aE9UUicsCiAgICAgICAgICAgICAgICAnY2xpY2sgLnRvZ2dsZS1jYWxsJzogJ3RvZ2dsZUNhbGwnLAogICAgICAgICAgICAgICAgJ21vdXNlZG93biAuZHJhZ3Jlc2l6ZS10bSc6ICdvbkRyYWdSZXNpemVTdGFydCcKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uICgpewogICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5tZXNzYWdlcy5vbignYWRkJywgdGhpcy5vbk1lc3NhZ2VBZGRlZCwgdGhpcyk7CiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLm9uKCdzaG93JywgdGhpcy5zaG93LCB0aGlzKTsKICAgICAgICAgICAgICAgIHRoaXMubW9kZWwub24oJ2Rlc3Ryb3knLCB0aGlzLmhpZGUsIHRoaXMpOwogICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5vbignY2hhbmdlJywgdGhpcy5vbkNoYW5nZSwgdGhpcyk7CiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLm9uKCdzaG93T1RSRXJyb3InLCB0aGlzLnNob3dPVFJFcnJvciwgdGhpcyk7CiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLm9uKCdidWRkeVN0YXJ0c09UUicsIHRoaXMuYnVkZHlTdGFydHNPVFIsIHRoaXMpOwogICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5vbignc2hvd0hlbHBNZXNzYWdlcycsIHRoaXMuc2hvd0hlbHBNZXNzYWdlcywgdGhpcyk7CiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLm9uKCdzZW5kTWVzc2FnZVN0YW56YScsIHRoaXMuc2VuZE1lc3NhZ2VTdGFuemEsIHRoaXMpOwogICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5vbignc2hvd1NlbnRPVFJNZXNzYWdlJywgZnVuY3Rpb24gKHRleHQpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dNZXNzYWdlKHsnbWVzc2FnZSc6IHRleHQsICdzZW5kZXInOiAnbWUnfSk7CiAgICAgICAgICAgICAgICB9LCB0aGlzKTsKICAgICAgICAgICAgICAgIHRoaXMubW9kZWwub24oJ3Nob3dSZWNlaXZlZE9UUk1lc3NhZ2UnLCBmdW5jdGlvbiAodGV4dCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd01lc3NhZ2UoeydtZXNzYWdlJzogdGV4dCwgJ3NlbmRlcic6ICd0aGVtJ30pOwogICAgICAgICAgICAgICAgfSwgdGhpcyk7CgogICAgICAgICAgICAgICAgdGhpcy51cGRhdGVWQ2FyZCgpOwogICAgICAgICAgICAgICAgdGhpcy4kZWwuaW5zZXJ0QWZ0ZXIoY29udmVyc2UuY2hhdGJveHZpZXdzLmdldCgiY29udHJvbGJveCIpLiRlbCk7CiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcigpLm1vZGVsLm1lc3NhZ2VzLmZldGNoKHthZGQ6IHRydWV9KTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLm1vZGVsLmdldCgnbWluaW1pemVkJykpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmhpZGUoKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoKF8uY29udGFpbnMoW1VOVkVSSUZJRUQsIFZFUklGSUVEXSwgdGhpcy5tb2RlbC5nZXQoJ290cl9zdGF0dXMnKSkpIHx8IGNvbnZlcnNlLnVzZV9vdHJfYnlfZGVmYXVsdCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuaW5pdGlhdGVPVFIoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdGhpcy4kZWwuYXR0cignaWQnLCB0aGlzLm1vZGVsLmdldCgnYm94X2lkJykpCiAgICAgICAgICAgICAgICAgICAgLmh0bWwoY29udmVyc2UudGVtcGxhdGVzLmNoYXRib3goCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfLmV4dGVuZCh0aGlzLm1vZGVsLnRvSlNPTigpLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3dfdG9vbGJhcjogY29udmVyc2Uuc2hvd190b29sYmFyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbF9wZXJzb25hbF9tZXNzYWdlOiBfXygnUGVyc29uYWwgbWVzc2FnZScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyVG9vbGJhcigpLnJlbmRlckF2YXRhcigpOwogICAgICAgICAgICAgICAgY29udmVyc2UuZW1pdCgnY2hhdEJveE9wZW5lZCcsIHRoaXMpOwogICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgY29udmVyc2UucmVmcmVzaFdlYmtpdCgpOwogICAgICAgICAgICAgICAgfSwgNTApOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2hvd1N0YXR1c01lc3NhZ2UoKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGluaXREcmFnUmVzaXplOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB0aGlzLnByZXZfcGFnZVkgPSAwOyAvLyBUbyBzdG9yZSBsYXN0IGtub3duIG1vdXNlIHBvc2l0aW9uCiAgICAgICAgICAgICAgICBpZiAoY29udmVyc2UuY29ubmVjdGlvbi5jb25uZWN0ZWQpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmhlaWdodCA9IHRoaXMubW9kZWwuZ2V0KCdoZWlnaHQnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgc2hvd1N0YXR1c05vdGlmaWNhdGlvbjogZnVuY3Rpb24gKG1lc3NhZ2UsIGtlZXBfb2xkKSB7CiAgICAgICAgICAgICAgICB2YXIgJGNoYXRfY29udGVudCA9IHRoaXMuJGVsLmZpbmQoJy5jaGF0LWNvbnRlbnQnKTsKICAgICAgICAgICAgICAgIGlmICgha2VlcF9vbGQpIHsKICAgICAgICAgICAgICAgICAgICAkY2hhdF9jb250ZW50LmZpbmQoJ2Rpdi5jaGF0LWV2ZW50JykucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkY2hhdF9jb250ZW50LmFwcGVuZCgkKCc8ZGl2IGNsYXNzPSJjaGF0LWV2ZW50Ij48L2Rpdj4nKS50ZXh0KG1lc3NhZ2UpKTsKICAgICAgICAgICAgICAgIHRoaXMuc2Nyb2xsRG93bigpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgY2xlYXJDaGF0Um9vbU1lc3NhZ2VzOiBmdW5jdGlvbiAoZXYpIHsKICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZXYgIT09ICJ1bmRlZmluZWQiKSB7IGV2LnN0b3BQcm9wYWdhdGlvbigpOyB9CiAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gY29uZmlybShfXygiQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIGNsZWFyIHRoZSBtZXNzYWdlcyBmcm9tIHRoaXMgcm9vbT8iKSk7CiAgICAgICAgICAgICAgICBpZiAocmVzdWx0ID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kZWwuZmluZCgnLmNoYXQtY29udGVudCcpLmVtcHR5KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHNob3dNZXNzYWdlOiBmdW5jdGlvbiAobXNnX2RpY3QpIHsKICAgICAgICAgICAgICAgIHZhciAkY29udGVudCA9IHRoaXMuJGVsLmZpbmQoJy5jaGF0LWNvbnRlbnQnKSwKICAgICAgICAgICAgICAgICAgICBtc2dfdGltZSA9IG1vbWVudChtc2dfZGljdC50aW1lKSB8fCBtb21lbnQsCiAgICAgICAgICAgICAgICAgICAgdGV4dCA9IG1zZ19kaWN0Lm1lc3NhZ2UsCiAgICAgICAgICAgICAgICAgICAgbWF0Y2ggPSB0ZXh0Lm1hdGNoKC9eXC8oLio/KSg/OiAoLiopKT8kLyksCiAgICAgICAgICAgICAgICAgICAgZnVsbG5hbWUgPSBtc2dfZGljdC5mdWxsbmFtZSB8fCB0aGlzLm1vZGVsLmdldCgnZnVsbG5hbWUnKSwgLy8gWFhYIFBlcmhhcHMgYWx3YXlzIHVzZSBtb2RlbCdzPwogICAgICAgICAgICAgICAgICAgIGV4dHJhX2NsYXNzZXMgPSBtc2dfZGljdC5kZWxheWVkICYmICdkZWxheWVkJyB8fCAnJywKICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZSwgdXNlcm5hbWU7CgogICAgICAgICAgICAgICAgaWYgKChtYXRjaCkgJiYgKG1hdGNoWzFdID09PSAnbWUnKSkgewogICAgICAgICAgICAgICAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoL15cL21lLywgJycpOwogICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlID0gY29udmVyc2UudGVtcGxhdGVzLmFjdGlvbjsKICAgICAgICAgICAgICAgICAgICB1c2VybmFtZSA9IGZ1bGxuYW1lOwogICAgICAgICAgICAgICAgfSBlbHNlICB7CiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGUgPSBjb252ZXJzZS50ZW1wbGF0ZXMubWVzc2FnZTsKICAgICAgICAgICAgICAgICAgICB1c2VybmFtZSA9IG1zZ19kaWN0LnNlbmRlciA9PT0gJ21lJyAmJiBfXygnbWUnKSB8fCBmdWxsbmFtZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRjb250ZW50LmZpbmQoJ2Rpdi5jaGF0LWV2ZW50JykucmVtb3ZlKCk7CgogICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNfY2hhdHJvb20gJiYgbXNnX2RpY3Quc2VuZGVyID09ICd0aGVtJyAmJiAobmV3IFJlZ0V4cCgiXFxiIit0aGlzLm1vZGVsLmdldCgnbmljaycpKyJcXGIiKSkudGVzdCh0ZXh0KSkgewogICAgICAgICAgICAgICAgICAgIC8vIEFkZCBzcGVjaWFsIGNsYXNzIHRvIG1hcmsgZ3JvdXBjaGF0IG1lc3NhZ2VzIGluIHdoaWNoIHdlCiAgICAgICAgICAgICAgICAgICAgLy8gYXJlIG1lbnRpb25lZC4KICAgICAgICAgICAgICAgICAgICBleHRyYV9jbGFzc2VzICs9ICcgbWVudGlvbmVkJzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlID0gdGVtcGxhdGUoewogICAgICAgICAgICAgICAgICAgICdzZW5kZXInOiBtc2dfZGljdC5zZW5kZXIsCiAgICAgICAgICAgICAgICAgICAgJ3RpbWUnOiBtc2dfdGltZS5mb3JtYXQoJ2hoOm1tJyksCiAgICAgICAgICAgICAgICAgICAgJ3VzZXJuYW1lJzogdXNlcm5hbWUsCiAgICAgICAgICAgICAgICAgICAgJ21lc3NhZ2UnOiAnJywKICAgICAgICAgICAgICAgICAgICAnZXh0cmFfY2xhc3Nlcyc6IGV4dHJhX2NsYXNzZXMKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgJGNvbnRlbnQuYXBwZW5kKCQobWVzc2FnZSkuY2hpbGRyZW4oJy5jaGF0LW1lc3NhZ2UtY29udGVudCcpLmZpcnN0KCkudGV4dCh0ZXh0KS5hZGRIeXBlcmxpbmtzKCkuYWRkRW1vdGljb25zKCkucGFyZW50KCkpOwogICAgICAgICAgICAgICAgdGhpcy5zY3JvbGxEb3duKCk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBzaG93SGVscE1lc3NhZ2VzOiBmdW5jdGlvbiAobXNncywgdHlwZSwgc3Bpbm5lcikgewogICAgICAgICAgICAgICAgdmFyICRjaGF0X2NvbnRlbnQgPSB0aGlzLiRlbC5maW5kKCcuY2hhdC1jb250ZW50JyksIGksCiAgICAgICAgICAgICAgICAgICAgbXNnc19sZW5ndGggPSBtc2dzLmxlbmd0aDsKICAgICAgICAgICAgICAgIGZvciAoaT0wOyBpPG1zZ3NfbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAkY2hhdF9jb250ZW50LmFwcGVuZCgkKCc8ZGl2IGNsYXNzPSJjaGF0LScrKHR5cGV8fCdpbmZvJykrJyI+Jyttc2dzW2ldKyc8L2Rpdj4nKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoc3Bpbm5lciA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgICAgICRjaGF0X2NvbnRlbnQuYXBwZW5kKCc8c3BhbiBjbGFzcz0ic3Bpbm5lciIvPicpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzcGlubmVyID09PSBmYWxzZSkgewogICAgICAgICAgICAgICAgICAgICRjaGF0X2NvbnRlbnQuZmluZCgnc3Bhbi5zcGlubmVyJykucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zY3JvbGxEb3duKCk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBvbk1lc3NhZ2VBZGRlZDogZnVuY3Rpb24gKG1lc3NhZ2UpIHsKICAgICAgICAgICAgICAgIHZhciB0aW1lID0gbWVzc2FnZS5nZXQoJ3RpbWUnKSwKICAgICAgICAgICAgICAgICAgICB0aW1lcyA9IHRoaXMubW9kZWwubWVzc2FnZXMucGx1Y2soJ3RpbWUnKSwKICAgICAgICAgICAgICAgICAgICBwcmV2aW91c19tZXNzYWdlLCBpZHgsIHRoaXNfZGF0ZSwgcHJldl9kYXRlLCB0ZXh0LCBtYXRjaDsKCiAgICAgICAgICAgICAgICAvLyBJZiB0aGlzIG1lc3NhZ2UgaXMgb24gYSBkaWZmZXJlbnQgZGF5IHRoYW4gdGhlIG9uZSByZWNlaXZlZAogICAgICAgICAgICAgICAgLy8gcHJpb3IsIHRoZW4gaW5kaWNhdGUgaXQgb24gdGhlIGNoYXRib3guCiAgICAgICAgICAgICAgICBpZHggPSBfLmluZGV4T2YodGltZXMsIHRpbWUpLTE7CiAgICAgICAgICAgICAgICBpZiAoaWR4ID49IDApIHsKICAgICAgICAgICAgICAgICAgICBwcmV2aW91c19tZXNzYWdlID0gdGhpcy5tb2RlbC5tZXNzYWdlcy5hdChpZHgpOwogICAgICAgICAgICAgICAgICAgIHByZXZfZGF0ZSA9IG1vbWVudChwcmV2aW91c19tZXNzYWdlLmdldCgndGltZScpKTsKICAgICAgICAgICAgICAgICAgICBpZiAocHJldl9kYXRlLmlzQmVmb3JlKHRpbWUsICdkYXknKSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzX2RhdGUgPSBtb21lbnQodGltZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJGVsLmZpbmQoJy5jaGF0LWNvbnRlbnQnKS5hcHBlbmQoY29udmVyc2UudGVtcGxhdGVzLm5ld19kYXkoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNvZGF0ZTogdGhpc19kYXRlLmZvcm1hdCgiWVlZWS1NTS1ERCIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZXN0cmluZzogdGhpc19kYXRlLmZvcm1hdCgiZGRkZCBNTU0gRG8gWVlZWSIpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5nZXQoQ09NUE9TSU5HKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd1N0YXR1c05vdGlmaWNhdGlvbihtZXNzYWdlLmdldCgnZnVsbG5hbWUnKSsnICcrX18oJ2lzIHR5cGluZycpKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG1lc3NhZ2UuZ2V0KFBBVVNFRCkpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dTdGF0dXNOb3RpZmljYXRpb24obWVzc2FnZS5nZXQoJ2Z1bGxuYW1lJykrJyAnK19fKCdoYXMgc3RvcHBlZCB0eXBpbmcnKSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dNZXNzYWdlKF8uY2xvbmUobWVzc2FnZS5hdHRyaWJ1dGVzKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoKG1lc3NhZ2UuZ2V0KCdzZW5kZXInKSAhPSAnbWUnKSAmJiAoY29udmVyc2Uud2luZG93U3RhdGUgPT0gJ2JsdXInKSkgewogICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLmluY3JlbWVudE1zZ0NvdW50ZXIoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNjcm9sbERvd24oKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHNlbmRNZXNzYWdlU3RhbnphOiBmdW5jdGlvbiAodGV4dCkgewogICAgICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAgICAqIFNlbmRzIHRoZSBhY3R1YWwgWE1MIHN0YW56YSB0byB0aGUgWE1QUCBzZXJ2ZXIuCiAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgIC8vIFRPRE86IExvb2sgaW4gQ2hhdFBhcnRuZXJzIHRvIHNlZSB3aGF0IHJlc291cmNlcyB3ZSBoYXZlIGZvciB0aGUgcmVjaXBpZW50LgogICAgICAgICAgICAgICAgLy8gaWYgd2UgaGF2ZSBvbmUgcmVzb3VyY2UsIHdlIHNlbnQgdG8gb25seSB0aGF0IHJlc291cmNlcywgaWYgd2UgaGF2ZSBtdWx0aXBsZQogICAgICAgICAgICAgICAgLy8gd2Ugc2VuZCB0byB0aGUgYmFyZSBqaWQuCiAgICAgICAgICAgICAgICB2YXIgdGltZXN0YW1wID0gKG5ldyBEYXRlKCkpLmdldFRpbWUoKTsKICAgICAgICAgICAgICAgIHZhciBiYXJlX2ppZCA9IHRoaXMubW9kZWwuZ2V0KCdqaWQnKTsKICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlID0gJG1zZyh7ZnJvbTogY29udmVyc2UuY29ubmVjdGlvbi5qaWQsIHRvOiBiYXJlX2ppZCwgdHlwZTogJ2NoYXQnLCBpZDogdGltZXN0YW1wfSkKICAgICAgICAgICAgICAgICAgICAuYygnYm9keScpLnQodGV4dCkudXAoKQogICAgICAgICAgICAgICAgICAgIC5jKCdhY3RpdmUnLCB7J3htbG5zJzogJ2h0dHA6Ly9qYWJiZXIub3JnL3Byb3RvY29sL2NoYXRzdGF0ZXMnfSk7CiAgICAgICAgICAgICAgICBjb252ZXJzZS5jb25uZWN0aW9uLnNlbmQobWVzc2FnZSk7CiAgICAgICAgICAgICAgICBpZiAoY29udmVyc2UuZm9yd2FyZF9tZXNzYWdlcykgewogICAgICAgICAgICAgICAgICAgIC8vIEZvcndhcmQgdGhlIG1lc3NhZ2UsIHNvIHRoYXQgb3RoZXIgY29ubmVjdGVkIHJlc291cmNlcyBhcmUgYWxzbyBhd2FyZSBvZiBpdC4KICAgICAgICAgICAgICAgICAgICB2YXIgZm9yd2FyZGVkID0gJG1zZyh7dG86Y29udmVyc2UuYmFyZV9qaWQsIHR5cGU6J2NoYXQnLCBpZDp0aW1lc3RhbXB9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYygnZm9yd2FyZGVkJywge3htbG5zOid1cm46eG1wcDpmb3J3YXJkOjAnfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmMoJ2RlbGF5Jywge3htbnM6J3Vybjp4bXBwOmRlbGF5JyxzdGFtcDp0aW1lc3RhbXB9KS51cCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jbm9kZShtZXNzYWdlLnRyZWUoKSk7CiAgICAgICAgICAgICAgICAgICAgY29udmVyc2UuY29ubmVjdGlvbi5zZW5kKGZvcndhcmRlZCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBzZW5kTWVzc2FnZTogZnVuY3Rpb24gKHRleHQpIHsKICAgICAgICAgICAgICAgIHZhciBtYXRjaCA9IHRleHQucmVwbGFjZSgvXlxzKi8sICIiKS5tYXRjaCgvXlwvKC4qKVxzKiQvKSwgbXNnczsKICAgICAgICAgICAgICAgIGlmIChtYXRjaCkgewogICAgICAgICAgICAgICAgICAgIGlmIChtYXRjaFsxXSA9PT0gImNsZWFyIikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jbGVhck1lc3NhZ2VzKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKG1hdGNoWzFdID09PSAiaGVscCIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbXNncyA9IFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8c3Ryb25nPi9oZWxwPC9zdHJvbmc+OicrX18oJ1Nob3cgdGhpcyBtZW51JykrJycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPHN0cm9uZz4vbWU8L3N0cm9uZz46JytfXygnV3JpdGUgaW4gdGhlIHRoaXJkIHBlcnNvbicpKycnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxzdHJvbmc+L2NsZWFyPC9zdHJvbmc+OicrX18oJ1JlbW92ZSBtZXNzYWdlcycpKycnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dIZWxwTWVzc2FnZXMobXNncyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKChjb252ZXJzZS5hbGxvd19vdHIpICYmIChtYXRjaFsxXSA9PT0gImVuZG90ciIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVuZE9UUigpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoKGNvbnZlcnNlLmFsbG93X290cikgJiYgKG1hdGNoWzFdID09PSAib3RyIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubW9kZWwuaW5pdGlhdGVPVFIoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoXy5jb250YWlucyhbVU5WRVJJRklFRCwgVkVSSUZJRURdLCB0aGlzLm1vZGVsLmdldCgnb3RyX3N0YXR1cycpKSkgewogICAgICAgICAgICAgICAgICAgIC8vIE9mZi10aGUtcmVjb3JkIGVuY3J5cHRpb24gaXMgYWN0aXZlCiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5vdHIuc2VuZE1zZyh0ZXh0KTsKICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLnRyaWdnZXIoJ3Nob3dTZW50T1RSTWVzc2FnZScsIHRleHQpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvLyBXZSBvbmx5IHNhdmUgdW5lbmNyeXB0ZWQgbWVzc2FnZXMuCiAgICAgICAgICAgICAgICAgICAgdmFyIGZ1bGxuYW1lID0gY29udmVyc2UueG1wcHN0YXR1cy5nZXQoJ2Z1bGxuYW1lJyk7CiAgICAgICAgICAgICAgICAgICAgZnVsbG5hbWUgPSBfLmlzRW1wdHkoZnVsbG5hbWUpPyBjb252ZXJzZS5iYXJlX2ppZDogZnVsbG5hbWU7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5tZXNzYWdlcy5jcmVhdGUoewogICAgICAgICAgICAgICAgICAgICAgICBmdWxsbmFtZTogZnVsbG5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRlcjogJ21lJywKICAgICAgICAgICAgICAgICAgICAgICAgdGltZTogbW9tZW50KCkuZm9ybWF0KCksCiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IHRleHQKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbmRNZXNzYWdlU3RhbnphKHRleHQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAoKICAgICAgICAgICAga2V5UHJlc3NlZDogZnVuY3Rpb24gKGV2KSB7CiAgICAgICAgICAgICAgICB2YXIgJHRleHRhcmVhID0gJChldi50YXJnZXQpLAogICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UsIG5vdGlmeSwgY29tcG9zaW5nOwogICAgICAgICAgICAgICAgaWYoZXYua2V5Q29kZSA9PSBLRVkuRU5URVIpIHsKICAgICAgICAgICAgICAgICAgICBldi5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSAkdGV4dGFyZWEudmFsKCk7CiAgICAgICAgICAgICAgICAgICAgJHRleHRhcmVhLnZhbCgnJykuZm9jdXMoKTsKICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZSAhPT0gJycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMubW9kZWwuZ2V0KCdjaGF0cm9vbScpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbmRDaGF0Um9vbU1lc3NhZ2UobWVzc2FnZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbmRNZXNzYWdlKG1lc3NhZ2UpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLmVtaXQoJ21lc3NhZ2VTZW5kJywgbWVzc2FnZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHRoaXMuJGVsLmRhdGEoJ2NvbXBvc2luZycsIGZhbHNlKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIXRoaXMubW9kZWwuZ2V0KCdjaGF0cm9vbScpKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gY29tcG9zaW5nIGRhdGEgaXMgb25seSBmb3Igc2luZ2xlIHVzZXIgY2hhdAogICAgICAgICAgICAgICAgICAgIGNvbXBvc2luZyA9IHRoaXMuJGVsLmRhdGEoJ2NvbXBvc2luZycpOwogICAgICAgICAgICAgICAgICAgIGlmICghY29tcG9zaW5nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChldi5rZXlDb2RlICE9IDQ3KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBXZSBkb24ndCBzZW5kIGNvbXBvc2luZyBtZXNzYWdlcyBpZiB0aGUgbWVzc2FnZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gc3RhcnRzIHdpdGggZm9yd2FyZC1zbGFzaC4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vdGlmeSA9ICRtc2coeyd0byc6dGhpcy5tb2RlbC5nZXQoJ2ppZCcpLCAndHlwZSc6ICdjaGF0J30pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmMoJ2NvbXBvc2luZycsIHsneG1sbnMnOidodHRwOi8vamFiYmVyLm9yZy9wcm90b2NvbC9jaGF0c3RhdGVzJ30pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udmVyc2UuY29ubmVjdGlvbi5zZW5kKG5vdGlmeSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kZWwuZGF0YSgnY29tcG9zaW5nJywgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgb25EcmFnUmVzaXplU3RhcnQ6IGZ1bmN0aW9uIChldikgewogICAgICAgICAgICAgICAgaWYgKCFjb252ZXJzZS5hbGxvd19kcmFncmVzaXplKSB7IHJldHVybiB0cnVlOyB9CiAgICAgICAgICAgICAgICAvLyBSZWNvcmQgZWxlbWVudCBhdHRyaWJ1dGVzIGZvciBtb3VzZU1vdmUoKS4KICAgICAgICAgICAgICAgIHRoaXMuaGVpZ2h0ID0gdGhpcy4kZWwuY2hpbGRyZW4oJy5ib3gtZmx5b3V0JykuaGVpZ2h0KCk7CiAgICAgICAgICAgICAgICBjb252ZXJzZS5yZXNpemVkX2NoYXRib3ggPSB0aGlzOwogICAgICAgICAgICAgICAgdGhpcy5wcmV2X3BhZ2VZID0gZXYucGFnZVk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBzZXRDaGF0Qm94SGVpZ2h0OiBmdW5jdGlvbiAoaGVpZ2h0KSB7CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMubW9kZWwuZ2V0KCdtaW5pbWl6ZWQnKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuJGVsLmNoaWxkcmVuKCcuYm94LWZseW91dCcpWzBdLnN0eWxlLmhlaWdodCA9IGNvbnZlcnNlLmFwcGx5SGVpZ2h0UmVzaXN0YW5jZShoZWlnaHQpKydweCc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICByZXNpemVDaGF0Qm94OiBmdW5jdGlvbiAoZXYpIHsKICAgICAgICAgICAgICAgIHZhciBkaWZmID0gZXYucGFnZVkgLSB0aGlzLnByZXZfcGFnZVk7CiAgICAgICAgICAgICAgICBpZiAoIWRpZmYpIHsgcmV0dXJuOyB9CiAgICAgICAgICAgICAgICB0aGlzLmhlaWdodCAtPSBkaWZmOwogICAgICAgICAgICAgICAgdGhpcy5wcmV2X3BhZ2VZID0gZXYucGFnZVk7CiAgICAgICAgICAgICAgICB0aGlzLnNldENoYXRCb3hIZWlnaHQodGhpcy5oZWlnaHQpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgY2xlYXJNZXNzYWdlczogZnVuY3Rpb24gKGV2KSB7CiAgICAgICAgICAgICAgICBpZiAoZXYgJiYgZXYucHJldmVudERlZmF1bHQpIHsgZXYucHJldmVudERlZmF1bHQoKTsgfQogICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IGNvbmZpcm0oX18oIkFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBjbGVhciB0aGUgbWVzc2FnZXMgZnJvbSB0aGlzIGNoYXQgYm94PyIpKTsKICAgICAgICAgICAgICAgIGlmIChyZXN1bHQgPT09IHRydWUpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbC5maW5kKCcuY2hhdC1jb250ZW50JykuZW1wdHkoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLm1lc3NhZ2VzLnJlc2V0KCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5tZXNzYWdlcy5icm93c2VyU3RvcmFnZS5fY2xlYXIoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgaW5zZXJ0RW1vdGljb246IGZ1bmN0aW9uIChldikgewogICAgICAgICAgICAgICAgZXYuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgICAgICAgICB0aGlzLiRlbC5maW5kKCcudG9nZ2xlLXNtaWxleSB1bCcpLnNsaWRlVG9nZ2xlKDIwMCk7CiAgICAgICAgICAgICAgICB2YXIgJHRleHRib3ggPSB0aGlzLiRlbC5maW5kKCd0ZXh0YXJlYS5jaGF0LXRleHRhcmVhJyk7CiAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSAkdGV4dGJveC52YWwoKTsKICAgICAgICAgICAgICAgIHZhciAkdGFyZ2V0ID0gJChldi50YXJnZXQpOwogICAgICAgICAgICAgICAgJHRhcmdldCA9ICR0YXJnZXQuaXMoJ2EnKSA/ICR0YXJnZXQgOiAkdGFyZ2V0LmNoaWxkcmVuKCdhJyk7CiAgICAgICAgICAgICAgICBpZiAodmFsdWUgJiYgKHZhbHVlW3ZhbHVlLmxlbmd0aC0xXSAhPT0gJyAnKSkgewogICAgICAgICAgICAgICAgICAgIHZhbHVlID0gdmFsdWUgKyAnICc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkdGV4dGJveC5mb2N1cygpLnZhbCh2YWx1ZSskdGFyZ2V0LmRhdGEoJ2Vtb3RpY29uJykrJyAnKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHRvZ2dsZUVtb3RpY29uTWVudTogZnVuY3Rpb24gKGV2KSB7CiAgICAgICAgICAgICAgICBldi5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgICAgIHRoaXMuJGVsLmZpbmQoJy50b2dnbGUtc21pbGV5IHVsJykuc2xpZGVUb2dnbGUoMjAwKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHRvZ2dsZU9UUk1lbnU6IGZ1bmN0aW9uIChldikgewogICAgICAgICAgICAgICAgZXYuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgICAgICAgICB0aGlzLiRlbC5maW5kKCcudG9nZ2xlLW90ciB1bCcpLnNsaWRlVG9nZ2xlKDIwMCk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBzaG93T1RSRXJyb3I6IGZ1bmN0aW9uIChtc2cpIHsKICAgICAgICAgICAgICAgIGlmIChtc2cgPT0gJ01lc3NhZ2UgY2Fubm90IGJlIHNlbnQgYXQgdGhpcyB0aW1lLicpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dIZWxwTWVzc2FnZXMoCiAgICAgICAgICAgICAgICAgICAgICAgIFtfXygnWW91ciBtZXNzYWdlIGNvdWxkIG5vdCBiZSBzZW50JyldLCAnZXJyb3InKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobXNnID09ICdSZWNlaXZlZCBhbiB1bmVuY3J5cHRlZCBtZXNzYWdlLicpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dIZWxwTWVzc2FnZXMoCiAgICAgICAgICAgICAgICAgICAgICAgIFtfXygnV2UgcmVjZWl2ZWQgYW4gdW5lbmNyeXB0ZWQgbWVzc2FnZScpXSwgJ2Vycm9yJyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG1zZyA9PSAnUmVjZWl2ZWQgYW4gdW5yZWFkYWJsZSBlbmNyeXB0ZWQgbWVzc2FnZS4nKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93SGVscE1lc3NhZ2VzKAogICAgICAgICAgICAgICAgICAgICAgICBbX18oJ1dlIHJlY2VpdmVkIGFuIHVucmVhZGFibGUgZW5jcnlwdGVkIG1lc3NhZ2UnKV0sCiAgICAgICAgICAgICAgICAgICAgICAgICdlcnJvcicpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dIZWxwTWVzc2FnZXMoWydFbmNyeXB0aW9uIGVycm9yIG9jY3VyZWQ6ICcrbXNnXSwgJ2Vycm9yJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiT1RSIEVSUk9SOiIrbXNnKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGJ1ZGR5U3RhcnRzT1RSOiBmdW5jdGlvbiAoZXYpIHsKICAgICAgICAgICAgICAgIHRoaXMuc2hvd0hlbHBNZXNzYWdlcyhbX18oJ1RoaXMgdXNlciBoYXMgcmVxdWVzdGVkIGFuIGVuY3J5cHRlZCBzZXNzaW9uLicpXSk7CiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLmluaXRpYXRlT1RSKCk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBzdGFydE9UUkZyb21Ub29sYmFyOiBmdW5jdGlvbiAoZXYpIHsKICAgICAgICAgICAgICAgICQoZXYudGFyZ2V0KS5wYXJlbnQoKS5wYXJlbnQoKS5zbGlkZVVwKCk7CiAgICAgICAgICAgICAgICBldi5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuaW5pdGlhdGVPVFIoKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGVuZE9UUjogZnVuY3Rpb24gKGV2KSB7CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGV2ICE9PSAidW5kZWZpbmVkIikgewogICAgICAgICAgICAgICAgICAgIGV2LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgZXYuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLmVuZE9UUigpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgYXV0aE9UUjogZnVuY3Rpb24gKGV2KSB7CiAgICAgICAgICAgICAgICB2YXIgc2NoZW1lID0gJChldi50YXJnZXQpLmRhdGEoKS5zY2hlbWU7CiAgICAgICAgICAgICAgICB2YXIgcmVzdWx0LCBxdWVzdGlvbiwgYW5zd2VyOwogICAgICAgICAgICAgICAgaWYgKHNjaGVtZSA9PT0gJ2ZpbmdlcnByaW50JykgewogICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IGNvbmZpcm0oX18oJ0hlcmUgYXJlIHRoZSBmaW5nZXJwcmludHMsIHBsZWFzZSBjb25maXJtIHRoZW0gd2l0aCAlMSRzLCBvdXRzaWRlIG9mIHRoaXMgY2hhdC5cblxuRmluZ2VycHJpbnQgZm9yIHlvdSwgJTIkczogJTMkc1xuXG5GaW5nZXJwcmludCBmb3IgJTEkczogJTQkc1xuXG5JZiB5b3UgaGF2ZSBjb25maXJtZWQgdGhhdCB0aGUgZmluZ2VycHJpbnRzIG1hdGNoLCBjbGljayBPSywgb3RoZXJ3aXNlIGNsaWNrIENhbmNlbC4nLCBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLmdldCgnZnVsbG5hbWUnKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLnhtcHBzdGF0dXMuZ2V0KCdmdWxsbmFtZScpfHxjb252ZXJzZS5iYXJlX2ppZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW9kZWwub3RyLnByaXYuZmluZ2VycHJpbnQoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW9kZWwub3RyLnRoZWlyX3ByaXZfcGsuZmluZ2VycHJpbnQoKQogICAgICAgICAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICAgICAgICAgKSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdCA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLnNhdmUoeydvdHJfc3RhdHVzJzogVkVSSUZJRUR9KTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLnNhdmUoeydvdHJfc3RhdHVzJzogVU5WRVJJRklFRH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc2NoZW1lID09PSAnc21wJykgewogICAgICAgICAgICAgICAgICAgIGFsZXJ0KF9fKCdZb3Ugd2lsbCBiZSBwcm9tcHRlZCB0byBwcm92aWRlIGEgc2VjdXJpdHkgcXVlc3Rpb24gYW5kIHRoZW4gYW4gYW5zd2VyIHRvIHRoYXQgcXVlc3Rpb24uXG5cbllvdXIgYnVkZHkgd2lsbCB0aGVuIGJlIHByb21wdGVkIHRoZSBzYW1lIHF1ZXN0aW9uIGFuZCBpZiB0aGV5IHR5cGUgdGhlIGV4YWN0IHNhbWUgYW5zd2VyIChjYXNlIHNlbnNpdGl2ZSksIHRoZWlyIGlkZW50aXR5IHdpbGwgYmUgdmVyaWZpZWQuJykpOwogICAgICAgICAgICAgICAgICAgIHF1ZXN0aW9uID0gcHJvbXB0KF9fKCdXaGF0IGlzIHlvdXIgc2VjdXJpdHkgcXVlc3Rpb24/JykpOwogICAgICAgICAgICAgICAgICAgIGlmIChxdWVzdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgICBhbnN3ZXIgPSBwcm9tcHQoX18oJ1doYXQgaXMgdGhlIGFuc3dlciB0byB0aGUgc2VjdXJpdHkgcXVlc3Rpb24/JykpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLm90ci5zbXBTZWNyZXQoYW5zd2VyLCBxdWVzdGlvbik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dIZWxwTWVzc2FnZXMoW19fKCdJbnZhbGlkIGF1dGhlbnRpY2F0aW9uIHNjaGVtZSBwcm92aWRlZCcpXSwgJ2Vycm9yJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICB0b2dnbGVDYWxsOiBmdW5jdGlvbiAoZXYpIHsKICAgICAgICAgICAgICAgIGV2LnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgICAgICAgICAgY29udmVyc2UuZW1pdCgnY2FsbEJ1dHRvbkNsaWNrZWQnLCB7CiAgICAgICAgICAgICAgICAgICAgY29ubmVjdGlvbjogY29udmVyc2UuY29ubmVjdGlvbiwKICAgICAgICAgICAgICAgICAgICBtb2RlbDogdGhpcy5tb2RlbAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBvbkNoYW5nZTogZnVuY3Rpb24gKGl0ZW0sIGNoYW5nZWQpIHsKICAgICAgICAgICAgICAgIGlmIChfLmhhcyhpdGVtLmNoYW5nZWQsICdjaGF0X3N0YXR1cycpKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGNoYXRfc3RhdHVzID0gaXRlbS5nZXQoJ2NoYXRfc3RhdHVzJyksCiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGxuYW1lID0gaXRlbS5nZXQoJ2Z1bGxuYW1lJyk7CiAgICAgICAgICAgICAgICAgICAgZnVsbG5hbWUgPSBfLmlzRW1wdHkoZnVsbG5hbWUpPyBpdGVtLmdldCgnamlkJyk6IGZ1bGxuYW1lOwogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLiRlbC5pcygnOnZpc2libGUnKSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2hhdF9zdGF0dXMgPT09ICdvZmZsaW5lJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93U3RhdHVzTm90aWZpY2F0aW9uKGZ1bGxuYW1lKycgJysnaGFzIGdvbmUgb2ZmbGluZScpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNoYXRfc3RhdHVzID09PSAnYXdheScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd1N0YXR1c05vdGlmaWNhdGlvbihmdWxsbmFtZSsnICcrJ2hhcyBnb25lIGF3YXknKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICgoY2hhdF9zdGF0dXMgPT09ICdkbmQnKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93U3RhdHVzTm90aWZpY2F0aW9uKGZ1bGxuYW1lKycgJysnaXMgYnVzeScpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNoYXRfc3RhdHVzID09PSAnb25saW5lJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kZWwuZmluZCgnZGl2LmNoYXQtZXZlbnQnKS5yZW1vdmUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS5lbWl0KCdidWRkeVN0YXR1c0NoYW5nZWQnLCBpdGVtLmF0dHJpYnV0ZXMsIGl0ZW0uZ2V0KCdjaGF0X3N0YXR1cycpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChfLmhhcyhpdGVtLmNoYW5nZWQsICdzdGF0dXMnKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd1N0YXR1c01lc3NhZ2UoKTsKICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS5lbWl0KCdidWRkeVN0YXR1c01lc3NhZ2VDaGFuZ2VkJywgaXRlbS5hdHRyaWJ1dGVzLCBpdGVtLmdldCgnc3RhdHVzJykpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKF8uaGFzKGl0ZW0uY2hhbmdlZCwgJ2ltYWdlJykpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbmRlckF2YXRhcigpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKF8uaGFzKGl0ZW0uY2hhbmdlZCwgJ290cl9zdGF0dXMnKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyVG9vbGJhcigpLmluZm9ybU9UUkNoYW5nZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKF8uaGFzKGl0ZW0uY2hhbmdlZCwgJ21pbmltaXplZCcpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uZ2V0KCdtaW5pbWl6ZWQnKSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmhpZGUoKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1heGltaXplKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy8gVE9ETyBjaGVjayBmb3IgY2hhbmdlZCBmdWxsbmFtZSBhcyB3ZWxsCiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBzaG93U3RhdHVzTWVzc2FnZTogZnVuY3Rpb24gKG1zZykgewogICAgICAgICAgICAgICAgbXNnID0gbXNnIHx8IHRoaXMubW9kZWwuZ2V0KCdzdGF0dXMnKTsKICAgICAgICAgICAgICAgIGlmIChtc2cpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbC5maW5kKCdwLnVzZXItY3VzdG9tLW1lc3NhZ2UnKS50ZXh0KG1zZykuYXR0cigndGl0bGUnLCBtc2cpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBjbG9zZTogZnVuY3Rpb24gKGV2KSB7CiAgICAgICAgICAgICAgICBpZiAoZXYgJiYgZXYucHJldmVudERlZmF1bHQpIHsgZXYucHJldmVudERlZmF1bHQoKTsgfQogICAgICAgICAgICAgICAgaWYgKGNvbnZlcnNlLmNvbm5lY3Rpb24uY29ubmVjdGVkKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5kZXN0cm95KCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRoaXMubW9kZWwudHJpZ2dlcignaGlkZScpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY29udmVyc2UuZW1pdCgnY2hhdEJveENsb3NlZCcsIHRoaXMpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBtYXhpbWl6ZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgLy8gUmVzdG9yZXMgYSBtaW5pbWl6ZWQgY2hhdCBib3gKICAgICAgICAgICAgICAgIHRoaXMuJGVsLmluc2VydEFmdGVyKGNvbnZlcnNlLmNoYXRib3h2aWV3cy5nZXQoImNvbnRyb2xib3giKS4kZWwpLnNob3coJ2Zhc3QnLCAkLnByb3h5KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS5yZWZyZXNoV2Via2l0KCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5mb2N1cygpOwogICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLmVtaXQoJ2NoYXRCb3hNYXhpbWl6ZWQnLCB0aGlzKTsKICAgICAgICAgICAgICAgIH0sIHRoaXMpKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIG1pbmltaXplOiBmdW5jdGlvbiAoZXYpIHsKICAgICAgICAgICAgICAgIGlmIChldiAmJiBldi5wcmV2ZW50RGVmYXVsdCkgeyBldi5wcmV2ZW50RGVmYXVsdCgpOyB9CiAgICAgICAgICAgICAgICAvLyBNaW5pbWl6ZXMgYSBjaGF0IGJveAogICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5taW5pbWl6ZSgpOwogICAgICAgICAgICAgICAgdGhpcy4kZWwuaGlkZSgnZmFzdCcsIGNvbnZlcnNlLnJlZnJlc2h3ZWJraXQpOwogICAgICAgICAgICAgICAgY29udmVyc2UuZW1pdCgnY2hhdEJveE1pbmltaXplZCcsIHRoaXMpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgdXBkYXRlVkNhcmQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBqaWQgPSB0aGlzLm1vZGVsLmdldCgnamlkJyksCiAgICAgICAgICAgICAgICAgICAgY29udGFjdCA9IGNvbnZlcnNlLnJvc3Rlci5nZXQoamlkKTsKICAgICAgICAgICAgICAgIGlmICgoY29udGFjdCkgJiYgKCFjb250YWN0LmdldCgndmNhcmRfdXBkYXRlZCcpKSkgewogICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLmdldFZDYXJkKAogICAgICAgICAgICAgICAgICAgICAgICBqaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICQucHJveHkoZnVuY3Rpb24gKGppZCwgZnVsbG5hbWUsIGltYWdlLCBpbWFnZV90eXBlLCB1cmwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuc2F2ZSh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Z1bGxuYW1lJyA6IGZ1bGxuYW1lIHx8IGppZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAndXJsJzogdXJsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdpbWFnZV90eXBlJzogaW1hZ2VfdHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnaW1hZ2UnOiBpbWFnZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0sIHRoaXMpLAogICAgICAgICAgICAgICAgICAgICAgICAkLnByb3h5KGZ1bmN0aW9uIChzdGFuemEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLmxvZygiQ2hhdEJveFZpZXcuaW5pdGlhbGl6ZTogQW4gZXJyb3Igb2NjdXJlZCB3aGlsZSBmZXRjaGluZyB2Y2FyZCIpOwogICAgICAgICAgICAgICAgICAgICAgICB9LCB0aGlzKQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBpbmZvcm1PVFJDaGFuZ2U6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBkYXRhID0gdGhpcy5tb2RlbC50b0pTT04oKTsKICAgICAgICAgICAgICAgIHZhciBtc2dzID0gW107CiAgICAgICAgICAgICAgICBpZiAoZGF0YS5vdHJfc3RhdHVzID09IFVORU5DUllQVEVEKSB7CiAgICAgICAgICAgICAgICAgICAgbXNncy5wdXNoKF9fKCJZb3VyIG1lc3NhZ2VzIGFyZSBub3QgZW5jcnlwdGVkIGFueW1vcmUiKSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGRhdGEub3RyX3N0YXR1cyA9PSBVTlZFUklGSUVEKXsKICAgICAgICAgICAgICAgICAgICBtc2dzLnB1c2goX18oIllvdXIgbWVzc2FnZXMgYXJlIG5vdyBlbmNyeXB0ZWQgYnV0IHlvdXIgYnVkZHkncyBpZGVudGl0eSBoYXMgbm90IGJlZW4gdmVyaWZpZWQuIikpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChkYXRhLm90cl9zdGF0dXMgPT0gVkVSSUZJRUQpewogICAgICAgICAgICAgICAgICAgIG1zZ3MucHVzaChfXygiWW91ciBidWRkeSdzIGlkZW50aWZ5IGhhcyBiZWVuIHZlcmlmaWVkLiIpKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZGF0YS5vdHJfc3RhdHVzID09IEZJTklTSEVEKXsKICAgICAgICAgICAgICAgICAgICBtc2dzLnB1c2goX18oIllvdXIgYnVkZHkgaGFzIGVuZGVkIGVuY3J5cHRpb24gb24gdGhlaXIgZW5kLCB5b3Ugc2hvdWxkIGRvIHRoZSBzYW1lLiIpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNob3dIZWxwTWVzc2FnZXMobXNncywgJ2luZm8nLCBmYWxzZSk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICByZW5kZXJUb29sYmFyOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBpZiAoY29udmVyc2Uuc2hvd190b29sYmFyKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGEgPSB0aGlzLm1vZGVsLnRvSlNPTigpOwogICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLm90cl9zdGF0dXMgPT0gVU5FTkNSWVBURUQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5vdHJfdG9vbHRpcCA9IF9fKCdZb3VyIG1lc3NhZ2VzIGFyZSBub3QgZW5jcnlwdGVkLiBDbGljayBoZXJlIHRvIGVuYWJsZSBPVFIgZW5jcnlwdGlvbi4nKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGRhdGEub3RyX3N0YXR1cyA9PSBVTlZFUklGSUVEKXsKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5vdHJfdG9vbHRpcCA9IF9fKCdZb3VyIG1lc3NhZ2VzIGFyZSBlbmNyeXB0ZWQsIGJ1dCB5b3VyIGJ1ZGR5IGhhcyBub3QgYmVlbiB2ZXJpZmllZC4nKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGRhdGEub3RyX3N0YXR1cyA9PSBWRVJJRklFRCl7CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEub3RyX3Rvb2x0aXAgPSBfXygnWW91ciBtZXNzYWdlcyBhcmUgZW5jcnlwdGVkIGFuZCB5b3VyIGJ1ZGR5IHZlcmlmaWVkLicpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZGF0YS5vdHJfc3RhdHVzID09IEZJTklTSEVEKXsKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5vdHJfdG9vbHRpcCA9IF9fKCdZb3VyIGJ1ZGR5IGhhcyBjbG9zZWQgdGhlaXIgZW5kIG9mIHRoZSBwcml2YXRlIHNlc3Npb24sIHlvdSBzaG91bGQgZG8gdGhlIHNhbWUnKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kZWwuZmluZCgnLmNoYXQtdG9vbGJhcicpLmh0bWwoCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLnRlbXBsYXRlcy50b29sYmFyKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgXy5leHRlbmQoZGF0YSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZJTklTSEVEOiBGSU5JU0hFRCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBVTkVOQ1JZUFRFRDogVU5FTkNSWVBURUQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVU5WRVJJRklFRDogVU5WRVJJRklFRCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBWRVJJRklFRDogVkVSSUZJRUQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxsb3dfb3RyOiBjb252ZXJzZS5hbGxvd19vdHIgJiYgIXRoaXMuaXNfY2hhdHJvb20sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWxfY2xlYXI6IF9fKCdDbGVhciBhbGwgbWVzc2FnZXMnKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbF9lbmRfZW5jcnlwdGVkX2NvbnZlcnNhdGlvbjogX18oJ0VuZCBlbmNyeXB0ZWQgY29udmVyc2F0aW9uJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWxfaGlkZV9wYXJ0aWNpcGFudHM6IF9fKCdIaWRlIHRoZSBsaXN0IG9mIHBhcnRpY2lwYW50cycpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsX3JlZnJlc2hfZW5jcnlwdGVkX2NvbnZlcnNhdGlvbjogX18oJ1JlZnJlc2ggZW5jcnlwdGVkIGNvbnZlcnNhdGlvbicpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsX3N0YXJ0X2NhbGw6IF9fKCdTdGFydCBhIGNhbGwnKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbF9zdGFydF9lbmNyeXB0ZWRfY29udmVyc2F0aW9uOiBfXygnU3RhcnQgZW5jcnlwdGVkIGNvbnZlcnNhdGlvbicpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsX3ZlcmlmeV93aXRoX2ZpbmdlcnByaW50czogX18oJ1ZlcmlmeSB3aXRoIGZpbmdlcnByaW50cycpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsX3ZlcmlmeV93aXRoX3NtcDogX18oJ1ZlcmlmeSB3aXRoIFNNUCcpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsX3doYXRzX3RoaXM6IF9fKCJXaGF0XCdzIHRoaXM/IiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3RyX3N0YXR1c19jbGFzczogT1RSX0NMQVNTX01BUFBJTkdbZGF0YS5vdHJfc3RhdHVzXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdHJfdHJhbnNsYXRlZF9zdGF0dXM6IE9UUl9UUkFOU0xBVEVEX01BUFBJTkdbZGF0YS5vdHJfc3RhdHVzXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG93X2NhbGxfYnV0dG9uOiBjb252ZXJzZS52aXNpYmxlX3Rvb2xiYXJfYnV0dG9ucy5jYWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3dfY2xlYXJfYnV0dG9uOiBjb252ZXJzZS52aXNpYmxlX3Rvb2xiYXJfYnV0dG9ucy5jbGVhciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG93X2Vtb3RpY29uczogY29udmVyc2UudmlzaWJsZV90b29sYmFyX2J1dHRvbnMuZW1vdGljb25zLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3dfcGFydGljaXBhbnRzX3RvZ2dsZTogdGhpcy5pc19jaGF0cm9vbSAmJiBjb252ZXJzZS52aXNpYmxlX3Rvb2xiYXJfYnV0dG9ucy50b2dnbGVfcGFydGljaXBhbnRzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgcmVuZGVyQXZhdGFyOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMubW9kZWwuZ2V0KCdpbWFnZScpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdmFyIGltZ19zcmMgPSAnZGF0YTonK3RoaXMubW9kZWwuZ2V0KCdpbWFnZV90eXBlJykrJztiYXNlNjQsJyt0aGlzLm1vZGVsLmdldCgnaW1hZ2UnKSwKICAgICAgICAgICAgICAgICAgICBjYW52YXMgPSAkKCc8Y2FudmFzIGhlaWdodD0iMzFweCIgd2lkdGg9IjMxcHgiIGNsYXNzPSJhdmF0YXIiPjwvY2FudmFzPicpLmdldCgwKTsKCiAgICAgICAgICAgICAgICBpZiAoIShjYW52YXMuZ2V0Q29udGV4dCAmJiBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKSkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHZhciBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICAgICAgICAgIHZhciBpbWcgPSBuZXcgSW1hZ2UoKTsgICAvLyBDcmVhdGUgbmV3IEltYWdlIG9iamVjdAogICAgICAgICAgICAgICAgaW1nLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgcmF0aW8gPSBpbWcud2lkdGgvaW1nLmhlaWdodDsKICAgICAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKGltZywgMCwwLCAzNSpyYXRpbywgMzUpOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIGltZy5zcmMgPSBpbWdfc3JjOwogICAgICAgICAgICAgICAgdGhpcy4kZWwuZmluZCgnLmNoYXQtdGl0bGUnKS5iZWZvcmUoY2FudmFzKTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgZm9jdXM6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHRoaXMuJGVsLmZpbmQoJy5jaGF0LXRleHRhcmVhJykuZm9jdXMoKTsKICAgICAgICAgICAgICAgIGNvbnZlcnNlLmVtaXQoJ2NoYXRCb3hGb2N1c2VkJywgdGhpcyk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGhpZGU6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLiRlbC5pcygnOnZpc2libGUnKSAmJiB0aGlzLiRlbC5jc3MoJ29wYWNpdHknKSA9PSAiMSIpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbC5oaWRlKCk7CiAgICAgICAgICAgICAgICAgICAgY29udmVyc2UucmVmcmVzaFdlYmtpdCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBzaG93OiBmdW5jdGlvbiAoY2FsbGJhY2spIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLiRlbC5pcygnOnZpc2libGUnKSAmJiB0aGlzLiRlbC5jc3MoJ29wYWNpdHknKSA9PSAiMSIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5mb2N1cygpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy4kZWwuZmFkZUluKGNhbGxiYWNrKTsKICAgICAgICAgICAgICAgIGlmIChjb252ZXJzZS5jb25uZWN0aW9uLmNvbm5lY3RlZCkgewogICAgICAgICAgICAgICAgICAgIC8vIFdpdGhvdXQgYSBjb25uZWN0aW9uLCB3ZSBoYXZlbid0IHlldCBpbml0aWFsaXplZAogICAgICAgICAgICAgICAgICAgIC8vIGxvY2Fsc3RvcmFnZQogICAgICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuc2F2ZSgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuaW5pdERyYWdSZXNpemUoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgc2Nyb2xsRG93bjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyICRjb250ZW50ID0gdGhpcy4kKCcuY2hhdC1jb250ZW50Jyk7CiAgICAgICAgICAgICAgICBpZiAoJGNvbnRlbnQuaXMoJzp2aXNpYmxlJykpIHsKICAgICAgICAgICAgICAgICAgICAkY29udGVudC5zY3JvbGxUb3AoJGNvbnRlbnRbMF0uc2Nyb2xsSGVpZ2h0KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIHRoaXMuQ29udGFjdHNQYW5lbCA9IEJhY2tib25lLlZpZXcuZXh0ZW5kKHsKICAgICAgICAgICAgdGFnTmFtZTogJ2RpdicsCiAgICAgICAgICAgIGNsYXNzTmFtZTogJ2NvbnRyb2xib3gtcGFuZScsCiAgICAgICAgICAgIGlkOiAndXNlcnMnLAogICAgICAgICAgICBldmVudHM6IHsKICAgICAgICAgICAgICAgICdjbGljayBhLnRvZ2dsZS14bXBwLWNvbnRhY3QtZm9ybSc6ICd0b2dnbGVDb250YWN0Rm9ybScsCiAgICAgICAgICAgICAgICAnc3VibWl0IGZvcm0uYWRkLXhtcHAtY29udGFjdCc6ICdhZGRDb250YWN0RnJvbUZvcm0nLAogICAgICAgICAgICAgICAgJ3N1Ym1pdCBmb3JtLnNlYXJjaC14bXBwLWNvbnRhY3QnOiAnc2VhcmNoQ29udGFjdHMnLAogICAgICAgICAgICAgICAgJ2NsaWNrIGEuc3Vic2NyaWJlLXRvLXVzZXInOiAnYWRkQ29udGFjdEZyb21MaXN0JwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKGNmZykgewogICAgICAgICAgICAgICAgY2ZnLiRwYXJlbnQuYXBwZW5kKHRoaXMuJGVsKTsKICAgICAgICAgICAgICAgIHRoaXMuJHRhYnMgPSBjZmcuJHBhcmVudC5wYXJlbnQoKS5maW5kKCcjY29udHJvbGJveC10YWJzJyk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICByZW5kZXI6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBtYXJrdXA7CiAgICAgICAgICAgICAgICB2YXIgd2lkZ2V0cyA9IGNvbnZlcnNlLnRlbXBsYXRlcy5jb250YWN0c19wYW5lbCh7CiAgICAgICAgICAgICAgICAgICAgbGFiZWxfb25saW5lOiBfXygnT25saW5lJyksCiAgICAgICAgICAgICAgICAgICAgbGFiZWxfYnVzeTogX18oJ0J1c3knKSwKICAgICAgICAgICAgICAgICAgICBsYWJlbF9hd2F5OiBfXygnQXdheScpLAogICAgICAgICAgICAgICAgICAgIGxhYmVsX29mZmxpbmU6IF9fKCdPZmZsaW5lJyksCiAgICAgICAgICAgICAgICAgICAgbGFiZWxfbG9nb3V0OiBfXygnTG9nIG91dCcpLAogICAgICAgICAgICAgICAgICAgIGFsbG93X2xvZ291dDogY29udmVyc2UuYWxsb3dfbG9nb3V0CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHRoaXMuJHRhYnMuYXBwZW5kKGNvbnZlcnNlLnRlbXBsYXRlcy5jb250YWN0c190YWIoe2xhYmVsX2NvbnRhY3RzOiBMQUJFTF9DT05UQUNUU30pKTsKICAgICAgICAgICAgICAgIGlmIChjb252ZXJzZS54aHJfdXNlcl9zZWFyY2gpIHsKICAgICAgICAgICAgICAgICAgICBtYXJrdXAgPSBjb252ZXJzZS50ZW1wbGF0ZXMuc2VhcmNoX2NvbnRhY3QoewogICAgICAgICAgICAgICAgICAgICAgICBsYWJlbF9jb250YWN0X25hbWU6IF9fKCdDb250YWN0IG5hbWUnKSwKICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWxfc2VhcmNoOiBfXygnU2VhcmNoJykKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbWFya3VwID0gY29udmVyc2UudGVtcGxhdGVzLmFkZF9jb250YWN0X2Zvcm0oewogICAgICAgICAgICAgICAgICAgICAgICBsYWJlbF9jb250YWN0X3VzZXJuYW1lOiBfXygnQ29udGFjdCB1c2VybmFtZScpLAogICAgICAgICAgICAgICAgICAgICAgICBsYWJlbF9hZGQ6IF9fKCdBZGQnKQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGNvbnZlcnNlLmFsbG93X2NvbnRhY3RfcmVxdWVzdHMpIHsKICAgICAgICAgICAgICAgICAgICB3aWRnZXRzICs9IGNvbnZlcnNlLnRlbXBsYXRlcy5hZGRfY29udGFjdF9kcm9wZG93bih7CiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsX2NsaWNrX3RvX2NoYXQ6IF9fKCdDbGljayB0byBhZGQgbmV3IGNoYXQgY29udGFjdHMnKSwKICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWxfYWRkX2NvbnRhY3Q6IF9fKCdBZGQgYSBjb250YWN0JykKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuJGVsLmh0bWwod2lkZ2V0cyk7CiAgICAgICAgICAgICAgICB0aGlzLiRlbC5maW5kKCcuc2VhcmNoLXhtcHAgdWwnKS5hcHBlbmQobWFya3VwKTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgdG9nZ2xlQ29udGFjdEZvcm06IGZ1bmN0aW9uIChldikgewogICAgICAgICAgICAgICAgZXYucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgIHRoaXMuJGVsLmZpbmQoJy5zZWFyY2gteG1wcCcpLnRvZ2dsZSgnZmFzdCcsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoJCh0aGlzKS5pcygnOnZpc2libGUnKSkgewogICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmZpbmQoJ2lucHV0LnVzZXJuYW1lJykuZm9jdXMoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHNlYXJjaENvbnRhY3RzOiBmdW5jdGlvbiAoZXYpIHsKICAgICAgICAgICAgICAgIGV2LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAkLmdldEpTT04oY29udmVyc2UueGhyX3VzZXJfc2VhcmNoX3VybCsgIj9xPSIgKyAkKGV2LnRhcmdldCkuZmluZCgnaW5wdXQudXNlcm5hbWUnKS52YWwoKSwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgJHVsPSAkKCcuc2VhcmNoLXhtcHAgdWwnKTsKICAgICAgICAgICAgICAgICAgICAkdWwuZmluZCgnbGkuZm91bmQtdXNlcicpLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgICAgICR1bC5maW5kKCdsaS5jaGF0LWluZm8nKS5yZW1vdmUoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoIWRhdGEubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICR1bC5hcHBlbmQoJzxsaSBjbGFzcz0iY2hhdC1pbmZvIj4nK19fKCdObyB1c2VycyBmb3VuZCcpKyc8L2xpPicpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAkKGRhdGEpLmVhY2goZnVuY3Rpb24gKGlkeCwgb2JqKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICR1bC5hcHBlbmQoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCc8bGkgY2xhc3M9ImZvdW5kLXVzZXIiPjwvbGk+JykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnPGEgY2xhc3M9InN1YnNjcmliZS10by11c2VyIiBocmVmPSIjIiB0aXRsZT0iJytfXygnQ2xpY2sgdG8gYWRkIGFzIGEgY2hhdCBjb250YWN0JykrJyI+PC9hPicpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoJ2RhdGEtcmVjaXBpZW50JywgU3Ryb3BoZS5lc2NhcGVOb2RlKG9iai5pZCkrJ0AnK2NvbnZlcnNlLmRvbWFpbikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGV4dChvYmouZnVsbG5hbWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGFkZENvbnRhY3RGcm9tRm9ybTogZnVuY3Rpb24gKGV2KSB7CiAgICAgICAgICAgICAgICBldi5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgdmFyICRpbnB1dCA9ICQoZXYudGFyZ2V0KS5maW5kKCdpbnB1dCcpOwogICAgICAgICAgICAgICAgdmFyIGppZCA9ICRpbnB1dC52YWwoKTsKICAgICAgICAgICAgICAgIGlmICghIGppZCkgewogICAgICAgICAgICAgICAgICAgIC8vIHRoaXMgaXMgbm90IGEgdmFsaWQgSklECiAgICAgICAgICAgICAgICAgICAgJGlucHV0LmFkZENsYXNzKCdlcnJvcicpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuYWRkQ29udGFjdChqaWQpOwogICAgICAgICAgICAgICAgJCgnLnNlYXJjaC14bXBwJykuaGlkZSgpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgYWRkQ29udGFjdEZyb21MaXN0OiBmdW5jdGlvbiAoZXYpIHsKICAgICAgICAgICAgICAgIGV2LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICB2YXIgJHRhcmdldCA9ICQoZXYudGFyZ2V0KSwKICAgICAgICAgICAgICAgICAgICBqaWQgPSAkdGFyZ2V0LmF0dHIoJ2RhdGEtcmVjaXBpZW50JyksCiAgICAgICAgICAgICAgICAgICAgbmFtZSA9ICR0YXJnZXQudGV4dCgpOwogICAgICAgICAgICAgICAgdGhpcy5hZGRDb250YWN0KGppZCwgbmFtZSk7CiAgICAgICAgICAgICAgICAkdGFyZ2V0LnBhcmVudCgpLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgJCgnLnNlYXJjaC14bXBwJykuaGlkZSgpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgYWRkQ29udGFjdDogZnVuY3Rpb24gKGppZCwgbmFtZSkgewogICAgICAgICAgICAgICAgbmFtZSA9IF8uaXNFbXB0eShuYW1lKT8gamlkOiBuYW1lOwogICAgICAgICAgICAgICAgY29udmVyc2UuY29ubmVjdGlvbi5yb3N0ZXIuYWRkKGppZCwgbmFtZSwgW10sIGZ1bmN0aW9uIChpcSkgewogICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLmNvbm5lY3Rpb24ucm9zdGVyLnN1YnNjcmliZShqaWQsIG51bGwsIGNvbnZlcnNlLnhtcHBzdGF0dXMuZ2V0KCdmdWxsbmFtZScpKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIHRoaXMuUm9vbXNQYW5lbCA9IEJhY2tib25lLlZpZXcuZXh0ZW5kKHsKICAgICAgICAgICAgdGFnTmFtZTogJ2RpdicsCiAgICAgICAgICAgIGlkOiAnY2hhdHJvb21zJywKICAgICAgICAgICAgZXZlbnRzOiB7CiAgICAgICAgICAgICAgICAnc3VibWl0IGZvcm0uYWRkLWNoYXRyb29tJzogJ2NyZWF0ZUNoYXRSb29tJywKICAgICAgICAgICAgICAgICdjbGljayBpbnB1dCNzaG93LXJvb21zJzogJ3Nob3dSb29tcycsCiAgICAgICAgICAgICAgICAnY2xpY2sgYS5vcGVuLXJvb20nOiAnY3JlYXRlQ2hhdFJvb20nLAogICAgICAgICAgICAgICAgJ2NsaWNrIGEucm9vbS1pbmZvJzogJ3Nob3dSb29tSW5mbycKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIChjZmcpIHsKICAgICAgICAgICAgICAgIGNmZy4kcGFyZW50LmFwcGVuZCgKICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbC5odG1sKAogICAgICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS50ZW1wbGF0ZXMucm9vbV9wYW5lbCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc2VydmVyX2lucHV0X3R5cGUnOiBjb252ZXJzZS5oaWRlX211Y19zZXJ2ZXIgJiYgJ2hpZGRlbicgfHwgJ3RleHQnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2xhYmVsX3Jvb21fbmFtZSc6IF9fKCdSb29tIG5hbWUnKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdsYWJlbF9uaWNrbmFtZSc6IF9fKCdOaWNrbmFtZScpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2xhYmVsX3NlcnZlcic6IF9fKCdTZXJ2ZXInKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdsYWJlbF9qb2luJzogX18oJ0pvaW4nKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdsYWJlbF9zaG93X3Jvb21zJzogX18oJ1Nob3cgcm9vbXMnKQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICkuaGlkZSgpKTsKICAgICAgICAgICAgICAgIHRoaXMuJHRhYnMgPSBjZmcuJHBhcmVudC5wYXJlbnQoKS5maW5kKCcjY29udHJvbGJveC10YWJzJyk7CgogICAgICAgICAgICAgICAgdGhpcy5vbigndXBkYXRlLXJvb21zLWxpc3QnLCBmdW5jdGlvbiAoZXYpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVJvb21zTGlzdCgpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBjb252ZXJzZS54bXBwc3RhdHVzLm9uKCJjaGFuZ2UiLCAkLnByb3h5KGZ1bmN0aW9uIChtb2RlbCkgewogICAgICAgICAgICAgICAgICAgIGlmICghKF8uaGFzKG1vZGVsLmNoYW5nZWQsICdmdWxsbmFtZScpKSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHZhciAkbmljayA9IHRoaXMuJGVsLmZpbmQoJ2lucHV0Lm5ldy1jaGF0cm9vbS1uaWNrJyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCEgJG5pY2suaXMoJzpmb2N1cycpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRuaWNrLnZhbChtb2RlbC5nZXQoJ2Z1bGxuYW1lJykpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sIHRoaXMpKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdGhpcy4kdGFicy5hcHBlbmQoY29udmVyc2UudGVtcGxhdGVzLmNoYXRyb29tc190YWIoe2xhYmVsX3Jvb21zOiBfXygnUm9vbXMnKX0pKTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgaW5mb3JtTm9Sb29tc0ZvdW5kOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB2YXIgJGF2YWlsYWJsZV9jaGF0cm9vbXMgPSB0aGlzLiRlbC5maW5kKCcjYXZhaWxhYmxlLWNoYXRyb29tcycpOwogICAgICAgICAgICAgICAgLy8gIyBGb3IgdHJhbnNsYXRvcnM6ICUxJHMgaXMgYSB2YXJpYWJsZSBhbmQgd2lsbCBiZSByZXBsYWNlZCB3aXRoIHRoZSBYTVBQIHNlcnZlciBuYW1lCiAgICAgICAgICAgICAgICAkYXZhaWxhYmxlX2NoYXRyb29tcy5odG1sKCc8ZHQ+JytfXygnTm8gcm9vbXMgb24gJTEkcycsdGhpcy5tdWNfZG9tYWluKSsnPC9kdD4nKTsKICAgICAgICAgICAgICAgICQoJ2lucHV0I3Nob3ctcm9vbXMnKS5zaG93KCkuc2libGluZ3MoJ3NwYW4uc3Bpbm5lcicpLnJlbW92ZSgpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgdXBkYXRlUm9vbXNMaXN0OiBmdW5jdGlvbiAoZG9tYWluKSB7CiAgICAgICAgICAgICAgICBjb252ZXJzZS5jb25uZWN0aW9uLm11Yy5saXN0Um9vbXMoCiAgICAgICAgICAgICAgICAgICAgdGhpcy5tdWNfZG9tYWluLAogICAgICAgICAgICAgICAgICAgICQucHJveHkoZnVuY3Rpb24gKGlxKSB7IC8vIFN1Y2Nlc3MKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG5hbWUsIGppZCwgaSwgZnJhZ21lbnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGF0ID0gdGhpcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhdmFpbGFibGVfY2hhdHJvb21zID0gdGhpcy4kZWwuZmluZCgnI2F2YWlsYWJsZS1jaGF0cm9vbXMnKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yb29tcyA9ICQoaXEpLmZpbmQoJ3F1ZXJ5JykuZmluZCgnaXRlbScpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5yb29tcy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICMgRm9yIHRyYW5zbGF0b3JzOiAlMSRzIGlzIGEgdmFyaWFibGUgYW5kIHdpbGwgYmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICMgcmVwbGFjZWQgd2l0aCB0aGUgWE1QUCBzZXJ2ZXIgbmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGF2YWlsYWJsZV9jaGF0cm9vbXMuaHRtbCgnPGR0PicrX18oJ1Jvb21zIG9uICUxJHMnLHRoaXMubXVjX2RvbWFpbikrJzwvZHQ+Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcmFnbWVudCA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoaT0wOyBpPHRoaXMucm9vbXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lID0gU3Ryb3BoZS51bmVzY2FwZU5vZGUoJCh0aGlzLnJvb21zW2ldKS5hdHRyKCduYW1lJyl8fCQodGhpcy5yb29tc1tpXSkuYXR0cignamlkJykpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGppZCA9ICQodGhpcy5yb29tc1tpXSkuYXR0cignamlkJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnJhZ21lbnQuYXBwZW5kQ2hpbGQoJCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udmVyc2UudGVtcGxhdGVzLnJvb21faXRlbSh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbmFtZSc6bmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdqaWQnOmppZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdvcGVuX3RpdGxlJzogX18oJ0NsaWNrIHRvIG9wZW4gdGhpcyByb29tJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnaW5mb190aXRsZSc6IF9fKCdTaG93IG1vcmUgaW5mb3JtYXRpb24gb24gdGhpcyByb29tJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIClbMF0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGF2YWlsYWJsZV9jaGF0cm9vbXMuYXBwZW5kKGZyYWdtZW50KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJ2lucHV0I3Nob3ctcm9vbXMnKS5zaG93KCkuc2libGluZ3MoJ3NwYW4uc3Bpbm5lcicpLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbmZvcm1Ob1Jvb21zRm91bmQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB9LCB0aGlzKSwKICAgICAgICAgICAgICAgICAgICAkLnByb3h5KGZ1bmN0aW9uIChpcSkgeyAvLyBGYWlsdXJlCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5mb3JtTm9Sb29tc0ZvdW5kKCk7CiAgICAgICAgICAgICAgICAgICAgfSwgdGhpcykpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgc2hvd1Jvb21zOiBmdW5jdGlvbiAoZXYpIHsKICAgICAgICAgICAgICAgIHZhciAkYXZhaWxhYmxlX2NoYXRyb29tcyA9IHRoaXMuJGVsLmZpbmQoJyNhdmFpbGFibGUtY2hhdHJvb21zJyk7CiAgICAgICAgICAgICAgICB2YXIgJHNlcnZlciA9IHRoaXMuJGVsLmZpbmQoJ2lucHV0Lm5ldy1jaGF0cm9vbS1zZXJ2ZXInKTsKICAgICAgICAgICAgICAgIHZhciBzZXJ2ZXIgPSAkc2VydmVyLnZhbCgpOwogICAgICAgICAgICAgICAgaWYgKCFzZXJ2ZXIpIHsKICAgICAgICAgICAgICAgICAgICAkc2VydmVyLmFkZENsYXNzKCdlcnJvcicpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuJGVsLmZpbmQoJ2lucHV0Lm5ldy1jaGF0cm9vbS1uYW1lJykucmVtb3ZlQ2xhc3MoJ2Vycm9yJyk7CiAgICAgICAgICAgICAgICAkc2VydmVyLnJlbW92ZUNsYXNzKCdlcnJvcicpOwogICAgICAgICAgICAgICAgJGF2YWlsYWJsZV9jaGF0cm9vbXMuZW1wdHkoKTsKICAgICAgICAgICAgICAgICQoJ2lucHV0I3Nob3ctcm9vbXMnKS5oaWRlKCkuYWZ0ZXIoJzxzcGFuIGNsYXNzPSJzcGlubmVyIi8+Jyk7CiAgICAgICAgICAgICAgICB0aGlzLm11Y19kb21haW4gPSBzZXJ2ZXI7CiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVJvb21zTGlzdCgpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgc2hvd1Jvb21JbmZvOiBmdW5jdGlvbiAoZXYpIHsKICAgICAgICAgICAgICAgIHZhciB0YXJnZXQgPSBldi50YXJnZXQsCiAgICAgICAgICAgICAgICAgICAgJGRkID0gJCh0YXJnZXQpLnBhcmVudCgnZGQnKSwKICAgICAgICAgICAgICAgICAgICAkZGl2ID0gJGRkLmZpbmQoJ2Rpdi5yb29tLWluZm8nKTsKICAgICAgICAgICAgICAgIGlmICgkZGl2Lmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgICRkaXYucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICRkZC5maW5kKCdzcGFuLnNwaW5uZXInKS5yZW1vdmUoKTsKICAgICAgICAgICAgICAgICAgICAkZGQuYXBwZW5kKCc8c3BhbiBjbGFzcz0ic3Bpbm5lciBob3JfY2VudGVyZWQiLz4nKTsKICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS5jb25uZWN0aW9uLmRpc2NvLmluZm8oCiAgICAgICAgICAgICAgICAgICAgICAgICQodGFyZ2V0KS5hdHRyKCdkYXRhLXJvb20tamlkJyksCiAgICAgICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICQucHJveHkoZnVuY3Rpb24gKHN0YW56YSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyICRzdGFuemEgPSAkKHN0YW56YSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBBbGwgTVVDIGZlYXR1cmVzIGZvdW5kIGhlcmU6IGh0dHA6Ly94bXBwLm9yZy9yZWdpc3RyYXIvZGlzY28tZmVhdHVyZXMuaHRtbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRkLmZpbmQoJ3NwYW4uc3Bpbm5lcicpLnJlcGxhY2VXaXRoKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLnRlbXBsYXRlcy5yb29tX2Rlc2NyaXB0aW9uKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Rlc2MnOiAkc3RhbnphLmZpbmQoJ2ZpZWxkW3Zhcj0ibXVjI3Jvb21pbmZvX2Rlc2NyaXB0aW9uIl0gdmFsdWUnKS50ZXh0KCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdvY2MnOiAkc3RhbnphLmZpbmQoJ2ZpZWxkW3Zhcj0ibXVjI3Jvb21pbmZvX29jY3VwYW50cyJdIHZhbHVlJykudGV4dCgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnaGlkZGVuJzogJHN0YW56YS5maW5kKCdmZWF0dXJlW3Zhcj0ibXVjX2hpZGRlbiJdJykubGVuZ3RoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbWVtYmVyc29ubHknOiAkc3RhbnphLmZpbmQoJ2ZlYXR1cmVbdmFyPSJtdWNfbWVtYmVyc29ubHkiXScpLmxlbmd0aCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ21vZGVyYXRlZCc6ICRzdGFuemEuZmluZCgnZmVhdHVyZVt2YXI9Im11Y19tb2RlcmF0ZWQiXScpLmxlbmd0aCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ25vbmFub255bW91cyc6ICRzdGFuemEuZmluZCgnZmVhdHVyZVt2YXI9Im11Y19ub25hbm9ueW1vdXMiXScpLmxlbmd0aCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ29wZW4nOiAkc3RhbnphLmZpbmQoJ2ZlYXR1cmVbdmFyPSJtdWNfb3BlbiJdJykubGVuZ3RoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncGFzc3dvcmRwcm90ZWN0ZWQnOiAkc3RhbnphLmZpbmQoJ2ZlYXR1cmVbdmFyPSJtdWNfcGFzc3dvcmRwcm90ZWN0ZWQiXScpLmxlbmd0aCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3BlcnNpc3RlbnQnOiAkc3RhbnphLmZpbmQoJ2ZlYXR1cmVbdmFyPSJtdWNfcGVyc2lzdGVudCJdJykubGVuZ3RoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncHVibGljcm9vbSc6ICRzdGFuemEuZmluZCgnZmVhdHVyZVt2YXI9Im11Y19wdWJsaWMiXScpLmxlbmd0aCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3NlbWlhbm9ueW1vdXMnOiAkc3RhbnphLmZpbmQoJ2ZlYXR1cmVbdmFyPSJtdWNfc2VtaWFub255bW91cyJdJykubGVuZ3RoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAndGVtcG9yYXJ5JzogJHN0YW56YS5maW5kKCdmZWF0dXJlW3Zhcj0ibXVjX3RlbXBvcmFyeSJdJykubGVuZ3RoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAndW5tb2RlcmF0ZWQnOiAkc3RhbnphLmZpbmQoJ2ZlYXR1cmVbdmFyPSJtdWNfdW5tb2RlcmF0ZWQiXScpLmxlbmd0aCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2xhYmVsX2Rlc2MnOiBfXygnRGVzY3JpcHRpb246JyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdsYWJlbF9vY2MnOiBfXygnT2NjdXBhbnRzOicpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbGFiZWxfZmVhdHVyZXMnOiBfXygnRmVhdHVyZXM6JyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdsYWJlbF9yZXF1aXJlc19hdXRoJzogX18oJ1JlcXVpcmVzIGF1dGhlbnRpY2F0aW9uJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdsYWJlbF9oaWRkZW4nOiBfXygnSGlkZGVuJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdsYWJlbF9yZXF1aXJlc19pbnZpdGUnOiBfXygnUmVxdWlyZXMgYW4gaW52aXRhdGlvbicpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbGFiZWxfbW9kZXJhdGVkJzogX18oJ01vZGVyYXRlZCcpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbGFiZWxfbm9uX2Fub24nOiBfXygnTm9uLWFub255bW91cycpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbGFiZWxfb3Blbl9yb29tJzogX18oJ09wZW4gcm9vbScpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbGFiZWxfcGVybWFuZW50X3Jvb20nOiBfXygnUGVybWFuZW50IHJvb20nKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2xhYmVsX3B1YmxpYyc6IF9fKCdQdWJsaWMnKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2xhYmVsX3NlbWlfYW5vbic6ICBfKCdTZW1pLWFub255bW91cycpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbGFiZWxfdGVtcF9yb29tJzogIF8oJ1RlbXBvcmFyeSByb29tJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdsYWJlbF91bm1vZGVyYXRlZCc6IF9fKCdVbm1vZGVyYXRlZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgICAgICAgICB9LCB0aGlzKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBjcmVhdGVDaGF0Um9vbTogZnVuY3Rpb24gKGV2KSB7CiAgICAgICAgICAgICAgICBldi5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgdmFyIG5hbWUsICRuYW1lLAogICAgICAgICAgICAgICAgICAgIHNlcnZlciwgJHNlcnZlciwKICAgICAgICAgICAgICAgICAgICBqaWQsCiAgICAgICAgICAgICAgICAgICAgJG5pY2sgPSB0aGlzLiRlbC5maW5kKCdpbnB1dC5uZXctY2hhdHJvb20tbmljaycpLAogICAgICAgICAgICAgICAgICAgIG5pY2sgPSAkbmljay52YWwoKSwKICAgICAgICAgICAgICAgICAgICBjaGF0cm9vbTsKCiAgICAgICAgICAgICAgICBpZiAoIW5pY2spIHsgJG5pY2suYWRkQ2xhc3MoJ2Vycm9yJyk7IH0KICAgICAgICAgICAgICAgIGVsc2UgeyAkbmljay5yZW1vdmVDbGFzcygnZXJyb3InKTsgfQoKICAgICAgICAgICAgICAgIGlmIChldi50eXBlID09PSAnY2xpY2snKSB7CiAgICAgICAgICAgICAgICAgICAgamlkID0gJChldi50YXJnZXQpLmF0dHIoJ2RhdGEtcm9vbS1qaWQnKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJG5hbWUgPSB0aGlzLiRlbC5maW5kKCdpbnB1dC5uZXctY2hhdHJvb20tbmFtZScpOwogICAgICAgICAgICAgICAgICAgICRzZXJ2ZXI9IHRoaXMuJGVsLmZpbmQoJ2lucHV0Lm5ldy1jaGF0cm9vbS1zZXJ2ZXInKTsKICAgICAgICAgICAgICAgICAgICBzZXJ2ZXIgPSAkc2VydmVyLnZhbCgpOwogICAgICAgICAgICAgICAgICAgIG5hbWUgPSAkbmFtZS52YWwoKS50cmltKCkudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICAgICAgICAkbmFtZS52YWwoJycpOyAvLyBDbGVhciB0aGUgaW5wdXQKICAgICAgICAgICAgICAgICAgICBpZiAobmFtZSAmJiBzZXJ2ZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgamlkID0gU3Ryb3BoZS5lc2NhcGVOb2RlKG5hbWUpICsgJ0AnICsgc2VydmVyOwogICAgICAgICAgICAgICAgICAgICAgICAkbmFtZS5yZW1vdmVDbGFzcygnZXJyb3InKTsKICAgICAgICAgICAgICAgICAgICAgICAgJHNlcnZlci5yZW1vdmVDbGFzcygnZXJyb3InKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tdWNfZG9tYWluID0gc2VydmVyOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghbmFtZSkgeyAkbmFtZS5hZGRDbGFzcygnZXJyb3InKTsgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXNlcnZlcikgeyAkc2VydmVyLmFkZENsYXNzKCdlcnJvcicpOyB9CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoIW5pY2spIHsgcmV0dXJuOyB9CiAgICAgICAgICAgICAgICBjaGF0cm9vbSA9IGNvbnZlcnNlLmNoYXRib3h2aWV3cy5zaG93Q2hhdCh7CiAgICAgICAgICAgICAgICAgICAgJ2lkJzogamlkLAogICAgICAgICAgICAgICAgICAgICdqaWQnOiBqaWQsCiAgICAgICAgICAgICAgICAgICAgJ25hbWUnOiBTdHJvcGhlLnVuZXNjYXBlTm9kZShTdHJvcGhlLmdldE5vZGVGcm9tSmlkKGppZCkpLAogICAgICAgICAgICAgICAgICAgICduaWNrJzogbmljaywKICAgICAgICAgICAgICAgICAgICAnY2hhdHJvb20nOiB0cnVlLAogICAgICAgICAgICAgICAgICAgICdib3hfaWQnIDogYjY0X3NoYTEoamlkKQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgdGhpcy5Db250cm9sQm94VmlldyA9IGNvbnZlcnNlLkNoYXRCb3hWaWV3LmV4dGVuZCh7CiAgICAgICAgICAgIHRhZ05hbWU6ICdkaXYnLAogICAgICAgICAgICBjbGFzc05hbWU6ICdjaGF0Ym94JywKICAgICAgICAgICAgaWQ6ICdjb250cm9sYm94JywKICAgICAgICAgICAgZXZlbnRzOiB7CiAgICAgICAgICAgICAgICAnY2xpY2sgYS5jbG9zZS1jaGF0Ym94LWJ1dHRvbic6ICdjbG9zZScsCiAgICAgICAgICAgICAgICAnY2xpY2sgdWwjY29udHJvbGJveC10YWJzIGxpIGEnOiAnc3dpdGNoVGFiJywKICAgICAgICAgICAgICAgICdtb3VzZWRvd24gLmRyYWdyZXNpemUtdG0nOiAnb25EcmFnUmVzaXplU3RhcnQnCiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRlbC5pbnNlcnRBZnRlcihjb252ZXJzZS5jb250cm9sYm94dG9nZ2xlLiRlbCk7CiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLm9uKCdjaGFuZ2U6Y29ubmVjdGVkJywgdGhpcy5vbkNvbm5lY3RlZCwgdGhpcyk7CiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLm9uKCdkZXN0cm95JywgdGhpcy5oaWRlLCB0aGlzKTsKICAgICAgICAgICAgICAgIHRoaXMubW9kZWwub24oJ2hpZGUnLCB0aGlzLmhpZGUsIHRoaXMpOwogICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5vbignc2hvdycsIHRoaXMuc2hvdywgdGhpcyk7CiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLm9uKCdjaGFuZ2U6Y2xvc2VkJywgdGhpcy5lbnN1cmVDbG9zZWRTdGF0ZSwgdGhpcyk7CiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcigpOwogICAgICAgICAgICAgICAgaWYgKHRoaXMubW9kZWwuZ2V0KCdjb25uZWN0ZWQnKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuaW5pdFJvc3RlcigpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKCF0aGlzLm1vZGVsLmdldCgnY2xvc2VkJykpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3coKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5oaWRlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBvbkNvbm5lY3RlZDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMubW9kZWwuZ2V0KCdjb25uZWN0ZWQnKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyKCkuaW5pdFJvc3RlcigpOwogICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLmZlYXR1cmVzLm9mZignYWRkJywgdGhpcy5mZWF0dXJlQWRkZWQsIHRoaXMpOwogICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLmZlYXR1cmVzLm9uKCdhZGQnLCB0aGlzLmZlYXR1cmVBZGRlZCwgdGhpcyk7CiAgICAgICAgICAgICAgICAgICAgLy8gRmVhdHVyZXMgY291bGQgaGF2ZSBiZWVuIGFkZGVkIGJlZm9yZSB0aGUgY29udHJvbGJveCB3YXMKICAgICAgICAgICAgICAgICAgICAvLyBpbml0aWFsaXplZC4gQ3VycmVudGx5IHdlJ3JlIG9ubHkgaW50ZXJlc3RlZCBpbiBNVUMKICAgICAgICAgICAgICAgICAgICB2YXIgZmVhdHVyZSA9IGNvbnZlcnNlLmZlYXR1cmVzLmZpbmRXaGVyZSh7J3Zhcic6ICdodHRwOi8vamFiYmVyLm9yZy9wcm90b2NvbC9tdWMnfSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGZlYXR1cmUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5mZWF0dXJlQWRkZWQoZmVhdHVyZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgaW5pdFJvc3RlcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgLyogV2UgaW5pdGlhbGl6ZSB0aGUgcm9zdGVyLCB3aGljaCB3aWxsIGFwcGVhciBpbnNpZGUgdGhlCiAgICAgICAgICAgICAgICAgKiBDb250YWN0cyBQYW5lbC4KICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgY29udmVyc2Uucm9zdGVyID0gbmV3IGNvbnZlcnNlLlJvc3RlckNvbnRhY3RzKCk7CiAgICAgICAgICAgICAgICBjb252ZXJzZS5yb3N0ZXIuYnJvd3NlclN0b3JhZ2UgPSBuZXcgQmFja2JvbmUuQnJvd3NlclN0b3JhZ2VbY29udmVyc2Uuc3RvcmFnZV0oCiAgICAgICAgICAgICAgICAgICAgYjY0X3NoYTEoJ2NvbnZlcnNlLmNvbnRhY3RzLScrY29udmVyc2UuYmFyZV9qaWQpKTsKICAgICAgICAgICAgICAgIHZhciByb3N0ZXJncm91cHMgPSBuZXcgY29udmVyc2UuUm9zdGVyR3JvdXBzKCk7CiAgICAgICAgICAgICAgICByb3N0ZXJncm91cHMuYnJvd3NlclN0b3JhZ2UgPSBuZXcgQmFja2JvbmUuQnJvd3NlclN0b3JhZ2VbY29udmVyc2Uuc3RvcmFnZV0oCiAgICAgICAgICAgICAgICAgICAgYjY0X3NoYTEoJ2NvbnZlcnNlLnJvc3Rlci5ncm91cHMnK2NvbnZlcnNlLmJhcmVfamlkKSk7CiAgICAgICAgICAgICAgICBjb252ZXJzZS5yb3N0ZXJ2aWV3ID0gbmV3IGNvbnZlcnNlLlJvc3RlclZpZXcoe21vZGVsOiByb3N0ZXJncm91cHN9KTsKICAgICAgICAgICAgICAgIHRoaXMuY29udGFjdHNwYW5lbC4kZWwuYXBwZW5kKGNvbnZlcnNlLnJvc3RlcnZpZXcuJGVsKTsKICAgICAgICAgICAgICAgIC8vIFRPRE86CiAgICAgICAgICAgICAgICAvLyBTZWUgaWYgd2Ugc2hvdWxkbid0IGFsc28gZmV0Y2ggdGhlIHJvc3RlciBoZXJlLi4uIG90aGVyd2lzZQogICAgICAgICAgICAgICAgLy8gdGhlIHJvc3RlciBpcyBhbHdheXMgcG9wdWxhdGVkIGJ5IHRoZSByb3N0ZXJIYW5kbGVyIG1ldGhvZCwKICAgICAgICAgICAgICAgIC8vIHdoaWNoIGFwcGVhcnMgdG8gYmUgYSBsZXNzIGVjb25vbWljIHdheS4KICAgICAgICAgICAgICAgIC8vIGkuZS4gZnJvbSB3aGF0IGl0IHNlZW1zLCBvbmx5IGdyb3VwcyBhcmUgZmV0Y2hlZCBmcm9tCiAgICAgICAgICAgICAgICAvLyBicm93c2VyU3RvcmFnZSwgYW5kIG5vIGNvbnRhY3RzLgogICAgICAgICAgICAgICAgLy8gWFhYOiBNYWtlIHN1cmUgdGhhdCBpZiBmZXRjaCBpcyBjYWxsZWQsIHdlIGRvbid0IHNvcnQgb24KICAgICAgICAgICAgICAgIC8vIGVhY2ggaXRlbSBhZGQuLi4KICAgICAgICAgICAgICAgIC8vIGNvbnZlcnNlLnJvc3Rlci5mZXRjaCgpCiAgICAgICAgICAgICAgICBjb252ZXJzZS5yb3N0ZXJ2aWV3LnJlbmRlcigpLmZldGNoKCkudXBkYXRlKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgaWYgKCFjb252ZXJzZS5jb25uZWN0aW9uLmNvbm5lY3RlZCB8fCAhY29udmVyc2UuY29ubmVjdGlvbi5hdXRoZW50aWNhdGVkIHx8IGNvbnZlcnNlLmNvbm5lY3Rpb24uZGlzY29ubmVjdGluZykgewogICAgICAgICAgICAgICAgICAgIC8vIFRPRE86IHdlIG1pZ2h0IG5lZWQgdG8gdGFrZSBwcmViaW5kaW5nIGludG8gY29uc2lkZXJhdGlvbiBoZXJlLgogICAgICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyTG9naW5QYW5lbCgpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICghdGhpcy5jb250YWN0c3BhbmVsIHx8ICF0aGlzLmNvbnRhY3RzcGFuZWwuJGVsLmlzKCc6dmlzaWJsZScpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJDb250YWN0c1BhbmVsKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHJlbmRlckxvZ2luUGFuZWw6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHRoaXMuJGVsLmh0bWwoY29udmVyc2UudGVtcGxhdGVzLmNvbnRyb2xib3godGhpcy5tb2RlbC50b0pTT04oKSkpOwogICAgICAgICAgICAgICAgdmFyIGNmZyA9IHsnJHBhcmVudCc6IHRoaXMuJGVsLmZpbmQoJy5jb250cm9sYm94LXBhbmVzJyksICdtb2RlbCc6IHRoaXN9OwogICAgICAgICAgICAgICAgaWYgKCF0aGlzLmxvZ2lucGFuZWwpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2lucGFuZWwgPSBuZXcgY29udmVyc2UuTG9naW5QYW5lbChjZmcpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2lucGFuZWwuZGVsZWdhdGVFdmVudHMoKS5pbml0aWFsaXplKGNmZyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLmxvZ2lucGFuZWwucmVuZGVyKCk7CiAgICAgICAgICAgICAgICB0aGlzLmluaXREcmFnUmVzaXplKCk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICByZW5kZXJDb250YWN0c1BhbmVsOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRlbC5odG1sKGNvbnZlcnNlLnRlbXBsYXRlcy5jb250cm9sYm94KHRoaXMubW9kZWwudG9KU09OKCkpKTsKICAgICAgICAgICAgICAgIHRoaXMuY29udGFjdHNwYW5lbCA9IG5ldyBjb252ZXJzZS5Db250YWN0c1BhbmVsKHsnJHBhcmVudCc6IHRoaXMuJGVsLmZpbmQoJy5jb250cm9sYm94LXBhbmVzJyl9KTsKICAgICAgICAgICAgICAgIHRoaXMuY29udGFjdHNwYW5lbC5yZW5kZXIoKTsKICAgICAgICAgICAgICAgIGNvbnZlcnNlLnhtcHBzdGF0dXN2aWV3ID0gbmV3IGNvbnZlcnNlLlhNUFBTdGF0dXNWaWV3KHsnbW9kZWwnOiBjb252ZXJzZS54bXBwc3RhdHVzfSk7CiAgICAgICAgICAgICAgICBjb252ZXJzZS54bXBwc3RhdHVzdmlldy5yZW5kZXIoKTsKICAgICAgICAgICAgICAgIGlmIChjb252ZXJzZS5hbGxvd19tdWMpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnJvb21zcGFuZWwgPSBuZXcgY29udmVyc2UuUm9vbXNQYW5lbCh7JyRwYXJlbnQnOiB0aGlzLiRlbC5maW5kKCcuY29udHJvbGJveC1wYW5lcycpfSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5yb29tc3BhbmVsLnJlbmRlcigpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5pbml0RHJhZ1Jlc2l6ZSgpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgY2xvc2U6IGZ1bmN0aW9uIChldikgewogICAgICAgICAgICAgICAgaWYgKGV2ICYmIGV2LnByZXZlbnREZWZhdWx0KSB7IGV2LnByZXZlbnREZWZhdWx0KCk7IH0KICAgICAgICAgICAgICAgIGlmIChjb252ZXJzZS5jb25uZWN0aW9uLmNvbm5lY3RlZCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuc2F2ZSh7J2Nsb3NlZCc6IHRydWV9KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlbC50cmlnZ2VyKCdoaWRlJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb252ZXJzZS5lbWl0KCdjb250cm9sQm94Q2xvc2VkJywgdGhpcyk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGVuc3VyZUNsb3NlZFN0YXRlOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5tb2RlbC5nZXQoJ2Nsb3NlZCcpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5oaWRlKCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvdygpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgaGlkZTogZnVuY3Rpb24gKGNhbGxiYWNrKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRlbC5oaWRlKCdmYXN0JywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLnJlZnJlc2hXZWJraXQoKTsKICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS5lbWl0KCdjaGF0Qm94Q2xvc2VkJywgdGhpcyk7CiAgICAgICAgICAgICAgICAgICAgY29udmVyc2UuY29udHJvbGJveHRvZ2dsZS5zaG93KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBjYWxsYmFjayA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHNob3c6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGNvbnZlcnNlLmNvbnRyb2xib3h0b2dnbGUuaGlkZSgkLnByb3h5KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbC5zaG93KCdmYXN0JywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29udmVyc2Uucm9zdGVydmlldykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udmVyc2Uucm9zdGVydmlldy51cGRhdGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS5yZWZyZXNoV2Via2l0KCk7CiAgICAgICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTsKICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS5lbWl0KCdjb250cm9sQm94T3BlbmVkJywgdGhpcyk7CiAgICAgICAgICAgICAgICB9LCB0aGlzKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGZlYXR1cmVBZGRlZDogZnVuY3Rpb24gKGZlYXR1cmUpIHsKICAgICAgICAgICAgICAgIGlmICgoZmVhdHVyZS5nZXQoJ3ZhcicpID09ICdodHRwOi8vamFiYmVyLm9yZy9wcm90b2NvbC9tdWMnKSAmJiAoY29udmVyc2UuYWxsb3dfbXVjKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMucm9vbXNwYW5lbC5tdWNfZG9tYWluID0gZmVhdHVyZS5nZXQoJ2Zyb20nKTsKICAgICAgICAgICAgICAgICAgICB2YXIgJHNlcnZlcj0gdGhpcy4kZWwuZmluZCgnaW5wdXQubmV3LWNoYXRyb29tLXNlcnZlcicpOwogICAgICAgICAgICAgICAgICAgIGlmICghICRzZXJ2ZXIuaXMoJzpmb2N1cycpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRzZXJ2ZXIudmFsKHRoaXMucm9vbXNwYW5lbC5tdWNfZG9tYWluKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnZlcnNlLmF1dG9fbGlzdF9yb29tcykgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJvb21zcGFuZWwudHJpZ2dlcigndXBkYXRlLXJvb21zLWxpc3QnKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBzd2l0Y2hUYWI6IGZ1bmN0aW9uIChldikgewogICAgICAgICAgICAgICAgZXYucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgIHZhciAkdGFiID0gJChldi50YXJnZXQpLAogICAgICAgICAgICAgICAgICAgICRzaWJsaW5nID0gJHRhYi5wYXJlbnQoKS5zaWJsaW5ncygnbGknKS5jaGlsZHJlbignYScpLAogICAgICAgICAgICAgICAgICAgICR0YWJfcGFuZWwgPSAkKCR0YWIuYXR0cignaHJlZicpKTsKICAgICAgICAgICAgICAgICQoJHNpYmxpbmcuYXR0cignaHJlZicpKS5oaWRlKCk7CiAgICAgICAgICAgICAgICAkc2libGluZy5yZW1vdmVDbGFzcygnY3VycmVudCcpOwogICAgICAgICAgICAgICAgJHRhYi5hZGRDbGFzcygnY3VycmVudCcpOwogICAgICAgICAgICAgICAgJHRhYl9wYW5lbC5zaG93KCk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBzaG93SGVscE1lc3NhZ2VzOiBmdW5jdGlvbiAobXNncykgewogICAgICAgICAgICAgICAgLy8gT3ZlcnJpZGUgc2hvd0hlbHBNZXNzYWdlcyBpbiBDaGF0Qm94VmlldywgZm9yIG5vdyBkbyBub3RoaW5nLgogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIHRoaXMuQ2hhdFJvb21PY2N1cGFudCA9IEJhY2tib25lLk1vZGVsOwogICAgICAgIHRoaXMuQ2hhdFJvb21PY2N1cGFudFZpZXcgPSBCYWNrYm9uZS5WaWV3LmV4dGVuZCh7CiAgICAgICAgICAgIHRhZ05hbWU6ICdsaScsCiAgICAgICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHRoaXMubW9kZWwub24oJ2NoYW5nZScsIHRoaXMucmVuZGVyLCB0aGlzKTsKICAgICAgICAgICAgICAgIHRoaXMubW9kZWwub24oJ2Rlc3Ryb3knLCB0aGlzLmRlc3Ryb3ksIHRoaXMpOwogICAgICAgICAgICB9LAogICAgICAgICAgICByZW5kZXI6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciAkbmV3ID0gY29udmVyc2UudGVtcGxhdGVzLm9jY3VwYW50KAogICAgICAgICAgICAgICAgICAgIF8uZXh0ZW5kKAogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLnRvSlNPTigpLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGVzY19tb2RlcmF0b3InOiBfXygnVGhpcyB1c2VyIGlzIGEgbW9kZXJhdG9yJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGVzY19wYXJ0aWNpcGFudCc6IF9fKCdUaGlzIHVzZXIgY2FuIHNlbmQgbWVzc2FnZXMgaW4gdGhpcyByb29tJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGVzY192aXNpdG9yJzogX18oJ1RoaXMgdXNlciBjYW4gTk9UIHNlbmQgbWVzc2FnZXMgaW4gdGhpcyByb29tJykKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIHRoaXMuJGVsLnJlcGxhY2VXaXRoKCRuZXcpOwogICAgICAgICAgICAgICAgdGhpcy5zZXRFbGVtZW50KCRuZXcsIHRydWUpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBkZXN0cm95OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRlbC5yZW1vdmUoKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICB0aGlzLkNoYXRSb29tT2NjdXBhbnRzID0gQmFja2JvbmUuQ29sbGVjdGlvbi5leHRlbmQoewogICAgICAgICAgICBtb2RlbDogY29udmVyc2UuQ2hhdFJvb21PY2N1cGFudCwKICAgICAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKG9wdGlvbnMpIHsKICAgICAgICAgICAgICAgIHRoaXMuYnJvd3NlclN0b3JhZ2UgPSBuZXcgQmFja2JvbmUuQnJvd3NlclN0b3JhZ2VbY29udmVyc2Uuc3RvcmFnZV0oCiAgICAgICAgICAgICAgICAgICAgYjY0X3NoYTEoJ2NvbnZlcnNlLm9jY3VwYW50cycrY29udmVyc2UuYmFyZV9qaWQrb3B0aW9ucy5uaWNrKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgdGhpcy5DaGF0Um9vbU9jY3VwYW50c1ZpZXcgPSBCYWNrYm9uZS5PdmVydmlldy5leHRlbmQoewogICAgICAgICAgICB0YWdOYW1lOiAnZGl2JywKICAgICAgICAgICAgY2xhc3NOYW1lOiAncGFydGljaXBhbnRzJywKCiAgICAgICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHRoaXMubW9kZWwub24oImFkZCIsIHRoaXMub25PY2N1cGFudEFkZGVkLCB0aGlzKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdGhpcy4kZWwuaHRtbCgKICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS50ZW1wbGF0ZXMuY2hhdHJvb21fc2lkZWJhcih7CiAgICAgICAgICAgICAgICAgICAgICAgICdsYWJlbF9pbnZpdGF0aW9uJzogX18oJ0ludml0ZS4uLicpLAogICAgICAgICAgICAgICAgICAgICAgICAnbGFiZWxfb2NjdXBhbnRzJzogX18oJ09jY3VwYW50cycpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5pbml0SW52aXRlV2lkZ2V0KCk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBvbk9jY3VwYW50QWRkZWQ6IGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICB2YXIgdmlldyA9IHRoaXMuZ2V0KGl0ZW0uZ2V0KCdpZCcpKTsKICAgICAgICAgICAgICAgIGlmICghdmlldykgewogICAgICAgICAgICAgICAgICAgIHZpZXcgPSB0aGlzLmFkZChpdGVtLmdldCgnaWQnKSwgbmV3IGNvbnZlcnNlLkNoYXRSb29tT2NjdXBhbnRWaWV3KHttb2RlbDogaXRlbX0pKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHZpZXcubW9kZWw7IC8vIFJlbW92ZSByZWYgdG8gb2xkIG1vZGVsIHRvIGhlbHAgZ2FyYmFnZSBjb2xsZWN0aW9uCiAgICAgICAgICAgICAgICAgICAgdmlldy5tb2RlbCA9IGl0ZW07CiAgICAgICAgICAgICAgICAgICAgdmlldy5pbml0aWFsaXplKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLiQoJy5wYXJ0aWNpcGFudC1saXN0JykuYXBwZW5kKHZpZXcucmVuZGVyKCkuJGVsKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIG9uQ2hhdFJvb21Sb3N0ZXI6IGZ1bmN0aW9uIChyb3N0ZXIsIHJvb20pIHsKICAgICAgICAgICAgICAgIHZhciByb3N0ZXJfc2l6ZSA9IF8uc2l6ZShyb3N0ZXIpLAogICAgICAgICAgICAgICAgICAgICRwYXJ0aWNpcGFudF9saXN0ID0gdGhpcy4kKCcucGFydGljaXBhbnQtbGlzdCcpLAogICAgICAgICAgICAgICAgICAgIHBhcnRpY2lwYW50cyA9IFtdLAogICAgICAgICAgICAgICAgICAgIGtleXMgPSBfLmtleXMocm9zdGVyKSwKICAgICAgICAgICAgICAgICAgICBvY2N1cGFudCwgYXR0cnMsIGksIG5pY2s7CgogICAgICAgICAgICAgICAgZm9yIChpPTA7IGk8cm9zdGVyX3NpemU7IGkrKykgewogICAgICAgICAgICAgICAgICAgIG5pY2sgPSBTdHJvcGhlLnVuZXNjYXBlTm9kZShrZXlzW2ldKTsKICAgICAgICAgICAgICAgICAgICBhdHRycyA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgJ2lkJzogbmljaywKICAgICAgICAgICAgICAgICAgICAgICAgJ3JvbGUnOiByb3N0ZXJba2V5c1tpXV0ucm9sZSwKICAgICAgICAgICAgICAgICAgICAgICAgJ25pY2snOiBuaWNrCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBvY2N1cGFudCA9IHRoaXMubW9kZWwuZ2V0KG5pY2spOwogICAgICAgICAgICAgICAgICAgIGlmIChvY2N1cGFudCkgewogICAgICAgICAgICAgICAgICAgICAgICBvY2N1cGFudC5zYXZlKGF0dHJzKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLmNyZWF0ZShhdHRycyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgXy5lYWNoKF8uZGlmZmVyZW5jZSh0aGlzLm1vZGVsLnBsdWNrKCdpZCcpLCBrZXlzKSwgZnVuY3Rpb24gKGlkKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5nZXQoaWQpLmRlc3Ryb3koKTsKICAgICAgICAgICAgICAgIH0sIHRoaXMpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBpbml0SW52aXRlV2lkZ2V0OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB2YXIgJGVsID0gdGhpcy4kKCdpbnB1dC5pbnZpdGVkLWNvbnRhY3QnKTsKICAgICAgICAgICAgICAgICRlbC50eXBlYWhlYWQoewogICAgICAgICAgICAgICAgICAgIG1pbkxlbmd0aDogMSwKICAgICAgICAgICAgICAgICAgICBoaWdobGlnaHQ6IHRydWUKICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgICBuYW1lOiAnY29udGFjdHMtZGF0YXNldCcsCiAgICAgICAgICAgICAgICAgICAgc291cmNlOiBmdW5jdGlvbiAocSwgY2IpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3VsdHMgPSBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgXy5lYWNoKGNvbnZlcnNlLnJvc3Rlci5maWx0ZXIoY29udGFpbnMoWydmdWxsbmFtZScsICdqaWQnXSwgcSkpLCBmdW5jdGlvbiAobikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0cy5wdXNoKHt2YWx1ZTogbi5nZXQoJ2Z1bGxuYW1lJyksIGppZDogbi5nZXQoJ2ppZCcpfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBjYihyZXN1bHRzKTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlczogewogICAgICAgICAgICAgICAgICAgICAgICBzdWdnZXN0aW9uOiBfLnRlbXBsYXRlKCc8cCBkYXRhLWppZD0ie3tqaWR9fSI+e3t2YWx1ZX19PC9wPicpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAkZWwub24oJ3R5cGVhaGVhZDpzZWxlY3RlZCcsICQucHJveHkoZnVuY3Rpb24gKGV2LCBzdWdnZXN0aW9uLCBkbmFtZSkgewogICAgICAgICAgICAgICAgICAgIHZhciByZWFzb24gPSBwcm9tcHQoCiAgICAgICAgICAgICAgICAgICAgICAgIF9fKF9fXygnWW91IGFyZSBhYm91dCB0byBpbnZpdGUgJTEkcyB0byB0aGUgY2hhdCByb29tICIlMiRzIi4gJyksIHN1Z2dlc3Rpb24udmFsdWUsIHRoaXMubW9kZWwuZ2V0KCdpZCcpKSArCiAgICAgICAgICAgICAgICAgICAgICAgIF9fKCJZb3UgbWF5IG9wdGlvbmFsbHkgaW5jbHVkZSBhIG1lc3NhZ2UsIGV4cGxhaW5pbmcgdGhlIHJlYXNvbiBmb3IgdGhlIGludml0YXRpb24uIikKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIGlmIChyZWFzb24gIT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29udmVyc2UuY29ubmVjdGlvbi5tdWMucm9vbXNbdGhpcy5jaGF0cm9vbXZpZXcubW9kZWwuZ2V0KCdpZCcpXS5kaXJlY3RJbnZpdGUoc3VnZ2VzdGlvbi5qaWQsIHJlYXNvbik7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLmVtaXQoJ3Jvb21JbnZpdGVTZW50JywgdGhpcywgc3VnZ2VzdGlvbi5qaWQsIHJlYXNvbik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICQoZXYudGFyZ2V0KS50eXBlYWhlYWQoJ3ZhbCcsICcnKTsKICAgICAgICAgICAgICAgIH0sIHRoaXMpKTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9CgogICAgICAgIH0pOwoKICAgICAgICB0aGlzLkNoYXRSb29tVmlldyA9IGNvbnZlcnNlLkNoYXRCb3hWaWV3LmV4dGVuZCh7CiAgICAgICAgICAgIGxlbmd0aDogMzAwLAogICAgICAgICAgICB0YWdOYW1lOiAnZGl2JywKICAgICAgICAgICAgY2xhc3NOYW1lOiAnY2hhdHJvb20nLAogICAgICAgICAgICBldmVudHM6IHsKICAgICAgICAgICAgICAgICdjbGljayAuY2xvc2UtY2hhdGJveC1idXR0b24nOiAnY2xvc2UnLAogICAgICAgICAgICAgICAgJ2NsaWNrIC50b2dnbGUtY2hhdGJveC1idXR0b24nOiAnbWluaW1pemUnLAogICAgICAgICAgICAgICAgJ2NsaWNrIC5jb25maWd1cmUtY2hhdHJvb20tYnV0dG9uJzogJ2NvbmZpZ3VyZUNoYXRSb29tJywKICAgICAgICAgICAgICAgICdjbGljayAudG9nZ2xlLXNtaWxleSc6ICd0b2dnbGVFbW90aWNvbk1lbnUnLAogICAgICAgICAgICAgICAgJ2NsaWNrIC50b2dnbGUtc21pbGV5IHVsIGxpJzogJ2luc2VydEVtb3RpY29uJywKICAgICAgICAgICAgICAgICdjbGljayAudG9nZ2xlLWNsZWFyJzogJ2NsZWFyQ2hhdFJvb21NZXNzYWdlcycsCiAgICAgICAgICAgICAgICAnY2xpY2sgLnRvZ2dsZS1wYXJ0aWNpcGFudHMgYSc6ICd0b2dnbGVPY2N1cGFudHMnLAogICAgICAgICAgICAgICAgJ2tleXByZXNzIHRleHRhcmVhLmNoYXQtdGV4dGFyZWEnOiAna2V5UHJlc3NlZCcsCiAgICAgICAgICAgICAgICAnbW91c2Vkb3duIC5kcmFncmVzaXplLXRtJzogJ29uRHJhZ1Jlc2l6ZVN0YXJ0JwogICAgICAgICAgICB9LAogICAgICAgICAgICBpc19jaGF0cm9vbTogdHJ1ZSwKCiAgICAgICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHRoaXMubW9kZWwubWVzc2FnZXMub24oJ2FkZCcsIHRoaXMub25NZXNzYWdlQWRkZWQsIHRoaXMpOwogICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5vbignY2hhbmdlOm1pbmltaXplZCcsIGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uZ2V0KCdtaW5pbWl6ZWQnKSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmhpZGUoKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1heGltaXplKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwgdGhpcyk7CiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLm9uKCdkZXN0cm95JywgZnVuY3Rpb24gKG1vZGVsLCByZXNwb25zZSwgb3B0aW9ucykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuaGlkZSgpOwogICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLmNvbm5lY3Rpb24ubXVjLmxlYXZlKAogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLmdldCgnamlkJyksCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuZ2V0KCduaWNrJyksCiAgICAgICAgICAgICAgICAgICAgICAgICQucHJveHkodGhpcy5vbkxlYXZlLCB0aGlzKSwKICAgICAgICAgICAgICAgICAgICAgICAgdW5kZWZpbmVkKTsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB0aGlzKTsKCiAgICAgICAgICAgICAgICB0aGlzLm9jY3VwYW50c3ZpZXcgPSBuZXcgY29udmVyc2UuQ2hhdFJvb21PY2N1cGFudHNWaWV3KHsKICAgICAgICAgICAgICAgICAgICBtb2RlbDogbmV3IGNvbnZlcnNlLkNoYXRSb29tT2NjdXBhbnRzKHtuaWNrOiB0aGlzLm1vZGVsLmdldCgnbmljaycpfSkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgdGhpcy5vY2N1cGFudHN2aWV3LmNoYXRyb29tdmlldyA9IHRoaXM7CiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcigpOwogICAgICAgICAgICAgICAgdGhpcy5vY2N1cGFudHN2aWV3Lm1vZGVsLmZldGNoKHthZGQ6dHJ1ZX0pOwogICAgICAgICAgICAgICAgdGhpcy5jb25uZWN0KG51bGwpOwogICAgICAgICAgICAgICAgY29udmVyc2UuZW1pdCgnY2hhdFJvb21PcGVuZWQnLCB0aGlzKTsKCiAgICAgICAgICAgICAgICB0aGlzLiRlbC5pbnNlcnRBZnRlcihjb252ZXJzZS5jaGF0Ym94dmlld3MuZ2V0KCJjb250cm9sYm94IikuJGVsKTsKICAgICAgICAgICAgICAgIHRoaXMubW9kZWwubWVzc2FnZXMuZmV0Y2goe2FkZDogdHJ1ZX0pOwogICAgICAgICAgICAgICAgaWYgKHRoaXMubW9kZWwuZ2V0KCdtaW5pbWl6ZWQnKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuaGlkZSgpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3coKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdGhpcy4kZWwuYXR0cignaWQnLCB0aGlzLm1vZGVsLmdldCgnYm94X2lkJykpCiAgICAgICAgICAgICAgICAgICAgICAgIC5odG1sKGNvbnZlcnNlLnRlbXBsYXRlcy5jaGF0cm9vbSh0aGlzLm1vZGVsLnRvSlNPTigpKSk7CiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlckNoYXRBcmVhKCk7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS5yZWZyZXNoV2Via2l0KCk7CiAgICAgICAgICAgICAgICB9LCA1MCk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHJlbmRlckNoYXRBcmVhOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuJCgnLmNoYXQtYXJlYScpLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuJCgnLmNoYXQtYm9keScpLmVtcHR5KCkKICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLnRlbXBsYXRlcy5jaGF0YXJlYSh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3Nob3dfdG9vbGJhcic6IGNvbnZlcnNlLnNob3dfdG9vbGJhciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbGFiZWxfbWVzc2FnZSc6IF9fKCdNZXNzYWdlJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKQogICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKHRoaXMub2NjdXBhbnRzdmlldy5yZW5kZXIoKS4kZWwpOwogICAgICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyVG9vbGJhcigpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy8gWFhYOiBUaGlzIGlzIGEgYml0IG9mIGEgaGFjaywgdG8gbWFrZSBzdXJlIHRoYXQgdGhlCiAgICAgICAgICAgICAgICAvLyBzaWRlYmFyJ3Mgc3RhdGUgaXMgcmVtZW1iZXJlZC4KICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuc2V0KHtoaWRkZW5fb2NjdXBhbnRzOiAhdGhpcy5tb2RlbC5nZXQoJ2hpZGRlbl9vY2N1cGFudHMnKX0pOwogICAgICAgICAgICAgICAgdGhpcy50b2dnbGVPY2N1cGFudHMoKTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgdG9nZ2xlT2NjdXBhbnRzOiBmdW5jdGlvbiAoZXYpIHsKICAgICAgICAgICAgICAgIGlmIChldikgewogICAgICAgICAgICAgICAgICAgIGV2LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgZXYuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB2YXIgJGVsID0gdGhpcy4kKCcuaWNvbi1oaWRlLXVzZXJzJyk7CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMubW9kZWwuZ2V0KCdoaWRkZW5fb2NjdXBhbnRzJykpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLnNhdmUoe2hpZGRlbl9vY2N1cGFudHM6IHRydWV9KTsKICAgICAgICAgICAgICAgICAgICAkZWwucmVtb3ZlQ2xhc3MoJ2ljb24taGlkZS11c2VycycpLmFkZENsYXNzKCdpY29uLXNob3ctdXNlcnMnKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLiQoJ2Zvcm0uc2VuZFhNUFBNZXNzYWdlLCAuY2hhdC1hcmVhJykuYW5pbWF0ZSh7d2lkdGg6ICcxMDAlJ30pOwogICAgICAgICAgICAgICAgICAgIHRoaXMuJCgnZGl2LnBhcnRpY2lwYW50cycpLmFuaW1hdGUoe3dpZHRoOiAwfSwgJC5wcm94eShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2Nyb2xsRG93bigpOwogICAgICAgICAgICAgICAgICAgIH0sIHRoaXMpKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5zYXZlKHtoaWRkZW5fb2NjdXBhbnRzOiBmYWxzZX0pOwogICAgICAgICAgICAgICAgICAgICRlbC5yZW1vdmVDbGFzcygnaWNvbi1zaG93LXVzZXJzJykuYWRkQ2xhc3MoJ2ljb24taGlkZS11c2VycycpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuJCgnLmNoYXQtYXJlYSwgZm9ybS5zZW5kWE1QUE1lc3NhZ2UnKS5jc3Moe3dpZHRoOiAnJ30pOwogICAgICAgICAgICAgICAgICAgIHRoaXMuJCgnZGl2LnBhcnRpY2lwYW50cycpLnNob3coKS5hbmltYXRlKHt3aWR0aDogJ2F1dG8nfSwgJC5wcm94eShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2Nyb2xsRG93bigpOwogICAgICAgICAgICAgICAgICAgIH0sIHRoaXMpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIG9uQ29tbWFuZEVycm9yOiBmdW5jdGlvbiAoc3RhbnphKSB7CiAgICAgICAgICAgICAgICB0aGlzLnNob3dTdGF0dXNOb3RpZmljYXRpb24oX18oIkVycm9yOiBjb3VsZCBub3QgZXhlY3V0ZSB0aGUgY29tbWFuZCIpLCB0cnVlKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGNyZWF0ZUNoYXRSb29tTWVzc2FnZTogZnVuY3Rpb24gKHRleHQpIHsKICAgICAgICAgICAgICAgIHZhciBmdWxsbmFtZSA9IGNvbnZlcnNlLnhtcHBzdGF0dXMuZ2V0KCdmdWxsbmFtZScpOwogICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5tZXNzYWdlcy5jcmVhdGUoewogICAgICAgICAgICAgICAgICAgIGZ1bGxuYW1lOiBfLmlzRW1wdHkoZnVsbG5hbWUpPyBjb252ZXJzZS5iYXJlX2ppZDogZnVsbG5hbWUsCiAgICAgICAgICAgICAgICAgICAgc2VuZGVyOiAnbWUnLAogICAgICAgICAgICAgICAgICAgIHRpbWU6IG1vbWVudCgpLmZvcm1hdCgpLAogICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IHRleHQsCiAgICAgICAgICAgICAgICAgICAgbXNnaWQ6IGNvbnZlcnNlLmNvbm5lY3Rpb24ubXVjLmdyb3VwY2hhdCh0aGlzLm1vZGVsLmdldCgnamlkJyksIHRleHQsIHVuZGVmaW5lZCwgU3RyaW5nKChuZXcgRGF0ZSgpKS5nZXRUaW1lKCkpKQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBzZW5kQ2hhdFJvb21NZXNzYWdlOiBmdW5jdGlvbiAodGV4dCkgewogICAgICAgICAgICAgICAgdmFyIG1hdGNoID0gdGV4dC5yZXBsYWNlKC9eXHMqLywgIiIpLm1hdGNoKC9eXC8oLio/KSg/OiAoLiopKT8kLykgfHwgW2ZhbHNlXSwgYXJnczsKICAgICAgICAgICAgICAgIHN3aXRjaCAobWF0Y2hbMV0pIHsKICAgICAgICAgICAgICAgICAgICBjYXNlICdiYW4nOgogICAgICAgICAgICAgICAgICAgICAgICBhcmdzID0gbWF0Y2hbMl0uc3BsaXRPbmNlKCcgJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLmNvbm5lY3Rpb24ubXVjLmJhbih0aGlzLm1vZGVsLmdldCgnamlkJyksIGFyZ3NbMF0sIGFyZ3NbMV0sIHVuZGVmaW5lZCwgJC5wcm94eSh0aGlzLm9uQ29tbWFuZEVycm9yLCB0aGlzKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgJ2NsZWFyJzoKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGVhckNoYXRSb29tTWVzc2FnZXMoKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnZGVvcCc6CiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MgPSBtYXRjaFsyXS5zcGxpdE9uY2UoJyAnKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29udmVyc2UuY29ubmVjdGlvbi5tdWMuZGVvcCh0aGlzLm1vZGVsLmdldCgnamlkJyksIGFyZ3NbMF0sIGFyZ3NbMV0sIHVuZGVmaW5lZCwgJC5wcm94eSh0aGlzLm9uQ29tbWFuZEVycm9yLCB0aGlzKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgJ2hlbHAnOgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dIZWxwTWVzc2FnZXMoWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxzdHJvbmc+L2Jhbjwvc3Ryb25nPjogJyAgICtfXygnQmFuIHVzZXIgZnJvbSByb29tJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPHN0cm9uZz4vY2xlYXI8L3N0cm9uZz46ICcgK19fKCdSZW1vdmUgbWVzc2FnZXMnKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8c3Ryb25nPi9oZWxwPC9zdHJvbmc+OiAnICArX18oJ1Nob3cgdGhpcyBtZW51JyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPHN0cm9uZz4va2ljazwvc3Ryb25nPjogJyAgK19fKCdLaWNrIHVzZXIgZnJvbSByb29tJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPHN0cm9uZz4vbWU8L3N0cm9uZz46ICcgICAgK19fKCdXcml0ZSBpbiAzcmQgcGVyc29uJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPHN0cm9uZz4vbXV0ZTwvc3Ryb25nPjogJyAgK19fKCJSZW1vdmUgdXNlcidzIGFiaWxpdHkgdG8gcG9zdCBtZXNzYWdlcyIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxzdHJvbmc+L25pY2s8L3N0cm9uZz46ICcgICtfXygnQ2hhbmdlIHlvdXIgbmlja25hbWUnKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8c3Ryb25nPi90b3BpYzwvc3Ryb25nPjogJyArX18oJ1NldCByb29tIHRvcGljJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPHN0cm9uZz4vdm9pY2U8L3N0cm9uZz46ICcgK19fKCdBbGxvdyBtdXRlZCB1c2VyIHRvIHBvc3QgbWVzc2FnZXMnKQogICAgICAgICAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAna2ljayc6CiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MgPSBtYXRjaFsyXS5zcGxpdE9uY2UoJyAnKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29udmVyc2UuY29ubmVjdGlvbi5tdWMua2ljayh0aGlzLm1vZGVsLmdldCgnamlkJyksIGFyZ3NbMF0sIGFyZ3NbMV0sIHVuZGVmaW5lZCwgJC5wcm94eSh0aGlzLm9uQ29tbWFuZEVycm9yLCB0aGlzKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgJ211dGUnOgogICAgICAgICAgICAgICAgICAgICAgICBhcmdzID0gbWF0Y2hbMl0uc3BsaXRPbmNlKCcgJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLmNvbm5lY3Rpb24ubXVjLm11dGUodGhpcy5tb2RlbC5nZXQoJ2ppZCcpLCBhcmdzWzBdLCBhcmdzWzFdLCB1bmRlZmluZWQsICQucHJveHkodGhpcy5vbkNvbW1hbmRFcnJvciwgdGhpcykpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICduaWNrJzoKICAgICAgICAgICAgICAgICAgICAgICAgY29udmVyc2UuY29ubmVjdGlvbi5tdWMuY2hhbmdlTmljayh0aGlzLm1vZGVsLmdldCgnamlkJyksIG1hdGNoWzJdKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnb3AnOgogICAgICAgICAgICAgICAgICAgICAgICBhcmdzID0gbWF0Y2hbMl0uc3BsaXRPbmNlKCcgJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLmNvbm5lY3Rpb24ubXVjLm9wKHRoaXMubW9kZWwuZ2V0KCdqaWQnKSwgYXJnc1swXSwgYXJnc1sxXSwgdW5kZWZpbmVkLCAkLnByb3h5KHRoaXMub25Db21tYW5kRXJyb3IsIHRoaXMpKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAndG9waWMnOgogICAgICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS5jb25uZWN0aW9uLm11Yy5zZXRUb3BpYyh0aGlzLm1vZGVsLmdldCgnamlkJyksIG1hdGNoWzJdKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAndm9pY2UnOgogICAgICAgICAgICAgICAgICAgICAgICBhcmdzID0gbWF0Y2hbMl0uc3BsaXRPbmNlKCcgJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLmNvbm5lY3Rpb24ubXVjLnZvaWNlKHRoaXMubW9kZWwuZ2V0KCdqaWQnKSwgYXJnc1swXSwgYXJnc1sxXSwgdW5kZWZpbmVkLCAkLnByb3h5KHRoaXMub25Db21tYW5kRXJyb3IsIHRoaXMpKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jcmVhdGVDaGF0Um9vbU1lc3NhZ2UodGV4dCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBjb25uZWN0OiBmdW5jdGlvbiAocGFzc3dvcmQpIHsKICAgICAgICAgICAgICAgIGlmIChfLmhhcyhjb252ZXJzZS5jb25uZWN0aW9uLm11Yy5yb29tcywgdGhpcy5tb2RlbC5nZXQoJ2ppZCcpKSkgewogICAgICAgICAgICAgICAgICAgIC8vIElmIHRoZSByb29tIGV4aXN0cywgaXQgYWxyZWFkeSBoYXMgZXZlbnQgbGlzdGVuZXJzLCBzbyB3ZQogICAgICAgICAgICAgICAgICAgIC8vIGRvbid0IGFkZCB0aGVtIGFnYWluLgogICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLmNvbm5lY3Rpb24ubXVjLmpvaW4oCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuZ2V0KCdqaWQnKSwgdGhpcy5tb2RlbC5nZXQoJ25pY2snKSwgbnVsbCwgbnVsbCwgbnVsbCwgcGFzc3dvcmQpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS5jb25uZWN0aW9uLm11Yy5qb2luKAogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLmdldCgnamlkJyksCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuZ2V0KCduaWNrJyksCiAgICAgICAgICAgICAgICAgICAgICAgICQucHJveHkodGhpcy5vbkNoYXRSb29tTWVzc2FnZSwgdGhpcyksCiAgICAgICAgICAgICAgICAgICAgICAgICQucHJveHkodGhpcy5vbkNoYXRSb29tUHJlc2VuY2UsIHRoaXMpLAogICAgICAgICAgICAgICAgICAgICAgICAkLnByb3h5KHRoaXMub25DaGF0Um9vbVJvc3RlciwgdGhpcyksCiAgICAgICAgICAgICAgICAgICAgICAgIHBhc3N3b3JkKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIG9uTGVhdmU6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuc2V0KCdjb25uZWN0ZWQnLCBmYWxzZSk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICByZW5kZXJDb25maWd1cmF0aW9uRm9ybTogZnVuY3Rpb24gKHN0YW56YSkgewogICAgICAgICAgICAgICAgdmFyICRmb3JtPSB0aGlzLiRlbC5maW5kKCdmb3JtLmNoYXRyb29tLWZvcm0nKSwKICAgICAgICAgICAgICAgICAgICAkc3RhbnphID0gJChzdGFuemEpLAogICAgICAgICAgICAgICAgICAgICRmaWVsZHMgPSAkc3RhbnphLmZpbmQoJ2ZpZWxkJyksCiAgICAgICAgICAgICAgICAgICAgdGl0bGUgPSAkc3RhbnphLmZpbmQoJ3RpdGxlJykudGV4dCgpLAogICAgICAgICAgICAgICAgICAgIGluc3RydWN0aW9ucyA9ICRzdGFuemEuZmluZCgnaW5zdHJ1Y3Rpb25zJykudGV4dCgpLAogICAgICAgICAgICAgICAgICAgIGksIGosIG9wdGlvbnM9W10sICRmaWVsZCwgJG9wdGlvbnM7CiAgICAgICAgICAgICAgICB2YXIgaW5wdXRfdHlwZXMgPSB7CiAgICAgICAgICAgICAgICAgICAgJ3RleHQtcHJpdmF0ZSc6ICdwYXNzd29yZCcsCiAgICAgICAgICAgICAgICAgICAgJ3RleHQtc2luZ2xlJzogJ3RleHRsaW5lJywKICAgICAgICAgICAgICAgICAgICAnYm9vbGVhbic6ICdjaGVja2JveCcsCiAgICAgICAgICAgICAgICAgICAgJ2hpZGRlbic6ICdoaWRkZW4nLAogICAgICAgICAgICAgICAgICAgICdsaXN0LXNpbmdsZSc6ICdkcm9wZG93bicKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAkZm9ybS5maW5kKCdzcGFuLnNwaW5uZXInKS5yZW1vdmUoKTsKICAgICAgICAgICAgICAgICRmb3JtLmFwcGVuZCgkKCc8bGVnZW5kPicpLnRleHQodGl0bGUpKTsKICAgICAgICAgICAgICAgIGlmIChpbnN0cnVjdGlvbnMgIT0gdGl0bGUpIHsKICAgICAgICAgICAgICAgICAgICAkZm9ybS5hcHBlbmQoJCgnPHA+JykudGV4dChpbnN0cnVjdGlvbnMpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGZvciAoaT0wOyBpPCRmaWVsZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAkZmllbGQgPSAkKCRmaWVsZHNbaV0pOwogICAgICAgICAgICAgICAgICAgIGlmICgkZmllbGQuYXR0cigndHlwZScpID09ICdsaXN0LXNpbmdsZScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucyA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICAkb3B0aW9ucyA9ICRmaWVsZC5maW5kKCdvcHRpb24nKTsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChqPTA7IGo8JG9wdGlvbnMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMucHVzaChjb252ZXJzZS50ZW1wbGF0ZXMuc2VsZWN0X29wdGlvbih7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6ICQoJG9wdGlvbnNbal0pLmZpbmQoJ3ZhbHVlJykudGV4dCgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiAkKCRvcHRpb25zW2pdKS5hdHRyKCdsYWJlbCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgJGZvcm0uYXBwZW5kKGNvbnZlcnNlLnRlbXBsYXRlcy5mb3JtX3NlbGVjdCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAkZmllbGQuYXR0cigndmFyJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogJGZpZWxkLmF0dHIoJ2xhYmVsJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zOiBvcHRpb25zLmpvaW4oJycpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCRmaWVsZC5hdHRyKCd0eXBlJykgPT0gJ2Jvb2xlYW4nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRmb3JtLmFwcGVuZChjb252ZXJzZS50ZW1wbGF0ZXMuZm9ybV9jaGVja2JveCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAkZmllbGQuYXR0cigndmFyJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBpbnB1dF90eXBlc1skZmllbGQuYXR0cigndHlwZScpXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiAkZmllbGQuYXR0cignbGFiZWwnKSB8fCAnJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrZWQ6ICRmaWVsZC5maW5kKCd2YWx1ZScpLnRleHQoKSA9PT0gIjEiICYmICdjaGVja2VkPSIxIicgfHwgJycKICAgICAgICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRmb3JtLmFwcGVuZChjb252ZXJzZS50ZW1wbGF0ZXMuZm9ybV9pbnB1dCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAkZmllbGQuYXR0cigndmFyJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBpbnB1dF90eXBlc1skZmllbGQuYXR0cigndHlwZScpXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiAkZmllbGQuYXR0cignbGFiZWwnKSB8fCAnJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiAkZmllbGQuZmluZCgndmFsdWUnKS50ZXh0KCkKICAgICAgICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRmb3JtLmFwcGVuZCgnPGlucHV0IHR5cGU9InN1Ym1pdCIgdmFsdWU9IicrX18oJ1NhdmUnKSsnIi8+Jyk7CiAgICAgICAgICAgICAgICAkZm9ybS5hcHBlbmQoJzxpbnB1dCB0eXBlPSJidXR0b24iIHZhbHVlPSInK19fKCdDYW5jZWwnKSsnIi8+Jyk7CiAgICAgICAgICAgICAgICAkZm9ybS5vbignc3VibWl0JywgJC5wcm94eSh0aGlzLnNhdmVDb25maWd1cmF0aW9uLCB0aGlzKSk7CiAgICAgICAgICAgICAgICAkZm9ybS5maW5kKCdpbnB1dFt0eXBlPWJ1dHRvbl0nKS5vbignY2xpY2snLCAkLnByb3h5KHRoaXMuY2FuY2VsQ29uZmlndXJhdGlvbiwgdGhpcykpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgc2F2ZUNvbmZpZ3VyYXRpb246IGZ1bmN0aW9uIChldikgewogICAgICAgICAgICAgICAgZXYucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpczsKICAgICAgICAgICAgICAgIHZhciAkaW5wdXRzID0gJChldi50YXJnZXQpLmZpbmQoJzppbnB1dDpub3QoW3R5cGU9YnV0dG9uXSk6bm90KFt0eXBlPXN1Ym1pdF0pJyksCiAgICAgICAgICAgICAgICAgICAgY291bnQgPSAkaW5wdXRzLmxlbmd0aCwKICAgICAgICAgICAgICAgICAgICBjb25maWdBcnJheSA9IFtdOwogICAgICAgICAgICAgICAgJGlucHV0cy5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgJGlucHV0ID0gJCh0aGlzKSwgdmFsdWU7CiAgICAgICAgICAgICAgICAgICAgaWYgKCRpbnB1dC5pcygnW3R5cGU9Y2hlY2tib3hdJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSAkaW5wdXQuaXMoJzpjaGVja2VkJykgJiYgMSB8fCAwOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gJGlucHV0LnZhbCgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB2YXIgY25vZGUgPSAkKGNvbnZlcnNlLnRlbXBsYXRlcy5maWVsZCh7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICRpbnB1dC5hdHRyKCduYW1lJyksCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB2YWx1ZQogICAgICAgICAgICAgICAgICAgIH0pKVswXTsKICAgICAgICAgICAgICAgICAgICBjb25maWdBcnJheS5wdXNoKGNub2RlKTsKICAgICAgICAgICAgICAgICAgICBpZiAoIS0tY291bnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29udmVyc2UuY29ubmVjdGlvbi5tdWMuc2F2ZUNvbmZpZ3VyYXRpb24oCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGF0Lm1vZGVsLmdldCgnamlkJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWdBcnJheSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICQucHJveHkodGhhdC5vbkNvbmZpZ1NhdmVkLCB0aGF0KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICQucHJveHkodGhhdC5vbkVycm9yQ29uZmlnU2F2ZWQsIHRoYXQpCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB0aGlzLiRlbC5maW5kKCdkaXYuY2hhdHJvb20tZm9ybS1jb250YWluZXInKS5oaWRlKAogICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5yZW1vdmUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC4kZWwuZmluZCgnLmNoYXQtYXJlYScpLnNob3coKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC4kZWwuZmluZCgnLnBhcnRpY2lwYW50cycpLnNob3coKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIG9uQ29uZmlnU2F2ZWQ6IGZ1bmN0aW9uIChzdGFuemEpIHsKICAgICAgICAgICAgICAgIC8vIFhYWAogICAgICAgICAgICB9LAoKICAgICAgICAgICAgb25FcnJvckNvbmZpZ1NhdmVkOiBmdW5jdGlvbiAoc3RhbnphKSB7CiAgICAgICAgICAgICAgICB0aGlzLnNob3dTdGF0dXNOb3RpZmljYXRpb24oX18oIkFuIGVycm9yIG9jY3VycmVkIHdoaWxlIHRyeWluZyB0byBzYXZlIHRoZSBmb3JtLiIpKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGNhbmNlbENvbmZpZ3VyYXRpb246IGZ1bmN0aW9uIChldikgewogICAgICAgICAgICAgICAgZXYucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpczsKICAgICAgICAgICAgICAgIHRoaXMuJGVsLmZpbmQoJ2Rpdi5jaGF0cm9vbS1mb3JtLWNvbnRhaW5lcicpLmhpZGUoCiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGF0LiRlbC5maW5kKCcuY2hhdC1hcmVhJykuc2hvdygpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGF0LiRlbC5maW5kKCcucGFydGljaXBhbnRzJykuc2hvdygpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgY29uZmlndXJlQ2hhdFJvb206IGZ1bmN0aW9uIChldikgewogICAgICAgICAgICAgICAgZXYucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLiRlbC5maW5kKCdkaXYuY2hhdHJvb20tZm9ybS1jb250YWluZXInKS5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLiQoJy5jaGF0LWJvZHknKS5jaGlsZHJlbigpLmhpZGUoKTsKICAgICAgICAgICAgICAgIHRoaXMuJCgnLmNoYXQtYm9keScpLmFwcGVuZCgKICAgICAgICAgICAgICAgICAgICAkKCc8ZGl2IGNsYXNzPSJjaGF0cm9vbS1mb3JtLWNvbnRhaW5lciI+JysKICAgICAgICAgICAgICAgICAgICAgICAgJzxmb3JtIGNsYXNzPSJjaGF0cm9vbS1mb3JtIj4nKwogICAgICAgICAgICAgICAgICAgICAgICAnPHNwYW4gY2xhc3M9InNwaW5uZXIgY2VudGVyZWQiLz4nKwogICAgICAgICAgICAgICAgICAgICAgICAnPC9mb3JtPicrCiAgICAgICAgICAgICAgICAgICAgJzwvZGl2PicpKTsKICAgICAgICAgICAgICAgIGNvbnZlcnNlLmNvbm5lY3Rpb24ubXVjLmNvbmZpZ3VyZSgKICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLmdldCgnamlkJyksCiAgICAgICAgICAgICAgICAgICAgJC5wcm94eSh0aGlzLnJlbmRlckNvbmZpZ3VyYXRpb25Gb3JtLCB0aGlzKQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHN1Ym1pdFBhc3N3b3JkOiBmdW5jdGlvbiAoZXYpIHsKICAgICAgICAgICAgICAgIGV2LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICB2YXIgcGFzc3dvcmQgPSB0aGlzLiRlbC5maW5kKCcuY2hhdHJvb20tZm9ybScpLmZpbmQoJ2lucHV0W3R5cGU9cGFzc3dvcmRdJykudmFsKCk7CiAgICAgICAgICAgICAgICB0aGlzLiRlbC5maW5kKCcuY2hhdHJvb20tZm9ybS1jb250YWluZXInKS5yZXBsYWNlV2l0aCgnPHNwYW4gY2xhc3M9InNwaW5uZXIgY2VudGVyZWQiLz4nKTsKICAgICAgICAgICAgICAgIHRoaXMuY29ubmVjdChwYXNzd29yZCk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICByZW5kZXJQYXNzd29yZEZvcm06IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHRoaXMuJCgnLmNoYXQtYm9keScpLmNoaWxkcmVuKCkuaGlkZSgpOwogICAgICAgICAgICAgICAgdGhpcy4kKCdzcGFuLmNlbnRlcmVkLnNwaW5uZXInKS5yZW1vdmUoKTsKICAgICAgICAgICAgICAgIHRoaXMuJCgnLmNoYXQtYm9keScpLmFwcGVuZCgKICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS50ZW1wbGF0ZXMuY2hhdHJvb21fcGFzc3dvcmRfZm9ybSh7CiAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRpbmc6IF9fKCdUaGlzIGNoYXRyb29tIHJlcXVpcmVzIGEgcGFzc3dvcmQnKSwKICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWxfcGFzc3dvcmQ6IF9fKCdQYXNzd29yZDogJyksCiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsX3N1Ym1pdDogX18oJ1N1Ym1pdCcpCiAgICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgdGhpcy4kKCcuY2hhdHJvb20tZm9ybScpLm9uKCdzdWJtaXQnLCAkLnByb3h5KHRoaXMuc3VibWl0UGFzc3dvcmQsIHRoaXMpKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHNob3dEaXNjb25uZWN0TWVzc2FnZTogZnVuY3Rpb24gKG1zZykgewogICAgICAgICAgICAgICAgdGhpcy4kKCcuY2hhdC1hcmVhJykuaGlkZSgpOwogICAgICAgICAgICAgICAgdGhpcy4kKCcucGFydGljaXBhbnRzJykuaGlkZSgpOwogICAgICAgICAgICAgICAgdGhpcy4kKCdzcGFuLmNlbnRlcmVkLnNwaW5uZXInKS5yZW1vdmUoKTsKICAgICAgICAgICAgICAgIHRoaXMuJCgnLmNoYXQtYm9keScpLmFwcGVuZCgkKCc8cD4nK21zZysnPC9wPicpKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIC8qIGh0dHA6Ly94bXBwLm9yZy9leHRlbnNpb25zL3hlcC0wMDQ1Lmh0bWwKICAgICAgICAgICAgICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICAgICAgICAgKiAxMDAgbWVzc2FnZSAgICAgIEVudGVyaW5nIGEgcm9vbSAgICAgICAgIEluZm9ybSB1c2VyIHRoYXQgYW55IG9jY3VwYW50IGlzIGFsbG93ZWQgdG8gc2VlIHRoZSB1c2VyJ3MgZnVsbCBKSUQKICAgICAgICAgICAgICogMTAxIG1lc3NhZ2UgKG91dCBvZiBiYW5kKSAgICAgICAgICAgICAgICBBZmZpbGlhdGlvbiBjaGFuZ2UgIEluZm9ybSB1c2VyIHRoYXQgaGlzIG9yIGhlciBhZmZpbGlhdGlvbiBjaGFuZ2VkIHdoaWxlIG5vdCBpbiB0aGUgcm9vbQogICAgICAgICAgICAgKiAxMDIgbWVzc2FnZSAgICAgIENvbmZpZ3VyYXRpb24gY2hhbmdlICAgIEluZm9ybSBvY2N1cGFudHMgdGhhdCByb29tIG5vdyBzaG93cyB1bmF2YWlsYWJsZSBtZW1iZXJzCiAgICAgICAgICAgICAqIDEwMyBtZXNzYWdlICAgICAgQ29uZmlndXJhdGlvbiBjaGFuZ2UgICAgSW5mb3JtIG9jY3VwYW50cyB0aGF0IHJvb20gbm93IGRvZXMgbm90IHNob3cgdW5hdmFpbGFibGUgbWVtYmVycwogICAgICAgICAgICAgKiAxMDQgbWVzc2FnZSAgICAgIENvbmZpZ3VyYXRpb24gY2hhbmdlICAgIEluZm9ybSBvY2N1cGFudHMgdGhhdCBhIG5vbi1wcml2YWN5LXJlbGF0ZWQgcm9vbSBjb25maWd1cmF0aW9uIGNoYW5nZSBoYXMgb2NjdXJyZWQKICAgICAgICAgICAgICogMTEwIHByZXNlbmNlICAgICBBbnkgcm9vbSBwcmVzZW5jZSAgICAgICBJbmZvcm0gdXNlciB0aGF0IHByZXNlbmNlIHJlZmVycyB0byBvbmUgb2YgaXRzIG93biByb29tIG9jY3VwYW50cwogICAgICAgICAgICAgKiAxNzAgbWVzc2FnZSBvciBpbml0aWFsIHByZXNlbmNlICAgICAgICAgIENvbmZpZ3VyYXRpb24gY2hhbmdlICAgIEluZm9ybSBvY2N1cGFudHMgdGhhdCByb29tIGxvZ2dpbmcgaXMgbm93IGVuYWJsZWQKICAgICAgICAgICAgICogMTcxIG1lc3NhZ2UgICAgICBDb25maWd1cmF0aW9uIGNoYW5nZSAgICBJbmZvcm0gb2NjdXBhbnRzIHRoYXQgcm9vbSBsb2dnaW5nIGlzIG5vdyBkaXNhYmxlZAogICAgICAgICAgICAgKiAxNzIgbWVzc2FnZSAgICAgIENvbmZpZ3VyYXRpb24gY2hhbmdlICAgIEluZm9ybSBvY2N1cGFudHMgdGhhdCB0aGUgcm9vbSBpcyBub3cgbm9uLWFub255bW91cwogICAgICAgICAgICAgKiAxNzMgbWVzc2FnZSAgICAgIENvbmZpZ3VyYXRpb24gY2hhbmdlICAgIEluZm9ybSBvY2N1cGFudHMgdGhhdCB0aGUgcm9vbSBpcyBub3cgc2VtaS1hbm9ueW1vdXMKICAgICAgICAgICAgICogMTc0IG1lc3NhZ2UgICAgICBDb25maWd1cmF0aW9uIGNoYW5nZSAgICBJbmZvcm0gb2NjdXBhbnRzIHRoYXQgdGhlIHJvb20gaXMgbm93IGZ1bGx5LWFub255bW91cwogICAgICAgICAgICAgKiAyMDEgcHJlc2VuY2UgICAgIEVudGVyaW5nIGEgcm9vbSAgICAgICAgIEluZm9ybSB1c2VyIHRoYXQgYSBuZXcgcm9vbSBoYXMgYmVlbiBjcmVhdGVkCiAgICAgICAgICAgICAqIDIxMCBwcmVzZW5jZSAgICAgRW50ZXJpbmcgYSByb29tICAgICAgICAgSW5mb3JtIHVzZXIgdGhhdCB0aGUgc2VydmljZSBoYXMgYXNzaWduZWQgb3IgbW9kaWZpZWQgdGhlIG9jY3VwYW50J3Mgcm9vbW5pY2sKICAgICAgICAgICAgICogMzAxIHByZXNlbmNlICAgICBSZW1vdmFsIGZyb20gcm9vbSAgICAgICBJbmZvcm0gdXNlciB0aGF0IGhlIG9yIHNoZSBoYXMgYmVlbiBiYW5uZWQgZnJvbSB0aGUgcm9vbQogICAgICAgICAgICAgKiAzMDMgcHJlc2VuY2UgICAgIEV4aXRpbmcgYSByb29tICAgICAgICAgIEluZm9ybSBhbGwgb2NjdXBhbnRzIG9mIG5ldyByb29tIG5pY2tuYW1lCiAgICAgICAgICAgICAqIDMwNyBwcmVzZW5jZSAgICAgUmVtb3ZhbCBmcm9tIHJvb20gICAgICAgSW5mb3JtIHVzZXIgdGhhdCBoZSBvciBzaGUgaGFzIGJlZW4ga2lja2VkIGZyb20gdGhlIHJvb20KICAgICAgICAgICAgICogMzIxIHByZXNlbmNlICAgICBSZW1vdmFsIGZyb20gcm9vbSAgICAgICBJbmZvcm0gdXNlciB0aGF0IGhlIG9yIHNoZSBpcyBiZWluZyByZW1vdmVkIGZyb20gdGhlIHJvb20gYmVjYXVzZSBvZiBhbiBhZmZpbGlhdGlvbiBjaGFuZ2UKICAgICAgICAgICAgICogMzIyIHByZXNlbmNlICAgICBSZW1vdmFsIGZyb20gcm9vbSAgICAgICBJbmZvcm0gdXNlciB0aGF0IGhlIG9yIHNoZSBpcyBiZWluZyByZW1vdmVkIGZyb20gdGhlIHJvb20gYmVjYXVzZSB0aGUgcm9vbSBoYXMgYmVlbiBjaGFuZ2VkIHRvIG1lbWJlcnMtb25seSBhbmQgdGhlIHVzZXIgaXMgbm90IGEgbWVtYmVyCiAgICAgICAgICAgICAqIDMzMiBwcmVzZW5jZSAgICAgUmVtb3ZhbCBmcm9tIHJvb20gICAgICAgSW5mb3JtIHVzZXIgdGhhdCBoZSBvciBzaGUgaXMgYmVpbmcgcmVtb3ZlZCBmcm9tIHRoZSByb29tIGJlY2F1c2Ugb2YgYSBzeXN0ZW0gc2h1dGRvd24KICAgICAgICAgICAgICovCiAgICAgICAgICAgIGluZm9NZXNzYWdlczogewogICAgICAgICAgICAgICAgMTAwOiBfXygnVGhpcyByb29tIGlzIG5vdCBhbm9ueW1vdXMnKSwKICAgICAgICAgICAgICAgIDEwMjogX18oJ1RoaXMgcm9vbSBub3cgc2hvd3MgdW5hdmFpbGFibGUgbWVtYmVycycpLAogICAgICAgICAgICAgICAgMTAzOiBfXygnVGhpcyByb29tIGRvZXMgbm90IHNob3cgdW5hdmFpbGFibGUgbWVtYmVycycpLAogICAgICAgICAgICAgICAgMTA0OiBfXygnTm9uLXByaXZhY3ktcmVsYXRlZCByb29tIGNvbmZpZ3VyYXRpb24gaGFzIGNoYW5nZWQnKSwKICAgICAgICAgICAgICAgIDE3MDogX18oJ1Jvb20gbG9nZ2luZyBpcyBub3cgZW5hYmxlZCcpLAogICAgICAgICAgICAgICAgMTcxOiBfXygnUm9vbSBsb2dnaW5nIGlzIG5vdyBkaXNhYmxlZCcpLAogICAgICAgICAgICAgICAgMTcyOiBfXygnVGhpcyByb29tIGlzIG5vdyBub24tYW5vbnltb3VzJyksCiAgICAgICAgICAgICAgICAxNzM6IF9fKCdUaGlzIHJvb20gaXMgbm93IHNlbWktYW5vbnltb3VzJyksCiAgICAgICAgICAgICAgICAxNzQ6IF9fKCdUaGlzIHJvb20gaXMgbm93IGZ1bGx5LWFub255bW91cycpLAogICAgICAgICAgICAgICAgMjAxOiBfXygnQSBuZXcgcm9vbSBoYXMgYmVlbiBjcmVhdGVkJykKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGRpc2Nvbm5lY3RNZXNzYWdlczogewogICAgICAgICAgICAgICAgMzAxOiBfXygnWW91IGhhdmUgYmVlbiBiYW5uZWQgZnJvbSB0aGlzIHJvb20nKSwKICAgICAgICAgICAgICAgIDMwNzogX18oJ1lvdSBoYXZlIGJlZW4ga2lja2VkIGZyb20gdGhpcyByb29tJyksCiAgICAgICAgICAgICAgICAzMjE6IF9fKCJZb3UgaGF2ZSBiZWVuIHJlbW92ZWQgZnJvbSB0aGlzIHJvb20gYmVjYXVzZSBvZiBhbiBhZmZpbGlhdGlvbiBjaGFuZ2UiKSwKICAgICAgICAgICAgICAgIDMyMjogX18oIllvdSBoYXZlIGJlZW4gcmVtb3ZlZCBmcm9tIHRoaXMgcm9vbSBiZWNhdXNlIHRoZSByb29tIGhhcyBjaGFuZ2VkIHRvIG1lbWJlcnMtb25seSBhbmQgeW91J3JlIG5vdCBhIG1lbWJlciIpLAogICAgICAgICAgICAgICAgMzMyOiBfXygiWW91IGhhdmUgYmVlbiByZW1vdmVkIGZyb20gdGhpcyByb29tIGJlY2F1c2UgdGhlIE1VQyAoTXVsdGktdXNlciBjaGF0KSBzZXJ2aWNlIGlzIGJlaW5nIHNodXQgZG93bi4iKQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgYWN0aW9uSW5mb01lc3NhZ2VzOiB7CiAgICAgICAgICAgICAgICAvKiBYWFg6IE5vdGUgdGhlIHRyaXBsZSB1bmRlcnNjb3JlIGZ1bmN0aW9uIGFuZCBub3QgZG91YmxlCiAgICAgICAgICAgICAgICAgKiB1bmRlcnNjb3JlLgogICAgICAgICAgICAgICAgICoKICAgICAgICAgICAgICAgICAqIFRoaXMgaXMgYSBoYWNrLiBXZSBjYW4ndCBwYXNzIHRoZSBzdHJpbmdzIHRvIF9fIGJlY2F1c2Ugd2UKICAgICAgICAgICAgICAgICAqIGRvbid0IHlldCBrbm93IHdoYXQgdGhlIHZhcmlhYmxlIHRvIGludGVycG9sYXRlIGlzLgogICAgICAgICAgICAgICAgICoKICAgICAgICAgICAgICAgICAqIFRyaXBsZSB1bmRlcnNjb3JlIHdpbGwganVzdCByZXR1cm4gdGhlIHN0cmluZyBhZ2FpbiwgYnV0IHdlCiAgICAgICAgICAgICAgICAgKiBjYW4gdGhlbiBhdCBsZWFzdCB0ZWxsIGdldHRleHQgdG8gc2NhbiBmb3IgaXQgc28gdGhhdCB0aGVzZQogICAgICAgICAgICAgICAgICogc3RyaW5ncyBhcmUgcGlja2VkIHVwIGJ5IHRoZSB0cmFuc2xhdGlvbiBtYWNoaW5lcnkuCiAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgIDMwMTogX19fKCI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gaGFzIGJlZW4gYmFubmVkIiksCiAgICAgICAgICAgICAgICAzMDM6IF9fXygiPHN0cm9uZz4lMSRzPC9zdHJvbmc+J3Mgbmlja25hbWUgaGFzIGNoYW5nZWQiKSwKICAgICAgICAgICAgICAgIDMwNzogX19fKCI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gaGFzIGJlZW4ga2lja2VkIG91dCIpLAogICAgICAgICAgICAgICAgMzIxOiBfX18oIjxzdHJvbmc+JTEkczwvc3Ryb25nPiBoYXMgYmVlbiByZW1vdmVkIGJlY2F1c2Ugb2YgYW4gYWZmaWxpYXRpb24gY2hhbmdlIiksCiAgICAgICAgICAgICAgICAzMjI6IF9fXygiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IGhhcyBiZWVuIHJlbW92ZWQgZm9yIG5vdCBiZWluZyBhIG1lbWJlciIpCiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBuZXdOaWNrbmFtZU1lc3NhZ2VzOiB7CiAgICAgICAgICAgICAgICAyMTA6IF9fXygnWW91ciBuaWNrbmFtZSBoYXMgYmVlbiBhdXRvbWF0aWNhbGx5IGNoYW5nZWQgdG86IDxzdHJvbmc+JTEkczwvc3Ryb25nPicpLAogICAgICAgICAgICAgICAgMzAzOiBfX18oJ1lvdXIgbmlja25hbWUgaGFzIGJlZW4gY2hhbmdlZCB0bzogPHN0cm9uZz4lMSRzPC9zdHJvbmc+JykKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHNob3dTdGF0dXNNZXNzYWdlczogZnVuY3Rpb24gKCRlbCwgaXNfc2VsZikgewogICAgICAgICAgICAgICAgLyogQ2hlY2sgZm9yIHN0YXR1cyBjb2RlcyBhbmQgY29tbXVuaWNhdGUgdGhlaXIgcHVycG9zZSB0byB0aGUgdXNlci4KICAgICAgICAgICAgICAgICAqIEFsbG93IHVzZXIgdG8gY29uZmlndXJlIGNoYXQgcm9vbSBpZiB0aGV5IGFyZSB0aGUgb3duZXIuCiAgICAgICAgICAgICAgICAgKiBTZWU6IGh0dHA6Ly94bXBwLm9yZy9yZWdpc3RyYXIvbXVjc3RhdHVzLmh0bWwKICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgdmFyICRjaGF0X2NvbnRlbnQsCiAgICAgICAgICAgICAgICAgICAgZGlzY29ubmVjdF9tc2dzID0gW10sCiAgICAgICAgICAgICAgICAgICAgbXNncyA9IFtdLAogICAgICAgICAgICAgICAgICAgIHJlYXNvbnMgPSBbXTsKICAgICAgICAgICAgICAgICRlbC5maW5kKCd4W3htbG5zPSInK1N0cm9waGUuTlMuTVVDX1VTRVIrJyJdJykuZWFjaCgkLnByb3h5KGZ1bmN0aW9uIChpZHgsIHgpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgJGl0ZW0gPSAkKHgpLmZpbmQoJ2l0ZW0nKTsKICAgICAgICAgICAgICAgICAgICBpZiAoU3Ryb3BoZS5nZXRCYXJlSmlkRnJvbUppZCgkaXRlbS5hdHRyKCdqaWQnKSkgPT09IGNvbnZlcnNlLmJhcmVfamlkICYmICRpdGVtLmF0dHIoJ2FmZmlsaWF0aW9uJykgPT09ICdvd25lcicpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kZWwuZmluZCgnYS5jb25maWd1cmUtY2hhdHJvb20tYnV0dG9uJykuc2hvdygpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAkKHgpLmZpbmQoJ2l0ZW0gcmVhc29uJykuZWFjaChmdW5jdGlvbiAoaWR4LCByZWFzb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCQocmVhc29uKS50ZXh0KCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlYXNvbnMucHVzaCgkKHJlYXNvbikudGV4dCgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICQoeCkuZmluZCgnc3RhdHVzJykuZWFjaCgkLnByb3h5KGZ1bmN0aW9uIChpZHgsIHN0YXQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvZGUgPSBzdGF0LmdldEF0dHJpYnV0ZSgnY29kZScpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNfc2VsZiAmJiBfLmNvbnRhaW5zKF8ua2V5cyh0aGlzLm5ld05pY2tuYW1lTWVzc2FnZXMpLCBjb2RlKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5zYXZlKHsnbmljayc6IFN0cm9waGUuZ2V0UmVzb3VyY2VGcm9tSmlkKCRlbC5hdHRyKCdmcm9tJykpfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtc2dzLnB1c2goX18odGhpcy5uZXdOaWNrbmFtZU1lc3NhZ2VzW2NvZGVdLCAkaXRlbS5hdHRyKCduaWNrJykpKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpc19zZWxmICYmIF8uY29udGFpbnMoXy5rZXlzKHRoaXMuZGlzY29ubmVjdE1lc3NhZ2VzKSwgY29kZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc2Nvbm5lY3RfbXNncy5wdXNoKHRoaXMuZGlzY29ubmVjdE1lc3NhZ2VzW2NvZGVdKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICghaXNfc2VsZiAmJiBfLmNvbnRhaW5zKF8ua2V5cyh0aGlzLmFjdGlvbkluZm9NZXNzYWdlcyksIGNvZGUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtc2dzLnB1c2goCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX18odGhpcy5hY3Rpb25JbmZvTWVzc2FnZXNbY29kZV0sIFN0cm9waGUudW5lc2NhcGVOb2RlKFN0cm9waGUuZ2V0UmVzb3VyY2VGcm9tSmlkKCRlbC5hdHRyKCdmcm9tJykpKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoXy5jb250YWlucyhfLmtleXModGhpcy5pbmZvTWVzc2FnZXMpLCBjb2RlKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbXNncy5wdXNoKHRoaXMuaW5mb01lc3NhZ2VzW2NvZGVdKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjb2RlICE9PSAnMTEwJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCQoc3RhdCkudGV4dCgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXNncy5wdXNoKCQoc3RhdCkudGV4dCgpKTsgLy8gU29tZXRpbWVzIHRoZSBzdGF0dXMgY29udGFpbnMgaHVtYW4gcmVhZGFibGUgdGV4dCBhbmQgbm90IGEgY29kZS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sIHRoaXMpKTsKICAgICAgICAgICAgICAgIH0sIHRoaXMpKTsKCiAgICAgICAgICAgICAgICBpZiAoZGlzY29ubmVjdF9tc2dzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBmb3IgKGk9MDsgaTxkaXNjb25uZWN0X21zZ3MubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93RGlzY29ubmVjdE1lc3NhZ2UoZGlzY29ubmVjdF9tc2dzW2ldKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZm9yIChpPTA7IGk8cmVhc29ucy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dEaXNjb25uZWN0TWVzc2FnZShfXygnVGhlIHJlYXNvbiBnaXZlbiBpczogIicrcmVhc29uc1tpXSsnIicpLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5zZXQoJ2Nvbm5lY3RlZCcsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkY2hhdF9jb250ZW50ID0gdGhpcy4kZWwuZmluZCgnLmNoYXQtY29udGVudCcpOwogICAgICAgICAgICAgICAgZm9yIChpPTA7IGk8bXNncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgICRjaGF0X2NvbnRlbnQuYXBwZW5kKGNvbnZlcnNlLnRlbXBsYXRlcy5pbmZvKHttZXNzYWdlOiBtc2dzW2ldfSkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZm9yIChpPTA7IGk8cmVhc29ucy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd1N0YXR1c05vdGlmaWNhdGlvbihfXygnVGhlIHJlYXNvbiBnaXZlbiBpczogIicrcmVhc29uc1tpXSsnIicpLCB0cnVlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNjcm9sbERvd24oKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHNob3dFcnJvck1lc3NhZ2U6IGZ1bmN0aW9uICgkZXJyb3IsIHJvb20pIHsKICAgICAgICAgICAgICAgIC8vIFdlIGRpZG4ndCBlbnRlciB0aGUgcm9vbSwgc28gd2UgbXVzdCByZW1vdmUgaXQgZnJvbSB0aGUgTVVDCiAgICAgICAgICAgICAgICAvLyBhZGQtb24KICAgICAgICAgICAgICAgIGRlbGV0ZSBjb252ZXJzZS5jb25uZWN0aW9uLm11Y1tyb29tLm5hbWVdOwogICAgICAgICAgICAgICAgaWYgKCRlcnJvci5hdHRyKCd0eXBlJykgPT0gJ2F1dGgnKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCRlcnJvci5maW5kKCdub3QtYXV0aG9yaXplZCcpLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbmRlclBhc3N3b3JkRm9ybSgpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoJGVycm9yLmZpbmQoJ3JlZ2lzdHJhdGlvbi1yZXF1aXJlZCcpLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dEaXNjb25uZWN0TWVzc2FnZShfXygnWW91IGFyZSBub3Qgb24gdGhlIG1lbWJlciBsaXN0IG9mIHRoaXMgcm9vbScpKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCRlcnJvci5maW5kKCdmb3JiaWRkZW4nKS5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93RGlzY29ubmVjdE1lc3NhZ2UoX18oJ1lvdSBoYXZlIGJlZW4gYmFubmVkIGZyb20gdGhpcyByb29tJykpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoJGVycm9yLmF0dHIoJ3R5cGUnKSA9PSAnbW9kaWZ5JykgewogICAgICAgICAgICAgICAgICAgIGlmICgkZXJyb3IuZmluZCgnamlkLW1hbGZvcm1lZCcpLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dEaXNjb25uZWN0TWVzc2FnZShfXygnTm8gbmlja25hbWUgd2FzIHNwZWNpZmllZCcpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCRlcnJvci5hdHRyKCd0eXBlJykgPT0gJ2NhbmNlbCcpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoJGVycm9yLmZpbmQoJ25vdC1hbGxvd2VkJykubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0Rpc2Nvbm5lY3RNZXNzYWdlKF9fKCdZb3UgYXJlIG5vdCBhbGxvd2VkIHRvIGNyZWF0ZSBuZXcgcm9vbXMnKSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICgkZXJyb3IuZmluZCgnbm90LWFjY2VwdGFibGUnKS5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93RGlzY29ubmVjdE1lc3NhZ2UoX18oIllvdXIgbmlja25hbWUgZG9lc24ndCBjb25mb3JtIHRvIHRoaXMgcm9vbSdzIHBvbGljaWVzIikpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoJGVycm9yLmZpbmQoJ2NvbmZsaWN0JykubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRPRE86IGdpdmUgdXNlciB0aGUgb3B0aW9uIG9mIGNob29zaW5nIGEgZGlmZmVyZW50CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIG5pY2tuYW1lCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0Rpc2Nvbm5lY3RNZXNzYWdlKF9fKCJZb3VyIG5pY2tuYW1lIGlzIGFscmVhZHkgdGFrZW4iKSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICgkZXJyb3IuZmluZCgnaXRlbS1ub3QtZm91bmQnKS5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93RGlzY29ubmVjdE1lc3NhZ2UoX18oIlRoaXMgcm9vbSBkb2VzIG5vdCAoeWV0KSBleGlzdCIpKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCRlcnJvci5maW5kKCdzZXJ2aWNlLXVuYXZhaWxhYmxlJykubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0Rpc2Nvbm5lY3RNZXNzYWdlKF9fKCJUaGlzIHJvb20gaGFzIHJlYWNoZWQgaXQncyBtYXhpbXVtIG51bWJlciBvZiBvY2N1cGFudHMiKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgb25DaGF0Um9vbVByZXNlbmNlOiBmdW5jdGlvbiAocHJlc2VuY2UsIHJvb20pIHsKICAgICAgICAgICAgICAgIHZhciAkcHJlc2VuY2UgPSAkKHByZXNlbmNlKSwgaXNfc2VsZjsKICAgICAgICAgICAgICAgIGlmICgkcHJlc2VuY2UuYXR0cigndHlwZScpID09PSAnZXJyb3InKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5zZXQoJ2Nvbm5lY3RlZCcsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dFcnJvck1lc3NhZ2UoJHByZXNlbmNlLmZpbmQoJ2Vycm9yJyksIHJvb20pOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpc19zZWxmID0gKCRwcmVzZW5jZS5maW5kKCJzdGF0dXNbY29kZT0nMTEwJ10iKS5sZW5ndGgpIHx8ICgkcHJlc2VuY2UuYXR0cignZnJvbScpID09IHJvb20ubmFtZSsnLycrU3Ryb3BoZS5lc2NhcGVOb2RlKHJvb20ubmljaykpOwogICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5tb2RlbC5nZXQoJ2Nvbm5lY2VkJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5zZXQoJ2Nvbm5lY3RlZCcsIHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiQoJ3NwYW4uY2VudGVyZWQuc3Bpbm5lcicpLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbC5maW5kKCcuY2hhdC1ib2R5JykuY2hpbGRyZW4oKS5zaG93KCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd1N0YXR1c01lc3NhZ2VzKCRwcmVzZW5jZSwgaXNfc2VsZik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIG9uQ2hhdFJvb21NZXNzYWdlOiBmdW5jdGlvbiAobWVzc2FnZSkgewogICAgICAgICAgICAgICAgdmFyICRtZXNzYWdlID0gJChtZXNzYWdlKSwKICAgICAgICAgICAgICAgICAgICBib2R5ID0gJG1lc3NhZ2UuY2hpbGRyZW4oJ2JvZHknKS50ZXh0KCksCiAgICAgICAgICAgICAgICAgICAgamlkID0gJG1lc3NhZ2UuYXR0cignZnJvbScpLAogICAgICAgICAgICAgICAgICAgIG1zZ2lkID0gJG1lc3NhZ2UuYXR0cignaWQnKSwKICAgICAgICAgICAgICAgICAgICByZXNvdXJjZSA9IFN0cm9waGUuZ2V0UmVzb3VyY2VGcm9tSmlkKGppZCksCiAgICAgICAgICAgICAgICAgICAgc2VuZGVyID0gcmVzb3VyY2UgJiYgU3Ryb3BoZS51bmVzY2FwZU5vZGUocmVzb3VyY2UpIHx8ICcnLAogICAgICAgICAgICAgICAgICAgIGRlbGF5ZWQgPSAkbWVzc2FnZS5maW5kKCdkZWxheScpLmxlbmd0aCA+IDAsCiAgICAgICAgICAgICAgICAgICAgc3ViamVjdCA9ICRtZXNzYWdlLmNoaWxkcmVuKCdzdWJqZWN0JykudGV4dCgpOwoKICAgICAgICAgICAgICAgIGlmICh0aGlzLm1vZGVsLm1lc3NhZ2VzLmZpbmRXaGVyZSh7bXNnaWQ6IG1zZ2lkfSkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsgLy8gV2UgYWxyZWFkeSBoYXZlIHRoaXMgbWVzc2FnZSBzdG9yZWQuCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLnNob3dTdGF0dXNNZXNzYWdlcygkbWVzc2FnZSk7CiAgICAgICAgICAgICAgICBpZiAoc3ViamVjdCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuJGVsLmZpbmQoJy5jaGF0cm9vbS10b3BpYycpLnRleHQoc3ViamVjdCkuYXR0cigndGl0bGUnLCBzdWJqZWN0KTsKICAgICAgICAgICAgICAgICAgICAvLyAjIEZvciB0cmFuc2xhdG9yczogdGhlICUxJHMgYW5kICUyJHMgcGFydHMgd2lsbCBnZXQgcmVwbGFjZWQgYnkgdGhlIHVzZXIgYW5kIHRvcGljIHRleHQgcmVzcGVjdGl2ZWx5CiAgICAgICAgICAgICAgICAgICAgLy8gIyBFeGFtcGxlOiBUb3BpYyBzZXQgYnkgSkMgQnJhbmQgdG86IEhlbGxvIFdvcmxkIQogICAgICAgICAgICAgICAgICAgIHRoaXMuJGVsLmZpbmQoJy5jaGF0LWNvbnRlbnQnKS5hcHBlbmQoCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLnRlbXBsYXRlcy5pbmZvKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJzogX18oJ1RvcGljIHNldCBieSAlMSRzIHRvOiAlMiRzJywgc2VuZGVyLCBzdWJqZWN0KQogICAgICAgICAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoc2VuZGVyID09PSAnJykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5jcmVhdGVNZXNzYWdlKCRtZXNzYWdlKTsKICAgICAgICAgICAgICAgIGlmICghZGVsYXllZCAmJiBzZW5kZXIgIT09IHRoaXMubW9kZWwuZ2V0KCduaWNrJykgJiYgKG5ldyBSZWdFeHAoIlxcYiIrdGhpcy5tb2RlbC5nZXQoJ25pY2snKSsiXFxiIikpLnRlc3QoYm9keSkpIHsKICAgICAgICAgICAgICAgICAgICBwbGF5Tm90aWZpY2F0aW9uKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoc2VuZGVyICE9PSB0aGlzLm1vZGVsLmdldCgnbmljaycpKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gV2Ugb25seSBlbWl0IGFuIGV2ZW50IGlmIGl0J3Mgbm90IG91ciBvd24gbWVzc2FnZQogICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLmVtaXQoJ21lc3NhZ2UnLCBtZXNzYWdlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgb25DaGF0Um9vbVJvc3RlcjogZnVuY3Rpb24gKHJvc3Rlciwgcm9vbSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMub2NjdXBhbnRzdmlldy5vbkNoYXRSb29tUm9zdGVyKHJvc3Rlciwgcm9vbSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgdGhpcy5DaGF0Qm94ZXMgPSBCYWNrYm9uZS5Db2xsZWN0aW9uLmV4dGVuZCh7CiAgICAgICAgICAgIG1vZGVsOiBjb252ZXJzZS5DaGF0Qm94LAogICAgICAgICAgICBjb21wYXJhdG9yOiAndGltZV9vcGVuZWQnLAoKICAgICAgICAgICAgcmVnaXN0ZXJNZXNzYWdlSGFuZGxlcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgY29udmVyc2UuY29ubmVjdGlvbi5hZGRIYW5kbGVyKAogICAgICAgICAgICAgICAgICAgICQucHJveHkoZnVuY3Rpb24gKG1lc3NhZ2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vbk1lc3NhZ2UobWVzc2FnZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgICAgIH0sIHRoaXMpLCBudWxsLCAnbWVzc2FnZScsICdjaGF0Jyk7CgogICAgICAgICAgICAgICAgY29udmVyc2UuY29ubmVjdGlvbi5hZGRIYW5kbGVyKAogICAgICAgICAgICAgICAgICAgICQucHJveHkoZnVuY3Rpb24gKG1lc3NhZ2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vbkludml0ZShtZXNzYWdlKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICAgICAgfSwgdGhpcyksICdqYWJiZXI6eDpjb25mZXJlbmNlJywgJ21lc3NhZ2UnKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIG9uQ29ubmVjdGVkOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB0aGlzLmJyb3dzZXJTdG9yYWdlID0gbmV3IEJhY2tib25lLkJyb3dzZXJTdG9yYWdlW2NvbnZlcnNlLnN0b3JhZ2VdKAogICAgICAgICAgICAgICAgICAgIGI2NF9zaGExKCdjb252ZXJzZS5jaGF0Ym94ZXMtJytjb252ZXJzZS5iYXJlX2ppZCkpOwogICAgICAgICAgICAgICAgdGhpcy5yZWdpc3Rlck1lc3NhZ2VIYW5kbGVyKCk7CiAgICAgICAgICAgICAgICB0aGlzLmZldGNoKHsKICAgICAgICAgICAgICAgICAgICBhZGQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogJC5wcm94eShmdW5jdGlvbiAoY29sbGVjdGlvbiwgcmVzcCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIV8uaW5jbHVkZShfLnBsdWNrKHJlc3AsICdpZCcpLCAnY29udHJvbGJveCcpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6ICdjb250cm9sYm94JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib3hfaWQ6ICdjb250cm9sYm94JwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXQoJ2NvbnRyb2xib3gnKS5zYXZlKHtjb25uZWN0ZWQ6dHJ1ZX0pOwogICAgICAgICAgICAgICAgICAgIH0sIHRoaXMpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGlzT25seUNoYXRTdGF0ZU5vdGlmaWNhdGlvbjogZnVuY3Rpb24gKCRtc2cpIHsKICAgICAgICAgICAgICAgIC8vIFNlZSBYRVAtMDA4NSBDaGF0IFN0YXRlIE5vdGlmaWNhdGlvbgogICAgICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAgICAgICAkbXNnLmZpbmQoJ2JvZHknKS5sZW5ndGggPT09IDAgJiYgKAogICAgICAgICAgICAgICAgICAgICAgICAkbXNnLmZpbmQoQUNUSVZFKS5sZW5ndGggIT09IDAgfHwKICAgICAgICAgICAgICAgICAgICAgICAgJG1zZy5maW5kKENPTVBPU0lORykubGVuZ3RoICE9PSAwIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICRtc2cuZmluZChJTkFDVElWRSkubGVuZ3RoICE9PSAwIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICRtc2cuZmluZChQQVVTRUQpLmxlbmd0aCAhPT0gMCB8fAogICAgICAgICAgICAgICAgICAgICAgICAkbXNnLmZpbmQoR09ORSkubGVuZ3RoICE9PSAwCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIG9uSW52aXRlOiBmdW5jdGlvbiAobWVzc2FnZSkgewogICAgICAgICAgICAgICAgdmFyICRtZXNzYWdlID0gJChtZXNzYWdlKSwKICAgICAgICAgICAgICAgICAgICAkeCA9ICRtZXNzYWdlLmNoaWxkcmVuKCd4W3htbG5zPSJqYWJiZXI6eDpjb25mZXJlbmNlIl0nKSwKICAgICAgICAgICAgICAgICAgICBmcm9tID0gU3Ryb3BoZS5nZXRCYXJlSmlkRnJvbUppZCgkbWVzc2FnZS5hdHRyKCdmcm9tJykpLAogICAgICAgICAgICAgICAgICAgIHJvb21famlkID0gJHguYXR0cignamlkJyksCiAgICAgICAgICAgICAgICAgICAgcmVhc29uID0gJHguYXR0cigncmVhc29uJyksCiAgICAgICAgICAgICAgICAgICAgY29udGFjdCA9IGNvbnZlcnNlLnJvc3Rlci5nZXQoZnJvbSksCiAgICAgICAgICAgICAgICAgICAgcmVzdWx0OwoKICAgICAgICAgICAgICAgIGlmICghcmVhc29uKSB7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gY29uZmlybSgKICAgICAgICAgICAgICAgICAgICAgICAgX18oX19fKCIlMSRzIGhhcyBpbnZpdGVkIHlvdSB0byBqb2luIGEgY2hhdCByb29tOiAlMiRzIiksIGNvbnRhY3QuZ2V0KCdmdWxsbmFtZScpLCByb29tX2ppZCkKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBjb25maXJtKAogICAgICAgICAgICAgICAgICAgICAgICAgX18oX19fKCclMSRzIGhhcyBpbnZpdGVkIHlvdSB0byBqb2luIGEgY2hhdCByb29tOiAlMiRzLCBhbmQgbGVmdCB0aGUgZm9sbG93aW5nIHJlYXNvbjogIiUzJHMiJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGFjdC5nZXQoJ2Z1bGxuYW1lJyksIHJvb21famlkLCByZWFzb24pCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChyZXN1bHQgPT09IHRydWUpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgY2hhdHJvb20gPSBjb252ZXJzZS5jaGF0Ym94dmlld3Muc2hvd0NoYXQoewogICAgICAgICAgICAgICAgICAgICAgICAnaWQnOiByb29tX2ppZCwKICAgICAgICAgICAgICAgICAgICAgICAgJ2ppZCc6IHJvb21famlkLAogICAgICAgICAgICAgICAgICAgICAgICAnbmFtZSc6IFN0cm9waGUudW5lc2NhcGVOb2RlKFN0cm9waGUuZ2V0Tm9kZUZyb21KaWQocm9vbV9qaWQpKSwKICAgICAgICAgICAgICAgICAgICAgICAgJ25pY2snOiBTdHJvcGhlLnVuZXNjYXBlTm9kZShTdHJvcGhlLmdldE5vZGVGcm9tSmlkKGNvbnZlcnNlLmNvbm5lY3Rpb24uamlkKSksCiAgICAgICAgICAgICAgICAgICAgICAgICdjaGF0cm9vbSc6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICdib3hfaWQnIDogYjY0X3NoYTEocm9vbV9qaWQpLAogICAgICAgICAgICAgICAgICAgICAgICAncGFzc3dvcmQnOiAkeC5hdHRyKCdwYXNzd29yZCcpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFjaGF0cm9vbS5nZXQoJ2Nvbm5lY3RlZCcpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLmNoYXRib3h2aWV3cy5nZXQocm9vbV9qaWQpLmNvbm5lY3QobnVsbCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgb25NZXNzYWdlOiBmdW5jdGlvbiAobWVzc2FnZSkgewogICAgICAgICAgICAgICAgdmFyICRtZXNzYWdlID0gJChtZXNzYWdlKTsKICAgICAgICAgICAgICAgIHZhciBidWRkeV9qaWQsICRmb3J3YXJkZWQsICRyZWNlaXZlZCwKICAgICAgICAgICAgICAgICAgICBtZXNzYWdlX2Zyb20gPSAkbWVzc2FnZS5hdHRyKCdmcm9tJyk7CiAgICAgICAgICAgICAgICBpZiAobWVzc2FnZV9mcm9tID09PSBjb252ZXJzZS5jb25uZWN0aW9uLmppZCkgewogICAgICAgICAgICAgICAgICAgIC8vIEZJWE1FOiBGb3J3YXJkZWQgbWVzc2FnZXMgc2hvdWxkIGJlIHNlbnQgdG8gc3BlY2lmaWMgcmVzb3VyY2VzLAogICAgICAgICAgICAgICAgICAgIC8vIG5vdCBicm9hZGNhc3RlZAogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJGZvcndhcmRlZCA9ICRtZXNzYWdlLmNoaWxkcmVuKCdmb3J3YXJkZWQnKTsKICAgICAgICAgICAgICAgICRyZWNlaXZlZCA9ICRtZXNzYWdlLmNoaWxkcmVuKCdyZWNlaXZlZFt4bWxucz0idXJuOnhtcHA6Y2FyYm9uczoyIl0nKTsKICAgICAgICAgICAgICAgIGlmICgkZm9yd2FyZGVkLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgICRtZXNzYWdlID0gJGZvcndhcmRlZC5jaGlsZHJlbignbWVzc2FnZScpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICgkcmVjZWl2ZWQubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgJG1lc3NhZ2UgPSAkcmVjZWl2ZWQuY2hpbGRyZW4oJ2ZvcndhcmRlZCcpLmNoaWxkcmVuKCdtZXNzYWdlJyk7CiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZV9mcm9tID0gJG1lc3NhZ2UuYXR0cignZnJvbScpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdmFyIGZyb20gPSBTdHJvcGhlLmdldEJhcmVKaWRGcm9tSmlkKG1lc3NhZ2VfZnJvbSksCiAgICAgICAgICAgICAgICAgICAgdG8gPSBTdHJvcGhlLmdldEJhcmVKaWRGcm9tSmlkKCRtZXNzYWdlLmF0dHIoJ3RvJykpLAogICAgICAgICAgICAgICAgICAgIHJlc291cmNlLCBjaGF0Ym94LCByb3N0ZXJfaXRlbTsKICAgICAgICAgICAgICAgIGlmIChmcm9tID09IGNvbnZlcnNlLmJhcmVfamlkKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gSSBhbSB0aGUgc2VuZGVyLCBzbyB0aGlzIG11c3QgYmUgYSBmb3J3YXJkZWQgbWVzc2FnZS4uLgogICAgICAgICAgICAgICAgICAgIGJ1ZGR5X2ppZCA9IHRvOwogICAgICAgICAgICAgICAgICAgIHJlc291cmNlID0gU3Ryb3BoZS5nZXRSZXNvdXJjZUZyb21KaWQoJG1lc3NhZ2UuYXR0cigndG8nKSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGJ1ZGR5X2ppZCA9IGZyb207CiAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2UgPSBTdHJvcGhlLmdldFJlc291cmNlRnJvbUppZChtZXNzYWdlX2Zyb20pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2hhdGJveCA9IHRoaXMuZ2V0KGJ1ZGR5X2ppZCk7CiAgICAgICAgICAgICAgICByb3N0ZXJfaXRlbSA9IGNvbnZlcnNlLnJvc3Rlci5nZXQoYnVkZHlfamlkKTsKCiAgICAgICAgICAgICAgICBpZiAocm9zdGVyX2l0ZW0gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgIC8vIFRoZSBidWRkeSB3YXMgbGlrZWx5IHJlbW92ZWQKICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS5sb2coJ0NvdWxkIG5vdCBnZXQgcm9zdGVyIGl0ZW0gZm9yIEpJRCAnK2J1ZGR5X2ppZCwgJ2Vycm9yJyk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKCFjaGF0Ym94KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGZ1bGxuYW1lID0gcm9zdGVyX2l0ZW0uZ2V0KCdmdWxsbmFtZScpOwogICAgICAgICAgICAgICAgICAgIGZ1bGxuYW1lID0gXy5pc0VtcHR5KGZ1bGxuYW1lKT8gYnVkZHlfamlkOiBmdWxsbmFtZTsKICAgICAgICAgICAgICAgICAgICBjaGF0Ym94ID0gdGhpcy5jcmVhdGUoewogICAgICAgICAgICAgICAgICAgICAgICAnaWQnOiBidWRkeV9qaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICdqaWQnOiBidWRkeV9qaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICdmdWxsbmFtZSc6IGZ1bGxuYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAnaW1hZ2VfdHlwZSc6IHJvc3Rlcl9pdGVtLmdldCgnaW1hZ2VfdHlwZScpLAogICAgICAgICAgICAgICAgICAgICAgICAnaW1hZ2UnOiByb3N0ZXJfaXRlbS5nZXQoJ2ltYWdlJyksCiAgICAgICAgICAgICAgICAgICAgICAgICd1cmwnOiByb3N0ZXJfaXRlbS5nZXQoJ3VybCcpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuaXNPbmx5Q2hhdFN0YXRlTm90aWZpY2F0aW9uKCRtZXNzYWdlKSAmJiBmcm9tICE9PSBjb252ZXJzZS5iYXJlX2ppZCkgewogICAgICAgICAgICAgICAgICAgIHBsYXlOb3RpZmljYXRpb24oKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNoYXRib3gucmVjZWl2ZU1lc3NhZ2UoJG1lc3NhZ2UpOwogICAgICAgICAgICAgICAgY29udmVyc2Uucm9zdGVyLmFkZFJlc291cmNlKGJ1ZGR5X2ppZCwgcmVzb3VyY2UpOwogICAgICAgICAgICAgICAgY29udmVyc2UuZW1pdCgnbWVzc2FnZScsIG1lc3NhZ2UpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgdGhpcy5DaGF0Qm94Vmlld3MgPSBCYWNrYm9uZS5PdmVydmlldy5leHRlbmQoewoKICAgICAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5vbigiYWRkIiwgdGhpcy5vbkNoYXRCb3hBZGRlZCwgdGhpcyk7CiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLm9uKCJjaGFuZ2U6bWluaW1pemVkIiwgZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5nZXQoJ21pbmltaXplZCcpID09PSBmYWxzZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50cmltQ2hhdHModGhpcy5nZXQoaXRlbS5nZXQoJ2lkJykpKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50cmltQ2hhdHMoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCB0aGlzKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIF9lbnN1cmVFbGVtZW50OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAvKiBPdmVycmlkZSBtZXRob2QgZnJvbSBiYWNrYm9uZS5qcwogICAgICAgICAgICAgICAgICogSWYgdGhlICNjb252ZXJzZWpzIGVsZW1lbnQgZG9lc24ndCBleGlzdCwgY3JlYXRlIGl0LgogICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuZWwpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgJGVsID0gJCgnI2NvbnZlcnNlanMnKTsKICAgICAgICAgICAgICAgICAgICBpZiAoISRlbC5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGVsID0gJCgnPGRpdiBpZD0iY29udmVyc2VqcyI+Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgICQoJ2JvZHknKS5hcHBlbmQoJGVsKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJGVsLmh0bWwoY29udmVyc2UudGVtcGxhdGVzLmNoYXRzX3BhbmVsKCkpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0RWxlbWVudCgkZWwsIGZhbHNlKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRFbGVtZW50KF8ucmVzdWx0KHRoaXMsICdlbCcpLCBmYWxzZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBvbkNoYXRCb3hBZGRlZDogZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgIHZhciB2aWV3ID0gdGhpcy5nZXQoaXRlbS5nZXQoJ2lkJykpOwogICAgICAgICAgICAgICAgaWYgKCF2aWV3KSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uZ2V0KCdjaGF0cm9vbScpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZpZXcgPSBuZXcgY29udmVyc2UuQ2hhdFJvb21WaWV3KHsnbW9kZWwnOiBpdGVtfSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpdGVtLmdldCgnYm94X2lkJykgPT09ICdjb250cm9sYm94JykgewogICAgICAgICAgICAgICAgICAgICAgICB2aWV3ID0gbmV3IGNvbnZlcnNlLkNvbnRyb2xCb3hWaWV3KHttb2RlbDogaXRlbX0pOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZpZXcgPSBuZXcgY29udmVyc2UuQ2hhdEJveFZpZXcoe21vZGVsOiBpdGVtfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkKGl0ZW0uZ2V0KCdpZCcpLCB2aWV3KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHZpZXcubW9kZWw7IC8vIFJlbW92ZSByZWYgdG8gb2xkIG1vZGVsIHRvIGhlbHAgZ2FyYmFnZSBjb2xsZWN0aW9uCiAgICAgICAgICAgICAgICAgICAgdmlldy5tb2RlbCA9IGl0ZW07CiAgICAgICAgICAgICAgICAgICAgdmlldy5pbml0aWFsaXplKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLnRyaW1DaGF0cyh2aWV3KTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHRyaW1DaGF0czogZnVuY3Rpb24gKG5ld2NoYXQpIHsKICAgICAgICAgICAgICAgIC8qIFRoaXMgbWV0aG9kIGlzIGNhbGxlZCB3aGVuIGEgbmV3bHkgY3JlYXRlZCBjaGF0IGJveCB3aWxsCiAgICAgICAgICAgICAgICAgKiBiZSBzaG93bi4KICAgICAgICAgICAgICAgICAqCiAgICAgICAgICAgICAgICAgKiBJdCBjaGVja3Mgd2hldGhlciB0aGVyZSBpcyBlbm91Z2ggc3BhY2Ugb24gdGhlIHBhZ2UgdG8gc2hvdwogICAgICAgICAgICAgICAgICogYW5vdGhlciBjaGF0IGJveC4gT3RoZXJ3aXNlIGl0IG1pbmltaXplIHRoZSBvbGRlc3QgY2hhdCBib3gKICAgICAgICAgICAgICAgICAqIHRvIGNyZWF0ZSBzcGFjZS4KICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgaWYgKGNvbnZlcnNlLm5vX3RyaW1taW5nIHx8ICh0aGlzLm1vZGVsLmxlbmd0aCA8PSAxKSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHZhciBvbGRlc3RfY2hhdCwKICAgICAgICAgICAgICAgICAgICBjb250cm9sYm94X3dpZHRoID0gMCwKICAgICAgICAgICAgICAgICAgICAkbWluaW1pemVkID0gY29udmVyc2UubWluaW1pemVkX2NoYXRzLiRlbCwKICAgICAgICAgICAgICAgICAgICBtaW5pbWl6ZWRfd2lkdGggPSBfLmNvbnRhaW5zKHRoaXMubW9kZWwucGx1Y2soJ21pbmltaXplZCcpLCB0cnVlKSA/ICRtaW5pbWl6ZWQub3V0ZXJXaWR0aCh0cnVlKSA6IDAsCiAgICAgICAgICAgICAgICAgICAgYm94ZXNfd2lkdGggPSBuZXdjaGF0ID8gbmV3Y2hhdC4kZWwub3V0ZXJXaWR0aCh0cnVlKSA6IDAsCiAgICAgICAgICAgICAgICAgICAgbmV3X2lkID0gbmV3Y2hhdCA/IG5ld2NoYXQubW9kZWwuZ2V0KCdpZCcpIDogbnVsbCwKICAgICAgICAgICAgICAgICAgICBjb250cm9sYm94ID0gdGhpcy5nZXQoJ2NvbnRyb2xib3gnKTsKCiAgICAgICAgICAgICAgICBpZiAoIWNvbnRyb2xib3ggfHwgIWNvbnRyb2xib3guJGVsLmlzKCc6dmlzaWJsZScpKSB7CiAgICAgICAgICAgICAgICAgICAgY29udHJvbGJveF93aWR0aCA9IGNvbnZlcnNlLmNvbnRyb2xib3h0b2dnbGUuJGVsLm91dGVyV2lkdGgodHJ1ZSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGNvbnRyb2xib3hfd2lkdGggPSBjb250cm9sYm94LiRlbC5vdXRlcldpZHRoKHRydWUpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF8uZWFjaCh0aGlzLmdldEFsbCgpLCBmdW5jdGlvbiAodmlldykgewogICAgICAgICAgICAgICAgICAgIHZhciBpZCA9IHZpZXcubW9kZWwuZ2V0KCdpZCcpOwogICAgICAgICAgICAgICAgICAgIGlmICgoaWQgIT09ICdjb250cm9sYm94JykgJiYgKGlkICE9PSBuZXdfaWQpICYmICghdmlldy5tb2RlbC5nZXQoJ21pbmltaXplZCcpKSAmJiB2aWV3LiRlbC5pcygnOnZpc2libGUnKSkgewogICAgICAgICAgICAgICAgICAgICAgICBib3hlc193aWR0aCArPSB2aWV3LiRlbC5vdXRlcldpZHRoKHRydWUpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGlmICgobWluaW1pemVkX3dpZHRoICsgYm94ZXNfd2lkdGggKyBjb250cm9sYm94X3dpZHRoKSA+IHRoaXMuJGVsLm91dGVyV2lkdGgodHJ1ZSkpIHsKICAgICAgICAgICAgICAgICAgICBvbGRlc3RfY2hhdCA9IHRoaXMuZ2V0T2xkZXN0TWF4aW1pemVkQ2hhdCgpOwogICAgICAgICAgICAgICAgICAgIGlmIChvbGRlc3RfY2hhdCkgewogICAgICAgICAgICAgICAgICAgICAgICBvbGRlc3RfY2hhdC5taW5pbWl6ZSgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGdldE9sZGVzdE1heGltaXplZENoYXQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIC8vIEdldCBvbGRlc3QgdmlldyAod2hpY2ggaXMgbm90IGNvbnRyb2xib3gpCiAgICAgICAgICAgICAgICB2YXIgaSA9IDA7CiAgICAgICAgICAgICAgICB2YXIgbW9kZWwgPSB0aGlzLm1vZGVsLnNvcnQoKS5hdChpKTsKICAgICAgICAgICAgICAgIHdoaWxlIChtb2RlbC5nZXQoJ2lkJykgPT09ICdjb250cm9sYm94JyB8fCBtb2RlbC5nZXQoJ21pbmltaXplZCcpID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgICAgICAgaSsrOwogICAgICAgICAgICAgICAgICAgIG1vZGVsID0gdGhpcy5tb2RlbC5hdChpKTsKICAgICAgICAgICAgICAgICAgICBpZiAoIW1vZGVsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBtb2RlbDsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGNsb3NlQWxsQ2hhdEJveGVzOiBmdW5jdGlvbiAoaW5jbHVkZV9jb250cm9sYm94KSB7CiAgICAgICAgICAgICAgICB2YXIgaSwgY2hhdGJveDsKICAgICAgICAgICAgICAgIC8vIFRPRE86IG9uY2UgQmFja2JvbmUuT3ZlcnZpZXcgaGFzIGJlZW4gcmVmYWN0b3JlZCwgd2Ugc2hvdWxkCiAgICAgICAgICAgICAgICAvLyBiZSBhYmxlIHRvIGNhbGwgLmVhY2ggb24gdGhlIHZpZXdzIHRoZW1zZWx2ZXMuCiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLmVhY2goJC5wcm94eShmdW5jdGlvbiAobW9kZWwpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgaWQgPSBtb2RlbC5nZXQoJ2lkJyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGluY2x1ZGVfY29udHJvbGJveCB8fCBpZCAhPT0gJ2NvbnRyb2xib3gnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0KGlkKS5jbG9zZSgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sIHRoaXMpKTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgc2hvd0NoYXQ6IGZ1bmN0aW9uIChhdHRycykgewogICAgICAgICAgICAgICAgLyogRmluZCB0aGUgY2hhdCBib3ggYW5kIHNob3cgaXQuCiAgICAgICAgICAgICAgICAgKiBJZiBpdCBkb2Vzbid0IGV4aXN0LCBjcmVhdGUgaXQuCiAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgIHZhciBjaGF0Ym94ICA9IHRoaXMubW9kZWwuZ2V0KGF0dHJzLmppZCk7CiAgICAgICAgICAgICAgICBpZiAoIWNoYXRib3gpIHsKICAgICAgICAgICAgICAgICAgICBjaGF0Ym94ID0gdGhpcy5tb2RlbC5jcmVhdGUoYXR0cnMsIHsKICAgICAgICAgICAgICAgICAgICAgICAgJ2Vycm9yJzogZnVuY3Rpb24gKG1vZGVsLCByZXNwb25zZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udmVyc2UubG9nKHJlc3BvbnNlLnJlc3BvbnNlVGV4dCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChjaGF0Ym94LmdldCgnbWluaW1pemVkJykpIHsKICAgICAgICAgICAgICAgICAgICBjaGF0Ym94Lm1heGltaXplKCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGNoYXRib3gudHJpZ2dlcignc2hvdycpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGNoYXRib3g7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgdGhpcy5NaW5pbWl6ZWRDaGF0Qm94VmlldyA9IEJhY2tib25lLlZpZXcuZXh0ZW5kKHsKICAgICAgICAgICAgdGFnTmFtZTogJ2RpdicsCiAgICAgICAgICAgIGNsYXNzTmFtZTogJ2NoYXQtaGVhZCcsCgogICAgICAgICAgICBldmVudHM6IHsKICAgICAgICAgICAgICAgICdjbGljayAuY2xvc2UtY2hhdGJveC1idXR0b24nOiAnY2xvc2UnLAogICAgICAgICAgICAgICAgJ2NsaWNrIC5yZXN0b3JlLWNoYXQnOiAncmVzdG9yZScKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHRoaXMubW9kZWwubWVzc2FnZXMub24oJ2FkZCcsIGZ1bmN0aW9uIChtKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCEobS5nZXQoJ2NvbXBvc2luZycpIHx8IG0uZ2V0KCdwYXVzZWQnKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVVbnJlYWRNZXNzYWdlc0NvdW50ZXIoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCB0aGlzKTsKICAgICAgICAgICAgICAgIHRoaXMubW9kZWwub24oJ2NoYW5nZTptaW5pbWl6ZWQnLCB0aGlzLmNsZWFyVW5yZWFkTWVzc2FnZXNDb3VudGVyLCB0aGlzKTsKICAgICAgICAgICAgICAgIHRoaXMubW9kZWwub24oJ3Nob3dSZWNlaXZlZE9UUk1lc3NhZ2UnLCB0aGlzLnVwZGF0ZVVucmVhZE1lc3NhZ2VzQ291bnRlciwgdGhpcyk7CiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLm9uKCdzaG93U2VudE9UUk1lc3NhZ2UnLCB0aGlzLnVwZGF0ZVVucmVhZE1lc3NhZ2VzQ291bnRlciwgdGhpcyk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICByZW5kZXI6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBkYXRhID0gXy5leHRlbmQoCiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlbC50b0pTT04oKSwKICAgICAgICAgICAgICAgICAgICB7ICd0b29sdGlwJzogX18oJ0NsaWNrIHRvIHJlc3RvcmUgdGhpcyBjaGF0JykgfQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLm1vZGVsLmdldCgnY2hhdHJvb20nKSkgewogICAgICAgICAgICAgICAgICAgIGRhdGEudGl0bGUgPSB0aGlzLm1vZGVsLmdldCgnbmFtZScpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuJGVsLmFkZENsYXNzKCdjaGF0LWhlYWQtY2hhdHJvb20nKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgZGF0YS50aXRsZSA9IHRoaXMubW9kZWwuZ2V0KCdmdWxsbmFtZScpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuJGVsLmFkZENsYXNzKCdjaGF0LWhlYWQtY2hhdGJveCcpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJGVsLmh0bWwoY29udmVyc2UudGVtcGxhdGVzLnRyaW1tZWRfY2hhdChkYXRhKSk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBjbGVhclVucmVhZE1lc3NhZ2VzQ291bnRlcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5zZXQoeydudW1fdW5yZWFkJzogMH0pOwogICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIoKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHVwZGF0ZVVucmVhZE1lc3NhZ2VzQ291bnRlcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5zZXQoeydudW1fdW5yZWFkJzogdGhpcy5tb2RlbC5nZXQoJ251bV91bnJlYWQnKSArIDF9KTsKICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyKCk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBjbG9zZTogZnVuY3Rpb24gKGV2KSB7CiAgICAgICAgICAgICAgICBpZiAoZXYgJiYgZXYucHJldmVudERlZmF1bHQpIHsgZXYucHJldmVudERlZmF1bHQoKTsgfQogICAgICAgICAgICAgICAgdGhpcy5yZW1vdmUoKTsKICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuZGVzdHJveSgpOwogICAgICAgICAgICAgICAgY29udmVyc2UuZW1pdCgnY2hhdEJveENsb3NlZCcsIHRoaXMpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICByZXN0b3JlOiBfLmRlYm91bmNlKGZ1bmN0aW9uIChldikgewogICAgICAgICAgICAgICAgaWYgKGV2ICYmIGV2LnByZXZlbnREZWZhdWx0KSB7CiAgICAgICAgICAgICAgICAgICAgZXYucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLm1heGltaXplKCk7CiAgICAgICAgICAgIH0sIDIwMCkKICAgICAgICB9KTsKCiAgICAgICAgdGhpcy5NaW5pbWl6ZWRDaGF0cyA9IEJhY2tib25lLk92ZXJ2aWV3LmV4dGVuZCh7CiAgICAgICAgICAgIGVsOiAiI21pbmltaXplZC1jaGF0cyIsCgogICAgICAgICAgICBldmVudHM6IHsKICAgICAgICAgICAgICAgICJjbGljayAjdG9nZ2xlLW1pbmltaXplZC1jaGF0cyI6ICJ0b2dnbGUiCiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB0aGlzLmluaXRUb2dnbGUoKTsKICAgICAgICAgICAgICAgIHRoaXMubW9kZWwub24oImFkZCIsIHRoaXMub25DaGFuZ2VkLCB0aGlzKTsKICAgICAgICAgICAgICAgIHRoaXMubW9kZWwub24oImRlc3Ryb3kiLCB0aGlzLnJlbW92ZUNoYXQsIHRoaXMpOwogICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5vbigiY2hhbmdlOm1pbmltaXplZCIsIHRoaXMub25DaGFuZ2VkLCB0aGlzKTsKICAgICAgICAgICAgICAgIHRoaXMubW9kZWwub24oJ2NoYW5nZTpudW1fdW5yZWFkJywgdGhpcy51cGRhdGVVbnJlYWRNZXNzYWdlc0NvdW50ZXIsIHRoaXMpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgdGVhckRvd246IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHRoaXMubW9kZWwub2ZmKCJhZGQiLCB0aGlzLm9uQ2hhbmdlZCk7CiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLm9mZigiZGVzdHJveSIsIHRoaXMucmVtb3ZlQ2hhdCk7CiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLm9mZigiY2hhbmdlOm1pbmltaXplZCIsIHRoaXMub25DaGFuZ2VkKTsKICAgICAgICAgICAgICAgIHRoaXMubW9kZWwub2ZmKCdjaGFuZ2U6bnVtX3VucmVhZCcsIHRoaXMudXBkYXRlVW5yZWFkTWVzc2FnZXNDb3VudGVyKTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgaW5pdFRvZ2dsZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdGhpcy50b2dnbGV2aWV3ID0gbmV3IGNvbnZlcnNlLk1pbmltaXplZENoYXRzVG9nZ2xlVmlldyh7CiAgICAgICAgICAgICAgICAgICAgbW9kZWw6IG5ldyBjb252ZXJzZS5NaW5pbWl6ZWRDaGF0c1RvZ2dsZSgpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHZhciBpZCA9IGI2NF9zaGExKCdjb252ZXJzZS5taW5jaGF0c3RvZ2dsZScrY29udmVyc2UuYmFyZV9qaWQpOwogICAgICAgICAgICAgICAgdGhpcy50b2dnbGV2aWV3Lm1vZGVsLmlkID0gaWQ7IC8vIEFwcGVhcnMgdG8gYmUgbmVjZXNzYXJ5IGZvciBiYWNrYm9uZS5icm93c2VyU3RvcmFnZQogICAgICAgICAgICAgICAgdGhpcy50b2dnbGV2aWV3Lm1vZGVsLmJyb3dzZXJTdG9yYWdlID0gbmV3IEJhY2tib25lLkJyb3dzZXJTdG9yYWdlW2NvbnZlcnNlLnN0b3JhZ2VdKGlkKTsKICAgICAgICAgICAgICAgIHRoaXMudG9nZ2xldmlldy5tb2RlbC5mZXRjaCgpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5rZXlzKCkubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kZWwuaGlkZSgnZmFzdCcpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmtleXMoKS5sZW5ndGggPT09IDEpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbC5zaG93KCdmYXN0Jyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kZWw7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICB0b2dnbGU6IGZ1bmN0aW9uIChldikgewogICAgICAgICAgICAgICAgaWYgKGV2ICYmIGV2LnByZXZlbnREZWZhdWx0KSB7IGV2LnByZXZlbnREZWZhdWx0KCk7IH0KICAgICAgICAgICAgICAgIHRoaXMudG9nZ2xldmlldy5tb2RlbC5zYXZlKHsnY29sbGFwc2VkJzogIXRoaXMudG9nZ2xldmlldy5tb2RlbC5nZXQoJ2NvbGxhcHNlZCcpfSk7CiAgICAgICAgICAgICAgICB0aGlzLiQoJy5taW5pbWl6ZWQtY2hhdHMtZmx5b3V0JykudG9nZ2xlKCk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBvbkNoYW5nZWQ6IGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICBpZiAoaXRlbS5nZXQoJ2lkJykgIT09ICdjb250cm9sYm94JyAmJiBpdGVtLmdldCgnbWluaW1pemVkJykpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZENoYXQoaXRlbSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuZ2V0KGl0ZW0uZ2V0KCdpZCcpKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlQ2hhdChpdGVtKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGFkZENoYXQ6IGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICB2YXIgZXhpc3RpbmcgPSB0aGlzLmdldChpdGVtLmdldCgnaWQnKSk7CiAgICAgICAgICAgICAgICBpZiAoZXhpc3RpbmcgJiYgZXhpc3RpbmcuJGVsLnBhcmVudCgpLmxlbmd0aCAhPT0gMCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHZhciB2aWV3ID0gbmV3IGNvbnZlcnNlLk1pbmltaXplZENoYXRCb3hWaWV3KHttb2RlbDogaXRlbX0pOwogICAgICAgICAgICAgICAgdGhpcy4kKCcubWluaW1pemVkLWNoYXRzLWZseW91dCcpLmFwcGVuZCh2aWV3LnJlbmRlcigpKTsKICAgICAgICAgICAgICAgIHRoaXMuYWRkKGl0ZW0uZ2V0KCdpZCcpLCB2aWV3KTsKICAgICAgICAgICAgICAgIHRoaXMudG9nZ2xldmlldy5tb2RlbC5zZXQoeydudW1fbWluaW1pemVkJzogdGhpcy5rZXlzKCkubGVuZ3RofSk7CiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcigpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgcmVtb3ZlQ2hhdDogZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlKGl0ZW0uZ2V0KCdpZCcpKTsKICAgICAgICAgICAgICAgIHRoaXMudG9nZ2xldmlldy5tb2RlbC5zZXQoeydudW1fbWluaW1pemVkJzogdGhpcy5rZXlzKCkubGVuZ3RofSk7CiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcigpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgdXBkYXRlVW5yZWFkTWVzc2FnZXNDb3VudGVyOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB2YXIgbHMgPSB0aGlzLm1vZGVsLnBsdWNrKCdudW1fdW5yZWFkJyksCiAgICAgICAgICAgICAgICAgICAgY291bnQgPSAwLCBpOwogICAgICAgICAgICAgICAgZm9yIChpPTA7IGk8bHMubGVuZ3RoOyBpKyspIHsgY291bnQgKz0gbHNbaV07IH0KICAgICAgICAgICAgICAgIHRoaXMudG9nZ2xldmlldy5tb2RlbC5zZXQoeydudW1fdW5yZWFkJzogY291bnR9KTsKICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgdGhpcy5NaW5pbWl6ZWRDaGF0c1RvZ2dsZSA9IEJhY2tib25lLk1vZGVsLmV4dGVuZCh7CiAgICAgICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHRoaXMuc2V0KHsKICAgICAgICAgICAgICAgICAgICAnY29sbGFwc2VkJzogdGhpcy5nZXQoJ2NvbGxhcHNlZCcpIHx8IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICdudW1fbWluaW1pemVkJzogdGhpcy5nZXQoJ251bV9taW5pbWl6ZWQnKSB8fCAwLAogICAgICAgICAgICAgICAgICAgICdudW1fdW5yZWFkJzogIHRoaXMuZ2V0KCdudW1fdW5yZWFkJykgfHwgMAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgdGhpcy5NaW5pbWl6ZWRDaGF0c1RvZ2dsZVZpZXcgPSBCYWNrYm9uZS5WaWV3LmV4dGVuZCh7CiAgICAgICAgICAgIGVsOiAnI3RvZ2dsZS1taW5pbWl6ZWQtY2hhdHMnLAoKICAgICAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5vbignY2hhbmdlOm51bV9taW5pbWl6ZWQnLCB0aGlzLnJlbmRlciwgdGhpcyk7CiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLm9uKCdjaGFuZ2U6bnVtX3VucmVhZCcsIHRoaXMucmVuZGVyLCB0aGlzKTsKICAgICAgICAgICAgICAgIHRoaXMuJGZseW91dCA9IHRoaXMuJGVsLnNpYmxpbmdzKCcubWluaW1pemVkLWNoYXRzLWZseW91dCcpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRlbC5odG1sKGNvbnZlcnNlLnRlbXBsYXRlcy50b2dnbGVfY2hhdHMoCiAgICAgICAgICAgICAgICAgICAgXy5leHRlbmQodGhpcy5tb2RlbC50b0pTT04oKSwgewogICAgICAgICAgICAgICAgICAgICAgICAnTWluaW1pemVkJzogX18oJ01pbmltaXplZCcpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICkpOwogICAgICAgICAgICAgICAgaWYgKHRoaXMubW9kZWwuZ2V0KCdjb2xsYXBzZWQnKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuJGZseW91dC5oaWRlKCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRoaXMuJGZseW91dC5zaG93KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kZWw7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgdGhpcy5Sb3N0ZXJDb250YWN0ID0gQmFja2JvbmUuTW9kZWwuZXh0ZW5kKHsKICAgICAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKGF0dHJpYnV0ZXMsIG9wdGlvbnMpIHsKICAgICAgICAgICAgICAgIHZhciBqaWQgPSBhdHRyaWJ1dGVzLmppZDsKICAgICAgICAgICAgICAgIHZhciBhdHRycyA9IF8uZXh0ZW5kKHsKICAgICAgICAgICAgICAgICAgICAnaWQnOiBqaWQsCiAgICAgICAgICAgICAgICAgICAgJ2Z1bGxuYW1lJzogamlkLAogICAgICAgICAgICAgICAgICAgICdjaGF0X3N0YXR1cyc6ICdvZmZsaW5lJywKICAgICAgICAgICAgICAgICAgICAndXNlcl9pZCc6IFN0cm9waGUuZ2V0Tm9kZUZyb21KaWQoamlkKSwKICAgICAgICAgICAgICAgICAgICAncmVzb3VyY2VzJzogW10sCiAgICAgICAgICAgICAgICAgICAgJ2dyb3Vwcyc6IFtdLAogICAgICAgICAgICAgICAgICAgICdzdGF0dXMnOiAnJwogICAgICAgICAgICAgICAgfSwgYXR0cmlidXRlcyk7CiAgICAgICAgICAgICAgICB0aGlzLnNldChhdHRycyk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBzaG93SW5Sb3N0ZXI6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiAoIWNvbnZlcnNlLnNob3dfb25seV9vbmxpbmVfdXNlcnMgfHwgdGhpcy5nZXQoJ2NoYXRfc3RhdHVzJykgPT09ICdvbmxpbmUnKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICB0aGlzLlJvc3RlckNvbnRhY3RWaWV3ID0gQmFja2JvbmUuVmlldy5leHRlbmQoewogICAgICAgICAgICB0YWdOYW1lOiAnZGQnLAoKICAgICAgICAgICAgZXZlbnRzOiB7CiAgICAgICAgICAgICAgICAiY2xpY2sgLmFjY2VwdC14bXBwLXJlcXVlc3QiOiAiYWNjZXB0UmVxdWVzdCIsCiAgICAgICAgICAgICAgICAiY2xpY2sgLmRlY2xpbmUteG1wcC1yZXF1ZXN0IjogImRlY2xpbmVSZXF1ZXN0IiwKICAgICAgICAgICAgICAgICJjbGljayAub3Blbi1jaGF0IjogIm9wZW5DaGF0IiwKICAgICAgICAgICAgICAgICJjbGljayAucmVtb3ZlLXhtcHAtY29udGFjdCI6ICJyZW1vdmVDb250YWN0IgogICAgICAgICAgICB9LAoKICAgICAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5vbigiY2hhbmdlIiwgdGhpcy5yZW5kZXIsIHRoaXMpOwogICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5vbigicmVtb3ZlIiwgdGhpcy5yZW1vdmUsIHRoaXMpOwogICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5vbigiZGVzdHJveSIsIHRoaXMucmVtb3ZlLCB0aGlzKTsKICAgICAgICAgICAgICAgIHRoaXMubW9kZWwub24oIm9wZW4iLCB0aGlzLm9wZW5DaGF0LCB0aGlzKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIG9wZW5DaGF0OiBmdW5jdGlvbiAoZXYpIHsKICAgICAgICAgICAgICAgIGlmIChldiAmJiBldi5wcmV2ZW50RGVmYXVsdCkgeyBldi5wcmV2ZW50RGVmYXVsdCgpOyB9CiAgICAgICAgICAgICAgICAvLyBYWFg6IENhbiB0aGlzLm1vZGVsLmF0dHJpYnV0ZXMgYmUgdXNlZCBoZXJlLCBpbnN0ZWFkIG9mCiAgICAgICAgICAgICAgICAvLyBtYW51YWxseSBzcGVjaWZ5aW5nIGFsbCBhdHRyaWJ1dGVzPwogICAgICAgICAgICAgICAgcmV0dXJuIGNvbnZlcnNlLmNoYXRib3h2aWV3cy5zaG93Q2hhdCh7CiAgICAgICAgICAgICAgICAgICAgJ2lkJzogdGhpcy5tb2RlbC5nZXQoJ2ppZCcpLAogICAgICAgICAgICAgICAgICAgICdqaWQnOiB0aGlzLm1vZGVsLmdldCgnamlkJyksCiAgICAgICAgICAgICAgICAgICAgJ2Z1bGxuYW1lJzogdGhpcy5tb2RlbC5nZXQoJ2Z1bGxuYW1lJyksCiAgICAgICAgICAgICAgICAgICAgJ2ltYWdlX3R5cGUnOiB0aGlzLm1vZGVsLmdldCgnaW1hZ2VfdHlwZScpLAogICAgICAgICAgICAgICAgICAgICdpbWFnZSc6IHRoaXMubW9kZWwuZ2V0KCdpbWFnZScpLAogICAgICAgICAgICAgICAgICAgICd1cmwnOiB0aGlzLm1vZGVsLmdldCgndXJsJyksCiAgICAgICAgICAgICAgICAgICAgJ3N0YXR1cyc6IHRoaXMubW9kZWwuZ2V0KCdzdGF0dXMnKQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICByZW1vdmVDb250YWN0OiBmdW5jdGlvbiAoZXYpIHsKICAgICAgICAgICAgICAgIGlmIChldiAmJiBldi5wcmV2ZW50RGVmYXVsdCkgeyBldi5wcmV2ZW50RGVmYXVsdCgpOyB9CiAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gY29uZmlybShfXygiQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIHJlbW92ZSB0aGlzIGNvbnRhY3Q/IikpOwogICAgICAgICAgICAgICAgaWYgKHJlc3VsdCA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgICAgIHZhciBiYXJlX2ppZCA9IHRoaXMubW9kZWwuZ2V0KCdqaWQnKTsKICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS5jb25uZWN0aW9uLnJvc3Rlci5yZW1vdmUoYmFyZV9qaWQsICQucHJveHkoZnVuY3Rpb24gKGlxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLmNvbm5lY3Rpb24ucm9zdGVyLnVuYXV0aG9yaXplKGJhcmVfamlkKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29udmVyc2Uucm9zdGVydmlldy5tb2RlbC5yZW1vdmUoYmFyZV9qaWQpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLmRlc3Ryb3koKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmUoKTsKICAgICAgICAgICAgICAgICAgICB9LCB0aGlzKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBhY2NlcHRSZXF1ZXN0OiBmdW5jdGlvbiAoZXYpIHsKICAgICAgICAgICAgICAgIGlmIChldiAmJiBldi5wcmV2ZW50RGVmYXVsdCkgeyBldi5wcmV2ZW50RGVmYXVsdCgpOyB9CiAgICAgICAgICAgICAgICB2YXIgamlkID0gdGhpcy5tb2RlbC5nZXQoJ2ppZCcpOwogICAgICAgICAgICAgICAgY29udmVyc2UuY29ubmVjdGlvbi5yb3N0ZXIuYXV0aG9yaXplKGppZCk7CiAgICAgICAgICAgICAgICBjb252ZXJzZS5jb25uZWN0aW9uLnJvc3Rlci5hZGQoamlkLCB0aGlzLm1vZGVsLmdldCgnZnVsbG5hbWUnKSwgW10sIGZ1bmN0aW9uIChpcSkgewogICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLmNvbm5lY3Rpb24ucm9zdGVyLnN1YnNjcmliZShqaWQsIG51bGwsIGNvbnZlcnNlLnhtcHBzdGF0dXMuZ2V0KCdmdWxsbmFtZScpKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgZGVjbGluZVJlcXVlc3Q6IGZ1bmN0aW9uIChldikgewogICAgICAgICAgICAgICAgaWYgKGV2ICYmIGV2LnByZXZlbnREZWZhdWx0KSB7IGV2LnByZXZlbnREZWZhdWx0KCk7IH0KICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSBjb25maXJtKF9fKCJBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gZGVjbGluZSB0aGlzIGNvbnRhY3QgcmVxdWVzdD8iKSk7CiAgICAgICAgICAgICAgICBpZiAocmVzdWx0ID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgICAgICAgY29udmVyc2UuY29ubmVjdGlvbi5yb3N0ZXIudW5hdXRob3JpemUodGhpcy5tb2RlbC5nZXQoJ2ppZCcpKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLmRlc3Ryb3koKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMubW9kZWwuc2hvd0luUm9zdGVyKCkpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbC5oaWRlKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuJGVsWzBdLnN0eWxlLmRpc3BsYXkgPT09ICJub25lIikgewogICAgICAgICAgICAgICAgICAgIHRoaXMuJGVsLnNob3coKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHZhciBpdGVtID0gdGhpcy5tb2RlbCwKICAgICAgICAgICAgICAgICAgICBhc2sgPSBpdGVtLmdldCgnYXNrJyksCiAgICAgICAgICAgICAgICAgICAgY2hhdF9zdGF0dXMgPSBpdGVtLmdldCgnY2hhdF9zdGF0dXMnKSwKICAgICAgICAgICAgICAgICAgICByZXF1ZXN0aW5nICA9IGl0ZW0uZ2V0KCdyZXF1ZXN0aW5nJyksCiAgICAgICAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uID0gaXRlbS5nZXQoJ3N1YnNjcmlwdGlvbicpOwoKICAgICAgICAgICAgICAgIHZhciBjbGFzc2VzX3RvX3JlbW92ZSA9IFsKICAgICAgICAgICAgICAgICAgICAnY3VycmVudC14bXBwLWNvbnRhY3QnLAogICAgICAgICAgICAgICAgICAgICdwZW5kaW5nLXhtcHAtY29udGFjdCcsCiAgICAgICAgICAgICAgICAgICAgJ3JlcXVlc3RpbmcteG1wcC1jb250YWN0JwogICAgICAgICAgICAgICAgICAgIF0uY29uY2F0KF8ua2V5cyhTVEFUVVNFUykpOwoKICAgICAgICAgICAgICAgIF8uZWFjaChjbGFzc2VzX3RvX3JlbW92ZSwKICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoY2xzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmVsLmNsYXNzTmFtZS5pbmRleE9mKGNscykgIT09IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbC5yZW1vdmVDbGFzcyhjbHMpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwgdGhpcyk7CiAgICAgICAgICAgICAgICB0aGlzLiRlbC5hZGRDbGFzcyhjaGF0X3N0YXR1cykuZGF0YSgnc3RhdHVzJywgY2hhdF9zdGF0dXMpOwoKICAgICAgICAgICAgICAgIGlmICgoYXNrID09PSAnc3Vic2NyaWJlJykgfHwgKHN1YnNjcmlwdGlvbiA9PT0gJ2Zyb20nKSkgewogICAgICAgICAgICAgICAgICAgIC8qIGFzayA9PT0gJ3N1YnNjcmliZScKICAgICAgICAgICAgICAgICAgICAgKiAgICAgIE1lYW5zIHdlIGhhdmUgYXNrZWQgdG8gc3Vic2NyaWJlIHRvIHRoZW0uCiAgICAgICAgICAgICAgICAgICAgICoKICAgICAgICAgICAgICAgICAgICAgKiBzdWJzY3JpcHRpb24gPT09ICdmcm9tJwogICAgICAgICAgICAgICAgICAgICAqICAgICAgVGhleSBhcmUgc3Vic2NyaWJlZCB0byB1c2UsIGJ1dCBub3QgdmljZSB2ZXJzYS4KICAgICAgICAgICAgICAgICAgICAgKiAgICAgIFdlIGFzc3VtZSB0aGF0IHRoZXJlIGlzIGEgcGVuZGluZyBzdWJzY3JpcHRpb24KICAgICAgICAgICAgICAgICAgICAgKiAgICAgIGZyb20gdXMgdG8gdGhlbSAob3RoZXJ3aXNlIHdlJ3JlIGluIGEgc3RhdGUgbm90CiAgICAgICAgICAgICAgICAgICAgICogICAgICBzdXBwb3J0ZWQgYnkgY29udmVyc2UuanMpLgogICAgICAgICAgICAgICAgICAgICAqCiAgICAgICAgICAgICAgICAgICAgICogIFNvIGluIGJvdGggY2FzZXMgdGhlIHVzZXIgaXMgYSAicGVuZGluZyIgY29udGFjdC4KICAgICAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbC5hZGRDbGFzcygncGVuZGluZy14bXBwLWNvbnRhY3QnKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbC5odG1sKGNvbnZlcnNlLnRlbXBsYXRlcy5wZW5kaW5nX2NvbnRhY3QoCiAgICAgICAgICAgICAgICAgICAgICAgIF8uZXh0ZW5kKGl0ZW0udG9KU09OKCksIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkZXNjX3JlbW92ZSc6IF9fKCdDbGljayB0byByZW1vdmUgdGhpcyBjb250YWN0JykKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICApKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVxdWVzdGluZyA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuJGVsLmFkZENsYXNzKCdyZXF1ZXN0aW5nLXhtcHAtY29udGFjdCcpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuJGVsLmh0bWwoY29udmVyc2UudGVtcGxhdGVzLnJlcXVlc3RpbmdfY29udGFjdCgKICAgICAgICAgICAgICAgICAgICAgICAgXy5leHRlbmQoaXRlbS50b0pTT04oKSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Rlc2NfYWNjZXB0JzogX18oIkNsaWNrIHRvIGFjY2VwdCB0aGlzIGNvbnRhY3QgcmVxdWVzdCIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Rlc2NfZGVjbGluZSc6IF9fKCJDbGljayB0byBkZWNsaW5lIHRoaXMgY29udGFjdCByZXF1ZXN0IikKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICApKTsKICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS5jb250cm9sYm94dG9nZ2xlLnNob3dDb250cm9sQm94KCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHN1YnNjcmlwdGlvbiA9PT0gJ2JvdGgnIHx8IHN1YnNjcmlwdGlvbiA9PT0gJ3RvJykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuJGVsLmFkZENsYXNzKCdjdXJyZW50LXhtcHAtY29udGFjdCcpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuJGVsLmh0bWwoY29udmVyc2UudGVtcGxhdGVzLnJvc3Rlcl9pdGVtKAogICAgICAgICAgICAgICAgICAgICAgICBfLmV4dGVuZChpdGVtLnRvSlNPTigpLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGVzY19zdGF0dXMnOiBTVEFUVVNFU1tjaGF0X3N0YXR1c3x8J29mZmxpbmUnXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkZXNjX2NoYXQnOiBfXygnQ2xpY2sgdG8gY2hhdCB3aXRoIHRoaXMgY29udGFjdCcpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Rlc2NfcmVtb3ZlJzogX18oJ0NsaWNrIHRvIHJlbW92ZSB0aGlzIGNvbnRhY3QnKQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgdGhpcy5Sb3N0ZXJDb250YWN0cyA9IEJhY2tib25lLkNvbGxlY3Rpb24uZXh0ZW5kKHsKICAgICAgICAgICAgbW9kZWw6IGNvbnZlcnNlLlJvc3RlckNvbnRhY3QsCiAgICAgICAgICAgIGNvbXBhcmF0b3I6IGZ1bmN0aW9uIChjb250YWN0MSwgY29udGFjdDIpIHsKICAgICAgICAgICAgICAgIHZhciBuYW1lMSwgbmFtZTI7CiAgICAgICAgICAgICAgICB2YXIgc3RhdHVzMSA9IGNvbnRhY3QxLmdldCgnY2hhdF9zdGF0dXMnKSB8fCAnb2ZmbGluZSc7CiAgICAgICAgICAgICAgICB2YXIgc3RhdHVzMiA9IGNvbnRhY3QyLmdldCgnY2hhdF9zdGF0dXMnKSB8fCAnb2ZmbGluZSc7CiAgICAgICAgICAgICAgICBpZiAoU1RBVFVTX1dFSUdIVFNbc3RhdHVzMV0gPT09IFNUQVRVU19XRUlHSFRTW3N0YXR1czJdKSB7CiAgICAgICAgICAgICAgICAgICAgbmFtZTEgPSBjb250YWN0MS5nZXQoJ2Z1bGxuYW1lJykudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICAgICAgICBuYW1lMiA9IGNvbnRhY3QyLmdldCgnZnVsbG5hbWUnKS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBuYW1lMSA8IG5hbWUyID8gLTEgOiAobmFtZTEgPiBuYW1lMj8gMSA6IDApOwogICAgICAgICAgICAgICAgfSBlbHNlICB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFNUQVRVU19XRUlHSFRTW3N0YXR1czFdIDwgU1RBVFVTX1dFSUdIVFNbc3RhdHVzMl0gPyAtMSA6IDE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBzdWJzY3JpYmVUb1N1Z2dlc3RlZEl0ZW1zOiBmdW5jdGlvbiAobXNnKSB7CiAgICAgICAgICAgICAgICAkKG1zZykuZmluZCgnaXRlbScpLmVhY2goZnVuY3Rpb24gKGksIGl0ZW1zKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyICR0aGlzID0gJCh0aGlzKSwKICAgICAgICAgICAgICAgICAgICAgICAgamlkID0gJHRoaXMuYXR0cignamlkJyksCiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbiA9ICR0aGlzLmF0dHIoJ2FjdGlvbicpLAogICAgICAgICAgICAgICAgICAgICAgICBmdWxsbmFtZSA9ICR0aGlzLmF0dHIoJ25hbWUnKTsKICAgICAgICAgICAgICAgICAgICBpZiAoYWN0aW9uID09PSAnYWRkJykgewogICAgICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS5jb25uZWN0aW9uLnJvc3Rlci5zdWJzY3JpYmUoamlkLCBudWxsLCBjb252ZXJzZS54bXBwc3RhdHVzLmdldCgnZnVsbG5hbWUnKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGlzU2VsZjogZnVuY3Rpb24gKGppZCkgewogICAgICAgICAgICAgICAgcmV0dXJuIChTdHJvcGhlLmdldEJhcmVKaWRGcm9tSmlkKGppZCkgPT09IFN0cm9waGUuZ2V0QmFyZUppZEZyb21KaWQoY29udmVyc2UuY29ubmVjdGlvbi5qaWQpKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGFkZFJlc291cmNlOiBmdW5jdGlvbiAoYmFyZV9qaWQsIHJlc291cmNlKSB7CiAgICAgICAgICAgICAgICB2YXIgaXRlbSA9IHRoaXMuZ2V0KGJhcmVfamlkKSwKICAgICAgICAgICAgICAgICAgICByZXNvdXJjZXM7CiAgICAgICAgICAgICAgICBpZiAoaXRlbSkgewogICAgICAgICAgICAgICAgICAgIHJlc291cmNlcyA9IGl0ZW0uZ2V0KCdyZXNvdXJjZXMnKTsKICAgICAgICAgICAgICAgICAgICBpZiAocmVzb3VyY2VzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfLmluZGV4T2YocmVzb3VyY2VzLCByZXNvdXJjZSkgPT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc291cmNlcy5wdXNoKHJlc291cmNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uc2V0KHsncmVzb3VyY2VzJzogcmVzb3VyY2VzfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgIHsKICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5zZXQoeydyZXNvdXJjZXMnOiBbcmVzb3VyY2VdfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgcmVtb3ZlUmVzb3VyY2U6IGZ1bmN0aW9uIChiYXJlX2ppZCwgcmVzb3VyY2UpIHsKICAgICAgICAgICAgICAgIHZhciBpdGVtID0gdGhpcy5nZXQoYmFyZV9qaWQpLAogICAgICAgICAgICAgICAgICAgIHJlc291cmNlcywKICAgICAgICAgICAgICAgICAgICBpZHg7CiAgICAgICAgICAgICAgICBpZiAoaXRlbSkgewogICAgICAgICAgICAgICAgICAgIHJlc291cmNlcyA9IGl0ZW0uZ2V0KCdyZXNvdXJjZXMnKTsKICAgICAgICAgICAgICAgICAgICBpZHggPSBfLmluZGV4T2YocmVzb3VyY2VzLCByZXNvdXJjZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGlkeCAhPT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VzLnNwbGljZShpZHgsIDEpOwogICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnNldCh7J3Jlc291cmNlcyc6IHJlc291cmNlc30pOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzb3VyY2VzLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHN1YnNjcmliZUJhY2s6IGZ1bmN0aW9uIChqaWQpIHsKICAgICAgICAgICAgICAgIHZhciBiYXJlX2ppZCA9IFN0cm9waGUuZ2V0QmFyZUppZEZyb21KaWQoamlkKTsKICAgICAgICAgICAgICAgIGlmIChjb252ZXJzZS5jb25uZWN0aW9uLnJvc3Rlci5maW5kSXRlbShiYXJlX2ppZCkpIHsKICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS5jb25uZWN0aW9uLnJvc3Rlci5hdXRob3JpemUoYmFyZV9qaWQpOwogICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLmNvbm5lY3Rpb24ucm9zdGVyLnN1YnNjcmliZShqaWQsIG51bGwsIGNvbnZlcnNlLnhtcHBzdGF0dXMuZ2V0KCdmdWxsbmFtZScpKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgY29udmVyc2UuY29ubmVjdGlvbi5yb3N0ZXIuYWRkKGppZCwgJycsIFtdLCBmdW5jdGlvbiAoaXEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29udmVyc2UuY29ubmVjdGlvbi5yb3N0ZXIuYXV0aG9yaXplKGJhcmVfamlkKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29udmVyc2UuY29ubmVjdGlvbi5yb3N0ZXIuc3Vic2NyaWJlKGppZCwgbnVsbCwgY29udmVyc2UueG1wcHN0YXR1cy5nZXQoJ2Z1bGxuYW1lJykpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgdW5zdWJzY3JpYmU6IGZ1bmN0aW9uIChqaWQpIHsKICAgICAgICAgICAgICAgIC8qIFVwb24gcmVjZWl2aW5nIHRoZSBwcmVzZW5jZSBzdGFuemEgb2YgdHlwZSAidW5zdWJzY3JpYmVkIiwKICAgICAgICAgICAgICAgICogdGhlIHVzZXIgU0hPVUxEIGFja25vd2xlZGdlIHJlY2VpcHQgb2YgdGhhdCBzdWJzY3JpcHRpb24gc3RhdGUKICAgICAgICAgICAgICAgICogbm90aWZpY2F0aW9uIGJ5IHNlbmRpbmcgYSBwcmVzZW5jZSBzdGFuemEgb2YgdHlwZSAidW5zdWJzY3JpYmUiCiAgICAgICAgICAgICAgICAqIHRoaXMgc3RlcCBsZXRzIHRoZSB1c2VyJ3Mgc2VydmVyIGtub3cgdGhhdCBpdCBNVVNUIG5vIGxvbmdlcgogICAgICAgICAgICAgICAgKiBzZW5kIG5vdGlmaWNhdGlvbiBvZiB0aGUgc3Vic2NyaXB0aW9uIHN0YXRlIGNoYW5nZSB0byB0aGUgdXNlci4KICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICBjb252ZXJzZS54bXBwc3RhdHVzLnNlbmRQcmVzZW5jZSgndW5zdWJzY3JpYmUnKTsKICAgICAgICAgICAgICAgIGlmIChjb252ZXJzZS5jb25uZWN0aW9uLnJvc3Rlci5maW5kSXRlbShqaWQpKSB7CiAgICAgICAgICAgICAgICAgICAgY29udmVyc2UuY29ubmVjdGlvbi5yb3N0ZXIucmVtb3ZlKGppZCwgZnVuY3Rpb24gKGlxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLnJvc3RlcnZpZXcubW9kZWwucmVtb3ZlKGppZCk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBnZXROdW1PbmxpbmVDb250YWN0czogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIGNvdW50ID0gMCwKICAgICAgICAgICAgICAgICAgICBpZ25vcmVkID0gWydvZmZsaW5lJywgJ3VuYXZhaWxhYmxlJ10sCiAgICAgICAgICAgICAgICAgICAgbW9kZWxzID0gdGhpcy5tb2RlbHMsCiAgICAgICAgICAgICAgICAgICAgbW9kZWxzX2xlbmd0aCA9IG1vZGVscy5sZW5ndGgsCiAgICAgICAgICAgICAgICAgICAgaTsKICAgICAgICAgICAgICAgIGlmIChjb252ZXJzZS5zaG93X29ubHlfb25saW5lX3VzZXJzKSB7CiAgICAgICAgICAgICAgICAgICAgaWdub3JlZCA9IF8udW5pb24oaWdub3JlZCwgWydkbmQnLCAneGEnLCAnYXdheSddKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGZvciAoaT0wOyBpPG1vZGVsc19sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgIGlmIChfLmluZGV4T2YoaWdub3JlZCwgbW9kZWxzW2ldLmdldCgnY2hhdF9zdGF0dXMnKSkgPT09IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50Kys7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGNvdW50OwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgY2xlYXJDYWNoZTogZnVuY3Rpb24gKGl0ZW1zKSB7CiAgICAgICAgICAgICAgICAvKiBUaGUgbG9jYWxzdG9yYWdlIGNhY2hlIGNvbnRhaW5pbmcgcm9zdGVyIGNvbnRhY3RzIG1pZ2h0IGNvbnRhaW4KICAgICAgICAgICAgICAgICogc29tZSBjb250YWN0cyB0aGF0IGFyZW4ndCBhY3R1YWxseSBpbiBvdXIgcm9zdGVyIGFueW1vcmUuIFdlCiAgICAgICAgICAgICAgICAqIHRoZXJlZm9yZSBuZWVkIHRvIHJlbW92ZSB0aGVtIG5vdy4KICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICB2YXIgaWQsIGksIGNvbnRhY3Q7CiAgICAgICAgICAgICAgICBmb3IgKGk9MDsgaSA8IHRoaXMubW9kZWxzLmxlbmd0aDsgKytpKSB7CiAgICAgICAgICAgICAgICAgICAgaWQgPSB0aGlzLm1vZGVsc1tpXS5nZXQoJ2lkJyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKF8uaW5kZXhPZihfLnBsdWNrKGl0ZW1zLCAnamlkJyksIGlkKSA9PT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29udGFjdCA9IHRoaXMuZ2V0KGlkKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnRhY3QgJiYgIWNvbnRhY3QuZ2V0KCdyZXF1ZXN0aW5nJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhY3QuZGVzdHJveSgpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgLy8gVE9ETzogc2VlIGlmIHdlIGNhbiBvbmx5IHVzZSAybmQgaXRlbSBwYXIKICAgICAgICAgICAgcm9zdGVySGFuZGxlcjogZnVuY3Rpb24gKGl0ZW1zLCBpdGVtKSB7CiAgICAgICAgICAgICAgICBjb252ZXJzZS5lbWl0KCdyb3N0ZXInLCBpdGVtcyk7CiAgICAgICAgICAgICAgICB0aGlzLmNsZWFyQ2FjaGUoaXRlbXMpOwogICAgICAgICAgICAgICAgdmFyIG5ld19pdGVtcyA9IGl0ZW0gPyBbaXRlbV0gOiBpdGVtczsKICAgICAgICAgICAgICAgIF8uZWFjaChuZXdfaXRlbXMsIGZ1bmN0aW9uIChpdGVtLCBpbmRleCwgaXRlbXMpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pc1NlbGYoaXRlbS5qaWQpKSB7IHJldHVybjsgfQogICAgICAgICAgICAgICAgICAgIHZhciBtb2RlbCA9IHRoaXMuZ2V0KGl0ZW0uamlkKTsKICAgICAgICAgICAgICAgICAgICBpZiAoIW1vZGVsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpc19sYXN0ID0gKGluZGV4ID09PSAoaXRlbXMubGVuZ3RoLTEpKSA/IHRydWUgOiBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChpdGVtLnN1YnNjcmlwdGlvbiA9PT0gJ25vbmUnKSAmJiAoaXRlbS5hc2sgPT09IG51bGwpICYmICFpc19sYXN0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBXZSdyZSBub3QgaW50ZXJlc3RlZCBpbiB6b21iaWVzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAoSGFjazogZXhjZXB0IGlmIGl0J3MgdGhlIGxhc3QgaXRlbSwgdGhlbiB3ZSBzdGlsbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYWRkIGl0IHNvIHRoYXQgdGhlIHJvc3RlciB3aWxsIGJlIHNob3duKS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNyZWF0ZSh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhc2s6IGl0ZW0uYXNrLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsbG5hbWU6IGl0ZW0ubmFtZSB8fCBpdGVtLmppZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VwczogaXRlbS5ncm91cHMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqaWQ6IGl0ZW0uamlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uOiBpdGVtLnN1YnNjcmlwdGlvbgogICAgICAgICAgICAgICAgICAgICAgICB9LCB7c29ydDogZmFsc2V9KTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoKGl0ZW0uc3Vic2NyaXB0aW9uID09PSAnbm9uZScpICYmIChpdGVtLmFzayA9PT0gbnVsbCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgdXNlciBpcyBubyBsb25nZXIgaW4gb3VyIHJvc3RlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kZWwuZGVzdHJveSgpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gV2Ugb25seSBmaW5kIG91dCBhYm91dCByZXF1ZXN0aW5nIGNvbnRhY3RzIHZpYSB0aGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHByZXNlbmNlIGhhbmRsZXIsIHNvIGlmIHdlIHJlY2VpdmUgYSBjb250YWN0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBoZXJlLCB3ZSBrbm93IHRoZXkgYXJlbid0IHJlcXVlc3RpbmcgYW55bW9yZS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNlZSBkb2NzL0RFVkVMT1BFUi5yc3QKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsLnNhdmUoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1YnNjcmlwdGlvbjogaXRlbS5zdWJzY3JpcHRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXNrOiBpdGVtLmFzaywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0aW5nOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VwczogaXRlbS5ncm91cHMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwgdGhpcyk7CgogICAgICAgICAgICAgICAgaWYgKCFjb252ZXJzZS5pbml0aWFsX3ByZXNlbmNlX3NlbnQpIHsKICAgICAgICAgICAgICAgICAgICAvKiBPbmNlIHdlJ3ZlIHNlbnQgb3V0IG91ciBpbml0aWFsIHByZXNlbmNlIHN0YW56YSwgd2UnbGwKICAgICAgICAgICAgICAgICAgICAgKiBzdGFydCByZWNlaXZpbmcgcHJlc2VuY2Ugc3RhbnphcyBmcm9tIG91ciBjb250YWN0cy4KICAgICAgICAgICAgICAgICAgICAgKiBXZSB0aGVyZWZvcmUgb25seSB3YW50IHRvIGRvIHRoaXMgYWZ0ZXIgb3VyIHJvc3RlciBoYXMKICAgICAgICAgICAgICAgICAgICAgKiBiZWVuIHNldCB1cCAob3RoZXJ3aXNlIHdlIGNhbid0IG1lYW5pbmdmdWxseSBwcm9jZXNzCiAgICAgICAgICAgICAgICAgICAgICogaW5jb21pbmcgcHJlc2VuY2Ugc3RhbnphcykuCiAgICAgICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICAgICAgY29udmVyc2UuaW5pdGlhbF9wcmVzZW5jZV9zZW50ID0gMTsKICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS54bXBwc3RhdHVzLnNlbmRQcmVzZW5jZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgaGFuZGxlSW5jb21pbmdTdWJzY3JpcHRpb246IGZ1bmN0aW9uIChqaWQpIHsKICAgICAgICAgICAgICAgIHZhciBiYXJlX2ppZCA9IFN0cm9waGUuZ2V0QmFyZUppZEZyb21KaWQoamlkKTsKICAgICAgICAgICAgICAgIHZhciBpdGVtID0gdGhpcy5nZXQoYmFyZV9qaWQpOwoKICAgICAgICAgICAgICAgIGlmICghY29udmVyc2UuYWxsb3dfY29udGFjdF9yZXF1ZXN0cykgewogICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLmNvbm5lY3Rpb24ucm9zdGVyLnVuYXV0aG9yaXplKGJhcmVfamlkKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChjb252ZXJzZS5hdXRvX3N1YnNjcmliZSkgewogICAgICAgICAgICAgICAgICAgIGlmICgoIWl0ZW0pIHx8IChpdGVtLmdldCgnc3Vic2NyaXB0aW9uJykgIT0gJ3RvJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdWJzY3JpYmVCYWNrKGppZCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29udmVyc2UuY29ubmVjdGlvbi5yb3N0ZXIuYXV0aG9yaXplKGJhcmVfamlkKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmICgoaXRlbSkgJiYgKGl0ZW0uZ2V0KCdzdWJzY3JpcHRpb24nKSAhPSAnbm9uZScpKSAgewogICAgICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS5jb25uZWN0aW9uLnJvc3Rlci5hdXRob3JpemUoYmFyZV9qaWQpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5nZXQoYmFyZV9qaWQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS5nZXRWQ2FyZCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYXJlX2ppZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLnByb3h5KGZ1bmN0aW9uIChqaWQsIGZ1bGxuYW1lLCBpbWcsIGltZ190eXBlLCB1cmwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGQoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgamlkOiBiYXJlX2ppZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1YnNjcmlwdGlvbjogJ25vbmUnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXNrOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdGluZzogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGxuYW1lOiBmdWxsbmFtZSB8fCBqaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbWFnZTogaW1nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW1hZ2VfdHlwZTogaW1nX3R5cGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmw6IHVybCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZjYXJkX3VwZGF0ZWQ6IG1vbWVudCgpLmZvcm1hdCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHRoaXMpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQucHJveHkoZnVuY3Rpb24gKGppZCwgaXEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udmVyc2UubG9nKCJFcnJvciB3aGlsZSByZXRyaWV2aW5nIHZjYXJkIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGppZDogYmFyZV9qaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb246ICdub25lJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzazogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3Rpbmc6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdWxsbmFtZTogYmFyZV9qaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Y2FyZF91cGRhdGVkOiBtb21lbnQoKS5mb3JtYXQoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCB0aGlzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBwcmVzZW5jZUhhbmRsZXI6IGZ1bmN0aW9uIChwcmVzZW5jZSkgewogICAgICAgICAgICAgICAgdmFyICRwcmVzZW5jZSA9ICQocHJlc2VuY2UpLAogICAgICAgICAgICAgICAgICAgIHByZXNlbmNlX3R5cGUgPSAkcHJlc2VuY2UuYXR0cigndHlwZScpOwogICAgICAgICAgICAgICAgaWYgKHByZXNlbmNlX3R5cGUgPT09ICdlcnJvcicpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHZhciBqaWQgPSAkcHJlc2VuY2UuYXR0cignZnJvbScpLAogICAgICAgICAgICAgICAgICAgIGJhcmVfamlkID0gU3Ryb3BoZS5nZXRCYXJlSmlkRnJvbUppZChqaWQpLAogICAgICAgICAgICAgICAgICAgIHJlc291cmNlID0gU3Ryb3BoZS5nZXRSZXNvdXJjZUZyb21KaWQoamlkKSwKICAgICAgICAgICAgICAgICAgICAkc2hvdyA9ICRwcmVzZW5jZS5maW5kKCdzaG93JyksCiAgICAgICAgICAgICAgICAgICAgY2hhdF9zdGF0dXMgPSAkc2hvdy50ZXh0KCkgfHwgJ29ubGluZScsCiAgICAgICAgICAgICAgICAgICAgc3RhdHVzX21lc3NhZ2UgPSAkcHJlc2VuY2UuZmluZCgnc3RhdHVzJyksCiAgICAgICAgICAgICAgICAgICAgY29udGFjdDsKCiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc1NlbGYoYmFyZV9qaWQpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKChjb252ZXJzZS5jb25uZWN0aW9uLmppZCAhPT0gamlkKSYmKHByZXNlbmNlX3R5cGUgIT09ICd1bmF2YWlsYWJsZScpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFub3RoZXIgcmVzb3VyY2UgaGFzIGNoYW5nZWQgaXQncyBzdGF0dXMsIHdlJ2xsIHVwZGF0ZSBvdXJzIGFzIHdlbGwuCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLnhtcHBzdGF0dXMuc2F2ZSh7J3N0YXR1cyc6IGNoYXRfc3RhdHVzfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICgoJHByZXNlbmNlLmZpbmQoJ3gnKS5hdHRyKCd4bWxucycpIHx8ICcnKS5pbmRleE9mKFN0cm9waGUuTlMuTVVDKSA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOyAvLyBJZ25vcmUgTVVDCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb250YWN0ID0gdGhpcy5nZXQoYmFyZV9qaWQpOwogICAgICAgICAgICAgICAgaWYgKGNvbnRhY3QgJiYgKHN0YXR1c19tZXNzYWdlLnRleHQoKSAhPSBjb250YWN0LmdldCgnc3RhdHVzJykpKSB7CiAgICAgICAgICAgICAgICAgICAgY29udGFjdC5zYXZlKHsnc3RhdHVzJzogc3RhdHVzX21lc3NhZ2UudGV4dCgpfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoKHByZXNlbmNlX3R5cGUgPT09ICdzdWJzY3JpYmVkJykgfHwgKHByZXNlbmNlX3R5cGUgPT09ICd1bnN1YnNjcmliZScpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHByZXNlbmNlX3R5cGUgPT09ICdzdWJzY3JpYmUnKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaGFuZGxlSW5jb21pbmdTdWJzY3JpcHRpb24oamlkKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocHJlc2VuY2VfdHlwZSA9PT0gJ3Vuc3Vic2NyaWJlZCcpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnVuc3Vic2NyaWJlKGJhcmVfamlkKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocHJlc2VuY2VfdHlwZSA9PT0gJ3VuYXZhaWxhYmxlJykgewogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnJlbW92ZVJlc291cmNlKGJhcmVfamlkLCByZXNvdXJjZSkgPT09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnRhY3QpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhY3Quc2F2ZSh7J2NoYXRfc3RhdHVzJzogJ29mZmxpbmUnfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNvbnRhY3QpIHsKICAgICAgICAgICAgICAgICAgICAvLyBwcmVzZW5jZV90eXBlIGlzIHVuZGVmaW5lZAogICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkUmVzb3VyY2UoYmFyZV9qaWQsIHJlc291cmNlKTsKICAgICAgICAgICAgICAgICAgICBjb250YWN0LnNhdmUoeydjaGF0X3N0YXR1cyc6IGNoYXRfc3RhdHVzfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICB0aGlzLlJvc3Rlckdyb3VwID0gQmFja2JvbmUuTW9kZWwuZXh0ZW5kKHsKICAgICAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKGF0dHJpYnV0ZXMsIG9wdGlvbnMpIHsKICAgICAgICAgICAgICAgIHRoaXMuc2V0KF8uZXh0ZW5kKHsKICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogREVTQ19HUk9VUF9UT0dHTEUsCiAgICAgICAgICAgICAgICAgICAgc3RhdGU6IE9QRU5FRAogICAgICAgICAgICAgICAgfSwgYXR0cmlidXRlcykpOwogICAgICAgICAgICAgICAgLy8gQ29sbGVjdGlvbiBvZiBjb250YWN0cyBiZWxvbmdpbmcgdG8gdGhpcyBncm91cC4KICAgICAgICAgICAgICAgIHRoaXMuY29udGFjdHMgPSBuZXcgY29udmVyc2UuUm9zdGVyQ29udGFjdHMoKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICB0aGlzLlJvc3Rlckdyb3VwVmlldyA9IEJhY2tib25lLk92ZXJ2aWV3LmV4dGVuZCh7CiAgICAgICAgICAgIHRhZ05hbWU6ICdkdCcsCiAgICAgICAgICAgIGNsYXNzTmFtZTogJ3Jvc3Rlci1ncm91cCcsCiAgICAgICAgICAgIGV2ZW50czogewogICAgICAgICAgICAgICAgImNsaWNrIGEuZ3JvdXAtdG9nZ2xlIjogInRvZ2dsZSIKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuY29udGFjdHMub24oImFkZCIsIHRoaXMuYWRkQ29udGFjdCwgdGhpcyk7CiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLmNvbnRhY3RzLm9uKCJjaGFuZ2U6c3Vic2NyaXB0aW9uIiwgdGhpcy5vbkNvbnRhY3RTdWJzY3JpcHRpb25DaGFuZ2UsIHRoaXMpOwogICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5jb250YWN0cy5vbigiY2hhbmdlOnJlcXVlc3RpbmciLCB0aGlzLm9uQ29udGFjdFJlcXVlc3RDaGFuZ2UsIHRoaXMpOwogICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5jb250YWN0cy5vbigiY2hhbmdlOmNoYXRfc3RhdHVzIiwgZnVuY3Rpb24gKGNvbnRhY3QpIHsKICAgICAgICAgICAgICAgICAgICAvLyBUaGlzIG1pZ2h0IGJlIG9wdGltaXplZCBieSBpbnN0ZWFkIG9mIGZpcnN0IHNvcnRpbmcsCiAgICAgICAgICAgICAgICAgICAgLy8gZmluZGluZyB0aGUgY29ycmVjdCBwb3NpdGlvbiBpbiBwb3NpdGlvbkNvbnRhY3QKICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLmNvbnRhY3RzLnNvcnQoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnBvc2l0aW9uQ29udGFjdChjb250YWN0KS5yZW5kZXIoKTsKICAgICAgICAgICAgICAgIH0sIHRoaXMpOwogICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5jb250YWN0cy5vbigiZGVzdHJveSIsIHRoaXMub25SZW1vdmUsIHRoaXMpOwogICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5jb250YWN0cy5vbigicmVtb3ZlIiwgdGhpcy5vblJlbW92ZSwgdGhpcyk7CiAgICAgICAgICAgICAgICBjb252ZXJzZS5yb3N0ZXIub24oJ2NoYW5nZTpncm91cHMnLCB0aGlzLm9uQ29udGFjdEdyb3VwQ2hhbmdlLCB0aGlzKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdGhpcy4kZWwuYXR0cignZGF0YS1ncm91cCcsIHRoaXMubW9kZWwuZ2V0KCduYW1lJykpOwogICAgICAgICAgICAgICAgdGhpcy4kZWwuaHRtbCgKICAgICAgICAgICAgICAgICAgICAkKGNvbnZlcnNlLnRlbXBsYXRlcy5ncm91cF9oZWFkZXIoewogICAgICAgICAgICAgICAgICAgICAgICBsYWJlbF9ncm91cDogdGhpcy5tb2RlbC5nZXQoJ25hbWUnKSwKICAgICAgICAgICAgICAgICAgICAgICAgZGVzY19ncm91cF90b2dnbGU6IHRoaXMubW9kZWwuZ2V0KCdkZXNjcmlwdGlvbicpLAogICAgICAgICAgICAgICAgICAgICAgICB0b2dnbGVfc3RhdGU6IHRoaXMubW9kZWwuZ2V0KCdzdGF0ZScpCiAgICAgICAgICAgICAgICAgICAgfSkpCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBhZGRDb250YWN0OiBmdW5jdGlvbiAoY29udGFjdCkgewogICAgICAgICAgICAgICAgdmFyIHZpZXcgPSBuZXcgY29udmVyc2UuUm9zdGVyQ29udGFjdFZpZXcoe21vZGVsOiBjb250YWN0fSk7CiAgICAgICAgICAgICAgICB0aGlzLmFkZChjb250YWN0LmdldCgnaWQnKSwgdmlldyk7CiAgICAgICAgICAgICAgICB2aWV3ID0gdGhpcy5wb3NpdGlvbkNvbnRhY3QoY29udGFjdCkucmVuZGVyKCk7CiAgICAgICAgICAgICAgICBpZiAoY29udGFjdC5zaG93SW5Sb3N0ZXIoKSkgewogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm1vZGVsLmdldCgnc3RhdGUnKSA9PT0gQ0xPU0VEKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2aWV3LiRlbFswXS5zdHlsZS5kaXNwbGF5ICE9PSAibm9uZSIpIHsgdmlldy4kZWwuaGlkZSgpOyB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLiRlbFswXS5zdHlsZS5kaXNwbGF5ID09PSAibm9uZSIpIHsgdGhpcy4kZWwuc2hvdygpOyB9CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuJGVsWzBdLnN0eWxlLmRpc3BsYXkgIT09ICJibG9jayIpIHsgdGhpcy5zaG93KCk7IH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBwb3NpdGlvbkNvbnRhY3Q6IGZ1bmN0aW9uIChjb250YWN0KSB7CiAgICAgICAgICAgICAgICAvKiBQbGFjZSB0aGUgY29udGFjdCdzIERPTSBlbGVtZW50IGluIHRoZSBjb3JyZWN0IGFscGhhYmV0aWNhbAogICAgICAgICAgICAgICAgICogcG9zaXRpb24gYW1vbmdzdCB0aGUgb3RoZXIgY29udGFjdHMgaW4gdGhpcyBncm91cC4KICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgdmFyIHZpZXcgPSB0aGlzLmdldChjb250YWN0LmdldCgnaWQnKSk7CiAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSB0aGlzLm1vZGVsLmNvbnRhY3RzLmluZGV4T2YoY29udGFjdCk7CiAgICAgICAgICAgICAgICB2aWV3LiRlbC5kZXRhY2goKTsKICAgICAgICAgICAgICAgIGlmIChpbmRleCA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuJGVsLmFmdGVyKHZpZXcuJGVsKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaW5kZXggPT0gKHRoaXMubW9kZWwuY29udGFjdHMubGVuZ3RoLTEpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kZWwubmV4dFVudGlsKCdkdCcpLmxhc3QoKS5hZnRlcih2aWV3LiRlbCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRoaXMuJGVsLm5leHRVbnRpbCgnZHQnKS5lcShpbmRleCkuYmVmb3JlKHZpZXcuJGVsKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB2aWV3OwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgc2hvdzogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgLy8gRklYTUU6IFRoZXJlJ3MgYSBidWcgaGVyZSwgaWYgc2hvd19vbmx5X29ubGluZV91c2VycyBpcyB0cnVlCiAgICAgICAgICAgICAgICAvLyBQb3NzaWJsZSBzb2x1dGlvbiwgZ2V0IHRoZSBncm91cCwgY2FsbCBfLmVhY2ggYW5kIGNoZWNrCiAgICAgICAgICAgICAgICAvLyBzaG93SW5Sb3N0ZXIKICAgICAgICAgICAgICAgIHRoaXMuJGVsLm5leHRVbnRpbCgnZHQnKS5hZGRCYWNrKCkuc2hvdygpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgaGlkZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdGhpcy4kZWwubmV4dFVudGlsKCdkdCcpLmFkZEJhY2soKS5oaWRlKCk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBmaWx0ZXI6IGZ1bmN0aW9uIChxKSB7CiAgICAgICAgICAgICAgICAvKiBGaWx0ZXIgdGhlIGdyb3VwJ3MgY29udGFjdHMgYmFzZWQgb24gdGhlIHF1ZXJ5ICJxIi4KICAgICAgICAgICAgICAgICAqIFRoZSBxdWVyeSBpcyBtYXRjaGVkIGFnYWluc3QgdGhlIGNvbnRhY3QncyBmdWxsIG5hbWUuCiAgICAgICAgICAgICAgICAgKiBJZiBhbGwgY29udGFjdHMgYXJlIGZpbHRlcmVkIG91dCAoaS5lLiBoaWRkZW4pLCB0aGVuIHRoZQogICAgICAgICAgICAgICAgICogZ3JvdXAgbXVzdCBiZSBmaWx0ZXJlZCBvdXQgYXMgd2VsbC4KICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgdmFyIG1hdGNoZXMsIHJlamVjdHM7CiAgICAgICAgICAgICAgICBpZiAocS5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5tb2RlbC5nZXQoJ3N0YXRlJykgPT09IE9QRU5FRCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLmNvbnRhY3RzLmVhY2goJC5wcm94eShmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uc2hvd0luUm9zdGVyKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdldChpdGVtLmdldCgnaWQnKSkuJGVsLnNob3coKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSwgdGhpcykpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dJZkludmlzaWJsZSgpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBxID0gcS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgICAgIG1hdGNoZXMgPSB0aGlzLm1vZGVsLmNvbnRhY3RzLmZpbHRlcihjb250YWlucy5ub3QoJ2Z1bGxuYW1lJywgcSkpOwogICAgICAgICAgICAgICAgICAgIGlmIChtYXRjaGVzLmxlbmd0aCA9PT0gdGhpcy5tb2RlbC5jb250YWN0cy5sZW5ndGgpIHsgLy8gaGlkZSB0aGUgd2hvbGUgZ3JvdXAKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5oaWRlKCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgXy5lYWNoKG1hdGNoZXMsICQucHJveHkoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0KGl0ZW0uZ2V0KCdpZCcpKS4kZWwuaGlkZSgpOwogICAgICAgICAgICAgICAgICAgICAgICB9LCB0aGlzKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIF8uZWFjaCh0aGlzLm1vZGVsLmNvbnRhY3RzLnJlamVjdChjb250YWlucy5ub3QoJ2Z1bGxuYW1lJywgcSkpLCAkLnByb3h5KGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdldChpdGVtLmdldCgnaWQnKSkuJGVsLnNob3coKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSwgdGhpcykpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dJZkludmlzaWJsZSgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHNob3dJZkludmlzaWJsZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgaWYgKCF0aGlzLiRlbC5pcygnOnZpc2libGUnKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuJGVsLnNob3coKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHRvZ2dsZTogZnVuY3Rpb24gKGV2KSB7CiAgICAgICAgICAgICAgICBpZiAoZXYgJiYgZXYucHJldmVudERlZmF1bHQpIHsgZXYucHJldmVudERlZmF1bHQoKTsgfQogICAgICAgICAgICAgICAgdmFyICRlbCA9ICQoZXYudGFyZ2V0KTsKICAgICAgICAgICAgICAgIGlmICgkZWwuaGFzQ2xhc3MoImljb24tb3BlbmVkIikpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbC5uZXh0VW50aWwoJ2R0Jykuc2xpZGVVcCgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuc2F2ZSh7c3RhdGU6IENMT1NFRH0pOwogICAgICAgICAgICAgICAgICAgICRlbC5yZW1vdmVDbGFzcygiaWNvbi1vcGVuZWQiKS5hZGRDbGFzcygiaWNvbi1jbG9zZWQiKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJGVsLnJlbW92ZUNsYXNzKCJpY29uLWNsb3NlZCIpLmFkZENsYXNzKCJpY29uLW9wZW5lZCIpOwogICAgICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuc2F2ZSh7c3RhdGU6IE9QRU5FRH0pOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZmlsdGVyKAogICAgICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS5yb3N0ZXJ2aWV3LiQoJy5yb3N0ZXItZmlsdGVyJykudmFsKCksCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLnJvc3RlcnZpZXcuJCgnLmZpbHRlci10eXBlJykudmFsKCkKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgb25Db250YWN0R3JvdXBDaGFuZ2U6IGZ1bmN0aW9uIChjb250YWN0KSB7CiAgICAgICAgICAgICAgICB2YXIgaW5fdGhpc19ncm91cCA9IF8uY29udGFpbnMoY29udGFjdC5nZXQoJ2dyb3VwcycpLCB0aGlzLm1vZGVsLmdldCgnbmFtZScpKTsKICAgICAgICAgICAgICAgIHZhciBjaWQgPSBjb250YWN0LmdldCgnaWQnKTsKICAgICAgICAgICAgICAgIHZhciBpbl90aGlzX292ZXJ2aWV3ID0gIXRoaXMuZ2V0KGNpZCk7CiAgICAgICAgICAgICAgICBpZiAoaW5fdGhpc19ncm91cCAmJiAhaW5fdGhpc19vdmVydmlldykgewogICAgICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuY29udGFjdHMucmVtb3ZlKGNpZCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCFpbl90aGlzX2dyb3VwICYmIGluX3RoaXNfb3ZlcnZpZXcpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZENvbnRhY3QoY29udGFjdCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBvbkNvbnRhY3RTdWJzY3JpcHRpb25DaGFuZ2U6IGZ1bmN0aW9uIChjb250YWN0KSB7CiAgICAgICAgICAgICAgICBpZiAoKHRoaXMubW9kZWwuZ2V0KCduYW1lJykgPT09IEhFQURFUl9QRU5ESU5HX0NPTlRBQ1RTKSAmJiBjb250YWN0LmdldCgnc3Vic2NyaXB0aW9uJykgIT09ICdmcm9tJykgewogICAgICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuY29udGFjdHMucmVtb3ZlKGNvbnRhY3QuZ2V0KCdpZCcpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIG9uQ29udGFjdFJlcXVlc3RDaGFuZ2U6IGZ1bmN0aW9uIChjb250YWN0KSB7CiAgICAgICAgICAgICAgICBpZiAoKHRoaXMubW9kZWwuZ2V0KCduYW1lJykgPT09IEhFQURFUl9SRVFVRVNUSU5HX0NPTlRBQ1RTKSAmJiAhY29udGFjdC5nZXQoJ3JlcXVlc3RpbmcnKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuY29udGFjdHMucmVtb3ZlKGNvbnRhY3QuZ2V0KCdpZCcpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIG9uUmVtb3ZlOiBmdW5jdGlvbiAoY29udGFjdCkgewogICAgICAgICAgICAgICAgdGhpcy5yZW1vdmUoY29udGFjdC5nZXQoJ2lkJykpOwogICAgICAgICAgICAgICAgaWYgKHRoaXMubW9kZWwuY29udGFjdHMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kZWwuaGlkZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIHRoaXMuUm9zdGVyR3JvdXBzID0gQmFja2JvbmUuQ29sbGVjdGlvbi5leHRlbmQoewogICAgICAgICAgICBtb2RlbDogY29udmVyc2UuUm9zdGVyR3JvdXAsCiAgICAgICAgICAgIGNvbXBhcmF0b3I6IGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICAgICAgICAvKiBHcm91cHMgYXJlIHNvcnRlZCBhbHBoYWJldGljYWxseSwgaWdub3JpbmcgY2FzZS4KICAgICAgICAgICAgICAgICAqIEhvd2V2ZXIsIFVuZ3JvdXBlZCwgUmVxdWVzdGluZyBDb250YWN0cyBhbmQgUGVuZGluZyBDb250YWN0cwogICAgICAgICAgICAgICAgICogYXBwZWFyIGxhc3QgYW5kIGluIHRoYXQgb3JkZXIuICovCiAgICAgICAgICAgICAgICBhID0gYS5nZXQoJ25hbWUnKTsKICAgICAgICAgICAgICAgIGIgPSBiLmdldCgnbmFtZScpOwogICAgICAgICAgICAgICAgdmFyIHNwZWNpYWxfZ3JvdXBzID0gXy5rZXlzKEhFQURFUl9XRUlHSFRTKTsKICAgICAgICAgICAgICAgIHZhciBhX2lzX3NwZWNpYWwgPSBfLmNvbnRhaW5zKHNwZWNpYWxfZ3JvdXBzLCBhKTsKICAgICAgICAgICAgICAgIHZhciBiX2lzX3NwZWNpYWwgPSBfLmNvbnRhaW5zKHNwZWNpYWxfZ3JvdXBzLCBiKTsKICAgICAgICAgICAgICAgIGlmICghYV9pc19zcGVjaWFsICYmICFiX2lzX3NwZWNpYWwgKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEudG9Mb3dlckNhc2UoKSA8IGIudG9Mb3dlckNhc2UoKSA/IC0xIDogKGEudG9Mb3dlckNhc2UoKSA+IGIudG9Mb3dlckNhc2UoKSA/IDEgOiAwKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYV9pc19zcGVjaWFsICYmIGJfaXNfc3BlY2lhbCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBIRUFERVJfV0VJR0hUU1thXSA8IEhFQURFUl9XRUlHSFRTW2JdID8gLTEgOiAoSEVBREVSX1dFSUdIVFNbYV0gPiBIRUFERVJfV0VJR0hUU1tiXSA/IDEgOiAwKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIWFfaXNfc3BlY2lhbCAmJiBiX2lzX3NwZWNpYWwpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gKGIgPT09IEhFQURFUl9DVVJSRU5UX0NPTlRBQ1RTKSA/IDEgOiAtMTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYV9pc19zcGVjaWFsICYmICFiX2lzX3NwZWNpYWwpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gKGEgPT09IEhFQURFUl9DVVJSRU5UX0NPTlRBQ1RTKSA/IC0xIDogMTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICB0aGlzLlJvc3RlclZpZXcgPSBCYWNrYm9uZS5PdmVydmlldy5leHRlbmQoewogICAgICAgICAgICB0YWdOYW1lOiAnZGl2JywKICAgICAgICAgICAgaWQ6ICdjb252ZXJzZS1yb3N0ZXInLAogICAgICAgICAgICBldmVudHM6IHsKICAgICAgICAgICAgICAgICJrZXlkb3duIC5yb3N0ZXItZmlsdGVyIjogImxpdmVGaWx0ZXIiLAogICAgICAgICAgICAgICAgImNsaWNrIC5vblgiOiAiY2xlYXJGaWx0ZXIiLAogICAgICAgICAgICAgICAgIm1vdXNlbW92ZSAueCI6ICJ0b2dnbGVQb2ludGVyIiwKICAgICAgICAgICAgICAgICJjaGFuZ2UgLmZpbHRlci10eXBlIjogImNoYW5nZUZpbHRlclR5cGUiCiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB0aGlzLnJlZ2lzdGVyUm9zdGVySGFuZGxlcigpOwogICAgICAgICAgICAgICAgdGhpcy5yZWdpc3RlclJvc3RlclhIYW5kbGVyKCk7CiAgICAgICAgICAgICAgICB0aGlzLnJlZ2lzdGVyUHJlc2VuY2VIYW5kbGVyKCk7CiAgICAgICAgICAgICAgICBjb252ZXJzZS5yb3N0ZXIub24oImFkZCIsIHRoaXMub25Db250YWN0QWRkLCB0aGlzKTsKICAgICAgICAgICAgICAgIGNvbnZlcnNlLnJvc3Rlci5vbignY2hhbmdlJywgdGhpcy5vbkNvbnRhY3RDaGFuZ2UsIHRoaXMpOwogICAgICAgICAgICAgICAgY29udmVyc2Uucm9zdGVyLm9uKCJkZXN0cm95IiwgdGhpcy51cGRhdGUsIHRoaXMpOwogICAgICAgICAgICAgICAgY29udmVyc2Uucm9zdGVyLm9uKCJyZW1vdmUiLCB0aGlzLnVwZGF0ZSwgdGhpcyk7CiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLm9uKCJhZGQiLCB0aGlzLm9uR3JvdXBBZGQsIHRoaXMpOwogICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5vbigicmVzZXQiLCB0aGlzLnJlc2V0LCB0aGlzKTsKICAgICAgICAgICAgICAgIHRoaXMuJHJvc3RlciA9ICQoJzxkbCBjbGFzcz0icm9zdGVyLWNvbnRhY3RzIiBzdHlsZT0iZGlzcGxheTogbm9uZTsiPjwvZGw+Jyk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICB1cGRhdGU6IF8uZGVib3VuY2UoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyICRjb3VudCA9ICQoJyNvbmxpbmUtY291bnQnKTsKICAgICAgICAgICAgICAgICRjb3VudC50ZXh0KCcoJytjb252ZXJzZS5yb3N0ZXIuZ2V0TnVtT25saW5lQ29udGFjdHMoKSsnKScpOwogICAgICAgICAgICAgICAgaWYgKCEkY291bnQuaXMoJzp2aXNpYmxlJykpIHsKICAgICAgICAgICAgICAgICAgICAkY291bnQuc2hvdygpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHRoaXMuJHJvc3Rlci5wYXJlbnQoKS5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbC5hcHBlbmQodGhpcy4kcm9zdGVyLnNob3coKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zaG93SGlkZUZpbHRlcigpOwogICAgICAgICAgICB9LCBjb252ZXJzZS5hbmltYXRlID8gMTAwIDogMCksCgogICAgICAgICAgICByZW5kZXI6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHRoaXMuJGVsLmh0bWwoY29udmVyc2UudGVtcGxhdGVzLnJvc3Rlcih7CiAgICAgICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI6IF9fKCdUeXBlIHRvIGZpbHRlcicpLAogICAgICAgICAgICAgICAgICAgIGxhYmVsX2NvbnRhY3RzOiBMQUJFTF9DT05UQUNUUywKICAgICAgICAgICAgICAgICAgICBsYWJlbF9ncm91cHM6IExBQkVMX0dST1VQUwogICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBmZXRjaDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5mZXRjaCh7CiAgICAgICAgICAgICAgICAgICAgc2lsZW50OiB0cnVlLCAvLyBXZSB1c2UgdGhlIHN1Y2Nlc3MgaGFuZGxlciB0byBoYW5kbGUgZ3JvdXBzIHRoYXQgd2VyZSBhZGRlZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdlIG5lZWQgdG8gZmlyc3QgaGF2ZSBhbGwgZ3JvdXBzIGJlZm9yZSBwb3NpdGlvbkZldGNoZWRHcm91cHMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdpbGwgd29yayBwcm9wZXJseS4KICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiAkLnByb3h5KGZ1bmN0aW9uIChjb2xsZWN0aW9uLCByZXNwLCBvcHRpb25zKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb2xsZWN0aW9uLmxlbmd0aCAhPT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wb3NpdGlvbkZldGNoZWRHcm91cHMoY29sbGVjdGlvbiwgcmVzcCwgb3B0aW9ucyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgY29udmVyc2Uucm9zdGVyLmZldGNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChjb2xsZWN0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gWFhYOiBCaXQgb2YgYSBoYWNrLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHN0cm9waGUucm9zdGVyIGV4cGVjdHMgLmdldCB0byBiZSBjYWxsZWQgZm9yCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZXZlcnkgcGFnZSBsb2FkIHNvIHRoYXQgaXRzICJpdGVtcyIgYXR0cgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGdldHMgcG9wdWxhdGVkLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMgdmVyeSBpbmVmZmljaWVudCBmb3IgbGFyZ2Ugcm9zdGVycywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBhbmQgd2UgYWxyZWFkeSBoYXZlIHRoZSByb3N0ZXIgY2FjaGVkIGluCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2Vzc2lvblN0b3JhZ2UuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhlcmVmb3JlIHdlIG1hbnVhbGx5IHBvcHVsYXRlIHRoZSAiaXRlbXMiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYXR0ci4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBJZGVhbGx5IHdlIHNob3VsZCBldmVudHVhbGx5IHJlcGxhY2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBzdHJvcGhlLnJvc3RlciB3aXRoIHNvbWV0aGluZyBiZXR0ZXIuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbGxlY3Rpb24ubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xsZWN0aW9uLmVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLmNvbm5lY3Rpb24ucm9zdGVyLml0ZW1zLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUgICAgICAgICA6IGl0ZW0uZ2V0KCdmdWxsbmFtZScpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGppZCAgICAgICAgICA6IGl0ZW0uZ2V0KCdqaWQnKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb24gOiBpdGVtLmdldCgnc3Vic2NyaXB0aW9uJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXNrICAgICAgICAgIDogaXRlbS5nZXQoJ2FzaycpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VwcyAgICAgICA6IGl0ZW0uZ2V0KCdncm91cHMnKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZXMgICAgOiBpdGVtLmdldCgncmVzb3VyY2VzJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udmVyc2UuaW5pdGlhbF9wcmVzZW5jZV9zZW50ID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udmVyc2UueG1wcHN0YXR1cy5zZW5kUHJlc2VuY2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS5jb25uZWN0aW9uLnJvc3Rlci5nZXQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0sIHRoaXMpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgY2hhbmdlRmlsdGVyVHlwZTogZnVuY3Rpb24gKGV2KSB7CiAgICAgICAgICAgICAgICBpZiAoZXYgJiYgZXYucHJldmVudERlZmF1bHQpIHsgZXYucHJldmVudERlZmF1bHQoKTsgfQogICAgICAgICAgICAgICAgdGhpcy5jbGVhckZpbHRlcigpOwogICAgICAgICAgICAgICAgdGhpcy5maWx0ZXIoCiAgICAgICAgICAgICAgICAgICAgdGhpcy4kKCcucm9zdGVyLWZpbHRlcicpLnZhbCgpLAogICAgICAgICAgICAgICAgICAgIGV2LnRhcmdldC52YWx1ZQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHRvZzogZnVuY3Rpb24gKHYpIHsKICAgICAgICAgICAgICAgIHJldHVybiB2PydhZGRDbGFzcyc6J3JlbW92ZUNsYXNzJzsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHRvZ2dsZVBvaW50ZXI6IGZ1bmN0aW9uIChldikgewogICAgICAgICAgICAgICAgaWYgKGV2ICYmIGV2LnByZXZlbnREZWZhdWx0KSB7IGV2LnByZXZlbnREZWZhdWx0KCk7IH0KICAgICAgICAgICAgICAgIHZhciBlbCA9IGV2LnRhcmdldDsKICAgICAgICAgICAgICAgICQoZWwpW3RoaXMudG9nKGVsLm9mZnNldFdpZHRoLTE4IDwgZXYuY2xpZW50WC1lbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5sZWZ0KV0oJ29uWCcpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgZmlsdGVyOiBmdW5jdGlvbiAocXVlcnksIHR5cGUpIHsKICAgICAgICAgICAgICAgIHZhciBtYXRjaGVzOwogICAgICAgICAgICAgICAgcXVlcnkgPSBxdWVyeS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgaWYgKHR5cGUgPT09ICdncm91cHMnKSB7CiAgICAgICAgICAgICAgICAgICAgXy5lYWNoKHRoaXMuZ2V0QWxsKCksIGZ1bmN0aW9uICh2aWV3LCBpZHgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZpZXcubW9kZWwuZ2V0KCduYW1lJykudG9Mb3dlckNhc2UoKS5pbmRleE9mKHF1ZXJ5LnRvTG93ZXJDYXNlKCkpID09PSAtMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlldy5oaWRlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodmlldy5tb2RlbC5jb250YWN0cy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aWV3LnNob3coKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBfLmVhY2godGhpcy5nZXRBbGwoKSwgZnVuY3Rpb24gKHZpZXcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmlldy5maWx0ZXIocXVlcnksIHR5cGUpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgbGl2ZUZpbHRlcjogXy5kZWJvdW5jZShmdW5jdGlvbiAoZXYpIHsKICAgICAgICAgICAgICAgIGlmIChldiAmJiBldi5wcmV2ZW50RGVmYXVsdCkgeyBldi5wcmV2ZW50RGVmYXVsdCgpOyB9CiAgICAgICAgICAgICAgICB2YXIgcSA9IGV2LnRhcmdldC52YWx1ZTsKICAgICAgICAgICAgICAgIHZhciB0ID0gdGhpcy4kKCcuZmlsdGVyLXR5cGUnKS52YWwoKTsKICAgICAgICAgICAgICAgICQoZXYudGFyZ2V0KVt0aGlzLnRvZyhxKV0oJ3gnKTsKICAgICAgICAgICAgICAgIHRoaXMuZmlsdGVyKHEsIHQpOwogICAgICAgICAgICB9LCAzMDApLAoKICAgICAgICAgICAgY2xlYXJGaWx0ZXI6IGZ1bmN0aW9uIChldikgewogICAgICAgICAgICAgICAgaWYgKGV2ICYmIGV2LnByZXZlbnREZWZhdWx0KSB7CiAgICAgICAgICAgICAgICAgICAgZXYucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgICAgICAkKGV2LnRhcmdldCkucmVtb3ZlQ2xhc3MoJ3ggb25YJykudmFsKCcnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuZmlsdGVyKCcnKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHNob3dIaWRlRmlsdGVyOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuJGVsLmlzKCc6dmlzaWJsZScpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdmFyICRmaWx0ZXIgPSB0aGlzLiQoJy5yb3N0ZXItZmlsdGVyJyk7CiAgICAgICAgICAgICAgICB2YXIgJHR5cGUgID0gdGhpcy4kKCcuZmlsdGVyLXR5cGUnKTsKICAgICAgICAgICAgICAgIHZhciB2aXNpYmxlID0gJGZpbHRlci5pcygnOnZpc2libGUnKTsKICAgICAgICAgICAgICAgIGlmICh2aXNpYmxlICYmICRmaWx0ZXIudmFsKCkubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIC8vIERvbid0IGhpZGUgaWYgdXNlciBpcyBjdXJyZW50bHkgZmlsdGVyaW5nLgogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh0aGlzLiRyb3N0ZXIuaGFzU2Nyb2xsQmFyKCkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIXZpc2libGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGZpbHRlci5zaG93KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICR0eXBlLnNob3coKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICRmaWx0ZXIuaGlkZSgpOwogICAgICAgICAgICAgICAgICAgICR0eXBlLmhpZGUoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgcmVzZXQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGNvbnZlcnNlLnJvc3Rlci5yZXNldCgpOwogICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVBbGwoKTsKICAgICAgICAgICAgICAgIHRoaXMuJHJvc3RlciA9ICQoJzxkbCBjbGFzcz0icm9zdGVyLWNvbnRhY3RzIiBzdHlsZT0iZGlzcGxheTogbm9uZTsiPjwvZGw+Jyk7CiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcigpLnVwZGF0ZSgpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICByZWdpc3RlclJvc3RlckhhbmRsZXI6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIC8vIFJlZ2lzdGVyIGhhbmRsZXJzIHRoYXQgZGVwZW5kIG9uIHRoZSByb3N0ZXIKICAgICAgICAgICAgICAgIGNvbnZlcnNlLmNvbm5lY3Rpb24ucm9zdGVyLnJlZ2lzdGVyQ2FsbGJhY2soCiAgICAgICAgICAgICAgICAgICAgJC5wcm94eShjb252ZXJzZS5yb3N0ZXIucm9zdGVySGFuZGxlciwgY29udmVyc2Uucm9zdGVyKQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHJlZ2lzdGVyUm9zdGVyWEhhbmRsZXI6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciB0ID0gMDsKICAgICAgICAgICAgICAgIGNvbnZlcnNlLmNvbm5lY3Rpb24uYWRkSGFuZGxlcigKICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAobXNnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLmNvbm5lY3Rpb24uZmx1c2goKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLnByb3h5KGNvbnZlcnNlLnJvc3Rlci5zdWJzY3JpYmVUb1N1Z2dlc3RlZEl0ZW1zLCBjb252ZXJzZS5yb3N0ZXIpKG1zZyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdAogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICB0ICs9ICQobXNnKS5maW5kKCdpdGVtJykubGVuZ3RoKjI1MDsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAnaHR0cDovL2phYmJlci5vcmcvcHJvdG9jb2wvcm9zdGVyeCcsICdtZXNzYWdlJywgbnVsbCk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICByZWdpc3RlclByZXNlbmNlSGFuZGxlcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgY29udmVyc2UuY29ubmVjdGlvbi5hZGRIYW5kbGVyKAogICAgICAgICAgICAgICAgICAgICQucHJveHkoZnVuY3Rpb24gKHByZXNlbmNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLnJvc3Rlci5wcmVzZW5jZUhhbmRsZXIocHJlc2VuY2UpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB9LCB0aGlzKSwgbnVsbCwgJ3ByZXNlbmNlJywgbnVsbCk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBvbkdyb3VwQWRkOiBmdW5jdGlvbiAoZ3JvdXApIHsKICAgICAgICAgICAgICAgIHZhciB2aWV3ID0gbmV3IGNvbnZlcnNlLlJvc3Rlckdyb3VwVmlldyh7bW9kZWw6IGdyb3VwfSk7CiAgICAgICAgICAgICAgICB0aGlzLmFkZChncm91cC5nZXQoJ25hbWUnKSwgdmlldy5yZW5kZXIoKSk7CiAgICAgICAgICAgICAgICB0aGlzLnBvc2l0aW9uR3JvdXAodmlldyk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBvbkNvbnRhY3RBZGQ6IGZ1bmN0aW9uIChjb250YWN0KSB7CiAgICAgICAgICAgICAgICB0aGlzLmFkZFJvc3RlckNvbnRhY3QoY29udGFjdCkudXBkYXRlKCk7CiAgICAgICAgICAgICAgICBpZiAoIWNvbnRhY3QuZ2V0KCd2Y2FyZF91cGRhdGVkJykpIHsKICAgICAgICAgICAgICAgICAgICAvLyBUaGlzIHdpbGwgdXBkYXRlIHRoZSB2Y2FyZCwgd2hpY2ggdHJpZ2dlcnMgYSBjaGFuZ2UKICAgICAgICAgICAgICAgICAgICAvLyByZXF1ZXN0IHdoaWNoIHdpbGwgcmVyZW5kZXIgdGhlIHJvc3RlciBjb250YWN0LgogICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLmdldFZDYXJkKGNvbnRhY3QuZ2V0KCdqaWQnKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBvbkNvbnRhY3RDaGFuZ2U6IGZ1bmN0aW9uIChjb250YWN0KSB7CiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUNoYXRCb3goY29udGFjdCkudXBkYXRlKCk7CiAgICAgICAgICAgICAgICBpZiAoXy5oYXMoY29udGFjdC5jaGFuZ2VkLCAnc3Vic2NyaXB0aW9uJykpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoY29udGFjdC5jaGFuZ2VkLnN1YnNjcmlwdGlvbiA9PSAnZnJvbScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGRDb250YWN0VG9Hcm91cChjb250YWN0LCBIRUFERVJfUEVORElOR19DT05UQUNUUyk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjb250YWN0LmdldCgnc3Vic2NyaXB0aW9uJykgPT09ICdib3RoJykgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZEV4aXN0aW5nQ29udGFjdChjb250YWN0KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoXy5oYXMoY29udGFjdC5jaGFuZ2VkLCAnYXNrJykgJiYgY29udGFjdC5jaGFuZ2VkLmFzayA9PSAnc3Vic2NyaWJlJykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkQ29udGFjdFRvR3JvdXAoY29udGFjdCwgSEVBREVSX1BFTkRJTkdfQ09OVEFDVFMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKF8uaGFzKGNvbnRhY3QuY2hhbmdlZCwgJ3N1YnNjcmlwdGlvbicpICYmIGNvbnRhY3QuY2hhbmdlZC5yZXF1ZXN0aW5nID09ICd0cnVlJykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkQ29udGFjdFRvR3JvdXAoY29udGFjdCwgSEVBREVSX1JFUVVFU1RJTkdfQ09OVEFDVFMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgdXBkYXRlQ2hhdEJveDogZnVuY3Rpb24gKGNvbnRhY3QpIHsKICAgICAgICAgICAgICAgIHZhciBjaGF0Ym94ID0gY29udmVyc2UuY2hhdGJveGVzLmdldChjb250YWN0LmdldCgnamlkJykpLAogICAgICAgICAgICAgICAgICAgIGNoYW5nZXMgPSB7fTsKICAgICAgICAgICAgICAgIGlmICghY2hhdGJveCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKF8uaGFzKGNvbnRhY3QuY2hhbmdlZCwgJ2NoYXRfc3RhdHVzJykpIHsKICAgICAgICAgICAgICAgICAgICBjaGFuZ2VzLmNoYXRfc3RhdHVzID0gY29udGFjdC5nZXQoJ2NoYXRfc3RhdHVzJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoXy5oYXMoY29udGFjdC5jaGFuZ2VkLCAnc3RhdHVzJykpIHsKICAgICAgICAgICAgICAgICAgICBjaGFuZ2VzLnN0YXR1cyA9IGNvbnRhY3QuZ2V0KCdzdGF0dXMnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNoYXRib3guc2F2ZShjaGFuZ2VzKTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgcG9zaXRpb25GZXRjaGVkR3JvdXBzOiBmdW5jdGlvbiAobW9kZWwsIHJlc3AsIG9wdGlvbnMpIHsKICAgICAgICAgICAgICAgIC8qIEluc3RlYWQgb2YgdGhyb3dpbmcgYW4gYWRkIGV2ZW50IGZvciBlYWNoIGdyb3VwCiAgICAgICAgICAgICAgICAgICAgKiBmZXRjaGVkLCB3ZSB3YWl0IHVudGlsIHRoZXkncmUgYWxsIGZldGNoZWQgYW5kIHRoZW4KICAgICAgICAgICAgICAgICAgICAqIHdlIHBvc2l0aW9uIHRoZW0uCiAgICAgICAgICAgICAgICAgICAgKiBXb3JrcyBhcm91bmQgdGhlIHByb2JsZW0gb2YgcG9zaXRpb25Hcm91cCBub3QKICAgICAgICAgICAgICAgICAgICAqIHdvcmtpbmcgd2hlbiBhbGwgZ3JvdXBzIGJlc2lkZXMgdGhlIG9uZSBiZWluZwogICAgICAgICAgICAgICAgICAgICogcG9zaXRpb25lZCBhcmVuJ3QgYWxyZWFkeSBpbiBpbnNlcnRlZCBpbnRvIHRoZQogICAgICAgICAgICAgICAgICAgICogcm9zdGVyIERPTSBlbGVtZW50LgogICAgICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICBtb2RlbC5zb3J0KCk7CiAgICAgICAgICAgICAgICBtb2RlbC5lYWNoKCQucHJveHkoZnVuY3Rpb24gKGdyb3VwLCBpZHgpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgdmlldyA9IHRoaXMuZ2V0KGdyb3VwLmdldCgnbmFtZScpKTsKICAgICAgICAgICAgICAgICAgICBpZiAoIXZpZXcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmlldyA9IG5ldyBjb252ZXJzZS5Sb3N0ZXJHcm91cFZpZXcoe21vZGVsOiBncm91cH0pOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZChncm91cC5nZXQoJ25hbWUnKSwgdmlldy5yZW5kZXIoKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChpZHggPT09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kcm9zdGVyLmFwcGVuZCh2aWV3LiRlbCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hcHBlbmRHcm91cCh2aWV3KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCB0aGlzKSk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBwb3NpdGlvbkdyb3VwOiBmdW5jdGlvbiAodmlldykgewogICAgICAgICAgICAgICAgLyogUGxhY2UgdGhlIGdyb3VwJ3MgRE9NIGVsZW1lbnQgaW4gdGhlIGNvcnJlY3QgYWxwaGFiZXRpY2FsCiAgICAgICAgICAgICAgICAgKiBwb3NpdGlvbiBhbW9uZ3N0IHRoZSBvdGhlciBncm91cHMgaW4gdGhlIHJvc3Rlci4KICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgdmFyICRncm91cHMgPSB0aGlzLiRyb3N0ZXIuZmluZCgnLnJvc3Rlci1ncm91cCcpLAogICAgICAgICAgICAgICAgICAgIGluZGV4ID0gJGdyb3Vwcy5sZW5ndGggPyB0aGlzLm1vZGVsLmluZGV4T2Yodmlldy5tb2RlbCkgOiAwOwogICAgICAgICAgICAgICAgaWYgKGluZGV4ID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kcm9zdGVyLnByZXBlbmQodmlldy4kZWwpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpbmRleCA9PSAodGhpcy5tb2RlbC5sZW5ndGgtMSkpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmFwcGVuZEdyb3VwKHZpZXcpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkKCRncm91cHMuZXEoaW5kZXgpKS5iZWZvcmUodmlldy4kZWwpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBhcHBlbmRHcm91cDogZnVuY3Rpb24gKHZpZXcpIHsKICAgICAgICAgICAgICAgIC8qIEFkZCB0aGUgZ3JvdXAgYXQgdGhlIGJvdHRvbSBvZiB0aGUgcm9zdGVyCiAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgIHZhciAkbGFzdCA9IHRoaXMuJHJvc3Rlci5maW5kKCcucm9zdGVyLWdyb3VwJykubGFzdCgpOwogICAgICAgICAgICAgICAgdmFyICRzaWJsaW5ncyA9ICRsYXN0LnNpYmxpbmdzKCdkZCcpOwogICAgICAgICAgICAgICAgaWYgKCRzaWJsaW5ncy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgJHNpYmxpbmdzLmxhc3QoKS5hZnRlcih2aWV3LiRlbCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICRsYXN0LmFmdGVyKHZpZXcuJGVsKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgZ2V0R3JvdXA6IGZ1bmN0aW9uIChuYW1lKSB7CiAgICAgICAgICAgICAgICAvKiBSZXR1cm5zIHRoZSBncm91cCBhcyBzcGVjaWZpZWQgYnkgbmFtZS4KICAgICAgICAgICAgICAgICAqIENyZWF0ZXMgdGhlIGdyb3VwIGlmIGl0IGRvZXNuJ3QgZXhpc3QuCiAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgIHZhciB2aWV3ID0gIHRoaXMuZ2V0KG5hbWUpOwogICAgICAgICAgICAgICAgaWYgKHZpZXcpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmlldy5tb2RlbDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm1vZGVsLmNyZWF0ZSh7bmFtZTogbmFtZSwgaWQ6IGI2NF9zaGExKG5hbWUpfSk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBhZGRDb250YWN0VG9Hcm91cDogZnVuY3Rpb24gKGNvbnRhY3QsIG5hbWUpIHsKICAgICAgICAgICAgICAgIHRoaXMuZ2V0R3JvdXAobmFtZSkuY29udGFjdHMuYWRkKGNvbnRhY3QpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgYWRkRXhpc3RpbmdDb250YWN0OiBmdW5jdGlvbiAoY29udGFjdCkgewogICAgICAgICAgICAgICAgdmFyIGdyb3VwczsKICAgICAgICAgICAgICAgIGlmIChjb252ZXJzZS5yb3N0ZXJfZ3JvdXBzKSB7CiAgICAgICAgICAgICAgICAgICAgZ3JvdXBzID0gY29udGFjdC5nZXQoJ2dyb3VwcycpOwogICAgICAgICAgICAgICAgICAgIGlmIChncm91cHMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VwcyA9IFtIRUFERVJfVU5HUk9VUEVEXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGdyb3VwcyA9IFtIRUFERVJfQ1VSUkVOVF9DT05UQUNUU107CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBfLmVhY2goZ3JvdXBzLCAkLnByb3h5KGZ1bmN0aW9uIChuYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGRDb250YWN0VG9Hcm91cChjb250YWN0LCBuYW1lKTsKICAgICAgICAgICAgICAgIH0sIHRoaXMpKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGFkZFJvc3RlckNvbnRhY3Q6IGZ1bmN0aW9uIChjb250YWN0KSB7CiAgICAgICAgICAgICAgICBpZiAoY29udGFjdC5nZXQoJ3N1YnNjcmlwdGlvbicpID09PSAnYm90aCcgfHwgY29udGFjdC5nZXQoJ3N1YnNjcmlwdGlvbicpID09PSAndG8nKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGRFeGlzdGluZ0NvbnRhY3QoY29udGFjdCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmICgoY29udGFjdC5nZXQoJ2FzaycpID09PSAnc3Vic2NyaWJlJykgfHwgKGNvbnRhY3QuZ2V0KCdzdWJzY3JpcHRpb24nKSA9PT0gJ2Zyb20nKSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZENvbnRhY3RUb0dyb3VwKGNvbnRhY3QsIEhFQURFUl9QRU5ESU5HX0NPTlRBQ1RTKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNvbnRhY3QuZ2V0KCdyZXF1ZXN0aW5nJykgPT09IHRydWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGRDb250YWN0VG9Hcm91cChjb250YWN0LCBIRUFERVJfUkVRVUVTVElOR19DT05UQUNUUyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgdGhpcy5YTVBQU3RhdHVzID0gQmFja2JvbmUuTW9kZWwuZXh0ZW5kKHsKICAgICAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdGhpcy5zZXQoewogICAgICAgICAgICAgICAgICAgICdzdGF0dXMnIDogdGhpcy5nZXQoJ3N0YXR1cycpIHx8ICdvbmxpbmUnCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHRoaXMub24oJ2NoYW5nZScsICQucHJveHkoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5nZXQoJ2Z1bGxuYW1lJykgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS5nZXRWQ2FyZCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bGwsIC8vIE5vICd0bycgYXR0ciB3aGVuIGdldHRpbmcgb25lJ3Mgb3duIHZDYXJkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLnByb3h5KGZ1bmN0aW9uIChqaWQsIGZ1bGxuYW1lLCBpbWFnZSwgaW1hZ2VfdHlwZSwgdXJsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zYXZlKHsnZnVsbG5hbWUnOiBmdWxsbmFtZX0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgdGhpcykKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKF8uaGFzKGl0ZW0uY2hhbmdlZCwgJ3N0YXR1cycpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLmVtaXQoJ3N0YXR1c0NoYW5nZWQnLCB0aGlzLmdldCgnc3RhdHVzJykpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoXy5oYXMoaXRlbS5jaGFuZ2VkLCAnc3RhdHVzX21lc3NhZ2UnKSkgewogICAgICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS5lbWl0KCdzdGF0dXNNZXNzYWdlQ2hhbmdlZCcsIHRoaXMuZ2V0KCdzdGF0dXNfbWVzc2FnZScpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCB0aGlzKSk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBzZW5kUHJlc2VuY2U6IGZ1bmN0aW9uICh0eXBlKSB7CiAgICAgICAgICAgICAgICBpZiAodHlwZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgdHlwZSA9IHRoaXMuZ2V0KCdzdGF0dXMnKSB8fCAnb25saW5lJzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHZhciBzdGF0dXNfbWVzc2FnZSA9IHRoaXMuZ2V0KCdzdGF0dXNfbWVzc2FnZScpLAogICAgICAgICAgICAgICAgICAgIHByZXNlbmNlOwogICAgICAgICAgICAgICAgLy8gTW9zdCBvZiB0aGVzZSBwcmVzZW5jZSB0eXBlcyBhcmUgYWN0dWFsbHkgbm90IGV4cGxpY2l0bHkgc2VudCwKICAgICAgICAgICAgICAgIC8vIGJ1dCBJIGFkZCBhbGwgb2YgdGhlbSBoZXJlIGZvcmUgcmVmZXJlbmNlIGFuZCBmdXR1cmUgcHJvb2ZpbmcuCiAgICAgICAgICAgICAgICBpZiAoKHR5cGUgPT09ICd1bmF2YWlsYWJsZScpIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICh0eXBlID09PSAncHJvYmUnKSB8fAogICAgICAgICAgICAgICAgICAgICAgICAodHlwZSA9PT0gJ2Vycm9yJykgfHwKICAgICAgICAgICAgICAgICAgICAgICAgKHR5cGUgPT09ICd1bnN1YnNjcmliZScpIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICh0eXBlID09PSAndW5zdWJzY3JpYmVkJykgfHwKICAgICAgICAgICAgICAgICAgICAgICAgKHR5cGUgPT09ICdzdWJzY3JpYmUnKSB8fAogICAgICAgICAgICAgICAgICAgICAgICAodHlwZSA9PT0gJ3N1YnNjcmliZWQnKSkgewogICAgICAgICAgICAgICAgICAgIHByZXNlbmNlID0gJHByZXMoeyd0eXBlJzp0eXBlfSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlID09PSAnb25saW5lJykgewogICAgICAgICAgICAgICAgICAgICAgICBwcmVzZW5jZSA9ICRwcmVzKCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgcHJlc2VuY2UgPSAkcHJlcygpLmMoJ3Nob3cnKS50KHR5cGUpLnVwKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChzdGF0dXNfbWVzc2FnZSkgewogICAgICAgICAgICAgICAgICAgICAgICBwcmVzZW5jZS5jKCdzdGF0dXMnKS50KHN0YXR1c19tZXNzYWdlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb252ZXJzZS5jb25uZWN0aW9uLnNlbmQocHJlc2VuY2UpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgc2V0U3RhdHVzOiBmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgICAgICAgICAgIHRoaXMuc2VuZFByZXNlbmNlKHZhbHVlKTsKICAgICAgICAgICAgICAgIHRoaXMuc2F2ZSh7J3N0YXR1cyc6IHZhbHVlfSk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBzZXRTdGF0dXNNZXNzYWdlOiBmdW5jdGlvbiAoc3RhdHVzX21lc3NhZ2UpIHsKICAgICAgICAgICAgICAgIGNvbnZlcnNlLmNvbm5lY3Rpb24uc2VuZCgkcHJlcygpLmMoJ3Nob3cnKS50KHRoaXMuZ2V0KCdzdGF0dXMnKSkudXAoKS5jKCdzdGF0dXMnKS50KHN0YXR1c19tZXNzYWdlKSk7CiAgICAgICAgICAgICAgICB0aGlzLnNhdmUoeydzdGF0dXNfbWVzc2FnZSc6IHN0YXR1c19tZXNzYWdlfSk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy54aHJfY3VzdG9tX3N0YXR1cykgewogICAgICAgICAgICAgICAgICAgICQuYWpheCh7CiAgICAgICAgICAgICAgICAgICAgICAgIHVybDogIHRoaXMueGhyX2N1c3RvbV9zdGF0dXNfdXJsLAogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnUE9TVCcsCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHsnbXNnJzogc3RhdHVzX21lc3NhZ2V9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgdGhpcy5YTVBQU3RhdHVzVmlldyA9IEJhY2tib25lLlZpZXcuZXh0ZW5kKHsKICAgICAgICAgICAgZWw6ICJzcGFuI3htcHAtc3RhdHVzLWhvbGRlciIsCgogICAgICAgICAgICBldmVudHM6IHsKICAgICAgICAgICAgICAgICJjbGljayBhLmNob29zZS14bXBwLXN0YXR1cyI6ICJ0b2dnbGVPcHRpb25zIiwKICAgICAgICAgICAgICAgICJjbGljayAjZmFuY3kteG1wcC1zdGF0dXMtc2VsZWN0IGEuY2hhbmdlLXhtcHAtc3RhdHVzLW1lc3NhZ2UiOiAicmVuZGVyU3RhdHVzQ2hhbmdlRm9ybSIsCiAgICAgICAgICAgICAgICAic3VibWl0ICNzZXQtY3VzdG9tLXhtcHAtc3RhdHVzIjogInNldFN0YXR1c01lc3NhZ2UiLAogICAgICAgICAgICAgICAgImNsaWNrIC5kcm9wZG93biBkZCB1bCBsaSBhIjogInNldFN0YXR1cyIKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHRoaXMubW9kZWwub24oImNoYW5nZSIsIHRoaXMudXBkYXRlU3RhdHVzVUksIHRoaXMpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICByZW5kZXI6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIC8vIFJlcGxhY2UgdGhlIGRlZmF1bHQgZHJvcGRvd24gd2l0aCBzb21ldGhpbmcgbmljZXIKICAgICAgICAgICAgICAgIHZhciAkc2VsZWN0ID0gdGhpcy4kZWwuZmluZCgnc2VsZWN0I3NlbGVjdC14bXBwLXN0YXR1cycpLAogICAgICAgICAgICAgICAgICAgIGNoYXRfc3RhdHVzID0gdGhpcy5tb2RlbC5nZXQoJ3N0YXR1cycpIHx8ICdvZmZsaW5lJywKICAgICAgICAgICAgICAgICAgICBvcHRpb25zID0gJCgnb3B0aW9uJywgJHNlbGVjdCksCiAgICAgICAgICAgICAgICAgICAgJG9wdGlvbnNfdGFyZ2V0LAogICAgICAgICAgICAgICAgICAgIG9wdGlvbnNfbGlzdCA9IFtdLAogICAgICAgICAgICAgICAgICAgIHRoYXQgPSB0aGlzOwogICAgICAgICAgICAgICAgdGhpcy4kZWwuaHRtbChjb252ZXJzZS50ZW1wbGF0ZXMuY2hvb3NlX3N0YXR1cygpKTsKICAgICAgICAgICAgICAgIHRoaXMuJGVsLmZpbmQoJyNmYW5jeS14bXBwLXN0YXR1cy1zZWxlY3QnKQogICAgICAgICAgICAgICAgICAgICAgICAuaHRtbChjb252ZXJzZS50ZW1wbGF0ZXMuY2hhdF9zdGF0dXMoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3N0YXR1c19tZXNzYWdlJzogdGhpcy5tb2RlbC5nZXQoJ3N0YXR1c19tZXNzYWdlJykgfHwgX18oIkkgYW0gJTEkcyIsIHRoaXMuZ2V0UHJldHR5U3RhdHVzKGNoYXRfc3RhdHVzKSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY2hhdF9zdGF0dXMnOiBjaGF0X3N0YXR1cywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkZXNjX2N1c3RvbV9zdGF0dXMnOiBfXygnQ2xpY2sgaGVyZSB0byB3cml0ZSBhIGN1c3RvbSBzdGF0dXMgbWVzc2FnZScpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Rlc2NfY2hhbmdlX3N0YXR1cyc6IF9fKCdDbGljayB0byBjaGFuZ2UgeW91ciBjaGF0IHN0YXR1cycpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgICAvLyBpdGVyYXRlIHRocm91Z2ggYWxsIHRoZSA8b3B0aW9uPiBlbGVtZW50cyBhbmQgYWRkIG9wdGlvbiB2YWx1ZXMKICAgICAgICAgICAgICAgIG9wdGlvbnMuZWFjaChmdW5jdGlvbiAoKXsKICAgICAgICAgICAgICAgICAgICBvcHRpb25zX2xpc3QucHVzaChjb252ZXJzZS50ZW1wbGF0ZXMuc3RhdHVzX29wdGlvbih7CiAgICAgICAgICAgICAgICAgICAgICAgICd2YWx1ZSc6ICQodGhpcykudmFsKCksCiAgICAgICAgICAgICAgICAgICAgICAgICd0ZXh0JzogdGhpcy50ZXh0CiAgICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAkb3B0aW9uc190YXJnZXQgPSB0aGlzLiRlbC5maW5kKCIjdGFyZ2V0IGRkIHVsIikuaGlkZSgpOwogICAgICAgICAgICAgICAgJG9wdGlvbnNfdGFyZ2V0LmFwcGVuZChvcHRpb25zX2xpc3Quam9pbignJykpOwogICAgICAgICAgICAgICAgJHNlbGVjdC5yZW1vdmUoKTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgdG9nZ2xlT3B0aW9uczogZnVuY3Rpb24gKGV2KSB7CiAgICAgICAgICAgICAgICBldi5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgJChldi50YXJnZXQpLnBhcmVudCgpLnBhcmVudCgpLnNpYmxpbmdzKCdkZCcpLmZpbmQoJ3VsJykudG9nZ2xlKCdmYXN0Jyk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICByZW5kZXJTdGF0dXNDaGFuZ2VGb3JtOiBmdW5jdGlvbiAoZXYpIHsKICAgICAgICAgICAgICAgIGV2LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICB2YXIgc3RhdHVzX21lc3NhZ2UgPSB0aGlzLm1vZGVsLmdldCgnc3RhdHVzJykgfHwgJ29mZmxpbmUnOwogICAgICAgICAgICAgICAgdmFyIGlucHV0ID0gY29udmVyc2UudGVtcGxhdGVzLmNoYW5nZV9zdGF0dXNfbWVzc2FnZSh7CiAgICAgICAgICAgICAgICAgICAgJ3N0YXR1c19tZXNzYWdlJzogc3RhdHVzX21lc3NhZ2UsCiAgICAgICAgICAgICAgICAgICAgJ2xhYmVsX2N1c3RvbV9zdGF0dXMnOiBfXygnQ3VzdG9tIHN0YXR1cycpLAogICAgICAgICAgICAgICAgICAgICdsYWJlbF9zYXZlJzogX18oJ1NhdmUnKQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB0aGlzLiRlbC5maW5kKCcueG1wcC1zdGF0dXMnKS5yZXBsYWNlV2l0aChpbnB1dCk7CiAgICAgICAgICAgICAgICB0aGlzLiRlbC5maW5kKCcuY3VzdG9tLXhtcHAtc3RhdHVzJykuZm9jdXMoKS5mb2N1cygpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgc2V0U3RhdHVzTWVzc2FnZTogZnVuY3Rpb24gKGV2KSB7CiAgICAgICAgICAgICAgICBldi5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgdmFyIHN0YXR1c19tZXNzYWdlID0gJChldi50YXJnZXQpLmZpbmQoJ2lucHV0JykudmFsKCk7CiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLnNldFN0YXR1c01lc3NhZ2Uoc3RhdHVzX21lc3NhZ2UpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgc2V0U3RhdHVzOiBmdW5jdGlvbiAoZXYpIHsKICAgICAgICAgICAgICAgIGV2LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICB2YXIgJGVsID0gJChldi50YXJnZXQpLAogICAgICAgICAgICAgICAgICAgIHZhbHVlID0gJGVsLmF0dHIoJ2RhdGEtdmFsdWUnKTsKICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gJ2xvZ291dCcpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbC5maW5kKCIuZHJvcGRvd24gZGQgdWwiKS5oaWRlKCk7CiAgICAgICAgICAgICAgICAgICAgY29udmVyc2UubG9nT3V0KCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuc2V0U3RhdHVzKHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbC5maW5kKCIuZHJvcGRvd24gZGQgdWwiKS5oaWRlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBnZXRQcmV0dHlTdGF0dXM6IGZ1bmN0aW9uIChzdGF0KSB7CiAgICAgICAgICAgICAgICB2YXIgcHJldHR5X3N0YXR1czsKICAgICAgICAgICAgICAgIGlmIChzdGF0ID09PSAnY2hhdCcpIHsKICAgICAgICAgICAgICAgICAgICBwcmV0dHlfc3RhdHVzID0gX18oJ29ubGluZScpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzdGF0ID09PSAnZG5kJykgewogICAgICAgICAgICAgICAgICAgIHByZXR0eV9zdGF0dXMgPSBfXygnYnVzeScpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzdGF0ID09PSAneGEnKSB7CiAgICAgICAgICAgICAgICAgICAgcHJldHR5X3N0YXR1cyA9IF9fKCdhd2F5IGZvciBsb25nJyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHN0YXQgPT09ICdhd2F5JykgewogICAgICAgICAgICAgICAgICAgIHByZXR0eV9zdGF0dXMgPSBfXygnYXdheScpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBwcmV0dHlfc3RhdHVzID0gX18oc3RhdCkgfHwgX18oJ29ubGluZScpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHByZXR0eV9zdGF0dXM7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICB1cGRhdGVTdGF0dXNVSTogZnVuY3Rpb24gKG1vZGVsKSB7CiAgICAgICAgICAgICAgICBpZiAoIShfLmhhcyhtb2RlbC5jaGFuZ2VkLCAnc3RhdHVzJykpICYmICEoXy5oYXMobW9kZWwuY2hhbmdlZCwgJ3N0YXR1c19tZXNzYWdlJykpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdmFyIHN0YXQgPSBtb2RlbC5nZXQoJ3N0YXR1cycpOwogICAgICAgICAgICAgICAgLy8gIyBGb3IgdHJhbnNsYXRvcnM6IHRoZSAlMSRzIHBhcnQgZ2V0cyByZXBsYWNlZCB3aXRoIHRoZSBzdGF0dXMKICAgICAgICAgICAgICAgIC8vICMgRXhhbXBsZSwgSSBhbSBvbmxpbmUKICAgICAgICAgICAgICAgIHZhciBzdGF0dXNfbWVzc2FnZSA9IG1vZGVsLmdldCgnc3RhdHVzX21lc3NhZ2UnKSB8fCBfXygiSSBhbSAlMSRzIiwgdGhpcy5nZXRQcmV0dHlTdGF0dXMoc3RhdCkpOwogICAgICAgICAgICAgICAgdGhpcy4kZWwuZmluZCgnI2ZhbmN5LXhtcHAtc3RhdHVzLXNlbGVjdCcpLmh0bWwoCiAgICAgICAgICAgICAgICAgICAgY29udmVyc2UudGVtcGxhdGVzLmNoYXRfc3RhdHVzKHsKICAgICAgICAgICAgICAgICAgICAgICAgJ2NoYXRfc3RhdHVzJzogc3RhdCwKICAgICAgICAgICAgICAgICAgICAgICAgJ3N0YXR1c19tZXNzYWdlJzogc3RhdHVzX21lc3NhZ2UsCiAgICAgICAgICAgICAgICAgICAgICAgICdkZXNjX2N1c3RvbV9zdGF0dXMnOiBfXygnQ2xpY2sgaGVyZSB0byB3cml0ZSBhIGN1c3RvbSBzdGF0dXMgbWVzc2FnZScpLAogICAgICAgICAgICAgICAgICAgICAgICAnZGVzY19jaGFuZ2Vfc3RhdHVzJzogX18oJ0NsaWNrIHRvIGNoYW5nZSB5b3VyIGNoYXQgc3RhdHVzJykKICAgICAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgdGhpcy5CT1NIU2Vzc2lvbiA9IEJhY2tib25lLk1vZGVsOwogICAgICAgIHRoaXMuRmVhdHVyZSA9IEJhY2tib25lLk1vZGVsOwogICAgICAgIHRoaXMuRmVhdHVyZXMgPSBCYWNrYm9uZS5Db2xsZWN0aW9uLmV4dGVuZCh7CiAgICAgICAgICAgIC8qIFNlcnZpY2UgRGlzY292ZXJ5CiAgICAgICAgICAgICogLS0tLS0tLS0tLS0tLS0tLS0KICAgICAgICAgICAgKiBUaGlzIGNvbGxlY3Rpb24gc3RvcmVzIEZlYXR1cmUgTW9kZWxzLCByZXByZXNlbnRpbmcgZmVhdHVyZXMKICAgICAgICAgICAgKiBwcm92aWRlZCBieSBhdmFpbGFibGUgWE1QUCBlbnRpdGllcyAoZS5nLiBzZXJ2ZXJzKQogICAgICAgICAgICAqIFNlZSBYRVAtMDAzMCBmb3IgbW9yZSBkZXRhaWxzOiBodHRwOi8veG1wcC5vcmcvZXh0ZW5zaW9ucy94ZXAtMDAzMC5odG1sCiAgICAgICAgICAgICogQWxsIGZlYXR1cmVzIGFyZSBzaG93biBoZXJlOiBodHRwOi8veG1wcC5vcmcvcmVnaXN0cmFyL2Rpc2NvLWZlYXR1cmVzLmh0bWwKICAgICAgICAgICAgKi8KICAgICAgICAgICAgbW9kZWw6IGNvbnZlcnNlLkZlYXR1cmUsCiAgICAgICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHRoaXMuYWRkQ2xpZW50SWRlbnRpdGllcygpLmFkZENsaWVudEZlYXR1cmVzKCk7CiAgICAgICAgICAgICAgICB0aGlzLmJyb3dzZXJTdG9yYWdlID0gbmV3IEJhY2tib25lLkJyb3dzZXJTdG9yYWdlW2NvbnZlcnNlLnN0b3JhZ2VdKAogICAgICAgICAgICAgICAgICAgIGI2NF9zaGExKCdjb252ZXJzZS5mZWF0dXJlcycrY29udmVyc2UuYmFyZV9qaWQpKTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmJyb3dzZXJTdG9yYWdlLnJlY29yZHMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gYnJvd3NlclN0b3JhZ2UgaXMgZW1wdHksIHNvIHdlJ3ZlIGxpa2VseSBuZXZlciBxdWVyaWVkIHRoaXMKICAgICAgICAgICAgICAgICAgICAvLyBkb21haW4gZm9yIGZlYXR1cmVzIHlldAogICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLmNvbm5lY3Rpb24uZGlzY28uaW5mbyhjb252ZXJzZS5kb21haW4sIG51bGwsICQucHJveHkodGhpcy5vbkluZm8sIHRoaXMpKTsKICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS5jb25uZWN0aW9uLmRpc2NvLml0ZW1zKGNvbnZlcnNlLmRvbWFpbiwgbnVsbCwgJC5wcm94eSh0aGlzLm9uSXRlbXMsIHRoaXMpKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5mZXRjaCh7YWRkOnRydWV9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGFkZENsaWVudElkZW50aXRpZXM6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIC8qIFNlZSBodHRwOi8veG1wcC5vcmcvcmVnaXN0cmFyL2Rpc2NvLWNhdGVnb3JpZXMuaHRtbAogICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICAgY29udmVyc2UuY29ubmVjdGlvbi5kaXNjby5hZGRJZGVudGl0eSgnY2xpZW50JywgJ3dlYicsICdDb252ZXJzZS5qcycpOwogICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgYWRkQ2xpZW50RmVhdHVyZXM6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIC8qIFRoZSBzdHJvcGhlLmRpc2NvLmpzIHBsdWdpbiBrZWVwcyBhIGxpc3Qgb2YgZmVhdHVyZXMgd2hpY2gKICAgICAgICAgICAgICAgICAqIGl0IHdpbGwgYWR2ZXJ0aXNlIHRvIGFueSAjaW5mbyBxdWVyaWVzIG1hZGUgdG8gaXQuCiAgICAgICAgICAgICAgICAgKgogICAgICAgICAgICAgICAgICogU2VlOiBodHRwOi8veG1wcC5vcmcvZXh0ZW5zaW9ucy94ZXAtMDAzMC5odG1sI2luZm8KICAgICAgICAgICAgICAgICAqCiAgICAgICAgICAgICAgICAgKiBUT0RPOiB0aGVzZSBmZWF0dXJlcyBuZWVkIHRvIGJlIGFkZGVkIGluIHRoZSByZWxldmFudAogICAgICAgICAgICAgICAgICogZmVhdHVyZS1wcm92aWRpbmcgTW9kZWxzLCBub3QgaGVyZQogICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICAgY29udmVyc2UuY29ubmVjdGlvbi5kaXNjby5hZGRGZWF0dXJlKCdodHRwOi8vamFiYmVyLm9yZy9wcm90b2NvbC9jaGF0c3RhdGVzJyk7IC8vIExpbWl0ZWQgc3VwcG9ydAogICAgICAgICAgICAgICAgIGNvbnZlcnNlLmNvbm5lY3Rpb24uZGlzY28uYWRkRmVhdHVyZSgnaHR0cDovL2phYmJlci5vcmcvcHJvdG9jb2wvcm9zdGVyeCcpOyAvLyBMaW1pdGVkIHN1cHBvcnQKICAgICAgICAgICAgICAgICBjb252ZXJzZS5jb25uZWN0aW9uLmRpc2NvLmFkZEZlYXR1cmUoJ2phYmJlcjp4OmNvbmZlcmVuY2UnKTsKICAgICAgICAgICAgICAgICBjb252ZXJzZS5jb25uZWN0aW9uLmRpc2NvLmFkZEZlYXR1cmUoJ3Vybjp4bXBwOmNhcmJvbnM6MicpOwogICAgICAgICAgICAgICAgIGNvbnZlcnNlLmNvbm5lY3Rpb24uZGlzY28uYWRkRmVhdHVyZSgndmNhcmQtdGVtcCcpOwogICAgICAgICAgICAgICAgIGNvbnZlcnNlLmNvbm5lY3Rpb24uZGlzY28uYWRkRmVhdHVyZShTdHJvcGhlLk5TLkJPU0gpOwogICAgICAgICAgICAgICAgIGNvbnZlcnNlLmNvbm5lY3Rpb24uZGlzY28uYWRkRmVhdHVyZShTdHJvcGhlLk5TLkRJU0NPX0lORk8pOwogICAgICAgICAgICAgICAgIGNvbnZlcnNlLmNvbm5lY3Rpb24uZGlzY28uYWRkRmVhdHVyZShTdHJvcGhlLk5TLk1VQyk7CiAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBvbkl0ZW1zOiBmdW5jdGlvbiAoc3RhbnphKSB7CiAgICAgICAgICAgICAgICAkKHN0YW56YSkuZmluZCgncXVlcnkgaXRlbScpLmVhY2goJC5wcm94eShmdW5jdGlvbiAoaWR4LCBpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgY29udmVyc2UuY29ubmVjdGlvbi5kaXNjby5pbmZvKAogICAgICAgICAgICAgICAgICAgICAgICAkKGl0ZW0pLmF0dHIoJ2ppZCcpLAogICAgICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAkLnByb3h5KHRoaXMub25JbmZvLCB0aGlzKSk7CiAgICAgICAgICAgICAgICB9LCB0aGlzKSk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBvbkluZm86IGZ1bmN0aW9uIChzdGFuemEpIHsKICAgICAgICAgICAgICAgIHZhciAkc3RhbnphID0gJChzdGFuemEpOwogICAgICAgICAgICAgICAgaWYgKCgkc3RhbnphLmZpbmQoJ2lkZW50aXR5W2NhdGVnb3J5PXNlcnZlcl1bdHlwZT1pbV0nKS5sZW5ndGggPT09IDApICYmCiAgICAgICAgICAgICAgICAgICAgKCRzdGFuemEuZmluZCgnaWRlbnRpdHlbY2F0ZWdvcnk9Y29uZmVyZW5jZV1bdHlwZT10ZXh0XScpLmxlbmd0aCA9PT0gMCkpIHsKICAgICAgICAgICAgICAgICAgICAvLyBUaGlzIGlzbid0IGFuIElNIHNlcnZlciBjb21wb25lbnQKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkc3RhbnphLmZpbmQoJ2ZlYXR1cmUnKS5lYWNoKCQucHJveHkoZnVuY3Rpb24gKGlkeCwgZmVhdHVyZSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlKHsKICAgICAgICAgICAgICAgICAgICAgICAgJ3Zhcic6ICQoZmVhdHVyZSkuYXR0cigndmFyJyksCiAgICAgICAgICAgICAgICAgICAgICAgICdmcm9tJzogJHN0YW56YS5hdHRyKCdmcm9tJykKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0sIHRoaXMpKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICB0aGlzLkxvZ2luUGFuZWwgPSBCYWNrYm9uZS5WaWV3LmV4dGVuZCh7CiAgICAgICAgICAgIHRhZ05hbWU6ICdkaXYnLAogICAgICAgICAgICBpZDogImxvZ2luLWRpYWxvZyIsCiAgICAgICAgICAgIGV2ZW50czogewogICAgICAgICAgICAgICAgJ3N1Ym1pdCBmb3JtI2NvbnZlcnNlLWxvZ2luJzogJ2F1dGhlbnRpY2F0ZScKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGNvbm5lY3Q6IGZ1bmN0aW9uICgkZm9ybSwgamlkLCBwYXNzd29yZCkgewogICAgICAgICAgICAgICAgaWYgKCRmb3JtKSB7CiAgICAgICAgICAgICAgICAgICAgJGZvcm0uZmluZCgnaW5wdXRbdHlwZT1zdWJtaXRdJykuaGlkZSgpLmFmdGVyKCc8c3BhbiBjbGFzcz0ic3Bpbm5lciBsb2dpbi1zdWJtaXQiLz4nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHZhciByZXNvdXJjZSA9IFN0cm9waGUuZ2V0UmVzb3VyY2VGcm9tSmlkKGppZCk7CiAgICAgICAgICAgICAgICBpZiAoIXJlc291cmNlKSB7CiAgICAgICAgICAgICAgICAgICAgamlkICs9ICcvY29udmVyc2UuanMtJyArIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSoxMzk3NDk4MjUpLnRvU3RyaW5nKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb252ZXJzZS5jb25uZWN0aW9uLmNvbm5lY3QoamlkLCBwYXNzd29yZCwgY29udmVyc2Uub25Db25uZWN0KTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIChjZmcpIHsKICAgICAgICAgICAgICAgIGNmZy4kcGFyZW50Lmh0bWwodGhpcy4kZWwuaHRtbCgKICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS50ZW1wbGF0ZXMubG9naW5fcGFuZWwoewogICAgICAgICAgICAgICAgICAgICAgICAnbGFiZWxfdXNlcm5hbWUnOiBfXygnWE1QUC9KYWJiZXIgVXNlcm5hbWU6JyksCiAgICAgICAgICAgICAgICAgICAgICAgICdsYWJlbF9wYXNzd29yZCc6IF9fKCdQYXNzd29yZDonKSwKICAgICAgICAgICAgICAgICAgICAgICAgJ2xhYmVsX2xvZ2luJzogX18oJ0xvZyBJbicpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICkpOwogICAgICAgICAgICAgICAgdGhpcy4kdGFicyA9IGNmZy4kcGFyZW50LnBhcmVudCgpLmZpbmQoJyNjb250cm9sYm94LXRhYnMnKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdGhpcy4kdGFicy5hcHBlbmQoY29udmVyc2UudGVtcGxhdGVzLmxvZ2luX3RhYih7bGFiZWxfc2lnbl9pbjogX18oJ1NpZ24gaW4nKX0pKTsKICAgICAgICAgICAgICAgIHRoaXMuJGVsLmZpbmQoJ2lucHV0I2ppZCcpLmZvY3VzKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGF1dGhlbnRpY2F0ZTogZnVuY3Rpb24gKGV2KSB7CiAgICAgICAgICAgICAgICBpZiAoZXYgJiYgZXYucHJldmVudERlZmF1bHQpIHsgZXYucHJldmVudERlZmF1bHQoKTsgfQogICAgICAgICAgICAgICAgdmFyICRmb3JtID0gJChldi50YXJnZXQpLAogICAgICAgICAgICAgICAgICAgICRqaWRfaW5wdXQgPSAkZm9ybS5maW5kKCdpbnB1dFtuYW1lPWppZF0nKSwKICAgICAgICAgICAgICAgICAgICBqaWQgPSAkamlkX2lucHV0LnZhbCgpLAogICAgICAgICAgICAgICAgICAgICRwd19pbnB1dCA9ICRmb3JtLmZpbmQoJ2lucHV0W25hbWU9cGFzc3dvcmRdJyksCiAgICAgICAgICAgICAgICAgICAgcGFzc3dvcmQgPSAkcHdfaW5wdXQudmFsKCksCiAgICAgICAgICAgICAgICAgICAgJGJzdV9pbnB1dCA9IG51bGwsCiAgICAgICAgICAgICAgICAgICAgZXJyb3JzID0gZmFsc2U7CgogICAgICAgICAgICAgICAgaWYgKCEgY29udmVyc2UuYm9zaF9zZXJ2aWNlX3VybCkgewogICAgICAgICAgICAgICAgICAgICRic3VfaW5wdXQgPSAkZm9ybS5maW5kKCdpbnB1dCNib3NoX3NlcnZpY2VfdXJsJyk7CiAgICAgICAgICAgICAgICAgICAgY29udmVyc2UuYm9zaF9zZXJ2aWNlX3VybCA9ICRic3VfaW5wdXQudmFsKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCEgY29udmVyc2UuYm9zaF9zZXJ2aWNlX3VybCkgIHsKICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JzID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgJGJzdV9pbnB1dC5hZGRDbGFzcygnZXJyb3InKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoISBqaWQpIHsKICAgICAgICAgICAgICAgICAgICBlcnJvcnMgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICRqaWRfaW5wdXQuYWRkQ2xhc3MoJ2Vycm9yJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoISBwYXNzd29yZCkgIHsKICAgICAgICAgICAgICAgICAgICBlcnJvcnMgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICRwd19pbnB1dC5hZGRDbGFzcygnZXJyb3InKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChlcnJvcnMpIHsgcmV0dXJuOyB9CiAgICAgICAgICAgICAgICB0aGlzLmNvbm5lY3QoJGZvcm0sIGppZCwgcGFzc3dvcmQpOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgcmVtb3ZlOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB0aGlzLiR0YWJzLmVtcHR5KCk7CiAgICAgICAgICAgICAgICB0aGlzLiRlbC5wYXJlbnQoKS5lbXB0eSgpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIHRoaXMuQ29udHJvbEJveFRvZ2dsZSA9IEJhY2tib25lLlZpZXcuZXh0ZW5kKHsKICAgICAgICAgICAgdGFnTmFtZTogJ2EnLAogICAgICAgICAgICBjbGFzc05hbWU6ICd0b2dnbGUtY29udHJvbGJveCcsCiAgICAgICAgICAgIGlkOiAndG9nZ2xlLWNvbnRyb2xib3gnLAogICAgICAgICAgICBldmVudHM6IHsKICAgICAgICAgICAgICAgICdjbGljayc6ICdvbkNsaWNrJwogICAgICAgICAgICB9LAogICAgICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICAgICAgICAnaHJlZic6ICIjIgogICAgICAgICAgICB9LAoKICAgICAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIoKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgJCgnI2NvbnZlcnNlanMnKS5wcmVwZW5kKHRoaXMuJGVsLmh0bWwoCiAgICAgICAgICAgICAgICAgICAgY29udmVyc2UudGVtcGxhdGVzLmNvbnRyb2xib3hfdG9nZ2xlKHsKICAgICAgICAgICAgICAgICAgICAgICAgJ2xhYmVsX3RvZ2dsZSc6IF9fKCdUb2dnbGUgY2hhdCcpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICkpOwogICAgICAgICAgICAgICAgLy8gV2UgbGV0IHRoZSByZW5kZXIgbWV0aG9kIG9mIENvbnRyb2xCb3hWaWV3IGRlY2lkZSB3aGV0aGVyCiAgICAgICAgICAgICAgICAvLyB0aGUgQ29udHJvbEJveCBvciB0aGUgVG9nZ2xlIG11c3QgYmUgc2hvd24uIFRoaXMgcHJldmVudHMKICAgICAgICAgICAgICAgIC8vIGFydGlmYWN0cyAoaS5lLiBvbiBwYWdlIGxvYWQgdGhlIHRvZ2dsZSBpcyBzaG93biBvbmx5IHRvIHRoZW4KICAgICAgICAgICAgICAgIC8vIHNlY29uZHMgbGF0ZXIgYmUgaGlkZGVuIGluIGZhdm9yIG9mIHRoZSBjb250cm9sIGJveCkuCiAgICAgICAgICAgICAgICB0aGlzLiRlbC5oaWRlKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGhpZGU6IGZ1bmN0aW9uIChjYWxsYmFjaykgewogICAgICAgICAgICAgICAgdGhpcy4kZWwuZmFkZU91dCgnZmFzdCcsIGNhbGxiYWNrKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHNob3c6IGZ1bmN0aW9uIChjYWxsYmFjaykgewogICAgICAgICAgICAgICAgdGhpcy4kZWwuc2hvdygnZmFzdCcsIGNhbGxiYWNrKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHNob3dDb250cm9sQm94OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB2YXIgY29udHJvbGJveCA9IGNvbnZlcnNlLmNoYXRib3hlcy5nZXQoJ2NvbnRyb2xib3gnKTsKICAgICAgICAgICAgICAgIGlmICghY29udHJvbGJveCkgewogICAgICAgICAgICAgICAgICAgIGNvbnRyb2xib3ggPSBjb252ZXJzZS5hZGRDb250cm9sQm94KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoY29udmVyc2UuY29ubmVjdGlvbi5jb25uZWN0ZWQpIHsKICAgICAgICAgICAgICAgICAgICBjb250cm9sYm94LnNhdmUoe2Nsb3NlZDogZmFsc2V9KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgY29udHJvbGJveC50cmlnZ2VyKCdzaG93Jyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgaWYgKCQoImRpdiNjb250cm9sYm94IikuaXMoJzp2aXNpYmxlJykpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgY29udHJvbGJveCA9IGNvbnZlcnNlLmNoYXRib3hlcy5nZXQoJ2NvbnRyb2xib3gnKTsKICAgICAgICAgICAgICAgICAgICBpZiAoY29udmVyc2UuY29ubmVjdGlvbi5jb25uZWN0ZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbGJveC5zYXZlKHtjbG9zZWQ6IHRydWV9KTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sYm94LnRyaWdnZXIoJ2hpZGUnKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0NvbnRyb2xCb3goKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICB0aGlzLmFkZENvbnRyb2xCb3ggPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmNoYXRib3hlcy5hZGQoewogICAgICAgICAgICAgICAgaWQ6ICdjb250cm9sYm94JywKICAgICAgICAgICAgICAgIGJveF9pZDogJ2NvbnRyb2xib3gnLAogICAgICAgICAgICAgICAgaGVpZ2h0OiB0aGlzLmRlZmF1bHRfYm94X2hlaWdodCwKICAgICAgICAgICAgICAgIGNsb3NlZDogIXRoaXMuc2hvd19jb250cm9sYm94X2J5X2RlZmF1bHQKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKCiAgICAgICAgdGhpcy5pbml0Q29ubmVjdGlvbiA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHJpZCwgc2lkLCBqaWQ7CiAgICAgICAgICAgIGlmICh0aGlzLmNvbm5lY3Rpb24gJiYgdGhpcy5jb25uZWN0aW9uLmNvbm5lY3RlZCkgewogICAgICAgICAgICAgICAgdGhpcy5vbkNvbm5lY3RlZCgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gWFhYOiBpdCdzIG5vdCB5ZXQgY2xlYXIgd2hhdCB0aGUgb3JkZXIgb2YgcHJlZmVyZW5jZSBzaG91bGQKICAgICAgICAgICAgICAgIC8vIGJlIGJldHdlZW4gUklEIGFuZCBTSUQgcmVjZWl2ZWQgdmlhIHRoZSBpbml0aWFsaXplIG1ldGhvZCBvcgogICAgICAgICAgICAgICAgLy8gdGhvc2UgcmVjZWl2ZWQgZnJvbSBzZXNzaW9uU3RvcmFnZS4KICAgICAgICAgICAgICAgIC8vCiAgICAgICAgICAgICAgICAvLyBXaGF0IGRvIHlvdSB3ZSBpZiB3ZSByZWNlaXZlIHZhbHVlcyBmcm9tIGJvdGggYXZlbnVlcz8KICAgICAgICAgICAgICAgIC8vCiAgICAgICAgICAgICAgICAvLyBBbHNvLCB3aGF0IGRvIHdlIGRvIHdoZW4gdGhlIGtlZXBhbGl2ZSBzZXNzaW9uIHZhbHVlcyBhcmUKICAgICAgICAgICAgICAgIC8vIGV4cGlyZWQ/IERvIHdlIHRyeSB0byBmYWxsIGJhY2s/CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuYm9zaF9zZXJ2aWNlX3VybCkgewogICAgICAgICAgICAgICAgICAgIHRocm93KCJFcnJvcjogeW91IG11c3Qgc3VwcGx5IGEgdmFsdWUgZm9yIHRoZSBib3NoX3NlcnZpY2VfdXJsIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLmNvbm5lY3Rpb24gPSBuZXcgU3Ryb3BoZS5Db25uZWN0aW9uKHRoaXMuYm9zaF9zZXJ2aWNlX3VybCk7CgogICAgICAgICAgICAgICAgaWYgKHRoaXMucHJlYmluZCkgewogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmppZCAmJiB0aGlzLnNpZCAmJiB0aGlzLnJpZCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbm5lY3Rpb24uYXR0YWNoKHRoaXMuamlkLCB0aGlzLnNpZCwgdGhpcy5yaWQsIHRoaXMub25Db25uZWN0KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLmtlZXBhbGl2ZSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdygiSWYgeW91IHVzZSBwcmViaW5kIGFuZCBkb24ndCB1c2Uga2VlcGFsaXZlLCAiKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidGhlbiB5b3UgTVVTVCBzdXBwbHkgSklELCBSSUQgYW5kIFNJRCB2YWx1ZXMiKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodGhpcy5rZWVwYWxpdmUpIHsKICAgICAgICAgICAgICAgICAgICByaWQgPSB0aGlzLnNlc3Npb24uZ2V0KCdyaWQnKTsKICAgICAgICAgICAgICAgICAgICBzaWQgPSB0aGlzLnNlc3Npb24uZ2V0KCdzaWQnKTsKICAgICAgICAgICAgICAgICAgICBqaWQgPSB0aGlzLnNlc3Npb24uZ2V0KCdqaWQnKTsKICAgICAgICAgICAgICAgICAgICBpZiAocmlkICYmIGppZCAmJiBzaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXNzaW9uLnNhdmUoe3JpZDogcmlkfSk7IC8vIFRoZSBSSUQgbmVlZHMgdG8gYmUgaW5jcmVhc2VkIHdpdGggZWFjaCByZXF1ZXN0LgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbm5lY3Rpb24uYXR0YWNoKGppZCwgc2lkLCByaWQsIHRoaXMub25Db25uZWN0KTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMucHJlYmluZCkgewogICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5jb25uZWN0aW9uOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmVtaXQoJ25vUmVzdW1lYWJsZVNlc3Npb24nKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICB0aGlzLl90ZWFyRG93biA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgLyogUmVtb3ZlIHRob3NlIHZpZXdzIHdoaWNoIGFyZSBvbmx5IGFsbG93ZWQgd2l0aCBhIHZhbGlkCiAgICAgICAgICAgICAqIGNvbm5lY3Rpb24uCiAgICAgICAgICAgICAqLwogICAgICAgICAgICB0aGlzLmluaXRpYWxfcHJlc2VuY2Vfc2VudCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLnJvc3Rlci5vZmYoKS5yZXNldCgpOyAvLyBSZW1vdmVzIHJvc3RlciBjb250YWN0cwogICAgICAgICAgICB0aGlzLmNvbm5lY3Rpb24ucm9zdGVyLl9jYWxsYmFja3MgPSBbXTsgLy8gUmVtb3ZlIGFsbCBSb3N0ZXIgaGFuZGxlcnMgKGUuZy4gcm9zdGVySGFuZGxlcikKICAgICAgICAgICAgdGhpcy5yb3N0ZXJ2aWV3Lm1vZGVsLm9mZigpLnJlc2V0KCk7IC8vIFJlbW92ZXMgcm9zdGVyIGdyb3VwcwogICAgICAgICAgICB0aGlzLnJvc3RlcnZpZXcudW5kZWxlZ2F0ZUV2ZW50cygpLnJlbW92ZSgpOwogICAgICAgICAgICB0aGlzLmNoYXRib3hlcy5yZW1vdmUoKTsgLy8gRG9uJ3QgY2FsbCBvZmYoKSwgZXZlbnRzIHdvbid0IGdldCByZS1yZWdpc3RlcmVkIHVwb24gcmVjb25uZWN0LgogICAgICAgICAgICBpZiAodGhpcy5mZWF0dXJlcykgewogICAgICAgICAgICAgICAgdGhpcy5mZWF0dXJlcy5yZXNldCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLm1pbmltaXplZF9jaGF0cykgewogICAgICAgICAgICAgICAgdGhpcy5taW5pbWl6ZWRfY2hhdHMudW5kZWxlZ2F0ZUV2ZW50cygpLm1vZGVsLnJlc2V0KCk7CiAgICAgICAgICAgICAgICB0aGlzLm1pbmltaXplZF9jaGF0cy5yZW1vdmVBbGwoKTsgLy8gUmVtb3ZlIHN1Yi12aWV3cwogICAgICAgICAgICAgICAgdGhpcy5taW5pbWl6ZWRfY2hhdHMudGVhckRvd24oKS5yZW1vdmUoKTsgLy8gUmVtb3ZlIG92ZXJ2aWV3CiAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5taW5pbWl6ZWRfY2hhdHM7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfTsKCiAgICAgICAgdGhpcy5faW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdGhpcy5jaGF0Ym94ZXMgPSBuZXcgdGhpcy5DaGF0Qm94ZXMoKTsKICAgICAgICAgICAgdGhpcy5jaGF0Ym94dmlld3MgPSBuZXcgdGhpcy5DaGF0Qm94Vmlld3Moe21vZGVsOiB0aGlzLmNoYXRib3hlc30pOwogICAgICAgICAgICB0aGlzLmNvbnRyb2xib3h0b2dnbGUgPSBuZXcgdGhpcy5Db250cm9sQm94VG9nZ2xlKCk7CiAgICAgICAgICAgIHRoaXMub3RyID0gbmV3IHRoaXMuT1RSKCk7CiAgICAgICAgICAgIHRoaXMuaW5pdFNlc3Npb24oKTsKICAgICAgICAgICAgdGhpcy5pbml0Q29ubmVjdGlvbigpOwogICAgICAgICAgICBpZiAodGhpcy5jb25uZWN0aW9uKSB7CiAgICAgICAgICAgICAgICB0aGlzLmFkZENvbnRyb2xCb3goKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9OwoKICAgICAgICB0aGlzLl9pbml0aWFsaXplUGx1Z2lucyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgXy5lYWNoKHRoaXMucGx1Z2lucywgJC5wcm94eShmdW5jdGlvbiAocGx1Z2luKSB7CiAgICAgICAgICAgICAgICAkLnByb3h5KHBsdWdpbiwgdGhpcykodGhpcyk7CiAgICAgICAgICAgIH0sIHRoaXMpKTsKICAgICAgICB9OwoKICAgICAgICAvLyBJbml0aWFsaXphdGlvbgogICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tCiAgICAgICAgLy8gVGhpcyBpcyB0aGUgZW5kIG9mIHRoZSBpbml0aWFsaXplIG1ldGhvZC4KICAgICAgICB0aGlzLl9pbml0aWFsaXplUGx1Z2lucygpOwogICAgICAgIHRoaXMuX2luaXRpYWxpemUoKTsKICAgICAgICB0aGlzLnJlZ2lzdGVyR2xvYmFsRXZlbnRIYW5kbGVycygpOwogICAgICAgIGNvbnZlcnNlLmVtaXQoJ2luaXRpYWxpemVkJyk7CiAgICB9OwoKICAgIHZhciB3cmFwcGVkQ2hhdEJveCA9IGZ1bmN0aW9uIChjaGF0Ym94KSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgJ2VuZE9UUic6ICQucHJveHkoY2hhdGJveC5lbmRPVFIsIGNoYXRib3gpLAogICAgICAgICAgICAnZ2V0JzogJC5wcm94eShjaGF0Ym94LmdldCwgY2hhdGJveCksCiAgICAgICAgICAgICdpbml0aWF0ZU9UUic6ICQucHJveHkoY2hhdGJveC5pbml0aWF0ZU9UUiwgY2hhdGJveCksCiAgICAgICAgICAgICdtYXhpbWl6ZSc6ICQucHJveHkoY2hhdGJveC5tYXhpbWl6ZSwgY2hhdGJveCksCiAgICAgICAgICAgICdtaW5pbWl6ZSc6ICQucHJveHkoY2hhdGJveC5taW5pbWl6ZSwgY2hhdGJveCksCiAgICAgICAgICAgICdzZXQnOiAkLnByb3h5KGNoYXRib3guc2V0LCBjaGF0Ym94KQogICAgICAgIH07CiAgICB9OwogICAgcmV0dXJuIHsKICAgICAgICAnZ2V0QnVkZHknOiBmdW5jdGlvbiAoamlkKSB7CiAgICAgICAgICAgIHZhciBjb250YWN0ID0gY29udmVyc2Uucm9zdGVyLmdldChTdHJvcGhlLmdldEJhcmVKaWRGcm9tSmlkKGppZCkpOwogICAgICAgICAgICBpZiAoY29udGFjdCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGNvbnRhY3QuYXR0cmlidXRlczsKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgJ2dldENoYXRCb3gnOiBmdW5jdGlvbiAoamlkKSB7CiAgICAgICAgICAgIHZhciBjaGF0Ym94ID0gY29udmVyc2UuY2hhdGJveGVzLmdldChqaWQpOwogICAgICAgICAgICBpZiAoY2hhdGJveCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHdyYXBwZWRDaGF0Qm94KGNoYXRib3gpOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICAnZ2V0UklEJzogZnVuY3Rpb24gKCkgewogICAgICAgICAgICBpZiAoY29udmVyc2UuZXhwb3NlX3JpZF9hbmRfc2lkICYmIHR5cGVvZiBjb252ZXJzZS5jb25uZWN0aW9uICE9PSAidW5kZWZpbmVkIikgewogICAgICAgICAgICAgICAgcmV0dXJuIGNvbnZlcnNlLmNvbm5lY3Rpb24ucmlkIHx8IGNvbnZlcnNlLmNvbm5lY3Rpb24uX3Byb3RvLnJpZDsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9LAogICAgICAgICdnZXRTSUQnOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGlmIChjb252ZXJzZS5leHBvc2VfcmlkX2FuZF9zaWQgJiYgdHlwZW9mIGNvbnZlcnNlLmNvbm5lY3Rpb24gIT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gY29udmVyc2UuY29ubmVjdGlvbi5zaWQgfHwgY29udmVyc2UuY29ubmVjdGlvbi5fcHJvdG8uc2lkOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0sCiAgICAgICAgJ2luaXRpYWxpemUnOiBmdW5jdGlvbiAoc2V0dGluZ3MsIGNhbGxiYWNrKSB7CiAgICAgICAgICAgIGNvbnZlcnNlLmluaXRpYWxpemUoc2V0dGluZ3MsIGNhbGxiYWNrKTsKICAgICAgICB9LAogICAgICAgICdqUXVlcnknOiAkLAogICAgICAgICdvcGVuQ2hhdEJveCc6IGZ1bmN0aW9uIChqaWQpIHsKICAgICAgICAgICAgdmFyIGNvbnRhY3QgPSBjb252ZXJzZS5yb3N0ZXIuZ2V0KFN0cm9waGUuZ2V0QmFyZUppZEZyb21KaWQoamlkKSk7CiAgICAgICAgICAgIGlmIChjb250YWN0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gd3JhcHBlZENoYXRCb3goY29udmVyc2UuY2hhdGJveHZpZXdzLnNob3dDaGF0KGNvbnRhY3QuYXR0cmlidXRlcykpOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICAnb25jZSc6IGZ1bmN0aW9uIChldnQsIGhhbmRsZXIpIHsKICAgICAgICAgICAgY29udmVyc2Uub25jZShldnQsIGhhbmRsZXIpOwogICAgICAgIH0sCiAgICAgICAgJ29uJzogZnVuY3Rpb24gKGV2dCwgaGFuZGxlcikgewogICAgICAgICAgICBjb252ZXJzZS5vbihldnQsIGhhbmRsZXIpOwogICAgICAgIH0sCiAgICAgICAgJ29mZic6IGZ1bmN0aW9uIChldnQsIGhhbmRsZXIpIHsKICAgICAgICAgICAgY29udmVyc2Uub2ZmKGV2dCwgaGFuZGxlcik7CiAgICAgICAgfSwKICAgICAgICAncmVnaXN0ZXJQbHVnaW4nOiBmdW5jdGlvbiAobmFtZSwgY2FsbGJhY2spIHsKICAgICAgICAgICAgY29udmVyc2UucGx1Z2luc1tuYW1lXSA9IGNhbGxiYWNrOwogICAgICAgIH0KICAgIH07Cn0pKTsKCnJlcXVpcmUuY29uZmlnKHsKICAgIGJhc2VVcmw6ICcuJywKICAgIHBhdGhzOiB7CiAgICAgICAgImJhY2tib25lIjogICAgICAgICAgICAgICAgICJjb21wb25lbnRzL2JhY2tib25lL2JhY2tib25lIiwKICAgICAgICAiYmFja2JvbmUuYnJvd3NlclN0b3JhZ2UiOiAgImNvbXBvbmVudHMvYmFja2JvbmUuYnJvd3NlclN0b3JhZ2UvYmFja2JvbmUuYnJvd3NlclN0b3JhZ2UiLAogICAgICAgICJiYWNrYm9uZS5vdmVydmlldyI6ICAgICAgICAiY29tcG9uZW50cy9iYWNrYm9uZS5vdmVydmlldy9iYWNrYm9uZS5vdmVydmlldyIsCiAgICAgICAgImJvb3RzdHJhcCI6ICAgICAgICAgICAgICAgICJjb21wb25lbnRzL2Jvb3RzdHJhcC9kaXN0L2pzL2Jvb3RzdHJhcCIsICAgICAgICAgICAvLyBYWFg6IE9ubHkgcmVxdWlyZWQgZm9yIGh0dHBzOi8vY29udmVyc2Vqcy5vcmcgd2Vic2l0ZQogICAgICAgICJib290c3RyYXBKUyI6ICAgICAgICAgICAgICAiY29tcG9uZW50cy9ib290c3RyYXBKUy9pbmRleCIsICAgICAgICAgICAgICAgICAgICAgLy8gWFhYOiBPbmx5IHJlcXVpcmVkIGZvciBodHRwczovL2NvbnZlcnNlanMub3JnIHdlYnNpdGUKICAgICAgICAiY29udmVyc2UtZGVwZW5kZW5jaWVzIjogICAgInNyYy9kZXBzLXdlYnNpdGUiLAogICAgICAgICJjb252ZXJzZS10ZW1wbGF0ZXMiOiAgICAgICAic3JjL3RlbXBsYXRlcyIsCiAgICAgICAgImV2ZW50ZW1pdHRlciI6ICAgICAgICAgICAgICJjb21wb25lbnRzL290ci9idWlsZC9kZXAvZXZlbnRlbWl0dGVyIiwKICAgICAgICAianF1ZXJ5IjogICAgICAgICAgICAgICAgICAgImNvbXBvbmVudHMvanF1ZXJ5L2Rpc3QvanF1ZXJ5IiwKICAgICAgICAianF1ZXJ5LXByaXZhdGUiOiAgICAgICAgICAgInNyYy9qcXVlcnktcHJpdmF0ZSIsCiAgICAgICAgImpxdWVyeS5icm93c2VyIjogICAgICAgICAgICJjb21wb25lbnRzL2pxdWVyeS5icm93c2VyL2luZGV4IiwKICAgICAgICAianF1ZXJ5LmVhc2luZyI6ICAgICAgICAgICAgImNvbXBvbmVudHMvanF1ZXJ5LWVhc2luZy1vcmlnaW5hbC9pbmRleCIsICAgICAgICAgIC8vIFhYWDogT25seSByZXF1aXJlZCBmb3IgaHR0cHM6Ly9jb252ZXJzZWpzLm9yZyB3ZWJzaXRlCiAgICAgICAgIm1vbWVudCI6ICAgICAgICAgICAgICAgICAgICJjb21wb25lbnRzL21vbWVudGpzL21vbWVudCIsCiAgICAgICAgInN0cm9waGUiOiAgICAgICAgICAgICAgICAgICJjb21wb25lbnRzL3N0cm9waGUvc3Ryb3BoZSIsCiAgICAgICAgInN0cm9waGUuZGlzY28iOiAgICAgICAgICAgICJjb21wb25lbnRzL3N0cm9waGVqcy1wbHVnaW5zL2Rpc2NvL3N0cm9waGUuZGlzY28iLAogICAgICAgICJzdHJvcGhlLm11YyI6ICAgICAgICAgICAgICAiY29tcG9uZW50cy9zdHJvcGhlLm11Yy9pbmRleCIsCiAgICAgICAgInN0cm9waGUucm9zdGVyIjogICAgICAgICAgICJzcmMvc3Ryb3BoZS5yb3N0ZXIiLAogICAgICAgICJzdHJvcGhlLnZjYXJkIjogICAgICAgICAgICAiY29tcG9uZW50cy9zdHJvcGhlanMtcGx1Z2lucy92Y2FyZC9zdHJvcGhlLnZjYXJkIiwKICAgICAgICAidGV4dCI6ICAgICAgICAgICAgICAgICAgICAgJ2NvbXBvbmVudHMvcmVxdWlyZWpzLXRleHQvdGV4dCcsCiAgICAgICAgInRwbCI6ICAgICAgICAgICAgICAgICAgICAgICdjb21wb25lbnRzL3JlcXVpcmVqcy10cGwtamNicmFuZC90cGwnLAogICAgICAgICJ0eXBlYWhlYWQiOiAgICAgICAgICAgICAgICAiY29tcG9uZW50cy90eXBlYWhlYWQuanMvaW5kZXgiLAogICAgICAgICJ1bmRlcnNjb3JlIjogICAgICAgICAgICAgICAiY29tcG9uZW50cy91bmRlcnNjb3JlL3VuZGVyc2NvcmUiLAogICAgICAgICJ1dGlscyI6ICAgICAgICAgICAgICAgICAgICAic3JjL3V0aWxzIiwKCiAgICAgICAgLy8gT2ZmLXRoZS1yZWNvcmQtZW5jcnlwdGlvbgogICAgICAgICJiaWdpbnQiOiAgICAgICAgICAgICAgICJzcmMvYmlnaW50IiwKICAgICAgICAiY3J5cHRvIjogICAgICAgICAgICAgICAic3JjL2NyeXB0byIsCiAgICAgICAgImNyeXB0by5hZXMiOiAgICAgICAgICAgImNvbXBvbmVudHMvb3RyL3ZlbmRvci9jcnlwdG9qcy9hZXMiLAogICAgICAgICJjcnlwdG8uY2lwaGVyLWNvcmUiOiAgICJjb21wb25lbnRzL290ci92ZW5kb3IvY3J5cHRvanMvY2lwaGVyLWNvcmUiLAogICAgICAgICJjcnlwdG8uY29yZSI6ICAgICAgICAgICJjb21wb25lbnRzL290ci92ZW5kb3IvY3J5cHRvanMvY29yZSIsCiAgICAgICAgImNyeXB0by5lbmMtYmFzZTY0IjogICAgImNvbXBvbmVudHMvb3RyL3ZlbmRvci9jcnlwdG9qcy9lbmMtYmFzZTY0IiwKICAgICAgICAiY3J5cHRvLmV2cGtkZiI6ICAgICAgICAiY29tcG9uZW50cy9jcnlwdG8tanMtZXZhbnZvc2Jlcmcvc3JjL2V2cGtkZiIsCiAgICAgICAgImNyeXB0by5obWFjIjogICAgICAgICAgImNvbXBvbmVudHMvb3RyL3ZlbmRvci9jcnlwdG9qcy9obWFjIiwKICAgICAgICAiY3J5cHRvLm1kNSI6ICAgICAgICAgICAiY29tcG9uZW50cy9jcnlwdG8tanMtZXZhbnZvc2Jlcmcvc3JjL21kNSIsCiAgICAgICAgImNyeXB0by5tb2RlLWN0ciI6ICAgICAgImNvbXBvbmVudHMvb3RyL3ZlbmRvci9jcnlwdG9qcy9tb2RlLWN0ciIsCiAgICAgICAgImNyeXB0by5wYWQtbm9wYWRkaW5nIjogImNvbXBvbmVudHMvb3RyL3ZlbmRvci9jcnlwdG9qcy9wYWQtbm9wYWRkaW5nIiwKICAgICAgICAiY3J5cHRvLnNoYTEiOiAgICAgICAgICJjb21wb25lbnRzL290ci92ZW5kb3IvY3J5cHRvanMvc2hhMSIsCiAgICAgICAgImNyeXB0by5zaGEyNTYiOiAgICAgICAgImNvbXBvbmVudHMvb3RyL3ZlbmRvci9jcnlwdG9qcy9zaGEyNTYiLAogICAgICAgICJzYWxzYTIwIjogICAgICAgICAgICAgICJjb21wb25lbnRzL290ci9idWlsZC9kZXAvc2Fsc2EyMCIsCiAgICAgICAgIm90ciI6ICAgICAgICAgICAgICAgICAgInNyYy9vdHIiLAoKICAgICAgICAvLyBMb2NhbGVzIHBhdGhzCiAgICAgICAgImxvY2FsZXMiOiAgICJsb2NhbGUvbG9jYWxlcyIsCiAgICAgICAgImplZCI6ICAgICAgICJjb21wb25lbnRzL2plZC9qZWQiLAogICAgICAgICJhZiI6ICAgICAgICAibG9jYWxlL2FmL0xDX01FU1NBR0VTL2FmIiwKICAgICAgICAiZGUiOiAgICAgICAgImxvY2FsZS9kZS9MQ19NRVNTQUdFUy9kZSIsCiAgICAgICAgImVuIjogICAgICAgICJsb2NhbGUvZW4vTENfTUVTU0FHRVMvZW4iLAogICAgICAgICJlcyI6ICAgICAgICAibG9jYWxlL2VzL0xDX01FU1NBR0VTL2VzIiwKICAgICAgICAiZnIiOiAgICAgICAgImxvY2FsZS9mci9MQ19NRVNTQUdFUy9mciIsCiAgICAgICAgImhlIjogICAgICAgICJsb2NhbGUvaGUvTENfTUVTU0FHRVMvaGUiLAogICAgICAgICJodSI6ICAgICAgICAibG9jYWxlL2h1L0xDX01FU1NBR0VTL2h1IiwKICAgICAgICAiaWQiOiAgICAgICAgImxvY2FsZS9pZC9MQ19NRVNTQUdFUy9pZCIsCiAgICAgICAgIml0IjogICAgICAgICJsb2NhbGUvaXQvTENfTUVTU0FHRVMvaXQiLAogICAgICAgICJqYSI6ICAgICAgICAibG9jYWxlL2phL0xDX01FU1NBR0VTL2phIiwKICAgICAgICAibmwiOiAgICAgICAgImxvY2FsZS9ubC9MQ19NRVNTQUdFUy9ubCIsCiAgICAgICAgInB0X0JSIjogICAgICJsb2NhbGUvcHRfQlIvTENfTUVTU0FHRVMvcHRfQlIiLAogICAgICAgICJydSI6ICAgICAgICAibG9jYWxlL3J1L0xDX01FU1NBR0VTL3J1IiwKICAgICAgICAiemgiOiAgICAgICAgImxvY2FsZS96aC9MQ19NRVNTQUdFUy96aCIsCgogICAgICAgIC8vIFRlbXBsYXRlcwogICAgICAgICJhY3Rpb24iOiAgICAgICAgICAgICAgICAgICAic3JjL3RlbXBsYXRlcy9hY3Rpb24iLAogICAgICAgICJhZGRfY29udGFjdF9kcm9wZG93biI6ICAgICAic3JjL3RlbXBsYXRlcy9hZGRfY29udGFjdF9kcm9wZG93biIsCiAgICAgICAgImFkZF9jb250YWN0X2Zvcm0iOiAgICAgICAgICJzcmMvdGVtcGxhdGVzL2FkZF9jb250YWN0X2Zvcm0iLAogICAgICAgICJjaGFuZ2Vfc3RhdHVzX21lc3NhZ2UiOiAgICAic3JjL3RlbXBsYXRlcy9jaGFuZ2Vfc3RhdHVzX21lc3NhZ2UiLAogICAgICAgICJjaGF0X3N0YXR1cyI6ICAgICAgICAgICAgICAic3JjL3RlbXBsYXRlcy9jaGF0X3N0YXR1cyIsCiAgICAgICAgImNoYXRhcmVhIjogICAgICAgICAgICAgICAgICJzcmMvdGVtcGxhdGVzL2NoYXRhcmVhIiwKICAgICAgICAiY2hhdGJveCI6ICAgICAgICAgICAgICAgICAgInNyYy90ZW1wbGF0ZXMvY2hhdGJveCIsCiAgICAgICAgImNoYXRyb29tIjogICAgICAgICAgICAgICAgICJzcmMvdGVtcGxhdGVzL2NoYXRyb29tIiwKICAgICAgICAiY2hhdHJvb21fcGFzc3dvcmRfZm9ybSI6ICAgInNyYy90ZW1wbGF0ZXMvY2hhdHJvb21fcGFzc3dvcmRfZm9ybSIsCiAgICAgICAgImNoYXRyb29tX3NpZGViYXIiOiAgICAgICAgICJzcmMvdGVtcGxhdGVzL2NoYXRyb29tX3NpZGViYXIiLAogICAgICAgICJjaGF0cm9vbXNfdGFiIjogICAgICAgICAgICAic3JjL3RlbXBsYXRlcy9jaGF0cm9vbXNfdGFiIiwKICAgICAgICAiY2hhdHNfcGFuZWwiOiAgICAgICAgICAgICAgInNyYy90ZW1wbGF0ZXMvY2hhdHNfcGFuZWwiLAogICAgICAgICJjaG9vc2Vfc3RhdHVzIjogICAgICAgICAgICAic3JjL3RlbXBsYXRlcy9jaG9vc2Vfc3RhdHVzIiwKICAgICAgICAiY29udGFjdHNfcGFuZWwiOiAgICAgICAgICAgInNyYy90ZW1wbGF0ZXMvY29udGFjdHNfcGFuZWwiLAogICAgICAgICJjb250YWN0c190YWIiOiAgICAgICAgICAgICAic3JjL3RlbXBsYXRlcy9jb250YWN0c190YWIiLAogICAgICAgICJjb250cm9sYm94IjogICAgICAgICAgICAgICAic3JjL3RlbXBsYXRlcy9jb250cm9sYm94IiwKICAgICAgICAiY29udHJvbGJveF90b2dnbGUiOiAgICAgICAgInNyYy90ZW1wbGF0ZXMvY29udHJvbGJveF90b2dnbGUiLAogICAgICAgICJmaWVsZCI6ICAgICAgICAgICAgICAgICAgICAic3JjL3RlbXBsYXRlcy9maWVsZCIsCiAgICAgICAgImZvcm1fY2hlY2tib3giOiAgICAgICAgICAgICJzcmMvdGVtcGxhdGVzL2Zvcm1fY2hlY2tib3giLAogICAgICAgICJmb3JtX2lucHV0IjogICAgICAgICAgICAgICAic3JjL3RlbXBsYXRlcy9mb3JtX2lucHV0IiwKICAgICAgICAiZm9ybV9zZWxlY3QiOiAgICAgICAgICAgICAgInNyYy90ZW1wbGF0ZXMvZm9ybV9zZWxlY3QiLAogICAgICAgICJncm91cF9oZWFkZXIiOiAgICAgICAgICAgICAic3JjL3RlbXBsYXRlcy9ncm91cF9oZWFkZXIiLAogICAgICAgICJpbmZvIjogICAgICAgICAgICAgICAgICAgICAic3JjL3RlbXBsYXRlcy9pbmZvIiwKICAgICAgICAibG9naW5fcGFuZWwiOiAgICAgICAgICAgICAgInNyYy90ZW1wbGF0ZXMvbG9naW5fcGFuZWwiLAogICAgICAgICJsb2dpbl90YWIiOiAgICAgICAgICAgICAgICAic3JjL3RlbXBsYXRlcy9sb2dpbl90YWIiLAogICAgICAgICJtZXNzYWdlIjogICAgICAgICAgICAgICAgICAic3JjL3RlbXBsYXRlcy9tZXNzYWdlIiwKICAgICAgICAibmV3X2RheSI6ICAgICAgICAgICAgICAgICAgInNyYy90ZW1wbGF0ZXMvbmV3X2RheSIsCiAgICAgICAgIm9jY3VwYW50IjogICAgICAgICAgICAgICAgICJzcmMvdGVtcGxhdGVzL29jY3VwYW50IiwKICAgICAgICAicGVuZGluZ19jb250YWN0IjogICAgICAgICAgInNyYy90ZW1wbGF0ZXMvcGVuZGluZ19jb250YWN0IiwKICAgICAgICAicGVuZGluZ19jb250YWN0cyI6ICAgICAgICAgInNyYy90ZW1wbGF0ZXMvcGVuZGluZ19jb250YWN0cyIsCiAgICAgICAgInJlcXVlc3RpbmdfY29udGFjdCI6ICAgICAgICJzcmMvdGVtcGxhdGVzL3JlcXVlc3RpbmdfY29udGFjdCIsCiAgICAgICAgInJlcXVlc3RpbmdfY29udGFjdHMiOiAgICAgICJzcmMvdGVtcGxhdGVzL3JlcXVlc3RpbmdfY29udGFjdHMiLAogICAgICAgICJyb29tX2Rlc2NyaXB0aW9uIjogICAgICAgICAic3JjL3RlbXBsYXRlcy9yb29tX2Rlc2NyaXB0aW9uIiwKICAgICAgICAicm9vbV9pdGVtIjogICAgICAgICAgICAgICAgInNyYy90ZW1wbGF0ZXMvcm9vbV9pdGVtIiwKICAgICAgICAicm9vbV9wYW5lbCI6ICAgICAgICAgICAgICAgInNyYy90ZW1wbGF0ZXMvcm9vbV9wYW5lbCIsCiAgICAgICAgInJvc3RlciI6ICAgICAgICAgICAgICAgICAgICJzcmMvdGVtcGxhdGVzL3Jvc3RlciIsCiAgICAgICAgInJvc3Rlcl9pdGVtIjogICAgICAgICAgICAgICJzcmMvdGVtcGxhdGVzL3Jvc3Rlcl9pdGVtIiwKICAgICAgICAic2VhcmNoX2NvbnRhY3QiOiAgICAgICAgICAgInNyYy90ZW1wbGF0ZXMvc2VhcmNoX2NvbnRhY3QiLAogICAgICAgICJzZWxlY3Rfb3B0aW9uIjogICAgICAgICAgICAic3JjL3RlbXBsYXRlcy9zZWxlY3Rfb3B0aW9uIiwKICAgICAgICAic3RhdHVzX29wdGlvbiI6ICAgICAgICAgICAgInNyYy90ZW1wbGF0ZXMvc3RhdHVzX29wdGlvbiIsCiAgICAgICAgInRvZ2dsZV9jaGF0cyI6ICAgICAgICAgICAgICJzcmMvdGVtcGxhdGVzL3RvZ2dsZV9jaGF0cyIsCiAgICAgICAgInRvb2xiYXIiOiAgICAgICAgICAgICAgICAgICJzcmMvdGVtcGxhdGVzL3Rvb2xiYXIiLAogICAgICAgICJ0cmltbWVkX2NoYXQiOiAgICAgICAgICAgICAic3JjL3RlbXBsYXRlcy90cmltbWVkX2NoYXQiCiAgICB9LAoKICAgIG1hcDogewogICAgICAgIC8vICcqJyBtZWFucyBhbGwgbW9kdWxlcyB3aWxsIGdldCAnanF1ZXJ5LXByaXZhdGUnCiAgICAgICAgLy8gZm9yIHRoZWlyICdqcXVlcnknIGRlcGVuZGVuY3kuCiAgICAgICAgJyonOiB7ICdqcXVlcnknOiAnanF1ZXJ5LXByaXZhdGUnIH0sCiAgICAgICAgLy8gJ2pxdWVyeS1wcml2YXRlJyB3YW50cyB0aGUgcmVhbCBqUXVlcnkgbW9kdWxlCiAgICAgICAgLy8gdGhvdWdoLiBJZiB0aGlzIGxpbmUgd2FzIG5vdCBoZXJlLCB0aGVyZSB3b3VsZAogICAgICAgIC8vIGJlIGFuIHVucmVzb2x2YWJsZSBjeWNsaWMgZGVwZW5kZW5jeS4KICAgICAgICAnanF1ZXJ5LXByaXZhdGUnOiB7ICdqcXVlcnknOiAnanF1ZXJ5JyB9CiAgICB9LAoKICAgIHRwbDogewogICAgICAgIC8vIENvbmZpZ3VyYXRpb24gZm9yIHJlcXVpcmVqcy10cGwKICAgICAgICAvLyBVc2UgTXVzdGFjaGUgc3R5bGUgc3ludGF4IGZvciB2YXJpYWJsZSBpbnRlcnBvbGF0aW9uCiAgICAgICAgdGVtcGxhdGVTZXR0aW5nczogewogICAgICAgICAgICBldmFsdWF0ZSA6IC9ce1xbKFtcc1xTXSs/KVxdXH0vZywKICAgICAgICAgICAgaW50ZXJwb2xhdGUgOiAvXHtceyhbXHNcU10rPylcfVx9L2cKICAgICAgICB9CiAgICB9LAoKICAgIC8vIGRlZmluZSBtb2R1bGUgZGVwZW5kZW5jaWVzIGZvciBtb2R1bGVzIG5vdCB1c2luZyBkZWZpbmUKICAgIHNoaW06IHsKICAgICAgICAndW5kZXJzY29yZSc6ICAgICAgICAgICB7IGV4cG9ydHM6ICdfJyB9LAogICAgICAgICdjcnlwdG8uYWVzJzogICAgICAgICAgIHsgZGVwczogWydjcnlwdG8uY2lwaGVyLWNvcmUnXSB9LAogICAgICAgICdjcnlwdG8uY2lwaGVyLWNvcmUnOiAgIHsgZGVwczogWydjcnlwdG8uZW5jLWJhc2U2NCcsICdjcnlwdG8uZXZwa2RmJ10gfSwKICAgICAgICAnY3J5cHRvLmVuYy1iYXNlNjQnOiAgICB7IGRlcHM6IFsnY3J5cHRvLmNvcmUnXSB9LAogICAgICAgICdjcnlwdG8uZXZwa2RmJzogICAgICAgIHsgZGVwczogWydjcnlwdG8ubWQ1J10gfSwKICAgICAgICAnY3J5cHRvLmhtYWMnOiAgICAgICAgICB7IGRlcHM6IFsnY3J5cHRvLmNvcmUnXSB9LAogICAgICAgICdjcnlwdG8ubWQ1JzogICAgICAgICAgIHsgZGVwczogWydjcnlwdG8uY29yZSddIH0sCiAgICAgICAgJ2NyeXB0by5tb2RlLWN0cic6ICAgICAgeyBkZXBzOiBbJ2NyeXB0by5jaXBoZXItY29yZSddIH0sCiAgICAgICAgJ2NyeXB0by5wYWQtbm9wYWRkaW5nJzogeyBkZXBzOiBbJ2NyeXB0by5jaXBoZXItY29yZSddIH0sCiAgICAgICAgJ2NyeXB0by5zaGExJzogICAgICAgICAgeyBkZXBzOiBbJ2NyeXB0by5jb3JlJ10gfSwKICAgICAgICAnY3J5cHRvLnNoYTI1Nic6ICAgICAgICB7IGRlcHM6IFsnY3J5cHRvLmNvcmUnXSB9LAogICAgICAgICdiaWdpbnQnOiAgICAgICAgICAgICAgIHsgZGVwczogWydjcnlwdG8nXSB9LAogICAgICAgICdzdHJvcGhlJzogICAgICAgICAgICAgIHsgZXhwb3J0czogJ1N0cm9waGUnIH0sCiAgICAgICAgJ3N0cm9waGUuZGlzY28nOiAgICAgICAgeyBkZXBzOiBbJ3N0cm9waGUnXSB9LAogICAgICAgICdzdHJvcGhlLm11Yyc6ICAgICAgICAgIHsgZGVwczogWydzdHJvcGhlJ10gfSwKICAgICAgICAnc3Ryb3BoZS5yb3N0ZXInOiAgICAgICB7IGRlcHM6IFsnc3Ryb3BoZSddIH0sCiAgICAgICAgJ3N0cm9waGUudmNhcmQnOiAgICAgICAgeyBkZXBzOiBbJ3N0cm9waGUnXSB9CiAgICB9Cn0pOwpyZXF1aXJlKFsiY29udmVyc2UiXSwgZnVuY3Rpb24oY29udmVyc2UpIHsKICAgIHdpbmRvdy5jb252ZXJzZSA9IGNvbnZlcnNlOwp9KTsKCmRlZmluZSgibWFpbiIsIGZ1bmN0aW9uKCl7fSk7Cgo=",
                "body": "LyoqCiAqIEBsaWNlbnNlIGFsbW9uZCAwLjIuOSBDb3B5cmlnaHQgKGMpIDIwMTEtMjAxNCwgVGhlIERvam8gRm91bmRhdGlvbiBBbGwgUmlnaHRzIFJlc2VydmVkLgogKiBBdmFpbGFibGUgdmlhIHRoZSBNSVQgb3IgbmV3IEJTRCBsaWNlbnNlLgogKiBzZWU6IGh0dHA6Ly9naXRodWIuY29tL2pyYnVya2UvYWxtb25kIGZvciBkZXRhaWxzCiAqLwovL0dvaW5nIHNsb3BweSB0byBhdm9pZCAndXNlIHN0cmljdCcgc3RyaW5nIGNvc3QsIGJ1dCBzdHJpY3QgcHJhY3RpY2VzIHNob3VsZAovL2JlIGZvbGxvd2VkLgovKmpzbGludCBzbG9wcHk6IHRydWUgKi8KLypnbG9iYWwgc2V0VGltZW91dDogZmFsc2UgKi8KCnZhciByZXF1aXJlanMsIHJlcXVpcmUsIGRlZmluZTsKKGZ1bmN0aW9uICh1bmRlZikgewogICAgdmFyIG1haW4sIHJlcSwgbWFrZU1hcCwgaGFuZGxlcnMsCiAgICAgICAgZGVmaW5lZCA9IHt9LAogICAgICAgIHdhaXRpbmcgPSB7fSwKICAgICAgICBjb25maWcgPSB7fSwKICAgICAgICBkZWZpbmluZyA9IHt9LAogICAgICAgIGhhc093biA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHksCiAgICAgICAgYXBzID0gW10uc2xpY2UsCiAgICAgICAganNTdWZmaXhSZWdFeHAgPSAvXC5qcyQvOwoKICAgIGZ1bmN0aW9uIGhhc1Byb3Aob2JqLCBwcm9wKSB7CiAgICAgICAgcmV0dXJuIGhhc093bi5jYWxsKG9iaiwgcHJvcCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBHaXZlbiBhIHJlbGF0aXZlIG1vZHVsZSBuYW1lLCBsaWtlIC4vc29tZXRoaW5nLCBub3JtYWxpemUgaXQgdG8KICAgICAqIGEgcmVhbCBuYW1lIHRoYXQgY2FuIGJlIG1hcHBlZCB0byBhIHBhdGguCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gbmFtZSB0aGUgcmVsYXRpdmUgbmFtZQogICAgICogQHBhcmFtIHtTdHJpbmd9IGJhc2VOYW1lIGEgcmVhbCBuYW1lIHRoYXQgdGhlIG5hbWUgYXJnIGlzIHJlbGF0aXZlCiAgICAgKiB0by4KICAgICAqIEByZXR1cm5zIHtTdHJpbmd9IG5vcm1hbGl6ZWQgbmFtZQogICAgICovCiAgICBmdW5jdGlvbiBub3JtYWxpemUobmFtZSwgYmFzZU5hbWUpIHsKICAgICAgICB2YXIgbmFtZVBhcnRzLCBuYW1lU2VnbWVudCwgbWFwVmFsdWUsIGZvdW5kTWFwLCBsYXN0SW5kZXgsCiAgICAgICAgICAgIGZvdW5kSSwgZm91bmRTdGFyTWFwLCBzdGFySSwgaSwgaiwgcGFydCwKICAgICAgICAgICAgYmFzZVBhcnRzID0gYmFzZU5hbWUgJiYgYmFzZU5hbWUuc3BsaXQoIi8iKSwKICAgICAgICAgICAgbWFwID0gY29uZmlnLm1hcCwKICAgICAgICAgICAgc3Rhck1hcCA9IChtYXAgJiYgbWFwWycqJ10pIHx8IHt9OwoKICAgICAgICAvL0FkanVzdCBhbnkgcmVsYXRpdmUgcGF0aHMuCiAgICAgICAgaWYgKG5hbWUgJiYgbmFtZS5jaGFyQXQoMCkgPT09ICIuIikgewogICAgICAgICAgICAvL0lmIGhhdmUgYSBiYXNlIG5hbWUsIHRyeSB0byBub3JtYWxpemUgYWdhaW5zdCBpdCwKICAgICAgICAgICAgLy9vdGhlcndpc2UsIGFzc3VtZSBpdCBpcyBhIHRvcC1sZXZlbCByZXF1aXJlIHRoYXQgd2lsbAogICAgICAgICAgICAvL2JlIHJlbGF0aXZlIHRvIGJhc2VVcmwgaW4gdGhlIGVuZC4KICAgICAgICAgICAgaWYgKGJhc2VOYW1lKSB7CiAgICAgICAgICAgICAgICAvL0NvbnZlcnQgYmFzZU5hbWUgdG8gYXJyYXksIGFuZCBsb3Agb2ZmIHRoZSBsYXN0IHBhcnQsCiAgICAgICAgICAgICAgICAvL3NvIHRoYXQgLiBtYXRjaGVzIHRoYXQgImRpcmVjdG9yeSIgYW5kIG5vdCBuYW1lIG9mIHRoZSBiYXNlTmFtZSdzCiAgICAgICAgICAgICAgICAvL21vZHVsZS4gRm9yIGluc3RhbmNlLCBiYXNlTmFtZSBvZiAib25lL3R3by90aHJlZSIsIG1hcHMgdG8KICAgICAgICAgICAgICAgIC8vIm9uZS90d28vdGhyZWUuanMiLCBidXQgd2Ugd2FudCB0aGUgZGlyZWN0b3J5LCAib25lL3R3byIgZm9yCiAgICAgICAgICAgICAgICAvL3RoaXMgbm9ybWFsaXphdGlvbi4KICAgICAgICAgICAgICAgIGJhc2VQYXJ0cyA9IGJhc2VQYXJ0cy5zbGljZSgwLCBiYXNlUGFydHMubGVuZ3RoIC0gMSk7CiAgICAgICAgICAgICAgICBuYW1lID0gbmFtZS5zcGxpdCgnLycpOwogICAgICAgICAgICAgICAgbGFzdEluZGV4ID0gbmFtZS5sZW5ndGggLSAxOwoKICAgICAgICAgICAgICAgIC8vIE5vZGUgLmpzIGFsbG93YW5jZToKICAgICAgICAgICAgICAgIGlmIChjb25maWcubm9kZUlkQ29tcGF0ICYmIGpzU3VmZml4UmVnRXhwLnRlc3QobmFtZVtsYXN0SW5kZXhdKSkgewogICAgICAgICAgICAgICAgICAgIG5hbWVbbGFzdEluZGV4XSA9IG5hbWVbbGFzdEluZGV4XS5yZXBsYWNlKGpzU3VmZml4UmVnRXhwLCAnJyk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbmFtZSA9IGJhc2VQYXJ0cy5jb25jYXQobmFtZSk7CgogICAgICAgICAgICAgICAgLy9zdGFydCB0cmltRG90cwogICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IG5hbWUubGVuZ3RoOyBpICs9IDEpIHsKICAgICAgICAgICAgICAgICAgICBwYXJ0ID0gbmFtZVtpXTsKICAgICAgICAgICAgICAgICAgICBpZiAocGFydCA9PT0gIi4iKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUuc3BsaWNlKGksIDEpOwogICAgICAgICAgICAgICAgICAgICAgICBpIC09IDE7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChwYXJ0ID09PSAiLi4iKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpID09PSAxICYmIChuYW1lWzJdID09PSAnLi4nIHx8IG5hbWVbMF0gPT09ICcuLicpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL0VuZCBvZiB0aGUgbGluZS4gS2VlcCBhdCBsZWFzdCBvbmUgbm9uLWRvdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9wYXRoIHNlZ21lbnQgYXQgdGhlIGZyb250IHNvIGl0IGNhbiBiZSBtYXBwZWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vY29ycmVjdGx5IHRvIGRpc2suIE90aGVyd2lzZSwgdGhlcmUgaXMgbGlrZWx5CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL25vIHBhdGggbWFwcGluZyBmb3IgYSBwYXRoIHN0YXJ0aW5nIHdpdGggJy4uJy4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vVGhpcyBjYW4gc3RpbGwgZmFpbCwgYnV0IGNhdGNoZXMgdGhlIG1vc3QgcmVhc29uYWJsZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy91c2VzIG9mIC4uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZS5zcGxpY2UoaSAtIDEsIDIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaSAtPSAyOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy9lbmQgdHJpbURvdHMKCiAgICAgICAgICAgICAgICBuYW1lID0gbmFtZS5qb2luKCIvIik7CiAgICAgICAgICAgIH0gZWxzZSBpZiAobmFtZS5pbmRleE9mKCcuLycpID09PSAwKSB7CiAgICAgICAgICAgICAgICAvLyBObyBiYXNlTmFtZSwgc28gdGhpcyBpcyBJRCBpcyByZXNvbHZlZCByZWxhdGl2ZQogICAgICAgICAgICAgICAgLy8gdG8gYmFzZVVybCwgcHVsbCBvZmYgdGhlIGxlYWRpbmcgZG90LgogICAgICAgICAgICAgICAgbmFtZSA9IG5hbWUuc3Vic3RyaW5nKDIpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvL0FwcGx5IG1hcCBjb25maWcgaWYgYXZhaWxhYmxlLgogICAgICAgIGlmICgoYmFzZVBhcnRzIHx8IHN0YXJNYXApICYmIG1hcCkgewogICAgICAgICAgICBuYW1lUGFydHMgPSBuYW1lLnNwbGl0KCcvJyk7CgogICAgICAgICAgICBmb3IgKGkgPSBuYW1lUGFydHMubGVuZ3RoOyBpID4gMDsgaSAtPSAxKSB7CiAgICAgICAgICAgICAgICBuYW1lU2VnbWVudCA9IG5hbWVQYXJ0cy5zbGljZSgwLCBpKS5qb2luKCIvIik7CgogICAgICAgICAgICAgICAgaWYgKGJhc2VQYXJ0cykgewogICAgICAgICAgICAgICAgICAgIC8vRmluZCB0aGUgbG9uZ2VzdCBiYXNlTmFtZSBzZWdtZW50IG1hdGNoIGluIHRoZSBjb25maWcuCiAgICAgICAgICAgICAgICAgICAgLy9TbywgZG8gam9pbnMgb24gdGhlIGJpZ2dlc3QgdG8gc21hbGxlc3QgbGVuZ3RocyBvZiBiYXNlUGFydHMuCiAgICAgICAgICAgICAgICAgICAgZm9yIChqID0gYmFzZVBhcnRzLmxlbmd0aDsgaiA+IDA7IGogLT0gMSkgewogICAgICAgICAgICAgICAgICAgICAgICBtYXBWYWx1ZSA9IG1hcFtiYXNlUGFydHMuc2xpY2UoMCwgaikuam9pbignLycpXTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vYmFzZU5hbWUgc2VnbWVudCBoYXMgIGNvbmZpZywgZmluZCBpZiBpdCBoYXMgb25lIGZvcgogICAgICAgICAgICAgICAgICAgICAgICAvL3RoaXMgbmFtZS4KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1hcFZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXBWYWx1ZSA9IG1hcFZhbHVlW25hbWVTZWdtZW50XTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtYXBWYWx1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vTWF0Y2gsIHVwZGF0ZSBuYW1lIHRvIHRoZSBuZXcgdmFsdWUuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm91bmRNYXAgPSBtYXBWYWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3VuZEkgPSBpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChmb3VuZE1hcCkgewogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vQ2hlY2sgZm9yIGEgc3RhciBtYXAgbWF0Y2gsIGJ1dCBqdXN0IGhvbGQgb24gdG8gaXQsCiAgICAgICAgICAgICAgICAvL2lmIHRoZXJlIGlzIGEgc2hvcnRlciBzZWdtZW50IG1hdGNoIGxhdGVyIGluIGEgbWF0Y2hpbmcKICAgICAgICAgICAgICAgIC8vY29uZmlnLCB0aGVuIGZhdm9yIG92ZXIgdGhpcyBzdGFyIG1hcC4KICAgICAgICAgICAgICAgIGlmICghZm91bmRTdGFyTWFwICYmIHN0YXJNYXAgJiYgc3Rhck1hcFtuYW1lU2VnbWVudF0pIHsKICAgICAgICAgICAgICAgICAgICBmb3VuZFN0YXJNYXAgPSBzdGFyTWFwW25hbWVTZWdtZW50XTsKICAgICAgICAgICAgICAgICAgICBzdGFySSA9IGk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICghZm91bmRNYXAgJiYgZm91bmRTdGFyTWFwKSB7CiAgICAgICAgICAgICAgICBmb3VuZE1hcCA9IGZvdW5kU3Rhck1hcDsKICAgICAgICAgICAgICAgIGZvdW5kSSA9IHN0YXJJOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZm91bmRNYXApIHsKICAgICAgICAgICAgICAgIG5hbWVQYXJ0cy5zcGxpY2UoMCwgZm91bmRJLCBmb3VuZE1hcCk7CiAgICAgICAgICAgICAgICBuYW1lID0gbmFtZVBhcnRzLmpvaW4oJy8nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG5hbWU7CiAgICB9CgogICAgZnVuY3Rpb24gbWFrZVJlcXVpcmUocmVsTmFtZSwgZm9yY2VTeW5jKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgLy9BIHZlcnNpb24gb2YgYSByZXF1aXJlIGZ1bmN0aW9uIHRoYXQgcGFzc2VzIGEgbW9kdWxlTmFtZQogICAgICAgICAgICAvL3ZhbHVlIGZvciBpdGVtcyB0aGF0IG1heSBuZWVkIHRvCiAgICAgICAgICAgIC8vbG9vayB1cCBwYXRocyByZWxhdGl2ZSB0byB0aGUgbW9kdWxlTmFtZQogICAgICAgICAgICByZXR1cm4gcmVxLmFwcGx5KHVuZGVmLCBhcHMuY2FsbChhcmd1bWVudHMsIDApLmNvbmNhdChbcmVsTmFtZSwgZm9yY2VTeW5jXSkpOwogICAgICAgIH07CiAgICB9CgogICAgZnVuY3Rpb24gbWFrZU5vcm1hbGl6ZShyZWxOYW1lKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChuYW1lKSB7CiAgICAgICAgICAgIHJldHVybiBub3JtYWxpemUobmFtZSwgcmVsTmFtZSk7CiAgICAgICAgfTsKICAgIH0KCiAgICBmdW5jdGlvbiBtYWtlTG9hZChkZXBOYW1lKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICh2YWx1ZSkgewogICAgICAgICAgICBkZWZpbmVkW2RlcE5hbWVdID0gdmFsdWU7CiAgICAgICAgfTsKICAgIH0KCiAgICBmdW5jdGlvbiBjYWxsRGVwKG5hbWUpIHsKICAgICAgICBpZiAoaGFzUHJvcCh3YWl0aW5nLCBuYW1lKSkgewogICAgICAgICAgICB2YXIgYXJncyA9IHdhaXRpbmdbbmFtZV07CiAgICAgICAgICAgIGRlbGV0ZSB3YWl0aW5nW25hbWVdOwogICAgICAgICAgICBkZWZpbmluZ1tuYW1lXSA9IHRydWU7CiAgICAgICAgICAgIG1haW4uYXBwbHkodW5kZWYsIGFyZ3MpOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFoYXNQcm9wKGRlZmluZWQsIG5hbWUpICYmICFoYXNQcm9wKGRlZmluaW5nLCBuYW1lKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vICcgKyBuYW1lKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGRlZmluZWRbbmFtZV07CiAgICB9CgogICAgLy9UdXJucyBhIHBsdWdpbiFyZXNvdXJjZSB0byBbcGx1Z2luLCByZXNvdXJjZV0KICAgIC8vd2l0aCB0aGUgcGx1Z2luIGJlaW5nIHVuZGVmaW5lZCBpZiB0aGUgbmFtZQogICAgLy9kaWQgbm90IGhhdmUgYSBwbHVnaW4gcHJlZml4LgogICAgZnVuY3Rpb24gc3BsaXRQcmVmaXgobmFtZSkgewogICAgICAgIHZhciBwcmVmaXgsCiAgICAgICAgICAgIGluZGV4ID0gbmFtZSA/IG5hbWUuaW5kZXhPZignIScpIDogLTE7CiAgICAgICAgaWYgKGluZGV4ID4gLTEpIHsKICAgICAgICAgICAgcHJlZml4ID0gbmFtZS5zdWJzdHJpbmcoMCwgaW5kZXgpOwogICAgICAgICAgICBuYW1lID0gbmFtZS5zdWJzdHJpbmcoaW5kZXggKyAxLCBuYW1lLmxlbmd0aCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBbcHJlZml4LCBuYW1lXTsKICAgIH0KCiAgICAvKioKICAgICAqIE1ha2VzIGEgbmFtZSBtYXAsIG5vcm1hbGl6aW5nIHRoZSBuYW1lLCBhbmQgdXNpbmcgYSBwbHVnaW4KICAgICAqIGZvciBub3JtYWxpemF0aW9uIGlmIG5lY2Vzc2FyeS4gR3JhYnMgYSByZWYgdG8gcGx1Z2luCiAgICAgKiB0b28sIGFzIGFuIG9wdGltaXphdGlvbi4KICAgICAqLwogICAgbWFrZU1hcCA9IGZ1bmN0aW9uIChuYW1lLCByZWxOYW1lKSB7CiAgICAgICAgdmFyIHBsdWdpbiwKICAgICAgICAgICAgcGFydHMgPSBzcGxpdFByZWZpeChuYW1lKSwKICAgICAgICAgICAgcHJlZml4ID0gcGFydHNbMF07CgogICAgICAgIG5hbWUgPSBwYXJ0c1sxXTsKCiAgICAgICAgaWYgKHByZWZpeCkgewogICAgICAgICAgICBwcmVmaXggPSBub3JtYWxpemUocHJlZml4LCByZWxOYW1lKTsKICAgICAgICAgICAgcGx1Z2luID0gY2FsbERlcChwcmVmaXgpOwogICAgICAgIH0KCiAgICAgICAgLy9Ob3JtYWxpemUgYWNjb3JkaW5nCiAgICAgICAgaWYgKHByZWZpeCkgewogICAgICAgICAgICBpZiAocGx1Z2luICYmIHBsdWdpbi5ub3JtYWxpemUpIHsKICAgICAgICAgICAgICAgIG5hbWUgPSBwbHVnaW4ubm9ybWFsaXplKG5hbWUsIG1ha2VOb3JtYWxpemUocmVsTmFtZSkpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbmFtZSA9IG5vcm1hbGl6ZShuYW1lLCByZWxOYW1lKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG5hbWUgPSBub3JtYWxpemUobmFtZSwgcmVsTmFtZSk7CiAgICAgICAgICAgIHBhcnRzID0gc3BsaXRQcmVmaXgobmFtZSk7CiAgICAgICAgICAgIHByZWZpeCA9IHBhcnRzWzBdOwogICAgICAgICAgICBuYW1lID0gcGFydHNbMV07CiAgICAgICAgICAgIGlmIChwcmVmaXgpIHsKICAgICAgICAgICAgICAgIHBsdWdpbiA9IGNhbGxEZXAocHJlZml4KTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy9Vc2luZyByaWRpY3Vsb3VzIHByb3BlcnR5IG5hbWVzIGZvciBzcGFjZSByZWFzb25zCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgZjogcHJlZml4ID8gcHJlZml4ICsgJyEnICsgbmFtZSA6IG5hbWUsIC8vZnVsbE5hbWUKICAgICAgICAgICAgbjogbmFtZSwKICAgICAgICAgICAgcHI6IHByZWZpeCwKICAgICAgICAgICAgcDogcGx1Z2luCiAgICAgICAgfTsKICAgIH07CgogICAgZnVuY3Rpb24gbWFrZUNvbmZpZyhuYW1lKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIChjb25maWcgJiYgY29uZmlnLmNvbmZpZyAmJiBjb25maWcuY29uZmlnW25hbWVdKSB8fCB7fTsKICAgICAgICB9OwogICAgfQoKICAgIGhhbmRsZXJzID0gewogICAgICAgIHJlcXVpcmU6IGZ1bmN0aW9uIChuYW1lKSB7CiAgICAgICAgICAgIHJldHVybiBtYWtlUmVxdWlyZShuYW1lKTsKICAgICAgICB9LAogICAgICAgIGV4cG9ydHM6IGZ1bmN0aW9uIChuYW1lKSB7CiAgICAgICAgICAgIHZhciBlID0gZGVmaW5lZFtuYW1lXTsKICAgICAgICAgICAgaWYgKHR5cGVvZiBlICE9PSAndW5kZWZpbmVkJykgewogICAgICAgICAgICAgICAgcmV0dXJuIGU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gKGRlZmluZWRbbmFtZV0gPSB7fSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIG1vZHVsZTogZnVuY3Rpb24gKG5hbWUpIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIGlkOiBuYW1lLAogICAgICAgICAgICAgICAgdXJpOiAnJywKICAgICAgICAgICAgICAgIGV4cG9ydHM6IGRlZmluZWRbbmFtZV0sCiAgICAgICAgICAgICAgICBjb25maWc6IG1ha2VDb25maWcobmFtZSkKICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICB9OwoKICAgIG1haW4gPSBmdW5jdGlvbiAobmFtZSwgZGVwcywgY2FsbGJhY2ssIHJlbE5hbWUpIHsKICAgICAgICB2YXIgY2pzTW9kdWxlLCBkZXBOYW1lLCByZXQsIG1hcCwgaSwKICAgICAgICAgICAgYXJncyA9IFtdLAogICAgICAgICAgICBjYWxsYmFja1R5cGUgPSB0eXBlb2YgY2FsbGJhY2ssCiAgICAgICAgICAgIHVzaW5nRXhwb3J0czsKCiAgICAgICAgLy9Vc2UgbmFtZSBpZiBubyByZWxOYW1lCiAgICAgICAgcmVsTmFtZSA9IHJlbE5hbWUgfHwgbmFtZTsKCiAgICAgICAgLy9DYWxsIHRoZSBjYWxsYmFjayB0byBkZWZpbmUgdGhlIG1vZHVsZSwgaWYgbmVjZXNzYXJ5LgogICAgICAgIGlmIChjYWxsYmFja1R5cGUgPT09ICd1bmRlZmluZWQnIHx8IGNhbGxiYWNrVHlwZSA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICAvL1B1bGwgb3V0IHRoZSBkZWZpbmVkIGRlcGVuZGVuY2llcyBhbmQgcGFzcyB0aGUgb3JkZXJlZAogICAgICAgICAgICAvL3ZhbHVlcyB0byB0aGUgY2FsbGJhY2suCiAgICAgICAgICAgIC8vRGVmYXVsdCB0byBbcmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlXSBpZiBubyBkZXBzCiAgICAgICAgICAgIGRlcHMgPSAhZGVwcy5sZW5ndGggJiYgY2FsbGJhY2subGVuZ3RoID8gWydyZXF1aXJlJywgJ2V4cG9ydHMnLCAnbW9kdWxlJ10gOiBkZXBzOwogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgZGVwcy5sZW5ndGg7IGkgKz0gMSkgewogICAgICAgICAgICAgICAgbWFwID0gbWFrZU1hcChkZXBzW2ldLCByZWxOYW1lKTsKICAgICAgICAgICAgICAgIGRlcE5hbWUgPSBtYXAuZjsKCiAgICAgICAgICAgICAgICAvL0Zhc3QgcGF0aCBDb21tb25KUyBzdGFuZGFyZCBkZXBlbmRlbmNpZXMuCiAgICAgICAgICAgICAgICBpZiAoZGVwTmFtZSA9PT0gInJlcXVpcmUiKSB7CiAgICAgICAgICAgICAgICAgICAgYXJnc1tpXSA9IGhhbmRsZXJzLnJlcXVpcmUobmFtZSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGRlcE5hbWUgPT09ICJleHBvcnRzIikgewogICAgICAgICAgICAgICAgICAgIC8vQ29tbW9uSlMgbW9kdWxlIHNwZWMgMS4xCiAgICAgICAgICAgICAgICAgICAgYXJnc1tpXSA9IGhhbmRsZXJzLmV4cG9ydHMobmFtZSk7CiAgICAgICAgICAgICAgICAgICAgdXNpbmdFeHBvcnRzID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZGVwTmFtZSA9PT0gIm1vZHVsZSIpIHsKICAgICAgICAgICAgICAgICAgICAvL0NvbW1vbkpTIG1vZHVsZSBzcGVjIDEuMQogICAgICAgICAgICAgICAgICAgIGNqc01vZHVsZSA9IGFyZ3NbaV0gPSBoYW5kbGVycy5tb2R1bGUobmFtZSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGhhc1Byb3AoZGVmaW5lZCwgZGVwTmFtZSkgfHwKICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFzUHJvcCh3YWl0aW5nLCBkZXBOYW1lKSB8fAogICAgICAgICAgICAgICAgICAgICAgICAgICBoYXNQcm9wKGRlZmluaW5nLCBkZXBOYW1lKSkgewogICAgICAgICAgICAgICAgICAgIGFyZ3NbaV0gPSBjYWxsRGVwKGRlcE5hbWUpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChtYXAucCkgewogICAgICAgICAgICAgICAgICAgIG1hcC5wLmxvYWQobWFwLm4sIG1ha2VSZXF1aXJlKHJlbE5hbWUsIHRydWUpLCBtYWtlTG9hZChkZXBOYW1lKSwge30pOwogICAgICAgICAgICAgICAgICAgIGFyZ3NbaV0gPSBkZWZpbmVkW2RlcE5hbWVdOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IobmFtZSArICcgbWlzc2luZyAnICsgZGVwTmFtZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldCA9IGNhbGxiYWNrID8gY2FsbGJhY2suYXBwbHkoZGVmaW5lZFtuYW1lXSwgYXJncykgOiB1bmRlZmluZWQ7CgogICAgICAgICAgICBpZiAobmFtZSkgewogICAgICAgICAgICAgICAgLy9JZiBzZXR0aW5nIGV4cG9ydHMgdmlhICJtb2R1bGUiIGlzIGluIHBsYXksCiAgICAgICAgICAgICAgICAvL2Zhdm9yIHRoYXQgb3ZlciByZXR1cm4gdmFsdWUgYW5kIGV4cG9ydHMuIEFmdGVyIHRoYXQsCiAgICAgICAgICAgICAgICAvL2Zhdm9yIGEgbm9uLXVuZGVmaW5lZCByZXR1cm4gdmFsdWUgb3ZlciBleHBvcnRzIHVzZS4KICAgICAgICAgICAgICAgIGlmIChjanNNb2R1bGUgJiYgY2pzTW9kdWxlLmV4cG9ydHMgIT09IHVuZGVmICYmCiAgICAgICAgICAgICAgICAgICAgICAgIGNqc01vZHVsZS5leHBvcnRzICE9PSBkZWZpbmVkW25hbWVdKSB7CiAgICAgICAgICAgICAgICAgICAgZGVmaW5lZFtuYW1lXSA9IGNqc01vZHVsZS5leHBvcnRzOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXQgIT09IHVuZGVmIHx8ICF1c2luZ0V4cG9ydHMpIHsKICAgICAgICAgICAgICAgICAgICAvL1VzZSB0aGUgcmV0dXJuIHZhbHVlIGZyb20gdGhlIGZ1bmN0aW9uLgogICAgICAgICAgICAgICAgICAgIGRlZmluZWRbbmFtZV0gPSByZXQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKG5hbWUpIHsKICAgICAgICAgICAgLy9NYXkganVzdCBiZSBhbiBvYmplY3QgZGVmaW5pdGlvbiBmb3IgdGhlIG1vZHVsZS4gT25seQogICAgICAgICAgICAvL3dvcnJ5IGFib3V0IGRlZmluaW5nIGlmIGhhdmUgYSBtb2R1bGUgbmFtZS4KICAgICAgICAgICAgZGVmaW5lZFtuYW1lXSA9IGNhbGxiYWNrOwogICAgICAgIH0KICAgIH07CgogICAgcmVxdWlyZWpzID0gcmVxdWlyZSA9IHJlcSA9IGZ1bmN0aW9uIChkZXBzLCBjYWxsYmFjaywgcmVsTmFtZSwgZm9yY2VTeW5jLCBhbHQpIHsKICAgICAgICBpZiAodHlwZW9mIGRlcHMgPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgIGlmIChoYW5kbGVyc1tkZXBzXSkgewogICAgICAgICAgICAgICAgLy9jYWxsYmFjayBpbiB0aGlzIGNhc2UgaXMgcmVhbGx5IHJlbE5hbWUKICAgICAgICAgICAgICAgIHJldHVybiBoYW5kbGVyc1tkZXBzXShjYWxsYmFjayk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy9KdXN0IHJldHVybiB0aGUgbW9kdWxlIHdhbnRlZC4gSW4gdGhpcyBzY2VuYXJpbywgdGhlCiAgICAgICAgICAgIC8vZGVwcyBhcmcgaXMgdGhlIG1vZHVsZSBuYW1lLCBhbmQgc2Vjb25kIGFyZyAoaWYgcGFzc2VkKQogICAgICAgICAgICAvL2lzIGp1c3QgdGhlIHJlbE5hbWUuCiAgICAgICAgICAgIC8vTm9ybWFsaXplIG1vZHVsZSBuYW1lLCBpZiBpdCBjb250YWlucyAuIG9yIC4uCiAgICAgICAgICAgIHJldHVybiBjYWxsRGVwKG1ha2VNYXAoZGVwcywgY2FsbGJhY2spLmYpOwogICAgICAgIH0gZWxzZSBpZiAoIWRlcHMuc3BsaWNlKSB7CiAgICAgICAgICAgIC8vZGVwcyBpcyBhIGNvbmZpZyBvYmplY3QsIG5vdCBhbiBhcnJheS4KICAgICAgICAgICAgY29uZmlnID0gZGVwczsKICAgICAgICAgICAgaWYgKGNvbmZpZy5kZXBzKSB7CiAgICAgICAgICAgICAgICByZXEoY29uZmlnLmRlcHMsIGNvbmZpZy5jYWxsYmFjayk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCFjYWxsYmFjaykgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoY2FsbGJhY2suc3BsaWNlKSB7CiAgICAgICAgICAgICAgICAvL2NhbGxiYWNrIGlzIGFuIGFycmF5LCB3aGljaCBtZWFucyBpdCBpcyBhIGRlcGVuZGVuY3kgbGlzdC4KICAgICAgICAgICAgICAgIC8vQWRqdXN0IGFyZ3MgaWYgdGhlcmUgYXJlIGRlcGVuZGVuY2llcwogICAgICAgICAgICAgICAgZGVwcyA9IGNhbGxiYWNrOwogICAgICAgICAgICAgICAgY2FsbGJhY2sgPSByZWxOYW1lOwogICAgICAgICAgICAgICAgcmVsTmFtZSA9IG51bGw7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBkZXBzID0gdW5kZWY7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vU3VwcG9ydCByZXF1aXJlKFsnYSddKQogICAgICAgIGNhbGxiYWNrID0gY2FsbGJhY2sgfHwgZnVuY3Rpb24gKCkge307CgogICAgICAgIC8vSWYgcmVsTmFtZSBpcyBhIGZ1bmN0aW9uLCBpdCBpcyBhbiBlcnJiYWNrIGhhbmRsZXIsCiAgICAgICAgLy9zbyByZW1vdmUgaXQuCiAgICAgICAgaWYgKHR5cGVvZiByZWxOYW1lID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgIHJlbE5hbWUgPSBmb3JjZVN5bmM7CiAgICAgICAgICAgIGZvcmNlU3luYyA9IGFsdDsKICAgICAgICB9CgogICAgICAgIC8vU2ltdWxhdGUgYXN5bmMgY2FsbGJhY2s7CiAgICAgICAgaWYgKGZvcmNlU3luYykgewogICAgICAgICAgICBtYWluKHVuZGVmLCBkZXBzLCBjYWxsYmFjaywgcmVsTmFtZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy9Vc2luZyBhIG5vbi16ZXJvIHZhbHVlIGJlY2F1c2Ugb2YgY29uY2VybiBmb3Igd2hhdCBvbGQgYnJvd3NlcnMKICAgICAgICAgICAgLy9kbywgYW5kIGxhdGVzdCBicm93c2VycyAidXBncmFkZSIgdG8gNCBpZiBsb3dlciB2YWx1ZSBpcyB1c2VkOgogICAgICAgICAgICAvL2h0dHA6Ly93d3cud2hhdHdnLm9yZy9zcGVjcy93ZWItYXBwcy9jdXJyZW50LXdvcmsvbXVsdGlwYWdlL3RpbWVycy5odG1sI2RvbS13aW5kb3d0aW1lcnMtc2V0dGltZW91dDoKICAgICAgICAgICAgLy9JZiB3YW50IGEgdmFsdWUgaW1tZWRpYXRlbHksIHVzZSByZXF1aXJlKCdpZCcpIGluc3RlYWQgLS0gc29tZXRoaW5nCiAgICAgICAgICAgIC8vdGhhdCB3b3JrcyBpbiBhbG1vbmQgb24gdGhlIGdsb2JhbCBsZXZlbCwgYnV0IG5vdCBndWFyYW50ZWVkIGFuZAogICAgICAgICAgICAvL3VubGlrZWx5IHRvIHdvcmsgaW4gb3RoZXIgQU1EIGltcGxlbWVudGF0aW9ucy4KICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBtYWluKHVuZGVmLCBkZXBzLCBjYWxsYmFjaywgcmVsTmFtZSk7CiAgICAgICAgICAgIH0sIDQpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHJlcTsKICAgIH07CgogICAgLyoqCiAgICAgKiBKdXN0IGRyb3BzIHRoZSBjb25maWcgb24gdGhlIGZsb29yLCBidXQgcmV0dXJucyByZXEgaW4gY2FzZQogICAgICogdGhlIGNvbmZpZyByZXR1cm4gdmFsdWUgaXMgdXNlZC4KICAgICAqLwogICAgcmVxLmNvbmZpZyA9IGZ1bmN0aW9uIChjZmcpIHsKICAgICAgICByZXR1cm4gcmVxKGNmZyk7CiAgICB9OwoKICAgIC8qKgogICAgICogRXhwb3NlIG1vZHVsZSByZWdpc3RyeSBmb3IgZGVidWdnaW5nIGFuZCB0b29saW5nCiAgICAgKi8KICAgIHJlcXVpcmVqcy5fZGVmaW5lZCA9IGRlZmluZWQ7CgogICAgZGVmaW5lID0gZnVuY3Rpb24gKG5hbWUsIGRlcHMsIGNhbGxiYWNrKSB7CgogICAgICAgIC8vVGhpcyBtb2R1bGUgbWF5IG5vdCBoYXZlIGRlcGVuZGVuY2llcwogICAgICAgIGlmICghZGVwcy5zcGxpY2UpIHsKICAgICAgICAgICAgLy9kZXBzIGlzIG5vdCBhbiBhcnJheSwgc28gcHJvYmFibHkgbWVhbnMKICAgICAgICAgICAgLy9hbiBvYmplY3QgbGl0ZXJhbCBvciBmYWN0b3J5IGZ1bmN0aW9uIGZvcgogICAgICAgICAgICAvL3RoZSB2YWx1ZS4gQWRqdXN0IGFyZ3MuCiAgICAgICAgICAgIGNhbGxiYWNrID0gZGVwczsKICAgICAgICAgICAgZGVwcyA9IFtdOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFoYXNQcm9wKGRlZmluZWQsIG5hbWUpICYmICFoYXNQcm9wKHdhaXRpbmcsIG5hbWUpKSB7CiAgICAgICAgICAgIHdhaXRpbmdbbmFtZV0gPSBbbmFtZSwgZGVwcywgY2FsbGJhY2tdOwogICAgICAgIH0KICAgIH07CgogICAgZGVmaW5lLmFtZCA9IHsKICAgICAgICBqUXVlcnk6IHRydWUKICAgIH07Cn0oKSk7CgpkZWZpbmUoImNvbXBvbmVudHMvYWxtb25kL2FsbW9uZC5qcyIsIGZ1bmN0aW9uKCl7fSk7CgpkZWZpbmUoJ2pxdWVyeScsIFtdLCBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4galF1ZXJ5Owp9KTsKCmRlZmluZSgnanF1ZXJ5LXByaXZhdGUnLFsnanF1ZXJ5J10sIGZ1bmN0aW9uIChqcSkgewogICAgcmV0dXJuIGpxOwp9KTsKCmRlZmluZSgndXRpbHMnLFsianF1ZXJ5Il0sIGZ1bmN0aW9uICgkKSB7CiAgICAkLmZuLmhhc1Njcm9sbEJhciA9IGZ1bmN0aW9uKCkgewogICAgICAgIGlmICghJC5jb250YWlucyhkb2N1bWVudCwgdGhpcy5nZXQoMCkpKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYodGhpcy5wYXJlbnQoKS5oZWlnaHQoKSA8IHRoaXMuZ2V0KDApLnNjcm9sbEhlaWdodCkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfTsKCiAgICAkLmZuLmFkZEh5cGVybGlua3MgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKHRoaXMubGVuZ3RoID4gMCkgewogICAgICAgICAgICB0aGlzLmVhY2goZnVuY3Rpb24gKGksIG9iaikgewogICAgICAgICAgICAgICAgdmFyIHggPSAkKG9iaikuaHRtbCgpOwogICAgICAgICAgICAgICAgdmFyIGxpc3QgPSB4Lm1hdGNoKC9cYihodHRwcz86XC9cL3x3d3dcLnxodHRwcz86XC9cL3d3d1wuKVteXHM8XXsyLDIwMH1cYi9nICk7CiAgICAgICAgICAgICAgICBpZiAobGlzdCkgewogICAgICAgICAgICAgICAgICAgIGZvciAoaT0wOyBpPGxpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHByb3QgPSBsaXN0W2ldLmluZGV4T2YoJ2h0dHA6Ly8nKSA9PT0gMCB8fCBsaXN0W2ldLmluZGV4T2YoJ2h0dHBzOi8vJykgPT09IDAgPyAnJyA6ICdodHRwOi8vJzsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVzY2FwZWRfdXJsID0gZW5jb2RlVVJJKGRlY29kZVVSSShsaXN0W2ldKSkucmVwbGFjZSgvWyEnKCldL2csIGVzY2FwZSkucmVwbGFjZSgvXCovZywgIiUyQSIpOwogICAgICAgICAgICAgICAgICAgICAgICB4ID0geC5yZXBsYWNlKGxpc3RbaV0sICI8YSB0YXJnZXQ9J19ibGFuaycgaHJlZj0nIiArIHByb3QgKyBlc2NhcGVkX3VybCArICInPiIrIGxpc3RbaV0gKyAiPC9hPiIgKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkKG9iaikuaHRtbCh4KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzOwogICAgfTsKCiAgICB2YXIgdXRpbHMgPSB7CiAgICAgICAgLy8gVHJhbnNsYXRpb24gbWFjaGluZXJ5CiAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgICAgX186IGZ1bmN0aW9uIChzdHIpIHsKICAgICAgICAgICAgLy8gVHJhbnNsYXRpb24gZmFjdG9yeQogICAgICAgICAgICBpZiAodGhpcy5pMThuID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIHRoaXMuaTE4biA9IGxvY2FsZXMuZW47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIHQgPSB0aGlzLmkxOG4udHJhbnNsYXRlKHN0cik7CiAgICAgICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoPjEpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0LmZldGNoLmFwcGx5KHQsIFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzLDEpKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiB0LmZldGNoKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAoKICAgICAgICBfX186IGZ1bmN0aW9uIChzdHIpIHsKICAgICAgICAgICAgLyogWFhYOiBUaGlzIGlzIHBhcnQgb2YgYSBoYWNrIHRvIGdldCBnZXR0ZXh0IHRvIHNjYW4gc3RyaW5ncyB0byBiZQogICAgICAgICAgICAgICAgKiB0cmFuc2xhdGVkLiBTdHJpbmdzIHdlIGNhbm5vdCBzZW5kIHRvIHRoZSBmdW5jdGlvbiBhYm92ZSBiZWNhdXNlCiAgICAgICAgICAgICAgICAqIHRoZXkgcmVxdWlyZSB2YXJpYWJsZSBpbnRlcnBvbGF0aW9uIGFuZCB3ZSBkb24ndCB5ZXQgaGF2ZSB0aGUKICAgICAgICAgICAgICAgICogdmFyaWFibGVzIGF0IHNjYW4gdGltZS4KICAgICAgICAgICAgICAgICoKICAgICAgICAgICAgICAgICogU2VlIGFjdGlvbkluZm9NZXNzYWdlcwogICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgcmV0dXJuIHN0cjsKICAgICAgICB9CiAgICB9OwogICAgcmV0dXJuIHV0aWxzOwp9KTsKCi8qIQogKiBqUXVlcnkgQnJvd3NlciBQbHVnaW4gdjAuMC42CiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9nYWJjZWIvanF1ZXJ5LWJyb3dzZXItcGx1Z2luCiAqCiAqIE9yaWdpbmFsIGpxdWVyeS1icm93c2VyIGNvZGUgQ29weXJpZ2h0IDIwMDUsIDIwMTMgalF1ZXJ5IEZvdW5kYXRpb24sIEluYy4gYW5kIG90aGVyIGNvbnRyaWJ1dG9ycwogKiBodHRwOi8vanF1ZXJ5Lm9yZy9saWNlbnNlCiAqCiAqIE1vZGlmaWNhdGlvbnMgQ29weXJpZ2h0IDIwMTMgR2FicmllbCBDZWJyaWFuCiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9nYWJjZWIKICoKICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlCiAqCiAqIERhdGU6IDIwMTMtMDctMjlUMTc6MjM6MjctMDc6MDAKICovCgooZnVuY3Rpb24gKHJvb3QsIGZhY3RvcnkpIHsKICAgIGlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHsKICAgICAgICAvLyBBTUQuIFJlZ2lzdGVyIGFzIGFuIGFub255bW91cyBtb2R1bGUuCiAgICAgICAgZGVmaW5lKCdqcXVlcnkuYnJvd3NlcicsWydqcXVlcnknXSwgZnVuY3Rpb24gKCQpIHsKICAgICAgICAgICAgZmFjdG9yeSgkLCByb290KTsKICAgICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgICAgLy8gQnJvd3NlciBnbG9iYWxzCiAgICAgICAgZmFjdG9yeShqUXVlcnksIHJvb3QpOwogICAgfQp9KHRoaXMsIGZ1bmN0aW9uKGpRdWVyeSwgd2luZG93KSB7CiAgCgogIHZhciBtYXRjaGVkLCBicm93c2VyOwoKICBqUXVlcnkudWFNYXRjaCA9IGZ1bmN0aW9uKCB1YSApIHsKICAgIHVhID0gdWEudG9Mb3dlckNhc2UoKTsKCiAgCXZhciBtYXRjaCA9IC8ob3ByKVtcL10oW1x3Ll0rKS8uZXhlYyggdWEgKSB8fAogIAkJLyhjaHJvbWUpWyBcL10oW1x3Ll0rKS8uZXhlYyggdWEgKSB8fAogIAkJLyh2ZXJzaW9uKVsgXC9dKFtcdy5dKykuKihzYWZhcmkpWyBcL10oW1x3Ll0rKS8uZXhlYyggdWEgKSB8fAogIAkJLyh3ZWJraXQpWyBcL10oW1x3Ll0rKS8uZXhlYyggdWEgKSB8fAogIAkJLyhvcGVyYSkoPzouKnZlcnNpb258KVsgXC9dKFtcdy5dKykvLmV4ZWMoIHVhICkgfHwKICAJCS8obXNpZSkgKFtcdy5dKykvLmV4ZWMoIHVhICkgfHwKICAJCXVhLmluZGV4T2YoInRyaWRlbnQiKSA+PSAwICYmIC8ocnYpKD86OnwgKShbXHcuXSspLy5leGVjKCB1YSApIHx8CiAgCQl1YS5pbmRleE9mKCJjb21wYXRpYmxlIikgPCAwICYmIC8obW96aWxsYSkoPzouKj8gcnY6KFtcdy5dKyl8KS8uZXhlYyggdWEgKSB8fAogIAkJW107CgogIAl2YXIgcGxhdGZvcm1fbWF0Y2ggPSAvKGlwYWQpLy5leGVjKCB1YSApIHx8CiAgCQkvKGlwaG9uZSkvLmV4ZWMoIHVhICkgfHwKICAJCS8oYW5kcm9pZCkvLmV4ZWMoIHVhICkgfHwKICAJCS8od2luZG93cyBwaG9uZSkvLmV4ZWMoIHVhICkgfHwKICAJCS8od2luKS8uZXhlYyggdWEgKSB8fAogIAkJLyhtYWMpLy5leGVjKCB1YSApIHx8CiAgCQkvKGxpbnV4KS8uZXhlYyggdWEgKSB8fAogIAkJLyhjcm9zKS9pLmV4ZWMoIHVhICkgfHwKICAJCVtdOwoKICAJcmV0dXJuIHsKICAJCWJyb3dzZXI6IG1hdGNoWyAzIF0gfHwgbWF0Y2hbIDEgXSB8fCAiIiwKICAJCXZlcnNpb246IG1hdGNoWyAyIF0gfHwgIjAiLAogIAkJcGxhdGZvcm06IHBsYXRmb3JtX21hdGNoWyAwIF0gfHwgIiIKICAJfTsKICB9OwoKICBtYXRjaGVkID0galF1ZXJ5LnVhTWF0Y2goIHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50ICk7CiAgYnJvd3NlciA9IHt9OwoKICBpZiAoIG1hdGNoZWQuYnJvd3NlciApIHsKICAJYnJvd3NlclsgbWF0Y2hlZC5icm93c2VyIF0gPSB0cnVlOwogIAlicm93c2VyLnZlcnNpb24gPSBtYXRjaGVkLnZlcnNpb247CiAgCWJyb3dzZXIudmVyc2lvbk51bWJlciA9IHBhcnNlSW50KG1hdGNoZWQudmVyc2lvbik7CiAgfQoKICBpZiAoIG1hdGNoZWQucGxhdGZvcm0gKSB7CiAgCWJyb3dzZXJbIG1hdGNoZWQucGxhdGZvcm0gXSA9IHRydWU7CiAgfQoKICAvLyBUaGVzZSBhcmUgYWxsIGNvbnNpZGVyZWQgbW9iaWxlIHBsYXRmb3JtcywgbWVhbmluZyB0aGV5IHJ1biBhIG1vYmlsZSBicm93c2VyCiAgaWYgKCBicm93c2VyLmFuZHJvaWQgfHwgYnJvd3Nlci5pcGFkIHx8IGJyb3dzZXIuaXBob25lIHx8IGJyb3dzZXJbICJ3aW5kb3dzIHBob25lIiBdICkgewogIAlicm93c2VyLm1vYmlsZSA9IHRydWU7CiAgfQoKICAvLyBUaGVzZSBhcmUgYWxsIGNvbnNpZGVyZWQgZGVza3RvcCBwbGF0Zm9ybXMsIG1lYW5pbmcgdGhleSBydW4gYSBkZXNrdG9wIGJyb3dzZXIKICBpZiAoIGJyb3dzZXIuY3JvcyB8fCBicm93c2VyLm1hYyB8fCBicm93c2VyLmxpbnV4IHx8IGJyb3dzZXIud2luICkgewogIAlicm93c2VyLmRlc2t0b3AgPSB0cnVlOwogIH0KCiAgLy8gQ2hyb21lLCBPcGVyYSAxNSsgYW5kIFNhZmFyaSBhcmUgd2Via2l0IGJhc2VkIGJyb3dzZXJzCiAgaWYgKCBicm93c2VyLmNocm9tZSB8fCBicm93c2VyLm9wciB8fCBicm93c2VyLnNhZmFyaSApIHsKICAJYnJvd3Nlci53ZWJraXQgPSB0cnVlOwogIH0KCiAgLy8gSUUxMSBoYXMgYSBuZXcgdG9rZW4gc28gd2Ugd2lsbCBhc3NpZ24gaXQgbXNpZSB0byBhdm9pZCBicmVha2luZyBjaGFuZ2VzCiAgaWYgKCBicm93c2VyLnJ2ICkKICB7CiAgCXZhciBpZSA9ICJtc2llIjsKCiAgCW1hdGNoZWQuYnJvd3NlciA9IGllOwogIAlicm93c2VyW2llXSA9IHRydWU7CiAgfQoKICAvLyBPcGVyYSAxNSsgYXJlIGlkZW50aWZpZWQgYXMgb3ByCiAgaWYgKCBicm93c2VyLm9wciApCiAgewogIAl2YXIgb3BlcmEgPSAib3BlcmEiOwoKICAJbWF0Y2hlZC5icm93c2VyID0gb3BlcmE7CiAgCWJyb3dzZXJbb3BlcmFdID0gdHJ1ZTsKICB9CgogIC8vIFN0b2NrIEFuZHJvaWQgYnJvd3NlcnMgYXJlIG1hcmtlZCBhcyBTYWZhcmkgb24gQW5kcm9pZC4KICBpZiAoIGJyb3dzZXIuc2FmYXJpICYmIGJyb3dzZXIuYW5kcm9pZCApCiAgewogIAl2YXIgYW5kcm9pZCA9ICJhbmRyb2lkIjsKCiAgCW1hdGNoZWQuYnJvd3NlciA9IGFuZHJvaWQ7CiAgCWJyb3dzZXJbYW5kcm9pZF0gPSB0cnVlOwogIH0KCiAgLy8gQXNzaWduIHRoZSBuYW1lIGFuZCBwbGF0Zm9ybSB2YXJpYWJsZQogIGJyb3dzZXIubmFtZSA9IG1hdGNoZWQuYnJvd3NlcjsKICBicm93c2VyLnBsYXRmb3JtID0gbWF0Y2hlZC5wbGF0Zm9ybTsKCiAgalF1ZXJ5LmJyb3dzZXIgPSBicm93c2VyOwogIHJldHVybiBicm93c2VyOwp9KSk7CgovKgpDcnlwdG9KUyB2My4xLjIKY29kZS5nb29nbGUuY29tL3AvY3J5cHRvLWpzCihjKSAyMDA5LTIwMTMgYnkgSmVmZiBNb3R0LiBBbGwgcmlnaHRzIHJlc2VydmVkLgpjb2RlLmdvb2dsZS5jb20vcC9jcnlwdG8tanMvd2lraS9MaWNlbnNlCiovCi8qKg0KICogQ3J5cHRvSlMgY29yZSBjb21wb25lbnRzLg0KICovDQp2YXIgQ3J5cHRvSlMgPSBDcnlwdG9KUyB8fCAoZnVuY3Rpb24gKE1hdGgsIHVuZGVmaW5lZCkgew0KICAgIC8qKg0KICAgICAqIENyeXB0b0pTIG5hbWVzcGFjZS4NCiAgICAgKi8NCiAgICB2YXIgQyA9IHt9Ow0KDQogICAgLyoqDQogICAgICogTGlicmFyeSBuYW1lc3BhY2UuDQogICAgICovDQogICAgdmFyIENfbGliID0gQy5saWIgPSB7fTsNCg0KICAgIC8qKg0KICAgICAqIEJhc2Ugb2JqZWN0IGZvciBwcm90b3R5cGFsIGluaGVyaXRhbmNlLg0KICAgICAqLw0KICAgIHZhciBCYXNlID0gQ19saWIuQmFzZSA9IChmdW5jdGlvbiAoKSB7DQogICAgICAgIGZ1bmN0aW9uIEYoKSB7fQ0KDQogICAgICAgIHJldHVybiB7DQogICAgICAgICAgICAvKioNCiAgICAgICAgICAgICAqIENyZWF0ZXMgYSBuZXcgb2JqZWN0IHRoYXQgaW5oZXJpdHMgZnJvbSB0aGlzIG9iamVjdC4NCiAgICAgICAgICAgICAqDQogICAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gb3ZlcnJpZGVzIFByb3BlcnRpZXMgdG8gY29weSBpbnRvIHRoZSBuZXcgb2JqZWN0Lg0KICAgICAgICAgICAgICoNCiAgICAgICAgICAgICAqIEByZXR1cm4ge09iamVjdH0gVGhlIG5ldyBvYmplY3QuDQogICAgICAgICAgICAgKg0KICAgICAgICAgICAgICogQHN0YXRpYw0KICAgICAgICAgICAgICoNCiAgICAgICAgICAgICAqIEBleGFtcGxlDQogICAgICAgICAgICAgKg0KICAgICAgICAgICAgICogICAgIHZhciBNeVR5cGUgPSBDcnlwdG9KUy5saWIuQmFzZS5leHRlbmQoew0KICAgICAgICAgICAgICogICAgICAgICBmaWVsZDogJ3ZhbHVlJywNCiAgICAgICAgICAgICAqDQogICAgICAgICAgICAgKiAgICAgICAgIG1ldGhvZDogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICogICAgICAgICB9DQogICAgICAgICAgICAgKiAgICAgfSk7DQogICAgICAgICAgICAgKi8NCiAgICAgICAgICAgIGV4dGVuZDogZnVuY3Rpb24gKG92ZXJyaWRlcykgew0KICAgICAgICAgICAgICAgIC8vIFNwYXduDQogICAgICAgICAgICAgICAgRi5wcm90b3R5cGUgPSB0aGlzOw0KICAgICAgICAgICAgICAgIHZhciBzdWJ0eXBlID0gbmV3IEYoKTsNCg0KICAgICAgICAgICAgICAgIC8vIEF1Z21lbnQNCiAgICAgICAgICAgICAgICBpZiAob3ZlcnJpZGVzKSB7DQogICAgICAgICAgICAgICAgICAgIHN1YnR5cGUubWl4SW4ob3ZlcnJpZGVzKTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAvLyBDcmVhdGUgZGVmYXVsdCBpbml0aWFsaXplcg0KICAgICAgICAgICAgICAgIGlmICghc3VidHlwZS5oYXNPd25Qcm9wZXJ0eSgnaW5pdCcpKSB7DQogICAgICAgICAgICAgICAgICAgIHN1YnR5cGUuaW5pdCA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHN1YnR5cGUuJHN1cGVyLmluaXQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsNCiAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAvLyBJbml0aWFsaXplcidzIHByb3RvdHlwZSBpcyB0aGUgc3VidHlwZSBvYmplY3QNCiAgICAgICAgICAgICAgICBzdWJ0eXBlLmluaXQucHJvdG90eXBlID0gc3VidHlwZTsNCg0KICAgICAgICAgICAgICAgIC8vIFJlZmVyZW5jZSBzdXBlcnR5cGUNCiAgICAgICAgICAgICAgICBzdWJ0eXBlLiRzdXBlciA9IHRoaXM7DQoNCiAgICAgICAgICAgICAgICByZXR1cm4gc3VidHlwZTsNCiAgICAgICAgICAgIH0sDQoNCiAgICAgICAgICAgIC8qKg0KICAgICAgICAgICAgICogRXh0ZW5kcyB0aGlzIG9iamVjdCBhbmQgcnVucyB0aGUgaW5pdCBtZXRob2QuDQogICAgICAgICAgICAgKiBBcmd1bWVudHMgdG8gY3JlYXRlKCkgd2lsbCBiZSBwYXNzZWQgdG8gaW5pdCgpLg0KICAgICAgICAgICAgICoNCiAgICAgICAgICAgICAqIEByZXR1cm4ge09iamVjdH0gVGhlIG5ldyBvYmplY3QuDQogICAgICAgICAgICAgKg0KICAgICAgICAgICAgICogQHN0YXRpYw0KICAgICAgICAgICAgICoNCiAgICAgICAgICAgICAqIEBleGFtcGxlDQogICAgICAgICAgICAgKg0KICAgICAgICAgICAgICogICAgIHZhciBpbnN0YW5jZSA9IE15VHlwZS5jcmVhdGUoKTsNCiAgICAgICAgICAgICAqLw0KICAgICAgICAgICAgY3JlYXRlOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgdmFyIGluc3RhbmNlID0gdGhpcy5leHRlbmQoKTsNCiAgICAgICAgICAgICAgICBpbnN0YW5jZS5pbml0LmFwcGx5KGluc3RhbmNlLCBhcmd1bWVudHMpOw0KDQogICAgICAgICAgICAgICAgcmV0dXJuIGluc3RhbmNlOw0KICAgICAgICAgICAgfSwNCg0KICAgICAgICAgICAgLyoqDQogICAgICAgICAgICAgKiBJbml0aWFsaXplcyBhIG5ld2x5IGNyZWF0ZWQgb2JqZWN0Lg0KICAgICAgICAgICAgICogT3ZlcnJpZGUgdGhpcyBtZXRob2QgdG8gYWRkIHNvbWUgbG9naWMgd2hlbiB5b3VyIG9iamVjdHMgYXJlIGNyZWF0ZWQuDQogICAgICAgICAgICAgKg0KICAgICAgICAgICAgICogQGV4YW1wbGUNCiAgICAgICAgICAgICAqDQogICAgICAgICAgICAgKiAgICAgdmFyIE15VHlwZSA9IENyeXB0b0pTLmxpYi5CYXNlLmV4dGVuZCh7DQogICAgICAgICAgICAgKiAgICAgICAgIGluaXQ6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAqICAgICAgICAgICAgIC8vIC4uLg0KICAgICAgICAgICAgICogICAgICAgICB9DQogICAgICAgICAgICAgKiAgICAgfSk7DQogICAgICAgICAgICAgKi8NCiAgICAgICAgICAgIGluaXQ6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIH0sDQoNCiAgICAgICAgICAgIC8qKg0KICAgICAgICAgICAgICogQ29waWVzIHByb3BlcnRpZXMgaW50byB0aGlzIG9iamVjdC4NCiAgICAgICAgICAgICAqDQogICAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gcHJvcGVydGllcyBUaGUgcHJvcGVydGllcyB0byBtaXggaW4uDQogICAgICAgICAgICAgKg0KICAgICAgICAgICAgICogQGV4YW1wbGUNCiAgICAgICAgICAgICAqDQogICAgICAgICAgICAgKiAgICAgTXlUeXBlLm1peEluKHsNCiAgICAgICAgICAgICAqICAgICAgICAgZmllbGQ6ICd2YWx1ZScNCiAgICAgICAgICAgICAqICAgICB9KTsNCiAgICAgICAgICAgICAqLw0KICAgICAgICAgICAgbWl4SW46IGZ1bmN0aW9uIChwcm9wZXJ0aWVzKSB7DQogICAgICAgICAgICAgICAgZm9yICh2YXIgcHJvcGVydHlOYW1lIGluIHByb3BlcnRpZXMpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHByb3BlcnRpZXMuaGFzT3duUHJvcGVydHkocHJvcGVydHlOYW1lKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpc1twcm9wZXJ0eU5hbWVdID0gcHJvcGVydGllc1twcm9wZXJ0eU5hbWVdOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgLy8gSUUgd29uJ3QgY29weSB0b1N0cmluZyB1c2luZyB0aGUgbG9vcCBhYm92ZQ0KICAgICAgICAgICAgICAgIGlmIChwcm9wZXJ0aWVzLmhhc093blByb3BlcnR5KCd0b1N0cmluZycpKSB7DQogICAgICAgICAgICAgICAgICAgIHRoaXMudG9TdHJpbmcgPSBwcm9wZXJ0aWVzLnRvU3RyaW5nOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0sDQoNCiAgICAgICAgICAgIC8qKg0KICAgICAgICAgICAgICogQ3JlYXRlcyBhIGNvcHkgb2YgdGhpcyBvYmplY3QuDQogICAgICAgICAgICAgKg0KICAgICAgICAgICAgICogQHJldHVybiB7T2JqZWN0fSBUaGUgY2xvbmUuDQogICAgICAgICAgICAgKg0KICAgICAgICAgICAgICogQGV4YW1wbGUNCiAgICAgICAgICAgICAqDQogICAgICAgICAgICAgKiAgICAgdmFyIGNsb25lID0gaW5zdGFuY2UuY2xvbmUoKTsNCiAgICAgICAgICAgICAqLw0KICAgICAgICAgICAgY2xvbmU6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5pbml0LnByb3RvdHlwZS5leHRlbmQodGhpcyk7DQogICAgICAgICAgICB9DQogICAgICAgIH07DQogICAgfSgpKTsNCg0KICAgIC8qKg0KICAgICAqIEFuIGFycmF5IG9mIDMyLWJpdCB3b3Jkcy4NCiAgICAgKg0KICAgICAqIEBwcm9wZXJ0eSB7QXJyYXl9IHdvcmRzIFRoZSBhcnJheSBvZiAzMi1iaXQgd29yZHMuDQogICAgICogQHByb3BlcnR5IHtudW1iZXJ9IHNpZ0J5dGVzIFRoZSBudW1iZXIgb2Ygc2lnbmlmaWNhbnQgYnl0ZXMgaW4gdGhpcyB3b3JkIGFycmF5Lg0KICAgICAqLw0KICAgIHZhciBXb3JkQXJyYXkgPSBDX2xpYi5Xb3JkQXJyYXkgPSBCYXNlLmV4dGVuZCh7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBJbml0aWFsaXplcyBhIG5ld2x5IGNyZWF0ZWQgd29yZCBhcnJheS4NCiAgICAgICAgICoNCiAgICAgICAgICogQHBhcmFtIHtBcnJheX0gd29yZHMgKE9wdGlvbmFsKSBBbiBhcnJheSBvZiAzMi1iaXQgd29yZHMuDQogICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSBzaWdCeXRlcyAoT3B0aW9uYWwpIFRoZSBudW1iZXIgb2Ygc2lnbmlmaWNhbnQgYnl0ZXMgaW4gdGhlIHdvcmRzLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICAgKg0KICAgICAgICAgKiAgICAgdmFyIHdvcmRBcnJheSA9IENyeXB0b0pTLmxpYi5Xb3JkQXJyYXkuY3JlYXRlKCk7DQogICAgICAgICAqICAgICB2YXIgd29yZEFycmF5ID0gQ3J5cHRvSlMubGliLldvcmRBcnJheS5jcmVhdGUoWzB4MDAwMTAyMDMsIDB4MDQwNTA2MDddKTsNCiAgICAgICAgICogICAgIHZhciB3b3JkQXJyYXkgPSBDcnlwdG9KUy5saWIuV29yZEFycmF5LmNyZWF0ZShbMHgwMDAxMDIwMywgMHgwNDA1MDYwN10sIDYpOw0KICAgICAgICAgKi8NCiAgICAgICAgaW5pdDogZnVuY3Rpb24gKHdvcmRzLCBzaWdCeXRlcykgew0KICAgICAgICAgICAgd29yZHMgPSB0aGlzLndvcmRzID0gd29yZHMgfHwgW107DQoNCiAgICAgICAgICAgIGlmIChzaWdCeXRlcyAhPSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgICAgICB0aGlzLnNpZ0J5dGVzID0gc2lnQnl0ZXM7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIHRoaXMuc2lnQnl0ZXMgPSB3b3Jkcy5sZW5ndGggKiA0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICB9LA0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBDb252ZXJ0cyB0aGlzIHdvcmQgYXJyYXkgdG8gYSBzdHJpbmcuDQogICAgICAgICAqDQogICAgICAgICAqIEBwYXJhbSB7RW5jb2Rlcn0gZW5jb2RlciAoT3B0aW9uYWwpIFRoZSBlbmNvZGluZyBzdHJhdGVneSB0byB1c2UuIERlZmF1bHQ6IENyeXB0b0pTLmVuYy5IZXgNCiAgICAgICAgICoNCiAgICAgICAgICogQHJldHVybiB7c3RyaW5nfSBUaGUgc3RyaW5naWZpZWQgd29yZCBhcnJheS4NCiAgICAgICAgICoNCiAgICAgICAgICogQGV4YW1wbGUNCiAgICAgICAgICoNCiAgICAgICAgICogICAgIHZhciBzdHJpbmcgPSB3b3JkQXJyYXkgKyAnJzsNCiAgICAgICAgICogICAgIHZhciBzdHJpbmcgPSB3b3JkQXJyYXkudG9TdHJpbmcoKTsNCiAgICAgICAgICogICAgIHZhciBzdHJpbmcgPSB3b3JkQXJyYXkudG9TdHJpbmcoQ3J5cHRvSlMuZW5jLlV0ZjgpOw0KICAgICAgICAgKi8NCiAgICAgICAgdG9TdHJpbmc6IGZ1bmN0aW9uIChlbmNvZGVyKSB7DQogICAgICAgICAgICByZXR1cm4gKGVuY29kZXIgfHwgSGV4KS5zdHJpbmdpZnkodGhpcyk7DQogICAgICAgIH0sDQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIENvbmNhdGVuYXRlcyBhIHdvcmQgYXJyYXkgdG8gdGhpcyB3b3JkIGFycmF5Lg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcGFyYW0ge1dvcmRBcnJheX0gd29yZEFycmF5IFRoZSB3b3JkIGFycmF5IHRvIGFwcGVuZC4NCiAgICAgICAgICoNCiAgICAgICAgICogQHJldHVybiB7V29yZEFycmF5fSBUaGlzIHdvcmQgYXJyYXkuDQogICAgICAgICAqDQogICAgICAgICAqIEBleGFtcGxlDQogICAgICAgICAqDQogICAgICAgICAqICAgICB3b3JkQXJyYXkxLmNvbmNhdCh3b3JkQXJyYXkyKTsNCiAgICAgICAgICovDQogICAgICAgIGNvbmNhdDogZnVuY3Rpb24gKHdvcmRBcnJheSkgew0KICAgICAgICAgICAgLy8gU2hvcnRjdXRzDQogICAgICAgICAgICB2YXIgdGhpc1dvcmRzID0gdGhpcy53b3JkczsNCiAgICAgICAgICAgIHZhciB0aGF0V29yZHMgPSB3b3JkQXJyYXkud29yZHM7DQogICAgICAgICAgICB2YXIgdGhpc1NpZ0J5dGVzID0gdGhpcy5zaWdCeXRlczsNCiAgICAgICAgICAgIHZhciB0aGF0U2lnQnl0ZXMgPSB3b3JkQXJyYXkuc2lnQnl0ZXM7DQoNCiAgICAgICAgICAgIC8vIENsYW1wIGV4Y2VzcyBiaXRzDQogICAgICAgICAgICB0aGlzLmNsYW1wKCk7DQoNCiAgICAgICAgICAgIC8vIENvbmNhdA0KICAgICAgICAgICAgaWYgKHRoaXNTaWdCeXRlcyAlIDQpIHsNCiAgICAgICAgICAgICAgICAvLyBDb3B5IG9uZSBieXRlIGF0IGEgdGltZQ0KICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhhdFNpZ0J5dGVzOyBpKyspIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIHRoYXRCeXRlID0gKHRoYXRXb3Jkc1tpID4+PiAyXSA+Pj4gKDI0IC0gKGkgJSA0KSAqIDgpKSAmIDB4ZmY7DQogICAgICAgICAgICAgICAgICAgIHRoaXNXb3Jkc1sodGhpc1NpZ0J5dGVzICsgaSkgPj4+IDJdIHw9IHRoYXRCeXRlIDw8ICgyNCAtICgodGhpc1NpZ0J5dGVzICsgaSkgJSA0KSAqIDgpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhhdFdvcmRzLmxlbmd0aCA+IDB4ZmZmZikgew0KICAgICAgICAgICAgICAgIC8vIENvcHkgb25lIHdvcmQgYXQgYSB0aW1lDQogICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGF0U2lnQnl0ZXM7IGkgKz0gNCkgew0KICAgICAgICAgICAgICAgICAgICB0aGlzV29yZHNbKHRoaXNTaWdCeXRlcyArIGkpID4+PiAyXSA9IHRoYXRXb3Jkc1tpID4+PiAyXTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIC8vIENvcHkgYWxsIHdvcmRzIGF0IG9uY2UNCiAgICAgICAgICAgICAgICB0aGlzV29yZHMucHVzaC5hcHBseSh0aGlzV29yZHMsIHRoYXRXb3Jkcyk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICB0aGlzLnNpZ0J5dGVzICs9IHRoYXRTaWdCeXRlczsNCg0KICAgICAgICAgICAgLy8gQ2hhaW5hYmxlDQogICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgfSwNCg0KICAgICAgICAvKioNCiAgICAgICAgICogUmVtb3ZlcyBpbnNpZ25pZmljYW50IGJpdHMuDQogICAgICAgICAqDQogICAgICAgICAqIEBleGFtcGxlDQogICAgICAgICAqDQogICAgICAgICAqICAgICB3b3JkQXJyYXkuY2xhbXAoKTsNCiAgICAgICAgICovDQogICAgICAgIGNsYW1wOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAvLyBTaG9ydGN1dHMNCiAgICAgICAgICAgIHZhciB3b3JkcyA9IHRoaXMud29yZHM7DQogICAgICAgICAgICB2YXIgc2lnQnl0ZXMgPSB0aGlzLnNpZ0J5dGVzOw0KDQogICAgICAgICAgICAvLyBDbGFtcA0KICAgICAgICAgICAgd29yZHNbc2lnQnl0ZXMgPj4+IDJdICY9IDB4ZmZmZmZmZmYgPDwgKDMyIC0gKHNpZ0J5dGVzICUgNCkgKiA4KTsNCiAgICAgICAgICAgIHdvcmRzLmxlbmd0aCA9IE1hdGguY2VpbChzaWdCeXRlcyAvIDQpOw0KICAgICAgICB9LA0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBDcmVhdGVzIGEgY29weSBvZiB0aGlzIHdvcmQgYXJyYXkuDQogICAgICAgICAqDQogICAgICAgICAqIEByZXR1cm4ge1dvcmRBcnJheX0gVGhlIGNsb25lLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICAgKg0KICAgICAgICAgKiAgICAgdmFyIGNsb25lID0gd29yZEFycmF5LmNsb25lKCk7DQogICAgICAgICAqLw0KICAgICAgICBjbG9uZTogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgdmFyIGNsb25lID0gQmFzZS5jbG9uZS5jYWxsKHRoaXMpOw0KICAgICAgICAgICAgY2xvbmUud29yZHMgPSB0aGlzLndvcmRzLnNsaWNlKDApOw0KDQogICAgICAgICAgICByZXR1cm4gY2xvbmU7DQogICAgICAgIH0sDQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIENyZWF0ZXMgYSB3b3JkIGFycmF5IGZpbGxlZCB3aXRoIHJhbmRvbSBieXRlcy4NCiAgICAgICAgICoNCiAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IG5CeXRlcyBUaGUgbnVtYmVyIG9mIHJhbmRvbSBieXRlcyB0byBnZW5lcmF0ZS4NCiAgICAgICAgICoNCiAgICAgICAgICogQHJldHVybiB7V29yZEFycmF5fSBUaGUgcmFuZG9tIHdvcmQgYXJyYXkuDQogICAgICAgICAqDQogICAgICAgICAqIEBzdGF0aWMNCiAgICAgICAgICoNCiAgICAgICAgICogQGV4YW1wbGUNCiAgICAgICAgICoNCiAgICAgICAgICogICAgIHZhciB3b3JkQXJyYXkgPSBDcnlwdG9KUy5saWIuV29yZEFycmF5LnJhbmRvbSgxNik7DQogICAgICAgICAqLw0KICAgICAgICByYW5kb206IGZ1bmN0aW9uIChuQnl0ZXMpIHsNCiAgICAgICAgICAgIHZhciB3b3JkcyA9IFtdOw0KICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBuQnl0ZXM7IGkgKz0gNCkgew0KICAgICAgICAgICAgICAgIHdvcmRzLnB1c2goKE1hdGgucmFuZG9tKCkgKiAweDEwMDAwMDAwMCkgfCAwKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIG5ldyBXb3JkQXJyYXkuaW5pdCh3b3JkcywgbkJ5dGVzKTsNCiAgICAgICAgfQ0KICAgIH0pOw0KDQogICAgLyoqDQogICAgICogRW5jb2RlciBuYW1lc3BhY2UuDQogICAgICovDQogICAgdmFyIENfZW5jID0gQy5lbmMgPSB7fTsNCg0KICAgIC8qKg0KICAgICAqIEhleCBlbmNvZGluZyBzdHJhdGVneS4NCiAgICAgKi8NCiAgICB2YXIgSGV4ID0gQ19lbmMuSGV4ID0gew0KICAgICAgICAvKioNCiAgICAgICAgICogQ29udmVydHMgYSB3b3JkIGFycmF5IHRvIGEgaGV4IHN0cmluZy4NCiAgICAgICAgICoNCiAgICAgICAgICogQHBhcmFtIHtXb3JkQXJyYXl9IHdvcmRBcnJheSBUaGUgd29yZCBhcnJheS4NCiAgICAgICAgICoNCiAgICAgICAgICogQHJldHVybiB7c3RyaW5nfSBUaGUgaGV4IHN0cmluZy4NCiAgICAgICAgICoNCiAgICAgICAgICogQHN0YXRpYw0KICAgICAgICAgKg0KICAgICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICAgKg0KICAgICAgICAgKiAgICAgdmFyIGhleFN0cmluZyA9IENyeXB0b0pTLmVuYy5IZXguc3RyaW5naWZ5KHdvcmRBcnJheSk7DQogICAgICAgICAqLw0KICAgICAgICBzdHJpbmdpZnk6IGZ1bmN0aW9uICh3b3JkQXJyYXkpIHsNCiAgICAgICAgICAgIC8vIFNob3J0Y3V0cw0KICAgICAgICAgICAgdmFyIHdvcmRzID0gd29yZEFycmF5LndvcmRzOw0KICAgICAgICAgICAgdmFyIHNpZ0J5dGVzID0gd29yZEFycmF5LnNpZ0J5dGVzOw0KDQogICAgICAgICAgICAvLyBDb252ZXJ0DQogICAgICAgICAgICB2YXIgaGV4Q2hhcnMgPSBbXTsNCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2lnQnl0ZXM7IGkrKykgew0KICAgICAgICAgICAgICAgIHZhciBiaXRlID0gKHdvcmRzW2kgPj4+IDJdID4+PiAoMjQgLSAoaSAlIDQpICogOCkpICYgMHhmZjsNCiAgICAgICAgICAgICAgICBoZXhDaGFycy5wdXNoKChiaXRlID4+PiA0KS50b1N0cmluZygxNikpOw0KICAgICAgICAgICAgICAgIGhleENoYXJzLnB1c2goKGJpdGUgJiAweDBmKS50b1N0cmluZygxNikpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gaGV4Q2hhcnMuam9pbignJyk7DQogICAgICAgIH0sDQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIENvbnZlcnRzIGEgaGV4IHN0cmluZyB0byBhIHdvcmQgYXJyYXkuDQogICAgICAgICAqDQogICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBoZXhTdHIgVGhlIGhleCBzdHJpbmcuDQogICAgICAgICAqDQogICAgICAgICAqIEByZXR1cm4ge1dvcmRBcnJheX0gVGhlIHdvcmQgYXJyYXkuDQogICAgICAgICAqDQogICAgICAgICAqIEBzdGF0aWMNCiAgICAgICAgICoNCiAgICAgICAgICogQGV4YW1wbGUNCiAgICAgICAgICoNCiAgICAgICAgICogICAgIHZhciB3b3JkQXJyYXkgPSBDcnlwdG9KUy5lbmMuSGV4LnBhcnNlKGhleFN0cmluZyk7DQogICAgICAgICAqLw0KICAgICAgICBwYXJzZTogZnVuY3Rpb24gKGhleFN0cikgew0KICAgICAgICAgICAgLy8gU2hvcnRjdXQNCiAgICAgICAgICAgIHZhciBoZXhTdHJMZW5ndGggPSBoZXhTdHIubGVuZ3RoOw0KDQogICAgICAgICAgICAvLyBDb252ZXJ0DQogICAgICAgICAgICB2YXIgd29yZHMgPSBbXTsNCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaGV4U3RyTGVuZ3RoOyBpICs9IDIpIHsNCiAgICAgICAgICAgICAgICB3b3Jkc1tpID4+PiAzXSB8PSBwYXJzZUludChoZXhTdHIuc3Vic3RyKGksIDIpLCAxNikgPDwgKDI0IC0gKGkgJSA4KSAqIDQpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gbmV3IFdvcmRBcnJheS5pbml0KHdvcmRzLCBoZXhTdHJMZW5ndGggLyAyKTsNCiAgICAgICAgfQ0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBMYXRpbjEgZW5jb2Rpbmcgc3RyYXRlZ3kuDQogICAgICovDQogICAgdmFyIExhdGluMSA9IENfZW5jLkxhdGluMSA9IHsNCiAgICAgICAgLyoqDQogICAgICAgICAqIENvbnZlcnRzIGEgd29yZCBhcnJheSB0byBhIExhdGluMSBzdHJpbmcuDQogICAgICAgICAqDQogICAgICAgICAqIEBwYXJhbSB7V29yZEFycmF5fSB3b3JkQXJyYXkgVGhlIHdvcmQgYXJyYXkuDQogICAgICAgICAqDQogICAgICAgICAqIEByZXR1cm4ge3N0cmluZ30gVGhlIExhdGluMSBzdHJpbmcuDQogICAgICAgICAqDQogICAgICAgICAqIEBzdGF0aWMNCiAgICAgICAgICoNCiAgICAgICAgICogQGV4YW1wbGUNCiAgICAgICAgICoNCiAgICAgICAgICogICAgIHZhciBsYXRpbjFTdHJpbmcgPSBDcnlwdG9KUy5lbmMuTGF0aW4xLnN0cmluZ2lmeSh3b3JkQXJyYXkpOw0KICAgICAgICAgKi8NCiAgICAgICAgc3RyaW5naWZ5OiBmdW5jdGlvbiAod29yZEFycmF5KSB7DQogICAgICAgICAgICAvLyBTaG9ydGN1dHMNCiAgICAgICAgICAgIHZhciB3b3JkcyA9IHdvcmRBcnJheS53b3JkczsNCiAgICAgICAgICAgIHZhciBzaWdCeXRlcyA9IHdvcmRBcnJheS5zaWdCeXRlczsNCg0KICAgICAgICAgICAgLy8gQ29udmVydA0KICAgICAgICAgICAgdmFyIGxhdGluMUNoYXJzID0gW107DQogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNpZ0J5dGVzOyBpKyspIHsNCiAgICAgICAgICAgICAgICB2YXIgYml0ZSA9ICh3b3Jkc1tpID4+PiAyXSA+Pj4gKDI0IC0gKGkgJSA0KSAqIDgpKSAmIDB4ZmY7DQogICAgICAgICAgICAgICAgbGF0aW4xQ2hhcnMucHVzaChTdHJpbmcuZnJvbUNoYXJDb2RlKGJpdGUpKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGxhdGluMUNoYXJzLmpvaW4oJycpOw0KICAgICAgICB9LA0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBDb252ZXJ0cyBhIExhdGluMSBzdHJpbmcgdG8gYSB3b3JkIGFycmF5Lg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gbGF0aW4xU3RyIFRoZSBMYXRpbjEgc3RyaW5nLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcmV0dXJuIHtXb3JkQXJyYXl9IFRoZSB3b3JkIGFycmF5Lg0KICAgICAgICAgKg0KICAgICAgICAgKiBAc3RhdGljDQogICAgICAgICAqDQogICAgICAgICAqIEBleGFtcGxlDQogICAgICAgICAqDQogICAgICAgICAqICAgICB2YXIgd29yZEFycmF5ID0gQ3J5cHRvSlMuZW5jLkxhdGluMS5wYXJzZShsYXRpbjFTdHJpbmcpOw0KICAgICAgICAgKi8NCiAgICAgICAgcGFyc2U6IGZ1bmN0aW9uIChsYXRpbjFTdHIpIHsNCiAgICAgICAgICAgIC8vIFNob3J0Y3V0DQogICAgICAgICAgICB2YXIgbGF0aW4xU3RyTGVuZ3RoID0gbGF0aW4xU3RyLmxlbmd0aDsNCg0KICAgICAgICAgICAgLy8gQ29udmVydA0KICAgICAgICAgICAgdmFyIHdvcmRzID0gW107DQogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxhdGluMVN0ckxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgd29yZHNbaSA+Pj4gMl0gfD0gKGxhdGluMVN0ci5jaGFyQ29kZUF0KGkpICYgMHhmZikgPDwgKDI0IC0gKGkgJSA0KSAqIDgpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gbmV3IFdvcmRBcnJheS5pbml0KHdvcmRzLCBsYXRpbjFTdHJMZW5ndGgpOw0KICAgICAgICB9DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIFVURi04IGVuY29kaW5nIHN0cmF0ZWd5Lg0KICAgICAqLw0KICAgIHZhciBVdGY4ID0gQ19lbmMuVXRmOCA9IHsNCiAgICAgICAgLyoqDQogICAgICAgICAqIENvbnZlcnRzIGEgd29yZCBhcnJheSB0byBhIFVURi04IHN0cmluZy4NCiAgICAgICAgICoNCiAgICAgICAgICogQHBhcmFtIHtXb3JkQXJyYXl9IHdvcmRBcnJheSBUaGUgd29yZCBhcnJheS4NCiAgICAgICAgICoNCiAgICAgICAgICogQHJldHVybiB7c3RyaW5nfSBUaGUgVVRGLTggc3RyaW5nLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAc3RhdGljDQogICAgICAgICAqDQogICAgICAgICAqIEBleGFtcGxlDQogICAgICAgICAqDQogICAgICAgICAqICAgICB2YXIgdXRmOFN0cmluZyA9IENyeXB0b0pTLmVuYy5VdGY4LnN0cmluZ2lmeSh3b3JkQXJyYXkpOw0KICAgICAgICAgKi8NCiAgICAgICAgc3RyaW5naWZ5OiBmdW5jdGlvbiAod29yZEFycmF5KSB7DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQoZXNjYXBlKExhdGluMS5zdHJpbmdpZnkod29yZEFycmF5KSkpOw0KICAgICAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTWFsZm9ybWVkIFVURi04IGRhdGEnKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSwNCg0KICAgICAgICAvKioNCiAgICAgICAgICogQ29udmVydHMgYSBVVEYtOCBzdHJpbmcgdG8gYSB3b3JkIGFycmF5Lg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gdXRmOFN0ciBUaGUgVVRGLTggc3RyaW5nLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcmV0dXJuIHtXb3JkQXJyYXl9IFRoZSB3b3JkIGFycmF5Lg0KICAgICAgICAgKg0KICAgICAgICAgKiBAc3RhdGljDQogICAgICAgICAqDQogICAgICAgICAqIEBleGFtcGxlDQogICAgICAgICAqDQogICAgICAgICAqICAgICB2YXIgd29yZEFycmF5ID0gQ3J5cHRvSlMuZW5jLlV0ZjgucGFyc2UodXRmOFN0cmluZyk7DQogICAgICAgICAqLw0KICAgICAgICBwYXJzZTogZnVuY3Rpb24gKHV0ZjhTdHIpIHsNCiAgICAgICAgICAgIHJldHVybiBMYXRpbjEucGFyc2UodW5lc2NhcGUoZW5jb2RlVVJJQ29tcG9uZW50KHV0ZjhTdHIpKSk7DQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogQWJzdHJhY3QgYnVmZmVyZWQgYmxvY2sgYWxnb3JpdGhtIHRlbXBsYXRlLg0KICAgICAqDQogICAgICogVGhlIHByb3BlcnR5IGJsb2NrU2l6ZSBtdXN0IGJlIGltcGxlbWVudGVkIGluIGEgY29uY3JldGUgc3VidHlwZS4NCiAgICAgKg0KICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBfbWluQnVmZmVyU2l6ZSBUaGUgbnVtYmVyIG9mIGJsb2NrcyB0aGF0IHNob3VsZCBiZSBrZXB0IHVucHJvY2Vzc2VkIGluIHRoZSBidWZmZXIuIERlZmF1bHQ6IDANCiAgICAgKi8NCiAgICB2YXIgQnVmZmVyZWRCbG9ja0FsZ29yaXRobSA9IENfbGliLkJ1ZmZlcmVkQmxvY2tBbGdvcml0aG0gPSBCYXNlLmV4dGVuZCh7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBSZXNldHMgdGhpcyBibG9jayBhbGdvcml0aG0ncyBkYXRhIGJ1ZmZlciB0byBpdHMgaW5pdGlhbCBzdGF0ZS4NCiAgICAgICAgICoNCiAgICAgICAgICogQGV4YW1wbGUNCiAgICAgICAgICoNCiAgICAgICAgICogICAgIGJ1ZmZlcmVkQmxvY2tBbGdvcml0aG0ucmVzZXQoKTsNCiAgICAgICAgICovDQogICAgICAgIHJlc2V0OiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAvLyBJbml0aWFsIHZhbHVlcw0KICAgICAgICAgICAgdGhpcy5fZGF0YSA9IG5ldyBXb3JkQXJyYXkuaW5pdCgpOw0KICAgICAgICAgICAgdGhpcy5fbkRhdGFCeXRlcyA9IDA7DQogICAgICAgIH0sDQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIEFkZHMgbmV3IGRhdGEgdG8gdGhpcyBibG9jayBhbGdvcml0aG0ncyBidWZmZXIuDQogICAgICAgICAqDQogICAgICAgICAqIEBwYXJhbSB7V29yZEFycmF5fHN0cmluZ30gZGF0YSBUaGUgZGF0YSB0byBhcHBlbmQuIFN0cmluZ3MgYXJlIGNvbnZlcnRlZCB0byBhIFdvcmRBcnJheSB1c2luZyBVVEYtOC4NCiAgICAgICAgICoNCiAgICAgICAgICogQGV4YW1wbGUNCiAgICAgICAgICoNCiAgICAgICAgICogICAgIGJ1ZmZlcmVkQmxvY2tBbGdvcml0aG0uX2FwcGVuZCgnZGF0YScpOw0KICAgICAgICAgKiAgICAgYnVmZmVyZWRCbG9ja0FsZ29yaXRobS5fYXBwZW5kKHdvcmRBcnJheSk7DQogICAgICAgICAqLw0KICAgICAgICBfYXBwZW5kOiBmdW5jdGlvbiAoZGF0YSkgew0KICAgICAgICAgICAgLy8gQ29udmVydCBzdHJpbmcgdG8gV29yZEFycmF5LCBlbHNlIGFzc3VtZSBXb3JkQXJyYXkgYWxyZWFkeQ0KICAgICAgICAgICAgaWYgKHR5cGVvZiBkYXRhID09ICdzdHJpbmcnKSB7DQogICAgICAgICAgICAgICAgZGF0YSA9IFV0ZjgucGFyc2UoZGF0YSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIEFwcGVuZA0KICAgICAgICAgICAgdGhpcy5fZGF0YS5jb25jYXQoZGF0YSk7DQogICAgICAgICAgICB0aGlzLl9uRGF0YUJ5dGVzICs9IGRhdGEuc2lnQnl0ZXM7DQogICAgICAgIH0sDQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIFByb2Nlc3NlcyBhdmFpbGFibGUgZGF0YSBibG9ja3MuDQogICAgICAgICAqDQogICAgICAgICAqIFRoaXMgbWV0aG9kIGludm9rZXMgX2RvUHJvY2Vzc0Jsb2NrKG9mZnNldCksIHdoaWNoIG11c3QgYmUgaW1wbGVtZW50ZWQgYnkgYSBjb25jcmV0ZSBzdWJ0eXBlLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IGRvRmx1c2ggV2hldGhlciBhbGwgYmxvY2tzIGFuZCBwYXJ0aWFsIGJsb2NrcyBzaG91bGQgYmUgcHJvY2Vzc2VkLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcmV0dXJuIHtXb3JkQXJyYXl9IFRoZSBwcm9jZXNzZWQgZGF0YS4NCiAgICAgICAgICoNCiAgICAgICAgICogQGV4YW1wbGUNCiAgICAgICAgICoNCiAgICAgICAgICogICAgIHZhciBwcm9jZXNzZWREYXRhID0gYnVmZmVyZWRCbG9ja0FsZ29yaXRobS5fcHJvY2VzcygpOw0KICAgICAgICAgKiAgICAgdmFyIHByb2Nlc3NlZERhdGEgPSBidWZmZXJlZEJsb2NrQWxnb3JpdGhtLl9wcm9jZXNzKCEhJ2ZsdXNoJyk7DQogICAgICAgICAqLw0KICAgICAgICBfcHJvY2VzczogZnVuY3Rpb24gKGRvRmx1c2gpIHsNCiAgICAgICAgICAgIC8vIFNob3J0Y3V0cw0KICAgICAgICAgICAgdmFyIGRhdGEgPSB0aGlzLl9kYXRhOw0KICAgICAgICAgICAgdmFyIGRhdGFXb3JkcyA9IGRhdGEud29yZHM7DQogICAgICAgICAgICB2YXIgZGF0YVNpZ0J5dGVzID0gZGF0YS5zaWdCeXRlczsNCiAgICAgICAgICAgIHZhciBibG9ja1NpemUgPSB0aGlzLmJsb2NrU2l6ZTsNCiAgICAgICAgICAgIHZhciBibG9ja1NpemVCeXRlcyA9IGJsb2NrU2l6ZSAqIDQ7DQoNCiAgICAgICAgICAgIC8vIENvdW50IGJsb2NrcyByZWFkeQ0KICAgICAgICAgICAgdmFyIG5CbG9ja3NSZWFkeSA9IGRhdGFTaWdCeXRlcyAvIGJsb2NrU2l6ZUJ5dGVzOw0KICAgICAgICAgICAgaWYgKGRvRmx1c2gpIHsNCiAgICAgICAgICAgICAgICAvLyBSb3VuZCB1cCB0byBpbmNsdWRlIHBhcnRpYWwgYmxvY2tzDQogICAgICAgICAgICAgICAgbkJsb2Nrc1JlYWR5ID0gTWF0aC5jZWlsKG5CbG9ja3NSZWFkeSk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIC8vIFJvdW5kIGRvd24gdG8gaW5jbHVkZSBvbmx5IGZ1bGwgYmxvY2tzLA0KICAgICAgICAgICAgICAgIC8vIGxlc3MgdGhlIG51bWJlciBvZiBibG9ja3MgdGhhdCBtdXN0IHJlbWFpbiBpbiB0aGUgYnVmZmVyDQogICAgICAgICAgICAgICAgbkJsb2Nrc1JlYWR5ID0gTWF0aC5tYXgoKG5CbG9ja3NSZWFkeSB8IDApIC0gdGhpcy5fbWluQnVmZmVyU2l6ZSwgMCk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIENvdW50IHdvcmRzIHJlYWR5DQogICAgICAgICAgICB2YXIgbldvcmRzUmVhZHkgPSBuQmxvY2tzUmVhZHkgKiBibG9ja1NpemU7DQoNCiAgICAgICAgICAgIC8vIENvdW50IGJ5dGVzIHJlYWR5DQogICAgICAgICAgICB2YXIgbkJ5dGVzUmVhZHkgPSBNYXRoLm1pbihuV29yZHNSZWFkeSAqIDQsIGRhdGFTaWdCeXRlcyk7DQoNCiAgICAgICAgICAgIC8vIFByb2Nlc3MgYmxvY2tzDQogICAgICAgICAgICBpZiAobldvcmRzUmVhZHkpIHsNCiAgICAgICAgICAgICAgICBmb3IgKHZhciBvZmZzZXQgPSAwOyBvZmZzZXQgPCBuV29yZHNSZWFkeTsgb2Zmc2V0ICs9IGJsb2NrU2l6ZSkgew0KICAgICAgICAgICAgICAgICAgICAvLyBQZXJmb3JtIGNvbmNyZXRlLWFsZ29yaXRobSBsb2dpYw0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9kb1Byb2Nlc3NCbG9jayhkYXRhV29yZHMsIG9mZnNldCk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgLy8gUmVtb3ZlIHByb2Nlc3NlZCB3b3Jkcw0KICAgICAgICAgICAgICAgIHZhciBwcm9jZXNzZWRXb3JkcyA9IGRhdGFXb3Jkcy5zcGxpY2UoMCwgbldvcmRzUmVhZHkpOw0KICAgICAgICAgICAgICAgIGRhdGEuc2lnQnl0ZXMgLT0gbkJ5dGVzUmVhZHk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIFJldHVybiBwcm9jZXNzZWQgd29yZHMNCiAgICAgICAgICAgIHJldHVybiBuZXcgV29yZEFycmF5LmluaXQocHJvY2Vzc2VkV29yZHMsIG5CeXRlc1JlYWR5KTsNCiAgICAgICAgfSwNCg0KICAgICAgICAvKioNCiAgICAgICAgICogQ3JlYXRlcyBhIGNvcHkgb2YgdGhpcyBvYmplY3QuDQogICAgICAgICAqDQogICAgICAgICAqIEByZXR1cm4ge09iamVjdH0gVGhlIGNsb25lLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICAgKg0KICAgICAgICAgKiAgICAgdmFyIGNsb25lID0gYnVmZmVyZWRCbG9ja0FsZ29yaXRobS5jbG9uZSgpOw0KICAgICAgICAgKi8NCiAgICAgICAgY2xvbmU6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHZhciBjbG9uZSA9IEJhc2UuY2xvbmUuY2FsbCh0aGlzKTsNCiAgICAgICAgICAgIGNsb25lLl9kYXRhID0gdGhpcy5fZGF0YS5jbG9uZSgpOw0KDQogICAgICAgICAgICByZXR1cm4gY2xvbmU7DQogICAgICAgIH0sDQoNCiAgICAgICAgX21pbkJ1ZmZlclNpemU6IDANCiAgICB9KTsNCg0KICAgIC8qKg0KICAgICAqIEFic3RyYWN0IGhhc2hlciB0ZW1wbGF0ZS4NCiAgICAgKg0KICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBibG9ja1NpemUgVGhlIG51bWJlciBvZiAzMi1iaXQgd29yZHMgdGhpcyBoYXNoZXIgb3BlcmF0ZXMgb24uIERlZmF1bHQ6IDE2ICg1MTIgYml0cykNCiAgICAgKi8NCiAgICB2YXIgSGFzaGVyID0gQ19saWIuSGFzaGVyID0gQnVmZmVyZWRCbG9ja0FsZ29yaXRobS5leHRlbmQoew0KICAgICAgICAvKioNCiAgICAgICAgICogQ29uZmlndXJhdGlvbiBvcHRpb25zLg0KICAgICAgICAgKi8NCiAgICAgICAgY2ZnOiBCYXNlLmV4dGVuZCgpLA0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBJbml0aWFsaXplcyBhIG5ld2x5IGNyZWF0ZWQgaGFzaGVyLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gY2ZnIChPcHRpb25hbCkgVGhlIGNvbmZpZ3VyYXRpb24gb3B0aW9ucyB0byB1c2UgZm9yIHRoaXMgaGFzaCBjb21wdXRhdGlvbi4NCiAgICAgICAgICoNCiAgICAgICAgICogQGV4YW1wbGUNCiAgICAgICAgICoNCiAgICAgICAgICogICAgIHZhciBoYXNoZXIgPSBDcnlwdG9KUy5hbGdvLlNIQTI1Ni5jcmVhdGUoKTsNCiAgICAgICAgICovDQogICAgICAgIGluaXQ6IGZ1bmN0aW9uIChjZmcpIHsNCiAgICAgICAgICAgIC8vIEFwcGx5IGNvbmZpZyBkZWZhdWx0cw0KICAgICAgICAgICAgdGhpcy5jZmcgPSB0aGlzLmNmZy5leHRlbmQoY2ZnKTsNCg0KICAgICAgICAgICAgLy8gU2V0IGluaXRpYWwgdmFsdWVzDQogICAgICAgICAgICB0aGlzLnJlc2V0KCk7DQogICAgICAgIH0sDQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIFJlc2V0cyB0aGlzIGhhc2hlciB0byBpdHMgaW5pdGlhbCBzdGF0ZS4NCiAgICAgICAgICoNCiAgICAgICAgICogQGV4YW1wbGUNCiAgICAgICAgICoNCiAgICAgICAgICogICAgIGhhc2hlci5yZXNldCgpOw0KICAgICAgICAgKi8NCiAgICAgICAgcmVzZXQ6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIC8vIFJlc2V0IGRhdGEgYnVmZmVyDQogICAgICAgICAgICBCdWZmZXJlZEJsb2NrQWxnb3JpdGhtLnJlc2V0LmNhbGwodGhpcyk7DQoNCiAgICAgICAgICAgIC8vIFBlcmZvcm0gY29uY3JldGUtaGFzaGVyIGxvZ2ljDQogICAgICAgICAgICB0aGlzLl9kb1Jlc2V0KCk7DQogICAgICAgIH0sDQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIFVwZGF0ZXMgdGhpcyBoYXNoZXIgd2l0aCBhIG1lc3NhZ2UuDQogICAgICAgICAqDQogICAgICAgICAqIEBwYXJhbSB7V29yZEFycmF5fHN0cmluZ30gbWVzc2FnZVVwZGF0ZSBUaGUgbWVzc2FnZSB0byBhcHBlbmQuDQogICAgICAgICAqDQogICAgICAgICAqIEByZXR1cm4ge0hhc2hlcn0gVGhpcyBoYXNoZXIuDQogICAgICAgICAqDQogICAgICAgICAqIEBleGFtcGxlDQogICAgICAgICAqDQogICAgICAgICAqICAgICBoYXNoZXIudXBkYXRlKCdtZXNzYWdlJyk7DQogICAgICAgICAqICAgICBoYXNoZXIudXBkYXRlKHdvcmRBcnJheSk7DQogICAgICAgICAqLw0KICAgICAgICB1cGRhdGU6IGZ1bmN0aW9uIChtZXNzYWdlVXBkYXRlKSB7DQogICAgICAgICAgICAvLyBBcHBlbmQNCiAgICAgICAgICAgIHRoaXMuX2FwcGVuZChtZXNzYWdlVXBkYXRlKTsNCg0KICAgICAgICAgICAgLy8gVXBkYXRlIHRoZSBoYXNoDQogICAgICAgICAgICB0aGlzLl9wcm9jZXNzKCk7DQoNCiAgICAgICAgICAgIC8vIENoYWluYWJsZQ0KICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgIH0sDQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIEZpbmFsaXplcyB0aGUgaGFzaCBjb21wdXRhdGlvbi4NCiAgICAgICAgICogTm90ZSB0aGF0IHRoZSBmaW5hbGl6ZSBvcGVyYXRpb24gaXMgZWZmZWN0aXZlbHkgYSBkZXN0cnVjdGl2ZSwgcmVhZC1vbmNlIG9wZXJhdGlvbi4NCiAgICAgICAgICoNCiAgICAgICAgICogQHBhcmFtIHtXb3JkQXJyYXl8c3RyaW5nfSBtZXNzYWdlVXBkYXRlIChPcHRpb25hbCkgQSBmaW5hbCBtZXNzYWdlIHVwZGF0ZS4NCiAgICAgICAgICoNCiAgICAgICAgICogQHJldHVybiB7V29yZEFycmF5fSBUaGUgaGFzaC4NCiAgICAgICAgICoNCiAgICAgICAgICogQGV4YW1wbGUNCiAgICAgICAgICoNCiAgICAgICAgICogICAgIHZhciBoYXNoID0gaGFzaGVyLmZpbmFsaXplKCk7DQogICAgICAgICAqICAgICB2YXIgaGFzaCA9IGhhc2hlci5maW5hbGl6ZSgnbWVzc2FnZScpOw0KICAgICAgICAgKiAgICAgdmFyIGhhc2ggPSBoYXNoZXIuZmluYWxpemUod29yZEFycmF5KTsNCiAgICAgICAgICovDQogICAgICAgIGZpbmFsaXplOiBmdW5jdGlvbiAobWVzc2FnZVVwZGF0ZSkgew0KICAgICAgICAgICAgLy8gRmluYWwgbWVzc2FnZSB1cGRhdGUNCiAgICAgICAgICAgIGlmIChtZXNzYWdlVXBkYXRlKSB7DQogICAgICAgICAgICAgICAgdGhpcy5fYXBwZW5kKG1lc3NhZ2VVcGRhdGUpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBQZXJmb3JtIGNvbmNyZXRlLWhhc2hlciBsb2dpYw0KICAgICAgICAgICAgdmFyIGhhc2ggPSB0aGlzLl9kb0ZpbmFsaXplKCk7DQoNCiAgICAgICAgICAgIHJldHVybiBoYXNoOw0KICAgICAgICB9LA0KDQogICAgICAgIGJsb2NrU2l6ZTogNTEyLzMyLA0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBDcmVhdGVzIGEgc2hvcnRjdXQgZnVuY3Rpb24gdG8gYSBoYXNoZXIncyBvYmplY3QgaW50ZXJmYWNlLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcGFyYW0ge0hhc2hlcn0gaGFzaGVyIFRoZSBoYXNoZXIgdG8gY3JlYXRlIGEgaGVscGVyIGZvci4NCiAgICAgICAgICoNCiAgICAgICAgICogQHJldHVybiB7RnVuY3Rpb259IFRoZSBzaG9ydGN1dCBmdW5jdGlvbi4NCiAgICAgICAgICoNCiAgICAgICAgICogQHN0YXRpYw0KICAgICAgICAgKg0KICAgICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICAgKg0KICAgICAgICAgKiAgICAgdmFyIFNIQTI1NiA9IENyeXB0b0pTLmxpYi5IYXNoZXIuX2NyZWF0ZUhlbHBlcihDcnlwdG9KUy5hbGdvLlNIQTI1Nik7DQogICAgICAgICAqLw0KICAgICAgICBfY3JlYXRlSGVscGVyOiBmdW5jdGlvbiAoaGFzaGVyKSB7DQogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKG1lc3NhZ2UsIGNmZykgew0KICAgICAgICAgICAgICAgIHJldHVybiBuZXcgaGFzaGVyLmluaXQoY2ZnKS5maW5hbGl6ZShtZXNzYWdlKTsNCiAgICAgICAgICAgIH07DQogICAgICAgIH0sDQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIENyZWF0ZXMgYSBzaG9ydGN1dCBmdW5jdGlvbiB0byB0aGUgSE1BQydzIG9iamVjdCBpbnRlcmZhY2UuDQogICAgICAgICAqDQogICAgICAgICAqIEBwYXJhbSB7SGFzaGVyfSBoYXNoZXIgVGhlIGhhc2hlciB0byB1c2UgaW4gdGhpcyBITUFDIGhlbHBlci4NCiAgICAgICAgICoNCiAgICAgICAgICogQHJldHVybiB7RnVuY3Rpb259IFRoZSBzaG9ydGN1dCBmdW5jdGlvbi4NCiAgICAgICAgICoNCiAgICAgICAgICogQHN0YXRpYw0KICAgICAgICAgKg0KICAgICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICAgKg0KICAgICAgICAgKiAgICAgdmFyIEhtYWNTSEEyNTYgPSBDcnlwdG9KUy5saWIuSGFzaGVyLl9jcmVhdGVIbWFjSGVscGVyKENyeXB0b0pTLmFsZ28uU0hBMjU2KTsNCiAgICAgICAgICovDQogICAgICAgIF9jcmVhdGVIbWFjSGVscGVyOiBmdW5jdGlvbiAoaGFzaGVyKSB7DQogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKG1lc3NhZ2UsIGtleSkgew0KICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQ19hbGdvLkhNQUMuaW5pdChoYXNoZXIsIGtleSkuZmluYWxpemUobWVzc2FnZSk7DQogICAgICAgICAgICB9Ow0KICAgICAgICB9DQogICAgfSk7DQoNCiAgICAvKioNCiAgICAgKiBBbGdvcml0aG0gbmFtZXNwYWNlLg0KICAgICAqLw0KICAgIHZhciBDX2FsZ28gPSBDLmFsZ28gPSB7fTsNCg0KICAgIHJldHVybiBDOw0KfShNYXRoKSk7DQoKZGVmaW5lKCJjcnlwdG8uY29yZSIsIGZ1bmN0aW9uKCl7fSk7CgovKgpDcnlwdG9KUyB2My4xLjIKY29kZS5nb29nbGUuY29tL3AvY3J5cHRvLWpzCihjKSAyMDA5LTIwMTMgYnkgSmVmZiBNb3R0LiBBbGwgcmlnaHRzIHJlc2VydmVkLgpjb2RlLmdvb2dsZS5jb20vcC9jcnlwdG8tanMvd2lraS9MaWNlbnNlCiovCihmdW5jdGlvbiAoKSB7CiAgICAvLyBTaG9ydGN1dHMKICAgIHZhciBDID0gQ3J5cHRvSlM7CiAgICB2YXIgQ19saWIgPSBDLmxpYjsKICAgIHZhciBXb3JkQXJyYXkgPSBDX2xpYi5Xb3JkQXJyYXk7CiAgICB2YXIgQ19lbmMgPSBDLmVuYzsKCiAgICAvKioKICAgICAqIEJhc2U2NCBlbmNvZGluZyBzdHJhdGVneS4KICAgICAqLwogICAgdmFyIEJhc2U2NCA9IENfZW5jLkJhc2U2NCA9IHsKICAgICAgICAvKioKICAgICAgICAgKiBDb252ZXJ0cyBhIHdvcmQgYXJyYXkgdG8gYSBCYXNlNjQgc3RyaW5nLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHtXb3JkQXJyYXl9IHdvcmRBcnJheSBUaGUgd29yZCBhcnJheS4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4ge3N0cmluZ30gVGhlIEJhc2U2NCBzdHJpbmcuCiAgICAgICAgICoKICAgICAgICAgKiBAc3RhdGljCiAgICAgICAgICoKICAgICAgICAgKiBAZXhhbXBsZQogICAgICAgICAqCiAgICAgICAgICogICAgIHZhciBiYXNlNjRTdHJpbmcgPSBDcnlwdG9KUy5lbmMuQmFzZTY0LnN0cmluZ2lmeSh3b3JkQXJyYXkpOwogICAgICAgICAqLwogICAgICAgIHN0cmluZ2lmeTogZnVuY3Rpb24gKHdvcmRBcnJheSkgewogICAgICAgICAgICAvLyBTaG9ydGN1dHMKICAgICAgICAgICAgdmFyIHdvcmRzID0gd29yZEFycmF5LndvcmRzOwogICAgICAgICAgICB2YXIgc2lnQnl0ZXMgPSB3b3JkQXJyYXkuc2lnQnl0ZXM7CiAgICAgICAgICAgIHZhciBtYXAgPSB0aGlzLl9tYXA7CgogICAgICAgICAgICAvLyBDbGFtcCBleGNlc3MgYml0cwogICAgICAgICAgICB3b3JkQXJyYXkuY2xhbXAoKTsKCiAgICAgICAgICAgIC8vIENvbnZlcnQKICAgICAgICAgICAgdmFyIGJhc2U2NENoYXJzID0gW107CiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2lnQnl0ZXM7IGkgKz0gMykgewogICAgICAgICAgICAgICAgdmFyIGJ5dGUxID0gKHdvcmRzW2kgPj4+IDJdICAgICAgID4+PiAoMjQgLSAoaSAlIDQpICogOCkpICAgICAgICYgMHhmZjsKICAgICAgICAgICAgICAgIHZhciBieXRlMiA9ICh3b3Jkc1soaSArIDEpID4+PiAyXSA+Pj4gKDI0IC0gKChpICsgMSkgJSA0KSAqIDgpKSAmIDB4ZmY7CiAgICAgICAgICAgICAgICB2YXIgYnl0ZTMgPSAod29yZHNbKGkgKyAyKSA+Pj4gMl0gPj4+ICgyNCAtICgoaSArIDIpICUgNCkgKiA4KSkgJiAweGZmOwoKICAgICAgICAgICAgICAgIHZhciB0cmlwbGV0ID0gKGJ5dGUxIDw8IDE2KSB8IChieXRlMiA8PCA4KSB8IGJ5dGUzOwoKICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyAoaiA8IDQpICYmIChpICsgaiAqIDAuNzUgPCBzaWdCeXRlcyk7IGorKykgewogICAgICAgICAgICAgICAgICAgIGJhc2U2NENoYXJzLnB1c2gobWFwLmNoYXJBdCgodHJpcGxldCA+Pj4gKDYgKiAoMyAtIGopKSkgJiAweDNmKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIEFkZCBwYWRkaW5nCiAgICAgICAgICAgIHZhciBwYWRkaW5nQ2hhciA9IG1hcC5jaGFyQXQoNjQpOwogICAgICAgICAgICBpZiAocGFkZGluZ0NoYXIpIHsKICAgICAgICAgICAgICAgIHdoaWxlIChiYXNlNjRDaGFycy5sZW5ndGggJSA0KSB7CiAgICAgICAgICAgICAgICAgICAgYmFzZTY0Q2hhcnMucHVzaChwYWRkaW5nQ2hhcik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBiYXNlNjRDaGFycy5qb2luKCcnKTsKICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiBDb252ZXJ0cyBhIEJhc2U2NCBzdHJpbmcgdG8gYSB3b3JkIGFycmF5LgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IGJhc2U2NFN0ciBUaGUgQmFzZTY0IHN0cmluZy4KICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4ge1dvcmRBcnJheX0gVGhlIHdvcmQgYXJyYXkuCiAgICAgICAgICoKICAgICAgICAgKiBAc3RhdGljCiAgICAgICAgICoKICAgICAgICAgKiBAZXhhbXBsZQogICAgICAgICAqCiAgICAgICAgICogICAgIHZhciB3b3JkQXJyYXkgPSBDcnlwdG9KUy5lbmMuQmFzZTY0LnBhcnNlKGJhc2U2NFN0cmluZyk7CiAgICAgICAgICovCiAgICAgICAgcGFyc2U6IGZ1bmN0aW9uIChiYXNlNjRTdHIpIHsKICAgICAgICAgICAgLy8gU2hvcnRjdXRzCiAgICAgICAgICAgIHZhciBiYXNlNjRTdHJMZW5ndGggPSBiYXNlNjRTdHIubGVuZ3RoOwogICAgICAgICAgICB2YXIgbWFwID0gdGhpcy5fbWFwOwoKICAgICAgICAgICAgLy8gSWdub3JlIHBhZGRpbmcKICAgICAgICAgICAgdmFyIHBhZGRpbmdDaGFyID0gbWFwLmNoYXJBdCg2NCk7CiAgICAgICAgICAgIGlmIChwYWRkaW5nQ2hhcikgewogICAgICAgICAgICAgICAgdmFyIHBhZGRpbmdJbmRleCA9IGJhc2U2NFN0ci5pbmRleE9mKHBhZGRpbmdDaGFyKTsKICAgICAgICAgICAgICAgIGlmIChwYWRkaW5nSW5kZXggIT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICBiYXNlNjRTdHJMZW5ndGggPSBwYWRkaW5nSW5kZXg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIENvbnZlcnQKICAgICAgICAgICAgdmFyIHdvcmRzID0gW107CiAgICAgICAgICAgIHZhciBuQnl0ZXMgPSAwOwogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGJhc2U2NFN0ckxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAoaSAlIDQpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYml0czEgPSBtYXAuaW5kZXhPZihiYXNlNjRTdHIuY2hhckF0KGkgLSAxKSkgPDwgKChpICUgNCkgKiAyKTsKICAgICAgICAgICAgICAgICAgICB2YXIgYml0czIgPSBtYXAuaW5kZXhPZihiYXNlNjRTdHIuY2hhckF0KGkpKSA+Pj4gKDYgLSAoaSAlIDQpICogMik7CiAgICAgICAgICAgICAgICAgICAgd29yZHNbbkJ5dGVzID4+PiAyXSB8PSAoYml0czEgfCBiaXRzMikgPDwgKDI0IC0gKG5CeXRlcyAlIDQpICogOCk7CiAgICAgICAgICAgICAgICAgICAgbkJ5dGVzKys7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBXb3JkQXJyYXkuY3JlYXRlKHdvcmRzLCBuQnl0ZXMpOwogICAgICAgIH0sCgogICAgICAgIF9tYXA6ICdBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWmFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MDEyMzQ1Njc4OSsvPScKICAgIH07Cn0oKSk7CgpkZWZpbmUoImNyeXB0by5lbmMtYmFzZTY0IiwgWyJjcnlwdG8uY29yZSJdLCBmdW5jdGlvbigpe30pOwoKKGZ1bmN0aW9uIChNYXRoKSB7DQogICAgLy8gU2hvcnRjdXRzDQogICAgdmFyIEMgPSBDcnlwdG9KUzsNCiAgICB2YXIgQ19saWIgPSBDLmxpYjsNCiAgICB2YXIgV29yZEFycmF5ID0gQ19saWIuV29yZEFycmF5Ow0KICAgIHZhciBIYXNoZXIgPSBDX2xpYi5IYXNoZXI7DQogICAgdmFyIENfYWxnbyA9IEMuYWxnbzsNCg0KICAgIC8vIENvbnN0YW50cyB0YWJsZQ0KICAgIHZhciBUID0gW107DQoNCiAgICAvLyBDb21wdXRlIGNvbnN0YW50cw0KICAgIChmdW5jdGlvbiAoKSB7DQogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgNjQ7IGkrKykgew0KICAgICAgICAgICAgVFtpXSA9IChNYXRoLmFicyhNYXRoLnNpbihpICsgMSkpICogMHgxMDAwMDAwMDApIHwgMDsNCiAgICAgICAgfQ0KICAgIH0oKSk7DQoNCiAgICAvKioNCiAgICAgKiBNRDUgaGFzaCBhbGdvcml0aG0uDQogICAgICovDQogICAgdmFyIE1ENSA9IENfYWxnby5NRDUgPSBIYXNoZXIuZXh0ZW5kKHsNCiAgICAgICAgX2RvUmVzZXQ6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHRoaXMuX2hhc2ggPSBuZXcgV29yZEFycmF5LmluaXQoWw0KICAgICAgICAgICAgICAgIDB4Njc0NTIzMDEsIDB4ZWZjZGFiODksDQogICAgICAgICAgICAgICAgMHg5OGJhZGNmZSwgMHgxMDMyNTQ3Ng0KICAgICAgICAgICAgXSk7DQogICAgICAgIH0sDQoNCiAgICAgICAgX2RvUHJvY2Vzc0Jsb2NrOiBmdW5jdGlvbiAoTSwgb2Zmc2V0KSB7DQogICAgICAgICAgICAvLyBTd2FwIGVuZGlhbg0KICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAxNjsgaSsrKSB7DQogICAgICAgICAgICAgICAgLy8gU2hvcnRjdXRzDQogICAgICAgICAgICAgICAgdmFyIG9mZnNldF9pID0gb2Zmc2V0ICsgaTsNCiAgICAgICAgICAgICAgICB2YXIgTV9vZmZzZXRfaSA9IE1bb2Zmc2V0X2ldOw0KDQogICAgICAgICAgICAgICAgTVtvZmZzZXRfaV0gPSAoDQogICAgICAgICAgICAgICAgICAgICgoKE1fb2Zmc2V0X2kgPDwgOCkgIHwgKE1fb2Zmc2V0X2kgPj4+IDI0KSkgJiAweDAwZmYwMGZmKSB8DQogICAgICAgICAgICAgICAgICAgICgoKE1fb2Zmc2V0X2kgPDwgMjQpIHwgKE1fb2Zmc2V0X2kgPj4+IDgpKSAgJiAweGZmMDBmZjAwKQ0KICAgICAgICAgICAgICAgICk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIFNob3J0Y3V0cw0KICAgICAgICAgICAgdmFyIEggPSB0aGlzLl9oYXNoLndvcmRzOw0KDQogICAgICAgICAgICB2YXIgTV9vZmZzZXRfMCAgPSBNW29mZnNldCArIDBdOw0KICAgICAgICAgICAgdmFyIE1fb2Zmc2V0XzEgID0gTVtvZmZzZXQgKyAxXTsNCiAgICAgICAgICAgIHZhciBNX29mZnNldF8yICA9IE1bb2Zmc2V0ICsgMl07DQogICAgICAgICAgICB2YXIgTV9vZmZzZXRfMyAgPSBNW29mZnNldCArIDNdOw0KICAgICAgICAgICAgdmFyIE1fb2Zmc2V0XzQgID0gTVtvZmZzZXQgKyA0XTsNCiAgICAgICAgICAgIHZhciBNX29mZnNldF81ICA9IE1bb2Zmc2V0ICsgNV07DQogICAgICAgICAgICB2YXIgTV9vZmZzZXRfNiAgPSBNW29mZnNldCArIDZdOw0KICAgICAgICAgICAgdmFyIE1fb2Zmc2V0XzcgID0gTVtvZmZzZXQgKyA3XTsNCiAgICAgICAgICAgIHZhciBNX29mZnNldF84ICA9IE1bb2Zmc2V0ICsgOF07DQogICAgICAgICAgICB2YXIgTV9vZmZzZXRfOSAgPSBNW29mZnNldCArIDldOw0KICAgICAgICAgICAgdmFyIE1fb2Zmc2V0XzEwID0gTVtvZmZzZXQgKyAxMF07DQogICAgICAgICAgICB2YXIgTV9vZmZzZXRfMTEgPSBNW29mZnNldCArIDExXTsNCiAgICAgICAgICAgIHZhciBNX29mZnNldF8xMiA9IE1bb2Zmc2V0ICsgMTJdOw0KICAgICAgICAgICAgdmFyIE1fb2Zmc2V0XzEzID0gTVtvZmZzZXQgKyAxM107DQogICAgICAgICAgICB2YXIgTV9vZmZzZXRfMTQgPSBNW29mZnNldCArIDE0XTsNCiAgICAgICAgICAgIHZhciBNX29mZnNldF8xNSA9IE1bb2Zmc2V0ICsgMTVdOw0KDQogICAgICAgICAgICAvLyBXb3JraW5nIHZhcmlhbGJlcw0KICAgICAgICAgICAgdmFyIGEgPSBIWzBdOw0KICAgICAgICAgICAgdmFyIGIgPSBIWzFdOw0KICAgICAgICAgICAgdmFyIGMgPSBIWzJdOw0KICAgICAgICAgICAgdmFyIGQgPSBIWzNdOw0KDQogICAgICAgICAgICAvLyBDb21wdXRhdGlvbg0KICAgICAgICAgICAgYSA9IEZGKGEsIGIsIGMsIGQsIE1fb2Zmc2V0XzAsICA3LCAgVFswXSk7DQogICAgICAgICAgICBkID0gRkYoZCwgYSwgYiwgYywgTV9vZmZzZXRfMSwgIDEyLCBUWzFdKTsNCiAgICAgICAgICAgIGMgPSBGRihjLCBkLCBhLCBiLCBNX29mZnNldF8yLCAgMTcsIFRbMl0pOw0KICAgICAgICAgICAgYiA9IEZGKGIsIGMsIGQsIGEsIE1fb2Zmc2V0XzMsICAyMiwgVFszXSk7DQogICAgICAgICAgICBhID0gRkYoYSwgYiwgYywgZCwgTV9vZmZzZXRfNCwgIDcsICBUWzRdKTsNCiAgICAgICAgICAgIGQgPSBGRihkLCBhLCBiLCBjLCBNX29mZnNldF81LCAgMTIsIFRbNV0pOw0KICAgICAgICAgICAgYyA9IEZGKGMsIGQsIGEsIGIsIE1fb2Zmc2V0XzYsICAxNywgVFs2XSk7DQogICAgICAgICAgICBiID0gRkYoYiwgYywgZCwgYSwgTV9vZmZzZXRfNywgIDIyLCBUWzddKTsNCiAgICAgICAgICAgIGEgPSBGRihhLCBiLCBjLCBkLCBNX29mZnNldF84LCAgNywgIFRbOF0pOw0KICAgICAgICAgICAgZCA9IEZGKGQsIGEsIGIsIGMsIE1fb2Zmc2V0XzksICAxMiwgVFs5XSk7DQogICAgICAgICAgICBjID0gRkYoYywgZCwgYSwgYiwgTV9vZmZzZXRfMTAsIDE3LCBUWzEwXSk7DQogICAgICAgICAgICBiID0gRkYoYiwgYywgZCwgYSwgTV9vZmZzZXRfMTEsIDIyLCBUWzExXSk7DQogICAgICAgICAgICBhID0gRkYoYSwgYiwgYywgZCwgTV9vZmZzZXRfMTIsIDcsICBUWzEyXSk7DQogICAgICAgICAgICBkID0gRkYoZCwgYSwgYiwgYywgTV9vZmZzZXRfMTMsIDEyLCBUWzEzXSk7DQogICAgICAgICAgICBjID0gRkYoYywgZCwgYSwgYiwgTV9vZmZzZXRfMTQsIDE3LCBUWzE0XSk7DQogICAgICAgICAgICBiID0gRkYoYiwgYywgZCwgYSwgTV9vZmZzZXRfMTUsIDIyLCBUWzE1XSk7DQoNCiAgICAgICAgICAgIGEgPSBHRyhhLCBiLCBjLCBkLCBNX29mZnNldF8xLCAgNSwgIFRbMTZdKTsNCiAgICAgICAgICAgIGQgPSBHRyhkLCBhLCBiLCBjLCBNX29mZnNldF82LCAgOSwgIFRbMTddKTsNCiAgICAgICAgICAgIGMgPSBHRyhjLCBkLCBhLCBiLCBNX29mZnNldF8xMSwgMTQsIFRbMThdKTsNCiAgICAgICAgICAgIGIgPSBHRyhiLCBjLCBkLCBhLCBNX29mZnNldF8wLCAgMjAsIFRbMTldKTsNCiAgICAgICAgICAgIGEgPSBHRyhhLCBiLCBjLCBkLCBNX29mZnNldF81LCAgNSwgIFRbMjBdKTsNCiAgICAgICAgICAgIGQgPSBHRyhkLCBhLCBiLCBjLCBNX29mZnNldF8xMCwgOSwgIFRbMjFdKTsNCiAgICAgICAgICAgIGMgPSBHRyhjLCBkLCBhLCBiLCBNX29mZnNldF8xNSwgMTQsIFRbMjJdKTsNCiAgICAgICAgICAgIGIgPSBHRyhiLCBjLCBkLCBhLCBNX29mZnNldF80LCAgMjAsIFRbMjNdKTsNCiAgICAgICAgICAgIGEgPSBHRyhhLCBiLCBjLCBkLCBNX29mZnNldF85LCAgNSwgIFRbMjRdKTsNCiAgICAgICAgICAgIGQgPSBHRyhkLCBhLCBiLCBjLCBNX29mZnNldF8xNCwgOSwgIFRbMjVdKTsNCiAgICAgICAgICAgIGMgPSBHRyhjLCBkLCBhLCBiLCBNX29mZnNldF8zLCAgMTQsIFRbMjZdKTsNCiAgICAgICAgICAgIGIgPSBHRyhiLCBjLCBkLCBhLCBNX29mZnNldF84LCAgMjAsIFRbMjddKTsNCiAgICAgICAgICAgIGEgPSBHRyhhLCBiLCBjLCBkLCBNX29mZnNldF8xMywgNSwgIFRbMjhdKTsNCiAgICAgICAgICAgIGQgPSBHRyhkLCBhLCBiLCBjLCBNX29mZnNldF8yLCAgOSwgIFRbMjldKTsNCiAgICAgICAgICAgIGMgPSBHRyhjLCBkLCBhLCBiLCBNX29mZnNldF83LCAgMTQsIFRbMzBdKTsNCiAgICAgICAgICAgIGIgPSBHRyhiLCBjLCBkLCBhLCBNX29mZnNldF8xMiwgMjAsIFRbMzFdKTsNCg0KICAgICAgICAgICAgYSA9IEhIKGEsIGIsIGMsIGQsIE1fb2Zmc2V0XzUsICA0LCAgVFszMl0pOw0KICAgICAgICAgICAgZCA9IEhIKGQsIGEsIGIsIGMsIE1fb2Zmc2V0XzgsICAxMSwgVFszM10pOw0KICAgICAgICAgICAgYyA9IEhIKGMsIGQsIGEsIGIsIE1fb2Zmc2V0XzExLCAxNiwgVFszNF0pOw0KICAgICAgICAgICAgYiA9IEhIKGIsIGMsIGQsIGEsIE1fb2Zmc2V0XzE0LCAyMywgVFszNV0pOw0KICAgICAgICAgICAgYSA9IEhIKGEsIGIsIGMsIGQsIE1fb2Zmc2V0XzEsICA0LCAgVFszNl0pOw0KICAgICAgICAgICAgZCA9IEhIKGQsIGEsIGIsIGMsIE1fb2Zmc2V0XzQsICAxMSwgVFszN10pOw0KICAgICAgICAgICAgYyA9IEhIKGMsIGQsIGEsIGIsIE1fb2Zmc2V0XzcsICAxNiwgVFszOF0pOw0KICAgICAgICAgICAgYiA9IEhIKGIsIGMsIGQsIGEsIE1fb2Zmc2V0XzEwLCAyMywgVFszOV0pOw0KICAgICAgICAgICAgYSA9IEhIKGEsIGIsIGMsIGQsIE1fb2Zmc2V0XzEzLCA0LCAgVFs0MF0pOw0KICAgICAgICAgICAgZCA9IEhIKGQsIGEsIGIsIGMsIE1fb2Zmc2V0XzAsICAxMSwgVFs0MV0pOw0KICAgICAgICAgICAgYyA9IEhIKGMsIGQsIGEsIGIsIE1fb2Zmc2V0XzMsICAxNiwgVFs0Ml0pOw0KICAgICAgICAgICAgYiA9IEhIKGIsIGMsIGQsIGEsIE1fb2Zmc2V0XzYsICAyMywgVFs0M10pOw0KICAgICAgICAgICAgYSA9IEhIKGEsIGIsIGMsIGQsIE1fb2Zmc2V0XzksICA0LCAgVFs0NF0pOw0KICAgICAgICAgICAgZCA9IEhIKGQsIGEsIGIsIGMsIE1fb2Zmc2V0XzEyLCAxMSwgVFs0NV0pOw0KICAgICAgICAgICAgYyA9IEhIKGMsIGQsIGEsIGIsIE1fb2Zmc2V0XzE1LCAxNiwgVFs0Nl0pOw0KICAgICAgICAgICAgYiA9IEhIKGIsIGMsIGQsIGEsIE1fb2Zmc2V0XzIsICAyMywgVFs0N10pOw0KDQogICAgICAgICAgICBhID0gSUkoYSwgYiwgYywgZCwgTV9vZmZzZXRfMCwgIDYsICBUWzQ4XSk7DQogICAgICAgICAgICBkID0gSUkoZCwgYSwgYiwgYywgTV9vZmZzZXRfNywgIDEwLCBUWzQ5XSk7DQogICAgICAgICAgICBjID0gSUkoYywgZCwgYSwgYiwgTV9vZmZzZXRfMTQsIDE1LCBUWzUwXSk7DQogICAgICAgICAgICBiID0gSUkoYiwgYywgZCwgYSwgTV9vZmZzZXRfNSwgIDIxLCBUWzUxXSk7DQogICAgICAgICAgICBhID0gSUkoYSwgYiwgYywgZCwgTV9vZmZzZXRfMTIsIDYsICBUWzUyXSk7DQogICAgICAgICAgICBkID0gSUkoZCwgYSwgYiwgYywgTV9vZmZzZXRfMywgIDEwLCBUWzUzXSk7DQogICAgICAgICAgICBjID0gSUkoYywgZCwgYSwgYiwgTV9vZmZzZXRfMTAsIDE1LCBUWzU0XSk7DQogICAgICAgICAgICBiID0gSUkoYiwgYywgZCwgYSwgTV9vZmZzZXRfMSwgIDIxLCBUWzU1XSk7DQogICAgICAgICAgICBhID0gSUkoYSwgYiwgYywgZCwgTV9vZmZzZXRfOCwgIDYsICBUWzU2XSk7DQogICAgICAgICAgICBkID0gSUkoZCwgYSwgYiwgYywgTV9vZmZzZXRfMTUsIDEwLCBUWzU3XSk7DQogICAgICAgICAgICBjID0gSUkoYywgZCwgYSwgYiwgTV9vZmZzZXRfNiwgIDE1LCBUWzU4XSk7DQogICAgICAgICAgICBiID0gSUkoYiwgYywgZCwgYSwgTV9vZmZzZXRfMTMsIDIxLCBUWzU5XSk7DQogICAgICAgICAgICBhID0gSUkoYSwgYiwgYywgZCwgTV9vZmZzZXRfNCwgIDYsICBUWzYwXSk7DQogICAgICAgICAgICBkID0gSUkoZCwgYSwgYiwgYywgTV9vZmZzZXRfMTEsIDEwLCBUWzYxXSk7DQogICAgICAgICAgICBjID0gSUkoYywgZCwgYSwgYiwgTV9vZmZzZXRfMiwgIDE1LCBUWzYyXSk7DQogICAgICAgICAgICBiID0gSUkoYiwgYywgZCwgYSwgTV9vZmZzZXRfOSwgIDIxLCBUWzYzXSk7DQoNCiAgICAgICAgICAgIC8vIEludGVybWVkaWF0ZSBoYXNoIHZhbHVlDQogICAgICAgICAgICBIWzBdID0gKEhbMF0gKyBhKSB8IDA7DQogICAgICAgICAgICBIWzFdID0gKEhbMV0gKyBiKSB8IDA7DQogICAgICAgICAgICBIWzJdID0gKEhbMl0gKyBjKSB8IDA7DQogICAgICAgICAgICBIWzNdID0gKEhbM10gKyBkKSB8IDA7DQogICAgICAgIH0sDQoNCiAgICAgICAgX2RvRmluYWxpemU6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIC8vIFNob3J0Y3V0cw0KICAgICAgICAgICAgdmFyIGRhdGEgPSB0aGlzLl9kYXRhOw0KICAgICAgICAgICAgdmFyIGRhdGFXb3JkcyA9IGRhdGEud29yZHM7DQoNCiAgICAgICAgICAgIHZhciBuQml0c1RvdGFsID0gdGhpcy5fbkRhdGFCeXRlcyAqIDg7DQogICAgICAgICAgICB2YXIgbkJpdHNMZWZ0ID0gZGF0YS5zaWdCeXRlcyAqIDg7DQoNCiAgICAgICAgICAgIC8vIEFkZCBwYWRkaW5nDQogICAgICAgICAgICBkYXRhV29yZHNbbkJpdHNMZWZ0ID4+PiA1XSB8PSAweDgwIDw8ICgyNCAtIG5CaXRzTGVmdCAlIDMyKTsNCg0KICAgICAgICAgICAgdmFyIG5CaXRzVG90YWxIID0gTWF0aC5mbG9vcihuQml0c1RvdGFsIC8gMHgxMDAwMDAwMDApOw0KICAgICAgICAgICAgdmFyIG5CaXRzVG90YWxMID0gbkJpdHNUb3RhbDsNCiAgICAgICAgICAgIGRhdGFXb3Jkc1soKChuQml0c0xlZnQgKyA2NCkgPj4+IDkpIDw8IDQpICsgMTVdID0gKA0KICAgICAgICAgICAgICAgICgoKG5CaXRzVG90YWxIIDw8IDgpICB8IChuQml0c1RvdGFsSCA+Pj4gMjQpKSAmIDB4MDBmZjAwZmYpIHwNCiAgICAgICAgICAgICAgICAoKChuQml0c1RvdGFsSCA8PCAyNCkgfCAobkJpdHNUb3RhbEggPj4+IDgpKSAgJiAweGZmMDBmZjAwKQ0KICAgICAgICAgICAgKTsNCiAgICAgICAgICAgIGRhdGFXb3Jkc1soKChuQml0c0xlZnQgKyA2NCkgPj4+IDkpIDw8IDQpICsgMTRdID0gKA0KICAgICAgICAgICAgICAgICgoKG5CaXRzVG90YWxMIDw8IDgpICB8IChuQml0c1RvdGFsTCA+Pj4gMjQpKSAmIDB4MDBmZjAwZmYpIHwNCiAgICAgICAgICAgICAgICAoKChuQml0c1RvdGFsTCA8PCAyNCkgfCAobkJpdHNUb3RhbEwgPj4+IDgpKSAgJiAweGZmMDBmZjAwKQ0KICAgICAgICAgICAgKTsNCg0KICAgICAgICAgICAgZGF0YS5zaWdCeXRlcyA9IChkYXRhV29yZHMubGVuZ3RoICsgMSkgKiA0Ow0KDQogICAgICAgICAgICAvLyBIYXNoIGZpbmFsIGJsb2Nrcw0KICAgICAgICAgICAgdGhpcy5fcHJvY2VzcygpOw0KDQogICAgICAgICAgICAvLyBTaG9ydGN1dHMNCiAgICAgICAgICAgIHZhciBoYXNoID0gdGhpcy5faGFzaDsNCiAgICAgICAgICAgIHZhciBIID0gaGFzaC53b3JkczsNCg0KICAgICAgICAgICAgLy8gU3dhcCBlbmRpYW4NCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgNDsgaSsrKSB7DQogICAgICAgICAgICAgICAgLy8gU2hvcnRjdXQNCiAgICAgICAgICAgICAgICB2YXIgSF9pID0gSFtpXTsNCg0KICAgICAgICAgICAgICAgIEhbaV0gPSAoKChIX2kgPDwgOCkgIHwgKEhfaSA+Pj4gMjQpKSAmIDB4MDBmZjAwZmYpIHwNCiAgICAgICAgICAgICAgICAgICAgICAgKCgoSF9pIDw8IDI0KSB8IChIX2kgPj4+IDgpKSAgJiAweGZmMDBmZjAwKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gUmV0dXJuIGZpbmFsIGNvbXB1dGVkIGhhc2gNCiAgICAgICAgICAgIHJldHVybiBoYXNoOw0KICAgICAgICB9LA0KDQogICAgICAgIGNsb25lOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICB2YXIgY2xvbmUgPSBIYXNoZXIuY2xvbmUuY2FsbCh0aGlzKTsNCiAgICAgICAgICAgIGNsb25lLl9oYXNoID0gdGhpcy5faGFzaC5jbG9uZSgpOw0KDQogICAgICAgICAgICByZXR1cm4gY2xvbmU7DQogICAgICAgIH0NCiAgICB9KTsNCg0KICAgIGZ1bmN0aW9uIEZGKGEsIGIsIGMsIGQsIHgsIHMsIHQpIHsNCiAgICAgICAgdmFyIG4gPSBhICsgKChiICYgYykgfCAofmIgJiBkKSkgKyB4ICsgdDsNCiAgICAgICAgcmV0dXJuICgobiA8PCBzKSB8IChuID4+PiAoMzIgLSBzKSkpICsgYjsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBHRyhhLCBiLCBjLCBkLCB4LCBzLCB0KSB7DQogICAgICAgIHZhciBuID0gYSArICgoYiAmIGQpIHwgKGMgJiB+ZCkpICsgeCArIHQ7DQogICAgICAgIHJldHVybiAoKG4gPDwgcykgfCAobiA+Pj4gKDMyIC0gcykpKSArIGI7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gSEgoYSwgYiwgYywgZCwgeCwgcywgdCkgew0KICAgICAgICB2YXIgbiA9IGEgKyAoYiBeIGMgXiBkKSArIHggKyB0Ow0KICAgICAgICByZXR1cm4gKChuIDw8IHMpIHwgKG4gPj4+ICgzMiAtIHMpKSkgKyBiOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIElJKGEsIGIsIGMsIGQsIHgsIHMsIHQpIHsNCiAgICAgICAgdmFyIG4gPSBhICsgKGMgXiAoYiB8IH5kKSkgKyB4ICsgdDsNCiAgICAgICAgcmV0dXJuICgobiA8PCBzKSB8IChuID4+PiAoMzIgLSBzKSkpICsgYjsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBTaG9ydGN1dCBmdW5jdGlvbiB0byB0aGUgaGFzaGVyJ3Mgb2JqZWN0IGludGVyZmFjZS4NCiAgICAgKg0KICAgICAqIEBwYXJhbSB7V29yZEFycmF5fHN0cmluZ30gbWVzc2FnZSBUaGUgbWVzc2FnZSB0byBoYXNoLg0KICAgICAqDQogICAgICogQHJldHVybiB7V29yZEFycmF5fSBUaGUgaGFzaC4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiAgICAgdmFyIGhhc2ggPSBDcnlwdG9KUy5NRDUoJ21lc3NhZ2UnKTsNCiAgICAgKiAgICAgdmFyIGhhc2ggPSBDcnlwdG9KUy5NRDUod29yZEFycmF5KTsNCiAgICAgKi8NCiAgICBDLk1ENSA9IEhhc2hlci5fY3JlYXRlSGVscGVyKE1ENSk7DQoNCiAgICAvKioNCiAgICAgKiBTaG9ydGN1dCBmdW5jdGlvbiB0byB0aGUgSE1BQydzIG9iamVjdCBpbnRlcmZhY2UuDQogICAgICoNCiAgICAgKiBAcGFyYW0ge1dvcmRBcnJheXxzdHJpbmd9IG1lc3NhZ2UgVGhlIG1lc3NhZ2UgdG8gaGFzaC4NCiAgICAgKiBAcGFyYW0ge1dvcmRBcnJheXxzdHJpbmd9IGtleSBUaGUgc2VjcmV0IGtleS4NCiAgICAgKg0KICAgICAqIEByZXR1cm4ge1dvcmRBcnJheX0gVGhlIEhNQUMuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICoNCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogICAgIHZhciBobWFjID0gQ3J5cHRvSlMuSG1hY01ENShtZXNzYWdlLCBrZXkpOw0KICAgICAqLw0KICAgIEMuSG1hY01ENSA9IEhhc2hlci5fY3JlYXRlSG1hY0hlbHBlcihNRDUpOw0KfShNYXRoKSk7DQoKZGVmaW5lKCJjcnlwdG8ubWQ1IiwgWyJjcnlwdG8uY29yZSJdLCBmdW5jdGlvbigpe30pOwoKKGZ1bmN0aW9uICgpIHsNCiAgICAvLyBTaG9ydGN1dHMNCiAgICB2YXIgQyA9IENyeXB0b0pTOw0KICAgIHZhciBDX2xpYiA9IEMubGliOw0KICAgIHZhciBCYXNlID0gQ19saWIuQmFzZTsNCiAgICB2YXIgV29yZEFycmF5ID0gQ19saWIuV29yZEFycmF5Ow0KICAgIHZhciBDX2FsZ28gPSBDLmFsZ287DQogICAgdmFyIE1ENSA9IENfYWxnby5NRDU7DQoNCiAgICAvKioNCiAgICAgKiBUaGlzIGtleSBkZXJpdmF0aW9uIGZ1bmN0aW9uIGlzIG1lYW50IHRvIGNvbmZvcm0gd2l0aCBFVlBfQnl0ZXNUb0tleS4NCiAgICAgKiB3d3cub3BlbnNzbC5vcmcvZG9jcy9jcnlwdG8vRVZQX0J5dGVzVG9LZXkuaHRtbA0KICAgICAqLw0KICAgIHZhciBFdnBLREYgPSBDX2FsZ28uRXZwS0RGID0gQmFzZS5leHRlbmQoew0KICAgICAgICAvKioNCiAgICAgICAgICogQ29uZmlndXJhdGlvbiBvcHRpb25zLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcHJvcGVydHkge251bWJlcn0ga2V5U2l6ZSBUaGUga2V5IHNpemUgaW4gd29yZHMgdG8gZ2VuZXJhdGUuIERlZmF1bHQ6IDQgKDEyOCBiaXRzKQ0KICAgICAgICAgKiBAcHJvcGVydHkge0hhc2hlcn0gaGFzaGVyIFRoZSBoYXNoIGFsZ29yaXRobSB0byB1c2UuIERlZmF1bHQ6IE1ENQ0KICAgICAgICAgKiBAcHJvcGVydHkge251bWJlcn0gaXRlcmF0aW9ucyBUaGUgbnVtYmVyIG9mIGl0ZXJhdGlvbnMgdG8gcGVyZm9ybS4gRGVmYXVsdDogMQ0KICAgICAgICAgKi8NCiAgICAgICAgY2ZnOiBCYXNlLmV4dGVuZCh7DQogICAgICAgICAgICBrZXlTaXplOiAxMjgvMzIsDQogICAgICAgICAgICBoYXNoZXI6IE1ENSwNCiAgICAgICAgICAgIGl0ZXJhdGlvbnM6IDENCiAgICAgICAgfSksDQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIEluaXRpYWxpemVzIGEgbmV3bHkgY3JlYXRlZCBrZXkgZGVyaXZhdGlvbiBmdW5jdGlvbi4NCiAgICAgICAgICoNCiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGNmZyAoT3B0aW9uYWwpIFRoZSBjb25maWd1cmF0aW9uIG9wdGlvbnMgdG8gdXNlIGZvciB0aGUgZGVyaXZhdGlvbi4NCiAgICAgICAgICoNCiAgICAgICAgICogQGV4YW1wbGUNCiAgICAgICAgICoNCiAgICAgICAgICogICAgIHZhciBrZGYgPSBDcnlwdG9KUy5hbGdvLkV2cEtERi5jcmVhdGUoKTsNCiAgICAgICAgICogICAgIHZhciBrZGYgPSBDcnlwdG9KUy5hbGdvLkV2cEtERi5jcmVhdGUoeyBrZXlTaXplOiA4IH0pOw0KICAgICAgICAgKiAgICAgdmFyIGtkZiA9IENyeXB0b0pTLmFsZ28uRXZwS0RGLmNyZWF0ZSh7IGtleVNpemU6IDgsIGl0ZXJhdGlvbnM6IDEwMDAgfSk7DQogICAgICAgICAqLw0KICAgICAgICBpbml0OiBmdW5jdGlvbiAoY2ZnKSB7DQogICAgICAgICAgICB0aGlzLmNmZyA9IHRoaXMuY2ZnLmV4dGVuZChjZmcpOw0KICAgICAgICB9LA0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBEZXJpdmVzIGEga2V5IGZyb20gYSBwYXNzd29yZC4NCiAgICAgICAgICoNCiAgICAgICAgICogQHBhcmFtIHtXb3JkQXJyYXl8c3RyaW5nfSBwYXNzd29yZCBUaGUgcGFzc3dvcmQuDQogICAgICAgICAqIEBwYXJhbSB7V29yZEFycmF5fHN0cmluZ30gc2FsdCBBIHNhbHQuDQogICAgICAgICAqDQogICAgICAgICAqIEByZXR1cm4ge1dvcmRBcnJheX0gVGhlIGRlcml2ZWQga2V5Lg0KICAgICAgICAgKg0KICAgICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICAgKg0KICAgICAgICAgKiAgICAgdmFyIGtleSA9IGtkZi5jb21wdXRlKHBhc3N3b3JkLCBzYWx0KTsNCiAgICAgICAgICovDQogICAgICAgIGNvbXB1dGU6IGZ1bmN0aW9uIChwYXNzd29yZCwgc2FsdCkgew0KICAgICAgICAgICAgLy8gU2hvcnRjdXQNCiAgICAgICAgICAgIHZhciBjZmcgPSB0aGlzLmNmZzsNCg0KICAgICAgICAgICAgLy8gSW5pdCBoYXNoZXINCiAgICAgICAgICAgIHZhciBoYXNoZXIgPSBjZmcuaGFzaGVyLmNyZWF0ZSgpOw0KDQogICAgICAgICAgICAvLyBJbml0aWFsIHZhbHVlcw0KICAgICAgICAgICAgdmFyIGRlcml2ZWRLZXkgPSBXb3JkQXJyYXkuY3JlYXRlKCk7DQoNCiAgICAgICAgICAgIC8vIFNob3J0Y3V0cw0KICAgICAgICAgICAgdmFyIGRlcml2ZWRLZXlXb3JkcyA9IGRlcml2ZWRLZXkud29yZHM7DQogICAgICAgICAgICB2YXIga2V5U2l6ZSA9IGNmZy5rZXlTaXplOw0KICAgICAgICAgICAgdmFyIGl0ZXJhdGlvbnMgPSBjZmcuaXRlcmF0aW9uczsNCg0KICAgICAgICAgICAgLy8gR2VuZXJhdGUga2V5DQogICAgICAgICAgICB3aGlsZSAoZGVyaXZlZEtleVdvcmRzLmxlbmd0aCA8IGtleVNpemUpIHsNCiAgICAgICAgICAgICAgICBpZiAoYmxvY2spIHsNCiAgICAgICAgICAgICAgICAgICAgaGFzaGVyLnVwZGF0ZShibG9jayk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHZhciBibG9jayA9IGhhc2hlci51cGRhdGUocGFzc3dvcmQpLmZpbmFsaXplKHNhbHQpOw0KICAgICAgICAgICAgICAgIGhhc2hlci5yZXNldCgpOw0KDQogICAgICAgICAgICAgICAgLy8gSXRlcmF0aW9ucw0KICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgaXRlcmF0aW9uczsgaSsrKSB7DQogICAgICAgICAgICAgICAgICAgIGJsb2NrID0gaGFzaGVyLmZpbmFsaXplKGJsb2NrKTsNCiAgICAgICAgICAgICAgICAgICAgaGFzaGVyLnJlc2V0KCk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgZGVyaXZlZEtleS5jb25jYXQoYmxvY2spOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZGVyaXZlZEtleS5zaWdCeXRlcyA9IGtleVNpemUgKiA0Ow0KDQogICAgICAgICAgICByZXR1cm4gZGVyaXZlZEtleTsNCiAgICAgICAgfQ0KICAgIH0pOw0KDQogICAgLyoqDQogICAgICogRGVyaXZlcyBhIGtleSBmcm9tIGEgcGFzc3dvcmQuDQogICAgICoNCiAgICAgKiBAcGFyYW0ge1dvcmRBcnJheXxzdHJpbmd9IHBhc3N3b3JkIFRoZSBwYXNzd29yZC4NCiAgICAgKiBAcGFyYW0ge1dvcmRBcnJheXxzdHJpbmd9IHNhbHQgQSBzYWx0Lg0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjZmcgKE9wdGlvbmFsKSBUaGUgY29uZmlndXJhdGlvbiBvcHRpb25zIHRvIHVzZSBmb3IgdGhpcyBjb21wdXRhdGlvbi4NCiAgICAgKg0KICAgICAqIEByZXR1cm4ge1dvcmRBcnJheX0gVGhlIGRlcml2ZWQga2V5Lg0KICAgICAqDQogICAgICogQHN0YXRpYw0KICAgICAqDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqICAgICB2YXIga2V5ID0gQ3J5cHRvSlMuRXZwS0RGKHBhc3N3b3JkLCBzYWx0KTsNCiAgICAgKiAgICAgdmFyIGtleSA9IENyeXB0b0pTLkV2cEtERihwYXNzd29yZCwgc2FsdCwgeyBrZXlTaXplOiA4IH0pOw0KICAgICAqICAgICB2YXIga2V5ID0gQ3J5cHRvSlMuRXZwS0RGKHBhc3N3b3JkLCBzYWx0LCB7IGtleVNpemU6IDgsIGl0ZXJhdGlvbnM6IDEwMDAgfSk7DQogICAgICovDQogICAgQy5FdnBLREYgPSBmdW5jdGlvbiAocGFzc3dvcmQsIHNhbHQsIGNmZykgew0KICAgICAgICByZXR1cm4gRXZwS0RGLmNyZWF0ZShjZmcpLmNvbXB1dGUocGFzc3dvcmQsIHNhbHQpOw0KICAgIH07DQp9KCkpOw0KCmRlZmluZSgiY3J5cHRvLmV2cGtkZiIsIFsiY3J5cHRvLm1kNSJdLCBmdW5jdGlvbigpe30pOwoKLyoKQ3J5cHRvSlMgdjMuMS4yCmNvZGUuZ29vZ2xlLmNvbS9wL2NyeXB0by1qcwooYykgMjAwOS0yMDEzIGJ5IEplZmYgTW90dC4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KY29kZS5nb29nbGUuY29tL3AvY3J5cHRvLWpzL3dpa2kvTGljZW5zZQoqLwovKioNCiAqIENpcGhlciBjb3JlIGNvbXBvbmVudHMuDQogKi8NCkNyeXB0b0pTLmxpYi5DaXBoZXIgfHwgKGZ1bmN0aW9uICh1bmRlZmluZWQpIHsNCiAgICAvLyBTaG9ydGN1dHMNCiAgICB2YXIgQyA9IENyeXB0b0pTOw0KICAgIHZhciBDX2xpYiA9IEMubGliOw0KICAgIHZhciBCYXNlID0gQ19saWIuQmFzZTsNCiAgICB2YXIgV29yZEFycmF5ID0gQ19saWIuV29yZEFycmF5Ow0KICAgIHZhciBCdWZmZXJlZEJsb2NrQWxnb3JpdGhtID0gQ19saWIuQnVmZmVyZWRCbG9ja0FsZ29yaXRobTsNCiAgICB2YXIgQ19lbmMgPSBDLmVuYzsNCiAgICB2YXIgVXRmOCA9IENfZW5jLlV0Zjg7DQogICAgdmFyIEJhc2U2NCA9IENfZW5jLkJhc2U2NDsNCiAgICB2YXIgQ19hbGdvID0gQy5hbGdvOw0KICAgIHZhciBFdnBLREYgPSBDX2FsZ28uRXZwS0RGOw0KDQogICAgLyoqDQogICAgICogQWJzdHJhY3QgYmFzZSBjaXBoZXIgdGVtcGxhdGUuDQogICAgICoNCiAgICAgKiBAcHJvcGVydHkge251bWJlcn0ga2V5U2l6ZSBUaGlzIGNpcGhlcidzIGtleSBzaXplLiBEZWZhdWx0OiA0ICgxMjggYml0cykNCiAgICAgKiBAcHJvcGVydHkge251bWJlcn0gaXZTaXplIFRoaXMgY2lwaGVyJ3MgSVYgc2l6ZS4gRGVmYXVsdDogNCAoMTI4IGJpdHMpDQogICAgICogQHByb3BlcnR5IHtudW1iZXJ9IF9FTkNfWEZPUk1fTU9ERSBBIGNvbnN0YW50IHJlcHJlc2VudGluZyBlbmNyeXB0aW9uIG1vZGUuDQogICAgICogQHByb3BlcnR5IHtudW1iZXJ9IF9ERUNfWEZPUk1fTU9ERSBBIGNvbnN0YW50IHJlcHJlc2VudGluZyBkZWNyeXB0aW9uIG1vZGUuDQogICAgICovDQogICAgdmFyIENpcGhlciA9IENfbGliLkNpcGhlciA9IEJ1ZmZlcmVkQmxvY2tBbGdvcml0aG0uZXh0ZW5kKHsNCiAgICAgICAgLyoqDQogICAgICAgICAqIENvbmZpZ3VyYXRpb24gb3B0aW9ucy4NCiAgICAgICAgICoNCiAgICAgICAgICogQHByb3BlcnR5IHtXb3JkQXJyYXl9IGl2IFRoZSBJViB0byB1c2UgZm9yIHRoaXMgb3BlcmF0aW9uLg0KICAgICAgICAgKi8NCiAgICAgICAgY2ZnOiBCYXNlLmV4dGVuZCgpLA0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBDcmVhdGVzIHRoaXMgY2lwaGVyIGluIGVuY3J5cHRpb24gbW9kZS4NCiAgICAgICAgICoNCiAgICAgICAgICogQHBhcmFtIHtXb3JkQXJyYXl9IGtleSBUaGUga2V5Lg0KICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gY2ZnIChPcHRpb25hbCkgVGhlIGNvbmZpZ3VyYXRpb24gb3B0aW9ucyB0byB1c2UgZm9yIHRoaXMgb3BlcmF0aW9uLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcmV0dXJuIHtDaXBoZXJ9IEEgY2lwaGVyIGluc3RhbmNlLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAc3RhdGljDQogICAgICAgICAqDQogICAgICAgICAqIEBleGFtcGxlDQogICAgICAgICAqDQogICAgICAgICAqICAgICB2YXIgY2lwaGVyID0gQ3J5cHRvSlMuYWxnby5BRVMuY3JlYXRlRW5jcnlwdG9yKGtleVdvcmRBcnJheSwgeyBpdjogaXZXb3JkQXJyYXkgfSk7DQogICAgICAgICAqLw0KICAgICAgICBjcmVhdGVFbmNyeXB0b3I6IGZ1bmN0aW9uIChrZXksIGNmZykgew0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlKHRoaXMuX0VOQ19YRk9STV9NT0RFLCBrZXksIGNmZyk7DQogICAgICAgIH0sDQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIENyZWF0ZXMgdGhpcyBjaXBoZXIgaW4gZGVjcnlwdGlvbiBtb2RlLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcGFyYW0ge1dvcmRBcnJheX0ga2V5IFRoZSBrZXkuDQogICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjZmcgKE9wdGlvbmFsKSBUaGUgY29uZmlndXJhdGlvbiBvcHRpb25zIHRvIHVzZSBmb3IgdGhpcyBvcGVyYXRpb24uDQogICAgICAgICAqDQogICAgICAgICAqIEByZXR1cm4ge0NpcGhlcn0gQSBjaXBoZXIgaW5zdGFuY2UuDQogICAgICAgICAqDQogICAgICAgICAqIEBzdGF0aWMNCiAgICAgICAgICoNCiAgICAgICAgICogQGV4YW1wbGUNCiAgICAgICAgICoNCiAgICAgICAgICogICAgIHZhciBjaXBoZXIgPSBDcnlwdG9KUy5hbGdvLkFFUy5jcmVhdGVEZWNyeXB0b3Ioa2V5V29yZEFycmF5LCB7IGl2OiBpdldvcmRBcnJheSB9KTsNCiAgICAgICAgICovDQogICAgICAgIGNyZWF0ZURlY3J5cHRvcjogZnVuY3Rpb24gKGtleSwgY2ZnKSB7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGUodGhpcy5fREVDX1hGT1JNX01PREUsIGtleSwgY2ZnKTsNCiAgICAgICAgfSwNCg0KICAgICAgICAvKioNCiAgICAgICAgICogSW5pdGlhbGl6ZXMgYSBuZXdseSBjcmVhdGVkIGNpcGhlci4NCiAgICAgICAgICoNCiAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IHhmb3JtTW9kZSBFaXRoZXIgdGhlIGVuY3J5cHRpb24gb3IgZGVjcnlwdGlvbiB0cmFuc29ybWF0aW9uIG1vZGUgY29uc3RhbnQuDQogICAgICAgICAqIEBwYXJhbSB7V29yZEFycmF5fSBrZXkgVGhlIGtleS4NCiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGNmZyAoT3B0aW9uYWwpIFRoZSBjb25maWd1cmF0aW9uIG9wdGlvbnMgdG8gdXNlIGZvciB0aGlzIG9wZXJhdGlvbi4NCiAgICAgICAgICoNCiAgICAgICAgICogQGV4YW1wbGUNCiAgICAgICAgICoNCiAgICAgICAgICogICAgIHZhciBjaXBoZXIgPSBDcnlwdG9KUy5hbGdvLkFFUy5jcmVhdGUoQ3J5cHRvSlMuYWxnby5BRVMuX0VOQ19YRk9STV9NT0RFLCBrZXlXb3JkQXJyYXksIHsgaXY6IGl2V29yZEFycmF5IH0pOw0KICAgICAgICAgKi8NCiAgICAgICAgaW5pdDogZnVuY3Rpb24gKHhmb3JtTW9kZSwga2V5LCBjZmcpIHsNCiAgICAgICAgICAgIC8vIEFwcGx5IGNvbmZpZyBkZWZhdWx0cw0KICAgICAgICAgICAgdGhpcy5jZmcgPSB0aGlzLmNmZy5leHRlbmQoY2ZnKTsNCg0KICAgICAgICAgICAgLy8gU3RvcmUgdHJhbnNmb3JtIG1vZGUgYW5kIGtleQ0KICAgICAgICAgICAgdGhpcy5feGZvcm1Nb2RlID0geGZvcm1Nb2RlOw0KICAgICAgICAgICAgdGhpcy5fa2V5ID0ga2V5Ow0KDQogICAgICAgICAgICAvLyBTZXQgaW5pdGlhbCB2YWx1ZXMNCiAgICAgICAgICAgIHRoaXMucmVzZXQoKTsNCiAgICAgICAgfSwNCg0KICAgICAgICAvKioNCiAgICAgICAgICogUmVzZXRzIHRoaXMgY2lwaGVyIHRvIGl0cyBpbml0aWFsIHN0YXRlLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICAgKg0KICAgICAgICAgKiAgICAgY2lwaGVyLnJlc2V0KCk7DQogICAgICAgICAqLw0KICAgICAgICByZXNldDogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgLy8gUmVzZXQgZGF0YSBidWZmZXINCiAgICAgICAgICAgIEJ1ZmZlcmVkQmxvY2tBbGdvcml0aG0ucmVzZXQuY2FsbCh0aGlzKTsNCg0KICAgICAgICAgICAgLy8gUGVyZm9ybSBjb25jcmV0ZS1jaXBoZXIgbG9naWMNCiAgICAgICAgICAgIHRoaXMuX2RvUmVzZXQoKTsNCiAgICAgICAgfSwNCg0KICAgICAgICAvKioNCiAgICAgICAgICogQWRkcyBkYXRhIHRvIGJlIGVuY3J5cHRlZCBvciBkZWNyeXB0ZWQuDQogICAgICAgICAqDQogICAgICAgICAqIEBwYXJhbSB7V29yZEFycmF5fHN0cmluZ30gZGF0YVVwZGF0ZSBUaGUgZGF0YSB0byBlbmNyeXB0IG9yIGRlY3J5cHQuDQogICAgICAgICAqDQogICAgICAgICAqIEByZXR1cm4ge1dvcmRBcnJheX0gVGhlIGRhdGEgYWZ0ZXIgcHJvY2Vzc2luZy4NCiAgICAgICAgICoNCiAgICAgICAgICogQGV4YW1wbGUNCiAgICAgICAgICoNCiAgICAgICAgICogICAgIHZhciBlbmNyeXB0ZWQgPSBjaXBoZXIucHJvY2VzcygnZGF0YScpOw0KICAgICAgICAgKiAgICAgdmFyIGVuY3J5cHRlZCA9IGNpcGhlci5wcm9jZXNzKHdvcmRBcnJheSk7DQogICAgICAgICAqLw0KICAgICAgICBwcm9jZXNzOiBmdW5jdGlvbiAoZGF0YVVwZGF0ZSkgew0KICAgICAgICAgICAgLy8gQXBwZW5kDQogICAgICAgICAgICB0aGlzLl9hcHBlbmQoZGF0YVVwZGF0ZSk7DQoNCiAgICAgICAgICAgIC8vIFByb2Nlc3MgYXZhaWxhYmxlIGJsb2Nrcw0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3Byb2Nlc3MoKTsNCiAgICAgICAgfSwNCg0KICAgICAgICAvKioNCiAgICAgICAgICogRmluYWxpemVzIHRoZSBlbmNyeXB0aW9uIG9yIGRlY3J5cHRpb24gcHJvY2Vzcy4NCiAgICAgICAgICogTm90ZSB0aGF0IHRoZSBmaW5hbGl6ZSBvcGVyYXRpb24gaXMgZWZmZWN0aXZlbHkgYSBkZXN0cnVjdGl2ZSwgcmVhZC1vbmNlIG9wZXJhdGlvbi4NCiAgICAgICAgICoNCiAgICAgICAgICogQHBhcmFtIHtXb3JkQXJyYXl8c3RyaW5nfSBkYXRhVXBkYXRlIFRoZSBmaW5hbCBkYXRhIHRvIGVuY3J5cHQgb3IgZGVjcnlwdC4NCiAgICAgICAgICoNCiAgICAgICAgICogQHJldHVybiB7V29yZEFycmF5fSBUaGUgZGF0YSBhZnRlciBmaW5hbCBwcm9jZXNzaW5nLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICAgKg0KICAgICAgICAgKiAgICAgdmFyIGVuY3J5cHRlZCA9IGNpcGhlci5maW5hbGl6ZSgpOw0KICAgICAgICAgKiAgICAgdmFyIGVuY3J5cHRlZCA9IGNpcGhlci5maW5hbGl6ZSgnZGF0YScpOw0KICAgICAgICAgKiAgICAgdmFyIGVuY3J5cHRlZCA9IGNpcGhlci5maW5hbGl6ZSh3b3JkQXJyYXkpOw0KICAgICAgICAgKi8NCiAgICAgICAgZmluYWxpemU6IGZ1bmN0aW9uIChkYXRhVXBkYXRlKSB7DQogICAgICAgICAgICAvLyBGaW5hbCBkYXRhIHVwZGF0ZQ0KICAgICAgICAgICAgaWYgKGRhdGFVcGRhdGUpIHsNCiAgICAgICAgICAgICAgICB0aGlzLl9hcHBlbmQoZGF0YVVwZGF0ZSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIFBlcmZvcm0gY29uY3JldGUtY2lwaGVyIGxvZ2ljDQogICAgICAgICAgICB2YXIgZmluYWxQcm9jZXNzZWREYXRhID0gdGhpcy5fZG9GaW5hbGl6ZSgpOw0KDQogICAgICAgICAgICByZXR1cm4gZmluYWxQcm9jZXNzZWREYXRhOw0KICAgICAgICB9LA0KDQogICAgICAgIGtleVNpemU6IDEyOC8zMiwNCg0KICAgICAgICBpdlNpemU6IDEyOC8zMiwNCg0KICAgICAgICBfRU5DX1hGT1JNX01PREU6IDEsDQoNCiAgICAgICAgX0RFQ19YRk9STV9NT0RFOiAyLA0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBDcmVhdGVzIHNob3J0Y3V0IGZ1bmN0aW9ucyB0byBhIGNpcGhlcidzIG9iamVjdCBpbnRlcmZhY2UuDQogICAgICAgICAqDQogICAgICAgICAqIEBwYXJhbSB7Q2lwaGVyfSBjaXBoZXIgVGhlIGNpcGhlciB0byBjcmVhdGUgYSBoZWxwZXIgZm9yLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcmV0dXJuIHtPYmplY3R9IEFuIG9iamVjdCB3aXRoIGVuY3J5cHQgYW5kIGRlY3J5cHQgc2hvcnRjdXQgZnVuY3Rpb25zLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAc3RhdGljDQogICAgICAgICAqDQogICAgICAgICAqIEBleGFtcGxlDQogICAgICAgICAqDQogICAgICAgICAqICAgICB2YXIgQUVTID0gQ3J5cHRvSlMubGliLkNpcGhlci5fY3JlYXRlSGVscGVyKENyeXB0b0pTLmFsZ28uQUVTKTsNCiAgICAgICAgICovDQogICAgICAgIF9jcmVhdGVIZWxwZXI6IChmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICBmdW5jdGlvbiBzZWxlY3RDaXBoZXJTdHJhdGVneShrZXkpIHsNCiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGtleSA9PSAnc3RyaW5nJykgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gUGFzc3dvcmRCYXNlZENpcGhlcjsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gU2VyaWFsaXphYmxlQ2lwaGVyOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChjaXBoZXIpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgICAgICAgICBlbmNyeXB0OiBmdW5jdGlvbiAobWVzc2FnZSwga2V5LCBjZmcpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxlY3RDaXBoZXJTdHJhdGVneShrZXkpLmVuY3J5cHQoY2lwaGVyLCBtZXNzYWdlLCBrZXksIGNmZyk7DQogICAgICAgICAgICAgICAgICAgIH0sDQoNCiAgICAgICAgICAgICAgICAgICAgZGVjcnlwdDogZnVuY3Rpb24gKGNpcGhlcnRleHQsIGtleSwgY2ZnKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZWN0Q2lwaGVyU3RyYXRlZ3koa2V5KS5kZWNyeXB0KGNpcGhlciwgY2lwaGVydGV4dCwga2V5LCBjZmcpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIH07DQogICAgICAgIH0oKSkNCiAgICB9KTsNCg0KICAgIC8qKg0KICAgICAqIEFic3RyYWN0IGJhc2Ugc3RyZWFtIGNpcGhlciB0ZW1wbGF0ZS4NCiAgICAgKg0KICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBibG9ja1NpemUgVGhlIG51bWJlciBvZiAzMi1iaXQgd29yZHMgdGhpcyBjaXBoZXIgb3BlcmF0ZXMgb24uIERlZmF1bHQ6IDEgKDMyIGJpdHMpDQogICAgICovDQogICAgdmFyIFN0cmVhbUNpcGhlciA9IENfbGliLlN0cmVhbUNpcGhlciA9IENpcGhlci5leHRlbmQoew0KICAgICAgICBfZG9GaW5hbGl6ZTogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgLy8gUHJvY2VzcyBwYXJ0aWFsIGJsb2Nrcw0KICAgICAgICAgICAgdmFyIGZpbmFsUHJvY2Vzc2VkQmxvY2tzID0gdGhpcy5fcHJvY2VzcyghISdmbHVzaCcpOw0KDQogICAgICAgICAgICByZXR1cm4gZmluYWxQcm9jZXNzZWRCbG9ja3M7DQogICAgICAgIH0sDQoNCiAgICAgICAgYmxvY2tTaXplOiAxDQogICAgfSk7DQoNCiAgICAvKioNCiAgICAgKiBNb2RlIG5hbWVzcGFjZS4NCiAgICAgKi8NCiAgICB2YXIgQ19tb2RlID0gQy5tb2RlID0ge307DQoNCiAgICAvKioNCiAgICAgKiBBYnN0cmFjdCBiYXNlIGJsb2NrIGNpcGhlciBtb2RlIHRlbXBsYXRlLg0KICAgICAqLw0KICAgIHZhciBCbG9ja0NpcGhlck1vZGUgPSBDX2xpYi5CbG9ja0NpcGhlck1vZGUgPSBCYXNlLmV4dGVuZCh7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBDcmVhdGVzIHRoaXMgbW9kZSBmb3IgZW5jcnlwdGlvbi4NCiAgICAgICAgICoNCiAgICAgICAgICogQHBhcmFtIHtDaXBoZXJ9IGNpcGhlciBBIGJsb2NrIGNpcGhlciBpbnN0YW5jZS4NCiAgICAgICAgICogQHBhcmFtIHtBcnJheX0gaXYgVGhlIElWIHdvcmRzLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAc3RhdGljDQogICAgICAgICAqDQogICAgICAgICAqIEBleGFtcGxlDQogICAgICAgICAqDQogICAgICAgICAqICAgICB2YXIgbW9kZSA9IENyeXB0b0pTLm1vZGUuQ0JDLmNyZWF0ZUVuY3J5cHRvcihjaXBoZXIsIGl2LndvcmRzKTsNCiAgICAgICAgICovDQogICAgICAgIGNyZWF0ZUVuY3J5cHRvcjogZnVuY3Rpb24gKGNpcGhlciwgaXYpIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLkVuY3J5cHRvci5jcmVhdGUoY2lwaGVyLCBpdik7DQogICAgICAgIH0sDQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIENyZWF0ZXMgdGhpcyBtb2RlIGZvciBkZWNyeXB0aW9uLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcGFyYW0ge0NpcGhlcn0gY2lwaGVyIEEgYmxvY2sgY2lwaGVyIGluc3RhbmNlLg0KICAgICAgICAgKiBAcGFyYW0ge0FycmF5fSBpdiBUaGUgSVYgd29yZHMuDQogICAgICAgICAqDQogICAgICAgICAqIEBzdGF0aWMNCiAgICAgICAgICoNCiAgICAgICAgICogQGV4YW1wbGUNCiAgICAgICAgICoNCiAgICAgICAgICogICAgIHZhciBtb2RlID0gQ3J5cHRvSlMubW9kZS5DQkMuY3JlYXRlRGVjcnlwdG9yKGNpcGhlciwgaXYud29yZHMpOw0KICAgICAgICAgKi8NCiAgICAgICAgY3JlYXRlRGVjcnlwdG9yOiBmdW5jdGlvbiAoY2lwaGVyLCBpdikgew0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuRGVjcnlwdG9yLmNyZWF0ZShjaXBoZXIsIGl2KTsNCiAgICAgICAgfSwNCg0KICAgICAgICAvKioNCiAgICAgICAgICogSW5pdGlhbGl6ZXMgYSBuZXdseSBjcmVhdGVkIG1vZGUuDQogICAgICAgICAqDQogICAgICAgICAqIEBwYXJhbSB7Q2lwaGVyfSBjaXBoZXIgQSBibG9jayBjaXBoZXIgaW5zdGFuY2UuDQogICAgICAgICAqIEBwYXJhbSB7QXJyYXl9IGl2IFRoZSBJViB3b3Jkcy4NCiAgICAgICAgICoNCiAgICAgICAgICogQGV4YW1wbGUNCiAgICAgICAgICoNCiAgICAgICAgICogICAgIHZhciBtb2RlID0gQ3J5cHRvSlMubW9kZS5DQkMuRW5jcnlwdG9yLmNyZWF0ZShjaXBoZXIsIGl2LndvcmRzKTsNCiAgICAgICAgICovDQogICAgICAgIGluaXQ6IGZ1bmN0aW9uIChjaXBoZXIsIGl2KSB7DQogICAgICAgICAgICB0aGlzLl9jaXBoZXIgPSBjaXBoZXI7DQogICAgICAgICAgICB0aGlzLl9pdiA9IGl2Ow0KICAgICAgICB9DQogICAgfSk7DQoNCiAgICAvKioNCiAgICAgKiBDaXBoZXIgQmxvY2sgQ2hhaW5pbmcgbW9kZS4NCiAgICAgKi8NCiAgICB2YXIgQ0JDID0gQ19tb2RlLkNCQyA9IChmdW5jdGlvbiAoKSB7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBBYnN0cmFjdCBiYXNlIENCQyBtb2RlLg0KICAgICAgICAgKi8NCiAgICAgICAgdmFyIENCQyA9IEJsb2NrQ2lwaGVyTW9kZS5leHRlbmQoKTsNCg0KICAgICAgICAvKioNCiAgICAgICAgICogQ0JDIGVuY3J5cHRvci4NCiAgICAgICAgICovDQogICAgICAgIENCQy5FbmNyeXB0b3IgPSBDQkMuZXh0ZW5kKHsNCiAgICAgICAgICAgIC8qKg0KICAgICAgICAgICAgICogUHJvY2Vzc2VzIHRoZSBkYXRhIGJsb2NrIGF0IG9mZnNldC4NCiAgICAgICAgICAgICAqDQogICAgICAgICAgICAgKiBAcGFyYW0ge0FycmF5fSB3b3JkcyBUaGUgZGF0YSB3b3JkcyB0byBvcGVyYXRlIG9uLg0KICAgICAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IG9mZnNldCBUaGUgb2Zmc2V0IHdoZXJlIHRoZSBibG9jayBzdGFydHMuDQogICAgICAgICAgICAgKg0KICAgICAgICAgICAgICogQGV4YW1wbGUNCiAgICAgICAgICAgICAqDQogICAgICAgICAgICAgKiAgICAgbW9kZS5wcm9jZXNzQmxvY2soZGF0YS53b3Jkcywgb2Zmc2V0KTsNCiAgICAgICAgICAgICAqLw0KICAgICAgICAgICAgcHJvY2Vzc0Jsb2NrOiBmdW5jdGlvbiAod29yZHMsIG9mZnNldCkgew0KICAgICAgICAgICAgICAgIC8vIFNob3J0Y3V0cw0KICAgICAgICAgICAgICAgIHZhciBjaXBoZXIgPSB0aGlzLl9jaXBoZXI7DQogICAgICAgICAgICAgICAgdmFyIGJsb2NrU2l6ZSA9IGNpcGhlci5ibG9ja1NpemU7DQoNCiAgICAgICAgICAgICAgICAvLyBYT1IgYW5kIGVuY3J5cHQNCiAgICAgICAgICAgICAgICB4b3JCbG9jay5jYWxsKHRoaXMsIHdvcmRzLCBvZmZzZXQsIGJsb2NrU2l6ZSk7DQogICAgICAgICAgICAgICAgY2lwaGVyLmVuY3J5cHRCbG9jayh3b3Jkcywgb2Zmc2V0KTsNCg0KICAgICAgICAgICAgICAgIC8vIFJlbWVtYmVyIHRoaXMgYmxvY2sgdG8gdXNlIHdpdGggbmV4dCBibG9jaw0KICAgICAgICAgICAgICAgIHRoaXMuX3ByZXZCbG9jayA9IHdvcmRzLnNsaWNlKG9mZnNldCwgb2Zmc2V0ICsgYmxvY2tTaXplKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIENCQyBkZWNyeXB0b3IuDQogICAgICAgICAqLw0KICAgICAgICBDQkMuRGVjcnlwdG9yID0gQ0JDLmV4dGVuZCh7DQogICAgICAgICAgICAvKioNCiAgICAgICAgICAgICAqIFByb2Nlc3NlcyB0aGUgZGF0YSBibG9jayBhdCBvZmZzZXQuDQogICAgICAgICAgICAgKg0KICAgICAgICAgICAgICogQHBhcmFtIHtBcnJheX0gd29yZHMgVGhlIGRhdGEgd29yZHMgdG8gb3BlcmF0ZSBvbi4NCiAgICAgICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSBvZmZzZXQgVGhlIG9mZnNldCB3aGVyZSB0aGUgYmxvY2sgc3RhcnRzLg0KICAgICAgICAgICAgICoNCiAgICAgICAgICAgICAqIEBleGFtcGxlDQogICAgICAgICAgICAgKg0KICAgICAgICAgICAgICogICAgIG1vZGUucHJvY2Vzc0Jsb2NrKGRhdGEud29yZHMsIG9mZnNldCk7DQogICAgICAgICAgICAgKi8NCiAgICAgICAgICAgIHByb2Nlc3NCbG9jazogZnVuY3Rpb24gKHdvcmRzLCBvZmZzZXQpIHsNCiAgICAgICAgICAgICAgICAvLyBTaG9ydGN1dHMNCiAgICAgICAgICAgICAgICB2YXIgY2lwaGVyID0gdGhpcy5fY2lwaGVyOw0KICAgICAgICAgICAgICAgIHZhciBibG9ja1NpemUgPSBjaXBoZXIuYmxvY2tTaXplOw0KDQogICAgICAgICAgICAgICAgLy8gUmVtZW1iZXIgdGhpcyBibG9jayB0byB1c2Ugd2l0aCBuZXh0IGJsb2NrDQogICAgICAgICAgICAgICAgdmFyIHRoaXNCbG9jayA9IHdvcmRzLnNsaWNlKG9mZnNldCwgb2Zmc2V0ICsgYmxvY2tTaXplKTsNCg0KICAgICAgICAgICAgICAgIC8vIERlY3J5cHQgYW5kIFhPUg0KICAgICAgICAgICAgICAgIGNpcGhlci5kZWNyeXB0QmxvY2sod29yZHMsIG9mZnNldCk7DQogICAgICAgICAgICAgICAgeG9yQmxvY2suY2FsbCh0aGlzLCB3b3Jkcywgb2Zmc2V0LCBibG9ja1NpemUpOw0KDQogICAgICAgICAgICAgICAgLy8gVGhpcyBibG9jayBiZWNvbWVzIHRoZSBwcmV2aW91cyBibG9jaw0KICAgICAgICAgICAgICAgIHRoaXMuX3ByZXZCbG9jayA9IHRoaXNCbG9jazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQoNCiAgICAgICAgZnVuY3Rpb24geG9yQmxvY2sod29yZHMsIG9mZnNldCwgYmxvY2tTaXplKSB7DQogICAgICAgICAgICAvLyBTaG9ydGN1dA0KICAgICAgICAgICAgdmFyIGl2ID0gdGhpcy5faXY7DQoNCiAgICAgICAgICAgIC8vIENob29zZSBtaXhpbmcgYmxvY2sNCiAgICAgICAgICAgIGlmIChpdikgew0KICAgICAgICAgICAgICAgIHZhciBibG9jayA9IGl2Ow0KDQogICAgICAgICAgICAgICAgLy8gUmVtb3ZlIElWIGZvciBzdWJzZXF1ZW50IGJsb2Nrcw0KICAgICAgICAgICAgICAgIHRoaXMuX2l2ID0gdW5kZWZpbmVkOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICB2YXIgYmxvY2sgPSB0aGlzLl9wcmV2QmxvY2s7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIFhPUiBibG9ja3MNCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYmxvY2tTaXplOyBpKyspIHsNCiAgICAgICAgICAgICAgICB3b3Jkc1tvZmZzZXQgKyBpXSBePSBibG9ja1tpXTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiBDQkM7DQogICAgfSgpKTsNCg0KICAgIC8qKg0KICAgICAqIFBhZGRpbmcgbmFtZXNwYWNlLg0KICAgICAqLw0KICAgIHZhciBDX3BhZCA9IEMucGFkID0ge307DQoNCiAgICAvKioNCiAgICAgKiBQS0NTICM1LzcgcGFkZGluZyBzdHJhdGVneS4NCiAgICAgKi8NCiAgICB2YXIgUGtjczcgPSBDX3BhZC5Qa2NzNyA9IHsNCiAgICAgICAgLyoqDQogICAgICAgICAqIFBhZHMgZGF0YSB1c2luZyB0aGUgYWxnb3JpdGhtIGRlZmluZWQgaW4gUEtDUyAjNS83Lg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcGFyYW0ge1dvcmRBcnJheX0gZGF0YSBUaGUgZGF0YSB0byBwYWQuDQogICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSBibG9ja1NpemUgVGhlIG11bHRpcGxlIHRoYXQgdGhlIGRhdGEgc2hvdWxkIGJlIHBhZGRlZCB0by4NCiAgICAgICAgICoNCiAgICAgICAgICogQHN0YXRpYw0KICAgICAgICAgKg0KICAgICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICAgKg0KICAgICAgICAgKiAgICAgQ3J5cHRvSlMucGFkLlBrY3M3LnBhZCh3b3JkQXJyYXksIDQpOw0KICAgICAgICAgKi8NCiAgICAgICAgcGFkOiBmdW5jdGlvbiAoZGF0YSwgYmxvY2tTaXplKSB7DQogICAgICAgICAgICAvLyBTaG9ydGN1dA0KICAgICAgICAgICAgdmFyIGJsb2NrU2l6ZUJ5dGVzID0gYmxvY2tTaXplICogNDsNCg0KICAgICAgICAgICAgLy8gQ291bnQgcGFkZGluZyBieXRlcw0KICAgICAgICAgICAgdmFyIG5QYWRkaW5nQnl0ZXMgPSBibG9ja1NpemVCeXRlcyAtIGRhdGEuc2lnQnl0ZXMgJSBibG9ja1NpemVCeXRlczsNCg0KICAgICAgICAgICAgLy8gQ3JlYXRlIHBhZGRpbmcgd29yZA0KICAgICAgICAgICAgdmFyIHBhZGRpbmdXb3JkID0gKG5QYWRkaW5nQnl0ZXMgPDwgMjQpIHwgKG5QYWRkaW5nQnl0ZXMgPDwgMTYpIHwgKG5QYWRkaW5nQnl0ZXMgPDwgOCkgfCBuUGFkZGluZ0J5dGVzOw0KDQogICAgICAgICAgICAvLyBDcmVhdGUgcGFkZGluZw0KICAgICAgICAgICAgdmFyIHBhZGRpbmdXb3JkcyA9IFtdOw0KICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBuUGFkZGluZ0J5dGVzOyBpICs9IDQpIHsNCiAgICAgICAgICAgICAgICBwYWRkaW5nV29yZHMucHVzaChwYWRkaW5nV29yZCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICB2YXIgcGFkZGluZyA9IFdvcmRBcnJheS5jcmVhdGUocGFkZGluZ1dvcmRzLCBuUGFkZGluZ0J5dGVzKTsNCg0KICAgICAgICAgICAgLy8gQWRkIHBhZGRpbmcNCiAgICAgICAgICAgIGRhdGEuY29uY2F0KHBhZGRpbmcpOw0KICAgICAgICB9LA0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBVbnBhZHMgZGF0YSB0aGF0IGhhZCBiZWVuIHBhZGRlZCB1c2luZyB0aGUgYWxnb3JpdGhtIGRlZmluZWQgaW4gUEtDUyAjNS83Lg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcGFyYW0ge1dvcmRBcnJheX0gZGF0YSBUaGUgZGF0YSB0byB1bnBhZC4NCiAgICAgICAgICoNCiAgICAgICAgICogQHN0YXRpYw0KICAgICAgICAgKg0KICAgICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICAgKg0KICAgICAgICAgKiAgICAgQ3J5cHRvSlMucGFkLlBrY3M3LnVucGFkKHdvcmRBcnJheSk7DQogICAgICAgICAqLw0KICAgICAgICB1bnBhZDogZnVuY3Rpb24gKGRhdGEpIHsNCiAgICAgICAgICAgIC8vIEdldCBudW1iZXIgb2YgcGFkZGluZyBieXRlcyBmcm9tIGxhc3QgYnl0ZQ0KICAgICAgICAgICAgdmFyIG5QYWRkaW5nQnl0ZXMgPSBkYXRhLndvcmRzWyhkYXRhLnNpZ0J5dGVzIC0gMSkgPj4+IDJdICYgMHhmZjsNCg0KICAgICAgICAgICAgLy8gUmVtb3ZlIHBhZGRpbmcNCiAgICAgICAgICAgIGRhdGEuc2lnQnl0ZXMgLT0gblBhZGRpbmdCeXRlczsNCiAgICAgICAgfQ0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBBYnN0cmFjdCBiYXNlIGJsb2NrIGNpcGhlciB0ZW1wbGF0ZS4NCiAgICAgKg0KICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBibG9ja1NpemUgVGhlIG51bWJlciBvZiAzMi1iaXQgd29yZHMgdGhpcyBjaXBoZXIgb3BlcmF0ZXMgb24uIERlZmF1bHQ6IDQgKDEyOCBiaXRzKQ0KICAgICAqLw0KICAgIHZhciBCbG9ja0NpcGhlciA9IENfbGliLkJsb2NrQ2lwaGVyID0gQ2lwaGVyLmV4dGVuZCh7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBDb25maWd1cmF0aW9uIG9wdGlvbnMuDQogICAgICAgICAqDQogICAgICAgICAqIEBwcm9wZXJ0eSB7TW9kZX0gbW9kZSBUaGUgYmxvY2sgbW9kZSB0byB1c2UuIERlZmF1bHQ6IENCQw0KICAgICAgICAgKiBAcHJvcGVydHkge1BhZGRpbmd9IHBhZGRpbmcgVGhlIHBhZGRpbmcgc3RyYXRlZ3kgdG8gdXNlLiBEZWZhdWx0OiBQa2NzNw0KICAgICAgICAgKi8NCiAgICAgICAgY2ZnOiBDaXBoZXIuY2ZnLmV4dGVuZCh7DQogICAgICAgICAgICBtb2RlOiBDQkMsDQogICAgICAgICAgICBwYWRkaW5nOiBQa2NzNw0KICAgICAgICB9KSwNCg0KICAgICAgICByZXNldDogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgLy8gUmVzZXQgY2lwaGVyDQogICAgICAgICAgICBDaXBoZXIucmVzZXQuY2FsbCh0aGlzKTsNCg0KICAgICAgICAgICAgLy8gU2hvcnRjdXRzDQogICAgICAgICAgICB2YXIgY2ZnID0gdGhpcy5jZmc7DQogICAgICAgICAgICB2YXIgaXYgPSBjZmcuaXY7DQogICAgICAgICAgICB2YXIgbW9kZSA9IGNmZy5tb2RlOw0KDQogICAgICAgICAgICAvLyBSZXNldCBibG9jayBtb2RlDQogICAgICAgICAgICBpZiAodGhpcy5feGZvcm1Nb2RlID09IHRoaXMuX0VOQ19YRk9STV9NT0RFKSB7DQogICAgICAgICAgICAgICAgdmFyIG1vZGVDcmVhdG9yID0gbW9kZS5jcmVhdGVFbmNyeXB0b3I7DQogICAgICAgICAgICB9IGVsc2UgLyogaWYgKHRoaXMuX3hmb3JtTW9kZSA9PSB0aGlzLl9ERUNfWEZPUk1fTU9ERSkgKi8gew0KICAgICAgICAgICAgICAgIHZhciBtb2RlQ3JlYXRvciA9IG1vZGUuY3JlYXRlRGVjcnlwdG9yOw0KDQogICAgICAgICAgICAgICAgLy8gS2VlcCBhdCBsZWFzdCBvbmUgYmxvY2sgaW4gdGhlIGJ1ZmZlciBmb3IgdW5wYWRkaW5nDQogICAgICAgICAgICAgICAgdGhpcy5fbWluQnVmZmVyU2l6ZSA9IDE7DQogICAgICAgICAgICB9DQogICAgICAgICAgICB0aGlzLl9tb2RlID0gbW9kZUNyZWF0b3IuY2FsbChtb2RlLCB0aGlzLCBpdiAmJiBpdi53b3Jkcyk7DQogICAgICAgIH0sDQoNCiAgICAgICAgX2RvUHJvY2Vzc0Jsb2NrOiBmdW5jdGlvbiAod29yZHMsIG9mZnNldCkgew0KICAgICAgICAgICAgdGhpcy5fbW9kZS5wcm9jZXNzQmxvY2sod29yZHMsIG9mZnNldCk7DQogICAgICAgIH0sDQoNCiAgICAgICAgX2RvRmluYWxpemU6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIC8vIFNob3J0Y3V0DQogICAgICAgICAgICB2YXIgcGFkZGluZyA9IHRoaXMuY2ZnLnBhZGRpbmc7DQoNCiAgICAgICAgICAgIC8vIEZpbmFsaXplDQogICAgICAgICAgICBpZiAodGhpcy5feGZvcm1Nb2RlID09IHRoaXMuX0VOQ19YRk9STV9NT0RFKSB7DQogICAgICAgICAgICAgICAgLy8gUGFkIGRhdGENCiAgICAgICAgICAgICAgICBwYWRkaW5nLnBhZCh0aGlzLl9kYXRhLCB0aGlzLmJsb2NrU2l6ZSk7DQoNCiAgICAgICAgICAgICAgICAvLyBQcm9jZXNzIGZpbmFsIGJsb2Nrcw0KICAgICAgICAgICAgICAgIHZhciBmaW5hbFByb2Nlc3NlZEJsb2NrcyA9IHRoaXMuX3Byb2Nlc3MoISEnZmx1c2gnKTsNCiAgICAgICAgICAgIH0gZWxzZSAvKiBpZiAodGhpcy5feGZvcm1Nb2RlID09IHRoaXMuX0RFQ19YRk9STV9NT0RFKSAqLyB7DQogICAgICAgICAgICAgICAgLy8gUHJvY2VzcyBmaW5hbCBibG9ja3MNCiAgICAgICAgICAgICAgICB2YXIgZmluYWxQcm9jZXNzZWRCbG9ja3MgPSB0aGlzLl9wcm9jZXNzKCEhJ2ZsdXNoJyk7DQoNCiAgICAgICAgICAgICAgICAvLyBVbnBhZCBkYXRhDQogICAgICAgICAgICAgICAgcGFkZGluZy51bnBhZChmaW5hbFByb2Nlc3NlZEJsb2Nrcyk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBmaW5hbFByb2Nlc3NlZEJsb2NrczsNCiAgICAgICAgfSwNCg0KICAgICAgICBibG9ja1NpemU6IDEyOC8zMg0KICAgIH0pOw0KDQogICAgLyoqDQogICAgICogQSBjb2xsZWN0aW9uIG9mIGNpcGhlciBwYXJhbWV0ZXJzLg0KICAgICAqDQogICAgICogQHByb3BlcnR5IHtXb3JkQXJyYXl9IGNpcGhlcnRleHQgVGhlIHJhdyBjaXBoZXJ0ZXh0Lg0KICAgICAqIEBwcm9wZXJ0eSB7V29yZEFycmF5fSBrZXkgVGhlIGtleSB0byB0aGlzIGNpcGhlcnRleHQuDQogICAgICogQHByb3BlcnR5IHtXb3JkQXJyYXl9IGl2IFRoZSBJViB1c2VkIGluIHRoZSBjaXBoZXJpbmcgb3BlcmF0aW9uLg0KICAgICAqIEBwcm9wZXJ0eSB7V29yZEFycmF5fSBzYWx0IFRoZSBzYWx0IHVzZWQgd2l0aCBhIGtleSBkZXJpdmF0aW9uIGZ1bmN0aW9uLg0KICAgICAqIEBwcm9wZXJ0eSB7Q2lwaGVyfSBhbGdvcml0aG0gVGhlIGNpcGhlciBhbGdvcml0aG0uDQogICAgICogQHByb3BlcnR5IHtNb2RlfSBtb2RlIFRoZSBibG9jayBtb2RlIHVzZWQgaW4gdGhlIGNpcGhlcmluZyBvcGVyYXRpb24uDQogICAgICogQHByb3BlcnR5IHtQYWRkaW5nfSBwYWRkaW5nIFRoZSBwYWRkaW5nIHNjaGVtZSB1c2VkIGluIHRoZSBjaXBoZXJpbmcgb3BlcmF0aW9uLg0KICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBibG9ja1NpemUgVGhlIGJsb2NrIHNpemUgb2YgdGhlIGNpcGhlci4NCiAgICAgKiBAcHJvcGVydHkge0Zvcm1hdH0gZm9ybWF0dGVyIFRoZSBkZWZhdWx0IGZvcm1hdHRpbmcgc3RyYXRlZ3kgdG8gY29udmVydCB0aGlzIGNpcGhlciBwYXJhbXMgb2JqZWN0IHRvIGEgc3RyaW5nLg0KICAgICAqLw0KICAgIHZhciBDaXBoZXJQYXJhbXMgPSBDX2xpYi5DaXBoZXJQYXJhbXMgPSBCYXNlLmV4dGVuZCh7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBJbml0aWFsaXplcyBhIG5ld2x5IGNyZWF0ZWQgY2lwaGVyIHBhcmFtcyBvYmplY3QuDQogICAgICAgICAqDQogICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjaXBoZXJQYXJhbXMgQW4gb2JqZWN0IHdpdGggYW55IG9mIHRoZSBwb3NzaWJsZSBjaXBoZXIgcGFyYW1ldGVycy4NCiAgICAgICAgICoNCiAgICAgICAgICogQGV4YW1wbGUNCiAgICAgICAgICoNCiAgICAgICAgICogICAgIHZhciBjaXBoZXJQYXJhbXMgPSBDcnlwdG9KUy5saWIuQ2lwaGVyUGFyYW1zLmNyZWF0ZSh7DQogICAgICAgICAqICAgICAgICAgY2lwaGVydGV4dDogY2lwaGVydGV4dFdvcmRBcnJheSwNCiAgICAgICAgICogICAgICAgICBrZXk6IGtleVdvcmRBcnJheSwNCiAgICAgICAgICogICAgICAgICBpdjogaXZXb3JkQXJyYXksDQogICAgICAgICAqICAgICAgICAgc2FsdDogc2FsdFdvcmRBcnJheSwNCiAgICAgICAgICogICAgICAgICBhbGdvcml0aG06IENyeXB0b0pTLmFsZ28uQUVTLA0KICAgICAgICAgKiAgICAgICAgIG1vZGU6IENyeXB0b0pTLm1vZGUuQ0JDLA0KICAgICAgICAgKiAgICAgICAgIHBhZGRpbmc6IENyeXB0b0pTLnBhZC5QS0NTNywNCiAgICAgICAgICogICAgICAgICBibG9ja1NpemU6IDQsDQogICAgICAgICAqICAgICAgICAgZm9ybWF0dGVyOiBDcnlwdG9KUy5mb3JtYXQuT3BlblNTTA0KICAgICAgICAgKiAgICAgfSk7DQogICAgICAgICAqLw0KICAgICAgICBpbml0OiBmdW5jdGlvbiAoY2lwaGVyUGFyYW1zKSB7DQogICAgICAgICAgICB0aGlzLm1peEluKGNpcGhlclBhcmFtcyk7DQogICAgICAgIH0sDQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIENvbnZlcnRzIHRoaXMgY2lwaGVyIHBhcmFtcyBvYmplY3QgdG8gYSBzdHJpbmcuDQogICAgICAgICAqDQogICAgICAgICAqIEBwYXJhbSB7Rm9ybWF0fSBmb3JtYXR0ZXIgKE9wdGlvbmFsKSBUaGUgZm9ybWF0dGluZyBzdHJhdGVneSB0byB1c2UuDQogICAgICAgICAqDQogICAgICAgICAqIEByZXR1cm4ge3N0cmluZ30gVGhlIHN0cmluZ2lmaWVkIGNpcGhlciBwYXJhbXMuDQogICAgICAgICAqDQogICAgICAgICAqIEB0aHJvd3MgRXJyb3IgSWYgbmVpdGhlciB0aGUgZm9ybWF0dGVyIG5vciB0aGUgZGVmYXVsdCBmb3JtYXR0ZXIgaXMgc2V0Lg0KICAgICAgICAgKg0KICAgICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICAgKg0KICAgICAgICAgKiAgICAgdmFyIHN0cmluZyA9IGNpcGhlclBhcmFtcyArICcnOw0KICAgICAgICAgKiAgICAgdmFyIHN0cmluZyA9IGNpcGhlclBhcmFtcy50b1N0cmluZygpOw0KICAgICAgICAgKiAgICAgdmFyIHN0cmluZyA9IGNpcGhlclBhcmFtcy50b1N0cmluZyhDcnlwdG9KUy5mb3JtYXQuT3BlblNTTCk7DQogICAgICAgICAqLw0KICAgICAgICB0b1N0cmluZzogZnVuY3Rpb24gKGZvcm1hdHRlcikgew0KICAgICAgICAgICAgcmV0dXJuIChmb3JtYXR0ZXIgfHwgdGhpcy5mb3JtYXR0ZXIpLnN0cmluZ2lmeSh0aGlzKTsNCiAgICAgICAgfQ0KICAgIH0pOw0KDQogICAgLyoqDQogICAgICogRm9ybWF0IG5hbWVzcGFjZS4NCiAgICAgKi8NCiAgICB2YXIgQ19mb3JtYXQgPSBDLmZvcm1hdCA9IHt9Ow0KDQogICAgLyoqDQogICAgICogT3BlblNTTCBmb3JtYXR0aW5nIHN0cmF0ZWd5Lg0KICAgICAqLw0KICAgIHZhciBPcGVuU1NMRm9ybWF0dGVyID0gQ19mb3JtYXQuT3BlblNTTCA9IHsNCiAgICAgICAgLyoqDQogICAgICAgICAqIENvbnZlcnRzIGEgY2lwaGVyIHBhcmFtcyBvYmplY3QgdG8gYW4gT3BlblNTTC1jb21wYXRpYmxlIHN0cmluZy4NCiAgICAgICAgICoNCiAgICAgICAgICogQHBhcmFtIHtDaXBoZXJQYXJhbXN9IGNpcGhlclBhcmFtcyBUaGUgY2lwaGVyIHBhcmFtcyBvYmplY3QuDQogICAgICAgICAqDQogICAgICAgICAqIEByZXR1cm4ge3N0cmluZ30gVGhlIE9wZW5TU0wtY29tcGF0aWJsZSBzdHJpbmcuDQogICAgICAgICAqDQogICAgICAgICAqIEBzdGF0aWMNCiAgICAgICAgICoNCiAgICAgICAgICogQGV4YW1wbGUNCiAgICAgICAgICoNCiAgICAgICAgICogICAgIHZhciBvcGVuU1NMU3RyaW5nID0gQ3J5cHRvSlMuZm9ybWF0Lk9wZW5TU0wuc3RyaW5naWZ5KGNpcGhlclBhcmFtcyk7DQogICAgICAgICAqLw0KICAgICAgICBzdHJpbmdpZnk6IGZ1bmN0aW9uIChjaXBoZXJQYXJhbXMpIHsNCiAgICAgICAgICAgIC8vIFNob3J0Y3V0cw0KICAgICAgICAgICAgdmFyIGNpcGhlcnRleHQgPSBjaXBoZXJQYXJhbXMuY2lwaGVydGV4dDsNCiAgICAgICAgICAgIHZhciBzYWx0ID0gY2lwaGVyUGFyYW1zLnNhbHQ7DQoNCiAgICAgICAgICAgIC8vIEZvcm1hdA0KICAgICAgICAgICAgaWYgKHNhbHQpIHsNCiAgICAgICAgICAgICAgICB2YXIgd29yZEFycmF5ID0gV29yZEFycmF5LmNyZWF0ZShbMHg1MzYxNmM3NCwgMHg2NTY0NWY1Zl0pLmNvbmNhdChzYWx0KS5jb25jYXQoY2lwaGVydGV4dCk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIHZhciB3b3JkQXJyYXkgPSBjaXBoZXJ0ZXh0Ow0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gd29yZEFycmF5LnRvU3RyaW5nKEJhc2U2NCk7DQogICAgICAgIH0sDQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIENvbnZlcnRzIGFuIE9wZW5TU0wtY29tcGF0aWJsZSBzdHJpbmcgdG8gYSBjaXBoZXIgcGFyYW1zIG9iamVjdC4NCiAgICAgICAgICoNCiAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IG9wZW5TU0xTdHIgVGhlIE9wZW5TU0wtY29tcGF0aWJsZSBzdHJpbmcuDQogICAgICAgICAqDQogICAgICAgICAqIEByZXR1cm4ge0NpcGhlclBhcmFtc30gVGhlIGNpcGhlciBwYXJhbXMgb2JqZWN0Lg0KICAgICAgICAgKg0KICAgICAgICAgKiBAc3RhdGljDQogICAgICAgICAqDQogICAgICAgICAqIEBleGFtcGxlDQogICAgICAgICAqDQogICAgICAgICAqICAgICB2YXIgY2lwaGVyUGFyYW1zID0gQ3J5cHRvSlMuZm9ybWF0Lk9wZW5TU0wucGFyc2Uob3BlblNTTFN0cmluZyk7DQogICAgICAgICAqLw0KICAgICAgICBwYXJzZTogZnVuY3Rpb24gKG9wZW5TU0xTdHIpIHsNCiAgICAgICAgICAgIC8vIFBhcnNlIGJhc2U2NA0KICAgICAgICAgICAgdmFyIGNpcGhlcnRleHQgPSBCYXNlNjQucGFyc2Uob3BlblNTTFN0cik7DQoNCiAgICAgICAgICAgIC8vIFNob3J0Y3V0DQogICAgICAgICAgICB2YXIgY2lwaGVydGV4dFdvcmRzID0gY2lwaGVydGV4dC53b3JkczsNCg0KICAgICAgICAgICAgLy8gVGVzdCBmb3Igc2FsdA0KICAgICAgICAgICAgaWYgKGNpcGhlcnRleHRXb3Jkc1swXSA9PSAweDUzNjE2Yzc0ICYmIGNpcGhlcnRleHRXb3Jkc1sxXSA9PSAweDY1NjQ1ZjVmKSB7DQogICAgICAgICAgICAgICAgLy8gRXh0cmFjdCBzYWx0DQogICAgICAgICAgICAgICAgdmFyIHNhbHQgPSBXb3JkQXJyYXkuY3JlYXRlKGNpcGhlcnRleHRXb3Jkcy5zbGljZSgyLCA0KSk7DQoNCiAgICAgICAgICAgICAgICAvLyBSZW1vdmUgc2FsdCBmcm9tIGNpcGhlcnRleHQNCiAgICAgICAgICAgICAgICBjaXBoZXJ0ZXh0V29yZHMuc3BsaWNlKDAsIDQpOw0KICAgICAgICAgICAgICAgIGNpcGhlcnRleHQuc2lnQnl0ZXMgLT0gMTY7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBDaXBoZXJQYXJhbXMuY3JlYXRlKHsgY2lwaGVydGV4dDogY2lwaGVydGV4dCwgc2FsdDogc2FsdCB9KTsNCiAgICAgICAgfQ0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBBIGNpcGhlciB3cmFwcGVyIHRoYXQgcmV0dXJucyBjaXBoZXJ0ZXh0IGFzIGEgc2VyaWFsaXphYmxlIGNpcGhlciBwYXJhbXMgb2JqZWN0Lg0KICAgICAqLw0KICAgIHZhciBTZXJpYWxpemFibGVDaXBoZXIgPSBDX2xpYi5TZXJpYWxpemFibGVDaXBoZXIgPSBCYXNlLmV4dGVuZCh7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBDb25maWd1cmF0aW9uIG9wdGlvbnMuDQogICAgICAgICAqDQogICAgICAgICAqIEBwcm9wZXJ0eSB7Rm9ybWF0dGVyfSBmb3JtYXQgVGhlIGZvcm1hdHRpbmcgc3RyYXRlZ3kgdG8gY29udmVydCBjaXBoZXIgcGFyYW0gb2JqZWN0cyB0byBhbmQgZnJvbSBhIHN0cmluZy4gRGVmYXVsdDogT3BlblNTTA0KICAgICAgICAgKi8NCiAgICAgICAgY2ZnOiBCYXNlLmV4dGVuZCh7DQogICAgICAgICAgICBmb3JtYXQ6IE9wZW5TU0xGb3JtYXR0ZXINCiAgICAgICAgfSksDQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIEVuY3J5cHRzIGEgbWVzc2FnZS4NCiAgICAgICAgICoNCiAgICAgICAgICogQHBhcmFtIHtDaXBoZXJ9IGNpcGhlciBUaGUgY2lwaGVyIGFsZ29yaXRobSB0byB1c2UuDQogICAgICAgICAqIEBwYXJhbSB7V29yZEFycmF5fHN0cmluZ30gbWVzc2FnZSBUaGUgbWVzc2FnZSB0byBlbmNyeXB0Lg0KICAgICAgICAgKiBAcGFyYW0ge1dvcmRBcnJheX0ga2V5IFRoZSBrZXkuDQogICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjZmcgKE9wdGlvbmFsKSBUaGUgY29uZmlndXJhdGlvbiBvcHRpb25zIHRvIHVzZSBmb3IgdGhpcyBvcGVyYXRpb24uDQogICAgICAgICAqDQogICAgICAgICAqIEByZXR1cm4ge0NpcGhlclBhcmFtc30gQSBjaXBoZXIgcGFyYW1zIG9iamVjdC4NCiAgICAgICAgICoNCiAgICAgICAgICogQHN0YXRpYw0KICAgICAgICAgKg0KICAgICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICAgKg0KICAgICAgICAgKiAgICAgdmFyIGNpcGhlcnRleHRQYXJhbXMgPSBDcnlwdG9KUy5saWIuU2VyaWFsaXphYmxlQ2lwaGVyLmVuY3J5cHQoQ3J5cHRvSlMuYWxnby5BRVMsIG1lc3NhZ2UsIGtleSk7DQogICAgICAgICAqICAgICB2YXIgY2lwaGVydGV4dFBhcmFtcyA9IENyeXB0b0pTLmxpYi5TZXJpYWxpemFibGVDaXBoZXIuZW5jcnlwdChDcnlwdG9KUy5hbGdvLkFFUywgbWVzc2FnZSwga2V5LCB7IGl2OiBpdiB9KTsNCiAgICAgICAgICogICAgIHZhciBjaXBoZXJ0ZXh0UGFyYW1zID0gQ3J5cHRvSlMubGliLlNlcmlhbGl6YWJsZUNpcGhlci5lbmNyeXB0KENyeXB0b0pTLmFsZ28uQUVTLCBtZXNzYWdlLCBrZXksIHsgaXY6IGl2LCBmb3JtYXQ6IENyeXB0b0pTLmZvcm1hdC5PcGVuU1NMIH0pOw0KICAgICAgICAgKi8NCiAgICAgICAgZW5jcnlwdDogZnVuY3Rpb24gKGNpcGhlciwgbWVzc2FnZSwga2V5LCBjZmcpIHsNCiAgICAgICAgICAgIC8vIEFwcGx5IGNvbmZpZyBkZWZhdWx0cw0KICAgICAgICAgICAgY2ZnID0gdGhpcy5jZmcuZXh0ZW5kKGNmZyk7DQoNCiAgICAgICAgICAgIC8vIEVuY3J5cHQNCiAgICAgICAgICAgIHZhciBlbmNyeXB0b3IgPSBjaXBoZXIuY3JlYXRlRW5jcnlwdG9yKGtleSwgY2ZnKTsNCiAgICAgICAgICAgIHZhciBjaXBoZXJ0ZXh0ID0gZW5jcnlwdG9yLmZpbmFsaXplKG1lc3NhZ2UpOw0KDQogICAgICAgICAgICAvLyBTaG9ydGN1dA0KICAgICAgICAgICAgdmFyIGNpcGhlckNmZyA9IGVuY3J5cHRvci5jZmc7DQoNCiAgICAgICAgICAgIC8vIENyZWF0ZSBhbmQgcmV0dXJuIHNlcmlhbGl6YWJsZSBjaXBoZXIgcGFyYW1zDQogICAgICAgICAgICByZXR1cm4gQ2lwaGVyUGFyYW1zLmNyZWF0ZSh7DQogICAgICAgICAgICAgICAgY2lwaGVydGV4dDogY2lwaGVydGV4dCwNCiAgICAgICAgICAgICAgICBrZXk6IGtleSwNCiAgICAgICAgICAgICAgICBpdjogY2lwaGVyQ2ZnLml2LA0KICAgICAgICAgICAgICAgIGFsZ29yaXRobTogY2lwaGVyLA0KICAgICAgICAgICAgICAgIG1vZGU6IGNpcGhlckNmZy5tb2RlLA0KICAgICAgICAgICAgICAgIHBhZGRpbmc6IGNpcGhlckNmZy5wYWRkaW5nLA0KICAgICAgICAgICAgICAgIGJsb2NrU2l6ZTogY2lwaGVyLmJsb2NrU2l6ZSwNCiAgICAgICAgICAgICAgICBmb3JtYXR0ZXI6IGNmZy5mb3JtYXQNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9LA0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBEZWNyeXB0cyBzZXJpYWxpemVkIGNpcGhlcnRleHQuDQogICAgICAgICAqDQogICAgICAgICAqIEBwYXJhbSB7Q2lwaGVyfSBjaXBoZXIgVGhlIGNpcGhlciBhbGdvcml0aG0gdG8gdXNlLg0KICAgICAgICAgKiBAcGFyYW0ge0NpcGhlclBhcmFtc3xzdHJpbmd9IGNpcGhlcnRleHQgVGhlIGNpcGhlcnRleHQgdG8gZGVjcnlwdC4NCiAgICAgICAgICogQHBhcmFtIHtXb3JkQXJyYXl9IGtleSBUaGUga2V5Lg0KICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gY2ZnIChPcHRpb25hbCkgVGhlIGNvbmZpZ3VyYXRpb24gb3B0aW9ucyB0byB1c2UgZm9yIHRoaXMgb3BlcmF0aW9uLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcmV0dXJuIHtXb3JkQXJyYXl9IFRoZSBwbGFpbnRleHQuDQogICAgICAgICAqDQogICAgICAgICAqIEBzdGF0aWMNCiAgICAgICAgICoNCiAgICAgICAgICogQGV4YW1wbGUNCiAgICAgICAgICoNCiAgICAgICAgICogICAgIHZhciBwbGFpbnRleHQgPSBDcnlwdG9KUy5saWIuU2VyaWFsaXphYmxlQ2lwaGVyLmRlY3J5cHQoQ3J5cHRvSlMuYWxnby5BRVMsIGZvcm1hdHRlZENpcGhlcnRleHQsIGtleSwgeyBpdjogaXYsIGZvcm1hdDogQ3J5cHRvSlMuZm9ybWF0Lk9wZW5TU0wgfSk7DQogICAgICAgICAqICAgICB2YXIgcGxhaW50ZXh0ID0gQ3J5cHRvSlMubGliLlNlcmlhbGl6YWJsZUNpcGhlci5kZWNyeXB0KENyeXB0b0pTLmFsZ28uQUVTLCBjaXBoZXJ0ZXh0UGFyYW1zLCBrZXksIHsgaXY6IGl2LCBmb3JtYXQ6IENyeXB0b0pTLmZvcm1hdC5PcGVuU1NMIH0pOw0KICAgICAgICAgKi8NCiAgICAgICAgZGVjcnlwdDogZnVuY3Rpb24gKGNpcGhlciwgY2lwaGVydGV4dCwga2V5LCBjZmcpIHsNCiAgICAgICAgICAgIC8vIEFwcGx5IGNvbmZpZyBkZWZhdWx0cw0KICAgICAgICAgICAgY2ZnID0gdGhpcy5jZmcuZXh0ZW5kKGNmZyk7DQoNCiAgICAgICAgICAgIC8vIENvbnZlcnQgc3RyaW5nIHRvIENpcGhlclBhcmFtcw0KICAgICAgICAgICAgY2lwaGVydGV4dCA9IHRoaXMuX3BhcnNlKGNpcGhlcnRleHQsIGNmZy5mb3JtYXQpOw0KDQogICAgICAgICAgICAvLyBEZWNyeXB0DQogICAgICAgICAgICB2YXIgcGxhaW50ZXh0ID0gY2lwaGVyLmNyZWF0ZURlY3J5cHRvcihrZXksIGNmZykuZmluYWxpemUoY2lwaGVydGV4dC5jaXBoZXJ0ZXh0KTsNCg0KICAgICAgICAgICAgcmV0dXJuIHBsYWludGV4dDsNCiAgICAgICAgfSwNCg0KICAgICAgICAvKioNCiAgICAgICAgICogQ29udmVydHMgc2VyaWFsaXplZCBjaXBoZXJ0ZXh0IHRvIENpcGhlclBhcmFtcywNCiAgICAgICAgICogZWxzZSBhc3N1bWVkIENpcGhlclBhcmFtcyBhbHJlYWR5IGFuZCByZXR1cm5zIGNpcGhlcnRleHQgdW5jaGFuZ2VkLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcGFyYW0ge0NpcGhlclBhcmFtc3xzdHJpbmd9IGNpcGhlcnRleHQgVGhlIGNpcGhlcnRleHQuDQogICAgICAgICAqIEBwYXJhbSB7Rm9ybWF0dGVyfSBmb3JtYXQgVGhlIGZvcm1hdHRpbmcgc3RyYXRlZ3kgdG8gdXNlIHRvIHBhcnNlIHNlcmlhbGl6ZWQgY2lwaGVydGV4dC4NCiAgICAgICAgICoNCiAgICAgICAgICogQHJldHVybiB7Q2lwaGVyUGFyYW1zfSBUaGUgdW5zZXJpYWxpemVkIGNpcGhlcnRleHQuDQogICAgICAgICAqDQogICAgICAgICAqIEBzdGF0aWMNCiAgICAgICAgICoNCiAgICAgICAgICogQGV4YW1wbGUNCiAgICAgICAgICoNCiAgICAgICAgICogICAgIHZhciBjaXBoZXJ0ZXh0UGFyYW1zID0gQ3J5cHRvSlMubGliLlNlcmlhbGl6YWJsZUNpcGhlci5fcGFyc2UoY2lwaGVydGV4dFN0cmluZ09yUGFyYW1zLCBmb3JtYXQpOw0KICAgICAgICAgKi8NCiAgICAgICAgX3BhcnNlOiBmdW5jdGlvbiAoY2lwaGVydGV4dCwgZm9ybWF0KSB7DQogICAgICAgICAgICBpZiAodHlwZW9mIGNpcGhlcnRleHQgPT0gJ3N0cmluZycpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZm9ybWF0LnBhcnNlKGNpcGhlcnRleHQsIHRoaXMpOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gY2lwaGVydGV4dDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0pOw0KDQogICAgLyoqDQogICAgICogS2V5IGRlcml2YXRpb24gZnVuY3Rpb24gbmFtZXNwYWNlLg0KICAgICAqLw0KICAgIHZhciBDX2tkZiA9IEMua2RmID0ge307DQoNCiAgICAvKioNCiAgICAgKiBPcGVuU1NMIGtleSBkZXJpdmF0aW9uIGZ1bmN0aW9uLg0KICAgICAqLw0KICAgIHZhciBPcGVuU1NMS2RmID0gQ19rZGYuT3BlblNTTCA9IHsNCiAgICAgICAgLyoqDQogICAgICAgICAqIERlcml2ZXMgYSBrZXkgYW5kIElWIGZyb20gYSBwYXNzd29yZC4NCiAgICAgICAgICoNCiAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IHBhc3N3b3JkIFRoZSBwYXNzd29yZCB0byBkZXJpdmUgZnJvbS4NCiAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IGtleVNpemUgVGhlIHNpemUgaW4gd29yZHMgb2YgdGhlIGtleSB0byBnZW5lcmF0ZS4NCiAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IGl2U2l6ZSBUaGUgc2l6ZSBpbiB3b3JkcyBvZiB0aGUgSVYgdG8gZ2VuZXJhdGUuDQogICAgICAgICAqIEBwYXJhbSB7V29yZEFycmF5fHN0cmluZ30gc2FsdCAoT3B0aW9uYWwpIEEgNjQtYml0IHNhbHQgdG8gdXNlLiBJZiBvbWl0dGVkLCBhIHNhbHQgd2lsbCBiZSBnZW5lcmF0ZWQgcmFuZG9tbHkuDQogICAgICAgICAqDQogICAgICAgICAqIEByZXR1cm4ge0NpcGhlclBhcmFtc30gQSBjaXBoZXIgcGFyYW1zIG9iamVjdCB3aXRoIHRoZSBrZXksIElWLCBhbmQgc2FsdC4NCiAgICAgICAgICoNCiAgICAgICAgICogQHN0YXRpYw0KICAgICAgICAgKg0KICAgICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICAgKg0KICAgICAgICAgKiAgICAgdmFyIGRlcml2ZWRQYXJhbXMgPSBDcnlwdG9KUy5rZGYuT3BlblNTTC5leGVjdXRlKCdQYXNzd29yZCcsIDI1Ni8zMiwgMTI4LzMyKTsNCiAgICAgICAgICogICAgIHZhciBkZXJpdmVkUGFyYW1zID0gQ3J5cHRvSlMua2RmLk9wZW5TU0wuZXhlY3V0ZSgnUGFzc3dvcmQnLCAyNTYvMzIsIDEyOC8zMiwgJ3NhbHRzYWx0Jyk7DQogICAgICAgICAqLw0KICAgICAgICBleGVjdXRlOiBmdW5jdGlvbiAocGFzc3dvcmQsIGtleVNpemUsIGl2U2l6ZSwgc2FsdCkgew0KICAgICAgICAgICAgLy8gR2VuZXJhdGUgcmFuZG9tIHNhbHQNCiAgICAgICAgICAgIGlmICghc2FsdCkgew0KICAgICAgICAgICAgICAgIHNhbHQgPSBXb3JkQXJyYXkucmFuZG9tKDY0LzgpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBEZXJpdmUga2V5IGFuZCBJVg0KICAgICAgICAgICAgdmFyIGtleSA9IEV2cEtERi5jcmVhdGUoeyBrZXlTaXplOiBrZXlTaXplICsgaXZTaXplIH0pLmNvbXB1dGUocGFzc3dvcmQsIHNhbHQpOw0KDQogICAgICAgICAgICAvLyBTZXBhcmF0ZSBrZXkgYW5kIElWDQogICAgICAgICAgICB2YXIgaXYgPSBXb3JkQXJyYXkuY3JlYXRlKGtleS53b3Jkcy5zbGljZShrZXlTaXplKSwgaXZTaXplICogNCk7DQogICAgICAgICAgICBrZXkuc2lnQnl0ZXMgPSBrZXlTaXplICogNDsNCg0KICAgICAgICAgICAgLy8gUmV0dXJuIHBhcmFtcw0KICAgICAgICAgICAgcmV0dXJuIENpcGhlclBhcmFtcy5jcmVhdGUoeyBrZXk6IGtleSwgaXY6IGl2LCBzYWx0OiBzYWx0IH0pOw0KICAgICAgICB9DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIEEgc2VyaWFsaXphYmxlIGNpcGhlciB3cmFwcGVyIHRoYXQgZGVyaXZlcyB0aGUga2V5IGZyb20gYSBwYXNzd29yZCwNCiAgICAgKiBhbmQgcmV0dXJucyBjaXBoZXJ0ZXh0IGFzIGEgc2VyaWFsaXphYmxlIGNpcGhlciBwYXJhbXMgb2JqZWN0Lg0KICAgICAqLw0KICAgIHZhciBQYXNzd29yZEJhc2VkQ2lwaGVyID0gQ19saWIuUGFzc3dvcmRCYXNlZENpcGhlciA9IFNlcmlhbGl6YWJsZUNpcGhlci5leHRlbmQoew0KICAgICAgICAvKioNCiAgICAgICAgICogQ29uZmlndXJhdGlvbiBvcHRpb25zLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcHJvcGVydHkge0tERn0ga2RmIFRoZSBrZXkgZGVyaXZhdGlvbiBmdW5jdGlvbiB0byB1c2UgdG8gZ2VuZXJhdGUgYSBrZXkgYW5kIElWIGZyb20gYSBwYXNzd29yZC4gRGVmYXVsdDogT3BlblNTTA0KICAgICAgICAgKi8NCiAgICAgICAgY2ZnOiBTZXJpYWxpemFibGVDaXBoZXIuY2ZnLmV4dGVuZCh7DQogICAgICAgICAgICBrZGY6IE9wZW5TU0xLZGYNCiAgICAgICAgfSksDQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIEVuY3J5cHRzIGEgbWVzc2FnZSB1c2luZyBhIHBhc3N3b3JkLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcGFyYW0ge0NpcGhlcn0gY2lwaGVyIFRoZSBjaXBoZXIgYWxnb3JpdGhtIHRvIHVzZS4NCiAgICAgICAgICogQHBhcmFtIHtXb3JkQXJyYXl8c3RyaW5nfSBtZXNzYWdlIFRoZSBtZXNzYWdlIHRvIGVuY3J5cHQuDQogICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBwYXNzd29yZCBUaGUgcGFzc3dvcmQuDQogICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjZmcgKE9wdGlvbmFsKSBUaGUgY29uZmlndXJhdGlvbiBvcHRpb25zIHRvIHVzZSBmb3IgdGhpcyBvcGVyYXRpb24uDQogICAgICAgICAqDQogICAgICAgICAqIEByZXR1cm4ge0NpcGhlclBhcmFtc30gQSBjaXBoZXIgcGFyYW1zIG9iamVjdC4NCiAgICAgICAgICoNCiAgICAgICAgICogQHN0YXRpYw0KICAgICAgICAgKg0KICAgICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICAgKg0KICAgICAgICAgKiAgICAgdmFyIGNpcGhlcnRleHRQYXJhbXMgPSBDcnlwdG9KUy5saWIuUGFzc3dvcmRCYXNlZENpcGhlci5lbmNyeXB0KENyeXB0b0pTLmFsZ28uQUVTLCBtZXNzYWdlLCAncGFzc3dvcmQnKTsNCiAgICAgICAgICogICAgIHZhciBjaXBoZXJ0ZXh0UGFyYW1zID0gQ3J5cHRvSlMubGliLlBhc3N3b3JkQmFzZWRDaXBoZXIuZW5jcnlwdChDcnlwdG9KUy5hbGdvLkFFUywgbWVzc2FnZSwgJ3Bhc3N3b3JkJywgeyBmb3JtYXQ6IENyeXB0b0pTLmZvcm1hdC5PcGVuU1NMIH0pOw0KICAgICAgICAgKi8NCiAgICAgICAgZW5jcnlwdDogZnVuY3Rpb24gKGNpcGhlciwgbWVzc2FnZSwgcGFzc3dvcmQsIGNmZykgew0KICAgICAgICAgICAgLy8gQXBwbHkgY29uZmlnIGRlZmF1bHRzDQogICAgICAgICAgICBjZmcgPSB0aGlzLmNmZy5leHRlbmQoY2ZnKTsNCg0KICAgICAgICAgICAgLy8gRGVyaXZlIGtleSBhbmQgb3RoZXIgcGFyYW1zDQogICAgICAgICAgICB2YXIgZGVyaXZlZFBhcmFtcyA9IGNmZy5rZGYuZXhlY3V0ZShwYXNzd29yZCwgY2lwaGVyLmtleVNpemUsIGNpcGhlci5pdlNpemUpOw0KDQogICAgICAgICAgICAvLyBBZGQgSVYgdG8gY29uZmlnDQogICAgICAgICAgICBjZmcuaXYgPSBkZXJpdmVkUGFyYW1zLml2Ow0KDQogICAgICAgICAgICAvLyBFbmNyeXB0DQogICAgICAgICAgICB2YXIgY2lwaGVydGV4dCA9IFNlcmlhbGl6YWJsZUNpcGhlci5lbmNyeXB0LmNhbGwodGhpcywgY2lwaGVyLCBtZXNzYWdlLCBkZXJpdmVkUGFyYW1zLmtleSwgY2ZnKTsNCg0KICAgICAgICAgICAgLy8gTWl4IGluIGRlcml2ZWQgcGFyYW1zDQogICAgICAgICAgICBjaXBoZXJ0ZXh0Lm1peEluKGRlcml2ZWRQYXJhbXMpOw0KDQogICAgICAgICAgICByZXR1cm4gY2lwaGVydGV4dDsNCiAgICAgICAgfSwNCg0KICAgICAgICAvKioNCiAgICAgICAgICogRGVjcnlwdHMgc2VyaWFsaXplZCBjaXBoZXJ0ZXh0IHVzaW5nIGEgcGFzc3dvcmQuDQogICAgICAgICAqDQogICAgICAgICAqIEBwYXJhbSB7Q2lwaGVyfSBjaXBoZXIgVGhlIGNpcGhlciBhbGdvcml0aG0gdG8gdXNlLg0KICAgICAgICAgKiBAcGFyYW0ge0NpcGhlclBhcmFtc3xzdHJpbmd9IGNpcGhlcnRleHQgVGhlIGNpcGhlcnRleHQgdG8gZGVjcnlwdC4NCiAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IHBhc3N3b3JkIFRoZSBwYXNzd29yZC4NCiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGNmZyAoT3B0aW9uYWwpIFRoZSBjb25maWd1cmF0aW9uIG9wdGlvbnMgdG8gdXNlIGZvciB0aGlzIG9wZXJhdGlvbi4NCiAgICAgICAgICoNCiAgICAgICAgICogQHJldHVybiB7V29yZEFycmF5fSBUaGUgcGxhaW50ZXh0Lg0KICAgICAgICAgKg0KICAgICAgICAgKiBAc3RhdGljDQogICAgICAgICAqDQogICAgICAgICAqIEBleGFtcGxlDQogICAgICAgICAqDQogICAgICAgICAqICAgICB2YXIgcGxhaW50ZXh0ID0gQ3J5cHRvSlMubGliLlBhc3N3b3JkQmFzZWRDaXBoZXIuZGVjcnlwdChDcnlwdG9KUy5hbGdvLkFFUywgZm9ybWF0dGVkQ2lwaGVydGV4dCwgJ3Bhc3N3b3JkJywgeyBmb3JtYXQ6IENyeXB0b0pTLmZvcm1hdC5PcGVuU1NMIH0pOw0KICAgICAgICAgKiAgICAgdmFyIHBsYWludGV4dCA9IENyeXB0b0pTLmxpYi5QYXNzd29yZEJhc2VkQ2lwaGVyLmRlY3J5cHQoQ3J5cHRvSlMuYWxnby5BRVMsIGNpcGhlcnRleHRQYXJhbXMsICdwYXNzd29yZCcsIHsgZm9ybWF0OiBDcnlwdG9KUy5mb3JtYXQuT3BlblNTTCB9KTsNCiAgICAgICAgICovDQogICAgICAgIGRlY3J5cHQ6IGZ1bmN0aW9uIChjaXBoZXIsIGNpcGhlcnRleHQsIHBhc3N3b3JkLCBjZmcpIHsNCiAgICAgICAgICAgIC8vIEFwcGx5IGNvbmZpZyBkZWZhdWx0cw0KICAgICAgICAgICAgY2ZnID0gdGhpcy5jZmcuZXh0ZW5kKGNmZyk7DQoNCiAgICAgICAgICAgIC8vIENvbnZlcnQgc3RyaW5nIHRvIENpcGhlclBhcmFtcw0KICAgICAgICAgICAgY2lwaGVydGV4dCA9IHRoaXMuX3BhcnNlKGNpcGhlcnRleHQsIGNmZy5mb3JtYXQpOw0KDQogICAgICAgICAgICAvLyBEZXJpdmUga2V5IGFuZCBvdGhlciBwYXJhbXMNCiAgICAgICAgICAgIHZhciBkZXJpdmVkUGFyYW1zID0gY2ZnLmtkZi5leGVjdXRlKHBhc3N3b3JkLCBjaXBoZXIua2V5U2l6ZSwgY2lwaGVyLml2U2l6ZSwgY2lwaGVydGV4dC5zYWx0KTsNCg0KICAgICAgICAgICAgLy8gQWRkIElWIHRvIGNvbmZpZw0KICAgICAgICAgICAgY2ZnLml2ID0gZGVyaXZlZFBhcmFtcy5pdjsNCg0KICAgICAgICAgICAgLy8gRGVjcnlwdA0KICAgICAgICAgICAgdmFyIHBsYWludGV4dCA9IFNlcmlhbGl6YWJsZUNpcGhlci5kZWNyeXB0LmNhbGwodGhpcywgY2lwaGVyLCBjaXBoZXJ0ZXh0LCBkZXJpdmVkUGFyYW1zLmtleSwgY2ZnKTsNCg0KICAgICAgICAgICAgcmV0dXJuIHBsYWludGV4dDsNCiAgICAgICAgfQ0KICAgIH0pOw0KfSgpKTsNCgpkZWZpbmUoImNyeXB0by5jaXBoZXItY29yZSIsIFsiY3J5cHRvLmVuYy1iYXNlNjQiLCJjcnlwdG8uZXZwa2RmIl0sIGZ1bmN0aW9uKCl7fSk7CgovKgpDcnlwdG9KUyB2My4xLjIKY29kZS5nb29nbGUuY29tL3AvY3J5cHRvLWpzCihjKSAyMDA5LTIwMTMgYnkgSmVmZiBNb3R0LiBBbGwgcmlnaHRzIHJlc2VydmVkLgpjb2RlLmdvb2dsZS5jb20vcC9jcnlwdG8tanMvd2lraS9MaWNlbnNlCiovCihmdW5jdGlvbiAoKSB7DQogICAgLy8gU2hvcnRjdXRzDQogICAgdmFyIEMgPSBDcnlwdG9KUzsNCiAgICB2YXIgQ19saWIgPSBDLmxpYjsNCiAgICB2YXIgQmxvY2tDaXBoZXIgPSBDX2xpYi5CbG9ja0NpcGhlcjsNCiAgICB2YXIgQ19hbGdvID0gQy5hbGdvOw0KDQogICAgLy8gTG9va3VwIHRhYmxlcw0KICAgIHZhciBTQk9YID0gW107DQogICAgdmFyIElOVl9TQk9YID0gW107DQogICAgdmFyIFNVQl9NSVhfMCA9IFtdOw0KICAgIHZhciBTVUJfTUlYXzEgPSBbXTsNCiAgICB2YXIgU1VCX01JWF8yID0gW107DQogICAgdmFyIFNVQl9NSVhfMyA9IFtdOw0KICAgIHZhciBJTlZfU1VCX01JWF8wID0gW107DQogICAgdmFyIElOVl9TVUJfTUlYXzEgPSBbXTsNCiAgICB2YXIgSU5WX1NVQl9NSVhfMiA9IFtdOw0KICAgIHZhciBJTlZfU1VCX01JWF8zID0gW107DQoNCiAgICAvLyBDb21wdXRlIGxvb2t1cCB0YWJsZXMNCiAgICAoZnVuY3Rpb24gKCkgew0KICAgICAgICAvLyBDb21wdXRlIGRvdWJsZSB0YWJsZQ0KICAgICAgICB2YXIgZCA9IFtdOw0KICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDI1NjsgaSsrKSB7DQogICAgICAgICAgICBpZiAoaSA8IDEyOCkgew0KICAgICAgICAgICAgICAgIGRbaV0gPSBpIDw8IDE7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGRbaV0gPSAoaSA8PCAxKSBeIDB4MTFiOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8gV2FsayBHRigyXjgpDQogICAgICAgIHZhciB4ID0gMDsNCiAgICAgICAgdmFyIHhpID0gMDsNCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAyNTY7IGkrKykgew0KICAgICAgICAgICAgLy8gQ29tcHV0ZSBzYm94DQogICAgICAgICAgICB2YXIgc3ggPSB4aSBeICh4aSA8PCAxKSBeICh4aSA8PCAyKSBeICh4aSA8PCAzKSBeICh4aSA8PCA0KTsNCiAgICAgICAgICAgIHN4ID0gKHN4ID4+PiA4KSBeIChzeCAmIDB4ZmYpIF4gMHg2MzsNCiAgICAgICAgICAgIFNCT1hbeF0gPSBzeDsNCiAgICAgICAgICAgIElOVl9TQk9YW3N4XSA9IHg7DQoNCiAgICAgICAgICAgIC8vIENvbXB1dGUgbXVsdGlwbGljYXRpb24NCiAgICAgICAgICAgIHZhciB4MiA9IGRbeF07DQogICAgICAgICAgICB2YXIgeDQgPSBkW3gyXTsNCiAgICAgICAgICAgIHZhciB4OCA9IGRbeDRdOw0KDQogICAgICAgICAgICAvLyBDb21wdXRlIHN1YiBieXRlcywgbWl4IGNvbHVtbnMgdGFibGVzDQogICAgICAgICAgICB2YXIgdCA9IChkW3N4XSAqIDB4MTAxKSBeIChzeCAqIDB4MTAxMDEwMCk7DQogICAgICAgICAgICBTVUJfTUlYXzBbeF0gPSAodCA8PCAyNCkgfCAodCA+Pj4gOCk7DQogICAgICAgICAgICBTVUJfTUlYXzFbeF0gPSAodCA8PCAxNikgfCAodCA+Pj4gMTYpOw0KICAgICAgICAgICAgU1VCX01JWF8yW3hdID0gKHQgPDwgOCkgIHwgKHQgPj4+IDI0KTsNCiAgICAgICAgICAgIFNVQl9NSVhfM1t4XSA9IHQ7DQoNCiAgICAgICAgICAgIC8vIENvbXB1dGUgaW52IHN1YiBieXRlcywgaW52IG1peCBjb2x1bW5zIHRhYmxlcw0KICAgICAgICAgICAgdmFyIHQgPSAoeDggKiAweDEwMTAxMDEpIF4gKHg0ICogMHgxMDAwMSkgXiAoeDIgKiAweDEwMSkgXiAoeCAqIDB4MTAxMDEwMCk7DQogICAgICAgICAgICBJTlZfU1VCX01JWF8wW3N4XSA9ICh0IDw8IDI0KSB8ICh0ID4+PiA4KTsNCiAgICAgICAgICAgIElOVl9TVUJfTUlYXzFbc3hdID0gKHQgPDwgMTYpIHwgKHQgPj4+IDE2KTsNCiAgICAgICAgICAgIElOVl9TVUJfTUlYXzJbc3hdID0gKHQgPDwgOCkgIHwgKHQgPj4+IDI0KTsNCiAgICAgICAgICAgIElOVl9TVUJfTUlYXzNbc3hdID0gdDsNCg0KICAgICAgICAgICAgLy8gQ29tcHV0ZSBuZXh0IGNvdW50ZXINCiAgICAgICAgICAgIGlmICgheCkgew0KICAgICAgICAgICAgICAgIHggPSB4aSA9IDE7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIHggPSB4MiBeIGRbZFtkW3g4IF4geDJdXV07DQogICAgICAgICAgICAgICAgeGkgXj0gZFtkW3hpXV07DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9KCkpOw0KDQogICAgLy8gUHJlY29tcHV0ZWQgUmNvbiBsb29rdXANCiAgICB2YXIgUkNPTiA9IFsweDAwLCAweDAxLCAweDAyLCAweDA0LCAweDA4LCAweDEwLCAweDIwLCAweDQwLCAweDgwLCAweDFiLCAweDM2XTsNCg0KICAgIC8qKg0KICAgICAqIEFFUyBibG9jayBjaXBoZXIgYWxnb3JpdGhtLg0KICAgICAqLw0KICAgIHZhciBBRVMgPSBDX2FsZ28uQUVTID0gQmxvY2tDaXBoZXIuZXh0ZW5kKHsNCiAgICAgICAgX2RvUmVzZXQ6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIC8vIFNob3J0Y3V0cw0KICAgICAgICAgICAgdmFyIGtleSA9IHRoaXMuX2tleTsNCiAgICAgICAgICAgIHZhciBrZXlXb3JkcyA9IGtleS53b3JkczsNCiAgICAgICAgICAgIHZhciBrZXlTaXplID0ga2V5LnNpZ0J5dGVzIC8gNDsNCg0KICAgICAgICAgICAgLy8gQ29tcHV0ZSBudW1iZXIgb2Ygcm91bmRzDQogICAgICAgICAgICB2YXIgblJvdW5kcyA9IHRoaXMuX25Sb3VuZHMgPSBrZXlTaXplICsgNg0KDQogICAgICAgICAgICAvLyBDb21wdXRlIG51bWJlciBvZiBrZXkgc2NoZWR1bGUgcm93cw0KICAgICAgICAgICAgdmFyIGtzUm93cyA9IChuUm91bmRzICsgMSkgKiA0Ow0KDQogICAgICAgICAgICAvLyBDb21wdXRlIGtleSBzY2hlZHVsZQ0KICAgICAgICAgICAgdmFyIGtleVNjaGVkdWxlID0gdGhpcy5fa2V5U2NoZWR1bGUgPSBbXTsNCiAgICAgICAgICAgIGZvciAodmFyIGtzUm93ID0gMDsga3NSb3cgPCBrc1Jvd3M7IGtzUm93KyspIHsNCiAgICAgICAgICAgICAgICBpZiAoa3NSb3cgPCBrZXlTaXplKSB7DQogICAgICAgICAgICAgICAgICAgIGtleVNjaGVkdWxlW2tzUm93XSA9IGtleVdvcmRzW2tzUm93XTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICB2YXIgdCA9IGtleVNjaGVkdWxlW2tzUm93IC0gMV07DQoNCiAgICAgICAgICAgICAgICAgICAgaWYgKCEoa3NSb3cgJSBrZXlTaXplKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gUm90IHdvcmQNCiAgICAgICAgICAgICAgICAgICAgICAgIHQgPSAodCA8PCA4KSB8ICh0ID4+PiAyNCk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFN1YiB3b3JkDQogICAgICAgICAgICAgICAgICAgICAgICB0ID0gKFNCT1hbdCA+Pj4gMjRdIDw8IDI0KSB8IChTQk9YWyh0ID4+PiAxNikgJiAweGZmXSA8PCAxNikgfCAoU0JPWFsodCA+Pj4gOCkgJiAweGZmXSA8PCA4KSB8IFNCT1hbdCAmIDB4ZmZdOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAvLyBNaXggUmNvbg0KICAgICAgICAgICAgICAgICAgICAgICAgdCBePSBSQ09OWyhrc1JvdyAvIGtleVNpemUpIHwgMF0gPDwgMjQ7DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoa2V5U2l6ZSA+IDYgJiYga3NSb3cgJSBrZXlTaXplID09IDQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFN1YiB3b3JkDQogICAgICAgICAgICAgICAgICAgICAgICB0ID0gKFNCT1hbdCA+Pj4gMjRdIDw8IDI0KSB8IChTQk9YWyh0ID4+PiAxNikgJiAweGZmXSA8PCAxNikgfCAoU0JPWFsodCA+Pj4gOCkgJiAweGZmXSA8PCA4KSB8IFNCT1hbdCAmIDB4ZmZdOw0KICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAga2V5U2NoZWR1bGVba3NSb3ddID0ga2V5U2NoZWR1bGVba3NSb3cgLSBrZXlTaXplXSBeIHQ7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBDb21wdXRlIGludiBrZXkgc2NoZWR1bGUNCiAgICAgICAgICAgIHZhciBpbnZLZXlTY2hlZHVsZSA9IHRoaXMuX2ludktleVNjaGVkdWxlID0gW107DQogICAgICAgICAgICBmb3IgKHZhciBpbnZLc1JvdyA9IDA7IGludktzUm93IDwga3NSb3dzOyBpbnZLc1JvdysrKSB7DQogICAgICAgICAgICAgICAgdmFyIGtzUm93ID0ga3NSb3dzIC0gaW52S3NSb3c7DQoNCiAgICAgICAgICAgICAgICBpZiAoaW52S3NSb3cgJSA0KSB7DQogICAgICAgICAgICAgICAgICAgIHZhciB0ID0ga2V5U2NoZWR1bGVba3NSb3ddOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIHZhciB0ID0ga2V5U2NoZWR1bGVba3NSb3cgLSA0XTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBpZiAoaW52S3NSb3cgPCA0IHx8IGtzUm93IDw9IDQpIHsNCiAgICAgICAgICAgICAgICAgICAgaW52S2V5U2NoZWR1bGVbaW52S3NSb3ddID0gdDsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBpbnZLZXlTY2hlZHVsZVtpbnZLc1Jvd10gPSBJTlZfU1VCX01JWF8wW1NCT1hbdCA+Pj4gMjRdXSBeIElOVl9TVUJfTUlYXzFbU0JPWFsodCA+Pj4gMTYpICYgMHhmZl1dIF4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSU5WX1NVQl9NSVhfMltTQk9YWyh0ID4+PiA4KSAmIDB4ZmZdXSBeIElOVl9TVUJfTUlYXzNbU0JPWFt0ICYgMHhmZl1dOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfSwNCg0KICAgICAgICBlbmNyeXB0QmxvY2s6IGZ1bmN0aW9uIChNLCBvZmZzZXQpIHsNCiAgICAgICAgICAgIHRoaXMuX2RvQ3J5cHRCbG9jayhNLCBvZmZzZXQsIHRoaXMuX2tleVNjaGVkdWxlLCBTVUJfTUlYXzAsIFNVQl9NSVhfMSwgU1VCX01JWF8yLCBTVUJfTUlYXzMsIFNCT1gpOw0KICAgICAgICB9LA0KDQogICAgICAgIGRlY3J5cHRCbG9jazogZnVuY3Rpb24gKE0sIG9mZnNldCkgew0KICAgICAgICAgICAgLy8gU3dhcCAybmQgYW5kIDR0aCByb3dzDQogICAgICAgICAgICB2YXIgdCA9IE1bb2Zmc2V0ICsgMV07DQogICAgICAgICAgICBNW29mZnNldCArIDFdID0gTVtvZmZzZXQgKyAzXTsNCiAgICAgICAgICAgIE1bb2Zmc2V0ICsgM10gPSB0Ow0KDQogICAgICAgICAgICB0aGlzLl9kb0NyeXB0QmxvY2soTSwgb2Zmc2V0LCB0aGlzLl9pbnZLZXlTY2hlZHVsZSwgSU5WX1NVQl9NSVhfMCwgSU5WX1NVQl9NSVhfMSwgSU5WX1NVQl9NSVhfMiwgSU5WX1NVQl9NSVhfMywgSU5WX1NCT1gpOw0KDQogICAgICAgICAgICAvLyBJbnYgc3dhcCAybmQgYW5kIDR0aCByb3dzDQogICAgICAgICAgICB2YXIgdCA9IE1bb2Zmc2V0ICsgMV07DQogICAgICAgICAgICBNW29mZnNldCArIDFdID0gTVtvZmZzZXQgKyAzXTsNCiAgICAgICAgICAgIE1bb2Zmc2V0ICsgM10gPSB0Ow0KICAgICAgICB9LA0KDQogICAgICAgIF9kb0NyeXB0QmxvY2s6IGZ1bmN0aW9uIChNLCBvZmZzZXQsIGtleVNjaGVkdWxlLCBTVUJfTUlYXzAsIFNVQl9NSVhfMSwgU1VCX01JWF8yLCBTVUJfTUlYXzMsIFNCT1gpIHsNCiAgICAgICAgICAgIC8vIFNob3J0Y3V0DQogICAgICAgICAgICB2YXIgblJvdW5kcyA9IHRoaXMuX25Sb3VuZHM7DQoNCiAgICAgICAgICAgIC8vIEdldCBpbnB1dCwgYWRkIHJvdW5kIGtleQ0KICAgICAgICAgICAgdmFyIHMwID0gTVtvZmZzZXRdICAgICBeIGtleVNjaGVkdWxlWzBdOw0KICAgICAgICAgICAgdmFyIHMxID0gTVtvZmZzZXQgKyAxXSBeIGtleVNjaGVkdWxlWzFdOw0KICAgICAgICAgICAgdmFyIHMyID0gTVtvZmZzZXQgKyAyXSBeIGtleVNjaGVkdWxlWzJdOw0KICAgICAgICAgICAgdmFyIHMzID0gTVtvZmZzZXQgKyAzXSBeIGtleVNjaGVkdWxlWzNdOw0KDQogICAgICAgICAgICAvLyBLZXkgc2NoZWR1bGUgcm93IGNvdW50ZXINCiAgICAgICAgICAgIHZhciBrc1JvdyA9IDQ7DQoNCiAgICAgICAgICAgIC8vIFJvdW5kcw0KICAgICAgICAgICAgZm9yICh2YXIgcm91bmQgPSAxOyByb3VuZCA8IG5Sb3VuZHM7IHJvdW5kKyspIHsNCiAgICAgICAgICAgICAgICAvLyBTaGlmdCByb3dzLCBzdWIgYnl0ZXMsIG1peCBjb2x1bW5zLCBhZGQgcm91bmQga2V5DQogICAgICAgICAgICAgICAgdmFyIHQwID0gU1VCX01JWF8wW3MwID4+PiAyNF0gXiBTVUJfTUlYXzFbKHMxID4+PiAxNikgJiAweGZmXSBeIFNVQl9NSVhfMlsoczIgPj4+IDgpICYgMHhmZl0gXiBTVUJfTUlYXzNbczMgJiAweGZmXSBeIGtleVNjaGVkdWxlW2tzUm93KytdOw0KICAgICAgICAgICAgICAgIHZhciB0MSA9IFNVQl9NSVhfMFtzMSA+Pj4gMjRdIF4gU1VCX01JWF8xWyhzMiA+Pj4gMTYpICYgMHhmZl0gXiBTVUJfTUlYXzJbKHMzID4+PiA4KSAmIDB4ZmZdIF4gU1VCX01JWF8zW3MwICYgMHhmZl0gXiBrZXlTY2hlZHVsZVtrc1JvdysrXTsNCiAgICAgICAgICAgICAgICB2YXIgdDIgPSBTVUJfTUlYXzBbczIgPj4+IDI0XSBeIFNVQl9NSVhfMVsoczMgPj4+IDE2KSAmIDB4ZmZdIF4gU1VCX01JWF8yWyhzMCA+Pj4gOCkgJiAweGZmXSBeIFNVQl9NSVhfM1tzMSAmIDB4ZmZdIF4ga2V5U2NoZWR1bGVba3NSb3crK107DQogICAgICAgICAgICAgICAgdmFyIHQzID0gU1VCX01JWF8wW3MzID4+PiAyNF0gXiBTVUJfTUlYXzFbKHMwID4+PiAxNikgJiAweGZmXSBeIFNVQl9NSVhfMlsoczEgPj4+IDgpICYgMHhmZl0gXiBTVUJfTUlYXzNbczIgJiAweGZmXSBeIGtleVNjaGVkdWxlW2tzUm93KytdOw0KDQogICAgICAgICAgICAgICAgLy8gVXBkYXRlIHN0YXRlDQogICAgICAgICAgICAgICAgczAgPSB0MDsNCiAgICAgICAgICAgICAgICBzMSA9IHQxOw0KICAgICAgICAgICAgICAgIHMyID0gdDI7DQogICAgICAgICAgICAgICAgczMgPSB0MzsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gU2hpZnQgcm93cywgc3ViIGJ5dGVzLCBhZGQgcm91bmQga2V5DQogICAgICAgICAgICB2YXIgdDAgPSAoKFNCT1hbczAgPj4+IDI0XSA8PCAyNCkgfCAoU0JPWFsoczEgPj4+IDE2KSAmIDB4ZmZdIDw8IDE2KSB8IChTQk9YWyhzMiA+Pj4gOCkgJiAweGZmXSA8PCA4KSB8IFNCT1hbczMgJiAweGZmXSkgXiBrZXlTY2hlZHVsZVtrc1JvdysrXTsNCiAgICAgICAgICAgIHZhciB0MSA9ICgoU0JPWFtzMSA+Pj4gMjRdIDw8IDI0KSB8IChTQk9YWyhzMiA+Pj4gMTYpICYgMHhmZl0gPDwgMTYpIHwgKFNCT1hbKHMzID4+PiA4KSAmIDB4ZmZdIDw8IDgpIHwgU0JPWFtzMCAmIDB4ZmZdKSBeIGtleVNjaGVkdWxlW2tzUm93KytdOw0KICAgICAgICAgICAgdmFyIHQyID0gKChTQk9YW3MyID4+PiAyNF0gPDwgMjQpIHwgKFNCT1hbKHMzID4+PiAxNikgJiAweGZmXSA8PCAxNikgfCAoU0JPWFsoczAgPj4+IDgpICYgMHhmZl0gPDwgOCkgfCBTQk9YW3MxICYgMHhmZl0pIF4ga2V5U2NoZWR1bGVba3NSb3crK107DQogICAgICAgICAgICB2YXIgdDMgPSAoKFNCT1hbczMgPj4+IDI0XSA8PCAyNCkgfCAoU0JPWFsoczAgPj4+IDE2KSAmIDB4ZmZdIDw8IDE2KSB8IChTQk9YWyhzMSA+Pj4gOCkgJiAweGZmXSA8PCA4KSB8IFNCT1hbczIgJiAweGZmXSkgXiBrZXlTY2hlZHVsZVtrc1JvdysrXTsNCg0KICAgICAgICAgICAgLy8gU2V0IG91dHB1dA0KICAgICAgICAgICAgTVtvZmZzZXRdICAgICA9IHQwOw0KICAgICAgICAgICAgTVtvZmZzZXQgKyAxXSA9IHQxOw0KICAgICAgICAgICAgTVtvZmZzZXQgKyAyXSA9IHQyOw0KICAgICAgICAgICAgTVtvZmZzZXQgKyAzXSA9IHQzOw0KICAgICAgICB9LA0KDQogICAgICAgIGtleVNpemU6IDI1Ni8zMg0KICAgIH0pOw0KDQogICAgLyoqDQogICAgICogU2hvcnRjdXQgZnVuY3Rpb25zIHRvIHRoZSBjaXBoZXIncyBvYmplY3QgaW50ZXJmYWNlLg0KICAgICAqDQogICAgICogQGV4YW1wbGUNCiAgICAgKg0KICAgICAqICAgICB2YXIgY2lwaGVydGV4dCA9IENyeXB0b0pTLkFFUy5lbmNyeXB0KG1lc3NhZ2UsIGtleSwgY2ZnKTsNCiAgICAgKiAgICAgdmFyIHBsYWludGV4dCAgPSBDcnlwdG9KUy5BRVMuZGVjcnlwdChjaXBoZXJ0ZXh0LCBrZXksIGNmZyk7DQogICAgICovDQogICAgQy5BRVMgPSBCbG9ja0NpcGhlci5fY3JlYXRlSGVscGVyKEFFUyk7DQp9KCkpOw0KCmRlZmluZSgiY3J5cHRvLmFlcyIsIFsiY3J5cHRvLmNpcGhlci1jb3JlIl0sIGZ1bmN0aW9uKCl7fSk7CgovKgpDcnlwdG9KUyB2My4xLjIKY29kZS5nb29nbGUuY29tL3AvY3J5cHRvLWpzCihjKSAyMDA5LTIwMTMgYnkgSmVmZiBNb3R0LiBBbGwgcmlnaHRzIHJlc2VydmVkLgpjb2RlLmdvb2dsZS5jb20vcC9jcnlwdG8tanMvd2lraS9MaWNlbnNlCiovCihmdW5jdGlvbiAoKSB7DQogICAgLy8gU2hvcnRjdXRzDQogICAgdmFyIEMgPSBDcnlwdG9KUzsNCiAgICB2YXIgQ19saWIgPSBDLmxpYjsNCiAgICB2YXIgV29yZEFycmF5ID0gQ19saWIuV29yZEFycmF5Ow0KICAgIHZhciBIYXNoZXIgPSBDX2xpYi5IYXNoZXI7DQogICAgdmFyIENfYWxnbyA9IEMuYWxnbzsNCg0KICAgIC8vIFJldXNhYmxlIG9iamVjdA0KICAgIHZhciBXID0gW107DQoNCiAgICAvKioNCiAgICAgKiBTSEEtMSBoYXNoIGFsZ29yaXRobS4NCiAgICAgKi8NCiAgICB2YXIgU0hBMSA9IENfYWxnby5TSEExID0gSGFzaGVyLmV4dGVuZCh7DQogICAgICAgIF9kb1Jlc2V0OiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICB0aGlzLl9oYXNoID0gbmV3IFdvcmRBcnJheS5pbml0KFsNCiAgICAgICAgICAgICAgICAweDY3NDUyMzAxLCAweGVmY2RhYjg5LA0KICAgICAgICAgICAgICAgIDB4OThiYWRjZmUsIDB4MTAzMjU0NzYsDQogICAgICAgICAgICAgICAgMHhjM2QyZTFmMA0KICAgICAgICAgICAgXSk7DQogICAgICAgIH0sDQoNCiAgICAgICAgX2RvUHJvY2Vzc0Jsb2NrOiBmdW5jdGlvbiAoTSwgb2Zmc2V0KSB7DQogICAgICAgICAgICAvLyBTaG9ydGN1dA0KICAgICAgICAgICAgdmFyIEggPSB0aGlzLl9oYXNoLndvcmRzOw0KDQogICAgICAgICAgICAvLyBXb3JraW5nIHZhcmlhYmxlcw0KICAgICAgICAgICAgdmFyIGEgPSBIWzBdOw0KICAgICAgICAgICAgdmFyIGIgPSBIWzFdOw0KICAgICAgICAgICAgdmFyIGMgPSBIWzJdOw0KICAgICAgICAgICAgdmFyIGQgPSBIWzNdOw0KICAgICAgICAgICAgdmFyIGUgPSBIWzRdOw0KDQogICAgICAgICAgICAvLyBDb21wdXRhdGlvbg0KICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCA4MDsgaSsrKSB7DQogICAgICAgICAgICAgICAgaWYgKGkgPCAxNikgew0KICAgICAgICAgICAgICAgICAgICBXW2ldID0gTVtvZmZzZXQgKyBpXSB8IDA7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIG4gPSBXW2kgLSAzXSBeIFdbaSAtIDhdIF4gV1tpIC0gMTRdIF4gV1tpIC0gMTZdOw0KICAgICAgICAgICAgICAgICAgICBXW2ldID0gKG4gPDwgMSkgfCAobiA+Pj4gMzEpOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIHZhciB0ID0gKChhIDw8IDUpIHwgKGEgPj4+IDI3KSkgKyBlICsgV1tpXTsNCiAgICAgICAgICAgICAgICBpZiAoaSA8IDIwKSB7DQogICAgICAgICAgICAgICAgICAgIHQgKz0gKChiICYgYykgfCAofmIgJiBkKSkgKyAweDVhODI3OTk5Ow0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaSA8IDQwKSB7DQogICAgICAgICAgICAgICAgICAgIHQgKz0gKGIgXiBjIF4gZCkgKyAweDZlZDllYmExOw0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaSA8IDYwKSB7DQogICAgICAgICAgICAgICAgICAgIHQgKz0gKChiICYgYykgfCAoYiAmIGQpIHwgKGMgJiBkKSkgLSAweDcwZTQ0MzI0Ow0KICAgICAgICAgICAgICAgIH0gZWxzZSAvKiBpZiAoaSA8IDgwKSAqLyB7DQogICAgICAgICAgICAgICAgICAgIHQgKz0gKGIgXiBjIF4gZCkgLSAweDM1OWQzZTJhOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGUgPSBkOw0KICAgICAgICAgICAgICAgIGQgPSBjOw0KICAgICAgICAgICAgICAgIGMgPSAoYiA8PCAzMCkgfCAoYiA+Pj4gMik7DQogICAgICAgICAgICAgICAgYiA9IGE7DQogICAgICAgICAgICAgICAgYSA9IHQ7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIEludGVybWVkaWF0ZSBoYXNoIHZhbHVlDQogICAgICAgICAgICBIWzBdID0gKEhbMF0gKyBhKSB8IDA7DQogICAgICAgICAgICBIWzFdID0gKEhbMV0gKyBiKSB8IDA7DQogICAgICAgICAgICBIWzJdID0gKEhbMl0gKyBjKSB8IDA7DQogICAgICAgICAgICBIWzNdID0gKEhbM10gKyBkKSB8IDA7DQogICAgICAgICAgICBIWzRdID0gKEhbNF0gKyBlKSB8IDA7DQogICAgICAgIH0sDQoNCiAgICAgICAgX2RvRmluYWxpemU6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIC8vIFNob3J0Y3V0cw0KICAgICAgICAgICAgdmFyIGRhdGEgPSB0aGlzLl9kYXRhOw0KICAgICAgICAgICAgdmFyIGRhdGFXb3JkcyA9IGRhdGEud29yZHM7DQoNCiAgICAgICAgICAgIHZhciBuQml0c1RvdGFsID0gdGhpcy5fbkRhdGFCeXRlcyAqIDg7DQogICAgICAgICAgICB2YXIgbkJpdHNMZWZ0ID0gZGF0YS5zaWdCeXRlcyAqIDg7DQoNCiAgICAgICAgICAgIC8vIEFkZCBwYWRkaW5nDQogICAgICAgICAgICBkYXRhV29yZHNbbkJpdHNMZWZ0ID4+PiA1XSB8PSAweDgwIDw8ICgyNCAtIG5CaXRzTGVmdCAlIDMyKTsNCiAgICAgICAgICAgIGRhdGFXb3Jkc1soKChuQml0c0xlZnQgKyA2NCkgPj4+IDkpIDw8IDQpICsgMTRdID0gTWF0aC5mbG9vcihuQml0c1RvdGFsIC8gMHgxMDAwMDAwMDApOw0KICAgICAgICAgICAgZGF0YVdvcmRzWygoKG5CaXRzTGVmdCArIDY0KSA+Pj4gOSkgPDwgNCkgKyAxNV0gPSBuQml0c1RvdGFsOw0KICAgICAgICAgICAgZGF0YS5zaWdCeXRlcyA9IGRhdGFXb3Jkcy5sZW5ndGggKiA0Ow0KDQogICAgICAgICAgICAvLyBIYXNoIGZpbmFsIGJsb2Nrcw0KICAgICAgICAgICAgdGhpcy5fcHJvY2VzcygpOw0KDQogICAgICAgICAgICAvLyBSZXR1cm4gZmluYWwgY29tcHV0ZWQgaGFzaA0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2hhc2g7DQogICAgICAgIH0sDQoNCiAgICAgICAgY2xvbmU6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHZhciBjbG9uZSA9IEhhc2hlci5jbG9uZS5jYWxsKHRoaXMpOw0KICAgICAgICAgICAgY2xvbmUuX2hhc2ggPSB0aGlzLl9oYXNoLmNsb25lKCk7DQoNCiAgICAgICAgICAgIHJldHVybiBjbG9uZTsNCiAgICAgICAgfQ0KICAgIH0pOw0KDQogICAgLyoqDQogICAgICogU2hvcnRjdXQgZnVuY3Rpb24gdG8gdGhlIGhhc2hlcidzIG9iamVjdCBpbnRlcmZhY2UuDQogICAgICoNCiAgICAgKiBAcGFyYW0ge1dvcmRBcnJheXxzdHJpbmd9IG1lc3NhZ2UgVGhlIG1lc3NhZ2UgdG8gaGFzaC4NCiAgICAgKg0KICAgICAqIEByZXR1cm4ge1dvcmRBcnJheX0gVGhlIGhhc2guDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICoNCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogICAgIHZhciBoYXNoID0gQ3J5cHRvSlMuU0hBMSgnbWVzc2FnZScpOw0KICAgICAqICAgICB2YXIgaGFzaCA9IENyeXB0b0pTLlNIQTEod29yZEFycmF5KTsNCiAgICAgKi8NCiAgICBDLlNIQTEgPSBIYXNoZXIuX2NyZWF0ZUhlbHBlcihTSEExKTsNCg0KICAgIC8qKg0KICAgICAqIFNob3J0Y3V0IGZ1bmN0aW9uIHRvIHRoZSBITUFDJ3Mgb2JqZWN0IGludGVyZmFjZS4NCiAgICAgKg0KICAgICAqIEBwYXJhbSB7V29yZEFycmF5fHN0cmluZ30gbWVzc2FnZSBUaGUgbWVzc2FnZSB0byBoYXNoLg0KICAgICAqIEBwYXJhbSB7V29yZEFycmF5fHN0cmluZ30ga2V5IFRoZSBzZWNyZXQga2V5Lg0KICAgICAqDQogICAgICogQHJldHVybiB7V29yZEFycmF5fSBUaGUgSE1BQy4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiAgICAgdmFyIGhtYWMgPSBDcnlwdG9KUy5IbWFjU0hBMShtZXNzYWdlLCBrZXkpOw0KICAgICAqLw0KICAgIEMuSG1hY1NIQTEgPSBIYXNoZXIuX2NyZWF0ZUhtYWNIZWxwZXIoU0hBMSk7DQp9KCkpOw0KCmRlZmluZSgiY3J5cHRvLnNoYTEiLCBbImNyeXB0by5jb3JlIl0sIGZ1bmN0aW9uKCl7fSk7CgovKgpDcnlwdG9KUyB2My4xLjIKY29kZS5nb29nbGUuY29tL3AvY3J5cHRvLWpzCihjKSAyMDA5LTIwMTMgYnkgSmVmZiBNb3R0LiBBbGwgcmlnaHRzIHJlc2VydmVkLgpjb2RlLmdvb2dsZS5jb20vcC9jcnlwdG8tanMvd2lraS9MaWNlbnNlCiovCihmdW5jdGlvbiAoTWF0aCkgew0KICAgIC8vIFNob3J0Y3V0cw0KICAgIHZhciBDID0gQ3J5cHRvSlM7DQogICAgdmFyIENfbGliID0gQy5saWI7DQogICAgdmFyIFdvcmRBcnJheSA9IENfbGliLldvcmRBcnJheTsNCiAgICB2YXIgSGFzaGVyID0gQ19saWIuSGFzaGVyOw0KICAgIHZhciBDX2FsZ28gPSBDLmFsZ287DQoNCiAgICAvLyBJbml0aWFsaXphdGlvbiBhbmQgcm91bmQgY29uc3RhbnRzIHRhYmxlcw0KICAgIHZhciBIID0gW107DQogICAgdmFyIEsgPSBbXTsNCg0KICAgIC8vIENvbXB1dGUgY29uc3RhbnRzDQogICAgKGZ1bmN0aW9uICgpIHsNCiAgICAgICAgZnVuY3Rpb24gaXNQcmltZShuKSB7DQogICAgICAgICAgICB2YXIgc3FydE4gPSBNYXRoLnNxcnQobik7DQogICAgICAgICAgICBmb3IgKHZhciBmYWN0b3IgPSAyOyBmYWN0b3IgPD0gc3FydE47IGZhY3RvcisrKSB7DQogICAgICAgICAgICAgICAgaWYgKCEobiAlIGZhY3RvcikpIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiBnZXRGcmFjdGlvbmFsQml0cyhuKSB7DQogICAgICAgICAgICByZXR1cm4gKChuIC0gKG4gfCAwKSkgKiAweDEwMDAwMDAwMCkgfCAwOw0KICAgICAgICB9DQoNCiAgICAgICAgdmFyIG4gPSAyOw0KICAgICAgICB2YXIgblByaW1lID0gMDsNCiAgICAgICAgd2hpbGUgKG5QcmltZSA8IDY0KSB7DQogICAgICAgICAgICBpZiAoaXNQcmltZShuKSkgew0KICAgICAgICAgICAgICAgIGlmIChuUHJpbWUgPCA4KSB7DQogICAgICAgICAgICAgICAgICAgIEhbblByaW1lXSA9IGdldEZyYWN0aW9uYWxCaXRzKE1hdGgucG93KG4sIDEgLyAyKSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIEtbblByaW1lXSA9IGdldEZyYWN0aW9uYWxCaXRzKE1hdGgucG93KG4sIDEgLyAzKSk7DQoNCiAgICAgICAgICAgICAgICBuUHJpbWUrKzsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgbisrOw0KICAgICAgICB9DQogICAgfSgpKTsNCg0KICAgIC8vIFJldXNhYmxlIG9iamVjdA0KICAgIHZhciBXID0gW107DQoNCiAgICAvKioNCiAgICAgKiBTSEEtMjU2IGhhc2ggYWxnb3JpdGhtLg0KICAgICAqLw0KICAgIHZhciBTSEEyNTYgPSBDX2FsZ28uU0hBMjU2ID0gSGFzaGVyLmV4dGVuZCh7DQogICAgICAgIF9kb1Jlc2V0OiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICB0aGlzLl9oYXNoID0gbmV3IFdvcmRBcnJheS5pbml0KEguc2xpY2UoMCkpOw0KICAgICAgICB9LA0KDQogICAgICAgIF9kb1Byb2Nlc3NCbG9jazogZnVuY3Rpb24gKE0sIG9mZnNldCkgew0KICAgICAgICAgICAgLy8gU2hvcnRjdXQNCiAgICAgICAgICAgIHZhciBIID0gdGhpcy5faGFzaC53b3JkczsNCg0KICAgICAgICAgICAgLy8gV29ya2luZyB2YXJpYWJsZXMNCiAgICAgICAgICAgIHZhciBhID0gSFswXTsNCiAgICAgICAgICAgIHZhciBiID0gSFsxXTsNCiAgICAgICAgICAgIHZhciBjID0gSFsyXTsNCiAgICAgICAgICAgIHZhciBkID0gSFszXTsNCiAgICAgICAgICAgIHZhciBlID0gSFs0XTsNCiAgICAgICAgICAgIHZhciBmID0gSFs1XTsNCiAgICAgICAgICAgIHZhciBnID0gSFs2XTsNCiAgICAgICAgICAgIHZhciBoID0gSFs3XTsNCg0KICAgICAgICAgICAgLy8gQ29tcHV0YXRpb24NCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgNjQ7IGkrKykgew0KICAgICAgICAgICAgICAgIGlmIChpIDwgMTYpIHsNCiAgICAgICAgICAgICAgICAgICAgV1tpXSA9IE1bb2Zmc2V0ICsgaV0gfCAwOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIHZhciBnYW1tYTB4ID0gV1tpIC0gMTVdOw0KICAgICAgICAgICAgICAgICAgICB2YXIgZ2FtbWEwICA9ICgoZ2FtbWEweCA8PCAyNSkgfCAoZ2FtbWEweCA+Pj4gNykpICBeDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKChnYW1tYTB4IDw8IDE0KSB8IChnYW1tYTB4ID4+PiAxOCkpIF4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGdhbW1hMHggPj4+IDMpOw0KDQogICAgICAgICAgICAgICAgICAgIHZhciBnYW1tYTF4ID0gV1tpIC0gMl07DQogICAgICAgICAgICAgICAgICAgIHZhciBnYW1tYTEgID0gKChnYW1tYTF4IDw8IDE1KSB8IChnYW1tYTF4ID4+PiAxNykpIF4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoKGdhbW1hMXggPDwgMTMpIHwgKGdhbW1hMXggPj4+IDE5KSkgXg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZ2FtbWExeCA+Pj4gMTApOw0KDQogICAgICAgICAgICAgICAgICAgIFdbaV0gPSBnYW1tYTAgKyBXW2kgLSA3XSArIGdhbW1hMSArIFdbaSAtIDE2XTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICB2YXIgY2ggID0gKGUgJiBmKSBeICh+ZSAmIGcpOw0KICAgICAgICAgICAgICAgIHZhciBtYWogPSAoYSAmIGIpIF4gKGEgJiBjKSBeIChiICYgYyk7DQoNCiAgICAgICAgICAgICAgICB2YXIgc2lnbWEwID0gKChhIDw8IDMwKSB8IChhID4+PiAyKSkgXiAoKGEgPDwgMTkpIHwgKGEgPj4+IDEzKSkgXiAoKGEgPDwgMTApIHwgKGEgPj4+IDIyKSk7DQogICAgICAgICAgICAgICAgdmFyIHNpZ21hMSA9ICgoZSA8PCAyNikgfCAoZSA+Pj4gNikpIF4gKChlIDw8IDIxKSB8IChlID4+PiAxMSkpIF4gKChlIDw8IDcpICB8IChlID4+PiAyNSkpOw0KDQogICAgICAgICAgICAgICAgdmFyIHQxID0gaCArIHNpZ21hMSArIGNoICsgS1tpXSArIFdbaV07DQogICAgICAgICAgICAgICAgdmFyIHQyID0gc2lnbWEwICsgbWFqOw0KDQogICAgICAgICAgICAgICAgaCA9IGc7DQogICAgICAgICAgICAgICAgZyA9IGY7DQogICAgICAgICAgICAgICAgZiA9IGU7DQogICAgICAgICAgICAgICAgZSA9IChkICsgdDEpIHwgMDsNCiAgICAgICAgICAgICAgICBkID0gYzsNCiAgICAgICAgICAgICAgICBjID0gYjsNCiAgICAgICAgICAgICAgICBiID0gYTsNCiAgICAgICAgICAgICAgICBhID0gKHQxICsgdDIpIHwgMDsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gSW50ZXJtZWRpYXRlIGhhc2ggdmFsdWUNCiAgICAgICAgICAgIEhbMF0gPSAoSFswXSArIGEpIHwgMDsNCiAgICAgICAgICAgIEhbMV0gPSAoSFsxXSArIGIpIHwgMDsNCiAgICAgICAgICAgIEhbMl0gPSAoSFsyXSArIGMpIHwgMDsNCiAgICAgICAgICAgIEhbM10gPSAoSFszXSArIGQpIHwgMDsNCiAgICAgICAgICAgIEhbNF0gPSAoSFs0XSArIGUpIHwgMDsNCiAgICAgICAgICAgIEhbNV0gPSAoSFs1XSArIGYpIHwgMDsNCiAgICAgICAgICAgIEhbNl0gPSAoSFs2XSArIGcpIHwgMDsNCiAgICAgICAgICAgIEhbN10gPSAoSFs3XSArIGgpIHwgMDsNCiAgICAgICAgfSwNCg0KICAgICAgICBfZG9GaW5hbGl6ZTogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgLy8gU2hvcnRjdXRzDQogICAgICAgICAgICB2YXIgZGF0YSA9IHRoaXMuX2RhdGE7DQogICAgICAgICAgICB2YXIgZGF0YVdvcmRzID0gZGF0YS53b3JkczsNCg0KICAgICAgICAgICAgdmFyIG5CaXRzVG90YWwgPSB0aGlzLl9uRGF0YUJ5dGVzICogODsNCiAgICAgICAgICAgIHZhciBuQml0c0xlZnQgPSBkYXRhLnNpZ0J5dGVzICogODsNCg0KICAgICAgICAgICAgLy8gQWRkIHBhZGRpbmcNCiAgICAgICAgICAgIGRhdGFXb3Jkc1tuQml0c0xlZnQgPj4+IDVdIHw9IDB4ODAgPDwgKDI0IC0gbkJpdHNMZWZ0ICUgMzIpOw0KICAgICAgICAgICAgZGF0YVdvcmRzWygoKG5CaXRzTGVmdCArIDY0KSA+Pj4gOSkgPDwgNCkgKyAxNF0gPSBNYXRoLmZsb29yKG5CaXRzVG90YWwgLyAweDEwMDAwMDAwMCk7DQogICAgICAgICAgICBkYXRhV29yZHNbKCgobkJpdHNMZWZ0ICsgNjQpID4+PiA5KSA8PCA0KSArIDE1XSA9IG5CaXRzVG90YWw7DQogICAgICAgICAgICBkYXRhLnNpZ0J5dGVzID0gZGF0YVdvcmRzLmxlbmd0aCAqIDQ7DQoNCiAgICAgICAgICAgIC8vIEhhc2ggZmluYWwgYmxvY2tzDQogICAgICAgICAgICB0aGlzLl9wcm9jZXNzKCk7DQoNCiAgICAgICAgICAgIC8vIFJldHVybiBmaW5hbCBjb21wdXRlZCBoYXNoDQogICAgICAgICAgICByZXR1cm4gdGhpcy5faGFzaDsNCiAgICAgICAgfSwNCg0KICAgICAgICBjbG9uZTogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgdmFyIGNsb25lID0gSGFzaGVyLmNsb25lLmNhbGwodGhpcyk7DQogICAgICAgICAgICBjbG9uZS5faGFzaCA9IHRoaXMuX2hhc2guY2xvbmUoKTsNCg0KICAgICAgICAgICAgcmV0dXJuIGNsb25lOw0KICAgICAgICB9DQogICAgfSk7DQoNCiAgICAvKioNCiAgICAgKiBTaG9ydGN1dCBmdW5jdGlvbiB0byB0aGUgaGFzaGVyJ3Mgb2JqZWN0IGludGVyZmFjZS4NCiAgICAgKg0KICAgICAqIEBwYXJhbSB7V29yZEFycmF5fHN0cmluZ30gbWVzc2FnZSBUaGUgbWVzc2FnZSB0byBoYXNoLg0KICAgICAqDQogICAgICogQHJldHVybiB7V29yZEFycmF5fSBUaGUgaGFzaC4NCiAgICAgKg0KICAgICAqIEBzdGF0aWMNCiAgICAgKg0KICAgICAqIEBleGFtcGxlDQogICAgICoNCiAgICAgKiAgICAgdmFyIGhhc2ggPSBDcnlwdG9KUy5TSEEyNTYoJ21lc3NhZ2UnKTsNCiAgICAgKiAgICAgdmFyIGhhc2ggPSBDcnlwdG9KUy5TSEEyNTYod29yZEFycmF5KTsNCiAgICAgKi8NCiAgICBDLlNIQTI1NiA9IEhhc2hlci5fY3JlYXRlSGVscGVyKFNIQTI1Nik7DQoNCiAgICAvKioNCiAgICAgKiBTaG9ydGN1dCBmdW5jdGlvbiB0byB0aGUgSE1BQydzIG9iamVjdCBpbnRlcmZhY2UuDQogICAgICoNCiAgICAgKiBAcGFyYW0ge1dvcmRBcnJheXxzdHJpbmd9IG1lc3NhZ2UgVGhlIG1lc3NhZ2UgdG8gaGFzaC4NCiAgICAgKiBAcGFyYW0ge1dvcmRBcnJheXxzdHJpbmd9IGtleSBUaGUgc2VjcmV0IGtleS4NCiAgICAgKg0KICAgICAqIEByZXR1cm4ge1dvcmRBcnJheX0gVGhlIEhNQUMuDQogICAgICoNCiAgICAgKiBAc3RhdGljDQogICAgICoNCiAgICAgKiBAZXhhbXBsZQ0KICAgICAqDQogICAgICogICAgIHZhciBobWFjID0gQ3J5cHRvSlMuSG1hY1NIQTI1NihtZXNzYWdlLCBrZXkpOw0KICAgICAqLw0KICAgIEMuSG1hY1NIQTI1NiA9IEhhc2hlci5fY3JlYXRlSG1hY0hlbHBlcihTSEEyNTYpOw0KfShNYXRoKSk7DQoKZGVmaW5lKCJjcnlwdG8uc2hhMjU2IiwgWyJjcnlwdG8uY29yZSJdLCBmdW5jdGlvbigpe30pOwoKLyoKQ3J5cHRvSlMgdjMuMS4yCmNvZGUuZ29vZ2xlLmNvbS9wL2NyeXB0by1qcwooYykgMjAwOS0yMDEzIGJ5IEplZmYgTW90dC4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KY29kZS5nb29nbGUuY29tL3AvY3J5cHRvLWpzL3dpa2kvTGljZW5zZQoqLwooZnVuY3Rpb24gKCkgew0KICAgIC8vIFNob3J0Y3V0cw0KICAgIHZhciBDID0gQ3J5cHRvSlM7DQogICAgdmFyIENfbGliID0gQy5saWI7DQogICAgdmFyIEJhc2UgPSBDX2xpYi5CYXNlOw0KICAgIHZhciBDX2VuYyA9IEMuZW5jOw0KICAgIHZhciBVdGY4ID0gQ19lbmMuVXRmODsNCiAgICB2YXIgQ19hbGdvID0gQy5hbGdvOw0KDQogICAgLyoqDQogICAgICogSE1BQyBhbGdvcml0aG0uDQogICAgICovDQogICAgdmFyIEhNQUMgPSBDX2FsZ28uSE1BQyA9IEJhc2UuZXh0ZW5kKHsNCiAgICAgICAgLyoqDQogICAgICAgICAqIEluaXRpYWxpemVzIGEgbmV3bHkgY3JlYXRlZCBITUFDLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcGFyYW0ge0hhc2hlcn0gaGFzaGVyIFRoZSBoYXNoIGFsZ29yaXRobSB0byB1c2UuDQogICAgICAgICAqIEBwYXJhbSB7V29yZEFycmF5fHN0cmluZ30ga2V5IFRoZSBzZWNyZXQga2V5Lg0KICAgICAgICAgKg0KICAgICAgICAgKiBAZXhhbXBsZQ0KICAgICAgICAgKg0KICAgICAgICAgKiAgICAgdmFyIGhtYWNIYXNoZXIgPSBDcnlwdG9KUy5hbGdvLkhNQUMuY3JlYXRlKENyeXB0b0pTLmFsZ28uU0hBMjU2LCBrZXkpOw0KICAgICAgICAgKi8NCiAgICAgICAgaW5pdDogZnVuY3Rpb24gKGhhc2hlciwga2V5KSB7DQogICAgICAgICAgICAvLyBJbml0IGhhc2hlcg0KICAgICAgICAgICAgaGFzaGVyID0gdGhpcy5faGFzaGVyID0gbmV3IGhhc2hlci5pbml0KCk7DQoNCiAgICAgICAgICAgIC8vIENvbnZlcnQgc3RyaW5nIHRvIFdvcmRBcnJheSwgZWxzZSBhc3N1bWUgV29yZEFycmF5IGFscmVhZHkNCiAgICAgICAgICAgIGlmICh0eXBlb2Yga2V5ID09ICdzdHJpbmcnKSB7DQogICAgICAgICAgICAgICAga2V5ID0gVXRmOC5wYXJzZShrZXkpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBTaG9ydGN1dHMNCiAgICAgICAgICAgIHZhciBoYXNoZXJCbG9ja1NpemUgPSBoYXNoZXIuYmxvY2tTaXplOw0KICAgICAgICAgICAgdmFyIGhhc2hlckJsb2NrU2l6ZUJ5dGVzID0gaGFzaGVyQmxvY2tTaXplICogNDsNCg0KICAgICAgICAgICAgLy8gQWxsb3cgYXJiaXRyYXJ5IGxlbmd0aCBrZXlzDQogICAgICAgICAgICBpZiAoa2V5LnNpZ0J5dGVzID4gaGFzaGVyQmxvY2tTaXplQnl0ZXMpIHsNCiAgICAgICAgICAgICAgICBrZXkgPSBoYXNoZXIuZmluYWxpemUoa2V5KTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gQ2xhbXAgZXhjZXNzIGJpdHMNCiAgICAgICAgICAgIGtleS5jbGFtcCgpOw0KDQogICAgICAgICAgICAvLyBDbG9uZSBrZXkgZm9yIGlubmVyIGFuZCBvdXRlciBwYWRzDQogICAgICAgICAgICB2YXIgb0tleSA9IHRoaXMuX29LZXkgPSBrZXkuY2xvbmUoKTsNCiAgICAgICAgICAgIHZhciBpS2V5ID0gdGhpcy5faUtleSA9IGtleS5jbG9uZSgpOw0KDQogICAgICAgICAgICAvLyBTaG9ydGN1dHMNCiAgICAgICAgICAgIHZhciBvS2V5V29yZHMgPSBvS2V5LndvcmRzOw0KICAgICAgICAgICAgdmFyIGlLZXlXb3JkcyA9IGlLZXkud29yZHM7DQoNCiAgICAgICAgICAgIC8vIFhPUiBrZXlzIHdpdGggcGFkIGNvbnN0YW50cw0KICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBoYXNoZXJCbG9ja1NpemU7IGkrKykgew0KICAgICAgICAgICAgICAgIG9LZXlXb3Jkc1tpXSBePSAweDVjNWM1YzVjOw0KICAgICAgICAgICAgICAgIGlLZXlXb3Jkc1tpXSBePSAweDM2MzYzNjM2Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgb0tleS5zaWdCeXRlcyA9IGlLZXkuc2lnQnl0ZXMgPSBoYXNoZXJCbG9ja1NpemVCeXRlczsNCg0KICAgICAgICAgICAgLy8gU2V0IGluaXRpYWwgdmFsdWVzDQogICAgICAgICAgICB0aGlzLnJlc2V0KCk7DQogICAgICAgIH0sDQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIFJlc2V0cyB0aGlzIEhNQUMgdG8gaXRzIGluaXRpYWwgc3RhdGUuDQogICAgICAgICAqDQogICAgICAgICAqIEBleGFtcGxlDQogICAgICAgICAqDQogICAgICAgICAqICAgICBobWFjSGFzaGVyLnJlc2V0KCk7DQogICAgICAgICAqLw0KICAgICAgICByZXNldDogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgLy8gU2hvcnRjdXQNCiAgICAgICAgICAgIHZhciBoYXNoZXIgPSB0aGlzLl9oYXNoZXI7DQoNCiAgICAgICAgICAgIC8vIFJlc2V0DQogICAgICAgICAgICBoYXNoZXIucmVzZXQoKTsNCiAgICAgICAgICAgIGhhc2hlci51cGRhdGUodGhpcy5faUtleSk7DQogICAgICAgIH0sDQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIFVwZGF0ZXMgdGhpcyBITUFDIHdpdGggYSBtZXNzYWdlLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcGFyYW0ge1dvcmRBcnJheXxzdHJpbmd9IG1lc3NhZ2VVcGRhdGUgVGhlIG1lc3NhZ2UgdG8gYXBwZW5kLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcmV0dXJuIHtITUFDfSBUaGlzIEhNQUMgaW5zdGFuY2UuDQogICAgICAgICAqDQogICAgICAgICAqIEBleGFtcGxlDQogICAgICAgICAqDQogICAgICAgICAqICAgICBobWFjSGFzaGVyLnVwZGF0ZSgnbWVzc2FnZScpOw0KICAgICAgICAgKiAgICAgaG1hY0hhc2hlci51cGRhdGUod29yZEFycmF5KTsNCiAgICAgICAgICovDQogICAgICAgIHVwZGF0ZTogZnVuY3Rpb24gKG1lc3NhZ2VVcGRhdGUpIHsNCiAgICAgICAgICAgIHRoaXMuX2hhc2hlci51cGRhdGUobWVzc2FnZVVwZGF0ZSk7DQoNCiAgICAgICAgICAgIC8vIENoYWluYWJsZQ0KICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgIH0sDQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIEZpbmFsaXplcyB0aGUgSE1BQyBjb21wdXRhdGlvbi4NCiAgICAgICAgICogTm90ZSB0aGF0IHRoZSBmaW5hbGl6ZSBvcGVyYXRpb24gaXMgZWZmZWN0aXZlbHkgYSBkZXN0cnVjdGl2ZSwgcmVhZC1vbmNlIG9wZXJhdGlvbi4NCiAgICAgICAgICoNCiAgICAgICAgICogQHBhcmFtIHtXb3JkQXJyYXl8c3RyaW5nfSBtZXNzYWdlVXBkYXRlIChPcHRpb25hbCkgQSBmaW5hbCBtZXNzYWdlIHVwZGF0ZS4NCiAgICAgICAgICoNCiAgICAgICAgICogQHJldHVybiB7V29yZEFycmF5fSBUaGUgSE1BQy4NCiAgICAgICAgICoNCiAgICAgICAgICogQGV4YW1wbGUNCiAgICAgICAgICoNCiAgICAgICAgICogICAgIHZhciBobWFjID0gaG1hY0hhc2hlci5maW5hbGl6ZSgpOw0KICAgICAgICAgKiAgICAgdmFyIGhtYWMgPSBobWFjSGFzaGVyLmZpbmFsaXplKCdtZXNzYWdlJyk7DQogICAgICAgICAqICAgICB2YXIgaG1hYyA9IGhtYWNIYXNoZXIuZmluYWxpemUod29yZEFycmF5KTsNCiAgICAgICAgICovDQogICAgICAgIGZpbmFsaXplOiBmdW5jdGlvbiAobWVzc2FnZVVwZGF0ZSkgew0KICAgICAgICAgICAgLy8gU2hvcnRjdXQNCiAgICAgICAgICAgIHZhciBoYXNoZXIgPSB0aGlzLl9oYXNoZXI7DQoNCiAgICAgICAgICAgIC8vIENvbXB1dGUgSE1BQw0KICAgICAgICAgICAgdmFyIGlubmVySGFzaCA9IGhhc2hlci5maW5hbGl6ZShtZXNzYWdlVXBkYXRlKTsNCiAgICAgICAgICAgIGhhc2hlci5yZXNldCgpOw0KICAgICAgICAgICAgdmFyIGhtYWMgPSBoYXNoZXIuZmluYWxpemUodGhpcy5fb0tleS5jbG9uZSgpLmNvbmNhdChpbm5lckhhc2gpKTsNCg0KICAgICAgICAgICAgcmV0dXJuIGhtYWM7DQogICAgICAgIH0NCiAgICB9KTsNCn0oKSk7DQoKZGVmaW5lKCJjcnlwdG8uaG1hYyIsIFsiY3J5cHRvLmNvcmUiXSwgZnVuY3Rpb24oKXt9KTsKCi8qCkNyeXB0b0pTIHYzLjEuMgpjb2RlLmdvb2dsZS5jb20vcC9jcnlwdG8tanMKKGMpIDIwMDktMjAxMyBieSBKZWZmIE1vdHQuIEFsbCByaWdodHMgcmVzZXJ2ZWQuCmNvZGUuZ29vZ2xlLmNvbS9wL2NyeXB0by1qcy93aWtpL0xpY2Vuc2UKKi8KLyoqDQogKiBBIG5vb3AgcGFkZGluZyBzdHJhdGVneS4NCiAqLw0KQ3J5cHRvSlMucGFkLk5vUGFkZGluZyA9IHsNCiAgICBwYWQ6IGZ1bmN0aW9uICgpIHsNCiAgICB9LA0KDQogICAgdW5wYWQ6IGZ1bmN0aW9uICgpIHsNCiAgICB9DQp9Ow0KCmRlZmluZSgiY3J5cHRvLnBhZC1ub3BhZGRpbmciLCBbImNyeXB0by5jaXBoZXItY29yZSJdLCBmdW5jdGlvbigpe30pOwoKLyoKQ3J5cHRvSlMgdjMuMS4yCmNvZGUuZ29vZ2xlLmNvbS9wL2NyeXB0by1qcwooYykgMjAwOS0yMDEzIGJ5IEplZmYgTW90dC4gQWxsIHJpZ2h0cyByZXNlcnZlZC4KY29kZS5nb29nbGUuY29tL3AvY3J5cHRvLWpzL3dpa2kvTGljZW5zZQoqLwovKioNCiAqIENvdW50ZXIgYmxvY2sgbW9kZS4NCiAqLw0KQ3J5cHRvSlMubW9kZS5DVFIgPSAoZnVuY3Rpb24gKCkgew0KICAgIHZhciBDVFIgPSBDcnlwdG9KUy5saWIuQmxvY2tDaXBoZXJNb2RlLmV4dGVuZCgpOw0KDQogICAgdmFyIEVuY3J5cHRvciA9IENUUi5FbmNyeXB0b3IgPSBDVFIuZXh0ZW5kKHsNCiAgICAgICAgcHJvY2Vzc0Jsb2NrOiBmdW5jdGlvbiAod29yZHMsIG9mZnNldCkgew0KICAgICAgICAgICAgLy8gU2hvcnRjdXRzDQogICAgICAgICAgICB2YXIgY2lwaGVyID0gdGhpcy5fY2lwaGVyDQogICAgICAgICAgICB2YXIgYmxvY2tTaXplID0gY2lwaGVyLmJsb2NrU2l6ZTsNCiAgICAgICAgICAgIHZhciBpdiA9IHRoaXMuX2l2Ow0KICAgICAgICAgICAgdmFyIGNvdW50ZXIgPSB0aGlzLl9jb3VudGVyOw0KDQogICAgICAgICAgICAvLyBHZW5lcmF0ZSBrZXlzdHJlYW0NCiAgICAgICAgICAgIGlmIChpdikgew0KICAgICAgICAgICAgICAgIGNvdW50ZXIgPSB0aGlzLl9jb3VudGVyID0gaXYuc2xpY2UoMCk7DQoNCiAgICAgICAgICAgICAgICAvLyBSZW1vdmUgSVYgZm9yIHN1YnNlcXVlbnQgYmxvY2tzDQogICAgICAgICAgICAgICAgdGhpcy5faXYgPSB1bmRlZmluZWQ7DQogICAgICAgICAgICB9DQogICAgICAgICAgICB2YXIga2V5c3RyZWFtID0gY291bnRlci5zbGljZSgwKTsNCiAgICAgICAgICAgIGNpcGhlci5lbmNyeXB0QmxvY2soa2V5c3RyZWFtLCAwKTsNCg0KICAgICAgICAgICAgLy8gSW5jcmVtZW50IGNvdW50ZXINCiAgICAgICAgICAgIGNvdW50ZXJbYmxvY2tTaXplIC0gMV0gPSAoY291bnRlcltibG9ja1NpemUgLSAxXSArIDEpIHwgMA0KDQogICAgICAgICAgICAvLyBFbmNyeXB0DQogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGJsb2NrU2l6ZTsgaSsrKSB7DQogICAgICAgICAgICAgICAgd29yZHNbb2Zmc2V0ICsgaV0gXj0ga2V5c3RyZWFtW2ldOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfSk7DQoNCiAgICBDVFIuRGVjcnlwdG9yID0gRW5jcnlwdG9yOw0KDQogICAgcmV0dXJuIENUUjsNCn0oKSk7DQoKZGVmaW5lKCJjcnlwdG8ubW9kZS1jdHIiLCBbImNyeXB0by5jaXBoZXItY29yZSJdLCBmdW5jdGlvbigpe30pOwoKOyhmdW5jdGlvbiAocm9vdCwgZmFjdG9yeSkgewogICAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICJmdW5jdGlvbiIgJiYgZGVmaW5lLmFtZCkgewogICAgICAgIGRlZmluZSgnY3J5cHRvJyxbCiAgICAgICAgICAgICJjcnlwdG8uY29yZSIsCiAgICAgICAgICAgICJjcnlwdG8uZW5jLWJhc2U2NCIsCiAgICAgICAgICAgICJjcnlwdG8ubWQ1IiwKICAgICAgICAgICAgImNyeXB0by5ldnBrZGYiLAogICAgICAgICAgICAiY3J5cHRvLmNpcGhlci1jb3JlIiwKICAgICAgICAgICAgImNyeXB0by5hZXMiLAogICAgICAgICAgICAiY3J5cHRvLnNoYTEiLAogICAgICAgICAgICAiY3J5cHRvLnNoYTI1NiIsCiAgICAgICAgICAgICJjcnlwdG8uaG1hYyIsCiAgICAgICAgICAgICJjcnlwdG8ucGFkLW5vcGFkZGluZyIsCiAgICAgICAgICAgICJjcnlwdG8ubW9kZS1jdHIiCiAgICAgICAgICAgIF0sIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIENyeXB0b0pTOwogICAgICAgICAgICB9CiAgICAgICAgKTsKICAgIH0gZWxzZSB7CiAgICAgICAgcm9vdC5DcnlwdG9KUyA9IGZhY3RvcnkoKTsKICAgIH0KfSh0aGlzKSk7Cgo7KGZ1bmN0aW9uIChyb290LCBmYWN0b3J5KSB7CgogIGlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHsKICAgIGRlZmluZSgnYmlnaW50JyxbXSwgZmFjdG9yeS5iaW5kKHJvb3QsIHJvb3QuY3J5cHRvIHx8IHJvb3QubXNDcnlwdG8pKQogIH0gZWxzZSBpZiAodHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcgJiYgbW9kdWxlLmV4cG9ydHMpIHsKICAgIG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeShyZXF1aXJlKCdjcnlwdG8nKSkKICB9IGVsc2UgewogICAgcm9vdC5CaWdJbnQgPSBmYWN0b3J5KHJvb3QuY3J5cHRvIHx8IHJvb3QubXNDcnlwdG8pCiAgfQoKfSh0aGlzLCBmdW5jdGlvbiAoY3J5cHRvKSB7CgogIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAvLyBCaWcgSW50ZWdlciBMaWJyYXJ5IHYuIDUuNQogIC8vIENyZWF0ZWQgMjAwMCwgbGFzdCBtb2RpZmllZCAyMDEzCiAgLy8gTGVlbW9uIEJhaXJkCiAgLy8gd3d3LmxlZW1vbi5jb20KICAvLwogIC8vIFZlcnNpb24gaGlzdG9yeToKICAvLyB2IDUuNSAgMTcgTWFyIDIwMTMKICAvLyAgIC0gdHdvIGxpbmVzIG9mIGEgZm9ybSBsaWtlICJpZiAoeDwwKSB4Kz1uIiBoYWQgdGhlICJpZiIgY2hhbmdlZCB0byAid2hpbGUiIHRvCiAgLy8gICAgIGhhbmRsZSB0aGUgY2FzZSB3aGVuIHg8LW4uIChUaGFua3MgdG8gSmFtZXMgQW5zZWxsIGZvciBmaW5kaW5nIHRoYXQgYnVnKQogIC8vIHYgNS40ICAzIE9jdCAyMDA5CiAgLy8gICAtIGFkZGVkICJ2YXIgaSIgdG8gZ3JlYXRlclNoaWZ0KCkgc28gaSBpcyBub3QgZ2xvYmFsLiAoVGhhbmtzIHRvIFDDqXRlciBTemFiw7MgZm9yIGZpbmRpbmcgdGhhdCBidWcpCiAgLy8KICAvLyB2IDUuMyAgMjEgU2VwIDIwMDkKICAvLyAgIC0gYWRkZWQgcmFuZFByb2JQcmltZShrKSBmb3IgcHJvYmFibGUgcHJpbWVzCiAgLy8gICAtIHVucm9sbGVkIGxvb3AgaW4gbW9udF8gKHNsaWdodGx5IGZhc3RlcikKICAvLyAgIC0gbWlsbGVyUmFiaW4gbm93IHRha2VzIGEgYmlnSW50IHBhcmFtZXRlciByYXRoZXIgdGhhbiBhbiBpbnQKICAvLwogIC8vIHYgNS4yICAxNSBTZXAgMjAwOQogIC8vICAgLSBmaXhlZCBjYXBpdGFsaXphdGlvbiBpbiBjYWxsIHRvIGludDJiaWdJbnQgaW4gcmFuZEJpZ0ludAogIC8vICAgICAodGhhbmtzIHRvIEVtaWxpIEV2cmlwaWRvdSwgUmVpbmhvbGQgQmVocmluZ2VyLCBhbmQgU2FtdWVsIE1hY2FsZWVzZSBmb3IgZmluZGluZyB0aGF0IGJ1ZykKICAvLwogIC8vIHYgNS4xICA4IE9jdCAyMDA3IAogIC8vICAgLSByZW5hbWVkIGludmVyc2VNb2RJbnRfIHRvIGludmVyc2VNb2RJbnQgc2luY2UgaXQgZG9lc24ndCBjaGFuZ2UgaXRzIHBhcmFtZXRlcnMKICAvLyAgIC0gYWRkZWQgZnVuY3Rpb25zIEdDRCBhbmQgcmFuZEJpZ0ludCwgd2hpY2ggY2FsbCBHQ0RfIGFuZCByYW5kQmlnSW50XwogIC8vICAgLSBmaXhlZCBhIGJ1ZyBmb3VuZCBieSBSb2IgVmlzc2VyIChzZWUgY29tbWVudCB3aXRoIGhpcyBuYW1lIGJlbG93KQogIC8vICAgLSBpbXByb3ZlZCBjb21tZW50cwogIC8vCiAgLy8gVGhpcyBmaWxlIGlzIHB1YmxpYyBkb21haW4uICAgWW91IGNhbiB1c2UgaXQgZm9yIGFueSBwdXJwb3NlIHdpdGhvdXQgcmVzdHJpY3Rpb24uCiAgLy8gSSBkbyBub3QgZ3VhcmFudGVlIHRoYXQgaXQgaXMgY29ycmVjdCwgc28gdXNlIGl0IGF0IHlvdXIgb3duIHJpc2suICBJZiB5b3UgdXNlIAogIC8vIGl0IGZvciBzb21ldGhpbmcgaW50ZXJlc3RpbmcsIEknZCBhcHByZWNpYXRlIGhlYXJpbmcgYWJvdXQgaXQuICBJZiB5b3UgZmluZCAKICAvLyBhbnkgYnVncyBvciBtYWtlIGFueSBpbXByb3ZlbWVudHMsIEknZCBhcHByZWNpYXRlIGhlYXJpbmcgYWJvdXQgdGhvc2UgdG9vLgogIC8vIEl0IHdvdWxkIGFsc28gYmUgbmljZSBpZiBteSBuYW1lIGFuZCBVUkwgd2VyZSBsZWZ0IGluIHRoZSBjb21tZW50cy4gIEJ1dCBub25lIAogIC8vIG9mIHRoYXQgaXMgcmVxdWlyZWQuCiAgLy8KICAvLyBUaGlzIGNvZGUgZGVmaW5lcyBhIGJpZ0ludCBsaWJyYXJ5IGZvciBhcmJpdHJhcnktcHJlY2lzaW9uIGludGVnZXJzLgogIC8vIEEgYmlnSW50IGlzIGFuIGFycmF5IG9mIGludGVnZXJzIHN0b3JpbmcgdGhlIHZhbHVlIGluIGNodW5rcyBvZiBicGUgYml0cywgCiAgLy8gbGl0dGxlIGVuZGlhbiAoYnVmZlswXSBpcyB0aGUgbGVhc3Qgc2lnbmlmaWNhbnQgd29yZCkuCiAgLy8gTmVnYXRpdmUgYmlnSW50cyBhcmUgc3RvcmVkIHR3bydzIGNvbXBsZW1lbnQuICBBbG1vc3QgYWxsIHRoZSBmdW5jdGlvbnMgdHJlYXQKICAvLyBiaWdJbnRzIGFzIG5vbm5lZ2F0aXZlLiAgVGhlIGZldyB0aGF0IHZpZXcgdGhlbSBhcyB0d28ncyBjb21wbGVtZW50IHNheSBzbwogIC8vIGluIHRoZWlyIGNvbW1lbnRzLiAgU29tZSBmdW5jdGlvbnMgYXNzdW1lIHRoZWlyIHBhcmFtZXRlcnMgaGF2ZSBhdCBsZWFzdCBvbmUgCiAgLy8gbGVhZGluZyB6ZXJvIGVsZW1lbnQuIEZ1bmN0aW9ucyB3aXRoIGFuIHVuZGVyc2NvcmUgYXQgdGhlIGVuZCBvZiB0aGUgbmFtZSBwdXQKICAvLyB0aGVpciBhbnN3ZXIgaW50byBvbmUgb2YgdGhlIGFycmF5cyBwYXNzZWQgaW4sIGFuZCBoYXZlIHVucHJlZGljdGFibGUgYmVoYXZpb3IgCiAgLy8gaW4gY2FzZSBvZiBvdmVyZmxvdywgc28gdGhlIGNhbGxlciBtdXN0IG1ha2Ugc3VyZSB0aGUgYXJyYXlzIGFyZSBiaWcgZW5vdWdoIHRvIAogIC8vIGhvbGQgdGhlIGFuc3dlci4gIEJ1dCB0aGUgYXZlcmFnZSB1c2VyIHNob3VsZCBuZXZlciBoYXZlIHRvIGNhbGwgYW55IG9mIHRoZSAKICAvLyB1bmRlcnNjb3JlZCBmdW5jdGlvbnMuICBFYWNoIGltcG9ydGFudCB1bmRlcnNjb3JlZCBmdW5jdGlvbiBoYXMgYSB3cmFwcGVyIGZ1bmN0aW9uIAogIC8vIG9mIHRoZSBzYW1lIG5hbWUgd2l0aG91dCB0aGUgdW5kZXJzY29yZSB0aGF0IHRha2VzIGNhcmUgb2YgdGhlIGRldGFpbHMgZm9yIHlvdS4gIAogIC8vIEZvciBlYWNoIHVuZGVyc2NvcmVkIGZ1bmN0aW9uIHdoZXJlIGEgcGFyYW1ldGVyIGlzIG1vZGlmaWVkLCB0aGF0IHNhbWUgdmFyaWFibGUgCiAgLy8gbXVzdCBub3QgYmUgdXNlZCBhcyBhbm90aGVyIGFyZ3VtZW50IHRvby4gIFNvLCB5b3UgY2Fubm90IHNxdWFyZSB4IGJ5IGRvaW5nIAogIC8vIG11bHRNb2RfKHgseCxuKS4gIFlvdSBtdXN0IHVzZSBzcXVhcmVNb2RfKHgsbikgaW5zdGVhZCwgb3IgZG8geT1kdXAoeCk7IG11bHRNb2RfKHgseSxuKS4KICAvLyBPciBzaW1wbHkgdXNlIHRoZSBtdWx0TW9kKHgseCxuKSBmdW5jdGlvbiB3aXRob3V0IHRoZSB1bmRlcnNjb3JlLCB3aGVyZQogIC8vIHN1Y2ggaXNzdWVzIG5ldmVyIGFyaXNlLCBiZWNhdXNlIG5vbi11bmRlcnNjb3JlZCBmdW5jdGlvbnMgbmV2ZXIgY2hhbmdlCiAgLy8gdGhlaXIgcGFyYW1ldGVyczsgdGhleSBhbHdheXMgYWxsb2NhdGUgbmV3IG1lbW9yeSBmb3IgdGhlIGFuc3dlciB0aGF0IGlzIHJldHVybmVkLgogIC8vCiAgLy8gVGhlc2UgZnVuY3Rpb25zIGFyZSBkZXNpZ25lZCB0byBhdm9pZCBmcmVxdWVudCBkeW5hbWljIG1lbW9yeSBhbGxvY2F0aW9uIGluIHRoZSBpbm5lciBsb29wLgogIC8vIEZvciBtb3N0IGZ1bmN0aW9ucywgaWYgaXQgbmVlZHMgYSBCaWdJbnQgYXMgYSBsb2NhbCB2YXJpYWJsZSBpdCB3aWxsIGFjdHVhbGx5IHVzZQogIC8vIGEgZ2xvYmFsLCBhbmQgd2lsbCBvbmx5IGFsbG9jYXRlIHRvIGl0IG9ubHkgd2hlbiBpdCdzIG5vdCB0aGUgcmlnaHQgc2l6ZS4gIFRoaXMgZW5zdXJlcwogIC8vIHRoYXQgd2hlbiBhIGZ1bmN0aW9uIGlzIGNhbGxlZCByZXBlYXRlZGx5IHdpdGggc2FtZS1zaXplZCBwYXJhbWV0ZXJzLCBpdCBvbmx5IGFsbG9jYXRlcwogIC8vIG1lbW9yeSBvbiB0aGUgZmlyc3QgY2FsbC4KICAvLwogIC8vIE5vdGUgdGhhdCBmb3IgY3J5cHRvZ3JhcGhpYyBwdXJwb3NlcywgdGhlIGNhbGxzIHRvIE1hdGgucmFuZG9tKCkgbXVzdCAKICAvLyBiZSByZXBsYWNlZCB3aXRoIGNhbGxzIHRvIGEgYmV0dGVyIHBzZXVkb3JhbmRvbSBudW1iZXIgZ2VuZXJhdG9yLgogIC8vCiAgLy8gSW4gdGhlIGZvbGxvd2luZywgImJpZ0ludCIgbWVhbnMgYSBiaWdJbnQgd2l0aCBhdCBsZWFzdCBvbmUgbGVhZGluZyB6ZXJvIGVsZW1lbnQsCiAgLy8gYW5kICJpbnRlZ2VyIiBtZWFucyBhIG5vbm5lZ2F0aXZlIGludGVnZXIgbGVzcyB0aGFuIHJhZGl4LiAgSW4gc29tZSBjYXNlcywgaW50ZWdlciAKICAvLyBjYW4gYmUgbmVnYXRpdmUuICBOZWdhdGl2ZSBiaWdJbnRzIGFyZSAycyBjb21wbGVtZW50LgogIC8vIAogIC8vIFRoZSBmb2xsb3dpbmcgZnVuY3Rpb25zIGRvIG5vdCBtb2RpZnkgdGhlaXIgaW5wdXRzLgogIC8vIFRob3NlIHJldHVybmluZyBhIGJpZ0ludCwgc3RyaW5nLCBvciBBcnJheSB3aWxsIGR5bmFtaWNhbGx5IGFsbG9jYXRlIG1lbW9yeSBmb3IgdGhhdCB2YWx1ZS4KICAvLyBUaG9zZSByZXR1cm5pbmcgYSBib29sZWFuIHdpbGwgcmV0dXJuIHRoZSBpbnRlZ2VyIDAgKGZhbHNlKSBvciAxICh0cnVlKS4KICAvLyBUaG9zZSByZXR1cm5pbmcgYm9vbGVhbiBvciBpbnQgd2lsbCBub3QgYWxsb2NhdGUgbWVtb3J5IGV4Y2VwdCBwb3NzaWJseSBvbiB0aGUgZmlyc3QgCiAgLy8gdGltZSB0aGV5J3JlIGNhbGxlZCB3aXRoIGEgZ2l2ZW4gcGFyYW1ldGVyIHNpemUuCiAgLy8gCiAgLy8gYmlnSW50ICBhZGQoeCx5KSAgICAgICAgICAgICAgIC8vcmV0dXJuICh4K3kpIGZvciBiaWdJbnRzIHggYW5kIHkuICAKICAvLyBiaWdJbnQgIGFkZEludCh4LG4pICAgICAgICAgICAgLy9yZXR1cm4gKHgrbikgd2hlcmUgeCBpcyBhIGJpZ0ludCBhbmQgbiBpcyBhbiBpbnRlZ2VyLgogIC8vIHN0cmluZyAgYmlnSW50MnN0cih4LGJhc2UpICAgICAvL3JldHVybiBhIHN0cmluZyBmb3JtIG9mIGJpZ0ludCB4IGluIGEgZ2l2ZW4gYmFzZSwgd2l0aCAyIDw9IGJhc2UgPD0gOTUKICAvLyBpbnQgICAgIGJpdFNpemUoeCkgICAgICAgICAgICAgLy9yZXR1cm4gaG93IG1hbnkgYml0cyBsb25nIHRoZSBiaWdJbnQgeCBpcywgbm90IGNvdW50aW5nIGxlYWRpbmcgemVyb3MKICAvLyBiaWdJbnQgIGR1cCh4KSAgICAgICAgICAgICAgICAgLy9yZXR1cm4gYSBjb3B5IG9mIGJpZ0ludCB4CiAgLy8gYm9vbGVhbiBlcXVhbHMoeCx5KSAgICAgICAgICAgIC8vaXMgdGhlIGJpZ0ludCB4IGVxdWFsIHRvIHRoZSBiaWdpbnQgeT8KICAvLyBib29sZWFuIGVxdWFsc0ludCh4LHkpICAgICAgICAgLy9pcyBiaWdpbnQgeCBlcXVhbCB0byBpbnRlZ2VyIHk/CiAgLy8gYmlnSW50ICBleHBhbmQoeCxuKSAgICAgICAgICAgIC8vcmV0dXJuIGEgY29weSBvZiB4IHdpdGggYXQgbGVhc3QgbiBlbGVtZW50cywgYWRkaW5nIGxlYWRpbmcgemVyb3MgaWYgbmVlZGVkCiAgLy8gQXJyYXkgICBmaW5kUHJpbWVzKG4pICAgICAgICAgIC8vcmV0dXJuIGFycmF5IG9mIGFsbCBwcmltZXMgbGVzcyB0aGFuIGludGVnZXIgbgogIC8vIGJpZ0ludCAgR0NEKHgseSkgICAgICAgICAgICAgICAvL3JldHVybiBncmVhdGVzdCBjb21tb24gZGl2aXNvciBvZiBiaWdJbnRzIHggYW5kIHkgKGVhY2ggd2l0aCBzYW1lIG51bWJlciBvZiBlbGVtZW50cykuCiAgLy8gYm9vbGVhbiBncmVhdGVyKHgseSkgICAgICAgICAgIC8vaXMgeD55PyAgKHggYW5kIHkgYXJlIG5vbm5lZ2F0aXZlIGJpZ0ludHMpCiAgLy8gYm9vbGVhbiBncmVhdGVyU2hpZnQoeCx5LHNoaWZ0KS8vaXMgKHggPDwoc2hpZnQqYnBlKSkgPiB5PwogIC8vIGJpZ0ludCAgaW50MmJpZ0ludCh0LG4sbSkgICAgICAvL3JldHVybiBhIGJpZ0ludCBlcXVhbCB0byBpbnRlZ2VyIHQsIHdpdGggYXQgbGVhc3QgbiBiaXRzIGFuZCBtIGFycmF5IGVsZW1lbnRzCiAgLy8gYmlnSW50ICBpbnZlcnNlTW9kKHgsbikgICAgICAgIC8vcmV0dXJuICh4KiooLTEpIG1vZCBuKSBmb3IgYmlnSW50cyB4IGFuZCBuLiAgSWYgbm8gaW52ZXJzZSBleGlzdHMsIGl0IHJldHVybnMgbnVsbAogIC8vIGludCAgICAgaW52ZXJzZU1vZEludCh4LG4pICAgICAvL3JldHVybiB4KiooLTEpIG1vZCBuLCBmb3IgaW50ZWdlcnMgeCBhbmQgbi4gIFJldHVybiAwIGlmIHRoZXJlIGlzIG5vIGludmVyc2UKICAvLyBib29sZWFuIGlzWmVybyh4KSAgICAgICAgICAgICAgLy9pcyB0aGUgYmlnSW50IHggZXF1YWwgdG8gemVybz8KICAvLyBib29sZWFuIG1pbGxlclJhYmluKHgsYikgICAgICAgLy9kb2VzIG9uZSByb3VuZCBvZiBNaWxsZXItUmFiaW4gYmFzZSBpbnRlZ2VyIGIgc2F5IHRoYXQgYmlnSW50IHggaXMgcG9zc2libHkgcHJpbWU/IChiIGlzIGJpZ0ludCwgMTxiPHgpCiAgLy8gYm9vbGVhbiBtaWxsZXJSYWJpbkludCh4LGIpICAgIC8vZG9lcyBvbmUgcm91bmQgb2YgTWlsbGVyLVJhYmluIGJhc2UgaW50ZWdlciBiIHNheSB0aGF0IGJpZ0ludCB4IGlzIHBvc3NpYmx5IHByaW1lPyAoYiBpcyBpbnQsICAgIDE8Yjx4KQogIC8vIGJpZ0ludCAgbW9kKHgsbikgICAgICAgICAgICAgICAvL3JldHVybiBhIG5ldyBiaWdJbnQgZXF1YWwgdG8gKHggbW9kIG4pIGZvciBiaWdJbnRzIHggYW5kIG4uCiAgLy8gaW50ICAgICBtb2RJbnQoeCxuKSAgICAgICAgICAgIC8vcmV0dXJuIHggbW9kIG4gZm9yIGJpZ0ludCB4IGFuZCBpbnRlZ2VyIG4uCiAgLy8gYmlnSW50ICBtdWx0KHgseSkgICAgICAgICAgICAgIC8vcmV0dXJuIHgqeSBmb3IgYmlnSW50cyB4IGFuZCB5LiBUaGlzIGlzIGZhc3RlciB3aGVuIHk8eC4KICAvLyBiaWdJbnQgIG11bHRNb2QoeCx5LG4pICAgICAgICAgLy9yZXR1cm4gKHgqeSBtb2QgbikgZm9yIGJpZ0ludHMgeCx5LG4uICBGb3IgZ3JlYXRlciBzcGVlZCwgbGV0IHk8eC4KICAvLyBib29sZWFuIG5lZ2F0aXZlKHgpICAgICAgICAgICAgLy9pcyBiaWdJbnQgeCBuZWdhdGl2ZT8KICAvLyBiaWdJbnQgIHBvd01vZCh4LHksbikgICAgICAgICAgLy9yZXR1cm4gKHgqKnkgbW9kIG4pIHdoZXJlIHgseSxuIGFyZSBiaWdJbnRzIGFuZCAqKiBpcyBleHBvbmVudGlhdGlvbi4gIDAqKjA9MS4gRmFzdGVyIGZvciBvZGQgbi4KICAvLyBiaWdJbnQgIHJhbmRCaWdJbnQobixzKSAgICAgICAgLy9yZXR1cm4gYW4gbi1iaXQgcmFuZG9tIEJpZ0ludCAobj49MSkuICBJZiBzPTEsIHRoZW4gdGhlIG1vc3Qgc2lnbmlmaWNhbnQgb2YgdGhvc2UgbiBiaXRzIGlzIHNldCB0byAxLgogIC8vIGJpZ0ludCAgcmFuZFRydWVQcmltZShrKSAgICAgICAvL3JldHVybiBhIG5ldywgcmFuZG9tLCBrLWJpdCwgdHJ1ZSBwcmltZSBiaWdJbnQgdXNpbmcgTWF1cmVyJ3MgYWxnb3JpdGhtLgogIC8vIGJpZ0ludCAgcmFuZFByb2JQcmltZShrKSAgICAgICAvL3JldHVybiBhIG5ldywgcmFuZG9tLCBrLWJpdCwgcHJvYmFibGUgcHJpbWUgYmlnSW50IChwcm9iYWJpbGl0eSBpdCdzIGNvbXBvc2l0ZSBsZXNzIHRoYW4gMl4tODApLgogIC8vIGJpZ0ludCAgc3RyMmJpZ0ludChzLGIsbixtKSAgICAvL3JldHVybiBhIGJpZ0ludCBmb3IgbnVtYmVyIHJlcHJlc2VudGVkIGluIHN0cmluZyBzIGluIGJhc2UgYiB3aXRoIGF0IGxlYXN0IG4gYml0cyBhbmQgbSBhcnJheSBlbGVtZW50cwogIC8vIGJpZ0ludCAgc3ViKHgseSkgICAgICAgICAgICAgICAvL3JldHVybiAoeC15KSBmb3IgYmlnSW50cyB4IGFuZCB5LiAgTmVnYXRpdmUgYW5zd2VycyB3aWxsIGJlIDJzIGNvbXBsZW1lbnQKICAvLyBiaWdJbnQgIHRyaW0oeCxrKSAgICAgICAgICAgICAgLy9yZXR1cm4gYSBjb3B5IG9mIHggd2l0aCBleGFjdGx5IGsgbGVhZGluZyB6ZXJvIGVsZW1lbnRzCiAgLy8KICAvLwogIC8vIFRoZSBmb2xsb3dpbmcgZnVuY3Rpb25zIGVhY2ggaGF2ZSBhIG5vbi11bmRlcnNjb3JlZCB2ZXJzaW9uLCB3aGljaCBtb3N0IHVzZXJzIHNob3VsZCBjYWxsIGluc3RlYWQuCiAgLy8gVGhlc2UgZnVuY3Rpb25zIGVhY2ggd3JpdGUgdG8gYSBzaW5nbGUgcGFyYW1ldGVyLCBhbmQgdGhlIGNhbGxlciBpcyByZXNwb25zaWJsZSBmb3IgZW5zdXJpbmcgdGhlIGFycmF5IAogIC8vIHBhc3NlZCBpbiBpcyBsYXJnZSBlbm91Z2ggdG8gaG9sZCB0aGUgcmVzdWx0LiAKICAvLwogIC8vIHZvaWQgICAgYWRkSW50Xyh4LG4pICAgICAgICAgIC8vZG8geD14K24gd2hlcmUgeCBpcyBhIGJpZ0ludCBhbmQgbiBpcyBhbiBpbnRlZ2VyCiAgLy8gdm9pZCAgICBhZGRfKHgseSkgICAgICAgICAgICAgLy9kbyB4PXgreSBmb3IgYmlnSW50cyB4IGFuZCB5CiAgLy8gdm9pZCAgICBjb3B5Xyh4LHkpICAgICAgICAgICAgLy9kbyB4PXkgb24gYmlnSW50cyB4IGFuZCB5CiAgLy8gdm9pZCAgICBjb3B5SW50Xyh4LG4pICAgICAgICAgLy9kbyB4PW4gb24gYmlnSW50IHggYW5kIGludGVnZXIgbgogIC8vIHZvaWQgICAgR0NEXyh4LHkpICAgICAgICAgICAgIC8vc2V0IHggdG8gdGhlIGdyZWF0ZXN0IGNvbW1vbiBkaXZpc29yIG9mIGJpZ0ludHMgeCBhbmQgeSwgKHkgaXMgZGVzdHJveWVkKS4gIChUaGlzIG5ldmVyIG92ZXJmbG93cyBpdHMgYXJyYXkpLgogIC8vIGJvb2xlYW4gaW52ZXJzZU1vZF8oeCxuKSAgICAgIC8vZG8geD14KiooLTEpIG1vZCBuLCBmb3IgYmlnSW50cyB4IGFuZCBuLiBSZXR1cm5zIDEgKDApIGlmIGludmVyc2UgZG9lcyAoZG9lc24ndCkgZXhpc3QKICAvLyB2b2lkICAgIG1vZF8oeCxuKSAgICAgICAgICAgICAvL2RvIHg9eCBtb2QgbiBmb3IgYmlnSW50cyB4IGFuZCBuLiAoVGhpcyBuZXZlciBvdmVyZmxvd3MgaXRzIGFycmF5KS4KICAvLyB2b2lkICAgIG11bHRfKHgseSkgICAgICAgICAgICAvL2RvIHg9eCp5IGZvciBiaWdJbnRzIHggYW5kIHkuCiAgLy8gdm9pZCAgICBtdWx0TW9kXyh4LHksbikgICAgICAgLy9kbyB4PXgqeSAgbW9kIG4gZm9yIGJpZ0ludHMgeCx5LG4uCiAgLy8gdm9pZCAgICBwb3dNb2RfKHgseSxuKSAgICAgICAgLy9kbyB4PXgqKnkgbW9kIG4sIHdoZXJlIHgseSxuIGFyZSBiaWdJbnRzIChuIGlzIG9kZCkgYW5kICoqIGlzIGV4cG9uZW50aWF0aW9uLiAgMCoqMD0xLgogIC8vIHZvaWQgICAgcmFuZEJpZ0ludF8oYixuLHMpICAgIC8vZG8gYiA9IGFuIG4tYml0IHJhbmRvbSBCaWdJbnQuIGlmIHM9MSwgdGhlbiBudGggYml0IChtb3N0IHNpZ25pZmljYW50IGJpdCkgaXMgc2V0IHRvIDEuIG4+PTEuCiAgLy8gdm9pZCAgICByYW5kVHJ1ZVByaW1lXyhhbnMsaykgLy9kbyBhbnMgPSBhIHJhbmRvbSBrLWJpdCB0cnVlIHJhbmRvbSBwcmltZSAobm90IGp1c3QgcHJvYmFibGUgcHJpbWUpIHdpdGggMSBpbiB0aGUgbXNiLgogIC8vIHZvaWQgICAgc3ViXyh4LHkpICAgICAgICAgICAgIC8vZG8geD14LXkgZm9yIGJpZ0ludHMgeCBhbmQgeS4gTmVnYXRpdmUgYW5zd2VycyB3aWxsIGJlIDJzIGNvbXBsZW1lbnQuCiAgLy8KICAvLyBUaGUgZm9sbG93aW5nIGZ1bmN0aW9ucyBkbyBOT1QgaGF2ZSBhIG5vbi11bmRlcnNjb3JlZCB2ZXJzaW9uLiAKICAvLyBUaGV5IGVhY2ggd3JpdGUgYSBiaWdJbnQgcmVzdWx0IHRvIG9uZSBvciBtb3JlIHBhcmFtZXRlcnMuICBUaGUgY2FsbGVyIGlzIHJlc3BvbnNpYmxlIGZvcgogIC8vIGVuc3VyaW5nIHRoZSBhcnJheXMgcGFzc2VkIGluIGFyZSBsYXJnZSBlbm91Z2ggdG8gaG9sZCB0aGUgcmVzdWx0cy4gCiAgLy8KICAvLyB2b2lkIGFkZFNoaWZ0Xyh4LHkseXMpICAgICAgIC8vZG8geD14Kyh5PDwoeXMqYnBlKSkKICAvLyB2b2lkIGNhcnJ5Xyh4KSAgICAgICAgICAgICAgIC8vZG8gY2FycmllcyBhbmQgYm9ycm93cyBzbyBlYWNoIGVsZW1lbnQgb2YgdGhlIGJpZ0ludCB4IGZpdHMgaW4gYnBlIGJpdHMuCiAgLy8gdm9pZCBkaXZpZGVfKHgseSxxLHIpICAgICAgICAvL2RpdmlkZSB4IGJ5IHkgZ2l2aW5nIHF1b3RpZW50IHEgYW5kIHJlbWFpbmRlciByCiAgLy8gaW50ICBkaXZJbnRfKHgsbikgICAgICAgICAgICAvL2RvIHg9Zmxvb3IoeC9uKSBmb3IgYmlnSW50IHggYW5kIGludGVnZXIgbiwgYW5kIHJldHVybiB0aGUgcmVtYWluZGVyLiAoVGhpcyBuZXZlciBvdmVyZmxvd3MgaXRzIGFycmF5KS4KICAvLyBpbnQgIGVHQ0RfKHgseSxkLGEsYikgICAgICAgIC8vc2V0cyBhLGIsZCB0byBwb3NpdGl2ZSBiaWdJbnRzIHN1Y2ggdGhhdCBkID0gR0NEXyh4LHkpID0gYSp4LWIqeQogIC8vIHZvaWQgaGFsdmVfKHgpICAgICAgICAgICAgICAgLy9kbyB4PWZsb29yKHx4fC8yKSpzZ24oeCkgZm9yIGJpZ0ludCB4IGluIDIncyBjb21wbGVtZW50LiAgKFRoaXMgbmV2ZXIgb3ZlcmZsb3dzIGl0cyBhcnJheSkuCiAgLy8gdm9pZCBsZWZ0U2hpZnRfKHgsbikgICAgICAgICAvL2xlZnQgc2hpZnQgYmlnSW50IHggYnkgbiBiaXRzLiAgbjxicGUuCiAgLy8gdm9pZCBsaW5Db21iXyh4LHksYSxiKSAgICAgICAvL2RvIHg9YSp4K2IqeSBmb3IgYmlnSW50cyB4IGFuZCB5IGFuZCBpbnRlZ2VycyBhIGFuZCBiCiAgLy8gdm9pZCBsaW5Db21iU2hpZnRfKHgseSxiLHlzKSAvL2RvIHg9eCtiKih5PDwoeXMqYnBlKSkgZm9yIGJpZ0ludHMgeCBhbmQgeSwgYW5kIGludGVnZXJzIGIgYW5kIHlzCiAgLy8gdm9pZCBtb250Xyh4LHksbixucCkgICAgICAgICAvL01vbnRnb21lcnkgbXVsdGlwbGljYXRpb24gKHNlZSBjb21tZW50cyB3aGVyZSB0aGUgZnVuY3Rpb24gaXMgZGVmaW5lZCkKICAvLyB2b2lkIG11bHRJbnRfKHgsbikgICAgICAgICAgIC8vZG8geD14Km4gd2hlcmUgeCBpcyBhIGJpZ0ludCBhbmQgbiBpcyBhbiBpbnRlZ2VyLgogIC8vIHZvaWQgcmlnaHRTaGlmdF8oeCxuKSAgICAgICAgLy9yaWdodCBzaGlmdCBiaWdJbnQgeCBieSBuIGJpdHMuIChUaGlzIG5ldmVyIG92ZXJmbG93cyBpdHMgYXJyYXkpLgogIC8vIHZvaWQgc3F1YXJlTW9kXyh4LG4pICAgICAgICAgLy9kbyB4PXgqeCAgbW9kIG4gZm9yIGJpZ0ludHMgeCxuCiAgLy8gdm9pZCBzdWJTaGlmdF8oeCx5LHlzKSAgICAgICAvL2RvIHg9eC0oeTw8KHlzKmJwZSkpLiBOZWdhdGl2ZSBhbnN3ZXJzIHdpbGwgYmUgMnMgY29tcGxlbWVudC4KICAvLwogIC8vIFRoZSBmb2xsb3dpbmcgZnVuY3Rpb25zIGFyZSBiYXNlZCBvbiBhbGdvcml0aG1zIGZyb20gdGhlIF9IYW5kYm9vayBvZiBBcHBsaWVkIENyeXB0b2dyYXBoeV8KICAvLyAgICBwb3dNb2RfKCkgICAgICAgICAgID0gYWxnb3JpdGhtIDE0Ljk0LCBNb250Z29tZXJ5IGV4cG9uZW50aWF0aW9uCiAgLy8gICAgZUdDRF8saW52ZXJzZU1vZF8oKSA9IGFsZ29yaXRobSAxNC42MSwgQmluYXJ5IGV4dGVuZGVkIEdDRF8KICAvLyAgICBHQ0RfKCkgICAgICAgICAgICAgID0gYWxnb3JvdGhtIDE0LjU3LCBMZWhtZXIncyBhbGdvcml0aG0KICAvLyAgICBtb250XygpICAgICAgICAgICAgID0gYWxnb3JpdGhtIDE0LjM2LCBNb250Z29tZXJ5IG11bHRpcGxpY2F0aW9uCiAgLy8gICAgZGl2aWRlXygpICAgICAgICAgICA9IGFsZ29yaXRobSAxNC4yMCAgTXVsdGlwbGUtcHJlY2lzaW9uIGRpdmlzaW9uCiAgLy8gICAgc3F1YXJlTW9kXygpICAgICAgICA9IGFsZ29yaXRobSAxNC4xNiAgTXVsdGlwbGUtcHJlY2lzaW9uIHNxdWFyaW5nCiAgLy8gICAgcmFuZFRydWVQcmltZV8oKSAgICA9IGFsZ29yaXRobSAgNC42MiwgTWF1cmVyJ3MgYWxnb3JpdGhtCiAgLy8gICAgbWlsbGVyUmFiaW4oKSAgICAgICA9IGFsZ29yaXRobSAgNC4yNCwgTWlsbGVyLVJhYmluIGFsZ29yaXRobQogIC8vCiAgLy8gUHJvZmlsaW5nIHNob3dzOgogIC8vICAgICByYW5kVHJ1ZVByaW1lXygpIHNwZW5kczoKICAvLyAgICAgICAgIDEwJSBvZiBpdHMgdGltZSBpbiBjYWxscyB0byBwb3dNb2RfKCkKICAvLyAgICAgICAgIDg1JSBvZiBpdHMgdGltZSBpbiBjYWxscyB0byBtaWxsZXJSYWJpbigpCiAgLy8gICAgIG1pbGxlclJhYmluKCkgc3BlbmRzOgogIC8vICAgICAgICAgOTklIG9mIGl0cyB0aW1lIGluIGNhbGxzIHRvIHBvd01vZF8oKSAgIChhbHdheXMgd2l0aCBhIGJhc2Ugb2YgMikKICAvLyAgICAgcG93TW9kXygpIHNwZW5kczoKICAvLyAgICAgICAgIDk0JSBvZiBpdHMgdGltZSBpbiBjYWxscyB0byBtb250XygpICAoYWxtb3N0IGFsd2F5cyB3aXRoIHg9PXkpCiAgLy8KICAvLyBUaGlzIHN1Z2dlc3RzIHRoZXJlIGFyZSBzZXZlcmFsIHdheXMgdG8gc3BlZWQgdXAgdGhpcyBsaWJyYXJ5IHNsaWdodGx5OgogIC8vICAgICAtIGNvbnZlcnQgcG93TW9kXyB0byB1c2UgYSBNb250Z29tZXJ5IGZvcm0gb2Ygay1hcnkgd2luZG93IChvciBtYXliZSBhIE1vbnRnb21lcnkgZm9ybSBvZiBzbGlkaW5nIHdpbmRvdykKICAvLyAgICAgICAgIC0tIHRoaXMgc2hvdWxkIGVzcGVjaWFsbHkgZm9jdXMgb24gYmVpbmcgZmFzdCB3aGVuIHJhaXNpbmcgMiB0byBhIHBvd2VyIG1vZCBuCiAgLy8gICAgIC0gY29udmVydCByYW5kVHJ1ZVByaW1lXygpIHRvIHVzZSBhIG1pbmltdW0gciBvZiAxLzMgaW5zdGVhZCBvZiAxLzIgd2l0aCB0aGUgYXBwcm9wcmlhdGUgY2hhbmdlIHRvIHRoZSB0ZXN0CiAgLy8gICAgIC0gdHVuZSB0aGUgcGFyYW1ldGVycyBpbiByYW5kVHJ1ZVByaW1lXygpLCBpbmNsdWRpbmcgYywgbSwgYW5kIHJlY0xpbWl0CiAgLy8gICAgIC0gc3BlZWQgdXAgdGhlIHNpbmdsZSBsb29wIGluIG1vbnRfKCkgdGhhdCB0YWtlcyA5NSUgb2YgdGhlIHJ1bnRpbWUsIHBlcmhhcHMgYnkgcmVkdWNpbmcgY2hlY2tpbmcKICAvLyAgICAgICB3aXRoaW4gdGhlIGxvb3Agd2hlbiBhbGwgdGhlIHBhcmFtZXRlcnMgYXJlIHRoZSBzYW1lIGxlbmd0aC4KICAvLwogIC8vIFRoZXJlIGFyZSBzZXZlcmFsIGlkZWFzIHRoYXQgbG9vayBsaWtlIHRoZXkgd291bGRuJ3QgaGVscCBtdWNoIGF0IGFsbDoKICAvLyAgICAgLSByZXBsYWNpbmcgdHJpYWwgZGl2aXNpb24gaW4gcmFuZFRydWVQcmltZV8oKSB3aXRoIGEgc2lldmUgKHRoYXQgc3BlZWRzIHVwIHNvbWV0aGluZyB0YWtpbmcgYWxtb3N0IG5vIHRpbWUgYW55d2F5KQogIC8vICAgICAtIGluY3JlYXNlIGJwZSBmcm9tIDE1IHRvIDMwICh0aGF0IHdvdWxkIGhlbHAgaWYgd2UgaGFkIGEgMzIqMzItPjY0IG11bHRpcGxpZXIsIGJ1dCBub3Qgd2l0aCBKYXZhU2NyaXB0J3MgMzIqMzItPjMyKQogIC8vICAgICAtIHNwZWVkaW5nIHVwIG1vbnRfKHgseSxuLG5wKSB3aGVuIHg9PXkgYnkgZG9pbmcgYSBub24tbW9kdWxhciwgbm9uLU1vbnRnb21lcnkgc3F1YXJlCiAgLy8gICAgICAgZm9sbG93ZWQgYnkgYSBNb250Z29tZXJ5IHJlZHVjdGlvbi4gIFRoZSBpbnRlcm1lZGlhdGUgYW5zd2VyIHdpbGwgYmUgdHdpY2UgYXMgbG9uZyBhcyB4LCBzbyB0aGF0CiAgLy8gICAgICAgbWV0aG9kIHdvdWxkIGJlIHNsb3dlci4gIFRoaXMgaXMgdW5mb3J0dW5hdGUgYmVjYXVzZSB0aGUgY29kZSBjdXJyZW50bHkgc3BlbmRzIGFsbW9zdCBhbGwgb2YgaXRzIHRpbWUKICAvLyAgICAgICBkb2luZyBtb250Xyh4LHgsLi4uKSwgYm90aCBmb3IgcmFuZFRydWVQcmltZV8oKSBhbmQgcG93TW9kXygpLiAgQSBmYXN0ZXIgbWV0aG9kIGZvciBNb250Z29tZXJ5IHNxdWFyaW5nCiAgLy8gICAgICAgd291bGQgaGF2ZSBhIGxhcmdlIGltcGFjdCBvbiB0aGUgc3BlZWQgb2YgcmFuZFRydWVQcmltZV8oKSBhbmQgcG93TW9kXygpLiAgSEFDIGhhcyBhIGNvdXBsZSBvZiBwb29ybHktd29yZGVkCiAgLy8gICAgICAgc2VudGVuY2VzIHRoYXQgc2VlbSB0byBpbXBseSBpdCdzIGZhc3RlciB0byBkbyBhIG5vbi1tb2R1bGFyIHNxdWFyZSBmb2xsb3dlZCBieSBhIHNpbmdsZQogIC8vICAgICAgIE1vbnRnb21lcnkgcmVkdWN0aW9uLCBidXQgdGhhdCdzIG9idmlvdXNseSB3cm9uZy4KICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogIC8vZ2xvYmFscwoKICAvLyBUaGUgbnVtYmVyIG9mIHNpZ25pZmljYW50IGJpdHMgaW4gdGhlIGZyYWN0aW9uIG9mIGEgSmF2YVNjcmlwdAogIC8vIGZsb2F0aW5nLXBvaW50IG51bWJlciBpcyA1MiwgaW5kZXBlbmRlbnQgb2YgcGxhdGZvcm0uCiAgLy8gU2VlOiBodHRwczovL2dpdGh1Yi5jb20vYXJsb2xyYS9vdHIvaXNzdWVzLzQxCgogIHZhciBicGUgPSAyNjsgICAgICAgICAgLy8gYml0cyBzdG9yZWQgcGVyIGFycmF5IGVsZW1lbnQKICB2YXIgcmFkaXggPSAxIDw8IGJwZTsgIC8vIGVxdWFscyAyXmJwZQogIHZhciBtYXNrID0gcmFkaXggLSAxOyAgLy8gQU5EIHRoaXMgd2l0aCBhbiBhcnJheSBlbGVtZW50IHRvIGNob3AgaXQgZG93biB0byBicGUgYml0cwoKICAvL3RoZSBkaWdpdHMgZm9yIGNvbnZlcnRpbmcgdG8gZGlmZmVyZW50IGJhc2VzCiAgdmFyIGRpZ2l0c1N0cj0nMDEyMzQ1Njc4OUFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXpfPSFAIyQlXiYqKClbXXt9fDs6LC48Pi8/YH4gXFxcJ1wiKy0nOwoKICB2YXIgb25lPWludDJiaWdJbnQoMSwxLDEpOyAgICAgLy9jb25zdGFudCB1c2VkIGluIHBvd01vZF8oKQoKICAvL3RoZSBmb2xsb3dpbmcgZ2xvYmFsIHZhcmlhYmxlcyBhcmUgc2NyYXRjaHBhZCBtZW1vcnkgdG8gCiAgLy9yZWR1Y2UgZHluYW1pYyBtZW1vcnkgYWxsb2NhdGlvbiBpbiB0aGUgaW5uZXIgbG9vcAogIHZhciB0PW5ldyBBcnJheSgwKTsKICB2YXIgc3M9dDsgICAgICAgLy91c2VkIGluIG11bHRfKCkKICB2YXIgczA9dDsgICAgICAgLy91c2VkIGluIG11bHRNb2RfKCksIHNxdWFyZU1vZF8oKQogIHZhciBzMT10OyAgICAgICAvL3VzZWQgaW4gcG93TW9kXygpLCBtdWx0TW9kXygpLCBzcXVhcmVNb2RfKCkKICB2YXIgczI9dDsgICAgICAgLy91c2VkIGluIHBvd01vZF8oKSwgbXVsdE1vZF8oKQogIHZhciBzMz10OyAgICAgICAvL3VzZWQgaW4gcG93TW9kXygpCiAgdmFyIHM0PXQsIHM1PXQ7IC8vdXNlZCBpbiBtb2RfKCkKICB2YXIgczY9dDsgICAgICAgLy91c2VkIGluIGJpZ0ludDJzdHIoKQogIHZhciBzNz10OyAgICAgICAvL3VzZWQgaW4gcG93TW9kXygpCiAgdmFyIFQ9dDsgICAgICAgIC8vdXNlZCBpbiBHQ0RfKCkKICB2YXIgc2E9dDsgICAgICAgLy91c2VkIGluIG1vbnRfKCkKICB2YXIgbXJfeDE9dCwgbXJfcj10LCBtcl9hPXQ7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3VzZWQgaW4gbWlsbGVyUmFiaW4oKQogIHZhciBlZ192PXQsIGVnX3U9dCwgZWdfQT10LCBlZ19CPXQsIGVnX0M9dCwgZWdfRD10OyAgICAgICAgICAgICAgIC8vdXNlZCBpbiBlR0NEXygpLCBpbnZlcnNlTW9kXygpCiAgdmFyIG1kX3ExPXQsIG1kX3EyPXQsIG1kX3EzPXQsIG1kX3I9dCwgbWRfcjE9dCwgbWRfcjI9dCwgbWRfdHQ9dDsgLy91c2VkIGluIG1vZF8oKQoKICB2YXIgcHJpbWVzPXQsIHBvd3M9dCwgc19pPXQsIHNfaTI9dCwgc19SPXQsIHNfcm09dCwgc19xPXQsIHNfbjE9dDsKICB2YXIgc19hPXQsIHNfcjI9dCwgc19uPXQsIHNfYj10LCBzX2Q9dCwgc194MT10LCBzX3gyPXQsIHNfYWE9dDsgLy91c2VkIGluIHJhbmRUcnVlUHJpbWVfKCkKICAgIAogIHZhciBycHByYj10OyAvL3VzZWQgaW4gcmFuZFByb2JQcmltZVJvdW5kcygpICh3aGljaCBhbHNvIHVzZXMgInByaW1lcyIpCgogIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCgogIC8vcmV0dXJuIGFycmF5IG9mIGFsbCBwcmltZXMgbGVzcyB0aGFuIGludGVnZXIgbgogIGZ1bmN0aW9uIGZpbmRQcmltZXMobikgewogICAgdmFyIGkscyxwLGFuczsKICAgIHM9bmV3IEFycmF5KG4pOwogICAgZm9yIChpPTA7aTxuO2krKykKICAgICAgc1tpXT0wOwogICAgc1swXT0yOwogICAgcD0wOyAgICAvL2ZpcnN0IHAgZWxlbWVudHMgb2YgcyBhcmUgcHJpbWVzLCB0aGUgcmVzdCBhcmUgYSBzaWV2ZQogICAgZm9yKDtzW3BdPG47KSB7ICAgICAgICAgICAgICAgICAgLy9zW3BdIGlzIHRoZSBwdGggcHJpbWUKICAgICAgZm9yKGk9c1twXSpzW3BdOyBpPG47IGkrPXNbcF0pIC8vbWFyayBtdWx0aXBsZXMgb2Ygc1twXQogICAgICAgIHNbaV09MTsKICAgICAgcCsrOwogICAgICBzW3BdPXNbcC0xXSsxOwogICAgICBmb3IoOyBzW3BdPG4gJiYgc1tzW3BdXTsgc1twXSsrKTsgLy9maW5kIG5leHQgcHJpbWUgKHdoZXJlIHNbcF09PTApCiAgICB9CiAgICBhbnM9bmV3IEFycmF5KHApOwogICAgZm9yKGk9MDtpPHA7aSsrKQogICAgICBhbnNbaV09c1tpXTsKICAgIHJldHVybiBhbnM7CiAgfQoKCiAgLy9kb2VzIGEgc2luZ2xlIHJvdW5kIG9mIE1pbGxlci1SYWJpbiBiYXNlIGIgY29uc2lkZXIgeCB0byBiZSBhIHBvc3NpYmxlIHByaW1lPwogIC8veCBpcyBhIGJpZ0ludCwgYW5kIGIgaXMgYW4gaW50ZWdlciwgd2l0aCBiPHgKICBmdW5jdGlvbiBtaWxsZXJSYWJpbkludCh4LGIpIHsKICAgIGlmIChtcl94MS5sZW5ndGghPXgubGVuZ3RoKSB7CiAgICAgIG1yX3gxPWR1cCh4KTsKICAgICAgbXJfcj1kdXAoeCk7CiAgICAgIG1yX2E9ZHVwKHgpOwogICAgfQoKICAgIGNvcHlJbnRfKG1yX2EsYik7CiAgICByZXR1cm4gbWlsbGVyUmFiaW4oeCxtcl9hKTsKICB9CgogIC8vZG9lcyBhIHNpbmdsZSByb3VuZCBvZiBNaWxsZXItUmFiaW4gYmFzZSBiIGNvbnNpZGVyIHggdG8gYmUgYSBwb3NzaWJsZSBwcmltZT8KICAvL3ggYW5kIGIgYXJlIGJpZ0ludHMgd2l0aCBiPHgKICBmdW5jdGlvbiBtaWxsZXJSYWJpbih4LGIpIHsKICAgIHZhciBpLGosayxzOwoKICAgIGlmIChtcl94MS5sZW5ndGghPXgubGVuZ3RoKSB7CiAgICAgIG1yX3gxPWR1cCh4KTsKICAgICAgbXJfcj1kdXAoeCk7CiAgICAgIG1yX2E9ZHVwKHgpOwogICAgfQoKICAgIGNvcHlfKG1yX2EsYik7CiAgICBjb3B5Xyhtcl9yLHgpOwogICAgY29weV8obXJfeDEseCk7CgogICAgYWRkSW50Xyhtcl9yLC0xKTsKICAgIGFkZEludF8obXJfeDEsLTEpOwoKICAgIC8vcz10aGUgaGlnaGVzdCBwb3dlciBvZiB0d28gdGhhdCBkaXZpZGVzIG1yX3IKCiAgICAvKgogICAgaz0wOwogICAgZm9yIChpPTA7aTxtcl9yLmxlbmd0aDtpKyspCiAgICAgIGZvciAoaj0xO2o8bWFzaztqPDw9MSkKICAgICAgICBpZiAoeFtpXSAmIGopIHsKICAgICAgICAgIHM9KGs8bXJfci5sZW5ndGgrYnBlID8gayA6IDApOyAKICAgICAgICAgICBpPW1yX3IubGVuZ3RoOwogICAgICAgICAgIGo9bWFzazsKICAgICAgICB9IGVsc2UKICAgICAgICAgIGsrKzsKICAgICovCgogICAgLyogaHR0cDovL3d3dy5qYXZhc2NyaXB0ZXIubmV0L21hdGgvcHJpbWVzL21pbGxlcnJhYmluYnVnLWJpZ2ludDU0Lmh0bSAqLwogICAgaWYgKGlzWmVybyhtcl9yKSkgcmV0dXJuIDA7CiAgICBmb3IgKGs9MDsgbXJfcltrXT09MDsgaysrKTsKICAgIGZvciAoaT0xLGo9MjsgbXJfcltrXSVqPT0wOyBqKj0yLGkrKyApOwogICAgcyA9IGsqYnBlICsgaSAtIDE7CiAgICAvKiBlbmQgKi8KCiAgICBpZiAocykgICAgICAgICAgICAgICAgCiAgICAgIHJpZ2h0U2hpZnRfKG1yX3Iscyk7CgogICAgcG93TW9kXyhtcl9hLG1yX3IseCk7CgogICAgaWYgKCFlcXVhbHNJbnQobXJfYSwxKSAmJiAhZXF1YWxzKG1yX2EsbXJfeDEpKSB7CiAgICAgIGo9MTsKICAgICAgd2hpbGUgKGo8PXMtMSAmJiAhZXF1YWxzKG1yX2EsbXJfeDEpKSB7CiAgICAgICAgc3F1YXJlTW9kXyhtcl9hLHgpOwogICAgICAgIGlmIChlcXVhbHNJbnQobXJfYSwxKSkgewogICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIGorKzsKICAgICAgfQogICAgICBpZiAoIWVxdWFscyhtcl9hLG1yX3gxKSkgewogICAgICAgIHJldHVybiAwOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gMTsgIAogIH0KCiAgLy9yZXR1cm5zIGhvdyBtYW55IGJpdHMgbG9uZyB0aGUgYmlnSW50IGlzLCBub3QgY291bnRpbmcgbGVhZGluZyB6ZXJvcy4KICBmdW5jdGlvbiBiaXRTaXplKHgpIHsKICAgIHZhciBqLHosdzsKICAgIGZvciAoaj14Lmxlbmd0aC0xOyAoeFtqXT09MCkgJiYgKGo+MCk7IGotLSk7CiAgICBmb3IgKHo9MCx3PXhbal07IHc7ICh3Pj49MSkseisrKTsKICAgIHorPWJwZSpqOwogICAgcmV0dXJuIHo7CiAgfQoKICAvL3JldHVybiBhIGNvcHkgb2YgeCB3aXRoIGF0IGxlYXN0IG4gZWxlbWVudHMsIGFkZGluZyBsZWFkaW5nIHplcm9zIGlmIG5lZWRlZAogIGZ1bmN0aW9uIGV4cGFuZCh4LG4pIHsKICAgIHZhciBhbnM9aW50MmJpZ0ludCgwLCh4Lmxlbmd0aD5uID8geC5sZW5ndGggOiBuKSpicGUsMCk7CiAgICBjb3B5XyhhbnMseCk7CiAgICByZXR1cm4gYW5zOwogIH0KCiAgLy9yZXR1cm4gYSBrLWJpdCB0cnVlIHJhbmRvbSBwcmltZSB1c2luZyBNYXVyZXIncyBhbGdvcml0aG0uCiAgZnVuY3Rpb24gcmFuZFRydWVQcmltZShrKSB7CiAgICB2YXIgYW5zPWludDJiaWdJbnQoMCxrLDApOwogICAgcmFuZFRydWVQcmltZV8oYW5zLGspOwogICAgcmV0dXJuIHRyaW0oYW5zLDEpOwogIH0KCiAgLy9yZXR1cm4gYSBrLWJpdCByYW5kb20gcHJvYmFibGUgcHJpbWUgd2l0aCBwcm9iYWJpbGl0eSBvZiBlcnJvciA8IDJeLTgwCiAgZnVuY3Rpb24gcmFuZFByb2JQcmltZShrKSB7CiAgICBpZiAoaz49NjAwKSByZXR1cm4gcmFuZFByb2JQcmltZVJvdW5kcyhrLDIpOyAvL251bWJlcnMgZnJvbSBIQUMgdGFibGUgNC4zCiAgICBpZiAoaz49NTUwKSByZXR1cm4gcmFuZFByb2JQcmltZVJvdW5kcyhrLDQpOwogICAgaWYgKGs+PTUwMCkgcmV0dXJuIHJhbmRQcm9iUHJpbWVSb3VuZHMoayw1KTsKICAgIGlmIChrPj00MDApIHJldHVybiByYW5kUHJvYlByaW1lUm91bmRzKGssNik7CiAgICBpZiAoaz49MzUwKSByZXR1cm4gcmFuZFByb2JQcmltZVJvdW5kcyhrLDcpOwogICAgaWYgKGs+PTMwMCkgcmV0dXJuIHJhbmRQcm9iUHJpbWVSb3VuZHMoayw5KTsKICAgIGlmIChrPj0yNTApIHJldHVybiByYW5kUHJvYlByaW1lUm91bmRzKGssMTIpOyAvL251bWJlcnMgZnJvbSBIQUMgdGFibGUgNC40CiAgICBpZiAoaz49MjAwKSByZXR1cm4gcmFuZFByb2JQcmltZVJvdW5kcyhrLDE1KTsKICAgIGlmIChrPj0xNTApIHJldHVybiByYW5kUHJvYlByaW1lUm91bmRzKGssMTgpOwogICAgaWYgKGs+PTEwMCkgcmV0dXJuIHJhbmRQcm9iUHJpbWVSb3VuZHMoaywyNyk7CiAgICAgICAgICAgICAgICByZXR1cm4gcmFuZFByb2JQcmltZVJvdW5kcyhrLDQwKTsgLy9udW1iZXIgZnJvbSBIQUMgcmVtYXJrIDQuMjYgKG9ubHkgYW4gZXN0aW1hdGUpCiAgfQoKICAvL3JldHVybiBhIGstYml0IHByb2JhYmxlIHJhbmRvbSBwcmltZSB1c2luZyBuIHJvdW5kcyBvZiBNaWxsZXIgUmFiaW4gKGFmdGVyIHRyaWFsIGRpdmlzaW9uIHdpdGggc21hbGwgcHJpbWVzKQogIGZ1bmN0aW9uIHJhbmRQcm9iUHJpbWVSb3VuZHMoayxuKSB7CiAgICB2YXIgYW5zLCBpLCBkaXZpc2libGUsIEI7IAogICAgQj0zMDAwMDsgIC8vQiBpcyBsYXJnZXN0IHByaW1lIHRvIHVzZSBpbiB0cmlhbCBkaXZpc2lvbgogICAgYW5zPWludDJiaWdJbnQoMCxrLDApOwogICAgCiAgICAvL29wdGltaXphdGlvbjogdHJ5IGxhcmdlciBhbmQgc21hbGxlciBCIHRvIGZpbmQgdGhlIGJlc3QgbGltaXQuCiAgICAKICAgIGlmIChwcmltZXMubGVuZ3RoPT0wKQogICAgICBwcmltZXM9ZmluZFByaW1lcygzMDAwMCk7ICAvL2NoZWNrIGZvciBkaXZpc2liaWxpdHkgYnkgcHJpbWVzIDw9MzAwMDAKCiAgICBpZiAocnBwcmIubGVuZ3RoIT1hbnMubGVuZ3RoKQogICAgICBycHByYj1kdXAoYW5zKTsKCiAgICBmb3IgKDs7KSB7IC8va2VlcCB0cnlpbmcgcmFuZG9tIHZhbHVlcyBmb3IgYW5zIHVudGlsIG9uZSBhcHBlYXJzIHRvIGJlIHByaW1lCiAgICAgIC8vb3B0aW1pemF0aW9uOiBwaWNrIGEgcmFuZG9tIG51bWJlciB0aW1lcyBMPTIqMyo1Ki4uLipwLCBwbHVzIGEgCiAgICAgIC8vICAgcmFuZG9tIGVsZW1lbnQgb2YgdGhlIGxpc3Qgb2YgYWxsIG51bWJlcnMgaW4gWzAsTCkgbm90IGRpdmlzaWJsZSBieSBhbnkgcHJpbWUgdXAgdG8gcC4KICAgICAgLy8gICBUaGlzIGNhbiByZWR1Y2UgdGhlIGFtb3VudCBvZiByYW5kb20gbnVtYmVyIGdlbmVyYXRpb24uCiAgICAgIAogICAgICByYW5kQmlnSW50XyhhbnMsaywwKTsgLy9hbnMgPSBhIHJhbmRvbSBvZGQgbnVtYmVyIHRvIGNoZWNrCiAgICAgIGFuc1swXSB8PSAxOyAKICAgICAgZGl2aXNpYmxlPTA7CiAgICAKICAgICAgLy9jaGVjayBhbnMgZm9yIGRpdmlzaWJpbGl0eSBieSBzbWFsbCBwcmltZXMgdXAgdG8gQgogICAgICBmb3IgKGk9MDsgKGk8cHJpbWVzLmxlbmd0aCkgJiYgKHByaW1lc1tpXTw9Qik7IGkrKykKICAgICAgICBpZiAobW9kSW50KGFucyxwcmltZXNbaV0pPT0wICYmICFlcXVhbHNJbnQoYW5zLHByaW1lc1tpXSkpIHsKICAgICAgICAgIGRpdmlzaWJsZT0xOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfSAgICAgIAogICAgICAKICAgICAgLy9vcHRpbWl6YXRpb246IGNoYW5nZSBtaWxsZXJSYWJpbiBzbyB0aGUgYmFzZSBjYW4gYmUgYmlnZ2VyIHRoYW4gdGhlIG51bWJlciBiZWluZyBjaGVja2VkLCB0aGVuIGVsaW1pbmF0ZSB0aGUgd2hpbGUgaGVyZS4KICAgICAgCiAgICAgIC8vZG8gbiByb3VuZHMgb2YgTWlsbGVyIFJhYmluLCB3aXRoIHJhbmRvbSBiYXNlcyBsZXNzIHRoYW4gYW5zCiAgICAgIGZvciAoaT0wOyBpPG4gJiYgIWRpdmlzaWJsZTsgaSsrKSB7CiAgICAgICAgcmFuZEJpZ0ludF8ocnBwcmIsaywwKTsKICAgICAgICB3aGlsZSghZ3JlYXRlcihhbnMscnBwcmIpKSAvL3BpY2sgYSByYW5kb20gcnBwcmIgdGhhdCdzIDwgYW5zCiAgICAgICAgICByYW5kQmlnSW50XyhycHByYixrLDApOwogICAgICAgIGlmICghbWlsbGVyUmFiaW4oYW5zLHJwcHJiKSkKICAgICAgICAgIGRpdmlzaWJsZT0xOwogICAgICB9CiAgICAgIAogICAgICBpZighZGl2aXNpYmxlKQogICAgICAgIHJldHVybiBhbnM7CiAgICB9ICAKICB9CgogIC8vcmV0dXJuIGEgbmV3IGJpZ0ludCBlcXVhbCB0byAoeCBtb2QgbikgZm9yIGJpZ0ludHMgeCBhbmQgbi4KICBmdW5jdGlvbiBtb2QoeCxuKSB7CiAgICB2YXIgYW5zPWR1cCh4KTsKICAgIG1vZF8oYW5zLG4pOwogICAgcmV0dXJuIHRyaW0oYW5zLDEpOwogIH0KCiAgLy9yZXR1cm4gKHgrbikgd2hlcmUgeCBpcyBhIGJpZ0ludCBhbmQgbiBpcyBhbiBpbnRlZ2VyLgogIGZ1bmN0aW9uIGFkZEludCh4LG4pIHsKICAgIHZhciBhbnM9ZXhwYW5kKHgseC5sZW5ndGgrMSk7CiAgICBhZGRJbnRfKGFucyxuKTsKICAgIHJldHVybiB0cmltKGFucywxKTsKICB9CgogIC8vcmV0dXJuIHgqeSBmb3IgYmlnSW50cyB4IGFuZCB5LiBUaGlzIGlzIGZhc3RlciB3aGVuIHk8eC4KICBmdW5jdGlvbiBtdWx0KHgseSkgewogICAgdmFyIGFucz1leHBhbmQoeCx4Lmxlbmd0aCt5Lmxlbmd0aCk7CiAgICBtdWx0XyhhbnMseSk7CiAgICByZXR1cm4gdHJpbShhbnMsMSk7CiAgfQoKICAvL3JldHVybiAoeCoqeSBtb2Qgbikgd2hlcmUgeCx5LG4gYXJlIGJpZ0ludHMgYW5kICoqIGlzIGV4cG9uZW50aWF0aW9uLiAgMCoqMD0xLiBGYXN0ZXIgZm9yIG9kZCBuLgogIGZ1bmN0aW9uIHBvd01vZCh4LHksbikgewogICAgdmFyIGFucz1leHBhbmQoeCxuLmxlbmd0aCk7ICAKICAgIHBvd01vZF8oYW5zLHRyaW0oeSwyKSx0cmltKG4sMiksMCk7ICAvL3RoaXMgc2hvdWxkIHdvcmsgd2l0aG91dCB0aGUgdHJpbSwgYnV0IGRvZXNuJ3QKICAgIHJldHVybiB0cmltKGFucywxKTsKICB9CgogIC8vcmV0dXJuICh4LXkpIGZvciBiaWdJbnRzIHggYW5kIHkuICBOZWdhdGl2ZSBhbnN3ZXJzIHdpbGwgYmUgMnMgY29tcGxlbWVudAogIGZ1bmN0aW9uIHN1Yih4LHkpIHsKICAgIHZhciBhbnM9ZXhwYW5kKHgsKHgubGVuZ3RoPnkubGVuZ3RoID8geC5sZW5ndGgrMSA6IHkubGVuZ3RoKzEpKTsgCiAgICBzdWJfKGFucyx5KTsKICAgIHJldHVybiB0cmltKGFucywxKTsKICB9CgogIC8vcmV0dXJuICh4K3kpIGZvciBiaWdJbnRzIHggYW5kIHkuICAKICBmdW5jdGlvbiBhZGQoeCx5KSB7CiAgICB2YXIgYW5zPWV4cGFuZCh4LCh4Lmxlbmd0aD55Lmxlbmd0aCA/IHgubGVuZ3RoKzEgOiB5Lmxlbmd0aCsxKSk7IAogICAgYWRkXyhhbnMseSk7CiAgICByZXR1cm4gdHJpbShhbnMsMSk7CiAgfQoKICAvL3JldHVybiAoeCoqKC0xKSBtb2QgbikgZm9yIGJpZ0ludHMgeCBhbmQgbi4gIElmIG5vIGludmVyc2UgZXhpc3RzLCBpdCByZXR1cm5zIG51bGwKICBmdW5jdGlvbiBpbnZlcnNlTW9kKHgsbikgewogICAgdmFyIGFucz1leHBhbmQoeCxuLmxlbmd0aCk7IAogICAgdmFyIHM7CiAgICBzPWludmVyc2VNb2RfKGFucyxuKTsKICAgIHJldHVybiBzID8gdHJpbShhbnMsMSkgOiBudWxsOwogIH0KCiAgLy9yZXR1cm4gKHgqeSBtb2QgbikgZm9yIGJpZ0ludHMgeCx5LG4uICBGb3IgZ3JlYXRlciBzcGVlZCwgbGV0IHk8eC4KICBmdW5jdGlvbiBtdWx0TW9kKHgseSxuKSB7CiAgICB2YXIgYW5zPWV4cGFuZCh4LG4ubGVuZ3RoKTsKICAgIG11bHRNb2RfKGFucyx5LG4pOwogICAgcmV0dXJuIHRyaW0oYW5zLDEpOwogIH0KCiAgLy9nZW5lcmF0ZSBhIGstYml0IHRydWUgcmFuZG9tIHByaW1lIHVzaW5nIE1hdXJlcidzIGFsZ29yaXRobSwKICAvL2FuZCBwdXQgaXQgaW50byBhbnMuICBUaGUgYmlnSW50IGFucyBtdXN0IGJlIGxhcmdlIGVub3VnaCB0byBob2xkIGl0LgogIGZ1bmN0aW9uIHJhbmRUcnVlUHJpbWVfKGFucyxrKSB7CiAgICB2YXIgYyx3LG0scG0sZGQsaixyLEIsZGl2aXNpYmxlLHosenoscmVjU2l6ZSxyZWNMaW1pdDsKCiAgICBpZiAocHJpbWVzLmxlbmd0aD09MCkKICAgICAgcHJpbWVzPWZpbmRQcmltZXMoMzAwMDApOyAgLy9jaGVjayBmb3IgZGl2aXNpYmlsaXR5IGJ5IHByaW1lcyA8PTMwMDAwCgogICAgaWYgKHBvd3MubGVuZ3RoPT0wKSB7CiAgICAgIHBvd3M9bmV3IEFycmF5KDUxMik7CiAgICAgIGZvciAoaj0wO2o8NTEyO2orKykgewogICAgICAgIHBvd3Nbal09TWF0aC5wb3coMixqLzUxMS4wLTEuMCk7CiAgICAgIH0KICAgIH0KCiAgICAvL2MgYW5kIG0gc2hvdWxkIGJlIHR1bmVkIGZvciBhIHBhcnRpY3VsYXIgbWFjaGluZSBhbmQgdmFsdWUgb2YgaywgdG8gbWF4aW1pemUgc3BlZWQKICAgIGM9MC4xOyAgLy9jPTAuMSBpbiBIQUMKICAgIG09MjA7ICAgLy9nZW5lcmF0ZSB0aGlzIGstYml0IG51bWJlciBieSBmaXJzdCByZWN1cnNpdmVseSBnZW5lcmF0aW5nIGEgbnVtYmVyIHRoYXQgaGFzIGJldHdlZW4gay8yIGFuZCBrLW0gYml0cwogICAgcmVjTGltaXQ9MjA7IC8vc3RvcCByZWN1cnNpb24gd2hlbiBrIDw9cmVjTGltaXQuICBNdXN0IGhhdmUgcmVjTGltaXQgPj0gMgoKICAgIGlmIChzX2kyLmxlbmd0aCE9YW5zLmxlbmd0aCkgewogICAgICBzX2kyPWR1cChhbnMpOwogICAgICBzX1IgPWR1cChhbnMpOwogICAgICBzX24xPWR1cChhbnMpOwogICAgICBzX3IyPWR1cChhbnMpOwogICAgICBzX2QgPWR1cChhbnMpOwogICAgICBzX3gxPWR1cChhbnMpOwogICAgICBzX3gyPWR1cChhbnMpOwogICAgICBzX2IgPWR1cChhbnMpOwogICAgICBzX24gPWR1cChhbnMpOwogICAgICBzX2kgPWR1cChhbnMpOwogICAgICBzX3JtPWR1cChhbnMpOwogICAgICBzX3EgPWR1cChhbnMpOwogICAgICBzX2EgPWR1cChhbnMpOwogICAgICBzX2FhPWR1cChhbnMpOwogICAgfQoKICAgIGlmIChrIDw9IHJlY0xpbWl0KSB7ICAvL2dlbmVyYXRlIHNtYWxsIHJhbmRvbSBwcmltZXMgYnkgdHJpYWwgZGl2aXNpb24gdXAgdG8gaXRzIHNxdWFyZSByb290CiAgICAgIHBtPSgxPDwoKGsrMik+PjEpKS0xOyAvL3BtIGlzIGJpbmFyeSBudW1iZXIgd2l0aCBhbGwgb25lcywganVzdCBvdmVyIHNxcnQoMl5rKQogICAgICBjb3B5SW50XyhhbnMsMCk7CiAgICAgIGZvciAoZGQ9MTtkZDspIHsKICAgICAgICBkZD0wOwogICAgICAgIGFuc1swXT0gMSB8ICgxPDwoay0xKSkgfCByYW5kb21CaXRJbnQoayk7ICAvL3JhbmRvbSwgay1iaXQsIG9kZCBpbnRlZ2VyLCB3aXRoIG1zYiAxCiAgICAgICAgZm9yIChqPTE7KGo8cHJpbWVzLmxlbmd0aCkgJiYgKChwcmltZXNbal0mcG0pPT1wcmltZXNbal0pO2orKykgeyAvL3RyaWFsIGRpdmlzaW9uIGJ5IGFsbCBwcmltZXMgMy4uLnNxcnQoMl5rKQogICAgICAgICAgaWYgKDA9PShhbnNbMF0lcHJpbWVzW2pdKSkgewogICAgICAgICAgICBkZD0xOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgY2FycnlfKGFucyk7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBCPWMqayprOyAgICAvL3RyeSBzbWFsbCBwcmltZXMgdXAgdG8gQiAob3IgYWxsIHRoZSBwcmltZXNbXSBhcnJheSBpZiB0aGUgbGFyZ2VzdCBpcyBsZXNzIHRoYW4gQikuCiAgICBpZiAoaz4yKm0pICAvL2dlbmVyYXRlIHRoaXMgay1iaXQgbnVtYmVyIGJ5IGZpcnN0IHJlY3Vyc2l2ZWx5IGdlbmVyYXRpbmcgYSBudW1iZXIgdGhhdCBoYXMgYmV0d2VlbiBrLzIgYW5kIGstbSBiaXRzCiAgICAgIGZvciAocj0xOyBrLWsqcjw9bTsgKQogICAgICAgIHI9cG93c1tyYW5kb21CaXRJbnQoOSldOyAgIC8vcj1NYXRoLnBvdygyLE1hdGgucmFuZG9tKCktMSk7CiAgICBlbHNlCiAgICAgIHI9MC41OwoKICAgIC8vc2ltdWxhdGlvbiBzdWdnZXN0cyB0aGUgbW9yZSBjb21wbGV4IGFsZ29yaXRobSB1c2luZyByPS4zMzMgaXMgb25seSBzbGlnaHRseSBmYXN0ZXIuCgogICAgcmVjU2l6ZT1NYXRoLmZsb29yKHIqaykrMTsKCiAgICByYW5kVHJ1ZVByaW1lXyhzX3EscmVjU2l6ZSk7CiAgICBjb3B5SW50XyhzX2kyLDApOwogICAgc19pMltNYXRoLmZsb29yKChrLTIpL2JwZSldIHw9ICgxPDwoKGstMiklYnBlKSk7ICAgLy9zX2kyPTJeKGstMikKICAgIGRpdmlkZV8oc19pMixzX3Esc19pLHNfcm0pOyAgICAgICAgICAgICAgICAgICAgICAgIC8vc19pPWZsb29yKCgyXihrLTEpKS8oMnEpKQoKICAgIHo9Yml0U2l6ZShzX2kpOwoKICAgIGZvciAoOzspIHsKICAgICAgZm9yICg7OykgeyAgLy9nZW5lcmF0ZSB6LWJpdCBudW1iZXJzIHVudGlsIG9uZSBmYWxscyBpbiB0aGUgcmFuZ2UgWzAsc19pLTFdCiAgICAgICAgcmFuZEJpZ0ludF8oc19SLHosMCk7CiAgICAgICAgaWYgKGdyZWF0ZXIoc19pLHNfUikpCiAgICAgICAgICBicmVhazsKICAgICAgfSAgICAgICAgICAgICAgICAvL25vdyBzX1IgaXMgaW4gdGhlIHJhbmdlIFswLHNfaS0xXQogICAgICBhZGRJbnRfKHNfUiwxKTsgIC8vbm93IHNfUiBpcyBpbiB0aGUgcmFuZ2UgWzEsc19pXQogICAgICBhZGRfKHNfUixzX2kpOyAgIC8vbm93IHNfUiBpcyBpbiB0aGUgcmFuZ2UgW3NfaSsxLDIqc19pXQoKICAgICAgY29weV8oc19uLHNfcSk7CiAgICAgIG11bHRfKHNfbixzX1IpOyAKICAgICAgbXVsdEludF8oc19uLDIpOwogICAgICBhZGRJbnRfKHNfbiwxKTsgICAgLy9zX249MipzX1Iqc19xKzEKICAgICAgCiAgICAgIGNvcHlfKHNfcjIsc19SKTsKICAgICAgbXVsdEludF8oc19yMiwyKTsgIC8vc19yMj0yKnNfUgoKICAgICAgLy9jaGVjayBzX24gZm9yIGRpdmlzaWJpbGl0eSBieSBzbWFsbCBwcmltZXMgdXAgdG8gQgogICAgICBmb3IgKGRpdmlzaWJsZT0wLGo9MDsgKGo8cHJpbWVzLmxlbmd0aCkgJiYgKHByaW1lc1tqXTxCKTsgaisrKQogICAgICAgIGlmIChtb2RJbnQoc19uLHByaW1lc1tqXSk9PTAgJiYgIWVxdWFsc0ludChzX24scHJpbWVzW2pdKSkgewogICAgICAgICAgZGl2aXNpYmxlPTE7CiAgICAgICAgICBicmVhazsKICAgICAgICB9ICAgICAgCgogICAgICBpZiAoIWRpdmlzaWJsZSkgICAgLy9pZiBpdCBwYXNzZXMgc21hbGwgcHJpbWVzIGNoZWNrLCB0aGVuIHRyeSBhIHNpbmdsZSBNaWxsZXItUmFiaW4gYmFzZSAyCiAgICAgICAgaWYgKCFtaWxsZXJSYWJpbkludChzX24sMikpIC8vdGhpcyBsaW5lIHJlcHJlc2VudHMgNzUlIG9mIHRoZSB0b3RhbCBydW50aW1lIGZvciByYW5kVHJ1ZVByaW1lXyAKICAgICAgICAgIGRpdmlzaWJsZT0xOwoKICAgICAgaWYgKCFkaXZpc2libGUpIHsgIC8vaWYgaXQgcGFzc2VzIHRoYXQgdGVzdCwgY29udGludWUgY2hlY2tpbmcgc19uCiAgICAgICAgYWRkSW50XyhzX24sLTMpOwogICAgICAgIGZvciAoaj1zX24ubGVuZ3RoLTE7KHNfbltqXT09MCkgJiYgKGo+MCk7IGotLSk7ICAvL3N0cmlwIGxlYWRpbmcgemVyb3MKICAgICAgICBmb3IgKHp6PTAsdz1zX25bal07IHc7ICh3Pj49MSksenorKyk7CiAgICAgICAgenorPWJwZSpqOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy96ej1udW1iZXIgb2YgYml0cyBpbiBzX24sIGlnbm9yaW5nIGxlYWRpbmcgemVyb3MKICAgICAgICBmb3IgKDs7KSB7ICAvL2dlbmVyYXRlIHotYml0IG51bWJlcnMgdW50aWwgb25lIGZhbGxzIGluIHRoZSByYW5nZSBbMCxzX24tMV0KICAgICAgICAgIHJhbmRCaWdJbnRfKHNfYSx6eiwwKTsKICAgICAgICAgIGlmIChncmVhdGVyKHNfbixzX2EpKQogICAgICAgICAgICBicmVhazsKICAgICAgICB9ICAgICAgICAgICAgICAgIC8vbm93IHNfYSBpcyBpbiB0aGUgcmFuZ2UgWzAsc19uLTFdCiAgICAgICAgYWRkSW50XyhzX24sMyk7ICAvL25vdyBzX2EgaXMgaW4gdGhlIHJhbmdlIFswLHNfbi00XQogICAgICAgIGFkZEludF8oc19hLDIpOyAgLy9ub3cgc19hIGlzIGluIHRoZSByYW5nZSBbMixzX24tMl0KICAgICAgICBjb3B5XyhzX2Isc19hKTsKICAgICAgICBjb3B5XyhzX24xLHNfbik7CiAgICAgICAgYWRkSW50XyhzX24xLC0xKTsKICAgICAgICBwb3dNb2RfKHNfYixzX24xLHNfbik7ICAgLy9zX2I9c19hXihzX24tMSkgbW9kdWxvIHNfbgogICAgICAgIGFkZEludF8oc19iLC0xKTsKICAgICAgICBpZiAoaXNaZXJvKHNfYikpIHsKICAgICAgICAgIGNvcHlfKHNfYixzX2EpOwogICAgICAgICAgcG93TW9kXyhzX2Isc19yMixzX24pOwogICAgICAgICAgYWRkSW50XyhzX2IsLTEpOwogICAgICAgICAgY29weV8oc19hYSxzX24pOwogICAgICAgICAgY29weV8oc19kLHNfYik7CiAgICAgICAgICBHQ0RfKHNfZCxzX24pOyAgLy9pZiBzX2IgYW5kIHNfbiBhcmUgcmVsYXRpdmVseSBwcmltZSwgdGhlbiBzX24gaXMgYSBwcmltZQogICAgICAgICAgaWYgKGVxdWFsc0ludChzX2QsMSkpIHsKICAgICAgICAgICAgY29weV8oYW5zLHNfYWEpOwogICAgICAgICAgICByZXR1cm47ICAgICAvL2lmIHdlJ3ZlIG1hZGUgaXQgdGhpcyBmYXIsIHRoZW4gc19uIGlzIGFic29sdXRlbHkgZ3VhcmFudGVlZCB0byBiZSBwcmltZQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KCiAgLy9SZXR1cm4gYW4gbi1iaXQgcmFuZG9tIEJpZ0ludCAobj49MSkuICBJZiBzPTEsIHRoZW4gdGhlIG1vc3Qgc2lnbmlmaWNhbnQgb2YgdGhvc2UgbiBiaXRzIGlzIHNldCB0byAxLgogIGZ1bmN0aW9uIHJhbmRCaWdJbnQobixzKSB7CiAgICB2YXIgYSxiOwogICAgYT1NYXRoLmZsb29yKChuLTEpL2JwZSkrMjsgLy8jIGFycmF5IGVsZW1lbnRzIHRvIGhvbGQgdGhlIEJpZ0ludCB3aXRoIGEgbGVhZGluZyAwIGVsZW1lbnQKICAgIGI9aW50MmJpZ0ludCgwLDAsYSk7CiAgICByYW5kQmlnSW50XyhiLG4scyk7CiAgICByZXR1cm4gYjsKICB9CgogIC8vU2V0IGIgdG8gYW4gbi1iaXQgcmFuZG9tIEJpZ0ludC4gIElmIHM9MSwgdGhlbiB0aGUgbW9zdCBzaWduaWZpY2FudCBvZiB0aG9zZSBuIGJpdHMgaXMgc2V0IHRvIDEuCiAgLy9BcnJheSBiIG11c3QgYmUgYmlnIGVub3VnaCB0byBob2xkIHRoZSByZXN1bHQuIE11c3QgaGF2ZSBuPj0xCiAgZnVuY3Rpb24gcmFuZEJpZ0ludF8oYixuLHMpIHsKICAgIHZhciBpLGE7CiAgICBmb3IgKGk9MDtpPGIubGVuZ3RoO2krKykKICAgICAgYltpXT0wOwogICAgYT1NYXRoLmZsb29yKChuLTEpL2JwZSkrMTsgLy8jIGFycmF5IGVsZW1lbnRzIHRvIGhvbGQgdGhlIEJpZ0ludAogICAgZm9yIChpPTA7aTxhO2krKykgewogICAgICBiW2ldPXJhbmRvbUJpdEludChicGUpOwogICAgfQogICAgYlthLTFdICY9ICgyPDwoKG4tMSklYnBlKSktMTsKICAgIGlmIChzPT0xKQogICAgICBiW2EtMV0gfD0gKDE8PCgobi0xKSVicGUpKTsKICB9CgogIC8vUmV0dXJuIHRoZSBncmVhdGVzdCBjb21tb24gZGl2aXNvciBvZiBiaWdJbnRzIHggYW5kIHkgKGVhY2ggd2l0aCBzYW1lIG51bWJlciBvZiBlbGVtZW50cykuCiAgZnVuY3Rpb24gR0NEKHgseSkgewogICAgdmFyIHhjLHljOwogICAgeGM9ZHVwKHgpOwogICAgeWM9ZHVwKHkpOwogICAgR0NEXyh4Yyx5Yyk7CiAgICByZXR1cm4geGM7CiAgfQoKICAvL3NldCB4IHRvIHRoZSBncmVhdGVzdCBjb21tb24gZGl2aXNvciBvZiBiaWdJbnRzIHggYW5kIHkgKGVhY2ggd2l0aCBzYW1lIG51bWJlciBvZiBlbGVtZW50cykuCiAgLy95IGlzIGRlc3Ryb3llZC4KICBmdW5jdGlvbiBHQ0RfKHgseSkgewogICAgdmFyIGkseHAseXAsQSxCLEMsRCxxLHNpbmcscXA7CiAgICBpZiAoVC5sZW5ndGghPXgubGVuZ3RoKQogICAgICBUPWR1cCh4KTsKCiAgICBzaW5nPTE7CiAgICB3aGlsZSAoc2luZykgeyAvL3doaWxlIHkgaGFzIG5vbnplcm8gZWxlbWVudHMgb3RoZXIgdGhhbiB5WzBdCiAgICAgIHNpbmc9MDsKICAgICAgZm9yIChpPTE7aTx5Lmxlbmd0aDtpKyspIC8vY2hlY2sgaWYgeSBoYXMgbm9uemVybyBlbGVtZW50cyBvdGhlciB0aGFuIDAKICAgICAgICBpZiAoeVtpXSkgewogICAgICAgICAgc2luZz0xOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBpZiAoIXNpbmcpIGJyZWFrOyAvL3F1aXQgd2hlbiB5IGFsbCB6ZXJvIGVsZW1lbnRzIGV4Y2VwdCBwb3NzaWJseSB5WzBdCgogICAgICBmb3IgKGk9eC5sZW5ndGg7IXhbaV0gJiYgaT49MDtpLS0pOyAgLy9maW5kIG1vc3Qgc2lnbmlmaWNhbnQgZWxlbWVudCBvZiB4CiAgICAgIHhwPXhbaV07CiAgICAgIHlwPXlbaV07CiAgICAgIEE9MTsgQj0wOyBDPTA7IEQ9MTsKICAgICAgd2hpbGUgKCh5cCtDKSAmJiAoeXArRCkpIHsKICAgICAgICBxID1NYXRoLmZsb29yKCh4cCtBKS8oeXArQykpOwogICAgICAgIHFwPU1hdGguZmxvb3IoKHhwK0IpLyh5cCtEKSk7CiAgICAgICAgaWYgKHEhPXFwKQogICAgICAgICAgYnJlYWs7CiAgICAgICAgdD0gQS1xKkM7ICAgQT1DOyAgIEM9dDsgICAgLy8gIGRvIChBLEIseHAsIEMsRCx5cCkgPSAoQyxELHlwLCBBLEIseHApIC0gcSooMCwwLDAsIEMsRCx5cCkgICAgICAKICAgICAgICB0PSBCLXEqRDsgICBCPUQ7ICAgRD10OwogICAgICAgIHQ9eHAtcSp5cDsgeHA9eXA7IHlwPXQ7CiAgICAgIH0KICAgICAgaWYgKEIpIHsKICAgICAgICBjb3B5XyhULHgpOwogICAgICAgIGxpbkNvbWJfKHgseSxBLEIpOyAvL3g9QSp4K0IqeQogICAgICAgIGxpbkNvbWJfKHksVCxELEMpOyAvL3k9RCp5K0MqVAogICAgICB9IGVsc2UgewogICAgICAgIG1vZF8oeCx5KTsKICAgICAgICBjb3B5XyhULHgpOwogICAgICAgIGNvcHlfKHgseSk7CiAgICAgICAgY29weV8oeSxUKTsKICAgICAgfSAKICAgIH0KICAgIGlmICh5WzBdPT0wKQogICAgICByZXR1cm47CiAgICB0PW1vZEludCh4LHlbMF0pOwogICAgY29weUludF8oeCx5WzBdKTsKICAgIHlbMF09dDsKICAgIHdoaWxlICh5WzBdKSB7CiAgICAgIHhbMF0lPXlbMF07CiAgICAgIHQ9eFswXTsgeFswXT15WzBdOyB5WzBdPXQ7CiAgICB9CiAgfQoKICAvL2RvIHg9eCoqKC0xKSBtb2QgbiwgZm9yIGJpZ0ludHMgeCBhbmQgbi4KICAvL0lmIG5vIGludmVyc2UgZXhpc3RzLCBpdCBzZXRzIHggdG8gemVybyBhbmQgcmV0dXJucyAwLCBlbHNlIGl0IHJldHVybnMgMS4KICAvL1RoZSB4IGFycmF5IG11c3QgYmUgYXQgbGVhc3QgYXMgbGFyZ2UgYXMgdGhlIG4gYXJyYXkuCiAgZnVuY3Rpb24gaW52ZXJzZU1vZF8oeCxuKSB7CiAgICB2YXIgaz0xKzIqTWF0aC5tYXgoeC5sZW5ndGgsbi5sZW5ndGgpOwoKICAgIGlmKCEoeFswXSYxKSAgJiYgIShuWzBdJjEpKSB7ICAvL2lmIGJvdGggaW5wdXRzIGFyZSBldmVuLCB0aGVuIGludmVyc2UgZG9lc24ndCBleGlzdAogICAgICBjb3B5SW50Xyh4LDApOwogICAgICByZXR1cm4gMDsKICAgIH0KCiAgICBpZiAoZWdfdS5sZW5ndGghPWspIHsKICAgICAgZWdfdT1uZXcgQXJyYXkoayk7CiAgICAgIGVnX3Y9bmV3IEFycmF5KGspOwogICAgICBlZ19BPW5ldyBBcnJheShrKTsKICAgICAgZWdfQj1uZXcgQXJyYXkoayk7CiAgICAgIGVnX0M9bmV3IEFycmF5KGspOwogICAgICBlZ19EPW5ldyBBcnJheShrKTsKICAgIH0KCiAgICBjb3B5XyhlZ191LHgpOwogICAgY29weV8oZWdfdixuKTsKICAgIGNvcHlJbnRfKGVnX0EsMSk7CiAgICBjb3B5SW50XyhlZ19CLDApOwogICAgY29weUludF8oZWdfQywwKTsKICAgIGNvcHlJbnRfKGVnX0QsMSk7CiAgICBmb3IgKDs7KSB7CiAgICAgIHdoaWxlKCEoZWdfdVswXSYxKSkgeyAgLy93aGlsZSBlZ191IGlzIGV2ZW4KICAgICAgICBoYWx2ZV8oZWdfdSk7CiAgICAgICAgaWYgKCEoZWdfQVswXSYxKSAmJiAhKGVnX0JbMF0mMSkpIHsgLy9pZiBlZ19BPT1lZ19CPT0wIG1vZCAyCiAgICAgICAgICBoYWx2ZV8oZWdfQSk7CiAgICAgICAgICBoYWx2ZV8oZWdfQik7ICAgICAgCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGFkZF8oZWdfQSxuKTsgIGhhbHZlXyhlZ19BKTsKICAgICAgICAgIHN1Yl8oZWdfQix4KTsgIGhhbHZlXyhlZ19CKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHdoaWxlICghKGVnX3ZbMF0mMSkpIHsgIC8vd2hpbGUgZWdfdiBpcyBldmVuCiAgICAgICAgaGFsdmVfKGVnX3YpOwogICAgICAgIGlmICghKGVnX0NbMF0mMSkgJiYgIShlZ19EWzBdJjEpKSB7IC8vaWYgZWdfQz09ZWdfRD09MCBtb2QgMgogICAgICAgICAgaGFsdmVfKGVnX0MpOwogICAgICAgICAgaGFsdmVfKGVnX0QpOyAgICAgIAogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBhZGRfKGVnX0Msbik7ICBoYWx2ZV8oZWdfQyk7CiAgICAgICAgICBzdWJfKGVnX0QseCk7ICBoYWx2ZV8oZWdfRCk7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoIWdyZWF0ZXIoZWdfdixlZ191KSkgeyAvL2VnX3YgPD0gZWdfdQogICAgICAgIHN1Yl8oZWdfdSxlZ192KTsKICAgICAgICBzdWJfKGVnX0EsZWdfQyk7CiAgICAgICAgc3ViXyhlZ19CLGVnX0QpOwogICAgICB9IGVsc2UgeyAgICAgICAgICAgICAgICAgICAvL2VnX3YgPiBlZ191CiAgICAgICAgc3ViXyhlZ192LGVnX3UpOwogICAgICAgIHN1Yl8oZWdfQyxlZ19BKTsKICAgICAgICBzdWJfKGVnX0QsZWdfQik7CiAgICAgIH0KCiAgICAgIGlmIChlcXVhbHNJbnQoZWdfdSwwKSkgewogICAgICAgIHdoaWxlIChuZWdhdGl2ZShlZ19DKSkgLy9tYWtlIHN1cmUgYW5zd2VyIGlzIG5vbm5lZ2F0aXZlCiAgICAgICAgICBhZGRfKGVnX0Msbik7CiAgICAgICAgY29weV8oeCxlZ19DKTsKCiAgICAgICAgaWYgKCFlcXVhbHNJbnQoZWdfdiwxKSkgeyAvL2lmIEdDRF8oeCxuKSE9MSwgdGhlbiB0aGVyZSBpcyBubyBpbnZlcnNlCiAgICAgICAgICBjb3B5SW50Xyh4LDApOwogICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIHJldHVybiAxOwogICAgICB9CiAgICB9CiAgfQoKICAvL3JldHVybiB4KiooLTEpIG1vZCBuLCBmb3IgaW50ZWdlcnMgeCBhbmQgbi4gIFJldHVybiAwIGlmIHRoZXJlIGlzIG5vIGludmVyc2UKICBmdW5jdGlvbiBpbnZlcnNlTW9kSW50KHgsbikgewogICAgdmFyIGE9MSxiPTAsdDsKICAgIGZvciAoOzspIHsKICAgICAgaWYgKHg9PTEpIHJldHVybiBhOwogICAgICBpZiAoeD09MCkgcmV0dXJuIDA7CiAgICAgIGItPWEqTWF0aC5mbG9vcihuL3gpOwogICAgICBuJT14OwoKICAgICAgaWYgKG49PTEpIHJldHVybiBiOyAvL3RvIGF2b2lkIG5lZ2F0aXZlcywgY2hhbmdlIHRoaXMgYiB0byBuLWIsIGFuZCBlYWNoIC09IHRvICs9CiAgICAgIGlmIChuPT0wKSByZXR1cm4gMDsKICAgICAgYS09YipNYXRoLmZsb29yKHgvbik7CiAgICAgIHglPW47CiAgICB9CiAgfQoKICAvL3RoaXMgZGVwcmVjYXRlZCBmdW5jdGlvbiBpcyBmb3IgYmFja3dhcmQgY29tcGF0aWJpbGl0eSBvbmx5LiAKICBmdW5jdGlvbiBpbnZlcnNlTW9kSW50Xyh4LG4pIHsKICAgICByZXR1cm4gaW52ZXJzZU1vZEludCh4LG4pOwogIH0KCgogIC8vR2l2ZW4gcG9zaXRpdmUgYmlnSW50cyB4IGFuZCB5LCBjaGFuZ2UgdGhlIGJpZ2ludHMgdiwgYSwgYW5kIGIgdG8gcG9zaXRpdmUgYmlnSW50cyBzdWNoIHRoYXQ6CiAgLy8gICAgIHYgPSBHQ0RfKHgseSkgPSBhKngtYip5CiAgLy9UaGUgYmlnSW50cyB2LCBhLCBiLCBtdXN0IGhhdmUgZXhhY3RseSBhcyBtYW55IGVsZW1lbnRzIGFzIHRoZSBsYXJnZXIgb2YgeCBhbmQgeS4KICBmdW5jdGlvbiBlR0NEXyh4LHksdixhLGIpIHsKICAgIHZhciBnPTA7CiAgICB2YXIgaz1NYXRoLm1heCh4Lmxlbmd0aCx5Lmxlbmd0aCk7CiAgICBpZiAoZWdfdS5sZW5ndGghPWspIHsKICAgICAgZWdfdT1uZXcgQXJyYXkoayk7CiAgICAgIGVnX0E9bmV3IEFycmF5KGspOwogICAgICBlZ19CPW5ldyBBcnJheShrKTsKICAgICAgZWdfQz1uZXcgQXJyYXkoayk7CiAgICAgIGVnX0Q9bmV3IEFycmF5KGspOwogICAgfQogICAgd2hpbGUoISh4WzBdJjEpICAmJiAhKHlbMF0mMSkpIHsgIC8vd2hpbGUgeCBhbmQgeSBib3RoIGV2ZW4KICAgICAgaGFsdmVfKHgpOwogICAgICBoYWx2ZV8oeSk7CiAgICAgIGcrKzsKICAgIH0KICAgIGNvcHlfKGVnX3UseCk7CiAgICBjb3B5Xyh2LHkpOwogICAgY29weUludF8oZWdfQSwxKTsKICAgIGNvcHlJbnRfKGVnX0IsMCk7CiAgICBjb3B5SW50XyhlZ19DLDApOwogICAgY29weUludF8oZWdfRCwxKTsKICAgIGZvciAoOzspIHsKICAgICAgd2hpbGUoIShlZ191WzBdJjEpKSB7ICAvL3doaWxlIHUgaXMgZXZlbgogICAgICAgIGhhbHZlXyhlZ191KTsKICAgICAgICBpZiAoIShlZ19BWzBdJjEpICYmICEoZWdfQlswXSYxKSkgeyAvL2lmIEE9PUI9PTAgbW9kIDIKICAgICAgICAgIGhhbHZlXyhlZ19BKTsKICAgICAgICAgIGhhbHZlXyhlZ19CKTsgICAgICAKICAgICAgICB9IGVsc2UgewogICAgICAgICAgYWRkXyhlZ19BLHkpOyAgaGFsdmVfKGVnX0EpOwogICAgICAgICAgc3ViXyhlZ19CLHgpOyAgaGFsdmVfKGVnX0IpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgd2hpbGUgKCEodlswXSYxKSkgeyAgLy93aGlsZSB2IGlzIGV2ZW4KICAgICAgICBoYWx2ZV8odik7CiAgICAgICAgaWYgKCEoZWdfQ1swXSYxKSAmJiAhKGVnX0RbMF0mMSkpIHsgLy9pZiBDPT1EPT0wIG1vZCAyCiAgICAgICAgICBoYWx2ZV8oZWdfQyk7CiAgICAgICAgICBoYWx2ZV8oZWdfRCk7ICAgICAgCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGFkZF8oZWdfQyx5KTsgIGhhbHZlXyhlZ19DKTsKICAgICAgICAgIHN1Yl8oZWdfRCx4KTsgIGhhbHZlXyhlZ19EKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICghZ3JlYXRlcih2LGVnX3UpKSB7IC8vdjw9dQogICAgICAgIHN1Yl8oZWdfdSx2KTsKICAgICAgICBzdWJfKGVnX0EsZWdfQyk7CiAgICAgICAgc3ViXyhlZ19CLGVnX0QpOwogICAgICB9IGVsc2UgeyAgICAgICAgICAgICAgICAvL3Y+dQogICAgICAgIHN1Yl8odixlZ191KTsKICAgICAgICBzdWJfKGVnX0MsZWdfQSk7CiAgICAgICAgc3ViXyhlZ19ELGVnX0IpOwogICAgICB9CiAgICAgIGlmIChlcXVhbHNJbnQoZWdfdSwwKSkgewogICAgICAgIHdoaWxlIChuZWdhdGl2ZShlZ19DKSkgeyAgIC8vbWFrZSBzdXJlIGEgKEMpIGlzIG5vbm5lZ2F0aXZlCiAgICAgICAgICBhZGRfKGVnX0MseSk7CiAgICAgICAgICBzdWJfKGVnX0QseCk7CiAgICAgICAgfQogICAgICAgIG11bHRJbnRfKGVnX0QsLTEpOyAgLy8vbWFrZSBzdXJlIGIgKEQpIGlzIG5vbm5lZ2F0aXZlCiAgICAgICAgY29weV8oYSxlZ19DKTsKICAgICAgICBjb3B5XyhiLGVnX0QpOwogICAgICAgIGxlZnRTaGlmdF8odixnKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgIH0KICB9CgoKICAvL2lzIGJpZ0ludCB4IG5lZ2F0aXZlPwogIGZ1bmN0aW9uIG5lZ2F0aXZlKHgpIHsKICAgIHJldHVybiAoKHhbeC5sZW5ndGgtMV0+PihicGUtMSkpJjEpOwogIH0KCgogIC8vaXMgKHggPDwgKHNoaWZ0KmJwZSkpID4geT8KICAvL3ggYW5kIHkgYXJlIG5vbm5lZ2F0aXZlIGJpZ0ludHMKICAvL3NoaWZ0IGlzIGEgbm9ubmVnYXRpdmUgaW50ZWdlcgogIGZ1bmN0aW9uIGdyZWF0ZXJTaGlmdCh4LHksc2hpZnQpIHsKICAgIHZhciBpLCBreD14Lmxlbmd0aCwga3k9eS5sZW5ndGg7CiAgICB2YXIgaz0oKGt4K3NoaWZ0KTxreSkgPyAoa3grc2hpZnQpIDoga3k7CiAgICBmb3IgKGk9a3ktMS1zaGlmdDsgaTxreCAmJiBpPj0wOyBpKyspIAogICAgICBpZiAoeFtpXT4wKQogICAgICAgIHJldHVybiAxOyAvL2lmIHRoZXJlIGFyZSBub256ZXJvcyBpbiB4IHRvIHRoZSBsZWZ0IG9mIHRoZSBmaXJzdCBjb2x1bW4gb2YgeSwgdGhlbiB4IGlzIGJpZ2dlcgogICAgZm9yIChpPWt4LTErc2hpZnQ7IGk8a3k7IGkrKykKICAgICAgaWYgKHlbaV0+MCkKICAgICAgICByZXR1cm4gMDsgLy9pZiB0aGVyZSBhcmUgbm9uemVyb3MgaW4geSB0byB0aGUgbGVmdCBvZiB0aGUgZmlyc3QgY29sdW1uIG9mIHgsIHRoZW4geCBpcyBub3QgYmlnZ2VyCiAgICBmb3IgKGk9ay0xOyBpPj1zaGlmdDsgaS0tKQogICAgICBpZiAgICAgICh4W2ktc2hpZnRdPnlbaV0pIHJldHVybiAxOwogICAgICBlbHNlIGlmICh4W2ktc2hpZnRdPHlbaV0pIHJldHVybiAwOwogICAgcmV0dXJuIDA7CiAgfQoKICAvL2lzIHggPiB5PyAoeCBhbmQgeSBib3RoIG5vbm5lZ2F0aXZlKQogIGZ1bmN0aW9uIGdyZWF0ZXIoeCx5KSB7CiAgICB2YXIgaTsKICAgIHZhciBrPSh4Lmxlbmd0aDx5Lmxlbmd0aCkgPyB4Lmxlbmd0aCA6IHkubGVuZ3RoOwoKICAgIGZvciAoaT14Lmxlbmd0aDtpPHkubGVuZ3RoO2krKykKICAgICAgaWYgKHlbaV0pCiAgICAgICAgcmV0dXJuIDA7ICAvL3kgaGFzIG1vcmUgZGlnaXRzCgogICAgZm9yIChpPXkubGVuZ3RoO2k8eC5sZW5ndGg7aSsrKQogICAgICBpZiAoeFtpXSkKICAgICAgICByZXR1cm4gMTsgIC8veCBoYXMgbW9yZSBkaWdpdHMKCiAgICBmb3IgKGk9ay0xO2k+PTA7aS0tKQogICAgICBpZiAoeFtpXT55W2ldKQogICAgICAgIHJldHVybiAxOwogICAgICBlbHNlIGlmICh4W2ldPHlbaV0pCiAgICAgICAgcmV0dXJuIDA7CiAgICByZXR1cm4gMDsKICB9CgogIC8vZGl2aWRlIHggYnkgeSBnaXZpbmcgcXVvdGllbnQgcSBhbmQgcmVtYWluZGVyIHIuICAocT1mbG9vcih4L3kpLCAgcj14IG1vZCB5KS4gIEFsbCA0IGFyZSBiaWdpbnRzLgogIC8veCBtdXN0IGhhdmUgYXQgbGVhc3Qgb25lIGxlYWRpbmcgemVybyBlbGVtZW50LgogIC8veSBtdXN0IGJlIG5vbnplcm8uCiAgLy9xIGFuZCByIG11c3QgYmUgYXJyYXlzIHRoYXQgYXJlIGV4YWN0bHkgdGhlIHNhbWUgbGVuZ3RoIGFzIHguIChPciBxIGNhbiBoYXZlIG1vcmUpLgogIC8vTXVzdCBoYXZlIHgubGVuZ3RoID49IHkubGVuZ3RoID49IDIuCiAgZnVuY3Rpb24gZGl2aWRlXyh4LHkscSxyKSB7CiAgICB2YXIga3gsIGt5OwogICAgdmFyIGksaix5MSx5MixjLGEsYjsKICAgIGNvcHlfKHIseCk7CiAgICBmb3IgKGt5PXkubGVuZ3RoO3lba3ktMV09PTA7a3ktLSk7IC8va3kgaXMgbnVtYmVyIG9mIGVsZW1lbnRzIGluIHksIG5vdCBpbmNsdWRpbmcgbGVhZGluZyB6ZXJvcwoKICAgIC8vbm9ybWFsaXplOiBlbnN1cmUgdGhlIG1vc3Qgc2lnbmlmaWNhbnQgZWxlbWVudCBvZiB5IGhhcyBpdHMgaGlnaGVzdCBiaXQgc2V0ICAKICAgIGI9eVtreS0xXTsKICAgIGZvciAoYT0wOyBiOyBhKyspCiAgICAgIGI+Pj0xOyAgCiAgICBhPWJwZS1hOyAgLy9hIGlzIGhvdyBtYW55IGJpdHMgdG8gc2hpZnQgc28gdGhhdCB0aGUgaGlnaCBvcmRlciBiaXQgb2YgeSBpcyBsZWZ0bW9zdCBpbiBpdHMgYXJyYXkgZWxlbWVudAogICAgbGVmdFNoaWZ0Xyh5LGEpOyAgLy9tdWx0aXBseSBib3RoIGJ5IDE8PGEgbm93LCB0aGVuIGRpdmlkZSBib3RoIGJ5IHRoYXQgYXQgdGhlIGVuZAogICAgbGVmdFNoaWZ0XyhyLGEpOwoKICAgIC8vUm9iIFZpc3NlciBkaXNjb3ZlcmVkIGEgYnVnOiB0aGUgZm9sbG93aW5nIGxpbmUgd2FzIG9yaWdpbmFsbHkganVzdCBiZWZvcmUgdGhlIG5vcm1hbGl6YXRpb24uCiAgICBmb3IgKGt4PXIubGVuZ3RoO3Jba3gtMV09PTAgJiYga3g+a3k7a3gtLSk7IC8va3ggaXMgbnVtYmVyIG9mIGVsZW1lbnRzIGluIG5vcm1hbGl6ZWQgeCwgbm90IGluY2x1ZGluZyBsZWFkaW5nIHplcm9zCgogICAgY29weUludF8ocSwwKTsgICAgICAgICAgICAgICAgICAgICAgLy8gcT0wCiAgICB3aGlsZSAoIWdyZWF0ZXJTaGlmdCh5LHIsa3gta3kpKSB7ICAvLyB3aGlsZSAobGVmdFNoaWZ0Xyh5LGt4LWt5KSA8PSByKSB7CiAgICAgIHN1YlNoaWZ0XyhyLHksa3gta3kpOyAgICAgICAgICAgICAvLyAgIHI9ci1sZWZ0U2hpZnRfKHksa3gta3kpCiAgICAgIHFba3gta3ldKys7ICAgICAgICAgICAgICAgICAgICAgICAvLyAgIHFba3gta3ldKys7CiAgICB9ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB9CgogICAgZm9yIChpPWt4LTE7IGk+PWt5OyBpLS0pIHsKICAgICAgaWYgKHJbaV09PXlba3ktMV0pCiAgICAgICAgcVtpLWt5XT1tYXNrOwogICAgICBlbHNlCiAgICAgICAgcVtpLWt5XT1NYXRoLmZsb29yKChyW2ldKnJhZGl4K3JbaS0xXSkveVtreS0xXSk7CgogICAgICAvL1RoZSBmb2xsb3dpbmcgZm9yKDs7KSBsb29wIGlzIGVxdWl2YWxlbnQgdG8gdGhlIGNvbW1lbnRlZCB3aGlsZSBsb29wLCAKICAgICAgLy9leGNlcHQgdGhhdCB0aGUgdW5jb21tZW50ZWQgdmVyc2lvbiBhdm9pZHMgb3ZlcmZsb3cuCiAgICAgIC8vVGhlIGNvbW1lbnRlZCBsb29wIGNvbWVzIGZyb20gSEFDLCB3aGljaCBhc3N1bWVzIHJbLTFdPT15Wy0xXT09MAogICAgICAvLyAgd2hpbGUgKHFbaS1reV0qKHlba3ktMV0qcmFkaXgreVtreS0yXSkgPiByW2ldKnJhZGl4KnJhZGl4K3JbaS0xXSpyYWRpeCtyW2ktMl0pCiAgICAgIC8vICAgIHFbaS1reV0tLTsgICAgCiAgICAgIGZvciAoOzspIHsKICAgICAgICB5Mj0oa3k+MSA/IHlba3ktMl0gOiAwKSpxW2kta3ldOwogICAgICAgIGM9eTI7CiAgICAgICAgeTI9eTIgJiBtYXNrOwogICAgICAgIGMgPSAoYyAtIHkyKSAvIHJhZGl4OwogICAgICAgIHkxPWMrcVtpLWt5XSp5W2t5LTFdOwogICAgICAgIGM9eTE7CiAgICAgICAgeTE9eTEgJiBtYXNrOwogICAgICAgIGMgPSAoYyAtIHkxKSAvIHJhZGl4OwoKICAgICAgICBpZiAoYz09cltpXSA/IHkxPT1yW2ktMV0gPyB5Mj4oaT4xID8gcltpLTJdIDogMCkgOiB5MT5yW2ktMV0gOiBjPnJbaV0pIAogICAgICAgICAgcVtpLWt5XS0tOwogICAgICAgIGVsc2UKICAgICAgICAgIGJyZWFrOwogICAgICB9CgogICAgICBsaW5Db21iU2hpZnRfKHIseSwtcVtpLWt5XSxpLWt5KTsgICAgLy9yPXItcVtpLWt5XSpsZWZ0U2hpZnRfKHksaS1reSkKICAgICAgaWYgKG5lZ2F0aXZlKHIpKSB7CiAgICAgICAgYWRkU2hpZnRfKHIseSxpLWt5KTsgICAgICAgICAvL3I9citsZWZ0U2hpZnRfKHksaS1reSkKICAgICAgICBxW2kta3ldLS07CiAgICAgIH0KICAgIH0KCiAgICByaWdodFNoaWZ0Xyh5LGEpOyAgLy91bmRvIHRoZSBub3JtYWxpemF0aW9uIHN0ZXAKICAgIHJpZ2h0U2hpZnRfKHIsYSk7ICAvL3VuZG8gdGhlIG5vcm1hbGl6YXRpb24gc3RlcAogIH0KCiAgLy9kbyBjYXJyaWVzIGFuZCBib3Jyb3dzIHNvIGVhY2ggZWxlbWVudCBvZiB0aGUgYmlnSW50IHggZml0cyBpbiBicGUgYml0cy4KICBmdW5jdGlvbiBjYXJyeV8oeCkgewogICAgdmFyIGksayxjLGI7CiAgICBrPXgubGVuZ3RoOwogICAgYz0wOwogICAgZm9yIChpPTA7aTxrO2krKykgewogICAgICBjKz14W2ldOwogICAgICBiPTA7CiAgICAgIGlmIChjPDApIHsKICAgICAgICBiID0gYyAmIG1hc2s7CiAgICAgICAgYiA9IC0oKGMgLSBiKSAvIHJhZGl4KTsKICAgICAgICBjKz1iKnJhZGl4OwogICAgICB9CiAgICAgIHhbaV09YyAmIG1hc2s7CiAgICAgIGMgPSAoKGMgLSB4W2ldKSAvIHJhZGl4KSAtIGI7CiAgICB9CiAgfQoKICAvL3JldHVybiB4IG1vZCBuIGZvciBiaWdJbnQgeCBhbmQgaW50ZWdlciBuLgogIGZ1bmN0aW9uIG1vZEludCh4LG4pIHsKICAgIHZhciBpLGM9MDsKICAgIGZvciAoaT14Lmxlbmd0aC0xOyBpPj0wOyBpLS0pCiAgICAgIGM9KGMqcmFkaXgreFtpXSklbjsKICAgIHJldHVybiBjOwogIH0KCiAgLy9jb252ZXJ0IHRoZSBpbnRlZ2VyIHQgaW50byBhIGJpZ0ludCB3aXRoIGF0IGxlYXN0IHRoZSBnaXZlbiBudW1iZXIgb2YgYml0cy4KICAvL3RoZSByZXR1cm5lZCBhcnJheSBzdG9yZXMgdGhlIGJpZ0ludCBpbiBicGUtYml0IGNodW5rcywgbGl0dGxlIGVuZGlhbiAoYnVmZlswXSBpcyBsZWFzdCBzaWduaWZpY2FudCB3b3JkKQogIC8vUGFkIHRoZSBhcnJheSB3aXRoIGxlYWRpbmcgemVyb3Mgc28gdGhhdCBpdCBoYXMgYXQgbGVhc3QgbWluU2l6ZSBlbGVtZW50cy4KICAvL1RoZXJlIHdpbGwgYWx3YXlzIGJlIGF0IGxlYXN0IG9uZSBsZWFkaW5nIDAgZWxlbWVudC4KICBmdW5jdGlvbiBpbnQyYmlnSW50KHQsYml0cyxtaW5TaXplKSB7ICAgCiAgICB2YXIgaSxrLCBidWZmOwogICAgaz1NYXRoLmNlaWwoYml0cy9icGUpKzE7CiAgICBrPW1pblNpemU+ayA/IG1pblNpemUgOiBrOwogICAgYnVmZj1uZXcgQXJyYXkoayk7CiAgICBjb3B5SW50XyhidWZmLHQpOwogICAgcmV0dXJuIGJ1ZmY7CiAgfQoKICAvL3JldHVybiB0aGUgYmlnSW50IGdpdmVuIGEgc3RyaW5nIHJlcHJlc2VudGF0aW9uIGluIGEgZ2l2ZW4gYmFzZS4gIAogIC8vUGFkIHRoZSBhcnJheSB3aXRoIGxlYWRpbmcgemVyb3Mgc28gdGhhdCBpdCBoYXMgYXQgbGVhc3QgbWluU2l6ZSBlbGVtZW50cy4KICAvL0lmIGJhc2U9LTEsIHRoZW4gaXQgcmVhZHMgaW4gYSBzcGFjZS1zZXBhcmF0ZWQgbGlzdCBvZiBhcnJheSBlbGVtZW50cyBpbiBkZWNpbWFsLgogIC8vVGhlIGFycmF5IHdpbGwgYWx3YXlzIGhhdmUgYXQgbGVhc3Qgb25lIGxlYWRpbmcgemVybywgdW5sZXNzIGJhc2U9LTEuCiAgZnVuY3Rpb24gc3RyMmJpZ0ludChzLGJhc2UsbWluU2l6ZSkgewogICAgdmFyIGQsIGksIGosIHgsIHksIGtrOwogICAgdmFyIGs9cy5sZW5ndGg7CiAgICBpZiAoYmFzZT09LTEpIHsgLy9jb21tYS1zZXBhcmF0ZWQgbGlzdCBvZiBhcnJheSBlbGVtZW50cyBpbiBkZWNpbWFsCiAgICAgIHg9bmV3IEFycmF5KDApOwogICAgICBmb3IgKDs7KSB7CiAgICAgICAgeT1uZXcgQXJyYXkoeC5sZW5ndGgrMSk7CiAgICAgICAgZm9yIChpPTA7aTx4Lmxlbmd0aDtpKyspCiAgICAgICAgICB5W2krMV09eFtpXTsKICAgICAgICB5WzBdPXBhcnNlSW50KHMsMTApOwogICAgICAgIHg9eTsKICAgICAgICBkPXMuaW5kZXhPZignLCcsMCk7CiAgICAgICAgaWYgKGQ8MSkgCiAgICAgICAgICBicmVhazsKICAgICAgICBzPXMuc3Vic3RyaW5nKGQrMSk7CiAgICAgICAgaWYgKHMubGVuZ3RoPT0wKQogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgaWYgKHgubGVuZ3RoPG1pblNpemUpIHsKICAgICAgICB5PW5ldyBBcnJheShtaW5TaXplKTsKICAgICAgICBjb3B5Xyh5LHgpOwogICAgICAgIHJldHVybiB5OwogICAgICB9CiAgICAgIHJldHVybiB4OwogICAgfQoKICAgIC8vIGxvZzIoYmFzZSkqawogICAgdmFyIGJiID0gYmFzZSwgcCA9IDA7CiAgICB2YXIgYiA9IGJhc2UgPT0gMSA/IGsgOiAwOwogICAgd2hpbGUgKGJiID4gMSkgewogICAgICBpZiAoYmIgJiAxKSBwID0gMTsKICAgICAgYiArPSBrOwogICAgICBiYiA+Pj0gMTsKICAgIH0KICAgIGIgKz0gcCprOwoKICAgIHg9aW50MmJpZ0ludCgwLGIsMCk7CiAgICBmb3IgKGk9MDtpPGs7aSsrKSB7CiAgICAgIGQ9ZGlnaXRzU3RyLmluZGV4T2Yocy5zdWJzdHJpbmcoaSxpKzEpLDApOwogICAgICBpZiAoYmFzZTw9MzYgJiYgZD49MzYpICAvL2NvbnZlcnQgbG93ZXJjYXNlIHRvIHVwcGVyY2FzZSBpZiBiYXNlPD0zNgogICAgICAgIGQtPTI2OwogICAgICBpZiAoZD49YmFzZSB8fCBkPDApIHsgICAvL3N0b3AgYXQgZmlyc3QgaWxsZWdhbCBjaGFyYWN0ZXIKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBtdWx0SW50Xyh4LGJhc2UpOwogICAgICBhZGRJbnRfKHgsZCk7CiAgICB9CgogICAgZm9yIChrPXgubGVuZ3RoO2s+MCAmJiAheFtrLTFdO2stLSk7IC8vc3RyaXAgb2ZmIGxlYWRpbmcgemVyb3MKICAgIGs9bWluU2l6ZT5rKzEgPyBtaW5TaXplIDogaysxOwogICAgeT1uZXcgQXJyYXkoayk7CiAgICBraz1rPHgubGVuZ3RoID8gayA6IHgubGVuZ3RoOwogICAgZm9yIChpPTA7aTxraztpKyspCiAgICAgIHlbaV09eFtpXTsKICAgIGZvciAoO2k8aztpKyspCiAgICAgIHlbaV09MDsKICAgIHJldHVybiB5OwogIH0KCiAgLy9pcyBiaWdpbnQgeCBlcXVhbCB0byBpbnRlZ2VyIHk/CiAgLy95IG11c3QgaGF2ZSBsZXNzIHRoYW4gYnBlIGJpdHMKICBmdW5jdGlvbiBlcXVhbHNJbnQoeCx5KSB7CiAgICB2YXIgaTsKICAgIGlmICh4WzBdIT15KQogICAgICByZXR1cm4gMDsKICAgIGZvciAoaT0xO2k8eC5sZW5ndGg7aSsrKQogICAgICBpZiAoeFtpXSkKICAgICAgICByZXR1cm4gMDsKICAgIHJldHVybiAxOwogIH0KCiAgLy9hcmUgYmlnaW50cyB4IGFuZCB5IGVxdWFsPwogIC8vdGhpcyB3b3JrcyBldmVuIGlmIHggYW5kIHkgYXJlIGRpZmZlcmVudCBsZW5ndGhzIGFuZCBoYXZlIGFyYml0cmFyaWx5IG1hbnkgbGVhZGluZyB6ZXJvcwogIGZ1bmN0aW9uIGVxdWFscyh4LHkpIHsKICAgIHZhciBpOwogICAgdmFyIGs9eC5sZW5ndGg8eS5sZW5ndGggPyB4Lmxlbmd0aCA6IHkubGVuZ3RoOwogICAgZm9yIChpPTA7aTxrO2krKykKICAgICAgaWYgKHhbaV0hPXlbaV0pCiAgICAgICAgcmV0dXJuIDA7CiAgICBpZiAoeC5sZW5ndGg+eS5sZW5ndGgpIHsKICAgICAgZm9yICg7aTx4Lmxlbmd0aDtpKyspCiAgICAgICAgaWYgKHhbaV0pCiAgICAgICAgICByZXR1cm4gMDsKICAgIH0gZWxzZSB7CiAgICAgIGZvciAoO2k8eS5sZW5ndGg7aSsrKQogICAgICAgIGlmICh5W2ldKQogICAgICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICByZXR1cm4gMTsKICB9CgogIC8vaXMgdGhlIGJpZ0ludCB4IGVxdWFsIHRvIHplcm8/CiAgZnVuY3Rpb24gaXNaZXJvKHgpIHsKICAgIHZhciBpOwogICAgZm9yIChpPTA7aTx4Lmxlbmd0aDtpKyspCiAgICAgIGlmICh4W2ldKQogICAgICAgIHJldHVybiAwOwogICAgcmV0dXJuIDE7CiAgfQoKICAvL2NvbnZlcnQgYSBiaWdJbnQgaW50byBhIHN0cmluZyBpbiBhIGdpdmVuIGJhc2UsIGZyb20gYmFzZSAyIHVwIHRvIGJhc2UgOTUuCiAgLy9CYXNlIC0xIHByaW50cyB0aGUgY29udGVudHMgb2YgdGhlIGFycmF5IHJlcHJlc2VudGluZyB0aGUgbnVtYmVyLgogIGZ1bmN0aW9uIGJpZ0ludDJzdHIoeCxiYXNlKSB7CiAgICB2YXIgaSx0LHM9IiI7CgogICAgaWYgKHM2Lmxlbmd0aCE9eC5sZW5ndGgpIAogICAgICBzNj1kdXAoeCk7CiAgICBlbHNlCiAgICAgIGNvcHlfKHM2LHgpOwoKICAgIGlmIChiYXNlPT0tMSkgeyAvL3JldHVybiB0aGUgbGlzdCBvZiBhcnJheSBjb250ZW50cwogICAgICBmb3IgKGk9eC5sZW5ndGgtMTtpPjA7aS0tKQogICAgICAgIHMrPXhbaV0rJywnOwogICAgICBzKz14WzBdOwogICAgfQogICAgZWxzZSB7IC8vcmV0dXJuIGl0IGluIHRoZSBnaXZlbiBiYXNlCiAgICAgIHdoaWxlICghaXNaZXJvKHM2KSkgewogICAgICAgIHQ9ZGl2SW50XyhzNixiYXNlKTsgIC8vdD1zNiAlIGJhc2U7IHM2PWZsb29yKHM2L2Jhc2UpOwogICAgICAgIHM9ZGlnaXRzU3RyLnN1YnN0cmluZyh0LHQrMSkrczsKICAgICAgfQogICAgfQogICAgaWYgKHMubGVuZ3RoPT0wKQogICAgICBzPSIwIjsKICAgIHJldHVybiBzOwogIH0KCiAgLy9yZXR1cm5zIGEgZHVwbGljYXRlIG9mIGJpZ0ludCB4CiAgZnVuY3Rpb24gZHVwKHgpIHsKICAgIHZhciBpLCBidWZmOwogICAgYnVmZj1uZXcgQXJyYXkoeC5sZW5ndGgpOwogICAgY29weV8oYnVmZix4KTsKICAgIHJldHVybiBidWZmOwogIH0KCiAgLy9kbyB4PXkgb24gYmlnSW50cyB4IGFuZCB5LiAgeCBtdXN0IGJlIGFuIGFycmF5IGF0IGxlYXN0IGFzIGJpZyBhcyB5IChub3QgY291bnRpbmcgdGhlIGxlYWRpbmcgemVyb3MgaW4geSkuCiAgZnVuY3Rpb24gY29weV8oeCx5KSB7CiAgICB2YXIgaTsKICAgIHZhciBrPXgubGVuZ3RoPHkubGVuZ3RoID8geC5sZW5ndGggOiB5Lmxlbmd0aDsKICAgIGZvciAoaT0wO2k8aztpKyspCiAgICAgIHhbaV09eVtpXTsKICAgIGZvciAoaT1rO2k8eC5sZW5ndGg7aSsrKQogICAgICB4W2ldPTA7CiAgfQoKICAvL2RvIHg9eSBvbiBiaWdJbnQgeCBhbmQgaW50ZWdlciB5LiAgCiAgZnVuY3Rpb24gY29weUludF8oeCxuKSB7CiAgICB2YXIgaSxjOwogICAgZm9yIChjPW4saT0wO2k8eC5sZW5ndGg7aSsrKSB7CiAgICAgIHhbaV09YyAmIG1hc2s7CiAgICAgIGM+Pj1icGU7CiAgICB9CiAgfQoKICAvL2RvIHg9eCtuIHdoZXJlIHggaXMgYSBiaWdJbnQgYW5kIG4gaXMgYW4gaW50ZWdlci4KICAvL3ggbXVzdCBiZSBsYXJnZSBlbm91Z2ggdG8gaG9sZCB0aGUgcmVzdWx0LgogIGZ1bmN0aW9uIGFkZEludF8oeCxuKSB7CiAgICB2YXIgaSxrLGMsYjsKICAgIHhbMF0rPW47CiAgICBrPXgubGVuZ3RoOwogICAgYz0wOwogICAgZm9yIChpPTA7aTxrO2krKykgewogICAgICBjKz14W2ldOwogICAgICBiPTA7CiAgICAgIGlmIChjPDApIHsKICAgICAgICBiID0gYyAmIG1hc2s7CiAgICAgICAgYiA9IC0oKGMgLSBiKSAvIHJhZGl4KTsKICAgICAgICBjKz1iKnJhZGl4OwogICAgICB9CiAgICAgIHhbaV09YyAmIG1hc2s7CiAgICAgIGMgPSAoKGMgLSB4W2ldKSAvIHJhZGl4KSAtIGI7CiAgICAgIGlmICghYykgcmV0dXJuOyAvL3N0b3AgY2FycnlpbmcgYXMgc29vbiBhcyB0aGUgY2FycnkgaXMgemVybwogICAgfQogIH0KCiAgLy9yaWdodCBzaGlmdCBiaWdJbnQgeCBieSBuIGJpdHMuCiAgZnVuY3Rpb24gcmlnaHRTaGlmdF8oeCxuKSB7CiAgICB2YXIgaTsKICAgIHZhciBrPU1hdGguZmxvb3Iobi9icGUpOwogICAgaWYgKGspIHsKICAgICAgZm9yIChpPTA7aTx4Lmxlbmd0aC1rO2krKykgLy9yaWdodCBzaGlmdCB4IGJ5IGsgZWxlbWVudHMKICAgICAgICB4W2ldPXhbaStrXTsKICAgICAgZm9yICg7aTx4Lmxlbmd0aDtpKyspCiAgICAgICAgeFtpXT0wOwogICAgICBuJT1icGU7CiAgICB9CiAgICBmb3IgKGk9MDtpPHgubGVuZ3RoLTE7aSsrKSB7CiAgICAgIHhbaV09bWFzayAmICgoeFtpKzFdPDwoYnBlLW4pKSB8ICh4W2ldPj5uKSk7CiAgICB9CiAgICB4W2ldPj49bjsKICB9CgogIC8vZG8geD1mbG9vcih8eHwvMikqc2duKHgpIGZvciBiaWdJbnQgeCBpbiAyJ3MgY29tcGxlbWVudAogIGZ1bmN0aW9uIGhhbHZlXyh4KSB7CiAgICB2YXIgaTsKICAgIGZvciAoaT0wO2k8eC5sZW5ndGgtMTtpKyspIHsKICAgICAgeFtpXT1tYXNrICYgKCh4W2krMV08PChicGUtMSkpIHwgKHhbaV0+PjEpKTsKICAgIH0KICAgIHhbaV09KHhbaV0+PjEpIHwgKHhbaV0gJiAocmFkaXg+PjEpKTsgIC8vbW9zdCBzaWduaWZpY2FudCBiaXQgc3RheXMgdGhlIHNhbWUKICB9CgogIC8vbGVmdCBzaGlmdCBiaWdJbnQgeCBieSBuIGJpdHMuCiAgZnVuY3Rpb24gbGVmdFNoaWZ0Xyh4LG4pIHsKICAgIHZhciBpOwogICAgdmFyIGs9TWF0aC5mbG9vcihuL2JwZSk7CiAgICBpZiAoaykgewogICAgICBmb3IgKGk9eC5sZW5ndGg7IGk+PWs7IGktLSkgLy9sZWZ0IHNoaWZ0IHggYnkgayBlbGVtZW50cwogICAgICAgIHhbaV09eFtpLWtdOwogICAgICBmb3IgKDtpPj0wO2ktLSkKICAgICAgICB4W2ldPTA7ICAKICAgICAgbiU9YnBlOwogICAgfQogICAgaWYgKCFuKQogICAgICByZXR1cm47CiAgICBmb3IgKGk9eC5sZW5ndGgtMTtpPjA7aS0tKSB7CiAgICAgIHhbaV09bWFzayAmICgoeFtpXTw8bikgfCAoeFtpLTFdPj4oYnBlLW4pKSk7CiAgICB9CiAgICB4W2ldPW1hc2sgJiAoeFtpXTw8bik7CiAgfQoKICAvL2RvIHg9eCpuIHdoZXJlIHggaXMgYSBiaWdJbnQgYW5kIG4gaXMgYW4gaW50ZWdlci4KICAvL3ggbXVzdCBiZSBsYXJnZSBlbm91Z2ggdG8gaG9sZCB0aGUgcmVzdWx0LgogIGZ1bmN0aW9uIG11bHRJbnRfKHgsbikgewogICAgdmFyIGksayxjLGI7CiAgICBpZiAoIW4pCiAgICAgIHJldHVybjsKICAgIGs9eC5sZW5ndGg7CiAgICBjPTA7CiAgICBmb3IgKGk9MDtpPGs7aSsrKSB7CiAgICAgIGMrPXhbaV0qbjsKICAgICAgYj0wOwogICAgICBpZiAoYzwwKSB7CiAgICAgICAgYiA9IGMgJiBtYXNrOwogICAgICAgIGIgPSAtKChjIC0gYikgLyByYWRpeCk7CiAgICAgICAgYys9YipyYWRpeDsKICAgICAgfQogICAgICB4W2ldPWMgJiBtYXNrOwogICAgICBjID0gKChjIC0geFtpXSkgLyByYWRpeCkgLSBiOwogICAgfQogIH0KCiAgLy9kbyB4PWZsb29yKHgvbikgZm9yIGJpZ0ludCB4IGFuZCBpbnRlZ2VyIG4sIGFuZCByZXR1cm4gdGhlIHJlbWFpbmRlcgogIGZ1bmN0aW9uIGRpdkludF8oeCxuKSB7CiAgICB2YXIgaSxyPTAsczsKICAgIGZvciAoaT14Lmxlbmd0aC0xO2k+PTA7aS0tKSB7CiAgICAgIHM9cipyYWRpeCt4W2ldOwogICAgICB4W2ldPU1hdGguZmxvb3Iocy9uKTsKICAgICAgcj1zJW47CiAgICB9CiAgICByZXR1cm4gcjsKICB9CgogIC8vZG8gdGhlIGxpbmVhciBjb21iaW5hdGlvbiB4PWEqeCtiKnkgZm9yIGJpZ0ludHMgeCBhbmQgeSwgYW5kIGludGVnZXJzIGEgYW5kIGIuCiAgLy94IG11c3QgYmUgbGFyZ2UgZW5vdWdoIHRvIGhvbGQgdGhlIGFuc3dlci4KICBmdW5jdGlvbiBsaW5Db21iXyh4LHksYSxiKSB7CiAgICB2YXIgaSxjLGssa2s7CiAgICBrPXgubGVuZ3RoPHkubGVuZ3RoID8geC5sZW5ndGggOiB5Lmxlbmd0aDsKICAgIGtrPXgubGVuZ3RoOwogICAgZm9yIChjPTAsaT0wO2k8aztpKyspIHsKICAgICAgYys9YSp4W2ldK2IqeVtpXTsKICAgICAgeFtpXT1jICYgbWFzazsKICAgICAgYyA9IChjIC0geFtpXSkgLyByYWRpeDsKICAgIH0KICAgIGZvciAoaT1rO2k8a2s7aSsrKSB7CiAgICAgIGMrPWEqeFtpXTsKICAgICAgeFtpXT1jICYgbWFzazsKICAgICAgYyA9IChjIC0geFtpXSkgLyByYWRpeDsKICAgIH0KICB9CgogIC8vZG8gdGhlIGxpbmVhciBjb21iaW5hdGlvbiB4PWEqeCtiKih5PDwoeXMqYnBlKSkgZm9yIGJpZ0ludHMgeCBhbmQgeSwgYW5kIGludGVnZXJzIGEsIGIgYW5kIHlzLgogIC8veCBtdXN0IGJlIGxhcmdlIGVub3VnaCB0byBob2xkIHRoZSBhbnN3ZXIuCiAgZnVuY3Rpb24gbGluQ29tYlNoaWZ0Xyh4LHksYix5cykgewogICAgdmFyIGksYyxrLGtrOwogICAgaz14Lmxlbmd0aDx5cyt5Lmxlbmd0aCA/IHgubGVuZ3RoIDogeXMreS5sZW5ndGg7CiAgICBraz14Lmxlbmd0aDsKICAgIGZvciAoYz0wLGk9eXM7aTxrO2krKykgewogICAgICBjKz14W2ldK2IqeVtpLXlzXTsKICAgICAgeFtpXT1jICYgbWFzazsKICAgICAgYyA9IChjIC0geFtpXSkgLyByYWRpeDsKICAgIH0KICAgIGZvciAoaT1rO2MgJiYgaTxraztpKyspIHsKICAgICAgYys9eFtpXTsKICAgICAgeFtpXT1jICYgbWFzazsKICAgICAgYyA9IChjIC0geFtpXSkgLyByYWRpeDsKICAgIH0KICB9CgogIC8vZG8geD14Kyh5PDwoeXMqYnBlKSkgZm9yIGJpZ0ludHMgeCBhbmQgeSwgYW5kIGludGVnZXJzIGEsYiBhbmQgeXMuCiAgLy94IG11c3QgYmUgbGFyZ2UgZW5vdWdoIHRvIGhvbGQgdGhlIGFuc3dlci4KICBmdW5jdGlvbiBhZGRTaGlmdF8oeCx5LHlzKSB7CiAgICB2YXIgaSxjLGssa2s7CiAgICBrPXgubGVuZ3RoPHlzK3kubGVuZ3RoID8geC5sZW5ndGggOiB5cyt5Lmxlbmd0aDsKICAgIGtrPXgubGVuZ3RoOwogICAgZm9yIChjPTAsaT15cztpPGs7aSsrKSB7CiAgICAgIGMrPXhbaV0reVtpLXlzXTsKICAgICAgeFtpXT1jICYgbWFzazsKICAgICAgYyA9IChjIC0geFtpXSkgLyByYWRpeDsKICAgIH0KICAgIGZvciAoaT1rO2MgJiYgaTxraztpKyspIHsKICAgICAgYys9eFtpXTsKICAgICAgeFtpXT1jICYgbWFzazsKICAgICAgYyA9IChjIC0geFtpXSkgLyByYWRpeDsKICAgIH0KICB9CgogIC8vZG8geD14LSh5PDwoeXMqYnBlKSkgZm9yIGJpZ0ludHMgeCBhbmQgeSwgYW5kIGludGVnZXJzIGEsYiBhbmQgeXMuCiAgLy94IG11c3QgYmUgbGFyZ2UgZW5vdWdoIHRvIGhvbGQgdGhlIGFuc3dlci4KICBmdW5jdGlvbiBzdWJTaGlmdF8oeCx5LHlzKSB7CiAgICB2YXIgaSxjLGssa2s7CiAgICBrPXgubGVuZ3RoPHlzK3kubGVuZ3RoID8geC5sZW5ndGggOiB5cyt5Lmxlbmd0aDsKICAgIGtrPXgubGVuZ3RoOwogICAgZm9yIChjPTAsaT15cztpPGs7aSsrKSB7CiAgICAgIGMrPXhbaV0teVtpLXlzXTsKICAgICAgeFtpXT1jICYgbWFzazsKICAgICAgYyA9IChjIC0geFtpXSkgLyByYWRpeDsKICAgIH0KICAgIGZvciAoaT1rO2MgJiYgaTxraztpKyspIHsKICAgICAgYys9eFtpXTsKICAgICAgeFtpXT1jICYgbWFzazsKICAgICAgYyA9IChjIC0geFtpXSkgLyByYWRpeDsKICAgIH0KICB9CgogIC8vZG8geD14LXkgZm9yIGJpZ0ludHMgeCBhbmQgeS4KICAvL3ggbXVzdCBiZSBsYXJnZSBlbm91Z2ggdG8gaG9sZCB0aGUgYW5zd2VyLgogIC8vbmVnYXRpdmUgYW5zd2VycyB3aWxsIGJlIDJzIGNvbXBsZW1lbnQKICBmdW5jdGlvbiBzdWJfKHgseSkgewogICAgdmFyIGksYyxrLGtrOwogICAgaz14Lmxlbmd0aDx5Lmxlbmd0aCA/IHgubGVuZ3RoIDogeS5sZW5ndGg7CiAgICBmb3IgKGM9MCxpPTA7aTxrO2krKykgewogICAgICBjKz14W2ldLXlbaV07CiAgICAgIHhbaV09YyAmIG1hc2s7CiAgICAgIGMgPSAoYyAtIHhbaV0pIC8gcmFkaXg7CiAgICB9CiAgICBmb3IgKGk9aztjICYmIGk8eC5sZW5ndGg7aSsrKSB7CiAgICAgIGMrPXhbaV07CiAgICAgIHhbaV09YyAmIG1hc2s7CiAgICAgIGMgPSAoYyAtIHhbaV0pIC8gcmFkaXg7CiAgICB9CiAgfQoKICAvL2RvIHg9eCt5IGZvciBiaWdJbnRzIHggYW5kIHkuCiAgLy94IG11c3QgYmUgbGFyZ2UgZW5vdWdoIHRvIGhvbGQgdGhlIGFuc3dlci4KICBmdW5jdGlvbiBhZGRfKHgseSkgewogICAgdmFyIGksYyxrLGtrOwogICAgaz14Lmxlbmd0aDx5Lmxlbmd0aCA/IHgubGVuZ3RoIDogeS5sZW5ndGg7CiAgICBmb3IgKGM9MCxpPTA7aTxrO2krKykgewogICAgICBjKz14W2ldK3lbaV07CiAgICAgIHhbaV09YyAmIG1hc2s7CiAgICAgIGMgPSAoYyAtIHhbaV0pIC8gcmFkaXg7CiAgICB9CiAgICBmb3IgKGk9aztjICYmIGk8eC5sZW5ndGg7aSsrKSB7CiAgICAgIGMrPXhbaV07CiAgICAgIHhbaV09YyAmIG1hc2s7CiAgICAgIGMgPSAoYyAtIHhbaV0pIC8gcmFkaXg7CiAgICB9CiAgfQoKICAvL2RvIHg9eCp5IGZvciBiaWdJbnRzIHggYW5kIHkuICBUaGlzIGlzIGZhc3RlciB3aGVuIHk8eC4KICBmdW5jdGlvbiBtdWx0Xyh4LHkpIHsKICAgIHZhciBpOwogICAgaWYgKHNzLmxlbmd0aCE9Mip4Lmxlbmd0aCkKICAgICAgc3M9bmV3IEFycmF5KDIqeC5sZW5ndGgpOwogICAgY29weUludF8oc3MsMCk7CiAgICBmb3IgKGk9MDtpPHkubGVuZ3RoO2krKykKICAgICAgaWYgKHlbaV0pCiAgICAgICAgbGluQ29tYlNoaWZ0Xyhzcyx4LHlbaV0saSk7ICAgLy9zcz0xKnNzK3lbaV0qKHg8PChpKmJwZSkpCiAgICBjb3B5Xyh4LHNzKTsKICB9CgogIC8vZG8geD14IG1vZCBuIGZvciBiaWdJbnRzIHggYW5kIG4uCiAgZnVuY3Rpb24gbW9kXyh4LG4pIHsKICAgIGlmIChzNC5sZW5ndGghPXgubGVuZ3RoKQogICAgICBzND1kdXAoeCk7CiAgICBlbHNlCiAgICAgIGNvcHlfKHM0LHgpOwogICAgaWYgKHM1Lmxlbmd0aCE9eC5sZW5ndGgpCiAgICAgIHM1PWR1cCh4KTsgIAogICAgZGl2aWRlXyhzNCxuLHM1LHgpOyAgLy94ID0gcmVtYWluZGVyIG9mIHM0IC8gbgogIH0KCiAgLy9kbyB4PXgqeSBtb2QgbiBmb3IgYmlnSW50cyB4LHksbi4KICAvL2ZvciBncmVhdGVyIHNwZWVkLCBsZXQgeTx4LgogIGZ1bmN0aW9uIG11bHRNb2RfKHgseSxuKSB7CiAgICB2YXIgaTsKICAgIGlmIChzMC5sZW5ndGghPTIqeC5sZW5ndGgpCiAgICAgIHMwPW5ldyBBcnJheSgyKngubGVuZ3RoKTsKICAgIGNvcHlJbnRfKHMwLDApOwogICAgZm9yIChpPTA7aTx5Lmxlbmd0aDtpKyspCiAgICAgIGlmICh5W2ldKQogICAgICAgIGxpbkNvbWJTaGlmdF8oczAseCx5W2ldLGkpOyAgIC8vczA9MSpzMCt5W2ldKih4PDwoaSpicGUpKQogICAgbW9kXyhzMCxuKTsKICAgIGNvcHlfKHgsczApOwogIH0KCiAgLy9kbyB4PXgqeCBtb2QgbiBmb3IgYmlnSW50cyB4LG4uCiAgZnVuY3Rpb24gc3F1YXJlTW9kXyh4LG4pIHsKICAgIHZhciBpLGosZCxjLGt4LGtuLGs7CiAgICBmb3IgKGt4PXgubGVuZ3RoOyBreD4wICYmICF4W2t4LTFdOyBreC0tKTsgIC8vaWdub3JlIGxlYWRpbmcgemVyb3MgaW4geAogICAgaz1reD5uLmxlbmd0aCA/IDIqa3ggOiAyKm4ubGVuZ3RoOyAvL2s9IyBlbGVtZW50cyBpbiB0aGUgcHJvZHVjdCwgd2hpY2ggaXMgdHdpY2UgdGhlIGVsZW1lbnRzIGluIHRoZSBsYXJnZXIgb2YgeCBhbmQgbgogICAgaWYgKHMwLmxlbmd0aCE9aykgCiAgICAgIHMwPW5ldyBBcnJheShrKTsKICAgIGNvcHlJbnRfKHMwLDApOwogICAgZm9yIChpPTA7aTxreDtpKyspIHsKICAgICAgYz1zMFsyKmldK3hbaV0qeFtpXTsKICAgICAgczBbMippXT1jICYgbWFzazsKICAgICAgYyA9IChjIC0gczBbMippXSkgLyByYWRpeDsKICAgICAgZm9yIChqPWkrMTtqPGt4O2orKykgewogICAgICAgIGM9czBbaStqXSsyKnhbaV0qeFtqXStjOwogICAgICAgIHMwW2kral09KGMgJiBtYXNrKTsKICAgICAgICBjID0gKGMgLSBzMFtpK2pdKSAvIHJhZGl4OwogICAgICB9CiAgICAgIHMwW2kra3hdPWM7CiAgICB9CiAgICBtb2RfKHMwLG4pOwogICAgY29weV8oeCxzMCk7CiAgfQoKICAvL3JldHVybiB4IHdpdGggZXhhY3RseSBrIGxlYWRpbmcgemVybyBlbGVtZW50cwogIGZ1bmN0aW9uIHRyaW0oeCxrKSB7CiAgICB2YXIgaSx5OwogICAgZm9yIChpPXgubGVuZ3RoOyBpPjAgJiYgIXhbaS0xXTsgaS0tKTsKICAgIHk9bmV3IEFycmF5KGkrayk7CiAgICBjb3B5Xyh5LHgpOwogICAgcmV0dXJuIHk7CiAgfQoKICAvL2RvIHg9eCoqeSBtb2Qgbiwgd2hlcmUgeCx5LG4gYXJlIGJpZ0ludHMgYW5kICoqIGlzIGV4cG9uZW50aWF0aW9uLiAgMCoqMD0xLgogIC8vdGhpcyBpcyBmYXN0ZXIgd2hlbiBuIGlzIG9kZC4gIHggdXN1YWxseSBuZWVkcyB0byBoYXZlIGFzIG1hbnkgZWxlbWVudHMgYXMgbi4KICBmdW5jdGlvbiBwb3dNb2RfKHgseSxuKSB7CiAgICB2YXIgazEsazIsa24sbnA7CiAgICBpZihzNy5sZW5ndGghPW4ubGVuZ3RoKQogICAgICBzNz1kdXAobik7CgogICAgLy9mb3IgZXZlbiBtb2R1bHVzLCB1c2UgYSBzaW1wbGUgc3F1YXJlLWFuZC1tdWx0aXBseSBhbGdvcml0aG0sCiAgICAvL3JhdGhlciB0aGFuIHVzaW5nIHRoZSBtb3JlIGNvbXBsZXggTW9udGdvbWVyeSBhbGdvcml0aG0uCiAgICBpZiAoKG5bMF0mMSk9PTApIHsKICAgICAgY29weV8oczcseCk7CiAgICAgIGNvcHlJbnRfKHgsMSk7CiAgICAgIHdoaWxlKCFlcXVhbHNJbnQoeSwwKSkgewogICAgICAgIGlmICh5WzBdJjEpCiAgICAgICAgICBtdWx0TW9kXyh4LHM3LG4pOwogICAgICAgIGRpdkludF8oeSwyKTsKICAgICAgICBzcXVhcmVNb2RfKHM3LG4pOyAKICAgICAgfQogICAgICByZXR1cm47CiAgICB9CgogICAgLy9jYWxjdWxhdGUgbnAgZnJvbSBuIGZvciB0aGUgTW9udGdvbWVyeSBtdWx0aXBsaWNhdGlvbnMKICAgIGNvcHlJbnRfKHM3LDApOwogICAgZm9yIChrbj1uLmxlbmd0aDtrbj4wICYmICFuW2tuLTFdO2tuLS0pOwogICAgbnA9cmFkaXgtaW52ZXJzZU1vZEludChtb2RJbnQobixyYWRpeCkscmFkaXgpOwogICAgczdba25dPTE7CiAgICBtdWx0TW9kXyh4ICxzNyxuKTsgICAvLyB4ID0geCAqIDIqKihrbipicCkgbW9kIG4KCiAgICBpZiAoczMubGVuZ3RoIT14Lmxlbmd0aCkKICAgICAgczM9ZHVwKHgpOwogICAgZWxzZQogICAgICBjb3B5XyhzMyx4KTsKCiAgICBmb3IgKGsxPXkubGVuZ3RoLTE7azE+MCAmICF5W2sxXTsgazEtLSk7ICAvL2sxPWZpcnN0IG5vbnplcm8gZWxlbWVudCBvZiB5CiAgICBpZiAoeVtrMV09PTApIHsgIC8vYW55dGhpbmcgdG8gdGhlIDB0aCBwb3dlciBpcyAxCiAgICAgIGNvcHlJbnRfKHgsMSk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGZvciAoazI9MTw8KGJwZS0xKTtrMiAmJiAhKHlbazFdICYgazIpOyBrMj4+PTEpOyAgLy9rMj1wb3NpdGlvbiBvZiBmaXJzdCAxIGJpdCBpbiB5W2sxXQogICAgZm9yICg7OykgewogICAgICBpZiAoIShrMj4+PTEpKSB7ICAvL2xvb2sgYXQgbmV4dCBiaXQgb2YgeQogICAgICAgIGsxLS07CiAgICAgICAgaWYgKGsxPDApIHsKICAgICAgICAgIG1vbnRfKHgsb25lLG4sbnApOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBrMj0xPDwoYnBlLTEpOwogICAgICB9ICAgIAogICAgICBtb250Xyh4LHgsbixucCk7CgogICAgICBpZiAoazIgJiB5W2sxXSkgLy9pZiBuZXh0IGJpdCBpcyBhIDEKICAgICAgICBtb250Xyh4LHMzLG4sbnApOwogICAgfQogIH0KCgogIC8vZG8geD14KnkqUmkgbW9kIG4gZm9yIGJpZ0ludHMgeCx5LG4sIAogIC8vICB3aGVyZSBSaSA9IDIqKigta24qYnBlKSBtb2QgbiwgYW5kIGtuIGlzIHRoZSAKICAvLyAgbnVtYmVyIG9mIGVsZW1lbnRzIGluIHRoZSBuIGFycmF5LCBub3QgCiAgLy8gIGNvdW50aW5nIGxlYWRpbmcgemVyb3MuICAKICAvL3ggYXJyYXkgbXVzdCBoYXZlIGF0IGxlYXN0IGFzIG1hbnkgZWxlbW50cyBhcyB0aGUgbiBhcnJheQogIC8vSXQncyBPSyBpZiB4IGFuZCB5IGFyZSB0aGUgc2FtZSB2YXJpYWJsZS4KICAvL211c3QgaGF2ZToKICAvLyAgeCx5IDwgbgogIC8vICBuIGlzIG9kZAogIC8vICBucCA9IC0obl4oLTEpKSBtb2QgcmFkaXgKICBmdW5jdGlvbiBtb250Xyh4LHksbixucCkgewogICAgdmFyIGksaixjLHVpLHQsdDIsa3M7CiAgICB2YXIga249bi5sZW5ndGg7CiAgICB2YXIga3k9eS5sZW5ndGg7CgogICAgaWYgKHNhLmxlbmd0aCE9a24pCiAgICAgIHNhPW5ldyBBcnJheShrbik7CiAgICAgIAogICAgY29weUludF8oc2EsMCk7CgogICAgZm9yICg7a24+MCAmJiBuW2tuLTFdPT0wO2tuLS0pOyAvL2lnbm9yZSBsZWFkaW5nIHplcm9zIG9mIG4KICAgIGZvciAoO2t5PjAgJiYgeVtreS0xXT09MDtreS0tKTsgLy9pZ25vcmUgbGVhZGluZyB6ZXJvcyBvZiB5CiAgICBrcz1zYS5sZW5ndGgtMTsgLy9zYSB3aWxsIG5ldmVyIGhhdmUgbW9yZSB0aGFuIHRoaXMgbWFueSBub256ZXJvIGVsZW1lbnRzLiAgCgogICAgLy90aGUgZm9sbG93aW5nIGxvb3AgY29uc3VtZXMgOTUlIG9mIHRoZSBydW50aW1lIGZvciByYW5kVHJ1ZVByaW1lXygpIGFuZCBwb3dNb2RfKCkgZm9yIGxhcmdlIG51bWJlcnMKICAgIGZvciAoaT0wOyBpPGtuOyBpKyspIHsKICAgICAgdD1zYVswXSt4W2ldKnlbMF07CiAgICAgIHVpPSgodCAmIG1hc2spICogbnApICYgbWFzazsgIC8vdGhlIGlubmVyICImIG1hc2siIHdhcyBuZWVkZWQgb24gU2FmYXJpIChidXQgbm90IE1TSUUpIGF0IG9uZSB0aW1lCiAgICAgIGM9KHQrdWkqblswXSk7CiAgICAgIGMgPSAoYyAtIChjICYgbWFzaykpIC8gcmFkaXg7CiAgICAgIHQ9eFtpXTsKICAgICAgCiAgICAgIC8vZG8gc2E9KHNhK3hbaV0qeSt1aSpuKS9iICAgd2hlcmUgYj0yKipicGUuICBMb29wIGlzIHVucm9sbGVkIDUtZm9sZCBmb3Igc3BlZWQKICAgICAgaj0xOwogICAgICBmb3IgKDtqPGt5LTQ7KSB7CiAgICAgICAgYys9c2Fbal0rdWkqbltqXSt0Knlbal07IHQyPXNhW2otMV09YyAmIG1hc2s7IGM9KGMtdDIpL3JhZGl4OyBqKys7CiAgICAgICAgYys9c2Fbal0rdWkqbltqXSt0Knlbal07IHQyPXNhW2otMV09YyAmIG1hc2s7IGM9KGMtdDIpL3JhZGl4OyBqKys7CiAgICAgICAgYys9c2Fbal0rdWkqbltqXSt0Knlbal07IHQyPXNhW2otMV09YyAmIG1hc2s7IGM9KGMtdDIpL3JhZGl4OyBqKys7CiAgICAgICAgYys9c2Fbal0rdWkqbltqXSt0Knlbal07IHQyPXNhW2otMV09YyAmIG1hc2s7IGM9KGMtdDIpL3JhZGl4OyBqKys7CiAgICAgICAgYys9c2Fbal0rdWkqbltqXSt0Knlbal07IHQyPXNhW2otMV09YyAmIG1hc2s7IGM9KGMtdDIpL3JhZGl4OyBqKys7CiAgICAgIH0KICAgICAgZm9yICg7ajxreTspICAgewogICAgICAgIGMrPXNhW2pdK3VpKm5bal0rdCp5W2pdOyB0Mj1zYVtqLTFdPWMgJiBtYXNrOyBjPShjLXQyKS9yYWRpeDsgaisrOwogICAgICB9CiAgICAgIGZvciAoO2o8a24tNDspIHsKICAgICAgICBjKz1zYVtqXSt1aSpuW2pdOyAgICAgICAgdDI9c2Fbai0xXT1jICYgbWFzazsgYz0oYy10MikvcmFkaXg7IGorKzsKICAgICAgICBjKz1zYVtqXSt1aSpuW2pdOyAgICAgICAgdDI9c2Fbai0xXT1jICYgbWFzazsgYz0oYy10MikvcmFkaXg7IGorKzsKICAgICAgICBjKz1zYVtqXSt1aSpuW2pdOyAgICAgICAgdDI9c2Fbai0xXT1jICYgbWFzazsgYz0oYy10MikvcmFkaXg7IGorKzsKICAgICAgICBjKz1zYVtqXSt1aSpuW2pdOyAgICAgICAgdDI9c2Fbai0xXT1jICYgbWFzazsgYz0oYy10MikvcmFkaXg7IGorKzsKICAgICAgICBjKz1zYVtqXSt1aSpuW2pdOyAgICAgICAgdDI9c2Fbai0xXT1jICYgbWFzazsgYz0oYy10MikvcmFkaXg7IGorKzsKICAgICAgfQogICAgICBmb3IgKDtqPGtuOykgICB7CiAgICAgICAgYys9c2Fbal0rdWkqbltqXTsgICAgICAgIHQyPXNhW2otMV09YyAmIG1hc2s7IGM9KGMtdDIpL3JhZGl4OyBqKys7CiAgICAgIH0KICAgICAgZm9yICg7ajxrczspICAgewogICAgICAgIGMrPXNhW2pdOyAgICAgICAgICAgICAgICB0Mj1zYVtqLTFdPWMgJiBtYXNrOyBjPShjLXQyKS9yYWRpeDsgaisrOwogICAgICB9CiAgICAgIHNhW2otMV09YyAmIG1hc2s7CiAgICB9CgogICAgaWYgKCFncmVhdGVyKG4sc2EpKQogICAgICBzdWJfKHNhLG4pOwogICAgY29weV8oeCxzYSk7CiAgfQoKCiAgLy8gb3RyLmpzIGFkZGl0aW9ucwoKCiAgLy8gY29tcHV0ZXMgbnVtIC8gZGVuIG1vZCBuCiAgZnVuY3Rpb24gZGl2TW9kKG51bSwgZGVuLCBuKSB7CiAgICByZXR1cm4gbXVsdE1vZChudW0sIGludmVyc2VNb2QoZGVuLCBuKSwgbikKICB9CgogIC8vIGNvbXB1dGVzIG9uZSAtIHR3byBtb2QgbgogIGZ1bmN0aW9uIHN1Yk1vZChvbmUsIHR3bywgbikgewogICAgb25lID0gbW9kKG9uZSwgbikKICAgIHR3byA9IG1vZCh0d28sIG4pCiAgICBpZiAoZ3JlYXRlcih0d28sIG9uZSkpIG9uZSA9IGFkZChvbmUsIG4pCiAgICByZXR1cm4gc3ViKG9uZSwgdHdvKQogIH0KCiAgLy8gY29tcHV0ZXMgMl5tIGFzIGEgYmlnSW50CiAgZnVuY3Rpb24gdHdvVG9UaGUobSkgewogICAgdmFyIGIgPSBNYXRoLmZsb29yKG0gLyBicGUpICsgMgogICAgdmFyIHQgPSBuZXcgQXJyYXkoYikKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYjsgaSsrKSB0W2ldID0gMAogICAgdFtiIC0gMl0gPSAxIDw8IChtICUgYnBlKQogICAgcmV0dXJuIHQKICB9CgogIC8vIGNhY2hlIHRoZXNlIHJlc3VsdHMgZm9yIGZhc3RlciBsb29rdXAKICB2YXIgX251bTJiaW4gPSAoZnVuY3Rpb24gKCkgewogICAgdmFyIGkgPSAwLCBfbnVtMmJpbj0ge30KICAgIGZvciAoOyBpIDwgMHgxMDA7ICsraSkgewogICAgICBfbnVtMmJpbltpXSA9IFN0cmluZy5mcm9tQ2hhckNvZGUoaSkgIC8vIDAgLT4gIlwwMCIKICAgIH0KICAgIHJldHVybiBfbnVtMmJpbgogIH0oKSkKCiAgLy8gc2VyaWFsaXplIGEgYmlnSW50IHRvIGFuIGFzY2lpIHN0cmluZwogIC8vIHBhZGRlZCB1cCB0byBwYWQgbGVuZ3RoCiAgZnVuY3Rpb24gYmlnSW50MmJpdHMoYmksIHBhZCkgewogICAgcGFkIHx8IChwYWQgPSAwKQogICAgYmkgPSBkdXAoYmkpCiAgICB2YXIgYmEgPSAnJwogICAgd2hpbGUgKCFpc1plcm8oYmkpKSB7CiAgICAgIGJhID0gX251bTJiaW5bYmlbMF0gJiAweGZmXSArIGJhCiAgICAgIHJpZ2h0U2hpZnRfKGJpLCA4KQogICAgfQogICAgd2hpbGUgKGJhLmxlbmd0aCA8IHBhZCkgewogICAgICBiYSA9ICdceDAwJyArIGJhCiAgICB9CiAgICByZXR1cm4gYmEKICB9CgogIC8vIGNvbnZlcnRzIGEgYnl0ZSBhcnJheSB0byBhIGJpZ0ludAogIGZ1bmN0aW9uIGJhMmJpZ0ludChkYXRhKSB7CiAgICB2YXIgbXBpID0gc3RyMmJpZ0ludCgnMCcsIDEwLCBkYXRhLmxlbmd0aCkKICAgIGRhdGEuZm9yRWFjaChmdW5jdGlvbiAoZCwgaSkgewogICAgICBpZiAoaSkgbGVmdFNoaWZ0XyhtcGksIDgpCiAgICAgIG1waVswXSB8PSBkCiAgICB9KQogICAgcmV0dXJuIG1waQogIH0KCiAgLy8gcmV0dXJucyBhIGZ1bmN0aW9uIHRoYXQgcmV0dXJucyBhbiBhcnJheSBvZiBuIGJ5dGVzCiAgdmFyIHJhbmRvbUJ5dGVzID0gKGZ1bmN0aW9uICgpIHsKCiAgICAvLyBpbiBub2RlCiAgICBpZiAoIHR5cGVvZiBjcnlwdG8gIT09ICd1bmRlZmluZWQnICYmCiAgICAgIHR5cGVvZiBjcnlwdG8ucmFuZG9tQnl0ZXMgPT09ICdmdW5jdGlvbicgKSB7CiAgICAgIHJldHVybiBmdW5jdGlvbiAobikgewogICAgICAgIHRyeSB7CiAgICAgICAgICB2YXIgYnVmID0gY3J5cHRvLnJhbmRvbUJ5dGVzKG4pCiAgICAgICAgfSBjYXRjaCAoZSkgeyB0aHJvdyBlIH0KICAgICAgICByZXR1cm4gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYnVmLCAwKQogICAgICB9CiAgICB9CgogICAgLy8gaW4gYnJvd3NlcgogICAgZWxzZSBpZiAoIHR5cGVvZiBjcnlwdG8gIT09ICd1bmRlZmluZWQnICYmCiAgICAgIHR5cGVvZiBjcnlwdG8uZ2V0UmFuZG9tVmFsdWVzID09PSAnZnVuY3Rpb24nICkgewogICAgICByZXR1cm4gZnVuY3Rpb24gKG4pIHsKICAgICAgICB2YXIgYnVmID0gbmV3IFVpbnQ4QXJyYXkobikKICAgICAgICBjcnlwdG8uZ2V0UmFuZG9tVmFsdWVzKGJ1ZikKICAgICAgICByZXR1cm4gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYnVmLCAwKQogICAgICB9CiAgICB9CgogICAgLy8gZXJyCiAgICBlbHNlIHsKICAgICAgY29uc29sZS5sb2coJ0tleXMgc2hvdWxkIG5vdCBiZSBnZW5lcmF0ZWQgd2l0aG91dCBDU1BSTkcuJyk7CiAgICAgIHJldHVybjsKICAgICAgLy8gdGhyb3cgbmV3IEVycm9yKCdLZXlzIHNob3VsZCBub3QgYmUgZ2VuZXJhdGVkIHdpdGhvdXQgQ1NQUk5HLicpCiAgICB9CgogIH0oKSkKCiAgLy8gU2Fsc2EgMjAgaW4gd2Vid29ya2VyIG5lZWRzIGEgNDAgYnl0ZSBzZWVkCiAgZnVuY3Rpb24gZ2V0U2VlZCgpIHsKICAgIHJldHVybiByYW5kb21CeXRlcyg0MCkKICB9CgogIC8vIHJldHVybnMgYSBzaW5nbGUgcmFuZG9tIGJ5dGUKICBmdW5jdGlvbiByYW5kb21CeXRlKCkgewogICAgcmV0dXJuIHJhbmRvbUJ5dGVzKDEpWzBdCiAgfQoKICAvLyByZXR1cm5zIGEgay1iaXQgcmFuZG9tIGludGVnZXIKICBmdW5jdGlvbiByYW5kb21CaXRJbnQoaykgewogICAgaWYgKGsgPiAzMSkgdGhyb3cgbmV3IEVycm9yKCJUb28gbWFueSBiaXRzLiIpCiAgICB2YXIgaSA9IDAsIHIgPSAwCiAgICB2YXIgYiA9IE1hdGguZmxvb3IoayAvIDgpCiAgICB2YXIgbWFzayA9ICgxIDw8IChrICUgOCkpIC0gMQogICAgaWYgKG1hc2spIHIgPSByYW5kb21CeXRlKCkgJiBtYXNrCiAgICBmb3IgKDsgaSA8IGI7IGkrKykKICAgICAgciA9ICgyNTYgKiByKSArIHJhbmRvbUJ5dGUoKQogICAgcmV0dXJuIHIKICB9CgogIHJldHVybiB7CiAgICAgIHN0cjJiaWdJbnQgICAgOiBzdHIyYmlnSW50CiAgICAsIGJpZ0ludDJzdHIgICAgOiBiaWdJbnQyc3RyCiAgICAsIGludDJiaWdJbnQgICAgOiBpbnQyYmlnSW50CiAgICAsIG11bHRNb2QgICAgICAgOiBtdWx0TW9kCiAgICAsIHBvd01vZCAgICAgICAgOiBwb3dNb2QKICAgICwgaW52ZXJzZU1vZCAgICA6IGludmVyc2VNb2QKICAgICwgcmFuZEJpZ0ludCAgICA6IHJhbmRCaWdJbnQKICAgICwgcmFuZEJpZ0ludF8gICA6IHJhbmRCaWdJbnRfCiAgICAsIGVxdWFscyAgICAgICAgOiBlcXVhbHMKICAgICwgZXF1YWxzSW50ICAgICA6IGVxdWFsc0ludAogICAgLCBzdWIgICAgICAgICAgIDogc3ViCiAgICAsIG1vZCAgICAgICAgICAgOiBtb2QKICAgICwgbW9kSW50ICAgICAgICA6IG1vZEludAogICAgLCBtdWx0ICAgICAgICAgIDogbXVsdAogICAgLCBkaXZJbnRfICAgICAgIDogZGl2SW50XwogICAgLCByaWdodFNoaWZ0XyAgIDogcmlnaHRTaGlmdF8KICAgICwgZHVwICAgICAgICAgICA6IGR1cAogICAgLCBncmVhdGVyICAgICAgIDogZ3JlYXRlcgogICAgLCBhZGQgICAgICAgICAgIDogYWRkCiAgICAsIGlzWmVybyAgICAgICAgOiBpc1plcm8KICAgICwgYml0U2l6ZSAgICAgICA6IGJpdFNpemUKICAgICwgbWlsbGVyUmFiaW4gICA6IG1pbGxlclJhYmluCiAgICAsIGRpdmlkZV8gICAgICAgOiBkaXZpZGVfCiAgICAsIHRyaW0gICAgICAgICAgOiB0cmltCiAgICAsIHByaW1lcyAgICAgICAgOiBwcmltZXMKICAgICwgZmluZFByaW1lcyAgICA6IGZpbmRQcmltZXMKICAgICwgZ2V0U2VlZCAgICAgICA6IGdldFNlZWQKICAgICwgZGl2TW9kICAgICAgICA6IGRpdk1vZAogICAgLCBzdWJNb2QgICAgICAgIDogc3ViTW9kCiAgICAsIHR3b1RvVGhlICAgICAgOiB0d29Ub1RoZQogICAgLCBiaWdJbnQyYml0cyAgIDogYmlnSW50MmJpdHMKICAgICwgYmEyYmlnSW50ICAgICA6IGJhMmJpZ0ludAogIH0KCn0pKQo7Ci8qIQogKiBFdmVudEVtaXR0ZXIgdjQuMi4zIC0gZ2l0LmlvL2VlCiAqIE9saXZlciBDYWxkd2VsbAogKiBNSVQgbGljZW5zZQogKiBAcHJlc2VydmUKICovCgooZnVuY3Rpb24gKCkgewoJCgoJLyoqCgkgKiBDbGFzcyBmb3IgbWFuYWdpbmcgZXZlbnRzLgoJICogQ2FuIGJlIGV4dGVuZGVkIHRvIHByb3ZpZGUgZXZlbnQgZnVuY3Rpb25hbGl0eSBpbiBvdGhlciBjbGFzc2VzLgoJICoKCSAqIEBjbGFzcyBFdmVudEVtaXR0ZXIgTWFuYWdlcyBldmVudCByZWdpc3RlcmluZyBhbmQgZW1pdHRpbmcuCgkgKi8KCWZ1bmN0aW9uIEV2ZW50RW1pdHRlcigpIHt9CgoJLy8gU2hvcnRjdXRzIHRvIGltcHJvdmUgc3BlZWQgYW5kIHNpemUKCgkvLyBFYXN5IGFjY2VzcyB0byB0aGUgcHJvdG90eXBlCgl2YXIgcHJvdG8gPSBFdmVudEVtaXR0ZXIucHJvdG90eXBlOwoKCS8qKgoJICogRmluZHMgdGhlIGluZGV4IG9mIHRoZSBsaXN0ZW5lciBmb3IgdGhlIGV2ZW50IGluIGl0J3Mgc3RvcmFnZSBhcnJheS4KCSAqCgkgKiBAcGFyYW0ge0Z1bmN0aW9uW119IGxpc3RlbmVycyBBcnJheSBvZiBsaXN0ZW5lcnMgdG8gc2VhcmNoIHRocm91Z2guCgkgKiBAcGFyYW0ge0Z1bmN0aW9ufSBsaXN0ZW5lciBNZXRob2QgdG8gbG9vayBmb3IuCgkgKiBAcmV0dXJuIHtOdW1iZXJ9IEluZGV4IG9mIHRoZSBzcGVjaWZpZWQgbGlzdGVuZXIsIC0xIGlmIG5vdCBmb3VuZAoJICogQGFwaSBwcml2YXRlCgkgKi8KCWZ1bmN0aW9uIGluZGV4T2ZMaXN0ZW5lcihsaXN0ZW5lcnMsIGxpc3RlbmVyKSB7CgkJdmFyIGkgPSBsaXN0ZW5lcnMubGVuZ3RoOwoJCXdoaWxlIChpLS0pIHsKCQkJaWYgKGxpc3RlbmVyc1tpXS5saXN0ZW5lciA9PT0gbGlzdGVuZXIpIHsKCQkJCXJldHVybiBpOwoJCQl9CgkJfQoKCQlyZXR1cm4gLTE7Cgl9CgoJLyoqCgkgKiBBbGlhcyBhIG1ldGhvZCB3aGlsZSBrZWVwaW5nIHRoZSBjb250ZXh0IGNvcnJlY3QsIHRvIGFsbG93IGZvciBvdmVyd3JpdGluZyBvZiB0YXJnZXQgbWV0aG9kLgoJICoKCSAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lIFRoZSBuYW1lIG9mIHRoZSB0YXJnZXQgbWV0aG9kLgoJICogQHJldHVybiB7RnVuY3Rpb259IFRoZSBhbGlhc2VkIG1ldGhvZAoJICogQGFwaSBwcml2YXRlCgkgKi8KCWZ1bmN0aW9uIGFsaWFzKG5hbWUpIHsKCQlyZXR1cm4gZnVuY3Rpb24gYWxpYXNDbG9zdXJlKCkgewoJCQlyZXR1cm4gdGhpc1tuYW1lXS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwoJCX07Cgl9CgoJLyoqCgkgKiBSZXR1cm5zIHRoZSBsaXN0ZW5lciBhcnJheSBmb3IgdGhlIHNwZWNpZmllZCBldmVudC4KCSAqIFdpbGwgaW5pdGlhbGlzZSB0aGUgZXZlbnQgb2JqZWN0IGFuZCBsaXN0ZW5lciBhcnJheXMgaWYgcmVxdWlyZWQuCgkgKiBXaWxsIHJldHVybiBhbiBvYmplY3QgaWYgeW91IHVzZSBhIHJlZ2V4IHNlYXJjaC4gVGhlIG9iamVjdCBjb250YWlucyBrZXlzIGZvciBlYWNoIG1hdGNoZWQgZXZlbnQuIFNvIC9iYVtyel0vIG1pZ2h0IHJldHVybiBhbiBvYmplY3QgY29udGFpbmluZyBiYXIgYW5kIGJhei4gQnV0IG9ubHkgaWYgeW91IGhhdmUgZWl0aGVyIGRlZmluZWQgdGhlbSB3aXRoIGRlZmluZUV2ZW50IG9yIGFkZGVkIHNvbWUgbGlzdGVuZXJzIHRvIHRoZW0uCgkgKiBFYWNoIHByb3BlcnR5IGluIHRoZSBvYmplY3QgcmVzcG9uc2UgaXMgYW4gYXJyYXkgb2YgbGlzdGVuZXIgZnVuY3Rpb25zLgoJICoKCSAqIEBwYXJhbSB7U3RyaW5nfFJlZ0V4cH0gZXZ0IE5hbWUgb2YgdGhlIGV2ZW50IHRvIHJldHVybiB0aGUgbGlzdGVuZXJzIGZyb20uCgkgKiBAcmV0dXJuIHtGdW5jdGlvbltdfE9iamVjdH0gQWxsIGxpc3RlbmVyIGZ1bmN0aW9ucyBmb3IgdGhlIGV2ZW50LgoJICovCglwcm90by5nZXRMaXN0ZW5lcnMgPSBmdW5jdGlvbiBnZXRMaXN0ZW5lcnMoZXZ0KSB7CgkJdmFyIGV2ZW50cyA9IHRoaXMuX2dldEV2ZW50cygpOwoJCXZhciByZXNwb25zZTsKCQl2YXIga2V5OwoKCQkvLyBSZXR1cm4gYSBjb25jYXRlbmF0ZWQgYXJyYXkgb2YgYWxsIG1hdGNoaW5nIGV2ZW50cyBpZgoJCS8vIHRoZSBzZWxlY3RvciBpcyBhIHJlZ3VsYXIgZXhwcmVzc2lvbi4KCQlpZiAodHlwZW9mIGV2dCA9PT0gJ29iamVjdCcpIHsKCQkJcmVzcG9uc2UgPSB7fTsKCQkJZm9yIChrZXkgaW4gZXZlbnRzKSB7CgkJCQlpZiAoZXZlbnRzLmhhc093blByb3BlcnR5KGtleSkgJiYgZXZ0LnRlc3Qoa2V5KSkgewoJCQkJCXJlc3BvbnNlW2tleV0gPSBldmVudHNba2V5XTsKCQkJCX0KCQkJfQoJCX0KCQllbHNlIHsKCQkJcmVzcG9uc2UgPSBldmVudHNbZXZ0XSB8fCAoZXZlbnRzW2V2dF0gPSBbXSk7CgkJfQoKCQlyZXR1cm4gcmVzcG9uc2U7Cgl9OwoKCS8qKgoJICogVGFrZXMgYSBsaXN0IG9mIGxpc3RlbmVyIG9iamVjdHMgYW5kIGZsYXR0ZW5zIGl0IGludG8gYSBsaXN0IG9mIGxpc3RlbmVyIGZ1bmN0aW9ucy4KCSAqCgkgKiBAcGFyYW0ge09iamVjdFtdfSBsaXN0ZW5lcnMgUmF3IGxpc3RlbmVyIG9iamVjdHMuCgkgKiBAcmV0dXJuIHtGdW5jdGlvbltdfSBKdXN0IHRoZSBsaXN0ZW5lciBmdW5jdGlvbnMuCgkgKi8KCXByb3RvLmZsYXR0ZW5MaXN0ZW5lcnMgPSBmdW5jdGlvbiBmbGF0dGVuTGlzdGVuZXJzKGxpc3RlbmVycykgewoJCXZhciBmbGF0TGlzdGVuZXJzID0gW107CgkJdmFyIGk7CgoJCWZvciAoaSA9IDA7IGkgPCBsaXN0ZW5lcnMubGVuZ3RoOyBpICs9IDEpIHsKCQkJZmxhdExpc3RlbmVycy5wdXNoKGxpc3RlbmVyc1tpXS5saXN0ZW5lcik7CgkJfQoKCQlyZXR1cm4gZmxhdExpc3RlbmVyczsKCX07CgoJLyoqCgkgKiBGZXRjaGVzIHRoZSByZXF1ZXN0ZWQgbGlzdGVuZXJzIHZpYSBnZXRMaXN0ZW5lcnMgYnV0IHdpbGwgYWx3YXlzIHJldHVybiB0aGUgcmVzdWx0cyBpbnNpZGUgYW4gb2JqZWN0LiBUaGlzIGlzIG1haW5seSBmb3IgaW50ZXJuYWwgdXNlIGJ1dCBvdGhlcnMgbWF5IGZpbmQgaXQgdXNlZnVsLgoJICoKCSAqIEBwYXJhbSB7U3RyaW5nfFJlZ0V4cH0gZXZ0IE5hbWUgb2YgdGhlIGV2ZW50IHRvIHJldHVybiB0aGUgbGlzdGVuZXJzIGZyb20uCgkgKiBAcmV0dXJuIHtPYmplY3R9IEFsbCBsaXN0ZW5lciBmdW5jdGlvbnMgZm9yIGFuIGV2ZW50IGluIGFuIG9iamVjdC4KCSAqLwoJcHJvdG8uZ2V0TGlzdGVuZXJzQXNPYmplY3QgPSBmdW5jdGlvbiBnZXRMaXN0ZW5lcnNBc09iamVjdChldnQpIHsKCQl2YXIgbGlzdGVuZXJzID0gdGhpcy5nZXRMaXN0ZW5lcnMoZXZ0KTsKCQl2YXIgcmVzcG9uc2U7CgoJCWlmIChsaXN0ZW5lcnMgaW5zdGFuY2VvZiBBcnJheSkgewoJCQlyZXNwb25zZSA9IHt9OwoJCQlyZXNwb25zZVtldnRdID0gbGlzdGVuZXJzOwoJCX0KCgkJcmV0dXJuIHJlc3BvbnNlIHx8IGxpc3RlbmVyczsKCX07CgoJLyoqCgkgKiBBZGRzIGEgbGlzdGVuZXIgZnVuY3Rpb24gdG8gdGhlIHNwZWNpZmllZCBldmVudC4KCSAqIFRoZSBsaXN0ZW5lciB3aWxsIG5vdCBiZSBhZGRlZCBpZiBpdCBpcyBhIGR1cGxpY2F0ZS4KCSAqIElmIHRoZSBsaXN0ZW5lciByZXR1cm5zIHRydWUgdGhlbiBpdCB3aWxsIGJlIHJlbW92ZWQgYWZ0ZXIgaXQgaXMgY2FsbGVkLgoJICogSWYgeW91IHBhc3MgYSByZWd1bGFyIGV4cHJlc3Npb24gYXMgdGhlIGV2ZW50IG5hbWUgdGhlbiB0aGUgbGlzdGVuZXIgd2lsbCBiZSBhZGRlZCB0byBhbGwgZXZlbnRzIHRoYXQgbWF0Y2ggaXQuCgkgKgoJICogQHBhcmFtIHtTdHJpbmd8UmVnRXhwfSBldnQgTmFtZSBvZiB0aGUgZXZlbnQgdG8gYXR0YWNoIHRoZSBsaXN0ZW5lciB0by4KCSAqIEBwYXJhbSB7RnVuY3Rpb259IGxpc3RlbmVyIE1ldGhvZCB0byBiZSBjYWxsZWQgd2hlbiB0aGUgZXZlbnQgaXMgZW1pdHRlZC4gSWYgdGhlIGZ1bmN0aW9uIHJldHVybnMgdHJ1ZSB0aGVuIGl0IHdpbGwgYmUgcmVtb3ZlZCBhZnRlciBjYWxsaW5nLgoJICogQHJldHVybiB7T2JqZWN0fSBDdXJyZW50IGluc3RhbmNlIG9mIEV2ZW50RW1pdHRlciBmb3IgY2hhaW5pbmcuCgkgKi8KCXByb3RvLmFkZExpc3RlbmVyID0gZnVuY3Rpb24gYWRkTGlzdGVuZXIoZXZ0LCBsaXN0ZW5lcikgewoJCXZhciBsaXN0ZW5lcnMgPSB0aGlzLmdldExpc3RlbmVyc0FzT2JqZWN0KGV2dCk7CgkJdmFyIGxpc3RlbmVySXNXcmFwcGVkID0gdHlwZW9mIGxpc3RlbmVyID09PSAnb2JqZWN0JzsKCQl2YXIga2V5OwoKCQlmb3IgKGtleSBpbiBsaXN0ZW5lcnMpIHsKCQkJaWYgKGxpc3RlbmVycy5oYXNPd25Qcm9wZXJ0eShrZXkpICYmIGluZGV4T2ZMaXN0ZW5lcihsaXN0ZW5lcnNba2V5XSwgbGlzdGVuZXIpID09PSAtMSkgewoJCQkJbGlzdGVuZXJzW2tleV0ucHVzaChsaXN0ZW5lcklzV3JhcHBlZCA/IGxpc3RlbmVyIDogewoJCQkJCWxpc3RlbmVyOiBsaXN0ZW5lciwKCQkJCQlvbmNlOiBmYWxzZQoJCQkJfSk7CgkJCX0KCQl9CgoJCXJldHVybiB0aGlzOwoJfTsKCgkvKioKCSAqIEFsaWFzIG9mIGFkZExpc3RlbmVyCgkgKi8KCXByb3RvLm9uID0gYWxpYXMoJ2FkZExpc3RlbmVyJyk7CgoJLyoqCgkgKiBTZW1pLWFsaWFzIG9mIGFkZExpc3RlbmVyLiBJdCB3aWxsIGFkZCBhIGxpc3RlbmVyIHRoYXQgd2lsbCBiZQoJICogYXV0b21hdGljYWxseSByZW1vdmVkIGFmdGVyIGl0J3MgZmlyc3QgZXhlY3V0aW9uLgoJICoKCSAqIEBwYXJhbSB7U3RyaW5nfFJlZ0V4cH0gZXZ0IE5hbWUgb2YgdGhlIGV2ZW50IHRvIGF0dGFjaCB0aGUgbGlzdGVuZXIgdG8uCgkgKiBAcGFyYW0ge0Z1bmN0aW9ufSBsaXN0ZW5lciBNZXRob2QgdG8gYmUgY2FsbGVkIHdoZW4gdGhlIGV2ZW50IGlzIGVtaXR0ZWQuIElmIHRoZSBmdW5jdGlvbiByZXR1cm5zIHRydWUgdGhlbiBpdCB3aWxsIGJlIHJlbW92ZWQgYWZ0ZXIgY2FsbGluZy4KCSAqIEByZXR1cm4ge09iamVjdH0gQ3VycmVudCBpbnN0YW5jZSBvZiBFdmVudEVtaXR0ZXIgZm9yIGNoYWluaW5nLgoJICovCglwcm90by5hZGRPbmNlTGlzdGVuZXIgPSBmdW5jdGlvbiBhZGRPbmNlTGlzdGVuZXIoZXZ0LCBsaXN0ZW5lcikgewoJCXJldHVybiB0aGlzLmFkZExpc3RlbmVyKGV2dCwgewoJCQlsaXN0ZW5lcjogbGlzdGVuZXIsCgkJCW9uY2U6IHRydWUKCQl9KTsKCX07CgoJLyoqCgkgKiBBbGlhcyBvZiBhZGRPbmNlTGlzdGVuZXIuCgkgKi8KCXByb3RvLm9uY2UgPSBhbGlhcygnYWRkT25jZUxpc3RlbmVyJyk7CgoJLyoqCgkgKiBEZWZpbmVzIGFuIGV2ZW50IG5hbWUuIFRoaXMgaXMgcmVxdWlyZWQgaWYgeW91IHdhbnQgdG8gdXNlIGEgcmVnZXggdG8gYWRkIGEgbGlzdGVuZXIgdG8gbXVsdGlwbGUgZXZlbnRzIGF0IG9uY2UuIElmIHlvdSBkb24ndCBkbyB0aGlzIHRoZW4gaG93IGRvIHlvdSBleHBlY3QgaXQgdG8ga25vdyB3aGF0IGV2ZW50IHRvIGFkZCB0bz8gU2hvdWxkIGl0IGp1c3QgYWRkIHRvIGV2ZXJ5IHBvc3NpYmxlIG1hdGNoIGZvciBhIHJlZ2V4PyBOby4gVGhhdCBpcyBzY2FyeSBhbmQgYmFkLgoJICogWW91IG5lZWQgdG8gdGVsbCBpdCB3aGF0IGV2ZW50IG5hbWVzIHNob3VsZCBiZSBtYXRjaGVkIGJ5IGEgcmVnZXguCgkgKgoJICogQHBhcmFtIHtTdHJpbmd9IGV2dCBOYW1lIG9mIHRoZSBldmVudCB0byBjcmVhdGUuCgkgKiBAcmV0dXJuIHtPYmplY3R9IEN1cnJlbnQgaW5zdGFuY2Ugb2YgRXZlbnRFbWl0dGVyIGZvciBjaGFpbmluZy4KCSAqLwoJcHJvdG8uZGVmaW5lRXZlbnQgPSBmdW5jdGlvbiBkZWZpbmVFdmVudChldnQpIHsKCQl0aGlzLmdldExpc3RlbmVycyhldnQpOwoJCXJldHVybiB0aGlzOwoJfTsKCgkvKioKCSAqIFVzZXMgZGVmaW5lRXZlbnQgdG8gZGVmaW5lIG11bHRpcGxlIGV2ZW50cy4KCSAqCgkgKiBAcGFyYW0ge1N0cmluZ1tdfSBldnRzIEFuIGFycmF5IG9mIGV2ZW50IG5hbWVzIHRvIGRlZmluZS4KCSAqIEByZXR1cm4ge09iamVjdH0gQ3VycmVudCBpbnN0YW5jZSBvZiBFdmVudEVtaXR0ZXIgZm9yIGNoYWluaW5nLgoJICovCglwcm90by5kZWZpbmVFdmVudHMgPSBmdW5jdGlvbiBkZWZpbmVFdmVudHMoZXZ0cykgewoJCWZvciAodmFyIGkgPSAwOyBpIDwgZXZ0cy5sZW5ndGg7IGkgKz0gMSkgewoJCQl0aGlzLmRlZmluZUV2ZW50KGV2dHNbaV0pOwoJCX0KCQlyZXR1cm4gdGhpczsKCX07CgoJLyoqCgkgKiBSZW1vdmVzIGEgbGlzdGVuZXIgZnVuY3Rpb24gZnJvbSB0aGUgc3BlY2lmaWVkIGV2ZW50LgoJICogV2hlbiBwYXNzZWQgYSByZWd1bGFyIGV4cHJlc3Npb24gYXMgdGhlIGV2ZW50IG5hbWUsIGl0IHdpbGwgcmVtb3ZlIHRoZSBsaXN0ZW5lciBmcm9tIGFsbCBldmVudHMgdGhhdCBtYXRjaCBpdC4KCSAqCgkgKiBAcGFyYW0ge1N0cmluZ3xSZWdFeHB9IGV2dCBOYW1lIG9mIHRoZSBldmVudCB0byByZW1vdmUgdGhlIGxpc3RlbmVyIGZyb20uCgkgKiBAcGFyYW0ge0Z1bmN0aW9ufSBsaXN0ZW5lciBNZXRob2QgdG8gcmVtb3ZlIGZyb20gdGhlIGV2ZW50LgoJICogQHJldHVybiB7T2JqZWN0fSBDdXJyZW50IGluc3RhbmNlIG9mIEV2ZW50RW1pdHRlciBmb3IgY2hhaW5pbmcuCgkgKi8KCXByb3RvLnJlbW92ZUxpc3RlbmVyID0gZnVuY3Rpb24gcmVtb3ZlTGlzdGVuZXIoZXZ0LCBsaXN0ZW5lcikgewoJCXZhciBsaXN0ZW5lcnMgPSB0aGlzLmdldExpc3RlbmVyc0FzT2JqZWN0KGV2dCk7CgkJdmFyIGluZGV4OwoJCXZhciBrZXk7CgoJCWZvciAoa2V5IGluIGxpc3RlbmVycykgewoJCQlpZiAobGlzdGVuZXJzLmhhc093blByb3BlcnR5KGtleSkpIHsKCQkJCWluZGV4ID0gaW5kZXhPZkxpc3RlbmVyKGxpc3RlbmVyc1trZXldLCBsaXN0ZW5lcik7CgoJCQkJaWYgKGluZGV4ICE9PSAtMSkgewoJCQkJCWxpc3RlbmVyc1trZXldLnNwbGljZShpbmRleCwgMSk7CgkJCQl9CgkJCX0KCQl9CgoJCXJldHVybiB0aGlzOwoJfTsKCgkvKioKCSAqIEFsaWFzIG9mIHJlbW92ZUxpc3RlbmVyCgkgKi8KCXByb3RvLm9mZiA9IGFsaWFzKCdyZW1vdmVMaXN0ZW5lcicpOwoKCS8qKgoJICogQWRkcyBsaXN0ZW5lcnMgaW4gYnVsayB1c2luZyB0aGUgbWFuaXB1bGF0ZUxpc3RlbmVycyBtZXRob2QuCgkgKiBJZiB5b3UgcGFzcyBhbiBvYmplY3QgYXMgdGhlIHNlY29uZCBhcmd1bWVudCB5b3UgY2FuIGFkZCB0byBtdWx0aXBsZSBldmVudHMgYXQgb25jZS4gVGhlIG9iamVjdCBzaG91bGQgY29udGFpbiBrZXkgdmFsdWUgcGFpcnMgb2YgZXZlbnRzIGFuZCBsaXN0ZW5lcnMgb3IgbGlzdGVuZXIgYXJyYXlzLiBZb3UgY2FuIGFsc28gcGFzcyBpdCBhbiBldmVudCBuYW1lIGFuZCBhbiBhcnJheSBvZiBsaXN0ZW5lcnMgdG8gYmUgYWRkZWQuCgkgKiBZb3UgY2FuIGFsc28gcGFzcyBpdCBhIHJlZ3VsYXIgZXhwcmVzc2lvbiB0byBhZGQgdGhlIGFycmF5IG9mIGxpc3RlbmVycyB0byBhbGwgZXZlbnRzIHRoYXQgbWF0Y2ggaXQuCgkgKiBZZWFoLCB0aGlzIGZ1bmN0aW9uIGRvZXMgcXVpdGUgYSBiaXQuIFRoYXQncyBwcm9iYWJseSBhIGJhZCB0aGluZy4KCSAqCgkgKiBAcGFyYW0ge1N0cmluZ3xPYmplY3R8UmVnRXhwfSBldnQgQW4gZXZlbnQgbmFtZSBpZiB5b3Ugd2lsbCBwYXNzIGFuIGFycmF5IG9mIGxpc3RlbmVycyBuZXh0LiBBbiBvYmplY3QgaWYgeW91IHdpc2ggdG8gYWRkIHRvIG11bHRpcGxlIGV2ZW50cyBhdCBvbmNlLgoJICogQHBhcmFtIHtGdW5jdGlvbltdfSBbbGlzdGVuZXJzXSBBbiBvcHRpb25hbCBhcnJheSBvZiBsaXN0ZW5lciBmdW5jdGlvbnMgdG8gYWRkLgoJICogQHJldHVybiB7T2JqZWN0fSBDdXJyZW50IGluc3RhbmNlIG9mIEV2ZW50RW1pdHRlciBmb3IgY2hhaW5pbmcuCgkgKi8KCXByb3RvLmFkZExpc3RlbmVycyA9IGZ1bmN0aW9uIGFkZExpc3RlbmVycyhldnQsIGxpc3RlbmVycykgewoJCS8vIFBhc3MgdGhyb3VnaCB0byBtYW5pcHVsYXRlTGlzdGVuZXJzCgkJcmV0dXJuIHRoaXMubWFuaXB1bGF0ZUxpc3RlbmVycyhmYWxzZSwgZXZ0LCBsaXN0ZW5lcnMpOwoJfTsKCgkvKioKCSAqIFJlbW92ZXMgbGlzdGVuZXJzIGluIGJ1bGsgdXNpbmcgdGhlIG1hbmlwdWxhdGVMaXN0ZW5lcnMgbWV0aG9kLgoJICogSWYgeW91IHBhc3MgYW4gb2JqZWN0IGFzIHRoZSBzZWNvbmQgYXJndW1lbnQgeW91IGNhbiByZW1vdmUgZnJvbSBtdWx0aXBsZSBldmVudHMgYXQgb25jZS4gVGhlIG9iamVjdCBzaG91bGQgY29udGFpbiBrZXkgdmFsdWUgcGFpcnMgb2YgZXZlbnRzIGFuZCBsaXN0ZW5lcnMgb3IgbGlzdGVuZXIgYXJyYXlzLgoJICogWW91IGNhbiBhbHNvIHBhc3MgaXQgYW4gZXZlbnQgbmFtZSBhbmQgYW4gYXJyYXkgb2YgbGlzdGVuZXJzIHRvIGJlIHJlbW92ZWQuCgkgKiBZb3UgY2FuIGFsc28gcGFzcyBpdCBhIHJlZ3VsYXIgZXhwcmVzc2lvbiB0byByZW1vdmUgdGhlIGxpc3RlbmVycyBmcm9tIGFsbCBldmVudHMgdGhhdCBtYXRjaCBpdC4KCSAqCgkgKiBAcGFyYW0ge1N0cmluZ3xPYmplY3R8UmVnRXhwfSBldnQgQW4gZXZlbnQgbmFtZSBpZiB5b3Ugd2lsbCBwYXNzIGFuIGFycmF5IG9mIGxpc3RlbmVycyBuZXh0LiBBbiBvYmplY3QgaWYgeW91IHdpc2ggdG8gcmVtb3ZlIGZyb20gbXVsdGlwbGUgZXZlbnRzIGF0IG9uY2UuCgkgKiBAcGFyYW0ge0Z1bmN0aW9uW119IFtsaXN0ZW5lcnNdIEFuIG9wdGlvbmFsIGFycmF5IG9mIGxpc3RlbmVyIGZ1bmN0aW9ucyB0byByZW1vdmUuCgkgKiBAcmV0dXJuIHtPYmplY3R9IEN1cnJlbnQgaW5zdGFuY2Ugb2YgRXZlbnRFbWl0dGVyIGZvciBjaGFpbmluZy4KCSAqLwoJcHJvdG8ucmVtb3ZlTGlzdGVuZXJzID0gZnVuY3Rpb24gcmVtb3ZlTGlzdGVuZXJzKGV2dCwgbGlzdGVuZXJzKSB7CgkJLy8gUGFzcyB0aHJvdWdoIHRvIG1hbmlwdWxhdGVMaXN0ZW5lcnMKCQlyZXR1cm4gdGhpcy5tYW5pcHVsYXRlTGlzdGVuZXJzKHRydWUsIGV2dCwgbGlzdGVuZXJzKTsKCX07CgoJLyoqCgkgKiBFZGl0cyBsaXN0ZW5lcnMgaW4gYnVsay4gVGhlIGFkZExpc3RlbmVycyBhbmQgcmVtb3ZlTGlzdGVuZXJzIG1ldGhvZHMgYm90aCB1c2UgdGhpcyB0byBkbyB0aGVpciBqb2IuIFlvdSBzaG91bGQgcmVhbGx5IHVzZSB0aG9zZSBpbnN0ZWFkLCB0aGlzIGlzIGEgbGl0dGxlIGxvd2VyIGxldmVsLgoJICogVGhlIGZpcnN0IGFyZ3VtZW50IHdpbGwgZGV0ZXJtaW5lIGlmIHRoZSBsaXN0ZW5lcnMgYXJlIHJlbW92ZWQgKHRydWUpIG9yIGFkZGVkIChmYWxzZSkuCgkgKiBJZiB5b3UgcGFzcyBhbiBvYmplY3QgYXMgdGhlIHNlY29uZCBhcmd1bWVudCB5b3UgY2FuIGFkZC9yZW1vdmUgZnJvbSBtdWx0aXBsZSBldmVudHMgYXQgb25jZS4gVGhlIG9iamVjdCBzaG91bGQgY29udGFpbiBrZXkgdmFsdWUgcGFpcnMgb2YgZXZlbnRzIGFuZCBsaXN0ZW5lcnMgb3IgbGlzdGVuZXIgYXJyYXlzLgoJICogWW91IGNhbiBhbHNvIHBhc3MgaXQgYW4gZXZlbnQgbmFtZSBhbmQgYW4gYXJyYXkgb2YgbGlzdGVuZXJzIHRvIGJlIGFkZGVkL3JlbW92ZWQuCgkgKiBZb3UgY2FuIGFsc28gcGFzcyBpdCBhIHJlZ3VsYXIgZXhwcmVzc2lvbiB0byBtYW5pcHVsYXRlIHRoZSBsaXN0ZW5lcnMgb2YgYWxsIGV2ZW50cyB0aGF0IG1hdGNoIGl0LgoJICoKCSAqIEBwYXJhbSB7Qm9vbGVhbn0gcmVtb3ZlIFRydWUgaWYgeW91IHdhbnQgdG8gcmVtb3ZlIGxpc3RlbmVycywgZmFsc2UgaWYgeW91IHdhbnQgdG8gYWRkLgoJICogQHBhcmFtIHtTdHJpbmd8T2JqZWN0fFJlZ0V4cH0gZXZ0IEFuIGV2ZW50IG5hbWUgaWYgeW91IHdpbGwgcGFzcyBhbiBhcnJheSBvZiBsaXN0ZW5lcnMgbmV4dC4gQW4gb2JqZWN0IGlmIHlvdSB3aXNoIHRvIGFkZC9yZW1vdmUgZnJvbSBtdWx0aXBsZSBldmVudHMgYXQgb25jZS4KCSAqIEBwYXJhbSB7RnVuY3Rpb25bXX0gW2xpc3RlbmVyc10gQW4gb3B0aW9uYWwgYXJyYXkgb2YgbGlzdGVuZXIgZnVuY3Rpb25zIHRvIGFkZC9yZW1vdmUuCgkgKiBAcmV0dXJuIHtPYmplY3R9IEN1cnJlbnQgaW5zdGFuY2Ugb2YgRXZlbnRFbWl0dGVyIGZvciBjaGFpbmluZy4KCSAqLwoJcHJvdG8ubWFuaXB1bGF0ZUxpc3RlbmVycyA9IGZ1bmN0aW9uIG1hbmlwdWxhdGVMaXN0ZW5lcnMocmVtb3ZlLCBldnQsIGxpc3RlbmVycykgewoJCXZhciBpOwoJCXZhciB2YWx1ZTsKCQl2YXIgc2luZ2xlID0gcmVtb3ZlID8gdGhpcy5yZW1vdmVMaXN0ZW5lciA6IHRoaXMuYWRkTGlzdGVuZXI7CgkJdmFyIG11bHRpcGxlID0gcmVtb3ZlID8gdGhpcy5yZW1vdmVMaXN0ZW5lcnMgOiB0aGlzLmFkZExpc3RlbmVyczsKCgkJLy8gSWYgZXZ0IGlzIGFuIG9iamVjdCB0aGVuIHBhc3MgZWFjaCBvZiBpdCdzIHByb3BlcnRpZXMgdG8gdGhpcyBtZXRob2QKCQlpZiAodHlwZW9mIGV2dCA9PT0gJ29iamVjdCcgJiYgIShldnQgaW5zdGFuY2VvZiBSZWdFeHApKSB7CgkJCWZvciAoaSBpbiBldnQpIHsKCQkJCWlmIChldnQuaGFzT3duUHJvcGVydHkoaSkgJiYgKHZhbHVlID0gZXZ0W2ldKSkgewoJCQkJCS8vIFBhc3MgdGhlIHNpbmdsZSBsaXN0ZW5lciBzdHJhaWdodCB0aHJvdWdoIHRvIHRoZSBzaW5ndWxhciBtZXRob2QKCQkJCQlpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7CgkJCQkJCXNpbmdsZS5jYWxsKHRoaXMsIGksIHZhbHVlKTsKCQkJCQl9CgkJCQkJZWxzZSB7CgkJCQkJCS8vIE90aGVyd2lzZSBwYXNzIGJhY2sgdG8gdGhlIG11bHRpcGxlIGZ1bmN0aW9uCgkJCQkJCW11bHRpcGxlLmNhbGwodGhpcywgaSwgdmFsdWUpOwoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCQllbHNlIHsKCQkJLy8gU28gZXZ0IG11c3QgYmUgYSBzdHJpbmcKCQkJLy8gQW5kIGxpc3RlbmVycyBtdXN0IGJlIGFuIGFycmF5IG9mIGxpc3RlbmVycwoJCQkvLyBMb29wIG92ZXIgaXQgYW5kIHBhc3MgZWFjaCBvbmUgdG8gdGhlIG11bHRpcGxlIG1ldGhvZAoJCQlpID0gbGlzdGVuZXJzLmxlbmd0aDsKCQkJd2hpbGUgKGktLSkgewoJCQkJc2luZ2xlLmNhbGwodGhpcywgZXZ0LCBsaXN0ZW5lcnNbaV0pOwoJCQl9CgkJfQoKCQlyZXR1cm4gdGhpczsKCX07CgoJLyoqCgkgKiBSZW1vdmVzIGFsbCBsaXN0ZW5lcnMgZnJvbSBhIHNwZWNpZmllZCBldmVudC4KCSAqIElmIHlvdSBkbyBub3Qgc3BlY2lmeSBhbiBldmVudCB0aGVuIGFsbCBsaXN0ZW5lcnMgd2lsbCBiZSByZW1vdmVkLgoJICogVGhhdCBtZWFucyBldmVyeSBldmVudCB3aWxsIGJlIGVtcHRpZWQuCgkgKiBZb3UgY2FuIGFsc28gcGFzcyBhIHJlZ2V4IHRvIHJlbW92ZSBhbGwgZXZlbnRzIHRoYXQgbWF0Y2ggaXQuCgkgKgoJICogQHBhcmFtIHtTdHJpbmd8UmVnRXhwfSBbZXZ0XSBPcHRpb25hbCBuYW1lIG9mIHRoZSBldmVudCB0byByZW1vdmUgYWxsIGxpc3RlbmVycyBmb3IuIFdpbGwgcmVtb3ZlIGZyb20gZXZlcnkgZXZlbnQgaWYgbm90IHBhc3NlZC4KCSAqIEByZXR1cm4ge09iamVjdH0gQ3VycmVudCBpbnN0YW5jZSBvZiBFdmVudEVtaXR0ZXIgZm9yIGNoYWluaW5nLgoJICovCglwcm90by5yZW1vdmVFdmVudCA9IGZ1bmN0aW9uIHJlbW92ZUV2ZW50KGV2dCkgewoJCXZhciB0eXBlID0gdHlwZW9mIGV2dDsKCQl2YXIgZXZlbnRzID0gdGhpcy5fZ2V0RXZlbnRzKCk7CgkJdmFyIGtleTsKCgkJLy8gUmVtb3ZlIGRpZmZlcmVudCB0aGluZ3MgZGVwZW5kaW5nIG9uIHRoZSBzdGF0ZSBvZiBldnQKCQlpZiAodHlwZSA9PT0gJ3N0cmluZycpIHsKCQkJLy8gUmVtb3ZlIGFsbCBsaXN0ZW5lcnMgZm9yIHRoZSBzcGVjaWZpZWQgZXZlbnQKCQkJZGVsZXRlIGV2ZW50c1tldnRdOwoJCX0KCQllbHNlIGlmICh0eXBlID09PSAnb2JqZWN0JykgewoJCQkvLyBSZW1vdmUgYWxsIGV2ZW50cyBtYXRjaGluZyB0aGUgcmVnZXguCgkJCWZvciAoa2V5IGluIGV2ZW50cykgewoJCQkJaWYgKGV2ZW50cy5oYXNPd25Qcm9wZXJ0eShrZXkpICYmIGV2dC50ZXN0KGtleSkpIHsKCQkJCQlkZWxldGUgZXZlbnRzW2tleV07CgkJCQl9CgkJCX0KCQl9CgkJZWxzZSB7CgkJCS8vIFJlbW92ZSBhbGwgbGlzdGVuZXJzIGluIGFsbCBldmVudHMKCQkJZGVsZXRlIHRoaXMuX2V2ZW50czsKCQl9CgoJCXJldHVybiB0aGlzOwoJfTsKCgkvKioKCSAqIEVtaXRzIGFuIGV2ZW50IG9mIHlvdXIgY2hvaWNlLgoJICogV2hlbiBlbWl0dGVkLCBldmVyeSBsaXN0ZW5lciBhdHRhY2hlZCB0byB0aGF0IGV2ZW50IHdpbGwgYmUgZXhlY3V0ZWQuCgkgKiBJZiB5b3UgcGFzcyB0aGUgb3B0aW9uYWwgYXJndW1lbnQgYXJyYXkgdGhlbiB0aG9zZSBhcmd1bWVudHMgd2lsbCBiZSBwYXNzZWQgdG8gZXZlcnkgbGlzdGVuZXIgdXBvbiBleGVjdXRpb24uCgkgKiBCZWNhdXNlIGl0IHVzZXMgYGFwcGx5YCwgeW91ciBhcnJheSBvZiBhcmd1bWVudHMgd2lsbCBiZSBwYXNzZWQgYXMgaWYgeW91IHdyb3RlIHRoZW0gb3V0IHNlcGFyYXRlbHkuCgkgKiBTbyB0aGV5IHdpbGwgbm90IGFycml2ZSB3aXRoaW4gdGhlIGFycmF5IG9uIHRoZSBvdGhlciBzaWRlLCB0aGV5IHdpbGwgYmUgc2VwYXJhdGUuCgkgKiBZb3UgY2FuIGFsc28gcGFzcyBhIHJlZ3VsYXIgZXhwcmVzc2lvbiB0byBlbWl0IHRvIGFsbCBldmVudHMgdGhhdCBtYXRjaCBpdC4KCSAqCgkgKiBAcGFyYW0ge1N0cmluZ3xSZWdFeHB9IGV2dCBOYW1lIG9mIHRoZSBldmVudCB0byBlbWl0IGFuZCBleGVjdXRlIGxpc3RlbmVycyBmb3IuCgkgKiBAcGFyYW0ge0FycmF5fSBbYXJnc10gT3B0aW9uYWwgYXJyYXkgb2YgYXJndW1lbnRzIHRvIGJlIHBhc3NlZCB0byBlYWNoIGxpc3RlbmVyLgoJICogQHJldHVybiB7T2JqZWN0fSBDdXJyZW50IGluc3RhbmNlIG9mIEV2ZW50RW1pdHRlciBmb3IgY2hhaW5pbmcuCgkgKi8KCXByb3RvLmVtaXRFdmVudCA9IGZ1bmN0aW9uIGVtaXRFdmVudChldnQsIGFyZ3MpIHsKCQl2YXIgbGlzdGVuZXJzID0gdGhpcy5nZXRMaXN0ZW5lcnNBc09iamVjdChldnQpOwoJCXZhciBsaXN0ZW5lcjsKCQl2YXIgaTsKCQl2YXIga2V5OwoJCXZhciByZXNwb25zZTsKCgkJZm9yIChrZXkgaW4gbGlzdGVuZXJzKSB7CgkJCWlmIChsaXN0ZW5lcnMuaGFzT3duUHJvcGVydHkoa2V5KSkgewoJCQkJaSA9IGxpc3RlbmVyc1trZXldLmxlbmd0aDsKCgkJCQl3aGlsZSAoaS0tKSB7CgkJCQkJLy8gSWYgdGhlIGxpc3RlbmVyIHJldHVybnMgdHJ1ZSB0aGVuIGl0IHNoYWxsIGJlIHJlbW92ZWQgZnJvbSB0aGUgZXZlbnQKCQkJCQkvLyBUaGUgZnVuY3Rpb24gaXMgZXhlY3V0ZWQgZWl0aGVyIHdpdGggYSBiYXNpYyBjYWxsIG9yIGFuIGFwcGx5IGlmIHRoZXJlIGlzIGFuIGFyZ3MgYXJyYXkKCQkJCQlsaXN0ZW5lciA9IGxpc3RlbmVyc1trZXldW2ldOwoKCQkJCQlpZiAobGlzdGVuZXIub25jZSA9PT0gdHJ1ZSkgewoJCQkJCQl0aGlzLnJlbW92ZUxpc3RlbmVyKGV2dCwgbGlzdGVuZXIubGlzdGVuZXIpOwoJCQkJCX0KCgkJCQkJcmVzcG9uc2UgPSBsaXN0ZW5lci5saXN0ZW5lci5hcHBseSh0aGlzLCBhcmdzIHx8IFtdKTsKCgkJCQkJaWYgKHJlc3BvbnNlID09PSB0aGlzLl9nZXRPbmNlUmV0dXJuVmFsdWUoKSkgewoJCQkJCQl0aGlzLnJlbW92ZUxpc3RlbmVyKGV2dCwgbGlzdGVuZXIubGlzdGVuZXIpOwoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCgkJcmV0dXJuIHRoaXM7Cgl9OwoKCS8qKgoJICogQWxpYXMgb2YgZW1pdEV2ZW50CgkgKi8KCXByb3RvLnRyaWdnZXIgPSBhbGlhcygnZW1pdEV2ZW50Jyk7CgoJLyoqCgkgKiBTdWJ0bHkgZGlmZmVyZW50IGZyb20gZW1pdEV2ZW50IGluIHRoYXQgaXQgd2lsbCBwYXNzIGl0cyBhcmd1bWVudHMgb24gdG8gdGhlIGxpc3RlbmVycywgYXMgb3Bwb3NlZCB0byB0YWtpbmcgYSBzaW5nbGUgYXJyYXkgb2YgYXJndW1lbnRzIHRvIHBhc3Mgb24uCgkgKiBBcyB3aXRoIGVtaXRFdmVudCwgeW91IGNhbiBwYXNzIGEgcmVnZXggaW4gcGxhY2Ugb2YgdGhlIGV2ZW50IG5hbWUgdG8gZW1pdCB0byBhbGwgZXZlbnRzIHRoYXQgbWF0Y2ggaXQuCgkgKgoJICogQHBhcmFtIHtTdHJpbmd8UmVnRXhwfSBldnQgTmFtZSBvZiB0aGUgZXZlbnQgdG8gZW1pdCBhbmQgZXhlY3V0ZSBsaXN0ZW5lcnMgZm9yLgoJICogQHBhcmFtIHsuLi4qfSBPcHRpb25hbCBhZGRpdGlvbmFsIGFyZ3VtZW50cyB0byBiZSBwYXNzZWQgdG8gZWFjaCBsaXN0ZW5lci4KCSAqIEByZXR1cm4ge09iamVjdH0gQ3VycmVudCBpbnN0YW5jZSBvZiBFdmVudEVtaXR0ZXIgZm9yIGNoYWluaW5nLgoJICovCglwcm90by5lbWl0ID0gZnVuY3Rpb24gZW1pdChldnQpIHsKCQl2YXIgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSk7CgkJcmV0dXJuIHRoaXMuZW1pdEV2ZW50KGV2dCwgYXJncyk7Cgl9OwoKCS8qKgoJICogU2V0cyB0aGUgY3VycmVudCB2YWx1ZSB0byBjaGVjayBhZ2FpbnN0IHdoZW4gZXhlY3V0aW5nIGxpc3RlbmVycy4gSWYgYQoJICogbGlzdGVuZXJzIHJldHVybiB2YWx1ZSBtYXRjaGVzIHRoZSBvbmUgc2V0IGhlcmUgdGhlbiBpdCB3aWxsIGJlIHJlbW92ZWQKCSAqIGFmdGVyIGV4ZWN1dGlvbi4gVGhpcyB2YWx1ZSBkZWZhdWx0cyB0byB0cnVlLgoJICoKCSAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIG5ldyB2YWx1ZSB0byBjaGVjayBmb3Igd2hlbiBleGVjdXRpbmcgbGlzdGVuZXJzLgoJICogQHJldHVybiB7T2JqZWN0fSBDdXJyZW50IGluc3RhbmNlIG9mIEV2ZW50RW1pdHRlciBmb3IgY2hhaW5pbmcuCgkgKi8KCXByb3RvLnNldE9uY2VSZXR1cm5WYWx1ZSA9IGZ1bmN0aW9uIHNldE9uY2VSZXR1cm5WYWx1ZSh2YWx1ZSkgewoJCXRoaXMuX29uY2VSZXR1cm5WYWx1ZSA9IHZhbHVlOwoJCXJldHVybiB0aGlzOwoJfTsKCgkvKioKCSAqIEZldGNoZXMgdGhlIGN1cnJlbnQgdmFsdWUgdG8gY2hlY2sgYWdhaW5zdCB3aGVuIGV4ZWN1dGluZyBsaXN0ZW5lcnMuIElmCgkgKiB0aGUgbGlzdGVuZXJzIHJldHVybiB2YWx1ZSBtYXRjaGVzIHRoaXMgb25lIHRoZW4gaXQgc2hvdWxkIGJlIHJlbW92ZWQKCSAqIGF1dG9tYXRpY2FsbHkuIEl0IHdpbGwgcmV0dXJuIHRydWUgYnkgZGVmYXVsdC4KCSAqCgkgKiBAcmV0dXJuIHsqfEJvb2xlYW59IFRoZSBjdXJyZW50IHZhbHVlIHRvIGNoZWNrIGZvciBvciB0aGUgZGVmYXVsdCwgdHJ1ZS4KCSAqIEBhcGkgcHJpdmF0ZQoJICovCglwcm90by5fZ2V0T25jZVJldHVyblZhbHVlID0gZnVuY3Rpb24gX2dldE9uY2VSZXR1cm5WYWx1ZSgpIHsKCQlpZiAodGhpcy5oYXNPd25Qcm9wZXJ0eSgnX29uY2VSZXR1cm5WYWx1ZScpKSB7CgkJCXJldHVybiB0aGlzLl9vbmNlUmV0dXJuVmFsdWU7CgkJfQoJCWVsc2UgewoJCQlyZXR1cm4gdHJ1ZTsKCQl9Cgl9OwoKCS8qKgoJICogRmV0Y2hlcyB0aGUgZXZlbnRzIG9iamVjdCBhbmQgY3JlYXRlcyBvbmUgaWYgcmVxdWlyZWQuCgkgKgoJICogQHJldHVybiB7T2JqZWN0fSBUaGUgZXZlbnRzIHN0b3JhZ2Ugb2JqZWN0LgoJICogQGFwaSBwcml2YXRlCgkgKi8KCXByb3RvLl9nZXRFdmVudHMgPSBmdW5jdGlvbiBfZ2V0RXZlbnRzKCkgewoJCXJldHVybiB0aGlzLl9ldmVudHMgfHwgKHRoaXMuX2V2ZW50cyA9IHt9KTsKCX07CgoJLy8gRXhwb3NlIHRoZSBjbGFzcyBlaXRoZXIgdmlhIEFNRCwgQ29tbW9uSlMgb3IgdGhlIGdsb2JhbCBvYmplY3QKCWlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHsKCQlkZWZpbmUoJ2V2ZW50ZW1pdHRlcicsW10sZnVuY3Rpb24gKCkgewoJCQlyZXR1cm4gRXZlbnRFbWl0dGVyOwoJCX0pOwoJfQoJZWxzZSBpZiAodHlwZW9mIG1vZHVsZSA9PT0gJ29iamVjdCcgJiYgbW9kdWxlLmV4cG9ydHMpewoJCW1vZHVsZS5leHBvcnRzID0gRXZlbnRFbWl0dGVyOwoJfQoJZWxzZSB7CgkJdGhpcy5FdmVudEVtaXR0ZXIgPSBFdmVudEVtaXR0ZXI7Cgl9Cn0uY2FsbCh0aGlzKSk7CgovKiEKCiAgb3RyLmpzIHYwLjIuMTIgLSAyMDE0LTA0LTE1CiAgKGMpIDIwMTQgLSBBcmxvIEJyZWF1bHQgPGFybG9scmFAZ21haWwuY29tPgogIEZyZWVseSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTVBMIHYyLjAgbGljZW5zZS4KCiAgVGhpcyBmaWxlIGlzIGNvbmNhdGVuYXRlZCBmb3IgdGhlIGJyb3dzZXIuCiAgUGxlYXNlIHNlZTogaHR0cHM6Ly9naXRodWIuY29tL2FybG9scmEvb3RyCgoqLwoKOyhmdW5jdGlvbiAocm9vdCwgZmFjdG9yeSkgewoKICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7CiAgICBkZWZpbmUoJ290cicsWwogICAgICAgICJqcXVlcnkiLAogICAgICAgICJqcXVlcnkuYnJvd3NlciIsCiAgICAgICAgImJpZ2ludCIsCiAgICAgICAgImNyeXB0byIsCiAgICAgICAgImV2ZW50ZW1pdHRlciIKICAgIF0sIGZ1bmN0aW9uICgkLCBkdW1teSwgQmlnSW50LCBDcnlwdG9KUywgRXZlbnRFbWl0dGVyKSB7CiAgICAgIGlmICgkLmJyb3dzZXIubXNpZSkgewogICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgfQogICAgICB2YXIgcm9vdCA9IHsKICAgICAgICAgIEJpZ0ludDogQmlnSW50CiAgICAgICAgLCBDcnlwdG9KUzogQ3J5cHRvSlMKICAgICAgICAsIEV2ZW50RW1pdHRlcjogRXZlbnRFbWl0dGVyCiAgICAgICAgLCBPVFI6IHt9CiAgICAgICAgLCBEU0E6IHt9CiAgICAgIH0KICAgICAgcmV0dXJuIGZhY3RvcnkuY2FsbChyb290KQogICAgfSkKICB9IGVsc2UgewogICAgcm9vdC5PVFIgPSB7fQogICAgcm9vdC5EU0EgPSB7fQogICAgZmFjdG9yeS5jYWxsKHJvb3QpCiAgfQoKfSh0aGlzLCBmdW5jdGlvbiAoKSB7Cgo7KGZ1bmN0aW9uICgpIHsKICAKCiAgdmFyIHJvb3QgPSB0aGlzCgogIHZhciBDT05TVCA9IHsKCiAgICAvLyBkaWZmaWUtaGVpbG1hbgogICAgICBOIDogJ0ZGRkZGRkZGRkZGRkZGRkZDOTBGREFBMjIxNjhDMjM0QzRDNjYyOEI4MERDMUNEMTI5MDI0RTA4OEE2N0NDNzQwMjBCQkVBNjNCMTM5QjIyNTE0QTA4Nzk4RTM0MDREREVGOTUxOUIzQ0QzQTQzMUIzMDJCMEE2REYyNUYxNDM3NEZFMTM1NkQ2RDUxQzI0NUU0ODVCNTc2NjI1RTdFQzZGNDRDNDJFOUE2MzdFRDZCMEJGRjVDQjZGNDA2QjdFREVFMzg2QkZCNUE4OTlGQTVBRTlGMjQxMTdDNEIxRkU2NDkyODY2NTFFQ0U0NUIzREMyMDA3Q0I4QTE2M0JGMDU5OERBNDgzNjFDNTVEMzlBNjkxNjNGQThGRDI0Q0Y1RjgzNjU1RDIzRENBM0FEOTYxQzYyRjM1NjIwODU1MkJCOUVENTI5MDc3MDk2OTY2RDY3MEMzNTRFNEFCQzk4MDRGMTc0NkMwOENBMjM3MzI3RkZGRkZGRkZGRkZGRkZGRicKICAgICwgRyA6ICcyJwoKICAgIC8vIG90ciBtZXNzYWdlIHN0YXRlcwogICAgLCBNU0dTVEFURV9QTEFJTlRFWFQgOiAwCiAgICAsIE1TR1NUQVRFX0VOQ1JZUFRFRCA6IDEKICAgICwgTVNHU1RBVEVfRklOSVNIRUQgIDogMgoKICAgIC8vIG90ciBhdXRoIHN0YXRlcwogICAgLCBBVVRIU1RBVEVfTk9ORSAgICAgICAgICAgICAgIDogMAogICAgLCBBVVRIU1RBVEVfQVdBSVRJTkdfREhLRVkgICAgIDogMQogICAgLCBBVVRIU1RBVEVfQVdBSVRJTkdfUkVWRUFMU0lHIDogMgogICAgLCBBVVRIU1RBVEVfQVdBSVRJTkdfU0lHICAgICAgIDogMwoKICAgIC8vIHdoaXRlc3BhY2UgdGFncwogICAgLCBXSElURVNQQUNFX1RBRyAgICA6ICdceDIwXHgwOVx4MjBceDIwXHgwOVx4MDlceDA5XHgwOVx4MjBceDA5XHgyMFx4MDlceDIwXHgwOVx4MjBceDIwJwogICAgLCBXSElURVNQQUNFX1RBR19WMiA6ICdceDIwXHgyMFx4MDlceDA5XHgyMFx4MjBceDA5XHgyMCcKICAgICwgV0hJVEVTUEFDRV9UQUdfVjMgOiAnXHgyMFx4MjBceDA5XHgwOVx4MjBceDIwXHgwOVx4MDknCgogICAgLy8gb3RyIHRhZ3MKICAgICwgT1RSX1RBRyAgICAgICA6ICc/T1RSJwogICAgLCBPVFJfVkVSU0lPTl8xIDogJ1x4MDBceDAxJwogICAgLCBPVFJfVkVSU0lPTl8yIDogJ1x4MDBceDAyJwogICAgLCBPVFJfVkVSU0lPTl8zIDogJ1x4MDBceDAzJwoKICAgIC8vIHNtcCBtYWNoaW5lIHN0YXRlcwogICAgLCBTTVBTVEFURV9FWFBFQ1QwIDogMAogICAgLCBTTVBTVEFURV9FWFBFQ1QxIDogMQogICAgLCBTTVBTVEFURV9FWFBFQ1QyIDogMgogICAgLCBTTVBTVEFURV9FWFBFQ1QzIDogMwogICAgLCBTTVBTVEFURV9FWFBFQ1Q0IDogNAoKICAgIC8vIHVuc3RhbmRhcmQgc3RhdHVzIGNvZGVzCiAgICAsIFNUQVRVU19TRU5EX1FVRVJZICA6IDAKICAgICwgU1RBVFVTX0FLRV9JTklUICAgIDogMQogICAgLCBTVEFUVVNfQUtFX1NVQ0NFU1MgOiAyCiAgICAsIFNUQVRVU19FTkRfT1RSICAgICA6IDMKCiAgfQoKICBpZiAodHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcgJiYgbW9kdWxlLmV4cG9ydHMpIHsKICAgIG1vZHVsZS5leHBvcnRzID0gQ09OU1QKICB9IGVsc2UgewogICAgcm9vdC5PVFIuQ09OU1QgPSBDT05TVAogIH0KCn0pLmNhbGwodGhpcykKOyhmdW5jdGlvbiAoKSB7CiAgCgogIHZhciByb290ID0gdGhpcwoKICB2YXIgSExQID0ge30sIENyeXB0b0pTLCBCaWdJbnQKICBpZiAodHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcgJiYgbW9kdWxlLmV4cG9ydHMpIHsKICAgIG1vZHVsZS5leHBvcnRzID0gSExQID0ge30KICAgIENyeXB0b0pTID0gcmVxdWlyZSgnLi4vdmVuZG9yL2NyeXB0by5qcycpCiAgICBCaWdJbnQgPSByZXF1aXJlKCcuLi92ZW5kb3IvYmlnaW50LmpzJykKICB9IGVsc2UgewogICAgaWYgKHJvb3QuT1RSKSByb290Lk9UUi5ITFAgPSBITFAKICAgIGlmIChyb290LkRTQSkgcm9vdC5EU0EuSExQID0gSExQCiAgICBDcnlwdG9KUyA9IHJvb3QuQ3J5cHRvSlMKICAgIEJpZ0ludCA9IHJvb3QuQmlnSW50CiAgfQoKICAvLyBkYXRhIHR5cGVzIChieXRlIGxlbmd0aHMpCiAgdmFyIERUUyA9IHsKICAgICAgQllURSAgOiAxCiAgICAsIFNIT1JUIDogMgogICAgLCBJTlQgICA6IDQKICAgICwgQ1RSICAgOiA4CiAgICAsIE1BQyAgIDogMjAKICAgICwgU0lHICAgOiA0MAogIH0KCiAgLy8gb3RyIG1lc3NhZ2Ugd3JhcHBlciBiZWdpbiBhbmQgZW5kCiAgdmFyIFdSQVBQRVJfQkVHSU4gPSAiP09UUiIKICAgICwgV1JBUFBFUl9FTkQgICA9ICIuIgoKICB2YXIgVFdPID0gQmlnSW50LnN0cjJiaWdJbnQoJzInLCAxMCkKCiAgSExQLmRlYnVnID0gZnVuY3Rpb24gKG1zZykgewogICAgLy8gdXNlZCBhcyBITFAuZGVidWcuY2FsbChjdHgsIG1zZykKICAgIGlmICggdGhpcy5kZWJ1ZyAmJgogICAgICAgICB0eXBlb2YgdGhpcy5kZWJ1ZyAhPT0gJ2Z1bmN0aW9uJyAmJgogICAgICAgICB0eXBlb2YgY29uc29sZSAhPT0gJ3VuZGVmaW5lZCcKICAgICkgY29uc29sZS5sb2cobXNnKQogIH0KCiAgSExQLmV4dGVuZCA9IGZ1bmN0aW9uIChjaGlsZCwgcGFyZW50KSB7CiAgICBmb3IgKHZhciBrZXkgaW4gcGFyZW50KSB7CiAgICAgIGlmIChPYmplY3QuaGFzT3duUHJvcGVydHkuY2FsbChwYXJlbnQsIGtleSkpCiAgICAgICAgY2hpbGRba2V5XSA9IHBhcmVudFtrZXldCiAgICB9CiAgICBmdW5jdGlvbiBDdG9yKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gY2hpbGQgfQogICAgQ3Rvci5wcm90b3R5cGUgPSBwYXJlbnQucHJvdG90eXBlCiAgICBjaGlsZC5wcm90b3R5cGUgPSBuZXcgQ3RvcigpCiAgICBjaGlsZC5fX3N1cGVyX18gPSBwYXJlbnQucHJvdG90eXBlCiAgfQoKICAvLyBjb25zdGFudC10aW1lIHN0cmluZyBjb21wYXJpc29uCiAgSExQLmNvbXBhcmUgPSBmdW5jdGlvbiAoc3RyMSwgc3RyMikgewogICAgaWYgKHN0cjEubGVuZ3RoICE9PSBzdHIyLmxlbmd0aCkKICAgICAgcmV0dXJuIGZhbHNlCiAgICB2YXIgaSA9IDAsIHJlc3VsdCA9IDAKICAgIGZvciAoOyBpIDwgc3RyMS5sZW5ndGg7IGkrKykKICAgICAgcmVzdWx0IHw9IHN0cjFbaV0uY2hhckNvZGVBdCgwKSBeIHN0cjJbaV0uY2hhckNvZGVBdCgwKQogICAgcmV0dXJuIHJlc3VsdCA9PT0gMAogIH0KCiAgSExQLnJhbmRvbUV4cG9uZW50ID0gZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIEJpZ0ludC5yYW5kQmlnSW50KDE1MzYpCiAgfQoKICBITFAuc21wSGFzaCA9IGZ1bmN0aW9uICh2ZXJzaW9uLCBmbXBpLCBzbXBpKSB7CiAgICB2YXIgc2hhMjU2ID0gQ3J5cHRvSlMuYWxnby5TSEEyNTYuY3JlYXRlKCkKICAgIHNoYTI1Ni51cGRhdGUoQ3J5cHRvSlMuZW5jLkxhdGluMS5wYXJzZShITFAucGFja0J5dGVzKHZlcnNpb24sIERUUy5CWVRFKSkpCiAgICBzaGEyNTYudXBkYXRlKENyeXB0b0pTLmVuYy5MYXRpbjEucGFyc2UoSExQLnBhY2tNUEkoZm1waSkpKQogICAgaWYgKHNtcGkpIHNoYTI1Ni51cGRhdGUoQ3J5cHRvSlMuZW5jLkxhdGluMS5wYXJzZShITFAucGFja01QSShzbXBpKSkpCiAgICB2YXIgaGFzaCA9IHNoYTI1Ni5maW5hbGl6ZSgpCiAgICByZXR1cm4gSExQLmJpdHMyYmlnSW50KGhhc2gudG9TdHJpbmcoQ3J5cHRvSlMuZW5jLkxhdGluMSkpCiAgfQoKICBITFAubWFrZU1hYyA9IGZ1bmN0aW9uIChhZXNjdHIsIG0pIHsKICAgIHZhciBwYXNzID0gQ3J5cHRvSlMuZW5jLkxhdGluMS5wYXJzZShtKQogICAgdmFyIG1hYyA9IENyeXB0b0pTLkhtYWNTSEEyNTYoQ3J5cHRvSlMuZW5jLkxhdGluMS5wYXJzZShhZXNjdHIpLCBwYXNzKQogICAgcmV0dXJuIEhMUC5tYXNrKG1hYy50b1N0cmluZyhDcnlwdG9KUy5lbmMuTGF0aW4xKSwgMCwgMTYwKQogIH0KCiAgSExQLm1ha2UxTWFjID0gZnVuY3Rpb24gKGFlc2N0ciwgbSkgewogICAgdmFyIHBhc3MgPSBDcnlwdG9KUy5lbmMuTGF0aW4xLnBhcnNlKG0pCiAgICB2YXIgbWFjID0gQ3J5cHRvSlMuSG1hY1NIQTEoQ3J5cHRvSlMuZW5jLkxhdGluMS5wYXJzZShhZXNjdHIpLCBwYXNzKQogICAgcmV0dXJuIG1hYy50b1N0cmluZyhDcnlwdG9KUy5lbmMuTGF0aW4xKQogIH0KCiAgSExQLmVuY3J5cHRBZXMgPSBmdW5jdGlvbiAobXNnLCBjLCBpdikgewogICAgdmFyIG9wdHMgPSB7CiAgICAgICAgbW9kZTogQ3J5cHRvSlMubW9kZS5DVFIKICAgICAgLCBpdjogQ3J5cHRvSlMuZW5jLkxhdGluMS5wYXJzZShpdikKICAgICAgLCBwYWRkaW5nOiBDcnlwdG9KUy5wYWQuTm9QYWRkaW5nCiAgICB9CiAgICB2YXIgYWVzY3RyID0gQ3J5cHRvSlMuQUVTLmVuY3J5cHQoCiAgICAgICAgbXNnCiAgICAgICwgQ3J5cHRvSlMuZW5jLkxhdGluMS5wYXJzZShjKQogICAgICAsIG9wdHMKICAgICkKICAgIHZhciBhZXNjdHJfZGVjb2RlZCA9IENyeXB0b0pTLmVuYy5CYXNlNjQucGFyc2UoYWVzY3RyLnRvU3RyaW5nKCkpCiAgICByZXR1cm4gQ3J5cHRvSlMuZW5jLkxhdGluMS5zdHJpbmdpZnkoYWVzY3RyX2RlY29kZWQpCiAgfQoKICBITFAuZGVjcnlwdEFlcyA9IGZ1bmN0aW9uIChtc2csIGMsIGl2KSB7CiAgICBtc2cgPSBDcnlwdG9KUy5lbmMuTGF0aW4xLnBhcnNlKG1zZykKICAgIHZhciBvcHRzID0gewogICAgICAgIG1vZGU6IENyeXB0b0pTLm1vZGUuQ1RSCiAgICAgICwgaXY6IENyeXB0b0pTLmVuYy5MYXRpbjEucGFyc2UoaXYpCiAgICAgICwgcGFkZGluZzogQ3J5cHRvSlMucGFkLk5vUGFkZGluZwogICAgfQogICAgcmV0dXJuIENyeXB0b0pTLkFFUy5kZWNyeXB0KAogICAgICAgIENyeXB0b0pTLmVuYy5CYXNlNjQuc3RyaW5naWZ5KG1zZykKICAgICAgLCBDcnlwdG9KUy5lbmMuTGF0aW4xLnBhcnNlKGMpCiAgICAgICwgb3B0cwogICAgKQogIH0KCiAgSExQLm11bHRQb3dNb2QgPSBmdW5jdGlvbiAoYSwgYiwgYywgZCwgZSkgewogICAgcmV0dXJuIEJpZ0ludC5tdWx0TW9kKEJpZ0ludC5wb3dNb2QoYSwgYiwgZSksIEJpZ0ludC5wb3dNb2QoYywgZCwgZSksIGUpCiAgfQoKICBITFAuWktQID0gZnVuY3Rpb24gKHYsIGMsIGQsIGUpIHsKICAgIHJldHVybiBCaWdJbnQuZXF1YWxzKGMsIEhMUC5zbXBIYXNoKHYsIGQsIGUpKQogIH0KCiAgLy8gZ3JlYXRlciB0aGFuLCBvciBlcXVhbAogIEhMUC5HVE9FID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgIHJldHVybiAoQmlnSW50LmVxdWFscyhhLCBiKSB8fCBCaWdJbnQuZ3JlYXRlcihhLCBiKSkKICB9CgogIEhMUC5iZXR3ZWVuID0gZnVuY3Rpb24gKHgsIGEsIGIpIHsKICAgIHJldHVybiAoQmlnSW50LmdyZWF0ZXIoeCwgYSkgJiYgQmlnSW50LmdyZWF0ZXIoYiwgeCkpCiAgfQoKICBITFAuY2hlY2tHcm91cCA9IGZ1bmN0aW9uIChnLCBOX01JTlVTXzIpIHsKICAgIHJldHVybiBITFAuR1RPRShnLCBUV08pICYmIEhMUC5HVE9FKE5fTUlOVVNfMiwgZykKICB9CgogIEhMUC5oMSA9IGZ1bmN0aW9uIChiLCBzZWNieXRlcykgewogICAgdmFyIHNoYTEgPSBDcnlwdG9KUy5hbGdvLlNIQTEuY3JlYXRlKCkKICAgIHNoYTEudXBkYXRlKENyeXB0b0pTLmVuYy5MYXRpbjEucGFyc2UoYikpCiAgICBzaGExLnVwZGF0ZShDcnlwdG9KUy5lbmMuTGF0aW4xLnBhcnNlKHNlY2J5dGVzKSkKICAgIHJldHVybiAoc2hhMS5maW5hbGl6ZSgpKS50b1N0cmluZyhDcnlwdG9KUy5lbmMuTGF0aW4xKQogIH0KCiAgSExQLmgyID0gZnVuY3Rpb24gKGIsIHNlY2J5dGVzKSB7CiAgICB2YXIgc2hhMjU2ID0gQ3J5cHRvSlMuYWxnby5TSEEyNTYuY3JlYXRlKCkKICAgIHNoYTI1Ni51cGRhdGUoQ3J5cHRvSlMuZW5jLkxhdGluMS5wYXJzZShiKSkKICAgIHNoYTI1Ni51cGRhdGUoQ3J5cHRvSlMuZW5jLkxhdGluMS5wYXJzZShzZWNieXRlcykpCiAgICByZXR1cm4gKHNoYTI1Ni5maW5hbGl6ZSgpKS50b1N0cmluZyhDcnlwdG9KUy5lbmMuTGF0aW4xKQogIH0KCiAgSExQLm1hc2sgPSBmdW5jdGlvbiAoYnl0ZXMsIHN0YXJ0LCBuKSB7CiAgICByZXR1cm4gYnl0ZXMuc3Vic3RyKHN0YXJ0IC8gOCwgbiAvIDgpCiAgfQoKICB2YXIgX3RvU3RyaW5nID0gU3RyaW5nLmZyb21DaGFyQ29kZTsKICBITFAucGFja0J5dGVzID0gZnVuY3Rpb24gKHZhbCwgYnl0ZXMpIHsKICAgIHZhbCA9IHZhbC50b1N0cmluZygxNikKICAgIHZhciBuZXgsIHJlcyA9ICcnICAvLyBiaWctZW5kaWFuLCB1bnNpZ25lZCBsb25nCiAgICBmb3IgKDsgYnl0ZXMgPiAwOyBieXRlcy0tKSB7CiAgICAgIG5leCA9IHZhbC5sZW5ndGggPyB2YWwuc3Vic3RyKC0yLCAyKSA6ICcwJwogICAgICB2YWwgPSB2YWwuc3Vic3RyKDAsIHZhbC5sZW5ndGggLSAyKQogICAgICByZXMgPSBfdG9TdHJpbmcocGFyc2VJbnQobmV4LCAxNikpICsgcmVzCiAgICB9CiAgICByZXR1cm4gcmVzCiAgfQoKICBITFAucGFja0lOVCA9IGZ1bmN0aW9uIChkKSB7CiAgICByZXR1cm4gSExQLnBhY2tCeXRlcyhkLCBEVFMuSU5UKQogIH0KCiAgSExQLnBhY2tDdHIgPSBmdW5jdGlvbiAoZCkgewogICAgcmV0dXJuIEhMUC5wYWRDdHIoSExQLnBhY2tCeXRlcyhkLCBEVFMuQ1RSKSkKICB9CgogIEhMUC5wYWRDdHIgPSBmdW5jdGlvbiAoY3RyKSB7CiAgICByZXR1cm4gY3RyICsgJ1x4MDBceDAwXHgwMFx4MDBceDAwXHgwMFx4MDBceDAwJwogIH0KCiAgSExQLnVucGFja0N0ciA9IGZ1bmN0aW9uIChkKSB7CiAgICBkID0gSExQLnRvQnl0ZUFycmF5KGQuc3Vic3RyaW5nKDAsIDgpKQogICAgcmV0dXJuIEhMUC51bnBhY2soZCkKICB9CgogIEhMUC51bnBhY2sgPSBmdW5jdGlvbiAoYXJyKSB7CiAgICB2YXIgdmFsID0gMCwgaSA9IDAsIGxlbiA9IGFyci5sZW5ndGgKICAgIGZvciAoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgdmFsID0gKHZhbCAqIDI1NikgKyBhcnJbaV0KICAgIH0KICAgIHJldHVybiB2YWwKICB9CgogIEhMUC5wYWNrRGF0YSA9IGZ1bmN0aW9uIChkKSB7CiAgICByZXR1cm4gSExQLnBhY2tJTlQoZC5sZW5ndGgpICsgZAogIH0KCiAgSExQLmJpdHMyYmlnSW50ID0gZnVuY3Rpb24gKGJpdHMpIHsKICAgIGJpdHMgPSBITFAudG9CeXRlQXJyYXkoYml0cykKICAgIHJldHVybiBCaWdJbnQuYmEyYmlnSW50KGJpdHMpCiAgfQoKICBITFAucGFja01QSSA9IGZ1bmN0aW9uIChtcGkpIHsKICAgIHJldHVybiBITFAucGFja0RhdGEoQmlnSW50LmJpZ0ludDJiaXRzKEJpZ0ludC50cmltKG1waSwgMCkpKQogIH0KCiAgSExQLnBhY2tTSE9SVCA9IGZ1bmN0aW9uIChzaG9ydCkgewogICAgcmV0dXJuIEhMUC5wYWNrQnl0ZXMoc2hvcnQsIERUUy5TSE9SVCkKICB9CgogIEhMUC51bnBhY2tTSE9SVCA9IGZ1bmN0aW9uIChzaG9ydCkgewogICAgc2hvcnQgPSBITFAudG9CeXRlQXJyYXkoc2hvcnQpCiAgICByZXR1cm4gSExQLnVucGFjayhzaG9ydCkKICB9CgogIEhMUC5wYWNrVExWID0gZnVuY3Rpb24gKHR5cGUsIHZhbHVlKSB7CiAgICByZXR1cm4gSExQLnBhY2tTSE9SVCh0eXBlKSArIEhMUC5wYWNrU0hPUlQodmFsdWUubGVuZ3RoKSArIHZhbHVlCiAgfQoKICBITFAucmVhZExlbiA9IGZ1bmN0aW9uIChtc2cpIHsKICAgIG1zZyA9IEhMUC50b0J5dGVBcnJheShtc2cuc3Vic3RyaW5nKDAsIDQpKQogICAgcmV0dXJuIEhMUC51bnBhY2sobXNnKQogIH0KCiAgSExQLnJlYWREYXRhID0gZnVuY3Rpb24gKGRhdGEpIHsKICAgIHZhciBuID0gSExQLnVucGFjayhkYXRhLnNwbGljZSgwLCA0KSkKICAgIHJldHVybiBbbiwgZGF0YV0KICB9CgogIEhMUC5yZWFkTVBJID0gZnVuY3Rpb24gKGRhdGEpIHsKICAgIGRhdGEgPSBITFAudG9CeXRlQXJyYXkoZGF0YSkKICAgIGRhdGEgPSBITFAucmVhZERhdGEoZGF0YSkKICAgIHJldHVybiBCaWdJbnQuYmEyYmlnSW50KGRhdGFbMV0pCiAgfQoKICBITFAucGFja01QSXMgPSBmdW5jdGlvbiAoYXJyKSB7CiAgICByZXR1cm4gYXJyLnJlZHVjZShmdW5jdGlvbiAocHJ2LCBjdXIpIHsKICAgICAgcmV0dXJuIHBydiArIEhMUC5wYWNrTVBJKGN1cikKICAgIH0sICcnKQogIH0KCiAgSExQLnVucGFja01QSXMgPSBmdW5jdGlvbiAobnVtLCBtcGlzKSB7CiAgICB2YXIgaSA9IDAsIGFyciA9IFtdCiAgICBmb3IgKDsgaSA8IG51bTsgaSsrKSBhcnIucHVzaCgnTVBJJykKICAgIHJldHVybiAoSExQLnNwbGl0eXBlKGFyciwgbXBpcykpLm1hcChmdW5jdGlvbiAobSkgewogICAgICByZXR1cm4gSExQLnJlYWRNUEkobSkKICAgIH0pCiAgfQoKICBITFAud3JhcE1zZyA9IGZ1bmN0aW9uIChtc2csIGZzLCB2Mywgb3VyX2l0LCB0aGVpcl9pdCkgewogICAgbXNnID0gQ3J5cHRvSlMuZW5jLkJhc2U2NC5zdHJpbmdpZnkoQ3J5cHRvSlMuZW5jLkxhdGluMS5wYXJzZShtc2cpKQogICAgbXNnID0gV1JBUFBFUl9CRUdJTiArICI6IiArIG1zZyArIFdSQVBQRVJfRU5ECgogICAgdmFyIGl0cwogICAgaWYgKHYzKSB7CiAgICAgIGl0cyA9ICd8JwogICAgICBpdHMgKz0gKEhMUC5yZWFkTGVuKG91cl9pdCkpLnRvU3RyaW5nKDE2KQogICAgICBpdHMgKz0gJ3wnCiAgICAgIGl0cyArPSAoSExQLnJlYWRMZW4odGhlaXJfaXQpKS50b1N0cmluZygxNikKICAgIH0KCiAgICBpZiAoIWZzKSByZXR1cm4gW251bGwsIG1zZ10KCiAgICB2YXIgbiA9IE1hdGguY2VpbChtc2cubGVuZ3RoIC8gZnMpCiAgICBpZiAobiA+IDY1NTM1KSByZXR1cm4gWydUb28gbWFueSBmcmFnbWVudHMnXQogICAgaWYgKG4gPT0gMSkgcmV0dXJuIFtudWxsLCBtc2ddCgogICAgdmFyIGssIGJpLCBlaSwgZnJhZywgbWYsIG1mcyA9IFtdCiAgICBmb3IgKGsgPSAxOyBrIDw9IG47IGsrKykgewogICAgICBiaSA9IChrIC0gMSkgKiBmcwogICAgICBlaSA9IGsgKiBmcwogICAgICBmcmFnID0gbXNnLnNsaWNlKGJpLCBlaSkKICAgICAgbWYgPSBXUkFQUEVSX0JFR0lOCiAgICAgIGlmICh2MykgbWYgKz0gaXRzCiAgICAgIG1mICs9ICcsJyArIGsgKyAnLCcKICAgICAgbWYgKz0gbiArICcsJwogICAgICBtZiArPSBmcmFnICsgJywnCiAgICAgIG1mcy5wdXNoKG1mKQogICAgfQoKICAgIHJldHVybiBbbnVsbCwgbWZzXQogIH0KCiAgSExQLnNwbGl0eXBlID0gZnVuY3Rpb24gc3BsaXR5cGUoYXJyLCBtc2cpIHsKICAgIHZhciBkYXRhID0gW10KICAgIGFyci5mb3JFYWNoKGZ1bmN0aW9uIChhKSB7CiAgICAgIHZhciBzdHIKICAgICAgc3dpdGNoIChhKSB7CiAgICAgICAgY2FzZSAnUFVCS0VZJzoKICAgICAgICAgIHN0ciA9IHNwbGl0eXBlKFsnU0hPUlQnLCAnTVBJJywgJ01QSScsICdNUEknLCAnTVBJJ10sIG1zZykuam9pbignJykKICAgICAgICAgIGJyZWFrCiAgICAgICAgY2FzZSAnREFUQSc6ICAvLyBmYWxscyB0aHJvdWdoCiAgICAgICAgY2FzZSAnTVBJJzoKICAgICAgICAgIHN0ciA9IG1zZy5zdWJzdHJpbmcoMCwgSExQLnJlYWRMZW4obXNnKSArIDQpCiAgICAgICAgICBicmVhawogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICBzdHIgPSBtc2cuc3Vic3RyaW5nKDAsIERUU1thXSkKICAgICAgfQogICAgICBkYXRhLnB1c2goc3RyKQogICAgICBtc2cgPSBtc2cuc3Vic3RyaW5nKHN0ci5sZW5ndGgpCiAgICB9KQogICAgcmV0dXJuIGRhdGEKICB9CgogIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9tc2dwYWNrL21zZ3BhY2stamF2YXNjcmlwdC9ibG9iL21hc3Rlci9tc2dwYWNrLmpzCgogIHZhciBfYmluMm51bSA9IChmdW5jdGlvbiAoKSB7CiAgICB2YXIgaSA9IDAsIF9iaW4ybnVtID0ge30KICAgIGZvciAoOyBpIDwgMHgxMDA7ICsraSkgewogICAgICBfYmluMm51bVtTdHJpbmcuZnJvbUNoYXJDb2RlKGkpXSA9IGkgIC8vICJcMDAiIC0+IDB4MDAKICAgIH0KICAgIGZvciAoaSA9IDB4ODA7IGkgPCAweDEwMDsgKytpKSB7ICAvLyBbV2Via2l0XVtHZWNrb10KICAgICAgX2JpbjJudW1bU3RyaW5nLmZyb21DaGFyQ29kZSgweGY3MDAgKyBpKV0gPSBpICAvLyAiXGY3ODAiIC0+IDB4ODAKICAgIH0KICAgIHJldHVybiBfYmluMm51bQogIH0oKSkKCiAgSExQLnRvQnl0ZUFycmF5ID0gZnVuY3Rpb24gKGRhdGEpIHsKICAgIHZhciBydiA9IFtdCiAgICAgICwgYXJ5ID0gZGF0YS5zcGxpdCgiIikKICAgICAgLCBpID0gLTEKICAgICAgLCBpeiA9IGFyeS5sZW5ndGgKICAgICAgLCByZW1haW4gPSBpeiAlIDgKCiAgICB3aGlsZSAocmVtYWluLS0pIHsKICAgICAgKytpCiAgICAgIHJ2W2ldID0gX2JpbjJudW1bYXJ5W2ldXQogICAgfQogICAgcmVtYWluID0gaXogPj4gMwogICAgd2hpbGUgKHJlbWFpbi0tKSB7CiAgICAgIHJ2LnB1c2goX2JpbjJudW1bYXJ5WysraV1dLCBfYmluMm51bVthcnlbKytpXV0sCiAgICAgICAgICAgICAgX2JpbjJudW1bYXJ5WysraV1dLCBfYmluMm51bVthcnlbKytpXV0sCiAgICAgICAgICAgICAgX2JpbjJudW1bYXJ5WysraV1dLCBfYmluMm51bVthcnlbKytpXV0sCiAgICAgICAgICAgICAgX2JpbjJudW1bYXJ5WysraV1dLCBfYmluMm51bVthcnlbKytpXV0pCiAgICB9CiAgICByZXR1cm4gcnYKICB9Cgp9KS5jYWxsKHRoaXMpCjsoZnVuY3Rpb24gKCkgewogIAoKICB2YXIgcm9vdCA9IHRoaXMKCiAgdmFyIENyeXB0b0pTLCBCaWdJbnQsIFdvcmtlciwgV1dQYXRoLCBITFAKICBpZiAodHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcgJiYgbW9kdWxlLmV4cG9ydHMpIHsKICAgIG1vZHVsZS5leHBvcnRzID0gRFNBCiAgICBDcnlwdG9KUyA9IHJlcXVpcmUoJy4uL3ZlbmRvci9jcnlwdG8uanMnKQogICAgQmlnSW50ID0gcmVxdWlyZSgnLi4vdmVuZG9yL2JpZ2ludC5qcycpCiAgICBXV1BhdGggPSByZXF1aXJlKCdwYXRoJykuam9pbihfX2Rpcm5hbWUsICcvZHNhLXdlYndvcmtlci5qcycpCiAgICBITFAgPSByZXF1aXJlKCcuL2hlbHBlcnMuanMnKQogIH0gZWxzZSB7CiAgICAvLyBjb3B5IG92ZXIgYW5kIGV4cG9zZSBpbnRlcm5hbHMKICAgIE9iamVjdC5rZXlzKHJvb3QuRFNBKS5mb3JFYWNoKGZ1bmN0aW9uIChrKSB7CiAgICAgIERTQVtrXSA9IHJvb3QuRFNBW2tdCiAgICB9KQogICAgcm9vdC5EU0EgPSBEU0EKICAgIENyeXB0b0pTID0gcm9vdC5DcnlwdG9KUwogICAgQmlnSW50ID0gcm9vdC5CaWdJbnQKICAgIFdvcmtlciA9IHJvb3QuV29ya2VyCiAgICBXV1BhdGggPSAnZHNhLXdlYndvcmtlci5qcycKICAgIEhMUCA9IERTQS5ITFAKICB9CgogIHZhciBaRVJPID0gQmlnSW50LnN0cjJiaWdJbnQoJzAnLCAxMCkKICAgICwgT05FID0gQmlnSW50LnN0cjJiaWdJbnQoJzEnLCAxMCkKICAgICwgVFdPID0gQmlnSW50LnN0cjJiaWdJbnQoJzInLCAxMCkKICAgICwgS0VZX1RZUEUgPSAnXHgwMFx4MDAnCgogIHZhciBERUJVRyA9IGZhbHNlCiAgZnVuY3Rpb24gdGltZXIoKSB7CiAgICB2YXIgc3RhcnQgPSAobmV3IERhdGUoKSkuZ2V0VGltZSgpCiAgICByZXR1cm4gZnVuY3Rpb24gKHMpIHsKICAgICAgaWYgKCFERUJVRyB8fCB0eXBlb2YgY29uc29sZSA9PT0gJ3VuZGVmaW5lZCcpIHJldHVybgogICAgICB2YXIgdCA9IChuZXcgRGF0ZSgpKS5nZXRUaW1lKCkKICAgICAgY29uc29sZS5sb2cocyArICc6ICcgKyAodCAtIHN0YXJ0KSkKICAgICAgc3RhcnQgPSB0CiAgICB9CiAgfQoKICBmdW5jdGlvbiBtYWtlUmFuZG9tKG1pbiwgbWF4KSB7CiAgICB2YXIgYyA9IEJpZ0ludC5yYW5kQmlnSW50KEJpZ0ludC5iaXRTaXplKG1heCkpCiAgICBpZiAoIUhMUC5iZXR3ZWVuKGMsIG1pbiwgbWF4KSkgcmV0dXJuIG1ha2VSYW5kb20obWluLCBtYXgpCiAgICByZXR1cm4gYwogIH0KCiAgLy8gYWx0ZXJlZCBCaWdJbnQucmFuZFByb2JQcmltZSgpCiAgLy8gbiByb3VuZHMgb2YgTWlsbGVyIFJhYmluIChhZnRlciB0cmlhbCBkaXZpc2lvbiB3aXRoIHNtYWxsIHByaW1lcykKICB2YXIgcnBwcmIgPSBbXQogIGZ1bmN0aW9uIGlzUHJvYlByaW1lKGssIG4pIHsKICAgIHZhciBpLCBCID0gMzAwMDAsIGwgPSBCaWdJbnQuYml0U2l6ZShrKQogICAgdmFyIHByaW1lcyA9IEJpZ0ludC5wcmltZXMKCiAgICBpZiAocHJpbWVzLmxlbmd0aCA9PT0gMCkKICAgICAgcHJpbWVzID0gQmlnSW50LmZpbmRQcmltZXMoQikKCiAgICBpZiAocnBwcmIubGVuZ3RoICE9IGsubGVuZ3RoKQogICAgICBycHByYiA9IEJpZ0ludC5kdXAoaykKCiAgICAvLyBjaGVjayBhbnMgZm9yIGRpdmlzaWJpbGl0eSBieSBzbWFsbCBwcmltZXMgdXAgdG8gQgogICAgZm9yIChpID0gMDsgKGkgPCBwcmltZXMubGVuZ3RoKSAmJiAocHJpbWVzW2ldIDw9IEIpOyBpKyspCiAgICAgIGlmIChCaWdJbnQubW9kSW50KGssIHByaW1lc1tpXSkgPT09IDAgJiYgIUJpZ0ludC5lcXVhbHNJbnQoaywgcHJpbWVzW2ldKSkKICAgICAgICByZXR1cm4gMAoKICAgIC8vIGRvIG4gcm91bmRzIG9mIE1pbGxlciBSYWJpbiwgd2l0aCByYW5kb20gYmFzZXMgbGVzcyB0aGFuIGsKICAgIGZvciAoaSA9IDA7IGkgPCBuOyBpKyspIHsKICAgICAgQmlnSW50LnJhbmRCaWdJbnRfKHJwcHJiLCBsLCAwKQogICAgICB3aGlsZSghQmlnSW50LmdyZWF0ZXIoaywgcnBwcmIpKSAgLy8gcGljayBhIHJhbmRvbSBycHByYiB0aGF0J3MgPCBrCiAgICAgICAgQmlnSW50LnJhbmRCaWdJbnRfKHJwcHJiLCBsLCAwKQogICAgICBpZiAoIUJpZ0ludC5taWxsZXJSYWJpbihrLCBycHByYikpCiAgICAgICAgcmV0dXJuIDAKICAgIH0KCiAgICByZXR1cm4gMQogIH0KCiAgdmFyIGJpdF9sZW5ndGhzID0gewogICAgICAnMTAyNCc6IHsgTjogMTYwLCByZXBlYXQ6IDQwIH0gIC8vIDQweCBzaG91bGQgZ2l2ZSAyXi04MCBjb25maWRlbmNlCiAgICAsICcyMDQ4JzogeyBOOiAyMjQsIHJlcGVhdDogNTYgfQogIH0KCiAgdmFyIHByaW1lcyA9IHt9CgogIC8vIGZvbGxvd3MgZ28gbGFuZyBodHRwOi8vZ29sYW5nLm9yZy9zcmMvcGtnL2NyeXB0by9kc2EvZHNhLmdvCiAgLy8gZmlwcyB2ZXJzaW9uIHdhcyByZW1vdmVkIGluIDBjOTlhZjBkZjNlNwogIGZ1bmN0aW9uIGdlbmVyYXRlUHJpbWVzKGJpdF9sZW5ndGgpIHsKCiAgICB2YXIgdCA9IHRpbWVyKCkgIC8vIGZvciBkZWJ1Z2dpbmcKCiAgICAvLyBudW1iZXIgb2YgTVIgdGVzdHMgdG8gcGVyZm9ybQogICAgdmFyIHJlcGVhdCA9IGJpdF9sZW5ndGhzW2JpdF9sZW5ndGhdLnJlcGVhdAoKICAgIHZhciBOID0gYml0X2xlbmd0aHNbYml0X2xlbmd0aF0uTgoKICAgIHZhciBMTTEgPSBCaWdJbnQudHdvVG9UaGUoYml0X2xlbmd0aCAtIDEpCiAgICB2YXIgYmw0ID0gNCAqIGJpdF9sZW5ndGgKICAgIHZhciBicmsgPSBmYWxzZQoKICAgIHZhciBxLCBwLCByZW0sIGNvdW50ZXIKICAgIGZvciAoOzspIHsKCiAgICAgIHEgPSBCaWdJbnQucmFuZEJpZ0ludChOLCAxKQogICAgICBxWzBdIHw9IDEKCiAgICAgIGlmICghaXNQcm9iUHJpbWUocSwgcmVwZWF0KSkgY29udGludWUKICAgICAgdCgncScpCgogICAgICBmb3IgKGNvdW50ZXIgPSAwOyBjb3VudGVyIDwgYmw0OyBjb3VudGVyKyspIHsKICAgICAgICBwID0gQmlnSW50LnJhbmRCaWdJbnQoYml0X2xlbmd0aCwgMSkKICAgICAgICBwWzBdIHw9IDEKCiAgICAgICAgcmVtID0gQmlnSW50Lm1vZChwLCBxKQogICAgICAgIHJlbSA9IEJpZ0ludC5zdWIocmVtLCBPTkUpCiAgICAgICAgcCA9IEJpZ0ludC5zdWIocCwgcmVtKQoKICAgICAgICBpZiAoQmlnSW50LmdyZWF0ZXIoTE0xLCBwKSkgY29udGludWUKICAgICAgICBpZiAoIWlzUHJvYlByaW1lKHAsIHJlcGVhdCkpIGNvbnRpbnVlCgogICAgICAgIHQoJ3AnKQogICAgICAgIHByaW1lc1tiaXRfbGVuZ3RoXSA9IHsgcDogcCwgcTogcSB9CiAgICAgICAgYnJrID0gdHJ1ZQogICAgICAgIGJyZWFrCiAgICAgIH0KCiAgICAgIGlmIChicmspIGJyZWFrCiAgICB9CgogICAgdmFyIGggPSBCaWdJbnQuZHVwKFRXTykKICAgIHZhciBwbTEgPSBCaWdJbnQuc3ViKHAsIE9ORSkKICAgIHZhciBlID0gQmlnSW50Lm11bHRNb2QocG0xLCBCaWdJbnQuaW52ZXJzZU1vZChxLCBwKSwgcCkKCiAgICB2YXIgZwogICAgZm9yICg7OykgewogICAgICBnID0gQmlnSW50LnBvd01vZChoLCBlLCBwKQogICAgICBpZiAoQmlnSW50LmVxdWFscyhnLCBPTkUpKSB7CiAgICAgICAgaCA9IEJpZ0ludC5hZGQoaCwgT05FKQogICAgICAgIGNvbnRpbnVlCiAgICAgIH0KICAgICAgcHJpbWVzW2JpdF9sZW5ndGhdLmcgPSBnCiAgICAgIHQoJ2cnKQogICAgICByZXR1cm4KICAgIH0KCiAgICB0aHJvdyBuZXcgRXJyb3IoJ1VucmVhY2hhYmxlIScpCiAgfQoKICBmdW5jdGlvbiBEU0Eob2JqLCBvcHRzKSB7CiAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgRFNBKSkgcmV0dXJuIG5ldyBEU0Eob2JqLCBvcHRzKQoKICAgIC8vIG9wdGlvbnMKICAgIG9wdHMgPSBvcHRzIHx8IHt9CgogICAgLy8gaW5oZXJpdAogICAgaWYgKG9iaikgewogICAgICB2YXIgc2VsZiA9IHRoaXMKICAgICAgO1sncCcsICdxJywgJ2cnLCAneScsICd4J10uZm9yRWFjaChmdW5jdGlvbiAocHJvcCkgewogICAgICAgIHNlbGZbcHJvcF0gPSBvYmpbcHJvcF0KICAgICAgfSkKICAgICAgdGhpcy50eXBlID0gb2JqLnR5cGUgfHwgS0VZX1RZUEUKICAgICAgcmV0dXJuCiAgICB9CgogICAgLy8gZGVmYXVsdCB0byAxMDI0CiAgICB2YXIgYml0X2xlbmd0aCA9IHBhcnNlSW50KG9wdHMuYml0X2xlbmd0aCA/IG9wdHMuYml0X2xlbmd0aCA6IDEwMjQsIDEwKQoKICAgIGlmICghYml0X2xlbmd0aHNbYml0X2xlbmd0aF0pCiAgICAgIHRocm93IG5ldyBFcnJvcignVW5zdXBwb3J0ZWQgYml0IGxlbmd0aC4nKQoKICAgIC8vIHNldCBwcmltZXMKICAgIGlmICghcHJpbWVzW2JpdF9sZW5ndGhdKQogICAgICBnZW5lcmF0ZVByaW1lcyhiaXRfbGVuZ3RoKQoKICAgIHRoaXMucCA9IHByaW1lc1tiaXRfbGVuZ3RoXS5wCiAgICB0aGlzLnEgPSBwcmltZXNbYml0X2xlbmd0aF0ucQogICAgdGhpcy5nID0gcHJpbWVzW2JpdF9sZW5ndGhdLmcKCiAgICAvLyBrZXkgdHlwZQogICAgdGhpcy50eXBlID0gS0VZX1RZUEUKCiAgICAvLyBwcml2YXRlIGtleQogICAgdGhpcy54ID0gbWFrZVJhbmRvbShaRVJPLCB0aGlzLnEpCgogICAgLy8gcHVibGljIGtleXMgKHAsIHEsIGcsIHkpCiAgICB0aGlzLnkgPSBCaWdJbnQucG93TW9kKHRoaXMuZywgdGhpcy54LCB0aGlzLnApCgogICAgLy8gbm9jYWNoZT8KICAgIGlmIChvcHRzLm5vY2FjaGUpIHByaW1lc1tiaXRfbGVuZ3RoXSA9IG51bGwKICB9CgogIERTQS5wcm90b3R5cGUgPSB7CgogICAgY29uc3RydWN0b3I6IERTQSwKCiAgICBwYWNrUHVibGljOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBzdHIgPSB0aGlzLnR5cGUKICAgICAgc3RyICs9IEhMUC5wYWNrTVBJKHRoaXMucCkKICAgICAgc3RyICs9IEhMUC5wYWNrTVBJKHRoaXMucSkKICAgICAgc3RyICs9IEhMUC5wYWNrTVBJKHRoaXMuZykKICAgICAgc3RyICs9IEhMUC5wYWNrTVBJKHRoaXMueSkKICAgICAgcmV0dXJuIHN0cgogICAgfSwKCiAgICBwYWNrUHJpdmF0ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgc3RyID0gdGhpcy5wYWNrUHVibGljKCkgKyBITFAucGFja01QSSh0aGlzLngpCiAgICAgIHN0ciA9IENyeXB0b0pTLmVuYy5MYXRpbjEucGFyc2Uoc3RyKQogICAgICByZXR1cm4gc3RyLnRvU3RyaW5nKENyeXB0b0pTLmVuYy5CYXNlNjQpCiAgICB9LAoKICAgIC8vIGh0dHA6Ly93d3cuaW1wZXJpYWx2aW9sZXQub3JnLzIwMTMvMDYvMTUvc3VkZGVuZGVhdGhlbnRyb3B5Lmh0bWwKICAgIGdlbmVyYXRlTm9uY2U6IGZ1bmN0aW9uIChtKSB7CiAgICAgIHZhciBwcml2ID0gQmlnSW50LmJpZ0ludDJiaXRzKEJpZ0ludC50cmltKHRoaXMueCwgMCkpCiAgICAgIHZhciByYW5kID0gQmlnSW50LmJpZ0ludDJiaXRzKEJpZ0ludC5yYW5kQmlnSW50KDI1NikpCgogICAgICB2YXIgc2hhMjU2ID0gQ3J5cHRvSlMuYWxnby5TSEEyNTYuY3JlYXRlKCkKICAgICAgc2hhMjU2LnVwZGF0ZShDcnlwdG9KUy5lbmMuTGF0aW4xLnBhcnNlKHByaXYpKQogICAgICBzaGEyNTYudXBkYXRlKG0pCiAgICAgIHNoYTI1Ni51cGRhdGUoQ3J5cHRvSlMuZW5jLkxhdGluMS5wYXJzZShyYW5kKSkKCiAgICAgIHZhciBoYXNoID0gc2hhMjU2LmZpbmFsaXplKCkKICAgICAgaGFzaCA9IEhMUC5iaXRzMmJpZ0ludChoYXNoLnRvU3RyaW5nKENyeXB0b0pTLmVuYy5MYXRpbjEpKQogICAgICBCaWdJbnQucmlnaHRTaGlmdF8oaGFzaCwgMjU2IC0gQmlnSW50LmJpdFNpemUodGhpcy5xKSkKCiAgICAgIHJldHVybiBITFAuYmV0d2VlbihoYXNoLCBaRVJPLCB0aGlzLnEpID8gaGFzaCA6IHRoaXMuZ2VuZXJhdGVOb25jZShtKQogICAgfSwKCiAgICBzaWduOiBmdW5jdGlvbiAobSkgewogICAgICBtID0gQ3J5cHRvSlMuZW5jLkxhdGluMS5wYXJzZShtKQogICAgICB2YXIgYiA9IEJpZ0ludC5zdHIyYmlnSW50KG0udG9TdHJpbmcoQ3J5cHRvSlMuZW5jLkhleCksIDE2KQogICAgICB2YXIgaywgciA9IFpFUk8sIHMgPSBaRVJPCiAgICAgIHdoaWxlIChCaWdJbnQuaXNaZXJvKHMpIHx8IEJpZ0ludC5pc1plcm8ocikpIHsKICAgICAgICBrID0gdGhpcy5nZW5lcmF0ZU5vbmNlKG0pCiAgICAgICAgciA9IEJpZ0ludC5tb2QoQmlnSW50LnBvd01vZCh0aGlzLmcsIGssIHRoaXMucCksIHRoaXMucSkKICAgICAgICBpZiAoQmlnSW50LmlzWmVybyhyKSkgY29udGludWUKICAgICAgICBzID0gQmlnSW50LmludmVyc2VNb2QoaywgdGhpcy5xKQogICAgICAgIHMgPSBCaWdJbnQubXVsdChzLCBCaWdJbnQuYWRkKGIsIEJpZ0ludC5tdWx0KHRoaXMueCwgcikpKQogICAgICAgIHMgPSBCaWdJbnQubW9kKHMsIHRoaXMucSkKICAgICAgfQogICAgICByZXR1cm4gW3IsIHNdCiAgICB9LAoKICAgIGZpbmdlcnByaW50OiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBwayA9IHRoaXMucGFja1B1YmxpYygpCiAgICAgIGlmICh0aGlzLnR5cGUgPT09IEtFWV9UWVBFKSBwayA9IHBrLnN1YnN0cmluZygyKQogICAgICBwayA9IENyeXB0b0pTLmVuYy5MYXRpbjEucGFyc2UocGspCiAgICAgIHJldHVybiBDcnlwdG9KUy5TSEExKHBrKS50b1N0cmluZyhDcnlwdG9KUy5lbmMuSGV4KQogICAgfQoKICB9CgogIERTQS5wYXJzZVB1YmxpYyA9IGZ1bmN0aW9uIChzdHIsIHByaXYpIHsKICAgIHZhciBmaWVsZHMgPSBbJ1NIT1JUJywgJ01QSScsICdNUEknLCAnTVBJJywgJ01QSSddCiAgICBpZiAocHJpdikgZmllbGRzLnB1c2goJ01QSScpCiAgICBzdHIgPSBITFAuc3BsaXR5cGUoZmllbGRzLCBzdHIpCiAgICB2YXIgb2JqID0gewogICAgICAgIHR5cGU6IHN0clswXQogICAgICAsIHA6IEhMUC5yZWFkTVBJKHN0clsxXSkKICAgICAgLCBxOiBITFAucmVhZE1QSShzdHJbMl0pCiAgICAgICwgZzogSExQLnJlYWRNUEkoc3RyWzNdKQogICAgICAsIHk6IEhMUC5yZWFkTVBJKHN0cls0XSkKICAgIH0KICAgIGlmIChwcml2KSBvYmoueCA9IEhMUC5yZWFkTVBJKHN0cls1XSkKICAgIHJldHVybiBuZXcgRFNBKG9iaikKICB9CgogIGZ1bmN0aW9uIHRva2VuaXplU3RyKHN0cikgewogICAgdmFyIHN0YXJ0LCBlbmQKCiAgICBzdGFydCA9IHN0ci5pbmRleE9mKCIoIikKICAgIGVuZCA9IHN0ci5sYXN0SW5kZXhPZigiKSIpCgogICAgaWYgKHN0YXJ0IDwgMCB8fCBlbmQgPCAwKQogICAgICB0aHJvdyBuZXcgRXJyb3IoIk1hbGZvcm1lZCBTLUV4cHJlc3Npb24iKQoKICAgIHN0ciA9IHN0ci5zdWJzdHJpbmcoc3RhcnQgKyAxLCBlbmQpCgogICAgdmFyIHNwbHQgPSBzdHIuc2VhcmNoKC9ccy8pCiAgICB2YXIgb2JqID0gewogICAgICAgIHR5cGU6IHN0ci5zdWJzdHJpbmcoMCwgc3BsdCkKICAgICAgLCB2YWw6IFtdCiAgICB9CgogICAgc3RyID0gc3RyLnN1YnN0cmluZyhzcGx0ICsgMSwgZW5kKQogICAgc3RhcnQgPSBzdHIuaW5kZXhPZigiKCIpCgogICAgaWYgKHN0YXJ0IDwgMCkgb2JqLnZhbC5wdXNoKHN0cikKICAgIGVsc2UgewoKICAgICAgdmFyIGksIGxlbiwgc3MsIGVzCiAgICAgIHdoaWxlIChzdGFydCA+IC0xKSB7CiAgICAgICAgaSA9IHN0YXJ0ICsgMQogICAgICAgIGxlbiA9IHN0ci5sZW5ndGgKICAgICAgICBmb3IgKHNzID0gMSwgZXMgPSAwOyBpIDwgbGVuICYmIGVzIDwgc3M7IGkrKykgewogICAgICAgICAgaWYgKHN0cltpXSA9PT0gIigiKSBzcysrCiAgICAgICAgICBpZiAoc3RyW2ldID09PSAiKSIpIGVzKysKICAgICAgICB9CiAgICAgICAgb2JqLnZhbC5wdXNoKHRva2VuaXplU3RyKHN0ci5zdWJzdHJpbmcoc3RhcnQsICsraSkpKQogICAgICAgIHN0ciA9IHN0ci5zdWJzdHJpbmcoKytpKQogICAgICAgIHN0YXJ0ID0gc3RyLmluZGV4T2YoIigiKQogICAgICB9CgogICAgfQogICAgcmV0dXJuIG9iagogIH0KCiAgZnVuY3Rpb24gcGFyc2VMaWJvdHIob2JqKSB7CiAgICBpZiAoIW9iai50eXBlKSB0aHJvdyBuZXcgRXJyb3IoIlBhcnNlIGVycm9yLiIpCgogICAgdmFyIG8sIHZhbAogICAgaWYgKG9iai50eXBlID09PSAicHJpdmtleXMiKSB7CiAgICAgIG8gPSBbXQogICAgICBvYmoudmFsLmZvckVhY2goZnVuY3Rpb24gKGkpIHsKICAgICAgICBvLnB1c2gocGFyc2VMaWJvdHIoaSkpCiAgICAgIH0pCiAgICAgIHJldHVybiBvCiAgICB9CgogICAgbyA9IHt9CiAgICBvYmoudmFsLmZvckVhY2goZnVuY3Rpb24gKGkpIHsKCiAgICAgIHZhbCA9IGkudmFsWzBdCiAgICAgIGlmICh0eXBlb2YgdmFsID09PSAic3RyaW5nIikgewoKICAgICAgICBpZiAodmFsLmluZGV4T2YoIiMiKSA9PT0gMCkgewogICAgICAgICAgdmFsID0gdmFsLnN1YnN0cmluZygxLCB2YWwubGFzdEluZGV4T2YoIiMiKSkKICAgICAgICAgIHZhbCA9IEJpZ0ludC5zdHIyYmlnSW50KHZhbCwgMTYpCiAgICAgICAgfQoKICAgICAgfSBlbHNlIHsKICAgICAgICB2YWwgPSBwYXJzZUxpYm90cihpKQogICAgICB9CgogICAgICBvW2kudHlwZV0gPSB2YWwKICAgIH0pCgogICAgcmV0dXJuIG8KICB9CgogIERTQS5wYXJzZVByaXZhdGUgPSBmdW5jdGlvbiAoc3RyLCBsaWJvdHIpIHsKICAgIGlmICghbGlib3RyKSB7CiAgICAgIHN0ciA9IENyeXB0b0pTLmVuYy5CYXNlNjQucGFyc2Uoc3RyKQogICAgICBzdHIgPSBzdHIudG9TdHJpbmcoQ3J5cHRvSlMuZW5jLkxhdGluMSkKICAgICAgcmV0dXJuIERTQS5wYXJzZVB1YmxpYyhzdHIsIHRydWUpCiAgICB9CiAgICAvLyBvbmx5IHJldHVybmluZyB0aGUgZmlyc3Qga2V5IGZvdW5kCiAgICByZXR1cm4gcGFyc2VMaWJvdHIodG9rZW5pemVTdHIoc3RyKSlbMF1bInByaXZhdGUta2V5Il0uZHNhCiAgfQoKICBEU0EudmVyaWZ5ID0gZnVuY3Rpb24gKGtleSwgbSwgciwgcykgewogICAgaWYgKCFITFAuYmV0d2VlbihyLCBaRVJPLCBrZXkucSkgfHwgIUhMUC5iZXR3ZWVuKHMsIFpFUk8sIGtleS5xKSkKICAgICAgcmV0dXJuIGZhbHNlCgogICAgdmFyIGhtID0gQ3J5cHRvSlMuZW5jLkxhdGluMS5wYXJzZShtKSAgLy8gQ3J5cHRvSlMuU0hBMShtKQogICAgaG0gPSBCaWdJbnQuc3RyMmJpZ0ludChobS50b1N0cmluZyhDcnlwdG9KUy5lbmMuSGV4KSwgMTYpCgogICAgdmFyIHcgPSBCaWdJbnQuaW52ZXJzZU1vZChzLCBrZXkucSkKICAgIHZhciB1MSA9IEJpZ0ludC5tdWx0TW9kKGhtLCB3LCBrZXkucSkKICAgIHZhciB1MiA9IEJpZ0ludC5tdWx0TW9kKHIsIHcsIGtleS5xKQoKICAgIHUxID0gQmlnSW50LnBvd01vZChrZXkuZywgdTEsIGtleS5wKQogICAgdTIgPSBCaWdJbnQucG93TW9kKGtleS55LCB1Miwga2V5LnApCgogICAgdmFyIHYgPSBCaWdJbnQubW9kKEJpZ0ludC5tdWx0TW9kKHUxLCB1Miwga2V5LnApLCBrZXkucSkKCiAgICByZXR1cm4gQmlnSW50LmVxdWFscyh2LCByKQogIH0KCiAgRFNBLmNyZWF0ZUluV2ViV29ya2VyID0gZnVuY3Rpb24gKG9wdGlvbnMsIGNiKSB7CiAgICB2YXIgb3B0cyA9IHsKICAgICAgICBwYXRoOiBXV1BhdGgKICAgICAgLCBzZWVkOiBCaWdJbnQuZ2V0U2VlZAogICAgfQogICAgaWYgKG9wdGlvbnMgJiYgdHlwZW9mIG9wdGlvbnMgPT09ICdvYmplY3QnKQogICAgICBPYmplY3Qua2V5cyhvcHRpb25zKS5mb3JFYWNoKGZ1bmN0aW9uIChrKSB7CiAgICAgICAgb3B0c1trXSA9IG9wdGlvbnNba10KICAgICAgfSkKCiAgICAvLyBsb2FkIG9wdGlvbmFsIGRlcC4gaW4gbm9kZQogICAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnICYmIG1vZHVsZS5leHBvcnRzKQogICAgICBXb3JrZXIgPSByZXF1aXJlKCd3ZWJ3b3JrZXItdGhyZWFkcycpLldvcmtlcgoKICAgIHZhciB3b3JrZXIgPSBuZXcgV29ya2VyKG9wdHMucGF0aCkKICAgIHdvcmtlci5vbm1lc3NhZ2UgPSBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgZGF0YSA9IGUuZGF0YQogICAgICBzd2l0Y2ggKGRhdGEudHlwZSkgewogICAgICAgIGNhc2UgImRlYnVnIjoKICAgICAgICAgIGlmICghREVCVUcgfHwgdHlwZW9mIGNvbnNvbGUgPT09ICd1bmRlZmluZWQnKSByZXR1cm4KICAgICAgICAgIGNvbnNvbGUubG9nKGRhdGEudmFsKQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiZGF0YSI6CiAgICAgICAgICB3b3JrZXIudGVybWluYXRlKCkKICAgICAgICAgIGNiKERTQS5wYXJzZVByaXZhdGUoZGF0YS52YWwpKQogICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiVW5yZWNvZ25pemVkIHR5cGUuIikKICAgICAgfQogICAgfQogICAgd29ya2VyLnBvc3RNZXNzYWdlKHsKICAgICAgICBzZWVkOiBvcHRzLnNlZWQoKQogICAgICAsIGltcG9ydHM6IG9wdHMuaW1wb3J0cwogICAgICAsIGRlYnVnOiBERUJVRwogICAgfSkKICB9Cgp9KS5jYWxsKHRoaXMpCjsoZnVuY3Rpb24gKCkgewogIAoKICB2YXIgcm9vdCA9IHRoaXMKCiAgdmFyIFBhcnNlID0ge30sIENyeXB0b0pTLCBDT05TVCwgSExQCiAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnICYmIG1vZHVsZS5leHBvcnRzKSB7CiAgICBtb2R1bGUuZXhwb3J0cyA9IFBhcnNlCiAgICBDcnlwdG9KUyA9IHJlcXVpcmUoJy4uL3ZlbmRvci9jcnlwdG8uanMnKQogICAgQ09OU1QgPSByZXF1aXJlKCcuL2NvbnN0LmpzJykKICAgIEhMUCA9IHJlcXVpcmUoJy4vaGVscGVycy5qcycpCiAgfSBlbHNlIHsKICAgIHJvb3QuT1RSLlBhcnNlID0gUGFyc2UKICAgIENyeXB0b0pTID0gcm9vdC5DcnlwdG9KUwogICAgQ09OU1QgPSByb290Lk9UUi5DT05TVAogICAgSExQID0gcm9vdC5PVFIuSExQCiAgfQoKICAvLyB3aGl0ZXNwYWNlIHRhZ3MKICB2YXIgdGFncyA9IHt9CiAgdGFnc1tDT05TVC5XSElURVNQQUNFX1RBR19WMl0gPSBDT05TVC5PVFJfVkVSU0lPTl8yCiAgdGFnc1tDT05TVC5XSElURVNQQUNFX1RBR19WM10gPSBDT05TVC5PVFJfVkVSU0lPTl8zCgogIFBhcnNlLnBhcnNlTXNnID0gZnVuY3Rpb24gKG90ciwgbXNnKSB7CgogICAgdmFyIHZlciA9IFtdCgogICAgLy8gaXMgdGhpcyBvdHI/CiAgICB2YXIgc3RhcnQgPSBtc2cuaW5kZXhPZihDT05TVC5PVFJfVEFHKQogICAgaWYgKCF+c3RhcnQpIHsKCiAgICAgIC8vIHJlc3RhcnQgZnJhZ21lbnRzCiAgICAgIHRoaXMuaW5pdEZyYWdtZW50KG90cikKCiAgICAgIC8vIHdoaXRlc3BhY2UgdGFncwogICAgICBpbmQgPSBtc2cuaW5kZXhPZihDT05TVC5XSElURVNQQUNFX1RBRykKCiAgICAgIGlmICh+aW5kKSB7CgogICAgICAgIG1zZyA9IG1zZy5zcGxpdCgnJykKICAgICAgICBtc2cuc3BsaWNlKGluZCwgMTYpCgogICAgICAgIHZhciB0YWcsIGxlbiA9IG1zZy5sZW5ndGgKICAgICAgICBmb3IgKDsgaW5kIDwgbGVuOykgewogICAgICAgICAgdGFnID0gbXNnLnNsaWNlKGluZCwgaW5kICsgOCkuam9pbignJykKICAgICAgICAgIGlmIChPYmplY3QuaGFzT3duUHJvcGVydHkuY2FsbCh0YWdzLCB0YWcpKSB7CiAgICAgICAgICAgIG1zZy5zcGxpY2UoaW5kLCA4KQogICAgICAgICAgICB2ZXIucHVzaCh0YWdzW3RhZ10pCiAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICB9CiAgICAgICAgICBpbmQgKz0gOAogICAgICAgIH0KCiAgICAgICAgbXNnID0gbXNnLmpvaW4oJycpCgogICAgICB9CgogICAgICByZXR1cm4geyBtc2c6IG1zZywgdmVyOiB2ZXIgfQogICAgfQoKICAgIHZhciBpbmQgPSBzdGFydCArIENPTlNULk9UUl9UQUcubGVuZ3RoCiAgICB2YXIgY29tID0gbXNnW2luZF0KCiAgICAvLyBtZXNzYWdlIGZyYWdtZW50CiAgICBpZiAoY29tID09PSAnLCcgfHwgY29tID09PSAnfCcpIHsKICAgICAgcmV0dXJuIHRoaXMubXNnRnJhZ21lbnQob3RyLCBtc2cuc3Vic3RyaW5nKGluZCArIDEpLCAoY29tID09PSAnfCcpKQogICAgfQoKICAgIHRoaXMuaW5pdEZyYWdtZW50KG90cikKCiAgICAvLyBxdWVyeSBtZXNzYWdlCiAgICBpZiAoflsnPycsICd2J10uaW5kZXhPZihjb20pKSB7CgogICAgICAvLyB2ZXJzaW9uIDEKICAgICAgaWYgKG1zZ1tpbmRdID09PSAnPycpIHsKICAgICAgICB2ZXIucHVzaChDT05TVC5PVFJfVkVSU0lPTl8xKQogICAgICAgIGluZCArPSAxCiAgICAgIH0KCiAgICAgIC8vIG90aGVyIHZlcnNpb25zCiAgICAgIHZhciB2ZXJzID0gewogICAgICAgICAgJzInOiBDT05TVC5PVFJfVkVSU0lPTl8yCiAgICAgICAgLCAnMyc6IENPTlNULk9UUl9WRVJTSU9OXzMKICAgICAgfQogICAgICB2YXIgcXMgPSBtc2cuc3Vic3RyaW5nKGluZCArIDEpCiAgICAgIHZhciBxaSA9IHFzLmluZGV4T2YoJz8nKQoKICAgICAgaWYgKHFpID49IDEpIHsKICAgICAgICBxcyA9IHFzLnN1YnN0cmluZygwLCBxaSkuc3BsaXQoJycpCiAgICAgICAgaWYgKG1zZ1tpbmRdID09PSAndicpIHsKICAgICAgICAgIHFzLmZvckVhY2goZnVuY3Rpb24gKHEpIHsKICAgICAgICAgICAgaWYgKE9iamVjdC5oYXNPd25Qcm9wZXJ0eS5jYWxsKHZlcnMsIHEpKSB2ZXIucHVzaCh2ZXJzW3FdKQogICAgICAgICAgfSkKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiB7IGNsczogJ3F1ZXJ5JywgdmVyOiB2ZXIgfQogICAgfQoKICAgIC8vIG90ciBtZXNzYWdlCiAgICBpZiAoY29tID09PSAnOicpIHsKCiAgICAgIGluZCArPSAxCgogICAgICB2YXIgaW5mbyA9IG1zZy5zdWJzdHJpbmcoaW5kLCBpbmQgKyA0KQogICAgICBpZiAoaW5mby5sZW5ndGggPCA0KSByZXR1cm4geyBtc2c6IG1zZyB9CiAgICAgIGluZm8gPSBDcnlwdG9KUy5lbmMuQmFzZTY0LnBhcnNlKGluZm8pLnRvU3RyaW5nKENyeXB0b0pTLmVuYy5MYXRpbjEpCgogICAgICB2YXIgdmVyc2lvbiA9IGluZm8uc3Vic3RyaW5nKDAsIDIpCiAgICAgIHZhciB0eXBlID0gaW5mby5zdWJzdHJpbmcoMikKCiAgICAgIC8vIHN1cHBvcnRpbmcgb3RyIHZlcnNpb25zIDIgYW5kIDMKICAgICAgaWYgKCFvdHJbJ0FMTE9XX1YnICsgSExQLnVucGFja1NIT1JUKHZlcnNpb24pXSkgcmV0dXJuIHsgbXNnOiBtc2cgfQoKICAgICAgaW5kICs9IDQKCiAgICAgIHZhciBlbmQgPSBtc2cuc3Vic3RyaW5nKGluZCkuaW5kZXhPZignLicpCiAgICAgIGlmICghfmVuZCkgcmV0dXJuIHsgbXNnOiBtc2cgfQoKICAgICAgbXNnID0gQ3J5cHRvSlMuZW5jLkJhc2U2NC5wYXJzZShtc2cuc3Vic3RyaW5nKGluZCwgaW5kICsgZW5kKSkKICAgICAgbXNnID0gQ3J5cHRvSlMuZW5jLkxhdGluMS5zdHJpbmdpZnkobXNnKQoKICAgICAgLy8gaW5zdGFuY2UgdGFncwogICAgICB2YXIgaW5zdGFuY2VfdGFncwogICAgICBpZiAodmVyc2lvbiA9PT0gQ09OU1QuT1RSX1ZFUlNJT05fMykgewogICAgICAgIGluc3RhbmNlX3RhZ3MgPSBtc2cuc3Vic3RyaW5nKDAsIDgpCiAgICAgICAgbXNnID0gbXNnLnN1YnN0cmluZyg4KQogICAgICB9CgogICAgICB2YXIgY2xzCiAgICAgIGlmICh+WydceDAyJywgJ1x4MGEnLCAnXHgxMScsICdceDEyJ10uaW5kZXhPZih0eXBlKSkgewogICAgICAgIGNscyA9ICdha2UnCiAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ1x4MDMnKSB7CiAgICAgICAgY2xzID0gJ2RhdGEnCiAgICAgIH0KCiAgICAgIHJldHVybiB7CiAgICAgICAgICB2ZXJzaW9uOiB2ZXJzaW9uCiAgICAgICAgLCB0eXBlOiB0eXBlCiAgICAgICAgLCBtc2c6IG1zZwogICAgICAgICwgY2xzOiBjbHMKICAgICAgICAsIGluc3RhbmNlX3RhZ3M6IGluc3RhbmNlX3RhZ3MKICAgICAgfQogICAgfQoKICAgIC8vIGVycm9yIG1lc3NhZ2UKICAgIGlmIChtc2cuc3Vic3RyaW5nKGluZCwgaW5kICsgNykgPT09ICcgRXJyb3I6JykgewogICAgICBpZiAob3RyLkVSUk9SX1NUQVJUX0FLRSkgewogICAgICAgIG90ci5zZW5kUXVlcnlNc2coKQogICAgICB9CiAgICAgIHJldHVybiB7IG1zZzogbXNnLnN1YnN0cmluZyhpbmQgKyA3KSwgY2xzOiAnZXJyb3InIH0KICAgIH0KCiAgICByZXR1cm4geyBtc2c6IG1zZyB9CiAgfQoKICBQYXJzZS5pbml0RnJhZ21lbnQgPSBmdW5jdGlvbiAob3RyKSB7CiAgICBvdHIuZnJhZ21lbnQgPSB7IHM6ICcnLCBqOiAwLCBrOiAwIH0KICB9CgogIFBhcnNlLm1zZ0ZyYWdtZW50ID0gZnVuY3Rpb24gKG90ciwgbXNnLCB2MykgewoKICAgIG1zZyA9IG1zZy5zcGxpdCgnLCcpCgogICAgLy8gaW5zdGFuY2UgdGFncwogICAgaWYgKHYzKSB7CiAgICAgIHZhciBpdHMgPSBtc2cuc2hpZnQoKS5zcGxpdCgnfCcpCiAgICAgIHZhciB0aGVpcl9pdCA9IEhMUC5wYWNrSU5UKHBhcnNlSW50KGl0c1swXSwgMTYpKQogICAgICB2YXIgb3VyX2l0ID0gSExQLnBhY2tJTlQocGFyc2VJbnQoaXRzWzFdLCAxNikpCiAgICAgIGlmIChvdHIuY2hlY2tJbnN0YW5jZVRhZ3ModGhlaXJfaXQgKyBvdXJfaXQpKSByZXR1cm4gIC8vIGlnbm9yZQogICAgfQoKICAgIGlmIChtc2cubGVuZ3RoIDwgNCB8fAogICAgICBpc05hTihwYXJzZUludChtc2dbMF0sIDEwKSkgfHwKICAgICAgaXNOYU4ocGFyc2VJbnQobXNnWzFdLCAxMCkpCiAgICApIHJldHVybgoKICAgIHZhciBrID0gcGFyc2VJbnQobXNnWzBdLCAxMCkKICAgIHZhciBuID0gcGFyc2VJbnQobXNnWzFdLCAxMCkKICAgIG1zZyA9IG1zZ1syXQoKICAgIGlmIChuIDwgayB8fCBuID09PSAwIHx8IGsgPT09IDApIHsKICAgICAgdGhpcy5pbml0RnJhZ21lbnQob3RyKQogICAgICByZXR1cm4KICAgIH0KCiAgICBpZiAoayA9PT0gMSkgewogICAgICB0aGlzLmluaXRGcmFnbWVudChvdHIpCiAgICAgIG90ci5mcmFnbWVudCA9IHsgazogMSwgbjogbiwgczogbXNnIH0KICAgIH0gZWxzZSBpZiAobiA9PT0gb3RyLmZyYWdtZW50Lm4gJiYgayA9PT0gKG90ci5mcmFnbWVudC5rICsgMSkpIHsKICAgICAgb3RyLmZyYWdtZW50LnMgKz0gbXNnCiAgICAgIG90ci5mcmFnbWVudC5rICs9IDEKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuaW5pdEZyYWdtZW50KG90cikKICAgIH0KCiAgICBpZiAobiA9PT0gaykgewogICAgICBtc2cgPSBvdHIuZnJhZ21lbnQucwogICAgICB0aGlzLmluaXRGcmFnbWVudChvdHIpCiAgICAgIHJldHVybiB0aGlzLnBhcnNlTXNnKG90ciwgbXNnKQogICAgfQoKICAgIHJldHVybgogIH0KCn0pLmNhbGwodGhpcykKOyhmdW5jdGlvbiAoKSB7CiAgCgogIHZhciByb290ID0gdGhpcwoKICB2YXIgQ3J5cHRvSlMsIEJpZ0ludCwgQ09OU1QsIEhMUCwgRFNBCiAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnICYmIG1vZHVsZS5leHBvcnRzKSB7CiAgICBtb2R1bGUuZXhwb3J0cyA9IEFLRQogICAgQ3J5cHRvSlMgPSByZXF1aXJlKCcuLi92ZW5kb3IvY3J5cHRvLmpzJykKICAgIEJpZ0ludCA9IHJlcXVpcmUoJy4uL3ZlbmRvci9iaWdpbnQuanMnKQogICAgQ09OU1QgPSByZXF1aXJlKCcuL2NvbnN0LmpzJykKICAgIEhMUCA9IHJlcXVpcmUoJy4vaGVscGVycy5qcycpCiAgICBEU0EgPSByZXF1aXJlKCcuL2RzYS5qcycpCiAgfSBlbHNlIHsKICAgIHJvb3QuT1RSLkFLRSA9IEFLRQogICAgQ3J5cHRvSlMgPSByb290LkNyeXB0b0pTCiAgICBCaWdJbnQgPSByb290LkJpZ0ludAogICAgQ09OU1QgPSByb290Lk9UUi5DT05TVAogICAgSExQID0gcm9vdC5PVFIuSExQCiAgICBEU0EgPSByb290LkRTQQogIH0KCiAgLy8gZGlmZmllLWhlbGxtYW4gbW9kdWx1cwogIC8vIHNlZSBncm91cCA1LCBSRkMgMzUyNgogIHZhciBOID0gQmlnSW50LnN0cjJiaWdJbnQoQ09OU1QuTiwgMTYpCiAgdmFyIE5fTUlOVVNfMiA9IEJpZ0ludC5zdWIoTiwgQmlnSW50LnN0cjJiaWdJbnQoJzInLCAxMCkpCgogIGZ1bmN0aW9uIGhNYWMoZ3gsIGd5LCBwaywga2lkLCBtKSB7CiAgICB2YXIgcGFzcyA9IENyeXB0b0pTLmVuYy5MYXRpbjEucGFyc2UobSkKICAgIHZhciBobWFjID0gQ3J5cHRvSlMuYWxnby5ITUFDLmNyZWF0ZShDcnlwdG9KUy5hbGdvLlNIQTI1NiwgcGFzcykKICAgIGhtYWMudXBkYXRlKENyeXB0b0pTLmVuYy5MYXRpbjEucGFyc2UoSExQLnBhY2tNUEkoZ3gpKSkKICAgIGhtYWMudXBkYXRlKENyeXB0b0pTLmVuYy5MYXRpbjEucGFyc2UoSExQLnBhY2tNUEkoZ3kpKSkKICAgIGhtYWMudXBkYXRlKENyeXB0b0pTLmVuYy5MYXRpbjEucGFyc2UocGspKQogICAgaG1hYy51cGRhdGUoQ3J5cHRvSlMuZW5jLkxhdGluMS5wYXJzZShraWQpKQogICAgcmV0dXJuIChobWFjLmZpbmFsaXplKCkpLnRvU3RyaW5nKENyeXB0b0pTLmVuYy5MYXRpbjEpCiAgfQoKICAvLyBBS0UgY29uc3RydWN0b3IKICBmdW5jdGlvbiBBS0Uob3RyKSB7CiAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgQUtFKSkgcmV0dXJuIG5ldyBBS0Uob3RyKQoKICAgIC8vIG90ciBpbnN0YW5jZQogICAgdGhpcy5vdHIgPSBvdHIKCiAgICAvLyBvdXIga2V5cwogICAgdGhpcy5vdXJfZGggPSBvdHIub3VyX29sZF9kaAogICAgdGhpcy5vdXJfa2V5aWQgPSBvdHIub3VyX2tleWlkIC0gMQoKICAgIC8vIHRoZWlyIGtleXMKICAgIHRoaXMudGhlaXJfeSA9IG51bGwKICAgIHRoaXMudGhlaXJfa2V5aWQgPSBudWxsCiAgICB0aGlzLnRoZWlyX3ByaXZfcGsgPSBudWxsCgogICAgLy8gc3RhdGUKICAgIHRoaXMuc3NpZCA9IG51bGwKICAgIHRoaXMudHJhbnNtaXR0ZWRSUyA9IGZhbHNlCiAgICB0aGlzLnIgPSBudWxsCgogICAgLy8gYmluZCBtZXRob2RzCiAgICB2YXIgc2VsZiA9IHRoaXMKICAgIDtbJ3NlbmRNc2cnXS5mb3JFYWNoKGZ1bmN0aW9uIChtZXRoKSB7CiAgICAgIHNlbGZbbWV0aF0gPSBzZWxmW21ldGhdLmJpbmQoc2VsZikKICAgIH0pCiAgfQoKICBBS0UucHJvdG90eXBlID0gewoKICAgIGNvbnN0cnVjdG9yOiBBS0UsCgogICAgY3JlYXRlS2V5czogZnVuY3Rpb24oZykgewogICAgICB2YXIgcyA9IEJpZ0ludC5wb3dNb2QoZywgdGhpcy5vdXJfZGgucHJpdmF0ZUtleSwgTikKICAgICAgdmFyIHNlY2J5dGVzID0gSExQLnBhY2tNUEkocykKICAgICAgdGhpcy5zc2lkID0gSExQLm1hc2soSExQLmgyKCdceDAwJywgc2VjYnl0ZXMpLCAwLCA2NCkgIC8vIGZpcnN0IDY0LWJpdHMKICAgICAgdmFyIHRtcCA9IEhMUC5oMignXHgwMScsIHNlY2J5dGVzKQogICAgICB0aGlzLmMgPSBITFAubWFzayh0bXAsIDAsIDEyOCkgIC8vIGZpcnN0IDEyOC1iaXRzCiAgICAgIHRoaXMuY19wcmltZSA9IEhMUC5tYXNrKHRtcCwgMTI4LCAxMjgpICAvLyBzZWNvbmQgMTI4LWJpdHMKICAgICAgdGhpcy5tMSA9IEhMUC5oMignXHgwMicsIHNlY2J5dGVzKQogICAgICB0aGlzLm0yID0gSExQLmgyKCdceDAzJywgc2VjYnl0ZXMpCiAgICAgIHRoaXMubTFfcHJpbWUgPSBITFAuaDIoJ1x4MDQnLCBzZWNieXRlcykKICAgICAgdGhpcy5tMl9wcmltZSA9IEhMUC5oMignXHgwNScsIHNlY2J5dGVzKQogICAgfSwKCiAgICB2ZXJpZnlTaWduTWFjOiBmdW5jdGlvbiAobWFjLCBhZXNjdHIsIG0yLCBjLCB0aGVpcl95LCBvdXJfZGhfcGssIG0xLCBjdHIpIHsKICAgICAgLy8gdmVyaWZ5IG1hYwogICAgICB2YXIgdm1hYyA9IEhMUC5tYWtlTWFjKGFlc2N0ciwgbTIpCiAgICAgIGlmICghSExQLmNvbXBhcmUobWFjLCB2bWFjKSkKICAgICAgICByZXR1cm4gWydNQUNzIGRvIG5vdCBtYXRjaC4nXQoKICAgICAgLy8gZGVjcnlwdCB4CiAgICAgIHZhciB4ID0gSExQLmRlY3J5cHRBZXMoYWVzY3RyLnN1YnN0cmluZyg0KSwgYywgY3RyKQogICAgICB4ID0gSExQLnNwbGl0eXBlKFsnUFVCS0VZJywgJ0lOVCcsICdTSUcnXSwgeC50b1N0cmluZyhDcnlwdG9KUy5lbmMuTGF0aW4xKSkKCiAgICAgIHZhciBtID0gaE1hYyh0aGVpcl95LCBvdXJfZGhfcGssIHhbMF0sIHhbMV0sIG0xKQogICAgICB2YXIgcHViID0gRFNBLnBhcnNlUHVibGljKHhbMF0pCgogICAgICB2YXIgciA9IEhMUC5iaXRzMmJpZ0ludCh4WzJdLnN1YnN0cmluZygwLCAyMCkpCiAgICAgIHZhciBzID0gSExQLmJpdHMyYmlnSW50KHhbMl0uc3Vic3RyaW5nKDIwKSkKCiAgICAgIC8vIHZlcmlmeSBzaWduIG0KICAgICAgaWYgKCFEU0EudmVyaWZ5KHB1YiwgbSwgciwgcykpIHJldHVybiBbJ0Nhbm5vdCB2ZXJpZnkgc2lnbmF0dXJlIG9mIG0uJ10KCiAgICAgIHJldHVybiBbbnVsbCwgSExQLnJlYWRMZW4oeFsxXSksIHB1Yl0KICAgIH0sCgogICAgbWFrZU06IGZ1bmN0aW9uICh0aGVpcl95LCBtMSwgYywgbTIpIHsKICAgICAgdmFyIHBrID0gdGhpcy5vdHIucHJpdi5wYWNrUHVibGljKCkKICAgICAgdmFyIGtpZCA9IEhMUC5wYWNrSU5UKHRoaXMub3VyX2tleWlkKQogICAgICB2YXIgbSA9IGhNYWModGhpcy5vdXJfZGgucHVibGljS2V5LCB0aGVpcl95LCBwaywga2lkLCBtMSkKICAgICAgbSA9IHRoaXMub3RyLnByaXYuc2lnbihtKQogICAgICB2YXIgbXNnID0gcGsgKyBraWQKICAgICAgbXNnICs9IEJpZ0ludC5iaWdJbnQyYml0cyhtWzBdLCAyMCkgIC8vIHBhZCB0byAyMCBieXRlcwogICAgICBtc2cgKz0gQmlnSW50LmJpZ0ludDJiaXRzKG1bMV0sIDIwKQogICAgICBtc2cgPSBDcnlwdG9KUy5lbmMuTGF0aW4xLnBhcnNlKG1zZykKICAgICAgdmFyIGFlc2N0ciA9IEhMUC5wYWNrRGF0YShITFAuZW5jcnlwdEFlcyhtc2csIGMsIEhMUC5wYWNrQ3RyKDApKSkKICAgICAgdmFyIG1hYyA9IEhMUC5tYWtlTWFjKGFlc2N0ciwgbTIpCiAgICAgIHJldHVybiBhZXNjdHIgKyBtYWMKICAgIH0sCgogICAgYWtlU3VjY2VzczogZnVuY3Rpb24gKHZlcnNpb24pIHsKICAgICAgSExQLmRlYnVnLmNhbGwodGhpcy5vdHIsICdzdWNjZXNzJykKCiAgICAgIGlmIChCaWdJbnQuZXF1YWxzKHRoaXMudGhlaXJfeSwgdGhpcy5vdXJfZGgucHVibGljS2V5KSkKICAgICAgICByZXR1cm4gdGhpcy5vdHIuZXJyb3IoJ2VxdWFsIGtleXMgLSB3ZSBoYXZlIGEgcHJvYmxlbS4nLCB0cnVlKQoKICAgICAgdGhpcy5vdHIub3VyX29sZF9kaCA9IHRoaXMub3VyX2RoCiAgICAgIHRoaXMub3RyLnRoZWlyX3ByaXZfcGsgPSB0aGlzLnRoZWlyX3ByaXZfcGsKCiAgICAgIGlmICghKAogICAgICAgICh0aGlzLnRoZWlyX2tleWlkID09PSB0aGlzLm90ci50aGVpcl9rZXlpZCAmJgogICAgICAgICBCaWdJbnQuZXF1YWxzKHRoaXMudGhlaXJfeSwgdGhpcy5vdHIudGhlaXJfeSkpIHx8CiAgICAgICAgKHRoaXMudGhlaXJfa2V5aWQgPT09ICh0aGlzLm90ci50aGVpcl9rZXlpZCAtIDEpICYmCiAgICAgICAgIEJpZ0ludC5lcXVhbHModGhpcy50aGVpcl95LCB0aGlzLm90ci50aGVpcl9vbGRfeSkpCiAgICAgICkpIHsKCiAgICAgICAgdGhpcy5vdHIudGhlaXJfeSA9IHRoaXMudGhlaXJfeQogICAgICAgIHRoaXMub3RyLnRoZWlyX29sZF95ID0gbnVsbAogICAgICAgIHRoaXMub3RyLnRoZWlyX2tleWlkID0gdGhpcy50aGVpcl9rZXlpZAoKICAgICAgICAvLyByb3RhdGUga2V5cwogICAgICAgIHRoaXMub3RyLnNlc3NLZXlzWzBdID0gWyBuZXcgdGhpcy5vdHIuREhTZXNzaW9uKAogICAgICAgICAgICB0aGlzLm90ci5vdXJfZGgKICAgICAgICAgICwgdGhpcy5vdHIudGhlaXJfeQogICAgICAgICksIG51bGwgXQogICAgICAgIHRoaXMub3RyLnNlc3NLZXlzWzFdID0gWyBuZXcgdGhpcy5vdHIuREhTZXNzaW9uKAogICAgICAgICAgICB0aGlzLm90ci5vdXJfb2xkX2RoCiAgICAgICAgICAsIHRoaXMub3RyLnRoZWlyX3kKICAgICAgICApLCBudWxsIF0KCiAgICAgIH0KCiAgICAgIC8vIGFrZSBpbmZvCiAgICAgIHRoaXMub3RyLnNzaWQgPSB0aGlzLnNzaWQKICAgICAgdGhpcy5vdHIudHJhbnNtaXR0ZWRSUyA9IHRoaXMudHJhbnNtaXR0ZWRSUwogICAgICB0aGlzLm90cl92ZXJzaW9uID0gdmVyc2lvbgoKICAgICAgLy8gZ28gZW5jcnlwdGVkCiAgICAgIHRoaXMub3RyLmF1dGhzdGF0ZSA9IENPTlNULkFVVEhTVEFURV9OT05FCiAgICAgIHRoaXMub3RyLm1zZ3N0YXRlID0gQ09OU1QuTVNHU1RBVEVfRU5DUllQVEVECgogICAgICAvLyBudWxsIG91dCB2YWx1ZXMKICAgICAgdGhpcy5yID0gbnVsbAogICAgICB0aGlzLm15aGFzaGVkID0gbnVsbAogICAgICB0aGlzLmRoY29tbWl0ID0gbnVsbAogICAgICB0aGlzLmVuY3J5cHRlZCA9IG51bGwKICAgICAgdGhpcy5oYXNoZWQgPSBudWxsCgogICAgICB0aGlzLm90ci50cmlnZ2VyKCdzdGF0dXMnLCBbQ09OU1QuU1RBVFVTX0FLRV9TVUNDRVNTXSkKCiAgICAgIC8vIHNlbmQgc3RvcmVkIG1zZ3MKICAgICAgdGhpcy5vdHIuc2VuZFN0b3JlZCgpCiAgICB9LAoKICAgIGhhbmRsZUFLRTogZnVuY3Rpb24gKG1zZykgewogICAgICB2YXIgc2VuZCwgdnNtLCB0eXBlCiAgICAgIHZhciB2ZXJzaW9uID0gbXNnLnZlcnNpb24KCiAgICAgIHN3aXRjaCAobXNnLnR5cGUpIHsKCiAgICAgICAgY2FzZSAnXHgwMic6CiAgICAgICAgICBITFAuZGVidWcuY2FsbCh0aGlzLm90ciwgJ2QtaCBrZXkgbWVzc2FnZScpCgogICAgICAgICAgbXNnID0gSExQLnNwbGl0eXBlKFsnREFUQScsICdEQVRBJ10sIG1zZy5tc2cpCgogICAgICAgICAgaWYgKHRoaXMub3RyLmF1dGhzdGF0ZSA9PT0gQ09OU1QuQVVUSFNUQVRFX0FXQUlUSU5HX0RIS0VZKSB7CiAgICAgICAgICAgIHZhciBvdXJIYXNoID0gSExQLnJlYWRNUEkodGhpcy5teWhhc2hlZCkKICAgICAgICAgICAgdmFyIHRoZWlySGFzaCA9IEhMUC5yZWFkTVBJKG1zZ1sxXSkKICAgICAgICAgICAgaWYgKEJpZ0ludC5ncmVhdGVyKG91ckhhc2gsIHRoZWlySGFzaCkpIHsKICAgICAgICAgICAgICB0eXBlID0gJ1x4MDInCiAgICAgICAgICAgICAgc2VuZCA9IHRoaXMuZGhjb21taXQKICAgICAgICAgICAgICBicmVhayAgLy8gaWdub3JlCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgLy8gZm9yZ2V0CiAgICAgICAgICAgICAgdGhpcy5vdXJfZGggPSB0aGlzLm90ci5kaCgpCiAgICAgICAgICAgICAgdGhpcy5vdHIuYXV0aHN0YXRlID0gQ09OU1QuQVVUSFNUQVRFX05PTkUKICAgICAgICAgICAgICB0aGlzLnIgPSBudWxsCiAgICAgICAgICAgICAgdGhpcy5teWhhc2hlZCA9IG51bGwKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIGlmICgKICAgICAgICAgICAgdGhpcy5vdHIuYXV0aHN0YXRlID09PSBDT05TVC5BVVRIU1RBVEVfQVdBSVRJTkdfU0lHCiAgICAgICAgICApIHRoaXMub3VyX2RoID0gdGhpcy5vdHIuZGgoKQoKICAgICAgICAgIHRoaXMub3RyLmF1dGhzdGF0ZSA9IENPTlNULkFVVEhTVEFURV9BV0FJVElOR19SRVZFQUxTSUcKCiAgICAgICAgICB0aGlzLmVuY3J5cHRlZCA9IG1zZ1swXS5zdWJzdHJpbmcoNCkKICAgICAgICAgIHRoaXMuaGFzaGVkID0gbXNnWzFdLnN1YnN0cmluZyg0KQoKICAgICAgICAgIHR5cGUgPSAnXHgwYScKICAgICAgICAgIHNlbmQgPSBITFAucGFja01QSSh0aGlzLm91cl9kaC5wdWJsaWNLZXkpCiAgICAgICAgICBicmVhawoKICAgICAgICBjYXNlICdceDBhJzoKICAgICAgICAgIEhMUC5kZWJ1Zy5jYWxsKHRoaXMub3RyLCAncmV2ZWFsIHNpZ25hdHVyZSBtZXNzYWdlJykKCiAgICAgICAgICBtc2cgPSBITFAuc3BsaXR5cGUoWydNUEknXSwgbXNnLm1zZykKCiAgICAgICAgICBpZiAodGhpcy5vdHIuYXV0aHN0YXRlICE9PSBDT05TVC5BVVRIU1RBVEVfQVdBSVRJTkdfREhLRVkpIHsKICAgICAgICAgICAgaWYgKHRoaXMub3RyLmF1dGhzdGF0ZSA9PT0gQ09OU1QuQVVUSFNUQVRFX0FXQUlUSU5HX1NJRykgewogICAgICAgICAgICAgIGlmICghQmlnSW50LmVxdWFscyh0aGlzLnRoZWlyX3ksIEhMUC5yZWFkTVBJKG1zZ1swXSkpKSByZXR1cm4KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByZXR1cm4gIC8vIGlnbm9yZQogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5vdHIuYXV0aHN0YXRlID0gQ09OU1QuQVVUSFNUQVRFX0FXQUlUSU5HX1NJRwoKICAgICAgICAgIHRoaXMudGhlaXJfeSA9IEhMUC5yZWFkTVBJKG1zZ1swXSkKCiAgICAgICAgICAvLyB2ZXJpZnkgZ3kgaXMgbGVnYWwgMiA8PSBneSA8PSBOLTIKICAgICAgICAgIGlmICghSExQLmNoZWNrR3JvdXAodGhpcy50aGVpcl95LCBOX01JTlVTXzIpKQogICAgICAgICAgICByZXR1cm4gdGhpcy5vdHIuZXJyb3IoJ0lsbGVnYWwgZ155LicsIHRydWUpCgogICAgICAgICAgdGhpcy5jcmVhdGVLZXlzKHRoaXMudGhlaXJfeSkKCiAgICAgICAgICB0eXBlID0gJ1x4MTEnCiAgICAgICAgICBzZW5kID0gSExQLnBhY2tNUEkodGhpcy5yKQogICAgICAgICAgc2VuZCArPSB0aGlzLm1ha2VNKHRoaXMudGhlaXJfeSwgdGhpcy5tMSwgdGhpcy5jLCB0aGlzLm0yKQoKICAgICAgICAgIHRoaXMubTEgPSBudWxsCiAgICAgICAgICB0aGlzLm0yID0gbnVsbAogICAgICAgICAgdGhpcy5jID0gbnVsbAogICAgICAgICAgYnJlYWsKCiAgICAgICAgY2FzZSAnXHgxMSc6CiAgICAgICAgICBITFAuZGVidWcuY2FsbCh0aGlzLm90ciwgJ3NpZ25hdHVyZSBtZXNzYWdlJykKCiAgICAgICAgICBpZiAodGhpcy5vdHIuYXV0aHN0YXRlICE9PSBDT05TVC5BVVRIU1RBVEVfQVdBSVRJTkdfUkVWRUFMU0lHKQogICAgICAgICAgICByZXR1cm4gIC8vIGlnbm9yZQoKICAgICAgICAgIG1zZyA9IEhMUC5zcGxpdHlwZShbJ0RBVEEnLCAnREFUQScsICdNQUMnXSwgbXNnLm1zZykKCiAgICAgICAgICB0aGlzLnIgPSBITFAucmVhZE1QSShtc2dbMF0pCgogICAgICAgICAgLy8gZGVjcnlwdCB0aGVpcl95CiAgICAgICAgICB2YXIga2V5ID0gQ3J5cHRvSlMuZW5jLkhleC5wYXJzZShCaWdJbnQuYmlnSW50MnN0cih0aGlzLnIsIDE2KSkKICAgICAgICAgIGtleSA9IENyeXB0b0pTLmVuYy5MYXRpbjEuc3RyaW5naWZ5KGtleSkKCiAgICAgICAgICB2YXIgZ3htcGkgPSBITFAuZGVjcnlwdEFlcyh0aGlzLmVuY3J5cHRlZCwga2V5LCBITFAucGFja0N0cigwKSkKICAgICAgICAgIGd4bXBpID0gZ3htcGkudG9TdHJpbmcoQ3J5cHRvSlMuZW5jLkxhdGluMSkKCiAgICAgICAgICB0aGlzLnRoZWlyX3kgPSBITFAucmVhZE1QSShneG1waSkKCiAgICAgICAgICAvLyB2ZXJpZnkgaGFzaAogICAgICAgICAgdmFyIGhhc2ggPSBDcnlwdG9KUy5TSEEyNTYoQ3J5cHRvSlMuZW5jLkxhdGluMS5wYXJzZShneG1waSkpCgogICAgICAgICAgaWYgKCFITFAuY29tcGFyZSh0aGlzLmhhc2hlZCwgaGFzaC50b1N0cmluZyhDcnlwdG9KUy5lbmMuTGF0aW4xKSkpCiAgICAgICAgICAgIHJldHVybiB0aGlzLm90ci5lcnJvcignSGFzaGVkIGdeeCBkb2VzIG5vdCBtYXRjaC4nLCB0cnVlKQoKICAgICAgICAgIC8vIHZlcmlmeSBneCBpcyBsZWdhbCAyIDw9IGdeeCA8PSBOLTIKICAgICAgICAgIGlmICghSExQLmNoZWNrR3JvdXAodGhpcy50aGVpcl95LCBOX01JTlVTXzIpKQogICAgICAgICAgICByZXR1cm4gdGhpcy5vdHIuZXJyb3IoJ0lsbGVnYWwgZ154LicsIHRydWUpCgogICAgICAgICAgdGhpcy5jcmVhdGVLZXlzKHRoaXMudGhlaXJfeSkKCiAgICAgICAgICB2c20gPSB0aGlzLnZlcmlmeVNpZ25NYWMoCiAgICAgICAgICAgICAgbXNnWzJdCiAgICAgICAgICAgICwgbXNnWzFdCiAgICAgICAgICAgICwgdGhpcy5tMgogICAgICAgICAgICAsIHRoaXMuYwogICAgICAgICAgICAsIHRoaXMudGhlaXJfeQogICAgICAgICAgICAsIHRoaXMub3VyX2RoLnB1YmxpY0tleQogICAgICAgICAgICAsIHRoaXMubTEKICAgICAgICAgICAgLCBITFAucGFja0N0cigwKQogICAgICAgICAgKQogICAgICAgICAgaWYgKHZzbVswXSkgcmV0dXJuIHRoaXMub3RyLmVycm9yKHZzbVswXSwgdHJ1ZSkKCiAgICAgICAgICAvLyBzdG9yZSB0aGVpciBrZXkKICAgICAgICAgIHRoaXMudGhlaXJfa2V5aWQgPSB2c21bMV0KICAgICAgICAgIHRoaXMudGhlaXJfcHJpdl9wayA9IHZzbVsyXQoKICAgICAgICAgIHNlbmQgPSB0aGlzLm1ha2VNKAogICAgICAgICAgICAgIHRoaXMudGhlaXJfeQogICAgICAgICAgICAsIHRoaXMubTFfcHJpbWUKICAgICAgICAgICAgLCB0aGlzLmNfcHJpbWUKICAgICAgICAgICAgLCB0aGlzLm0yX3ByaW1lCiAgICAgICAgICApCgogICAgICAgICAgdGhpcy5tMSA9IG51bGwKICAgICAgICAgIHRoaXMubTIgPSBudWxsCiAgICAgICAgICB0aGlzLm0xX3ByaW1lID0gbnVsbAogICAgICAgICAgdGhpcy5tMl9wcmltZSA9IG51bGwKICAgICAgICAgIHRoaXMuYyA9IG51bGwKICAgICAgICAgIHRoaXMuY19wcmltZSA9IG51bGwKCiAgICAgICAgICB0aGlzLnNlbmRNc2codmVyc2lvbiwgJ1x4MTInLCBzZW5kKQogICAgICAgICAgdGhpcy5ha2VTdWNjZXNzKHZlcnNpb24pCiAgICAgICAgICByZXR1cm4KCiAgICAgICAgY2FzZSAnXHgxMic6CiAgICAgICAgICBITFAuZGVidWcuY2FsbCh0aGlzLm90ciwgJ2RhdGEgbWVzc2FnZScpCgogICAgICAgICAgaWYgKHRoaXMub3RyLmF1dGhzdGF0ZSAhPT0gQ09OU1QuQVVUSFNUQVRFX0FXQUlUSU5HX1NJRykKICAgICAgICAgICAgcmV0dXJuICAvLyBpZ25vcmUKCiAgICAgICAgICBtc2cgPSBITFAuc3BsaXR5cGUoWydEQVRBJywgJ01BQyddLCBtc2cubXNnKQoKICAgICAgICAgIHZzbSA9IHRoaXMudmVyaWZ5U2lnbk1hYygKICAgICAgICAgICAgICBtc2dbMV0KICAgICAgICAgICAgLCBtc2dbMF0KICAgICAgICAgICAgLCB0aGlzLm0yX3ByaW1lCiAgICAgICAgICAgICwgdGhpcy5jX3ByaW1lCiAgICAgICAgICAgICwgdGhpcy50aGVpcl95CiAgICAgICAgICAgICwgdGhpcy5vdXJfZGgucHVibGljS2V5CiAgICAgICAgICAgICwgdGhpcy5tMV9wcmltZQogICAgICAgICAgICAsIEhMUC5wYWNrQ3RyKDApCiAgICAgICAgICApCiAgICAgICAgICBpZiAodnNtWzBdKSByZXR1cm4gdGhpcy5vdHIuZXJyb3IodnNtWzBdLCB0cnVlKQoKICAgICAgICAgIC8vIHN0b3JlIHRoZWlyIGtleQogICAgICAgICAgdGhpcy50aGVpcl9rZXlpZCA9IHZzbVsxXQogICAgICAgICAgdGhpcy50aGVpcl9wcml2X3BrID0gdnNtWzJdCgogICAgICAgICAgdGhpcy5tMV9wcmltZSA9IG51bGwKICAgICAgICAgIHRoaXMubTJfcHJpbWUgPSBudWxsCiAgICAgICAgICB0aGlzLmNfcHJpbWUgPSBudWxsCgogICAgICAgICAgdGhpcy50cmFuc21pdHRlZFJTID0gdHJ1ZQogICAgICAgICAgdGhpcy5ha2VTdWNjZXNzKHZlcnNpb24pCiAgICAgICAgICByZXR1cm4KCiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIHJldHVybiAgLy8gaWdub3JlCgogICAgICB9CgogICAgICB0aGlzLnNlbmRNc2codmVyc2lvbiwgdHlwZSwgc2VuZCkKICAgIH0sCgogICAgc2VuZE1zZzogZnVuY3Rpb24gKHZlcnNpb24sIHR5cGUsIG1zZykgewogICAgICB2YXIgc2VuZCA9IHZlcnNpb24gKyB0eXBlCiAgICAgIHZhciB2MyA9ICh2ZXJzaW9uID09PSBDT05TVC5PVFJfVkVSU0lPTl8zKQoKICAgICAgLy8gaW5zdGFuY2UgdGFncyBmb3IgdjMKICAgICAgaWYgKHYzKSB7CiAgICAgICAgSExQLmRlYnVnLmNhbGwodGhpcy5vdHIsICdpbnN0YW5jZSB0YWdzJykKICAgICAgICBzZW5kICs9IHRoaXMub3RyLm91cl9pbnN0YW5jZV90YWcKICAgICAgICBzZW5kICs9IHRoaXMub3RyLnRoZWlyX2luc3RhbmNlX3RhZwogICAgICB9CgogICAgICBzZW5kICs9IG1zZwoKICAgICAgLy8gZnJhZ21lbnQgbWVzc2FnZSBpZiBuZWNlc3NhcnkKICAgICAgc2VuZCA9IEhMUC53cmFwTXNnKAogICAgICAgICAgc2VuZAogICAgICAgICwgdGhpcy5vdHIuZnJhZ21lbnRfc2l6ZQogICAgICAgICwgdjMKICAgICAgICAsIHRoaXMub3RyLm91cl9pbnN0YW5jZV90YWcKICAgICAgICAsIHRoaXMub3RyLnRoZWlyX2luc3RhbmNlX3RhZwogICAgICApCiAgICAgIGlmIChzZW5kWzBdKSByZXR1cm4gdGhpcy5vdHIuZXJyb3Ioc2VuZFswXSkKCiAgICAgIHRoaXMub3RyLmlvKHNlbmRbMV0pCiAgICB9LAoKICAgIGluaXRpYXRlQUtFOiBmdW5jdGlvbiAodmVyc2lvbikgewogICAgICBITFAuZGVidWcuY2FsbCh0aGlzLm90ciwgJ2QtaCBjb21taXQgbWVzc2FnZScpCgogICAgICB0aGlzLm90ci50cmlnZ2VyKCdzdGF0dXMnLCBbQ09OU1QuU1RBVFVTX0FLRV9JTklUXSkKCiAgICAgIHRoaXMub3RyLmF1dGhzdGF0ZSA9IENPTlNULkFVVEhTVEFURV9BV0FJVElOR19ESEtFWQoKICAgICAgdmFyIGd4bXBpID0gSExQLnBhY2tNUEkodGhpcy5vdXJfZGgucHVibGljS2V5KQogICAgICBneG1waSA9IENyeXB0b0pTLmVuYy5MYXRpbjEucGFyc2UoZ3htcGkpCgogICAgICB0aGlzLnIgPSBCaWdJbnQucmFuZEJpZ0ludCgxMjgpCiAgICAgIHZhciBrZXkgPSBDcnlwdG9KUy5lbmMuSGV4LnBhcnNlKEJpZ0ludC5iaWdJbnQyc3RyKHRoaXMuciwgMTYpKQogICAgICBrZXkgPSBDcnlwdG9KUy5lbmMuTGF0aW4xLnN0cmluZ2lmeShrZXkpCgogICAgICB0aGlzLm15aGFzaGVkID0gQ3J5cHRvSlMuU0hBMjU2KGd4bXBpKQogICAgICB0aGlzLm15aGFzaGVkID0gSExQLnBhY2tEYXRhKHRoaXMubXloYXNoZWQudG9TdHJpbmcoQ3J5cHRvSlMuZW5jLkxhdGluMSkpCgogICAgICB0aGlzLmRoY29tbWl0ID0gSExQLnBhY2tEYXRhKEhMUC5lbmNyeXB0QWVzKGd4bXBpLCBrZXksIEhMUC5wYWNrQ3RyKDApKSkKICAgICAgdGhpcy5kaGNvbW1pdCArPSB0aGlzLm15aGFzaGVkCgogICAgICB0aGlzLnNlbmRNc2codmVyc2lvbiwgJ1x4MDInLCB0aGlzLmRoY29tbWl0KQogICAgfQoKICB9Cgp9KS5jYWxsKHRoaXMpCjsoZnVuY3Rpb24gKCkgewogIAoKICB2YXIgcm9vdCA9IHRoaXMKCiAgdmFyIENyeXB0b0pTLCBCaWdJbnQsICBFdmVudEVtaXR0ZXIsIENPTlNULCBITFAKICBpZiAodHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcgJiYgbW9kdWxlLmV4cG9ydHMpIHsKICAgIG1vZHVsZS5leHBvcnRzID0gU00KICAgIENyeXB0b0pTID0gcmVxdWlyZSgnLi4vdmVuZG9yL2NyeXB0by5qcycpCiAgICBCaWdJbnQgPSByZXF1aXJlKCcuLi92ZW5kb3IvYmlnaW50LmpzJykKICAgIEV2ZW50RW1pdHRlciA9IHJlcXVpcmUoJy4uL3ZlbmRvci9ldmVudGVtaXR0ZXIuanMnKQogICAgQ09OU1QgPSByZXF1aXJlKCcuL2NvbnN0LmpzJykKICAgIEhMUCA9IHJlcXVpcmUoJy4vaGVscGVycy5qcycpCiAgfSBlbHNlIHsKICAgIHJvb3QuT1RSLlNNID0gU00KICAgIENyeXB0b0pTID0gcm9vdC5DcnlwdG9KUwogICAgQmlnSW50ID0gcm9vdC5CaWdJbnQKICAgIEV2ZW50RW1pdHRlciA9IHJvb3QuRXZlbnRFbWl0dGVyCiAgICBDT05TVCA9IHJvb3QuT1RSLkNPTlNUCiAgICBITFAgPSByb290Lk9UUi5ITFAKICB9CgogIC8vIGRpZmZpZS1oZWxsbWFuIG1vZHVsdXMgYW5kIGdlbmVyYXRvcgogIC8vIHNlZSBncm91cCA1LCBSRkMgMzUyNgogIHZhciBHID0gQmlnSW50LnN0cjJiaWdJbnQoQ09OU1QuRywgMTApCiAgdmFyIE4gPSBCaWdJbnQuc3RyMmJpZ0ludChDT05TVC5OLCAxNikKICB2YXIgTl9NSU5VU18yID0gQmlnSW50LnN1YihOLCBCaWdJbnQuc3RyMmJpZ0ludCgnMicsIDEwKSkKCiAgLy8gdG8gY2FsY3VsYXRlIEQncyBmb3IgemVyby1rbm93bGVkZ2UgcHJvb2ZzCiAgdmFyIFEgPSBCaWdJbnQuc3ViKE4sIEJpZ0ludC5zdHIyYmlnSW50KCcxJywgMTApKQogIEJpZ0ludC5kaXZJbnRfKFEsIDIpICAvLyBtZWgKCiAgZnVuY3Rpb24gU00ocmVxcykgewogICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIFNNKSkgcmV0dXJuIG5ldyBTTShyZXFzKQoKICAgIHRoaXMudmVyc2lvbiA9IDEKCiAgICB0aGlzLm91cl9mcCA9IHJlcXMub3VyX2ZwCiAgICB0aGlzLnRoZWlyX2ZwID0gcmVxcy50aGVpcl9mcAogICAgdGhpcy5zc2lkID0gcmVxcy5zc2lkCgogICAgdGhpcy5kZWJ1ZyA9ICEhcmVxcy5kZWJ1ZwoKICAgIC8vIGluaXRpYWwgc3RhdGUKICAgIHRoaXMuaW5pdCgpCiAgfQoKICAvLyBpbmhlcml0IGZyb20gRUUKICBITFAuZXh0ZW5kKFNNLCBFdmVudEVtaXR0ZXIpCgogIC8vIHNldCB0aGUgaW5pdGlhbCB2YWx1ZXMKICAvLyBhbHNvIHVzZWQgd2hlbiBhYm9ydGluZwogIFNNLnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24gKCkgewogICAgdGhpcy5zbXBzdGF0ZSA9IENPTlNULlNNUFNUQVRFX0VYUEVDVDEKICAgIHRoaXMuc2VjcmV0ID0gbnVsbAogIH0KCiAgU00ucHJvdG90eXBlLm1ha2VTZWNyZXQgPSBmdW5jdGlvbiAob3VyLCBzZWNyZXQpIHsKICAgIHZhciBzaGEyNTYgPSBDcnlwdG9KUy5hbGdvLlNIQTI1Ni5jcmVhdGUoKQogICAgc2hhMjU2LnVwZGF0ZShDcnlwdG9KUy5lbmMuTGF0aW4xLnBhcnNlKEhMUC5wYWNrQnl0ZXModGhpcy52ZXJzaW9uLCAxKSkpCiAgICBzaGEyNTYudXBkYXRlKENyeXB0b0pTLmVuYy5IZXgucGFyc2Uob3VyID8gdGhpcy5vdXJfZnAgOiB0aGlzLnRoZWlyX2ZwKSkKICAgIHNoYTI1Ni51cGRhdGUoQ3J5cHRvSlMuZW5jLkhleC5wYXJzZShvdXIgPyB0aGlzLnRoZWlyX2ZwIDogdGhpcy5vdXJfZnApKQogICAgc2hhMjU2LnVwZGF0ZShDcnlwdG9KUy5lbmMuTGF0aW4xLnBhcnNlKHRoaXMuc3NpZCkpCiAgICBzaGEyNTYudXBkYXRlKENyeXB0b0pTLmVuYy5MYXRpbjEucGFyc2Uoc2VjcmV0KSkKICAgIHZhciBoYXNoID0gc2hhMjU2LmZpbmFsaXplKCkKICAgIHRoaXMuc2VjcmV0ID0gSExQLmJpdHMyYmlnSW50KGhhc2gudG9TdHJpbmcoQ3J5cHRvSlMuZW5jLkxhdGluMSkpCiAgfQoKICBTTS5wcm90b3R5cGUubWFrZUcycyA9IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMuYTIgPSBITFAucmFuZG9tRXhwb25lbnQoKQogICAgdGhpcy5hMyA9IEhMUC5yYW5kb21FeHBvbmVudCgpCiAgICB0aGlzLmcyYSA9IEJpZ0ludC5wb3dNb2QoRywgdGhpcy5hMiwgTikKICAgIHRoaXMuZzNhID0gQmlnSW50LnBvd01vZChHLCB0aGlzLmEzLCBOKQogICAgaWYgKCAhSExQLmNoZWNrR3JvdXAodGhpcy5nMmEsIE5fTUlOVVNfMikgfHwKICAgICAgICAgIUhMUC5jaGVja0dyb3VwKHRoaXMuZzNhLCBOX01JTlVTXzIpCiAgICApIHRoaXMubWFrZUcycygpCiAgfQoKICBTTS5wcm90b3R5cGUuY29tcHV0ZUdzID0gZnVuY3Rpb24gKGcyYSwgZzNhKSB7CiAgICB0aGlzLmcyID0gQmlnSW50LnBvd01vZChnMmEsIHRoaXMuYTIsIE4pCiAgICB0aGlzLmczID0gQmlnSW50LnBvd01vZChnM2EsIHRoaXMuYTMsIE4pCiAgfQoKICBTTS5wcm90b3R5cGUuY29tcHV0ZVBRID0gZnVuY3Rpb24gKHIpIHsKICAgIHRoaXMucCA9IEJpZ0ludC5wb3dNb2QodGhpcy5nMywgciwgTikKICAgIHRoaXMucSA9IEhMUC5tdWx0UG93TW9kKEcsIHIsIHRoaXMuZzIsIHRoaXMuc2VjcmV0LCBOKQogIH0KCiAgU00ucHJvdG90eXBlLmNvbXB1dGVSID0gZnVuY3Rpb24gKCkgewogICAgdGhpcy5yID0gQmlnSW50LnBvd01vZCh0aGlzLlFvUSwgdGhpcy5hMywgTikKICB9CgogIFNNLnByb3RvdHlwZS5jb21wdXRlUmFiID0gZnVuY3Rpb24gKHIpIHsKICAgIHJldHVybiBCaWdJbnQucG93TW9kKHIsIHRoaXMuYTMsIE4pCiAgfQoKICBTTS5wcm90b3R5cGUuY29tcHV0ZUMgPSBmdW5jdGlvbiAodiwgcikgewogICAgcmV0dXJuIEhMUC5zbXBIYXNoKHYsIEJpZ0ludC5wb3dNb2QoRywgciwgTikpCiAgfQoKICBTTS5wcm90b3R5cGUuY29tcHV0ZUQgPSBmdW5jdGlvbiAociwgYSwgYykgewogICAgcmV0dXJuIEJpZ0ludC5zdWJNb2QociwgQmlnSW50Lm11bHRNb2QoYSwgYywgUSksIFEpCiAgfQoKICAvLyB0aGUgYnVsayBvZiB0aGUgd29yawogIFNNLnByb3RvdHlwZS5oYW5kbGVTTSA9IGZ1bmN0aW9uIChtc2cpIHsKICAgIHZhciBzZW5kLCByMiwgcjMsIHI3LCB0MSwgdDIsIHQzLCB0NCwgcmFiLCB0bXAyLCBjUiwgZDcsIG1zLCB0cnVzdAoKICAgIHZhciBleHBlY3RTdGF0ZXMgPSB7CiAgICAgICAgMjogQ09OU1QuU01QU1RBVEVfRVhQRUNUMQogICAgICAsIDM6IENPTlNULlNNUFNUQVRFX0VYUEVDVDIKICAgICAgLCA0OiBDT05TVC5TTVBTVEFURV9FWFBFQ1QzCiAgICAgICwgNTogQ09OU1QuU01QU1RBVEVfRVhQRUNUNAogICAgICAsIDc6IENPTlNULlNNUFNUQVRFX0VYUEVDVDEKICAgIH0KCiAgICBpZiAobXNnLnR5cGUgPT09IDYpIHsKICAgICAgdGhpcy5pbml0KCkKICAgICAgdGhpcy50cmlnZ2VyKCdhYm9ydCcpCiAgICAgIHJldHVybgogICAgfQoKICAgIC8vIGFib3J0ISB0aGVyZSB3YXMgYW4gZXJyb3IKICAgIGlmICh0aGlzLnNtcHN0YXRlICE9PSBleHBlY3RTdGF0ZXNbbXNnLnR5cGVdKQogICAgICByZXR1cm4gdGhpcy5hYm9ydCgpCgogICAgc3dpdGNoICh0aGlzLnNtcHN0YXRlKSB7CgogICAgICBjYXNlIENPTlNULlNNUFNUQVRFX0VYUEVDVDE6CiAgICAgICAgSExQLmRlYnVnLmNhbGwodGhpcywgJ3NtcCB0bHYgMicpCgogICAgICAgIC8vIHVzZXIgc3BlY2lmaWVkIHF1ZXN0aW9uCiAgICAgICAgdmFyIGluZCwgcXVlc3Rpb24KICAgICAgICBpZiAobXNnLnR5cGUgPT09IDcpIHsKICAgICAgICAgIGluZCA9IG1zZy5tc2cuaW5kZXhPZignXHgwMCcpCiAgICAgICAgICBxdWVzdGlvbiA9IG1zZy5tc2cuc3Vic3RyaW5nKDAsIGluZCkKICAgICAgICAgIG1zZy5tc2cgPSBtc2cubXNnLnN1YnN0cmluZyhpbmQgKyAxKQogICAgICAgIH0KCiAgICAgICAgLy8gMDpnMmEsIDE6YzIsIDI6ZDIsIDM6ZzNhLCA0OmMzLCA1OmQzCiAgICAgICAgbXMgPSBITFAucmVhZExlbihtc2cubXNnLnN1YnN0cigwLCA0KSkKICAgICAgICBpZiAobXMgIT09IDYpIHJldHVybiB0aGlzLmFib3J0KCkKICAgICAgICBtc2cgPSBITFAudW5wYWNrTVBJcyg2LCBtc2cubXNnLnN1YnN0cmluZyg0KSkKCiAgICAgICAgaWYgKCAhSExQLmNoZWNrR3JvdXAobXNnWzBdLCBOX01JTlVTXzIpIHx8CiAgICAgICAgICAgICAhSExQLmNoZWNrR3JvdXAobXNnWzNdLCBOX01JTlVTXzIpCiAgICAgICAgKSByZXR1cm4gdGhpcy5hYm9ydCgpCgogICAgICAgIC8vIHZlcmlmeSB6bnAncwogICAgICAgIGlmICghSExQLlpLUCgxLCBtc2dbMV0sIEhMUC5tdWx0UG93TW9kKEcsIG1zZ1syXSwgbXNnWzBdLCBtc2dbMV0sIE4pKSkKICAgICAgICAgIHJldHVybiB0aGlzLmFib3J0KCkKCiAgICAgICAgaWYgKCFITFAuWktQKDIsIG1zZ1s0XSwgSExQLm11bHRQb3dNb2QoRywgbXNnWzVdLCBtc2dbM10sIG1zZ1s0XSwgTikpKQogICAgICAgICAgcmV0dXJuIHRoaXMuYWJvcnQoKQoKICAgICAgICB0aGlzLmczYW8gPSBtc2dbM10gIC8vIHNhdmUgZm9yIGxhdGVyCgogICAgICAgIHRoaXMubWFrZUcycygpCgogICAgICAgIC8vIHplcm8ta25vd2xlZGdlIHByb29mIHRoYXQgdGhlIGV4cG9uZW50cwogICAgICAgIC8vIGFzc29jaWF0ZWQgd2l0aCBnMmEgJiBnM2EgYXJlIGtub3duCiAgICAgICAgcjIgPSBITFAucmFuZG9tRXhwb25lbnQoKQogICAgICAgIHIzID0gSExQLnJhbmRvbUV4cG9uZW50KCkKICAgICAgICB0aGlzLmMyID0gdGhpcy5jb21wdXRlQygzLCByMikKICAgICAgICB0aGlzLmMzID0gdGhpcy5jb21wdXRlQyg0LCByMykKICAgICAgICB0aGlzLmQyID0gdGhpcy5jb21wdXRlRChyMiwgdGhpcy5hMiwgdGhpcy5jMikKICAgICAgICB0aGlzLmQzID0gdGhpcy5jb21wdXRlRChyMywgdGhpcy5hMywgdGhpcy5jMykKCiAgICAgICAgdGhpcy5jb21wdXRlR3MobXNnWzBdLCBtc2dbM10pCgogICAgICAgIHRoaXMuc21wc3RhdGUgPSBDT05TVC5TTVBTVEFURV9FWFBFQ1QwCgogICAgICAgIC8vIGFzc3VtZSB1dGY4IHF1ZXN0aW9uCiAgICAgICAgcXVlc3Rpb24gPSBDcnlwdG9KUy5lbmMuTGF0aW4xCiAgICAgICAgICAucGFyc2UocXVlc3Rpb24pCiAgICAgICAgICAudG9TdHJpbmcoQ3J5cHRvSlMuZW5jLlV0ZjgpCgogICAgICAgIC8vIGludm9rZSBxdWVzdGlvbgogICAgICAgIHRoaXMudHJpZ2dlcigncXVlc3Rpb24nLCBbcXVlc3Rpb25dKQogICAgICAgIHJldHVybgoKICAgICAgY2FzZSBDT05TVC5TTVBTVEFURV9FWFBFQ1QyOgogICAgICAgIEhMUC5kZWJ1Zy5jYWxsKHRoaXMsICdzbXAgdGx2IDMnKQoKICAgICAgICAvLyAwOmcyYSwgMTpjMiwgMjpkMiwgMzpnM2EsIDQ6YzMsIDU6ZDMsIDY6cCwgNzpxLCA4OmNQLCA5OmQ1LCAxMDpkNgogICAgICAgIG1zID0gSExQLnJlYWRMZW4obXNnLm1zZy5zdWJzdHIoMCwgNCkpCiAgICAgICAgaWYgKG1zICE9PSAxMSkgcmV0dXJuIHRoaXMuYWJvcnQoKQogICAgICAgIG1zZyA9IEhMUC51bnBhY2tNUElzKDExLCBtc2cubXNnLnN1YnN0cmluZyg0KSkKCiAgICAgICAgaWYgKCAhSExQLmNoZWNrR3JvdXAobXNnWzBdLCBOX01JTlVTXzIpIHx8CiAgICAgICAgICAgICAhSExQLmNoZWNrR3JvdXAobXNnWzNdLCBOX01JTlVTXzIpIHx8CiAgICAgICAgICAgICAhSExQLmNoZWNrR3JvdXAobXNnWzZdLCBOX01JTlVTXzIpIHx8CiAgICAgICAgICAgICAhSExQLmNoZWNrR3JvdXAobXNnWzddLCBOX01JTlVTXzIpCiAgICAgICAgKSByZXR1cm4gdGhpcy5hYm9ydCgpCgogICAgICAgIC8vIHZlcmlmeSB6bnAgb2YgYzMgLyBjMwogICAgICAgIGlmICghSExQLlpLUCgzLCBtc2dbMV0sIEhMUC5tdWx0UG93TW9kKEcsIG1zZ1syXSwgbXNnWzBdLCBtc2dbMV0sIE4pKSkKICAgICAgICAgIHJldHVybiB0aGlzLmFib3J0KCkKCiAgICAgICAgaWYgKCFITFAuWktQKDQsIG1zZ1s0XSwgSExQLm11bHRQb3dNb2QoRywgbXNnWzVdLCBtc2dbM10sIG1zZ1s0XSwgTikpKQogICAgICAgICAgcmV0dXJuIHRoaXMuYWJvcnQoKQoKICAgICAgICB0aGlzLmczYW8gPSBtc2dbM10gIC8vIHNhdmUgZm9yIGxhdGVyCgogICAgICAgIHRoaXMuY29tcHV0ZUdzKG1zZ1swXSwgbXNnWzNdKQoKICAgICAgICAvLyB2ZXJpZnkgem5wIG9mIGNQCiAgICAgICAgdDEgPSBITFAubXVsdFBvd01vZCh0aGlzLmczLCBtc2dbOV0sIG1zZ1s2XSwgbXNnWzhdLCBOKQogICAgICAgIHQyID0gSExQLm11bHRQb3dNb2QoRywgbXNnWzldLCB0aGlzLmcyLCBtc2dbMTBdLCBOKQogICAgICAgIHQyID0gQmlnSW50Lm11bHRNb2QodDIsIEJpZ0ludC5wb3dNb2QobXNnWzddLCBtc2dbOF0sIE4pLCBOKQoKICAgICAgICBpZiAoIUhMUC5aS1AoNSwgbXNnWzhdLCB0MSwgdDIpKQogICAgICAgICAgcmV0dXJuIHRoaXMuYWJvcnQoKQoKICAgICAgICB2YXIgcjQgPSBITFAucmFuZG9tRXhwb25lbnQoKQogICAgICAgIHRoaXMuY29tcHV0ZVBRKHI0KQoKICAgICAgICAvLyB6ZXJvLWtub3dsZWRnZSBwcm9vZiB0aGF0IFAgJiBRCiAgICAgICAgLy8gd2VyZSBnZW5lcmF0ZWQgYWNjb3JkaW5nIHRvIHRoZSBwcm90b2NvbAogICAgICAgIHZhciByNSA9IEhMUC5yYW5kb21FeHBvbmVudCgpCiAgICAgICAgdmFyIHI2ID0gSExQLnJhbmRvbUV4cG9uZW50KCkKICAgICAgICB2YXIgdG1wID0gSExQLm11bHRQb3dNb2QoRywgcjUsIHRoaXMuZzIsIHI2LCBOKQogICAgICAgIHZhciBjUCA9IEhMUC5zbXBIYXNoKDYsIEJpZ0ludC5wb3dNb2QodGhpcy5nMywgcjUsIE4pLCB0bXApCiAgICAgICAgdmFyIGQ1ID0gdGhpcy5jb21wdXRlRChyNSwgcjQsIGNQKQogICAgICAgIHZhciBkNiA9IHRoaXMuY29tcHV0ZUQocjYsIHRoaXMuc2VjcmV0LCBjUCkKCiAgICAgICAgLy8gc3RvcmUgdGhlc2UKICAgICAgICB0aGlzLlFvUSA9IEJpZ0ludC5kaXZNb2QodGhpcy5xLCBtc2dbN10sIE4pCiAgICAgICAgdGhpcy5Qb1AgPSBCaWdJbnQuZGl2TW9kKHRoaXMucCwgbXNnWzZdLCBOKQoKICAgICAgICB0aGlzLmNvbXB1dGVSKCkKCiAgICAgICAgLy8gemVyby1rbm93bGVkZ2UgcHJvb2YgdGhhdCBSCiAgICAgICAgLy8gd2FzIGdlbmVyYXRlZCBhY2NvcmRpbmcgdG8gdGhlIHByb3RvY29sCiAgICAgICAgcjcgPSBITFAucmFuZG9tRXhwb25lbnQoKQogICAgICAgIHRtcDIgPSBCaWdJbnQucG93TW9kKHRoaXMuUW9RLCByNywgTikKICAgICAgICBjUiA9IEhMUC5zbXBIYXNoKDcsIEJpZ0ludC5wb3dNb2QoRywgcjcsIE4pLCB0bXAyKQogICAgICAgIGQ3ID0gdGhpcy5jb21wdXRlRChyNywgdGhpcy5hMywgY1IpCgogICAgICAgIHRoaXMuc21wc3RhdGUgPSBDT05TVC5TTVBTVEFURV9FWFBFQ1Q0CgogICAgICAgIHNlbmQgPSBITFAucGFja0lOVCg4KSArIEhMUC5wYWNrTVBJcyhbCiAgICAgICAgICAgIHRoaXMucAogICAgICAgICAgLCB0aGlzLnEKICAgICAgICAgICwgY1AKICAgICAgICAgICwgZDUKICAgICAgICAgICwgZDYKICAgICAgICAgICwgdGhpcy5yCiAgICAgICAgICAsIGNSCiAgICAgICAgICAsIGQ3CiAgICAgICAgXSkKCiAgICAgICAgLy8gVExWCiAgICAgICAgc2VuZCA9IEhMUC5wYWNrVExWKDQsIHNlbmQpCiAgICAgICAgYnJlYWsKCiAgICAgIGNhc2UgQ09OU1QuU01QU1RBVEVfRVhQRUNUMzoKICAgICAgICBITFAuZGVidWcuY2FsbCh0aGlzLCAnc21wIHRsdiA0JykKCiAgICAgICAgLy8gMDpwLCAxOnEsIDI6Y1AsIDM6ZDUsIDQ6ZDYsIDU6ciwgNjpjUiwgNzpkNwogICAgICAgIG1zID0gSExQLnJlYWRMZW4obXNnLm1zZy5zdWJzdHIoMCwgNCkpCiAgICAgICAgaWYgKG1zICE9PSA4KSByZXR1cm4gdGhpcy5hYm9ydCgpCiAgICAgICAgbXNnID0gSExQLnVucGFja01QSXMoOCwgbXNnLm1zZy5zdWJzdHJpbmcoNCkpCgogICAgICAgIGlmICggIUhMUC5jaGVja0dyb3VwKG1zZ1swXSwgTl9NSU5VU18yKSB8fAogICAgICAgICAgICAgIUhMUC5jaGVja0dyb3VwKG1zZ1sxXSwgTl9NSU5VU18yKSB8fAogICAgICAgICAgICAgIUhMUC5jaGVja0dyb3VwKG1zZ1s1XSwgTl9NSU5VU18yKQogICAgICAgICkgcmV0dXJuIHRoaXMuYWJvcnQoKQoKICAgICAgICAvLyB2ZXJpZnkgem5wIG9mIGNQCiAgICAgICAgdDEgPSBITFAubXVsdFBvd01vZCh0aGlzLmczLCBtc2dbM10sIG1zZ1swXSwgbXNnWzJdLCBOKQogICAgICAgIHQyID0gSExQLm11bHRQb3dNb2QoRywgbXNnWzNdLCB0aGlzLmcyLCBtc2dbNF0sIE4pCiAgICAgICAgdDIgPSBCaWdJbnQubXVsdE1vZCh0MiwgQmlnSW50LnBvd01vZChtc2dbMV0sIG1zZ1syXSwgTiksIE4pCgogICAgICAgIGlmICghSExQLlpLUCg2LCBtc2dbMl0sIHQxLCB0MikpCiAgICAgICAgICByZXR1cm4gdGhpcy5hYm9ydCgpCgogICAgICAgIC8vIHZlcmlmeSB6bnAgb2YgY1IKICAgICAgICB0MyA9IEhMUC5tdWx0UG93TW9kKEcsIG1zZ1s3XSwgdGhpcy5nM2FvLCBtc2dbNl0sIE4pCiAgICAgICAgdGhpcy5Rb1EgPSBCaWdJbnQuZGl2TW9kKG1zZ1sxXSwgdGhpcy5xLCBOKSAgLy8gc2F2ZSBRIG92ZXIgUQogICAgICAgIHQ0ID0gSExQLm11bHRQb3dNb2QodGhpcy5Rb1EsIG1zZ1s3XSwgbXNnWzVdLCBtc2dbNl0sIE4pCgogICAgICAgIGlmICghSExQLlpLUCg3LCBtc2dbNl0sIHQzLCB0NCkpCiAgICAgICAgICByZXR1cm4gdGhpcy5hYm9ydCgpCgogICAgICAgIHRoaXMuY29tcHV0ZVIoKQoKICAgICAgICAvLyB6ZXJvLWtub3dsZWRnZSBwcm9vZiB0aGF0IFIKICAgICAgICAvLyB3YXMgZ2VuZXJhdGVkIGFjY29yZGluZyB0byB0aGUgcHJvdG9jb2wKICAgICAgICByNyA9IEhMUC5yYW5kb21FeHBvbmVudCgpCiAgICAgICAgdG1wMiA9IEJpZ0ludC5wb3dNb2QodGhpcy5Rb1EsIHI3LCBOKQogICAgICAgIGNSID0gSExQLnNtcEhhc2goOCwgQmlnSW50LnBvd01vZChHLCByNywgTiksIHRtcDIpCiAgICAgICAgZDcgPSB0aGlzLmNvbXB1dGVEKHI3LCB0aGlzLmEzLCBjUikKCiAgICAgICAgc2VuZCA9IEhMUC5wYWNrSU5UKDMpICsgSExQLnBhY2tNUElzKFsgdGhpcy5yLCBjUiwgZDcgXSkKICAgICAgICBzZW5kID0gSExQLnBhY2tUTFYoNSwgc2VuZCkKCiAgICAgICAgcmFiID0gdGhpcy5jb21wdXRlUmFiKG1zZ1s1XSkKICAgICAgICB0cnVzdCA9ICEhQmlnSW50LmVxdWFscyhyYWIsIEJpZ0ludC5kaXZNb2QobXNnWzBdLCB0aGlzLnAsIE4pKQoKICAgICAgICB0aGlzLnRyaWdnZXIoJ3RydXN0JywgW3RydXN0LCAnYW5zd2VyZWQnXSkKICAgICAgICB0aGlzLmluaXQoKQogICAgICAgIGJyZWFrCgogICAgICBjYXNlIENPTlNULlNNUFNUQVRFX0VYUEVDVDQ6CiAgICAgICAgSExQLmRlYnVnLmNhbGwodGhpcywgJ3NtcCB0bHYgNScpCgogICAgICAgIC8vIDA6ciwgMTpjUiwgMjpkNwogICAgICAgIG1zID0gSExQLnJlYWRMZW4obXNnLm1zZy5zdWJzdHIoMCwgNCkpCiAgICAgICAgaWYgKG1zICE9PSAzKSByZXR1cm4gdGhpcy5hYm9ydCgpCiAgICAgICAgbXNnID0gSExQLnVucGFja01QSXMoMywgbXNnLm1zZy5zdWJzdHJpbmcoNCkpCgogICAgICAgIGlmICghSExQLmNoZWNrR3JvdXAobXNnWzBdLCBOX01JTlVTXzIpKSByZXR1cm4gdGhpcy5hYm9ydCgpCgogICAgICAgIC8vIHZlcmlmeSB6bnAgb2YgY1IKICAgICAgICB0MyA9IEhMUC5tdWx0UG93TW9kKEcsIG1zZ1syXSwgdGhpcy5nM2FvLCBtc2dbMV0sIE4pCiAgICAgICAgdDQgPSBITFAubXVsdFBvd01vZCh0aGlzLlFvUSwgbXNnWzJdLCBtc2dbMF0sIG1zZ1sxXSwgTikKICAgICAgICBpZiAoIUhMUC5aS1AoOCwgbXNnWzFdLCB0MywgdDQpKQogICAgICAgICAgcmV0dXJuIHRoaXMuYWJvcnQoKQoKICAgICAgICByYWIgPSB0aGlzLmNvbXB1dGVSYWIobXNnWzBdKQogICAgICAgIHRydXN0ID0gISFCaWdJbnQuZXF1YWxzKHJhYiwgdGhpcy5Qb1ApCgogICAgICAgIHRoaXMudHJpZ2dlcigndHJ1c3QnLCBbdHJ1c3QsICdhc2tlZCddKQogICAgICAgIHRoaXMuaW5pdCgpCiAgICAgICAgcmV0dXJuCgogICAgfQoKICAgIHRoaXMuc2VuZE1zZyhzZW5kKQogIH0KCiAgLy8gc2VuZCBhIG1lc3NhZ2UKICBTTS5wcm90b3R5cGUuc2VuZE1zZyA9IGZ1bmN0aW9uIChzZW5kKSB7CiAgICB0aGlzLnRyaWdnZXIoJ3NlbmQnLCBbdGhpcy5zc2lkLCAnXHgwMCcgKyBzZW5kXSkKICB9CgogIFNNLnByb3RvdHlwZS5yY3ZTZWNyZXQgPSBmdW5jdGlvbiAoc2VjcmV0LCBxdWVzdGlvbikgewogICAgSExQLmRlYnVnLmNhbGwodGhpcywgJ3JlY2VpdmUgc2VjcmV0JykKCiAgICB2YXIgZm4sIG91ciA9IGZhbHNlCiAgICBpZiAodGhpcy5zbXBzdGF0ZSA9PT0gQ09OU1QuU01QU1RBVEVfRVhQRUNUMCkgewogICAgICBmbiA9IHRoaXMuYW5zd2VyCiAgICB9IGVsc2UgewogICAgICBmbiA9IHRoaXMuaW5pdGlhdGUKICAgICAgb3VyID0gdHJ1ZQogICAgfQoKICAgIHRoaXMubWFrZVNlY3JldChvdXIsIHNlY3JldCkKICAgIGZuLmNhbGwodGhpcywgcXVlc3Rpb24pCiAgfQoKICBTTS5wcm90b3R5cGUuYW5zd2VyID0gZnVuY3Rpb24gKCkgewogICAgSExQLmRlYnVnLmNhbGwodGhpcywgJ3NtcCBhbnN3ZXInKQoKICAgIHZhciByNCA9IEhMUC5yYW5kb21FeHBvbmVudCgpCiAgICB0aGlzLmNvbXB1dGVQUShyNCkKCiAgICAvLyB6ZXJvLWtub3dsZWRnZSBwcm9vZiB0aGF0IFAgJiBRCiAgICAvLyB3ZXJlIGdlbmVyYXRlZCBhY2NvcmRpbmcgdG8gdGhlIHByb3RvY29sCiAgICB2YXIgcjUgPSBITFAucmFuZG9tRXhwb25lbnQoKQogICAgdmFyIHI2ID0gSExQLnJhbmRvbUV4cG9uZW50KCkKICAgIHZhciB0bXAgPSBITFAubXVsdFBvd01vZChHLCByNSwgdGhpcy5nMiwgcjYsIE4pCiAgICB2YXIgY1AgPSBITFAuc21wSGFzaCg1LCBCaWdJbnQucG93TW9kKHRoaXMuZzMsIHI1LCBOKSwgdG1wKQogICAgdmFyIGQ1ID0gdGhpcy5jb21wdXRlRChyNSwgcjQsIGNQKQogICAgdmFyIGQ2ID0gdGhpcy5jb21wdXRlRChyNiwgdGhpcy5zZWNyZXQsIGNQKQoKICAgIHRoaXMuc21wc3RhdGUgPSBDT05TVC5TTVBTVEFURV9FWFBFQ1QzCgogICAgdmFyIHNlbmQgPSBITFAucGFja0lOVCgxMSkgKyBITFAucGFja01QSXMoWwogICAgICAgIHRoaXMuZzJhCiAgICAgICwgdGhpcy5jMgogICAgICAsIHRoaXMuZDIKICAgICAgLCB0aGlzLmczYQogICAgICAsIHRoaXMuYzMKICAgICAgLCB0aGlzLmQzCiAgICAgICwgdGhpcy5wCiAgICAgICwgdGhpcy5xCiAgICAgICwgY1AKICAgICAgLCBkNQogICAgICAsIGQ2CiAgICBdKQoKICAgIHRoaXMuc2VuZE1zZyhITFAucGFja1RMVigzLCBzZW5kKSkKICB9CgogIFNNLnByb3RvdHlwZS5pbml0aWF0ZSA9IGZ1bmN0aW9uIChxdWVzdGlvbikgewogICAgSExQLmRlYnVnLmNhbGwodGhpcywgJ3NtcCBpbml0aWF0ZScpCgogICAgaWYgKHRoaXMuc21wc3RhdGUgIT09IENPTlNULlNNUFNUQVRFX0VYUEVDVDEpCiAgICAgIHRoaXMuYWJvcnQoKSAgLy8gYWJvcnQgKyByZXN0YXJ0CgogICAgdGhpcy5tYWtlRzJzKCkKCiAgICAvLyB6ZXJvLWtub3dsZWRnZSBwcm9vZiB0aGF0IHRoZSBleHBvbmVudHMKICAgIC8vIGFzc29jaWF0ZWQgd2l0aCBnMmEgJiBnM2EgYXJlIGtub3duCiAgICB2YXIgcjIgPSBITFAucmFuZG9tRXhwb25lbnQoKQogICAgdmFyIHIzID0gSExQLnJhbmRvbUV4cG9uZW50KCkKICAgIHRoaXMuYzIgPSB0aGlzLmNvbXB1dGVDKDEsIHIyKQogICAgdGhpcy5jMyA9IHRoaXMuY29tcHV0ZUMoMiwgcjMpCiAgICB0aGlzLmQyID0gdGhpcy5jb21wdXRlRChyMiwgdGhpcy5hMiwgdGhpcy5jMikKICAgIHRoaXMuZDMgPSB0aGlzLmNvbXB1dGVEKHIzLCB0aGlzLmEzLCB0aGlzLmMzKQoKICAgIC8vIHNldCB0aGUgbmV4dCBleHBlY3RlZCBzdGF0ZQogICAgdGhpcy5zbXBzdGF0ZSA9IENPTlNULlNNUFNUQVRFX0VYUEVDVDIKCiAgICB2YXIgc2VuZCA9ICcnCiAgICB2YXIgdHlwZSA9IDIKCiAgICBpZiAocXVlc3Rpb24pIHsKICAgICAgc2VuZCArPSBxdWVzdGlvbgogICAgICBzZW5kICs9ICdceDAwJwogICAgICB0eXBlID0gNwogICAgfQoKICAgIHNlbmQgKz0gSExQLnBhY2tJTlQoNikgKyBITFAucGFja01QSXMoWwogICAgICAgIHRoaXMuZzJhCiAgICAgICwgdGhpcy5jMgogICAgICAsIHRoaXMuZDIKICAgICAgLCB0aGlzLmczYQogICAgICAsIHRoaXMuYzMKICAgICAgLCB0aGlzLmQzCiAgICBdKQoKICAgIHRoaXMuc2VuZE1zZyhITFAucGFja1RMVih0eXBlLCBzZW5kKSkKICB9CgogIFNNLnByb3RvdHlwZS5hYm9ydCA9IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMuaW5pdCgpCiAgICB0aGlzLnNlbmRNc2coSExQLnBhY2tUTFYoNiwgJycpKQogICAgdGhpcy50cmlnZ2VyKCdhYm9ydCcpCiAgfQoKfSkuY2FsbCh0aGlzKQo7KGZ1bmN0aW9uICgpIHsKICAKCiAgdmFyIHJvb3QgPSB0aGlzCgogIHZhciBDcnlwdG9KUywgQmlnSW50LCBFdmVudEVtaXR0ZXIsIFdvcmtlciwgU01XUGF0aAogICAgLCBDT05TVCwgSExQLCBQYXJzZSwgQUtFLCBTTSwgRFNBCiAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnICYmIG1vZHVsZS5leHBvcnRzKSB7CiAgICBtb2R1bGUuZXhwb3J0cyA9IE9UUgogICAgQ3J5cHRvSlMgPSByZXF1aXJlKCcuLi92ZW5kb3IvY3J5cHRvLmpzJykKICAgIEJpZ0ludCA9IHJlcXVpcmUoJy4uL3ZlbmRvci9iaWdpbnQuanMnKQogICAgRXZlbnRFbWl0dGVyID0gcmVxdWlyZSgnLi4vdmVuZG9yL2V2ZW50ZW1pdHRlci5qcycpCiAgICBTTVdQYXRoID0gcmVxdWlyZSgncGF0aCcpLmpvaW4oX19kaXJuYW1lLCAnL3NtLXdlYndvcmtlci5qcycpCiAgICBDT05TVCA9IHJlcXVpcmUoJy4vY29uc3QuanMnKQogICAgSExQID0gcmVxdWlyZSgnLi9oZWxwZXJzLmpzJykKICAgIFBhcnNlID0gcmVxdWlyZSgnLi9wYXJzZS5qcycpCiAgICBBS0UgPSByZXF1aXJlKCcuL2FrZS5qcycpCiAgICBTTSA9IHJlcXVpcmUoJy4vc20uanMnKQogICAgRFNBID0gcmVxdWlyZSgnLi9kc2EuanMnKQogICAgLy8gZXhwb3NlIENPTlNUIGZvciBjb25zaXN0ZW5jeSB3aXRoIGRvY3MKICAgIE9UUi5DT05TVCA9IENPTlNUCiAgfSBlbHNlIHsKICAgIC8vIGNvcHkgb3ZlciBhbmQgZXhwb3NlIGludGVybmFscwogICAgT2JqZWN0LmtleXMocm9vdC5PVFIpLmZvckVhY2goZnVuY3Rpb24gKGspIHsKICAgICAgT1RSW2tdID0gcm9vdC5PVFJba10KICAgIH0pCiAgICByb290Lk9UUiA9IE9UUgogICAgQ3J5cHRvSlMgPSByb290LkNyeXB0b0pTCiAgICBCaWdJbnQgPSByb290LkJpZ0ludAogICAgRXZlbnRFbWl0dGVyID0gcm9vdC5FdmVudEVtaXR0ZXIKICAgIFdvcmtlciA9IHJvb3QuV29ya2VyCiAgICBTTVdQYXRoID0gJ3NtLXdlYndvcmtlci5qcycKICAgIENPTlNUID0gT1RSLkNPTlNUCiAgICBITFAgPSBPVFIuSExQCiAgICBQYXJzZSA9IE9UUi5QYXJzZQogICAgQUtFID0gT1RSLkFLRQogICAgU00gPSBPVFIuU00KICAgIERTQSA9IHJvb3QuRFNBCiAgfQoKICAvLyBkaWZmaWUtaGVsbG1hbiBtb2R1bHVzIGFuZCBnZW5lcmF0b3IKICAvLyBzZWUgZ3JvdXAgNSwgUkZDIDM1MjYKICB2YXIgRyA9IEJpZ0ludC5zdHIyYmlnSW50KENPTlNULkcsIDEwKQogIHZhciBOID0gQmlnSW50LnN0cjJiaWdJbnQoQ09OU1QuTiwgMTYpCgogIC8vIEphdmFTY3JpcHQgaW50ZWdlcnMKICB2YXIgTUFYX0lOVCA9IE1hdGgucG93KDIsIDUzKSAtIDEgIC8vIGRvdWJsZXMKICB2YXIgTUFYX1VJTlQgPSBNYXRoLnBvdygyLCAzMSkgLSAxICAvLyBiaXR3aXNlIG9wZXJhdG9ycwoKICAvLyBPVFIgY29udHJ1Y3RvcgogIGZ1bmN0aW9uIE9UUihvcHRpb25zKSB7CiAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgT1RSKSkgcmV0dXJuIG5ldyBPVFIob3B0aW9ucykKCiAgICAvLyBvcHRpb25zCiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fQoKICAgIC8vIHByaXZhdGUga2V5cwogICAgaWYgKG9wdGlvbnMucHJpdiAmJiAhKG9wdGlvbnMucHJpdiBpbnN0YW5jZW9mIERTQSkpCiAgICAgIHRocm93IG5ldyBFcnJvcignUmVxdWlyZXMgbG9uZy1saXZlZCBEU0Ega2V5LicpCgogICAgdGhpcy5wcml2ID0gb3B0aW9ucy5wcml2ID8gb3B0aW9ucy5wcml2IDogbmV3IERTQSgpCgogICAgdGhpcy5mcmFnbWVudF9zaXplID0gb3B0aW9ucy5mcmFnbWVudF9zaXplIHx8IDAKICAgIGlmICh0aGlzLmZyYWdtZW50X3NpemUgPCAwKQogICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZyYWdtZW50IHNpemUgbXVzdCBiZSBhIHBvc2l0aXZlIGludGVnZXIuJykKCiAgICB0aGlzLnNlbmRfaW50ZXJ2YWwgPSBvcHRpb25zLnNlbmRfaW50ZXJ2YWwgfHwgMAogICAgaWYgKHRoaXMuc2VuZF9pbnRlcnZhbCA8IDApCiAgICAgIHRocm93IG5ldyBFcnJvcignU2VuZCBpbnRlcnZhbCBtdXN0IGJlIGEgcG9zaXRpdmUgaW50ZWdlci4nKQoKICAgIHRoaXMub3V0Z29pbmcgPSBbXQoKICAgIC8vIGluc3RhbmNlIHRhZwogICAgdGhpcy5vdXJfaW5zdGFuY2VfdGFnID0gb3B0aW9ucy5pbnN0YW5jZV90YWcgfHwgT1RSLm1ha2VJbnN0YW5jZVRhZygpCgogICAgLy8gZGVidWcKICAgIHRoaXMuZGVidWcgPSAhIW9wdGlvbnMuZGVidWcKCiAgICAvLyBzbXAgaW4gd2Vid29ya2VyIG9wdGlvbnMKICAgIC8vIHRoaXMgaXMgc3RpbGwgZXhwZXJpbWVudGFsIGFuZCB1bmRvY3VtZW50ZWQKICAgIHRoaXMuc213ID0gb3B0aW9ucy5zbXcKCiAgICAvLyBpbml0IHZhbHMKICAgIHRoaXMuaW5pdCgpCgogICAgLy8gYmluZCBtZXRob2RzCiAgICB2YXIgc2VsZiA9IHRoaXMKICAgIDtbJ3NlbmRNc2cnLCAncmVjZWl2ZU1zZyddLmZvckVhY2goZnVuY3Rpb24gKG1ldGgpIHsKICAgICAgc2VsZlttZXRoXSA9IHNlbGZbbWV0aF0uYmluZChzZWxmKQogICAgfSkKCiAgICBFdmVudEVtaXR0ZXIuY2FsbCh0aGlzKQogIH0KCiAgLy8gaW5oZXJpdCBmcm9tIEVFCiAgSExQLmV4dGVuZChPVFIsIEV2ZW50RW1pdHRlcikKCiAgLy8gYWRkIHRvIHByb3RvdHlwZQogIE9UUi5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uICgpIHsKCiAgICB0aGlzLm1zZ3N0YXRlID0gQ09OU1QuTVNHU1RBVEVfUExBSU5URVhUCiAgICB0aGlzLmF1dGhzdGF0ZSA9IENPTlNULkFVVEhTVEFURV9OT05FCgogICAgdGhpcy5BTExPV19WMiA9IHRydWUKICAgIHRoaXMuQUxMT1dfVjMgPSB0cnVlCgogICAgdGhpcy5SRVFVSVJFX0VOQ1JZUFRJT04gPSBmYWxzZQogICAgdGhpcy5TRU5EX1dISVRFU1BBQ0VfVEFHID0gZmFsc2UKICAgIHRoaXMuV0hJVEVTUEFDRV9TVEFSVF9BS0UgPSBmYWxzZQogICAgdGhpcy5FUlJPUl9TVEFSVF9BS0UgPSBmYWxzZQoKICAgIFBhcnNlLmluaXRGcmFnbWVudCh0aGlzKQoKICAgIC8vIHRoZWlyIGtleXMKICAgIHRoaXMudGhlaXJfeSA9IG51bGwKICAgIHRoaXMudGhlaXJfb2xkX3kgPSBudWxsCiAgICB0aGlzLnRoZWlyX2tleWlkID0gMAogICAgdGhpcy50aGVpcl9wcml2X3BrID0gbnVsbAogICAgdGhpcy50aGVpcl9pbnN0YW5jZV90YWcgPSAnXHgwMFx4MDBceDAwXHgwMCcKCiAgICAvLyBvdXIga2V5cwogICAgdGhpcy5vdXJfZGggPSB0aGlzLmRoKCkKICAgIHRoaXMub3VyX29sZF9kaCA9IHRoaXMuZGgoKQogICAgdGhpcy5vdXJfa2V5aWQgPSAyCgogICAgLy8gc2Vzc2lvbiBrZXlzCiAgICB0aGlzLnNlc3NLZXlzID0gWyBuZXcgQXJyYXkoMiksIG5ldyBBcnJheSgyKSBdCgogICAgLy8gc2F2ZWQKICAgIHRoaXMuc3RvcmVkTWdzID0gW10KICAgIHRoaXMub2xkTWFjS2V5cyA9IFtdCgogICAgLy8gc21wCiAgICB0aGlzLnNtID0gbnVsbCAgLy8gaW5pdGlhbGl6ZWQgYWZ0ZXIgQUtFCgogICAgLy8gd2hlbiBha2UgaXMgY29tcGxldGUKICAgIC8vIHNhdmUgdGhlaXIga2V5cyBhbmQgdGhlIHNlc3Npb24KICAgIHRoaXMuX2FrZUluaXQoKQoKICAgIC8vIHJlY2VpdmUgcGxhaW50ZXh0IG1lc3NhZ2Ugc2luY2Ugc3dpdGNoaW5nIHRvIHBsYWludGV4dAogICAgLy8gdXNlZCB0byBkZWNpZGUgd2hlbiB0byBzdG9wIHNlbmRpbmcgcHQgdGFncyB3aGVuIFNFTkRfV0hJVEVTUEFDRV9UQUcKICAgIHRoaXMucmVjZWl2ZWRQbGFpbnRleHQgPSBmYWxzZQoKICB9CgogIE9UUi5wcm90b3R5cGUuX2FrZUluaXQgPSBmdW5jdGlvbiAoKSB7CiAgICB0aGlzLmFrZSA9IG5ldyBBS0UodGhpcykKICAgIHRoaXMudHJhbnNtaXR0ZWRSUyA9IGZhbHNlCiAgICB0aGlzLnNzaWQgPSBudWxsCiAgfQoKICAvLyBzbXAgb3ZlciB3ZWJ3b3JrZXIKICBPVFIucHJvdG90eXBlLl9TTVcgPSBmdW5jdGlvbiAob3RyLCByZXFzKSB7CiAgICB0aGlzLm90ciA9IG90cgogICAgdmFyIG9wdHMgPSB7CiAgICAgICAgcGF0aDogU01XUGF0aAogICAgICAsIHNlZWQ6IEJpZ0ludC5nZXRTZWVkCiAgICB9CiAgICBpZiAodHlwZW9mIG90ci5zbXcgPT09ICdvYmplY3QnKQogICAgICBPYmplY3Qua2V5cyhvdHIuc213KS5mb3JFYWNoKGZ1bmN0aW9uIChrKSB7CiAgICAgICAgb3B0c1trXSA9IG90ci5zbXdba10KICAgICAgfSkKCiAgICAvLyBsb2FkIG9wdGlvbmFsIGRlcC4gaW4gbm9kZQogICAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnICYmIG1vZHVsZS5leHBvcnRzKQogICAgICBXb3JrZXIgPSByZXF1aXJlKCd3ZWJ3b3JrZXItdGhyZWFkcycpLldvcmtlcgoKICAgIHRoaXMud29ya2VyID0gbmV3IFdvcmtlcihvcHRzLnBhdGgpCiAgICB2YXIgc2VsZiA9IHRoaXMKICAgIHRoaXMud29ya2VyLm9ubWVzc2FnZSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciBkID0gZS5kYXRhCiAgICAgIGlmICghZCkgcmV0dXJuCiAgICAgIHNlbGYudHJpZ2dlcihkLm1ldGhvZCwgZC5hcmdzKQogICAgfQogICAgdGhpcy53b3JrZXIucG9zdE1lc3NhZ2UoewogICAgICAgIHR5cGU6ICdzZWVkJwogICAgICAsIHNlZWQ6IG9wdHMuc2VlZCgpCiAgICAgICwgaW1wb3J0czogb3B0cy5pbXBvcnRzCiAgICB9KQogICAgdGhpcy53b3JrZXIucG9zdE1lc3NhZ2UoewogICAgICAgIHR5cGU6ICdpbml0JwogICAgICAsIHJlcXM6IHJlcXMKICAgIH0pCiAgfQoKICAvLyBpbmhlcml0IGZyb20gRUUKICBITFAuZXh0ZW5kKE9UUi5wcm90b3R5cGUuX1NNVywgRXZlbnRFbWl0dGVyKQoKICAvLyBzaGltIHNtIG1ldGhvZHMKICA7WydoYW5kbGVTTScsICdyY3ZTZWNyZXQnLCAnYWJvcnQnXS5mb3JFYWNoKGZ1bmN0aW9uIChtKSB7CiAgICBPVFIucHJvdG90eXBlLl9TTVcucHJvdG90eXBlW21dID0gZnVuY3Rpb24gKCkgewogICAgICB0aGlzLndvcmtlci5wb3N0TWVzc2FnZSh7CiAgICAgICAgICB0eXBlOiAnbWV0aG9kJwogICAgICAgICwgbWV0aG9kOiBtCiAgICAgICAgLCBhcmdzOiBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDApCiAgICAgIH0pCiAgICB9CiAgfSkKCiAgT1RSLnByb3RvdHlwZS5fc21Jbml0ID0gZnVuY3Rpb24gKCkgewogICAgdmFyIHJlcXMgPSB7CiAgICAgICAgc3NpZDogdGhpcy5zc2lkCiAgICAgICwgb3VyX2ZwOiB0aGlzLnByaXYuZmluZ2VycHJpbnQoKQogICAgICAsIHRoZWlyX2ZwOiB0aGlzLnRoZWlyX3ByaXZfcGsuZmluZ2VycHJpbnQoKQogICAgICAsIGRlYnVnOiB0aGlzLmRlYnVnCiAgICB9CiAgICBpZiAodGhpcy5zbXcpIHsKICAgICAgaWYgKHRoaXMuc20pIHRoaXMuc20ud29ya2VyLnRlcm1pbmF0ZSgpICAvLyBkZXN0cm95IHByZXYgd2Vid29ya2VyCiAgICAgIHRoaXMuc20gPSBuZXcgdGhpcy5fU01XKHRoaXMsIHJlcXMpCiAgICB9IGVsc2UgewogICAgICB0aGlzLnNtID0gbmV3IFNNKHJlcXMpCiAgICB9CiAgICB2YXIgc2VsZiA9IHRoaXMKICAgIDtbJ3RydXN0JywgJ2Fib3J0JywgJ3F1ZXN0aW9uJ10uZm9yRWFjaChmdW5jdGlvbiAoZSkgewogICAgICBzZWxmLnNtLm9uKGUsIGZ1bmN0aW9uICgpIHsKICAgICAgICBzZWxmLnRyaWdnZXIoJ3NtcCcsIFtlXS5jb25jYXQoQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKSkpCiAgICAgIH0pCiAgICB9KQogICAgdGhpcy5zbS5vbignc2VuZCcsIGZ1bmN0aW9uIChzc2lkLCBzZW5kKSB7CiAgICAgIGlmIChzZWxmLnNzaWQgPT09IHNzaWQpIHsKICAgICAgICBzZW5kID0gc2VsZi5wcmVwYXJlTXNnKHNlbmQpCiAgICAgICAgc2VsZi5pbyhzZW5kKQogICAgICB9CiAgICB9KQogIH0KCiAgT1RSLnByb3RvdHlwZS5pbyA9IGZ1bmN0aW9uIChtc2csIG1ldGEpIHsKCiAgICAvLyBidWZmZXIKICAgIG1zZyA9IChbXS5jb25jYXQobXNnKSkubWFwKGZ1bmN0aW9uKG0pewogICAgICAgcmV0dXJuIHsgbXNnOiBtLCBtZXRhOiBtZXRhIH0KICAgIH0pCiAgICB0aGlzLm91dGdvaW5nID0gdGhpcy5vdXRnb2luZy5jb25jYXQobXNnKQoKICAgIHZhciBzZWxmID0gdGhpcwogICAgOyhmdW5jdGlvbiBzZW5kKGZpcnN0KSB7CiAgICAgIGlmICghZmlyc3QpIHsKICAgICAgICBpZiAoIXNlbGYub3V0Z29pbmcubGVuZ3RoKSByZXR1cm4KICAgICAgICB2YXIgZWxlbSA9IHNlbGYub3V0Z29pbmcuc2hpZnQoKQogICAgICAgIHNlbGYudHJpZ2dlcignaW8nLCBbZWxlbS5tc2csIGVsZW0ubWV0YV0pCiAgICAgIH0KICAgICAgc2V0VGltZW91dChzZW5kLCBmaXJzdCA/IDAgOiBzZWxmLnNlbmRfaW50ZXJ2YWwpCiAgICB9KHRydWUpKQoKICB9CgogIE9UUi5wcm90b3R5cGUuZGggPSBmdW5jdGlvbiBkaCgpIHsKICAgIHZhciBrZXlzID0geyBwcml2YXRlS2V5OiBCaWdJbnQucmFuZEJpZ0ludCgzMjApIH0KICAgIGtleXMucHVibGljS2V5ID0gQmlnSW50LnBvd01vZChHLCBrZXlzLnByaXZhdGVLZXksIE4pCiAgICByZXR1cm4ga2V5cwogIH0KCiAgLy8gc2Vzc2lvbiBjb25zdHJ1Y3RvcgogIE9UUi5wcm90b3R5cGUuREhTZXNzaW9uID0gZnVuY3Rpb24gREhTZXNzaW9uKG91cl9kaCwgdGhlaXJfeSkgewogICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIERIU2Vzc2lvbikpIHJldHVybiBuZXcgREhTZXNzaW9uKG91cl9kaCwgdGhlaXJfeSkKCiAgICAvLyBzaGFyZWQgc2VjcmV0CiAgICB2YXIgcyA9IEJpZ0ludC5wb3dNb2QodGhlaXJfeSwgb3VyX2RoLnByaXZhdGVLZXksIE4pCiAgICB2YXIgc2VjYnl0ZXMgPSBITFAucGFja01QSShzKQoKICAgIC8vIHNlc3Npb24gaWQKICAgIHRoaXMuaWQgPSBITFAubWFzayhITFAuaDIoJ1x4MDAnLCBzZWNieXRlcyksIDAsIDY0KSAgLy8gZmlyc3QgNjQtYml0cwoKICAgIC8vIGFyZSB3ZSB0aGUgaGlnaCBvciBsb3cgZW5kIG9mIHRoZSBjb25uZWN0aW9uPwogICAgdmFyIHNxID0gQmlnSW50LmdyZWF0ZXIob3VyX2RoLnB1YmxpY0tleSwgdGhlaXJfeSkKICAgIHZhciBzZW5kYnl0ZSA9IHNxID8gJ1x4MDEnIDogJ1x4MDInCiAgICB2YXIgcmN2Ynl0ZSAgPSBzcSA/ICdceDAyJyA6ICdceDAxJwoKICAgIC8vIHNlbmRpbmcgYW5kIHJlY2VpdmluZyBrZXlzCiAgICB0aGlzLnNlbmRlbmMgPSBITFAubWFzayhITFAuaDEoc2VuZGJ5dGUsIHNlY2J5dGVzKSwgMCwgMTI4KSAgLy8gZjE2IGJ5dGVzCiAgICB0aGlzLnNlbmRtYWMgPSBDcnlwdG9KUy5TSEExKENyeXB0b0pTLmVuYy5MYXRpbjEucGFyc2UodGhpcy5zZW5kZW5jKSkKICAgIHRoaXMuc2VuZG1hYyA9IHRoaXMuc2VuZG1hYy50b1N0cmluZyhDcnlwdG9KUy5lbmMuTGF0aW4xKQoKICAgIHRoaXMucmN2ZW5jID0gSExQLm1hc2soSExQLmgxKHJjdmJ5dGUsIHNlY2J5dGVzKSwgMCwgMTI4KQogICAgdGhpcy5yY3ZtYWMgPSBDcnlwdG9KUy5TSEExKENyeXB0b0pTLmVuYy5MYXRpbjEucGFyc2UodGhpcy5yY3ZlbmMpKQogICAgdGhpcy5yY3ZtYWMgPSB0aGlzLnJjdm1hYy50b1N0cmluZyhDcnlwdG9KUy5lbmMuTGF0aW4xKQogICAgdGhpcy5yY3ZtYWN1c2VkID0gZmFsc2UKCiAgICAvLyBleHRyYSBzeW1tZXRyaWMga2V5CiAgICB0aGlzLmV4dHJhX3N5bWtleSA9IEhMUC5oMignXHhmZicsIHNlY2J5dGVzKQoKICAgIC8vIGNvdW50ZXJzCiAgICB0aGlzLnNlbmRfY291bnRlciA9IDAKICAgIHRoaXMucmN2X2NvdW50ZXIgPSAwCiAgfQoKICBPVFIucHJvdG90eXBlLnJvdGF0ZU91cktleXMgPSBmdW5jdGlvbiAoKSB7CgogICAgLy8gcmV2ZWFsIG9sZCBtYWMga2V5cwogICAgdmFyIHNlbGYgPSB0aGlzCiAgICB0aGlzLnNlc3NLZXlzWzFdLmZvckVhY2goZnVuY3Rpb24gKHNrKSB7CiAgICAgIGlmIChzayAmJiBzay5yY3ZtYWN1c2VkKSBzZWxmLm9sZE1hY0tleXMucHVzaChzay5yY3ZtYWMpCiAgICB9KQoKICAgIC8vIHJvdGF0ZSBvdXIga2V5cwogICAgdGhpcy5vdXJfb2xkX2RoID0gdGhpcy5vdXJfZGgKICAgIHRoaXMub3VyX2RoID0gdGhpcy5kaCgpCiAgICB0aGlzLm91cl9rZXlpZCArPSAxCgogICAgdGhpcy5zZXNzS2V5c1sxXVswXSA9IHRoaXMuc2Vzc0tleXNbMF1bMF0KICAgIHRoaXMuc2Vzc0tleXNbMV1bMV0gPSB0aGlzLnNlc3NLZXlzWzBdWzFdCiAgICB0aGlzLnNlc3NLZXlzWzBdID0gWwogICAgICAgIHRoaXMudGhlaXJfeSA/CiAgICAgICAgICAgIG5ldyB0aGlzLkRIU2Vzc2lvbih0aGlzLm91cl9kaCwgdGhpcy50aGVpcl95KSA6IG51bGwKICAgICAgLCB0aGlzLnRoZWlyX29sZF95ID8KICAgICAgICAgICAgbmV3IHRoaXMuREhTZXNzaW9uKHRoaXMub3VyX2RoLCB0aGlzLnRoZWlyX29sZF95KSA6IG51bGwKICAgIF0KCiAgfQoKICBPVFIucHJvdG90eXBlLnJvdGF0ZVRoZWlyS2V5cyA9IGZ1bmN0aW9uICh0aGVpcl95KSB7CgogICAgLy8gaW5jcmVtZW50IHRoZWlyIGtleWlkCiAgICB0aGlzLnRoZWlyX2tleWlkICs9IDEKCiAgICAvLyByZXZlYWwgb2xkIG1hYyBrZXlzCiAgICB2YXIgc2VsZiA9IHRoaXMKICAgIHRoaXMuc2Vzc0tleXMuZm9yRWFjaChmdW5jdGlvbiAoc2spIHsKICAgICAgaWYgKHNrWzFdICYmIHNrWzFdLnJjdm1hY3VzZWQpIHNlbGYub2xkTWFjS2V5cy5wdXNoKHNrWzFdLnJjdm1hYykKICAgIH0pCgogICAgLy8gcm90YXRlIHRoZWlyIGtleXMgLyBzZXNzaW9uCiAgICB0aGlzLnRoZWlyX29sZF95ID0gdGhpcy50aGVpcl95CiAgICB0aGlzLnNlc3NLZXlzWzBdWzFdID0gdGhpcy5zZXNzS2V5c1swXVswXQogICAgdGhpcy5zZXNzS2V5c1sxXVsxXSA9IHRoaXMuc2Vzc0tleXNbMV1bMF0KCiAgICAvLyBuZXcga2V5cyAvIHNlc3Npb25zCiAgICB0aGlzLnRoZWlyX3kgPSB0aGVpcl95CiAgICB0aGlzLnNlc3NLZXlzWzBdWzBdID0gbmV3IHRoaXMuREhTZXNzaW9uKHRoaXMub3VyX2RoLCB0aGlzLnRoZWlyX3kpCiAgICB0aGlzLnNlc3NLZXlzWzFdWzBdID0gbmV3IHRoaXMuREhTZXNzaW9uKHRoaXMub3VyX29sZF9kaCwgdGhpcy50aGVpcl95KQoKICB9CgogIE9UUi5wcm90b3R5cGUucHJlcGFyZU1zZyA9IGZ1bmN0aW9uIChtc2csIGVzaykgewogICAgaWYgKHRoaXMubXNnc3RhdGUgIT09IENPTlNULk1TR1NUQVRFX0VOQ1JZUFRFRCB8fCB0aGlzLnRoZWlyX2tleWlkID09PSAwKQogICAgICByZXR1cm4gdGhpcy5lcnJvcignTm90IHJlYWR5IHRvIGVuY3J5cHQuJykKCiAgICB2YXIgc2Vzc0tleXMgPSB0aGlzLnNlc3NLZXlzWzFdWzBdCgogICAgaWYgKHNlc3NLZXlzLnNlbmRfY291bnRlciA+PSBNQVhfSU5UKQogICAgICByZXR1cm4gdGhpcy5lcnJvcignU2hvdWxkIGhhdmUgcmVrZXllZCBieSBub3cuJykKCiAgICBzZXNzS2V5cy5zZW5kX2NvdW50ZXIgKz0gMQoKICAgIHZhciBjdHIgPSBITFAucGFja0N0cihzZXNzS2V5cy5zZW5kX2NvdW50ZXIpCgogICAgdmFyIHNlbmQgPSB0aGlzLmFrZS5vdHJfdmVyc2lvbiArICdceDAzJyAgLy8gdmVyc2lvbiBhbmQgdHlwZQogICAgdmFyIHYzID0gKHRoaXMuYWtlLm90cl92ZXJzaW9uID09PSBDT05TVC5PVFJfVkVSU0lPTl8zKQoKICAgIGlmICh2MykgewogICAgICBzZW5kICs9IHRoaXMub3VyX2luc3RhbmNlX3RhZwogICAgICBzZW5kICs9IHRoaXMudGhlaXJfaW5zdGFuY2VfdGFnCiAgICB9CgogICAgc2VuZCArPSAnXHgwMCcgIC8vIGZsYWcKICAgIHNlbmQgKz0gSExQLnBhY2tJTlQodGhpcy5vdXJfa2V5aWQgLSAxKQogICAgc2VuZCArPSBITFAucGFja0lOVCh0aGlzLnRoZWlyX2tleWlkKQogICAgc2VuZCArPSBITFAucGFja01QSSh0aGlzLm91cl9kaC5wdWJsaWNLZXkpCiAgICBzZW5kICs9IGN0ci5zdWJzdHJpbmcoMCwgOCkKCiAgICBpZiAoTWF0aC5jZWlsKG1zZy5sZW5ndGggLyA4KSA+PSBNQVhfVUlOVCkgIC8vICogMTYgLyAxMjgKICAgICAgcmV0dXJuIHRoaXMuZXJyb3IoJ01lc3NhZ2UgaXMgdG9vIGxvbmcuJykKCiAgICB2YXIgYWVzID0gSExQLmVuY3J5cHRBZXMoCiAgICAgICAgQ3J5cHRvSlMuZW5jLkxhdGluMS5wYXJzZShtc2cpCiAgICAgICwgc2Vzc0tleXMuc2VuZGVuYwogICAgICAsIGN0cgogICAgKQoKICAgIHNlbmQgKz0gSExQLnBhY2tEYXRhKGFlcykKICAgIHNlbmQgKz0gSExQLm1ha2UxTWFjKHNlbmQsIHNlc3NLZXlzLnNlbmRtYWMpCiAgICBzZW5kICs9IEhMUC5wYWNrRGF0YSh0aGlzLm9sZE1hY0tleXMuc3BsaWNlKDApLmpvaW4oJycpKQoKICAgIHNlbmQgPSBITFAud3JhcE1zZygKICAgICAgICBzZW5kCiAgICAgICwgdGhpcy5mcmFnbWVudF9zaXplCiAgICAgICwgdjMKICAgICAgLCB0aGlzLm91cl9pbnN0YW5jZV90YWcKICAgICAgLCB0aGlzLnRoZWlyX2luc3RhbmNlX3RhZwogICAgKQogICAgaWYgKHNlbmRbMF0pIHJldHVybiB0aGlzLmVycm9yKHNlbmRbMF0pCgogICAgLy8gZW1pdCBleHRyYSBzeW1tZXRyaWMga2V5CiAgICBpZiAoZXNrKSB0aGlzLnRyaWdnZXIoJ2ZpbGUnLCBbJ3NlbmQnLCBzZXNzS2V5cy5leHRyYV9zeW1rZXksIGVza10pCgogICAgcmV0dXJuIHNlbmRbMV0KICB9CgogIE9UUi5wcm90b3R5cGUuaGFuZGxlRGF0YU1zZyA9IGZ1bmN0aW9uIChtc2cpIHsKICAgIHZhciB2dCA9IG1zZy52ZXJzaW9uICsgbXNnLnR5cGUKCiAgICBpZiAodGhpcy5ha2Uub3RyX3ZlcnNpb24gPT09IENPTlNULk9UUl9WRVJTSU9OXzMpCiAgICAgIHZ0ICs9IG1zZy5pbnN0YW5jZV90YWdzCgogICAgdmFyIHR5cGVzID0gWydCWVRFJywgJ0lOVCcsICdJTlQnLCAnTVBJJywgJ0NUUicsICdEQVRBJywgJ01BQycsICdEQVRBJ10KICAgIG1zZyA9IEhMUC5zcGxpdHlwZSh0eXBlcywgbXNnLm1zZykKCiAgICAvLyBpZ25vcmUgZmxhZwogICAgdmFyIGlnbiA9IChtc2dbMF0gPT09ICdceDAxJykKCiAgICBpZiAodGhpcy5tc2dzdGF0ZSAhPT0gQ09OU1QuTVNHU1RBVEVfRU5DUllQVEVEIHx8IG1zZy5sZW5ndGggIT09IDgpIHsKICAgICAgaWYgKCFpZ24pIHRoaXMuZXJyb3IoJ1JlY2VpdmVkIGFuIHVucmVhZGFibGUgZW5jcnlwdGVkIG1lc3NhZ2UuJywgdHJ1ZSkKICAgICAgcmV0dXJuCiAgICB9CgogICAgdmFyIG91cl9rZXlpZCA9IHRoaXMub3VyX2tleWlkIC0gSExQLnJlYWRMZW4obXNnWzJdKQogICAgdmFyIHRoZWlyX2tleWlkID0gdGhpcy50aGVpcl9rZXlpZCAtIEhMUC5yZWFkTGVuKG1zZ1sxXSkKCiAgICBpZiAob3VyX2tleWlkIDwgMCB8fCBvdXJfa2V5aWQgPiAxKSB7CiAgICAgIGlmICghaWduKSB0aGlzLmVycm9yKCdOb3Qgb2Ygb3VyIGxhdGVzdCBrZXlzLicsIHRydWUpCiAgICAgIHJldHVybgogICAgfQoKICAgIGlmICh0aGVpcl9rZXlpZCA8IDAgfHwgdGhlaXJfa2V5aWQgPiAxKSB7CiAgICAgIGlmICghaWduKSB0aGlzLmVycm9yKCdOb3Qgb2YgeW91ciBsYXRlc3Qga2V5cy4nLCB0cnVlKQogICAgICByZXR1cm4KICAgIH0KCiAgICB2YXIgdGhlaXJfeSA9IHRoZWlyX2tleWlkID8gdGhpcy50aGVpcl9vbGRfeSA6IHRoaXMudGhlaXJfeQoKICAgIGlmICh0aGVpcl9rZXlpZCA9PT0gMSAmJiAhdGhlaXJfeSkgewogICAgICBpZiAoIWlnbikgdGhpcy5lcnJvcignRG8gbm90IGhhdmUgdGhhdCBrZXkuJykKICAgICAgcmV0dXJuCiAgICB9CgogICAgdmFyIHNlc3NLZXlzID0gdGhpcy5zZXNzS2V5c1tvdXJfa2V5aWRdW3RoZWlyX2tleWlkXQoKICAgIHZhciBjdHIgPSBITFAudW5wYWNrQ3RyKG1zZ1s0XSkKICAgIGlmIChjdHIgPD0gc2Vzc0tleXMucmN2X2NvdW50ZXIpIHsKICAgICAgaWYgKCFpZ24pIHRoaXMuZXJyb3IoJ0NvdW50ZXIgaW4gbWVzc2FnZSBpcyBub3QgbGFyZ2VyLicpCiAgICAgIHJldHVybgogICAgfQogICAgc2Vzc0tleXMucmN2X2NvdW50ZXIgPSBjdHIKCiAgICAvLyB2ZXJpZnkgbWFjCiAgICB2dCArPSBtc2cuc2xpY2UoMCwgNikuam9pbignJykKICAgIHZhciB2bWFjID0gSExQLm1ha2UxTWFjKHZ0LCBzZXNzS2V5cy5yY3ZtYWMpCgogICAgaWYgKCFITFAuY29tcGFyZShtc2dbNl0sIHZtYWMpKSB7CiAgICAgIGlmICghaWduKSB0aGlzLmVycm9yKCdNQUNzIGRvIG5vdCBtYXRjaC4nKQogICAgICByZXR1cm4KICAgIH0KICAgIHNlc3NLZXlzLnJjdm1hY3VzZWQgPSB0cnVlCgogICAgdmFyIG91dCA9IEhMUC5kZWNyeXB0QWVzKAogICAgICAgIG1zZ1s1XS5zdWJzdHJpbmcoNCkKICAgICAgLCBzZXNzS2V5cy5yY3ZlbmMKICAgICAgLCBITFAucGFkQ3RyKG1zZ1s0XSkKICAgICkKICAgIG91dCA9IG91dC50b1N0cmluZyhDcnlwdG9KUy5lbmMuTGF0aW4xKQoKICAgIGlmICghb3VyX2tleWlkKSB0aGlzLnJvdGF0ZU91cktleXMoKQogICAgaWYgKCF0aGVpcl9rZXlpZCkgdGhpcy5yb3RhdGVUaGVpcktleXMoSExQLnJlYWRNUEkobXNnWzNdKSkKCiAgICAvLyBwYXJzZSBUTFZzCiAgICB2YXIgaW5kID0gb3V0LmluZGV4T2YoJ1x4MDAnKQogICAgaWYgKH5pbmQpIHsKICAgICAgdGhpcy5oYW5kbGVUTFZzKG91dC5zdWJzdHJpbmcoaW5kICsgMSksIHNlc3NLZXlzKQogICAgICBvdXQgPSBvdXQuc3Vic3RyaW5nKDAsIGluZCkKICAgIH0KCiAgICBvdXQgPSBDcnlwdG9KUy5lbmMuTGF0aW4xLnBhcnNlKG91dCkKICAgIHJldHVybiBvdXQudG9TdHJpbmcoQ3J5cHRvSlMuZW5jLlV0ZjgpCiAgfQoKICBPVFIucHJvdG90eXBlLmhhbmRsZVRMVnMgPSBmdW5jdGlvbiAodGx2cywgc2Vzc0tleXMpIHsKICAgIHZhciB0eXBlLCBsZW4sIG1zZwogICAgZm9yICg7IHRsdnMubGVuZ3RoOyApIHsKICAgICAgdHlwZSA9IEhMUC51bnBhY2tTSE9SVCh0bHZzLnN1YnN0cigwLCAyKSkKICAgICAgbGVuID0gSExQLnVucGFja1NIT1JUKHRsdnMuc3Vic3RyKDIsIDIpKQoKICAgICAgbXNnID0gdGx2cy5zdWJzdHIoNCwgbGVuKQoKICAgICAgLy8gVE9ETzogaGFuZGxlIHBhdGhvbG9naWNhbCBjYXNlcyBiZXR0ZXIKICAgICAgaWYgKG1zZy5sZW5ndGggPCBsZW4pIGJyZWFrCgogICAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgICBjYXNlIDE6CiAgICAgICAgICAvLyBEaXNjb25uZWN0ZWQKICAgICAgICAgIHRoaXMubXNnc3RhdGUgPSBDT05TVC5NU0dTVEFURV9GSU5JU0hFRAogICAgICAgICAgdGhpcy50cmlnZ2VyKCdzdGF0dXMnLCBbQ09OU1QuU1RBVFVTX0VORF9PVFJdKQogICAgICAgICAgYnJlYWsKICAgICAgICBjYXNlIDI6IGNhc2UgMzogY2FzZSA0OgogICAgICAgIGNhc2UgNTogY2FzZSA2OiBjYXNlIDc6CiAgICAgICAgICAvLyBTTVAKICAgICAgICAgIGlmICh0aGlzLm1zZ3N0YXRlICE9PSBDT05TVC5NU0dTVEFURV9FTkNSWVBURUQpIHsKICAgICAgICAgICAgaWYgKHRoaXMuc20pIHRoaXMuc20uYWJvcnQoKQogICAgICAgICAgICByZXR1cm4KICAgICAgICAgIH0KICAgICAgICAgIGlmICghdGhpcy5zbSkgdGhpcy5fc21Jbml0KCkKICAgICAgICAgIHRoaXMuc20uaGFuZGxlU00oeyBtc2c6IG1zZywgdHlwZTogdHlwZSB9KQogICAgICAgICAgYnJlYWsKICAgICAgICBjYXNlIDg6CiAgICAgICAgICAvLyB1dGY4IGZpbGVuYW1lcwogICAgICAgICAgbXNnID0gbXNnLnN1YnN0cmluZyg0KSAvLyByZW1vdmUgNC1ieXRlIGluZGljYXRpb24KICAgICAgICAgIG1zZyA9IENyeXB0b0pTLmVuYy5MYXRpbjEucGFyc2UobXNnKQogICAgICAgICAgbXNnID0gbXNnLnRvU3RyaW5nKENyeXB0b0pTLmVuYy5VdGY4KQoKICAgICAgICAgIC8vIEV4dHJhIFN5bWtleQogICAgICAgICAgdGhpcy50cmlnZ2VyKCdmaWxlJywgWydyZWNlaXZlJywgc2Vzc0tleXMuZXh0cmFfc3lta2V5LCBtc2ddKQogICAgICAgICAgYnJlYWsKICAgICAgfQoKICAgICAgdGx2cyA9IHRsdnMuc3Vic3RyaW5nKDQgKyBsZW4pCiAgICB9CiAgfQoKICBPVFIucHJvdG90eXBlLnNtcFNlY3JldCA9IGZ1bmN0aW9uIChzZWNyZXQsIHF1ZXN0aW9uKSB7CiAgICBpZiAodGhpcy5tc2dzdGF0ZSAhPT0gQ09OU1QuTVNHU1RBVEVfRU5DUllQVEVEKQogICAgICByZXR1cm4gdGhpcy5lcnJvcignTXVzdCBiZSBlbmNyeXB0ZWQgZm9yIFNNUC4nKQoKICAgIGlmICh0eXBlb2Ygc2VjcmV0ICE9PSAnc3RyaW5nJyB8fCBzZWNyZXQubGVuZ3RoIDwgMSkKICAgICAgcmV0dXJuIHRoaXMuZXJyb3IoJ1NlY3JldCBpcyByZXF1aXJlZC4nKQoKICAgIGlmICghdGhpcy5zbSkgdGhpcy5fc21Jbml0KCkKCiAgICAvLyB1dGY4IGlucHV0cwogICAgc2VjcmV0ID0gQ3J5cHRvSlMuZW5jLlV0ZjgucGFyc2Uoc2VjcmV0KS50b1N0cmluZyhDcnlwdG9KUy5lbmMuTGF0aW4xKQogICAgcXVlc3Rpb24gPSBDcnlwdG9KUy5lbmMuVXRmOC5wYXJzZShxdWVzdGlvbikudG9TdHJpbmcoQ3J5cHRvSlMuZW5jLkxhdGluMSkKCiAgICB0aGlzLnNtLnJjdlNlY3JldChzZWNyZXQsIHF1ZXN0aW9uKQogIH0KCiAgT1RSLnByb3RvdHlwZS5zZW5kUXVlcnlNc2cgPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgdmVyc2lvbnMgPSB7fQogICAgICAsIG1zZyA9IENPTlNULk9UUl9UQUcKCiAgICBpZiAodGhpcy5BTExPV19WMikgdmVyc2lvbnNbJzInXSA9IHRydWUKICAgIGlmICh0aGlzLkFMTE9XX1YzKSB2ZXJzaW9uc1snMyddID0gdHJ1ZQoKICAgIC8vIGJ1dCB3ZSBkb24ndCBhbGxvdyB2MQogICAgLy8gaWYgKHZlcnNpb25zWycxJ10pIG1zZyArPSAnPycKCiAgICB2YXIgdnMgPSBPYmplY3Qua2V5cyh2ZXJzaW9ucykKICAgIGlmICh2cy5sZW5ndGgpIHsKICAgICAgbXNnICs9ICd2JwogICAgICB2cy5mb3JFYWNoKGZ1bmN0aW9uICh2KSB7CiAgICAgICAgaWYgKHYgIT09ICcxJykgbXNnICs9IHYKICAgICAgfSkKICAgICAgbXNnICs9ICc/JwogICAgfQoKICAgIHRoaXMuaW8obXNnKQogICAgdGhpcy50cmlnZ2VyKCdzdGF0dXMnLCBbQ09OU1QuU1RBVFVTX1NFTkRfUVVFUlldKQogIH0KCiAgT1RSLnByb3RvdHlwZS5zZW5kTXNnID0gZnVuY3Rpb24gKG1zZywgbWV0YSkgewogICAgaWYgKCB0aGlzLlJFUVVJUkVfRU5DUllQVElPTiB8fAogICAgICAgICB0aGlzLm1zZ3N0YXRlICE9PSBDT05TVC5NU0dTVEFURV9QTEFJTlRFWFQKICAgICkgewogICAgICBtc2cgPSBDcnlwdG9KUy5lbmMuVXRmOC5wYXJzZShtc2cpCiAgICAgIG1zZyA9IG1zZy50b1N0cmluZyhDcnlwdG9KUy5lbmMuTGF0aW4xKQogICAgfQoKICAgIHN3aXRjaCAodGhpcy5tc2dzdGF0ZSkgewogICAgICBjYXNlIENPTlNULk1TR1NUQVRFX1BMQUlOVEVYVDoKICAgICAgICBpZiAodGhpcy5SRVFVSVJFX0VOQ1JZUFRJT04pIHsKICAgICAgICAgIHRoaXMuc3RvcmVkTWdzLnB1c2goe21zZzogbXNnLCBtZXRhOiBtZXRhfSkKICAgICAgICAgIHRoaXMuc2VuZFF1ZXJ5TXNnKCkKICAgICAgICAgIHJldHVybgogICAgICAgIH0KICAgICAgICBpZiAodGhpcy5TRU5EX1dISVRFU1BBQ0VfVEFHICYmICF0aGlzLnJlY2VpdmVkUGxhaW50ZXh0KSB7CiAgICAgICAgICBtc2cgKz0gQ09OU1QuV0hJVEVTUEFDRV9UQUcgIC8vIDE2IGJ5dGUgdGFnCiAgICAgICAgICBpZiAodGhpcy5BTExPV19WMykgbXNnICs9IENPTlNULldISVRFU1BBQ0VfVEFHX1YzCiAgICAgICAgICBpZiAodGhpcy5BTExPV19WMikgbXNnICs9IENPTlNULldISVRFU1BBQ0VfVEFHX1YyCiAgICAgICAgfQogICAgICAgIGJyZWFrCiAgICAgIGNhc2UgQ09OU1QuTVNHU1RBVEVfRklOSVNIRUQ6CiAgICAgICAgdGhpcy5zdG9yZWRNZ3MucHVzaCh7bXNnOiBtc2csIG1ldGE6IG1ldGF9KQogICAgICAgIHRoaXMuZXJyb3IoJ01lc3NhZ2UgY2Fubm90IGJlIHNlbnQgYXQgdGhpcyB0aW1lLicpCiAgICAgICAgcmV0dXJuCiAgICAgIGNhc2UgQ09OU1QuTVNHU1RBVEVfRU5DUllQVEVEOgogICAgICAgIG1zZyA9IHRoaXMucHJlcGFyZU1zZyhtc2cpCiAgICAgICAgYnJlYWsKICAgICAgZGVmYXVsdDoKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Vua25vd24gbWVzc2FnZSBzdGF0ZS4nKQogICAgfQoKICAgIGlmIChtc2cpIHRoaXMuaW8obXNnLCBtZXRhKQogIH0KCiAgT1RSLnByb3RvdHlwZS5yZWNlaXZlTXNnID0gZnVuY3Rpb24gKG1zZykgewoKICAgIC8vIHBhcnNlIHR5cGUKICAgIG1zZyA9IFBhcnNlLnBhcnNlTXNnKHRoaXMsIG1zZykKCiAgICBpZiAoIW1zZykgcmV0dXJuCgogICAgc3dpdGNoIChtc2cuY2xzKSB7CiAgICAgIGNhc2UgJ2Vycm9yJzoKICAgICAgICB0aGlzLmVycm9yKG1zZy5tc2cpCiAgICAgICAgcmV0dXJuCiAgICAgIGNhc2UgJ2FrZSc6CiAgICAgICAgaWYgKCBtc2cudmVyc2lvbiA9PT0gQ09OU1QuT1RSX1ZFUlNJT05fMyAmJgogICAgICAgICAgdGhpcy5jaGVja0luc3RhbmNlVGFncyhtc2cuaW5zdGFuY2VfdGFncykKICAgICAgICApIHJldHVybiAgLy8gaWdub3JlCiAgICAgICAgdGhpcy5ha2UuaGFuZGxlQUtFKG1zZykKICAgICAgICByZXR1cm4KICAgICAgY2FzZSAnZGF0YSc6CiAgICAgICAgaWYgKCBtc2cudmVyc2lvbiA9PT0gQ09OU1QuT1RSX1ZFUlNJT05fMyAmJgogICAgICAgICAgdGhpcy5jaGVja0luc3RhbmNlVGFncyhtc2cuaW5zdGFuY2VfdGFncykKICAgICAgICApIHJldHVybiAgLy8gaWdub3JlCiAgICAgICAgbXNnLm1zZyA9IHRoaXMuaGFuZGxlRGF0YU1zZyhtc2cpCiAgICAgICAgbXNnLmVuY3J5cHRlZCA9IHRydWUKICAgICAgICBicmVhawogICAgICBjYXNlICdxdWVyeSc6CiAgICAgICAgaWYgKHRoaXMubXNnc3RhdGUgPT09IENPTlNULk1TR1NUQVRFX0VOQ1JZUFRFRCkgdGhpcy5fYWtlSW5pdCgpCiAgICAgICAgdGhpcy5kb0FLRShtc2cpCiAgICAgICAgYnJlYWsKICAgICAgZGVmYXVsdDoKICAgICAgICAvLyBjaGVjayBmb3IgZW5jcnlwdGVkCiAgICAgICAgaWYgKCB0aGlzLlJFUVVJUkVfRU5DUllQVElPTiB8fAogICAgICAgICAgICAgdGhpcy5tc2dzdGF0ZSAhPT0gQ09OU1QuTVNHU1RBVEVfUExBSU5URVhUCiAgICAgICAgKSB0aGlzLmVycm9yKCdSZWNlaXZlZCBhbiB1bmVuY3J5cHRlZCBtZXNzYWdlLicpCgogICAgICAgIC8vIHJlY2VpdmVkIGEgcGxhaW50ZXh0IG1lc3NhZ2UKICAgICAgICAvLyBzdG9wIHNlbmRpbmcgdGhlIHdoaXRlc3BhY2UgdGFnCiAgICAgICAgdGhpcy5yZWNlaXZlZFBsYWludGV4dCA9IHRydWUKCiAgICAgICAgLy8gcmVjZWl2ZWQgYSB3aGl0ZXNwYWNlIHRhZwogICAgICAgIGlmICh0aGlzLldISVRFU1BBQ0VfU1RBUlRfQUtFICYmIG1zZy52ZXIubGVuZ3RoID4gMCkKICAgICAgICAgIHRoaXMuZG9BS0UobXNnKQogICAgfQoKICAgIGlmIChtc2cubXNnKSB0aGlzLnRyaWdnZXIoJ3VpJywgW21zZy5tc2csICEhbXNnLmVuY3J5cHRlZF0pCiAgfQoKICBPVFIucHJvdG90eXBlLmNoZWNrSW5zdGFuY2VUYWdzID0gZnVuY3Rpb24gKGl0KSB7CiAgICB2YXIgdGhlaXJfaXQgPSBITFAucmVhZExlbihpdC5zdWJzdHIoMCwgNCkpCiAgICB2YXIgb3VyX2l0ID0gSExQLnJlYWRMZW4oaXQuc3Vic3RyKDQsIDQpKQoKICAgIGlmIChvdXJfaXQgJiYgb3VyX2l0ICE9PSBITFAucmVhZExlbih0aGlzLm91cl9pbnN0YW5jZV90YWcpKQogICAgICByZXR1cm4gdHJ1ZQoKICAgIGlmIChITFAucmVhZExlbih0aGlzLnRoZWlyX2luc3RhbmNlX3RhZykpIHsKICAgICAgaWYgKEhMUC5yZWFkTGVuKHRoaXMudGhlaXJfaW5zdGFuY2VfdGFnKSAhPT0gdGhlaXJfaXQpIHJldHVybiB0cnVlCiAgICB9IGVsc2UgewogICAgICBpZiAodGhlaXJfaXQgPCAxMDApIHJldHVybiB0cnVlCiAgICAgIHRoaXMudGhlaXJfaW5zdGFuY2VfdGFnID0gSExQLnBhY2tJTlQodGhlaXJfaXQpCiAgICB9CiAgfQoKICBPVFIucHJvdG90eXBlLmRvQUtFID0gZnVuY3Rpb24gKG1zZykgewogICAgaWYgKHRoaXMuQUxMT1dfVjMgJiYgfm1zZy52ZXIuaW5kZXhPZihDT05TVC5PVFJfVkVSU0lPTl8zKSkgewogICAgICB0aGlzLmFrZS5pbml0aWF0ZUFLRShDT05TVC5PVFJfVkVSU0lPTl8zKQogICAgfSBlbHNlIGlmICh0aGlzLkFMTE9XX1YyICYmIH5tc2cudmVyLmluZGV4T2YoQ09OU1QuT1RSX1ZFUlNJT05fMikpIHsKICAgICAgdGhpcy5ha2UuaW5pdGlhdGVBS0UoQ09OU1QuT1RSX1ZFUlNJT05fMikKICAgIH0gZWxzZSB7CiAgICAgIC8vIGlzIHRoaXMgYW4gZXJyb3I/CiAgICAgIHRoaXMuZXJyb3IoJ09UUiBjb252ZXJzYXRpb24gcmVxdWVzdGVkLCAnICsKICAgICAgICAnYnV0IG5vIGNvbXBhdGlibGUgcHJvdG9jb2wgdmVyc2lvbiBmb3VuZC4nKQogICAgfQogIH0KCiAgT1RSLnByb3RvdHlwZS5lcnJvciA9IGZ1bmN0aW9uIChlcnIsIHNlbmQpIHsKICAgIGlmIChzZW5kKSB7CiAgICAgIGlmICghdGhpcy5kZWJ1ZykgZXJyID0gIkFuIE9UUiBlcnJvciBoYXMgb2NjdXJyZWQuIgogICAgICBlcnIgPSAnP09UUiBFcnJvcjonICsgZXJyCiAgICAgIHRoaXMuaW8oZXJyKQogICAgICByZXR1cm4KICAgIH0KICAgIHRoaXMudHJpZ2dlcignZXJyb3InLCBbZXJyXSkKICB9CgogIE9UUi5wcm90b3R5cGUuc2VuZFN0b3JlZCA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciBzZWxmID0gdGhpcwogICAgOyh0aGlzLnN0b3JlZE1ncy5zcGxpY2UoMCkpLmZvckVhY2goZnVuY3Rpb24gKGVsZW0pIHsKICAgICAgdmFyIG1zZyA9IHNlbGYucHJlcGFyZU1zZyhlbGVtLm1zZykKICAgICAgc2VsZi5pbyhtc2csIGVsZW0ubWV0YSkKICAgIH0pCiAgfQoKICBPVFIucHJvdG90eXBlLnNlbmRGaWxlID0gZnVuY3Rpb24gKGZpbGVuYW1lKSB7CiAgICBpZiAodGhpcy5tc2dzdGF0ZSAhPT0gQ09OU1QuTVNHU1RBVEVfRU5DUllQVEVEKQogICAgICByZXR1cm4gdGhpcy5lcnJvcignTm90IHJlYWR5IHRvIGVuY3J5cHQuJykKCiAgICBpZiAodGhpcy5ha2Uub3RyX3ZlcnNpb24gIT09IENPTlNULk9UUl9WRVJTSU9OXzMpCiAgICAgIHJldHVybiB0aGlzLmVycm9yKCdQcm90b2NvbCB2MyByZXF1aXJlZC4nKQoKICAgIGlmICghZmlsZW5hbWUpIHJldHVybiB0aGlzLmVycm9yKCdQbGVhc2Ugc3BlY2lmeSBhIGZpbGVuYW1lLicpCgogICAgLy8gdXRmOCBmaWxlbmFtZXMKICAgIHZhciBsMW5hbWUgPSBDcnlwdG9KUy5lbmMuVXRmOC5wYXJzZShmaWxlbmFtZSkKICAgIGwxbmFtZSA9IGwxbmFtZS50b1N0cmluZyhDcnlwdG9KUy5lbmMuTGF0aW4xKQoKICAgIGlmIChsMW5hbWUubGVuZ3RoID49IDY1NTMyKSByZXR1cm4gdGhpcy5lcnJvcignZmlsZW5hbWUgaXMgdG9vIGxvbmcuJykKCiAgICB2YXIgbXNnID0gJ1x4MDAnICAvLyBudWxsIGJ5dGUKICAgIG1zZyArPSAnXHgwMFx4MDgnICAvLyB0eXBlIDggdGx2CiAgICBtc2cgKz0gSExQLnBhY2tTSE9SVCg0ICsgbDFuYW1lLmxlbmd0aCkgIC8vIGxlbmd0aCBvZiB2YWx1ZQogICAgbXNnICs9ICdceDAwXHgwMFx4MDBceDAxJyAgLy8gZm91ciBieXRlcyBpbmRpY2F0aW5nIGZpbGUKICAgIG1zZyArPSBsMW5hbWUKCiAgICBtc2cgPSB0aGlzLnByZXBhcmVNc2cobXNnLCBmaWxlbmFtZSkKICAgIHRoaXMuaW8obXNnKQogIH0KCiAgT1RSLnByb3RvdHlwZS5lbmRPdHIgPSBmdW5jdGlvbiAoKSB7CiAgICBpZiAodGhpcy5tc2dzdGF0ZSA9PT0gQ09OU1QuTVNHU1RBVEVfRU5DUllQVEVEKSB7CiAgICAgIHRoaXMuc2VuZE1zZygnXHgwMFx4MDBceDAxXHgwMFx4MDAnKQogICAgICBpZiAodGhpcy5zbSkgewogICAgICAgIGlmICh0aGlzLnNtdykgdGhpcy5zbS53b3JrZXIudGVybWluYXRlKCkgIC8vIGRlc3Ryb3kgd2Vid29ya2VyCiAgICAgICAgdGhpcy5zbSA9IG51bGwKICAgICAgfQogICAgfQogICAgdGhpcy5tc2dzdGF0ZSA9IENPTlNULk1TR1NUQVRFX1BMQUlOVEVYVAogICAgdGhpcy5yZWNlaXZlZFBsYWludGV4dCA9IGZhbHNlCiAgICB0aGlzLnRyaWdnZXIoJ3N0YXR1cycsIFtDT05TVC5TVEFUVVNfRU5EX09UUl0pCiAgfQoKICAvLyBhdHRhY2ggbWV0aG9kcwoKICBPVFIubWFrZUluc3RhbmNlVGFnID0gZnVuY3Rpb24gKCkgewogICAgdmFyIG51bSA9IEJpZ0ludC5yYW5kQmlnSW50KDMyKQogICAgaWYgKEJpZ0ludC5ncmVhdGVyKEJpZ0ludC5zdHIyYmlnSW50KCcxMDAnLCAxNiksIG51bSkpCiAgICAgIHJldHVybiBPVFIubWFrZUluc3RhbmNlVGFnKCkKICAgIHJldHVybiBITFAucGFja0lOVChwYXJzZUludChCaWdJbnQuYmlnSW50MnN0cihudW0sIDEwKSwgMTApKQogIH0KCn0pLmNhbGwodGhpcykKCgogIHJldHVybiB7CiAgICAgIE9UUjogdGhpcy5PVFIKICAgICwgRFNBOiB0aGlzLkRTQQogIH0KCn0pKQo7Ci8vISBtb21lbnQuanMKLy8hIHZlcnNpb24gOiAyLjYuMAovLyEgYXV0aG9ycyA6IFRpbSBXb29kLCBJc2tyZW4gQ2hlcm5ldiwgTW9tZW50LmpzIGNvbnRyaWJ1dG9ycwovLyEgbGljZW5zZSA6IE1JVAovLyEgbW9tZW50anMuY29tCgooZnVuY3Rpb24gKHVuZGVmaW5lZCkgewoKICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAgICAgICBDb25zdGFudHMKICAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCiAgICB2YXIgbW9tZW50LAogICAgICAgIFZFUlNJT04gPSAiMi42LjAiLAogICAgICAgIC8vIHRoZSBnbG9iYWwtc2NvcGUgdGhpcyBpcyBOT1QgdGhlIGdsb2JhbCBvYmplY3QgaW4gTm9kZS5qcwogICAgICAgIGdsb2JhbFNjb3BlID0gdHlwZW9mIGdsb2JhbCAhPT0gJ3VuZGVmaW5lZCcgPyBnbG9iYWwgOiB0aGlzLAogICAgICAgIG9sZEdsb2JhbE1vbWVudCwKICAgICAgICByb3VuZCA9IE1hdGgucm91bmQsCiAgICAgICAgaSwKCiAgICAgICAgWUVBUiA9IDAsCiAgICAgICAgTU9OVEggPSAxLAogICAgICAgIERBVEUgPSAyLAogICAgICAgIEhPVVIgPSAzLAogICAgICAgIE1JTlVURSA9IDQsCiAgICAgICAgU0VDT05EID0gNSwKICAgICAgICBNSUxMSVNFQ09ORCA9IDYsCgogICAgICAgIC8vIGludGVybmFsIHN0b3JhZ2UgZm9yIGxhbmd1YWdlIGNvbmZpZyBmaWxlcwogICAgICAgIGxhbmd1YWdlcyA9IHt9LAoKICAgICAgICAvLyBtb21lbnQgaW50ZXJuYWwgcHJvcGVydGllcwogICAgICAgIG1vbWVudFByb3BlcnRpZXMgPSB7CiAgICAgICAgICAgIF9pc0FNb21lbnRPYmplY3Q6IG51bGwsCiAgICAgICAgICAgIF9pIDogbnVsbCwKICAgICAgICAgICAgX2YgOiBudWxsLAogICAgICAgICAgICBfbCA6IG51bGwsCiAgICAgICAgICAgIF9zdHJpY3QgOiBudWxsLAogICAgICAgICAgICBfaXNVVEMgOiBudWxsLAogICAgICAgICAgICBfb2Zmc2V0IDogbnVsbCwgIC8vIG9wdGlvbmFsLiBDb21iaW5lIHdpdGggX2lzVVRDCiAgICAgICAgICAgIF9wZiA6IG51bGwsCiAgICAgICAgICAgIF9sYW5nIDogbnVsbCAgLy8gb3B0aW9uYWwKICAgICAgICB9LAoKICAgICAgICAvLyBjaGVjayBmb3Igbm9kZUpTCiAgICAgICAgaGFzTW9kdWxlID0gKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnICYmIG1vZHVsZS5leHBvcnRzKSwKCiAgICAgICAgLy8gQVNQLk5FVCBqc29uIGRhdGUgZm9ybWF0IHJlZ2V4CiAgICAgICAgYXNwTmV0SnNvblJlZ2V4ID0gL15cLz9EYXRlXCgoXC0/XGQrKS9pLAogICAgICAgIGFzcE5ldFRpbWVTcGFuSnNvblJlZ2V4ID0gLyhcLSk/KD86KFxkKilcLik/KFxkKylcOihcZCspKD86XDooXGQrKVwuPyhcZHszfSk/KT8vLAoKICAgICAgICAvLyBmcm9tIGh0dHA6Ly9kb2NzLmNsb3N1cmUtbGlicmFyeS5nb29nbGVjb2RlLmNvbS9naXQvY2xvc3VyZV9nb29nX2RhdGVfZGF0ZS5qcy5zb3VyY2UuaHRtbAogICAgICAgIC8vIHNvbWV3aGF0IG1vcmUgaW4gbGluZSB3aXRoIDQuNC4zLjIgMjAwNCBzcGVjLCBidXQgYWxsb3dzIGRlY2ltYWwgYW55d2hlcmUKICAgICAgICBpc29EdXJhdGlvblJlZ2V4ID0gL14oLSk/UCg/Oig/OihbMC05LC5dKilZKT8oPzooWzAtOSwuXSopTSk/KD86KFswLTksLl0qKUQpPyg/OlQoPzooWzAtOSwuXSopSCk/KD86KFswLTksLl0qKU0pPyg/OihbMC05LC5dKilTKT8pP3woWzAtOSwuXSopVykkLywKCiAgICAgICAgLy8gZm9ybWF0IHRva2VucwogICAgICAgIGZvcm1hdHRpbmdUb2tlbnMgPSAvKFxbW15cW10qXF0pfChcXCk/KE1vfE1NP00/TT98RG98REREb3xERD9EP0Q/fGRkZD9kP3xkbz98d1tvfHddP3xXW298V10/fFF8WVlZWVlZfFlZWVlZfFlZWVl8WVl8Z2coZ2dnPyk/fEdHKEdHRz8pP3xlfEV8YXxBfGhoP3xISD98bW0/fHNzP3xTezEsNH18WHx6ej98Wlo/fC4pL2csCiAgICAgICAgbG9jYWxGb3JtYXR0aW5nVG9rZW5zID0gLyhcW1teXFtdKlxdKXwoXFwpPyhMVHxMTD9MP0w/fGx7MSw0fSkvZywKCiAgICAgICAgLy8gcGFyc2luZyB0b2tlbiByZWdleGVzCiAgICAgICAgcGFyc2VUb2tlbk9uZU9yVHdvRGlnaXRzID0gL1xkXGQ/LywgLy8gMCAtIDk5CiAgICAgICAgcGFyc2VUb2tlbk9uZVRvVGhyZWVEaWdpdHMgPSAvXGR7MSwzfS8sIC8vIDAgLSA5OTkKICAgICAgICBwYXJzZVRva2VuT25lVG9Gb3VyRGlnaXRzID0gL1xkezEsNH0vLCAvLyAwIC0gOTk5OQogICAgICAgIHBhcnNlVG9rZW5PbmVUb1NpeERpZ2l0cyA9IC9bK1wtXT9cZHsxLDZ9LywgLy8gLTk5OSw5OTkgLSA5OTksOTk5CiAgICAgICAgcGFyc2VUb2tlbkRpZ2l0cyA9IC9cZCsvLCAvLyBub256ZXJvIG51bWJlciBvZiBkaWdpdHMKICAgICAgICBwYXJzZVRva2VuV29yZCA9IC9bMC05XSpbJ2Etelx1MDBBMC1cdTA1RkZcdTA3MDAtXHVEN0ZGXHVGOTAwLVx1RkRDRlx1RkRGMC1cdUZGRUZdK3xbXHUwNjAwLVx1MDZGRlwvXSsoXHMqP1tcdTA2MDAtXHUwNkZGXSspezEsMn0vaSwgLy8gYW55IHdvcmQgKG9yIHR3bykgY2hhcmFjdGVycyBvciBudW1iZXJzIGluY2x1ZGluZyB0d28vdGhyZWUgd29yZCBtb250aCBpbiBhcmFiaWMuCiAgICAgICAgcGFyc2VUb2tlblRpbWV6b25lID0gL1p8W1wrXC1dXGRcZDo/XGRcZC9naSwgLy8gKzAwOjAwIC0wMDowMCArMDAwMCAtMDAwMCBvciBaCiAgICAgICAgcGFyc2VUb2tlblQgPSAvVC9pLCAvLyBUIChJU08gc2VwYXJhdG9yKQogICAgICAgIHBhcnNlVG9rZW5UaW1lc3RhbXBNcyA9IC9bXCtcLV0/XGQrKFwuXGR7MSwzfSk/LywgLy8gMTIzNDU2Nzg5IDEyMzQ1Njc4OS4xMjMKICAgICAgICBwYXJzZVRva2VuT3JkaW5hbCA9IC9cZHsxLDJ9LywKCiAgICAgICAgLy9zdHJpY3QgcGFyc2luZyByZWdleGVzCiAgICAgICAgcGFyc2VUb2tlbk9uZURpZ2l0ID0gL1xkLywgLy8gMCAtIDkKICAgICAgICBwYXJzZVRva2VuVHdvRGlnaXRzID0gL1xkXGQvLCAvLyAwMCAtIDk5CiAgICAgICAgcGFyc2VUb2tlblRocmVlRGlnaXRzID0gL1xkezN9LywgLy8gMDAwIC0gOTk5CiAgICAgICAgcGFyc2VUb2tlbkZvdXJEaWdpdHMgPSAvXGR7NH0vLCAvLyAwMDAwIC0gOTk5OQogICAgICAgIHBhcnNlVG9rZW5TaXhEaWdpdHMgPSAvWystXT9cZHs2fS8sIC8vIC05OTksOTk5IC0gOTk5LDk5OQogICAgICAgIHBhcnNlVG9rZW5TaWduZWROdW1iZXIgPSAvWystXT9cZCsvLCAvLyAtaW5mIC0gaW5mCgogICAgICAgIC8vIGlzbyA4NjAxIHJlZ2V4CiAgICAgICAgLy8gMDAwMC0wMC0wMCAwMDAwLVcwMCBvciAwMDAwLVcwMC0wICsgVCArIDAwIG9yIDAwOjAwIG9yIDAwOjAwOjAwIG9yIDAwOjAwOjAwLjAwMCArICswMDowMCBvciArMDAwMCBvciArMDApCiAgICAgICAgaXNvUmVnZXggPSAvXlxzKig/OlsrLV1cZHs2fXxcZHs0fSktKD86KFxkXGQtXGRcZCl8KFdcZFxkJCl8KFdcZFxkLVxkKXwoXGRcZFxkKSkoKFR8ICkoXGRcZCg6XGRcZCg6XGRcZChcLlxkKyk/KT8pPyk/KFtcK1wtXVxkXGQoPzo6P1xkXGQpP3xccypaKT8pPyQvLAoKICAgICAgICBpc29Gb3JtYXQgPSAnWVlZWS1NTS1ERFRISDptbTpzc1onLAoKICAgICAgICBpc29EYXRlcyA9IFsKICAgICAgICAgICAgWydZWVlZWVktTU0tREQnLCAvWystXVxkezZ9LVxkezJ9LVxkezJ9L10sCiAgICAgICAgICAgIFsnWVlZWS1NTS1ERCcsIC9cZHs0fS1cZHsyfS1cZHsyfS9dLAogICAgICAgICAgICBbJ0dHR0ctW1ddV1ctRScsIC9cZHs0fS1XXGR7Mn0tXGQvXSwKICAgICAgICAgICAgWydHR0dHLVtXXVdXJywgL1xkezR9LVdcZHsyfS9dLAogICAgICAgICAgICBbJ1lZWVktREREJywgL1xkezR9LVxkezN9L10KICAgICAgICBdLAoKICAgICAgICAvLyBpc28gdGltZSBmb3JtYXRzIGFuZCByZWdleGVzCiAgICAgICAgaXNvVGltZXMgPSBbCiAgICAgICAgICAgIFsnSEg6bW06c3MuU1NTUycsIC8oVHwgKVxkXGQ6XGRcZDpcZFxkXC5cZCsvXSwKICAgICAgICAgICAgWydISDptbTpzcycsIC8oVHwgKVxkXGQ6XGRcZDpcZFxkL10sCiAgICAgICAgICAgIFsnSEg6bW0nLCAvKFR8IClcZFxkOlxkXGQvXSwKICAgICAgICAgICAgWydISCcsIC8oVHwgKVxkXGQvXQogICAgICAgIF0sCgogICAgICAgIC8vIHRpbWV6b25lIGNodW5rZXIgIisxMDowMCIgPiBbIjEwIiwgIjAwIl0gb3IgIi0xNTMwIiA+IFsiLTE1IiwgIjMwIl0KICAgICAgICBwYXJzZVRpbWV6b25lQ2h1bmtlciA9IC8oW1wrXC1dfFxkXGQpL2dpLAoKICAgICAgICAvLyBnZXR0ZXIgYW5kIHNldHRlciBuYW1lcwogICAgICAgIHByb3h5R2V0dGVyc0FuZFNldHRlcnMgPSAnRGF0ZXxIb3Vyc3xNaW51dGVzfFNlY29uZHN8TWlsbGlzZWNvbmRzJy5zcGxpdCgnfCcpLAogICAgICAgIHVuaXRNaWxsaXNlY29uZEZhY3RvcnMgPSB7CiAgICAgICAgICAgICdNaWxsaXNlY29uZHMnIDogMSwKICAgICAgICAgICAgJ1NlY29uZHMnIDogMWUzLAogICAgICAgICAgICAnTWludXRlcycgOiA2ZTQsCiAgICAgICAgICAgICdIb3VycycgOiAzNmU1LAogICAgICAgICAgICAnRGF5cycgOiA4NjRlNSwKICAgICAgICAgICAgJ01vbnRocycgOiAyNTkyZTYsCiAgICAgICAgICAgICdZZWFycycgOiAzMTUzNmU2CiAgICAgICAgfSwKCiAgICAgICAgdW5pdEFsaWFzZXMgPSB7CiAgICAgICAgICAgIG1zIDogJ21pbGxpc2Vjb25kJywKICAgICAgICAgICAgcyA6ICdzZWNvbmQnLAogICAgICAgICAgICBtIDogJ21pbnV0ZScsCiAgICAgICAgICAgIGggOiAnaG91cicsCiAgICAgICAgICAgIGQgOiAnZGF5JywKICAgICAgICAgICAgRCA6ICdkYXRlJywKICAgICAgICAgICAgdyA6ICd3ZWVrJywKICAgICAgICAgICAgVyA6ICdpc29XZWVrJywKICAgICAgICAgICAgTSA6ICdtb250aCcsCiAgICAgICAgICAgIFEgOiAncXVhcnRlcicsCiAgICAgICAgICAgIHkgOiAneWVhcicsCiAgICAgICAgICAgIERERCA6ICdkYXlPZlllYXInLAogICAgICAgICAgICBlIDogJ3dlZWtkYXknLAogICAgICAgICAgICBFIDogJ2lzb1dlZWtkYXknLAogICAgICAgICAgICBnZzogJ3dlZWtZZWFyJywKICAgICAgICAgICAgR0c6ICdpc29XZWVrWWVhcicKICAgICAgICB9LAoKICAgICAgICBjYW1lbEZ1bmN0aW9ucyA9IHsKICAgICAgICAgICAgZGF5b2Z5ZWFyIDogJ2RheU9mWWVhcicsCiAgICAgICAgICAgIGlzb3dlZWtkYXkgOiAnaXNvV2Vla2RheScsCiAgICAgICAgICAgIGlzb3dlZWsgOiAnaXNvV2VlaycsCiAgICAgICAgICAgIHdlZWt5ZWFyIDogJ3dlZWtZZWFyJywKICAgICAgICAgICAgaXNvd2Vla3llYXIgOiAnaXNvV2Vla1llYXInCiAgICAgICAgfSwKCiAgICAgICAgLy8gZm9ybWF0IGZ1bmN0aW9uIHN0cmluZ3MKICAgICAgICBmb3JtYXRGdW5jdGlvbnMgPSB7fSwKCiAgICAgICAgLy8gdG9rZW5zIHRvIG9yZGluYWxpemUgYW5kIHBhZAogICAgICAgIG9yZGluYWxpemVUb2tlbnMgPSAnREREIHcgVyBNIEQgZCcuc3BsaXQoJyAnKSwKICAgICAgICBwYWRkZWRUb2tlbnMgPSAnTSBEIEggaCBtIHMgdyBXJy5zcGxpdCgnICcpLAoKICAgICAgICBmb3JtYXRUb2tlbkZ1bmN0aW9ucyA9IHsKICAgICAgICAgICAgTSAgICA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm1vbnRoKCkgKyAxOwogICAgICAgICAgICB9LAogICAgICAgICAgICBNTU0gIDogZnVuY3Rpb24gKGZvcm1hdCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubGFuZygpLm1vbnRoc1Nob3J0KHRoaXMsIGZvcm1hdCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIE1NTU0gOiBmdW5jdGlvbiAoZm9ybWF0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5sYW5nKCkubW9udGhzKHRoaXMsIGZvcm1hdCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIEQgICAgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5kYXRlKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIERERCAgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5kYXlPZlllYXIoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZCAgICA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmRheSgpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBkZCAgIDogZnVuY3Rpb24gKGZvcm1hdCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubGFuZygpLndlZWtkYXlzTWluKHRoaXMsIGZvcm1hdCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRkZCAgOiBmdW5jdGlvbiAoZm9ybWF0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5sYW5nKCkud2Vla2RheXNTaG9ydCh0aGlzLCBmb3JtYXQpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBkZGRkIDogZnVuY3Rpb24gKGZvcm1hdCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubGFuZygpLndlZWtkYXlzKHRoaXMsIGZvcm1hdCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHcgICAgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy53ZWVrKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFcgICAgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5pc29XZWVrKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFlZICAgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbGVmdFplcm9GaWxsKHRoaXMueWVhcigpICUgMTAwLCAyKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgWVlZWSA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBsZWZ0WmVyb0ZpbGwodGhpcy55ZWFyKCksIDQpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBZWVlZWSA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBsZWZ0WmVyb0ZpbGwodGhpcy55ZWFyKCksIDUpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBZWVlZWVkgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB2YXIgeSA9IHRoaXMueWVhcigpLCBzaWduID0geSA+PSAwID8gJysnIDogJy0nOwogICAgICAgICAgICAgICAgcmV0dXJuIHNpZ24gKyBsZWZ0WmVyb0ZpbGwoTWF0aC5hYnMoeSksIDYpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBnZyAgIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGxlZnRaZXJvRmlsbCh0aGlzLndlZWtZZWFyKCkgJSAxMDAsIDIpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBnZ2dnIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGxlZnRaZXJvRmlsbCh0aGlzLndlZWtZZWFyKCksIDQpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBnZ2dnZyA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBsZWZ0WmVyb0ZpbGwodGhpcy53ZWVrWWVhcigpLCA1KTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgR0cgICA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBsZWZ0WmVyb0ZpbGwodGhpcy5pc29XZWVrWWVhcigpICUgMTAwLCAyKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgR0dHRyA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBsZWZ0WmVyb0ZpbGwodGhpcy5pc29XZWVrWWVhcigpLCA0KTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgR0dHR0cgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbGVmdFplcm9GaWxsKHRoaXMuaXNvV2Vla1llYXIoKSwgNSk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGUgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy53ZWVrZGF5KCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIEUgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5pc29XZWVrZGF5KCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGEgICAgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5sYW5nKCkubWVyaWRpZW0odGhpcy5ob3VycygpLCB0aGlzLm1pbnV0ZXMoKSwgdHJ1ZSk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIEEgICAgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5sYW5nKCkubWVyaWRpZW0odGhpcy5ob3VycygpLCB0aGlzLm1pbnV0ZXMoKSwgZmFsc2UpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBIICAgIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaG91cnMoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgaCAgICA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmhvdXJzKCkgJSAxMiB8fCAxMjsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgbSAgICA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm1pbnV0ZXMoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgcyAgICA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNlY29uZHMoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgUyAgICA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0b0ludCh0aGlzLm1pbGxpc2Vjb25kcygpIC8gMTAwKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgU1MgICA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBsZWZ0WmVyb0ZpbGwodG9JbnQodGhpcy5taWxsaXNlY29uZHMoKSAvIDEwKSwgMik7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFNTUyAgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbGVmdFplcm9GaWxsKHRoaXMubWlsbGlzZWNvbmRzKCksIDMpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBTU1NTIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGxlZnRaZXJvRmlsbCh0aGlzLm1pbGxpc2Vjb25kcygpLCAzKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgWiAgICA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBhID0gLXRoaXMuem9uZSgpLAogICAgICAgICAgICAgICAgICAgIGIgPSAiKyI7CiAgICAgICAgICAgICAgICBpZiAoYSA8IDApIHsKICAgICAgICAgICAgICAgICAgICBhID0gLWE7CiAgICAgICAgICAgICAgICAgICAgYiA9ICItIjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBiICsgbGVmdFplcm9GaWxsKHRvSW50KGEgLyA2MCksIDIpICsgIjoiICsgbGVmdFplcm9GaWxsKHRvSW50KGEpICUgNjAsIDIpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBaWiAgIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIGEgPSAtdGhpcy56b25lKCksCiAgICAgICAgICAgICAgICAgICAgYiA9ICIrIjsKICAgICAgICAgICAgICAgIGlmIChhIDwgMCkgewogICAgICAgICAgICAgICAgICAgIGEgPSAtYTsKICAgICAgICAgICAgICAgICAgICBiID0gIi0iOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGIgKyBsZWZ0WmVyb0ZpbGwodG9JbnQoYSAvIDYwKSwgMikgKyBsZWZ0WmVyb0ZpbGwodG9JbnQoYSkgJSA2MCwgMik7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHogOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy56b25lQWJicigpOwogICAgICAgICAgICB9LAogICAgICAgICAgICB6eiA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnpvbmVOYW1lKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFggICAgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy51bml4KCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIFEgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5xdWFydGVyKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAoKICAgICAgICBsaXN0cyA9IFsnbW9udGhzJywgJ21vbnRoc1Nob3J0JywgJ3dlZWtkYXlzJywgJ3dlZWtkYXlzU2hvcnQnLCAnd2Vla2RheXNNaW4nXTsKCiAgICBmdW5jdGlvbiBkZWZhdWx0UGFyc2luZ0ZsYWdzKCkgewogICAgICAgIC8vIFdlIG5lZWQgdG8gZGVlcCBjbG9uZSB0aGlzIG9iamVjdCwgYW5kIGVzNSBzdGFuZGFyZCBpcyBub3QgdmVyeQogICAgICAgIC8vIGhlbHBmdWwuCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgZW1wdHkgOiBmYWxzZSwKICAgICAgICAgICAgdW51c2VkVG9rZW5zIDogW10sCiAgICAgICAgICAgIHVudXNlZElucHV0IDogW10sCiAgICAgICAgICAgIG92ZXJmbG93IDogLTIsCiAgICAgICAgICAgIGNoYXJzTGVmdE92ZXIgOiAwLAogICAgICAgICAgICBudWxsSW5wdXQgOiBmYWxzZSwKICAgICAgICAgICAgaW52YWxpZE1vbnRoIDogbnVsbCwKICAgICAgICAgICAgaW52YWxpZEZvcm1hdCA6IGZhbHNlLAogICAgICAgICAgICB1c2VySW52YWxpZGF0ZWQgOiBmYWxzZSwKICAgICAgICAgICAgaXNvOiBmYWxzZQogICAgICAgIH07CiAgICB9CgogICAgZnVuY3Rpb24gZGVwcmVjYXRlKG1zZywgZm4pIHsKICAgICAgICB2YXIgZmlyc3RUaW1lID0gdHJ1ZTsKICAgICAgICBmdW5jdGlvbiBwcmludE1zZygpIHsKICAgICAgICAgICAgaWYgKG1vbWVudC5zdXBwcmVzc0RlcHJlY2F0aW9uV2FybmluZ3MgPT09IGZhbHNlICYmCiAgICAgICAgICAgICAgICAgICAgdHlwZW9mIGNvbnNvbGUgIT09ICd1bmRlZmluZWQnICYmIGNvbnNvbGUud2FybikgewogICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCJEZXByZWNhdGlvbiB3YXJuaW5nOiAiICsgbXNnKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gZXh0ZW5kKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgaWYgKGZpcnN0VGltZSkgewogICAgICAgICAgICAgICAgcHJpbnRNc2coKTsKICAgICAgICAgICAgICAgIGZpcnN0VGltZSA9IGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgIH0sIGZuKTsKICAgIH0KCiAgICBmdW5jdGlvbiBwYWRUb2tlbihmdW5jLCBjb3VudCkgewogICAgICAgIHJldHVybiBmdW5jdGlvbiAoYSkgewogICAgICAgICAgICByZXR1cm4gbGVmdFplcm9GaWxsKGZ1bmMuY2FsbCh0aGlzLCBhKSwgY291bnQpOwogICAgICAgIH07CiAgICB9CiAgICBmdW5jdGlvbiBvcmRpbmFsaXplVG9rZW4oZnVuYywgcGVyaW9kKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmxhbmcoKS5vcmRpbmFsKGZ1bmMuY2FsbCh0aGlzLCBhKSwgcGVyaW9kKTsKICAgICAgICB9OwogICAgfQoKICAgIHdoaWxlIChvcmRpbmFsaXplVG9rZW5zLmxlbmd0aCkgewogICAgICAgIGkgPSBvcmRpbmFsaXplVG9rZW5zLnBvcCgpOwogICAgICAgIGZvcm1hdFRva2VuRnVuY3Rpb25zW2kgKyAnbyddID0gb3JkaW5hbGl6ZVRva2VuKGZvcm1hdFRva2VuRnVuY3Rpb25zW2ldLCBpKTsKICAgIH0KICAgIHdoaWxlIChwYWRkZWRUb2tlbnMubGVuZ3RoKSB7CiAgICAgICAgaSA9IHBhZGRlZFRva2Vucy5wb3AoKTsKICAgICAgICBmb3JtYXRUb2tlbkZ1bmN0aW9uc1tpICsgaV0gPSBwYWRUb2tlbihmb3JtYXRUb2tlbkZ1bmN0aW9uc1tpXSwgMik7CiAgICB9CiAgICBmb3JtYXRUb2tlbkZ1bmN0aW9ucy5EREREID0gcGFkVG9rZW4oZm9ybWF0VG9rZW5GdW5jdGlvbnMuRERELCAzKTsKCgogICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgICAgIENvbnN0cnVjdG9ycwogICAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwoKICAgIGZ1bmN0aW9uIExhbmd1YWdlKCkgewoKICAgIH0KCiAgICAvLyBNb21lbnQgcHJvdG90eXBlIG9iamVjdAogICAgZnVuY3Rpb24gTW9tZW50KGNvbmZpZykgewogICAgICAgIGNoZWNrT3ZlcmZsb3coY29uZmlnKTsKICAgICAgICBleHRlbmQodGhpcywgY29uZmlnKTsKICAgIH0KCiAgICAvLyBEdXJhdGlvbiBDb25zdHJ1Y3RvcgogICAgZnVuY3Rpb24gRHVyYXRpb24oZHVyYXRpb24pIHsKICAgICAgICB2YXIgbm9ybWFsaXplZElucHV0ID0gbm9ybWFsaXplT2JqZWN0VW5pdHMoZHVyYXRpb24pLAogICAgICAgICAgICB5ZWFycyA9IG5vcm1hbGl6ZWRJbnB1dC55ZWFyIHx8IDAsCiAgICAgICAgICAgIHF1YXJ0ZXJzID0gbm9ybWFsaXplZElucHV0LnF1YXJ0ZXIgfHwgMCwKICAgICAgICAgICAgbW9udGhzID0gbm9ybWFsaXplZElucHV0Lm1vbnRoIHx8IDAsCiAgICAgICAgICAgIHdlZWtzID0gbm9ybWFsaXplZElucHV0LndlZWsgfHwgMCwKICAgICAgICAgICAgZGF5cyA9IG5vcm1hbGl6ZWRJbnB1dC5kYXkgfHwgMCwKICAgICAgICAgICAgaG91cnMgPSBub3JtYWxpemVkSW5wdXQuaG91ciB8fCAwLAogICAgICAgICAgICBtaW51dGVzID0gbm9ybWFsaXplZElucHV0Lm1pbnV0ZSB8fCAwLAogICAgICAgICAgICBzZWNvbmRzID0gbm9ybWFsaXplZElucHV0LnNlY29uZCB8fCAwLAogICAgICAgICAgICBtaWxsaXNlY29uZHMgPSBub3JtYWxpemVkSW5wdXQubWlsbGlzZWNvbmQgfHwgMDsKCiAgICAgICAgLy8gcmVwcmVzZW50YXRpb24gZm9yIGRhdGVBZGRSZW1vdmUKICAgICAgICB0aGlzLl9taWxsaXNlY29uZHMgPSArbWlsbGlzZWNvbmRzICsKICAgICAgICAgICAgc2Vjb25kcyAqIDFlMyArIC8vIDEwMDAKICAgICAgICAgICAgbWludXRlcyAqIDZlNCArIC8vIDEwMDAgKiA2MAogICAgICAgICAgICBob3VycyAqIDM2ZTU7IC8vIDEwMDAgKiA2MCAqIDYwCiAgICAgICAgLy8gQmVjYXVzZSBvZiBkYXRlQWRkUmVtb3ZlIHRyZWF0cyAyNCBob3VycyBhcyBkaWZmZXJlbnQgZnJvbSBhCiAgICAgICAgLy8gZGF5IHdoZW4gd29ya2luZyBhcm91bmQgRFNULCB3ZSBuZWVkIHRvIHN0b3JlIHRoZW0gc2VwYXJhdGVseQogICAgICAgIHRoaXMuX2RheXMgPSArZGF5cyArCiAgICAgICAgICAgIHdlZWtzICogNzsKICAgICAgICAvLyBJdCBpcyBpbXBvc3NpYmxlIHRyYW5zbGF0ZSBtb250aHMgaW50byBkYXlzIHdpdGhvdXQga25vd2luZwogICAgICAgIC8vIHdoaWNoIG1vbnRocyB5b3UgYXJlIGFyZSB0YWxraW5nIGFib3V0LCBzbyB3ZSBoYXZlIHRvIHN0b3JlCiAgICAgICAgLy8gaXQgc2VwYXJhdGVseS4KICAgICAgICB0aGlzLl9tb250aHMgPSArbW9udGhzICsKICAgICAgICAgICAgcXVhcnRlcnMgKiAzICsKICAgICAgICAgICAgeWVhcnMgKiAxMjsKCiAgICAgICAgdGhpcy5fZGF0YSA9IHt9OwoKICAgICAgICB0aGlzLl9idWJibGUoKTsKICAgIH0KCiAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAgICAgSGVscGVycwogICAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwoKCiAgICBmdW5jdGlvbiBleHRlbmQoYSwgYikgewogICAgICAgIGZvciAodmFyIGkgaW4gYikgewogICAgICAgICAgICBpZiAoYi5oYXNPd25Qcm9wZXJ0eShpKSkgewogICAgICAgICAgICAgICAgYVtpXSA9IGJbaV07CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChiLmhhc093blByb3BlcnR5KCJ0b1N0cmluZyIpKSB7CiAgICAgICAgICAgIGEudG9TdHJpbmcgPSBiLnRvU3RyaW5nOwogICAgICAgIH0KCiAgICAgICAgaWYgKGIuaGFzT3duUHJvcGVydHkoInZhbHVlT2YiKSkgewogICAgICAgICAgICBhLnZhbHVlT2YgPSBiLnZhbHVlT2Y7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gYTsKICAgIH0KCiAgICBmdW5jdGlvbiBjbG9uZU1vbWVudChtKSB7CiAgICAgICAgdmFyIHJlc3VsdCA9IHt9LCBpOwogICAgICAgIGZvciAoaSBpbiBtKSB7CiAgICAgICAgICAgIGlmIChtLmhhc093blByb3BlcnR5KGkpICYmIG1vbWVudFByb3BlcnRpZXMuaGFzT3duUHJvcGVydHkoaSkpIHsKICAgICAgICAgICAgICAgIHJlc3VsdFtpXSA9IG1baV07CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CgogICAgZnVuY3Rpb24gYWJzUm91bmQobnVtYmVyKSB7CiAgICAgICAgaWYgKG51bWJlciA8IDApIHsKICAgICAgICAgICAgcmV0dXJuIE1hdGguY2VpbChudW1iZXIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBNYXRoLmZsb29yKG51bWJlcik7CiAgICAgICAgfQogICAgfQoKICAgIC8vIGxlZnQgemVybyBmaWxsIGEgbnVtYmVyCiAgICAvLyBzZWUgaHR0cDovL2pzcGVyZi5jb20vbGVmdC16ZXJvLWZpbGxpbmcgZm9yIHBlcmZvcm1hbmNlIGNvbXBhcmlzb24KICAgIGZ1bmN0aW9uIGxlZnRaZXJvRmlsbChudW1iZXIsIHRhcmdldExlbmd0aCwgZm9yY2VTaWduKSB7CiAgICAgICAgdmFyIG91dHB1dCA9ICcnICsgTWF0aC5hYnMobnVtYmVyKSwKICAgICAgICAgICAgc2lnbiA9IG51bWJlciA+PSAwOwoKICAgICAgICB3aGlsZSAob3V0cHV0Lmxlbmd0aCA8IHRhcmdldExlbmd0aCkgewogICAgICAgICAgICBvdXRwdXQgPSAnMCcgKyBvdXRwdXQ7CiAgICAgICAgfQogICAgICAgIHJldHVybiAoc2lnbiA/IChmb3JjZVNpZ24gPyAnKycgOiAnJykgOiAnLScpICsgb3V0cHV0OwogICAgfQoKICAgIC8vIGhlbHBlciBmdW5jdGlvbiBmb3IgXy5hZGRUaW1lIGFuZCBfLnN1YnRyYWN0VGltZQogICAgZnVuY3Rpb24gYWRkT3JTdWJ0cmFjdER1cmF0aW9uRnJvbU1vbWVudChtb20sIGR1cmF0aW9uLCBpc0FkZGluZywgdXBkYXRlT2Zmc2V0KSB7CiAgICAgICAgdmFyIG1pbGxpc2Vjb25kcyA9IGR1cmF0aW9uLl9taWxsaXNlY29uZHMsCiAgICAgICAgICAgIGRheXMgPSBkdXJhdGlvbi5fZGF5cywKICAgICAgICAgICAgbW9udGhzID0gZHVyYXRpb24uX21vbnRoczsKICAgICAgICB1cGRhdGVPZmZzZXQgPSB1cGRhdGVPZmZzZXQgPT0gbnVsbCA/IHRydWUgOiB1cGRhdGVPZmZzZXQ7CgogICAgICAgIGlmIChtaWxsaXNlY29uZHMpIHsKICAgICAgICAgICAgbW9tLl9kLnNldFRpbWUoK21vbS5fZCArIG1pbGxpc2Vjb25kcyAqIGlzQWRkaW5nKTsKICAgICAgICB9CiAgICAgICAgaWYgKGRheXMpIHsKICAgICAgICAgICAgcmF3U2V0dGVyKG1vbSwgJ0RhdGUnLCByYXdHZXR0ZXIobW9tLCAnRGF0ZScpICsgZGF5cyAqIGlzQWRkaW5nKTsKICAgICAgICB9CiAgICAgICAgaWYgKG1vbnRocykgewogICAgICAgICAgICByYXdNb250aFNldHRlcihtb20sIHJhd0dldHRlcihtb20sICdNb250aCcpICsgbW9udGhzICogaXNBZGRpbmcpOwogICAgICAgIH0KICAgICAgICBpZiAodXBkYXRlT2Zmc2V0KSB7CiAgICAgICAgICAgIG1vbWVudC51cGRhdGVPZmZzZXQobW9tLCBkYXlzIHx8IG1vbnRocyk7CiAgICAgICAgfQogICAgfQoKICAgIC8vIGNoZWNrIGlmIGlzIGFuIGFycmF5CiAgICBmdW5jdGlvbiBpc0FycmF5KGlucHV0KSB7CiAgICAgICAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChpbnB1dCkgPT09ICdbb2JqZWN0IEFycmF5XSc7CiAgICB9CgogICAgZnVuY3Rpb24gaXNEYXRlKGlucHV0KSB7CiAgICAgICAgcmV0dXJuICBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoaW5wdXQpID09PSAnW29iamVjdCBEYXRlXScgfHwKICAgICAgICAgICAgICAgIGlucHV0IGluc3RhbmNlb2YgRGF0ZTsKICAgIH0KCiAgICAvLyBjb21wYXJlIHR3byBhcnJheXMsIHJldHVybiB0aGUgbnVtYmVyIG9mIGRpZmZlcmVuY2VzCiAgICBmdW5jdGlvbiBjb21wYXJlQXJyYXlzKGFycmF5MSwgYXJyYXkyLCBkb250Q29udmVydCkgewogICAgICAgIHZhciBsZW4gPSBNYXRoLm1pbihhcnJheTEubGVuZ3RoLCBhcnJheTIubGVuZ3RoKSwKICAgICAgICAgICAgbGVuZ3RoRGlmZiA9IE1hdGguYWJzKGFycmF5MS5sZW5ndGggLSBhcnJheTIubGVuZ3RoKSwKICAgICAgICAgICAgZGlmZnMgPSAwLAogICAgICAgICAgICBpOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgICBpZiAoKGRvbnRDb252ZXJ0ICYmIGFycmF5MVtpXSAhPT0gYXJyYXkyW2ldKSB8fAogICAgICAgICAgICAgICAgKCFkb250Q29udmVydCAmJiB0b0ludChhcnJheTFbaV0pICE9PSB0b0ludChhcnJheTJbaV0pKSkgewogICAgICAgICAgICAgICAgZGlmZnMrKzsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gZGlmZnMgKyBsZW5ndGhEaWZmOwogICAgfQoKICAgIGZ1bmN0aW9uIG5vcm1hbGl6ZVVuaXRzKHVuaXRzKSB7CiAgICAgICAgaWYgKHVuaXRzKSB7CiAgICAgICAgICAgIHZhciBsb3dlcmVkID0gdW5pdHMudG9Mb3dlckNhc2UoKS5yZXBsYWNlKC8oLilzJC8sICckMScpOwogICAgICAgICAgICB1bml0cyA9IHVuaXRBbGlhc2VzW3VuaXRzXSB8fCBjYW1lbEZ1bmN0aW9uc1tsb3dlcmVkXSB8fCBsb3dlcmVkOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdW5pdHM7CiAgICB9CgogICAgZnVuY3Rpb24gbm9ybWFsaXplT2JqZWN0VW5pdHMoaW5wdXRPYmplY3QpIHsKICAgICAgICB2YXIgbm9ybWFsaXplZElucHV0ID0ge30sCiAgICAgICAgICAgIG5vcm1hbGl6ZWRQcm9wLAogICAgICAgICAgICBwcm9wOwoKICAgICAgICBmb3IgKHByb3AgaW4gaW5wdXRPYmplY3QpIHsKICAgICAgICAgICAgaWYgKGlucHV0T2JqZWN0Lmhhc093blByb3BlcnR5KHByb3ApKSB7CiAgICAgICAgICAgICAgICBub3JtYWxpemVkUHJvcCA9IG5vcm1hbGl6ZVVuaXRzKHByb3ApOwogICAgICAgICAgICAgICAgaWYgKG5vcm1hbGl6ZWRQcm9wKSB7CiAgICAgICAgICAgICAgICAgICAgbm9ybWFsaXplZElucHV0W25vcm1hbGl6ZWRQcm9wXSA9IGlucHV0T2JqZWN0W3Byb3BdOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbm9ybWFsaXplZElucHV0OwogICAgfQoKICAgIGZ1bmN0aW9uIG1ha2VMaXN0KGZpZWxkKSB7CiAgICAgICAgdmFyIGNvdW50LCBzZXR0ZXI7CgogICAgICAgIGlmIChmaWVsZC5pbmRleE9mKCd3ZWVrJykgPT09IDApIHsKICAgICAgICAgICAgY291bnQgPSA3OwogICAgICAgICAgICBzZXR0ZXIgPSAnZGF5JzsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAoZmllbGQuaW5kZXhPZignbW9udGgnKSA9PT0gMCkgewogICAgICAgICAgICBjb3VudCA9IDEyOwogICAgICAgICAgICBzZXR0ZXIgPSAnbW9udGgnOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgbW9tZW50W2ZpZWxkXSA9IGZ1bmN0aW9uIChmb3JtYXQsIGluZGV4KSB7CiAgICAgICAgICAgIHZhciBpLCBnZXR0ZXIsCiAgICAgICAgICAgICAgICBtZXRob2QgPSBtb21lbnQuZm4uX2xhbmdbZmllbGRdLAogICAgICAgICAgICAgICAgcmVzdWx0cyA9IFtdOwoKICAgICAgICAgICAgaWYgKHR5cGVvZiBmb3JtYXQgPT09ICdudW1iZXInKSB7CiAgICAgICAgICAgICAgICBpbmRleCA9IGZvcm1hdDsKICAgICAgICAgICAgICAgIGZvcm1hdCA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZ2V0dGVyID0gZnVuY3Rpb24gKGkpIHsKICAgICAgICAgICAgICAgIHZhciBtID0gbW9tZW50KCkudXRjKCkuc2V0KHNldHRlciwgaSk7CiAgICAgICAgICAgICAgICByZXR1cm4gbWV0aG9kLmNhbGwobW9tZW50LmZuLl9sYW5nLCBtLCBmb3JtYXQgfHwgJycpOwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgaWYgKGluZGV4ICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIHJldHVybiBnZXR0ZXIoaW5kZXgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKICAgICAgICAgICAgICAgICAgICByZXN1bHRzLnB1c2goZ2V0dGVyKGkpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHRzOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgIH0KCiAgICBmdW5jdGlvbiB0b0ludChhcmd1bWVudEZvckNvZXJjaW9uKSB7CiAgICAgICAgdmFyIGNvZXJjZWROdW1iZXIgPSArYXJndW1lbnRGb3JDb2VyY2lvbiwKICAgICAgICAgICAgdmFsdWUgPSAwOwoKICAgICAgICBpZiAoY29lcmNlZE51bWJlciAhPT0gMCAmJiBpc0Zpbml0ZShjb2VyY2VkTnVtYmVyKSkgewogICAgICAgICAgICBpZiAoY29lcmNlZE51bWJlciA+PSAwKSB7CiAgICAgICAgICAgICAgICB2YWx1ZSA9IE1hdGguZmxvb3IoY29lcmNlZE51bWJlcik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB2YWx1ZSA9IE1hdGguY2VpbChjb2VyY2VkTnVtYmVyKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGRheXNJbk1vbnRoKHllYXIsIG1vbnRoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBEYXRlKERhdGUuVVRDKHllYXIsIG1vbnRoICsgMSwgMCkpLmdldFVUQ0RhdGUoKTsKICAgIH0KCiAgICBmdW5jdGlvbiB3ZWVrc0luWWVhcih5ZWFyLCBkb3csIGRveSkgewogICAgICAgIHJldHVybiB3ZWVrT2ZZZWFyKG1vbWVudChbeWVhciwgMTEsIDMxICsgZG93IC0gZG95XSksIGRvdywgZG95KS53ZWVrOwogICAgfQoKICAgIGZ1bmN0aW9uIGRheXNJblllYXIoeWVhcikgewogICAgICAgIHJldHVybiBpc0xlYXBZZWFyKHllYXIpID8gMzY2IDogMzY1OwogICAgfQoKICAgIGZ1bmN0aW9uIGlzTGVhcFllYXIoeWVhcikgewogICAgICAgIHJldHVybiAoeWVhciAlIDQgPT09IDAgJiYgeWVhciAlIDEwMCAhPT0gMCkgfHwgeWVhciAlIDQwMCA9PT0gMDsKICAgIH0KCiAgICBmdW5jdGlvbiBjaGVja092ZXJmbG93KG0pIHsKICAgICAgICB2YXIgb3ZlcmZsb3c7CiAgICAgICAgaWYgKG0uX2EgJiYgbS5fcGYub3ZlcmZsb3cgPT09IC0yKSB7CiAgICAgICAgICAgIG92ZXJmbG93ID0KICAgICAgICAgICAgICAgIG0uX2FbTU9OVEhdIDwgMCB8fCBtLl9hW01PTlRIXSA+IDExID8gTU9OVEggOgogICAgICAgICAgICAgICAgbS5fYVtEQVRFXSA8IDEgfHwgbS5fYVtEQVRFXSA+IGRheXNJbk1vbnRoKG0uX2FbWUVBUl0sIG0uX2FbTU9OVEhdKSA/IERBVEUgOgogICAgICAgICAgICAgICAgbS5fYVtIT1VSXSA8IDAgfHwgbS5fYVtIT1VSXSA+IDIzID8gSE9VUiA6CiAgICAgICAgICAgICAgICBtLl9hW01JTlVURV0gPCAwIHx8IG0uX2FbTUlOVVRFXSA+IDU5ID8gTUlOVVRFIDoKICAgICAgICAgICAgICAgIG0uX2FbU0VDT05EXSA8IDAgfHwgbS5fYVtTRUNPTkRdID4gNTkgPyBTRUNPTkQgOgogICAgICAgICAgICAgICAgbS5fYVtNSUxMSVNFQ09ORF0gPCAwIHx8IG0uX2FbTUlMTElTRUNPTkRdID4gOTk5ID8gTUlMTElTRUNPTkQgOgogICAgICAgICAgICAgICAgLTE7CgogICAgICAgICAgICBpZiAobS5fcGYuX292ZXJmbG93RGF5T2ZZZWFyICYmIChvdmVyZmxvdyA8IFlFQVIgfHwgb3ZlcmZsb3cgPiBEQVRFKSkgewogICAgICAgICAgICAgICAgb3ZlcmZsb3cgPSBEQVRFOwogICAgICAgICAgICB9CgogICAgICAgICAgICBtLl9wZi5vdmVyZmxvdyA9IG92ZXJmbG93OwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBpc1ZhbGlkKG0pIHsKICAgICAgICBpZiAobS5faXNWYWxpZCA9PSBudWxsKSB7CiAgICAgICAgICAgIG0uX2lzVmFsaWQgPSAhaXNOYU4obS5fZC5nZXRUaW1lKCkpICYmCiAgICAgICAgICAgICAgICBtLl9wZi5vdmVyZmxvdyA8IDAgJiYKICAgICAgICAgICAgICAgICFtLl9wZi5lbXB0eSAmJgogICAgICAgICAgICAgICAgIW0uX3BmLmludmFsaWRNb250aCAmJgogICAgICAgICAgICAgICAgIW0uX3BmLm51bGxJbnB1dCAmJgogICAgICAgICAgICAgICAgIW0uX3BmLmludmFsaWRGb3JtYXQgJiYKICAgICAgICAgICAgICAgICFtLl9wZi51c2VySW52YWxpZGF0ZWQ7CgogICAgICAgICAgICBpZiAobS5fc3RyaWN0KSB7CiAgICAgICAgICAgICAgICBtLl9pc1ZhbGlkID0gbS5faXNWYWxpZCAmJgogICAgICAgICAgICAgICAgICAgIG0uX3BmLmNoYXJzTGVmdE92ZXIgPT09IDAgJiYKICAgICAgICAgICAgICAgICAgICBtLl9wZi51bnVzZWRUb2tlbnMubGVuZ3RoID09PSAwOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBtLl9pc1ZhbGlkOwogICAgfQoKICAgIGZ1bmN0aW9uIG5vcm1hbGl6ZUxhbmd1YWdlKGtleSkgewogICAgICAgIHJldHVybiBrZXkgPyBrZXkudG9Mb3dlckNhc2UoKS5yZXBsYWNlKCdfJywgJy0nKSA6IGtleTsKICAgIH0KCiAgICAvLyBSZXR1cm4gYSBtb21lbnQgZnJvbSBpbnB1dCwgdGhhdCBpcyBsb2NhbC91dGMvem9uZSBlcXVpdmFsZW50IHRvIG1vZGVsLgogICAgZnVuY3Rpb24gbWFrZUFzKGlucHV0LCBtb2RlbCkgewogICAgICAgIHJldHVybiBtb2RlbC5faXNVVEMgPyBtb21lbnQoaW5wdXQpLnpvbmUobW9kZWwuX29mZnNldCB8fCAwKSA6CiAgICAgICAgICAgIG1vbWVudChpbnB1dCkubG9jYWwoKTsKICAgIH0KCiAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAgICAgTGFuZ3VhZ2VzCiAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCgoKICAgIGV4dGVuZChMYW5ndWFnZS5wcm90b3R5cGUsIHsKCiAgICAgICAgc2V0IDogZnVuY3Rpb24gKGNvbmZpZykgewogICAgICAgICAgICB2YXIgcHJvcCwgaTsKICAgICAgICAgICAgZm9yIChpIGluIGNvbmZpZykgewogICAgICAgICAgICAgICAgcHJvcCA9IGNvbmZpZ1tpXTsKICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgcHJvcCA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICAgICAgICAgIHRoaXNbaV0gPSBwcm9wOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGlzWydfJyArIGldID0gcHJvcDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0sCgogICAgICAgIF9tb250aHMgOiAiSmFudWFyeV9GZWJydWFyeV9NYXJjaF9BcHJpbF9NYXlfSnVuZV9KdWx5X0F1Z3VzdF9TZXB0ZW1iZXJfT2N0b2Jlcl9Ob3ZlbWJlcl9EZWNlbWJlciIuc3BsaXQoIl8iKSwKICAgICAgICBtb250aHMgOiBmdW5jdGlvbiAobSkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fbW9udGhzW20ubW9udGgoKV07CiAgICAgICAgfSwKCiAgICAgICAgX21vbnRoc1Nob3J0IDogIkphbl9GZWJfTWFyX0Fwcl9NYXlfSnVuX0p1bF9BdWdfU2VwX09jdF9Ob3ZfRGVjIi5zcGxpdCgiXyIpLAogICAgICAgIG1vbnRoc1Nob3J0IDogZnVuY3Rpb24gKG0pIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX21vbnRoc1Nob3J0W20ubW9udGgoKV07CiAgICAgICAgfSwKCiAgICAgICAgbW9udGhzUGFyc2UgOiBmdW5jdGlvbiAobW9udGhOYW1lKSB7CiAgICAgICAgICAgIHZhciBpLCBtb20sIHJlZ2V4OwoKICAgICAgICAgICAgaWYgKCF0aGlzLl9tb250aHNQYXJzZSkgewogICAgICAgICAgICAgICAgdGhpcy5fbW9udGhzUGFyc2UgPSBbXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IDEyOyBpKyspIHsKICAgICAgICAgICAgICAgIC8vIG1ha2UgdGhlIHJlZ2V4IGlmIHdlIGRvbid0IGhhdmUgaXQgYWxyZWFkeQogICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9tb250aHNQYXJzZVtpXSkgewogICAgICAgICAgICAgICAgICAgIG1vbSA9IG1vbWVudC51dGMoWzIwMDAsIGldKTsKICAgICAgICAgICAgICAgICAgICByZWdleCA9ICdeJyArIHRoaXMubW9udGhzKG1vbSwgJycpICsgJ3xeJyArIHRoaXMubW9udGhzU2hvcnQobW9tLCAnJyk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbW9udGhzUGFyc2VbaV0gPSBuZXcgUmVnRXhwKHJlZ2V4LnJlcGxhY2UoJy4nLCAnJyksICdpJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyB0ZXN0IHRoZSByZWdleAogICAgICAgICAgICAgICAgaWYgKHRoaXMuX21vbnRoc1BhcnNlW2ldLnRlc3QobW9udGhOYW1lKSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSwKCiAgICAgICAgX3dlZWtkYXlzIDogIlN1bmRheV9Nb25kYXlfVHVlc2RheV9XZWRuZXNkYXlfVGh1cnNkYXlfRnJpZGF5X1NhdHVyZGF5Ii5zcGxpdCgiXyIpLAogICAgICAgIHdlZWtkYXlzIDogZnVuY3Rpb24gKG0pIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3dlZWtkYXlzW20uZGF5KCldOwogICAgICAgIH0sCgogICAgICAgIF93ZWVrZGF5c1Nob3J0IDogIlN1bl9Nb25fVHVlX1dlZF9UaHVfRnJpX1NhdCIuc3BsaXQoIl8iKSwKICAgICAgICB3ZWVrZGF5c1Nob3J0IDogZnVuY3Rpb24gKG0pIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3dlZWtkYXlzU2hvcnRbbS5kYXkoKV07CiAgICAgICAgfSwKCiAgICAgICAgX3dlZWtkYXlzTWluIDogIlN1X01vX1R1X1dlX1RoX0ZyX1NhIi5zcGxpdCgiXyIpLAogICAgICAgIHdlZWtkYXlzTWluIDogZnVuY3Rpb24gKG0pIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3dlZWtkYXlzTWluW20uZGF5KCldOwogICAgICAgIH0sCgogICAgICAgIHdlZWtkYXlzUGFyc2UgOiBmdW5jdGlvbiAod2Vla2RheU5hbWUpIHsKICAgICAgICAgICAgdmFyIGksIG1vbSwgcmVnZXg7CgogICAgICAgICAgICBpZiAoIXRoaXMuX3dlZWtkYXlzUGFyc2UpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3dlZWtkYXlzUGFyc2UgPSBbXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IDc7IGkrKykgewogICAgICAgICAgICAgICAgLy8gbWFrZSB0aGUgcmVnZXggaWYgd2UgZG9uJ3QgaGF2ZSBpdCBhbHJlYWR5CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX3dlZWtkYXlzUGFyc2VbaV0pIHsKICAgICAgICAgICAgICAgICAgICBtb20gPSBtb21lbnQoWzIwMDAsIDFdKS5kYXkoaSk7CiAgICAgICAgICAgICAgICAgICAgcmVnZXggPSAnXicgKyB0aGlzLndlZWtkYXlzKG1vbSwgJycpICsgJ3xeJyArIHRoaXMud2Vla2RheXNTaG9ydChtb20sICcnKSArICd8XicgKyB0aGlzLndlZWtkYXlzTWluKG1vbSwgJycpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3dlZWtkYXlzUGFyc2VbaV0gPSBuZXcgUmVnRXhwKHJlZ2V4LnJlcGxhY2UoJy4nLCAnJyksICdpJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyB0ZXN0IHRoZSByZWdleAogICAgICAgICAgICAgICAgaWYgKHRoaXMuX3dlZWtkYXlzUGFyc2VbaV0udGVzdCh3ZWVrZGF5TmFtZSkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gaTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0sCgogICAgICAgIF9sb25nRGF0ZUZvcm1hdCA6IHsKICAgICAgICAgICAgTFQgOiAiaDptbSBBIiwKICAgICAgICAgICAgTCA6ICJNTS9ERC9ZWVlZIiwKICAgICAgICAgICAgTEwgOiAiTU1NTSBEIFlZWVkiLAogICAgICAgICAgICBMTEwgOiAiTU1NTSBEIFlZWVkgTFQiLAogICAgICAgICAgICBMTExMIDogImRkZGQsIE1NTU0gRCBZWVlZIExUIgogICAgICAgIH0sCiAgICAgICAgbG9uZ0RhdGVGb3JtYXQgOiBmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgICAgIHZhciBvdXRwdXQgPSB0aGlzLl9sb25nRGF0ZUZvcm1hdFtrZXldOwogICAgICAgICAgICBpZiAoIW91dHB1dCAmJiB0aGlzLl9sb25nRGF0ZUZvcm1hdFtrZXkudG9VcHBlckNhc2UoKV0pIHsKICAgICAgICAgICAgICAgIG91dHB1dCA9IHRoaXMuX2xvbmdEYXRlRm9ybWF0W2tleS50b1VwcGVyQ2FzZSgpXS5yZXBsYWNlKC9NTU1NfE1NfEREfGRkZGQvZywgZnVuY3Rpb24gKHZhbCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWwuc2xpY2UoMSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHRoaXMuX2xvbmdEYXRlRm9ybWF0W2tleV0gPSBvdXRwdXQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG91dHB1dDsKICAgICAgICB9LAoKICAgICAgICBpc1BNIDogZnVuY3Rpb24gKGlucHV0KSB7CiAgICAgICAgICAgIC8vIElFOCBRdWlya3MgTW9kZSAmIElFNyBTdGFuZGFyZHMgTW9kZSBkbyBub3QgYWxsb3cgYWNjZXNzaW5nIHN0cmluZ3MgbGlrZSBhcnJheXMKICAgICAgICAgICAgLy8gVXNpbmcgY2hhckF0IHNob3VsZCBiZSBtb3JlIGNvbXBhdGlibGUuCiAgICAgICAgICAgIHJldHVybiAoKGlucHV0ICsgJycpLnRvTG93ZXJDYXNlKCkuY2hhckF0KDApID09PSAncCcpOwogICAgICAgIH0sCgogICAgICAgIF9tZXJpZGllbVBhcnNlIDogL1thcF1cLj9tP1wuPy9pLAogICAgICAgIG1lcmlkaWVtIDogZnVuY3Rpb24gKGhvdXJzLCBtaW51dGVzLCBpc0xvd2VyKSB7CiAgICAgICAgICAgIGlmIChob3VycyA+IDExKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gaXNMb3dlciA/ICdwbScgOiAnUE0nOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIGlzTG93ZXIgPyAnYW0nIDogJ0FNJzsKICAgICAgICAgICAgfQogICAgICAgIH0sCgogICAgICAgIF9jYWxlbmRhciA6IHsKICAgICAgICAgICAgc2FtZURheSA6ICdbVG9kYXkgYXRdIExUJywKICAgICAgICAgICAgbmV4dERheSA6ICdbVG9tb3Jyb3cgYXRdIExUJywKICAgICAgICAgICAgbmV4dFdlZWsgOiAnZGRkZCBbYXRdIExUJywKICAgICAgICAgICAgbGFzdERheSA6ICdbWWVzdGVyZGF5IGF0XSBMVCcsCiAgICAgICAgICAgIGxhc3RXZWVrIDogJ1tMYXN0XSBkZGRkIFthdF0gTFQnLAogICAgICAgICAgICBzYW1lRWxzZSA6ICdMJwogICAgICAgIH0sCiAgICAgICAgY2FsZW5kYXIgOiBmdW5jdGlvbiAoa2V5LCBtb20pIHsKICAgICAgICAgICAgdmFyIG91dHB1dCA9IHRoaXMuX2NhbGVuZGFyW2tleV07CiAgICAgICAgICAgIHJldHVybiB0eXBlb2Ygb3V0cHV0ID09PSAnZnVuY3Rpb24nID8gb3V0cHV0LmFwcGx5KG1vbSkgOiBvdXRwdXQ7CiAgICAgICAgfSwKCiAgICAgICAgX3JlbGF0aXZlVGltZSA6IHsKICAgICAgICAgICAgZnV0dXJlIDogImluICVzIiwKICAgICAgICAgICAgcGFzdCA6ICIlcyBhZ28iLAogICAgICAgICAgICBzIDogImEgZmV3IHNlY29uZHMiLAogICAgICAgICAgICBtIDogImEgbWludXRlIiwKICAgICAgICAgICAgbW0gOiAiJWQgbWludXRlcyIsCiAgICAgICAgICAgIGggOiAiYW4gaG91ciIsCiAgICAgICAgICAgIGhoIDogIiVkIGhvdXJzIiwKICAgICAgICAgICAgZCA6ICJhIGRheSIsCiAgICAgICAgICAgIGRkIDogIiVkIGRheXMiLAogICAgICAgICAgICBNIDogImEgbW9udGgiLAogICAgICAgICAgICBNTSA6ICIlZCBtb250aHMiLAogICAgICAgICAgICB5IDogImEgeWVhciIsCiAgICAgICAgICAgIHl5IDogIiVkIHllYXJzIgogICAgICAgIH0sCiAgICAgICAgcmVsYXRpdmVUaW1lIDogZnVuY3Rpb24gKG51bWJlciwgd2l0aG91dFN1ZmZpeCwgc3RyaW5nLCBpc0Z1dHVyZSkgewogICAgICAgICAgICB2YXIgb3V0cHV0ID0gdGhpcy5fcmVsYXRpdmVUaW1lW3N0cmluZ107CiAgICAgICAgICAgIHJldHVybiAodHlwZW9mIG91dHB1dCA9PT0gJ2Z1bmN0aW9uJykgPwogICAgICAgICAgICAgICAgb3V0cHV0KG51bWJlciwgd2l0aG91dFN1ZmZpeCwgc3RyaW5nLCBpc0Z1dHVyZSkgOgogICAgICAgICAgICAgICAgb3V0cHV0LnJlcGxhY2UoLyVkL2ksIG51bWJlcik7CiAgICAgICAgfSwKICAgICAgICBwYXN0RnV0dXJlIDogZnVuY3Rpb24gKGRpZmYsIG91dHB1dCkgewogICAgICAgICAgICB2YXIgZm9ybWF0ID0gdGhpcy5fcmVsYXRpdmVUaW1lW2RpZmYgPiAwID8gJ2Z1dHVyZScgOiAncGFzdCddOwogICAgICAgICAgICByZXR1cm4gdHlwZW9mIGZvcm1hdCA9PT0gJ2Z1bmN0aW9uJyA/IGZvcm1hdChvdXRwdXQpIDogZm9ybWF0LnJlcGxhY2UoLyVzL2ksIG91dHB1dCk7CiAgICAgICAgfSwKCiAgICAgICAgb3JkaW5hbCA6IGZ1bmN0aW9uIChudW1iZXIpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX29yZGluYWwucmVwbGFjZSgiJWQiLCBudW1iZXIpOwogICAgICAgIH0sCiAgICAgICAgX29yZGluYWwgOiAiJWQiLAoKICAgICAgICBwcmVwYXJzZSA6IGZ1bmN0aW9uIChzdHJpbmcpIHsKICAgICAgICAgICAgcmV0dXJuIHN0cmluZzsKICAgICAgICB9LAoKICAgICAgICBwb3N0Zm9ybWF0IDogZnVuY3Rpb24gKHN0cmluZykgewogICAgICAgICAgICByZXR1cm4gc3RyaW5nOwogICAgICAgIH0sCgogICAgICAgIHdlZWsgOiBmdW5jdGlvbiAobW9tKSB7CiAgICAgICAgICAgIHJldHVybiB3ZWVrT2ZZZWFyKG1vbSwgdGhpcy5fd2Vlay5kb3csIHRoaXMuX3dlZWsuZG95KS53ZWVrOwogICAgICAgIH0sCgogICAgICAgIF93ZWVrIDogewogICAgICAgICAgICBkb3cgOiAwLCAvLyBTdW5kYXkgaXMgdGhlIGZpcnN0IGRheSBvZiB0aGUgd2Vlay4KICAgICAgICAgICAgZG95IDogNiAgLy8gVGhlIHdlZWsgdGhhdCBjb250YWlucyBKYW4gMXN0IGlzIHRoZSBmaXJzdCB3ZWVrIG9mIHRoZSB5ZWFyLgogICAgICAgIH0sCgogICAgICAgIF9pbnZhbGlkRGF0ZTogJ0ludmFsaWQgZGF0ZScsCiAgICAgICAgaW52YWxpZERhdGU6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2ludmFsaWREYXRlOwogICAgICAgIH0KICAgIH0pOwoKICAgIC8vIExvYWRzIGEgbGFuZ3VhZ2UgZGVmaW5pdGlvbiBpbnRvIHRoZSBgbGFuZ3VhZ2VzYCBjYWNoZS4gIFRoZSBmdW5jdGlvbgogICAgLy8gdGFrZXMgYSBrZXkgYW5kIG9wdGlvbmFsbHkgdmFsdWVzLiAgSWYgbm90IGluIHRoZSBicm93c2VyIGFuZCBubyB2YWx1ZXMKICAgIC8vIGFyZSBwcm92aWRlZCwgaXQgd2lsbCBsb2FkIHRoZSBsYW5ndWFnZSBmaWxlIG1vZHVsZS4gIEFzIGEgY29udmVuaWVuY2UsCiAgICAvLyB0aGlzIGZ1bmN0aW9uIGFsc28gcmV0dXJucyB0aGUgbGFuZ3VhZ2UgdmFsdWVzLgogICAgZnVuY3Rpb24gbG9hZExhbmcoa2V5LCB2YWx1ZXMpIHsKICAgICAgICB2YWx1ZXMuYWJiciA9IGtleTsKICAgICAgICBpZiAoIWxhbmd1YWdlc1trZXldKSB7CiAgICAgICAgICAgIGxhbmd1YWdlc1trZXldID0gbmV3IExhbmd1YWdlKCk7CiAgICAgICAgfQogICAgICAgIGxhbmd1YWdlc1trZXldLnNldCh2YWx1ZXMpOwogICAgICAgIHJldHVybiBsYW5ndWFnZXNba2V5XTsKICAgIH0KCiAgICAvLyBSZW1vdmUgYSBsYW5ndWFnZSBmcm9tIHRoZSBgbGFuZ3VhZ2VzYCBjYWNoZS4gTW9zdGx5IHVzZWZ1bCBpbiB0ZXN0cy4KICAgIGZ1bmN0aW9uIHVubG9hZExhbmcoa2V5KSB7CiAgICAgICAgZGVsZXRlIGxhbmd1YWdlc1trZXldOwogICAgfQoKICAgIC8vIERldGVybWluZXMgd2hpY2ggbGFuZ3VhZ2UgZGVmaW5pdGlvbiB0byB1c2UgYW5kIHJldHVybnMgaXQuCiAgICAvLwogICAgLy8gV2l0aCBubyBwYXJhbWV0ZXJzLCBpdCB3aWxsIHJldHVybiB0aGUgZ2xvYmFsIGxhbmd1YWdlLiAgSWYgeW91CiAgICAvLyBwYXNzIGluIGEgbGFuZ3VhZ2Uga2V5LCBzdWNoIGFzICdlbicsIGl0IHdpbGwgcmV0dXJuIHRoZQogICAgLy8gZGVmaW5pdGlvbiBmb3IgJ2VuJywgc28gbG9uZyBhcyAnZW4nIGhhcyBhbHJlYWR5IGJlZW4gbG9hZGVkIHVzaW5nCiAgICAvLyBtb21lbnQubGFuZy4KICAgIGZ1bmN0aW9uIGdldExhbmdEZWZpbml0aW9uKGtleSkgewogICAgICAgIHZhciBpID0gMCwgaiwgbGFuZywgbmV4dCwgc3BsaXQsCiAgICAgICAgICAgIGdldCA9IGZ1bmN0aW9uIChrKSB7CiAgICAgICAgICAgICAgICBpZiAoIWxhbmd1YWdlc1trXSAmJiBoYXNNb2R1bGUpIHsKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICByZXF1aXJlKCcuL2xhbmcvJyArIGspOwogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGxhbmd1YWdlc1trXTsKICAgICAgICAgICAgfTsKCiAgICAgICAgaWYgKCFrZXkpIHsKICAgICAgICAgICAgcmV0dXJuIG1vbWVudC5mbi5fbGFuZzsKICAgICAgICB9CgogICAgICAgIGlmICghaXNBcnJheShrZXkpKSB7CiAgICAgICAgICAgIC8vc2hvcnQtY2lyY3VpdCBldmVyeXRoaW5nIGVsc2UKICAgICAgICAgICAgbGFuZyA9IGdldChrZXkpOwogICAgICAgICAgICBpZiAobGFuZykgewogICAgICAgICAgICAgICAgcmV0dXJuIGxhbmc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAga2V5ID0gW2tleV07CiAgICAgICAgfQoKICAgICAgICAvL3BpY2sgdGhlIGxhbmd1YWdlIGZyb20gdGhlIGFycmF5CiAgICAgICAgLy90cnkgWydlbi1hdScsICdlbi1nYiddIGFzICdlbi1hdScsICdlbi1nYicsICdlbicsIGFzIGluIG1vdmUgdGhyb3VnaCB0aGUgbGlzdCB0cnlpbmcgZWFjaAogICAgICAgIC8vc3Vic3RyaW5nIGZyb20gbW9zdCBzcGVjaWZpYyB0byBsZWFzdCwgYnV0IG1vdmUgdG8gdGhlIG5leHQgYXJyYXkgaXRlbSBpZiBpdCdzIGEgbW9yZSBzcGVjaWZpYyB2YXJpYW50IHRoYW4gdGhlIGN1cnJlbnQgcm9vdAogICAgICAgIHdoaWxlIChpIDwga2V5Lmxlbmd0aCkgewogICAgICAgICAgICBzcGxpdCA9IG5vcm1hbGl6ZUxhbmd1YWdlKGtleVtpXSkuc3BsaXQoJy0nKTsKICAgICAgICAgICAgaiA9IHNwbGl0Lmxlbmd0aDsKICAgICAgICAgICAgbmV4dCA9IG5vcm1hbGl6ZUxhbmd1YWdlKGtleVtpICsgMV0pOwogICAgICAgICAgICBuZXh0ID0gbmV4dCA/IG5leHQuc3BsaXQoJy0nKSA6IG51bGw7CiAgICAgICAgICAgIHdoaWxlIChqID4gMCkgewogICAgICAgICAgICAgICAgbGFuZyA9IGdldChzcGxpdC5zbGljZSgwLCBqKS5qb2luKCctJykpOwogICAgICAgICAgICAgICAgaWYgKGxhbmcpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbGFuZzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChuZXh0ICYmIG5leHQubGVuZ3RoID49IGogJiYgY29tcGFyZUFycmF5cyhzcGxpdCwgbmV4dCwgdHJ1ZSkgPj0gaiAtIDEpIHsKICAgICAgICAgICAgICAgICAgICAvL3RoZSBuZXh0IGFycmF5IGl0ZW0gaXMgYmV0dGVyIHRoYW4gYSBzaGFsbG93ZXIgc3Vic3RyaW5nIG9mIHRoaXMgb25lCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBqLS07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaSsrOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbW9tZW50LmZuLl9sYW5nOwogICAgfQoKICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAgICAgICBGb3JtYXR0aW5nCiAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCgoKICAgIGZ1bmN0aW9uIHJlbW92ZUZvcm1hdHRpbmdUb2tlbnMoaW5wdXQpIHsKICAgICAgICBpZiAoaW5wdXQubWF0Y2goL1xbW1xzXFNdLykpIHsKICAgICAgICAgICAgcmV0dXJuIGlucHV0LnJlcGxhY2UoL15cW3xcXSQvZywgIiIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gaW5wdXQucmVwbGFjZSgvXFwvZywgIiIpOwogICAgfQoKICAgIGZ1bmN0aW9uIG1ha2VGb3JtYXRGdW5jdGlvbihmb3JtYXQpIHsKICAgICAgICB2YXIgYXJyYXkgPSBmb3JtYXQubWF0Y2goZm9ybWF0dGluZ1Rva2VucyksIGksIGxlbmd0aDsKCiAgICAgICAgZm9yIChpID0gMCwgbGVuZ3RoID0gYXJyYXkubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKGZvcm1hdFRva2VuRnVuY3Rpb25zW2FycmF5W2ldXSkgewogICAgICAgICAgICAgICAgYXJyYXlbaV0gPSBmb3JtYXRUb2tlbkZ1bmN0aW9uc1thcnJheVtpXV07CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBhcnJheVtpXSA9IHJlbW92ZUZvcm1hdHRpbmdUb2tlbnMoYXJyYXlbaV0pOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKG1vbSkgewogICAgICAgICAgICB2YXIgb3V0cHV0ID0gIiI7CiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgb3V0cHV0ICs9IGFycmF5W2ldIGluc3RhbmNlb2YgRnVuY3Rpb24gPyBhcnJheVtpXS5jYWxsKG1vbSwgZm9ybWF0KSA6IGFycmF5W2ldOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBvdXRwdXQ7CiAgICAgICAgfTsKICAgIH0KCiAgICAvLyBmb3JtYXQgZGF0ZSB1c2luZyBuYXRpdmUgZGF0ZSBvYmplY3QKICAgIGZ1bmN0aW9uIGZvcm1hdE1vbWVudChtLCBmb3JtYXQpIHsKCiAgICAgICAgaWYgKCFtLmlzVmFsaWQoKSkgewogICAgICAgICAgICByZXR1cm4gbS5sYW5nKCkuaW52YWxpZERhdGUoKTsKICAgICAgICB9CgogICAgICAgIGZvcm1hdCA9IGV4cGFuZEZvcm1hdChmb3JtYXQsIG0ubGFuZygpKTsKCiAgICAgICAgaWYgKCFmb3JtYXRGdW5jdGlvbnNbZm9ybWF0XSkgewogICAgICAgICAgICBmb3JtYXRGdW5jdGlvbnNbZm9ybWF0XSA9IG1ha2VGb3JtYXRGdW5jdGlvbihmb3JtYXQpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGZvcm1hdEZ1bmN0aW9uc1tmb3JtYXRdKG0pOwogICAgfQoKICAgIGZ1bmN0aW9uIGV4cGFuZEZvcm1hdChmb3JtYXQsIGxhbmcpIHsKICAgICAgICB2YXIgaSA9IDU7CgogICAgICAgIGZ1bmN0aW9uIHJlcGxhY2VMb25nRGF0ZUZvcm1hdFRva2VucyhpbnB1dCkgewogICAgICAgICAgICByZXR1cm4gbGFuZy5sb25nRGF0ZUZvcm1hdChpbnB1dCkgfHwgaW5wdXQ7CiAgICAgICAgfQoKICAgICAgICBsb2NhbEZvcm1hdHRpbmdUb2tlbnMubGFzdEluZGV4ID0gMDsKICAgICAgICB3aGlsZSAoaSA+PSAwICYmIGxvY2FsRm9ybWF0dGluZ1Rva2Vucy50ZXN0KGZvcm1hdCkpIHsKICAgICAgICAgICAgZm9ybWF0ID0gZm9ybWF0LnJlcGxhY2UobG9jYWxGb3JtYXR0aW5nVG9rZW5zLCByZXBsYWNlTG9uZ0RhdGVGb3JtYXRUb2tlbnMpOwogICAgICAgICAgICBsb2NhbEZvcm1hdHRpbmdUb2tlbnMubGFzdEluZGV4ID0gMDsKICAgICAgICAgICAgaSAtPSAxOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGZvcm1hdDsKICAgIH0KCgogICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgICAgIFBhcnNpbmcKICAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCgogICAgLy8gZ2V0IHRoZSByZWdleCB0byBmaW5kIHRoZSBuZXh0IHRva2VuCiAgICBmdW5jdGlvbiBnZXRQYXJzZVJlZ2V4Rm9yVG9rZW4odG9rZW4sIGNvbmZpZykgewogICAgICAgIHZhciBhLCBzdHJpY3QgPSBjb25maWcuX3N0cmljdDsKICAgICAgICBzd2l0Y2ggKHRva2VuKSB7CiAgICAgICAgY2FzZSAnUSc6CiAgICAgICAgICAgIHJldHVybiBwYXJzZVRva2VuT25lRGlnaXQ7CiAgICAgICAgY2FzZSAnRERERCc6CiAgICAgICAgICAgIHJldHVybiBwYXJzZVRva2VuVGhyZWVEaWdpdHM7CiAgICAgICAgY2FzZSAnWVlZWSc6CiAgICAgICAgY2FzZSAnR0dHRyc6CiAgICAgICAgY2FzZSAnZ2dnZyc6CiAgICAgICAgICAgIHJldHVybiBzdHJpY3QgPyBwYXJzZVRva2VuRm91ckRpZ2l0cyA6IHBhcnNlVG9rZW5PbmVUb0ZvdXJEaWdpdHM7CiAgICAgICAgY2FzZSAnWSc6CiAgICAgICAgY2FzZSAnRyc6CiAgICAgICAgY2FzZSAnZyc6CiAgICAgICAgICAgIHJldHVybiBwYXJzZVRva2VuU2lnbmVkTnVtYmVyOwogICAgICAgIGNhc2UgJ1lZWVlZWSc6CiAgICAgICAgY2FzZSAnWVlZWVknOgogICAgICAgIGNhc2UgJ0dHR0dHJzoKICAgICAgICBjYXNlICdnZ2dnZyc6CiAgICAgICAgICAgIHJldHVybiBzdHJpY3QgPyBwYXJzZVRva2VuU2l4RGlnaXRzIDogcGFyc2VUb2tlbk9uZVRvU2l4RGlnaXRzOwogICAgICAgIGNhc2UgJ1MnOgogICAgICAgICAgICBpZiAoc3RyaWN0KSB7IHJldHVybiBwYXJzZVRva2VuT25lRGlnaXQ7IH0KICAgICAgICAgICAgLyogZmFsbHMgdGhyb3VnaCAqLwogICAgICAgIGNhc2UgJ1NTJzoKICAgICAgICAgICAgaWYgKHN0cmljdCkgeyByZXR1cm4gcGFyc2VUb2tlblR3b0RpZ2l0czsgfQogICAgICAgICAgICAvKiBmYWxscyB0aHJvdWdoICovCiAgICAgICAgY2FzZSAnU1NTJzoKICAgICAgICAgICAgaWYgKHN0cmljdCkgeyByZXR1cm4gcGFyc2VUb2tlblRocmVlRGlnaXRzOyB9CiAgICAgICAgICAgIC8qIGZhbGxzIHRocm91Z2ggKi8KICAgICAgICBjYXNlICdEREQnOgogICAgICAgICAgICByZXR1cm4gcGFyc2VUb2tlbk9uZVRvVGhyZWVEaWdpdHM7CiAgICAgICAgY2FzZSAnTU1NJzoKICAgICAgICBjYXNlICdNTU1NJzoKICAgICAgICBjYXNlICdkZCc6CiAgICAgICAgY2FzZSAnZGRkJzoKICAgICAgICBjYXNlICdkZGRkJzoKICAgICAgICAgICAgcmV0dXJuIHBhcnNlVG9rZW5Xb3JkOwogICAgICAgIGNhc2UgJ2EnOgogICAgICAgIGNhc2UgJ0EnOgogICAgICAgICAgICByZXR1cm4gZ2V0TGFuZ0RlZmluaXRpb24oY29uZmlnLl9sKS5fbWVyaWRpZW1QYXJzZTsKICAgICAgICBjYXNlICdYJzoKICAgICAgICAgICAgcmV0dXJuIHBhcnNlVG9rZW5UaW1lc3RhbXBNczsKICAgICAgICBjYXNlICdaJzoKICAgICAgICBjYXNlICdaWic6CiAgICAgICAgICAgIHJldHVybiBwYXJzZVRva2VuVGltZXpvbmU7CiAgICAgICAgY2FzZSAnVCc6CiAgICAgICAgICAgIHJldHVybiBwYXJzZVRva2VuVDsKICAgICAgICBjYXNlICdTU1NTJzoKICAgICAgICAgICAgcmV0dXJuIHBhcnNlVG9rZW5EaWdpdHM7CiAgICAgICAgY2FzZSAnTU0nOgogICAgICAgIGNhc2UgJ0REJzoKICAgICAgICBjYXNlICdZWSc6CiAgICAgICAgY2FzZSAnR0cnOgogICAgICAgIGNhc2UgJ2dnJzoKICAgICAgICBjYXNlICdISCc6CiAgICAgICAgY2FzZSAnaGgnOgogICAgICAgIGNhc2UgJ21tJzoKICAgICAgICBjYXNlICdzcyc6CiAgICAgICAgY2FzZSAnd3cnOgogICAgICAgIGNhc2UgJ1dXJzoKICAgICAgICAgICAgcmV0dXJuIHN0cmljdCA/IHBhcnNlVG9rZW5Ud29EaWdpdHMgOiBwYXJzZVRva2VuT25lT3JUd29EaWdpdHM7CiAgICAgICAgY2FzZSAnTSc6CiAgICAgICAgY2FzZSAnRCc6CiAgICAgICAgY2FzZSAnZCc6CiAgICAgICAgY2FzZSAnSCc6CiAgICAgICAgY2FzZSAnaCc6CiAgICAgICAgY2FzZSAnbSc6CiAgICAgICAgY2FzZSAncyc6CiAgICAgICAgY2FzZSAndyc6CiAgICAgICAgY2FzZSAnVyc6CiAgICAgICAgY2FzZSAnZSc6CiAgICAgICAgY2FzZSAnRSc6CiAgICAgICAgICAgIHJldHVybiBwYXJzZVRva2VuT25lT3JUd29EaWdpdHM7CiAgICAgICAgY2FzZSAnRG8nOgogICAgICAgICAgICByZXR1cm4gcGFyc2VUb2tlbk9yZGluYWw7CiAgICAgICAgZGVmYXVsdCA6CiAgICAgICAgICAgIGEgPSBuZXcgUmVnRXhwKHJlZ2V4cEVzY2FwZSh1bmVzY2FwZUZvcm1hdCh0b2tlbi5yZXBsYWNlKCdcXCcsICcnKSksICJpIikpOwogICAgICAgICAgICByZXR1cm4gYTsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gdGltZXpvbmVNaW51dGVzRnJvbVN0cmluZyhzdHJpbmcpIHsKICAgICAgICBzdHJpbmcgPSBzdHJpbmcgfHwgIiI7CiAgICAgICAgdmFyIHBvc3NpYmxlVHpNYXRjaGVzID0gKHN0cmluZy5tYXRjaChwYXJzZVRva2VuVGltZXpvbmUpIHx8IFtdKSwKICAgICAgICAgICAgdHpDaHVuayA9IHBvc3NpYmxlVHpNYXRjaGVzW3Bvc3NpYmxlVHpNYXRjaGVzLmxlbmd0aCAtIDFdIHx8IFtdLAogICAgICAgICAgICBwYXJ0cyA9ICh0ekNodW5rICsgJycpLm1hdGNoKHBhcnNlVGltZXpvbmVDaHVua2VyKSB8fCBbJy0nLCAwLCAwXSwKICAgICAgICAgICAgbWludXRlcyA9ICsocGFydHNbMV0gKiA2MCkgKyB0b0ludChwYXJ0c1syXSk7CgogICAgICAgIHJldHVybiBwYXJ0c1swXSA9PT0gJysnID8gLW1pbnV0ZXMgOiBtaW51dGVzOwogICAgfQoKICAgIC8vIGZ1bmN0aW9uIHRvIGNvbnZlcnQgc3RyaW5nIGlucHV0IHRvIGRhdGUKICAgIGZ1bmN0aW9uIGFkZFRpbWVUb0FycmF5RnJvbVRva2VuKHRva2VuLCBpbnB1dCwgY29uZmlnKSB7CiAgICAgICAgdmFyIGEsIGRhdGVQYXJ0QXJyYXkgPSBjb25maWcuX2E7CgogICAgICAgIHN3aXRjaCAodG9rZW4pIHsKICAgICAgICAvLyBRVUFSVEVSCiAgICAgICAgY2FzZSAnUSc6CiAgICAgICAgICAgIGlmIChpbnB1dCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBkYXRlUGFydEFycmF5W01PTlRIXSA9ICh0b0ludChpbnB1dCkgLSAxKSAqIDM7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgLy8gTU9OVEgKICAgICAgICBjYXNlICdNJyA6IC8vIGZhbGwgdGhyb3VnaCB0byBNTQogICAgICAgIGNhc2UgJ01NJyA6CiAgICAgICAgICAgIGlmIChpbnB1dCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBkYXRlUGFydEFycmF5W01PTlRIXSA9IHRvSW50KGlucHV0KSAtIDE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAnTU1NJyA6IC8vIGZhbGwgdGhyb3VnaCB0byBNTU1NCiAgICAgICAgY2FzZSAnTU1NTScgOgogICAgICAgICAgICBhID0gZ2V0TGFuZ0RlZmluaXRpb24oY29uZmlnLl9sKS5tb250aHNQYXJzZShpbnB1dCk7CiAgICAgICAgICAgIC8vIGlmIHdlIGRpZG4ndCBmaW5kIGEgbW9udGggbmFtZSwgbWFyayB0aGUgZGF0ZSBhcyBpbnZhbGlkLgogICAgICAgICAgICBpZiAoYSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBkYXRlUGFydEFycmF5W01PTlRIXSA9IGE7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjb25maWcuX3BmLmludmFsaWRNb250aCA9IGlucHV0OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIC8vIERBWSBPRiBNT05USAogICAgICAgIGNhc2UgJ0QnIDogLy8gZmFsbCB0aHJvdWdoIHRvIERECiAgICAgICAgY2FzZSAnREQnIDoKICAgICAgICAgICAgaWYgKGlucHV0ICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGRhdGVQYXJ0QXJyYXlbREFURV0gPSB0b0ludChpbnB1dCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAnRG8nIDoKICAgICAgICAgICAgaWYgKGlucHV0ICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGRhdGVQYXJ0QXJyYXlbREFURV0gPSB0b0ludChwYXJzZUludChpbnB1dCwgMTApKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICAvLyBEQVkgT0YgWUVBUgogICAgICAgIGNhc2UgJ0RERCcgOiAvLyBmYWxsIHRocm91Z2ggdG8gRERERAogICAgICAgIGNhc2UgJ0REREQnIDoKICAgICAgICAgICAgaWYgKGlucHV0ICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGNvbmZpZy5fZGF5T2ZZZWFyID0gdG9JbnQoaW5wdXQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBicmVhazsKICAgICAgICAvLyBZRUFSCiAgICAgICAgY2FzZSAnWVknIDoKICAgICAgICAgICAgZGF0ZVBhcnRBcnJheVtZRUFSXSA9IG1vbWVudC5wYXJzZVR3b0RpZ2l0WWVhcihpbnB1dCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJ1lZWVknIDoKICAgICAgICBjYXNlICdZWVlZWScgOgogICAgICAgIGNhc2UgJ1lZWVlZWScgOgogICAgICAgICAgICBkYXRlUGFydEFycmF5W1lFQVJdID0gdG9JbnQoaW5wdXQpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAvLyBBTSAvIFBNCiAgICAgICAgY2FzZSAnYScgOiAvLyBmYWxsIHRocm91Z2ggdG8gQQogICAgICAgIGNhc2UgJ0EnIDoKICAgICAgICAgICAgY29uZmlnLl9pc1BtID0gZ2V0TGFuZ0RlZmluaXRpb24oY29uZmlnLl9sKS5pc1BNKGlucHV0KTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgLy8gMjQgSE9VUgogICAgICAgIGNhc2UgJ0gnIDogLy8gZmFsbCB0aHJvdWdoIHRvIGhoCiAgICAgICAgY2FzZSAnSEgnIDogLy8gZmFsbCB0aHJvdWdoIHRvIGhoCiAgICAgICAgY2FzZSAnaCcgOiAvLyBmYWxsIHRocm91Z2ggdG8gaGgKICAgICAgICBjYXNlICdoaCcgOgogICAgICAgICAgICBkYXRlUGFydEFycmF5W0hPVVJdID0gdG9JbnQoaW5wdXQpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAvLyBNSU5VVEUKICAgICAgICBjYXNlICdtJyA6IC8vIGZhbGwgdGhyb3VnaCB0byBtbQogICAgICAgIGNhc2UgJ21tJyA6CiAgICAgICAgICAgIGRhdGVQYXJ0QXJyYXlbTUlOVVRFXSA9IHRvSW50KGlucHV0KTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgLy8gU0VDT05ECiAgICAgICAgY2FzZSAncycgOiAvLyBmYWxsIHRocm91Z2ggdG8gc3MKICAgICAgICBjYXNlICdzcycgOgogICAgICAgICAgICBkYXRlUGFydEFycmF5W1NFQ09ORF0gPSB0b0ludChpbnB1dCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIC8vIE1JTExJU0VDT05ECiAgICAgICAgY2FzZSAnUycgOgogICAgICAgIGNhc2UgJ1NTJyA6CiAgICAgICAgY2FzZSAnU1NTJyA6CiAgICAgICAgY2FzZSAnU1NTUycgOgogICAgICAgICAgICBkYXRlUGFydEFycmF5W01JTExJU0VDT05EXSA9IHRvSW50KCgnMC4nICsgaW5wdXQpICogMTAwMCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIC8vIFVOSVggVElNRVNUQU1QIFdJVEggTVMKICAgICAgICBjYXNlICdYJzoKICAgICAgICAgICAgY29uZmlnLl9kID0gbmV3IERhdGUocGFyc2VGbG9hdChpbnB1dCkgKiAxMDAwKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgLy8gVElNRVpPTkUKICAgICAgICBjYXNlICdaJyA6IC8vIGZhbGwgdGhyb3VnaCB0byBaWgogICAgICAgIGNhc2UgJ1paJyA6CiAgICAgICAgICAgIGNvbmZpZy5fdXNlVVRDID0gdHJ1ZTsKICAgICAgICAgICAgY29uZmlnLl90em0gPSB0aW1lem9uZU1pbnV0ZXNGcm9tU3RyaW5nKGlucHV0KTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAndyc6CiAgICAgICAgY2FzZSAnd3cnOgogICAgICAgIGNhc2UgJ1cnOgogICAgICAgIGNhc2UgJ1dXJzoKICAgICAgICBjYXNlICdkJzoKICAgICAgICBjYXNlICdkZCc6CiAgICAgICAgY2FzZSAnZGRkJzoKICAgICAgICBjYXNlICdkZGRkJzoKICAgICAgICBjYXNlICdlJzoKICAgICAgICBjYXNlICdFJzoKICAgICAgICAgICAgdG9rZW4gPSB0b2tlbi5zdWJzdHIoMCwgMSk7CiAgICAgICAgICAgIC8qIGZhbGxzIHRocm91Z2ggKi8KICAgICAgICBjYXNlICdnZyc6CiAgICAgICAgY2FzZSAnZ2dnZyc6CiAgICAgICAgY2FzZSAnR0cnOgogICAgICAgIGNhc2UgJ0dHR0cnOgogICAgICAgIGNhc2UgJ0dHR0dHJzoKICAgICAgICAgICAgdG9rZW4gPSB0b2tlbi5zdWJzdHIoMCwgMik7CiAgICAgICAgICAgIGlmIChpbnB1dCkgewogICAgICAgICAgICAgICAgY29uZmlnLl93ID0gY29uZmlnLl93IHx8IHt9OwogICAgICAgICAgICAgICAgY29uZmlnLl93W3Rva2VuXSA9IGlucHV0OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBjb252ZXJ0IGFuIGFycmF5IHRvIGEgZGF0ZS4KICAgIC8vIHRoZSBhcnJheSBzaG91bGQgbWlycm9yIHRoZSBwYXJhbWV0ZXJzIGJlbG93CiAgICAvLyBub3RlOiBhbGwgdmFsdWVzIHBhc3QgdGhlIHllYXIgYXJlIG9wdGlvbmFsIGFuZCB3aWxsIGRlZmF1bHQgdG8gdGhlIGxvd2VzdCBwb3NzaWJsZSB2YWx1ZS4KICAgIC8vIFt5ZWFyLCBtb250aCwgZGF5ICwgaG91ciwgbWludXRlLCBzZWNvbmQsIG1pbGxpc2Vjb25kXQogICAgZnVuY3Rpb24gZGF0ZUZyb21Db25maWcoY29uZmlnKSB7CiAgICAgICAgdmFyIGksIGRhdGUsIGlucHV0ID0gW10sIGN1cnJlbnREYXRlLAogICAgICAgICAgICB5ZWFyVG9Vc2UsIGZpeFllYXIsIHcsIHRlbXAsIGxhbmcsIHdlZWtkYXksIHdlZWs7CgogICAgICAgIGlmIChjb25maWcuX2QpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgY3VycmVudERhdGUgPSBjdXJyZW50RGF0ZUFycmF5KGNvbmZpZyk7CgogICAgICAgIC8vY29tcHV0ZSBkYXkgb2YgdGhlIHllYXIgZnJvbSB3ZWVrcyBhbmQgd2Vla2RheXMKICAgICAgICBpZiAoY29uZmlnLl93ICYmIGNvbmZpZy5fYVtEQVRFXSA9PSBudWxsICYmIGNvbmZpZy5fYVtNT05USF0gPT0gbnVsbCkgewogICAgICAgICAgICBmaXhZZWFyID0gZnVuY3Rpb24gKHZhbCkgewogICAgICAgICAgICAgICAgdmFyIGludFZhbCA9IHBhcnNlSW50KHZhbCwgMTApOwogICAgICAgICAgICAgICAgcmV0dXJuIHZhbCA/CiAgICAgICAgICAgICAgICAgICh2YWwubGVuZ3RoIDwgMyA/IChpbnRWYWwgPiA2OCA/IDE5MDAgKyBpbnRWYWwgOiAyMDAwICsgaW50VmFsKSA6IGludFZhbCkgOgogICAgICAgICAgICAgICAgICAoY29uZmlnLl9hW1lFQVJdID09IG51bGwgPyBtb21lbnQoKS53ZWVrWWVhcigpIDogY29uZmlnLl9hW1lFQVJdKTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHcgPSBjb25maWcuX3c7CiAgICAgICAgICAgIGlmICh3LkdHICE9IG51bGwgfHwgdy5XICE9IG51bGwgfHwgdy5FICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIHRlbXAgPSBkYXlPZlllYXJGcm9tV2Vla3MoZml4WWVhcih3LkdHKSwgdy5XIHx8IDEsIHcuRSwgNCwgMSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBsYW5nID0gZ2V0TGFuZ0RlZmluaXRpb24oY29uZmlnLl9sKTsKICAgICAgICAgICAgICAgIHdlZWtkYXkgPSB3LmQgIT0gbnVsbCA/ICBwYXJzZVdlZWtkYXkody5kLCBsYW5nKSA6CiAgICAgICAgICAgICAgICAgICh3LmUgIT0gbnVsbCA/ICBwYXJzZUludCh3LmUsIDEwKSArIGxhbmcuX3dlZWsuZG93IDogMCk7CgogICAgICAgICAgICAgICAgd2VlayA9IHBhcnNlSW50KHcudywgMTApIHx8IDE7CgogICAgICAgICAgICAgICAgLy9pZiB3ZSdyZSBwYXJzaW5nICdkJywgdGhlbiB0aGUgbG93IGRheSBudW1iZXJzIG1heSBiZSBuZXh0IHdlZWsKICAgICAgICAgICAgICAgIGlmICh3LmQgIT0gbnVsbCAmJiB3ZWVrZGF5IDwgbGFuZy5fd2Vlay5kb3cpIHsKICAgICAgICAgICAgICAgICAgICB3ZWVrKys7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGVtcCA9IGRheU9mWWVhckZyb21XZWVrcyhmaXhZZWFyKHcuZ2cpLCB3ZWVrLCB3ZWVrZGF5LCBsYW5nLl93ZWVrLmRveSwgbGFuZy5fd2Vlay5kb3cpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjb25maWcuX2FbWUVBUl0gPSB0ZW1wLnllYXI7CiAgICAgICAgICAgIGNvbmZpZy5fZGF5T2ZZZWFyID0gdGVtcC5kYXlPZlllYXI7CiAgICAgICAgfQoKICAgICAgICAvL2lmIHRoZSBkYXkgb2YgdGhlIHllYXIgaXMgc2V0LCBmaWd1cmUgb3V0IHdoYXQgaXQgaXMKICAgICAgICBpZiAoY29uZmlnLl9kYXlPZlllYXIpIHsKICAgICAgICAgICAgeWVhclRvVXNlID0gY29uZmlnLl9hW1lFQVJdID09IG51bGwgPyBjdXJyZW50RGF0ZVtZRUFSXSA6IGNvbmZpZy5fYVtZRUFSXTsKCiAgICAgICAgICAgIGlmIChjb25maWcuX2RheU9mWWVhciA+IGRheXNJblllYXIoeWVhclRvVXNlKSkgewogICAgICAgICAgICAgICAgY29uZmlnLl9wZi5fb3ZlcmZsb3dEYXlPZlllYXIgPSB0cnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBkYXRlID0gbWFrZVVUQ0RhdGUoeWVhclRvVXNlLCAwLCBjb25maWcuX2RheU9mWWVhcik7CiAgICAgICAgICAgIGNvbmZpZy5fYVtNT05USF0gPSBkYXRlLmdldFVUQ01vbnRoKCk7CiAgICAgICAgICAgIGNvbmZpZy5fYVtEQVRFXSA9IGRhdGUuZ2V0VVRDRGF0ZSgpOwogICAgICAgIH0KCiAgICAgICAgLy8gRGVmYXVsdCB0byBjdXJyZW50IGRhdGUuCiAgICAgICAgLy8gKiBpZiBubyB5ZWFyLCBtb250aCwgZGF5IG9mIG1vbnRoIGFyZSBnaXZlbiwgZGVmYXVsdCB0byB0b2RheQogICAgICAgIC8vICogaWYgZGF5IG9mIG1vbnRoIGlzIGdpdmVuLCBkZWZhdWx0IG1vbnRoIGFuZCB5ZWFyCiAgICAgICAgLy8gKiBpZiBtb250aCBpcyBnaXZlbiwgZGVmYXVsdCBvbmx5IHllYXIKICAgICAgICAvLyAqIGlmIHllYXIgaXMgZ2l2ZW4sIGRvbid0IGRlZmF1bHQgYW55dGhpbmcKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgMyAmJiBjb25maWcuX2FbaV0gPT0gbnVsbDsgKytpKSB7CiAgICAgICAgICAgIGNvbmZpZy5fYVtpXSA9IGlucHV0W2ldID0gY3VycmVudERhdGVbaV07CiAgICAgICAgfQoKICAgICAgICAvLyBaZXJvIG91dCB3aGF0ZXZlciB3YXMgbm90IGRlZmF1bHRlZCwgaW5jbHVkaW5nIHRpbWUKICAgICAgICBmb3IgKDsgaSA8IDc7IGkrKykgewogICAgICAgICAgICBjb25maWcuX2FbaV0gPSBpbnB1dFtpXSA9IChjb25maWcuX2FbaV0gPT0gbnVsbCkgPyAoaSA9PT0gMiA/IDEgOiAwKSA6IGNvbmZpZy5fYVtpXTsKICAgICAgICB9CgogICAgICAgIC8vIGFkZCB0aGUgb2Zmc2V0cyB0byB0aGUgdGltZSB0byBiZSBwYXJzZWQgc28gdGhhdCB3ZSBjYW4gaGF2ZSBhIGNsZWFuIGFycmF5IGZvciBjaGVja2luZyBpc1ZhbGlkCiAgICAgICAgaW5wdXRbSE9VUl0gKz0gdG9JbnQoKGNvbmZpZy5fdHptIHx8IDApIC8gNjApOwogICAgICAgIGlucHV0W01JTlVURV0gKz0gdG9JbnQoKGNvbmZpZy5fdHptIHx8IDApICUgNjApOwoKICAgICAgICBjb25maWcuX2QgPSAoY29uZmlnLl91c2VVVEMgPyBtYWtlVVRDRGF0ZSA6IG1ha2VEYXRlKS5hcHBseShudWxsLCBpbnB1dCk7CiAgICB9CgogICAgZnVuY3Rpb24gZGF0ZUZyb21PYmplY3QoY29uZmlnKSB7CiAgICAgICAgdmFyIG5vcm1hbGl6ZWRJbnB1dDsKCiAgICAgICAgaWYgKGNvbmZpZy5fZCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBub3JtYWxpemVkSW5wdXQgPSBub3JtYWxpemVPYmplY3RVbml0cyhjb25maWcuX2kpOwogICAgICAgIGNvbmZpZy5fYSA9IFsKICAgICAgICAgICAgbm9ybWFsaXplZElucHV0LnllYXIsCiAgICAgICAgICAgIG5vcm1hbGl6ZWRJbnB1dC5tb250aCwKICAgICAgICAgICAgbm9ybWFsaXplZElucHV0LmRheSwKICAgICAgICAgICAgbm9ybWFsaXplZElucHV0LmhvdXIsCiAgICAgICAgICAgIG5vcm1hbGl6ZWRJbnB1dC5taW51dGUsCiAgICAgICAgICAgIG5vcm1hbGl6ZWRJbnB1dC5zZWNvbmQsCiAgICAgICAgICAgIG5vcm1hbGl6ZWRJbnB1dC5taWxsaXNlY29uZAogICAgICAgIF07CgogICAgICAgIGRhdGVGcm9tQ29uZmlnKGNvbmZpZyk7CiAgICB9CgogICAgZnVuY3Rpb24gY3VycmVudERhdGVBcnJheShjb25maWcpIHsKICAgICAgICB2YXIgbm93ID0gbmV3IERhdGUoKTsKICAgICAgICBpZiAoY29uZmlnLl91c2VVVEMpIHsKICAgICAgICAgICAgcmV0dXJuIFsKICAgICAgICAgICAgICAgIG5vdy5nZXRVVENGdWxsWWVhcigpLAogICAgICAgICAgICAgICAgbm93LmdldFVUQ01vbnRoKCksCiAgICAgICAgICAgICAgICBub3cuZ2V0VVRDRGF0ZSgpCiAgICAgICAgICAgIF07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIFtub3cuZ2V0RnVsbFllYXIoKSwgbm93LmdldE1vbnRoKCksIG5vdy5nZXREYXRlKCldOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBkYXRlIGZyb20gc3RyaW5nIGFuZCBmb3JtYXQgc3RyaW5nCiAgICBmdW5jdGlvbiBtYWtlRGF0ZUZyb21TdHJpbmdBbmRGb3JtYXQoY29uZmlnKSB7CgogICAgICAgIGNvbmZpZy5fYSA9IFtdOwogICAgICAgIGNvbmZpZy5fcGYuZW1wdHkgPSB0cnVlOwoKICAgICAgICAvLyBUaGlzIGFycmF5IGlzIHVzZWQgdG8gbWFrZSBhIERhdGUsIGVpdGhlciB3aXRoIGBuZXcgRGF0ZWAgb3IgYERhdGUuVVRDYAogICAgICAgIHZhciBsYW5nID0gZ2V0TGFuZ0RlZmluaXRpb24oY29uZmlnLl9sKSwKICAgICAgICAgICAgc3RyaW5nID0gJycgKyBjb25maWcuX2ksCiAgICAgICAgICAgIGksIHBhcnNlZElucHV0LCB0b2tlbnMsIHRva2VuLCBza2lwcGVkLAogICAgICAgICAgICBzdHJpbmdMZW5ndGggPSBzdHJpbmcubGVuZ3RoLAogICAgICAgICAgICB0b3RhbFBhcnNlZElucHV0TGVuZ3RoID0gMDsKCiAgICAgICAgdG9rZW5zID0gZXhwYW5kRm9ybWF0KGNvbmZpZy5fZiwgbGFuZykubWF0Y2goZm9ybWF0dGluZ1Rva2VucykgfHwgW107CgogICAgICAgIGZvciAoaSA9IDA7IGkgPCB0b2tlbnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdG9rZW4gPSB0b2tlbnNbaV07CiAgICAgICAgICAgIHBhcnNlZElucHV0ID0gKHN0cmluZy5tYXRjaChnZXRQYXJzZVJlZ2V4Rm9yVG9rZW4odG9rZW4sIGNvbmZpZykpIHx8IFtdKVswXTsKICAgICAgICAgICAgaWYgKHBhcnNlZElucHV0KSB7CiAgICAgICAgICAgICAgICBza2lwcGVkID0gc3RyaW5nLnN1YnN0cigwLCBzdHJpbmcuaW5kZXhPZihwYXJzZWRJbnB1dCkpOwogICAgICAgICAgICAgICAgaWYgKHNraXBwZWQubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIGNvbmZpZy5fcGYudW51c2VkSW5wdXQucHVzaChza2lwcGVkKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHN0cmluZyA9IHN0cmluZy5zbGljZShzdHJpbmcuaW5kZXhPZihwYXJzZWRJbnB1dCkgKyBwYXJzZWRJbnB1dC5sZW5ndGgpOwogICAgICAgICAgICAgICAgdG90YWxQYXJzZWRJbnB1dExlbmd0aCArPSBwYXJzZWRJbnB1dC5sZW5ndGg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gZG9uJ3QgcGFyc2UgaWYgaXQncyBub3QgYSBrbm93biB0b2tlbgogICAgICAgICAgICBpZiAoZm9ybWF0VG9rZW5GdW5jdGlvbnNbdG9rZW5dKSB7CiAgICAgICAgICAgICAgICBpZiAocGFyc2VkSW5wdXQpIHsKICAgICAgICAgICAgICAgICAgICBjb25maWcuX3BmLmVtcHR5ID0gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBjb25maWcuX3BmLnVudXNlZFRva2Vucy5wdXNoKHRva2VuKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGFkZFRpbWVUb0FycmF5RnJvbVRva2VuKHRva2VuLCBwYXJzZWRJbnB1dCwgY29uZmlnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmIChjb25maWcuX3N0cmljdCAmJiAhcGFyc2VkSW5wdXQpIHsKICAgICAgICAgICAgICAgIGNvbmZpZy5fcGYudW51c2VkVG9rZW5zLnB1c2godG9rZW4pOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBhZGQgcmVtYWluaW5nIHVucGFyc2VkIGlucHV0IGxlbmd0aCB0byB0aGUgc3RyaW5nCiAgICAgICAgY29uZmlnLl9wZi5jaGFyc0xlZnRPdmVyID0gc3RyaW5nTGVuZ3RoIC0gdG90YWxQYXJzZWRJbnB1dExlbmd0aDsKICAgICAgICBpZiAoc3RyaW5nLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgY29uZmlnLl9wZi51bnVzZWRJbnB1dC5wdXNoKHN0cmluZyk7CiAgICAgICAgfQoKICAgICAgICAvLyBoYW5kbGUgYW0gcG0KICAgICAgICBpZiAoY29uZmlnLl9pc1BtICYmIGNvbmZpZy5fYVtIT1VSXSA8IDEyKSB7CiAgICAgICAgICAgIGNvbmZpZy5fYVtIT1VSXSArPSAxMjsKICAgICAgICB9CiAgICAgICAgLy8gaWYgaXMgMTIgYW0sIGNoYW5nZSBob3VycyB0byAwCiAgICAgICAgaWYgKGNvbmZpZy5faXNQbSA9PT0gZmFsc2UgJiYgY29uZmlnLl9hW0hPVVJdID09PSAxMikgewogICAgICAgICAgICBjb25maWcuX2FbSE9VUl0gPSAwOwogICAgICAgIH0KCiAgICAgICAgZGF0ZUZyb21Db25maWcoY29uZmlnKTsKICAgICAgICBjaGVja092ZXJmbG93KGNvbmZpZyk7CiAgICB9CgogICAgZnVuY3Rpb24gdW5lc2NhcGVGb3JtYXQocykgewogICAgICAgIHJldHVybiBzLnJlcGxhY2UoL1xcKFxbKXxcXChcXSl8XFsoW15cXVxbXSopXF18XFwoLikvZywgZnVuY3Rpb24gKG1hdGNoZWQsIHAxLCBwMiwgcDMsIHA0KSB7CiAgICAgICAgICAgIHJldHVybiBwMSB8fCBwMiB8fCBwMyB8fCBwNDsKICAgICAgICB9KTsKICAgIH0KCiAgICAvLyBDb2RlIGZyb20gaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8zNTYxNDkzL2lzLXRoZXJlLWEtcmVnZXhwLWVzY2FwZS1mdW5jdGlvbi1pbi1qYXZhc2NyaXB0CiAgICBmdW5jdGlvbiByZWdleHBFc2NhcGUocykgewogICAgICAgIHJldHVybiBzLnJlcGxhY2UoL1stXC9cXF4kKis/LigpfFtcXXt9XS9nLCAnXFwkJicpOwogICAgfQoKICAgIC8vIGRhdGUgZnJvbSBzdHJpbmcgYW5kIGFycmF5IG9mIGZvcm1hdCBzdHJpbmdzCiAgICBmdW5jdGlvbiBtYWtlRGF0ZUZyb21TdHJpbmdBbmRBcnJheShjb25maWcpIHsKICAgICAgICB2YXIgdGVtcENvbmZpZywKICAgICAgICAgICAgYmVzdE1vbWVudCwKCiAgICAgICAgICAgIHNjb3JlVG9CZWF0LAogICAgICAgICAgICBpLAogICAgICAgICAgICBjdXJyZW50U2NvcmU7CgogICAgICAgIGlmIChjb25maWcuX2YubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgIGNvbmZpZy5fcGYuaW52YWxpZEZvcm1hdCA9IHRydWU7CiAgICAgICAgICAgIGNvbmZpZy5fZCA9IG5ldyBEYXRlKE5hTik7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGZvciAoaSA9IDA7IGkgPCBjb25maWcuX2YubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY3VycmVudFNjb3JlID0gMDsKICAgICAgICAgICAgdGVtcENvbmZpZyA9IGV4dGVuZCh7fSwgY29uZmlnKTsKICAgICAgICAgICAgdGVtcENvbmZpZy5fcGYgPSBkZWZhdWx0UGFyc2luZ0ZsYWdzKCk7CiAgICAgICAgICAgIHRlbXBDb25maWcuX2YgPSBjb25maWcuX2ZbaV07CiAgICAgICAgICAgIG1ha2VEYXRlRnJvbVN0cmluZ0FuZEZvcm1hdCh0ZW1wQ29uZmlnKTsKCiAgICAgICAgICAgIGlmICghaXNWYWxpZCh0ZW1wQ29uZmlnKSkgewogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGlmIHRoZXJlIGlzIGFueSBpbnB1dCB0aGF0IHdhcyBub3QgcGFyc2VkIGFkZCBhIHBlbmFsdHkgZm9yIHRoYXQgZm9ybWF0CiAgICAgICAgICAgIGN1cnJlbnRTY29yZSArPSB0ZW1wQ29uZmlnLl9wZi5jaGFyc0xlZnRPdmVyOwoKICAgICAgICAgICAgLy9vciB0b2tlbnMKICAgICAgICAgICAgY3VycmVudFNjb3JlICs9IHRlbXBDb25maWcuX3BmLnVudXNlZFRva2Vucy5sZW5ndGggKiAxMDsKCiAgICAgICAgICAgIHRlbXBDb25maWcuX3BmLnNjb3JlID0gY3VycmVudFNjb3JlOwoKICAgICAgICAgICAgaWYgKHNjb3JlVG9CZWF0ID09IG51bGwgfHwgY3VycmVudFNjb3JlIDwgc2NvcmVUb0JlYXQpIHsKICAgICAgICAgICAgICAgIHNjb3JlVG9CZWF0ID0gY3VycmVudFNjb3JlOwogICAgICAgICAgICAgICAgYmVzdE1vbWVudCA9IHRlbXBDb25maWc7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGV4dGVuZChjb25maWcsIGJlc3RNb21lbnQgfHwgdGVtcENvbmZpZyk7CiAgICB9CgogICAgLy8gZGF0ZSBmcm9tIGlzbyBmb3JtYXQKICAgIGZ1bmN0aW9uIG1ha2VEYXRlRnJvbVN0cmluZyhjb25maWcpIHsKICAgICAgICB2YXIgaSwgbCwKICAgICAgICAgICAgc3RyaW5nID0gY29uZmlnLl9pLAogICAgICAgICAgICBtYXRjaCA9IGlzb1JlZ2V4LmV4ZWMoc3RyaW5nKTsKCiAgICAgICAgaWYgKG1hdGNoKSB7CiAgICAgICAgICAgIGNvbmZpZy5fcGYuaXNvID0gdHJ1ZTsKICAgICAgICAgICAgZm9yIChpID0gMCwgbCA9IGlzb0RhdGVzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKGlzb0RhdGVzW2ldWzFdLmV4ZWMoc3RyaW5nKSkgewogICAgICAgICAgICAgICAgICAgIC8vIG1hdGNoWzVdIHNob3VsZCBiZSAiVCIgb3IgdW5kZWZpbmVkCiAgICAgICAgICAgICAgICAgICAgY29uZmlnLl9mID0gaXNvRGF0ZXNbaV1bMF0gKyAobWF0Y2hbNl0gfHwgIiAiKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgKGkgPSAwLCBsID0gaXNvVGltZXMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAoaXNvVGltZXNbaV1bMV0uZXhlYyhzdHJpbmcpKSB7CiAgICAgICAgICAgICAgICAgICAgY29uZmlnLl9mICs9IGlzb1RpbWVzW2ldWzBdOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChzdHJpbmcubWF0Y2gocGFyc2VUb2tlblRpbWV6b25lKSkgewogICAgICAgICAgICAgICAgY29uZmlnLl9mICs9ICJaIjsKICAgICAgICAgICAgfQogICAgICAgICAgICBtYWtlRGF0ZUZyb21TdHJpbmdBbmRGb3JtYXQoY29uZmlnKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIG1vbWVudC5jcmVhdGVGcm9tSW5wdXRGYWxsYmFjayhjb25maWcpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBtYWtlRGF0ZUZyb21JbnB1dChjb25maWcpIHsKICAgICAgICB2YXIgaW5wdXQgPSBjb25maWcuX2ksCiAgICAgICAgICAgIG1hdGNoZWQgPSBhc3BOZXRKc29uUmVnZXguZXhlYyhpbnB1dCk7CgogICAgICAgIGlmIChpbnB1dCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIGNvbmZpZy5fZCA9IG5ldyBEYXRlKCk7CiAgICAgICAgfSBlbHNlIGlmIChtYXRjaGVkKSB7CiAgICAgICAgICAgIGNvbmZpZy5fZCA9IG5ldyBEYXRlKCttYXRjaGVkWzFdKTsKICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBpbnB1dCA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgbWFrZURhdGVGcm9tU3RyaW5nKGNvbmZpZyk7CiAgICAgICAgfSBlbHNlIGlmIChpc0FycmF5KGlucHV0KSkgewogICAgICAgICAgICBjb25maWcuX2EgPSBpbnB1dC5zbGljZSgwKTsKICAgICAgICAgICAgZGF0ZUZyb21Db25maWcoY29uZmlnKTsKICAgICAgICB9IGVsc2UgaWYgKGlzRGF0ZShpbnB1dCkpIHsKICAgICAgICAgICAgY29uZmlnLl9kID0gbmV3IERhdGUoK2lucHV0KTsKICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZihpbnB1dCkgPT09ICdvYmplY3QnKSB7CiAgICAgICAgICAgIGRhdGVGcm9tT2JqZWN0KGNvbmZpZyk7CiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YoaW5wdXQpID09PSAnbnVtYmVyJykgewogICAgICAgICAgICAvLyBmcm9tIG1pbGxpc2Vjb25kcwogICAgICAgICAgICBjb25maWcuX2QgPSBuZXcgRGF0ZShpbnB1dCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbW9tZW50LmNyZWF0ZUZyb21JbnB1dEZhbGxiYWNrKGNvbmZpZyk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIG1ha2VEYXRlKHksIG0sIGQsIGgsIE0sIHMsIG1zKSB7CiAgICAgICAgLy9jYW4ndCBqdXN0IGFwcGx5KCkgdG8gY3JlYXRlIGEgZGF0ZToKICAgICAgICAvL2h0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMTgxMzQ4L2luc3RhbnRpYXRpbmctYS1qYXZhc2NyaXB0LW9iamVjdC1ieS1jYWxsaW5nLXByb3RvdHlwZS1jb25zdHJ1Y3Rvci1hcHBseQogICAgICAgIHZhciBkYXRlID0gbmV3IERhdGUoeSwgbSwgZCwgaCwgTSwgcywgbXMpOwoKICAgICAgICAvL3RoZSBkYXRlIGNvbnN0cnVjdG9yIGRvZXNuJ3QgYWNjZXB0IHllYXJzIDwgMTk3MAogICAgICAgIGlmICh5IDwgMTk3MCkgewogICAgICAgICAgICBkYXRlLnNldEZ1bGxZZWFyKHkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZGF0ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBtYWtlVVRDRGF0ZSh5KSB7CiAgICAgICAgdmFyIGRhdGUgPSBuZXcgRGF0ZShEYXRlLlVUQy5hcHBseShudWxsLCBhcmd1bWVudHMpKTsKICAgICAgICBpZiAoeSA8IDE5NzApIHsKICAgICAgICAgICAgZGF0ZS5zZXRVVENGdWxsWWVhcih5KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGRhdGU7CiAgICB9CgogICAgZnVuY3Rpb24gcGFyc2VXZWVrZGF5KGlucHV0LCBsYW5ndWFnZSkgewogICAgICAgIGlmICh0eXBlb2YgaW5wdXQgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgIGlmICghaXNOYU4oaW5wdXQpKSB7CiAgICAgICAgICAgICAgICBpbnB1dCA9IHBhcnNlSW50KGlucHV0LCAxMCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBpbnB1dCA9IGxhbmd1YWdlLndlZWtkYXlzUGFyc2UoaW5wdXQpOwogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBpbnB1dCAhPT0gJ251bWJlcicpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gaW5wdXQ7CiAgICB9CgogICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgICAgIFJlbGF0aXZlIFRpbWUKICAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCgogICAgLy8gaGVscGVyIGZ1bmN0aW9uIGZvciBtb21lbnQuZm4uZnJvbSwgbW9tZW50LmZuLmZyb21Ob3csIGFuZCBtb21lbnQuZHVyYXRpb24uZm4uaHVtYW5pemUKICAgIGZ1bmN0aW9uIHN1YnN0aXR1dGVUaW1lQWdvKHN0cmluZywgbnVtYmVyLCB3aXRob3V0U3VmZml4LCBpc0Z1dHVyZSwgbGFuZykgewogICAgICAgIHJldHVybiBsYW5nLnJlbGF0aXZlVGltZShudW1iZXIgfHwgMSwgISF3aXRob3V0U3VmZml4LCBzdHJpbmcsIGlzRnV0dXJlKTsKICAgIH0KCiAgICBmdW5jdGlvbiByZWxhdGl2ZVRpbWUobWlsbGlzZWNvbmRzLCB3aXRob3V0U3VmZml4LCBsYW5nKSB7CiAgICAgICAgdmFyIHNlY29uZHMgPSByb3VuZChNYXRoLmFicyhtaWxsaXNlY29uZHMpIC8gMTAwMCksCiAgICAgICAgICAgIG1pbnV0ZXMgPSByb3VuZChzZWNvbmRzIC8gNjApLAogICAgICAgICAgICBob3VycyA9IHJvdW5kKG1pbnV0ZXMgLyA2MCksCiAgICAgICAgICAgIGRheXMgPSByb3VuZChob3VycyAvIDI0KSwKICAgICAgICAgICAgeWVhcnMgPSByb3VuZChkYXlzIC8gMzY1KSwKICAgICAgICAgICAgYXJncyA9IHNlY29uZHMgPCA0NSAmJiBbJ3MnLCBzZWNvbmRzXSB8fAogICAgICAgICAgICAgICAgbWludXRlcyA9PT0gMSAmJiBbJ20nXSB8fAogICAgICAgICAgICAgICAgbWludXRlcyA8IDQ1ICYmIFsnbW0nLCBtaW51dGVzXSB8fAogICAgICAgICAgICAgICAgaG91cnMgPT09IDEgJiYgWydoJ10gfHwKICAgICAgICAgICAgICAgIGhvdXJzIDwgMjIgJiYgWydoaCcsIGhvdXJzXSB8fAogICAgICAgICAgICAgICAgZGF5cyA9PT0gMSAmJiBbJ2QnXSB8fAogICAgICAgICAgICAgICAgZGF5cyA8PSAyNSAmJiBbJ2RkJywgZGF5c10gfHwKICAgICAgICAgICAgICAgIGRheXMgPD0gNDUgJiYgWydNJ10gfHwKICAgICAgICAgICAgICAgIGRheXMgPCAzNDUgJiYgWydNTScsIHJvdW5kKGRheXMgLyAzMCldIHx8CiAgICAgICAgICAgICAgICB5ZWFycyA9PT0gMSAmJiBbJ3knXSB8fCBbJ3l5JywgeWVhcnNdOwogICAgICAgIGFyZ3NbMl0gPSB3aXRob3V0U3VmZml4OwogICAgICAgIGFyZ3NbM10gPSBtaWxsaXNlY29uZHMgPiAwOwogICAgICAgIGFyZ3NbNF0gPSBsYW5nOwogICAgICAgIHJldHVybiBzdWJzdGl0dXRlVGltZUFnby5hcHBseSh7fSwgYXJncyk7CiAgICB9CgoKICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAgICAgICBXZWVrIG9mIFllYXIKICAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCgogICAgLy8gZmlyc3REYXlPZldlZWsgICAgICAgMCA9IHN1biwgNiA9IHNhdAogICAgLy8gICAgICAgICAgICAgICAgICAgICAgdGhlIGRheSBvZiB0aGUgd2VlayB0aGF0IHN0YXJ0cyB0aGUgd2VlawogICAgLy8gICAgICAgICAgICAgICAgICAgICAgKHVzdWFsbHkgc3VuZGF5IG9yIG1vbmRheSkKICAgIC8vIGZpcnN0RGF5T2ZXZWVrT2ZZZWFyIDAgPSBzdW4sIDYgPSBzYXQKICAgIC8vICAgICAgICAgICAgICAgICAgICAgIHRoZSBmaXJzdCB3ZWVrIGlzIHRoZSB3ZWVrIHRoYXQgY29udGFpbnMgdGhlIGZpcnN0CiAgICAvLyAgICAgICAgICAgICAgICAgICAgICBvZiB0aGlzIGRheSBvZiB0aGUgd2VlawogICAgLy8gICAgICAgICAgICAgICAgICAgICAgKGVnLiBJU08gd2Vla3MgdXNlIHRodXJzZGF5ICg0KSkKICAgIGZ1bmN0aW9uIHdlZWtPZlllYXIobW9tLCBmaXJzdERheU9mV2VlaywgZmlyc3REYXlPZldlZWtPZlllYXIpIHsKICAgICAgICB2YXIgZW5kID0gZmlyc3REYXlPZldlZWtPZlllYXIgLSBmaXJzdERheU9mV2VlaywKICAgICAgICAgICAgZGF5c1RvRGF5T2ZXZWVrID0gZmlyc3REYXlPZldlZWtPZlllYXIgLSBtb20uZGF5KCksCiAgICAgICAgICAgIGFkanVzdGVkTW9tZW50OwoKCiAgICAgICAgaWYgKGRheXNUb0RheU9mV2VlayA+IGVuZCkgewogICAgICAgICAgICBkYXlzVG9EYXlPZldlZWsgLT0gNzsKICAgICAgICB9CgogICAgICAgIGlmIChkYXlzVG9EYXlPZldlZWsgPCBlbmQgLSA3KSB7CiAgICAgICAgICAgIGRheXNUb0RheU9mV2VlayArPSA3OwogICAgICAgIH0KCiAgICAgICAgYWRqdXN0ZWRNb21lbnQgPSBtb21lbnQobW9tKS5hZGQoJ2QnLCBkYXlzVG9EYXlPZldlZWspOwogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHdlZWs6IE1hdGguY2VpbChhZGp1c3RlZE1vbWVudC5kYXlPZlllYXIoKSAvIDcpLAogICAgICAgICAgICB5ZWFyOiBhZGp1c3RlZE1vbWVudC55ZWFyKCkKICAgICAgICB9OwogICAgfQoKICAgIC8vaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9JU09fd2Vla19kYXRlI0NhbGN1bGF0aW5nX2FfZGF0ZV9naXZlbl90aGVfeWVhci4yQ193ZWVrX251bWJlcl9hbmRfd2Vla2RheQogICAgZnVuY3Rpb24gZGF5T2ZZZWFyRnJvbVdlZWtzKHllYXIsIHdlZWssIHdlZWtkYXksIGZpcnN0RGF5T2ZXZWVrT2ZZZWFyLCBmaXJzdERheU9mV2VlaykgewogICAgICAgIHZhciBkID0gbWFrZVVUQ0RhdGUoeWVhciwgMCwgMSkuZ2V0VVRDRGF5KCksIGRheXNUb0FkZCwgZGF5T2ZZZWFyOwoKICAgICAgICB3ZWVrZGF5ID0gd2Vla2RheSAhPSBudWxsID8gd2Vla2RheSA6IGZpcnN0RGF5T2ZXZWVrOwogICAgICAgIGRheXNUb0FkZCA9IGZpcnN0RGF5T2ZXZWVrIC0gZCArIChkID4gZmlyc3REYXlPZldlZWtPZlllYXIgPyA3IDogMCkgLSAoZCA8IGZpcnN0RGF5T2ZXZWVrID8gNyA6IDApOwogICAgICAgIGRheU9mWWVhciA9IDcgKiAod2VlayAtIDEpICsgKHdlZWtkYXkgLSBmaXJzdERheU9mV2VlaykgKyBkYXlzVG9BZGQgKyAxOwoKICAgICAgICByZXR1cm4gewogICAgICAgICAgICB5ZWFyOiBkYXlPZlllYXIgPiAwID8geWVhciA6IHllYXIgLSAxLAogICAgICAgICAgICBkYXlPZlllYXI6IGRheU9mWWVhciA+IDAgPyAgZGF5T2ZZZWFyIDogZGF5c0luWWVhcih5ZWFyIC0gMSkgKyBkYXlPZlllYXIKICAgICAgICB9OwogICAgfQoKICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAgICAgICBUb3AgTGV2ZWwgRnVuY3Rpb25zCiAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCgogICAgZnVuY3Rpb24gbWFrZU1vbWVudChjb25maWcpIHsKICAgICAgICB2YXIgaW5wdXQgPSBjb25maWcuX2ksCiAgICAgICAgICAgIGZvcm1hdCA9IGNvbmZpZy5fZjsKCiAgICAgICAgaWYgKGlucHV0ID09PSBudWxsIHx8IChmb3JtYXQgPT09IHVuZGVmaW5lZCAmJiBpbnB1dCA9PT0gJycpKSB7CiAgICAgICAgICAgIHJldHVybiBtb21lbnQuaW52YWxpZCh7bnVsbElucHV0OiB0cnVlfSk7CiAgICAgICAgfQoKICAgICAgICBpZiAodHlwZW9mIGlucHV0ID09PSAnc3RyaW5nJykgewogICAgICAgICAgICBjb25maWcuX2kgPSBpbnB1dCA9IGdldExhbmdEZWZpbml0aW9uKCkucHJlcGFyc2UoaW5wdXQpOwogICAgICAgIH0KCiAgICAgICAgaWYgKG1vbWVudC5pc01vbWVudChpbnB1dCkpIHsKICAgICAgICAgICAgY29uZmlnID0gY2xvbmVNb21lbnQoaW5wdXQpOwoKICAgICAgICAgICAgY29uZmlnLl9kID0gbmV3IERhdGUoK2lucHV0Ll9kKTsKICAgICAgICB9IGVsc2UgaWYgKGZvcm1hdCkgewogICAgICAgICAgICBpZiAoaXNBcnJheShmb3JtYXQpKSB7CiAgICAgICAgICAgICAgICBtYWtlRGF0ZUZyb21TdHJpbmdBbmRBcnJheShjb25maWcpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbWFrZURhdGVGcm9tU3RyaW5nQW5kRm9ybWF0KGNvbmZpZyk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBtYWtlRGF0ZUZyb21JbnB1dChjb25maWcpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG5ldyBNb21lbnQoY29uZmlnKTsKICAgIH0KCiAgICBtb21lbnQgPSBmdW5jdGlvbiAoaW5wdXQsIGZvcm1hdCwgbGFuZywgc3RyaWN0KSB7CiAgICAgICAgdmFyIGM7CgogICAgICAgIGlmICh0eXBlb2YobGFuZykgPT09ICJib29sZWFuIikgewogICAgICAgICAgICBzdHJpY3QgPSBsYW5nOwogICAgICAgICAgICBsYW5nID0gdW5kZWZpbmVkOwogICAgICAgIH0KICAgICAgICAvLyBvYmplY3QgY29uc3RydWN0aW9uIG11c3QgYmUgZG9uZSB0aGlzIHdheS4KICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vbW9tZW50L21vbWVudC9pc3N1ZXMvMTQyMwogICAgICAgIGMgPSB7fTsKICAgICAgICBjLl9pc0FNb21lbnRPYmplY3QgPSB0cnVlOwogICAgICAgIGMuX2kgPSBpbnB1dDsKICAgICAgICBjLl9mID0gZm9ybWF0OwogICAgICAgIGMuX2wgPSBsYW5nOwogICAgICAgIGMuX3N0cmljdCA9IHN0cmljdDsKICAgICAgICBjLl9pc1VUQyA9IGZhbHNlOwogICAgICAgIGMuX3BmID0gZGVmYXVsdFBhcnNpbmdGbGFncygpOwoKICAgICAgICByZXR1cm4gbWFrZU1vbWVudChjKTsKICAgIH07CgogICAgbW9tZW50LnN1cHByZXNzRGVwcmVjYXRpb25XYXJuaW5ncyA9IGZhbHNlOwoKICAgIG1vbWVudC5jcmVhdGVGcm9tSW5wdXRGYWxsYmFjayA9IGRlcHJlY2F0ZSgKICAgICAgICAgICAgIm1vbWVudCBjb25zdHJ1Y3Rpb24gZmFsbHMgYmFjayB0byBqcyBEYXRlLiBUaGlzIGlzICIgKwogICAgICAgICAgICAiZGlzY291cmFnZWQgYW5kIHdpbGwgYmUgcmVtb3ZlZCBpbiB1cGNvbWluZyBtYWpvciAiICsKICAgICAgICAgICAgInJlbGVhc2UuIFBsZWFzZSByZWZlciB0byAiICsKICAgICAgICAgICAgImh0dHBzOi8vZ2l0aHViLmNvbS9tb21lbnQvbW9tZW50L2lzc3Vlcy8xNDA3IGZvciBtb3JlIGluZm8uIiwKICAgICAgICAgICAgZnVuY3Rpb24gKGNvbmZpZykgewogICAgICAgIGNvbmZpZy5fZCA9IG5ldyBEYXRlKGNvbmZpZy5faSk7CiAgICB9KTsKCiAgICAvLyBjcmVhdGluZyB3aXRoIHV0YwogICAgbW9tZW50LnV0YyA9IGZ1bmN0aW9uIChpbnB1dCwgZm9ybWF0LCBsYW5nLCBzdHJpY3QpIHsKICAgICAgICB2YXIgYzsKCiAgICAgICAgaWYgKHR5cGVvZihsYW5nKSA9PT0gImJvb2xlYW4iKSB7CiAgICAgICAgICAgIHN0cmljdCA9IGxhbmc7CiAgICAgICAgICAgIGxhbmcgPSB1bmRlZmluZWQ7CiAgICAgICAgfQogICAgICAgIC8vIG9iamVjdCBjb25zdHJ1Y3Rpb24gbXVzdCBiZSBkb25lIHRoaXMgd2F5LgogICAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9tb21lbnQvbW9tZW50L2lzc3Vlcy8xNDIzCiAgICAgICAgYyA9IHt9OwogICAgICAgIGMuX2lzQU1vbWVudE9iamVjdCA9IHRydWU7CiAgICAgICAgYy5fdXNlVVRDID0gdHJ1ZTsKICAgICAgICBjLl9pc1VUQyA9IHRydWU7CiAgICAgICAgYy5fbCA9IGxhbmc7CiAgICAgICAgYy5faSA9IGlucHV0OwogICAgICAgIGMuX2YgPSBmb3JtYXQ7CiAgICAgICAgYy5fc3RyaWN0ID0gc3RyaWN0OwogICAgICAgIGMuX3BmID0gZGVmYXVsdFBhcnNpbmdGbGFncygpOwoKICAgICAgICByZXR1cm4gbWFrZU1vbWVudChjKS51dGMoKTsKICAgIH07CgogICAgLy8gY3JlYXRpbmcgd2l0aCB1bml4IHRpbWVzdGFtcCAoaW4gc2Vjb25kcykKICAgIG1vbWVudC51bml4ID0gZnVuY3Rpb24gKGlucHV0KSB7CiAgICAgICAgcmV0dXJuIG1vbWVudChpbnB1dCAqIDEwMDApOwogICAgfTsKCiAgICAvLyBkdXJhdGlvbgogICAgbW9tZW50LmR1cmF0aW9uID0gZnVuY3Rpb24gKGlucHV0LCBrZXkpIHsKICAgICAgICB2YXIgZHVyYXRpb24gPSBpbnB1dCwKICAgICAgICAgICAgLy8gbWF0Y2hpbmcgYWdhaW5zdCByZWdleHAgaXMgZXhwZW5zaXZlLCBkbyBpdCBvbiBkZW1hbmQKICAgICAgICAgICAgbWF0Y2ggPSBudWxsLAogICAgICAgICAgICBzaWduLAogICAgICAgICAgICByZXQsCiAgICAgICAgICAgIHBhcnNlSXNvOwoKICAgICAgICBpZiAobW9tZW50LmlzRHVyYXRpb24oaW5wdXQpKSB7CiAgICAgICAgICAgIGR1cmF0aW9uID0gewogICAgICAgICAgICAgICAgbXM6IGlucHV0Ll9taWxsaXNlY29uZHMsCiAgICAgICAgICAgICAgICBkOiBpbnB1dC5fZGF5cywKICAgICAgICAgICAgICAgIE06IGlucHV0Ll9tb250aHMKICAgICAgICAgICAgfTsKICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBpbnB1dCA9PT0gJ251bWJlcicpIHsKICAgICAgICAgICAgZHVyYXRpb24gPSB7fTsKICAgICAgICAgICAgaWYgKGtleSkgewogICAgICAgICAgICAgICAgZHVyYXRpb25ba2V5XSA9IGlucHV0OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZHVyYXRpb24ubWlsbGlzZWNvbmRzID0gaW5wdXQ7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKCEhKG1hdGNoID0gYXNwTmV0VGltZVNwYW5Kc29uUmVnZXguZXhlYyhpbnB1dCkpKSB7CiAgICAgICAgICAgIHNpZ24gPSAobWF0Y2hbMV0gPT09ICItIikgPyAtMSA6IDE7CiAgICAgICAgICAgIGR1cmF0aW9uID0gewogICAgICAgICAgICAgICAgeTogMCwKICAgICAgICAgICAgICAgIGQ6IHRvSW50KG1hdGNoW0RBVEVdKSAqIHNpZ24sCiAgICAgICAgICAgICAgICBoOiB0b0ludChtYXRjaFtIT1VSXSkgKiBzaWduLAogICAgICAgICAgICAgICAgbTogdG9JbnQobWF0Y2hbTUlOVVRFXSkgKiBzaWduLAogICAgICAgICAgICAgICAgczogdG9JbnQobWF0Y2hbU0VDT05EXSkgKiBzaWduLAogICAgICAgICAgICAgICAgbXM6IHRvSW50KG1hdGNoW01JTExJU0VDT05EXSkgKiBzaWduCiAgICAgICAgICAgIH07CiAgICAgICAgfSBlbHNlIGlmICghIShtYXRjaCA9IGlzb0R1cmF0aW9uUmVnZXguZXhlYyhpbnB1dCkpKSB7CiAgICAgICAgICAgIHNpZ24gPSAobWF0Y2hbMV0gPT09ICItIikgPyAtMSA6IDE7CiAgICAgICAgICAgIHBhcnNlSXNvID0gZnVuY3Rpb24gKGlucCkgewogICAgICAgICAgICAgICAgLy8gV2UnZCBub3JtYWxseSB1c2Ugfn5pbnAgZm9yIHRoaXMsIGJ1dCB1bmZvcnR1bmF0ZWx5IGl0IGFsc28KICAgICAgICAgICAgICAgIC8vIGNvbnZlcnRzIGZsb2F0cyB0byBpbnRzLgogICAgICAgICAgICAgICAgLy8gaW5wIG1heSBiZSB1bmRlZmluZWQsIHNvIGNhcmVmdWwgY2FsbGluZyByZXBsYWNlIG9uIGl0LgogICAgICAgICAgICAgICAgdmFyIHJlcyA9IGlucCAmJiBwYXJzZUZsb2F0KGlucC5yZXBsYWNlKCcsJywgJy4nKSk7CiAgICAgICAgICAgICAgICAvLyBhcHBseSBzaWduIHdoaWxlIHdlJ3JlIGF0IGl0CiAgICAgICAgICAgICAgICByZXR1cm4gKGlzTmFOKHJlcykgPyAwIDogcmVzKSAqIHNpZ247CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGR1cmF0aW9uID0gewogICAgICAgICAgICAgICAgeTogcGFyc2VJc28obWF0Y2hbMl0pLAogICAgICAgICAgICAgICAgTTogcGFyc2VJc28obWF0Y2hbM10pLAogICAgICAgICAgICAgICAgZDogcGFyc2VJc28obWF0Y2hbNF0pLAogICAgICAgICAgICAgICAgaDogcGFyc2VJc28obWF0Y2hbNV0pLAogICAgICAgICAgICAgICAgbTogcGFyc2VJc28obWF0Y2hbNl0pLAogICAgICAgICAgICAgICAgczogcGFyc2VJc28obWF0Y2hbN10pLAogICAgICAgICAgICAgICAgdzogcGFyc2VJc28obWF0Y2hbOF0pCiAgICAgICAgICAgIH07CiAgICAgICAgfQoKICAgICAgICByZXQgPSBuZXcgRHVyYXRpb24oZHVyYXRpb24pOwoKICAgICAgICBpZiAobW9tZW50LmlzRHVyYXRpb24oaW5wdXQpICYmIGlucHV0Lmhhc093blByb3BlcnR5KCdfbGFuZycpKSB7CiAgICAgICAgICAgIHJldC5fbGFuZyA9IGlucHV0Ll9sYW5nOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHJldDsKICAgIH07CgogICAgLy8gdmVyc2lvbiBudW1iZXIKICAgIG1vbWVudC52ZXJzaW9uID0gVkVSU0lPTjsKCiAgICAvLyBkZWZhdWx0IGZvcm1hdAogICAgbW9tZW50LmRlZmF1bHRGb3JtYXQgPSBpc29Gb3JtYXQ7CgogICAgLy8gUGx1Z2lucyB0aGF0IGFkZCBwcm9wZXJ0aWVzIHNob3VsZCBhbHNvIGFkZCB0aGUga2V5IGhlcmUgKG51bGwgdmFsdWUpLAogICAgLy8gc28gd2UgY2FuIHByb3Blcmx5IGNsb25lIG91cnNlbHZlcy4KICAgIG1vbWVudC5tb21lbnRQcm9wZXJ0aWVzID0gbW9tZW50UHJvcGVydGllczsKCiAgICAvLyBUaGlzIGZ1bmN0aW9uIHdpbGwgYmUgY2FsbGVkIHdoZW5ldmVyIGEgbW9tZW50IGlzIG11dGF0ZWQuCiAgICAvLyBJdCBpcyBpbnRlbmRlZCB0byBrZWVwIHRoZSBvZmZzZXQgaW4gc3luYyB3aXRoIHRoZSB0aW1lem9uZS4KICAgIG1vbWVudC51cGRhdGVPZmZzZXQgPSBmdW5jdGlvbiAoKSB7fTsKCiAgICAvLyBUaGlzIGZ1bmN0aW9uIHdpbGwgbG9hZCBsYW5ndWFnZXMgYW5kIHRoZW4gc2V0IHRoZSBnbG9iYWwgbGFuZ3VhZ2UuICBJZgogICAgLy8gbm8gYXJndW1lbnRzIGFyZSBwYXNzZWQgaW4sIGl0IHdpbGwgc2ltcGx5IHJldHVybiB0aGUgY3VycmVudCBnbG9iYWwKICAgIC8vIGxhbmd1YWdlIGtleS4KICAgIG1vbWVudC5sYW5nID0gZnVuY3Rpb24gKGtleSwgdmFsdWVzKSB7CiAgICAgICAgdmFyIHI7CiAgICAgICAgaWYgKCFrZXkpIHsKICAgICAgICAgICAgcmV0dXJuIG1vbWVudC5mbi5fbGFuZy5fYWJicjsKICAgICAgICB9CiAgICAgICAgaWYgKHZhbHVlcykgewogICAgICAgICAgICBsb2FkTGFuZyhub3JtYWxpemVMYW5ndWFnZShrZXkpLCB2YWx1ZXMpOwogICAgICAgIH0gZWxzZSBpZiAodmFsdWVzID09PSBudWxsKSB7CiAgICAgICAgICAgIHVubG9hZExhbmcoa2V5KTsKICAgICAgICAgICAga2V5ID0gJ2VuJzsKICAgICAgICB9IGVsc2UgaWYgKCFsYW5ndWFnZXNba2V5XSkgewogICAgICAgICAgICBnZXRMYW5nRGVmaW5pdGlvbihrZXkpOwogICAgICAgIH0KICAgICAgICByID0gbW9tZW50LmR1cmF0aW9uLmZuLl9sYW5nID0gbW9tZW50LmZuLl9sYW5nID0gZ2V0TGFuZ0RlZmluaXRpb24oa2V5KTsKICAgICAgICByZXR1cm4gci5fYWJicjsKICAgIH07CgogICAgLy8gcmV0dXJucyBsYW5ndWFnZSBkYXRhCiAgICBtb21lbnQubGFuZ0RhdGEgPSBmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgaWYgKGtleSAmJiBrZXkuX2xhbmcgJiYga2V5Ll9sYW5nLl9hYmJyKSB7CiAgICAgICAgICAgIGtleSA9IGtleS5fbGFuZy5fYWJicjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGdldExhbmdEZWZpbml0aW9uKGtleSk7CiAgICB9OwoKICAgIC8vIGNvbXBhcmUgbW9tZW50IG9iamVjdAogICAgbW9tZW50LmlzTW9tZW50ID0gZnVuY3Rpb24gKG9iaikgewogICAgICAgIHJldHVybiBvYmogaW5zdGFuY2VvZiBNb21lbnQgfHwKICAgICAgICAgICAgKG9iaiAhPSBudWxsICYmICBvYmouaGFzT3duUHJvcGVydHkoJ19pc0FNb21lbnRPYmplY3QnKSk7CiAgICB9OwoKICAgIC8vIGZvciB0eXBlY2hlY2tpbmcgRHVyYXRpb24gb2JqZWN0cwogICAgbW9tZW50LmlzRHVyYXRpb24gPSBmdW5jdGlvbiAob2JqKSB7CiAgICAgICAgcmV0dXJuIG9iaiBpbnN0YW5jZW9mIER1cmF0aW9uOwogICAgfTsKCiAgICBmb3IgKGkgPSBsaXN0cy5sZW5ndGggLSAxOyBpID49IDA7IC0taSkgewogICAgICAgIG1ha2VMaXN0KGxpc3RzW2ldKTsKICAgIH0KCiAgICBtb21lbnQubm9ybWFsaXplVW5pdHMgPSBmdW5jdGlvbiAodW5pdHMpIHsKICAgICAgICByZXR1cm4gbm9ybWFsaXplVW5pdHModW5pdHMpOwogICAgfTsKCiAgICBtb21lbnQuaW52YWxpZCA9IGZ1bmN0aW9uIChmbGFncykgewogICAgICAgIHZhciBtID0gbW9tZW50LnV0YyhOYU4pOwogICAgICAgIGlmIChmbGFncyAhPSBudWxsKSB7CiAgICAgICAgICAgIGV4dGVuZChtLl9wZiwgZmxhZ3MpOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgbS5fcGYudXNlckludmFsaWRhdGVkID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBtOwogICAgfTsKCiAgICBtb21lbnQucGFyc2Vab25lID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBtb21lbnQuYXBwbHkobnVsbCwgYXJndW1lbnRzKS5wYXJzZVpvbmUoKTsKICAgIH07CgogICAgbW9tZW50LnBhcnNlVHdvRGlnaXRZZWFyID0gZnVuY3Rpb24gKGlucHV0KSB7CiAgICAgICAgcmV0dXJuIHRvSW50KGlucHV0KSArICh0b0ludChpbnB1dCkgPiA2OCA/IDE5MDAgOiAyMDAwKTsKICAgIH07CgogICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgICAgIE1vbWVudCBQcm90b3R5cGUKICAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCgogICAgZXh0ZW5kKG1vbWVudC5mbiA9IE1vbWVudC5wcm90b3R5cGUsIHsKCiAgICAgICAgY2xvbmUgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBtb21lbnQodGhpcyk7CiAgICAgICAgfSwKCiAgICAgICAgdmFsdWVPZiA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuICt0aGlzLl9kICsgKCh0aGlzLl9vZmZzZXQgfHwgMCkgKiA2MDAwMCk7CiAgICAgICAgfSwKCiAgICAgICAgdW5peCA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IoK3RoaXMgLyAxMDAwKTsKICAgICAgICB9LAoKICAgICAgICB0b1N0cmluZyA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoKS5sYW5nKCdlbicpLmZvcm1hdCgiZGRkIE1NTSBERCBZWVlZIEhIOm1tOnNzIFtHTVRdWloiKTsKICAgICAgICB9LAoKICAgICAgICB0b0RhdGUgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9vZmZzZXQgPyBuZXcgRGF0ZSgrdGhpcykgOiB0aGlzLl9kOwogICAgICAgIH0sCgogICAgICAgIHRvSVNPU3RyaW5nIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgbSA9IG1vbWVudCh0aGlzKS51dGMoKTsKICAgICAgICAgICAgaWYgKDAgPCBtLnllYXIoKSAmJiBtLnllYXIoKSA8PSA5OTk5KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZm9ybWF0TW9tZW50KG0sICdZWVlZLU1NLUREW1RdSEg6bW06c3MuU1NTW1pdJyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZm9ybWF0TW9tZW50KG0sICdZWVlZWVktTU0tRERbVF1ISDptbTpzcy5TU1NbWl0nKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCgogICAgICAgIHRvQXJyYXkgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBtID0gdGhpczsKICAgICAgICAgICAgcmV0dXJuIFsKICAgICAgICAgICAgICAgIG0ueWVhcigpLAogICAgICAgICAgICAgICAgbS5tb250aCgpLAogICAgICAgICAgICAgICAgbS5kYXRlKCksCiAgICAgICAgICAgICAgICBtLmhvdXJzKCksCiAgICAgICAgICAgICAgICBtLm1pbnV0ZXMoKSwKICAgICAgICAgICAgICAgIG0uc2Vjb25kcygpLAogICAgICAgICAgICAgICAgbS5taWxsaXNlY29uZHMoKQogICAgICAgICAgICBdOwogICAgICAgIH0sCgogICAgICAgIGlzVmFsaWQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBpc1ZhbGlkKHRoaXMpOwogICAgICAgIH0sCgogICAgICAgIGlzRFNUU2hpZnRlZCA6IGZ1bmN0aW9uICgpIHsKCiAgICAgICAgICAgIGlmICh0aGlzLl9hKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5pc1ZhbGlkKCkgJiYgY29tcGFyZUFycmF5cyh0aGlzLl9hLCAodGhpcy5faXNVVEMgPyBtb21lbnQudXRjKHRoaXMuX2EpIDogbW9tZW50KHRoaXMuX2EpKS50b0FycmF5KCkpID4gMDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0sCgogICAgICAgIHBhcnNpbmdGbGFncyA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGV4dGVuZCh7fSwgdGhpcy5fcGYpOwogICAgICAgIH0sCgogICAgICAgIGludmFsaWRBdDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fcGYub3ZlcmZsb3c7CiAgICAgICAgfSwKCiAgICAgICAgdXRjIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy56b25lKDApOwogICAgICAgIH0sCgogICAgICAgIGxvY2FsIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB0aGlzLnpvbmUoMCk7CiAgICAgICAgICAgIHRoaXMuX2lzVVRDID0gZmFsc2U7CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0sCgogICAgICAgIGZvcm1hdCA6IGZ1bmN0aW9uIChpbnB1dFN0cmluZykgewogICAgICAgICAgICB2YXIgb3V0cHV0ID0gZm9ybWF0TW9tZW50KHRoaXMsIGlucHV0U3RyaW5nIHx8IG1vbWVudC5kZWZhdWx0Rm9ybWF0KTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMubGFuZygpLnBvc3Rmb3JtYXQob3V0cHV0KTsKICAgICAgICB9LAoKICAgICAgICBhZGQgOiBmdW5jdGlvbiAoaW5wdXQsIHZhbCkgewogICAgICAgICAgICB2YXIgZHVyOwogICAgICAgICAgICAvLyBzd2l0Y2ggYXJncyB0byBzdXBwb3J0IGFkZCgncycsIDEpIGFuZCBhZGQoMSwgJ3MnKQogICAgICAgICAgICBpZiAodHlwZW9mIGlucHV0ID09PSAnc3RyaW5nJykgewogICAgICAgICAgICAgICAgZHVyID0gbW9tZW50LmR1cmF0aW9uKCt2YWwsIGlucHV0KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGR1ciA9IG1vbWVudC5kdXJhdGlvbihpbnB1dCwgdmFsKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBhZGRPclN1YnRyYWN0RHVyYXRpb25Gcm9tTW9tZW50KHRoaXMsIGR1ciwgMSk7CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0sCgogICAgICAgIHN1YnRyYWN0IDogZnVuY3Rpb24gKGlucHV0LCB2YWwpIHsKICAgICAgICAgICAgdmFyIGR1cjsKICAgICAgICAgICAgLy8gc3dpdGNoIGFyZ3MgdG8gc3VwcG9ydCBzdWJ0cmFjdCgncycsIDEpIGFuZCBzdWJ0cmFjdCgxLCAncycpCiAgICAgICAgICAgIGlmICh0eXBlb2YgaW5wdXQgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgICAgICBkdXIgPSBtb21lbnQuZHVyYXRpb24oK3ZhbCwgaW5wdXQpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZHVyID0gbW9tZW50LmR1cmF0aW9uKGlucHV0LCB2YWwpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGFkZE9yU3VidHJhY3REdXJhdGlvbkZyb21Nb21lbnQodGhpcywgZHVyLCAtMSk7CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0sCgogICAgICAgIGRpZmYgOiBmdW5jdGlvbiAoaW5wdXQsIHVuaXRzLCBhc0Zsb2F0KSB7CiAgICAgICAgICAgIHZhciB0aGF0ID0gbWFrZUFzKGlucHV0LCB0aGlzKSwKICAgICAgICAgICAgICAgIHpvbmVEaWZmID0gKHRoaXMuem9uZSgpIC0gdGhhdC56b25lKCkpICogNmU0LAogICAgICAgICAgICAgICAgZGlmZiwgb3V0cHV0OwoKICAgICAgICAgICAgdW5pdHMgPSBub3JtYWxpemVVbml0cyh1bml0cyk7CgogICAgICAgICAgICBpZiAodW5pdHMgPT09ICd5ZWFyJyB8fCB1bml0cyA9PT0gJ21vbnRoJykgewogICAgICAgICAgICAgICAgLy8gYXZlcmFnZSBudW1iZXIgb2YgZGF5cyBpbiB0aGUgbW9udGhzIGluIHRoZSBnaXZlbiBkYXRlcwogICAgICAgICAgICAgICAgZGlmZiA9ICh0aGlzLmRheXNJbk1vbnRoKCkgKyB0aGF0LmRheXNJbk1vbnRoKCkpICogNDMyZTU7IC8vIDI0ICogNjAgKiA2MCAqIDEwMDAgLyAyCiAgICAgICAgICAgICAgICAvLyBkaWZmZXJlbmNlIGluIG1vbnRocwogICAgICAgICAgICAgICAgb3V0cHV0ID0gKCh0aGlzLnllYXIoKSAtIHRoYXQueWVhcigpKSAqIDEyKSArICh0aGlzLm1vbnRoKCkgLSB0aGF0Lm1vbnRoKCkpOwogICAgICAgICAgICAgICAgLy8gYWRqdXN0IGJ5IHRha2luZyBkaWZmZXJlbmNlIGluIGRheXMsIGF2ZXJhZ2UgbnVtYmVyIG9mIGRheXMKICAgICAgICAgICAgICAgIC8vIGFuZCBkc3QgaW4gdGhlIGdpdmVuIG1vbnRocy4KICAgICAgICAgICAgICAgIG91dHB1dCArPSAoKHRoaXMgLSBtb21lbnQodGhpcykuc3RhcnRPZignbW9udGgnKSkgLQogICAgICAgICAgICAgICAgICAgICAgICAodGhhdCAtIG1vbWVudCh0aGF0KS5zdGFydE9mKCdtb250aCcpKSkgLyBkaWZmOwogICAgICAgICAgICAgICAgLy8gc2FtZSBhcyBhYm92ZSBidXQgd2l0aCB6b25lcywgdG8gbmVnYXRlIGFsbCBkc3QKICAgICAgICAgICAgICAgIG91dHB1dCAtPSAoKHRoaXMuem9uZSgpIC0gbW9tZW50KHRoaXMpLnN0YXJ0T2YoJ21vbnRoJykuem9uZSgpKSAtCiAgICAgICAgICAgICAgICAgICAgICAgICh0aGF0LnpvbmUoKSAtIG1vbWVudCh0aGF0KS5zdGFydE9mKCdtb250aCcpLnpvbmUoKSkpICogNmU0IC8gZGlmZjsKICAgICAgICAgICAgICAgIGlmICh1bml0cyA9PT0gJ3llYXInKSB7CiAgICAgICAgICAgICAgICAgICAgb3V0cHV0ID0gb3V0cHV0IC8gMTI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBkaWZmID0gKHRoaXMgLSB0aGF0KTsKICAgICAgICAgICAgICAgIG91dHB1dCA9IHVuaXRzID09PSAnc2Vjb25kJyA/IGRpZmYgLyAxZTMgOiAvLyAxMDAwCiAgICAgICAgICAgICAgICAgICAgdW5pdHMgPT09ICdtaW51dGUnID8gZGlmZiAvIDZlNCA6IC8vIDEwMDAgKiA2MAogICAgICAgICAgICAgICAgICAgIHVuaXRzID09PSAnaG91cicgPyBkaWZmIC8gMzZlNSA6IC8vIDEwMDAgKiA2MCAqIDYwCiAgICAgICAgICAgICAgICAgICAgdW5pdHMgPT09ICdkYXknID8gKGRpZmYgLSB6b25lRGlmZikgLyA4NjRlNSA6IC8vIDEwMDAgKiA2MCAqIDYwICogMjQsIG5lZ2F0ZSBkc3QKICAgICAgICAgICAgICAgICAgICB1bml0cyA9PT0gJ3dlZWsnID8gKGRpZmYgLSB6b25lRGlmZikgLyA2MDQ4ZTUgOiAvLyAxMDAwICogNjAgKiA2MCAqIDI0ICogNywgbmVnYXRlIGRzdAogICAgICAgICAgICAgICAgICAgIGRpZmY7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGFzRmxvYXQgPyBvdXRwdXQgOiBhYnNSb3VuZChvdXRwdXQpOwogICAgICAgIH0sCgogICAgICAgIGZyb20gOiBmdW5jdGlvbiAodGltZSwgd2l0aG91dFN1ZmZpeCkgewogICAgICAgICAgICByZXR1cm4gbW9tZW50LmR1cmF0aW9uKHRoaXMuZGlmZih0aW1lKSkubGFuZyh0aGlzLmxhbmcoKS5fYWJicikuaHVtYW5pemUoIXdpdGhvdXRTdWZmaXgpOwogICAgICAgIH0sCgogICAgICAgIGZyb21Ob3cgOiBmdW5jdGlvbiAod2l0aG91dFN1ZmZpeCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5mcm9tKG1vbWVudCgpLCB3aXRob3V0U3VmZml4KTsKICAgICAgICB9LAoKICAgICAgICBjYWxlbmRhciA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgLy8gV2Ugd2FudCB0byBjb21wYXJlIHRoZSBzdGFydCBvZiB0b2RheSwgdnMgdGhpcy4KICAgICAgICAgICAgLy8gR2V0dGluZyBzdGFydC1vZi10b2RheSBkZXBlbmRzIG9uIHdoZXRoZXIgd2UncmUgem9uZSdkIG9yIG5vdC4KICAgICAgICAgICAgdmFyIHNvZCA9IG1ha2VBcyhtb21lbnQoKSwgdGhpcykuc3RhcnRPZignZGF5JyksCiAgICAgICAgICAgICAgICBkaWZmID0gdGhpcy5kaWZmKHNvZCwgJ2RheXMnLCB0cnVlKSwKICAgICAgICAgICAgICAgIGZvcm1hdCA9IGRpZmYgPCAtNiA/ICdzYW1lRWxzZScgOgogICAgICAgICAgICAgICAgICAgIGRpZmYgPCAtMSA/ICdsYXN0V2VlaycgOgogICAgICAgICAgICAgICAgICAgIGRpZmYgPCAwID8gJ2xhc3REYXknIDoKICAgICAgICAgICAgICAgICAgICBkaWZmIDwgMSA/ICdzYW1lRGF5JyA6CiAgICAgICAgICAgICAgICAgICAgZGlmZiA8IDIgPyAnbmV4dERheScgOgogICAgICAgICAgICAgICAgICAgIGRpZmYgPCA3ID8gJ25leHRXZWVrJyA6ICdzYW1lRWxzZSc7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmZvcm1hdCh0aGlzLmxhbmcoKS5jYWxlbmRhcihmb3JtYXQsIHRoaXMpKTsKICAgICAgICB9LAoKICAgICAgICBpc0xlYXBZZWFyIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gaXNMZWFwWWVhcih0aGlzLnllYXIoKSk7CiAgICAgICAgfSwKCiAgICAgICAgaXNEU1QgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiAodGhpcy56b25lKCkgPCB0aGlzLmNsb25lKCkubW9udGgoMCkuem9uZSgpIHx8CiAgICAgICAgICAgICAgICB0aGlzLnpvbmUoKSA8IHRoaXMuY2xvbmUoKS5tb250aCg1KS56b25lKCkpOwogICAgICAgIH0sCgogICAgICAgIGRheSA6IGZ1bmN0aW9uIChpbnB1dCkgewogICAgICAgICAgICB2YXIgZGF5ID0gdGhpcy5faXNVVEMgPyB0aGlzLl9kLmdldFVUQ0RheSgpIDogdGhpcy5fZC5nZXREYXkoKTsKICAgICAgICAgICAgaWYgKGlucHV0ICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGlucHV0ID0gcGFyc2VXZWVrZGF5KGlucHV0LCB0aGlzLmxhbmcoKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5hZGQoeyBkIDogaW5wdXQgLSBkYXkgfSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZGF5OwogICAgICAgICAgICB9CiAgICAgICAgfSwKCiAgICAgICAgbW9udGggOiBtYWtlQWNjZXNzb3IoJ01vbnRoJywgdHJ1ZSksCgogICAgICAgIHN0YXJ0T2Y6IGZ1bmN0aW9uICh1bml0cykgewogICAgICAgICAgICB1bml0cyA9IG5vcm1hbGl6ZVVuaXRzKHVuaXRzKTsKICAgICAgICAgICAgLy8gdGhlIGZvbGxvd2luZyBzd2l0Y2ggaW50ZW50aW9uYWxseSBvbWl0cyBicmVhayBrZXl3b3JkcwogICAgICAgICAgICAvLyB0byB1dGlsaXplIGZhbGxpbmcgdGhyb3VnaCB0aGUgY2FzZXMuCiAgICAgICAgICAgIHN3aXRjaCAodW5pdHMpIHsKICAgICAgICAgICAgY2FzZSAneWVhcic6CiAgICAgICAgICAgICAgICB0aGlzLm1vbnRoKDApOwogICAgICAgICAgICAgICAgLyogZmFsbHMgdGhyb3VnaCAqLwogICAgICAgICAgICBjYXNlICdxdWFydGVyJzoKICAgICAgICAgICAgY2FzZSAnbW9udGgnOgogICAgICAgICAgICAgICAgdGhpcy5kYXRlKDEpOwogICAgICAgICAgICAgICAgLyogZmFsbHMgdGhyb3VnaCAqLwogICAgICAgICAgICBjYXNlICd3ZWVrJzoKICAgICAgICAgICAgY2FzZSAnaXNvV2Vlayc6CiAgICAgICAgICAgIGNhc2UgJ2RheSc6CiAgICAgICAgICAgICAgICB0aGlzLmhvdXJzKDApOwogICAgICAgICAgICAgICAgLyogZmFsbHMgdGhyb3VnaCAqLwogICAgICAgICAgICBjYXNlICdob3VyJzoKICAgICAgICAgICAgICAgIHRoaXMubWludXRlcygwKTsKICAgICAgICAgICAgICAgIC8qIGZhbGxzIHRocm91Z2ggKi8KICAgICAgICAgICAgY2FzZSAnbWludXRlJzoKICAgICAgICAgICAgICAgIHRoaXMuc2Vjb25kcygwKTsKICAgICAgICAgICAgICAgIC8qIGZhbGxzIHRocm91Z2ggKi8KICAgICAgICAgICAgY2FzZSAnc2Vjb25kJzoKICAgICAgICAgICAgICAgIHRoaXMubWlsbGlzZWNvbmRzKDApOwogICAgICAgICAgICAgICAgLyogZmFsbHMgdGhyb3VnaCAqLwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyB3ZWVrcyBhcmUgYSBzcGVjaWFsIGNhc2UKICAgICAgICAgICAgaWYgKHVuaXRzID09PSAnd2VlaycpIHsKICAgICAgICAgICAgICAgIHRoaXMud2Vla2RheSgwKTsKICAgICAgICAgICAgfSBlbHNlIGlmICh1bml0cyA9PT0gJ2lzb1dlZWsnKSB7CiAgICAgICAgICAgICAgICB0aGlzLmlzb1dlZWtkYXkoMSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIHF1YXJ0ZXJzIGFyZSBhbHNvIHNwZWNpYWwKICAgICAgICAgICAgaWYgKHVuaXRzID09PSAncXVhcnRlcicpIHsKICAgICAgICAgICAgICAgIHRoaXMubW9udGgoTWF0aC5mbG9vcih0aGlzLm1vbnRoKCkgLyAzKSAqIDMpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9LAoKICAgICAgICBlbmRPZjogZnVuY3Rpb24gKHVuaXRzKSB7CiAgICAgICAgICAgIHVuaXRzID0gbm9ybWFsaXplVW5pdHModW5pdHMpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5zdGFydE9mKHVuaXRzKS5hZGQoKHVuaXRzID09PSAnaXNvV2VlaycgPyAnd2VlaycgOiB1bml0cyksIDEpLnN1YnRyYWN0KCdtcycsIDEpOwogICAgICAgIH0sCgogICAgICAgIGlzQWZ0ZXI6IGZ1bmN0aW9uIChpbnB1dCwgdW5pdHMpIHsKICAgICAgICAgICAgdW5pdHMgPSB0eXBlb2YgdW5pdHMgIT09ICd1bmRlZmluZWQnID8gdW5pdHMgOiAnbWlsbGlzZWNvbmQnOwogICAgICAgICAgICByZXR1cm4gK3RoaXMuY2xvbmUoKS5zdGFydE9mKHVuaXRzKSA+ICttb21lbnQoaW5wdXQpLnN0YXJ0T2YodW5pdHMpOwogICAgICAgIH0sCgogICAgICAgIGlzQmVmb3JlOiBmdW5jdGlvbiAoaW5wdXQsIHVuaXRzKSB7CiAgICAgICAgICAgIHVuaXRzID0gdHlwZW9mIHVuaXRzICE9PSAndW5kZWZpbmVkJyA/IHVuaXRzIDogJ21pbGxpc2Vjb25kJzsKICAgICAgICAgICAgcmV0dXJuICt0aGlzLmNsb25lKCkuc3RhcnRPZih1bml0cykgPCArbW9tZW50KGlucHV0KS5zdGFydE9mKHVuaXRzKTsKICAgICAgICB9LAoKICAgICAgICBpc1NhbWU6IGZ1bmN0aW9uIChpbnB1dCwgdW5pdHMpIHsKICAgICAgICAgICAgdW5pdHMgPSB1bml0cyB8fCAnbXMnOwogICAgICAgICAgICByZXR1cm4gK3RoaXMuY2xvbmUoKS5zdGFydE9mKHVuaXRzKSA9PT0gK21ha2VBcyhpbnB1dCwgdGhpcykuc3RhcnRPZih1bml0cyk7CiAgICAgICAgfSwKCiAgICAgICAgbWluOiBmdW5jdGlvbiAob3RoZXIpIHsKICAgICAgICAgICAgb3RoZXIgPSBtb21lbnQuYXBwbHkobnVsbCwgYXJndW1lbnRzKTsKICAgICAgICAgICAgcmV0dXJuIG90aGVyIDwgdGhpcyA/IHRoaXMgOiBvdGhlcjsKICAgICAgICB9LAoKICAgICAgICBtYXg6IGZ1bmN0aW9uIChvdGhlcikgewogICAgICAgICAgICBvdGhlciA9IG1vbWVudC5hcHBseShudWxsLCBhcmd1bWVudHMpOwogICAgICAgICAgICByZXR1cm4gb3RoZXIgPiB0aGlzID8gdGhpcyA6IG90aGVyOwogICAgICAgIH0sCgogICAgICAgIC8vIGtlZXBUaW1lID0gdHJ1ZSBtZWFucyBvbmx5IGNoYW5nZSB0aGUgdGltZXpvbmUsIHdpdGhvdXQgYWZmZWN0aW5nCiAgICAgICAgLy8gdGhlIGxvY2FsIGhvdXIuIFNvIDU6MzE6MjYgKzAzMDAgLS1bem9uZSgyLCB0cnVlKV0tLT4gNTozMToyNiArMDIwMAogICAgICAgIC8vIEl0IGlzIHBvc3NpYmxlIHRoYXQgNTozMToyNiBkb2Vzbid0IGV4aXN0IGludCB6b25lICswMjAwLCBzbyB3ZQogICAgICAgIC8vIGFkanVzdCB0aGUgdGltZSBhcyBuZWVkZWQsIHRvIGJlIHZhbGlkLgogICAgICAgIC8vCiAgICAgICAgLy8gS2VlcGluZyB0aGUgdGltZSBhY3R1YWxseSBhZGRzL3N1YnRyYWN0cyAob25lIGhvdXIpCiAgICAgICAgLy8gZnJvbSB0aGUgYWN0dWFsIHJlcHJlc2VudGVkIHRpbWUuIFRoYXQgaXMgd2h5IHdlIGNhbGwgdXBkYXRlT2Zmc2V0CiAgICAgICAgLy8gYSBzZWNvbmQgdGltZS4gSW4gY2FzZSBpdCB3YW50cyB1cyB0byBjaGFuZ2UgdGhlIG9mZnNldCBhZ2FpbgogICAgICAgIC8vIF9jaGFuZ2VJblByb2dyZXNzID09IHRydWUgY2FzZSwgdGhlbiB3ZSBoYXZlIHRvIGFkanVzdCwgYmVjYXVzZQogICAgICAgIC8vIHRoZXJlIGlzIG5vIHN1Y2ggdGltZSBpbiB0aGUgZ2l2ZW4gdGltZXpvbmUuCiAgICAgICAgem9uZSA6IGZ1bmN0aW9uIChpbnB1dCwga2VlcFRpbWUpIHsKICAgICAgICAgICAgdmFyIG9mZnNldCA9IHRoaXMuX29mZnNldCB8fCAwOwogICAgICAgICAgICBpZiAoaW5wdXQgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBpbnB1dCA9PT0gInN0cmluZyIpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dCA9IHRpbWV6b25lTWludXRlc0Zyb21TdHJpbmcoaW5wdXQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKE1hdGguYWJzKGlucHV0KSA8IDE2KSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQgPSBpbnB1dCAqIDYwOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5fb2Zmc2V0ID0gaW5wdXQ7CiAgICAgICAgICAgICAgICB0aGlzLl9pc1VUQyA9IHRydWU7CiAgICAgICAgICAgICAgICBpZiAob2Zmc2V0ICE9PSBpbnB1dCkgewogICAgICAgICAgICAgICAgICAgIGlmICgha2VlcFRpbWUgfHwgdGhpcy5fY2hhbmdlSW5Qcm9ncmVzcykgewogICAgICAgICAgICAgICAgICAgICAgICBhZGRPclN1YnRyYWN0RHVyYXRpb25Gcm9tTW9tZW50KHRoaXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9tZW50LmR1cmF0aW9uKG9mZnNldCAtIGlucHV0LCAnbScpLCAxLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICghdGhpcy5fY2hhbmdlSW5Qcm9ncmVzcykgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9jaGFuZ2VJblByb2dyZXNzID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgbW9tZW50LnVwZGF0ZU9mZnNldCh0aGlzLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fY2hhbmdlSW5Qcm9ncmVzcyA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lzVVRDID8gb2Zmc2V0IDogdGhpcy5fZC5nZXRUaW1lem9uZU9mZnNldCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0sCgogICAgICAgIHpvbmVBYmJyIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faXNVVEMgPyAiVVRDIiA6ICIiOwogICAgICAgIH0sCgogICAgICAgIHpvbmVOYW1lIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5faXNVVEMgPyAiQ29vcmRpbmF0ZWQgVW5pdmVyc2FsIFRpbWUiIDogIiI7CiAgICAgICAgfSwKCiAgICAgICAgcGFyc2Vab25lIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICBpZiAodGhpcy5fdHptKSB7CiAgICAgICAgICAgICAgICB0aGlzLnpvbmUodGhpcy5fdHptKTsKICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgdGhpcy5faSA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgICAgIHRoaXMuem9uZSh0aGlzLl9pKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9LAoKICAgICAgICBoYXNBbGlnbmVkSG91ck9mZnNldCA6IGZ1bmN0aW9uIChpbnB1dCkgewogICAgICAgICAgICBpZiAoIWlucHV0KSB7CiAgICAgICAgICAgICAgICBpbnB1dCA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBpbnB1dCA9IG1vbWVudChpbnB1dCkuem9uZSgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gKHRoaXMuem9uZSgpIC0gaW5wdXQpICUgNjAgPT09IDA7CiAgICAgICAgfSwKCiAgICAgICAgZGF5c0luTW9udGggOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBkYXlzSW5Nb250aCh0aGlzLnllYXIoKSwgdGhpcy5tb250aCgpKTsKICAgICAgICB9LAoKICAgICAgICBkYXlPZlllYXIgOiBmdW5jdGlvbiAoaW5wdXQpIHsKICAgICAgICAgICAgdmFyIGRheU9mWWVhciA9IHJvdW5kKChtb21lbnQodGhpcykuc3RhcnRPZignZGF5JykgLSBtb21lbnQodGhpcykuc3RhcnRPZigneWVhcicpKSAvIDg2NGU1KSArIDE7CiAgICAgICAgICAgIHJldHVybiBpbnB1dCA9PSBudWxsID8gZGF5T2ZZZWFyIDogdGhpcy5hZGQoImQiLCAoaW5wdXQgLSBkYXlPZlllYXIpKTsKICAgICAgICB9LAoKICAgICAgICBxdWFydGVyIDogZnVuY3Rpb24gKGlucHV0KSB7CiAgICAgICAgICAgIHJldHVybiBpbnB1dCA9PSBudWxsID8gTWF0aC5jZWlsKCh0aGlzLm1vbnRoKCkgKyAxKSAvIDMpIDogdGhpcy5tb250aCgoaW5wdXQgLSAxKSAqIDMgKyB0aGlzLm1vbnRoKCkgJSAzKTsKICAgICAgICB9LAoKICAgICAgICB3ZWVrWWVhciA6IGZ1bmN0aW9uIChpbnB1dCkgewogICAgICAgICAgICB2YXIgeWVhciA9IHdlZWtPZlllYXIodGhpcywgdGhpcy5sYW5nKCkuX3dlZWsuZG93LCB0aGlzLmxhbmcoKS5fd2Vlay5kb3kpLnllYXI7CiAgICAgICAgICAgIHJldHVybiBpbnB1dCA9PSBudWxsID8geWVhciA6IHRoaXMuYWRkKCJ5IiwgKGlucHV0IC0geWVhcikpOwogICAgICAgIH0sCgogICAgICAgIGlzb1dlZWtZZWFyIDogZnVuY3Rpb24gKGlucHV0KSB7CiAgICAgICAgICAgIHZhciB5ZWFyID0gd2Vla09mWWVhcih0aGlzLCAxLCA0KS55ZWFyOwogICAgICAgICAgICByZXR1cm4gaW5wdXQgPT0gbnVsbCA/IHllYXIgOiB0aGlzLmFkZCgieSIsIChpbnB1dCAtIHllYXIpKTsKICAgICAgICB9LAoKICAgICAgICB3ZWVrIDogZnVuY3Rpb24gKGlucHV0KSB7CiAgICAgICAgICAgIHZhciB3ZWVrID0gdGhpcy5sYW5nKCkud2Vlayh0aGlzKTsKICAgICAgICAgICAgcmV0dXJuIGlucHV0ID09IG51bGwgPyB3ZWVrIDogdGhpcy5hZGQoImQiLCAoaW5wdXQgLSB3ZWVrKSAqIDcpOwogICAgICAgIH0sCgogICAgICAgIGlzb1dlZWsgOiBmdW5jdGlvbiAoaW5wdXQpIHsKICAgICAgICAgICAgdmFyIHdlZWsgPSB3ZWVrT2ZZZWFyKHRoaXMsIDEsIDQpLndlZWs7CiAgICAgICAgICAgIHJldHVybiBpbnB1dCA9PSBudWxsID8gd2VlayA6IHRoaXMuYWRkKCJkIiwgKGlucHV0IC0gd2VlaykgKiA3KTsKICAgICAgICB9LAoKICAgICAgICB3ZWVrZGF5IDogZnVuY3Rpb24gKGlucHV0KSB7CiAgICAgICAgICAgIHZhciB3ZWVrZGF5ID0gKHRoaXMuZGF5KCkgKyA3IC0gdGhpcy5sYW5nKCkuX3dlZWsuZG93KSAlIDc7CiAgICAgICAgICAgIHJldHVybiBpbnB1dCA9PSBudWxsID8gd2Vla2RheSA6IHRoaXMuYWRkKCJkIiwgaW5wdXQgLSB3ZWVrZGF5KTsKICAgICAgICB9LAoKICAgICAgICBpc29XZWVrZGF5IDogZnVuY3Rpb24gKGlucHV0KSB7CiAgICAgICAgICAgIC8vIGJlaGF2ZXMgdGhlIHNhbWUgYXMgbW9tZW50I2RheSBleGNlcHQKICAgICAgICAgICAgLy8gYXMgYSBnZXR0ZXIsIHJldHVybnMgNyBpbnN0ZWFkIG9mIDAgKDEtNyByYW5nZSBpbnN0ZWFkIG9mIDAtNikKICAgICAgICAgICAgLy8gYXMgYSBzZXR0ZXIsIHN1bmRheSBzaG91bGQgYmVsb25nIHRvIHRoZSBwcmV2aW91cyB3ZWVrLgogICAgICAgICAgICByZXR1cm4gaW5wdXQgPT0gbnVsbCA/IHRoaXMuZGF5KCkgfHwgNyA6IHRoaXMuZGF5KHRoaXMuZGF5KCkgJSA3ID8gaW5wdXQgOiBpbnB1dCAtIDcpOwogICAgICAgIH0sCgogICAgICAgIGlzb1dlZWtzSW5ZZWFyIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gd2Vla3NJblllYXIodGhpcy55ZWFyKCksIDEsIDQpOwogICAgICAgIH0sCgogICAgICAgIHdlZWtzSW5ZZWFyIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgd2Vla0luZm8gPSB0aGlzLl9sYW5nLl93ZWVrOwogICAgICAgICAgICByZXR1cm4gd2Vla3NJblllYXIodGhpcy55ZWFyKCksIHdlZWtJbmZvLmRvdywgd2Vla0luZm8uZG95KTsKICAgICAgICB9LAoKICAgICAgICBnZXQgOiBmdW5jdGlvbiAodW5pdHMpIHsKICAgICAgICAgICAgdW5pdHMgPSBub3JtYWxpemVVbml0cyh1bml0cyk7CiAgICAgICAgICAgIHJldHVybiB0aGlzW3VuaXRzXSgpOwogICAgICAgIH0sCgogICAgICAgIHNldCA6IGZ1bmN0aW9uICh1bml0cywgdmFsdWUpIHsKICAgICAgICAgICAgdW5pdHMgPSBub3JtYWxpemVVbml0cyh1bml0cyk7CiAgICAgICAgICAgIGlmICh0eXBlb2YgdGhpc1t1bml0c10gPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgICAgIHRoaXNbdW5pdHNdKHZhbHVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9LAoKICAgICAgICAvLyBJZiBwYXNzZWQgYSBsYW5ndWFnZSBrZXksIGl0IHdpbGwgc2V0IHRoZSBsYW5ndWFnZSBmb3IgdGhpcwogICAgICAgIC8vIGluc3RhbmNlLiAgT3RoZXJ3aXNlLCBpdCB3aWxsIHJldHVybiB0aGUgbGFuZ3VhZ2UgY29uZmlndXJhdGlvbgogICAgICAgIC8vIHZhcmlhYmxlcyBmb3IgdGhpcyBpbnN0YW5jZS4KICAgICAgICBsYW5nIDogZnVuY3Rpb24gKGtleSkgewogICAgICAgICAgICBpZiAoa2V5ID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9sYW5nOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5fbGFuZyA9IGdldExhbmdEZWZpbml0aW9uKGtleSk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0pOwoKICAgIGZ1bmN0aW9uIHJhd01vbnRoU2V0dGVyKG1vbSwgdmFsdWUpIHsKICAgICAgICB2YXIgZGF5T2ZNb250aDsKCiAgICAgICAgLy8gVE9ETzogTW92ZSB0aGlzIG91dCBvZiBoZXJlIQogICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgIHZhbHVlID0gbW9tLmxhbmcoKS5tb250aHNQYXJzZSh2YWx1ZSk7CiAgICAgICAgICAgIC8vIFRPRE86IEFub3RoZXIgc2lsZW50IGZhaWx1cmU/CiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgIT09ICdudW1iZXInKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbW9tOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBkYXlPZk1vbnRoID0gTWF0aC5taW4obW9tLmRhdGUoKSwKICAgICAgICAgICAgICAgIGRheXNJbk1vbnRoKG1vbS55ZWFyKCksIHZhbHVlKSk7CiAgICAgICAgbW9tLl9kWydzZXQnICsgKG1vbS5faXNVVEMgPyAnVVRDJyA6ICcnKSArICdNb250aCddKHZhbHVlLCBkYXlPZk1vbnRoKTsKICAgICAgICByZXR1cm4gbW9tOwogICAgfQoKICAgIGZ1bmN0aW9uIHJhd0dldHRlcihtb20sIHVuaXQpIHsKICAgICAgICByZXR1cm4gbW9tLl9kWydnZXQnICsgKG1vbS5faXNVVEMgPyAnVVRDJyA6ICcnKSArIHVuaXRdKCk7CiAgICB9CgogICAgZnVuY3Rpb24gcmF3U2V0dGVyKG1vbSwgdW5pdCwgdmFsdWUpIHsKICAgICAgICBpZiAodW5pdCA9PT0gJ01vbnRoJykgewogICAgICAgICAgICByZXR1cm4gcmF3TW9udGhTZXR0ZXIobW9tLCB2YWx1ZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIG1vbS5fZFsnc2V0JyArIChtb20uX2lzVVRDID8gJ1VUQycgOiAnJykgKyB1bml0XSh2YWx1ZSk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIG1ha2VBY2Nlc3Nvcih1bml0LCBrZWVwVGltZSkgewogICAgICAgIHJldHVybiBmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgICAgICAgaWYgKHZhbHVlICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIHJhd1NldHRlcih0aGlzLCB1bml0LCB2YWx1ZSk7CiAgICAgICAgICAgICAgICBtb21lbnQudXBkYXRlT2Zmc2V0KHRoaXMsIGtlZXBUaW1lKTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIHJhd0dldHRlcih0aGlzLCB1bml0KTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICB9CgogICAgbW9tZW50LmZuLm1pbGxpc2Vjb25kID0gbW9tZW50LmZuLm1pbGxpc2Vjb25kcyA9IG1ha2VBY2Nlc3NvcignTWlsbGlzZWNvbmRzJywgZmFsc2UpOwogICAgbW9tZW50LmZuLnNlY29uZCA9IG1vbWVudC5mbi5zZWNvbmRzID0gbWFrZUFjY2Vzc29yKCdTZWNvbmRzJywgZmFsc2UpOwogICAgbW9tZW50LmZuLm1pbnV0ZSA9IG1vbWVudC5mbi5taW51dGVzID0gbWFrZUFjY2Vzc29yKCdNaW51dGVzJywgZmFsc2UpOwogICAgLy8gU2V0dGluZyB0aGUgaG91ciBzaG91bGQga2VlcCB0aGUgdGltZSwgYmVjYXVzZSB0aGUgdXNlciBleHBsaWNpdGx5CiAgICAvLyBzcGVjaWZpZWQgd2hpY2ggaG91ciBoZSB3YW50cy4gU28gdHJ5aW5nIHRvIG1haW50YWluIHRoZSBzYW1lIGhvdXIgKGluCiAgICAvLyBhIG5ldyB0aW1lem9uZSkgbWFrZXMgc2Vuc2UuIEFkZGluZy9zdWJ0cmFjdGluZyBob3VycyBkb2VzIG5vdCBmb2xsb3cKICAgIC8vIHRoaXMgcnVsZS4KICAgIG1vbWVudC5mbi5ob3VyID0gbW9tZW50LmZuLmhvdXJzID0gbWFrZUFjY2Vzc29yKCdIb3VycycsIHRydWUpOwogICAgLy8gbW9tZW50LmZuLm1vbnRoIGlzIGRlZmluZWQgc2VwYXJhdGVseQogICAgbW9tZW50LmZuLmRhdGUgPSBtYWtlQWNjZXNzb3IoJ0RhdGUnLCB0cnVlKTsKICAgIG1vbWVudC5mbi5kYXRlcyA9IGRlcHJlY2F0ZSgiZGF0ZXMgYWNjZXNzb3IgaXMgZGVwcmVjYXRlZC4gVXNlIGRhdGUgaW5zdGVhZC4iLCBtYWtlQWNjZXNzb3IoJ0RhdGUnLCB0cnVlKSk7CiAgICBtb21lbnQuZm4ueWVhciA9IG1ha2VBY2Nlc3NvcignRnVsbFllYXInLCB0cnVlKTsKICAgIG1vbWVudC5mbi55ZWFycyA9IGRlcHJlY2F0ZSgieWVhcnMgYWNjZXNzb3IgaXMgZGVwcmVjYXRlZC4gVXNlIHllYXIgaW5zdGVhZC4iLCBtYWtlQWNjZXNzb3IoJ0Z1bGxZZWFyJywgdHJ1ZSkpOwoKICAgIC8vIGFkZCBwbHVyYWwgbWV0aG9kcwogICAgbW9tZW50LmZuLmRheXMgPSBtb21lbnQuZm4uZGF5OwogICAgbW9tZW50LmZuLm1vbnRocyA9IG1vbWVudC5mbi5tb250aDsKICAgIG1vbWVudC5mbi53ZWVrcyA9IG1vbWVudC5mbi53ZWVrOwogICAgbW9tZW50LmZuLmlzb1dlZWtzID0gbW9tZW50LmZuLmlzb1dlZWs7CiAgICBtb21lbnQuZm4ucXVhcnRlcnMgPSBtb21lbnQuZm4ucXVhcnRlcjsKCiAgICAvLyBhZGQgYWxpYXNlZCBmb3JtYXQgbWV0aG9kcwogICAgbW9tZW50LmZuLnRvSlNPTiA9IG1vbWVudC5mbi50b0lTT1N0cmluZzsKCiAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAgICAgRHVyYXRpb24gUHJvdG90eXBlCiAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCgoKICAgIGV4dGVuZChtb21lbnQuZHVyYXRpb24uZm4gPSBEdXJhdGlvbi5wcm90b3R5cGUsIHsKCiAgICAgICAgX2J1YmJsZSA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIG1pbGxpc2Vjb25kcyA9IHRoaXMuX21pbGxpc2Vjb25kcywKICAgICAgICAgICAgICAgIGRheXMgPSB0aGlzLl9kYXlzLAogICAgICAgICAgICAgICAgbW9udGhzID0gdGhpcy5fbW9udGhzLAogICAgICAgICAgICAgICAgZGF0YSA9IHRoaXMuX2RhdGEsCiAgICAgICAgICAgICAgICBzZWNvbmRzLCBtaW51dGVzLCBob3VycywgeWVhcnM7CgogICAgICAgICAgICAvLyBUaGUgZm9sbG93aW5nIGNvZGUgYnViYmxlcyB1cCB2YWx1ZXMsIHNlZSB0aGUgdGVzdHMgZm9yCiAgICAgICAgICAgIC8vIGV4YW1wbGVzIG9mIHdoYXQgdGhhdCBtZWFucy4KICAgICAgICAgICAgZGF0YS5taWxsaXNlY29uZHMgPSBtaWxsaXNlY29uZHMgJSAxMDAwOwoKICAgICAgICAgICAgc2Vjb25kcyA9IGFic1JvdW5kKG1pbGxpc2Vjb25kcyAvIDEwMDApOwogICAgICAgICAgICBkYXRhLnNlY29uZHMgPSBzZWNvbmRzICUgNjA7CgogICAgICAgICAgICBtaW51dGVzID0gYWJzUm91bmQoc2Vjb25kcyAvIDYwKTsKICAgICAgICAgICAgZGF0YS5taW51dGVzID0gbWludXRlcyAlIDYwOwoKICAgICAgICAgICAgaG91cnMgPSBhYnNSb3VuZChtaW51dGVzIC8gNjApOwogICAgICAgICAgICBkYXRhLmhvdXJzID0gaG91cnMgJSAyNDsKCiAgICAgICAgICAgIGRheXMgKz0gYWJzUm91bmQoaG91cnMgLyAyNCk7CiAgICAgICAgICAgIGRhdGEuZGF5cyA9IGRheXMgJSAzMDsKCiAgICAgICAgICAgIG1vbnRocyArPSBhYnNSb3VuZChkYXlzIC8gMzApOwogICAgICAgICAgICBkYXRhLm1vbnRocyA9IG1vbnRocyAlIDEyOwoKICAgICAgICAgICAgeWVhcnMgPSBhYnNSb3VuZChtb250aHMgLyAxMik7CiAgICAgICAgICAgIGRhdGEueWVhcnMgPSB5ZWFyczsKICAgICAgICB9LAoKICAgICAgICB3ZWVrcyA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGFic1JvdW5kKHRoaXMuZGF5cygpIC8gNyk7CiAgICAgICAgfSwKCiAgICAgICAgdmFsdWVPZiA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX21pbGxpc2Vjb25kcyArCiAgICAgICAgICAgICAgdGhpcy5fZGF5cyAqIDg2NGU1ICsKICAgICAgICAgICAgICAodGhpcy5fbW9udGhzICUgMTIpICogMjU5MmU2ICsKICAgICAgICAgICAgICB0b0ludCh0aGlzLl9tb250aHMgLyAxMikgKiAzMTUzNmU2OwogICAgICAgIH0sCgogICAgICAgIGh1bWFuaXplIDogZnVuY3Rpb24gKHdpdGhTdWZmaXgpIHsKICAgICAgICAgICAgdmFyIGRpZmZlcmVuY2UgPSArdGhpcywKICAgICAgICAgICAgICAgIG91dHB1dCA9IHJlbGF0aXZlVGltZShkaWZmZXJlbmNlLCAhd2l0aFN1ZmZpeCwgdGhpcy5sYW5nKCkpOwoKICAgICAgICAgICAgaWYgKHdpdGhTdWZmaXgpIHsKICAgICAgICAgICAgICAgIG91dHB1dCA9IHRoaXMubGFuZygpLnBhc3RGdXR1cmUoZGlmZmVyZW5jZSwgb3V0cHV0KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHRoaXMubGFuZygpLnBvc3Rmb3JtYXQob3V0cHV0KTsKICAgICAgICB9LAoKICAgICAgICBhZGQgOiBmdW5jdGlvbiAoaW5wdXQsIHZhbCkgewogICAgICAgICAgICAvLyBzdXBwb3J0cyBvbmx5IDIuMC1zdHlsZSBhZGQoMSwgJ3MnKSBvciBhZGQobW9tZW50KQogICAgICAgICAgICB2YXIgZHVyID0gbW9tZW50LmR1cmF0aW9uKGlucHV0LCB2YWwpOwoKICAgICAgICAgICAgdGhpcy5fbWlsbGlzZWNvbmRzICs9IGR1ci5fbWlsbGlzZWNvbmRzOwogICAgICAgICAgICB0aGlzLl9kYXlzICs9IGR1ci5fZGF5czsKICAgICAgICAgICAgdGhpcy5fbW9udGhzICs9IGR1ci5fbW9udGhzOwoKICAgICAgICAgICAgdGhpcy5fYnViYmxlKCk7CgogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9LAoKICAgICAgICBzdWJ0cmFjdCA6IGZ1bmN0aW9uIChpbnB1dCwgdmFsKSB7CiAgICAgICAgICAgIHZhciBkdXIgPSBtb21lbnQuZHVyYXRpb24oaW5wdXQsIHZhbCk7CgogICAgICAgICAgICB0aGlzLl9taWxsaXNlY29uZHMgLT0gZHVyLl9taWxsaXNlY29uZHM7CiAgICAgICAgICAgIHRoaXMuX2RheXMgLT0gZHVyLl9kYXlzOwogICAgICAgICAgICB0aGlzLl9tb250aHMgLT0gZHVyLl9tb250aHM7CgogICAgICAgICAgICB0aGlzLl9idWJibGUoKTsKCiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0sCgogICAgICAgIGdldCA6IGZ1bmN0aW9uICh1bml0cykgewogICAgICAgICAgICB1bml0cyA9IG5vcm1hbGl6ZVVuaXRzKHVuaXRzKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXNbdW5pdHMudG9Mb3dlckNhc2UoKSArICdzJ10oKTsKICAgICAgICB9LAoKICAgICAgICBhcyA6IGZ1bmN0aW9uICh1bml0cykgewogICAgICAgICAgICB1bml0cyA9IG5vcm1hbGl6ZVVuaXRzKHVuaXRzKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXNbJ2FzJyArIHVuaXRzLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgdW5pdHMuc2xpY2UoMSkgKyAncyddKCk7CiAgICAgICAgfSwKCiAgICAgICAgbGFuZyA6IG1vbWVudC5mbi5sYW5nLAoKICAgICAgICB0b0lzb1N0cmluZyA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgLy8gaW5zcGlyZWQgYnkgaHR0cHM6Ly9naXRodWIuY29tL2RvcmRpbGxlL21vbWVudC1pc29kdXJhdGlvbi9ibG9iL21hc3Rlci9tb21lbnQuaXNvZHVyYXRpb24uanMKICAgICAgICAgICAgdmFyIHllYXJzID0gTWF0aC5hYnModGhpcy55ZWFycygpKSwKICAgICAgICAgICAgICAgIG1vbnRocyA9IE1hdGguYWJzKHRoaXMubW9udGhzKCkpLAogICAgICAgICAgICAgICAgZGF5cyA9IE1hdGguYWJzKHRoaXMuZGF5cygpKSwKICAgICAgICAgICAgICAgIGhvdXJzID0gTWF0aC5hYnModGhpcy5ob3VycygpKSwKICAgICAgICAgICAgICAgIG1pbnV0ZXMgPSBNYXRoLmFicyh0aGlzLm1pbnV0ZXMoKSksCiAgICAgICAgICAgICAgICBzZWNvbmRzID0gTWF0aC5hYnModGhpcy5zZWNvbmRzKCkgKyB0aGlzLm1pbGxpc2Vjb25kcygpIC8gMTAwMCk7CgogICAgICAgICAgICBpZiAoIXRoaXMuYXNTZWNvbmRzKCkpIHsKICAgICAgICAgICAgICAgIC8vIHRoaXMgaXMgdGhlIHNhbWUgYXMgQyMncyAoTm9kYSkgYW5kIHB5dGhvbiAoaXNvZGF0ZSkuLi4KICAgICAgICAgICAgICAgIC8vIGJ1dCBub3Qgb3RoZXIgSlMgKGdvb2cuZGF0ZSkKICAgICAgICAgICAgICAgIHJldHVybiAnUDBEJzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuICh0aGlzLmFzU2Vjb25kcygpIDwgMCA/ICctJyA6ICcnKSArCiAgICAgICAgICAgICAgICAnUCcgKwogICAgICAgICAgICAgICAgKHllYXJzID8geWVhcnMgKyAnWScgOiAnJykgKwogICAgICAgICAgICAgICAgKG1vbnRocyA/IG1vbnRocyArICdNJyA6ICcnKSArCiAgICAgICAgICAgICAgICAoZGF5cyA/IGRheXMgKyAnRCcgOiAnJykgKwogICAgICAgICAgICAgICAgKChob3VycyB8fCBtaW51dGVzIHx8IHNlY29uZHMpID8gJ1QnIDogJycpICsKICAgICAgICAgICAgICAgIChob3VycyA/IGhvdXJzICsgJ0gnIDogJycpICsKICAgICAgICAgICAgICAgIChtaW51dGVzID8gbWludXRlcyArICdNJyA6ICcnKSArCiAgICAgICAgICAgICAgICAoc2Vjb25kcyA/IHNlY29uZHMgKyAnUycgOiAnJyk7CiAgICAgICAgfQogICAgfSk7CgogICAgZnVuY3Rpb24gbWFrZUR1cmF0aW9uR2V0dGVyKG5hbWUpIHsKICAgICAgICBtb21lbnQuZHVyYXRpb24uZm5bbmFtZV0gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9kYXRhW25hbWVdOwogICAgICAgIH07CiAgICB9CgogICAgZnVuY3Rpb24gbWFrZUR1cmF0aW9uQXNHZXR0ZXIobmFtZSwgZmFjdG9yKSB7CiAgICAgICAgbW9tZW50LmR1cmF0aW9uLmZuWydhcycgKyBuYW1lXSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuICt0aGlzIC8gZmFjdG9yOwogICAgICAgIH07CiAgICB9CgogICAgZm9yIChpIGluIHVuaXRNaWxsaXNlY29uZEZhY3RvcnMpIHsKICAgICAgICBpZiAodW5pdE1pbGxpc2Vjb25kRmFjdG9ycy5oYXNPd25Qcm9wZXJ0eShpKSkgewogICAgICAgICAgICBtYWtlRHVyYXRpb25Bc0dldHRlcihpLCB1bml0TWlsbGlzZWNvbmRGYWN0b3JzW2ldKTsKICAgICAgICAgICAgbWFrZUR1cmF0aW9uR2V0dGVyKGkudG9Mb3dlckNhc2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIG1ha2VEdXJhdGlvbkFzR2V0dGVyKCdXZWVrcycsIDYwNDhlNSk7CiAgICBtb21lbnQuZHVyYXRpb24uZm4uYXNNb250aHMgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuICgrdGhpcyAtIHRoaXMueWVhcnMoKSAqIDMxNTM2ZTYpIC8gMjU5MmU2ICsgdGhpcy55ZWFycygpICogMTI7CiAgICB9OwoKCiAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAgICAgRGVmYXVsdCBMYW5nCiAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCgoKICAgIC8vIFNldCBkZWZhdWx0IGxhbmd1YWdlLCBvdGhlciBsYW5ndWFnZXMgd2lsbCBpbmhlcml0IGZyb20gRW5nbGlzaC4KICAgIG1vbWVudC5sYW5nKCdlbicsIHsKICAgICAgICBvcmRpbmFsIDogZnVuY3Rpb24gKG51bWJlcikgewogICAgICAgICAgICB2YXIgYiA9IG51bWJlciAlIDEwLAogICAgICAgICAgICAgICAgb3V0cHV0ID0gKHRvSW50KG51bWJlciAlIDEwMCAvIDEwKSA9PT0gMSkgPyAndGgnIDoKICAgICAgICAgICAgICAgIChiID09PSAxKSA/ICdzdCcgOgogICAgICAgICAgICAgICAgKGIgPT09IDIpID8gJ25kJyA6CiAgICAgICAgICAgICAgICAoYiA9PT0gMykgPyAncmQnIDogJ3RoJzsKICAgICAgICAgICAgcmV0dXJuIG51bWJlciArIG91dHB1dDsKICAgICAgICB9CiAgICB9KTsKCiAgICAvKiBFTUJFRF9MQU5HVUFHRVMgKi8KCiAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAgICAgRXhwb3NpbmcgTW9tZW50CiAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCgogICAgZnVuY3Rpb24gbWFrZUdsb2JhbChzaG91bGREZXByZWNhdGUpIHsKICAgICAgICAvKmdsb2JhbCBlbmRlcjpmYWxzZSAqLwogICAgICAgIGlmICh0eXBlb2YgZW5kZXIgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgb2xkR2xvYmFsTW9tZW50ID0gZ2xvYmFsU2NvcGUubW9tZW50OwogICAgICAgIGlmIChzaG91bGREZXByZWNhdGUpIHsKICAgICAgICAgICAgZ2xvYmFsU2NvcGUubW9tZW50ID0gZGVwcmVjYXRlKAogICAgICAgICAgICAgICAgICAgICJBY2Nlc3NpbmcgTW9tZW50IHRocm91Z2ggdGhlIGdsb2JhbCBzY29wZSBpcyAiICsKICAgICAgICAgICAgICAgICAgICAiZGVwcmVjYXRlZCwgYW5kIHdpbGwgYmUgcmVtb3ZlZCBpbiBhbiB1cGNvbWluZyAiICsKICAgICAgICAgICAgICAgICAgICAicmVsZWFzZS4iLAogICAgICAgICAgICAgICAgICAgIG1vbWVudCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZ2xvYmFsU2NvcGUubW9tZW50ID0gbW9tZW50OwogICAgICAgIH0KICAgIH0KCiAgICAvLyBDb21tb25KUyBtb2R1bGUgaXMgZGVmaW5lZAogICAgaWYgKGhhc01vZHVsZSkgewogICAgICAgIG1vZHVsZS5leHBvcnRzID0gbW9tZW50OwogICAgfSBlbHNlIGlmICh0eXBlb2YgZGVmaW5lID09PSAiZnVuY3Rpb24iICYmIGRlZmluZS5hbWQpIHsKICAgICAgICBkZWZpbmUoIm1vbWVudCIsIFsncmVxdWlyZScsJ2V4cG9ydHMnLCdtb2R1bGUnXSxmdW5jdGlvbiAocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgICAgICAgIGlmIChtb2R1bGUuY29uZmlnICYmIG1vZHVsZS5jb25maWcoKSAmJiBtb2R1bGUuY29uZmlnKCkubm9HbG9iYWwgPT09IHRydWUpIHsKICAgICAgICAgICAgICAgIC8vIHJlbGVhc2UgdGhlIGdsb2JhbCB2YXJpYWJsZQogICAgICAgICAgICAgICAgZ2xvYmFsU2NvcGUubW9tZW50ID0gb2xkR2xvYmFsTW9tZW50OwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gbW9tZW50OwogICAgICAgIH0pOwogICAgICAgIG1ha2VHbG9iYWwodHJ1ZSk7CiAgICB9IGVsc2UgewogICAgICAgIG1ha2VHbG9iYWwoKTsKICAgIH0KfSkuY2FsbCh0aGlzKTsKCi8qCmplZC5qcwp2MC41LjBiZXRhCgpodHRwczovL2dpdGh1Yi5jb20vU2xleEF4dG9uL0plZAotLS0tLS0tLS0tLQpBIGdldHRleHQgY29tcGF0aWJsZSBpMThuIGxpYnJhcnkgZm9yIG1vZGVybiBKYXZhU2NyaXB0IEFwcGxpY2F0aW9ucwoKYnkgQWxleCBTZXh0b24gLSBBbGV4U2V4dG9uIFthdF0gZ21haWwgLSBAU2xleEF4dG9uCldURlBMIGxpY2Vuc2UgZm9yIHVzZQpEb2pvIENMQSBmb3IgY29udHJpYnV0aW9ucwoKSmVkIG9mZmVycyB0aGUgZW50aXJlIGFwcGxpY2FibGUgR05VIGdldHRleHQgc3BlYydkIHNldCBvZgpmdW5jdGlvbnMsIGJ1dCBhbHNvIG9mZmVycyBzb21lIG5pY2VyIHdyYXBwZXJzIGFyb3VuZCB0aGVtLgpUaGUgYXBpIGZvciBnZXR0ZXh0IHdhcyB3cml0dGVuIGZvciBhIGxhbmd1YWdlIHdpdGggbm8gZnVuY3Rpb24Kb3ZlcmxvYWRpbmcsIHNvIEplZCBhbGxvd3MgYSBsaXR0bGUgbW9yZSBvZiB0aGF0LgoKTWFueSB0aGFua3MgdG8gSm9zaHVhIEkuIE1pbGxlciAtIHVucnRzdEBjcGFuLm9yZyAtIHdobyB3cm90ZQpnZXR0ZXh0LmpzIGJhY2sgaW4gMjAwOC4gSSB3YXMgYWJsZSB0byB2ZXQgYSBsb3Qgb2YgbXkgaWRlYXMKYWdhaW5zdCBoaXMuIEkgYWxzbyBtYWRlIHN1cmUgSmVkIHBhc3NlZCBhZ2FpbnN0IGhpcyB0ZXN0cwppbiBvcmRlciB0byBvZmZlciBlYXN5IHVwZ3JhZGVzIC0tIGpzZ2V0dGV4dC5iZXJsaW9zLmRlCiovCihmdW5jdGlvbiAocm9vdCwgdW5kZWYpIHsKCiAgLy8gU2V0IHVwIHNvbWUgdW5kZXJzY29yZS1zdHlsZSBmdW5jdGlvbnMsIGlmIHlvdSBhbHJlYWR5IGhhdmUKICAvLyB1bmRlcnNjb3JlLCBmZWVsIGZyZWUgdG8gZGVsZXRlIHRoaXMgc2VjdGlvbiwgYW5kIHVzZSBpdAogIC8vIGRpcmVjdGx5LCBob3dldmVyLCB0aGUgYW1vdW50IG9mIGZ1bmN0aW9ucyB1c2VkIGRvZXNuJ3QKICAvLyB3YXJyYW50IGhhdmluZyB1bmRlcnNjb3JlIGFzIGEgZnVsbCBkZXBlbmRlbmN5LgogIC8vIFVuZGVyc2NvcmUgMS4zLjAgd2FzIHVzZWQgdG8gcG9ydCBhbmQgaXMgbGljZW5zZWQKICAvLyB1bmRlciB0aGUgTUlUIExpY2Vuc2UgYnkgSmVyZW15IEFzaGtlbmFzLgogIHZhciBBcnJheVByb3RvICAgID0gQXJyYXkucHJvdG90eXBlLAogICAgICBPYmpQcm90byAgICAgID0gT2JqZWN0LnByb3RvdHlwZSwKICAgICAgc2xpY2UgICAgICAgICA9IEFycmF5UHJvdG8uc2xpY2UsCiAgICAgIGhhc093blByb3AgICAgPSBPYmpQcm90by5oYXNPd25Qcm9wZXJ0eSwKICAgICAgbmF0aXZlRm9yRWFjaCA9IEFycmF5UHJvdG8uZm9yRWFjaCwKICAgICAgYnJlYWtlciAgICAgICA9IHt9OwoKICAvLyBXZSdyZSBub3QgdXNpbmcgdGhlIE9PUCBzdHlsZSBfIHNvIHdlIGRvbid0IG5lZWQgdGhlCiAgLy8gZXh0cmEgbGV2ZWwgb2YgaW5kaXJlY3Rpb24uIFRoaXMgc3RpbGwgbWVhbnMgdGhhdCB5b3UKICAvLyBzdWIgb3V0IGZvciByZWFsIGBfYCB0aG91Z2guCiAgdmFyIF8gPSB7CiAgICBmb3JFYWNoIDogZnVuY3Rpb24oIG9iaiwgaXRlcmF0b3IsIGNvbnRleHQgKSB7CiAgICAgIHZhciBpLCBsLCBrZXk7CiAgICAgIGlmICggb2JqID09PSBudWxsICkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKCBuYXRpdmVGb3JFYWNoICYmIG9iai5mb3JFYWNoID09PSBuYXRpdmVGb3JFYWNoICkgewogICAgICAgIG9iai5mb3JFYWNoKCBpdGVyYXRvciwgY29udGV4dCApOwogICAgICB9CiAgICAgIGVsc2UgaWYgKCBvYmoubGVuZ3RoID09PSArb2JqLmxlbmd0aCApIHsKICAgICAgICBmb3IgKCBpID0gMCwgbCA9IG9iai5sZW5ndGg7IGkgPCBsOyBpKysgKSB7CiAgICAgICAgICBpZiAoIGkgaW4gb2JqICYmIGl0ZXJhdG9yLmNhbGwoIGNvbnRleHQsIG9ialtpXSwgaSwgb2JqICkgPT09IGJyZWFrZXIgKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgZWxzZSB7CiAgICAgICAgZm9yICgga2V5IGluIG9iaikgewogICAgICAgICAgaWYgKCBoYXNPd25Qcm9wLmNhbGwoIG9iaiwga2V5ICkgKSB7CiAgICAgICAgICAgIGlmICggaXRlcmF0b3IuY2FsbCAoY29udGV4dCwgb2JqW2tleV0sIGtleSwgb2JqICkgPT09IGJyZWFrZXIgKSB7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgZXh0ZW5kIDogZnVuY3Rpb24oIG9iaiApIHsKICAgICAgdGhpcy5mb3JFYWNoKCBzbGljZS5jYWxsKCBhcmd1bWVudHMsIDEgKSwgZnVuY3Rpb24gKCBzb3VyY2UgKSB7CiAgICAgICAgZm9yICggdmFyIHByb3AgaW4gc291cmNlICkgewogICAgICAgICAgb2JqW3Byb3BdID0gc291cmNlW3Byb3BdOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHJldHVybiBvYmo7CiAgICB9CiAgfTsKICAvLyBFTkQgTWluaWF0dXJlIHVuZGVyc2NvcmUgaW1wbAoKICAvLyBKZWQgaXMgYSBjb25zdHJ1Y3RvciBmdW5jdGlvbgogIHZhciBKZWQgPSBmdW5jdGlvbiAoIG9wdGlvbnMgKSB7CiAgICAvLyBTb21lIG1pbmltYWwgZGVmYXVsdHMKICAgIHRoaXMuZGVmYXVsdHMgPSB7CiAgICAgICJsb2NhbGVfZGF0YSIgOiB7CiAgICAgICAgIm1lc3NhZ2VzIiA6IHsKICAgICAgICAgICIiIDogewogICAgICAgICAgICAiZG9tYWluIiAgICAgICA6ICJtZXNzYWdlcyIsCiAgICAgICAgICAgICJsYW5nIiAgICAgICAgIDogImVuIiwKICAgICAgICAgICAgInBsdXJhbF9mb3JtcyIgOiAibnBsdXJhbHM9MjsgcGx1cmFsPShuICE9IDEpOyIKICAgICAgICAgIH0KICAgICAgICAgIC8vIFRoZXJlIGFyZSBubyBkZWZhdWx0IGtleXMsIHRob3VnaAogICAgICAgIH0KICAgICAgfSwKICAgICAgLy8gVGhlIGRlZmF1bHQgZG9tYWluIGlmIG9uZSBpcyBtaXNzaW5nCiAgICAgICJkb21haW4iIDogIm1lc3NhZ2VzIgogICAgfTsKCiAgICAvLyBNaXggaW4gdGhlIHNlbnQgb3B0aW9ucyB3aXRoIHRoZSBkZWZhdWx0IG9wdGlvbnMKICAgIHRoaXMub3B0aW9ucyA9IF8uZXh0ZW5kKCB7fSwgdGhpcy5kZWZhdWx0cywgb3B0aW9ucyApOwogICAgdGhpcy50ZXh0ZG9tYWluKCB0aGlzLm9wdGlvbnMuZG9tYWluICk7CgogICAgaWYgKCBvcHRpb25zLmRvbWFpbiAmJiAhIHRoaXMub3B0aW9ucy5sb2NhbGVfZGF0YVsgdGhpcy5vcHRpb25zLmRvbWFpbiBdICkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RleHQgZG9tYWluIHNldCB0byBub24tZXhpc3RlbnQgZG9tYWluOiBgJyArIG9wdGlvbnMuZG9tYWluICsgJ2AnKTsKICAgIH0KICB9OwoKICAvLyBUaGUgZ2V0dGV4dCBzcGVjIHNldHMgdGhpcyBjaGFyYWN0ZXIgYXMgdGhlIGRlZmF1bHQKICAvLyBkZWxpbWl0ZXIgZm9yIGNvbnRleHQgbG9va3Vwcy4KICAvLyBlLmcuOiBjb250ZXh0XHUwMDA0a2V5CiAgLy8gSWYgeW91ciB0cmFuc2xhdGlvbiBjb21wYW55IHVzZXMgc29tZXRoaW5nIGRpZmZlcmVudCwKICAvLyBqdXN0IGNoYW5nZSB0aGlzIGF0IGFueSB0aW1lIGFuZCBpdCB3aWxsIHVzZSB0aGF0IGluc3RlYWQuCiAgSmVkLmNvbnRleHRfZGVsaW1pdGVyID0gU3RyaW5nLmZyb21DaGFyQ29kZSggNCApOwoKICBmdW5jdGlvbiBnZXRQbHVyYWxGb3JtRnVuYyAoIHBsdXJhbF9mb3JtX3N0cmluZyApIHsKICAgIHJldHVybiBKZWQuUEYuY29tcGlsZSggcGx1cmFsX2Zvcm1fc3RyaW5nIHx8ICJucGx1cmFscz0yOyBwbHVyYWw9KG4gIT0gMSk7Iik7CiAgfQoKICBmdW5jdGlvbiBDaGFpbigga2V5LCBpMThuICl7CiAgICB0aGlzLl9rZXkgPSBrZXk7CiAgICB0aGlzLl9pMThuID0gaTE4bjsKICB9CgogIC8vIENyZWF0ZSBhIGNoYWluYWJsZSBhcGkgZm9yIGFkZGluZyBhcmdzIHByZXR0aWx5CiAgXy5leHRlbmQoIENoYWluLnByb3RvdHlwZSwgewogICAgb25Eb21haW4gOiBmdW5jdGlvbiAoIGRvbWFpbiApIHsKICAgICAgdGhpcy5fZG9tYWluID0gZG9tYWluOwogICAgICByZXR1cm4gdGhpczsKICAgIH0sCiAgICB3aXRoQ29udGV4dCA6IGZ1bmN0aW9uICggY29udGV4dCApIHsKICAgICAgdGhpcy5fY29udGV4dCA9IGNvbnRleHQ7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKICAgIGlmUGx1cmFsIDogZnVuY3Rpb24gKCBudW0sIHBrZXkgKSB7CiAgICAgIHRoaXMuX3ZhbCA9IG51bTsKICAgICAgdGhpcy5fcGtleSA9IHBrZXk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKICAgIGZldGNoIDogZnVuY3Rpb24gKCBzQXJyICkgewogICAgICBpZiAoIHt9LnRvU3RyaW5nLmNhbGwoIHNBcnIgKSAhPSAnW29iamVjdCBBcnJheV0nICkgewogICAgICAgIHNBcnIgPSBbXS5zbGljZS5jYWxsKGFyZ3VtZW50cyk7CiAgICAgIH0KICAgICAgcmV0dXJuICggc0FyciAmJiBzQXJyLmxlbmd0aCA/IEplZC5zcHJpbnRmIDogZnVuY3Rpb24oeCl7IHJldHVybiB4OyB9ICkoCiAgICAgICAgdGhpcy5faTE4bi5kY25wZ2V0dGV4dCh0aGlzLl9kb21haW4sIHRoaXMuX2NvbnRleHQsIHRoaXMuX2tleSwgdGhpcy5fcGtleSwgdGhpcy5fdmFsKSwKICAgICAgICBzQXJyCiAgICAgICk7CiAgICB9CiAgfSk7CgogIC8vIEFkZCBmdW5jdGlvbnMgdG8gdGhlIEplZCBwcm90b3R5cGUuCiAgLy8gVGhlc2Ugd2lsbCBiZSB0aGUgZnVuY3Rpb25zIG9uIHRoZSBvYmplY3QgdGhhdCdzIHJldHVybmVkCiAgLy8gZnJvbSBjcmVhdGluZyBhIGBuZXcgSmVkKClgCiAgLy8gVGhlc2Ugc2VlbSByZWR1bmRhbnQsIGJ1dCB0aGV5IGd6aXAgcHJldHR5IHdlbGwuCiAgXy5leHRlbmQoIEplZC5wcm90b3R5cGUsIHsKICAgIC8vIFRoZSBzZXhpZXIgYXBpIHN0YXJ0IHBvaW50CiAgICB0cmFuc2xhdGUgOiBmdW5jdGlvbiAoIGtleSApIHsKICAgICAgcmV0dXJuIG5ldyBDaGFpbigga2V5LCB0aGlzICk7CiAgICB9LAoKICAgIHRleHRkb21haW4gOiBmdW5jdGlvbiAoIGRvbWFpbiApIHsKICAgICAgaWYgKCAhIGRvbWFpbiApIHsKICAgICAgICByZXR1cm4gdGhpcy5fdGV4dGRvbWFpbjsKICAgICAgfQogICAgICB0aGlzLl90ZXh0ZG9tYWluID0gZG9tYWluOwogICAgfSwKCiAgICBnZXR0ZXh0IDogZnVuY3Rpb24gKCBrZXkgKSB7CiAgICAgIHJldHVybiB0aGlzLmRjbnBnZXR0ZXh0LmNhbGwoIHRoaXMsIHVuZGVmLCB1bmRlZiwga2V5ICk7CiAgICB9LAoKICAgIGRnZXR0ZXh0IDogZnVuY3Rpb24gKCBkb21haW4sIGtleSApIHsKICAgICByZXR1cm4gdGhpcy5kY25wZ2V0dGV4dC5jYWxsKCB0aGlzLCBkb21haW4sIHVuZGVmLCBrZXkgKTsKICAgIH0sCgogICAgZGNnZXR0ZXh0IDogZnVuY3Rpb24gKCBkb21haW4gLCBrZXkgLyosIGNhdGVnb3J5ICovICkgewogICAgICAvLyBJZ25vcmVzIHRoZSBjYXRlZ29yeSBhbnl3YXlzCiAgICAgIHJldHVybiB0aGlzLmRjbnBnZXR0ZXh0LmNhbGwoIHRoaXMsIGRvbWFpbiwgdW5kZWYsIGtleSApOwogICAgfSwKCiAgICBuZ2V0dGV4dCA6IGZ1bmN0aW9uICggc2tleSwgcGtleSwgdmFsICkgewogICAgICByZXR1cm4gdGhpcy5kY25wZ2V0dGV4dC5jYWxsKCB0aGlzLCB1bmRlZiwgdW5kZWYsIHNrZXksIHBrZXksIHZhbCApOwogICAgfSwKCiAgICBkbmdldHRleHQgOiBmdW5jdGlvbiAoIGRvbWFpbiwgc2tleSwgcGtleSwgdmFsICkgewogICAgICByZXR1cm4gdGhpcy5kY25wZ2V0dGV4dC5jYWxsKCB0aGlzLCBkb21haW4sIHVuZGVmLCBza2V5LCBwa2V5LCB2YWwgKTsKICAgIH0sCgogICAgZGNuZ2V0dGV4dCA6IGZ1bmN0aW9uICggZG9tYWluLCBza2V5LCBwa2V5LCB2YWwvKiwgY2F0ZWdvcnkgKi8pIHsKICAgICAgcmV0dXJuIHRoaXMuZGNucGdldHRleHQuY2FsbCggdGhpcywgZG9tYWluLCB1bmRlZiwgc2tleSwgcGtleSwgdmFsICk7CiAgICB9LAoKICAgIHBnZXR0ZXh0IDogZnVuY3Rpb24gKCBjb250ZXh0LCBrZXkgKSB7CiAgICAgIHJldHVybiB0aGlzLmRjbnBnZXR0ZXh0LmNhbGwoIHRoaXMsIHVuZGVmLCBjb250ZXh0LCBrZXkgKTsKICAgIH0sCgogICAgZHBnZXR0ZXh0IDogZnVuY3Rpb24gKCBkb21haW4sIGNvbnRleHQsIGtleSApIHsKICAgICAgcmV0dXJuIHRoaXMuZGNucGdldHRleHQuY2FsbCggdGhpcywgZG9tYWluLCBjb250ZXh0LCBrZXkgKTsKICAgIH0sCgogICAgZGNwZ2V0dGV4dCA6IGZ1bmN0aW9uICggZG9tYWluLCBjb250ZXh0LCBrZXkvKiwgY2F0ZWdvcnkgKi8pIHsKICAgICAgcmV0dXJuIHRoaXMuZGNucGdldHRleHQuY2FsbCggdGhpcywgZG9tYWluLCBjb250ZXh0LCBrZXkgKTsKICAgIH0sCgogICAgbnBnZXR0ZXh0IDogZnVuY3Rpb24gKCBjb250ZXh0LCBza2V5LCBwa2V5LCB2YWwgKSB7CiAgICAgIHJldHVybiB0aGlzLmRjbnBnZXR0ZXh0LmNhbGwoIHRoaXMsIHVuZGVmLCBjb250ZXh0LCBza2V5LCBwa2V5LCB2YWwgKTsKICAgIH0sCgogICAgZG5wZ2V0dGV4dCA6IGZ1bmN0aW9uICggZG9tYWluLCBjb250ZXh0LCBza2V5LCBwa2V5LCB2YWwgKSB7CiAgICAgIHJldHVybiB0aGlzLmRjbnBnZXR0ZXh0LmNhbGwoIHRoaXMsIGRvbWFpbiwgY29udGV4dCwgc2tleSwgcGtleSwgdmFsICk7CiAgICB9LAoKICAgIC8vIFRoZSBtb3N0IGZ1bGx5IHF1YWxpZmllZCBnZXR0ZXh0IGZ1bmN0aW9uLiBJdCBoYXMgZXZlcnkgb3B0aW9uLgogICAgLy8gU2luY2UgaXQgaGFzIGV2ZXJ5IG9wdGlvbiwgd2UgY2FuIHVzZSBpdCBmcm9tIGV2ZXJ5IG90aGVyIG1ldGhvZC4KICAgIC8vIFRoaXMgaXMgdGhlIGJyZWFkIGFuZCBidXR0ZXIuCiAgICAvLyBUZWNobmljYWxseSB0aGVyZSBzaG91bGQgYmUgb25lIG1vcmUgYXJndW1lbnQgaW4gdGhpcyBmdW5jdGlvbiBmb3IgJ0NhdGVnb3J5JywKICAgIC8vIGJ1dCBzaW5jZSB3ZSBuZXZlciB1c2UgaXQsIHdlIG1pZ2h0IGFzIHdlbGwgbm90IHdhc3RlIHRoZSBieXRlcyB0byBkZWZpbmUgaXQuCiAgICBkY25wZ2V0dGV4dCA6IGZ1bmN0aW9uICggZG9tYWluLCBjb250ZXh0LCBzaW5ndWxhcl9rZXksIHBsdXJhbF9rZXksIHZhbCApIHsKICAgICAgLy8gU2V0IHNvbWUgZGVmYXVsdHMKCiAgICAgIHBsdXJhbF9rZXkgPSBwbHVyYWxfa2V5IHx8IHNpbmd1bGFyX2tleTsKCiAgICAgIC8vIFVzZSB0aGUgZ2xvYmFsIGRvbWFpbiBkZWZhdWx0IGlmIG9uZQogICAgICAvLyBpc24ndCBleHBsaWNpdGx5IHBhc3NlZCBpbgogICAgICBkb21haW4gPSBkb21haW4gfHwgdGhpcy5fdGV4dGRvbWFpbjsKCiAgICAgIC8vIERlZmF1bHQgdGhlIHZhbHVlIHRvIHRoZSBzaW5ndWxhciBjYXNlCiAgICAgIHZhbCA9IHR5cGVvZiB2YWwgPT0gJ3VuZGVmaW5lZCcgPyAxIDogdmFsOwoKICAgICAgdmFyIGZhbGxiYWNrOwoKICAgICAgLy8gSGFuZGxlIHNwZWNpYWwgY2FzZXMKCiAgICAgIC8vIE5vIG9wdGlvbnMgZm91bmQKICAgICAgaWYgKCAhIHRoaXMub3B0aW9ucyApIHsKICAgICAgICAvLyBUaGVyZSdzIGxpa2VseSBzb21ldGhpbmcgd3JvbmcsIGJ1dCB3ZSdsbCByZXR1cm4gdGhlIGNvcnJlY3Qga2V5IGZvciBlbmdsaXNoCiAgICAgICAgLy8gV2UgZG8gdGhpcyBieSBpbnN0YW50aWF0aW5nIGEgYnJhbmQgbmV3IEplZCBpbnN0YW5jZSB3aXRoIHRoZSBkZWZhdWx0IHNldAogICAgICAgIC8vIGZvciBldmVyeXRoaW5nIHRoYXQgY291bGQgYmUgYnJva2VuLgogICAgICAgIGZhbGxiYWNrID0gbmV3IEplZCgpOwogICAgICAgIHJldHVybiBmYWxsYmFjay5kY25wZ2V0dGV4dC5jYWxsKCBmYWxsYmFjaywgdW5kZWZpbmVkLCB1bmRlZmluZWQsIHNpbmd1bGFyX2tleSwgcGx1cmFsX2tleSwgdmFsICk7CiAgICAgIH0KCiAgICAgIC8vIE5vIHRyYW5zbGF0aW9uIGRhdGEgcHJvdmlkZWQKICAgICAgaWYgKCAhIHRoaXMub3B0aW9ucy5sb2NhbGVfZGF0YSApIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIGxvY2FsZSBkYXRhIHByb3ZpZGVkLicpOwogICAgICB9CgogICAgICBpZiAoICEgdGhpcy5vcHRpb25zLmxvY2FsZV9kYXRhWyBkb21haW4gXSApIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0RvbWFpbiBgJyArIGRvbWFpbiArICdgIHdhcyBub3QgZm91bmQuJyk7CiAgICAgIH0KCiAgICAgIGlmICggISB0aGlzLm9wdGlvbnMubG9jYWxlX2RhdGFbIGRvbWFpbiBdWyAiIiBdICkgewogICAgICAgIHRocm93IG5ldyBFcnJvcignTm8gbG9jYWxlIG1ldGEgaW5mb3JtYXRpb24gcHJvdmlkZWQuJyk7CiAgICAgIH0KCiAgICAgIC8vIE1ha2Ugc3VyZSB3ZSBoYXZlIGEgdHJ1dGh5IGtleS4gT3RoZXJ3aXNlIHdlIG1pZ2h0IHN0YXJ0IGxvb2tpbmcKICAgICAgLy8gaW50byB0aGUgZW1wdHkgc3RyaW5nIGtleSwgd2hpY2ggaXMgdGhlIG9wdGlvbnMgZm9yIHRoZSBsb2NhbGUKICAgICAgLy8gZGF0YS4KICAgICAgaWYgKCAhIHNpbmd1bGFyX2tleSApIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIHRyYW5zbGF0aW9uIGtleSBmb3VuZC4nKTsKICAgICAgfQoKICAgICAgLy8gSGFuZGxlIGludmFsaWQgbnVtYmVycywgYnV0IHRyeSBjYXN0aW5nIHN0cmluZ3MgZm9yIGdvb2QgbWVhc3VyZQogICAgICBpZiAoIHR5cGVvZiB2YWwgIT0gJ251bWJlcicgKSB7CiAgICAgICAgdmFsID0gcGFyc2VJbnQoIHZhbCwgMTAgKTsKCiAgICAgICAgaWYgKCBpc05hTiggdmFsICkgKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZSBudW1iZXIgdGhhdCB3YXMgcGFzc2VkIGluIGlzIG5vdCBhIG51bWJlci4nKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHZhciBrZXkgID0gY29udGV4dCA/IGNvbnRleHQgKyBKZWQuY29udGV4dF9kZWxpbWl0ZXIgKyBzaW5ndWxhcl9rZXkgOiBzaW5ndWxhcl9rZXksCiAgICAgICAgICBsb2NhbGVfZGF0YSA9IHRoaXMub3B0aW9ucy5sb2NhbGVfZGF0YSwKICAgICAgICAgIGRpY3QgPSBsb2NhbGVfZGF0YVsgZG9tYWluIF0sCiAgICAgICAgICBwbHVyYWxGb3JtcyA9IGRpY3RbIiJdLnBsdXJhbF9mb3JtcyB8fCAobG9jYWxlX2RhdGEubWVzc2FnZXMgfHwgdGhpcy5kZWZhdWx0cy5sb2NhbGVfZGF0YS5tZXNzYWdlcylbIiJdLnBsdXJhbF9mb3JtcywKICAgICAgICAgIHZhbF9pZHggPSBnZXRQbHVyYWxGb3JtRnVuYyhwbHVyYWxGb3JtcykodmFsKSArIDEsCiAgICAgICAgICB2YWxfbGlzdCwKICAgICAgICAgIHJlczsKCiAgICAgIC8vIFRocm93IGFuIGVycm9yIGlmIGEgZG9tYWluIGlzbid0IGZvdW5kCiAgICAgIGlmICggISBkaWN0ICkgewogICAgICAgIHRocm93IG5ldyBFcnJvcignTm8gZG9tYWluIG5hbWVkIGAnICsgZG9tYWluICsgJ2AgY291bGQgYmUgZm91bmQuJyk7CiAgICAgIH0KCiAgICAgIHZhbF9saXN0ID0gZGljdFsga2V5IF07CgogICAgICAvLyBJZiB0aGVyZSBpcyBubyBtYXRjaCwgdGhlbiByZXZlcnQgYmFjayB0bwogICAgICAvLyBlbmdsaXNoIHN0eWxlIHNpbmd1bGFyL3BsdXJhbCB3aXRoIHRoZSBrZXlzIHBhc3NlZCBpbi4KICAgICAgaWYgKCAhIHZhbF9saXN0IHx8IHZhbF9pZHggPj0gdmFsX2xpc3QubGVuZ3RoICkgewogICAgICAgIGlmICh0aGlzLm9wdGlvbnMubWlzc2luZ19rZXlfY2FsbGJhY2spIHsKICAgICAgICAgIHRoaXMub3B0aW9ucy5taXNzaW5nX2tleV9jYWxsYmFjayhrZXkpOwogICAgICAgIH0KICAgICAgICByZXMgPSBbIG51bGwsIHNpbmd1bGFyX2tleSwgcGx1cmFsX2tleSBdOwogICAgICAgIHJldHVybiByZXNbIGdldFBsdXJhbEZvcm1GdW5jKHBsdXJhbEZvcm1zKSggdmFsICkgKyAxIF07CiAgICAgIH0KCiAgICAgIHJlcyA9IHZhbF9saXN0WyB2YWxfaWR4IF07CgogICAgICAvLyBUaGlzIGluY2x1ZGVzIGVtcHR5IHN0cmluZ3Mgb24gcHVycG9zZQogICAgICBpZiAoICEgcmVzICApIHsKICAgICAgICByZXMgPSBbIG51bGwsIHNpbmd1bGFyX2tleSwgcGx1cmFsX2tleSBdOwogICAgICAgIHJldHVybiByZXNbIGdldFBsdXJhbEZvcm1GdW5jKHBsdXJhbEZvcm1zKSggdmFsICkgKyAxIF07CiAgICAgIH0KICAgICAgcmV0dXJuIHJlczsKICAgIH0KICB9KTsKCgogIC8vIFdlIGFkZCBpbiBzcHJpbnRmIGNhcGFiaWxpdGllcyBmb3IgcG9zdCB0cmFuc2xhdGlvbiB2YWx1ZSBpbnRlcm9sYXRpb24KICAvLyBUaGlzIGlzIG5vdCBpbnRlcm5hbGx5IHVzZWQsIHNvIHlvdSBjYW4gcmVtb3ZlIGl0IGlmIHlvdSBoYXZlIHRoaXMKICAvLyBhdmFpbGFibGUgc29tZXdoZXJlIGVsc2UsIG9yIHdhbnQgdG8gdXNlIGEgZGlmZmVyZW50IHN5c3RlbS4KCiAgLy8gV2UgX3NsaWdodGx5XyBtb2RpZnkgdGhlIG5vcm1hbCBzcHJpbnRmIGJlaGF2aW9yIHRvIG1vcmUgZ3JhY2VmdWxseSBoYW5kbGUKICAvLyB1bmRlZmluZWQgdmFsdWVzLgoKICAvKioKICAgc3ByaW50ZigpIGZvciBKYXZhU2NyaXB0IDAuNy1iZXRhMQogICBodHRwOi8vd3d3LmRpdmVpbnRvamF2YXNjcmlwdC5jb20vcHJvamVjdHMvamF2YXNjcmlwdC1zcHJpbnRmCgogICBDb3B5cmlnaHQgKGMpIEFsZXhhbmRydSBNYXJhc3RlYW51IDxhbGV4YWhvbGljIFthdCkgZ21haWwgKGRvdF0gY29tPgogICBBbGwgcmlnaHRzIHJlc2VydmVkLgoKICAgUmVkaXN0cmlidXRpb24gYW5kIHVzZSBpbiBzb3VyY2UgYW5kIGJpbmFyeSBmb3Jtcywgd2l0aCBvciB3aXRob3V0CiAgIG1vZGlmaWNhdGlvbiwgYXJlIHBlcm1pdHRlZCBwcm92aWRlZCB0aGF0IHRoZSBmb2xsb3dpbmcgY29uZGl0aW9ucyBhcmUgbWV0OgogICAgICAgKiBSZWRpc3RyaWJ1dGlvbnMgb2Ygc291cmNlIGNvZGUgbXVzdCByZXRhaW4gdGhlIGFib3ZlIGNvcHlyaWdodAogICAgICAgICBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIuCiAgICAgICAqIFJlZGlzdHJpYnV0aW9ucyBpbiBiaW5hcnkgZm9ybSBtdXN0IHJlcHJvZHVjZSB0aGUgYWJvdmUgY29weXJpZ2h0CiAgICAgICAgIG5vdGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lciBpbiB0aGUKICAgICAgICAgZG9jdW1lbnRhdGlvbiBhbmQvb3Igb3RoZXIgbWF0ZXJpYWxzIHByb3ZpZGVkIHdpdGggdGhlIGRpc3RyaWJ1dGlvbi4KICAgICAgICogTmVpdGhlciB0aGUgbmFtZSBvZiBzcHJpbnRmKCkgZm9yIEphdmFTY3JpcHQgbm9yIHRoZQogICAgICAgICBuYW1lcyBvZiBpdHMgY29udHJpYnV0b3JzIG1heSBiZSB1c2VkIHRvIGVuZG9yc2Ugb3IgcHJvbW90ZSBwcm9kdWN0cwogICAgICAgICBkZXJpdmVkIGZyb20gdGhpcyBzb2Z0d2FyZSB3aXRob3V0IHNwZWNpZmljIHByaW9yIHdyaXR0ZW4gcGVybWlzc2lvbi4KCiAgIFRISVMgU09GVFdBUkUgSVMgUFJPVklERUQgQlkgVEhFIENPUFlSSUdIVCBIT0xERVJTIEFORCBDT05UUklCVVRPUlMgIkFTIElTIiBBTkQKICAgQU5ZIEVYUFJFU1MgT1IgSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgVEhFIElNUExJRUQKICAgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkgQU5EIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFSRQogICBESVNDTEFJTUVELiBJTiBOTyBFVkVOVCBTSEFMTCBBbGV4YW5kcnUgTWFyYXN0ZWFudSBCRSBMSUFCTEUgRk9SIEFOWQogICBESVJFQ1QsIElORElSRUNULCBJTkNJREVOVEFMLCBTUEVDSUFMLCBFWEVNUExBUlksIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFUwogICAoSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFBST0NVUkVNRU5UIE9GIFNVQlNUSVRVVEUgR09PRFMgT1IgU0VSVklDRVM7CiAgIExPU1MgT0YgVVNFLCBEQVRBLCBPUiBQUk9GSVRTOyBPUiBCVVNJTkVTUyBJTlRFUlJVUFRJT04pIEhPV0VWRVIgQ0FVU0VEIEFORAogICBPTiBBTlkgVEhFT1JZIE9GIExJQUJJTElUWSwgV0hFVEhFUiBJTiBDT05UUkFDVCwgU1RSSUNUIExJQUJJTElUWSwgT1IgVE9SVAogICAoSU5DTFVESU5HIE5FR0xJR0VOQ0UgT1IgT1RIRVJXSVNFKSBBUklTSU5HIElOIEFOWSBXQVkgT1VUIE9GIFRIRSBVU0UgT0YgVEhJUwogICBTT0ZUV0FSRSwgRVZFTiBJRiBBRFZJU0VEIE9GIFRIRSBQT1NTSUJJTElUWSBPRiBTVUNIIERBTUFHRS4KICAqLwogIHZhciBzcHJpbnRmID0gKGZ1bmN0aW9uKCkgewogICAgZnVuY3Rpb24gZ2V0X3R5cGUodmFyaWFibGUpIHsKICAgICAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2YXJpYWJsZSkuc2xpY2UoOCwgLTEpLnRvTG93ZXJDYXNlKCk7CiAgICB9CiAgICBmdW5jdGlvbiBzdHJfcmVwZWF0KGlucHV0LCBtdWx0aXBsaWVyKSB7CiAgICAgIGZvciAodmFyIG91dHB1dCA9IFtdOyBtdWx0aXBsaWVyID4gMDsgb3V0cHV0Wy0tbXVsdGlwbGllcl0gPSBpbnB1dCkgey8qIGRvIG5vdGhpbmcgKi99CiAgICAgIHJldHVybiBvdXRwdXQuam9pbignJyk7CiAgICB9CgogICAgdmFyIHN0cl9mb3JtYXQgPSBmdW5jdGlvbigpIHsKICAgICAgaWYgKCFzdHJfZm9ybWF0LmNhY2hlLmhhc093blByb3BlcnR5KGFyZ3VtZW50c1swXSkpIHsKICAgICAgICBzdHJfZm9ybWF0LmNhY2hlW2FyZ3VtZW50c1swXV0gPSBzdHJfZm9ybWF0LnBhcnNlKGFyZ3VtZW50c1swXSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHN0cl9mb3JtYXQuZm9ybWF0LmNhbGwobnVsbCwgc3RyX2Zvcm1hdC5jYWNoZVthcmd1bWVudHNbMF1dLCBhcmd1bWVudHMpOwogICAgfTsKCiAgICBzdHJfZm9ybWF0LmZvcm1hdCA9IGZ1bmN0aW9uKHBhcnNlX3RyZWUsIGFyZ3YpIHsKICAgICAgdmFyIGN1cnNvciA9IDEsIHRyZWVfbGVuZ3RoID0gcGFyc2VfdHJlZS5sZW5ndGgsIG5vZGVfdHlwZSA9ICcnLCBhcmcsIG91dHB1dCA9IFtdLCBpLCBrLCBtYXRjaCwgcGFkLCBwYWRfY2hhcmFjdGVyLCBwYWRfbGVuZ3RoOwogICAgICBmb3IgKGkgPSAwOyBpIDwgdHJlZV9sZW5ndGg7IGkrKykgewogICAgICAgIG5vZGVfdHlwZSA9IGdldF90eXBlKHBhcnNlX3RyZWVbaV0pOwogICAgICAgIGlmIChub2RlX3R5cGUgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICBvdXRwdXQucHVzaChwYXJzZV90cmVlW2ldKTsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAobm9kZV90eXBlID09PSAnYXJyYXknKSB7CiAgICAgICAgICBtYXRjaCA9IHBhcnNlX3RyZWVbaV07IC8vIGNvbnZlbmllbmNlIHB1cnBvc2VzIG9ubHkKICAgICAgICAgIGlmIChtYXRjaFsyXSkgeyAvLyBrZXl3b3JkIGFyZ3VtZW50CiAgICAgICAgICAgIGFyZyA9IGFyZ3ZbY3Vyc29yXTsKICAgICAgICAgICAgZm9yIChrID0gMDsgayA8IG1hdGNoWzJdLmxlbmd0aDsgaysrKSB7CiAgICAgICAgICAgICAgaWYgKCFhcmcuaGFzT3duUHJvcGVydHkobWF0Y2hbMl1ba10pKSB7CiAgICAgICAgICAgICAgICB0aHJvdyhzcHJpbnRmKCdbc3ByaW50Zl0gcHJvcGVydHkgIiVzIiBkb2VzIG5vdCBleGlzdCcsIG1hdGNoWzJdW2tdKSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGFyZyA9IGFyZ1ttYXRjaFsyXVtrXV07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGVsc2UgaWYgKG1hdGNoWzFdKSB7IC8vIHBvc2l0aW9uYWwgYXJndW1lbnQgKGV4cGxpY2l0KQogICAgICAgICAgICBhcmcgPSBhcmd2W21hdGNoWzFdXTsKICAgICAgICAgIH0KICAgICAgICAgIGVsc2UgeyAvLyBwb3NpdGlvbmFsIGFyZ3VtZW50IChpbXBsaWNpdCkKICAgICAgICAgICAgYXJnID0gYXJndltjdXJzb3IrK107CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKC9bXnNdLy50ZXN0KG1hdGNoWzhdKSAmJiAoZ2V0X3R5cGUoYXJnKSAhPSAnbnVtYmVyJykpIHsKICAgICAgICAgICAgdGhyb3coc3ByaW50ZignW3NwcmludGZdIGV4cGVjdGluZyBudW1iZXIgYnV0IGZvdW5kICVzJywgZ2V0X3R5cGUoYXJnKSkpOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIEplZCBFRElUCiAgICAgICAgICBpZiAoIHR5cGVvZiBhcmcgPT0gJ3VuZGVmaW5lZCcgfHwgYXJnID09PSBudWxsICkgewogICAgICAgICAgICBhcmcgPSAnJzsKICAgICAgICAgIH0KICAgICAgICAgIC8vIEplZCBFRElUCgogICAgICAgICAgc3dpdGNoIChtYXRjaFs4XSkgewogICAgICAgICAgICBjYXNlICdiJzogYXJnID0gYXJnLnRvU3RyaW5nKDIpOyBicmVhazsKICAgICAgICAgICAgY2FzZSAnYyc6IGFyZyA9IFN0cmluZy5mcm9tQ2hhckNvZGUoYXJnKTsgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ2QnOiBhcmcgPSBwYXJzZUludChhcmcsIDEwKTsgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ2UnOiBhcmcgPSBtYXRjaFs3XSA/IGFyZy50b0V4cG9uZW50aWFsKG1hdGNoWzddKSA6IGFyZy50b0V4cG9uZW50aWFsKCk7IGJyZWFrOwogICAgICAgICAgICBjYXNlICdmJzogYXJnID0gbWF0Y2hbN10gPyBwYXJzZUZsb2F0KGFyZykudG9GaXhlZChtYXRjaFs3XSkgOiBwYXJzZUZsb2F0KGFyZyk7IGJyZWFrOwogICAgICAgICAgICBjYXNlICdvJzogYXJnID0gYXJnLnRvU3RyaW5nKDgpOyBicmVhazsKICAgICAgICAgICAgY2FzZSAncyc6IGFyZyA9ICgoYXJnID0gU3RyaW5nKGFyZykpICYmIG1hdGNoWzddID8gYXJnLnN1YnN0cmluZygwLCBtYXRjaFs3XSkgOiBhcmcpOyBicmVhazsKICAgICAgICAgICAgY2FzZSAndSc6IGFyZyA9IE1hdGguYWJzKGFyZyk7IGJyZWFrOwogICAgICAgICAgICBjYXNlICd4JzogYXJnID0gYXJnLnRvU3RyaW5nKDE2KTsgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ1gnOiBhcmcgPSBhcmcudG9TdHJpbmcoMTYpLnRvVXBwZXJDYXNlKCk7IGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgYXJnID0gKC9bZGVmXS8udGVzdChtYXRjaFs4XSkgJiYgbWF0Y2hbM10gJiYgYXJnID49IDAgPyAnKycrIGFyZyA6IGFyZyk7CiAgICAgICAgICBwYWRfY2hhcmFjdGVyID0gbWF0Y2hbNF0gPyBtYXRjaFs0XSA9PSAnMCcgPyAnMCcgOiBtYXRjaFs0XS5jaGFyQXQoMSkgOiAnICc7CiAgICAgICAgICBwYWRfbGVuZ3RoID0gbWF0Y2hbNl0gLSBTdHJpbmcoYXJnKS5sZW5ndGg7CiAgICAgICAgICBwYWQgPSBtYXRjaFs2XSA/IHN0cl9yZXBlYXQocGFkX2NoYXJhY3RlciwgcGFkX2xlbmd0aCkgOiAnJzsKICAgICAgICAgIG91dHB1dC5wdXNoKG1hdGNoWzVdID8gYXJnICsgcGFkIDogcGFkICsgYXJnKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIG91dHB1dC5qb2luKCcnKTsKICAgIH07CgogICAgc3RyX2Zvcm1hdC5jYWNoZSA9IHt9OwoKICAgIHN0cl9mb3JtYXQucGFyc2UgPSBmdW5jdGlvbihmbXQpIHsKICAgICAgdmFyIF9mbXQgPSBmbXQsIG1hdGNoID0gW10sIHBhcnNlX3RyZWUgPSBbXSwgYXJnX25hbWVzID0gMDsKICAgICAgd2hpbGUgKF9mbXQpIHsKICAgICAgICBpZiAoKG1hdGNoID0gL15bXlx4MjVdKy8uZXhlYyhfZm10KSkgIT09IG51bGwpIHsKICAgICAgICAgIHBhcnNlX3RyZWUucHVzaChtYXRjaFswXSk7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKChtYXRjaCA9IC9eXHgyNXsyfS8uZXhlYyhfZm10KSkgIT09IG51bGwpIHsKICAgICAgICAgIHBhcnNlX3RyZWUucHVzaCgnJScpOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmICgobWF0Y2ggPSAvXlx4MjUoPzooWzEtOV1cZCopXCR8XCgoW15cKV0rKVwpKT8oXCspPygwfCdbXiRdKT8oLSk/KFxkKyk/KD86XC4oXGQrKSk/KFtiLWZvc3V4WF0pLy5leGVjKF9mbXQpKSAhPT0gbnVsbCkgewogICAgICAgICAgaWYgKG1hdGNoWzJdKSB7CiAgICAgICAgICAgIGFyZ19uYW1lcyB8PSAxOwogICAgICAgICAgICB2YXIgZmllbGRfbGlzdCA9IFtdLCByZXBsYWNlbWVudF9maWVsZCA9IG1hdGNoWzJdLCBmaWVsZF9tYXRjaCA9IFtdOwogICAgICAgICAgICBpZiAoKGZpZWxkX21hdGNoID0gL14oW2Etel9dW2Etel9cZF0qKS9pLmV4ZWMocmVwbGFjZW1lbnRfZmllbGQpKSAhPT0gbnVsbCkgewogICAgICAgICAgICAgIGZpZWxkX2xpc3QucHVzaChmaWVsZF9tYXRjaFsxXSk7CiAgICAgICAgICAgICAgd2hpbGUgKChyZXBsYWNlbWVudF9maWVsZCA9IHJlcGxhY2VtZW50X2ZpZWxkLnN1YnN0cmluZyhmaWVsZF9tYXRjaFswXS5sZW5ndGgpKSAhPT0gJycpIHsKICAgICAgICAgICAgICAgIGlmICgoZmllbGRfbWF0Y2ggPSAvXlwuKFthLXpfXVthLXpfXGRdKikvaS5leGVjKHJlcGxhY2VtZW50X2ZpZWxkKSkgIT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgZmllbGRfbGlzdC5wdXNoKGZpZWxkX21hdGNoWzFdKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKChmaWVsZF9tYXRjaCA9IC9eXFsoXGQrKVxdLy5leGVjKHJlcGxhY2VtZW50X2ZpZWxkKSkgIT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgZmllbGRfbGlzdC5wdXNoKGZpZWxkX21hdGNoWzFdKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICB0aHJvdygnW3NwcmludGZdIGh1aD8nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgdGhyb3coJ1tzcHJpbnRmXSBodWg/Jyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbWF0Y2hbMl0gPSBmaWVsZF9saXN0OwogICAgICAgICAgfQogICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGFyZ19uYW1lcyB8PSAyOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGFyZ19uYW1lcyA9PT0gMykgewogICAgICAgICAgICB0aHJvdygnW3NwcmludGZdIG1peGluZyBwb3NpdGlvbmFsIGFuZCBuYW1lZCBwbGFjZWhvbGRlcnMgaXMgbm90ICh5ZXQpIHN1cHBvcnRlZCcpOwogICAgICAgICAgfQogICAgICAgICAgcGFyc2VfdHJlZS5wdXNoKG1hdGNoKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICB0aHJvdygnW3NwcmludGZdIGh1aD8nKTsKICAgICAgICB9CiAgICAgICAgX2ZtdCA9IF9mbXQuc3Vic3RyaW5nKG1hdGNoWzBdLmxlbmd0aCk7CiAgICAgIH0KICAgICAgcmV0dXJuIHBhcnNlX3RyZWU7CiAgICB9OwoKICAgIHJldHVybiBzdHJfZm9ybWF0OwogIH0pKCk7CgogIHZhciB2c3ByaW50ZiA9IGZ1bmN0aW9uKGZtdCwgYXJndikgewogICAgYXJndi51bnNoaWZ0KGZtdCk7CiAgICByZXR1cm4gc3ByaW50Zi5hcHBseShudWxsLCBhcmd2KTsKICB9OwoKICBKZWQucGFyc2VfcGx1cmFsID0gZnVuY3Rpb24gKCBwbHVyYWxfZm9ybXMsIG4gKSB7CiAgICBwbHVyYWxfZm9ybXMgPSBwbHVyYWxfZm9ybXMucmVwbGFjZSgvbi9nLCBuKTsKICAgIHJldHVybiBKZWQucGFyc2VfZXhwcmVzc2lvbihwbHVyYWxfZm9ybXMpOwogIH07CgogIEplZC5zcHJpbnRmID0gZnVuY3Rpb24gKCBmbXQsIGFyZ3MgKSB7CiAgICBpZiAoIHt9LnRvU3RyaW5nLmNhbGwoIGFyZ3MgKSA9PSAnW29iamVjdCBBcnJheV0nICkgewogICAgICByZXR1cm4gdnNwcmludGYoIGZtdCwgW10uc2xpY2UuY2FsbChhcmdzKSApOwogICAgfQogICAgcmV0dXJuIHNwcmludGYuYXBwbHkodGhpcywgW10uc2xpY2UuY2FsbChhcmd1bWVudHMpICk7CiAgfTsKCiAgSmVkLnByb3RvdHlwZS5zcHJpbnRmID0gZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIEplZC5zcHJpbnRmLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgfTsKICAvLyBFTkQgc3ByaW50ZiBJbXBsZW1lbnRhdGlvbgoKICAvLyBTdGFydCB0aGUgUGx1cmFsIGZvcm1zIHNlY3Rpb24KICAvLyBUaGlzIGlzIGEgZnVsbCBwbHVyYWwgZm9ybSBleHByZXNzaW9uIHBhcnNlci4gSXQgaXMgdXNlZCB0byBhdm9pZAogIC8vIHJ1bm5pbmcgJ2V2YWwnIG9yICduZXcgRnVuY3Rpb24nIGRpcmVjdGx5IGFnYWluc3QgdGhlIHBsdXJhbAogIC8vIGZvcm1zLgogIC8vCiAgLy8gVGhpcyBjYW4gYmUgaW1wb3J0YW50IGlmIHlvdSBnZXQgdHJhbnNsYXRpb25zIGRvbmUgdGhyb3VnaCBhIDNyZAogIC8vIHBhcnR5IHZlbmRvci4gSSBlbmNvdXJhZ2UgeW91IHRvIHVzZSB0aGlzIGluc3RlYWQsIGhvd2V2ZXIsIEkKICAvLyBhbHNvIHdpbGwgcHJvdmlkZSBhICdwcmVjb21waWxlcicgdGhhdCB5b3UgY2FuIHVzZSBhdCBidWlsZCB0aW1lCiAgLy8gdG8gb3V0cHV0IHZhbGlkL3NhZmUgZnVuY3Rpb24gcmVwcmVzZW50YXRpb25zIG9mIHRoZSBwbHVyYWwgZm9ybQogIC8vIGV4cHJlc3Npb25zLiBUaGlzIG1lYW5zIHlvdSBjYW4gYnVpbGQgdGhpcyBjb2RlIG91dCBmb3IgdGhlIG1vc3QKICAvLyBwYXJ0LgogIEplZC5QRiA9IHt9OwoKICBKZWQuUEYucGFyc2UgPSBmdW5jdGlvbiAoIHAgKSB7CiAgICB2YXIgcGx1cmFsX3N0ciA9IEplZC5QRi5leHRyYWN0UGx1cmFsRXhwciggcCApOwogICAgcmV0dXJuIEplZC5QRi5wYXJzZXIucGFyc2UuY2FsbChKZWQuUEYucGFyc2VyLCBwbHVyYWxfc3RyKTsKICB9OwoKICBKZWQuUEYuY29tcGlsZSA9IGZ1bmN0aW9uICggcCApIHsKICAgIC8vIEhhbmRsZSB0cnVlcyBhbmQgZmFsc2VzIGFzIDAgYW5kIDEKICAgIGZ1bmN0aW9uIGltcGx5KCB2YWwgKSB7CiAgICAgIHJldHVybiAodmFsID09PSB0cnVlID8gMSA6IHZhbCA/IHZhbCA6IDApOwogICAgfQoKICAgIHZhciBhc3QgPSBKZWQuUEYucGFyc2UoIHAgKTsKICAgIHJldHVybiBmdW5jdGlvbiAoIG4gKSB7CiAgICAgIHJldHVybiBpbXBseSggSmVkLlBGLmludGVycHJldGVyKCBhc3QgKSggbiApICk7CiAgICB9OwogIH07CgogIEplZC5QRi5pbnRlcnByZXRlciA9IGZ1bmN0aW9uICggYXN0ICkgewogICAgcmV0dXJuIGZ1bmN0aW9uICggbiApIHsKICAgICAgdmFyIHJlczsKICAgICAgc3dpdGNoICggYXN0LnR5cGUgKSB7CiAgICAgICAgY2FzZSAnR1JPVVAnOgogICAgICAgICAgcmV0dXJuIEplZC5QRi5pbnRlcnByZXRlciggYXN0LmV4cHIgKSggbiApOwogICAgICAgIGNhc2UgJ1RFUk5BUlknOgogICAgICAgICAgaWYgKCBKZWQuUEYuaW50ZXJwcmV0ZXIoIGFzdC5leHByICkoIG4gKSApIHsKICAgICAgICAgICAgcmV0dXJuIEplZC5QRi5pbnRlcnByZXRlciggYXN0LnRydXRoeSApKCBuICk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gSmVkLlBGLmludGVycHJldGVyKCBhc3QuZmFsc2V5ICkoIG4gKTsKICAgICAgICBjYXNlICdPUic6CiAgICAgICAgICByZXR1cm4gSmVkLlBGLmludGVycHJldGVyKCBhc3QubGVmdCApKCBuICkgfHwgSmVkLlBGLmludGVycHJldGVyKCBhc3QucmlnaHQgKSggbiApOwogICAgICAgIGNhc2UgJ0FORCc6CiAgICAgICAgICByZXR1cm4gSmVkLlBGLmludGVycHJldGVyKCBhc3QubGVmdCApKCBuICkgJiYgSmVkLlBGLmludGVycHJldGVyKCBhc3QucmlnaHQgKSggbiApOwogICAgICAgIGNhc2UgJ0xUJzoKICAgICAgICAgIHJldHVybiBKZWQuUEYuaW50ZXJwcmV0ZXIoIGFzdC5sZWZ0ICkoIG4gKSA8IEplZC5QRi5pbnRlcnByZXRlciggYXN0LnJpZ2h0ICkoIG4gKTsKICAgICAgICBjYXNlICdHVCc6CiAgICAgICAgICByZXR1cm4gSmVkLlBGLmludGVycHJldGVyKCBhc3QubGVmdCApKCBuICkgPiBKZWQuUEYuaW50ZXJwcmV0ZXIoIGFzdC5yaWdodCApKCBuICk7CiAgICAgICAgY2FzZSAnTFRFJzoKICAgICAgICAgIHJldHVybiBKZWQuUEYuaW50ZXJwcmV0ZXIoIGFzdC5sZWZ0ICkoIG4gKSA8PSBKZWQuUEYuaW50ZXJwcmV0ZXIoIGFzdC5yaWdodCApKCBuICk7CiAgICAgICAgY2FzZSAnR1RFJzoKICAgICAgICAgIHJldHVybiBKZWQuUEYuaW50ZXJwcmV0ZXIoIGFzdC5sZWZ0ICkoIG4gKSA+PSBKZWQuUEYuaW50ZXJwcmV0ZXIoIGFzdC5yaWdodCApKCBuICk7CiAgICAgICAgY2FzZSAnRVEnOgogICAgICAgICAgcmV0dXJuIEplZC5QRi5pbnRlcnByZXRlciggYXN0LmxlZnQgKSggbiApID09IEplZC5QRi5pbnRlcnByZXRlciggYXN0LnJpZ2h0ICkoIG4gKTsKICAgICAgICBjYXNlICdORVEnOgogICAgICAgICAgcmV0dXJuIEplZC5QRi5pbnRlcnByZXRlciggYXN0LmxlZnQgKSggbiApICE9IEplZC5QRi5pbnRlcnByZXRlciggYXN0LnJpZ2h0ICkoIG4gKTsKICAgICAgICBjYXNlICdNT0QnOgogICAgICAgICAgcmV0dXJuIEplZC5QRi5pbnRlcnByZXRlciggYXN0LmxlZnQgKSggbiApICUgSmVkLlBGLmludGVycHJldGVyKCBhc3QucmlnaHQgKSggbiApOwogICAgICAgIGNhc2UgJ1ZBUic6CiAgICAgICAgICByZXR1cm4gbjsKICAgICAgICBjYXNlICdOVU0nOgogICAgICAgICAgcmV0dXJuIGFzdC52YWw7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiSW52YWxpZCBUb2tlbiBmb3VuZC4iKTsKICAgICAgfQogICAgfTsKICB9OwoKICBKZWQuUEYuZXh0cmFjdFBsdXJhbEV4cHIgPSBmdW5jdGlvbiAoIHAgKSB7CiAgICAvLyB0cmltIGZpcnN0CiAgICBwID0gcC5yZXBsYWNlKC9eXHNccyovLCAnJykucmVwbGFjZSgvXHNccyokLywgJycpOwoKICAgIGlmICghIC87XHMqJC8udGVzdChwKSkgewogICAgICBwID0gcC5jb25jYXQoJzsnKTsKICAgIH0KCiAgICB2YXIgbnBsdXJhbHNfcmUgPSAvbnBsdXJhbHNcPShcZCspOy8sCiAgICAgICAgcGx1cmFsX3JlID0gL3BsdXJhbFw9KC4qKTsvLAogICAgICAgIG5wbHVyYWxzX21hdGNoZXMgPSBwLm1hdGNoKCBucGx1cmFsc19yZSApLAogICAgICAgIHJlcyA9IHt9LAogICAgICAgIHBsdXJhbF9tYXRjaGVzOwoKICAgIC8vIEZpbmQgdGhlIG5wbHVyYWxzIG51bWJlcgogICAgaWYgKCBucGx1cmFsc19tYXRjaGVzLmxlbmd0aCA+IDEgKSB7CiAgICAgIHJlcy5ucGx1cmFscyA9IG5wbHVyYWxzX21hdGNoZXNbMV07CiAgICB9CiAgICBlbHNlIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCducGx1cmFscyBub3QgZm91bmQgaW4gcGx1cmFsX2Zvcm1zIHN0cmluZzogJyArIHAgKTsKICAgIH0KCiAgICAvLyByZW1vdmUgdGhhdCBkYXRhIHRvIGdldCB0byB0aGUgZm9ybXVsYQogICAgcCA9IHAucmVwbGFjZSggbnBsdXJhbHNfcmUsICIiICk7CiAgICBwbHVyYWxfbWF0Y2hlcyA9IHAubWF0Y2goIHBsdXJhbF9yZSApOwoKICAgIGlmICghKCBwbHVyYWxfbWF0Y2hlcyAmJiBwbHVyYWxfbWF0Y2hlcy5sZW5ndGggPiAxICkgKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignYHBsdXJhbGAgZXhwcmVzc2lvbiBub3QgZm91bmQ6ICcgKyBwKTsKICAgIH0KICAgIHJldHVybiBwbHVyYWxfbWF0Y2hlc1sgMSBdOwogIH07CgogIC8qIEppc29uIGdlbmVyYXRlZCBwYXJzZXIgKi8KICBKZWQuUEYucGFyc2VyID0gKGZ1bmN0aW9uKCl7Cgp2YXIgcGFyc2VyID0ge3RyYWNlOiBmdW5jdGlvbiB0cmFjZSgpIHsgfSwKeXk6IHt9LApzeW1ib2xzXzogeyJlcnJvciI6MiwiZXhwcmVzc2lvbnMiOjMsImUiOjQsIkVPRiI6NSwiPyI6NiwiOiI6NywifHwiOjgsIiYmIjo5LCI8IjoxMCwiPD0iOjExLCI+IjoxMiwiPj0iOjEzLCIhPSI6MTQsIj09IjoxNSwiJSI6MTYsIigiOjE3LCIpIjoxOCwibiI6MTksIk5VTUJFUiI6MjAsIiRhY2NlcHQiOjAsIiRlbmQiOjF9LAp0ZXJtaW5hbHNfOiB7MjoiZXJyb3IiLDU6IkVPRiIsNjoiPyIsNzoiOiIsODoifHwiLDk6IiYmIiwxMDoiPCIsMTE6Ijw9IiwxMjoiPiIsMTM6Ij49IiwxNDoiIT0iLDE1OiI9PSIsMTY6IiUiLDE3OiIoIiwxODoiKSIsMTk6Im4iLDIwOiJOVU1CRVIifSwKcHJvZHVjdGlvbnNfOiBbMCxbMywyXSxbNCw1XSxbNCwzXSxbNCwzXSxbNCwzXSxbNCwzXSxbNCwzXSxbNCwzXSxbNCwzXSxbNCwzXSxbNCwzXSxbNCwzXSxbNCwxXSxbNCwxXV0sCnBlcmZvcm1BY3Rpb246IGZ1bmN0aW9uIGFub255bW91cyh5eXRleHQseXlsZW5nLHl5bGluZW5vLHl5LHl5c3RhdGUsJCQsXyQpIHsKCnZhciAkMCA9ICQkLmxlbmd0aCAtIDE7CnN3aXRjaCAoeXlzdGF0ZSkgewpjYXNlIDE6IHJldHVybiB7IHR5cGUgOiAnR1JPVVAnLCBleHByOiAkJFskMC0xXSB9OyAKYnJlYWs7CmNhc2UgMjp0aGlzLiQgPSB7IHR5cGU6ICdURVJOQVJZJywgZXhwcjogJCRbJDAtNF0sIHRydXRoeSA6ICQkWyQwLTJdLCBmYWxzZXk6ICQkWyQwXSB9OyAKYnJlYWs7CmNhc2UgMzp0aGlzLiQgPSB7IHR5cGU6ICJPUiIsIGxlZnQ6ICQkWyQwLTJdLCByaWdodDogJCRbJDBdIH07CmJyZWFrOwpjYXNlIDQ6dGhpcy4kID0geyB0eXBlOiAiQU5EIiwgbGVmdDogJCRbJDAtMl0sIHJpZ2h0OiAkJFskMF0gfTsKYnJlYWs7CmNhc2UgNTp0aGlzLiQgPSB7IHR5cGU6ICdMVCcsIGxlZnQ6ICQkWyQwLTJdLCByaWdodDogJCRbJDBdIH07IApicmVhazsKY2FzZSA2OnRoaXMuJCA9IHsgdHlwZTogJ0xURScsIGxlZnQ6ICQkWyQwLTJdLCByaWdodDogJCRbJDBdIH07CmJyZWFrOwpjYXNlIDc6dGhpcy4kID0geyB0eXBlOiAnR1QnLCBsZWZ0OiAkJFskMC0yXSwgcmlnaHQ6ICQkWyQwXSB9OwpicmVhazsKY2FzZSA4OnRoaXMuJCA9IHsgdHlwZTogJ0dURScsIGxlZnQ6ICQkWyQwLTJdLCByaWdodDogJCRbJDBdIH07CmJyZWFrOwpjYXNlIDk6dGhpcy4kID0geyB0eXBlOiAnTkVRJywgbGVmdDogJCRbJDAtMl0sIHJpZ2h0OiAkJFskMF0gfTsKYnJlYWs7CmNhc2UgMTA6dGhpcy4kID0geyB0eXBlOiAnRVEnLCBsZWZ0OiAkJFskMC0yXSwgcmlnaHQ6ICQkWyQwXSB9OwpicmVhazsKY2FzZSAxMTp0aGlzLiQgPSB7IHR5cGU6ICdNT0QnLCBsZWZ0OiAkJFskMC0yXSwgcmlnaHQ6ICQkWyQwXSB9OwpicmVhazsKY2FzZSAxMjp0aGlzLiQgPSB7IHR5cGU6ICdHUk9VUCcsIGV4cHI6ICQkWyQwLTFdIH07IApicmVhazsKY2FzZSAxMzp0aGlzLiQgPSB7IHR5cGU6ICdWQVInIH07IApicmVhazsKY2FzZSAxNDp0aGlzLiQgPSB7IHR5cGU6ICdOVU0nLCB2YWw6IE51bWJlcih5eXRleHQpIH07IApicmVhazsKfQp9LAp0YWJsZTogW3szOjEsNDoyLDE3OlsxLDNdLDE5OlsxLDRdLDIwOlsxLDVdfSx7MTpbM119LHs1OlsxLDZdLDY6WzEsN10sODpbMSw4XSw5OlsxLDldLDEwOlsxLDEwXSwxMTpbMSwxMV0sMTI6WzEsMTJdLDEzOlsxLDEzXSwxNDpbMSwxNF0sMTU6WzEsMTVdLDE2OlsxLDE2XX0sezQ6MTcsMTc6WzEsM10sMTk6WzEsNF0sMjA6WzEsNV19LHs1OlsyLDEzXSw2OlsyLDEzXSw3OlsyLDEzXSw4OlsyLDEzXSw5OlsyLDEzXSwxMDpbMiwxM10sMTE6WzIsMTNdLDEyOlsyLDEzXSwxMzpbMiwxM10sMTQ6WzIsMTNdLDE1OlsyLDEzXSwxNjpbMiwxM10sMTg6WzIsMTNdfSx7NTpbMiwxNF0sNjpbMiwxNF0sNzpbMiwxNF0sODpbMiwxNF0sOTpbMiwxNF0sMTA6WzIsMTRdLDExOlsyLDE0XSwxMjpbMiwxNF0sMTM6WzIsMTRdLDE0OlsyLDE0XSwxNTpbMiwxNF0sMTY6WzIsMTRdLDE4OlsyLDE0XX0sezE6WzIsMV19LHs0OjE4LDE3OlsxLDNdLDE5OlsxLDRdLDIwOlsxLDVdfSx7NDoxOSwxNzpbMSwzXSwxOTpbMSw0XSwyMDpbMSw1XX0sezQ6MjAsMTc6WzEsM10sMTk6WzEsNF0sMjA6WzEsNV19LHs0OjIxLDE3OlsxLDNdLDE5OlsxLDRdLDIwOlsxLDVdfSx7NDoyMiwxNzpbMSwzXSwxOTpbMSw0XSwyMDpbMSw1XX0sezQ6MjMsMTc6WzEsM10sMTk6WzEsNF0sMjA6WzEsNV19LHs0OjI0LDE3OlsxLDNdLDE5OlsxLDRdLDIwOlsxLDVdfSx7NDoyNSwxNzpbMSwzXSwxOTpbMSw0XSwyMDpbMSw1XX0sezQ6MjYsMTc6WzEsM10sMTk6WzEsNF0sMjA6WzEsNV19LHs0OjI3LDE3OlsxLDNdLDE5OlsxLDRdLDIwOlsxLDVdfSx7NjpbMSw3XSw4OlsxLDhdLDk6WzEsOV0sMTA6WzEsMTBdLDExOlsxLDExXSwxMjpbMSwxMl0sMTM6WzEsMTNdLDE0OlsxLDE0XSwxNTpbMSwxNV0sMTY6WzEsMTZdLDE4OlsxLDI4XX0sezY6WzEsN10sNzpbMSwyOV0sODpbMSw4XSw5OlsxLDldLDEwOlsxLDEwXSwxMTpbMSwxMV0sMTI6WzEsMTJdLDEzOlsxLDEzXSwxNDpbMSwxNF0sMTU6WzEsMTVdLDE2OlsxLDE2XX0sezU6WzIsM10sNjpbMiwzXSw3OlsyLDNdLDg6WzIsM10sOTpbMSw5XSwxMDpbMSwxMF0sMTE6WzEsMTFdLDEyOlsxLDEyXSwxMzpbMSwxM10sMTQ6WzEsMTRdLDE1OlsxLDE1XSwxNjpbMSwxNl0sMTg6WzIsM119LHs1OlsyLDRdLDY6WzIsNF0sNzpbMiw0XSw4OlsyLDRdLDk6WzIsNF0sMTA6WzEsMTBdLDExOlsxLDExXSwxMjpbMSwxMl0sMTM6WzEsMTNdLDE0OlsxLDE0XSwxNTpbMSwxNV0sMTY6WzEsMTZdLDE4OlsyLDRdfSx7NTpbMiw1XSw2OlsyLDVdLDc6WzIsNV0sODpbMiw1XSw5OlsyLDVdLDEwOlsyLDVdLDExOlsyLDVdLDEyOlsyLDVdLDEzOlsyLDVdLDE0OlsyLDVdLDE1OlsyLDVdLDE2OlsxLDE2XSwxODpbMiw1XX0sezU6WzIsNl0sNjpbMiw2XSw3OlsyLDZdLDg6WzIsNl0sOTpbMiw2XSwxMDpbMiw2XSwxMTpbMiw2XSwxMjpbMiw2XSwxMzpbMiw2XSwxNDpbMiw2XSwxNTpbMiw2XSwxNjpbMSwxNl0sMTg6WzIsNl19LHs1OlsyLDddLDY6WzIsN10sNzpbMiw3XSw4OlsyLDddLDk6WzIsN10sMTA6WzIsN10sMTE6WzIsN10sMTI6WzIsN10sMTM6WzIsN10sMTQ6WzIsN10sMTU6WzIsN10sMTY6WzEsMTZdLDE4OlsyLDddfSx7NTpbMiw4XSw2OlsyLDhdLDc6WzIsOF0sODpbMiw4XSw5OlsyLDhdLDEwOlsyLDhdLDExOlsyLDhdLDEyOlsyLDhdLDEzOlsyLDhdLDE0OlsyLDhdLDE1OlsyLDhdLDE2OlsxLDE2XSwxODpbMiw4XX0sezU6WzIsOV0sNjpbMiw5XSw3OlsyLDldLDg6WzIsOV0sOTpbMiw5XSwxMDpbMiw5XSwxMTpbMiw5XSwxMjpbMiw5XSwxMzpbMiw5XSwxNDpbMiw5XSwxNTpbMiw5XSwxNjpbMSwxNl0sMTg6WzIsOV19LHs1OlsyLDEwXSw2OlsyLDEwXSw3OlsyLDEwXSw4OlsyLDEwXSw5OlsyLDEwXSwxMDpbMiwxMF0sMTE6WzIsMTBdLDEyOlsyLDEwXSwxMzpbMiwxMF0sMTQ6WzIsMTBdLDE1OlsyLDEwXSwxNjpbMSwxNl0sMTg6WzIsMTBdfSx7NTpbMiwxMV0sNjpbMiwxMV0sNzpbMiwxMV0sODpbMiwxMV0sOTpbMiwxMV0sMTA6WzIsMTFdLDExOlsyLDExXSwxMjpbMiwxMV0sMTM6WzIsMTFdLDE0OlsyLDExXSwxNTpbMiwxMV0sMTY6WzIsMTFdLDE4OlsyLDExXX0sezU6WzIsMTJdLDY6WzIsMTJdLDc6WzIsMTJdLDg6WzIsMTJdLDk6WzIsMTJdLDEwOlsyLDEyXSwxMTpbMiwxMl0sMTI6WzIsMTJdLDEzOlsyLDEyXSwxNDpbMiwxMl0sMTU6WzIsMTJdLDE2OlsyLDEyXSwxODpbMiwxMl19LHs0OjMwLDE3OlsxLDNdLDE5OlsxLDRdLDIwOlsxLDVdfSx7NTpbMiwyXSw2OlsxLDddLDc6WzIsMl0sODpbMSw4XSw5OlsxLDldLDEwOlsxLDEwXSwxMTpbMSwxMV0sMTI6WzEsMTJdLDEzOlsxLDEzXSwxNDpbMSwxNF0sMTU6WzEsMTVdLDE2OlsxLDE2XSwxODpbMiwyXX1dLApkZWZhdWx0QWN0aW9uczogezY6WzIsMV19LApwYXJzZUVycm9yOiBmdW5jdGlvbiBwYXJzZUVycm9yKHN0ciwgaGFzaCkgewogICAgdGhyb3cgbmV3IEVycm9yKHN0cik7Cn0sCnBhcnNlOiBmdW5jdGlvbiBwYXJzZShpbnB1dCkgewogICAgdmFyIHNlbGYgPSB0aGlzLAogICAgICAgIHN0YWNrID0gWzBdLAogICAgICAgIHZzdGFjayA9IFtudWxsXSwgLy8gc2VtYW50aWMgdmFsdWUgc3RhY2sKICAgICAgICBsc3RhY2sgPSBbXSwgLy8gbG9jYXRpb24gc3RhY2sKICAgICAgICB0YWJsZSA9IHRoaXMudGFibGUsCiAgICAgICAgeXl0ZXh0ID0gJycsCiAgICAgICAgeXlsaW5lbm8gPSAwLAogICAgICAgIHl5bGVuZyA9IDAsCiAgICAgICAgcmVjb3ZlcmluZyA9IDAsCiAgICAgICAgVEVSUk9SID0gMiwKICAgICAgICBFT0YgPSAxOwoKICAgIC8vdGhpcy5yZWR1Y3Rpb25Db3VudCA9IHRoaXMuc2hpZnRDb3VudCA9IDA7CgogICAgdGhpcy5sZXhlci5zZXRJbnB1dChpbnB1dCk7CiAgICB0aGlzLmxleGVyLnl5ID0gdGhpcy55eTsKICAgIHRoaXMueXkubGV4ZXIgPSB0aGlzLmxleGVyOwogICAgaWYgKHR5cGVvZiB0aGlzLmxleGVyLnl5bGxvYyA9PSAndW5kZWZpbmVkJykKICAgICAgICB0aGlzLmxleGVyLnl5bGxvYyA9IHt9OwogICAgdmFyIHl5bG9jID0gdGhpcy5sZXhlci55eWxsb2M7CiAgICBsc3RhY2sucHVzaCh5eWxvYyk7CgogICAgaWYgKHR5cGVvZiB0aGlzLnl5LnBhcnNlRXJyb3IgPT09ICdmdW5jdGlvbicpCiAgICAgICAgdGhpcy5wYXJzZUVycm9yID0gdGhpcy55eS5wYXJzZUVycm9yOwoKICAgIGZ1bmN0aW9uIHBvcFN0YWNrIChuKSB7CiAgICAgICAgc3RhY2subGVuZ3RoID0gc3RhY2subGVuZ3RoIC0gMipuOwogICAgICAgIHZzdGFjay5sZW5ndGggPSB2c3RhY2subGVuZ3RoIC0gbjsKICAgICAgICBsc3RhY2subGVuZ3RoID0gbHN0YWNrLmxlbmd0aCAtIG47CiAgICB9CgogICAgZnVuY3Rpb24gbGV4KCkgewogICAgICAgIHZhciB0b2tlbjsKICAgICAgICB0b2tlbiA9IHNlbGYubGV4ZXIubGV4KCkgfHwgMTsgLy8gJGVuZCA9IDEKICAgICAgICAvLyBpZiB0b2tlbiBpc24ndCBpdHMgbnVtZXJpYyB2YWx1ZSwgY29udmVydAogICAgICAgIGlmICh0eXBlb2YgdG9rZW4gIT09ICdudW1iZXInKSB7CiAgICAgICAgICAgIHRva2VuID0gc2VsZi5zeW1ib2xzX1t0b2tlbl0gfHwgdG9rZW47CiAgICAgICAgfQogICAgICAgIHJldHVybiB0b2tlbjsKICAgIH0KCiAgICB2YXIgc3ltYm9sLCBwcmVFcnJvclN5bWJvbCwgc3RhdGUsIGFjdGlvbiwgYSwgciwgeXl2YWw9e30scCxsZW4sbmV3U3RhdGUsIGV4cGVjdGVkOwogICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAvLyByZXRyZWl2ZSBzdGF0ZSBudW1iZXIgZnJvbSB0b3Agb2Ygc3RhY2sKICAgICAgICBzdGF0ZSA9IHN0YWNrW3N0YWNrLmxlbmd0aC0xXTsKCiAgICAgICAgLy8gdXNlIGRlZmF1bHQgYWN0aW9ucyBpZiBhdmFpbGFibGUKICAgICAgICBpZiAodGhpcy5kZWZhdWx0QWN0aW9uc1tzdGF0ZV0pIHsKICAgICAgICAgICAgYWN0aW9uID0gdGhpcy5kZWZhdWx0QWN0aW9uc1tzdGF0ZV07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKHN5bWJvbCA9PSBudWxsKQogICAgICAgICAgICAgICAgc3ltYm9sID0gbGV4KCk7CiAgICAgICAgICAgIC8vIHJlYWQgYWN0aW9uIGZvciBjdXJyZW50IHN0YXRlIGFuZCBmaXJzdCBpbnB1dAogICAgICAgICAgICBhY3Rpb24gPSB0YWJsZVtzdGF0ZV0gJiYgdGFibGVbc3RhdGVdW3N5bWJvbF07CiAgICAgICAgfQoKICAgICAgICAvLyBoYW5kbGUgcGFyc2UgZXJyb3IKICAgICAgICBfaGFuZGxlX2Vycm9yOgogICAgICAgIGlmICh0eXBlb2YgYWN0aW9uID09PSAndW5kZWZpbmVkJyB8fCAhYWN0aW9uLmxlbmd0aCB8fCAhYWN0aW9uWzBdKSB7CgogICAgICAgICAgICBpZiAoIXJlY292ZXJpbmcpIHsKICAgICAgICAgICAgICAgIC8vIFJlcG9ydCBlcnJvcgogICAgICAgICAgICAgICAgZXhwZWN0ZWQgPSBbXTsKICAgICAgICAgICAgICAgIGZvciAocCBpbiB0YWJsZVtzdGF0ZV0pIGlmICh0aGlzLnRlcm1pbmFsc19bcF0gJiYgcCA+IDIpIHsKICAgICAgICAgICAgICAgICAgICBleHBlY3RlZC5wdXNoKCInIit0aGlzLnRlcm1pbmFsc19bcF0rIiciKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHZhciBlcnJTdHIgPSAnJzsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmxleGVyLnNob3dQb3NpdGlvbikgewogICAgICAgICAgICAgICAgICAgIGVyclN0ciA9ICdQYXJzZSBlcnJvciBvbiBsaW5lICcrKHl5bGluZW5vKzEpKyI6XG4iK3RoaXMubGV4ZXIuc2hvd1Bvc2l0aW9uKCkrIlxuRXhwZWN0aW5nICIrZXhwZWN0ZWQuam9pbignLCAnKSArICIsIGdvdCAnIiArIHRoaXMudGVybWluYWxzX1tzeW1ib2xdKyAiJyI7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGVyclN0ciA9ICdQYXJzZSBlcnJvciBvbiBsaW5lICcrKHl5bGluZW5vKzEpKyI6IFVuZXhwZWN0ZWQgIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoc3ltYm9sID09IDEgLypFT0YqLyA/ICJlbmQgb2YgaW5wdXQiIDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICgiJyIrKHRoaXMudGVybWluYWxzX1tzeW1ib2xdIHx8IHN5bWJvbCkrIiciKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLnBhcnNlRXJyb3IoZXJyU3RyLAogICAgICAgICAgICAgICAgICAgIHt0ZXh0OiB0aGlzLmxleGVyLm1hdGNoLCB0b2tlbjogdGhpcy50ZXJtaW5hbHNfW3N5bWJvbF0gfHwgc3ltYm9sLCBsaW5lOiB0aGlzLmxleGVyLnl5bGluZW5vLCBsb2M6IHl5bG9jLCBleHBlY3RlZDogZXhwZWN0ZWR9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8ganVzdCByZWNvdmVyZWQgZnJvbSBhbm90aGVyIGVycm9yCiAgICAgICAgICAgIGlmIChyZWNvdmVyaW5nID09IDMpIHsKICAgICAgICAgICAgICAgIGlmIChzeW1ib2wgPT0gRU9GKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVyclN0ciB8fCAnUGFyc2luZyBoYWx0ZWQuJyk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gZGlzY2FyZCBjdXJyZW50IGxvb2thaGVhZCBhbmQgZ3JhYiBhbm90aGVyCiAgICAgICAgICAgICAgICB5eWxlbmcgPSB0aGlzLmxleGVyLnl5bGVuZzsKICAgICAgICAgICAgICAgIHl5dGV4dCA9IHRoaXMubGV4ZXIueXl0ZXh0OwogICAgICAgICAgICAgICAgeXlsaW5lbm8gPSB0aGlzLmxleGVyLnl5bGluZW5vOwogICAgICAgICAgICAgICAgeXlsb2MgPSB0aGlzLmxleGVyLnl5bGxvYzsKICAgICAgICAgICAgICAgIHN5bWJvbCA9IGxleCgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyB0cnkgdG8gcmVjb3ZlciBmcm9tIGVycm9yCiAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICAvLyBjaGVjayBmb3IgZXJyb3IgcmVjb3ZlcnkgcnVsZSBpbiB0aGlzIHN0YXRlCiAgICAgICAgICAgICAgICBpZiAoKFRFUlJPUi50b1N0cmluZygpKSBpbiB0YWJsZVtzdGF0ZV0pIHsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChzdGF0ZSA9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVyclN0ciB8fCAnUGFyc2luZyBoYWx0ZWQuJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBwb3BTdGFjaygxKTsKICAgICAgICAgICAgICAgIHN0YXRlID0gc3RhY2tbc3RhY2subGVuZ3RoLTFdOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwcmVFcnJvclN5bWJvbCA9IHN5bWJvbDsgLy8gc2F2ZSB0aGUgbG9va2FoZWFkIHRva2VuCiAgICAgICAgICAgIHN5bWJvbCA9IFRFUlJPUjsgICAgICAgICAvLyBpbnNlcnQgZ2VuZXJpYyBlcnJvciBzeW1ib2wgYXMgbmV3IGxvb2thaGVhZAogICAgICAgICAgICBzdGF0ZSA9IHN0YWNrW3N0YWNrLmxlbmd0aC0xXTsKICAgICAgICAgICAgYWN0aW9uID0gdGFibGVbc3RhdGVdICYmIHRhYmxlW3N0YXRlXVtURVJST1JdOwogICAgICAgICAgICByZWNvdmVyaW5nID0gMzsgLy8gYWxsb3cgMyByZWFsIHN5bWJvbHMgdG8gYmUgc2hpZnRlZCBiZWZvcmUgcmVwb3J0aW5nIGEgbmV3IGVycm9yCiAgICAgICAgfQoKICAgICAgICAvLyB0aGlzIHNob3VsZG4ndCBoYXBwZW4sIHVubGVzcyByZXNvbHZlIGRlZmF1bHRzIGFyZSBvZmYKICAgICAgICBpZiAoYWN0aW9uWzBdIGluc3RhbmNlb2YgQXJyYXkgJiYgYWN0aW9uLmxlbmd0aCA+IDEpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdQYXJzZSBFcnJvcjogbXVsdGlwbGUgYWN0aW9ucyBwb3NzaWJsZSBhdCBzdGF0ZTogJytzdGF0ZSsnLCB0b2tlbjogJytzeW1ib2wpOwogICAgICAgIH0KCiAgICAgICAgc3dpdGNoIChhY3Rpb25bMF0pIHsKCiAgICAgICAgICAgIGNhc2UgMTogLy8gc2hpZnQKICAgICAgICAgICAgICAgIC8vdGhpcy5zaGlmdENvdW50Kys7CgogICAgICAgICAgICAgICAgc3RhY2sucHVzaChzeW1ib2wpOwogICAgICAgICAgICAgICAgdnN0YWNrLnB1c2godGhpcy5sZXhlci55eXRleHQpOwogICAgICAgICAgICAgICAgbHN0YWNrLnB1c2godGhpcy5sZXhlci55eWxsb2MpOwogICAgICAgICAgICAgICAgc3RhY2sucHVzaChhY3Rpb25bMV0pOyAvLyBwdXNoIHN0YXRlCiAgICAgICAgICAgICAgICBzeW1ib2wgPSBudWxsOwogICAgICAgICAgICAgICAgaWYgKCFwcmVFcnJvclN5bWJvbCkgeyAvLyBub3JtYWwgZXhlY3V0aW9uL25vIGVycm9yCiAgICAgICAgICAgICAgICAgICAgeXlsZW5nID0gdGhpcy5sZXhlci55eWxlbmc7CiAgICAgICAgICAgICAgICAgICAgeXl0ZXh0ID0gdGhpcy5sZXhlci55eXRleHQ7CiAgICAgICAgICAgICAgICAgICAgeXlsaW5lbm8gPSB0aGlzLmxleGVyLnl5bGluZW5vOwogICAgICAgICAgICAgICAgICAgIHl5bG9jID0gdGhpcy5sZXhlci55eWxsb2M7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlY292ZXJpbmcgPiAwKQogICAgICAgICAgICAgICAgICAgICAgICByZWNvdmVyaW5nLS07CiAgICAgICAgICAgICAgICB9IGVsc2UgeyAvLyBlcnJvciBqdXN0IG9jY3VycmVkLCByZXN1bWUgb2xkIGxvb2thaGVhZCBmLyBiZWZvcmUgZXJyb3IKICAgICAgICAgICAgICAgICAgICBzeW1ib2wgPSBwcmVFcnJvclN5bWJvbDsKICAgICAgICAgICAgICAgICAgICBwcmVFcnJvclN5bWJvbCA9IG51bGw7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgMjogLy8gcmVkdWNlCiAgICAgICAgICAgICAgICAvL3RoaXMucmVkdWN0aW9uQ291bnQrKzsKCiAgICAgICAgICAgICAgICBsZW4gPSB0aGlzLnByb2R1Y3Rpb25zX1thY3Rpb25bMV1dWzFdOwoKICAgICAgICAgICAgICAgIC8vIHBlcmZvcm0gc2VtYW50aWMgYWN0aW9uCiAgICAgICAgICAgICAgICB5eXZhbC4kID0gdnN0YWNrW3ZzdGFjay5sZW5ndGgtbGVuXTsgLy8gZGVmYXVsdCB0byAkJCA9ICQxCiAgICAgICAgICAgICAgICAvLyBkZWZhdWx0IGxvY2F0aW9uLCB1c2VzIGZpcnN0IHRva2VuIGZvciBmaXJzdHMsIGxhc3QgZm9yIGxhc3RzCiAgICAgICAgICAgICAgICB5eXZhbC5fJCA9IHsKICAgICAgICAgICAgICAgICAgICBmaXJzdF9saW5lOiBsc3RhY2tbbHN0YWNrLmxlbmd0aC0obGVufHwxKV0uZmlyc3RfbGluZSwKICAgICAgICAgICAgICAgICAgICBsYXN0X2xpbmU6IGxzdGFja1tsc3RhY2subGVuZ3RoLTFdLmxhc3RfbGluZSwKICAgICAgICAgICAgICAgICAgICBmaXJzdF9jb2x1bW46IGxzdGFja1tsc3RhY2subGVuZ3RoLShsZW58fDEpXS5maXJzdF9jb2x1bW4sCiAgICAgICAgICAgICAgICAgICAgbGFzdF9jb2x1bW46IGxzdGFja1tsc3RhY2subGVuZ3RoLTFdLmxhc3RfY29sdW1uCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgciA9IHRoaXMucGVyZm9ybUFjdGlvbi5jYWxsKHl5dmFsLCB5eXRleHQsIHl5bGVuZywgeXlsaW5lbm8sIHRoaXMueXksIGFjdGlvblsxXSwgdnN0YWNrLCBsc3RhY2spOwoKICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgciAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBwb3Agb2ZmIHN0YWNrCiAgICAgICAgICAgICAgICBpZiAobGVuKSB7CiAgICAgICAgICAgICAgICAgICAgc3RhY2sgPSBzdGFjay5zbGljZSgwLC0xKmxlbioyKTsKICAgICAgICAgICAgICAgICAgICB2c3RhY2sgPSB2c3RhY2suc2xpY2UoMCwgLTEqbGVuKTsKICAgICAgICAgICAgICAgICAgICBsc3RhY2sgPSBsc3RhY2suc2xpY2UoMCwgLTEqbGVuKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBzdGFjay5wdXNoKHRoaXMucHJvZHVjdGlvbnNfW2FjdGlvblsxXV1bMF0pOyAgICAvLyBwdXNoIG5vbnRlcm1pbmFsIChyZWR1Y2UpCiAgICAgICAgICAgICAgICB2c3RhY2sucHVzaCh5eXZhbC4kKTsKICAgICAgICAgICAgICAgIGxzdGFjay5wdXNoKHl5dmFsLl8kKTsKICAgICAgICAgICAgICAgIC8vIGdvdG8gbmV3IHN0YXRlID0gdGFibGVbU1RBVEVdW05PTlRFUk1JTkFMXQogICAgICAgICAgICAgICAgbmV3U3RhdGUgPSB0YWJsZVtzdGFja1tzdGFjay5sZW5ndGgtMl1dW3N0YWNrW3N0YWNrLmxlbmd0aC0xXV07CiAgICAgICAgICAgICAgICBzdGFjay5wdXNoKG5ld1N0YXRlKTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAzOiAvLyBhY2NlcHQKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAgICB9CgogICAgcmV0dXJuIHRydWU7Cn19Oy8qIEppc29uIGdlbmVyYXRlZCBsZXhlciAqLwp2YXIgbGV4ZXIgPSAoZnVuY3Rpb24oKXsKCnZhciBsZXhlciA9ICh7RU9GOjEsCnBhcnNlRXJyb3I6ZnVuY3Rpb24gcGFyc2VFcnJvcihzdHIsIGhhc2gpIHsKICAgICAgICBpZiAodGhpcy55eS5wYXJzZUVycm9yKSB7CiAgICAgICAgICAgIHRoaXMueXkucGFyc2VFcnJvcihzdHIsIGhhc2gpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihzdHIpOwogICAgICAgIH0KICAgIH0sCnNldElucHV0OmZ1bmN0aW9uIChpbnB1dCkgewogICAgICAgIHRoaXMuX2lucHV0ID0gaW5wdXQ7CiAgICAgICAgdGhpcy5fbW9yZSA9IHRoaXMuX2xlc3MgPSB0aGlzLmRvbmUgPSBmYWxzZTsKICAgICAgICB0aGlzLnl5bGluZW5vID0gdGhpcy55eWxlbmcgPSAwOwogICAgICAgIHRoaXMueXl0ZXh0ID0gdGhpcy5tYXRjaGVkID0gdGhpcy5tYXRjaCA9ICcnOwogICAgICAgIHRoaXMuY29uZGl0aW9uU3RhY2sgPSBbJ0lOSVRJQUwnXTsKICAgICAgICB0aGlzLnl5bGxvYyA9IHtmaXJzdF9saW5lOjEsZmlyc3RfY29sdW1uOjAsbGFzdF9saW5lOjEsbGFzdF9jb2x1bW46MH07CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAppbnB1dDpmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGNoID0gdGhpcy5faW5wdXRbMF07CiAgICAgICAgdGhpcy55eXRleHQrPWNoOwogICAgICAgIHRoaXMueXlsZW5nKys7CiAgICAgICAgdGhpcy5tYXRjaCs9Y2g7CiAgICAgICAgdGhpcy5tYXRjaGVkKz1jaDsKICAgICAgICB2YXIgbGluZXMgPSBjaC5tYXRjaCgvXG4vKTsKICAgICAgICBpZiAobGluZXMpIHRoaXMueXlsaW5lbm8rKzsKICAgICAgICB0aGlzLl9pbnB1dCA9IHRoaXMuX2lucHV0LnNsaWNlKDEpOwogICAgICAgIHJldHVybiBjaDsKICAgIH0sCnVucHV0OmZ1bmN0aW9uIChjaCkgewogICAgICAgIHRoaXMuX2lucHV0ID0gY2ggKyB0aGlzLl9pbnB1dDsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0sCm1vcmU6ZnVuY3Rpb24gKCkgewogICAgICAgIHRoaXMuX21vcmUgPSB0cnVlOwogICAgICAgIHJldHVybiB0aGlzOwogICAgfSwKcGFzdElucHV0OmZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgcGFzdCA9IHRoaXMubWF0Y2hlZC5zdWJzdHIoMCwgdGhpcy5tYXRjaGVkLmxlbmd0aCAtIHRoaXMubWF0Y2gubGVuZ3RoKTsKICAgICAgICByZXR1cm4gKHBhc3QubGVuZ3RoID4gMjAgPyAnLi4uJzonJykgKyBwYXN0LnN1YnN0cigtMjApLnJlcGxhY2UoL1xuL2csICIiKTsKICAgIH0sCnVwY29taW5nSW5wdXQ6ZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBuZXh0ID0gdGhpcy5tYXRjaDsKICAgICAgICBpZiAobmV4dC5sZW5ndGggPCAyMCkgewogICAgICAgICAgICBuZXh0ICs9IHRoaXMuX2lucHV0LnN1YnN0cigwLCAyMC1uZXh0Lmxlbmd0aCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiAobmV4dC5zdWJzdHIoMCwyMCkrKG5leHQubGVuZ3RoID4gMjAgPyAnLi4uJzonJykpLnJlcGxhY2UoL1xuL2csICIiKTsKICAgIH0sCnNob3dQb3NpdGlvbjpmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHByZSA9IHRoaXMucGFzdElucHV0KCk7CiAgICAgICAgdmFyIGMgPSBuZXcgQXJyYXkocHJlLmxlbmd0aCArIDEpLmpvaW4oIi0iKTsKICAgICAgICByZXR1cm4gcHJlICsgdGhpcy51cGNvbWluZ0lucHV0KCkgKyAiXG4iICsgYysiXiI7CiAgICB9LApuZXh0OmZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAodGhpcy5kb25lKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLkVPRjsKICAgICAgICB9CiAgICAgICAgaWYgKCF0aGlzLl9pbnB1dCkgdGhpcy5kb25lID0gdHJ1ZTsKCiAgICAgICAgdmFyIHRva2VuLAogICAgICAgICAgICBtYXRjaCwKICAgICAgICAgICAgY29sLAogICAgICAgICAgICBsaW5lczsKICAgICAgICBpZiAoIXRoaXMuX21vcmUpIHsKICAgICAgICAgICAgdGhpcy55eXRleHQgPSAnJzsKICAgICAgICAgICAgdGhpcy5tYXRjaCA9ICcnOwogICAgICAgIH0KICAgICAgICB2YXIgcnVsZXMgPSB0aGlzLl9jdXJyZW50UnVsZXMoKTsKICAgICAgICBmb3IgKHZhciBpPTA7aSA8IHJ1bGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIG1hdGNoID0gdGhpcy5faW5wdXQubWF0Y2godGhpcy5ydWxlc1tydWxlc1tpXV0pOwogICAgICAgICAgICBpZiAobWF0Y2gpIHsKICAgICAgICAgICAgICAgIGxpbmVzID0gbWF0Y2hbMF0ubWF0Y2goL1xuLiovZyk7CiAgICAgICAgICAgICAgICBpZiAobGluZXMpIHRoaXMueXlsaW5lbm8gKz0gbGluZXMubGVuZ3RoOwogICAgICAgICAgICAgICAgdGhpcy55eWxsb2MgPSB7Zmlyc3RfbGluZTogdGhpcy55eWxsb2MubGFzdF9saW5lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdF9saW5lOiB0aGlzLnl5bGluZW5vKzEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJzdF9jb2x1bW46IHRoaXMueXlsbG9jLmxhc3RfY29sdW1uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdF9jb2x1bW46IGxpbmVzID8gbGluZXNbbGluZXMubGVuZ3RoLTFdLmxlbmd0aC0xIDogdGhpcy55eWxsb2MubGFzdF9jb2x1bW4gKyBtYXRjaFswXS5sZW5ndGh9CiAgICAgICAgICAgICAgICB0aGlzLnl5dGV4dCArPSBtYXRjaFswXTsKICAgICAgICAgICAgICAgIHRoaXMubWF0Y2ggKz0gbWF0Y2hbMF07CiAgICAgICAgICAgICAgICB0aGlzLm1hdGNoZXMgPSBtYXRjaDsKICAgICAgICAgICAgICAgIHRoaXMueXlsZW5nID0gdGhpcy55eXRleHQubGVuZ3RoOwogICAgICAgICAgICAgICAgdGhpcy5fbW9yZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgdGhpcy5faW5wdXQgPSB0aGlzLl9pbnB1dC5zbGljZShtYXRjaFswXS5sZW5ndGgpOwogICAgICAgICAgICAgICAgdGhpcy5tYXRjaGVkICs9IG1hdGNoWzBdOwogICAgICAgICAgICAgICAgdG9rZW4gPSB0aGlzLnBlcmZvcm1BY3Rpb24uY2FsbCh0aGlzLCB0aGlzLnl5LCB0aGlzLCBydWxlc1tpXSx0aGlzLmNvbmRpdGlvblN0YWNrW3RoaXMuY29uZGl0aW9uU3RhY2subGVuZ3RoLTFdKTsKICAgICAgICAgICAgICAgIGlmICh0b2tlbikgcmV0dXJuIHRva2VuOwogICAgICAgICAgICAgICAgZWxzZSByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMuX2lucHV0ID09PSAiIikgewogICAgICAgICAgICByZXR1cm4gdGhpcy5FT0Y7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5wYXJzZUVycm9yKCdMZXhpY2FsIGVycm9yIG9uIGxpbmUgJysodGhpcy55eWxpbmVubysxKSsnLiBVbnJlY29nbml6ZWQgdGV4dC5cbicrdGhpcy5zaG93UG9zaXRpb24oKSwgCiAgICAgICAgICAgICAgICAgICAge3RleHQ6ICIiLCB0b2tlbjogbnVsbCwgbGluZTogdGhpcy55eWxpbmVub30pOwogICAgICAgIH0KICAgIH0sCmxleDpmdW5jdGlvbiBsZXgoKSB7CiAgICAgICAgdmFyIHIgPSB0aGlzLm5leHQoKTsKICAgICAgICBpZiAodHlwZW9mIHIgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgIHJldHVybiByOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmxleCgpOwogICAgICAgIH0KICAgIH0sCmJlZ2luOmZ1bmN0aW9uIGJlZ2luKGNvbmRpdGlvbikgewogICAgICAgIHRoaXMuY29uZGl0aW9uU3RhY2sucHVzaChjb25kaXRpb24pOwogICAgfSwKcG9wU3RhdGU6ZnVuY3Rpb24gcG9wU3RhdGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY29uZGl0aW9uU3RhY2sucG9wKCk7CiAgICB9LApfY3VycmVudFJ1bGVzOmZ1bmN0aW9uIF9jdXJyZW50UnVsZXMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY29uZGl0aW9uc1t0aGlzLmNvbmRpdGlvblN0YWNrW3RoaXMuY29uZGl0aW9uU3RhY2subGVuZ3RoLTFdXS5ydWxlczsKICAgIH0sCnRvcFN0YXRlOmZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gdGhpcy5jb25kaXRpb25TdGFja1t0aGlzLmNvbmRpdGlvblN0YWNrLmxlbmd0aC0yXTsKICAgIH0sCnB1c2hTdGF0ZTpmdW5jdGlvbiBiZWdpbihjb25kaXRpb24pIHsKICAgICAgICB0aGlzLmJlZ2luKGNvbmRpdGlvbik7CiAgICB9fSk7CmxleGVyLnBlcmZvcm1BY3Rpb24gPSBmdW5jdGlvbiBhbm9ueW1vdXMoeXkseXlfLCRhdm9pZGluZ19uYW1lX2NvbGxpc2lvbnMsWVlfU1RBUlQpIHsKCnZhciBZWVNUQVRFPVlZX1NUQVJUOwpzd2l0Y2goJGF2b2lkaW5nX25hbWVfY29sbGlzaW9ucykgewpjYXNlIDA6Lyogc2tpcCB3aGl0ZXNwYWNlICovCmJyZWFrOwpjYXNlIDE6cmV0dXJuIDIwCmJyZWFrOwpjYXNlIDI6cmV0dXJuIDE5CmJyZWFrOwpjYXNlIDM6cmV0dXJuIDgKYnJlYWs7CmNhc2UgNDpyZXR1cm4gOQpicmVhazsKY2FzZSA1OnJldHVybiA2CmJyZWFrOwpjYXNlIDY6cmV0dXJuIDcKYnJlYWs7CmNhc2UgNzpyZXR1cm4gMTEKYnJlYWs7CmNhc2UgODpyZXR1cm4gMTMKYnJlYWs7CmNhc2UgOTpyZXR1cm4gMTAKYnJlYWs7CmNhc2UgMTA6cmV0dXJuIDEyCmJyZWFrOwpjYXNlIDExOnJldHVybiAxNApicmVhazsKY2FzZSAxMjpyZXR1cm4gMTUKYnJlYWs7CmNhc2UgMTM6cmV0dXJuIDE2CmJyZWFrOwpjYXNlIDE0OnJldHVybiAxNwpicmVhazsKY2FzZSAxNTpyZXR1cm4gMTgKYnJlYWs7CmNhc2UgMTY6cmV0dXJuIDUKYnJlYWs7CmNhc2UgMTc6cmV0dXJuICdJTlZBTElEJwpicmVhazsKfQp9OwpsZXhlci5ydWxlcyA9IFsvXlxzKy8sL15bMC05XSsoXC5bMC05XSspP1xiLywvXm5cYi8sL15cfFx8LywvXiYmLywvXlw/LywvXjovLC9ePD0vLC9ePj0vLC9ePC8sL14+LywvXiE9LywvXj09LywvXiUvLC9eXCgvLC9eXCkvLC9eJC8sL14uL107CmxleGVyLmNvbmRpdGlvbnMgPSB7IklOSVRJQUwiOnsicnVsZXMiOlswLDEsMiwzLDQsNSw2LDcsOCw5LDEwLDExLDEyLDEzLDE0LDE1LDE2LDE3XSwiaW5jbHVzaXZlIjp0cnVlfX07cmV0dXJuIGxleGVyO30pKCkKcGFyc2VyLmxleGVyID0gbGV4ZXI7CnJldHVybiBwYXJzZXI7Cn0pKCk7Ci8vIEVuZCBwYXJzZXIKCiAgLy8gSGFuZGxlIG5vZGUsIGFtZCwgYW5kIGdsb2JhbCBzeXN0ZW1zCiAgaWYgKHR5cGVvZiBleHBvcnRzICE9PSAndW5kZWZpbmVkJykgewogICAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnICYmIG1vZHVsZS5leHBvcnRzKSB7CiAgICAgIGV4cG9ydHMgPSBtb2R1bGUuZXhwb3J0cyA9IEplZDsKICAgIH0KICAgIGV4cG9ydHMuSmVkID0gSmVkOwogIH0KICBlbHNlIHsKICAgIGlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHsKICAgICAgZGVmaW5lKCdqZWQnLCBbXSxmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gSmVkOwogICAgICB9KTsKICAgIH0KICAgIC8vIExlYWsgYSBnbG9iYWwgcmVnYXJkbGVzcyBvZiBtb2R1bGUgc3lzdGVtCiAgICByb290WydKZWQnXSA9IEplZDsKICB9Cgp9KSh0aGlzKTsKCihmdW5jdGlvbiAocm9vdCwgZmFjdG9yeSkgewogICAgdmFyIHRyYW5zbGF0aW9ucyA9IHsKICAgICAgICAiZG9tYWluIjogImNvbnZlcnNlIiwKICAgICAgICAibG9jYWxlX2RhdGEiOiB7CiAgICAgICAgICAgICJjb252ZXJzZSI6IHsKICAgICAgICAgICAgICAgICIiOiB7CiAgICAgICAgICAgICAgICAgICAgIlByb2plY3QtSWQtVmVyc2lvbiI6ICJDb252ZXJzZS5qcyAwLjQiLAogICAgICAgICAgICAgICAgICAgICJSZXBvcnQtTXNnaWQtQnVncy1UbyI6ICIiLAogICAgICAgICAgICAgICAgICAgICJQT1QtQ3JlYXRpb24tRGF0ZSI6ICIyMDEzLTA5LTE1IDIxOjU1KzAyMDAiLAogICAgICAgICAgICAgICAgICAgICJQTy1SZXZpc2lvbi1EYXRlIjogIjIwMTMtMDktMTUgMjE6NTYrMDIwMCIsCiAgICAgICAgICAgICAgICAgICAgIkxhc3QtVHJhbnNsYXRvciI6ICJKQyBCcmFuZCA8amNAb3Brb2RlLmNvbT4iLAogICAgICAgICAgICAgICAgICAgICJMYW5ndWFnZS1UZWFtIjogIkFmcmlrYWFucyIsCiAgICAgICAgICAgICAgICAgICAgIkxhbmd1YWdlIjogImFmIiwKICAgICAgICAgICAgICAgICAgICAiTUlNRS1WZXJzaW9uIjogIjEuMCIsCiAgICAgICAgICAgICAgICAgICAgIkNvbnRlbnQtVHlwZSI6ICJ0ZXh0L3BsYWluOyBjaGFyc2V0PVVURi04IiwKICAgICAgICAgICAgICAgICAgICAiQ29udGVudC1UcmFuc2Zlci1FbmNvZGluZyI6ICI4Yml0IiwKICAgICAgICAgICAgICAgICAgICAiZG9tYWluIjogImNvbnZlcnNlIiwKICAgICAgICAgICAgICAgICAgICAibGFuZyI6ICJhZiIsCiAgICAgICAgICAgICAgICAgICAgInBsdXJhbF9mb3JtcyI6ICJucGx1cmFscz0yOyBwbHVyYWw9KG4gIT0gMSk7IgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJ1bmVuY3J5cHRlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJuaWUtcHJpdmFhdCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAidW52ZXJpZmllZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJvbmdldmVyaWZpZWVyIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJ2ZXJpZmllZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJwcml2YWF0IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJmaW5pc2hlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJhZmdlc2x1aXQiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkRpc2Nvbm5lY3RlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJWZXJiaW5kdW5nIG9uZGVyYnJlZWsiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkVycm9yIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkZvdXQiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNvbm5lY3RpbmciOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVmVyYmluZCB0YW5zIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb25uZWN0aW9uIEZhaWxlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJWZXJiaW5kaW5nIGhldCBnZWZhYWwiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkF1dGhlbnRpY2F0aW5nIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkJlc2lnIG9tIHRlIGJla3JhZ3RpZyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQXV0aGVudGljYXRpb24gRmFpbGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkJla3JhZ3RpZ2luZyBoZXQgZ2VmYWFsIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJEaXNjb25uZWN0aW5nIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk9uZGVyYnJlZWsgdmVyYmluZGluZyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUmUtZXN0YWJsaXNoaW5nIGVuY3J5cHRlZCBzZXNzaW9uIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkhlcnN0ZWwgdmVyc2xldXRlbGRlIHNlc3NpZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBicm93c2VyIG5lZWRzIHRvIGdlbmVyYXRlIGEgcHJpdmF0ZSBrZXksIHdoaWNoIHdpbGwgYmUgdXNlZCBpbiB5b3VyIGVuY3J5cHRlZCBjaGF0IHNlc3Npb24uIFRoaXMgY2FuIHRha2UgdXAgdG8gMzAgc2Vjb25kcyBkdXJpbmcgd2hpY2ggeW91ciBicm93c2VyIG1pZ2h0IGZyZWV6ZSBhbmQgYmVjb21lIHVucmVzcG9uc2l2ZS4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRGllIHdlYmJsYWFpZXIgbW9ldCAnbiBwcml2YXRlIHNsZXV0ZWwgdmlyIGRpZSB2ZXJzbGV1dGVsZGUga2xldHMtc2Vzc2llIGdlbmVyZWVyLiBEaXQga2FuIHRvdCAzMCBzZWtvbmRlcyBkdXVyLCB3YWFydHlkZW7RlSBkaWUgd2ViYmxhYWllciBtYWcgdnJpZXMgZW4gbmllIHJlYWdlZXIgbmllLiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUHJpdmF0ZSBrZXkgZ2VuZXJhdGVkLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJQcml2YXRlIHNsZXV0ZWwiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkF1dGhlbnRpY2F0aW9uIHJlcXVlc3QgZnJvbSAlMSRzXG5cbllvdXIgYnVkZHkgaXMgYXR0ZW1wdGluZyB0byB2ZXJpZnkgeW91ciBpZGVudGl0eSwgYnkgYXNraW5nIHlvdSB0aGUgcXVlc3Rpb24gYmVsb3cuXG5cbiUyJHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVmVyaWZpa2FzaWUgdmVyc29layB2YW4gICUxJHNcblxuVSBnZXNwcmVrc21hYXQgcHJvYmVlciBvbSB1IGlkZW50aXRlaXQgdGUgdmVyaWZpZWVyLCBkZXVyIGRpZSB2b2xnZW5kZSB2cmFhZyB0ZSB2cmEgXG5cbiUyJHMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNvdWxkIG5vdCB2ZXJpZnkgdGhpcyB1c2VyJ3MgaWRlbnRpZnkuIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIktvbiBuaWUgaGllcmRpZSBnZWJydWlrZXIgc2UgaWRlbnRpdGllZCB2ZXJpZmllZXIgbmllLiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUGVyc29uYWwgbWVzc2FnZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJQZXJzb29ubGlrZSBib29kc2thcCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU3RhcnQgZW5jcnlwdGVkIGNvbnZlcnNhdGlvbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJCZWdpbiB2ZXJzbGV1dGVsZGUgZ2VzcHJlayIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUmVmcmVzaCBlbmNyeXB0ZWQgY29udmVyc2F0aW9uIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlZlcmZyaXMgdmVyc2xldXRlbGRlIGdlc3ByZWsiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkVuZCBlbmNyeXB0ZWQgY29udmVyc2F0aW9uIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkJlw6tpbmRpZyB2ZXJzbGV1dGVsZGUgZ2VzcHJlayIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVmVyaWZ5IHdpdGggU01QIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlZlcmlmaWVlciBtZXQgU01QIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJWZXJpZnkgd2l0aCBmaW5nZXJwcmludHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVmVyaWZpZWVyIG1ldCB2aW5nZXJhZmRydWtrZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiV2hhdCdzIHRoaXM/IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIldhdCBpcyBoaWVyZGllPyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAibWUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiZWsiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNob3cgdGhpcyBtZW51IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlZlcnRvb24gaGllcmRpZSBrZXVzZWx5cyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiV3JpdGUgaW4gdGhlIHRoaXJkIHBlcnNvbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTa3J5ZiBpbiBkaWUgZGVyZGUgcGVyc29vbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUmVtb3ZlIG1lc3NhZ2VzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlZlcnd5ZGVyIGJvb2Rza2FwcGUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgbWVzc2FnZSBjb3VsZCBub3QgYmUgc2VudCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJVIGJvb2Rza2FwIGtvbiBuaWUgZ2VzdHV1ciB3b3JkIG5pZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiV2UgcmVjZWl2ZWQgYW4gdW5lbmNyeXB0ZWQgbWVzc2FnZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJPbnMgaGV0ICduIG9udmVyc2xldXRlbGRlIGJvb2Rza2FwIG9udHZhbmciCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIldlIHJlY2VpdmVkIGFuIHVucmVhZGFibGUgZW5jcnlwdGVkIG1lc3NhZ2UiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiT25zIGhldCAnbiBvbmxlZXNiYXJlIHZlcnNsZXV0ZWxkZSBib29kc2thcCBvbnR2YW5nIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHVzZXIgaGFzIHJlcXVlc3RlZCBhbiBlbmNyeXB0ZWQgc2Vzc2lvbi4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSGllcmRpZSBnZWJydWlrZXIgdmVyc29layAnbiB2ZXJzbGV1dGVsZGUgc2Vzc2llIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJIZXJlIGFyZSB0aGUgZmluZ2VycHJpbnRzLCBwbGVhc2UgY29uZmlybSB0aGVtIHdpdGggJTEkcywgb3V0c2lkZSBvZiB0aGlzIGNoYXQuXG5cbkZpbmdlcnByaW50IGZvciB5b3UsICUyJHM6ICUzJHNcblxuRmluZ2VycHJpbnQgZm9yICUxJHM6ICU0JHNcblxuSWYgeW91IGhhdmUgY29uZmlybWVkIHRoYXQgdGhlIGZpbmdlcnByaW50cyBtYXRjaCwgY2xpY2sgT0ssIG90aGVyd2lzZSBjbGljayBDYW5jZWwuIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkhpZXIgaXMgZGllIHZpbmdlcmFmZHJ1a2tlLCBiZXZlc3RpZyBodWxsZSBtZXQgJTEkcywgYnVpdGUgaGllcmRpZSBrbGV0c2thbmFhbCBcblxuVSB2aW5nZXJhZmRydWssICUyJHM6ICUzJHNcblxuVmluZ2VyYWZkcnVrIHZpciAlMSRzOiAlNCRzXG5cbkluZGllbiB1IGRpZSB2aW5nZXJhZmRydWtrZSBiZXZlc3RpZyBoZXQsIGtsaWsgT0ssIGFuZGVyc2luZHMga2xpayBLYW5zZWxsZWVyIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3Ugd2lsbCBiZSBwcm9tcHRlZCB0byBwcm92aWRlIGEgc2VjdXJpdHkgcXVlc3Rpb24gYW5kIHRoZW4gYW4gYW5zd2VyIHRvIHRoYXQgcXVlc3Rpb24uXG5cbllvdXIgYnVkZHkgd2lsbCB0aGVuIGJlIHByb21wdGVkIHRoZSBzYW1lIHF1ZXN0aW9uIGFuZCBpZiB0aGV5IHR5cGUgdGhlIGV4YWN0IHNhbWUgYW5zd2VyIChjYXNlIHNlbnNpdGl2ZSksIHRoZWlyIGlkZW50aXR5IHdpbGwgaGF2ZSBiZWVuIHZlcmlmaWVkLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJEYWFyIHNhbCB2YW4gdSB2ZXJ3YWcgd29yZCBvbSAnbiBzZWt1cml0ZWl0c3ZyYWFnIHRlIHN0ZWwsIGVuIGRhbiBvb2sgZGllIGFudHdvb3JkIHRvdCBkYWFyZGllIHZyYWFnIHRlIHZlcnNrYWYuXG5cblUgZ2VzcHJla3NtYWF0IHNhbCBkYW4gZGFhcmRpZSB2cmFhZyBnZXN0ZWwgd29yZCwgZW4gaW5kaWVuIGh1bGxlIHByZXNpZXMgZGllc2VsZmRlIGFudHdvb3JkIChob29mbGV0dGVycyB0ZWwpIHZlcnNrYWYsIHNhbCBodWwgaWRlbnRpdGVpdCBnZXZlcmlmaWVlciB3ZWVzLiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiV2hhdCBpcyB5b3VyIHNlY3VyaXR5IHF1ZXN0aW9uPyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJXYXQgaXMgdSBzZWt1cml0ZWl0c3ZyYWFnPyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiV2hhdCBpcyB0aGUgYW5zd2VyIHRvIHRoZSBzZWN1cml0eSBxdWVzdGlvbj8iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiV2F0IGlzIGRpZSBhbnR3b29yZCB0b3QgZGllIHNla3VyaXRlaXRzdnJhYWc/IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJJbnZhbGlkIGF1dGhlbnRpY2F0aW9uIHNjaGVtZSBwcm92aWRlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJPbmdlbGRpZ2UgdmVyaWZpa2FzaWVtZXRvZGUgdmVyc2thZiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBtZXNzYWdlcyBhcmUgbm90IGVuY3J5cHRlZCBhbnltb3JlIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlUgYm9vZHNrYXBwZSBpcyBuaWUgbWVlciB2ZXJzbGV1dGVsIG5pZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBtZXNzYWdlcyBhcmUgbm93IGVuY3J5cHRlZCBidXQgeW91ciBidWRkeSdzIGlkZW50aXR5IGhhcyBub3QgYmVlbiB2ZXJpZmllZC4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVSBib29kc2thcHBlIGlzIG5vdyB2ZXJzbGV1dGVsIG1hYXIgdSBnZXNwcmVrc21hYXQgc2UgaWRlbnRpdGVpdCBpcyBub2cgb25zZWtlci4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgYnVkZHkncyBpZGVudGlmeSBoYXMgYmVlbiB2ZXJpZmllZC4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVSBnZXNwcmVrc21hYXQgc2UgaWRlbnRpdGVpdCBpcyBnZXZlcmlmaWVlci4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgYnVkZHkgaGFzIGVuZGVkIGVuY3J5cHRpb24gb24gdGhlaXIgZW5kLCB5b3Ugc2hvdWxkIGRvIHRoZSBzYW1lLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJVIGdlc3ByZWtzbWFhdCBoZXQgdmVyc2xldXRlbGluZyBnZXN0YWFrLCB1IGJlaG9vcnQgbm91IGRpZXNlbGZkZSB0ZSBkb2VuLiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBtZXNzYWdlcyBhcmUgbm90IGVuY3J5cHRlZC4gQ2xpY2sgaGVyZSB0byBlbmFibGUgT1RSIGVuY3J5cHRpb24uIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlUgYm9vZHNrYXBwZSBpcyBuaWUgdmVyc2xldXRlbCBuaWUuIEtsaWsgaGllciBvbSBPVFIgdmVyc2xldXRlbGluZyB0ZSBha3RpdmVlci4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgbWVzc2FnZXMgYXJlIGVuY3J5cHRlZCwgYnV0IHlvdXIgYnVkZHkgaGFzIG5vdCBiZWVuIHZlcmlmaWVkLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJVIGJvb2Rza2FwcGUgaXMgdmVyc2xldXRlbCwgbWFhciB1IGdlc3ByZWtzbWFhdCBzZSBpZGVudGl0ZWl0IGlzIG5vdCBvbnNla2VyLiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBtZXNzYWdlcyBhcmUgZW5jcnlwdGVkIGFuZCB5b3VyIGJ1ZGR5IHZlcmlmaWVkLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJVIGJvb2Rza2FwcGUgaXMgdmVyc2xldXRlbCBlbiB1IGdlc3ByZWtzbWFhdCBzZSBpZGVudGl0ZWl0IGdldmVyaWZpZWVyLiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBidWRkeSBoYXMgY2xvc2VkIHRoZWlyIGVuZCBvZiB0aGUgcHJpdmF0ZSBzZXNzaW9uLCB5b3Ugc2hvdWxkIGRvIHRoZSBzYW1lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlUgZ2VzcHJla3NtYWF0IGhldCBkaWUgcHJpdmF0ZSBzZXNzaWUgZ2VzdGFhay4gVSBiZWhvb3J0IGRpZXNlbGZkZSB0ZSBkb2VuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb250YWN0cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJLb250YWt0ZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiT25saW5lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkFhbmdlbWVsZCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQnVzeSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJCZXNpZyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQXdheSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJBZndlc2lnIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJPZmZsaW5lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkFmZ2VtZWxkIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDbGljayB0byBhZGQgbmV3IGNoYXQgY29udGFjdHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiS2xpZWsgb20gbnV3ZSBrbGV0c2tvbnRha3RlIGJ5IHRlIHZvZWciCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkFkZCBhIGNvbnRhY3QiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVm9lZyAnbiBrb250YWsgYnkiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNvbnRhY3QgdXNlcm5hbWUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiS29uYWsgZ2VicnVpa2Vyc25hYW0iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkFkZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJWb2VnIGJ5IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb250YWN0IG5hbWUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiS29udGFrbmFhbSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU2VhcmNoIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlNvZWsiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk5vIHVzZXJzIGZvdW5kIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkdlZW4gZ2VicnVpa2VycyBnZXZpbmQiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNsaWNrIHRvIGFkZCBhcyBhIGNoYXQgY29udGFjdCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJLbGllayBvbSBhcyBrbGV0c2tvbnRhayBieSB0ZSB2b2VnIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDbGljayB0byBvcGVuIHRoaXMgcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJLbGllayBvbSBoaWVyZGllIGtsZXRza2FtZXIgdGUgb3BlbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU2hvdyBtb3JlIGluZm9ybWF0aW9uIG9uIHRoaXMgcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJXeXMgbWVlciBpbmxpZ3RpbmcgYWFuZ2FhbmRlIGhpZXJkaWUga2xldHNrYW1lciIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiRGVzY3JpcHRpb246IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkJlc2tyeXdpbmc6IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJPY2N1cGFudHM6IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkRlZWxuZW1lcnM6IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJGZWF0dXJlczoiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRWllbnNrYXBwZToiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJlcXVpcmVzIGF1dGhlbnRpY2F0aW9uIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkJlbm9kaWcgbWFndGlnaW5nIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJIaWRkZW4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVmVyc2t1aWwiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJlcXVpcmVzIGFuIGludml0YXRpb24iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQmVub2RpZyAnbiB1aXRub2RpZ2luZyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTW9kZXJhdGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkdlbW9kZXJlZXIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk5vbi1hbm9ueW1vdXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTmllLWFub25pZW0iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk9wZW4gcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJPb3Aga2xldHNrYW1lciIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUGVybWFuZW50IHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiUGVybWFuZW50ZSBrYW1lciIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUHVibGljIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlB1YmxpZWsiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNlbWktYW5vbnltb3VzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkRlZWxzIGFub25pZW0iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRlbXBvcmFyeSByb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlR5ZGVsaWtlIGthbWVyIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJVbm1vZGVyYXRlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJPbmdlbW9kZXJlZXIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJvb21zIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkthbWVycyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUm9vbSBuYW1lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkthbWVyIG5hYW0iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk5pY2tuYW1lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkJ5bmFhbSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU2VydmVyIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkJlZGllbmVyIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJKb2luIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlNsdWl0IGFhbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU2hvdyByb29tcyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJXeXMga2FtZXJzIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJObyByb29tcyBvbiAlMSRzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkdlZW4ga2FtZXJzIG9wICUxJHMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJvb21zIG9uICUxJHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiS2FtZXJzIG9wICUxJHMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNldCBjaGF0cm9vbSB0b3BpYyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTdGVsIGtsZXRza2FtZXIgb25kZXJ3ZXJwIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJLaWNrIHVzZXIgZnJvbSBjaGF0cm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTa29wIGdlYnJ1aWtlciB1aXQgZGllIGtsZXRza2FtZXIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkJhbiB1c2VyIGZyb20gY2hhdHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVmVyYmFuIGdlYnJ1aWtlciB2YW51aXQgZGllIGtsZXRza2FtZXIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk1lc3NhZ2UiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQm9vZHNrYXAiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNhdmUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU3Rvb3IiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNhbmNlbCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJLYW5zZWxlZXIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkFuIGVycm9yIG9jY3VycmVkIHdoaWxlIHRyeWluZyB0byBzYXZlIHRoZSBmb3JtLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJBIGZvdXQgaGV0IHZvb3JnZWtvbSB0ZXJ3eWwgcHJvYmVlciBpcyBvbSBkaWUgdm9ybSB0ZSBzdG9vci4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgY2hhdHJvb20gcmVxdWlyZXMgYSBwYXNzd29yZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJIaWVkaWUga2xldHNrYW1lciBiZW5vZGlnICduIHdhZ3dvb3JkIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJQYXNzd29yZDogIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIldhZ3dvb3JkOiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU3VibWl0IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkRpZW4gaW4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBpcyBub3QgYW5vbnltb3VzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkhpZXJkaWUgdmVydHJlayBpcyBuaWUgYW5vbmllbSBuaWUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBub3cgc2hvd3MgdW5hdmFpbGFibGUgbWVtYmVycyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJIaWVyZGllIHZlcnRyZWsgd3lzIG5vdSBvbmJlc2tpa2JhcmUgbGVkZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyByb29tIGRvZXMgbm90IHNob3cgdW5hdmFpbGFibGUgbWVtYmVycyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJIaWVyZGllIHZlcnRyZWsgd3lzIG5pZSBvbmJlc2tpa2JhcmUgbGVkZSBuaWUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk5vbi1wcml2YWN5LXJlbGF0ZWQgcm9vbSBjb25maWd1cmF0aW9uIGhhcyBjaGFuZ2VkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk5pZS1wcml2YWF0aGVpZHZlcndhbnRlIGthbWVyIGluc3RlbGxpbmdzIGhldCB2ZXJhbmRlciIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUm9vbSBsb2dnaW5nIGlzIG5vdyBlbmFibGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkthbWVyIGxvZyBpcyBub3UgYWFuZ2Vza2FrZWwiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJvb20gbG9nZ2luZyBpcyBub3cgZGlzYWJsZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiS2FtZXIgbG9nIGlzIG5vdSBhZmdlc2tha2VsIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gaXMgbm93IG5vbi1hbm9ueW1vdXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSGllZGllIGthbWVyIGlzIG5vdSBuaWUgYW5vbmllbSBuaWUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBpcyBub3cgc2VtaS1hbm9ueW1vdXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSGllcmRpZSBrYW1lciBpcyBub3UgZ2VkZWVsdGVsaWsgYW5vbmllbSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyByb29tIGlzIG5vdyBmdWxseS1hbm9ueW1vdXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSGllcmRpZSBrYW1lciBpcyBub3UgdGVuIHZvbGxlIGFub25pZW0iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkEgbmV3IHJvb20gaGFzIGJlZW4gY3JlYXRlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICInbiBOdXdlIGthbWVyIGlzIGdlc2tlcCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBuaWNrbmFtZSBoYXMgYmVlbiBjaGFuZ2VkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkpvdSBieW5hYW0gaXMgdmVyYW5kZXIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIjxzdHJvbmc+JTEkczwvc3Ryb25nPiBoYXMgYmVlbiBiYW5uZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IGlzIHZlcmJhbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IGhhcyBiZWVuIGtpY2tlZCBvdXQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IGlzIHVpdGdlc2tvcCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IGhhcyBiZWVuIHJlbW92ZWQgYmVjYXVzZSBvZiBhbiBhZmZpbGlhdGlvbiBjaGFuZ2UiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IGlzIHZlcnd5ZGVyIGEuZy52ICduIHZlcmFuZGVyaW5nIHZhbiBhZmZpbGlhc2llIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gaGFzIGJlZW4gcmVtb3ZlZCBmb3Igbm90IGJlaW5nIGEgbWVtYmVyIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIjxzdHJvbmc+JTEkczwvc3Ryb25nPiBpcyBuaWUgJ24gbGlkIG5pZSwgZW4gZHVzIHZlcnd5ZGVyIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3UgaGF2ZSBiZWVuIGJhbm5lZCBmcm9tIHRoaXMgcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJKeSBpcyB1aXQgZGllIGthbWVyIHZlcmJhbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91IGhhdmUgYmVlbiBraWNrZWQgZnJvbSB0aGlzIHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSnkgaXMgdWl0IGRpZSBrYW1lciBnZXNrb3AiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdSBoYXZlIGJlZW4gcmVtb3ZlZCBmcm9tIHRoaXMgcm9vbSBiZWNhdXNlIG9mIGFuIGFmZmlsaWF0aW9uIGNoYW5nZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJKeSBpcyB2YW51aXQgZGllIGthbWVyIHZlcnd5ZGVyIGEuZy52ICduIHZlcmFuZGVyaW5nIHZhbiBhZmZpbGlhc2llIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3UgaGF2ZSBiZWVuIHJlbW92ZWQgZnJvbSB0aGlzIHJvb20gYmVjYXVzZSB0aGUgcm9vbSBoYXMgY2hhbmdlZCB0byBtZW1iZXJzLW9ubHkgYW5kIHlvdSdyZSBub3QgYSBtZW1iZXIiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSnkgaXMgdmFudWl0IGRpZSBrYW1lciB2ZXJ3eWRlciBvbWRhdCBkaWUga2FtZXIgbm91IHNsZWdzIHRvdCBsZWRlIGJlcGVyayB3b3JkIGVuIGp5IG5pZSAnbiBsaWQgaXMgbmllLiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91IGhhdmUgYmVlbiByZW1vdmVkIGZyb20gdGhpcyByb29tIGJlY2F1c2UgdGhlIE1VQyAoTXVsdGktdXNlciBjaGF0KSBzZXJ2aWNlIGlzIGJlaW5nIHNodXQgZG93bi4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSnkgaXMgdmFuIGhpZXJkaWUga2FtZXIgdmVyd3lkZXIgYWFuZ2VzaWVuIGRpZSBNVUMgKE11bHRpLXVzZXIgY2hhdCkgZGllbnMgbm91IGFmZ2Vza2FrZWwgd29yZC4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdSBhcmUgbm90IG9uIHRoZSBtZW1iZXIgbGlzdCBvZiB0aGlzIHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSnkgaXMgbmllIG9wIGRpZSBsZWRlbHlzIHZhbiBoaWVyZGllIGthbWVyIG5pZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTm8gbmlja25hbWUgd2FzIHNwZWNpZmllZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJHZWVuIGJ5bmFhbSB2ZXJza2FmIG5pZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91IGFyZSBub3QgYWxsb3dlZCB0byBjcmVhdGUgbmV3IHJvb21zIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkp5IHdvcmQgbmllIHRvZWdlbGFhdCBvbSBub2cga2FtZXJzIHRlIHNrZXAgbmllIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG5pY2tuYW1lIGRvZXNuJ3QgY29uZm9ybSB0byB0aGlzIHJvb20ncyBwb2xpY2llcyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJKb3UgYnluYWFtIHZvbGRvZW4gbmllIGFhbiBkaWUga2FtZXIgc2UgYmVsZWlkIG5pZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBuaWNrbmFtZSBpcyBhbHJlYWR5IHRha2VuIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkpvdSBieW5hYW0gaXMgcmVlZHMgZ2VuZWVtIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gZG9lcyBub3QgKHlldCkgZXhpc3QiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSGllcmRpZSBrYW1lciBiZXN0YWFuIHRhbnMgKG5vZykgbmllIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gaGFzIHJlYWNoZWQgaXQncyBtYXhpbXVtIG51bWJlciBvZiBvY2N1cGFudHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSGllcmRpZSBrYW1lciBoZXQgc3kgbWFrc2ltdW0gYWFudGFsIGRlZWxuZW1lcnMgYmVyZWlrIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUb3BpYyBzZXQgYnkgJTEkcyB0bzogJTIkcyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJPbmRlcndlcnAgZGV1ciAlMSRzIGJ5Z2V3ZXJrIG5hOiAlMiRzIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHVzZXIgaXMgYSBtb2RlcmF0b3IiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSGllcmRpZSBnZWJydWlrZXIgaXMgJ24gbW9kZXJhdG9yIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHVzZXIgY2FuIHNlbmQgbWVzc2FnZXMgaW4gdGhpcyByb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkhpZXJkaWUgZ2VicnVpa2VyIGthbiBib29kc2thcHBlIG5hIGRpZSBrYW1lciBzdHV1ciIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyB1c2VyIGNhbiBOT1Qgc2VuZCBtZXNzYWdlcyBpbiB0aGlzIHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSGllcmRpZSBnZWJydWlrZXIga2FuIE5JRSBib29kc2thcHBlIG5hIGRpZSBrYW1lciBzdHV1ciBuaWUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNsaWNrIHRvIGNoYXQgd2l0aCB0aGlzIGNvbnRhY3QiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiS2xpZWsgb20gbWV0IGhpZXJkaWUga29udGFrIHRlIGtsZXRzIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDbGljayB0byByZW1vdmUgdGhpcyBjb250YWN0IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIktsaWVrIG9tIGhpZXJkaWUga29udGFrIHRlIHZlcnd5ZGVyIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIGNvbnRhY3QgaXMgYnVzeSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJIaWVyZGllIHBlcnNvb24gaXMgYmVzaWciCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgY29udGFjdCBpcyBvbmxpbmUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSGllcmRpZSBwZXJzb29uIGlzIGFhbmx5biIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyBjb250YWN0IGlzIG9mZmxpbmUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSGllcmRpZSBwZXJzb29uIGlzIGFmbHluIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIGNvbnRhY3QgaXMgdW5hdmFpbGFibGUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSGllcmRpZSBwZXJzb29uIGlzIG9uYmVza2lrYmFhciIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyBjb250YWN0IGlzIGF3YXkgZm9yIGFuIGV4dGVuZGVkIHBlcmlvZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJIaWVyZGllIHBlcnNvb24gaXMgdmlyIGxhbmsgYWZ3ZXNpZyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyBjb250YWN0IGlzIGF3YXkiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSGllcmRpZSBwZXJzb29uIGlzIGFmd2VzaWciCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNvbnRhY3QgcmVxdWVzdHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiS29udGFrIHZlcnNvZWtlIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJNeSBjb250YWN0cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJNeSBrb250YWt0ZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUGVuZGluZyBjb250YWN0cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJIYW5nZW5kZSBrb250YWt0ZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ3VzdG9tIHN0YXR1cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJEb2VsZ2VtYWFrdGUgc3RhdHVzIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDbGljayB0byBjaGFuZ2UgeW91ciBjaGF0IHN0YXR1cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJLbGllayBvbSBqb3Uga2xldHMtc3RhdHVzIHRlIHZlcmFuZGVyIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDbGljayBoZXJlIHRvIHdyaXRlIGEgY3VzdG9tIHN0YXR1cyBtZXNzYWdlIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIktsaWVrIGhpZXIgb20gam91IGVpZSBzdGF0dXNib29kc2thcCB0ZSBza3J5ZiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAib25saW5lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgImFhbmdlbWVsZCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiYnVzeSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJiZXNpZyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiYXdheSBmb3IgbG9uZyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJ2aXIgbGFuayBhZndlc2lnIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJhd2F5IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgImFmd2VzaWciCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkkgYW0gJTEkcyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJFayBpcyAlMSRzIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTaWduIGluIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlRla2VuIGluIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJYTVBQL0phYmJlciBVc2VybmFtZToiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiWE1QUC9KYWJiZXIgR2VicnVpa2Vyc25hYW06IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJQYXNzd29yZDoiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiV2Fnd29vcmQiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkxvZyBJbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJNZWxkIGFhbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQk9TSCBTZXJ2aWNlIFVSTDoiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQk9TSCBiZWRpZW5lciBVUkwiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk9ubGluZSBDb250YWN0cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJLb250YWt0ZSBhYW5nZW1lbGQiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNvbm5lY3RlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJWZXJiaW5kIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJBdHRhY2hlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJHZWhlZyIKICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7CiAgICAgICAgZGVmaW5lKCJhZiIsIFsnamVkJ10sIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkobmV3IEplZCh0cmFuc2xhdGlvbnMpKTsKICAgICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKCF3aW5kb3cubG9jYWxlcykgewogICAgICAgICAgICB3aW5kb3cubG9jYWxlcyA9IHt9OwogICAgICAgIH0KICAgICAgICB3aW5kb3cubG9jYWxlcy5hZiA9IGZhY3RvcnkobmV3IEplZCh0cmFuc2xhdGlvbnMpKTsKICAgIH0KfSh0aGlzLCBmdW5jdGlvbiAoYWYpIHsgCiAgICByZXR1cm4gYWY7IAp9KSk7CgooZnVuY3Rpb24gKHJvb3QsIGZhY3RvcnkpIHsKICAgIHZhciB0cmFuc2xhdGlvbnMgPSB7CiAgICAgICAgImRvbWFpbiI6ICJjb252ZXJzZSIsCiAgICAgICAgImxvY2FsZV9kYXRhIjogewogICAgICAgICAgICAiY29udmVyc2UiOiB7CiAgICAgICAgICAgICAgICAiIjogewogICAgICAgICAgICAgICAgICAgICJQcm9qZWN0LUlkLVZlcnNpb24iOiAiQ29udmVyc2UuanMgMC40IiwKICAgICAgICAgICAgICAgICAgICAiUmVwb3J0LU1zZ2lkLUJ1Z3MtVG8iOiAiIiwKICAgICAgICAgICAgICAgICAgICAiUE9ULUNyZWF0aW9uLURhdGUiOiAiMjAxMy0wOS0xNSAyMTo1NSswMjAwIiwKICAgICAgICAgICAgICAgICAgICAiUE8tUmV2aXNpb24tRGF0ZSI6ICIyMDEzLTA5LTE1IDIyOjAzKzAyMDAiLAogICAgICAgICAgICAgICAgICAgICJMYXN0LVRyYW5zbGF0b3IiOiAiSkMgQnJhbmQgPGpjQG9wa29kZS5jb20+IiwKICAgICAgICAgICAgICAgICAgICAiTGFuZ3VhZ2UtVGVhbSI6ICJHZXJtYW4iLAogICAgICAgICAgICAgICAgICAgICJMYW5ndWFnZSI6ICJkZSIsCiAgICAgICAgICAgICAgICAgICAgIk1JTUUtVmVyc2lvbiI6ICIxLjAiLAogICAgICAgICAgICAgICAgICAgICJDb250ZW50LVR5cGUiOiAidGV4dC9wbGFpbjsgY2hhcnNldD1VVEYtOCIsCiAgICAgICAgICAgICAgICAgICAgIkNvbnRlbnQtVHJhbnNmZXItRW5jb2RpbmciOiAiOGJpdCIsCiAgICAgICAgICAgICAgICAgICAgIlBsdXJhbC1Gb3JtcyI6ICJucGx1cmFscz0yOyBwbHVyYWw9KG4gIT0gMSk7IiwKICAgICAgICAgICAgICAgICAgICAiZG9tYWluIjogImNvbnZlcnNlIiwKICAgICAgICAgICAgICAgICAgICAibGFuZyI6ICJkZSIsCiAgICAgICAgICAgICAgICAgICAgInBsdXJhbF9mb3JtcyI6ICJucGx1cmFscz0yOyBwbHVyYWw9KG4gIT0gMSk7IgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJ1bmVuY3J5cHRlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgInVudmVyaWZpZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJ2ZXJpZmllZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgImZpbmlzaGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiRGlzY29ubmVjdGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlZlcmJpbmR1bmcgdW50ZXJicm9jaGVuLiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiRXJyb3IiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRmVobGVyIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb25uZWN0aW5nIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlZlcmJpbmR1bmdzYXVmYmF1IOKApiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ29ubmVjdGlvbiBGYWlsZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRW50ZmVybnRlIFZlcmJpbmR1bmcgZmVobGdlc2NobGFnZW4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkF1dGhlbnRpY2F0aW5nIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkF1dGhlbnRpZml6aWVydW5nIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJBdXRoZW50aWNhdGlvbiBGYWlsZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQXV0aGVudGlmaXppZXJ1bmcgZ2VzY2hlaXRlcnQiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkRpc2Nvbm5lY3RpbmciOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVHJlbm5lIFZlcmJpbmR1bmciCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJlLWVzdGFibGlzaGluZyBlbmNyeXB0ZWQgc2Vzc2lvbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgYnJvd3NlciBuZWVkcyB0byBnZW5lcmF0ZSBhIHByaXZhdGUga2V5LCB3aGljaCB3aWxsIGJlIHVzZWQgaW4geW91ciBlbmNyeXB0ZWQgY2hhdCBzZXNzaW9uLiBUaGlzIGNhbiB0YWtlIHVwIHRvIDMwIHNlY29uZHMgZHVyaW5nIHdoaWNoIHlvdXIgYnJvd3NlciBtaWdodCBmcmVlemUgYW5kIGJlY29tZSB1bnJlc3BvbnNpdmUuIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUHJpdmF0ZSBrZXkgZ2VuZXJhdGVkLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkF1dGhlbnRpY2F0aW9uIHJlcXVlc3QgZnJvbSAlMSRzXG5cbllvdXIgYnVkZHkgaXMgYXR0ZW1wdGluZyB0byB2ZXJpZnkgeW91ciBpZGVudGl0eSwgYnkgYXNraW5nIHlvdSB0aGUgcXVlc3Rpb24gYmVsb3cuXG5cbiUyJHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb3VsZCBub3QgdmVyaWZ5IHRoaXMgdXNlcidzIGlkZW50aWZ5LiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlBlcnNvbmFsIG1lc3NhZ2UiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiUGVyc8O2bmxpY2hlIE5hY2hyaWNodCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU3RhcnQgZW5jcnlwdGVkIGNvbnZlcnNhdGlvbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJlZnJlc2ggZW5jcnlwdGVkIGNvbnZlcnNhdGlvbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkVuZCBlbmNyeXB0ZWQgY29udmVyc2F0aW9uIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVmVyaWZ5IHdpdGggU01QIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVmVyaWZ5IHdpdGggZmluZ2VycHJpbnRzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiV2hhdCdzIHRoaXM/IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAibWUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSWNoIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTaG93IHRoaXMgbWVudSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJEaWVzZXMgTWVuw7wgYW56ZWlnZW4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIldyaXRlIGluIHRoZSB0aGlyZCBwZXJzb24iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSW4gZGVyIGRyaXR0ZW4gUGVyc29uIHNjaHJlaWJlbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUmVtb3ZlIG1lc3NhZ2VzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk5hY2hyaWNodGVuIGVudGZlcm5lbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBtZXNzYWdlIGNvdWxkIG5vdCBiZSBzZW50IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiV2UgcmVjZWl2ZWQgYW4gdW5lbmNyeXB0ZWQgbWVzc2FnZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIldlIHJlY2VpdmVkIGFuIHVucmVhZGFibGUgZW5jcnlwdGVkIG1lc3NhZ2UiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHVzZXIgaGFzIHJlcXVlc3RlZCBhbiBlbmNyeXB0ZWQgc2Vzc2lvbi4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJIZXJlIGFyZSB0aGUgZmluZ2VycHJpbnRzLCBwbGVhc2UgY29uZmlybSB0aGVtIHdpdGggJTEkcywgb3V0c2lkZSBvZiB0aGlzIGNoYXQuXG5cbkZpbmdlcnByaW50IGZvciB5b3UsICUyJHM6ICUzJHNcblxuRmluZ2VycHJpbnQgZm9yICUxJHM6ICU0JHNcblxuSWYgeW91IGhhdmUgY29uZmlybWVkIHRoYXQgdGhlIGZpbmdlcnByaW50cyBtYXRjaCwgY2xpY2sgT0ssIG90aGVyd2lzZSBjbGljayBDYW5jZWwuIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91IHdpbGwgYmUgcHJvbXB0ZWQgdG8gcHJvdmlkZSBhIHNlY3VyaXR5IHF1ZXN0aW9uIGFuZCB0aGVuIGFuIGFuc3dlciB0byB0aGF0IHF1ZXN0aW9uLlxuXG5Zb3VyIGJ1ZGR5IHdpbGwgdGhlbiBiZSBwcm9tcHRlZCB0aGUgc2FtZSBxdWVzdGlvbiBhbmQgaWYgdGhleSB0eXBlIHRoZSBleGFjdCBzYW1lIGFuc3dlciAoY2FzZSBzZW5zaXRpdmUpLCB0aGVpciBpZGVudGl0eSB3aWxsIGhhdmUgYmVlbiB2ZXJpZmllZC4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJXaGF0IGlzIHlvdXIgc2VjdXJpdHkgcXVlc3Rpb24/IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiV2hhdCBpcyB0aGUgYW5zd2VyIHRvIHRoZSBzZWN1cml0eSBxdWVzdGlvbj8iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJJbnZhbGlkIGF1dGhlbnRpY2F0aW9uIHNjaGVtZSBwcm92aWRlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgbWVzc2FnZXMgYXJlIG5vdCBlbmNyeXB0ZWQgYW55bW9yZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgbWVzc2FnZXMgYXJlIG5vdyBlbmNyeXB0ZWQgYnV0IHlvdXIgYnVkZHkncyBpZGVudGl0eSBoYXMgbm90IGJlZW4gdmVyaWZpZWQuIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBidWRkeSdzIGlkZW50aWZ5IGhhcyBiZWVuIHZlcmlmaWVkLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgYnVkZHkgaGFzIGVuZGVkIGVuY3J5cHRpb24gb24gdGhlaXIgZW5kLCB5b3Ugc2hvdWxkIGRvIHRoZSBzYW1lLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgbWVzc2FnZXMgYXJlIG5vdCBlbmNyeXB0ZWQuIENsaWNrIGhlcmUgdG8gZW5hYmxlIE9UUiBlbmNyeXB0aW9uLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgbWVzc2FnZXMgYXJlIGVuY3J5cHRlZCwgYnV0IHlvdXIgYnVkZHkgaGFzIG5vdCBiZWVuIHZlcmlmaWVkLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgbWVzc2FnZXMgYXJlIGVuY3J5cHRlZCBhbmQgeW91ciBidWRkeSB2ZXJpZmllZC4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIGJ1ZGR5IGhhcyBjbG9zZWQgdGhlaXIgZW5kIG9mIHRoZSBwcml2YXRlIHNlc3Npb24sIHlvdSBzaG91bGQgZG8gdGhlIHNhbWUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb250YWN0cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJLb250YWt0ZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiT25saW5lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk9ubGluZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQnVzeSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJCZXNjaMOkZnRpY2h0IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJBd2F5IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkFid2VzZW5kIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJPZmZsaW5lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkFiZ2VtZWxkZXQiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNsaWNrIHRvIGFkZCBuZXcgY2hhdCBjb250YWN0cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJLbGlja2VuIFNpZSwgdW0gZWluZW4gbmV1ZW4gS29udGFrdCBoaW56dXp1ZsO8Z2VuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJBZGQgYSBjb250YWN0IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIktvbnRha3RlIGhpbnp1ZsO8Z2VuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb250YWN0IHVzZXJuYW1lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkJlbnV0emVybmFtZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQWRkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkhpbnp1ZsO8Z2VuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb250YWN0IG5hbWUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTmFtZSBkZXMgS29udGFrdHMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNlYXJjaCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTdWNoZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTm8gdXNlcnMgZm91bmQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiS2VpbmUgQmVudXR6ZXIgZ2VmdW5kZW4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNsaWNrIHRvIGFkZCBhcyBhIGNoYXQgY29udGFjdCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJIaWVyIGtsaWNrZW4gdW0gYWxzIEtvbnRha3QgaGluenV6dWbDvGdlbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgdG8gb3BlbiB0aGlzIHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSGllciBrbGlja2VuIHVtIGRpZXNlbiBSYXVtIHp1IMO2ZmZuZW4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNob3cgbW9yZSBpbmZvcm1hdGlvbiBvbiB0aGlzIHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTWVociBJbmZvcm1hdGlvbiDDvGJlciBkaWVzZW4gUmF1bSB6ZWlnZW4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkRlc2NyaXB0aW9uOiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJCZXNjaHJlaWJ1bmciCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk9jY3VwYW50czoiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVGVpbG5laG1lciIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiRmVhdHVyZXM6IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkZ1bmt0aW9uZW46IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSZXF1aXJlcyBhdXRoZW50aWNhdGlvbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJBdXRoZW50aWZpemllcnVuZyBlcmZvcmRlcmxpY2giCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkhpZGRlbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJWZXJzdGVja3QiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJlcXVpcmVzIGFuIGludml0YXRpb24iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRWlubGFkdW5nIGVyZm9yZGVybGljaCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTW9kZXJhdGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk1vZGVyaWVydCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTm9uLWFub255bW91cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJOaWNodCBhbm9ueW0iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk9wZW4gcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJPZmZlbmVyIFJhdW0iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlBlcm1hbmVudCByb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkRhdWVyaGFmdGVyIFJhdW0iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlB1YmxpYyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLDlmZmZW50bGljaCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU2VtaS1hbm9ueW1vdXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVGVpbHMgYW5vbnltIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUZW1wb3Jhcnkgcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJWb3LDvGJlcmdlaGVuZGVyIFJhdW0iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlVubW9kZXJhdGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlVubW9kZXJpZXJ0IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSb29tcyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJSw6R1bWUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJvb20gbmFtZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJSYXVtbmFtZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTmlja25hbWUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU3BpdHpuYW1lIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTZXJ2ZXIiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU2VydmVyIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJKb2luIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkJlaXRyZXRlbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU2hvdyByb29tcyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJSw6R1bWUgYW56ZWlnZW4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk5vIHJvb21zIG9uICUxJHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiS2VpbmUgUsOkdW1lIGF1ZiAlMSRzIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSb29tcyBvbiAlMSRzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlLDpHVtZSBhdWYgJTEkcyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU2V0IGNoYXRyb29tIHRvcGljIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkNoYXRyYXVtIFRoZW1hIGZlc3RsZWdlbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiS2ljayB1c2VyIGZyb20gY2hhdHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiV2VyZmUgZWluZW4gQmVudXR6ZXIgYXVzIGRlbSBSYXVtLiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQmFuIHVzZXIgZnJvbSBjaGF0cm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJWZXJiYW5uZSBlaW5lbiBCZW51dHplciBhdXMgZGVtIFJhdW0uIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJNZXNzYWdlIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk5hY2hyaWNodCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU2F2ZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTcGVpY2hlcm4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNhbmNlbCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJBYmJyZWNoZW4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkFuIGVycm9yIG9jY3VycmVkIHdoaWxlIHRyeWluZyB0byBzYXZlIHRoZSBmb3JtLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJCZWltIFNwZWljaGVybiBkZXIgRm9ybXVsYXIgaXMgZWluIEZlaGxlciBhdWZnZXRyZXRlbi4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgY2hhdHJvb20gcmVxdWlyZXMgYSBwYXNzd29yZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJQYXNzd29ydCB3aXJkIGbDvHIgZGllIEFubWVsZHVuZyBiZW7DtnRpZ3QuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJQYXNzd29yZDogIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlBhc3N3b3J0OiAiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlN1Ym1pdCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJFaW5yZWljaGVuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gaXMgbm90IGFub255bW91cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJEaWVzZXIgUmF1bSBpc3QgbmljaHQgYW5vbnltIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gbm93IHNob3dzIHVuYXZhaWxhYmxlIG1lbWJlcnMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRGllc2VyIFJhdW0gemVpZ3QgamV0enQgdW5mZXJmw7xnYmFyZSBNaXRnbGllZGVyIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gZG9lcyBub3Qgc2hvdyB1bmF2YWlsYWJsZSBtZW1iZXJzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkRpZXNlciBSYXVtIHplaWd0IG5pY2h0IHVudmVyZsO8Z2JhcmUgTWl0Z2xpZWRlciIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTm9uLXByaXZhY3ktcmVsYXRlZCByb29tIGNvbmZpZ3VyYXRpb24gaGFzIGNoYW5nZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRGllIEtvbmZpZ3VyYXRpb24sIGRpZSBuaWNodCBhdWYgZGllIFByaXZhdHNwaMOkcmUgYmV6b2dlbiBpc3QsIGhhdCBzaWNoIGdlw6RuZGVydCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUm9vbSBsb2dnaW5nIGlzIG5vdyBlbmFibGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlp1a8O8bmZ0aWdlIE5hY2hyaWNodGVuIGRpZXNlcyBSYXVtcyB3ZXJkZW4gcHJvdG9rb2xsaWVydC4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJvb20gbG9nZ2luZyBpcyBub3cgZGlzYWJsZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiWnVrw7xuZnRpZ2UgTmFjaHJpY2h0ZW4gZGllc2VzIFJhdW1zIHdlcmRlbiBuaWNodCBwcm90b2tvbGxpZXJ0LiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyByb29tIGlzIG5vdyBub24tYW5vbnltb3VzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkRpZXNlciBSYXVtIGlzdCBqZXR6dCBuaWNodCBhbm9ueW0iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBpcyBub3cgc2VtaS1hbm9ueW1vdXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRGllc2VyIFJhdW0gaXN0IGpldHp0IHRlaWxzIGFub255bSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyByb29tIGlzIG5vdyBmdWxseS1hbm9ueW1vdXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRGllc2VyIFJhdW0gaXN0IGpldHp0IGFub255bSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQSBuZXcgcm9vbSBoYXMgYmVlbiBjcmVhdGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkVpbmVuIG5ldWVuIFJhdW0gaXN0IGVyc3RlbGxlbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBuaWNrbmFtZSBoYXMgYmVlbiBjaGFuZ2VkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlNwaXR6bmFtZSBmZXN0Z2VsZWdlbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IGhhcyBiZWVuIGJhbm5lZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gaXN0IHZlcmJhbm50IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gaGFzIGJlZW4ga2lja2VkIG91dCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gaXN0IGhpbmF1c2dld29yZmVuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gaGFzIGJlZW4gcmVtb3ZlZCBiZWNhdXNlIG9mIGFuIGFmZmlsaWF0aW9uIGNoYW5nZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gd3VyZGUgd2VnZW4gZWluZXIgWnVnZWjDtnJpZ2tlaXRzw6RuZGVydW5nIGVudGZlcm50IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gaGFzIGJlZW4gcmVtb3ZlZCBmb3Igbm90IGJlaW5nIGEgbWVtYmVyIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIjxzdHJvbmc+JTEkczwvc3Ryb25nPiBpc3Qga2VpbiBNaXRnbGllZCB1bmQgd3VyZGUgZGFoZXIgZW50ZmVybnQiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdSBoYXZlIGJlZW4gYmFubmVkIGZyb20gdGhpcyByb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlNpZSBzaW5kIGF1cyBkaWVzZW0gUmF1bSB2ZXJiYW5udCB3b3JkZW4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdSBoYXZlIGJlZW4ga2lja2VkIGZyb20gdGhpcyByb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlNpZSB3dXJkZW4gYXVzIGRpZXNlbSBSYXVtIGhpbmF1c2dld29yZmVuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3UgaGF2ZSBiZWVuIHJlbW92ZWQgZnJvbSB0aGlzIHJvb20gYmVjYXVzZSBvZiBhbiBhZmZpbGlhdGlvbiBjaGFuZ2UiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU2llIHd1cmRlbiB3ZWdlbiBlaW5lciBadWdlaMO2cmlna2VpdHPDpG5kZXJ1bmcgZW50ZmVybnQiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdSBoYXZlIGJlZW4gcmVtb3ZlZCBmcm9tIHRoaXMgcm9vbSBiZWNhdXNlIHRoZSByb29tIGhhcyBjaGFuZ2VkIHRvIG1lbWJlcnMtb25seSBhbmQgeW91J3JlIG5vdCBhIG1lbWJlciI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTaWUgd3VyZGVuIGF1cyBkaWVzZW0gUmF1bSBlbnRmZXJudCBkYSBTaWUga2VpbiBNaXRnbGllZCBzaW5kLiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91IGhhdmUgYmVlbiByZW1vdmVkIGZyb20gdGhpcyByb29tIGJlY2F1c2UgdGhlIE1VQyAoTXVsdGktdXNlciBjaGF0KSBzZXJ2aWNlIGlzIGJlaW5nIHNodXQgZG93bi4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU2llIHdlcmRlbiBhdXMgZGllc2VtIFJhdW0gZW50ZmVybnQgZGEgZGVyIE1VQyAoTXVsaS11c2VyIGNoYXQpIERpZW5zdCBnZXJhZGUgYWJnZXNjaGFsdGVuIHdpcmQuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3UgYXJlIG5vdCBvbiB0aGUgbWVtYmVyIGxpc3Qgb2YgdGhpcyByb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlNpZSBzaW5kIG5pY2h0IGF1ZiBkZXIgTWl0Z2xpZWRlcmxpc3RlIGRpZXNlcyBSYXVtcyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTm8gbmlja25hbWUgd2FzIHNwZWNpZmllZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJLZWluIFNwaXR6bmFtZSBmZXN0Z2VsZWd0IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3UgYXJlIG5vdCBhbGxvd2VkIHRvIGNyZWF0ZSBuZXcgcm9vbXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRXMgaXN0IElobmVuIG5pY2h0IGVybGF1YnQsIG5ldWUgUsOkdW1lIGFuenVsZWdlbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBuaWNrbmFtZSBkb2Vzbid0IGNvbmZvcm0gdG8gdGhpcyByb29tJ3MgcG9saWNpZXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVW5nw7xsdGlnZXIgU3BpdHpuYW1lIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG5pY2tuYW1lIGlzIGFscmVhZHkgdGFrZW4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSWhyZSBTcGl0em5hbWUgZXhpc3RpZXJ0IGJlcmVpdHMuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gZG9lcyBub3QgKHlldCkgZXhpc3QiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRGllc2VyIFJhdW0gZXhpc3RpZXJ0IChub2NoKSBuaWNodCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyByb29tIGhhcyByZWFjaGVkIGl0J3MgbWF4aW11bSBudW1iZXIgb2Ygb2NjdXBhbnRzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkRpZXNlciBSYXVtIGhhdCBkaWUgbWF4aW1hbGUgTWl0Z2xpZWRlcmFuemFobCBlcnJlaWNodCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVG9waWMgc2V0IGJ5ICUxJHMgdG86ICUyJHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiJTEkcyBoYXQgZGFzIFRoZW1hIHp1IFwiJTIkc1wiIGFiZ2XDpG5kZXJ0IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHVzZXIgaXMgYSBtb2RlcmF0b3IiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRGllc2VyIEJlbnV0emVyIGlzdCBlaW4gTW9kZXJhdG9yIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHVzZXIgY2FuIHNlbmQgbWVzc2FnZXMgaW4gdGhpcyByb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkRpZXNlciBCZW51dHplciBrYW5uIE5hY2hyaWNodGVuIGluIGRpZXNlbSBSYXVtIHZlcnNjaGlja2VuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHVzZXIgY2FuIE5PVCBzZW5kIG1lc3NhZ2VzIGluIHRoaXMgcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJEaWVzZXIgQmVudXR6ZXIga2FubiBrZWluZSBOYWNocmljaHRlbiBpbiBkaWVzZW0gUmF1bSB2ZXJzY2hpY2tlbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgdG8gY2hhdCB3aXRoIHRoaXMgY29udGFjdCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJIaWVyIGtsaWNrZW4gdW0gbWl0IGRpZXNlbSBLb250YWt0IHp1IGNoYXR0ZW4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNsaWNrIHRvIHJlbW92ZSB0aGlzIGNvbnRhY3QiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSGllciBrbGlja2VuIHVtIGRpZXNlbiBLb250YWt0IHp1IGVudGZlcm5lbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyBjb250YWN0IGlzIGJ1c3kiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRGllc2VyIEtvbnRha3QgaXN0IGJlc2Now6RmdGljaHQiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgY29udGFjdCBpcyBvbmxpbmUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRGllc2VyIEtvbnRha3QgaXN0IG9ubGluZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyBjb250YWN0IGlzIG9mZmxpbmUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRGllc2VyIEtvbnRha3QgaXN0IG9mZmxpbmUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgY29udGFjdCBpcyB1bmF2YWlsYWJsZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJEaWVzZXIgS29udGFrdCBpc3QgbmljaHQgdmVyZsO8Z2JhciIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyBjb250YWN0IGlzIGF3YXkgZm9yIGFuIGV4dGVuZGVkIHBlcmlvZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJEaWVzZXIgS29udGFrdCBpcyBmw7xyIGzDpG5nZXJlIFplaXQgYWJ3ZXNlbmQiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgY29udGFjdCBpcyBhd2F5IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkRpZXNlciBLb250YWt0IGlzdCBhYndlc2VuZCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ29udGFjdCByZXF1ZXN0cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJLb250YWt0YW5mcmFnZW4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk15IGNvbnRhY3RzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk1laW5lIEtvbnRha3RlIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJQZW5kaW5nIGNvbnRhY3RzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlVuYmVzdMOkdGlndGUgS29udGFrdGUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkN1c3RvbSBzdGF0dXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU3RhdHVzLU5hY2hyaWNodCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgdG8gY2hhbmdlIHlvdXIgY2hhdCBzdGF0dXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiS2xpY2tlbiBTaWUsIHVtIGlocmVyIFN0YXR1cyB0byDDpG5kZXJuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDbGljayBoZXJlIHRvIHdyaXRlIGEgY3VzdG9tIHN0YXR1cyBtZXNzYWdlIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIktsaWNrZW4gU2llIGhpZXIsIHVtIGlocmVyIFN0YXR1cy1OYWNocmljaHQgdG8gw6RuZGVybiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAib25saW5lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIm9ubGluZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiYnVzeSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJiZXNjaMOkZnRpY2h0IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJhd2F5IGZvciBsb25nIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgImzDpG5nZXIgYWJ3ZXNlbmQiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgImF3YXkiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiYWJ3ZXNlbmQiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkkgYW0gJTEkcyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJJY2ggYmluICUxJHMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNpZ24gaW4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQW5tZWxkZW4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlhNUFAvSmFiYmVyIFVzZXJuYW1lOiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJYTVBQL0phYmJlciBCZW51dHplcm5hbWUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlBhc3N3b3JkOiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJQYXNzd29ydDoiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkxvZyBJbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJBbm1lbGRlbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQk9TSCBTZXJ2aWNlIFVSTDoiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQk9TSCAiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk9ubGluZSBDb250YWN0cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJPbmxpbmUtS29udGFrdGUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIiUxJHMgaXMgdHlwaW5nIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiUxJHMgdGlwcHQiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNvbm5lY3RlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJWZXJidW5kZW4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkF0dGFjaGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkFuZ2Vow6RuZ3QiCiAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkgewogICAgICAgIGRlZmluZSgiZGUiLCBbJ2plZCddLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBmYWN0b3J5KG5ldyBKZWQodHJhbnNsYXRpb25zKSk7CiAgICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICAgIGlmICghd2luZG93LmxvY2FsZXMpIHsKICAgICAgICAgICAgd2luZG93LmxvY2FsZXMgPSB7fTsKICAgICAgICB9CiAgICAgICAgd2luZG93LmxvY2FsZXMuZGUgPSBmYWN0b3J5KG5ldyBKZWQodHJhbnNsYXRpb25zKSk7CiAgICB9Cn0odGhpcywgZnVuY3Rpb24gKGRlKSB7IAogICAgcmV0dXJuIGRlOyAKfSkpOwoKKGZ1bmN0aW9uIChyb290LCBmYWN0b3J5KSB7CiAgICB2YXIgdHJhbnNsYXRpb25zID0gewogICAgICAgICJkb21haW4iOiAiY29udmVyc2UiLAogICAgICAgICJsb2NhbGVfZGF0YSI6IHsKICAgICAgICAgICAgImNvbnZlcnNlIjogewogICAgICAgICAgICAgICAgIiI6IHsKICAgICAgICAgICAgICAgICAgICAiZG9tYWluIjogImNvbnZlcnNlIiwKICAgICAgICAgICAgICAgICAgICAibGFuZyI6ICJlbiIsCiAgICAgICAgICAgICAgICAgICAgInBsdXJhbF9mb3JtcyI6ICJucGx1cmFscz0yOyBwbHVyYWw9KG4gIT0gMSk7IgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIGlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHsKICAgICAgICBkZWZpbmUoImVuIiwgWydqZWQnXSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gZmFjdG9yeShuZXcgSmVkKHRyYW5zbGF0aW9ucykpOwogICAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgICBpZiAoIXdpbmRvdy5sb2NhbGVzKSB7CiAgICAgICAgICAgIHdpbmRvdy5sb2NhbGVzID0ge307CiAgICAgICAgfQogICAgICAgIHdpbmRvdy5sb2NhbGVzLmVuID0gZmFjdG9yeShuZXcgSmVkKHRyYW5zbGF0aW9ucykpOwogICAgfQp9KHRoaXMsIGZ1bmN0aW9uIChlbikgeyAKICAgIHJldHVybiBlbjsKfSkpOwoKKGZ1bmN0aW9uIChyb290LCBmYWN0b3J5KSB7CiAgICB2YXIgdHJhbnNsYXRpb25zID0gewogICAgICAgICJkb21haW4iOiAiY29udmVyc2UiLAogICAgICAgICJsb2NhbGVfZGF0YSI6IHsKICAgICAgICAgICAgImNvbnZlcnNlIjogewogICAgICAgICAgICAgICAgIiI6IHsKICAgICAgICAgICAgICAgICAgICAiUHJvamVjdC1JZC1WZXJzaW9uIjogIkNvbnZlcnNlLmpzIDAuNCIsCiAgICAgICAgICAgICAgICAgICAgIlJlcG9ydC1Nc2dpZC1CdWdzLVRvIjogIiIsCiAgICAgICAgICAgICAgICAgICAgIlBPVC1DcmVhdGlvbi1EYXRlIjogIjIwMTMtMDktMTUgMjE6NTUrMDIwMCIsCiAgICAgICAgICAgICAgICAgICAgIlBPLVJldmlzaW9uLURhdGUiOiAiMjAxMy0wOS0xNSAyMTo1OSswMjAwIiwKICAgICAgICAgICAgICAgICAgICAiTGFzdC1UcmFuc2xhdG9yIjogIkphdmllciBMb3BleiA8bUBqYXZpZXIuaW8+IiwKICAgICAgICAgICAgICAgICAgICAiTGFuZ3VhZ2UtVGVhbSI6ICJFUyA8TExAbGkub3JnPiIsCiAgICAgICAgICAgICAgICAgICAgIkxhbmd1YWdlIjogImVzIiwKICAgICAgICAgICAgICAgICAgICAiTUlNRS1WZXJzaW9uIjogIjEuMCIsCiAgICAgICAgICAgICAgICAgICAgIkNvbnRlbnQtVHlwZSI6ICJ0ZXh0L3BsYWluOyBjaGFyc2V0PVVURi04IiwKICAgICAgICAgICAgICAgICAgICAiQ29udGVudC1UcmFuc2Zlci1FbmNvZGluZyI6ICI4Yml0IiwKICAgICAgICAgICAgICAgICAgICAiUGx1cmFsLUZvcm1zIjogIm5wbHVyYWxzPTI7IHBsdXJhbD0obiAhPSAxKTsiLAogICAgICAgICAgICAgICAgICAgICJwbHVyYWxfZm9ybXMiOiAibnBsdXJhbHM9MjsgcGx1cmFsPShuICE9IDEpOyIsCiAgICAgICAgICAgICAgICAgICAgImxhbmciOiAiZXMiLAogICAgICAgICAgICAgICAgICAgICJMYW5ndWFnZS1Db2RlIjogImVzIiwKICAgICAgICAgICAgICAgICAgICAiTGFuZ3VhZ2UtTmFtZSI6ICJFc3Bhw7FvbCIsCiAgICAgICAgICAgICAgICAgICAgIlByZWZlcnJlZC1FbmNvZGluZ3MiOiAidXRmLTggbGF0aW4xIiwKICAgICAgICAgICAgICAgICAgICAiRG9tYWluIjogImNvbnZlcnNlIiwKICAgICAgICAgICAgICAgICAgICAiZG9tYWluIjogImNvbnZlcnNlIiwKICAgICAgICAgICAgICAgICAgICAiWC1Jcy1GYWxsYmFjay1Gb3IiOiAiZXMtYXIgZXMtYm8gZXMtY2wgZXMtY28gZXMtY3IgZXMtZG8gZXMtZWMgZXMtZXMgZXMtc3YgZXMtZ3QgZXMtaG4gZXMtbXggZXMtbmkgZXMtcGEgZXMtcHkgZXMtcGUgZXMtcHIgZXMtdXMgZXMtdXkgZXMtdmUiCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgInVuZW5jcnlwdGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgInRleHRvIHBsYW5vIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJ1bnZlcmlmaWVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgInNpbiB2ZXJpZmljYXIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgInZlcmlmaWVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgInZlcmlmaWNhZG8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgImZpbmlzaGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgImZpbmFsaXphZG8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkRpc2Nvbm5lY3RlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJEZXNjb25lY3RhZG8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkVycm9yIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkVycm9yIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb25uZWN0aW5nIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkNvbmVjdGFuZG8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNvbm5lY3Rpb24gRmFpbGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkxhIGNvbmV4acOzbiBmYWxsw7MiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkF1dGhlbnRpY2F0aW5nIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkF1dGVudGljYW5kbyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQXV0aGVudGljYXRpb24gRmFpbGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkxhIGF1dGVudGljYWNpw7NuIGZhbGzDsyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiRGlzY29ubmVjdGluZyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJEZXNjb25lY3RhbmRvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSZS1lc3RhYmxpc2hpbmcgZW5jcnlwdGVkIHNlc3Npb24iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiUmUtZXN0YWJsZWNpZW5kbyBzZXNpw7NuIGNpZnJhZGEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgYnJvd3NlciBuZWVkcyB0byBnZW5lcmF0ZSBhIHByaXZhdGUga2V5LCB3aGljaCB3aWxsIGJlIHVzZWQgaW4geW91ciBlbmNyeXB0ZWQgY2hhdCBzZXNzaW9uLiBUaGlzIGNhbiB0YWtlIHVwIHRvIDMwIHNlY29uZHMgZHVyaW5nIHdoaWNoIHlvdXIgYnJvd3NlciBtaWdodCBmcmVlemUgYW5kIGJlY29tZSB1bnJlc3BvbnNpdmUuIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlN1IG5hdmVnYWRvciBnZW5lcmFyw6EgdW5hIGxsYXZlIHByaXZhZGEgcGFyYSB1c2Fyc2UgZW4gbGEgc2VzacOzbiBjaWZyYWRhLiBFc3RvIHB1ZWRlIHRvbWFyIGhhc3RhIDMwIHNlZ3VuZG8sIGR1cmFudGUgZXN0ZSB0aWVtcG8gc3UgbmF2ZWdhZG9yIHB1ZWRlIGRlamFyIGRlIHJlc3BvbmRlci4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlByaXZhdGUga2V5IGdlbmVyYXRlZC4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTGxhdmUgcHJpdmFkYSBnZW5lcmFkYSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQXV0aGVudGljYXRpb24gcmVxdWVzdCBmcm9tICUxJHNcblxuWW91ciBidWRkeSBpcyBhdHRlbXB0aW5nIHRvIHZlcmlmeSB5b3VyIGlkZW50aXR5LCBieSBhc2tpbmcgeW91IHRoZSBxdWVzdGlvbiBiZWxvdy5cblxuJTIkcyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJQZXRpY2nDs24gZGUgYXV0ZW50aWNhY2nDs24gZGUgJTEkc1xuXG5TdSBjb250YWN0byBpbnRlbnRhIHZlcmlmaWNhciBzdSBpZGVudGlkYWQgaGFjaWVuZG8gbGEgc2lndWllbnRlIHByZWd1bnRhLlxuXG4lMiRzIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb3VsZCBub3QgdmVyaWZ5IHRoaXMgdXNlcidzIGlkZW50aWZ5LiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJObyBzZSBwdWRvIHZlcmlmaWNhciBsYSBpZGVudGlkYWQgZGUgZXN0ZSB1c3VhcmlvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJQZXJzb25hbCBtZXNzYWdlIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk1lbnNhamUgcGVyc29uYWwiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlN0YXJ0IGVuY3J5cHRlZCBjb252ZXJzYXRpb24iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSW5pY2lhciBzZXNpw7NuIGNpZnJhZGEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJlZnJlc2ggZW5jcnlwdGVkIGNvbnZlcnNhdGlvbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJBY3R1YWxpemFyIHNlc2nDs24gY2lmcmFkYSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiRW5kIGVuY3J5cHRlZCBjb252ZXJzYXRpb24iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRmluYWxpemFyIHNlc2nDs24gY2lmcmFkYSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVmVyaWZ5IHdpdGggU01QIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlZlcmlmaWNhciBjb24gU01QIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJWZXJpZnkgd2l0aCBmaW5nZXJwcmludHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVmVyaWZpY2FyIGNvbiBpZGVudGlmaWNhZG9yZXMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIldoYXQncyB0aGlzPyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLCv1F1w6kgZXMgZXN0bz8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIm1lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgInlvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTaG93IHRoaXMgbWVudSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJNb3N0cmFyIGVzdGUgbWVuw7oiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIldyaXRlIGluIHRoZSB0aGlyZCBwZXJzb24iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRXNjcmliaXIgZW4gdGVyY2VyYSBwZXJzb25hIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSZW1vdmUgbWVzc2FnZXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRWxpbWluYXIgbWVuc2FqZXMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgbWVzc2FnZSBjb3VsZCBub3QgYmUgc2VudCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTdSBtZW5zYWplIG5vIHNlIHB1ZG8gZW52aWFyIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJXZSByZWNlaXZlZCBhbiB1bmVuY3J5cHRlZCBtZXNzYWdlIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlNlIHJlY2liw61vIHVuIG1lbnNhamUgc2luIGNpZnJhciIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiV2UgcmVjZWl2ZWQgYW4gdW5yZWFkYWJsZSBlbmNyeXB0ZWQgbWVzc2FnZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTZSByZWNpYsOtbyB1biBtZW5zYWplIGNpZnJhZG8gY29ycnVwdG8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgdXNlciBoYXMgcmVxdWVzdGVkIGFuIGVuY3J5cHRlZCBzZXNzaW9uLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJFbCB1c3VhcmlvIGhhIHNvbGljaXRhZG8gdW5hIHNlc2nDs24gY2lmcmFkYSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiSGVyZSBhcmUgdGhlIGZpbmdlcnByaW50cywgcGxlYXNlIGNvbmZpcm0gdGhlbSB3aXRoICUxJHMsIG91dHNpZGUgb2YgdGhpcyBjaGF0LlxuXG5GaW5nZXJwcmludCBmb3IgeW91LCAlMiRzOiAlMyRzXG5cbkZpbmdlcnByaW50IGZvciAlMSRzOiAlNCRzXG5cbklmIHlvdSBoYXZlIGNvbmZpcm1lZCB0aGF0IHRoZSBmaW5nZXJwcmludHMgbWF0Y2gsIGNsaWNrIE9LLCBvdGhlcndpc2UgY2xpY2sgQ2FuY2VsLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgIlBvciBmYXZvciBjb25maXJtZSBsb3MgaWRlbnRpZmljYWRvcmVzIGRlICUxJHMgZnVlcmEgZGUgZXN0ZSBjaGF0XG5cbi4gU3UgaWRlbnRpZmljYWRvciBlcywgJTIkczogJTMkc1xuXG4uIEVsIGlkZW50aWZpY2Fkb3IgZGUgJTEkcyBlczogJTQkc1xuXG4uIERlc3B1w6lzIGRlIGNvbmZpcm1hciBsb3MgaWRlbnRpZmljYWRvcmVzIGhhZ2EgY2xpY2sgZW4gT0ssIGNhbmNlbGUgc2kgbm8gY29uY3VlcmRhbi4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdSB3aWxsIGJlIHByb21wdGVkIHRvIHByb3ZpZGUgYSBzZWN1cml0eSBxdWVzdGlvbiBhbmQgdGhlbiBhbiBhbnN3ZXIgdG8gdGhhdCBxdWVzdGlvbi5cblxuWW91ciBidWRkeSB3aWxsIHRoZW4gYmUgcHJvbXB0ZWQgdGhlIHNhbWUgcXVlc3Rpb24gYW5kIGlmIHRoZXkgdHlwZSB0aGUgZXhhY3Qgc2FtZSBhbnN3ZXIgKGNhc2Ugc2Vuc2l0aXZlKSwgdGhlaXIgaWRlbnRpdHkgd2lsbCBoYXZlIGJlZW4gdmVyaWZpZWQuIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlNlIGxlIHNvbGljaXRhcsOhIHVuYSBwcmVndW50YSBkZSBzZWd1cmlkYWQuXG5cbi4gTGEgcHJlZ3VudGEgcXVlIHJlc3BvbmRhIHNlIGxlIGhhcsOhIGEgc3UgY29udGFjdG8sIHNpIGxhcyByZXNwdWVzdGFzIGNvbmN1ZXJkYW4gKGN1aWRhbmRvIG1hecO6c2N1bGFzL21pbsO6c2N1bGFzKSBzdSBpZGVudGlkYWQgcXVlZGFyw6EgdmVyaWZpY2FkYS4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIldoYXQgaXMgeW91ciBzZWN1cml0eSBxdWVzdGlvbj8iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSW50cm9kdXpjYSBzdSBwcmVndW50YSBkZSBzZWd1cmlkYWQiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIldoYXQgaXMgdGhlIGFuc3dlciB0byB0aGUgc2VjdXJpdHkgcXVlc3Rpb24/IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkludHJvZHV6Y2EgbGEgcmVzcHVlc3RhIGEgc3UgcHJlZ3VudGEgZGUgc2VndXJpZGFkIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJJbnZhbGlkIGF1dGhlbnRpY2F0aW9uIHNjaGVtZSBwcm92aWRlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJFc3F1ZW1hIGRlIGF1dGVudGljYWNpw7NuIGludsOhbGlkbyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBtZXNzYWdlcyBhcmUgbm90IGVuY3J5cHRlZCBhbnltb3JlIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlN1cyBtZW5zYWplcyBoYW4gZGVqYWRvIGRlIGNpZnJhcnNlIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG1lc3NhZ2VzIGFyZSBub3cgZW5jcnlwdGVkIGJ1dCB5b3VyIGJ1ZGR5J3MgaWRlbnRpdHkgaGFzIG5vdCBiZWVuIHZlcmlmaWVkLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTdXMgbWVuc2FqZXMgZXN0w6FuIGFob3JhIGNpZnJhZG9zIHBlcm8gbGEgaWRlbnRpZGFkIGRlIHN1IGNvbnRhY3RvIG5vIGhhIHNpZG8gdmVyaWZpY2FkYSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBidWRkeSdzIGlkZW50aWZ5IGhhcyBiZWVuIHZlcmlmaWVkLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJMYSBpZGVudGlkYWQgZGUgc3UgY29udGFjdG8gaGEgc2lkbyBjb25maXJtYWRhIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIGJ1ZGR5IGhhcyBlbmRlZCBlbmNyeXB0aW9uIG9uIHRoZWlyIGVuZCwgeW91IHNob3VsZCBkbyB0aGUgc2FtZS4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU3UgY29udGFjdG8gZmluYWxpesOzIGxhIHNlc2nDs24gY2lmcmFkYSwgZGViZXLDrWEgaGFjZXIgbG8gbWlzbW8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgbWVzc2FnZXMgYXJlIG5vdCBlbmNyeXB0ZWQuIENsaWNrIGhlcmUgdG8gZW5hYmxlIE9UUiBlbmNyeXB0aW9uLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTdXMgbWVuc2FqZXMgbm8gZXN0w6FuIGNpZnJhZG9zLiBIYWdhIGNsaWNrIGFxdcOtIHBhcmEgaGFiaWxpdGFyIGVsIGNpZnJhZG8gT1RSIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG1lc3NhZ2VzIGFyZSBlbmNyeXB0ZWQsIGJ1dCB5b3VyIGJ1ZGR5IGhhcyBub3QgYmVlbiB2ZXJpZmllZC4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU3VzIG1lbnNhamVzIGVzdMOhbiBjaWZyYWRvcyBwZXJvIGxhIGlkZW50aWRhZCBkZSBzdSBjb250YWN0byBubyBoYSBzaWRvIHZlcmlmaWNhZGEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgbWVzc2FnZXMgYXJlIGVuY3J5cHRlZCBhbmQgeW91ciBidWRkeSB2ZXJpZmllZC4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU3VzIG1lbnNhamVzIGVzdMOhbiBjaWZyYWRvcyB5IHN1IGNvbnRhY3RvIGhhIHNpZG8gdmVyaWZpY2FkbyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBidWRkeSBoYXMgY2xvc2VkIHRoZWlyIGVuZCBvZiB0aGUgcHJpdmF0ZSBzZXNzaW9uLCB5b3Ugc2hvdWxkIGRvIHRoZSBzYW1lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlN1IGNvbnRhY3RvIGZpbmFsaXrDsyBsYSBzZXNpw7NuIGNpZnJhZGEsIGRlYmVyw61hIGhhY2VyIGxvIG1pc21vIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb250YWN0cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDb250YWN0b3MiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk9ubGluZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJFbiBsaW5lYSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQnVzeSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJPY3VwYWRvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJBd2F5IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkF1c2VudGUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk9mZmxpbmUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRGVzY29uZWN0YWRvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDbGljayB0byBhZGQgbmV3IGNoYXQgY29udGFjdHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSGFnYSBjbGljayBwYXJhIGFncmVnYXIgbnVldm9zIGNvbnRhY3RvcyBhbCBjaGF0IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJBZGQgYSBjb250YWN0IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkFncmVnYXIgdW4gY29udGFjdG8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNvbnRhY3QgdXNlcm5hbWUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTm9tYnJlIGRlIHVzdWFyaW8gZGUgY29udGFjdG8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkFkZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJBZ3JlZ2FyIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb250YWN0IG5hbWUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTm9tYnJlIGRlIGNvbnRhY3RvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTZWFyY2giOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQsO6c3F1ZWRhIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJObyB1c2VycyBmb3VuZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTaW4gdXN1YXJpb3MgZW5jb250cmFkb3MiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNsaWNrIHRvIGFkZCBhcyBhIGNoYXQgY29udGFjdCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJIYWdhIGNsaWNrIHBhcmEgYWdyZWdhciBjb21vIGNvbnRhY3RvIGRlIGNoYXQiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNsaWNrIHRvIG9wZW4gdGhpcyByb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkhhZ2EgY2xpY2sgcGFyYSBhYnJpciBlc3RhIHNhbGEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNob3cgbW9yZSBpbmZvcm1hdGlvbiBvbiB0aGlzIHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTW9zdHJhciBtw6FzIGluZm9ybWFjacOzbiBlbiBlc3RhIHNhbGEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkRlc2NyaXB0aW9uOiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJEZXNjcmlwY2nDs24iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk9jY3VwYW50czoiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiT2N1cGFudGVzOiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiRmVhdHVyZXM6IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkNhcmFjdGVyw61zdGljYXM6IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSZXF1aXJlcyBhdXRoZW50aWNhdGlvbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJBdXRlbnRpY2FjacOzbiByZXF1ZXJpZGEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkhpZGRlbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJPY3VsdG8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJlcXVpcmVzIGFuIGludml0YXRpb24iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiUmVxdWllcmUgdW5hIGludml0YWNpw7NuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJNb2RlcmF0ZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTW9kZXJhZG8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk5vbi1hbm9ueW1vdXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTm8gYW7Ds25pbW8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk9wZW4gcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJBYnJpciBzYWxhIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJQZXJtYW5lbnQgcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTYWxhIHBlcm1hbmVudGUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlB1YmxpYyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJQdWJsaWNvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTZW1pLWFub255bW91cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTZW1pIGFuw7NuaW1vIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUZW1wb3Jhcnkgcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTYWxhIHRlbXBvcmFsIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJVbm1vZGVyYXRlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTaW4gbW9kZXJhciIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUm9vbXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU2FsYXMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJvb20gbmFtZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJOb21icmUgZGUgc2FsYSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTmlja25hbWUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQXBvZG8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNlcnZlciI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTZXJ2aWRvciIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiSm9pbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJVbmlyc2UiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNob3cgcm9vbXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTW9zdHJhciBzYWxhcyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTm8gcm9vbXMgb24gJTEkcyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTaW4gc2FsYXMgZW4gJTEkcyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUm9vbXMgb24gJTEkcyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTYWxhcyBlbiAlMSRzIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTZXQgY2hhdHJvb20gdG9waWMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRGVmaW5pciB0ZW1hIGRlIHNhbGEgZGUgY2hhdCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiS2ljayB1c2VyIGZyb20gY2hhdHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRXhwdWxzYXIgdXN1YXJpbyBkZSBzYWxhIGRlIGNoYXQuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJCYW4gdXNlciBmcm9tIGNoYXRyb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkJsb3F1ZWFyIHVzdWFyaW8gZGUgc2FsYSBkZSBjaGF0LiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTWVzc2FnZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJNZW5zYWplIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTYXZlIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkd1YXJkYXIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNhbmNlbCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDYW5jZWxhciIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQW4gZXJyb3Igb2NjdXJyZWQgd2hpbGUgdHJ5aW5nIHRvIHNhdmUgdGhlIGZvcm0uIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlVuIGVycm9yIG9jdXJyw61vIG1pZW50cmFzIHNlIGd1YXJkYWJhIGVsIGZvcm11bGFyaW8uIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIGNoYXRyb29tIHJlcXVpcmVzIGEgcGFzc3dvcmQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRXN0YSBzYWxhIGRlIGNoYXQgcmVxdWllcmUgdW5hIGNvbnRyYXNlw7FhLiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUGFzc3dvcmQ6ICI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDb250cmFzZcOxYTogIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTdWJtaXQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRW52aWFyIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gaXMgbm90IGFub255bW91cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJFc3RhIHNhbGEgbm8gZXMgcGFyYSB1c3VhcmlvcyBhbsOzbmltb3MiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBub3cgc2hvd3MgdW5hdmFpbGFibGUgbWVtYmVycyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJFc3RhIHNhbGEgYWhvcmEgbXVlc3RyYSBsb3MgbWllbWJyb3Mgbm8gZGlzcG9uaWJsZXMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBkb2VzIG5vdCBzaG93IHVuYXZhaWxhYmxlIG1lbWJlcnMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRXN0YSBzYWxhIG5vIG11ZXN0cmEgbG9zIG1pZW1icm9zIG5vIGRpc3BvbmlibGVzIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJOb24tcHJpdmFjeS1yZWxhdGVkIHJvb20gY29uZmlndXJhdGlvbiBoYXMgY2hhbmdlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJVbmEgY29uZmlndXJhY2nDs24gZGUgbGEgc2FsYSBubyByZWxhY2lvbmFkYSBjb24gbGEgcHJpdmFjaWRhZCBoYSBzaWRvIGNhbWJpYWRhIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSb29tIGxvZ2dpbmcgaXMgbm93IGVuYWJsZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRWwgcmVnaXN0cm8gZGUgbGEgc2FsYSBhaG9yYSBlc3TDoSBoYWJpbGl0YWRvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSb29tIGxvZ2dpbmcgaXMgbm93IGRpc2FibGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkVsIHJlZ2lzdHJvIGRlIGxhIHNhbGEgYWhvcmEgZXN0w6EgZGVzaGFiaWxpdGFkbyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyByb29tIGlzIG5vdyBub24tYW5vbnltb3VzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkVzdGEgc2FsYSBhaG9yYSBlcyBww7pibGljYSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyByb29tIGlzIG5vdyBzZW1pLWFub255bW91cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJFc3RhIHNhbGEgYWhvcmEgZXMgc2VtaS1hbsOzbmltYSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyByb29tIGlzIG5vdyBmdWxseS1hbm9ueW1vdXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRXN0YSBzYWxhIGFob3JhIGVzIGNvbXBsZXRhbWVudGUgYW7Ds25pbWEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkEgbmV3IHJvb20gaGFzIGJlZW4gY3JlYXRlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJVbmEgbnVldmEgc2FsYSBoYSBzaWRvIGNyZWFkYSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBuaWNrbmFtZSBoYXMgYmVlbiBjaGFuZ2VkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlN1IGFwb2RvIGhhIHNpZG8gY2FtYmlhZG8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIjxzdHJvbmc+JTEkczwvc3Ryb25nPiBoYXMgYmVlbiBiYW5uZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IGhhIHNpZG8gYmxvcXVlYWRvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gaGFzIGJlZW4ga2lja2VkIG91dCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gaGEgc2lkbyBleHB1bHNhZG8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIjxzdHJvbmc+JTEkczwvc3Ryb25nPiBoYXMgYmVlbiByZW1vdmVkIGJlY2F1c2Ugb2YgYW4gYWZmaWxpYXRpb24gY2hhbmdlIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIjxzdHJvbmc+JTEkczwvc3Ryb25nPiBoYSBzaWRvIGVsaW1pbmFkbyBkZWJpZG8gYSB1biBjYW1iaW8gZGUgYWZpbGlhY2nDs24iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIjxzdHJvbmc+JTEkczwvc3Ryb25nPiBoYXMgYmVlbiByZW1vdmVkIGZvciBub3QgYmVpbmcgYSBtZW1iZXIiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IGhhIHNpZG8gZWxpbWluYWRvIGRlYmlkbyBhIHF1ZSBubyBlcyBtaWVtYnJvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3UgaGF2ZSBiZWVuIGJhbm5lZCBmcm9tIHRoaXMgcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJVc3RlZCBoYSBzaWRvIGJsb3F1ZWFkbyBkZSBlc3RhIHNhbGEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdSBoYXZlIGJlZW4ga2lja2VkIGZyb20gdGhpcyByb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlVzdGVkIGhhIHNpZG8gZXhwdWxzYWRvIGRlIGVzdGEgc2FsYSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91IGhhdmUgYmVlbiByZW1vdmVkIGZyb20gdGhpcyByb29tIGJlY2F1c2Ugb2YgYW4gYWZmaWxpYXRpb24gY2hhbmdlIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlVzdGVkIGhhIHNpZG8gZWxpbWluYWRvIGRlIGVzdGEgc2FsYSBkZWJpZG8gYSB1biBjYW1iaW8gZGUgYWZpbGlhY2nDs24iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdSBoYXZlIGJlZW4gcmVtb3ZlZCBmcm9tIHRoaXMgcm9vbSBiZWNhdXNlIHRoZSByb29tIGhhcyBjaGFuZ2VkIHRvIG1lbWJlcnMtb25seSBhbmQgeW91J3JlIG5vdCBhIG1lbWJlciI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJVc3RlZCBoYSBzaWRvIGVsaW1pbmFkbyBkZSBlc3RhIHNhbGEgZGViaWRvIGEgcXVlIGxhIHNhbGEgY2FtYmlvIHN1IGNvbmZpZ3VyYWNpw7NuIGEgc29sby1taWVtYnJvcyB5IHVzdGVkIG5vIGVzIHVuIG1pZW1icm8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdSBoYXZlIGJlZW4gcmVtb3ZlZCBmcm9tIHRoaXMgcm9vbSBiZWNhdXNlIHRoZSBNVUMgKE11bHRpLXVzZXIgY2hhdCkgc2VydmljZSBpcyBiZWluZyBzaHV0IGRvd24uIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlVzdGVkIGhhIHNpZG8gZWxpbWluYWRvIGRlIGVzdGEgc2FsYSBkZWJpZG8gYSBxdWUgZWwgc2VydmljaW8gTVVDIChNdWx0aS11c2VyIGNoYXQpIGVzdMOhIGRlc2hhYmlsaXRhZG8uIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3UgYXJlIG5vdCBvbiB0aGUgbWVtYmVyIGxpc3Qgb2YgdGhpcyByb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlVzdGVkIG5vIGVzdMOhIGVuIGxhIGxpc3RhIGRlIG1pZW1icm9zIGRlIGVzdGEgc2FsYSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTm8gbmlja25hbWUgd2FzIHNwZWNpZmllZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTaW4gYXBvZG8gZXNwZWNpZmljYWRvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3UgYXJlIG5vdCBhbGxvd2VkIHRvIGNyZWF0ZSBuZXcgcm9vbXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVXN0ZWQgbm8gZXN0YSBhdXRvcml6YWRvIHBhcmEgY3JlYXIgbnVldmFzIHNhbGFzIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG5pY2tuYW1lIGRvZXNuJ3QgY29uZm9ybSB0byB0aGlzIHJvb20ncyBwb2xpY2llcyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTdSBhcG9kbyBubyBzZSBhanVzdGEgYSBsYSBwb2zDrXRpY2EgZGUgZXN0YSBzYWxhIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG5pY2tuYW1lIGlzIGFscmVhZHkgdGFrZW4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU3UgYXBvZG8geWEgaGEgc2lkbyB0b21hbmRvIHBvciBvdHJvIHVzdWFyaW8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBkb2VzIG5vdCAoeWV0KSBleGlzdCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJFc3RhIHNhbGEgKGHDum4pIG5vIGV4aXN0ZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyByb29tIGhhcyByZWFjaGVkIGl0J3MgbWF4aW11bSBudW1iZXIgb2Ygb2NjdXBhbnRzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkVzdGEgc2FsYSBoYSBhbGNhbnphZG8gc3UgbsO6bWVybyBtw6F4aW1vIGRlIG9jdXBhbnRlcyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVG9waWMgc2V0IGJ5ICUxJHMgdG86ICUyJHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVGVtYSBmaWphZG8gcG9yICUxJHMgYTogJTIkcyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyB1c2VyIGlzIGEgbW9kZXJhdG9yIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkVzdGUgdXN1YXJpbyBlcyB1biBtb2RlcmFkb3IiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgdXNlciBjYW4gc2VuZCBtZXNzYWdlcyBpbiB0aGlzIHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRXN0ZSB1c3VhcmlvIHB1ZWRlIGVudmlhciBtZW5zYWplcyBlbiBlc3RhIHNhbGEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgdXNlciBjYW4gTk9UIHNlbmQgbWVzc2FnZXMgaW4gdGhpcyByb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkVzdGUgdXN1YXJpbyBOTyBwdWVkZSBlbnZpYXIgbWVuc2FqZXMgZW4gZXN0YSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgdG8gY2hhdCB3aXRoIHRoaXMgY29udGFjdCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJIYWdhIGNsaWNrIHBhcmEgY29udmVyc2FyIGNvbiBlc3RlIGNvbnRhY3RvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDbGljayB0byByZW1vdmUgdGhpcyBjb250YWN0IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkhhZ2EgY2xpY2sgcGFyYSBlbGltaW5hciBlc3RlIGNvbnRhY3RvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIGNvbnRhY3QgaXMgYnVzeSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJFc3RlIGNvbnRhY3RvIGVzdMOhIG9jdXBhZG8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgY29udGFjdCBpcyBvbmxpbmUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRXN0ZSBjb250YWN0byBlc3TDoSBlbiBsw61uZWEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgY29udGFjdCBpcyBvZmZsaW5lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkVzdGUgY29udGFjdG8gZXN0w6EgZGVzY29uZWN0YWRvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIGNvbnRhY3QgaXMgdW5hdmFpbGFibGUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRXN0ZSBjb250YWN0byBubyBlc3TDoSBkaXNwb25pYmxlIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIGNvbnRhY3QgaXMgYXdheSBmb3IgYW4gZXh0ZW5kZWQgcGVyaW9kIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkVzdGUgY29udGFjdG8gZXN0w6EgYXVzZW50ZSBwb3IgdW4gbGFyZ28gcGVyaW9kbyBkZSB0aWVtcG8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgY29udGFjdCBpcyBhd2F5IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkVzdGUgY29udGFjdG8gZXN0w6EgYXVzZW50ZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ29udGFjdCByZXF1ZXN0cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTb2xpY2l0dWRlcyBkZSBjb250YWN0byIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTXkgY29udGFjdHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTWlzIGNvbnRhY3RvcyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUGVuZGluZyBjb250YWN0cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDb250YWN0b3MgcGVuZGllbnRlcyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ3VzdG9tIHN0YXR1cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJQZXJzb25hbGl6YXIgZXN0YXR1cyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgdG8gY2hhbmdlIHlvdXIgY2hhdCBzdGF0dXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSGFnYSBjbGljayBwYXJhIGNhbWJpYXIgc3UgZXN0YXR1cyBkZSBjaGF0IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDbGljayBoZXJlIHRvIHdyaXRlIGEgY3VzdG9tIHN0YXR1cyBtZXNzYWdlIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkhhZ2EgY2xpY2sgcGFyYSBlc2NyaWJpciB1biBtZW5zYWplIGRlIGVzdGF0dXMgcGVyc29uYWxpemFkbyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAib25saW5lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgImVuIGzDrW5lYSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiYnVzeSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJvY3VwYWRvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJhd2F5IGZvciBsb25nIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgImF1c2VudGUgcG9yIG11Y2hvIHRpZW1wbyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiYXdheSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJhdXNlbnRlIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJJIGFtICUxJHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRXN0b3kgJTEkcyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU2lnbiBpbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJSZWdpc3RyYXIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlhNUFAvSmFiYmVyIFVzZXJuYW1lOiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJOb21icmUgZGUgdXN1YXJpbyBYTVBQL0phYmJlciIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUGFzc3dvcmQ6IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkNvbnRyYXNlw7FhOiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTG9nIEluIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkluaWNpYXIgc2VzacOzbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQk9TSCBTZXJ2aWNlIFVSTDoiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVVJMIGRlbCBzZXJ2aWNpbyBCT1NIOiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiT25saW5lIENvbnRhY3RzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkVuIGzDrW5lYSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ29ubmVjdGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkNvbmVjdGFkbyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQXR0YWNoZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQWRqdW50YWRvIgogICAgICAgICAgICAgICAgXQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIGlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHsKICAgICAgICBkZWZpbmUoImVzIiwgWydqZWQnXSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gZmFjdG9yeShuZXcgSmVkKHRyYW5zbGF0aW9ucykpOwogICAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgICBpZiAoIXdpbmRvdy5sb2NhbGVzKSB7CiAgICAgICAgICAgIHdpbmRvdy5sb2NhbGVzID0ge307CiAgICAgICAgfQogICAgICAgIHdpbmRvdy5sb2NhbGVzLmVzID0gZmFjdG9yeShuZXcgSmVkKHRyYW5zbGF0aW9ucykpOwogICAgfQp9KHRoaXMsIGZ1bmN0aW9uIChlcykgeyAKICAgIHJldHVybiBlczsgCn0pKTsKCihmdW5jdGlvbiAocm9vdCwgZmFjdG9yeSkgewogICAgdmFyIHRyYW5zbGF0aW9ucyA9IHsKICAgICAgICAiZG9tYWluIjogImNvbnZlcnNlIiwKICAgICAgICAibG9jYWxlX2RhdGEiOiB7CiAgICAgICAgICAgICJjb252ZXJzZSI6IHsKICAgICAgICAgICAgICAgICIiOiB7CiAgICAgICAgICAgICAgICAgICAgIlByb2plY3QtSWQtVmVyc2lvbiI6ICJDb252ZXJzZS5qcyAwLjQiLAogICAgICAgICAgICAgICAgICAgICJSZXBvcnQtTXNnaWQtQnVncy1UbyI6ICIiLAogICAgICAgICAgICAgICAgICAgICJQT1QtQ3JlYXRpb24tRGF0ZSI6ICIyMDEzLTA5LTE1IDIxOjU1KzAyMDAiLAogICAgICAgICAgICAgICAgICAgICJQTy1SZXZpc2lvbi1EYXRlIjogIjIwMTMtMDktMTUgMjE6NTgrMDIwMCIsCiAgICAgICAgICAgICAgICAgICAgIkxhbmd1YWdlLVRlYW0iOiAiRlIgPExMQGxpLm9yZz4iLAogICAgICAgICAgICAgICAgICAgICJMYW5ndWFnZSI6ICJmciIsCiAgICAgICAgICAgICAgICAgICAgIk1JTUUtVmVyc2lvbiI6ICIxLjAiLAogICAgICAgICAgICAgICAgICAgICJDb250ZW50LVR5cGUiOiAidGV4dC9wbGFpbjsgY2hhcnNldD1VVEYtOCIsCiAgICAgICAgICAgICAgICAgICAgIkNvbnRlbnQtVHJhbnNmZXItRW5jb2RpbmciOiAiOGJpdCIsCiAgICAgICAgICAgICAgICAgICAgIlBsdXJhbC1Gb3JtcyI6ICJucGx1cmFscz0yOyBwbHVyYWw9KG4gIT0gMSk7IiwKICAgICAgICAgICAgICAgICAgICAicGx1cmFsX2Zvcm1zIjogIm5wbHVyYWxzPTI7IHBsdXJhbD0obiAhPSAxKTsiLAogICAgICAgICAgICAgICAgICAgICJsYW5nIjogImZyIiwKICAgICAgICAgICAgICAgICAgICAiTGFuZ3VhZ2UtQ29kZSI6ICJmciIsCiAgICAgICAgICAgICAgICAgICAgIlByZWZlcnJlZC1FbmNvZGluZ3MiOiAidXRmLTggbGF0aW4xIiwKICAgICAgICAgICAgICAgICAgICAiRG9tYWluIjogImNvbnZlcnNlIiwKICAgICAgICAgICAgICAgICAgICAiZG9tYWluIjogImNvbnZlcnNlIgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJ1bmVuY3J5cHRlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgInVudmVyaWZpZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJ2ZXJpZmllZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgImZpbmlzaGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiRGlzY29ubmVjdGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkTDqWNvbm5lY3TDqSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiRXJyb3IiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRXJyZXVyIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb25uZWN0aW5nIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkNvbm5lY3Rpb24iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNvbm5lY3Rpb24gRmFpbGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkxhIGNvbm5lY3Rpb24gYSDDqWNob3XDqSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQXV0aGVudGljYXRpbmciOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQXV0aGVudGlmaWNhdGlvbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQXV0aGVudGljYXRpb24gRmFpbGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkwnYXV0aGVudGlmaWNhdGlvbiBhIMOpY2hvdcOpIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJEaXNjb25uZWN0aW5nIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkTDqWNvbm5lY3Rpb24iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJlLWVzdGFibGlzaGluZyBlbmNyeXB0ZWQgc2Vzc2lvbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgYnJvd3NlciBuZWVkcyB0byBnZW5lcmF0ZSBhIHByaXZhdGUga2V5LCB3aGljaCB3aWxsIGJlIHVzZWQgaW4geW91ciBlbmNyeXB0ZWQgY2hhdCBzZXNzaW9uLiBUaGlzIGNhbiB0YWtlIHVwIHRvIDMwIHNlY29uZHMgZHVyaW5nIHdoaWNoIHlvdXIgYnJvd3NlciBtaWdodCBmcmVlemUgYW5kIGJlY29tZSB1bnJlc3BvbnNpdmUuIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUHJpdmF0ZSBrZXkgZ2VuZXJhdGVkLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkF1dGhlbnRpY2F0aW9uIHJlcXVlc3QgZnJvbSAlMSRzXG5cbllvdXIgYnVkZHkgaXMgYXR0ZW1wdGluZyB0byB2ZXJpZnkgeW91ciBpZGVudGl0eSwgYnkgYXNraW5nIHlvdSB0aGUgcXVlc3Rpb24gYmVsb3cuXG5cbiUyJHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb3VsZCBub3QgdmVyaWZ5IHRoaXMgdXNlcidzIGlkZW50aWZ5LiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlBlcnNvbmFsIG1lc3NhZ2UiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTWVzc2FnZSBwZXJzb25uZWwiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlN0YXJ0IGVuY3J5cHRlZCBjb252ZXJzYXRpb24iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSZWZyZXNoIGVuY3J5cHRlZCBjb252ZXJzYXRpb24iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJFbmQgZW5jcnlwdGVkIGNvbnZlcnNhdGlvbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlZlcmlmeSB3aXRoIFNNUCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlZlcmlmeSB3aXRoIGZpbmdlcnByaW50cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIldoYXQncyB0aGlzPyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIm1lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU2hvdyB0aGlzIG1lbnUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQWZmaWNoZXIgY2UgbWVudSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiV3JpdGUgaW4gdGhlIHRoaXJkIHBlcnNvbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLDiWNyaXJlIMOgIGxhIHRyb2lzacOobWUgcGVyc29ubmUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJlbW92ZSBtZXNzYWdlcyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJFZmZhY2VyIGxlcyBtZXNzYWdlcyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBtZXNzYWdlIGNvdWxkIG5vdCBiZSBzZW50IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiV2UgcmVjZWl2ZWQgYW4gdW5lbmNyeXB0ZWQgbWVzc2FnZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIldlIHJlY2VpdmVkIGFuIHVucmVhZGFibGUgZW5jcnlwdGVkIG1lc3NhZ2UiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHVzZXIgaGFzIHJlcXVlc3RlZCBhbiBlbmNyeXB0ZWQgc2Vzc2lvbi4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJIZXJlIGFyZSB0aGUgZmluZ2VycHJpbnRzLCBwbGVhc2UgY29uZmlybSB0aGVtIHdpdGggJTEkcywgb3V0c2lkZSBvZiB0aGlzIGNoYXQuXG5cbkZpbmdlcnByaW50IGZvciB5b3UsICUyJHM6ICUzJHNcblxuRmluZ2VycHJpbnQgZm9yICUxJHM6ICU0JHNcblxuSWYgeW91IGhhdmUgY29uZmlybWVkIHRoYXQgdGhlIGZpbmdlcnByaW50cyBtYXRjaCwgY2xpY2sgT0ssIG90aGVyd2lzZSBjbGljayBDYW5jZWwuIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91IHdpbGwgYmUgcHJvbXB0ZWQgdG8gcHJvdmlkZSBhIHNlY3VyaXR5IHF1ZXN0aW9uIGFuZCB0aGVuIGFuIGFuc3dlciB0byB0aGF0IHF1ZXN0aW9uLlxuXG5Zb3VyIGJ1ZGR5IHdpbGwgdGhlbiBiZSBwcm9tcHRlZCB0aGUgc2FtZSBxdWVzdGlvbiBhbmQgaWYgdGhleSB0eXBlIHRoZSBleGFjdCBzYW1lIGFuc3dlciAoY2FzZSBzZW5zaXRpdmUpLCB0aGVpciBpZGVudGl0eSB3aWxsIGhhdmUgYmVlbiB2ZXJpZmllZC4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJXaGF0IGlzIHlvdXIgc2VjdXJpdHkgcXVlc3Rpb24/IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiV2hhdCBpcyB0aGUgYW5zd2VyIHRvIHRoZSBzZWN1cml0eSBxdWVzdGlvbj8iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJJbnZhbGlkIGF1dGhlbnRpY2F0aW9uIHNjaGVtZSBwcm92aWRlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgbWVzc2FnZXMgYXJlIG5vdCBlbmNyeXB0ZWQgYW55bW9yZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgbWVzc2FnZXMgYXJlIG5vdyBlbmNyeXB0ZWQgYnV0IHlvdXIgYnVkZHkncyBpZGVudGl0eSBoYXMgbm90IGJlZW4gdmVyaWZpZWQuIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBidWRkeSdzIGlkZW50aWZ5IGhhcyBiZWVuIHZlcmlmaWVkLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgYnVkZHkgaGFzIGVuZGVkIGVuY3J5cHRpb24gb24gdGhlaXIgZW5kLCB5b3Ugc2hvdWxkIGRvIHRoZSBzYW1lLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgbWVzc2FnZXMgYXJlIG5vdCBlbmNyeXB0ZWQuIENsaWNrIGhlcmUgdG8gZW5hYmxlIE9UUiBlbmNyeXB0aW9uLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgbWVzc2FnZXMgYXJlIGVuY3J5cHRlZCwgYnV0IHlvdXIgYnVkZHkgaGFzIG5vdCBiZWVuIHZlcmlmaWVkLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgbWVzc2FnZXMgYXJlIGVuY3J5cHRlZCBhbmQgeW91ciBidWRkeSB2ZXJpZmllZC4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIGJ1ZGR5IGhhcyBjbG9zZWQgdGhlaXIgZW5kIG9mIHRoZSBwcml2YXRlIHNlc3Npb24sIHlvdSBzaG91bGQgZG8gdGhlIHNhbWUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb250YWN0cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDb250YWN0cyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiT25saW5lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkVuIGxpZ25lIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJCdXN5IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk9jY3Vww6kiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkF3YXkiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQWJzZW50IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJPZmZsaW5lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkTDqWNvbm5lY3TDqSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgdG8gYWRkIG5ldyBjaGF0IGNvbnRhY3RzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkNsaXF1ZXogcG91ciBham91dGVyIGRlIG5vdXZlYXV4IGNvbnRhY3RzIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJBZGQgYSBjb250YWN0IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkFqb3V0ZXIgdW4gY29udGFjdCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ29udGFjdCB1c2VybmFtZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJOb20gZHUgY29udGFjdCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQWRkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkFqb3V0ZXIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNvbnRhY3QgbmFtZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJOb20gZHUgY29udGFjdCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU2VhcmNoIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlJlY2hlcmNoZXIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk5vIHVzZXJzIGZvdW5kIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkF1Y3VuIHV0aWxpc2F0ZXVyIHRyb3V2w6kiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNsaWNrIHRvIGFkZCBhcyBhIGNoYXQgY29udGFjdCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDbGlxdWVyIHBvdXIgYWpvdXRlciBhdXggY29udGFjdHMgZGUgY2hhdCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgdG8gb3BlbiB0aGlzIHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQ2xpcXVlciBwb3VyIG91dnJpciBjZSBzYWxvbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU2hvdyBtb3JlIGluZm9ybWF0aW9uIG9uIHRoaXMgcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJBZmZpY2hlciBkYXZhbnRhZ2UgZCdpbmZvcm1hdGlvbnMgc3VyIGNlIHNhbG9uIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJEZXNjcmlwdGlvbjoiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRGVzY3JpcHRpb24gOiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiT2NjdXBhbnRzOiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJQYXJ0aWNpcGFudHMgOiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiRmVhdHVyZXM6IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkNhcmFjdMOpcmlzdGlxdWVzIDoiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJlcXVpcmVzIGF1dGhlbnRpY2F0aW9uIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk7DqWNlc3NpdGUgdW5lIGF1dGhlbnRpZmljYXRpb24iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkhpZGRlbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJNYXNxdcOpIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSZXF1aXJlcyBhbiBpbnZpdGF0aW9uIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk7DqWNlc3NpdGUgdW5lIGludml0YXRpb24iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk1vZGVyYXRlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJNb2TDqXLDqSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTm9uLWFub255bW91cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJOb24tYW5vbnltZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiT3BlbiByb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk91dnJpciB1biBzYWxvbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUGVybWFuZW50IHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU2Fsb24gcGVybWFuZW50IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJQdWJsaWMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiUHVibGljIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTZW1pLWFub255bW91cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTZW1pLWFub255bWUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRlbXBvcmFyeSByb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlNhbG9uIHRlbXBvcmFpcmUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlVubW9kZXJhdGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk5vbiBtb2TDqXLDqSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUm9vbXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU2Fsb25zIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSb29tIG5hbWUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTnVtw6lybyBkZSBzYWxvbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTmlja25hbWUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQWxpYXMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNlcnZlciI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTZXJ2ZXVyIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJKb2luIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlJlam9pbmRyZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU2hvdyByb29tcyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJBZmZpY2hlciBsZXMgc2Fsb25zIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJObyByb29tcyBvbiAlMSRzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkF1Y3VuIHNhbG9uIGRhbnMgJTEkcyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUm9vbXMgb24gJTEkcyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTYWxvbnMgZGFucyAlMSRzIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTZXQgY2hhdHJvb20gdG9waWMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSW5kaXF1ZXIgbGUgc3VqZXQgZHUgc2Fsb24iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIktpY2sgdXNlciBmcm9tIGNoYXRyb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkV4cHVsc2VyIGwndXRpbGlzYXRldXIgZHUgc2Fsb24uIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJCYW4gdXNlciBmcm9tIGNoYXRyb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkJhbm5pciBsJ3V0aWxpc2F0ZXVyIGR1IHNhbG9uLiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTWVzc2FnZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJNZXNzYWdlIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTYXZlIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkVucmVnaXN0cmVyIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDYW5jZWwiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQW5udWxlciIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQW4gZXJyb3Igb2NjdXJyZWQgd2hpbGUgdHJ5aW5nIHRvIHNhdmUgdGhlIGZvcm0uIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlVuZSBlcnJldXIgZXN0IHN1cnZlbnVlIGxvcnMgZGUgbCdlbnJlZ2lzdHJlbWVudCBkdSBmb3JtdWxhaXJlLiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyBjaGF0cm9vbSByZXF1aXJlcyBhIHBhc3N3b3JkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkNlIHNhbG9uIG7DqWNlc3NpdGUgdW4gbW90IGRlIHBhc3NlLiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUGFzc3dvcmQ6ICI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJNb3QgZGUgcGFzc2UgOiAiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlN1Ym1pdCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTb3VtZXR0cmUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBpcyBub3QgYW5vbnltb3VzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkNlIHNhbG9uIG4nZXN0IHBhcyBhbm9ueW1lIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gbm93IHNob3dzIHVuYXZhaWxhYmxlIG1lbWJlcnMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQ2Ugc2Fsb24gYWZmaWNoZSBtYWludGVuYW50IGRlcyBtZW1icmVzIGluZGlzcG9uaWJsZXMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBkb2VzIG5vdCBzaG93IHVuYXZhaWxhYmxlIG1lbWJlcnMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQ2Ugc2Fsb24gbidhZmZpY2hlIHBhcyBsZXMgbWVtYnJlcyBpbmRpc3BvbmlibGVzIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJOb24tcHJpdmFjeS1yZWxhdGVkIHJvb20gY29uZmlndXJhdGlvbiBoYXMgY2hhbmdlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJMZXMgcGFyYW3DqHRyZXMgZHUgc2Fsb24gbm9uIGxpw6lzIMOgIGxhIGNvbmZpZGVudGlhbGl0w6kgb250IMOpdMOpIG1vZGlmacOpcyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUm9vbSBsb2dnaW5nIGlzIG5vdyBlbmFibGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkxlIGxvZ2dpbmcgZHUgc2Fsb24gZXN0IGFjdGl2w6kiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJvb20gbG9nZ2luZyBpcyBub3cgZGlzYWJsZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTGUgbG9nZ2luZyBkdSBzYWxvbiBlc3QgZMOpc2FjdGl2w6kiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBpcyBub3cgbm9uLWFub255bW91cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDZSBzYWxvbiBlc3QgbWFpbnRlbmFudCBub24tYW5vbnltZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyByb29tIGlzIG5vdyBzZW1pLWFub255bW91cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDZSBzYWxvbiBlc3QgbWFpbnRlbmFudCBzZW1pLWFub255bWUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBpcyBub3cgZnVsbHktYW5vbnltb3VzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkNlIHNhbG9uIGVzdCBtYWludGVuYW50IGVudGnDqHJlbWVudCBhbm9ueW1lIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJBIG5ldyByb29tIGhhcyBiZWVuIGNyZWF0ZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVW4gbm91dmVhdSBzYWxvbiBhIMOpdMOpIGNyw6nDqSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBuaWNrbmFtZSBoYXMgYmVlbiBjaGFuZ2VkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlZvdHJlIGFsaWFzIGEgw6l0w6kgbW9kaWZpw6kiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIjxzdHJvbmc+JTEkczwvc3Ryb25nPiBoYXMgYmVlbiBiYW5uZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IGEgw6l0w6kgYmFubmkiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIjxzdHJvbmc+JTEkczwvc3Ryb25nPiBoYXMgYmVlbiBraWNrZWQgb3V0IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIjxzdHJvbmc+JTEkczwvc3Ryb25nPiBhIMOpdMOpIGV4cHVsc8OpIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gaGFzIGJlZW4gcmVtb3ZlZCBiZWNhdXNlIG9mIGFuIGFmZmlsaWF0aW9uIGNoYW5nZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gYSDDqXTDqSBzdXBwcmltw6kgw6AgY2F1c2UgZCd1biBjaGFuZ2VtZW50IGQnYWZmaWxpYXRpb24iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIjxzdHJvbmc+JTEkczwvc3Ryb25nPiBoYXMgYmVlbiByZW1vdmVkIGZvciBub3QgYmVpbmcgYSBtZW1iZXIiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IGEgw6l0w6kgc3VwcHJpbcOpIGNhciBpbCBuJ2VzdCBwYXMgbWVtYnJlIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3UgaGF2ZSBiZWVuIGJhbm5lZCBmcm9tIHRoaXMgcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJWb3VzIGF2ZXogw6l0w6kgYmFubmkgZGUgY2Ugc2Fsb24iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdSBoYXZlIGJlZW4ga2lja2VkIGZyb20gdGhpcyByb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlZvdXMgYXZleiDDqXTDqSBleHB1bHPDqSBkZSBjZSBzYWxvbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91IGhhdmUgYmVlbiByZW1vdmVkIGZyb20gdGhpcyByb29tIGJlY2F1c2Ugb2YgYW4gYWZmaWxpYXRpb24gY2hhbmdlIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlZvdXMgYXZleiDDqXTDqSByZXRpcsOpIGRlIGNlIHNhbG9uIGR1IGZhaXQgZCd1biBjaGFuZ2VtZW50IGQnYWZmaWxpYXRpb24iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdSBoYXZlIGJlZW4gcmVtb3ZlZCBmcm9tIHRoaXMgcm9vbSBiZWNhdXNlIHRoZSByb29tIGhhcyBjaGFuZ2VkIHRvIG1lbWJlcnMtb25seSBhbmQgeW91J3JlIG5vdCBhIG1lbWJlciI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJWb3VzIGF2ZXogw6l0w6kgcmV0aXLDqSBkZSBjZSBzYWxvbiBwYXJjZSBxdWUgY2Ugc2Fsb24gZXN0IGRldmVudSByw6lzZXJ2w6kgYXV4IG1lbWJyZXMgZXQgdm91cyBuJ8OqdGVzIHBhcyBtZW1icmUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdSBoYXZlIGJlZW4gcmVtb3ZlZCBmcm9tIHRoaXMgcm9vbSBiZWNhdXNlIHRoZSBNVUMgKE11bHRpLXVzZXIgY2hhdCkgc2VydmljZSBpcyBiZWluZyBzaHV0IGRvd24uIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlZvdXMgYXZleiDDqXTDqSByZXRpcsOpIGRlIGNlIHNhbG9uIHBhcmNlIHF1ZSBsZSBzZXJ2aWNlIGRlIGNoYXQgbXVsdGktdXRpbGlzYXRldXIgYSDDqXTDqSBkw6lzYWN0aXbDqS4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdSBhcmUgbm90IG9uIHRoZSBtZW1iZXIgbGlzdCBvZiB0aGlzIHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVm91cyBuJ8OqdGVzIHBhcyBkYW5zIGxhIGxpc3RlIGRlcyBtZW1icmVzIGRlIGNlIHNhbG9uIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJObyBuaWNrbmFtZSB3YXMgc3BlY2lmaWVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkF1Y3VuIGFsaWFzIG4nYSDDqXTDqSBpbmRpcXXDqSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91IGFyZSBub3QgYWxsb3dlZCB0byBjcmVhdGUgbmV3IHJvb21zIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlZvdXMgbifDqnRlcyBwYXMgYXV0b3Jpc8OpIMOgIGNyw6llciBkZXMgc2Fsb25zIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG5pY2tuYW1lIGRvZXNuJ3QgY29uZm9ybSB0byB0aGlzIHJvb20ncyBwb2xpY2llcyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJWb3RyZSBhbGlhcyBuJ2VzdCBwYXMgY29uZm9ybWUgw6AgbGEgcG9saXRpcXVlIGRlIGNlIHNhbG9uIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG5pY2tuYW1lIGlzIGFscmVhZHkgdGFrZW4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVm90cmUgYWxpYXMgZXN0IGTDqWrDoCB1dGlsaXPDqSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyByb29tIGRvZXMgbm90ICh5ZXQpIGV4aXN0IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkNlIHNhbG9uIG4nZXhpc3RlIHBhcyBlbmNvcmUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBoYXMgcmVhY2hlZCBpdCdzIG1heGltdW0gbnVtYmVyIG9mIG9jY3VwYW50cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDZSBzYWxvbiBhIGF0dGVpbnQgbGEgbGltaXRlIG1heGltYWxlIGQnb2NjdXBhbnRzIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUb3BpYyBzZXQgYnkgJTEkcyB0bzogJTIkcyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJMZSBzdWpldCAnJTEkcycgYSDDqXTDqSBkw6lmaW5pIHBhciAlMiRzIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHVzZXIgaXMgYSBtb2RlcmF0b3IiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQ2V0IHV0aWxpc2F0ZXVyIGVzdCBtb2TDqXJhdGV1ciIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyB1c2VyIGNhbiBzZW5kIG1lc3NhZ2VzIGluIHRoaXMgcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDZXQgdXRpbGlzYXRldXIgcGV1dCBlbnZveWVyIGRlcyBtZXNzYWdlcyBkYW5zIGNlIHNhbG9uIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHVzZXIgY2FuIE5PVCBzZW5kIG1lc3NhZ2VzIGluIHRoaXMgcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDZXQgdXRpbGlzYXRldXIgbmUgcGV1dCBQQVMgZW52b3llciBkZSBtZXNzYWdlcyBkYW5zIGNlIHNhbG9uIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDbGljayB0byBjaGF0IHdpdGggdGhpcyBjb250YWN0IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkNsaXF1ZXogcG91ciBkaXNjdXRlciBhdmVjIGNlIGNvbnRhY3QiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNsaWNrIHRvIHJlbW92ZSB0aGlzIGNvbnRhY3QiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQ2xpcXVleiBwb3VyIHN1cHByaW1lciBjZSBjb250YWN0IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIGNvbnRhY3QgaXMgYnVzeSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgY29udGFjdCBpcyBvbmxpbmUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIGNvbnRhY3QgaXMgb2ZmbGluZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgY29udGFjdCBpcyB1bmF2YWlsYWJsZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDZSBzYWxvbiBhZmZpY2hlIG1haW50ZW5hbnQgZGVzIG1lbWJyZXMgaW5kaXNwb25pYmxlcyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyBjb250YWN0IGlzIGF3YXkgZm9yIGFuIGV4dGVuZGVkIHBlcmlvZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgY29udGFjdCBpcyBhd2F5IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ29udGFjdCByZXF1ZXN0cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJEZW1hbmRlcyBkZSBjb250YWN0cyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTXkgY29udGFjdHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTWVzIGNvbnRhY3RzIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJQZW5kaW5nIGNvbnRhY3RzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkNvbnRhY3RzIGVuIGF0dGVudGUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkN1c3RvbSBzdGF0dXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU3RhdHV0IHBlcnNvbm5lbCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgdG8gY2hhbmdlIHlvdXIgY2hhdCBzdGF0dXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQ2xpcXVleiBwb3VyIGNoYW5nZXIgdm90cmUgc3RhdHV0IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDbGljayBoZXJlIHRvIHdyaXRlIGEgY3VzdG9tIHN0YXR1cyBtZXNzYWdlIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkNsaXF1ZXogaWNpIHBvdXIgaW5kaXF1ZXIgdm90cmUgc3RhdHV0IHBlcnNvbm5lbCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAib25saW5lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgImVuIGxpZ25lIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJidXN5IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIm9jY3Vww6kiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgImF3YXkgZm9yIGxvbmciOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiYWJzZW50IHBvdXIgdW5lIGxvbmd1ZSBkdXLDqWUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgImF3YXkiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiYWJzZW50IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJJIGFtICUxJHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSmUgc3VpcyAlMSRzIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTaWduIGluIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlMnaW5zY3JpcmUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlhNUFAvSmFiYmVyIFVzZXJuYW1lOiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJOb20gZCd1dGlsaXNhdGV1ciBYTVBQL0phYmJlciIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUGFzc3dvcmQ6IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk1vdCBkZSBwYXNzZSA6IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJMb2cgSW4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU2UgY29ubmVjdGVyIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJCT1NIIFNlcnZpY2UgVVJMOiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJVUkwgZHUgc2VydmljZSBCT1NIOiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiT25saW5lIENvbnRhY3RzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkNvbnRhY3RzIGVuIGxpZ25lIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb25uZWN0ZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQ29ubmVjdMOpIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJBdHRhY2hlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJBdHRhY2jDqSIKICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7CiAgICAgICAgZGVmaW5lKCJmciIsIFsnamVkJ10sIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkobmV3IEplZCh0cmFuc2xhdGlvbnMpKTsKICAgICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKCF3aW5kb3cubG9jYWxlcykgewogICAgICAgICAgICB3aW5kb3cubG9jYWxlcyA9IHt9OwogICAgICAgIH0KICAgICAgICB3aW5kb3cubG9jYWxlcy5mciA9IGZhY3RvcnkobmV3IEplZCh0cmFuc2xhdGlvbnMpKTsKICAgIH0KfSh0aGlzLCBmdW5jdGlvbiAoZnIpIHsKICAgIHJldHVybiBmcjsKfSkpOwoKKGZ1bmN0aW9uIChyb290LCBmYWN0b3J5KSB7CiAgICB2YXIgdHJhbnNsYXRpb25zID0gewogICAgICAgICJkb21haW4iOiAiY29udmVyc2UiLAogICAgICAgICJsb2NhbGVfZGF0YSI6IHsKICAgICAgICAgICAgImNvbnZlcnNlIjogewogICAgICAgICAgICAgICAgIiI6IHsKICAgICAgICAgICAgICAgICAgICAicHJvamVjdC1pZC12ZXJzaW9uIjogIkNvbnZlcnNlLmpzIDAuOC4xIiwKICAgICAgICAgICAgICAgICAgICAicmVwb3J0LW1zZ2lkLWJ1Z3MtdG8iOiAiIiwKICAgICAgICAgICAgICAgICAgICAicG90LWNyZWF0aW9uLWRhdGUiOiAiMjAxNC0wOC0yNSAxNDozNyswMjAwIiwKICAgICAgICAgICAgICAgICAgICAicG8tcmV2aXNpb24tZGF0ZSI6ICIyMDE0LTAyLTIxIDA2OjA3KzAyMDAiLAogICAgICAgICAgICAgICAgICAgICJsYXN0LXRyYW5zbGF0b3IiOiAiR3JlZW5MdW5hciA8R3JlZW5MdW5hckBnaXRodWIuY29tPiIsCiAgICAgICAgICAgICAgICAgICAgImxhbmd1YWdlLXRlYW0iOiAiUmFodXQgPGh0dHA6Ly9zb3VyY2Vmb3JnZS5uZXQvcHJvamVjdHMvcmFodXQvPiIsCiAgICAgICAgICAgICAgICAgICAgImxhbmd1YWdlIjogImhlIiwKICAgICAgICAgICAgICAgICAgICAibWltZS12ZXJzaW9uIjogIjEuMCIsCiAgICAgICAgICAgICAgICAgICAgImNvbnRlbnQtdHlwZSI6ICJ0ZXh0L3BsYWluOyBjaGFyc2V0PVVURi04IiwKICAgICAgICAgICAgICAgICAgICAiY29udGVudC10cmFuc2Zlci1lbmNvZGluZyI6ICI4Yml0IiwKICAgICAgICAgICAgICAgICAgICAieC1nZW5lcmF0b3IiOiAiUG9lZGl0IDEuNS4xIiwKICAgICAgICAgICAgICAgICAgICAicGx1cmFsLWZvcm1zIjogIm5wbHVyYWxzPTI7IHBsdXJhbD0obiAhPSAxKTsiCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgInVuZW5jcnlwdGVkIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15zXkCDXnteV16bXpNeg16oiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgInVudmVyaWZpZWQiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXnNeQINee15DXldee16rXqiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAidmVyaWZpZWQiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXnteQ15XXnteq16oiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgImZpbmlzaGVkIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi157XldeS157XqNeqIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIGNvbnRhY3QgaXMgYnVzeSI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteQ15nXqSDXp9ep16gg15bXlCDXoteh15XXpyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyBjb250YWN0IGlzIG9ubGluZSI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteQ15nXqSDXp9ep16gg15bXlCDXnten15XXldefIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIGNvbnRhY3QgaXMgb2ZmbGluZSI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteQ15nXqSDXp9ep16gg15bXlCDXnNeQINee16fXldeV158iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgY29udGFjdCBpcyB1bmF2YWlsYWJsZSI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteQ15nXqSDXp9ep16gg15bXlCDXnNeQINeW157XmdefIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIGNvbnRhY3QgaXMgYXdheSBmb3IgYW4gZXh0ZW5kZWQgcGVyaW9kIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15DXmdepINen16nXqCDXlteUINeg16LXk9eoINec157XqdeaINeW157XnyDXntee15XXqdeaIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIGNvbnRhY3QgaXMgYXdheSI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteQ15nXqSDXp9ep16gg15bXlCDXlNeZ16DXlSDXoNei15PXqCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgdG8gaGlkZSB0aGVzZSBjb250YWN0cyI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsItec15fXpSDXm9eT15kg15zXlNeh16rXmdeoINeQ16og15DXoNep15kg16fXqdeoINeQ15zXlCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTXkgY29udGFjdHMiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXkNeg16nXmSDXlNen16nXqCDXqdec15kiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlBlbmRpbmcgY29udGFjdHMiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXkNeg16nXmSDXp9ep16gg157Xnteq15nXoNeZ150iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNvbnRhY3QgcmVxdWVzdHMiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXkden16nXldeqINeQ15nXqSDXp9ep16giCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlVuZ3JvdXBlZCI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsItec15zXkCDXp9eR15XXpteUIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb250YWN0cyI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteQ16DXqdeZINen16nXqCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiR3JvdXBzIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi16fXkdeV16bXldeqIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSZWNvbm5lY3RpbmciOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXm9ei16og157XqteX15HXqCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiRGlzY29ubmVjdGVkIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi157XoNeV16rXpyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiRXJyb3IiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXqdeS15nXkNeUIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb25uZWN0aW5nIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15vXoteqINee16rXl9eR16giCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNvbm5lY3Rpb24gRmFpbGVkIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15fXmdeR15XXqCDXoNeb16nXnCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQXV0aGVudGljYXRpbmciOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXm9ei16og157XkNee16oiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkF1dGhlbnRpY2F0aW9uIEZhaWxlZCI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteQ15nXnteV16og16DXm9ep15wiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkRpc2Nvbm5lY3RpbmciOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXm9ei16og157Xqteg16rXpyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiT25saW5lIENvbnRhY3RzIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15DXoNep15kg16fXqdeoINee16fXldeV16DXmdedIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSZS1lc3RhYmxpc2hpbmcgZW5jcnlwdGVkIHNlc3Npb24iOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXkdeh16Eg157Xl9eT16kg15nXqdeZ15HXlCDXnteV16bXpNeg16oiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkdlbmVyYXRpbmcgcHJpdmF0ZSBrZXkuIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15vXoteqINee16TXmdenINee16TXqteXINek16jXmNeZLiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBicm93c2VyIG1pZ2h0IGJlY29tZSB1bnJlc3BvbnNpdmUuIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15TXk9ek15PXpNefINep15zXmiDXotep15XXmSDXqdec15Ag15zXlNeS15nXkS4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkF1dGhlbnRpY2F0aW9uIHJlcXVlc3QgZnJvbSAlMSRzXG5cbllvdXIgYnVkZHkgaXMgYXR0ZW1wdGluZyB0byB2ZXJpZnkgeW91ciBpZGVudGl0eSwgYnkgYXNraW5nIHlvdSB0aGUgcXVlc3Rpb24gYmVsb3cuXG5cbiUyJHMiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXkden16nXqiDXkNeZ157XldeqINee15DXqiAlMSRzXG5cbteU15DXmdep15nXldeqINep15vXoNeS15Mg157XoNeh15Qg15zXkNee16og15DXqiDXlNeW15TXldeqINep15zXmiwg15HXoteW16jXqiDXqdeQ15nXnNeqINep15DXnNeUINec15TXnNefLlxuXG4lMiRzIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb3VsZCBub3QgdmVyaWZ5IHRoaXMgdXNlcidzIGlkZW50aWZ5LiI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsItec15Ag15TXmdeq15Qg15DXpNep16jXldeqINec15DXnteqINeQ16og15bXlNeV16og157Xqdeq157XqSDXlteULiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiRXhjaGFuZ2luZyBwcml2YXRlIGtleSB3aXRoIGJ1ZGR5LiI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsItee157XmdeoINee16TXqteXINek16jXmNeZINei150g15DXmdepINen16nXqC4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlBlcnNvbmFsIG1lc3NhZ2UiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXlNeV15PXoteUINeQ15nXqdeZ16oiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBjbGVhciB0aGUgbWVzc2FnZXMgZnJvbSB0aGlzIHJvb20/IjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15TXkNedINeQ16rXlCDXkdeY15XXlyDXm9eZINeR16jXpteV16DXmiDXnNeY15TXqCDXkNeqINeU15TXldeT16LXldeqINee16rXldeaINeX15PXqCDXlteUPyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAibWUiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXkNeg15kiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgImlzIHR5cGluZyI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsItee16fXnNeZ15Mv15Qg15vXoteqIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJoYXMgc3RvcHBlZCB0eXBpbmciOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXl9eT15wv15Qg157XnNeU16fXnNeZ15MiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNob3cgdGhpcyBtZW51IjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15TXpteSINeQ16og16rXpNeo15nXmCDXlteUIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJXcml0ZSBpbiB0aGUgdGhpcmQgcGVyc29uIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15vXqteV15Eg15HXkteV16Mg15TXqdec15nXqdeZIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSZW1vdmUgbWVzc2FnZXMiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXlNeh16gg15TXldeT16LXldeqIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gY2xlYXIgdGhlIG1lc3NhZ2VzIGZyb20gdGhpcyBjaGF0IGJveD8iOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXlNeQ150g15DXqteUINeR15jXldeXINeb15kg15HXqNem15XXoNeaINec15jXlNeoINeQ16og15TXlNeV15PXoteV16og157XqteV15og16rXmdeR16og16nXmdeX15Qg15bXlD8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgbWVzc2FnZSBjb3VsZCBub3QgYmUgc2VudCI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteU15TXldeT16LXlCDXqdec15og15zXkCDXlNeZ16rXlCDXmdeb15XXnNeUINec15TXmdep15zXlyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiV2UgcmVjZWl2ZWQgYW4gdW5lbmNyeXB0ZWQgbWVzc2FnZSI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteQ16DXl9eg15Ug16fXmdeR15zXoNeVINeU15XXk9ei15Qg15zXkCDXnteV16bXpNeg16oiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIldlIHJlY2VpdmVkIGFuIHVucmVhZGFibGUgZW5jcnlwdGVkIG1lc3NhZ2UiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXkNeg15fXoNeVINen15nXkdec16DXlSDXlNeV15PXoteUINee15XXptek16DXqiDXnNeQINen16jXmdeQ15QiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgdXNlciBoYXMgcmVxdWVzdGVkIGFuIGVuY3J5cHRlZCBzZXNzaW9uLiI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsItee16nXqtee16kg15bXlCDXkdeZ16fXqSDXmdep15nXkdeUINee15XXptek16DXqi4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkhlcmUgYXJlIHRoZSBmaW5nZXJwcmludHMsIHBsZWFzZSBjb25maXJtIHRoZW0gd2l0aCAlMSRzLCBvdXRzaWRlIG9mIHRoaXMgY2hhdC5cblxuRmluZ2VycHJpbnQgZm9yIHlvdSwgJTIkczogJTMkc1xuXG5GaW5nZXJwcmludCBmb3IgJTEkczogJTQkc1xuXG5JZiB5b3UgaGF2ZSBjb25maXJtZWQgdGhhdCB0aGUgZmluZ2VycHJpbnRzIG1hdGNoLCBjbGljayBPSywgb3RoZXJ3aXNlIGNsaWNrIENhbmNlbC4iOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXlNeo15kg15jXkdeZ16LXldeqINeU15DXpteR16IsINeQ16DXkCDXkNee16og15DXldeq158g16LXnSAlMSRzLCDXnteX15XXpSDXnNep15nXl9eUINeW15UuXG5cbteY15HXmdei16og15DXpteR16Ig16LXkdeV16jXmiwgJTIkczogJTMkc1xuXG7XmNeR15nXoteqINeQ16bXkdeiINei15HXldeoICUxJHM6ICU0JHNcblxu15TXmdeUINeV15DXmdee16rXqiDXm9eZINeY15HXmdei15XXqiDXlNeQ16bXkdeiINeq15XXkNee15XXqiwg15zXl9elINeQ15nXqdeV16ggKE9LKSwg15DXl9eo16og15zXl9elINeR15nXmNeV15wgKENhbmNlbCkuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3Ugd2lsbCBiZSBwcm9tcHRlZCB0byBwcm92aWRlIGEgc2VjdXJpdHkgcXVlc3Rpb24gYW5kIHRoZW4gYW4gYW5zd2VyIHRvIHRoYXQgcXVlc3Rpb24uXG5cbllvdXIgYnVkZHkgd2lsbCB0aGVuIGJlIHByb21wdGVkIHRoZSBzYW1lIHF1ZXN0aW9uIGFuZCBpZiB0aGV5IHR5cGUgdGhlIGV4YWN0IHNhbWUgYW5zd2VyIChjYXNlIHNlbnNpdGl2ZSksIHRoZWlyIGlkZW50aXR5IHdpbGwgYmUgdmVyaWZpZWQuIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15DXqteUINeq16rXkden16kg15zXodek16cg16nXkNec16og15DXkdeY15fXlCDXldec15DXl9eo15nXlCDXqtep15XXkdeUINec16nXkNec15Qg15TXlteVLlxuXG7XlNeQ15nXqdeZ15XXqiDXqdeb16DXkteTINeq16rXkden16kg16LXldeR16gg15bXkNeqINec15DXldeq15Qg16nXkNec16og15DXkdeY15fXlCDXldeQ150g15bXlSDXqten15zXmdeT15Ug15DXqiDXkNeqINeQ15XXqteUINeU16rXqdeV15HXlCDXkdee15PXldeZ16cgKGNhc2Ugc2Vuc2l0aXZlKSwg15bXlNeV16rXlCDXqteQ15XXnteqLiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiV2hhdCBpcyB5b3VyIHNlY3VyaXR5IHF1ZXN0aW9uPyI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsItee15TXmSDXqdeQ15zXqiDXlNeQ15HXmNeX15Qg16nXnNeaPyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiV2hhdCBpcyB0aGUgYW5zd2VyIHRvIHRoZSBzZWN1cml0eSBxdWVzdGlvbj8iOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXnteU15kg15TXqtep15XXkdeUINec16nXkNec16og15TXkNeR15jXl9eUPyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiSW52YWxpZCBhdXRoZW50aWNhdGlvbiBzY2hlbWUgcHJvdmlkZWQiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXodeV16TXp9eUINeh15vXmdee16og15DXmdee15XXqiDXqdeS15XXmdeUIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG1lc3NhZ2VzIGFyZSBub3QgZW5jcnlwdGVkIGFueW1vcmUiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXlNeU15XXk9ei15XXqiDXqdec15og15DXmdeg158g157Xldem16TXoNeV16og16LXldeTIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG1lc3NhZ2VzIGFyZSBub3cgZW5jcnlwdGVkIGJ1dCB5b3VyIGJ1ZGR5J3MgaWRlbnRpdHkgaGFzIG5vdCBiZWVuIHZlcmlmaWVkLiI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteU15TXldeT16LXldeqINep15zXmiDXnteV16bXpNeg15XXqiDXm9ei16og15DXmiDXlteU15XXqiDXlNeQ15nXqdeZ15XXqiDXqdeb16DXkteTINeY16jXnSDXkNeV157XqteULiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBidWRkeSdzIGlkZW50aWZ5IGhhcyBiZWVuIHZlcmlmaWVkLiI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteW15TXldeqINeU15DXmdep15nXldeqINep15vXoNeS15Mg15DXldee16rXlC4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgYnVkZHkgaGFzIGVuZGVkIGVuY3J5cHRpb24gb24gdGhlaXIgZW5kLCB5b3Ugc2hvdWxkIGRvIHRoZSBzYW1lLiI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteU15DXmdep15nXldeqINep15vXoNeS15Mg16HXmdeZ157XlCDXlNem16TXoNeUINeR16fXpteUINep15zXlCwg16LXnNeZ15og15zXotep15XXqiDXkNeqINeQ15XXqteVINeU15PXkdeoLiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBtZXNzYWdlcyBhcmUgbm90IGVuY3J5cHRlZC4gQ2xpY2sgaGVyZSB0byBlbmFibGUgT1RSIGVuY3J5cHRpb24uIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15TXlNeV15PXoteV16og16nXnNeaINeQ15nXoNefINee15XXptek16DXldeqLiDXnNeX16Ug15vXkNefINeb15PXmSDXnNeQ16TXqdeoIE9UUi4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgbWVzc2FnZXMgYXJlIGVuY3J5cHRlZCwgYnV0IHlvdXIgYnVkZHkgaGFzIG5vdCBiZWVuIHZlcmlmaWVkLiI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteU15TXldeT16LXldeqINep15zXmiDXnteV16bXpNeg15XXqiDXm9ei16osINeQ15og15TXkNeZ16nXmdeV16og16nXm9eg15LXkyDXmNeo150g15DXldee16rXlC4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgbWVzc2FnZXMgYXJlIGVuY3J5cHRlZCBhbmQgeW91ciBidWRkeSB2ZXJpZmllZC4iOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXlNeU15XXk9ei15XXqiDXqdec15og157Xldem16TXoNeV16og15vXoteqINeV15TXkNeZ16nXmdeV16og16nXm9eg15LXkyDXkNeV157XqteULiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBidWRkeSBoYXMgY2xvc2VkIHRoZWlyIGVuZCBvZiB0aGUgcHJpdmF0ZSBzZXNzaW9uLCB5b3Ugc2hvdWxkIGRvIHRoZSBzYW1lIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15TXkNeZ16nXmdeV16og16nXm9eg15LXkyDXodeS16jXlCDXkNeqINen16bXlCDXlNeZ16nXmdeR15Qg15TXpNeo15jXmdeqINep15zXlCwg16LXnNeZ15og15zXotep15XXqiDXkNeqINeQ15XXqteVINeU15PXkdeoIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJFbmQgZW5jcnlwdGVkIGNvbnZlcnNhdGlvbiI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteh15nXmdedINeZ16nXmdeR15Qg157Xldem16TXoNeqIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSZWZyZXNoIGVuY3J5cHRlZCBjb252ZXJzYXRpb24iOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXqNei16DXnyDXmdep15nXkdeUINee15XXptek16DXqiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU3RhcnQgZW5jcnlwdGVkIGNvbnZlcnNhdGlvbiI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteU16rXl9ecINeZ16nXmdeR15Qg157Xldem16TXoNeqIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJWZXJpZnkgd2l0aCBmaW5nZXJwcmludHMiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXkNee16og15HXoteW16jXqiDXmNeR15nXoteV16og15DXpteR16IiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlZlcmlmeSB3aXRoIFNNUCI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteQ157XqiDXkdei15bXqNeqIFNNUCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiV2hhdCdzIHRoaXM/IjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi157XlCDXlteUPyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiT25saW5lIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi157Xp9eV15XXnyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQnVzeSI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsItei16HXldenIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJBd2F5IjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi16DXoteT16giCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk9mZmxpbmUiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXkdec16rXmSDXnten15XXldefIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb250YWN0IG5hbWUiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXqdedINeQ15nXqSDXp9ep16giCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNlYXJjaCI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteX15nXpNeV16kiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNvbnRhY3QgdXNlcm5hbWUiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXqdedINee16nXqtee16kg15DXmdepINen16nXqCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQWRkIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15TXldeh16MiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNsaWNrIHRvIGFkZCBuZXcgY2hhdCBjb250YWN0cyI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsItec15fXpSDXm9eT15kg15zXlNeV16HXmdejINeQ16DXqdeZINen16nXqCDXqdeZ15fXlCDXl9eT16nXmdedIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJBZGQgYSBjb250YWN0IjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15TXldeh16Mg15DXmdepINen16nXqCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTm8gdXNlcnMgZm91bmQiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXnNeQINeg157XpteQ15Ug157Xqdeq157XqdeZ150iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNsaWNrIHRvIGFkZCBhcyBhIGNoYXQgY29udGFjdCI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsItec15fXpSDXm9eT15kg15zXlNeV16HXmdejINeR16rXldeoINeQ15nXqSDXp9ep16gg16nXmdeX15QiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJvb20gbmFtZSI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsItep150g15fXk9eoIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJOaWNrbmFtZSI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsItep150g15vXmdeg15XXmSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU2VydmVyIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi16nXqNeqIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJKb2luIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15TXpteY16jXoyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU2hvdyByb29tcyI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteU16bXkiDXl9eT16jXmdedIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSb29tcyI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteX15PXqNeZ150iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk5vIHJvb21zIG9uICUxJHMiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXkNeZ158g15fXk9eo15nXnSDXotecICUxJHMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJvb21zIG9uICUxJHMiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXl9eT16jXmdedINei15wgJTEkcyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgdG8gb3BlbiB0aGlzIHJvb20iOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXnNeX16Ug15vXk9eZINec16TXqteV15cg15DXqiDXl9eT16gg15bXlCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU2hvdyBtb3JlIGluZm9ybWF0aW9uIG9uIHRoaXMgcm9vbSI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteU16bXkiDXoteV15Mg157XmdeT16Ig15DXldeT15XXqiDXl9eT16gg15bXlCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiRGVzY3JpcHRpb246IjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi16rXmdeQ15XXqDoiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk9jY3VwYW50czoiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXoNeV15vXl9eZ1506IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJGZWF0dXJlczoiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXqteb15XXoNeV16o6IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSZXF1aXJlcyBhdXRoZW50aWNhdGlvbiI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsItee16bXqNeZ15og15DXmdep15XXqCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiSGlkZGVuIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi16DXodeq16giCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJlcXVpcmVzIGFuIGludml0YXRpb24iOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXntem16jXmdeaINeU15bXnteg15QiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk1vZGVyYXRlZCI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsItee15HXlden16giCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk5vbi1hbm9ueW1vdXMiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXnNeQINeQ16DXldeg15nXnteZIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJPcGVuIHJvb20iOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXl9eT16gg16TXqteV15ciCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlBlcm1hbmVudCByb29tIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15fXk9eoINem157Xmdeq15QiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlB1YmxpYyI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsItek15XXnteR15kiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNlbWktYW5vbnltb3VzIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15DXoNeV16DXmdee15kg15zXnteX16bXlCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGVtcG9yYXJ5IHJvb20iOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXl9eT16gg15bXnteg15kiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlVubW9kZXJhdGVkIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15zXkCDXnteR15XXp9eoIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTZXQgY2hhdHJvb20gdG9waWMiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXp9eR16Ig16DXldep15Ag15fXk9eoINep15nXl9eUIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJLaWNrIHVzZXIgZnJvbSBjaGF0cm9vbSI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteR16LXmCDXntep16rXntepINee16rXldeaINeX15PXqCDXqdeZ15fXlCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQmFuIHVzZXIgZnJvbSBjaGF0cm9vbSI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteQ16HXldeoINee16nXqtee16kg157XqteV15og15fXk9eoINep15nXl9eUIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJNZXNzYWdlIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15TXldeT16LXlCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU2F2ZSI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsItep157XldeoIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDYW5jZWwiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXkdeZ15jXldecIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJBbiBlcnJvciBvY2N1cnJlZCB3aGlsZSB0cnlpbmcgdG8gc2F2ZSB0aGUgZm9ybS4iOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXkNeZ16jXoteUINep15LXmdeQ15Qg15HXnteU15zXmiDXoNeZ16HXmdeV158g16nXnteZ16jXqiDXlNeY15XXpNehLiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyBjaGF0cm9vbSByZXF1aXJlcyBhIHBhc3N3b3JkIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15fXk9eoINep15nXl9eUINeW15Qg157Xpteo15nXmiDXodeZ16HXnteUIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJQYXNzd29yZDogIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi16HXmdeh157XlDogIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTdWJtaXQiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXqdec15ciCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBpcyBub3QgYW5vbnltb3VzIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15fXk9eoINeW15Qg15DXmdeg15Ug15DXoNeV16DXmdee15kiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBub3cgc2hvd3MgdW5hdmFpbGFibGUgbWVtYmVycyI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteX15PXqCDXlteUINeb16LXqiDXntem15nXkiDXl9eR16jXmdedINec15Ag15bXnteZ16DXmdedIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gZG9lcyBub3Qgc2hvdyB1bmF2YWlsYWJsZSBtZW1iZXJzIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15fXk9eoINeW15Qg15zXkCDXntem15nXkiDXl9eR16jXmdedINec15Ag15bXnteZ16DXmdedIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJOb24tcHJpdmFjeS1yZWxhdGVkIHJvb20gY29uZmlndXJhdGlvbiBoYXMgY2hhbmdlZCI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteq16bXldeo16og15fXk9eoINeQ16nXqCDXnNeQLden16nXldeo15Qt15HXpNeo15jXmdeV16og16nXldeg16rXlCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUm9vbSBsb2dnaW5nIGlzIG5vdyBlbmFibGVkIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15nXldee158g15fXk9eoINeU15nXoNeVINee15XXpNei15wg15vXoteqIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSb29tIGxvZ2dpbmcgaXMgbm93IGRpc2FibGVkIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15nXldee158g15fXk9eoINeU15nXoNeVINee16DXldeY16jXnCDXm9ei16oiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBpcyBub3cgbm9uLWFub255bW91cyI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteX15PXqCDXlteUINeQ15nXoNeVINeQ16DXldeg15nXnteZINeb16LXqiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyByb29tIGlzIG5vdyBzZW1pLWFub255bW91cyI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteX15PXqCDXlteUINeU15nXoNeVINeQ16DXldeg15nXnteZINec157Xl9em15Qg15vXoteqIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gaXMgbm93IGZ1bGx5LWFub255bW91cyI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteX15PXqCDXlteUINeU15nXoNeVINeQ16DXldeg15nXnteZINec15fXnNeV15jXmdefINeb16LXqiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQSBuZXcgcm9vbSBoYXMgYmVlbiBjcmVhdGVkIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15fXk9eoINeX15PXqSDXoNeV16bXqCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBuaWNrbmFtZSBoYXMgYmVlbiBjaGFuZ2VkIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi16nXnSDXlNeb15nXoNeV15kg16nXnNeaINep15XXoNeUIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gaGFzIGJlZW4gYmFubmVkIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwiPHN0cm9uZz4lMSRzPC9zdHJvbmc+INeg15DXodeoKNeUKSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IGhhcyBiZWVuIGtpY2tlZCBvdXQiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCI8c3Ryb25nPiUxJHM8L3N0cm9uZz4g16DXkdei15go15QpIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gaGFzIGJlZW4gcmVtb3ZlZCBiZWNhdXNlIG9mIGFuIGFmZmlsaWF0aW9uIGNoYW5nZSI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIjxzdHJvbmc+JTEkczwvc3Ryb25nPiDXlNeV16HXqNeUKNeUKSDXntep15XXnSDXqdeZ16DXldeZINep15nXldeaIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gaGFzIGJlZW4gcmVtb3ZlZCBmb3Igbm90IGJlaW5nIGEgbWVtYmVyIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwiPHN0cm9uZz4lMSRzPC9zdHJvbmc+INeU15XXodeoKNeUKSDXntep15XXnSDXkNeZINeU15nXntem15DXldeqINeR157XodeS16jXqiDXntei157XkyDXqdecINeX15HXqCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91IGhhdmUgYmVlbiBiYW5uZWQgZnJvbSB0aGlzIHJvb20iOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXoNeQ16HXqNeqINee16rXldeaINeX15PXqCDXlteUIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3UgaGF2ZSBiZWVuIGtpY2tlZCBmcm9tIHRoaXMgcm9vbSI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteg15HXoteY16og157XqteV15og15fXk9eoINeW15QiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdSBoYXZlIGJlZW4gcmVtb3ZlZCBmcm9tIHRoaXMgcm9vbSBiZWNhdXNlIG9mIGFuIGFmZmlsaWF0aW9uIGNoYW5nZSI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteU15XXodeo16og157XqteV15og15fXk9eoINeW15Qg157XqdeV150g16nXmdeg15XXmSDXqdeZ15XXmiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91IGhhdmUgYmVlbiByZW1vdmVkIGZyb20gdGhpcyByb29tIGJlY2F1c2UgdGhlIHJvb20gaGFzIGNoYW5nZWQgdG8gbWVtYmVycy1vbmx5IGFuZCB5b3UncmUgbm90IGEgbWVtYmVyIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15TXldeh16jXqiDXnteq15XXmiDXl9eT16gg15bXlCDXntep15XXnSDXqdeU15fXk9eoINep15XXoNeUINec15fXkdeo15nXnS3Xkdec15HXkyDXldeQ15nXoNeaINeR157Xotee15Mg16nXnCDXl9eR16giCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdSBoYXZlIGJlZW4gcmVtb3ZlZCBmcm9tIHRoaXMgcm9vbSBiZWNhdXNlIHRoZSBNVUMgKE11bHRpLXVzZXIgY2hhdCkgc2VydmljZSBpcyBiZWluZyBzaHV0IGRvd24uIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15TXldeh16jXqiDXnteq15XXmiDXl9eT16gg15bXlCDXntep15XXnSDXqdep15nXqNeV16og16nXnte0154gKNep15nXl9eUINee16jXldeR16og157Xqdeq157XqdeZ150pINeW15Qg15vXoteqINee16bXldeZINeR15TXnNeZ15vXmSDXodeS15nXqNeULiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91IGFyZSBub3Qgb24gdGhlIG1lbWJlciBsaXN0IG9mIHRoaXMgcm9vbSI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteQ15nXoNeaINeR16jXqdeZ157XqiDXlNeX15HXqNeZ150g16nXnCDXl9eT16gg15bXlCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTm8gbmlja25hbWUgd2FzIHNwZWNpZmllZCI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsItec15Ag16bXldeZ158g16nXldedINep150g15vXmdeg15XXmSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91IGFyZSBub3QgYWxsb3dlZCB0byBjcmVhdGUgbmV3IHJvb21zIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15DXmdefINec15og16jXqdeV16og15zXmdem15XXqCDXl9eT16jXmdedINeX15PXqdeZ150iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgbmlja25hbWUgZG9lc24ndCBjb25mb3JtIHRvIHRoaXMgcm9vbSdzIHBvbGljaWVzIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi16nXnSDXlNeb15nXoNeV15kg16nXnNeaINec15Ag16rXldeQ150g15DXqiDXlNee15PXmdeg15XXmdeV16og16nXnCDXl9eT16gg15bXlCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBuaWNrbmFtZSBpcyBhbHJlYWR5IHRha2VuIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi16nXnSDXlNeb15nXoNeV15kg16nXnNeaINeU15nXoNeVINeq16TXldehIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gZG9lcyBub3QgKHlldCkgZXhpc3QiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXl9eT16gg15bXlCAo16LXk9eZ15nXnykg15zXkCDXp9eZ15nXnSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyByb29tIGhhcyByZWFjaGVkIGl0J3MgbWF4aW11bSBudW1iZXIgb2Ygb2NjdXBhbnRzIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15fXk9eoINeW15Qg15TXkteZ16Ig15zXodejINeU16DXldeb15fXmdedINeU157XqNeR15kg16nXnNeVIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUb3BpYyBzZXQgYnkgJTEkcyB0bzogJTIkcyI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteg15XXqdeQINeX15PXqCDXlteUINeg16fXkdeiINei15wg15nXk9eZICUxJHMg15DXnDogJTIkcyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyB1c2VyIGlzIGEgbW9kZXJhdG9yIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi157Xqdeq157XqSDXlteUINeU15nXoNeVINeQ15fXqNeQ15kiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgdXNlciBjYW4gc2VuZCBtZXNzYWdlcyBpbiB0aGlzIHJvb20iOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXntep16rXntepINeW15Qg157XodeV15LXnCDXnNep15zXldeXINeU15XXk9ei15XXqiDXkdeq15XXmiDXl9eT16gg15bXlCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyB1c2VyIGNhbiBOT1Qgc2VuZCBtZXNzYWdlcyBpbiB0aGlzIHJvb20iOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXntep16rXntepINeW15Qg76yl76yhINee16HXldeS15wg15zXqdec15XXlyDXlNeV15PXoteV16og15HXqteV15og15fXk9eoINeW15QiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNsaWNrIHRvIHJlc3RvcmUgdGhpcyBjaGF0IjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15zXl9elINeb15PXmSDXnNep15fXlteoINeQ16og16nXmdeX15Qg15bXlSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTWluaW1pemVkIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi157XnteV15bXoteoIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gcmVtb3ZlIHRoaXMgY29udGFjdD8iOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXlNeQ150g15DXqteUINeR15jXldeXINeb15kg15HXqNem15XXoNeaINec15TXodeZ16gg15DXqiDXkNeZ16kg16fXqdeoINeW15Q/IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gZGVjbGluZSB0aGlzIGNvbnRhY3QgcmVxdWVzdD8iOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXlNeQ150g15DXqteUINeR15jXldeXINeb15kg15HXqNem15XXoNeaINec16HXqNeRINeQ16og15HXp9ep16og15DXmdepINen16nXqCDXlteUPyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgdG8gcmVtb3ZlIHRoaXMgY29udGFjdCI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsItec15fXpSDXm9eT15kg15zXlNeh15nXqCDXkNeqINeQ15nXqSDXp9ep16gg15bXlCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgdG8gYWNjZXB0IHRoaXMgY29udGFjdCByZXF1ZXN0IjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15zXl9elINeb15PXmSDXnNen15HXnCDXkNeqINeR16fXqdeqINeQ15nXqSDXp9ep16gg15bXlCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgdG8gZGVjbGluZSB0aGlzIGNvbnRhY3QgcmVxdWVzdCI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsItec15fXpSDXm9eT15kg15zXodeo15Eg15DXqiDXkden16nXqiDXkNeZ16kg16fXqdeoINeW15QiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNsaWNrIHRvIGNoYXQgd2l0aCB0aGlzIGNvbnRhY3QiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXnNeX16Ug15vXk9eZINec16nXldeX15cg16LXnSDXkNeZ16kg16fXqdeoINeW15QiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlR5cGUgdG8gZmlsdGVyIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15TXp9ec15Mg15vXk9eZINec16HXoNefIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDdXN0b20gc3RhdHVzIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi157XpteRINee15XXqteQ150iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIm9ubGluZSI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsItee16fXldeV158iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgImJ1c3kiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXoteh15XXpyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiYXdheSBmb3IgbG9uZyI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteg16LXk9eoINec15bXntefINee15QiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgImF3YXkiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXoNei15PXqCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiSSBhbSAlMSRzIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi157XpteR15kg15vXoteqINeU15nXoNeVICUxJHMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNsaWNrIGhlcmUgdG8gd3JpdGUgYSBjdXN0b20gc3RhdHVzIG1lc3NhZ2UiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXnNeX16Ug15vXkNefINeb15PXmSDXnNeb16rXldeRINeU15XXk9ei16og157XpteRINee15XXqteQ157XqiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgdG8gY2hhbmdlIHlvdXIgY2hhdCBzdGF0dXMiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXnNeX16Ug15vXk9eZINec16nXoNeV16og15DXqiDXlNeV15PXoteqINeU16nXmdeX15Qg16nXnNeaIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJYTVBQL0phYmJlciBVc2VybmFtZToiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXqdedINee16nXqtee16kgWE1QUC9KYWJiZXI6IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJQYXNzd29yZDoiOlsKICAgICAgICAgICAgICAgICAgICBudWxsLCLXodeZ16HXnteUOiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTG9nIEluIjpbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwi15vXoNeZ16HXlCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU2lnbiBpbiI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteU16rXl9eR16jXldeqIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUb2dnbGUgY2hhdCI6WwogICAgICAgICAgICAgICAgICAgIG51bGwsIteU16TXotecINep15nXlyIKICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CiAgICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7CiAgICAgICAgZGVmaW5lKCJoZSIsIFsnamVkJ10sIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkobmV3IEplZCh0cmFuc2xhdGlvbnMpKTsKICAgICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKCF3aW5kb3cubG9jYWxlcykgewogICAgICAgICAgICB3aW5kb3cubG9jYWxlcyA9IHt9OwogICAgICAgIH0KICAgICAgICB3aW5kb3cubG9jYWxlcy5oZSA9IGZhY3RvcnkobmV3IEplZCh0cmFuc2xhdGlvbnMpKTsKICAgIH0KfSh0aGlzLCBmdW5jdGlvbiAoaGUpIHsKICAgIHJldHVybiBoZTsKfSkpOwoKKGZ1bmN0aW9uKHJvb3QsIGZhY3RvcnkpIHsKCXZhciB0cmFuc2xhdGlvbnMgPSB7CgkJImRvbWFpbiIgOiAiY29udmVyc2UiLAoJCSJsb2NhbGVfZGF0YSIgOiB7CgkJCSJjb252ZXJzZSIgOiB7CgkJCQkiIiA6IHsKCQkJCQkiUHJvamVjdC1JZC1WZXJzaW9uIiA6ICJDb252ZXJzZS5qcyAwLjQiLAoJCQkJCSJSZXBvcnQtTXNnaWQtQnVncy1UbyIgOiAiIiwKCQkJCQkiUE9ULUNyZWF0aW9uLURhdGUiIDogIjIwMTMtMDktMjQgMjM6MjIrMDIwMCIsCgkJCQkJIlBPLVJldmlzaW9uLURhdGUiIDogIjIwMTMtMDktMjUgMjI6NDIrMDIwMCIsCgkJCQkJIkxhc3QtVHJhbnNsYXRvciIgOiAiS3Jpc3p0aWFuIEtvbXBhciA8dzNob3N0QHczaG9zdC5odT4iLAoJCQkJCSJMYW5ndWFnZS1UZWFtIiA6ICJIdW5nYXJpYW4iLAoJCQkJCSJMYW5ndWFnZSIgOiAiaHUiLAoJCQkJCSJNSU1FLVZlcnNpb24iIDogIjEuMCIsCgkJCQkJIkNvbnRlbnQtVHlwZSIgOiAidGV4dC9wbGFpbjsgY2hhcnNldD1VVEYtOCIsCgkJCQkJIkNvbnRlbnQtVHJhbnNmZXItRW5jb2RpbmciIDogIjhiaXQiLAoJCQkJCSJkb21haW4iIDogImNvbnZlcnNlIiwKCQkJCQkibGFuZyIgOiAiaHUiLAoJCQkJCSJwbHVyYWxfZm9ybXMiIDogIm5wbHVyYWxzPTI7IHBsdXJhbD0obiAhPSAxKTsiCgkJCQl9LAoJCQkJIkRpc2Nvbm5lY3RlZCIgOiBbIG51bGwsICJTesOpdGthcGNzb2x2YSIgXSwKCQkJCSJFcnJvciIgOiBbIG51bGwsICJIaWJhIiBdLAoJCQkJIkNvbm5lY3RpbmciIDogWyBudWxsLCAiS2FwY3NvbMOzZMOhcyIgXSwKCQkJCSJDb25uZWN0aW9uIEZhaWxlZCIgOiBbIG51bGwsICJLYXBjc29sw7Nkw6FzaSBoaWJhIiBdLAoJCQkJIkF1dGhlbnRpY2F0aW5nIiA6IFsgbnVsbCwgIkF6b25vc8OtdMOhcyIgXSwKCQkJCSJBdXRoZW50aWNhdGlvbiBGYWlsZWQiIDogWyBudWxsLCAiQXpvbm9zw610w6FzaSBoaWJhIiBdLAoJCQkJIkRpc2Nvbm5lY3RpbmciIDogWyBudWxsLCAiU3rDqXRrYXBjc29sw6FzIiBdLAoJCQkJIm1lIiA6IFsgbnVsbCwgIsOpbiIgXSwKCQkJCSIlMSRzIGlzIHR5cGluZyIgOiBbIG51bGwsICIlMSRzIGfDqXBlbCIgXSwKCQkJCSJTaG93IHRoaXMgbWVudSIgOiBbIG51bGwsICJNdXRhc2QgZXp0IGEgbWVuw7x0IiBdLAoJCQkJIldyaXRlIGluIHRoZSB0aGlyZCBwZXJzb24iIDogWyBudWxsLCAiIiBdLAoJCQkJIlJlbW92ZSBtZXNzYWdlcyIgOiBbIG51bGwsICLDnHplbmV0IHTDtnJsw6lzZSIgXSwKCQkJCSJQZXJzb25hbCBtZXNzYWdlIiA6IFsgbnVsbCwgIlNhasOhdCDDvHplbmV0IiBdLAoJCQkJIkNvbnRhY3RzIiA6IFsgbnVsbCwgIkthcGNzb2xhdG9rIiBdLAoJCQkJIk9ubGluZSIgOiBbIG51bGwsICJFbMOpcmhldMWRIiBdLAoJCQkJIkJ1c3kiIDogWyBudWxsLCAiRm9nbGFsdCIgXSwKCQkJCSJBd2F5IiA6IFsgbnVsbCwgIlTDoXZvbCIgXSwKCQkJCSJPZmZsaW5lIiA6IFsgbnVsbCwgIk5lbSBlbMOpcmhldMWRIiBdLAoJCQkJIkNsaWNrIHRvIGFkZCBuZXcgY2hhdCBjb250YWN0cyIgOiBbIG51bGwsCgkJCQkJCSLDmmoga2FwY3NvbGF0b2sgaG96esOhYWTDoXNhIiBdLAoJCQkJIkFkZCBhIGNvbnRhY3QiIDogWyBudWxsLCAiw5pqIGthcGNzb2xhdCIgXSwKCQkJCSJDb250YWN0IHVzZXJuYW1lIiA6IFsgbnVsbCwgIkZlbGhhc3puw6Fsw7Nuw6l2IiBdLAoJCQkJIkFkZCIgOiBbIG51bGwsICJIb3p6w6FhZMOhcyIgXSwKCQkJCSJDb250YWN0IG5hbWUiIDogWyBudWxsLCAiS2FwY3NvbGF0IG5ldmUiIF0sCgkJCQkiU2VhcmNoIiA6IFsgbnVsbCwgIktlcmVzw6lzIiBdLAoJCQkJIk5vIHVzZXJzIGZvdW5kIiA6IFsgbnVsbCwgIk5pbmNzIHRhbMOhbGF0IiBdLAoJCQkJIkNsaWNrIHRvIGFkZCBhcyBhIGNoYXQgY29udGFjdCIgOiBbIG51bGwsCgkJCQkJCSJDc2V2ZWfFkSBrYXBjc29sYXRrw6ludCBob3p6w6FhZCIgXSwKCQkJCSJDbGljayB0byBvcGVuIHRoaXMgcm9vbSIgOiBbIG51bGwsICJCZWzDqXDDqXMgYSBjc2V2ZWfFkSBzem9iw6FiYSIgXSwKCQkJCSJTaG93IG1vcmUgaW5mb3JtYXRpb24gb24gdGhpcyByb29tIiA6IFsgbnVsbCwKCQkJCQkJIlRvdsOhYmJpIGluZm9ybcOhY2nDs2sgYSBjc2V2ZWfFkSBzem9iw6Fyw7NsIiBdLAoJCQkJIkRlc2NyaXB0aW9uOiIgOiBbIG51bGwsICJMZcOtcsOhczoiIF0sCgkJCQkiT2NjdXBhbnRzOiIgOiBbIG51bGwsICJKZWxlbmxldsWRazoiIF0sCgkJCQkiRmVhdHVyZXM6IiA6IFsgbnVsbCwgIlR1bGFqZG9uc8OhZ29rIiBdLAoJCQkJIlJlcXVpcmVzIGF1dGhlbnRpY2F0aW9uIiA6IFsgbnVsbCwgIkF6b25vc8OtdMOhcyBzesO8a3PDqWdlcyIgXSwKCQkJCSJIaWRkZW4iIDogWyBudWxsLCAiUmVqdGV0dCIgXSwKCQkJCSJSZXF1aXJlcyBhbiBpbnZpdGF0aW9uIiA6IFsgbnVsbCwgIk1lZ2jDrXbDoXMgc3rDvGtzw6lnZXMiIF0sCgkJCQkiTW9kZXJhdGVkIiA6IFsgbnVsbCwgIk1vZGVyw6FsdCIgXSwKCQkJCSJOb24tYW5vbnltb3VzIiA6IFsgbnVsbCwgIk5FTSBuw6l2dGVsZW4iIF0sCgkJCQkiT3BlbiByb29tIiA6IFsgbnVsbCwgIk55aXRvdHQgc3pvYmEiIF0sCgkJCQkiUGVybWFuZW50IHJvb20iIDogWyBudWxsLCAiw4FsbGFuZMOzIHN6b2JhIiBdLAoJCQkJIlB1YmxpYyIgOiBbIG51bGwsICJOecOtbHbDoW5vcyIgXSwKCQkJCSJTZW1pLWFub255bW91cyIgOiBbIG51bGwsICJGw6lsaWcgbsOpdnRlbGVuIiBdLAoJCQkJIlRlbXBvcmFyeSByb29tIiA6IFsgbnVsbCwgIklkZWlnbGVuZXMgc3pvYmEiIF0sCgkJCQkiVW5tb2RlcmF0ZWQiIDogWyBudWxsLCAiTW9kZXLDoWxhdGxhbiIgXSwKCQkJCSJSb29tcyIgOiBbIG51bGwsICJTem9iw6FrIiBdLAoJCQkJIlJvb20gbmFtZSIgOiBbIG51bGwsICJBIHN6b2JhIG5ldmUiIF0sCgkJCQkiTmlja25hbWUiIDogWyBudWxsLCAiQmVjZW7DqXYiIF0sCgkJCQkiU2VydmVyIiA6IFsgbnVsbCwgIlN6ZXJ2ZXIiIF0sCgkJCQkiSm9pbiIgOiBbIG51bGwsICJDc2F0bGFrb3rDoXMiIF0sCgkJCQkiU2hvdyByb29tcyIgOiBbIG51bGwsICJMw6l0ZXrFkSBzem9iw6FrIiBdLAoJCQkJIk5vIHJvb21zIG9uICUxJHMiIDogWyBudWxsLAoJCQkJCQkiTmluY3MgY3NldmVnxZEgc3pvYmEgYSh6KSAlMSRzIHN6ZXJ2ZXJlbiIgXSwKCQkJCSJSb29tcyBvbiAlMSRzIiA6IFsgbnVsbCwgIkNzZXZlZ8WRIHN6b2LDoWsgYSh6KSAlMSRzIHN6ZXJ2ZXJlbiIgXSwKCQkJCSJTZXQgY2hhdHJvb20gdG9waWMiIDogWyBudWxsLCAiQ3NldmVnxZFzem9iYSB0w6ltYSBiZcOhbGzDrXTDoXMiIF0sCgkJCQkiS2ljayB1c2VyIGZyb20gY2hhdHJvb20iIDogWyBudWxsLAoJCQkJCQkiRmVsaGFzem7DoWzDsyBraWzDqXB0ZXTDqXNlIGEgY3NldmVnxZEgc3pvYsOhYsOzbCIgXSwKCQkJCSJCYW4gdXNlciBmcm9tIGNoYXRyb29tIiA6IFsgbnVsbCwKCQkJCQkJIkZlbGhhc3puw6Fsw7Mga2l0w61sdMOhc2EgYSBjc2V2ZWfFkSBzem9iw6Fiw7NsIiBdLAoJCQkJIk1lc3NhZ2UiIDogWyBudWxsLCAiw5x6ZW5ldCIgXSwKCQkJCSJTYXZlIiA6IFsgbnVsbCwgIk1lbnTDqXMiIF0sCgkJCQkiQ2FuY2VsIiA6IFsgbnVsbCwgIk3DqWdzZW0iIF0sCgkJCQkiQW4gZXJyb3Igb2NjdXJyZWQgd2hpbGUgdHJ5aW5nIHRvIHNhdmUgdGhlIGZvcm0uIiA6IFsgbnVsbCwKCQkJCQkJIkhpYmEgdMO2cnTDqW50IGF6IGFkYXRvayBtZW50w6lzZSBrw7Z6YmVuLiIgXSwKCQkJCSJUaGlzIGNoYXRyb29tIHJlcXVpcmVzIGEgcGFzc3dvcmQiIDogWyBudWxsLAoJCQkJCQkiQSBjc2V2ZWfFkSBzem9iYSBiZWzDqXDDqXNoZXogamVsc3rDsyBzesO8a3PDqWdlcyIgXSwKCQkJCSJQYXNzd29yZDogIiA6IFsgbnVsbCwgIkplbHN6w7M6IiBdLAoJCQkJIlN1Ym1pdCIgOiBbIG51bGwsICJLw7xsZMOpcyIgXSwKCQkJCSJUaGlzIHJvb20gaXMgbm90IGFub255bW91cyIgOiBbIG51bGwsCgkJCQkJCSJFeiBhIHN6b2JhIE5FTSBuw6l2dGVsZW4iIF0sCgkJCQkiVGhpcyByb29tIG5vdyBzaG93cyB1bmF2YWlsYWJsZSBtZW1iZXJzIiA6IFsgbnVsbCwKCQkJCQkJIkV6IGEgc3pvYmEgbXV0YXRqYSBheiBlbMOpcmhldGV0bGVuIHRhZ29rYXQiIF0sCgkJCQkiVGhpcyByb29tIGRvZXMgbm90IHNob3cgdW5hdmFpbGFibGUgbWVtYmVycyIgOiBbIG51bGwsCgkJCQkJCSJFeiBhIHN6b2JhIG5lbSBtdXRhdGphIGF6IGVsw6lyaGV0ZXRsZW4gdGFnb2thdCIgXSwKCQkJCSJOb24tcHJpdmFjeS1yZWxhdGVkIHJvb20gY29uZmlndXJhdGlvbiBoYXMgY2hhbmdlZCIgOiBbIG51bGwsCgkJCQkJCSJBIHN6b2JhIMOhbHRhbMOhbm9zIGtvbmZpZ3Vyw6FjacOzamEgbcOzZG9zdWx0IiBdLAoJCQkJIlJvb20gbG9nZ2luZyBpcyBub3cgZW5hYmxlZCIgOiBbIG51bGwsCgkJCQkJCSJBIHN6b2LDoWJhIGEgYmVsw6lww6lzIGxlaGV0c8OpZ2VzIiBdLAoJCQkJIlJvb20gbG9nZ2luZyBpcyBub3cgZGlzYWJsZWQiIDogWyBudWxsLAoJCQkJCQkiQSBzem9iw6FiYSBhIGJlbMOpcMOpcyBzesO8bmV0ZWwiIF0sCgkJCQkiVGhpcyByb29tIGlzIG5vdyBub24tYW5vbnltb3VzIiA6IFsgbnVsbCwKCQkJCQkJIkV6IGEgc3pvYmEgbW9zdCBORU0gbsOpdnRlbGVuIiBdLAoJCQkJIlRoaXMgcm9vbSBpcyBub3cgc2VtaS1hbm9ueW1vdXMiIDogWyBudWxsLAoJCQkJCQkiRXogYSBzem9iYSBtb3N0IGbDqWxpZyBuw6l2dGVsZW4iIF0sCgkJCQkiVGhpcyByb29tIGlzIG5vdyBmdWxseS1hbm9ueW1vdXMiIDogWyBudWxsLAoJCQkJCQkiRXogYSBzem9iYSBtb3N0IHRlbGplc2VuIG7DqXZ0ZWxlbiIgXSwKCQkJCSJBIG5ldyByb29tIGhhcyBiZWVuIGNyZWF0ZWQiIDogWyBudWxsLAoJCQkJCQkiTMOpdHJlasO2dHQgZWd5IMO6aiBjc2V2ZWfFkSBzem9iYSIgXSwKCQkJCSJZb3VyIG5pY2tuYW1lIGhhcyBiZWVuIGNoYW5nZWQiIDogWyBudWxsLAoJCQkJCQkiQSBiZWNlbmV2ZWQgbcOzZG9zw610w6FzcmEga2Vyw7xsdCIgXSwKCQkJCSI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gaGFzIGJlZW4gYmFubmVkIiA6IFsgbnVsbCwKCQkJCQkJIkEgc3pvYsOhYsOzbCBraXTDrWx0dmE6IDxzdHJvbmc+JTEkczwvc3Ryb25nPiIgXSwKCQkJCSI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gaGFzIGJlZW4ga2lja2VkIG91dCIgOiBbIG51bGwsCgkJCQkJCSJBIHN6b2LDoWLDs2wga2lkb2J2YTogPHN0cm9uZz4lMSRzPC9zdHJvbmc+IiBdLAoJCQkJIjxzdHJvbmc+JTEkczwvc3Ryb25nPiBoYXMgYmVlbiByZW1vdmVkIGJlY2F1c2Ugb2YgYW4gYWZmaWxpYXRpb24gY2hhbmdlIiA6IFsKCQkJCQkJbnVsbCwKCQkJCQkJIlRhZ2xpc3RhIG3Ds2Rvc8OtdMOhcyBtaWF0dCBhIHN6b2LDoWLDs2wga2lsw6lwdGV0dmU6IDxzdHJvbmc+JTEkczwvc3Ryb25nPiIgXSwKCQkJCSI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gaGFzIGJlZW4gcmVtb3ZlZCBmb3Igbm90IGJlaW5nIGEgbWVtYmVyIiA6IFsKCQkJCQkJbnVsbCwKCQkJCQkJIkEgdGFnbGlzdMOhbiBuZW0gc3plcmVwZWwgw61neSBhIHN6b2LDoWLDs2wga2lsw6lwdGV0dmU6IDxzdHJvbmc+JTEkczwvc3Ryb25nPiIgXSwKCQkJCSJZb3UgaGF2ZSBiZWVuIGJhbm5lZCBmcm9tIHRoaXMgcm9vbSIgOiBbIG51bGwsCgkJCQkJCSJLaSBsZXR0w6lsIHTDrWx0dmEgZWJixZFsIGEgc3pvYsOhYsOzbCIgXSwKCQkJCSJZb3UgaGF2ZSBiZWVuIGtpY2tlZCBmcm9tIHRoaXMgcm9vbSIgOiBbIG51bGwsCgkJCQkJCSJLaSBsZXR0w6lsIGRvYnZhIGViYsWRbCBhIHN6b2LDoWLDs2wiIF0sCgkJCQkiWW91IGhhdmUgYmVlbiByZW1vdmVkIGZyb20gdGhpcyByb29tIGJlY2F1c2Ugb2YgYW4gYWZmaWxpYXRpb24gY2hhbmdlIiA6IFsKCQkJCQkJbnVsbCwKCQkJCQkJIlRhZ2xpc3RhIG3Ds2Rvc8OtdMOhcyBtaWF0dCBraWzDqXB0ZXR0w7xuayBhIGNzZXZlZ8WRIHN6b2LDoWLDs2wiIF0sCgkJCQkiWW91IGhhdmUgYmVlbiByZW1vdmVkIGZyb20gdGhpcyByb29tIGJlY2F1c2UgdGhlIHJvb20gaGFzIGNoYW5nZWQgdG8gbWVtYmVycy1vbmx5IGFuZCB5b3UncmUgbm90IGEgbWVtYmVyIiA6IFsKCQkJCQkJbnVsbCwKCQkJCQkJIktpbMOpcHRldHTDvG5rIGEgY3NldmVnxZEgc3pvYsOhYsOzbCwgbWVydCBtb3N0YW50w7NsIGNzYWsgYSB0YWdsaXN0w6FuIHN6ZXJlcGzFkWsgbGVoZXRuZWsgamVsZW4uIiBdLAoJCQkJIllvdSBoYXZlIGJlZW4gcmVtb3ZlZCBmcm9tIHRoaXMgcm9vbSBiZWNhdXNlIHRoZSBNVUMgKE11bHRpLXVzZXIgY2hhdCkgc2VydmljZSBpcyBiZWluZyBzaHV0IGRvd24uIiA6IFsKCQkJCQkJbnVsbCwKCQkJCQkJIktpbMOpcHRldHTDvG5rIGEgY3NldmVnxZEgc3pvYsOhYsOzbCwgbWVydCBhIE1VQyAoTXVsdGktVXNlciBDaGF0KSBzem9sZ8OhbHRhdMOhcyBsZcOhbGzDrXTDoXNyYSBrZXLDvGx0LiIgXSwKCQkJCSJZb3UgYXJlIG5vdCBvbiB0aGUgbWVtYmVyIGxpc3Qgb2YgdGhpcyByb29tIiA6IFsgbnVsbCwKCQkJCQkJIk5lbSBzemVyZXBlbHN6IGEgY3NldmVnxZEgc3pvYmEgdGFnbGlzdMOhasOhbiIgXSwKCQkJCSJObyBuaWNrbmFtZSB3YXMgc3BlY2lmaWVkIiA6IFsgbnVsbCwKCQkJCQkJIk5lbSBsZXR0IG1lZ2FkdmEgYmVjZW7DqXYiIF0sCgkJCQkiWW91IGFyZSBub3QgYWxsb3dlZCB0byBjcmVhdGUgbmV3IHJvb21zIiA6IFsgbnVsbCwKCQkJCQkJIk5lbSBsZWhldCDDumogY3NldmVnxZEgc3pvYsOhdCBsw6l0cmVob3puaSIgXSwKCQkJCSJZb3VyIG5pY2tuYW1lIGRvZXNuJ3QgY29uZm9ybSB0byB0aGlzIHJvb20ncyBwb2xpY2llcyIgOiBbCgkJCQkJCW51bGwsCgkJCQkJCSJBIGJlY2VuZXZlZCDDvHRrw7Z6aWsgYSBjc2V2ZWfFkSBzem9iYSBzemFiw6FseXphdGFpdmFsIiBdLAoJCQkJIllvdXIgbmlja25hbWUgaXMgYWxyZWFkeSB0YWtlbiIgOiBbIG51bGwsCgkJCQkJCSJBIGJlY2VuZXZlZGV0IG3DoXIgdmFsYWtpIGhhc3puw6FsamEiIF0sCgkJCQkiVGhpcyByb29tIGRvZXMgbm90ICh5ZXQpIGV4aXN0IiA6IFsgbnVsbCwKCQkJCQkJIkV6IGEgc3pvYmEgKG3DqWcpIG5lbSBsw6l0ZXppayIgXSwKCQkJCSJUaGlzIHJvb20gaGFzIHJlYWNoZWQgaXQncyBtYXhpbXVtIG51bWJlciBvZiBvY2N1cGFudHMiIDogWwoJCQkJCQludWxsLAoJCQkJCQkiRXogYSBjc2V2ZWfFkSBzem9iYSBlbMOpcnRlIGEgbWF4aW3DoWxpcyBqZWxlbmxldsWRayBzesOhbcOhdCIgXSwKCQkJCSJUb3BpYyBzZXQgYnkgJTEkcyB0bzogJTIkcyIgOiBbIG51bGwsCgkJCQkJCSJBIGvDtnZldGtlesWRIHTDqW3DoXQgw6FsbMOtdG90dGEgYmUgJTEkczogJTIkcyIgXSwKCQkJCSJUaGlzIHVzZXIgaXMgYSBtb2RlcmF0b3IiIDogWyBudWxsLAoJCQkJCQkiRXogYSBmZWxoYXN6bsOhbMOzIGVneSBtb2RlcsOhdG9yIiBdLAoJCQkJIlRoaXMgdXNlciBjYW4gc2VuZCBtZXNzYWdlcyBpbiB0aGlzIHJvb20iIDogWyBudWxsLAoJCQkJCQkiRXogYSBmZWxoYXN6bsOhbMOzIGvDvGxkaGV0IMO8emVuZXRldCBlYmJlIGEgc3pvYsOhYmEiIF0sCgkJCQkiVGhpcyB1c2VyIGNhbiBOT1Qgc2VuZCBtZXNzYWdlcyBpbiB0aGlzIHJvb20iIDogWyBudWxsLAoJCQkJCQkiRXogYSBmZWxoYXN6bsOhbMOzIE5FTSBrw7xsZGhldCDDvHplbmV0ZXQgZWJiZSBhIHN6b2LDoWJhIiBdLAoJCQkJIkNsaWNrIHRvIGNoYXQgd2l0aCB0aGlzIGNvbnRhY3QiIDogWyBudWxsLAoJCQkJCQkiQ3NldmVnw6lzIGluZMOtdMOhc2EgZXp6ZWwgYSBrYXBjc29sYXR1bmtrYWwiIF0sCgkJCQkiQ2xpY2sgdG8gcmVtb3ZlIHRoaXMgY29udGFjdCIgOiBbIG51bGwsICJBIGthcGNzb2xhdCB0w7ZybMOpc2UiIF0sCgkJCQkiVGhpcyBjb250YWN0IGlzIGJ1c3kiIDogWyBudWxsLCAiRWxmb2dsYWx0IiBdLAoJCQkJIlRoaXMgY29udGFjdCBpcyBvbmxpbmUiIDogWyBudWxsLCAiT25saW5lIiBdLAoJCQkJIlRoaXMgY29udGFjdCBpcyBvZmZsaW5lIiA6IFsgbnVsbCwgIk5pbmNzIGJlamVsZW50a2V6dmUiIF0sCgkJCQkiVGhpcyBjb250YWN0IGlzIHVuYXZhaWxhYmxlIiA6IFsgbnVsbCwgIkVsw6lyaGV0ZXRsZW4iIF0sCgkJCQkiVGhpcyBjb250YWN0IGlzIGF3YXkgZm9yIGFuIGV4dGVuZGVkIHBlcmlvZCIgOiBbIG51bGwsCgkJCQkJCSJIb3NzemFiYiBpZGVqZSB0w6F2b2wiIF0sCgkJCQkiVGhpcyBjb250YWN0IGlzIGF3YXkiIDogWyBudWxsLCAiVMOhdm9sIiBdLAoJCQkJIkNvbnRhY3QgcmVxdWVzdHMiIDogWyBudWxsLCAiS2FwY3NvbGF0IGZlbHbDqXRlbGkga8OpcsOpcyIgXSwKCQkJCSJNeSBjb250YWN0cyIgOiBbIG51bGwsICJLYXBjc29sYXRvazoiIF0sCgkJCQkiUGVuZGluZyBjb250YWN0cyIgOiBbIG51bGwsICJGw7xnZ8WRYmVuIGxldsWRIGthcGNzb2xhdG9rIiBdLAoJCQkJIkN1c3RvbSBzdGF0dXMiIDogWyBudWxsLCAiRWd5ZWRpIHN0w6F0dXN6IiBdLAoJCQkJIkNsaWNrIHRvIGNoYW5nZSB5b3VyIGNoYXQgc3RhdHVzIiA6IFsgbnVsbCwKCQkJCQkJIlNhasOhdCBzdMOhdHVzeiBiZcOhbGzDrXTDoXNhIiBdLAoJCQkJIkNsaWNrIGhlcmUgdG8gd3JpdGUgYSBjdXN0b20gc3RhdHVzIG1lc3NhZ2UiIDogWyBudWxsLAoJCQkJCQkiRWd5ZWRpIHN0w6F0dXN6IMO8emVuZXQgw61yw6FzYSIgXSwKCQkJCSJvbmxpbmUiIDogWyBudWxsLCAib25saW5lIiBdLAoJCQkJImJ1c3kiIDogWyBudWxsLCAiZWxmb2dsYWx0IiBdLAoJCQkJImF3YXkgZm9yIGxvbmciIDogWyBudWxsLCAiaG9zc3rDuiBpZGVqZSB0w6F2b2wiIF0sCgkJCQkiYXdheSIgOiBbIG51bGwsICJ0w6F2b2wiIF0sCgkJCQkiSSBhbSAlMSRzIiA6IFsgbnVsbCwgIiUxJHMgdmFneW9rIiBdLAoJCQkJIlNpZ24gaW4iIDogWyBudWxsLCAiQmVsw6lww6lzIiBdLAoJCQkJIlhNUFAvSmFiYmVyIFVzZXJuYW1lOiIgOiBbIG51bGwsICJYTVBQL0phYmJlciBhem9ub3PDrXTDszoiIF0sCgkJCQkiUGFzc3dvcmQ6IiA6IFsgbnVsbCwgIkplbHN6w7M6IiBdLAoJCQkJIkxvZyBJbiIgOiBbIG51bGwsICJCZWzDqXDDqXMiIF0sCgkJCQkiQk9TSCBTZXJ2aWNlIFVSTDoiIDogWyBudWxsLCAiQk9TSCBzemVydmVyIFVSTCIgXSwKCQkJCSJPbmxpbmUgQ29udGFjdHMiIDogWyBudWxsLCAiT25saW5lIGthcGNzb2xhdG9rIiBdCgkJCX0KCQl9Cgl9OwoJaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkgewoJCWRlZmluZSgiaHUiLCBbICdqZWQnIF0sIGZ1bmN0aW9uKCkgewoJCQlyZXR1cm4gZmFjdG9yeShuZXcgSmVkKHRyYW5zbGF0aW9ucykpOwoJCX0pOwoJfSBlbHNlIHsKCQlpZiAoIXdpbmRvdy5sb2NhbGVzKSB7CgkJCXdpbmRvdy5sb2NhbGVzID0ge307CgkJfQoJCXdpbmRvdy5sb2NhbGVzLmh1ID0gZmFjdG9yeShuZXcgSmVkKHRyYW5zbGF0aW9ucykpOwoJfQp9KHRoaXMsIGZ1bmN0aW9uKGh1KSB7CglyZXR1cm4gaHU7Cn0pKTsKCihmdW5jdGlvbihyb290LCBmYWN0b3J5KSB7CiAgICB2YXIgdHJhbnNsYXRpb25zID0gewogICAgICAgICJkb21haW4iOiAiY29udmVyc2UiLAogICAgICAgICJsb2NhbGVfZGF0YSI6IHsKICAgICAgICAgICAgImNvbnZlcnNlIjogewogICAgICAgICAgICAgICAgIiI6IHsKICAgICAgICAgICAgICAgICAgICAicHJvamVjdC1pZC12ZXJzaW9uIjogIkNvbnZlcnNlLmpzIDAuNy4wIiwKICAgICAgICAgICAgICAgICAgICAicmVwb3J0LW1zZ2lkLWJ1Z3MtdG8iOiAiIiwKICAgICAgICAgICAgICAgICAgICAicG90LWNyZWF0aW9uLWRhdGUiOiAiMjAxNC0wMS0yMiAxNzowNyswMjAwIiwKICAgICAgICAgICAgICAgICAgICAicG8tcmV2aXNpb24tZGF0ZSI6ICIyMDE0LTAxLTI1IDIxOjMwKzA3MDAiLAogICAgICAgICAgICAgICAgICAgICJsYXN0LXRyYW5zbGF0b3IiOiAiUHJpeWFkaSBJbWFuIE51cmNhaHlvIDxwcml5YWRpQHByaXlhZGkubmV0PiIsCiAgICAgICAgICAgICAgICAgICAgImxhbmd1YWdlLXRlYW0iOiAiQmFoYXNhIEluZG9uZXNpYSIsCiAgICAgICAgICAgICAgICAgICAgIm1pbWUtdmVyc2lvbiI6ICIxLjAiLAogICAgICAgICAgICAgICAgICAgICJjb250ZW50LXR5cGUiOiAidGV4dC9wbGFpbjsgY2hhcnNldD1VVEYtOCIsCiAgICAgICAgICAgICAgICAgICAgImNvbnRlbnQtdHJhbnNmZXItZW5jb2RpbmciOiAiOGJpdCIsCiAgICAgICAgICAgICAgICAgICAgImxhbmd1YWdlIjogImlkIgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJ1bmVuY3J5cHRlZCI6IFtudWxsLCAidGFrIGRpZW5rcmlwc2kiXSwKICAgICAgICAgICAgICAgICJ1bnZlcmlmaWVkIjogW251bGwsICJ0YWsgZGl2ZXJpZmlrYXNpIl0sCiAgICAgICAgICAgICAgICAidmVyaWZpZWQiOiBbbnVsbCwgImRpdmVyaWZpa2FzaSJdLAogICAgICAgICAgICAgICAgImZpbmlzaGVkIjogW251bGwsICJzZWxlc2FpIl0sCiAgICAgICAgICAgICAgICAiVGhpcyBjb250YWN0IGlzIGJ1c3kiOiBbbnVsbCwgIlRlbWFuIGluaSBzZWRhbmcgc2lidWsiXSwKICAgICAgICAgICAgICAgICJUaGlzIGNvbnRhY3QgaXMgb25saW5lIjogW251bGwsICJUZW1hbiBpbmkgdGVyaHVidW5nIl0sCiAgICAgICAgICAgICAgICAiVGhpcyBjb250YWN0IGlzIG9mZmxpbmUiOiBbbnVsbCwgIlRlbWFuIGluaSB0aWRhayB0ZXJodWJ1bmciXSwKICAgICAgICAgICAgICAgICJUaGlzIGNvbnRhY3QgaXMgdW5hdmFpbGFibGUiOiBbbnVsbCwgIlRlbWFuIGluaSB0aWRhayB0ZXJzZWRpYSJdLAogICAgICAgICAgICAgICAgIlRoaXMgY29udGFjdCBpcyBhd2F5IGZvciBhbiBleHRlbmRlZCBwZXJpb2QiOiBbbnVsbCwgIlRlbWFuIGluaSB0aWRhayBkaSB0ZW1wYXQgdW50dWsgd2FrdHUgeWFuZyBsYW1hIl0sCiAgICAgICAgICAgICAgICAiVGhpcyBjb250YWN0IGlzIGF3YXkiOiBbbnVsbCwgIlRlbWFuIGluaSB0aWRhayBkaSB0ZW1wYXQiXSwKICAgICAgICAgICAgICAgICJEaXNjb25uZWN0ZWQiOiBbbnVsbCwgIlRlcnB1dHVzIl0sCiAgICAgICAgICAgICAgICAiRXJyb3IiOiBbbnVsbCwgIktlc2FsYWhhbiJdLAogICAgICAgICAgICAgICAgIkNvbm5lY3RpbmciOiBbbnVsbCwgIk1lbnlhbWJ1bmciXSwKICAgICAgICAgICAgICAgICJDb25uZWN0aW9uIEZhaWxlZCI6IFtudWxsLCAiR2FnYWwgTWVueWFtYnVuZyJdLAogICAgICAgICAgICAgICAgIkF1dGhlbnRpY2F0aW5nIjogW251bGwsICJNZWxha3VrYW4gb3RlbnRpa2FzaSJdLAogICAgICAgICAgICAgICAgIkF1dGhlbnRpY2F0aW9uIEZhaWxlZCI6IFtudWxsLCAiT3RlbnRpa2FzaSBnYWdhbCJdLAogICAgICAgICAgICAgICAgIkRpc2Nvbm5lY3RpbmciOiBbbnVsbCwgIk1lbXV0dXNrYW4gaHVidW5nYW4iXSwKICAgICAgICAgICAgICAgICJPbmxpbmUgQ29udGFjdHMiOiBbbnVsbCwgIlRlbWFuIHlhbmcgVGVyaHVidW5nIl0sCiAgICAgICAgICAgICAgICAiUmUtZXN0YWJsaXNoaW5nIGVuY3J5cHRlZCBzZXNzaW9uIjogW251bGwsICJNZW55YW1idW5nIGtlbWJhbGkgc2VzaSB0ZXJlbmtyaXBzaSJdLAogICAgICAgICAgICAgICAgIllvdXIgYnJvd3NlciBuZWVkcyB0byBnZW5lcmF0ZSBhIHByaXZhdGUga2V5LCB3aGljaCB3aWxsIGJlIHVzZWQgaW4geW91ciBlbmNyeXB0ZWQgY2hhdCBzZXNzaW9uLiBUaGlzIGNhbiB0YWtlIHVwIHRvIDMwIHNlY29uZHMgZHVyaW5nIHdoaWNoIHlvdXIgYnJvd3NlciBtaWdodCBmcmVlemUgYW5kIGJlY29tZSB1bnJlc3BvbnNpdmUuIjogW251bGwsICJQZXJhbWJhaCBhbmRhIHBlcmx1IG1lbWJ1YXQga3VuY2kgcHJpdmF0LCB5YW5nIGFrYW4gZGlndW5ha2FuIHBhZGEgc2VzaSBwZXJiaW5jYW5nYW4gYW5kYS4gSW5pIGFrYW4gbWVtYnV0dWhrYW4gd2FrdHUgc2FtcGFpIDMwIGRldGlrLCBkYW4gc2VsYW1hIGl0dSBwZXJhbWJhaCBtdW5na2luIGFrYW4gdGlkYWsgcmVzcG9uc2lmLiJdLAogICAgICAgICAgICAgICAgIlByaXZhdGUga2V5IGdlbmVyYXRlZC4iOiBbbnVsbCwgIkt1bmNpIHByaXZhdCBiZXJoYXNpbCBkaWJ1YXQuIl0sCiAgICAgICAgICAgICAgICAiQXV0aGVudGljYXRpb24gcmVxdWVzdCBmcm9tICUxJHNcblxuWW91ciBidWRkeSBpcyBhdHRlbXB0aW5nIHRvIHZlcmlmeSB5b3VyIGlkZW50aXR5LCBieSBhc2tpbmcgeW91IHRoZSBxdWVzdGlvbiBiZWxvdy5cblxuJTIkcyI6IFtudWxsLCAiUGVybWludGFhbiBvdGVudGlrYXNpIGRhcmkgJTEkc1xuXG5UZW1hbiBhbmRhIG1lbmNvYmEgdW50dWsgbWVsYWt1a2FuIHZlcmlmaWthc2kgaWRlbnRpdGFzIGFuZGEgZGVuZ2FuIGNhcmEgbWVuYW55YWthbiBwZXJ0YW55YWFuIGRpIGJhd2FoIGluaS5cblxuJTIkcyJdLAogICAgICAgICAgICAgICAgIkNvdWxkIG5vdCB2ZXJpZnkgdGhpcyB1c2VyJ3MgaWRlbnRpZnkuIjogW251bGwsICJUYWsgZGFwYXQgbWVsYWt1a2FuIHZlcmlmaWthc2kgaWRlbnRpdGFzIHBlbmdndW5hIGluaS4iXSwKICAgICAgICAgICAgICAgICJQZXJzb25hbCBtZXNzYWdlIjogW251bGwsICJQZXNhbiBwcmliYWRpIl0sCiAgICAgICAgICAgICAgICAiU3RhcnQgZW5jcnlwdGVkIGNvbnZlcnNhdGlvbiI6IFtudWxsLCAiTXVsYWkgc2VzaSB0ZXJlbmtyaXBzaSJdLAogICAgICAgICAgICAgICAgIlJlZnJlc2ggZW5jcnlwdGVkIGNvbnZlcnNhdGlvbiI6IFtudWxsLCAiU2V0ZWwgdWxhbmcgcGVyY2FrYXBhbiB0ZXJlbmtyaXBzaSJdLAogICAgICAgICAgICAgICAgIkVuZCBlbmNyeXB0ZWQgY29udmVyc2F0aW9uIjogW251bGwsICJTdWRhaGkgcGVyY2FrYXBhbiB0ZXJlbmtyaXBzaSJdLAogICAgICAgICAgICAgICAgIlZlcmlmeSB3aXRoIFNNUCI6IFtudWxsLCAiVmVyaWZpa2FzaSBtZW5nZ3VuYWthbiBTTVAiXSwKICAgICAgICAgICAgICAgICJWZXJpZnkgd2l0aCBmaW5nZXJwcmludHMiOiBbbnVsbCwgIlZlcmlmaWthc2kgbWVuZ2d1bmFrYW4gc2lkaWsgamFyaSJdLAogICAgICAgICAgICAgICAgIldoYXQncyB0aGlzPyI6IFtudWxsLCAiQXBha2FoIGluaT8iXSwKICAgICAgICAgICAgICAgICJtZSI6IFtudWxsLCAic2F5YSJdLAogICAgICAgICAgICAgICAgIlNob3cgdGhpcyBtZW51IjogW251bGwsICJUYW1waWxrYW4gbWVudSBpbmkiXSwKICAgICAgICAgICAgICAgICJXcml0ZSBpbiB0aGUgdGhpcmQgcGVyc29uIjogW251bGwsICJUdWxpcyBpbmkgbWVuZ2d1bmFrYW4gYmFoYXNhIHBpaGFrIGtldGlnYSJdLAogICAgICAgICAgICAgICAgIlJlbW92ZSBtZXNzYWdlcyI6IFtudWxsLCAiSGFwdXMgcGVzYW4iXSwKICAgICAgICAgICAgICAgICJZb3VyIG1lc3NhZ2UgY291bGQgbm90IGJlIHNlbnQiOiBbbnVsbCwgIlBlc2FuIGFuZGEgdGFrIGRhcGF0IGRpa2lyaW0iXSwKICAgICAgICAgICAgICAgICJXZSByZWNlaXZlZCBhbiB1bmVuY3J5cHRlZCBtZXNzYWdlIjogW251bGwsICJLYW1pIG1lbmVyaW1hIHBlc2FuIHRlcmVua3JpcHNpIl0sCiAgICAgICAgICAgICAgICAiV2UgcmVjZWl2ZWQgYW4gdW5yZWFkYWJsZSBlbmNyeXB0ZWQgbWVzc2FnZSI6IFtudWxsLCAiS2FtaSBtZW5lcmltYSBwZXNhbiB0ZXJlbmtyaXBzaSB5YW5nIGdhZ2FsIGRpYmFjYSJdLAogICAgICAgICAgICAgICAgIlRoaXMgdXNlciBoYXMgcmVxdWVzdGVkIGFuIGVuY3J5cHRlZCBzZXNzaW9uLiI6IFtudWxsLCAiUGVuZ2d1bmEgaW5pIG1lbWludGEgc2VzaSB0ZXJlbmtyaXBzaSJdLAogICAgICAgICAgICAgICAgIkhlcmUgYXJlIHRoZSBmaW5nZXJwcmludHMsIHBsZWFzZSBjb25maXJtIHRoZW0gd2l0aCAlMSRzLCBvdXRzaWRlIG9mIHRoaXMgY2hhdC5cblxuRmluZ2VycHJpbnQgZm9yIHlvdSwgJTIkczogJTMkc1xuXG5GaW5nZXJwcmludCBmb3IgJTEkczogJTQkc1xuXG5JZiB5b3UgaGF2ZSBjb25maXJtZWQgdGhhdCB0aGUgZmluZ2VycHJpbnRzIG1hdGNoLCBjbGljayBPSywgb3RoZXJ3aXNlIGNsaWNrIENhbmNlbC4iOiBbbnVsbCwgIkluaSBhZGFsYWggc2lkaWsgamFyaSBhbmRhLCBrb25maXJtYXNpa2FuIGJlcnNhbWEgbWVyZWthIGRlbmdhbiAlMSRzLCBkaSBsdWFyIHBlcmNha2FwYW4gaW5pLlxuXG5TaWRpayBqYXJpIHVudHVrIGFuZGEsICUyJHM6ICUzJHNcblxuU2lkaWsgamFyaSB1bnR1ayAlMSRzOiAlNCRzXG5cbkppa2EgYW5kYSBiaXNhIG1lbmdrb25maXJtYXNpIHNpZGlrIGphZGkgY29jb2ssIGtsaWsgTGFuanV0a2FuLCBqaWthIHRpZGFrIGtsaWsgQmF0YWwuIl0sCiAgICAgICAgICAgICAgICAiWW91IHdpbGwgYmUgcHJvbXB0ZWQgdG8gcHJvdmlkZSBhIHNlY3VyaXR5IHF1ZXN0aW9uIGFuZCB0aGVuIGFuIGFuc3dlciB0byB0aGF0IHF1ZXN0aW9uLlxuXG5Zb3VyIGJ1ZGR5IHdpbGwgdGhlbiBiZSBwcm9tcHRlZCB0aGUgc2FtZSBxdWVzdGlvbiBhbmQgaWYgdGhleSB0eXBlIHRoZSBleGFjdCBzYW1lIGFuc3dlciAoY2FzZSBzZW5zaXRpdmUpLCB0aGVpciBpZGVudGl0eSB3aWxsIGhhdmUgYmVlbiB2ZXJpZmllZC4iOiBbbnVsbCwgIkFuZGEgYWthbiBkaXRhbnlha2FuIHBlcnRhbnlhYW4gdW50dWsga2VhbWFuYW4gYmVzZXJ0YSBqYXdhYmFuIHVudHVrIHBlcnRhbnlhYW4gdGVyc2VidXQuXG5cblRlbWFuIGFuZGEgYWthbiBkaXRhbnlha2FuIHBlcnRhbnlhYW4geWFuZyBzYW1hIGRhbiBqaWthIGRpYSBtZW1iZXJpa2FuIGphd2FiYW4geWFuZyBzYW1hIChodXJ1ZiBrYXBpdGFsIGRpcGVyaGF0aWthbiksIGlkZW50aXRhcyBtZXJla2EgZGl2ZXJpZmlrYXNpLiJdLAogICAgICAgICAgICAgICAgIldoYXQgaXMgeW91ciBzZWN1cml0eSBxdWVzdGlvbj8iOiBbbnVsbCwgIkFwYWthaCBwZXJ0YW55YWFuIGtlYW1hbmFuIGFuZGE/Il0sCiAgICAgICAgICAgICAgICAiV2hhdCBpcyB0aGUgYW5zd2VyIHRvIHRoZSBzZWN1cml0eSBxdWVzdGlvbj8iOiBbbnVsbCwgIkFwYSBqYXdhYmFuIGRhcmkgcGVydGFueWFhbiBrZWFtYW5hbiB0ZXJzZWJ1dD8iXSwKICAgICAgICAgICAgICAgICJJbnZhbGlkIGF1dGhlbnRpY2F0aW9uIHNjaGVtZSBwcm92aWRlZCI6IFtudWxsLCAiU2tlbWEgb3RlbnRpa2FzaSBzYWxhaCJdLAogICAgICAgICAgICAgICAgIllvdXIgbWVzc2FnZXMgYXJlIG5vdCBlbmNyeXB0ZWQgYW55bW9yZSI6IFtudWxsLCAiUGVzYW4gYW5kYSB0aWRhayBsYWdpIHRlcmVua3JpcHNpIl0sCiAgICAgICAgICAgICAgICAiWW91ciBtZXNzYWdlcyBhcmUgbm93IGVuY3J5cHRlZCBidXQgeW91ciBidWRkeSdzIGlkZW50aXR5IGhhcyBub3QgYmVlbiB2ZXJpZmllZC4iOiBbbnVsbCwgIlBlc2FuIGFuZGEgc2VrYXJhbmcgdGVyZW5rcmlwc2ksIG5hbXVuIGlkZW50aXRhcyB0ZW1hbiBhbmRhIGJlbHVtIGRhcGF0IGRpdmVyaWZpa2FzaS4iXSwKICAgICAgICAgICAgICAgICJZb3VyIGJ1ZGR5J3MgaWRlbnRpZnkgaGFzIGJlZW4gdmVyaWZpZWQuIjogW251bGwsICJJZGVudGl0YXMgdGVtYW4gYW5kYSB0ZWxhaCBkaXZlcmlmaWthc2kuIl0sCiAgICAgICAgICAgICAgICAiWW91ciBidWRkeSBoYXMgZW5kZWQgZW5jcnlwdGlvbiBvbiB0aGVpciBlbmQsIHlvdSBzaG91bGQgZG8gdGhlIHNhbWUuIjogW251bGwsICJUZW1hbiBhbmRhIG1lbmdoZW50aWthbiBwZXJjYWthcGFuIHRlcmVua3JpcHNpLCBhbmRhIHNlYmFpa255YSBtZWxha3VrYW4gaGFsIHlhbmcgc2FtYS4iXSwKICAgICAgICAgICAgICAgICJZb3VyIG1lc3NhZ2VzIGFyZSBub3QgZW5jcnlwdGVkLiBDbGljayBoZXJlIHRvIGVuYWJsZSBPVFIgZW5jcnlwdGlvbi4iOiBbbnVsbCwgIlBlc2FuIGFuZGEgdGFrIHRlcmVua3JpcHNpLiBLbGlrIGRpIHNpbmkgdW50dWsgbWVueWFsYWthbiBlbmtyaXBzaSBPVFIuIl0sCiAgICAgICAgICAgICAgICAiWW91ciBtZXNzYWdlcyBhcmUgZW5jcnlwdGVkLCBidXQgeW91ciBidWRkeSBoYXMgbm90IGJlZW4gdmVyaWZpZWQuIjogW251bGwsICJQZXNhbiBhbmRhIHRlcmVua3JpcHNpLCB0ZXRhcGkgdGVtYW4gYW5kYSBiZWx1bSBkaXZlcmlmaWthc2kuIl0sCiAgICAgICAgICAgICAgICAiWW91ciBtZXNzYWdlcyBhcmUgZW5jcnlwdGVkIGFuZCB5b3VyIGJ1ZGR5IHZlcmlmaWVkLiI6IFtudWxsLCAiUGVzYW4gYW5kYSB0ZXJlbmtyaXBzaSBkYW4gdGVtYW4gYW5kYSB0ZWxhaCBkaXZlcmlmaWthc2kuIl0sCiAgICAgICAgICAgICAgICAiWW91ciBidWRkeSBoYXMgY2xvc2VkIHRoZWlyIGVuZCBvZiB0aGUgcHJpdmF0ZSBzZXNzaW9uLCB5b3Ugc2hvdWxkIGRvIHRoZSBzYW1lIjogW251bGwsICJUZW1hbiBhbmRhIHRlbGFoIG1lbWF0aWthbiBzZXNpIHRlcmVua3JpcHNpLCBkYW4gYW5kYSBqdWdhIHNlYmFpa255YSBtZWxha3VrYW4gaGFsIHlhbmcgc2FtYSJdLAogICAgICAgICAgICAgICAgIkNvbnRhY3RzIjogW251bGwsICJUZW1hbiJdLAogICAgICAgICAgICAgICAgIk9ubGluZSI6IFtudWxsLCAiVGVyaHVidW5nIl0sCiAgICAgICAgICAgICAgICAiQnVzeSI6IFtudWxsLCAiU2lidWsiXSwKICAgICAgICAgICAgICAgICJBd2F5IjogW251bGwsICJQZXJnaSJdLAogICAgICAgICAgICAgICAgIk9mZmxpbmUiOiBbbnVsbCwgIlRhayBUZXJodWJ1bmciXSwKICAgICAgICAgICAgICAgICJDbGljayB0byBhZGQgbmV3IGNoYXQgY29udGFjdHMiOiBbbnVsbCwgIktsaWsgdW50dWsgbWVuYW1iYWhrYW4gdGVtYW4gYmFydSJdLAogICAgICAgICAgICAgICAgIkFkZCBhIGNvbnRhY3QiOiBbbnVsbCwgIlRhbWJhaCB0ZW1hbiJdLAogICAgICAgICAgICAgICAgIkNvbnRhY3QgdXNlcm5hbWUiOiBbbnVsbCwgIlVzZXJuYW1lIHRlbWFuIl0sCiAgICAgICAgICAgICAgICAiQWRkIjogW251bGwsICJUYW1iYWgiXSwKICAgICAgICAgICAgICAgICJDb250YWN0IG5hbWUiOiBbbnVsbCwgIk5hbWEgdGVtYW4iXSwKICAgICAgICAgICAgICAgICJTZWFyY2giOiBbbnVsbCwgIkNhcmkiXSwKICAgICAgICAgICAgICAgICJObyB1c2VycyBmb3VuZCI6IFtudWxsLCAiUGVuZ2d1bmEgdGFrIGRpdGVtdWthbiJdLAogICAgICAgICAgICAgICAgIkNsaWNrIHRvIGFkZCBhcyBhIGNoYXQgY29udGFjdCI6IFtudWxsLCAiS2xpayB1bnR1ayBtZW5hbWJhaGthbiBzZWJhZ2FpIHRlbWFuIl0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgdG8gb3BlbiB0aGlzIHJvb20iOiBbbnVsbCwgIktsaWsgdW50dWsgbWVtYnVrYSBydWFuZ2FuIGluaSJdLAogICAgICAgICAgICAgICAgIlNob3cgbW9yZSBpbmZvcm1hdGlvbiBvbiB0aGlzIHJvb20iOiBbbnVsbCwgIlRhbXBpbGthbiBpbmZvcm1hc2kgcnVhbmdhbiBpbmkiXSwKICAgICAgICAgICAgICAgICJEZXNjcmlwdGlvbjoiOiBbbnVsbCwgIktldGVyYW5nYW46Il0sCiAgICAgICAgICAgICAgICAiT2NjdXBhbnRzOiI6IFtudWxsLCAiUGVuZ2h1bmk6Il0sCiAgICAgICAgICAgICAgICAiRmVhdHVyZXM6IjogW251bGwsICJGaXR1cjoiXSwKICAgICAgICAgICAgICAgICJSZXF1aXJlcyBhdXRoZW50aWNhdGlvbiI6IFtudWxsLCAiTWVtYnV0dWhrYW4gb3RlbnRpa2FzaSJdLAogICAgICAgICAgICAgICAgIkhpZGRlbiI6IFtudWxsLCAiVGVyc2VtYnVueWkiXSwKICAgICAgICAgICAgICAgICJSZXF1aXJlcyBhbiBpbnZpdGF0aW9uIjogW251bGwsICJNZW1idXR1aGthbiB1bmRhbmdhbiJdLAogICAgICAgICAgICAgICAgIk1vZGVyYXRlZCI6IFtudWxsLCAiRGltb2RlcmFzaSJdLAogICAgICAgICAgICAgICAgIk5vbi1hbm9ueW1vdXMiOiBbbnVsbCwgIlRpZGFrIGFub25pbSJdLAogICAgICAgICAgICAgICAgIk9wZW4gcm9vbSI6IFtudWxsLCAiUnVhbmdhbiB0ZXJidWthIl0sCiAgICAgICAgICAgICAgICAiUGVybWFuZW50IHJvb20iOiBbbnVsbCwgIlJ1YW5nYW4gcGVybWFuZW4iXSwKICAgICAgICAgICAgICAgICJQdWJsaWMiOiBbbnVsbCwgIlVtdW0iXSwKICAgICAgICAgICAgICAgICJTZW1pLWFub255bW91cyI6IFtudWxsLCAiU2VtaS1hbm9uaW0iXSwKICAgICAgICAgICAgICAgICJUZW1wb3Jhcnkgcm9vbSI6IFtudWxsLCAiUnVhbmdhbiBzZW1lbnRhcmEiXSwKICAgICAgICAgICAgICAgICJVbm1vZGVyYXRlZCI6IFtudWxsLCAiVGFrIGRpbW9kZXJhc2kiXSwKICAgICAgICAgICAgICAgICJSb29tcyI6IFtudWxsLCAiUnVhbmdhbiJdLAogICAgICAgICAgICAgICAgIlJvb20gbmFtZSI6IFtudWxsLCAiTmFtYSBydWFuZ2FuIl0sCiAgICAgICAgICAgICAgICAiTmlja25hbWUiOiBbbnVsbCwgIk5hbWEgcGFuZ2dpbGFuIl0sCiAgICAgICAgICAgICAgICAiU2VydmVyIjogW251bGwsICJTZXJ2ZXIiXSwKICAgICAgICAgICAgICAgICJKb2luIjogW251bGwsICJJa3V0aSJdLAogICAgICAgICAgICAgICAgIlNob3cgcm9vbXMiOiBbbnVsbCwgIlBlcmxpaGF0a2FuIHJ1YW5nYW4iXSwKICAgICAgICAgICAgICAgICJObyByb29tcyBvbiAlMSRzIjogW251bGwsICJUYWsgYWRhIHJ1YW5nYW4gZGkgJTEkcyJdLAogICAgICAgICAgICAgICAgIlJvb21zIG9uICUxJHMiOiBbbnVsbCwgIlJ1YW5nYW4gZGkgJTEkcyJdLAogICAgICAgICAgICAgICAgIlNldCBjaGF0cm9vbSB0b3BpYyI6IFtudWxsLCAiU2V0ZWwgdG9waWsgcnVhbmdhbiJdLAogICAgICAgICAgICAgICAgIktpY2sgdXNlciBmcm9tIGNoYXRyb29tIjogW251bGwsICJUZW5kYW5nIHBlbmdndW5hIGRhcmkgcnVhbmdhbiJdLAogICAgICAgICAgICAgICAgIkJhbiB1c2VyIGZyb20gY2hhdHJvb20iOiBbbnVsbCwgIkxhcmFuZyBwZW5nZ3VuYSBkYXJpIHJ1YW5nYW4iXSwKICAgICAgICAgICAgICAgICJNZXNzYWdlIjogW251bGwsICJQZXNhbiJdLAogICAgICAgICAgICAgICAgIlNhdmUiOiBbbnVsbCwgIlNpbXBhbiJdLAogICAgICAgICAgICAgICAgIkNhbmNlbCI6IFtudWxsLCAiQmF0YWwiXSwKICAgICAgICAgICAgICAgICJBbiBlcnJvciBvY2N1cnJlZCB3aGlsZSB0cnlpbmcgdG8gc2F2ZSB0aGUgZm9ybS4iOiBbbnVsbCwgIktlc2FsYWhhbiB0ZXJqYWRpIHNhYXQgbWVueWltcGFuIGZvcm11bGlyIGluaS4iXSwKICAgICAgICAgICAgICAgICJUaGlzIGNoYXRyb29tIHJlcXVpcmVzIGEgcGFzc3dvcmQiOiBbbnVsbCwgIlJ1YW5nYW4gaW5pIG1lbWJ1dHVoa2FuIGthdGEgc2FuZGkiXSwKICAgICAgICAgICAgICAgICJQYXNzd29yZDogIjogW251bGwsICJLYXRhIHNhbmRpOiAiXSwKICAgICAgICAgICAgICAgICJTdWJtaXQiOiBbbnVsbCwgIktpcmltIl0sCiAgICAgICAgICAgICAgICAiVGhpcyByb29tIGlzIG5vdCBhbm9ueW1vdXMiOiBbbnVsbCwgIlJ1YW5nYW4gaW5pIHRpZGFrIGFub25pbSJdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBub3cgc2hvd3MgdW5hdmFpbGFibGUgbWVtYmVycyI6IFtudWxsLCAiUnVhbmdhbiBpbmkgbWVuYW1waWxrYW4gYW5nZ290YSB5YW5nIHRhayB0ZXJzZWRpYSJdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBkb2VzIG5vdCBzaG93IHVuYXZhaWxhYmxlIG1lbWJlcnMiOiBbbnVsbCwgIlJ1YW5nYW4gaW5pIHRpZGFrIG1lbmFtcGlsa2FuIGFuZ2dvdGEgeWFuZyB0YWsgdGVyc2VkaWEiXSwKICAgICAgICAgICAgICAgICJOb24tcHJpdmFjeS1yZWxhdGVkIHJvb20gY29uZmlndXJhdGlvbiBoYXMgY2hhbmdlZCI6IFtudWxsLCAiS29uZmlndXJhc2kgcnVhbmdhbiB5YW5nIHRhayBiZXJodWJ1bmdhbiBkZW5nYW4gcHJpdmFzaSB0ZWxhaCBkaXViYWgiXSwKICAgICAgICAgICAgICAgICJSb29tIGxvZ2dpbmcgaXMgbm93IGVuYWJsZWQiOiBbbnVsbCwgIlBlbmNhdGF0YW4gZGkgcnVhbmdhbiBpbmkgc2VrYXJhbmcgZGlueWFsYWthbiJdLAogICAgICAgICAgICAgICAgIlJvb20gbG9nZ2luZyBpcyBub3cgZGlzYWJsZWQiOiBbbnVsbCwgIlBlbmNhdGF0YW4gZGkgcnVhbmdhbiBpbmkgc2VrYXJhbmcgZGltYXRpa2FuIl0sCiAgICAgICAgICAgICAgICAiVGhpcyByb29tIGlzIG5vdyBub24tYW5vbnltb3VzIjogW251bGwsICJSdWFuZ2FuIGluaSBzZWthcmFuZyB0YWstYW5vbmltIl0sCiAgICAgICAgICAgICAgICAiVGhpcyByb29tIGlzIG5vdyBzZW1pLWFub255bW91cyI6IFtudWxsLCAiUnVhbmdhbiBpbmkgc2VrYXJhbmcgc2VtaS1hbm9uaW0iXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gaXMgbm93IGZ1bGx5LWFub255bW91cyI6IFtudWxsLCAiUnVhbmdhbiBpbmkgc2VrYXJhbmcgYW5vbmltIl0sCiAgICAgICAgICAgICAgICAiQSBuZXcgcm9vbSBoYXMgYmVlbiBjcmVhdGVkIjogW251bGwsICJSdWFuZ2FuIGJhcnUgdGVsYWggZGlidWF0Il0sCiAgICAgICAgICAgICAgICAiWW91ciBuaWNrbmFtZSBoYXMgYmVlbiBjaGFuZ2VkIjogW251bGwsICJOYW1hIHBhbmdnaWxhbiBhbmRhIHRlbGFoIGRpdWJhaCJdLAogICAgICAgICAgICAgICAgIjxzdHJvbmc+JTEkczwvc3Ryb25nPiBoYXMgYmVlbiBiYW5uZWQiOiBbbnVsbCwgIjxzdHJvbmc+JTEkczwvc3Ryb25nPiB0ZWxhaCBkaWNla2FsIl0sCiAgICAgICAgICAgICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IGhhcyBiZWVuIGtpY2tlZCBvdXQiOiBbbnVsbCwgIjxzdHJvbmc+JTEkczwvc3Ryb25nPiB0ZWxhaCBkaXRlbmRhbmcga2VsdWFyIl0sCiAgICAgICAgICAgICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IGhhcyBiZWVuIHJlbW92ZWQgYmVjYXVzZSBvZiBhbiBhZmZpbGlhdGlvbiBjaGFuZ2UiOiBbbnVsbCwgIjxzdHJvbmc+JTEkczwvc3Ryb25nPiB0ZWxhaCBkaWhhcHVzIGthcmVuYSBwZXJ1YmFoYW4gYWZpbGlhc2kiXSwKICAgICAgICAgICAgICAgICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gaGFzIGJlZW4gcmVtb3ZlZCBmb3Igbm90IGJlaW5nIGEgbWVtYmVyIjogW251bGwsICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gdGVsYWggZGloYXB1cyBrYXJlbmEgYnVrYW4gYW5nZ290YSJdLAogICAgICAgICAgICAgICAgIllvdSBoYXZlIGJlZW4gYmFubmVkIGZyb20gdGhpcyByb29tIjogW251bGwsICJBbmRhIHRlbGFoIGRpY2VrYWwgZGFyaSBydWFuZ2FuIGluaSJdLAogICAgICAgICAgICAgICAgIllvdSBoYXZlIGJlZW4ga2lja2VkIGZyb20gdGhpcyByb29tIjogW251bGwsICJBbmRhIHRlbGFoIGRpdGVuZGFuZyBkYXJpIHJ1YW5nYW4gaW5pIl0sCiAgICAgICAgICAgICAgICAiWW91IGhhdmUgYmVlbiByZW1vdmVkIGZyb20gdGhpcyByb29tIGJlY2F1c2Ugb2YgYW4gYWZmaWxpYXRpb24gY2hhbmdlIjogW251bGwsICJBbmRhIHRlbGFoIGRpaGFwdXMgZGFyaSBydWFuZ2FuIGluaSBrYXJlbmEgcGVydWJhaGFuIGFmaWxpYXNpIl0sCiAgICAgICAgICAgICAgICAiWW91IGhhdmUgYmVlbiByZW1vdmVkIGZyb20gdGhpcyByb29tIGJlY2F1c2UgdGhlIHJvb20gaGFzIGNoYW5nZWQgdG8gbWVtYmVycy1vbmx5IGFuZCB5b3UncmUgbm90IGEgbWVtYmVyIjogW251bGwsICJBbmRhIHRlbGFoIGRpaGFwdXMgZGFyaSBydWFuZ2FuIGluaSBrYXJlbmEgcnVhbmdhbiBpbmkgaGFueWEgdGVyYnVrYSB1bnR1ayBhbmdnb3RhIGRhbiBhbmRhIGJ1a2FuIGFuZ2dvdGEiXSwKICAgICAgICAgICAgICAgICJZb3UgaGF2ZSBiZWVuIHJlbW92ZWQgZnJvbSB0aGlzIHJvb20gYmVjYXVzZSB0aGUgTVVDIChNdWx0aS11c2VyIGNoYXQpIHNlcnZpY2UgaXMgYmVpbmcgc2h1dCBkb3duLiI6IFtudWxsLCAiQW5kYSB0ZWxhaCBkaWhhcHVzIGRhcmkgcnVhbmdhbiBpbmkga2FyZW5hIGxheWFuYW4gTVVDIChNdWx0aS11c2VyIGNoYXQpIHRlbGFoIGRpbWF0aWthbi4iXSwKICAgICAgICAgICAgICAgICJZb3UgYXJlIG5vdCBvbiB0aGUgbWVtYmVyIGxpc3Qgb2YgdGhpcyByb29tIjogW251bGwsICJBbmRhIGJ1a2FuIGFuZ2dvdGEgZGFyaSBydWFuZ2FuIGluaSJdLAogICAgICAgICAgICAgICAgIk5vIG5pY2tuYW1lIHdhcyBzcGVjaWZpZWQiOiBbbnVsbCwgIk5hbWEgcGFuZ2dpbGFuIGJlbHVtIGRpdGVudHVrYW4iXSwKICAgICAgICAgICAgICAgICJZb3UgYXJlIG5vdCBhbGxvd2VkIHRvIGNyZWF0ZSBuZXcgcm9vbXMiOiBbbnVsbCwgIkFuZGEgdGFrIGRpaXppbmthbiB1bnR1ayBtZW1idWF0IHJ1YW5nYW4gYmFydSJdLAogICAgICAgICAgICAgICAgIllvdXIgbmlja25hbWUgZG9lc24ndCBjb25mb3JtIHRvIHRoaXMgcm9vbSdzIHBvbGljaWVzIjogW251bGwsICJOYW1hIHBhbmdnaWxhbiBhbmRhIHRpZGFrIHNlc3VhaSBhdHVyYW4gcnVhbmdhbiBpbmkiXSwKICAgICAgICAgICAgICAgICJZb3VyIG5pY2tuYW1lIGlzIGFscmVhZHkgdGFrZW4iOiBbbnVsbCwgIk5hbWEgcGFuZ2dpbGFuIGFuZGEgdGVsYWggZGlndW5ha2FuIG9yYW5nIGxhaW4iXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gZG9lcyBub3QgKHlldCkgZXhpc3QiOiBbbnVsbCwgIlJ1YW5nYW4gaW5pIGJlbHVtIGRpYnVhdCJdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBoYXMgcmVhY2hlZCBpdCdzIG1heGltdW0gbnVtYmVyIG9mIG9jY3VwYW50cyI6IFtudWxsLCAiUnVhbmdhbiBpbmkgdGVsYWggbWVuY2FwYWkganVtbGFoIHBlbmdodW5pIG1ha3NpbXVtIl0sCiAgICAgICAgICAgICAgICAiVG9waWMgc2V0IGJ5ICUxJHMgdG86ICUyJHMiOiBbbnVsbCwgIlRvcGlrIGRpZ2FudGkgb2xlaCAlMSRzIG1lbmphZGk6ICUyJHMiXSwKICAgICAgICAgICAgICAgICJUaGlzIHVzZXIgaXMgYSBtb2RlcmF0b3IiOiBbbnVsbCwgIlBlbmdndW5hIGluaSBhZGFsYWggbW9kZXJhdG9yIl0sCiAgICAgICAgICAgICAgICAiVGhpcyB1c2VyIGNhbiBzZW5kIG1lc3NhZ2VzIGluIHRoaXMgcm9vbSI6IFtudWxsLCAiUGVuZ2d1bmEgaW5pIGRhcGF0IG1lbmdpcmltIHBlc2FuIGRpIHJ1YW5nYW4gaW5pIl0sCiAgICAgICAgICAgICAgICAiVGhpcyB1c2VyIGNhbiBOT1Qgc2VuZCBtZXNzYWdlcyBpbiB0aGlzIHJvb20iOiBbbnVsbCwgIlBlbmdndW5hIGluaSB0YWsgZGFwYXQgbWVuZ2lyaW0gcGVzYW4gZGkgcnVhbmdhbiBpbmkiXSwKICAgICAgICAgICAgICAgICJDbGljayB0byBjaGF0IHdpdGggdGhpcyBjb250YWN0IjogW251bGwsICJLbGlrIHVudHVrIG11bGFpIHBlcmJpbmphbmdhbiBkZW5nYW4gdGVtYW4gaW5pIl0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgdG8gcmVtb3ZlIHRoaXMgY29udGFjdCI6IFtudWxsLCAiS2xpayB1bnR1ayBtZW5naGFwdXMgdGVtYW4gaW5pIl0sCiAgICAgICAgICAgICAgICAiQ29udGFjdCByZXF1ZXN0cyI6IFtudWxsLCAiUGVybWludGFhbiBwZXJ0ZW1hbmFuIl0sCiAgICAgICAgICAgICAgICAiTXkgY29udGFjdHMiOiBbbnVsbCwgIlRlbWFuIHNheWEiXSwKICAgICAgICAgICAgICAgICJQZW5kaW5nIGNvbnRhY3RzIjogW251bGwsICJUZW1hbiB5YW5nIG1lbnVuZ2d1Il0sCiAgICAgICAgICAgICAgICAiQ3VzdG9tIHN0YXR1cyI6IFtudWxsLCAiU3RhdHVzIGt1c3RvbSJdLAogICAgICAgICAgICAgICAgIkNsaWNrIHRvIGNoYW5nZSB5b3VyIGNoYXQgc3RhdHVzIjogW251bGwsICJLbGlrIHVudHVrIG1lbmdnYW50aSBzdGF0dXMiXSwKICAgICAgICAgICAgICAgICJDbGljayBoZXJlIHRvIHdyaXRlIGEgY3VzdG9tIHN0YXR1cyBtZXNzYWdlIjogW251bGwsICJLbGlrIHVudHVrIG1lbnVsaXMgc3RhdHVzIGt1c3RvbSJdLAogICAgICAgICAgICAgICAgIm9ubGluZSI6IFtudWxsLCAidGVyaHVidW5nIl0sCiAgICAgICAgICAgICAgICAiYnVzeSI6IFtudWxsLCAic2lidWsiXSwKICAgICAgICAgICAgICAgICJhd2F5IGZvciBsb25nIjogW251bGwsICJsYW1hIHRhayBkaSB0ZW1wYXQiXSwKICAgICAgICAgICAgICAgICJhd2F5IjogW251bGwsICJ0YWsgZGkgdGVtcGF0Il0sCiAgICAgICAgICAgICAgICAiSSBhbSAlMSRzIjogW251bGwsICJTYXlhICUxJHMiXSwKICAgICAgICAgICAgICAgICJTaWduIGluIjogW251bGwsICJNYXN1ayJdLAogICAgICAgICAgICAgICAgIlhNUFAvSmFiYmVyIFVzZXJuYW1lOiI6IFtudWxsLCAiTmFtYSBwZW5nZ3VuYSBYTVBQL0phYmJlcjoiXSwKICAgICAgICAgICAgICAgICJQYXNzd29yZDoiOiBbbnVsbCwgIkthdGEgc2FuZGk6Il0sCiAgICAgICAgICAgICAgICAiTG9nIEluIjogW251bGwsICJNYXN1ayJdLAogICAgICAgICAgICAgICAgIkJPU0ggU2VydmljZSBVUkw6IjogW251bGwsICJVUkwgTGF5YW5hbiBCT1NIOiJdCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkgewogICAgICAgIGRlZmluZSgiaWQiLCBbJ2plZCddLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBmYWN0b3J5KG5ldyBKZWQodHJhbnNsYXRpb25zKSk7CiAgICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICAgIGlmICghd2luZG93LmxvY2FsZXMpIHsKICAgICAgICAgICAgd2luZG93LmxvY2FsZXMgPSB7fTsKICAgICAgICB9CiAgICAgICAgd2luZG93LmxvY2FsZXMuaWQgPSBmYWN0b3J5KG5ldyBKZWQodHJhbnNsYXRpb25zKSk7CiAgICB9Cn0odGhpcywgZnVuY3Rpb24gKGlkKSB7IAogICAgcmV0dXJuIGlkOyAKfSkpOwoKKGZ1bmN0aW9uIChyb290LCBmYWN0b3J5KSB7CiAgICB2YXIgdHJhbnNsYXRpb25zID0gewogICAgICAgICJkb21haW4iOiAiY29udmVyc2UiLAogICAgICAgICJsb2NhbGVfZGF0YSI6IHsKICAgICAgICAgICAgImNvbnZlcnNlIjogewogICAgICAgICAgICAgICAgIiI6IHsKICAgICAgICAgICAgICAgICAgICAiUHJvamVjdC1JZC1WZXJzaW9uIjogIkNvbnZlcnNlLmpzIDAuNCIsCiAgICAgICAgICAgICAgICAgICAgIlJlcG9ydC1Nc2dpZC1CdWdzLVRvIjogIiIsCiAgICAgICAgICAgICAgICAgICAgIlBPVC1DcmVhdGlvbi1EYXRlIjogIjIwMTMtMDktMTUgMjE6NTUrMDIwMCIsCiAgICAgICAgICAgICAgICAgICAgIlBPLVJldmlzaW9uLURhdGUiOiAiMjAxMy0wOS0xNSAyMjowMCswMjAwIiwKICAgICAgICAgICAgICAgICAgICAiTGFzdC1UcmFuc2xhdG9yIjogIkZhYmlvIEJhcyA8Y3RybGFsdGNhQGdtYWlsLmNvbT4iLAogICAgICAgICAgICAgICAgICAgICJMYW5ndWFnZS1UZWFtIjogIkl0YWxpYW4iLAogICAgICAgICAgICAgICAgICAgICJMYW5ndWFnZSI6ICJpdCIsCiAgICAgICAgICAgICAgICAgICAgIk1JTUUtVmVyc2lvbiI6ICIxLjAiLAogICAgICAgICAgICAgICAgICAgICJDb250ZW50LVR5cGUiOiAidGV4dC9wbGFpbjsgY2hhcnNldD1VVEYtOCIsCiAgICAgICAgICAgICAgICAgICAgIkNvbnRlbnQtVHJhbnNmZXItRW5jb2RpbmciOiAiOGJpdCIsCiAgICAgICAgICAgICAgICAgICAgIlBsdXJhbC1Gb3JtcyI6ICJucGx1cmFscz0yOyBwbHVyYWw9KG4gIT0gMSk7IiwKICAgICAgICAgICAgICAgICAgICAiZG9tYWluIjogImNvbnZlcnNlIiwKICAgICAgICAgICAgICAgICAgICAibGFuZyI6ICJpdCIsCiAgICAgICAgICAgICAgICAgICAgInBsdXJhbF9mb3JtcyI6ICJucGx1cmFscz0yOyBwbHVyYWw9KG4gIT0gMSk7IgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJ1bmVuY3J5cHRlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgInVudmVyaWZpZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJ2ZXJpZmllZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgImZpbmlzaGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiRGlzY29ubmVjdGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkRpc2Nvbm5lc3NvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJFcnJvciI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJFcnJvcmUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNvbm5lY3RpbmciOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQ29ubmVzc2lvbmUgaW4gY29yc28iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNvbm5lY3Rpb24gRmFpbGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkNvbm5lc3Npb25lIGZhbGxpdGEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkF1dGhlbnRpY2F0aW5nIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkF1dGVudGljYXppb25lIGluIGNvcnNvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJBdXRoZW50aWNhdGlvbiBGYWlsZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQXV0ZW50aWNhemlvbmUgZmFsbGl0YSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiRGlzY29ubmVjdGluZyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJEaXNjb25uZXNzaW9uZSBpbiBjb3JzbyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUmUtZXN0YWJsaXNoaW5nIGVuY3J5cHRlZCBzZXNzaW9uIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBicm93c2VyIG5lZWRzIHRvIGdlbmVyYXRlIGEgcHJpdmF0ZSBrZXksIHdoaWNoIHdpbGwgYmUgdXNlZCBpbiB5b3VyIGVuY3J5cHRlZCBjaGF0IHNlc3Npb24uIFRoaXMgY2FuIHRha2UgdXAgdG8gMzAgc2Vjb25kcyBkdXJpbmcgd2hpY2ggeW91ciBicm93c2VyIG1pZ2h0IGZyZWV6ZSBhbmQgYmVjb21lIHVucmVzcG9uc2l2ZS4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJQcml2YXRlIGtleSBnZW5lcmF0ZWQuIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQXV0aGVudGljYXRpb24gcmVxdWVzdCBmcm9tICUxJHNcblxuWW91ciBidWRkeSBpcyBhdHRlbXB0aW5nIHRvIHZlcmlmeSB5b3VyIGlkZW50aXR5LCBieSBhc2tpbmcgeW91IHRoZSBxdWVzdGlvbiBiZWxvdy5cblxuJTIkcyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNvdWxkIG5vdCB2ZXJpZnkgdGhpcyB1c2VyJ3MgaWRlbnRpZnkuIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUGVyc29uYWwgbWVzc2FnZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJNZXNzYWdnaW8gcGVyc29uYWxlIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTdGFydCBlbmNyeXB0ZWQgY29udmVyc2F0aW9uIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUmVmcmVzaCBlbmNyeXB0ZWQgY29udmVyc2F0aW9uIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiRW5kIGVuY3J5cHRlZCBjb252ZXJzYXRpb24iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJWZXJpZnkgd2l0aCBTTVAiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJWZXJpZnkgd2l0aCBmaW5nZXJwcmludHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJXaGF0J3MgdGhpcz8iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJtZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNob3cgdGhpcyBtZW51IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk1vc3RyYSBxdWVzdG8gbWVudSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiV3JpdGUgaW4gdGhlIHRoaXJkIHBlcnNvbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTY3JpdmkgaW4gdGVyemEgcGVyc29uYSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUmVtb3ZlIG1lc3NhZ2VzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlJpbXVvdmkgbWVzc2FnZ2kiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgbWVzc2FnZSBjb3VsZCBub3QgYmUgc2VudCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIldlIHJlY2VpdmVkIGFuIHVuZW5jcnlwdGVkIG1lc3NhZ2UiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJXZSByZWNlaXZlZCBhbiB1bnJlYWRhYmxlIGVuY3J5cHRlZCBtZXNzYWdlIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyB1c2VyIGhhcyByZXF1ZXN0ZWQgYW4gZW5jcnlwdGVkIHNlc3Npb24uIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiSGVyZSBhcmUgdGhlIGZpbmdlcnByaW50cywgcGxlYXNlIGNvbmZpcm0gdGhlbSB3aXRoICUxJHMsIG91dHNpZGUgb2YgdGhpcyBjaGF0LlxuXG5GaW5nZXJwcmludCBmb3IgeW91LCAlMiRzOiAlMyRzXG5cbkZpbmdlcnByaW50IGZvciAlMSRzOiAlNCRzXG5cbklmIHlvdSBoYXZlIGNvbmZpcm1lZCB0aGF0IHRoZSBmaW5nZXJwcmludHMgbWF0Y2gsIGNsaWNrIE9LLCBvdGhlcndpc2UgY2xpY2sgQ2FuY2VsLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdSB3aWxsIGJlIHByb21wdGVkIHRvIHByb3ZpZGUgYSBzZWN1cml0eSBxdWVzdGlvbiBhbmQgdGhlbiBhbiBhbnN3ZXIgdG8gdGhhdCBxdWVzdGlvbi5cblxuWW91ciBidWRkeSB3aWxsIHRoZW4gYmUgcHJvbXB0ZWQgdGhlIHNhbWUgcXVlc3Rpb24gYW5kIGlmIHRoZXkgdHlwZSB0aGUgZXhhY3Qgc2FtZSBhbnN3ZXIgKGNhc2Ugc2Vuc2l0aXZlKSwgdGhlaXIgaWRlbnRpdHkgd2lsbCBoYXZlIGJlZW4gdmVyaWZpZWQuIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiV2hhdCBpcyB5b3VyIHNlY3VyaXR5IHF1ZXN0aW9uPyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIldoYXQgaXMgdGhlIGFuc3dlciB0byB0aGUgc2VjdXJpdHkgcXVlc3Rpb24/IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiSW52YWxpZCBhdXRoZW50aWNhdGlvbiBzY2hlbWUgcHJvdmlkZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG1lc3NhZ2VzIGFyZSBub3QgZW5jcnlwdGVkIGFueW1vcmUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG1lc3NhZ2VzIGFyZSBub3cgZW5jcnlwdGVkIGJ1dCB5b3VyIGJ1ZGR5J3MgaWRlbnRpdHkgaGFzIG5vdCBiZWVuIHZlcmlmaWVkLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgYnVkZHkncyBpZGVudGlmeSBoYXMgYmVlbiB2ZXJpZmllZC4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIGJ1ZGR5IGhhcyBlbmRlZCBlbmNyeXB0aW9uIG9uIHRoZWlyIGVuZCwgeW91IHNob3VsZCBkbyB0aGUgc2FtZS4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG1lc3NhZ2VzIGFyZSBub3QgZW5jcnlwdGVkLiBDbGljayBoZXJlIHRvIGVuYWJsZSBPVFIgZW5jcnlwdGlvbi4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG1lc3NhZ2VzIGFyZSBlbmNyeXB0ZWQsIGJ1dCB5b3VyIGJ1ZGR5IGhhcyBub3QgYmVlbiB2ZXJpZmllZC4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG1lc3NhZ2VzIGFyZSBlbmNyeXB0ZWQgYW5kIHlvdXIgYnVkZHkgdmVyaWZpZWQuIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBidWRkeSBoYXMgY2xvc2VkIHRoZWlyIGVuZCBvZiB0aGUgcHJpdmF0ZSBzZXNzaW9uLCB5b3Ugc2hvdWxkIGRvIHRoZSBzYW1lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ29udGFjdHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQ29udGF0dGkiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk9ubGluZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJJbiBsaW5lYSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQnVzeSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJPY2N1cGF0byIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQXdheSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJBc3NlbnRlIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJPZmZsaW5lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk5vbiBpbiBsaW5lYSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgdG8gYWRkIG5ldyBjaGF0IGNvbnRhY3RzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkNsaWNjYSBwZXIgYWdnaXVuZ2VyZSBudW92aSBjb250YXR0aSBhbGxhIGNoYXQiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkFkZCBhIGNvbnRhY3QiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQWdnaXVuZ2kgY29udGF0dGkiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNvbnRhY3QgdXNlcm5hbWUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTm9tZSB1dGVudGUgZGVsIGNvbnRhdHRvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJBZGQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQWdnaXVuZ2kiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNvbnRhY3QgbmFtZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJOb21lIGRlbCBjb250YXR0byIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU2VhcmNoIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkNlcmNhIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJObyB1c2VycyBmb3VuZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJOZXNzdW4gdXRlbnRlIHRyb3ZhdG8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNsaWNrIHRvIGFkZCBhcyBhIGNoYXQgY29udGFjdCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDbGljY2EgcGVyIGFnZ2l1bmdlcmUgaWwgY29udGF0dG8gYWxsYSBjaGF0IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDbGljayB0byBvcGVuIHRoaXMgcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDbGljY2EgcGVyIGFwcmlyZSBxdWVzdGEgc3RhbnphIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTaG93IG1vcmUgaW5mb3JtYXRpb24gb24gdGhpcyByb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk1vc3RyYSBwacO5IGluZm9ybWF6aW9uaSBzdSBxdWVzdGEgc3RhbnphIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJEZXNjcmlwdGlvbjoiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRGVzY3JpemlvbmU6IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJPY2N1cGFudHM6IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlV0ZW50aSBwcmVzZW50aToiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkZlYXR1cmVzOiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJGdW56aW9uYWxpdMOgOiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUmVxdWlyZXMgYXV0aGVudGljYXRpb24iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiUmljaGllZGUgYXV0ZW50aWNhemlvbmUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkhpZGRlbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJOYXNjb3N0YSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUmVxdWlyZXMgYW4gaW52aXRhdGlvbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJSaWNoaWVkZSB1biBpbnZpdG8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk1vZGVyYXRlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJNb2RlcmF0YSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTm9uLWFub255bW91cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJOb24tYW5vbmltYSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiT3BlbiByb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlN0YW56YSBhcGVydGEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlBlcm1hbmVudCByb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlN0YW56YSBwZXJtYW5lbnRlIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJQdWJsaWMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiUHViYmxpY2EiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNlbWktYW5vbnltb3VzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlNlbWktYW5vbmltYSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGVtcG9yYXJ5IHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU3RhbnphIHRlbXBvcmFuZWEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlVubW9kZXJhdGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk5vbiBtb2RlcmF0YSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUm9vbXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU3RhbnplIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSb29tIG5hbWUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTm9tZSBzdGFuemEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk5pY2tuYW1lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlNvcHJhbm5vbWUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNlcnZlciI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTZXJ2ZXIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkpvaW4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRW50cmEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNob3cgcm9vbXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTW9zdHJhIHN0YW56ZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTm8gcm9vbXMgb24gJTEkcyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJOZXNzdW5hIHN0YW56YSBzdSAlMSRzIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSb29tcyBvbiAlMSRzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlN0YW56ZSBzdSAlMSRzIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTZXQgY2hhdHJvb20gdG9waWMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQ2FtYmlhIG9nZ2V0dG8gZGVsbGEgc3RhbnphIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJLaWNrIHVzZXIgZnJvbSBjaGF0cm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJFc3BlbGxpIHV0ZW50ZSBkYWxsYSBzdGFuemEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkJhbiB1c2VyIGZyb20gY2hhdHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQmFuZGlzY2kgdXRlbnRlIGRhbGxhIHN0YW56YSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTWVzc2FnZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJNZXNzYWdnaW8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNhdmUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU2FsdmEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNhbmNlbCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJBbm51bGxhIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJBbiBlcnJvciBvY2N1cnJlZCB3aGlsZSB0cnlpbmcgdG8gc2F2ZSB0aGUgZm9ybS4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRXJyb3JlIGR1cmFudGUgaWwgc2FsdmF0YWdnaW8gZGVsIG1vZHVsbyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyBjaGF0cm9vbSByZXF1aXJlcyBhIHBhc3N3b3JkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlF1ZXN0YSBzdGFuemEgcmljaGllZGUgdW5hIHBhc3N3b3JkIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJQYXNzd29yZDogIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlBhc3N3b3JkOiAiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlN1Ym1pdCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJJbnZpYSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyByb29tIGlzIG5vdCBhbm9ueW1vdXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiUXVlc3RhIHN0YW56YSBub24gw6ggYW5vbmltYSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyByb29tIG5vdyBzaG93cyB1bmF2YWlsYWJsZSBtZW1iZXJzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlF1ZXN0YSBzdGFuemEgbW9zdHJhIGkgbWVtYnJpIG5vbiBkaXNwb25pYmlsaSBhbCBtb21lbnRvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gZG9lcyBub3Qgc2hvdyB1bmF2YWlsYWJsZSBtZW1iZXJzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlF1ZXN0YSBzdGFuemEgbm9uIG1vc3RyYSBpIG1lbWJyaSBub24gZGlzcG9uaWJpbGkiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk5vbi1wcml2YWN5LXJlbGF0ZWQgcm9vbSBjb25maWd1cmF0aW9uIGhhcyBjaGFuZ2VkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlVuYSBjb25maWd1cmF6aW9uZSBkZWxsYSBzdGFuemEgbm9uIGxlZ2F0YSBhbGxhIHByaXZhY3kgw6ggc3RhdGEgbW9kaWZpY2F0YSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUm9vbSBsb2dnaW5nIGlzIG5vdyBlbmFibGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkxhIHJlZ2lzdHJhemlvbmUgw6ggYWJpbGl0YXRhIG5lbGxhIHN0YW56YSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUm9vbSBsb2dnaW5nIGlzIG5vdyBkaXNhYmxlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJMYSByZWdpc3RyYXppb25lIMOoIGRpc2FiaWxpdGF0YSBuZWxsYSBzdGFuemEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBpcyBub3cgbm9uLWFub255bW91cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJRdWVzdGEgc3RhbnphIMOoIG5vbi1hbm9uaW1hIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gaXMgbm93IHNlbWktYW5vbnltb3VzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlF1ZXN0YSBzdGFuemEgw6ggc2VtaS1hbm9uaW1hIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gaXMgbm93IGZ1bGx5LWFub255bW91cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJRdWVzdGEgc3RhbnphIMOoIGNvbXBsZXRhbWVudGUtYW5vbmltYSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQSBuZXcgcm9vbSBoYXMgYmVlbiBjcmVhdGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlVuYSBudW92YSBzdGFuemEgw6ggc3RhdGEgY3JlYXRhIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG5pY2tuYW1lIGhhcyBiZWVuIGNoYW5nZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSWwgdHVvIHNvcHJhbm5vbWUgw6ggc3RhdG8gY2FtYmlhdG8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIjxzdHJvbmc+JTEkczwvc3Ryb25nPiBoYXMgYmVlbiBiYW5uZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IMOoIHN0YXRvIGJhbmRpdG8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIjxzdHJvbmc+JTEkczwvc3Ryb25nPiBoYXMgYmVlbiBraWNrZWQgb3V0IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIjxzdHJvbmc+JTEkczwvc3Ryb25nPiDDqCBzdGF0byBlc3B1bHNvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gaGFzIGJlZW4gcmVtb3ZlZCBiZWNhdXNlIG9mIGFuIGFmZmlsaWF0aW9uIGNoYW5nZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gw6ggc3RhdG8gcmltb3NzbyBhIGNhdXNhIGRpIHVuIGNhbWJpbyBkaSBhZmZpbGlhemlvbmUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIjxzdHJvbmc+JTEkczwvc3Ryb25nPiBoYXMgYmVlbiByZW1vdmVkIGZvciBub3QgYmVpbmcgYSBtZW1iZXIiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IMOoIHN0YXRvIHJpbW9zc28gaW4gcXVhbnRvIG5vbiBtZW1icm8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdSBoYXZlIGJlZW4gYmFubmVkIGZyb20gdGhpcyByb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlNlaSBzdGF0byBiYW5kaXRvIGRhIHF1ZXN0YSBzdGFuemEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdSBoYXZlIGJlZW4ga2lja2VkIGZyb20gdGhpcyByb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlNlaSBzdGF0byBlc3B1bHNvIGRhIHF1ZXN0YSBzdGFuemEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdSBoYXZlIGJlZW4gcmVtb3ZlZCBmcm9tIHRoaXMgcm9vbSBiZWNhdXNlIG9mIGFuIGFmZmlsaWF0aW9uIGNoYW5nZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTZWkgc3RhdG8gcmltb3NzbyBkYSBxdWVzdGEgc3RhbnphIGEgY2F1c2EgZGkgdW4gY2FtYmlvIGRpIGFmZmlsaWF6aW9uZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91IGhhdmUgYmVlbiByZW1vdmVkIGZyb20gdGhpcyByb29tIGJlY2F1c2UgdGhlIHJvb20gaGFzIGNoYW5nZWQgdG8gbWVtYmVycy1vbmx5IGFuZCB5b3UncmUgbm90IGEgbWVtYmVyIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlNlaSBzdGF0byByaW1vc3NvIGRhIHF1ZXN0YSBzdGFuemEgcG9pY2jDqSBvcmEgbGEgc3RhbnphIGFjY2V0dGEgc29sbyBtZW1icmkiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdSBoYXZlIGJlZW4gcmVtb3ZlZCBmcm9tIHRoaXMgcm9vbSBiZWNhdXNlIHRoZSBNVUMgKE11bHRpLXVzZXIgY2hhdCkgc2VydmljZSBpcyBiZWluZyBzaHV0IGRvd24uIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlNlaSBzdGF0byByaW1vc3NvIGRhIHF1ZXN0YSBzdGFuemEgcG9pY2jDqSBpbCBzZXJ2aXppbyBNVUMgKENoYXQgbXVsdGkgdXRlbnRlKSDDqCBpbiBmYXNlIGRpIHNwZWduaW1lbnRvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3UgYXJlIG5vdCBvbiB0aGUgbWVtYmVyIGxpc3Qgb2YgdGhpcyByb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk5vbiBzZWkgbmVsbGEgbGlzdGEgZGVpIG1lbWJyaSBkaSBxdWVzdGEgc3RhbnphIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJObyBuaWNrbmFtZSB3YXMgc3BlY2lmaWVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk5lc3N1biBzb3ByYW5ub21lIHNwZWNpZmljYXRvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3UgYXJlIG5vdCBhbGxvd2VkIHRvIGNyZWF0ZSBuZXcgcm9vbXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTm9uIHRpIMOoIHBlcm1lc3NvIGNyZWFyZSBudW92ZSBzdGFuemUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgbmlja25hbWUgZG9lc24ndCBjb25mb3JtIHRvIHRoaXMgcm9vbSdzIHBvbGljaWVzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIklsIHR1byBzb3ByYW5ub21lIG5vbiDDqCBjb25mb3JtZSBhbGxlIHJlZ29sZSBkaSBxdWVzdGEgc3RhbnphIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG5pY2tuYW1lIGlzIGFscmVhZHkgdGFrZW4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSWwgdHVvIHNvcHJhbm5vbWUgw6ggZ2nDoCB1dGlsaXp6YXRvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gZG9lcyBub3QgKHlldCkgZXhpc3QiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiUXVlc3RhIHN0YW56YSBub24gZXNpc3RlIChwZXIgb3JhKSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyByb29tIGhhcyByZWFjaGVkIGl0J3MgbWF4aW11bSBudW1iZXIgb2Ygb2NjdXBhbnRzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlF1ZXN0YSBzdGFuemEgaGEgcmFnZ2l1bnRvIGlsIGxpbWl0ZSBtYXNzaW1vIGRpIHV0ZW50aSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVG9waWMgc2V0IGJ5ICUxJHMgdG86ICUyJHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVG9waWMgaW1wb3N0YXRvIGRhICUxJHMgYTogJTIkcyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyB1c2VyIGlzIGEgbW9kZXJhdG9yIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlF1ZXN0byB1dGVudGUgw6ggdW4gbW9kZXJhdG9yZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyB1c2VyIGNhbiBzZW5kIG1lc3NhZ2VzIGluIHRoaXMgcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJRdWVzdG8gdXRlbnRlIHB1w7IgaW52aWFyZSBtZXNzYWdnaSBpbiBxdWVzdGEgc3RhbnphIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHVzZXIgY2FuIE5PVCBzZW5kIG1lc3NhZ2VzIGluIHRoaXMgcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJRdWVzdG8gdXRlbnRlIE5PTiBwdcOyIGludmlhcmUgbWVzc2FnZ2kgaW4gcXVlc3RhIHN0YW56YSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgdG8gY2hhdCB3aXRoIHRoaXMgY29udGFjdCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDbGljY2EgcGVyIHBhcmxhcmUgY29uIHF1ZXN0byBjb250YXR0byIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgdG8gcmVtb3ZlIHRoaXMgY29udGFjdCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDbGljY2EgcGVyIHJpbXVvdmVyZSBxdWVzdG8gY29udGF0dG8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgY29udGFjdCBpcyBidXN5IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyBjb250YWN0IGlzIG9ubGluZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgY29udGFjdCBpcyBvZmZsaW5lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyBjb250YWN0IGlzIHVuYXZhaWxhYmxlIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlF1ZXN0YSBzdGFuemEgbW9zdHJhIGkgbWVtYnJpIG5vbiBkaXNwb25pYmlsaSBhbCBtb21lbnRvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIGNvbnRhY3QgaXMgYXdheSBmb3IgYW4gZXh0ZW5kZWQgcGVyaW9kIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyBjb250YWN0IGlzIGF3YXkiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb250YWN0IHJlcXVlc3RzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlJpY2hpZXN0ZSBkZWkgY29udGF0dGkiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk15IGNvbnRhY3RzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkkgbWllaSBjb250YXR0aSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUGVuZGluZyBjb250YWN0cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDb250YXR0aSBpbiBhdHRlc2EiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkN1c3RvbSBzdGF0dXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU3RhdG8gcGVyc29uYWxpenphdG8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNsaWNrIHRvIGNoYW5nZSB5b3VyIGNoYXQgc3RhdHVzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkNsaWNjYSBwZXIgY2FtYmlhcmUgaWwgdHVvIHN0YXRvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDbGljayBoZXJlIHRvIHdyaXRlIGEgY3VzdG9tIHN0YXR1cyBtZXNzYWdlIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkNsaWNjYSBxdWkgcGVyIHNjcml2ZXJlIHVuIG1lc3NhZ2dpbyBkaSBzdGF0byBwZXJzb25hbGl6emF0byIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAib25saW5lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgImluIGxpbmVhIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJidXN5IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIm9jY3VwYXRvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJhd2F5IGZvciBsb25nIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgImFzc2VudGUgZGEgbW9sdG8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgImF3YXkiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiYXNzZW50ZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiSSBhbSAlMSRzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlNvbm8gJTEkcyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU2lnbiBpbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJBY2Nlc3NvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJYTVBQL0phYmJlciBVc2VybmFtZToiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTm9tZSB1dGVudGU6IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJQYXNzd29yZDoiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiUGFzc3dvcmQ6IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJMb2cgSW4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRW50cmEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkJPU0ggU2VydmljZSBVUkw6IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkluZGlyaXp6byBzZXJ2aXppbyBCT1NIOiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiT25saW5lIENvbnRhY3RzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkNvbnRhdHRpIGluIGxpbmVhIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb25uZWN0ZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQ29ubmVzc28iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkF0dGFjaGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkFsbGVnYXRvIgogICAgICAgICAgICAgICAgXQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIGlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHsKICAgICAgICBkZWZpbmUoIml0IiwgWydqZWQnXSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gZmFjdG9yeShuZXcgSmVkKHRyYW5zbGF0aW9ucykpOwogICAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgICBpZiAoIXdpbmRvdy5sb2NhbGVzKSB7CiAgICAgICAgICAgIHdpbmRvdy5sb2NhbGVzID0ge307CiAgICAgICAgfQogICAgICAgIHdpbmRvdy5sb2NhbGVzLml0ID0gZmFjdG9yeShuZXcgSmVkKHRyYW5zbGF0aW9ucykpOwogICAgfQp9KHRoaXMsIGZ1bmN0aW9uIChpdCkgeyAKICAgIHJldHVybiBpdDsgCn0pKTsKCihmdW5jdGlvbiAocm9vdCwgZmFjdG9yeSkgewogICAgdmFyIHRyYW5zbGF0aW9ucyA9IHsKICAgICAgICAiZG9tYWluIjogImNvbnZlcnNlIiwKICAgICAgICAibG9jYWxlX2RhdGEiOiB7CiAgICAgICAgICAgICJjb252ZXJzZSI6IHsKICAgICAgICAgICAgICAgICIiOiB7CiAgICAgICAgICAgICAgICAgICAgIlByb2plY3QtSWQtVmVyc2lvbiI6ICJDb252ZXJzZS5qcyAwLjQiLAogICAgICAgICAgICAgICAgICAgICJSZXBvcnQtTXNnaWQtQnVncy1UbyI6ICIiLAogICAgICAgICAgICAgICAgICAgICJQT1QtQ3JlYXRpb24tRGF0ZSI6ICIyMDE0LTAxLTA3IDExOjEyKzA5MDAiLAogICAgICAgICAgICAgICAgICAgICJQTy1SZXZpc2lvbi1EYXRlIjogIjIwMTQtMDEtMDcgMTE6MzIrMDkwMCIsCiAgICAgICAgICAgICAgICAgICAgIkxhc3QtVHJhbnNsYXRvciI6ICJNYWtvIE4gPG1ha29AcGFzZXJvLm5ldD4iLAogICAgICAgICAgICAgICAgICAgICJMYW5ndWFnZS1UZWFtIjogIkxhbmd1YWdlIEpBIiwKICAgICAgICAgICAgICAgICAgICAiTGFuZ3VhZ2UiOiAiSkEiLAogICAgICAgICAgICAgICAgICAgICJNSU1FLVZlcnNpb24iOiAiMS4wIiwKICAgICAgICAgICAgICAgICAgICAiQ29udGVudC1UeXBlIjogInRleHQvcGxhaW47IGNoYXJzZXQ9VVRGLTgiLAogICAgICAgICAgICAgICAgICAgICJDb250ZW50LVRyYW5zZmVyLUVuY29kaW5nIjogIjhiaXQiLAogICAgICAgICAgICAgICAgICAgICJQbHVyYWwtRm9ybXMiOiAibnBsdXJhbHM9MTsgcGx1cmFsPTA7IgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJ1bmVuY3J5cHRlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLmmpflj7fljJbjgZXjgozjgabjgYTjgb7jgZvjgpMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgInVudmVyaWZpZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi5qSc6Ki844GV44KM44Gm44GE44G+44Gb44KTIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJ2ZXJpZmllZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLmpJzoqLzjgZXjgozjgb7jgZfjgZ8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgImZpbmlzaGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuWujOS6hiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyBjb250YWN0IGlzIGJ1c3kiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi44GT44Gu55u45omL5YWI44Gv5Y+W44KK6L6844G/5Lit44Gn44GZIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIGNvbnRhY3QgaXMgb25saW5lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuOBk+OBruebuOaJi+WFiOOBr+WcqOW4reOBl+OBpuOBhOOBvuOBmSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyBjb250YWN0IGlzIG9mZmxpbmUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi44GT44Gu55u45omL5YWI44Gv44Kq44OV44Op44Kk44Oz44Gn44GZIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIGNvbnRhY3QgaXMgdW5hdmFpbGFibGUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi44GT44Gu55u45omL5YWI44Gv5LiN6YCa44Gn44GZIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIGNvbnRhY3QgaXMgYXdheSBmb3IgYW4gZXh0ZW5kZWQgcGVyaW9kIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuOBk+OBruebuOaJi+WFiOOBr+S4jeWcqOOBp+OBmSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyBjb250YWN0IGlzIGF3YXkiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi44GT44Gu55u45omL5YWI44Gv6Zui5bit5Lit44Gn44GZIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJEaXNjb25uZWN0ZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi5YiH5pat5LitIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJFcnJvciI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLjgqjjg6njg7wiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNvbm5lY3RpbmciOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi5o6l57aa5Lit44Gn44GZIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb25uZWN0aW9uIEZhaWxlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLmjqXntprjgavlpLHmlZfjgZfjgb7jgZfjgZ8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkF1dGhlbnRpY2F0aW5nIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuiqjeiovOS4rSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQXV0aGVudGljYXRpb24gRmFpbGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuiqjeiovOOBq+WkseaVlyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiRGlzY29ubmVjdGluZyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLliIfmlq0iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk9ubGluZSBDb250YWN0cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLjgqrjg7Pjg6njgqTjg7Pjga7nm7jmiYvlhYgiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJlLWVzdGFibGlzaGluZyBlbmNyeXB0ZWQgc2Vzc2lvbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLmmpflj7fljJbjgrvjg4Pjgrfjg6fjg7Pjga7lho3mjqXntpoiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgYnJvd3NlciBuZWVkcyB0byBnZW5lcmF0ZSBhIHByaXZhdGUga2V5LCB3aGljaCB3aWxsIGJlIHVzZWQgaW4geW91ciBlbmNyeXB0ZWQgY2hhdCBzZXNzaW9uLiBUaGlzIGNhbiB0YWtlIHVwIHRvIDMwIHNlY29uZHMgZHVyaW5nIHdoaWNoIHlvdXIgYnJvd3NlciBtaWdodCBmcmVlemUgYW5kIGJlY29tZSB1bnJlc3BvbnNpdmUuIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuaal+WPt+WMluODgeODo+ODg+ODiOOBp+S9v+eUqOOBmeOCi+enmOWvhumNteOCkueUn+aIkOOBmeOCi+W/heimgeOBjOOBguOCiuOBvuOBmeOAguOBk+OCjOOBq+OBrzMw56eS44G744Gp44GL44GL44KK44CB44Gd44Gu44GC44GE44Gg44OW44Op44Km44K244GM44OV44Oq44O844K644GX44Gm5Y+N5b+c44GX44Gq44GE44GL44KC44GX44KM44G+44Gb44KT44CCIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJQcml2YXRlIGtleSBnZW5lcmF0ZWQuIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuenmOWvhumNteOCkueUn+aIkOOBl+OBvuOBl+OBn+OAgiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQXV0aGVudGljYXRpb24gcmVxdWVzdCBmcm9tICUxJHNcblxuWW91ciBidWRkeSBpcyBhdHRlbXB0aW5nIHRvIHZlcmlmeSB5b3VyIGlkZW50aXR5LCBieSBhc2tpbmcgeW91IHRoZSBxdWVzdGlvbiBiZWxvdy5cblxuJTIkcyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIlMSRzIOOBi+OCieOBruiqjeiovOOBruODquOCr+OCqOOCueODiFxuXG7nm7jmiYvjga/jgYLjgarjgZ/jga7mnKzkurrmgKfjgpLmpJzoqLzjgZfjgojjgYbjgajjgZfjgabjgYTjgb7jgZnjgILmrKHjga7os6rllY/jgavnrZTjgYjjgabjgY/jgaDjgZXjgYTjgIJcblxuJTIkcyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ291bGQgbm90IHZlcmlmeSB0aGlzIHVzZXIncyBpZGVudGlmeS4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi44GT44Gu44Om44O844K244O844Gu5pys5Lq65oCn44KS5qSc6Ki844Gn44GN44G+44Gb44KT44Gn44GX44Gf44CCIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJQZXJzb25hbCBtZXNzYWdlIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuengeS/oSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU3RhcnQgZW5jcnlwdGVkIGNvbnZlcnNhdGlvbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLmmpflj7fljJbjgZXjgozjgZ/kvJroqbHjgpLplovlp4siCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJlZnJlc2ggZW5jcnlwdGVkIGNvbnZlcnNhdGlvbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLmmpflj7fljJbjgZXjgozjgZ/kvJroqbHjgpLjg6rjg5Xjg6zjg4Pjgrfjg6UiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkVuZCBlbmNyeXB0ZWQgY29udmVyc2F0aW9uIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuaal+WPt+WMluOBleOCjOOBn+S8muipseOCkue1guS6hiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVmVyaWZ5IHdpdGggU01QIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlNNUCDjgafmpJzoqLwiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlZlcmlmeSB3aXRoIGZpbmdlcnByaW50cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLpjbXmjIfntIvjgafmpJzoqLwiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIldoYXQncyB0aGlzPyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLjgZPjgozjga/kvZXjgafjgZnjgYs/IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJtZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLnp4EiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNob3cgdGhpcyBtZW51IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuOBk+OBruODoeODi+ODpeODvOOCkuihqOekuiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiV3JpdGUgaW4gdGhlIHRoaXJkIHBlcnNvbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLnrKzkuInogIXjgavmm7jjgY8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJlbW92ZSBtZXNzYWdlcyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLjg6Hjg4Pjgrvjg7zjgrjjgpLliYrpmaQiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgbWVzc2FnZSBjb3VsZCBub3QgYmUgc2VudCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLjg6Hjg4Pjgrvjg7zjgrjjgpLpgIHkv6HjgafjgY3jgb7jgZvjgpPjgafjgZfjgZ8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIldlIHJlY2VpdmVkIGFuIHVuZW5jcnlwdGVkIG1lc3NhZ2UiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi5pqX5Y+35YyW44GV44KM44Gm44GE44Gq44GE44Oh44OD44K744O844K444KS5Y+X5L+h44GX44G+44GX44GfIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJXZSByZWNlaXZlZCBhbiB1bnJlYWRhYmxlIGVuY3J5cHRlZCBtZXNzYWdlIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuiqreOCgeOBquOBhOaal+WPt+WMluODoeODg+OCu+ODvOOCuOOCkuWPl+S/oeOBl+OBvuOBl+OBnyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyB1c2VyIGhhcyByZXF1ZXN0ZWQgYW4gZW5jcnlwdGVkIHNlc3Npb24uIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuOBk+OBruODpuODvOOCtuODvOOBr+aal+WPt+WMluOCu+ODg+OCt+ODp+ODs+OCkuaxguOCgeOBpuOBhOOBvuOBmeOAgiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiSGVyZSBhcmUgdGhlIGZpbmdlcnByaW50cywgcGxlYXNlIGNvbmZpcm0gdGhlbSB3aXRoICUxJHMsIG91dHNpZGUgb2YgdGhpcyBjaGF0LlxuXG5GaW5nZXJwcmludCBmb3IgeW91LCAlMiRzOiAlMyRzXG5cbkZpbmdlcnByaW50IGZvciAlMSRzOiAlNCRzXG5cbklmIHlvdSBoYXZlIGNvbmZpcm1lZCB0aGF0IHRoZSBmaW5nZXJwcmludHMgbWF0Y2gsIGNsaWNrIE9LLCBvdGhlcndpc2UgY2xpY2sgQ2FuY2VsLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLjgZPjgozjga/pjbXmjIfntIvjgafjgZnjgILjg4Hjg6Pjg4Pjg4jku6XlpJbjga7mlrnms5XjgafjgZPjgozjgonjgpIgJTEkcyDjgajnorroqo3jgZfjgabjgY/jgaDjgZXjgYTjgIJcblxu44GC44Gq44GfICUyJHMg44Gu6Y215oyH57SLOiAlMyRzXG5cbiUxJHMg44Gu6Y215oyH57SLOiAlNCRzXG5cbueiuuiqjeOBl+OBpuOAgemNteaMh+e0i+OBjOato+OBl+OBkeOCjOOBsOOAjE9L44CN44KS44CB5q2j44GX44GP44Gq44GR44KM44Gw44CM44Kt44Oj44Oz44K744Or44CN44KS44Kv44Oq44OD44Kv44GX44Gm44GP44Gg44GV44GE44CCIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3Ugd2lsbCBiZSBwcm9tcHRlZCB0byBwcm92aWRlIGEgc2VjdXJpdHkgcXVlc3Rpb24gYW5kIHRoZW4gYW4gYW5zd2VyIHRvIHRoYXQgcXVlc3Rpb24uXG5cbllvdXIgYnVkZHkgd2lsbCB0aGVuIGJlIHByb21wdGVkIHRoZSBzYW1lIHF1ZXN0aW9uIGFuZCBpZiB0aGV5IHR5cGUgdGhlIGV4YWN0IHNhbWUgYW5zd2VyIChjYXNlIHNlbnNpdGl2ZSksIHRoZWlyIGlkZW50aXR5IHdpbGwgaGF2ZSBiZWVuIHZlcmlmaWVkLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLnp5jlr4bjga7os6rllY/jgpLlhaXlipvjgZfjgIHjgZ3jgozjgavlr77jgZfjgabnrZTjgYjjgovjgojjgYbjgavkv4PjgZXjgozjgb7jgZnjgIJcblxu55u45omL44Gr44KC44CB5ZCM44GY6LOq5ZWP44GM6KGo56S644GV44KM44CB5q2j44GX44GP5ZCM44GY562UKOWkp+aWh+Wtl+ODu+Wwj+aWh+Wtl+OBr+WMuuWIpeOBleOCjOOBvuOBmSnjgpLlhaXlipvjgZnjgovjgZPjgajjgafjgIHmnKzkurrmgKfjgpLmpJzoqLzjgZfjgb7jgZnjgIIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIldoYXQgaXMgeW91ciBzZWN1cml0eSBxdWVzdGlvbj8iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi56eY5a+G44Gu6LOq5ZWP44Gv44Gq44KT44Gn44GZ44GLPyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiV2hhdCBpcyB0aGUgYW5zd2VyIHRvIHRoZSBzZWN1cml0eSBxdWVzdGlvbj8iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi56eY5a+G44Gu6LOq5ZWP44Gu562U44Gv44Gq44KT44Gn44GZ44GLPyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiSW52YWxpZCBhdXRoZW50aWNhdGlvbiBzY2hlbWUgcHJvdmlkZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi6KqN6Ki844Gu5pa55byP44GM5q2j44GX44GP44GC44KK44G+44Gb44KTIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG1lc3NhZ2VzIGFyZSBub3QgZW5jcnlwdGVkIGFueW1vcmUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi44Oh44OD44K744O844K444Gv44KC44GG5pqX5Y+35YyW44GV44KM44G+44Gb44KTIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG1lc3NhZ2VzIGFyZSBub3cgZW5jcnlwdGVkIGJ1dCB5b3VyIGJ1ZGR5J3MgaWRlbnRpdHkgaGFzIG5vdCBiZWVuIHZlcmlmaWVkLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLjg6Hjg4Pjgrvjg7zjgrjjga/mmpflj7fljJbjgZXjgozjgb7jgZnjgYzjgIHnm7jmiYvjgYzmnKzkurrjgafjgYLjgovjgZPjgajjga/mpJzoqLzjgZXjgozjgabjgYTjgb7jgZvjgpPjgIIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgYnVkZHkncyBpZGVudGlmeSBoYXMgYmVlbiB2ZXJpZmllZC4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi55u45omL44Gu5pys5Lq65oCn44KS5qSc6Ki844GX44G+44GX44Gf44CCIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIGJ1ZGR5IGhhcyBlbmRlZCBlbmNyeXB0aW9uIG9uIHRoZWlyIGVuZCwgeW91IHNob3VsZCBkbyB0aGUgc2FtZS4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi55u45omL44Gv44CB5pqX5Y+35YyW44KS57WC5LqG44GX44G+44GX44Gf44CC44GC44Gq44Gf44KC44Gd44KM44Gr5ZCI44KP44Gb44KL5b+F6KaB44GM44GC44KK44G+44GZ44CCIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG1lc3NhZ2VzIGFyZSBub3QgZW5jcnlwdGVkLiBDbGljayBoZXJlIHRvIGVuYWJsZSBPVFIgZW5jcnlwdGlvbi4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi44Oh44OD44K744O844K444Gv5pqX5Y+35YyW44GV44KM44G+44Gb44KT44CCT1RSIOaal+WPt+WMluOCkuacieWKueOBq+OBmeOCi+OBq+OBr+OBk+OBk+OCkuOCr+ODquODg+OCr+OBl+OBpuOBj+OBoOOBleOBhOOAgiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBtZXNzYWdlcyBhcmUgZW5jcnlwdGVkLCBidXQgeW91ciBidWRkeSBoYXMgbm90IGJlZW4gdmVyaWZpZWQuIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuODoeODg+OCu+ODvOOCuOOBr+aal+WPt+WMluOBleOCjOOBvuOBmeOBjOOAgeebuOaJi+OBr+aknOiovOOBleOCjOOBpuOBhOOBvuOBm+OCk+OAgiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBtZXNzYWdlcyBhcmUgZW5jcnlwdGVkIGFuZCB5b3VyIGJ1ZGR5IHZlcmlmaWVkLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLjg6Hjg4Pjgrvjg7zjgrjjga/mmpflj7fljJbjgZXjgozjgIHnm7jmiYvjgoLmpJzoqLzjgZXjgozjgabjgYTjgb7jgZnjgIIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgYnVkZHkgaGFzIGNsb3NlZCB0aGVpciBlbmQgb2YgdGhlIHByaXZhdGUgc2Vzc2lvbiwgeW91IHNob3VsZCBkbyB0aGUgc2FtZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLnm7jmiYvjga/np4Hkv6HjgpLntYLkuobjgZfjgb7jgZfjgZ/jgILjgYLjgarjgZ/jgoLlkIzjgZjjgojjgYbjgavjgZfjgabjgY/jgaDjgZXjgYQiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNvbnRhY3RzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuebuOaJi+WFiCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiT25saW5lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuOCquODs+ODqeOCpOODsyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQnVzeSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLlj5bjgorovrzjgb/kuK0iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkF3YXkiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi6Zui5bit5LitIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJPZmZsaW5lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuOCquODleODqeOCpOODsyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgdG8gYWRkIG5ldyBjaGF0IGNvbnRhY3RzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuOCr+ODquODg+OCr+OBl+OBpuaWsOOBl+OBhOODgeODo+ODg+ODiOOBruebuOaJi+WFiOOCkui/veWKoCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQWRkIGEgY29udGFjdCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLnm7jmiYvlhYjjgpLov73liqAiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNvbnRhY3QgdXNlcm5hbWUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi55u45omL5YWI44Gu5ZCN5YmNIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJBZGQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi6L+95YqgIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb250YWN0IG5hbWUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi5ZCN5YmNIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTZWFyY2giOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi5qSc57SiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJObyB1c2VycyBmb3VuZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLjg6bjg7zjgrbjg7zjgYzopovjgaTjgYvjgorjgb7jgZvjgpMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNsaWNrIHRvIGFkZCBhcyBhIGNoYXQgY29udGFjdCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLjgq/jg6rjg4Pjgq/jgZfjgabjg4Hjg6Pjg4Pjg4jjga7nm7jmiYvlhYjjgajjgZfjgabov73liqAiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNsaWNrIHRvIG9wZW4gdGhpcyByb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuOCr+ODquODg+OCr+OBl+OBpuOBk+OBruirh+ipseWupOOCkumWi+OBjyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU2hvdyBtb3JlIGluZm9ybWF0aW9uIG9uIHRoaXMgcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLjgZPjga7oq4foqbHlrqTjgavjgaTjgYTjgabjga7oqbPntLDjgpLopovjgosiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkRlc2NyaXB0aW9uOiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLoqqzmmI46ICIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiT2NjdXBhbnRzOiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLlhaXlrqTogIU6IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJGZWF0dXJlczoiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi54m55b60OiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUmVxdWlyZXMgYXV0aGVudGljYXRpb24iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi6KqN6Ki844Gu6KaB5rGCIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJIaWRkZW4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi6Z2e6KGo56S6IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSZXF1aXJlcyBhbiBpbnZpdGF0aW9uIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuaLm+W+heOBruimgeaxgiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTW9kZXJhdGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIueZuuiogOWItumZkCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTm9uLWFub255bW91cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLpnZ7ljL/lkI0iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk9wZW4gcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLplovmlL7oq4foqbHlrqQiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlBlcm1hbmVudCByb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuW4uOioreirh+ipseWupCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUHVibGljIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuWFrOmWi+irh+ipseWupCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU2VtaS1hbm9ueW1vdXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi5Y2K5Yy/5ZCNIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUZW1wb3Jhcnkgcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLoh6jmmYLoq4foqbHlrqQiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlVubW9kZXJhdGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIueZuuiogOWItumZkOOBquOBlyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUm9vbXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi6KuH6Kmx5a6kIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSb29tIG5hbWUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi6KuH6Kmx5a6k44Gu5ZCN5YmNIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJOaWNrbmFtZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLjg4vjg4Pjgq/jg43jg7zjg6AiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNlcnZlciI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLjgrXjg7zjg5Djg7wiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkpvaW4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi5YWl5a6kIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTaG93IHJvb21zIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuirh+ipseWupOS4gOimp+OCkuimi+OCiyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTm8gcm9vbXMgb24gJTEkcyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIlMSRzIOOBq+irh+ipseWupOOBr+OBguOCiuOBvuOBm+OCkyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUm9vbXMgb24gJTEkcyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIlMSRzIOOBruirh+ipseWupOS4gOimpyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU2V0IGNoYXRyb29tIHRvcGljIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuirh+ipseWupOOBruipsemhjOOCkuioreWumiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiS2ljayB1c2VyIGZyb20gY2hhdHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi44Om44O844K244O844KS6KuH6Kmx5a6k44GL44KJ6Lm044KK5Ye644GZIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJCYW4gdXNlciBmcm9tIGNoYXRyb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuODpuODvOOCtuODvOOCkuirh+ipseWupOOBi+OCiee3oOOCgeWHuuOBmSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTWVzc2FnZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLjg6Hjg4Pjgrvjg7zjgrgiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNhdmUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi5L+d5a2YIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDYW5jZWwiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi44Kt44Oj44Oz44K744OrIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJBbiBlcnJvciBvY2N1cnJlZCB3aGlsZSB0cnlpbmcgdG8gc2F2ZSB0aGUgZm9ybS4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi44OV44Kp44O844Og44KS5L+d5a2Y44GZ44KL6Zqb44Gr44Ko44Op44O844GM55m655Sf44GX44G+44GX44Gf44CCIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIGNoYXRyb29tIHJlcXVpcmVzIGEgcGFzc3dvcmQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi44GT44Gu6KuH6Kmx5a6k44Gr44Gv44OR44K544Ov44O844OJ44GM5b+F6KaB44Gn44GZIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJQYXNzd29yZDogIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuODkeOCueODr+ODvOODiToiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlN1Ym1pdCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLpgIHkv6EiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBpcyBub3QgYW5vbnltb3VzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuOBk+OBruirh+ipseWupOOBr+mdnuWMv+WQjeOBp+OBmSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyByb29tIG5vdyBzaG93cyB1bmF2YWlsYWJsZSBtZW1iZXJzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuOBk+OBruirh+ipseWupOOBr+ODoeODs+ODkOODvOS7peWkluOBq+OCguimi+OBiOOBvuOBmSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyByb29tIGRvZXMgbm90IHNob3cgdW5hdmFpbGFibGUgbWVtYmVycyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLjgZPjga7oq4foqbHlrqTjga/jg6Hjg7Pjg5Djg7zku6XlpJbjgavjga/opovjgYjjgb7jgZvjgpMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk5vbi1wcml2YWN5LXJlbGF0ZWQgcm9vbSBjb25maWd1cmF0aW9uIGhhcyBjaGFuZ2VkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuirh+ipseWupOOBruioreWumijjg5fjg6njgqTjg5Djgrfjg7zjgavnhKHplqLkv4Ip44GM5aSJ5pu044GV44KM44G+44GX44GfIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSb29tIGxvZ2dpbmcgaXMgbm93IGVuYWJsZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi6KuH6Kmx5a6k44Gu6KiY6Yyy44KS5Y+W44KK44Gv44GY44KB44G+44GZIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSb29tIGxvZ2dpbmcgaXMgbm93IGRpc2FibGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuirh+ipseWupOOBruiomOmMsuOCkuatouOCgeOBvuOBmSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyByb29tIGlzIG5vdyBub24tYW5vbnltb3VzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuOBk+OBruirh+ipseWupOOBr+OBn+OBoOOBhOOBvumdnuWMv+WQjeOBp+OBmSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyByb29tIGlzIG5vdyBzZW1pLWFub255bW91cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLjgZPjga7oq4foqbHlrqTjga/jgZ/jgaDjgYTjgb7ljYrljL/lkI3jgafjgZkiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBpcyBub3cgZnVsbHktYW5vbnltb3VzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuOBk+OBruirh+ipseWupOOBr+OBn+OBoOOBhOOBvuWMv+WQjeOBp+OBmSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQSBuZXcgcm9vbSBoYXMgYmVlbiBjcmVhdGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuaWsOOBl+OBhOirh+ipseWupOOBjOS9nOaIkOOBleOCjOOBvuOBl+OBnyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBuaWNrbmFtZSBoYXMgYmVlbiBjaGFuZ2VkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuODi+ODg+OCr+ODjeODvOODoOOCkuWkieabtOOBl+OBvuOBl+OBnyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IGhhcyBiZWVuIGJhbm5lZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4g44KS57eg44KB5Ye644GX44G+44GX44GfIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gaGFzIGJlZW4ga2lja2VkIG91dCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4g44KS6Lm044KK5Ye644GX44G+44GX44GfIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gaGFzIGJlZW4gcmVtb3ZlZCBiZWNhdXNlIG9mIGFuIGFmZmlsaWF0aW9uIGNoYW5nZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLliIbmjozjga7lpInmm7Tjga7jgZ/jgoHjgIE8c3Ryb25nPiUxJHM8L3N0cm9uZz4g44KS5YmK6Zmk44GX44G+44GX44GfIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gaGFzIGJlZW4gcmVtb3ZlZCBmb3Igbm90IGJlaW5nIGEgbWVtYmVyIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuODoeODs+ODkOODvOOBp+OBquOBj+OBquOBo+OBn+OBn+OCgeOAgTxzdHJvbmc+JTEkczwvc3Ryb25nPiDjgpLliYrpmaTjgZfjgb7jgZfjgZ8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdSBoYXZlIGJlZW4gYmFubmVkIGZyb20gdGhpcyByb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuOBk+OBruirh+ipseWupOOBi+OCiee3oOOCgeWHuuOBleOCjOOBvuOBl+OBnyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91IGhhdmUgYmVlbiBraWNrZWQgZnJvbSB0aGlzIHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi44GT44Gu6KuH6Kmx5a6k44GL44KJ6Lm044KK5Ye644GV44KM44G+44GX44GfIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3UgaGF2ZSBiZWVuIHJlbW92ZWQgZnJvbSB0aGlzIHJvb20gYmVjYXVzZSBvZiBhbiBhZmZpbGlhdGlvbiBjaGFuZ2UiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi5YiG5o6M44Gu5aSJ5pu044Gu44Gf44KB44CB44GT44Gu6KuH6Kmx5a6k44GL44KJ5YmK6Zmk44GV44KM44G+44GX44GfIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3UgaGF2ZSBiZWVuIHJlbW92ZWQgZnJvbSB0aGlzIHJvb20gYmVjYXVzZSB0aGUgcm9vbSBoYXMgY2hhbmdlZCB0byBtZW1iZXJzLW9ubHkgYW5kIHlvdSdyZSBub3QgYSBtZW1iZXIiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi6KuH6Kmx5a6k44GM44Oh44Oz44OQ44O85Yi244Gr5aSJ5pu044GV44KM44G+44GX44Gf44CC44Oh44Oz44OQ44O844Gn44Gv44Gq44GE44Gf44KB44CB44GT44Gu6KuH6Kmx5a6k44GL44KJ5YmK6Zmk44GV44KM44G+44GX44GfIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3UgaGF2ZSBiZWVuIHJlbW92ZWQgZnJvbSB0aGlzIHJvb20gYmVjYXVzZSB0aGUgTVVDIChNdWx0aS11c2VyIGNoYXQpIHNlcnZpY2UgaXMgYmVpbmcgc2h1dCBkb3duLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJNVUMo44Kw44Or44O844OX44OB44Oj44OD44OIKeOBruOCteODvOODk+OCueOBjOWBnOatouOBl+OBn+OBn+OCgeOAgeOBk+OBruirh+ipseWupOOBi+OCieWJiumZpOOBleOCjOOBvuOBl+OBn+OAgiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91IGFyZSBub3Qgb24gdGhlIG1lbWJlciBsaXN0IG9mIHRoaXMgcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLjgZPjga7oq4foqbHlrqTjga7jg6Hjg7Pjg5Djg7zkuIDopqfjgavjgYTjgb7jgZvjgpMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk5vIG5pY2tuYW1lIHdhcyBzcGVjaWZpZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi44OL44OD44Kv44ON44O844Og44GM44GC44KK44G+44Gb44KTIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3UgYXJlIG5vdCBhbGxvd2VkIHRvIGNyZWF0ZSBuZXcgcm9vbXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi5paw44GX44GE6KuH6Kmx5a6k44KS5L2c5oiQ44GZ44KL5qip6ZmQ44GM44GC44KK44G+44Gb44KTIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG5pY2tuYW1lIGRvZXNuJ3QgY29uZm9ybSB0byB0aGlzIHJvb20ncyBwb2xpY2llcyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLjg4vjg4Pjgq/jg43jg7zjg6DjgYzjgZPjga7oq4foqbHlrqTjga7jg53jg6rjgrfjg7zjgavlvpPjgaPjgabjgYTjgb7jgZvjgpMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgbmlja25hbWUgaXMgYWxyZWFkeSB0YWtlbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLjg4vjg4Pjgq/jg43jg7zjg6Djga/ml6Ljgavkvb/jgo/jgozjgabjgYTjgb7jgZkiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBkb2VzIG5vdCAoeWV0KSBleGlzdCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLjgZPjga7oq4foqbHlrqTjga/lrZjlnKjjgZfjgb7jgZvjgpMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBoYXMgcmVhY2hlZCBpdCdzIG1heGltdW0gbnVtYmVyIG9mIG9jY3VwYW50cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLjgZPjga7oq4foqbHlrqTjga/lhaXlrqTogIXmlbDjga7kuIrpmZDjgavpgZTjgZfjgabjgYTjgb7jgZkiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRvcGljIHNldCBieSAlMSRzIHRvOiAlMiRzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiUxJHMg44GM6Kmx6aGM44KS6Kit5a6a44GX44G+44GX44GfOiAlMiRzIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHVzZXIgaXMgYSBtb2RlcmF0b3IiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi44GT44Gu44Om44O844K244O844Gv5Y+45Lya6ICF44Gn44GZIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHVzZXIgY2FuIHNlbmQgbWVzc2FnZXMgaW4gdGhpcyByb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuOBk+OBruODpuODvOOCtuODvOOBr+OBk+OBruirh+ipseWupOOBp+eZuuiogOOBp+OBjeOBvuOBmSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyB1c2VyIGNhbiBOT1Qgc2VuZCBtZXNzYWdlcyBpbiB0aGlzIHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi44GT44Gu44Om44O844K244O844Gv44GT44Gu6KuH6Kmx5a6k44Gn55m66KiA44Gn44GN44G+44Gb44KTIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDbGljayB0byBjaGF0IHdpdGggdGhpcyBjb250YWN0IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuOCr+ODquODg+OCr+OBl+OBpuOBk+OBruebuOaJi+WFiOOBqOODgeODo+ODg+ODiCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgdG8gcmVtb3ZlIHRoaXMgY29udGFjdCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLjgq/jg6rjg4Pjgq/jgZfjgabjgZPjga7nm7jmiYvlhYjjgpLliYrpmaQiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNvbnRhY3QgcmVxdWVzdHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi5Lya6Kmx44Gr5ZG844Gz5Ye644GXIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJNeSBjb250YWN0cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLnm7jmiYvlhYjkuIDopqciCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlBlbmRpbmcgY29udGFjdHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi5L+d55WZ5Lit44Gu55u45omL5YWIIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDdXN0b20gc3RhdHVzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIueLrOiHquOBruWcqOW4reeKtuazgSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgdG8gY2hhbmdlIHlvdXIgY2hhdCBzdGF0dXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi44Kv44Oq44OD44Kv44GX44Gm44CB5Zyo5bit54q25rOB44KS5aSJ5pu0IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDbGljayBoZXJlIHRvIHdyaXRlIGEgY3VzdG9tIHN0YXR1cyBtZXNzYWdlIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIueKtuazgeODoeODg+OCu+ODvOOCuOOCkuWFpeWKm+OBmeOCi+OBq+OBr+OAgeOBk+OBk+OCkuOCr+ODquODg+OCryIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAib25saW5lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuWcqOW4rSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiYnVzeSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLlj5bjgorovrzjgb/kuK0iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgImF3YXkgZm9yIGxvbmciOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi5LiN5ZyoIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJhd2F5IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIumbouW4reS4rSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiSSBhbSAlMSRzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuengeOBr+OBhOOBviAlMSRzIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTaWduIGluIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIuOCteOCpOODs+OCpOODsyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWE1QUC9KYWJiZXIgVXNlcm5hbWU6IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlhNUFAvSmFiYmVyIOODpuODvOOCtuODvOWQjToiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlBhc3N3b3JkOiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICLjg5Hjgrnjg6/jg7zjg4k6IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJMb2cgSW4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAi44Ot44Kw44Kk44OzIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJCT1NIIFNlcnZpY2UgVVJMOiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJCT1NIIOOCteODvOODk+OCuSBVUkw6IgogICAgICAgICAgICAgICAgXQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIGlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHsKICAgICAgICBkZWZpbmUoImphIiwgWydqZWQnXSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gZmFjdG9yeShuZXcgSmVkKHRyYW5zbGF0aW9ucykpOwogICAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgICBpZiAoIXdpbmRvdy5sb2NhbGVzKSB7CiAgICAgICAgICAgIHdpbmRvdy5sb2NhbGVzID0ge307CiAgICAgICAgfQogICAgICAgIHdpbmRvdy5sb2NhbGVzLmphID0gZmFjdG9yeShuZXcgSmVkKHRyYW5zbGF0aW9ucykpOwogICAgfQp9KHRoaXMsIGZ1bmN0aW9uIChqYSkgeyAKICAgIHJldHVybiBqYTsgCn0pKTsKCihmdW5jdGlvbiAocm9vdCwgZmFjdG9yeSkgewogICAgdmFyIHRyYW5zbGF0aW9ucyA9IHsKICAgICAgICAiZG9tYWluIjogImNvbnZlcnNlIiwKICAgICAgICAibG9jYWxlX2RhdGEiOiB7CiAgICAgICAgICAgICJjb252ZXJzZSI6IHsKICAgICAgICAgICAgICAgICIiOiB7CiAgICAgICAgICAgICAgICAgICAgIlByb2plY3QtSWQtVmVyc2lvbiI6ICJDb252ZXJzZS5qcyAwLjQiLAogICAgICAgICAgICAgICAgICAgICJSZXBvcnQtTXNnaWQtQnVncy1UbyI6ICIiLAogICAgICAgICAgICAgICAgICAgICJQT1QtQ3JlYXRpb24tRGF0ZSI6ICIyMDEzLTA5LTE1IDIxOjU1KzAyMDAiLAogICAgICAgICAgICAgICAgICAgICJQTy1SZXZpc2lvbi1EYXRlIjogIjIwMTMtMDktMTUgMjI6MDMrMDIwMCIsCiAgICAgICAgICAgICAgICAgICAgIkxhc3QtVHJhbnNsYXRvciI6ICJNYWFydGVuIEtsaW5nIDxtYWFydGVuQGZvdXJkaWdpdHMubmw+IiwKICAgICAgICAgICAgICAgICAgICAiTGFuZ3VhZ2UtVGVhbSI6ICJEdXRjaCIsCiAgICAgICAgICAgICAgICAgICAgIkxhbmd1YWdlIjogIm5sIiwKICAgICAgICAgICAgICAgICAgICAiTUlNRS1WZXJzaW9uIjogIjEuMCIsCiAgICAgICAgICAgICAgICAgICAgIkNvbnRlbnQtVHlwZSI6ICJ0ZXh0L3BsYWluOyBjaGFyc2V0PVVURi04IiwKICAgICAgICAgICAgICAgICAgICAiQ29udGVudC1UcmFuc2Zlci1FbmNvZGluZyI6ICI4Yml0IiwKICAgICAgICAgICAgICAgICAgICAiUGx1cmFsLUZvcm1zIjogIm5wbHVyYWxzPTI7IHBsdXJhbD0obiAhPSAxKTsiLAogICAgICAgICAgICAgICAgICAgICJkb21haW4iOiAiY29udmVyc2UiLAogICAgICAgICAgICAgICAgICAgICJsYW5nIjogIm5sIiwKICAgICAgICAgICAgICAgICAgICAicGx1cmFsX2Zvcm1zIjogIm5wbHVyYWxzPTI7IHBsdXJhbD0obiAhPSAxKTsiCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgInVuZW5jcnlwdGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIm9uZ2Vjb2RlZXJkZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAidW52ZXJpZmllZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJuaWV0IGdldmVyaWZpZWVyZCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAidmVyaWZpZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiZ2V2ZXJpZmllZXJkIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJmaW5pc2hlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJrbGFhciIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiRGlzY29ubmVjdGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlZlcmJpbmRpbmcgdmVyYnJva2VuLiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiRXJyb3IiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRXJyb3IiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNvbm5lY3RpbmciOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVmVyYmluZGVuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb25uZWN0aW9uIEZhaWxlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJWZXJiaW5kZW4gbWlzbHVrdCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQXV0aGVudGljYXRpbmciOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQXV0aGVudGljZXJlbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQXV0aGVudGljYXRpb24gRmFpbGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkF1dGhlbnRpY2VyZW4gbWlzbHVrdCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiRGlzY29ubmVjdGluZyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJlLWVzdGFibGlzaGluZyBlbmNyeXB0ZWQgc2Vzc2lvbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJCZXppZyB2ZXJzbGV1dGVsZGUgc2Vzc2llIHRlIGhlcnN0ZWxsZW4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgYnJvd3NlciBuZWVkcyB0byBnZW5lcmF0ZSBhIHByaXZhdGUga2V5LCB3aGljaCB3aWxsIGJlIHVzZWQgaW4geW91ciBlbmNyeXB0ZWQgY2hhdCBzZXNzaW9uLiBUaGlzIGNhbiB0YWtlIHVwIHRvIDMwIHNlY29uZHMgZHVyaW5nIHdoaWNoIHlvdXIgYnJvd3NlciBtaWdodCBmcmVlemUgYW5kIGJlY29tZSB1bnJlc3BvbnNpdmUuIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUHJpdmF0ZSBrZXkgZ2VuZXJhdGVkLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJQcml2YXRlIGtleSBnZWdlbmVyZWVyZC4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkF1dGhlbnRpY2F0aW9uIHJlcXVlc3QgZnJvbSAlMSRzXG5cbllvdXIgYnVkZHkgaXMgYXR0ZW1wdGluZyB0byB2ZXJpZnkgeW91ciBpZGVudGl0eSwgYnkgYXNraW5nIHlvdSB0aGUgcXVlc3Rpb24gYmVsb3cuXG5cbiUyJHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb3VsZCBub3QgdmVyaWZ5IHRoaXMgdXNlcidzIGlkZW50aWZ5LiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJOaWV0IGtvbiBkZSBpZGVudGl0ZWl0IHZhbiBkZXplIGdlYnJ1aWtlciBuaWV0IGlkZW50aWZpY2VyZW4uIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJQZXJzb25hbCBtZXNzYWdlIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlBlcnNvb25saWprIGJlcmljaHQiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlN0YXJ0IGVuY3J5cHRlZCBjb252ZXJzYXRpb24iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU3RhcnQgZW5jcnlwdGVkIGdlc3ByZWsiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJlZnJlc2ggZW5jcnlwdGVkIGNvbnZlcnNhdGlvbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJWZXJ2ZXJzIGVuY3J5cHRlZCBnZXNwcmVrIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJFbmQgZW5jcnlwdGVkIGNvbnZlcnNhdGlvbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJCZWVpbmRpZyBlbmNyeXB0ZWQgZ2VzcHJlayIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVmVyaWZ5IHdpdGggU01QIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVmVyaWZ5IHdpdGggZmluZ2VycHJpbnRzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiV2hhdCdzIHRoaXM/IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIldhdCBpcyBkaXQ/IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJtZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJpa3plbGYiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNob3cgdGhpcyBtZW51IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlRvb24gZGl0IG1lbnUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIldyaXRlIGluIHRoZSB0aGlyZCBwZXJzb24iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU2NocmlqZiBpbiBkZSAzZGUgcGVyc29vbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUmVtb3ZlIG1lc3NhZ2VzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlZlcndpamRlciBiZXJpY2h0IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG1lc3NhZ2UgY291bGQgbm90IGJlIHNlbnQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSmUgYmVyaWNodCBrb24gbmlldCB3b3JkZW4gdmVyem9uZGVuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJXZSByZWNlaXZlZCBhbiB1bmVuY3J5cHRlZCBtZXNzYWdlIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIldlIG9udHZpbmdlbiBlZW4gdW5lbmNyeXB0ZWQgYmVyaWNodCAiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIldlIHJlY2VpdmVkIGFuIHVucmVhZGFibGUgZW5jcnlwdGVkIG1lc3NhZ2UiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiV2Ugb250dmFuZ2VuIGVlbiBvbmxlZXNiYWFyIHVuZW5jcnlwdGVkIGJlcmljaHQiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgdXNlciBoYXMgcmVxdWVzdGVkIGFuIGVuY3J5cHRlZCBzZXNzaW9uLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJEZXplIGdlYnJ1aWtlciBoZWVmdCBlZW4gZW5jcnlwdGVkIHNlc3NpZSBhYW5nZXZyYWFnZC4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkhlcmUgYXJlIHRoZSBmaW5nZXJwcmludHMsIHBsZWFzZSBjb25maXJtIHRoZW0gd2l0aCAlMSRzLCBvdXRzaWRlIG9mIHRoaXMgY2hhdC5cblxuRmluZ2VycHJpbnQgZm9yIHlvdSwgJTIkczogJTMkc1xuXG5GaW5nZXJwcmludCBmb3IgJTEkczogJTQkc1xuXG5JZiB5b3UgaGF2ZSBjb25maXJtZWQgdGhhdCB0aGUgZmluZ2VycHJpbnRzIG1hdGNoLCBjbGljayBPSywgb3RoZXJ3aXNlIGNsaWNrIENhbmNlbC4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3Ugd2lsbCBiZSBwcm9tcHRlZCB0byBwcm92aWRlIGEgc2VjdXJpdHkgcXVlc3Rpb24gYW5kIHRoZW4gYW4gYW5zd2VyIHRvIHRoYXQgcXVlc3Rpb24uXG5cbllvdXIgYnVkZHkgd2lsbCB0aGVuIGJlIHByb21wdGVkIHRoZSBzYW1lIHF1ZXN0aW9uIGFuZCBpZiB0aGV5IHR5cGUgdGhlIGV4YWN0IHNhbWUgYW5zd2VyIChjYXNlIHNlbnNpdGl2ZSksIHRoZWlyIGlkZW50aXR5IHdpbGwgaGF2ZSBiZWVuIHZlcmlmaWVkLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIldoYXQgaXMgeW91ciBzZWN1cml0eSBxdWVzdGlvbj8iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiV2F0IGlzIGpvdSBzZXJpY3VyeSB2cmFhZz8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIldoYXQgaXMgdGhlIGFuc3dlciB0byB0aGUgc2VjdXJpdHkgcXVlc3Rpb24/IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIldhdCBpcyBoZXQgYW50d29vcmQgb3AgZGUgc2VjdXJpdHkgdnJhYWc/IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJJbnZhbGlkIGF1dGhlbnRpY2F0aW9uIHNjaGVtZSBwcm92aWRlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgbWVzc2FnZXMgYXJlIG5vdCBlbmNyeXB0ZWQgYW55bW9yZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJKZSBiZXJpY2h0ZW4gemlqbiBuaWV0IG1lZXIgZW5jcnlwdGVkIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG1lc3NhZ2VzIGFyZSBub3cgZW5jcnlwdGVkIGJ1dCB5b3VyIGJ1ZGR5J3MgaWRlbnRpdHkgaGFzIG5vdCBiZWVuIHZlcmlmaWVkLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgYnVkZHkncyBpZGVudGlmeSBoYXMgYmVlbiB2ZXJpZmllZC4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSm91IGNvbnRhY3QgaXMgZ2V2ZXJpZmllZXJkIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIGJ1ZGR5IGhhcyBlbmRlZCBlbmNyeXB0aW9uIG9uIHRoZWlyIGVuZCwgeW91IHNob3VsZCBkbyB0aGUgc2FtZS4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSm91IGNvbnRhY3QgaGVlZnQgZW5jcnlwdGlvbiBhYW5zdGFhbiwgamUgbW9ldCBoZXQgemVsZmRlIGRvZW4uIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG1lc3NhZ2VzIGFyZSBub3QgZW5jcnlwdGVkLiBDbGljayBoZXJlIHRvIGVuYWJsZSBPVFIgZW5jcnlwdGlvbi4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSm91IGJlcmljaHQgaXMgbmlldCBlbmNyeXB0ZWQuIEtMaWsgaGllciBvbSBPUkMgZW5jcnl0aW9uIGFhbiB0ZSB6ZXR0ZW4uIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG1lc3NhZ2VzIGFyZSBlbmNyeXB0ZWQsIGJ1dCB5b3VyIGJ1ZGR5IGhhcyBub3QgYmVlbiB2ZXJpZmllZC4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSm91IGJlcmljaHRlbiB6aWpuIGVuY3J5cHRlZCwgbWFhciBqZSBjb250YWN0IGlzIG5pZXQgZ2V2ZXJpZmllZXJkLiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBtZXNzYWdlcyBhcmUgZW5jcnlwdGVkIGFuZCB5b3VyIGJ1ZGR5IHZlcmlmaWVkLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJKb3UgYmVyaWNodCBpcyBlbmNyeXB0ZWQgZW4gam91IGNvbnRhY3QgaXMgZ2V2ZXJpZmllZXJkLiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBidWRkeSBoYXMgY2xvc2VkIHRoZWlyIGVuZCBvZiB0aGUgcHJpdmF0ZSBzZXNzaW9uLCB5b3Ugc2hvdWxkIGRvIHRoZSBzYW1lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ29udGFjdHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQ29udGFjdGVuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJPbmxpbmUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiT25saW5lIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJCdXN5IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkJlemV0IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJBd2F5IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkFmd2V6aWciCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk9mZmxpbmUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDbGljayB0byBhZGQgbmV3IGNoYXQgY29udGFjdHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiS2xpayBvbSBuaWV1d2UgY29udGFjdGVuIHRvZSB0ZSB2b2VnZW4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkFkZCBhIGNvbnRhY3QiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVm9lZyBjb250YWN0IHRvZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ29udGFjdCB1c2VybmFtZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDb250YWN0IGdlYnJ1aWtlcm5hYW0iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkFkZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJUb2V2b2VnZW4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNvbnRhY3QgbmFtZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDb250YWN0IG5hYW0iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNlYXJjaCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJab2VrZW4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk5vIHVzZXJzIGZvdW5kIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkdlZW4gZ2VicnVpa2VycyBnZXZvbmRlbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgdG8gYWRkIGFzIGEgY2hhdCBjb250YWN0IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIktsaWsgb20gY29udGFjdCB0b2UgdGUgdm9lZ2VuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDbGljayB0byBvcGVuIHRoaXMgcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJLbGlrIG9tIHJvb20gdGUgb3BlbmVuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTaG93IG1vcmUgaW5mb3JtYXRpb24gb24gdGhpcyByb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlRvb24gbWVlciBpbmZvcm1hdGllIG92ZXIgZGV6ZSByb29tIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJEZXNjcmlwdGlvbjoiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQmVzY2hyaWp2aW5nIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJPY2N1cGFudHM6IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkRlZWxuZW1lcnM6IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJGZWF0dXJlczoiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRnVuY3RpZXM6IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSZXF1aXJlcyBhdXRoZW50aWNhdGlvbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJWZXJpZmljYXRpZSB2ZXJlaXN0IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJIaWRkZW4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVmVyYm9yZ2VuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSZXF1aXJlcyBhbiBpbnZpdGF0aW9uIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlZlcmllc3QgZWVuIHVpdG5vZGlnaW5nIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJNb2RlcmF0ZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiR2Vtb2RlcmVlcmQiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk5vbi1hbm9ueW1vdXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTmlldCBhbm5vbmllbSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiT3BlbiByb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk9wZW4gcm9vbSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUGVybWFuZW50IHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQmxpanZlbmQgcm9vbSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUHVibGljIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlB1YmxpZWsiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNlbWktYW5vbnltb3VzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlNlbWkgYW5ub25pZW0iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRlbXBvcmFyeSByb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlRpamRlbGlqa2Ugcm9vbSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVW5tb2RlcmF0ZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTmlldCBnZW1vZGVyZWVyZCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUm9vbXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiUm9vbXMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJvb20gbmFtZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJSb29tIG5hYW0iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk5pY2tuYW1lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk5pY2tuYW1lIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTZXJ2ZXIiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU2VydmVyIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJKb2luIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkRlZWxuZW1lbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU2hvdyByb29tcyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJUb29uIHJvb21zIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJObyByb29tcyBvbiAlMSRzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkdlZW4gcm9vbSBvcCAlMSRzIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJSb29tcyBvbiAlMSRzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlJvb20gb3AgJTEkcyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU2V0IGNoYXRyb29tIHRvcGljIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlpldCBjaGF0cm9vbSB0b3BpYyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiS2ljayB1c2VyIGZyb20gY2hhdHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiR29laSBnZWJydWlrZXIgdWl0IGNoYXRyb29tIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJCYW4gdXNlciBmcm9tIGNoYXRyb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkJhbiBnZWJydWlrZXIgdmFuIGNoYXRyb29tIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJNZXNzYWdlIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkJlcmljaHQiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNhdmUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiT3BzbGFhbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ2FuY2VsIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkFubnVsZXJlbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQW4gZXJyb3Igb2NjdXJyZWQgd2hpbGUgdHJ5aW5nIHRvIHNhdmUgdGhlIGZvcm0uIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkVlbiBlcnJvciB0aWpkZW5zIGhldCBvcHNsYWFuIHZhbiBoZXQgZm9ybXVsaWVyLiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyBjaGF0cm9vbSByZXF1aXJlcyBhIHBhc3N3b3JkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkNoYXRyb29tIGhlZWZ0IGVlbiB3YWNodHdvb3JkIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJQYXNzd29yZDogIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIldhY2h0d29vcmQ6ICIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU3VibWl0IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkluZGllbmVuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gaXMgbm90IGFub255bW91cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJEZXplIHJvb20gaXMgbmlldCBhbm5vbmllbSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyByb29tIG5vdyBzaG93cyB1bmF2YWlsYWJsZSBtZW1iZXJzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyByb29tIGRvZXMgbm90IHNob3cgdW5hdmFpbGFibGUgbWVtYmVycyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk5vbi1wcml2YWN5LXJlbGF0ZWQgcm9vbSBjb25maWd1cmF0aW9uIGhhcyBjaGFuZ2VkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUm9vbSBsb2dnaW5nIGlzIG5vdyBlbmFibGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUm9vbSBsb2dnaW5nIGlzIG5vdyBkaXNhYmxlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBpcyBub3cgbm9uLWFub255bW91cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJEZXplIHJvb20gaXMgbnUgbmlldCBhbm5vbmllbSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyByb29tIGlzIG5vdyBzZW1pLWFub255bW91cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJEZXplIHJvb20gaXMgbnUgc2VtaWUgYW5ub25pZW0iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBpcyBub3cgZnVsbHktYW5vbnltb3VzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkRlemUgcm9vbSBpcyBudSB2b2xsZWRpZyBhbm5vbmllbSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQSBuZXcgcm9vbSBoYXMgYmVlbiBjcmVhdGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkVlbiBuaWV1d2Ugcm9vbSBpcyBnZW1hYWt0IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG5pY2tuYW1lIGhhcyBiZWVuIGNoYW5nZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSmUgbmlja25hbWUgaXMgdmVyYW5kZXJkIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gaGFzIGJlZW4gYmFubmVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIjxzdHJvbmc+JTEkczwvc3Ryb25nPiBpcyB2ZXJiYW5uZW4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIjxzdHJvbmc+JTEkczwvc3Ryb25nPiBoYXMgYmVlbiBraWNrZWQgb3V0IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIjxzdHJvbmc+JTEkczwvc3Ryb25nPiBoYXMgYmVlbiBraWNrZWQgb3V0IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gaGFzIGJlZW4gcmVtb3ZlZCBiZWNhdXNlIG9mIGFuIGFmZmlsaWF0aW9uIGNoYW5nZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIjxzdHJvbmc+JTEkczwvc3Ryb25nPiBoYXMgYmVlbiByZW1vdmVkIGZvciBub3QgYmVpbmcgYSBtZW1iZXIiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3UgaGF2ZSBiZWVuIGJhbm5lZCBmcm9tIHRoaXMgcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJKZSBiZW50IHZlcmJhbm5lbiB1aXQgZGV6ZSByb29tIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3UgaGF2ZSBiZWVuIGtpY2tlZCBmcm9tIHRoaXMgcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJKZSBiZW50IHVpdCBkZSByb29tIGdlZ29vaWQiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdSBoYXZlIGJlZW4gcmVtb3ZlZCBmcm9tIHRoaXMgcm9vbSBiZWNhdXNlIG9mIGFuIGFmZmlsaWF0aW9uIGNoYW5nZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdSBoYXZlIGJlZW4gcmVtb3ZlZCBmcm9tIHRoaXMgcm9vbSBiZWNhdXNlIHRoZSByb29tIGhhcyBjaGFuZ2VkIHRvIG1lbWJlcnMtb25seSBhbmQgeW91J3JlIG5vdCBhIG1lbWJlciI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdSBoYXZlIGJlZW4gcmVtb3ZlZCBmcm9tIHRoaXMgcm9vbSBiZWNhdXNlIHRoZSBNVUMgKE11bHRpLXVzZXIgY2hhdCkgc2VydmljZSBpcyBiZWluZyBzaHV0IGRvd24uIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91IGFyZSBub3Qgb24gdGhlIG1lbWJlciBsaXN0IG9mIHRoaXMgcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJKZSBiZW50IG5pZXQgZWVuIGdlYnJ1aWtlciB2YW4gZGV6ZSByb29tIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJObyBuaWNrbmFtZSB3YXMgc3BlY2lmaWVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkdlZW4gbmlja25hbWUgaW5nZWdldmVuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3UgYXJlIG5vdCBhbGxvd2VkIHRvIGNyZWF0ZSBuZXcgcm9vbXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSmUgYmVudCBuaWV0IHRvZWdlc3RhYW4gbmlldXdlIHJvb21zIHRlIG1ha2VuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG5pY2tuYW1lIGRvZXNuJ3QgY29uZm9ybSB0byB0aGlzIHJvb20ncyBwb2xpY2llcyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJKZSBuaWNrbmFtZSBpcyBuaWV0IGNvbmZvcm0gcG9saWN5IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG5pY2tuYW1lIGlzIGFscmVhZHkgdGFrZW4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiSmUgbmlja25hbWUgYmVzdGFhdCBhbCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyByb29tIGRvZXMgbm90ICh5ZXQpIGV4aXN0IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkRlemUgcm9vbSBiZXN0YWF0IG5pZXQiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBoYXMgcmVhY2hlZCBpdCdzIG1heGltdW0gbnVtYmVyIG9mIG9jY3VwYW50cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJEZXplIHJvb20gaGVlZnQgaGV0IG1heGltYWxlIGFhbnRhbCBnZWJydWlrZXJzIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUb3BpYyBzZXQgYnkgJTEkcyB0bzogJTIkcyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgdXNlciBpcyBhIG1vZGVyYXRvciI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJEaXQgaXMgZWVuIG1vZGVyYXRvciIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyB1c2VyIGNhbiBzZW5kIG1lc3NhZ2VzIGluIHRoaXMgcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJEZXplIGdlYnJ1aWtlciBrYW4gYmVyaWNodGVuIHN0dXJlbiBpbiBkZXplIHJvb20iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgdXNlciBjYW4gTk9UIHNlbmQgbWVzc2FnZXMgaW4gdGhpcyByb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkRlemUgZ2VicnVpa2VyIGthbiBOSUVUIGVlbiBiZXJpY2h0IHN0dXJlbiBpbiBkZXplIHJvb20iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNsaWNrIHRvIGNoYXQgd2l0aCB0aGlzIGNvbnRhY3QiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiS2xpayBvbSB0ZSBjaGF0dGVuIG1ldCBjb250YWN0IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDbGljayB0byByZW1vdmUgdGhpcyBjb250YWN0IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIktsaWsgb20gY29udGFjdCB0ZSB2ZXJ3aWpkZXJlbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyBjb250YWN0IGlzIGJ1c3kiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQ29udGFjdCBpcyBiZXpldCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyBjb250YWN0IGlzIG9ubGluZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDb250YWN0IGlzIG9ubGluZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyBjb250YWN0IGlzIG9mZmxpbmUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQ29udGFjdCBpcyBvZmZsaW5lIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIGNvbnRhY3QgaXMgdW5hdmFpbGFibGUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQ29udGFjdCBpcyBuaWV0IGJlc2NoaWtiYWFyIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIGNvbnRhY3QgaXMgYXdheSBmb3IgYW4gZXh0ZW5kZWQgcGVyaW9kIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkNvbnRhY3QgaXMgYWZ3ZXppZyB2b29yIGxhbmdlIHBlcmlvZGUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgY29udGFjdCBpcyBhd2F5IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkNvbmFjdCBpcyBhZndlemlnIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb250YWN0IHJlcXVlc3RzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkNvbnRhY3QgdWl0bm9kaWdpbmciCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk15IGNvbnRhY3RzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk1pam4gY29udGFjdHMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlBlbmRpbmcgY29udGFjdHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQ29uYWN0ZW4gaW4gYWZ3YWNodGluZyB2YW4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkN1c3RvbSBzdGF0dXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDbGljayB0byBjaGFuZ2UgeW91ciBjaGF0IHN0YXR1cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJLbGlrIGhpZXIgb20gc3RhdHVzIHRlIHdpanppZ2VuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDbGljayBoZXJlIHRvIHdyaXRlIGEgY3VzdG9tIHN0YXR1cyBtZXNzYWdlIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIktsaWsgaGllciBvbSBjdXN0b20gc3RhdHVzIGJlcmljaHQgdGUgbWFrZW4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIm9ubGluZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJvbmxpbmUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgImJ1c3kiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiYmV6ZXQiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgImF3YXkgZm9yIGxvbmciOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiYWZ3ZXppZyBsYW5nZSB0aWpkIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJhd2F5IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgImFmd2V6aWciCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkkgYW0gJTEkcyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJJayBiZW4gJTEkcyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU2lnbiBpbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJBYW5tZWxkZW4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlhNUFAvSmFiYmVyIFVzZXJuYW1lOiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJYTVBQL0phYmJlciBVc2VybmFtZToiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlBhc3N3b3JkOiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJXYWNodHdvb3JkOiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTG9nIEluIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkFhbm1lbGRlbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQk9TSCBTZXJ2aWNlIFVSTDoiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJPbmxpbmUgQ29udGFjdHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiT25saW5lIENvbnRhY3RlbiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiJTEkcyBpcyB0eXBpbmciOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiJTEkcyBpcyBhYW4gdHlwZW4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNvbm5lY3RlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJWZXJib25kZW4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkF0dGFjaGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkJpamxhZ2UiCiAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkgewogICAgICAgIGRlZmluZSgibmwiLCBbJ2plZCddLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBmYWN0b3J5KG5ldyBKZWQodHJhbnNsYXRpb25zKSk7CiAgICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICAgIGlmICghd2luZG93LmxvY2FsZXMpIHsKICAgICAgICAgICAgd2luZG93LmxvY2FsZXMgPSB7fTsKICAgICAgICB9CiAgICAgICAgd2luZG93LmxvY2FsZXMubmwgPSBmYWN0b3J5KG5ldyBKZWQodHJhbnNsYXRpb25zKSk7CiAgICB9Cn0odGhpcywgZnVuY3Rpb24gKG5sKSB7IAogICAgcmV0dXJuIG5sOyAKfSkpOwoKKGZ1bmN0aW9uIChyb290LCBmYWN0b3J5KSB7CiAgICB2YXIgdHJhbnNsYXRpb25zID0gewogICAgICAgICJkb21haW4iOiAiY29udmVyc2UiLAogICAgICAgICJsb2NhbGVfZGF0YSI6IHsKICAgICAgICAgICAgImNvbnZlcnNlIjogewogICAgICAgICAgICAgICAgIiI6IHsKICAgICAgICAgICAgICAgICAgICAiUHJvamVjdC1JZC1WZXJzaW9uIjogIkNvbnZlcnNlLmpzIDAuNi4zIiwKICAgICAgICAgICAgICAgICAgICAiUmVwb3J0LU1zZ2lkLUJ1Z3MtVG8iOiAiIiwKICAgICAgICAgICAgICAgICAgICAiUE9ULUNyZWF0aW9uLURhdGUiOiAiMjAxMy0wOS0xNSAyMTo1NSswMjAwIiwKICAgICAgICAgICAgICAgICAgICAiUE8tUmV2aXNpb24tRGF0ZSI6ICIyMDE0LTA3LTA3IDExOjAyKzAyMDAiLAogICAgICAgICAgICAgICAgICAgICJMYXN0LVRyYW5zbGF0b3IiOiAiQWxhbiBNZWlyYSA8YWxhbkBlbmdhcnRlLmNvbT4iLAogICAgICAgICAgICAgICAgICAgICJMYW5ndWFnZS1UZWFtIjogIkJyYXppbGlhbiBQb3J0dWd1ZXNlIiwKICAgICAgICAgICAgICAgICAgICAiTGFuZ3VhZ2UiOiAicHRfQlIiLAogICAgICAgICAgICAgICAgICAgICJNSU1FLVZlcnNpb24iOiAiMS4wIiwKICAgICAgICAgICAgICAgICAgICAiQ29udGVudC1UeXBlIjogInRleHQvcGxhaW47IGNoYXJzZXQ9VVRGLTgiLAogICAgICAgICAgICAgICAgICAgICJDb250ZW50LVRyYW5zZmVyLUVuY29kaW5nIjogIjhiaXQiLAogICAgICAgICAgICAgICAgICAgICJQbHVyYWwtRm9ybXMiOiAibnBsdXJhbHM9MjsgcGx1cmFsPShuID4gMSk7IiwKICAgICAgICAgICAgICAgICAgICAiZG9tYWluIjogImNvbnZlcnNlIiwKICAgICAgICAgICAgICAgICAgICAibGFuZyI6ICJwdF9CUiIsCiAgICAgICAgICAgICAgICAgICAgInBsdXJhbF9mb3JtcyI6ICJucGx1cmFscz0yOyBwbHVyYWw9KG4gIT0gMSk7IgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJ1bmVuY3J5cHRlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJuw6NvLWNyaXB0b2dyYWZhZG8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgInVudmVyaWZpZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAibsOjby12ZXJpZmljYWRvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJ2ZXJpZmllZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJuw6NvLXZlcmlmaWNhZG8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgImZpbmlzaGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgImZpbmFsaXphZG8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkRpc2Nvbm5lY3RlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJEZXNjb25lY3RhZG8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkVycm9yIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkVycm8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNvbm5lY3RpbmciOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQ29uZWN0YW5kbyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ29ubmVjdGlvbiBGYWlsZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRmFsaGEgZGUgY29uZXjDo28iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkF1dGhlbnRpY2F0aW5nIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkF1dGVudGljYW5kbyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQXV0aGVudGljYXRpb24gRmFpbGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkZhbGhhIGRlIGF1dGVudGljYcOnw6NvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJEaXNjb25uZWN0aW5nIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkRlc2NvbmVjdGFuZG8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJlLWVzdGFibGlzaGluZyBlbmNyeXB0ZWQgc2Vzc2lvbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJSZWVzdGFiZWxlY2VuZG8gc2Vzc8OjbyBjcmlwdG9ncmFmYWRhIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIGJyb3dzZXIgbmVlZHMgdG8gZ2VuZXJhdGUgYSBwcml2YXRlIGtleSwgd2hpY2ggd2lsbCBiZSB1c2VkIGluIHlvdXIgZW5jcnlwdGVkIGNoYXQgc2Vzc2lvbi4gVGhpcyBjYW4gdGFrZSB1cCB0byAzMCBzZWNvbmRzIGR1cmluZyB3aGljaCB5b3VyIGJyb3dzZXIgbWlnaHQgZnJlZXplIGFuZCBiZWNvbWUgdW5yZXNwb25zaXZlLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTZXUgbmF2ZWdhZG9yIHByZWNpc2EgZ2VyYXIgdW1hIGNoYXZlLXByaXZhZGEsIHF1ZSBzZXLDoSB1c2FkYSBlbSBzdWEgc2Vzc8OjbyBjcmlwdG9ncmFmYWRhIGRlIGJhdGUtcGFwby4gSXNzbyBwb2RlIGxldmFyIGF0w6kgMzAgc2VndW5kb3MgZHVyYW50ZSBvcyBxdWFpcyBzZXUgbmF2ZWdhZG9yIHBvZGVyw6Egc2UgdHJhdmFyIG91IG7Do28gcmVzcG9uZGVyLiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUHJpdmF0ZSBrZXkgZ2VuZXJhdGVkLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDaGF2ZS1wcml2YWRhIGdlcmFkYToiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkF1dGhlbnRpY2F0aW9uIHJlcXVlc3QgZnJvbSAlMSRzXG5cbllvdXIgYnVkZHkgaXMgYXR0ZW1wdGluZyB0byB2ZXJpZnkgeW91ciBpZGVudGl0eSwgYnkgYXNraW5nIHlvdSB0aGUgcXVlc3Rpb24gYmVsb3cuXG5cbiUyJHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiUGVkaWRvIGRlIGF1dGVudGljYcOnw6NvIGRlICUkc1xuXG5TZXUgY29udGF0byBlc3TDoSB0ZW50YW5kbyB2ZXJpZmljYXIgc3VhIGlkZW50aWRhZGUsIHBlcmd1bnRhbmRvIGEgcXVlc3TDo28gYWJhaXhvLlxuXG4lMiRzIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb3VsZCBub3QgdmVyaWZ5IHRoaXMgdXNlcidzIGlkZW50aWZ5LiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJOw6NvIGZvaSBwb3Nzw612ZWwgdmVyaWZpY2FyIGEgaWRlbnRpZGFkZSBkZXN0ZSB1c3XDoXJpby4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlBlcnNvbmFsIG1lc3NhZ2UiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTWVuc2FnZW0gcGVzc29hbCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU3RhcnQgZW5jcnlwdGVkIGNvbnZlcnNhdGlvbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJJbmljaWFyIGNvbnZlcnNhIGNyaXB0b2dyYWZhZGEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJlZnJlc2ggZW5jcnlwdGVkIGNvbnZlcnNhdGlvbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJBdHVhbGl6YXIgY29udmVyc2EgY3JpcHRvZ3JhZmFkYSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiRW5kIGVuY3J5cHRlZCBjb252ZXJzYXRpb24iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRmluYWxpemFyIGNvbnZlcnNhIGNyaXB0b2dyYWZhZGEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlZlcmlmeSB3aXRoIFNNUCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJWZXJpZmljYXIgY29tIFNNUCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVmVyaWZ5IHdpdGggZmluZ2VycHJpbnRzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlZlcmlmaWNhciBjb20gYXNzaW5hdHVyYSBkaWdpdGFsIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJXaGF0J3MgdGhpcz8iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTyBxdWUgw6kgaXNzbz8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIm1lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgImV1IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTaG93IHRoaXMgbWVudSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJNb3N0cmFyIG8gbWVudSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiV3JpdGUgaW4gdGhlIHRoaXJkIHBlcnNvbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJFc2NyZXZlciBlbSB0ZXJjZWlyYSBwZXNzb2EiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJlbW92ZSBtZXNzYWdlcyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJSZW1vdmVyIG1lbnNhZ2VucyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBtZXNzYWdlIGNvdWxkIG5vdCBiZSBzZW50IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlN1YSBtZW5zYWdlbSBuw6NvIHDDtGRlIHNlciBlbnZpYWRhIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJXZSByZWNlaXZlZCBhbiB1bmVuY3J5cHRlZCBtZXNzYWdlIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlJlY2ViZW1vcyB1bWEgbWVuc2FnZW0gbsOjby1jcmlwdG9ncmFmYWRhIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJXZSByZWNlaXZlZCBhbiB1bnJlYWRhYmxlIGVuY3J5cHRlZCBtZXNzYWdlIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlJlY2ViZW1vcyB1bWEgbWVuc2FnZW0gbsOjby1jcmlwdG9ncmFmYWRhIGlsZWfDrXZlbCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyB1c2VyIGhhcyByZXF1ZXN0ZWQgYW4gZW5jcnlwdGVkIHNlc3Npb24uIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlVzdcOhcmlvIHBlZGl1IHVtYSBzZXNzw6NvIGNyaXB0b2dyYWZhZGEuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJIZXJlIGFyZSB0aGUgZmluZ2VycHJpbnRzLCBwbGVhc2UgY29uZmlybSB0aGVtIHdpdGggJTEkcywgb3V0c2lkZSBvZiB0aGlzIGNoYXQuXG5cbkZpbmdlcnByaW50IGZvciB5b3UsICUyJHM6ICUzJHNcblxuRmluZ2VycHJpbnQgZm9yICUxJHM6ICU0JHNcblxuSWYgeW91IGhhdmUgY29uZmlybWVkIHRoYXQgdGhlIGZpbmdlcnByaW50cyBtYXRjaCwgY2xpY2sgT0ssIG90aGVyd2lzZSBjbGljayBDYW5jZWwuIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkFxdWkgZXN0w6NvIGFzIGFzc2luYXR1cmFzIGRpZ2l0YWlzLCBwb3IgZmF2b3IgY29uZmlybWUgZWxhcyBjb20gJTEkcywgZm9yYSBkZXN0ZSBjaGF0LlxuXG5Bc3NpbmF0dXJhcyBwYXJhIHZvY8OqLCAlMiRzOiAlMyRzXG5cbkFzc2luYXR1cmFzIHBhcmEgJTEkczogJTQkc1xuXG5TZSB2b2PDqiB0aXZlciBjb25maXJtYWRvIHF1ZSBhcyBhc3NpbmF0dXJhcyBjb25mZXJlbSwgY2xpcXVlIE9LLCBjYXNvIGNvbnRyw6FyaW8sIGNsaXF1ZSBDYW5jZWwuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3Ugd2lsbCBiZSBwcm9tcHRlZCB0byBwcm92aWRlIGEgc2VjdXJpdHkgcXVlc3Rpb24gYW5kIHRoZW4gYW4gYW5zd2VyIHRvIHRoYXQgcXVlc3Rpb24uXG5cbllvdXIgYnVkZHkgd2lsbCB0aGVuIGJlIHByb21wdGVkIHRoZSBzYW1lIHF1ZXN0aW9uIGFuZCBpZiB0aGV5IHR5cGUgdGhlIGV4YWN0IHNhbWUgYW5zd2VyIChjYXNlIHNlbnNpdGl2ZSksIHRoZWlyIGlkZW50aXR5IHdpbGwgaGF2ZSBiZWVuIHZlcmlmaWVkLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTZXLDoSBzb2xpY2l0YWRvIHF1ZSB2b2PDqiBpbmZvcm1lIHVtYSBwZXJndW50YSBkZSBzZWd1cmFuw6dhIGUgdGFtYsOpbSB1bWEgcmVzcG9zdGEuXG5cbk7Ds3MgaXJlbW9zLCBlbnTDo28sIHRyYW5zZmVpciBhIHBlcmd1bnRhIHBhcmEgc2V1IGNvbnRhdG8gZSBjYXNvIGVsZSBlbnZpZSBjb3JyZXRhbWVudGUgYSBtZXNtYSByZXNwb3N0YSAoY2FzbyBzZW5zaXRpdm8pLCBhIGlkZW50aWRhZGUgZGVsZSBzZXLDoSB2ZXJpZmljYWRhLiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiV2hhdCBpcyB5b3VyIHNlY3VyaXR5IHF1ZXN0aW9uPyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJRdWFsIMOpIGEgc3VhIHBlcmd1bnRhIGRlIHNlZ3VyYW7Dp2E/IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJXaGF0IGlzIHRoZSBhbnN3ZXIgdG8gdGhlIHNlY3VyaXR5IHF1ZXN0aW9uPyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJRdWFsIMOpIGEgcmVzcG9zdGEgcGFyYSBhIHBlcmd1bnRhIGRlIHNlZ3VyYW7Dp2E/IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJJbnZhbGlkIGF1dGhlbnRpY2F0aW9uIHNjaGVtZSBwcm92aWRlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTY2hlbWEgZGUgYXV0ZW50aWNhw6fDo28gZm9ybmVjaWRvIMOpIGludsOhbGlkbyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBtZXNzYWdlcyBhcmUgbm90IGVuY3J5cHRlZCBhbnltb3JlIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlN1YXMgbWVuc2FnZW5zIG7Do28gZXN0w6NvIG1haXMgY3JpcHRvZ3JhZmFkYXMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgbWVzc2FnZXMgYXJlIG5vdyBlbmNyeXB0ZWQgYnV0IHlvdXIgYnVkZHkncyBpZGVudGl0eSBoYXMgbm90IGJlZW4gdmVyaWZpZWQuIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlN1YXMgbWVuc2FnZW5zIGVzdMOjbyBhZ29yYSBjcmlwdG9ncmFmYWRhcyBtYXMgYSBpZGVudGlkYWRlIGRvIGNvbnRhdG8gbsOjbyBmb2kgY29uZmlybWFkYS4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgYnVkZHkncyBpZGVudGlmeSBoYXMgYmVlbiB2ZXJpZmllZC4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQSBpZGVudGlkYWRlIGRvIGNvbnRhdG8gZm9pIHZlcmlmaWNhZGEuIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIGJ1ZGR5IGhhcyBlbmRlZCBlbmNyeXB0aW9uIG9uIHRoZWlyIGVuZCwgeW91IHNob3VsZCBkbyB0aGUgc2FtZS4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU2V1IGNvbnRhdG8gcGFyb3UgZGUgdXNhciBjcmlwdG9ncmFmaWEsIHZvY8OqIGRldmVyaWEgZmF6ZXIgbyBtZXNtby4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgbWVzc2FnZXMgYXJlIG5vdCBlbmNyeXB0ZWQuIENsaWNrIGhlcmUgdG8gZW5hYmxlIE9UUiBlbmNyeXB0aW9uLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTdWFzIG1lbnNhZ2VucyBuw6NvIGVzdMOjbyBjcmlwdG9ncmFmYWRhcy4gQ2xpcXVlIGFxdWkgcGFyYSBoYWJpbGl0YXIgY3JpcHRvZ3JhZmlhIE9UUi4iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgbWVzc2FnZXMgYXJlIGVuY3J5cHRlZCwgYnV0IHlvdXIgYnVkZHkgaGFzIG5vdCBiZWVuIHZlcmlmaWVkLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTdWFzIG1lbnNhZ2VucyBlc3TDo28gY3JpcHRvZ3JhZmFkYXMsIG1hcyBzZXUgY29udGF0byBuw6NvIGZvaSB2ZXJpZmljYWRvLiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBtZXNzYWdlcyBhcmUgZW5jcnlwdGVkIGFuZCB5b3VyIGJ1ZGR5IHZlcmlmaWVkLiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTdWFzIG1lbnNhZ2VucyBlc3TDo28gY3JpcHRvZ3JhZmFkYXMgZSBzZXUgY29udGF0byB2ZXJpZmljYWRvLiIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91ciBidWRkeSBoYXMgY2xvc2VkIHRoZWlyIGVuZCBvZiB0aGUgcHJpdmF0ZSBzZXNzaW9uLCB5b3Ugc2hvdWxkIGRvIHRoZSBzYW1lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlNldSBjb250YXRvIGZlY2hvdSBhIHNlc3PDo28gcHJpdmFkYSwgdm9jw6ogZGV2ZXJpYSBmYXplciBvIG1lc21vIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb250YWN0cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDb250YXRvcyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiT25saW5lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk9ubGluZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQnVzeSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJPY3VwYWRvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJBd2F5IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkF1c2VudGUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk9mZmxpbmUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiT2ZmbGluZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgdG8gYWRkIG5ldyBjaGF0IGNvbnRhY3RzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkNsaXF1ZSBwYXJhIGFkaWNpb25hciBub3ZvcyBjb250YXRvcyBhbyBjaGF0IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJBZGQgYSBjb250YWN0IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkFkaWNpb25hciBjb250YXRvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb250YWN0IHVzZXJuYW1lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlVzdcOhcmlvIGRvIGNvbnRhdHQiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkFkZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJBZGljaW9uYXIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNvbnRhY3QgbmFtZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJOb21lIGRvIGNvbnRhdG8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNlYXJjaCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJQcm9jdXJhciIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTm8gdXNlcnMgZm91bmQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTsOjbyBmb3JhbSBlbmNvbnRyYWRvcyB1c3XDoXJpb3MiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNsaWNrIHRvIGFkZCBhcyBhIGNoYXQgY29udGFjdCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDbGlxdWUgcGFyYSBhZGljaW9uYXIgY29tbyB1bSBjb250YXRvIGRvIGNoYXQiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNsaWNrIHRvIG9wZW4gdGhpcyByb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkNMaXF1ZSBwYXJhIGFicmlyIGEgc2FsYSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU2hvdyBtb3JlIGluZm9ybWF0aW9uIG9uIHRoaXMgcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJNb3N0cmFyIG1haXMgaW5mb3JtYcOnw7VlcyBuZXNzYSBzYWxhIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJEZXNjcmlwdGlvbjoiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRGVzY3Jpw6fDo286IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJPY2N1cGFudHM6IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk9jdXBhbnRlczoiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkZlYXR1cmVzOiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJSZWN1cnNvczoiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJlcXVpcmVzIGF1dGhlbnRpY2F0aW9uIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlJlcXVlciBhdXRlbnRpY2HDp8OjbyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiSGlkZGVuIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkVzY29uZGlkbyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUmVxdWlyZXMgYW4gaW52aXRhdGlvbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJSZXF1ZXIgdW0gY29udml0ZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTW9kZXJhdGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk1vZGVyYWRvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJOb24tYW5vbnltb3VzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk7Do28gYW7DtG5pbW8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk9wZW4gcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTYWxhIGFiZXJ0YSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUGVybWFuZW50IHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU2FsYSBwZXJtYW5lbnRlIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJQdWJsaWMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiUMO6YmxpY28iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNlbWktYW5vbnltb3VzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlNlbWkgYW7DtG5pbW8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRlbXBvcmFyeSByb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlNhbGEgdGVtcG9yw6FyaWEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlVubW9kZXJhdGVkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlNlbSBtb2RlcmHDp8OjbyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUm9vbXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU2FsYXMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJvb20gbmFtZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJOb21lIGRhIHNhbGEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk5pY2tuYW1lIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkFwZWxpZG8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlNlcnZlciI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTZXJ2ZXIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkpvaW4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRW50cmFyIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTaG93IHJvb21zIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk1vc3RhciBzYWxhcyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTm8gcm9vbXMgb24gJTEkcyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTZW0gc2FsYXMgZW0gJTEkcyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUm9vbXMgb24gJTEkcyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTYWxhcyBlbSAlMSRzIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTZXQgY2hhdHJvb20gdG9waWMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRGVmaW5pciB0w7NwaWNvIGRvIGNoYXQiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIktpY2sgdXNlciBmcm9tIGNoYXRyb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkV4cHVsc2FyIHVzdcOhcmlvIGRvIGNoYXQiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkJhbiB1c2VyIGZyb20gY2hhdHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQmFuaXIgdXN1w6FyaW8gZG8gY2hhdCIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTWVzc2FnZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJNZW5zYWdlbSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU2F2ZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTYWx2YXIiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNhbmNlbCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDYW5jZWxhciIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiQW4gZXJyb3Igb2NjdXJyZWQgd2hpbGUgdHJ5aW5nIHRvIHNhdmUgdGhlIGZvcm0uIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIk9jb3JyZXUgdW0gZXJybyBlbnF1YW50byB0ZW50YXZhIHNhbHZhciBvIGZvcm11bMOhcmlvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIGNoYXRyb29tIHJlcXVpcmVzIGEgcGFzc3dvcmQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRXNzZSBjaGF0IHByZWNpc2EgZGUgc2VuaGEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlBhc3N3b3JkOiAiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU2VuaGE6ICIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiU3VibWl0IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkVudmlhciIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyByb29tIGlzIG5vdCBhbm9ueW1vdXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRXNzYSBzYWxhIG7Do28gw6kgYW7DtG5pbWEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBub3cgc2hvd3MgdW5hdmFpbGFibGUgbWVtYmVycyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJBZ29yYSBlc3RhIHNhbGEgbW9zdHJhIG1lbWJyb3MgaW5kaXNwb27DrXZlaXMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBkb2VzIG5vdCBzaG93IHVuYXZhaWxhYmxlIG1lbWJlcnMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRXNzYSBzYWxhIG7Do28gbW9zdHJhIG1lbWJyb3MgaW5kaXNwb27DrXZlaXMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk5vbi1wcml2YWN5LXJlbGF0ZWQgcm9vbSBjb25maWd1cmF0aW9uIGhhcyBjaGFuZ2VkIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkNvbmZpZ3VyYcOnw7VzIG7Do28gcmVsYWNpb25hZGFzIMOgIHByaXZhY2lkYWRlIG11ZGFyYW0iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJvb20gbG9nZ2luZyBpcyBub3cgZW5hYmxlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJPIGxvZyBkYSBzYWxhIGVzdMOhIGF0aXZhZG8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlJvb20gbG9nZ2luZyBpcyBub3cgZGlzYWJsZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTyBsb2cgZGEgc2FsYSBlc3TDoSBkZXNhdGl2YWRvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gaXMgbm93IG5vbi1hbm9ueW1vdXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRXNzZSBzYWxhIMOpIG7Do28gYW7DtG5pbWEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBpcyBub3cgc2VtaS1hbm9ueW1vdXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRXNzYSBzYWxhIGFnb3JhIMOpIHNlbWkgYW7DtG5pbWEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBpcyBub3cgZnVsbHktYW5vbnltb3VzIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkVzc2Egc2FsYSBhZ29yYSDDqSB0b3RhbG1lbnRlIGFuw7RuaW1hIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJBIG5ldyByb29tIGhhcyBiZWVuIGNyZWF0ZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVW1hIG5vdmEgc2FsYSBmb2kgY3JpYWRhIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG5pY2tuYW1lIGhhcyBiZWVuIGNoYW5nZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU2V1IGFwZWxpZG8gZm9pIG11ZGFkbyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IGhhcyBiZWVuIGJhbm5lZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gZm9pIGJhbmlkbyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IGhhcyBiZWVuIGtpY2tlZCBvdXQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IGZvaSBleHB1bHNvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gaGFzIGJlZW4gcmVtb3ZlZCBiZWNhdXNlIG9mIGFuIGFmZmlsaWF0aW9uIGNoYW5nZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICI8c3J0b25nPiUxJHM8L3N0cm9uZz4gZm9pIHJlbW92aWRvIHBvciBjYXVzYSBkZSB0cm9jYSBkZSBhc3NvY2lhw6fDo28iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIjxzdHJvbmc+JTEkczwvc3Ryb25nPiBoYXMgYmVlbiByZW1vdmVkIGZvciBub3QgYmVpbmcgYSBtZW1iZXIiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IGZvaSByZW1vdmlkbyBwb3IgbsOjbyBzZXIgdW0gbWVtYnJvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3UgaGF2ZSBiZWVuIGJhbm5lZCBmcm9tIHRoaXMgcm9vbSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJWb2PDqiBmb2kgYmFuaWRvIGRlc3NhIHNhbGEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdSBoYXZlIGJlZW4ga2lja2VkIGZyb20gdGhpcyByb29tIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIlZvY8OqIGZvaSBleHB1bHNvIGRlc3NhIHNhbGEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdSBoYXZlIGJlZW4gcmVtb3ZlZCBmcm9tIHRoaXMgcm9vbSBiZWNhdXNlIG9mIGFuIGFmZmlsaWF0aW9uIGNoYW5nZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJWb2PDqiBmb2kgcmVtb3ZpZG8gZGEgc2FsYSBkZXZpZG8gYSB1bWEgbXVkYW7Dp2EgZGUgYXNzb2NpYcOnw6NvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3UgaGF2ZSBiZWVuIHJlbW92ZWQgZnJvbSB0aGlzIHJvb20gYmVjYXVzZSB0aGUgcm9vbSBoYXMgY2hhbmdlZCB0byBtZW1iZXJzLW9ubHkgYW5kIHlvdSdyZSBub3QgYSBtZW1iZXIiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVm9jw6ogZm9pIHJlbW92aWRvIGRhIHNhbGEgcG9ycXVlIGVsYSBmb2kgbXVkYWRhIHBhcmEgc29tZW50ZSBtZW1icm9zZSB2b2PDqiBuw6NvIMOpIHVtIG1lbWJybyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiWW91IGhhdmUgYmVlbiByZW1vdmVkIGZyb20gdGhpcyByb29tIGJlY2F1c2UgdGhlIE1VQyAoTXVsdGktdXNlciBjaGF0KSBzZXJ2aWNlIGlzIGJlaW5nIHNodXQgZG93bi4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVm9jw6ogZm9pIHJlbW92aWRvIGRhIHNhbGEgZGV2aWRvIGEgTVVDIChNdWx0aS11c2VyIGNoYXQpbyBzZXJ2acOnbyBlc3TDoSBzZW5kbyBkZXNsaWdhZG8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdSBhcmUgbm90IG9uIHRoZSBtZW1iZXIgbGlzdCBvZiB0aGlzIHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVm9jw6ogbsOjbyDDqSBtZW1icm8gZGVzc2Egc2FsYSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTm8gbmlja25hbWUgd2FzIHNwZWNpZmllZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJWb2PDqiBuw6NvIGVzY29saGV1IHVtIGFwZWxpZG8gIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3UgYXJlIG5vdCBhbGxvd2VkIHRvIGNyZWF0ZSBuZXcgcm9vbXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVm9jw6ogbsOjbyB0ZW0gcGVybWl0acOnw6NvIGRlIGNyaWFyIG5vdmFzIHNhbGFzIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJZb3VyIG5pY2tuYW1lIGRvZXNuJ3QgY29uZm9ybSB0byB0aGlzIHJvb20ncyBwb2xpY2llcyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTZXUgYXBlbGlkbyBuw6NvIGVzdMOhIGRlIGFjb3JkbyBjb20gYXMgcmVncmFzIGRhIHNhbGEiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIllvdXIgbmlja25hbWUgaXMgYWxyZWFkeSB0YWtlbiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJTZXUgYXBlbGlkbyBqw6EgZm9pIGVzY29saGlkbyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyByb29tIGRvZXMgbm90ICh5ZXQpIGV4aXN0IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkEgc2FsYSBuw6NvIGV4aXN0ZSAoYWluZGEpIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gaGFzIHJlYWNoZWQgaXQncyBtYXhpbXVtIG51bWJlciBvZiBvY2N1cGFudHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQSBzYWxhIGF0aW5naXUgbyBuw7ptZXJvIG3DoXhpbW8gZGUgb2N1cGFudGVzIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUb3BpYyBzZXQgYnkgJTEkcyB0bzogJTIkcyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJUb3BpY28gZGVmaW5pZG8gcG9yICUxJHMgcGFyYTogJTIkcyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyB1c2VyIGlzIGEgbW9kZXJhdG9yIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkVzc2UgdXN1w6FyaW8gw6kgbyBtb2RlcmFkb3IiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIlRoaXMgdXNlciBjYW4gc2VuZCBtZXNzYWdlcyBpbiB0aGlzIHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRXNzZSB1c3XDoXJpbyBwb2RlIGVudmlhciBtZW5zYWdlbnMgbmVzc2Egc2FsYSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyB1c2VyIGNhbiBOT1Qgc2VuZCBtZXNzYWdlcyBpbiB0aGlzIHJvb20iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRXNzZSB1c3XDoXJpbyBOw4NPIHBvZGUgZW52aWFyIG1lbnNhZ2VucyBuZXNzYSBzYWxhIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDbGljayB0byBjaGF0IHdpdGggdGhpcyBjb250YWN0IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkNsaXF1ZSBwYXJhIGNvbnZlcnNhciBjb20gbyBjb250YXRvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDbGljayB0byByZW1vdmUgdGhpcyBjb250YWN0IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkNsaXF1ZSBwYXJhIHJlbW92ZXIgbyBjb250YXRvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIGNvbnRhY3QgaXMgYnVzeSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJFc3RlIGNvbnRhdG8gZXN0w6Egb2N1cGFkbyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyBjb250YWN0IGlzIG9ubGluZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJFc3RlIGNvbnRhdG8gZXN0w6Egb25saW5lIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIGNvbnRhY3QgaXMgb2ZmbGluZSI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJFc3RlIGNvbnRhdG8gZXN0w6Egb2ZmbGluZSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyBjb250YWN0IGlzIHVuYXZhaWxhYmxlIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkVzdGUgY29udGF0byBlc3TDoSBpbmRpc3BvbsOtdmVsIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJUaGlzIGNvbnRhY3QgaXMgYXdheSBmb3IgYW4gZXh0ZW5kZWQgcGVyaW9kIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkVzdGUgY29udGF0byBlc3TDoSBhdXNlbnRlIHBvciB1bSBsb25nbyBwZXLDrW9kbyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiVGhpcyBjb250YWN0IGlzIGF3YXkiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRXN0ZSBjb250YXRvIGVzdMOhIGF1c2VudGUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNvbnRhY3QgcmVxdWVzdHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU29saWNpdGHDp8OjbyBkZSBjb250YXRvcyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiTXkgY29udGFjdHMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiTWV1cyBjb250YXRvcyIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiUGVuZGluZyBjb250YWN0cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDb250YWRvcyBwZW5kZW50ZXMiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkN1c3RvbSBzdGF0dXMiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU3RhdHVzIGN1c3RvbWl6YWRvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDbGljayB0byBjaGFuZ2UgeW91ciBjaGF0IHN0YXR1cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDbGlxdWUgcGFyYSBtdWRhciBzZXUgc3RhdHVzIG5vIGNoYXQiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkNsaWNrIGhlcmUgdG8gd3JpdGUgYSBjdXN0b20gc3RhdHVzIG1lc3NhZ2UiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQ2xpcXVlIGFxdWkgcGFyYSBjdXN0b21pemFyIGEgbWVuc2FnZW0gZGUgc3RhdHVzIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJvbmxpbmUiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAib25saW5lIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJidXN5IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIm9jdXBhZG8iCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgImF3YXkgZm9yIGxvbmciOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiYXVzZW50ZSBhIGJhc3RhbnRlIHRlbXBvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJhd2F5IjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgImF1c2VudGUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkkgYW0gJTEkcyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJFc3RvdSAlMSRzIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJTaWduIGluIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIkNvbmVjdGFyLXNlIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJYTVBQL0phYmJlciBVc2VybmFtZToiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiVXN1w6FyaW8gWE1QUC9KYWJiZXI6IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJQYXNzd29yZDoiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiU2VuaGE6IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJMb2cgSW4iOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiRW50cmFyIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJCT1NIIFNlcnZpY2UgVVJMOiI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJVUkwgZGUgc2VydmnDp28gQk9TSDoiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIk9ubGluZSBDb250YWN0cyI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJDb250YXRvcyBvbmxpbmUiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIiUxJHMgaXMgdHlwaW5nIjogWwogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgIiUxJHMgZXN0w6EgZGlnaXRhbmRvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJDb25uZWN0ZWQiOiBbCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAiQ29uZWN0YWRvIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJBdHRhY2hlZCI6IFsKICAgICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICAgICJBbmV4YWRvIgogICAgICAgICAgICAgICAgXQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIGlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHsKICAgICAgICBkZWZpbmUoInB0X0JSIiwgWydqZWQnXSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gZmFjdG9yeShuZXcgSmVkKHRyYW5zbGF0aW9ucykpOwogICAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgICBpZiAoIXdpbmRvdy5sb2NhbGVzKSB7CiAgICAgICAgICAgIHdpbmRvdy5sb2NhbGVzID0ge307CiAgICAgICAgfQogICAgICAgIHdpbmRvdy5sb2NhbGVzLnB0X0JSID0gZmFjdG9yeShuZXcgSmVkKHRyYW5zbGF0aW9ucykpOwogICAgfQogIH0odGhpcywgZnVuY3Rpb24gKGkxOG4pIHsKICAgICAgcmV0dXJuIGkxOG47CiAgfSkKKTsKCihmdW5jdGlvbiAocm9vdCwgZmFjdG9yeSkgewogICAgdmFyIHRyYW5zbGF0aW9ucyA9IHsKICAgICAgICAiZG9tYWluIjogImNvbnZlcnNlIiwKICAgICAgICAibG9jYWxlX2RhdGEiOgoKCnsKICAgImNvbnZlcnNlIjogewogICAgICAiIjogewogICAgICAgICAiUHJvamVjdC1JZC1WZXJzaW9uIjogIkNvbnZlcnNlLmpzIDAuNCIsCiAgICAgICAgICJSZXBvcnQtTXNnaWQtQnVncy1UbyI6ICIiLAogICAgICAgICAiUE9ULUNyZWF0aW9uLURhdGUiOiAiMjAxMy0wOS0xNSAyMjowNiswMjAwIiwKICAgICAgICAgIlBPLVJldmlzaW9uLURhdGUiOiAiMjAxMy0wOS0yOSAxNzoyNCswMzAwIiwKICAgICAgICAgIkxhc3QtVHJhbnNsYXRvciI6ICJCb3JpcyBLb2NoZXJvdiA8YmtAcmFza29uLm9yZz4iLAogICAgICAgICAiTGFuZ3VhZ2UtVGVhbSI6ICI8YmtAcmFza29uLnJ1PiIsCiAgICAgICAgICJMYW5ndWFnZSI6ICJydSIsCiAgICAgICAgICJNSU1FLVZlcnNpb24iOiAiMS4wIiwKICAgICAgICAgIkNvbnRlbnQtVHlwZSI6ICJ0ZXh0L3BsYWluOyBjaGFyc2V0PVVURi04IiwKICAgICAgICAgIkNvbnRlbnQtVHJhbnNmZXItRW5jb2RpbmciOiAiOGJpdCIsCiAgICAgICAgICJYLUdlbmVyYXRvciI6ICJQb2VkaXQgMS41LjUiCiAgICAgIH0sCiAgICAgICJ1bmVuY3J5cHRlZCI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItC90LUg0LfQsNGI0LjRhNGA0L7QstCw0L3QviIKICAgICAgXSwKICAgICAgInVudmVyaWZpZWQiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQvdC10L/RgNC+0LLQtdGA0LXQvdC+IgogICAgICBdLAogICAgICAidmVyaWZpZWQiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQv9GA0L7QstC10YDQtdC90L4iCiAgICAgIF0sCiAgICAgICJmaW5pc2hlZCI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItC30LDQutC+0L3Rh9C10L3QviIKICAgICAgXSwKICAgICAgIkRpc2Nvbm5lY3RlZCI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCe0YLQutC70Y7Rh9C10L3QviIKICAgICAgXSwKICAgICAgIkVycm9yIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0J7RiNC40LHQutCwIgogICAgICBdLAogICAgICAiQ29ubmVjdGluZyI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCh0L7QtdC00LjQvdC10L3QuNC1IgogICAgICBdLAogICAgICAiQ29ubmVjdGlvbiBGYWlsZWQiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQndC1INGD0LTQsNC70L7RgdGMINGB0L7QtdC00LjQvdC40YLRgdGPIgogICAgICBdLAogICAgICAiQXV0aGVudGljYXRpbmciOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQkNCy0YLQvtGA0LjQt9Cw0YbQuNGPIgogICAgICBdLAogICAgICAiQXV0aGVudGljYXRpb24gRmFpbGVkIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0J3QtSDRg9C00LDQu9C+0YHRjCDQsNCy0YLQvtGA0LjQt9C+0LLQsNGC0YzRgdGPIgogICAgICBdLAogICAgICAiRGlzY29ubmVjdGluZyI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCe0YLQutC70Y7Rh9Cw0LXQvNGB0Y8iCiAgICAgIF0sCiAgICAgICJQcml2YXRlIGtleSBnZW5lcmF0ZWQuIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0J/RgNC40LLQsNGC0L3Ri9C5INC60LvRjtGHINGB0LPQtdC90LXRgNC40YDQvtCy0LDQvS4iCiAgICAgIF0sCiAgICAgICJQZXJzb25hbCBtZXNzYWdlIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0JLQstC10LTQuNGC0LUg0YHQvtC+0LHRidC10L3QuNC1IgogICAgICBdLAogICAgICAiV2hhdCdzIHRoaXM/IjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0KfRgtC+INGN0YLQvj8iCiAgICAgIF0sCiAgICAgICJtZSI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCvIgogICAgICBdLAogICAgICAiU2hvdyB0aGlzIG1lbnUiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQn9C+0LrQsNC30LDRgtGMINGN0YLQviDQvNC10L3RjiIKICAgICAgXSwKICAgICAgIlJlbW92ZSBtZXNzYWdlcyI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCj0LTQsNC70LjRgtGMINGB0L7QvtCx0YnQtdC90LjRjyIKICAgICAgXSwKICAgICAgIllvdXIgbWVzc2FnZSBjb3VsZCBub3QgYmUgc2VudCI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCS0LDRiNC1INGB0L7QvtCx0YnQtdC90LjQtSDQvdC1INC/0L7RgdC70LDQvdC+IgogICAgICBdLAogICAgICAiWW91ciBtZXNzYWdlcyBhcmUgbm90IGVuY3J5cHRlZCBhbnltb3JlIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0JLQsNGI0Lgg0YHQvtC+0LHRidC10L3QuNGPINCx0L7Qu9GM0YjQtSDQvdC1INGI0LjRhNGA0YPRjtGC0YHRjyIKICAgICAgXSwKICAgICAgIllvdXIgbWVzc2FnZXMgYXJlIG5vdyBlbmNyeXB0ZWQgYnV0IHlvdXIgYnVkZHkncyBpZGVudGl0eSBoYXMgbm90IGJlZW4gdmVyaWZpZWQuIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0JLQsNGI0Lgg0YHQvtC+0LHRidC10L3QuNGPINGI0LjRhNGA0YPRjtGC0YHRjywg0L3QviDQstCw0YjQsCDRg9GH0ZHRgtC90LDRjyDQt9Cw0L/QuNGB0Ywg0L3QtSDQv9GA0L7QstC10YDQtdC90LAg0LLQsNGI0LjQvCDRgdC+0LHQtdGB0LXQtNC90LjQutC+0LwuIgogICAgICBdLAogICAgICAiWW91ciBidWRkeSdzIGlkZW50aWZ5IGhhcyBiZWVuIHZlcmlmaWVkLiI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCS0LDRiNCwINGD0YfRkdGC0L3QsNGPINC30LDQv9C40YHRjCDQv9GA0L7QstC10YDQtdC90LAg0LLQsNGI0LjQvCDRgdC+0LHQtdGB0LXQtNC90LjQutC+0LwuIgogICAgICBdLAogICAgICAiWW91ciBtZXNzYWdlcyBhcmUgbm90IGVuY3J5cHRlZC4gQ2xpY2sgaGVyZSB0byBlbmFibGUgT1RSIGVuY3J5cHRpb24uIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0JLQsNGI0Lgg0YHQvtC+0LHRidC10L3QuNGPINC90LUg0YjQuNGE0YDRg9GO0YLRgdGPLiDQndCw0LbQvNC40YLQtSDQt9C00LXRgdGMINGH0YLQvtCx0Ysg0L3QsNGB0YLRgNC+0LjRgtGMINGI0LjRhNGA0L7QstCw0L3QuNC1LiIKICAgICAgXSwKICAgICAgIllvdXIgbWVzc2FnZXMgYXJlIGVuY3J5cHRlZCwgYnV0IHlvdXIgYnVkZHkgaGFzIG5vdCBiZWVuIHZlcmlmaWVkLiI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCS0LDRiNC4INGB0L7QvtCx0YnQtdC90LjRjyDRiNC40YTRgNGD0Y7RgtGB0Y8sINC90L4g0LLQsNGIINC60L7QvdGC0LDQutGCINC90LUg0L/RgNC+0LLQtdGA0LXQvS4iCiAgICAgIF0sCiAgICAgICJZb3VyIG1lc3NhZ2VzIGFyZSBlbmNyeXB0ZWQgYW5kIHlvdXIgYnVkZHkgdmVyaWZpZWQuIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0JLQsNGI0Lgg0YHQvtC+0LHRidC10L3QuNGPINGI0LjRhNGA0YPRjtGC0YHRjyDQuCDQstCw0Ygg0LrQvtC90YLQsNC60YIg0L/RgNC+0LLQtdGA0LXQvSIKICAgICAgXSwKICAgICAgIkNvbnRhY3RzIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0JrQvtC90YLQsNC60YLRiyIKICAgICAgXSwKICAgICAgIk9ubGluZSI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCSINGB0LXRgtC4IgogICAgICBdLAogICAgICAiQnVzeSI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCX0LDQvdGP0YIiCiAgICAgIF0sCiAgICAgICJBd2F5IjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0J7RgtC+0YjRkdC7IgogICAgICBdLAogICAgICAiT2ZmbGluZSI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCd0LUg0LIg0YHQtdGC0LgiCiAgICAgIF0sCiAgICAgICJDbGljayB0byBhZGQgbmV3IGNoYXQgY29udGFjdHMiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQlNC+0LHQsNCy0LjRgtGMINC90L7QstGD0Y4g0LrQvtC90YTQtdGA0LXQvdGG0LjRjiIKICAgICAgXSwKICAgICAgIkFkZCBhIGNvbnRhY3QiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQlNC+0LHQsNCy0YLRjCDQutC+0L3RgtCw0LrRgiIKICAgICAgXSwKICAgICAgIkNvbnRhY3QgdXNlcm5hbWUiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQmNC80Y8g0L/QvtC70YzQt9C+0LLQsNGC0LXQu9GPIgogICAgICBdLAogICAgICAiQWRkIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0JTQvtCx0LDQstC40YLRjCIKICAgICAgXSwKICAgICAgIkNvbnRhY3QgbmFtZSI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCY0LzRjyDQutC+0L3RgtCw0LrRgtCwIgogICAgICBdLAogICAgICAiU2VhcmNoIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0J/QvtC40YHQuiIKICAgICAgXSwKICAgICAgIk5vIHVzZXJzIGZvdW5kIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0J/QvtC70YzQt9C+0LLQsNGC0LXQu9C4INC90LUg0L3QsNC50LTQtdC90YsiCiAgICAgIF0sCiAgICAgICJDbGljayB0byBhZGQgYXMgYSBjaGF0IGNvbnRhY3QiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQlNC+0LHQsNCy0LjRgtGMINC60L7QvdGC0LDQutGCIgogICAgICBdLAogICAgICAiQ2xpY2sgdG8gb3BlbiB0aGlzIHJvb20iOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQl9Cw0LnRgtC4INCyINC60L7QvdGE0LXRgNC10L3RhtC40Y4iCiAgICAgIF0sCiAgICAgICJTaG93IG1vcmUgaW5mb3JtYXRpb24gb24gdGhpcyByb29tIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0J/QvtC60LDQt9Cw0YLRjCDQsdC+0LvRjNGI0LUg0LjQvdGE0L7RgNC80LDRhtC40Lgg0L7QsSDRjdGC0L7QuSDQutC+0L3RhNC10YDQtdC90YbQuNC4IgogICAgICBdLAogICAgICAiRGVzY3JpcHRpb246IjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0J7Qv9C40YHQsNC90LjQtToiCiAgICAgIF0sCiAgICAgICJPY2N1cGFudHM6IjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0KPRh9Cw0YHRgtC90LjQutC4OiIKICAgICAgXSwKICAgICAgIkZlYXR1cmVzOiI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCh0LLQvtC50YHRgtCy0LA6IgogICAgICBdLAogICAgICAiUmVxdWlyZXMgYXV0aGVudGljYXRpb24iOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQotGA0LXQsdGD0LXRgtGB0Y8g0LDQstGC0L7RgNC40LfQsNGG0LjRjyIKICAgICAgXSwKICAgICAgIkhpZGRlbiI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCh0LrRgNGL0YLQviIKICAgICAgXSwKICAgICAgIlJlcXVpcmVzIGFuIGludml0YXRpb24iOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQotGA0LXQsdGD0LXRgtGB0Y8g0L/RgNC40LPQu9Cw0YjQtdC90LjQtSIKICAgICAgXSwKICAgICAgIk1vZGVyYXRlZCI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCc0L7QtNC10YDQuNGA0YPQtdC80LDRjyIKICAgICAgXSwKICAgICAgIk5vbi1hbm9ueW1vdXMiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQndC1INCw0L3QvtC90LjQvNC90LDRjyIKICAgICAgXSwKICAgICAgIk9wZW4gcm9vbSI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCe0YLQutGA0YvRgtGMINC60L7QvdGE0LXRgNC10L3RhtC40Y4iCiAgICAgIF0sCiAgICAgICJQZXJtYW5lbnQgcm9vbSI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCf0LXRgNC80LDQvdC10L3RgtC90LDRjyDQutC+0L3RhNC10YDQtdC90YbQuNGPIgogICAgICBdLAogICAgICAiUHVibGljIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0J/Rg9Cx0LvQuNGH0L3Ri9C5IgogICAgICBdLAogICAgICAiU2VtaS1hbm9ueW1vdXMiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQp9Cw0YHRgtC40YfQvdC+INCw0L3QvtC90LjQvNC90LDRjyIKICAgICAgXSwKICAgICAgIlRlbXBvcmFyeSByb29tIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0JLRgNC10LzQtdC90L3QsNGPINC60L7QvdGE0LXRgNC10L3RhtC40Y8iCiAgICAgIF0sCiAgICAgICJVbm1vZGVyYXRlZCI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCd0LXQvNC+0LTQtdGA0LjRgNGD0LXQvNCw0Y8iCiAgICAgIF0sCiAgICAgICJSb29tcyI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCa0L7QvdGE0LXRgC4iCiAgICAgIF0sCiAgICAgICJSb29tIG5hbWUiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQmNC80Y8g0LrQvtC90YTQtdGA0LXQvdGG0LjQuCIKICAgICAgXSwKICAgICAgIk5pY2tuYW1lIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0J/RgdC10LLQtNC+0L3QuNC8IgogICAgICBdLAogICAgICAiU2VydmVyIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0KHQtdGA0LLQtdGAIgogICAgICBdLAogICAgICAiSm9pbiI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCf0L7QtNC60LvRjtGH0LjRgtGM0YHRjyIKICAgICAgXSwKICAgICAgIlNob3cgcm9vbXMiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQntCx0L3QvtCy0LjRgtGMIgogICAgICBdLAogICAgICAiTm8gcm9vbXMgb24gJTEkcyI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCd0LXRgiDQtNC+0YHRgtGD0L/QvdGL0YUg0LrQvtC90YTQtdGA0LXQvdGG0LjQuSAlMSRzIgogICAgICBdLAogICAgICAiUm9vbXMgb24gJTEkcyI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCa0L7QvdGE0LXRgNC10L3RhtC40LggJTEkczoiCiAgICAgIF0sCiAgICAgICJTZXQgY2hhdHJvb20gdG9waWMiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQo9GB0YLQsNC90L7QstC40YLRjCDRgtC10LzRgyIKICAgICAgXSwKICAgICAgIktpY2sgdXNlciBmcm9tIGNoYXRyb29tIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0J7RgtC60LvRjtGH0LjRgtGMINC/0L7Qu9GM0LfQvtCy0LDRgtC10LvRjyDQvtGCINC60L3QvtGE0LXRgC4iCiAgICAgIF0sCiAgICAgICJCYW4gdXNlciBmcm9tIGNoYXRyb29tIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0JfQsNCx0LDQvdC40YLRjCDQv9C+0LvRjNC30L7QstCw0YLQtdC70Y8g0LIg0Y3RgtC+0Lkg0LrQvtC90YQuIgogICAgICBdLAogICAgICAiTWVzc2FnZSI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCh0L7QvtCx0YnQtdC90LjQtSIKICAgICAgXSwKICAgICAgIlNhdmUiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQodC+0YXRgNCw0L3QuNGC0YwiCiAgICAgIF0sCiAgICAgICJDYW5jZWwiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQntGC0LzQtdC90LjRgtGMIgogICAgICBdLAogICAgICAiQW4gZXJyb3Igb2NjdXJyZWQgd2hpbGUgdHJ5aW5nIHRvIHNhdmUgdGhlIGZvcm0uIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0J/RgNC4INGB0L7RhdGA0LDQvdC10L3QuNC1INGE0L7RgNC80Ysg0L/RgNC+0LjQt9C+0YjQu9CwINC+0YjQuNCx0LrQsC4iCiAgICAgIF0sCiAgICAgICJUaGlzIGNoYXRyb29tIHJlcXVpcmVzIGEgcGFzc3dvcmQiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQlNC70Y8g0LTQvtGB0YLRg9C/0LAg0LIg0LrQvtC90YTQtdGALiDQvdC10L7QsdGF0L7QtNC40Lwg0L/QsNGA0L7Qu9GMLiIKICAgICAgXSwKICAgICAgIlBhc3N3b3JkOiAiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQn9Cw0YDQvtC70Yw6ICIKICAgICAgXSwKICAgICAgIlN1Ym1pdCI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCe0YLQv9GA0LDQstC40YLRjCIKICAgICAgXSwKICAgICAgIlRoaXMgcm9vbSBpcyBub3QgYW5vbnltb3VzIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0K3RgtCwINC60L7QvNC90LDRgtCwINC90LUg0LDQvdC+0L3QuNC80L3QsNGPIgogICAgICBdLAogICAgICAiVGhpcyByb29tIG5vdyBzaG93cyB1bmF2YWlsYWJsZSBtZW1iZXJzIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0K3RgtCwINC60L7QvNC90LDRgtCwINC/0L7QutCw0LfRi9Cy0LDQtdGCINC00L7RgdGC0YPQv9C90YvRhSDRgdC+0LHQtdGB0LXQtNC90LjQutC+0LIiCiAgICAgIF0sCiAgICAgICJUaGlzIHJvb20gZG9lcyBub3Qgc2hvdyB1bmF2YWlsYWJsZSBtZW1iZXJzIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0K3RgtCwINC60L7QvNC90LDRgtCwINC90LUg0L/QvtC60LDQt9GL0LLQsNC10YIg0L3QtdC00L7RgdGC0YPQv9C90YvRhSDRgdC+0LHQtdGB0LXQtNC90LjQutC+0LIiCiAgICAgIF0sCiAgICAgICJUaGlzIHJvb20gaXMgbm93IG5vbi1hbm9ueW1vdXMiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQrdGC0LAg0LrQvtC80L3QsNGC0LAg0L3QtSDQsNC90L7QvdC40LzQvdCw0Y8iCiAgICAgIF0sCiAgICAgICJUaGlzIHJvb20gaXMgbm93IHNlbWktYW5vbnltb3VzIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0K3RgtCwINC60L7QvNC90LDRgtCwINGH0LDRgdGC0LjRh9C90L4g0LDQvdC+0L3QuNC80L3QsNGPIgogICAgICBdLAogICAgICAiVGhpcyByb29tIGlzIG5vdyBmdWxseS1hbm9ueW1vdXMiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQrdGC0LAg0LrQvtC80L3QsNGC0LAg0YHRgtCw0LvQsCDQv9C+0LvQvdC+0YHRgtGM0Y4g0LDQvdC+0L3QuNC80L3QvtC5IgogICAgICBdLAogICAgICAiQSBuZXcgcm9vbSBoYXMgYmVlbiBjcmVhdGVkIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0J3QvtCy0LDRjyDQutC+0LzQvdCw0YLQsCDQsdGL0LvQsCDRgdC+0LfQtNCw0L3QsCIKICAgICAgXSwKICAgICAgIllvdXIgbmlja25hbWUgaGFzIGJlZW4gY2hhbmdlZCI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCS0LDRiCDQv9GB0LXQstC00L7QvdC40Lwg0YPQttC1INC40YHQv9C+0LvRjNC30YPQtdGC0YHRjyDQtNGA0YPQs9C40Lwg0L/QvtC70YzQt9C+0LLQsNGC0LXQu9C10LwiCiAgICAgIF0sCiAgICAgICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gaGFzIGJlZW4gYmFubmVkIjogWwogICAgICAgICBudWxsLAogICAgICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+INC30LDQsdCw0L3QtdC9IgogICAgICBdLAogICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IGhhcyBiZWVuIGtpY2tlZCBvdXQiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4g0LLRi9C00LLQvtGA0LXQvSIKICAgICAgXSwKICAgICAgIjxzdHJvbmc+JTEkczwvc3Ryb25nPiBoYXMgYmVlbiByZW1vdmVkIGJlY2F1c2Ugb2YgYW4gYWZmaWxpYXRpb24gY2hhbmdlIjogWwogICAgICAgICBudWxsLAogICAgICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IGhhcyBiZWVuIHJlbW92ZWQgYmVjYXVzZSBvZiBhbiBhZmZpbGlhdGlvbiBjaGFuZ2UiCiAgICAgIF0sCiAgICAgICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gaGFzIGJlZW4gcmVtb3ZlZCBmb3Igbm90IGJlaW5nIGEgbWVtYmVyIjogWwogICAgICAgICBudWxsLAogICAgICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+INGD0LTQsNC70ZHQvSDQv9C+0YLQvtC80YMg0YfRgtC+INC90LUg0YPRh9Cw0YHRgtC90LjQuiIKICAgICAgXSwKICAgICAgIllvdSBoYXZlIGJlZW4gYmFubmVkIGZyb20gdGhpcyByb29tIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0JLQsNC8INC30LDQv9GA0LXRidC10L3QviDQv9C+0LTQutC70Y7Rh9Cw0YLRgdGPINC6INGN0YLQvtC5INC60L7QvdGE0LXRgNC10L3RhtC40LgiCiAgICAgIF0sCiAgICAgICJZb3UgaGF2ZSBiZWVuIGtpY2tlZCBmcm9tIHRoaXMgcm9vbSI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCS0LDQvCDQt9Cw0L/RgNC10YnQtdC90L4g0L/QvtC00LrQu9GO0YfQsNGC0YHRjyDQuiDRjdGC0L7QuSDQutC+0L3RhNC10YDQtdC90YbQuNC4IgogICAgICBdLAogICAgICAiWW91IGhhdmUgYmVlbiByZW1vdmVkIGZyb20gdGhpcyByb29tIGJlY2F1c2Ugb2YgYW4gYWZmaWxpYXRpb24gY2hhbmdlIjogWwogICAgICAgICBudWxsLAogICAgICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+INGD0LTQsNC70ZHQvSDQv9C+0YLQvtC80YMg0YfRgtC+INC40LfQvNC10L3QuNC70LjRgdGMINC/0YDQsNCy0LAiCiAgICAgIF0sCiAgICAgICJZb3UgaGF2ZSBiZWVuIHJlbW92ZWQgZnJvbSB0aGlzIHJvb20gYmVjYXVzZSB0aGUgcm9vbSBoYXMgY2hhbmdlZCB0byBtZW1iZXJzLW9ubHkgYW5kIHlvdSdyZSBub3QgYSBtZW1iZXIiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQktGLINC+0YLQutC70Y7Rh9C10L3RiyDQvtGCINGN0YLQvtC5INC60L7QvdGE0LXRgNC10L3RhtC40Lgg0L/QvtGC0L7QvNGDINGH0YLQviDRgNC10LbQuNC8INC40LfQvNC10L3QuNC70YHRjzog0YLQvtC70YzQutC+LdGD0YfQsNGB0YLQvdC40LrQuCIKICAgICAgXSwKICAgICAgIllvdSBoYXZlIGJlZW4gcmVtb3ZlZCBmcm9tIHRoaXMgcm9vbSBiZWNhdXNlIHRoZSBNVUMgKE11bHRpLXVzZXIgY2hhdCkgc2VydmljZSBpcyBiZWluZyBzaHV0IGRvd24uIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0JLRiyDQvtGC0LrQu9GO0YfQtdC90Ysg0L7RgiDRjdGC0L7QuSDQutC+0L3RhNC10YDQtdC90YbQuNC4INC/0L7RgtC+0LzRgyDRh9GC0L4g0YHQtdGA0LLQuNGB0Ywg0LrQvtC90YTQtdGA0LXQvdGG0LjQuSDQstGL0LrQu9GO0YfQtdC9LiIKICAgICAgXSwKICAgICAgIllvdSBhcmUgbm90IG9uIHRoZSBtZW1iZXIgbGlzdCBvZiB0aGlzIHJvb20iOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQktCw0YEg0L3QtdGCINCyINGB0L/QuNGB0LrQtSDRjdGC0L7QuSDQutC+0L3RhNC10YDQtdC90YbQuNC4IgogICAgICBdLAogICAgICAiTm8gbmlja25hbWUgd2FzIHNwZWNpZmllZCI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCS0Ysg0L3QtSDRg9C60LDQt9Cw0LvQuCDQv9GB0LXQstC00L7QvdC40LwiCiAgICAgIF0sCiAgICAgICJZb3UgYXJlIG5vdCBhbGxvd2VkIHRvIGNyZWF0ZSBuZXcgcm9vbXMiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQktGLINC90LUg0LjQvNC10LXRgtC1INC/0YDQsNCy0LAg0YHQvtC30LTQsNCy0LDRgtGMINC60L7QvdGE0LXRgC4iCiAgICAgIF0sCiAgICAgICJZb3VyIG5pY2tuYW1lIGRvZXNuJ3QgY29uZm9ybSB0byB0aGlzIHJvb20ncyBwb2xpY2llcyI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCf0YHQtdCy0LTQvtC90LjQvCDQvdC1INGB0L7Qs9C70LDRgdGD0LXRgtGB0Y8g0YEg0L/RgNCw0LLQuNC70LDQvNC4INC60L7QvdGE0LXRgC4iCiAgICAgIF0sCiAgICAgICJZb3VyIG5pY2tuYW1lIGlzIGFscmVhZHkgdGFrZW4iOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQktCw0Ygg0L3QuNC6INGD0LbQtSDQuNGB0L/QvtC70YzQt9GD0LXRgtGB0Y8g0LTRgNGD0LPQuNC8INC/0L7Qu9GM0LfQvtCy0LDRgtC10LvQtdC8IgogICAgICBdLAogICAgICAiVGhpcyByb29tIGRvZXMgbm90ICh5ZXQpIGV4aXN0IjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0K3RgtCwINC60L7QvNC90LDRgtCwINC90LUg0YHRg9GJ0LXRgdGC0LLRg9C10YIiCiAgICAgIF0sCiAgICAgICJUaGlzIHJvb20gaGFzIHJlYWNoZWQgaXQncyBtYXhpbXVtIG51bWJlciBvZiBvY2N1cGFudHMiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQmtC+0L3RhNC10YDQtdC90YbQuNGPINC00L7RgdGC0LjQs9C70LAg0LzQsNC60YHQuNC80LDQu9GM0L3QvtCz0L4g0LrQvtC70LjRh9C10YHRgtCy0LAg0YPRh9Cw0YHRgtC90LjQutC+0LIiCiAgICAgIF0sCiAgICAgICJUb3BpYyBzZXQgYnkgJTEkcyB0bzogJTIkcyI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCi0LXQvNCwICUyJHMg0YPRgdGC0LDRgtC90L7QstC70LXQvdCwICUxJHMiCiAgICAgIF0sCiAgICAgICJUaGlzIHVzZXIgaXMgYSBtb2RlcmF0b3IiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQnNC+0LTQtdGA0LDRgtC+0YAiCiAgICAgIF0sCiAgICAgICJUaGlzIHVzZXIgY2FuIHNlbmQgbWVzc2FnZXMgaW4gdGhpcyByb29tIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0KHQvtCx0LXRgdC10LTQvdC40LoiCiAgICAgIF0sCiAgICAgICJUaGlzIHVzZXIgY2FuIE5PVCBzZW5kIG1lc3NhZ2VzIGluIHRoaXMgcm9vbSI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCf0L7Qu9GM0LfQvtCy0LDRgtC10LvRjCDQvdC1INC80L7QttC10YIg0L/QvtGB0YvQu9Cw0YLRjCDRgdC+0L7QsdGJ0LXQvdC40Y8g0LIg0Y3RgtGDINC60L7QvNC90LDRgtGDIgogICAgICBdLAogICAgICAiQ2xpY2sgdG8gY2hhdCB3aXRoIHRoaXMgY29udGFjdCI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCd0LDRh9Cw0YLRjCDQvtCx0YnQtdC90LjQtSIKICAgICAgXSwKICAgICAgIkNsaWNrIHRvIHJlbW92ZSB0aGlzIGNvbnRhY3QiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQo9C00LDQu9C40YLRjCDQutC+0L3RgtCw0LrRgiIKICAgICAgXSwKICAgICAgIlRoaXMgY29udGFjdCBpcyBidXN5IjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0JfQsNC90Y/RgiIKICAgICAgXSwKICAgICAgIlRoaXMgY29udGFjdCBpcyBvbmxpbmUiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQkiDRgdC10YLQuCIKICAgICAgXSwKICAgICAgIlRoaXMgY29udGFjdCBpcyBvZmZsaW5lIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0J3QtSDQsiDRgdC10YLQuCIKICAgICAgXSwKICAgICAgIlRoaXMgY29udGFjdCBpcyB1bmF2YWlsYWJsZSI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCd0LUg0LTQvtGB0YLRg9C/0LXQvSIKICAgICAgXSwKICAgICAgIlRoaXMgY29udGFjdCBpcyBhd2F5IGZvciBhbiBleHRlbmRlZCBwZXJpb2QiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQndCwINC00L7Qu9Cz0L4g0L7RgtC+0YjRkdC7IgogICAgICBdLAogICAgICAiVGhpcyBjb250YWN0IGlzIGF3YXkiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQntGC0L7RiNGR0LsiCiAgICAgIF0sCiAgICAgICJDb250YWN0IHJlcXVlc3RzIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0JfQsNC/0YDQvtGB0Ysg0L3QsCDQsNCy0YLQvtGA0LjQt9Cw0YbQuNGOIgogICAgICBdLAogICAgICAiTXkgY29udGFjdHMiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQmtC+0L3RgtCw0LrRgtGLIgogICAgICBdLAogICAgICAiUGVuZGluZyBjb250YWN0cyI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCh0L7QsdC10YHQtdC00L3QuNC60Lgg0L7QttC40LTQsNGO0YnQuNC1INCw0LLRgtC+0YDQuNC30LDRhtC40LgiCiAgICAgIF0sCiAgICAgICJDdXN0b20gc3RhdHVzIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0J/RgNC+0LjQt9Cy0L7Qu9GM0L3Ri9C5INGB0YLQsNGC0YPRgSIKICAgICAgXSwKICAgICAgIkNsaWNrIHRvIGNoYW5nZSB5b3VyIGNoYXQgc3RhdHVzIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0JjQt9C80LXQvdC40YLRjCDQstCw0Ygg0YHRgtCw0YLRg9GBIgogICAgICBdLAogICAgICAiQ2xpY2sgaGVyZSB0byB3cml0ZSBhIGN1c3RvbSBzdGF0dXMgbWVzc2FnZSI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCg0LXQtNCw0LrRgtC40YDQvtCy0LDRgtGMINC/0YDQvtC40LfQstC+0LvRjNC90YvQuSDRgdGC0LDRgtGD0YEiCiAgICAgIF0sCiAgICAgICJvbmxpbmUiOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQvdCwINGB0LLRj9C30LgiCiAgICAgIF0sCiAgICAgICJidXN5IjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0LfQsNC90Y/RgiIKICAgICAgXSwKICAgICAgImF3YXkgZm9yIGxvbmciOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQvtGC0L7RiNGR0Lsg0L3QsCDQtNC+0LvQs9C+IgogICAgICBdLAogICAgICAiYXdheSI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItC+0YLQvtGI0ZHQuyIKICAgICAgXSwKICAgICAgIkkgYW0gJTEkcyI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgIiUxJHMiCiAgICAgIF0sCiAgICAgICJTaWduIGluIjogWwogICAgICAgICBudWxsLAogICAgICAgICAi0J/QvtC00L/QuNGB0LDRgtGMIgogICAgICBdLAogICAgICAiWE1QUC9KYWJiZXIgVXNlcm5hbWU6IjogWwogICAgICAgICBudWxsLAogICAgICAgICAiSklEOiIKICAgICAgXSwKICAgICAgIlBhc3N3b3JkOiI6IFsKICAgICAgICAgbnVsbCwKICAgICAgICAgItCf0LDRgNC+0LvRjDoiCiAgICAgIF0sCiAgICAgICJMb2cgSW4iOiBbCiAgICAgICAgIG51bGwsCiAgICAgICAgICLQktC+0LnRgtC4IgogICAgICBdLAogICAgICAiT25saW5lIENvbnRhY3RzIjogWwogICAgICAgICBudWxsLAogICAgICAgICAiQ9C/0LjRgdC+0Log0YHQvtCx0LXRgdC10LTQvdC40LrQvtCyIgogICAgICBdCiAgIH0KfQoKCgogICAgfTsKICAgIGlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHsKICAgICAgICBkZWZpbmUoInJ1IiwgWydqZWQnXSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gZmFjdG9yeShuZXcgSmVkKHRyYW5zbGF0aW9ucykpOwogICAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgICBpZiAoIXdpbmRvdy5sb2NhbGVzKSB7CiAgICAgICAgICAgIHdpbmRvdy5sb2NhbGVzID0ge307CiAgICAgICAgfQogICAgICAgIHdpbmRvdy5sb2NhbGVzLnJ1ID0gZmFjdG9yeShuZXcgSmVkKHRyYW5zbGF0aW9ucykpOwogICAgfQp9KHRoaXMsIGZ1bmN0aW9uIChydSkgewogICAgcmV0dXJuIHJ1Owp9KSk7CgooZnVuY3Rpb24gKHJvb3QsIGZhY3RvcnkpIHsKICAgIHZhciB0cmFuc2xhdGlvbnMgPSB7CiAgICAgICAgImRvbWFpbiI6ICJjb252ZXJzZSIsCiAgICAgICAgImxvY2FsZV9kYXRhIjogewogICAgICAgICAgICAiY29udmVyc2UiOiB7CiAgICAgICAgICAgICAgICAiIjogewogICAgICAgICAgICAgICAgICAgICJQcm9qZWN0LUlkLVZlcnNpb24iOiAiQ29udmVyc2UuanMgMC44IiwKICAgICAgICAgICAgICAgICAgICAiUmVwb3J0LU1zZ2lkLUJ1Z3MtVG8iOiAiIiwKICAgICAgICAgICAgICAgICAgICAiUE9ULUNyZWF0aW9uLURhdGUiOiAiMjAxNC0wMS0wNyAxMToxMiswOTAwIiwKICAgICAgICAgICAgICAgICAgICAiUE8tUmV2aXNpb24tRGF0ZSI6ICIyMDE0LTAxLTA3IDExOjMyKzA5MDAiLAogICAgICAgICAgICAgICAgICAgICJMYXN0LVRyYW5zbGF0b3IiOiAiSHV4aXN1eiBIdSA8aHV4aXN1ekBnbWFpbC5jb20+IiwKICAgICAgICAgICAgICAgICAgICAiTGFuZ3VhZ2UtVGVhbSI6ICJMYW5ndWFnZSB6aCIsCiAgICAgICAgICAgICAgICAgICAgIkxhbmd1YWdlIjogInpoIiwKICAgICAgICAgICAgICAgICAgICAiTUlNRS1WZXJzaW9uIjogIjEuMCIsCiAgICAgICAgICAgICAgICAgICAgIkNvbnRlbnQtVHlwZSI6ICJ0ZXh0L3BsYWluOyBjaGFyc2V0PVVURi04IiwKICAgICAgICAgICAgICAgICAgICAiQ29udGVudC1UcmFuc2Zlci1FbmNvZGluZyI6ICI4Yml0IiwKICAgICAgICAgICAgICAgICAgICAiUGx1cmFsLUZvcm1zIjogIm5wbHVyYWxzPTE7IHBsdXJhbD0wOyIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAidW5lbmNyeXB0ZWQiOiBbbnVsbCwi5pyq5Yqg5a+GIl0sCiAgICAgICAgICAgICAgICAidW52ZXJpZmllZCI6IFtudWxsLCLmnKrpqozor4EiXSwKICAgICAgICAgICAgICAgICJ2ZXJpZmllZCI6IFtudWxsLCLlt7Lpqozor4EiXSwKICAgICAgICAgICAgICAgICJmaW5pc2hlZCI6IFtudWxsLCLnu5PmnZ/kuoYiXSwKICAgICAgICAgICAgICAgICJUaGlzIGNvbnRhY3QgaXMgYnVzeSI6IFtudWxsLCLlr7nmlrnlv5nnoozkuK0iXSwKICAgICAgICAgICAgICAgICJUaGlzIGNvbnRhY3QgaXMgb25saW5lIjogW251bGwsIuWvueaWueWcqOe6v+S4rSJdLAogICAgICAgICAgICAgICAgIlRoaXMgY29udGFjdCBpcyBvZmZsaW5lIjogW251bGwsIuWvueaWueW3suS4i+e6vyJdLAogICAgICAgICAgICAgICAgIlRoaXMgY29udGFjdCBpcyB1bmF2YWlsYWJsZSI6IFtudWxsLCLlr7nmlrnlhY3miZPmibAiXSwKICAgICAgICAgICAgICAgICJUaGlzIGNvbnRhY3QgaXMgYXdheSBmb3IgYW4gZXh0ZW5kZWQgcGVyaW9kIjogW251bGwsIuWvueaWueaaguaXtuemu+W8gCJdLAogICAgICAgICAgICAgICAgIlRoaXMgY29udGFjdCBpcyBhd2F5IjogW251bGwsIuWvueaWueemu+W8gCJdLAogICAgICAgICAgICAgICAgIkRpc2Nvbm5lY3RlZCI6IFtudWxsLCLov57mjqXlt7Lmlq3lvIAiXSwKICAgICAgICAgICAgICAgICJFcnJvciI6IFtudWxsLCLplJnor68iXSwKICAgICAgICAgICAgICAgICJDb25uZWN0aW5nIjogW251bGwsIui/nuaOpeS4rSJdLAogICAgICAgICAgICAgICAgIkNvbm5lY3Rpb24gRmFpbGVkIjogW251bGwsIui/nuaOpeWksei0pSJdLAogICAgICAgICAgICAgICAgIkF1dGhlbnRpY2F0aW5nIjogW251bGwsIumqjOivgeS4rSJdLAogICAgICAgICAgICAgICAgIkF1dGhlbnRpY2F0aW9uIEZhaWxlZCI6IFtudWxsLCLpqozor4HlpLHotKUiXSwKICAgICAgICAgICAgICAgICJEaXNjb25uZWN0aW5nIjogW251bGwsIuaWreW8gOmTvuaOpeS4rSJdLAogICAgICAgICAgICAgICAgIk9ubGluZSBDb250YWN0cyI6IFtudWxsLCLlnKjnur/lpb3lj4siXSwKICAgICAgICAgICAgICAgICJSZS1lc3RhYmxpc2hpbmcgZW5jcnlwdGVkIHNlc3Npb24iOiBbbnVsbCwi6YeN5paw5bu656uL5Yqg5a+G5Lya6K+dIl0sCiAgICAgICAgICAgICAgICAiR2VuZXJhdGluZyBwcml2YXRlIGtleS4iOiBbbnVsbCwi5q2j5Zyo55Sf5oiQ56eB6ZKlIl0sCiAgICAgICAgICAgICAgICAiWW91ciBicm93c2VyIG1pZ2h0IGJlY29tZSB1bnJlc3BvbnNpdmUuIjogW251bGwsIuaCqOeahOa1j+iniOWZqOWPr+iDveS8muaaguaXtuaXoOWTjeW6lCJdLAogICAgICAgICAgICAgICAgIkF1dGhlbnRpY2F0aW9uIHJlcXVlc3QgZnJvbSAlMSRzXG5cbllvdXIgYnVkZHkgaXMgYXR0ZW1wdGluZyB0byB2ZXJpZnkgeW91ciBpZGVudGl0eSwgYnkgYXNraW5nIHlvdSB0aGUgcXVlc3Rpb24gYmVsb3cuXG5cbiUyJHMiOiBbbnVsbCwi5p2l6IeqJTEkc+eahOmqjOivgeivt+axgiBcblxu5a+55pa55q2j5Zyo6K+V5Zu+6aqM6K+B5oKo55qE5L+h5oGv77yM6K+35Zue562U5aaC5LiL6Zeu6aKY77yaXG5cbiUyJHMiXSwKICAgICAgICAgICAgICAgICJDb3VsZCBub3QgdmVyaWZ5IHRoaXMgdXNlcidzIGlkZW50aWZ5LiI6IFtudWxsLCLml6Dms5Xpqozor4Hlr7nmlrnkv6Hmga/jgIIiXSwKICAgICAgICAgICAgICAgICJFeGNoYW5naW5nIHByaXZhdGUga2V5IHdpdGggYnVkZHkuIjogW251bGwsIuato+WcqOS4juWvueaWueS6pOaNouengemSpSJdLAogICAgICAgICAgICAgICAgIlBlcnNvbmFsIG1lc3NhZ2UiOiBbbnVsbCwi56eB5L+hIl0sCiAgICAgICAgICAgICAgICAibWUiOiBbbnVsbCwi5oiRIl0sCiAgICAgICAgICAgICAgICAiU2hvdyB0aGlzIG1lbnUiOiBbbnVsbCwi5pi+56S65q2k6aG56I+c5Y2VIl0sCiAgICAgICAgICAgICAgICAiV3JpdGUgaW4gdGhlIHRoaXJkIHBlcnNvbiI6IFtudWxsLCLku6XnrKzkuInogIXouqvku73lhpkiXSwKICAgICAgICAgICAgICAgICJSZW1vdmUgbWVzc2FnZXMiOiBbbnVsbCwi56e76Zmk5raI5oGvIl0sCiAgICAgICAgICAgICAgICAiQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIGNsZWFyIHRoZSBtZXNzYWdlcyBmcm9tIHRoaXMgY2hhdCBib3g/IjogW251bGwsIuS9oOehruWumua4hemZpOatpOasoeeahOiBiuWkqeiusOW9leWQl++8nyJdLAogICAgICAgICAgICAgICAgIllvdXIgbWVzc2FnZSBjb3VsZCBub3QgYmUgc2VudCI6IFtudWxsLCLmgqjnmoTmtojmga/ml6Dms5XpgIHlh7oiXSwKICAgICAgICAgICAgICAgICJXZSByZWNlaXZlZCBhbiB1bmVuY3J5cHRlZCBtZXNzYWdlIjogW251bGwsIuaIkeS7rOaUtuWIsOS6huS4gOadoeacquWKoOWvhueahOS/oeaBryJdLAogICAgICAgICAgICAgICAgIldlIHJlY2VpdmVkIGFuIHVucmVhZGFibGUgZW5jcnlwdGVkIG1lc3NhZ2UiOiBbbnVsbCwi5oiR5Lus5pS25Yiw5LiA5p2h5peg5rOV6K+75Y+W55qE5L+h5oGvIl0sCiAgICAgICAgICAgICAgICAiVGhpcyB1c2VyIGhhcyByZXF1ZXN0ZWQgYW4gZW5jcnlwdGVkIHNlc3Npb24uIjogW251bGwsIuatpOeUqOaIt+ivt+axguS6huS4gOS4quWKoOWvhuS8muivneOAgiJdLAogICAgICAgICAgICAgICAgIkhlcmUgYXJlIHRoZSBmaW5nZXJwcmludHMsIHBsZWFzZSBjb25maXJtIHRoZW0gd2l0aCAlMSRzLCBvdXRzaWRlIG9mIHRoaXMgY2hhdC5cblxuRmluZ2VycHJpbnQgZm9yIHlvdSwgJTIkczogJTMkc1xuXG5GaW5nZXJwcmludCBmb3IgJTEkczogJTQkc1xuXG5JZiB5b3UgaGF2ZSBjb25maXJtZWQgdGhhdCB0aGUgZmluZ2VycHJpbnRzIG1hdGNoLCBjbGljayBPSywgb3RoZXJ3aXNlIGNsaWNrIENhbmNlbC4iOiBbbnVsbCwi6L+Z6YeM5piv5oyH57q544CC6K+35LiOICUxJHMg56Gu6K6k44CCXG5cbuaCqOeahCAlMiRzIOaMh+e6uTogJTMkc1xuXG4lMSRzIOeahOaMh+e6uTogJTQkc1xuXG7lpoLmnpznoa7orqTnrKblkIjvvIzor7fngrnlh7tPS++8jOWQpuWImeeCueWHu+WPlua2iCJdLAogICAgICAgICAgICAgICAgIldoYXQgaXMgeW91ciBzZWN1cml0eSBxdWVzdGlvbj8iOiBbbnVsbCwi5oKo55qE5a6J5YWo6Zeu6aKY5pivPyJdLAogICAgICAgICAgICAgICAgIldoYXQgaXMgdGhlIGFuc3dlciB0byB0aGUgc2VjdXJpdHkgcXVlc3Rpb24/IjogW251bGwsIuatpOWuieWFqOmXrumimOeahOetlOahiOaYrz8iXSwKICAgICAgICAgICAgICAgICJJbnZhbGlkIGF1dGhlbnRpY2F0aW9uIHNjaGVtZSBwcm92aWRlZCI6IFtudWxsLCLpnZ7ms5XnmoTorqTor4HmlrnlvI8iXSwKICAgICAgICAgICAgICAgICJZb3VyIG1lc3NhZ2VzIGFyZSBub3QgZW5jcnlwdGVkIGFueW1vcmUiOiBbbnVsbCwi5oKo55qE5raI5oGv5bCG5LiN5YaN6KKr5Yqg5a+GIl0sCiAgICAgICAgICAgICAgICAiWW91ciBtZXNzYWdlcyBhcmUgbm93IGVuY3J5cHRlZCBidXQgeW91ciBidWRkeSdzIGlkZW50aXR5IGhhcyBub3QgYmVlbiB2ZXJpZmllZC4iOiBbbnVsbCwi5oKo55qE5raI5oGv546w5bey5Yqg5a+G77yM5L2G5piv5a+55pa56Lqr5Lu95bCa5pyq6aqM6K+BIl0sCiAgICAgICAgICAgICAgICAiWW91ciBidWRkeSdzIGlkZW50aWZ5IGhhcyBiZWVuIHZlcmlmaWVkLiI6IFtudWxsLCLlr7nmlrnnmoTouqvku73lt7LpgJrov4fpqozor4HjgIIiXSwKICAgICAgICAgICAgICAgICJZb3VyIGJ1ZGR5IGhhcyBlbmRlZCBlbmNyeXB0aW9uIG9uIHRoZWlyIGVuZCwgeW91IHNob3VsZCBkbyB0aGUgc2FtZS4iOiBbbnVsbCwi5a+55pa55bey57uT5p2f5Yqg5a+G77yM5oKo5Lmf6ZyA6KaB5YGa5ZCM5qC355qE5pON5L2c44CCIl0sCiAgICAgICAgICAgICAgICAiWW91ciBtZXNzYWdlcyBhcmUgbm90IGVuY3J5cHRlZC4gQ2xpY2sgaGVyZSB0byBlbmFibGUgT1RSIGVuY3J5cHRpb24uIjogW251bGwsIuaCqOeahOa2iOaBr+acquWKoOWvhuOAgueCueWHu+i/memHjOadpeWQr+eUqE9UUuWKoOWvhiJdLAogICAgICAgICAgICAgICAgIllvdXIgbWVzc2FnZXMgYXJlIGVuY3J5cHRlZCwgYnV0IHlvdXIgYnVkZHkgaGFzIG5vdCBiZWVuIHZlcmlmaWVkLiI6IFtudWxsLCLmgqjnmoTmtojmga/lt7LliqDlr4bvvIzkvYblr7nmlrnmnKrpgJrov4fpqozor4EiXSwKICAgICAgICAgICAgICAgICJZb3VyIG1lc3NhZ2VzIGFyZSBlbmNyeXB0ZWQgYW5kIHlvdXIgYnVkZHkgdmVyaWZpZWQuIjogW251bGwsIuaCqOeahOa2iOaBr+W3suWKoOWvhu+8jOWvueaWueW3sumqjOivgeOAgiJdLAogICAgICAgICAgICAgICAgIllvdXIgYnVkZHkgaGFzIGNsb3NlZCB0aGVpciBlbmQgb2YgdGhlIHByaXZhdGUgc2Vzc2lvbiwgeW91IHNob3VsZCBkbyB0aGUgc2FtZSI6IFtudWxsLCLlr7nmlrnlt7LlhbPpl63np4HmnInkvJror53vvIzmgqjkuZ/lupTor6XlhbPpl60iXSwKICAgICAgICAgICAgICAgICJFbmQgZW5jcnlwdGVkIGNvbnZlcnNhdGlvbiI6IFtudWxsLCLnu5PmnZ/liqDlr4bnmoTkvJror50iXSwKICAgICAgICAgICAgICAgICJSZWZyZXNoIGVuY3J5cHRlZCBjb252ZXJzYXRpb24iOiBbbnVsbCwi5Yi35paw5Yqg5a+G55qE5Lya6K+dIl0sCiAgICAgICAgICAgICAgICAiU3RhcnQgZW5jcnlwdGVkIGNvbnZlcnNhdGlvbiI6IFtudWxsLCLlvIDlp4vliqDlr4bnmoTkvJror50iXSwKICAgICAgICAgICAgICAgICJWZXJpZnkgd2l0aCBmaW5nZXJwcmludHMiOiBbbnVsbCwi6aqM6K+B5oyH57q5Il0sCiAgICAgICAgICAgICAgICAiVmVyaWZ5IHdpdGggU01QIjogW251bGwsIumqjOivgVNNUCJdLAogICAgICAgICAgICAgICAgIldoYXQncyB0aGlzPyI6IFtudWxsLCLov5nmmK/ku4DkuYg/Il0sCiAgICAgICAgICAgICAgICAiT25saW5lIjogW251bGwsIuWcqOe6vyJdLAogICAgICAgICAgICAgICAgIkJ1c3kiOiBbbnVsbCwi5b+Z56KM5LitIl0sCiAgICAgICAgICAgICAgICAiQXdheSI6IFtudWxsLCLnprvlvIAiXSwKICAgICAgICAgICAgICAgICJPZmZsaW5lIjogW251bGwsIuemu+e6vyJdLAogICAgICAgICAgICAgICAgIkNvbnRhY3RzIjogW251bGwsIuiBlOezu+S6uiJdLAogICAgICAgICAgICAgICAgIkNvbnRhY3QgbmFtZSI6IFtudWxsLCLogZTns7vkurrlkI3np7AiXSwKICAgICAgICAgICAgICAgICJTZWFyY2giOiBbbnVsbCwi5pCc57SiIl0sCiAgICAgICAgICAgICAgICAiQ29udGFjdCB1c2VybmFtZSI6IFtudWxsLCLogZTns7vkurrlp5PlkI0iXSwKICAgICAgICAgICAgICAgICJBZGQiOiBbbnVsbCwi5re75YqgIl0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgdG8gYWRkIG5ldyBjaGF0IGNvbnRhY3RzIjogW251bGwsIueCueWHu+a3u+WKoOaWsOiBlOezu+S6uiJdLAogICAgICAgICAgICAgICAgIkFkZCBhIGNvbnRhY3QiOiBbbnVsbCwi5re75Yqg6IGU57O75Lq6Il0sCiAgICAgICAgICAgICAgICAiTm8gdXNlcnMgZm91bmQiOiBbbnVsbCwi5pyq5om+5Yiw55So5oi3Il0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgdG8gYWRkIGFzIGEgY2hhdCBjb250YWN0IjogW251bGwsIueCueWHu+a3u+WKoOS4uuWlveWPiyJdLAogICAgICAgICAgICAgICAgIlJvb20gbmFtZSI6IFtudWxsLCLogYrlpKnlrqTlkI3np7AiXSwKICAgICAgICAgICAgICAgICJOaWNrbmFtZSI6IFtudWxsLCLmmLXnp7AiXSwKICAgICAgICAgICAgICAgICJTZXJ2ZXIiOiBbbnVsbCwi5pyN5Yqh5ZmoIl0sCiAgICAgICAgICAgICAgICAiSm9pbiI6IFtudWxsLCLliqDlhaUiXSwKICAgICAgICAgICAgICAgICJTaG93IHJvb21zIjogW251bGwsIuaYvuekuuaJgOacieiBiuWkqeWupCJdLAogICAgICAgICAgICAgICAgIlJvb21zIjogW251bGwsIuiBiuWkqeWupCJdLAogICAgICAgICAgICAgICAgIk5vIHJvb21zIG9uICUxJHMiOiBbbnVsbCwiJTEkcyDkuIrmsqHmnInogYrlpKnlrqQiXSwKICAgICAgICAgICAgICAgICJSb29tcyBvbiAlMSRzIjogW251bGwsIiUxJHMg5LiK55qE6IGK5aSp5a6kIl0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgdG8gb3BlbiB0aGlzIHJvb20iOiBbbnVsbCwi5omT5byA6IGK5aSp5a6kIl0sCiAgICAgICAgICAgICAgICAiU2hvdyBtb3JlIGluZm9ybWF0aW9uIG9uIHRoaXMgcm9vbSI6IFtudWxsLCLmmL7npLrmrKHogYrlpKnlrqTnmoTmm7TlpJrkv6Hmga8iXSwKICAgICAgICAgICAgICAgICJEZXNjcmlwdGlvbjoiOiBbbnVsbCwi5o+P6L+wOiAiXSwKICAgICAgICAgICAgICAgICJPY2N1cGFudHM6IjogW251bGwsIuaIkOWRmDoiXSwKICAgICAgICAgICAgICAgICJGZWF0dXJlczoiOiBbbnVsbCwi54m55oCnOiJdLAogICAgICAgICAgICAgICAgIlJlcXVpcmVzIGF1dGhlbnRpY2F0aW9uIjogW251bGwsIumcgOimgemqjOivgSJdLAogICAgICAgICAgICAgICAgIkhpZGRlbiI6IFtudWxsLCLpmpDol4/nmoQiXSwKICAgICAgICAgICAgICAgICJSZXF1aXJlcyBhbiBpbnZpdGF0aW9uIjogW251bGwsIumcgOimgeiiq+mCgOivtyJdLAogICAgICAgICAgICAgICAgIk1vZGVyYXRlZCI6IFtudWxsLCLlj5HoqIDlj5fpmZAiXSwKICAgICAgICAgICAgICAgICJOb24tYW5vbnltb3VzIjogW251bGwsIumdnuWMv+WQjSJdLAogICAgICAgICAgICAgICAgIk9wZW4gcm9vbSI6IFtudWxsLCLmiZPlvIDogYrlpKnlrqQiXSwKICAgICAgICAgICAgICAgICJQZXJtYW5lbnQgcm9vbSI6IFtudWxsLCLmsLjkuYXogYrlpKnlrqQiXSwKICAgICAgICAgICAgICAgICJQdWJsaWMiOiBbbnVsbCwi5YWs5byA55qEIl0sCiAgICAgICAgICAgICAgICAiU2VtaS1hbm9ueW1vdXMiOiBbbnVsbCwi5Y2K5Yy/5ZCNIl0sCiAgICAgICAgICAgICAgICAiVGVtcG9yYXJ5IHJvb20iOiBbbnVsbCwi5Li05pe26IGK5aSp5a6kIl0sCiAgICAgICAgICAgICAgICAiVW5tb2RlcmF0ZWQiOiBbbnVsbCwi5peg5Y+R6KiA6ZmQ5Yi2Il0sCiAgICAgICAgICAgICAgICAiU2V0IGNoYXRyb29tIHRvcGljIjogW251bGwsIuiuvue9ruaIv+mXtOS4u+mimCJdLAogICAgICAgICAgICAgICAgIktpY2sgdXNlciBmcm9tIGNoYXRyb29tIjogW251bGwsIuaKiueUqOaIt+i4ouWHuuaIv+mXtCJdLAogICAgICAgICAgICAgICAgIkJhbiB1c2VyIGZyb20gY2hhdHJvb20iOiBbbnVsbCwi6Zi75q2i5q2k55So5oi36L+b5YWl5oi/6Ze0Il0sCiAgICAgICAgICAgICAgICAiTWVzc2FnZSI6IFtudWxsLCLkv6Hmga8iXSwKICAgICAgICAgICAgICAgICJTYXZlIjogW251bGwsIuS/neWtmCJdLAogICAgICAgICAgICAgICAgIkNhbmNlbCI6IFtudWxsLCLlj5bmtogiXSwKICAgICAgICAgICAgICAgICJBbiBlcnJvciBvY2N1cnJlZCB3aGlsZSB0cnlpbmcgdG8gc2F2ZSB0aGUgZm9ybS4iOiBbbnVsbCwi5L+d5a2Y6KGo5Y2V5piv5Ye66ZSZ44CCIl0sCiAgICAgICAgICAgICAgICAiVGhpcyBjaGF0cm9vbSByZXF1aXJlcyBhIHBhc3N3b3JkIjogW251bGwsIuatpOiBiuWkqeWupOmcgOimgeWvhueggSJdLAogICAgICAgICAgICAgICAgIlBhc3N3b3JkOiAiOiBbbnVsbCwi5a+G56CBOiJdLAogICAgICAgICAgICAgICAgIlN1Ym1pdCI6IFtudWxsLCLlj5HpgIEiXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gaXMgbm90IGFub255bW91cyI6IFtudWxsLCLmraTkuLrpnZ7ljL/lkI3ogYrlpKnlrqQiXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gbm93IHNob3dzIHVuYXZhaWxhYmxlIG1lbWJlcnMiOiBbbnVsbCwi5q2k6IGK5aSp5a6k5pi+56S65LiN5Y+v55So55So5oi3Il0sCiAgICAgICAgICAgICAgICAiVGhpcyByb29tIGRvZXMgbm90IHNob3cgdW5hdmFpbGFibGUgbWVtYmVycyI6IFtudWxsLCLmraTogYrlpKnlrqTkuI3mmL7npLrkuI3lj6/nlKjnlKjmiLciXSwKICAgICAgICAgICAgICAgICJOb24tcHJpdmFjeS1yZWxhdGVkIHJvb20gY29uZmlndXJhdGlvbiBoYXMgY2hhbmdlZCI6IFtudWxsLCLmraTogYrlpKnlrqTorr7nva4o6Z2e56eB5a+G5oCnKeW3suaUueWPmCJdLAogICAgICAgICAgICAgICAgIlJvb20gbG9nZ2luZyBpcyBub3cgZW5hYmxlZCI6IFtudWxsLCLogYrlpKnlrqTogYrlpKnorrDlvZXlt7LlkK/nlKgiXSwKICAgICAgICAgICAgICAgICJSb29tIGxvZ2dpbmcgaXMgbm93IGRpc2FibGVkIjogW251bGwsIuiBiuWkqeWupOiBiuWkqeiusOW9leW3suemgeeUqCJdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBpcyBub3cgbm9uLWFub255bW91cyI6IFtudWxsLCLmraTogYrlpKnlrqTpnZ7ljL/lkI0iXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gaXMgbm93IHNlbWktYW5vbnltb3VzIjogW251bGwsIuatpOiBiuWkqeWupOWNiuWMv+WQjSJdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBpcyBub3cgZnVsbHktYW5vbnltb3VzIjogW251bGwsIuatpOiBiuWkqeWupOWujOWFqOWMv+WQjSJdLAogICAgICAgICAgICAgICAgIkEgbmV3IHJvb20gaGFzIGJlZW4gY3JlYXRlZCI6IFtudWxsLCLmlrDogYrlpKnlrqTlt7LliJvlu7oiXSwKICAgICAgICAgICAgICAgICJZb3VyIG5pY2tuYW1lIGhhcyBiZWVuIGNoYW5nZWQiOiBbbnVsbCwi5oKo55qE5pi156ew6KKr5pu05pS55LqGIl0sCiAgICAgICAgICAgICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IGhhcyBiZWVuIGJhbm5lZCI6IFtudWxsLCI8c3Ryb25nPiUxJHM8L3N0cm9uZz4g5bey6KKr56aB5q2iIl0sCiAgICAgICAgICAgICAgICAiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IGhhcyBiZWVuIGtpY2tlZCBvdXQiOiBbbnVsbCwiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IOW3suiiq+i4ouWHuiJdLAogICAgICAgICAgICAgICAgIjxzdHJvbmc+JTEkczwvc3Ryb25nPiBoYXMgYmVlbiByZW1vdmVkIGJlY2F1c2Ugb2YgYW4gYWZmaWxpYXRpb24gY2hhbmdlIjogW251bGwsIueUseS6juWFs+ezu+ino+mZpOOAgTxzdHJvbmc+JTEkczwvc3Ryb25nPiDlt7Looqvnp7vpmaQiXSwKICAgICAgICAgICAgICAgICI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gaGFzIGJlZW4gcmVtb3ZlZCBmb3Igbm90IGJlaW5nIGEgbWVtYmVyIjogW251bGwsIueUseS6juS4jeaYr+aIkOWRmOOAgTxzdHJvbmc+JTEkczwvc3Ryb25nPiDlt7Looqvnp7vpmaQiXSwKICAgICAgICAgICAgICAgICJZb3UgaGF2ZSBiZWVuIGJhbm5lZCBmcm9tIHRoaXMgcm9vbSI6IFtudWxsLCLmgqjlt7LooqvmraTogYrlpKnlrqTnpoHmraLlhaXlhoUiXSwKICAgICAgICAgICAgICAgICJZb3UgaGF2ZSBiZWVuIGtpY2tlZCBmcm9tIHRoaXMgcm9vbSI6IFtudWxsLCLmgqjlt7LooqvouKLlh7rmrKHmiL/pl7QiXSwKICAgICAgICAgICAgICAgICJZb3UgaGF2ZSBiZWVuIHJlbW92ZWQgZnJvbSB0aGlzIHJvb20gYmVjYXVzZSBvZiBhbiBhZmZpbGlhdGlvbiBjaGFuZ2UiOiBbbnVsbCwi55Sx5LqO5YWz57O75Y+Y5YyW77yM5oKo5bey6KKr56e76Zmk5q2k5oi/6Ze0Il0sCiAgICAgICAgICAgICAgICAiWW91IGhhdmUgYmVlbiByZW1vdmVkIGZyb20gdGhpcyByb29tIGJlY2F1c2UgdGhlIHJvb20gaGFzIGNoYW5nZWQgdG8gbWVtYmVycy1vbmx5IGFuZCB5b3UncmUgbm90IGEgbWVtYmVyIjogW251bGwsIuaCqOW3suiiq+enu+mZpOatpOaIv+mXtOWboOS4uuatpOaIv+mXtOabtOaUueS4uuWPquWFgeiuuOaIkOWRmOWKoOWFpe+8jOiAjOaCqOmdnuaIkOWRmCJdLAogICAgICAgICAgICAgICAgIllvdSBoYXZlIGJlZW4gcmVtb3ZlZCBmcm9tIHRoaXMgcm9vbSBiZWNhdXNlIHRoZSBNVUMgKE11bHRpLXVzZXIgY2hhdCkgc2VydmljZSBpcyBiZWluZyBzaHV0IGRvd24uIjogW251bGwsIueUseS6juacjeWKoeS4jeWPr+eUqO+8jOaCqOW3suiiq+enu+mZpOatpOaIv+mXtOOAgiJdLAogICAgICAgICAgICAgICAgIllvdSBhcmUgbm90IG9uIHRoZSBtZW1iZXIgbGlzdCBvZiB0aGlzIHJvb20iOiBbbnVsbCwi5oKo5bm26Z2e5q2k5oi/6Ze05oiQ5ZGYIl0sCiAgICAgICAgICAgICAgICAiTm8gbmlja25hbWUgd2FzIHNwZWNpZmllZCI6IFtudWxsLCLmnKrmjIflrprmmLXnp7AiXSwKICAgICAgICAgICAgICAgICJZb3UgYXJlIG5vdCBhbGxvd2VkIHRvIGNyZWF0ZSBuZXcgcm9vbXMiOiBbbnVsbCwi5oKo5Y+v5q2k5Yib5bu65paw5oi/6Ze05LqGIl0sCiAgICAgICAgICAgICAgICAiWW91ciBuaWNrbmFtZSBkb2Vzbid0IGNvbmZvcm0gdG8gdGhpcyByb29tJ3MgcG9saWNpZXMiOiBbbnVsbCwi5oKo55qE5pi156ew5LiN56ym5ZCI5q2k5oi/6Ze05qCH5YeGIl0sCiAgICAgICAgICAgICAgICAiWW91ciBuaWNrbmFtZSBpcyBhbHJlYWR5IHRha2VuIjogW251bGwsIuaCqOeahOaYteensOW3suiiq+WNoOeUqCJdLAogICAgICAgICAgICAgICAgIlRoaXMgcm9vbSBkb2VzIG5vdCAoeWV0KSBleGlzdCI6IFtudWxsLCLmraTmiL/pl7TkuI3lrZjlnKgiXSwKICAgICAgICAgICAgICAgICJUaGlzIHJvb20gaGFzIHJlYWNoZWQgaXQncyBtYXhpbXVtIG51bWJlciBvZiBvY2N1cGFudHMiOiBbbnVsbCwi5q2k5oi/6Ze05Lq65pWw5bey6L6+5LiK57q/Il0sCiAgICAgICAgICAgICAgICAiVG9waWMgc2V0IGJ5ICUxJHMgdG86ICUyJHMiOiBbbnVsbCwiJTEkcyDorr7nva7or53popjkuLo6ICUyJHMiXSwKICAgICAgICAgICAgICAgICJUaGlzIHVzZXIgaXMgYSBtb2RlcmF0b3IiOiBbbnVsbCwi5q2k55So5oi35piv5Li75oyB5Lq6Il0sCiAgICAgICAgICAgICAgICAiVGhpcyB1c2VyIGNhbiBzZW5kIG1lc3NhZ2VzIGluIHRoaXMgcm9vbSI6IFtudWxsLCLmraTnlKjmiLflnKjov5nmiL/pl7Tph4zlj6/lj5Hmtojmga8iXSwKICAgICAgICAgICAgICAgICJUaGlzIHVzZXIgY2FuIE5PVCBzZW5kIG1lc3NhZ2VzIGluIHRoaXMgcm9vbSI6IFtudWxsLCLmraTnlKjmiLfkuI3lj6/lnKjmraTmiL/pl7Tlj5Hmtojmga8iXSwKICAgICAgICAgICAgICAgICJNaW5pbWl6ZWQiOiBbbnVsbCwi5pyA5bCP5YyW55qEIl0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgdG8gcmVtb3ZlIHRoaXMgY29udGFjdCI6IFtudWxsLCLngrnlh7vnp7vpmaTogZTns7vkuroiXSwKICAgICAgICAgICAgICAgICJBY2NlcHQiOiBbbnVsbCwi5o6l5Y+XIl0sCiAgICAgICAgICAgICAgICAiQ2xpY2sgdG8gY2hhdCB3aXRoIHRoaXMgY29udGFjdCI6IFtudWxsLCLngrnlh7vkuI7lr7nmlrnkuqTosIgiXSwKICAgICAgICAgICAgICAgICJNeSBjb250YWN0cyI6IFtudWxsLCLmiJHnmoTlpb3lj4vliJfooagiXSwKICAgICAgICAgICAgICAgICJDb250YWN0IHJlcXVlc3RzIjogW251bGwsIuadpeiHquWlveWPi+eahOivt+axgiJdLAogICAgICAgICAgICAgICAgIlBlbmRpbmcgY29udGFjdHMiOiBbbnVsbCwi5L+d55WZ5Lit55qE6IGU57O75Lq6Il0sCiAgICAgICAgICAgICAgICAiQ3VzdG9tIHN0YXR1cyI6IFtudWxsLCJESVnnirbmgIEiXSwKICAgICAgICAgICAgICAgICJvbmxpbmUiOiBbbnVsbCwi5Zyo57q/Il0sCiAgICAgICAgICAgICAgICAiYnVzeSI6IFtudWxsLCLlv5nnoowiXSwKICAgICAgICAgICAgICAgICJhd2F5IGZvciBsb25nIjogW251bGwsIumVv+aXtumXtOemu+W8gCJdLAogICAgICAgICAgICAgICAgImF3YXkiOiBbbnVsbCwi56a75byAIl0sCiAgICAgICAgICAgICAgICAiSSBhbSAlMSRzIjogW251bGwsIuaIkeeOsOWcqCUxJHMiXSwKICAgICAgICAgICAgICAgICJDbGljayBoZXJlIHRvIHdyaXRlIGEgY3VzdG9tIHN0YXR1cyBtZXNzYWdlIjogW251bGwsIueCueWHu+i/memHjO+8jOWhq+WGmeeKtuaAgeS/oeaBryJdLAogICAgICAgICAgICAgICAgIkNsaWNrIHRvIGNoYW5nZSB5b3VyIGNoYXQgc3RhdHVzIjogW251bGwsIueCueWHu+i/memHjOaUueWPmOiBiuWkqeeKtuaAgSJdLAogICAgICAgICAgICAgICAgIlhNUFAvSmFiYmVyIFVzZXJuYW1lOiI6IFtudWxsLCJYTVBQL0phYmJlcueUqOaIt+WQjToiXSwKICAgICAgICAgICAgICAgICJQYXNzd29yZDoiOiBbbnVsbCwi5a+G56CBOiJdLAogICAgICAgICAgICAgICAgIkxvZyBJbiI6IFtudWxsLCLnmbvlvZUiXSwKICAgICAgICAgICAgICAgICJTaWduIGluIjogW251bGwsIueZu+W9lSJdLAogICAgICAgICAgICAgICAgIlRvZ2dsZSBjaGF0IjogW251bGwsIuaKmOWPoOiBiuWkqeeql+WPoyJdCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkgewogICAgICAgIGRlZmluZSgiemgiLCBbJ2plZCddLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBmYWN0b3J5KG5ldyBKZWQodHJhbnNsYXRpb25zKSk7CiAgICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICAgIGlmICghd2luZG93LmxvY2FsZXMpIHsKICAgICAgICAgICAgd2luZG93LmxvY2FsZXMgPSB7fTsKICAgICAgICB9CiAgICAgICAgd2luZG93LmxvY2FsZXMuemggPSBmYWN0b3J5KG5ldyBKZWQodHJhbnNsYXRpb25zKSk7CiAgICB9Cn0odGhpcywgZnVuY3Rpb24gKHpoKSB7CiAgICByZXR1cm4gemg7Cn0pKTsKCi8qCiAqIFRoaXMgZmlsZSBzcGVjaWZpZXMgdGhlIGxhbmd1YWdlIGRlcGVuZGVuY2llcy4KICoKICogVHJhbnNsYXRpb25zIHRha2UgdXAgYSBsb3Qgb2Ygc3BhY2UgYW5kIHlvdSBhcmUgdGhlcmVmb3JlIGFkdmlzZWQgdG8gcmVtb3ZlCiAqIGZyb20gaGVyZSBhbnkgbGFuZ3VhZ2VzIHRoYXQgeW91IGRvbid0IG5lZWQuCiAqLwoKKGZ1bmN0aW9uIChyb290LCBmYWN0b3J5KSB7CiAgICBkZWZpbmUoImxvY2FsZXMiLCBbCiAgICAgICAgJ2plZCcsCiAgICAgICAgJ2FmJywKICAgICAgICAnZGUnLAogICAgICAgICdlbicsCiAgICAgICAgJ2VzJywKICAgICAgICAnZnInLAogICAgICAgICdoZScsCiAgICAgICAgJ2h1JywKICAgICAgICAnaWQnLAogICAgICAgICdpdCcsCiAgICAgICAgJ2phJywKICAgICAgICAnbmwnLAogICAgICAgICdwdF9CUicsCiAgICAgICAgJ3J1JywKICAgICAgICAnemgnCiAgICAgICAgXSwgZnVuY3Rpb24gKGplZCwgYWYsIGRlLCBlbiwgZXMsIGZyLCBoZSwgaHUsIGlkLCBpdCwgamEsIG5sLCBwdF9CUiwgcnUsIHpoKSB7CiAgICAgICAgICAgIHJvb3QubG9jYWxlcyA9IHsKICAgICAgICAgICAgICAgICdhZic6IGFmLAogICAgICAgICAgICAgICAgJ2RlJzogZGUsCiAgICAgICAgICAgICAgICAnZW4nOiBlbiwKICAgICAgICAgICAgICAgICdlcyc6IGVzLAogICAgICAgICAgICAgICAgJ2ZyJzogZnIsCiAgICAgICAgICAgICAgICAnaGUnOiBoZSwKICAgICAgICAgICAgICAgICdodSc6IGh1LAogICAgICAgICAgICAgICAgJ2lkJzogaWQsCiAgICAgICAgICAgICAgICAnaXQnOiBpdCwKICAgICAgICAgICAgICAgICdqYSc6IGphLAogICAgICAgICAgICAgICAgJ25sJzogbmwsCiAgICAgICAgICAgICAgICAncHQtYnInOiBwdF9CUiwKICAgICAgICAgICAgICAgICdydSc6IHJ1LAogICAgICAgICAgICAgICAgJ3poJzp6aAogICAgICAgICAgICB9OwogICAgICAgIH0pOwp9KSh0aGlzKTsKCi8vICAgICBVbmRlcnNjb3JlLmpzIDEuNi4wCi8vICAgICBodHRwOi8vdW5kZXJzY29yZWpzLm9yZwovLyAgICAgKGMpIDIwMDktMjAxNCBKZXJlbXkgQXNoa2VuYXMsIERvY3VtZW50Q2xvdWQgYW5kIEludmVzdGlnYXRpdmUgUmVwb3J0ZXJzICYgRWRpdG9ycwovLyAgICAgVW5kZXJzY29yZSBtYXkgYmUgZnJlZWx5IGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBNSVQgbGljZW5zZS4KCihmdW5jdGlvbigpIHsKCiAgLy8gQmFzZWxpbmUgc2V0dXAKICAvLyAtLS0tLS0tLS0tLS0tLQoKICAvLyBFc3RhYmxpc2ggdGhlIHJvb3Qgb2JqZWN0LCBgd2luZG93YCBpbiB0aGUgYnJvd3Nlciwgb3IgYGV4cG9ydHNgIG9uIHRoZSBzZXJ2ZXIuCiAgdmFyIHJvb3QgPSB0aGlzOwoKICAvLyBTYXZlIHRoZSBwcmV2aW91cyB2YWx1ZSBvZiB0aGUgYF9gIHZhcmlhYmxlLgogIHZhciBwcmV2aW91c1VuZGVyc2NvcmUgPSByb290Ll87CgogIC8vIEVzdGFibGlzaCB0aGUgb2JqZWN0IHRoYXQgZ2V0cyByZXR1cm5lZCB0byBicmVhayBvdXQgb2YgYSBsb29wIGl0ZXJhdGlvbi4KICB2YXIgYnJlYWtlciA9IHt9OwoKICAvLyBTYXZlIGJ5dGVzIGluIHRoZSBtaW5pZmllZCAoYnV0IG5vdCBnemlwcGVkKSB2ZXJzaW9uOgogIHZhciBBcnJheVByb3RvID0gQXJyYXkucHJvdG90eXBlLCBPYmpQcm90byA9IE9iamVjdC5wcm90b3R5cGUsIEZ1bmNQcm90byA9IEZ1bmN0aW9uLnByb3RvdHlwZTsKCiAgLy8gQ3JlYXRlIHF1aWNrIHJlZmVyZW5jZSB2YXJpYWJsZXMgZm9yIHNwZWVkIGFjY2VzcyB0byBjb3JlIHByb3RvdHlwZXMuCiAgdmFyCiAgICBwdXNoICAgICAgICAgICAgID0gQXJyYXlQcm90by5wdXNoLAogICAgc2xpY2UgICAgICAgICAgICA9IEFycmF5UHJvdG8uc2xpY2UsCiAgICBjb25jYXQgICAgICAgICAgID0gQXJyYXlQcm90by5jb25jYXQsCiAgICB0b1N0cmluZyAgICAgICAgID0gT2JqUHJvdG8udG9TdHJpbmcsCiAgICBoYXNPd25Qcm9wZXJ0eSAgID0gT2JqUHJvdG8uaGFzT3duUHJvcGVydHk7CgogIC8vIEFsbCAqKkVDTUFTY3JpcHQgNSoqIG5hdGl2ZSBmdW5jdGlvbiBpbXBsZW1lbnRhdGlvbnMgdGhhdCB3ZSBob3BlIHRvIHVzZQogIC8vIGFyZSBkZWNsYXJlZCBoZXJlLgogIHZhcgogICAgbmF0aXZlRm9yRWFjaCAgICAgID0gQXJyYXlQcm90by5mb3JFYWNoLAogICAgbmF0aXZlTWFwICAgICAgICAgID0gQXJyYXlQcm90by5tYXAsCiAgICBuYXRpdmVSZWR1Y2UgICAgICAgPSBBcnJheVByb3RvLnJlZHVjZSwKICAgIG5hdGl2ZVJlZHVjZVJpZ2h0ICA9IEFycmF5UHJvdG8ucmVkdWNlUmlnaHQsCiAgICBuYXRpdmVGaWx0ZXIgICAgICAgPSBBcnJheVByb3RvLmZpbHRlciwKICAgIG5hdGl2ZUV2ZXJ5ICAgICAgICA9IEFycmF5UHJvdG8uZXZlcnksCiAgICBuYXRpdmVTb21lICAgICAgICAgPSBBcnJheVByb3RvLnNvbWUsCiAgICBuYXRpdmVJbmRleE9mICAgICAgPSBBcnJheVByb3RvLmluZGV4T2YsCiAgICBuYXRpdmVMYXN0SW5kZXhPZiAgPSBBcnJheVByb3RvLmxhc3RJbmRleE9mLAogICAgbmF0aXZlSXNBcnJheSAgICAgID0gQXJyYXkuaXNBcnJheSwKICAgIG5hdGl2ZUtleXMgICAgICAgICA9IE9iamVjdC5rZXlzLAogICAgbmF0aXZlQmluZCAgICAgICAgID0gRnVuY1Byb3RvLmJpbmQ7CgogIC8vIENyZWF0ZSBhIHNhZmUgcmVmZXJlbmNlIHRvIHRoZSBVbmRlcnNjb3JlIG9iamVjdCBmb3IgdXNlIGJlbG93LgogIHZhciBfID0gZnVuY3Rpb24ob2JqKSB7CiAgICBpZiAob2JqIGluc3RhbmNlb2YgXykgcmV0dXJuIG9iajsKICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBfKSkgcmV0dXJuIG5ldyBfKG9iaik7CiAgICB0aGlzLl93cmFwcGVkID0gb2JqOwogIH07CgogIC8vIEV4cG9ydCB0aGUgVW5kZXJzY29yZSBvYmplY3QgZm9yICoqTm9kZS5qcyoqLCB3aXRoCiAgLy8gYmFja3dhcmRzLWNvbXBhdGliaWxpdHkgZm9yIHRoZSBvbGQgYHJlcXVpcmUoKWAgQVBJLiBJZiB3ZSdyZSBpbgogIC8vIHRoZSBicm93c2VyLCBhZGQgYF9gIGFzIGEgZ2xvYmFsIG9iamVjdCB2aWEgYSBzdHJpbmcgaWRlbnRpZmllciwKICAvLyBmb3IgQ2xvc3VyZSBDb21waWxlciAiYWR2YW5jZWQiIG1vZGUuCiAgaWYgKHR5cGVvZiBleHBvcnRzICE9PSAndW5kZWZpbmVkJykgewogICAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnICYmIG1vZHVsZS5leHBvcnRzKSB7CiAgICAgIGV4cG9ydHMgPSBtb2R1bGUuZXhwb3J0cyA9IF87CiAgICB9CiAgICBleHBvcnRzLl8gPSBfOwogIH0gZWxzZSB7CiAgICByb290Ll8gPSBfOwogIH0KCiAgLy8gQ3VycmVudCB2ZXJzaW9uLgogIF8uVkVSU0lPTiA9ICcxLjYuMCc7CgogIC8vIENvbGxlY3Rpb24gRnVuY3Rpb25zCiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgLy8gVGhlIGNvcm5lcnN0b25lLCBhbiBgZWFjaGAgaW1wbGVtZW50YXRpb24sIGFrYSBgZm9yRWFjaGAuCiAgLy8gSGFuZGxlcyBvYmplY3RzIHdpdGggdGhlIGJ1aWx0LWluIGBmb3JFYWNoYCwgYXJyYXlzLCBhbmQgcmF3IG9iamVjdHMuCiAgLy8gRGVsZWdhdGVzIHRvICoqRUNNQVNjcmlwdCA1KioncyBuYXRpdmUgYGZvckVhY2hgIGlmIGF2YWlsYWJsZS4KICB2YXIgZWFjaCA9IF8uZWFjaCA9IF8uZm9yRWFjaCA9IGZ1bmN0aW9uKG9iaiwgaXRlcmF0b3IsIGNvbnRleHQpIHsKICAgIGlmIChvYmogPT0gbnVsbCkgcmV0dXJuIG9iajsKICAgIGlmIChuYXRpdmVGb3JFYWNoICYmIG9iai5mb3JFYWNoID09PSBuYXRpdmVGb3JFYWNoKSB7CiAgICAgIG9iai5mb3JFYWNoKGl0ZXJhdG9yLCBjb250ZXh0KTsKICAgIH0gZWxzZSBpZiAob2JqLmxlbmd0aCA9PT0gK29iai5sZW5ndGgpIHsKICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IG9iai5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgIGlmIChpdGVyYXRvci5jYWxsKGNvbnRleHQsIG9ialtpXSwgaSwgb2JqKSA9PT0gYnJlYWtlcikgcmV0dXJuOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICB2YXIga2V5cyA9IF8ua2V5cyhvYmopOwogICAgICBmb3IgKHZhciBpID0gMCwgbGVuZ3RoID0ga2V5cy5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgIGlmIChpdGVyYXRvci5jYWxsKGNvbnRleHQsIG9ialtrZXlzW2ldXSwga2V5c1tpXSwgb2JqKSA9PT0gYnJlYWtlcikgcmV0dXJuOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gb2JqOwogIH07CgogIC8vIFJldHVybiB0aGUgcmVzdWx0cyBvZiBhcHBseWluZyB0aGUgaXRlcmF0b3IgdG8gZWFjaCBlbGVtZW50LgogIC8vIERlbGVnYXRlcyB0byAqKkVDTUFTY3JpcHQgNSoqJ3MgbmF0aXZlIGBtYXBgIGlmIGF2YWlsYWJsZS4KICBfLm1hcCA9IF8uY29sbGVjdCA9IGZ1bmN0aW9uKG9iaiwgaXRlcmF0b3IsIGNvbnRleHQpIHsKICAgIHZhciByZXN1bHRzID0gW107CiAgICBpZiAob2JqID09IG51bGwpIHJldHVybiByZXN1bHRzOwogICAgaWYgKG5hdGl2ZU1hcCAmJiBvYmoubWFwID09PSBuYXRpdmVNYXApIHJldHVybiBvYmoubWFwKGl0ZXJhdG9yLCBjb250ZXh0KTsKICAgIGVhY2gob2JqLCBmdW5jdGlvbih2YWx1ZSwgaW5kZXgsIGxpc3QpIHsKICAgICAgcmVzdWx0cy5wdXNoKGl0ZXJhdG9yLmNhbGwoY29udGV4dCwgdmFsdWUsIGluZGV4LCBsaXN0KSk7CiAgICB9KTsKICAgIHJldHVybiByZXN1bHRzOwogIH07CgogIHZhciByZWR1Y2VFcnJvciA9ICdSZWR1Y2Ugb2YgZW1wdHkgYXJyYXkgd2l0aCBubyBpbml0aWFsIHZhbHVlJzsKCiAgLy8gKipSZWR1Y2UqKiBidWlsZHMgdXAgYSBzaW5nbGUgcmVzdWx0IGZyb20gYSBsaXN0IG9mIHZhbHVlcywgYWthIGBpbmplY3RgLAogIC8vIG9yIGBmb2xkbGAuIERlbGVnYXRlcyB0byAqKkVDTUFTY3JpcHQgNSoqJ3MgbmF0aXZlIGByZWR1Y2VgIGlmIGF2YWlsYWJsZS4KICBfLnJlZHVjZSA9IF8uZm9sZGwgPSBfLmluamVjdCA9IGZ1bmN0aW9uKG9iaiwgaXRlcmF0b3IsIG1lbW8sIGNvbnRleHQpIHsKICAgIHZhciBpbml0aWFsID0gYXJndW1lbnRzLmxlbmd0aCA+IDI7CiAgICBpZiAob2JqID09IG51bGwpIG9iaiA9IFtdOwogICAgaWYgKG5hdGl2ZVJlZHVjZSAmJiBvYmoucmVkdWNlID09PSBuYXRpdmVSZWR1Y2UpIHsKICAgICAgaWYgKGNvbnRleHQpIGl0ZXJhdG9yID0gXy5iaW5kKGl0ZXJhdG9yLCBjb250ZXh0KTsKICAgICAgcmV0dXJuIGluaXRpYWwgPyBvYmoucmVkdWNlKGl0ZXJhdG9yLCBtZW1vKSA6IG9iai5yZWR1Y2UoaXRlcmF0b3IpOwogICAgfQogICAgZWFjaChvYmosIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCwgbGlzdCkgewogICAgICBpZiAoIWluaXRpYWwpIHsKICAgICAgICBtZW1vID0gdmFsdWU7CiAgICAgICAgaW5pdGlhbCA9IHRydWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbWVtbyA9IGl0ZXJhdG9yLmNhbGwoY29udGV4dCwgbWVtbywgdmFsdWUsIGluZGV4LCBsaXN0KTsKICAgICAgfQogICAgfSk7CiAgICBpZiAoIWluaXRpYWwpIHRocm93IG5ldyBUeXBlRXJyb3IocmVkdWNlRXJyb3IpOwogICAgcmV0dXJuIG1lbW87CiAgfTsKCiAgLy8gVGhlIHJpZ2h0LWFzc29jaWF0aXZlIHZlcnNpb24gb2YgcmVkdWNlLCBhbHNvIGtub3duIGFzIGBmb2xkcmAuCiAgLy8gRGVsZWdhdGVzIHRvICoqRUNNQVNjcmlwdCA1KioncyBuYXRpdmUgYHJlZHVjZVJpZ2h0YCBpZiBhdmFpbGFibGUuCiAgXy5yZWR1Y2VSaWdodCA9IF8uZm9sZHIgPSBmdW5jdGlvbihvYmosIGl0ZXJhdG9yLCBtZW1vLCBjb250ZXh0KSB7CiAgICB2YXIgaW5pdGlhbCA9IGFyZ3VtZW50cy5sZW5ndGggPiAyOwogICAgaWYgKG9iaiA9PSBudWxsKSBvYmogPSBbXTsKICAgIGlmIChuYXRpdmVSZWR1Y2VSaWdodCAmJiBvYmoucmVkdWNlUmlnaHQgPT09IG5hdGl2ZVJlZHVjZVJpZ2h0KSB7CiAgICAgIGlmIChjb250ZXh0KSBpdGVyYXRvciA9IF8uYmluZChpdGVyYXRvciwgY29udGV4dCk7CiAgICAgIHJldHVybiBpbml0aWFsID8gb2JqLnJlZHVjZVJpZ2h0KGl0ZXJhdG9yLCBtZW1vKSA6IG9iai5yZWR1Y2VSaWdodChpdGVyYXRvcik7CiAgICB9CiAgICB2YXIgbGVuZ3RoID0gb2JqLmxlbmd0aDsKICAgIGlmIChsZW5ndGggIT09ICtsZW5ndGgpIHsKICAgICAgdmFyIGtleXMgPSBfLmtleXMob2JqKTsKICAgICAgbGVuZ3RoID0ga2V5cy5sZW5ndGg7CiAgICB9CiAgICBlYWNoKG9iaiwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBsaXN0KSB7CiAgICAgIGluZGV4ID0ga2V5cyA/IGtleXNbLS1sZW5ndGhdIDogLS1sZW5ndGg7CiAgICAgIGlmICghaW5pdGlhbCkgewogICAgICAgIG1lbW8gPSBvYmpbaW5kZXhdOwogICAgICAgIGluaXRpYWwgPSB0cnVlOwogICAgICB9IGVsc2UgewogICAgICAgIG1lbW8gPSBpdGVyYXRvci5jYWxsKGNvbnRleHQsIG1lbW8sIG9ialtpbmRleF0sIGluZGV4LCBsaXN0KTsKICAgICAgfQogICAgfSk7CiAgICBpZiAoIWluaXRpYWwpIHRocm93IG5ldyBUeXBlRXJyb3IocmVkdWNlRXJyb3IpOwogICAgcmV0dXJuIG1lbW87CiAgfTsKCiAgLy8gUmV0dXJuIHRoZSBmaXJzdCB2YWx1ZSB3aGljaCBwYXNzZXMgYSB0cnV0aCB0ZXN0LiBBbGlhc2VkIGFzIGBkZXRlY3RgLgogIF8uZmluZCA9IF8uZGV0ZWN0ID0gZnVuY3Rpb24ob2JqLCBwcmVkaWNhdGUsIGNvbnRleHQpIHsKICAgIHZhciByZXN1bHQ7CiAgICBhbnkob2JqLCBmdW5jdGlvbih2YWx1ZSwgaW5kZXgsIGxpc3QpIHsKICAgICAgaWYgKHByZWRpY2F0ZS5jYWxsKGNvbnRleHQsIHZhbHVlLCBpbmRleCwgbGlzdCkpIHsKICAgICAgICByZXN1bHQgPSB2YWx1ZTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gcmVzdWx0OwogIH07CgogIC8vIFJldHVybiBhbGwgdGhlIGVsZW1lbnRzIHRoYXQgcGFzcyBhIHRydXRoIHRlc3QuCiAgLy8gRGVsZWdhdGVzIHRvICoqRUNNQVNjcmlwdCA1KioncyBuYXRpdmUgYGZpbHRlcmAgaWYgYXZhaWxhYmxlLgogIC8vIEFsaWFzZWQgYXMgYHNlbGVjdGAuCiAgXy5maWx0ZXIgPSBfLnNlbGVjdCA9IGZ1bmN0aW9uKG9iaiwgcHJlZGljYXRlLCBjb250ZXh0KSB7CiAgICB2YXIgcmVzdWx0cyA9IFtdOwogICAgaWYgKG9iaiA9PSBudWxsKSByZXR1cm4gcmVzdWx0czsKICAgIGlmIChuYXRpdmVGaWx0ZXIgJiYgb2JqLmZpbHRlciA9PT0gbmF0aXZlRmlsdGVyKSByZXR1cm4gb2JqLmZpbHRlcihwcmVkaWNhdGUsIGNvbnRleHQpOwogICAgZWFjaChvYmosIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCwgbGlzdCkgewogICAgICBpZiAocHJlZGljYXRlLmNhbGwoY29udGV4dCwgdmFsdWUsIGluZGV4LCBsaXN0KSkgcmVzdWx0cy5wdXNoKHZhbHVlKTsKICAgIH0pOwogICAgcmV0dXJuIHJlc3VsdHM7CiAgfTsKCiAgLy8gUmV0dXJuIGFsbCB0aGUgZWxlbWVudHMgZm9yIHdoaWNoIGEgdHJ1dGggdGVzdCBmYWlscy4KICBfLnJlamVjdCA9IGZ1bmN0aW9uKG9iaiwgcHJlZGljYXRlLCBjb250ZXh0KSB7CiAgICByZXR1cm4gXy5maWx0ZXIob2JqLCBmdW5jdGlvbih2YWx1ZSwgaW5kZXgsIGxpc3QpIHsKICAgICAgcmV0dXJuICFwcmVkaWNhdGUuY2FsbChjb250ZXh0LCB2YWx1ZSwgaW5kZXgsIGxpc3QpOwogICAgfSwgY29udGV4dCk7CiAgfTsKCiAgLy8gRGV0ZXJtaW5lIHdoZXRoZXIgYWxsIG9mIHRoZSBlbGVtZW50cyBtYXRjaCBhIHRydXRoIHRlc3QuCiAgLy8gRGVsZWdhdGVzIHRvICoqRUNNQVNjcmlwdCA1KioncyBuYXRpdmUgYGV2ZXJ5YCBpZiBhdmFpbGFibGUuCiAgLy8gQWxpYXNlZCBhcyBgYWxsYC4KICBfLmV2ZXJ5ID0gXy5hbGwgPSBmdW5jdGlvbihvYmosIHByZWRpY2F0ZSwgY29udGV4dCkgewogICAgcHJlZGljYXRlIHx8IChwcmVkaWNhdGUgPSBfLmlkZW50aXR5KTsKICAgIHZhciByZXN1bHQgPSB0cnVlOwogICAgaWYgKG9iaiA9PSBudWxsKSByZXR1cm4gcmVzdWx0OwogICAgaWYgKG5hdGl2ZUV2ZXJ5ICYmIG9iai5ldmVyeSA9PT0gbmF0aXZlRXZlcnkpIHJldHVybiBvYmouZXZlcnkocHJlZGljYXRlLCBjb250ZXh0KTsKICAgIGVhY2gob2JqLCBmdW5jdGlvbih2YWx1ZSwgaW5kZXgsIGxpc3QpIHsKICAgICAgaWYgKCEocmVzdWx0ID0gcmVzdWx0ICYmIHByZWRpY2F0ZS5jYWxsKGNvbnRleHQsIHZhbHVlLCBpbmRleCwgbGlzdCkpKSByZXR1cm4gYnJlYWtlcjsKICAgIH0pOwogICAgcmV0dXJuICEhcmVzdWx0OwogIH07CgogIC8vIERldGVybWluZSBpZiBhdCBsZWFzdCBvbmUgZWxlbWVudCBpbiB0aGUgb2JqZWN0IG1hdGNoZXMgYSB0cnV0aCB0ZXN0LgogIC8vIERlbGVnYXRlcyB0byAqKkVDTUFTY3JpcHQgNSoqJ3MgbmF0aXZlIGBzb21lYCBpZiBhdmFpbGFibGUuCiAgLy8gQWxpYXNlZCBhcyBgYW55YC4KICB2YXIgYW55ID0gXy5zb21lID0gXy5hbnkgPSBmdW5jdGlvbihvYmosIHByZWRpY2F0ZSwgY29udGV4dCkgewogICAgcHJlZGljYXRlIHx8IChwcmVkaWNhdGUgPSBfLmlkZW50aXR5KTsKICAgIHZhciByZXN1bHQgPSBmYWxzZTsKICAgIGlmIChvYmogPT0gbnVsbCkgcmV0dXJuIHJlc3VsdDsKICAgIGlmIChuYXRpdmVTb21lICYmIG9iai5zb21lID09PSBuYXRpdmVTb21lKSByZXR1cm4gb2JqLnNvbWUocHJlZGljYXRlLCBjb250ZXh0KTsKICAgIGVhY2gob2JqLCBmdW5jdGlvbih2YWx1ZSwgaW5kZXgsIGxpc3QpIHsKICAgICAgaWYgKHJlc3VsdCB8fCAocmVzdWx0ID0gcHJlZGljYXRlLmNhbGwoY29udGV4dCwgdmFsdWUsIGluZGV4LCBsaXN0KSkpIHJldHVybiBicmVha2VyOwogICAgfSk7CiAgICByZXR1cm4gISFyZXN1bHQ7CiAgfTsKCiAgLy8gRGV0ZXJtaW5lIGlmIHRoZSBhcnJheSBvciBvYmplY3QgY29udGFpbnMgYSBnaXZlbiB2YWx1ZSAodXNpbmcgYD09PWApLgogIC8vIEFsaWFzZWQgYXMgYGluY2x1ZGVgLgogIF8uY29udGFpbnMgPSBfLmluY2x1ZGUgPSBmdW5jdGlvbihvYmosIHRhcmdldCkgewogICAgaWYgKG9iaiA9PSBudWxsKSByZXR1cm4gZmFsc2U7CiAgICBpZiAobmF0aXZlSW5kZXhPZiAmJiBvYmouaW5kZXhPZiA9PT0gbmF0aXZlSW5kZXhPZikgcmV0dXJuIG9iai5pbmRleE9mKHRhcmdldCkgIT0gLTE7CiAgICByZXR1cm4gYW55KG9iaiwgZnVuY3Rpb24odmFsdWUpIHsKICAgICAgcmV0dXJuIHZhbHVlID09PSB0YXJnZXQ7CiAgICB9KTsKICB9OwoKICAvLyBJbnZva2UgYSBtZXRob2QgKHdpdGggYXJndW1lbnRzKSBvbiBldmVyeSBpdGVtIGluIGEgY29sbGVjdGlvbi4KICBfLmludm9rZSA9IGZ1bmN0aW9uKG9iaiwgbWV0aG9kKSB7CiAgICB2YXIgYXJncyA9IHNsaWNlLmNhbGwoYXJndW1lbnRzLCAyKTsKICAgIHZhciBpc0Z1bmMgPSBfLmlzRnVuY3Rpb24obWV0aG9kKTsKICAgIHJldHVybiBfLm1hcChvYmosIGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgIHJldHVybiAoaXNGdW5jID8gbWV0aG9kIDogdmFsdWVbbWV0aG9kXSkuYXBwbHkodmFsdWUsIGFyZ3MpOwogICAgfSk7CiAgfTsKCiAgLy8gQ29udmVuaWVuY2UgdmVyc2lvbiBvZiBhIGNvbW1vbiB1c2UgY2FzZSBvZiBgbWFwYDogZmV0Y2hpbmcgYSBwcm9wZXJ0eS4KICBfLnBsdWNrID0gZnVuY3Rpb24ob2JqLCBrZXkpIHsKICAgIHJldHVybiBfLm1hcChvYmosIF8ucHJvcGVydHkoa2V5KSk7CiAgfTsKCiAgLy8gQ29udmVuaWVuY2UgdmVyc2lvbiBvZiBhIGNvbW1vbiB1c2UgY2FzZSBvZiBgZmlsdGVyYDogc2VsZWN0aW5nIG9ubHkgb2JqZWN0cwogIC8vIGNvbnRhaW5pbmcgc3BlY2lmaWMgYGtleTp2YWx1ZWAgcGFpcnMuCiAgXy53aGVyZSA9IGZ1bmN0aW9uKG9iaiwgYXR0cnMpIHsKICAgIHJldHVybiBfLmZpbHRlcihvYmosIF8ubWF0Y2hlcyhhdHRycykpOwogIH07CgogIC8vIENvbnZlbmllbmNlIHZlcnNpb24gb2YgYSBjb21tb24gdXNlIGNhc2Ugb2YgYGZpbmRgOiBnZXR0aW5nIHRoZSBmaXJzdCBvYmplY3QKICAvLyBjb250YWluaW5nIHNwZWNpZmljIGBrZXk6dmFsdWVgIHBhaXJzLgogIF8uZmluZFdoZXJlID0gZnVuY3Rpb24ob2JqLCBhdHRycykgewogICAgcmV0dXJuIF8uZmluZChvYmosIF8ubWF0Y2hlcyhhdHRycykpOwogIH07CgogIC8vIFJldHVybiB0aGUgbWF4aW11bSBlbGVtZW50IG9yIChlbGVtZW50LWJhc2VkIGNvbXB1dGF0aW9uKS4KICAvLyBDYW4ndCBvcHRpbWl6ZSBhcnJheXMgb2YgaW50ZWdlcnMgbG9uZ2VyIHRoYW4gNjUsNTM1IGVsZW1lbnRzLgogIC8vIFNlZSBbV2ViS2l0IEJ1ZyA4MDc5N10oaHR0cHM6Ly9idWdzLndlYmtpdC5vcmcvc2hvd19idWcuY2dpP2lkPTgwNzk3KQogIF8ubWF4ID0gZnVuY3Rpb24ob2JqLCBpdGVyYXRvciwgY29udGV4dCkgewogICAgaWYgKCFpdGVyYXRvciAmJiBfLmlzQXJyYXkob2JqKSAmJiBvYmpbMF0gPT09ICtvYmpbMF0gJiYgb2JqLmxlbmd0aCA8IDY1NTM1KSB7CiAgICAgIHJldHVybiBNYXRoLm1heC5hcHBseShNYXRoLCBvYmopOwogICAgfQogICAgdmFyIHJlc3VsdCA9IC1JbmZpbml0eSwgbGFzdENvbXB1dGVkID0gLUluZmluaXR5OwogICAgZWFjaChvYmosIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCwgbGlzdCkgewogICAgICB2YXIgY29tcHV0ZWQgPSBpdGVyYXRvciA/IGl0ZXJhdG9yLmNhbGwoY29udGV4dCwgdmFsdWUsIGluZGV4LCBsaXN0KSA6IHZhbHVlOwogICAgICBpZiAoY29tcHV0ZWQgPiBsYXN0Q29tcHV0ZWQpIHsKICAgICAgICByZXN1bHQgPSB2YWx1ZTsKICAgICAgICBsYXN0Q29tcHV0ZWQgPSBjb21wdXRlZDsKICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gcmVzdWx0OwogIH07CgogIC8vIFJldHVybiB0aGUgbWluaW11bSBlbGVtZW50IChvciBlbGVtZW50LWJhc2VkIGNvbXB1dGF0aW9uKS4KICBfLm1pbiA9IGZ1bmN0aW9uKG9iaiwgaXRlcmF0b3IsIGNvbnRleHQpIHsKICAgIGlmICghaXRlcmF0b3IgJiYgXy5pc0FycmF5KG9iaikgJiYgb2JqWzBdID09PSArb2JqWzBdICYmIG9iai5sZW5ndGggPCA2NTUzNSkgewogICAgICByZXR1cm4gTWF0aC5taW4uYXBwbHkoTWF0aCwgb2JqKTsKICAgIH0KICAgIHZhciByZXN1bHQgPSBJbmZpbml0eSwgbGFzdENvbXB1dGVkID0gSW5maW5pdHk7CiAgICBlYWNoKG9iaiwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBsaXN0KSB7CiAgICAgIHZhciBjb21wdXRlZCA9IGl0ZXJhdG9yID8gaXRlcmF0b3IuY2FsbChjb250ZXh0LCB2YWx1ZSwgaW5kZXgsIGxpc3QpIDogdmFsdWU7CiAgICAgIGlmIChjb21wdXRlZCA8IGxhc3RDb21wdXRlZCkgewogICAgICAgIHJlc3VsdCA9IHZhbHVlOwogICAgICAgIGxhc3RDb21wdXRlZCA9IGNvbXB1dGVkOwogICAgICB9CiAgICB9KTsKICAgIHJldHVybiByZXN1bHQ7CiAgfTsKCiAgLy8gU2h1ZmZsZSBhbiBhcnJheSwgdXNpbmcgdGhlIG1vZGVybiB2ZXJzaW9uIG9mIHRoZQogIC8vIFtGaXNoZXItWWF0ZXMgc2h1ZmZsZV0oaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9GaXNoZXLigJNZYXRlc19zaHVmZmxlKS4KICBfLnNodWZmbGUgPSBmdW5jdGlvbihvYmopIHsKICAgIHZhciByYW5kOwogICAgdmFyIGluZGV4ID0gMDsKICAgIHZhciBzaHVmZmxlZCA9IFtdOwogICAgZWFjaChvYmosIGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgIHJhbmQgPSBfLnJhbmRvbShpbmRleCsrKTsKICAgICAgc2h1ZmZsZWRbaW5kZXggLSAxXSA9IHNodWZmbGVkW3JhbmRdOwogICAgICBzaHVmZmxlZFtyYW5kXSA9IHZhbHVlOwogICAgfSk7CiAgICByZXR1cm4gc2h1ZmZsZWQ7CiAgfTsKCiAgLy8gU2FtcGxlICoqbioqIHJhbmRvbSB2YWx1ZXMgZnJvbSBhIGNvbGxlY3Rpb24uCiAgLy8gSWYgKipuKiogaXMgbm90IHNwZWNpZmllZCwgcmV0dXJucyBhIHNpbmdsZSByYW5kb20gZWxlbWVudC4KICAvLyBUaGUgaW50ZXJuYWwgYGd1YXJkYCBhcmd1bWVudCBhbGxvd3MgaXQgdG8gd29yayB3aXRoIGBtYXBgLgogIF8uc2FtcGxlID0gZnVuY3Rpb24ob2JqLCBuLCBndWFyZCkgewogICAgaWYgKG4gPT0gbnVsbCB8fCBndWFyZCkgewogICAgICBpZiAob2JqLmxlbmd0aCAhPT0gK29iai5sZW5ndGgpIG9iaiA9IF8udmFsdWVzKG9iaik7CiAgICAgIHJldHVybiBvYmpbXy5yYW5kb20ob2JqLmxlbmd0aCAtIDEpXTsKICAgIH0KICAgIHJldHVybiBfLnNodWZmbGUob2JqKS5zbGljZSgwLCBNYXRoLm1heCgwLCBuKSk7CiAgfTsKCiAgLy8gQW4gaW50ZXJuYWwgZnVuY3Rpb24gdG8gZ2VuZXJhdGUgbG9va3VwIGl0ZXJhdG9ycy4KICB2YXIgbG9va3VwSXRlcmF0b3IgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgaWYgKHZhbHVlID09IG51bGwpIHJldHVybiBfLmlkZW50aXR5OwogICAgaWYgKF8uaXNGdW5jdGlvbih2YWx1ZSkpIHJldHVybiB2YWx1ZTsKICAgIHJldHVybiBfLnByb3BlcnR5KHZhbHVlKTsKICB9OwoKICAvLyBTb3J0IHRoZSBvYmplY3QncyB2YWx1ZXMgYnkgYSBjcml0ZXJpb24gcHJvZHVjZWQgYnkgYW4gaXRlcmF0b3IuCiAgXy5zb3J0QnkgPSBmdW5jdGlvbihvYmosIGl0ZXJhdG9yLCBjb250ZXh0KSB7CiAgICBpdGVyYXRvciA9IGxvb2t1cEl0ZXJhdG9yKGl0ZXJhdG9yKTsKICAgIHJldHVybiBfLnBsdWNrKF8ubWFwKG9iaiwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBsaXN0KSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgdmFsdWU6IHZhbHVlLAogICAgICAgIGluZGV4OiBpbmRleCwKICAgICAgICBjcml0ZXJpYTogaXRlcmF0b3IuY2FsbChjb250ZXh0LCB2YWx1ZSwgaW5kZXgsIGxpc3QpCiAgICAgIH07CiAgICB9KS5zb3J0KGZ1bmN0aW9uKGxlZnQsIHJpZ2h0KSB7CiAgICAgIHZhciBhID0gbGVmdC5jcml0ZXJpYTsKICAgICAgdmFyIGIgPSByaWdodC5jcml0ZXJpYTsKICAgICAgaWYgKGEgIT09IGIpIHsKICAgICAgICBpZiAoYSA+IGIgfHwgYSA9PT0gdm9pZCAwKSByZXR1cm4gMTsKICAgICAgICBpZiAoYSA8IGIgfHwgYiA9PT0gdm9pZCAwKSByZXR1cm4gLTE7CiAgICAgIH0KICAgICAgcmV0dXJuIGxlZnQuaW5kZXggLSByaWdodC5pbmRleDsKICAgIH0pLCAndmFsdWUnKTsKICB9OwoKICAvLyBBbiBpbnRlcm5hbCBmdW5jdGlvbiB1c2VkIGZvciBhZ2dyZWdhdGUgImdyb3VwIGJ5IiBvcGVyYXRpb25zLgogIHZhciBncm91cCA9IGZ1bmN0aW9uKGJlaGF2aW9yKSB7CiAgICByZXR1cm4gZnVuY3Rpb24ob2JqLCBpdGVyYXRvciwgY29udGV4dCkgewogICAgICB2YXIgcmVzdWx0ID0ge307CiAgICAgIGl0ZXJhdG9yID0gbG9va3VwSXRlcmF0b3IoaXRlcmF0b3IpOwogICAgICBlYWNoKG9iaiwgZnVuY3Rpb24odmFsdWUsIGluZGV4KSB7CiAgICAgICAgdmFyIGtleSA9IGl0ZXJhdG9yLmNhbGwoY29udGV4dCwgdmFsdWUsIGluZGV4LCBvYmopOwogICAgICAgIGJlaGF2aW9yKHJlc3VsdCwga2V5LCB2YWx1ZSk7CiAgICAgIH0pOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfTsKICB9OwoKICAvLyBHcm91cHMgdGhlIG9iamVjdCdzIHZhbHVlcyBieSBhIGNyaXRlcmlvbi4gUGFzcyBlaXRoZXIgYSBzdHJpbmcgYXR0cmlidXRlCiAgLy8gdG8gZ3JvdXAgYnksIG9yIGEgZnVuY3Rpb24gdGhhdCByZXR1cm5zIHRoZSBjcml0ZXJpb24uCiAgXy5ncm91cEJ5ID0gZ3JvdXAoZnVuY3Rpb24ocmVzdWx0LCBrZXksIHZhbHVlKSB7CiAgICBfLmhhcyhyZXN1bHQsIGtleSkgPyByZXN1bHRba2V5XS5wdXNoKHZhbHVlKSA6IHJlc3VsdFtrZXldID0gW3ZhbHVlXTsKICB9KTsKCiAgLy8gSW5kZXhlcyB0aGUgb2JqZWN0J3MgdmFsdWVzIGJ5IGEgY3JpdGVyaW9uLCBzaW1pbGFyIHRvIGBncm91cEJ5YCwgYnV0IGZvcgogIC8vIHdoZW4geW91IGtub3cgdGhhdCB5b3VyIGluZGV4IHZhbHVlcyB3aWxsIGJlIHVuaXF1ZS4KICBfLmluZGV4QnkgPSBncm91cChmdW5jdGlvbihyZXN1bHQsIGtleSwgdmFsdWUpIHsKICAgIHJlc3VsdFtrZXldID0gdmFsdWU7CiAgfSk7CgogIC8vIENvdW50cyBpbnN0YW5jZXMgb2YgYW4gb2JqZWN0IHRoYXQgZ3JvdXAgYnkgYSBjZXJ0YWluIGNyaXRlcmlvbi4gUGFzcwogIC8vIGVpdGhlciBhIHN0cmluZyBhdHRyaWJ1dGUgdG8gY291bnQgYnksIG9yIGEgZnVuY3Rpb24gdGhhdCByZXR1cm5zIHRoZQogIC8vIGNyaXRlcmlvbi4KICBfLmNvdW50QnkgPSBncm91cChmdW5jdGlvbihyZXN1bHQsIGtleSkgewogICAgXy5oYXMocmVzdWx0LCBrZXkpID8gcmVzdWx0W2tleV0rKyA6IHJlc3VsdFtrZXldID0gMTsKICB9KTsKCiAgLy8gVXNlIGEgY29tcGFyYXRvciBmdW5jdGlvbiB0byBmaWd1cmUgb3V0IHRoZSBzbWFsbGVzdCBpbmRleCBhdCB3aGljaAogIC8vIGFuIG9iamVjdCBzaG91bGQgYmUgaW5zZXJ0ZWQgc28gYXMgdG8gbWFpbnRhaW4gb3JkZXIuIFVzZXMgYmluYXJ5IHNlYXJjaC4KICBfLnNvcnRlZEluZGV4ID0gZnVuY3Rpb24oYXJyYXksIG9iaiwgaXRlcmF0b3IsIGNvbnRleHQpIHsKICAgIGl0ZXJhdG9yID0gbG9va3VwSXRlcmF0b3IoaXRlcmF0b3IpOwogICAgdmFyIHZhbHVlID0gaXRlcmF0b3IuY2FsbChjb250ZXh0LCBvYmopOwogICAgdmFyIGxvdyA9IDAsIGhpZ2ggPSBhcnJheS5sZW5ndGg7CiAgICB3aGlsZSAobG93IDwgaGlnaCkgewogICAgICB2YXIgbWlkID0gKGxvdyArIGhpZ2gpID4+PiAxOwogICAgICBpdGVyYXRvci5jYWxsKGNvbnRleHQsIGFycmF5W21pZF0pIDwgdmFsdWUgPyBsb3cgPSBtaWQgKyAxIDogaGlnaCA9IG1pZDsKICAgIH0KICAgIHJldHVybiBsb3c7CiAgfTsKCiAgLy8gU2FmZWx5IGNyZWF0ZSBhIHJlYWwsIGxpdmUgYXJyYXkgZnJvbSBhbnl0aGluZyBpdGVyYWJsZS4KICBfLnRvQXJyYXkgPSBmdW5jdGlvbihvYmopIHsKICAgIGlmICghb2JqKSByZXR1cm4gW107CiAgICBpZiAoXy5pc0FycmF5KG9iaikpIHJldHVybiBzbGljZS5jYWxsKG9iaik7CiAgICBpZiAob2JqLmxlbmd0aCA9PT0gK29iai5sZW5ndGgpIHJldHVybiBfLm1hcChvYmosIF8uaWRlbnRpdHkpOwogICAgcmV0dXJuIF8udmFsdWVzKG9iaik7CiAgfTsKCiAgLy8gUmV0dXJuIHRoZSBudW1iZXIgb2YgZWxlbWVudHMgaW4gYW4gb2JqZWN0LgogIF8uc2l6ZSA9IGZ1bmN0aW9uKG9iaikgewogICAgaWYgKG9iaiA9PSBudWxsKSByZXR1cm4gMDsKICAgIHJldHVybiAob2JqLmxlbmd0aCA9PT0gK29iai5sZW5ndGgpID8gb2JqLmxlbmd0aCA6IF8ua2V5cyhvYmopLmxlbmd0aDsKICB9OwoKICAvLyBBcnJheSBGdW5jdGlvbnMKICAvLyAtLS0tLS0tLS0tLS0tLS0KCiAgLy8gR2V0IHRoZSBmaXJzdCBlbGVtZW50IG9mIGFuIGFycmF5LiBQYXNzaW5nICoqbioqIHdpbGwgcmV0dXJuIHRoZSBmaXJzdCBOCiAgLy8gdmFsdWVzIGluIHRoZSBhcnJheS4gQWxpYXNlZCBhcyBgaGVhZGAgYW5kIGB0YWtlYC4gVGhlICoqZ3VhcmQqKiBjaGVjawogIC8vIGFsbG93cyBpdCB0byB3b3JrIHdpdGggYF8ubWFwYC4KICBfLmZpcnN0ID0gXy5oZWFkID0gXy50YWtlID0gZnVuY3Rpb24oYXJyYXksIG4sIGd1YXJkKSB7CiAgICBpZiAoYXJyYXkgPT0gbnVsbCkgcmV0dXJuIHZvaWQgMDsKICAgIGlmICgobiA9PSBudWxsKSB8fCBndWFyZCkgcmV0dXJuIGFycmF5WzBdOwogICAgaWYgKG4gPCAwKSByZXR1cm4gW107CiAgICByZXR1cm4gc2xpY2UuY2FsbChhcnJheSwgMCwgbik7CiAgfTsKCiAgLy8gUmV0dXJucyBldmVyeXRoaW5nIGJ1dCB0aGUgbGFzdCBlbnRyeSBvZiB0aGUgYXJyYXkuIEVzcGVjaWFsbHkgdXNlZnVsIG9uCiAgLy8gdGhlIGFyZ3VtZW50cyBvYmplY3QuIFBhc3NpbmcgKipuKiogd2lsbCByZXR1cm4gYWxsIHRoZSB2YWx1ZXMgaW4KICAvLyB0aGUgYXJyYXksIGV4Y2x1ZGluZyB0aGUgbGFzdCBOLiBUaGUgKipndWFyZCoqIGNoZWNrIGFsbG93cyBpdCB0byB3b3JrIHdpdGgKICAvLyBgXy5tYXBgLgogIF8uaW5pdGlhbCA9IGZ1bmN0aW9uKGFycmF5LCBuLCBndWFyZCkgewogICAgcmV0dXJuIHNsaWNlLmNhbGwoYXJyYXksIDAsIGFycmF5Lmxlbmd0aCAtICgobiA9PSBudWxsKSB8fCBndWFyZCA/IDEgOiBuKSk7CiAgfTsKCiAgLy8gR2V0IHRoZSBsYXN0IGVsZW1lbnQgb2YgYW4gYXJyYXkuIFBhc3NpbmcgKipuKiogd2lsbCByZXR1cm4gdGhlIGxhc3QgTgogIC8vIHZhbHVlcyBpbiB0aGUgYXJyYXkuIFRoZSAqKmd1YXJkKiogY2hlY2sgYWxsb3dzIGl0IHRvIHdvcmsgd2l0aCBgXy5tYXBgLgogIF8ubGFzdCA9IGZ1bmN0aW9uKGFycmF5LCBuLCBndWFyZCkgewogICAgaWYgKGFycmF5ID09IG51bGwpIHJldHVybiB2b2lkIDA7CiAgICBpZiAoKG4gPT0gbnVsbCkgfHwgZ3VhcmQpIHJldHVybiBhcnJheVthcnJheS5sZW5ndGggLSAxXTsKICAgIHJldHVybiBzbGljZS5jYWxsKGFycmF5LCBNYXRoLm1heChhcnJheS5sZW5ndGggLSBuLCAwKSk7CiAgfTsKCiAgLy8gUmV0dXJucyBldmVyeXRoaW5nIGJ1dCB0aGUgZmlyc3QgZW50cnkgb2YgdGhlIGFycmF5LiBBbGlhc2VkIGFzIGB0YWlsYCBhbmQgYGRyb3BgLgogIC8vIEVzcGVjaWFsbHkgdXNlZnVsIG9uIHRoZSBhcmd1bWVudHMgb2JqZWN0LiBQYXNzaW5nIGFuICoqbioqIHdpbGwgcmV0dXJuCiAgLy8gdGhlIHJlc3QgTiB2YWx1ZXMgaW4gdGhlIGFycmF5LiBUaGUgKipndWFyZCoqCiAgLy8gY2hlY2sgYWxsb3dzIGl0IHRvIHdvcmsgd2l0aCBgXy5tYXBgLgogIF8ucmVzdCA9IF8udGFpbCA9IF8uZHJvcCA9IGZ1bmN0aW9uKGFycmF5LCBuLCBndWFyZCkgewogICAgcmV0dXJuIHNsaWNlLmNhbGwoYXJyYXksIChuID09IG51bGwpIHx8IGd1YXJkID8gMSA6IG4pOwogIH07CgogIC8vIFRyaW0gb3V0IGFsbCBmYWxzeSB2YWx1ZXMgZnJvbSBhbiBhcnJheS4KICBfLmNvbXBhY3QgPSBmdW5jdGlvbihhcnJheSkgewogICAgcmV0dXJuIF8uZmlsdGVyKGFycmF5LCBfLmlkZW50aXR5KTsKICB9OwoKICAvLyBJbnRlcm5hbCBpbXBsZW1lbnRhdGlvbiBvZiBhIHJlY3Vyc2l2ZSBgZmxhdHRlbmAgZnVuY3Rpb24uCiAgdmFyIGZsYXR0ZW4gPSBmdW5jdGlvbihpbnB1dCwgc2hhbGxvdywgb3V0cHV0KSB7CiAgICBpZiAoc2hhbGxvdyAmJiBfLmV2ZXJ5KGlucHV0LCBfLmlzQXJyYXkpKSB7CiAgICAgIHJldHVybiBjb25jYXQuYXBwbHkob3V0cHV0LCBpbnB1dCk7CiAgICB9CiAgICBlYWNoKGlucHV0LCBmdW5jdGlvbih2YWx1ZSkgewogICAgICBpZiAoXy5pc0FycmF5KHZhbHVlKSB8fCBfLmlzQXJndW1lbnRzKHZhbHVlKSkgewogICAgICAgIHNoYWxsb3cgPyBwdXNoLmFwcGx5KG91dHB1dCwgdmFsdWUpIDogZmxhdHRlbih2YWx1ZSwgc2hhbGxvdywgb3V0cHV0KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBvdXRwdXQucHVzaCh2YWx1ZSk7CiAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIG91dHB1dDsKICB9OwoKICAvLyBGbGF0dGVuIG91dCBhbiBhcnJheSwgZWl0aGVyIHJlY3Vyc2l2ZWx5IChieSBkZWZhdWx0KSwgb3IganVzdCBvbmUgbGV2ZWwuCiAgXy5mbGF0dGVuID0gZnVuY3Rpb24oYXJyYXksIHNoYWxsb3cpIHsKICAgIHJldHVybiBmbGF0dGVuKGFycmF5LCBzaGFsbG93LCBbXSk7CiAgfTsKCiAgLy8gUmV0dXJuIGEgdmVyc2lvbiBvZiB0aGUgYXJyYXkgdGhhdCBkb2VzIG5vdCBjb250YWluIHRoZSBzcGVjaWZpZWQgdmFsdWUocykuCiAgXy53aXRob3V0ID0gZnVuY3Rpb24oYXJyYXkpIHsKICAgIHJldHVybiBfLmRpZmZlcmVuY2UoYXJyYXksIHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSk7CiAgfTsKCiAgLy8gU3BsaXQgYW4gYXJyYXkgaW50byB0d28gYXJyYXlzOiBvbmUgd2hvc2UgZWxlbWVudHMgYWxsIHNhdGlzZnkgdGhlIGdpdmVuCiAgLy8gcHJlZGljYXRlLCBhbmQgb25lIHdob3NlIGVsZW1lbnRzIGFsbCBkbyBub3Qgc2F0aXNmeSB0aGUgcHJlZGljYXRlLgogIF8ucGFydGl0aW9uID0gZnVuY3Rpb24oYXJyYXksIHByZWRpY2F0ZSkgewogICAgdmFyIHBhc3MgPSBbXSwgZmFpbCA9IFtdOwogICAgZWFjaChhcnJheSwgZnVuY3Rpb24oZWxlbSkgewogICAgICAocHJlZGljYXRlKGVsZW0pID8gcGFzcyA6IGZhaWwpLnB1c2goZWxlbSk7CiAgICB9KTsKICAgIHJldHVybiBbcGFzcywgZmFpbF07CiAgfTsKCiAgLy8gUHJvZHVjZSBhIGR1cGxpY2F0ZS1mcmVlIHZlcnNpb24gb2YgdGhlIGFycmF5LiBJZiB0aGUgYXJyYXkgaGFzIGFscmVhZHkKICAvLyBiZWVuIHNvcnRlZCwgeW91IGhhdmUgdGhlIG9wdGlvbiBvZiB1c2luZyBhIGZhc3RlciBhbGdvcml0aG0uCiAgLy8gQWxpYXNlZCBhcyBgdW5pcXVlYC4KICBfLnVuaXEgPSBfLnVuaXF1ZSA9IGZ1bmN0aW9uKGFycmF5LCBpc1NvcnRlZCwgaXRlcmF0b3IsIGNvbnRleHQpIHsKICAgIGlmIChfLmlzRnVuY3Rpb24oaXNTb3J0ZWQpKSB7CiAgICAgIGNvbnRleHQgPSBpdGVyYXRvcjsKICAgICAgaXRlcmF0b3IgPSBpc1NvcnRlZDsKICAgICAgaXNTb3J0ZWQgPSBmYWxzZTsKICAgIH0KICAgIHZhciBpbml0aWFsID0gaXRlcmF0b3IgPyBfLm1hcChhcnJheSwgaXRlcmF0b3IsIGNvbnRleHQpIDogYXJyYXk7CiAgICB2YXIgcmVzdWx0cyA9IFtdOwogICAgdmFyIHNlZW4gPSBbXTsKICAgIGVhY2goaW5pdGlhbCwgZnVuY3Rpb24odmFsdWUsIGluZGV4KSB7CiAgICAgIGlmIChpc1NvcnRlZCA/ICghaW5kZXggfHwgc2VlbltzZWVuLmxlbmd0aCAtIDFdICE9PSB2YWx1ZSkgOiAhXy5jb250YWlucyhzZWVuLCB2YWx1ZSkpIHsKICAgICAgICBzZWVuLnB1c2godmFsdWUpOwogICAgICAgIHJlc3VsdHMucHVzaChhcnJheVtpbmRleF0pOwogICAgICB9CiAgICB9KTsKICAgIHJldHVybiByZXN1bHRzOwogIH07CgogIC8vIFByb2R1Y2UgYW4gYXJyYXkgdGhhdCBjb250YWlucyB0aGUgdW5pb246IGVhY2ggZGlzdGluY3QgZWxlbWVudCBmcm9tIGFsbCBvZgogIC8vIHRoZSBwYXNzZWQtaW4gYXJyYXlzLgogIF8udW5pb24gPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiBfLnVuaXEoXy5mbGF0dGVuKGFyZ3VtZW50cywgdHJ1ZSkpOwogIH07CgogIC8vIFByb2R1Y2UgYW4gYXJyYXkgdGhhdCBjb250YWlucyBldmVyeSBpdGVtIHNoYXJlZCBiZXR3ZWVuIGFsbCB0aGUKICAvLyBwYXNzZWQtaW4gYXJyYXlzLgogIF8uaW50ZXJzZWN0aW9uID0gZnVuY3Rpb24oYXJyYXkpIHsKICAgIHZhciByZXN0ID0gc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpOwogICAgcmV0dXJuIF8uZmlsdGVyKF8udW5pcShhcnJheSksIGZ1bmN0aW9uKGl0ZW0pIHsKICAgICAgcmV0dXJuIF8uZXZlcnkocmVzdCwgZnVuY3Rpb24ob3RoZXIpIHsKICAgICAgICByZXR1cm4gXy5jb250YWlucyhvdGhlciwgaXRlbSk7CiAgICAgIH0pOwogICAgfSk7CiAgfTsKCiAgLy8gVGFrZSB0aGUgZGlmZmVyZW5jZSBiZXR3ZWVuIG9uZSBhcnJheSBhbmQgYSBudW1iZXIgb2Ygb3RoZXIgYXJyYXlzLgogIC8vIE9ubHkgdGhlIGVsZW1lbnRzIHByZXNlbnQgaW4ganVzdCB0aGUgZmlyc3QgYXJyYXkgd2lsbCByZW1haW4uCiAgXy5kaWZmZXJlbmNlID0gZnVuY3Rpb24oYXJyYXkpIHsKICAgIHZhciByZXN0ID0gY29uY2F0LmFwcGx5KEFycmF5UHJvdG8sIHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSk7CiAgICByZXR1cm4gXy5maWx0ZXIoYXJyYXksIGZ1bmN0aW9uKHZhbHVlKXsgcmV0dXJuICFfLmNvbnRhaW5zKHJlc3QsIHZhbHVlKTsgfSk7CiAgfTsKCiAgLy8gWmlwIHRvZ2V0aGVyIG11bHRpcGxlIGxpc3RzIGludG8gYSBzaW5nbGUgYXJyYXkgLS0gZWxlbWVudHMgdGhhdCBzaGFyZQogIC8vIGFuIGluZGV4IGdvIHRvZ2V0aGVyLgogIF8uemlwID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgbGVuZ3RoID0gXy5tYXgoXy5wbHVjayhhcmd1bWVudHMsICdsZW5ndGgnKS5jb25jYXQoMCkpOwogICAgdmFyIHJlc3VsdHMgPSBuZXcgQXJyYXkobGVuZ3RoKTsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgcmVzdWx0c1tpXSA9IF8ucGx1Y2soYXJndW1lbnRzLCAnJyArIGkpOwogICAgfQogICAgcmV0dXJuIHJlc3VsdHM7CiAgfTsKCiAgLy8gQ29udmVydHMgbGlzdHMgaW50byBvYmplY3RzLiBQYXNzIGVpdGhlciBhIHNpbmdsZSBhcnJheSBvZiBgW2tleSwgdmFsdWVdYAogIC8vIHBhaXJzLCBvciB0d28gcGFyYWxsZWwgYXJyYXlzIG9mIHRoZSBzYW1lIGxlbmd0aCAtLSBvbmUgb2Yga2V5cywgYW5kIG9uZSBvZgogIC8vIHRoZSBjb3JyZXNwb25kaW5nIHZhbHVlcy4KICBfLm9iamVjdCA9IGZ1bmN0aW9uKGxpc3QsIHZhbHVlcykgewogICAgaWYgKGxpc3QgPT0gbnVsbCkgcmV0dXJuIHt9OwogICAgdmFyIHJlc3VsdCA9IHt9OwogICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IGxpc3QubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgaWYgKHZhbHVlcykgewogICAgICAgIHJlc3VsdFtsaXN0W2ldXSA9IHZhbHVlc1tpXTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXN1bHRbbGlzdFtpXVswXV0gPSBsaXN0W2ldWzFdOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gcmVzdWx0OwogIH07CgogIC8vIElmIHRoZSBicm93c2VyIGRvZXNuJ3Qgc3VwcGx5IHVzIHdpdGggaW5kZXhPZiAoSSdtIGxvb2tpbmcgYXQgeW91LCAqKk1TSUUqKiksCiAgLy8gd2UgbmVlZCB0aGlzIGZ1bmN0aW9uLiBSZXR1cm4gdGhlIHBvc2l0aW9uIG9mIHRoZSBmaXJzdCBvY2N1cnJlbmNlIG9mIGFuCiAgLy8gaXRlbSBpbiBhbiBhcnJheSwgb3IgLTEgaWYgdGhlIGl0ZW0gaXMgbm90IGluY2x1ZGVkIGluIHRoZSBhcnJheS4KICAvLyBEZWxlZ2F0ZXMgdG8gKipFQ01BU2NyaXB0IDUqKidzIG5hdGl2ZSBgaW5kZXhPZmAgaWYgYXZhaWxhYmxlLgogIC8vIElmIHRoZSBhcnJheSBpcyBsYXJnZSBhbmQgYWxyZWFkeSBpbiBzb3J0IG9yZGVyLCBwYXNzIGB0cnVlYAogIC8vIGZvciAqKmlzU29ydGVkKiogdG8gdXNlIGJpbmFyeSBzZWFyY2guCiAgXy5pbmRleE9mID0gZnVuY3Rpb24oYXJyYXksIGl0ZW0sIGlzU29ydGVkKSB7CiAgICBpZiAoYXJyYXkgPT0gbnVsbCkgcmV0dXJuIC0xOwogICAgdmFyIGkgPSAwLCBsZW5ndGggPSBhcnJheS5sZW5ndGg7CiAgICBpZiAoaXNTb3J0ZWQpIHsKICAgICAgaWYgKHR5cGVvZiBpc1NvcnRlZCA9PSAnbnVtYmVyJykgewogICAgICAgIGkgPSAoaXNTb3J0ZWQgPCAwID8gTWF0aC5tYXgoMCwgbGVuZ3RoICsgaXNTb3J0ZWQpIDogaXNTb3J0ZWQpOwogICAgICB9IGVsc2UgewogICAgICAgIGkgPSBfLnNvcnRlZEluZGV4KGFycmF5LCBpdGVtKTsKICAgICAgICByZXR1cm4gYXJyYXlbaV0gPT09IGl0ZW0gPyBpIDogLTE7CiAgICAgIH0KICAgIH0KICAgIGlmIChuYXRpdmVJbmRleE9mICYmIGFycmF5LmluZGV4T2YgPT09IG5hdGl2ZUluZGV4T2YpIHJldHVybiBhcnJheS5pbmRleE9mKGl0ZW0sIGlzU29ydGVkKTsKICAgIGZvciAoOyBpIDwgbGVuZ3RoOyBpKyspIGlmIChhcnJheVtpXSA9PT0gaXRlbSkgcmV0dXJuIGk7CiAgICByZXR1cm4gLTE7CiAgfTsKCiAgLy8gRGVsZWdhdGVzIHRvICoqRUNNQVNjcmlwdCA1KioncyBuYXRpdmUgYGxhc3RJbmRleE9mYCBpZiBhdmFpbGFibGUuCiAgXy5sYXN0SW5kZXhPZiA9IGZ1bmN0aW9uKGFycmF5LCBpdGVtLCBmcm9tKSB7CiAgICBpZiAoYXJyYXkgPT0gbnVsbCkgcmV0dXJuIC0xOwogICAgdmFyIGhhc0luZGV4ID0gZnJvbSAhPSBudWxsOwogICAgaWYgKG5hdGl2ZUxhc3RJbmRleE9mICYmIGFycmF5Lmxhc3RJbmRleE9mID09PSBuYXRpdmVMYXN0SW5kZXhPZikgewogICAgICByZXR1cm4gaGFzSW5kZXggPyBhcnJheS5sYXN0SW5kZXhPZihpdGVtLCBmcm9tKSA6IGFycmF5Lmxhc3RJbmRleE9mKGl0ZW0pOwogICAgfQogICAgdmFyIGkgPSAoaGFzSW5kZXggPyBmcm9tIDogYXJyYXkubGVuZ3RoKTsKICAgIHdoaWxlIChpLS0pIGlmIChhcnJheVtpXSA9PT0gaXRlbSkgcmV0dXJuIGk7CiAgICByZXR1cm4gLTE7CiAgfTsKCiAgLy8gR2VuZXJhdGUgYW4gaW50ZWdlciBBcnJheSBjb250YWluaW5nIGFuIGFyaXRobWV0aWMgcHJvZ3Jlc3Npb24uIEEgcG9ydCBvZgogIC8vIHRoZSBuYXRpdmUgUHl0aG9uIGByYW5nZSgpYCBmdW5jdGlvbi4gU2VlCiAgLy8gW3RoZSBQeXRob24gZG9jdW1lbnRhdGlvbl0oaHR0cDovL2RvY3MucHl0aG9uLm9yZy9saWJyYXJ5L2Z1bmN0aW9ucy5odG1sI3JhbmdlKS4KICBfLnJhbmdlID0gZnVuY3Rpb24oc3RhcnQsIHN0b3AsIHN0ZXApIHsKICAgIGlmIChhcmd1bWVudHMubGVuZ3RoIDw9IDEpIHsKICAgICAgc3RvcCA9IHN0YXJ0IHx8IDA7CiAgICAgIHN0YXJ0ID0gMDsKICAgIH0KICAgIHN0ZXAgPSBhcmd1bWVudHNbMl0gfHwgMTsKCiAgICB2YXIgbGVuZ3RoID0gTWF0aC5tYXgoTWF0aC5jZWlsKChzdG9wIC0gc3RhcnQpIC8gc3RlcCksIDApOwogICAgdmFyIGlkeCA9IDA7CiAgICB2YXIgcmFuZ2UgPSBuZXcgQXJyYXkobGVuZ3RoKTsKCiAgICB3aGlsZShpZHggPCBsZW5ndGgpIHsKICAgICAgcmFuZ2VbaWR4KytdID0gc3RhcnQ7CiAgICAgIHN0YXJ0ICs9IHN0ZXA7CiAgICB9CgogICAgcmV0dXJuIHJhbmdlOwogIH07CgogIC8vIEZ1bmN0aW9uIChhaGVtKSBGdW5jdGlvbnMKICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0KCiAgLy8gUmV1c2FibGUgY29uc3RydWN0b3IgZnVuY3Rpb24gZm9yIHByb3RvdHlwZSBzZXR0aW5nLgogIHZhciBjdG9yID0gZnVuY3Rpb24oKXt9OwoKICAvLyBDcmVhdGUgYSBmdW5jdGlvbiBib3VuZCB0byBhIGdpdmVuIG9iamVjdCAoYXNzaWduaW5nIGB0aGlzYCwgYW5kIGFyZ3VtZW50cywKICAvLyBvcHRpb25hbGx5KS4gRGVsZWdhdGVzIHRvICoqRUNNQVNjcmlwdCA1KioncyBuYXRpdmUgYEZ1bmN0aW9uLmJpbmRgIGlmCiAgLy8gYXZhaWxhYmxlLgogIF8uYmluZCA9IGZ1bmN0aW9uKGZ1bmMsIGNvbnRleHQpIHsKICAgIHZhciBhcmdzLCBib3VuZDsKICAgIGlmIChuYXRpdmVCaW5kICYmIGZ1bmMuYmluZCA9PT0gbmF0aXZlQmluZCkgcmV0dXJuIG5hdGl2ZUJpbmQuYXBwbHkoZnVuYywgc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpKTsKICAgIGlmICghXy5pc0Z1bmN0aW9uKGZ1bmMpKSB0aHJvdyBuZXcgVHlwZUVycm9yOwogICAgYXJncyA9IHNsaWNlLmNhbGwoYXJndW1lbnRzLCAyKTsKICAgIHJldHVybiBib3VuZCA9IGZ1bmN0aW9uKCkgewogICAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgYm91bmQpKSByZXR1cm4gZnVuYy5hcHBseShjb250ZXh0LCBhcmdzLmNvbmNhdChzbGljZS5jYWxsKGFyZ3VtZW50cykpKTsKICAgICAgY3Rvci5wcm90b3R5cGUgPSBmdW5jLnByb3RvdHlwZTsKICAgICAgdmFyIHNlbGYgPSBuZXcgY3RvcjsKICAgICAgY3Rvci5wcm90b3R5cGUgPSBudWxsOwogICAgICB2YXIgcmVzdWx0ID0gZnVuYy5hcHBseShzZWxmLCBhcmdzLmNvbmNhdChzbGljZS5jYWxsKGFyZ3VtZW50cykpKTsKICAgICAgaWYgKE9iamVjdChyZXN1bHQpID09PSByZXN1bHQpIHJldHVybiByZXN1bHQ7CiAgICAgIHJldHVybiBzZWxmOwogICAgfTsKICB9OwoKICAvLyBQYXJ0aWFsbHkgYXBwbHkgYSBmdW5jdGlvbiBieSBjcmVhdGluZyBhIHZlcnNpb24gdGhhdCBoYXMgaGFkIHNvbWUgb2YgaXRzCiAgLy8gYXJndW1lbnRzIHByZS1maWxsZWQsIHdpdGhvdXQgY2hhbmdpbmcgaXRzIGR5bmFtaWMgYHRoaXNgIGNvbnRleHQuIF8gYWN0cwogIC8vIGFzIGEgcGxhY2Vob2xkZXIsIGFsbG93aW5nIGFueSBjb21iaW5hdGlvbiBvZiBhcmd1bWVudHMgdG8gYmUgcHJlLWZpbGxlZC4KICBfLnBhcnRpYWwgPSBmdW5jdGlvbihmdW5jKSB7CiAgICB2YXIgYm91bmRBcmdzID0gc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpOwogICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICB2YXIgcG9zaXRpb24gPSAwOwogICAgICB2YXIgYXJncyA9IGJvdW5kQXJncy5zbGljZSgpOwogICAgICBmb3IgKHZhciBpID0gMCwgbGVuZ3RoID0gYXJncy5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgIGlmIChhcmdzW2ldID09PSBfKSBhcmdzW2ldID0gYXJndW1lbnRzW3Bvc2l0aW9uKytdOwogICAgICB9CiAgICAgIHdoaWxlIChwb3NpdGlvbiA8IGFyZ3VtZW50cy5sZW5ndGgpIGFyZ3MucHVzaChhcmd1bWVudHNbcG9zaXRpb24rK10pOwogICAgICByZXR1cm4gZnVuYy5hcHBseSh0aGlzLCBhcmdzKTsKICAgIH07CiAgfTsKCiAgLy8gQmluZCBhIG51bWJlciBvZiBhbiBvYmplY3QncyBtZXRob2RzIHRvIHRoYXQgb2JqZWN0LiBSZW1haW5pbmcgYXJndW1lbnRzCiAgLy8gYXJlIHRoZSBtZXRob2QgbmFtZXMgdG8gYmUgYm91bmQuIFVzZWZ1bCBmb3IgZW5zdXJpbmcgdGhhdCBhbGwgY2FsbGJhY2tzCiAgLy8gZGVmaW5lZCBvbiBhbiBvYmplY3QgYmVsb25nIHRvIGl0LgogIF8uYmluZEFsbCA9IGZ1bmN0aW9uKG9iaikgewogICAgdmFyIGZ1bmNzID0gc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpOwogICAgaWYgKGZ1bmNzLmxlbmd0aCA9PT0gMCkgdGhyb3cgbmV3IEVycm9yKCdiaW5kQWxsIG11c3QgYmUgcGFzc2VkIGZ1bmN0aW9uIG5hbWVzJyk7CiAgICBlYWNoKGZ1bmNzLCBmdW5jdGlvbihmKSB7IG9ialtmXSA9IF8uYmluZChvYmpbZl0sIG9iaik7IH0pOwogICAgcmV0dXJuIG9iajsKICB9OwoKICAvLyBNZW1vaXplIGFuIGV4cGVuc2l2ZSBmdW5jdGlvbiBieSBzdG9yaW5nIGl0cyByZXN1bHRzLgogIF8ubWVtb2l6ZSA9IGZ1bmN0aW9uKGZ1bmMsIGhhc2hlcikgewogICAgdmFyIG1lbW8gPSB7fTsKICAgIGhhc2hlciB8fCAoaGFzaGVyID0gXy5pZGVudGl0eSk7CiAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBrZXkgPSBoYXNoZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgcmV0dXJuIF8uaGFzKG1lbW8sIGtleSkgPyBtZW1vW2tleV0gOiAobWVtb1trZXldID0gZnVuYy5hcHBseSh0aGlzLCBhcmd1bWVudHMpKTsKICAgIH07CiAgfTsKCiAgLy8gRGVsYXlzIGEgZnVuY3Rpb24gZm9yIHRoZSBnaXZlbiBudW1iZXIgb2YgbWlsbGlzZWNvbmRzLCBhbmQgdGhlbiBjYWxscwogIC8vIGl0IHdpdGggdGhlIGFyZ3VtZW50cyBzdXBwbGllZC4KICBfLmRlbGF5ID0gZnVuY3Rpb24oZnVuYywgd2FpdCkgewogICAgdmFyIGFyZ3MgPSBzbGljZS5jYWxsKGFyZ3VtZW50cywgMik7CiAgICByZXR1cm4gc2V0VGltZW91dChmdW5jdGlvbigpeyByZXR1cm4gZnVuYy5hcHBseShudWxsLCBhcmdzKTsgfSwgd2FpdCk7CiAgfTsKCiAgLy8gRGVmZXJzIGEgZnVuY3Rpb24sIHNjaGVkdWxpbmcgaXQgdG8gcnVuIGFmdGVyIHRoZSBjdXJyZW50IGNhbGwgc3RhY2sgaGFzCiAgLy8gY2xlYXJlZC4KICBfLmRlZmVyID0gZnVuY3Rpb24oZnVuYykgewogICAgcmV0dXJuIF8uZGVsYXkuYXBwbHkoXywgW2Z1bmMsIDFdLmNvbmNhdChzbGljZS5jYWxsKGFyZ3VtZW50cywgMSkpKTsKICB9OwoKICAvLyBSZXR1cm5zIGEgZnVuY3Rpb24sIHRoYXQsIHdoZW4gaW52b2tlZCwgd2lsbCBvbmx5IGJlIHRyaWdnZXJlZCBhdCBtb3N0IG9uY2UKICAvLyBkdXJpbmcgYSBnaXZlbiB3aW5kb3cgb2YgdGltZS4gTm9ybWFsbHksIHRoZSB0aHJvdHRsZWQgZnVuY3Rpb24gd2lsbCBydW4KICAvLyBhcyBtdWNoIGFzIGl0IGNhbiwgd2l0aG91dCBldmVyIGdvaW5nIG1vcmUgdGhhbiBvbmNlIHBlciBgd2FpdGAgZHVyYXRpb247CiAgLy8gYnV0IGlmIHlvdSdkIGxpa2UgdG8gZGlzYWJsZSB0aGUgZXhlY3V0aW9uIG9uIHRoZSBsZWFkaW5nIGVkZ2UsIHBhc3MKICAvLyBge2xlYWRpbmc6IGZhbHNlfWAuIFRvIGRpc2FibGUgZXhlY3V0aW9uIG9uIHRoZSB0cmFpbGluZyBlZGdlLCBkaXR0by4KICBfLnRocm90dGxlID0gZnVuY3Rpb24oZnVuYywgd2FpdCwgb3B0aW9ucykgewogICAgdmFyIGNvbnRleHQsIGFyZ3MsIHJlc3VsdDsKICAgIHZhciB0aW1lb3V0ID0gbnVsbDsKICAgIHZhciBwcmV2aW91cyA9IDA7CiAgICBvcHRpb25zIHx8IChvcHRpb25zID0ge30pOwogICAgdmFyIGxhdGVyID0gZnVuY3Rpb24oKSB7CiAgICAgIHByZXZpb3VzID0gb3B0aW9ucy5sZWFkaW5nID09PSBmYWxzZSA/IDAgOiBfLm5vdygpOwogICAgICB0aW1lb3V0ID0gbnVsbDsKICAgICAgcmVzdWx0ID0gZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTsKICAgICAgY29udGV4dCA9IGFyZ3MgPSBudWxsOwogICAgfTsKICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgdmFyIG5vdyA9IF8ubm93KCk7CiAgICAgIGlmICghcHJldmlvdXMgJiYgb3B0aW9ucy5sZWFkaW5nID09PSBmYWxzZSkgcHJldmlvdXMgPSBub3c7CiAgICAgIHZhciByZW1haW5pbmcgPSB3YWl0IC0gKG5vdyAtIHByZXZpb3VzKTsKICAgICAgY29udGV4dCA9IHRoaXM7CiAgICAgIGFyZ3MgPSBhcmd1bWVudHM7CiAgICAgIGlmIChyZW1haW5pbmcgPD0gMCkgewogICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0KTsKICAgICAgICB0aW1lb3V0ID0gbnVsbDsKICAgICAgICBwcmV2aW91cyA9IG5vdzsKICAgICAgICByZXN1bHQgPSBmdW5jLmFwcGx5KGNvbnRleHQsIGFyZ3MpOwogICAgICAgIGNvbnRleHQgPSBhcmdzID0gbnVsbDsKICAgICAgfSBlbHNlIGlmICghdGltZW91dCAmJiBvcHRpb25zLnRyYWlsaW5nICE9PSBmYWxzZSkgewogICAgICAgIHRpbWVvdXQgPSBzZXRUaW1lb3V0KGxhdGVyLCByZW1haW5pbmcpOwogICAgICB9CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9OwogIH07CgogIC8vIFJldHVybnMgYSBmdW5jdGlvbiwgdGhhdCwgYXMgbG9uZyBhcyBpdCBjb250aW51ZXMgdG8gYmUgaW52b2tlZCwgd2lsbCBub3QKICAvLyBiZSB0cmlnZ2VyZWQuIFRoZSBmdW5jdGlvbiB3aWxsIGJlIGNhbGxlZCBhZnRlciBpdCBzdG9wcyBiZWluZyBjYWxsZWQgZm9yCiAgLy8gTiBtaWxsaXNlY29uZHMuIElmIGBpbW1lZGlhdGVgIGlzIHBhc3NlZCwgdHJpZ2dlciB0aGUgZnVuY3Rpb24gb24gdGhlCiAgLy8gbGVhZGluZyBlZGdlLCBpbnN0ZWFkIG9mIHRoZSB0cmFpbGluZy4KICBfLmRlYm91bmNlID0gZnVuY3Rpb24oZnVuYywgd2FpdCwgaW1tZWRpYXRlKSB7CiAgICB2YXIgdGltZW91dCwgYXJncywgY29udGV4dCwgdGltZXN0YW1wLCByZXN1bHQ7CgogICAgdmFyIGxhdGVyID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBsYXN0ID0gXy5ub3coKSAtIHRpbWVzdGFtcDsKICAgICAgaWYgKGxhc3QgPCB3YWl0KSB7CiAgICAgICAgdGltZW91dCA9IHNldFRpbWVvdXQobGF0ZXIsIHdhaXQgLSBsYXN0KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aW1lb3V0ID0gbnVsbDsKICAgICAgICBpZiAoIWltbWVkaWF0ZSkgewogICAgICAgICAgcmVzdWx0ID0gZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTsKICAgICAgICAgIGNvbnRleHQgPSBhcmdzID0gbnVsbDsKICAgICAgICB9CiAgICAgIH0KICAgIH07CgogICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICBjb250ZXh0ID0gdGhpczsKICAgICAgYXJncyA9IGFyZ3VtZW50czsKICAgICAgdGltZXN0YW1wID0gXy5ub3coKTsKICAgICAgdmFyIGNhbGxOb3cgPSBpbW1lZGlhdGUgJiYgIXRpbWVvdXQ7CiAgICAgIGlmICghdGltZW91dCkgewogICAgICAgIHRpbWVvdXQgPSBzZXRUaW1lb3V0KGxhdGVyLCB3YWl0KTsKICAgICAgfQogICAgICBpZiAoY2FsbE5vdykgewogICAgICAgIHJlc3VsdCA9IGZ1bmMuYXBwbHkoY29udGV4dCwgYXJncyk7CiAgICAgICAgY29udGV4dCA9IGFyZ3MgPSBudWxsOwogICAgICB9CgogICAgICByZXR1cm4gcmVzdWx0OwogICAgfTsKICB9OwoKICAvLyBSZXR1cm5zIGEgZnVuY3Rpb24gdGhhdCB3aWxsIGJlIGV4ZWN1dGVkIGF0IG1vc3Qgb25lIHRpbWUsIG5vIG1hdHRlciBob3cKICAvLyBvZnRlbiB5b3UgY2FsbCBpdC4gVXNlZnVsIGZvciBsYXp5IGluaXRpYWxpemF0aW9uLgogIF8ub25jZSA9IGZ1bmN0aW9uKGZ1bmMpIHsKICAgIHZhciByYW4gPSBmYWxzZSwgbWVtbzsKICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgaWYgKHJhbikgcmV0dXJuIG1lbW87CiAgICAgIHJhbiA9IHRydWU7CiAgICAgIG1lbW8gPSBmdW5jLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIGZ1bmMgPSBudWxsOwogICAgICByZXR1cm4gbWVtbzsKICAgIH07CiAgfTsKCiAgLy8gUmV0dXJucyB0aGUgZmlyc3QgZnVuY3Rpb24gcGFzc2VkIGFzIGFuIGFyZ3VtZW50IHRvIHRoZSBzZWNvbmQsCiAgLy8gYWxsb3dpbmcgeW91IHRvIGFkanVzdCBhcmd1bWVudHMsIHJ1biBjb2RlIGJlZm9yZSBhbmQgYWZ0ZXIsIGFuZAogIC8vIGNvbmRpdGlvbmFsbHkgZXhlY3V0ZSB0aGUgb3JpZ2luYWwgZnVuY3Rpb24uCiAgXy53cmFwID0gZnVuY3Rpb24oZnVuYywgd3JhcHBlcikgewogICAgcmV0dXJuIF8ucGFydGlhbCh3cmFwcGVyLCBmdW5jKTsKICB9OwoKICAvLyBSZXR1cm5zIGEgZnVuY3Rpb24gdGhhdCBpcyB0aGUgY29tcG9zaXRpb24gb2YgYSBsaXN0IG9mIGZ1bmN0aW9ucywgZWFjaAogIC8vIGNvbnN1bWluZyB0aGUgcmV0dXJuIHZhbHVlIG9mIHRoZSBmdW5jdGlvbiB0aGF0IGZvbGxvd3MuCiAgXy5jb21wb3NlID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgZnVuY3MgPSBhcmd1bWVudHM7CiAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzOwogICAgICBmb3IgKHZhciBpID0gZnVuY3MubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICBhcmdzID0gW2Z1bmNzW2ldLmFwcGx5KHRoaXMsIGFyZ3MpXTsKICAgICAgfQogICAgICByZXR1cm4gYXJnc1swXTsKICAgIH07CiAgfTsKCiAgLy8gUmV0dXJucyBhIGZ1bmN0aW9uIHRoYXQgd2lsbCBvbmx5IGJlIGV4ZWN1dGVkIGFmdGVyIGJlaW5nIGNhbGxlZCBOIHRpbWVzLgogIF8uYWZ0ZXIgPSBmdW5jdGlvbih0aW1lcywgZnVuYykgewogICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICBpZiAoLS10aW1lcyA8IDEpIHsKICAgICAgICByZXR1cm4gZnVuYy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CiAgICB9OwogIH07CgogIC8vIE9iamVjdCBGdW5jdGlvbnMKICAvLyAtLS0tLS0tLS0tLS0tLS0tCgogIC8vIFJldHJpZXZlIHRoZSBuYW1lcyBvZiBhbiBvYmplY3QncyBwcm9wZXJ0aWVzLgogIC8vIERlbGVnYXRlcyB0byAqKkVDTUFTY3JpcHQgNSoqJ3MgbmF0aXZlIGBPYmplY3Qua2V5c2AKICBfLmtleXMgPSBmdW5jdGlvbihvYmopIHsKICAgIGlmICghXy5pc09iamVjdChvYmopKSByZXR1cm4gW107CiAgICBpZiAobmF0aXZlS2V5cykgcmV0dXJuIG5hdGl2ZUtleXMob2JqKTsKICAgIHZhciBrZXlzID0gW107CiAgICBmb3IgKHZhciBrZXkgaW4gb2JqKSBpZiAoXy5oYXMob2JqLCBrZXkpKSBrZXlzLnB1c2goa2V5KTsKICAgIHJldHVybiBrZXlzOwogIH07CgogIC8vIFJldHJpZXZlIHRoZSB2YWx1ZXMgb2YgYW4gb2JqZWN0J3MgcHJvcGVydGllcy4KICBfLnZhbHVlcyA9IGZ1bmN0aW9uKG9iaikgewogICAgdmFyIGtleXMgPSBfLmtleXMob2JqKTsKICAgIHZhciBsZW5ndGggPSBrZXlzLmxlbmd0aDsKICAgIHZhciB2YWx1ZXMgPSBuZXcgQXJyYXkobGVuZ3RoKTsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgdmFsdWVzW2ldID0gb2JqW2tleXNbaV1dOwogICAgfQogICAgcmV0dXJuIHZhbHVlczsKICB9OwoKICAvLyBDb252ZXJ0IGFuIG9iamVjdCBpbnRvIGEgbGlzdCBvZiBgW2tleSwgdmFsdWVdYCBwYWlycy4KICBfLnBhaXJzID0gZnVuY3Rpb24ob2JqKSB7CiAgICB2YXIga2V5cyA9IF8ua2V5cyhvYmopOwogICAgdmFyIGxlbmd0aCA9IGtleXMubGVuZ3RoOwogICAgdmFyIHBhaXJzID0gbmV3IEFycmF5KGxlbmd0aCk7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgIHBhaXJzW2ldID0gW2tleXNbaV0sIG9ialtrZXlzW2ldXV07CiAgICB9CiAgICByZXR1cm4gcGFpcnM7CiAgfTsKCiAgLy8gSW52ZXJ0IHRoZSBrZXlzIGFuZCB2YWx1ZXMgb2YgYW4gb2JqZWN0LiBUaGUgdmFsdWVzIG11c3QgYmUgc2VyaWFsaXphYmxlLgogIF8uaW52ZXJ0ID0gZnVuY3Rpb24ob2JqKSB7CiAgICB2YXIgcmVzdWx0ID0ge307CiAgICB2YXIga2V5cyA9IF8ua2V5cyhvYmopOwogICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IGtleXMubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgcmVzdWx0W29ialtrZXlzW2ldXV0gPSBrZXlzW2ldOwogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9OwoKICAvLyBSZXR1cm4gYSBzb3J0ZWQgbGlzdCBvZiB0aGUgZnVuY3Rpb24gbmFtZXMgYXZhaWxhYmxlIG9uIHRoZSBvYmplY3QuCiAgLy8gQWxpYXNlZCBhcyBgbWV0aG9kc2AKICBfLmZ1bmN0aW9ucyA9IF8ubWV0aG9kcyA9IGZ1bmN0aW9uKG9iaikgewogICAgdmFyIG5hbWVzID0gW107CiAgICBmb3IgKHZhciBrZXkgaW4gb2JqKSB7CiAgICAgIGlmIChfLmlzRnVuY3Rpb24ob2JqW2tleV0pKSBuYW1lcy5wdXNoKGtleSk7CiAgICB9CiAgICByZXR1cm4gbmFtZXMuc29ydCgpOwogIH07CgogIC8vIEV4dGVuZCBhIGdpdmVuIG9iamVjdCB3aXRoIGFsbCB0aGUgcHJvcGVydGllcyBpbiBwYXNzZWQtaW4gb2JqZWN0KHMpLgogIF8uZXh0ZW5kID0gZnVuY3Rpb24ob2JqKSB7CiAgICBlYWNoKHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSwgZnVuY3Rpb24oc291cmNlKSB7CiAgICAgIGlmIChzb3VyY2UpIHsKICAgICAgICBmb3IgKHZhciBwcm9wIGluIHNvdXJjZSkgewogICAgICAgICAgb2JqW3Byb3BdID0gc291cmNlW3Byb3BdOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gb2JqOwogIH07CgogIC8vIFJldHVybiBhIGNvcHkgb2YgdGhlIG9iamVjdCBvbmx5IGNvbnRhaW5pbmcgdGhlIHdoaXRlbGlzdGVkIHByb3BlcnRpZXMuCiAgXy5waWNrID0gZnVuY3Rpb24ob2JqKSB7CiAgICB2YXIgY29weSA9IHt9OwogICAgdmFyIGtleXMgPSBjb25jYXQuYXBwbHkoQXJyYXlQcm90bywgc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpKTsKICAgIGVhY2goa2V5cywgZnVuY3Rpb24oa2V5KSB7CiAgICAgIGlmIChrZXkgaW4gb2JqKSBjb3B5W2tleV0gPSBvYmpba2V5XTsKICAgIH0pOwogICAgcmV0dXJuIGNvcHk7CiAgfTsKCiAgIC8vIFJldHVybiBhIGNvcHkgb2YgdGhlIG9iamVjdCB3aXRob3V0IHRoZSBibGFja2xpc3RlZCBwcm9wZXJ0aWVzLgogIF8ub21pdCA9IGZ1bmN0aW9uKG9iaikgewogICAgdmFyIGNvcHkgPSB7fTsKICAgIHZhciBrZXlzID0gY29uY2F0LmFwcGx5KEFycmF5UHJvdG8sIHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSk7CiAgICBmb3IgKHZhciBrZXkgaW4gb2JqKSB7CiAgICAgIGlmICghXy5jb250YWlucyhrZXlzLCBrZXkpKSBjb3B5W2tleV0gPSBvYmpba2V5XTsKICAgIH0KICAgIHJldHVybiBjb3B5OwogIH07CgogIC8vIEZpbGwgaW4gYSBnaXZlbiBvYmplY3Qgd2l0aCBkZWZhdWx0IHByb3BlcnRpZXMuCiAgXy5kZWZhdWx0cyA9IGZ1bmN0aW9uKG9iaikgewogICAgZWFjaChzbGljZS5jYWxsKGFyZ3VtZW50cywgMSksIGZ1bmN0aW9uKHNvdXJjZSkgewogICAgICBpZiAoc291cmNlKSB7CiAgICAgICAgZm9yICh2YXIgcHJvcCBpbiBzb3VyY2UpIHsKICAgICAgICAgIGlmIChvYmpbcHJvcF0gPT09IHZvaWQgMCkgb2JqW3Byb3BdID0gc291cmNlW3Byb3BdOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gb2JqOwogIH07CgogIC8vIENyZWF0ZSBhIChzaGFsbG93LWNsb25lZCkgZHVwbGljYXRlIG9mIGFuIG9iamVjdC4KICBfLmNsb25lID0gZnVuY3Rpb24ob2JqKSB7CiAgICBpZiAoIV8uaXNPYmplY3Qob2JqKSkgcmV0dXJuIG9iajsKICAgIHJldHVybiBfLmlzQXJyYXkob2JqKSA/IG9iai5zbGljZSgpIDogXy5leHRlbmQoe30sIG9iaik7CiAgfTsKCiAgLy8gSW52b2tlcyBpbnRlcmNlcHRvciB3aXRoIHRoZSBvYmosIGFuZCB0aGVuIHJldHVybnMgb2JqLgogIC8vIFRoZSBwcmltYXJ5IHB1cnBvc2Ugb2YgdGhpcyBtZXRob2QgaXMgdG8gInRhcCBpbnRvIiBhIG1ldGhvZCBjaGFpbiwgaW4KICAvLyBvcmRlciB0byBwZXJmb3JtIG9wZXJhdGlvbnMgb24gaW50ZXJtZWRpYXRlIHJlc3VsdHMgd2l0aGluIHRoZSBjaGFpbi4KICBfLnRhcCA9IGZ1bmN0aW9uKG9iaiwgaW50ZXJjZXB0b3IpIHsKICAgIGludGVyY2VwdG9yKG9iaik7CiAgICByZXR1cm4gb2JqOwogIH07CgogIC8vIEludGVybmFsIHJlY3Vyc2l2ZSBjb21wYXJpc29uIGZ1bmN0aW9uIGZvciBgaXNFcXVhbGAuCiAgdmFyIGVxID0gZnVuY3Rpb24oYSwgYiwgYVN0YWNrLCBiU3RhY2spIHsKICAgIC8vIElkZW50aWNhbCBvYmplY3RzIGFyZSBlcXVhbC4gYDAgPT09IC0wYCwgYnV0IHRoZXkgYXJlbid0IGlkZW50aWNhbC4KICAgIC8vIFNlZSB0aGUgW0hhcm1vbnkgYGVnYWxgIHByb3Bvc2FsXShodHRwOi8vd2lraS5lY21hc2NyaXB0Lm9yZy9kb2t1LnBocD9pZD1oYXJtb255OmVnYWwpLgogICAgaWYgKGEgPT09IGIpIHJldHVybiBhICE9PSAwIHx8IDEgLyBhID09IDEgLyBiOwogICAgLy8gQSBzdHJpY3QgY29tcGFyaXNvbiBpcyBuZWNlc3NhcnkgYmVjYXVzZSBgbnVsbCA9PSB1bmRlZmluZWRgLgogICAgaWYgKGEgPT0gbnVsbCB8fCBiID09IG51bGwpIHJldHVybiBhID09PSBiOwogICAgLy8gVW53cmFwIGFueSB3cmFwcGVkIG9iamVjdHMuCiAgICBpZiAoYSBpbnN0YW5jZW9mIF8pIGEgPSBhLl93cmFwcGVkOwogICAgaWYgKGIgaW5zdGFuY2VvZiBfKSBiID0gYi5fd3JhcHBlZDsKICAgIC8vIENvbXBhcmUgYFtbQ2xhc3NdXWAgbmFtZXMuCiAgICB2YXIgY2xhc3NOYW1lID0gdG9TdHJpbmcuY2FsbChhKTsKICAgIGlmIChjbGFzc05hbWUgIT0gdG9TdHJpbmcuY2FsbChiKSkgcmV0dXJuIGZhbHNlOwogICAgc3dpdGNoIChjbGFzc05hbWUpIHsKICAgICAgLy8gU3RyaW5ncywgbnVtYmVycywgZGF0ZXMsIGFuZCBib29sZWFucyBhcmUgY29tcGFyZWQgYnkgdmFsdWUuCiAgICAgIGNhc2UgJ1tvYmplY3QgU3RyaW5nXSc6CiAgICAgICAgLy8gUHJpbWl0aXZlcyBhbmQgdGhlaXIgY29ycmVzcG9uZGluZyBvYmplY3Qgd3JhcHBlcnMgYXJlIGVxdWl2YWxlbnQ7IHRodXMsIGAiNSJgIGlzCiAgICAgICAgLy8gZXF1aXZhbGVudCB0byBgbmV3IFN0cmluZygiNSIpYC4KICAgICAgICByZXR1cm4gYSA9PSBTdHJpbmcoYik7CiAgICAgIGNhc2UgJ1tvYmplY3QgTnVtYmVyXSc6CiAgICAgICAgLy8gYE5hTmBzIGFyZSBlcXVpdmFsZW50LCBidXQgbm9uLXJlZmxleGl2ZS4gQW4gYGVnYWxgIGNvbXBhcmlzb24gaXMgcGVyZm9ybWVkIGZvcgogICAgICAgIC8vIG90aGVyIG51bWVyaWMgdmFsdWVzLgogICAgICAgIHJldHVybiBhICE9ICthID8gYiAhPSArYiA6IChhID09IDAgPyAxIC8gYSA9PSAxIC8gYiA6IGEgPT0gK2IpOwogICAgICBjYXNlICdbb2JqZWN0IERhdGVdJzoKICAgICAgY2FzZSAnW29iamVjdCBCb29sZWFuXSc6CiAgICAgICAgLy8gQ29lcmNlIGRhdGVzIGFuZCBib29sZWFucyB0byBudW1lcmljIHByaW1pdGl2ZSB2YWx1ZXMuIERhdGVzIGFyZSBjb21wYXJlZCBieSB0aGVpcgogICAgICAgIC8vIG1pbGxpc2Vjb25kIHJlcHJlc2VudGF0aW9ucy4gTm90ZSB0aGF0IGludmFsaWQgZGF0ZXMgd2l0aCBtaWxsaXNlY29uZCByZXByZXNlbnRhdGlvbnMKICAgICAgICAvLyBvZiBgTmFOYCBhcmUgbm90IGVxdWl2YWxlbnQuCiAgICAgICAgcmV0dXJuICthID09ICtiOwogICAgICAvLyBSZWdFeHBzIGFyZSBjb21wYXJlZCBieSB0aGVpciBzb3VyY2UgcGF0dGVybnMgYW5kIGZsYWdzLgogICAgICBjYXNlICdbb2JqZWN0IFJlZ0V4cF0nOgogICAgICAgIHJldHVybiBhLnNvdXJjZSA9PSBiLnNvdXJjZSAmJgogICAgICAgICAgICAgICBhLmdsb2JhbCA9PSBiLmdsb2JhbCAmJgogICAgICAgICAgICAgICBhLm11bHRpbGluZSA9PSBiLm11bHRpbGluZSAmJgogICAgICAgICAgICAgICBhLmlnbm9yZUNhc2UgPT0gYi5pZ25vcmVDYXNlOwogICAgfQogICAgaWYgKHR5cGVvZiBhICE9ICdvYmplY3QnIHx8IHR5cGVvZiBiICE9ICdvYmplY3QnKSByZXR1cm4gZmFsc2U7CiAgICAvLyBBc3N1bWUgZXF1YWxpdHkgZm9yIGN5Y2xpYyBzdHJ1Y3R1cmVzLiBUaGUgYWxnb3JpdGhtIGZvciBkZXRlY3RpbmcgY3ljbGljCiAgICAvLyBzdHJ1Y3R1cmVzIGlzIGFkYXB0ZWQgZnJvbSBFUyA1LjEgc2VjdGlvbiAxNS4xMi4zLCBhYnN0cmFjdCBvcGVyYXRpb24gYEpPYC4KICAgIHZhciBsZW5ndGggPSBhU3RhY2subGVuZ3RoOwogICAgd2hpbGUgKGxlbmd0aC0tKSB7CiAgICAgIC8vIExpbmVhciBzZWFyY2guIFBlcmZvcm1hbmNlIGlzIGludmVyc2VseSBwcm9wb3J0aW9uYWwgdG8gdGhlIG51bWJlciBvZgogICAgICAvLyB1bmlxdWUgbmVzdGVkIHN0cnVjdHVyZXMuCiAgICAgIGlmIChhU3RhY2tbbGVuZ3RoXSA9PSBhKSByZXR1cm4gYlN0YWNrW2xlbmd0aF0gPT0gYjsKICAgIH0KICAgIC8vIE9iamVjdHMgd2l0aCBkaWZmZXJlbnQgY29uc3RydWN0b3JzIGFyZSBub3QgZXF1aXZhbGVudCwgYnV0IGBPYmplY3RgcwogICAgLy8gZnJvbSBkaWZmZXJlbnQgZnJhbWVzIGFyZS4KICAgIHZhciBhQ3RvciA9IGEuY29uc3RydWN0b3IsIGJDdG9yID0gYi5jb25zdHJ1Y3RvcjsKICAgIGlmIChhQ3RvciAhPT0gYkN0b3IgJiYgIShfLmlzRnVuY3Rpb24oYUN0b3IpICYmIChhQ3RvciBpbnN0YW5jZW9mIGFDdG9yKSAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgIF8uaXNGdW5jdGlvbihiQ3RvcikgJiYgKGJDdG9yIGluc3RhbmNlb2YgYkN0b3IpKQogICAgICAgICAgICAgICAgICAgICAgICAmJiAoJ2NvbnN0cnVjdG9yJyBpbiBhICYmICdjb25zdHJ1Y3RvcicgaW4gYikpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgLy8gQWRkIHRoZSBmaXJzdCBvYmplY3QgdG8gdGhlIHN0YWNrIG9mIHRyYXZlcnNlZCBvYmplY3RzLgogICAgYVN0YWNrLnB1c2goYSk7CiAgICBiU3RhY2sucHVzaChiKTsKICAgIHZhciBzaXplID0gMCwgcmVzdWx0ID0gdHJ1ZTsKICAgIC8vIFJlY3Vyc2l2ZWx5IGNvbXBhcmUgb2JqZWN0cyBhbmQgYXJyYXlzLgogICAgaWYgKGNsYXNzTmFtZSA9PSAnW29iamVjdCBBcnJheV0nKSB7CiAgICAgIC8vIENvbXBhcmUgYXJyYXkgbGVuZ3RocyB0byBkZXRlcm1pbmUgaWYgYSBkZWVwIGNvbXBhcmlzb24gaXMgbmVjZXNzYXJ5LgogICAgICBzaXplID0gYS5sZW5ndGg7CiAgICAgIHJlc3VsdCA9IHNpemUgPT0gYi5sZW5ndGg7CiAgICAgIGlmIChyZXN1bHQpIHsKICAgICAgICAvLyBEZWVwIGNvbXBhcmUgdGhlIGNvbnRlbnRzLCBpZ25vcmluZyBub24tbnVtZXJpYyBwcm9wZXJ0aWVzLgogICAgICAgIHdoaWxlIChzaXplLS0pIHsKICAgICAgICAgIGlmICghKHJlc3VsdCA9IGVxKGFbc2l6ZV0sIGJbc2l6ZV0sIGFTdGFjaywgYlN0YWNrKSkpIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgLy8gRGVlcCBjb21wYXJlIG9iamVjdHMuCiAgICAgIGZvciAodmFyIGtleSBpbiBhKSB7CiAgICAgICAgaWYgKF8uaGFzKGEsIGtleSkpIHsKICAgICAgICAgIC8vIENvdW50IHRoZSBleHBlY3RlZCBudW1iZXIgb2YgcHJvcGVydGllcy4KICAgICAgICAgIHNpemUrKzsKICAgICAgICAgIC8vIERlZXAgY29tcGFyZSBlYWNoIG1lbWJlci4KICAgICAgICAgIGlmICghKHJlc3VsdCA9IF8uaGFzKGIsIGtleSkgJiYgZXEoYVtrZXldLCBiW2tleV0sIGFTdGFjaywgYlN0YWNrKSkpIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgICAvLyBFbnN1cmUgdGhhdCBib3RoIG9iamVjdHMgY29udGFpbiB0aGUgc2FtZSBudW1iZXIgb2YgcHJvcGVydGllcy4KICAgICAgaWYgKHJlc3VsdCkgewogICAgICAgIGZvciAoa2V5IGluIGIpIHsKICAgICAgICAgIGlmIChfLmhhcyhiLCBrZXkpICYmICEoc2l6ZS0tKSkgYnJlYWs7CiAgICAgICAgfQogICAgICAgIHJlc3VsdCA9ICFzaXplOwogICAgICB9CiAgICB9CiAgICAvLyBSZW1vdmUgdGhlIGZpcnN0IG9iamVjdCBmcm9tIHRoZSBzdGFjayBvZiB0cmF2ZXJzZWQgb2JqZWN0cy4KICAgIGFTdGFjay5wb3AoKTsKICAgIGJTdGFjay5wb3AoKTsKICAgIHJldHVybiByZXN1bHQ7CiAgfTsKCiAgLy8gUGVyZm9ybSBhIGRlZXAgY29tcGFyaXNvbiB0byBjaGVjayBpZiB0d28gb2JqZWN0cyBhcmUgZXF1YWwuCiAgXy5pc0VxdWFsID0gZnVuY3Rpb24oYSwgYikgewogICAgcmV0dXJuIGVxKGEsIGIsIFtdLCBbXSk7CiAgfTsKCiAgLy8gSXMgYSBnaXZlbiBhcnJheSwgc3RyaW5nLCBvciBvYmplY3QgZW1wdHk/CiAgLy8gQW4gImVtcHR5IiBvYmplY3QgaGFzIG5vIGVudW1lcmFibGUgb3duLXByb3BlcnRpZXMuCiAgXy5pc0VtcHR5ID0gZnVuY3Rpb24ob2JqKSB7CiAgICBpZiAob2JqID09IG51bGwpIHJldHVybiB0cnVlOwogICAgaWYgKF8uaXNBcnJheShvYmopIHx8IF8uaXNTdHJpbmcob2JqKSkgcmV0dXJuIG9iai5sZW5ndGggPT09IDA7CiAgICBmb3IgKHZhciBrZXkgaW4gb2JqKSBpZiAoXy5oYXMob2JqLCBrZXkpKSByZXR1cm4gZmFsc2U7CiAgICByZXR1cm4gdHJ1ZTsKICB9OwoKICAvLyBJcyBhIGdpdmVuIHZhbHVlIGEgRE9NIGVsZW1lbnQ/CiAgXy5pc0VsZW1lbnQgPSBmdW5jdGlvbihvYmopIHsKICAgIHJldHVybiAhIShvYmogJiYgb2JqLm5vZGVUeXBlID09PSAxKTsKICB9OwoKICAvLyBJcyBhIGdpdmVuIHZhbHVlIGFuIGFycmF5PwogIC8vIERlbGVnYXRlcyB0byBFQ01BNSdzIG5hdGl2ZSBBcnJheS5pc0FycmF5CiAgXy5pc0FycmF5ID0gbmF0aXZlSXNBcnJheSB8fCBmdW5jdGlvbihvYmopIHsKICAgIHJldHVybiB0b1N0cmluZy5jYWxsKG9iaikgPT0gJ1tvYmplY3QgQXJyYXldJzsKICB9OwoKICAvLyBJcyBhIGdpdmVuIHZhcmlhYmxlIGFuIG9iamVjdD8KICBfLmlzT2JqZWN0ID0gZnVuY3Rpb24ob2JqKSB7CiAgICByZXR1cm4gb2JqID09PSBPYmplY3Qob2JqKTsKICB9OwoKICAvLyBBZGQgc29tZSBpc1R5cGUgbWV0aG9kczogaXNBcmd1bWVudHMsIGlzRnVuY3Rpb24sIGlzU3RyaW5nLCBpc051bWJlciwgaXNEYXRlLCBpc1JlZ0V4cC4KICBlYWNoKFsnQXJndW1lbnRzJywgJ0Z1bmN0aW9uJywgJ1N0cmluZycsICdOdW1iZXInLCAnRGF0ZScsICdSZWdFeHAnXSwgZnVuY3Rpb24obmFtZSkgewogICAgX1snaXMnICsgbmFtZV0gPSBmdW5jdGlvbihvYmopIHsKICAgICAgcmV0dXJuIHRvU3RyaW5nLmNhbGwob2JqKSA9PSAnW29iamVjdCAnICsgbmFtZSArICddJzsKICAgIH07CiAgfSk7CgogIC8vIERlZmluZSBhIGZhbGxiYWNrIHZlcnNpb24gb2YgdGhlIG1ldGhvZCBpbiBicm93c2VycyAoYWhlbSwgSUUpLCB3aGVyZQogIC8vIHRoZXJlIGlzbid0IGFueSBpbnNwZWN0YWJsZSAiQXJndW1lbnRzIiB0eXBlLgogIGlmICghXy5pc0FyZ3VtZW50cyhhcmd1bWVudHMpKSB7CiAgICBfLmlzQXJndW1lbnRzID0gZnVuY3Rpb24ob2JqKSB7CiAgICAgIHJldHVybiAhIShvYmogJiYgXy5oYXMob2JqLCAnY2FsbGVlJykpOwogICAgfTsKICB9CgogIC8vIE9wdGltaXplIGBpc0Z1bmN0aW9uYCBpZiBhcHByb3ByaWF0ZS4KICBpZiAodHlwZW9mICgvLi8pICE9PSAnZnVuY3Rpb24nKSB7CiAgICBfLmlzRnVuY3Rpb24gPSBmdW5jdGlvbihvYmopIHsKICAgICAgcmV0dXJuIHR5cGVvZiBvYmogPT09ICdmdW5jdGlvbic7CiAgICB9OwogIH0KCiAgLy8gSXMgYSBnaXZlbiBvYmplY3QgYSBmaW5pdGUgbnVtYmVyPwogIF8uaXNGaW5pdGUgPSBmdW5jdGlvbihvYmopIHsKICAgIHJldHVybiBpc0Zpbml0ZShvYmopICYmICFpc05hTihwYXJzZUZsb2F0KG9iaikpOwogIH07CgogIC8vIElzIHRoZSBnaXZlbiB2YWx1ZSBgTmFOYD8gKE5hTiBpcyB0aGUgb25seSBudW1iZXIgd2hpY2ggZG9lcyBub3QgZXF1YWwgaXRzZWxmKS4KICBfLmlzTmFOID0gZnVuY3Rpb24ob2JqKSB7CiAgICByZXR1cm4gXy5pc051bWJlcihvYmopICYmIG9iaiAhPSArb2JqOwogIH07CgogIC8vIElzIGEgZ2l2ZW4gdmFsdWUgYSBib29sZWFuPwogIF8uaXNCb29sZWFuID0gZnVuY3Rpb24ob2JqKSB7CiAgICByZXR1cm4gb2JqID09PSB0cnVlIHx8IG9iaiA9PT0gZmFsc2UgfHwgdG9TdHJpbmcuY2FsbChvYmopID09ICdbb2JqZWN0IEJvb2xlYW5dJzsKICB9OwoKICAvLyBJcyBhIGdpdmVuIHZhbHVlIGVxdWFsIHRvIG51bGw/CiAgXy5pc051bGwgPSBmdW5jdGlvbihvYmopIHsKICAgIHJldHVybiBvYmogPT09IG51bGw7CiAgfTsKCiAgLy8gSXMgYSBnaXZlbiB2YXJpYWJsZSB1bmRlZmluZWQ/CiAgXy5pc1VuZGVmaW5lZCA9IGZ1bmN0aW9uKG9iaikgewogICAgcmV0dXJuIG9iaiA9PT0gdm9pZCAwOwogIH07CgogIC8vIFNob3J0Y3V0IGZ1bmN0aW9uIGZvciBjaGVja2luZyBpZiBhbiBvYmplY3QgaGFzIGEgZ2l2ZW4gcHJvcGVydHkgZGlyZWN0bHkKICAvLyBvbiBpdHNlbGYgKGluIG90aGVyIHdvcmRzLCBub3Qgb24gYSBwcm90b3R5cGUpLgogIF8uaGFzID0gZnVuY3Rpb24ob2JqLCBrZXkpIHsKICAgIHJldHVybiBoYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwga2V5KTsKICB9OwoKICAvLyBVdGlsaXR5IEZ1bmN0aW9ucwogIC8vIC0tLS0tLS0tLS0tLS0tLS0tCgogIC8vIFJ1biBVbmRlcnNjb3JlLmpzIGluICpub0NvbmZsaWN0KiBtb2RlLCByZXR1cm5pbmcgdGhlIGBfYCB2YXJpYWJsZSB0byBpdHMKICAvLyBwcmV2aW91cyBvd25lci4gUmV0dXJucyBhIHJlZmVyZW5jZSB0byB0aGUgVW5kZXJzY29yZSBvYmplY3QuCiAgXy5ub0NvbmZsaWN0ID0gZnVuY3Rpb24oKSB7CiAgICByb290Ll8gPSBwcmV2aW91c1VuZGVyc2NvcmU7CiAgICByZXR1cm4gdGhpczsKICB9OwoKICAvLyBLZWVwIHRoZSBpZGVudGl0eSBmdW5jdGlvbiBhcm91bmQgZm9yIGRlZmF1bHQgaXRlcmF0b3JzLgogIF8uaWRlbnRpdHkgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgcmV0dXJuIHZhbHVlOwogIH07CgogIF8uY29uc3RhbnQgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHZhbHVlOwogICAgfTsKICB9OwoKICBfLnByb3BlcnR5ID0gZnVuY3Rpb24oa2V5KSB7CiAgICByZXR1cm4gZnVuY3Rpb24ob2JqKSB7CiAgICAgIHJldHVybiBvYmpba2V5XTsKICAgIH07CiAgfTsKCiAgLy8gUmV0dXJucyBhIHByZWRpY2F0ZSBmb3IgY2hlY2tpbmcgd2hldGhlciBhbiBvYmplY3QgaGFzIGEgZ2l2ZW4gc2V0IG9mIGBrZXk6dmFsdWVgIHBhaXJzLgogIF8ubWF0Y2hlcyA9IGZ1bmN0aW9uKGF0dHJzKSB7CiAgICByZXR1cm4gZnVuY3Rpb24ob2JqKSB7CiAgICAgIGlmIChvYmogPT09IGF0dHJzKSByZXR1cm4gdHJ1ZTsgLy9hdm9pZCBjb21wYXJpbmcgYW4gb2JqZWN0IHRvIGl0c2VsZi4KICAgICAgZm9yICh2YXIga2V5IGluIGF0dHJzKSB7CiAgICAgICAgaWYgKGF0dHJzW2tleV0gIT09IG9ialtrZXldKQogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogIH07CgogIC8vIFJ1biBhIGZ1bmN0aW9uICoqbioqIHRpbWVzLgogIF8udGltZXMgPSBmdW5jdGlvbihuLCBpdGVyYXRvciwgY29udGV4dCkgewogICAgdmFyIGFjY3VtID0gQXJyYXkoTWF0aC5tYXgoMCwgbikpOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBuOyBpKyspIGFjY3VtW2ldID0gaXRlcmF0b3IuY2FsbChjb250ZXh0LCBpKTsKICAgIHJldHVybiBhY2N1bTsKICB9OwoKICAvLyBSZXR1cm4gYSByYW5kb20gaW50ZWdlciBiZXR3ZWVuIG1pbiBhbmQgbWF4IChpbmNsdXNpdmUpLgogIF8ucmFuZG9tID0gZnVuY3Rpb24obWluLCBtYXgpIHsKICAgIGlmIChtYXggPT0gbnVsbCkgewogICAgICBtYXggPSBtaW47CiAgICAgIG1pbiA9IDA7CiAgICB9CiAgICByZXR1cm4gbWluICsgTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKG1heCAtIG1pbiArIDEpKTsKICB9OwoKICAvLyBBIChwb3NzaWJseSBmYXN0ZXIpIHdheSB0byBnZXQgdGhlIGN1cnJlbnQgdGltZXN0YW1wIGFzIGFuIGludGVnZXIuCiAgXy5ub3cgPSBEYXRlLm5vdyB8fCBmdW5jdGlvbigpIHsgcmV0dXJuIG5ldyBEYXRlKCkuZ2V0VGltZSgpOyB9OwoKICAvLyBMaXN0IG9mIEhUTUwgZW50aXRpZXMgZm9yIGVzY2FwaW5nLgogIHZhciBlbnRpdHlNYXAgPSB7CiAgICBlc2NhcGU6IHsKICAgICAgJyYnOiAnJmFtcDsnLAogICAgICAnPCc6ICcmbHQ7JywKICAgICAgJz4nOiAnJmd0OycsCiAgICAgICciJzogJyZxdW90OycsCiAgICAgICInIjogJyYjeDI3OycKICAgIH0KICB9OwogIGVudGl0eU1hcC51bmVzY2FwZSA9IF8uaW52ZXJ0KGVudGl0eU1hcC5lc2NhcGUpOwoKICAvLyBSZWdleGVzIGNvbnRhaW5pbmcgdGhlIGtleXMgYW5kIHZhbHVlcyBsaXN0ZWQgaW1tZWRpYXRlbHkgYWJvdmUuCiAgdmFyIGVudGl0eVJlZ2V4ZXMgPSB7CiAgICBlc2NhcGU6ICAgbmV3IFJlZ0V4cCgnWycgKyBfLmtleXMoZW50aXR5TWFwLmVzY2FwZSkuam9pbignJykgKyAnXScsICdnJyksCiAgICB1bmVzY2FwZTogbmV3IFJlZ0V4cCgnKCcgKyBfLmtleXMoZW50aXR5TWFwLnVuZXNjYXBlKS5qb2luKCd8JykgKyAnKScsICdnJykKICB9OwoKICAvLyBGdW5jdGlvbnMgZm9yIGVzY2FwaW5nIGFuZCB1bmVzY2FwaW5nIHN0cmluZ3MgdG8vZnJvbSBIVE1MIGludGVycG9sYXRpb24uCiAgXy5lYWNoKFsnZXNjYXBlJywgJ3VuZXNjYXBlJ10sIGZ1bmN0aW9uKG1ldGhvZCkgewogICAgX1ttZXRob2RdID0gZnVuY3Rpb24oc3RyaW5nKSB7CiAgICAgIGlmIChzdHJpbmcgPT0gbnVsbCkgcmV0dXJuICcnOwogICAgICByZXR1cm4gKCcnICsgc3RyaW5nKS5yZXBsYWNlKGVudGl0eVJlZ2V4ZXNbbWV0aG9kXSwgZnVuY3Rpb24obWF0Y2gpIHsKICAgICAgICByZXR1cm4gZW50aXR5TWFwW21ldGhvZF1bbWF0Y2hdOwogICAgICB9KTsKICAgIH07CiAgfSk7CgogIC8vIElmIHRoZSB2YWx1ZSBvZiB0aGUgbmFtZWQgYHByb3BlcnR5YCBpcyBhIGZ1bmN0aW9uIHRoZW4gaW52b2tlIGl0IHdpdGggdGhlCiAgLy8gYG9iamVjdGAgYXMgY29udGV4dDsgb3RoZXJ3aXNlLCByZXR1cm4gaXQuCiAgXy5yZXN1bHQgPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7CiAgICBpZiAob2JqZWN0ID09IG51bGwpIHJldHVybiB2b2lkIDA7CiAgICB2YXIgdmFsdWUgPSBvYmplY3RbcHJvcGVydHldOwogICAgcmV0dXJuIF8uaXNGdW5jdGlvbih2YWx1ZSkgPyB2YWx1ZS5jYWxsKG9iamVjdCkgOiB2YWx1ZTsKICB9OwoKICAvLyBBZGQgeW91ciBvd24gY3VzdG9tIGZ1bmN0aW9ucyB0byB0aGUgVW5kZXJzY29yZSBvYmplY3QuCiAgXy5taXhpbiA9IGZ1bmN0aW9uKG9iaikgewogICAgZWFjaChfLmZ1bmN0aW9ucyhvYmopLCBmdW5jdGlvbihuYW1lKSB7CiAgICAgIHZhciBmdW5jID0gX1tuYW1lXSA9IG9ialtuYW1lXTsKICAgICAgXy5wcm90b3R5cGVbbmFtZV0gPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgYXJncyA9IFt0aGlzLl93cmFwcGVkXTsKICAgICAgICBwdXNoLmFwcGx5KGFyZ3MsIGFyZ3VtZW50cyk7CiAgICAgICAgcmV0dXJuIHJlc3VsdC5jYWxsKHRoaXMsIGZ1bmMuYXBwbHkoXywgYXJncykpOwogICAgICB9OwogICAgfSk7CiAgfTsKCiAgLy8gR2VuZXJhdGUgYSB1bmlxdWUgaW50ZWdlciBpZCAodW5pcXVlIHdpdGhpbiB0aGUgZW50aXJlIGNsaWVudCBzZXNzaW9uKS4KICAvLyBVc2VmdWwgZm9yIHRlbXBvcmFyeSBET00gaWRzLgogIHZhciBpZENvdW50ZXIgPSAwOwogIF8udW5pcXVlSWQgPSBmdW5jdGlvbihwcmVmaXgpIHsKICAgIHZhciBpZCA9ICsraWRDb3VudGVyICsgJyc7CiAgICByZXR1cm4gcHJlZml4ID8gcHJlZml4ICsgaWQgOiBpZDsKICB9OwoKICAvLyBCeSBkZWZhdWx0LCBVbmRlcnNjb3JlIHVzZXMgRVJCLXN0eWxlIHRlbXBsYXRlIGRlbGltaXRlcnMsIGNoYW5nZSB0aGUKICAvLyBmb2xsb3dpbmcgdGVtcGxhdGUgc2V0dGluZ3MgdG8gdXNlIGFsdGVybmF0aXZlIGRlbGltaXRlcnMuCiAgXy50ZW1wbGF0ZVNldHRpbmdzID0gewogICAgZXZhbHVhdGUgICAgOiAvPCUoW1xzXFNdKz8pJT4vZywKICAgIGludGVycG9sYXRlIDogLzwlPShbXHNcU10rPyklPi9nLAogICAgZXNjYXBlICAgICAgOiAvPCUtKFtcc1xTXSs/KSU+L2cKICB9OwoKICAvLyBXaGVuIGN1c3RvbWl6aW5nIGB0ZW1wbGF0ZVNldHRpbmdzYCwgaWYgeW91IGRvbid0IHdhbnQgdG8gZGVmaW5lIGFuCiAgLy8gaW50ZXJwb2xhdGlvbiwgZXZhbHVhdGlvbiBvciBlc2NhcGluZyByZWdleCwgd2UgbmVlZCBvbmUgdGhhdCBpcwogIC8vIGd1YXJhbnRlZWQgbm90IHRvIG1hdGNoLgogIHZhciBub01hdGNoID0gLyguKV4vOwoKICAvLyBDZXJ0YWluIGNoYXJhY3RlcnMgbmVlZCB0byBiZSBlc2NhcGVkIHNvIHRoYXQgdGhleSBjYW4gYmUgcHV0IGludG8gYQogIC8vIHN0cmluZyBsaXRlcmFsLgogIHZhciBlc2NhcGVzID0gewogICAgIiciOiAgICAgICInIiwKICAgICdcXCc6ICAgICAnXFwnLAogICAgJ1xyJzogICAgICdyJywKICAgICdcbic6ICAgICAnbicsCiAgICAnXHQnOiAgICAgJ3QnLAogICAgJ1x1MjAyOCc6ICd1MjAyOCcsCiAgICAnXHUyMDI5JzogJ3UyMDI5JwogIH07CgogIHZhciBlc2NhcGVyID0gL1xcfCd8XHJ8XG58XHR8XHUyMDI4fFx1MjAyOS9nOwoKICAvLyBKYXZhU2NyaXB0IG1pY3JvLXRlbXBsYXRpbmcsIHNpbWlsYXIgdG8gSm9obiBSZXNpZydzIGltcGxlbWVudGF0aW9uLgogIC8vIFVuZGVyc2NvcmUgdGVtcGxhdGluZyBoYW5kbGVzIGFyYml0cmFyeSBkZWxpbWl0ZXJzLCBwcmVzZXJ2ZXMgd2hpdGVzcGFjZSwKICAvLyBhbmQgY29ycmVjdGx5IGVzY2FwZXMgcXVvdGVzIHdpdGhpbiBpbnRlcnBvbGF0ZWQgY29kZS4KICBfLnRlbXBsYXRlID0gZnVuY3Rpb24odGV4dCwgZGF0YSwgc2V0dGluZ3MpIHsKICAgIHZhciByZW5kZXI7CiAgICBzZXR0aW5ncyA9IF8uZGVmYXVsdHMoe30sIHNldHRpbmdzLCBfLnRlbXBsYXRlU2V0dGluZ3MpOwoKICAgIC8vIENvbWJpbmUgZGVsaW1pdGVycyBpbnRvIG9uZSByZWd1bGFyIGV4cHJlc3Npb24gdmlhIGFsdGVybmF0aW9uLgogICAgdmFyIG1hdGNoZXIgPSBuZXcgUmVnRXhwKFsKICAgICAgKHNldHRpbmdzLmVzY2FwZSB8fCBub01hdGNoKS5zb3VyY2UsCiAgICAgIChzZXR0aW5ncy5pbnRlcnBvbGF0ZSB8fCBub01hdGNoKS5zb3VyY2UsCiAgICAgIChzZXR0aW5ncy5ldmFsdWF0ZSB8fCBub01hdGNoKS5zb3VyY2UKICAgIF0uam9pbignfCcpICsgJ3wkJywgJ2cnKTsKCiAgICAvLyBDb21waWxlIHRoZSB0ZW1wbGF0ZSBzb3VyY2UsIGVzY2FwaW5nIHN0cmluZyBsaXRlcmFscyBhcHByb3ByaWF0ZWx5LgogICAgdmFyIGluZGV4ID0gMDsKICAgIHZhciBzb3VyY2UgPSAiX19wKz0nIjsKICAgIHRleHQucmVwbGFjZShtYXRjaGVyLCBmdW5jdGlvbihtYXRjaCwgZXNjYXBlLCBpbnRlcnBvbGF0ZSwgZXZhbHVhdGUsIG9mZnNldCkgewogICAgICBzb3VyY2UgKz0gdGV4dC5zbGljZShpbmRleCwgb2Zmc2V0KQogICAgICAgIC5yZXBsYWNlKGVzY2FwZXIsIGZ1bmN0aW9uKG1hdGNoKSB7IHJldHVybiAnXFwnICsgZXNjYXBlc1ttYXRjaF07IH0pOwoKICAgICAgaWYgKGVzY2FwZSkgewogICAgICAgIHNvdXJjZSArPSAiJytcbigoX190PSgiICsgZXNjYXBlICsgIikpPT1udWxsPycnOl8uZXNjYXBlKF9fdCkpK1xuJyI7CiAgICAgIH0KICAgICAgaWYgKGludGVycG9sYXRlKSB7CiAgICAgICAgc291cmNlICs9ICInK1xuKChfX3Q9KCIgKyBpbnRlcnBvbGF0ZSArICIpKT09bnVsbD8nJzpfX3QpK1xuJyI7CiAgICAgIH0KICAgICAgaWYgKGV2YWx1YXRlKSB7CiAgICAgICAgc291cmNlICs9ICInO1xuIiArIGV2YWx1YXRlICsgIlxuX19wKz0nIjsKICAgICAgfQogICAgICBpbmRleCA9IG9mZnNldCArIG1hdGNoLmxlbmd0aDsKICAgICAgcmV0dXJuIG1hdGNoOwogICAgfSk7CiAgICBzb3VyY2UgKz0gIic7XG4iOwoKICAgIC8vIElmIGEgdmFyaWFibGUgaXMgbm90IHNwZWNpZmllZCwgcGxhY2UgZGF0YSB2YWx1ZXMgaW4gbG9jYWwgc2NvcGUuCiAgICBpZiAoIXNldHRpbmdzLnZhcmlhYmxlKSBzb3VyY2UgPSAnd2l0aChvYmp8fHt9KXtcbicgKyBzb3VyY2UgKyAnfVxuJzsKCiAgICBzb3VyY2UgPSAidmFyIF9fdCxfX3A9JycsX19qPUFycmF5LnByb3RvdHlwZS5qb2luLCIgKwogICAgICAicHJpbnQ9ZnVuY3Rpb24oKXtfX3ArPV9fai5jYWxsKGFyZ3VtZW50cywnJyk7fTtcbiIgKwogICAgICBzb3VyY2UgKyAicmV0dXJuIF9fcDtcbiI7CgogICAgdHJ5IHsKICAgICAgcmVuZGVyID0gbmV3IEZ1bmN0aW9uKHNldHRpbmdzLnZhcmlhYmxlIHx8ICdvYmonLCAnXycsIHNvdXJjZSk7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIGUuc291cmNlID0gc291cmNlOwogICAgICB0aHJvdyBlOwogICAgfQoKICAgIGlmIChkYXRhKSByZXR1cm4gcmVuZGVyKGRhdGEsIF8pOwogICAgdmFyIHRlbXBsYXRlID0gZnVuY3Rpb24oZGF0YSkgewogICAgICByZXR1cm4gcmVuZGVyLmNhbGwodGhpcywgZGF0YSwgXyk7CiAgICB9OwoKICAgIC8vIFByb3ZpZGUgdGhlIGNvbXBpbGVkIGZ1bmN0aW9uIHNvdXJjZSBhcyBhIGNvbnZlbmllbmNlIGZvciBwcmVjb21waWxhdGlvbi4KICAgIHRlbXBsYXRlLnNvdXJjZSA9ICdmdW5jdGlvbignICsgKHNldHRpbmdzLnZhcmlhYmxlIHx8ICdvYmonKSArICcpe1xuJyArIHNvdXJjZSArICd9JzsKCiAgICByZXR1cm4gdGVtcGxhdGU7CiAgfTsKCiAgLy8gQWRkIGEgImNoYWluIiBmdW5jdGlvbiwgd2hpY2ggd2lsbCBkZWxlZ2F0ZSB0byB0aGUgd3JhcHBlci4KICBfLmNoYWluID0gZnVuY3Rpb24ob2JqKSB7CiAgICByZXR1cm4gXyhvYmopLmNoYWluKCk7CiAgfTsKCiAgLy8gT09QCiAgLy8gLS0tLS0tLS0tLS0tLS0tCiAgLy8gSWYgVW5kZXJzY29yZSBpcyBjYWxsZWQgYXMgYSBmdW5jdGlvbiwgaXQgcmV0dXJucyBhIHdyYXBwZWQgb2JqZWN0IHRoYXQKICAvLyBjYW4gYmUgdXNlZCBPTy1zdHlsZS4gVGhpcyB3cmFwcGVyIGhvbGRzIGFsdGVyZWQgdmVyc2lvbnMgb2YgYWxsIHRoZQogIC8vIHVuZGVyc2NvcmUgZnVuY3Rpb25zLiBXcmFwcGVkIG9iamVjdHMgbWF5IGJlIGNoYWluZWQuCgogIC8vIEhlbHBlciBmdW5jdGlvbiB0byBjb250aW51ZSBjaGFpbmluZyBpbnRlcm1lZGlhdGUgcmVzdWx0cy4KICB2YXIgcmVzdWx0ID0gZnVuY3Rpb24ob2JqKSB7CiAgICByZXR1cm4gdGhpcy5fY2hhaW4gPyBfKG9iaikuY2hhaW4oKSA6IG9iajsKICB9OwoKICAvLyBBZGQgYWxsIG9mIHRoZSBVbmRlcnNjb3JlIGZ1bmN0aW9ucyB0byB0aGUgd3JhcHBlciBvYmplY3QuCiAgXy5taXhpbihfKTsKCiAgLy8gQWRkIGFsbCBtdXRhdG9yIEFycmF5IGZ1bmN0aW9ucyB0byB0aGUgd3JhcHBlci4KICBlYWNoKFsncG9wJywgJ3B1c2gnLCAncmV2ZXJzZScsICdzaGlmdCcsICdzb3J0JywgJ3NwbGljZScsICd1bnNoaWZ0J10sIGZ1bmN0aW9uKG5hbWUpIHsKICAgIHZhciBtZXRob2QgPSBBcnJheVByb3RvW25hbWVdOwogICAgXy5wcm90b3R5cGVbbmFtZV0gPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIG9iaiA9IHRoaXMuX3dyYXBwZWQ7CiAgICAgIG1ldGhvZC5hcHBseShvYmosIGFyZ3VtZW50cyk7CiAgICAgIGlmICgobmFtZSA9PSAnc2hpZnQnIHx8IG5hbWUgPT0gJ3NwbGljZScpICYmIG9iai5sZW5ndGggPT09IDApIGRlbGV0ZSBvYmpbMF07CiAgICAgIHJldHVybiByZXN1bHQuY2FsbCh0aGlzLCBvYmopOwogICAgfTsKICB9KTsKCiAgLy8gQWRkIGFsbCBhY2Nlc3NvciBBcnJheSBmdW5jdGlvbnMgdG8gdGhlIHdyYXBwZXIuCiAgZWFjaChbJ2NvbmNhdCcsICdqb2luJywgJ3NsaWNlJ10sIGZ1bmN0aW9uKG5hbWUpIHsKICAgIHZhciBtZXRob2QgPSBBcnJheVByb3RvW25hbWVdOwogICAgXy5wcm90b3R5cGVbbmFtZV0gPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIHJlc3VsdC5jYWxsKHRoaXMsIG1ldGhvZC5hcHBseSh0aGlzLl93cmFwcGVkLCBhcmd1bWVudHMpKTsKICAgIH07CiAgfSk7CgogIF8uZXh0ZW5kKF8ucHJvdG90eXBlLCB7CgogICAgLy8gU3RhcnQgY2hhaW5pbmcgYSB3cmFwcGVkIFVuZGVyc2NvcmUgb2JqZWN0LgogICAgY2hhaW46IGZ1bmN0aW9uKCkgewogICAgICB0aGlzLl9jaGFpbiA9IHRydWU7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvLyBFeHRyYWN0cyB0aGUgcmVzdWx0IGZyb20gYSB3cmFwcGVkIGFuZCBjaGFpbmVkIG9iamVjdC4KICAgIHZhbHVlOiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIHRoaXMuX3dyYXBwZWQ7CiAgICB9CgogIH0pOwoKICAvLyBBTUQgcmVnaXN0cmF0aW9uIGhhcHBlbnMgYXQgdGhlIGVuZCBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIEFNRCBsb2FkZXJzCiAgLy8gdGhhdCBtYXkgbm90IGVuZm9yY2UgbmV4dC10dXJuIHNlbWFudGljcyBvbiBtb2R1bGVzLiBFdmVuIHRob3VnaCBnZW5lcmFsCiAgLy8gcHJhY3RpY2UgZm9yIEFNRCByZWdpc3RyYXRpb24gaXMgdG8gYmUgYW5vbnltb3VzLCB1bmRlcnNjb3JlIHJlZ2lzdGVycwogIC8vIGFzIGEgbmFtZWQgbW9kdWxlIGJlY2F1c2UsIGxpa2UgalF1ZXJ5LCBpdCBpcyBhIGJhc2UgbGlicmFyeSB0aGF0IGlzCiAgLy8gcG9wdWxhciBlbm91Z2ggdG8gYmUgYnVuZGxlZCBpbiBhIHRoaXJkIHBhcnR5IGxpYiwgYnV0IG5vdCBiZSBwYXJ0IG9mCiAgLy8gYW4gQU1EIGxvYWQgcmVxdWVzdC4gVGhvc2UgY2FzZXMgY291bGQgZ2VuZXJhdGUgYW4gZXJyb3Igd2hlbiBhbgogIC8vIGFub255bW91cyBkZWZpbmUoKSBpcyBjYWxsZWQgb3V0c2lkZSBvZiBhIGxvYWRlciByZXF1ZXN0LgogIGlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHsKICAgIGRlZmluZSgndW5kZXJzY29yZScsIFtdLCBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIF87CiAgICB9KTsKICB9Cn0pLmNhbGwodGhpcyk7CgovLyAgICAgQmFja2JvbmUuanMgMS4xLjIKCi8vICAgICAoYykgMjAxMC0yMDE0IEplcmVteSBBc2hrZW5hcywgRG9jdW1lbnRDbG91ZCBhbmQgSW52ZXN0aWdhdGl2ZSBSZXBvcnRlcnMgJiBFZGl0b3JzCi8vICAgICBCYWNrYm9uZSBtYXkgYmUgZnJlZWx5IGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBNSVQgbGljZW5zZS4KLy8gICAgIEZvciBhbGwgZGV0YWlscyBhbmQgZG9jdW1lbnRhdGlvbjoKLy8gICAgIGh0dHA6Ly9iYWNrYm9uZWpzLm9yZwoKKGZ1bmN0aW9uKHJvb3QsIGZhY3RvcnkpIHsKCiAgLy8gU2V0IHVwIEJhY2tib25lIGFwcHJvcHJpYXRlbHkgZm9yIHRoZSBlbnZpcm9ubWVudC4gU3RhcnQgd2l0aCBBTUQuCiAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkgewogICAgZGVmaW5lKCdiYWNrYm9uZScsWyd1bmRlcnNjb3JlJywgJ2pxdWVyeScsICdleHBvcnRzJ10sIGZ1bmN0aW9uKF8sICQsIGV4cG9ydHMpIHsKICAgICAgLy8gRXhwb3J0IGdsb2JhbCBldmVuIGluIEFNRCBjYXNlIGluIGNhc2UgdGhpcyBzY3JpcHQgaXMgbG9hZGVkIHdpdGgKICAgICAgLy8gb3RoZXJzIHRoYXQgbWF5IHN0aWxsIGV4cGVjdCBhIGdsb2JhbCBCYWNrYm9uZS4KICAgICAgcm9vdC5CYWNrYm9uZSA9IGZhY3Rvcnkocm9vdCwgZXhwb3J0cywgXywgJCk7CiAgICB9KTsKCiAgLy8gTmV4dCBmb3IgTm9kZS5qcyBvciBDb21tb25KUy4galF1ZXJ5IG1heSBub3QgYmUgbmVlZGVkIGFzIGEgbW9kdWxlLgogIH0gZWxzZSBpZiAodHlwZW9mIGV4cG9ydHMgIT09ICd1bmRlZmluZWQnKSB7CiAgICB2YXIgXyA9IHJlcXVpcmUoJ3VuZGVyc2NvcmUnKTsKICAgIGZhY3Rvcnkocm9vdCwgZXhwb3J0cywgXyk7CgogIC8vIEZpbmFsbHksIGFzIGEgYnJvd3NlciBnbG9iYWwuCiAgfSBlbHNlIHsKICAgIHJvb3QuQmFja2JvbmUgPSBmYWN0b3J5KHJvb3QsIHt9LCByb290Ll8sIChyb290LmpRdWVyeSB8fCByb290LlplcHRvIHx8IHJvb3QuZW5kZXIgfHwgcm9vdC4kKSk7CiAgfQoKfSh0aGlzLCBmdW5jdGlvbihyb290LCBCYWNrYm9uZSwgXywgJCkgewoKICAvLyBJbml0aWFsIFNldHVwCiAgLy8gLS0tLS0tLS0tLS0tLQoKICAvLyBTYXZlIHRoZSBwcmV2aW91cyB2YWx1ZSBvZiB0aGUgYEJhY2tib25lYCB2YXJpYWJsZSwgc28gdGhhdCBpdCBjYW4gYmUKICAvLyByZXN0b3JlZCBsYXRlciBvbiwgaWYgYG5vQ29uZmxpY3RgIGlzIHVzZWQuCiAgdmFyIHByZXZpb3VzQmFja2JvbmUgPSByb290LkJhY2tib25lOwoKICAvLyBDcmVhdGUgbG9jYWwgcmVmZXJlbmNlcyB0byBhcnJheSBtZXRob2RzIHdlJ2xsIHdhbnQgdG8gdXNlIGxhdGVyLgogIHZhciBhcnJheSA9IFtdOwogIHZhciBwdXNoID0gYXJyYXkucHVzaDsKICB2YXIgc2xpY2UgPSBhcnJheS5zbGljZTsKICB2YXIgc3BsaWNlID0gYXJyYXkuc3BsaWNlOwoKICAvLyBDdXJyZW50IHZlcnNpb24gb2YgdGhlIGxpYnJhcnkuIEtlZXAgaW4gc3luYyB3aXRoIGBwYWNrYWdlLmpzb25gLgogIEJhY2tib25lLlZFUlNJT04gPSAnMS4xLjInOwoKICAvLyBGb3IgQmFja2JvbmUncyBwdXJwb3NlcywgalF1ZXJ5LCBaZXB0bywgRW5kZXIsIG9yIE15IExpYnJhcnkgKGtpZGRpbmcpIG93bnMKICAvLyB0aGUgYCRgIHZhcmlhYmxlLgogIEJhY2tib25lLiQgPSAkOwoKICAvLyBSdW5zIEJhY2tib25lLmpzIGluICpub0NvbmZsaWN0KiBtb2RlLCByZXR1cm5pbmcgdGhlIGBCYWNrYm9uZWAgdmFyaWFibGUKICAvLyB0byBpdHMgcHJldmlvdXMgb3duZXIuIFJldHVybnMgYSByZWZlcmVuY2UgdG8gdGhpcyBCYWNrYm9uZSBvYmplY3QuCiAgQmFja2JvbmUubm9Db25mbGljdCA9IGZ1bmN0aW9uKCkgewogICAgcm9vdC5CYWNrYm9uZSA9IHByZXZpb3VzQmFja2JvbmU7CiAgICByZXR1cm4gdGhpczsKICB9OwoKICAvLyBUdXJuIG9uIGBlbXVsYXRlSFRUUGAgdG8gc3VwcG9ydCBsZWdhY3kgSFRUUCBzZXJ2ZXJzLiBTZXR0aW5nIHRoaXMgb3B0aW9uCiAgLy8gd2lsbCBmYWtlIGAiUEFUQ0giYCwgYCJQVVQiYCBhbmQgYCJERUxFVEUiYCByZXF1ZXN0cyB2aWEgdGhlIGBfbWV0aG9kYCBwYXJhbWV0ZXIgYW5kCiAgLy8gc2V0IGEgYFgtSHR0cC1NZXRob2QtT3ZlcnJpZGVgIGhlYWRlci4KICBCYWNrYm9uZS5lbXVsYXRlSFRUUCA9IGZhbHNlOwoKICAvLyBUdXJuIG9uIGBlbXVsYXRlSlNPTmAgdG8gc3VwcG9ydCBsZWdhY3kgc2VydmVycyB0aGF0IGNhbid0IGRlYWwgd2l0aCBkaXJlY3QKICAvLyBgYXBwbGljYXRpb24vanNvbmAgcmVxdWVzdHMgLi4uIHdpbGwgZW5jb2RlIHRoZSBib2R5IGFzCiAgLy8gYGFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZGAgaW5zdGVhZCBhbmQgd2lsbCBzZW5kIHRoZSBtb2RlbCBpbiBhCiAgLy8gZm9ybSBwYXJhbSBuYW1lZCBgbW9kZWxgLgogIEJhY2tib25lLmVtdWxhdGVKU09OID0gZmFsc2U7CgogIC8vIEJhY2tib25lLkV2ZW50cwogIC8vIC0tLS0tLS0tLS0tLS0tLQoKICAvLyBBIG1vZHVsZSB0aGF0IGNhbiBiZSBtaXhlZCBpbiB0byAqYW55IG9iamVjdCogaW4gb3JkZXIgdG8gcHJvdmlkZSBpdCB3aXRoCiAgLy8gY3VzdG9tIGV2ZW50cy4gWW91IG1heSBiaW5kIHdpdGggYG9uYCBvciByZW1vdmUgd2l0aCBgb2ZmYCBjYWxsYmFjawogIC8vIGZ1bmN0aW9ucyB0byBhbiBldmVudDsgYHRyaWdnZXJgLWluZyBhbiBldmVudCBmaXJlcyBhbGwgY2FsbGJhY2tzIGluCiAgLy8gc3VjY2Vzc2lvbi4KICAvLwogIC8vICAgICB2YXIgb2JqZWN0ID0ge307CiAgLy8gICAgIF8uZXh0ZW5kKG9iamVjdCwgQmFja2JvbmUuRXZlbnRzKTsKICAvLyAgICAgb2JqZWN0Lm9uKCdleHBhbmQnLCBmdW5jdGlvbigpeyBhbGVydCgnZXhwYW5kZWQnKTsgfSk7CiAgLy8gICAgIG9iamVjdC50cmlnZ2VyKCdleHBhbmQnKTsKICAvLwogIHZhciBFdmVudHMgPSBCYWNrYm9uZS5FdmVudHMgPSB7CgogICAgLy8gQmluZCBhbiBldmVudCB0byBhIGBjYWxsYmFja2AgZnVuY3Rpb24uIFBhc3NpbmcgYCJhbGwiYCB3aWxsIGJpbmQKICAgIC8vIHRoZSBjYWxsYmFjayB0byBhbGwgZXZlbnRzIGZpcmVkLgogICAgb246IGZ1bmN0aW9uKG5hbWUsIGNhbGxiYWNrLCBjb250ZXh0KSB7CiAgICAgIGlmICghZXZlbnRzQXBpKHRoaXMsICdvbicsIG5hbWUsIFtjYWxsYmFjaywgY29udGV4dF0pIHx8ICFjYWxsYmFjaykgcmV0dXJuIHRoaXM7CiAgICAgIHRoaXMuX2V2ZW50cyB8fCAodGhpcy5fZXZlbnRzID0ge30pOwogICAgICB2YXIgZXZlbnRzID0gdGhpcy5fZXZlbnRzW25hbWVdIHx8ICh0aGlzLl9ldmVudHNbbmFtZV0gPSBbXSk7CiAgICAgIGV2ZW50cy5wdXNoKHtjYWxsYmFjazogY2FsbGJhY2ssIGNvbnRleHQ6IGNvbnRleHQsIGN0eDogY29udGV4dCB8fCB0aGlzfSk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvLyBCaW5kIGFuIGV2ZW50IHRvIG9ubHkgYmUgdHJpZ2dlcmVkIGEgc2luZ2xlIHRpbWUuIEFmdGVyIHRoZSBmaXJzdCB0aW1lCiAgICAvLyB0aGUgY2FsbGJhY2sgaXMgaW52b2tlZCwgaXQgd2lsbCBiZSByZW1vdmVkLgogICAgb25jZTogZnVuY3Rpb24obmFtZSwgY2FsbGJhY2ssIGNvbnRleHQpIHsKICAgICAgaWYgKCFldmVudHNBcGkodGhpcywgJ29uY2UnLCBuYW1lLCBbY2FsbGJhY2ssIGNvbnRleHRdKSB8fCAhY2FsbGJhY2spIHJldHVybiB0aGlzOwogICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgIHZhciBvbmNlID0gXy5vbmNlKGZ1bmN0aW9uKCkgewogICAgICAgIHNlbGYub2ZmKG5hbWUsIG9uY2UpOwogICAgICAgIGNhbGxiYWNrLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0pOwogICAgICBvbmNlLl9jYWxsYmFjayA9IGNhbGxiYWNrOwogICAgICByZXR1cm4gdGhpcy5vbihuYW1lLCBvbmNlLCBjb250ZXh0KTsKICAgIH0sCgogICAgLy8gUmVtb3ZlIG9uZSBvciBtYW55IGNhbGxiYWNrcy4gSWYgYGNvbnRleHRgIGlzIG51bGwsIHJlbW92ZXMgYWxsCiAgICAvLyBjYWxsYmFja3Mgd2l0aCB0aGF0IGZ1bmN0aW9uLiBJZiBgY2FsbGJhY2tgIGlzIG51bGwsIHJlbW92ZXMgYWxsCiAgICAvLyBjYWxsYmFja3MgZm9yIHRoZSBldmVudC4gSWYgYG5hbWVgIGlzIG51bGwsIHJlbW92ZXMgYWxsIGJvdW5kCiAgICAvLyBjYWxsYmFja3MgZm9yIGFsbCBldmVudHMuCiAgICBvZmY6IGZ1bmN0aW9uKG5hbWUsIGNhbGxiYWNrLCBjb250ZXh0KSB7CiAgICAgIHZhciByZXRhaW4sIGV2LCBldmVudHMsIG5hbWVzLCBpLCBsLCBqLCBrOwogICAgICBpZiAoIXRoaXMuX2V2ZW50cyB8fCAhZXZlbnRzQXBpKHRoaXMsICdvZmYnLCBuYW1lLCBbY2FsbGJhY2ssIGNvbnRleHRdKSkgcmV0dXJuIHRoaXM7CiAgICAgIGlmICghbmFtZSAmJiAhY2FsbGJhY2sgJiYgIWNvbnRleHQpIHsKICAgICAgICB0aGlzLl9ldmVudHMgPSB2b2lkIDA7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgbmFtZXMgPSBuYW1lID8gW25hbWVdIDogXy5rZXlzKHRoaXMuX2V2ZW50cyk7CiAgICAgIGZvciAoaSA9IDAsIGwgPSBuYW1lcy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBuYW1lID0gbmFtZXNbaV07CiAgICAgICAgaWYgKGV2ZW50cyA9IHRoaXMuX2V2ZW50c1tuYW1lXSkgewogICAgICAgICAgdGhpcy5fZXZlbnRzW25hbWVdID0gcmV0YWluID0gW107CiAgICAgICAgICBpZiAoY2FsbGJhY2sgfHwgY29udGV4dCkgewogICAgICAgICAgICBmb3IgKGogPSAwLCBrID0gZXZlbnRzLmxlbmd0aDsgaiA8IGs7IGorKykgewogICAgICAgICAgICAgIGV2ID0gZXZlbnRzW2pdOwogICAgICAgICAgICAgIGlmICgoY2FsbGJhY2sgJiYgY2FsbGJhY2sgIT09IGV2LmNhbGxiYWNrICYmIGNhbGxiYWNrICE9PSBldi5jYWxsYmFjay5fY2FsbGJhY2spIHx8CiAgICAgICAgICAgICAgICAgIChjb250ZXh0ICYmIGNvbnRleHQgIT09IGV2LmNvbnRleHQpKSB7CiAgICAgICAgICAgICAgICByZXRhaW4ucHVzaChldik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoIXJldGFpbi5sZW5ndGgpIGRlbGV0ZSB0aGlzLl9ldmVudHNbbmFtZV07CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLy8gVHJpZ2dlciBvbmUgb3IgbWFueSBldmVudHMsIGZpcmluZyBhbGwgYm91bmQgY2FsbGJhY2tzLiBDYWxsYmFja3MgYXJlCiAgICAvLyBwYXNzZWQgdGhlIHNhbWUgYXJndW1lbnRzIGFzIGB0cmlnZ2VyYCBpcywgYXBhcnQgZnJvbSB0aGUgZXZlbnQgbmFtZQogICAgLy8gKHVubGVzcyB5b3UncmUgbGlzdGVuaW5nIG9uIGAiYWxsImAsIHdoaWNoIHdpbGwgY2F1c2UgeW91ciBjYWxsYmFjayB0bwogICAgLy8gcmVjZWl2ZSB0aGUgdHJ1ZSBuYW1lIG9mIHRoZSBldmVudCBhcyB0aGUgZmlyc3QgYXJndW1lbnQpLgogICAgdHJpZ2dlcjogZnVuY3Rpb24obmFtZSkgewogICAgICBpZiAoIXRoaXMuX2V2ZW50cykgcmV0dXJuIHRoaXM7CiAgICAgIHZhciBhcmdzID0gc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpOwogICAgICBpZiAoIWV2ZW50c0FwaSh0aGlzLCAndHJpZ2dlcicsIG5hbWUsIGFyZ3MpKSByZXR1cm4gdGhpczsKICAgICAgdmFyIGV2ZW50cyA9IHRoaXMuX2V2ZW50c1tuYW1lXTsKICAgICAgdmFyIGFsbEV2ZW50cyA9IHRoaXMuX2V2ZW50cy5hbGw7CiAgICAgIGlmIChldmVudHMpIHRyaWdnZXJFdmVudHMoZXZlbnRzLCBhcmdzKTsKICAgICAgaWYgKGFsbEV2ZW50cykgdHJpZ2dlckV2ZW50cyhhbGxFdmVudHMsIGFyZ3VtZW50cyk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvLyBUZWxsIHRoaXMgb2JqZWN0IHRvIHN0b3AgbGlzdGVuaW5nIHRvIGVpdGhlciBzcGVjaWZpYyBldmVudHMgLi4uIG9yCiAgICAvLyB0byBldmVyeSBvYmplY3QgaXQncyBjdXJyZW50bHkgbGlzdGVuaW5nIHRvLgogICAgc3RvcExpc3RlbmluZzogZnVuY3Rpb24ob2JqLCBuYW1lLCBjYWxsYmFjaykgewogICAgICB2YXIgbGlzdGVuaW5nVG8gPSB0aGlzLl9saXN0ZW5pbmdUbzsKICAgICAgaWYgKCFsaXN0ZW5pbmdUbykgcmV0dXJuIHRoaXM7CiAgICAgIHZhciByZW1vdmUgPSAhbmFtZSAmJiAhY2FsbGJhY2s7CiAgICAgIGlmICghY2FsbGJhY2sgJiYgdHlwZW9mIG5hbWUgPT09ICdvYmplY3QnKSBjYWxsYmFjayA9IHRoaXM7CiAgICAgIGlmIChvYmopIChsaXN0ZW5pbmdUbyA9IHt9KVtvYmouX2xpc3RlbklkXSA9IG9iajsKICAgICAgZm9yICh2YXIgaWQgaW4gbGlzdGVuaW5nVG8pIHsKICAgICAgICBvYmogPSBsaXN0ZW5pbmdUb1tpZF07CiAgICAgICAgb2JqLm9mZihuYW1lLCBjYWxsYmFjaywgdGhpcyk7CiAgICAgICAgaWYgKHJlbW92ZSB8fCBfLmlzRW1wdHkob2JqLl9ldmVudHMpKSBkZWxldGUgdGhpcy5fbGlzdGVuaW5nVG9baWRdOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICB9OwoKICAvLyBSZWd1bGFyIGV4cHJlc3Npb24gdXNlZCB0byBzcGxpdCBldmVudCBzdHJpbmdzLgogIHZhciBldmVudFNwbGl0dGVyID0gL1xzKy87CgogIC8vIEltcGxlbWVudCBmYW5jeSBmZWF0dXJlcyBvZiB0aGUgRXZlbnRzIEFQSSBzdWNoIGFzIG11bHRpcGxlIGV2ZW50CiAgLy8gbmFtZXMgYCJjaGFuZ2UgYmx1ciJgIGFuZCBqUXVlcnktc3R5bGUgZXZlbnQgbWFwcyBge2NoYW5nZTogYWN0aW9ufWAKICAvLyBpbiB0ZXJtcyBvZiB0aGUgZXhpc3RpbmcgQVBJLgogIHZhciBldmVudHNBcGkgPSBmdW5jdGlvbihvYmosIGFjdGlvbiwgbmFtZSwgcmVzdCkgewogICAgaWYgKCFuYW1lKSByZXR1cm4gdHJ1ZTsKCiAgICAvLyBIYW5kbGUgZXZlbnQgbWFwcy4KICAgIGlmICh0eXBlb2YgbmFtZSA9PT0gJ29iamVjdCcpIHsKICAgICAgZm9yICh2YXIga2V5IGluIG5hbWUpIHsKICAgICAgICBvYmpbYWN0aW9uXS5hcHBseShvYmosIFtrZXksIG5hbWVba2V5XV0uY29uY2F0KHJlc3QpKTsKICAgICAgfQogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLy8gSGFuZGxlIHNwYWNlIHNlcGFyYXRlZCBldmVudCBuYW1lcy4KICAgIGlmIChldmVudFNwbGl0dGVyLnRlc3QobmFtZSkpIHsKICAgICAgdmFyIG5hbWVzID0gbmFtZS5zcGxpdChldmVudFNwbGl0dGVyKTsKICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSBuYW1lcy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBvYmpbYWN0aW9uXS5hcHBseShvYmosIFtuYW1lc1tpXV0uY29uY2F0KHJlc3QpKTsKICAgICAgfQogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgcmV0dXJuIHRydWU7CiAgfTsKCiAgLy8gQSBkaWZmaWN1bHQtdG8tYmVsaWV2ZSwgYnV0IG9wdGltaXplZCBpbnRlcm5hbCBkaXNwYXRjaCBmdW5jdGlvbiBmb3IKICAvLyB0cmlnZ2VyaW5nIGV2ZW50cy4gVHJpZXMgdG8ga2VlcCB0aGUgdXN1YWwgY2FzZXMgc3BlZWR5IChtb3N0IGludGVybmFsCiAgLy8gQmFja2JvbmUgZXZlbnRzIGhhdmUgMyBhcmd1bWVudHMpLgogIHZhciB0cmlnZ2VyRXZlbnRzID0gZnVuY3Rpb24oZXZlbnRzLCBhcmdzKSB7CiAgICB2YXIgZXYsIGkgPSAtMSwgbCA9IGV2ZW50cy5sZW5ndGgsIGExID0gYXJnc1swXSwgYTIgPSBhcmdzWzFdLCBhMyA9IGFyZ3NbMl07CiAgICBzd2l0Y2ggKGFyZ3MubGVuZ3RoKSB7CiAgICAgIGNhc2UgMDogd2hpbGUgKCsraSA8IGwpIChldiA9IGV2ZW50c1tpXSkuY2FsbGJhY2suY2FsbChldi5jdHgpOyByZXR1cm47CiAgICAgIGNhc2UgMTogd2hpbGUgKCsraSA8IGwpIChldiA9IGV2ZW50c1tpXSkuY2FsbGJhY2suY2FsbChldi5jdHgsIGExKTsgcmV0dXJuOwogICAgICBjYXNlIDI6IHdoaWxlICgrK2kgPCBsKSAoZXYgPSBldmVudHNbaV0pLmNhbGxiYWNrLmNhbGwoZXYuY3R4LCBhMSwgYTIpOyByZXR1cm47CiAgICAgIGNhc2UgMzogd2hpbGUgKCsraSA8IGwpIChldiA9IGV2ZW50c1tpXSkuY2FsbGJhY2suY2FsbChldi5jdHgsIGExLCBhMiwgYTMpOyByZXR1cm47CiAgICAgIGRlZmF1bHQ6IHdoaWxlICgrK2kgPCBsKSAoZXYgPSBldmVudHNbaV0pLmNhbGxiYWNrLmFwcGx5KGV2LmN0eCwgYXJncyk7IHJldHVybjsKICAgIH0KICB9OwoKICB2YXIgbGlzdGVuTWV0aG9kcyA9IHtsaXN0ZW5UbzogJ29uJywgbGlzdGVuVG9PbmNlOiAnb25jZSd9OwoKICAvLyBJbnZlcnNpb24tb2YtY29udHJvbCB2ZXJzaW9ucyBvZiBgb25gIGFuZCBgb25jZWAuIFRlbGwgKnRoaXMqIG9iamVjdCB0bwogIC8vIGxpc3RlbiB0byBhbiBldmVudCBpbiBhbm90aGVyIG9iamVjdCAuLi4ga2VlcGluZyB0cmFjayBvZiB3aGF0IGl0J3MKICAvLyBsaXN0ZW5pbmcgdG8uCiAgXy5lYWNoKGxpc3Rlbk1ldGhvZHMsIGZ1bmN0aW9uKGltcGxlbWVudGF0aW9uLCBtZXRob2QpIHsKICAgIEV2ZW50c1ttZXRob2RdID0gZnVuY3Rpb24ob2JqLCBuYW1lLCBjYWxsYmFjaykgewogICAgICB2YXIgbGlzdGVuaW5nVG8gPSB0aGlzLl9saXN0ZW5pbmdUbyB8fCAodGhpcy5fbGlzdGVuaW5nVG8gPSB7fSk7CiAgICAgIHZhciBpZCA9IG9iai5fbGlzdGVuSWQgfHwgKG9iai5fbGlzdGVuSWQgPSBfLnVuaXF1ZUlkKCdsJykpOwogICAgICBsaXN0ZW5pbmdUb1tpZF0gPSBvYmo7CiAgICAgIGlmICghY2FsbGJhY2sgJiYgdHlwZW9mIG5hbWUgPT09ICdvYmplY3QnKSBjYWxsYmFjayA9IHRoaXM7CiAgICAgIG9ialtpbXBsZW1lbnRhdGlvbl0obmFtZSwgY2FsbGJhY2ssIHRoaXMpOwogICAgICByZXR1cm4gdGhpczsKICAgIH07CiAgfSk7CgogIC8vIEFsaWFzZXMgZm9yIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5LgogIEV2ZW50cy5iaW5kICAgPSBFdmVudHMub247CiAgRXZlbnRzLnVuYmluZCA9IEV2ZW50cy5vZmY7CgogIC8vIEFsbG93IHRoZSBgQmFja2JvbmVgIG9iamVjdCB0byBzZXJ2ZSBhcyBhIGdsb2JhbCBldmVudCBidXMsIGZvciBmb2xrcyB3aG8KICAvLyB3YW50IGdsb2JhbCAicHVic3ViIiBpbiBhIGNvbnZlbmllbnQgcGxhY2UuCiAgXy5leHRlbmQoQmFja2JvbmUsIEV2ZW50cyk7CgogIC8vIEJhY2tib25lLk1vZGVsCiAgLy8gLS0tLS0tLS0tLS0tLS0KCiAgLy8gQmFja2JvbmUgKipNb2RlbHMqKiBhcmUgdGhlIGJhc2ljIGRhdGEgb2JqZWN0IGluIHRoZSBmcmFtZXdvcmsgLS0KICAvLyBmcmVxdWVudGx5IHJlcHJlc2VudGluZyBhIHJvdyBpbiBhIHRhYmxlIGluIGEgZGF0YWJhc2Ugb24geW91ciBzZXJ2ZXIuCiAgLy8gQSBkaXNjcmV0ZSBjaHVuayBvZiBkYXRhIGFuZCBhIGJ1bmNoIG9mIHVzZWZ1bCwgcmVsYXRlZCBtZXRob2RzIGZvcgogIC8vIHBlcmZvcm1pbmcgY29tcHV0YXRpb25zIGFuZCB0cmFuc2Zvcm1hdGlvbnMgb24gdGhhdCBkYXRhLgoKICAvLyBDcmVhdGUgYSBuZXcgbW9kZWwgd2l0aCB0aGUgc3BlY2lmaWVkIGF0dHJpYnV0ZXMuIEEgY2xpZW50IGlkIChgY2lkYCkKICAvLyBpcyBhdXRvbWF0aWNhbGx5IGdlbmVyYXRlZCBhbmQgYXNzaWduZWQgZm9yIHlvdS4KICB2YXIgTW9kZWwgPSBCYWNrYm9uZS5Nb2RlbCA9IGZ1bmN0aW9uKGF0dHJpYnV0ZXMsIG9wdGlvbnMpIHsKICAgIHZhciBhdHRycyA9IGF0dHJpYnV0ZXMgfHwge307CiAgICBvcHRpb25zIHx8IChvcHRpb25zID0ge30pOwogICAgdGhpcy5jaWQgPSBfLnVuaXF1ZUlkKCdjJyk7CiAgICB0aGlzLmF0dHJpYnV0ZXMgPSB7fTsKICAgIGlmIChvcHRpb25zLmNvbGxlY3Rpb24pIHRoaXMuY29sbGVjdGlvbiA9IG9wdGlvbnMuY29sbGVjdGlvbjsKICAgIGlmIChvcHRpb25zLnBhcnNlKSBhdHRycyA9IHRoaXMucGFyc2UoYXR0cnMsIG9wdGlvbnMpIHx8IHt9OwogICAgYXR0cnMgPSBfLmRlZmF1bHRzKHt9LCBhdHRycywgXy5yZXN1bHQodGhpcywgJ2RlZmF1bHRzJykpOwogICAgdGhpcy5zZXQoYXR0cnMsIG9wdGlvbnMpOwogICAgdGhpcy5jaGFuZ2VkID0ge307CiAgICB0aGlzLmluaXRpYWxpemUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICB9OwoKICAvLyBBdHRhY2ggYWxsIGluaGVyaXRhYmxlIG1ldGhvZHMgdG8gdGhlIE1vZGVsIHByb3RvdHlwZS4KICBfLmV4dGVuZChNb2RlbC5wcm90b3R5cGUsIEV2ZW50cywgewoKICAgIC8vIEEgaGFzaCBvZiBhdHRyaWJ1dGVzIHdob3NlIGN1cnJlbnQgYW5kIHByZXZpb3VzIHZhbHVlIGRpZmZlci4KICAgIGNoYW5nZWQ6IG51bGwsCgogICAgLy8gVGhlIHZhbHVlIHJldHVybmVkIGR1cmluZyB0aGUgbGFzdCBmYWlsZWQgdmFsaWRhdGlvbi4KICAgIHZhbGlkYXRpb25FcnJvcjogbnVsbCwKCiAgICAvLyBUaGUgZGVmYXVsdCBuYW1lIGZvciB0aGUgSlNPTiBgaWRgIGF0dHJpYnV0ZSBpcyBgImlkImAuIE1vbmdvREIgYW5kCiAgICAvLyBDb3VjaERCIHVzZXJzIG1heSB3YW50IHRvIHNldCB0aGlzIHRvIGAiX2lkImAuCiAgICBpZEF0dHJpYnV0ZTogJ2lkJywKCiAgICAvLyBJbml0aWFsaXplIGlzIGFuIGVtcHR5IGZ1bmN0aW9uIGJ5IGRlZmF1bHQuIE92ZXJyaWRlIGl0IHdpdGggeW91ciBvd24KICAgIC8vIGluaXRpYWxpemF0aW9uIGxvZ2ljLgogICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKXt9LAoKICAgIC8vIFJldHVybiBhIGNvcHkgb2YgdGhlIG1vZGVsJ3MgYGF0dHJpYnV0ZXNgIG9iamVjdC4KICAgIHRvSlNPTjogZnVuY3Rpb24ob3B0aW9ucykgewogICAgICByZXR1cm4gXy5jbG9uZSh0aGlzLmF0dHJpYnV0ZXMpOwogICAgfSwKCiAgICAvLyBQcm94eSBgQmFja2JvbmUuc3luY2AgYnkgZGVmYXVsdCAtLSBidXQgb3ZlcnJpZGUgdGhpcyBpZiB5b3UgbmVlZAogICAgLy8gY3VzdG9tIHN5bmNpbmcgc2VtYW50aWNzIGZvciAqdGhpcyogcGFydGljdWxhciBtb2RlbC4KICAgIHN5bmM6IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gQmFja2JvbmUuc3luYy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgfSwKCiAgICAvLyBHZXQgdGhlIHZhbHVlIG9mIGFuIGF0dHJpYnV0ZS4KICAgIGdldDogZnVuY3Rpb24oYXR0cikgewogICAgICByZXR1cm4gdGhpcy5hdHRyaWJ1dGVzW2F0dHJdOwogICAgfSwKCiAgICAvLyBHZXQgdGhlIEhUTUwtZXNjYXBlZCB2YWx1ZSBvZiBhbiBhdHRyaWJ1dGUuCiAgICBlc2NhcGU6IGZ1bmN0aW9uKGF0dHIpIHsKICAgICAgcmV0dXJuIF8uZXNjYXBlKHRoaXMuZ2V0KGF0dHIpKTsKICAgIH0sCgogICAgLy8gUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGF0dHJpYnV0ZSBjb250YWlucyBhIHZhbHVlIHRoYXQgaXMgbm90IG51bGwKICAgIC8vIG9yIHVuZGVmaW5lZC4KICAgIGhhczogZnVuY3Rpb24oYXR0cikgewogICAgICByZXR1cm4gdGhpcy5nZXQoYXR0cikgIT0gbnVsbDsKICAgIH0sCgogICAgLy8gU2V0IGEgaGFzaCBvZiBtb2RlbCBhdHRyaWJ1dGVzIG9uIHRoZSBvYmplY3QsIGZpcmluZyBgImNoYW5nZSJgLiBUaGlzIGlzCiAgICAvLyB0aGUgY29yZSBwcmltaXRpdmUgb3BlcmF0aW9uIG9mIGEgbW9kZWwsIHVwZGF0aW5nIHRoZSBkYXRhIGFuZCBub3RpZnlpbmcKICAgIC8vIGFueW9uZSB3aG8gbmVlZHMgdG8ga25vdyBhYm91dCB0aGUgY2hhbmdlIGluIHN0YXRlLiBUaGUgaGVhcnQgb2YgdGhlIGJlYXN0LgogICAgc2V0OiBmdW5jdGlvbihrZXksIHZhbCwgb3B0aW9ucykgewogICAgICB2YXIgYXR0ciwgYXR0cnMsIHVuc2V0LCBjaGFuZ2VzLCBzaWxlbnQsIGNoYW5naW5nLCBwcmV2LCBjdXJyZW50OwogICAgICBpZiAoa2V5ID09IG51bGwpIHJldHVybiB0aGlzOwoKICAgICAgLy8gSGFuZGxlIGJvdGggYCJrZXkiLCB2YWx1ZWAgYW5kIGB7a2V5OiB2YWx1ZX1gIC1zdHlsZSBhcmd1bWVudHMuCiAgICAgIGlmICh0eXBlb2Yga2V5ID09PSAnb2JqZWN0JykgewogICAgICAgIGF0dHJzID0ga2V5OwogICAgICAgIG9wdGlvbnMgPSB2YWw7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgKGF0dHJzID0ge30pW2tleV0gPSB2YWw7CiAgICAgIH0KCiAgICAgIG9wdGlvbnMgfHwgKG9wdGlvbnMgPSB7fSk7CgogICAgICAvLyBSdW4gdmFsaWRhdGlvbi4KICAgICAgaWYgKCF0aGlzLl92YWxpZGF0ZShhdHRycywgb3B0aW9ucykpIHJldHVybiBmYWxzZTsKCiAgICAgIC8vIEV4dHJhY3QgYXR0cmlidXRlcyBhbmQgb3B0aW9ucy4KICAgICAgdW5zZXQgICAgICAgICAgID0gb3B0aW9ucy51bnNldDsKICAgICAgc2lsZW50ICAgICAgICAgID0gb3B0aW9ucy5zaWxlbnQ7CiAgICAgIGNoYW5nZXMgICAgICAgICA9IFtdOwogICAgICBjaGFuZ2luZyAgICAgICAgPSB0aGlzLl9jaGFuZ2luZzsKICAgICAgdGhpcy5fY2hhbmdpbmcgID0gdHJ1ZTsKCiAgICAgIGlmICghY2hhbmdpbmcpIHsKICAgICAgICB0aGlzLl9wcmV2aW91c0F0dHJpYnV0ZXMgPSBfLmNsb25lKHRoaXMuYXR0cmlidXRlcyk7CiAgICAgICAgdGhpcy5jaGFuZ2VkID0ge307CiAgICAgIH0KICAgICAgY3VycmVudCA9IHRoaXMuYXR0cmlidXRlcywgcHJldiA9IHRoaXMuX3ByZXZpb3VzQXR0cmlidXRlczsKCiAgICAgIC8vIENoZWNrIGZvciBjaGFuZ2VzIG9mIGBpZGAuCiAgICAgIGlmICh0aGlzLmlkQXR0cmlidXRlIGluIGF0dHJzKSB0aGlzLmlkID0gYXR0cnNbdGhpcy5pZEF0dHJpYnV0ZV07CgogICAgICAvLyBGb3IgZWFjaCBgc2V0YCBhdHRyaWJ1dGUsIHVwZGF0ZSBvciBkZWxldGUgdGhlIGN1cnJlbnQgdmFsdWUuCiAgICAgIGZvciAoYXR0ciBpbiBhdHRycykgewogICAgICAgIHZhbCA9IGF0dHJzW2F0dHJdOwogICAgICAgIGlmICghXy5pc0VxdWFsKGN1cnJlbnRbYXR0cl0sIHZhbCkpIGNoYW5nZXMucHVzaChhdHRyKTsKICAgICAgICBpZiAoIV8uaXNFcXVhbChwcmV2W2F0dHJdLCB2YWwpKSB7CiAgICAgICAgICB0aGlzLmNoYW5nZWRbYXR0cl0gPSB2YWw7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGRlbGV0ZSB0aGlzLmNoYW5nZWRbYXR0cl07CiAgICAgICAgfQogICAgICAgIHVuc2V0ID8gZGVsZXRlIGN1cnJlbnRbYXR0cl0gOiBjdXJyZW50W2F0dHJdID0gdmFsOwogICAgICB9CgogICAgICAvLyBUcmlnZ2VyIGFsbCByZWxldmFudCBhdHRyaWJ1dGUgY2hhbmdlcy4KICAgICAgaWYgKCFzaWxlbnQpIHsKICAgICAgICBpZiAoY2hhbmdlcy5sZW5ndGgpIHRoaXMuX3BlbmRpbmcgPSBvcHRpb25zOwogICAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gY2hhbmdlcy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICAgIHRoaXMudHJpZ2dlcignY2hhbmdlOicgKyBjaGFuZ2VzW2ldLCB0aGlzLCBjdXJyZW50W2NoYW5nZXNbaV1dLCBvcHRpb25zKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIC8vIFlvdSBtaWdodCBiZSB3b25kZXJpbmcgd2h5IHRoZXJlJ3MgYSBgd2hpbGVgIGxvb3AgaGVyZS4gQ2hhbmdlcyBjYW4KICAgICAgLy8gYmUgcmVjdXJzaXZlbHkgbmVzdGVkIHdpdGhpbiBgImNoYW5nZSJgIGV2ZW50cy4KICAgICAgaWYgKGNoYW5naW5nKSByZXR1cm4gdGhpczsKICAgICAgaWYgKCFzaWxlbnQpIHsKICAgICAgICB3aGlsZSAodGhpcy5fcGVuZGluZykgewogICAgICAgICAgb3B0aW9ucyA9IHRoaXMuX3BlbmRpbmc7CiAgICAgICAgICB0aGlzLl9wZW5kaW5nID0gZmFsc2U7CiAgICAgICAgICB0aGlzLnRyaWdnZXIoJ2NoYW5nZScsIHRoaXMsIG9wdGlvbnMpOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLl9wZW5kaW5nID0gZmFsc2U7CiAgICAgIHRoaXMuX2NoYW5naW5nID0gZmFsc2U7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvLyBSZW1vdmUgYW4gYXR0cmlidXRlIGZyb20gdGhlIG1vZGVsLCBmaXJpbmcgYCJjaGFuZ2UiYC4gYHVuc2V0YCBpcyBhIG5vb3AKICAgIC8vIGlmIHRoZSBhdHRyaWJ1dGUgZG9lc24ndCBleGlzdC4KICAgIHVuc2V0OiBmdW5jdGlvbihhdHRyLCBvcHRpb25zKSB7CiAgICAgIHJldHVybiB0aGlzLnNldChhdHRyLCB2b2lkIDAsIF8uZXh0ZW5kKHt9LCBvcHRpb25zLCB7dW5zZXQ6IHRydWV9KSk7CiAgICB9LAoKICAgIC8vIENsZWFyIGFsbCBhdHRyaWJ1dGVzIG9uIHRoZSBtb2RlbCwgZmlyaW5nIGAiY2hhbmdlImAuCiAgICBjbGVhcjogZnVuY3Rpb24ob3B0aW9ucykgewogICAgICB2YXIgYXR0cnMgPSB7fTsKICAgICAgZm9yICh2YXIga2V5IGluIHRoaXMuYXR0cmlidXRlcykgYXR0cnNba2V5XSA9IHZvaWQgMDsKICAgICAgcmV0dXJuIHRoaXMuc2V0KGF0dHJzLCBfLmV4dGVuZCh7fSwgb3B0aW9ucywge3Vuc2V0OiB0cnVlfSkpOwogICAgfSwKCiAgICAvLyBEZXRlcm1pbmUgaWYgdGhlIG1vZGVsIGhhcyBjaGFuZ2VkIHNpbmNlIHRoZSBsYXN0IGAiY2hhbmdlImAgZXZlbnQuCiAgICAvLyBJZiB5b3Ugc3BlY2lmeSBhbiBhdHRyaWJ1dGUgbmFtZSwgZGV0ZXJtaW5lIGlmIHRoYXQgYXR0cmlidXRlIGhhcyBjaGFuZ2VkLgogICAgaGFzQ2hhbmdlZDogZnVuY3Rpb24oYXR0cikgewogICAgICBpZiAoYXR0ciA9PSBudWxsKSByZXR1cm4gIV8uaXNFbXB0eSh0aGlzLmNoYW5nZWQpOwogICAgICByZXR1cm4gXy5oYXModGhpcy5jaGFuZ2VkLCBhdHRyKTsKICAgIH0sCgogICAgLy8gUmV0dXJuIGFuIG9iamVjdCBjb250YWluaW5nIGFsbCB0aGUgYXR0cmlidXRlcyB0aGF0IGhhdmUgY2hhbmdlZCwgb3IKICAgIC8vIGZhbHNlIGlmIHRoZXJlIGFyZSBubyBjaGFuZ2VkIGF0dHJpYnV0ZXMuIFVzZWZ1bCBmb3IgZGV0ZXJtaW5pbmcgd2hhdAogICAgLy8gcGFydHMgb2YgYSB2aWV3IG5lZWQgdG8gYmUgdXBkYXRlZCBhbmQvb3Igd2hhdCBhdHRyaWJ1dGVzIG5lZWQgdG8gYmUKICAgIC8vIHBlcnNpc3RlZCB0byB0aGUgc2VydmVyLiBVbnNldCBhdHRyaWJ1dGVzIHdpbGwgYmUgc2V0IHRvIHVuZGVmaW5lZC4KICAgIC8vIFlvdSBjYW4gYWxzbyBwYXNzIGFuIGF0dHJpYnV0ZXMgb2JqZWN0IHRvIGRpZmYgYWdhaW5zdCB0aGUgbW9kZWwsCiAgICAvLyBkZXRlcm1pbmluZyBpZiB0aGVyZSAqd291bGQgYmUqIGEgY2hhbmdlLgogICAgY2hhbmdlZEF0dHJpYnV0ZXM6IGZ1bmN0aW9uKGRpZmYpIHsKICAgICAgaWYgKCFkaWZmKSByZXR1cm4gdGhpcy5oYXNDaGFuZ2VkKCkgPyBfLmNsb25lKHRoaXMuY2hhbmdlZCkgOiBmYWxzZTsKICAgICAgdmFyIHZhbCwgY2hhbmdlZCA9IGZhbHNlOwogICAgICB2YXIgb2xkID0gdGhpcy5fY2hhbmdpbmcgPyB0aGlzLl9wcmV2aW91c0F0dHJpYnV0ZXMgOiB0aGlzLmF0dHJpYnV0ZXM7CiAgICAgIGZvciAodmFyIGF0dHIgaW4gZGlmZikgewogICAgICAgIGlmIChfLmlzRXF1YWwob2xkW2F0dHJdLCAodmFsID0gZGlmZlthdHRyXSkpKSBjb250aW51ZTsKICAgICAgICAoY2hhbmdlZCB8fCAoY2hhbmdlZCA9IHt9KSlbYXR0cl0gPSB2YWw7CiAgICAgIH0KICAgICAgcmV0dXJuIGNoYW5nZWQ7CiAgICB9LAoKICAgIC8vIEdldCB0aGUgcHJldmlvdXMgdmFsdWUgb2YgYW4gYXR0cmlidXRlLCByZWNvcmRlZCBhdCB0aGUgdGltZSB0aGUgbGFzdAogICAgLy8gYCJjaGFuZ2UiYCBldmVudCB3YXMgZmlyZWQuCiAgICBwcmV2aW91czogZnVuY3Rpb24oYXR0cikgewogICAgICBpZiAoYXR0ciA9PSBudWxsIHx8ICF0aGlzLl9wcmV2aW91c0F0dHJpYnV0ZXMpIHJldHVybiBudWxsOwogICAgICByZXR1cm4gdGhpcy5fcHJldmlvdXNBdHRyaWJ1dGVzW2F0dHJdOwogICAgfSwKCiAgICAvLyBHZXQgYWxsIG9mIHRoZSBhdHRyaWJ1dGVzIG9mIHRoZSBtb2RlbCBhdCB0aGUgdGltZSBvZiB0aGUgcHJldmlvdXMKICAgIC8vIGAiY2hhbmdlImAgZXZlbnQuCiAgICBwcmV2aW91c0F0dHJpYnV0ZXM6IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gXy5jbG9uZSh0aGlzLl9wcmV2aW91c0F0dHJpYnV0ZXMpOwogICAgfSwKCiAgICAvLyBGZXRjaCB0aGUgbW9kZWwgZnJvbSB0aGUgc2VydmVyLiBJZiB0aGUgc2VydmVyJ3MgcmVwcmVzZW50YXRpb24gb2YgdGhlCiAgICAvLyBtb2RlbCBkaWZmZXJzIGZyb20gaXRzIGN1cnJlbnQgYXR0cmlidXRlcywgdGhleSB3aWxsIGJlIG92ZXJyaWRkZW4sCiAgICAvLyB0cmlnZ2VyaW5nIGEgYCJjaGFuZ2UiYCBldmVudC4KICAgIGZldGNoOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgIG9wdGlvbnMgPSBvcHRpb25zID8gXy5jbG9uZShvcHRpb25zKSA6IHt9OwogICAgICBpZiAob3B0aW9ucy5wYXJzZSA9PT0gdm9pZCAwKSBvcHRpb25zLnBhcnNlID0gdHJ1ZTsKICAgICAgdmFyIG1vZGVsID0gdGhpczsKICAgICAgdmFyIHN1Y2Nlc3MgPSBvcHRpb25zLnN1Y2Nlc3M7CiAgICAgIG9wdGlvbnMuc3VjY2VzcyA9IGZ1bmN0aW9uKHJlc3ApIHsKICAgICAgICBpZiAoIW1vZGVsLnNldChtb2RlbC5wYXJzZShyZXNwLCBvcHRpb25zKSwgb3B0aW9ucykpIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAoc3VjY2Vzcykgc3VjY2Vzcyhtb2RlbCwgcmVzcCwgb3B0aW9ucyk7CiAgICAgICAgbW9kZWwudHJpZ2dlcignc3luYycsIG1vZGVsLCByZXNwLCBvcHRpb25zKTsKICAgICAgfTsKICAgICAgd3JhcEVycm9yKHRoaXMsIG9wdGlvbnMpOwogICAgICByZXR1cm4gdGhpcy5zeW5jKCdyZWFkJywgdGhpcywgb3B0aW9ucyk7CiAgICB9LAoKICAgIC8vIFNldCBhIGhhc2ggb2YgbW9kZWwgYXR0cmlidXRlcywgYW5kIHN5bmMgdGhlIG1vZGVsIHRvIHRoZSBzZXJ2ZXIuCiAgICAvLyBJZiB0aGUgc2VydmVyIHJldHVybnMgYW4gYXR0cmlidXRlcyBoYXNoIHRoYXQgZGlmZmVycywgdGhlIG1vZGVsJ3MKICAgIC8vIHN0YXRlIHdpbGwgYmUgYHNldGAgYWdhaW4uCiAgICBzYXZlOiBmdW5jdGlvbihrZXksIHZhbCwgb3B0aW9ucykgewogICAgICB2YXIgYXR0cnMsIG1ldGhvZCwgeGhyLCBhdHRyaWJ1dGVzID0gdGhpcy5hdHRyaWJ1dGVzOwoKICAgICAgLy8gSGFuZGxlIGJvdGggYCJrZXkiLCB2YWx1ZWAgYW5kIGB7a2V5OiB2YWx1ZX1gIC1zdHlsZSBhcmd1bWVudHMuCiAgICAgIGlmIChrZXkgPT0gbnVsbCB8fCB0eXBlb2Yga2V5ID09PSAnb2JqZWN0JykgewogICAgICAgIGF0dHJzID0ga2V5OwogICAgICAgIG9wdGlvbnMgPSB2YWw7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgKGF0dHJzID0ge30pW2tleV0gPSB2YWw7CiAgICAgIH0KCiAgICAgIG9wdGlvbnMgPSBfLmV4dGVuZCh7dmFsaWRhdGU6IHRydWV9LCBvcHRpb25zKTsKCiAgICAgIC8vIElmIHdlJ3JlIG5vdCB3YWl0aW5nIGFuZCBhdHRyaWJ1dGVzIGV4aXN0LCBzYXZlIGFjdHMgYXMKICAgICAgLy8gYHNldChhdHRyKS5zYXZlKG51bGwsIG9wdHMpYCB3aXRoIHZhbGlkYXRpb24uIE90aGVyd2lzZSwgY2hlY2sgaWYKICAgICAgLy8gdGhlIG1vZGVsIHdpbGwgYmUgdmFsaWQgd2hlbiB0aGUgYXR0cmlidXRlcywgaWYgYW55LCBhcmUgc2V0LgogICAgICBpZiAoYXR0cnMgJiYgIW9wdGlvbnMud2FpdCkgewogICAgICAgIGlmICghdGhpcy5zZXQoYXR0cnMsIG9wdGlvbnMpKSByZXR1cm4gZmFsc2U7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKCF0aGlzLl92YWxpZGF0ZShhdHRycywgb3B0aW9ucykpIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgLy8gU2V0IHRlbXBvcmFyeSBhdHRyaWJ1dGVzIGlmIGB7d2FpdDogdHJ1ZX1gLgogICAgICBpZiAoYXR0cnMgJiYgb3B0aW9ucy53YWl0KSB7CiAgICAgICAgdGhpcy5hdHRyaWJ1dGVzID0gXy5leHRlbmQoe30sIGF0dHJpYnV0ZXMsIGF0dHJzKTsKICAgICAgfQoKICAgICAgLy8gQWZ0ZXIgYSBzdWNjZXNzZnVsIHNlcnZlci1zaWRlIHNhdmUsIHRoZSBjbGllbnQgaXMgKG9wdGlvbmFsbHkpCiAgICAgIC8vIHVwZGF0ZWQgd2l0aCB0aGUgc2VydmVyLXNpZGUgc3RhdGUuCiAgICAgIGlmIChvcHRpb25zLnBhcnNlID09PSB2b2lkIDApIG9wdGlvbnMucGFyc2UgPSB0cnVlOwogICAgICB2YXIgbW9kZWwgPSB0aGlzOwogICAgICB2YXIgc3VjY2VzcyA9IG9wdGlvbnMuc3VjY2VzczsKICAgICAgb3B0aW9ucy5zdWNjZXNzID0gZnVuY3Rpb24ocmVzcCkgewogICAgICAgIC8vIEVuc3VyZSBhdHRyaWJ1dGVzIGFyZSByZXN0b3JlZCBkdXJpbmcgc3luY2hyb25vdXMgc2F2ZXMuCiAgICAgICAgbW9kZWwuYXR0cmlidXRlcyA9IGF0dHJpYnV0ZXM7CiAgICAgICAgdmFyIHNlcnZlckF0dHJzID0gbW9kZWwucGFyc2UocmVzcCwgb3B0aW9ucyk7CiAgICAgICAgaWYgKG9wdGlvbnMud2FpdCkgc2VydmVyQXR0cnMgPSBfLmV4dGVuZChhdHRycyB8fCB7fSwgc2VydmVyQXR0cnMpOwogICAgICAgIGlmIChfLmlzT2JqZWN0KHNlcnZlckF0dHJzKSAmJiAhbW9kZWwuc2V0KHNlcnZlckF0dHJzLCBvcHRpb25zKSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAoc3VjY2Vzcykgc3VjY2Vzcyhtb2RlbCwgcmVzcCwgb3B0aW9ucyk7CiAgICAgICAgbW9kZWwudHJpZ2dlcignc3luYycsIG1vZGVsLCByZXNwLCBvcHRpb25zKTsKICAgICAgfTsKICAgICAgd3JhcEVycm9yKHRoaXMsIG9wdGlvbnMpOwoKICAgICAgbWV0aG9kID0gdGhpcy5pc05ldygpID8gJ2NyZWF0ZScgOiAob3B0aW9ucy5wYXRjaCA/ICdwYXRjaCcgOiAndXBkYXRlJyk7CiAgICAgIGlmIChtZXRob2QgPT09ICdwYXRjaCcpIG9wdGlvbnMuYXR0cnMgPSBhdHRyczsKICAgICAgeGhyID0gdGhpcy5zeW5jKG1ldGhvZCwgdGhpcywgb3B0aW9ucyk7CgogICAgICAvLyBSZXN0b3JlIGF0dHJpYnV0ZXMuCiAgICAgIGlmIChhdHRycyAmJiBvcHRpb25zLndhaXQpIHRoaXMuYXR0cmlidXRlcyA9IGF0dHJpYnV0ZXM7CgogICAgICByZXR1cm4geGhyOwogICAgfSwKCiAgICAvLyBEZXN0cm95IHRoaXMgbW9kZWwgb24gdGhlIHNlcnZlciBpZiBpdCB3YXMgYWxyZWFkeSBwZXJzaXN0ZWQuCiAgICAvLyBPcHRpbWlzdGljYWxseSByZW1vdmVzIHRoZSBtb2RlbCBmcm9tIGl0cyBjb2xsZWN0aW9uLCBpZiBpdCBoYXMgb25lLgogICAgLy8gSWYgYHdhaXQ6IHRydWVgIGlzIHBhc3NlZCwgd2FpdHMgZm9yIHRoZSBzZXJ2ZXIgdG8gcmVzcG9uZCBiZWZvcmUgcmVtb3ZhbC4KICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgPyBfLmNsb25lKG9wdGlvbnMpIDoge307CiAgICAgIHZhciBtb2RlbCA9IHRoaXM7CiAgICAgIHZhciBzdWNjZXNzID0gb3B0aW9ucy5zdWNjZXNzOwoKICAgICAgdmFyIGRlc3Ryb3kgPSBmdW5jdGlvbigpIHsKICAgICAgICBtb2RlbC50cmlnZ2VyKCdkZXN0cm95JywgbW9kZWwsIG1vZGVsLmNvbGxlY3Rpb24sIG9wdGlvbnMpOwogICAgICB9OwoKICAgICAgb3B0aW9ucy5zdWNjZXNzID0gZnVuY3Rpb24ocmVzcCkgewogICAgICAgIGlmIChvcHRpb25zLndhaXQgfHwgbW9kZWwuaXNOZXcoKSkgZGVzdHJveSgpOwogICAgICAgIGlmIChzdWNjZXNzKSBzdWNjZXNzKG1vZGVsLCByZXNwLCBvcHRpb25zKTsKICAgICAgICBpZiAoIW1vZGVsLmlzTmV3KCkpIG1vZGVsLnRyaWdnZXIoJ3N5bmMnLCBtb2RlbCwgcmVzcCwgb3B0aW9ucyk7CiAgICAgIH07CgogICAgICBpZiAodGhpcy5pc05ldygpKSB7CiAgICAgICAgb3B0aW9ucy5zdWNjZXNzKCk7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIHdyYXBFcnJvcih0aGlzLCBvcHRpb25zKTsKCiAgICAgIHZhciB4aHIgPSB0aGlzLnN5bmMoJ2RlbGV0ZScsIHRoaXMsIG9wdGlvbnMpOwogICAgICBpZiAoIW9wdGlvbnMud2FpdCkgZGVzdHJveSgpOwogICAgICByZXR1cm4geGhyOwogICAgfSwKCiAgICAvLyBEZWZhdWx0IFVSTCBmb3IgdGhlIG1vZGVsJ3MgcmVwcmVzZW50YXRpb24gb24gdGhlIHNlcnZlciAtLSBpZiB5b3UncmUKICAgIC8vIHVzaW5nIEJhY2tib25lJ3MgcmVzdGZ1bCBtZXRob2RzLCBvdmVycmlkZSB0aGlzIHRvIGNoYW5nZSB0aGUgZW5kcG9pbnQKICAgIC8vIHRoYXQgd2lsbCBiZSBjYWxsZWQuCiAgICB1cmw6IGZ1bmN0aW9uKCkgewogICAgICB2YXIgYmFzZSA9CiAgICAgICAgXy5yZXN1bHQodGhpcywgJ3VybFJvb3QnKSB8fAogICAgICAgIF8ucmVzdWx0KHRoaXMuY29sbGVjdGlvbiwgJ3VybCcpIHx8CiAgICAgICAgdXJsRXJyb3IoKTsKICAgICAgaWYgKHRoaXMuaXNOZXcoKSkgcmV0dXJuIGJhc2U7CiAgICAgIHJldHVybiBiYXNlLnJlcGxhY2UoLyhbXlwvXSkkLywgJyQxLycpICsgZW5jb2RlVVJJQ29tcG9uZW50KHRoaXMuaWQpOwogICAgfSwKCiAgICAvLyAqKnBhcnNlKiogY29udmVydHMgYSByZXNwb25zZSBpbnRvIHRoZSBoYXNoIG9mIGF0dHJpYnV0ZXMgdG8gYmUgYHNldGAgb24KICAgIC8vIHRoZSBtb2RlbC4gVGhlIGRlZmF1bHQgaW1wbGVtZW50YXRpb24gaXMganVzdCB0byBwYXNzIHRoZSByZXNwb25zZSBhbG9uZy4KICAgIHBhcnNlOiBmdW5jdGlvbihyZXNwLCBvcHRpb25zKSB7CiAgICAgIHJldHVybiByZXNwOwogICAgfSwKCiAgICAvLyBDcmVhdGUgYSBuZXcgbW9kZWwgd2l0aCBpZGVudGljYWwgYXR0cmlidXRlcyB0byB0aGlzIG9uZS4KICAgIGNsb25lOiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKHRoaXMuYXR0cmlidXRlcyk7CiAgICB9LAoKICAgIC8vIEEgbW9kZWwgaXMgbmV3IGlmIGl0IGhhcyBuZXZlciBiZWVuIHNhdmVkIHRvIHRoZSBzZXJ2ZXIsIGFuZCBsYWNrcyBhbiBpZC4KICAgIGlzTmV3OiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuICF0aGlzLmhhcyh0aGlzLmlkQXR0cmlidXRlKTsKICAgIH0sCgogICAgLy8gQ2hlY2sgaWYgdGhlIG1vZGVsIGlzIGN1cnJlbnRseSBpbiBhIHZhbGlkIHN0YXRlLgogICAgaXNWYWxpZDogZnVuY3Rpb24ob3B0aW9ucykgewogICAgICByZXR1cm4gdGhpcy5fdmFsaWRhdGUoe30sIF8uZXh0ZW5kKG9wdGlvbnMgfHwge30sIHsgdmFsaWRhdGU6IHRydWUgfSkpOwogICAgfSwKCiAgICAvLyBSdW4gdmFsaWRhdGlvbiBhZ2FpbnN0IHRoZSBuZXh0IGNvbXBsZXRlIHNldCBvZiBtb2RlbCBhdHRyaWJ1dGVzLAogICAgLy8gcmV0dXJuaW5nIGB0cnVlYCBpZiBhbGwgaXMgd2VsbC4gT3RoZXJ3aXNlLCBmaXJlIGFuIGAiaW52YWxpZCJgIGV2ZW50LgogICAgX3ZhbGlkYXRlOiBmdW5jdGlvbihhdHRycywgb3B0aW9ucykgewogICAgICBpZiAoIW9wdGlvbnMudmFsaWRhdGUgfHwgIXRoaXMudmFsaWRhdGUpIHJldHVybiB0cnVlOwogICAgICBhdHRycyA9IF8uZXh0ZW5kKHt9LCB0aGlzLmF0dHJpYnV0ZXMsIGF0dHJzKTsKICAgICAgdmFyIGVycm9yID0gdGhpcy52YWxpZGF0aW9uRXJyb3IgPSB0aGlzLnZhbGlkYXRlKGF0dHJzLCBvcHRpb25zKSB8fCBudWxsOwogICAgICBpZiAoIWVycm9yKSByZXR1cm4gdHJ1ZTsKICAgICAgdGhpcy50cmlnZ2VyKCdpbnZhbGlkJywgdGhpcywgZXJyb3IsIF8uZXh0ZW5kKG9wdGlvbnMsIHt2YWxpZGF0aW9uRXJyb3I6IGVycm9yfSkpOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogIH0pOwoKICAvLyBVbmRlcnNjb3JlIG1ldGhvZHMgdGhhdCB3ZSB3YW50IHRvIGltcGxlbWVudCBvbiB0aGUgTW9kZWwuCiAgdmFyIG1vZGVsTWV0aG9kcyA9IFsna2V5cycsICd2YWx1ZXMnLCAncGFpcnMnLCAnaW52ZXJ0JywgJ3BpY2snLCAnb21pdCddOwoKICAvLyBNaXggaW4gZWFjaCBVbmRlcnNjb3JlIG1ldGhvZCBhcyBhIHByb3h5IHRvIGBNb2RlbCNhdHRyaWJ1dGVzYC4KICBfLmVhY2gobW9kZWxNZXRob2RzLCBmdW5jdGlvbihtZXRob2QpIHsKICAgIE1vZGVsLnByb3RvdHlwZVttZXRob2RdID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBhcmdzID0gc2xpY2UuY2FsbChhcmd1bWVudHMpOwogICAgICBhcmdzLnVuc2hpZnQodGhpcy5hdHRyaWJ1dGVzKTsKICAgICAgcmV0dXJuIF9bbWV0aG9kXS5hcHBseShfLCBhcmdzKTsKICAgIH07CiAgfSk7CgogIC8vIEJhY2tib25lLkNvbGxlY3Rpb24KICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tCgogIC8vIElmIG1vZGVscyB0ZW5kIHRvIHJlcHJlc2VudCBhIHNpbmdsZSByb3cgb2YgZGF0YSwgYSBCYWNrYm9uZSBDb2xsZWN0aW9uIGlzCiAgLy8gbW9yZSBhbmFsYWdvdXMgdG8gYSB0YWJsZSBmdWxsIG9mIGRhdGEgLi4uIG9yIGEgc21hbGwgc2xpY2Ugb3IgcGFnZSBvZiB0aGF0CiAgLy8gdGFibGUsIG9yIGEgY29sbGVjdGlvbiBvZiByb3dzIHRoYXQgYmVsb25nIHRvZ2V0aGVyIGZvciBhIHBhcnRpY3VsYXIgcmVhc29uCiAgLy8gLS0gYWxsIG9mIHRoZSBtZXNzYWdlcyBpbiB0aGlzIHBhcnRpY3VsYXIgZm9sZGVyLCBhbGwgb2YgdGhlIGRvY3VtZW50cwogIC8vIGJlbG9uZ2luZyB0byB0aGlzIHBhcnRpY3VsYXIgYXV0aG9yLCBhbmQgc28gb24uIENvbGxlY3Rpb25zIG1haW50YWluCiAgLy8gaW5kZXhlcyBvZiB0aGVpciBtb2RlbHMsIGJvdGggaW4gb3JkZXIsIGFuZCBmb3IgbG9va3VwIGJ5IGBpZGAuCgogIC8vIENyZWF0ZSBhIG5ldyAqKkNvbGxlY3Rpb24qKiwgcGVyaGFwcyB0byBjb250YWluIGEgc3BlY2lmaWMgdHlwZSBvZiBgbW9kZWxgLgogIC8vIElmIGEgYGNvbXBhcmF0b3JgIGlzIHNwZWNpZmllZCwgdGhlIENvbGxlY3Rpb24gd2lsbCBtYWludGFpbgogIC8vIGl0cyBtb2RlbHMgaW4gc29ydCBvcmRlciwgYXMgdGhleSdyZSBhZGRlZCBhbmQgcmVtb3ZlZC4KICB2YXIgQ29sbGVjdGlvbiA9IEJhY2tib25lLkNvbGxlY3Rpb24gPSBmdW5jdGlvbihtb2RlbHMsIG9wdGlvbnMpIHsKICAgIG9wdGlvbnMgfHwgKG9wdGlvbnMgPSB7fSk7CiAgICBpZiAob3B0aW9ucy5tb2RlbCkgdGhpcy5tb2RlbCA9IG9wdGlvbnMubW9kZWw7CiAgICBpZiAob3B0aW9ucy5jb21wYXJhdG9yICE9PSB2b2lkIDApIHRoaXMuY29tcGFyYXRvciA9IG9wdGlvbnMuY29tcGFyYXRvcjsKICAgIHRoaXMuX3Jlc2V0KCk7CiAgICB0aGlzLmluaXRpYWxpemUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIGlmIChtb2RlbHMpIHRoaXMucmVzZXQobW9kZWxzLCBfLmV4dGVuZCh7c2lsZW50OiB0cnVlfSwgb3B0aW9ucykpOwogIH07CgogIC8vIERlZmF1bHQgb3B0aW9ucyBmb3IgYENvbGxlY3Rpb24jc2V0YC4KICB2YXIgc2V0T3B0aW9ucyA9IHthZGQ6IHRydWUsIHJlbW92ZTogdHJ1ZSwgbWVyZ2U6IHRydWV9OwogIHZhciBhZGRPcHRpb25zID0ge2FkZDogdHJ1ZSwgcmVtb3ZlOiBmYWxzZX07CgogIC8vIERlZmluZSB0aGUgQ29sbGVjdGlvbidzIGluaGVyaXRhYmxlIG1ldGhvZHMuCiAgXy5leHRlbmQoQ29sbGVjdGlvbi5wcm90b3R5cGUsIEV2ZW50cywgewoKICAgIC8vIFRoZSBkZWZhdWx0IG1vZGVsIGZvciBhIGNvbGxlY3Rpb24gaXMganVzdCBhICoqQmFja2JvbmUuTW9kZWwqKi4KICAgIC8vIFRoaXMgc2hvdWxkIGJlIG92ZXJyaWRkZW4gaW4gbW9zdCBjYXNlcy4KICAgIG1vZGVsOiBNb2RlbCwKCiAgICAvLyBJbml0aWFsaXplIGlzIGFuIGVtcHR5IGZ1bmN0aW9uIGJ5IGRlZmF1bHQuIE92ZXJyaWRlIGl0IHdpdGggeW91ciBvd24KICAgIC8vIGluaXRpYWxpemF0aW9uIGxvZ2ljLgogICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKXt9LAoKICAgIC8vIFRoZSBKU09OIHJlcHJlc2VudGF0aW9uIG9mIGEgQ29sbGVjdGlvbiBpcyBhbiBhcnJheSBvZiB0aGUKICAgIC8vIG1vZGVscycgYXR0cmlidXRlcy4KICAgIHRvSlNPTjogZnVuY3Rpb24ob3B0aW9ucykgewogICAgICByZXR1cm4gdGhpcy5tYXAoZnVuY3Rpb24obW9kZWwpeyByZXR1cm4gbW9kZWwudG9KU09OKG9wdGlvbnMpOyB9KTsKICAgIH0sCgogICAgLy8gUHJveHkgYEJhY2tib25lLnN5bmNgIGJ5IGRlZmF1bHQuCiAgICBzeW5jOiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIEJhY2tib25lLnN5bmMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIH0sCgogICAgLy8gQWRkIGEgbW9kZWwsIG9yIGxpc3Qgb2YgbW9kZWxzIHRvIHRoZSBzZXQuCiAgICBhZGQ6IGZ1bmN0aW9uKG1vZGVscywgb3B0aW9ucykgewogICAgICByZXR1cm4gdGhpcy5zZXQobW9kZWxzLCBfLmV4dGVuZCh7bWVyZ2U6IGZhbHNlfSwgb3B0aW9ucywgYWRkT3B0aW9ucykpOwogICAgfSwKCiAgICAvLyBSZW1vdmUgYSBtb2RlbCwgb3IgYSBsaXN0IG9mIG1vZGVscyBmcm9tIHRoZSBzZXQuCiAgICByZW1vdmU6IGZ1bmN0aW9uKG1vZGVscywgb3B0aW9ucykgewogICAgICB2YXIgc2luZ3VsYXIgPSAhXy5pc0FycmF5KG1vZGVscyk7CiAgICAgIG1vZGVscyA9IHNpbmd1bGFyID8gW21vZGVsc10gOiBfLmNsb25lKG1vZGVscyk7CiAgICAgIG9wdGlvbnMgfHwgKG9wdGlvbnMgPSB7fSk7CiAgICAgIHZhciBpLCBsLCBpbmRleCwgbW9kZWw7CiAgICAgIGZvciAoaSA9IDAsIGwgPSBtb2RlbHMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgbW9kZWwgPSBtb2RlbHNbaV0gPSB0aGlzLmdldChtb2RlbHNbaV0pOwogICAgICAgIGlmICghbW9kZWwpIGNvbnRpbnVlOwogICAgICAgIGRlbGV0ZSB0aGlzLl9ieUlkW21vZGVsLmlkXTsKICAgICAgICBkZWxldGUgdGhpcy5fYnlJZFttb2RlbC5jaWRdOwogICAgICAgIGluZGV4ID0gdGhpcy5pbmRleE9mKG1vZGVsKTsKICAgICAgICB0aGlzLm1vZGVscy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICAgIHRoaXMubGVuZ3RoLS07CiAgICAgICAgaWYgKCFvcHRpb25zLnNpbGVudCkgewogICAgICAgICAgb3B0aW9ucy5pbmRleCA9IGluZGV4OwogICAgICAgICAgbW9kZWwudHJpZ2dlcigncmVtb3ZlJywgbW9kZWwsIHRoaXMsIG9wdGlvbnMpOwogICAgICAgIH0KICAgICAgICB0aGlzLl9yZW1vdmVSZWZlcmVuY2UobW9kZWwsIG9wdGlvbnMpOwogICAgICB9CiAgICAgIHJldHVybiBzaW5ndWxhciA/IG1vZGVsc1swXSA6IG1vZGVsczsKICAgIH0sCgogICAgLy8gVXBkYXRlIGEgY29sbGVjdGlvbiBieSBgc2V0YC1pbmcgYSBuZXcgbGlzdCBvZiBtb2RlbHMsIGFkZGluZyBuZXcgb25lcywKICAgIC8vIHJlbW92aW5nIG1vZGVscyB0aGF0IGFyZSBubyBsb25nZXIgcHJlc2VudCwgYW5kIG1lcmdpbmcgbW9kZWxzIHRoYXQKICAgIC8vIGFscmVhZHkgZXhpc3QgaW4gdGhlIGNvbGxlY3Rpb24sIGFzIG5lY2Vzc2FyeS4gU2ltaWxhciB0byAqKk1vZGVsI3NldCoqLAogICAgLy8gdGhlIGNvcmUgb3BlcmF0aW9uIGZvciB1cGRhdGluZyB0aGUgZGF0YSBjb250YWluZWQgYnkgdGhlIGNvbGxlY3Rpb24uCiAgICBzZXQ6IGZ1bmN0aW9uKG1vZGVscywgb3B0aW9ucykgewogICAgICBvcHRpb25zID0gXy5kZWZhdWx0cyh7fSwgb3B0aW9ucywgc2V0T3B0aW9ucyk7CiAgICAgIGlmIChvcHRpb25zLnBhcnNlKSBtb2RlbHMgPSB0aGlzLnBhcnNlKG1vZGVscywgb3B0aW9ucyk7CiAgICAgIHZhciBzaW5ndWxhciA9ICFfLmlzQXJyYXkobW9kZWxzKTsKICAgICAgbW9kZWxzID0gc2luZ3VsYXIgPyAobW9kZWxzID8gW21vZGVsc10gOiBbXSkgOiBfLmNsb25lKG1vZGVscyk7CiAgICAgIHZhciBpLCBsLCBpZCwgbW9kZWwsIGF0dHJzLCBleGlzdGluZywgc29ydDsKICAgICAgdmFyIGF0ID0gb3B0aW9ucy5hdDsKICAgICAgdmFyIHRhcmdldE1vZGVsID0gdGhpcy5tb2RlbDsKICAgICAgdmFyIHNvcnRhYmxlID0gdGhpcy5jb21wYXJhdG9yICYmIChhdCA9PSBudWxsKSAmJiBvcHRpb25zLnNvcnQgIT09IGZhbHNlOwogICAgICB2YXIgc29ydEF0dHIgPSBfLmlzU3RyaW5nKHRoaXMuY29tcGFyYXRvcikgPyB0aGlzLmNvbXBhcmF0b3IgOiBudWxsOwogICAgICB2YXIgdG9BZGQgPSBbXSwgdG9SZW1vdmUgPSBbXSwgbW9kZWxNYXAgPSB7fTsKICAgICAgdmFyIGFkZCA9IG9wdGlvbnMuYWRkLCBtZXJnZSA9IG9wdGlvbnMubWVyZ2UsIHJlbW92ZSA9IG9wdGlvbnMucmVtb3ZlOwogICAgICB2YXIgb3JkZXIgPSAhc29ydGFibGUgJiYgYWRkICYmIHJlbW92ZSA/IFtdIDogZmFsc2U7CgogICAgICAvLyBUdXJuIGJhcmUgb2JqZWN0cyBpbnRvIG1vZGVsIHJlZmVyZW5jZXMsIGFuZCBwcmV2ZW50IGludmFsaWQgbW9kZWxzCiAgICAgIC8vIGZyb20gYmVpbmcgYWRkZWQuCiAgICAgIGZvciAoaSA9IDAsIGwgPSBtb2RlbHMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgYXR0cnMgPSBtb2RlbHNbaV0gfHwge307CiAgICAgICAgaWYgKGF0dHJzIGluc3RhbmNlb2YgTW9kZWwpIHsKICAgICAgICAgIGlkID0gbW9kZWwgPSBhdHRyczsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWQgPSBhdHRyc1t0YXJnZXRNb2RlbC5wcm90b3R5cGUuaWRBdHRyaWJ1dGUgfHwgJ2lkJ107CiAgICAgICAgfQoKICAgICAgICAvLyBJZiBhIGR1cGxpY2F0ZSBpcyBmb3VuZCwgcHJldmVudCBpdCBmcm9tIGJlaW5nIGFkZGVkIGFuZAogICAgICAgIC8vIG9wdGlvbmFsbHkgbWVyZ2UgaXQgaW50byB0aGUgZXhpc3RpbmcgbW9kZWwuCiAgICAgICAgaWYgKGV4aXN0aW5nID0gdGhpcy5nZXQoaWQpKSB7CiAgICAgICAgICBpZiAocmVtb3ZlKSBtb2RlbE1hcFtleGlzdGluZy5jaWRdID0gdHJ1ZTsKICAgICAgICAgIGlmIChtZXJnZSkgewogICAgICAgICAgICBhdHRycyA9IGF0dHJzID09PSBtb2RlbCA/IG1vZGVsLmF0dHJpYnV0ZXMgOiBhdHRyczsKICAgICAgICAgICAgaWYgKG9wdGlvbnMucGFyc2UpIGF0dHJzID0gZXhpc3RpbmcucGFyc2UoYXR0cnMsIG9wdGlvbnMpOwogICAgICAgICAgICBleGlzdGluZy5zZXQoYXR0cnMsIG9wdGlvbnMpOwogICAgICAgICAgICBpZiAoc29ydGFibGUgJiYgIXNvcnQgJiYgZXhpc3RpbmcuaGFzQ2hhbmdlZChzb3J0QXR0cikpIHNvcnQgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgICAgbW9kZWxzW2ldID0gZXhpc3Rpbmc7CgogICAgICAgIC8vIElmIHRoaXMgaXMgYSBuZXcsIHZhbGlkIG1vZGVsLCBwdXNoIGl0IHRvIHRoZSBgdG9BZGRgIGxpc3QuCiAgICAgICAgfSBlbHNlIGlmIChhZGQpIHsKICAgICAgICAgIG1vZGVsID0gbW9kZWxzW2ldID0gdGhpcy5fcHJlcGFyZU1vZGVsKGF0dHJzLCBvcHRpb25zKTsKICAgICAgICAgIGlmICghbW9kZWwpIGNvbnRpbnVlOwogICAgICAgICAgdG9BZGQucHVzaChtb2RlbCk7CiAgICAgICAgICB0aGlzLl9hZGRSZWZlcmVuY2UobW9kZWwsIG9wdGlvbnMpOwogICAgICAgIH0KCiAgICAgICAgLy8gRG8gbm90IGFkZCBtdWx0aXBsZSBtb2RlbHMgd2l0aCB0aGUgc2FtZSBgaWRgLgogICAgICAgIG1vZGVsID0gZXhpc3RpbmcgfHwgbW9kZWw7CiAgICAgICAgaWYgKG9yZGVyICYmIChtb2RlbC5pc05ldygpIHx8ICFtb2RlbE1hcFttb2RlbC5pZF0pKSBvcmRlci5wdXNoKG1vZGVsKTsKICAgICAgICBtb2RlbE1hcFttb2RlbC5pZF0gPSB0cnVlOwogICAgICB9CgogICAgICAvLyBSZW1vdmUgbm9uZXhpc3RlbnQgbW9kZWxzIGlmIGFwcHJvcHJpYXRlLgogICAgICBpZiAocmVtb3ZlKSB7CiAgICAgICAgZm9yIChpID0gMCwgbCA9IHRoaXMubGVuZ3RoOyBpIDwgbDsgKytpKSB7CiAgICAgICAgICBpZiAoIW1vZGVsTWFwWyhtb2RlbCA9IHRoaXMubW9kZWxzW2ldKS5jaWRdKSB0b1JlbW92ZS5wdXNoKG1vZGVsKTsKICAgICAgICB9CiAgICAgICAgaWYgKHRvUmVtb3ZlLmxlbmd0aCkgdGhpcy5yZW1vdmUodG9SZW1vdmUsIG9wdGlvbnMpOwogICAgICB9CgogICAgICAvLyBTZWUgaWYgc29ydGluZyBpcyBuZWVkZWQsIHVwZGF0ZSBgbGVuZ3RoYCBhbmQgc3BsaWNlIGluIG5ldyBtb2RlbHMuCiAgICAgIGlmICh0b0FkZC5sZW5ndGggfHwgKG9yZGVyICYmIG9yZGVyLmxlbmd0aCkpIHsKICAgICAgICBpZiAoc29ydGFibGUpIHNvcnQgPSB0cnVlOwogICAgICAgIHRoaXMubGVuZ3RoICs9IHRvQWRkLmxlbmd0aDsKICAgICAgICBpZiAoYXQgIT0gbnVsbCkgewogICAgICAgICAgZm9yIChpID0gMCwgbCA9IHRvQWRkLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgICAgICB0aGlzLm1vZGVscy5zcGxpY2UoYXQgKyBpLCAwLCB0b0FkZFtpXSk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChvcmRlcikgdGhpcy5tb2RlbHMubGVuZ3RoID0gMDsKICAgICAgICAgIHZhciBvcmRlcmVkTW9kZWxzID0gb3JkZXIgfHwgdG9BZGQ7CiAgICAgICAgICBmb3IgKGkgPSAwLCBsID0gb3JkZXJlZE1vZGVscy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICAgICAgdGhpcy5tb2RlbHMucHVzaChvcmRlcmVkTW9kZWxzW2ldKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIC8vIFNpbGVudGx5IHNvcnQgdGhlIGNvbGxlY3Rpb24gaWYgYXBwcm9wcmlhdGUuCiAgICAgIGlmIChzb3J0KSB0aGlzLnNvcnQoe3NpbGVudDogdHJ1ZX0pOwoKICAgICAgLy8gVW5sZXNzIHNpbGVuY2VkLCBpdCdzIHRpbWUgdG8gZmlyZSBhbGwgYXBwcm9wcmlhdGUgYWRkL3NvcnQgZXZlbnRzLgogICAgICBpZiAoIW9wdGlvbnMuc2lsZW50KSB7CiAgICAgICAgZm9yIChpID0gMCwgbCA9IHRvQWRkLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgICAgKG1vZGVsID0gdG9BZGRbaV0pLnRyaWdnZXIoJ2FkZCcsIG1vZGVsLCB0aGlzLCBvcHRpb25zKTsKICAgICAgICB9CiAgICAgICAgaWYgKHNvcnQgfHwgKG9yZGVyICYmIG9yZGVyLmxlbmd0aCkpIHRoaXMudHJpZ2dlcignc29ydCcsIHRoaXMsIG9wdGlvbnMpOwogICAgICB9CgogICAgICAvLyBSZXR1cm4gdGhlIGFkZGVkIChvciBtZXJnZWQpIG1vZGVsIChvciBtb2RlbHMpLgogICAgICByZXR1cm4gc2luZ3VsYXIgPyBtb2RlbHNbMF0gOiBtb2RlbHM7CiAgICB9LAoKICAgIC8vIFdoZW4geW91IGhhdmUgbW9yZSBpdGVtcyB0aGFuIHlvdSB3YW50IHRvIGFkZCBvciByZW1vdmUgaW5kaXZpZHVhbGx5LAogICAgLy8geW91IGNhbiByZXNldCB0aGUgZW50aXJlIHNldCB3aXRoIGEgbmV3IGxpc3Qgb2YgbW9kZWxzLCB3aXRob3V0IGZpcmluZwogICAgLy8gYW55IGdyYW51bGFyIGBhZGRgIG9yIGByZW1vdmVgIGV2ZW50cy4gRmlyZXMgYHJlc2V0YCB3aGVuIGZpbmlzaGVkLgogICAgLy8gVXNlZnVsIGZvciBidWxrIG9wZXJhdGlvbnMgYW5kIG9wdGltaXphdGlvbnMuCiAgICByZXNldDogZnVuY3Rpb24obW9kZWxzLCBvcHRpb25zKSB7CiAgICAgIG9wdGlvbnMgfHwgKG9wdGlvbnMgPSB7fSk7CiAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gdGhpcy5tb2RlbHMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgdGhpcy5fcmVtb3ZlUmVmZXJlbmNlKHRoaXMubW9kZWxzW2ldLCBvcHRpb25zKTsKICAgICAgfQogICAgICBvcHRpb25zLnByZXZpb3VzTW9kZWxzID0gdGhpcy5tb2RlbHM7CiAgICAgIHRoaXMuX3Jlc2V0KCk7CiAgICAgIG1vZGVscyA9IHRoaXMuYWRkKG1vZGVscywgXy5leHRlbmQoe3NpbGVudDogdHJ1ZX0sIG9wdGlvbnMpKTsKICAgICAgaWYgKCFvcHRpb25zLnNpbGVudCkgdGhpcy50cmlnZ2VyKCdyZXNldCcsIHRoaXMsIG9wdGlvbnMpOwogICAgICByZXR1cm4gbW9kZWxzOwogICAgfSwKCiAgICAvLyBBZGQgYSBtb2RlbCB0byB0aGUgZW5kIG9mIHRoZSBjb2xsZWN0aW9uLgogICAgcHVzaDogZnVuY3Rpb24obW9kZWwsIG9wdGlvbnMpIHsKICAgICAgcmV0dXJuIHRoaXMuYWRkKG1vZGVsLCBfLmV4dGVuZCh7YXQ6IHRoaXMubGVuZ3RofSwgb3B0aW9ucykpOwogICAgfSwKCiAgICAvLyBSZW1vdmUgYSBtb2RlbCBmcm9tIHRoZSBlbmQgb2YgdGhlIGNvbGxlY3Rpb24uCiAgICBwb3A6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgICAgdmFyIG1vZGVsID0gdGhpcy5hdCh0aGlzLmxlbmd0aCAtIDEpOwogICAgICB0aGlzLnJlbW92ZShtb2RlbCwgb3B0aW9ucyk7CiAgICAgIHJldHVybiBtb2RlbDsKICAgIH0sCgogICAgLy8gQWRkIGEgbW9kZWwgdG8gdGhlIGJlZ2lubmluZyBvZiB0aGUgY29sbGVjdGlvbi4KICAgIHVuc2hpZnQ6IGZ1bmN0aW9uKG1vZGVsLCBvcHRpb25zKSB7CiAgICAgIHJldHVybiB0aGlzLmFkZChtb2RlbCwgXy5leHRlbmQoe2F0OiAwfSwgb3B0aW9ucykpOwogICAgfSwKCiAgICAvLyBSZW1vdmUgYSBtb2RlbCBmcm9tIHRoZSBiZWdpbm5pbmcgb2YgdGhlIGNvbGxlY3Rpb24uCiAgICBzaGlmdDogZnVuY3Rpb24ob3B0aW9ucykgewogICAgICB2YXIgbW9kZWwgPSB0aGlzLmF0KDApOwogICAgICB0aGlzLnJlbW92ZShtb2RlbCwgb3B0aW9ucyk7CiAgICAgIHJldHVybiBtb2RlbDsKICAgIH0sCgogICAgLy8gU2xpY2Ugb3V0IGEgc3ViLWFycmF5IG9mIG1vZGVscyBmcm9tIHRoZSBjb2xsZWN0aW9uLgogICAgc2xpY2U6IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gc2xpY2UuYXBwbHkodGhpcy5tb2RlbHMsIGFyZ3VtZW50cyk7CiAgICB9LAoKICAgIC8vIEdldCBhIG1vZGVsIGZyb20gdGhlIHNldCBieSBpZC4KICAgIGdldDogZnVuY3Rpb24ob2JqKSB7CiAgICAgIGlmIChvYmogPT0gbnVsbCkgcmV0dXJuIHZvaWQgMDsKICAgICAgcmV0dXJuIHRoaXMuX2J5SWRbb2JqXSB8fCB0aGlzLl9ieUlkW29iai5pZF0gfHwgdGhpcy5fYnlJZFtvYmouY2lkXTsKICAgIH0sCgogICAgLy8gR2V0IHRoZSBtb2RlbCBhdCB0aGUgZ2l2ZW4gaW5kZXguCiAgICBhdDogZnVuY3Rpb24oaW5kZXgpIHsKICAgICAgcmV0dXJuIHRoaXMubW9kZWxzW2luZGV4XTsKICAgIH0sCgogICAgLy8gUmV0dXJuIG1vZGVscyB3aXRoIG1hdGNoaW5nIGF0dHJpYnV0ZXMuIFVzZWZ1bCBmb3Igc2ltcGxlIGNhc2VzIG9mCiAgICAvLyBgZmlsdGVyYC4KICAgIHdoZXJlOiBmdW5jdGlvbihhdHRycywgZmlyc3QpIHsKICAgICAgaWYgKF8uaXNFbXB0eShhdHRycykpIHJldHVybiBmaXJzdCA/IHZvaWQgMCA6IFtdOwogICAgICByZXR1cm4gdGhpc1tmaXJzdCA/ICdmaW5kJyA6ICdmaWx0ZXInXShmdW5jdGlvbihtb2RlbCkgewogICAgICAgIGZvciAodmFyIGtleSBpbiBhdHRycykgewogICAgICAgICAgaWYgKGF0dHJzW2tleV0gIT09IG1vZGVsLmdldChrZXkpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9KTsKICAgIH0sCgogICAgLy8gUmV0dXJuIHRoZSBmaXJzdCBtb2RlbCB3aXRoIG1hdGNoaW5nIGF0dHJpYnV0ZXMuIFVzZWZ1bCBmb3Igc2ltcGxlIGNhc2VzCiAgICAvLyBvZiBgZmluZGAuCiAgICBmaW5kV2hlcmU6IGZ1bmN0aW9uKGF0dHJzKSB7CiAgICAgIHJldHVybiB0aGlzLndoZXJlKGF0dHJzLCB0cnVlKTsKICAgIH0sCgogICAgLy8gRm9yY2UgdGhlIGNvbGxlY3Rpb24gdG8gcmUtc29ydCBpdHNlbGYuIFlvdSBkb24ndCBuZWVkIHRvIGNhbGwgdGhpcyB1bmRlcgogICAgLy8gbm9ybWFsIGNpcmN1bXN0YW5jZXMsIGFzIHRoZSBzZXQgd2lsbCBtYWludGFpbiBzb3J0IG9yZGVyIGFzIGVhY2ggaXRlbQogICAgLy8gaXMgYWRkZWQuCiAgICBzb3J0OiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgIGlmICghdGhpcy5jb21wYXJhdG9yKSB0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCBzb3J0IGEgc2V0IHdpdGhvdXQgYSBjb21wYXJhdG9yJyk7CiAgICAgIG9wdGlvbnMgfHwgKG9wdGlvbnMgPSB7fSk7CgogICAgICAvLyBSdW4gc29ydCBiYXNlZCBvbiB0eXBlIG9mIGBjb21wYXJhdG9yYC4KICAgICAgaWYgKF8uaXNTdHJpbmcodGhpcy5jb21wYXJhdG9yKSB8fCB0aGlzLmNvbXBhcmF0b3IubGVuZ3RoID09PSAxKSB7CiAgICAgICAgdGhpcy5tb2RlbHMgPSB0aGlzLnNvcnRCeSh0aGlzLmNvbXBhcmF0b3IsIHRoaXMpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMubW9kZWxzLnNvcnQoXy5iaW5kKHRoaXMuY29tcGFyYXRvciwgdGhpcykpOwogICAgICB9CgogICAgICBpZiAoIW9wdGlvbnMuc2lsZW50KSB0aGlzLnRyaWdnZXIoJ3NvcnQnLCB0aGlzLCBvcHRpb25zKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAoKICAgIC8vIFBsdWNrIGFuIGF0dHJpYnV0ZSBmcm9tIGVhY2ggbW9kZWwgaW4gdGhlIGNvbGxlY3Rpb24uCiAgICBwbHVjazogZnVuY3Rpb24oYXR0cikgewogICAgICByZXR1cm4gXy5pbnZva2UodGhpcy5tb2RlbHMsICdnZXQnLCBhdHRyKTsKICAgIH0sCgogICAgLy8gRmV0Y2ggdGhlIGRlZmF1bHQgc2V0IG9mIG1vZGVscyBmb3IgdGhpcyBjb2xsZWN0aW9uLCByZXNldHRpbmcgdGhlCiAgICAvLyBjb2xsZWN0aW9uIHdoZW4gdGhleSBhcnJpdmUuIElmIGByZXNldDogdHJ1ZWAgaXMgcGFzc2VkLCB0aGUgcmVzcG9uc2UKICAgIC8vIGRhdGEgd2lsbCBiZSBwYXNzZWQgdGhyb3VnaCB0aGUgYHJlc2V0YCBtZXRob2QgaW5zdGVhZCBvZiBgc2V0YC4KICAgIGZldGNoOiBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgIG9wdGlvbnMgPSBvcHRpb25zID8gXy5jbG9uZShvcHRpb25zKSA6IHt9OwogICAgICBpZiAob3B0aW9ucy5wYXJzZSA9PT0gdm9pZCAwKSBvcHRpb25zLnBhcnNlID0gdHJ1ZTsKICAgICAgdmFyIHN1Y2Nlc3MgPSBvcHRpb25zLnN1Y2Nlc3M7CiAgICAgIHZhciBjb2xsZWN0aW9uID0gdGhpczsKICAgICAgb3B0aW9ucy5zdWNjZXNzID0gZnVuY3Rpb24ocmVzcCkgewogICAgICAgIHZhciBtZXRob2QgPSBvcHRpb25zLnJlc2V0ID8gJ3Jlc2V0JyA6ICdzZXQnOwogICAgICAgIGNvbGxlY3Rpb25bbWV0aG9kXShyZXNwLCBvcHRpb25zKTsKICAgICAgICBpZiAoc3VjY2Vzcykgc3VjY2Vzcyhjb2xsZWN0aW9uLCByZXNwLCBvcHRpb25zKTsKICAgICAgICBjb2xsZWN0aW9uLnRyaWdnZXIoJ3N5bmMnLCBjb2xsZWN0aW9uLCByZXNwLCBvcHRpb25zKTsKICAgICAgfTsKICAgICAgd3JhcEVycm9yKHRoaXMsIG9wdGlvbnMpOwogICAgICByZXR1cm4gdGhpcy5zeW5jKCdyZWFkJywgdGhpcywgb3B0aW9ucyk7CiAgICB9LAoKICAgIC8vIENyZWF0ZSBhIG5ldyBpbnN0YW5jZSBvZiBhIG1vZGVsIGluIHRoaXMgY29sbGVjdGlvbi4gQWRkIHRoZSBtb2RlbCB0byB0aGUKICAgIC8vIGNvbGxlY3Rpb24gaW1tZWRpYXRlbHksIHVubGVzcyBgd2FpdDogdHJ1ZWAgaXMgcGFzc2VkLCBpbiB3aGljaCBjYXNlIHdlCiAgICAvLyB3YWl0IGZvciB0aGUgc2VydmVyIHRvIGFncmVlLgogICAgY3JlYXRlOiBmdW5jdGlvbihtb2RlbCwgb3B0aW9ucykgewogICAgICBvcHRpb25zID0gb3B0aW9ucyA/IF8uY2xvbmUob3B0aW9ucykgOiB7fTsKICAgICAgaWYgKCEobW9kZWwgPSB0aGlzLl9wcmVwYXJlTW9kZWwobW9kZWwsIG9wdGlvbnMpKSkgcmV0dXJuIGZhbHNlOwogICAgICBpZiAoIW9wdGlvbnMud2FpdCkgdGhpcy5hZGQobW9kZWwsIG9wdGlvbnMpOwogICAgICB2YXIgY29sbGVjdGlvbiA9IHRoaXM7CiAgICAgIHZhciBzdWNjZXNzID0gb3B0aW9ucy5zdWNjZXNzOwogICAgICBvcHRpb25zLnN1Y2Nlc3MgPSBmdW5jdGlvbihtb2RlbCwgcmVzcCkgewogICAgICAgIGlmIChvcHRpb25zLndhaXQpIGNvbGxlY3Rpb24uYWRkKG1vZGVsLCBvcHRpb25zKTsKICAgICAgICBpZiAoc3VjY2Vzcykgc3VjY2Vzcyhtb2RlbCwgcmVzcCwgb3B0aW9ucyk7CiAgICAgIH07CiAgICAgIG1vZGVsLnNhdmUobnVsbCwgb3B0aW9ucyk7CiAgICAgIHJldHVybiBtb2RlbDsKICAgIH0sCgogICAgLy8gKipwYXJzZSoqIGNvbnZlcnRzIGEgcmVzcG9uc2UgaW50byBhIGxpc3Qgb2YgbW9kZWxzIHRvIGJlIGFkZGVkIHRvIHRoZQogICAgLy8gY29sbGVjdGlvbi4gVGhlIGRlZmF1bHQgaW1wbGVtZW50YXRpb24gaXMganVzdCB0byBwYXNzIGl0IHRocm91Z2guCiAgICBwYXJzZTogZnVuY3Rpb24ocmVzcCwgb3B0aW9ucykgewogICAgICByZXR1cm4gcmVzcDsKICAgIH0sCgogICAgLy8gQ3JlYXRlIGEgbmV3IGNvbGxlY3Rpb24gd2l0aCBhbiBpZGVudGljYWwgbGlzdCBvZiBtb2RlbHMgYXMgdGhpcyBvbmUuCiAgICBjbG9uZTogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3Rvcih0aGlzLm1vZGVscyk7CiAgICB9LAoKICAgIC8vIFByaXZhdGUgbWV0aG9kIHRvIHJlc2V0IGFsbCBpbnRlcm5hbCBzdGF0ZS4gQ2FsbGVkIHdoZW4gdGhlIGNvbGxlY3Rpb24KICAgIC8vIGlzIGZpcnN0IGluaXRpYWxpemVkIG9yIHJlc2V0LgogICAgX3Jlc2V0OiBmdW5jdGlvbigpIHsKICAgICAgdGhpcy5sZW5ndGggPSAwOwogICAgICB0aGlzLm1vZGVscyA9IFtdOwogICAgICB0aGlzLl9ieUlkICA9IHt9OwogICAgfSwKCiAgICAvLyBQcmVwYXJlIGEgaGFzaCBvZiBhdHRyaWJ1dGVzIChvciBvdGhlciBtb2RlbCkgdG8gYmUgYWRkZWQgdG8gdGhpcwogICAgLy8gY29sbGVjdGlvbi4KICAgIF9wcmVwYXJlTW9kZWw6IGZ1bmN0aW9uKGF0dHJzLCBvcHRpb25zKSB7CiAgICAgIGlmIChhdHRycyBpbnN0YW5jZW9mIE1vZGVsKSByZXR1cm4gYXR0cnM7CiAgICAgIG9wdGlvbnMgPSBvcHRpb25zID8gXy5jbG9uZShvcHRpb25zKSA6IHt9OwogICAgICBvcHRpb25zLmNvbGxlY3Rpb24gPSB0aGlzOwogICAgICB2YXIgbW9kZWwgPSBuZXcgdGhpcy5tb2RlbChhdHRycywgb3B0aW9ucyk7CiAgICAgIGlmICghbW9kZWwudmFsaWRhdGlvbkVycm9yKSByZXR1cm4gbW9kZWw7CiAgICAgIHRoaXMudHJpZ2dlcignaW52YWxpZCcsIHRoaXMsIG1vZGVsLnZhbGlkYXRpb25FcnJvciwgb3B0aW9ucyk7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0sCgogICAgLy8gSW50ZXJuYWwgbWV0aG9kIHRvIGNyZWF0ZSBhIG1vZGVsJ3MgdGllcyB0byBhIGNvbGxlY3Rpb24uCiAgICBfYWRkUmVmZXJlbmNlOiBmdW5jdGlvbihtb2RlbCwgb3B0aW9ucykgewogICAgICB0aGlzLl9ieUlkW21vZGVsLmNpZF0gPSBtb2RlbDsKICAgICAgaWYgKG1vZGVsLmlkICE9IG51bGwpIHRoaXMuX2J5SWRbbW9kZWwuaWRdID0gbW9kZWw7CiAgICAgIGlmICghbW9kZWwuY29sbGVjdGlvbikgbW9kZWwuY29sbGVjdGlvbiA9IHRoaXM7CiAgICAgIG1vZGVsLm9uKCdhbGwnLCB0aGlzLl9vbk1vZGVsRXZlbnQsIHRoaXMpOwogICAgfSwKCiAgICAvLyBJbnRlcm5hbCBtZXRob2QgdG8gc2V2ZXIgYSBtb2RlbCdzIHRpZXMgdG8gYSBjb2xsZWN0aW9uLgogICAgX3JlbW92ZVJlZmVyZW5jZTogZnVuY3Rpb24obW9kZWwsIG9wdGlvbnMpIHsKICAgICAgaWYgKHRoaXMgPT09IG1vZGVsLmNvbGxlY3Rpb24pIGRlbGV0ZSBtb2RlbC5jb2xsZWN0aW9uOwogICAgICBtb2RlbC5vZmYoJ2FsbCcsIHRoaXMuX29uTW9kZWxFdmVudCwgdGhpcyk7CiAgICB9LAoKICAgIC8vIEludGVybmFsIG1ldGhvZCBjYWxsZWQgZXZlcnkgdGltZSBhIG1vZGVsIGluIHRoZSBzZXQgZmlyZXMgYW4gZXZlbnQuCiAgICAvLyBTZXRzIG5lZWQgdG8gdXBkYXRlIHRoZWlyIGluZGV4ZXMgd2hlbiBtb2RlbHMgY2hhbmdlIGlkcy4gQWxsIG90aGVyCiAgICAvLyBldmVudHMgc2ltcGx5IHByb3h5IHRocm91Z2guICJhZGQiIGFuZCAicmVtb3ZlIiBldmVudHMgdGhhdCBvcmlnaW5hdGUKICAgIC8vIGluIG90aGVyIGNvbGxlY3Rpb25zIGFyZSBpZ25vcmVkLgogICAgX29uTW9kZWxFdmVudDogZnVuY3Rpb24oZXZlbnQsIG1vZGVsLCBjb2xsZWN0aW9uLCBvcHRpb25zKSB7CiAgICAgIGlmICgoZXZlbnQgPT09ICdhZGQnIHx8IGV2ZW50ID09PSAncmVtb3ZlJykgJiYgY29sbGVjdGlvbiAhPT0gdGhpcykgcmV0dXJuOwogICAgICBpZiAoZXZlbnQgPT09ICdkZXN0cm95JykgdGhpcy5yZW1vdmUobW9kZWwsIG9wdGlvbnMpOwogICAgICBpZiAobW9kZWwgJiYgZXZlbnQgPT09ICdjaGFuZ2U6JyArIG1vZGVsLmlkQXR0cmlidXRlKSB7CiAgICAgICAgZGVsZXRlIHRoaXMuX2J5SWRbbW9kZWwucHJldmlvdXMobW9kZWwuaWRBdHRyaWJ1dGUpXTsKICAgICAgICBpZiAobW9kZWwuaWQgIT0gbnVsbCkgdGhpcy5fYnlJZFttb2RlbC5pZF0gPSBtb2RlbDsKICAgICAgfQogICAgICB0aGlzLnRyaWdnZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIH0KCiAgfSk7CgogIC8vIFVuZGVyc2NvcmUgbWV0aG9kcyB0aGF0IHdlIHdhbnQgdG8gaW1wbGVtZW50IG9uIHRoZSBDb2xsZWN0aW9uLgogIC8vIDkwJSBvZiB0aGUgY29yZSB1c2VmdWxuZXNzIG9mIEJhY2tib25lIENvbGxlY3Rpb25zIGlzIGFjdHVhbGx5IGltcGxlbWVudGVkCiAgLy8gcmlnaHQgaGVyZToKICB2YXIgbWV0aG9kcyA9IFsnZm9yRWFjaCcsICdlYWNoJywgJ21hcCcsICdjb2xsZWN0JywgJ3JlZHVjZScsICdmb2xkbCcsCiAgICAnaW5qZWN0JywgJ3JlZHVjZVJpZ2h0JywgJ2ZvbGRyJywgJ2ZpbmQnLCAnZGV0ZWN0JywgJ2ZpbHRlcicsICdzZWxlY3QnLAogICAgJ3JlamVjdCcsICdldmVyeScsICdhbGwnLCAnc29tZScsICdhbnknLCAnaW5jbHVkZScsICdjb250YWlucycsICdpbnZva2UnLAogICAgJ21heCcsICdtaW4nLCAndG9BcnJheScsICdzaXplJywgJ2ZpcnN0JywgJ2hlYWQnLCAndGFrZScsICdpbml0aWFsJywgJ3Jlc3QnLAogICAgJ3RhaWwnLCAnZHJvcCcsICdsYXN0JywgJ3dpdGhvdXQnLCAnZGlmZmVyZW5jZScsICdpbmRleE9mJywgJ3NodWZmbGUnLAogICAgJ2xhc3RJbmRleE9mJywgJ2lzRW1wdHknLCAnY2hhaW4nLCAnc2FtcGxlJ107CgogIC8vIE1peCBpbiBlYWNoIFVuZGVyc2NvcmUgbWV0aG9kIGFzIGEgcHJveHkgdG8gYENvbGxlY3Rpb24jbW9kZWxzYC4KICBfLmVhY2gobWV0aG9kcywgZnVuY3Rpb24obWV0aG9kKSB7CiAgICBDb2xsZWN0aW9uLnByb3RvdHlwZVttZXRob2RdID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBhcmdzID0gc2xpY2UuY2FsbChhcmd1bWVudHMpOwogICAgICBhcmdzLnVuc2hpZnQodGhpcy5tb2RlbHMpOwogICAgICByZXR1cm4gX1ttZXRob2RdLmFwcGx5KF8sIGFyZ3MpOwogICAgfTsKICB9KTsKCiAgLy8gVW5kZXJzY29yZSBtZXRob2RzIHRoYXQgdGFrZSBhIHByb3BlcnR5IG5hbWUgYXMgYW4gYXJndW1lbnQuCiAgdmFyIGF0dHJpYnV0ZU1ldGhvZHMgPSBbJ2dyb3VwQnknLCAnY291bnRCeScsICdzb3J0QnknLCAnaW5kZXhCeSddOwoKICAvLyBVc2UgYXR0cmlidXRlcyBpbnN0ZWFkIG9mIHByb3BlcnRpZXMuCiAgXy5lYWNoKGF0dHJpYnV0ZU1ldGhvZHMsIGZ1bmN0aW9uKG1ldGhvZCkgewogICAgQ29sbGVjdGlvbi5wcm90b3R5cGVbbWV0aG9kXSA9IGZ1bmN0aW9uKHZhbHVlLCBjb250ZXh0KSB7CiAgICAgIHZhciBpdGVyYXRvciA9IF8uaXNGdW5jdGlvbih2YWx1ZSkgPyB2YWx1ZSA6IGZ1bmN0aW9uKG1vZGVsKSB7CiAgICAgICAgcmV0dXJuIG1vZGVsLmdldCh2YWx1ZSk7CiAgICAgIH07CiAgICAgIHJldHVybiBfW21ldGhvZF0odGhpcy5tb2RlbHMsIGl0ZXJhdG9yLCBjb250ZXh0KTsKICAgIH07CiAgfSk7CgogIC8vIEJhY2tib25lLlZpZXcKICAvLyAtLS0tLS0tLS0tLS0tCgogIC8vIEJhY2tib25lIFZpZXdzIGFyZSBhbG1vc3QgbW9yZSBjb252ZW50aW9uIHRoYW4gdGhleSBhcmUgYWN0dWFsIGNvZGUuIEEgVmlldwogIC8vIGlzIHNpbXBseSBhIEphdmFTY3JpcHQgb2JqZWN0IHRoYXQgcmVwcmVzZW50cyBhIGxvZ2ljYWwgY2h1bmsgb2YgVUkgaW4gdGhlCiAgLy8gRE9NLiBUaGlzIG1pZ2h0IGJlIGEgc2luZ2xlIGl0ZW0sIGFuIGVudGlyZSBsaXN0LCBhIHNpZGViYXIgb3IgcGFuZWwsIG9yCiAgLy8gZXZlbiB0aGUgc3Vycm91bmRpbmcgZnJhbWUgd2hpY2ggd3JhcHMgeW91ciB3aG9sZSBhcHAuIERlZmluaW5nIGEgY2h1bmsgb2YKICAvLyBVSSBhcyBhICoqVmlldyoqIGFsbG93cyB5b3UgdG8gZGVmaW5lIHlvdXIgRE9NIGV2ZW50cyBkZWNsYXJhdGl2ZWx5LCB3aXRob3V0CiAgLy8gaGF2aW5nIHRvIHdvcnJ5IGFib3V0IHJlbmRlciBvcmRlciAuLi4gYW5kIG1ha2VzIGl0IGVhc3kgZm9yIHRoZSB2aWV3IHRvCiAgLy8gcmVhY3QgdG8gc3BlY2lmaWMgY2hhbmdlcyBpbiB0aGUgc3RhdGUgb2YgeW91ciBtb2RlbHMuCgogIC8vIENyZWF0aW5nIGEgQmFja2JvbmUuVmlldyBjcmVhdGVzIGl0cyBpbml0aWFsIGVsZW1lbnQgb3V0c2lkZSBvZiB0aGUgRE9NLAogIC8vIGlmIGFuIGV4aXN0aW5nIGVsZW1lbnQgaXMgbm90IHByb3ZpZGVkLi4uCiAgdmFyIFZpZXcgPSBCYWNrYm9uZS5WaWV3ID0gZnVuY3Rpb24ob3B0aW9ucykgewogICAgdGhpcy5jaWQgPSBfLnVuaXF1ZUlkKCd2aWV3Jyk7CiAgICBvcHRpb25zIHx8IChvcHRpb25zID0ge30pOwogICAgXy5leHRlbmQodGhpcywgXy5waWNrKG9wdGlvbnMsIHZpZXdPcHRpb25zKSk7CiAgICB0aGlzLl9lbnN1cmVFbGVtZW50KCk7CiAgICB0aGlzLmluaXRpYWxpemUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIHRoaXMuZGVsZWdhdGVFdmVudHMoKTsKICB9OwoKICAvLyBDYWNoZWQgcmVnZXggdG8gc3BsaXQga2V5cyBmb3IgYGRlbGVnYXRlYC4KICB2YXIgZGVsZWdhdGVFdmVudFNwbGl0dGVyID0gL14oXFMrKVxzKiguKikkLzsKCiAgLy8gTGlzdCBvZiB2aWV3IG9wdGlvbnMgdG8gYmUgbWVyZ2VkIGFzIHByb3BlcnRpZXMuCiAgdmFyIHZpZXdPcHRpb25zID0gWydtb2RlbCcsICdjb2xsZWN0aW9uJywgJ2VsJywgJ2lkJywgJ2F0dHJpYnV0ZXMnLCAnY2xhc3NOYW1lJywgJ3RhZ05hbWUnLCAnZXZlbnRzJ107CgogIC8vIFNldCB1cCBhbGwgaW5oZXJpdGFibGUgKipCYWNrYm9uZS5WaWV3KiogcHJvcGVydGllcyBhbmQgbWV0aG9kcy4KICBfLmV4dGVuZChWaWV3LnByb3RvdHlwZSwgRXZlbnRzLCB7CgogICAgLy8gVGhlIGRlZmF1bHQgYHRhZ05hbWVgIG9mIGEgVmlldydzIGVsZW1lbnQgaXMgYCJkaXYiYC4KICAgIHRhZ05hbWU6ICdkaXYnLAoKICAgIC8vIGpRdWVyeSBkZWxlZ2F0ZSBmb3IgZWxlbWVudCBsb29rdXAsIHNjb3BlZCB0byBET00gZWxlbWVudHMgd2l0aGluIHRoZQogICAgLy8gY3VycmVudCB2aWV3LiBUaGlzIHNob3VsZCBiZSBwcmVmZXJyZWQgdG8gZ2xvYmFsIGxvb2t1cHMgd2hlcmUgcG9zc2libGUuCiAgICAkOiBmdW5jdGlvbihzZWxlY3RvcikgewogICAgICByZXR1cm4gdGhpcy4kZWwuZmluZChzZWxlY3Rvcik7CiAgICB9LAoKICAgIC8vIEluaXRpYWxpemUgaXMgYW4gZW1wdHkgZnVuY3Rpb24gYnkgZGVmYXVsdC4gT3ZlcnJpZGUgaXQgd2l0aCB5b3VyIG93bgogICAgLy8gaW5pdGlhbGl6YXRpb24gbG9naWMuCiAgICBpbml0aWFsaXplOiBmdW5jdGlvbigpe30sCgogICAgLy8gKipyZW5kZXIqKiBpcyB0aGUgY29yZSBmdW5jdGlvbiB0aGF0IHlvdXIgdmlldyBzaG91bGQgb3ZlcnJpZGUsIGluIG9yZGVyCiAgICAvLyB0byBwb3B1bGF0ZSBpdHMgZWxlbWVudCAoYHRoaXMuZWxgKSwgd2l0aCB0aGUgYXBwcm9wcmlhdGUgSFRNTC4gVGhlCiAgICAvLyBjb252ZW50aW9uIGlzIGZvciAqKnJlbmRlcioqIHRvIGFsd2F5cyByZXR1cm4gYHRoaXNgLgogICAgcmVuZGVyOiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAoKICAgIC8vIFJlbW92ZSB0aGlzIHZpZXcgYnkgdGFraW5nIHRoZSBlbGVtZW50IG91dCBvZiB0aGUgRE9NLCBhbmQgcmVtb3ZpbmcgYW55CiAgICAvLyBhcHBsaWNhYmxlIEJhY2tib25lLkV2ZW50cyBsaXN0ZW5lcnMuCiAgICByZW1vdmU6IGZ1bmN0aW9uKCkgewogICAgICB0aGlzLiRlbC5yZW1vdmUoKTsKICAgICAgdGhpcy5zdG9wTGlzdGVuaW5nKCk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvLyBDaGFuZ2UgdGhlIHZpZXcncyBlbGVtZW50IChgdGhpcy5lbGAgcHJvcGVydHkpLCBpbmNsdWRpbmcgZXZlbnQKICAgIC8vIHJlLWRlbGVnYXRpb24uCiAgICBzZXRFbGVtZW50OiBmdW5jdGlvbihlbGVtZW50LCBkZWxlZ2F0ZSkgewogICAgICBpZiAodGhpcy4kZWwpIHRoaXMudW5kZWxlZ2F0ZUV2ZW50cygpOwogICAgICB0aGlzLiRlbCA9IGVsZW1lbnQgaW5zdGFuY2VvZiBCYWNrYm9uZS4kID8gZWxlbWVudCA6IEJhY2tib25lLiQoZWxlbWVudCk7CiAgICAgIHRoaXMuZWwgPSB0aGlzLiRlbFswXTsKICAgICAgaWYgKGRlbGVnYXRlICE9PSBmYWxzZSkgdGhpcy5kZWxlZ2F0ZUV2ZW50cygpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLy8gU2V0IGNhbGxiYWNrcywgd2hlcmUgYHRoaXMuZXZlbnRzYCBpcyBhIGhhc2ggb2YKICAgIC8vCiAgICAvLyAqeyJldmVudCBzZWxlY3RvciI6ICJjYWxsYmFjayJ9KgogICAgLy8KICAgIC8vICAgICB7CiAgICAvLyAgICAgICAnbW91c2Vkb3duIC50aXRsZSc6ICAnZWRpdCcsCiAgICAvLyAgICAgICAnY2xpY2sgLmJ1dHRvbic6ICAgICAnc2F2ZScsCiAgICAvLyAgICAgICAnY2xpY2sgLm9wZW4nOiAgICAgICBmdW5jdGlvbihlKSB7IC4uLiB9CiAgICAvLyAgICAgfQogICAgLy8KICAgIC8vIHBhaXJzLiBDYWxsYmFja3Mgd2lsbCBiZSBib3VuZCB0byB0aGUgdmlldywgd2l0aCBgdGhpc2Agc2V0IHByb3Blcmx5LgogICAgLy8gVXNlcyBldmVudCBkZWxlZ2F0aW9uIGZvciBlZmZpY2llbmN5LgogICAgLy8gT21pdHRpbmcgdGhlIHNlbGVjdG9yIGJpbmRzIHRoZSBldmVudCB0byBgdGhpcy5lbGAuCiAgICAvLyBUaGlzIG9ubHkgd29ya3MgZm9yIGRlbGVnYXRlLWFibGUgZXZlbnRzOiBub3QgYGZvY3VzYCwgYGJsdXJgLCBhbmQKICAgIC8vIG5vdCBgY2hhbmdlYCwgYHN1Ym1pdGAsIGFuZCBgcmVzZXRgIGluIEludGVybmV0IEV4cGxvcmVyLgogICAgZGVsZWdhdGVFdmVudHM6IGZ1bmN0aW9uKGV2ZW50cykgewogICAgICBpZiAoIShldmVudHMgfHwgKGV2ZW50cyA9IF8ucmVzdWx0KHRoaXMsICdldmVudHMnKSkpKSByZXR1cm4gdGhpczsKICAgICAgdGhpcy51bmRlbGVnYXRlRXZlbnRzKCk7CiAgICAgIGZvciAodmFyIGtleSBpbiBldmVudHMpIHsKICAgICAgICB2YXIgbWV0aG9kID0gZXZlbnRzW2tleV07CiAgICAgICAgaWYgKCFfLmlzRnVuY3Rpb24obWV0aG9kKSkgbWV0aG9kID0gdGhpc1tldmVudHNba2V5XV07CiAgICAgICAgaWYgKCFtZXRob2QpIGNvbnRpbnVlOwoKICAgICAgICB2YXIgbWF0Y2ggPSBrZXkubWF0Y2goZGVsZWdhdGVFdmVudFNwbGl0dGVyKTsKICAgICAgICB2YXIgZXZlbnROYW1lID0gbWF0Y2hbMV0sIHNlbGVjdG9yID0gbWF0Y2hbMl07CiAgICAgICAgbWV0aG9kID0gXy5iaW5kKG1ldGhvZCwgdGhpcyk7CiAgICAgICAgZXZlbnROYW1lICs9ICcuZGVsZWdhdGVFdmVudHMnICsgdGhpcy5jaWQ7CiAgICAgICAgaWYgKHNlbGVjdG9yID09PSAnJykgewogICAgICAgICAgdGhpcy4kZWwub24oZXZlbnROYW1lLCBtZXRob2QpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLiRlbC5vbihldmVudE5hbWUsIHNlbGVjdG9yLCBtZXRob2QpOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLy8gQ2xlYXJzIGFsbCBjYWxsYmFja3MgcHJldmlvdXNseSBib3VuZCB0byB0aGUgdmlldyB3aXRoIGBkZWxlZ2F0ZUV2ZW50c2AuCiAgICAvLyBZb3UgdXN1YWxseSBkb24ndCBuZWVkIHRvIHVzZSB0aGlzLCBidXQgbWF5IHdpc2ggdG8gaWYgeW91IGhhdmUgbXVsdGlwbGUKICAgIC8vIEJhY2tib25lIHZpZXdzIGF0dGFjaGVkIHRvIHRoZSBzYW1lIERPTSBlbGVtZW50LgogICAgdW5kZWxlZ2F0ZUV2ZW50czogZnVuY3Rpb24oKSB7CiAgICAgIHRoaXMuJGVsLm9mZignLmRlbGVnYXRlRXZlbnRzJyArIHRoaXMuY2lkKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAoKICAgIC8vIEVuc3VyZSB0aGF0IHRoZSBWaWV3IGhhcyBhIERPTSBlbGVtZW50IHRvIHJlbmRlciBpbnRvLgogICAgLy8gSWYgYHRoaXMuZWxgIGlzIGEgc3RyaW5nLCBwYXNzIGl0IHRocm91Z2ggYCQoKWAsIHRha2UgdGhlIGZpcnN0CiAgICAvLyBtYXRjaGluZyBlbGVtZW50LCBhbmQgcmUtYXNzaWduIGl0IHRvIGBlbGAuIE90aGVyd2lzZSwgY3JlYXRlCiAgICAvLyBhbiBlbGVtZW50IGZyb20gdGhlIGBpZGAsIGBjbGFzc05hbWVgIGFuZCBgdGFnTmFtZWAgcHJvcGVydGllcy4KICAgIF9lbnN1cmVFbGVtZW50OiBmdW5jdGlvbigpIHsKICAgICAgaWYgKCF0aGlzLmVsKSB7CiAgICAgICAgdmFyIGF0dHJzID0gXy5leHRlbmQoe30sIF8ucmVzdWx0KHRoaXMsICdhdHRyaWJ1dGVzJykpOwogICAgICAgIGlmICh0aGlzLmlkKSBhdHRycy5pZCA9IF8ucmVzdWx0KHRoaXMsICdpZCcpOwogICAgICAgIGlmICh0aGlzLmNsYXNzTmFtZSkgYXR0cnNbJ2NsYXNzJ10gPSBfLnJlc3VsdCh0aGlzLCAnY2xhc3NOYW1lJyk7CiAgICAgICAgdmFyICRlbCA9IEJhY2tib25lLiQoJzwnICsgXy5yZXN1bHQodGhpcywgJ3RhZ05hbWUnKSArICc+JykuYXR0cihhdHRycyk7CiAgICAgICAgdGhpcy5zZXRFbGVtZW50KCRlbCwgZmFsc2UpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuc2V0RWxlbWVudChfLnJlc3VsdCh0aGlzLCAnZWwnKSwgZmFsc2UpOwogICAgICB9CiAgICB9CgogIH0pOwoKICAvLyBCYWNrYm9uZS5zeW5jCiAgLy8gLS0tLS0tLS0tLS0tLQoKICAvLyBPdmVycmlkZSB0aGlzIGZ1bmN0aW9uIHRvIGNoYW5nZSB0aGUgbWFubmVyIGluIHdoaWNoIEJhY2tib25lIHBlcnNpc3RzCiAgLy8gbW9kZWxzIHRvIHRoZSBzZXJ2ZXIuIFlvdSB3aWxsIGJlIHBhc3NlZCB0aGUgdHlwZSBvZiByZXF1ZXN0LCBhbmQgdGhlCiAgLy8gbW9kZWwgaW4gcXVlc3Rpb24uIEJ5IGRlZmF1bHQsIG1ha2VzIGEgUkVTVGZ1bCBBamF4IHJlcXVlc3QKICAvLyB0byB0aGUgbW9kZWwncyBgdXJsKClgLiBTb21lIHBvc3NpYmxlIGN1c3RvbWl6YXRpb25zIGNvdWxkIGJlOgogIC8vCiAgLy8gKiBVc2UgYHNldFRpbWVvdXRgIHRvIGJhdGNoIHJhcGlkLWZpcmUgdXBkYXRlcyBpbnRvIGEgc2luZ2xlIHJlcXVlc3QuCiAgLy8gKiBTZW5kIHVwIHRoZSBtb2RlbHMgYXMgWE1MIGluc3RlYWQgb2YgSlNPTi4KICAvLyAqIFBlcnNpc3QgbW9kZWxzIHZpYSBXZWJTb2NrZXRzIGluc3RlYWQgb2YgQWpheC4KICAvLwogIC8vIFR1cm4gb24gYEJhY2tib25lLmVtdWxhdGVIVFRQYCBpbiBvcmRlciB0byBzZW5kIGBQVVRgIGFuZCBgREVMRVRFYCByZXF1ZXN0cwogIC8vIGFzIGBQT1NUYCwgd2l0aCBhIGBfbWV0aG9kYCBwYXJhbWV0ZXIgY29udGFpbmluZyB0aGUgdHJ1ZSBIVFRQIG1ldGhvZCwKICAvLyBhcyB3ZWxsIGFzIGFsbCByZXF1ZXN0cyB3aXRoIHRoZSBib2R5IGFzIGBhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWRgCiAgLy8gaW5zdGVhZCBvZiBgYXBwbGljYXRpb24vanNvbmAgd2l0aCB0aGUgbW9kZWwgaW4gYSBwYXJhbSBuYW1lZCBgbW9kZWxgLgogIC8vIFVzZWZ1bCB3aGVuIGludGVyZmFjaW5nIHdpdGggc2VydmVyLXNpZGUgbGFuZ3VhZ2VzIGxpa2UgKipQSFAqKiB0aGF0IG1ha2UKICAvLyBpdCBkaWZmaWN1bHQgdG8gcmVhZCB0aGUgYm9keSBvZiBgUFVUYCByZXF1ZXN0cy4KICBCYWNrYm9uZS5zeW5jID0gZnVuY3Rpb24obWV0aG9kLCBtb2RlbCwgb3B0aW9ucykgewogICAgdmFyIHR5cGUgPSBtZXRob2RNYXBbbWV0aG9kXTsKCiAgICAvLyBEZWZhdWx0IG9wdGlvbnMsIHVubGVzcyBzcGVjaWZpZWQuCiAgICBfLmRlZmF1bHRzKG9wdGlvbnMgfHwgKG9wdGlvbnMgPSB7fSksIHsKICAgICAgZW11bGF0ZUhUVFA6IEJhY2tib25lLmVtdWxhdGVIVFRQLAogICAgICBlbXVsYXRlSlNPTjogQmFja2JvbmUuZW11bGF0ZUpTT04KICAgIH0pOwoKICAgIC8vIERlZmF1bHQgSlNPTi1yZXF1ZXN0IG9wdGlvbnMuCiAgICB2YXIgcGFyYW1zID0ge3R5cGU6IHR5cGUsIGRhdGFUeXBlOiAnanNvbid9OwoKICAgIC8vIEVuc3VyZSB0aGF0IHdlIGhhdmUgYSBVUkwuCiAgICBpZiAoIW9wdGlvbnMudXJsKSB7CiAgICAgIHBhcmFtcy51cmwgPSBfLnJlc3VsdChtb2RlbCwgJ3VybCcpIHx8IHVybEVycm9yKCk7CiAgICB9CgogICAgLy8gRW5zdXJlIHRoYXQgd2UgaGF2ZSB0aGUgYXBwcm9wcmlhdGUgcmVxdWVzdCBkYXRhLgogICAgaWYgKG9wdGlvbnMuZGF0YSA9PSBudWxsICYmIG1vZGVsICYmIChtZXRob2QgPT09ICdjcmVhdGUnIHx8IG1ldGhvZCA9PT0gJ3VwZGF0ZScgfHwgbWV0aG9kID09PSAncGF0Y2gnKSkgewogICAgICBwYXJhbXMuY29udGVudFR5cGUgPSAnYXBwbGljYXRpb24vanNvbic7CiAgICAgIHBhcmFtcy5kYXRhID0gSlNPTi5zdHJpbmdpZnkob3B0aW9ucy5hdHRycyB8fCBtb2RlbC50b0pTT04ob3B0aW9ucykpOwogICAgfQoKICAgIC8vIEZvciBvbGRlciBzZXJ2ZXJzLCBlbXVsYXRlIEpTT04gYnkgZW5jb2RpbmcgdGhlIHJlcXVlc3QgaW50byBhbiBIVE1MLWZvcm0uCiAgICBpZiAob3B0aW9ucy5lbXVsYXRlSlNPTikgewogICAgICBwYXJhbXMuY29udGVudFR5cGUgPSAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkJzsKICAgICAgcGFyYW1zLmRhdGEgPSBwYXJhbXMuZGF0YSA/IHttb2RlbDogcGFyYW1zLmRhdGF9IDoge307CiAgICB9CgogICAgLy8gRm9yIG9sZGVyIHNlcnZlcnMsIGVtdWxhdGUgSFRUUCBieSBtaW1pY2tpbmcgdGhlIEhUVFAgbWV0aG9kIHdpdGggYF9tZXRob2RgCiAgICAvLyBBbmQgYW4gYFgtSFRUUC1NZXRob2QtT3ZlcnJpZGVgIGhlYWRlci4KICAgIGlmIChvcHRpb25zLmVtdWxhdGVIVFRQICYmICh0eXBlID09PSAnUFVUJyB8fCB0eXBlID09PSAnREVMRVRFJyB8fCB0eXBlID09PSAnUEFUQ0gnKSkgewogICAgICBwYXJhbXMudHlwZSA9ICdQT1NUJzsKICAgICAgaWYgKG9wdGlvbnMuZW11bGF0ZUpTT04pIHBhcmFtcy5kYXRhLl9tZXRob2QgPSB0eXBlOwogICAgICB2YXIgYmVmb3JlU2VuZCA9IG9wdGlvbnMuYmVmb3JlU2VuZDsKICAgICAgb3B0aW9ucy5iZWZvcmVTZW5kID0gZnVuY3Rpb24oeGhyKSB7CiAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoJ1gtSFRUUC1NZXRob2QtT3ZlcnJpZGUnLCB0eXBlKTsKICAgICAgICBpZiAoYmVmb3JlU2VuZCkgcmV0dXJuIGJlZm9yZVNlbmQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfTsKICAgIH0KCiAgICAvLyBEb24ndCBwcm9jZXNzIGRhdGEgb24gYSBub24tR0VUIHJlcXVlc3QuCiAgICBpZiAocGFyYW1zLnR5cGUgIT09ICdHRVQnICYmICFvcHRpb25zLmVtdWxhdGVKU09OKSB7CiAgICAgIHBhcmFtcy5wcm9jZXNzRGF0YSA9IGZhbHNlOwogICAgfQoKICAgIC8vIElmIHdlJ3JlIHNlbmRpbmcgYSBgUEFUQ0hgIHJlcXVlc3QsIGFuZCB3ZSdyZSBpbiBhbiBvbGQgSW50ZXJuZXQgRXhwbG9yZXIKICAgIC8vIHRoYXQgc3RpbGwgaGFzIEFjdGl2ZVggZW5hYmxlZCBieSBkZWZhdWx0LCBvdmVycmlkZSBqUXVlcnkgdG8gdXNlIHRoYXQKICAgIC8vIGZvciBYSFIgaW5zdGVhZC4gUmVtb3ZlIHRoaXMgbGluZSB3aGVuIGpRdWVyeSBzdXBwb3J0cyBgUEFUQ0hgIG9uIElFOC4KICAgIGlmIChwYXJhbXMudHlwZSA9PT0gJ1BBVENIJyAmJiBub1hoclBhdGNoKSB7CiAgICAgIHBhcmFtcy54aHIgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gbmV3IEFjdGl2ZVhPYmplY3QoIk1pY3Jvc29mdC5YTUxIVFRQIik7CiAgICAgIH07CiAgICB9CgogICAgLy8gTWFrZSB0aGUgcmVxdWVzdCwgYWxsb3dpbmcgdGhlIHVzZXIgdG8gb3ZlcnJpZGUgYW55IEFqYXggb3B0aW9ucy4KICAgIHZhciB4aHIgPSBvcHRpb25zLnhociA9IEJhY2tib25lLmFqYXgoXy5leHRlbmQocGFyYW1zLCBvcHRpb25zKSk7CiAgICBtb2RlbC50cmlnZ2VyKCdyZXF1ZXN0JywgbW9kZWwsIHhociwgb3B0aW9ucyk7CiAgICByZXR1cm4geGhyOwogIH07CgogIHZhciBub1hoclBhdGNoID0KICAgIHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmICEhd2luZG93LkFjdGl2ZVhPYmplY3QgJiYKICAgICAgISh3aW5kb3cuWE1MSHR0cFJlcXVlc3QgJiYgKG5ldyBYTUxIdHRwUmVxdWVzdCkuZGlzcGF0Y2hFdmVudCk7CgogIC8vIE1hcCBmcm9tIENSVUQgdG8gSFRUUCBmb3Igb3VyIGRlZmF1bHQgYEJhY2tib25lLnN5bmNgIGltcGxlbWVudGF0aW9uLgogIHZhciBtZXRob2RNYXAgPSB7CiAgICAnY3JlYXRlJzogJ1BPU1QnLAogICAgJ3VwZGF0ZSc6ICdQVVQnLAogICAgJ3BhdGNoJzogICdQQVRDSCcsCiAgICAnZGVsZXRlJzogJ0RFTEVURScsCiAgICAncmVhZCc6ICAgJ0dFVCcKICB9OwoKICAvLyBTZXQgdGhlIGRlZmF1bHQgaW1wbGVtZW50YXRpb24gb2YgYEJhY2tib25lLmFqYXhgIHRvIHByb3h5IHRocm91Z2ggdG8gYCRgLgogIC8vIE92ZXJyaWRlIHRoaXMgaWYgeW91J2QgbGlrZSB0byB1c2UgYSBkaWZmZXJlbnQgbGlicmFyeS4KICBCYWNrYm9uZS5hamF4ID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gQmFja2JvbmUuJC5hamF4LmFwcGx5KEJhY2tib25lLiQsIGFyZ3VtZW50cyk7CiAgfTsKCiAgLy8gQmFja2JvbmUuUm91dGVyCiAgLy8gLS0tLS0tLS0tLS0tLS0tCgogIC8vIFJvdXRlcnMgbWFwIGZhdXgtVVJMcyB0byBhY3Rpb25zLCBhbmQgZmlyZSBldmVudHMgd2hlbiByb3V0ZXMgYXJlCiAgLy8gbWF0Y2hlZC4gQ3JlYXRpbmcgYSBuZXcgb25lIHNldHMgaXRzIGByb3V0ZXNgIGhhc2gsIGlmIG5vdCBzZXQgc3RhdGljYWxseS4KICB2YXIgUm91dGVyID0gQmFja2JvbmUuUm91dGVyID0gZnVuY3Rpb24ob3B0aW9ucykgewogICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTsKICAgIGlmIChvcHRpb25zLnJvdXRlcykgdGhpcy5yb3V0ZXMgPSBvcHRpb25zLnJvdXRlczsKICAgIHRoaXMuX2JpbmRSb3V0ZXMoKTsKICAgIHRoaXMuaW5pdGlhbGl6ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogIH07CgogIC8vIENhY2hlZCByZWd1bGFyIGV4cHJlc3Npb25zIGZvciBtYXRjaGluZyBuYW1lZCBwYXJhbSBwYXJ0cyBhbmQgc3BsYXR0ZWQKICAvLyBwYXJ0cyBvZiByb3V0ZSBzdHJpbmdzLgogIHZhciBvcHRpb25hbFBhcmFtID0gL1woKC4qPylcKS9nOwogIHZhciBuYW1lZFBhcmFtICAgID0gLyhcKFw/KT86XHcrL2c7CiAgdmFyIHNwbGF0UGFyYW0gICAgPSAvXCpcdysvZzsKICB2YXIgZXNjYXBlUmVnRXhwICA9IC9bXC17fVxbXF0rPy4sXFxcXiR8I1xzXS9nOwoKICAvLyBTZXQgdXAgYWxsIGluaGVyaXRhYmxlICoqQmFja2JvbmUuUm91dGVyKiogcHJvcGVydGllcyBhbmQgbWV0aG9kcy4KICBfLmV4dGVuZChSb3V0ZXIucHJvdG90eXBlLCBFdmVudHMsIHsKCiAgICAvLyBJbml0aWFsaXplIGlzIGFuIGVtcHR5IGZ1bmN0aW9uIGJ5IGRlZmF1bHQuIE92ZXJyaWRlIGl0IHdpdGggeW91ciBvd24KICAgIC8vIGluaXRpYWxpemF0aW9uIGxvZ2ljLgogICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKXt9LAoKICAgIC8vIE1hbnVhbGx5IGJpbmQgYSBzaW5nbGUgbmFtZWQgcm91dGUgdG8gYSBjYWxsYmFjay4gRm9yIGV4YW1wbGU6CiAgICAvLwogICAgLy8gICAgIHRoaXMucm91dGUoJ3NlYXJjaC86cXVlcnkvcDpudW0nLCAnc2VhcmNoJywgZnVuY3Rpb24ocXVlcnksIG51bSkgewogICAgLy8gICAgICAgLi4uCiAgICAvLyAgICAgfSk7CiAgICAvLwogICAgcm91dGU6IGZ1bmN0aW9uKHJvdXRlLCBuYW1lLCBjYWxsYmFjaykgewogICAgICBpZiAoIV8uaXNSZWdFeHAocm91dGUpKSByb3V0ZSA9IHRoaXMuX3JvdXRlVG9SZWdFeHAocm91dGUpOwogICAgICBpZiAoXy5pc0Z1bmN0aW9uKG5hbWUpKSB7CiAgICAgICAgY2FsbGJhY2sgPSBuYW1lOwogICAgICAgIG5hbWUgPSAnJzsKICAgICAgfQogICAgICBpZiAoIWNhbGxiYWNrKSBjYWxsYmFjayA9IHRoaXNbbmFtZV07CiAgICAgIHZhciByb3V0ZXIgPSB0aGlzOwogICAgICBCYWNrYm9uZS5oaXN0b3J5LnJvdXRlKHJvdXRlLCBmdW5jdGlvbihmcmFnbWVudCkgewogICAgICAgIHZhciBhcmdzID0gcm91dGVyLl9leHRyYWN0UGFyYW1ldGVycyhyb3V0ZSwgZnJhZ21lbnQpOwogICAgICAgIHJvdXRlci5leGVjdXRlKGNhbGxiYWNrLCBhcmdzKTsKICAgICAgICByb3V0ZXIudHJpZ2dlci5hcHBseShyb3V0ZXIsIFsncm91dGU6JyArIG5hbWVdLmNvbmNhdChhcmdzKSk7CiAgICAgICAgcm91dGVyLnRyaWdnZXIoJ3JvdXRlJywgbmFtZSwgYXJncyk7CiAgICAgICAgQmFja2JvbmUuaGlzdG9yeS50cmlnZ2VyKCdyb3V0ZScsIHJvdXRlciwgbmFtZSwgYXJncyk7CiAgICAgIH0pOwogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgLy8gRXhlY3V0ZSBhIHJvdXRlIGhhbmRsZXIgd2l0aCB0aGUgcHJvdmlkZWQgcGFyYW1ldGVycy4gIFRoaXMgaXMgYW4KICAgIC8vIGV4Y2VsbGVudCBwbGFjZSB0byBkbyBwcmUtcm91dGUgc2V0dXAgb3IgcG9zdC1yb3V0ZSBjbGVhbnVwLgogICAgZXhlY3V0ZTogZnVuY3Rpb24oY2FsbGJhY2ssIGFyZ3MpIHsKICAgICAgaWYgKGNhbGxiYWNrKSBjYWxsYmFjay5hcHBseSh0aGlzLCBhcmdzKTsKICAgIH0sCgogICAgLy8gU2ltcGxlIHByb3h5IHRvIGBCYWNrYm9uZS5oaXN0b3J5YCB0byBzYXZlIGEgZnJhZ21lbnQgaW50byB0aGUgaGlzdG9yeS4KICAgIG5hdmlnYXRlOiBmdW5jdGlvbihmcmFnbWVudCwgb3B0aW9ucykgewogICAgICBCYWNrYm9uZS5oaXN0b3J5Lm5hdmlnYXRlKGZyYWdtZW50LCBvcHRpb25zKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAoKICAgIC8vIEJpbmQgYWxsIGRlZmluZWQgcm91dGVzIHRvIGBCYWNrYm9uZS5oaXN0b3J5YC4gV2UgaGF2ZSB0byByZXZlcnNlIHRoZQogICAgLy8gb3JkZXIgb2YgdGhlIHJvdXRlcyBoZXJlIHRvIHN1cHBvcnQgYmVoYXZpb3Igd2hlcmUgdGhlIG1vc3QgZ2VuZXJhbAogICAgLy8gcm91dGVzIGNhbiBiZSBkZWZpbmVkIGF0IHRoZSBib3R0b20gb2YgdGhlIHJvdXRlIG1hcC4KICAgIF9iaW5kUm91dGVzOiBmdW5jdGlvbigpIHsKICAgICAgaWYgKCF0aGlzLnJvdXRlcykgcmV0dXJuOwogICAgICB0aGlzLnJvdXRlcyA9IF8ucmVzdWx0KHRoaXMsICdyb3V0ZXMnKTsKICAgICAgdmFyIHJvdXRlLCByb3V0ZXMgPSBfLmtleXModGhpcy5yb3V0ZXMpOwogICAgICB3aGlsZSAoKHJvdXRlID0gcm91dGVzLnBvcCgpKSAhPSBudWxsKSB7CiAgICAgICAgdGhpcy5yb3V0ZShyb3V0ZSwgdGhpcy5yb3V0ZXNbcm91dGVdKTsKICAgICAgfQogICAgfSwKCiAgICAvLyBDb252ZXJ0IGEgcm91dGUgc3RyaW5nIGludG8gYSByZWd1bGFyIGV4cHJlc3Npb24sIHN1aXRhYmxlIGZvciBtYXRjaGluZwogICAgLy8gYWdhaW5zdCB0aGUgY3VycmVudCBsb2NhdGlvbiBoYXNoLgogICAgX3JvdXRlVG9SZWdFeHA6IGZ1bmN0aW9uKHJvdXRlKSB7CiAgICAgIHJvdXRlID0gcm91dGUucmVwbGFjZShlc2NhcGVSZWdFeHAsICdcXCQmJykKICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKG9wdGlvbmFsUGFyYW0sICcoPzokMSk/JykKICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKG5hbWVkUGFyYW0sIGZ1bmN0aW9uKG1hdGNoLCBvcHRpb25hbCkgewogICAgICAgICAgICAgICAgICAgICByZXR1cm4gb3B0aW9uYWwgPyBtYXRjaCA6ICcoW14vP10rKSc7CiAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgLnJlcGxhY2Uoc3BsYXRQYXJhbSwgJyhbXj9dKj8pJyk7CiAgICAgIHJldHVybiBuZXcgUmVnRXhwKCdeJyArIHJvdXRlICsgJyg/OlxcPyhbXFxzXFxTXSopKT8kJyk7CiAgICB9LAoKICAgIC8vIEdpdmVuIGEgcm91dGUsIGFuZCBhIFVSTCBmcmFnbWVudCB0aGF0IGl0IG1hdGNoZXMsIHJldHVybiB0aGUgYXJyYXkgb2YKICAgIC8vIGV4dHJhY3RlZCBkZWNvZGVkIHBhcmFtZXRlcnMuIEVtcHR5IG9yIHVubWF0Y2hlZCBwYXJhbWV0ZXJzIHdpbGwgYmUKICAgIC8vIHRyZWF0ZWQgYXMgYG51bGxgIHRvIG5vcm1hbGl6ZSBjcm9zcy1icm93c2VyIGJlaGF2aW9yLgogICAgX2V4dHJhY3RQYXJhbWV0ZXJzOiBmdW5jdGlvbihyb3V0ZSwgZnJhZ21lbnQpIHsKICAgICAgdmFyIHBhcmFtcyA9IHJvdXRlLmV4ZWMoZnJhZ21lbnQpLnNsaWNlKDEpOwogICAgICByZXR1cm4gXy5tYXAocGFyYW1zLCBmdW5jdGlvbihwYXJhbSwgaSkgewogICAgICAgIC8vIERvbid0IGRlY29kZSB0aGUgc2VhcmNoIHBhcmFtcy4KICAgICAgICBpZiAoaSA9PT0gcGFyYW1zLmxlbmd0aCAtIDEpIHJldHVybiBwYXJhbSB8fCBudWxsOwogICAgICAgIHJldHVybiBwYXJhbSA/IGRlY29kZVVSSUNvbXBvbmVudChwYXJhbSkgOiBudWxsOwogICAgICB9KTsKICAgIH0KCiAgfSk7CgogIC8vIEJhY2tib25lLkhpc3RvcnkKICAvLyAtLS0tLS0tLS0tLS0tLS0tCgogIC8vIEhhbmRsZXMgY3Jvc3MtYnJvd3NlciBoaXN0b3J5IG1hbmFnZW1lbnQsIGJhc2VkIG9uIGVpdGhlcgogIC8vIFtwdXNoU3RhdGVdKGh0dHA6Ly9kaXZlaW50b2h0bWw1LmluZm8vaGlzdG9yeS5odG1sKSBhbmQgcmVhbCBVUkxzLCBvcgogIC8vIFtvbmhhc2hjaGFuZ2VdKGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvRE9NL3dpbmRvdy5vbmhhc2hjaGFuZ2UpCiAgLy8gYW5kIFVSTCBmcmFnbWVudHMuIElmIHRoZSBicm93c2VyIHN1cHBvcnRzIG5laXRoZXIgKG9sZCBJRSwgbmF0Y2gpLAogIC8vIGZhbGxzIGJhY2sgdG8gcG9sbGluZy4KICB2YXIgSGlzdG9yeSA9IEJhY2tib25lLkhpc3RvcnkgPSBmdW5jdGlvbigpIHsKICAgIHRoaXMuaGFuZGxlcnMgPSBbXTsKICAgIF8uYmluZEFsbCh0aGlzLCAnY2hlY2tVcmwnKTsKCiAgICAvLyBFbnN1cmUgdGhhdCBgSGlzdG9yeWAgY2FuIGJlIHVzZWQgb3V0c2lkZSBvZiB0aGUgYnJvd3Nlci4KICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykgewogICAgICB0aGlzLmxvY2F0aW9uID0gd2luZG93LmxvY2F0aW9uOwogICAgICB0aGlzLmhpc3RvcnkgPSB3aW5kb3cuaGlzdG9yeTsKICAgIH0KICB9OwoKICAvLyBDYWNoZWQgcmVnZXggZm9yIHN0cmlwcGluZyBhIGxlYWRpbmcgaGFzaC9zbGFzaCBhbmQgdHJhaWxpbmcgc3BhY2UuCiAgdmFyIHJvdXRlU3RyaXBwZXIgPSAvXlsjXC9dfFxzKyQvZzsKCiAgLy8gQ2FjaGVkIHJlZ2V4IGZvciBzdHJpcHBpbmcgbGVhZGluZyBhbmQgdHJhaWxpbmcgc2xhc2hlcy4KICB2YXIgcm9vdFN0cmlwcGVyID0gL15cLyt8XC8rJC9nOwoKICAvLyBDYWNoZWQgcmVnZXggZm9yIGRldGVjdGluZyBNU0lFLgogIHZhciBpc0V4cGxvcmVyID0gL21zaWUgW1x3Ll0rLzsKCiAgLy8gQ2FjaGVkIHJlZ2V4IGZvciByZW1vdmluZyBhIHRyYWlsaW5nIHNsYXNoLgogIHZhciB0cmFpbGluZ1NsYXNoID0gL1wvJC87CgogIC8vIENhY2hlZCByZWdleCBmb3Igc3RyaXBwaW5nIHVybHMgb2YgaGFzaC4KICB2YXIgcGF0aFN0cmlwcGVyID0gLyMuKiQvOwoKICAvLyBIYXMgdGhlIGhpc3RvcnkgaGFuZGxpbmcgYWxyZWFkeSBiZWVuIHN0YXJ0ZWQ/CiAgSGlzdG9yeS5zdGFydGVkID0gZmFsc2U7CgogIC8vIFNldCB1cCBhbGwgaW5oZXJpdGFibGUgKipCYWNrYm9uZS5IaXN0b3J5KiogcHJvcGVydGllcyBhbmQgbWV0aG9kcy4KICBfLmV4dGVuZChIaXN0b3J5LnByb3RvdHlwZSwgRXZlbnRzLCB7CgogICAgLy8gVGhlIGRlZmF1bHQgaW50ZXJ2YWwgdG8gcG9sbCBmb3IgaGFzaCBjaGFuZ2VzLCBpZiBuZWNlc3NhcnksIGlzCiAgICAvLyB0d2VudHkgdGltZXMgYSBzZWNvbmQuCiAgICBpbnRlcnZhbDogNTAsCgogICAgLy8gQXJlIHdlIGF0IHRoZSBhcHAgcm9vdD8KICAgIGF0Um9vdDogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiB0aGlzLmxvY2F0aW9uLnBhdGhuYW1lLnJlcGxhY2UoL1teXC9dJC8sICckJi8nKSA9PT0gdGhpcy5yb290OwogICAgfSwKCiAgICAvLyBHZXRzIHRoZSB0cnVlIGhhc2ggdmFsdWUuIENhbm5vdCB1c2UgbG9jYXRpb24uaGFzaCBkaXJlY3RseSBkdWUgdG8gYnVnCiAgICAvLyBpbiBGaXJlZm94IHdoZXJlIGxvY2F0aW9uLmhhc2ggd2lsbCBhbHdheXMgYmUgZGVjb2RlZC4KICAgIGdldEhhc2g6IGZ1bmN0aW9uKHdpbmRvdykgewogICAgICB2YXIgbWF0Y2ggPSAod2luZG93IHx8IHRoaXMpLmxvY2F0aW9uLmhyZWYubWF0Y2goLyMoLiopJC8pOwogICAgICByZXR1cm4gbWF0Y2ggPyBtYXRjaFsxXSA6ICcnOwogICAgfSwKCiAgICAvLyBHZXQgdGhlIGNyb3NzLWJyb3dzZXIgbm9ybWFsaXplZCBVUkwgZnJhZ21lbnQsIGVpdGhlciBmcm9tIHRoZSBVUkwsCiAgICAvLyB0aGUgaGFzaCwgb3IgdGhlIG92ZXJyaWRlLgogICAgZ2V0RnJhZ21lbnQ6IGZ1bmN0aW9uKGZyYWdtZW50LCBmb3JjZVB1c2hTdGF0ZSkgewogICAgICBpZiAoZnJhZ21lbnQgPT0gbnVsbCkgewogICAgICAgIGlmICh0aGlzLl9oYXNQdXNoU3RhdGUgfHwgIXRoaXMuX3dhbnRzSGFzaENoYW5nZSB8fCBmb3JjZVB1c2hTdGF0ZSkgewogICAgICAgICAgZnJhZ21lbnQgPSBkZWNvZGVVUkkodGhpcy5sb2NhdGlvbi5wYXRobmFtZSArIHRoaXMubG9jYXRpb24uc2VhcmNoKTsKICAgICAgICAgIHZhciByb290ID0gdGhpcy5yb290LnJlcGxhY2UodHJhaWxpbmdTbGFzaCwgJycpOwogICAgICAgICAgaWYgKCFmcmFnbWVudC5pbmRleE9mKHJvb3QpKSBmcmFnbWVudCA9IGZyYWdtZW50LnNsaWNlKHJvb3QubGVuZ3RoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZnJhZ21lbnQgPSB0aGlzLmdldEhhc2goKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIGZyYWdtZW50LnJlcGxhY2Uocm91dGVTdHJpcHBlciwgJycpOwogICAgfSwKCiAgICAvLyBTdGFydCB0aGUgaGFzaCBjaGFuZ2UgaGFuZGxpbmcsIHJldHVybmluZyBgdHJ1ZWAgaWYgdGhlIGN1cnJlbnQgVVJMIG1hdGNoZXMKICAgIC8vIGFuIGV4aXN0aW5nIHJvdXRlLCBhbmQgYGZhbHNlYCBvdGhlcndpc2UuCiAgICBzdGFydDogZnVuY3Rpb24ob3B0aW9ucykgewogICAgICBpZiAoSGlzdG9yeS5zdGFydGVkKSB0aHJvdyBuZXcgRXJyb3IoIkJhY2tib25lLmhpc3RvcnkgaGFzIGFscmVhZHkgYmVlbiBzdGFydGVkIik7CiAgICAgIEhpc3Rvcnkuc3RhcnRlZCA9IHRydWU7CgogICAgICAvLyBGaWd1cmUgb3V0IHRoZSBpbml0aWFsIGNvbmZpZ3VyYXRpb24uIERvIHdlIG5lZWQgYW4gaWZyYW1lPwogICAgICAvLyBJcyBwdXNoU3RhdGUgZGVzaXJlZCAuLi4gaXMgaXQgYXZhaWxhYmxlPwogICAgICB0aGlzLm9wdGlvbnMgICAgICAgICAgPSBfLmV4dGVuZCh7cm9vdDogJy8nfSwgdGhpcy5vcHRpb25zLCBvcHRpb25zKTsKICAgICAgdGhpcy5yb290ICAgICAgICAgICAgID0gdGhpcy5vcHRpb25zLnJvb3Q7CiAgICAgIHRoaXMuX3dhbnRzSGFzaENoYW5nZSA9IHRoaXMub3B0aW9ucy5oYXNoQ2hhbmdlICE9PSBmYWxzZTsKICAgICAgdGhpcy5fd2FudHNQdXNoU3RhdGUgID0gISF0aGlzLm9wdGlvbnMucHVzaFN0YXRlOwogICAgICB0aGlzLl9oYXNQdXNoU3RhdGUgICAgPSAhISh0aGlzLm9wdGlvbnMucHVzaFN0YXRlICYmIHRoaXMuaGlzdG9yeSAmJiB0aGlzLmhpc3RvcnkucHVzaFN0YXRlKTsKICAgICAgdmFyIGZyYWdtZW50ICAgICAgICAgID0gdGhpcy5nZXRGcmFnbWVudCgpOwogICAgICB2YXIgZG9jTW9kZSAgICAgICAgICAgPSBkb2N1bWVudC5kb2N1bWVudE1vZGU7CiAgICAgIHZhciBvbGRJRSAgICAgICAgICAgICA9IChpc0V4cGxvcmVyLmV4ZWMobmF2aWdhdG9yLnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpKSAmJiAoIWRvY01vZGUgfHwgZG9jTW9kZSA8PSA3KSk7CgogICAgICAvLyBOb3JtYWxpemUgcm9vdCB0byBhbHdheXMgaW5jbHVkZSBhIGxlYWRpbmcgYW5kIHRyYWlsaW5nIHNsYXNoLgogICAgICB0aGlzLnJvb3QgPSAoJy8nICsgdGhpcy5yb290ICsgJy8nKS5yZXBsYWNlKHJvb3RTdHJpcHBlciwgJy8nKTsKCiAgICAgIGlmIChvbGRJRSAmJiB0aGlzLl93YW50c0hhc2hDaGFuZ2UpIHsKICAgICAgICB2YXIgZnJhbWUgPSBCYWNrYm9uZS4kKCc8aWZyYW1lIHNyYz0iamF2YXNjcmlwdDowIiB0YWJpbmRleD0iLTEiPicpOwogICAgICAgIHRoaXMuaWZyYW1lID0gZnJhbWUuaGlkZSgpLmFwcGVuZFRvKCdib2R5JylbMF0uY29udGVudFdpbmRvdzsKICAgICAgICB0aGlzLm5hdmlnYXRlKGZyYWdtZW50KTsKICAgICAgfQoKICAgICAgLy8gRGVwZW5kaW5nIG9uIHdoZXRoZXIgd2UncmUgdXNpbmcgcHVzaFN0YXRlIG9yIGhhc2hlcywgYW5kIHdoZXRoZXIKICAgICAgLy8gJ29uaGFzaGNoYW5nZScgaXMgc3VwcG9ydGVkLCBkZXRlcm1pbmUgaG93IHdlIGNoZWNrIHRoZSBVUkwgc3RhdGUuCiAgICAgIGlmICh0aGlzLl9oYXNQdXNoU3RhdGUpIHsKICAgICAgICBCYWNrYm9uZS4kKHdpbmRvdykub24oJ3BvcHN0YXRlJywgdGhpcy5jaGVja1VybCk7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5fd2FudHNIYXNoQ2hhbmdlICYmICgnb25oYXNoY2hhbmdlJyBpbiB3aW5kb3cpICYmICFvbGRJRSkgewogICAgICAgIEJhY2tib25lLiQod2luZG93KS5vbignaGFzaGNoYW5nZScsIHRoaXMuY2hlY2tVcmwpOwogICAgICB9IGVsc2UgaWYgKHRoaXMuX3dhbnRzSGFzaENoYW5nZSkgewogICAgICAgIHRoaXMuX2NoZWNrVXJsSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCh0aGlzLmNoZWNrVXJsLCB0aGlzLmludGVydmFsKTsKICAgICAgfQoKICAgICAgLy8gRGV0ZXJtaW5lIGlmIHdlIG5lZWQgdG8gY2hhbmdlIHRoZSBiYXNlIHVybCwgZm9yIGEgcHVzaFN0YXRlIGxpbmsKICAgICAgLy8gb3BlbmVkIGJ5IGEgbm9uLXB1c2hTdGF0ZSBicm93c2VyLgogICAgICB0aGlzLmZyYWdtZW50ID0gZnJhZ21lbnQ7CiAgICAgIHZhciBsb2MgPSB0aGlzLmxvY2F0aW9uOwoKICAgICAgLy8gVHJhbnNpdGlvbiBmcm9tIGhhc2hDaGFuZ2UgdG8gcHVzaFN0YXRlIG9yIHZpY2UgdmVyc2EgaWYgYm90aCBhcmUKICAgICAgLy8gcmVxdWVzdGVkLgogICAgICBpZiAodGhpcy5fd2FudHNIYXNoQ2hhbmdlICYmIHRoaXMuX3dhbnRzUHVzaFN0YXRlKSB7CgogICAgICAgIC8vIElmIHdlJ3ZlIHN0YXJ0ZWQgb2ZmIHdpdGggYSByb3V0ZSBmcm9tIGEgYHB1c2hTdGF0ZWAtZW5hYmxlZAogICAgICAgIC8vIGJyb3dzZXIsIGJ1dCB3ZSdyZSBjdXJyZW50bHkgaW4gYSBicm93c2VyIHRoYXQgZG9lc24ndCBzdXBwb3J0IGl0Li4uCiAgICAgICAgaWYgKCF0aGlzLl9oYXNQdXNoU3RhdGUgJiYgIXRoaXMuYXRSb290KCkpIHsKICAgICAgICAgIHRoaXMuZnJhZ21lbnQgPSB0aGlzLmdldEZyYWdtZW50KG51bGwsIHRydWUpOwogICAgICAgICAgdGhpcy5sb2NhdGlvbi5yZXBsYWNlKHRoaXMucm9vdCArICcjJyArIHRoaXMuZnJhZ21lbnQpOwogICAgICAgICAgLy8gUmV0dXJuIGltbWVkaWF0ZWx5IGFzIGJyb3dzZXIgd2lsbCBkbyByZWRpcmVjdCB0byBuZXcgdXJsCiAgICAgICAgICByZXR1cm4gdHJ1ZTsKCiAgICAgICAgLy8gT3IgaWYgd2UndmUgc3RhcnRlZCBvdXQgd2l0aCBhIGhhc2gtYmFzZWQgcm91dGUsIGJ1dCB3ZSdyZSBjdXJyZW50bHkKICAgICAgICAvLyBpbiBhIGJyb3dzZXIgd2hlcmUgaXQgY291bGQgYmUgYHB1c2hTdGF0ZWAtYmFzZWQgaW5zdGVhZC4uLgogICAgICAgIH0gZWxzZSBpZiAodGhpcy5faGFzUHVzaFN0YXRlICYmIHRoaXMuYXRSb290KCkgJiYgbG9jLmhhc2gpIHsKICAgICAgICAgIHRoaXMuZnJhZ21lbnQgPSB0aGlzLmdldEhhc2goKS5yZXBsYWNlKHJvdXRlU3RyaXBwZXIsICcnKTsKICAgICAgICAgIHRoaXMuaGlzdG9yeS5yZXBsYWNlU3RhdGUoe30sIGRvY3VtZW50LnRpdGxlLCB0aGlzLnJvb3QgKyB0aGlzLmZyYWdtZW50KTsKICAgICAgICB9CgogICAgICB9CgogICAgICBpZiAoIXRoaXMub3B0aW9ucy5zaWxlbnQpIHJldHVybiB0aGlzLmxvYWRVcmwoKTsKICAgIH0sCgogICAgLy8gRGlzYWJsZSBCYWNrYm9uZS5oaXN0b3J5LCBwZXJoYXBzIHRlbXBvcmFyaWx5LiBOb3QgdXNlZnVsIGluIGEgcmVhbCBhcHAsCiAgICAvLyBidXQgcG9zc2libHkgdXNlZnVsIGZvciB1bml0IHRlc3RpbmcgUm91dGVycy4KICAgIHN0b3A6IGZ1bmN0aW9uKCkgewogICAgICBCYWNrYm9uZS4kKHdpbmRvdykub2ZmKCdwb3BzdGF0ZScsIHRoaXMuY2hlY2tVcmwpLm9mZignaGFzaGNoYW5nZScsIHRoaXMuY2hlY2tVcmwpOwogICAgICBpZiAodGhpcy5fY2hlY2tVcmxJbnRlcnZhbCkgY2xlYXJJbnRlcnZhbCh0aGlzLl9jaGVja1VybEludGVydmFsKTsKICAgICAgSGlzdG9yeS5zdGFydGVkID0gZmFsc2U7CiAgICB9LAoKICAgIC8vIEFkZCBhIHJvdXRlIHRvIGJlIHRlc3RlZCB3aGVuIHRoZSBmcmFnbWVudCBjaGFuZ2VzLiBSb3V0ZXMgYWRkZWQgbGF0ZXIKICAgIC8vIG1heSBvdmVycmlkZSBwcmV2aW91cyByb3V0ZXMuCiAgICByb3V0ZTogZnVuY3Rpb24ocm91dGUsIGNhbGxiYWNrKSB7CiAgICAgIHRoaXMuaGFuZGxlcnMudW5zaGlmdCh7cm91dGU6IHJvdXRlLCBjYWxsYmFjazogY2FsbGJhY2t9KTsKICAgIH0sCgogICAgLy8gQ2hlY2tzIHRoZSBjdXJyZW50IFVSTCB0byBzZWUgaWYgaXQgaGFzIGNoYW5nZWQsIGFuZCBpZiBpdCBoYXMsCiAgICAvLyBjYWxscyBgbG9hZFVybGAsIG5vcm1hbGl6aW5nIGFjcm9zcyB0aGUgaGlkZGVuIGlmcmFtZS4KICAgIGNoZWNrVXJsOiBmdW5jdGlvbihlKSB7CiAgICAgIHZhciBjdXJyZW50ID0gdGhpcy5nZXRGcmFnbWVudCgpOwogICAgICBpZiAoY3VycmVudCA9PT0gdGhpcy5mcmFnbWVudCAmJiB0aGlzLmlmcmFtZSkgewogICAgICAgIGN1cnJlbnQgPSB0aGlzLmdldEZyYWdtZW50KHRoaXMuZ2V0SGFzaCh0aGlzLmlmcmFtZSkpOwogICAgICB9CiAgICAgIGlmIChjdXJyZW50ID09PSB0aGlzLmZyYWdtZW50KSByZXR1cm4gZmFsc2U7CiAgICAgIGlmICh0aGlzLmlmcmFtZSkgdGhpcy5uYXZpZ2F0ZShjdXJyZW50KTsKICAgICAgdGhpcy5sb2FkVXJsKCk7CiAgICB9LAoKICAgIC8vIEF0dGVtcHQgdG8gbG9hZCB0aGUgY3VycmVudCBVUkwgZnJhZ21lbnQuIElmIGEgcm91dGUgc3VjY2VlZHMgd2l0aCBhCiAgICAvLyBtYXRjaCwgcmV0dXJucyBgdHJ1ZWAuIElmIG5vIGRlZmluZWQgcm91dGVzIG1hdGNoZXMgdGhlIGZyYWdtZW50LAogICAgLy8gcmV0dXJucyBgZmFsc2VgLgogICAgbG9hZFVybDogZnVuY3Rpb24oZnJhZ21lbnQpIHsKICAgICAgZnJhZ21lbnQgPSB0aGlzLmZyYWdtZW50ID0gdGhpcy5nZXRGcmFnbWVudChmcmFnbWVudCk7CiAgICAgIHJldHVybiBfLmFueSh0aGlzLmhhbmRsZXJzLCBmdW5jdGlvbihoYW5kbGVyKSB7CiAgICAgICAgaWYgKGhhbmRsZXIucm91dGUudGVzdChmcmFnbWVudCkpIHsKICAgICAgICAgIGhhbmRsZXIuY2FsbGJhY2soZnJhZ21lbnQpOwogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCgogICAgLy8gU2F2ZSBhIGZyYWdtZW50IGludG8gdGhlIGhhc2ggaGlzdG9yeSwgb3IgcmVwbGFjZSB0aGUgVVJMIHN0YXRlIGlmIHRoZQogICAgLy8gJ3JlcGxhY2UnIG9wdGlvbiBpcyBwYXNzZWQuIFlvdSBhcmUgcmVzcG9uc2libGUgZm9yIHByb3Blcmx5IFVSTC1lbmNvZGluZwogICAgLy8gdGhlIGZyYWdtZW50IGluIGFkdmFuY2UuCiAgICAvLwogICAgLy8gVGhlIG9wdGlvbnMgb2JqZWN0IGNhbiBjb250YWluIGB0cmlnZ2VyOiB0cnVlYCBpZiB5b3Ugd2lzaCB0byBoYXZlIHRoZQogICAgLy8gcm91dGUgY2FsbGJhY2sgYmUgZmlyZWQgKG5vdCB1c3VhbGx5IGRlc2lyYWJsZSksIG9yIGByZXBsYWNlOiB0cnVlYCwgaWYKICAgIC8vIHlvdSB3aXNoIHRvIG1vZGlmeSB0aGUgY3VycmVudCBVUkwgd2l0aG91dCBhZGRpbmcgYW4gZW50cnkgdG8gdGhlIGhpc3RvcnkuCiAgICBuYXZpZ2F0ZTogZnVuY3Rpb24oZnJhZ21lbnQsIG9wdGlvbnMpIHsKICAgICAgaWYgKCFIaXN0b3J5LnN0YXJ0ZWQpIHJldHVybiBmYWxzZTsKICAgICAgaWYgKCFvcHRpb25zIHx8IG9wdGlvbnMgPT09IHRydWUpIG9wdGlvbnMgPSB7dHJpZ2dlcjogISFvcHRpb25zfTsKCiAgICAgIHZhciB1cmwgPSB0aGlzLnJvb3QgKyAoZnJhZ21lbnQgPSB0aGlzLmdldEZyYWdtZW50KGZyYWdtZW50IHx8ICcnKSk7CgogICAgICAvLyBTdHJpcCB0aGUgaGFzaCBmb3IgbWF0Y2hpbmcuCiAgICAgIGZyYWdtZW50ID0gZnJhZ21lbnQucmVwbGFjZShwYXRoU3RyaXBwZXIsICcnKTsKCiAgICAgIGlmICh0aGlzLmZyYWdtZW50ID09PSBmcmFnbWVudCkgcmV0dXJuOwogICAgICB0aGlzLmZyYWdtZW50ID0gZnJhZ21lbnQ7CgogICAgICAvLyBEb24ndCBpbmNsdWRlIGEgdHJhaWxpbmcgc2xhc2ggb24gdGhlIHJvb3QuCiAgICAgIGlmIChmcmFnbWVudCA9PT0gJycgJiYgdXJsICE9PSAnLycpIHVybCA9IHVybC5zbGljZSgwLCAtMSk7CgogICAgICAvLyBJZiBwdXNoU3RhdGUgaXMgYXZhaWxhYmxlLCB3ZSB1c2UgaXQgdG8gc2V0IHRoZSBmcmFnbWVudCBhcyBhIHJlYWwgVVJMLgogICAgICBpZiAodGhpcy5faGFzUHVzaFN0YXRlKSB7CiAgICAgICAgdGhpcy5oaXN0b3J5W29wdGlvbnMucmVwbGFjZSA/ICdyZXBsYWNlU3RhdGUnIDogJ3B1c2hTdGF0ZSddKHt9LCBkb2N1bWVudC50aXRsZSwgdXJsKTsKCiAgICAgIC8vIElmIGhhc2ggY2hhbmdlcyBoYXZlbid0IGJlZW4gZXhwbGljaXRseSBkaXNhYmxlZCwgdXBkYXRlIHRoZSBoYXNoCiAgICAgIC8vIGZyYWdtZW50IHRvIHN0b3JlIGhpc3RvcnkuCiAgICAgIH0gZWxzZSBpZiAodGhpcy5fd2FudHNIYXNoQ2hhbmdlKSB7CiAgICAgICAgdGhpcy5fdXBkYXRlSGFzaCh0aGlzLmxvY2F0aW9uLCBmcmFnbWVudCwgb3B0aW9ucy5yZXBsYWNlKTsKICAgICAgICBpZiAodGhpcy5pZnJhbWUgJiYgKGZyYWdtZW50ICE9PSB0aGlzLmdldEZyYWdtZW50KHRoaXMuZ2V0SGFzaCh0aGlzLmlmcmFtZSkpKSkgewogICAgICAgICAgLy8gT3BlbmluZyBhbmQgY2xvc2luZyB0aGUgaWZyYW1lIHRyaWNrcyBJRTcgYW5kIGVhcmxpZXIgdG8gcHVzaCBhCiAgICAgICAgICAvLyBoaXN0b3J5IGVudHJ5IG9uIGhhc2gtdGFnIGNoYW5nZS4gIFdoZW4gcmVwbGFjZSBpcyB0cnVlLCB3ZSBkb24ndAogICAgICAgICAgLy8gd2FudCB0aGlzLgogICAgICAgICAgaWYoIW9wdGlvbnMucmVwbGFjZSkgdGhpcy5pZnJhbWUuZG9jdW1lbnQub3BlbigpLmNsb3NlKCk7CiAgICAgICAgICB0aGlzLl91cGRhdGVIYXNoKHRoaXMuaWZyYW1lLmxvY2F0aW9uLCBmcmFnbWVudCwgb3B0aW9ucy5yZXBsYWNlKTsKICAgICAgICB9CgogICAgICAvLyBJZiB5b3UndmUgdG9sZCB1cyB0aGF0IHlvdSBleHBsaWNpdGx5IGRvbid0IHdhbnQgZmFsbGJhY2sgaGFzaGNoYW5nZS0KICAgICAgLy8gYmFzZWQgaGlzdG9yeSwgdGhlbiBgbmF2aWdhdGVgIGJlY29tZXMgYSBwYWdlIHJlZnJlc2guCiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIHRoaXMubG9jYXRpb24uYXNzaWduKHVybCk7CiAgICAgIH0KICAgICAgaWYgKG9wdGlvbnMudHJpZ2dlcikgcmV0dXJuIHRoaXMubG9hZFVybChmcmFnbWVudCk7CiAgICB9LAoKICAgIC8vIFVwZGF0ZSB0aGUgaGFzaCBsb2NhdGlvbiwgZWl0aGVyIHJlcGxhY2luZyB0aGUgY3VycmVudCBlbnRyeSwgb3IgYWRkaW5nCiAgICAvLyBhIG5ldyBvbmUgdG8gdGhlIGJyb3dzZXIgaGlzdG9yeS4KICAgIF91cGRhdGVIYXNoOiBmdW5jdGlvbihsb2NhdGlvbiwgZnJhZ21lbnQsIHJlcGxhY2UpIHsKICAgICAgaWYgKHJlcGxhY2UpIHsKICAgICAgICB2YXIgaHJlZiA9IGxvY2F0aW9uLmhyZWYucmVwbGFjZSgvKGphdmFzY3JpcHQ6fCMpLiokLywgJycpOwogICAgICAgIGxvY2F0aW9uLnJlcGxhY2UoaHJlZiArICcjJyArIGZyYWdtZW50KTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBTb21lIGJyb3dzZXJzIHJlcXVpcmUgdGhhdCBgaGFzaGAgY29udGFpbnMgYSBsZWFkaW5nICMuCiAgICAgICAgbG9jYXRpb24uaGFzaCA9ICcjJyArIGZyYWdtZW50OwogICAgICB9CiAgICB9CgogIH0pOwoKICAvLyBDcmVhdGUgdGhlIGRlZmF1bHQgQmFja2JvbmUuaGlzdG9yeS4KICBCYWNrYm9uZS5oaXN0b3J5ID0gbmV3IEhpc3Rvcnk7CgogIC8vIEhlbHBlcnMKICAvLyAtLS0tLS0tCgogIC8vIEhlbHBlciBmdW5jdGlvbiB0byBjb3JyZWN0bHkgc2V0IHVwIHRoZSBwcm90b3R5cGUgY2hhaW4sIGZvciBzdWJjbGFzc2VzLgogIC8vIFNpbWlsYXIgdG8gYGdvb2cuaW5oZXJpdHNgLCBidXQgdXNlcyBhIGhhc2ggb2YgcHJvdG90eXBlIHByb3BlcnRpZXMgYW5kCiAgLy8gY2xhc3MgcHJvcGVydGllcyB0byBiZSBleHRlbmRlZC4KICB2YXIgZXh0ZW5kID0gZnVuY3Rpb24ocHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsKICAgIHZhciBwYXJlbnQgPSB0aGlzOwogICAgdmFyIGNoaWxkOwoKICAgIC8vIFRoZSBjb25zdHJ1Y3RvciBmdW5jdGlvbiBmb3IgdGhlIG5ldyBzdWJjbGFzcyBpcyBlaXRoZXIgZGVmaW5lZCBieSB5b3UKICAgIC8vICh0aGUgImNvbnN0cnVjdG9yIiBwcm9wZXJ0eSBpbiB5b3VyIGBleHRlbmRgIGRlZmluaXRpb24pLCBvciBkZWZhdWx0ZWQKICAgIC8vIGJ5IHVzIHRvIHNpbXBseSBjYWxsIHRoZSBwYXJlbnQncyBjb25zdHJ1Y3Rvci4KICAgIGlmIChwcm90b1Byb3BzICYmIF8uaGFzKHByb3RvUHJvcHMsICdjb25zdHJ1Y3RvcicpKSB7CiAgICAgIGNoaWxkID0gcHJvdG9Qcm9wcy5jb25zdHJ1Y3RvcjsKICAgIH0gZWxzZSB7CiAgICAgIGNoaWxkID0gZnVuY3Rpb24oKXsgcmV0dXJuIHBhcmVudC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyB9OwogICAgfQoKICAgIC8vIEFkZCBzdGF0aWMgcHJvcGVydGllcyB0byB0aGUgY29uc3RydWN0b3IgZnVuY3Rpb24sIGlmIHN1cHBsaWVkLgogICAgXy5leHRlbmQoY2hpbGQsIHBhcmVudCwgc3RhdGljUHJvcHMpOwoKICAgIC8vIFNldCB0aGUgcHJvdG90eXBlIGNoYWluIHRvIGluaGVyaXQgZnJvbSBgcGFyZW50YCwgd2l0aG91dCBjYWxsaW5nCiAgICAvLyBgcGFyZW50YCdzIGNvbnN0cnVjdG9yIGZ1bmN0aW9uLgogICAgdmFyIFN1cnJvZ2F0ZSA9IGZ1bmN0aW9uKCl7IHRoaXMuY29uc3RydWN0b3IgPSBjaGlsZDsgfTsKICAgIFN1cnJvZ2F0ZS5wcm90b3R5cGUgPSBwYXJlbnQucHJvdG90eXBlOwogICAgY2hpbGQucHJvdG90eXBlID0gbmV3IFN1cnJvZ2F0ZTsKCiAgICAvLyBBZGQgcHJvdG90eXBlIHByb3BlcnRpZXMgKGluc3RhbmNlIHByb3BlcnRpZXMpIHRvIHRoZSBzdWJjbGFzcywKICAgIC8vIGlmIHN1cHBsaWVkLgogICAgaWYgKHByb3RvUHJvcHMpIF8uZXh0ZW5kKGNoaWxkLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7CgogICAgLy8gU2V0IGEgY29udmVuaWVuY2UgcHJvcGVydHkgaW4gY2FzZSB0aGUgcGFyZW50J3MgcHJvdG90eXBlIGlzIG5lZWRlZAogICAgLy8gbGF0ZXIuCiAgICBjaGlsZC5fX3N1cGVyX18gPSBwYXJlbnQucHJvdG90eXBlOwoKICAgIHJldHVybiBjaGlsZDsKICB9OwoKICAvLyBTZXQgdXAgaW5oZXJpdGFuY2UgZm9yIHRoZSBtb2RlbCwgY29sbGVjdGlvbiwgcm91dGVyLCB2aWV3IGFuZCBoaXN0b3J5LgogIE1vZGVsLmV4dGVuZCA9IENvbGxlY3Rpb24uZXh0ZW5kID0gUm91dGVyLmV4dGVuZCA9IFZpZXcuZXh0ZW5kID0gSGlzdG9yeS5leHRlbmQgPSBleHRlbmQ7CgogIC8vIFRocm93IGFuIGVycm9yIHdoZW4gYSBVUkwgaXMgbmVlZGVkLCBhbmQgbm9uZSBpcyBzdXBwbGllZC4KICB2YXIgdXJsRXJyb3IgPSBmdW5jdGlvbigpIHsKICAgIHRocm93IG5ldyBFcnJvcignQSAidXJsIiBwcm9wZXJ0eSBvciBmdW5jdGlvbiBtdXN0IGJlIHNwZWNpZmllZCcpOwogIH07CgogIC8vIFdyYXAgYW4gb3B0aW9uYWwgZXJyb3IgY2FsbGJhY2sgd2l0aCBhIGZhbGxiYWNrIGVycm9yIGV2ZW50LgogIHZhciB3cmFwRXJyb3IgPSBmdW5jdGlvbihtb2RlbCwgb3B0aW9ucykgewogICAgdmFyIGVycm9yID0gb3B0aW9ucy5lcnJvcjsKICAgIG9wdGlvbnMuZXJyb3IgPSBmdW5jdGlvbihyZXNwKSB7CiAgICAgIGlmIChlcnJvcikgZXJyb3IobW9kZWwsIHJlc3AsIG9wdGlvbnMpOwogICAgICBtb2RlbC50cmlnZ2VyKCdlcnJvcicsIG1vZGVsLCByZXNwLCBvcHRpb25zKTsKICAgIH07CiAgfTsKCiAgcmV0dXJuIEJhY2tib25lOwoKfSkpOwoKLyoqCiAqIEJhY2tib25lIGxvY2FsU3RvcmFnZSBhbmQgc2Vzc2lvblN0b3JhZ2UgQWRhcHRlcgogKiBWZXJzaW9uIDAuMC4xCiAqCiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9qY2JyYW5kL0JhY2tib25lLmJyb3dzZXJTdG9yYWdlCiAqLwooZnVuY3Rpb24gKHJvb3QsIGZhY3RvcnkpIHsKICBpZiAodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnICYmIHR5cGVvZiByZXF1aXJlID09PSAnZnVuY3Rpb24nKSB7CiAgICBtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkocmVxdWlyZSgiYmFja2JvbmUiKSwgcmVxdWlyZSgndW5kZXJzY29yZScpKTsKICB9IGVsc2UgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICJmdW5jdGlvbiIgJiYgZGVmaW5lLmFtZCkgewogICAgLy8gQU1ELiBSZWdpc3RlciBhcyBhbiBhbm9ueW1vdXMgbW9kdWxlLgogICAgZGVmaW5lKCdiYWNrYm9uZS5icm93c2VyU3RvcmFnZScsWyJiYWNrYm9uZSIsICJ1bmRlcnNjb3JlIl0sIGZ1bmN0aW9uKEJhY2tib25lLCBfKSB7CiAgICAgIC8vIFVzZSBnbG9iYWwgdmFyaWFibGVzIGlmIHRoZSBsb2NhbHMgYXJlIHVuZGVmaW5lZC4KICAgICAgcmV0dXJuIGZhY3RvcnkoQmFja2JvbmUgfHwgcm9vdC5CYWNrYm9uZSwgXyB8fCByb290Ll8pOwogICAgfSk7CiAgfSBlbHNlIHsKICAgIGZhY3RvcnkoQmFja2JvbmUsIF8pOwogIH0KfSh0aGlzLCBmdW5jdGlvbihCYWNrYm9uZSwgXykgewovLyBBIHNpbXBsZSBtb2R1bGUgdG8gcmVwbGFjZSBgQmFja2JvbmUuc3luY2Agd2l0aCAqYnJvd3NlciBzdG9yYWdlKi1iYXNlZAovLyBwZXJzaXN0ZW5jZS4gTW9kZWxzIGFyZSBnaXZlbiBHVUlEUywgYW5kIHNhdmVkIGludG8gYSBKU09OIG9iamVjdC4gU2ltcGxlCi8vIGFzIHRoYXQuCgovLyBIb2xkIHJlZmVyZW5jZSB0byBVbmRlcnNjb3JlLmpzIGFuZCBCYWNrYm9uZS5qcyBpbiB0aGUgY2xvc3VyZSBpbiBvcmRlcgovLyB0byBtYWtlIHRoaW5ncyB3b3JrIGV2ZW4gaWYgdGhleSBhcmUgcmVtb3ZlZCBmcm9tIHRoZSBnbG9iYWwgbmFtZXNwYWNlCgovLyBHZW5lcmF0ZSBmb3VyIHJhbmRvbSBoZXggZGlnaXRzLgpmdW5jdGlvbiBTNCgpIHsKICAgcmV0dXJuICgoKDErTWF0aC5yYW5kb20oKSkqMHgxMDAwMCl8MCkudG9TdHJpbmcoMTYpLnN1YnN0cmluZygxKTsKfQoKLy8gR2VuZXJhdGUgYSBwc2V1ZG8tR1VJRCBieSBjb25jYXRlbmF0aW5nIHJhbmRvbSBoZXhhZGVjaW1hbC4KZnVuY3Rpb24gZ3VpZCgpIHsKICAgcmV0dXJuIChTNCgpK1M0KCkrIi0iK1M0KCkrIi0iK1M0KCkrIi0iK1M0KCkrIi0iK1M0KCkrUzQoKStTNCgpKTsKfQoKZnVuY3Rpb24gY29udGFpbnMoYXJyYXksIGl0ZW0pIHsKICB2YXIgaSA9IGFycmF5Lmxlbmd0aDsKICB3aGlsZSAoaS0tKSBpZiAoYXJyYXlbaV0gPT09IGl0ZW0pIHJldHVybiB0cnVlOwogIHJldHVybiBmYWxzZTsKfQoKZnVuY3Rpb24gZXh0ZW5kKG9iaiwgcHJvcHMpIHsKICBmb3IgKHZhciBrZXkgaW4gcHJvcHMpIHsgb2JqW2tleV0gPSBwcm9wc1trZXldOyB9CiAgcmV0dXJuIG9iajsKfQoKZnVuY3Rpb24gX2Jyb3dzZXJTdG9yYWdlIChuYW1lLCBzZXJpYWxpemVyLCB0eXBlKSB7CiAgICB2YXIgX3N0b3JlOwogICAgaWYgKHR5cGUgPT09ICdsb2NhbCcgJiYgIXdpbmRvdy5sb2NhbFN0b3JhZ2UgKSB7CiAgICAgICAgdGhyb3cgIkJhY2tib25lLmJyb3dzZXJTdG9yYWdlOiBFbnZpcm9ubWVudCBkb2VzIG5vdCBzdXBwb3J0IGxvY2FsU3RvcmFnZS4iOwogICAgfSBlbHNlIGlmICh0eXBlID09PSAnc2Vzc2lvbicgJiYgIXdpbmRvdy5zZXNzaW9uU3RvcmFnZSApIHsKICAgICAgICB0aHJvdyAiQmFja2JvbmUuYnJvd3NlclN0b3JhZ2U6IEVudmlyb25tZW50IGRvZXMgbm90IHN1cHBvcnQgc2Vzc2lvblN0b3JhZ2UuIjsKICAgIH0KICAgIHRoaXMubmFtZSA9IG5hbWU7CiAgICB0aGlzLnNlcmlhbGl6ZXIgPSBzZXJpYWxpemVyIHx8IHsKICAgICAgICBzZXJpYWxpemU6IGZ1bmN0aW9uKGl0ZW0pIHsKICAgICAgICByZXR1cm4gXy5pc09iamVjdChpdGVtKSA/IEpTT04uc3RyaW5naWZ5KGl0ZW0pIDogaXRlbTsKICAgICAgICB9LAogICAgICAgIC8vIGZpeCBmb3IgImlsbGVnYWwgYWNjZXNzIiBlcnJvciBvbiBBbmRyb2lkIHdoZW4gSlNPTi5wYXJzZSBpcyBwYXNzZWQgbnVsbAogICAgICAgIGRlc2VyaWFsaXplOiBmdW5jdGlvbiAoZGF0YSkgewogICAgICAgIHJldHVybiBkYXRhICYmIEpTT04ucGFyc2UoZGF0YSk7CiAgICAgICAgfQogICAgfTsKCiAgICBpZiAodHlwZSA9PT0gJ3Nlc3Npb24nKSB7CiAgICAgICAgdGhpcy5zdG9yZSA9IHdpbmRvdy5zZXNzaW9uU3RvcmFnZTsKICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ2xvY2FsJykgewogICAgICAgIHRoaXMuc3RvcmUgPSB3aW5kb3cubG9jYWxTdG9yYWdlOwogICAgfSBlbHNlIHsKICAgICAgICB0aHJvdyAiQmFja2JvbmUuYnJvd3NlclN0b3JhZ2U6IE5vIHN0b3JhZ2UgdHlwZSB3YXMgc3BlY2lmaWVkIjsKICAgIH0KICAgIF9zdG9yZSA9IHRoaXMuc3RvcmUuZ2V0SXRlbSh0aGlzLm5hbWUpOwogICAgdGhpcy5yZWNvcmRzID0gKF9zdG9yZSAmJiBfc3RvcmUuc3BsaXQoIiwiKSkgfHwgW107Cn0KCi8vIE91ciBTdG9yZSBpcyByZXByZXNlbnRlZCBieSBhIHNpbmdsZSBKUyBvYmplY3QgaW4gKmxvY2FsU3RvcmFnZSogb3IgKnNlc3Npb25TdG9yYWdlKi4KLy8gQ3JlYXRlIGl0IHdpdGggYSBtZWFuaW5nZnVsIG5hbWUsIGxpa2UgdGhlIG5hbWUgeW91J2QgZ2l2ZSBhIHRhYmxlLgpCYWNrYm9uZS5Ccm93c2VyU3RvcmFnZSA9IHsKICAgIGxvY2FsOiBmdW5jdGlvbiAobmFtZSwgc2VyaWFsaXplcikgewogICAgICAgIHJldHVybiBfYnJvd3NlclN0b3JhZ2UuYmluZCh0aGlzLCBuYW1lLCBzZXJpYWxpemVyLCAnbG9jYWwnKSgpOwogICAgfSwKICAgIHNlc3Npb246IGZ1bmN0aW9uIChuYW1lLCBzZXJpYWxpemVyKSB7CiAgICAgICAgcmV0dXJuIF9icm93c2VyU3RvcmFnZS5iaW5kKHRoaXMsIG5hbWUsIHNlcmlhbGl6ZXIsICdzZXNzaW9uJykoKTsKICAgIH0KfTsKCi8vIFRoZSBicm93c2VyJ3MgbG9jYWwgYW5kIHNlc3Npb24gc3RvcmVzIHdpbGwgYmUgZXh0ZW5kZWQgd2l0aCB0aGlzIG9iai4KdmFyIF9leHRlbnNpb24gPSB7CgogIC8vIFNhdmUgdGhlIGN1cnJlbnQgc3RhdGUgb2YgdGhlICoqU3RvcmUqKgogIHNhdmU6IGZ1bmN0aW9uKCkgewogICAgdGhpcy5zdG9yZS5zZXRJdGVtKHRoaXMubmFtZSwgdGhpcy5yZWNvcmRzLmpvaW4oIiwiKSk7CiAgfSwKCiAgLy8gQWRkIGEgbW9kZWwsIGdpdmluZyBpdCBhIChob3BlZnVsbHkpLXVuaXF1ZSBHVUlELCBpZiBpdCBkb2Vzbid0IGFscmVhZHkKICAvLyBoYXZlIGFuIGlkIG9mIGl0J3Mgb3duLgogIGNyZWF0ZTogZnVuY3Rpb24obW9kZWwpIHsKICAgIGlmICghbW9kZWwuaWQpIHsKICAgICAgbW9kZWwuaWQgPSBndWlkKCk7CiAgICAgIG1vZGVsLnNldChtb2RlbC5pZEF0dHJpYnV0ZSwgbW9kZWwuaWQpOwogICAgfQogICAgdGhpcy5zdG9yZS5zZXRJdGVtKHRoaXMuX2l0ZW1OYW1lKG1vZGVsLmlkKSwgdGhpcy5zZXJpYWxpemVyLnNlcmlhbGl6ZShtb2RlbCkpOwogICAgdGhpcy5yZWNvcmRzLnB1c2gobW9kZWwuaWQudG9TdHJpbmcoKSk7CiAgICB0aGlzLnNhdmUoKTsKICAgIHJldHVybiB0aGlzLmZpbmQobW9kZWwpICE9PSBmYWxzZTsKICB9LAoKICAvLyBVcGRhdGUgYSBtb2RlbCBieSByZXBsYWNpbmcgaXRzIGNvcHkgaW4gYHRoaXMuZGF0YWAuCiAgdXBkYXRlOiBmdW5jdGlvbihtb2RlbCkgewogICAgdGhpcy5zdG9yZS5zZXRJdGVtKHRoaXMuX2l0ZW1OYW1lKG1vZGVsLmlkKSwgdGhpcy5zZXJpYWxpemVyLnNlcmlhbGl6ZShtb2RlbCkpOwogICAgdmFyIG1vZGVsSWQgPSBtb2RlbC5pZC50b1N0cmluZygpOwogICAgaWYgKCFjb250YWlucyh0aGlzLnJlY29yZHMsIG1vZGVsSWQpKSB7CiAgICAgIHRoaXMucmVjb3Jkcy5wdXNoKG1vZGVsSWQpOwogICAgICB0aGlzLnNhdmUoKTsKICAgIH0KICAgIHJldHVybiB0aGlzLmZpbmQobW9kZWwpICE9PSBmYWxzZTsKICB9LAoKICAvLyBSZXRyaWV2ZSBhIG1vZGVsIGZyb20gYHRoaXMuZGF0YWAgYnkgaWQuCiAgZmluZDogZnVuY3Rpb24obW9kZWwpIHsKICAgIHJldHVybiB0aGlzLnNlcmlhbGl6ZXIuZGVzZXJpYWxpemUodGhpcy5zdG9yZS5nZXRJdGVtKHRoaXMuX2l0ZW1OYW1lKG1vZGVsLmlkKSkpOwogIH0sCgogIC8vIFJldHVybiB0aGUgYXJyYXkgb2YgYWxsIG1vZGVscyBjdXJyZW50bHkgaW4gc3RvcmFnZS4KICBmaW5kQWxsOiBmdW5jdGlvbigpIHsKICAgIHZhciByZXN1bHQgPSBbXTsKICAgIGZvciAodmFyIGkgPSAwLCBpZCwgZGF0YTsgaSA8IHRoaXMucmVjb3Jkcy5sZW5ndGg7IGkrKykgewogICAgICBpZCA9IHRoaXMucmVjb3Jkc1tpXTsKICAgICAgZGF0YSA9IHRoaXMuc2VyaWFsaXplci5kZXNlcmlhbGl6ZSh0aGlzLnN0b3JlLmdldEl0ZW0odGhpcy5faXRlbU5hbWUoaWQpKSk7CiAgICAgIGlmIChkYXRhICE9PSBudWxsKSByZXN1bHQucHVzaChkYXRhKTsKICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfSwKCiAgLy8gRGVsZXRlIGEgbW9kZWwgZnJvbSBgdGhpcy5kYXRhYCwgcmV0dXJuaW5nIGl0LgogIGRlc3Ryb3k6IGZ1bmN0aW9uKG1vZGVsKSB7CiAgICB0aGlzLnN0b3JlLnJlbW92ZUl0ZW0odGhpcy5faXRlbU5hbWUobW9kZWwuaWQpKTsKICAgIHZhciBtb2RlbElkID0gbW9kZWwuaWQudG9TdHJpbmcoKTsKICAgIGZvciAodmFyIGkgPSAwLCBpZDsgaSA8IHRoaXMucmVjb3Jkcy5sZW5ndGg7IGkrKykgewogICAgICBpZiAodGhpcy5yZWNvcmRzW2ldID09PSBtb2RlbElkKSB7CiAgICAgICAgdGhpcy5yZWNvcmRzLnNwbGljZShpLCAxKTsKICAgICAgfQogICAgfQogICAgdGhpcy5zYXZlKCk7CiAgICByZXR1cm4gbW9kZWw7CiAgfSwKCiAgYnJvd3NlclN0b3JhZ2U6IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIHsKICAgICAgICBzZXNzaW9uOiBzZXNzaW9uU3RvcmFnZSwKICAgICAgICBsb2NhbDogbG9jYWxTdG9yYWdlCiAgICB9OwogIH0sCgogIC8vIENsZWFyIGJyb3dzZXJTdG9yYWdlIGZvciBzcGVjaWZpYyBjb2xsZWN0aW9uLgogIF9jbGVhcjogZnVuY3Rpb24oKSB7CiAgICB2YXIgbG9jYWwgPSB0aGlzLnN0b3JlLAogICAgICBpdGVtUmUgPSBuZXcgUmVnRXhwKCJeIiArIHRoaXMubmFtZSArICItIik7CgogICAgLy8gUmVtb3ZlIGlkLXRyYWNraW5nIGl0ZW0gKGUuZy4sICJmb28iKS4KICAgIGxvY2FsLnJlbW92ZUl0ZW0odGhpcy5uYW1lKTsKCiAgICAvLyBNYXRjaCBhbGwgZGF0YSBpdGVtcyAoZS5nLiwgImZvby1JRCIpIGFuZCByZW1vdmUuCiAgICBmb3IgKHZhciBrIGluIGxvY2FsKSB7CiAgICAgIGlmIChpdGVtUmUudGVzdChrKSkgewogICAgICAgIGxvY2FsLnJlbW92ZUl0ZW0oayk7CiAgICAgIH0KICAgIH0KCiAgICB0aGlzLnJlY29yZHMubGVuZ3RoID0gMDsKICB9LAoKICAvLyBTaXplIG9mIGJyb3dzZXJTdG9yYWdlLgogIF9zdG9yYWdlU2l6ZTogZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gdGhpcy5zdG9yZS5sZW5ndGg7CiAgfSwKCiAgX2l0ZW1OYW1lOiBmdW5jdGlvbihpZCkgewogICAgcmV0dXJuIHRoaXMubmFtZSsiLSIraWQ7CiAgfQoKfTsKCmV4dGVuZChCYWNrYm9uZS5Ccm93c2VyU3RvcmFnZS5zZXNzaW9uLnByb3RvdHlwZSwgX2V4dGVuc2lvbik7CmV4dGVuZChCYWNrYm9uZS5Ccm93c2VyU3RvcmFnZS5sb2NhbC5wcm90b3R5cGUsIF9leHRlbnNpb24pOwoKLy8gbG9jYWxTeW5jIGRlbGVnYXRlIHRvIHRoZSBtb2RlbCBvciBjb2xsZWN0aW9uJ3MKLy8gKmJyb3dzZXJTdG9yYWdlKiBwcm9wZXJ0eSwgd2hpY2ggc2hvdWxkIGJlIGFuIGluc3RhbmNlIG9mIGBTdG9yZWAuCi8vIHdpbmRvdy5TdG9yZS5zeW5jIGFuZCBCYWNrYm9uZS5sb2NhbFN5bmMgaXMgZGVwcmVjYXRlZCwgdXNlIEJhY2tib25lLkJyb3dzZXJTdG9yYWdlLnN5bmMgaW5zdGVhZApCYWNrYm9uZS5Ccm93c2VyU3RvcmFnZS5zeW5jID0gQmFja2JvbmUubG9jYWxTeW5jID0gZnVuY3Rpb24obWV0aG9kLCBtb2RlbCwgb3B0aW9ucykgewogIHZhciBzdG9yZSA9IG1vZGVsLmJyb3dzZXJTdG9yYWdlIHx8IG1vZGVsLmNvbGxlY3Rpb24uYnJvd3NlclN0b3JhZ2U7CgogIHZhciByZXNwLCBlcnJvck1lc3NhZ2U7CiAgLy9JZiAkIGlzIGhhdmluZyBEZWZlcnJlZCAtIHVzZSBpdC4KICB2YXIgc3luY0RmZCA9IEJhY2tib25lLiQgPwogICAgKEJhY2tib25lLiQuRGVmZXJyZWQgJiYgQmFja2JvbmUuJC5EZWZlcnJlZCgpKSA6CiAgICAoQmFja2JvbmUuRGVmZXJyZWQgJiYgQmFja2JvbmUuRGVmZXJyZWQoKSk7CgogIHRyeSB7CgogICAgc3dpdGNoIChtZXRob2QpIHsKICAgICAgY2FzZSAicmVhZCI6CiAgICAgICAgcmVzcCA9IG1vZGVsLmlkICE9PSB1bmRlZmluZWQgPyBzdG9yZS5maW5kKG1vZGVsKSA6IHN0b3JlLmZpbmRBbGwoKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAiY3JlYXRlIjoKICAgICAgICByZXNwID0gc3RvcmUuY3JlYXRlKG1vZGVsKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAidXBkYXRlIjoKICAgICAgICByZXNwID0gc3RvcmUudXBkYXRlKG1vZGVsKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAiZGVsZXRlIjoKICAgICAgICByZXNwID0gc3RvcmUuZGVzdHJveShtb2RlbCk7CiAgICAgICAgYnJlYWs7CiAgICB9CgogIH0gY2F0Y2goZXJyb3IpIHsKICAgIGlmIChlcnJvci5jb2RlID09PSAyMiAmJiBzdG9yZS5fc3RvcmFnZVNpemUoKSA9PT0gMCkKICAgICAgZXJyb3JNZXNzYWdlID0gIlByaXZhdGUgYnJvd3NpbmcgaXMgdW5zdXBwb3J0ZWQiOwogICAgZWxzZQogICAgICBlcnJvck1lc3NhZ2UgPSBlcnJvci5tZXNzYWdlOwogIH0KCiAgaWYgKHJlc3ApIHsKICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMuc3VjY2VzcykgewogICAgICBpZiAoQmFja2JvbmUuVkVSU0lPTiA9PT0gIjAuOS4xMCIpIHsKICAgICAgICBvcHRpb25zLnN1Y2Nlc3MobW9kZWwsIHJlc3AsIG9wdGlvbnMpOwogICAgICB9IGVsc2UgewogICAgICAgIG9wdGlvbnMuc3VjY2VzcyhyZXNwKTsKICAgICAgfQogICAgfQogICAgaWYgKHN5bmNEZmQpIHsKICAgICAgc3luY0RmZC5yZXNvbHZlKHJlc3ApOwogICAgfQoKICB9IGVsc2UgewogICAgZXJyb3JNZXNzYWdlID0gZXJyb3JNZXNzYWdlID8gZXJyb3JNZXNzYWdlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiAiUmVjb3JkIE5vdCBGb3VuZCI7CgogICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5lcnJvcikKICAgICAgaWYgKEJhY2tib25lLlZFUlNJT04gPT09ICIwLjkuMTAiKSB7CiAgICAgICAgb3B0aW9ucy5lcnJvcihtb2RlbCwgZXJyb3JNZXNzYWdlLCBvcHRpb25zKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBvcHRpb25zLmVycm9yKGVycm9yTWVzc2FnZSk7CiAgICAgIH0KCiAgICBpZiAoc3luY0RmZCkKICAgICAgc3luY0RmZC5yZWplY3QoZXJyb3JNZXNzYWdlKTsKICB9CgogIC8vIGFkZCBjb21wYXRpYmlsaXR5IHdpdGggJC5hamF4CiAgLy8gYWx3YXlzIGV4ZWN1dGUgY2FsbGJhY2sgZm9yIHN1Y2Nlc3MgYW5kIGVycm9yCiAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5jb21wbGV0ZSkgb3B0aW9ucy5jb21wbGV0ZShyZXNwKTsKCiAgcmV0dXJuIHN5bmNEZmQgJiYgc3luY0RmZC5wcm9taXNlKCk7Cn07CgpCYWNrYm9uZS5hamF4U3luYyA9IEJhY2tib25lLnN5bmM7CgpCYWNrYm9uZS5nZXRTeW5jTWV0aG9kID0gZnVuY3Rpb24obW9kZWwpIHsKICBpZihtb2RlbC5icm93c2VyU3RvcmFnZSB8fCAobW9kZWwuY29sbGVjdGlvbiAmJiBtb2RlbC5jb2xsZWN0aW9uLmJyb3dzZXJTdG9yYWdlKSkgewogICAgcmV0dXJuIEJhY2tib25lLmxvY2FsU3luYzsKICB9CiAgcmV0dXJuIEJhY2tib25lLmFqYXhTeW5jOwp9OwoKLy8gT3ZlcnJpZGUgJ0JhY2tib25lLnN5bmMnIHRvIGRlZmF1bHQgdG8gbG9jYWxTeW5jLAovLyB0aGUgb3JpZ2luYWwgJ0JhY2tib25lLnN5bmMnIGlzIHN0aWxsIGF2YWlsYWJsZSBpbiAnQmFja2JvbmUuYWpheFN5bmMnCkJhY2tib25lLnN5bmMgPSBmdW5jdGlvbihtZXRob2QsIG1vZGVsLCBvcHRpb25zKSB7CiAgcmV0dXJuIEJhY2tib25lLmdldFN5bmNNZXRob2QobW9kZWwpLmFwcGx5KHRoaXMsIFttZXRob2QsIG1vZGVsLCBvcHRpb25zXSk7Cn07CgpyZXR1cm4gQmFja2JvbmUuQnJvd3NlclN0b3JhZ2U7Cn0pKTsKCi8qIQogKiBCYWNrYm9uZS5PdmVydmlldyAKICoKICogQ29weXJpZ2h0IChjKSAyMDE0LCBKQyBCcmFuZCA8amNAb3Brb2RlLmNvbT4KICogTGljZW5zZWQgdW5kZXIgdGhlIE1vemlsbGEgUHVibGljIExpY2Vuc2UgKE1QTCkgCiAqLwoKKGZ1bmN0aW9uIChyb290LCBmYWN0b3J5KSB7CiAgICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7CiAgICAgICAgZGVmaW5lKCdiYWNrYm9uZS5vdmVydmlldycsWyJ1bmRlcnNjb3JlIiwgImJhY2tib25lIl0sCiAgICAgICAgICAgIGZ1bmN0aW9uKF8sIEJhY2tib25lKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFjdG9yeShfIHx8IHJvb3QuXywgQmFja2JvbmUgfHwgcm9vdC5CYWNrYm9uZSk7CiAgICAgICAgICAgIH0KICAgICAgICApOwogICB9IGVsc2UgewogICAgICAvLyBSZXF1aXJlSlMgaXNuJ3QgYmVpbmcgdXNlZC4KICAgICAgLy8gQXNzdW1lIHVuZGVyc2NvcmUgYW5kIGJhY2tib25lIGFyZSBsb2FkZWQgaW4gPHNjcmlwdD4gdGFncwogICAgICBmYWN0b3J5KF8sIEJhY2tib25lKTsKICAgfQp9KHRoaXMsIGZ1bmN0aW9uIChfLCBCYWNrYm9uZSkgewogICAgCiAgICB2YXIgT3ZlcnZpZXcgPSBCYWNrYm9uZS5PdmVydmlldyA9IGZ1bmN0aW9uIChvcHRpb25zKSB7CiAgICAgICAgLyogQW4gT3ZlcnZpZXcgaXMgYSBWaWV3IHRoYXQgY29udGFpbnMgYW5kIGtlZXBzIHRyYWNrIG9mIHN1Yi12aWV3cy4KICAgICAgICAgKiBLaW5kIG9mIGxpa2Ugd2hhdCBhIENvbGxlY3Rpb24gaXMgdG8gYSBNb2RlbC4KICAgICAgICAgKi8KICAgICAgICB2YXIgdmlld3MgPSB7fTsKICAgICAgICB0aGlzLmtleXMgPSBmdW5jdGlvbiAoKSB7IHJldHVybiBfLmtleXModmlld3MpIH07CiAgICAgICAgdGhpcy5nZXRBbGwgPSBmdW5jdGlvbiAoKSB7IHJldHVybiB2aWV3czsgfTsKICAgICAgICB0aGlzLmdldCA9IGZ1bmN0aW9uIChpZCkgeyByZXR1cm4gdmlld3NbaWRdOyB9OwogICAgICAgIHRoaXMuYWRkID0gZnVuY3Rpb24gKGlkLCB2aWV3KSB7CiAgICAgICAgICAgIHZpZXdzW2lkXSA9IHZpZXc7CiAgICAgICAgICAgIHJldHVybiB2aWV3OwogICAgICAgIH07CiAgICAgICAgdGhpcy5yZW1vdmUgPSBmdW5jdGlvbiAoaWQpIHsKICAgICAgICAgICAgdmFyIHZpZXcgPSB2aWV3c1tpZF07CiAgICAgICAgICAgIGlmICh2aWV3KSB7CiAgICAgICAgICAgICAgICBkZWxldGUgdmlld3NbaWRdOwogICAgICAgICAgICAgICAgdmlldy5yZW1vdmUoKTsKICAgICAgICAgICAgICAgIHJldHVybiB2aWV3OwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICB0aGlzLnJlbW92ZUFsbCA9IGZ1bmN0aW9uIChpZCkgewogICAgICAgICAgICBfLmVhY2goXy5rZXlzKHZpZXdzKSwgdGhpcy5yZW1vdmUpOwogICAgICAgIH07CgogICAgICAgIEJhY2tib25lLlZpZXcuYXBwbHkodGhpcywgQXJyYXkucHJvdG90eXBlLnNsaWNlLmFwcGx5KGFyZ3VtZW50cykpOwogICAgfTsKICAgIF8uZXh0ZW5kKE92ZXJ2aWV3LnByb3RvdHlwZSwgQmFja2JvbmUuVmlldy5wcm90b3R5cGUpOwogICAgT3ZlcnZpZXcuZXh0ZW5kID0gQmFja2JvbmUuVmlldy5leHRlbmQ7CiAgICByZXR1cm4gQmFja2JvbmUuT3ZlcnZpZXc7Cn0pKTsKCi8qIQogKiB0eXBlYWhlYWQuanMgMC4xMC41CiAqIGh0dHBzOi8vZ2l0aHViLmNvbS90d2l0dGVyL3R5cGVhaGVhZC5qcwogKiBDb3B5cmlnaHQgMjAxMy0yMDE0IFR3aXR0ZXIsIEluYy4gYW5kIG90aGVyIGNvbnRyaWJ1dG9yczsgTGljZW5zZWQgTUlUCiAqLwoKKGZ1bmN0aW9uIChyb290LCBmYWN0b3J5KSB7CiAgICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7CiAgICAgICAgLy8gQU1ELiBSZWdpc3RlciBhcyBhbiBhbm9ueW1vdXMgbW9kdWxlLgogICAgICAgIGRlZmluZSgndHlwZWFoZWFkJyxbJ2pxdWVyeSddLCBmdW5jdGlvbiAoJCkgewogICAgICAgICAgICBmYWN0b3J5KCQsIHJvb3QpOwogICAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgICAvLyBCcm93c2VyIGdsb2JhbHMKICAgICAgICBmYWN0b3J5KGpRdWVyeSwgcm9vdCk7CiAgICB9Cn0odGhpcywgZnVuY3Rpb24oJCwgd2luZG93KSB7CiAgICB2YXIgXyA9IGZ1bmN0aW9uKCkgewogICAgICAgIAogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGlzTXNpZTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gLyhtc2llfHRyaWRlbnQpL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSA/IG5hdmlnYXRvci51c2VyQWdlbnQubWF0Y2goLyhtc2llIHxydjopKFxkKyguXGQrKT8pL2kpWzJdIDogZmFsc2U7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGlzQmxhbmtTdHJpbmc6IGZ1bmN0aW9uKHN0cikgewogICAgICAgICAgICAgICAgcmV0dXJuICFzdHIgfHwgL15ccyokLy50ZXN0KHN0cik7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVzY2FwZVJlZ0V4Q2hhcnM6IGZ1bmN0aW9uKHN0cikgewogICAgICAgICAgICAgICAgcmV0dXJuIHN0ci5yZXBsYWNlKC9bXC1cW1xdXC9ce1x9XChcKVwqXCtcP1wuXFxcXlwkXHxdL2csICJcXCQmIik7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGlzU3RyaW5nOiBmdW5jdGlvbihvYmopIHsKICAgICAgICAgICAgICAgIHJldHVybiB0eXBlb2Ygb2JqID09PSAic3RyaW5nIjsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgaXNOdW1iZXI6IGZ1bmN0aW9uKG9iaikgewogICAgICAgICAgICAgICAgcmV0dXJuIHR5cGVvZiBvYmogPT09ICJudW1iZXIiOwogICAgICAgICAgICB9LAogICAgICAgICAgICBpc0FycmF5OiAkLmlzQXJyYXksCiAgICAgICAgICAgIGlzRnVuY3Rpb246ICQuaXNGdW5jdGlvbiwKICAgICAgICAgICAgaXNPYmplY3Q6ICQuaXNQbGFpbk9iamVjdCwKICAgICAgICAgICAgaXNVbmRlZmluZWQ6IGZ1bmN0aW9uKG9iaikgewogICAgICAgICAgICAgICAgcmV0dXJuIHR5cGVvZiBvYmogPT09ICJ1bmRlZmluZWQiOwogICAgICAgICAgICB9LAogICAgICAgICAgICB0b1N0cjogZnVuY3Rpb24gdG9TdHIocykgewogICAgICAgICAgICAgICAgcmV0dXJuIF8uaXNVbmRlZmluZWQocykgfHwgcyA9PT0gbnVsbCA/ICIiIDogcyArICIiOwogICAgICAgICAgICB9LAogICAgICAgICAgICBiaW5kOiAkLnByb3h5LAogICAgICAgICAgICBlYWNoOiBmdW5jdGlvbihjb2xsZWN0aW9uLCBjYikgewogICAgICAgICAgICAgICAgJC5lYWNoKGNvbGxlY3Rpb24sIHJldmVyc2VBcmdzKTsKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHJldmVyc2VBcmdzKGluZGV4LCB2YWx1ZSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBjYih2YWx1ZSwgaW5kZXgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBtYXA6ICQubWFwLAogICAgICAgICAgICBmaWx0ZXI6ICQuZ3JlcCwKICAgICAgICAgICAgZXZlcnk6IGZ1bmN0aW9uKG9iaiwgdGVzdCkgewogICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHRydWU7CiAgICAgICAgICAgICAgICBpZiAoIW9iaikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkLmVhY2gob2JqLCBmdW5jdGlvbihrZXksIHZhbCkgewogICAgICAgICAgICAgICAgICAgIGlmICghKHJlc3VsdCA9IHRlc3QuY2FsbChudWxsLCB2YWwsIGtleSwgb2JqKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuICEhcmVzdWx0OwogICAgICAgICAgICB9LAogICAgICAgICAgICBzb21lOiBmdW5jdGlvbihvYmosIHRlc3QpIHsKICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSBmYWxzZTsKICAgICAgICAgICAgICAgIGlmICghb2JqKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICQuZWFjaChvYmosIGZ1bmN0aW9uKGtleSwgdmFsKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdCA9IHRlc3QuY2FsbChudWxsLCB2YWwsIGtleSwgb2JqKSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICByZXR1cm4gISFyZXN1bHQ7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG1peGluOiAkLmV4dGVuZCwKICAgICAgICAgICAgZ2V0VW5pcXVlSWQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdmFyIGNvdW50ZXIgPSAwOwogICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBjb3VudGVyKys7CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9KCksCiAgICAgICAgICAgIHRlbXBsYXRpZnk6IGZ1bmN0aW9uIHRlbXBsYXRpZnkob2JqKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJC5pc0Z1bmN0aW9uKG9iaikgPyBvYmogOiB0ZW1wbGF0ZTsKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHRlbXBsYXRlKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBTdHJpbmcob2JqKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgZGVmZXI6IGZ1bmN0aW9uKGZuKSB7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZuLCAwKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZGVib3VuY2U6IGZ1bmN0aW9uKGZ1bmMsIHdhaXQsIGltbWVkaWF0ZSkgewogICAgICAgICAgICAgICAgdmFyIHRpbWVvdXQsIHJlc3VsdDsKICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgY29udGV4dCA9IHRoaXMsIGFyZ3MgPSBhcmd1bWVudHMsIGxhdGVyLCBjYWxsTm93OwogICAgICAgICAgICAgICAgICAgIGxhdGVyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVvdXQgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWltbWVkaWF0ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgY2FsbE5vdyA9IGltbWVkaWF0ZSAmJiAhdGltZW91dDsKICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dCk7CiAgICAgICAgICAgICAgICAgICAgdGltZW91dCA9IHNldFRpbWVvdXQobGF0ZXIsIHdhaXQpOwogICAgICAgICAgICAgICAgICAgIGlmIChjYWxsTm93KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IGZ1bmMuYXBwbHkoY29udGV4dCwgYXJncyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9LAogICAgICAgICAgICB0aHJvdHRsZTogZnVuY3Rpb24oZnVuYywgd2FpdCkgewogICAgICAgICAgICAgICAgdmFyIGNvbnRleHQsIGFyZ3MsIHRpbWVvdXQsIHJlc3VsdCwgcHJldmlvdXMsIGxhdGVyOwogICAgICAgICAgICAgICAgcHJldmlvdXMgPSAwOwogICAgICAgICAgICAgICAgbGF0ZXIgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICBwcmV2aW91cyA9IG5ldyBEYXRlKCk7CiAgICAgICAgICAgICAgICAgICAgdGltZW91dCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIG5vdyA9IG5ldyBEYXRlKCksIHJlbWFpbmluZyA9IHdhaXQgLSAobm93IC0gcHJldmlvdXMpOwogICAgICAgICAgICAgICAgICAgIGNvbnRleHQgPSB0aGlzOwogICAgICAgICAgICAgICAgICAgIGFyZ3MgPSBhcmd1bWVudHM7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlbWFpbmluZyA8PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0KTsKICAgICAgICAgICAgICAgICAgICAgICAgdGltZW91dCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgIHByZXZpb3VzID0gbm93OwogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBmdW5jLmFwcGx5KGNvbnRleHQsIGFyZ3MpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIXRpbWVvdXQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGltZW91dCA9IHNldFRpbWVvdXQobGF0ZXIsIHJlbWFpbmluZyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9LAogICAgICAgICAgICBub29wOiBmdW5jdGlvbigpIHt9CiAgICAgICAgfTsKICAgIH0oKTsKICAgIHZhciBodG1sID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgd3JhcHBlcjogJzxzcGFuIGNsYXNzPSJ0d2l0dGVyLXR5cGVhaGVhZCI+PC9zcGFuPicsCiAgICAgICAgICAgIGRyb3Bkb3duOiAnPHNwYW4gY2xhc3M9InR0LWRyb3Bkb3duLW1lbnUiPjwvc3Bhbj4nLAogICAgICAgICAgICBkYXRhc2V0OiAnPGRpdiBjbGFzcz0idHQtZGF0YXNldC0lQ0xBU1MlIj48L2Rpdj4nLAogICAgICAgICAgICBzdWdnZXN0aW9uczogJzxzcGFuIGNsYXNzPSJ0dC1zdWdnZXN0aW9ucyI+PC9zcGFuPicsCiAgICAgICAgICAgIHN1Z2dlc3Rpb246ICc8ZGl2IGNsYXNzPSJ0dC1zdWdnZXN0aW9uIj48L2Rpdj4nCiAgICAgICAgfTsKICAgIH0oKTsKICAgIHZhciBjc3MgPSBmdW5jdGlvbigpIHsKICAgICAgICAKICAgICAgICB2YXIgY3NzID0gewogICAgICAgICAgICB3cmFwcGVyOiB7CiAgICAgICAgICAgICAgICBwb3NpdGlvbjogInJlbGF0aXZlIiwKICAgICAgICAgICAgICAgIGRpc3BsYXk6ICJpbmxpbmUtYmxvY2siCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGhpbnQ6IHsKICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAiYWJzb2x1dGUiLAogICAgICAgICAgICAgICAgdG9wOiAiMCIsCiAgICAgICAgICAgICAgICBsZWZ0OiAiMCIsCiAgICAgICAgICAgICAgICBib3JkZXJDb2xvcjogInRyYW5zcGFyZW50IiwKICAgICAgICAgICAgICAgIGJveFNoYWRvdzogIm5vbmUiLAogICAgICAgICAgICAgICAgb3BhY2l0eTogIjEiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGlucHV0OiB7CiAgICAgICAgICAgICAgICBwb3NpdGlvbjogInJlbGF0aXZlIiwKICAgICAgICAgICAgICAgIHZlcnRpY2FsQWxpZ246ICJ0b3AiLAogICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAidHJhbnNwYXJlbnQiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGlucHV0V2l0aE5vSGludDogewogICAgICAgICAgICAgICAgcG9zaXRpb246ICJyZWxhdGl2ZSIsCiAgICAgICAgICAgICAgICB2ZXJ0aWNhbEFsaWduOiAidG9wIgogICAgICAgICAgICB9LAogICAgICAgICAgICBkcm9wZG93bjogewogICAgICAgICAgICAgICAgcG9zaXRpb246ICJhYnNvbHV0ZSIsCiAgICAgICAgICAgICAgICB0b3A6ICIxMDAlIiwKICAgICAgICAgICAgICAgIGxlZnQ6ICIwIiwKICAgICAgICAgICAgICAgIHpJbmRleDogIjEwMCIsCiAgICAgICAgICAgICAgICBkaXNwbGF5OiAibm9uZSIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc3VnZ2VzdGlvbnM6IHsKICAgICAgICAgICAgICAgIGRpc3BsYXk6ICJibG9jayIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc3VnZ2VzdGlvbjogewogICAgICAgICAgICAgICAgd2hpdGVTcGFjZTogIm5vd3JhcCIsCiAgICAgICAgICAgICAgICBjdXJzb3I6ICJwb2ludGVyIgogICAgICAgICAgICB9LAogICAgICAgICAgICBzdWdnZXN0aW9uQ2hpbGQ6IHsKICAgICAgICAgICAgICAgIHdoaXRlU3BhY2U6ICJub3JtYWwiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGx0cjogewogICAgICAgICAgICAgICAgbGVmdDogIjAiLAogICAgICAgICAgICAgICAgcmlnaHQ6ICJhdXRvIgogICAgICAgICAgICB9LAogICAgICAgICAgICBydGw6IHsKICAgICAgICAgICAgICAgIGxlZnQ6ICJhdXRvIiwKICAgICAgICAgICAgICAgIHJpZ2h0OiAiIDAiCiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIGlmIChfLmlzTXNpZSgpKSB7CiAgICAgICAgICAgIF8ubWl4aW4oY3NzLmlucHV0LCB7CiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kSW1hZ2U6ICJ1cmwoZGF0YTppbWFnZS9naWY7YmFzZTY0LFIwbEdPRGxoQVFBQkFJQUFBQUFBQVAvLy95SDVCQUVBQUFBQUxBQUFBQUFCQUFFQUFBSUJSQUE3KSIKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGlmIChfLmlzTXNpZSgpICYmIF8uaXNNc2llKCkgPD0gNykgewogICAgICAgICAgICBfLm1peGluKGNzcy5pbnB1dCwgewogICAgICAgICAgICAgICAgbWFyZ2luVG9wOiAiLTFweCIKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBjc3M7CiAgICB9KCk7CiAgICB2YXIgRXZlbnRCdXMgPSBmdW5jdGlvbigpIHsKICAgICAgICAKICAgICAgICB2YXIgbmFtZXNwYWNlID0gInR5cGVhaGVhZDoiOwogICAgICAgIGZ1bmN0aW9uIEV2ZW50QnVzKG8pIHsKICAgICAgICAgICAgaWYgKCFvIHx8ICFvLmVsKSB7CiAgICAgICAgICAgICAgICAkLmVycm9yKCJFdmVudEJ1cyBpbml0aWFsaXplZCB3aXRob3V0IGVsIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy4kZWwgPSAkKG8uZWwpOwogICAgICAgIH0KICAgICAgICBfLm1peGluKEV2ZW50QnVzLnByb3RvdHlwZSwgewogICAgICAgICAgICB0cmlnZ2VyOiBmdW5jdGlvbih0eXBlKSB7CiAgICAgICAgICAgICAgICB2YXIgYXJncyA9IFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKICAgICAgICAgICAgICAgIHRoaXMuJGVsLnRyaWdnZXIobmFtZXNwYWNlICsgdHlwZSwgYXJncyk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICByZXR1cm4gRXZlbnRCdXM7CiAgICB9KCk7CiAgICB2YXIgRXZlbnRFbWl0dGVyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgCiAgICAgICAgdmFyIHNwbGl0dGVyID0gL1xzKy8sIG5leHRUaWNrID0gZ2V0TmV4dFRpY2soKTsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBvblN5bmM6IG9uU3luYywKICAgICAgICAgICAgb25Bc3luYzogb25Bc3luYywKICAgICAgICAgICAgb2ZmOiBvZmYsCiAgICAgICAgICAgIHRyaWdnZXI6IHRyaWdnZXIKICAgICAgICB9OwogICAgICAgIGZ1bmN0aW9uIG9uKG1ldGhvZCwgdHlwZXMsIGNiLCBjb250ZXh0KSB7CiAgICAgICAgICAgIHZhciB0eXBlOwogICAgICAgICAgICBpZiAoIWNiKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfQogICAgICAgICAgICB0eXBlcyA9IHR5cGVzLnNwbGl0KHNwbGl0dGVyKTsKICAgICAgICAgICAgY2IgPSBjb250ZXh0ID8gYmluZENvbnRleHQoY2IsIGNvbnRleHQpIDogY2I7CiAgICAgICAgICAgIHRoaXMuX2NhbGxiYWNrcyA9IHRoaXMuX2NhbGxiYWNrcyB8fCB7fTsKICAgICAgICAgICAgd2hpbGUgKHR5cGUgPSB0eXBlcy5zaGlmdCgpKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9jYWxsYmFja3NbdHlwZV0gPSB0aGlzLl9jYWxsYmFja3NbdHlwZV0gfHwgewogICAgICAgICAgICAgICAgICAgIHN5bmM6IFtdLAogICAgICAgICAgICAgICAgICAgIGFzeW5jOiBbXQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIHRoaXMuX2NhbGxiYWNrc1t0eXBlXVttZXRob2RdLnB1c2goY2IpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBvbkFzeW5jKHR5cGVzLCBjYiwgY29udGV4dCkgewogICAgICAgICAgICByZXR1cm4gb24uY2FsbCh0aGlzLCAiYXN5bmMiLCB0eXBlcywgY2IsIGNvbnRleHQpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBvblN5bmModHlwZXMsIGNiLCBjb250ZXh0KSB7CiAgICAgICAgICAgIHJldHVybiBvbi5jYWxsKHRoaXMsICJzeW5jIiwgdHlwZXMsIGNiLCBjb250ZXh0KTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gb2ZmKHR5cGVzKSB7CiAgICAgICAgICAgIHZhciB0eXBlOwogICAgICAgICAgICBpZiAoIXRoaXMuX2NhbGxiYWNrcykgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdHlwZXMgPSB0eXBlcy5zcGxpdChzcGxpdHRlcik7CiAgICAgICAgICAgIHdoaWxlICh0eXBlID0gdHlwZXMuc2hpZnQoKSkgewogICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuX2NhbGxiYWNrc1t0eXBlXTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gdHJpZ2dlcih0eXBlcykgewogICAgICAgICAgICB2YXIgdHlwZSwgY2FsbGJhY2tzLCBhcmdzLCBzeW5jRmx1c2gsIGFzeW5jRmx1c2g7CiAgICAgICAgICAgIGlmICghdGhpcy5fY2FsbGJhY2tzKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfQogICAgICAgICAgICB0eXBlcyA9IHR5cGVzLnNwbGl0KHNwbGl0dGVyKTsKICAgICAgICAgICAgYXJncyA9IFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKICAgICAgICAgICAgd2hpbGUgKCh0eXBlID0gdHlwZXMuc2hpZnQoKSkgJiYgKGNhbGxiYWNrcyA9IHRoaXMuX2NhbGxiYWNrc1t0eXBlXSkpIHsKICAgICAgICAgICAgICAgIHN5bmNGbHVzaCA9IGdldEZsdXNoKGNhbGxiYWNrcy5zeW5jLCB0aGlzLCBbIHR5cGUgXS5jb25jYXQoYXJncykpOwogICAgICAgICAgICAgICAgYXN5bmNGbHVzaCA9IGdldEZsdXNoKGNhbGxiYWNrcy5hc3luYywgdGhpcywgWyB0eXBlIF0uY29uY2F0KGFyZ3MpKTsKICAgICAgICAgICAgICAgIHN5bmNGbHVzaCgpICYmIG5leHRUaWNrKGFzeW5jRmx1c2gpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBnZXRGbHVzaChjYWxsYmFja3MsIGNvbnRleHQsIGFyZ3MpIHsKICAgICAgICAgICAgcmV0dXJuIGZsdXNoOwogICAgICAgICAgICBmdW5jdGlvbiBmbHVzaCgpIHsKICAgICAgICAgICAgICAgIHZhciBjYW5jZWxsZWQ7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gY2FsbGJhY2tzLmxlbmd0aDsgIWNhbmNlbGxlZCAmJiBpIDwgbGVuOyBpICs9IDEpIHsKICAgICAgICAgICAgICAgICAgICBjYW5jZWxsZWQgPSBjYWxsYmFja3NbaV0uYXBwbHkoY29udGV4dCwgYXJncykgPT09IGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuICFjYW5jZWxsZWQ7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gZ2V0TmV4dFRpY2soKSB7CiAgICAgICAgICAgIHZhciBuZXh0VGlja0ZuOwogICAgICAgICAgICBpZiAod2luZG93LnNldEltbWVkaWF0ZSkgewogICAgICAgICAgICAgICAgbmV4dFRpY2tGbiA9IGZ1bmN0aW9uIG5leHRUaWNrU2V0SW1tZWRpYXRlKGZuKSB7CiAgICAgICAgICAgICAgICAgICAgc2V0SW1tZWRpYXRlKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBmbigpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG5leHRUaWNrRm4gPSBmdW5jdGlvbiBuZXh0VGlja1NldFRpbWVvdXQoZm4pIHsKICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBmbigpOwogICAgICAgICAgICAgICAgICAgIH0sIDApOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbmV4dFRpY2tGbjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gYmluZENvbnRleHQoZm4sIGNvbnRleHQpIHsKICAgICAgICAgICAgcmV0dXJuIGZuLmJpbmQgPyBmbi5iaW5kKGNvbnRleHQpIDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBmbi5hcHBseShjb250ZXh0LCBbXS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMCkpOwogICAgICAgICAgICB9OwogICAgICAgIH0KICAgIH0oKTsKICAgIHZhciBoaWdobGlnaHQgPSBmdW5jdGlvbihkb2MpIHsKICAgICAgICAKICAgICAgICB2YXIgZGVmYXVsdHMgPSB7CiAgICAgICAgICAgIG5vZGU6IG51bGwsCiAgICAgICAgICAgIHBhdHRlcm46IG51bGwsCiAgICAgICAgICAgIHRhZ05hbWU6ICJzdHJvbmciLAogICAgICAgICAgICBjbGFzc05hbWU6IG51bGwsCiAgICAgICAgICAgIHdvcmRzT25seTogZmFsc2UsCiAgICAgICAgICAgIGNhc2VTZW5zaXRpdmU6IGZhbHNlCiAgICAgICAgfTsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gaGlnaHRsaWdodChvKSB7CiAgICAgICAgICAgIHZhciByZWdleDsKICAgICAgICAgICAgbyA9IF8ubWl4aW4oe30sIGRlZmF1bHRzLCBvKTsKICAgICAgICAgICAgaWYgKCFvLm5vZGUgfHwgIW8ucGF0dGVybikgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG8ucGF0dGVybiA9IF8uaXNBcnJheShvLnBhdHRlcm4pID8gby5wYXR0ZXJuIDogWyBvLnBhdHRlcm4gXTsKICAgICAgICAgICAgcmVnZXggPSBnZXRSZWdleChvLnBhdHRlcm4sIG8uY2FzZVNlbnNpdGl2ZSwgby53b3Jkc09ubHkpOwogICAgICAgICAgICB0cmF2ZXJzZShvLm5vZGUsIGhpZ2h0bGlnaHRUZXh0Tm9kZSk7CiAgICAgICAgICAgIGZ1bmN0aW9uIGhpZ2h0bGlnaHRUZXh0Tm9kZSh0ZXh0Tm9kZSkgewogICAgICAgICAgICAgICAgdmFyIG1hdGNoLCBwYXR0ZXJuTm9kZSwgd3JhcHBlck5vZGU7CiAgICAgICAgICAgICAgICBpZiAobWF0Y2ggPSByZWdleC5leGVjKHRleHROb2RlLmRhdGEpKSB7CiAgICAgICAgICAgICAgICAgICAgd3JhcHBlck5vZGUgPSBkb2MuY3JlYXRlRWxlbWVudChvLnRhZ05hbWUpOwogICAgICAgICAgICAgICAgICAgIG8uY2xhc3NOYW1lICYmICh3cmFwcGVyTm9kZS5jbGFzc05hbWUgPSBvLmNsYXNzTmFtZSk7CiAgICAgICAgICAgICAgICAgICAgcGF0dGVybk5vZGUgPSB0ZXh0Tm9kZS5zcGxpdFRleHQobWF0Y2guaW5kZXgpOwogICAgICAgICAgICAgICAgICAgIHBhdHRlcm5Ob2RlLnNwbGl0VGV4dChtYXRjaFswXS5sZW5ndGgpOwogICAgICAgICAgICAgICAgICAgIHdyYXBwZXJOb2RlLmFwcGVuZENoaWxkKHBhdHRlcm5Ob2RlLmNsb25lTm9kZSh0cnVlKSk7CiAgICAgICAgICAgICAgICAgICAgdGV4dE5vZGUucGFyZW50Tm9kZS5yZXBsYWNlQ2hpbGQod3JhcHBlck5vZGUsIHBhdHRlcm5Ob2RlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiAhIW1hdGNoOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHRyYXZlcnNlKGVsLCBoaWdodGxpZ2h0VGV4dE5vZGUpIHsKICAgICAgICAgICAgICAgIHZhciBjaGlsZE5vZGUsIFRFWFRfTk9ERV9UWVBFID0gMzsKICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZWwuY2hpbGROb2Rlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgIGNoaWxkTm9kZSA9IGVsLmNoaWxkTm9kZXNbaV07CiAgICAgICAgICAgICAgICAgICAgaWYgKGNoaWxkTm9kZS5ub2RlVHlwZSA9PT0gVEVYVF9OT0RFX1RZUEUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaSArPSBoaWdodGxpZ2h0VGV4dE5vZGUoY2hpbGROb2RlKSA/IDEgOiAwOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRyYXZlcnNlKGNoaWxkTm9kZSwgaGlnaHRsaWdodFRleHROb2RlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIGZ1bmN0aW9uIGdldFJlZ2V4KHBhdHRlcm5zLCBjYXNlU2Vuc2l0aXZlLCB3b3Jkc09ubHkpIHsKICAgICAgICAgICAgdmFyIGVzY2FwZWRQYXR0ZXJucyA9IFtdLCByZWdleFN0cjsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHBhdHRlcm5zLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAgICAgICBlc2NhcGVkUGF0dGVybnMucHVzaChfLmVzY2FwZVJlZ0V4Q2hhcnMocGF0dGVybnNbaV0pKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZWdleFN0ciA9IHdvcmRzT25seSA/ICJcXGIoIiArIGVzY2FwZWRQYXR0ZXJucy5qb2luKCJ8IikgKyAiKVxcYiIgOiAiKCIgKyBlc2NhcGVkUGF0dGVybnMuam9pbigifCIpICsgIikiOwogICAgICAgICAgICByZXR1cm4gY2FzZVNlbnNpdGl2ZSA/IG5ldyBSZWdFeHAocmVnZXhTdHIpIDogbmV3IFJlZ0V4cChyZWdleFN0ciwgImkiKTsKICAgICAgICB9CiAgICB9KHdpbmRvdy5kb2N1bWVudCk7CiAgICB2YXIgSW5wdXQgPSBmdW5jdGlvbigpIHsKICAgICAgICAKICAgICAgICB2YXIgc3BlY2lhbEtleUNvZGVNYXA7CiAgICAgICAgc3BlY2lhbEtleUNvZGVNYXAgPSB7CiAgICAgICAgICAgIDk6ICJ0YWIiLAogICAgICAgICAgICAyNzogImVzYyIsCiAgICAgICAgICAgIDM3OiAibGVmdCIsCiAgICAgICAgICAgIDM5OiAicmlnaHQiLAogICAgICAgICAgICAxMzogImVudGVyIiwKICAgICAgICAgICAgMzg6ICJ1cCIsCiAgICAgICAgICAgIDQwOiAiZG93biIKICAgICAgICB9OwogICAgICAgIGZ1bmN0aW9uIElucHV0KG8pIHsKICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBvbkJsdXIsIG9uRm9jdXMsIG9uS2V5ZG93biwgb25JbnB1dDsKICAgICAgICAgICAgbyA9IG8gfHwge307CiAgICAgICAgICAgIGlmICghby5pbnB1dCkgewogICAgICAgICAgICAgICAgJC5lcnJvcigiaW5wdXQgaXMgbWlzc2luZyIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG9uQmx1ciA9IF8uYmluZCh0aGlzLl9vbkJsdXIsIHRoaXMpOwogICAgICAgICAgICBvbkZvY3VzID0gXy5iaW5kKHRoaXMuX29uRm9jdXMsIHRoaXMpOwogICAgICAgICAgICBvbktleWRvd24gPSBfLmJpbmQodGhpcy5fb25LZXlkb3duLCB0aGlzKTsKICAgICAgICAgICAgb25JbnB1dCA9IF8uYmluZCh0aGlzLl9vbklucHV0LCB0aGlzKTsKICAgICAgICAgICAgdGhpcy4kaGludCA9ICQoby5oaW50KTsKICAgICAgICAgICAgdGhpcy4kaW5wdXQgPSAkKG8uaW5wdXQpLm9uKCJibHVyLnR0Iiwgb25CbHVyKS5vbigiZm9jdXMudHQiLCBvbkZvY3VzKS5vbigia2V5ZG93bi50dCIsIG9uS2V5ZG93bik7CiAgICAgICAgICAgIGlmICh0aGlzLiRoaW50Lmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgdGhpcy5zZXRIaW50ID0gdGhpcy5nZXRIaW50ID0gdGhpcy5jbGVhckhpbnQgPSB0aGlzLmNsZWFySGludElmSW52YWxpZCA9IF8ubm9vcDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIV8uaXNNc2llKCkpIHsKICAgICAgICAgICAgICAgIHRoaXMuJGlucHV0Lm9uKCJpbnB1dC50dCIsIG9uSW5wdXQpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy4kaW5wdXQub24oImtleWRvd24udHQga2V5cHJlc3MudHQgY3V0LnR0IHBhc3RlLnR0IiwgZnVuY3Rpb24oJGUpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoc3BlY2lhbEtleUNvZGVNYXBbJGUud2hpY2ggfHwgJGUua2V5Q29kZV0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBfLmRlZmVyKF8uYmluZCh0aGF0Ll9vbklucHV0LCB0aGF0LCAkZSkpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5xdWVyeSA9IHRoaXMuJGlucHV0LnZhbCgpOwogICAgICAgICAgICB0aGlzLiRvdmVyZmxvd0hlbHBlciA9IGJ1aWxkT3ZlcmZsb3dIZWxwZXIodGhpcy4kaW5wdXQpOwogICAgICAgIH0KICAgICAgICBJbnB1dC5ub3JtYWxpemVRdWVyeSA9IGZ1bmN0aW9uKHN0cikgewogICAgICAgICAgICByZXR1cm4gKHN0ciB8fCAiIikucmVwbGFjZSgvXlxzKi9nLCAiIikucmVwbGFjZSgvXHN7Mix9L2csICIgIik7CiAgICAgICAgfTsKICAgICAgICBfLm1peGluKElucHV0LnByb3RvdHlwZSwgRXZlbnRFbWl0dGVyLCB7CiAgICAgICAgICAgIF9vbkJsdXI6IGZ1bmN0aW9uIG9uQmx1cigpIHsKICAgICAgICAgICAgICAgIHRoaXMucmVzZXRJbnB1dFZhbHVlKCk7CiAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXIoImJsdXJyZWQiKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX29uRm9jdXM6IGZ1bmN0aW9uIG9uRm9jdXMoKSB7CiAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXIoImZvY3VzZWQiKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX29uS2V5ZG93bjogZnVuY3Rpb24gb25LZXlkb3duKCRlKSB7CiAgICAgICAgICAgICAgICB2YXIga2V5TmFtZSA9IHNwZWNpYWxLZXlDb2RlTWFwWyRlLndoaWNoIHx8ICRlLmtleUNvZGVdOwogICAgICAgICAgICAgICAgdGhpcy5fbWFuYWdlUHJldmVudERlZmF1bHQoa2V5TmFtZSwgJGUpOwogICAgICAgICAgICAgICAgaWYgKGtleU5hbWUgJiYgdGhpcy5fc2hvdWxkVHJpZ2dlcihrZXlOYW1lLCAkZSkpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXIoa2V5TmFtZSArICJLZXllZCIsICRlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgX29uSW5wdXQ6IGZ1bmN0aW9uIG9uSW5wdXQoKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9jaGVja0lucHV0VmFsdWUoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX21hbmFnZVByZXZlbnREZWZhdWx0OiBmdW5jdGlvbiBtYW5hZ2VQcmV2ZW50RGVmYXVsdChrZXlOYW1lLCAkZSkgewogICAgICAgICAgICAgICAgdmFyIHByZXZlbnREZWZhdWx0LCBoaW50VmFsdWUsIGlucHV0VmFsdWU7CiAgICAgICAgICAgICAgICBzd2l0Y2ggKGtleU5hbWUpIHsKICAgICAgICAgICAgICAgICAgY2FzZSAidGFiIjoKICAgICAgICAgICAgICAgICAgICBoaW50VmFsdWUgPSB0aGlzLmdldEhpbnQoKTsKICAgICAgICAgICAgICAgICAgICBpbnB1dFZhbHVlID0gdGhpcy5nZXRJbnB1dFZhbHVlKCk7CiAgICAgICAgICAgICAgICAgICAgcHJldmVudERlZmF1bHQgPSBoaW50VmFsdWUgJiYgaGludFZhbHVlICE9PSBpbnB1dFZhbHVlICYmICF3aXRoTW9kaWZpZXIoJGUpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgY2FzZSAidXAiOgogICAgICAgICAgICAgICAgICBjYXNlICJkb3duIjoKICAgICAgICAgICAgICAgICAgICBwcmV2ZW50RGVmYXVsdCA9ICF3aXRoTW9kaWZpZXIoJGUpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICBwcmV2ZW50RGVmYXVsdCA9IGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcHJldmVudERlZmF1bHQgJiYgJGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX3Nob3VsZFRyaWdnZXI6IGZ1bmN0aW9uIHNob3VsZFRyaWdnZXIoa2V5TmFtZSwgJGUpIHsKICAgICAgICAgICAgICAgIHZhciB0cmlnZ2VyOwogICAgICAgICAgICAgICAgc3dpdGNoIChrZXlOYW1lKSB7CiAgICAgICAgICAgICAgICAgIGNhc2UgInRhYiI6CiAgICAgICAgICAgICAgICAgICAgdHJpZ2dlciA9ICF3aXRoTW9kaWZpZXIoJGUpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICB0cmlnZ2VyID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB0cmlnZ2VyOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfY2hlY2tJbnB1dFZhbHVlOiBmdW5jdGlvbiBjaGVja0lucHV0VmFsdWUoKSB7CiAgICAgICAgICAgICAgICB2YXIgaW5wdXRWYWx1ZSwgYXJlRXF1aXZhbGVudCwgaGFzRGlmZmVyZW50V2hpdGVzcGFjZTsKICAgICAgICAgICAgICAgIGlucHV0VmFsdWUgPSB0aGlzLmdldElucHV0VmFsdWUoKTsKICAgICAgICAgICAgICAgIGFyZUVxdWl2YWxlbnQgPSBhcmVRdWVyaWVzRXF1aXZhbGVudChpbnB1dFZhbHVlLCB0aGlzLnF1ZXJ5KTsKICAgICAgICAgICAgICAgIGhhc0RpZmZlcmVudFdoaXRlc3BhY2UgPSBhcmVFcXVpdmFsZW50ID8gdGhpcy5xdWVyeS5sZW5ndGggIT09IGlucHV0VmFsdWUubGVuZ3RoIDogZmFsc2U7CiAgICAgICAgICAgICAgICB0aGlzLnF1ZXJ5ID0gaW5wdXRWYWx1ZTsKICAgICAgICAgICAgICAgIGlmICghYXJlRXF1aXZhbGVudCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMudHJpZ2dlcigicXVlcnlDaGFuZ2VkIiwgdGhpcy5xdWVyeSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGhhc0RpZmZlcmVudFdoaXRlc3BhY2UpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXIoIndoaXRlc3BhY2VDaGFuZ2VkIiwgdGhpcy5xdWVyeSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGZvY3VzOiBmdW5jdGlvbiBmb2N1cygpIHsKICAgICAgICAgICAgICAgIHRoaXMuJGlucHV0LmZvY3VzKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGJsdXI6IGZ1bmN0aW9uIGJsdXIoKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRpbnB1dC5ibHVyKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGdldFF1ZXJ5OiBmdW5jdGlvbiBnZXRRdWVyeSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnF1ZXJ5OwogICAgICAgICAgICB9LAogICAgICAgICAgICBzZXRRdWVyeTogZnVuY3Rpb24gc2V0UXVlcnkocXVlcnkpIHsKICAgICAgICAgICAgICAgIHRoaXMucXVlcnkgPSBxdWVyeTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZ2V0SW5wdXRWYWx1ZTogZnVuY3Rpb24gZ2V0SW5wdXRWYWx1ZSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiRpbnB1dC52YWwoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2V0SW5wdXRWYWx1ZTogZnVuY3Rpb24gc2V0SW5wdXRWYWx1ZSh2YWx1ZSwgc2lsZW50KSB7CiAgICAgICAgICAgICAgICB0aGlzLiRpbnB1dC52YWwodmFsdWUpOwogICAgICAgICAgICAgICAgc2lsZW50ID8gdGhpcy5jbGVhckhpbnQoKSA6IHRoaXMuX2NoZWNrSW5wdXRWYWx1ZSgpOwogICAgICAgICAgICB9LAogICAgICAgICAgICByZXNldElucHV0VmFsdWU6IGZ1bmN0aW9uIHJlc2V0SW5wdXRWYWx1ZSgpIHsKICAgICAgICAgICAgICAgIHRoaXMuc2V0SW5wdXRWYWx1ZSh0aGlzLnF1ZXJ5LCB0cnVlKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZ2V0SGludDogZnVuY3Rpb24gZ2V0SGludCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiRoaW50LnZhbCgpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBzZXRIaW50OiBmdW5jdGlvbiBzZXRIaW50KHZhbHVlKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRoaW50LnZhbCh2YWx1ZSk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNsZWFySGludDogZnVuY3Rpb24gY2xlYXJIaW50KCkgewogICAgICAgICAgICAgICAgdGhpcy5zZXRIaW50KCIiKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgY2xlYXJIaW50SWZJbnZhbGlkOiBmdW5jdGlvbiBjbGVhckhpbnRJZkludmFsaWQoKSB7CiAgICAgICAgICAgICAgICB2YXIgdmFsLCBoaW50LCB2YWxJc1ByZWZpeE9mSGludCwgaXNWYWxpZDsKICAgICAgICAgICAgICAgIHZhbCA9IHRoaXMuZ2V0SW5wdXRWYWx1ZSgpOwogICAgICAgICAgICAgICAgaGludCA9IHRoaXMuZ2V0SGludCgpOwogICAgICAgICAgICAgICAgdmFsSXNQcmVmaXhPZkhpbnQgPSB2YWwgIT09IGhpbnQgJiYgaGludC5pbmRleE9mKHZhbCkgPT09IDA7CiAgICAgICAgICAgICAgICBpc1ZhbGlkID0gdmFsICE9PSAiIiAmJiB2YWxJc1ByZWZpeE9mSGludCAmJiAhdGhpcy5oYXNPdmVyZmxvdygpOwogICAgICAgICAgICAgICAgIWlzVmFsaWQgJiYgdGhpcy5jbGVhckhpbnQoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZ2V0TGFuZ3VhZ2VEaXJlY3Rpb246IGZ1bmN0aW9uIGdldExhbmd1YWdlRGlyZWN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuICh0aGlzLiRpbnB1dC5jc3MoImRpcmVjdGlvbiIpIHx8ICJsdHIiKS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBoYXNPdmVyZmxvdzogZnVuY3Rpb24gaGFzT3ZlcmZsb3coKSB7CiAgICAgICAgICAgICAgICB2YXIgY29uc3RyYWludCA9IHRoaXMuJGlucHV0LndpZHRoKCkgLSAyOwogICAgICAgICAgICAgICAgdGhpcy4kb3ZlcmZsb3dIZWxwZXIudGV4dCh0aGlzLmdldElucHV0VmFsdWUoKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kb3ZlcmZsb3dIZWxwZXIud2lkdGgoKSA+PSBjb25zdHJhaW50OwogICAgICAgICAgICB9LAogICAgICAgICAgICBpc0N1cnNvckF0RW5kOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHZhciB2YWx1ZUxlbmd0aCwgc2VsZWN0aW9uU3RhcnQsIHJhbmdlOwogICAgICAgICAgICAgICAgdmFsdWVMZW5ndGggPSB0aGlzLiRpbnB1dC52YWwoKS5sZW5ndGg7CiAgICAgICAgICAgICAgICBzZWxlY3Rpb25TdGFydCA9IHRoaXMuJGlucHV0WzBdLnNlbGVjdGlvblN0YXJ0OwogICAgICAgICAgICAgICAgaWYgKF8uaXNOdW1iZXIoc2VsZWN0aW9uU3RhcnQpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGVjdGlvblN0YXJ0ID09PSB2YWx1ZUxlbmd0aDsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZG9jdW1lbnQuc2VsZWN0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgcmFuZ2UgPSBkb2N1bWVudC5zZWxlY3Rpb24uY3JlYXRlUmFuZ2UoKTsKICAgICAgICAgICAgICAgICAgICByYW5nZS5tb3ZlU3RhcnQoImNoYXJhY3RlciIsIC12YWx1ZUxlbmd0aCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlTGVuZ3RoID09PSByYW5nZS50ZXh0Lmxlbmd0aDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9LAogICAgICAgICAgICBkZXN0cm95OiBmdW5jdGlvbiBkZXN0cm95KCkgewogICAgICAgICAgICAgICAgdGhpcy4kaGludC5vZmYoIi50dCIpOwogICAgICAgICAgICAgICAgdGhpcy4kaW5wdXQub2ZmKCIudHQiKTsKICAgICAgICAgICAgICAgIHRoaXMuJGhpbnQgPSB0aGlzLiRpbnB1dCA9IHRoaXMuJG92ZXJmbG93SGVscGVyID0gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHJldHVybiBJbnB1dDsKICAgICAgICBmdW5jdGlvbiBidWlsZE92ZXJmbG93SGVscGVyKCRpbnB1dCkgewogICAgICAgICAgICByZXR1cm4gJCgnPHByZSBhcmlhLWhpZGRlbj0idHJ1ZSI+PC9wcmU+JykuY3NzKHsKICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAiYWJzb2x1dGUiLAogICAgICAgICAgICAgICAgdmlzaWJpbGl0eTogImhpZGRlbiIsCiAgICAgICAgICAgICAgICB3aGl0ZVNwYWNlOiAicHJlIiwKICAgICAgICAgICAgICAgIGZvbnRGYW1pbHk6ICRpbnB1dC5jc3MoImZvbnQtZmFtaWx5IiksCiAgICAgICAgICAgICAgICBmb250U2l6ZTogJGlucHV0LmNzcygiZm9udC1zaXplIiksCiAgICAgICAgICAgICAgICBmb250U3R5bGU6ICRpbnB1dC5jc3MoImZvbnQtc3R5bGUiKSwKICAgICAgICAgICAgICAgIGZvbnRWYXJpYW50OiAkaW5wdXQuY3NzKCJmb250LXZhcmlhbnQiKSwKICAgICAgICAgICAgICAgIGZvbnRXZWlnaHQ6ICRpbnB1dC5jc3MoImZvbnQtd2VpZ2h0IiksCiAgICAgICAgICAgICAgICB3b3JkU3BhY2luZzogJGlucHV0LmNzcygid29yZC1zcGFjaW5nIiksCiAgICAgICAgICAgICAgICBsZXR0ZXJTcGFjaW5nOiAkaW5wdXQuY3NzKCJsZXR0ZXItc3BhY2luZyIpLAogICAgICAgICAgICAgICAgdGV4dEluZGVudDogJGlucHV0LmNzcygidGV4dC1pbmRlbnQiKSwKICAgICAgICAgICAgICAgIHRleHRSZW5kZXJpbmc6ICRpbnB1dC5jc3MoInRleHQtcmVuZGVyaW5nIiksCiAgICAgICAgICAgICAgICB0ZXh0VHJhbnNmb3JtOiAkaW5wdXQuY3NzKCJ0ZXh0LXRyYW5zZm9ybSIpCiAgICAgICAgICAgIH0pLmluc2VydEFmdGVyKCRpbnB1dCk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGFyZVF1ZXJpZXNFcXVpdmFsZW50KGEsIGIpIHsKICAgICAgICAgICAgcmV0dXJuIElucHV0Lm5vcm1hbGl6ZVF1ZXJ5KGEpID09PSBJbnB1dC5ub3JtYWxpemVRdWVyeShiKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gd2l0aE1vZGlmaWVyKCRlKSB7CiAgICAgICAgICAgIHJldHVybiAkZS5hbHRLZXkgfHwgJGUuY3RybEtleSB8fCAkZS5tZXRhS2V5IHx8ICRlLnNoaWZ0S2V5OwogICAgICAgIH0KICAgIH0oKTsKICAgIHZhciBEYXRhc2V0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgCiAgICAgICAgdmFyIGRhdGFzZXRLZXkgPSAidHREYXRhc2V0IiwgdmFsdWVLZXkgPSAidHRWYWx1ZSIsIGRhdHVtS2V5ID0gInR0RGF0dW0iOwogICAgICAgIGZ1bmN0aW9uIERhdGFzZXQobykgewogICAgICAgICAgICBvID0gbyB8fCB7fTsKICAgICAgICAgICAgby50ZW1wbGF0ZXMgPSBvLnRlbXBsYXRlcyB8fCB7fTsKICAgICAgICAgICAgaWYgKCFvLnNvdXJjZSkgewogICAgICAgICAgICAgICAgJC5lcnJvcigibWlzc2luZyBzb3VyY2UiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoby5uYW1lICYmICFpc1ZhbGlkTmFtZShvLm5hbWUpKSB7CiAgICAgICAgICAgICAgICAkLmVycm9yKCJpbnZhbGlkIGRhdGFzZXQgbmFtZTogIiArIG8ubmFtZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5xdWVyeSA9IG51bGw7CiAgICAgICAgICAgIHRoaXMuaGlnaGxpZ2h0ID0gISFvLmhpZ2hsaWdodDsKICAgICAgICAgICAgdGhpcy5uYW1lID0gby5uYW1lIHx8IF8uZ2V0VW5pcXVlSWQoKTsKICAgICAgICAgICAgdGhpcy5zb3VyY2UgPSBvLnNvdXJjZTsKICAgICAgICAgICAgdGhpcy5kaXNwbGF5Rm4gPSBnZXREaXNwbGF5Rm4oby5kaXNwbGF5IHx8IG8uZGlzcGxheUtleSk7CiAgICAgICAgICAgIHRoaXMudGVtcGxhdGVzID0gZ2V0VGVtcGxhdGVzKG8udGVtcGxhdGVzLCB0aGlzLmRpc3BsYXlGbik7CiAgICAgICAgICAgIHRoaXMuJGVsID0gJChodG1sLmRhdGFzZXQucmVwbGFjZSgiJUNMQVNTJSIsIHRoaXMubmFtZSkpOwogICAgICAgIH0KICAgICAgICBEYXRhc2V0LmV4dHJhY3REYXRhc2V0TmFtZSA9IGZ1bmN0aW9uIGV4dHJhY3REYXRhc2V0TmFtZShlbCkgewogICAgICAgICAgICByZXR1cm4gJChlbCkuZGF0YShkYXRhc2V0S2V5KTsKICAgICAgICB9OwogICAgICAgIERhdGFzZXQuZXh0cmFjdFZhbHVlID0gZnVuY3Rpb24gZXh0cmFjdERhdHVtKGVsKSB7CiAgICAgICAgICAgIHJldHVybiAkKGVsKS5kYXRhKHZhbHVlS2V5KTsKICAgICAgICB9OwogICAgICAgIERhdGFzZXQuZXh0cmFjdERhdHVtID0gZnVuY3Rpb24gZXh0cmFjdERhdHVtKGVsKSB7CiAgICAgICAgICAgIHJldHVybiAkKGVsKS5kYXRhKGRhdHVtS2V5KTsKICAgICAgICB9OwogICAgICAgIF8ubWl4aW4oRGF0YXNldC5wcm90b3R5cGUsIEV2ZW50RW1pdHRlciwgewogICAgICAgICAgICBfcmVuZGVyOiBmdW5jdGlvbiByZW5kZXIocXVlcnksIHN1Z2dlc3Rpb25zKSB7CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuJGVsKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLCBoYXNTdWdnZXN0aW9uczsKICAgICAgICAgICAgICAgIHRoaXMuJGVsLmVtcHR5KCk7CiAgICAgICAgICAgICAgICBoYXNTdWdnZXN0aW9ucyA9IHN1Z2dlc3Rpb25zICYmIHN1Z2dlc3Rpb25zLmxlbmd0aDsKICAgICAgICAgICAgICAgIGlmICghaGFzU3VnZ2VzdGlvbnMgJiYgdGhpcy50ZW1wbGF0ZXMuZW1wdHkpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbC5odG1sKGdldEVtcHR5SHRtbCgpKS5wcmVwZW5kKHRoYXQudGVtcGxhdGVzLmhlYWRlciA/IGdldEhlYWRlckh0bWwoKSA6IG51bGwpLmFwcGVuZCh0aGF0LnRlbXBsYXRlcy5mb290ZXIgPyBnZXRGb290ZXJIdG1sKCkgOiBudWxsKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaGFzU3VnZ2VzdGlvbnMpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbC5odG1sKGdldFN1Z2dlc3Rpb25zSHRtbCgpKS5wcmVwZW5kKHRoYXQudGVtcGxhdGVzLmhlYWRlciA/IGdldEhlYWRlckh0bWwoKSA6IG51bGwpLmFwcGVuZCh0aGF0LnRlbXBsYXRlcy5mb290ZXIgPyBnZXRGb290ZXJIdG1sKCkgOiBudWxsKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMudHJpZ2dlcigicmVuZGVyZWQiKTsKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGdldEVtcHR5SHRtbCgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhhdC50ZW1wbGF0ZXMuZW1wdHkoewogICAgICAgICAgICAgICAgICAgICAgICBxdWVyeTogcXVlcnksCiAgICAgICAgICAgICAgICAgICAgICAgIGlzRW1wdHk6IHRydWUKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGdldFN1Z2dlc3Rpb25zSHRtbCgpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgJHN1Z2dlc3Rpb25zLCBub2RlczsKICAgICAgICAgICAgICAgICAgICAkc3VnZ2VzdGlvbnMgPSAkKGh0bWwuc3VnZ2VzdGlvbnMpLmNzcyhjc3Muc3VnZ2VzdGlvbnMpOwogICAgICAgICAgICAgICAgICAgIG5vZGVzID0gXy5tYXAoc3VnZ2VzdGlvbnMsIGdldFN1Z2dlc3Rpb25Ob2RlKTsKICAgICAgICAgICAgICAgICAgICAkc3VnZ2VzdGlvbnMuYXBwZW5kLmFwcGx5KCRzdWdnZXN0aW9ucywgbm9kZXMpOwogICAgICAgICAgICAgICAgICAgIHRoYXQuaGlnaGxpZ2h0ICYmIGhpZ2hsaWdodCh7CiAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogInR0LWhpZ2hsaWdodCIsCiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGU6ICRzdWdnZXN0aW9uc1swXSwKICAgICAgICAgICAgICAgICAgICAgICAgcGF0dGVybjogcXVlcnkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHN1Z2dlc3Rpb25zOwogICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGdldFN1Z2dlc3Rpb25Ob2RlKHN1Z2dlc3Rpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyICRlbDsKICAgICAgICAgICAgICAgICAgICAgICAgJGVsID0gJChodG1sLnN1Z2dlc3Rpb24pLmFwcGVuZCh0aGF0LnRlbXBsYXRlcy5zdWdnZXN0aW9uKHN1Z2dlc3Rpb24pKS5kYXRhKGRhdGFzZXRLZXksIHRoYXQubmFtZSkuZGF0YSh2YWx1ZUtleSwgdGhhdC5kaXNwbGF5Rm4oc3VnZ2VzdGlvbikpLmRhdGEoZGF0dW1LZXksIHN1Z2dlc3Rpb24pOwogICAgICAgICAgICAgICAgICAgICAgICAkZWwuY2hpbGRyZW4oKS5lYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5jc3MoY3NzLnN1Z2dlc3Rpb25DaGlsZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGVsOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGdldEhlYWRlckh0bWwoKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoYXQudGVtcGxhdGVzLmhlYWRlcih7CiAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXJ5OiBxdWVyeSwKICAgICAgICAgICAgICAgICAgICAgICAgaXNFbXB0eTogIWhhc1N1Z2dlc3Rpb25zCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBmdW5jdGlvbiBnZXRGb290ZXJIdG1sKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGF0LnRlbXBsYXRlcy5mb290ZXIoewogICAgICAgICAgICAgICAgICAgICAgICBxdWVyeTogcXVlcnksCiAgICAgICAgICAgICAgICAgICAgICAgIGlzRW1wdHk6ICFoYXNTdWdnZXN0aW9ucwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBnZXRSb290OiBmdW5jdGlvbiBnZXRSb290KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJGVsOwogICAgICAgICAgICB9LAogICAgICAgICAgICB1cGRhdGU6IGZ1bmN0aW9uIHVwZGF0ZShxdWVyeSkgewogICAgICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzOwogICAgICAgICAgICAgICAgdGhpcy5xdWVyeSA9IHF1ZXJ5OwogICAgICAgICAgICAgICAgdGhpcy5jYW5jZWxlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgdGhpcy5zb3VyY2UocXVlcnksIHJlbmRlcik7CiAgICAgICAgICAgICAgICBmdW5jdGlvbiByZW5kZXIoc3VnZ2VzdGlvbnMpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIXRoYXQuY2FuY2VsZWQgJiYgcXVlcnkgPT09IHRoYXQucXVlcnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhhdC5fcmVuZGVyKHF1ZXJ5LCBzdWdnZXN0aW9ucyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBjYW5jZWw6IGZ1bmN0aW9uIGNhbmNlbCgpIHsKICAgICAgICAgICAgICAgIHRoaXMuY2FuY2VsZWQgPSB0cnVlOwogICAgICAgICAgICB9LAogICAgICAgICAgICBjbGVhcjogZnVuY3Rpb24gY2xlYXIoKSB7CiAgICAgICAgICAgICAgICB0aGlzLmNhbmNlbCgpOwogICAgICAgICAgICAgICAgdGhpcy4kZWwuZW1wdHkoKTsKICAgICAgICAgICAgICAgIHRoaXMudHJpZ2dlcigicmVuZGVyZWQiKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgaXNFbXB0eTogZnVuY3Rpb24gaXNFbXB0eSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiRlbC5pcygiOmVtcHR5Iik7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uIGRlc3Ryb3koKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRlbCA9IG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICByZXR1cm4gRGF0YXNldDsKICAgICAgICBmdW5jdGlvbiBnZXREaXNwbGF5Rm4oZGlzcGxheSkgewogICAgICAgICAgICBkaXNwbGF5ID0gZGlzcGxheSB8fCAidmFsdWUiOwogICAgICAgICAgICByZXR1cm4gXy5pc0Z1bmN0aW9uKGRpc3BsYXkpID8gZGlzcGxheSA6IGRpc3BsYXlGbjsKICAgICAgICAgICAgZnVuY3Rpb24gZGlzcGxheUZuKG9iaikgewogICAgICAgICAgICAgICAgcmV0dXJuIG9ialtkaXNwbGF5XTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBnZXRUZW1wbGF0ZXModGVtcGxhdGVzLCBkaXNwbGF5Rm4pIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIGVtcHR5OiB0ZW1wbGF0ZXMuZW1wdHkgJiYgXy50ZW1wbGF0aWZ5KHRlbXBsYXRlcy5lbXB0eSksCiAgICAgICAgICAgICAgICBoZWFkZXI6IHRlbXBsYXRlcy5oZWFkZXIgJiYgXy50ZW1wbGF0aWZ5KHRlbXBsYXRlcy5oZWFkZXIpLAogICAgICAgICAgICAgICAgZm9vdGVyOiB0ZW1wbGF0ZXMuZm9vdGVyICYmIF8udGVtcGxhdGlmeSh0ZW1wbGF0ZXMuZm9vdGVyKSwKICAgICAgICAgICAgICAgIHN1Z2dlc3Rpb246IHRlbXBsYXRlcy5zdWdnZXN0aW9uIHx8IHN1Z2dlc3Rpb25UZW1wbGF0ZQogICAgICAgICAgICB9OwogICAgICAgICAgICBmdW5jdGlvbiBzdWdnZXN0aW9uVGVtcGxhdGUoY29udGV4dCkgewogICAgICAgICAgICAgICAgcmV0dXJuICI8cD4iICsgZGlzcGxheUZuKGNvbnRleHQpICsgIjwvcD4iOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGlzVmFsaWROYW1lKHN0cikgewogICAgICAgICAgICByZXR1cm4gL15bX2EtekEtWjAtOS1dKyQvLnRlc3Qoc3RyKTsKICAgICAgICB9CiAgICB9KCk7CiAgICB2YXIgRHJvcGRvd24gPSBmdW5jdGlvbigpIHsKICAgICAgICAKICAgICAgICBmdW5jdGlvbiBEcm9wZG93bihvKSB7CiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgb25TdWdnZXN0aW9uQ2xpY2ssIG9uU3VnZ2VzdGlvbk1vdXNlRW50ZXIsIG9uU3VnZ2VzdGlvbk1vdXNlTGVhdmU7CiAgICAgICAgICAgIG8gPSBvIHx8IHt9OwogICAgICAgICAgICBpZiAoIW8ubWVudSkgewogICAgICAgICAgICAgICAgJC5lcnJvcigibWVudSBpcyByZXF1aXJlZCIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuaXNPcGVuID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuaXNFbXB0eSA9IHRydWU7CiAgICAgICAgICAgIHRoaXMuZGF0YXNldHMgPSBfLm1hcChvLmRhdGFzZXRzLCBpbml0aWFsaXplRGF0YXNldCk7CiAgICAgICAgICAgIG9uU3VnZ2VzdGlvbkNsaWNrID0gXy5iaW5kKHRoaXMuX29uU3VnZ2VzdGlvbkNsaWNrLCB0aGlzKTsKICAgICAgICAgICAgb25TdWdnZXN0aW9uTW91c2VFbnRlciA9IF8uYmluZCh0aGlzLl9vblN1Z2dlc3Rpb25Nb3VzZUVudGVyLCB0aGlzKTsKICAgICAgICAgICAgb25TdWdnZXN0aW9uTW91c2VMZWF2ZSA9IF8uYmluZCh0aGlzLl9vblN1Z2dlc3Rpb25Nb3VzZUxlYXZlLCB0aGlzKTsKICAgICAgICAgICAgdGhpcy4kbWVudSA9ICQoby5tZW51KS5vbigiY2xpY2sudHQiLCAiLnR0LXN1Z2dlc3Rpb24iLCBvblN1Z2dlc3Rpb25DbGljaykub24oIm1vdXNlZW50ZXIudHQiLCAiLnR0LXN1Z2dlc3Rpb24iLCBvblN1Z2dlc3Rpb25Nb3VzZUVudGVyKS5vbigibW91c2VsZWF2ZS50dCIsICIudHQtc3VnZ2VzdGlvbiIsIG9uU3VnZ2VzdGlvbk1vdXNlTGVhdmUpOwogICAgICAgICAgICBfLmVhY2godGhpcy5kYXRhc2V0cywgZnVuY3Rpb24oZGF0YXNldCkgewogICAgICAgICAgICAgICAgdGhhdC4kbWVudS5hcHBlbmQoZGF0YXNldC5nZXRSb290KCkpOwogICAgICAgICAgICAgICAgZGF0YXNldC5vblN5bmMoInJlbmRlcmVkIiwgdGhhdC5fb25SZW5kZXJlZCwgdGhhdCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBfLm1peGluKERyb3Bkb3duLnByb3RvdHlwZSwgRXZlbnRFbWl0dGVyLCB7CiAgICAgICAgICAgIF9vblN1Z2dlc3Rpb25DbGljazogZnVuY3Rpb24gb25TdWdnZXN0aW9uQ2xpY2soJGUpIHsKICAgICAgICAgICAgICAgIHRoaXMudHJpZ2dlcigic3VnZ2VzdGlvbkNsaWNrZWQiLCAkKCRlLmN1cnJlbnRUYXJnZXQpKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX29uU3VnZ2VzdGlvbk1vdXNlRW50ZXI6IGZ1bmN0aW9uIG9uU3VnZ2VzdGlvbk1vdXNlRW50ZXIoJGUpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3JlbW92ZUN1cnNvcigpOwogICAgICAgICAgICAgICAgdGhpcy5fc2V0Q3Vyc29yKCQoJGUuY3VycmVudFRhcmdldCksIHRydWUpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfb25TdWdnZXN0aW9uTW91c2VMZWF2ZTogZnVuY3Rpb24gb25TdWdnZXN0aW9uTW91c2VMZWF2ZSgpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3JlbW92ZUN1cnNvcigpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfb25SZW5kZXJlZDogZnVuY3Rpb24gb25SZW5kZXJlZCgpIHsKICAgICAgICAgICAgICAgIHRoaXMuaXNFbXB0eSA9IF8uZXZlcnkodGhpcy5kYXRhc2V0cywgaXNEYXRhc2V0RW1wdHkpOwogICAgICAgICAgICAgICAgdGhpcy5pc0VtcHR5ID8gdGhpcy5faGlkZSgpIDogdGhpcy5pc09wZW4gJiYgdGhpcy5fc2hvdygpOwogICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCJkYXRhc2V0UmVuZGVyZWQiKTsKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGlzRGF0YXNldEVtcHR5KGRhdGFzZXQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YXNldC5pc0VtcHR5KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9oaWRlOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHRoaXMuJG1lbnUuaGlkZSgpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfc2hvdzogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRtZW51LmNzcygiZGlzcGxheSIsICJibG9jayIpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfZ2V0U3VnZ2VzdGlvbnM6IGZ1bmN0aW9uIGdldFN1Z2dlc3Rpb25zKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJG1lbnUuZmluZCgiLnR0LXN1Z2dlc3Rpb24iKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX2dldEN1cnNvcjogZnVuY3Rpb24gZ2V0Q3Vyc29yKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJG1lbnUuZmluZCgiLnR0LWN1cnNvciIpLmZpcnN0KCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9zZXRDdXJzb3I6IGZ1bmN0aW9uIHNldEN1cnNvcigkZWwsIHNpbGVudCkgewogICAgICAgICAgICAgICAgJGVsLmZpcnN0KCkuYWRkQ2xhc3MoInR0LWN1cnNvciIpOwogICAgICAgICAgICAgICAgIXNpbGVudCAmJiB0aGlzLnRyaWdnZXIoImN1cnNvck1vdmVkIik7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9yZW1vdmVDdXJzb3I6IGZ1bmN0aW9uIHJlbW92ZUN1cnNvcigpIHsKICAgICAgICAgICAgICAgIHRoaXMuX2dldEN1cnNvcigpLnJlbW92ZUNsYXNzKCJ0dC1jdXJzb3IiKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX21vdmVDdXJzb3I6IGZ1bmN0aW9uIG1vdmVDdXJzb3IoaW5jcmVtZW50KSB7CiAgICAgICAgICAgICAgICB2YXIgJHN1Z2dlc3Rpb25zLCAkb2xkQ3Vyc29yLCBuZXdDdXJzb3JJbmRleCwgJG5ld0N1cnNvcjsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5pc09wZW4pIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkb2xkQ3Vyc29yID0gdGhpcy5fZ2V0Q3Vyc29yKCk7CiAgICAgICAgICAgICAgICAkc3VnZ2VzdGlvbnMgPSB0aGlzLl9nZXRTdWdnZXN0aW9ucygpOwogICAgICAgICAgICAgICAgdGhpcy5fcmVtb3ZlQ3Vyc29yKCk7CiAgICAgICAgICAgICAgICBuZXdDdXJzb3JJbmRleCA9ICRzdWdnZXN0aW9ucy5pbmRleCgkb2xkQ3Vyc29yKSArIGluY3JlbWVudDsKICAgICAgICAgICAgICAgIG5ld0N1cnNvckluZGV4ID0gKG5ld0N1cnNvckluZGV4ICsgMSkgJSAoJHN1Z2dlc3Rpb25zLmxlbmd0aCArIDEpIC0gMTsKICAgICAgICAgICAgICAgIGlmIChuZXdDdXJzb3JJbmRleCA9PT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXIoImN1cnNvclJlbW92ZWQiKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG5ld0N1cnNvckluZGV4IDwgLTEpIHsKICAgICAgICAgICAgICAgICAgICBuZXdDdXJzb3JJbmRleCA9ICRzdWdnZXN0aW9ucy5sZW5ndGggLSAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5fc2V0Q3Vyc29yKCRuZXdDdXJzb3IgPSAkc3VnZ2VzdGlvbnMuZXEobmV3Q3Vyc29ySW5kZXgpKTsKICAgICAgICAgICAgICAgIHRoaXMuX2Vuc3VyZVZpc2libGUoJG5ld0N1cnNvcik7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9lbnN1cmVWaXNpYmxlOiBmdW5jdGlvbiBlbnN1cmVWaXNpYmxlKCRlbCkgewogICAgICAgICAgICAgICAgdmFyIGVsVG9wLCBlbEJvdHRvbSwgbWVudVNjcm9sbFRvcCwgbWVudUhlaWdodDsKICAgICAgICAgICAgICAgIGVsVG9wID0gJGVsLnBvc2l0aW9uKCkudG9wOwogICAgICAgICAgICAgICAgZWxCb3R0b20gPSBlbFRvcCArICRlbC5vdXRlckhlaWdodCh0cnVlKTsKICAgICAgICAgICAgICAgIG1lbnVTY3JvbGxUb3AgPSB0aGlzLiRtZW51LnNjcm9sbFRvcCgpOwogICAgICAgICAgICAgICAgbWVudUhlaWdodCA9IHRoaXMuJG1lbnUuaGVpZ2h0KCkgKyBwYXJzZUludCh0aGlzLiRtZW51LmNzcygicGFkZGluZ1RvcCIpLCAxMCkgKyBwYXJzZUludCh0aGlzLiRtZW51LmNzcygicGFkZGluZ0JvdHRvbSIpLCAxMCk7CiAgICAgICAgICAgICAgICBpZiAoZWxUb3AgPCAwKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kbWVudS5zY3JvbGxUb3AobWVudVNjcm9sbFRvcCArIGVsVG9wKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobWVudUhlaWdodCA8IGVsQm90dG9tKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kbWVudS5zY3JvbGxUb3AobWVudVNjcm9sbFRvcCArIChlbEJvdHRvbSAtIG1lbnVIZWlnaHQpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgY2xvc2U6IGZ1bmN0aW9uIGNsb3NlKCkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNPcGVuKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5pc09wZW4gPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZW1vdmVDdXJzb3IoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9oaWRlKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCJjbG9zZWQiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgb3BlbjogZnVuY3Rpb24gb3BlbigpIHsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5pc09wZW4pIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmlzT3BlbiA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgIXRoaXMuaXNFbXB0eSAmJiB0aGlzLl9zaG93KCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCJvcGVuZWQiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgc2V0TGFuZ3VhZ2VEaXJlY3Rpb246IGZ1bmN0aW9uIHNldExhbmd1YWdlRGlyZWN0aW9uKGRpcikgewogICAgICAgICAgICAgICAgdGhpcy4kbWVudS5jc3MoZGlyID09PSAibHRyIiA/IGNzcy5sdHIgOiBjc3MucnRsKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgbW92ZUN1cnNvclVwOiBmdW5jdGlvbiBtb3ZlQ3Vyc29yVXAoKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9tb3ZlQ3Vyc29yKC0xKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgbW92ZUN1cnNvckRvd246IGZ1bmN0aW9uIG1vdmVDdXJzb3JEb3duKCkgewogICAgICAgICAgICAgICAgdGhpcy5fbW92ZUN1cnNvcigrMSk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGdldERhdHVtRm9yU3VnZ2VzdGlvbjogZnVuY3Rpb24gZ2V0RGF0dW1Gb3JTdWdnZXN0aW9uKCRlbCkgewogICAgICAgICAgICAgICAgdmFyIGRhdHVtID0gbnVsbDsKICAgICAgICAgICAgICAgIGlmICgkZWwubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgZGF0dW0gPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJhdzogRGF0YXNldC5leHRyYWN0RGF0dW0oJGVsKSwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IERhdGFzZXQuZXh0cmFjdFZhbHVlKCRlbCksCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFzZXROYW1lOiBEYXRhc2V0LmV4dHJhY3REYXRhc2V0TmFtZSgkZWwpCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBkYXR1bTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZ2V0RGF0dW1Gb3JDdXJzb3I6IGZ1bmN0aW9uIGdldERhdHVtRm9yQ3Vyc29yKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0RGF0dW1Gb3JTdWdnZXN0aW9uKHRoaXMuX2dldEN1cnNvcigpLmZpcnN0KCkpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBnZXREYXR1bUZvclRvcFN1Z2dlc3Rpb246IGZ1bmN0aW9uIGdldERhdHVtRm9yVG9wU3VnZ2VzdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldERhdHVtRm9yU3VnZ2VzdGlvbih0aGlzLl9nZXRTdWdnZXN0aW9ucygpLmZpcnN0KCkpOwogICAgICAgICAgICB9LAogICAgICAgICAgICB1cGRhdGU6IGZ1bmN0aW9uIHVwZGF0ZShxdWVyeSkgewogICAgICAgICAgICAgICAgXy5lYWNoKHRoaXMuZGF0YXNldHMsIHVwZGF0ZURhdGFzZXQpOwogICAgICAgICAgICAgICAgZnVuY3Rpb24gdXBkYXRlRGF0YXNldChkYXRhc2V0KSB7CiAgICAgICAgICAgICAgICAgICAgZGF0YXNldC51cGRhdGUocXVlcnkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBlbXB0eTogZnVuY3Rpb24gZW1wdHkoKSB7CiAgICAgICAgICAgICAgICBfLmVhY2godGhpcy5kYXRhc2V0cywgY2xlYXJEYXRhc2V0KTsKICAgICAgICAgICAgICAgIHRoaXMuaXNFbXB0eSA9IHRydWU7CiAgICAgICAgICAgICAgICBmdW5jdGlvbiBjbGVhckRhdGFzZXQoZGF0YXNldCkgewogICAgICAgICAgICAgICAgICAgIGRhdGFzZXQuY2xlYXIoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgaXNWaXNpYmxlOiBmdW5jdGlvbiBpc1Zpc2libGUoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5pc09wZW4gJiYgIXRoaXMuaXNFbXB0eTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZGVzdHJveTogZnVuY3Rpb24gZGVzdHJveSgpIHsKICAgICAgICAgICAgICAgIHRoaXMuJG1lbnUub2ZmKCIudHQiKTsKICAgICAgICAgICAgICAgIHRoaXMuJG1lbnUgPSBudWxsOwogICAgICAgICAgICAgICAgXy5lYWNoKHRoaXMuZGF0YXNldHMsIGRlc3Ryb3lEYXRhc2V0KTsKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGRlc3Ryb3lEYXRhc2V0KGRhdGFzZXQpIHsKICAgICAgICAgICAgICAgICAgICBkYXRhc2V0LmRlc3Ryb3koKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHJldHVybiBEcm9wZG93bjsKICAgICAgICBmdW5jdGlvbiBpbml0aWFsaXplRGF0YXNldChvRGF0YXNldCkgewogICAgICAgICAgICByZXR1cm4gbmV3IERhdGFzZXQob0RhdGFzZXQpOwogICAgICAgIH0KICAgIH0oKTsKICAgIHZhciBUeXBlYWhlYWQgPSBmdW5jdGlvbigpIHsKICAgICAgICAKICAgICAgICB2YXIgYXR0cnNLZXkgPSAidHRBdHRycyI7CiAgICAgICAgZnVuY3Rpb24gVHlwZWFoZWFkKG8pIHsKICAgICAgICAgICAgdmFyICRtZW51LCAkaW5wdXQsICRoaW50OwogICAgICAgICAgICBvID0gbyB8fCB7fTsKICAgICAgICAgICAgaWYgKCFvLmlucHV0KSB7CiAgICAgICAgICAgICAgICAkLmVycm9yKCJtaXNzaW5nIGlucHV0Iik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5pc0FjdGl2YXRlZCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLmF1dG9zZWxlY3QgPSAhIW8uYXV0b3NlbGVjdDsKICAgICAgICAgICAgdGhpcy5taW5MZW5ndGggPSBfLmlzTnVtYmVyKG8ubWluTGVuZ3RoKSA/IG8ubWluTGVuZ3RoIDogMTsKICAgICAgICAgICAgdGhpcy4kbm9kZSA9IGJ1aWxkRG9tKG8uaW5wdXQsIG8ud2l0aEhpbnQpOwogICAgICAgICAgICAkbWVudSA9IHRoaXMuJG5vZGUuZmluZCgiLnR0LWRyb3Bkb3duLW1lbnUiKTsKICAgICAgICAgICAgJGlucHV0ID0gdGhpcy4kbm9kZS5maW5kKCIudHQtaW5wdXQiKTsKICAgICAgICAgICAgJGhpbnQgPSB0aGlzLiRub2RlLmZpbmQoIi50dC1oaW50Iik7CiAgICAgICAgICAgICRpbnB1dC5vbigiYmx1ci50dCIsIGZ1bmN0aW9uKCRlKSB7CiAgICAgICAgICAgICAgICB2YXIgYWN0aXZlLCBpc0FjdGl2ZSwgaGFzQWN0aXZlOwogICAgICAgICAgICAgICAgYWN0aXZlID0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudDsKICAgICAgICAgICAgICAgIGlzQWN0aXZlID0gJG1lbnUuaXMoYWN0aXZlKTsKICAgICAgICAgICAgICAgIGhhc0FjdGl2ZSA9ICRtZW51LmhhcyhhY3RpdmUpLmxlbmd0aCA+IDA7CiAgICAgICAgICAgICAgICBpZiAoXy5pc01zaWUoKSAmJiAoaXNBY3RpdmUgfHwgaGFzQWN0aXZlKSkgewogICAgICAgICAgICAgICAgICAgICRlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgJGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7CiAgICAgICAgICAgICAgICAgICAgXy5kZWZlcihmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGlucHV0LmZvY3VzKCk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAkbWVudS5vbigibW91c2Vkb3duLnR0IiwgZnVuY3Rpb24oJGUpIHsKICAgICAgICAgICAgICAgICRlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0aGlzLmV2ZW50QnVzID0gby5ldmVudEJ1cyB8fCBuZXcgRXZlbnRCdXMoewogICAgICAgICAgICAgICAgZWw6ICRpbnB1dAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGhpcy5kcm9wZG93biA9IG5ldyBEcm9wZG93bih7CiAgICAgICAgICAgICAgICBtZW51OiAkbWVudSwKICAgICAgICAgICAgICAgIGRhdGFzZXRzOiBvLmRhdGFzZXRzCiAgICAgICAgICAgIH0pLm9uU3luYygic3VnZ2VzdGlvbkNsaWNrZWQiLCB0aGlzLl9vblN1Z2dlc3Rpb25DbGlja2VkLCB0aGlzKS5vblN5bmMoImN1cnNvck1vdmVkIiwgdGhpcy5fb25DdXJzb3JNb3ZlZCwgdGhpcykub25TeW5jKCJjdXJzb3JSZW1vdmVkIiwgdGhpcy5fb25DdXJzb3JSZW1vdmVkLCB0aGlzKS5vblN5bmMoIm9wZW5lZCIsIHRoaXMuX29uT3BlbmVkLCB0aGlzKS5vblN5bmMoImNsb3NlZCIsIHRoaXMuX29uQ2xvc2VkLCB0aGlzKS5vbkFzeW5jKCJkYXRhc2V0UmVuZGVyZWQiLCB0aGlzLl9vbkRhdGFzZXRSZW5kZXJlZCwgdGhpcyk7CiAgICAgICAgICAgIHRoaXMuaW5wdXQgPSBuZXcgSW5wdXQoewogICAgICAgICAgICAgICAgaW5wdXQ6ICRpbnB1dCwKICAgICAgICAgICAgICAgIGhpbnQ6ICRoaW50CiAgICAgICAgICAgIH0pLm9uU3luYygiZm9jdXNlZCIsIHRoaXMuX29uRm9jdXNlZCwgdGhpcykub25TeW5jKCJibHVycmVkIiwgdGhpcy5fb25CbHVycmVkLCB0aGlzKS5vblN5bmMoImVudGVyS2V5ZWQiLCB0aGlzLl9vbkVudGVyS2V5ZWQsIHRoaXMpLm9uU3luYygidGFiS2V5ZWQiLCB0aGlzLl9vblRhYktleWVkLCB0aGlzKS5vblN5bmMoImVzY0tleWVkIiwgdGhpcy5fb25Fc2NLZXllZCwgdGhpcykub25TeW5jKCJ1cEtleWVkIiwgdGhpcy5fb25VcEtleWVkLCB0aGlzKS5vblN5bmMoImRvd25LZXllZCIsIHRoaXMuX29uRG93bktleWVkLCB0aGlzKS5vblN5bmMoImxlZnRLZXllZCIsIHRoaXMuX29uTGVmdEtleWVkLCB0aGlzKS5vblN5bmMoInJpZ2h0S2V5ZWQiLCB0aGlzLl9vblJpZ2h0S2V5ZWQsIHRoaXMpLm9uU3luYygicXVlcnlDaGFuZ2VkIiwgdGhpcy5fb25RdWVyeUNoYW5nZWQsIHRoaXMpLm9uU3luYygid2hpdGVzcGFjZUNoYW5nZWQiLCB0aGlzLl9vbldoaXRlc3BhY2VDaGFuZ2VkLCB0aGlzKTsKICAgICAgICAgICAgdGhpcy5fc2V0TGFuZ3VhZ2VEaXJlY3Rpb24oKTsKICAgICAgICB9CiAgICAgICAgXy5taXhpbihUeXBlYWhlYWQucHJvdG90eXBlLCB7CiAgICAgICAgICAgIF9vblN1Z2dlc3Rpb25DbGlja2VkOiBmdW5jdGlvbiBvblN1Z2dlc3Rpb25DbGlja2VkKHR5cGUsICRlbCkgewogICAgICAgICAgICAgICAgdmFyIGRhdHVtOwogICAgICAgICAgICAgICAgaWYgKGRhdHVtID0gdGhpcy5kcm9wZG93bi5nZXREYXR1bUZvclN1Z2dlc3Rpb24oJGVsKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX3NlbGVjdChkYXR1bSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9vbkN1cnNvck1vdmVkOiBmdW5jdGlvbiBvbkN1cnNvck1vdmVkKCkgewogICAgICAgICAgICAgICAgdmFyIGRhdHVtID0gdGhpcy5kcm9wZG93bi5nZXREYXR1bUZvckN1cnNvcigpOwogICAgICAgICAgICAgICAgdGhpcy5pbnB1dC5zZXRJbnB1dFZhbHVlKGRhdHVtLnZhbHVlLCB0cnVlKTsKICAgICAgICAgICAgICAgIHRoaXMuZXZlbnRCdXMudHJpZ2dlcigiY3Vyc29yY2hhbmdlZCIsIGRhdHVtLnJhdywgZGF0dW0uZGF0YXNldE5hbWUpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfb25DdXJzb3JSZW1vdmVkOiBmdW5jdGlvbiBvbkN1cnNvclJlbW92ZWQoKSB7CiAgICAgICAgICAgICAgICB0aGlzLmlucHV0LnJlc2V0SW5wdXRWYWx1ZSgpOwogICAgICAgICAgICAgICAgdGhpcy5fdXBkYXRlSGludCgpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfb25EYXRhc2V0UmVuZGVyZWQ6IGZ1bmN0aW9uIG9uRGF0YXNldFJlbmRlcmVkKCkgewogICAgICAgICAgICAgICAgdGhpcy5fdXBkYXRlSGludCgpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfb25PcGVuZWQ6IGZ1bmN0aW9uIG9uT3BlbmVkKCkgewogICAgICAgICAgICAgICAgdGhpcy5fdXBkYXRlSGludCgpOwogICAgICAgICAgICAgICAgdGhpcy5ldmVudEJ1cy50cmlnZ2VyKCJvcGVuZWQiKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX29uQ2xvc2VkOiBmdW5jdGlvbiBvbkNsb3NlZCgpIHsKICAgICAgICAgICAgICAgIHRoaXMuaW5wdXQuY2xlYXJIaW50KCk7CiAgICAgICAgICAgICAgICB0aGlzLmV2ZW50QnVzLnRyaWdnZXIoImNsb3NlZCIpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfb25Gb2N1c2VkOiBmdW5jdGlvbiBvbkZvY3VzZWQoKSB7CiAgICAgICAgICAgICAgICB0aGlzLmlzQWN0aXZhdGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHRoaXMuZHJvcGRvd24ub3BlbigpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfb25CbHVycmVkOiBmdW5jdGlvbiBvbkJsdXJyZWQoKSB7CiAgICAgICAgICAgICAgICB0aGlzLmlzQWN0aXZhdGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICB0aGlzLmRyb3Bkb3duLmVtcHR5KCk7CiAgICAgICAgICAgICAgICB0aGlzLmRyb3Bkb3duLmNsb3NlKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9vbkVudGVyS2V5ZWQ6IGZ1bmN0aW9uIG9uRW50ZXJLZXllZCh0eXBlLCAkZSkgewogICAgICAgICAgICAgICAgdmFyIGN1cnNvckRhdHVtLCB0b3BTdWdnZXN0aW9uRGF0dW07CiAgICAgICAgICAgICAgICBjdXJzb3JEYXR1bSA9IHRoaXMuZHJvcGRvd24uZ2V0RGF0dW1Gb3JDdXJzb3IoKTsKICAgICAgICAgICAgICAgIHRvcFN1Z2dlc3Rpb25EYXR1bSA9IHRoaXMuZHJvcGRvd24uZ2V0RGF0dW1Gb3JUb3BTdWdnZXN0aW9uKCk7CiAgICAgICAgICAgICAgICBpZiAoY3Vyc29yRGF0dW0pIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9zZWxlY3QoY3Vyc29yRGF0dW0pOwogICAgICAgICAgICAgICAgICAgICRlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuYXV0b3NlbGVjdCAmJiB0b3BTdWdnZXN0aW9uRGF0dW0pIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9zZWxlY3QodG9wU3VnZ2VzdGlvbkRhdHVtKTsKICAgICAgICAgICAgICAgICAgICAkZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBfb25UYWJLZXllZDogZnVuY3Rpb24gb25UYWJLZXllZCh0eXBlLCAkZSkgewogICAgICAgICAgICAgICAgdmFyIGRhdHVtOwogICAgICAgICAgICAgICAgaWYgKGRhdHVtID0gdGhpcy5kcm9wZG93bi5nZXREYXR1bUZvckN1cnNvcigpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2VsZWN0KGRhdHVtKTsKICAgICAgICAgICAgICAgICAgICAkZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9hdXRvY29tcGxldGUodHJ1ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9vbkVzY0tleWVkOiBmdW5jdGlvbiBvbkVzY0tleWVkKCkgewogICAgICAgICAgICAgICAgdGhpcy5kcm9wZG93bi5jbG9zZSgpOwogICAgICAgICAgICAgICAgdGhpcy5pbnB1dC5yZXNldElucHV0VmFsdWUoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX29uVXBLZXllZDogZnVuY3Rpb24gb25VcEtleWVkKCkgewogICAgICAgICAgICAgICAgdmFyIHF1ZXJ5ID0gdGhpcy5pbnB1dC5nZXRRdWVyeSgpOwogICAgICAgICAgICAgICAgdGhpcy5kcm9wZG93bi5pc0VtcHR5ICYmIHF1ZXJ5Lmxlbmd0aCA+PSB0aGlzLm1pbkxlbmd0aCA/IHRoaXMuZHJvcGRvd24udXBkYXRlKHF1ZXJ5KSA6IHRoaXMuZHJvcGRvd24ubW92ZUN1cnNvclVwKCk7CiAgICAgICAgICAgICAgICB0aGlzLmRyb3Bkb3duLm9wZW4oKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX29uRG93bktleWVkOiBmdW5jdGlvbiBvbkRvd25LZXllZCgpIHsKICAgICAgICAgICAgICAgIHZhciBxdWVyeSA9IHRoaXMuaW5wdXQuZ2V0UXVlcnkoKTsKICAgICAgICAgICAgICAgIHRoaXMuZHJvcGRvd24uaXNFbXB0eSAmJiBxdWVyeS5sZW5ndGggPj0gdGhpcy5taW5MZW5ndGggPyB0aGlzLmRyb3Bkb3duLnVwZGF0ZShxdWVyeSkgOiB0aGlzLmRyb3Bkb3duLm1vdmVDdXJzb3JEb3duKCk7CiAgICAgICAgICAgICAgICB0aGlzLmRyb3Bkb3duLm9wZW4oKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX29uTGVmdEtleWVkOiBmdW5jdGlvbiBvbkxlZnRLZXllZCgpIHsKICAgICAgICAgICAgICAgIHRoaXMuZGlyID09PSAicnRsIiAmJiB0aGlzLl9hdXRvY29tcGxldGUoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgX29uUmlnaHRLZXllZDogZnVuY3Rpb24gb25SaWdodEtleWVkKCkgewogICAgICAgICAgICAgICAgdGhpcy5kaXIgPT09ICJsdHIiICYmIHRoaXMuX2F1dG9jb21wbGV0ZSgpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfb25RdWVyeUNoYW5nZWQ6IGZ1bmN0aW9uIG9uUXVlcnlDaGFuZ2VkKGUsIHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICB0aGlzLmlucHV0LmNsZWFySGludElmSW52YWxpZCgpOwogICAgICAgICAgICAgICAgcXVlcnkubGVuZ3RoID49IHRoaXMubWluTGVuZ3RoID8gdGhpcy5kcm9wZG93bi51cGRhdGUocXVlcnkpIDogdGhpcy5kcm9wZG93bi5lbXB0eSgpOwogICAgICAgICAgICAgICAgdGhpcy5kcm9wZG93bi5vcGVuKCk7CiAgICAgICAgICAgICAgICB0aGlzLl9zZXRMYW5ndWFnZURpcmVjdGlvbigpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfb25XaGl0ZXNwYWNlQ2hhbmdlZDogZnVuY3Rpb24gb25XaGl0ZXNwYWNlQ2hhbmdlZCgpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3VwZGF0ZUhpbnQoKTsKICAgICAgICAgICAgICAgIHRoaXMuZHJvcGRvd24ub3BlbigpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBfc2V0TGFuZ3VhZ2VEaXJlY3Rpb246IGZ1bmN0aW9uIHNldExhbmd1YWdlRGlyZWN0aW9uKCkgewogICAgICAgICAgICAgICAgdmFyIGRpcjsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmRpciAhPT0gKGRpciA9IHRoaXMuaW5wdXQuZ2V0TGFuZ3VhZ2VEaXJlY3Rpb24oKSkpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmRpciA9IGRpcjsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRub2RlLmNzcygiZGlyZWN0aW9uIiwgZGlyKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmRyb3Bkb3duLnNldExhbmd1YWdlRGlyZWN0aW9uKGRpcik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF91cGRhdGVIaW50OiBmdW5jdGlvbiB1cGRhdGVIaW50KCkgewogICAgICAgICAgICAgICAgdmFyIGRhdHVtLCB2YWwsIHF1ZXJ5LCBlc2NhcGVkUXVlcnksIGZyb250TWF0Y2hSZWdFeCwgbWF0Y2g7CiAgICAgICAgICAgICAgICBkYXR1bSA9IHRoaXMuZHJvcGRvd24uZ2V0RGF0dW1Gb3JUb3BTdWdnZXN0aW9uKCk7CiAgICAgICAgICAgICAgICBpZiAoZGF0dW0gJiYgdGhpcy5kcm9wZG93bi5pc1Zpc2libGUoKSAmJiAhdGhpcy5pbnB1dC5oYXNPdmVyZmxvdygpKSB7CiAgICAgICAgICAgICAgICAgICAgdmFsID0gdGhpcy5pbnB1dC5nZXRJbnB1dFZhbHVlKCk7CiAgICAgICAgICAgICAgICAgICAgcXVlcnkgPSBJbnB1dC5ub3JtYWxpemVRdWVyeSh2YWwpOwogICAgICAgICAgICAgICAgICAgIGVzY2FwZWRRdWVyeSA9IF8uZXNjYXBlUmVnRXhDaGFycyhxdWVyeSk7CiAgICAgICAgICAgICAgICAgICAgZnJvbnRNYXRjaFJlZ0V4ID0gbmV3IFJlZ0V4cCgiXig/OiIgKyBlc2NhcGVkUXVlcnkgKyAiKSguKyQpIiwgImkiKTsKICAgICAgICAgICAgICAgICAgICBtYXRjaCA9IGZyb250TWF0Y2hSZWdFeC5leGVjKGRhdHVtLnZhbHVlKTsKICAgICAgICAgICAgICAgICAgICBtYXRjaCA/IHRoaXMuaW5wdXQuc2V0SGludCh2YWwgKyBtYXRjaFsxXSkgOiB0aGlzLmlucHV0LmNsZWFySGludCgpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmlucHV0LmNsZWFySGludCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBfYXV0b2NvbXBsZXRlOiBmdW5jdGlvbiBhdXRvY29tcGxldGUobGF4Q3Vyc29yKSB7CiAgICAgICAgICAgICAgICB2YXIgaGludCwgcXVlcnksIGlzQ3Vyc29yQXRFbmQsIGRhdHVtOwogICAgICAgICAgICAgICAgaGludCA9IHRoaXMuaW5wdXQuZ2V0SGludCgpOwogICAgICAgICAgICAgICAgcXVlcnkgPSB0aGlzLmlucHV0LmdldFF1ZXJ5KCk7CiAgICAgICAgICAgICAgICBpc0N1cnNvckF0RW5kID0gbGF4Q3Vyc29yIHx8IHRoaXMuaW5wdXQuaXNDdXJzb3JBdEVuZCgpOwogICAgICAgICAgICAgICAgaWYgKGhpbnQgJiYgcXVlcnkgIT09IGhpbnQgJiYgaXNDdXJzb3JBdEVuZCkgewogICAgICAgICAgICAgICAgICAgIGRhdHVtID0gdGhpcy5kcm9wZG93bi5nZXREYXR1bUZvclRvcFN1Z2dlc3Rpb24oKTsKICAgICAgICAgICAgICAgICAgICBkYXR1bSAmJiB0aGlzLmlucHV0LnNldElucHV0VmFsdWUoZGF0dW0udmFsdWUpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuZXZlbnRCdXMudHJpZ2dlcigiYXV0b2NvbXBsZXRlZCIsIGRhdHVtLnJhdywgZGF0dW0uZGF0YXNldE5hbWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBfc2VsZWN0OiBmdW5jdGlvbiBzZWxlY3QoZGF0dW0pIHsKICAgICAgICAgICAgICAgIHRoaXMuaW5wdXQuc2V0UXVlcnkoZGF0dW0udmFsdWUpOwogICAgICAgICAgICAgICAgdGhpcy5pbnB1dC5zZXRJbnB1dFZhbHVlKGRhdHVtLnZhbHVlLCB0cnVlKTsKICAgICAgICAgICAgICAgIHRoaXMuX3NldExhbmd1YWdlRGlyZWN0aW9uKCk7CiAgICAgICAgICAgICAgICB0aGlzLmV2ZW50QnVzLnRyaWdnZXIoInNlbGVjdGVkIiwgZGF0dW0ucmF3LCBkYXR1bS5kYXRhc2V0TmFtZSk7CiAgICAgICAgICAgICAgICB0aGlzLmRyb3Bkb3duLmNsb3NlKCk7CiAgICAgICAgICAgICAgICBfLmRlZmVyKF8uYmluZCh0aGlzLmRyb3Bkb3duLmVtcHR5LCB0aGlzLmRyb3Bkb3duKSk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG9wZW46IGZ1bmN0aW9uIG9wZW4oKSB7CiAgICAgICAgICAgICAgICB0aGlzLmRyb3Bkb3duLm9wZW4oKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgY2xvc2U6IGZ1bmN0aW9uIGNsb3NlKCkgewogICAgICAgICAgICAgICAgdGhpcy5kcm9wZG93bi5jbG9zZSgpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBzZXRWYWw6IGZ1bmN0aW9uIHNldFZhbCh2YWwpIHsKICAgICAgICAgICAgICAgIHZhbCA9IF8udG9TdHIodmFsKTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzQWN0aXZhdGVkKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnB1dC5zZXRJbnB1dFZhbHVlKHZhbCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRoaXMuaW5wdXQuc2V0UXVlcnkodmFsKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmlucHV0LnNldElucHV0VmFsdWUodmFsLCB0cnVlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuX3NldExhbmd1YWdlRGlyZWN0aW9uKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGdldFZhbDogZnVuY3Rpb24gZ2V0VmFsKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaW5wdXQuZ2V0UXVlcnkoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZGVzdHJveTogZnVuY3Rpb24gZGVzdHJveSgpIHsKICAgICAgICAgICAgICAgIHRoaXMuaW5wdXQuZGVzdHJveSgpOwogICAgICAgICAgICAgICAgdGhpcy5kcm9wZG93bi5kZXN0cm95KCk7CiAgICAgICAgICAgICAgICBkZXN0cm95RG9tU3RydWN0dXJlKHRoaXMuJG5vZGUpOwogICAgICAgICAgICAgICAgdGhpcy4kbm9kZSA9IG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICByZXR1cm4gVHlwZWFoZWFkOwogICAgICAgIGZ1bmN0aW9uIGJ1aWxkRG9tKGlucHV0LCB3aXRoSGludCkgewogICAgICAgICAgICB2YXIgJGlucHV0LCAkd3JhcHBlciwgJGRyb3Bkb3duLCAkaGludDsKICAgICAgICAgICAgJGlucHV0ID0gJChpbnB1dCk7CiAgICAgICAgICAgICR3cmFwcGVyID0gJChodG1sLndyYXBwZXIpLmNzcyhjc3Mud3JhcHBlcik7CiAgICAgICAgICAgICRkcm9wZG93biA9ICQoaHRtbC5kcm9wZG93bikuY3NzKGNzcy5kcm9wZG93bik7CiAgICAgICAgICAgICRoaW50ID0gJGlucHV0LmNsb25lKCkuY3NzKGNzcy5oaW50KS5jc3MoZ2V0QmFja2dyb3VuZFN0eWxlcygkaW5wdXQpKTsKICAgICAgICAgICAgJGhpbnQudmFsKCIiKS5yZW1vdmVEYXRhKCkuYWRkQ2xhc3MoInR0LWhpbnQiKS5yZW1vdmVBdHRyKCJpZCBuYW1lIHBsYWNlaG9sZGVyIHJlcXVpcmVkIikucHJvcCgicmVhZG9ubHkiLCB0cnVlKS5hdHRyKHsKICAgICAgICAgICAgICAgIGF1dG9jb21wbGV0ZTogIm9mZiIsCiAgICAgICAgICAgICAgICBzcGVsbGNoZWNrOiAiZmFsc2UiLAogICAgICAgICAgICAgICAgdGFiaW5kZXg6IC0xCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAkaW5wdXQuZGF0YShhdHRyc0tleSwgewogICAgICAgICAgICAgICAgZGlyOiAkaW5wdXQuYXR0cigiZGlyIiksCiAgICAgICAgICAgICAgICBhdXRvY29tcGxldGU6ICRpbnB1dC5hdHRyKCJhdXRvY29tcGxldGUiKSwKICAgICAgICAgICAgICAgIHNwZWxsY2hlY2s6ICRpbnB1dC5hdHRyKCJzcGVsbGNoZWNrIiksCiAgICAgICAgICAgICAgICBzdHlsZTogJGlucHV0LmF0dHIoInN0eWxlIikKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICRpbnB1dC5hZGRDbGFzcygidHQtaW5wdXQiKS5hdHRyKHsKICAgICAgICAgICAgICAgIGF1dG9jb21wbGV0ZTogIm9mZiIsCiAgICAgICAgICAgICAgICBzcGVsbGNoZWNrOiBmYWxzZQogICAgICAgICAgICB9KS5jc3Mod2l0aEhpbnQgPyBjc3MuaW5wdXQgOiBjc3MuaW5wdXRXaXRoTm9IaW50KTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICEkaW5wdXQuYXR0cigiZGlyIikgJiYgJGlucHV0LmF0dHIoImRpciIsICJhdXRvIik7CiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHt9CiAgICAgICAgICAgIHJldHVybiAkaW5wdXQud3JhcCgkd3JhcHBlcikucGFyZW50KCkucHJlcGVuZCh3aXRoSGludCA/ICRoaW50IDogbnVsbCkuYXBwZW5kKCRkcm9wZG93bik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGdldEJhY2tncm91bmRTdHlsZXMoJGVsKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQXR0YWNobWVudDogJGVsLmNzcygiYmFja2dyb3VuZC1hdHRhY2htZW50IiksCiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ2xpcDogJGVsLmNzcygiYmFja2dyb3VuZC1jbGlwIiksCiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICRlbC5jc3MoImJhY2tncm91bmQtY29sb3IiKSwKICAgICAgICAgICAgICAgIGJhY2tncm91bmRJbWFnZTogJGVsLmNzcygiYmFja2dyb3VuZC1pbWFnZSIpLAogICAgICAgICAgICAgICAgYmFja2dyb3VuZE9yaWdpbjogJGVsLmNzcygiYmFja2dyb3VuZC1vcmlnaW4iKSwKICAgICAgICAgICAgICAgIGJhY2tncm91bmRQb3NpdGlvbjogJGVsLmNzcygiYmFja2dyb3VuZC1wb3NpdGlvbiIpLAogICAgICAgICAgICAgICAgYmFja2dyb3VuZFJlcGVhdDogJGVsLmNzcygiYmFja2dyb3VuZC1yZXBlYXQiKSwKICAgICAgICAgICAgICAgIGJhY2tncm91bmRTaXplOiAkZWwuY3NzKCJiYWNrZ3JvdW5kLXNpemUiKQogICAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBkZXN0cm95RG9tU3RydWN0dXJlKCRub2RlKSB7CiAgICAgICAgICAgIHZhciAkaW5wdXQgPSAkbm9kZS5maW5kKCIudHQtaW5wdXQiKTsKICAgICAgICAgICAgXy5lYWNoKCRpbnB1dC5kYXRhKGF0dHJzS2V5KSwgZnVuY3Rpb24odmFsLCBrZXkpIHsKICAgICAgICAgICAgICAgIF8uaXNVbmRlZmluZWQodmFsKSA/ICRpbnB1dC5yZW1vdmVBdHRyKGtleSkgOiAkaW5wdXQuYXR0cihrZXksIHZhbCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAkaW5wdXQuZGV0YWNoKCkucmVtb3ZlRGF0YShhdHRyc0tleSkucmVtb3ZlQ2xhc3MoInR0LWlucHV0IikuaW5zZXJ0QWZ0ZXIoJG5vZGUpOwogICAgICAgICAgICAkbm9kZS5yZW1vdmUoKTsKICAgICAgICB9CiAgICB9KCk7CiAgICAoZnVuY3Rpb24oKSB7CiAgICAgICAgCiAgICAgICAgdmFyIG9sZCwgdHlwZWFoZWFkS2V5LCBtZXRob2RzOwogICAgICAgIG9sZCA9ICQuZm4udHlwZWFoZWFkOwogICAgICAgIHR5cGVhaGVhZEtleSA9ICJ0dFR5cGVhaGVhZCI7CiAgICAgICAgbWV0aG9kcyA9IHsKICAgICAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gaW5pdGlhbGl6ZShvLCBkYXRhc2V0cykgewogICAgICAgICAgICAgICAgZGF0YXNldHMgPSBfLmlzQXJyYXkoZGF0YXNldHMpID8gZGF0YXNldHMgOiBbXS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSk7CiAgICAgICAgICAgICAgICBvID0gbyB8fCB7fTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goYXR0YWNoKTsKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGF0dGFjaCgpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgJGlucHV0ID0gJCh0aGlzKSwgZXZlbnRCdXMsIHR5cGVhaGVhZDsKICAgICAgICAgICAgICAgICAgICBfLmVhY2goZGF0YXNldHMsIGZ1bmN0aW9uKGQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZC5oaWdobGlnaHQgPSAhIW8uaGlnaGxpZ2h0OwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHR5cGVhaGVhZCA9IG5ldyBUeXBlYWhlYWQoewogICAgICAgICAgICAgICAgICAgICAgICBpbnB1dDogJGlucHV0LAogICAgICAgICAgICAgICAgICAgICAgICBldmVudEJ1czogZXZlbnRCdXMgPSBuZXcgRXZlbnRCdXMoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWw6ICRpbnB1dAogICAgICAgICAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgd2l0aEhpbnQ6IF8uaXNVbmRlZmluZWQoby5oaW50KSA/IHRydWUgOiAhIW8uaGludCwKICAgICAgICAgICAgICAgICAgICAgICAgbWluTGVuZ3RoOiBvLm1pbkxlbmd0aCwKICAgICAgICAgICAgICAgICAgICAgICAgYXV0b3NlbGVjdDogby5hdXRvc2VsZWN0LAogICAgICAgICAgICAgICAgICAgICAgICBkYXRhc2V0czogZGF0YXNldHMKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAkaW5wdXQuZGF0YSh0eXBlYWhlYWRLZXksIHR5cGVhaGVhZCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG9wZW46IGZ1bmN0aW9uIG9wZW4oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKG9wZW5UeXBlYWhlYWQpOwogICAgICAgICAgICAgICAgZnVuY3Rpb24gb3BlblR5cGVhaGVhZCgpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgJGlucHV0ID0gJCh0aGlzKSwgdHlwZWFoZWFkOwogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlYWhlYWQgPSAkaW5wdXQuZGF0YSh0eXBlYWhlYWRLZXkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVhaGVhZC5vcGVuKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBjbG9zZTogZnVuY3Rpb24gY2xvc2UoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGNsb3NlVHlwZWFoZWFkKTsKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGNsb3NlVHlwZWFoZWFkKCkgewogICAgICAgICAgICAgICAgICAgIHZhciAkaW5wdXQgPSAkKHRoaXMpLCB0eXBlYWhlYWQ7CiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVhaGVhZCA9ICRpbnB1dC5kYXRhKHR5cGVhaGVhZEtleSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZWFoZWFkLmNsb3NlKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICB2YWw6IGZ1bmN0aW9uIHZhbChuZXdWYWwpIHsKICAgICAgICAgICAgICAgIHJldHVybiAhYXJndW1lbnRzLmxlbmd0aCA/IGdldFZhbCh0aGlzLmZpcnN0KCkpIDogdGhpcy5lYWNoKHNldFZhbCk7CiAgICAgICAgICAgICAgICBmdW5jdGlvbiBzZXRWYWwoKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyICRpbnB1dCA9ICQodGhpcyksIHR5cGVhaGVhZDsKICAgICAgICAgICAgICAgICAgICBpZiAodHlwZWFoZWFkID0gJGlucHV0LmRhdGEodHlwZWFoZWFkS2V5KSkgewogICAgICAgICAgICAgICAgICAgICAgICB0eXBlYWhlYWQuc2V0VmFsKG5ld1ZhbCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZnVuY3Rpb24gZ2V0VmFsKCRpbnB1dCkgewogICAgICAgICAgICAgICAgICAgIHZhciB0eXBlYWhlYWQsIHF1ZXJ5OwogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlYWhlYWQgPSAkaW5wdXQuZGF0YSh0eXBlYWhlYWRLZXkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXJ5ID0gdHlwZWFoZWFkLmdldFZhbCgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gcXVlcnk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uIGRlc3Ryb3koKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lYWNoKHVuYXR0YWNoKTsKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHVuYXR0YWNoKCkgewogICAgICAgICAgICAgICAgICAgIHZhciAkaW5wdXQgPSAkKHRoaXMpLCB0eXBlYWhlYWQ7CiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVhaGVhZCA9ICRpbnB1dC5kYXRhKHR5cGVhaGVhZEtleSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZWFoZWFkLmRlc3Ryb3koKTsKICAgICAgICAgICAgICAgICAgICAgICAgJGlucHV0LnJlbW92ZURhdGEodHlwZWFoZWFkS2V5KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgICQuZm4udHlwZWFoZWFkID0gZnVuY3Rpb24obWV0aG9kKSB7CiAgICAgICAgICAgIHZhciB0dHM7CiAgICAgICAgICAgIGlmIChtZXRob2RzW21ldGhvZF0gJiYgbWV0aG9kICE9PSAiaW5pdGlhbGl6ZSIpIHsKICAgICAgICAgICAgICAgIHR0cyA9IHRoaXMuZmlsdGVyKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAhISQodGhpcykuZGF0YSh0eXBlYWhlYWRLZXkpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICByZXR1cm4gbWV0aG9kc1ttZXRob2RdLmFwcGx5KHR0cywgW10uc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBtZXRob2RzLmluaXRpYWxpemUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgJC5mbi50eXBlYWhlYWQubm9Db25mbGljdCA9IGZ1bmN0aW9uIG5vQ29uZmxpY3QoKSB7CiAgICAgICAgICAgICQuZm4udHlwZWFoZWFkID0gb2xkOwogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9OwogICAgfSkoKTsKICAgIHJldHVybiB7fTsKfSkpOwoKLy8gVGhpcyBjb2RlIHdhcyB3cml0dGVuIGJ5IFR5bGVyIEFraW5zIGFuZCBoYXMgYmVlbiBwbGFjZWQgaW4gdGhlCi8vIHB1YmxpYyBkb21haW4uICBJdCB3b3VsZCBiZSBuaWNlIGlmIHlvdSBsZWZ0IHRoaXMgaGVhZGVyIGludGFjdC4KLy8gQmFzZTY0IGNvZGUgZnJvbSBUeWxlciBBa2lucyAtLSBodHRwOi8vcnVta2luLmNvbQoKdmFyIEJhc2U2NCA9IChmdW5jdGlvbiAoKSB7CiAgICB2YXIga2V5U3RyID0gIkFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5Ky89IjsKCiAgICB2YXIgb2JqID0gewogICAgICAgIC8qKgogICAgICAgICAqIEVuY29kZXMgYSBzdHJpbmcgaW4gYmFzZTY0CiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGlucHV0IFRoZSBzdHJpbmcgdG8gZW5jb2RlIGluIGJhc2U2NC4KICAgICAgICAgKi8KICAgICAgICBlbmNvZGU6IGZ1bmN0aW9uIChpbnB1dCkgewogICAgICAgICAgICB2YXIgb3V0cHV0ID0gIiI7CiAgICAgICAgICAgIHZhciBjaHIxLCBjaHIyLCBjaHIzOwogICAgICAgICAgICB2YXIgZW5jMSwgZW5jMiwgZW5jMywgZW5jNDsKICAgICAgICAgICAgdmFyIGkgPSAwOwoKICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgICAgY2hyMSA9IGlucHV0LmNoYXJDb2RlQXQoaSsrKTsKICAgICAgICAgICAgICAgIGNocjIgPSBpbnB1dC5jaGFyQ29kZUF0KGkrKyk7CiAgICAgICAgICAgICAgICBjaHIzID0gaW5wdXQuY2hhckNvZGVBdChpKyspOwoKICAgICAgICAgICAgICAgIGVuYzEgPSBjaHIxID4+IDI7CiAgICAgICAgICAgICAgICBlbmMyID0gKChjaHIxICYgMykgPDwgNCkgfCAoY2hyMiA+PiA0KTsKICAgICAgICAgICAgICAgIGVuYzMgPSAoKGNocjIgJiAxNSkgPDwgMikgfCAoY2hyMyA+PiA2KTsKICAgICAgICAgICAgICAgIGVuYzQgPSBjaHIzICYgNjM7CgogICAgICAgICAgICAgICAgaWYgKGlzTmFOKGNocjIpKSB7CiAgICAgICAgICAgICAgICAgICAgZW5jMyA9IGVuYzQgPSA2NDsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNOYU4oY2hyMykpIHsKICAgICAgICAgICAgICAgICAgICBlbmM0ID0gNjQ7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgb3V0cHV0ID0gb3V0cHV0ICsga2V5U3RyLmNoYXJBdChlbmMxKSArIGtleVN0ci5jaGFyQXQoZW5jMikgKwogICAgICAgICAgICAgICAgICAgIGtleVN0ci5jaGFyQXQoZW5jMykgKyBrZXlTdHIuY2hhckF0KGVuYzQpOwogICAgICAgICAgICB9IHdoaWxlIChpIDwgaW5wdXQubGVuZ3RoKTsKCiAgICAgICAgICAgIHJldHVybiBvdXRwdXQ7CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogRGVjb2RlcyBhIGJhc2U2NCBzdHJpbmcuCiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGlucHV0IFRoZSBzdHJpbmcgdG8gZGVjb2RlLgogICAgICAgICAqLwogICAgICAgIGRlY29kZTogZnVuY3Rpb24gKGlucHV0KSB7CiAgICAgICAgICAgIHZhciBvdXRwdXQgPSAiIjsKICAgICAgICAgICAgdmFyIGNocjEsIGNocjIsIGNocjM7CiAgICAgICAgICAgIHZhciBlbmMxLCBlbmMyLCBlbmMzLCBlbmM0OwogICAgICAgICAgICB2YXIgaSA9IDA7CgogICAgICAgICAgICAvLyByZW1vdmUgYWxsIGNoYXJhY3RlcnMgdGhhdCBhcmUgbm90IEEtWiwgYS16LCAwLTksICssIC8sIG9yID0KICAgICAgICAgICAgaW5wdXQgPSBpbnB1dC5yZXBsYWNlKC9bXkEtWmEtejAtOVwrXC9cPV0vZywgIiIpOwoKICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgICAgZW5jMSA9IGtleVN0ci5pbmRleE9mKGlucHV0LmNoYXJBdChpKyspKTsKICAgICAgICAgICAgICAgIGVuYzIgPSBrZXlTdHIuaW5kZXhPZihpbnB1dC5jaGFyQXQoaSsrKSk7CiAgICAgICAgICAgICAgICBlbmMzID0ga2V5U3RyLmluZGV4T2YoaW5wdXQuY2hhckF0KGkrKykpOwogICAgICAgICAgICAgICAgZW5jNCA9IGtleVN0ci5pbmRleE9mKGlucHV0LmNoYXJBdChpKyspKTsKCiAgICAgICAgICAgICAgICBjaHIxID0gKGVuYzEgPDwgMikgfCAoZW5jMiA+PiA0KTsKICAgICAgICAgICAgICAgIGNocjIgPSAoKGVuYzIgJiAxNSkgPDwgNCkgfCAoZW5jMyA+PiAyKTsKICAgICAgICAgICAgICAgIGNocjMgPSAoKGVuYzMgJiAzKSA8PCA2KSB8IGVuYzQ7CgogICAgICAgICAgICAgICAgb3V0cHV0ID0gb3V0cHV0ICsgU3RyaW5nLmZyb21DaGFyQ29kZShjaHIxKTsKCiAgICAgICAgICAgICAgICBpZiAoZW5jMyAhPSA2NCkgewogICAgICAgICAgICAgICAgICAgIG91dHB1dCA9IG91dHB1dCArIFN0cmluZy5mcm9tQ2hhckNvZGUoY2hyMik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoZW5jNCAhPSA2NCkgewogICAgICAgICAgICAgICAgICAgIG91dHB1dCA9IG91dHB1dCArIFN0cmluZy5mcm9tQ2hhckNvZGUoY2hyMyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gd2hpbGUgKGkgPCBpbnB1dC5sZW5ndGgpOwoKICAgICAgICAgICAgcmV0dXJuIG91dHB1dDsKICAgICAgICB9CiAgICB9OwoKICAgIHJldHVybiBvYmo7Cn0pKCk7CgovKgogKiBBIEphdmFTY3JpcHQgaW1wbGVtZW50YXRpb24gb2YgdGhlIFNlY3VyZSBIYXNoIEFsZ29yaXRobSwgU0hBLTEsIGFzIGRlZmluZWQKICogaW4gRklQUyBQVUIgMTgwLTEKICogVmVyc2lvbiAyLjFhIENvcHlyaWdodCBQYXVsIEpvaG5zdG9uIDIwMDAgLSAyMDAyLgogKiBPdGhlciBjb250cmlidXRvcnM6IEdyZWcgSG9sdCwgQW5kcmV3IEtlcGVydCwgWWRuYXIsIExvc3RpbmV0CiAqIERpc3RyaWJ1dGVkIHVuZGVyIHRoZSBCU0QgTGljZW5zZQogKiBTZWUgaHR0cDovL3BhamhvbWUub3JnLnVrL2NyeXB0L21kNSBmb3IgZGV0YWlscy4KICovCgovKiBTb21lIGZ1bmN0aW9ucyBhbmQgdmFyaWFibGVzIGhhdmUgYmVlbiBzdHJpcHBlZCBmb3IgdXNlIHdpdGggU3Ryb3BoZSAqLwoKLyoKICogVGhlc2UgYXJlIHRoZSBmdW5jdGlvbnMgeW91J2xsIHVzdWFsbHkgd2FudCB0byBjYWxsCiAqIFRoZXkgdGFrZSBzdHJpbmcgYXJndW1lbnRzIGFuZCByZXR1cm4gZWl0aGVyIGhleCBvciBiYXNlLTY0IGVuY29kZWQgc3RyaW5ncwogKi8KZnVuY3Rpb24gYjY0X3NoYTEocyl7cmV0dXJuIGJpbmIyYjY0KGNvcmVfc2hhMShzdHIyYmluYihzKSxzLmxlbmd0aCAqIDgpKTt9CmZ1bmN0aW9uIHN0cl9zaGExKHMpe3JldHVybiBiaW5iMnN0cihjb3JlX3NoYTEoc3RyMmJpbmIocykscy5sZW5ndGggKiA4KSk7fQpmdW5jdGlvbiBiNjRfaG1hY19zaGExKGtleSwgZGF0YSl7IHJldHVybiBiaW5iMmI2NChjb3JlX2htYWNfc2hhMShrZXksIGRhdGEpKTt9CmZ1bmN0aW9uIHN0cl9obWFjX3NoYTEoa2V5LCBkYXRhKXsgcmV0dXJuIGJpbmIyc3RyKGNvcmVfaG1hY19zaGExKGtleSwgZGF0YSkpO30KCi8qCiAqIENhbGN1bGF0ZSB0aGUgU0hBLTEgb2YgYW4gYXJyYXkgb2YgYmlnLWVuZGlhbiB3b3JkcywgYW5kIGEgYml0IGxlbmd0aAogKi8KZnVuY3Rpb24gY29yZV9zaGExKHgsIGxlbikKewogIC8qIGFwcGVuZCBwYWRkaW5nICovCiAgeFtsZW4gPj4gNV0gfD0gMHg4MCA8PCAoMjQgLSBsZW4gJSAzMik7CiAgeFsoKGxlbiArIDY0ID4+IDkpIDw8IDQpICsgMTVdID0gbGVuOwoKICB2YXIgdyA9IG5ldyBBcnJheSg4MCk7CiAgdmFyIGEgPSAgMTczMjU4NDE5MzsKICB2YXIgYiA9IC0yNzE3MzM4Nzk7CiAgdmFyIGMgPSAtMTczMjU4NDE5NDsKICB2YXIgZCA9ICAyNzE3MzM4Nzg7CiAgdmFyIGUgPSAtMTAwOTU4OTc3NjsKCiAgdmFyIGksIGosIHQsIG9sZGEsIG9sZGIsIG9sZGMsIG9sZGQsIG9sZGU7CiAgZm9yIChpID0gMDsgaSA8IHgubGVuZ3RoOyBpICs9IDE2KQogIHsKICAgIG9sZGEgPSBhOwogICAgb2xkYiA9IGI7CiAgICBvbGRjID0gYzsKICAgIG9sZGQgPSBkOwogICAgb2xkZSA9IGU7CgogICAgZm9yIChqID0gMDsgaiA8IDgwOyBqKyspCiAgICB7CiAgICAgIGlmIChqIDwgMTYpIHsgd1tqXSA9IHhbaSArIGpdOyB9CiAgICAgIGVsc2UgeyB3W2pdID0gcm9sKHdbai0zXSBeIHdbai04XSBeIHdbai0xNF0gXiB3W2otMTZdLCAxKTsgfQogICAgICB0ID0gc2FmZV9hZGQoc2FmZV9hZGQocm9sKGEsIDUpLCBzaGExX2Z0KGosIGIsIGMsIGQpKSwKICAgICAgICAgICAgICAgICAgICAgICBzYWZlX2FkZChzYWZlX2FkZChlLCB3W2pdKSwgc2hhMV9rdChqKSkpOwogICAgICBlID0gZDsKICAgICAgZCA9IGM7CiAgICAgIGMgPSByb2woYiwgMzApOwogICAgICBiID0gYTsKICAgICAgYSA9IHQ7CiAgICB9CgogICAgYSA9IHNhZmVfYWRkKGEsIG9sZGEpOwogICAgYiA9IHNhZmVfYWRkKGIsIG9sZGIpOwogICAgYyA9IHNhZmVfYWRkKGMsIG9sZGMpOwogICAgZCA9IHNhZmVfYWRkKGQsIG9sZGQpOwogICAgZSA9IHNhZmVfYWRkKGUsIG9sZGUpOwogIH0KICByZXR1cm4gW2EsIGIsIGMsIGQsIGVdOwp9CgovKgogKiBQZXJmb3JtIHRoZSBhcHByb3ByaWF0ZSB0cmlwbGV0IGNvbWJpbmF0aW9uIGZ1bmN0aW9uIGZvciB0aGUgY3VycmVudAogKiBpdGVyYXRpb24KICovCmZ1bmN0aW9uIHNoYTFfZnQodCwgYiwgYywgZCkKewogIGlmICh0IDwgMjApIHsgcmV0dXJuIChiICYgYykgfCAoKH5iKSAmIGQpOyB9CiAgaWYgKHQgPCA0MCkgeyByZXR1cm4gYiBeIGMgXiBkOyB9CiAgaWYgKHQgPCA2MCkgeyByZXR1cm4gKGIgJiBjKSB8IChiICYgZCkgfCAoYyAmIGQpOyB9CiAgcmV0dXJuIGIgXiBjIF4gZDsKfQoKLyoKICogRGV0ZXJtaW5lIHRoZSBhcHByb3ByaWF0ZSBhZGRpdGl2ZSBjb25zdGFudCBmb3IgdGhlIGN1cnJlbnQgaXRlcmF0aW9uCiAqLwpmdW5jdGlvbiBzaGExX2t0KHQpCnsKICByZXR1cm4gKHQgPCAyMCkgPyAgMTUxODUwMDI0OSA6ICh0IDwgNDApID8gIDE4NTk3NzUzOTMgOgogICAgICAgICAodCA8IDYwKSA/IC0xODk0MDA3NTg4IDogLTg5OTQ5NzUxNDsKfQoKLyoKICogQ2FsY3VsYXRlIHRoZSBITUFDLVNIQTEgb2YgYSBrZXkgYW5kIHNvbWUgZGF0YQogKi8KZnVuY3Rpb24gY29yZV9obWFjX3NoYTEoa2V5LCBkYXRhKQp7CiAgdmFyIGJrZXkgPSBzdHIyYmluYihrZXkpOwogIGlmIChia2V5Lmxlbmd0aCA+IDE2KSB7IGJrZXkgPSBjb3JlX3NoYTEoYmtleSwga2V5Lmxlbmd0aCAqIDgpOyB9CgogIHZhciBpcGFkID0gbmV3IEFycmF5KDE2KSwgb3BhZCA9IG5ldyBBcnJheSgxNik7CiAgZm9yICh2YXIgaSA9IDA7IGkgPCAxNjsgaSsrKQogIHsKICAgIGlwYWRbaV0gPSBia2V5W2ldIF4gMHgzNjM2MzYzNjsKICAgIG9wYWRbaV0gPSBia2V5W2ldIF4gMHg1QzVDNUM1QzsKICB9CgogIHZhciBoYXNoID0gY29yZV9zaGExKGlwYWQuY29uY2F0KHN0cjJiaW5iKGRhdGEpKSwgNTEyICsgZGF0YS5sZW5ndGggKiA4KTsKICByZXR1cm4gY29yZV9zaGExKG9wYWQuY29uY2F0KGhhc2gpLCA1MTIgKyAxNjApOwp9CgovKgogKiBBZGQgaW50ZWdlcnMsIHdyYXBwaW5nIGF0IDJeMzIuIFRoaXMgdXNlcyAxNi1iaXQgb3BlcmF0aW9ucyBpbnRlcm5hbGx5CiAqIHRvIHdvcmsgYXJvdW5kIGJ1Z3MgaW4gc29tZSBKUyBpbnRlcnByZXRlcnMuCiAqLwpmdW5jdGlvbiBzYWZlX2FkZCh4LCB5KQp7CiAgdmFyIGxzdyA9ICh4ICYgMHhGRkZGKSArICh5ICYgMHhGRkZGKTsKICB2YXIgbXN3ID0gKHggPj4gMTYpICsgKHkgPj4gMTYpICsgKGxzdyA+PiAxNik7CiAgcmV0dXJuIChtc3cgPDwgMTYpIHwgKGxzdyAmIDB4RkZGRik7Cn0KCi8qCiAqIEJpdHdpc2Ugcm90YXRlIGEgMzItYml0IG51bWJlciB0byB0aGUgbGVmdC4KICovCmZ1bmN0aW9uIHJvbChudW0sIGNudCkKewogIHJldHVybiAobnVtIDw8IGNudCkgfCAobnVtID4+PiAoMzIgLSBjbnQpKTsKfQoKLyoKICogQ29udmVydCBhbiA4LWJpdCBvciAxNi1iaXQgc3RyaW5nIHRvIGFuIGFycmF5IG9mIGJpZy1lbmRpYW4gd29yZHMKICogSW4gOC1iaXQgZnVuY3Rpb24sIGNoYXJhY3RlcnMgPjI1NSBoYXZlIHRoZWlyIGhpLWJ5dGUgc2lsZW50bHkgaWdub3JlZC4KICovCmZ1bmN0aW9uIHN0cjJiaW5iKHN0cikKewogIHZhciBiaW4gPSBbXTsKICB2YXIgbWFzayA9IDI1NTsKICBmb3IgKHZhciBpID0gMDsgaSA8IHN0ci5sZW5ndGggKiA4OyBpICs9IDgpCiAgewogICAgYmluW2k+PjVdIHw9IChzdHIuY2hhckNvZGVBdChpIC8gOCkgJiBtYXNrKSA8PCAoMjQgLSBpJTMyKTsKICB9CiAgcmV0dXJuIGJpbjsKfQoKLyoKICogQ29udmVydCBhbiBhcnJheSBvZiBiaWctZW5kaWFuIHdvcmRzIHRvIGEgc3RyaW5nCiAqLwpmdW5jdGlvbiBiaW5iMnN0cihiaW4pCnsKICB2YXIgc3RyID0gIiI7CiAgdmFyIG1hc2sgPSAyNTU7CiAgZm9yICh2YXIgaSA9IDA7IGkgPCBiaW4ubGVuZ3RoICogMzI7IGkgKz0gOCkKICB7CiAgICBzdHIgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoYmluW2k+PjVdID4+PiAoMjQgLSBpJTMyKSkgJiBtYXNrKTsKICB9CiAgcmV0dXJuIHN0cjsKfQoKLyoKICogQ29udmVydCBhbiBhcnJheSBvZiBiaWctZW5kaWFuIHdvcmRzIHRvIGEgYmFzZS02NCBzdHJpbmcKICovCmZ1bmN0aW9uIGJpbmIyYjY0KGJpbmFycmF5KQp7CiAgdmFyIHRhYiA9ICJBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWmFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MDEyMzQ1Njc4OSsvIjsKICB2YXIgc3RyID0gIiI7CiAgdmFyIHRyaXBsZXQsIGo7CiAgZm9yICh2YXIgaSA9IDA7IGkgPCBiaW5hcnJheS5sZW5ndGggKiA0OyBpICs9IDMpCiAgewogICAgdHJpcGxldCA9ICgoKGJpbmFycmF5W2kgICA+PiAyXSA+PiA4ICogKDMgLSAgaSAgICU0KSkgJiAweEZGKSA8PCAxNikgfAogICAgICAgICAgICAgICgoKGJpbmFycmF5W2krMSA+PiAyXSA+PiA4ICogKDMgLSAoaSsxKSU0KSkgJiAweEZGKSA8PCA4ICkgfAogICAgICAgICAgICAgICAoKGJpbmFycmF5W2krMiA+PiAyXSA+PiA4ICogKDMgLSAoaSsyKSU0KSkgJiAweEZGKTsKICAgIGZvciAoaiA9IDA7IGogPCA0OyBqKyspCiAgICB7CiAgICAgIGlmIChpICogOCArIGogKiA2ID4gYmluYXJyYXkubGVuZ3RoICogMzIpIHsgc3RyICs9ICI9IjsgfQogICAgICBlbHNlIHsgc3RyICs9IHRhYi5jaGFyQXQoKHRyaXBsZXQgPj4gNiooMy1qKSkgJiAweDNGKTsgfQogICAgfQogIH0KICByZXR1cm4gc3RyOwp9CgovKgogKiBBIEphdmFTY3JpcHQgaW1wbGVtZW50YXRpb24gb2YgdGhlIFJTQSBEYXRhIFNlY3VyaXR5LCBJbmMuIE1ENSBNZXNzYWdlCiAqIERpZ2VzdCBBbGdvcml0aG0sIGFzIGRlZmluZWQgaW4gUkZDIDEzMjEuCiAqIFZlcnNpb24gMi4xIENvcHlyaWdodCAoQykgUGF1bCBKb2huc3RvbiAxOTk5IC0gMjAwMi4KICogT3RoZXIgY29udHJpYnV0b3JzOiBHcmVnIEhvbHQsIEFuZHJldyBLZXBlcnQsIFlkbmFyLCBMb3N0aW5ldAogKiBEaXN0cmlidXRlZCB1bmRlciB0aGUgQlNEIExpY2Vuc2UKICogU2VlIGh0dHA6Ly9wYWpob21lLm9yZy51ay9jcnlwdC9tZDUgZm9yIG1vcmUgaW5mby4KICovCgovKgogKiBFdmVyeXRoaW5nIHRoYXQgaXNuJ3QgdXNlZCBieSBTdHJvcGhlIGhhcyBiZWVuIHN0cmlwcGVkIGhlcmUhCiAqLwoKdmFyIE1ENSA9IChmdW5jdGlvbiAoKSB7CiAgICAvKgogICAgICogQWRkIGludGVnZXJzLCB3cmFwcGluZyBhdCAyXjMyLiBUaGlzIHVzZXMgMTYtYml0IG9wZXJhdGlvbnMgaW50ZXJuYWxseQogICAgICogdG8gd29yayBhcm91bmQgYnVncyBpbiBzb21lIEpTIGludGVycHJldGVycy4KICAgICAqLwogICAgdmFyIHNhZmVfYWRkID0gZnVuY3Rpb24gKHgsIHkpIHsKICAgICAgICB2YXIgbHN3ID0gKHggJiAweEZGRkYpICsgKHkgJiAweEZGRkYpOwogICAgICAgIHZhciBtc3cgPSAoeCA+PiAxNikgKyAoeSA+PiAxNikgKyAobHN3ID4+IDE2KTsKICAgICAgICByZXR1cm4gKG1zdyA8PCAxNikgfCAobHN3ICYgMHhGRkZGKTsKICAgIH07CgogICAgLyoKICAgICAqIEJpdHdpc2Ugcm90YXRlIGEgMzItYml0IG51bWJlciB0byB0aGUgbGVmdC4KICAgICAqLwogICAgdmFyIGJpdF9yb2wgPSBmdW5jdGlvbiAobnVtLCBjbnQpIHsKICAgICAgICByZXR1cm4gKG51bSA8PCBjbnQpIHwgKG51bSA+Pj4gKDMyIC0gY250KSk7CiAgICB9OwoKICAgIC8qCiAgICAgKiBDb252ZXJ0IGEgc3RyaW5nIHRvIGFuIGFycmF5IG9mIGxpdHRsZS1lbmRpYW4gd29yZHMKICAgICAqLwogICAgdmFyIHN0cjJiaW5sID0gZnVuY3Rpb24gKHN0cikgewogICAgICAgIHZhciBiaW4gPSBbXTsKICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgc3RyLmxlbmd0aCAqIDg7IGkgKz0gOCkKICAgICAgICB7CiAgICAgICAgICAgIGJpbltpPj41XSB8PSAoc3RyLmNoYXJDb2RlQXQoaSAvIDgpICYgMjU1KSA8PCAoaSUzMik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBiaW47CiAgICB9OwoKICAgIC8qCiAgICAgKiBDb252ZXJ0IGFuIGFycmF5IG9mIGxpdHRsZS1lbmRpYW4gd29yZHMgdG8gYSBzdHJpbmcKICAgICAqLwogICAgdmFyIGJpbmwyc3RyID0gZnVuY3Rpb24gKGJpbikgewogICAgICAgIHZhciBzdHIgPSAiIjsKICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgYmluLmxlbmd0aCAqIDMyOyBpICs9IDgpCiAgICAgICAgewogICAgICAgICAgICBzdHIgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoYmluW2k+PjVdID4+PiAoaSAlIDMyKSkgJiAyNTUpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gc3RyOwogICAgfTsKCiAgICAvKgogICAgICogQ29udmVydCBhbiBhcnJheSBvZiBsaXR0bGUtZW5kaWFuIHdvcmRzIHRvIGEgaGV4IHN0cmluZy4KICAgICAqLwogICAgdmFyIGJpbmwyaGV4ID0gZnVuY3Rpb24gKGJpbmFycmF5KSB7CiAgICAgICAgdmFyIGhleF90YWIgPSAiMDEyMzQ1Njc4OWFiY2RlZiI7CiAgICAgICAgdmFyIHN0ciA9ICIiOwogICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCBiaW5hcnJheS5sZW5ndGggKiA0OyBpKyspCiAgICAgICAgewogICAgICAgICAgICBzdHIgKz0gaGV4X3RhYi5jaGFyQXQoKGJpbmFycmF5W2k+PjJdID4+ICgoaSU0KSo4KzQpKSAmIDB4RikgKwogICAgICAgICAgICAgICAgaGV4X3RhYi5jaGFyQXQoKGJpbmFycmF5W2k+PjJdID4+ICgoaSU0KSo4ICApKSAmIDB4Rik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBzdHI7CiAgICB9OwoKICAgIC8qCiAgICAgKiBUaGVzZSBmdW5jdGlvbnMgaW1wbGVtZW50IHRoZSBmb3VyIGJhc2ljIG9wZXJhdGlvbnMgdGhlIGFsZ29yaXRobSB1c2VzLgogICAgICovCiAgICB2YXIgbWQ1X2NtbiA9IGZ1bmN0aW9uIChxLCBhLCBiLCB4LCBzLCB0KSB7CiAgICAgICAgcmV0dXJuIHNhZmVfYWRkKGJpdF9yb2woc2FmZV9hZGQoc2FmZV9hZGQoYSwgcSksc2FmZV9hZGQoeCwgdCkpLCBzKSxiKTsKICAgIH07CgogICAgdmFyIG1kNV9mZiA9IGZ1bmN0aW9uIChhLCBiLCBjLCBkLCB4LCBzLCB0KSB7CiAgICAgICAgcmV0dXJuIG1kNV9jbW4oKGIgJiBjKSB8ICgofmIpICYgZCksIGEsIGIsIHgsIHMsIHQpOwogICAgfTsKCiAgICB2YXIgbWQ1X2dnID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQsIHgsIHMsIHQpIHsKICAgICAgICByZXR1cm4gbWQ1X2NtbigoYiAmIGQpIHwgKGMgJiAofmQpKSwgYSwgYiwgeCwgcywgdCk7CiAgICB9OwoKICAgIHZhciBtZDVfaGggPSBmdW5jdGlvbiAoYSwgYiwgYywgZCwgeCwgcywgdCkgewogICAgICAgIHJldHVybiBtZDVfY21uKGIgXiBjIF4gZCwgYSwgYiwgeCwgcywgdCk7CiAgICB9OwoKICAgIHZhciBtZDVfaWkgPSBmdW5jdGlvbiAoYSwgYiwgYywgZCwgeCwgcywgdCkgewogICAgICAgIHJldHVybiBtZDVfY21uKGMgXiAoYiB8ICh+ZCkpLCBhLCBiLCB4LCBzLCB0KTsKICAgIH07CgogICAgLyoKICAgICAqIENhbGN1bGF0ZSB0aGUgTUQ1IG9mIGFuIGFycmF5IG9mIGxpdHRsZS1lbmRpYW4gd29yZHMsIGFuZCBhIGJpdCBsZW5ndGgKICAgICAqLwogICAgdmFyIGNvcmVfbWQ1ID0gZnVuY3Rpb24gKHgsIGxlbikgewogICAgICAgIC8qIGFwcGVuZCBwYWRkaW5nICovCiAgICAgICAgeFtsZW4gPj4gNV0gfD0gMHg4MCA8PCAoKGxlbikgJSAzMik7CiAgICAgICAgeFsoKChsZW4gKyA2NCkgPj4+IDkpIDw8IDQpICsgMTRdID0gbGVuOwoKICAgICAgICB2YXIgYSA9ICAxNzMyNTg0MTkzOwogICAgICAgIHZhciBiID0gLTI3MTczMzg3OTsKICAgICAgICB2YXIgYyA9IC0xNzMyNTg0MTk0OwogICAgICAgIHZhciBkID0gIDI3MTczMzg3ODsKCiAgICAgICAgdmFyIG9sZGEsIG9sZGIsIG9sZGMsIG9sZGQ7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB4Lmxlbmd0aDsgaSArPSAxNikKICAgICAgICB7CiAgICAgICAgICAgIG9sZGEgPSBhOwogICAgICAgICAgICBvbGRiID0gYjsKICAgICAgICAgICAgb2xkYyA9IGM7CiAgICAgICAgICAgIG9sZGQgPSBkOwoKICAgICAgICAgICAgYSA9IG1kNV9mZihhLCBiLCBjLCBkLCB4W2krIDBdLCA3ICwgLTY4MDg3NjkzNik7CiAgICAgICAgICAgIGQgPSBtZDVfZmYoZCwgYSwgYiwgYywgeFtpKyAxXSwgMTIsIC0zODk1NjQ1ODYpOwogICAgICAgICAgICBjID0gbWQ1X2ZmKGMsIGQsIGEsIGIsIHhbaSsgMl0sIDE3LCAgNjA2MTA1ODE5KTsKICAgICAgICAgICAgYiA9IG1kNV9mZihiLCBjLCBkLCBhLCB4W2krIDNdLCAyMiwgLTEwNDQ1MjUzMzApOwogICAgICAgICAgICBhID0gbWQ1X2ZmKGEsIGIsIGMsIGQsIHhbaSsgNF0sIDcgLCAtMTc2NDE4ODk3KTsKICAgICAgICAgICAgZCA9IG1kNV9mZihkLCBhLCBiLCBjLCB4W2krIDVdLCAxMiwgIDEyMDAwODA0MjYpOwogICAgICAgICAgICBjID0gbWQ1X2ZmKGMsIGQsIGEsIGIsIHhbaSsgNl0sIDE3LCAtMTQ3MzIzMTM0MSk7CiAgICAgICAgICAgIGIgPSBtZDVfZmYoYiwgYywgZCwgYSwgeFtpKyA3XSwgMjIsIC00NTcwNTk4Myk7CiAgICAgICAgICAgIGEgPSBtZDVfZmYoYSwgYiwgYywgZCwgeFtpKyA4XSwgNyAsICAxNzcwMDM1NDE2KTsKICAgICAgICAgICAgZCA9IG1kNV9mZihkLCBhLCBiLCBjLCB4W2krIDldLCAxMiwgLTE5NTg0MTQ0MTcpOwogICAgICAgICAgICBjID0gbWQ1X2ZmKGMsIGQsIGEsIGIsIHhbaSsxMF0sIDE3LCAtNDIwNjMpOwogICAgICAgICAgICBiID0gbWQ1X2ZmKGIsIGMsIGQsIGEsIHhbaSsxMV0sIDIyLCAtMTk5MDQwNDE2Mik7CiAgICAgICAgICAgIGEgPSBtZDVfZmYoYSwgYiwgYywgZCwgeFtpKzEyXSwgNyAsICAxODA0NjAzNjgyKTsKICAgICAgICAgICAgZCA9IG1kNV9mZihkLCBhLCBiLCBjLCB4W2krMTNdLCAxMiwgLTQwMzQxMTAxKTsKICAgICAgICAgICAgYyA9IG1kNV9mZihjLCBkLCBhLCBiLCB4W2krMTRdLCAxNywgLTE1MDIwMDIyOTApOwogICAgICAgICAgICBiID0gbWQ1X2ZmKGIsIGMsIGQsIGEsIHhbaSsxNV0sIDIyLCAgMTIzNjUzNTMyOSk7CgogICAgICAgICAgICBhID0gbWQ1X2dnKGEsIGIsIGMsIGQsIHhbaSsgMV0sIDUgLCAtMTY1Nzk2NTEwKTsKICAgICAgICAgICAgZCA9IG1kNV9nZyhkLCBhLCBiLCBjLCB4W2krIDZdLCA5ICwgLTEwNjk1MDE2MzIpOwogICAgICAgICAgICBjID0gbWQ1X2dnKGMsIGQsIGEsIGIsIHhbaSsxMV0sIDE0LCAgNjQzNzE3NzEzKTsKICAgICAgICAgICAgYiA9IG1kNV9nZyhiLCBjLCBkLCBhLCB4W2krIDBdLCAyMCwgLTM3Mzg5NzMwMik7CiAgICAgICAgICAgIGEgPSBtZDVfZ2coYSwgYiwgYywgZCwgeFtpKyA1XSwgNSAsIC03MDE1NTg2OTEpOwogICAgICAgICAgICBkID0gbWQ1X2dnKGQsIGEsIGIsIGMsIHhbaSsxMF0sIDkgLCAgMzgwMTYwODMpOwogICAgICAgICAgICBjID0gbWQ1X2dnKGMsIGQsIGEsIGIsIHhbaSsxNV0sIDE0LCAtNjYwNDc4MzM1KTsKICAgICAgICAgICAgYiA9IG1kNV9nZyhiLCBjLCBkLCBhLCB4W2krIDRdLCAyMCwgLTQwNTUzNzg0OCk7CiAgICAgICAgICAgIGEgPSBtZDVfZ2coYSwgYiwgYywgZCwgeFtpKyA5XSwgNSAsICA1Njg0NDY0MzgpOwogICAgICAgICAgICBkID0gbWQ1X2dnKGQsIGEsIGIsIGMsIHhbaSsxNF0sIDkgLCAtMTAxOTgwMzY5MCk7CiAgICAgICAgICAgIGMgPSBtZDVfZ2coYywgZCwgYSwgYiwgeFtpKyAzXSwgMTQsIC0xODczNjM5NjEpOwogICAgICAgICAgICBiID0gbWQ1X2dnKGIsIGMsIGQsIGEsIHhbaSsgOF0sIDIwLCAgMTE2MzUzMTUwMSk7CiAgICAgICAgICAgIGEgPSBtZDVfZ2coYSwgYiwgYywgZCwgeFtpKzEzXSwgNSAsIC0xNDQ0NjgxNDY3KTsKICAgICAgICAgICAgZCA9IG1kNV9nZyhkLCBhLCBiLCBjLCB4W2krIDJdLCA5ICwgLTUxNDAzNzg0KTsKICAgICAgICAgICAgYyA9IG1kNV9nZyhjLCBkLCBhLCBiLCB4W2krIDddLCAxNCwgIDE3MzUzMjg0NzMpOwogICAgICAgICAgICBiID0gbWQ1X2dnKGIsIGMsIGQsIGEsIHhbaSsxMl0sIDIwLCAtMTkyNjYwNzczNCk7CgogICAgICAgICAgICBhID0gbWQ1X2hoKGEsIGIsIGMsIGQsIHhbaSsgNV0sIDQgLCAtMzc4NTU4KTsKICAgICAgICAgICAgZCA9IG1kNV9oaChkLCBhLCBiLCBjLCB4W2krIDhdLCAxMSwgLTIwMjI1NzQ0NjMpOwogICAgICAgICAgICBjID0gbWQ1X2hoKGMsIGQsIGEsIGIsIHhbaSsxMV0sIDE2LCAgMTgzOTAzMDU2Mik7CiAgICAgICAgICAgIGIgPSBtZDVfaGgoYiwgYywgZCwgYSwgeFtpKzE0XSwgMjMsIC0zNTMwOTU1Nik7CiAgICAgICAgICAgIGEgPSBtZDVfaGgoYSwgYiwgYywgZCwgeFtpKyAxXSwgNCAsIC0xNTMwOTkyMDYwKTsKICAgICAgICAgICAgZCA9IG1kNV9oaChkLCBhLCBiLCBjLCB4W2krIDRdLCAxMSwgIDEyNzI4OTMzNTMpOwogICAgICAgICAgICBjID0gbWQ1X2hoKGMsIGQsIGEsIGIsIHhbaSsgN10sIDE2LCAtMTU1NDk3NjMyKTsKICAgICAgICAgICAgYiA9IG1kNV9oaChiLCBjLCBkLCBhLCB4W2krMTBdLCAyMywgLTEwOTQ3MzA2NDApOwogICAgICAgICAgICBhID0gbWQ1X2hoKGEsIGIsIGMsIGQsIHhbaSsxM10sIDQgLCAgNjgxMjc5MTc0KTsKICAgICAgICAgICAgZCA9IG1kNV9oaChkLCBhLCBiLCBjLCB4W2krIDBdLCAxMSwgLTM1ODUzNzIyMik7CiAgICAgICAgICAgIGMgPSBtZDVfaGgoYywgZCwgYSwgYiwgeFtpKyAzXSwgMTYsIC03MjI1MjE5NzkpOwogICAgICAgICAgICBiID0gbWQ1X2hoKGIsIGMsIGQsIGEsIHhbaSsgNl0sIDIzLCAgNzYwMjkxODkpOwogICAgICAgICAgICBhID0gbWQ1X2hoKGEsIGIsIGMsIGQsIHhbaSsgOV0sIDQgLCAtNjQwMzY0NDg3KTsKICAgICAgICAgICAgZCA9IG1kNV9oaChkLCBhLCBiLCBjLCB4W2krMTJdLCAxMSwgLTQyMTgxNTgzNSk7CiAgICAgICAgICAgIGMgPSBtZDVfaGgoYywgZCwgYSwgYiwgeFtpKzE1XSwgMTYsICA1MzA3NDI1MjApOwogICAgICAgICAgICBiID0gbWQ1X2hoKGIsIGMsIGQsIGEsIHhbaSsgMl0sIDIzLCAtOTk1MzM4NjUxKTsKCiAgICAgICAgICAgIGEgPSBtZDVfaWkoYSwgYiwgYywgZCwgeFtpKyAwXSwgNiAsIC0xOTg2MzA4NDQpOwogICAgICAgICAgICBkID0gbWQ1X2lpKGQsIGEsIGIsIGMsIHhbaSsgN10sIDEwLCAgMTEyNjg5MTQxNSk7CiAgICAgICAgICAgIGMgPSBtZDVfaWkoYywgZCwgYSwgYiwgeFtpKzE0XSwgMTUsIC0xNDE2MzU0OTA1KTsKICAgICAgICAgICAgYiA9IG1kNV9paShiLCBjLCBkLCBhLCB4W2krIDVdLCAyMSwgLTU3NDM0MDU1KTsKICAgICAgICAgICAgYSA9IG1kNV9paShhLCBiLCBjLCBkLCB4W2krMTJdLCA2ICwgIDE3MDA0ODU1NzEpOwogICAgICAgICAgICBkID0gbWQ1X2lpKGQsIGEsIGIsIGMsIHhbaSsgM10sIDEwLCAtMTg5NDk4NjYwNik7CiAgICAgICAgICAgIGMgPSBtZDVfaWkoYywgZCwgYSwgYiwgeFtpKzEwXSwgMTUsIC0xMDUxNTIzKTsKICAgICAgICAgICAgYiA9IG1kNV9paShiLCBjLCBkLCBhLCB4W2krIDFdLCAyMSwgLTIwNTQ5MjI3OTkpOwogICAgICAgICAgICBhID0gbWQ1X2lpKGEsIGIsIGMsIGQsIHhbaSsgOF0sIDYgLCAgMTg3MzMxMzM1OSk7CiAgICAgICAgICAgIGQgPSBtZDVfaWkoZCwgYSwgYiwgYywgeFtpKzE1XSwgMTAsIC0zMDYxMTc0NCk7CiAgICAgICAgICAgIGMgPSBtZDVfaWkoYywgZCwgYSwgYiwgeFtpKyA2XSwgMTUsIC0xNTYwMTk4MzgwKTsKICAgICAgICAgICAgYiA9IG1kNV9paShiLCBjLCBkLCBhLCB4W2krMTNdLCAyMSwgIDEzMDkxNTE2NDkpOwogICAgICAgICAgICBhID0gbWQ1X2lpKGEsIGIsIGMsIGQsIHhbaSsgNF0sIDYgLCAtMTQ1NTIzMDcwKTsKICAgICAgICAgICAgZCA9IG1kNV9paShkLCBhLCBiLCBjLCB4W2krMTFdLCAxMCwgLTExMjAyMTAzNzkpOwogICAgICAgICAgICBjID0gbWQ1X2lpKGMsIGQsIGEsIGIsIHhbaSsgMl0sIDE1LCAgNzE4Nzg3MjU5KTsKICAgICAgICAgICAgYiA9IG1kNV9paShiLCBjLCBkLCBhLCB4W2krIDldLCAyMSwgLTM0MzQ4NTU1MSk7CgogICAgICAgICAgICBhID0gc2FmZV9hZGQoYSwgb2xkYSk7CiAgICAgICAgICAgIGIgPSBzYWZlX2FkZChiLCBvbGRiKTsKICAgICAgICAgICAgYyA9IHNhZmVfYWRkKGMsIG9sZGMpOwogICAgICAgICAgICBkID0gc2FmZV9hZGQoZCwgb2xkZCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBbYSwgYiwgYywgZF07CiAgICB9OwoKCiAgICB2YXIgb2JqID0gewogICAgICAgIC8qCiAgICAgICAgICogVGhlc2UgYXJlIHRoZSBmdW5jdGlvbnMgeW91J2xsIHVzdWFsbHkgd2FudCB0byBjYWxsLgogICAgICAgICAqIFRoZXkgdGFrZSBzdHJpbmcgYXJndW1lbnRzIGFuZCByZXR1cm4gZWl0aGVyIGhleCBvciBiYXNlLTY0IGVuY29kZWQKICAgICAgICAgKiBzdHJpbmdzLgogICAgICAgICAqLwogICAgICAgIGhleGRpZ2VzdDogZnVuY3Rpb24gKHMpIHsKICAgICAgICAgICAgcmV0dXJuIGJpbmwyaGV4KGNvcmVfbWQ1KHN0cjJiaW5sKHMpLCBzLmxlbmd0aCAqIDgpKTsKICAgICAgICB9LAoKICAgICAgICBoYXNoOiBmdW5jdGlvbiAocykgewogICAgICAgICAgICByZXR1cm4gYmlubDJzdHIoY29yZV9tZDUoc3RyMmJpbmwocyksIHMubGVuZ3RoICogOCkpOwogICAgICAgIH0KICAgIH07CgogICAgcmV0dXJuIG9iajsKfSkoKTsKCi8qCiAgICBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBNSVQgbGljZW5zZS4KICAgIFBsZWFzZSBzZWUgdGhlIExJQ0VOU0UgZmlsZSBmb3IgZGV0YWlscy4KCiAgICBDb3B5cmlnaHQgMjAwNi0yMDA4LCBPR0csIExMQwoqLwoKLyoganNoaW50IHVuZGVmOiB0cnVlLCB1bnVzZWQ6IHRydWU6LCBub2FyZzogdHJ1ZSwgbGF0ZWRlZjogdHJ1ZSAqLwovKmdsb2JhbCBkb2N1bWVudCwgd2luZG93LCBzZXRUaW1lb3V0LCBjbGVhclRpbWVvdXQsIGNvbnNvbGUsCiAgICBBY3RpdmVYT2JqZWN0LCBCYXNlNjQsIE1ENSwgRE9NUGFyc2VyICovCi8vIGZyb20gc2hhMS5qcwovKmdsb2JhbCBjb3JlX2htYWNfc2hhMSwgYmluYjJzdHIsIHN0cl9obWFjX3NoYTEsIHN0cl9zaGExLCBiNjRfaG1hY19zaGExKi8KCi8qKiBGaWxlOiBzdHJvcGhlLmpzCiAqICBBIEphdmFTY3JpcHQgbGlicmFyeSBmb3IgWE1QUCBCT1NIL1hNUFAgb3ZlciBXZWJzb2NrZXQuCiAqCiAqICBUaGlzIGlzIHRoZSBKYXZhU2NyaXB0IHZlcnNpb24gb2YgdGhlIFN0cm9waGUgbGlicmFyeS4gIFNpbmNlIEphdmFTY3JpcHQKICogIGhhZCBubyBmYWNpbGl0aWVzIGZvciBwZXJzaXN0ZW50IFRDUCBjb25uZWN0aW9ucywgdGhpcyBsaWJyYXJ5IHVzZXMKICogIEJpZGlyZWN0aW9uYWwtc3RyZWFtcyBPdmVyIFN5bmNocm9ub3VzIEhUVFAgKEJPU0gpIHRvIGVtdWxhdGUKICogIGEgcGVyc2lzdGVudCwgc3RhdGVmdWwsIHR3by13YXkgY29ubmVjdGlvbiB0byBhbiBYTVBQIHNlcnZlci4gIE1vcmUKICogIGluZm9ybWF0aW9uIG9uIEJPU0ggY2FuIGJlIGZvdW5kIGluIFhFUCAxMjQuCiAqCiAqICBUaGlzIHZlcnNpb24gb2YgU3Ryb3BoZSBhbHNvIHdvcmtzIHdpdGggV2ViU29ja2V0cy4KICogIEZvciBtb3JlIGluZm9ybWF0aW9uIG9uIFhNUFAtb3ZlciBXZWJTb2NrZXQgc2VlIHRoaXMgUkZDIGRyYWZ0OgogKiAgaHR0cDovL3Rvb2xzLmlldGYub3JnL2h0bWwvZHJhZnQtaWV0Zi14bXBwLXdlYnNvY2tldC0wMAogKi8KCi8qKiBQcml2YXRlRnVuY3Rpb246IEZ1bmN0aW9uLnByb3RvdHlwZS5iaW5kCiAqICBCaW5kIGEgZnVuY3Rpb24gdG8gYW4gaW5zdGFuY2UuCiAqCiAqICBUaGlzIEZ1bmN0aW9uIG9iamVjdCBleHRlbnNpb24gbWV0aG9kIGNyZWF0ZXMgYSBib3VuZCBtZXRob2Qgc2ltaWxhcgogKiAgdG8gdGhvc2UgaW4gUHl0aG9uLiAgVGhpcyBtZWFucyB0aGF0IHRoZSAndGhpcycgb2JqZWN0IHdpbGwgcG9pbnQKICogIHRvIHRoZSBpbnN0YW5jZSB5b3Ugd2FudC4gIFNlZQogKiAgPGEgaHJlZj0naHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4vSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvRnVuY3Rpb24vYmluZCc+TURDJ3MgYmluZCgpIGRvY3VtZW50YXRpb248L2E+IGFuZAogKiAgPGEgaHJlZj0naHR0cDovL2JlbmphbWluLnNtZWRiZXJncy51cy9ibG9nLzIwMDctMDEtMDMvYm91bmQtZnVuY3Rpb25zLWFuZC1mdW5jdGlvbi1pbXBvcnRzLWluLWphdmFzY3JpcHQvJz5Cb3VuZCBGdW5jdGlvbnMgYW5kIEZ1bmN0aW9uIEltcG9ydHMgaW4gSmF2YVNjcmlwdDwvYT4KICogIGZvciBhIGNvbXBsZXRlIGV4cGxhbmF0aW9uLgogKgogKiAgVGhpcyBleHRlbnNpb24gYWxyZWFkeSBleGlzdHMgaW4gc29tZSBicm93c2VycyAobmFtZWx5LCBGaXJlZm94IDMpLCBidXQKICogIHdlIHByb3ZpZGUgaXQgdG8gc3VwcG9ydCB0aG9zZSB0aGF0IGRvbid0LgogKgogKiAgUGFyYW1ldGVyczoKICogICAgKE9iamVjdCkgb2JqIC0gVGhlIG9iamVjdCB0aGF0IHdpbGwgYmVjb21lICd0aGlzJyBpbiB0aGUgYm91bmQgZnVuY3Rpb24uCiAqICAgIChPYmplY3QpIGFyZ04gLSBBbiBvcHRpb24gYXJndW1lbnQgdGhhdCB3aWxsIGJlIHByZXBlbmRlZCB0byB0aGUKICogICAgICBhcmd1bWVudHMgZ2l2ZW4gZm9yIHRoZSBmdW5jdGlvbiBjYWxsCiAqCiAqICBSZXR1cm5zOgogKiAgICBUaGUgYm91bmQgZnVuY3Rpb24uCiAqLwppZiAoIUZ1bmN0aW9uLnByb3RvdHlwZS5iaW5kKSB7CiAgICBGdW5jdGlvbi5wcm90b3R5cGUuYmluZCA9IGZ1bmN0aW9uIChvYmogLyosIGFyZzEsIGFyZzIsIC4uLiAqLykKICAgIHsKICAgICAgICB2YXIgZnVuYyA9IHRoaXM7CiAgICAgICAgdmFyIF9zbGljZSA9IEFycmF5LnByb3RvdHlwZS5zbGljZTsKICAgICAgICB2YXIgX2NvbmNhdCA9IEFycmF5LnByb3RvdHlwZS5jb25jYXQ7CiAgICAgICAgdmFyIF9hcmdzID0gX3NsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKCiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGZ1bmMuYXBwbHkob2JqID8gb2JqIDogdGhpcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbmNhdC5jYWxsKF9hcmdzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3NsaWNlLmNhbGwoYXJndW1lbnRzLCAwKSkpOwogICAgICAgIH07CiAgICB9Owp9CgovKiogUHJpdmF0ZUZ1bmN0aW9uOiBBcnJheS5wcm90b3R5cGUuaW5kZXhPZgogKiAgUmV0dXJuIHRoZSBpbmRleCBvZiBhbiBvYmplY3QgaW4gYW4gYXJyYXkuCiAqCiAqICBUaGlzIGZ1bmN0aW9uIGlzIG5vdCBzdXBwbGllZCBieSBzb21lIEphdmFTY3JpcHQgaW1wbGVtZW50YXRpb25zLCBzbwogKiAgd2UgcHJvdmlkZSBpdCBpZiBpdCBpcyBtaXNzaW5nLiAgVGhpcyBjb2RlIGlzIGZyb206CiAqICBodHRwOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL0VuL0NvcmVfSmF2YVNjcmlwdF8xLjVfUmVmZXJlbmNlOk9iamVjdHM6QXJyYXk6aW5kZXhPZgogKgogKiAgUGFyYW1ldGVyczoKICogICAgKE9iamVjdCkgZWx0IC0gVGhlIG9iamVjdCB0byBsb29rIGZvci4KICogICAgKEludGVnZXIpIGZyb20gLSBUaGUgaW5kZXggZnJvbSB3aGljaCB0byBzdGFydCBsb29raW5nLiAob3B0aW9uYWwpLgogKgogKiAgUmV0dXJuczoKICogICAgVGhlIGluZGV4IG9mIGVsdCBpbiB0aGUgYXJyYXkgb3IgLTEgaWYgbm90IGZvdW5kLgogKi8KaWYgKCFBcnJheS5wcm90b3R5cGUuaW5kZXhPZikKewogICAgQXJyYXkucHJvdG90eXBlLmluZGV4T2YgPSBmdW5jdGlvbihlbHQgLyosIGZyb20qLykKICAgIHsKICAgICAgICB2YXIgbGVuID0gdGhpcy5sZW5ndGg7CgogICAgICAgIHZhciBmcm9tID0gTnVtYmVyKGFyZ3VtZW50c1sxXSkgfHwgMDsKICAgICAgICBmcm9tID0gKGZyb20gPCAwKSA/IE1hdGguY2VpbChmcm9tKSA6IE1hdGguZmxvb3IoZnJvbSk7CiAgICAgICAgaWYgKGZyb20gPCAwKSB7CiAgICAgICAgICAgIGZyb20gKz0gbGVuOwogICAgICAgIH0KCiAgICAgICAgZm9yICg7IGZyb20gPCBsZW47IGZyb20rKykgewogICAgICAgICAgICBpZiAoZnJvbSBpbiB0aGlzICYmIHRoaXNbZnJvbV0gPT09IGVsdCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZyb207CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiAtMTsKICAgIH07Cn0KCi8qIEFsbCBvZiB0aGUgU3Ryb3BoZSBnbG9iYWxzIGFyZSBkZWZpbmVkIGluIHRoaXMgc3BlY2lhbCBmdW5jdGlvbiBiZWxvdyBzbwogKiB0aGF0IHJlZmVyZW5jZXMgdG8gdGhlIGdsb2JhbHMgYmVjb21lIGNsb3N1cmVzLiAgVGhpcyB3aWxsIGVuc3VyZSB0aGF0CiAqIG9uIHBhZ2UgcmVsb2FkLCB0aGVzZSByZWZlcmVuY2VzIHdpbGwgc3RpbGwgYmUgYXZhaWxhYmxlIHRvIGNhbGxiYWNrcwogKiB0aGF0IGFyZSBzdGlsbCBleGVjdXRpbmcuCiAqLwoKKGZ1bmN0aW9uIChjYWxsYmFjaykgewp2YXIgU3Ryb3BoZTsKCi8qKiBGdW5jdGlvbjogJGJ1aWxkCiAqICBDcmVhdGUgYSBTdHJvcGhlLkJ1aWxkZXIuCiAqICBUaGlzIGlzIGFuIGFsaWFzIGZvciAnbmV3IFN0cm9waGUuQnVpbGRlcihuYW1lLCBhdHRycyknLgogKgogKiAgUGFyYW1ldGVyczoKICogICAgKFN0cmluZykgbmFtZSAtIFRoZSByb290IGVsZW1lbnQgbmFtZS4KICogICAgKE9iamVjdCkgYXR0cnMgLSBUaGUgYXR0cmlidXRlcyBmb3IgdGhlIHJvb3QgZWxlbWVudCBpbiBvYmplY3Qgbm90YXRpb24uCiAqCiAqICBSZXR1cm5zOgogKiAgICBBIG5ldyBTdHJvcGhlLkJ1aWxkZXIgb2JqZWN0LgogKi8KZnVuY3Rpb24gJGJ1aWxkKG5hbWUsIGF0dHJzKSB7IHJldHVybiBuZXcgU3Ryb3BoZS5CdWlsZGVyKG5hbWUsIGF0dHJzKTsgfQovKiogRnVuY3Rpb246ICRtc2cKICogIENyZWF0ZSBhIFN0cm9waGUuQnVpbGRlciB3aXRoIGEgPG1lc3NhZ2UvPiBlbGVtZW50IGFzIHRoZSByb290LgogKgogKiAgUGFybWFldGVyczoKICogICAgKE9iamVjdCkgYXR0cnMgLSBUaGUgPG1lc3NhZ2UvPiBlbGVtZW50IGF0dHJpYnV0ZXMgaW4gb2JqZWN0IG5vdGF0aW9uLgogKgogKiAgUmV0dXJuczoKICogICAgQSBuZXcgU3Ryb3BoZS5CdWlsZGVyIG9iamVjdC4KICovCmZ1bmN0aW9uICRtc2coYXR0cnMpIHsgcmV0dXJuIG5ldyBTdHJvcGhlLkJ1aWxkZXIoIm1lc3NhZ2UiLCBhdHRycyk7IH0KLyoqIEZ1bmN0aW9uOiAkaXEKICogIENyZWF0ZSBhIFN0cm9waGUuQnVpbGRlciB3aXRoIGFuIDxpcS8+IGVsZW1lbnQgYXMgdGhlIHJvb3QuCiAqCiAqICBQYXJhbWV0ZXJzOgogKiAgICAoT2JqZWN0KSBhdHRycyAtIFRoZSA8aXEvPiBlbGVtZW50IGF0dHJpYnV0ZXMgaW4gb2JqZWN0IG5vdGF0aW9uLgogKgogKiAgUmV0dXJuczoKICogICAgQSBuZXcgU3Ryb3BoZS5CdWlsZGVyIG9iamVjdC4KICovCmZ1bmN0aW9uICRpcShhdHRycykgeyByZXR1cm4gbmV3IFN0cm9waGUuQnVpbGRlcigiaXEiLCBhdHRycyk7IH0KLyoqIEZ1bmN0aW9uOiAkcHJlcwogKiAgQ3JlYXRlIGEgU3Ryb3BoZS5CdWlsZGVyIHdpdGggYSA8cHJlc2VuY2UvPiBlbGVtZW50IGFzIHRoZSByb290LgogKgogKiAgUGFyYW1ldGVyczoKICogICAgKE9iamVjdCkgYXR0cnMgLSBUaGUgPHByZXNlbmNlLz4gZWxlbWVudCBhdHRyaWJ1dGVzIGluIG9iamVjdCBub3RhdGlvbi4KICoKICogIFJldHVybnM6CiAqICAgIEEgbmV3IFN0cm9waGUuQnVpbGRlciBvYmplY3QuCiAqLwpmdW5jdGlvbiAkcHJlcyhhdHRycykgeyByZXR1cm4gbmV3IFN0cm9waGUuQnVpbGRlcigicHJlc2VuY2UiLCBhdHRycyk7IH0KCi8qKiBDbGFzczogU3Ryb3BoZQogKiAgQW4gb2JqZWN0IGNvbnRhaW5lciBmb3IgYWxsIFN0cm9waGUgbGlicmFyeSBmdW5jdGlvbnMuCiAqCiAqICBUaGlzIGNsYXNzIGlzIGp1c3QgYSBjb250YWluZXIgZm9yIGFsbCB0aGUgb2JqZWN0cyBhbmQgY29uc3RhbnRzCiAqICB1c2VkIGluIHRoZSBsaWJyYXJ5LiAgSXQgaXMgbm90IG1lYW50IHRvIGJlIGluc3RhbnRpYXRlZCwgYnV0IHRvCiAqICBwcm92aWRlIGEgbmFtZXNwYWNlIGZvciBsaWJyYXJ5IG9iamVjdHMsIGNvbnN0YW50cywgYW5kIGZ1bmN0aW9ucy4KICovClN0cm9waGUgPSB7CiAgICAvKiogQ29uc3RhbnQ6IFZFUlNJT04KICAgICAqICBUaGUgdmVyc2lvbiBvZiB0aGUgU3Ryb3BoZSBsaWJyYXJ5LiBVbnJlbGVhc2VkIGJ1aWxkcyB3aWxsIGhhdmUKICAgICAqICBhIHZlcnNpb24gb2YgaGVhZC1IQVNIIHdoZXJlIEhBU0ggaXMgYSBwYXJ0aWFsIHJldmlzaW9uLgogICAgICovCiAgICBWRVJTSU9OOiAiMS4xLjMiLAoKICAgIC8qKiBDb25zdGFudHM6IFhNUFAgTmFtZXNwYWNlIENvbnN0YW50cwogICAgICogIENvbW1vbiBuYW1lc3BhY2UgY29uc3RhbnRzIGZyb20gdGhlIFhNUFAgUkZDcyBhbmQgWEVQcy4KICAgICAqCiAgICAgKiAgTlMuSFRUUEJJTkQgLSBIVFRQIEJJTkQgbmFtZXNwYWNlIGZyb20gWEVQIDEyNC4KICAgICAqICBOUy5CT1NIIC0gQk9TSCBuYW1lc3BhY2UgZnJvbSBYRVAgMjA2LgogICAgICogIE5TLkNMSUVOVCAtIE1haW4gWE1QUCBjbGllbnQgbmFtZXNwYWNlLgogICAgICogIE5TLkFVVEggLSBMZWdhY3kgYXV0aGVudGljYXRpb24gbmFtZXNwYWNlLgogICAgICogIE5TLlJPU1RFUiAtIFJvc3RlciBvcGVyYXRpb25zIG5hbWVzcGFjZS4KICAgICAqICBOUy5QUk9GSUxFIC0gUHJvZmlsZSBuYW1lc3BhY2UuCiAgICAgKiAgTlMuRElTQ09fSU5GTyAtIFNlcnZpY2UgZGlzY292ZXJ5IGluZm8gbmFtZXNwYWNlIGZyb20gWEVQIDMwLgogICAgICogIE5TLkRJU0NPX0lURU1TIC0gU2VydmljZSBkaXNjb3ZlcnkgaXRlbXMgbmFtZXNwYWNlIGZyb20gWEVQIDMwLgogICAgICogIE5TLk1VQyAtIE11bHRpLVVzZXIgQ2hhdCBuYW1lc3BhY2UgZnJvbSBYRVAgNDUuCiAgICAgKiAgTlMuU0FTTCAtIFhNUFAgU0FTTCBuYW1lc3BhY2UgZnJvbSBSRkMgMzkyMC4KICAgICAqICBOUy5TVFJFQU0gLSBYTVBQIFN0cmVhbXMgbmFtZXNwYWNlIGZyb20gUkZDIDM5MjAuCiAgICAgKiAgTlMuQklORCAtIFhNUFAgQmluZGluZyBuYW1lc3BhY2UgZnJvbSBSRkMgMzkyMC4KICAgICAqICBOUy5TRVNTSU9OIC0gWE1QUCBTZXNzaW9uIG5hbWVzcGFjZSBmcm9tIFJGQyAzOTIwLgogICAgICogIE5TLlhIVE1MX0lNIC0gWEhUTUwtSU0gbmFtZXNwYWNlIGZyb20gWEVQIDcxLgogICAgICogIE5TLlhIVE1MIC0gWEhUTUwgYm9keSBuYW1lc3BhY2UgZnJvbSBYRVAgNzEuCiAgICAgKi8KICAgIE5TOiB7CiAgICAgICAgSFRUUEJJTkQ6ICJodHRwOi8vamFiYmVyLm9yZy9wcm90b2NvbC9odHRwYmluZCIsCiAgICAgICAgQk9TSDogInVybjp4bXBwOnhib3NoIiwKICAgICAgICBDTElFTlQ6ICJqYWJiZXI6Y2xpZW50IiwKICAgICAgICBBVVRIOiAiamFiYmVyOmlxOmF1dGgiLAogICAgICAgIFJPU1RFUjogImphYmJlcjppcTpyb3N0ZXIiLAogICAgICAgIFBST0ZJTEU6ICJqYWJiZXI6aXE6cHJvZmlsZSIsCiAgICAgICAgRElTQ09fSU5GTzogImh0dHA6Ly9qYWJiZXIub3JnL3Byb3RvY29sL2Rpc2NvI2luZm8iLAogICAgICAgIERJU0NPX0lURU1TOiAiaHR0cDovL2phYmJlci5vcmcvcHJvdG9jb2wvZGlzY28jaXRlbXMiLAogICAgICAgIE1VQzogImh0dHA6Ly9qYWJiZXIub3JnL3Byb3RvY29sL211YyIsCiAgICAgICAgU0FTTDogInVybjppZXRmOnBhcmFtczp4bWw6bnM6eG1wcC1zYXNsIiwKICAgICAgICBTVFJFQU06ICJodHRwOi8vZXRoZXJ4LmphYmJlci5vcmcvc3RyZWFtcyIsCiAgICAgICAgQklORDogInVybjppZXRmOnBhcmFtczp4bWw6bnM6eG1wcC1iaW5kIiwKICAgICAgICBTRVNTSU9OOiAidXJuOmlldGY6cGFyYW1zOnhtbDpuczp4bXBwLXNlc3Npb24iLAogICAgICAgIFZFUlNJT046ICJqYWJiZXI6aXE6dmVyc2lvbiIsCiAgICAgICAgU1RBTlpBUzogInVybjppZXRmOnBhcmFtczp4bWw6bnM6eG1wcC1zdGFuemFzIiwKICAgICAgICBYSFRNTF9JTTogImh0dHA6Ly9qYWJiZXIub3JnL3Byb3RvY29sL3hodG1sLWltIiwKICAgICAgICBYSFRNTDogImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiCiAgICB9LAoKCiAgICAvKiogQ29uc3RhbnRzOiBYSFRNTF9JTSBOYW1lc3BhY2UKICAgICAqICBjb250YWlucyBhbGxvd2VkIHRhZ3MsIHRhZyBhdHRyaWJ1dGVzLCBhbmQgY3NzIHByb3BlcnRpZXMuCiAgICAgKiAgVXNlZCBpbiB0aGUgY3JlYXRlSHRtbCBmdW5jdGlvbiB0byBmaWx0ZXIgaW5jb21pbmcgaHRtbCBpbnRvIHRoZSBhbGxvd2VkIFhIVE1MLUlNIHN1YnNldC4KICAgICAqICBTZWUgaHR0cDovL3htcHAub3JnL2V4dGVuc2lvbnMveGVwLTAwNzEuaHRtbCNwcm9maWxlLXN1bW1hcnkgZm9yIHRoZSBsaXN0IG9mIHJlY29tbWVuZGVkCiAgICAgKiAgYWxsb3dlZCB0YWdzIGFuZCB0aGVpciBhdHRyaWJ1dGVzLgogICAgICovCiAgICBYSFRNTDogewogICAgICAgICAgICAgICAgdGFnczogWydhJywnYmxvY2txdW90ZScsJ2JyJywnY2l0ZScsJ2VtJywnaW1nJywnbGknLCdvbCcsJ3AnLCdzcGFuJywnc3Ryb25nJywndWwnLCdib2R5J10sCiAgICAgICAgICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICdhJzogICAgICAgICAgWydocmVmJ10sCiAgICAgICAgICAgICAgICAgICAgICAgICdibG9ja3F1b3RlJzogWydzdHlsZSddLAogICAgICAgICAgICAgICAgICAgICAgICAnYnInOiAgICAgICAgIFtdLAogICAgICAgICAgICAgICAgICAgICAgICAnY2l0ZSc6ICAgICAgIFsnc3R5bGUnXSwKICAgICAgICAgICAgICAgICAgICAgICAgJ2VtJzogICAgICAgICBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgJ2ltZyc6ICAgICAgICBbJ3NyYycsICdhbHQnLCAnc3R5bGUnLCAnaGVpZ2h0JywgJ3dpZHRoJ10sCiAgICAgICAgICAgICAgICAgICAgICAgICdsaSc6ICAgICAgICAgWydzdHlsZSddLAogICAgICAgICAgICAgICAgICAgICAgICAnb2wnOiAgICAgICAgIFsnc3R5bGUnXSwKICAgICAgICAgICAgICAgICAgICAgICAgJ3AnOiAgICAgICAgICBbJ3N0eWxlJ10sCiAgICAgICAgICAgICAgICAgICAgICAgICdzcGFuJzogICAgICAgWydzdHlsZSddLAogICAgICAgICAgICAgICAgICAgICAgICAnc3Ryb25nJzogICAgIFtdLAogICAgICAgICAgICAgICAgICAgICAgICAndWwnOiAgICAgICAgIFsnc3R5bGUnXSwKICAgICAgICAgICAgICAgICAgICAgICAgJ2JvZHknOiAgICAgICBbXQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNzczogWydiYWNrZ3JvdW5kLWNvbG9yJywnY29sb3InLCdmb250LWZhbWlseScsJ2ZvbnQtc2l6ZScsJ2ZvbnQtc3R5bGUnLCdmb250LXdlaWdodCcsJ21hcmdpbi1sZWZ0JywnbWFyZ2luLXJpZ2h0JywndGV4dC1hbGlnbicsJ3RleHQtZGVjb3JhdGlvbiddLAogICAgICAgICAgICAgICAgdmFsaWRUYWc6IGZ1bmN0aW9uKHRhZykKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IFN0cm9waGUuWEhUTUwudGFncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHRhZyA9PSBTdHJvcGhlLlhIVE1MLnRhZ3NbaV0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgdmFsaWRBdHRyaWJ1dGU6IGZ1bmN0aW9uKHRhZywgYXR0cmlidXRlKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBpZih0eXBlb2YgU3Ryb3BoZS5YSFRNTC5hdHRyaWJ1dGVzW3RhZ10gIT09ICd1bmRlZmluZWQnICYmIFN0cm9waGUuWEhUTUwuYXR0cmlidXRlc1t0YWddLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgU3Ryb3BoZS5YSFRNTC5hdHRyaWJ1dGVzW3RhZ10ubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGF0dHJpYnV0ZSA9PSBTdHJvcGhlLlhIVE1MLmF0dHJpYnV0ZXNbdGFnXVtpXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHZhbGlkQ1NTOiBmdW5jdGlvbihzdHlsZSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IFN0cm9waGUuWEhUTUwuY3NzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoc3R5bGUgPT0gU3Ryb3BoZS5YSFRNTC5jc3NbaV0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICB9LAoKICAgIC8qKiBDb25zdGFudHM6IENvbm5lY3Rpb24gU3RhdHVzIENvbnN0YW50cwogICAgICogIENvbm5lY3Rpb24gc3RhdHVzIGNvbnN0YW50cyBmb3IgdXNlIGJ5IHRoZSBjb25uZWN0aW9uIGhhbmRsZXIKICAgICAqICBjYWxsYmFjay4KICAgICAqCiAgICAgKiAgU3RhdHVzLkVSUk9SIC0gQW4gZXJyb3IgaGFzIG9jY3VycmVkCiAgICAgKiAgU3RhdHVzLkNPTk5FQ1RJTkcgLSBUaGUgY29ubmVjdGlvbiBpcyBjdXJyZW50bHkgYmVpbmcgbWFkZQogICAgICogIFN0YXR1cy5DT05ORkFJTCAtIFRoZSBjb25uZWN0aW9uIGF0dGVtcHQgZmFpbGVkCiAgICAgKiAgU3RhdHVzLkFVVEhFTlRJQ0FUSU5HIC0gVGhlIGNvbm5lY3Rpb24gaXMgYXV0aGVudGljYXRpbmcKICAgICAqICBTdGF0dXMuQVVUSEZBSUwgLSBUaGUgYXV0aGVudGljYXRpb24gYXR0ZW1wdCBmYWlsZWQKICAgICAqICBTdGF0dXMuQ09OTkVDVEVEIC0gVGhlIGNvbm5lY3Rpb24gaGFzIHN1Y2NlZWRlZAogICAgICogIFN0YXR1cy5ESVNDT05ORUNURUQgLSBUaGUgY29ubmVjdGlvbiBoYXMgYmVlbiB0ZXJtaW5hdGVkCiAgICAgKiAgU3RhdHVzLkRJU0NPTk5FQ1RJTkcgLSBUaGUgY29ubmVjdGlvbiBpcyBjdXJyZW50bHkgYmVpbmcgdGVybWluYXRlZAogICAgICogIFN0YXR1cy5BVFRBQ0hFRCAtIFRoZSBjb25uZWN0aW9uIGhhcyBiZWVuIGF0dGFjaGVkCiAgICAgKi8KICAgIFN0YXR1czogewogICAgICAgIEVSUk9SOiAwLAogICAgICAgIENPTk5FQ1RJTkc6IDEsCiAgICAgICAgQ09OTkZBSUw6IDIsCiAgICAgICAgQVVUSEVOVElDQVRJTkc6IDMsCiAgICAgICAgQVVUSEZBSUw6IDQsCiAgICAgICAgQ09OTkVDVEVEOiA1LAogICAgICAgIERJU0NPTk5FQ1RFRDogNiwKICAgICAgICBESVNDT05ORUNUSU5HOiA3LAogICAgICAgIEFUVEFDSEVEOiA4CiAgICB9LAoKICAgIC8qKiBDb25zdGFudHM6IExvZyBMZXZlbCBDb25zdGFudHMKICAgICAqICBMb2dnaW5nIGxldmVsIGluZGljYXRvcnMuCiAgICAgKgogICAgICogIExvZ0xldmVsLkRFQlVHIC0gRGVidWcgb3V0cHV0CiAgICAgKiAgTG9nTGV2ZWwuSU5GTyAtIEluZm9ybWF0aW9uYWwgb3V0cHV0CiAgICAgKiAgTG9nTGV2ZWwuV0FSTiAtIFdhcm5pbmdzCiAgICAgKiAgTG9nTGV2ZWwuRVJST1IgLSBFcnJvcnMKICAgICAqICBMb2dMZXZlbC5GQVRBTCAtIEZhdGFsIGVycm9ycwogICAgICovCiAgICBMb2dMZXZlbDogewogICAgICAgIERFQlVHOiAwLAogICAgICAgIElORk86IDEsCiAgICAgICAgV0FSTjogMiwKICAgICAgICBFUlJPUjogMywKICAgICAgICBGQVRBTDogNAogICAgfSwKCiAgICAvKiogUHJpdmF0ZUNvbnN0YW50czogRE9NIEVsZW1lbnQgVHlwZSBDb25zdGFudHMKICAgICAqICBET00gZWxlbWVudCB0eXBlcy4KICAgICAqCiAgICAgKiAgRWxlbWVudFR5cGUuTk9STUFMIC0gTm9ybWFsIGVsZW1lbnQuCiAgICAgKiAgRWxlbWVudFR5cGUuVEVYVCAtIFRleHQgZGF0YSBlbGVtZW50LgogICAgICogIEVsZW1lbnRUeXBlLkZSQUdNRU5UIC0gWEhUTUwgZnJhZ21lbnQgZWxlbWVudC4KICAgICAqLwogICAgRWxlbWVudFR5cGU6IHsKICAgICAgICBOT1JNQUw6IDEsCiAgICAgICAgVEVYVDogMywKICAgICAgICBDREFUQTogNCwKICAgICAgICBGUkFHTUVOVDogMTEKICAgIH0sCgogICAgLyoqIFByaXZhdGVDb25zdGFudHM6IFRpbWVvdXQgVmFsdWVzCiAgICAgKiAgVGltZW91dCB2YWx1ZXMgZm9yIGVycm9yIHN0YXRlcy4gIFRoZXNlIHZhbHVlcyBhcmUgaW4gc2Vjb25kcy4KICAgICAqICBUaGVzZSBzaG91bGQgbm90IGJlIGNoYW5nZWQgdW5sZXNzIHlvdSBrbm93IGV4YWN0bHkgd2hhdCB5b3UgYXJlCiAgICAgKiAgZG9pbmcuCiAgICAgKgogICAgICogIFRJTUVPVVQgLSBUaW1lb3V0IG11bHRpcGxpZXIuIEEgd2FpdGluZyByZXF1ZXN0IHdpbGwgYmUgY29uc2lkZXJlZAogICAgICogICAgICBmYWlsZWQgYWZ0ZXIgTWF0aC5mbG9vcihUSU1FT1VUICogd2FpdCkgc2Vjb25kcyBoYXZlIGVsYXBzZWQuCiAgICAgKiAgICAgIFRoaXMgZGVmYXVsdHMgdG8gMS4xLCBhbmQgd2l0aCBkZWZhdWx0IHdhaXQsIDY2IHNlY29uZHMuCiAgICAgKiAgU0VDT05EQVJZX1RJTUVPVVQgLSBTZWNvbmRhcnkgdGltZW91dCBtdWx0aXBsaWVyLiBJbiBjYXNlcyB3aGVyZQogICAgICogICAgICBTdHJvcGhlIGNhbiBkZXRlY3QgZWFybHkgZmFpbHVyZSwgaXQgd2lsbCBjb25zaWRlciB0aGUgcmVxdWVzdAogICAgICogICAgICBmYWlsZWQgaWYgaXQgZG9lc24ndCByZXR1cm4gYWZ0ZXIKICAgICAqICAgICAgTWF0aC5mbG9vcihTRUNPTkRBUllfVElNRU9VVCAqIHdhaXQpIHNlY29uZHMgaGF2ZSBlbGFwc2VkLgogICAgICogICAgICBUaGlzIGRlZmF1bHRzIHRvIDAuMSwgYW5kIHdpdGggZGVmYXVsdCB3YWl0LCA2IHNlY29uZHMuCiAgICAgKi8KICAgIFRJTUVPVVQ6IDEuMSwKICAgIFNFQ09OREFSWV9USU1FT1VUOiAwLjEsCgogICAgLyoqIEZ1bmN0aW9uOiBhZGROYW1lc3BhY2UKICAgICAqICBUaGlzIGZ1bmN0aW9uIGlzIHVzZWQgdG8gZXh0ZW5kIHRoZSBjdXJyZW50IG5hbWVzcGFjZXMgaW4KICAgICAqICBTdHJvcGhlLk5TLiAgSXQgdGFrZXMgYSBrZXkgYW5kIGEgdmFsdWUgd2l0aCB0aGUga2V5IGJlaW5nIHRoZQogICAgICogIG5hbWUgb2YgdGhlIG5ldyBuYW1lc3BhY2UsIHdpdGggaXRzIGFjdHVhbCB2YWx1ZS4KICAgICAqICBGb3IgZXhhbXBsZToKICAgICAqICBTdHJvcGhlLmFkZE5hbWVzcGFjZSgnUFVCU1VCJywgImh0dHA6Ly9qYWJiZXIub3JnL3Byb3RvY29sL3B1YnN1YiIpOwogICAgICoKICAgICAqICBQYXJhbWV0ZXJzOgogICAgICogICAgKFN0cmluZykgbmFtZSAtIFRoZSBuYW1lIHVuZGVyIHdoaWNoIHRoZSBuYW1lc3BhY2Ugd2lsbCBiZQogICAgICogICAgICByZWZlcmVuY2VkIHVuZGVyIFN0cm9waGUuTlMKICAgICAqICAgIChTdHJpbmcpIHZhbHVlIC0gVGhlIGFjdHVhbCBuYW1lc3BhY2UuCiAgICAgKi8KICAgIGFkZE5hbWVzcGFjZTogZnVuY3Rpb24gKG5hbWUsIHZhbHVlKQogICAgewogICAgICBTdHJvcGhlLk5TW25hbWVdID0gdmFsdWU7CiAgICB9LAoKICAgIC8qKiBGdW5jdGlvbjogZm9yRWFjaENoaWxkCiAgICAgKiAgTWFwIGEgZnVuY3Rpb24gb3ZlciBzb21lIG9yIGFsbCBjaGlsZCBlbGVtZW50cyBvZiBhIGdpdmVuIGVsZW1lbnQuCiAgICAgKgogICAgICogIFRoaXMgaXMgYSBzbWFsbCBjb252ZW5pZW5jZSBmdW5jdGlvbiBmb3IgbWFwcGluZyBhIGZ1bmN0aW9uIG92ZXIKICAgICAqICBzb21lIG9yIGFsbCBvZiB0aGUgY2hpbGRyZW4gb2YgYW4gZWxlbWVudC4gIElmIGVsZW1OYW1lIGlzIG51bGwsIGFsbAogICAgICogIGNoaWxkcmVuIHdpbGwgYmUgcGFzc2VkIHRvIHRoZSBmdW5jdGlvbiwgb3RoZXJ3aXNlIG9ubHkgY2hpbGRyZW4KICAgICAqICB3aG9zZSB0YWcgbmFtZXMgbWF0Y2ggZWxlbU5hbWUgd2lsbCBiZSBwYXNzZWQuCiAgICAgKgogICAgICogIFBhcmFtZXRlcnM6CiAgICAgKiAgICAoWE1MRWxlbWVudCkgZWxlbSAtIFRoZSBlbGVtZW50IHRvIG9wZXJhdGUgb24uCiAgICAgKiAgICAoU3RyaW5nKSBlbGVtTmFtZSAtIFRoZSBjaGlsZCBlbGVtZW50IHRhZyBuYW1lIGZpbHRlci4KICAgICAqICAgIChGdW5jdGlvbikgZnVuYyAtIFRoZSBmdW5jdGlvbiB0byBhcHBseSB0byBlYWNoIGNoaWxkLiAgVGhpcwogICAgICogICAgICBmdW5jdGlvbiBzaG91bGQgdGFrZSBhIHNpbmdsZSBhcmd1bWVudCwgYSBET00gZWxlbWVudC4KICAgICAqLwogICAgZm9yRWFjaENoaWxkOiBmdW5jdGlvbiAoZWxlbSwgZWxlbU5hbWUsIGZ1bmMpCiAgICB7CiAgICAgICAgdmFyIGksIGNoaWxkTm9kZTsKCiAgICAgICAgZm9yIChpID0gMDsgaSA8IGVsZW0uY2hpbGROb2Rlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBjaGlsZE5vZGUgPSBlbGVtLmNoaWxkTm9kZXNbaV07CiAgICAgICAgICAgIGlmIChjaGlsZE5vZGUubm9kZVR5cGUgPT0gU3Ryb3BoZS5FbGVtZW50VHlwZS5OT1JNQUwgJiYKICAgICAgICAgICAgICAgICghZWxlbU5hbWUgfHwgdGhpcy5pc1RhZ0VxdWFsKGNoaWxkTm9kZSwgZWxlbU5hbWUpKSkgewogICAgICAgICAgICAgICAgZnVuYyhjaGlsZE5vZGUpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSwKCiAgICAvKiogRnVuY3Rpb246IGlzVGFnRXF1YWwKICAgICAqICBDb21wYXJlIGFuIGVsZW1lbnQncyB0YWcgbmFtZSB3aXRoIGEgc3RyaW5nLgogICAgICoKICAgICAqICBUaGlzIGZ1bmN0aW9uIGlzIGNhc2UgaW5zZW5zaXRpdmUuCiAgICAgKgogICAgICogIFBhcmFtZXRlcnM6CiAgICAgKiAgICAoWE1MRWxlbWVudCkgZWwgLSBBIERPTSBlbGVtZW50LgogICAgICogICAgKFN0cmluZykgbmFtZSAtIFRoZSBlbGVtZW50IG5hbWUuCiAgICAgKgogICAgICogIFJldHVybnM6CiAgICAgKiAgICB0cnVlIGlmIHRoZSBlbGVtZW50J3MgdGFnIG5hbWUgbWF0Y2hlcyBfZWxfLCBhbmQgZmFsc2UKICAgICAqICAgIG90aGVyd2lzZS4KICAgICAqLwogICAgaXNUYWdFcXVhbDogZnVuY3Rpb24gKGVsLCBuYW1lKQogICAgewogICAgICAgIHJldHVybiBlbC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT0gbmFtZS50b0xvd2VyQ2FzZSgpOwogICAgfSwKCiAgICAvKiogUHJpdmF0ZVZhcmlhYmxlOiBfeG1sR2VuZXJhdG9yCiAgICAgKiAgX1ByaXZhdGVfIHZhcmlhYmxlIHRoYXQgY2FjaGVzIGEgRE9NIGRvY3VtZW50IHRvCiAgICAgKiAgZ2VuZXJhdGUgZWxlbWVudHMuCiAgICAgKi8KICAgIF94bWxHZW5lcmF0b3I6IG51bGwsCgogICAgLyoqIFByaXZhdGVGdW5jdGlvbjogX21ha2VHZW5lcmF0b3IKICAgICAqICBfUHJpdmF0ZV8gZnVuY3Rpb24gdGhhdCBjcmVhdGVzIGEgZHVtbXkgWE1MIERPTSBkb2N1bWVudCB0byBzZXJ2ZSBhcwogICAgICogIGFuIGVsZW1lbnQgYW5kIHRleHQgbm9kZSBnZW5lcmF0b3IuCiAgICAgKi8KICAgIF9tYWtlR2VuZXJhdG9yOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGRvYzsKCiAgICAgICAgLy8gSUU5IGRvZXMgaW1wbGVtZW50IGNyZWF0ZURvY3VtZW50KCk7IGhvd2V2ZXIsIHVzaW5nIGl0IHdpbGwgY2F1c2UgdGhlIGJyb3dzZXIgdG8gbGVhayBtZW1vcnkgb24gcGFnZSB1bmxvYWQuCiAgICAgICAgLy8gSGVyZSwgd2UgdGVzdCBmb3IgcHJlc2VuY2Ugb2YgY3JlYXRlRG9jdW1lbnQoKSBwbHVzIElFJ3MgcHJvcHJpZXRhcnkgZG9jdW1lbnRNb2RlIGF0dHJpYnV0ZSwgd2hpY2ggd291bGQgYmUKICAgICAgICAgICAgICAgIC8vIGxlc3MgdGhhbiAxMCBpbiB0aGUgY2FzZSBvZiBJRTkgYW5kIGJlbG93LgogICAgICAgIGlmIChkb2N1bWVudC5pbXBsZW1lbnRhdGlvbi5jcmVhdGVEb2N1bWVudCA9PT0gdW5kZWZpbmVkIHx8CiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmltcGxlbWVudGF0aW9uLmNyZWF0ZURvY3VtZW50ICYmIGRvY3VtZW50LmRvY3VtZW50TW9kZSAmJiBkb2N1bWVudC5kb2N1bWVudE1vZGUgPCAxMCkgewogICAgICAgICAgICBkb2MgPSB0aGlzLl9nZXRJRVhtbERvbSgpOwogICAgICAgICAgICBkb2MuYXBwZW5kQ2hpbGQoZG9jLmNyZWF0ZUVsZW1lbnQoJ3N0cm9waGUnKSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZG9jID0gZG9jdW1lbnQuaW1wbGVtZW50YXRpb24KICAgICAgICAgICAgICAgIC5jcmVhdGVEb2N1bWVudCgnamFiYmVyOmNsaWVudCcsICdzdHJvcGhlJywgbnVsbCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZG9jOwogICAgfSwKCiAgICAvKiogRnVuY3Rpb246IHhtbEdlbmVyYXRvcgogICAgICogIEdldCB0aGUgRE9NIGRvY3VtZW50IHRvIGdlbmVyYXRlIGVsZW1lbnRzLgogICAgICoKICAgICAqICBSZXR1cm5zOgogICAgICogICAgVGhlIGN1cnJlbnRseSB1c2VkIERPTSBkb2N1bWVudC4KICAgICAqLwogICAgeG1sR2VuZXJhdG9yOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKCFTdHJvcGhlLl94bWxHZW5lcmF0b3IpIHsKICAgICAgICAgICAgU3Ryb3BoZS5feG1sR2VuZXJhdG9yID0gU3Ryb3BoZS5fbWFrZUdlbmVyYXRvcigpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gU3Ryb3BoZS5feG1sR2VuZXJhdG9yOwogICAgfSwKCiAgICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiBfZ2V0SUVYbWxEb20KICAgICAqICBHZXRzIElFIHhtbCBkb2Mgb2JqZWN0CiAgICAgKgogICAgICogIFJldHVybnM6CiAgICAgKiAgICBBIE1pY3Jvc29mdCBYTUwgRE9NIE9iamVjdAogICAgICogIFNlZSBBbHNvOgogICAgICogICAgaHR0cDovL21zZG4ubWljcm9zb2Z0LmNvbS9lbi11cy9saWJyYXJ5L21zNzU3ODM3JTI4VlMuODUlMjkuYXNweAogICAgICovCiAgICBfZ2V0SUVYbWxEb20gOiBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgZG9jID0gbnVsbDsKICAgICAgICB2YXIgZG9jU3RyaW5ncyA9IFsKICAgICAgICAgICAgIk1zeG1sMi5ET01Eb2N1bWVudC42LjAiLAogICAgICAgICAgICAiTXN4bWwyLkRPTURvY3VtZW50LjUuMCIsCiAgICAgICAgICAgICJNc3htbDIuRE9NRG9jdW1lbnQuNC4wIiwKICAgICAgICAgICAgIk1TWE1MMi5ET01Eb2N1bWVudC4zLjAiLAogICAgICAgICAgICAiTVNYTUwyLkRPTURvY3VtZW50IiwKICAgICAgICAgICAgIk1TWE1MLkRPTURvY3VtZW50IiwKICAgICAgICAgICAgIk1pY3Jvc29mdC5YTUxET00iCiAgICAgICAgXTsKCiAgICAgICAgZm9yICh2YXIgZCA9IDA7IGQgPCBkb2NTdHJpbmdzLmxlbmd0aDsgZCsrKSB7CiAgICAgICAgICAgIGlmIChkb2MgPT09IG51bGwpIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgZG9jID0gbmV3IEFjdGl2ZVhPYmplY3QoZG9jU3RyaW5nc1tkXSk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICAgICAgZG9jID0gbnVsbDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZG9jOwogICAgfSwKCiAgICAvKiogRnVuY3Rpb246IHhtbEVsZW1lbnQKICAgICAqICBDcmVhdGUgYW4gWE1MIERPTSBlbGVtZW50LgogICAgICoKICAgICAqICBUaGlzIGZ1bmN0aW9uIGNyZWF0ZXMgYW4gWE1MIERPTSBlbGVtZW50IGNvcnJlY3RseSBhY3Jvc3MgYWxsCiAgICAgKiAgaW1wbGVtZW50YXRpb25zLiBOb3RlIHRoYXQgdGhlc2UgYXJlIG5vdCBIVE1MIERPTSBlbGVtZW50cywgd2hpY2gKICAgICAqICBhcmVuJ3QgYXBwcm9wcmlhdGUgZm9yIFhNUFAgc3Rhbnphcy4KICAgICAqCiAgICAgKiAgUGFyYW1ldGVyczoKICAgICAqICAgIChTdHJpbmcpIG5hbWUgLSBUaGUgbmFtZSBmb3IgdGhlIGVsZW1lbnQuCiAgICAgKiAgICAoQXJyYXl8T2JqZWN0KSBhdHRycyAtIEFuIG9wdGlvbmFsIGFycmF5IG9yIG9iamVjdCBjb250YWluaW5nCiAgICAgKiAgICAgIGtleS92YWx1ZSBwYWlycyB0byB1c2UgYXMgZWxlbWVudCBhdHRyaWJ1dGVzLiBUaGUgb2JqZWN0IHNob3VsZAogICAgICogICAgICBiZSBpbiB0aGUgZm9ybWF0IHsna2V5JzogJ3ZhbHVlJ30gb3Ige2tleTogJ3ZhbHVlJ30uIFRoZSBhcnJheQogICAgICogICAgICBzaG91bGQgaGF2ZSB0aGUgZm9ybWF0IFtbJ2tleTEnLCAndmFsdWUxJ10sIFsna2V5MicsICd2YWx1ZTInXV0uCiAgICAgKiAgICAoU3RyaW5nKSB0ZXh0IC0gVGhlIHRleHQgY2hpbGQgZGF0YSBmb3IgdGhlIGVsZW1lbnQuCiAgICAgKgogICAgICogIFJldHVybnM6CiAgICAgKiAgICBBIG5ldyBYTUwgRE9NIGVsZW1lbnQuCiAgICAgKi8KICAgIHhtbEVsZW1lbnQ6IGZ1bmN0aW9uIChuYW1lKQogICAgewogICAgICAgIGlmICghbmFtZSkgeyByZXR1cm4gbnVsbDsgfQoKICAgICAgICB2YXIgbm9kZSA9IFN0cm9waGUueG1sR2VuZXJhdG9yKCkuY3JlYXRlRWxlbWVudChuYW1lKTsKCiAgICAgICAgLy8gRklYTUU6IHRoaXMgc2hvdWxkIHRocm93IGVycm9ycyBpZiBhcmdzIGFyZSB0aGUgd3JvbmcgdHlwZSBvcgogICAgICAgIC8vIHRoZXJlIGFyZSBtb3JlIHRoYW4gdHdvIG9wdGlvbmFsIGFyZ3MKICAgICAgICB2YXIgYSwgaSwgazsKICAgICAgICBmb3IgKGEgPSAxOyBhIDwgYXJndW1lbnRzLmxlbmd0aDsgYSsrKSB7CiAgICAgICAgICAgIGlmICghYXJndW1lbnRzW2FdKSB7IGNvbnRpbnVlOyB9CiAgICAgICAgICAgIGlmICh0eXBlb2YoYXJndW1lbnRzW2FdKSA9PSAic3RyaW5nIiB8fAogICAgICAgICAgICAgICAgdHlwZW9mKGFyZ3VtZW50c1thXSkgPT0gIm51bWJlciIpIHsKICAgICAgICAgICAgICAgIG5vZGUuYXBwZW5kQ2hpbGQoU3Ryb3BoZS54bWxUZXh0Tm9kZShhcmd1bWVudHNbYV0pKTsKICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YoYXJndW1lbnRzW2FdKSA9PSAib2JqZWN0IiAmJgogICAgICAgICAgICAgICAgICAgICAgIHR5cGVvZihhcmd1bWVudHNbYV0uc29ydCkgPT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGFyZ3VtZW50c1thXS5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YoYXJndW1lbnRzW2FdW2ldKSA9PSAib2JqZWN0IiAmJgogICAgICAgICAgICAgICAgICAgICAgICB0eXBlb2YoYXJndW1lbnRzW2FdW2ldLnNvcnQpID09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbm9kZS5zZXRBdHRyaWJ1dGUoYXJndW1lbnRzW2FdW2ldWzBdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmd1bWVudHNbYV1baV1bMV0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YoYXJndW1lbnRzW2FdKSA9PSAib2JqZWN0IikgewogICAgICAgICAgICAgICAgZm9yIChrIGluIGFyZ3VtZW50c1thXSkgewogICAgICAgICAgICAgICAgICAgIGlmIChhcmd1bWVudHNbYV0uaGFzT3duUHJvcGVydHkoaykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbm9kZS5zZXRBdHRyaWJ1dGUoaywgYXJndW1lbnRzW2FdW2tdKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBub2RlOwogICAgfSwKCiAgICAvKiAgRnVuY3Rpb246IHhtbGVzY2FwZQogICAgICogIEV4Y2FwZXMgaW52YWxpZCB4bWwgY2hhcmFjdGVycy4KICAgICAqCiAgICAgKiAgUGFyYW1ldGVyczoKICAgICAqICAgICAoU3RyaW5nKSB0ZXh0IC0gdGV4dCB0byBlc2NhcGUuCiAgICAgKgogICAgICogIFJldHVybnM6CiAgICAgKiAgICAgIEVzY2FwZWQgdGV4dC4KICAgICAqLwogICAgeG1sZXNjYXBlOiBmdW5jdGlvbih0ZXh0KQogICAgewogICAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoL1wmL2csICImYW1wOyIpOwogICAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoLzwvZywgICImbHQ7Iik7CiAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZSgvPi9nLCAgIiZndDsiKTsKICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC8nL2csICAiJmFwb3M7Iik7CiAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZSgvIi9nLCAgIiZxdW90OyIpOwogICAgICAgIHJldHVybiB0ZXh0OwogICAgfSwKCiAgICAvKiogRnVuY3Rpb246IHhtbFRleHROb2RlCiAgICAgKiAgQ3JlYXRlcyBhbiBYTUwgRE9NIHRleHQgbm9kZS4KICAgICAqCiAgICAgKiAgUHJvdmlkZXMgYSBjcm9zcyBpbXBsZW1lbnRhdGlvbiB2ZXJzaW9uIG9mIGRvY3VtZW50LmNyZWF0ZVRleHROb2RlLgogICAgICoKICAgICAqICBQYXJhbWV0ZXJzOgogICAgICogICAgKFN0cmluZykgdGV4dCAtIFRoZSBjb250ZW50IG9mIHRoZSB0ZXh0IG5vZGUuCiAgICAgKgogICAgICogIFJldHVybnM6CiAgICAgKiAgICBBIG5ldyBYTUwgRE9NIHRleHQgbm9kZS4KICAgICAqLwogICAgeG1sVGV4dE5vZGU6IGZ1bmN0aW9uICh0ZXh0KQogICAgewogICAgICAgIHJldHVybiBTdHJvcGhlLnhtbEdlbmVyYXRvcigpLmNyZWF0ZVRleHROb2RlKHRleHQpOwogICAgfSwKCiAgICAvKiogRnVuY3Rpb246IHhtbEh0bWxOb2RlCiAgICAgKiAgQ3JlYXRlcyBhbiBYTUwgRE9NIGh0bWwgbm9kZS4KICAgICAqCiAgICAgKiAgUGFyYW1ldGVyczoKICAgICAqICAgIChTdHJpbmcpIGh0bWwgLSBUaGUgY29udGVudCBvZiB0aGUgaHRtbCBub2RlLgogICAgICoKICAgICAqICBSZXR1cm5zOgogICAgICogICAgQSBuZXcgWE1MIERPTSB0ZXh0IG5vZGUuCiAgICAgKi8KICAgIHhtbEh0bWxOb2RlOiBmdW5jdGlvbiAoaHRtbCkKICAgIHsKICAgICAgICB2YXIgbm9kZTsKICAgICAgICAvL2Vuc3VyZSB0ZXh0IGlzIGVzY2FwZWQKICAgICAgICBpZiAod2luZG93LkRPTVBhcnNlcikgewogICAgICAgICAgICB2YXIgcGFyc2VyID0gbmV3IERPTVBhcnNlcigpOwogICAgICAgICAgICBub2RlID0gcGFyc2VyLnBhcnNlRnJvbVN0cmluZyhodG1sLCAidGV4dC94bWwiKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBub2RlID0gbmV3IEFjdGl2ZVhPYmplY3QoIk1pY3Jvc29mdC5YTUxET00iKTsKICAgICAgICAgICAgbm9kZS5hc3luYz0iZmFsc2UiOwogICAgICAgICAgICBub2RlLmxvYWRYTUwoaHRtbCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBub2RlOwogICAgfSwKCiAgICAvKiogRnVuY3Rpb246IGdldFRleHQKICAgICAqICBHZXQgdGhlIGNvbmNhdGVuYXRpb24gb2YgYWxsIHRleHQgY2hpbGRyZW4gb2YgYW4gZWxlbWVudC4KICAgICAqCiAgICAgKiAgUGFyYW1ldGVyczoKICAgICAqICAgIChYTUxFbGVtZW50KSBlbGVtIC0gQSBET00gZWxlbWVudC4KICAgICAqCiAgICAgKiAgUmV0dXJuczoKICAgICAqICAgIEEgU3RyaW5nIHdpdGggdGhlIGNvbmNhdGVuYXRlZCB0ZXh0IG9mIGFsbCB0ZXh0IGVsZW1lbnQgY2hpbGRyZW4uCiAgICAgKi8KICAgIGdldFRleHQ6IGZ1bmN0aW9uIChlbGVtKQogICAgewogICAgICAgIGlmICghZWxlbSkgeyByZXR1cm4gbnVsbDsgfQoKICAgICAgICB2YXIgc3RyID0gIiI7CiAgICAgICAgaWYgKGVsZW0uY2hpbGROb2Rlcy5sZW5ndGggPT09IDAgJiYgZWxlbS5ub2RlVHlwZSA9PQogICAgICAgICAgICBTdHJvcGhlLkVsZW1lbnRUeXBlLlRFWFQpIHsKICAgICAgICAgICAgc3RyICs9IGVsZW0ubm9kZVZhbHVlOwogICAgICAgIH0KCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlbGVtLmNoaWxkTm9kZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKGVsZW0uY2hpbGROb2Rlc1tpXS5ub2RlVHlwZSA9PSBTdHJvcGhlLkVsZW1lbnRUeXBlLlRFWFQpIHsKICAgICAgICAgICAgICAgIHN0ciArPSBlbGVtLmNoaWxkTm9kZXNbaV0ubm9kZVZhbHVlOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gU3Ryb3BoZS54bWxlc2NhcGUoc3RyKTsKICAgIH0sCgogICAgLyoqIEZ1bmN0aW9uOiBjb3B5RWxlbWVudAogICAgICogIENvcHkgYW4gWE1MIERPTSBlbGVtZW50LgogICAgICoKICAgICAqICBUaGlzIGZ1bmN0aW9uIGNvcGllcyBhIERPTSBlbGVtZW50IGFuZCBhbGwgaXRzIGRlc2NlbmRhbnRzIGFuZCByZXR1cm5zCiAgICAgKiAgdGhlIG5ldyBjb3B5LgogICAgICoKICAgICAqICBQYXJhbWV0ZXJzOgogICAgICogICAgKFhNTEVsZW1lbnQpIGVsZW0gLSBBIERPTSBlbGVtZW50LgogICAgICoKICAgICAqICBSZXR1cm5zOgogICAgICogICAgQSBuZXcsIGNvcGllZCBET00gZWxlbWVudCB0cmVlLgogICAgICovCiAgICBjb3B5RWxlbWVudDogZnVuY3Rpb24gKGVsZW0pCiAgICB7CiAgICAgICAgdmFyIGksIGVsOwogICAgICAgIGlmIChlbGVtLm5vZGVUeXBlID09IFN0cm9waGUuRWxlbWVudFR5cGUuTk9STUFMKSB7CiAgICAgICAgICAgIGVsID0gU3Ryb3BoZS54bWxFbGVtZW50KGVsZW0udGFnTmFtZSk7CgogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgZWxlbS5hdHRyaWJ1dGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBlbC5zZXRBdHRyaWJ1dGUoZWxlbS5hdHRyaWJ1dGVzW2ldLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbS5hdHRyaWJ1dGVzW2ldLnZhbHVlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGVsZW0uY2hpbGROb2Rlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgZWwuYXBwZW5kQ2hpbGQoU3Ryb3BoZS5jb3B5RWxlbWVudChlbGVtLmNoaWxkTm9kZXNbaV0pKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoZWxlbS5ub2RlVHlwZSA9PSBTdHJvcGhlLkVsZW1lbnRUeXBlLlRFWFQpIHsKICAgICAgICAgICAgZWwgPSBTdHJvcGhlLnhtbEdlbmVyYXRvcigpLmNyZWF0ZVRleHROb2RlKGVsZW0ubm9kZVZhbHVlKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBlbDsKICAgIH0sCgoKICAgIC8qKiBGdW5jdGlvbjogY3JlYXRlSHRtbAogICAgICogIENvcHkgYW4gSFRNTCBET00gZWxlbWVudCBpbnRvIGFuIFhNTCBET00uCiAgICAgKgogICAgICogIFRoaXMgZnVuY3Rpb24gY29waWVzIGEgRE9NIGVsZW1lbnQgYW5kIGFsbCBpdHMgZGVzY2VuZGFudHMgYW5kIHJldHVybnMKICAgICAqICB0aGUgbmV3IGNvcHkuCiAgICAgKgogICAgICogIFBhcmFtZXRlcnM6CiAgICAgKiAgICAoSFRNTEVsZW1lbnQpIGVsZW0gLSBBIERPTSBlbGVtZW50LgogICAgICoKICAgICAqICBSZXR1cm5zOgogICAgICogICAgQSBuZXcsIGNvcGllZCBET00gZWxlbWVudCB0cmVlLgogICAgICovCiAgICBjcmVhdGVIdG1sOiBmdW5jdGlvbiAoZWxlbSkKICAgIHsKICAgICAgICB2YXIgaSwgZWwsIGosIHRhZywgYXR0cmlidXRlLCB2YWx1ZSwgY3NzLCBjc3NBdHRycywgYXR0ciwgY3NzTmFtZSwgY3NzVmFsdWU7CiAgICAgICAgaWYgKGVsZW0ubm9kZVR5cGUgPT0gU3Ryb3BoZS5FbGVtZW50VHlwZS5OT1JNQUwpIHsKICAgICAgICAgICAgdGFnID0gZWxlbS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICBpZihTdHJvcGhlLlhIVE1MLnZhbGlkVGFnKHRhZykpIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgZWwgPSBTdHJvcGhlLnhtbEVsZW1lbnQodGFnKTsKICAgICAgICAgICAgICAgICAgICBmb3IoaSA9IDA7IGkgPCBTdHJvcGhlLlhIVE1MLmF0dHJpYnV0ZXNbdGFnXS5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGUgPSBTdHJvcGhlLlhIVE1MLmF0dHJpYnV0ZXNbdGFnXVtpXTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBlbGVtLmdldEF0dHJpYnV0ZShhdHRyaWJ1dGUpOwogICAgICAgICAgICAgICAgICAgICAgICBpZih0eXBlb2YgdmFsdWUgPT0gJ3VuZGVmaW5lZCcgfHwgdmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09ICcnIHx8IHZhbHVlID09PSBmYWxzZSB8fCB2YWx1ZSA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgaWYoYXR0cmlidXRlID09ICdzdHlsZScgJiYgdHlwZW9mIHZhbHVlID09ICdvYmplY3QnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZih0eXBlb2YgdmFsdWUuY3NzVGV4dCAhPSAndW5kZWZpbmVkJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gdmFsdWUuY3NzVGV4dDsgLy8gd2UncmUgZGVhbGluZyB3aXRoIElFLCBuZWVkIHRvIGdldCBDU1Mgb3V0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gZmlsdGVyIG91dCBpbnZhbGlkIGNzcyBzdHlsZXMKICAgICAgICAgICAgICAgICAgICAgICAgaWYoYXR0cmlidXRlID09ICdzdHlsZScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNzcyA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3NzQXR0cnMgPSB2YWx1ZS5zcGxpdCgnOycpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yKGogPSAwOyBqIDwgY3NzQXR0cnMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRyID0gY3NzQXR0cnNbal0uc3BsaXQoJzonKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjc3NOYW1lID0gYXR0clswXS5yZXBsYWNlKC9eXHMqLywgIiIpLnJlcGxhY2UoL1xzKiQvLCAiIikudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihTdHJvcGhlLlhIVE1MLnZhbGlkQ1NTKGNzc05hbWUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNzc1ZhbHVlID0gYXR0clsxXS5yZXBsYWNlKC9eXHMqLywgIiIpLnJlcGxhY2UoL1xzKiQvLCAiIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNzcy5wdXNoKGNzc05hbWUgKyAnOiAnICsgY3NzVmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGNzcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBjc3Muam9pbignOyAnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbC5zZXRBdHRyaWJ1dGUoYXR0cmlidXRlLCB2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbC5zZXRBdHRyaWJ1dGUoYXR0cmlidXRlLCB2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBlbGVtLmNoaWxkTm9kZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgZWwuYXBwZW5kQ2hpbGQoU3Ryb3BoZS5jcmVhdGVIdG1sKGVsZW0uY2hpbGROb2Rlc1tpXSkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gY2F0Y2goZSkgeyAvLyBpbnZhbGlkIGVsZW1lbnRzCiAgICAgICAgICAgICAgICAgIGVsID0gU3Ryb3BoZS54bWxUZXh0Tm9kZSgnJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBlbCA9IFN0cm9waGUueG1sR2VuZXJhdG9yKCkuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpOwogICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGVsZW0uY2hpbGROb2Rlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgIGVsLmFwcGVuZENoaWxkKFN0cm9waGUuY3JlYXRlSHRtbChlbGVtLmNoaWxkTm9kZXNbaV0pKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoZWxlbS5ub2RlVHlwZSA9PSBTdHJvcGhlLkVsZW1lbnRUeXBlLkZSQUdNRU5UKSB7CiAgICAgICAgICAgIGVsID0gU3Ryb3BoZS54bWxHZW5lcmF0b3IoKS5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7CiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBlbGVtLmNoaWxkTm9kZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGVsLmFwcGVuZENoaWxkKFN0cm9waGUuY3JlYXRlSHRtbChlbGVtLmNoaWxkTm9kZXNbaV0pKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoZWxlbS5ub2RlVHlwZSA9PSBTdHJvcGhlLkVsZW1lbnRUeXBlLlRFWFQpIHsKICAgICAgICAgICAgZWwgPSBTdHJvcGhlLnhtbFRleHROb2RlKGVsZW0ubm9kZVZhbHVlKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBlbDsKICAgIH0sCgogICAgLyoqIEZ1bmN0aW9uOiBlc2NhcGVOb2RlCiAgICAgKiAgRXNjYXBlIHRoZSBub2RlIHBhcnQgKGFsc28gY2FsbGVkIGxvY2FsIHBhcnQpIG9mIGEgSklELgogICAgICoKICAgICAqICBQYXJhbWV0ZXJzOgogICAgICogICAgKFN0cmluZykgbm9kZSAtIEEgbm9kZSAob3IgbG9jYWwgcGFydCkuCiAgICAgKgogICAgICogIFJldHVybnM6CiAgICAgKiAgICBBbiBlc2NhcGVkIG5vZGUgKG9yIGxvY2FsIHBhcnQpLgogICAgICovCiAgICBlc2NhcGVOb2RlOiBmdW5jdGlvbiAobm9kZSkKICAgIHsKICAgICAgICByZXR1cm4gbm9kZS5yZXBsYWNlKC9eXHMrfFxzKyQvZywgJycpCiAgICAgICAgICAgIC5yZXBsYWNlKC9cXC9nLCAgIlxcNWMiKQogICAgICAgICAgICAucmVwbGFjZSgvIC9nLCAgICJcXDIwIikKICAgICAgICAgICAgLnJlcGxhY2UoL1wiL2csICAiXFwyMiIpCiAgICAgICAgICAgIC5yZXBsYWNlKC9cJi9nLCAgIlxcMjYiKQogICAgICAgICAgICAucmVwbGFjZSgvXCcvZywgICJcXDI3IikKICAgICAgICAgICAgLnJlcGxhY2UoL1wvL2csICAiXFwyZiIpCiAgICAgICAgICAgIC5yZXBsYWNlKC86L2csICAgIlxcM2EiKQogICAgICAgICAgICAucmVwbGFjZSgvPC9nLCAgICJcXDNjIikKICAgICAgICAgICAgLnJlcGxhY2UoLz4vZywgICAiXFwzZSIpCiAgICAgICAgICAgIC5yZXBsYWNlKC9AL2csICAgIlxcNDAiKTsKICAgIH0sCgogICAgLyoqIEZ1bmN0aW9uOiB1bmVzY2FwZU5vZGUKICAgICAqICBVbmVzY2FwZSBhIG5vZGUgcGFydCAoYWxzbyBjYWxsZWQgbG9jYWwgcGFydCkgb2YgYSBKSUQuCiAgICAgKgogICAgICogIFBhcmFtZXRlcnM6CiAgICAgKiAgICAoU3RyaW5nKSBub2RlIC0gQSBub2RlIChvciBsb2NhbCBwYXJ0KS4KICAgICAqCiAgICAgKiAgUmV0dXJuczoKICAgICAqICAgIEFuIHVuZXNjYXBlZCBub2RlIChvciBsb2NhbCBwYXJ0KS4KICAgICAqLwogICAgdW5lc2NhcGVOb2RlOiBmdW5jdGlvbiAobm9kZSkKICAgIHsKICAgICAgICByZXR1cm4gbm9kZS5yZXBsYWNlKC9cXDIwL2csICIgIikKICAgICAgICAgICAgLnJlcGxhY2UoL1xcMjIvZywgJyInKQogICAgICAgICAgICAucmVwbGFjZSgvXFwyNi9nLCAiJiIpCiAgICAgICAgICAgIC5yZXBsYWNlKC9cXDI3L2csICInIikKICAgICAgICAgICAgLnJlcGxhY2UoL1xcMmYvZywgIi8iKQogICAgICAgICAgICAucmVwbGFjZSgvXFwzYS9nLCAiOiIpCiAgICAgICAgICAgIC5yZXBsYWNlKC9cXDNjL2csICI8IikKICAgICAgICAgICAgLnJlcGxhY2UoL1xcM2UvZywgIj4iKQogICAgICAgICAgICAucmVwbGFjZSgvXFw0MC9nLCAiQCIpCiAgICAgICAgICAgIC5yZXBsYWNlKC9cXDVjL2csICJcXCIpOwogICAgfSwKCiAgICAvKiogRnVuY3Rpb246IGdldE5vZGVGcm9tSmlkCiAgICAgKiAgR2V0IHRoZSBub2RlIHBvcnRpb24gb2YgYSBKSUQgU3RyaW5nLgogICAgICoKICAgICAqICBQYXJhbWV0ZXJzOgogICAgICogICAgKFN0cmluZykgamlkIC0gQSBKSUQuCiAgICAgKgogICAgICogIFJldHVybnM6CiAgICAgKiAgICBBIFN0cmluZyBjb250YWluaW5nIHRoZSBub2RlLgogICAgICovCiAgICBnZXROb2RlRnJvbUppZDogZnVuY3Rpb24gKGppZCkKICAgIHsKICAgICAgICBpZiAoamlkLmluZGV4T2YoIkAiKSA8IDApIHsgcmV0dXJuIG51bGw7IH0KICAgICAgICByZXR1cm4gamlkLnNwbGl0KCJAIilbMF07CiAgICB9LAoKICAgIC8qKiBGdW5jdGlvbjogZ2V0RG9tYWluRnJvbUppZAogICAgICogIEdldCB0aGUgZG9tYWluIHBvcnRpb24gb2YgYSBKSUQgU3RyaW5nLgogICAgICoKICAgICAqICBQYXJhbWV0ZXJzOgogICAgICogICAgKFN0cmluZykgamlkIC0gQSBKSUQuCiAgICAgKgogICAgICogIFJldHVybnM6CiAgICAgKiAgICBBIFN0cmluZyBjb250YWluaW5nIHRoZSBkb21haW4uCiAgICAgKi8KICAgIGdldERvbWFpbkZyb21KaWQ6IGZ1bmN0aW9uIChqaWQpCiAgICB7CiAgICAgICAgdmFyIGJhcmUgPSBTdHJvcGhlLmdldEJhcmVKaWRGcm9tSmlkKGppZCk7CiAgICAgICAgaWYgKGJhcmUuaW5kZXhPZigiQCIpIDwgMCkgewogICAgICAgICAgICByZXR1cm4gYmFyZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2YXIgcGFydHMgPSBiYXJlLnNwbGl0KCJAIik7CiAgICAgICAgICAgIHBhcnRzLnNwbGljZSgwLCAxKTsKICAgICAgICAgICAgcmV0dXJuIHBhcnRzLmpvaW4oJ0AnKTsKICAgICAgICB9CiAgICB9LAoKICAgIC8qKiBGdW5jdGlvbjogZ2V0UmVzb3VyY2VGcm9tSmlkCiAgICAgKiAgR2V0IHRoZSByZXNvdXJjZSBwb3J0aW9uIG9mIGEgSklEIFN0cmluZy4KICAgICAqCiAgICAgKiAgUGFyYW1ldGVyczoKICAgICAqICAgIChTdHJpbmcpIGppZCAtIEEgSklELgogICAgICoKICAgICAqICBSZXR1cm5zOgogICAgICogICAgQSBTdHJpbmcgY29udGFpbmluZyB0aGUgcmVzb3VyY2UuCiAgICAgKi8KICAgIGdldFJlc291cmNlRnJvbUppZDogZnVuY3Rpb24gKGppZCkKICAgIHsKICAgICAgICB2YXIgcyA9IGppZC5zcGxpdCgiLyIpOwogICAgICAgIGlmIChzLmxlbmd0aCA8IDIpIHsgcmV0dXJuIG51bGw7IH0KICAgICAgICBzLnNwbGljZSgwLCAxKTsKICAgICAgICByZXR1cm4gcy5qb2luKCcvJyk7CiAgICB9LAoKICAgIC8qKiBGdW5jdGlvbjogZ2V0QmFyZUppZEZyb21KaWQKICAgICAqICBHZXQgdGhlIGJhcmUgSklEIGZyb20gYSBKSUQgU3RyaW5nLgogICAgICoKICAgICAqICBQYXJhbWV0ZXJzOgogICAgICogICAgKFN0cmluZykgamlkIC0gQSBKSUQuCiAgICAgKgogICAgICogIFJldHVybnM6CiAgICAgKiAgICBBIFN0cmluZyBjb250YWluaW5nIHRoZSBiYXJlIEpJRC4KICAgICAqLwogICAgZ2V0QmFyZUppZEZyb21KaWQ6IGZ1bmN0aW9uIChqaWQpCiAgICB7CiAgICAgICAgcmV0dXJuIGppZCA/IGppZC5zcGxpdCgiLyIpWzBdIDogbnVsbDsKICAgIH0sCgogICAgLyoqIEZ1bmN0aW9uOiBsb2cKICAgICAqICBVc2VyIG92ZXJyaWRlYWJsZSBsb2dnaW5nIGZ1bmN0aW9uLgogICAgICoKICAgICAqICBUaGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCB3aGVuZXZlciB0aGUgU3Ryb3BoZSBsaWJyYXJ5IGNhbGxzIGFueQogICAgICogIG9mIHRoZSBsb2dnaW5nIGZ1bmN0aW9ucy4gIFRoZSBkZWZhdWx0IGltcGxlbWVudGF0aW9uIG9mIHRoaXMKICAgICAqICBmdW5jdGlvbiBkb2VzIG5vdGhpbmcuICBJZiBjbGllbnQgY29kZSB3aXNoZXMgdG8gaGFuZGxlIHRoZSBsb2dnaW5nCiAgICAgKiAgbWVzc2FnZXMsIGl0IHNob3VsZCBvdmVycmlkZSB0aGlzIHdpdGgKICAgICAqICA+IFN0cm9waGUubG9nID0gZnVuY3Rpb24gKGxldmVsLCBtc2cpIHsKICAgICAqICA+ICAgKHVzZXIgY29kZSBoZXJlKQogICAgICogID4gfTsKICAgICAqCiAgICAgKiAgUGxlYXNlIG5vdGUgdGhhdCBkYXRhIHNlbnQgYW5kIHJlY2VpdmVkIG92ZXIgdGhlIHdpcmUgaXMgbG9nZ2VkCiAgICAgKiAgdmlhIFN0cm9waGUuQ29ubmVjdGlvbi5yYXdJbnB1dCgpIGFuZCBTdHJvcGhlLkNvbm5lY3Rpb24ucmF3T3V0cHV0KCkuCiAgICAgKgogICAgICogIFRoZSBkaWZmZXJlbnQgbGV2ZWxzIGFuZCB0aGVpciBtZWFuaW5ncyBhcmUKICAgICAqCiAgICAgKiAgICBERUJVRyAtIE1lc3NhZ2VzIHVzZWZ1bCBmb3IgZGVidWdnaW5nIHB1cnBvc2VzLgogICAgICogICAgSU5GTyAtIEluZm9ybWF0aW9uYWwgbWVzc2FnZXMuICBUaGlzIGlzIG1vc3RseSBpbmZvcm1hdGlvbiBsaWtlCiAgICAgKiAgICAgICdkaXNjb25uZWN0IHdhcyBjYWxsZWQnIG9yICdTQVNMIGF1dGggc3VjY2VlZGVkJy4KICAgICAqICAgIFdBUk4gLSBXYXJuaW5ncyBhYm91dCBwb3RlbnRpYWwgcHJvYmxlbXMuICBUaGlzIGlzIG1vc3RseSB1c2VkCiAgICAgKiAgICAgIHRvIHJlcG9ydCB0cmFuc2llbnQgY29ubmVjdGlvbiBlcnJvcnMgbGlrZSByZXF1ZXN0IHRpbWVvdXRzLgogICAgICogICAgRVJST1IgLSBTb21lIGVycm9yIG9jY3VycmVkLgogICAgICogICAgRkFUQUwgLSBBIG5vbi1yZWNvdmVyYWJsZSBmYXRhbCBlcnJvciBvY2N1cnJlZC4KICAgICAqCiAgICAgKiAgUGFyYW1ldGVyczoKICAgICAqICAgIChJbnRlZ2VyKSBsZXZlbCAtIFRoZSBsb2cgbGV2ZWwgb2YgdGhlIGxvZyBtZXNzYWdlLiAgVGhpcyB3aWxsCiAgICAgKiAgICAgIGJlIG9uZSBvZiB0aGUgdmFsdWVzIGluIFN0cm9waGUuTG9nTGV2ZWwuCiAgICAgKiAgICAoU3RyaW5nKSBtc2cgLSBUaGUgbG9nIG1lc3NhZ2UuCiAgICAgKi8KICAgIC8qIGpzaGludCBpZ25vcmU6c3RhcnQgKi8KICAgIGxvZzogZnVuY3Rpb24gKGxldmVsLCBtc2cpCiAgICB7CiAgICAgICAgcmV0dXJuOwogICAgfSwKICAgIC8qIGpzaGludCBpZ25vcmU6ZW5kICovCgogICAgLyoqIEZ1bmN0aW9uOiBkZWJ1ZwogICAgICogIExvZyBhIG1lc3NhZ2UgYXQgdGhlIFN0cm9waGUuTG9nTGV2ZWwuREVCVUcgbGV2ZWwuCiAgICAgKgogICAgICogIFBhcmFtZXRlcnM6CiAgICAgKiAgICAoU3RyaW5nKSBtc2cgLSBUaGUgbG9nIG1lc3NhZ2UuCiAgICAgKi8KICAgIGRlYnVnOiBmdW5jdGlvbihtc2cpCiAgICB7CiAgICAgICAgdGhpcy5sb2codGhpcy5Mb2dMZXZlbC5ERUJVRywgbXNnKTsKICAgIH0sCgogICAgLyoqIEZ1bmN0aW9uOiBpbmZvCiAgICAgKiAgTG9nIGEgbWVzc2FnZSBhdCB0aGUgU3Ryb3BoZS5Mb2dMZXZlbC5JTkZPIGxldmVsLgogICAgICoKICAgICAqICBQYXJhbWV0ZXJzOgogICAgICogICAgKFN0cmluZykgbXNnIC0gVGhlIGxvZyBtZXNzYWdlLgogICAgICovCiAgICBpbmZvOiBmdW5jdGlvbiAobXNnKQogICAgewogICAgICAgIHRoaXMubG9nKHRoaXMuTG9nTGV2ZWwuSU5GTywgbXNnKTsKICAgIH0sCgogICAgLyoqIEZ1bmN0aW9uOiB3YXJuCiAgICAgKiAgTG9nIGEgbWVzc2FnZSBhdCB0aGUgU3Ryb3BoZS5Mb2dMZXZlbC5XQVJOIGxldmVsLgogICAgICoKICAgICAqICBQYXJhbWV0ZXJzOgogICAgICogICAgKFN0cmluZykgbXNnIC0gVGhlIGxvZyBtZXNzYWdlLgogICAgICovCiAgICB3YXJuOiBmdW5jdGlvbiAobXNnKQogICAgewogICAgICAgIHRoaXMubG9nKHRoaXMuTG9nTGV2ZWwuV0FSTiwgbXNnKTsKICAgIH0sCgogICAgLyoqIEZ1bmN0aW9uOiBlcnJvcgogICAgICogIExvZyBhIG1lc3NhZ2UgYXQgdGhlIFN0cm9waGUuTG9nTGV2ZWwuRVJST1IgbGV2ZWwuCiAgICAgKgogICAgICogIFBhcmFtZXRlcnM6CiAgICAgKiAgICAoU3RyaW5nKSBtc2cgLSBUaGUgbG9nIG1lc3NhZ2UuCiAgICAgKi8KICAgIGVycm9yOiBmdW5jdGlvbiAobXNnKQogICAgewogICAgICAgIHRoaXMubG9nKHRoaXMuTG9nTGV2ZWwuRVJST1IsIG1zZyk7CiAgICB9LAoKICAgIC8qKiBGdW5jdGlvbjogZmF0YWwKICAgICAqICBMb2cgYSBtZXNzYWdlIGF0IHRoZSBTdHJvcGhlLkxvZ0xldmVsLkZBVEFMIGxldmVsLgogICAgICoKICAgICAqICBQYXJhbWV0ZXJzOgogICAgICogICAgKFN0cmluZykgbXNnIC0gVGhlIGxvZyBtZXNzYWdlLgogICAgICovCiAgICBmYXRhbDogZnVuY3Rpb24gKG1zZykKICAgIHsKICAgICAgICB0aGlzLmxvZyh0aGlzLkxvZ0xldmVsLkZBVEFMLCBtc2cpOwogICAgfSwKCiAgICAvKiogRnVuY3Rpb246IHNlcmlhbGl6ZQogICAgICogIFJlbmRlciBhIERPTSBlbGVtZW50IGFuZCBhbGwgZGVzY2VuZGFudHMgdG8gYSBTdHJpbmcuCiAgICAgKgogICAgICogIFBhcmFtZXRlcnM6CiAgICAgKiAgICAoWE1MRWxlbWVudCkgZWxlbSAtIEEgRE9NIGVsZW1lbnQuCiAgICAgKgogICAgICogIFJldHVybnM6CiAgICAgKiAgICBUaGUgc2VyaWFsaXplZCBlbGVtZW50IHRyZWUgYXMgYSBTdHJpbmcuCiAgICAgKi8KICAgIHNlcmlhbGl6ZTogZnVuY3Rpb24gKGVsZW0pCiAgICB7CiAgICAgICAgdmFyIHJlc3VsdDsKCiAgICAgICAgaWYgKCFlbGVtKSB7IHJldHVybiBudWxsOyB9CgogICAgICAgIGlmICh0eXBlb2YoZWxlbS50cmVlKSA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICBlbGVtID0gZWxlbS50cmVlKCk7CiAgICAgICAgfQoKICAgICAgICB2YXIgbm9kZU5hbWUgPSBlbGVtLm5vZGVOYW1lOwogICAgICAgIHZhciBpLCBjaGlsZDsKCiAgICAgICAgaWYgKGVsZW0uZ2V0QXR0cmlidXRlKCJfcmVhbG5hbWUiKSkgewogICAgICAgICAgICBub2RlTmFtZSA9IGVsZW0uZ2V0QXR0cmlidXRlKCJfcmVhbG5hbWUiKTsKICAgICAgICB9CgogICAgICAgIHJlc3VsdCA9ICI8IiArIG5vZGVOYW1lOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBlbGVtLmF0dHJpYnV0ZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgaWYoZWxlbS5hdHRyaWJ1dGVzW2ldLm5vZGVOYW1lICE9ICJfcmVhbG5hbWUiKSB7CiAgICAgICAgICAgICAgICAgcmVzdWx0ICs9ICIgIiArIGVsZW0uYXR0cmlidXRlc1tpXS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpICsKICAgICAgICAgICAgICAgICI9JyIgKyBlbGVtLmF0dHJpYnV0ZXNbaV0udmFsdWUKICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvJi9nLCAiJmFtcDsiKQogICAgICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9cJy9nLCAiJmFwb3M7IikKICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvPi9nLCAiJmd0OyIpCiAgICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoLzwvZywgIiZsdDsiKSArICInIjsKICAgICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGVsZW0uY2hpbGROb2Rlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHJlc3VsdCArPSAiPiI7CiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBlbGVtLmNoaWxkTm9kZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGNoaWxkID0gZWxlbS5jaGlsZE5vZGVzW2ldOwogICAgICAgICAgICAgICAgc3dpdGNoKCBjaGlsZC5ub2RlVHlwZSApewogICAgICAgICAgICAgICAgICBjYXNlIFN0cm9waGUuRWxlbWVudFR5cGUuTk9STUFMOgogICAgICAgICAgICAgICAgICAgIC8vIG5vcm1hbCBlbGVtZW50LCBzbyByZWN1cnNlCiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IFN0cm9waGUuc2VyaWFsaXplKGNoaWxkKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgY2FzZSBTdHJvcGhlLkVsZW1lbnRUeXBlLlRFWFQ6CiAgICAgICAgICAgICAgICAgICAgLy8gdGV4dCBlbGVtZW50IHRvIGVzY2FwZSB2YWx1ZXMKICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gU3Ryb3BoZS54bWxlc2NhcGUoY2hpbGQubm9kZVZhbHVlKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgY2FzZSBTdHJvcGhlLkVsZW1lbnRUeXBlLkNEQVRBOgogICAgICAgICAgICAgICAgICAgIC8vIGNkYXRhIHNlY3Rpb24gc28gZG9uJ3QgZXNjYXBlIHZhbHVlcwogICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSAiPCFbQ0RBVEFbIitjaGlsZC5ub2RlVmFsdWUrIl1dPiI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmVzdWx0ICs9ICI8LyIgKyBub2RlTmFtZSArICI+IjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXN1bHQgKz0gIi8+IjsKICAgICAgICB9CgogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9LAoKICAgIC8qKiBQcml2YXRlVmFyaWFibGU6IF9yZXF1ZXN0SWQKICAgICAqICBfUHJpdmF0ZV8gdmFyaWFibGUgdGhhdCBrZWVwcyB0cmFjayBvZiB0aGUgcmVxdWVzdCBpZHMgZm9yCiAgICAgKiAgY29ubmVjdGlvbnMuCiAgICAgKi8KICAgIF9yZXF1ZXN0SWQ6IDAsCgogICAgLyoqIFByaXZhdGVWYXJpYWJsZTogU3Ryb3BoZS5jb25uZWN0aW9uUGx1Z2lucwogICAgICogIF9Qcml2YXRlXyB2YXJpYWJsZSBVc2VkIHRvIHN0b3JlIHBsdWdpbiBuYW1lcyB0aGF0IG5lZWQKICAgICAqICBpbml0aWFsaXphdGlvbiBvbiBTdHJvcGhlLkNvbm5lY3Rpb24gY29uc3RydWN0aW9uLgogICAgICovCiAgICBfY29ubmVjdGlvblBsdWdpbnM6IHt9LAoKICAgIC8qKiBGdW5jdGlvbjogYWRkQ29ubmVjdGlvblBsdWdpbgogICAgICogIEV4dGVuZHMgdGhlIFN0cm9waGUuQ29ubmVjdGlvbiBvYmplY3Qgd2l0aCB0aGUgZ2l2ZW4gcGx1Z2luLgogICAgICoKICAgICAqICBQYXJhbWV0ZXJzOgogICAgICogICAgKFN0cmluZykgbmFtZSAtIFRoZSBuYW1lIG9mIHRoZSBleHRlbnNpb24uCiAgICAgKiAgICAoT2JqZWN0KSBwdHlwZSAtIFRoZSBwbHVnaW4ncyBwcm90b3R5cGUuCiAgICAgKi8KICAgIGFkZENvbm5lY3Rpb25QbHVnaW46IGZ1bmN0aW9uIChuYW1lLCBwdHlwZSkKICAgIHsKICAgICAgICBTdHJvcGhlLl9jb25uZWN0aW9uUGx1Z2luc1tuYW1lXSA9IHB0eXBlOwogICAgfQp9OwoKLyoqIENsYXNzOiBTdHJvcGhlLkJ1aWxkZXIKICogIFhNTCBET00gYnVpbGRlci4KICoKICogIFRoaXMgb2JqZWN0IHByb3ZpZGVzIGFuIGludGVyZmFjZSBzaW1pbGFyIHRvIEpRdWVyeSBidXQgZm9yIGJ1aWxkaW5nCiAqICBET00gZWxlbWVudCBlYXNpbHkgYW5kIHJhcGlkbHkuICBBbGwgdGhlIGZ1bmN0aW9ucyBleGNlcHQgZm9yIHRvU3RyaW5nKCkKICogIGFuZCB0cmVlKCkgcmV0dXJuIHRoZSBvYmplY3QsIHNvIGNhbGxzIGNhbiBiZSBjaGFpbmVkLiAgSGVyZSdzIGFuCiAqICBleGFtcGxlIHVzaW5nIHRoZSAkaXEoKSBidWlsZGVyIGhlbHBlci4KICogID4gJGlxKHt0bzogJ3lvdScsIGZyb206ICdtZScsIHR5cGU6ICdnZXQnLCBpZDogJzEnfSkKICogID4gICAgIC5jKCdxdWVyeScsIHt4bWxuczogJ3N0cm9waGU6ZXhhbXBsZSd9KQogKiAgPiAgICAgLmMoJ2V4YW1wbGUnKQogKiAgPiAgICAgLnRvU3RyaW5nKCkKICogIFRoZSBhYm92ZSBnZW5lcmF0ZXMgdGhpcyBYTUwgZnJhZ21lbnQKICogID4gPGlxIHRvPSd5b3UnIGZyb209J21lJyB0eXBlPSdnZXQnIGlkPScxJz4KICogID4gICA8cXVlcnkgeG1sbnM9J3N0cm9waGU6ZXhhbXBsZSc+CiAqICA+ICAgICA8ZXhhbXBsZS8+CiAqICA+ICAgPC9xdWVyeT4KICogID4gPC9pcT4KICogIFRoZSBjb3JyZXNwb25kaW5nIERPTSBtYW5pcHVsYXRpb25zIHRvIGdldCBhIHNpbWlsYXIgZnJhZ21lbnQgd291bGQgYmUKICogIGEgbG90IG1vcmUgdGVkaW91cyBhbmQgcHJvYmFibHkgaW52b2x2ZSBzZXZlcmFsIGhlbHBlciB2YXJpYWJsZXMuCiAqCiAqICBTaW5jZSBhZGRpbmcgY2hpbGRyZW4gbWFrZXMgbmV3IG9wZXJhdGlvbnMgb3BlcmF0ZSBvbiB0aGUgY2hpbGQsIHVwKCkKICogIGlzIHByb3ZpZGVkIHRvIHRyYXZlcnNlIHVwIHRoZSB0cmVlLiAgVG8gYWRkIHR3byBjaGlsZHJlbiwgZG8KICogID4gYnVpbGRlci5jKCdjaGlsZDEnLCAuLi4pLnVwKCkuYygnY2hpbGQyJywgLi4uKQogKiAgVGhlIG5leHQgb3BlcmF0aW9uIG9uIHRoZSBCdWlsZGVyIHdpbGwgYmUgcmVsYXRpdmUgdG8gdGhlIHNlY29uZCBjaGlsZC4KICovCgovKiogQ29uc3RydWN0b3I6IFN0cm9waGUuQnVpbGRlcgogKiAgQ3JlYXRlIGEgU3Ryb3BoZS5CdWlsZGVyIG9iamVjdC4KICoKICogIFRoZSBhdHRyaWJ1dGVzIHNob3VsZCBiZSBwYXNzZWQgaW4gb2JqZWN0IG5vdGF0aW9uLiAgRm9yIGV4YW1wbGUKICogID4gdmFyIGIgPSBuZXcgQnVpbGRlcignbWVzc2FnZScsIHt0bzogJ3lvdScsIGZyb206ICdtZSd9KTsKICogIG9yCiAqICA+IHZhciBiID0gbmV3IEJ1aWxkZXIoJ21lc3NzYWdlJywgeyd4bWw6bGFuZyc6ICdlbid9KTsKICoKICogIFBhcmFtZXRlcnM6CiAqICAgIChTdHJpbmcpIG5hbWUgLSBUaGUgbmFtZSBvZiB0aGUgcm9vdCBlbGVtZW50LgogKiAgICAoT2JqZWN0KSBhdHRycyAtIFRoZSBhdHRyaWJ1dGVzIGZvciB0aGUgcm9vdCBlbGVtZW50IGluIG9iamVjdCBub3RhdGlvbi4KICoKICogIFJldHVybnM6CiAqICAgIEEgbmV3IFN0cm9waGUuQnVpbGRlci4KICovClN0cm9waGUuQnVpbGRlciA9IGZ1bmN0aW9uIChuYW1lLCBhdHRycykKewogICAgLy8gU2V0IGNvcnJlY3QgbmFtZXNwYWNlIGZvciBqYWJiZXI6Y2xpZW50IGVsZW1lbnRzCiAgICBpZiAobmFtZSA9PSAicHJlc2VuY2UiIHx8IG5hbWUgPT0gIm1lc3NhZ2UiIHx8IG5hbWUgPT0gImlxIikgewogICAgICAgIGlmIChhdHRycyAmJiAhYXR0cnMueG1sbnMpIHsKICAgICAgICAgICAgYXR0cnMueG1sbnMgPSBTdHJvcGhlLk5TLkNMSUVOVDsKICAgICAgICB9IGVsc2UgaWYgKCFhdHRycykgewogICAgICAgICAgICBhdHRycyA9IHt4bWxuczogU3Ryb3BoZS5OUy5DTElFTlR9OwogICAgICAgIH0KICAgIH0KCiAgICAvLyBIb2xkcyB0aGUgdHJlZSBiZWluZyBidWlsdC4KICAgIHRoaXMubm9kZVRyZWUgPSBTdHJvcGhlLnhtbEVsZW1lbnQobmFtZSwgYXR0cnMpOwoKICAgIC8vIFBvaW50cyB0byB0aGUgY3VycmVudCBvcGVyYXRpb24gbm9kZS4KICAgIHRoaXMubm9kZSA9IHRoaXMubm9kZVRyZWU7Cn07CgpTdHJvcGhlLkJ1aWxkZXIucHJvdG90eXBlID0gewogICAgLyoqIEZ1bmN0aW9uOiB0cmVlCiAgICAgKiAgUmV0dXJuIHRoZSBET00gdHJlZS4KICAgICAqCiAgICAgKiAgVGhpcyBmdW5jdGlvbiByZXR1cm5zIHRoZSBjdXJyZW50IERPTSB0cmVlIGFzIGFuIGVsZW1lbnQgb2JqZWN0LiAgVGhpcwogICAgICogIGlzIHN1aXRhYmxlIGZvciBwYXNzaW5nIHRvIGZ1bmN0aW9ucyBsaWtlIFN0cm9waGUuQ29ubmVjdGlvbi5zZW5kKCkuCiAgICAgKgogICAgICogIFJldHVybnM6CiAgICAgKiAgICBUaGUgRE9NIHRyZWUgYXMgYSBlbGVtZW50IG9iamVjdC4KICAgICAqLwogICAgdHJlZTogZnVuY3Rpb24gKCkKICAgIHsKICAgICAgICByZXR1cm4gdGhpcy5ub2RlVHJlZTsKICAgIH0sCgogICAgLyoqIEZ1bmN0aW9uOiB0b1N0cmluZwogICAgICogIFNlcmlhbGl6ZSB0aGUgRE9NIHRyZWUgdG8gYSBTdHJpbmcuCiAgICAgKgogICAgICogIFRoaXMgZnVuY3Rpb24gcmV0dXJucyBhIHN0cmluZyBzZXJpYWxpemF0aW9uIG9mIHRoZSBjdXJyZW50IERPTQogICAgICogIHRyZWUuICBJdCBpcyBvZnRlbiB1c2VkIGludGVybmFsbHkgdG8gcGFzcyBkYXRhIHRvIGEKICAgICAqICBTdHJvcGhlLlJlcXVlc3Qgb2JqZWN0LgogICAgICoKICAgICAqICBSZXR1cm5zOgogICAgICogICAgVGhlIHNlcmlhbGl6ZWQgRE9NIHRyZWUgaW4gYSBTdHJpbmcuCiAgICAgKi8KICAgIHRvU3RyaW5nOiBmdW5jdGlvbiAoKQogICAgewogICAgICAgIHJldHVybiBTdHJvcGhlLnNlcmlhbGl6ZSh0aGlzLm5vZGVUcmVlKTsKICAgIH0sCgogICAgLyoqIEZ1bmN0aW9uOiB1cAogICAgICogIE1ha2UgdGhlIGN1cnJlbnQgcGFyZW50IGVsZW1lbnQgdGhlIG5ldyBjdXJyZW50IGVsZW1lbnQuCiAgICAgKgogICAgICogIFRoaXMgZnVuY3Rpb24gaXMgb2Z0ZW4gdXNlZCBhZnRlciBjKCkgdG8gdHJhdmVyc2UgYmFjayB1cCB0aGUgdHJlZS4KICAgICAqICBGb3IgZXhhbXBsZSwgdG8gYWRkIHR3byBjaGlsZHJlbiB0byB0aGUgc2FtZSBlbGVtZW50CiAgICAgKiAgPiBidWlsZGVyLmMoJ2NoaWxkMScsIHt9KS51cCgpLmMoJ2NoaWxkMicsIHt9KTsKICAgICAqCiAgICAgKiAgUmV0dXJuczoKICAgICAqICAgIFRoZSBTdG9waGUuQnVpbGRlciBvYmplY3QuCiAgICAgKi8KICAgIHVwOiBmdW5jdGlvbiAoKQogICAgewogICAgICAgIHRoaXMubm9kZSA9IHRoaXMubm9kZS5wYXJlbnROb2RlOwogICAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvKiogRnVuY3Rpb246IGF0dHJzCiAgICAgKiAgQWRkIG9yIG1vZGlmeSBhdHRyaWJ1dGVzIG9mIHRoZSBjdXJyZW50IGVsZW1lbnQuCiAgICAgKgogICAgICogIFRoZSBhdHRyaWJ1dGVzIHNob3VsZCBiZSBwYXNzZWQgaW4gb2JqZWN0IG5vdGF0aW9uLiAgVGhpcyBmdW5jdGlvbgogICAgICogIGRvZXMgbm90IG1vdmUgdGhlIGN1cnJlbnQgZWxlbWVudCBwb2ludGVyLgogICAgICoKICAgICAqICBQYXJhbWV0ZXJzOgogICAgICogICAgKE9iamVjdCkgbW9yZWF0dHJzIC0gVGhlIGF0dHJpYnV0ZXMgdG8gYWRkL21vZGlmeSBpbiBvYmplY3Qgbm90YXRpb24uCiAgICAgKgogICAgICogIFJldHVybnM6CiAgICAgKiAgICBUaGUgU3Ryb3BoZS5CdWlsZGVyIG9iamVjdC4KICAgICAqLwogICAgYXR0cnM6IGZ1bmN0aW9uIChtb3JlYXR0cnMpCiAgICB7CiAgICAgICAgZm9yICh2YXIgayBpbiBtb3JlYXR0cnMpIHsKICAgICAgICAgICAgaWYgKG1vcmVhdHRycy5oYXNPd25Qcm9wZXJ0eShrKSkgewogICAgICAgICAgICAgICAgdGhpcy5ub2RlLnNldEF0dHJpYnV0ZShrLCBtb3JlYXR0cnNba10pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvKiogRnVuY3Rpb246IGMKICAgICAqICBBZGQgYSBjaGlsZCB0byB0aGUgY3VycmVudCBlbGVtZW50IGFuZCBtYWtlIGl0IHRoZSBuZXcgY3VycmVudAogICAgICogIGVsZW1lbnQuCiAgICAgKgogICAgICogIFRoaXMgZnVuY3Rpb24gbW92ZXMgdGhlIGN1cnJlbnQgZWxlbWVudCBwb2ludGVyIHRvIHRoZSBjaGlsZCwKICAgICAqICB1bmxlc3MgdGV4dCBpcyBwcm92aWRlZC4gIElmIHlvdSBuZWVkIHRvIGFkZCBhbm90aGVyIGNoaWxkLCBpdAogICAgICogIGlzIG5lY2Vzc2FyeSB0byB1c2UgdXAoKSB0byBnbyBiYWNrIHRvIHRoZSBwYXJlbnQgaW4gdGhlIHRyZWUuCiAgICAgKgogICAgICogIFBhcmFtZXRlcnM6CiAgICAgKiAgICAoU3RyaW5nKSBuYW1lIC0gVGhlIG5hbWUgb2YgdGhlIGNoaWxkLgogICAgICogICAgKE9iamVjdCkgYXR0cnMgLSBUaGUgYXR0cmlidXRlcyBvZiB0aGUgY2hpbGQgaW4gb2JqZWN0IG5vdGF0aW9uLgogICAgICogICAgKFN0cmluZykgdGV4dCAtIFRoZSB0ZXh0IHRvIGFkZCB0byB0aGUgY2hpbGQuCiAgICAgKgogICAgICogIFJldHVybnM6CiAgICAgKiAgICBUaGUgU3Ryb3BoZS5CdWlsZGVyIG9iamVjdC4KICAgICAqLwogICAgYzogZnVuY3Rpb24gKG5hbWUsIGF0dHJzLCB0ZXh0KQogICAgewogICAgICAgIHZhciBjaGlsZCA9IFN0cm9waGUueG1sRWxlbWVudChuYW1lLCBhdHRycywgdGV4dCk7CiAgICAgICAgdGhpcy5ub2RlLmFwcGVuZENoaWxkKGNoaWxkKTsKICAgICAgICBpZiAoIXRleHQpIHsKICAgICAgICAgICAgdGhpcy5ub2RlID0gY2hpbGQ7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICAvKiogRnVuY3Rpb246IGNub2RlCiAgICAgKiAgQWRkIGEgY2hpbGQgdG8gdGhlIGN1cnJlbnQgZWxlbWVudCBhbmQgbWFrZSBpdCB0aGUgbmV3IGN1cnJlbnQKICAgICAqICBlbGVtZW50LgogICAgICoKICAgICAqICBUaGlzIGZ1bmN0aW9uIGlzIHRoZSBzYW1lIGFzIGMoKSBleGNlcHQgdGhhdCBpbnN0ZWFkIG9mIHVzaW5nIGEKICAgICAqICBuYW1lIGFuZCBhbiBhdHRyaWJ1dGVzIG9iamVjdCB0byBjcmVhdGUgdGhlIGNoaWxkIGl0IHVzZXMgYW4KICAgICAqICBleGlzdGluZyBET00gZWxlbWVudCBvYmplY3QuCiAgICAgKgogICAgICogIFBhcmFtZXRlcnM6CiAgICAgKiAgICAoWE1MRWxlbWVudCkgZWxlbSAtIEEgRE9NIGVsZW1lbnQuCiAgICAgKgogICAgICogIFJldHVybnM6CiAgICAgKiAgICBUaGUgU3Ryb3BoZS5CdWlsZGVyIG9iamVjdC4KICAgICAqLwogICAgY25vZGU6IGZ1bmN0aW9uIChlbGVtKQogICAgewogICAgICAgIHZhciBpbXBOb2RlOwogICAgICAgIHZhciB4bWxHZW4gPSBTdHJvcGhlLnhtbEdlbmVyYXRvcigpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGltcE5vZGUgPSAoeG1sR2VuLmltcG9ydE5vZGUgIT09IHVuZGVmaW5lZCk7CiAgICAgICAgfQogICAgICAgIGNhdGNoIChlKSB7CiAgICAgICAgICAgIGltcE5vZGUgPSBmYWxzZTsKICAgICAgICB9CiAgICAgICAgdmFyIG5ld0VsZW0gPSBpbXBOb2RlID8KICAgICAgICAgICAgICAgICAgICAgIHhtbEdlbi5pbXBvcnROb2RlKGVsZW0sIHRydWUpIDoKICAgICAgICAgICAgICAgICAgICAgIFN0cm9waGUuY29weUVsZW1lbnQoZWxlbSk7CiAgICAgICAgdGhpcy5ub2RlLmFwcGVuZENoaWxkKG5ld0VsZW0pOwogICAgICAgIHRoaXMubm9kZSA9IG5ld0VsZW07CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAoKICAgIC8qKiBGdW5jdGlvbjogdAogICAgICogIEFkZCBhIGNoaWxkIHRleHQgZWxlbWVudC4KICAgICAqCiAgICAgKiAgVGhpcyAqZG9lcyBub3QqIG1ha2UgdGhlIGNoaWxkIHRoZSBuZXcgY3VycmVudCBlbGVtZW50IHNpbmNlIHRoZXJlCiAgICAgKiAgYXJlIG5vIGNoaWxkcmVuIG9mIHRleHQgZWxlbWVudHMuCiAgICAgKgogICAgICogIFBhcmFtZXRlcnM6CiAgICAgKiAgICAoU3RyaW5nKSB0ZXh0IC0gVGhlIHRleHQgZGF0YSB0byBhcHBlbmQgdG8gdGhlIGN1cnJlbnQgZWxlbWVudC4KICAgICAqCiAgICAgKiAgUmV0dXJuczoKICAgICAqICAgIFRoZSBTdHJvcGhlLkJ1aWxkZXIgb2JqZWN0LgogICAgICovCiAgICB0OiBmdW5jdGlvbiAodGV4dCkKICAgIHsKICAgICAgICB2YXIgY2hpbGQgPSBTdHJvcGhlLnhtbFRleHROb2RlKHRleHQpOwogICAgICAgIHRoaXMubm9kZS5hcHBlbmRDaGlsZChjaGlsZCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9LAoKICAgIC8qKiBGdW5jdGlvbjogaAogICAgICogIFJlcGxhY2UgY3VycmVudCBlbGVtZW50IGNvbnRlbnRzIHdpdGggdGhlIEhUTUwgcGFzc2VkIGluLgogICAgICoKICAgICAqICBUaGlzICpkb2VzIG5vdCogbWFrZSB0aGUgY2hpbGQgdGhlIG5ldyBjdXJyZW50IGVsZW1lbnQKICAgICAqCiAgICAgKiAgUGFyYW1ldGVyczoKICAgICAqICAgIChTdHJpbmcpIGh0bWwgLSBUaGUgaHRtbCB0byBpbnNlcnQgYXMgY29udGVudHMgb2YgY3VycmVudCBlbGVtZW50LgogICAgICoKICAgICAqICBSZXR1cm5zOgogICAgICogICAgVGhlIFN0cm9waGUuQnVpbGRlciBvYmplY3QuCiAgICAgKi8KICAgIGg6IGZ1bmN0aW9uIChodG1sKQogICAgewogICAgICAgIHZhciBmcmFnbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2JvZHknKTsKCiAgICAgICAgLy8gZm9yY2UgdGhlIGJyb3dzZXIgdG8gdHJ5IGFuZCBmaXggYW55IGludmFsaWQgSFRNTCB0YWdzCiAgICAgICAgZnJhZ21lbnQuaW5uZXJIVE1MID0gaHRtbDsKCiAgICAgICAgLy8gY29weSBjbGVhbmVkIGh0bWwgaW50byBhbiB4bWwgZG9tCiAgICAgICAgdmFyIHhodG1sID0gU3Ryb3BoZS5jcmVhdGVIdG1sKGZyYWdtZW50KTsKCiAgICAgICAgd2hpbGUoeGh0bWwuY2hpbGROb2Rlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHRoaXMubm9kZS5hcHBlbmRDaGlsZCh4aHRtbC5jaGlsZE5vZGVzWzBdKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9Cn07CgovKiogUHJpdmF0ZUNsYXNzOiBTdHJvcGhlLkhhbmRsZXIKICogIF9Qcml2YXRlXyBoZWxwZXIgY2xhc3MgZm9yIG1hbmFnaW5nIHN0YW56YSBoYW5kbGVycy4KICoKICogIEEgU3Ryb3BoZS5IYW5kbGVyIGVuY2Fwc3VsYXRlcyBhIHVzZXIgcHJvdmlkZWQgY2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUKICogIGV4ZWN1dGVkIHdoZW4gbWF0Y2hpbmcgc3RhbnphcyBhcmUgcmVjZWl2ZWQgYnkgdGhlIGNvbm5lY3Rpb24uCiAqICBIYW5kbGVycyBjYW4gYmUgZWl0aGVyIG9uZS1vZmYgb3IgcGVyc2lzdGFudCBkZXBlbmRpbmcgb24gdGhlaXIKICogIHJldHVybiB2YWx1ZS4gUmV0dXJuaW5nIHRydWUgd2lsbCBjYXVzZSBhIEhhbmRsZXIgdG8gcmVtYWluIGFjdGl2ZSwgYW5kCiAqICByZXR1cm5pbmcgZmFsc2Ugd2lsbCByZW1vdmUgdGhlIEhhbmRsZXIuCiAqCiAqICBVc2VycyB3aWxsIG5vdCB1c2UgU3Ryb3BoZS5IYW5kbGVyIG9iamVjdHMgZGlyZWN0bHksIGJ1dCBpbnN0ZWFkIHRoZXkKICogIHdpbGwgdXNlIFN0cm9waGUuQ29ubmVjdGlvbi5hZGRIYW5kbGVyKCkgYW5kCiAqICBTdHJvcGhlLkNvbm5lY3Rpb24uZGVsZXRlSGFuZGxlcigpLgogKi8KCi8qKiBQcml2YXRlQ29uc3RydWN0b3I6IFN0cm9waGUuSGFuZGxlcgogKiAgQ3JlYXRlIGFuZCBpbml0aWFsaXplIGEgbmV3IFN0cm9waGUuSGFuZGxlci4KICoKICogIFBhcmFtZXRlcnM6CiAqICAgIChGdW5jdGlvbikgaGFuZGxlciAtIEEgZnVuY3Rpb24gdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgaGFuZGxlciBpcyBydW4uCiAqICAgIChTdHJpbmcpIG5zIC0gVGhlIG5hbWVzcGFjZSB0byBtYXRjaC4KICogICAgKFN0cmluZykgbmFtZSAtIFRoZSBlbGVtZW50IG5hbWUgdG8gbWF0Y2guCiAqICAgIChTdHJpbmcpIHR5cGUgLSBUaGUgZWxlbWVudCB0eXBlIHRvIG1hdGNoLgogKiAgICAoU3RyaW5nKSBpZCAtIFRoZSBlbGVtZW50IGlkIGF0dHJpYnV0ZSB0byBtYXRjaC4KICogICAgKFN0cmluZykgZnJvbSAtIFRoZSBlbGVtZW50IGZyb20gYXR0cmlidXRlIHRvIG1hdGNoLgogKiAgICAoT2JqZWN0KSBvcHRpb25zIC0gSGFuZGxlciBvcHRpb25zCiAqCiAqICBSZXR1cm5zOgogKiAgICBBIG5ldyBTdHJvcGhlLkhhbmRsZXIgb2JqZWN0LgogKi8KU3Ryb3BoZS5IYW5kbGVyID0gZnVuY3Rpb24gKGhhbmRsZXIsIG5zLCBuYW1lLCB0eXBlLCBpZCwgZnJvbSwgb3B0aW9ucykKewogICAgdGhpcy5oYW5kbGVyID0gaGFuZGxlcjsKICAgIHRoaXMubnMgPSBuczsKICAgIHRoaXMubmFtZSA9IG5hbWU7CiAgICB0aGlzLnR5cGUgPSB0eXBlOwogICAgdGhpcy5pZCA9IGlkOwogICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucyB8fCB7bWF0Y2hCYXJlOiBmYWxzZX07CgogICAgLy8gZGVmYXVsdCBtYXRjaEJhcmUgdG8gZmFsc2UgaWYgdW5kZWZpbmVkCiAgICBpZiAoIXRoaXMub3B0aW9ucy5tYXRjaEJhcmUpIHsKICAgICAgICB0aGlzLm9wdGlvbnMubWF0Y2hCYXJlID0gZmFsc2U7CiAgICB9CgogICAgaWYgKHRoaXMub3B0aW9ucy5tYXRjaEJhcmUpIHsKICAgICAgICB0aGlzLmZyb20gPSBmcm9tID8gU3Ryb3BoZS5nZXRCYXJlSmlkRnJvbUppZChmcm9tKSA6IG51bGw7CiAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZnJvbSA9IGZyb207CiAgICB9CgogICAgLy8gd2hldGhlciB0aGUgaGFuZGxlciBpcyBhIHVzZXIgaGFuZGxlciBvciBhIHN5c3RlbSBoYW5kbGVyCiAgICB0aGlzLnVzZXIgPSB0cnVlOwp9OwoKU3Ryb3BoZS5IYW5kbGVyLnByb3RvdHlwZSA9IHsKICAgIC8qKiBQcml2YXRlRnVuY3Rpb246IGlzTWF0Y2gKICAgICAqICBUZXN0cyBpZiBhIHN0YW56YSBtYXRjaGVzIHRoZSBTdHJvcGhlLkhhbmRsZXIuCiAgICAgKgogICAgICogIFBhcmFtZXRlcnM6CiAgICAgKiAgICAoWE1MRWxlbWVudCkgZWxlbSAtIFRoZSBYTUwgZWxlbWVudCB0byB0ZXN0LgogICAgICoKICAgICAqICBSZXR1cm5zOgogICAgICogICAgdHJ1ZSBpZiB0aGUgc3RhbnphIG1hdGNoZXMgYW5kIGZhbHNlIG90aGVyd2lzZS4KICAgICAqLwogICAgaXNNYXRjaDogZnVuY3Rpb24gKGVsZW0pCiAgICB7CiAgICAgICAgdmFyIG5zTWF0Y2g7CiAgICAgICAgdmFyIGZyb20gPSBudWxsOwoKICAgICAgICBpZiAodGhpcy5vcHRpb25zLm1hdGNoQmFyZSkgewogICAgICAgICAgICBmcm9tID0gU3Ryb3BoZS5nZXRCYXJlSmlkRnJvbUppZChlbGVtLmdldEF0dHJpYnV0ZSgnZnJvbScpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBmcm9tID0gZWxlbS5nZXRBdHRyaWJ1dGUoJ2Zyb20nKTsKICAgICAgICB9CgogICAgICAgIG5zTWF0Y2ggPSBmYWxzZTsKICAgICAgICBpZiAoIXRoaXMubnMpIHsKICAgICAgICAgICAgbnNNYXRjaCA9IHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzOwogICAgICAgICAgICBTdHJvcGhlLmZvckVhY2hDaGlsZChlbGVtLCBudWxsLCBmdW5jdGlvbiAoZWxlbSkgewogICAgICAgICAgICAgICAgaWYgKGVsZW0uZ2V0QXR0cmlidXRlKCJ4bWxucyIpID09IHRoYXQubnMpIHsKICAgICAgICAgICAgICAgICAgICBuc01hdGNoID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBuc01hdGNoID0gbnNNYXRjaCB8fCBlbGVtLmdldEF0dHJpYnV0ZSgieG1sbnMiKSA9PSB0aGlzLm5zOwogICAgICAgIH0KCiAgICAgICAgaWYgKG5zTWF0Y2ggJiYKICAgICAgICAgICAgKCF0aGlzLm5hbWUgfHwgU3Ryb3BoZS5pc1RhZ0VxdWFsKGVsZW0sIHRoaXMubmFtZSkpICYmCiAgICAgICAgICAgICghdGhpcy50eXBlIHx8IGVsZW0uZ2V0QXR0cmlidXRlKCJ0eXBlIikgPT0gdGhpcy50eXBlKSAmJgogICAgICAgICAgICAoIXRoaXMuaWQgfHwgZWxlbS5nZXRBdHRyaWJ1dGUoImlkIikgPT0gdGhpcy5pZCkgJiYKICAgICAgICAgICAgKCF0aGlzLmZyb20gfHwgZnJvbSA9PSB0aGlzLmZyb20pKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0sCgogICAgLyoqIFByaXZhdGVGdW5jdGlvbjogcnVuCiAgICAgKiAgUnVuIHRoZSBjYWxsYmFjayBvbiBhIG1hdGNoaW5nIHN0YW56YS4KICAgICAqCiAgICAgKiAgUGFyYW1ldGVyczoKICAgICAqICAgIChYTUxFbGVtZW50KSBlbGVtIC0gVGhlIERPTSBlbGVtZW50IHRoYXQgdHJpZ2dlcmVkIHRoZQogICAgICogICAgICBTdHJvcGhlLkhhbmRsZXIuCiAgICAgKgogICAgICogIFJldHVybnM6CiAgICAgKiAgICBBIGJvb2xlYW4gaW5kaWNhdGluZyBpZiB0aGUgaGFuZGxlciBzaG91bGQgcmVtYWluIGFjdGl2ZS4KICAgICAqLwogICAgcnVuOiBmdW5jdGlvbiAoZWxlbSkKICAgIHsKICAgICAgICB2YXIgcmVzdWx0ID0gbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXN1bHQgPSB0aGlzLmhhbmRsZXIoZWxlbSk7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICBpZiAoZS5zb3VyY2VVUkwpIHsKICAgICAgICAgICAgICAgIFN0cm9waGUuZmF0YWwoImVycm9yOiAiICsgdGhpcy5oYW5kbGVyICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIiAiICsgZS5zb3VyY2VVUkwgKyAiOiIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLmxpbmUgKyAiIC0gIiArIGUubmFtZSArICI6ICIgKyBlLm1lc3NhZ2UpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGUuZmlsZU5hbWUpIHsKICAgICAgICAgICAgICAgIGlmICh0eXBlb2YoY29uc29sZSkgIT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLnRyYWNlKCk7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcih0aGlzLmhhbmRsZXIsICIgLSBlcnJvciAtICIsIGUsIGUubWVzc2FnZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBTdHJvcGhlLmZhdGFsKCJlcnJvcjogIiArIHRoaXMuaGFuZGxlciArICIgIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUuZmlsZU5hbWUgKyAiOiIgKyBlLmxpbmVOdW1iZXIgKyAiIC0gIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUubmFtZSArICI6ICIgKyBlLm1lc3NhZ2UpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgU3Ryb3BoZS5mYXRhbCgiZXJyb3I6ICIgKyBlLm1lc3NhZ2UgKyAiXG4iICsgZS5zdGFjayk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRocm93IGU7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgfSwKCiAgICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiB0b1N0cmluZwogICAgICogIEdldCBhIFN0cmluZyByZXByZXNlbnRhdGlvbiBvZiB0aGUgU3Ryb3BoZS5IYW5kbGVyIG9iamVjdC4KICAgICAqCiAgICAgKiAgUmV0dXJuczoKICAgICAqICAgIEEgU3RyaW5nLgogICAgICovCiAgICB0b1N0cmluZzogZnVuY3Rpb24gKCkKICAgIHsKICAgICAgICByZXR1cm4gIntIYW5kbGVyOiAiICsgdGhpcy5oYW5kbGVyICsgIigiICsgdGhpcy5uYW1lICsgIiwiICsKICAgICAgICAgICAgdGhpcy5pZCArICIsIiArIHRoaXMubnMgKyAiKX0iOwogICAgfQp9OwoKLyoqIFByaXZhdGVDbGFzczogU3Ryb3BoZS5UaW1lZEhhbmRsZXIKICogIF9Qcml2YXRlXyBoZWxwZXIgY2xhc3MgZm9yIG1hbmFnaW5nIHRpbWVkIGhhbmRsZXJzLgogKgogKiAgQSBTdHJvcGhlLlRpbWVkSGFuZGxlciBlbmNhcHN1bGF0ZXMgYSB1c2VyIHByb3ZpZGVkIGNhbGxiYWNrIHRoYXQKICogIHNob3VsZCBiZSBjYWxsZWQgYWZ0ZXIgYSBjZXJ0YWluIHBlcmlvZCBvZiB0aW1lIG9yIGF0IHJlZ3VsYXIKICogIGludGVydmFscy4gIFRoZSByZXR1cm4gdmFsdWUgb2YgdGhlIGNhbGxiYWNrIGRldGVybWluZXMgd2hldGhlciB0aGUKICogIFN0cm9waGUuVGltZWRIYW5kbGVyIHdpbGwgY29udGludWUgdG8gZmlyZS4KICoKICogIFVzZXJzIHdpbGwgbm90IHVzZSBTdHJvcGhlLlRpbWVkSGFuZGxlciBvYmplY3RzIGRpcmVjdGx5LCBidXQgaW5zdGVhZAogKiAgdGhleSB3aWxsIHVzZSBTdHJvcGhlLkNvbm5lY3Rpb24uYWRkVGltZWRIYW5kbGVyKCkgYW5kCiAqICBTdHJvcGhlLkNvbm5lY3Rpb24uZGVsZXRlVGltZWRIYW5kbGVyKCkuCiAqLwoKLyoqIFByaXZhdGVDb25zdHJ1Y3RvcjogU3Ryb3BoZS5UaW1lZEhhbmRsZXIKICogIENyZWF0ZSBhbmQgaW5pdGlhbGl6ZSBhIG5ldyBTdHJvcGhlLlRpbWVkSGFuZGxlciBvYmplY3QuCiAqCiAqICBQYXJhbWV0ZXJzOgogKiAgICAoSW50ZWdlcikgcGVyaW9kIC0gVGhlIG51bWJlciBvZiBtaWxsaXNlY29uZHMgdG8gd2FpdCBiZWZvcmUgdGhlCiAqICAgICAgaGFuZGxlciBpcyBjYWxsZWQuCiAqICAgIChGdW5jdGlvbikgaGFuZGxlciAtIFRoZSBjYWxsYmFjayB0byBydW4gd2hlbiB0aGUgaGFuZGxlciBmaXJlcy4gIFRoaXMKICogICAgICBmdW5jdGlvbiBzaG91bGQgdGFrZSBubyBhcmd1bWVudHMuCiAqCiAqICBSZXR1cm5zOgogKiAgICBBIG5ldyBTdHJvcGhlLlRpbWVkSGFuZGxlciBvYmplY3QuCiAqLwpTdHJvcGhlLlRpbWVkSGFuZGxlciA9IGZ1bmN0aW9uIChwZXJpb2QsIGhhbmRsZXIpCnsKICAgIHRoaXMucGVyaW9kID0gcGVyaW9kOwogICAgdGhpcy5oYW5kbGVyID0gaGFuZGxlcjsKCiAgICB0aGlzLmxhc3RDYWxsZWQgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTsKICAgIHRoaXMudXNlciA9IHRydWU7Cn07CgpTdHJvcGhlLlRpbWVkSGFuZGxlci5wcm90b3R5cGUgPSB7CiAgICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiBydW4KICAgICAqICBSdW4gdGhlIGNhbGxiYWNrIGZvciB0aGUgU3Ryb3BoZS5UaW1lZEhhbmRsZXIuCiAgICAgKgogICAgICogIFJldHVybnM6CiAgICAgKiAgICB0cnVlIGlmIHRoZSBTdHJvcGhlLlRpbWVkSGFuZGxlciBzaG91bGQgYmUgY2FsbGVkIGFnYWluLCBhbmQgZmFsc2UKICAgICAqICAgICAgb3RoZXJ3aXNlLgogICAgICovCiAgICBydW46IGZ1bmN0aW9uICgpCiAgICB7CiAgICAgICAgdGhpcy5sYXN0Q2FsbGVkID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7CiAgICAgICAgcmV0dXJuIHRoaXMuaGFuZGxlcigpOwogICAgfSwKCiAgICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiByZXNldAogICAgICogIFJlc2V0IHRoZSBsYXN0IGNhbGxlZCB0aW1lIGZvciB0aGUgU3Ryb3BoZS5UaW1lZEhhbmRsZXIuCiAgICAgKi8KICAgIHJlc2V0OiBmdW5jdGlvbiAoKQogICAgewogICAgICAgIHRoaXMubGFzdENhbGxlZCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOwogICAgfSwKCiAgICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiB0b1N0cmluZwogICAgICogIEdldCBhIHN0cmluZyByZXByZXNlbnRhdGlvbiBvZiB0aGUgU3Ryb3BoZS5UaW1lZEhhbmRsZXIgb2JqZWN0LgogICAgICoKICAgICAqICBSZXR1cm5zOgogICAgICogICAgVGhlIHN0cmluZyByZXByZXNlbnRhdGlvbi4KICAgICAqLwogICAgdG9TdHJpbmc6IGZ1bmN0aW9uICgpCiAgICB7CiAgICAgICAgcmV0dXJuICJ7VGltZWRIYW5kbGVyOiAiICsgdGhpcy5oYW5kbGVyICsgIigiICsgdGhpcy5wZXJpb2QgKyIpfSI7CiAgICB9Cn07CgovKiogQ2xhc3M6IFN0cm9waGUuQ29ubmVjdGlvbgogKiAgWE1QUCBDb25uZWN0aW9uIG1hbmFnZXIuCiAqCiAqICBUaGlzIGNsYXNzIGlzIHRoZSBtYWluIHBhcnQgb2YgU3Ryb3BoZS4gIEl0IG1hbmFnZXMgYSBCT1NIIGNvbm5lY3Rpb24KICogIHRvIGFuIFhNUFAgc2VydmVyIGFuZCBkaXNwYXRjaGVzIGV2ZW50cyB0byB0aGUgdXNlciBjYWxsYmFja3MgYXMKICogIGRhdGEgYXJyaXZlcy4gIEl0IHN1cHBvcnRzIFNBU0wgUExBSU4sIFNBU0wgRElHRVNULU1ENSwgU0FTTCBTQ1JBTS1TSEExCiAqICBhbmQgbGVnYWN5IGF1dGhlbnRpY2F0aW9uLgogKgogKiAgQWZ0ZXIgY3JlYXRpbmcgYSBTdHJvcGhlLkNvbm5lY3Rpb24gb2JqZWN0LCB0aGUgdXNlciB3aWxsIHR5cGljYWxseQogKiAgY2FsbCBjb25uZWN0KCkgd2l0aCBhIHVzZXIgc3VwcGxpZWQgY2FsbGJhY2sgdG8gaGFuZGxlIGNvbm5lY3Rpb24gbGV2ZWwKICogIGV2ZW50cyBsaWtlIGF1dGhlbnRpY2F0aW9uIGZhaWx1cmUsIGRpc2Nvbm5lY3Rpb24sIG9yIGNvbm5lY3Rpb24KICogIGNvbXBsZXRlLgogKgogKiAgVGhlIHVzZXIgd2lsbCBhbHNvIGhhdmUgc2V2ZXJhbCBldmVudCBoYW5kbGVycyBkZWZpbmVkIGJ5IHVzaW5nCiAqICBhZGRIYW5kbGVyKCkgYW5kIGFkZFRpbWVkSGFuZGxlcigpLiAgVGhlc2Ugd2lsbCBhbGxvdyB0aGUgdXNlciBjb2RlIHRvCiAqICByZXNwb25kIHRvIGludGVyZXN0aW5nIHN0YW56YXMgb3IgZG8gc29tZXRoaW5nIHBlcmlvZGljYWxseSB3aXRoIHRoZQogKiAgY29ubmVjdGlvbi4gIFRoZXNlIGhhbmRsZXJzIHdpbGwgYmUgYWN0aXZlIG9uY2UgYXV0aGVudGljYXRpb24gaXMKICogIGZpbmlzaGVkLgogKgogKiAgVG8gc2VuZCBkYXRhIHRvIHRoZSBjb25uZWN0aW9uLCB1c2Ugc2VuZCgpLgogKi8KCi8qKiBDb25zdHJ1Y3RvcjogU3Ryb3BoZS5Db25uZWN0aW9uCiAqICBDcmVhdGUgYW5kIGluaXRpYWxpemUgYSBTdHJvcGhlLkNvbm5lY3Rpb24gb2JqZWN0LgogKgogKiAgVGhlIHRyYW5zcG9ydC1wcm90b2NvbCBmb3IgdGhpcyBjb25uZWN0aW9uIHdpbGwgYmUgY2hvc2VuIGF1dG9tYXRpY2FsbHkKICogIGJhc2VkIG9uIHRoZSBnaXZlbiBzZXJ2aWNlIHBhcmFtZXRlci4gVVJMcyBzdGFydGluZyB3aXRoICJ3czovLyIgb3IKICogICJ3c3M6Ly8iIHdpbGwgdXNlIFdlYlNvY2tldHMsIFVSTHMgc3RhcnRpbmcgd2l0aCAiaHR0cDovLyIsICJodHRwczovLyIKICogIG9yIHdpdGhvdXQgYSBwcm90b2NvbCB3aWxsIHVzZSBCT1NILgogKgogKiAgVG8gbWFrZSBTdHJvcGhlIGNvbm5lY3QgdG8gdGhlIGN1cnJlbnQgaG9zdCB5b3UgY2FuIGxlYXZlIG91dCB0aGUgcHJvdG9jb2wKICogIGFuZCBob3N0IHBhcnQgYW5kIGp1c3QgcGFzcyB0aGUgcGF0aCwgZS5nLgogKgogKiAgPiB2YXIgY29ubiA9IG5ldyBTdHJvcGhlLkNvbm5lY3Rpb24oIi9odHRwLWJpbmQvIik7CiAqCiAqICBXZWJTb2NrZXQgb3B0aW9uczoKICoKICogIElmIHlvdSB3YW50IHRvIGNvbm5lY3QgdG8gdGhlIGN1cnJlbnQgaG9zdCB3aXRoIGEgV2ViU29ja2V0IGNvbm5lY3Rpb24geW91CiAqICBjYW4gdGVsbCBTdHJvcGhlIHRvIHVzZSBXZWJTb2NrZXRzIHRocm91Z2ggYSAicHJvdG9jb2wiIGF0dHJpYnV0ZSBpbiB0aGUKICogIG9wdGlvbmFsIG9wdGlvbnMgcGFyYW1ldGVyLiBWYWxpZCB2YWx1ZXMgYXJlICJ3cyIgZm9yIFdlYlNvY2tldCBhbmQgIndzcyIKICogIGZvciBTZWN1cmUgV2ViU29ja2V0LgogKiAgU28gdG8gY29ubmVjdCB0byAid3NzOi8vQ1VSUkVOVF9IT1NUTkFNRS94bXBwLXdlYnNvY2tldCIgeW91IHdvdWxkIGNhbGwKICoKICogID4gdmFyIGNvbm4gPSBuZXcgU3Ryb3BoZS5Db25uZWN0aW9uKCIveG1wcC13ZWJzb2NrZXQvIiwge3Byb3RvY29sOiAid3NzIn0pOwogKgogKiAgTm90ZSB0aGF0IHJlbGF0aXZlIFVSTHMgX05PVF8gc3RhcnRpbmcgd2l0aCBhICIvIiB3aWxsIGFsc28gaW5jbHVkZSB0aGUgcGF0aAogKiAgb2YgdGhlIGN1cnJlbnQgc2l0ZS4KICoKICogIEFsc28gYmVjYXVzZSBkb3duZ3JhZGluZyBzZWN1cml0eSBpcyBub3QgcGVybWl0dGVkIGJ5IGJyb3dzZXJzLCB3aGVuIHVzaW5nCiAqICByZWxhdGl2ZSBVUkxzIGJvdGggQk9TSCBhbmQgV2ViU29ja2V0IGNvbm5lY3Rpb25zIHdpbGwgdXNlIHRoZWlyIHNlY3VyZQogKiAgdmFyaWFudHMgaWYgdGhlIGN1cnJlbnQgY29ubmVjdGlvbiB0byB0aGUgc2l0ZSBpcyBhbHNvIHNlY3VyZSAoaHR0cHMpLgogKgogKiAgQk9TSCBvcHRpb25zOgogKgogKiAgYnkgYWRkaW5nICJzeW5jIiB0byB0aGUgb3B0aW9ucywgeW91IGNhbiBjb250cm9sIGlmIHJlcXVlc3RzIHdpbGwKICogIGJlIG1hZGUgc3luY2hyb25vdXNseSBvciBub3QuIFRoZSBkZWZhdWx0IGJlaGF2aW91ciBpcyBhc3luY2hyb25vdXMuCiAqICBJZiB5b3Ugd2FudCB0byBtYWtlIHJlcXVlc3RzIHN5bmNocm9ub3VzLCBtYWtlICJzeW5jIiBldmFsdWF0ZSB0byB0cnVlOgogKiAgPiB2YXIgY29ubiA9IG5ldyBTdHJvcGhlLkNvbm5lY3Rpb24oIi9odHRwLWJpbmQvIiwge3N5bmM6IHRydWV9KTsKICogIFlvdSBjYW4gYWxzbyB0b2dnbGUgdGhpcyBvbiBhbiBhbHJlYWR5IGVzdGFibGlzaGVkIGNvbm5lY3Rpb246CiAqICA+IGNvbm4ub3B0aW9ucy5zeW5jID0gdHJ1ZTsKICoKICoKICogIFBhcmFtZXRlcnM6CiAqICAgIChTdHJpbmcpIHNlcnZpY2UgLSBUaGUgQk9TSCBvciBXZWJTb2NrZXQgc2VydmljZSBVUkwuCiAqICAgIChPYmplY3QpIG9wdGlvbnMgLSBBIGhhc2ggb2YgY29uZmlndXJhdGlvbiBvcHRpb25zCiAqCiAqICBSZXR1cm5zOgogKiAgICBBIG5ldyBTdHJvcGhlLkNvbm5lY3Rpb24gb2JqZWN0LgogKi8KU3Ryb3BoZS5Db25uZWN0aW9uID0gZnVuY3Rpb24gKHNlcnZpY2UsIG9wdGlvbnMpCnsKICAgIC8vIFRoZSBzZXJ2aWNlIFVSTAogICAgdGhpcy5zZXJ2aWNlID0gc2VydmljZTsKCiAgICAvLyBDb25maWd1cmF0aW9uIG9wdGlvbnMKICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnMgfHwge307CiAgICB2YXIgcHJvdG8gPSB0aGlzLm9wdGlvbnMucHJvdG9jb2wgfHwgIiI7CgogICAgLy8gU2VsZWN0IHByb3RvY2FsIGJhc2VkIG9uIHNlcnZpY2Ugb3Igb3B0aW9ucwogICAgaWYgKHNlcnZpY2UuaW5kZXhPZigid3M6IikgPT09IDAgfHwgc2VydmljZS5pbmRleE9mKCJ3c3M6IikgPT09IDAgfHwKICAgICAgICAgICAgcHJvdG8uaW5kZXhPZigid3MiKSA9PT0gMCkgewogICAgICAgIHRoaXMuX3Byb3RvID0gbmV3IFN0cm9waGUuV2Vic29ja2V0KHRoaXMpOwogICAgfSBlbHNlIHsKICAgICAgICB0aGlzLl9wcm90byA9IG5ldyBTdHJvcGhlLkJvc2godGhpcyk7CiAgICB9CiAgICAvKiBUaGUgY29ubmVjdGVkIEpJRC4gKi8KICAgIHRoaXMuamlkID0gIiI7CiAgICAvKiB0aGUgSklEcyBkb21haW4gKi8KICAgIHRoaXMuZG9tYWluID0gbnVsbDsKICAgIC8qIHN0cmVhbTpmZWF0dXJlcyAqLwogICAgdGhpcy5mZWF0dXJlcyA9IG51bGw7CgogICAgLy8gU0FTTAogICAgdGhpcy5fc2FzbF9kYXRhID0ge307CiAgICB0aGlzLmRvX3Nlc3Npb24gPSBmYWxzZTsKICAgIHRoaXMuZG9fYmluZCA9IGZhbHNlOwoKICAgIC8vIGhhbmRsZXIgbGlzdHMKICAgIHRoaXMudGltZWRIYW5kbGVycyA9IFtdOwogICAgdGhpcy5oYW5kbGVycyA9IFtdOwogICAgdGhpcy5yZW1vdmVUaW1lZHMgPSBbXTsKICAgIHRoaXMucmVtb3ZlSGFuZGxlcnMgPSBbXTsKICAgIHRoaXMuYWRkVGltZWRzID0gW107CiAgICB0aGlzLmFkZEhhbmRsZXJzID0gW107CgogICAgdGhpcy5fYXV0aGVudGljYXRpb24gPSB7fTsKICAgIHRoaXMuX2lkbGVUaW1lb3V0ID0gbnVsbDsKICAgIHRoaXMuX2Rpc2Nvbm5lY3RUaW1lb3V0ID0gbnVsbDsKCiAgICB0aGlzLmRvX2F1dGhlbnRpY2F0aW9uID0gdHJ1ZTsKICAgIHRoaXMuYXV0aGVudGljYXRlZCA9IGZhbHNlOwogICAgdGhpcy5kaXNjb25uZWN0aW5nID0gZmFsc2U7CiAgICB0aGlzLmNvbm5lY3RlZCA9IGZhbHNlOwoKICAgIHRoaXMuZXJyb3JzID0gMDsKCiAgICB0aGlzLnBhdXNlZCA9IGZhbHNlOwoKICAgIHRoaXMuX2RhdGEgPSBbXTsKICAgIHRoaXMuX3VuaXF1ZUlkID0gMDsKCiAgICB0aGlzLl9zYXNsX3N1Y2Nlc3NfaGFuZGxlciA9IG51bGw7CiAgICB0aGlzLl9zYXNsX2ZhaWx1cmVfaGFuZGxlciA9IG51bGw7CiAgICB0aGlzLl9zYXNsX2NoYWxsZW5nZV9oYW5kbGVyID0gbnVsbDsKCiAgICAvLyBNYXggcmV0cmllcyBiZWZvcmUgZGlzY29ubmVjdGluZwogICAgdGhpcy5tYXhSZXRyaWVzID0gNTsKCiAgICAvLyBzZXR1cCBvbklkbGUgY2FsbGJhY2sgZXZlcnkgMS8xMHRoIG9mIGEgc2Vjb25kCiAgICB0aGlzLl9pZGxlVGltZW91dCA9IHNldFRpbWVvdXQodGhpcy5fb25JZGxlLmJpbmQodGhpcyksIDEwMCk7CgogICAgLy8gaW5pdGlhbGl6ZSBwbHVnaW5zCiAgICBmb3IgKHZhciBrIGluIFN0cm9waGUuX2Nvbm5lY3Rpb25QbHVnaW5zKSB7CiAgICAgICAgaWYgKFN0cm9waGUuX2Nvbm5lY3Rpb25QbHVnaW5zLmhhc093blByb3BlcnR5KGspKSB7CiAgICAgICAgICAgIHZhciBwdHlwZSA9IFN0cm9waGUuX2Nvbm5lY3Rpb25QbHVnaW5zW2tdOwogICAgICAgICAgICAvLyBqc2xpbnQgY29tcGxhaW50cyBhYm91dCB0aGUgYmVsb3cgbGluZSwgYnV0IHRoaXMgaXMgZmluZQogICAgICAgICAgICB2YXIgRiA9IGZ1bmN0aW9uICgpIHt9OyAvLyBqc2hpbnQgaWdub3JlOmxpbmUKICAgICAgICAgICAgRi5wcm90b3R5cGUgPSBwdHlwZTsKICAgICAgICAgICAgdGhpc1trXSA9IG5ldyBGKCk7CiAgICAgICAgICAgIHRoaXNba10uaW5pdCh0aGlzKTsKICAgICAgICB9CiAgICB9Cn07CgpTdHJvcGhlLkNvbm5lY3Rpb24ucHJvdG90eXBlID0gewogICAgLyoqIEZ1bmN0aW9uOiByZXNldAogICAgICogIFJlc2V0IHRoZSBjb25uZWN0aW9uLgogICAgICoKICAgICAqICBUaGlzIGZ1bmN0aW9uIHNob3VsZCBiZSBjYWxsZWQgYWZ0ZXIgYSBjb25uZWN0aW9uIGlzIGRpc2Nvbm5lY3RlZAogICAgICogIGJlZm9yZSB0aGF0IGNvbm5lY3Rpb24gaXMgcmV1c2VkLgogICAgICovCiAgICByZXNldDogZnVuY3Rpb24gKCkKICAgIHsKICAgICAgICB0aGlzLl9wcm90by5fcmVzZXQoKTsKCiAgICAgICAgLy8gU0FTTAogICAgICAgIHRoaXMuZG9fc2Vzc2lvbiA9IGZhbHNlOwogICAgICAgIHRoaXMuZG9fYmluZCA9IGZhbHNlOwoKICAgICAgICAvLyBoYW5kbGVyIGxpc3RzCiAgICAgICAgdGhpcy50aW1lZEhhbmRsZXJzID0gW107CiAgICAgICAgdGhpcy5oYW5kbGVycyA9IFtdOwogICAgICAgIHRoaXMucmVtb3ZlVGltZWRzID0gW107CiAgICAgICAgdGhpcy5yZW1vdmVIYW5kbGVycyA9IFtdOwogICAgICAgIHRoaXMuYWRkVGltZWRzID0gW107CiAgICAgICAgdGhpcy5hZGRIYW5kbGVycyA9IFtdOwogICAgICAgIHRoaXMuX2F1dGhlbnRpY2F0aW9uID0ge307CgogICAgICAgIHRoaXMuYXV0aGVudGljYXRlZCA9IGZhbHNlOwogICAgICAgIHRoaXMuZGlzY29ubmVjdGluZyA9IGZhbHNlOwogICAgICAgIHRoaXMuY29ubmVjdGVkID0gZmFsc2U7CgogICAgICAgIHRoaXMuZXJyb3JzID0gMDsKCiAgICAgICAgdGhpcy5fcmVxdWVzdHMgPSBbXTsKICAgICAgICB0aGlzLl91bmlxdWVJZCA9IDA7CiAgICB9LAoKICAgIC8qKiBGdW5jdGlvbjogcGF1c2UKICAgICAqICBQYXVzZSB0aGUgcmVxdWVzdCBtYW5hZ2VyLgogICAgICoKICAgICAqICBUaGlzIHdpbGwgcHJldmVudCBTdHJvcGhlIGZyb20gc2VuZGluZyBhbnkgbW9yZSByZXF1ZXN0cyB0byB0aGUKICAgICAqICBzZXJ2ZXIuICBUaGlzIGlzIHZlcnkgdXNlZnVsIGZvciB0ZW1wb3JhcmlseSBwYXVzaW5nCiAgICAgKiAgQk9TSC1Db25uZWN0aW9ucyB3aGlsZSBhIGxvdCBvZiBzZW5kKCkgY2FsbHMgYXJlIGhhcHBlbmluZyBxdWlja2x5LgogICAgICogIFRoaXMgY2F1c2VzIFN0cm9waGUgdG8gc2VuZCB0aGUgZGF0YSBpbiBhIHNpbmdsZSByZXF1ZXN0LCBzYXZpbmcKICAgICAqICBtYW55IHJlcXVlc3QgdHJpcHMuCiAgICAgKi8KICAgIHBhdXNlOiBmdW5jdGlvbiAoKQogICAgewogICAgICAgIHRoaXMucGF1c2VkID0gdHJ1ZTsKICAgIH0sCgogICAgLyoqIEZ1bmN0aW9uOiByZXN1bWUKICAgICAqICBSZXN1bWUgdGhlIHJlcXVlc3QgbWFuYWdlci4KICAgICAqCiAgICAgKiAgVGhpcyByZXN1bWVzIGFmdGVyIHBhdXNlKCkgaGFzIGJlZW4gY2FsbGVkLgogICAgICovCiAgICByZXN1bWU6IGZ1bmN0aW9uICgpCiAgICB7CiAgICAgICAgdGhpcy5wYXVzZWQgPSBmYWxzZTsKICAgIH0sCgogICAgLyoqIEZ1bmN0aW9uOiBnZXRVbmlxdWVJZAogICAgICogIEdlbmVyYXRlIGEgdW5pcXVlIElEIGZvciB1c2UgaW4gPGlxLz4gZWxlbWVudHMuCiAgICAgKgogICAgICogIEFsbCA8aXEvPiBzdGFuemFzIGFyZSByZXF1aXJlZCB0byBoYXZlIHVuaXF1ZSBpZCBhdHRyaWJ1dGVzLiAgVGhpcwogICAgICogIGZ1bmN0aW9uIG1ha2VzIGNyZWF0aW5nIHRoZXNlIGVhc3kuICBFYWNoIGNvbm5lY3Rpb24gaW5zdGFuY2UgaGFzCiAgICAgKiAgYSBjb3VudGVyIHdoaWNoIHN0YXJ0cyBmcm9tIHplcm8sIGFuZCB0aGUgdmFsdWUgb2YgdGhpcyBjb3VudGVyCiAgICAgKiAgcGx1cyBhIGNvbG9uIGZvbGxvd2VkIGJ5IHRoZSBzdWZmaXggYmVjb21lcyB0aGUgdW5pcXVlIGlkLiBJZiBubwogICAgICogIHN1ZmZpeCBpcyBzdXBwbGllZCwgdGhlIGNvdW50ZXIgaXMgdXNlZCBhcyB0aGUgdW5pcXVlIGlkLgogICAgICoKICAgICAqICBTdWZmaXhlcyBhcmUgdXNlZCB0byBtYWtlIGRlYnVnZ2luZyBlYXNpZXIgd2hlbiByZWFkaW5nIHRoZSBzdHJlYW0KICAgICAqICBkYXRhLCBhbmQgdGhlaXIgdXNlIGlzIHJlY29tbWVuZGVkLiAgVGhlIGNvdW50ZXIgcmVzZXRzIHRvIDAgZm9yCiAgICAgKiAgZXZlcnkgbmV3IGNvbm5lY3Rpb24gZm9yIHRoZSBzYW1lIHJlYXNvbi4gIEZvciBjb25uZWN0aW9ucyB0byB0aGUKICAgICAqICBzYW1lIHNlcnZlciB0aGF0IGF1dGhlbnRpY2F0ZSB0aGUgc2FtZSB3YXksIGFsbCB0aGUgaWRzIHNob3VsZCBiZQogICAgICogIHRoZSBzYW1lLCB3aGljaCBtYWtlcyBpdCBlYXN5IHRvIHNlZSBjaGFuZ2VzLiAgVGhpcyBpcyB1c2VmdWwgZm9yCiAgICAgKiAgYXV0b21hdGVkIHRlc3RpbmcgYXMgd2VsbC4KICAgICAqCiAgICAgKiAgUGFyYW1ldGVyczoKICAgICAqICAgIChTdHJpbmcpIHN1ZmZpeCAtIEEgb3B0aW9uYWwgc3VmZml4IHRvIGFwcGVuZCB0byB0aGUgaWQuCiAgICAgKgogICAgICogIFJldHVybnM6CiAgICAgKiAgICBBIHVuaXF1ZSBzdHJpbmcgdG8gYmUgdXNlZCBmb3IgdGhlIGlkIGF0dHJpYnV0ZS4KICAgICAqLwogICAgZ2V0VW5pcXVlSWQ6IGZ1bmN0aW9uIChzdWZmaXgpCiAgICB7CiAgICAgICAgaWYgKHR5cGVvZihzdWZmaXgpID09ICJzdHJpbmciIHx8IHR5cGVvZihzdWZmaXgpID09ICJudW1iZXIiKSB7CiAgICAgICAgICAgIHJldHVybiArK3RoaXMuX3VuaXF1ZUlkICsgIjoiICsgc3VmZml4OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiArK3RoaXMuX3VuaXF1ZUlkICsgIiI7CiAgICAgICAgfQogICAgfSwKCiAgICAvKiogRnVuY3Rpb246IGNvbm5lY3QKICAgICAqICBTdGFydHMgdGhlIGNvbm5lY3Rpb24gcHJvY2Vzcy4KICAgICAqCiAgICAgKiAgQXMgdGhlIGNvbm5lY3Rpb24gcHJvY2VzcyBwcm9jZWVkcywgdGhlIHVzZXIgc3VwcGxpZWQgY2FsbGJhY2sgd2lsbAogICAgICogIGJlIHRyaWdnZXJlZCBtdWx0aXBsZSB0aW1lcyB3aXRoIHN0YXR1cyB1cGRhdGVzLiAgVGhlIGNhbGxiYWNrCiAgICAgKiAgc2hvdWxkIHRha2UgdHdvIGFyZ3VtZW50cyAtIHRoZSBzdGF0dXMgY29kZSBhbmQgdGhlIGVycm9yIGNvbmRpdGlvbi4KICAgICAqCiAgICAgKiAgVGhlIHN0YXR1cyBjb2RlIHdpbGwgYmUgb25lIG9mIHRoZSB2YWx1ZXMgaW4gdGhlIFN0cm9waGUuU3RhdHVzCiAgICAgKiAgY29uc3RhbnRzLiAgVGhlIGVycm9yIGNvbmRpdGlvbiB3aWxsIGJlIG9uZSBvZiB0aGUgY29uZGl0aW9ucwogICAgICogIGRlZmluZWQgaW4gUkZDIDM5MjAgb3IgdGhlIGNvbmRpdGlvbiAnc3Ryb3BoZS1wYXJzZXJlcnJvcicuCiAgICAgKgogICAgICogIFRoZSBQYXJhbWV0ZXJzIF93YWl0XywgX2hvbGRfIGFuZCBfcm91dGVfIGFyZSBvcHRpb25hbCBhbmQgb25seSByZWxldmFudAogICAgICogIGZvciBCT1NIIGNvbm5lY3Rpb25zLiBQbGVhc2Ugc2VlIFhFUCAxMjQgZm9yIGEgbW9yZSBkZXRhaWxlZCBleHBsYW5hdGlvbgogICAgICogIG9mIHRoZSBvcHRpb25hbCBwYXJhbWV0ZXJzLgogICAgICoKICAgICAqICBQYXJhbWV0ZXJzOgogICAgICogICAgKFN0cmluZykgamlkIC0gVGhlIHVzZXIncyBKSUQuICBUaGlzIG1heSBiZSBhIGJhcmUgSklELAogICAgICogICAgICBvciBhIGZ1bGwgSklELiAgSWYgYSBub2RlIGlzIG5vdCBzdXBwbGllZCwgU0FTTCBBTk9OWU1PVVMKICAgICAqICAgICAgYXV0aGVudGljYXRpb24gd2lsbCBiZSBhdHRlbXB0ZWQuCiAgICAgKiAgICAoU3RyaW5nKSBwYXNzIC0gVGhlIHVzZXIncyBwYXNzd29yZC4KICAgICAqICAgIChGdW5jdGlvbikgY2FsbGJhY2sgLSBUaGUgY29ubmVjdCBjYWxsYmFjayBmdW5jdGlvbi4KICAgICAqICAgIChJbnRlZ2VyKSB3YWl0IC0gVGhlIG9wdGlvbmFsIEhUVFBCSU5EIHdhaXQgdmFsdWUuICBUaGlzIGlzIHRoZQogICAgICogICAgICB0aW1lIHRoZSBzZXJ2ZXIgd2lsbCB3YWl0IGJlZm9yZSByZXR1cm5pbmcgYW4gZW1wdHkgcmVzdWx0IGZvcgogICAgICogICAgICBhIHJlcXVlc3QuICBUaGUgZGVmYXVsdCBzZXR0aW5nIG9mIDYwIHNlY29uZHMgaXMgcmVjb21tZW5kZWQuCiAgICAgKiAgICAoSW50ZWdlcikgaG9sZCAtIFRoZSBvcHRpb25hbCBIVFRQQklORCBob2xkIHZhbHVlLiAgVGhpcyBpcyB0aGUKICAgICAqICAgICAgbnVtYmVyIG9mIGNvbm5lY3Rpb25zIHRoZSBzZXJ2ZXIgd2lsbCBob2xkIGF0IG9uZSB0aW1lLiAgVGhpcwogICAgICogICAgICBzaG91bGQgYWxtb3N0IGFsd2F5cyBiZSBzZXQgdG8gMSAodGhlIGRlZmF1bHQpLgogICAgICogICAgKFN0cmluZykgcm91dGUgLSBUaGUgb3B0aW9uYWwgcm91dGUgdmFsdWUuCiAgICAgKi8KICAgIGNvbm5lY3Q6IGZ1bmN0aW9uIChqaWQsIHBhc3MsIGNhbGxiYWNrLCB3YWl0LCBob2xkLCByb3V0ZSkKICAgIHsKICAgICAgICB0aGlzLmppZCA9IGppZDsKICAgICAgICAvKiogVmFyaWFibGU6IGF1dGh6aWQKICAgICAgICAgKiAgQXV0aG9yaXphdGlvbiBpZGVudGl0eS4KICAgICAgICAgKi8KICAgICAgICB0aGlzLmF1dGh6aWQgPSBTdHJvcGhlLmdldEJhcmVKaWRGcm9tSmlkKHRoaXMuamlkKTsKICAgICAgICAvKiogVmFyaWFibGU6IGF1dGhjaWQKICAgICAgICAgKiAgQXV0aGVudGljYXRpb24gaWRlbnRpdHkgKFVzZXIgbmFtZSkuCiAgICAgICAgICovCiAgICAgICAgdGhpcy5hdXRoY2lkID0gU3Ryb3BoZS5nZXROb2RlRnJvbUppZCh0aGlzLmppZCk7CiAgICAgICAgLyoqIFZhcmlhYmxlOiBwYXNzCiAgICAgICAgICogIEF1dGhlbnRpY2F0aW9uIGlkZW50aXR5IChVc2VyIHBhc3N3b3JkKS4KICAgICAgICAgKi8KICAgICAgICB0aGlzLnBhc3MgPSBwYXNzOwogICAgICAgIC8qKiBWYXJpYWJsZTogc2VydnR5cGUKICAgICAgICAgKiAgRGlnZXN0IE1ENSBjb21wYXRpYmlsaXR5LgogICAgICAgICAqLwogICAgICAgIHRoaXMuc2VydnR5cGUgPSAieG1wcCI7CiAgICAgICAgdGhpcy5jb25uZWN0X2NhbGxiYWNrID0gY2FsbGJhY2s7CiAgICAgICAgdGhpcy5kaXNjb25uZWN0aW5nID0gZmFsc2U7CiAgICAgICAgdGhpcy5jb25uZWN0ZWQgPSBmYWxzZTsKICAgICAgICB0aGlzLmF1dGhlbnRpY2F0ZWQgPSBmYWxzZTsKICAgICAgICB0aGlzLmVycm9ycyA9IDA7CgogICAgICAgIC8vIHBhcnNlIGppZCBmb3IgZG9tYWluCiAgICAgICAgdGhpcy5kb21haW4gPSBTdHJvcGhlLmdldERvbWFpbkZyb21KaWQodGhpcy5qaWQpOwoKICAgICAgICB0aGlzLl9jaGFuZ2VDb25uZWN0U3RhdHVzKFN0cm9waGUuU3RhdHVzLkNPTk5FQ1RJTkcsIG51bGwpOwoKICAgICAgICB0aGlzLl9wcm90by5fY29ubmVjdCh3YWl0LCBob2xkLCByb3V0ZSk7CiAgICB9LAoKICAgIC8qKiBGdW5jdGlvbjogYXR0YWNoCiAgICAgKiAgQXR0YWNoIHRvIGFuIGFscmVhZHkgY3JlYXRlZCBhbmQgYXV0aGVudGljYXRlZCBCT1NIIHNlc3Npb24uCiAgICAgKgogICAgICogIFRoaXMgZnVuY3Rpb24gaXMgcHJvdmlkZWQgdG8gYWxsb3cgU3Ryb3BoZSB0byBhdHRhY2ggdG8gQk9TSAogICAgICogIHNlc3Npb25zIHdoaWNoIGhhdmUgYmVlbiBjcmVhdGVkIGV4dGVybmFsbHksIHBlcmhhcHMgYnkgYSBXZWIKICAgICAqICBhcHBsaWNhdGlvbi4gIFRoaXMgaXMgb2Z0ZW4gdXNlZCB0byBzdXBwb3J0IGF1dG8tbG9naW4gdHlwZSBmZWF0dXJlcwogICAgICogIHdpdGhvdXQgcHV0dGluZyB1c2VyIGNyZWRlbnRpYWxzIGludG8gdGhlIHBhZ2UuCiAgICAgKgogICAgICogIFBhcmFtZXRlcnM6CiAgICAgKiAgICAoU3RyaW5nKSBqaWQgLSBUaGUgZnVsbCBKSUQgdGhhdCBpcyBib3VuZCBieSB0aGUgc2Vzc2lvbi4KICAgICAqICAgIChTdHJpbmcpIHNpZCAtIFRoZSBTSUQgb2YgdGhlIEJPU0ggc2Vzc2lvbi4KICAgICAqICAgIChTdHJpbmcpIHJpZCAtIFRoZSBjdXJyZW50IFJJRCBvZiB0aGUgQk9TSCBzZXNzaW9uLiAgVGhpcyBSSUQKICAgICAqICAgICAgd2lsbCBiZSB1c2VkIGJ5IHRoZSBuZXh0IHJlcXVlc3QuCiAgICAgKiAgICAoRnVuY3Rpb24pIGNhbGxiYWNrIFRoZSBjb25uZWN0IGNhbGxiYWNrIGZ1bmN0aW9uLgogICAgICogICAgKEludGVnZXIpIHdhaXQgLSBUaGUgb3B0aW9uYWwgSFRUUEJJTkQgd2FpdCB2YWx1ZS4gIFRoaXMgaXMgdGhlCiAgICAgKiAgICAgIHRpbWUgdGhlIHNlcnZlciB3aWxsIHdhaXQgYmVmb3JlIHJldHVybmluZyBhbiBlbXB0eSByZXN1bHQgZm9yCiAgICAgKiAgICAgIGEgcmVxdWVzdC4gIFRoZSBkZWZhdWx0IHNldHRpbmcgb2YgNjAgc2Vjb25kcyBpcyByZWNvbW1lbmRlZC4KICAgICAqICAgICAgT3RoZXIgc2V0dGluZ3Mgd2lsbCByZXF1aXJlIHR3ZWFrcyB0byB0aGUgU3Ryb3BoZS5USU1FT1VUIHZhbHVlLgogICAgICogICAgKEludGVnZXIpIGhvbGQgLSBUaGUgb3B0aW9uYWwgSFRUUEJJTkQgaG9sZCB2YWx1ZS4gIFRoaXMgaXMgdGhlCiAgICAgKiAgICAgIG51bWJlciBvZiBjb25uZWN0aW9ucyB0aGUgc2VydmVyIHdpbGwgaG9sZCBhdCBvbmUgdGltZS4gIFRoaXMKICAgICAqICAgICAgc2hvdWxkIGFsbW9zdCBhbHdheXMgYmUgc2V0IHRvIDEgKHRoZSBkZWZhdWx0KS4KICAgICAqICAgIChJbnRlZ2VyKSB3aW5kIC0gVGhlIG9wdGlvbmFsIEhUVEJJTkQgd2luZG93IHZhbHVlLiAgVGhpcyBpcyB0aGUKICAgICAqICAgICAgYWxsb3dlZCByYW5nZSBvZiByZXF1ZXN0IGlkcyB0aGF0IGFyZSB2YWxpZC4gIFRoZSBkZWZhdWx0IGlzIDUuCiAgICAgKi8KICAgIGF0dGFjaDogZnVuY3Rpb24gKGppZCwgc2lkLCByaWQsIGNhbGxiYWNrLCB3YWl0LCBob2xkLCB3aW5kKQogICAgewogICAgICAgIHRoaXMuX3Byb3RvLl9hdHRhY2goamlkLCBzaWQsIHJpZCwgY2FsbGJhY2ssIHdhaXQsIGhvbGQsIHdpbmQpOwogICAgfSwKCiAgICAvKiogRnVuY3Rpb246IHhtbElucHV0CiAgICAgKiAgVXNlciBvdmVycmlkZWFibGUgZnVuY3Rpb24gdGhhdCByZWNlaXZlcyBYTUwgZGF0YSBjb21pbmcgaW50byB0aGUKICAgICAqICBjb25uZWN0aW9uLgogICAgICoKICAgICAqICBUaGUgZGVmYXVsdCBmdW5jdGlvbiBkb2VzIG5vdGhpbmcuICBVc2VyIGNvZGUgY2FuIG92ZXJyaWRlIHRoaXMgd2l0aAogICAgICogID4gU3Ryb3BoZS5Db25uZWN0aW9uLnhtbElucHV0ID0gZnVuY3Rpb24gKGVsZW0pIHsKICAgICAqICA+ICAgKHVzZXIgY29kZSkKICAgICAqICA+IH07CiAgICAgKgogICAgICogIER1ZSB0byBsaW1pdGF0aW9ucyBvZiBjdXJyZW50IEJyb3dzZXJzJyBYTUwtUGFyc2VycyB0aGUgb3BlbmluZyBhbmQgY2xvc2luZwogICAgICogIDxzdHJlYW0+IHRhZyBmb3IgV2ViU29ja2V0LUNvbm5vY3Rpb25zIHdpbGwgYmUgcGFzc2VkIGFzIHNlbGZjbG9zaW5nIGhlcmUuCiAgICAgKgogICAgICogIEJPU0gtQ29ubmVjdGlvbnMgd2lsbCBoYXZlIGFsbCBzdGFuemFzIHdyYXBwZWQgaW4gYSA8Ym9keT4gdGFnLiBTZWUKICAgICAqICA8U3Ryb3BoZS5Cb3NoLnN0cmlwPiBpZiB5b3Ugd2FudCB0byBzdHJpcCB0aGlzIHRhZy4KICAgICAqCiAgICAgKiAgUGFyYW1ldGVyczoKICAgICAqICAgIChYTUxFbGVtZW50KSBlbGVtIC0gVGhlIFhNTCBkYXRhIHJlY2VpdmVkIGJ5IHRoZSBjb25uZWN0aW9uLgogICAgICovCiAgICAvKiBqc2hpbnQgdW51c2VkOmZhbHNlICovCiAgICB4bWxJbnB1dDogZnVuY3Rpb24gKGVsZW0pCiAgICB7CiAgICAgICAgcmV0dXJuOwogICAgfSwKICAgIC8qIGpzaGludCB1bnVzZWQ6dHJ1ZSAqLwoKICAgIC8qKiBGdW5jdGlvbjogeG1sT3V0cHV0CiAgICAgKiAgVXNlciBvdmVycmlkZWFibGUgZnVuY3Rpb24gdGhhdCByZWNlaXZlcyBYTUwgZGF0YSBzZW50IHRvIHRoZQogICAgICogIGNvbm5lY3Rpb24uCiAgICAgKgogICAgICogIFRoZSBkZWZhdWx0IGZ1bmN0aW9uIGRvZXMgbm90aGluZy4gIFVzZXIgY29kZSBjYW4gb3ZlcnJpZGUgdGhpcyB3aXRoCiAgICAgKiAgPiBTdHJvcGhlLkNvbm5lY3Rpb24ueG1sT3V0cHV0ID0gZnVuY3Rpb24gKGVsZW0pIHsKICAgICAqICA+ICAgKHVzZXIgY29kZSkKICAgICAqICA+IH07CiAgICAgKgogICAgICogIER1ZSB0byBsaW1pdGF0aW9ucyBvZiBjdXJyZW50IEJyb3dzZXJzJyBYTUwtUGFyc2VycyB0aGUgb3BlbmluZyBhbmQgY2xvc2luZwogICAgICogIDxzdHJlYW0+IHRhZyBmb3IgV2ViU29ja2V0LUNvbm5vY3Rpb25zIHdpbGwgYmUgcGFzc2VkIGFzIHNlbGZjbG9zaW5nIGhlcmUuCiAgICAgKgogICAgICogIEJPU0gtQ29ubmVjdGlvbnMgd2lsbCBoYXZlIGFsbCBzdGFuemFzIHdyYXBwZWQgaW4gYSA8Ym9keT4gdGFnLiBTZWUKICAgICAqICA8U3Ryb3BoZS5Cb3NoLnN0cmlwPiBpZiB5b3Ugd2FudCB0byBzdHJpcCB0aGlzIHRhZy4KICAgICAqCiAgICAgKiAgUGFyYW1ldGVyczoKICAgICAqICAgIChYTUxFbGVtZW50KSBlbGVtIC0gVGhlIFhNTGRhdGEgc2VudCBieSB0aGUgY29ubmVjdGlvbi4KICAgICAqLwogICAgLyoganNoaW50IHVudXNlZDpmYWxzZSAqLwogICAgeG1sT3V0cHV0OiBmdW5jdGlvbiAoZWxlbSkKICAgIHsKICAgICAgICByZXR1cm47CiAgICB9LAogICAgLyoganNoaW50IHVudXNlZDp0cnVlICovCgogICAgLyoqIEZ1bmN0aW9uOiByYXdJbnB1dAogICAgICogIFVzZXIgb3ZlcnJpZGVhYmxlIGZ1bmN0aW9uIHRoYXQgcmVjZWl2ZXMgcmF3IGRhdGEgY29taW5nIGludG8gdGhlCiAgICAgKiAgY29ubmVjdGlvbi4KICAgICAqCiAgICAgKiAgVGhlIGRlZmF1bHQgZnVuY3Rpb24gZG9lcyBub3RoaW5nLiAgVXNlciBjb2RlIGNhbiBvdmVycmlkZSB0aGlzIHdpdGgKICAgICAqICA+IFN0cm9waGUuQ29ubmVjdGlvbi5yYXdJbnB1dCA9IGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgKiAgPiAgICh1c2VyIGNvZGUpCiAgICAgKiAgPiB9OwogICAgICoKICAgICAqICBQYXJhbWV0ZXJzOgogICAgICogICAgKFN0cmluZykgZGF0YSAtIFRoZSBkYXRhIHJlY2VpdmVkIGJ5IHRoZSBjb25uZWN0aW9uLgogICAgICovCiAgICAvKiBqc2hpbnQgdW51c2VkOmZhbHNlICovCiAgICByYXdJbnB1dDogZnVuY3Rpb24gKGRhdGEpCiAgICB7CiAgICAgICAgcmV0dXJuOwogICAgfSwKICAgIC8qIGpzaGludCB1bnVzZWQ6dHJ1ZSAqLwoKICAgIC8qKiBGdW5jdGlvbjogcmF3T3V0cHV0CiAgICAgKiAgVXNlciBvdmVycmlkZWFibGUgZnVuY3Rpb24gdGhhdCByZWNlaXZlcyByYXcgZGF0YSBzZW50IHRvIHRoZQogICAgICogIGNvbm5lY3Rpb24uCiAgICAgKgogICAgICogIFRoZSBkZWZhdWx0IGZ1bmN0aW9uIGRvZXMgbm90aGluZy4gIFVzZXIgY29kZSBjYW4gb3ZlcnJpZGUgdGhpcyB3aXRoCiAgICAgKiAgPiBTdHJvcGhlLkNvbm5lY3Rpb24ucmF3T3V0cHV0ID0gZnVuY3Rpb24gKGRhdGEpIHsKICAgICAqICA+ICAgKHVzZXIgY29kZSkKICAgICAqICA+IH07CiAgICAgKgogICAgICogIFBhcmFtZXRlcnM6CiAgICAgKiAgICAoU3RyaW5nKSBkYXRhIC0gVGhlIGRhdGEgc2VudCBieSB0aGUgY29ubmVjdGlvbi4KICAgICAqLwogICAgLyoganNoaW50IHVudXNlZDpmYWxzZSAqLwogICAgcmF3T3V0cHV0OiBmdW5jdGlvbiAoZGF0YSkKICAgIHsKICAgICAgICByZXR1cm47CiAgICB9LAogICAgLyoganNoaW50IHVudXNlZDp0cnVlICovCgogICAgLyoqIEZ1bmN0aW9uOiBzZW5kCiAgICAgKiAgU2VuZCBhIHN0YW56YS4KICAgICAqCiAgICAgKiAgVGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgdG8gcHVzaCBkYXRhIG9udG8gdGhlIHNlbmQgcXVldWUgdG8KICAgICAqICBnbyBvdXQgb3ZlciB0aGUgd2lyZS4gIFdoZW5ldmVyIGEgcmVxdWVzdCBpcyBzZW50IHRvIHRoZSBCT1NICiAgICAgKiAgc2VydmVyLCBhbGwgcGVuZGluZyBkYXRhIGlzIHNlbnQgYW5kIHRoZSBxdWV1ZSBpcyBmbHVzaGVkLgogICAgICoKICAgICAqICBQYXJhbWV0ZXJzOgogICAgICogICAgKFhNTEVsZW1lbnQgfAogICAgICogICAgIFtYTUxFbGVtZW50XSB8CiAgICAgKiAgICAgU3Ryb3BoZS5CdWlsZGVyKSBlbGVtIC0gVGhlIHN0YW56YSB0byBzZW5kLgogICAgICovCiAgICBzZW5kOiBmdW5jdGlvbiAoZWxlbSkKICAgIHsKICAgICAgICBpZiAoZWxlbSA9PT0gbnVsbCkgeyByZXR1cm4gOyB9CiAgICAgICAgaWYgKHR5cGVvZihlbGVtLnNvcnQpID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZWxlbS5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgdGhpcy5fcXVldWVEYXRhKGVsZW1baV0pOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YoZWxlbS50cmVlKSA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICB0aGlzLl9xdWV1ZURhdGEoZWxlbS50cmVlKCkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuX3F1ZXVlRGF0YShlbGVtKTsKICAgICAgICB9CgogICAgICAgIHRoaXMuX3Byb3RvLl9zZW5kKCk7CiAgICB9LAoKICAgIC8qKiBGdW5jdGlvbjogZmx1c2gKICAgICAqICBJbW1lZGlhdGVseSBzZW5kIGFueSBwZW5kaW5nIG91dGdvaW5nIGRhdGEuCiAgICAgKgogICAgICogIE5vcm1hbGx5IHNlbmQoKSBxdWV1ZXMgb3V0Z29pbmcgZGF0YSB1bnRpbCB0aGUgbmV4dCBpZGxlIHBlcmlvZAogICAgICogICgxMDBtcyksIHdoaWNoIG9wdGltaXplcyBuZXR3b3JrIHVzZSBpbiB0aGUgY29tbW9uIGNhc2VzIHdoZW4KICAgICAqICBzZXZlcmFsIHNlbmQoKXMgYXJlIGNhbGxlZCBpbiBzdWNjZXNzaW9uLiBmbHVzaCgpIGNhbiBiZSB1c2VkIHRvCiAgICAgKiAgaW1tZWRpYXRlbHkgc2VuZCBhbGwgcGVuZGluZyBkYXRhLgogICAgICovCiAgICBmbHVzaDogZnVuY3Rpb24gKCkKICAgIHsKICAgICAgICAvLyBjYW5jZWwgdGhlIHBlbmRpbmcgaWRsZSBwZXJpb2QgYW5kIHJ1biB0aGUgaWRsZSBmdW5jdGlvbgogICAgICAgIC8vIGltbWVkaWF0ZWx5CiAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuX2lkbGVUaW1lb3V0KTsKICAgICAgICB0aGlzLl9vbklkbGUoKTsKICAgIH0sCgogICAgLyoqIEZ1bmN0aW9uOiBzZW5kSVEKICAgICAqICBIZWxwZXIgZnVuY3Rpb24gdG8gc2VuZCBJUSBzdGFuemFzLgogICAgICoKICAgICAqICBQYXJhbWV0ZXJzOgogICAgICogICAgKFhNTEVsZW1lbnQpIGVsZW0gLSBUaGUgc3RhbnphIHRvIHNlbmQuCiAgICAgKiAgICAoRnVuY3Rpb24pIGNhbGxiYWNrIC0gVGhlIGNhbGxiYWNrIGZ1bmN0aW9uIGZvciBhIHN1Y2Nlc3NmdWwgcmVxdWVzdC4KICAgICAqICAgIChGdW5jdGlvbikgZXJyYmFjayAtIFRoZSBjYWxsYmFjayBmdW5jdGlvbiBmb3IgYSBmYWlsZWQgb3IgdGltZWQKICAgICAqICAgICAgb3V0IHJlcXVlc3QuICBPbiB0aW1lb3V0LCB0aGUgc3RhbnphIHdpbGwgYmUgbnVsbC4KICAgICAqICAgIChJbnRlZ2VyKSB0aW1lb3V0IC0gVGhlIHRpbWUgc3BlY2lmaWVkIGluIG1pbGxpc2Vjb25kcyBmb3IgYQogICAgICogICAgICB0aW1lb3V0IHRvIG9jY3VyLgogICAgICoKICAgICAqICBSZXR1cm5zOgogICAgICogICAgVGhlIGlkIHVzZWQgdG8gc2VuZCB0aGUgSVEuCiAgICAqLwogICAgc2VuZElROiBmdW5jdGlvbihlbGVtLCBjYWxsYmFjaywgZXJyYmFjaywgdGltZW91dCkgewogICAgICAgIHZhciB0aW1lb3V0SGFuZGxlciA9IG51bGw7CiAgICAgICAgdmFyIHRoYXQgPSB0aGlzOwoKICAgICAgICBpZiAodHlwZW9mKGVsZW0udHJlZSkgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgZWxlbSA9IGVsZW0udHJlZSgpOwogICAgICAgIH0KICAgICAgICB2YXIgaWQgPSBlbGVtLmdldEF0dHJpYnV0ZSgnaWQnKTsKCiAgICAgICAgLy8gaW5qZWN0IGlkIGlmIG5vdCBmb3VuZAogICAgICAgIGlmICghaWQpIHsKICAgICAgICAgICAgaWQgPSB0aGlzLmdldFVuaXF1ZUlkKCJzZW5kSVEiKTsKICAgICAgICAgICAgZWxlbS5zZXRBdHRyaWJ1dGUoImlkIiwgaWQpOwogICAgICAgIH0KCiAgICAgICAgdmFyIGhhbmRsZXIgPSB0aGlzLmFkZEhhbmRsZXIoZnVuY3Rpb24gKHN0YW56YSkgewogICAgICAgICAgICAvLyByZW1vdmUgdGltZW91dCBoYW5kbGVyIGlmIHRoZXJlIGlzIG9uZQogICAgICAgICAgICBpZiAodGltZW91dEhhbmRsZXIpIHsKICAgICAgICAgICAgICAgIHRoYXQuZGVsZXRlVGltZWRIYW5kbGVyKHRpbWVvdXRIYW5kbGVyKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGlxdHlwZSA9IHN0YW56YS5nZXRBdHRyaWJ1dGUoJ3R5cGUnKTsKICAgICAgICAgICAgaWYgKGlxdHlwZSA9PSAncmVzdWx0JykgewogICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrKSB7CiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soc3RhbnphKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChpcXR5cGUgPT0gJ2Vycm9yJykgewogICAgICAgICAgICAgICAgaWYgKGVycmJhY2spIHsKICAgICAgICAgICAgICAgICAgICBlcnJiYWNrKHN0YW56YSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aHJvdyB7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogIlN0cm9waGVFcnJvciIsCiAgICAgICAgICAgIG1lc3NhZ2U6ICJHb3QgYmFkIElRIHR5cGUgb2YgIiArIGlxdHlwZQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgIH0sIG51bGwsICdpcScsIG51bGwsIGlkKTsKCiAgICAgICAgLy8gaWYgdGltZW91dCBzcGVjaWZpZWQsIHNldHVwIHRpbWVvdXQgaGFuZGxlci4KICAgICAgICBpZiAodGltZW91dCkgewogICAgICAgICAgICB0aW1lb3V0SGFuZGxlciA9IHRoaXMuYWRkVGltZWRIYW5kbGVyKHRpbWVvdXQsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIC8vIGdldCByaWQgb2Ygbm9ybWFsIGhhbmRsZXIKICAgICAgICAgICAgICAgIHRoYXQuZGVsZXRlSGFuZGxlcihoYW5kbGVyKTsKCiAgICAgICAgICAgICAgICAvLyBjYWxsIGVycmJhY2sgb24gdGltZW91dCB3aXRoIG51bGwgc3RhbnphCiAgICAgICAgICAgICAgICBpZiAoZXJyYmFjaykgewogICAgICAgICAgICAgICAgICAgIGVycmJhY2sobnVsbCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5zZW5kKGVsZW0pOwoKICAgICAgICByZXR1cm4gaWQ7CiAgICB9LAoKICAgIC8qKiBQcml2YXRlRnVuY3Rpb246IF9xdWV1ZURhdGEKICAgICAqICBRdWV1ZSBvdXRnb2luZyBkYXRhIGZvciBsYXRlciBzZW5kaW5nLiAgQWxzbyBlbnN1cmVzIHRoYXQgdGhlIGRhdGEKICAgICAqICBpcyBhIERPTUVsZW1lbnQuCiAgICAgKi8KICAgIF9xdWV1ZURhdGE6IGZ1bmN0aW9uIChlbGVtZW50KSB7CiAgICAgICAgaWYgKGVsZW1lbnQgPT09IG51bGwgfHwKICAgICAgICAgICAgIWVsZW1lbnQudGFnTmFtZSB8fAogICAgICAgICAgICAhZWxlbWVudC5jaGlsZE5vZGVzKSB7CiAgICAgICAgICAgIHRocm93IHsKICAgICAgICAgICAgICAgIG5hbWU6ICJTdHJvcGhlRXJyb3IiLAogICAgICAgICAgICAgICAgbWVzc2FnZTogIkNhbm5vdCBxdWV1ZSBub24tRE9NRWxlbWVudC4iCiAgICAgICAgICAgIH07CiAgICAgICAgfQoKICAgICAgICB0aGlzLl9kYXRhLnB1c2goZWxlbWVudCk7CiAgICB9LAoKICAgIC8qKiBQcml2YXRlRnVuY3Rpb246IF9zZW5kUmVzdGFydAogICAgICogIFNlbmQgYW4geG1wcDpyZXN0YXJ0IHN0YW56YS4KICAgICAqLwogICAgX3NlbmRSZXN0YXJ0OiBmdW5jdGlvbiAoKQogICAgewogICAgICAgIHRoaXMuX2RhdGEucHVzaCgicmVzdGFydCIpOwoKICAgICAgICB0aGlzLl9wcm90by5fc2VuZFJlc3RhcnQoKTsKCiAgICAgICAgdGhpcy5faWRsZVRpbWVvdXQgPSBzZXRUaW1lb3V0KHRoaXMuX29uSWRsZS5iaW5kKHRoaXMpLCAxMDApOwogICAgfSwKCiAgICAvKiogRnVuY3Rpb246IGFkZFRpbWVkSGFuZGxlcgogICAgICogIEFkZCBhIHRpbWVkIGhhbmRsZXIgdG8gdGhlIGNvbm5lY3Rpb24uCiAgICAgKgogICAgICogIFRoaXMgZnVuY3Rpb24gYWRkcyBhIHRpbWVkIGhhbmRsZXIuICBUaGUgcHJvdmlkZWQgaGFuZGxlciB3aWxsCiAgICAgKiAgYmUgY2FsbGVkIGV2ZXJ5IHBlcmlvZCBtaWxsaXNlY29uZHMgdW50aWwgaXQgcmV0dXJucyBmYWxzZSwKICAgICAqICB0aGUgY29ubmVjdGlvbiBpcyB0ZXJtaW5hdGVkLCBvciB0aGUgaGFuZGxlciBpcyByZW1vdmVkLiAgSGFuZGxlcnMKICAgICAqICB0aGF0IHdpc2ggdG8gY29udGludWUgYmVpbmcgaW52b2tlZCBzaG91bGQgcmV0dXJuIHRydWUuCiAgICAgKgogICAgICogIEJlY2F1c2Ugb2YgbWV0aG9kIGJpbmRpbmcgaXQgaXMgbmVjZXNzYXJ5IHRvIHNhdmUgdGhlIHJlc3VsdCBvZgogICAgICogIHRoaXMgZnVuY3Rpb24gaWYgeW91IHdpc2ggdG8gcmVtb3ZlIGEgaGFuZGxlciB3aXRoCiAgICAgKiAgZGVsZXRlVGltZWRIYW5kbGVyKCkuCiAgICAgKgogICAgICogIE5vdGUgdGhhdCB1c2VyIGhhbmRsZXJzIGFyZSBub3QgYWN0aXZlIHVudGlsIGF1dGhlbnRpY2F0aW9uIGlzCiAgICAgKiAgc3VjY2Vzc2Z1bC4KICAgICAqCiAgICAgKiAgUGFyYW1ldGVyczoKICAgICAqICAgIChJbnRlZ2VyKSBwZXJpb2QgLSBUaGUgcGVyaW9kIG9mIHRoZSBoYW5kbGVyLgogICAgICogICAgKEZ1bmN0aW9uKSBoYW5kbGVyIC0gVGhlIGNhbGxiYWNrIGZ1bmN0aW9uLgogICAgICoKICAgICAqICBSZXR1cm5zOgogICAgICogICAgQSByZWZlcmVuY2UgdG8gdGhlIGhhbmRsZXIgdGhhdCBjYW4gYmUgdXNlZCB0byByZW1vdmUgaXQuCiAgICAgKi8KICAgIGFkZFRpbWVkSGFuZGxlcjogZnVuY3Rpb24gKHBlcmlvZCwgaGFuZGxlcikKICAgIHsKICAgICAgICB2YXIgdGhhbmQgPSBuZXcgU3Ryb3BoZS5UaW1lZEhhbmRsZXIocGVyaW9kLCBoYW5kbGVyKTsKICAgICAgICB0aGlzLmFkZFRpbWVkcy5wdXNoKHRoYW5kKTsKICAgICAgICByZXR1cm4gdGhhbmQ7CiAgICB9LAoKICAgIC8qKiBGdW5jdGlvbjogZGVsZXRlVGltZWRIYW5kbGVyCiAgICAgKiAgRGVsZXRlIGEgdGltZWQgaGFuZGxlciBmb3IgYSBjb25uZWN0aW9uLgogICAgICoKICAgICAqICBUaGlzIGZ1bmN0aW9uIHJlbW92ZXMgYSB0aW1lZCBoYW5kbGVyIGZyb20gdGhlIGNvbm5lY3Rpb24uICBUaGUKICAgICAqICBoYW5kUmVmIHBhcmFtZXRlciBpcyAqbm90KiB0aGUgZnVuY3Rpb24gcGFzc2VkIHRvIGFkZFRpbWVkSGFuZGxlcigpLAogICAgICogIGJ1dCBpcyB0aGUgcmVmZXJlbmNlIHJldHVybmVkIGZyb20gYWRkVGltZWRIYW5kbGVyKCkuCiAgICAgKgogICAgICogIFBhcmFtZXRlcnM6CiAgICAgKiAgICAoU3Ryb3BoZS5UaW1lZEhhbmRsZXIpIGhhbmRSZWYgLSBUaGUgaGFuZGxlciByZWZlcmVuY2UuCiAgICAgKi8KICAgIGRlbGV0ZVRpbWVkSGFuZGxlcjogZnVuY3Rpb24gKGhhbmRSZWYpCiAgICB7CiAgICAgICAgLy8gdGhpcyBtdXN0IGJlIGRvbmUgaW4gdGhlIElkbGUgbG9vcCBzbyB0aGF0IHdlIGRvbid0IGNoYW5nZQogICAgICAgIC8vIHRoZSBoYW5kbGVycyBkdXJpbmcgaXRlcmF0aW9uCiAgICAgICAgdGhpcy5yZW1vdmVUaW1lZHMucHVzaChoYW5kUmVmKTsKICAgIH0sCgogICAgLyoqIEZ1bmN0aW9uOiBhZGRIYW5kbGVyCiAgICAgKiAgQWRkIGEgc3RhbnphIGhhbmRsZXIgZm9yIHRoZSBjb25uZWN0aW9uLgogICAgICoKICAgICAqICBUaGlzIGZ1bmN0aW9uIGFkZHMgYSBzdGFuemEgaGFuZGxlciB0byB0aGUgY29ubmVjdGlvbi4gIFRoZQogICAgICogIGhhbmRsZXIgY2FsbGJhY2sgd2lsbCBiZSBjYWxsZWQgZm9yIGFueSBzdGFuemEgdGhhdCBtYXRjaGVzCiAgICAgKiAgdGhlIHBhcmFtZXRlcnMuICBOb3RlIHRoYXQgaWYgbXVsdGlwbGUgcGFyYW1ldGVycyBhcmUgc3VwcGxpZWQsCiAgICAgKiAgdGhleSBtdXN0IGFsbCBtYXRjaCBmb3IgdGhlIGhhbmRsZXIgdG8gYmUgaW52b2tlZC4KICAgICAqCiAgICAgKiAgVGhlIGhhbmRsZXIgd2lsbCByZWNlaXZlIHRoZSBzdGFuemEgdGhhdCB0cmlnZ2VyZWQgaXQgYXMgaXRzIGFyZ3VtZW50LgogICAgICogIFRoZSBoYW5kbGVyIHNob3VsZCByZXR1cm4gdHJ1ZSBpZiBpdCBpcyB0byBiZSBpbnZva2VkIGFnYWluOwogICAgICogIHJldHVybmluZyBmYWxzZSB3aWxsIHJlbW92ZSB0aGUgaGFuZGxlciBhZnRlciBpdCByZXR1cm5zLgogICAgICoKICAgICAqICBBcyBhIGNvbnZlbmllbmNlLCB0aGUgbnMgcGFyYW1ldGVycyBhcHBsaWVzIHRvIHRoZSB0b3AgbGV2ZWwgZWxlbWVudAogICAgICogIGFuZCBhbHNvIGFueSBvZiBpdHMgaW1tZWRpYXRlIGNoaWxkcmVuLiAgVGhpcyBpcyBwcmltYXJpbHkgdG8gbWFrZQogICAgICogIG1hdGNoaW5nIC9pcS9xdWVyeSBlbGVtZW50cyBlYXN5LgogICAgICoKICAgICAqICBUaGUgb3B0aW9ucyBhcmd1bWVudCBjb250YWlucyBoYW5kbGVyIG1hdGNoaW5nIGZsYWdzIHRoYXQgYWZmZWN0IGhvdwogICAgICogIG1hdGNoZXMgYXJlIGRldGVybWluZWQuIEN1cnJlbnRseSB0aGUgb25seSBmbGFnIGlzIG1hdGNoQmFyZSAoYQogICAgICogIGJvb2xlYW4pLiBXaGVuIG1hdGNoQmFyZSBpcyB0cnVlLCB0aGUgZnJvbSBwYXJhbWV0ZXIgYW5kIHRoZSBmcm9tCiAgICAgKiAgYXR0cmlidXRlIG9uIHRoZSBzdGFuemEgd2lsbCBiZSBtYXRjaGVkIGFzIGJhcmUgSklEcyBpbnN0ZWFkIG9mCiAgICAgKiAgZnVsbCBKSURzLiBUbyB1c2UgdGhpcywgcGFzcyB7bWF0Y2hCYXJlOiB0cnVlfSBhcyB0aGUgdmFsdWUgb2YKICAgICAqICBvcHRpb25zLiBUaGUgZGVmYXVsdCB2YWx1ZSBmb3IgbWF0Y2hCYXJlIGlzIGZhbHNlLgogICAgICoKICAgICAqICBUaGUgcmV0dXJuIHZhbHVlIHNob3VsZCBiZSBzYXZlZCBpZiB5b3Ugd2lzaCB0byByZW1vdmUgdGhlIGhhbmRsZXIKICAgICAqICB3aXRoIGRlbGV0ZUhhbmRsZXIoKS4KICAgICAqCiAgICAgKiAgUGFyYW1ldGVyczoKICAgICAqICAgIChGdW5jdGlvbikgaGFuZGxlciAtIFRoZSB1c2VyIGNhbGxiYWNrLgogICAgICogICAgKFN0cmluZykgbnMgLSBUaGUgbmFtZXNwYWNlIHRvIG1hdGNoLgogICAgICogICAgKFN0cmluZykgbmFtZSAtIFRoZSBzdGFuemEgbmFtZSB0byBtYXRjaC4KICAgICAqICAgIChTdHJpbmcpIHR5cGUgLSBUaGUgc3RhbnphIHR5cGUgYXR0cmlidXRlIHRvIG1hdGNoLgogICAgICogICAgKFN0cmluZykgaWQgLSBUaGUgc3RhbnphIGlkIGF0dHJpYnV0ZSB0byBtYXRjaC4KICAgICAqICAgIChTdHJpbmcpIGZyb20gLSBUaGUgc3RhbnphIGZyb20gYXR0cmlidXRlIHRvIG1hdGNoLgogICAgICogICAgKFN0cmluZykgb3B0aW9ucyAtIFRoZSBoYW5kbGVyIG9wdGlvbnMKICAgICAqCiAgICAgKiAgUmV0dXJuczoKICAgICAqICAgIEEgcmVmZXJlbmNlIHRvIHRoZSBoYW5kbGVyIHRoYXQgY2FuIGJlIHVzZWQgdG8gcmVtb3ZlIGl0LgogICAgICovCiAgICBhZGRIYW5kbGVyOiBmdW5jdGlvbiAoaGFuZGxlciwgbnMsIG5hbWUsIHR5cGUsIGlkLCBmcm9tLCBvcHRpb25zKQogICAgewogICAgICAgIHZhciBoYW5kID0gbmV3IFN0cm9waGUuSGFuZGxlcihoYW5kbGVyLCBucywgbmFtZSwgdHlwZSwgaWQsIGZyb20sIG9wdGlvbnMpOwogICAgICAgIHRoaXMuYWRkSGFuZGxlcnMucHVzaChoYW5kKTsKICAgICAgICByZXR1cm4gaGFuZDsKICAgIH0sCgogICAgLyoqIEZ1bmN0aW9uOiBkZWxldGVIYW5kbGVyCiAgICAgKiAgRGVsZXRlIGEgc3RhbnphIGhhbmRsZXIgZm9yIGEgY29ubmVjdGlvbi4KICAgICAqCiAgICAgKiAgVGhpcyBmdW5jdGlvbiByZW1vdmVzIGEgc3RhbnphIGhhbmRsZXIgZnJvbSB0aGUgY29ubmVjdGlvbi4gIFRoZQogICAgICogIGhhbmRSZWYgcGFyYW1ldGVyIGlzICpub3QqIHRoZSBmdW5jdGlvbiBwYXNzZWQgdG8gYWRkSGFuZGxlcigpLAogICAgICogIGJ1dCBpcyB0aGUgcmVmZXJlbmNlIHJldHVybmVkIGZyb20gYWRkSGFuZGxlcigpLgogICAgICoKICAgICAqICBQYXJhbWV0ZXJzOgogICAgICogICAgKFN0cm9waGUuSGFuZGxlcikgaGFuZFJlZiAtIFRoZSBoYW5kbGVyIHJlZmVyZW5jZS4KICAgICAqLwogICAgZGVsZXRlSGFuZGxlcjogZnVuY3Rpb24gKGhhbmRSZWYpCiAgICB7CiAgICAgICAgLy8gdGhpcyBtdXN0IGJlIGRvbmUgaW4gdGhlIElkbGUgbG9vcCBzbyB0aGF0IHdlIGRvbid0IGNoYW5nZQogICAgICAgIC8vIHRoZSBoYW5kbGVycyBkdXJpbmcgaXRlcmF0aW9uCiAgICAgICAgdGhpcy5yZW1vdmVIYW5kbGVycy5wdXNoKGhhbmRSZWYpOwogICAgfSwKCiAgICAvKiogRnVuY3Rpb246IGRpc2Nvbm5lY3QKICAgICAqICBTdGFydCB0aGUgZ3JhY2VmdWwgZGlzY29ubmVjdGlvbiBwcm9jZXNzLgogICAgICoKICAgICAqICBUaGlzIGZ1bmN0aW9uIHN0YXJ0cyB0aGUgZGlzY29ubmVjdGlvbiBwcm9jZXNzLiAgVGhpcyBwcm9jZXNzIHN0YXJ0cwogICAgICogIGJ5IHNlbmRpbmcgdW5hdmFpbGFibGUgcHJlc2VuY2UgYW5kIHNlbmRpbmcgQk9TSCBib2R5IG9mIHR5cGUKICAgICAqICB0ZXJtaW5hdGUuICBBIHRpbWVvdXQgaGFuZGxlciBtYWtlcyBzdXJlIHRoYXQgZGlzY29ubmVjdGlvbiBoYXBwZW5zCiAgICAgKiAgZXZlbiBpZiB0aGUgQk9TSCBzZXJ2ZXIgZG9lcyBub3QgcmVzcG9uZC4KICAgICAqCiAgICAgKiAgVGhlIHVzZXIgc3VwcGxpZWQgY29ubmVjdGlvbiBjYWxsYmFjayB3aWxsIGJlIG5vdGlmaWVkIG9mIHRoZQogICAgICogIHByb2dyZXNzIGFzIHRoaXMgcHJvY2VzcyBoYXBwZW5zLgogICAgICoKICAgICAqICBQYXJhbWV0ZXJzOgogICAgICogICAgKFN0cmluZykgcmVhc29uIC0gVGhlIHJlYXNvbiB0aGUgZGlzY29ubmVjdCBpcyBvY2N1cmluZy4KICAgICAqLwogICAgZGlzY29ubmVjdDogZnVuY3Rpb24gKHJlYXNvbikKICAgIHsKICAgICAgICB0aGlzLl9jaGFuZ2VDb25uZWN0U3RhdHVzKFN0cm9waGUuU3RhdHVzLkRJU0NPTk5FQ1RJTkcsIHJlYXNvbik7CgogICAgICAgIFN0cm9waGUuaW5mbygiRGlzY29ubmVjdCB3YXMgY2FsbGVkIGJlY2F1c2U6ICIgKyByZWFzb24pOwogICAgICAgIGlmICh0aGlzLmNvbm5lY3RlZCkgewogICAgICAgICAgICB2YXIgcHJlcyA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLmRpc2Nvbm5lY3RpbmcgPSB0cnVlOwogICAgICAgICAgICBpZiAodGhpcy5hdXRoZW50aWNhdGVkKSB7CiAgICAgICAgICAgICAgICBwcmVzID0gJHByZXMoewogICAgICAgICAgICAgICAgICAgIHhtbG5zOiBTdHJvcGhlLk5TLkNMSUVOVCwKICAgICAgICAgICAgICAgICAgICB0eXBlOiAndW5hdmFpbGFibGUnCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBzZXR1cCB0aW1lb3V0IGhhbmRsZXIKICAgICAgICAgICAgdGhpcy5fZGlzY29ubmVjdFRpbWVvdXQgPSB0aGlzLl9hZGRTeXNUaW1lZEhhbmRsZXIoCiAgICAgICAgICAgICAgICAzMDAwLCB0aGlzLl9vbkRpc2Nvbm5lY3RUaW1lb3V0LmJpbmQodGhpcykpOwogICAgICAgICAgICB0aGlzLl9wcm90by5fZGlzY29ubmVjdChwcmVzKTsKICAgICAgICB9CiAgICB9LAoKICAgIC8qKiBQcml2YXRlRnVuY3Rpb246IF9jaGFuZ2VDb25uZWN0U3RhdHVzCiAgICAgKiAgX1ByaXZhdGVfIGhlbHBlciBmdW5jdGlvbiB0aGF0IG1ha2VzIHN1cmUgcGx1Z2lucyBhbmQgdGhlIHVzZXIncwogICAgICogIGNhbGxiYWNrIGFyZSBub3RpZmllZCBvZiBjb25uZWN0aW9uIHN0YXR1cyBjaGFuZ2VzLgogICAgICoKICAgICAqICBQYXJhbWV0ZXJzOgogICAgICogICAgKEludGVnZXIpIHN0YXR1cyAtIHRoZSBuZXcgY29ubmVjdGlvbiBzdGF0dXMsIG9uZSBvZiB0aGUgdmFsdWVzCiAgICAgKiAgICAgIGluIFN0cm9waGUuU3RhdHVzCiAgICAgKiAgICAoU3RyaW5nKSBjb25kaXRpb24gLSB0aGUgZXJyb3IgY29uZGl0aW9uIG9yIG51bGwKICAgICAqLwogICAgX2NoYW5nZUNvbm5lY3RTdGF0dXM6IGZ1bmN0aW9uIChzdGF0dXMsIGNvbmRpdGlvbikKICAgIHsKICAgICAgICAvLyBub3RpZnkgYWxsIHBsdWdpbnMgbGlzdGVuaW5nIGZvciBzdGF0dXMgY2hhbmdlcwogICAgICAgIGZvciAodmFyIGsgaW4gU3Ryb3BoZS5fY29ubmVjdGlvblBsdWdpbnMpIHsKICAgICAgICAgICAgaWYgKFN0cm9waGUuX2Nvbm5lY3Rpb25QbHVnaW5zLmhhc093blByb3BlcnR5KGspKSB7CiAgICAgICAgICAgICAgICB2YXIgcGx1Z2luID0gdGhpc1trXTsKICAgICAgICAgICAgICAgIGlmIChwbHVnaW4uc3RhdHVzQ2hhbmdlZCkgewogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHBsdWdpbi5zdGF0dXNDaGFuZ2VkKHN0YXR1cywgY29uZGl0aW9uKTsKICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgU3Ryb3BoZS5lcnJvcigiIiArIGsgKyAiIHBsdWdpbiBjYXVzZWQgYW4gZXhjZXB0aW9uICIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJjaGFuZ2luZyBzdGF0dXM6ICIgKyBlcnIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gbm90aWZ5IHRoZSB1c2VyJ3MgY2FsbGJhY2sKICAgICAgICBpZiAodGhpcy5jb25uZWN0X2NhbGxiYWNrKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICB0aGlzLmNvbm5lY3RfY2FsbGJhY2soc3RhdHVzLCBjb25kaXRpb24pOwogICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICBTdHJvcGhlLmVycm9yKCJVc2VyIGNvbm5lY3Rpb24gY2FsbGJhY2sgY2F1c2VkIGFuICIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZXhjZXB0aW9uOiAiICsgZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9LAoKICAgIC8qKiBQcml2YXRlRnVuY3Rpb246IF9kb0Rpc2Nvbm5lY3QKICAgICAqICBfUHJpdmF0ZV8gZnVuY3Rpb24gdG8gZGlzY29ubmVjdC4KICAgICAqCiAgICAgKiAgVGhpcyBpcyB0aGUgbGFzdCBwaWVjZSBvZiB0aGUgZGlzY29ubmVjdGlvbiBsb2dpYy4gIFRoaXMgcmVzZXRzIHRoZQogICAgICogIGNvbm5lY3Rpb24gYW5kIGFsZXJ0cyB0aGUgdXNlcidzIGNvbm5lY3Rpb24gY2FsbGJhY2suCiAgICAgKi8KICAgIF9kb0Rpc2Nvbm5lY3Q6IGZ1bmN0aW9uICgpCiAgICB7CiAgICAgICAgLy8gQ2FuY2VsIERpc2Nvbm5lY3QgVGltZW91dAogICAgICAgIGlmICh0aGlzLl9kaXNjb25uZWN0VGltZW91dCAhPT0gbnVsbCkgewogICAgICAgICAgICB0aGlzLmRlbGV0ZVRpbWVkSGFuZGxlcih0aGlzLl9kaXNjb25uZWN0VGltZW91dCk7CiAgICAgICAgICAgIHRoaXMuX2Rpc2Nvbm5lY3RUaW1lb3V0ID0gbnVsbDsKICAgICAgICB9CgogICAgICAgIFN0cm9waGUuaW5mbygiX2RvRGlzY29ubmVjdCB3YXMgY2FsbGVkIik7CiAgICAgICAgdGhpcy5fcHJvdG8uX2RvRGlzY29ubmVjdCgpOwoKICAgICAgICB0aGlzLmF1dGhlbnRpY2F0ZWQgPSBmYWxzZTsKICAgICAgICB0aGlzLmRpc2Nvbm5lY3RpbmcgPSBmYWxzZTsKCiAgICAgICAgLy8gZGVsZXRlIGhhbmRsZXJzCiAgICAgICAgdGhpcy5oYW5kbGVycyA9IFtdOwogICAgICAgIHRoaXMudGltZWRIYW5kbGVycyA9IFtdOwogICAgICAgIHRoaXMucmVtb3ZlVGltZWRzID0gW107CiAgICAgICAgdGhpcy5yZW1vdmVIYW5kbGVycyA9IFtdOwogICAgICAgIHRoaXMuYWRkVGltZWRzID0gW107CiAgICAgICAgdGhpcy5hZGRIYW5kbGVycyA9IFtdOwoKICAgICAgICAvLyB0ZWxsIHRoZSBwYXJlbnQgd2UgZGlzY29ubmVjdGVkCiAgICAgICAgdGhpcy5fY2hhbmdlQ29ubmVjdFN0YXR1cyhTdHJvcGhlLlN0YXR1cy5ESVNDT05ORUNURUQsIG51bGwpOwogICAgICAgIHRoaXMuY29ubmVjdGVkID0gZmFsc2U7CiAgICB9LAoKICAgIC8qKiBQcml2YXRlRnVuY3Rpb246IF9kYXRhUmVjdgogICAgICogIF9Qcml2YXRlXyBoYW5kbGVyIHRvIHByb2Nlc3NlcyBpbmNvbWluZyBkYXRhIGZyb20gdGhlIHRoZSBjb25uZWN0aW9uLgogICAgICoKICAgICAqICBFeGNlcHQgZm9yIF9jb25uZWN0X2NiIGhhbmRsaW5nIHRoZSBpbml0aWFsIGNvbm5lY3Rpb24gcmVxdWVzdCwKICAgICAqICB0aGlzIGZ1bmN0aW9uIGhhbmRsZXMgdGhlIGluY29taW5nIGRhdGEgZm9yIGFsbCByZXF1ZXN0cy4gIFRoaXMKICAgICAqICBmdW5jdGlvbiBhbHNvIGZpcmVzIHN0YW56YSBoYW5kbGVycyB0aGF0IG1hdGNoIGVhY2ggaW5jb21pbmcKICAgICAqICBzdGFuemEuCiAgICAgKgogICAgICogIFBhcmFtZXRlcnM6CiAgICAgKiAgICAoU3Ryb3BoZS5SZXF1ZXN0KSByZXEgLSBUaGUgcmVxdWVzdCB0aGF0IGhhcyBkYXRhIHJlYWR5LgogICAgICogICAgKHN0cmluZykgcmVxIC0gVGhlIHN0YW56YSBhIHJhdyBzdHJpbmcgKG9wdGlvbmEpLgogICAgICovCiAgICBfZGF0YVJlY3Y6IGZ1bmN0aW9uIChyZXEsIHJhdykKICAgIHsKICAgICAgICBTdHJvcGhlLmluZm8oIl9kYXRhUmVjdiBjYWxsZWQiKTsKICAgICAgICB2YXIgZWxlbSA9IHRoaXMuX3Byb3RvLl9yZXFUb0RhdGEocmVxKTsKICAgICAgICBpZiAoZWxlbSA9PT0gbnVsbCkgeyByZXR1cm47IH0KCiAgICAgICAgaWYgKHRoaXMueG1sSW5wdXQgIT09IFN0cm9waGUuQ29ubmVjdGlvbi5wcm90b3R5cGUueG1sSW5wdXQpIHsKICAgICAgICAgICAgaWYgKGVsZW0ubm9kZU5hbWUgPT09IHRoaXMuX3Byb3RvLnN0cmlwICYmIGVsZW0uY2hpbGROb2Rlcy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIHRoaXMueG1sSW5wdXQoZWxlbS5jaGlsZE5vZGVzWzBdKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMueG1sSW5wdXQoZWxlbSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMucmF3SW5wdXQgIT09IFN0cm9waGUuQ29ubmVjdGlvbi5wcm90b3R5cGUucmF3SW5wdXQpIHsKICAgICAgICAgICAgaWYgKHJhdykgewogICAgICAgICAgICAgICAgdGhpcy5yYXdJbnB1dChyYXcpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5yYXdJbnB1dChTdHJvcGhlLnNlcmlhbGl6ZShlbGVtKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIHJlbW92ZSBoYW5kbGVycyBzY2hlZHVsZWQgZm9yIGRlbGV0aW9uCiAgICAgICAgdmFyIGksIGhhbmQ7CiAgICAgICAgd2hpbGUgKHRoaXMucmVtb3ZlSGFuZGxlcnMubGVuZ3RoID4gMCkgewogICAgICAgICAgICBoYW5kID0gdGhpcy5yZW1vdmVIYW5kbGVycy5wb3AoKTsKICAgICAgICAgICAgaSA9IHRoaXMuaGFuZGxlcnMuaW5kZXhPZihoYW5kKTsKICAgICAgICAgICAgaWYgKGkgPj0gMCkgewogICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVycy5zcGxpY2UoaSwgMSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIGFkZCBoYW5kbGVycyBzY2hlZHVsZWQgZm9yIGFkZGl0aW9uCiAgICAgICAgd2hpbGUgKHRoaXMuYWRkSGFuZGxlcnMubGVuZ3RoID4gMCkgewogICAgICAgICAgICB0aGlzLmhhbmRsZXJzLnB1c2godGhpcy5hZGRIYW5kbGVycy5wb3AoKSk7CiAgICAgICAgfQoKICAgICAgICAvLyBoYW5kbGUgZ3JhY2VmdWwgZGlzY29ubmVjdAogICAgICAgIGlmICh0aGlzLmRpc2Nvbm5lY3RpbmcgJiYgdGhpcy5fcHJvdG8uX2VtcHR5UXVldWUoKSkgewogICAgICAgICAgICB0aGlzLl9kb0Rpc2Nvbm5lY3QoKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdmFyIHR5cCA9IGVsZW0uZ2V0QXR0cmlidXRlKCJ0eXBlIik7CiAgICAgICAgdmFyIGNvbmQsIGNvbmZsaWN0OwogICAgICAgIGlmICh0eXAgIT09IG51bGwgJiYgdHlwID09ICJ0ZXJtaW5hdGUiKSB7CiAgICAgICAgICAgIC8vIERvbid0IHByb2Nlc3Mgc3RhbnphcyB0aGF0IGNvbWUgaW4gYWZ0ZXIgZGlzY29ubmVjdAogICAgICAgICAgICBpZiAodGhpcy5kaXNjb25uZWN0aW5nKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGFuIGVycm9yIG9jY3VycmVkCiAgICAgICAgICAgIGNvbmQgPSBlbGVtLmdldEF0dHJpYnV0ZSgiY29uZGl0aW9uIik7CiAgICAgICAgICAgIGNvbmZsaWN0ID0gZWxlbS5nZXRFbGVtZW50c0J5VGFnTmFtZSgiY29uZmxpY3QiKTsKICAgICAgICAgICAgaWYgKGNvbmQgIT09IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChjb25kID09ICJyZW1vdGUtc3RyZWFtLWVycm9yIiAmJiBjb25mbGljdC5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgY29uZCA9ICJjb25mbGljdCI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLl9jaGFuZ2VDb25uZWN0U3RhdHVzKFN0cm9waGUuU3RhdHVzLkNPTk5GQUlMLCBjb25kKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuX2NoYW5nZUNvbm5lY3RTdGF0dXMoU3Ryb3BoZS5TdGF0dXMuQ09OTkZBSUwsICJ1bmtub3duIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5kaXNjb25uZWN0KCd1bmtub3duIHN0cmVhbS1lcnJvcicpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBzZW5kIGVhY2ggaW5jb21pbmcgc3RhbnphIHRocm91Z2ggdGhlIGhhbmRsZXIgY2hhaW4KICAgICAgICB2YXIgdGhhdCA9IHRoaXM7CiAgICAgICAgU3Ryb3BoZS5mb3JFYWNoQ2hpbGQoZWxlbSwgbnVsbCwgZnVuY3Rpb24gKGNoaWxkKSB7CiAgICAgICAgICAgIHZhciBpLCBuZXdMaXN0OwogICAgICAgICAgICAvLyBwcm9jZXNzIGhhbmRsZXJzCiAgICAgICAgICAgIG5ld0xpc3QgPSB0aGF0LmhhbmRsZXJzOwogICAgICAgICAgICB0aGF0LmhhbmRsZXJzID0gW107CiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBuZXdMaXN0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICB2YXIgaGFuZCA9IG5ld0xpc3RbaV07CiAgICAgICAgICAgICAgICAvLyBlbmNhcHN1bGF0ZSAnaGFuZGxlci5ydW4nIG5vdCB0byBsb3NlIHRoZSB3aG9sZSBoYW5kbGVyIGxpc3QgaWYKICAgICAgICAgICAgICAgIC8vIG9uZSBvZiB0aGUgaGFuZGxlcnMgdGhyb3dzIGFuIGV4Y2VwdGlvbgogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBpZiAoaGFuZC5pc01hdGNoKGNoaWxkKSAmJgogICAgICAgICAgICAgICAgICAgICAgICAodGhhdC5hdXRoZW50aWNhdGVkIHx8ICFoYW5kLnVzZXIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoYW5kLnJ1bihjaGlsZCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuaGFuZGxlcnMucHVzaChoYW5kKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuaGFuZGxlcnMucHVzaChoYW5kKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGNhdGNoKGUpIHsKICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGUgaGFuZGxlciB0aHJvd3MgYW4gZXhjZXB0aW9uLCB3ZSBjb25zaWRlciBpdCBhcyBmYWxzZQogICAgICAgICAgICAgICAgICAgIFN0cm9waGUud2FybignUmVtb3ZpbmcgU3Ryb3BoZSBoYW5kbGVycyBkdWUgdG8gdW5jYXVnaHQgZXhjZXB0aW9uOiAnICsgZS5tZXNzYWdlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfSwKCgogICAgLyoqIEF0dHJpYnV0ZTogbWVjaGFuaXNtcwogICAgICogIFNBU0wgTWVjaGFuaXNtcyBhdmFpbGFibGUgZm9yIENvbm5jZWN0aW9uLgogICAgICovCiAgICBtZWNoYW5pc21zOiB7fSwKCiAgICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiBfY29ubmVjdF9jYgogICAgICogIF9Qcml2YXRlXyBoYW5kbGVyIGZvciBpbml0aWFsIGNvbm5lY3Rpb24gcmVxdWVzdC4KICAgICAqCiAgICAgKiAgVGhpcyBoYW5kbGVyIGlzIHVzZWQgdG8gcHJvY2VzcyB0aGUgaW5pdGlhbCBjb25uZWN0aW9uIHJlcXVlc3QKICAgICAqICByZXNwb25zZSBmcm9tIHRoZSBCT1NIIHNlcnZlci4gSXQgaXMgdXNlZCB0byBzZXQgdXAgYXV0aGVudGljYXRpb24KICAgICAqICBoYW5kbGVycyBhbmQgc3RhcnQgdGhlIGF1dGhlbnRpY2F0aW9uIHByb2Nlc3MuCiAgICAgKgogICAgICogIFNBU0wgYXV0aGVudGljYXRpb24gd2lsbCBiZSBhdHRlbXB0ZWQgaWYgYXZhaWxhYmxlLCBvdGhlcndpc2UKICAgICAqICB0aGUgY29kZSB3aWxsIGZhbGwgYmFjayB0byBsZWdhY3kgYXV0aGVudGljYXRpb24uCiAgICAgKgogICAgICogIFBhcmFtZXRlcnM6CiAgICAgKiAgICAoU3Ryb3BoZS5SZXF1ZXN0KSByZXEgLSBUaGUgY3VycmVudCByZXF1ZXN0LgogICAgICogICAgKEZ1bmN0aW9uKSBfY2FsbGJhY2sgLSBsb3cgbGV2ZWwgKHhtcHApIGNvbm5lY3QgY2FsbGJhY2sgZnVuY3Rpb24uCiAgICAgKiAgICAgIFVzZWZ1bCBmb3IgcGx1Z2lucyB3aXRoIHRoZWlyIG93biB4bXBwIGNvbm5lY3QgY2FsbGJhY2sgKHdoZW4gdGhlaXIpCiAgICAgKiAgICAgIHdhbnQgdG8gZG8gc29tZXRoaW5nIHNwZWNpYWwpLgogICAgICovCiAgICBfY29ubmVjdF9jYjogZnVuY3Rpb24gKHJlcSwgX2NhbGxiYWNrLCByYXcpCiAgICB7CiAgICAgICAgU3Ryb3BoZS5pbmZvKCJfY29ubmVjdF9jYiB3YXMgY2FsbGVkIik7CgogICAgICAgIHRoaXMuY29ubmVjdGVkID0gdHJ1ZTsKCiAgICAgICAgdmFyIGJvZHlXcmFwID0gdGhpcy5fcHJvdG8uX3JlcVRvRGF0YShyZXEpOwogICAgICAgIGlmICghYm9keVdyYXApIHsgcmV0dXJuOyB9CgogICAgICAgIGlmICh0aGlzLnhtbElucHV0ICE9PSBTdHJvcGhlLkNvbm5lY3Rpb24ucHJvdG90eXBlLnhtbElucHV0KSB7CiAgICAgICAgICAgIGlmIChib2R5V3JhcC5ub2RlTmFtZSA9PT0gdGhpcy5fcHJvdG8uc3RyaXAgJiYgYm9keVdyYXAuY2hpbGROb2Rlcy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIHRoaXMueG1sSW5wdXQoYm9keVdyYXAuY2hpbGROb2Rlc1swXSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLnhtbElucHV0KGJvZHlXcmFwKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAodGhpcy5yYXdJbnB1dCAhPT0gU3Ryb3BoZS5Db25uZWN0aW9uLnByb3RvdHlwZS5yYXdJbnB1dCkgewogICAgICAgICAgICBpZiAocmF3KSB7CiAgICAgICAgICAgICAgICB0aGlzLnJhd0lucHV0KHJhdyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLnJhd0lucHV0KFN0cm9waGUuc2VyaWFsaXplKGJvZHlXcmFwKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHZhciBjb25uY2hlY2sgPSB0aGlzLl9wcm90by5fY29ubmVjdF9jYihib2R5V3JhcCk7CiAgICAgICAgaWYgKGNvbm5jaGVjayA9PT0gU3Ryb3BoZS5TdGF0dXMuQ09OTkZBSUwpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5fYXV0aGVudGljYXRpb24uc2FzbF9zY3JhbV9zaGExID0gZmFsc2U7CiAgICAgICAgdGhpcy5fYXV0aGVudGljYXRpb24uc2FzbF9wbGFpbiA9IGZhbHNlOwogICAgICAgIHRoaXMuX2F1dGhlbnRpY2F0aW9uLnNhc2xfZGlnZXN0X21kNSA9IGZhbHNlOwogICAgICAgIHRoaXMuX2F1dGhlbnRpY2F0aW9uLnNhc2xfYW5vbnltb3VzID0gZmFsc2U7CgogICAgICAgIHRoaXMuX2F1dGhlbnRpY2F0aW9uLmxlZ2FjeV9hdXRoID0gZmFsc2U7CgogICAgICAgIC8vIENoZWNrIGZvciB0aGUgc3RyZWFtOmZlYXR1cmVzIHRhZwogICAgICAgIHZhciBoYXNGZWF0dXJlcyA9IGJvZHlXcmFwLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJzdHJlYW06ZmVhdHVyZXMiKS5sZW5ndGggPiAwOwogICAgICAgIGlmICghaGFzRmVhdHVyZXMpIHsKICAgICAgICAgICAgaGFzRmVhdHVyZXMgPSBib2R5V3JhcC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiZmVhdHVyZXMiKS5sZW5ndGggPiAwOwogICAgICAgIH0KICAgICAgICB2YXIgbWVjaGFuaXNtcyA9IGJvZHlXcmFwLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJtZWNoYW5pc20iKTsKICAgICAgICB2YXIgbWF0Y2hlZCA9IFtdOwogICAgICAgIHZhciBpLCBtZWNoLCBmb3VuZF9hdXRoZW50aWNhdGlvbiA9IGZhbHNlOwogICAgICAgIGlmICghaGFzRmVhdHVyZXMpIHsKICAgICAgICAgICAgdGhpcy5fcHJvdG8uX25vX2F1dGhfcmVjZWl2ZWQoX2NhbGxiYWNrKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAobWVjaGFuaXNtcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBtZWNoYW5pc21zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBtZWNoID0gU3Ryb3BoZS5nZXRUZXh0KG1lY2hhbmlzbXNbaV0pOwogICAgICAgICAgICAgICAgaWYgKHRoaXMubWVjaGFuaXNtc1ttZWNoXSkgbWF0Y2hlZC5wdXNoKHRoaXMubWVjaGFuaXNtc1ttZWNoXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdGhpcy5fYXV0aGVudGljYXRpb24ubGVnYWN5X2F1dGggPQogICAgICAgICAgICBib2R5V3JhcC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiYXV0aCIpLmxlbmd0aCA+IDA7CiAgICAgICAgZm91bmRfYXV0aGVudGljYXRpb24gPSB0aGlzLl9hdXRoZW50aWNhdGlvbi5sZWdhY3lfYXV0aCB8fAogICAgICAgICAgICBtYXRjaGVkLmxlbmd0aCA+IDA7CiAgICAgICAgaWYgKCFmb3VuZF9hdXRoZW50aWNhdGlvbikgewogICAgICAgICAgICB0aGlzLl9wcm90by5fbm9fYXV0aF9yZWNlaXZlZChfY2FsbGJhY2spOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLmRvX2F1dGhlbnRpY2F0aW9uICE9PSBmYWxzZSkKICAgICAgICAgICAgdGhpcy5hdXRoZW50aWNhdGUobWF0Y2hlZCk7CiAgICB9LAoKICAgIC8qKiBGdW5jdGlvbjogYXV0aGVudGljYXRlCiAgICAgKiBTZXQgdXAgYXV0aGVudGljYXRpb24KICAgICAqCiAgICAgKiAgQ29udGl1bnVlcyB0aGUgaW5pdGlhbCBjb25uZWN0aW9uIHJlcXVlc3QgYnkgc2V0dGluZyB1cCBhdXRoZW50aWNhdGlvbgogICAgICogIGhhbmRsZXJzIGFuZCBzdGFydCB0aGUgYXV0aGVudGljYXRpb24gcHJvY2Vzcy4KICAgICAqCiAgICAgKiAgU0FTTCBhdXRoZW50aWNhdGlvbiB3aWxsIGJlIGF0dGVtcHRlZCBpZiBhdmFpbGFibGUsIG90aGVyd2lzZQogICAgICogIHRoZSBjb2RlIHdpbGwgZmFsbCBiYWNrIHRvIGxlZ2FjeSBhdXRoZW50aWNhdGlvbi4KICAgICAqCiAgICAgKi8KICAgIGF1dGhlbnRpY2F0ZTogZnVuY3Rpb24gKG1hdGNoZWQpCiAgICB7CiAgICAgIHZhciBpOwogICAgICAvLyBTb3J0aW5nIG1hdGNoZWQgbWVjaGFuaXNtcyBhY2NvcmRpbmcgdG8gcHJpb3JpdHkuCiAgICAgIGZvciAoaSA9IDA7IGkgPCBtYXRjaGVkLmxlbmd0aCAtIDE7ICsraSkgewogICAgICAgIHZhciBoaWdoZXIgPSBpOwogICAgICAgIGZvciAodmFyIGogPSBpICsgMTsgaiA8IG1hdGNoZWQubGVuZ3RoOyArK2opIHsKICAgICAgICAgIGlmIChtYXRjaGVkW2pdLnByb3RvdHlwZS5wcmlvcml0eSA+IG1hdGNoZWRbaGlnaGVyXS5wcm90b3R5cGUucHJpb3JpdHkpIHsKICAgICAgICAgICAgaGlnaGVyID0gajsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGhpZ2hlciAhPSBpKSB7CiAgICAgICAgICB2YXIgc3dhcCA9IG1hdGNoZWRbaV07CiAgICAgICAgICBtYXRjaGVkW2ldID0gbWF0Y2hlZFtoaWdoZXJdOwogICAgICAgICAgbWF0Y2hlZFtoaWdoZXJdID0gc3dhcDsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIC8vIHJ1biBlYWNoIG1lY2hhbmlzbQogICAgICB2YXIgbWVjaGFuaXNtX2ZvdW5kID0gZmFsc2U7CiAgICAgIGZvciAoaSA9IDA7IGkgPCBtYXRjaGVkLmxlbmd0aDsgKytpKSB7CiAgICAgICAgaWYgKCFtYXRjaGVkW2ldLnRlc3QodGhpcykpIGNvbnRpbnVlOwoKICAgICAgICB0aGlzLl9zYXNsX3N1Y2Nlc3NfaGFuZGxlciA9IHRoaXMuX2FkZFN5c0hhbmRsZXIoCiAgICAgICAgICB0aGlzLl9zYXNsX3N1Y2Nlc3NfY2IuYmluZCh0aGlzKSwgbnVsbCwKICAgICAgICAgICJzdWNjZXNzIiwgbnVsbCwgbnVsbCk7CiAgICAgICAgdGhpcy5fc2FzbF9mYWlsdXJlX2hhbmRsZXIgPSB0aGlzLl9hZGRTeXNIYW5kbGVyKAogICAgICAgICAgdGhpcy5fc2FzbF9mYWlsdXJlX2NiLmJpbmQodGhpcyksIG51bGwsCiAgICAgICAgICAiZmFpbHVyZSIsIG51bGwsIG51bGwpOwogICAgICAgIHRoaXMuX3Nhc2xfY2hhbGxlbmdlX2hhbmRsZXIgPSB0aGlzLl9hZGRTeXNIYW5kbGVyKAogICAgICAgICAgdGhpcy5fc2FzbF9jaGFsbGVuZ2VfY2IuYmluZCh0aGlzKSwgbnVsbCwKICAgICAgICAgICJjaGFsbGVuZ2UiLCBudWxsLCBudWxsKTsKCiAgICAgICAgdGhpcy5fc2FzbF9tZWNoYW5pc20gPSBuZXcgbWF0Y2hlZFtpXSgpOwogICAgICAgIHRoaXMuX3Nhc2xfbWVjaGFuaXNtLm9uU3RhcnQodGhpcyk7CgogICAgICAgIHZhciByZXF1ZXN0X2F1dGhfZXhjaGFuZ2UgPSAkYnVpbGQoImF1dGgiLCB7CiAgICAgICAgICB4bWxuczogU3Ryb3BoZS5OUy5TQVNMLAogICAgICAgICAgbWVjaGFuaXNtOiB0aGlzLl9zYXNsX21lY2hhbmlzbS5uYW1lCiAgICAgICAgfSk7CgogICAgICAgIGlmICh0aGlzLl9zYXNsX21lY2hhbmlzbS5pc0NsaWVudEZpcnN0KSB7CiAgICAgICAgICB2YXIgcmVzcG9uc2UgPSB0aGlzLl9zYXNsX21lY2hhbmlzbS5vbkNoYWxsZW5nZSh0aGlzLCBudWxsKTsKICAgICAgICAgIHJlcXVlc3RfYXV0aF9leGNoYW5nZS50KEJhc2U2NC5lbmNvZGUocmVzcG9uc2UpKTsKICAgICAgICB9CgogICAgICAgIHRoaXMuc2VuZChyZXF1ZXN0X2F1dGhfZXhjaGFuZ2UudHJlZSgpKTsKCiAgICAgICAgbWVjaGFuaXNtX2ZvdW5kID0gdHJ1ZTsKICAgICAgICBicmVhazsKICAgICAgfQoKICAgICAgaWYgKCFtZWNoYW5pc21fZm91bmQpIHsKICAgICAgICAvLyBpZiBub25lIG9mIHRoZSBtZWNoYW5pc20gd29ya2VkCiAgICAgICAgaWYgKFN0cm9waGUuZ2V0Tm9kZUZyb21KaWQodGhpcy5qaWQpID09PSBudWxsKSB7CiAgICAgICAgICAgIC8vIHdlIGRvbid0IGhhdmUgYSBub2RlLCB3aGljaCBpcyByZXF1aXJlZCBmb3Igbm9uLWFub255bW91cwogICAgICAgICAgICAvLyBjbGllbnQgY29ubmVjdGlvbnMKICAgICAgICAgICAgdGhpcy5fY2hhbmdlQ29ubmVjdFN0YXR1cyhTdHJvcGhlLlN0YXR1cy5DT05ORkFJTCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAneC1zdHJvcGhlLWJhZC1ub24tYW5vbi1qaWQnKTsKICAgICAgICAgICAgdGhpcy5kaXNjb25uZWN0KCd4LXN0cm9waGUtYmFkLW5vbi1hbm9uLWppZCcpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvLyBmYWxsIGJhY2sgdG8gbGVnYWN5IGF1dGhlbnRpY2F0aW9uCiAgICAgICAgICB0aGlzLl9jaGFuZ2VDb25uZWN0U3RhdHVzKFN0cm9waGUuU3RhdHVzLkFVVEhFTlRJQ0FUSU5HLCBudWxsKTsKICAgICAgICAgIHRoaXMuX2FkZFN5c0hhbmRsZXIodGhpcy5fYXV0aDFfY2IuYmluZCh0aGlzKSwgbnVsbCwgbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCwgIl9hdXRoXzEiKTsKCiAgICAgICAgICB0aGlzLnNlbmQoJGlxKHsKICAgICAgICAgICAgdHlwZTogImdldCIsCiAgICAgICAgICAgIHRvOiB0aGlzLmRvbWFpbiwKICAgICAgICAgICAgaWQ6ICJfYXV0aF8xIgogICAgICAgICAgfSkuYygicXVlcnkiLCB7CiAgICAgICAgICAgIHhtbG5zOiBTdHJvcGhlLk5TLkFVVEgKICAgICAgICAgIH0pLmMoInVzZXJuYW1lIiwge30pLnQoU3Ryb3BoZS5nZXROb2RlRnJvbUppZCh0aGlzLmppZCkpLnRyZWUoKSk7CiAgICAgICAgfQogICAgICB9CgogICAgfSwKCiAgICBfc2FzbF9jaGFsbGVuZ2VfY2I6IGZ1bmN0aW9uKGVsZW0pIHsKICAgICAgdmFyIGNoYWxsZW5nZSA9IEJhc2U2NC5kZWNvZGUoU3Ryb3BoZS5nZXRUZXh0KGVsZW0pKTsKICAgICAgdmFyIHJlc3BvbnNlID0gdGhpcy5fc2FzbF9tZWNoYW5pc20ub25DaGFsbGVuZ2UodGhpcywgY2hhbGxlbmdlKTsKCiAgICAgIHZhciBzdGFuemEgPSAkYnVpbGQoJ3Jlc3BvbnNlJywgewogICAgICAgICAgeG1sbnM6IFN0cm9waGUuTlMuU0FTTAogICAgICB9KTsKICAgICAgaWYgKHJlc3BvbnNlICE9PSAiIikgewogICAgICAgIHN0YW56YS50KEJhc2U2NC5lbmNvZGUocmVzcG9uc2UpKTsKICAgICAgfQogICAgICB0aGlzLnNlbmQoc3RhbnphLnRyZWUoKSk7CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0sCgogICAgLyoqIFByaXZhdGVGdW5jdGlvbjogX2F1dGgxX2NiCiAgICAgKiAgX1ByaXZhdGVfIGhhbmRsZXIgZm9yIGxlZ2FjeSBhdXRoZW50aWNhdGlvbi4KICAgICAqCiAgICAgKiAgVGhpcyBoYW5kbGVyIGlzIGNhbGxlZCBpbiByZXNwb25zZSB0byB0aGUgaW5pdGlhbCA8aXEgdHlwZT0nZ2V0Jy8+CiAgICAgKiAgZm9yIGxlZ2FjeSBhdXRoZW50aWNhdGlvbi4gIEl0IGJ1aWxkcyBhbiBhdXRoZW50aWNhdGlvbiA8aXEvPiBhbmQKICAgICAqICBzZW5kcyBpdCwgY3JlYXRpbmcgYSBoYW5kbGVyIChjYWxsaW5nIGJhY2sgdG8gX2F1dGgyX2NiKCkpIHRvCiAgICAgKiAgaGFuZGxlIHRoZSByZXN1bHQKICAgICAqCiAgICAgKiAgUGFyYW1ldGVyczoKICAgICAqICAgIChYTUxFbGVtZW50KSBlbGVtIC0gVGhlIHN0YW56YSB0aGF0IHRyaWdnZXJlZCB0aGUgY2FsbGJhY2suCiAgICAgKgogICAgICogIFJldHVybnM6CiAgICAgKiAgICBmYWxzZSB0byByZW1vdmUgdGhlIGhhbmRsZXIuCiAgICAgKi8KICAgIC8qIGpzaGludCB1bnVzZWQ6ZmFsc2UgKi8KICAgIF9hdXRoMV9jYjogZnVuY3Rpb24gKGVsZW0pCiAgICB7CiAgICAgICAgLy8gYnVpbGQgcGxhaW50ZXh0IGF1dGggaXEKICAgICAgICB2YXIgaXEgPSAkaXEoe3R5cGU6ICJzZXQiLCBpZDogIl9hdXRoXzIifSkKICAgICAgICAgICAgLmMoJ3F1ZXJ5Jywge3htbG5zOiBTdHJvcGhlLk5TLkFVVEh9KQogICAgICAgICAgICAuYygndXNlcm5hbWUnLCB7fSkudChTdHJvcGhlLmdldE5vZGVGcm9tSmlkKHRoaXMuamlkKSkKICAgICAgICAgICAgLnVwKCkKICAgICAgICAgICAgLmMoJ3Bhc3N3b3JkJykudCh0aGlzLnBhc3MpOwoKICAgICAgICBpZiAoIVN0cm9waGUuZ2V0UmVzb3VyY2VGcm9tSmlkKHRoaXMuamlkKSkgewogICAgICAgICAgICAvLyBzaW5jZSB0aGUgdXNlciBoYXMgbm90IHN1cHBsaWVkIGEgcmVzb3VyY2UsIHdlIHBpY2sKICAgICAgICAgICAgLy8gYSBkZWZhdWx0IG9uZSBoZXJlLiAgdW5saWtlIG90aGVyIGF1dGggbWV0aG9kcywgdGhlIHNlcnZlcgogICAgICAgICAgICAvLyBjYW5ub3QgZG8gdGhpcyBmb3IgdXMuCiAgICAgICAgICAgIHRoaXMuamlkID0gU3Ryb3BoZS5nZXRCYXJlSmlkRnJvbUppZCh0aGlzLmppZCkgKyAnL3N0cm9waGUnOwogICAgICAgIH0KICAgICAgICBpcS51cCgpLmMoJ3Jlc291cmNlJywge30pLnQoU3Ryb3BoZS5nZXRSZXNvdXJjZUZyb21KaWQodGhpcy5qaWQpKTsKCiAgICAgICAgdGhpcy5fYWRkU3lzSGFuZGxlcih0aGlzLl9hdXRoMl9jYi5iaW5kKHRoaXMpLCBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCwgbnVsbCwgIl9hdXRoXzIiKTsKCiAgICAgICAgdGhpcy5zZW5kKGlxLnRyZWUoKSk7CgogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0sCiAgICAvKiBqc2hpbnQgdW51c2VkOnRydWUgKi8KCiAgICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiBfc2FzbF9zdWNjZXNzX2NiCiAgICAgKiAgX1ByaXZhdGVfIGhhbmRsZXIgZm9yIHN1Y2Nlc2Z1bCBTQVNMIGF1dGhlbnRpY2F0aW9uLgogICAgICoKICAgICAqICBQYXJhbWV0ZXJzOgogICAgICogICAgKFhNTEVsZW1lbnQpIGVsZW0gLSBUaGUgbWF0Y2hpbmcgc3RhbnphLgogICAgICoKICAgICAqICBSZXR1cm5zOgogICAgICogICAgZmFsc2UgdG8gcmVtb3ZlIHRoZSBoYW5kbGVyLgogICAgICovCiAgICBfc2FzbF9zdWNjZXNzX2NiOiBmdW5jdGlvbiAoZWxlbSkKICAgIHsKICAgICAgICBpZiAodGhpcy5fc2FzbF9kYXRhWyJzZXJ2ZXItc2lnbmF0dXJlIl0pIHsKICAgICAgICAgICAgdmFyIHNlcnZlclNpZ25hdHVyZTsKICAgICAgICAgICAgdmFyIHN1Y2Nlc3MgPSBCYXNlNjQuZGVjb2RlKFN0cm9waGUuZ2V0VGV4dChlbGVtKSk7CiAgICAgICAgICAgIHZhciBhdHRyaWJNYXRjaCA9IC8oW2Etel0rKT0oW14sXSspKCx8JCkvOwogICAgICAgICAgICB2YXIgbWF0Y2hlcyA9IHN1Y2Nlc3MubWF0Y2goYXR0cmliTWF0Y2gpOwogICAgICAgICAgICBpZiAobWF0Y2hlc1sxXSA9PSAidiIpIHsKICAgICAgICAgICAgICAgIHNlcnZlclNpZ25hdHVyZSA9IG1hdGNoZXNbMl07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChzZXJ2ZXJTaWduYXR1cmUgIT0gdGhpcy5fc2FzbF9kYXRhWyJzZXJ2ZXItc2lnbmF0dXJlIl0pIHsKICAgICAgICAgICAgICAvLyByZW1vdmUgb2xkIGhhbmRsZXJzCiAgICAgICAgICAgICAgdGhpcy5kZWxldGVIYW5kbGVyKHRoaXMuX3Nhc2xfZmFpbHVyZV9oYW5kbGVyKTsKICAgICAgICAgICAgICB0aGlzLl9zYXNsX2ZhaWx1cmVfaGFuZGxlciA9IG51bGw7CiAgICAgICAgICAgICAgaWYgKHRoaXMuX3Nhc2xfY2hhbGxlbmdlX2hhbmRsZXIpIHsKICAgICAgICAgICAgICAgIHRoaXMuZGVsZXRlSGFuZGxlcih0aGlzLl9zYXNsX2NoYWxsZW5nZV9oYW5kbGVyKTsKICAgICAgICAgICAgICAgIHRoaXMuX3Nhc2xfY2hhbGxlbmdlX2hhbmRsZXIgPSBudWxsOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdGhpcy5fc2FzbF9kYXRhID0ge307CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3Nhc2xfZmFpbHVyZV9jYihudWxsKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgU3Ryb3BoZS5pbmZvKCJTQVNMIGF1dGhlbnRpY2F0aW9uIHN1Y2NlZWRlZC4iKTsKCiAgICAgICAgaWYodGhpcy5fc2FzbF9tZWNoYW5pc20pCiAgICAgICAgICB0aGlzLl9zYXNsX21lY2hhbmlzbS5vblN1Y2Nlc3MoKTsKCiAgICAgICAgLy8gcmVtb3ZlIG9sZCBoYW5kbGVycwogICAgICAgIHRoaXMuZGVsZXRlSGFuZGxlcih0aGlzLl9zYXNsX2ZhaWx1cmVfaGFuZGxlcik7CiAgICAgICAgdGhpcy5fc2FzbF9mYWlsdXJlX2hhbmRsZXIgPSBudWxsOwogICAgICAgIGlmICh0aGlzLl9zYXNsX2NoYWxsZW5nZV9oYW5kbGVyKSB7CiAgICAgICAgICAgIHRoaXMuZGVsZXRlSGFuZGxlcih0aGlzLl9zYXNsX2NoYWxsZW5nZV9oYW5kbGVyKTsKICAgICAgICAgICAgdGhpcy5fc2FzbF9jaGFsbGVuZ2VfaGFuZGxlciA9IG51bGw7CiAgICAgICAgfQoKICAgICAgICB0aGlzLl9hZGRTeXNIYW5kbGVyKHRoaXMuX3Nhc2xfYXV0aDFfY2IuYmluZCh0aGlzKSwgbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJzdHJlYW06ZmVhdHVyZXMiLCBudWxsLCBudWxsKTsKCiAgICAgICAgLy8gd2UgbXVzdCBzZW5kIGFuIHhtcHA6cmVzdGFydCBub3cKICAgICAgICB0aGlzLl9zZW5kUmVzdGFydCgpOwoKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9LAoKICAgIC8qKiBQcml2YXRlRnVuY3Rpb246IF9zYXNsX2F1dGgxX2NiCiAgICAgKiAgX1ByaXZhdGVfIGhhbmRsZXIgdG8gc3RhcnQgc3RyZWFtIGJpbmRpbmcuCiAgICAgKgogICAgICogIFBhcmFtZXRlcnM6CiAgICAgKiAgICAoWE1MRWxlbWVudCkgZWxlbSAtIFRoZSBtYXRjaGluZyBzdGFuemEuCiAgICAgKgogICAgICogIFJldHVybnM6CiAgICAgKiAgICBmYWxzZSB0byByZW1vdmUgdGhlIGhhbmRsZXIuCiAgICAgKi8KICAgIF9zYXNsX2F1dGgxX2NiOiBmdW5jdGlvbiAoZWxlbSkKICAgIHsKICAgICAgICAvLyBzYXZlIHN0cmVhbTpmZWF0dXJlcyBmb3IgZnV0dXJlIHVzYWdlCiAgICAgICAgdGhpcy5mZWF0dXJlcyA9IGVsZW07CgogICAgICAgIHZhciBpLCBjaGlsZDsKCiAgICAgICAgZm9yIChpID0gMDsgaSA8IGVsZW0uY2hpbGROb2Rlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBjaGlsZCA9IGVsZW0uY2hpbGROb2Rlc1tpXTsKICAgICAgICAgICAgaWYgKGNoaWxkLm5vZGVOYW1lID09ICdiaW5kJykgewogICAgICAgICAgICAgICAgdGhpcy5kb19iaW5kID0gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGNoaWxkLm5vZGVOYW1lID09ICdzZXNzaW9uJykgewogICAgICAgICAgICAgICAgdGhpcy5kb19zZXNzaW9uID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKCF0aGlzLmRvX2JpbmQpIHsKICAgICAgICAgICAgdGhpcy5fY2hhbmdlQ29ubmVjdFN0YXR1cyhTdHJvcGhlLlN0YXR1cy5BVVRIRkFJTCwgbnVsbCk7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLl9hZGRTeXNIYW5kbGVyKHRoaXMuX3Nhc2xfYmluZF9jYi5iaW5kKHRoaXMpLCBudWxsLCBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bGwsICJfYmluZF9hdXRoXzIiKTsKCiAgICAgICAgICAgIHZhciByZXNvdXJjZSA9IFN0cm9waGUuZ2V0UmVzb3VyY2VGcm9tSmlkKHRoaXMuamlkKTsKICAgICAgICAgICAgaWYgKHJlc291cmNlKSB7CiAgICAgICAgICAgICAgICB0aGlzLnNlbmQoJGlxKHt0eXBlOiAic2V0IiwgaWQ6ICJfYmluZF9hdXRoXzIifSkKICAgICAgICAgICAgICAgICAgICAgICAgICAuYygnYmluZCcsIHt4bWxuczogU3Ryb3BoZS5OUy5CSU5EfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAuYygncmVzb3VyY2UnLCB7fSkudChyZXNvdXJjZSkudHJlZSgpKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuc2VuZCgkaXEoe3R5cGU6ICJzZXQiLCBpZDogIl9iaW5kX2F1dGhfMiJ9KQogICAgICAgICAgICAgICAgICAgICAgICAgIC5jKCdiaW5kJywge3htbG5zOiBTdHJvcGhlLk5TLkJJTkR9KQogICAgICAgICAgICAgICAgICAgICAgICAgIC50cmVlKCkpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9LAoKICAgIC8qKiBQcml2YXRlRnVuY3Rpb246IF9zYXNsX2JpbmRfY2IKICAgICAqICBfUHJpdmF0ZV8gaGFuZGxlciBmb3IgYmluZGluZyByZXN1bHQgYW5kIHNlc3Npb24gc3RhcnQuCiAgICAgKgogICAgICogIFBhcmFtZXRlcnM6CiAgICAgKiAgICAoWE1MRWxlbWVudCkgZWxlbSAtIFRoZSBtYXRjaGluZyBzdGFuemEuCiAgICAgKgogICAgICogIFJldHVybnM6CiAgICAgKiAgICBmYWxzZSB0byByZW1vdmUgdGhlIGhhbmRsZXIuCiAgICAgKi8KICAgIF9zYXNsX2JpbmRfY2I6IGZ1bmN0aW9uIChlbGVtKQogICAgewogICAgICAgIGlmIChlbGVtLmdldEF0dHJpYnV0ZSgidHlwZSIpID09ICJlcnJvciIpIHsKICAgICAgICAgICAgU3Ryb3BoZS5pbmZvKCJTQVNMIGJpbmRpbmcgZmFpbGVkLiIpOwogICAgICAgICAgICB2YXIgY29uZmxpY3QgPSBlbGVtLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJjb25mbGljdCIpLCBjb25kaXRpb247CiAgICAgICAgICAgIGlmIChjb25mbGljdC5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICBjb25kaXRpb24gPSAnY29uZmxpY3QnOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuX2NoYW5nZUNvbm5lY3RTdGF0dXMoU3Ryb3BoZS5TdGF0dXMuQVVUSEZBSUwsIGNvbmRpdGlvbik7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIC8vIFRPRE8gLSBuZWVkIHRvIGdyYWIgZXJyb3JzCiAgICAgICAgdmFyIGJpbmQgPSBlbGVtLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJiaW5kIik7CiAgICAgICAgdmFyIGppZE5vZGU7CiAgICAgICAgaWYgKGJpbmQubGVuZ3RoID4gMCkgewogICAgICAgICAgICAvLyBHcmFiIGppZAogICAgICAgICAgICBqaWROb2RlID0gYmluZFswXS5nZXRFbGVtZW50c0J5VGFnTmFtZSgiamlkIik7CiAgICAgICAgICAgIGlmIChqaWROb2RlLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIHRoaXMuamlkID0gU3Ryb3BoZS5nZXRUZXh0KGppZE5vZGVbMF0pOwoKICAgICAgICAgICAgICAgIGlmICh0aGlzLmRvX3Nlc3Npb24pIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9hZGRTeXNIYW5kbGVyKHRoaXMuX3Nhc2xfc2Vzc2lvbl9jYi5iaW5kKHRoaXMpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCwgbnVsbCwgbnVsbCwgIl9zZXNzaW9uX2F1dGhfMiIpOwoKICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbmQoJGlxKHt0eXBlOiAic2V0IiwgaWQ6ICJfc2Vzc2lvbl9hdXRoXzIifSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jKCdzZXNzaW9uJywge3htbG5zOiBTdHJvcGhlLk5TLlNFU1NJT059KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRyZWUoKSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRoaXMuYXV0aGVudGljYXRlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY2hhbmdlQ29ubmVjdFN0YXR1cyhTdHJvcGhlLlN0YXR1cy5DT05ORUNURUQsIG51bGwpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgU3Ryb3BoZS5pbmZvKCJTQVNMIGJpbmRpbmcgZmFpbGVkLiIpOwogICAgICAgICAgICB0aGlzLl9jaGFuZ2VDb25uZWN0U3RhdHVzKFN0cm9waGUuU3RhdHVzLkFVVEhGQUlMLCBudWxsKTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgIH0sCgogICAgLyoqIFByaXZhdGVGdW5jdGlvbjogX3Nhc2xfc2Vzc2lvbl9jYgogICAgICogIF9Qcml2YXRlXyBoYW5kbGVyIHRvIGZpbmlzaCBzdWNjZXNzZnVsIFNBU0wgY29ubmVjdGlvbi4KICAgICAqCiAgICAgKiAgVGhpcyBzZXRzIENvbm5lY3Rpb24uYXV0aGVudGljYXRlZCB0byB0cnVlIG9uIHN1Y2Nlc3MsIHdoaWNoCiAgICAgKiAgc3RhcnRzIHRoZSBwcm9jZXNzaW5nIG9mIHVzZXIgaGFuZGxlcnMuCiAgICAgKgogICAgICogIFBhcmFtZXRlcnM6CiAgICAgKiAgICAoWE1MRWxlbWVudCkgZWxlbSAtIFRoZSBtYXRjaGluZyBzdGFuemEuCiAgICAgKgogICAgICogIFJldHVybnM6CiAgICAgKiAgICBmYWxzZSB0byByZW1vdmUgdGhlIGhhbmRsZXIuCiAgICAgKi8KICAgIF9zYXNsX3Nlc3Npb25fY2I6IGZ1bmN0aW9uIChlbGVtKQogICAgewogICAgICAgIGlmIChlbGVtLmdldEF0dHJpYnV0ZSgidHlwZSIpID09ICJyZXN1bHQiKSB7CiAgICAgICAgICAgIHRoaXMuYXV0aGVudGljYXRlZCA9IHRydWU7CiAgICAgICAgICAgIHRoaXMuX2NoYW5nZUNvbm5lY3RTdGF0dXMoU3Ryb3BoZS5TdGF0dXMuQ09OTkVDVEVELCBudWxsKTsKICAgICAgICB9IGVsc2UgaWYgKGVsZW0uZ2V0QXR0cmlidXRlKCJ0eXBlIikgPT0gImVycm9yIikgewogICAgICAgICAgICBTdHJvcGhlLmluZm8oIlNlc3Npb24gY3JlYXRpb24gZmFpbGVkLiIpOwogICAgICAgICAgICB0aGlzLl9jaGFuZ2VDb25uZWN0U3RhdHVzKFN0cm9waGUuU3RhdHVzLkFVVEhGQUlMLCBudWxsKTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSwKCiAgICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiBfc2FzbF9mYWlsdXJlX2NiCiAgICAgKiAgX1ByaXZhdGVfIGhhbmRsZXIgZm9yIFNBU0wgYXV0aGVudGljYXRpb24gZmFpbHVyZS4KICAgICAqCiAgICAgKiAgUGFyYW1ldGVyczoKICAgICAqICAgIChYTUxFbGVtZW50KSBlbGVtIC0gVGhlIG1hdGNoaW5nIHN0YW56YS4KICAgICAqCiAgICAgKiAgUmV0dXJuczoKICAgICAqICAgIGZhbHNlIHRvIHJlbW92ZSB0aGUgaGFuZGxlci4KICAgICAqLwogICAgLyoganNoaW50IHVudXNlZDpmYWxzZSAqLwogICAgX3Nhc2xfZmFpbHVyZV9jYjogZnVuY3Rpb24gKGVsZW0pCiAgICB7CiAgICAgICAgLy8gZGVsZXRlIHVubmVlZGVkIGhhbmRsZXJzCiAgICAgICAgaWYgKHRoaXMuX3Nhc2xfc3VjY2Vzc19oYW5kbGVyKSB7CiAgICAgICAgICAgIHRoaXMuZGVsZXRlSGFuZGxlcih0aGlzLl9zYXNsX3N1Y2Nlc3NfaGFuZGxlcik7CiAgICAgICAgICAgIHRoaXMuX3Nhc2xfc3VjY2Vzc19oYW5kbGVyID0gbnVsbDsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMuX3Nhc2xfY2hhbGxlbmdlX2hhbmRsZXIpIHsKICAgICAgICAgICAgdGhpcy5kZWxldGVIYW5kbGVyKHRoaXMuX3Nhc2xfY2hhbGxlbmdlX2hhbmRsZXIpOwogICAgICAgICAgICB0aGlzLl9zYXNsX2NoYWxsZW5nZV9oYW5kbGVyID0gbnVsbDsKICAgICAgICB9CgogICAgICAgIGlmKHRoaXMuX3Nhc2xfbWVjaGFuaXNtKQogICAgICAgICAgdGhpcy5fc2FzbF9tZWNoYW5pc20ub25GYWlsdXJlKCk7CiAgICAgICAgdGhpcy5fY2hhbmdlQ29ubmVjdFN0YXR1cyhTdHJvcGhlLlN0YXR1cy5BVVRIRkFJTCwgbnVsbCk7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSwKICAgIC8qIGpzaGludCB1bnVzZWQ6dHJ1ZSAqLwoKICAgIC8qKiBQcml2YXRlRnVuY3Rpb246IF9hdXRoMl9jYgogICAgICogIF9Qcml2YXRlXyBoYW5kbGVyIHRvIGZpbmlzaCBsZWdhY3kgYXV0aGVudGljYXRpb24uCiAgICAgKgogICAgICogIFRoaXMgaGFuZGxlciBpcyBjYWxsZWQgd2hlbiB0aGUgcmVzdWx0IGZyb20gdGhlIGphYmJlcjppcTphdXRoCiAgICAgKiAgPGlxLz4gc3RhbnphIGlzIHJldHVybmVkLgogICAgICoKICAgICAqICBQYXJhbWV0ZXJzOgogICAgICogICAgKFhNTEVsZW1lbnQpIGVsZW0gLSBUaGUgc3RhbnphIHRoYXQgdHJpZ2dlcmVkIHRoZSBjYWxsYmFjay4KICAgICAqCiAgICAgKiAgUmV0dXJuczoKICAgICAqICAgIGZhbHNlIHRvIHJlbW92ZSB0aGUgaGFuZGxlci4KICAgICAqLwogICAgX2F1dGgyX2NiOiBmdW5jdGlvbiAoZWxlbSkKICAgIHsKICAgICAgICBpZiAoZWxlbS5nZXRBdHRyaWJ1dGUoInR5cGUiKSA9PSAicmVzdWx0IikgewogICAgICAgICAgICB0aGlzLmF1dGhlbnRpY2F0ZWQgPSB0cnVlOwogICAgICAgICAgICB0aGlzLl9jaGFuZ2VDb25uZWN0U3RhdHVzKFN0cm9waGUuU3RhdHVzLkNPTk5FQ1RFRCwgbnVsbCk7CiAgICAgICAgfSBlbHNlIGlmIChlbGVtLmdldEF0dHJpYnV0ZSgidHlwZSIpID09ICJlcnJvciIpIHsKICAgICAgICAgICAgdGhpcy5fY2hhbmdlQ29ubmVjdFN0YXR1cyhTdHJvcGhlLlN0YXR1cy5BVVRIRkFJTCwgbnVsbCk7CiAgICAgICAgICAgIHRoaXMuZGlzY29ubmVjdCgnYXV0aGVudGljYXRpb24gZmFpbGVkJyk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9LAoKICAgIC8qKiBQcml2YXRlRnVuY3Rpb246IF9hZGRTeXNUaW1lZEhhbmRsZXIKICAgICAqICBfUHJpdmF0ZV8gZnVuY3Rpb24gdG8gYWRkIGEgc3lzdGVtIGxldmVsIHRpbWVkIGhhbmRsZXIuCiAgICAgKgogICAgICogIFRoaXMgZnVuY3Rpb24gaXMgdXNlZCB0byBhZGQgYSBTdHJvcGhlLlRpbWVkSGFuZGxlciBmb3IgdGhlCiAgICAgKiAgbGlicmFyeSBjb2RlLiAgU3lzdGVtIHRpbWVkIGhhbmRsZXJzIGFyZSBhbGxvd2VkIHRvIHJ1biBiZWZvcmUKICAgICAqICBhdXRoZW50aWNhdGlvbiBpcyBjb21wbGV0ZS4KICAgICAqCiAgICAgKiAgUGFyYW1ldGVyczoKICAgICAqICAgIChJbnRlZ2VyKSBwZXJpb2QgLSBUaGUgcGVyaW9kIG9mIHRoZSBoYW5kbGVyLgogICAgICogICAgKEZ1bmN0aW9uKSBoYW5kbGVyIC0gVGhlIGNhbGxiYWNrIGZ1bmN0aW9uLgogICAgICovCiAgICBfYWRkU3lzVGltZWRIYW5kbGVyOiBmdW5jdGlvbiAocGVyaW9kLCBoYW5kbGVyKQogICAgewogICAgICAgIHZhciB0aGFuZCA9IG5ldyBTdHJvcGhlLlRpbWVkSGFuZGxlcihwZXJpb2QsIGhhbmRsZXIpOwogICAgICAgIHRoYW5kLnVzZXIgPSBmYWxzZTsKICAgICAgICB0aGlzLmFkZFRpbWVkcy5wdXNoKHRoYW5kKTsKICAgICAgICByZXR1cm4gdGhhbmQ7CiAgICB9LAoKICAgIC8qKiBQcml2YXRlRnVuY3Rpb246IF9hZGRTeXNIYW5kbGVyCiAgICAgKiAgX1ByaXZhdGVfIGZ1bmN0aW9uIHRvIGFkZCBhIHN5c3RlbSBsZXZlbCBzdGFuemEgaGFuZGxlci4KICAgICAqCiAgICAgKiAgVGhpcyBmdW5jdGlvbiBpcyB1c2VkIHRvIGFkZCBhIFN0cm9waGUuSGFuZGxlciBmb3IgdGhlCiAgICAgKiAgbGlicmFyeSBjb2RlLiAgU3lzdGVtIHN0YW56YSBoYW5kbGVycyBhcmUgYWxsb3dlZCB0byBydW4gYmVmb3JlCiAgICAgKiAgYXV0aGVudGljYXRpb24gaXMgY29tcGxldGUuCiAgICAgKgogICAgICogIFBhcmFtZXRlcnM6CiAgICAgKiAgICAoRnVuY3Rpb24pIGhhbmRsZXIgLSBUaGUgY2FsbGJhY2sgZnVuY3Rpb24uCiAgICAgKiAgICAoU3RyaW5nKSBucyAtIFRoZSBuYW1lc3BhY2UgdG8gbWF0Y2guCiAgICAgKiAgICAoU3RyaW5nKSBuYW1lIC0gVGhlIHN0YW56YSBuYW1lIHRvIG1hdGNoLgogICAgICogICAgKFN0cmluZykgdHlwZSAtIFRoZSBzdGFuemEgdHlwZSBhdHRyaWJ1dGUgdG8gbWF0Y2guCiAgICAgKiAgICAoU3RyaW5nKSBpZCAtIFRoZSBzdGFuemEgaWQgYXR0cmlidXRlIHRvIG1hdGNoLgogICAgICovCiAgICBfYWRkU3lzSGFuZGxlcjogZnVuY3Rpb24gKGhhbmRsZXIsIG5zLCBuYW1lLCB0eXBlLCBpZCkKICAgIHsKICAgICAgICB2YXIgaGFuZCA9IG5ldyBTdHJvcGhlLkhhbmRsZXIoaGFuZGxlciwgbnMsIG5hbWUsIHR5cGUsIGlkKTsKICAgICAgICBoYW5kLnVzZXIgPSBmYWxzZTsKICAgICAgICB0aGlzLmFkZEhhbmRsZXJzLnB1c2goaGFuZCk7CiAgICAgICAgcmV0dXJuIGhhbmQ7CiAgICB9LAoKICAgIC8qKiBQcml2YXRlRnVuY3Rpb246IF9vbkRpc2Nvbm5lY3RUaW1lb3V0CiAgICAgKiAgX1ByaXZhdGVfIHRpbWVvdXQgaGFuZGxlciBmb3IgaGFuZGxpbmcgbm9uLWdyYWNlZnVsIGRpc2Nvbm5lY3Rpb24uCiAgICAgKgogICAgICogIElmIHRoZSBncmFjZWZ1bCBkaXNjb25uZWN0IHByb2Nlc3MgZG9lcyBub3QgY29tcGxldGUgd2l0aGluIHRoZQogICAgICogIHRpbWUgYWxsb3R0ZWQsIHRoaXMgaGFuZGxlciBmaW5pc2hlcyB0aGUgZGlzY29ubmVjdCBhbnl3YXkuCiAgICAgKgogICAgICogIFJldHVybnM6CiAgICAgKiAgICBmYWxzZSB0byByZW1vdmUgdGhlIGhhbmRsZXIuCiAgICAgKi8KICAgIF9vbkRpc2Nvbm5lY3RUaW1lb3V0OiBmdW5jdGlvbiAoKQogICAgewogICAgICAgIFN0cm9waGUuaW5mbygiX29uRGlzY29ubmVjdFRpbWVvdXQgd2FzIGNhbGxlZCIpOwoKICAgICAgICB0aGlzLl9wcm90by5fb25EaXNjb25uZWN0VGltZW91dCgpOwoKICAgICAgICAvLyBhY3R1YWxseSBkaXNjb25uZWN0CiAgICAgICAgdGhpcy5fZG9EaXNjb25uZWN0KCk7CgogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0sCgogICAgLyoqIFByaXZhdGVGdW5jdGlvbjogX29uSWRsZQogICAgICogIF9Qcml2YXRlXyBoYW5kbGVyIHRvIHByb2Nlc3MgZXZlbnRzIGR1cmluZyBpZGxlIGN5Y2xlLgogICAgICoKICAgICAqICBUaGlzIGhhbmRsZXIgaXMgY2FsbGVkIGV2ZXJ5IDEwMG1zIHRvIGZpcmUgdGltZWQgaGFuZGxlcnMgdGhhdAogICAgICogIGFyZSByZWFkeSBhbmQga2VlcCBwb2xsIHJlcXVlc3RzIGdvaW5nLgogICAgICovCiAgICBfb25JZGxlOiBmdW5jdGlvbiAoKQogICAgewogICAgICAgIHZhciBpLCB0aGFuZCwgc2luY2UsIG5ld0xpc3Q7CgogICAgICAgIC8vIGFkZCB0aW1lZCBoYW5kbGVycyBzY2hlZHVsZWQgZm9yIGFkZGl0aW9uCiAgICAgICAgLy8gTk9URTogd2UgYWRkIGJlZm9yZSByZW1vdmUgaW4gdGhlIGNhc2UgYSB0aW1lZCBoYW5kbGVyIGlzCiAgICAgICAgLy8gYWRkZWQgYW5kIHRoZW4gZGVsZXRlZCBiZWZvcmUgdGhlIG5leHQgX29uSWRsZSgpIGNhbGwuCiAgICAgICAgd2hpbGUgKHRoaXMuYWRkVGltZWRzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgdGhpcy50aW1lZEhhbmRsZXJzLnB1c2godGhpcy5hZGRUaW1lZHMucG9wKCkpOwogICAgICAgIH0KCiAgICAgICAgLy8gcmVtb3ZlIHRpbWVkIGhhbmRsZXJzIHRoYXQgaGF2ZSBiZWVuIHNjaGVkdWxlZCBmb3IgZGVsZXRpb24KICAgICAgICB3aGlsZSAodGhpcy5yZW1vdmVUaW1lZHMubGVuZ3RoID4gMCkgewogICAgICAgICAgICB0aGFuZCA9IHRoaXMucmVtb3ZlVGltZWRzLnBvcCgpOwogICAgICAgICAgICBpID0gdGhpcy50aW1lZEhhbmRsZXJzLmluZGV4T2YodGhhbmQpOwogICAgICAgICAgICBpZiAoaSA+PSAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLnRpbWVkSGFuZGxlcnMuc3BsaWNlKGksIDEpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBjYWxsIHJlYWR5IHRpbWVkIGhhbmRsZXJzCiAgICAgICAgdmFyIG5vdyA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOwogICAgICAgIG5ld0xpc3QgPSBbXTsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdGhpcy50aW1lZEhhbmRsZXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHRoYW5kID0gdGhpcy50aW1lZEhhbmRsZXJzW2ldOwogICAgICAgICAgICBpZiAodGhpcy5hdXRoZW50aWNhdGVkIHx8ICF0aGFuZC51c2VyKSB7CiAgICAgICAgICAgICAgICBzaW5jZSA9IHRoYW5kLmxhc3RDYWxsZWQgKyB0aGFuZC5wZXJpb2Q7CiAgICAgICAgICAgICAgICBpZiAoc2luY2UgLSBub3cgPD0gMCkgewogICAgICAgICAgICAgICAgICAgIGlmICh0aGFuZC5ydW4oKSkgewogICAgICAgICAgICAgICAgICAgICAgICBuZXdMaXN0LnB1c2godGhhbmQpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbmV3TGlzdC5wdXNoKHRoYW5kKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB0aGlzLnRpbWVkSGFuZGxlcnMgPSBuZXdMaXN0OwoKICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5faWRsZVRpbWVvdXQpOwoKICAgICAgICB0aGlzLl9wcm90by5fb25JZGxlKCk7CgogICAgICAgIC8vIHJlYWN0aXZhdGUgdGhlIHRpbWVyIG9ubHkgaWYgY29ubmVjdGVkCiAgICAgICAgaWYgKHRoaXMuY29ubmVjdGVkKSB7CiAgICAgICAgICAgIHRoaXMuX2lkbGVUaW1lb3V0ID0gc2V0VGltZW91dCh0aGlzLl9vbklkbGUuYmluZCh0aGlzKSwgMTAwKTsKICAgICAgICB9CiAgICB9Cn07CgppZiAoY2FsbGJhY2spIHsKICAgIGNhbGxiYWNrKFN0cm9waGUsICRidWlsZCwgJG1zZywgJGlxLCAkcHJlcyk7Cn0KCi8qKiBDbGFzczogU3Ryb3BoZS5TQVNMTWVjaGFuaXNtCiAqCiAqICBlbmNhcHN1bGF0ZXMgU0FTTCBhdXRoZW50aWNhdGlvbiBtZWNoYW5pc21zLgogKgogKiAgVXNlciBjb2RlIG1heSBvdmVycmlkZSB0aGUgcHJpb3JpdHkgZm9yIGVhY2ggbWVjaGFuaXNtIG9yIGRpc2FibGUgaXQgY29tcGxldGVseS4KICogIFNlZSA8cHJpb3JpdHk+IGZvciBpbmZvcm1hdGlvbiBhYm91dCBjaGFuZ2luZyBwcmlvcml0eSBhbmQgPHRlc3Q+IGZvciBpbmZvcm1hdGlhbiBvbgogKiAgaG93IHRvIGRpc2FibGUgYSBtZWNoYW5pc20uCiAqCiAqICBCeSBkZWZhdWx0LCBhbGwgbWVjaGFuaXNtcyBhcmUgZW5hYmxlZCBhbmQgdGhlIHByaW9yaXRpZXMgYXJlCiAqCiAqICBTQ1JBTS1TSEExIC0gNDAKICogIERJR0VTVC1NRDUgLSAzMAogKiAgUGxhaW4gLSAyMAogKi8KCi8qKgogKiBQcml2YXRlQ29uc3RydWN0b3I6IFN0cm9waGUuU0FTTE1lY2hhbmlzbQogKiBTQVNMIGF1dGggbWVjaGFuaXNtIGFic3RyYWN0aW9uLgogKgogKiAgUGFyYW1ldGVyczoKICogICAgKFN0cmluZykgbmFtZSAtIFNBU0wgTWVjaGFuaXNtIG5hbWUuCiAqICAgIChCb29sZWFuKSBpc0NsaWVudEZpcnN0IC0gSWYgY2xpZW50IHNob3VsZCBzZW5kIHJlc3BvbnNlIGZpcnN0IHdpdGhvdXQgY2hhbGxlbmdlLgogKiAgICAoTnVtYmVyKSBwcmlvcml0eSAtIFByaW9yaXR5LgogKgogKiAgUmV0dXJuczoKICogICAgQSBuZXcgU3Ryb3BoZS5TQVNMTWVjaGFuaXNtIG9iamVjdC4KICovClN0cm9waGUuU0FTTE1lY2hhbmlzbSA9IGZ1bmN0aW9uKG5hbWUsIGlzQ2xpZW50Rmlyc3QsIHByaW9yaXR5KSB7CiAgLyoqIFByaXZhdGVWYXJpYWJsZTogbmFtZQogICAqICBNZWNoYW5pc20gbmFtZS4KICAgKi8KICB0aGlzLm5hbWUgPSBuYW1lOwogIC8qKiBQcml2YXRlVmFyaWFibGU6IGlzQ2xpZW50Rmlyc3QKICAgKiAgSWYgY2xpZW50IHNlbmRzIHJlc3BvbnNlIHdpdGhvdXQgaW5pdGlhbCBzZXJ2ZXIgY2hhbGxlbmdlLgogICAqLwogIHRoaXMuaXNDbGllbnRGaXJzdCA9IGlzQ2xpZW50Rmlyc3Q7CiAgLyoqIFZhcmlhYmxlOiBwcmlvcml0eQogICAqICBEZXRlcm1pbmVzIHdoaWNoIDxTQVNMTWVjaGFuaXNtPiBpcyBjaG9zZW4gZm9yIGF1dGhlbnRpY2F0aW9uIChIaWdoZXIgaXMgYmV0dGVyKS4KICAgKiAgVXNlcnMgbWF5IG92ZXJyaWRlIHRoaXMgdG8gcHJpb3JpdGl6ZSBtZWNoYW5pc21zIGRpZmZlcmVudGx5LgogICAqCiAgICogIEluIHRoZSBkZWZhdWx0IGNvbmZpZ3VyYXRpb24gdGhlIHByaW9yaXRpZXMgYXJlCiAgICoKICAgKiAgU0NSQU0tU0hBMSAtIDQwCiAgICogIERJR0VTVC1NRDUgLSAzMAogICAqICBQbGFpbiAtIDIwCiAgICoKICAgKiAgRXhhbXBsZTogKFRoaXMgd2lsbCBjYXVzZSBTdHJvcGhlIHRvIGNob29zZSB0aGUgbWVjaGFuaXNtIHRoYXQgdGhlIHNlcnZlciBzZW50IGZpcnN0KQogICAqCiAgICogID4gU3Ryb3BoZS5TQVNMTUQ1LnByaW9yaXR5ID0gU3Ryb3BoZS5TQVNMU0hBMS5wcmlvcml0eTsKICAgKgogICAqICBTZWUgPFNBU0wgbWVjaGFuaXNtcz4gZm9yIGEgbGlzdCBvZiBhdmFpbGFibGUgbWVjaGFuaXNtcy4KICAgKgogICAqLwogIHRoaXMucHJpb3JpdHkgPSBwcmlvcml0eTsKfTsKClN0cm9waGUuU0FTTE1lY2hhbmlzbS5wcm90b3R5cGUgPSB7CiAgLyoqCiAgICogIEZ1bmN0aW9uOiB0ZXN0CiAgICogIENoZWNrcyBpZiBtZWNoYW5pc20gYWJsZSB0byBydW4uCiAgICogIFRvIGRpc2FibGUgYSBtZWNoYW5pc20sIG1ha2UgdGhpcyByZXR1cm4gZmFsc2U7CiAgICoKICAgKiAgVG8gZGlzYWJsZSBwbGFpbiBhdXRoZW50aWNhdGlvbiBydW4KICAgKiAgPiBTdHJvcGhlLlNBU0xQbGFpbi50ZXN0ID0gZnVuY3Rpb24oKSB7CiAgICogID4gICByZXR1cm4gZmFsc2U7CiAgICogID4gfQogICAqCiAgICogIFNlZSA8U0FTTCBtZWNoYW5pc21zPiBmb3IgYSBsaXN0IG9mIGF2YWlsYWJsZSBtZWNoYW5pc21zLgogICAqCiAgICogIFBhcmFtZXRlcnM6CiAgICogICAgKFN0cm9waGUuQ29ubmVjdGlvbikgY29ubmVjdGlvbiAtIFRhcmdldCBDb25uZWN0aW9uLgogICAqCiAgICogIFJldHVybnM6CiAgICogICAgKEJvb2xlYW4pIElmIG1lY2hhbmlzbSB3YXMgYWJsZSB0byBydW4uCiAgICovCiAgLyoganNoaW50IHVudXNlZDpmYWxzZSAqLwogIHRlc3Q6IGZ1bmN0aW9uKGNvbm5lY3Rpb24pIHsKICAgIHJldHVybiB0cnVlOwogIH0sCiAgLyoganNoaW50IHVudXNlZDp0cnVlICovCgogIC8qKiBQcml2YXRlRnVuY3Rpb246IG9uU3RhcnQKICAgKiAgQ2FsbGVkIGJlZm9yZSBzdGFydGluZyBtZWNoYW5pc20gb24gc29tZSBjb25uZWN0aW9uLgogICAqCiAgICogIFBhcmFtZXRlcnM6CiAgICogICAgKFN0cm9waGUuQ29ubmVjdGlvbikgY29ubmVjdGlvbiAtIFRhcmdldCBDb25uZWN0aW9uLgogICAqLwogIG9uU3RhcnQ6IGZ1bmN0aW9uKGNvbm5lY3Rpb24pCiAgewogICAgdGhpcy5fY29ubmVjdGlvbiA9IGNvbm5lY3Rpb247CiAgfSwKCiAgLyoqIFByaXZhdGVGdW5jdGlvbjogb25DaGFsbGVuZ2UKICAgKiAgQ2FsbGVkIGJ5IHByb3RvY29sIGltcGxlbWVudGF0aW9uIG9uIGluY29taW5nIGNoYWxsZW5nZS4gSWYgY2xpZW50IGlzCiAgICogIGZpcnN0IChpc0NsaWVudEZpcnN0ID09IHRydWUpIGNoYWxsZW5nZSB3aWxsIGJlIG51bGwgb24gdGhlIGZpcnN0IGNhbGwuCiAgICoKICAgKiAgUGFyYW1ldGVyczoKICAgKiAgICAoU3Ryb3BoZS5Db25uZWN0aW9uKSBjb25uZWN0aW9uIC0gVGFyZ2V0IENvbm5lY3Rpb24uCiAgICogICAgKFN0cmluZykgY2hhbGxlbmdlIC0gY3VycmVudCBjaGFsbGVuZ2UgdG8gaGFuZGxlLgogICAqCiAgICogIFJldHVybnM6CiAgICogICAgKFN0cmluZykgTWVjaGFuaXNtIHJlc3BvbnNlLgogICAqLwogIC8qIGpzaGludCB1bnVzZWQ6ZmFsc2UgKi8KICBvbkNoYWxsZW5nZTogZnVuY3Rpb24oY29ubmVjdGlvbiwgY2hhbGxlbmdlKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoIllvdSBzaG91bGQgaW1wbGVtZW50IGNoYWxsZW5nZSBoYW5kbGluZyEiKTsKICB9LAogIC8qIGpzaGludCB1bnVzZWQ6dHJ1ZSAqLwoKICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiBvbkZhaWx1cmUKICAgKiAgUHJvdG9jb2wgaW5mb3JtcyBtZWNoYW5pc20gaW1wbGVtZW50YXRpb24gYWJvdXQgU0FTTCBmYWlsdXJlLgogICAqLwogIG9uRmFpbHVyZTogZnVuY3Rpb24oKSB7CiAgICB0aGlzLl9jb25uZWN0aW9uID0gbnVsbDsKICB9LAoKICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiBvblN1Y2Nlc3MKICAgKiAgUHJvdG9jb2wgaW5mb3JtcyBtZWNoYW5pc20gaW1wbGVtZW50YXRpb24gYWJvdXQgU0FTTCBzdWNjZXNzLgogICAqLwogIG9uU3VjY2VzczogZnVuY3Rpb24oKSB7CiAgICB0aGlzLl9jb25uZWN0aW9uID0gbnVsbDsKICB9Cn07CgogIC8qKiBDb25zdGFudHM6IFNBU0wgbWVjaGFuaXNtcwogICAqICBBdmFpbGFibGUgYXV0aGVudGljYXRpb24gbWVjaGFuaXNtcwogICAqCiAgICogIFN0cm9waGUuU0FTTEFub255bW91cyAtIFNBU0wgQW5vbnltb3VzIGF1dGhlbnRpY2F0aW9uLgogICAqICBTdHJvcGhlLlNBU0xQbGFpbiAtIFNBU0wgUGxhaW4gYXV0aGVudGljYXRpb24uCiAgICogIFN0cm9waGUuU0FTTE1ENSAtIFNBU0wgRGlnZXN0LU1ENSBhdXRoZW50aWNhdGlvbgogICAqICBTdHJvcGhlLlNBU0xTSEExIC0gU0FTTCBTQ1JBTS1TSEExIGF1dGhlbnRpY2F0aW9uCiAgICovCgovLyBCdWlsZGluZyBTQVNMIGNhbGxiYWNrcwoKLyoqIFByaXZhdGVDb25zdHJ1Y3RvcjogU0FTTEFub255bW91cwogKiAgU0FTTCBBbm9ueW1vdXMgYXV0aGVudGljYXRpb24uCiAqLwpTdHJvcGhlLlNBU0xBbm9ueW1vdXMgPSBmdW5jdGlvbigpIHt9OwoKU3Ryb3BoZS5TQVNMQW5vbnltb3VzLnByb3RvdHlwZSA9IG5ldyBTdHJvcGhlLlNBU0xNZWNoYW5pc20oIkFOT05ZTU9VUyIsIGZhbHNlLCAxMCk7CgpTdHJvcGhlLlNBU0xBbm9ueW1vdXMudGVzdCA9IGZ1bmN0aW9uKGNvbm5lY3Rpb24pIHsKICByZXR1cm4gY29ubmVjdGlvbi5hdXRoY2lkID09PSBudWxsOwp9OwoKU3Ryb3BoZS5Db25uZWN0aW9uLnByb3RvdHlwZS5tZWNoYW5pc21zW1N0cm9waGUuU0FTTEFub255bW91cy5wcm90b3R5cGUubmFtZV0gPSBTdHJvcGhlLlNBU0xBbm9ueW1vdXM7CgovKiogUHJpdmF0ZUNvbnN0cnVjdG9yOiBTQVNMUGxhaW4KICogIFNBU0wgUGxhaW4gYXV0aGVudGljYXRpb24uCiAqLwpTdHJvcGhlLlNBU0xQbGFpbiA9IGZ1bmN0aW9uKCkge307CgpTdHJvcGhlLlNBU0xQbGFpbi5wcm90b3R5cGUgPSBuZXcgU3Ryb3BoZS5TQVNMTWVjaGFuaXNtKCJQTEFJTiIsIHRydWUsIDIwKTsKClN0cm9waGUuU0FTTFBsYWluLnRlc3QgPSBmdW5jdGlvbihjb25uZWN0aW9uKSB7CiAgcmV0dXJuIGNvbm5lY3Rpb24uYXV0aGNpZCAhPT0gbnVsbDsKfTsKClN0cm9waGUuU0FTTFBsYWluLnByb3RvdHlwZS5vbkNoYWxsZW5nZSA9IGZ1bmN0aW9uKGNvbm5lY3Rpb24pIHsKICB2YXIgYXV0aF9zdHIgPSBjb25uZWN0aW9uLmF1dGh6aWQ7CiAgYXV0aF9zdHIgPSBhdXRoX3N0ciArICJcdTAwMDAiOwogIGF1dGhfc3RyID0gYXV0aF9zdHIgKyBjb25uZWN0aW9uLmF1dGhjaWQ7CiAgYXV0aF9zdHIgPSBhdXRoX3N0ciArICJcdTAwMDAiOwogIGF1dGhfc3RyID0gYXV0aF9zdHIgKyBjb25uZWN0aW9uLnBhc3M7CiAgcmV0dXJuIGF1dGhfc3RyOwp9OwoKU3Ryb3BoZS5Db25uZWN0aW9uLnByb3RvdHlwZS5tZWNoYW5pc21zW1N0cm9waGUuU0FTTFBsYWluLnByb3RvdHlwZS5uYW1lXSA9IFN0cm9waGUuU0FTTFBsYWluOwoKLyoqIFByaXZhdGVDb25zdHJ1Y3RvcjogU0FTTFNIQTEKICogIFNBU0wgU0NSQU0gU0hBIDEgYXV0aGVudGljYXRpb24uCiAqLwpTdHJvcGhlLlNBU0xTSEExID0gZnVuY3Rpb24oKSB7fTsKCi8qIFRFU1Q6CiAqIFRoaXMgaXMgYSBzaW1wbGUgZXhhbXBsZSBvZiBhIFNDUkFNLVNIQS0xIGF1dGhlbnRpY2F0aW9uIGV4Y2hhbmdlCiAqIHdoZW4gdGhlIGNsaWVudCBkb2Vzbid0IHN1cHBvcnQgY2hhbm5lbCBiaW5kaW5ncyAodXNlcm5hbWUgJ3VzZXInIGFuZAogKiBwYXNzd29yZCAncGVuY2lsJyBhcmUgdXNlZCk6CiAqCiAqIEM6IG4sLG49dXNlcixyPWZ5a28rZDJsYmJGZ09OUnY5cWt4ZGF3TAogKiBTOiByPWZ5a28rZDJsYmJGZ09OUnY5cWt4ZGF3TDNyZmNOSFlKWTFaVnZXVnM3aixzPVFTWENSK1E2c2VrOGJmOTIsCiAqIGk9NDA5NgogKiBDOiBjPWJpd3Mscj1meWtvK2QybGJiRmdPTlJ2OXFreGRhd0wzcmZjTkhZSlkxWlZ2V1ZzN2osCiAqIHA9djBYOHYzQnoyVDBDSkdiSlF5RjBYK0hJNFRzPQogKiBTOiB2PXJtRjlwcVY4UzdzdUFvWldqYTRkSlJrRnNLUT0KICoKICovCgpTdHJvcGhlLlNBU0xTSEExLnByb3RvdHlwZSA9IG5ldyBTdHJvcGhlLlNBU0xNZWNoYW5pc20oIlNDUkFNLVNIQS0xIiwgdHJ1ZSwgNDApOwoKU3Ryb3BoZS5TQVNMU0hBMS50ZXN0ID0gZnVuY3Rpb24oY29ubmVjdGlvbikgewogIHJldHVybiBjb25uZWN0aW9uLmF1dGhjaWQgIT09IG51bGw7Cn07CgpTdHJvcGhlLlNBU0xTSEExLnByb3RvdHlwZS5vbkNoYWxsZW5nZSA9IGZ1bmN0aW9uKGNvbm5lY3Rpb24sIGNoYWxsZW5nZSwgdGVzdF9jbm9uY2UpIHsKICB2YXIgY25vbmNlID0gdGVzdF9jbm9uY2UgfHwgTUQ1LmhleGRpZ2VzdChNYXRoLnJhbmRvbSgpICogMTIzNDU2Nzg5MCk7CgogIHZhciBhdXRoX3N0ciA9ICJuPSIgKyBjb25uZWN0aW9uLmF1dGhjaWQ7CiAgYXV0aF9zdHIgKz0gIixyPSI7CiAgYXV0aF9zdHIgKz0gY25vbmNlOwoKICBjb25uZWN0aW9uLl9zYXNsX2RhdGEuY25vbmNlID0gY25vbmNlOwogIGNvbm5lY3Rpb24uX3Nhc2xfZGF0YVsiY2xpZW50LWZpcnN0LW1lc3NhZ2UtYmFyZSJdID0gYXV0aF9zdHI7CgogIGF1dGhfc3RyID0gIm4sLCIgKyBhdXRoX3N0cjsKCiAgdGhpcy5vbkNoYWxsZW5nZSA9IGZ1bmN0aW9uIChjb25uZWN0aW9uLCBjaGFsbGVuZ2UpCiAgewogICAgdmFyIG5vbmNlLCBzYWx0LCBpdGVyLCBIaSwgVSwgVV9vbGQsIGksIGs7CiAgICB2YXIgY2xpZW50S2V5LCBzZXJ2ZXJLZXksIGNsaWVudFNpZ25hdHVyZTsKICAgIHZhciByZXNwb25zZVRleHQgPSAiYz1iaXdzLCI7CiAgICB2YXIgYXV0aE1lc3NhZ2UgPSBjb25uZWN0aW9uLl9zYXNsX2RhdGFbImNsaWVudC1maXJzdC1tZXNzYWdlLWJhcmUiXSArICIsIiArCiAgICAgIGNoYWxsZW5nZSArICIsIjsKICAgIHZhciBjbm9uY2UgPSBjb25uZWN0aW9uLl9zYXNsX2RhdGEuY25vbmNlOwogICAgdmFyIGF0dHJpYk1hdGNoID0gLyhbYS16XSspPShbXixdKykoLHwkKS87CgogICAgd2hpbGUgKGNoYWxsZW5nZS5tYXRjaChhdHRyaWJNYXRjaCkpIHsKICAgICAgdmFyIG1hdGNoZXMgPSBjaGFsbGVuZ2UubWF0Y2goYXR0cmliTWF0Y2gpOwogICAgICBjaGFsbGVuZ2UgPSBjaGFsbGVuZ2UucmVwbGFjZShtYXRjaGVzWzBdLCAiIik7CiAgICAgIHN3aXRjaCAobWF0Y2hlc1sxXSkgewogICAgICBjYXNlICJyIjoKICAgICAgICBub25jZSA9IG1hdGNoZXNbMl07CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgInMiOgogICAgICAgIHNhbHQgPSBtYXRjaGVzWzJdOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJpIjoKICAgICAgICBpdGVyID0gbWF0Y2hlc1syXTsKICAgICAgICBicmVhazsKICAgICAgfQogICAgfQoKICAgIGlmIChub25jZS5zdWJzdHIoMCwgY25vbmNlLmxlbmd0aCkgIT09IGNub25jZSkgewogICAgICBjb25uZWN0aW9uLl9zYXNsX2RhdGEgPSB7fTsKICAgICAgcmV0dXJuIGNvbm5lY3Rpb24uX3Nhc2xfZmFpbHVyZV9jYigpOwogICAgfQoKICAgIHJlc3BvbnNlVGV4dCArPSAicj0iICsgbm9uY2U7CiAgICBhdXRoTWVzc2FnZSArPSByZXNwb25zZVRleHQ7CgogICAgc2FsdCA9IEJhc2U2NC5kZWNvZGUoc2FsdCk7CiAgICBzYWx0ICs9ICJceDAwXHgwMFx4MDBceDAxIjsKCiAgICBIaSA9IFVfb2xkID0gY29yZV9obWFjX3NoYTEoY29ubmVjdGlvbi5wYXNzLCBzYWx0KTsKICAgIGZvciAoaSA9IDE7IGkgPCBpdGVyOyBpKyspIHsKICAgICAgVSA9IGNvcmVfaG1hY19zaGExKGNvbm5lY3Rpb24ucGFzcywgYmluYjJzdHIoVV9vbGQpKTsKICAgICAgZm9yIChrID0gMDsgayA8IDU7IGsrKykgewogICAgICAgIEhpW2tdIF49IFVba107CiAgICAgIH0KICAgICAgVV9vbGQgPSBVOwogICAgfQogICAgSGkgPSBiaW5iMnN0cihIaSk7CgogICAgY2xpZW50S2V5ID0gY29yZV9obWFjX3NoYTEoSGksICJDbGllbnQgS2V5Iik7CiAgICBzZXJ2ZXJLZXkgPSBzdHJfaG1hY19zaGExKEhpLCAiU2VydmVyIEtleSIpOwogICAgY2xpZW50U2lnbmF0dXJlID0gY29yZV9obWFjX3NoYTEoc3RyX3NoYTEoYmluYjJzdHIoY2xpZW50S2V5KSksIGF1dGhNZXNzYWdlKTsKICAgIGNvbm5lY3Rpb24uX3Nhc2xfZGF0YVsic2VydmVyLXNpZ25hdHVyZSJdID0gYjY0X2htYWNfc2hhMShzZXJ2ZXJLZXksIGF1dGhNZXNzYWdlKTsKCiAgICBmb3IgKGsgPSAwOyBrIDwgNTsgaysrKSB7CiAgICAgIGNsaWVudEtleVtrXSBePSBjbGllbnRTaWduYXR1cmVba107CiAgICB9CgogICAgcmVzcG9uc2VUZXh0ICs9ICIscD0iICsgQmFzZTY0LmVuY29kZShiaW5iMnN0cihjbGllbnRLZXkpKTsKCiAgICByZXR1cm4gcmVzcG9uc2VUZXh0OwogIH0uYmluZCh0aGlzKTsKCiAgcmV0dXJuIGF1dGhfc3RyOwp9OwoKU3Ryb3BoZS5Db25uZWN0aW9uLnByb3RvdHlwZS5tZWNoYW5pc21zW1N0cm9waGUuU0FTTFNIQTEucHJvdG90eXBlLm5hbWVdID0gU3Ryb3BoZS5TQVNMU0hBMTsKCi8qKiBQcml2YXRlQ29uc3RydWN0b3I6IFNBU0xNRDUKICogIFNBU0wgRElHRVNUIE1ENSBhdXRoZW50aWNhdGlvbi4KICovClN0cm9waGUuU0FTTE1ENSA9IGZ1bmN0aW9uKCkge307CgpTdHJvcGhlLlNBU0xNRDUucHJvdG90eXBlID0gbmV3IFN0cm9waGUuU0FTTE1lY2hhbmlzbSgiRElHRVNULU1ENSIsIGZhbHNlLCAzMCk7CgpTdHJvcGhlLlNBU0xNRDUudGVzdCA9IGZ1bmN0aW9uKGNvbm5lY3Rpb24pIHsKICByZXR1cm4gY29ubmVjdGlvbi5hdXRoY2lkICE9PSBudWxsOwp9OwoKLyoqIFByaXZhdGVGdW5jdGlvbjogX3F1b3RlCiAqICBfUHJpdmF0ZV8gdXRpbGl0eSBmdW5jdGlvbiB0byBiYWNrc2xhc2ggZXNjYXBlIGFuZCBxdW90ZSBzdHJpbmdzLgogKgogKiAgUGFyYW1ldGVyczoKICogICAgKFN0cmluZykgc3RyIC0gVGhlIHN0cmluZyB0byBiZSBxdW90ZWQuCiAqCiAqICBSZXR1cm5zOgogKiAgICBxdW90ZWQgc3RyaW5nCiAqLwpTdHJvcGhlLlNBU0xNRDUucHJvdG90eXBlLl9xdW90ZSA9IGZ1bmN0aW9uIChzdHIpCiAgewogICAgcmV0dXJuICciJyArIHN0ci5yZXBsYWNlKC9cXC9nLCAiXFxcXCIpLnJlcGxhY2UoLyIvZywgJ1xcIicpICsgJyInOwogICAgLy8iIGVuZCBzdHJpbmcgd29ya2Fyb3VuZCBmb3IgZW1hY3MKICB9OwoKClN0cm9waGUuU0FTTE1ENS5wcm90b3R5cGUub25DaGFsbGVuZ2UgPSBmdW5jdGlvbihjb25uZWN0aW9uLCBjaGFsbGVuZ2UsIHRlc3RfY25vbmNlKSB7CiAgdmFyIGF0dHJpYk1hdGNoID0gLyhbYS16XSspPSgiW14iXSsifFteLCJdKykoPzosfCQpLzsKICB2YXIgY25vbmNlID0gdGVzdF9jbm9uY2UgfHwgTUQ1LmhleGRpZ2VzdCgiIiArIChNYXRoLnJhbmRvbSgpICogMTIzNDU2Nzg5MCkpOwogIHZhciByZWFsbSA9ICIiOwogIHZhciBob3N0ID0gbnVsbDsKICB2YXIgbm9uY2UgPSAiIjsKICB2YXIgcW9wID0gIiI7CiAgdmFyIG1hdGNoZXM7CgogIHdoaWxlIChjaGFsbGVuZ2UubWF0Y2goYXR0cmliTWF0Y2gpKSB7CiAgICBtYXRjaGVzID0gY2hhbGxlbmdlLm1hdGNoKGF0dHJpYk1hdGNoKTsKICAgIGNoYWxsZW5nZSA9IGNoYWxsZW5nZS5yZXBsYWNlKG1hdGNoZXNbMF0sICIiKTsKICAgIG1hdGNoZXNbMl0gPSBtYXRjaGVzWzJdLnJlcGxhY2UoL14iKC4rKSIkLywgIiQxIik7CiAgICBzd2l0Y2ggKG1hdGNoZXNbMV0pIHsKICAgIGNhc2UgInJlYWxtIjoKICAgICAgcmVhbG0gPSBtYXRjaGVzWzJdOwogICAgICBicmVhazsKICAgIGNhc2UgIm5vbmNlIjoKICAgICAgbm9uY2UgPSBtYXRjaGVzWzJdOwogICAgICBicmVhazsKICAgIGNhc2UgInFvcCI6CiAgICAgIHFvcCA9IG1hdGNoZXNbMl07CiAgICAgIGJyZWFrOwogICAgY2FzZSAiaG9zdCI6CiAgICAgIGhvc3QgPSBtYXRjaGVzWzJdOwogICAgICBicmVhazsKICAgIH0KICB9CgogIHZhciBkaWdlc3RfdXJpID0gY29ubmVjdGlvbi5zZXJ2dHlwZSArICIvIiArIGNvbm5lY3Rpb24uZG9tYWluOwogIGlmIChob3N0ICE9PSBudWxsKSB7CiAgICBkaWdlc3RfdXJpID0gZGlnZXN0X3VyaSArICIvIiArIGhvc3Q7CiAgfQoKICB2YXIgQTEgPSBNRDUuaGFzaChjb25uZWN0aW9uLmF1dGhjaWQgKwogICAgICAgICAgICAgICAgICAgICI6IiArIHJlYWxtICsgIjoiICsgdGhpcy5fY29ubmVjdGlvbi5wYXNzKSArCiAgICAiOiIgKyBub25jZSArICI6IiArIGNub25jZTsKICB2YXIgQTIgPSAnQVVUSEVOVElDQVRFOicgKyBkaWdlc3RfdXJpOwoKICB2YXIgcmVzcG9uc2VUZXh0ID0gIiI7CiAgcmVzcG9uc2VUZXh0ICs9ICdjaGFyc2V0PXV0Zi04LCc7CiAgcmVzcG9uc2VUZXh0ICs9ICd1c2VybmFtZT0nICsKICAgIHRoaXMuX3F1b3RlKGNvbm5lY3Rpb24uYXV0aGNpZCkgKyAnLCc7CiAgcmVzcG9uc2VUZXh0ICs9ICdyZWFsbT0nICsgdGhpcy5fcXVvdGUocmVhbG0pICsgJywnOwogIHJlc3BvbnNlVGV4dCArPSAnbm9uY2U9JyArIHRoaXMuX3F1b3RlKG5vbmNlKSArICcsJzsKICByZXNwb25zZVRleHQgKz0gJ25jPTAwMDAwMDAxLCc7CiAgcmVzcG9uc2VUZXh0ICs9ICdjbm9uY2U9JyArIHRoaXMuX3F1b3RlKGNub25jZSkgKyAnLCc7CiAgcmVzcG9uc2VUZXh0ICs9ICdkaWdlc3QtdXJpPScgKyB0aGlzLl9xdW90ZShkaWdlc3RfdXJpKSArICcsJzsKICByZXNwb25zZVRleHQgKz0gJ3Jlc3BvbnNlPScgKyBNRDUuaGV4ZGlnZXN0KE1ENS5oZXhkaWdlc3QoQTEpICsgIjoiICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vbmNlICsgIjowMDAwMDAwMToiICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNub25jZSArICI6YXV0aDoiICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1ENS5oZXhkaWdlc3QoQTIpKSArICIsIjsKICByZXNwb25zZVRleHQgKz0gJ3FvcD1hdXRoJzsKCiAgdGhpcy5vbkNoYWxsZW5nZSA9IGZ1bmN0aW9uICgpCiAgewogICAgcmV0dXJuICIiOwogIH0uYmluZCh0aGlzKTsKCiAgcmV0dXJuIHJlc3BvbnNlVGV4dDsKfTsKClN0cm9waGUuQ29ubmVjdGlvbi5wcm90b3R5cGUubWVjaGFuaXNtc1tTdHJvcGhlLlNBU0xNRDUucHJvdG90eXBlLm5hbWVdID0gU3Ryb3BoZS5TQVNMTUQ1OwoKfSkoZnVuY3Rpb24gKCkgewogICAgd2luZG93LlN0cm9waGUgPSBhcmd1bWVudHNbMF07CiAgICB3aW5kb3cuJGJ1aWxkID0gYXJndW1lbnRzWzFdOwogICAgd2luZG93LiRtc2cgPSBhcmd1bWVudHNbMl07CiAgICB3aW5kb3cuJGlxID0gYXJndW1lbnRzWzNdOwogICAgd2luZG93LiRwcmVzID0gYXJndW1lbnRzWzRdOwp9KTsKCi8qCiAgICBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBNSVQgbGljZW5zZS4KICAgIFBsZWFzZSBzZWUgdGhlIExJQ0VOU0UgZmlsZSBmb3IgZGV0YWlscy4KCiAgICBDb3B5cmlnaHQgMjAwNi0yMDA4LCBPR0csIExMQwoqLwoKLyoganNoaW50IHVuZGVmOiB0cnVlLCB1bnVzZWQ6IHRydWU6LCBub2FyZzogdHJ1ZSwgbGF0ZWRlZjogdHJ1ZSAqLwovKmdsb2JhbCB3aW5kb3csIHNldFRpbWVvdXQsIGNsZWFyVGltZW91dCwKICAgIFhNTEh0dHBSZXF1ZXN0LCBBY3RpdmVYT2JqZWN0LAogICAgU3Ryb3BoZSwgJGJ1aWxkICovCgoKLyoqIFByaXZhdGVDbGFzczogU3Ryb3BoZS5SZXF1ZXN0CiAqICBfUHJpdmF0ZV8gaGVscGVyIGNsYXNzIHRoYXQgcHJvdmlkZXMgYSBjcm9zcyBpbXBsZW1lbnRhdGlvbiBhYnN0cmFjdGlvbgogKiAgZm9yIGEgQk9TSCByZWxhdGVkIFhNTEh0dHBSZXF1ZXN0LgogKgogKiAgVGhlIFN0cm9waGUuUmVxdWVzdCBjbGFzcyBpcyB1c2VkIGludGVybmFsbHkgdG8gZW5jYXBzdWxhdGUgQk9TSCByZXF1ZXN0CiAqICBpbmZvcm1hdGlvbi4gIEl0IGlzIG5vdCBtZWFudCB0byBiZSB1c2VkIGZyb20gdXNlcidzIGNvZGUuCiAqLwoKLyoqIFByaXZhdGVDb25zdHJ1Y3RvcjogU3Ryb3BoZS5SZXF1ZXN0CiAqICBDcmVhdGUgYW5kIGluaXRpYWxpemUgYSBuZXcgU3Ryb3BoZS5SZXF1ZXN0IG9iamVjdC4KICoKICogIFBhcmFtZXRlcnM6CiAqICAgIChYTUxFbGVtZW50KSBlbGVtIC0gVGhlIFhNTCBkYXRhIHRvIGJlIHNlbnQgaW4gdGhlIHJlcXVlc3QuCiAqICAgIChGdW5jdGlvbikgZnVuYyAtIFRoZSBmdW5jdGlvbiB0aGF0IHdpbGwgYmUgY2FsbGVkIHdoZW4gdGhlCiAqICAgICAgWE1MSHR0cFJlcXVlc3QgcmVhZHlTdGF0ZSBjaGFuZ2VzLgogKiAgICAoSW50ZWdlcikgcmlkIC0gVGhlIEJPU0ggcmlkIGF0dHJpYnV0ZSBhc3NvY2lhdGVkIHdpdGggdGhpcyByZXF1ZXN0LgogKiAgICAoSW50ZWdlcikgc2VuZHMgLSBUaGUgbnVtYmVyIG9mIHRpbWVzIHRoaXMgc2FtZSByZXF1ZXN0IGhhcyBiZWVuCiAqICAgICAgc2VudC4KICovClN0cm9waGUuUmVxdWVzdCA9IGZ1bmN0aW9uIChlbGVtLCBmdW5jLCByaWQsIHNlbmRzKQp7CiAgICB0aGlzLmlkID0gKytTdHJvcGhlLl9yZXF1ZXN0SWQ7CiAgICB0aGlzLnhtbERhdGEgPSBlbGVtOwogICAgdGhpcy5kYXRhID0gU3Ryb3BoZS5zZXJpYWxpemUoZWxlbSk7CiAgICAvLyBzYXZlIG9yaWdpbmFsIGZ1bmN0aW9uIGluIGNhc2Ugd2UgbmVlZCB0byBtYWtlIGEgbmV3IHJlcXVlc3QKICAgIC8vIGZyb20gdGhpcyBvbmUuCiAgICB0aGlzLm9yaWdGdW5jID0gZnVuYzsKICAgIHRoaXMuZnVuYyA9IGZ1bmM7CiAgICB0aGlzLnJpZCA9IHJpZDsKICAgIHRoaXMuZGF0ZSA9IE5hTjsKICAgIHRoaXMuc2VuZHMgPSBzZW5kcyB8fCAwOwogICAgdGhpcy5hYm9ydCA9IGZhbHNlOwogICAgdGhpcy5kZWFkID0gbnVsbDsKCiAgICB0aGlzLmFnZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAoIXRoaXMuZGF0ZSkgeyByZXR1cm4gMDsgfQogICAgICAgIHZhciBub3cgPSBuZXcgRGF0ZSgpOwogICAgICAgIHJldHVybiAobm93IC0gdGhpcy5kYXRlKSAvIDEwMDA7CiAgICB9OwogICAgdGhpcy50aW1lRGVhZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAoIXRoaXMuZGVhZCkgeyByZXR1cm4gMDsgfQogICAgICAgIHZhciBub3cgPSBuZXcgRGF0ZSgpOwogICAgICAgIHJldHVybiAobm93IC0gdGhpcy5kZWFkKSAvIDEwMDA7CiAgICB9OwogICAgdGhpcy54aHIgPSB0aGlzLl9uZXdYSFIoKTsKfTsKClN0cm9waGUuUmVxdWVzdC5wcm90b3R5cGUgPSB7CiAgICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiBnZXRSZXNwb25zZQogICAgICogIEdldCBhIHJlc3BvbnNlIGZyb20gdGhlIHVuZGVybHlpbmcgWE1MSHR0cFJlcXVlc3QuCiAgICAgKgogICAgICogIFRoaXMgZnVuY3Rpb24gYXR0ZW1wdHMgdG8gZ2V0IGEgcmVzcG9uc2UgZnJvbSB0aGUgcmVxdWVzdCBhbmQgY2hlY2tzCiAgICAgKiAgZm9yIGVycm9ycy4KICAgICAqCiAgICAgKiAgVGhyb3dzOgogICAgICogICAgInBhcnNlcmVycm9yIiAtIEEgcGFyc2VyIGVycm9yIG9jY3VyZWQuCiAgICAgKgogICAgICogIFJldHVybnM6CiAgICAgKiAgICBUaGUgRE9NIGVsZW1lbnQgdHJlZSBvZiB0aGUgcmVzcG9uc2UuCiAgICAgKi8KICAgIGdldFJlc3BvbnNlOiBmdW5jdGlvbiAoKQogICAgewogICAgICAgIHZhciBub2RlID0gbnVsbDsKICAgICAgICBpZiAodGhpcy54aHIucmVzcG9uc2VYTUwgJiYgdGhpcy54aHIucmVzcG9uc2VYTUwuZG9jdW1lbnRFbGVtZW50KSB7CiAgICAgICAgICAgIG5vZGUgPSB0aGlzLnhoci5yZXNwb25zZVhNTC5kb2N1bWVudEVsZW1lbnQ7CiAgICAgICAgICAgIGlmIChub2RlLnRhZ05hbWUgPT0gInBhcnNlcmVycm9yIikgewogICAgICAgICAgICAgICAgU3Ryb3BoZS5lcnJvcigiaW52YWxpZCByZXNwb25zZSByZWNlaXZlZCIpOwogICAgICAgICAgICAgICAgU3Ryb3BoZS5lcnJvcigicmVzcG9uc2VUZXh0OiAiICsgdGhpcy54aHIucmVzcG9uc2VUZXh0KTsKICAgICAgICAgICAgICAgIFN0cm9waGUuZXJyb3IoInJlc3BvbnNlWE1MOiAiICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3Ryb3BoZS5zZXJpYWxpemUodGhpcy54aHIucmVzcG9uc2VYTUwpKTsKICAgICAgICAgICAgICAgIHRocm93ICJwYXJzZXJlcnJvciI7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKHRoaXMueGhyLnJlc3BvbnNlVGV4dCkgewogICAgICAgICAgICBTdHJvcGhlLmVycm9yKCJpbnZhbGlkIHJlc3BvbnNlIHJlY2VpdmVkIik7CiAgICAgICAgICAgIFN0cm9waGUuZXJyb3IoInJlc3BvbnNlVGV4dDogIiArIHRoaXMueGhyLnJlc3BvbnNlVGV4dCk7CiAgICAgICAgICAgIFN0cm9waGUuZXJyb3IoInJlc3BvbnNlWE1MOiAiICsKICAgICAgICAgICAgICAgICAgICAgICAgICBTdHJvcGhlLnNlcmlhbGl6ZSh0aGlzLnhoci5yZXNwb25zZVhNTCkpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG5vZGU7CiAgICB9LAoKICAgIC8qKiBQcml2YXRlRnVuY3Rpb246IF9uZXdYSFIKICAgICAqICBfUHJpdmF0ZV8gaGVscGVyIGZ1bmN0aW9uIHRvIGNyZWF0ZSBYTUxIdHRwUmVxdWVzdHMuCiAgICAgKgogICAgICogIFRoaXMgZnVuY3Rpb24gY3JlYXRlcyBYTUxIdHRwUmVxdWVzdHMgYWNyb3NzIGFsbCBpbXBsZW1lbnRhdGlvbnMuCiAgICAgKgogICAgICogIFJldHVybnM6CiAgICAgKiAgICBBIG5ldyBYTUxIdHRwUmVxdWVzdC4KICAgICAqLwogICAgX25ld1hIUjogZnVuY3Rpb24gKCkKICAgIHsKICAgICAgICB2YXIgeGhyID0gbnVsbDsKICAgICAgICBpZiAod2luZG93LlhNTEh0dHBSZXF1ZXN0KSB7CiAgICAgICAgICAgIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOwogICAgICAgICAgICBpZiAoeGhyLm92ZXJyaWRlTWltZVR5cGUpIHsKICAgICAgICAgICAgICAgIHhoci5vdmVycmlkZU1pbWVUeXBlKCJ0ZXh0L3htbCIpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmICh3aW5kb3cuQWN0aXZlWE9iamVjdCkgewogICAgICAgICAgICB4aHIgPSBuZXcgQWN0aXZlWE9iamVjdCgiTWljcm9zb2Z0LlhNTEhUVFAiKTsKICAgICAgICB9CgogICAgICAgIC8vIHVzZSBGdW5jdGlvbi5iaW5kKCkgdG8gcHJlcGVuZCBvdXJzZWx2ZXMgYXMgYW4gYXJndW1lbnQKICAgICAgICB4aHIub25yZWFkeXN0YXRlY2hhbmdlID0gdGhpcy5mdW5jLmJpbmQobnVsbCwgdGhpcyk7CgogICAgICAgIHJldHVybiB4aHI7CiAgICB9Cn07CgovKiogQ2xhc3M6IFN0cm9waGUuQm9zaAogKiAgX1ByaXZhdGVfIGhlbHBlciBjbGFzcyB0aGF0IGhhbmRsZXMgQk9TSCBDb25uZWN0aW9ucwogKgogKiAgVGhlIFN0cm9waGUuQm9zaCBjbGFzcyBpcyB1c2VkIGludGVybmFsbHkgYnkgU3Ryb3BoZS5Db25uZWN0aW9uCiAqICB0byBlbmNhcHN1bGF0ZSBCT1NIIHNlc3Npb25zLiBJdCBpcyBub3QgbWVhbnQgdG8gYmUgdXNlZCBmcm9tIHVzZXIncyBjb2RlLgogKi8KCi8qKiBGaWxlOiBib3NoLmpzCiAqICBBIEphdmFTY3JpcHQgbGlicmFyeSB0byBlbmFibGUgQk9TSCBpbiBTdHJvcGhlanMuCiAqCiAqICB0aGlzIGxpYnJhcnkgdXNlcyBCaWRpcmVjdGlvbmFsLXN0cmVhbXMgT3ZlciBTeW5jaHJvbm91cyBIVFRQIChCT1NIKQogKiAgdG8gZW11bGF0ZSBhIHBlcnNpc3RlbnQsIHN0YXRlZnVsLCB0d28td2F5IGNvbm5lY3Rpb24gdG8gYW4gWE1QUCBzZXJ2ZXIuCiAqICBNb3JlIGluZm9ybWF0aW9uIG9uIEJPU0ggY2FuIGJlIGZvdW5kIGluIFhFUCAxMjQuCiAqLwoKLyoqIFByaXZhdGVDb25zdHJ1Y3RvcjogU3Ryb3BoZS5Cb3NoCiAqICBDcmVhdGUgYW5kIGluaXRpYWxpemUgYSBTdHJvcGhlLkJvc2ggb2JqZWN0LgogKgogKiAgUGFyYW1ldGVyczoKICogICAgKFN0cm9waGUuQ29ubmVjdGlvbikgY29ubmVjdGlvbiAtIFRoZSBTdHJvcGhlLkNvbm5lY3Rpb24gdGhhdCB3aWxsIHVzZSBCT1NILgogKgogKiAgUmV0dXJuczoKICogICAgQSBuZXcgU3Ryb3BoZS5Cb3NoIG9iamVjdC4KICovClN0cm9waGUuQm9zaCA9IGZ1bmN0aW9uKGNvbm5lY3Rpb24pIHsKICAgIHRoaXMuX2Nvbm4gPSBjb25uZWN0aW9uOwogICAgLyogcmVxdWVzdCBpZCBmb3IgYm9keSB0YWdzICovCiAgICB0aGlzLnJpZCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDQyOTQ5NjcyOTUpOwogICAgLyogVGhlIGN1cnJlbnQgc2Vzc2lvbiBJRC4gKi8KICAgIHRoaXMuc2lkID0gbnVsbDsKCiAgICAvLyBkZWZhdWx0IEJPU0ggdmFsdWVzCiAgICB0aGlzLmhvbGQgPSAxOwogICAgdGhpcy53YWl0ID0gNjA7CiAgICB0aGlzLndpbmRvdyA9IDU7CgogICAgdGhpcy5fcmVxdWVzdHMgPSBbXTsKfTsKClN0cm9waGUuQm9zaC5wcm90b3R5cGUgPSB7CiAgICAvKiogVmFyaWFibGU6IHN0cmlwCiAgICAgKgogICAgICogIEJPU0gtQ29ubmVjdGlvbnMgd2lsbCBoYXZlIGFsbCBzdGFuemFzIHdyYXBwZWQgaW4gYSA8Ym9keT4gdGFnIHdoZW4KICAgICAqICBwYXNzZWQgdG8gPFN0cm9waGUuQ29ubmVjdGlvbi54bWxJbnB1dD4gb3IgPFN0cm9waGUuQ29ubmVjdGlvbi54bWxPdXRwdXQ+LgogICAgICogIFRvIHN0cmlwIHRoaXMgdGFnLCBVc2VyIGNvZGUgY2FuIHNldCA8U3Ryb3BoZS5Cb3NoLnN0cmlwPiB0byAiYm9keSI6CiAgICAgKgogICAgICogID4gU3Ryb3BoZS5Cb3NoLnByb3RvdHlwZS5zdHJpcCA9ICJib2R5IjsKICAgICAqCiAgICAgKiAgVGhpcyB3aWxsIGVuYWJsZSBzdHJpcHBpbmcgb2YgdGhlIGJvZHkgdGFnIGluIGJvdGgKICAgICAqICA8U3Ryb3BoZS5Db25uZWN0aW9uLnhtbElucHV0PiBhbmQgPFN0cm9waGUuQ29ubmVjdGlvbi54bWxPdXRwdXQ+LgogICAgICovCiAgICBzdHJpcDogbnVsbCwKCiAgICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiBfYnVpbGRCb2R5CiAgICAgKiAgX1ByaXZhdGVfIGhlbHBlciBmdW5jdGlvbiB0byBnZW5lcmF0ZSB0aGUgPGJvZHkvPiB3cmFwcGVyIGZvciBCT1NILgogICAgICoKICAgICAqICBSZXR1cm5zOgogICAgICogICAgQSBTdHJvcGhlLkJ1aWxkZXIgd2l0aCBhIDxib2R5Lz4gZWxlbWVudC4KICAgICAqLwogICAgX2J1aWxkQm9keTogZnVuY3Rpb24gKCkKICAgIHsKICAgICAgICB2YXIgYm9keVdyYXAgPSAkYnVpbGQoJ2JvZHknLCB7CiAgICAgICAgICAgIHJpZDogdGhpcy5yaWQrKywKICAgICAgICAgICAgeG1sbnM6IFN0cm9waGUuTlMuSFRUUEJJTkQKICAgICAgICB9KTsKCiAgICAgICAgaWYgKHRoaXMuc2lkICE9PSBudWxsKSB7CiAgICAgICAgICAgIGJvZHlXcmFwLmF0dHJzKHtzaWQ6IHRoaXMuc2lkfSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gYm9keVdyYXA7CiAgICB9LAoKICAgIC8qKiBQcml2YXRlRnVuY3Rpb246IF9yZXNldAogICAgICogIFJlc2V0IHRoZSBjb25uZWN0aW9uLgogICAgICoKICAgICAqICBUaGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCBieSB0aGUgcmVzZXQgZnVuY3Rpb24gb2YgdGhlIFN0cm9waGUgQ29ubmVjdGlvbgogICAgICovCiAgICBfcmVzZXQ6IGZ1bmN0aW9uICgpCiAgICB7CiAgICAgICAgdGhpcy5yaWQgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiA0Mjk0OTY3Mjk1KTsKICAgICAgICB0aGlzLnNpZCA9IG51bGw7CiAgICB9LAoKICAgIC8qKiBQcml2YXRlRnVuY3Rpb246IF9jb25uZWN0CiAgICAgKiAgX1ByaXZhdGVfIGZ1bmN0aW9uIHRoYXQgaW5pdGlhbGl6ZXMgdGhlIEJPU0ggY29ubmVjdGlvbi4KICAgICAqCiAgICAgKiAgQ3JlYXRlcyBhbmQgc2VuZHMgdGhlIFJlcXVlc3QgdGhhdCBpbml0aWFsaXplcyB0aGUgQk9TSCBjb25uZWN0aW9uLgogICAgICovCiAgICBfY29ubmVjdDogZnVuY3Rpb24gKHdhaXQsIGhvbGQsIHJvdXRlKQogICAgewogICAgICAgIHRoaXMud2FpdCA9IHdhaXQgfHwgdGhpcy53YWl0OwogICAgICAgIHRoaXMuaG9sZCA9IGhvbGQgfHwgdGhpcy5ob2xkOwoKICAgICAgICAvLyBidWlsZCB0aGUgYm9keSB0YWcKICAgICAgICB2YXIgYm9keSA9IHRoaXMuX2J1aWxkQm9keSgpLmF0dHJzKHsKICAgICAgICAgICAgdG86IHRoaXMuX2Nvbm4uZG9tYWluLAogICAgICAgICAgICAieG1sOmxhbmciOiAiZW4iLAogICAgICAgICAgICB3YWl0OiB0aGlzLndhaXQsCiAgICAgICAgICAgIGhvbGQ6IHRoaXMuaG9sZCwKICAgICAgICAgICAgY29udGVudDogInRleHQveG1sOyBjaGFyc2V0PXV0Zi04IiwKICAgICAgICAgICAgdmVyOiAiMS42IiwKICAgICAgICAgICAgInhtcHA6dmVyc2lvbiI6ICIxLjAiLAogICAgICAgICAgICAieG1sbnM6eG1wcCI6IFN0cm9waGUuTlMuQk9TSAogICAgICAgIH0pOwoKICAgICAgICBpZihyb3V0ZSl7CiAgICAgICAgICAgIGJvZHkuYXR0cnMoewogICAgICAgICAgICAgICAgcm91dGU6IHJvdXRlCiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgdmFyIF9jb25uZWN0X2NiID0gdGhpcy5fY29ubi5fY29ubmVjdF9jYjsKCiAgICAgICAgdGhpcy5fcmVxdWVzdHMucHVzaCgKICAgICAgICAgICAgbmV3IFN0cm9waGUuUmVxdWVzdChib2R5LnRyZWUoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9vblJlcXVlc3RTdGF0ZUNoYW5nZS5iaW5kKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLCBfY29ubmVjdF9jYi5iaW5kKHRoaXMuX2Nvbm4pKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib2R5LnRyZWUoKS5nZXRBdHRyaWJ1dGUoInJpZCIpKSk7CiAgICAgICAgdGhpcy5fdGhyb3R0bGVkUmVxdWVzdEhhbmRsZXIoKTsKICAgIH0sCgogICAgLyoqIFByaXZhdGVGdW5jdGlvbjogX2F0dGFjaAogICAgICogIEF0dGFjaCB0byBhbiBhbHJlYWR5IGNyZWF0ZWQgYW5kIGF1dGhlbnRpY2F0ZWQgQk9TSCBzZXNzaW9uLgogICAgICoKICAgICAqICBUaGlzIGZ1bmN0aW9uIGlzIHByb3ZpZGVkIHRvIGFsbG93IFN0cm9waGUgdG8gYXR0YWNoIHRvIEJPU0gKICAgICAqICBzZXNzaW9ucyB3aGljaCBoYXZlIGJlZW4gY3JlYXRlZCBleHRlcm5hbGx5LCBwZXJoYXBzIGJ5IGEgV2ViCiAgICAgKiAgYXBwbGljYXRpb24uICBUaGlzIGlzIG9mdGVuIHVzZWQgdG8gc3VwcG9ydCBhdXRvLWxvZ2luIHR5cGUgZmVhdHVyZXMKICAgICAqICB3aXRob3V0IHB1dHRpbmcgdXNlciBjcmVkZW50aWFscyBpbnRvIHRoZSBwYWdlLgogICAgICoKICAgICAqICBQYXJhbWV0ZXJzOgogICAgICogICAgKFN0cmluZykgamlkIC0gVGhlIGZ1bGwgSklEIHRoYXQgaXMgYm91bmQgYnkgdGhlIHNlc3Npb24uCiAgICAgKiAgICAoU3RyaW5nKSBzaWQgLSBUaGUgU0lEIG9mIHRoZSBCT1NIIHNlc3Npb24uCiAgICAgKiAgICAoU3RyaW5nKSByaWQgLSBUaGUgY3VycmVudCBSSUQgb2YgdGhlIEJPU0ggc2Vzc2lvbi4gIFRoaXMgUklECiAgICAgKiAgICAgIHdpbGwgYmUgdXNlZCBieSB0aGUgbmV4dCByZXF1ZXN0LgogICAgICogICAgKEZ1bmN0aW9uKSBjYWxsYmFjayBUaGUgY29ubmVjdCBjYWxsYmFjayBmdW5jdGlvbi4KICAgICAqICAgIChJbnRlZ2VyKSB3YWl0IC0gVGhlIG9wdGlvbmFsIEhUVFBCSU5EIHdhaXQgdmFsdWUuICBUaGlzIGlzIHRoZQogICAgICogICAgICB0aW1lIHRoZSBzZXJ2ZXIgd2lsbCB3YWl0IGJlZm9yZSByZXR1cm5pbmcgYW4gZW1wdHkgcmVzdWx0IGZvcgogICAgICogICAgICBhIHJlcXVlc3QuICBUaGUgZGVmYXVsdCBzZXR0aW5nIG9mIDYwIHNlY29uZHMgaXMgcmVjb21tZW5kZWQuCiAgICAgKiAgICAgIE90aGVyIHNldHRpbmdzIHdpbGwgcmVxdWlyZSB0d2Vha3MgdG8gdGhlIFN0cm9waGUuVElNRU9VVCB2YWx1ZS4KICAgICAqICAgIChJbnRlZ2VyKSBob2xkIC0gVGhlIG9wdGlvbmFsIEhUVFBCSU5EIGhvbGQgdmFsdWUuICBUaGlzIGlzIHRoZQogICAgICogICAgICBudW1iZXIgb2YgY29ubmVjdGlvbnMgdGhlIHNlcnZlciB3aWxsIGhvbGQgYXQgb25lIHRpbWUuICBUaGlzCiAgICAgKiAgICAgIHNob3VsZCBhbG1vc3QgYWx3YXlzIGJlIHNldCB0byAxICh0aGUgZGVmYXVsdCkuCiAgICAgKiAgICAoSW50ZWdlcikgd2luZCAtIFRoZSBvcHRpb25hbCBIVFRCSU5EIHdpbmRvdyB2YWx1ZS4gIFRoaXMgaXMgdGhlCiAgICAgKiAgICAgIGFsbG93ZWQgcmFuZ2Ugb2YgcmVxdWVzdCBpZHMgdGhhdCBhcmUgdmFsaWQuICBUaGUgZGVmYXVsdCBpcyA1LgogICAgICovCiAgICBfYXR0YWNoOiBmdW5jdGlvbiAoamlkLCBzaWQsIHJpZCwgY2FsbGJhY2ssIHdhaXQsIGhvbGQsIHdpbmQpCiAgICB7CiAgICAgICAgdGhpcy5fY29ubi5qaWQgPSBqaWQ7CiAgICAgICAgdGhpcy5zaWQgPSBzaWQ7CiAgICAgICAgdGhpcy5yaWQgPSByaWQ7CgogICAgICAgIHRoaXMuX2Nvbm4uY29ubmVjdF9jYWxsYmFjayA9IGNhbGxiYWNrOwoKICAgICAgICB0aGlzLl9jb25uLmRvbWFpbiA9IFN0cm9waGUuZ2V0RG9tYWluRnJvbUppZCh0aGlzLl9jb25uLmppZCk7CgogICAgICAgIHRoaXMuX2Nvbm4uYXV0aGVudGljYXRlZCA9IHRydWU7CiAgICAgICAgdGhpcy5fY29ubi5jb25uZWN0ZWQgPSB0cnVlOwoKICAgICAgICB0aGlzLndhaXQgPSB3YWl0IHx8IHRoaXMud2FpdDsKICAgICAgICB0aGlzLmhvbGQgPSBob2xkIHx8IHRoaXMuaG9sZDsKICAgICAgICB0aGlzLndpbmRvdyA9IHdpbmQgfHwgdGhpcy53aW5kb3c7CgogICAgICAgIHRoaXMuX2Nvbm4uX2NoYW5nZUNvbm5lY3RTdGF0dXMoU3Ryb3BoZS5TdGF0dXMuQVRUQUNIRUQsIG51bGwpOwogICAgfSwKCiAgICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiBfY29ubmVjdF9jYgogICAgICogIF9Qcml2YXRlXyBoYW5kbGVyIGZvciBpbml0aWFsIGNvbm5lY3Rpb24gcmVxdWVzdC4KICAgICAqCiAgICAgKiAgVGhpcyBoYW5kbGVyIGlzIHVzZWQgdG8gcHJvY2VzcyB0aGUgQm9zaC1wYXJ0IG9mIHRoZSBpbml0aWFsIHJlcXVlc3QuCiAgICAgKiAgUGFyYW1ldGVyczoKICAgICAqICAgIChTdHJvcGhlLlJlcXVlc3QpIGJvZHlXcmFwIC0gVGhlIHJlY2VpdmVkIHN0YW56YS4KICAgICAqLwogICAgX2Nvbm5lY3RfY2I6IGZ1bmN0aW9uIChib2R5V3JhcCkKICAgIHsKICAgICAgICB2YXIgdHlwID0gYm9keVdyYXAuZ2V0QXR0cmlidXRlKCJ0eXBlIik7CiAgICAgICAgdmFyIGNvbmQsIGNvbmZsaWN0OwogICAgICAgIGlmICh0eXAgIT09IG51bGwgJiYgdHlwID09ICJ0ZXJtaW5hdGUiKSB7CiAgICAgICAgICAgIC8vIGFuIGVycm9yIG9jY3VycmVkCiAgICAgICAgICAgIFN0cm9waGUuZXJyb3IoIkJPU0gtQ29ubmVjdGlvbiBmYWlsZWQ6ICIgKyBjb25kKTsKICAgICAgICAgICAgY29uZCA9IGJvZHlXcmFwLmdldEF0dHJpYnV0ZSgiY29uZGl0aW9uIik7CiAgICAgICAgICAgIGNvbmZsaWN0ID0gYm9keVdyYXAuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImNvbmZsaWN0Iik7CiAgICAgICAgICAgIGlmIChjb25kICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoY29uZCA9PSAicmVtb3RlLXN0cmVhbS1lcnJvciIgJiYgY29uZmxpY3QubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIGNvbmQgPSAiY29uZmxpY3QiOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5fY29ubi5fY2hhbmdlQ29ubmVjdFN0YXR1cyhTdHJvcGhlLlN0YXR1cy5DT05ORkFJTCwgY29uZCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLl9jb25uLl9jaGFuZ2VDb25uZWN0U3RhdHVzKFN0cm9waGUuU3RhdHVzLkNPTk5GQUlMLCAidW5rbm93biIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuX2Nvbm4uX2RvRGlzY29ubmVjdCgpOwogICAgICAgICAgICByZXR1cm4gU3Ryb3BoZS5TdGF0dXMuQ09OTkZBSUw7CiAgICAgICAgfQoKICAgICAgICAvLyBjaGVjayB0byBtYWtlIHN1cmUgd2UgZG9uJ3Qgb3ZlcndyaXRlIHRoZXNlIGlmIF9jb25uZWN0X2NiIGlzCiAgICAgICAgLy8gY2FsbGVkIG11bHRpcGxlIHRpbWVzIGluIHRoZSBjYXNlIG9mIG1pc3Npbmcgc3RyZWFtOmZlYXR1cmVzCiAgICAgICAgaWYgKCF0aGlzLnNpZCkgewogICAgICAgICAgICB0aGlzLnNpZCA9IGJvZHlXcmFwLmdldEF0dHJpYnV0ZSgic2lkIik7CiAgICAgICAgfQogICAgICAgIHZhciB3aW5kID0gYm9keVdyYXAuZ2V0QXR0cmlidXRlKCdyZXF1ZXN0cycpOwogICAgICAgIGlmICh3aW5kKSB7IHRoaXMud2luZG93ID0gcGFyc2VJbnQod2luZCwgMTApOyB9CiAgICAgICAgdmFyIGhvbGQgPSBib2R5V3JhcC5nZXRBdHRyaWJ1dGUoJ2hvbGQnKTsKICAgICAgICBpZiAoaG9sZCkgeyB0aGlzLmhvbGQgPSBwYXJzZUludChob2xkLCAxMCk7IH0KICAgICAgICB2YXIgd2FpdCA9IGJvZHlXcmFwLmdldEF0dHJpYnV0ZSgnd2FpdCcpOwogICAgICAgIGlmICh3YWl0KSB7IHRoaXMud2FpdCA9IHBhcnNlSW50KHdhaXQsIDEwKTsgfQogICAgfSwKCiAgICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiBfZGlzY29ubmVjdAogICAgICogIF9Qcml2YXRlXyBwYXJ0IG9mIENvbm5lY3Rpb24uZGlzY29ubmVjdCBmb3IgQm9zaAogICAgICoKICAgICAqICBQYXJhbWV0ZXJzOgogICAgICogICAgKFJlcXVlc3QpIHByZXMgLSBUaGlzIHN0YW56YSB3aWxsIGJlIHNlbnQgYmVmb3JlIGRpc2Nvbm5lY3RpbmcuCiAgICAgKi8KICAgIF9kaXNjb25uZWN0OiBmdW5jdGlvbiAocHJlcykKICAgIHsKICAgICAgICB0aGlzLl9zZW5kVGVybWluYXRlKHByZXMpOwogICAgfSwKCiAgICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiBfZG9EaXNjb25uZWN0CiAgICAgKiAgX1ByaXZhdGVfIGZ1bmN0aW9uIHRvIGRpc2Nvbm5lY3QuCiAgICAgKgogICAgICogIFJlc2V0cyB0aGUgU0lEIGFuZCBSSUQuCiAgICAgKi8KICAgIF9kb0Rpc2Nvbm5lY3Q6IGZ1bmN0aW9uICgpCiAgICB7CiAgICAgICAgdGhpcy5zaWQgPSBudWxsOwogICAgICAgIHRoaXMucmlkID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogNDI5NDk2NzI5NSk7CiAgICB9LAoKICAgIC8qKiBQcml2YXRlRnVuY3Rpb246IF9lbXB0eVF1ZXVlCiAgICAgKiBfUHJpdmF0ZV8gZnVuY3Rpb24gdG8gY2hlY2sgaWYgdGhlIFJlcXVlc3QgcXVldWUgaXMgZW1wdHkuCiAgICAgKgogICAgICogIFJldHVybnM6CiAgICAgKiAgICBUcnVlLCBpZiB0aGVyZSBhcmUgbm8gUmVxdWVzdHMgcXVldWVkLCBGYWxzZSBvdGhlcndpc2UuCiAgICAgKi8KICAgIF9lbXB0eVF1ZXVlOiBmdW5jdGlvbiAoKQogICAgewogICAgICAgIHJldHVybiB0aGlzLl9yZXF1ZXN0cy5sZW5ndGggPT09IDA7CiAgICB9LAoKICAgIC8qKiBQcml2YXRlRnVuY3Rpb246IF9oaXRFcnJvcgogICAgICogIF9Qcml2YXRlXyBmdW5jdGlvbiB0byBoYW5kbGUgdGhlIGVycm9yIGNvdW50LgogICAgICoKICAgICAqICBSZXF1ZXN0cyBhcmUgcmVzZW50IGF1dG9tYXRpY2FsbHkgdW50aWwgdGhlaXIgZXJyb3IgY291bnQgcmVhY2hlcwogICAgICogIDUuICBFYWNoIHRpbWUgYW4gZXJyb3IgaXMgZW5jb3VudGVyZWQsIHRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIHRvCiAgICAgKiAgaW5jcmVtZW50IHRoZSBjb3VudCBhbmQgZGlzY29ubmVjdCBpZiB0aGUgY291bnQgaXMgdG9vIGhpZ2guCiAgICAgKgogICAgICogIFBhcmFtZXRlcnM6CiAgICAgKiAgICAoSW50ZWdlcikgcmVxU3RhdHVzIC0gVGhlIHJlcXVlc3Qgc3RhdHVzLgogICAgICovCiAgICBfaGl0RXJyb3I6IGZ1bmN0aW9uIChyZXFTdGF0dXMpCiAgICB7CiAgICAgICAgdGhpcy5lcnJvcnMrKzsKICAgICAgICBTdHJvcGhlLndhcm4oInJlcXVlc3QgZXJyb3JlZCwgc3RhdHVzOiAiICsgcmVxU3RhdHVzICsKICAgICAgICAgICAgICAgICAgICAgIiwgbnVtYmVyIG9mIGVycm9yczogIiArIHRoaXMuZXJyb3JzKTsKICAgICAgICBpZiAodGhpcy5lcnJvcnMgPiA0KSB7CiAgICAgICAgICAgIHRoaXMuX29uRGlzY29ubmVjdFRpbWVvdXQoKTsKICAgICAgICB9CiAgICB9LAoKICAgIC8qKiBQcml2YXRlRnVuY3Rpb246IF9ub19hdXRoX3JlY2VpdmVkCiAgICAgKgogICAgICogQ2FsbGVkIG9uIHN0cmVhbSBzdGFydC9yZXN0YXJ0IHdoZW4gbm8gc3RyZWFtOmZlYXR1cmVzCiAgICAgKiBoYXMgYmVlbiByZWNlaXZlZCBhbmQgc2VuZHMgYSBibGFuayBwb2xsIHJlcXVlc3QuCiAgICAgKi8KICAgIF9ub19hdXRoX3JlY2VpdmVkOiBmdW5jdGlvbiAoX2NhbGxiYWNrKQogICAgewogICAgICAgIGlmIChfY2FsbGJhY2spIHsKICAgICAgICAgICAgX2NhbGxiYWNrID0gX2NhbGxiYWNrLmJpbmQodGhpcy5fY29ubik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgX2NhbGxiYWNrID0gdGhpcy5fY29ubi5fY29ubmVjdF9jYi5iaW5kKHRoaXMuX2Nvbm4pOwogICAgICAgIH0KICAgICAgICB2YXIgYm9keSA9IHRoaXMuX2J1aWxkQm9keSgpOwogICAgICAgIHRoaXMuX3JlcXVlc3RzLnB1c2goCiAgICAgICAgICAgICAgICBuZXcgU3Ryb3BoZS5SZXF1ZXN0KGJvZHkudHJlZSgpLAogICAgICAgICAgICAgICAgICAgIHRoaXMuX29uUmVxdWVzdFN0YXRlQ2hhbmdlLmJpbmQoCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMsIF9jYWxsYmFjay5iaW5kKHRoaXMuX2Nvbm4pKSwKICAgICAgICAgICAgICAgICAgICBib2R5LnRyZWUoKS5nZXRBdHRyaWJ1dGUoInJpZCIpKSk7CiAgICAgICAgdGhpcy5fdGhyb3R0bGVkUmVxdWVzdEhhbmRsZXIoKTsKICAgIH0sCgogICAgLyoqIFByaXZhdGVGdW5jdGlvbjogX29uRGlzY29ubmVjdFRpbWVvdXQKICAgICAqICBfUHJpdmF0ZV8gdGltZW91dCBoYW5kbGVyIGZvciBoYW5kbGluZyBub24tZ3JhY2VmdWwgZGlzY29ubmVjdGlvbi4KICAgICAqCiAgICAgKiAgQ2FuY2VscyBhbGwgcmVtYWluaW5nIFJlcXVlc3RzIGFuZCBjbGVhcnMgdGhlIHF1ZXVlLgogICAgICovCiAgICBfb25EaXNjb25uZWN0VGltZW91dDogZnVuY3Rpb24gKCkKICAgIHsKICAgICAgICB2YXIgcmVxOwogICAgICAgIHdoaWxlICh0aGlzLl9yZXF1ZXN0cy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHJlcSA9IHRoaXMuX3JlcXVlc3RzLnBvcCgpOwogICAgICAgICAgICByZXEuYWJvcnQgPSB0cnVlOwogICAgICAgICAgICByZXEueGhyLmFib3J0KCk7CiAgICAgICAgICAgIC8vIGpzbGludCBjb21wbGFpbnMsIGJ1dCB0aGlzIGlzIGZpbmUuIHNldHRpbmcgdG8gZW1wdHkgZnVuYwogICAgICAgICAgICAvLyBpcyBuZWNlc3NhcnkgZm9yIElFNgogICAgICAgICAgICByZXEueGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uICgpIHt9OyAvLyBqc2hpbnQgaWdub3JlOmxpbmUKICAgICAgICB9CiAgICB9LAoKICAgIC8qKiBQcml2YXRlRnVuY3Rpb246IF9vbklkbGUKICAgICAqICBfUHJpdmF0ZV8gaGFuZGxlciBjYWxsZWQgYnkgU3Ryb3BoZS5Db25uZWN0aW9uLl9vbklkbGUKICAgICAqCiAgICAgKiAgU2VuZHMgYWxsIHF1ZXVlZCBSZXF1ZXN0cyBvciBwb2xscyB3aXRoIGVtcHR5IFJlcXVlc3QgaWYgdGhlcmUgYXJlIG5vbmUuCiAgICAgKi8KICAgIF9vbklkbGU6IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgZGF0YSA9IHRoaXMuX2Nvbm4uX2RhdGE7CgogICAgICAgIC8vIGlmIG5vIHJlcXVlc3RzIGFyZSBpbiBwcm9ncmVzcywgcG9sbAogICAgICAgIGlmICh0aGlzLl9jb25uLmF1dGhlbnRpY2F0ZWQgJiYgdGhpcy5fcmVxdWVzdHMubGVuZ3RoID09PSAwICYmCiAgICAgICAgICAgIGRhdGEubGVuZ3RoID09PSAwICYmICF0aGlzLl9jb25uLmRpc2Nvbm5lY3RpbmcpIHsKICAgICAgICAgICAgU3Ryb3BoZS5pbmZvKCJubyByZXF1ZXN0cyBkdXJpbmcgaWRsZSBjeWNsZSwgc2VuZGluZyAiICsKICAgICAgICAgICAgICAgICAgICAgICAgICJibGFuayByZXF1ZXN0Iik7CiAgICAgICAgICAgIGRhdGEucHVzaChudWxsKTsKICAgICAgICB9CgogICAgICAgIGlmICh0aGlzLl9yZXF1ZXN0cy5sZW5ndGggPCAyICYmIGRhdGEubGVuZ3RoID4gMCAmJgogICAgICAgICAgICAhdGhpcy5fY29ubi5wYXVzZWQpIHsKICAgICAgICAgICAgdmFyIGJvZHkgPSB0aGlzLl9idWlsZEJvZHkoKTsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAoZGF0YVtpXSAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIGlmIChkYXRhW2ldID09PSAicmVzdGFydCIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYm9keS5hdHRycyh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0bzogdGhpcy5fY29ubi5kb21haW4sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAieG1sOmxhbmciOiAiZW4iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgInhtcHA6cmVzdGFydCI6ICJ0cnVlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ4bWxuczp4bXBwIjogU3Ryb3BoZS5OUy5CT1NICiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGJvZHkuY25vZGUoZGF0YVtpXSkudXAoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZGVsZXRlIHRoaXMuX2Nvbm4uX2RhdGE7CiAgICAgICAgICAgIHRoaXMuX2Nvbm4uX2RhdGEgPSBbXTsKICAgICAgICAgICAgdGhpcy5fcmVxdWVzdHMucHVzaCgKICAgICAgICAgICAgICAgIG5ldyBTdHJvcGhlLlJlcXVlc3QoYm9keS50cmVlKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX29uUmVxdWVzdFN0YXRlQ2hhbmdlLmJpbmQoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLCB0aGlzLl9jb25uLl9kYXRhUmVjdi5iaW5kKHRoaXMuX2Nvbm4pKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9keS50cmVlKCkuZ2V0QXR0cmlidXRlKCJyaWQiKSkpOwogICAgICAgICAgICB0aGlzLl9wcm9jZXNzUmVxdWVzdCh0aGlzLl9yZXF1ZXN0cy5sZW5ndGggLSAxKTsKICAgICAgICB9CgogICAgICAgIGlmICh0aGlzLl9yZXF1ZXN0cy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHZhciB0aW1lX2VsYXBzZWQgPSB0aGlzLl9yZXF1ZXN0c1swXS5hZ2UoKTsKICAgICAgICAgICAgaWYgKHRoaXMuX3JlcXVlc3RzWzBdLmRlYWQgIT09IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9yZXF1ZXN0c1swXS50aW1lRGVhZCgpID4KICAgICAgICAgICAgICAgICAgICBNYXRoLmZsb29yKFN0cm9waGUuU0VDT05EQVJZX1RJTUVPVVQgKiB0aGlzLndhaXQpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGhyb3R0bGVkUmVxdWVzdEhhbmRsZXIoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHRpbWVfZWxhcHNlZCA+IE1hdGguZmxvb3IoU3Ryb3BoZS5USU1FT1VUICogdGhpcy53YWl0KSkgewogICAgICAgICAgICAgICAgU3Ryb3BoZS53YXJuKCJSZXF1ZXN0ICIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlcXVlc3RzWzBdLmlkICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiIHRpbWVkIG91dCwgb3ZlciAiICsgTWF0aC5mbG9vcihTdHJvcGhlLlRJTUVPVVQgKiB0aGlzLndhaXQpICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiIHNlY29uZHMgc2luY2UgbGFzdCBhY3Rpdml0eSIpOwogICAgICAgICAgICAgICAgdGhpcy5fdGhyb3R0bGVkUmVxdWVzdEhhbmRsZXIoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0sCgogICAgLyoqIFByaXZhdGVGdW5jdGlvbjogX29uUmVxdWVzdFN0YXRlQ2hhbmdlCiAgICAgKiAgX1ByaXZhdGVfIGhhbmRsZXIgZm9yIFN0cm9waGUuUmVxdWVzdCBzdGF0ZSBjaGFuZ2VzLgogICAgICoKICAgICAqICBUaGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCB3aGVuIHRoZSBYTUxIdHRwUmVxdWVzdCByZWFkeVN0YXRlIGNoYW5nZXMuCiAgICAgKiAgSXQgY29udGFpbnMgYSBsb3Qgb2YgZXJyb3IgaGFuZGxpbmcgbG9naWMgZm9yIHRoZSBtYW55IHdheXMgdGhhdAogICAgICogIHJlcXVlc3RzIGNhbiBmYWlsLCBhbmQgY2FsbHMgdGhlIHJlcXVlc3QgY2FsbGJhY2sgd2hlbiByZXF1ZXN0cwogICAgICogIHN1Y2NlZWQuCiAgICAgKgogICAgICogIFBhcmFtZXRlcnM6CiAgICAgKiAgICAoRnVuY3Rpb24pIGZ1bmMgLSBUaGUgaGFuZGxlciBmb3IgdGhlIHJlcXVlc3QuCiAgICAgKiAgICAoU3Ryb3BoZS5SZXF1ZXN0KSByZXEgLSBUaGUgcmVxdWVzdCB0aGF0IGlzIGNoYW5naW5nIHJlYWR5U3RhdGUuCiAgICAgKi8KICAgIF9vblJlcXVlc3RTdGF0ZUNoYW5nZTogZnVuY3Rpb24gKGZ1bmMsIHJlcSkKICAgIHsKICAgICAgICBTdHJvcGhlLmRlYnVnKCJyZXF1ZXN0IGlkICIgKyByZXEuaWQgKwogICAgICAgICAgICAgICAgICAgICAgIi4iICsgcmVxLnNlbmRzICsgIiBzdGF0ZSBjaGFuZ2VkIHRvICIgKwogICAgICAgICAgICAgICAgICAgICAgcmVxLnhoci5yZWFkeVN0YXRlKTsKCiAgICAgICAgaWYgKHJlcS5hYm9ydCkgewogICAgICAgICAgICByZXEuYWJvcnQgPSBmYWxzZTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gcmVxdWVzdCBjb21wbGV0ZQogICAgICAgIHZhciByZXFTdGF0dXM7CiAgICAgICAgaWYgKHJlcS54aHIucmVhZHlTdGF0ZSA9PSA0KSB7CiAgICAgICAgICAgIHJlcVN0YXR1cyA9IDA7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICByZXFTdGF0dXMgPSByZXEueGhyLnN0YXR1czsKICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgLy8gaWdub3JlIGVycm9ycyBmcm9tIHVuZGVmaW5lZCBzdGF0dXMgYXR0cmlidXRlLiAgd29ya3MKICAgICAgICAgICAgICAgIC8vIGFyb3VuZCBhIGJyb3dzZXIgYnVnCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh0eXBlb2YocmVxU3RhdHVzKSA9PSAidW5kZWZpbmVkIikgewogICAgICAgICAgICAgICAgcmVxU3RhdHVzID0gMDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHRoaXMuZGlzY29ubmVjdGluZykgewogICAgICAgICAgICAgICAgaWYgKHJlcVN0YXR1cyA+PSA0MDApIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9oaXRFcnJvcihyZXFTdGF0dXMpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHJlcUlzMCA9ICh0aGlzLl9yZXF1ZXN0c1swXSA9PSByZXEpOwogICAgICAgICAgICB2YXIgcmVxSXMxID0gKHRoaXMuX3JlcXVlc3RzWzFdID09IHJlcSk7CgogICAgICAgICAgICBpZiAoKHJlcVN0YXR1cyA+IDAgJiYgcmVxU3RhdHVzIDwgNTAwKSB8fCByZXEuc2VuZHMgPiA1KSB7CiAgICAgICAgICAgICAgICAvLyByZW1vdmUgZnJvbSBpbnRlcm5hbCBxdWV1ZQogICAgICAgICAgICAgICAgdGhpcy5fcmVtb3ZlUmVxdWVzdChyZXEpOwogICAgICAgICAgICAgICAgU3Ryb3BoZS5kZWJ1ZygicmVxdWVzdCBpZCAiICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLmlkICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIiBzaG91bGQgbm93IGJlIHJlbW92ZWQiKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gcmVxdWVzdCBzdWNjZWVkZWQKICAgICAgICAgICAgaWYgKHJlcVN0YXR1cyA9PSAyMDApIHsKICAgICAgICAgICAgICAgIC8vIGlmIHJlcXVlc3QgMSBmaW5pc2hlZCwgb3IgcmVxdWVzdCAwIGZpbmlzaGVkIGFuZCByZXF1ZXN0CiAgICAgICAgICAgICAgICAvLyAxIGlzIG92ZXIgU3Ryb3BoZS5TRUNPTkRBUllfVElNRU9VVCBzZWNvbmRzIG9sZCwgd2UgbmVlZCB0bwogICAgICAgICAgICAgICAgLy8gcmVzdGFydCB0aGUgb3RoZXIgLSBib3RoIHdpbGwgYmUgaW4gdGhlIGZpcnN0IHNwb3QsIGFzIHRoZQogICAgICAgICAgICAgICAgLy8gY29tcGxldGVkIHJlcXVlc3QgaGFzIGJlZW4gcmVtb3ZlZCBmcm9tIHRoZSBxdWV1ZSBhbHJlYWR5CiAgICAgICAgICAgICAgICBpZiAocmVxSXMxIHx8CiAgICAgICAgICAgICAgICAgICAgKHJlcUlzMCAmJiB0aGlzLl9yZXF1ZXN0cy5sZW5ndGggPiAwICYmCiAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlcXVlc3RzWzBdLmFnZSgpID4gTWF0aC5mbG9vcihTdHJvcGhlLlNFQ09OREFSWV9USU1FT1VUICogdGhpcy53YWl0KSkpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZXN0YXJ0UmVxdWVzdCgwKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vIGNhbGwgaGFuZGxlcgogICAgICAgICAgICAgICAgU3Ryb3BoZS5kZWJ1ZygicmVxdWVzdCBpZCAiICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLmlkICsgIi4iICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLnNlbmRzICsgIiBnb3QgMjAwIik7CiAgICAgICAgICAgICAgICBmdW5jKHJlcSk7CiAgICAgICAgICAgICAgICB0aGlzLmVycm9ycyA9IDA7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBTdHJvcGhlLmVycm9yKCJyZXF1ZXN0IGlkICIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXEuaWQgKyAiLiIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXEuc2VuZHMgKyAiIGVycm9yICIgKyByZXFTdGF0dXMgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiIGhhcHBlbmVkIik7CiAgICAgICAgICAgICAgICBpZiAocmVxU3RhdHVzID09PSAwIHx8CiAgICAgICAgICAgICAgICAgICAgKHJlcVN0YXR1cyA+PSA0MDAgJiYgcmVxU3RhdHVzIDwgNjAwKSB8fAogICAgICAgICAgICAgICAgICAgIHJlcVN0YXR1cyA+PSAxMjAwMCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX2hpdEVycm9yKHJlcVN0YXR1cyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlcVN0YXR1cyA+PSA0MDAgJiYgcmVxU3RhdHVzIDwgNTAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2Nvbm4uX2NoYW5nZUNvbm5lY3RTdGF0dXMoU3Ryb3BoZS5TdGF0dXMuRElTQ09OTkVDVElORywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBudWxsKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fY29ubi5fZG9EaXNjb25uZWN0KCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoISgocmVxU3RhdHVzID4gMCAmJiByZXFTdGF0dXMgPCA1MDApIHx8CiAgICAgICAgICAgICAgICAgIHJlcS5zZW5kcyA+IDUpKSB7CiAgICAgICAgICAgICAgICB0aGlzLl90aHJvdHRsZWRSZXF1ZXN0SGFuZGxlcigpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSwKCiAgICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiBfcHJvY2Vzc1JlcXVlc3QKICAgICAqICBfUHJpdmF0ZV8gZnVuY3Rpb24gdG8gcHJvY2VzcyBhIHJlcXVlc3QgaW4gdGhlIHF1ZXVlLgogICAgICoKICAgICAqICBUaGlzIGZ1bmN0aW9uIHRha2VzIHJlcXVlc3RzIG9mZiB0aGUgcXVldWUgYW5kIHNlbmRzIHRoZW0gYW5kCiAgICAgKiAgcmVzdGFydHMgZGVhZCByZXF1ZXN0cy4KICAgICAqCiAgICAgKiAgUGFyYW1ldGVyczoKICAgICAqICAgIChJbnRlZ2VyKSBpIC0gVGhlIGluZGV4IG9mIHRoZSByZXF1ZXN0IGluIHRoZSBxdWV1ZS4KICAgICAqLwogICAgX3Byb2Nlc3NSZXF1ZXN0OiBmdW5jdGlvbiAoaSkKICAgIHsKICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgdmFyIHJlcSA9IHRoaXMuX3JlcXVlc3RzW2ldOwogICAgICAgIHZhciByZXFTdGF0dXMgPSAtMTsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKHJlcS54aHIucmVhZHlTdGF0ZSA9PSA0KSB7CiAgICAgICAgICAgICAgICByZXFTdGF0dXMgPSByZXEueGhyLnN0YXR1czsKICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgU3Ryb3BoZS5lcnJvcigiY2F1Z2h0IGFuIGVycm9yIGluIF9yZXF1ZXN0c1siICsgaSArCiAgICAgICAgICAgICAgICAgICAgICAgICAgIl0sIHJlcVN0YXR1czogIiArIHJlcVN0YXR1cyk7CiAgICAgICAgfQoKICAgICAgICBpZiAodHlwZW9mKHJlcVN0YXR1cykgPT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgcmVxU3RhdHVzID0gLTE7CiAgICAgICAgfQoKICAgICAgICAvLyBtYWtlIHN1cmUgd2UgbGltaXQgdGhlIG51bWJlciBvZiByZXRyaWVzCiAgICAgICAgaWYgKHJlcS5zZW5kcyA+IHRoaXMubWF4UmV0cmllcykgewogICAgICAgICAgICB0aGlzLl9vbkRpc2Nvbm5lY3RUaW1lb3V0KCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciB0aW1lX2VsYXBzZWQgPSByZXEuYWdlKCk7CiAgICAgICAgdmFyIHByaW1hcnlUaW1lb3V0ID0gKCFpc05hTih0aW1lX2VsYXBzZWQpICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVfZWxhcHNlZCA+IE1hdGguZmxvb3IoU3Ryb3BoZS5USU1FT1VUICogdGhpcy53YWl0KSk7CiAgICAgICAgdmFyIHNlY29uZGFyeVRpbWVvdXQgPSAocmVxLmRlYWQgIT09IG51bGwgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXEudGltZURlYWQoKSA+IE1hdGguZmxvb3IoU3Ryb3BoZS5TRUNPTkRBUllfVElNRU9VVCAqIHRoaXMud2FpdCkpOwogICAgICAgIHZhciByZXF1ZXN0Q29tcGxldGVkV2l0aFNlcnZlckVycm9yID0gKHJlcS54aHIucmVhZHlTdGF0ZSA9PSA0ICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHJlcVN0YXR1cyA8IDEgfHwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxU3RhdHVzID49IDUwMCkpOwogICAgICAgIGlmIChwcmltYXJ5VGltZW91dCB8fCBzZWNvbmRhcnlUaW1lb3V0IHx8CiAgICAgICAgICAgIHJlcXVlc3RDb21wbGV0ZWRXaXRoU2VydmVyRXJyb3IpIHsKICAgICAgICAgICAgaWYgKHNlY29uZGFyeVRpbWVvdXQpIHsKICAgICAgICAgICAgICAgIFN0cm9waGUuZXJyb3IoIlJlcXVlc3QgIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlcXVlc3RzW2ldLmlkICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIiB0aW1lZCBvdXQgKHNlY29uZGFyeSksIHJlc3RhcnRpbmciKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXEuYWJvcnQgPSB0cnVlOwogICAgICAgICAgICByZXEueGhyLmFib3J0KCk7CiAgICAgICAgICAgIC8vIHNldHRpbmcgdG8gbnVsbCBmYWlscyBvbiBJRTYsIHNvIHNldCB0byBlbXB0eSBmdW5jdGlvbgogICAgICAgICAgICByZXEueGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uICgpIHt9OwogICAgICAgICAgICB0aGlzLl9yZXF1ZXN0c1tpXSA9IG5ldyBTdHJvcGhlLlJlcXVlc3QocmVxLnhtbERhdGEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXEub3JpZ0Z1bmMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXEucmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLnNlbmRzKTsKICAgICAgICAgICAgcmVxID0gdGhpcy5fcmVxdWVzdHNbaV07CiAgICAgICAgfQoKICAgICAgICBpZiAocmVxLnhoci5yZWFkeVN0YXRlID09PSAwKSB7CiAgICAgICAgICAgIFN0cm9waGUuZGVidWcoInJlcXVlc3QgaWQgIiArIHJlcS5pZCArCiAgICAgICAgICAgICAgICAgICAgICAgICAgIi4iICsgcmVxLnNlbmRzICsgIiBwb3N0aW5nIik7CgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgcmVxLnhoci5vcGVuKCJQT1NUIiwgdGhpcy5fY29ubi5zZXJ2aWNlLCB0aGlzLl9jb25uLm9wdGlvbnMuc3luYyA/IGZhbHNlIDogdHJ1ZSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGUyKSB7CiAgICAgICAgICAgICAgICBTdHJvcGhlLmVycm9yKCJYSFIgb3BlbiBmYWlsZWQuIik7CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX2Nvbm4uY29ubmVjdGVkKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY29ubi5fY2hhbmdlQ29ubmVjdFN0YXR1cyhTdHJvcGhlLlN0YXR1cy5DT05ORkFJTCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJiYWQtc2VydmljZSIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5fY29ubi5kaXNjb25uZWN0KCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIEZpcmVzIHRoZSBYSFIgcmVxdWVzdCAtLSBtYXkgYmUgaW52b2tlZCBpbW1lZGlhdGVseQogICAgICAgICAgICAvLyBvciBvbiBhIGdyYWR1YWxseSBleHBhbmRpbmcgcmV0cnkgd2luZG93IGZvciByZWNvbm5lY3RzCiAgICAgICAgICAgIHZhciBzZW5kRnVuYyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJlcS5kYXRlID0gbmV3IERhdGUoKTsKICAgICAgICAgICAgICAgIGlmIChzZWxmLl9jb25uLm9wdGlvbnMuY3VzdG9tSGVhZGVycyl7CiAgICAgICAgICAgICAgICAgICAgdmFyIGhlYWRlcnMgPSBzZWxmLl9jb25uLm9wdGlvbnMuY3VzdG9tSGVhZGVyczsKICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBoZWFkZXIgaW4gaGVhZGVycykgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaGVhZGVycy5oYXNPd25Qcm9wZXJ0eShoZWFkZXIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXEueGhyLnNldFJlcXVlc3RIZWFkZXIoaGVhZGVyLCBoZWFkZXJzW2hlYWRlcl0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmVxLnhoci5zZW5kKHJlcS5kYXRhKTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIC8vIEltcGxlbWVudCBwcm9ncmVzc2l2ZSBiYWNrb2ZmIGZvciByZWNvbm5lY3RzIC0tCiAgICAgICAgICAgIC8vIEZpcnN0IHJldHJ5IChzZW5kID09IDEpIHNob3VsZCBhbHNvIGJlIGluc3RhbnRhbmVvdXMKICAgICAgICAgICAgaWYgKHJlcS5zZW5kcyA+IDEpIHsKICAgICAgICAgICAgICAgIC8vIFVzaW5nIGEgY3ViZSBvZiB0aGUgcmV0cnkgbnVtYmVyIGNyZWF0ZXMgYSBuaWNlbHkKICAgICAgICAgICAgICAgIC8vIGV4cGFuZGluZyByZXRyeSB3aW5kb3cKICAgICAgICAgICAgICAgIHZhciBiYWNrb2ZmID0gTWF0aC5taW4oTWF0aC5mbG9vcihTdHJvcGhlLlRJTUVPVVQgKiB0aGlzLndhaXQpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNYXRoLnBvdyhyZXEuc2VuZHMsIDMpKSAqIDEwMDA7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KHNlbmRGdW5jLCBiYWNrb2ZmKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHNlbmRGdW5jKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJlcS5zZW5kcysrOwoKICAgICAgICAgICAgaWYgKHRoaXMuX2Nvbm4ueG1sT3V0cHV0ICE9PSBTdHJvcGhlLkNvbm5lY3Rpb24ucHJvdG90eXBlLnhtbE91dHB1dCkgewogICAgICAgICAgICAgICAgaWYgKHJlcS54bWxEYXRhLm5vZGVOYW1lID09PSB0aGlzLnN0cmlwICYmIHJlcS54bWxEYXRhLmNoaWxkTm9kZXMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY29ubi54bWxPdXRwdXQocmVxLnhtbERhdGEuY2hpbGROb2Rlc1swXSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX2Nvbm4ueG1sT3V0cHV0KHJlcS54bWxEYXRhKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy5fY29ubi5yYXdPdXRwdXQgIT09IFN0cm9waGUuQ29ubmVjdGlvbi5wcm90b3R5cGUucmF3T3V0cHV0KSB7CiAgICAgICAgICAgICAgICB0aGlzLl9jb25uLnJhd091dHB1dChyZXEuZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBTdHJvcGhlLmRlYnVnKCJfcHJvY2Vzc1JlcXVlc3Q6ICIgKwogICAgICAgICAgICAgICAgICAgICAgICAgIChpID09PSAwID8gImZpcnN0IiA6ICJzZWNvbmQiKSArCiAgICAgICAgICAgICAgICAgICAgICAgICAgIiByZXF1ZXN0IGhhcyByZWFkeVN0YXRlIG9mICIgKwogICAgICAgICAgICAgICAgICAgICAgICAgIHJlcS54aHIucmVhZHlTdGF0ZSk7CiAgICAgICAgfQogICAgfSwKCiAgICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiBfcmVtb3ZlUmVxdWVzdAogICAgICogIF9Qcml2YXRlXyBmdW5jdGlvbiB0byByZW1vdmUgYSByZXF1ZXN0IGZyb20gdGhlIHF1ZXVlLgogICAgICoKICAgICAqICBQYXJhbWV0ZXJzOgogICAgICogICAgKFN0cm9waGUuUmVxdWVzdCkgcmVxIC0gVGhlIHJlcXVlc3QgdG8gcmVtb3ZlLgogICAgICovCiAgICBfcmVtb3ZlUmVxdWVzdDogZnVuY3Rpb24gKHJlcSkKICAgIHsKICAgICAgICBTdHJvcGhlLmRlYnVnKCJyZW1vdmluZyByZXF1ZXN0Iik7CgogICAgICAgIHZhciBpOwogICAgICAgIGZvciAoaSA9IHRoaXMuX3JlcXVlc3RzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgICAgIGlmIChyZXEgPT0gdGhpcy5fcmVxdWVzdHNbaV0pIHsKICAgICAgICAgICAgICAgIHRoaXMuX3JlcXVlc3RzLnNwbGljZShpLCAxKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gSUU2IGZhaWxzIG9uIHNldHRpbmcgdG8gbnVsbCwgc28gc2V0IHRvIGVtcHR5IGZ1bmN0aW9uCiAgICAgICAgcmVxLnhoci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbiAoKSB7fTsKCiAgICAgICAgdGhpcy5fdGhyb3R0bGVkUmVxdWVzdEhhbmRsZXIoKTsKICAgIH0sCgogICAgLyoqIFByaXZhdGVGdW5jdGlvbjogX3Jlc3RhcnRSZXF1ZXN0CiAgICAgKiAgX1ByaXZhdGVfIGZ1bmN0aW9uIHRvIHJlc3RhcnQgYSByZXF1ZXN0IHRoYXQgaXMgcHJlc3VtZWQgZGVhZC4KICAgICAqCiAgICAgKiAgUGFyYW1ldGVyczoKICAgICAqICAgIChJbnRlZ2VyKSBpIC0gVGhlIGluZGV4IG9mIHRoZSByZXF1ZXN0IGluIHRoZSBxdWV1ZS4KICAgICAqLwogICAgX3Jlc3RhcnRSZXF1ZXN0OiBmdW5jdGlvbiAoaSkKICAgIHsKICAgICAgICB2YXIgcmVxID0gdGhpcy5fcmVxdWVzdHNbaV07CiAgICAgICAgaWYgKHJlcS5kZWFkID09PSBudWxsKSB7CiAgICAgICAgICAgIHJlcS5kZWFkID0gbmV3IERhdGUoKTsKICAgICAgICB9CgogICAgICAgIHRoaXMuX3Byb2Nlc3NSZXF1ZXN0KGkpOwogICAgfSwKCiAgICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiBfcmVxVG9EYXRhCiAgICAgKiBfUHJpdmF0ZV8gZnVuY3Rpb24gdG8gZ2V0IGEgc3RhbnphIG91dCBvZiBhIHJlcXVlc3QuCiAgICAgKgogICAgICogVHJpZXMgdG8gZXh0cmFjdCBhIHN0YW56YSBvdXQgb2YgYSBSZXF1ZXN0IE9iamVjdC4KICAgICAqIFdoZW4gdGhpcyBmYWlscyB0aGUgY3VycmVudCBjb25uZWN0aW9uIHdpbGwgYmUgZGlzY29ubmVjdGVkLgogICAgICoKICAgICAqICBQYXJhbWV0ZXJzOgogICAgICogICAgKE9iamVjdCkgcmVxIC0gVGhlIFJlcXVlc3QuCiAgICAgKgogICAgICogIFJldHVybnM6CiAgICAgKiAgICBUaGUgc3RhbnphIHRoYXQgd2FzIHBhc3NlZC4KICAgICAqLwogICAgX3JlcVRvRGF0YTogZnVuY3Rpb24gKHJlcSkKICAgIHsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1cm4gcmVxLmdldFJlc3BvbnNlKCk7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICBpZiAoZSAhPSAicGFyc2VyZXJyb3IiKSB7IHRocm93IGU7IH0KICAgICAgICAgICAgdGhpcy5fY29ubi5kaXNjb25uZWN0KCJzdHJvcGhlLXBhcnNlcmVycm9yIik7CiAgICAgICAgfQogICAgfSwKCiAgICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiBfc2VuZFRlcm1pbmF0ZQogICAgICogIF9Qcml2YXRlXyBmdW5jdGlvbiB0byBzZW5kIGluaXRpYWwgZGlzY29ubmVjdCBzZXF1ZW5jZS4KICAgICAqCiAgICAgKiAgVGhpcyBpcyB0aGUgZmlyc3Qgc3RlcCBpbiBhIGdyYWNlZnVsIGRpc2Nvbm5lY3QuICBJdCBzZW5kcwogICAgICogIHRoZSBCT1NIIHNlcnZlciBhIHRlcm1pbmF0ZSBib2R5IGFuZCBpbmNsdWRlcyBhbiB1bmF2YWlsYWJsZQogICAgICogIHByZXNlbmNlIGlmIGF1dGhlbnRpY2F0aW9uIGhhcyBjb21wbGV0ZWQuCiAgICAgKi8KICAgIF9zZW5kVGVybWluYXRlOiBmdW5jdGlvbiAocHJlcykKICAgIHsKICAgICAgICBTdHJvcGhlLmluZm8oIl9zZW5kVGVybWluYXRlIHdhcyBjYWxsZWQiKTsKICAgICAgICB2YXIgYm9keSA9IHRoaXMuX2J1aWxkQm9keSgpLmF0dHJzKHt0eXBlOiAidGVybWluYXRlIn0pOwoKICAgICAgICBpZiAocHJlcykgewogICAgICAgICAgICBib2R5LmNub2RlKHByZXMudHJlZSgpKTsKICAgICAgICB9CgogICAgICAgIHZhciByZXEgPSBuZXcgU3Ryb3BoZS5SZXF1ZXN0KGJvZHkudHJlZSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX29uUmVxdWVzdFN0YXRlQ2hhbmdlLmJpbmQoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMsIHRoaXMuX2Nvbm4uX2RhdGFSZWN2LmJpbmQodGhpcy5fY29ubikpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvZHkudHJlZSgpLmdldEF0dHJpYnV0ZSgicmlkIikpOwoKICAgICAgICB0aGlzLl9yZXF1ZXN0cy5wdXNoKHJlcSk7CiAgICAgICAgdGhpcy5fdGhyb3R0bGVkUmVxdWVzdEhhbmRsZXIoKTsKICAgIH0sCgogICAgLyoqIFByaXZhdGVGdW5jdGlvbjogX3NlbmQKICAgICAqICBfUHJpdmF0ZV8gcGFydCBvZiB0aGUgQ29ubmVjdGlvbi5zZW5kIGZ1bmN0aW9uIGZvciBCT1NICiAgICAgKgogICAgICogSnVzdCB0cmlnZ2VycyB0aGUgUmVxdWVzdEhhbmRsZXIgdG8gc2VuZCB0aGUgbWVzc2FnZXMgdGhhdCBhcmUgaW4gdGhlIHF1ZXVlCiAgICAgKi8KICAgIF9zZW5kOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuX2Nvbm4uX2lkbGVUaW1lb3V0KTsKICAgICAgICB0aGlzLl90aHJvdHRsZWRSZXF1ZXN0SGFuZGxlcigpOwogICAgICAgIHRoaXMuX2Nvbm4uX2lkbGVUaW1lb3V0ID0gc2V0VGltZW91dCh0aGlzLl9jb25uLl9vbklkbGUuYmluZCh0aGlzLl9jb25uKSwgMTAwKTsKICAgIH0sCgogICAgLyoqIFByaXZhdGVGdW5jdGlvbjogX3NlbmRSZXN0YXJ0CiAgICAgKgogICAgICogIFNlbmQgYW4geG1wcDpyZXN0YXJ0IHN0YW56YS4KICAgICAqLwogICAgX3NlbmRSZXN0YXJ0OiBmdW5jdGlvbiAoKQogICAgewogICAgICAgIHRoaXMuX3Rocm90dGxlZFJlcXVlc3RIYW5kbGVyKCk7CiAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuX2Nvbm4uX2lkbGVUaW1lb3V0KTsKICAgIH0sCgogICAgLyoqIFByaXZhdGVGdW5jdGlvbjogX3Rocm90dGxlZFJlcXVlc3RIYW5kbGVyCiAgICAgKiAgX1ByaXZhdGVfIGZ1bmN0aW9uIHRvIHRocm90dGxlIHJlcXVlc3RzIHRvIHRoZSBjb25uZWN0aW9uIHdpbmRvdy4KICAgICAqCiAgICAgKiAgVGhpcyBmdW5jdGlvbiBtYWtlcyBzdXJlIHdlIGRvbid0IHNlbmQgcmVxdWVzdHMgc28gZmFzdCB0aGF0IHRoZQogICAgICogIHJlcXVlc3QgaWRzIG92ZXJmbG93IHRoZSBjb25uZWN0aW9uIHdpbmRvdyBpbiB0aGUgY2FzZSB0aGF0IG9uZQogICAgICogIHJlcXVlc3QgZGllZC4KICAgICAqLwogICAgX3Rocm90dGxlZFJlcXVlc3RIYW5kbGVyOiBmdW5jdGlvbiAoKQogICAgewogICAgICAgIGlmICghdGhpcy5fcmVxdWVzdHMpIHsKICAgICAgICAgICAgU3Ryb3BoZS5kZWJ1ZygiX3Rocm90dGxlZFJlcXVlc3RIYW5kbGVyIGNhbGxlZCB3aXRoICIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICJ1bmRlZmluZWQgcmVxdWVzdHMiKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBTdHJvcGhlLmRlYnVnKCJfdGhyb3R0bGVkUmVxdWVzdEhhbmRsZXIgY2FsbGVkIHdpdGggIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVxdWVzdHMubGVuZ3RoICsgIiByZXF1ZXN0cyIpOwogICAgICAgIH0KCiAgICAgICAgaWYgKCF0aGlzLl9yZXF1ZXN0cyB8fCB0aGlzLl9yZXF1ZXN0cy5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRoaXMuX3JlcXVlc3RzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgdGhpcy5fcHJvY2Vzc1JlcXVlc3QoMCk7CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5fcmVxdWVzdHMubGVuZ3RoID4gMSAmJgogICAgICAgICAgICBNYXRoLmFicyh0aGlzLl9yZXF1ZXN0c1swXS5yaWQgLQogICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZXF1ZXN0c1sxXS5yaWQpIDwgdGhpcy53aW5kb3cpIHsKICAgICAgICAgICAgdGhpcy5fcHJvY2Vzc1JlcXVlc3QoMSk7CiAgICAgICAgfQogICAgfQp9OwoKLyoKICAgIFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIE1JVCBsaWNlbnNlLgogICAgUGxlYXNlIHNlZSB0aGUgTElDRU5TRSBmaWxlIGZvciBkZXRhaWxzLgoKICAgIENvcHlyaWdodCAyMDA2LTIwMDgsIE9HRywgTExDCiovCgovKiBqc2hpbnQgdW5kZWY6IHRydWUsIHVudXNlZDogdHJ1ZTosIG5vYXJnOiB0cnVlLCBsYXRlZGVmOiB0cnVlICovCi8qZ2xvYmFsIGRvY3VtZW50LCB3aW5kb3csIGNsZWFyVGltZW91dCwgV2ViU29ja2V0LAogICAgRE9NUGFyc2VyLCBTdHJvcGhlLCAkYnVpbGQgKi8KCi8qKiBDbGFzczogU3Ryb3BoZS5XZWJTb2NrZXQKICogIF9Qcml2YXRlXyBoZWxwZXIgY2xhc3MgdGhhdCBoYW5kbGVzIFdlYlNvY2tldCBDb25uZWN0aW9ucwogKgogKiAgVGhlIFN0cm9waGUuV2ViU29ja2V0IGNsYXNzIGlzIHVzZWQgaW50ZXJuYWxseSBieSBTdHJvcGhlLkNvbm5lY3Rpb24KICogIHRvIGVuY2Fwc3VsYXRlIFdlYlNvY2tldCBzZXNzaW9ucy4gSXQgaXMgbm90IG1lYW50IHRvIGJlIHVzZWQgZnJvbSB1c2VyJ3MgY29kZS4KICovCgovKiogRmlsZTogd2Vic29ja2V0LmpzCiAqICBBIEphdmFTY3JpcHQgbGlicmFyeSB0byBlbmFibGUgWE1QUCBvdmVyIFdlYnNvY2tldCBpbiBTdHJvcGhlanMuCiAqCiAqICBUaGlzIGZpbGUgaW1wbGVtZW50cyBYTVBQIG92ZXIgV2ViU29ja2V0cyBmb3IgU3Ryb3BoZWpzLgogKiAgSWYgYSBDb25uZWN0aW9uIGlzIGVzdGFibGlzaGVkIHdpdGggYSBXZWJzb2NrZXQgdXJsICh3czovLy4uLikKICogIFN0cm9waGUgd2lsbCB1c2UgV2ViU29ja2V0cy4KICogIEZvciBtb3JlIGluZm9ybWF0aW9uIG9uIFhNUFAtb3ZlciBXZWJTb2NrZXQgc2VlIHRoaXMgUkZDIGRyYWZ0OgogKiAgaHR0cDovL3Rvb2xzLmlldGYub3JnL2h0bWwvZHJhZnQtaWV0Zi14bXBwLXdlYnNvY2tldC0wMAogKgogKiAgV2ViU29ja2V0IHN1cHBvcnQgaW1wbGVtZW50ZWQgYnkgQW5kcmVhcyBHdXRoIChhbmRyZWFzLmd1dGhAcnd0aC1hYWNoZW4uZGUpCiAqLwoKLyoqIFByaXZhdGVDb25zdHJ1Y3RvcjogU3Ryb3BoZS5XZWJzb2NrZXQKICogIENyZWF0ZSBhbmQgaW5pdGlhbGl6ZSBhIFN0cm9waGUuV2ViU29ja2V0IG9iamVjdC4KICogIEN1cnJlbnRseSBvbmx5IHNldHMgdGhlIGNvbm5lY3Rpb24gT2JqZWN0LgogKgogKiAgUGFyYW1ldGVyczoKICogICAgKFN0cm9waGUuQ29ubmVjdGlvbikgY29ubmVjdGlvbiAtIFRoZSBTdHJvcGhlLkNvbm5lY3Rpb24gdGhhdCB3aWxsIHVzZSBXZWJTb2NrZXRzLgogKgogKiAgUmV0dXJuczoKICogICAgQSBuZXcgU3Ryb3BoZS5XZWJTb2NrZXQgb2JqZWN0LgogKi8KU3Ryb3BoZS5XZWJzb2NrZXQgPSBmdW5jdGlvbihjb25uZWN0aW9uKSB7CiAgICB0aGlzLl9jb25uID0gY29ubmVjdGlvbjsKICAgIHRoaXMuc3RyaXAgPSAic3RyZWFtOnN0cmVhbSI7CgogICAgdmFyIHNlcnZpY2UgPSBjb25uZWN0aW9uLnNlcnZpY2U7CiAgICBpZiAoc2VydmljZS5pbmRleE9mKCJ3czoiKSAhPT0gMCAmJiBzZXJ2aWNlLmluZGV4T2YoIndzczoiKSAhPT0gMCkgewogICAgICAgIC8vIElmIHRoZSBzZXJ2aWNlIGlzIG5vdCBhbiBhYnNvbHV0ZSBVUkwsIGFzc3VtZSBpdCBpcyBhIHBhdGggYW5kIHB1dCB0aGUgYWJzb2x1dGUKICAgICAgICAvLyBVUkwgdG9nZXRoZXIgZnJvbSBvcHRpb25zLCBjdXJyZW50IFVSTCBhbmQgdGhlIHBhdGguCiAgICAgICAgdmFyIG5ld19zZXJ2aWNlID0gIiI7CgogICAgICAgIGlmIChjb25uZWN0aW9uLm9wdGlvbnMucHJvdG9jb2wgPT09ICJ3cyIgJiYgd2luZG93LmxvY2F0aW9uLnByb3RvY29sICE9PSAiaHR0cHM6IikgewogICAgICAgICAgICBuZXdfc2VydmljZSArPSAid3MiOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG5ld19zZXJ2aWNlICs9ICJ3c3MiOwogICAgICAgIH0KCiAgICAgICAgbmV3X3NlcnZpY2UgKz0gIjovLyIgKyB3aW5kb3cubG9jYXRpb24uaG9zdDsKCiAgICAgICAgaWYgKHNlcnZpY2UuaW5kZXhPZigiLyIpICE9PSAwKSB7CiAgICAgICAgICAgIG5ld19zZXJ2aWNlICs9IHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSArIHNlcnZpY2U7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbmV3X3NlcnZpY2UgKz0gc2VydmljZTsKICAgICAgICB9CgogICAgICAgIGNvbm5lY3Rpb24uc2VydmljZSA9IG5ld19zZXJ2aWNlOwogICAgfQp9OwoKU3Ryb3BoZS5XZWJzb2NrZXQucHJvdG90eXBlID0gewogICAgLyoqIFByaXZhdGVGdW5jdGlvbjogX2J1aWxkU3RyZWFtCiAgICAgKiAgX1ByaXZhdGVfIGhlbHBlciBmdW5jdGlvbiB0byBnZW5lcmF0ZSB0aGUgPHN0cmVhbT4gc3RhcnQgdGFnIGZvciBXZWJTb2NrZXRzCiAgICAgKgogICAgICogIFJldHVybnM6CiAgICAgKiAgICBBIFN0cm9waGUuQnVpbGRlciB3aXRoIGEgPHN0cmVhbT4gZWxlbWVudC4KICAgICAqLwogICAgX2J1aWxkU3RyZWFtOiBmdW5jdGlvbiAoKQogICAgewogICAgICAgIHJldHVybiAkYnVpbGQoInN0cmVhbTpzdHJlYW0iLCB7CiAgICAgICAgICAgICJ0byI6IHRoaXMuX2Nvbm4uZG9tYWluLAogICAgICAgICAgICAieG1sbnMiOiBTdHJvcGhlLk5TLkNMSUVOVCwKICAgICAgICAgICAgInhtbG5zOnN0cmVhbSI6IFN0cm9waGUuTlMuU1RSRUFNLAogICAgICAgICAgICAidmVyc2lvbiI6ICcxLjAnCiAgICAgICAgfSk7CiAgICB9LAoKICAgIC8qKiBQcml2YXRlRnVuY3Rpb246IF9jaGVja19zdHJlYW1lcnJvcgogICAgICogX1ByaXZhdGVfIGNoZWNrcyBhIG1lc3NhZ2UgZm9yIHN0cmVhbTplcnJvcgogICAgICoKICAgICAqICBQYXJhbWV0ZXJzOgogICAgICogICAgKFN0cm9waGUuUmVxdWVzdCkgYm9keVdyYXAgLSBUaGUgcmVjZWl2ZWQgc3RhbnphLgogICAgICogICAgY29ubmVjdHN0YXR1cyAtIFRoZSBDb25uZWN0U3RhdHVzIHRoYXQgd2lsbCBiZSBzZXQgb24gZXJyb3IuCiAgICAgKiAgUmV0dXJuczoKICAgICAqICAgICB0cnVlIGlmIHRoZXJlIHdhcyBhIHN0cmVhbWVycm9yLCBmYWxzZSBvdGhlcndpc2UuCiAgICAgKi8KICAgIF9jaGVja19zdHJlYW1lcnJvcjogZnVuY3Rpb24gKGJvZHlXcmFwLCBjb25uZWN0c3RhdHVzKSB7CiAgICAgICAgdmFyIGVycm9ycyA9IGJvZHlXcmFwLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJzdHJlYW06ZXJyb3IiKTsKICAgICAgICBpZiAoZXJyb3JzLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHZhciBlcnJvciA9IGVycm9yc1swXTsKCiAgICAgICAgdmFyIGNvbmRpdGlvbiA9ICIiOwogICAgICAgIHZhciB0ZXh0ID0gIiI7CgogICAgICAgIHZhciBucyA9ICJ1cm46aWV0ZjpwYXJhbXM6eG1sOm5zOnhtcHAtc3RyZWFtcyI7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlcnJvci5jaGlsZE5vZGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHZhciBlID0gZXJyb3IuY2hpbGROb2Rlc1tpXTsKICAgICAgICAgICAgaWYgKGUuZ2V0QXR0cmlidXRlKCJ4bWxucyIpICE9PSBucykgewogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0gaWYgKGUubm9kZU5hbWUgPT09ICJ0ZXh0IikgewogICAgICAgICAgICAgICAgdGV4dCA9IGUudGV4dENvbnRlbnQ7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjb25kaXRpb24gPSBlLm5vZGVOYW1lOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB2YXIgZXJyb3JTdHJpbmcgPSAiV2ViU29ja2V0IHN0cmVhbSBlcnJvcjogIjsKCiAgICAgICAgaWYgKGNvbmRpdGlvbikgewogICAgICAgICAgICBlcnJvclN0cmluZyArPSBjb25kaXRpb247CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZXJyb3JTdHJpbmcgKz0gInVua25vd24iOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRleHQpIHsKICAgICAgICAgICAgZXJyb3JTdHJpbmcgKz0gIiAtICIgKyBjb25kaXRpb247CiAgICAgICAgfQoKICAgICAgICBTdHJvcGhlLmVycm9yKGVycm9yU3RyaW5nKTsKCiAgICAgICAgLy8gY2xvc2UgdGhlIGNvbm5lY3Rpb24gb24gc3RyZWFtX2Vycm9yCiAgICAgICAgdGhpcy5fY29ubi5fY2hhbmdlQ29ubmVjdFN0YXR1cyhjb25uZWN0c3RhdHVzLCBjb25kaXRpb24pOwogICAgICAgIHRoaXMuX2Nvbm4uX2RvRGlzY29ubmVjdCgpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfSwKCiAgICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiBfcmVzZXQKICAgICAqICBSZXNldCB0aGUgY29ubmVjdGlvbi4KICAgICAqCiAgICAgKiAgVGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgYnkgdGhlIHJlc2V0IGZ1bmN0aW9uIG9mIHRoZSBTdHJvcGhlIENvbm5lY3Rpb24uCiAgICAgKiAgSXMgbm90IG5lZWRlZCBieSBXZWJTb2NrZXRzLgogICAgICovCiAgICBfcmVzZXQ6IGZ1bmN0aW9uICgpCiAgICB7CiAgICAgICAgcmV0dXJuOwogICAgfSwKCiAgICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiBfY29ubmVjdAogICAgICogIF9Qcml2YXRlXyBmdW5jdGlvbiBjYWxsZWQgYnkgU3Ryb3BoZS5Db25uZWN0aW9uLmNvbm5lY3QKICAgICAqCiAgICAgKiAgQ3JlYXRlcyBhIFdlYlNvY2tldCBmb3IgYSBjb25uZWN0aW9uIGFuZCBhc3NpZ25zIENhbGxiYWNrcyB0byBpdC4KICAgICAqICBEb2VzIG5vdGhpbmcgaWYgdGhlcmUgYWxyZWFkeSBpcyBhIFdlYlNvY2tldC4KICAgICAqLwogICAgX2Nvbm5lY3Q6IGZ1bmN0aW9uICgpIHsKICAgICAgICAvLyBFbnN1cmUgdGhhdCB0aGVyZSBpcyBubyBvcGVuIFdlYlNvY2tldCBmcm9tIGEgcHJldmlvdXMgQ29ubmVjdGlvbi4KICAgICAgICB0aGlzLl9jbG9zZVNvY2tldCgpOwoKICAgICAgICAvLyBDcmVhdGUgdGhlIG5ldyBXb2JTb2NrZXQKICAgICAgICB0aGlzLnNvY2tldCA9IG5ldyBXZWJTb2NrZXQodGhpcy5fY29ubi5zZXJ2aWNlLCAieG1wcCIpOwogICAgICAgIHRoaXMuc29ja2V0Lm9ub3BlbiA9IHRoaXMuX29uT3Blbi5iaW5kKHRoaXMpOwogICAgICAgIHRoaXMuc29ja2V0Lm9uZXJyb3IgPSB0aGlzLl9vbkVycm9yLmJpbmQodGhpcyk7CiAgICAgICAgdGhpcy5zb2NrZXQub25jbG9zZSA9IHRoaXMuX29uQ2xvc2UuYmluZCh0aGlzKTsKICAgICAgICB0aGlzLnNvY2tldC5vbm1lc3NhZ2UgPSB0aGlzLl9jb25uZWN0X2NiX3dyYXBwZXIuYmluZCh0aGlzKTsKICAgIH0sCgogICAgLyoqIFByaXZhdGVGdW5jdGlvbjogX2Nvbm5lY3RfY2IKICAgICAqICBfUHJpdmF0ZV8gZnVuY3Rpb24gY2FsbGVkIGJ5IFN0cm9waGUuQ29ubmVjdGlvbi5fY29ubmVjdF9jYgogICAgICoKICAgICAqIGNoZWNrcyBmb3Igc3RyZWFtOmVycm9yCiAgICAgKgogICAgICogIFBhcmFtZXRlcnM6CiAgICAgKiAgICAoU3Ryb3BoZS5SZXF1ZXN0KSBib2R5V3JhcCAtIFRoZSByZWNlaXZlZCBzdGFuemEuCiAgICAgKi8KICAgIF9jb25uZWN0X2NiOiBmdW5jdGlvbihib2R5V3JhcCkgewogICAgICAgIHZhciBlcnJvciA9IHRoaXMuX2NoZWNrX3N0cmVhbWVycm9yKGJvZHlXcmFwLCBTdHJvcGhlLlN0YXR1cy5DT05ORkFJTCk7CiAgICAgICAgaWYgKGVycm9yKSB7CiAgICAgICAgICAgIHJldHVybiBTdHJvcGhlLlN0YXR1cy5DT05ORkFJTDsKICAgICAgICB9CiAgICB9LAoKICAgIC8qKiBQcml2YXRlRnVuY3Rpb246IF9oYW5kbGVTdHJlYW1TdGFydAogICAgICogX1ByaXZhdGVfIGZ1bmN0aW9uIHRoYXQgY2hlY2tzIHRoZSBvcGVuaW5nIHN0cmVhbTpzdHJlYW0gdGFnIGZvciBlcnJvcnMuCiAgICAgKgogICAgICogRGlzY29ubmVjdHMgaWYgdGhlcmUgaXMgYW4gZXJyb3IgYW5kIHJldHVybnMgZmFsc2UsIHRydWUgb3RoZXJ3aXNlLgogICAgICoKICAgICAqICBQYXJhbWV0ZXJzOgogICAgICogICAgKE5vZGUpIG1lc3NhZ2UgLSBTdGFuemEgY29udGFpbmluZyB0aGUgc3RyZWFtOnN0cmVhbS4KICAgICAqLwogICAgX2hhbmRsZVN0cmVhbVN0YXJ0OiBmdW5jdGlvbihtZXNzYWdlKSB7CiAgICAgICAgdmFyIGVycm9yID0gZmFsc2U7CiAgICAgICAgLy8gQ2hlY2sgZm9yIGVycm9ycyBpbiB0aGUgc3RyZWFtOnN0cmVhbSB0YWcKICAgICAgICB2YXIgbnMgPSBtZXNzYWdlLmdldEF0dHJpYnV0ZSgieG1sbnMiKTsKICAgICAgICBpZiAodHlwZW9mIG5zICE9PSAic3RyaW5nIikgewogICAgICAgICAgICBlcnJvciA9ICJNaXNzaW5nIHhtbG5zIGluIHN0cmVhbTpzdHJlYW0iOwogICAgICAgIH0gZWxzZSBpZiAobnMgIT09IFN0cm9waGUuTlMuQ0xJRU5UKSB7CiAgICAgICAgICAgIGVycm9yID0gIldyb25nIHhtbG5zIGluIHN0cmVhbTpzdHJlYW06ICIgKyBuczsKICAgICAgICB9CgogICAgICAgIHZhciBuc19zdHJlYW0gPSBtZXNzYWdlLm5hbWVzcGFjZVVSSTsKICAgICAgICBpZiAodHlwZW9mIG5zX3N0cmVhbSAhPT0gInN0cmluZyIpIHsKICAgICAgICAgICAgZXJyb3IgPSAiTWlzc2luZyB4bWxuczpzdHJlYW0gaW4gc3RyZWFtOnN0cmVhbSI7CiAgICAgICAgfSBlbHNlIGlmIChuc19zdHJlYW0gIT09IFN0cm9waGUuTlMuU1RSRUFNKSB7CiAgICAgICAgICAgIGVycm9yID0gIldyb25nIHhtbG5zOnN0cmVhbSBpbiBzdHJlYW06c3RyZWFtOiAiICsgbnNfc3RyZWFtOwogICAgICAgIH0KCiAgICAgICAgdmFyIHZlciA9IG1lc3NhZ2UuZ2V0QXR0cmlidXRlKCJ2ZXJzaW9uIik7CiAgICAgICAgaWYgKHR5cGVvZiB2ZXIgIT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgIGVycm9yID0gIk1pc3NpbmcgdmVyc2lvbiBpbiBzdHJlYW06c3RyZWFtIjsKICAgICAgICB9IGVsc2UgaWYgKHZlciAhPT0gIjEuMCIpIHsKICAgICAgICAgICAgZXJyb3IgPSAiV3JvbmcgdmVyc2lvbiBpbiBzdHJlYW06c3RyZWFtOiAiICsgdmVyOwogICAgICAgIH0KCiAgICAgICAgaWYgKGVycm9yKSB7CiAgICAgICAgICAgIHRoaXMuX2Nvbm4uX2NoYW5nZUNvbm5lY3RTdGF0dXMoU3Ryb3BoZS5TdGF0dXMuQ09OTkZBSUwsIGVycm9yKTsKICAgICAgICAgICAgdGhpcy5fY29ubi5fZG9EaXNjb25uZWN0KCk7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0cnVlOwogICAgfSwKCiAgICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiBfY29ubmVjdF9jYl93cmFwcGVyCiAgICAgKiBfUHJpdmF0ZV8gZnVuY3Rpb24gdGhhdCBoYW5kbGVzIHRoZSBmaXJzdCBjb25uZWN0aW9uIG1lc3NhZ2VzLgogICAgICoKICAgICAqIE9uIHJlY2VpdmluZyBhbiBvcGVuaW5nIHN0cmVhbSB0YWcgdGhpcyBjYWxsYmFjayByZXBsYWNlcyBpdHNlbGYgd2l0aCB0aGUgcmVhbAogICAgICogbWVzc2FnZSBoYW5kbGVyLiBPbiByZWNlaXZpbmcgYSBzdHJlYW0gZXJyb3IgdGhlIGNvbm5lY3Rpb24gaXMgdGVybWluYXRlZC4KICAgICAqLwogICAgX2Nvbm5lY3RfY2Jfd3JhcHBlcjogZnVuY3Rpb24obWVzc2FnZSkgewogICAgICAgIGlmIChtZXNzYWdlLmRhdGEuaW5kZXhPZigiPHN0cmVhbTpzdHJlYW0gIikgPT09IDAgfHwgbWVzc2FnZS5kYXRhLmluZGV4T2YoIjw/eG1sIikgPT09IDApIHsKICAgICAgICAgICAgLy8gU3RyaXAgdGhlIFhNTCBEZWNsYXJhdGlvbiwgaWYgdGhlcmUgaXMgb25lCiAgICAgICAgICAgIHZhciBkYXRhID0gbWVzc2FnZS5kYXRhLnJlcGxhY2UoL14oPFw/Lio/XD8+XHMqKSovLCAiIik7CiAgICAgICAgICAgIGlmIChkYXRhID09PSAnJykgcmV0dXJuOwoKICAgICAgICAgICAgLy9NYWtlIHRoZSBpbml0aWFsIHN0cmVhbTpzdHJlYW0gc2VsZmNsb3NpbmcgdG8gcGFyc2UgaXQgd2l0aG91dCBhIFNBWCBwYXJzZXIuCiAgICAgICAgICAgIGRhdGEgPSBtZXNzYWdlLmRhdGEucmVwbGFjZSgvPHN0cmVhbTpzdHJlYW0gKC4qW15cL10pPi8sICI8c3RyZWFtOnN0cmVhbSAkMS8+Iik7CgogICAgICAgICAgICB2YXIgc3RyZWFtU3RhcnQgPSBuZXcgRE9NUGFyc2VyKCkucGFyc2VGcm9tU3RyaW5nKGRhdGEsICJ0ZXh0L3htbCIpLmRvY3VtZW50RWxlbWVudDsKICAgICAgICAgICAgdGhpcy5fY29ubi54bWxJbnB1dChzdHJlYW1TdGFydCk7CiAgICAgICAgICAgIHRoaXMuX2Nvbm4ucmF3SW5wdXQobWVzc2FnZS5kYXRhKTsKCiAgICAgICAgICAgIC8vX2hhbmRsZVN0cmVhbVN0ZWFydCB3aWxsIGNoZWNrIGZvciBYTUwgZXJyb3JzIGFuZCBkaXNjb25uZWN0IG9uIGVycm9yCiAgICAgICAgICAgIGlmICh0aGlzLl9oYW5kbGVTdHJlYW1TdGFydChzdHJlYW1TdGFydCkpIHsKCiAgICAgICAgICAgICAgICAvL19jb25uZWN0X2NiIHdpbGwgY2hlY2sgZm9yIHN0cmVhbTplcnJvciBhbmQgZGlzY29ubmVjdCBvbiBlcnJvcgogICAgICAgICAgICAgICAgdGhpcy5fY29ubmVjdF9jYihzdHJlYW1TdGFydCk7CgogICAgICAgICAgICAgICAgLy8gZW5zdXJlIHJlY2VpdmVkIHN0cmVhbTpzdHJlYW0gaXMgTk9UIHNlbGZjbG9zaW5nIGFuZCBzYXZlIGl0IGZvciBmb2xsb3dpbmcgbWVzc2FnZXMKICAgICAgICAgICAgICAgIHRoaXMuc3RyZWFtU3RhcnQgPSBtZXNzYWdlLmRhdGEucmVwbGFjZSgvXjxzdHJlYW06KC4qKVwvPiQvLCAiPHN0cmVhbTokMT4iKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAobWVzc2FnZS5kYXRhID09PSAiPC9zdHJlYW06c3RyZWFtPiIpIHsKICAgICAgICAgICAgdGhpcy5fY29ubi5yYXdJbnB1dChtZXNzYWdlLmRhdGEpOwogICAgICAgICAgICB0aGlzLl9jb25uLnhtbElucHV0KGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInN0cmVhbTpzdHJlYW0iKSk7CiAgICAgICAgICAgIHRoaXMuX2Nvbm4uX2NoYW5nZUNvbm5lY3RTdGF0dXMoU3Ryb3BoZS5TdGF0dXMuQ09OTkZBSUwsICJSZWNlaXZlZCBjbG9zaW5nIHN0cmVhbSIpOwogICAgICAgICAgICB0aGlzLl9jb25uLl9kb0Rpc2Nvbm5lY3QoKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZhciBzdHJpbmcgPSB0aGlzLl9zdHJlYW1XcmFwKG1lc3NhZ2UuZGF0YSk7CiAgICAgICAgICAgIHZhciBlbGVtID0gbmV3IERPTVBhcnNlcigpLnBhcnNlRnJvbVN0cmluZyhzdHJpbmcsICJ0ZXh0L3htbCIpLmRvY3VtZW50RWxlbWVudDsKICAgICAgICAgICAgdGhpcy5zb2NrZXQub25tZXNzYWdlID0gdGhpcy5fb25NZXNzYWdlLmJpbmQodGhpcyk7CiAgICAgICAgICAgIHRoaXMuX2Nvbm4uX2Nvbm5lY3RfY2IoZWxlbSwgbnVsbCwgbWVzc2FnZS5kYXRhKTsKICAgICAgICB9CiAgICB9LAoKICAgIC8qKiBQcml2YXRlRnVuY3Rpb246IF9kaXNjb25uZWN0CiAgICAgKiAgX1ByaXZhdGVfIGZ1bmN0aW9uIGNhbGxlZCBieSBTdHJvcGhlLkNvbm5lY3Rpb24uZGlzY29ubmVjdAogICAgICoKICAgICAqICBEaXNjb25uZWN0cyBhbmQgc2VuZHMgYSBsYXN0IHN0YW56YSBpZiBvbmUgaXMgZ2l2ZW4KICAgICAqCiAgICAgKiAgUGFyYW1ldGVyczoKICAgICAqICAgIChSZXF1ZXN0KSBwcmVzIC0gVGhpcyBzdGFuemEgd2lsbCBiZSBzZW50IGJlZm9yZSBkaXNjb25uZWN0aW5nLgogICAgICovCiAgICBfZGlzY29ubmVjdDogZnVuY3Rpb24gKHByZXMpCiAgICB7CiAgICAgICAgaWYgKHRoaXMuc29ja2V0LnJlYWR5U3RhdGUgIT09IFdlYlNvY2tldC5DTE9TRUQpIHsKICAgICAgICAgICAgaWYgKHByZXMpIHsKICAgICAgICAgICAgICAgIHRoaXMuX2Nvbm4uc2VuZChwcmVzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgY2xvc2UgPSAnPC9zdHJlYW06c3RyZWFtPic7CiAgICAgICAgICAgIHRoaXMuX2Nvbm4ueG1sT3V0cHV0KGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInN0cmVhbTpzdHJlYW0iKSk7CiAgICAgICAgICAgIHRoaXMuX2Nvbm4ucmF3T3V0cHV0KGNsb3NlKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHRoaXMuc29ja2V0LnNlbmQoY2xvc2UpOwogICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICBTdHJvcGhlLmluZm8oIkNvdWxkbid0IHNlbmQgY2xvc2luZyBzdHJlYW0gdGFnLiIpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB0aGlzLl9jb25uLl9kb0Rpc2Nvbm5lY3QoKTsKICAgIH0sCgogICAgLyoqIFByaXZhdGVGdW5jdGlvbjogX2RvRGlzY29ubmVjdAogICAgICogIF9Qcml2YXRlXyBmdW5jdGlvbiB0byBkaXNjb25uZWN0LgogICAgICoKICAgICAqICBKdXN0IGNsb3NlcyB0aGUgU29ja2V0IGZvciBXZWJTb2NrZXRzCiAgICAgKi8KICAgIF9kb0Rpc2Nvbm5lY3Q6IGZ1bmN0aW9uICgpCiAgICB7CiAgICAgICAgU3Ryb3BoZS5pbmZvKCJXZWJTb2NrZXRzIF9kb0Rpc2Nvbm5lY3Qgd2FzIGNhbGxlZCIpOwogICAgICAgIHRoaXMuX2Nsb3NlU29ja2V0KCk7CiAgICB9LAoKICAgIC8qKiBQcml2YXRlRnVuY3Rpb24gX3N0cmVhbVdyYXAKICAgICAqICBfUHJpdmF0ZV8gaGVscGVyIGZ1bmN0aW9uIHRvIHdyYXAgYSBzdGFuemEgaW4gYSA8c3RyZWFtPiB0YWcuCiAgICAgKiAgVGhpcyBpcyB1c2VkIHNvIFN0cm9waGUgY2FuIHByb2Nlc3Mgc3RhbnphcyBmcm9tIFdlYlNvY2tldHMgbGlrZSBCT1NICiAgICAgKi8KICAgIF9zdHJlYW1XcmFwOiBmdW5jdGlvbiAoc3RhbnphKQogICAgewogICAgICAgIHJldHVybiB0aGlzLnN0cmVhbVN0YXJ0ICsgc3RhbnphICsgJzwvc3RyZWFtOnN0cmVhbT4nOwogICAgfSwKCgogICAgLyoqIFByaXZhdGVGdW5jdGlvbjogX2Nsb3NlU29ja2V0CiAgICAgKiAgX1ByaXZhdGVfIGZ1bmN0aW9uIHRvIGNsb3NlIHRoZSBXZWJTb2NrZXQuCiAgICAgKgogICAgICogIENsb3NlcyB0aGUgc29ja2V0IGlmIGl0IGlzIHN0aWxsIG9wZW4gYW5kIGRlbGV0ZXMgaXQKICAgICAqLwogICAgX2Nsb3NlU29ja2V0OiBmdW5jdGlvbiAoKQogICAgewogICAgICAgIGlmICh0aGlzLnNvY2tldCkgeyB0cnkgewogICAgICAgICAgICB0aGlzLnNvY2tldC5jbG9zZSgpOwogICAgICAgIH0gY2F0Y2ggKGUpIHt9IH0KICAgICAgICB0aGlzLnNvY2tldCA9IG51bGw7CiAgICB9LAoKICAgIC8qKiBQcml2YXRlRnVuY3Rpb246IF9lbXB0eVF1ZXVlCiAgICAgKiBfUHJpdmF0ZV8gZnVuY3Rpb24gdG8gY2hlY2sgaWYgdGhlIG1lc3NhZ2UgcXVldWUgaXMgZW1wdHkuCiAgICAgKgogICAgICogIFJldHVybnM6CiAgICAgKiAgICBUcnVlLCBiZWNhdXNlIFdlYlNvY2tldCBtZXNzYWdlcyBhcmUgc2VuZCBpbW1lZGlhdGVseSBhZnRlciBxdWV1ZWluZy4KICAgICAqLwogICAgX2VtcHR5UXVldWU6IGZ1bmN0aW9uICgpCiAgICB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9LAoKICAgIC8qKiBQcml2YXRlRnVuY3Rpb246IF9vbkNsb3NlCiAgICAgKiBfUHJpdmF0ZV8gZnVuY3Rpb24gdG8gaGFuZGxlIHdlYnNvY2tldHMgY2xvc2luZy4KICAgICAqCiAgICAgKiBOb3RoaW5nIHRvIGRvIGhlcmUgZm9yIFdlYlNvY2tldHMKICAgICAqLwogICAgX29uQ2xvc2U6IGZ1bmN0aW9uKCkgewogICAgICAgIGlmKHRoaXMuX2Nvbm4uY29ubmVjdGVkICYmICF0aGlzLl9jb25uLmRpc2Nvbm5lY3RpbmcpIHsKICAgICAgICAgICAgU3Ryb3BoZS5lcnJvcigiV2Vic29ja2V0IGNsb3NlZCB1bmV4Y2VjdGVkbHkiKTsKICAgICAgICAgICAgdGhpcy5fY29ubi5fZG9EaXNjb25uZWN0KCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgU3Ryb3BoZS5pbmZvKCJXZWJzb2NrZXQgY2xvc2VkIik7CiAgICAgICAgfQogICAgfSwKCiAgICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiBfbm9fYXV0aF9yZWNlaXZlZAogICAgICoKICAgICAqIENhbGxlZCBvbiBzdHJlYW0gc3RhcnQvcmVzdGFydCB3aGVuIG5vIHN0cmVhbTpmZWF0dXJlcwogICAgICogaGFzIGJlZW4gcmVjZWl2ZWQuCiAgICAgKi8KICAgIF9ub19hdXRoX3JlY2VpdmVkOiBmdW5jdGlvbiAoX2NhbGxiYWNrKQogICAgewogICAgICAgIFN0cm9waGUuZXJyb3IoIlNlcnZlciBkaWQgbm90IHNlbmQgYW55IGF1dGggbWV0aG9kcyIpOwogICAgICAgIHRoaXMuX2Nvbm4uX2NoYW5nZUNvbm5lY3RTdGF0dXMoU3Ryb3BoZS5TdGF0dXMuQ09OTkZBSUwsICJTZXJ2ZXIgZGlkIG5vdCBzZW5kIGFueSBhdXRoIG1ldGhvZHMiKTsKICAgICAgICBpZiAoX2NhbGxiYWNrKSB7CiAgICAgICAgICAgIF9jYWxsYmFjayA9IF9jYWxsYmFjay5iaW5kKHRoaXMuX2Nvbm4pOwogICAgICAgICAgICBfY2FsbGJhY2soKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5fY29ubi5fZG9EaXNjb25uZWN0KCk7CiAgICB9LAoKICAgIC8qKiBQcml2YXRlRnVuY3Rpb246IF9vbkRpc2Nvbm5lY3RUaW1lb3V0CiAgICAgKiAgX1ByaXZhdGVfIHRpbWVvdXQgaGFuZGxlciBmb3IgaGFuZGxpbmcgbm9uLWdyYWNlZnVsIGRpc2Nvbm5lY3Rpb24uCiAgICAgKgogICAgICogIFRoaXMgZG9lcyBub3RoaW5nIGZvciBXZWJTb2NrZXRzCiAgICAgKi8KICAgIF9vbkRpc2Nvbm5lY3RUaW1lb3V0OiBmdW5jdGlvbiAoKSB7fSwKCiAgICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiBfb25FcnJvcgogICAgICogX1ByaXZhdGVfIGZ1bmN0aW9uIHRvIGhhbmRsZSB3ZWJzb2NrZXRzIGVycm9ycy4KICAgICAqCiAgICAgKiBQYXJhbWV0ZXJzOgogICAgICogKE9iamVjdCkgZXJyb3IgLSBUaGUgd2Vic29ja2V0IGVycm9yLgogICAgICovCiAgICBfb25FcnJvcjogZnVuY3Rpb24oZXJyb3IpIHsKICAgICAgICBTdHJvcGhlLmVycm9yKCJXZWJzb2NrZXQgZXJyb3IgIiArIGVycm9yKTsKICAgICAgICB0aGlzLl9jb25uLl9jaGFuZ2VDb25uZWN0U3RhdHVzKFN0cm9waGUuU3RhdHVzLkNPTk5GQUlMLCAiVGhlIFdlYlNvY2tldCBjb25uZWN0aW9uIGNvdWxkIG5vdCBiZSBlc3RhYmxpc2hlZCB3YXMgZGlzY29ubmVjdGVkLiIpOwogICAgICAgIHRoaXMuX2Rpc2Nvbm5lY3QoKTsKICAgIH0sCgogICAgLyoqIFByaXZhdGVGdW5jdGlvbjogX29uSWRsZQogICAgICogIF9Qcml2YXRlXyBmdW5jdGlvbiBjYWxsZWQgYnkgU3Ryb3BoZS5Db25uZWN0aW9uLl9vbklkbGUKICAgICAqCiAgICAgKiAgc2VuZHMgYWxsIHF1ZXVlZCBzdGFuemFzCiAgICAgKi8KICAgIF9vbklkbGU6IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgZGF0YSA9IHRoaXMuX2Nvbm4uX2RhdGE7CiAgICAgICAgaWYgKGRhdGEubGVuZ3RoID4gMCAmJiAhdGhpcy5fY29ubi5wYXVzZWQpIHsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAoZGF0YVtpXSAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIHZhciBzdGFuemEsIHJhd1N0YW56YTsKICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YVtpXSA9PT0gInJlc3RhcnQiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0YW56YSA9IHRoaXMuX2J1aWxkU3RyZWFtKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJhd1N0YW56YSA9IHRoaXMuX3JlbW92ZUNsb3NpbmdUYWcoc3RhbnphKTsKICAgICAgICAgICAgICAgICAgICAgICAgc3RhbnphID0gc3RhbnphLnRyZWUoKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBzdGFuemEgPSBkYXRhW2ldOwogICAgICAgICAgICAgICAgICAgICAgICByYXdTdGFuemEgPSBTdHJvcGhlLnNlcmlhbGl6ZShzdGFuemEpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9jb25uLnhtbE91dHB1dChzdGFuemEpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2Nvbm4ucmF3T3V0cHV0KHJhd1N0YW56YSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zb2NrZXQuc2VuZChyYXdTdGFuemEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuX2Nvbm4uX2RhdGEgPSBbXTsKICAgICAgICB9CiAgICB9LAoKICAgIC8qKiBQcml2YXRlRnVuY3Rpb246IF9vbk1lc3NhZ2UKICAgICAqIF9Qcml2YXRlXyBmdW5jdGlvbiB0byBoYW5kbGUgd2Vic29ja2V0cyBtZXNzYWdlcy4KICAgICAqCiAgICAgKiBUaGlzIGZ1bmN0aW9uIHBhcnNlcyBlYWNoIG9mIHRoZSBtZXNzYWdlcyBhcyBpZiB0aGV5IGFyZSBmdWxsIGRvY3VtZW50cy4gW1RPRE8gOiBXZSBtYXkgYWN0dWFsbHkgd2FudCB0byB1c2UgYSBTQVggUHVzaCBwYXJzZXJdLgogICAgICoKICAgICAqIFNpbmNlIGFsbCBYTVBQIHRyYWZmaWMgc3RhcnRzIHdpdGggIjxzdHJlYW06c3RyZWFtIHZlcnNpb249JzEuMCcgeG1sOmxhbmc9J2VuJyB4bWxucz0namFiYmVyOmNsaWVudCcgeG1sbnM6c3RyZWFtPSdodHRwOi8vZXRoZXJ4LmphYmJlci5vcmcvc3RyZWFtcycgaWQ9JzM2OTczOTU0NjMnIGZyb209J1NFUlZFUic+IgogICAgICogVGhlIGZpcnN0IHN0YW56YSB3aWxsIGFsd2F5cyBmYWlsIHRvIGJlIHBhcnNlZC4uLgogICAgICogQWRkdGlvbm5hbHksIHRoZSBzZWNvbmRzIHN0YW56YSB3aWxsIGFsd2F5cyBiZSBhIDxzdHJlYW06ZmVhdHVyZXM+IHdpdGggdGhlIHN0cmVhbSBOUyBkZWZpbmVkIGluIHRoZSBwcmV2aW91cyBzdGFuemEuLi4gc28gd2UgbmVlZCB0byAnZm9yY2UnIHRoZSBpbmNsdXNpb24gb2YgdGhlIE5TIGluIHRoaXMgc3RhbnphIQogICAgICoKICAgICAqIFBhcmFtZXRlcnM6CiAgICAgKiAoc3RyaW5nKSBtZXNzYWdlIC0gVGhlIHdlYnNvY2tldCBtZXNzYWdlLgogICAgICovCiAgICBfb25NZXNzYWdlOiBmdW5jdGlvbihtZXNzYWdlKSB7CiAgICAgICAgdmFyIGVsZW0sIGRhdGE7CiAgICAgICAgLy8gY2hlY2sgZm9yIGNsb3Npbmcgc3RyZWFtCiAgICAgICAgaWYgKG1lc3NhZ2UuZGF0YSA9PT0gIjwvc3RyZWFtOnN0cmVhbT4iKSB7CiAgICAgICAgICAgIHZhciBjbG9zZSA9ICI8L3N0cmVhbTpzdHJlYW0+IjsKICAgICAgICAgICAgdGhpcy5fY29ubi5yYXdJbnB1dChjbG9zZSk7CiAgICAgICAgICAgIHRoaXMuX2Nvbm4ueG1sSW5wdXQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic3RyZWFtOnN0cmVhbSIpKTsKICAgICAgICAgICAgaWYgKCF0aGlzLl9jb25uLmRpc2Nvbm5lY3RpbmcpIHsKICAgICAgICAgICAgICAgIHRoaXMuX2Nvbm4uX2RvRGlzY29ubmVjdCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9IGVsc2UgaWYgKG1lc3NhZ2UuZGF0YS5zZWFyY2goIjxzdHJlYW06c3RyZWFtICIpID09PSAwKSB7CiAgICAgICAgICAgIC8vTWFrZSB0aGUgaW5pdGlhbCBzdHJlYW06c3RyZWFtIHNlbGZjbG9zaW5nIHRvIHBhcnNlIGl0IHdpdGhvdXQgYSBTQVggcGFyc2VyLgogICAgICAgICAgICBkYXRhID0gbWVzc2FnZS5kYXRhLnJlcGxhY2UoLzxzdHJlYW06c3RyZWFtICguKlteXC9dKT4vLCAiPHN0cmVhbTpzdHJlYW0gJDEvPiIpOwogICAgICAgICAgICBlbGVtID0gbmV3IERPTVBhcnNlcigpLnBhcnNlRnJvbVN0cmluZyhkYXRhLCAidGV4dC94bWwiKS5kb2N1bWVudEVsZW1lbnQ7CgogICAgICAgICAgICBpZiAoIXRoaXMuX2hhbmRsZVN0cmVhbVN0YXJ0KGVsZW0pKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBkYXRhID0gdGhpcy5fc3RyZWFtV3JhcChtZXNzYWdlLmRhdGEpOwogICAgICAgICAgICBlbGVtID0gbmV3IERPTVBhcnNlcigpLnBhcnNlRnJvbVN0cmluZyhkYXRhLCAidGV4dC94bWwiKS5kb2N1bWVudEVsZW1lbnQ7CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5fY2hlY2tfc3RyZWFtZXJyb3IoZWxlbSwgU3Ryb3BoZS5TdGF0dXMuRVJST1IpKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vaGFuZGxlIHVuYXZhaWxhYmxlIHByZXNlbmNlIHN0YW56YSBiZWZvcmUgZGlzY29ubmVjdGluZwogICAgICAgIGlmICh0aGlzLl9jb25uLmRpc2Nvbm5lY3RpbmcgJiYKICAgICAgICAgICAgICAgIGVsZW0uZmlyc3RDaGlsZC5ub2RlTmFtZSA9PT0gInByZXNlbmNlIiAmJgogICAgICAgICAgICAgICAgZWxlbS5maXJzdENoaWxkLmdldEF0dHJpYnV0ZSgidHlwZSIpID09PSAidW5hdmFpbGFibGUiKSB7CiAgICAgICAgICAgIHRoaXMuX2Nvbm4ueG1sSW5wdXQoZWxlbSk7CiAgICAgICAgICAgIHRoaXMuX2Nvbm4ucmF3SW5wdXQoU3Ryb3BoZS5zZXJpYWxpemUoZWxlbSkpOwogICAgICAgICAgICAvLyBpZiB3ZSBhcmUgYWxyZWFkeSBkaXNjb25uZWN0aW5nIHdlIHdpbGwgaWdub3JlIHRoZSB1bmF2YWlsYWJsZSBzdGFuemEgYW5kCiAgICAgICAgICAgIC8vIHdhaXQgZm9yIHRoZSA8L3N0cmVhbTpzdHJlYW0+IHRhZyBiZWZvcmUgd2UgY2xvc2UgdGhlIGNvbm5lY3Rpb24KICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB0aGlzLl9jb25uLl9kYXRhUmVjdihlbGVtLCBtZXNzYWdlLmRhdGEpOwogICAgfSwKCiAgICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiBfb25PcGVuCiAgICAgKiBfUHJpdmF0ZV8gZnVuY3Rpb24gdG8gaGFuZGxlIHdlYnNvY2tldHMgY29ubmVjdGlvbiBzZXR1cC4KICAgICAqCiAgICAgKiBUaGUgb3BlbmluZyBzdHJlYW0gdGFnIGlzIHNlbnQgaGVyZS4KICAgICAqLwogICAgX29uT3BlbjogZnVuY3Rpb24oKSB7CiAgICAgICAgU3Ryb3BoZS5pbmZvKCJXZWJzb2NrZXQgb3BlbiIpOwogICAgICAgIHZhciBzdGFydCA9IHRoaXMuX2J1aWxkU3RyZWFtKCk7CiAgICAgICAgdGhpcy5fY29ubi54bWxPdXRwdXQoc3RhcnQudHJlZSgpKTsKCiAgICAgICAgdmFyIHN0YXJ0U3RyaW5nID0gdGhpcy5fcmVtb3ZlQ2xvc2luZ1RhZyhzdGFydCk7CiAgICAgICAgdGhpcy5fY29ubi5yYXdPdXRwdXQoc3RhcnRTdHJpbmcpOwogICAgICAgIHRoaXMuc29ja2V0LnNlbmQoc3RhcnRTdHJpbmcpOwogICAgfSwKCiAgICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiBfcmVtb3ZlQ2xvc2luZ1RhZwogICAgICogIF9Qcml2YXRlXyBmdW5jdGlvbiB0byBNYWtlIHRoZSBmaXJzdCA8c3RyZWFtOnN0cmVhbT4gbm9uLXNlbGZjbG9zaW5nCiAgICAgKgogICAgICogIFBhcmFtZXRlcnM6CiAgICAgKiAgICAgIChPYmplY3QpIGVsZW0gLSBUaGUgPHN0cmVhbTpzdHJlYW0+IHRhZy4KICAgICAqCiAgICAgKiAgUmV0dXJuczoKICAgICAqICAgICAgVGhlIHN0cmVhbTpzdHJlYW0gdGFnIGFzIFN0cmluZwogICAgICovCiAgICBfcmVtb3ZlQ2xvc2luZ1RhZzogZnVuY3Rpb24oZWxlbSkgewogICAgICAgIHZhciBzdHJpbmcgPSBTdHJvcGhlLnNlcmlhbGl6ZShlbGVtKTsKICAgICAgICBzdHJpbmcgPSBzdHJpbmcucmVwbGFjZSgvPChzdHJlYW06c3RyZWFtIC4qW15cL10pXC8+JC8sICI8JDE+Iik7CiAgICAgICAgcmV0dXJuIHN0cmluZzsKICAgIH0sCgogICAgLyoqIFByaXZhdGVGdW5jdGlvbjogX3JlcVRvRGF0YQogICAgICogX1ByaXZhdGVfIGZ1bmN0aW9uIHRvIGdldCBhIHN0YW56YSBvdXQgb2YgYSByZXF1ZXN0LgogICAgICoKICAgICAqIFdlYlNvY2tldHMgZG9uJ3QgdXNlIHJlcXVlc3RzLCBzbyB0aGUgcGFzc2VkIGFyZ3VtZW50IGlzIGp1c3QgcmV0dXJuZWQuCiAgICAgKgogICAgICogIFBhcmFtZXRlcnM6CiAgICAgKiAgICAoT2JqZWN0KSBzdGFuemEgLSBUaGUgc3RhbnphLgogICAgICoKICAgICAqICBSZXR1cm5zOgogICAgICogICAgVGhlIHN0YW56YSB0aGF0IHdhcyBwYXNzZWQuCiAgICAgKi8KICAgIF9yZXFUb0RhdGE6IGZ1bmN0aW9uIChzdGFuemEpCiAgICB7CiAgICAgICAgcmV0dXJuIHN0YW56YTsKICAgIH0sCgogICAgLyoqIFByaXZhdGVGdW5jdGlvbjogX3NlbmQKICAgICAqICBfUHJpdmF0ZV8gcGFydCBvZiB0aGUgQ29ubmVjdGlvbi5zZW5kIGZ1bmN0aW9uIGZvciBXZWJTb2NrZXQKICAgICAqCiAgICAgKiBKdXN0IGZsdXNoZXMgdGhlIG1lc3NhZ2VzIHRoYXQgYXJlIGluIHRoZSBxdWV1ZQogICAgICovCiAgICBfc2VuZDogZnVuY3Rpb24gKCkgewogICAgICAgIHRoaXMuX2Nvbm4uZmx1c2goKTsKICAgIH0sCgogICAgLyoqIFByaXZhdGVGdW5jdGlvbjogX3NlbmRSZXN0YXJ0CiAgICAgKgogICAgICogIFNlbmQgYW4geG1wcDpyZXN0YXJ0IHN0YW56YS4KICAgICAqLwogICAgX3NlbmRSZXN0YXJ0OiBmdW5jdGlvbiAoKQogICAgewogICAgICAgIGNsZWFyVGltZW91dCh0aGlzLl9jb25uLl9pZGxlVGltZW91dCk7CiAgICAgICAgdGhpcy5fY29ubi5fb25JZGxlLmJpbmQodGhpcy5fY29ubikoKTsKICAgIH0KfTsKCmRlZmluZSgic3Ryb3BoZSIsIChmdW5jdGlvbiAoZ2xvYmFsKSB7CiAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciByZXQsIGZuOwogICAgICAgIHJldHVybiByZXQgfHwgZ2xvYmFsLlN0cm9waGU7CiAgICB9Owp9KHRoaXMpKSk7CgovLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuOC4wCgovKgogKlBsdWdpbiB0byBpbXBsZW1lbnQgdGhlIE1VQyBleHRlbnNpb24uCiAgIGh0dHA6Ly94bXBwLm9yZy9leHRlbnNpb25zL3hlcC0wMDQ1Lmh0bWwKICpQcmV2aW91cyBBdXRob3I6CiAgICBOYXRoYW4gWm9ybiA8bmF0aGFuLnpvcm5AZ21haWwuY29tPgogKkNvbXBsZXRlIENvZmZlZVNjcmlwdCByZXdyaXRlOgogICAgQW5kcmVhcyBHdXRoIDxndXRoQGRiaXMucnd0aC1hYWNoZW4uZGU+CiAqLwoKKGZ1bmN0aW9uKCkgewogIHZhciBPY2N1cGFudCwgUm9vbUNvbmZpZywgWG1wcFJvb20sCiAgICBfX2hhc1Byb3AgPSB7fS5oYXNPd25Qcm9wZXJ0eSwKICAgIF9fYmluZCA9IGZ1bmN0aW9uKGZuLCBtZSl7IHJldHVybiBmdW5jdGlvbigpeyByZXR1cm4gZm4uYXBwbHkobWUsIGFyZ3VtZW50cyk7IH07IH07CgogIFN0cm9waGUuYWRkQ29ubmVjdGlvblBsdWdpbignbXVjJywgewogICAgX2Nvbm5lY3Rpb246IG51bGwsCiAgICByb29tczoge30sCiAgICByb29tTmFtZXM6IFtdLAoKICAgIC8qRnVuY3Rpb24KICAgIEluaXRpYWxpemUgdGhlIE1VQyBwbHVnaW4uIFNldHMgdGhlIGNvcnJlY3QgY29ubmVjdGlvbiBvYmplY3QgYW5kCiAgICBleHRlbmRzIHRoZSBuYW1lc2FjZS4KICAgICAqLwogICAgaW5pdDogZnVuY3Rpb24oY29ubikgewogICAgICB0aGlzLl9jb25uZWN0aW9uID0gY29ubjsKICAgICAgdGhpcy5fbXVjX2hhbmRsZXIgPSBudWxsOwogICAgICBTdHJvcGhlLmFkZE5hbWVzcGFjZSgnTVVDX09XTkVSJywgU3Ryb3BoZS5OUy5NVUMgKyAiI293bmVyIik7CiAgICAgIFN0cm9waGUuYWRkTmFtZXNwYWNlKCdNVUNfQURNSU4nLCBTdHJvcGhlLk5TLk1VQyArICIjYWRtaW4iKTsKICAgICAgU3Ryb3BoZS5hZGROYW1lc3BhY2UoJ01VQ19VU0VSJywgU3Ryb3BoZS5OUy5NVUMgKyAiI3VzZXIiKTsKICAgICAgU3Ryb3BoZS5hZGROYW1lc3BhY2UoJ01VQ19ST09NQ09ORicsIFN0cm9waGUuTlMuTVVDICsgIiNyb29tY29uZmlnIik7CiAgICAgIHJldHVybiBTdHJvcGhlLmFkZE5hbWVzcGFjZSgnTVVDX1JFR0lTVEVSJywgImphYmJlcjppcTpyZWdpc3RlciIpOwogICAgfSwKCiAgICAvKkZ1bmN0aW9uCiAgICBKb2luIGEgbXVsdGktdXNlciBjaGF0IHJvb20KICAgIFBhcmFtZXRlcnM6CiAgICAoU3RyaW5nKSByb29tIC0gVGhlIG11bHRpLXVzZXIgY2hhdCByb29tIHRvIGpvaW4uCiAgICAoU3RyaW5nKSBuaWNrIC0gVGhlIG5pY2tuYW1lIHRvIHVzZSBpbiB0aGUgY2hhdCByb29tLiBPcHRpb25hbAogICAgKEZ1bmN0aW9uKSBtc2dfaGFuZGxlcl9jYiAtIFRoZSBmdW5jdGlvbiBjYWxsIHRvIGhhbmRsZSBtZXNzYWdlcyBmcm9tIHRoZQogICAgc3BlY2lmaWVkIGNoYXQgcm9vbS4KICAgIChGdW5jdGlvbikgcHJlc19oYW5kbGVyX2NiIC0gVGhlIGZ1bmN0aW9uIGNhbGwgYmFjayB0byBoYW5kbGUgcHJlc2VuY2UKICAgIGluIHRoZSBjaGF0IHJvb20uCiAgICAoRnVuY3Rpb24pIHJvc3Rlcl9jYiAtIFRoZSBmdW5jdGlvbiBjYWxsIHRvIGhhbmRsZSByb3N0ZXIgaW5mbyBpbiB0aGUgY2hhdCByb29tCiAgICAoU3RyaW5nKSBwYXNzd29yZCAtIFRoZSBvcHRpb25hbCBwYXNzd29yZCB0byB1c2UuIChwYXNzd29yZCBwcm90ZWN0ZWQKICAgIHJvb21zIG9ubHkpCiAgICAoT2JqZWN0KSBoaXN0b3J5X2F0dHJzIC0gT3B0aW9uYWwgYXR0cmlidXRlcyBmb3IgcmV0cmlldmluZyBoaXN0b3J5CiAgICAoWE1MIERPTSBFbGVtZW50KSBleHRlbmRlZF9wcmVzZW5jZSAtIE9wdGlvbmFsIFhNTCBmb3IgZXh0ZW5kaW5nIHByZXNlbmNlCiAgICAgKi8KICAgIGpvaW46IGZ1bmN0aW9uKHJvb20sIG5pY2ssIG1zZ19oYW5kbGVyX2NiLCBwcmVzX2hhbmRsZXJfY2IsIHJvc3Rlcl9jYiwgcGFzc3dvcmQsIGhpc3RvcnlfYXR0cnMpIHsKICAgICAgdmFyIG1zZywgcm9vbV9uaWNrOwogICAgICByb29tX25pY2sgPSB0aGlzLnRlc3RfYXBwZW5kX25pY2socm9vbSwgbmljayk7CiAgICAgIG1zZyA9ICRwcmVzKHsKICAgICAgICBmcm9tOiB0aGlzLl9jb25uZWN0aW9uLmppZCwKICAgICAgICB0bzogcm9vbV9uaWNrCiAgICAgIH0pLmMoIngiLCB7CiAgICAgICAgeG1sbnM6IFN0cm9waGUuTlMuTVVDCiAgICAgIH0pOwogICAgICBpZiAoaGlzdG9yeV9hdHRycyAhPSBudWxsKSB7CiAgICAgICAgbXNnID0gbXNnLmMoImhpc3RvcnkiLCBoaXN0b3J5X2F0dHJzKS51cCgpOwogICAgICB9CiAgICAgIGlmIChwYXNzd29yZCAhPSBudWxsKSB7CiAgICAgICAgbXNnLmNub2RlKFN0cm9waGUueG1sRWxlbWVudCgicGFzc3dvcmQiLCBbXSwgcGFzc3dvcmQpKTsKICAgICAgfQogICAgICBpZiAodHlwZW9mIGV4dGVuZGVkX3ByZXNlbmNlICE9PSAidW5kZWZpbmVkIiAmJiBleHRlbmRlZF9wcmVzZW5jZSAhPT0gbnVsbCkgewogICAgICAgIG1zZy51cC5jbm9kZShleHRlbmRlZF9wcmVzZW5jZSk7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuX211Y19oYW5kbGVyID09IG51bGwpIHsKICAgICAgICB0aGlzLl9tdWNfaGFuZGxlciA9IHRoaXMuX2Nvbm5lY3Rpb24uYWRkSGFuZGxlcigoZnVuY3Rpb24oX3RoaXMpIHsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbihzdGFuemEpIHsKICAgICAgICAgICAgdmFyIGZyb20sIGhhbmRsZXIsIGhhbmRsZXJzLCBpZCwgcm9vbW5hbWUsIHgsIHhtbG5zLCB4cXVlcnksIF9pLCBfbGVuOwogICAgICAgICAgICBmcm9tID0gc3RhbnphLmdldEF0dHJpYnV0ZSgnZnJvbScpOwogICAgICAgICAgICBpZiAoIWZyb20pIHsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICByb29tbmFtZSA9IGZyb20uc3BsaXQoIi8iKVswXTsKICAgICAgICAgICAgaWYgKCFfdGhpcy5yb29tc1tyb29tbmFtZV0pIHsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICByb29tID0gX3RoaXMucm9vbXNbcm9vbW5hbWVdOwogICAgICAgICAgICBoYW5kbGVycyA9IHt9OwogICAgICAgICAgICBpZiAoc3RhbnphLm5vZGVOYW1lID09PSAibWVzc2FnZSIpIHsKICAgICAgICAgICAgICBoYW5kbGVycyA9IHJvb20uX21lc3NhZ2VfaGFuZGxlcnM7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoc3RhbnphLm5vZGVOYW1lID09PSAicHJlc2VuY2UiKSB7CiAgICAgICAgICAgICAgeHF1ZXJ5ID0gc3RhbnphLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJ4Iik7CiAgICAgICAgICAgICAgaWYgKHhxdWVyeS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICBmb3IgKF9pID0gMCwgX2xlbiA9IHhxdWVyeS5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykgewogICAgICAgICAgICAgICAgICB4ID0geHF1ZXJ5W19pXTsKICAgICAgICAgICAgICAgICAgeG1sbnMgPSB4LmdldEF0dHJpYnV0ZSgieG1sbnMiKTsKICAgICAgICAgICAgICAgICAgaWYgKHhtbG5zICYmIHhtbG5zLm1hdGNoKFN0cm9waGUuTlMuTVVDKSkgewogICAgICAgICAgICAgICAgICAgIGhhbmRsZXJzID0gcm9vbS5fcHJlc2VuY2VfaGFuZGxlcnM7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yIChpZCBpbiBoYW5kbGVycykgewogICAgICAgICAgICAgIGhhbmRsZXIgPSBoYW5kbGVyc1tpZF07CiAgICAgICAgICAgICAgaWYgKCFoYW5kbGVyKHN0YW56YSwgcm9vbSkpIHsKICAgICAgICAgICAgICAgIGRlbGV0ZSBoYW5kbGVyc1tpZF07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfTsKICAgICAgICB9KSh0aGlzKSk7CiAgICAgIH0KICAgICAgaWYgKCF0aGlzLnJvb21zLmhhc093blByb3BlcnR5KHJvb20pKSB7CiAgICAgICAgdGhpcy5yb29tc1tyb29tXSA9IG5ldyBYbXBwUm9vbSh0aGlzLCByb29tLCBuaWNrLCBwYXNzd29yZCk7CiAgICAgICAgdGhpcy5yb29tTmFtZXMucHVzaChyb29tKTsKICAgICAgfQogICAgICBpZiAocHJlc19oYW5kbGVyX2NiKSB7CiAgICAgICAgdGhpcy5yb29tc1tyb29tXS5hZGRIYW5kbGVyKCdwcmVzZW5jZScsIHByZXNfaGFuZGxlcl9jYik7CiAgICAgIH0KICAgICAgaWYgKG1zZ19oYW5kbGVyX2NiKSB7CiAgICAgICAgdGhpcy5yb29tc1tyb29tXS5hZGRIYW5kbGVyKCdtZXNzYWdlJywgbXNnX2hhbmRsZXJfY2IpOwogICAgICB9CiAgICAgIGlmIChyb3N0ZXJfY2IpIHsKICAgICAgICB0aGlzLnJvb21zW3Jvb21dLmFkZEhhbmRsZXIoJ3Jvc3RlcicsIHJvc3Rlcl9jYik7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMuX2Nvbm5lY3Rpb24uc2VuZChtc2cpOwogICAgfSwKCiAgICAvKkZ1bmN0aW9uCiAgICBMZWF2ZSBhIG11bHRpLXVzZXIgY2hhdCByb29tCiAgICBQYXJhbWV0ZXJzOgogICAgKFN0cmluZykgcm9vbSAtIFRoZSBtdWx0aS11c2VyIGNoYXQgcm9vbSB0byBsZWF2ZS4KICAgIChTdHJpbmcpIG5pY2sgLSBUaGUgbmljayBuYW1lIHVzZWQgaW4gdGhlIHJvb20uCiAgICAoRnVuY3Rpb24pIGhhbmRsZXJfY2IgLSBPcHRpb25hbCBmdW5jdGlvbiB0byBoYW5kbGUgdGhlIHN1Y2Nlc3NmdWwgbGVhdmUuCiAgICAoU3RyaW5nKSBleGl0X21zZyAtIG9wdGlvbmFsIGV4aXQgbWVzc2FnZS4KICAgIFJldHVybnM6CiAgICBpcWlkIC0gVGhlIHVuaXF1ZSBpZCBmb3IgdGhlIHJvb20gbGVhdmUuCiAgICAgKi8KICAgIGxlYXZlOiBmdW5jdGlvbihyb29tLCBuaWNrLCBoYW5kbGVyX2NiLCBleGl0X21zZykgewogICAgICB2YXIgaWQsIHByZXNlbmNlLCBwcmVzZW5jZWlkLCByb29tX25pY2s7CiAgICAgIGlkID0gdGhpcy5yb29tTmFtZXMuaW5kZXhPZihyb29tKTsKICAgICAgZGVsZXRlIHRoaXMucm9vbXNbcm9vbV07CiAgICAgIGlmIChpZCA+PSAwKSB7CiAgICAgICAgdGhpcy5yb29tTmFtZXMuc3BsaWNlKGlkLCAxKTsKICAgICAgICBpZiAodGhpcy5yb29tTmFtZXMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICB0aGlzLl9jb25uZWN0aW9uLmRlbGV0ZUhhbmRsZXIodGhpcy5fbXVjX2hhbmRsZXIpOwogICAgICAgICAgdGhpcy5fbXVjX2hhbmRsZXIgPSBudWxsOwogICAgICAgIH0KICAgICAgfQogICAgICByb29tX25pY2sgPSB0aGlzLnRlc3RfYXBwZW5kX25pY2socm9vbSwgbmljayk7CiAgICAgIHByZXNlbmNlaWQgPSB0aGlzLl9jb25uZWN0aW9uLmdldFVuaXF1ZUlkKCk7CiAgICAgIHByZXNlbmNlID0gJHByZXMoewogICAgICAgIHR5cGU6ICJ1bmF2YWlsYWJsZSIsCiAgICAgICAgaWQ6IHByZXNlbmNlaWQsCiAgICAgICAgZnJvbTogdGhpcy5fY29ubmVjdGlvbi5qaWQsCiAgICAgICAgdG86IHJvb21fbmljawogICAgICB9KTsKICAgICAgaWYgKGV4aXRfbXNnICE9IG51bGwpIHsKICAgICAgICBwcmVzZW5jZS5jKCJzdGF0dXMiLCBleGl0X21zZyk7CiAgICAgIH0KICAgICAgaWYgKGhhbmRsZXJfY2IgIT0gbnVsbCkgewogICAgICAgIHRoaXMuX2Nvbm5lY3Rpb24uYWRkSGFuZGxlcihoYW5kbGVyX2NiLCBudWxsLCAicHJlc2VuY2UiLCBudWxsLCBwcmVzZW5jZWlkKTsKICAgICAgfQogICAgICB0aGlzLl9jb25uZWN0aW9uLnNlbmQocHJlc2VuY2UpOwogICAgICByZXR1cm4gcHJlc2VuY2VpZDsKICAgIH0sCgogICAgLypGdW5jdGlvbgogICAgUGFyYW1ldGVyczoKICAgIChTdHJpbmcpIHJvb20gLSBUaGUgbXVsdGktdXNlciBjaGF0IHJvb20gbmFtZS4KICAgIChTdHJpbmcpIG5pY2sgLSBUaGUgbmljayBuYW1lIHVzZWQgaW4gdGhlIGNoYXQgcm9vbS4KICAgIChTdHJpbmcpIG1lc3NhZ2UgLSBUaGUgcGxhaW50ZXh0IG1lc3NhZ2UgdG8gc2VuZCB0byB0aGUgcm9vbS4KICAgIChTdHJpbmcpIGh0bWxfbWVzc2FnZSAtIFRoZSBtZXNzYWdlIHRvIHNlbmQgdG8gdGhlIHJvb20gd2l0aCBodG1sIG1hcmt1cC4KICAgIChTdHJpbmcpIHR5cGUgLSAiZ3JvdXBjaGF0IiBmb3IgZ3JvdXAgY2hhdCBtZXNzYWdlcyBvCiAgICAgICAgICAgICAgICAgICAgImNoYXQiIGZvciBwcml2YXRlIGNoYXQgbWVzc2FnZXMKICAgIFJldHVybnM6CiAgICBtc2dpcSAtIHRoZSB1bmlxdWUgaWQgdXNlZCB0byBzZW5kIHRoZSBtZXNzYWdlCiAgICAgKi8KICAgIG1lc3NhZ2U6IGZ1bmN0aW9uKHJvb20sIG5pY2ssIG1lc3NhZ2UsIGh0bWxfbWVzc2FnZSwgdHlwZSwgbXNnaWQpIHsKICAgICAgdmFyIG1zZywgcGFyZW50LCByb29tX25pY2s7CiAgICAgIHJvb21fbmljayA9IHRoaXMudGVzdF9hcHBlbmRfbmljayhyb29tLCBuaWNrKTsKICAgICAgdHlwZSA9IHR5cGUgfHwgKG5pY2sgIT0gbnVsbCA/ICJjaGF0IiA6ICJncm91cGNoYXQiKTsKICAgICAgbXNnaWQgPSBtc2dpZCB8fCB0aGlzLl9jb25uZWN0aW9uLmdldFVuaXF1ZUlkKCk7CiAgICAgIG1zZyA9ICRtc2coewogICAgICAgIHRvOiByb29tX25pY2ssCiAgICAgICAgZnJvbTogdGhpcy5fY29ubmVjdGlvbi5qaWQsCiAgICAgICAgdHlwZTogdHlwZSwKICAgICAgICBpZDogbXNnaWQKICAgICAgfSkuYygiYm9keSIsIHsKICAgICAgICB4bWxuczogU3Ryb3BoZS5OUy5DTElFTlQKICAgICAgfSkudChtZXNzYWdlKTsKICAgICAgbXNnLnVwKCk7CiAgICAgIGlmIChodG1sX21lc3NhZ2UgIT0gbnVsbCkgewogICAgICAgIG1zZy5jKCJodG1sIiwgewogICAgICAgICAgeG1sbnM6IFN0cm9waGUuTlMuWEhUTUxfSU0KICAgICAgICB9KS5jKCJib2R5IiwgewogICAgICAgICAgeG1sbnM6IFN0cm9waGUuTlMuWEhUTUwKICAgICAgICB9KS5oKGh0bWxfbWVzc2FnZSk7CiAgICAgICAgaWYgKG1zZy5ub2RlLmNoaWxkTm9kZXMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICBwYXJlbnQgPSBtc2cubm9kZS5wYXJlbnROb2RlOwogICAgICAgICAgbXNnLnVwKCkudXAoKTsKICAgICAgICAgIG1zZy5ub2RlLnJlbW92ZUNoaWxkKHBhcmVudCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG1zZy51cCgpLnVwKCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIG1zZy5jKCJ4IiwgewogICAgICAgIHhtbG5zOiAiamFiYmVyOng6ZXZlbnQiCiAgICAgIH0pLmMoImNvbXBvc2luZyIpOwogICAgICB0aGlzLl9jb25uZWN0aW9uLnNlbmQobXNnKTsKICAgICAgcmV0dXJuIG1zZ2lkOwogICAgfSwKCiAgICAvKkZ1bmN0aW9uCiAgICBDb252ZW5pZW5jZSBGdW5jdGlvbiB0byBzZW5kIGEgTWVzc2FnZSB0byBhbGwgT2NjdXBhbnRzCiAgICBQYXJhbWV0ZXJzOgogICAgKFN0cmluZykgcm9vbSAtIFRoZSBtdWx0aS11c2VyIGNoYXQgcm9vbSBuYW1lLgogICAgKFN0cmluZykgbWVzc2FnZSAtIFRoZSBwbGFpbnRleHQgbWVzc2FnZSB0byBzZW5kIHRvIHRoZSByb29tLgogICAgKFN0cmluZykgaHRtbF9tZXNzYWdlIC0gVGhlIG1lc3NhZ2UgdG8gc2VuZCB0byB0aGUgcm9vbSB3aXRoIGh0bWwgbWFya3VwLgogICAgKFN0cmluZykgbXNnaWQgLSBPcHRpb25hbCB1bmlxdWUgSUQgd2hpY2ggd2lsbCBiZSBzZXQgYXMgdGhlICdpZCcgYXR0cmlidXRlIG9mIHRoZSBzdGFuemEKICAgIFJldHVybnM6CiAgICBtc2dpcSAtIHRoZSB1bmlxdWUgaWQgdXNlZCB0byBzZW5kIHRoZSBtZXNzYWdlCiAgICAgKi8KICAgIGdyb3VwY2hhdDogZnVuY3Rpb24ocm9vbSwgbWVzc2FnZSwgaHRtbF9tZXNzYWdlLCBtc2dpZCkgewogICAgICByZXR1cm4gdGhpcy5tZXNzYWdlKHJvb20sIG51bGwsIG1lc3NhZ2UsIGh0bWxfbWVzc2FnZSwgdm9pZCAwLCBtc2dpZCk7CiAgICB9LAoKICAgIC8qRnVuY3Rpb24KICAgIFNlbmQgYSBtZWRpYXRlZCBpbnZpdGF0aW9uLgogICAgUGFyYW1ldGVyczoKICAgIChTdHJpbmcpIHJvb20gLSBUaGUgbXVsdGktdXNlciBjaGF0IHJvb20gbmFtZS4KICAgIChTdHJpbmcpIHJlY2VpdmVyIC0gVGhlIGludml0YXRpb24ncyByZWNlaXZlci4KICAgIChTdHJpbmcpIHJlYXNvbiAtIE9wdGlvbmFsIHJlYXNvbiBmb3Igam9pbmluZyB0aGUgcm9vbS4KICAgIFJldHVybnM6CiAgICBtc2dpcSAtIHRoZSB1bmlxdWUgaWQgdXNlZCB0byBzZW5kIHRoZSBpbnZpdGF0aW9uCiAgICAgKi8KICAgIGludml0ZTogZnVuY3Rpb24ocm9vbSwgcmVjZWl2ZXIsIHJlYXNvbikgewogICAgICB2YXIgaW52aXRhdGlvbiwgbXNnaWQ7CiAgICAgIG1zZ2lkID0gdGhpcy5fY29ubmVjdGlvbi5nZXRVbmlxdWVJZCgpOwogICAgICBpbnZpdGF0aW9uID0gJG1zZyh7CiAgICAgICAgZnJvbTogdGhpcy5fY29ubmVjdGlvbi5qaWQsCiAgICAgICAgdG86IHJvb20sCiAgICAgICAgaWQ6IG1zZ2lkCiAgICAgIH0pLmMoJ3gnLCB7CiAgICAgICAgeG1sbnM6IFN0cm9waGUuTlMuTVVDX1VTRVIKICAgICAgfSkuYygnaW52aXRlJywgewogICAgICAgIHRvOiByZWNlaXZlcgogICAgICB9KTsKICAgICAgaWYgKHJlYXNvbiAhPSBudWxsKSB7CiAgICAgICAgaW52aXRhdGlvbi5jKCdyZWFzb24nLCByZWFzb24pOwogICAgICB9CiAgICAgIHRoaXMuX2Nvbm5lY3Rpb24uc2VuZChpbnZpdGF0aW9uKTsKICAgICAgcmV0dXJuIG1zZ2lkOwogICAgfSwKCiAgICAvKkZ1bmN0aW9uCiAgICBTZW5kIGEgbWVkaWF0ZWQgbXVsdGlwbGUgaW52aXRhdGlvbi4KICAgIFBhcmFtZXRlcnM6CiAgICAoU3RyaW5nKSByb29tIC0gVGhlIG11bHRpLXVzZXIgY2hhdCByb29tIG5hbWUuCiAgICAoQXJyYXkpIHJlY2VpdmVycyAtIFRoZSBpbnZpdGF0aW9uJ3MgcmVjZWl2ZXJzLgogICAgKFN0cmluZykgcmVhc29uIC0gT3B0aW9uYWwgcmVhc29uIGZvciBqb2luaW5nIHRoZSByb29tLgogICAgUmV0dXJuczoKICAgIG1zZ2lxIC0gdGhlIHVuaXF1ZSBpZCB1c2VkIHRvIHNlbmQgdGhlIGludml0YXRpb24KICAgICAqLwogICAgbXVsdGlwbGVJbnZpdGVzOiBmdW5jdGlvbihyb29tLCByZWNlaXZlcnMsIHJlYXNvbikgewogICAgICB2YXIgaW52aXRhdGlvbiwgbXNnaWQsIHJlY2VpdmVyLCBfaSwgX2xlbjsKICAgICAgbXNnaWQgPSB0aGlzLl9jb25uZWN0aW9uLmdldFVuaXF1ZUlkKCk7CiAgICAgIGludml0YXRpb24gPSAkbXNnKHsKICAgICAgICBmcm9tOiB0aGlzLl9jb25uZWN0aW9uLmppZCwKICAgICAgICB0bzogcm9vbSwKICAgICAgICBpZDogbXNnaWQKICAgICAgfSkuYygneCcsIHsKICAgICAgICB4bWxuczogU3Ryb3BoZS5OUy5NVUNfVVNFUgogICAgICB9KTsKICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSByZWNlaXZlcnMubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHsKICAgICAgICByZWNlaXZlciA9IHJlY2VpdmVyc1tfaV07CiAgICAgICAgaW52aXRhdGlvbi5jKCdpbnZpdGUnLCB7CiAgICAgICAgICB0bzogcmVjZWl2ZXIKICAgICAgICB9KTsKICAgICAgICBpZiAocmVhc29uICE9IG51bGwpIHsKICAgICAgICAgIGludml0YXRpb24uYygncmVhc29uJywgcmVhc29uKTsKICAgICAgICAgIGludml0YXRpb24udXAoKTsKICAgICAgICB9CiAgICAgICAgaW52aXRhdGlvbi51cCgpOwogICAgICB9CiAgICAgIHRoaXMuX2Nvbm5lY3Rpb24uc2VuZChpbnZpdGF0aW9uKTsKICAgICAgcmV0dXJuIG1zZ2lkOwogICAgfSwKCiAgICAvKkZ1bmN0aW9uCiAgICBTZW5kIGEgZGlyZWN0IGludml0YXRpb24uCiAgICBQYXJhbWV0ZXJzOgogICAgKFN0cmluZykgcm9vbSAtIFRoZSBtdWx0aS11c2VyIGNoYXQgcm9vbSBuYW1lLgogICAgKFN0cmluZykgcmVjZWl2ZXIgLSBUaGUgaW52aXRhdGlvbidzIHJlY2VpdmVyLgogICAgKFN0cmluZykgcmVhc29uIC0gT3B0aW9uYWwgcmVhc29uIGZvciBqb2luaW5nIHRoZSByb29tLgogICAgKFN0cmluZykgcGFzc3dvcmQgLSBPcHRpb25hbCBwYXNzd29yZCBmb3IgdGhlIHJvb20uCiAgICBSZXR1cm5zOgogICAgbXNnaXEgLSB0aGUgdW5pcXVlIGlkIHVzZWQgdG8gc2VuZCB0aGUgaW52aXRhdGlvbgogICAgICovCiAgICBkaXJlY3RJbnZpdGU6IGZ1bmN0aW9uKHJvb20sIHJlY2VpdmVyLCByZWFzb24sIHBhc3N3b3JkKSB7CiAgICAgIHZhciBhdHRycywgaW52aXRhdGlvbiwgbXNnaWQ7CiAgICAgIG1zZ2lkID0gdGhpcy5fY29ubmVjdGlvbi5nZXRVbmlxdWVJZCgpOwogICAgICBhdHRycyA9IHsKICAgICAgICB4bWxuczogJ2phYmJlcjp4OmNvbmZlcmVuY2UnLAogICAgICAgIGppZDogcm9vbQogICAgICB9OwogICAgICBpZiAocmVhc29uICE9IG51bGwpIHsKICAgICAgICBhdHRycy5yZWFzb24gPSByZWFzb247CiAgICAgIH0KICAgICAgaWYgKHBhc3N3b3JkICE9IG51bGwpIHsKICAgICAgICBhdHRycy5wYXNzd29yZCA9IHBhc3N3b3JkOwogICAgICB9CiAgICAgIGludml0YXRpb24gPSAkbXNnKHsKICAgICAgICBmcm9tOiB0aGlzLl9jb25uZWN0aW9uLmppZCwKICAgICAgICB0bzogcmVjZWl2ZXIsCiAgICAgICAgaWQ6IG1zZ2lkCiAgICAgIH0pLmMoJ3gnLCBhdHRycyk7CiAgICAgIHRoaXMuX2Nvbm5lY3Rpb24uc2VuZChpbnZpdGF0aW9uKTsKICAgICAgcmV0dXJuIG1zZ2lkOwogICAgfSwKCiAgICAvKkZ1bmN0aW9uCiAgICBRdWVyaWVzIGEgcm9vbSBmb3IgYSBsaXN0IG9mIG9jY3VwYW50cwogICAgKFN0cmluZykgcm9vbSAtIFRoZSBtdWx0aS11c2VyIGNoYXQgcm9vbSBuYW1lLgogICAgKEZ1bmN0aW9uKSBzdWNjZXNzX2NiIC0gT3B0aW9uYWwgZnVuY3Rpb24gdG8gaGFuZGxlIHRoZSBpbmZvLgogICAgKEZ1bmN0aW9uKSBlcnJvcl9jYiAtIE9wdGlvbmFsIGZ1bmN0aW9uIHRvIGhhbmRsZSBhbiBlcnJvci4KICAgIFJldHVybnM6CiAgICBpZCAtIHRoZSB1bmlxdWUgaWQgdXNlZCB0byBzZW5kIHRoZSBpbmZvIHJlcXVlc3QKICAgICAqLwogICAgcXVlcnlPY2N1cGFudHM6IGZ1bmN0aW9uKHJvb20sIHN1Y2Nlc3NfY2IsIGVycm9yX2NiKSB7CiAgICAgIHZhciBhdHRycywgaW5mbzsKICAgICAgYXR0cnMgPSB7CiAgICAgICAgeG1sbnM6IFN0cm9waGUuTlMuRElTQ09fSVRFTVMKICAgICAgfTsKICAgICAgaW5mbyA9ICRpcSh7CiAgICAgICAgZnJvbTogdGhpcy5fY29ubmVjdGlvbi5qaWQsCiAgICAgICAgdG86IHJvb20sCiAgICAgICAgdHlwZTogJ2dldCcKICAgICAgfSkuYygncXVlcnknLCBhdHRycyk7CiAgICAgIHJldHVybiB0aGlzLl9jb25uZWN0aW9uLnNlbmRJUShpbmZvLCBzdWNjZXNzX2NiLCBlcnJvcl9jYik7CiAgICB9LAoKICAgIC8qRnVuY3Rpb24KICAgIFN0YXJ0IGEgcm9vbSBjb25maWd1cmF0aW9uLgogICAgUGFyYW1ldGVyczoKICAgIChTdHJpbmcpIHJvb20gLSBUaGUgbXVsdGktdXNlciBjaGF0IHJvb20gbmFtZS4KICAgIChGdW5jdGlvbikgaGFuZGxlcl9jYiAtIE9wdGlvbmFsIGZ1bmN0aW9uIHRvIGhhbmRsZSB0aGUgY29uZmlnIGZvcm0uCiAgICBSZXR1cm5zOgogICAgaWQgLSB0aGUgdW5pcXVlIGlkIHVzZWQgdG8gc2VuZCB0aGUgY29uZmlndXJhdGlvbiByZXF1ZXN0CiAgICAgKi8KICAgIGNvbmZpZ3VyZTogZnVuY3Rpb24ocm9vbSwgaGFuZGxlcl9jYiwgZXJyb3JfY2IpIHsKICAgICAgdmFyIGNvbmZpZywgc3RhbnphOwogICAgICBjb25maWcgPSAkaXEoewogICAgICAgIHRvOiByb29tLAogICAgICAgIHR5cGU6ICJnZXQiCiAgICAgIH0pLmMoInF1ZXJ5IiwgewogICAgICAgIHhtbG5zOiBTdHJvcGhlLk5TLk1VQ19PV05FUgogICAgICB9KTsKICAgICAgc3RhbnphID0gY29uZmlnLnRyZWUoKTsKICAgICAgcmV0dXJuIHRoaXMuX2Nvbm5lY3Rpb24uc2VuZElRKHN0YW56YSwgaGFuZGxlcl9jYiwgZXJyb3JfY2IpOwogICAgfSwKCiAgICAvKkZ1bmN0aW9uCiAgICBDYW5jZWwgdGhlIHJvb20gY29uZmlndXJhdGlvbgogICAgUGFyYW1ldGVyczoKICAgIChTdHJpbmcpIHJvb20gLSBUaGUgbXVsdGktdXNlciBjaGF0IHJvb20gbmFtZS4KICAgIFJldHVybnM6CiAgICBpZCAtIHRoZSB1bmlxdWUgaWQgdXNlZCB0byBjYW5jZWwgdGhlIGNvbmZpZ3VyYXRpb24uCiAgICAgKi8KICAgIGNhbmNlbENvbmZpZ3VyZTogZnVuY3Rpb24ocm9vbSkgewogICAgICB2YXIgY29uZmlnLCBzdGFuemE7CiAgICAgIGNvbmZpZyA9ICRpcSh7CiAgICAgICAgdG86IHJvb20sCiAgICAgICAgdHlwZTogInNldCIKICAgICAgfSkuYygicXVlcnkiLCB7CiAgICAgICAgeG1sbnM6IFN0cm9waGUuTlMuTVVDX09XTkVSCiAgICAgIH0pLmMoIngiLCB7CiAgICAgICAgeG1sbnM6ICJqYWJiZXI6eDpkYXRhIiwKICAgICAgICB0eXBlOiAiY2FuY2VsIgogICAgICB9KTsKICAgICAgc3RhbnphID0gY29uZmlnLnRyZWUoKTsKICAgICAgcmV0dXJuIHRoaXMuX2Nvbm5lY3Rpb24uc2VuZElRKHN0YW56YSk7CiAgICB9LAoKICAgIC8qRnVuY3Rpb24KICAgIFNhdmUgYSByb29tIGNvbmZpZ3VyYXRpb24uCiAgICBQYXJhbWV0ZXJzOgogICAgKFN0cmluZykgcm9vbSAtIFRoZSBtdWx0aS11c2VyIGNoYXQgcm9vbSBuYW1lLgogICAgKEFycmF5KSBjb25maWctIEZvcm0gT2JqZWN0IG9yIGFuIGFycmF5IG9mIGZvcm0gZWxlbWVudHMgdXNlZCB0byBjb25maWd1cmUgdGhlIHJvb20uCiAgICBSZXR1cm5zOgogICAgaWQgLSB0aGUgdW5pcXVlIGlkIHVzZWQgdG8gc2F2ZSB0aGUgY29uZmlndXJhdGlvbi4KICAgICAqLwogICAgc2F2ZUNvbmZpZ3VyYXRpb246IGZ1bmN0aW9uKHJvb20sIGNvbmZpZywgc3VjY2Vzc19jYiwgZXJyb3JfY2IpIHsKICAgICAgdmFyIGNvbmYsIGlxLCBzdGFuemEsIF9pLCBfbGVuOwogICAgICBpcSA9ICRpcSh7CiAgICAgICAgdG86IHJvb20sCiAgICAgICAgdHlwZTogInNldCIKICAgICAgfSkuYygicXVlcnkiLCB7CiAgICAgICAgeG1sbnM6IFN0cm9waGUuTlMuTVVDX09XTkVSCiAgICAgIH0pOwogICAgICBpZiAodHlwZW9mIEZvcm0gIT09ICJ1bmRlZmluZWQiICYmIGNvbmZpZyBpbnN0YW5jZW9mIEZvcm0pIHsKICAgICAgICBjb25maWcudHlwZSA9ICJzdWJtaXQiOwogICAgICAgIGlxLmNub2RlKGNvbmZpZy50b1hNTCgpKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpcS5jKCJ4IiwgewogICAgICAgICAgeG1sbnM6ICJqYWJiZXI6eDpkYXRhIiwKICAgICAgICAgIHR5cGU6ICJzdWJtaXQiCiAgICAgICAgfSk7CiAgICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSBjb25maWcubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHsKICAgICAgICAgIGNvbmYgPSBjb25maWdbX2ldOwogICAgICAgICAgaXEuY25vZGUoY29uZikudXAoKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgc3RhbnphID0gaXEudHJlZSgpOwogICAgICByZXR1cm4gdGhpcy5fY29ubmVjdGlvbi5zZW5kSVEoc3RhbnphLCBzdWNjZXNzX2NiLCBlcnJvcl9jYik7CiAgICB9LAoKICAgIC8qRnVuY3Rpb24KICAgIFBhcmFtZXRlcnM6CiAgICAoU3RyaW5nKSByb29tIC0gVGhlIG11bHRpLXVzZXIgY2hhdCByb29tIG5hbWUuCiAgICBSZXR1cm5zOgogICAgaWQgLSB0aGUgdW5pcXVlIGlkIHVzZWQgdG8gY3JlYXRlIHRoZSBjaGF0IHJvb20uCiAgICAgKi8KICAgIGNyZWF0ZUluc3RhbnRSb29tOiBmdW5jdGlvbihyb29tLCBzdWNjZXNzX2NiLCBlcnJvcl9jYikgewogICAgICB2YXIgcm9vbWlxOwogICAgICByb29taXEgPSAkaXEoewogICAgICAgIHRvOiByb29tLAogICAgICAgIHR5cGU6ICJzZXQiCiAgICAgIH0pLmMoInF1ZXJ5IiwgewogICAgICAgIHhtbG5zOiBTdHJvcGhlLk5TLk1VQ19PV05FUgogICAgICB9KS5jKCJ4IiwgewogICAgICAgIHhtbG5zOiAiamFiYmVyOng6ZGF0YSIsCiAgICAgICAgdHlwZTogInN1Ym1pdCIKICAgICAgfSk7CiAgICAgIHJldHVybiB0aGlzLl9jb25uZWN0aW9uLnNlbmRJUShyb29taXEudHJlZSgpLCBzdWNjZXNzX2NiLCBlcnJvcl9jYik7CiAgICB9LAoKICAgIC8qRnVuY3Rpb24KICAgIFBhcmFtZXRlcnM6CiAgICAoU3RyaW5nKSByb29tIC0gVGhlIG11bHRpLXVzZXIgY2hhdCByb29tIG5hbWUuCiAgICAoT2JqZWN0KSBjb25maWcgLSB0aGUgY29uZmlndXJhdGlvbi4gZXg6IHsibXVjI3Jvb21jb25maWdfcHVibGljcm9vbSI6ICIwIiwgIm11YyNyb29tY29uZmlnX3BlcnNpc3RlbnRyb29tIjogIjEifQogICAgUmV0dXJuczoKICAgIGlkIC0gdGhlIHVuaXF1ZSBpZCB1c2VkIHRvIGNyZWF0ZSB0aGUgY2hhdCByb29tLgogICAgICovCiAgICBjcmVhdGVDb25maWd1cmVkUm9vbTogZnVuY3Rpb24ocm9vbSwgY29uZmlnLCBzdWNjZXNzX2NiLCBlcnJvcl9jYikgewogICAgICB2YXIgaywgcm9vbWlxLCB2OwogICAgICByb29taXEgPSAkaXEoewogICAgICAgIHRvOiByb29tLAogICAgICAgIHR5cGU6ICJzZXQiCiAgICAgIH0pLmMoInF1ZXJ5IiwgewogICAgICAgIHhtbG5zOiBTdHJvcGhlLk5TLk1VQ19PV05FUgogICAgICB9KS5jKCJ4IiwgewogICAgICAgIHhtbG5zOiAiamFiYmVyOng6ZGF0YSIsCiAgICAgICAgdHlwZTogInN1Ym1pdCIKICAgICAgfSk7CiAgICAgIHJvb21pcS5jKCdmaWVsZCcsIHsKICAgICAgICAndmFyJzogJ0ZPUk1fVFlQRScKICAgICAgfSkuYygndmFsdWUnKS50KCdodHRwOi8vamFiYmVyLm9yZy9wcm90b2NvbC9tdWMjcm9vbWNvbmZpZycpLnVwKCkudXAoKTsKICAgICAgZm9yIChrIGluIGNvbmZpZykgewogICAgICAgIGlmICghX19oYXNQcm9wLmNhbGwoY29uZmlnLCBrKSkgY29udGludWU7CiAgICAgICAgdiA9IGNvbmZpZ1trXTsKICAgICAgICByb29taXEuYygnZmllbGQnLCB7CiAgICAgICAgICAndmFyJzogawogICAgICAgIH0pLmMoJ3ZhbHVlJykudCh2KS51cCgpLnVwKCk7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMuX2Nvbm5lY3Rpb24uc2VuZElRKHJvb21pcS50cmVlKCksIHN1Y2Nlc3NfY2IsIGVycm9yX2NiKTsKICAgIH0sCgogICAgLypGdW5jdGlvbgogICAgU2V0IHRoZSB0b3BpYyBvZiB0aGUgY2hhdCByb29tLgogICAgUGFyYW1ldGVyczoKICAgIChTdHJpbmcpIHJvb20gLSBUaGUgbXVsdGktdXNlciBjaGF0IHJvb20gbmFtZS4KICAgIChTdHJpbmcpIHRvcGljIC0gVG9waWMgbWVzc2FnZS4KICAgICAqLwogICAgc2V0VG9waWM6IGZ1bmN0aW9uKHJvb20sIHRvcGljKSB7CiAgICAgIHZhciBtc2c7CiAgICAgIG1zZyA9ICRtc2coewogICAgICAgIHRvOiByb29tLAogICAgICAgIGZyb206IHRoaXMuX2Nvbm5lY3Rpb24uamlkLAogICAgICAgIHR5cGU6ICJncm91cGNoYXQiCiAgICAgIH0pLmMoInN1YmplY3QiLCB7CiAgICAgICAgeG1sbnM6ICJqYWJiZXI6Y2xpZW50IgogICAgICB9KS50KHRvcGljKTsKICAgICAgcmV0dXJuIHRoaXMuX2Nvbm5lY3Rpb24uc2VuZChtc2cudHJlZSgpKTsKICAgIH0sCgogICAgLypGdW5jdGlvbgogICAgSW50ZXJuYWwgRnVuY3Rpb24gdGhhdCBDaGFuZ2VzIHRoZSByb2xlIG9yIGFmZmlsaWF0aW9uIG9mIGEgbWVtYmVyCiAgICBvZiBhIE1VQyByb29tLiBUaGlzIGZ1bmN0aW9uIGlzIHVzZWQgYnkgbW9kaWZ5Um9sZSBhbmQgbW9kaWZ5QWZmaWxpYXRpb24uCiAgICBUaGUgbW9kaWZpY2F0aW9uIGNhbiBvbmx5IGJlIGRvbmUgYnkgYSByb29tIG1vZGVyYXRvci4gQW4gZXJyb3Igd2lsbCBiZQogICAgcmV0dXJuZWQgaWYgdGhlIHVzZXIgZG9lc24ndCBoYXZlIHBlcm1pc3Npb24uCiAgICBQYXJhbWV0ZXJzOgogICAgKFN0cmluZykgcm9vbSAtIFRoZSBtdWx0aS11c2VyIGNoYXQgcm9vbSBuYW1lLgogICAgKE9iamVjdCkgaXRlbSAtIE9iamVjdCB3aXRoIG5pY2sgYW5kIHJvbGUgb3IgamlkIGFuZCBhZmZpbGlhdGlvbiBhdHRyaWJ1dGUKICAgIChTdHJpbmcpIHJlYXNvbiAtIE9wdGlvbmFsIHJlYXNvbiBmb3IgdGhlIGNoYW5nZS4KICAgIChGdW5jdGlvbikgaGFuZGxlcl9jYiAtIE9wdGlvbmFsIGNhbGxiYWNrIGZvciBzdWNjZXNzCiAgICAoRnVuY3Rpb24pIGVycm9yX2NiIC0gT3B0aW9uYWwgY2FsbGJhY2sgZm9yIGVycm9yCiAgICBSZXR1cm5zOgogICAgaXEgLSB0aGUgaWQgb2YgdGhlIG1vZGUgY2hhbmdlIHJlcXVlc3QuCiAgICAgKi8KICAgIF9tb2RpZnlQcml2aWxlZ2U6IGZ1bmN0aW9uKHJvb20sIGl0ZW0sIHJlYXNvbiwgaGFuZGxlcl9jYiwgZXJyb3JfY2IpIHsKICAgICAgdmFyIGlxOwogICAgICBpcSA9ICRpcSh7CiAgICAgICAgdG86IHJvb20sCiAgICAgICAgdHlwZTogInNldCIKICAgICAgfSkuYygicXVlcnkiLCB7CiAgICAgICAgeG1sbnM6IFN0cm9waGUuTlMuTVVDX0FETUlOCiAgICAgIH0pLmNub2RlKGl0ZW0ubm9kZSk7CiAgICAgIGlmIChyZWFzb24gIT0gbnVsbCkgewogICAgICAgIGlxLmMoInJlYXNvbiIsIHJlYXNvbik7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMuX2Nvbm5lY3Rpb24uc2VuZElRKGlxLnRyZWUoKSwgaGFuZGxlcl9jYiwgZXJyb3JfY2IpOwogICAgfSwKCiAgICAvKkZ1bmN0aW9uCiAgICBDaGFuZ2VzIHRoZSByb2xlIG9mIGEgbWVtYmVyIG9mIGEgTVVDIHJvb20uCiAgICBUaGUgbW9kaWZpY2F0aW9uIGNhbiBvbmx5IGJlIGRvbmUgYnkgYSByb29tIG1vZGVyYXRvci4gQW4gZXJyb3Igd2lsbCBiZQogICAgcmV0dXJuZWQgaWYgdGhlIHVzZXIgZG9lc24ndCBoYXZlIHBlcm1pc3Npb24uCiAgICBQYXJhbWV0ZXJzOgogICAgKFN0cmluZykgcm9vbSAtIFRoZSBtdWx0aS11c2VyIGNoYXQgcm9vbSBuYW1lLgogICAgKFN0cmluZykgbmljayAtIFRoZSBuaWNrIG5hbWUgb2YgdGhlIHVzZXIgdG8gbW9kaWZ5LgogICAgKFN0cmluZykgcm9sZSAtIFRoZSBuZXcgcm9sZSBvZiB0aGUgdXNlci4KICAgIChTdHJpbmcpIGFmZmlsaWF0aW9uIC0gVGhlIG5ldyBhZmZpbGlhdGlvbiBvZiB0aGUgdXNlci4KICAgIChTdHJpbmcpIHJlYXNvbiAtIE9wdGlvbmFsIHJlYXNvbiBmb3IgdGhlIGNoYW5nZS4KICAgIChGdW5jdGlvbikgaGFuZGxlcl9jYiAtIE9wdGlvbmFsIGNhbGxiYWNrIGZvciBzdWNjZXNzCiAgICAoRnVuY3Rpb24pIGVycm9yX2NiIC0gT3B0aW9uYWwgY2FsbGJhY2sgZm9yIGVycm9yCiAgICBSZXR1cm5zOgogICAgaXEgLSB0aGUgaWQgb2YgdGhlIG1vZGUgY2hhbmdlIHJlcXVlc3QuCiAgICAgKi8KICAgIG1vZGlmeVJvbGU6IGZ1bmN0aW9uKHJvb20sIG5pY2ssIHJvbGUsIHJlYXNvbiwgaGFuZGxlcl9jYiwgZXJyb3JfY2IpIHsKICAgICAgdmFyIGl0ZW07CiAgICAgIGl0ZW0gPSAkYnVpbGQoIml0ZW0iLCB7CiAgICAgICAgbmljazogbmljaywKICAgICAgICByb2xlOiByb2xlCiAgICAgIH0pOwogICAgICByZXR1cm4gdGhpcy5fbW9kaWZ5UHJpdmlsZWdlKHJvb20sIGl0ZW0sIHJlYXNvbiwgaGFuZGxlcl9jYiwgZXJyb3JfY2IpOwogICAgfSwKICAgIGtpY2s6IGZ1bmN0aW9uKHJvb20sIG5pY2ssIHJlYXNvbiwgaGFuZGxlcl9jYiwgZXJyb3JfY2IpIHsKICAgICAgcmV0dXJuIHRoaXMubW9kaWZ5Um9sZShyb29tLCBuaWNrLCAnbm9uZScsIHJlYXNvbiwgaGFuZGxlcl9jYiwgZXJyb3JfY2IpOwogICAgfSwKICAgIHZvaWNlOiBmdW5jdGlvbihyb29tLCBuaWNrLCByZWFzb24sIGhhbmRsZXJfY2IsIGVycm9yX2NiKSB7CiAgICAgIHJldHVybiB0aGlzLm1vZGlmeVJvbGUocm9vbSwgbmljaywgJ3BhcnRpY2lwYW50JywgcmVhc29uLCBoYW5kbGVyX2NiLCBlcnJvcl9jYik7CiAgICB9LAogICAgbXV0ZTogZnVuY3Rpb24ocm9vbSwgbmljaywgcmVhc29uLCBoYW5kbGVyX2NiLCBlcnJvcl9jYikgewogICAgICByZXR1cm4gdGhpcy5tb2RpZnlSb2xlKHJvb20sIG5pY2ssICd2aXNpdG9yJywgcmVhc29uLCBoYW5kbGVyX2NiLCBlcnJvcl9jYik7CiAgICB9LAogICAgb3A6IGZ1bmN0aW9uKHJvb20sIG5pY2ssIHJlYXNvbiwgaGFuZGxlcl9jYiwgZXJyb3JfY2IpIHsKICAgICAgcmV0dXJuIHRoaXMubW9kaWZ5Um9sZShyb29tLCBuaWNrLCAnbW9kZXJhdG9yJywgcmVhc29uLCBoYW5kbGVyX2NiLCBlcnJvcl9jYik7CiAgICB9LAogICAgZGVvcDogZnVuY3Rpb24ocm9vbSwgbmljaywgcmVhc29uLCBoYW5kbGVyX2NiLCBlcnJvcl9jYikgewogICAgICByZXR1cm4gdGhpcy5tb2RpZnlSb2xlKHJvb20sIG5pY2ssICdwYXJ0aWNpcGFudCcsIHJlYXNvbiwgaGFuZGxlcl9jYiwgZXJyb3JfY2IpOwogICAgfSwKCiAgICAvKkZ1bmN0aW9uCiAgICBDaGFuZ2VzIHRoZSBhZmZpbGlhdGlvbiBvZiBhIG1lbWJlciBvZiBhIE1VQyByb29tLgogICAgVGhlIG1vZGlmaWNhdGlvbiBjYW4gb25seSBiZSBkb25lIGJ5IGEgcm9vbSBtb2RlcmF0b3IuIEFuIGVycm9yIHdpbGwgYmUKICAgIHJldHVybmVkIGlmIHRoZSB1c2VyIGRvZXNuJ3QgaGF2ZSBwZXJtaXNzaW9uLgogICAgUGFyYW1ldGVyczoKICAgIChTdHJpbmcpIHJvb20gLSBUaGUgbXVsdGktdXNlciBjaGF0IHJvb20gbmFtZS4KICAgIChTdHJpbmcpIGppZCAgLSBUaGUgamlkIG9mIHRoZSB1c2VyIHRvIG1vZGlmeS4KICAgIChTdHJpbmcpIGFmZmlsaWF0aW9uIC0gVGhlIG5ldyBhZmZpbGlhdGlvbiBvZiB0aGUgdXNlci4KICAgIChTdHJpbmcpIHJlYXNvbiAtIE9wdGlvbmFsIHJlYXNvbiBmb3IgdGhlIGNoYW5nZS4KICAgIChGdW5jdGlvbikgaGFuZGxlcl9jYiAtIE9wdGlvbmFsIGNhbGxiYWNrIGZvciBzdWNjZXNzCiAgICAoRnVuY3Rpb24pIGVycm9yX2NiIC0gT3B0aW9uYWwgY2FsbGJhY2sgZm9yIGVycm9yCiAgICBSZXR1cm5zOgogICAgaXEgLSB0aGUgaWQgb2YgdGhlIG1vZGUgY2hhbmdlIHJlcXVlc3QuCiAgICAgKi8KICAgIG1vZGlmeUFmZmlsaWF0aW9uOiBmdW5jdGlvbihyb29tLCBqaWQsIGFmZmlsaWF0aW9uLCByZWFzb24sIGhhbmRsZXJfY2IsIGVycm9yX2NiKSB7CiAgICAgIHZhciBpdGVtOwogICAgICBpdGVtID0gJGJ1aWxkKCJpdGVtIiwgewogICAgICAgIGppZDogamlkLAogICAgICAgIGFmZmlsaWF0aW9uOiBhZmZpbGlhdGlvbgogICAgICB9KTsKICAgICAgcmV0dXJuIHRoaXMuX21vZGlmeVByaXZpbGVnZShyb29tLCBpdGVtLCByZWFzb24sIGhhbmRsZXJfY2IsIGVycm9yX2NiKTsKICAgIH0sCiAgICBiYW46IGZ1bmN0aW9uKHJvb20sIGppZCwgcmVhc29uLCBoYW5kbGVyX2NiLCBlcnJvcl9jYikgewogICAgICByZXR1cm4gdGhpcy5tb2RpZnlBZmZpbGlhdGlvbihyb29tLCBqaWQsICdvdXRjYXN0JywgcmVhc29uLCBoYW5kbGVyX2NiLCBlcnJvcl9jYik7CiAgICB9LAogICAgbWVtYmVyOiBmdW5jdGlvbihyb29tLCBqaWQsIHJlYXNvbiwgaGFuZGxlcl9jYiwgZXJyb3JfY2IpIHsKICAgICAgcmV0dXJuIHRoaXMubW9kaWZ5QWZmaWxpYXRpb24ocm9vbSwgamlkLCAnbWVtYmVyJywgcmVhc29uLCBoYW5kbGVyX2NiLCBlcnJvcl9jYik7CiAgICB9LAogICAgcmV2b2tlOiBmdW5jdGlvbihyb29tLCBqaWQsIHJlYXNvbiwgaGFuZGxlcl9jYiwgZXJyb3JfY2IpIHsKICAgICAgcmV0dXJuIHRoaXMubW9kaWZ5QWZmaWxpYXRpb24ocm9vbSwgamlkLCAnbm9uZScsIHJlYXNvbiwgaGFuZGxlcl9jYiwgZXJyb3JfY2IpOwogICAgfSwKICAgIG93bmVyOiBmdW5jdGlvbihyb29tLCBqaWQsIHJlYXNvbiwgaGFuZGxlcl9jYiwgZXJyb3JfY2IpIHsKICAgICAgcmV0dXJuIHRoaXMubW9kaWZ5QWZmaWxpYXRpb24ocm9vbSwgamlkLCAnb3duZXInLCByZWFzb24sIGhhbmRsZXJfY2IsIGVycm9yX2NiKTsKICAgIH0sCiAgICBhZG1pbjogZnVuY3Rpb24ocm9vbSwgamlkLCByZWFzb24sIGhhbmRsZXJfY2IsIGVycm9yX2NiKSB7CiAgICAgIHJldHVybiB0aGlzLm1vZGlmeUFmZmlsaWF0aW9uKHJvb20sIGppZCwgJ2FkbWluJywgcmVhc29uLCBoYW5kbGVyX2NiLCBlcnJvcl9jYik7CiAgICB9LAoKICAgIC8qRnVuY3Rpb24KICAgIENoYW5nZSB0aGUgY3VycmVudCB1c2VycyBuaWNrIG5hbWUuCiAgICBQYXJhbWV0ZXJzOgogICAgKFN0cmluZykgcm9vbSAtIFRoZSBtdWx0aS11c2VyIGNoYXQgcm9vbSBuYW1lLgogICAgKFN0cmluZykgdXNlciAtIFRoZSBuZXcgbmljayBuYW1lLgogICAgICovCiAgICBjaGFuZ2VOaWNrOiBmdW5jdGlvbihyb29tLCB1c2VyKSB7CiAgICAgIHZhciBwcmVzZW5jZSwgcm9vbV9uaWNrOwogICAgICByb29tX25pY2sgPSB0aGlzLnRlc3RfYXBwZW5kX25pY2socm9vbSwgdXNlcik7CiAgICAgIHByZXNlbmNlID0gJHByZXMoewogICAgICAgIGZyb206IHRoaXMuX2Nvbm5lY3Rpb24uamlkLAogICAgICAgIHRvOiByb29tX25pY2ssCiAgICAgICAgaWQ6IHRoaXMuX2Nvbm5lY3Rpb24uZ2V0VW5pcXVlSWQoKQogICAgICB9KTsKICAgICAgcmV0dXJuIHRoaXMuX2Nvbm5lY3Rpb24uc2VuZChwcmVzZW5jZS50cmVlKCkpOwogICAgfSwKCiAgICAvKkZ1bmN0aW9uCiAgICBDaGFuZ2UgdGhlIGN1cnJlbnQgdXNlcnMgc3RhdHVzLgogICAgUGFyYW1ldGVyczoKICAgIChTdHJpbmcpIHJvb20gLSBUaGUgbXVsdGktdXNlciBjaGF0IHJvb20gbmFtZS4KICAgIChTdHJpbmcpIHVzZXIgLSBUaGUgY3VycmVudCBuaWNrLgogICAgKFN0cmluZykgc2hvdyAtIFRoZSBuZXcgc2hvdy10ZXh0LgogICAgKFN0cmluZykgc3RhdHVzIC0gVGhlIG5ldyBzdGF0dXMtdGV4dC4KICAgICAqLwogICAgc2V0U3RhdHVzOiBmdW5jdGlvbihyb29tLCB1c2VyLCBzaG93LCBzdGF0dXMpIHsKICAgICAgdmFyIHByZXNlbmNlLCByb29tX25pY2s7CiAgICAgIHJvb21fbmljayA9IHRoaXMudGVzdF9hcHBlbmRfbmljayhyb29tLCB1c2VyKTsKICAgICAgcHJlc2VuY2UgPSAkcHJlcyh7CiAgICAgICAgZnJvbTogdGhpcy5fY29ubmVjdGlvbi5qaWQsCiAgICAgICAgdG86IHJvb21fbmljawogICAgICB9KTsKICAgICAgaWYgKHNob3cgIT0gbnVsbCkgewogICAgICAgIHByZXNlbmNlLmMoJ3Nob3cnLCBzaG93KS51cCgpOwogICAgICB9CiAgICAgIGlmIChzdGF0dXMgIT0gbnVsbCkgewogICAgICAgIHByZXNlbmNlLmMoJ3N0YXR1cycsIHN0YXR1cyk7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMuX2Nvbm5lY3Rpb24uc2VuZChwcmVzZW5jZS50cmVlKCkpOwogICAgfSwKCiAgICAvKkZ1bmN0aW9uCiAgICBSZWdpc3RlcmluZyB3aXRoIGEgcm9vbS4KICAgIEBzZWUgaHR0cDovL3htcHAub3JnL2V4dGVuc2lvbnMveGVwLTAwNDUuaHRtbCNyZWdpc3RlcgogICAgUGFyYW1ldGVyczoKICAgIChTdHJpbmcpIHJvb20gLSBUaGUgbXVsdGktdXNlciBjaGF0IHJvb20gbmFtZS4KICAgIChGdW5jdGlvbikgaGFuZGxlX2NiIC0gRnVuY3Rpb24gdG8gY2FsbCBmb3Igcm9vbSBsaXN0IHJldHVybi4KICAgIChGdW5jdGlvbikgZXJyb3JfY2IgLSBGdW5jdGlvbiB0byBjYWxsIG9uIGVycm9yLgogICAgICovCiAgICByZWdpc3RyYXRpb25SZXF1ZXN0OiBmdW5jdGlvbihyb29tLCBoYW5kbGVfY2IsIGVycm9yX2NiKSB7CiAgICAgIHZhciBpcTsKICAgICAgaXEgPSAkaXEoewogICAgICAgIHRvOiByb29tLAogICAgICAgIGZyb206IHRoaXMuX2Nvbm5lY3Rpb24uamlkLAogICAgICAgIHR5cGU6ICJnZXQiCiAgICAgIH0pLmMoInF1ZXJ5IiwgewogICAgICAgIHhtbG5zOiBTdHJvcGhlLk5TLk1VQ19SRUdJU1RFUgogICAgICB9KTsKICAgICAgcmV0dXJuIHRoaXMuX2Nvbm5lY3Rpb24uc2VuZElRKGlxLCBmdW5jdGlvbihzdGFuemEpIHsKICAgICAgICB2YXIgJGZpZWxkLCAkZmllbGRzLCBmaWVsZCwgZmllbGRzLCBsZW5ndGgsIF9pLCBfbGVuOwogICAgICAgICRmaWVsZHMgPSBzdGFuemEuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2ZpZWxkJyk7CiAgICAgICAgbGVuZ3RoID0gJGZpZWxkcy5sZW5ndGg7CiAgICAgICAgZmllbGRzID0gewogICAgICAgICAgcmVxdWlyZWQ6IFtdLAogICAgICAgICAgb3B0aW9uYWw6IFtdCiAgICAgICAgfTsKICAgICAgICBmb3IgKF9pID0gMCwgX2xlbiA9ICRmaWVsZHMubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHsKICAgICAgICAgICRmaWVsZCA9ICRmaWVsZHNbX2ldOwogICAgICAgICAgZmllbGQgPSB7CiAgICAgICAgICAgICJ2YXIiOiAkZmllbGQuZ2V0QXR0cmlidXRlKCd2YXInKSwKICAgICAgICAgICAgbGFiZWw6ICRmaWVsZC5nZXRBdHRyaWJ1dGUoJ2xhYmVsJyksCiAgICAgICAgICAgIHR5cGU6ICRmaWVsZC5nZXRBdHRyaWJ1dGUoJ3R5cGUnKQogICAgICAgICAgfTsKICAgICAgICAgIGlmICgkZmllbGQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3JlcXVpcmVkJykubGVuZ3RoID4gMCkgewogICAgICAgICAgICBmaWVsZHMucmVxdWlyZWQucHVzaChmaWVsZCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBmaWVsZHMub3B0aW9uYWwucHVzaChmaWVsZCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBoYW5kbGVfY2IoZmllbGRzKTsKICAgICAgfSwgZXJyb3JfY2IpOwogICAgfSwKCiAgICAvKkZ1bmN0aW9uCiAgICBTdWJtaXRzIHJlZ2lzdHJhdGlvbiBmb3JtLgogICAgUGFyYW1ldGVyczoKICAgIChTdHJpbmcpIHJvb20gLSBUaGUgbXVsdGktdXNlciBjaGF0IHJvb20gbmFtZS4KICAgIChGdW5jdGlvbikgaGFuZGxlX2NiIC0gRnVuY3Rpb24gdG8gY2FsbCBmb3Igcm9vbSBsaXN0IHJldHVybi4KICAgIChGdW5jdGlvbikgZXJyb3JfY2IgLSBGdW5jdGlvbiB0byBjYWxsIG9uIGVycm9yLgogICAgICovCiAgICBzdWJtaXRSZWdpc3RyYXRpb25Gb3JtOiBmdW5jdGlvbihyb29tLCBmaWVsZHMsIGhhbmRsZV9jYiwgZXJyb3JfY2IpIHsKICAgICAgdmFyIGlxLCBrZXksIHZhbDsKICAgICAgaXEgPSAkaXEoewogICAgICAgIHRvOiByb29tLAogICAgICAgIHR5cGU6ICJzZXQiCiAgICAgIH0pLmMoInF1ZXJ5IiwgewogICAgICAgIHhtbG5zOiBTdHJvcGhlLk5TLk1VQ19SRUdJU1RFUgogICAgICB9KTsKICAgICAgaXEuYygieCIsIHsKICAgICAgICB4bWxuczogImphYmJlcjp4OmRhdGEiLAogICAgICAgIHR5cGU6ICJzdWJtaXQiCiAgICAgIH0pOwogICAgICBpcS5jKCdmaWVsZCcsIHsKICAgICAgICAndmFyJzogJ0ZPUk1fVFlQRScKICAgICAgfSkuYygndmFsdWUnKS50KCdodHRwOi8vamFiYmVyLm9yZy9wcm90b2NvbC9tdWMjcmVnaXN0ZXInKS51cCgpLnVwKCk7CiAgICAgIGZvciAoa2V5IGluIGZpZWxkcykgewogICAgICAgIHZhbCA9IGZpZWxkc1trZXldOwogICAgICAgIGlxLmMoJ2ZpZWxkJywgewogICAgICAgICAgJ3Zhcic6IGtleQogICAgICAgIH0pLmMoJ3ZhbHVlJykudCh2YWwpLnVwKCkudXAoKTsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy5fY29ubmVjdGlvbi5zZW5kSVEoaXEsIGhhbmRsZV9jYiwgZXJyb3JfY2IpOwogICAgfSwKCiAgICAvKkZ1bmN0aW9uCiAgICBMaXN0IGFsbCBjaGF0IHJvb20gYXZhaWxhYmxlIG9uIGEgc2VydmVyLgogICAgUGFyYW1ldGVyczoKICAgIChTdHJpbmcpIHNlcnZlciAtIG5hbWUgb2YgY2hhdCBzZXJ2ZXIuCiAgICAoU3RyaW5nKSBoYW5kbGVfY2IgLSBGdW5jdGlvbiB0byBjYWxsIGZvciByb29tIGxpc3QgcmV0dXJuLgogICAgKFN0cmluZykgZXJyb3JfY2IgLSBGdW5jdGlvbiB0byBjYWxsIG9uIGVycm9yLgogICAgICovCiAgICBsaXN0Um9vbXM6IGZ1bmN0aW9uKHNlcnZlciwgaGFuZGxlX2NiLCBlcnJvcl9jYikgewogICAgICB2YXIgaXE7CiAgICAgIGlxID0gJGlxKHsKICAgICAgICB0bzogc2VydmVyLAogICAgICAgIGZyb206IHRoaXMuX2Nvbm5lY3Rpb24uamlkLAogICAgICAgIHR5cGU6ICJnZXQiCiAgICAgIH0pLmMoInF1ZXJ5IiwgewogICAgICAgIHhtbG5zOiBTdHJvcGhlLk5TLkRJU0NPX0lURU1TCiAgICAgIH0pOwogICAgICByZXR1cm4gdGhpcy5fY29ubmVjdGlvbi5zZW5kSVEoaXEsIGhhbmRsZV9jYiwgZXJyb3JfY2IpOwogICAgfSwKICAgIHRlc3RfYXBwZW5kX25pY2s6IGZ1bmN0aW9uKHJvb20sIG5pY2spIHsKICAgICAgdmFyIGRvbWFpbiwgbm9kZTsKICAgICAgbm9kZSA9IFN0cm9waGUuZXNjYXBlTm9kZShTdHJvcGhlLmdldE5vZGVGcm9tSmlkKHJvb20pKTsKICAgICAgZG9tYWluID0gU3Ryb3BoZS5nZXREb21haW5Gcm9tSmlkKHJvb20pOwogICAgICByZXR1cm4gbm9kZSArICJAIiArIGRvbWFpbiArIChuaWNrICE9IG51bGwgPyAiLyIgKyBuaWNrIDogIiIpOwogICAgfQogIH0pOwoKICBYbXBwUm9vbSA9IChmdW5jdGlvbigpIHsKICAgIGZ1bmN0aW9uIFhtcHBSb29tKGNsaWVudCwgbmFtZSwgbmljaywgcGFzc3dvcmQpIHsKICAgICAgdGhpcy5jbGllbnQgPSBjbGllbnQ7CiAgICAgIHRoaXMubmFtZSA9IG5hbWU7CiAgICAgIHRoaXMubmljayA9IG5pY2s7CiAgICAgIHRoaXMucGFzc3dvcmQgPSBwYXNzd29yZDsKICAgICAgdGhpcy5fcm9vbVJvc3RlckhhbmRsZXIgPSBfX2JpbmQodGhpcy5fcm9vbVJvc3RlckhhbmRsZXIsIHRoaXMpOwogICAgICB0aGlzLl9hZGRPY2N1cGFudCA9IF9fYmluZCh0aGlzLl9hZGRPY2N1cGFudCwgdGhpcyk7CiAgICAgIHRoaXMucm9zdGVyID0ge307CiAgICAgIHRoaXMuX21lc3NhZ2VfaGFuZGxlcnMgPSB7fTsKICAgICAgdGhpcy5fcHJlc2VuY2VfaGFuZGxlcnMgPSB7fTsKICAgICAgdGhpcy5fcm9zdGVyX2hhbmRsZXJzID0ge307CiAgICAgIHRoaXMuX2hhbmRsZXJfaWRzID0gMDsKICAgICAgaWYgKGNsaWVudC5tdWMpIHsKICAgICAgICB0aGlzLmNsaWVudCA9IGNsaWVudC5tdWM7CiAgICAgIH0KICAgICAgdGhpcy5uYW1lID0gU3Ryb3BoZS5nZXRCYXJlSmlkRnJvbUppZChuYW1lKTsKICAgICAgdGhpcy5hZGRIYW5kbGVyKCdwcmVzZW5jZScsIHRoaXMuX3Jvb21Sb3N0ZXJIYW5kbGVyKTsKICAgIH0KCiAgICBYbXBwUm9vbS5wcm90b3R5cGUuam9pbiA9IGZ1bmN0aW9uKG1zZ19oYW5kbGVyX2NiLCBwcmVzX2hhbmRsZXJfY2IsIHJvc3Rlcl9jYikgewogICAgICByZXR1cm4gdGhpcy5jbGllbnQuam9pbih0aGlzLm5hbWUsIHRoaXMubmljaywgbXNnX2hhbmRsZXJfY2IsIHByZXNfaGFuZGxlcl9jYiwgcm9zdGVyX2NiLCB0aGlzLnBhc3N3b3JkKTsKICAgIH07CgogICAgWG1wcFJvb20ucHJvdG90eXBlLmxlYXZlID0gZnVuY3Rpb24oaGFuZGxlcl9jYiwgbWVzc2FnZSkgewogICAgICB0aGlzLmNsaWVudC5sZWF2ZSh0aGlzLm5hbWUsIHRoaXMubmljaywgaGFuZGxlcl9jYiwgbWVzc2FnZSk7CiAgICAgIHJldHVybiBkZWxldGUgdGhpcy5jbGllbnQucm9vbXNbdGhpcy5uYW1lXTsKICAgIH07CgogICAgWG1wcFJvb20ucHJvdG90eXBlLm1lc3NhZ2UgPSBmdW5jdGlvbihuaWNrLCBtZXNzYWdlLCBodG1sX21lc3NhZ2UsIHR5cGUpIHsKICAgICAgcmV0dXJuIHRoaXMuY2xpZW50Lm1lc3NhZ2UodGhpcy5uYW1lLCBuaWNrLCBtZXNzYWdlLCBodG1sX21lc3NhZ2UsIHR5cGUpOwogICAgfTsKCiAgICBYbXBwUm9vbS5wcm90b3R5cGUuZ3JvdXBjaGF0ID0gZnVuY3Rpb24obWVzc2FnZSwgaHRtbF9tZXNzYWdlKSB7CiAgICAgIHJldHVybiB0aGlzLmNsaWVudC5ncm91cGNoYXQodGhpcy5uYW1lLCBtZXNzYWdlLCBodG1sX21lc3NhZ2UpOwogICAgfTsKCiAgICBYbXBwUm9vbS5wcm90b3R5cGUuaW52aXRlID0gZnVuY3Rpb24ocmVjZWl2ZXIsIHJlYXNvbikgewogICAgICByZXR1cm4gdGhpcy5jbGllbnQuaW52aXRlKHRoaXMubmFtZSwgcmVjZWl2ZXIsIHJlYXNvbik7CiAgICB9OwoKICAgIFhtcHBSb29tLnByb3RvdHlwZS5tdWx0aXBsZUludml0ZXMgPSBmdW5jdGlvbihyZWNlaXZlcnMsIHJlYXNvbikgewogICAgICByZXR1cm4gdGhpcy5jbGllbnQuaW52aXRlKHRoaXMubmFtZSwgcmVjZWl2ZXJzLCByZWFzb24pOwogICAgfTsKCiAgICBYbXBwUm9vbS5wcm90b3R5cGUuZGlyZWN0SW52aXRlID0gZnVuY3Rpb24ocmVjZWl2ZXIsIHJlYXNvbikgewogICAgICByZXR1cm4gdGhpcy5jbGllbnQuZGlyZWN0SW52aXRlKHRoaXMubmFtZSwgcmVjZWl2ZXIsIHJlYXNvbiwgdGhpcy5wYXNzd29yZCk7CiAgICB9OwoKICAgIFhtcHBSb29tLnByb3RvdHlwZS5jb25maWd1cmUgPSBmdW5jdGlvbihoYW5kbGVyX2NiKSB7CiAgICAgIHJldHVybiB0aGlzLmNsaWVudC5jb25maWd1cmUodGhpcy5uYW1lLCBoYW5kbGVyX2NiKTsKICAgIH07CgogICAgWG1wcFJvb20ucHJvdG90eXBlLmNhbmNlbENvbmZpZ3VyZSA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gdGhpcy5jbGllbnQuY2FuY2VsQ29uZmlndXJlKHRoaXMubmFtZSk7CiAgICB9OwoKICAgIFhtcHBSb29tLnByb3RvdHlwZS5zYXZlQ29uZmlndXJhdGlvbiA9IGZ1bmN0aW9uKGNvbmZpZykgewogICAgICByZXR1cm4gdGhpcy5jbGllbnQuc2F2ZUNvbmZpZ3VyYXRpb24odGhpcy5uYW1lLCBjb25maWcpOwogICAgfTsKCiAgICBYbXBwUm9vbS5wcm90b3R5cGUucXVlcnlPY2N1cGFudHMgPSBmdW5jdGlvbihzdWNjZXNzX2NiLCBlcnJvcl9jYikgewogICAgICByZXR1cm4gdGhpcy5jbGllbnQucXVlcnlPY2N1cGFudHModGhpcy5uYW1lLCBzdWNjZXNzX2NiLCBlcnJvcl9jYik7CiAgICB9OwoKICAgIFhtcHBSb29tLnByb3RvdHlwZS5zZXRUb3BpYyA9IGZ1bmN0aW9uKHRvcGljKSB7CiAgICAgIHJldHVybiB0aGlzLmNsaWVudC5zZXRUb3BpYyh0aGlzLm5hbWUsIHRvcGljKTsKICAgIH07CgogICAgWG1wcFJvb20ucHJvdG90eXBlLm1vZGlmeVJvbGUgPSBmdW5jdGlvbihuaWNrLCByb2xlLCByZWFzb24sIHN1Y2Nlc3NfY2IsIGVycm9yX2NiKSB7CiAgICAgIHJldHVybiB0aGlzLmNsaWVudC5tb2RpZnlSb2xlKHRoaXMubmFtZSwgbmljaywgcm9sZSwgcmVhc29uLCBzdWNjZXNzX2NiLCBlcnJvcl9jYik7CiAgICB9OwoKICAgIFhtcHBSb29tLnByb3RvdHlwZS5raWNrID0gZnVuY3Rpb24obmljaywgcmVhc29uLCBoYW5kbGVyX2NiLCBlcnJvcl9jYikgewogICAgICByZXR1cm4gdGhpcy5jbGllbnQua2ljayh0aGlzLm5hbWUsIG5pY2ssIHJlYXNvbiwgaGFuZGxlcl9jYiwgZXJyb3JfY2IpOwogICAgfTsKCiAgICBYbXBwUm9vbS5wcm90b3R5cGUudm9pY2UgPSBmdW5jdGlvbihuaWNrLCByZWFzb24sIGhhbmRsZXJfY2IsIGVycm9yX2NiKSB7CiAgICAgIHJldHVybiB0aGlzLmNsaWVudC52b2ljZSh0aGlzLm5hbWUsIG5pY2ssIHJlYXNvbiwgaGFuZGxlcl9jYiwgZXJyb3JfY2IpOwogICAgfTsKCiAgICBYbXBwUm9vbS5wcm90b3R5cGUubXV0ZSA9IGZ1bmN0aW9uKG5pY2ssIHJlYXNvbiwgaGFuZGxlcl9jYiwgZXJyb3JfY2IpIHsKICAgICAgcmV0dXJuIHRoaXMuY2xpZW50Lm11dGUodGhpcy5uYW1lLCBuaWNrLCByZWFzb24sIGhhbmRsZXJfY2IsIGVycm9yX2NiKTsKICAgIH07CgogICAgWG1wcFJvb20ucHJvdG90eXBlLm9wID0gZnVuY3Rpb24obmljaywgcmVhc29uLCBoYW5kbGVyX2NiLCBlcnJvcl9jYikgewogICAgICByZXR1cm4gdGhpcy5jbGllbnQub3AodGhpcy5uYW1lLCBuaWNrLCByZWFzb24sIGhhbmRsZXJfY2IsIGVycm9yX2NiKTsKICAgIH07CgogICAgWG1wcFJvb20ucHJvdG90eXBlLmRlb3AgPSBmdW5jdGlvbihuaWNrLCByZWFzb24sIGhhbmRsZXJfY2IsIGVycm9yX2NiKSB7CiAgICAgIHJldHVybiB0aGlzLmNsaWVudC5kZW9wKHRoaXMubmFtZSwgbmljaywgcmVhc29uLCBoYW5kbGVyX2NiLCBlcnJvcl9jYik7CiAgICB9OwoKICAgIFhtcHBSb29tLnByb3RvdHlwZS5tb2RpZnlBZmZpbGlhdGlvbiA9IGZ1bmN0aW9uKGppZCwgYWZmaWxpYXRpb24sIHJlYXNvbiwgc3VjY2Vzc19jYiwgZXJyb3JfY2IpIHsKICAgICAgcmV0dXJuIHRoaXMuY2xpZW50Lm1vZGlmeUFmZmlsaWF0aW9uKHRoaXMubmFtZSwgamlkLCBhZmZpbGlhdGlvbiwgcmVhc29uLCBzdWNjZXNzX2NiLCBlcnJvcl9jYik7CiAgICB9OwoKICAgIFhtcHBSb29tLnByb3RvdHlwZS5iYW4gPSBmdW5jdGlvbihqaWQsIHJlYXNvbiwgaGFuZGxlcl9jYiwgZXJyb3JfY2IpIHsKICAgICAgcmV0dXJuIHRoaXMuY2xpZW50LmJhbih0aGlzLm5hbWUsIGppZCwgcmVhc29uLCBoYW5kbGVyX2NiLCBlcnJvcl9jYik7CiAgICB9OwoKICAgIFhtcHBSb29tLnByb3RvdHlwZS5tZW1iZXIgPSBmdW5jdGlvbihqaWQsIHJlYXNvbiwgaGFuZGxlcl9jYiwgZXJyb3JfY2IpIHsKICAgICAgcmV0dXJuIHRoaXMuY2xpZW50Lm1lbWJlcih0aGlzLm5hbWUsIGppZCwgcmVhc29uLCBoYW5kbGVyX2NiLCBlcnJvcl9jYik7CiAgICB9OwoKICAgIFhtcHBSb29tLnByb3RvdHlwZS5yZXZva2UgPSBmdW5jdGlvbihqaWQsIHJlYXNvbiwgaGFuZGxlcl9jYiwgZXJyb3JfY2IpIHsKICAgICAgcmV0dXJuIHRoaXMuY2xpZW50LnJldm9rZSh0aGlzLm5hbWUsIGppZCwgcmVhc29uLCBoYW5kbGVyX2NiLCBlcnJvcl9jYik7CiAgICB9OwoKICAgIFhtcHBSb29tLnByb3RvdHlwZS5vd25lciA9IGZ1bmN0aW9uKGppZCwgcmVhc29uLCBoYW5kbGVyX2NiLCBlcnJvcl9jYikgewogICAgICByZXR1cm4gdGhpcy5jbGllbnQub3duZXIodGhpcy5uYW1lLCBqaWQsIHJlYXNvbiwgaGFuZGxlcl9jYiwgZXJyb3JfY2IpOwogICAgfTsKCiAgICBYbXBwUm9vbS5wcm90b3R5cGUuYWRtaW4gPSBmdW5jdGlvbihqaWQsIHJlYXNvbiwgaGFuZGxlcl9jYiwgZXJyb3JfY2IpIHsKICAgICAgcmV0dXJuIHRoaXMuY2xpZW50LmFkbWluKHRoaXMubmFtZSwgamlkLCByZWFzb24sIGhhbmRsZXJfY2IsIGVycm9yX2NiKTsKICAgIH07CgogICAgWG1wcFJvb20ucHJvdG90eXBlLmNoYW5nZU5pY2sgPSBmdW5jdGlvbihuaWNrKSB7CiAgICAgIHRoaXMubmljayA9IG5pY2s7CiAgICAgIHJldHVybiB0aGlzLmNsaWVudC5jaGFuZ2VOaWNrKHRoaXMubmFtZSwgbmljayk7CiAgICB9OwoKICAgIFhtcHBSb29tLnByb3RvdHlwZS5zZXRTdGF0dXMgPSBmdW5jdGlvbihzaG93LCBzdGF0dXMpIHsKICAgICAgcmV0dXJuIHRoaXMuY2xpZW50LnNldFN0YXR1cyh0aGlzLm5hbWUsIHRoaXMubmljaywgc2hvdywgc3RhdHVzKTsKICAgIH07CgoKICAgIC8qRnVuY3Rpb24KICAgIEFkZHMgYSBoYW5kbGVyIHRvIHRoZSBNVUMgcm9vbS4KICAgICAgUGFyYW1ldGVyczoKICAgIChTdHJpbmcpIGhhbmRsZXJfdHlwZSAtICdtZXNzYWdlJywgJ3ByZXNlbmNlJyBvciAncm9zdGVyJy4KICAgIChGdW5jdGlvbikgaGFuZGxlciAtIFRoZSBoYW5kbGVyIGZ1bmN0aW9uLgogICAgUmV0dXJuczoKICAgIGlkIC0gdGhlIGlkIG9mIGhhbmRsZXIuCiAgICAgKi8KCiAgICBYbXBwUm9vbS5wcm90b3R5cGUuYWRkSGFuZGxlciA9IGZ1bmN0aW9uKGhhbmRsZXJfdHlwZSwgaGFuZGxlcikgewogICAgICB2YXIgaWQ7CiAgICAgIGlkID0gdGhpcy5faGFuZGxlcl9pZHMrKzsKICAgICAgc3dpdGNoIChoYW5kbGVyX3R5cGUpIHsKICAgICAgICBjYXNlICdwcmVzZW5jZSc6CiAgICAgICAgICB0aGlzLl9wcmVzZW5jZV9oYW5kbGVyc1tpZF0gPSBoYW5kbGVyOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAnbWVzc2FnZSc6CiAgICAgICAgICB0aGlzLl9tZXNzYWdlX2hhbmRsZXJzW2lkXSA9IGhhbmRsZXI7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICdyb3N0ZXInOgogICAgICAgICAgdGhpcy5fcm9zdGVyX2hhbmRsZXJzW2lkXSA9IGhhbmRsZXI7CiAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgdGhpcy5faGFuZGxlcl9pZHMtLTsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIHJldHVybiBpZDsKICAgIH07CgoKICAgIC8qRnVuY3Rpb24KICAgIFJlbW92ZXMgYSBoYW5kbGVyIGZyb20gdGhlIE1VQyByb29tLgogICAgVGhpcyBmdW5jdGlvbiB0YWtlcyBPTkxZIGlkcyByZXR1cm5lZCBieSB0aGUgYWRkSGFuZGxlciBmdW5jdGlvbgogICAgb2YgdGhpcyByb29tLiBwYXNzaW5nIGhhbmRsZXIgaWRzIHJldHVybmVkIGJ5IGNvbm5lY3Rpb24uYWRkSGFuZGxlcgogICAgbWF5IGJyYWtlIHRoaW5ncyEKICAgICAgUGFyYW1ldGVyczoKICAgIChudW1iZXIpIGlkIC0gdGhlIGlkIG9mIHRoZSBoYW5kbGVyCiAgICAgKi8KCiAgICBYbXBwUm9vbS5wcm90b3R5cGUucmVtb3ZlSGFuZGxlciA9IGZ1bmN0aW9uKGlkKSB7CiAgICAgIGRlbGV0ZSB0aGlzLl9wcmVzZW5jZV9oYW5kbGVyc1tpZF07CiAgICAgIGRlbGV0ZSB0aGlzLl9tZXNzYWdlX2hhbmRsZXJzW2lkXTsKICAgICAgcmV0dXJuIGRlbGV0ZSB0aGlzLl9yb3N0ZXJfaGFuZGxlcnNbaWRdOwogICAgfTsKCgogICAgLypGdW5jdGlvbgogICAgQ3JlYXRlcyBhbmQgYWRkcyBhbiBPY2N1cGFudCB0byB0aGUgUm9vbSBSb3N0ZXIuCiAgICAgIFBhcmFtZXRlcnM6CiAgICAoT2JqZWN0KSBkYXRhIC0gdGhlIGRhdGEgdGhlIE9jY3VwYW50IGlzIGZpbGxlZCB3aXRoCiAgICBSZXR1cm5zOgogICAgb2NjIC0gdGhlIGNyZWF0ZWQgT2NjdXBhbnQuCiAgICAgKi8KCiAgICBYbXBwUm9vbS5wcm90b3R5cGUuX2FkZE9jY3VwYW50ID0gZnVuY3Rpb24oZGF0YSkgewogICAgICB2YXIgb2NjOwogICAgICBvY2MgPSBuZXcgT2NjdXBhbnQoZGF0YSwgdGhpcyk7CiAgICAgIHRoaXMucm9zdGVyW29jYy5uaWNrXSA9IG9jYzsKICAgICAgcmV0dXJuIG9jYzsKICAgIH07CgoKICAgIC8qRnVuY3Rpb24KICAgIFRoZSBzdGFuZGFyZCBoYW5kbGVyIHRoYXQgbWFuYWdlZCB0aGUgUm9vbSBSb3N0ZXIuCiAgICAgIFBhcmFtZXRlcnM6CiAgICAoT2JqZWN0KSBwcmVzIC0gdGhlIHByZXNlbmNlIHN0YW56YSBjb250YWluaW5nIHVzZXIgaW5mb3JtYXRpb24KICAgICAqLwoKICAgIFhtcHBSb29tLnByb3RvdHlwZS5fcm9vbVJvc3RlckhhbmRsZXIgPSBmdW5jdGlvbihwcmVzKSB7CiAgICAgIHZhciBkYXRhLCBoYW5kbGVyLCBpZCwgbmV3bmljaywgbmljaywgX3JlZjsKICAgICAgZGF0YSA9IFhtcHBSb29tLl9wYXJzZVByZXNlbmNlKHByZXMpOwogICAgICBuaWNrID0gZGF0YS5uaWNrOwogICAgICBuZXduaWNrID0gZGF0YS5uZXduaWNrIHx8IG51bGw7CiAgICAgIHN3aXRjaCAoZGF0YS50eXBlKSB7CiAgICAgICAgY2FzZSAnZXJyb3InOgogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgY2FzZSAndW5hdmFpbGFibGUnOgogICAgICAgICAgaWYgKG5ld25pY2spIHsKICAgICAgICAgICAgZGF0YS5uaWNrID0gbmV3bmljazsKICAgICAgICAgICAgaWYgKHRoaXMucm9zdGVyW25pY2tdICYmIHRoaXMucm9zdGVyW25ld25pY2tdKSB7CiAgICAgICAgICAgICAgdGhpcy5yb3N0ZXJbbmlja10udXBkYXRlKHRoaXMucm9zdGVyW25ld25pY2tdKTsKICAgICAgICAgICAgICB0aGlzLnJvc3RlcltuZXduaWNrXSA9IHRoaXMucm9zdGVyW25pY2tdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLnJvc3RlcltuaWNrXSAmJiAhdGhpcy5yb3N0ZXJbbmV3bmlja10pIHsKICAgICAgICAgICAgICB0aGlzLnJvc3RlcltuZXduaWNrXSA9IHRoaXMucm9zdGVyW25pY2tdLnVwZGF0ZShkYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgZGVsZXRlIHRoaXMucm9zdGVyW25pY2tdOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIGlmICh0aGlzLnJvc3RlcltuaWNrXSkgewogICAgICAgICAgICB0aGlzLnJvc3RlcltuaWNrXS51cGRhdGUoZGF0YSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLl9hZGRPY2N1cGFudChkYXRhKTsKICAgICAgICAgIH0KICAgICAgfQogICAgICBfcmVmID0gdGhpcy5fcm9zdGVyX2hhbmRsZXJzOwogICAgICBmb3IgKGlkIGluIF9yZWYpIHsKICAgICAgICBoYW5kbGVyID0gX3JlZltpZF07CiAgICAgICAgaWYgKCFoYW5kbGVyKHRoaXMucm9zdGVyLCB0aGlzKSkgewogICAgICAgICAgZGVsZXRlIHRoaXMuX3Jvc3Rlcl9oYW5kbGVyc1tpZF07CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiB0cnVlOwogICAgfTsKCgogICAgLypGdW5jdGlvbgogICAgUGFyc2VzIGEgcHJlc2VuY2Ugc3RhbnphCiAgICAgIFBhcmFtZXRlcnM6CiAgICAoT2JqZWN0KSBkYXRhIC0gdGhlIGRhdGEgZXh0cmFjdGVkIGZyb20gdGhlIHByZXNlbmNlIHN0YW56YQogICAgICovCgogICAgWG1wcFJvb20uX3BhcnNlUHJlc2VuY2UgPSBmdW5jdGlvbihwcmVzKSB7CiAgICAgIHZhciBjLCBjMiwgZGF0YSwgX2ksIF9qLCBfbGVuLCBfbGVuMSwgX3JlZiwgX3JlZjE7CiAgICAgIGRhdGEgPSB7fTsKICAgICAgZGF0YS5uaWNrID0gU3Ryb3BoZS5nZXRSZXNvdXJjZUZyb21KaWQocHJlcy5nZXRBdHRyaWJ1dGUoImZyb20iKSk7CiAgICAgIGRhdGEudHlwZSA9IHByZXMuZ2V0QXR0cmlidXRlKCJ0eXBlIik7CiAgICAgIGRhdGEuc3RhdGVzID0gW107CiAgICAgIF9yZWYgPSBwcmVzLmNoaWxkTm9kZXM7CiAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gX3JlZi5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykgewogICAgICAgIGMgPSBfcmVmW19pXTsKICAgICAgICBzd2l0Y2ggKGMubm9kZU5hbWUpIHsKICAgICAgICAgIGNhc2UgInN0YXR1cyI6CiAgICAgICAgICAgIGRhdGEuc3RhdHVzID0gYy50ZXh0Q29udGVudCB8fCBudWxsOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgInNob3ciOgogICAgICAgICAgICBkYXRhLnNob3cgPSBjLnRleHRDb250ZW50IHx8IG51bGw7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAieCI6CiAgICAgICAgICAgIGlmIChjLmdldEF0dHJpYnV0ZSgieG1sbnMiKSA9PT0gU3Ryb3BoZS5OUy5NVUNfVVNFUikgewogICAgICAgICAgICAgIF9yZWYxID0gYy5jaGlsZE5vZGVzOwogICAgICAgICAgICAgIGZvciAoX2ogPSAwLCBfbGVuMSA9IF9yZWYxLmxlbmd0aDsgX2ogPCBfbGVuMTsgX2orKykgewogICAgICAgICAgICAgICAgYzIgPSBfcmVmMVtfal07CiAgICAgICAgICAgICAgICBzd2l0Y2ggKGMyLm5vZGVOYW1lKSB7CiAgICAgICAgICAgICAgICAgIGNhc2UgIml0ZW0iOgogICAgICAgICAgICAgICAgICAgIGRhdGEuYWZmaWxpYXRpb24gPSBjMi5nZXRBdHRyaWJ1dGUoImFmZmlsaWF0aW9uIik7CiAgICAgICAgICAgICAgICAgICAgZGF0YS5yb2xlID0gYzIuZ2V0QXR0cmlidXRlKCJyb2xlIik7CiAgICAgICAgICAgICAgICAgICAgZGF0YS5qaWQgPSBjMi5nZXRBdHRyaWJ1dGUoImppZCIpOwogICAgICAgICAgICAgICAgICAgIGRhdGEubmV3bmljayA9IGMyLmdldEF0dHJpYnV0ZSgibmljayIpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICBjYXNlICJzdGF0dXMiOgogICAgICAgICAgICAgICAgICAgIGlmIChjMi5nZXRBdHRyaWJ1dGUoImNvZGUiKSkgewogICAgICAgICAgICAgICAgICAgICAgZGF0YS5zdGF0ZXMucHVzaChjMi5nZXRBdHRyaWJ1dGUoImNvZGUiKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gZGF0YTsKICAgIH07CgogICAgcmV0dXJuIFhtcHBSb29tOwoKICB9KSgpOwoKICBSb29tQ29uZmlnID0gKGZ1bmN0aW9uKCkgewogICAgZnVuY3Rpb24gUm9vbUNvbmZpZyhpbmZvKSB7CiAgICAgIHRoaXMucGFyc2UgPSBfX2JpbmQodGhpcy5wYXJzZSwgdGhpcyk7CiAgICAgIGlmIChpbmZvICE9IG51bGwpIHsKICAgICAgICB0aGlzLnBhcnNlKGluZm8pOwogICAgICB9CiAgICB9CgogICAgUm9vbUNvbmZpZy5wcm90b3R5cGUucGFyc2UgPSBmdW5jdGlvbihyZXN1bHQpIHsKICAgICAgdmFyIGF0dHIsIGF0dHJzLCBjaGlsZCwgZmllbGQsIGlkZW50aXR5LCBxdWVyeSwgX2ksIF9qLCBfaywgX2xlbiwgX2xlbjEsIF9sZW4yLCBfcmVmOwogICAgICBxdWVyeSA9IHJlc3VsdC5nZXRFbGVtZW50c0J5VGFnTmFtZSgicXVlcnkiKVswXS5jaGlsZE5vZGVzOwogICAgICB0aGlzLmlkZW50aXRpZXMgPSBbXTsKICAgICAgdGhpcy5mZWF0dXJlcyA9IFtdOwogICAgICB0aGlzLnggPSBbXTsKICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSBxdWVyeS5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykgewogICAgICAgIGNoaWxkID0gcXVlcnlbX2ldOwogICAgICAgIGF0dHJzID0gY2hpbGQuYXR0cmlidXRlczsKICAgICAgICBzd2l0Y2ggKGNoaWxkLm5vZGVOYW1lKSB7CiAgICAgICAgICBjYXNlICJpZGVudGl0eSI6CiAgICAgICAgICAgIGlkZW50aXR5ID0ge307CiAgICAgICAgICAgIGZvciAoX2ogPSAwLCBfbGVuMSA9IGF0dHJzLmxlbmd0aDsgX2ogPCBfbGVuMTsgX2orKykgewogICAgICAgICAgICAgIGF0dHIgPSBhdHRyc1tfal07CiAgICAgICAgICAgICAgaWRlbnRpdHlbYXR0ci5uYW1lXSA9IGF0dHIudGV4dENvbnRlbnQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5pZGVudGl0aWVzLnB1c2goaWRlbnRpdHkpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgImZlYXR1cmUiOgogICAgICAgICAgICB0aGlzLmZlYXR1cmVzLnB1c2goY2hpbGQuZ2V0QXR0cmlidXRlKCJ2YXIiKSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAieCI6CiAgICAgICAgICAgIGlmICgoIWNoaWxkLmNoaWxkTm9kZXNbMF0uZ2V0QXR0cmlidXRlKCJ2YXIiKSA9PT0gJ0ZPUk1fVFlQRScpIHx8ICghY2hpbGQuY2hpbGROb2Rlc1swXS5nZXRBdHRyaWJ1dGUoInR5cGUiKSA9PT0gJ2hpZGRlbicpKSB7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX3JlZiA9IGNoaWxkLmNoaWxkTm9kZXM7CiAgICAgICAgICAgIGZvciAoX2sgPSAwLCBfbGVuMiA9IF9yZWYubGVuZ3RoOyBfayA8IF9sZW4yOyBfaysrKSB7CiAgICAgICAgICAgICAgZmllbGQgPSBfcmVmW19rXTsKICAgICAgICAgICAgICBpZiAoIWZpZWxkLmF0dHJpYnV0ZXMudHlwZSkgewogICAgICAgICAgICAgICAgdGhpcy54LnB1c2goewogICAgICAgICAgICAgICAgICAidmFyIjogZmllbGQuZ2V0QXR0cmlidXRlKCJ2YXIiKSwKICAgICAgICAgICAgICAgICAgbGFiZWw6IGZpZWxkLmdldEF0dHJpYnV0ZSgibGFiZWwiKSB8fCAiIiwKICAgICAgICAgICAgICAgICAgdmFsdWU6IGZpZWxkLmZpcnN0Q2hpbGQudGV4dENvbnRlbnQgfHwgIiIKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gewogICAgICAgICJpZGVudGl0aWVzIjogdGhpcy5pZGVudGl0aWVzLAogICAgICAgICJmZWF0dXJlcyI6IHRoaXMuZmVhdHVyZXMsCiAgICAgICAgIngiOiB0aGlzLngKICAgICAgfTsKICAgIH07CgogICAgcmV0dXJuIFJvb21Db25maWc7CgogIH0pKCk7CgogIE9jY3VwYW50ID0gKGZ1bmN0aW9uKCkgewogICAgZnVuY3Rpb24gT2NjdXBhbnQoZGF0YSwgcm9vbSkgewogICAgICB0aGlzLnJvb20gPSByb29tOwogICAgICB0aGlzLnVwZGF0ZSA9IF9fYmluZCh0aGlzLnVwZGF0ZSwgdGhpcyk7CiAgICAgIHRoaXMuYWRtaW4gPSBfX2JpbmQodGhpcy5hZG1pbiwgdGhpcyk7CiAgICAgIHRoaXMub3duZXIgPSBfX2JpbmQodGhpcy5vd25lciwgdGhpcyk7CiAgICAgIHRoaXMucmV2b2tlID0gX19iaW5kKHRoaXMucmV2b2tlLCB0aGlzKTsKICAgICAgdGhpcy5tZW1iZXIgPSBfX2JpbmQodGhpcy5tZW1iZXIsIHRoaXMpOwogICAgICB0aGlzLmJhbiA9IF9fYmluZCh0aGlzLmJhbiwgdGhpcyk7CiAgICAgIHRoaXMubW9kaWZ5QWZmaWxpYXRpb24gPSBfX2JpbmQodGhpcy5tb2RpZnlBZmZpbGlhdGlvbiwgdGhpcyk7CiAgICAgIHRoaXMuZGVvcCA9IF9fYmluZCh0aGlzLmRlb3AsIHRoaXMpOwogICAgICB0aGlzLm9wID0gX19iaW5kKHRoaXMub3AsIHRoaXMpOwogICAgICB0aGlzLm11dGUgPSBfX2JpbmQodGhpcy5tdXRlLCB0aGlzKTsKICAgICAgdGhpcy52b2ljZSA9IF9fYmluZCh0aGlzLnZvaWNlLCB0aGlzKTsKICAgICAgdGhpcy5raWNrID0gX19iaW5kKHRoaXMua2ljaywgdGhpcyk7CiAgICAgIHRoaXMubW9kaWZ5Um9sZSA9IF9fYmluZCh0aGlzLm1vZGlmeVJvbGUsIHRoaXMpOwogICAgICB0aGlzLnVwZGF0ZShkYXRhKTsKICAgIH0KCiAgICBPY2N1cGFudC5wcm90b3R5cGUubW9kaWZ5Um9sZSA9IGZ1bmN0aW9uKHJvbGUsIHJlYXNvbiwgc3VjY2Vzc19jYiwgZXJyb3JfY2IpIHsKICAgICAgcmV0dXJuIHRoaXMucm9vbS5tb2RpZnlSb2xlKHRoaXMubmljaywgcm9sZSwgcmVhc29uLCBzdWNjZXNzX2NiLCBlcnJvcl9jYik7CiAgICB9OwoKICAgIE9jY3VwYW50LnByb3RvdHlwZS5raWNrID0gZnVuY3Rpb24ocmVhc29uLCBoYW5kbGVyX2NiLCBlcnJvcl9jYikgewogICAgICByZXR1cm4gdGhpcy5yb29tLmtpY2sodGhpcy5uaWNrLCByZWFzb24sIGhhbmRsZXJfY2IsIGVycm9yX2NiKTsKICAgIH07CgogICAgT2NjdXBhbnQucHJvdG90eXBlLnZvaWNlID0gZnVuY3Rpb24ocmVhc29uLCBoYW5kbGVyX2NiLCBlcnJvcl9jYikgewogICAgICByZXR1cm4gdGhpcy5yb29tLnZvaWNlKHRoaXMubmljaywgcmVhc29uLCBoYW5kbGVyX2NiLCBlcnJvcl9jYik7CiAgICB9OwoKICAgIE9jY3VwYW50LnByb3RvdHlwZS5tdXRlID0gZnVuY3Rpb24ocmVhc29uLCBoYW5kbGVyX2NiLCBlcnJvcl9jYikgewogICAgICByZXR1cm4gdGhpcy5yb29tLm11dGUodGhpcy5uaWNrLCByZWFzb24sIGhhbmRsZXJfY2IsIGVycm9yX2NiKTsKICAgIH07CgogICAgT2NjdXBhbnQucHJvdG90eXBlLm9wID0gZnVuY3Rpb24ocmVhc29uLCBoYW5kbGVyX2NiLCBlcnJvcl9jYikgewogICAgICByZXR1cm4gdGhpcy5yb29tLm9wKHRoaXMubmljaywgcmVhc29uLCBoYW5kbGVyX2NiLCBlcnJvcl9jYik7CiAgICB9OwoKICAgIE9jY3VwYW50LnByb3RvdHlwZS5kZW9wID0gZnVuY3Rpb24ocmVhc29uLCBoYW5kbGVyX2NiLCBlcnJvcl9jYikgewogICAgICByZXR1cm4gdGhpcy5yb29tLmRlb3AodGhpcy5uaWNrLCByZWFzb24sIGhhbmRsZXJfY2IsIGVycm9yX2NiKTsKICAgIH07CgogICAgT2NjdXBhbnQucHJvdG90eXBlLm1vZGlmeUFmZmlsaWF0aW9uID0gZnVuY3Rpb24oYWZmaWxpYXRpb24sIHJlYXNvbiwgc3VjY2Vzc19jYiwgZXJyb3JfY2IpIHsKICAgICAgcmV0dXJuIHRoaXMucm9vbS5tb2RpZnlBZmZpbGlhdGlvbih0aGlzLmppZCwgYWZmaWxpYXRpb24sIHJlYXNvbiwgc3VjY2Vzc19jYiwgZXJyb3JfY2IpOwogICAgfTsKCiAgICBPY2N1cGFudC5wcm90b3R5cGUuYmFuID0gZnVuY3Rpb24ocmVhc29uLCBoYW5kbGVyX2NiLCBlcnJvcl9jYikgewogICAgICByZXR1cm4gdGhpcy5yb29tLmJhbih0aGlzLmppZCwgcmVhc29uLCBoYW5kbGVyX2NiLCBlcnJvcl9jYik7CiAgICB9OwoKICAgIE9jY3VwYW50LnByb3RvdHlwZS5tZW1iZXIgPSBmdW5jdGlvbihyZWFzb24sIGhhbmRsZXJfY2IsIGVycm9yX2NiKSB7CiAgICAgIHJldHVybiB0aGlzLnJvb20ubWVtYmVyKHRoaXMuamlkLCByZWFzb24sIGhhbmRsZXJfY2IsIGVycm9yX2NiKTsKICAgIH07CgogICAgT2NjdXBhbnQucHJvdG90eXBlLnJldm9rZSA9IGZ1bmN0aW9uKHJlYXNvbiwgaGFuZGxlcl9jYiwgZXJyb3JfY2IpIHsKICAgICAgcmV0dXJuIHRoaXMucm9vbS5yZXZva2UodGhpcy5qaWQsIHJlYXNvbiwgaGFuZGxlcl9jYiwgZXJyb3JfY2IpOwogICAgfTsKCiAgICBPY2N1cGFudC5wcm90b3R5cGUub3duZXIgPSBmdW5jdGlvbihyZWFzb24sIGhhbmRsZXJfY2IsIGVycm9yX2NiKSB7CiAgICAgIHJldHVybiB0aGlzLnJvb20ub3duZXIodGhpcy5qaWQsIHJlYXNvbiwgaGFuZGxlcl9jYiwgZXJyb3JfY2IpOwogICAgfTsKCiAgICBPY2N1cGFudC5wcm90b3R5cGUuYWRtaW4gPSBmdW5jdGlvbihyZWFzb24sIGhhbmRsZXJfY2IsIGVycm9yX2NiKSB7CiAgICAgIHJldHVybiB0aGlzLnJvb20uYWRtaW4odGhpcy5qaWQsIHJlYXNvbiwgaGFuZGxlcl9jYiwgZXJyb3JfY2IpOwogICAgfTsKCiAgICBPY2N1cGFudC5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24oZGF0YSkgewogICAgICB0aGlzLm5pY2sgPSBkYXRhLm5pY2sgfHwgbnVsbDsKICAgICAgdGhpcy5hZmZpbGlhdGlvbiA9IGRhdGEuYWZmaWxpYXRpb24gfHwgbnVsbDsKICAgICAgdGhpcy5yb2xlID0gZGF0YS5yb2xlIHx8IG51bGw7CiAgICAgIHRoaXMuamlkID0gZGF0YS5qaWQgfHwgbnVsbDsKICAgICAgdGhpcy5zdGF0dXMgPSBkYXRhLnN0YXR1cyB8fCBudWxsOwogICAgICB0aGlzLnNob3cgPSBkYXRhLnNob3cgfHwgbnVsbDsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9OwoKICAgIHJldHVybiBPY2N1cGFudDsKCiAgfSkoKTsKCn0pLmNhbGwodGhpcyk7CgpkZWZpbmUoInN0cm9waGUubXVjIiwgWyJzdHJvcGhlIl0sIGZ1bmN0aW9uKCl7fSk7CgovKgogIENvcHlyaWdodCAyMDEwLCBGcmFuw6dvaXMgZGUgTWV0eiA8ZnJhbmNvaXNAMm1ldHouZnI+CiovCi8qKgogKiBSb3N0ZXIgUGx1Z2luCiAqIEFsbG93IGVhc2lseSByb3N0ZXIgbWFuYWdlbWVudAogKgogKiAgRmVhdHVyZXMKICogICogR2V0IHJvc3RlciBmcm9tIHNlcnZlcgogKiAgKiBoYW5kbGUgcHJlc2VuY2UKICogICogaGFuZGxlIHJvc3RlciBpcQogKiAgKiBzdWJzY3JpYmUvdW5zdWJzY3JpYmUKICogICogYXV0aG9yaXplL3VuYXV0aG9yaXplCiAqICAqIHJvc3RlciB2ZXJzaW9uaW5nICh4ZXAgMjM3KQogKi8KU3Ryb3BoZS5hZGRDb25uZWN0aW9uUGx1Z2luKCdyb3N0ZXInLAp7CiAgICAvKiogRnVuY3Rpb246IGluaXQKICAgICAqIFBsdWdpbiBpbml0CiAgICAgKgogICAgICogUGFyYW1ldGVyczoKICAgICAqICAgKFN0cm9waGUuQ29ubmVjdGlvbikgY29ubiAtIFN0cm9waGUgY29ubmVjdGlvbgogICAgICovCiAgICBpbml0OiBmdW5jdGlvbihjb25uKQogICAgewogICAgICAgIHRoaXMuX2Nvbm5lY3Rpb24gPSBjb25uOwogICAgICAgIHRoaXMuX2NhbGxiYWNrcyA9IFtdOwogICAgICAgIC8qKiBQcm9wZXJ0eTogaXRlbXMKICAgICAgICAgKiAgUm9zdGVyIGl0ZW1zCiAgICAgICAgICogIFsKICAgICAgICAgKiAgICB7CiAgICAgICAgICogICAgICAgIG5hbWUgICAgICAgICA6ICIiLAogICAgICAgICAqICAgICAgICBqaWQgICAgICAgICAgOiAiIiwKICAgICAgICAgKiAgICAgICAgc3Vic2NyaXB0aW9uIDogIiIsCiAgICAgICAgICogICAgICAgIGFzayAgICAgICAgICA6ICIiLAogICAgICAgICAqICAgICAgICBncm91cHMgICAgICAgOiBbIiIsICIiXSwKICAgICAgICAgKiAgICAgICAgcmVzb3VyY2VzICAgIDogewogICAgICAgICAqICAgICAgICAgICAgbXlyZXNvdXJjZSA6IHsKICAgICAgICAgKiAgICAgICAgICAgICAgICBzaG93ICAgOiAiIiwKICAgICAgICAgKiAgICAgICAgICAgICAgICBzdGF0dXMgOiAiIiwKICAgICAgICAgKiAgICAgICAgICAgICAgICBwcmlvcml0eSA6ICIiCiAgICAgICAgICogICAgICAgICAgICB9CiAgICAgICAgICogICAgICAgIH0KICAgICAgICAgKiAgICB9CiAgICAgICAgICogXQogICAgICAgICAqLwogICAgICAgIHRoaXMuaXRlbXMgPSBbXTsKICAgICAgICAvKiogUHJvcGVydHk6IHZlcgogICAgICAgICogY3VycmVudCByb3N0ZXIgcmV2aXNpb24KICAgICAgICAqIGFsd2F5cyBudWxsIGlmIHNlcnZlciBkb2Vzbid0IHN1cHBvcnQgeGVwIDIzNwogICAgICAgICovCiAgICAgICAgdGhpcy52ZXIgPSBudWxsOwogICAgICAgIC8vIE92ZXJyaWRlIHRoZSBjb25uZWN0IGFuZCBhdHRhY2ggbWV0aG9kcyB0byBhbHdheXMgYWRkIHByZXNlbmNlIGFuZCByb3N0ZXIgaGFuZGxlcnMuCiAgICAgICAgLy8gVGhleSBhcmUgcmVtb3ZlZCB3aGVuIHRoZSBjb25uZWN0aW9uIGRpc2Nvbm5lY3RzLCBzbyBtdXN0IGJlIGFkZGVkIG9uIGNvbm5lY3Rpb24uCiAgICAgICAgdmFyIG9sZENhbGxiYWNrLCByb3N0ZXIgPSB0aGlzLCBfY29ubmVjdCA9IGNvbm4uY29ubmVjdCwgX2F0dGFjaCA9IGNvbm4uYXR0YWNoOwogICAgICAgIHZhciBuZXdDYWxsYmFjayA9IGZ1bmN0aW9uKHN0YXR1cykKICAgICAgICB7CiAgICAgICAgICAgIGlmIChzdGF0dXMgPT0gU3Ryb3BoZS5TdGF0dXMuQVRUQUNIRUQgfHwgc3RhdHVzID09IFN0cm9waGUuU3RhdHVzLkNPTk5FQ1RFRCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdHJ5CiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgLy8gUHJlc2VuY2Ugc3Vic2NyaXB0aW9uCiAgICAgICAgICAgICAgICAgICAgY29ubi5hZGRIYW5kbGVyKHJvc3Rlci5fb25SZWNlaXZlUHJlc2VuY2UuYmluZChyb3N0ZXIpLCBudWxsLCAncHJlc2VuY2UnLCBudWxsLCBudWxsLCBudWxsKTsKICAgICAgICAgICAgICAgICAgICBjb25uLmFkZEhhbmRsZXIocm9zdGVyLl9vblJlY2VpdmVJUS5iaW5kKHJvc3RlciksIFN0cm9waGUuTlMuUk9TVEVSLCAnaXEnLCAic2V0IiwgbnVsbCwgbnVsbCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYXRjaCAoZSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBTdHJvcGhlLmVycm9yKGUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0eXBlb2Ygb2xkQ2FsbGJhY2sgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgICAgIG9sZENhbGxiYWNrLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIGNvbm4uY29ubmVjdCA9IGZ1bmN0aW9uKGppZCwgcGFzcywgY2FsbGJhY2ssIHdhaXQsIGhvbGQpCiAgICAgICAgewogICAgICAgICAgICBvbGRDYWxsYmFjayA9IGNhbGxiYWNrOwogICAgICAgICAgICBpZiAodHlwZW9mIGppZCAgPT0gInVuZGVmaW5lZCIpCiAgICAgICAgICAgICAgICBqaWQgID0gbnVsbDsKICAgICAgICAgICAgaWYgKHR5cGVvZiBwYXNzID09ICJ1bmRlZmluZWQiKQogICAgICAgICAgICAgICAgcGFzcyA9IG51bGw7CiAgICAgICAgICAgIGNhbGxiYWNrID0gbmV3Q2FsbGJhY2s7CiAgICAgICAgICAgIF9jb25uZWN0LmFwcGx5KGNvbm4sIFtqaWQsIHBhc3MsIGNhbGxiYWNrLCB3YWl0LCBob2xkXSk7CiAgICAgICAgfTsKICAgICAgICBjb25uLmF0dGFjaCA9IGZ1bmN0aW9uKGppZCwgc2lkLCByaWQsIGNhbGxiYWNrLCB3YWl0LCBob2xkLCB3aW5kKQogICAgICAgIHsKICAgICAgICAgICAgb2xkQ2FsbGJhY2sgPSBjYWxsYmFjazsKICAgICAgICAgICAgaWYgKHR5cGVvZiBqaWQgPT0gInVuZGVmaW5lZCIpCiAgICAgICAgICAgICAgICBqaWQgPSBudWxsOwogICAgICAgICAgICBpZiAodHlwZW9mIHNpZCA9PSAidW5kZWZpbmVkIikKICAgICAgICAgICAgICAgIHNpZCA9IG51bGw7CiAgICAgICAgICAgIGlmICh0eXBlb2YgcmlkID09ICJ1bmRlZmluZWQiKQogICAgICAgICAgICAgICAgcmlkID0gbnVsbDsKICAgICAgICAgICAgY2FsbGJhY2sgPSBuZXdDYWxsYmFjazsKICAgICAgICAgICAgX2F0dGFjaC5hcHBseShjb25uLCBbamlkLCBzaWQsIHJpZCwgY2FsbGJhY2ssIHdhaXQsIGhvbGQsIHdpbmRdKTsKICAgICAgICB9OwoKICAgICAgICBTdHJvcGhlLmFkZE5hbWVzcGFjZSgnUk9TVEVSX1ZFUicsICd1cm46eG1wcDpmZWF0dXJlczpyb3N0ZXJ2ZXInKTsKICAgICAgICBTdHJvcGhlLmFkZE5hbWVzcGFjZSgnTklDSycsICdodHRwOi8vamFiYmVyLm9yZy9wcm90b2NvbC9uaWNrJyk7CiAgICB9LAogICAgLyoqIEZ1bmN0aW9uOiBzdXBwb3J0VmVyc2lvbmluZwogICAgICogcmV0dXJuIHRydWUgaWYgcm9zdGVyIHZlcnNpb25pbmcgaXMgZW5hYmxlZCBvbiBzZXJ2ZXIKICAgICAqLwogICAgc3VwcG9ydFZlcnNpb25pbmc6IGZ1bmN0aW9uKCkKICAgIHsKICAgICAgICByZXR1cm4gKHRoaXMuX2Nvbm5lY3Rpb24uZmVhdHVyZXMgJiYgdGhpcy5fY29ubmVjdGlvbi5mZWF0dXJlcy5nZXRFbGVtZW50c0J5VGFnTmFtZSgndmVyJykubGVuZ3RoID4gMCk7CiAgICB9LAogICAgLyoqIEZ1bmN0aW9uOiBnZXQKICAgICAqIEdldCBSb3N0ZXIgb24gc2VydmVyCiAgICAgKgogICAgICogUGFyYW1ldGVyczoKICAgICAqICAgKEZ1bmN0aW9uKSB1c2VyQ2FsbGJhY2sgLSBjYWxsYmFjayBvbiByb3N0ZXIgcmVzdWx0CiAgICAgKiAgIChTdHJpbmcpIHZlciAtIGN1cnJlbnQgcmV2IG9mIHJvc3RlcgogICAgICogICAgICAob25seSB1c2VkIGlmIHJvc3RlciB2ZXJzaW9uaW5nIGlzIGVuYWJsZWQpCiAgICAgKiAgIChBcnJheSkgaXRlbXMgLSBpbml0aWFsIGl0ZW1zIG9mIHZlcgogICAgICogICAgICAob25seSB1c2VkIGlmIHJvc3RlciB2ZXJzaW9uaW5nIGlzIGVuYWJsZWQpCiAgICAgKiAgICAgSW4gYnJvd3NlciBjb250ZXh0IHlvdSBjYW4gdXNlIHNlc3Npb25TdG9yYWdlCiAgICAgKiAgICAgdG8gc3RvcmUgeW91ciByb3N0ZXIgaW4ganNvbiAoSlNPTi5zdHJpbmdpZnkoKSkKICAgICAqLwogICAgZ2V0OiBmdW5jdGlvbih1c2VyQ2FsbGJhY2ssIHZlciwgaXRlbXMpCiAgICB7CiAgICAgICAgdmFyIGF0dHJzID0ge3htbG5zOiBTdHJvcGhlLk5TLlJPU1RFUn07CiAgICAgICAgaWYgKHRoaXMuc3VwcG9ydFZlcnNpb25pbmcoKSkKICAgICAgICB7CiAgICAgICAgICAgIC8vIGVtcHR5IHJldiBiZWNhdXNlIGkgd2FudCBhbiByZXYgYXR0cmlidXRlIGluIHRoZSByZXN1bHQKICAgICAgICAgICAgYXR0cnMudmVyID0gdmVyIHx8ICcnOwogICAgICAgICAgICB0aGlzLml0ZW1zID0gaXRlbXMgfHwgW107CiAgICAgICAgfQogICAgICAgIHZhciBpcSA9ICRpcSh7dHlwZTogJ2dldCcsICAnaWQnIDogdGhpcy5fY29ubmVjdGlvbi5nZXRVbmlxdWVJZCgncm9zdGVyJyl9KS5jKCdxdWVyeScsIGF0dHJzKTsKICAgICAgICByZXR1cm4gdGhpcy5fY29ubmVjdGlvbi5zZW5kSVEoaXEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fb25SZWNlaXZlUm9zdGVyU3VjY2Vzcy5iaW5kKHRoaXMsIHVzZXJDYWxsYmFjayksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fb25SZWNlaXZlUm9zdGVyRXJyb3IuYmluZCh0aGlzLCB1c2VyQ2FsbGJhY2spKTsKICAgIH0sCiAgICAvKiogRnVuY3Rpb246IHJlZ2lzdGVyQ2FsbGJhY2sKICAgICAqIHJlZ2lzdGVyIGNhbGxiYWNrIG9uIHJvc3RlciAocHJlc2VuY2UgYW5kIGlxKQogICAgICoKICAgICAqIFBhcmFtZXRlcnM6CiAgICAgKiAgIChGdW5jdGlvbikgY2FsbF9iYWNrCiAgICAgKi8KICAgIHJlZ2lzdGVyQ2FsbGJhY2s6IGZ1bmN0aW9uKGNhbGxfYmFjaykKICAgIHsKICAgICAgICB0aGlzLl9jYWxsYmFja3MucHVzaChjYWxsX2JhY2spOwogICAgfSwKICAgIC8qKiBGdW5jdGlvbjogZmluZEl0ZW0KICAgICAqIEZpbmQgaXRlbSBieSBKSUQKICAgICAqCiAgICAgKiBQYXJhbWV0ZXJzOgogICAgICogICAgIChTdHJpbmcpIGppZAogICAgICovCiAgICBmaW5kSXRlbSA6IGZ1bmN0aW9uKGppZCkKICAgIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuaXRlbXMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLml0ZW1zW2ldICYmIHRoaXMuaXRlbXNbaV0uamlkID09IGppZCkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5pdGVtc1tpXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKGUpCiAgICAgICAgewogICAgICAgICAgICBTdHJvcGhlLmVycm9yKGUpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9LAogICAgLyoqIEZ1bmN0aW9uOiByZW1vdmVJdGVtCiAgICAgKiBSZW1vdmUgaXRlbSBieSBKSUQKICAgICAqCiAgICAgKiBQYXJhbWV0ZXJzOgogICAgICogICAgIChTdHJpbmcpIGppZAogICAgICovCiAgICByZW1vdmVJdGVtIDogZnVuY3Rpb24oamlkKQogICAgewogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5pdGVtcy5sZW5ndGg7IGkrKykKICAgICAgICB7CiAgICAgICAgICAgIGlmICh0aGlzLml0ZW1zW2ldICYmIHRoaXMuaXRlbXNbaV0uamlkID09IGppZCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdGhpcy5pdGVtcy5zcGxpY2UoaSwgMSk7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9LAogICAgLyoqIEZ1bmN0aW9uOiBzdWJzY3JpYmUKICAgICAqIFN1YnNjcmliZSBwcmVzZW5jZQogICAgICoKICAgICAqIFBhcmFtZXRlcnM6CiAgICAgKiAgICAgKFN0cmluZykgamlkCiAgICAgKiAgICAgKFN0cmluZykgbWVzc2FnZSAob3B0aW9uYWwpCiAgICAgKiAgICAgKFN0cmluZykgbmljayAgKG9wdGlvbmFsKQogICAgICovCiAgICBzdWJzY3JpYmU6IGZ1bmN0aW9uKGppZCwgbWVzc2FnZSwgbmljaykgewogICAgICAgIHZhciBwcmVzID0gJHByZXMoe3RvOiBqaWQsIHR5cGU6ICJzdWJzY3JpYmUifSk7CiAgICAgICAgaWYgKG1lc3NhZ2UgJiYgbWVzc2FnZSAhPT0gIiIpIHsKICAgICAgICAgICAgcHJlcy5jKCJzdGF0dXMiKS50KG1lc3NhZ2UpLnVwKCk7CiAgICAgICAgfQogICAgICAgIGlmIChuaWNrICYmIG5pY2sgIT09ICIiKSB7CiAgICAgICAgICAgIHByZXMuYygnbmljaycsIHsneG1sbnMnOiBTdHJvcGhlLk5TLk5JQ0t9KS50KG5pY2spLnVwKCk7CiAgICAgICAgfQogICAgICAgIHRoaXMuX2Nvbm5lY3Rpb24uc2VuZChwcmVzKTsKICAgIH0sCiAgICAvKiogRnVuY3Rpb246IHVuc3Vic2NyaWJlCiAgICAgKiBVbnN1YnNjcmliZSBwcmVzZW5jZQogICAgICoKICAgICAqIFBhcmFtZXRlcnM6CiAgICAgKiAgICAgKFN0cmluZykgamlkCiAgICAgKiAgICAgKFN0cmluZykgbWVzc2FnZQogICAgICovCiAgICB1bnN1YnNjcmliZTogZnVuY3Rpb24oamlkLCBtZXNzYWdlKQogICAgewogICAgICAgIHZhciBwcmVzID0gJHByZXMoe3RvOiBqaWQsIHR5cGU6ICJ1bnN1YnNjcmliZSJ9KTsKICAgICAgICBpZiAobWVzc2FnZSAmJiBtZXNzYWdlICE9PSAiIikKICAgICAgICAgICAgcHJlcy5jKCJzdGF0dXMiKS50KG1lc3NhZ2UpOwogICAgICAgIHRoaXMuX2Nvbm5lY3Rpb24uc2VuZChwcmVzKTsKICAgIH0sCiAgICAvKiogRnVuY3Rpb246IGF1dGhvcml6ZQogICAgICogQXV0aG9yaXplIHByZXNlbmNlIHN1YnNjcmlwdGlvbgogICAgICoKICAgICAqIFBhcmFtZXRlcnM6CiAgICAgKiAgICAgKFN0cmluZykgamlkCiAgICAgKiAgICAgKFN0cmluZykgbWVzc2FnZQogICAgICovCiAgICBhdXRob3JpemU6IGZ1bmN0aW9uKGppZCwgbWVzc2FnZSkKICAgIHsKICAgICAgICB2YXIgcHJlcyA9ICRwcmVzKHt0bzogamlkLCB0eXBlOiAic3Vic2NyaWJlZCJ9KTsKICAgICAgICBpZiAobWVzc2FnZSAmJiBtZXNzYWdlICE9PSAiIikKICAgICAgICAgICAgcHJlcy5jKCJzdGF0dXMiKS50KG1lc3NhZ2UpOwogICAgICAgIHRoaXMuX2Nvbm5lY3Rpb24uc2VuZChwcmVzKTsKICAgIH0sCiAgICAvKiogRnVuY3Rpb246IHVuYXV0aG9yaXplCiAgICAgKiBVbmF1dGhvcml6ZSBwcmVzZW5jZSBzdWJzY3JpcHRpb24KICAgICAqCiAgICAgKiBQYXJhbWV0ZXJzOgogICAgICogICAgIChTdHJpbmcpIGppZAogICAgICogICAgIChTdHJpbmcpIG1lc3NhZ2UKICAgICAqLwogICAgdW5hdXRob3JpemU6IGZ1bmN0aW9uKGppZCwgbWVzc2FnZSkKICAgIHsKICAgICAgICB2YXIgcHJlcyA9ICRwcmVzKHt0bzogamlkLCB0eXBlOiAidW5zdWJzY3JpYmVkIn0pOwogICAgICAgIGlmIChtZXNzYWdlICYmIG1lc3NhZ2UgIT09ICIiKQogICAgICAgICAgICBwcmVzLmMoInN0YXR1cyIpLnQobWVzc2FnZSk7CiAgICAgICAgdGhpcy5fY29ubmVjdGlvbi5zZW5kKHByZXMpOwogICAgfSwKICAgIC8qKiBGdW5jdGlvbjogYWRkCiAgICAgKiBBZGQgcm9zdGVyIGl0ZW0KICAgICAqCiAgICAgKiBQYXJhbWV0ZXJzOgogICAgICogICAoU3RyaW5nKSBqaWQgLSBpdGVtIGppZAogICAgICogICAoU3RyaW5nKSBuYW1lIC0gbmFtZQogICAgICogICAoQXJyYXkpIGdyb3VwcwogICAgICogICAoRnVuY3Rpb24pIGNhbGxfYmFjawogICAgICovCiAgICBhZGQ6IGZ1bmN0aW9uKGppZCwgbmFtZSwgZ3JvdXBzLCBjYWxsX2JhY2spCiAgICB7CiAgICAgICAgdmFyIGlxID0gJGlxKHt0eXBlOiAnc2V0J30pLmMoJ3F1ZXJ5Jywge3htbG5zOiBTdHJvcGhlLk5TLlJPU1RFUn0pLmMoJ2l0ZW0nLCB7amlkOiBqaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogbmFtZX0pOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZ3JvdXBzLmxlbmd0aDsgaSsrKQogICAgICAgIHsKICAgICAgICAgICAgaXEuYygnZ3JvdXAnKS50KGdyb3Vwc1tpXSkudXAoKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5fY29ubmVjdGlvbi5zZW5kSVEoaXEsIGNhbGxfYmFjaywgY2FsbF9iYWNrKTsKICAgIH0sCiAgICAvKiogRnVuY3Rpb246IHVwZGF0ZQogICAgICogVXBkYXRlIHJvc3RlciBpdGVtCiAgICAgKgogICAgICogUGFyYW1ldGVyczoKICAgICAqICAgKFN0cmluZykgamlkIC0gaXRlbSBqaWQKICAgICAqICAgKFN0cmluZykgbmFtZSAtIG5hbWUKICAgICAqICAgKEFycmF5KSBncm91cHMKICAgICAqICAgKEZ1bmN0aW9uKSBjYWxsX2JhY2sKICAgICAqLwogICAgdXBkYXRlOiBmdW5jdGlvbihqaWQsIG5hbWUsIGdyb3VwcywgY2FsbF9iYWNrKQogICAgewogICAgICAgIHZhciBpdGVtID0gdGhpcy5maW5kSXRlbShqaWQpOwogICAgICAgIGlmICghaXRlbSkKICAgICAgICB7CiAgICAgICAgICAgIHRocm93ICJpdGVtIG5vdCBmb3VuZCI7CiAgICAgICAgfQogICAgICAgIHZhciBuZXdOYW1lID0gbmFtZSB8fCBpdGVtLm5hbWU7CiAgICAgICAgdmFyIG5ld0dyb3VwcyA9IGdyb3VwcyB8fCBpdGVtLmdyb3VwczsKICAgICAgICB2YXIgaXEgPSAkaXEoe3R5cGU6ICdzZXQnfSkuYygncXVlcnknLCB7eG1sbnM6IFN0cm9waGUuTlMuUk9TVEVSfSkuYygnaXRlbScsIHtqaWQ6IGl0ZW0uamlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IG5ld05hbWV9KTsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG5ld0dyb3Vwcy5sZW5ndGg7IGkrKykKICAgICAgICB7CiAgICAgICAgICAgIGlxLmMoJ2dyb3VwJykudChuZXdHcm91cHNbaV0pLnVwKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzLl9jb25uZWN0aW9uLnNlbmRJUShpcSwgY2FsbF9iYWNrLCBjYWxsX2JhY2spOwogICAgfSwKICAgIC8qKiBGdW5jdGlvbjogcmVtb3ZlCiAgICAgKiBSZW1vdmUgcm9zdGVyIGl0ZW0KICAgICAqCiAgICAgKiBQYXJhbWV0ZXJzOgogICAgICogICAoU3RyaW5nKSBqaWQgLSBpdGVtIGppZAogICAgICogICAoRnVuY3Rpb24pIGNhbGxfYmFjawogICAgICovCiAgICByZW1vdmU6IGZ1bmN0aW9uKGppZCwgY2FsbF9iYWNrKQogICAgewogICAgICAgIHZhciBpdGVtID0gdGhpcy5maW5kSXRlbShqaWQpOwogICAgICAgIGlmICghaXRlbSkKICAgICAgICB7CiAgICAgICAgICAgIHRocm93ICJpdGVtIG5vdCBmb3VuZCI7CiAgICAgICAgfQogICAgICAgIHZhciBpcSA9ICRpcSh7dHlwZTogJ3NldCd9KS5jKCdxdWVyeScsIHt4bWxuczogU3Ryb3BoZS5OUy5ST1NURVJ9KS5jKCdpdGVtJywge2ppZDogaXRlbS5qaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uOiAicmVtb3ZlIn0pOwogICAgICAgIHRoaXMuX2Nvbm5lY3Rpb24uc2VuZElRKGlxLCBjYWxsX2JhY2ssIGNhbGxfYmFjayk7CiAgICB9LAogICAgLyoqIFByaXZhdGVGdW5jdGlvbjogX29uUmVjZWl2ZVJvc3RlclN1Y2Nlc3MKICAgICAqCiAgICAgKi8KICAgIF9vblJlY2VpdmVSb3N0ZXJTdWNjZXNzOiBmdW5jdGlvbih1c2VyQ2FsbGJhY2ssIHN0YW56YSkKICAgIHsKICAgICAgICB0aGlzLl91cGRhdGVJdGVtcyhzdGFuemEpOwogICAgICAgIGlmICh0eXBlb2YgdXNlckNhbGxiYWNrID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICAgIHVzZXJDYWxsYmFjayh0aGlzLml0ZW1zKTsKICAgICAgICB9CiAgICB9LAogICAgLyoqIFByaXZhdGVGdW5jdGlvbjogX29uUmVjZWl2ZVJvc3RlckVycm9yCiAgICAgKgogICAgICovCiAgICBfb25SZWNlaXZlUm9zdGVyRXJyb3I6IGZ1bmN0aW9uKHVzZXJDYWxsYmFjaywgc3RhbnphKQogICAgewogICAgICAgIHVzZXJDYWxsYmFjayh0aGlzLml0ZW1zKTsKICAgIH0sCiAgICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiBfb25SZWNlaXZlUHJlc2VuY2UKICAgICAqIEhhbmRsZSBwcmVzZW5jZQogICAgICovCiAgICBfb25SZWNlaXZlUHJlc2VuY2UgOiBmdW5jdGlvbihwcmVzZW5jZSkKICAgIHsKICAgICAgICAvLyBUT0RPOiBmcm9tIGlzIG9wdGlvbmFsCiAgICAgICAgdmFyIGppZCA9IHByZXNlbmNlLmdldEF0dHJpYnV0ZSgnZnJvbScpOwogICAgICAgIHZhciBmcm9tID0gU3Ryb3BoZS5nZXRCYXJlSmlkRnJvbUppZChqaWQpOwogICAgICAgIHZhciBpdGVtID0gdGhpcy5maW5kSXRlbShmcm9tKTsKICAgICAgICAvLyBub3QgaW4gcm9zdGVyCiAgICAgICAgaWYgKCFpdGVtKQogICAgICAgIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHZhciB0eXBlID0gcHJlc2VuY2UuZ2V0QXR0cmlidXRlKCd0eXBlJyk7CiAgICAgICAgaWYgKHR5cGUgPT0gJ3VuYXZhaWxhYmxlJykKICAgICAgICB7CiAgICAgICAgICAgIGRlbGV0ZSBpdGVtLnJlc291cmNlc1tTdHJvcGhlLmdldFJlc291cmNlRnJvbUppZChqaWQpXTsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAoIXR5cGUpCiAgICAgICAgewogICAgICAgICAgICAvLyBUT0RPOiBhZGQgdGltZXN0YW1wCiAgICAgICAgICAgIGl0ZW0ucmVzb3VyY2VzW1N0cm9waGUuZ2V0UmVzb3VyY2VGcm9tSmlkKGppZCldID0gewogICAgICAgICAgICAgICAgc2hvdyAgICAgOiAocHJlc2VuY2UuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3Nob3cnKS5sZW5ndGggIT09IDApID8gU3Ryb3BoZS5nZXRUZXh0KHByZXNlbmNlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdzaG93JylbMF0pIDogIiIsCiAgICAgICAgICAgICAgICBzdGF0dXMgICA6IChwcmVzZW5jZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc3RhdHVzJykubGVuZ3RoICE9PSAwKSA/IFN0cm9waGUuZ2V0VGV4dChwcmVzZW5jZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc3RhdHVzJylbMF0pIDogIiIsCiAgICAgICAgICAgICAgICBwcmlvcml0eSA6IChwcmVzZW5jZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgncHJpb3JpdHknKS5sZW5ndGggIT09IDApID8gU3Ryb3BoZS5nZXRUZXh0KHByZXNlbmNlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdwcmlvcml0eScpWzBdKSA6ICIiCiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIGVsc2UKICAgICAgICB7CiAgICAgICAgICAgIC8vIFN0YW56YSBpcyBub3QgYSBwcmVzZW5jZSBub3RpZmljYXRpb24uIChJdCdzIHByb2JhYmx5IGEgc3Vic2NyaXB0aW9uIHR5cGUgc3RhbnphLikKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHRoaXMuX2NhbGxfYmFja3ModGhpcy5pdGVtcywgaXRlbSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9LAogICAgLyoqIFByaXZhdGVGdW5jdGlvbjogX2NhbGxfYmFja3MKICAgICAqCiAgICAgKi8KICAgIF9jYWxsX2JhY2tzIDogZnVuY3Rpb24oaXRlbXMsIGl0ZW0pCiAgICB7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLl9jYWxsYmFja3MubGVuZ3RoOyBpKyspIC8vIFtdLmZvckVhY2ggbXkgbG92ZSAuLi4KICAgICAgICB7CiAgICAgICAgICAgIHRoaXMuX2NhbGxiYWNrc1tpXShpdGVtcywgaXRlbSk7CiAgICAgICAgfQogICAgfSwKICAgIC8qKiBQcml2YXRlRnVuY3Rpb246IF9vblJlY2VpdmVJUQogICAgICogSGFuZGxlIHJvc3RlciBwdXNoLgogICAgICovCiAgICBfb25SZWNlaXZlSVEgOiBmdW5jdGlvbihpcSkKICAgIHsKICAgICAgICB2YXIgaWQgPSBpcS5nZXRBdHRyaWJ1dGUoJ2lkJyk7CiAgICAgICAgdmFyIGZyb20gPSBpcS5nZXRBdHRyaWJ1dGUoJ2Zyb20nKTsKICAgICAgICAvLyBSZWNlaXZpbmcgY2xpZW50IE1VU1QgaWdub3JlIHN0YW56YSB1bmxlc3MgaXQgaGFzIG5vIGZyb20gb3IgZnJvbSA9IHVzZXIncyBKSUQuCiAgICAgICAgaWYgKGZyb20gJiYgZnJvbSAhPT0gIiIgJiYgZnJvbSAhPSB0aGlzLl9jb25uZWN0aW9uLmppZCAmJiBmcm9tICE9IFN0cm9waGUuZ2V0QmFyZUppZEZyb21KaWQodGhpcy5fY29ubmVjdGlvbi5qaWQpKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB2YXIgaXFyZXN1bHQgPSAkaXEoe3R5cGU6ICdyZXN1bHQnLCBpZDogaWQsIGZyb206IHRoaXMuX2Nvbm5lY3Rpb24uamlkfSk7CiAgICAgICAgdGhpcy5fY29ubmVjdGlvbi5zZW5kKGlxcmVzdWx0KTsKICAgICAgICB0aGlzLl91cGRhdGVJdGVtcyhpcSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9LAogICAgLyoqIFByaXZhdGVGdW5jdGlvbjogX3VwZGF0ZUl0ZW1zCiAgICAgKiBVcGRhdGUgaXRlbXMgZnJvbSBpcQogICAgICovCiAgICBfdXBkYXRlSXRlbXMgOiBmdW5jdGlvbihpcSkKICAgIHsKICAgICAgICB2YXIgcXVlcnkgPSBpcS5nZXRFbGVtZW50c0J5VGFnTmFtZSgncXVlcnknKTsKICAgICAgICBpZiAocXVlcnkubGVuZ3RoICE9PSAwKQogICAgICAgIHsKICAgICAgICAgICAgdGhpcy52ZXIgPSBxdWVyeS5pdGVtKDApLmdldEF0dHJpYnV0ZSgndmVyJyk7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgU3Ryb3BoZS5mb3JFYWNoQ2hpbGQocXVlcnkuaXRlbSgwKSwgJ2l0ZW0nLAogICAgICAgICAgICAgICAgZnVuY3Rpb24gKGl0ZW0pCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgc2VsZi5fdXBkYXRlSXRlbShpdGVtKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICB0aGlzLl9jYWxsX2JhY2tzKHRoaXMuaXRlbXMpOwogICAgfSwKICAgIC8qKiBQcml2YXRlRnVuY3Rpb246IF91cGRhdGVJdGVtCiAgICAgKiBVcGRhdGUgaW50ZXJuYWwgcmVwcmVzZW50YXRpb24gb2Ygcm9zdGVyIGl0ZW0KICAgICAqLwogICAgX3VwZGF0ZUl0ZW0gOiBmdW5jdGlvbihpdGVtKQogICAgewogICAgICAgIHZhciBqaWQgICAgICAgICAgID0gaXRlbS5nZXRBdHRyaWJ1dGUoImppZCIpOwogICAgICAgIHZhciBuYW1lICAgICAgICAgID0gaXRlbS5nZXRBdHRyaWJ1dGUoIm5hbWUiKTsKICAgICAgICB2YXIgc3Vic2NyaXB0aW9uICA9IGl0ZW0uZ2V0QXR0cmlidXRlKCJzdWJzY3JpcHRpb24iKTsKICAgICAgICB2YXIgYXNrICAgICAgICAgICA9IGl0ZW0uZ2V0QXR0cmlidXRlKCJhc2siKTsKICAgICAgICB2YXIgZ3JvdXBzICAgICAgICA9IFtdOwogICAgICAgIFN0cm9waGUuZm9yRWFjaENoaWxkKGl0ZW0sICdncm91cCcsCiAgICAgICAgICAgIGZ1bmN0aW9uKGdyb3VwKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBncm91cHMucHVzaChTdHJvcGhlLmdldFRleHQoZ3JvdXApKTsKICAgICAgICAgICAgfQogICAgICAgICk7CgogICAgICAgIGlmIChzdWJzY3JpcHRpb24gPT0gInJlbW92ZSIpCiAgICAgICAgewogICAgICAgICAgICB0aGlzLnJlbW92ZUl0ZW0oamlkKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaXRlbSA9IHRoaXMuZmluZEl0ZW0oamlkKTsKICAgICAgICBpZiAoIWl0ZW0pCiAgICAgICAgewogICAgICAgICAgICB0aGlzLml0ZW1zLnB1c2goewogICAgICAgICAgICAgICAgbmFtZSAgICAgICAgIDogbmFtZSwKICAgICAgICAgICAgICAgIGppZCAgICAgICAgICA6IGppZCwKICAgICAgICAgICAgICAgIHN1YnNjcmlwdGlvbiA6IHN1YnNjcmlwdGlvbiwKICAgICAgICAgICAgICAgIGFzayAgICAgICAgICA6IGFzaywKICAgICAgICAgICAgICAgIGdyb3VwcyAgICAgICA6IGdyb3VwcywKICAgICAgICAgICAgICAgIHJlc291cmNlcyAgICA6IHt9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBlbHNlCiAgICAgICAgewogICAgICAgICAgICBpdGVtLm5hbWUgPSBuYW1lOwogICAgICAgICAgICBpdGVtLnN1YnNjcmlwdGlvbiA9IHN1YnNjcmlwdGlvbjsKICAgICAgICAgICAgaXRlbS5hc2sgPSBhc2s7CiAgICAgICAgICAgIGl0ZW0uZ3JvdXBzID0gZ3JvdXBzOwogICAgICAgIH0KICAgIH0KfSk7CgpkZWZpbmUoInN0cm9waGUucm9zdGVyIiwgWyJzdHJvcGhlIl0sIGZ1bmN0aW9uKCl7fSk7CgovLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuMy4zCi8qClBsdWdpbiB0byBpbXBsZW1lbnQgdGhlIHZDYXJkIGV4dGVuc2lvbi4KaHR0cDovL3htcHAub3JnL2V4dGVuc2lvbnMveGVwLTAwNTQuaHRtbAoKQXV0aG9yOiBOYXRoYW4gWm9ybiAobmF0aGFuLnpvcm5AZ21haWwuY29tKQpDb2ZmZWVTY3JpcHQgcG9ydDogQW5kcmVhcyBHdXRoIChndXRoQGRiaXMucnd0aC1hYWNoZW4uZGUpCiovCgovKiBqc2xpbnQgY29uZmlndXJhdGlvbjoKKi8KCi8qIGdsb2JhbCBkb2N1bWVudCwgd2luZG93LCBzZXRUaW1lb3V0LCBjbGVhclRpbWVvdXQsIGNvbnNvbGUsCiAgICBYTUxIdHRwUmVxdWVzdCwgQWN0aXZlWE9iamVjdCwKICAgIEJhc2U2NCwgTUQ1LAogICAgU3Ryb3BoZSwgJGJ1aWxkLCAkbXNnLCAkaXEsICRwcmVzCiovCgp2YXIgYnVpbGRJcTsKCmJ1aWxkSXEgPSBmdW5jdGlvbih0eXBlLCBqaWQsIHZDYXJkRWwpIHsKICB2YXIgaXE7CiAgaXEgPSAkaXEoamlkID8gewogICAgdHlwZTogdHlwZSwKICAgIHRvOiBqaWQKICB9IDogewogICAgdHlwZTogdHlwZQogIH0pOwogIGlxLmMoInZDYXJkIiwgewogICAgeG1sbnM6IFN0cm9waGUuTlMuVkNBUkQKICB9KTsKICBpZiAodkNhcmRFbCkgewogICAgaXEuY25vZGUodkNhcmRFbCk7CiAgfQogIHJldHVybiBpcTsKfTsKClN0cm9waGUuYWRkQ29ubmVjdGlvblBsdWdpbigndmNhcmQnLCB7CiAgX2Nvbm5lY3Rpb246IG51bGwsCiAgaW5pdDogZnVuY3Rpb24oY29ubikgewogICAgdGhpcy5fY29ubmVjdGlvbiA9IGNvbm47CiAgICByZXR1cm4gU3Ryb3BoZS5hZGROYW1lc3BhY2UoJ1ZDQVJEJywgJ3ZjYXJkLXRlbXAnKTsKICB9LAogIC8qRnVuY3Rpb24KICAgIFJldHJpZXZlIGEgdkNhcmQgZm9yIGEgSklEL0VudGl0eQogICAgUGFyYW1ldGVyczoKICAgIChGdW5jdGlvbikgaGFuZGxlcl9jYiAtIFRoZSBjYWxsYmFjayBmdW5jdGlvbiB1c2VkIHRvIGhhbmRsZSB0aGUgcmVxdWVzdC4KICAgIChTdHJpbmcpIGppZCAtIG9wdGlvbmFsIC0gVGhlIG5hbWUgb2YgdGhlIGVudGl0eSB0byByZXF1ZXN0IHRoZSB2Q2FyZAogICAgICAgSWYgbm8gamlkIGlzIGdpdmVuLCB0aGlzIGZ1bmN0aW9uIHJldHJpZXZlcyB0aGUgY3VycmVudCB1c2VyJ3MgdmNhcmQuCiAgKi8KCiAgZ2V0OiBmdW5jdGlvbihoYW5kbGVyX2NiLCBqaWQsIGVycm9yX2NiKSB7CiAgICB2YXIgaXE7CiAgICBpcSA9IGJ1aWxkSXEoImdldCIsIGppZCk7CiAgICByZXR1cm4gdGhpcy5fY29ubmVjdGlvbi5zZW5kSVEoaXEsIGhhbmRsZXJfY2IsIGVycm9yX2NiKTsKICB9LAogIC8qIEZ1bmN0aW9uCiAgICAgIFNldCBhbiBlbnRpdHkncyB2Q2FyZC4KICAqLwoKICBzZXQ6IGZ1bmN0aW9uKGhhbmRsZXJfY2IsIHZDYXJkRWwsIGppZCwgZXJyb3JfY2IpIHsKICAgIHZhciBpcTsKICAgIGlxID0gYnVpbGRJcSgic2V0IiwgamlkLCB2Q2FyZEVsKTsKICAgIHJldHVybiB0aGlzLl9jb25uZWN0aW9uLnNlbmRJUShpcSwgaGFuZGxlcl9jYiwgZXJyb3JfcmIpOwogIH0KfSk7CgpkZWZpbmUoInN0cm9waGUudmNhcmQiLCBbInN0cm9waGUiXSwgZnVuY3Rpb24oKXt9KTsKCi8qCiAgQ29weXJpZ2h0IDIwMTAsIEZyYW7Dp29pcyBkZSBNZXR6IDxmcmFuY29pc0AybWV0ei5mcj4KKi8KCi8qKgogKiBEaXNjbyBTdHJvcGhlIFBsdWdpbgogKiBJbXBsZW1lbnQgaHR0cDovL3htcHAub3JnL2V4dGVuc2lvbnMveGVwLTAwMzAuaHRtbAogKiBUT0RPOiBtYW5hZ2Ugbm9kZSBoaWVyYXJjaGllcywgYW5kIG5vZGUgb24gaW5mbyByZXF1ZXN0CiAqLwpTdHJvcGhlLmFkZENvbm5lY3Rpb25QbHVnaW4oJ2Rpc2NvJywKewogICAgX2Nvbm5lY3Rpb246IG51bGwsCiAgICBfaWRlbnRpdGllcyA6IFtdLAogICAgX2ZlYXR1cmVzIDogW10sCiAgICBfaXRlbXMgOiBbXSwKICAgIC8qKiBGdW5jdGlvbjogaW5pdAogICAgICogUGx1Z2luIGluaXQKICAgICAqCiAgICAgKiBQYXJhbWV0ZXJzOgogICAgICogICAoU3Ryb3BoZS5Db25uZWN0aW9uKSBjb25uIC0gU3Ryb3BoZSBjb25uZWN0aW9uCiAgICAgKi8KICAgIGluaXQ6IGZ1bmN0aW9uKGNvbm4pCiAgICB7CiAgICB0aGlzLl9jb25uZWN0aW9uID0gY29ubjsKICAgICAgICB0aGlzLl9pZGVudGl0aWVzID0gW107CiAgICAgICAgdGhpcy5fZmVhdHVyZXMgICA9IFtdOwogICAgICAgIHRoaXMuX2l0ZW1zICAgICAgPSBbXTsKICAgICAgICAvLyBkaXNjbyBpbmZvCiAgICAgICAgY29ubi5hZGRIYW5kbGVyKHRoaXMuX29uRGlzY29JbmZvLmJpbmQodGhpcyksIFN0cm9waGUuTlMuRElTQ09fSU5GTywgJ2lxJywgJ2dldCcsIG51bGwsIG51bGwpOwogICAgICAgIC8vIGRpc2NvIGl0ZW1zCiAgICAgICAgY29ubi5hZGRIYW5kbGVyKHRoaXMuX29uRGlzY29JdGVtcy5iaW5kKHRoaXMpLCBTdHJvcGhlLk5TLkRJU0NPX0lURU1TLCAnaXEnLCAnZ2V0JywgbnVsbCwgbnVsbCk7CiAgICB9LAogICAgLyoqIEZ1bmN0aW9uOiBhZGRJZGVudGl0eQogICAgICogU2VlIGh0dHA6Ly94bXBwLm9yZy9yZWdpc3RyYXIvZGlzY28tY2F0ZWdvcmllcy5odG1sCiAgICAgKiBQYXJhbWV0ZXJzOgogICAgICogICAoU3RyaW5nKSBjYXRlZ29yeSAtIGNhdGVnb3J5IG9mIGlkZW50aXR5IChsaWtlIGNsaWVudCwgYXV0b21hdGlvbiwgZXRjIC4uLikKICAgICAqICAgKFN0cmluZykgdHlwZSAtIHR5cGUgb2YgaWRlbnRpdHkgKGxpa2UgcGMsIHdlYiwgYm90ICwgZXRjIC4uLikKICAgICAqICAgKFN0cmluZykgbmFtZSAtIG5hbWUgb2YgaWRlbnRpdHkgaW4gbmF0dXJhbCBsYW5ndWFnZQogICAgICogICAoU3RyaW5nKSBsYW5nIC0gbGFuZyBvZiBuYW1lIHBhcmFtZXRlcgogICAgICoKICAgICAqIFJldHVybnM6CiAgICAgKiAgIEJvb2xlYW4KICAgICAqLwogICAgYWRkSWRlbnRpdHk6IGZ1bmN0aW9uKGNhdGVnb3J5LCB0eXBlLCBuYW1lLCBsYW5nKQogICAgewogICAgICAgIGZvciAodmFyIGk9MDsgaTx0aGlzLl9pZGVudGl0aWVzLmxlbmd0aDsgaSsrKQogICAgICAgIHsKICAgICAgICAgICAgaWYgKHRoaXMuX2lkZW50aXRpZXNbaV0uY2F0ZWdvcnkgPT0gY2F0ZWdvcnkgJiYKICAgICAgICAgICAgICAgIHRoaXMuX2lkZW50aXRpZXNbaV0udHlwZSA9PSB0eXBlICYmCiAgICAgICAgICAgICAgICB0aGlzLl9pZGVudGl0aWVzW2ldLm5hbWUgPT0gbmFtZSAmJgogICAgICAgICAgICAgICAgdGhpcy5faWRlbnRpdGllc1tpXS5sYW5nID09IGxhbmcpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB0aGlzLl9pZGVudGl0aWVzLnB1c2goe2NhdGVnb3J5OiBjYXRlZ29yeSwgdHlwZTogdHlwZSwgbmFtZTogbmFtZSwgbGFuZzogbGFuZ30pOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfSwKICAgIC8qKiBGdW5jdGlvbjogYWRkRmVhdHVyZQogICAgICoKICAgICAqIFBhcmFtZXRlcnM6CiAgICAgKiAgIChTdHJpbmcpIHZhcl9uYW1lIC0gZmVhdHVyZSBuYW1lIChsaWtlIGphYmJlcjppcTp2ZXJzaW9uKQogICAgICoKICAgICAqIFJldHVybnM6CiAgICAgKiAgIGJvb2xlYW4KICAgICAqLwogICAgYWRkRmVhdHVyZTogZnVuY3Rpb24odmFyX25hbWUpCiAgICB7CiAgICAgICAgZm9yICh2YXIgaT0wOyBpPHRoaXMuX2ZlYXR1cmVzLmxlbmd0aDsgaSsrKQogICAgICAgIHsKICAgICAgICAgICAgIGlmICh0aGlzLl9mZWF0dXJlc1tpXSA9PSB2YXJfbmFtZSkKICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHRoaXMuX2ZlYXR1cmVzLnB1c2godmFyX25hbWUpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfSwKICAgIC8qKiBGdW5jdGlvbjogcmVtb3ZlRmVhdHVyZQogICAgICoKICAgICAqIFBhcmFtZXRlcnM6CiAgICAgKiAgIChTdHJpbmcpIHZhcl9uYW1lIC0gZmVhdHVyZSBuYW1lIChsaWtlIGphYmJlcjppcTp2ZXJzaW9uKQogICAgICoKICAgICAqIFJldHVybnM6CiAgICAgKiAgIGJvb2xlYW4KICAgICAqLwogICAgcmVtb3ZlRmVhdHVyZTogZnVuY3Rpb24odmFyX25hbWUpCiAgICB7CiAgICAgICAgZm9yICh2YXIgaT0wOyBpPHRoaXMuX2ZlYXR1cmVzLmxlbmd0aDsgaSsrKQogICAgICAgIHsKICAgICAgICAgICAgIGlmICh0aGlzLl9mZWF0dXJlc1tpXSA9PT0gdmFyX25hbWUpewogICAgICAgICAgICAgICAgIHRoaXMuX2ZlYXR1cmVzLnNwbGljZShpLDEpCiAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0sCiAgICAvKiogRnVuY3Rpb246IGFkZEl0ZW0KICAgICAqCiAgICAgKiBQYXJhbWV0ZXJzOgogICAgICogICAoU3RyaW5nKSBqaWQKICAgICAqICAgKFN0cmluZykgbmFtZQogICAgICogICAoU3RyaW5nKSBub2RlCiAgICAgKiAgIChGdW5jdGlvbikgY2FsbF9iYWNrCiAgICAgKgogICAgICogUmV0dXJuczoKICAgICAqICAgYm9vbGVhbgogICAgICovCiAgICBhZGRJdGVtOiBmdW5jdGlvbihqaWQsIG5hbWUsIG5vZGUsIGNhbGxfYmFjaykKICAgIHsKICAgICAgICBpZiAobm9kZSAmJiAhY2FsbF9iYWNrKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgdGhpcy5faXRlbXMucHVzaCh7amlkOiBqaWQsIG5hbWU6IG5hbWUsIG5vZGU6IG5vZGUsIGNhbGxfYmFjazogY2FsbF9iYWNrfSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9LAogICAgLyoqIEZ1bmN0aW9uOiBpbmZvCiAgICAgKiBJbmZvIHF1ZXJ5CiAgICAgKgogICAgICogUGFyYW1ldGVyczoKICAgICAqICAgKEZ1bmN0aW9uKSBjYWxsX2JhY2sKICAgICAqICAgKFN0cmluZykgamlkCiAgICAgKiAgIChTdHJpbmcpIG5vZGUKICAgICAqLwogICAgaW5mbzogZnVuY3Rpb24oamlkLCBub2RlLCBzdWNjZXNzLCBlcnJvciwgdGltZW91dCkKICAgIHsKICAgICAgICB2YXIgYXR0cnMgPSB7eG1sbnM6IFN0cm9waGUuTlMuRElTQ09fSU5GT307CiAgICAgICAgaWYgKG5vZGUpCiAgICAgICAgICAgIGF0dHJzLm5vZGUgPSBub2RlOwoKICAgICAgICB2YXIgaW5mbyA9ICRpcSh7ZnJvbTp0aGlzLl9jb25uZWN0aW9uLmppZCwKICAgICAgICAgICAgICAgICAgICAgICAgIHRvOmppZCwgdHlwZTonZ2V0J30pLmMoJ3F1ZXJ5JywgYXR0cnMpOwogICAgICAgIHRoaXMuX2Nvbm5lY3Rpb24uc2VuZElRKGluZm8sIHN1Y2Nlc3MsIGVycm9yLCB0aW1lb3V0KTsKICAgIH0sCiAgICAvKiogRnVuY3Rpb246IGl0ZW1zCiAgICAgKiBJdGVtcyBxdWVyeQogICAgICoKICAgICAqIFBhcmFtZXRlcnM6CiAgICAgKiAgIChGdW5jdGlvbikgY2FsbF9iYWNrCiAgICAgKiAgIChTdHJpbmcpIGppZAogICAgICogICAoU3RyaW5nKSBub2RlCiAgICAgKi8KICAgIGl0ZW1zOiBmdW5jdGlvbihqaWQsIG5vZGUsIHN1Y2Nlc3MsIGVycm9yLCB0aW1lb3V0KQogICAgewogICAgICAgIHZhciBhdHRycyA9IHt4bWxuczogU3Ryb3BoZS5OUy5ESVNDT19JVEVNU307CiAgICAgICAgaWYgKG5vZGUpCiAgICAgICAgICAgIGF0dHJzLm5vZGUgPSBub2RlOwoKICAgICAgICB2YXIgaXRlbXMgPSAkaXEoe2Zyb206dGhpcy5fY29ubmVjdGlvbi5qaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICB0bzpqaWQsIHR5cGU6J2dldCd9KS5jKCdxdWVyeScsIGF0dHJzKTsKICAgICAgICB0aGlzLl9jb25uZWN0aW9uLnNlbmRJUShpdGVtcywgc3VjY2VzcywgZXJyb3IsIHRpbWVvdXQpOwogICAgfSwKCiAgICAvKiogUHJpdmF0ZUZ1bmN0aW9uOiBfYnVpbGRJUVJlc3VsdAogICAgICovCiAgICBfYnVpbGRJUVJlc3VsdDogZnVuY3Rpb24oc3RhbnphLCBxdWVyeV9hdHRycykKICAgIHsKICAgICAgICB2YXIgaWQgICA9ICBzdGFuemEuZ2V0QXR0cmlidXRlKCdpZCcpOwogICAgICAgIHZhciBmcm9tID0gc3RhbnphLmdldEF0dHJpYnV0ZSgnZnJvbScpOwogICAgICAgIHZhciBpcXJlc3VsdCA9ICRpcSh7dHlwZTogJ3Jlc3VsdCcsIGlkOiBpZH0pOwoKICAgICAgICBpZiAoZnJvbSAhPT0gbnVsbCkgewogICAgICAgICAgICBpcXJlc3VsdC5hdHRycyh7dG86IGZyb219KTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBpcXJlc3VsdC5jKCdxdWVyeScsIHF1ZXJ5X2F0dHJzKTsKICAgIH0sCgogICAgLyoqIFByaXZhdGVGdW5jdGlvbjogX29uRGlzY29JbmZvCiAgICAgKiBDYWxsZWQgd2hlbiByZWNlaXZlIGluZm8gcmVxdWVzdAogICAgICovCiAgICBfb25EaXNjb0luZm86IGZ1bmN0aW9uKHN0YW56YSkKICAgIHsKICAgICAgICB2YXIgbm9kZSA9IHN0YW56YS5nZXRFbGVtZW50c0J5VGFnTmFtZSgncXVlcnknKVswXS5nZXRBdHRyaWJ1dGUoJ25vZGUnKTsKICAgICAgICB2YXIgYXR0cnMgPSB7eG1sbnM6IFN0cm9waGUuTlMuRElTQ09fSU5GT307CiAgICAgICAgaWYgKG5vZGUpCiAgICAgICAgewogICAgICAgICAgICBhdHRycy5ub2RlID0gbm9kZTsKICAgICAgICB9CiAgICAgICAgdmFyIGlxcmVzdWx0ID0gdGhpcy5fYnVpbGRJUVJlc3VsdChzdGFuemEsIGF0dHJzKTsKICAgICAgICBmb3IgKHZhciBpPTA7IGk8dGhpcy5faWRlbnRpdGllcy5sZW5ndGg7IGkrKykKICAgICAgICB7CiAgICAgICAgICAgIHZhciBhdHRycyA9IHtjYXRlZ29yeTogdGhpcy5faWRlbnRpdGllc1tpXS5jYXRlZ29yeSwKICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGUgICAgOiB0aGlzLl9pZGVudGl0aWVzW2ldLnR5cGV9OwogICAgICAgICAgICBpZiAodGhpcy5faWRlbnRpdGllc1tpXS5uYW1lKQogICAgICAgICAgICAgICAgYXR0cnMubmFtZSA9IHRoaXMuX2lkZW50aXRpZXNbaV0ubmFtZTsKICAgICAgICAgICAgaWYgKHRoaXMuX2lkZW50aXRpZXNbaV0ubGFuZykKICAgICAgICAgICAgICAgIGF0dHJzWyd4bWw6bGFuZyddID0gdGhpcy5faWRlbnRpdGllc1tpXS5sYW5nOwogICAgICAgICAgICBpcXJlc3VsdC5jKCdpZGVudGl0eScsIGF0dHJzKS51cCgpOwogICAgICAgIH0KICAgICAgICBmb3IgKHZhciBpPTA7IGk8dGhpcy5fZmVhdHVyZXMubGVuZ3RoOyBpKyspCiAgICAgICAgewogICAgICAgICAgICBpcXJlc3VsdC5jKCdmZWF0dXJlJywgeyd2YXInOnRoaXMuX2ZlYXR1cmVzW2ldfSkudXAoKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5fY29ubmVjdGlvbi5zZW5kKGlxcmVzdWx0LnRyZWUoKSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9LAogICAgLyoqIFByaXZhdGVGdW5jdGlvbjogX29uRGlzY29JdGVtcwogICAgICogQ2FsbGVkIHdoZW4gcmVjZWl2ZSBpdGVtcyByZXF1ZXN0CiAgICAgKi8KICAgIF9vbkRpc2NvSXRlbXM6IGZ1bmN0aW9uKHN0YW56YSkKICAgIHsKICAgICAgICB2YXIgcXVlcnlfYXR0cnMgPSB7eG1sbnM6IFN0cm9waGUuTlMuRElTQ09fSVRFTVN9OwogICAgICAgIHZhciBub2RlID0gc3RhbnphLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdxdWVyeScpWzBdLmdldEF0dHJpYnV0ZSgnbm9kZScpOwogICAgICAgIGlmIChub2RlKQogICAgICAgIHsKICAgICAgICAgICAgcXVlcnlfYXR0cnMubm9kZSA9IG5vZGU7CiAgICAgICAgICAgIHZhciBpdGVtcyA9IFtdOwogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuX2l0ZW1zLmxlbmd0aDsgaSsrKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5faXRlbXNbaV0ubm9kZSA9PSBub2RlKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGl0ZW1zID0gdGhpcy5faXRlbXNbaV0uY2FsbF9iYWNrKHN0YW56YSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgICAgdmFyIGl0ZW1zID0gdGhpcy5faXRlbXM7CiAgICAgICAgfQogICAgICAgIHZhciBpcXJlc3VsdCA9IHRoaXMuX2J1aWxkSVFSZXN1bHQoc3RhbnphLCBxdWVyeV9hdHRycyk7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBpdGVtcy5sZW5ndGg7IGkrKykKICAgICAgICB7CiAgICAgICAgICAgIHZhciBhdHRycyA9IHtqaWQ6ICBpdGVtc1tpXS5qaWR9OwogICAgICAgICAgICBpZiAoaXRlbXNbaV0ubmFtZSkKICAgICAgICAgICAgICAgIGF0dHJzLm5hbWUgPSBpdGVtc1tpXS5uYW1lOwogICAgICAgICAgICBpZiAoaXRlbXNbaV0ubm9kZSkKICAgICAgICAgICAgICAgIGF0dHJzLm5vZGUgPSBpdGVtc1tpXS5ub2RlOwogICAgICAgICAgICBpcXJlc3VsdC5jKCdpdGVtJywgYXR0cnMpLnVwKCk7CiAgICAgICAgfQogICAgICAgIHRoaXMuX2Nvbm5lY3Rpb24uc2VuZChpcXJlc3VsdC50cmVlKCkpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQp9KTsKCmRlZmluZSgic3Ryb3BoZS5kaXNjbyIsIFsic3Ryb3BoZSJdLCBmdW5jdGlvbigpe30pOwoKZGVmaW5lKCJjb252ZXJzZS1kZXBlbmRlbmNpZXMiLCBbCiAgICAianF1ZXJ5IiwKICAgICJ1dGlscyIsCiAgICAib3RyIiwKICAgICJtb21lbnQiLAogICAgImxvY2FsZXMiLAogICAgImJhY2tib25lLmJyb3dzZXJTdG9yYWdlIiwKICAgICJiYWNrYm9uZS5vdmVydmlldyIsCiAgICAianF1ZXJ5LmJyb3dzZXIiLAogICAgInR5cGVhaGVhZCIsCiAgICAic3Ryb3BoZSIsCiAgICAic3Ryb3BoZS5tdWMiLAogICAgInN0cm9waGUucm9zdGVyIiwKICAgICJzdHJvcGhlLnZjYXJkIiwKICAgICJzdHJvcGhlLmRpc2NvIgpdLCBmdW5jdGlvbigkLCB1dGlscywgb3RyLCBtb21lbnQpIHsKICAgIHJldHVybiB7CiAgICAgICAgJ2pRdWVyeSc6ICQsCiAgICAgICAgJ21vbWVudCc6IG1vbWVudCwKICAgICAgICAnb3RyJzogb3RyLAogICAgICAgICd1dGlscyc6IHV0aWxzCiAgICB9Owp9KTsKCi8qKgogKiBAbGljZW5zZSBSZXF1aXJlSlMgdGV4dCAyLjAuMTIgQ29weXJpZ2h0IChjKSAyMDEwLTIwMTQsIFRoZSBEb2pvIEZvdW5kYXRpb24gQWxsIFJpZ2h0cyBSZXNlcnZlZC4KICogQXZhaWxhYmxlIHZpYSB0aGUgTUlUIG9yIG5ldyBCU0QgbGljZW5zZS4KICogc2VlOiBodHRwOi8vZ2l0aHViLmNvbS9yZXF1aXJlanMvdGV4dCBmb3IgZGV0YWlscwogKi8KLypqc2xpbnQgcmVnZXhwOiB0cnVlICovCi8qZ2xvYmFsIHJlcXVpcmUsIFhNTEh0dHBSZXF1ZXN0LCBBY3RpdmVYT2JqZWN0LAogIGRlZmluZSwgd2luZG93LCBwcm9jZXNzLCBQYWNrYWdlcywKICBqYXZhLCBsb2NhdGlvbiwgQ29tcG9uZW50cywgRmlsZVV0aWxzICovCgpkZWZpbmUoJ3RleHQnLFsnbW9kdWxlJ10sIGZ1bmN0aW9uIChtb2R1bGUpIHsKICAgIAoKICAgIHZhciB0ZXh0LCBmcywgQ2MsIENpLCB4cGNJc1dpbmRvd3MsCiAgICAgICAgcHJvZ0lkcyA9IFsnTXN4bWwyLlhNTEhUVFAnLCAnTWljcm9zb2Z0LlhNTEhUVFAnLCAnTXN4bWwyLlhNTEhUVFAuNC4wJ10sCiAgICAgICAgeG1sUmVnRXhwID0gL15ccyo8XD94bWwoXHMpK3ZlcnNpb249W1wnXCJdKFxkKSouKFxkKSpbXCdcIl0oXHMpKlw/Pi9pbSwKICAgICAgICBib2R5UmVnRXhwID0gLzxib2R5W14+XSo+XHMqKFtcc1xTXSspXHMqPFwvYm9keT4vaW0sCiAgICAgICAgaGFzTG9jYXRpb24gPSB0eXBlb2YgbG9jYXRpb24gIT09ICd1bmRlZmluZWQnICYmIGxvY2F0aW9uLmhyZWYsCiAgICAgICAgZGVmYXVsdFByb3RvY29sID0gaGFzTG9jYXRpb24gJiYgbG9jYXRpb24ucHJvdG9jb2wgJiYgbG9jYXRpb24ucHJvdG9jb2wucmVwbGFjZSgvXDovLCAnJyksCiAgICAgICAgZGVmYXVsdEhvc3ROYW1lID0gaGFzTG9jYXRpb24gJiYgbG9jYXRpb24uaG9zdG5hbWUsCiAgICAgICAgZGVmYXVsdFBvcnQgPSBoYXNMb2NhdGlvbiAmJiAobG9jYXRpb24ucG9ydCB8fCB1bmRlZmluZWQpLAogICAgICAgIGJ1aWxkTWFwID0ge30sCiAgICAgICAgbWFzdGVyQ29uZmlnID0gKG1vZHVsZS5jb25maWcgJiYgbW9kdWxlLmNvbmZpZygpKSB8fCB7fTsKCiAgICB0ZXh0ID0gewogICAgICAgIHZlcnNpb246ICcyLjAuMTInLAoKICAgICAgICBzdHJpcDogZnVuY3Rpb24gKGNvbnRlbnQpIHsKICAgICAgICAgICAgLy9TdHJpcHMgPD94bWwgLi4uPz4gZGVjbGFyYXRpb25zIHNvIHRoYXQgZXh0ZXJuYWwgU1ZHIGFuZCBYTUwKICAgICAgICAgICAgLy9kb2N1bWVudHMgY2FuIGJlIGFkZGVkIHRvIGEgZG9jdW1lbnQgd2l0aG91dCB3b3JyeS4gQWxzbywgaWYgdGhlIHN0cmluZwogICAgICAgICAgICAvL2lzIGFuIEhUTUwgZG9jdW1lbnQsIG9ubHkgdGhlIHBhcnQgaW5zaWRlIHRoZSBib2R5IHRhZyBpcyByZXR1cm5lZC4KICAgICAgICAgICAgaWYgKGNvbnRlbnQpIHsKICAgICAgICAgICAgICAgIGNvbnRlbnQgPSBjb250ZW50LnJlcGxhY2UoeG1sUmVnRXhwLCAiIik7CiAgICAgICAgICAgICAgICB2YXIgbWF0Y2hlcyA9IGNvbnRlbnQubWF0Y2goYm9keVJlZ0V4cCk7CiAgICAgICAgICAgICAgICBpZiAobWF0Y2hlcykgewogICAgICAgICAgICAgICAgICAgIGNvbnRlbnQgPSBtYXRjaGVzWzFdOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29udGVudCA9ICIiOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBjb250ZW50OwogICAgICAgIH0sCgogICAgICAgIGpzRXNjYXBlOiBmdW5jdGlvbiAoY29udGVudCkgewogICAgICAgICAgICByZXR1cm4gY29udGVudC5yZXBsYWNlKC8oWydcXF0pL2csICdcXCQxJykKICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9bXGZdL2csICJcXGYiKQogICAgICAgICAgICAgICAgLnJlcGxhY2UoL1tcYl0vZywgIlxcYiIpCiAgICAgICAgICAgICAgICAucmVwbGFjZSgvW1xuXS9nLCAiXFxuIikKICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9bXHRdL2csICJcXHQiKQogICAgICAgICAgICAgICAgLnJlcGxhY2UoL1tccl0vZywgIlxcciIpCiAgICAgICAgICAgICAgICAucmVwbGFjZSgvW1x1MjAyOF0vZywgIlxcdTIwMjgiKQogICAgICAgICAgICAgICAgLnJlcGxhY2UoL1tcdTIwMjldL2csICJcXHUyMDI5Iik7CiAgICAgICAgfSwKCiAgICAgICAgY3JlYXRlWGhyOiBtYXN0ZXJDb25maWcuY3JlYXRlWGhyIHx8IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgLy9Xb3VsZCBsb3ZlIHRvIGR1bXAgdGhlIEFjdGl2ZVggY3JhcCBpbiBoZXJlLiBOZWVkIElFIDYgdG8gZGllIGZpcnN0LgogICAgICAgICAgICB2YXIgeGhyLCBpLCBwcm9nSWQ7CiAgICAgICAgICAgIGlmICh0eXBlb2YgWE1MSHR0cFJlcXVlc3QgIT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIEFjdGl2ZVhPYmplY3QgIT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgMzsgaSArPSAxKSB7CiAgICAgICAgICAgICAgICAgICAgcHJvZ0lkID0gcHJvZ0lkc1tpXTsKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICB4aHIgPSBuZXcgQWN0aXZlWE9iamVjdChwcm9nSWQpOwogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHt9CgogICAgICAgICAgICAgICAgICAgIGlmICh4aHIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcHJvZ0lkcyA9IFtwcm9nSWRdOyAgLy8gc28gZmFzdGVyIG5leHQgdGltZQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB4aHI7CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogUGFyc2VzIGEgcmVzb3VyY2UgbmFtZSBpbnRvIGl0cyBjb21wb25lbnQgcGFydHMuIFJlc291cmNlIG5hbWVzCiAgICAgICAgICogbG9vayBsaWtlOiBtb2R1bGUvbmFtZS5leHQhc3RyaXAsIHdoZXJlIHRoZSAhc3RyaXAgcGFydCBpcwogICAgICAgICAqIG9wdGlvbmFsLgogICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lIHRoZSByZXNvdXJjZSBuYW1lCiAgICAgICAgICogQHJldHVybnMge09iamVjdH0gd2l0aCBwcm9wZXJ0aWVzICJtb2R1bGVOYW1lIiwgImV4dCIgYW5kICJzdHJpcCIKICAgICAgICAgKiB3aGVyZSBzdHJpcCBpcyBhIGJvb2xlYW4uCiAgICAgICAgICovCiAgICAgICAgcGFyc2VOYW1lOiBmdW5jdGlvbiAobmFtZSkgewogICAgICAgICAgICB2YXIgbW9kTmFtZSwgZXh0LCB0ZW1wLAogICAgICAgICAgICAgICAgc3RyaXAgPSBmYWxzZSwKICAgICAgICAgICAgICAgIGluZGV4ID0gbmFtZS5pbmRleE9mKCIuIiksCiAgICAgICAgICAgICAgICBpc1JlbGF0aXZlID0gbmFtZS5pbmRleE9mKCcuLycpID09PSAwIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZS5pbmRleE9mKCcuLi8nKSA9PT0gMDsKCiAgICAgICAgICAgIGlmIChpbmRleCAhPT0gLTEgJiYgKCFpc1JlbGF0aXZlIHx8IGluZGV4ID4gMSkpIHsKICAgICAgICAgICAgICAgIG1vZE5hbWUgPSBuYW1lLnN1YnN0cmluZygwLCBpbmRleCk7CiAgICAgICAgICAgICAgICBleHQgPSBuYW1lLnN1YnN0cmluZyhpbmRleCArIDEsIG5hbWUubGVuZ3RoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG1vZE5hbWUgPSBuYW1lOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0ZW1wID0gZXh0IHx8IG1vZE5hbWU7CiAgICAgICAgICAgIGluZGV4ID0gdGVtcC5pbmRleE9mKCIhIik7CiAgICAgICAgICAgIGlmIChpbmRleCAhPT0gLTEpIHsKICAgICAgICAgICAgICAgIC8vUHVsbCBvZmYgdGhlIHN0cmlwIGFyZy4KICAgICAgICAgICAgICAgIHN0cmlwID0gdGVtcC5zdWJzdHJpbmcoaW5kZXggKyAxKSA9PT0gInN0cmlwIjsKICAgICAgICAgICAgICAgIHRlbXAgPSB0ZW1wLnN1YnN0cmluZygwLCBpbmRleCk7CiAgICAgICAgICAgICAgICBpZiAoZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgZXh0ID0gdGVtcDsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbW9kTmFtZSA9IHRlbXA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBtb2R1bGVOYW1lOiBtb2ROYW1lLAogICAgICAgICAgICAgICAgZXh0OiBleHQsCiAgICAgICAgICAgICAgICBzdHJpcDogc3RyaXAKICAgICAgICAgICAgfTsKICAgICAgICB9LAoKICAgICAgICB4ZFJlZ0V4cDogL14oKFx3KylcOik/XC9cLyhbXlwvXFxdKykvLAoKICAgICAgICAvKioKICAgICAgICAgKiBJcyBhbiBVUkwgb24gYW5vdGhlciBkb21haW4uIE9ubHkgd29ya3MgZm9yIGJyb3dzZXIgdXNlLCByZXR1cm5zCiAgICAgICAgICogZmFsc2UgaW4gbm9uLWJyb3dzZXIgZW52aXJvbm1lbnRzLiBPbmx5IHVzZWQgdG8ga25vdyBpZiBhbgogICAgICAgICAqIG9wdGltaXplZCAuanMgdmVyc2lvbiBvZiBhIHRleHQgcmVzb3VyY2Ugc2hvdWxkIGJlIGxvYWRlZAogICAgICAgICAqIGluc3RlYWQuCiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IHVybAogICAgICAgICAqIEByZXR1cm5zIEJvb2xlYW4KICAgICAgICAgKi8KICAgICAgICB1c2VYaHI6IGZ1bmN0aW9uICh1cmwsIHByb3RvY29sLCBob3N0bmFtZSwgcG9ydCkgewogICAgICAgICAgICB2YXIgdVByb3RvY29sLCB1SG9zdE5hbWUsIHVQb3J0LAogICAgICAgICAgICAgICAgbWF0Y2ggPSB0ZXh0LnhkUmVnRXhwLmV4ZWModXJsKTsKICAgICAgICAgICAgaWYgKCFtYXRjaCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdVByb3RvY29sID0gbWF0Y2hbMl07CiAgICAgICAgICAgIHVIb3N0TmFtZSA9IG1hdGNoWzNdOwoKICAgICAgICAgICAgdUhvc3ROYW1lID0gdUhvc3ROYW1lLnNwbGl0KCc6Jyk7CiAgICAgICAgICAgIHVQb3J0ID0gdUhvc3ROYW1lWzFdOwogICAgICAgICAgICB1SG9zdE5hbWUgPSB1SG9zdE5hbWVbMF07CgogICAgICAgICAgICByZXR1cm4gKCF1UHJvdG9jb2wgfHwgdVByb3RvY29sID09PSBwcm90b2NvbCkgJiYKICAgICAgICAgICAgICAgICAgICghdUhvc3ROYW1lIHx8IHVIb3N0TmFtZS50b0xvd2VyQ2FzZSgpID09PSBob3N0bmFtZS50b0xvd2VyQ2FzZSgpKSAmJgogICAgICAgICAgICAgICAgICAgKCghdVBvcnQgJiYgIXVIb3N0TmFtZSkgfHwgdVBvcnQgPT09IHBvcnQpOwogICAgICAgIH0sCgogICAgICAgIGZpbmlzaExvYWQ6IGZ1bmN0aW9uIChuYW1lLCBzdHJpcCwgY29udGVudCwgb25Mb2FkKSB7CiAgICAgICAgICAgIGNvbnRlbnQgPSBzdHJpcCA/IHRleHQuc3RyaXAoY29udGVudCkgOiBjb250ZW50OwogICAgICAgICAgICBpZiAobWFzdGVyQ29uZmlnLmlzQnVpbGQpIHsKICAgICAgICAgICAgICAgIGJ1aWxkTWFwW25hbWVdID0gY29udGVudDsKICAgICAgICAgICAgfQogICAgICAgICAgICBvbkxvYWQoY29udGVudCk7CiAgICAgICAgfSwKCiAgICAgICAgbG9hZDogZnVuY3Rpb24gKG5hbWUsIHJlcSwgb25Mb2FkLCBjb25maWcpIHsKICAgICAgICAgICAgLy9OYW1lIGhhcyBmb3JtYXQ6IHNvbWUubW9kdWxlLmZpbGV4dCFzdHJpcAogICAgICAgICAgICAvL1RoZSBzdHJpcCBwYXJ0IGlzIG9wdGlvbmFsLgogICAgICAgICAgICAvL2lmIHN0cmlwIGlzIHByZXNlbnQsIHRoZW4gdGhhdCBtZWFucyBvbmx5IGdldCB0aGUgc3RyaW5nIGNvbnRlbnRzCiAgICAgICAgICAgIC8vaW5zaWRlIGEgYm9keSB0YWcgaW4gYW4gSFRNTCBzdHJpbmcuIEZvciBYTUwvU1ZHIGNvbnRlbnQgaXQgbWVhbnMKICAgICAgICAgICAgLy9yZW1vdmluZyB0aGUgPD94bWwgLi4uPz4gZGVjbGFyYXRpb25zIHNvIHRoZSBjb250ZW50IGNhbiBiZSBpbnNlcnRlZAogICAgICAgICAgICAvL2ludG8gdGhlIGN1cnJlbnQgZG9jIHdpdGhvdXQgcHJvYmxlbXMuCgogICAgICAgICAgICAvLyBEbyBub3QgYm90aGVyIHdpdGggdGhlIHdvcmsgaWYgYSBidWlsZCBhbmQgdGV4dCB3aWxsCiAgICAgICAgICAgIC8vIG5vdCBiZSBpbmxpbmVkLgogICAgICAgICAgICBpZiAoY29uZmlnICYmIGNvbmZpZy5pc0J1aWxkICYmICFjb25maWcuaW5saW5lVGV4dCkgewogICAgICAgICAgICAgICAgb25Mb2FkKCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG1hc3RlckNvbmZpZy5pc0J1aWxkID0gY29uZmlnICYmIGNvbmZpZy5pc0J1aWxkOwoKICAgICAgICAgICAgdmFyIHBhcnNlZCA9IHRleHQucGFyc2VOYW1lKG5hbWUpLAogICAgICAgICAgICAgICAgbm9uU3RyaXBOYW1lID0gcGFyc2VkLm1vZHVsZU5hbWUgKwogICAgICAgICAgICAgICAgICAgIChwYXJzZWQuZXh0ID8gJy4nICsgcGFyc2VkLmV4dCA6ICcnKSwKICAgICAgICAgICAgICAgIHVybCA9IHJlcS50b1VybChub25TdHJpcE5hbWUpLAogICAgICAgICAgICAgICAgdXNlWGhyID0gKG1hc3RlckNvbmZpZy51c2VYaHIpIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0LnVzZVhocjsKCiAgICAgICAgICAgIC8vIERvIG5vdCBsb2FkIGlmIGl0IGlzIGFuIGVtcHR5OiB1cmwKICAgICAgICAgICAgaWYgKHVybC5pbmRleE9mKCdlbXB0eTonKSA9PT0gMCkgewogICAgICAgICAgICAgICAgb25Mb2FkKCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vTG9hZCB0aGUgdGV4dC4gVXNlIFhIUiBpZiBwb3NzaWJsZSBhbmQgaW4gYSBicm93c2VyLgogICAgICAgICAgICBpZiAoIWhhc0xvY2F0aW9uIHx8IHVzZVhocih1cmwsIGRlZmF1bHRQcm90b2NvbCwgZGVmYXVsdEhvc3ROYW1lLCBkZWZhdWx0UG9ydCkpIHsKICAgICAgICAgICAgICAgIHRleHQuZ2V0KHVybCwgZnVuY3Rpb24gKGNvbnRlbnQpIHsKICAgICAgICAgICAgICAgICAgICB0ZXh0LmZpbmlzaExvYWQobmFtZSwgcGFyc2VkLnN0cmlwLCBjb250ZW50LCBvbkxvYWQpOwogICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikgewogICAgICAgICAgICAgICAgICAgIGlmIChvbkxvYWQuZXJyb3IpIHsKICAgICAgICAgICAgICAgICAgICAgICAgb25Mb2FkLmVycm9yKGVycik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvL05lZWQgdG8gZmV0Y2ggdGhlIHJlc291cmNlIGFjcm9zcyBkb21haW5zLiBBc3N1bWUKICAgICAgICAgICAgICAgIC8vdGhlIHJlc291cmNlIGhhcyBiZWVuIG9wdGltaXplZCBpbnRvIGEgSlMgbW9kdWxlLiBGZXRjaAogICAgICAgICAgICAgICAgLy9ieSB0aGUgbW9kdWxlIG5hbWUgKyBleHRlbnNpb24sIGJ1dCBkbyBub3QgaW5jbHVkZSB0aGUKICAgICAgICAgICAgICAgIC8vIXN0cmlwIHBhcnQgdG8gYXZvaWQgZmlsZSBzeXN0ZW0gaXNzdWVzLgogICAgICAgICAgICAgICAgcmVxKFtub25TdHJpcE5hbWVdLCBmdW5jdGlvbiAoY29udGVudCkgewogICAgICAgICAgICAgICAgICAgIHRleHQuZmluaXNoTG9hZChwYXJzZWQubW9kdWxlTmFtZSArICcuJyArIHBhcnNlZC5leHQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlZC5zdHJpcCwgY29udGVudCwgb25Mb2FkKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfSwKCiAgICAgICAgd3JpdGU6IGZ1bmN0aW9uIChwbHVnaW5OYW1lLCBtb2R1bGVOYW1lLCB3cml0ZSwgY29uZmlnKSB7CiAgICAgICAgICAgIGlmIChidWlsZE1hcC5oYXNPd25Qcm9wZXJ0eShtb2R1bGVOYW1lKSkgewogICAgICAgICAgICAgICAgdmFyIGNvbnRlbnQgPSB0ZXh0LmpzRXNjYXBlKGJ1aWxkTWFwW21vZHVsZU5hbWVdKTsKICAgICAgICAgICAgICAgIHdyaXRlLmFzTW9kdWxlKHBsdWdpbk5hbWUgKyAiISIgKyBtb2R1bGVOYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImRlZmluZShmdW5jdGlvbiAoKSB7IHJldHVybiAnIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudCArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiJzt9KTtcbiIpOwogICAgICAgICAgICB9CiAgICAgICAgfSwKCiAgICAgICAgd3JpdGVGaWxlOiBmdW5jdGlvbiAocGx1Z2luTmFtZSwgbW9kdWxlTmFtZSwgcmVxLCB3cml0ZSwgY29uZmlnKSB7CiAgICAgICAgICAgIHZhciBwYXJzZWQgPSB0ZXh0LnBhcnNlTmFtZShtb2R1bGVOYW1lKSwKICAgICAgICAgICAgICAgIGV4dFBhcnQgPSBwYXJzZWQuZXh0ID8gJy4nICsgcGFyc2VkLmV4dCA6ICcnLAogICAgICAgICAgICAgICAgbm9uU3RyaXBOYW1lID0gcGFyc2VkLm1vZHVsZU5hbWUgKyBleHRQYXJ0LAogICAgICAgICAgICAgICAgLy9Vc2UgYSAnLmpzJyBmaWxlIG5hbWUgc28gdGhhdCBpdCBpbmRpY2F0ZXMgaXQgaXMgYQogICAgICAgICAgICAgICAgLy9zY3JpcHQgdGhhdCBjYW4gYmUgbG9hZGVkIGFjcm9zcyBkb21haW5zLgogICAgICAgICAgICAgICAgZmlsZU5hbWUgPSByZXEudG9VcmwocGFyc2VkLm1vZHVsZU5hbWUgKyBleHRQYXJ0KSArICcuanMnOwoKICAgICAgICAgICAgLy9MZXZlcmFnZSBvd24gbG9hZCgpIG1ldGhvZCB0byBsb2FkIHBsdWdpbiB2YWx1ZSwgYnV0IG9ubHkKICAgICAgICAgICAgLy93cml0ZSBvdXQgdmFsdWVzIHRoYXQgZG8gbm90IGhhdmUgdGhlIHN0cmlwIGFyZ3VtZW50LAogICAgICAgICAgICAvL3RvIGF2b2lkIGFueSBwb3RlbnRpYWwgaXNzdWVzIHdpdGggISBpbiBmaWxlIG5hbWVzLgogICAgICAgICAgICB0ZXh0LmxvYWQobm9uU3RyaXBOYW1lLCByZXEsIGZ1bmN0aW9uICh2YWx1ZSkgewogICAgICAgICAgICAgICAgLy9Vc2Ugb3duIHdyaXRlKCkgbWV0aG9kIHRvIGNvbnN0cnVjdCBmdWxsIG1vZHVsZSB2YWx1ZS4KICAgICAgICAgICAgICAgIC8vQnV0IG5lZWQgdG8gY3JlYXRlIHNoZWxsIHRoYXQgdHJhbnNsYXRlcyB3cml0ZUZpbGUncwogICAgICAgICAgICAgICAgLy93cml0ZSgpIHRvIHRoZSByaWdodCBpbnRlcmZhY2UuCiAgICAgICAgICAgICAgICB2YXIgdGV4dFdyaXRlID0gZnVuY3Rpb24gKGNvbnRlbnRzKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyaXRlKGZpbGVOYW1lLCBjb250ZW50cyk7CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgdGV4dFdyaXRlLmFzTW9kdWxlID0gZnVuY3Rpb24gKG1vZHVsZU5hbWUsIGNvbnRlbnRzKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdyaXRlLmFzTW9kdWxlKG1vZHVsZU5hbWUsIGZpbGVOYW1lLCBjb250ZW50cyk7CiAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgIHRleHQud3JpdGUocGx1Z2luTmFtZSwgbm9uU3RyaXBOYW1lLCB0ZXh0V3JpdGUsIGNvbmZpZyk7CiAgICAgICAgICAgIH0sIGNvbmZpZyk7CiAgICAgICAgfQogICAgfTsKCiAgICBpZiAobWFzdGVyQ29uZmlnLmVudiA9PT0gJ25vZGUnIHx8ICghbWFzdGVyQ29uZmlnLmVudiAmJgogICAgICAgICAgICB0eXBlb2YgcHJvY2VzcyAhPT0gInVuZGVmaW5lZCIgJiYKICAgICAgICAgICAgcHJvY2Vzcy52ZXJzaW9ucyAmJgogICAgICAgICAgICAhIXByb2Nlc3MudmVyc2lvbnMubm9kZSAmJgogICAgICAgICAgICAhcHJvY2Vzcy52ZXJzaW9uc1snbm9kZS13ZWJraXQnXSkpIHsKICAgICAgICAvL1VzaW5nIHNwZWNpYWwgcmVxdWlyZS5ub2RlUmVxdWlyZSwgc29tZXRoaW5nIGFkZGVkIGJ5IHIuanMuCiAgICAgICAgZnMgPSByZXF1aXJlLm5vZGVSZXF1aXJlKCdmcycpOwoKICAgICAgICB0ZXh0LmdldCA9IGZ1bmN0aW9uICh1cmwsIGNhbGxiYWNrLCBlcnJiYWNrKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICB2YXIgZmlsZSA9IGZzLnJlYWRGaWxlU3luYyh1cmwsICd1dGY4Jyk7CiAgICAgICAgICAgICAgICAvL1JlbW92ZSBCT00gKEJ5dGUgTWFyayBPcmRlcikgZnJvbSB1dGY4IGZpbGVzIGlmIGl0IGlzIHRoZXJlLgogICAgICAgICAgICAgICAgaWYgKGZpbGUuaW5kZXhPZignXHVGRUZGJykgPT09IDApIHsKICAgICAgICAgICAgICAgICAgICBmaWxlID0gZmlsZS5zdWJzdHJpbmcoMSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYWxsYmFjayhmaWxlKTsKICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgaWYgKGVycmJhY2spIHsKICAgICAgICAgICAgICAgICAgICBlcnJiYWNrKGUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgIH0gZWxzZSBpZiAobWFzdGVyQ29uZmlnLmVudiA9PT0gJ3hocicgfHwgKCFtYXN0ZXJDb25maWcuZW52ICYmCiAgICAgICAgICAgIHRleHQuY3JlYXRlWGhyKCkpKSB7CiAgICAgICAgdGV4dC5nZXQgPSBmdW5jdGlvbiAodXJsLCBjYWxsYmFjaywgZXJyYmFjaywgaGVhZGVycykgewogICAgICAgICAgICB2YXIgeGhyID0gdGV4dC5jcmVhdGVYaHIoKSwgaGVhZGVyOwogICAgICAgICAgICB4aHIub3BlbignR0VUJywgdXJsLCB0cnVlKTsKCiAgICAgICAgICAgIC8vQWxsb3cgcGx1Z2lucyBkaXJlY3QgYWNjZXNzIHRvIHhociBoZWFkZXJzCiAgICAgICAgICAgIGlmIChoZWFkZXJzKSB7CiAgICAgICAgICAgICAgICBmb3IgKGhlYWRlciBpbiBoZWFkZXJzKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGhlYWRlcnMuaGFzT3duUHJvcGVydHkoaGVhZGVyKSkgewogICAgICAgICAgICAgICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihoZWFkZXIudG9Mb3dlckNhc2UoKSwgaGVhZGVyc1toZWFkZXJdKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vQWxsb3cgb3ZlcnJpZGVzIHNwZWNpZmllZCBpbiBjb25maWcKICAgICAgICAgICAgaWYgKG1hc3RlckNvbmZpZy5vblhocikgewogICAgICAgICAgICAgICAgbWFzdGVyQ29uZmlnLm9uWGhyKHhociwgdXJsKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uIChldnQpIHsKICAgICAgICAgICAgICAgIHZhciBzdGF0dXMsIGVycjsKICAgICAgICAgICAgICAgIC8vRG8gbm90IGV4cGxpY2l0bHkgaGFuZGxlIGVycm9ycywgdGhvc2Ugc2hvdWxkIGJlCiAgICAgICAgICAgICAgICAvL3Zpc2libGUgdmlhIGNvbnNvbGUgb3V0cHV0IGluIHRoZSBicm93c2VyLgogICAgICAgICAgICAgICAgaWYgKHhoci5yZWFkeVN0YXRlID09PSA0KSB7CiAgICAgICAgICAgICAgICAgICAgc3RhdHVzID0geGhyLnN0YXR1cyB8fCAwOwogICAgICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgPiAzOTkgJiYgc3RhdHVzIDwgNjAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vQW4gaHR0cCA0eHggb3IgNXh4IGVycm9yLiBTaWduYWwgYW4gZXJyb3IuCiAgICAgICAgICAgICAgICAgICAgICAgIGVyciA9IG5ldyBFcnJvcih1cmwgKyAnIEhUVFAgc3RhdHVzOiAnICsgc3RhdHVzKTsKICAgICAgICAgICAgICAgICAgICAgICAgZXJyLnhociA9IHhocjsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVycmJhY2spIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycmJhY2soZXJyKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKHhoci5yZXNwb25zZVRleHQpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYgKG1hc3RlckNvbmZpZy5vblhockNvbXBsZXRlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG1hc3RlckNvbmZpZy5vblhockNvbXBsZXRlKHhociwgdXJsKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHhoci5zZW5kKG51bGwpOwogICAgICAgIH07CiAgICB9IGVsc2UgaWYgKG1hc3RlckNvbmZpZy5lbnYgPT09ICdyaGlubycgfHwgKCFtYXN0ZXJDb25maWcuZW52ICYmCiAgICAgICAgICAgIHR5cGVvZiBQYWNrYWdlcyAhPT0gJ3VuZGVmaW5lZCcgJiYgdHlwZW9mIGphdmEgIT09ICd1bmRlZmluZWQnKSkgewogICAgICAgIC8vV2h5IEphdmEsIHdoeSBpcyB0aGlzIHNvIGF3a3dhcmQ/CiAgICAgICAgdGV4dC5nZXQgPSBmdW5jdGlvbiAodXJsLCBjYWxsYmFjaykgewogICAgICAgICAgICB2YXIgc3RyaW5nQnVmZmVyLCBsaW5lLAogICAgICAgICAgICAgICAgZW5jb2RpbmcgPSAidXRmLTgiLAogICAgICAgICAgICAgICAgZmlsZSA9IG5ldyBqYXZhLmlvLkZpbGUodXJsKSwKICAgICAgICAgICAgICAgIGxpbmVTZXBhcmF0b3IgPSBqYXZhLmxhbmcuU3lzdGVtLmdldFByb3BlcnR5KCJsaW5lLnNlcGFyYXRvciIpLAogICAgICAgICAgICAgICAgaW5wdXQgPSBuZXcgamF2YS5pby5CdWZmZXJlZFJlYWRlcihuZXcgamF2YS5pby5JbnB1dFN0cmVhbVJlYWRlcihuZXcgamF2YS5pby5GaWxlSW5wdXRTdHJlYW0oZmlsZSksIGVuY29kaW5nKSksCiAgICAgICAgICAgICAgICBjb250ZW50ID0gJyc7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBzdHJpbmdCdWZmZXIgPSBuZXcgamF2YS5sYW5nLlN0cmluZ0J1ZmZlcigpOwogICAgICAgICAgICAgICAgbGluZSA9IGlucHV0LnJlYWRMaW5lKCk7CgogICAgICAgICAgICAgICAgLy8gQnl0ZSBPcmRlciBNYXJrIChCT00pIC0gVGhlIFVuaWNvZGUgU3RhbmRhcmQsIHZlcnNpb24gMy4wLCBwYWdlIDMyNAogICAgICAgICAgICAgICAgLy8gaHR0cDovL3d3dy51bmljb2RlLm9yZy9mYXEvdXRmX2JvbS5odG1sCgogICAgICAgICAgICAgICAgLy8gTm90ZSB0aGF0IHdoZW4gd2UgdXNlIHV0Zi04LCB0aGUgQk9NIHNob3VsZCBhcHBlYXIgYXMgIkVGIEJCIEJGIiwgYnV0IGl0IGRvZXNuJ3QgZHVlIHRvIHRoaXMgYnVnIGluIHRoZSBKREs6CiAgICAgICAgICAgICAgICAvLyBodHRwOi8vYnVncy5zdW4uY29tL2J1Z2RhdGFiYXNlL3ZpZXdfYnVnLmRvP2J1Z19pZD00NTA4MDU4CiAgICAgICAgICAgICAgICBpZiAobGluZSAmJiBsaW5lLmxlbmd0aCgpICYmIGxpbmUuY2hhckF0KDApID09PSAweGZlZmYpIHsKICAgICAgICAgICAgICAgICAgICAvLyBFYXQgdGhlIEJPTSwgc2luY2Ugd2UndmUgYWxyZWFkeSBmb3VuZCB0aGUgZW5jb2Rpbmcgb24gdGhpcyBmaWxlLAogICAgICAgICAgICAgICAgICAgIC8vIGFuZCB3ZSBwbGFuIHRvIGNvbmNhdGVuYXRpbmcgdGhpcyBidWZmZXIgd2l0aCBvdGhlcnM7IHRoZSBCT00gc2hvdWxkCiAgICAgICAgICAgICAgICAgICAgLy8gb25seSBhcHBlYXIgYXQgdGhlIHRvcCBvZiBhIGZpbGUuCiAgICAgICAgICAgICAgICAgICAgbGluZSA9IGxpbmUuc3Vic3RyaW5nKDEpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChsaW5lICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgc3RyaW5nQnVmZmVyLmFwcGVuZChsaW5lKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB3aGlsZSAoKGxpbmUgPSBpbnB1dC5yZWFkTGluZSgpKSAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIHN0cmluZ0J1ZmZlci5hcHBlbmQobGluZVNlcGFyYXRvcik7CiAgICAgICAgICAgICAgICAgICAgc3RyaW5nQnVmZmVyLmFwcGVuZChsaW5lKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vTWFrZSBzdXJlIHdlIHJldHVybiBhIEphdmFTY3JpcHQgc3RyaW5nIGFuZCBub3QgYSBKYXZhIHN0cmluZy4KICAgICAgICAgICAgICAgIGNvbnRlbnQgPSBTdHJpbmcoc3RyaW5nQnVmZmVyLnRvU3RyaW5nKCkpOyAvL1N0cmluZwogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgaW5wdXQuY2xvc2UoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYWxsYmFjayhjb250ZW50KTsKICAgICAgICB9OwogICAgfSBlbHNlIGlmIChtYXN0ZXJDb25maWcuZW52ID09PSAneHBjb25uZWN0JyB8fCAoIW1hc3RlckNvbmZpZy5lbnYgJiYKICAgICAgICAgICAgdHlwZW9mIENvbXBvbmVudHMgIT09ICd1bmRlZmluZWQnICYmIENvbXBvbmVudHMuY2xhc3NlcyAmJgogICAgICAgICAgICBDb21wb25lbnRzLmludGVyZmFjZXMpKSB7CiAgICAgICAgLy9BdmVydCB5b3VyIGdhemUhCiAgICAgICAgQ2MgPSBDb21wb25lbnRzLmNsYXNzZXM7CiAgICAgICAgQ2kgPSBDb21wb25lbnRzLmludGVyZmFjZXM7CiAgICAgICAgQ29tcG9uZW50cy51dGlsc1snaW1wb3J0J10oJ3Jlc291cmNlOi8vZ3JlL21vZHVsZXMvRmlsZVV0aWxzLmpzbScpOwogICAgICAgIHhwY0lzV2luZG93cyA9ICgnQG1vemlsbGEub3JnL3dpbmRvd3MtcmVnaXN0cnkta2V5OzEnIGluIENjKTsKCiAgICAgICAgdGV4dC5nZXQgPSBmdW5jdGlvbiAodXJsLCBjYWxsYmFjaykgewogICAgICAgICAgICB2YXIgaW5TdHJlYW0sIGNvbnZlcnRTdHJlYW0sIGZpbGVPYmosCiAgICAgICAgICAgICAgICByZWFkRGF0YSA9IHt9OwoKICAgICAgICAgICAgaWYgKHhwY0lzV2luZG93cykgewogICAgICAgICAgICAgICAgdXJsID0gdXJsLnJlcGxhY2UoL1wvL2csICdcXCcpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmaWxlT2JqID0gbmV3IEZpbGVVdGlscy5GaWxlKHVybCk7CgogICAgICAgICAgICAvL1hQQ09NLCB5b3Ugc28gY3JhenkKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGluU3RyZWFtID0gQ2NbJ0Btb3ppbGxhLm9yZy9uZXR3b3JrL2ZpbGUtaW5wdXQtc3RyZWFtOzEnXQogICAgICAgICAgICAgICAgICAgICAgICAgICAuY3JlYXRlSW5zdGFuY2UoQ2kubnNJRmlsZUlucHV0U3RyZWFtKTsKICAgICAgICAgICAgICAgIGluU3RyZWFtLmluaXQoZmlsZU9iaiwgMSwgMCwgZmFsc2UpOwoKICAgICAgICAgICAgICAgIGNvbnZlcnRTdHJlYW0gPSBDY1snQG1vemlsbGEub3JnL2ludGwvY29udmVydGVyLWlucHV0LXN0cmVhbTsxJ10KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY3JlYXRlSW5zdGFuY2UoQ2kubnNJQ29udmVydGVySW5wdXRTdHJlYW0pOwogICAgICAgICAgICAgICAgY29udmVydFN0cmVhbS5pbml0KGluU3RyZWFtLCAidXRmLTgiLCBpblN0cmVhbS5hdmFpbGFibGUoKSwKICAgICAgICAgICAgICAgIENpLm5zSUNvbnZlcnRlcklucHV0U3RyZWFtLkRFRkFVTFRfUkVQTEFDRU1FTlRfQ0hBUkFDVEVSKTsKCiAgICAgICAgICAgICAgICBjb252ZXJ0U3RyZWFtLnJlYWRTdHJpbmcoaW5TdHJlYW0uYXZhaWxhYmxlKCksIHJlYWREYXRhKTsKICAgICAgICAgICAgICAgIGNvbnZlcnRTdHJlYW0uY2xvc2UoKTsKICAgICAgICAgICAgICAgIGluU3RyZWFtLmNsb3NlKCk7CiAgICAgICAgICAgICAgICBjYWxsYmFjayhyZWFkRGF0YS52YWx1ZSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigoZmlsZU9iaiAmJiBmaWxlT2JqLnBhdGggfHwgJycpICsgJzogJyArIGUpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgIH0KICAgIHJldHVybiB0ZXh0Owp9KTsKCi8vIFJlcXVpcmVKUyBVbmRlcnNjb3JlSlMgdGVtcGxhdGUgcGx1Z2luCi8vIGh0dHA6Ly9naXRodWIuY29tL2pmcGFyYWRpcy9yZXF1aXJlanMtdHBsCi8vCi8vIEFuIGFsdGVybmF0aXZlIHRvIGh0dHA6Ly9naXRodWIuY29tL1plZUFnZW5jeS9yZXF1aXJlanMtdHBsCi8vCi8vIFVzaW5nIFVuZGVyc2NvcmVKUyBtaWNyby10ZW1wbGF0ZXMgYXQgaHR0cDovL3VuZGVyc2NvcmVqcy5vcmcvI3RlbXBsYXRlCi8vIFVzaW5nIGFuZCBSZXF1aXJlSlMgdGV4dC5qcyBhdCBodHRwOi8vcmVxdWlyZWpzLm9yZy9kb2NzL2FwaS5odG1sI3RleHQKLy8gQGF1dGhvciBKRiBQYXJhZGlzCi8vIEB2ZXJzaW9uIDAuMC4yCi8vCi8vIFJlbGVhc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZQovLwovLyBVc2FnZToKLy8gICByZXF1aXJlKFsnYmFja2JvbmUnLCAndHBsIW15dGVtcGxhdGUnXSwgZnVuY3Rpb24gKEJhY2tib25lLCBteXRlbXBsYXRlKSB7Ci8vICAgICByZXR1cm4gQmFja2JvbmUuVmlldy5leHRlbmQoewovLyAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbigpewovLyAgICAgICAgIHRoaXMucmVuZGVyKCk7Ci8vICAgICAgIH0sCi8vICAgICAgIHJlbmRlcjogZnVuY3Rpb24oKXsKLy8gICAgICAgICB0aGlzLiRlbC5odG1sKG15dGVtcGxhdGUoe21lc3NhZ2U6ICdoZWxsbyd9KSk7Ci8vICAgICB9KTsKLy8gICB9KTsKLy8KLy8gQ29uZmlndXJhdGlvbjogKG9wdGlvbmFsKQovLyAgIHJlcXVpcmUuY29uZmlnKHsKLy8gICAgIHRwbDogewovLyAgICAgICBleHRlbnNpb246ICcudHBsJyAvLyBkZWZhdWx0ID0gJy5odG1sJwovLyAgICAgfQovLyAgIH0pOwoKLypqc2xpbnQgbm9tZW46IHRydWUgKi8KLypnbG9iYWwgZGVmaW5lOiBmYWxzZSAqLwoKZGVmaW5lKCd0cGwnLFsndGV4dCcsICd1bmRlcnNjb3JlJ10sIGZ1bmN0aW9uICh0ZXh0LCBfKSB7CiAgICAKCiAgICB2YXIgYnVpbGRNYXAgPSB7fSwKICAgICAgICBidWlsZFRlbXBsYXRlU291cmNlID0gImRlZmluZSgne3BsdWdpbk5hbWV9IXttb2R1bGVOYW1lfScsIGZ1bmN0aW9uICgpIHsgcmV0dXJuIHtzb3VyY2V9OyB9KTtcbiI7CgogICAgcmV0dXJuIHsKICAgICAgICB2ZXJzaW9uOiAnMC4wLjInLAoKICAgICAgICBsb2FkOiBmdW5jdGlvbiAobW9kdWxlTmFtZSwgcGFyZW50UmVxdWlyZSwgb25sb2FkLCBjb25maWcpIHsKCiAgICAgICAgICAgIGlmIChjb25maWcudHBsICYmIGNvbmZpZy50cGwudGVtcGxhdGVTZXR0aW5ncykgewogICAgICAgICAgICAgICAgXy50ZW1wbGF0ZVNldHRpbmdzID0gY29uZmlnLnRwbC50ZW1wbGF0ZVNldHRpbmdzOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoYnVpbGRNYXBbbW9kdWxlTmFtZV0pIHsKICAgICAgICAgICAgICAgIG9ubG9hZChidWlsZE1hcFttb2R1bGVOYW1lXSk7CgogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdmFyIGV4dCA9IChjb25maWcudHBsICYmIGNvbmZpZy50cGwuZXh0ZW5zaW9uKSB8fCAnLmh0bWwnOwogICAgICAgICAgICAgICAgdmFyIHBhdGggPSAoY29uZmlnLnRwbCAmJiBjb25maWcudHBsLnBhdGgpIHx8ICcnOwogICAgICAgICAgICAgICAgdGV4dC5sb2FkKHBhdGggKyBtb2R1bGVOYW1lICsgZXh0LCBwYXJlbnRSZXF1aXJlLCBmdW5jdGlvbiAoc291cmNlKSB7CiAgICAgICAgICAgICAgICAgICAgYnVpbGRNYXBbbW9kdWxlTmFtZV0gPSBfLnRlbXBsYXRlKHNvdXJjZSk7CiAgICAgICAgICAgICAgICAgICAgb25sb2FkKGJ1aWxkTWFwW21vZHVsZU5hbWVdKTsKICAgICAgICAgICAgICAgIH0sIGNvbmZpZyk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAoKICAgICAgICB3cml0ZTogZnVuY3Rpb24gKHBsdWdpbk5hbWUsIG1vZHVsZU5hbWUsIHdyaXRlKSB7CiAgICAgICAgICAgIHZhciBidWlsZCA9IGJ1aWxkTWFwW21vZHVsZU5hbWVdLAogICAgICAgICAgICAgICAgc291cmNlID0gYnVpbGQgJiYgYnVpbGQuc291cmNlOwogICAgICAgICAgICBpZiAoc291cmNlKSB7CiAgICAgICAgICAgICAgICB3cml0ZS5hc01vZHVsZShwbHVnaW5OYW1lICsgJyEnICsgbW9kdWxlTmFtZSwKICAgICAgICAgICAgICAgICAgICBidWlsZFRlbXBsYXRlU291cmNlCiAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoJ3twbHVnaW5OYW1lfScsIHBsdWdpbk5hbWUpCiAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoJ3ttb2R1bGVOYW1lfScsIG1vZHVsZU5hbWUpCiAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoJ3tzb3VyY2V9Jywgc291cmNlKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Owp9KTsKCgpkZWZpbmUoJ3RwbCFhY3Rpb24nLCBbXSxmdW5jdGlvbiAoKSB7IHJldHVybiBmdW5jdGlvbihvYmopewp2YXIgX190LF9fcD0nJyxfX2o9QXJyYXkucHJvdG90eXBlLmpvaW4scHJpbnQ9ZnVuY3Rpb24oKXtfX3ArPV9fai5jYWxsKGFyZ3VtZW50cywnJyk7fTsKd2l0aChvYmp8fHt9KXsKX19wKz0nPGRpdiBjbGFzcz0iY2hhdC1tZXNzYWdlICcrCigoX190PShleHRyYV9jbGFzc2VzKSk9PW51bGw/Jyc6X190KSsKJyI+XG4gICAgPHNwYW4gY2xhc3M9ImNoYXQtbWVzc2FnZS0nKwooKF9fdD0oc2VuZGVyKSk9PW51bGw/Jyc6X190KSsKJyI+JysKKChfX3Q9KHRpbWUpKT09bnVsbD8nJzpfX3QpKwonICoqJysKKChfX3Q9KHVzZXJuYW1lKSk9PW51bGw/Jyc6X190KSsKJyA8L3NwYW4+XG4gICAgPHNwYW4gY2xhc3M9ImNoYXQtbWVzc2FnZS1jb250ZW50Ij4nKwooKF9fdD0obWVzc2FnZSkpPT1udWxsPycnOl9fdCkrCic8L3NwYW4+XG48L2Rpdj5cbic7Cn0KcmV0dXJuIF9fcDsKfTsgfSk7CgoKZGVmaW5lKCd0cGwhYWRkX2NvbnRhY3RfZHJvcGRvd24nLCBbXSxmdW5jdGlvbiAoKSB7IHJldHVybiBmdW5jdGlvbihvYmopewp2YXIgX190LF9fcD0nJyxfX2o9QXJyYXkucHJvdG90eXBlLmpvaW4scHJpbnQ9ZnVuY3Rpb24oKXtfX3ArPV9fai5jYWxsKGFyZ3VtZW50cywnJyk7fTsKd2l0aChvYmp8fHt9KXsKX19wKz0nPGRsIGNsYXNzPSJhZGQtY29udmVyc2UtY29udGFjdCBkcm9wZG93biI+XG4gICAgPGR0IGlkPSJ4bXBwLWNvbnRhY3Qtc2VhcmNoIiBjbGFzcz0iZmFuY3ktZHJvcGRvd24iPlxuICAgICAgICA8YSBjbGFzcz0idG9nZ2xlLXhtcHAtY29udGFjdC1mb3JtIiBocmVmPSIjIlxuICAgICAgICAgICAgdGl0bGU9IicrCigoX190PShsYWJlbF9jbGlja190b19jaGF0KSk9PW51bGw/Jyc6X190KSsKJyI+XG4gICAgICAgIDxzcGFuIGNsYXNzPSJpY29uLXBsdXMiPjwvc3Bhbj4nKwooKF9fdD0obGFiZWxfYWRkX2NvbnRhY3QpKT09bnVsbD8nJzpfX3QpKwonPC9hPlxuICAgIDwvZHQ+XG4gICAgPGRkIGNsYXNzPSJzZWFyY2gteG1wcCIgc3R5bGU9ImRpc3BsYXk6bm9uZSI+PHVsPjwvdWw+PC9kZD5cbjwvZGw+XG4nOwp9CnJldHVybiBfX3A7Cn07IH0pOwoKCmRlZmluZSgndHBsIWFkZF9jb250YWN0X2Zvcm0nLCBbXSxmdW5jdGlvbiAoKSB7IHJldHVybiBmdW5jdGlvbihvYmopewp2YXIgX190LF9fcD0nJyxfX2o9QXJyYXkucHJvdG90eXBlLmpvaW4scHJpbnQ9ZnVuY3Rpb24oKXtfX3ArPV9fai5jYWxsKGFyZ3VtZW50cywnJyk7fTsKd2l0aChvYmp8fHt9KXsKX19wKz0nPGxpPlxuICAgIDxmb3JtIGNsYXNzPSJhZGQteG1wcC1jb250YWN0Ij5cbiAgICAgICAgPGlucHV0IHR5cGU9InRleHQiXG4gICAgICAgICAgICBuYW1lPSJpZGVudGlmaWVyIlxuICAgICAgICAgICAgY2xhc3M9InVzZXJuYW1lIlxuICAgICAgICAgICAgcGxhY2Vob2xkZXI9IicrCigoX190PShsYWJlbF9jb250YWN0X3VzZXJuYW1lKSk9PW51bGw/Jyc6X190KSsKJyIvPlxuICAgICAgICA8YnV0dG9uIHR5cGU9InN1Ym1pdCI+JysKKChfX3Q9KGxhYmVsX2FkZCkpPT1udWxsPycnOl9fdCkrCic8L2J1dHRvbj5cbiAgICA8L2Zvcm0+XG48L2xpPlxuJzsKfQpyZXR1cm4gX19wOwp9OyB9KTsKCgpkZWZpbmUoJ3RwbCFjaGFuZ2Vfc3RhdHVzX21lc3NhZ2UnLCBbXSxmdW5jdGlvbiAoKSB7IHJldHVybiBmdW5jdGlvbihvYmopewp2YXIgX190LF9fcD0nJyxfX2o9QXJyYXkucHJvdG90eXBlLmpvaW4scHJpbnQ9ZnVuY3Rpb24oKXtfX3ArPV9fai5jYWxsKGFyZ3VtZW50cywnJyk7fTsKd2l0aChvYmp8fHt9KXsKX19wKz0nPGZvcm0gaWQ9InNldC1jdXN0b20teG1wcC1zdGF0dXMiPlxuICAgIDxpbnB1dCB0eXBlPSJ0ZXh0IiBjbGFzcz0iY3VzdG9tLXhtcHAtc3RhdHVzIiAnKwooKF9fdD0oc3RhdHVzX21lc3NhZ2UpKT09bnVsbD8nJzpfX3QpKwonXG4gICAgICAgIHBsYWNlaG9sZGVyPSInKwooKF9fdD0obGFiZWxfY3VzdG9tX3N0YXR1cykpPT1udWxsPycnOl9fdCkrCiciLz5cbiAgICA8YnV0dG9uIHR5cGU9InN1Ym1pdCI+JysKKChfX3Q9KGxhYmVsX3NhdmUpKT09bnVsbD8nJzpfX3QpKwonPC9idXR0b24+XG48L2Zvcm0+XG4nOwp9CnJldHVybiBfX3A7Cn07IH0pOwoKCmRlZmluZSgndHBsIWNoYXRfc3RhdHVzJywgW10sZnVuY3Rpb24gKCkgeyByZXR1cm4gZnVuY3Rpb24ob2JqKXsKdmFyIF9fdCxfX3A9JycsX19qPUFycmF5LnByb3RvdHlwZS5qb2luLHByaW50PWZ1bmN0aW9uKCl7X19wKz1fX2ouY2FsbChhcmd1bWVudHMsJycpO307CndpdGgob2JqfHx7fSl7Cl9fcCs9JzxkaXYgY2xhc3M9InhtcHAtc3RhdHVzIj5cbiAgICA8YSBjbGFzcz0iY2hvb3NlLXhtcHAtc3RhdHVzICcrCigoX190PShjaGF0X3N0YXR1cykpPT1udWxsPycnOl9fdCkrCiciXG4gICAgICAgZGF0YS12YWx1ZT0iJysKKChfX3Q9KHN0YXR1c19tZXNzYWdlKSk9PW51bGw/Jyc6X190KSsKJyJcbiAgICAgICBocmVmPSIjIiB0aXRsZT0iJysKKChfX3Q9KGRlc2NfY2hhbmdlX3N0YXR1cykpPT1udWxsPycnOl9fdCkrCiciPlxuXG4gICAgICAgIDxzcGFuIGNsYXNzPSJpY29uLScrCigoX190PShjaGF0X3N0YXR1cykpPT1udWxsPycnOl9fdCkrCiciPjwvc3Bhbj4nKwooKF9fdD0oc3RhdHVzX21lc3NhZ2UpKT09bnVsbD8nJzpfX3QpKwonXG4gICAgPC9hPlxuICAgIDxhIGNsYXNzPSJjaGFuZ2UteG1wcC1zdGF0dXMtbWVzc2FnZSBpY29uLXBlbmNpbCJcbiAgICAgICAgaHJlZj0iIyJcbiAgICAgICAgdGl0bGU9IicrCigoX190PShkZXNjX2N1c3RvbV9zdGF0dXMpKT09bnVsbD8nJzpfX3QpKwonIj48L2E+XG48L2Rpdj5cbic7Cn0KcmV0dXJuIF9fcDsKfTsgfSk7CgoKZGVmaW5lKCd0cGwhY2hhdGFyZWEnLCBbXSxmdW5jdGlvbiAoKSB7IHJldHVybiBmdW5jdGlvbihvYmopewp2YXIgX190LF9fcD0nJyxfX2o9QXJyYXkucHJvdG90eXBlLmpvaW4scHJpbnQ9ZnVuY3Rpb24oKXtfX3ArPV9fai5jYWxsKGFyZ3VtZW50cywnJyk7fTsKd2l0aChvYmp8fHt9KXsKX19wKz0nPGRpdiBjbGFzcz0iY2hhdC1hcmVhIj5cbiAgICA8ZGl2IGNsYXNzPSJjaGF0LWNvbnRlbnQiPjwvZGl2PlxuICAgIDxmb3JtIGNsYXNzPSJzZW5kWE1QUE1lc3NhZ2UiIGFjdGlvbj0iIiBtZXRob2Q9InBvc3QiPlxuICAgICAgICAnOwogaWYgKHNob3dfdG9vbGJhcikgeyAKX19wKz0nXG4gICAgICAgICAgICA8dWwgY2xhc3M9ImNoYXQtdG9vbGJhciBuby10ZXh0LXNlbGVjdCI+PC91bD5cbiAgICAgICAgJzsKIH0gCl9fcCs9J1xuICAgICAgICA8dGV4dGFyZWEgdHlwZT0idGV4dCIgY2xhc3M9ImNoYXQtdGV4dGFyZWEiIFxuICAgICAgICAgICAgcGxhY2Vob2xkZXI9IicrCigoX190PShsYWJlbF9tZXNzYWdlKSk9PW51bGw/Jyc6X190KSsKJyIvPlxuICAgIDwvZm9ybT5cbjwvZGl2PlxuJzsKfQpyZXR1cm4gX19wOwp9OyB9KTsKCgpkZWZpbmUoJ3RwbCFjaGF0Ym94JywgW10sZnVuY3Rpb24gKCkgeyByZXR1cm4gZnVuY3Rpb24ob2JqKXsKdmFyIF9fdCxfX3A9JycsX19qPUFycmF5LnByb3RvdHlwZS5qb2luLHByaW50PWZ1bmN0aW9uKCl7X19wKz1fX2ouY2FsbChhcmd1bWVudHMsJycpO307CndpdGgob2JqfHx7fSl7Cl9fcCs9JzxkaXYgY2xhc3M9ImJveC1mbHlvdXQiIHN0eWxlPSJoZWlnaHQ6ICcrCigoX190PShoZWlnaHQpKT09bnVsbD8nJzpfX3QpKwoncHgiPlxuICAgIDxkaXYgY2xhc3M9ImRyYWdyZXNpemUgZHJhZ3Jlc2l6ZS10bSI+PC9kaXY+XG4gICAgPGRpdiBjbGFzcz0iY2hhdC1oZWFkIGNoYXQtaGVhZC1jaGF0Ym94Ij5cbiAgICAgICAgPGEgY2xhc3M9ImNsb3NlLWNoYXRib3gtYnV0dG9uIGljb24tY2xvc2UiPjwvYT5cbiAgICAgICAgPGEgY2xhc3M9InRvZ2dsZS1jaGF0Ym94LWJ1dHRvbiBpY29uLW1pbnVzIj48L2E+XG4gICAgICAgIDxkaXYgY2xhc3M9ImNoYXQtdGl0bGUiPlxuICAgICAgICAgICAgJzsKIGlmICh1cmwpIHsgCl9fcCs9J1xuICAgICAgICAgICAgICAgIDxhIGhyZWY9IicrCigoX190PSh1cmwpKT09bnVsbD8nJzpfX3QpKwonIiB0YXJnZXQ9Il9ibGFuayIgY2xhc3M9InVzZXIiPlxuICAgICAgICAgICAgJzsKIH0gCl9fcCs9J1xuICAgICAgICAgICAgICAgICAgICAnKwooKF9fdD0oIGZ1bGxuYW1lICkpPT1udWxsPycnOl9fdCkrCidcbiAgICAgICAgICAgICc7CiBpZiAodXJsKSB7IApfX3ArPSdcbiAgICAgICAgICAgICAgICA8L2E+XG4gICAgICAgICAgICAnOwogfSAKX19wKz0nXG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8cCBjbGFzcz0idXNlci1jdXN0b20tbWVzc2FnZSI+PHAvPlxuICAgIDwvZGl2PlxuICAgIDxkaXYgY2xhc3M9ImNoYXQtYm9keSI+XG4gICAgICAgIDxkaXYgY2xhc3M9ImNoYXQtY29udGVudCI+PC9kaXY+XG4gICAgICAgIDxmb3JtIGNsYXNzPSJzZW5kWE1QUE1lc3NhZ2UiIGFjdGlvbj0iIiBtZXRob2Q9InBvc3QiPlxuICAgICAgICAgICAgJzsKIGlmIChzaG93X3Rvb2xiYXIpIHsgCl9fcCs9J1xuICAgICAgICAgICAgICAgIDx1bCBjbGFzcz0iY2hhdC10b29sYmFyIG5vLXRleHQtc2VsZWN0Ij48L3VsPlxuICAgICAgICAgICAgJzsKIH0gCl9fcCs9J1xuICAgICAgICA8dGV4dGFyZWFcbiAgICAgICAgICAgIHR5cGU9InRleHQiXG4gICAgICAgICAgICBjbGFzcz0iY2hhdC10ZXh0YXJlYSJcbiAgICAgICAgICAgIHBsYWNlaG9sZGVyPSInKwooKF9fdD0obGFiZWxfcGVyc29uYWxfbWVzc2FnZSkpPT1udWxsPycnOl9fdCkrCiciLz5cbiAgICAgICAgPC9mb3JtPlxuICAgIDwvZGl2PlxuPC9kaXY+XG4nOwp9CnJldHVybiBfX3A7Cn07IH0pOwoKCmRlZmluZSgndHBsIWNoYXRyb29tJywgW10sZnVuY3Rpb24gKCkgeyByZXR1cm4gZnVuY3Rpb24ob2JqKXsKdmFyIF9fdCxfX3A9JycsX19qPUFycmF5LnByb3RvdHlwZS5qb2luLHByaW50PWZ1bmN0aW9uKCl7X19wKz1fX2ouY2FsbChhcmd1bWVudHMsJycpO307CndpdGgob2JqfHx7fSl7Cl9fcCs9JzxkaXYgY2xhc3M9ImJveC1mbHlvdXQiIHN0eWxlPSJoZWlnaHQ6ICcrCigoX190PShoZWlnaHQpKT09bnVsbD8nJzpfX3QpKwoncHgiXG4gICAgJzsKIGlmIChtaW5pbWl6ZWQpIHsgCl9fcCs9JyBzdHlsZT0iZGlzcGxheTpub25lIiAnOwogfSAKX19wKz0nPlxuICAgIDxkaXYgY2xhc3M9ImRyYWdyZXNpemUgZHJhZ3Jlc2l6ZS10bSI+PC9kaXY+XG4gICAgPGRpdiBjbGFzcz0iY2hhdC1oZWFkIGNoYXQtaGVhZC1jaGF0cm9vbSI+XG4gICAgICAgIDxhIGNsYXNzPSJjbG9zZS1jaGF0Ym94LWJ1dHRvbiBpY29uLWNsb3NlIj48L2E+XG4gICAgICAgIDxhIGNsYXNzPSJ0b2dnbGUtY2hhdGJveC1idXR0b24gaWNvbi1taW51cyI+PC9hPlxuICAgICAgICA8YSBjbGFzcz0iY29uZmlndXJlLWNoYXRyb29tLWJ1dHRvbiBpY29uLXdyZW5jaCIgc3R5bGU9ImRpc3BsYXk6bm9uZSI+PC9hPlxuICAgICAgICA8ZGl2IGNsYXNzPSJjaGF0LXRpdGxlIj4gJysKKChfX3Q9KCBuYW1lICkpPT1udWxsPycnOl9fdCkrCicgPC9kaXY+XG4gICAgICAgIDxwIGNsYXNzPSJjaGF0cm9vbS10b3BpYyI+PHAvPlxuICAgIDwvZGl2PlxuICAgIDxkaXYgY2xhc3M9ImNoYXQtYm9keSI+PHNwYW4gY2xhc3M9InNwaW5uZXIgY2VudGVyZWQiLz48L2Rpdj5cbjwvZGl2PlxuJzsKfQpyZXR1cm4gX19wOwp9OyB9KTsKCgpkZWZpbmUoJ3RwbCFjaGF0cm9vbV9wYXNzd29yZF9mb3JtJywgW10sZnVuY3Rpb24gKCkgeyByZXR1cm4gZnVuY3Rpb24ob2JqKXsKdmFyIF9fdCxfX3A9JycsX19qPUFycmF5LnByb3RvdHlwZS5qb2luLHByaW50PWZ1bmN0aW9uKCl7X19wKz1fX2ouY2FsbChhcmd1bWVudHMsJycpO307CndpdGgob2JqfHx7fSl7Cl9fcCs9JzxkaXYgY2xhc3M9ImNoYXRyb29tLWZvcm0tY29udGFpbmVyIj5cbiAgICA8Zm9ybSBjbGFzcz0iY2hhdHJvb20tZm9ybSI+XG4gICAgICAgIDxsZWdlbmQ+JysKKChfX3Q9KGhlYWRpbmcpKT09bnVsbD8nJzpfX3QpKwonPC9sZWdlbmQ+XG4gICAgICAgIDxsYWJlbD4nKwooKF9fdD0obGFiZWxfcGFzc3dvcmQpKT09bnVsbD8nJzpfX3QpKwonPGlucHV0IHR5cGU9InBhc3N3b3JkIiBuYW1lPSJwYXNzd29yZCIvPjwvbGFiZWw+XG4gICAgICAgIDxpbnB1dCB0eXBlPSJzdWJtaXQiIHZhbHVlPSInKwooKF9fdD0obGFiZWxfc3VibWl0KSk9PW51bGw/Jyc6X190KSsKJyIvPlxuICAgIDwvZm9ybT5cbjwvZGl2PlxuJzsKfQpyZXR1cm4gX19wOwp9OyB9KTsKCgpkZWZpbmUoJ3RwbCFjaGF0cm9vbV9zaWRlYmFyJywgW10sZnVuY3Rpb24gKCkgeyByZXR1cm4gZnVuY3Rpb24ob2JqKXsKdmFyIF9fdCxfX3A9JycsX19qPUFycmF5LnByb3RvdHlwZS5qb2luLHByaW50PWZ1bmN0aW9uKCl7X19wKz1fX2ouY2FsbChhcmd1bWVudHMsJycpO307CndpdGgob2JqfHx7fSl7Cl9fcCs9JzwhLS0gPGRpdiBjbGFzcz0icGFydGljaXBhbnRzIj4gLS0+XG48Zm9ybSBjbGFzcz0icm9vbS1pbnZpdGUiPlxuICAgIDxpbnB1dCBjbGFzcz0iaW52aXRlZC1jb250YWN0IiBwbGFjZWhvbGRlcj0iJysKKChfX3Q9KGxhYmVsX2ludml0YXRpb24pKT09bnVsbD8nJzpfX3QpKwonIiB0eXBlPSJ0ZXh0Ii8+XG48L2Zvcm0+XG48bGFiZWw+JysKKChfX3Q9KGxhYmVsX29jY3VwYW50cykpPT1udWxsPycnOl9fdCkrCic6PC9sYWJlbD5cbjx1bCBjbGFzcz0icGFydGljaXBhbnQtbGlzdCI+PC91bD5cbjwhLS0gPC9kaXY+IC0tPlxuJzsKfQpyZXR1cm4gX19wOwp9OyB9KTsKCgpkZWZpbmUoJ3RwbCFjaGF0cm9vbXNfdGFiJywgW10sZnVuY3Rpb24gKCkgeyByZXR1cm4gZnVuY3Rpb24ob2JqKXsKdmFyIF9fdCxfX3A9JycsX19qPUFycmF5LnByb3RvdHlwZS5qb2luLHByaW50PWZ1bmN0aW9uKCl7X19wKz1fX2ouY2FsbChhcmd1bWVudHMsJycpO307CndpdGgob2JqfHx7fSl7Cl9fcCs9JzxsaT48YSBjbGFzcz0icyIgaHJlZj0iI2NoYXRyb29tcyI+JysKKChfX3Q9KGxhYmVsX3Jvb21zKSk9PW51bGw/Jyc6X190KSsKJzwvYT48L2xpPlxuJzsKfQpyZXR1cm4gX19wOwp9OyB9KTsKCgpkZWZpbmUoJ3RwbCFjaGF0c19wYW5lbCcsIFtdLGZ1bmN0aW9uICgpIHsgcmV0dXJuIGZ1bmN0aW9uKG9iail7CnZhciBfX3QsX19wPScnLF9faj1BcnJheS5wcm90b3R5cGUuam9pbixwcmludD1mdW5jdGlvbigpe19fcCs9X19qLmNhbGwoYXJndW1lbnRzLCcnKTt9Owp3aXRoKG9ianx8e30pewpfX3ArPSc8ZGl2IGlkPSJtaW5pbWl6ZWQtY2hhdHMiPlxuICAgIDxhIGlkPSJ0b2dnbGUtbWluaW1pemVkLWNoYXRzIiBocmVmPSIjIj48L2E+XG4gICAgPGRpdiBjbGFzcz0ibWluaW1pemVkLWNoYXRzLWZseW91dCI+PC9kaXY+XG48L2Rpdj5cbic7Cn0KcmV0dXJuIF9fcDsKfTsgfSk7CgoKZGVmaW5lKCd0cGwhY2hvb3NlX3N0YXR1cycsIFtdLGZ1bmN0aW9uICgpIHsgcmV0dXJuIGZ1bmN0aW9uKG9iail7CnZhciBfX3QsX19wPScnLF9faj1BcnJheS5wcm90b3R5cGUuam9pbixwcmludD1mdW5jdGlvbigpe19fcCs9X19qLmNhbGwoYXJndW1lbnRzLCcnKTt9Owp3aXRoKG9ianx8e30pewpfX3ArPSc8ZGwgaWQ9InRhcmdldCIgY2xhc3M9ImRyb3Bkb3duIj5cbiAgICA8ZHQgaWQ9ImZhbmN5LXhtcHAtc3RhdHVzLXNlbGVjdCIgY2xhc3M9ImZhbmN5LWRyb3Bkb3duIj48L2R0PlxuICAgIDxkZD48dWwgY2xhc3M9InhtcHAtc3RhdHVzLW1lbnUiPjwvdWw+PC9kZD5cbjwvZGw+XG4nOwp9CnJldHVybiBfX3A7Cn07IH0pOwoKCmRlZmluZSgndHBsIWNvbnRhY3RzX3BhbmVsJywgW10sZnVuY3Rpb24gKCkgeyByZXR1cm4gZnVuY3Rpb24ob2JqKXsKdmFyIF9fdCxfX3A9JycsX19qPUFycmF5LnByb3RvdHlwZS5qb2luLHByaW50PWZ1bmN0aW9uKCl7X19wKz1fX2ouY2FsbChhcmd1bWVudHMsJycpO307CndpdGgob2JqfHx7fSl7Cl9fcCs9Jzxmb3JtIGNsYXNzPSJzZXQteG1wcC1zdGF0dXMiIGFjdGlvbj0iIiBtZXRob2Q9InBvc3QiPlxuICAgIDxzcGFuIGlkPSJ4bXBwLXN0YXR1cy1ob2xkZXIiPlxuICAgICAgICA8c2VsZWN0IGlkPSJzZWxlY3QteG1wcC1zdGF0dXMiIHN0eWxlPSJkaXNwbGF5Om5vbmUiPlxuICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0ib25saW5lIj4nKwooKF9fdD0obGFiZWxfb25saW5lKSk9PW51bGw/Jyc6X190KSsKJzwvb3B0aW9uPlxuICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iZG5kIj4nKwooKF9fdD0obGFiZWxfYnVzeSkpPT1udWxsPycnOl9fdCkrCic8L29wdGlvbj5cbiAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9ImF3YXkiPicrCigoX190PShsYWJlbF9hd2F5KSk9PW51bGw/Jyc6X190KSsKJzwvb3B0aW9uPlxuICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0ib2ZmbGluZSI+JysKKChfX3Q9KGxhYmVsX29mZmxpbmUpKT09bnVsbD8nJzpfX3QpKwonPC9vcHRpb24+XG4gICAgICAgICAgICAnOwogaWYgKGFsbG93X2xvZ291dCkgIHsgCl9fcCs9J1xuICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0ibG9nb3V0Ij4nKwooKF9fdD0obGFiZWxfbG9nb3V0KSk9PW51bGw/Jyc6X190KSsKJzwvb3B0aW9uPlxuICAgICAgICAgICAgJzsKIH0gCl9fcCs9J1xuICAgICAgICA8L3NlbGVjdD5cbiAgICA8L3NwYW4+XG48L2Zvcm0+XG4nOwp9CnJldHVybiBfX3A7Cn07IH0pOwoKCmRlZmluZSgndHBsIWNvbnRhY3RzX3RhYicsIFtdLGZ1bmN0aW9uICgpIHsgcmV0dXJuIGZ1bmN0aW9uKG9iail7CnZhciBfX3QsX19wPScnLF9faj1BcnJheS5wcm90b3R5cGUuam9pbixwcmludD1mdW5jdGlvbigpe19fcCs9X19qLmNhbGwoYXJndW1lbnRzLCcnKTt9Owp3aXRoKG9ianx8e30pewpfX3ArPSc8bGk+PGEgY2xhc3M9InMgY3VycmVudCIgaHJlZj0iI3VzZXJzIj4nKwooKF9fdD0obGFiZWxfY29udGFjdHMpKT09bnVsbD8nJzpfX3QpKwonPC9hPjwvbGk+XG4nOwp9CnJldHVybiBfX3A7Cn07IH0pOwoKCmRlZmluZSgndHBsIWNvbnRyb2xib3gnLCBbXSxmdW5jdGlvbiAoKSB7IHJldHVybiBmdW5jdGlvbihvYmopewp2YXIgX190LF9fcD0nJyxfX2o9QXJyYXkucHJvdG90eXBlLmpvaW4scHJpbnQ9ZnVuY3Rpb24oKXtfX3ArPV9fai5jYWxsKGFyZ3VtZW50cywnJyk7fTsKd2l0aChvYmp8fHt9KXsKX19wKz0nPGRpdiBjbGFzcz0iYm94LWZseW91dCIgc3R5bGU9ImhlaWdodDogJysKKChfX3Q9KGhlaWdodCkpPT1udWxsPycnOl9fdCkrCidweCI+XG4gICAgPGRpdiBjbGFzcz0iZHJhZ3Jlc2l6ZSBkcmFncmVzaXplLXRtIj48L2Rpdj5cbiAgICA8ZGl2IGNsYXNzPSJjaGF0LWhlYWQgY29udHJvbGJveC1oZWFkIj5cbiAgICAgICAgPHVsIGlkPSJjb250cm9sYm94LXRhYnMiPjwvdWw+XG4gICAgICAgIDxhIGNsYXNzPSJjbG9zZS1jaGF0Ym94LWJ1dHRvbiBpY29uLWNsb3NlIj48L2E+XG4gICAgPC9kaXY+XG4gICAgPGRpdiBjbGFzcz0iY29udHJvbGJveC1wYW5lcyI+PC9kaXY+XG48L2Rpdj5cbic7Cn0KcmV0dXJuIF9fcDsKfTsgfSk7CgoKZGVmaW5lKCd0cGwhY29udHJvbGJveF90b2dnbGUnLCBbXSxmdW5jdGlvbiAoKSB7IHJldHVybiBmdW5jdGlvbihvYmopewp2YXIgX190LF9fcD0nJyxfX2o9QXJyYXkucHJvdG90eXBlLmpvaW4scHJpbnQ9ZnVuY3Rpb24oKXtfX3ArPV9fai5jYWxsKGFyZ3VtZW50cywnJyk7fTsKd2l0aChvYmp8fHt9KXsKX19wKz0nPHNwYW4gY2xhc3M9ImNvbm4tZmVlZGJhY2siPicrCigoX190PShsYWJlbF90b2dnbGUpKT09bnVsbD8nJzpfX3QpKwonPC9zcGFuPlxuPHNwYW4gc3R5bGU9ImRpc3BsYXk6IG5vbmUiIGlkPSJvbmxpbmUtY291bnQiPigwKTwvc3Bhbj5cbic7Cn0KcmV0dXJuIF9fcDsKfTsgfSk7CgoKZGVmaW5lKCd0cGwhZmllbGQnLCBbXSxmdW5jdGlvbiAoKSB7IHJldHVybiBmdW5jdGlvbihvYmopewp2YXIgX190LF9fcD0nJyxfX2o9QXJyYXkucHJvdG90eXBlLmpvaW4scHJpbnQ9ZnVuY3Rpb24oKXtfX3ArPV9fai5jYWxsKGFyZ3VtZW50cywnJyk7fTsKd2l0aChvYmp8fHt9KXsKX19wKz0nPGZpZWxkIHZhcj0iJysKKChfX3Q9KG5hbWUpKT09bnVsbD8nJzpfX3QpKwonIj48dmFsdWU+JysKKChfX3Q9KHZhbHVlKSk9PW51bGw/Jyc6X190KSsKJzwvdmFsdWU+PC9maWVsZD5cbic7Cn0KcmV0dXJuIF9fcDsKfTsgfSk7CgoKZGVmaW5lKCd0cGwhZm9ybV9jaGVja2JveCcsIFtdLGZ1bmN0aW9uICgpIHsgcmV0dXJuIGZ1bmN0aW9uKG9iail7CnZhciBfX3QsX19wPScnLF9faj1BcnJheS5wcm90b3R5cGUuam9pbixwcmludD1mdW5jdGlvbigpe19fcCs9X19qLmNhbGwoYXJndW1lbnRzLCcnKTt9Owp3aXRoKG9ianx8e30pewpfX3ArPSc8bGFiZWw+JysKKChfX3Q9KGxhYmVsKSk9PW51bGw/Jyc6X190KSsKJzxpbnB1dCBuYW1lPSInKwooKF9fdD0obmFtZSkpPT1udWxsPycnOl9fdCkrCiciIHR5cGU9IicrCigoX190PSh0eXBlKSk9PW51bGw/Jyc6X190KSsKJyIgJysKKChfX3Q9KGNoZWNrZWQpKT09bnVsbD8nJzpfX3QpKwonPjwvbGFiZWw+XG4nOwp9CnJldHVybiBfX3A7Cn07IH0pOwoKCmRlZmluZSgndHBsIWZvcm1faW5wdXQnLCBbXSxmdW5jdGlvbiAoKSB7IHJldHVybiBmdW5jdGlvbihvYmopewp2YXIgX190LF9fcD0nJyxfX2o9QXJyYXkucHJvdG90eXBlLmpvaW4scHJpbnQ9ZnVuY3Rpb24oKXtfX3ArPV9fai5jYWxsKGFyZ3VtZW50cywnJyk7fTsKd2l0aChvYmp8fHt9KXsKX19wKz0nPGxhYmVsPicrCigoX190PShsYWJlbCkpPT1udWxsPycnOl9fdCkrCic8aW5wdXQgbmFtZT0iJysKKChfX3Q9KG5hbWUpKT09bnVsbD8nJzpfX3QpKwonIiB0eXBlPSInKwooKF9fdD0odHlwZSkpPT1udWxsPycnOl9fdCkrCiciIHZhbHVlPSInKwooKF9fdD0odmFsdWUpKT09bnVsbD8nJzpfX3QpKwonIj48L2xhYmVsPlxuJzsKfQpyZXR1cm4gX19wOwp9OyB9KTsKCgpkZWZpbmUoJ3RwbCFmb3JtX3NlbGVjdCcsIFtdLGZ1bmN0aW9uICgpIHsgcmV0dXJuIGZ1bmN0aW9uKG9iail7CnZhciBfX3QsX19wPScnLF9faj1BcnJheS5wcm90b3R5cGUuam9pbixwcmludD1mdW5jdGlvbigpe19fcCs9X19qLmNhbGwoYXJndW1lbnRzLCcnKTt9Owp3aXRoKG9ianx8e30pewpfX3ArPSc8bGFiZWw+JysKKChfX3Q9KGxhYmVsKSk9PW51bGw/Jyc6X190KSsKJzxzZWxlY3QgbmFtZT0iJysKKChfX3Q9KG5hbWUpKT09bnVsbD8nJzpfX3QpKwonIj4nKwooKF9fdD0ob3B0aW9ucykpPT1udWxsPycnOl9fdCkrCic8L3NlbGVjdD48L2xhYmVsPlxuJzsKfQpyZXR1cm4gX19wOwp9OyB9KTsKCgpkZWZpbmUoJ3RwbCFncm91cF9oZWFkZXInLCBbXSxmdW5jdGlvbiAoKSB7IHJldHVybiBmdW5jdGlvbihvYmopewp2YXIgX190LF9fcD0nJyxfX2o9QXJyYXkucHJvdG90eXBlLmpvaW4scHJpbnQ9ZnVuY3Rpb24oKXtfX3ArPV9fai5jYWxsKGFyZ3VtZW50cywnJyk7fTsKd2l0aChvYmp8fHt9KXsKX19wKz0nPGEgaHJlZj0iIyIgY2xhc3M9Imdyb3VwLXRvZ2dsZSBpY29uLScrCigoX190PSh0b2dnbGVfc3RhdGUpKT09bnVsbD8nJzpfX3QpKwonIiB0aXRsZT0iJysKKChfX3Q9KGRlc2NfZ3JvdXBfdG9nZ2xlKSk9PW51bGw/Jyc6X190KSsKJyI+JysKKChfX3Q9KGxhYmVsX2dyb3VwKSk9PW51bGw/Jyc6X190KSsKJzwvYT5cbic7Cn0KcmV0dXJuIF9fcDsKfTsgfSk7CgoKZGVmaW5lKCd0cGwhaW5mbycsIFtdLGZ1bmN0aW9uICgpIHsgcmV0dXJuIGZ1bmN0aW9uKG9iail7CnZhciBfX3QsX19wPScnLF9faj1BcnJheS5wcm90b3R5cGUuam9pbixwcmludD1mdW5jdGlvbigpe19fcCs9X19qLmNhbGwoYXJndW1lbnRzLCcnKTt9Owp3aXRoKG9ianx8e30pewpfX3ArPSc8ZGl2IGNsYXNzPSJjaGF0LWluZm8iPicrCigoX190PShtZXNzYWdlKSk9PW51bGw/Jyc6X190KSsKJzwvZGl2PlxuJzsKfQpyZXR1cm4gX19wOwp9OyB9KTsKCgpkZWZpbmUoJ3RwbCFsb2dpbl9wYW5lbCcsIFtdLGZ1bmN0aW9uICgpIHsgcmV0dXJuIGZ1bmN0aW9uKG9iail7CnZhciBfX3QsX19wPScnLF9faj1BcnJheS5wcm90b3R5cGUuam9pbixwcmludD1mdW5jdGlvbigpe19fcCs9X19qLmNhbGwoYXJndW1lbnRzLCcnKTt9Owp3aXRoKG9ianx8e30pewpfX3ArPSc8Zm9ybSBpZD0iY29udmVyc2UtbG9naW4iIG1ldGhvZD0icG9zdCI+XG4gICAgPGxhYmVsPicrCigoX190PShsYWJlbF91c2VybmFtZSkpPT1udWxsPycnOl9fdCkrCic8L2xhYmVsPlxuICAgIDxpbnB1dCB0eXBlPSJ1c2VybmFtZSIgbmFtZT0iamlkIiBwbGFjZWhvbGRlcj0iVXNlcm5hbWUiPlxuICAgIDxsYWJlbD4nKwooKF9fdD0obGFiZWxfcGFzc3dvcmQpKT09bnVsbD8nJzpfX3QpKwonPC9sYWJlbD5cbiAgICA8aW5wdXQgdHlwZT0icGFzc3dvcmQiIG5hbWU9InBhc3N3b3JkIiBwbGFjZWhvbGRlcj0iUGFzc3dvcmQiPlxuICAgIDxpbnB1dCBjbGFzcz0ibG9naW4tc3VibWl0IiB0eXBlPSJzdWJtaXQiIHZhbHVlPSInKwooKF9fdD0obGFiZWxfbG9naW4pKT09bnVsbD8nJzpfX3QpKwonIj5cbiAgICA8c3BhbiBjbGFzcz0iY29ubi1mZWVkYmFjayI+PC9zcGFuPlxuPC9mb3JtPlxuJzsKfQpyZXR1cm4gX19wOwp9OyB9KTsKCgpkZWZpbmUoJ3RwbCFsb2dpbl90YWInLCBbXSxmdW5jdGlvbiAoKSB7IHJldHVybiBmdW5jdGlvbihvYmopewp2YXIgX190LF9fcD0nJyxfX2o9QXJyYXkucHJvdG90eXBlLmpvaW4scHJpbnQ9ZnVuY3Rpb24oKXtfX3ArPV9fai5jYWxsKGFyZ3VtZW50cywnJyk7fTsKd2l0aChvYmp8fHt9KXsKX19wKz0nPGxpPjxhIGNsYXNzPSJjdXJyZW50IiBocmVmPSIjbG9naW4iPicrCigoX190PShsYWJlbF9zaWduX2luKSk9PW51bGw/Jyc6X190KSsKJzwvYT48L2xpPlxuJzsKfQpyZXR1cm4gX19wOwp9OyB9KTsKCgpkZWZpbmUoJ3RwbCFtZXNzYWdlJywgW10sZnVuY3Rpb24gKCkgeyByZXR1cm4gZnVuY3Rpb24ob2JqKXsKdmFyIF9fdCxfX3A9JycsX19qPUFycmF5LnByb3RvdHlwZS5qb2luLHByaW50PWZ1bmN0aW9uKCl7X19wKz1fX2ouY2FsbChhcmd1bWVudHMsJycpO307CndpdGgob2JqfHx7fSl7Cl9fcCs9JzxkaXYgY2xhc3M9ImNoYXQtbWVzc2FnZSAnKwooKF9fdD0oZXh0cmFfY2xhc3NlcykpPT1udWxsPycnOl9fdCkrCiciPlxuICAgIDxzcGFuIGNsYXNzPSJjaGF0LW1lc3NhZ2UtJysKKChfX3Q9KHNlbmRlcikpPT1udWxsPycnOl9fdCkrCiciPicrCigoX190PSh0aW1lKSk9PW51bGw/Jyc6X190KSsKJyAnKwooKF9fdD0odXNlcm5hbWUpKT09bnVsbD8nJzpfX3QpKwonOiZuYnNwOzwvc3Bhbj5cbiAgICA8c3BhbiBjbGFzcz0iY2hhdC1tZXNzYWdlLWNvbnRlbnQiPicrCigoX190PShtZXNzYWdlKSk9PW51bGw/Jyc6X190KSsKJzwvc3Bhbj5cbjwvZGl2PlxuJzsKfQpyZXR1cm4gX19wOwp9OyB9KTsKCgpkZWZpbmUoJ3RwbCFuZXdfZGF5JywgW10sZnVuY3Rpb24gKCkgeyByZXR1cm4gZnVuY3Rpb24ob2JqKXsKdmFyIF9fdCxfX3A9JycsX19qPUFycmF5LnByb3RvdHlwZS5qb2luLHByaW50PWZ1bmN0aW9uKCl7X19wKz1fX2ouY2FsbChhcmd1bWVudHMsJycpO307CndpdGgob2JqfHx7fSl7Cl9fcCs9Jzx0aW1lIGNsYXNzPSJjaGF0LWRhdGUiIGRhdGV0aW1lPSInKwooKF9fdD0oaXNvZGF0ZSkpPT1udWxsPycnOl9fdCkrCiciPicrCigoX190PShkYXRlc3RyaW5nKSk9PW51bGw/Jyc6X190KSsKJzwvdGltZT5cbic7Cn0KcmV0dXJuIF9fcDsKfTsgfSk7CgoKZGVmaW5lKCd0cGwhb2NjdXBhbnQnLCBbXSxmdW5jdGlvbiAoKSB7IHJldHVybiBmdW5jdGlvbihvYmopewp2YXIgX190LF9fcD0nJyxfX2o9QXJyYXkucHJvdG90eXBlLmpvaW4scHJpbnQ9ZnVuY3Rpb24oKXtfX3ArPV9fai5jYWxsKGFyZ3VtZW50cywnJyk7fTsKd2l0aChvYmp8fHt9KXsKX19wKz0nPGxpIGNsYXNzPSInKwooKF9fdD0ocm9sZSkpPT1udWxsPycnOl9fdCkrCiciXG4gICAgJzsKIGlmIChyb2xlID09PSAibW9kZXJhdG9yIikgeyAKX19wKz0nXG4gICAgICAgdGl0bGU9IicrCigoX190PShkZXNjX21vZGVyYXRvcikpPT1udWxsPycnOl9fdCkrCiciXG4gICAgJzsKIH0gCl9fcCs9J1xuICAgICc7CiBpZiAocm9sZSA9PT0gInBhcnRpY2lwYW50IikgeyAKX19wKz0nXG4gICAgICAgdGl0bGU9IicrCigoX190PShkZXNjX3BhcnRpY2lwYW50KSk9PW51bGw/Jyc6X190KSsKJyJcbiAgICAnOwogfSAKX19wKz0nXG4gICAgJzsKIGlmIChyb2xlID09PSAidmlzaXRvciIpIHsgCl9fcCs9J1xuICAgICAgIHRpdGxlPSInKwooKF9fdD0oZGVzY192aXNpdG9yKSk9PW51bGw/Jyc6X190KSsKJyJcbiAgICAnOwogfSAKX19wKz0nXG4+JysKKChfX3Q9KG5pY2spKT09bnVsbD8nJzpfX3QpKwonPC9saT5cbic7Cn0KcmV0dXJuIF9fcDsKfTsgfSk7CgoKZGVmaW5lKCd0cGwhcGVuZGluZ19jb250YWN0JywgW10sZnVuY3Rpb24gKCkgeyByZXR1cm4gZnVuY3Rpb24ob2JqKXsKdmFyIF9fdCxfX3A9JycsX19qPUFycmF5LnByb3RvdHlwZS5qb2luLHByaW50PWZ1bmN0aW9uKCl7X19wKz1fX2ouY2FsbChhcmd1bWVudHMsJycpO307CndpdGgob2JqfHx7fSl7Cl9fcCs9JzxzcGFuIGNsYXNzPSJwZW5kaW5nLWNvbnRhY3QtbmFtZSI+JysKKChfX3Q9KGZ1bGxuYW1lKSk9PW51bGw/Jyc6X190KSsKJzwvc3Bhbj4gPGEgY2xhc3M9InJlbW92ZS14bXBwLWNvbnRhY3QgaWNvbi1yZW1vdmUiIHRpdGxlPSInKwooKF9fdD0oZGVzY19yZW1vdmUpKT09bnVsbD8nJzpfX3QpKwonIiBocmVmPSIjIj48L2E+XG4nOwp9CnJldHVybiBfX3A7Cn07IH0pOwoKCmRlZmluZSgndHBsIXBlbmRpbmdfY29udGFjdHMnLCBbXSxmdW5jdGlvbiAoKSB7IHJldHVybiBmdW5jdGlvbihvYmopewp2YXIgX190LF9fcD0nJyxfX2o9QXJyYXkucHJvdG90eXBlLmpvaW4scHJpbnQ9ZnVuY3Rpb24oKXtfX3ArPV9fai5jYWxsKGFyZ3VtZW50cywnJyk7fTsKd2l0aChvYmp8fHt9KXsKX19wKz0nPGR0IGlkPSJwZW5kaW5nLXhtcHAtY29udGFjdHMiPjxhIGhyZWY9IiMiIGNsYXNzPSJncm91cC10b2dnbGUgaWNvbi0nKwooKF9fdD0odG9nZ2xlX3N0YXRlKSk9PW51bGw/Jyc6X190KSsKJyIgdGl0bGU9IicrCigoX190PShkZXNjX2dyb3VwX3RvZ2dsZSkpPT1udWxsPycnOl9fdCkrCiciPicrCigoX190PShsYWJlbF9wZW5kaW5nX2NvbnRhY3RzKSk9PW51bGw/Jyc6X190KSsKJzwvYT48L2R0PlxuJzsKfQpyZXR1cm4gX19wOwp9OyB9KTsKCgpkZWZpbmUoJ3RwbCFyZXF1ZXN0aW5nX2NvbnRhY3QnLCBbXSxmdW5jdGlvbiAoKSB7IHJldHVybiBmdW5jdGlvbihvYmopewp2YXIgX190LF9fcD0nJyxfX2o9QXJyYXkucHJvdG90eXBlLmpvaW4scHJpbnQ9ZnVuY3Rpb24oKXtfX3ArPV9fai5jYWxsKGFyZ3VtZW50cywnJyk7fTsKd2l0aChvYmp8fHt9KXsKX19wKz0nPHNwYW4gY2xhc3M9InJlcS1jb250YWN0LW5hbWUiPicrCigoX190PShmdWxsbmFtZSkpPT1udWxsPycnOl9fdCkrCic8L3NwYW4+XG48c3BhbiBjbGFzcz0icmVxdWVzdC1hY3Rpb25zIj5cbiAgICA8YSBjbGFzcz0iYWNjZXB0LXhtcHAtcmVxdWVzdCBpY29uLWNoZWNrbWFyayIgdGl0bGU9IicrCigoX190PShkZXNjX2FjY2VwdCkpPT1udWxsPycnOl9fdCkrCiciIGhyZWY9IiMiPjwvYT5cbiAgICA8YSBjbGFzcz0iZGVjbGluZS14bXBwLXJlcXVlc3QgaWNvbi1jbG9zZSIgdGl0bGU9IicrCigoX190PShkZXNjX2RlY2xpbmUpKT09bnVsbD8nJzpfX3QpKwonIiBocmVmPSIjIj48L2E+XG48L3NwYW4+XG4nOwp9CnJldHVybiBfX3A7Cn07IH0pOwoKCmRlZmluZSgndHBsIXJlcXVlc3RpbmdfY29udGFjdHMnLCBbXSxmdW5jdGlvbiAoKSB7IHJldHVybiBmdW5jdGlvbihvYmopewp2YXIgX190LF9fcD0nJyxfX2o9QXJyYXkucHJvdG90eXBlLmpvaW4scHJpbnQ9ZnVuY3Rpb24oKXtfX3ArPV9fai5jYWxsKGFyZ3VtZW50cywnJyk7fTsKd2l0aChvYmp8fHt9KXsKX19wKz0nPGR0IGlkPSJ4bXBwLWNvbnRhY3QtcmVxdWVzdHMiPjxhIGhyZWY9IiMiIGNsYXNzPSJncm91cC10b2dnbGUgaWNvbi0nKwooKF9fdD0odG9nZ2xlX3N0YXRlKSk9PW51bGw/Jyc6X190KSsKJyIgdGl0bGU9IicrCigoX190PShkZXNjX2dyb3VwX3RvZ2dsZSkpPT1udWxsPycnOl9fdCkrCiciPicrCigoX190PShsYWJlbF9jb250YWN0X3JlcXVlc3RzKSk9PW51bGw/Jyc6X190KSsKJzwvYT48L2R0PlxuJzsKfQpyZXR1cm4gX19wOwp9OyB9KTsKCgpkZWZpbmUoJ3RwbCFyb29tX2Rlc2NyaXB0aW9uJywgW10sZnVuY3Rpb24gKCkgeyByZXR1cm4gZnVuY3Rpb24ob2JqKXsKdmFyIF9fdCxfX3A9JycsX19qPUFycmF5LnByb3RvdHlwZS5qb2luLHByaW50PWZ1bmN0aW9uKCl7X19wKz1fX2ouY2FsbChhcmd1bWVudHMsJycpO307CndpdGgob2JqfHx7fSl7Cl9fcCs9JzwhLS0gRklYTUU6IGNoZWNrIG1hcmt1cCBpbiBtb2NrdXAgLS0+XG48ZGl2IGNsYXNzPSJyb29tLWluZm8iPlxuPHAgY2xhc3M9InJvb20taW5mbyI+PHN0cm9uZz4nKwooKF9fdD0obGFiZWxfZGVzYykpPT1udWxsPycnOl9fdCkrCic8L3N0cm9uZz4gJysKKChfX3Q9KGRlc2MpKT09bnVsbD8nJzpfX3QpKwonPC9wPlxuPHAgY2xhc3M9InJvb20taW5mbyI+PHN0cm9uZz4nKwooKF9fdD0obGFiZWxfb2NjKSk9PW51bGw/Jyc6X190KSsKJzwvc3Ryb25nPiAnKwooKF9fdD0ob2NjKSk9PW51bGw/Jyc6X190KSsKJzwvcD5cbjxwIGNsYXNzPSJyb29tLWluZm8iPjxzdHJvbmc+JysKKChfX3Q9KGxhYmVsX2ZlYXR1cmVzKSk9PW51bGw/Jyc6X190KSsKJzwvc3Ryb25nPlxuICAgIDx1bD5cbiAgICAgICAgJzsKIGlmIChwYXNzd29yZHByb3RlY3RlZCkgeyAKX19wKz0nXG4gICAgICAgIDxsaSBjbGFzcz0icm9vbS1pbmZvIGxvY2tlZCI+JysKKChfX3Q9KGxhYmVsX3JlcXVpcmVzX2F1dGgpKT09bnVsbD8nJzpfX3QpKwonPC9saT5cbiAgICAgICAgJzsKIH0gCl9fcCs9J1xuICAgICAgICAnOwogaWYgKGhpZGRlbikgeyAKX19wKz0nXG4gICAgICAgIDxsaSBjbGFzcz0icm9vbS1pbmZvIj4nKwooKF9fdD0obGFiZWxfaGlkZGVuKSk9PW51bGw/Jyc6X190KSsKJzwvbGk+XG4gICAgICAgICc7CiB9IApfX3ArPSdcbiAgICAgICAgJzsKIGlmIChtZW1iZXJzb25seSkgeyAKX19wKz0nXG4gICAgICAgIDxsaSBjbGFzcz0icm9vbS1pbmZvIj4nKwooKF9fdD0obGFiZWxfcmVxdWlyZXNfaW52aXRlKSk9PW51bGw/Jyc6X190KSsKJzwvbGk+XG4gICAgICAgICc7CiB9IApfX3ArPSdcbiAgICAgICAgJzsKIGlmIChtb2RlcmF0ZWQpIHsgCl9fcCs9J1xuICAgICAgICA8bGkgY2xhc3M9InJvb20taW5mbyI+JysKKChfX3Q9KGxhYmVsX21vZGVyYXRlZCkpPT1udWxsPycnOl9fdCkrCic8L2xpPlxuICAgICAgICAnOwogfSAKX19wKz0nXG4gICAgICAgICc7CiBpZiAobm9uYW5vbnltb3VzKSB7IApfX3ArPSdcbiAgICAgICAgPGxpIGNsYXNzPSJyb29tLWluZm8iPicrCigoX190PShsYWJlbF9ub25fYW5vbikpPT1udWxsPycnOl9fdCkrCic8L2xpPlxuICAgICAgICAnOwogfSAKX19wKz0nXG4gICAgICAgICc7CiBpZiAob3BlbikgeyAKX19wKz0nXG4gICAgICAgIDxsaSBjbGFzcz0icm9vbS1pbmZvIj4nKwooKF9fdD0obGFiZWxfb3Blbl9yb29tKSk9PW51bGw/Jyc6X190KSsKJzwvbGk+XG4gICAgICAgICc7CiB9IApfX3ArPSdcbiAgICAgICAgJzsKIGlmIChwZXJzaXN0ZW50KSB7IApfX3ArPSdcbiAgICAgICAgPGxpIGNsYXNzPSJyb29tLWluZm8iPicrCigoX190PShsYWJlbF9wZXJtYW5lbnRfcm9vbSkpPT1udWxsPycnOl9fdCkrCic8L2xpPlxuICAgICAgICAnOwogfSAKX19wKz0nXG4gICAgICAgICc7CiBpZiAocHVibGljcm9vbSkgeyAKX19wKz0nXG4gICAgICAgIDxsaSBjbGFzcz0icm9vbS1pbmZvIj4nKwooKF9fdD0obGFiZWxfcHVibGljKSk9PW51bGw/Jyc6X190KSsKJzwvbGk+XG4gICAgICAgICc7CiB9IApfX3ArPSdcbiAgICAgICAgJzsKIGlmIChzZW1pYW5vbnltb3VzKSB7IApfX3ArPSdcbiAgICAgICAgPGxpIGNsYXNzPSJyb29tLWluZm8iPicrCigoX190PShsYWJlbF9zZW1pX2Fub24pKT09bnVsbD8nJzpfX3QpKwonPC9saT5cbiAgICAgICAgJzsKIH0gCl9fcCs9J1xuICAgICAgICAnOwogaWYgKHRlbXBvcmFyeSkgeyAKX19wKz0nXG4gICAgICAgIDxsaSBjbGFzcz0icm9vbS1pbmZvIj4nKwooKF9fdD0obGFiZWxfdGVtcF9yb29tKSk9PW51bGw/Jyc6X190KSsKJzwvbGk+XG4gICAgICAgICc7CiB9IApfX3ArPSdcbiAgICAgICAgJzsKIGlmICh1bm1vZGVyYXRlZCkgeyAKX19wKz0nXG4gICAgICAgIDxsaSBjbGFzcz0icm9vbS1pbmZvIj4nKwooKF9fdD0obGFiZWxfdW5tb2RlcmF0ZWQpKT09bnVsbD8nJzpfX3QpKwonPC9saT5cbiAgICAgICAgJzsKIH0gCl9fcCs9J1xuICAgIDwvdWw+XG48L3A+XG48L2Rpdj5cbic7Cn0KcmV0dXJuIF9fcDsKfTsgfSk7CgoKZGVmaW5lKCd0cGwhcm9vbV9pdGVtJywgW10sZnVuY3Rpb24gKCkgeyByZXR1cm4gZnVuY3Rpb24ob2JqKXsKdmFyIF9fdCxfX3A9JycsX19qPUFycmF5LnByb3RvdHlwZS5qb2luLHByaW50PWZ1bmN0aW9uKCl7X19wKz1fX2ouY2FsbChhcmd1bWVudHMsJycpO307CndpdGgob2JqfHx7fSl7Cl9fcCs9JzxkZCBjbGFzcz0iYXZhaWxhYmxlLWNoYXRyb29tIj5cbjxhIGNsYXNzPSJvcGVuLXJvb20iIGRhdGEtcm9vbS1qaWQ9IicrCigoX190PShqaWQpKT09bnVsbD8nJzpfX3QpKwonIlxuICAgdGl0bGU9IicrCigoX190PShvcGVuX3RpdGxlKSk9PW51bGw/Jyc6X190KSsKJyIgaHJlZj0iIyI+JysKKChfX3Q9KG5hbWUpKT09bnVsbD8nJzpfX3QpKwonPC9hPlxuPGEgY2xhc3M9InJvb20taW5mbyBpY29uLXJvb20taW5mbyIgZGF0YS1yb29tLWppZD0iJysKKChfX3Q9KGppZCkpPT1udWxsPycnOl9fdCkrCiciXG4gICB0aXRsZT0iJysKKChfX3Q9KGluZm9fdGl0bGUpKT09bnVsbD8nJzpfX3QpKwonIiBocmVmPSIjIj4mbmJzcDs8L2E+XG48L2RkPlxuJzsKfQpyZXR1cm4gX19wOwp9OyB9KTsKCgpkZWZpbmUoJ3RwbCFyb29tX3BhbmVsJywgW10sZnVuY3Rpb24gKCkgeyByZXR1cm4gZnVuY3Rpb24ob2JqKXsKdmFyIF9fdCxfX3A9JycsX19qPUFycmF5LnByb3RvdHlwZS5qb2luLHByaW50PWZ1bmN0aW9uKCl7X19wKz1fX2ouY2FsbChhcmd1bWVudHMsJycpO307CndpdGgob2JqfHx7fSl7Cl9fcCs9Jzxmb3JtIGNsYXNzPSJhZGQtY2hhdHJvb20iIGFjdGlvbj0iIiBtZXRob2Q9InBvc3QiPlxuICAgIDxpbnB1dCB0eXBlPSJ0ZXh0IiBuYW1lPSJjaGF0cm9vbSIgY2xhc3M9Im5ldy1jaGF0cm9vbS1uYW1lIlxuICAgICAgICBwbGFjZWhvbGRlcj0iJysKKChfX3Q9KGxhYmVsX3Jvb21fbmFtZSkpPT1udWxsPycnOl9fdCkrCiciLz5cbiAgICA8aW5wdXQgdHlwZT0idGV4dCIgbmFtZT0ibmljayIgY2xhc3M9Im5ldy1jaGF0cm9vbS1uaWNrIlxuICAgICAgICBwbGFjZWhvbGRlcj0iJysKKChfX3Q9KGxhYmVsX25pY2tuYW1lKSk9PW51bGw/Jyc6X190KSsKJyIvPlxuICAgIDxpbnB1dCB0eXBlPSInKwooKF9fdD0oc2VydmVyX2lucHV0X3R5cGUpKT09bnVsbD8nJzpfX3QpKwonIiBuYW1lPSJzZXJ2ZXIiIGNsYXNzPSJuZXctY2hhdHJvb20tc2VydmVyIlxuICAgICAgICBwbGFjZWhvbGRlcj0iJysKKChfX3Q9KGxhYmVsX3NlcnZlcikpPT1udWxsPycnOl9fdCkrCiciLz5cbiAgICA8aW5wdXQgdHlwZT0ic3VibWl0IiBuYW1lPSJqb2luIiB2YWx1ZT0iJysKKChfX3Q9KGxhYmVsX2pvaW4pKT09bnVsbD8nJzpfX3QpKwonIi8+XG4gICAgPGlucHV0IHR5cGU9ImJ1dHRvbiIgbmFtZT0ic2hvdyIgaWQ9InNob3ctcm9vbXMiIHZhbHVlPSInKwooKF9fdD0obGFiZWxfc2hvd19yb29tcykpPT1udWxsPycnOl9fdCkrCiciLz5cbjwvZm9ybT5cbjxkbCBpZD0iYXZhaWxhYmxlLWNoYXRyb29tcyI+PC9kbD5cbic7Cn0KcmV0dXJuIF9fcDsKfTsgfSk7CgoKZGVmaW5lKCd0cGwhcm9zdGVyJywgW10sZnVuY3Rpb24gKCkgeyByZXR1cm4gZnVuY3Rpb24ob2JqKXsKdmFyIF9fdCxfX3A9JycsX19qPUFycmF5LnByb3RvdHlwZS5qb2luLHByaW50PWZ1bmN0aW9uKCl7X19wKz1fX2ouY2FsbChhcmd1bWVudHMsJycpO307CndpdGgob2JqfHx7fSl7Cl9fcCs9JzxpbnB1dCBzdHlsZT0iZGlzcGxheTogbm9uZTsiIGNsYXNzPSJyb3N0ZXItZmlsdGVyIiBwbGFjZWhvbGRlcj0iJysKKChfX3Q9KHBsYWNlaG9sZGVyKSk9PW51bGw/Jyc6X190KSsKJyI+XG48c2VsZWN0IHN0eWxlPSJkaXNwbGF5OiBub25lOyIgY2xhc3M9ImZpbHRlci10eXBlIj5cbiAgICA8b3B0aW9uIHZhbHVlPSJjb250YWN0cyI+JysKKChfX3Q9KGxhYmVsX2NvbnRhY3RzKSk9PW51bGw/Jyc6X190KSsKJzwvb3B0aW9uPlxuICAgIDxvcHRpb24gdmFsdWU9Imdyb3VwcyI+JysKKChfX3Q9KGxhYmVsX2dyb3VwcykpPT1udWxsPycnOl9fdCkrCic8L29wdGlvbj5cbjwvc2VsZWN0PlxuJzsKfQpyZXR1cm4gX19wOwp9OyB9KTsKCgpkZWZpbmUoJ3RwbCFyb3N0ZXJfaXRlbScsIFtdLGZ1bmN0aW9uICgpIHsgcmV0dXJuIGZ1bmN0aW9uKG9iail7CnZhciBfX3QsX19wPScnLF9faj1BcnJheS5wcm90b3R5cGUuam9pbixwcmludD1mdW5jdGlvbigpe19fcCs9X19qLmNhbGwoYXJndW1lbnRzLCcnKTt9Owp3aXRoKG9ianx8e30pewpfX3ArPSc8YSBjbGFzcz0ib3Blbi1jaGF0IiB0aXRsZT0iJysKKChfX3Q9KGRlc2NfY2hhdCkpPT1udWxsPycnOl9fdCkrCiciIGhyZWY9IiMiPjxzcGFuIGNsYXNzPSJpY29uLScrCigoX190PShjaGF0X3N0YXR1cykpPT1udWxsPycnOl9fdCkrCiciIHRpdGxlPSInKwooKF9fdD0oZGVzY19zdGF0dXMpKT09bnVsbD8nJzpfX3QpKwonIj48L3NwYW4+JysKKChfX3Q9KGZ1bGxuYW1lKSk9PW51bGw/Jyc6X190KSsKJzwvYT5cbjxhIGNsYXNzPSJyZW1vdmUteG1wcC1jb250YWN0IGljb24tcmVtb3ZlIiB0aXRsZT0iJysKKChfX3Q9KGRlc2NfcmVtb3ZlKSk9PW51bGw/Jyc6X190KSsKJyIgaHJlZj0iIyI+PC9hPlxuJzsKfQpyZXR1cm4gX19wOwp9OyB9KTsKCgpkZWZpbmUoJ3RwbCFzZWxlY3Rfb3B0aW9uJywgW10sZnVuY3Rpb24gKCkgeyByZXR1cm4gZnVuY3Rpb24ob2JqKXsKdmFyIF9fdCxfX3A9JycsX19qPUFycmF5LnByb3RvdHlwZS5qb2luLHByaW50PWZ1bmN0aW9uKCl7X19wKz1fX2ouY2FsbChhcmd1bWVudHMsJycpO307CndpdGgob2JqfHx7fSl7Cl9fcCs9JzxvcHRpb24gdmFsdWU9IicrCigoX190PSh2YWx1ZSkpPT1udWxsPycnOl9fdCkrCiciPicrCigoX190PShsYWJlbCkpPT1udWxsPycnOl9fdCkrCic8L29wdGlvbj5cbic7Cn0KcmV0dXJuIF9fcDsKfTsgfSk7CgoKZGVmaW5lKCd0cGwhc2VhcmNoX2NvbnRhY3QnLCBbXSxmdW5jdGlvbiAoKSB7IHJldHVybiBmdW5jdGlvbihvYmopewp2YXIgX190LF9fcD0nJyxfX2o9QXJyYXkucHJvdG90eXBlLmpvaW4scHJpbnQ9ZnVuY3Rpb24oKXtfX3ArPV9fai5jYWxsKGFyZ3VtZW50cywnJyk7fTsKd2l0aChvYmp8fHt9KXsKX19wKz0nPGxpPlxuICAgIDxmb3JtIGNsYXNzPSJzZWFyY2gteG1wcC1jb250YWN0Ij5cbiAgICAgICAgPGlucHV0IHR5cGU9InRleHQiXG4gICAgICAgICAgICBuYW1lPSJpZGVudGlmaWVyIlxuICAgICAgICAgICAgY2xhc3M9InVzZXJuYW1lIlxuICAgICAgICAgICAgcGxhY2Vob2xkZXI9IicrCigoX190PShsYWJlbF9jb250YWN0X25hbWUpKT09bnVsbD8nJzpfX3QpKwonIi8+XG4gICAgICAgIDxidXR0b24gdHlwZT0ic3VibWl0Ij4nKwooKF9fdD0obGFiZWxfc2VhcmNoKSk9PW51bGw/Jyc6X190KSsKJzwvYnV0dG9uPlxuICAgIDwvZm9ybT5cbjwvbGk+XG4nOwp9CnJldHVybiBfX3A7Cn07IH0pOwoKCmRlZmluZSgndHBsIXN0YXR1c19vcHRpb24nLCBbXSxmdW5jdGlvbiAoKSB7IHJldHVybiBmdW5jdGlvbihvYmopewp2YXIgX190LF9fcD0nJyxfX2o9QXJyYXkucHJvdG90eXBlLmpvaW4scHJpbnQ9ZnVuY3Rpb24oKXtfX3ArPV9fai5jYWxsKGFyZ3VtZW50cywnJyk7fTsKd2l0aChvYmp8fHt9KXsKX19wKz0nPGxpPlxuICAgIDxhIGhyZWY9IiMiIGNsYXNzPSInKwooKF9fdD0oIHZhbHVlICkpPT1udWxsPycnOl9fdCkrCiciIGRhdGEtdmFsdWU9IicrCigoX190PSggdmFsdWUgKSk9PW51bGw/Jyc6X190KSsKJyI+XG4gICAgICAgIDxzcGFuIGNsYXNzPSJpY29uLScrCigoX190PSggdmFsdWUgKSk9PW51bGw/Jyc6X190KSsKJyI+PC9zcGFuPlxuICAgICAgICAnKwooKF9fdD0oIHRleHQgKSk9PW51bGw/Jyc6X190KSsKJ1xuICAgIDwvYT5cbjwvbGk+XG4nOwp9CnJldHVybiBfX3A7Cn07IH0pOwoKCmRlZmluZSgndHBsIXRvZ2dsZV9jaGF0cycsIFtdLGZ1bmN0aW9uICgpIHsgcmV0dXJuIGZ1bmN0aW9uKG9iail7CnZhciBfX3QsX19wPScnLF9faj1BcnJheS5wcm90b3R5cGUuam9pbixwcmludD1mdW5jdGlvbigpe19fcCs9X19qLmNhbGwoYXJndW1lbnRzLCcnKTt9Owp3aXRoKG9ianx8e30pewpfX3ArPScnKwooKF9fdD0oTWluaW1pemVkKSk9PW51bGw/Jyc6X190KSsKJyA8c3BhbiBpZD0ibWluaW1pemVkLWNvdW50Ij4oJysKKChfX3Q9KG51bV9taW5pbWl6ZWQpKT09bnVsbD8nJzpfX3QpKwonKTwvc3Bhbj5cbjxzcGFuIGNsYXNzPSJ1bnJlYWQtbWVzc2FnZS1jb3VudCJcbiAgICAnOwogaWYgKCFudW1fdW5yZWFkKSB7IApfX3ArPScgc3R5bGU9ImRpc3BsYXk6IG5vbmUiICc7CiB9IApfX3ArPSdcbiAgICBocmVmPSIjIj4nKwooKF9fdD0obnVtX3VucmVhZCkpPT1udWxsPycnOl9fdCkrCic8L3NwYW4+XG4nOwp9CnJldHVybiBfX3A7Cn07IH0pOwoKCmRlZmluZSgndHBsIXRvb2xiYXInLCBbXSxmdW5jdGlvbiAoKSB7IHJldHVybiBmdW5jdGlvbihvYmopewp2YXIgX190LF9fcD0nJyxfX2o9QXJyYXkucHJvdG90eXBlLmpvaW4scHJpbnQ9ZnVuY3Rpb24oKXtfX3ArPV9fai5jYWxsKGFyZ3VtZW50cywnJyk7fTsKd2l0aChvYmp8fHt9KXsKX19wKz0nJzsKIGlmIChzaG93X2Vtb3RpY29ucykgIHsgCl9fcCs9J1xuICAgIDxsaSBjbGFzcz0idG9nZ2xlLXNtaWxleSBpY29uLWhhcHB5IiB0aXRsZT0iSW5zZXJ0IGEgc21pbGVyeSI+XG4gICAgICAgIDx1bD5cbiAgICAgICAgICAgIDxsaT48YSBjbGFzcz0iaWNvbi1zbWlsZXkiIGhyZWY9IiMiIGRhdGEtZW1vdGljb249IjopIj48L2E+PC9saT5cbiAgICAgICAgICAgIDxsaT48YSBjbGFzcz0iaWNvbi13aW5rIiBocmVmPSIjIiBkYXRhLWVtb3RpY29uPSI7KSI+PC9hPjwvbGk+XG4gICAgICAgICAgICA8bGk+PGEgY2xhc3M9Imljb24tZ3JpbiIgaHJlZj0iIyIgZGF0YS1lbW90aWNvbj0iOkQiPjwvYT48L2xpPlxuICAgICAgICAgICAgPGxpPjxhIGNsYXNzPSJpY29uLXRvbmd1ZSIgaHJlZj0iIyIgZGF0YS1lbW90aWNvbj0iOlAiPjwvYT48L2xpPlxuICAgICAgICAgICAgPGxpPjxhIGNsYXNzPSJpY29uLWNvb2wiIGhyZWY9IiMiIGRhdGEtZW1vdGljb249IjgpIj48L2E+PC9saT5cbiAgICAgICAgICAgIDxsaT48YSBjbGFzcz0iaWNvbi1ldmlsIiBocmVmPSIjIiBkYXRhLWVtb3RpY29uPSI+OikiPjwvYT48L2xpPlxuICAgICAgICAgICAgPGxpPjxhIGNsYXNzPSJpY29uLWNvbmZ1c2VkIiBocmVmPSIjIiBkYXRhLWVtb3RpY29uPSI6UyI+PC9hPjwvbGk+XG4gICAgICAgICAgICA8bGk+PGEgY2xhc3M9Imljb24td29uZGVyaW5nIiBocmVmPSIjIiBkYXRhLWVtb3RpY29uPSI6XFwiPjwvYT48L2xpPlxuICAgICAgICAgICAgPGxpPjxhIGNsYXNzPSJpY29uLWFuZ3J5IiBocmVmPSIjIiBkYXRhLWVtb3RpY29uPSI+OigiPjwvYT48L2xpPlxuICAgICAgICAgICAgPGxpPjxhIGNsYXNzPSJpY29uLXNhZCIgaHJlZj0iIyIgZGF0YS1lbW90aWNvbj0iOigiPjwvYT48L2xpPlxuICAgICAgICAgICAgPGxpPjxhIGNsYXNzPSJpY29uLXNob2NrZWQiIGhyZWY9IiMiIGRhdGEtZW1vdGljb249IjpPIj48L2E+PC9saT5cbiAgICAgICAgICAgIDxsaT48YSBjbGFzcz0iaWNvbi10aHVtYnMtdXAiIGhyZWY9IiMiIGRhdGEtZW1vdGljb249IiheLl4pYiI+PC9hPjwvbGk+XG4gICAgICAgICAgICA8bGk+PGEgY2xhc3M9Imljb24taGVhcnQiIGhyZWY9IiMiIGRhdGEtZW1vdGljb249IjwzIj48L2E+PC9saT5cbiAgICAgICAgPC91bD5cbiAgICA8L2xpPlxuJzsKIH0gCl9fcCs9J1xuJzsKIGlmIChzaG93X2NhbGxfYnV0dG9uKSAgeyAKX19wKz0nXG48bGkgY2xhc3M9InRvZ2dsZS1jYWxsIj48YSBjbGFzcz0iaWNvbi1waG9uZSIgdGl0bGU9IicrCigoX190PShsYWJlbF9zdGFydF9jYWxsKSk9PW51bGw/Jyc6X190KSsKJyI+PC9hPjwvbGk+XG4nOwogfSAKX19wKz0nXG4nOwogaWYgKHNob3dfcGFydGljaXBhbnRzX3RvZ2dsZSkgIHsgCl9fcCs9J1xuPGxpIGNsYXNzPSJ0b2dnbGUtcGFydGljaXBhbnRzIj48YSBjbGFzcz0iaWNvbi1oaWRlLXVzZXJzIiB0aXRsZT0iJysKKChfX3Q9KGxhYmVsX2hpZGVfcGFydGljaXBhbnRzKSk9PW51bGw/Jyc6X190KSsKJyI+PC9hPjwvbGk+XG4nOwogfSAKX19wKz0nXG4nOwogaWYgKHNob3dfY2xlYXJfYnV0dG9uKSAgeyAKX19wKz0nXG48bGkgY2xhc3M9InRvZ2dsZS1jbGVhciI+PGEgY2xhc3M9Imljb24tcmVtb3ZlIiB0aXRsZT0iJysKKChfX3Q9KGxhYmVsX2NsZWFyKSk9PW51bGw/Jyc6X190KSsKJyI+PC9hPjwvbGk+XG4nOwogfSAKX19wKz0nXG4nOwogaWYgKGFsbG93X290cikgIHsgCl9fcCs9J1xuICAgIDxsaSBjbGFzcz0idG9nZ2xlLW90ciAnKwooKF9fdD0ob3RyX3N0YXR1c19jbGFzcykpPT1udWxsPycnOl9fdCkrCiciIHRpdGxlPSInKwooKF9fdD0ob3RyX3Rvb2x0aXApKT09bnVsbD8nJzpfX3QpKwonIj5cbiAgICAgICAgPHNwYW4gY2xhc3M9ImNoYXQtdG9vbGJhci10ZXh0Ij4nKwooKF9fdD0ob3RyX3RyYW5zbGF0ZWRfc3RhdHVzKSk9PW51bGw/Jyc6X190KSsKJzwvc3Bhbj5cbiAgICAgICAgJzsKIGlmIChvdHJfc3RhdHVzID09IFVORU5DUllQVEVEKSB7IApfX3ArPSdcbiAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJpY29uLXVubG9ja2VkIj48L3NwYW4+XG4gICAgICAgICc7CiB9IApfX3ArPSdcbiAgICAgICAgJzsKIGlmIChvdHJfc3RhdHVzID09IFVOVkVSSUZJRUQpIHsgCl9fcCs9J1xuICAgICAgICAgICAgPHNwYW4gY2xhc3M9Imljb24tbG9jayI+PC9zcGFuPlxuICAgICAgICAnOwogfSAKX19wKz0nXG4gICAgICAgICc7CiBpZiAob3RyX3N0YXR1cyA9PSBWRVJJRklFRCkgeyAKX19wKz0nXG4gICAgICAgICAgICA8c3BhbiBjbGFzcz0iaWNvbi1sb2NrIj48L3NwYW4+XG4gICAgICAgICc7CiB9IApfX3ArPSdcbiAgICAgICAgJzsKIGlmIChvdHJfc3RhdHVzID09IEZJTklTSEVEKSB7IApfX3ArPSdcbiAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJpY29uLXVubG9ja2VkIj48L3NwYW4+XG4gICAgICAgICc7CiB9IApfX3ArPSdcbiAgICAgICAgPHVsPlxuICAgICAgICAgICAgJzsKIGlmIChvdHJfc3RhdHVzID09IFVORU5DUllQVEVEKSB7IApfX3ArPSdcbiAgICAgICAgICAgICAgIDxsaT48YSBjbGFzcz0ic3RhcnQtb3RyIiBocmVmPSIjIj4nKwooKF9fdD0obGFiZWxfc3RhcnRfZW5jcnlwdGVkX2NvbnZlcnNhdGlvbikpPT1udWxsPycnOl9fdCkrCic8L2E+PC9saT5cbiAgICAgICAgICAgICc7CiB9IApfX3ArPSdcbiAgICAgICAgICAgICc7CiBpZiAob3RyX3N0YXR1cyAhPSBVTkVOQ1JZUFRFRCkgeyAKX19wKz0nXG4gICAgICAgICAgICAgICA8bGk+PGEgY2xhc3M9InN0YXJ0LW90ciIgaHJlZj0iIyI+JysKKChfX3Q9KGxhYmVsX3JlZnJlc2hfZW5jcnlwdGVkX2NvbnZlcnNhdGlvbikpPT1udWxsPycnOl9fdCkrCic8L2E+PC9saT5cbiAgICAgICAgICAgICAgIDxsaT48YSBjbGFzcz0iZW5kLW90ciIgaHJlZj0iIyI+JysKKChfX3Q9KGxhYmVsX2VuZF9lbmNyeXB0ZWRfY29udmVyc2F0aW9uKSk9PW51bGw/Jyc6X190KSsKJzwvYT48L2xpPlxuICAgICAgICAgICAgICAgPGxpPjxhIGNsYXNzPSJhdXRoLW90ciIgZGF0YS1zY2hlbWU9InNtcCIgaHJlZj0iIyI+JysKKChfX3Q9KGxhYmVsX3ZlcmlmeV93aXRoX3NtcCkpPT1udWxsPycnOl9fdCkrCic8L2E+PC9saT5cbiAgICAgICAgICAgICc7CiB9IApfX3ArPSdcbiAgICAgICAgICAgICc7CiBpZiAob3RyX3N0YXR1cyA9PSBVTlZFUklGSUVEKSB7IApfX3ArPSdcbiAgICAgICAgICAgICAgIDxsaT48YSBjbGFzcz0iYXV0aC1vdHIiIGRhdGEtc2NoZW1lPSJmaW5nZXJwcmludCIgaHJlZj0iIyI+JysKKChfX3Q9KGxhYmVsX3ZlcmlmeV93aXRoX2ZpbmdlcnByaW50cykpPT1udWxsPycnOl9fdCkrCic8L2E+PC9saT5cbiAgICAgICAgICAgICc7CiB9IApfX3ArPSdcbiAgICAgICAgICAgIDxsaT48YSBocmVmPSJodHRwOi8vd3d3LmN5cGhlcnB1bmtzLmNhL290ci9oZWxwLzMuMi4wL2xldmVscy5waHAiIHRhcmdldD0iX2JsYW5rIj4nKwooKF9fdD0obGFiZWxfd2hhdHNfdGhpcykpPT1udWxsPycnOl9fdCkrCic8L2E+PC9saT5cbiAgICAgICAgPC91bD5cbiAgICA8L2xpPlxuJzsKIH0gCl9fcCs9J1xuJzsKfQpyZXR1cm4gX19wOwp9OyB9KTsKCgpkZWZpbmUoJ3RwbCF0cmltbWVkX2NoYXQnLCBbXSxmdW5jdGlvbiAoKSB7IHJldHVybiBmdW5jdGlvbihvYmopewp2YXIgX190LF9fcD0nJyxfX2o9QXJyYXkucHJvdG90eXBlLmpvaW4scHJpbnQ9ZnVuY3Rpb24oKXtfX3ArPV9fai5jYWxsKGFyZ3VtZW50cywnJyk7fTsKd2l0aChvYmp8fHt9KXsKX19wKz0nPGEgY2xhc3M9ImNsb3NlLWNoYXRib3gtYnV0dG9uIGljb24tY2xvc2UiPjwvYT5cbjxhIGNsYXNzPSJjaGF0LWhlYWQtbWVzc2FnZS1jb3VudCIgXG4gICAgJzsKIGlmICghbnVtX3VucmVhZCkgeyAKX19wKz0nIHN0eWxlPSJkaXNwbGF5OiBub25lIiAnOwogfSAKX19wKz0nXG4gICAgaHJlZj0iIyI+JysKKChfX3Q9KG51bV91bnJlYWQpKT09bnVsbD8nJzpfX3QpKwonPC9hPlxuPGEgaHJlZj0iIyIgY2xhc3M9InJlc3RvcmUtY2hhdCIgdGl0bGU9IicrCigoX190PSh0b29sdGlwKSk9PW51bGw/Jyc6X190KSsKJyI+XG4gICAgJysKKChfX3Q9KCB0aXRsZSApKT09bnVsbD8nJzpfX3QpKwonXG48L2E+XG4nOwp9CnJldHVybiBfX3A7Cn07IH0pOwoKZGVmaW5lKCJjb252ZXJzZS10ZW1wbGF0ZXMiLCBbCiAgICAidHBsIWFjdGlvbiIsCiAgICAidHBsIWFkZF9jb250YWN0X2Ryb3Bkb3duIiwKICAgICJ0cGwhYWRkX2NvbnRhY3RfZm9ybSIsCiAgICAidHBsIWNoYW5nZV9zdGF0dXNfbWVzc2FnZSIsCiAgICAidHBsIWNoYXRfc3RhdHVzIiwKICAgICJ0cGwhY2hhdGFyZWEiLAogICAgInRwbCFjaGF0Ym94IiwKICAgICJ0cGwhY2hhdHJvb20iLAogICAgInRwbCFjaGF0cm9vbV9wYXNzd29yZF9mb3JtIiwKICAgICJ0cGwhY2hhdHJvb21fc2lkZWJhciIsCiAgICAidHBsIWNoYXRyb29tc190YWIiLAogICAgInRwbCFjaGF0c19wYW5lbCIsCiAgICAidHBsIWNob29zZV9zdGF0dXMiLAogICAgInRwbCFjb250YWN0c19wYW5lbCIsCiAgICAidHBsIWNvbnRhY3RzX3RhYiIsCiAgICAidHBsIWNvbnRyb2xib3giLAogICAgInRwbCFjb250cm9sYm94X3RvZ2dsZSIsCiAgICAidHBsIWZpZWxkIiwKICAgICJ0cGwhZm9ybV9jaGVja2JveCIsCiAgICAidHBsIWZvcm1faW5wdXQiLAogICAgInRwbCFmb3JtX3NlbGVjdCIsCiAgICAidHBsIWdyb3VwX2hlYWRlciIsCiAgICAidHBsIWluZm8iLAogICAgInRwbCFsb2dpbl9wYW5lbCIsCiAgICAidHBsIWxvZ2luX3RhYiIsCiAgICAidHBsIW1lc3NhZ2UiLAogICAgInRwbCFuZXdfZGF5IiwKICAgICJ0cGwhb2NjdXBhbnQiLAogICAgInRwbCFwZW5kaW5nX2NvbnRhY3QiLAogICAgInRwbCFwZW5kaW5nX2NvbnRhY3RzIiwKICAgICJ0cGwhcmVxdWVzdGluZ19jb250YWN0IiwKICAgICJ0cGwhcmVxdWVzdGluZ19jb250YWN0cyIsCiAgICAidHBsIXJvb21fZGVzY3JpcHRpb24iLAogICAgInRwbCFyb29tX2l0ZW0iLAogICAgInRwbCFyb29tX3BhbmVsIiwKICAgICJ0cGwhcm9zdGVyIiwKICAgICJ0cGwhcm9zdGVyX2l0ZW0iLAogICAgInRwbCFzZWxlY3Rfb3B0aW9uIiwKICAgICJ0cGwhc2VhcmNoX2NvbnRhY3QiLAogICAgInRwbCFzdGF0dXNfb3B0aW9uIiwKICAgICJ0cGwhdG9nZ2xlX2NoYXRzIiwKICAgICJ0cGwhdG9vbGJhciIsCiAgICAidHBsIXRyaW1tZWRfY2hhdCIKXSwgZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIHsKICAgICAgICBhY3Rpb246ICAgICAgICAgICAgICAgICBhcmd1bWVudHNbMF0sCiAgICAgICAgYWRkX2NvbnRhY3RfZHJvcGRvd246ICAgYXJndW1lbnRzWzFdLAogICAgICAgIGFkZF9jb250YWN0X2Zvcm06ICAgICAgIGFyZ3VtZW50c1syXSwKICAgICAgICBjaGFuZ2Vfc3RhdHVzX21lc3NhZ2U6ICBhcmd1bWVudHNbM10sCiAgICAgICAgY2hhdF9zdGF0dXM6ICAgICAgICAgICAgYXJndW1lbnRzWzRdLAogICAgICAgIGNoYXRhcmVhOiAgICAgICAgICAgICAgIGFyZ3VtZW50c1s1XSwKICAgICAgICBjaGF0Ym94OiAgICAgICAgICAgICAgICBhcmd1bWVudHNbNl0sCiAgICAgICAgY2hhdHJvb206ICAgICAgICAgICAgICAgYXJndW1lbnRzWzddLAogICAgICAgIGNoYXRyb29tX3Bhc3N3b3JkX2Zvcm06IGFyZ3VtZW50c1s4XSwKICAgICAgICBjaGF0cm9vbV9zaWRlYmFyOiAgICAgICBhcmd1bWVudHNbOV0sCiAgICAgICAgY2hhdHJvb21zX3RhYjogICAgICAgICAgYXJndW1lbnRzWzEwXSwKICAgICAgICBjaGF0c19wYW5lbDogICAgICAgICAgICBhcmd1bWVudHNbMTFdLAogICAgICAgIGNob29zZV9zdGF0dXM6ICAgICAgICAgIGFyZ3VtZW50c1sxMl0sCiAgICAgICAgY29udGFjdHNfcGFuZWw6ICAgICAgICAgYXJndW1lbnRzWzEzXSwKICAgICAgICBjb250YWN0c190YWI6ICAgICAgICAgICBhcmd1bWVudHNbMTRdLAogICAgICAgIGNvbnRyb2xib3g6ICAgICAgICAgICAgIGFyZ3VtZW50c1sxNV0sCiAgICAgICAgY29udHJvbGJveF90b2dnbGU6ICAgICAgYXJndW1lbnRzWzE2XSwKICAgICAgICBmaWVsZDogICAgICAgICAgICAgICAgICBhcmd1bWVudHNbMTddLAogICAgICAgIGZvcm1fY2hlY2tib3g6ICAgICAgICAgIGFyZ3VtZW50c1sxOF0sCiAgICAgICAgZm9ybV9pbnB1dDogICAgICAgICAgICAgYXJndW1lbnRzWzE5XSwKICAgICAgICBmb3JtX3NlbGVjdDogICAgICAgICAgICBhcmd1bWVudHNbMjBdLAogICAgICAgIGdyb3VwX2hlYWRlcjogICAgICAgICAgIGFyZ3VtZW50c1syMV0sCiAgICAgICAgaW5mbzogICAgICAgICAgICAgICAgICAgYXJndW1lbnRzWzIyXSwKICAgICAgICBsb2dpbl9wYW5lbDogICAgICAgICAgICBhcmd1bWVudHNbMjNdLAogICAgICAgIGxvZ2luX3RhYjogICAgICAgICAgICAgIGFyZ3VtZW50c1syNF0sCiAgICAgICAgbWVzc2FnZTogICAgICAgICAgICAgICAgYXJndW1lbnRzWzI1XSwKICAgICAgICBuZXdfZGF5OiAgICAgICAgICAgICAgICBhcmd1bWVudHNbMjZdLAogICAgICAgIG9jY3VwYW50OiAgICAgICAgICAgICAgIGFyZ3VtZW50c1syN10sCiAgICAgICAgcGVuZGluZ19jb250YWN0OiAgICAgICAgYXJndW1lbnRzWzI4XSwKICAgICAgICBwZW5kaW5nX2NvbnRhY3RzOiAgICAgICBhcmd1bWVudHNbMjldLAogICAgICAgIHJlcXVlc3RpbmdfY29udGFjdDogICAgIGFyZ3VtZW50c1szMF0sCiAgICAgICAgcmVxdWVzdGluZ19jb250YWN0czogICAgYXJndW1lbnRzWzMxXSwKICAgICAgICByb29tX2Rlc2NyaXB0aW9uOiAgICAgICBhcmd1bWVudHNbMzJdLAogICAgICAgIHJvb21faXRlbTogICAgICAgICAgICAgIGFyZ3VtZW50c1szM10sCiAgICAgICAgcm9vbV9wYW5lbDogICAgICAgICAgICAgYXJndW1lbnRzWzM0XSwKICAgICAgICByb3N0ZXI6ICAgICAgICAgICAgICAgICBhcmd1bWVudHNbMzVdLAogICAgICAgIHJvc3Rlcl9pdGVtOiAgICAgICAgICAgIGFyZ3VtZW50c1szNl0sCiAgICAgICAgc2VsZWN0X29wdGlvbjogICAgICAgICAgYXJndW1lbnRzWzM3XSwKICAgICAgICBzZWFyY2hfY29udGFjdDogICAgICAgICBhcmd1bWVudHNbMzhdLAogICAgICAgIHN0YXR1c19vcHRpb246ICAgICAgICAgIGFyZ3VtZW50c1szOV0sCiAgICAgICAgdG9nZ2xlX2NoYXRzOiAgICAgICAgICAgYXJndW1lbnRzWzQwXSwKICAgICAgICB0b29sYmFyOiAgICAgICAgICAgICAgICBhcmd1bWVudHNbNDFdLAogICAgICAgIHRyaW1tZWRfY2hhdDogICAgICAgICAgIGFyZ3VtZW50c1s0Ml0KICAgIH07Cn0pOwoKLyohCiAqIENvbnZlcnNlLmpzIChXZWItYmFzZWQgWE1QUCBpbnN0YW50IG1lc3NhZ2luZyBjbGllbnQpCiAqIGh0dHA6Ly9jb252ZXJzZWpzLm9yZwogKgogKiBDb3B5cmlnaHQgKGMpIDIwMTIsIEphbi1DYXJlbCBCcmFuZCA8amNAb3Brb2RlLmNvbT4KICogTGljZW5zZWQgdW5kZXIgdGhlIE1vemlsbGEgUHVibGljIExpY2Vuc2UgKE1QTCkKICovCgovLyBBTUQvZ2xvYmFsIHJlZ2lzdHJhdGlvbnMKKGZ1bmN0aW9uIChyb290LCBmYWN0b3J5KSB7CiAgICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7CiAgICAgICAgZGVmaW5lKCJjb252ZXJzZSIsCiAgICAgICAgICAgICAgWyJjb252ZXJzZS1kZXBlbmRlbmNpZXMiLCAiY29udmVyc2UtdGVtcGxhdGVzIl0sCiAgICAgICAgICAgIGZ1bmN0aW9uIChkZXBlbmRlbmNpZXMsIHRlbXBsYXRlcykgewogICAgICAgICAgICAgICAgdmFyIG90ciA9IGRlcGVuZGVuY2llcy5vdHI7CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG90ciAhPT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFjdG9yeSgKICAgICAgICAgICAgICAgICAgICAgICAgZGVwZW5kZW5jaWVzLmpRdWVyeSwKICAgICAgICAgICAgICAgICAgICAgICAgXywKICAgICAgICAgICAgICAgICAgICAgICAgb3RyLk9UUiwKICAgICAgICAgICAgICAgICAgICAgICAgb3RyLkRTQSwKICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVzLAogICAgICAgICAgICAgICAgICAgICAgICBkZXBlbmRlbmNpZXMubW9tZW50LAogICAgICAgICAgICAgICAgICAgICAgICBkZXBlbmRlbmNpZXMudXRpbHMKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFjdG9yeSgKICAgICAgICAgICAgICAgICAgICAgICAgZGVwZW5kZW5jaWVzLmpRdWVyeSwKICAgICAgICAgICAgICAgICAgICAgICAgXywKICAgICAgICAgICAgICAgICAgICAgICAgdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgICAgICAgICB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlcywKICAgICAgICAgICAgICAgICAgICAgICAgZGVwZW5kZW5jaWVzLm1vbWVudCwKICAgICAgICAgICAgICAgICAgICAgICAgZGVwZW5kZW5jaWVzLnV0aWxzCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICk7CiAgICB9IGVsc2UgewogICAgICAgIHJvb3QuY29udmVyc2UgPSBmYWN0b3J5KGpRdWVyeSwgXywgT1RSLCBEU0EsIEpTVCwgbW9tZW50LCB1dGlscyk7CiAgICB9Cn0odGhpcywgZnVuY3Rpb24gKCQsIF8sIE9UUiwgRFNBLCB0ZW1wbGF0ZXMsIG1vbWVudCwgdXRpbHMpIHsKICAgIC8vIAogICAgLy8gQ2Fubm90IHVzZSB0aGlzIGR1ZSB0byBTYWZhcmkgYnVnLgogICAgLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9qY2JyYW5kL2NvbnZlcnNlLmpzL2lzc3Vlcy8xOTYKICAgIGlmICh0eXBlb2YgY29uc29sZSA9PT0gInVuZGVmaW5lZCIgfHwgdHlwZW9mIGNvbnNvbGUubG9nID09PSAidW5kZWZpbmVkIikgewogICAgICAgIGNvbnNvbGUgPSB7IGxvZzogZnVuY3Rpb24gKCkge30sIGVycm9yOiBmdW5jdGlvbiAoKSB7fSB9OwogICAgfQoKICAgIC8vIENvbmZpZ3VyYXRpb24gb2YgdW5kZXJzY29yZSB0ZW1wbGF0ZXMgKHRoaXMgY29uZmlnIGlzIGRpc3RpY3QgdG8gdGhlCiAgICAvLyBjb25maWcgb2YgcmVxdWlyZWpzLXRwbCBpbiBtYWluLmpzKS4gVGhpcyBvbmUgaXMgZm9yIG5vcm1hbCBpbmxpbmUKICAgIC8vIHRlbXBsYXRlcy4KICAgIC8vIFVzZSBNdXN0YWNoZSBzdHlsZSBzeW50YXggZm9yIHZhcmlhYmxlIGludGVycG9sYXRpb24KICAgIF8udGVtcGxhdGVTZXR0aW5ncyA9IHsKICAgICAgICBldmFsdWF0ZSA6IC9ce1xbKFtcc1xTXSs/KVxdXH0vZywKICAgICAgICBpbnRlcnBvbGF0ZSA6IC9ce1x7KFtcc1xTXSs/KVx9XH0vZwogICAgfTsKCiAgICB2YXIgY29udGFpbnMgPSBmdW5jdGlvbiAoYXR0ciwgcXVlcnkpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgaWYgKHR5cGVvZiBhdHRyID09PSAnb2JqZWN0JykgewogICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gZmFsc2U7CiAgICAgICAgICAgICAgICBfLmVhY2goYXR0ciwgZnVuY3Rpb24gKGEpIHsKICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHZhbHVlIHx8IGl0ZW0uZ2V0KGEpLnRvTG93ZXJDYXNlKCkuaW5kZXhPZihxdWVyeS50b0xvd2VyQ2FzZSgpKSAhPT0gLTE7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgYXR0ciA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgICAgIHJldHVybiBpdGVtLmdldChhdHRyKS50b0xvd2VyQ2FzZSgpLmluZGV4T2YocXVlcnkudG9Mb3dlckNhc2UoKSkgIT09IC0xOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdXcm9uZyBhdHRyaWJ1dGUgdHlwZS4gTXVzdCBiZSBzdHJpbmcgb3IgYXJyYXkuJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgfTsKICAgIGNvbnRhaW5zLm5vdCA9IGZ1bmN0aW9uIChhdHRyLCBxdWVyeSkgewogICAgICAgIHJldHVybiBmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICByZXR1cm4gIShjb250YWlucyhhdHRyLCBxdWVyeSkoaXRlbSkpOwogICAgICAgIH07CiAgICB9OwoKICAgIC8vIFhYWDogdGhlc2UgY2FuIHBlcmhhcHMgYmUgbW92ZWQgdG8gc3JjL3BvbHlmaWxscy5qcwogICAgU3RyaW5nLnByb3RvdHlwZS5zcGxpdE9uY2UgPSBmdW5jdGlvbiAoZGVsaW1pdGVyKSB7CiAgICAgICAgdmFyIGNvbXBvbmVudHMgPSB0aGlzLnNwbGl0KGRlbGltaXRlcik7CiAgICAgICAgcmV0dXJuIFtjb21wb25lbnRzLnNoaWZ0KCksIGNvbXBvbmVudHMuam9pbihkZWxpbWl0ZXIpXTsKICAgIH07CgogICAgJC5mbi5hZGRFbW90aWNvbnMgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKGNvbnZlcnNlLnZpc2libGVfdG9vbGJhcl9idXR0b25zLmVtb3RpY29ucykgewogICAgICAgICAgICBpZiAodGhpcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLmVhY2goZnVuY3Rpb24gKGksIG9iaikgewogICAgICAgICAgICAgICAgICAgIHZhciB0ZXh0ID0gJChvYmopLmh0bWwoKTsKICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC8mZ3Q7OlwpL2csICc8c3BhbiBjbGFzcz0iZW1vdGljb24gaWNvbi1ldmlsIj48L3NwYW4+Jyk7CiAgICAgICAgICAgICAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZSgvOlwpL2csICc8c3BhbiBjbGFzcz0iZW1vdGljb24gaWNvbi1zbWlsZXkiPjwvc3Bhbj4nKTsKICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC86XC1cKS9nLCAnPHNwYW4gY2xhc3M9ImVtb3RpY29uIGljb24tc21pbGV5Ij48L3NwYW4+Jyk7CiAgICAgICAgICAgICAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZSgvO1wpL2csICc8c3BhbiBjbGFzcz0iZW1vdGljb24gaWNvbi13aW5rIj48L3NwYW4+Jyk7CiAgICAgICAgICAgICAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZSgvO1wtXCkvZywgJzxzcGFuIGNsYXNzPSJlbW90aWNvbiBpY29uLXdpbmsiPjwvc3Bhbj4nKTsKICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC86RC9nLCAnPHNwYW4gY2xhc3M9ImVtb3RpY29uIGljb24tZ3JpbiI+PC9zcGFuPicpOwogICAgICAgICAgICAgICAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoLzpcLUQvZywgJzxzcGFuIGNsYXNzPSJlbW90aWNvbiBpY29uLWdyaW4iPjwvc3Bhbj4nKTsKICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC86UC9nLCAnPHNwYW4gY2xhc3M9ImVtb3RpY29uIGljb24tdG9uZ3VlIj48L3NwYW4+Jyk7CiAgICAgICAgICAgICAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZSgvOlwtUC9nLCAnPHNwYW4gY2xhc3M9ImVtb3RpY29uIGljb24tdG9uZ3VlIj48L3NwYW4+Jyk7CiAgICAgICAgICAgICAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZSgvOnAvZywgJzxzcGFuIGNsYXNzPSJlbW90aWNvbiBpY29uLXRvbmd1ZSI+PC9zcGFuPicpOwogICAgICAgICAgICAgICAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoLzpcLXAvZywgJzxzcGFuIGNsYXNzPSJlbW90aWNvbiBpY29uLXRvbmd1ZSI+PC9zcGFuPicpOwogICAgICAgICAgICAgICAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoLzhcKS9nLCAnPHNwYW4gY2xhc3M9ImVtb3RpY29uIGljb24tY29vbCI+PC9zcGFuPicpOwogICAgICAgICAgICAgICAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoLzpTL2csICc8c3BhbiBjbGFzcz0iZW1vdGljb24gaWNvbi1jb25mdXNlZCI+PC9zcGFuPicpOwogICAgICAgICAgICAgICAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoLzpcXC9nLCAnPHNwYW4gY2xhc3M9ImVtb3RpY29uIGljb24td29uZGVyaW5nIj48L3NwYW4+Jyk7CiAgICAgICAgICAgICAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZSgvOlwvIC9nLCAnPHNwYW4gY2xhc3M9ImVtb3RpY29uIGljb24td29uZGVyaW5nIj48L3NwYW4+Jyk7CiAgICAgICAgICAgICAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZSgvJmd0OzpcKC9nLCAnPHNwYW4gY2xhc3M9ImVtb3RpY29uIGljb24tYW5ncnkiPjwvc3Bhbj4nKTsKICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC86XCgvZywgJzxzcGFuIGNsYXNzPSJlbW90aWNvbiBpY29uLXNhZCI+PC9zcGFuPicpOwogICAgICAgICAgICAgICAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoLzpcLVwoL2csICc8c3BhbiBjbGFzcz0iZW1vdGljb24gaWNvbi1zYWQiPjwvc3Bhbj4nKTsKICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC86Ty9nLCAnPHNwYW4gY2xhc3M9ImVtb3RpY29uIGljb24tc2hvY2tlZCI+PC9zcGFuPicpOwogICAgICAgICAgICAgICAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoLzpcLU8vZywgJzxzcGFuIGNsYXNzPSJlbW90aWNvbiBpY29uLXNob2NrZWQiPjwvc3Bhbj4nKTsKICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC9cPVwtTy9nLCAnPHNwYW4gY2xhc3M9ImVtb3RpY29uIGljb24tc2hvY2tlZCI+PC9zcGFuPicpOwogICAgICAgICAgICAgICAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoL1woXF4uXF5cKWIvZywgJzxzcGFuIGNsYXNzPSJlbW90aWNvbiBpY29uLXRodW1icy11cCI+PC9zcGFuPicpOwogICAgICAgICAgICAgICAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoLyZsdDszL2csICc8c3BhbiBjbGFzcz0iZW1vdGljb24gaWNvbi1oZWFydCI+PC9zcGFuPicpOwogICAgICAgICAgICAgICAgICAgICQob2JqKS5odG1sKHRleHQpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9OwoKICAgIHZhciBwbGF5Tm90aWZpY2F0aW9uID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBhdWRpbzsKICAgICAgICBpZiAoY29udmVyc2UucGxheV9zb3VuZHMgJiYgdHlwZW9mIEF1ZGlvICE9PSAidW5kZWZpbmVkIil7CiAgICAgICAgICAgIGF1ZGlvID0gbmV3IEF1ZGlvKCJzb3VuZHMvbXNnX3JlY2VpdmVkLm9nZyIpOwogICAgICAgICAgICBpZiAoYXVkaW8uY2FuUGxheVR5cGUoJy9hdWRpby9vZ2cnKSkgewogICAgICAgICAgICAgICAgYXVkaW8ucGxheSgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgYXVkaW8gPSBuZXcgQXVkaW8oIi9zb3VuZHMvbXNnX3JlY2VpdmVkLm1wMyIpOwogICAgICAgICAgICAgICAgYXVkaW8ucGxheSgpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKCiAgICB2YXIgY29udmVyc2UgPSB7CiAgICAgICAgcGx1Z2luczoge30sCiAgICAgICAgdGVtcGxhdGVzOiB0ZW1wbGF0ZXMsCiAgICAgICAgZW1pdDogZnVuY3Rpb24gKGV2dCwgZGF0YSkgewogICAgICAgICAgICAkKHRoaXMpLnRyaWdnZXIoZXZ0LCBkYXRhKTsKICAgICAgICB9LAogICAgICAgIG9uY2U6IGZ1bmN0aW9uIChldnQsIGhhbmRsZXIpIHsKICAgICAgICAgICAgJCh0aGlzKS5vbmUoZXZ0LCBoYW5kbGVyKTsKICAgICAgICB9LAogICAgICAgIG9uOiBmdW5jdGlvbiAoZXZ0LCBoYW5kbGVyKSB7CiAgICAgICAgICAgICQodGhpcykuYmluZChldnQsIGhhbmRsZXIpOwogICAgICAgIH0sCiAgICAgICAgb2ZmOiBmdW5jdGlvbiAoZXZ0LCBoYW5kbGVyKSB7CiAgICAgICAgICAgICQodGhpcykudW5iaW5kKGV2dCwgaGFuZGxlcik7CiAgICAgICAgfSwKICAgICAgICByZWZyZXNoV2Via2l0OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIC8qIFRoaXMgd29ya3MgYXJvdW5kIGEgd2Via2l0IGJ1Zy4gUmVmcmVzaCB0aGUgYnJvd3NlcidzIHZpZXdwb3J0LAogICAgICAgICAgICAqIG90aGVyd2lzZSBjaGF0Ym94ZXMgYXJlIG5vdCBtb3ZlZCBhbG9uZyB3aGVuIG9uZSBpcyBjbG9zZWQuCiAgICAgICAgICAgICovCiAgICAgICAgICAgIGlmICgkLmJyb3dzZXIud2Via2l0KSB7CiAgICAgICAgICAgICAgICB2YXIgY29udmVyc2VqcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb252ZXJzZWpzJyk7CiAgICAgICAgICAgICAgICBjb252ZXJzZWpzLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgICAgICBjb252ZXJzZWpzLm9mZnNldEhlaWdodCA9IGNvbnZlcnNlanMub2Zmc2V0SGVpZ2h0OwogICAgICAgICAgICAgICAgY29udmVyc2Vqcy5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CgogICAgY29udmVyc2UuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uIChzZXR0aW5ncywgY2FsbGJhY2spIHsKICAgICAgICB2YXIgY29udmVyc2UgPSB0aGlzOwoKICAgICAgICAvLyBDb25zdGFudHMKICAgICAgICAvLyAtLS0tLS0tLS0KICAgICAgICB2YXIgVU5FTkNSWVBURUQgPSAwOwogICAgICAgIHZhciBVTlZFUklGSUVEPSAxOwogICAgICAgIHZhciBWRVJJRklFRD0gMjsKICAgICAgICB2YXIgRklOSVNIRUQgPSAzOwogICAgICAgIHZhciBLRVkgPSB7CiAgICAgICAgICAgIEVOVEVSOiAxMwogICAgICAgIH07CiAgICAgICAgdmFyIFNUQVRVU19XRUlHSFRTID0gewogICAgICAgICAgICAnb2ZmbGluZSc6ICAgICAgNiwKICAgICAgICAgICAgJ3VuYXZhaWxhYmxlJzogIDUsCiAgICAgICAgICAgICd4YSc6ICAgICAgICAgICA0LAogICAgICAgICAgICAnYXdheSc6ICAgICAgICAgMywKICAgICAgICAgICAgJ2RuZCc6ICAgICAgICAgIDIsCiAgICAgICAgICAgICdvbmxpbmUnOiAgICAgICAxCiAgICAgICAgfTsKCiAgICAgICAgdmFyIElOQUNUSVZFID0gJ2luYWN0aXZlJzsKICAgICAgICB2YXIgQUNUSVZFID0gJ2FjdGl2ZSc7CiAgICAgICAgdmFyIENPTVBPU0lORyA9ICdjb21wb3NpbmcnOwogICAgICAgIHZhciBQQVVTRUQgPSAncGF1c2VkJzsKICAgICAgICB2YXIgR09ORSA9ICdnb25lJzsKCiAgICAgICAgdmFyIEhBU19DU1BSTkcgPSAoKHR5cGVvZiBjcnlwdG8gIT09ICd1bmRlZmluZWQnKSAmJgogICAgICAgICAgICAoKHR5cGVvZiBjcnlwdG8ucmFuZG9tQnl0ZXMgPT09ICdmdW5jdGlvbicpIHx8CiAgICAgICAgICAgICAgICAodHlwZW9mIGNyeXB0by5nZXRSYW5kb21WYWx1ZXMgPT09ICdmdW5jdGlvbicpCiAgICAgICAgKSk7CiAgICAgICAgdmFyIEhBU19DUllQVE8gPSBIQVNfQ1NQUk5HICYmICgKICAgICAgICAgICAgKHR5cGVvZiBDcnlwdG9KUyAhPT0gInVuZGVmaW5lZCIpICYmCiAgICAgICAgICAgICh0eXBlb2YgT1RSICE9PSAidW5kZWZpbmVkIikgJiYKICAgICAgICAgICAgKHR5cGVvZiBEU0EgIT09ICJ1bmRlZmluZWQiKQogICAgICAgICk7CgogICAgICAgIHZhciBPUEVORUQgPSAnb3BlbmVkJzsKICAgICAgICB2YXIgQ0xPU0VEID0gJ2Nsb3NlZCc7CgogICAgICAgIC8vIERlZmF1bHQgY29uZmlndXJhdGlvbiB2YWx1ZXMKICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgICAgdGhpcy5hbGxvd19jb250YWN0X3JlcXVlc3RzID0gdHJ1ZTsKICAgICAgICB0aGlzLmFsbG93X2RyYWdyZXNpemUgPSB0cnVlOwogICAgICAgIHRoaXMuYWxsb3dfbG9nb3V0ID0gdHJ1ZTsKICAgICAgICB0aGlzLmFsbG93X211YyA9IHRydWU7CiAgICAgICAgdGhpcy5hbGxvd19vdHIgPSB0cnVlOwogICAgICAgIHRoaXMuYW5pbWF0ZSA9IHRydWU7CiAgICAgICAgdGhpcy5hdXRvX2xpc3Rfcm9vbXMgPSBmYWxzZTsKICAgICAgICB0aGlzLmF1dG9fcmVjb25uZWN0ID0gZmFsc2U7CiAgICAgICAgdGhpcy5hdXRvX3N1YnNjcmliZSA9IGZhbHNlOwogICAgICAgIHRoaXMuYm9zaF9zZXJ2aWNlX3VybCA9IHVuZGVmaW5lZDsgLy8gVGhlIEJPU0ggY29ubmVjdGlvbiBtYW5hZ2VyIFVSTC4KICAgICAgICB0aGlzLmNhY2hlX290cl9rZXkgPSBmYWxzZTsKICAgICAgICB0aGlzLmRlYnVnID0gZmFsc2U7CiAgICAgICAgdGhpcy5kZWZhdWx0X2JveF9oZWlnaHQgPSAzMjQ7IC8vIFRoZSBkZWZhdWx0IGhlaWdodCwgaW4gcGl4ZWxzLCBmb3IgdGhlIGNvbnRyb2wgYm94LCBjaGF0IGJveGVzIGFuZCBjaGF0cm9vbXMuCiAgICAgICAgdGhpcy5leHBvc2VfcmlkX2FuZF9zaWQgPSBmYWxzZTsKICAgICAgICB0aGlzLmZvcndhcmRfbWVzc2FnZXMgPSBmYWxzZTsKICAgICAgICB0aGlzLmhpZGVfbXVjX3NlcnZlciA9IGZhbHNlOwogICAgICAgIHRoaXMuaTE4biA9IGxvY2FsZXMuZW47CiAgICAgICAgdGhpcy5rZWVwYWxpdmUgPSBmYWxzZTsKICAgICAgICB0aGlzLm1lc3NhZ2VfY2FyYm9ucyA9IGZhbHNlOwogICAgICAgIHRoaXMubm9fdHJpbW1pbmcgPSBmYWxzZTsgLy8gU2V0IHRvIHRydWUgZm9yIHBoYW50b21qcyB0ZXN0cyAod2hlcmUgYnJvd3NlciBhcHBhcmVudGx5IGhhcyBubyB3aWR0aCkKICAgICAgICB0aGlzLnBsYXlfc291bmRzID0gZmFsc2U7CiAgICAgICAgdGhpcy5wcmViaW5kID0gZmFsc2U7CiAgICAgICAgdGhpcy5yb3N0ZXJfZ3JvdXBzID0gZmFsc2U7CiAgICAgICAgdGhpcy5zaG93X2NvbnRyb2xib3hfYnlfZGVmYXVsdCA9IGZhbHNlOwogICAgICAgIHRoaXMuc2hvd19vbmx5X29ubGluZV91c2VycyA9IGZhbHNlOwogICAgICAgIHRoaXMuc2hvd190b29sYmFyID0gdHJ1ZTsKICAgICAgICB0aGlzLnN0b3JhZ2UgPSAnc2Vzc2lvbic7CiAgICAgICAgdGhpcy51c2Vfb3RyX2J5X2RlZmF1bHQgPSBmYWxzZTsKICAgICAgICB0aGlzLnVzZV92Y2FyZHMgPSB0cnVlOwogICAgICAgIHRoaXMudmlzaWJsZV90b29sYmFyX2J1dHRvbnMgPSB7CiAgICAgICAgICAgICdlbW90aWNvbnMnOiB0cnVlLAogICAgICAgICAgICAnY2FsbCc6IGZhbHNlLAogICAgICAgICAgICAnY2xlYXInOiB0cnVlLAogICAgICAgICAgICAndG9nZ2xlX3BhcnRpY2lwYW50cyc6IHRydWUKICAgICAgICB9OwogICAgICAgIHRoaXMueGhyX2N1c3RvbV9zdGF0dXMgPSBmYWxzZTsKICAgICAgICB0aGlzLnhocl9jdXN0b21fc3RhdHVzX3VybCA9ICcnOwogICAgICAgIHRoaXMueGhyX3VzZXJfc2VhcmNoID0gZmFsc2U7CiAgICAgICAgdGhpcy54aHJfdXNlcl9zZWFyY2hfdXJsID0gJyc7CgogICAgICAgIC8vIEFsbG93IG9ubHkgd2hpdGVsaXN0ZWQgY29uZmlndXJhdGlvbiBhdHRyaWJ1dGVzIHRvIGJlIG92ZXJ3cml0dGVuCiAgICAgICAgXy5leHRlbmQodGhpcywgXy5waWNrKHNldHRpbmdzLCBbCiAgICAgICAgICAgICdhbGxvd19jb250YWN0X3JlcXVlc3RzJywKICAgICAgICAgICAgJ2FsbG93X2RyYWdyZXNpemUnLAogICAgICAgICAgICAnYWxsb3dfbG9nb3V0JywKICAgICAgICAgICAgJ2FsbG93X211YycsCiAgICAgICAgICAgICdhbGxvd19vdHInLAogICAgICAgICAgICAnYW5pbWF0ZScsCiAgICAgICAgICAgICdhdXRvX2xpc3Rfcm9vbXMnLAogICAgICAgICAgICAnYXV0b19yZWNvbm5lY3QnLAogICAgICAgICAgICAnYXV0b19zdWJzY3JpYmUnLAogICAgICAgICAgICAnYm9zaF9zZXJ2aWNlX3VybCcsCiAgICAgICAgICAgICdjYWNoZV9vdHJfa2V5JywKICAgICAgICAgICAgJ2Nvbm5lY3Rpb24nLAogICAgICAgICAgICAnZGVidWcnLAogICAgICAgICAgICAnZGVmYXVsdF9ib3hfaGVpZ2h0JywKICAgICAgICAgICAgJ2tlZXBhbGl2ZScsCiAgICAgICAgICAgICdtZXNzYWdlX2NhcmJvbnMnLAogICAgICAgICAgICAnZXhwb3NlX3JpZF9hbmRfc2lkJywKICAgICAgICAgICAgJ2ZvcndhcmRfbWVzc2FnZXMnLAogICAgICAgICAgICAnZnVsbG5hbWUnLAogICAgICAgICAgICAnaGlkZV9tdWNfc2VydmVyJywKICAgICAgICAgICAgJ2kxOG4nLAogICAgICAgICAgICAnamlkJywKICAgICAgICAgICAgJ25vX3RyaW1taW5nJywKICAgICAgICAgICAgJ3BsYXlfc291bmRzJywKICAgICAgICAgICAgJ3ByZWJpbmQnLAogICAgICAgICAgICAncmlkJywKICAgICAgICAgICAgJ3Jvc3Rlcl9ncm91cHMnLAogICAgICAgICAgICAnc2hvd19jb250cm9sYm94X2J5X2RlZmF1bHQnLAogICAgICAgICAgICAnc2hvd19vbmx5X29ubGluZV91c2VycycsCiAgICAgICAgICAgICdzaG93X3Rvb2xiYXInLAogICAgICAgICAgICAnc2lkJywKICAgICAgICAgICAgJ3N0b3JhZ2UnLAogICAgICAgICAgICAndXNlX290cl9ieV9kZWZhdWx0JywKICAgICAgICAgICAgJ3VzZV92Y2FyZHMnLAogICAgICAgICAgICAneGhyX2N1c3RvbV9zdGF0dXMnLAogICAgICAgICAgICAneGhyX2N1c3RvbV9zdGF0dXNfdXJsJywKICAgICAgICAgICAgJ3hocl91c2VyX3NlYXJjaCcsCiAgICAgICAgICAgICd4aHJfdXNlcl9zZWFyY2hfdXJsJwogICAgICAgIF0pKTsKICAgICAgICBpZiAoc2V0dGluZ3MudmlzaWJsZV90b29sYmFyX2J1dHRvbnMpIHsKICAgICAgICAgICAgXy5leHRlbmQoCiAgICAgICAgICAgICAgICB0aGlzLnZpc2libGVfdG9vbGJhcl9idXR0b25zLAogICAgICAgICAgICAgICAgXy5waWNrKHNldHRpbmdzLnZpc2libGVfdG9vbGJhcl9idXR0b25zLCBbCiAgICAgICAgICAgICAgICAgICAgJ2Vtb3RpY29ucycsICdjYWxsJywgJ2NsZWFyJywgJ3RvZ2dsZV9wYXJ0aWNpcGFudHMnCiAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICkpOwogICAgICAgIH0KICAgICAgICAkLmZ4Lm9mZiA9ICF0aGlzLmFuaW1hdGU7CgogICAgICAgIC8vIE9ubHkgYWxsb3cgT1RSIGlmIHdlIGhhdmUgdGhlIGNhcGFiaWxpdHkKICAgICAgICB0aGlzLmFsbG93X290ciA9IHRoaXMuYWxsb3dfb3RyICYmIEhBU19DUllQVE87CgogICAgICAgIC8vIE9ubHkgdXNlIE9UUiBieSBkZWZhdWx0IGlmIGFsbG93IE9UUiBpcyBlbmFibGVkIHRvIGJlZ2luIHdpdGgKICAgICAgICB0aGlzLnVzZV9vdHJfYnlfZGVmYXVsdCA9IHRoaXMudXNlX290cl9ieV9kZWZhdWx0ICYmIHRoaXMuYWxsb3dfb3RyOwoKICAgICAgICAvLyBUcmFuc2xhdGlvbiBtYWNoaW5lcnkKICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAgICB2YXIgX18gPSAkLnByb3h5KHV0aWxzLl9fLCB0aGlzKTsKICAgICAgICB2YXIgX19fID0gdXRpbHMuX19fOwogICAgICAgIC8vIFRyYW5zbGF0aW9uIGF3YXJlIGNvbnN0YW50cwogICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICAgIHZhciBPVFJfQ0xBU1NfTUFQUElORyA9IHt9OwogICAgICAgIE9UUl9DTEFTU19NQVBQSU5HW1VORU5DUllQVEVEXSA9ICd1bmVuY3J5cHRlZCc7CiAgICAgICAgT1RSX0NMQVNTX01BUFBJTkdbVU5WRVJJRklFRF0gPSAndW52ZXJpZmllZCc7CiAgICAgICAgT1RSX0NMQVNTX01BUFBJTkdbVkVSSUZJRURdID0gJ3ZlcmlmaWVkJzsKICAgICAgICBPVFJfQ0xBU1NfTUFQUElOR1tGSU5JU0hFRF0gPSAnZmluaXNoZWQnOwoKICAgICAgICB2YXIgT1RSX1RSQU5TTEFURURfTUFQUElORyAgPSB7fTsKICAgICAgICBPVFJfVFJBTlNMQVRFRF9NQVBQSU5HW1VORU5DUllQVEVEXSA9IF9fKCd1bmVuY3J5cHRlZCcpOwogICAgICAgIE9UUl9UUkFOU0xBVEVEX01BUFBJTkdbVU5WRVJJRklFRF0gPSBfXygndW52ZXJpZmllZCcpOwogICAgICAgIE9UUl9UUkFOU0xBVEVEX01BUFBJTkdbVkVSSUZJRURdID0gX18oJ3ZlcmlmaWVkJyk7CiAgICAgICAgT1RSX1RSQU5TTEFURURfTUFQUElOR1tGSU5JU0hFRF0gPSBfXygnZmluaXNoZWQnKTsKCiAgICAgICAgdmFyIFNUQVRVU0VTID0gewogICAgICAgICAgICAnZG5kJzogX18oJ1RoaXMgY29udGFjdCBpcyBidXN5JyksCiAgICAgICAgICAgICdvbmxpbmUnOiBfXygnVGhpcyBjb250YWN0IGlzIG9ubGluZScpLAogICAgICAgICAgICAnb2ZmbGluZSc6IF9fKCdUaGlzIGNvbnRhY3QgaXMgb2ZmbGluZScpLAogICAgICAgICAgICAndW5hdmFpbGFibGUnOiBfXygnVGhpcyBjb250YWN0IGlzIHVuYXZhaWxhYmxlJyksCiAgICAgICAgICAgICd4YSc6IF9fKCdUaGlzIGNvbnRhY3QgaXMgYXdheSBmb3IgYW4gZXh0ZW5kZWQgcGVyaW9kJyksCiAgICAgICAgICAgICdhd2F5JzogX18oJ1RoaXMgY29udGFjdCBpcyBhd2F5JykKICAgICAgICB9OwogICAgICAgIHZhciBERVNDX0dST1VQX1RPR0dMRSA9IF9fKCdDbGljayB0byBoaWRlIHRoZXNlIGNvbnRhY3RzJyk7CgogICAgICAgIHZhciBIRUFERVJfQ1VSUkVOVF9DT05UQUNUUyA9ICBfXygnTXkgY29udGFjdHMnKTsKICAgICAgICB2YXIgSEVBREVSX1BFTkRJTkdfQ09OVEFDVFMgPSBfXygnUGVuZGluZyBjb250YWN0cycpOwogICAgICAgIHZhciBIRUFERVJfUkVRVUVTVElOR19DT05UQUNUUyA9IF9fKCdDb250YWN0IHJlcXVlc3RzJyk7CiAgICAgICAgdmFyIEhFQURFUl9VTkdST1VQRUQgPSBfXygnVW5ncm91cGVkJyk7CgogICAgICAgIHZhciBMQUJFTF9DT05UQUNUUyA9IF9fKCdDb250YWN0cycpOwogICAgICAgIHZhciBMQUJFTF9HUk9VUFMgPSBfXygnR3JvdXBzJyk7CgogICAgICAgIHZhciBIRUFERVJfV0VJR0hUUyA9IHt9OwogICAgICAgIEhFQURFUl9XRUlHSFRTW0hFQURFUl9DVVJSRU5UX0NPTlRBQ1RTXSAgICA9IDA7CiAgICAgICAgSEVBREVSX1dFSUdIVFNbSEVBREVSX1VOR1JPVVBFRF0gICAgICAgICAgID0gMTsKICAgICAgICBIRUFERVJfV0VJR0hUU1tIRUFERVJfUkVRVUVTVElOR19DT05UQUNUU10gPSAyOwogICAgICAgIEhFQURFUl9XRUlHSFRTW0hFQURFUl9QRU5ESU5HX0NPTlRBQ1RTXSAgICA9IDM7CgogICAgICAgIC8vIE1vZHVsZS1sZXZlbCB2YXJpYWJsZXMKICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgICAgdGhpcy5jYWxsYmFjayA9IGNhbGxiYWNrIHx8IGZ1bmN0aW9uICgpIHt9OwogICAgICAgIHRoaXMuaW5pdGlhbF9wcmVzZW5jZV9zZW50ID0gMDsKICAgICAgICB0aGlzLm1zZ19jb3VudGVyID0gMDsKCiAgICAgICAgLy8gTW9kdWxlLWxldmVsIGZ1bmN0aW9ucwogICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAgICB0aGlzLmdpdmVGZWVkYmFjayA9IGZ1bmN0aW9uIChtZXNzYWdlLCBrbGFzcykgewogICAgICAgICAgICAkKCcuY29ubi1mZWVkYmFjaycpLmF0dHIoJ2NsYXNzJywgJ2Nvbm4tZmVlZGJhY2snKS50ZXh0KG1lc3NhZ2UpOwogICAgICAgICAgICBpZiAoa2xhc3MpIHsKICAgICAgICAgICAgICAgICQoJy5jb25uLWZlZWRiYWNrJykuYWRkQ2xhc3Moa2xhc3MpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgdGhpcy5sb2cgPSBmdW5jdGlvbiAodHh0LCBsZXZlbCkgewogICAgICAgICAgICBpZiAodGhpcy5kZWJ1ZykgewogICAgICAgICAgICAgICAgaWYgKGxldmVsID09ICdlcnJvcicpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnRVJST1I6ICcrdHh0KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2codHh0KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIHRoaXMuZ2V0VkNhcmQgPSBmdW5jdGlvbiAoamlkLCBjYWxsYmFjaywgZXJyYmFjaykgewogICAgICAgICAgICBpZiAoIXRoaXMudXNlX3ZjYXJkcykgewogICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrKSB7CiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soamlkLCBqaWQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnZlcnNlLmNvbm5lY3Rpb24udmNhcmQuZ2V0KAogICAgICAgICAgICAgICAgJC5wcm94eShmdW5jdGlvbiAoaXEpIHsKICAgICAgICAgICAgICAgICAgICAvLyBTdWNjZXNzZnVsIGNhbGxiYWNrCiAgICAgICAgICAgICAgICAgICAgdmFyICR2Y2FyZCA9ICQoaXEpLmZpbmQoJ3ZDYXJkJyk7CiAgICAgICAgICAgICAgICAgICAgdmFyIGZ1bGxuYW1lID0gJHZjYXJkLmZpbmQoJ0ZOJykudGV4dCgpLAogICAgICAgICAgICAgICAgICAgICAgICBpbWcgPSAkdmNhcmQuZmluZCgnQklOVkFMJykudGV4dCgpLAogICAgICAgICAgICAgICAgICAgICAgICBpbWdfdHlwZSA9ICR2Y2FyZC5maW5kKCdUWVBFJykudGV4dCgpLAogICAgICAgICAgICAgICAgICAgICAgICB1cmwgPSAkdmNhcmQuZmluZCgnVVJMJykudGV4dCgpOwogICAgICAgICAgICAgICAgICAgIGlmIChqaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbnRhY3QgPSBjb252ZXJzZS5yb3N0ZXIuZ2V0KGppZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb250YWN0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdWxsbmFtZSA9IF8uaXNFbXB0eShmdWxsbmFtZSk/IGNvbnRhY3QuZ2V0KCdmdWxsbmFtZScpIHx8IGppZDogZnVsbG5hbWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250YWN0LnNhdmUoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdmdWxsbmFtZSc6IGZ1bGxuYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdpbWFnZV90eXBlJzogaW1nX3R5cGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2ltYWdlJzogaW1nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd1cmwnOiB1cmwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3ZjYXJkX3VwZGF0ZWQnOiBtb21lbnQoKS5mb3JtYXQoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGppZCwgZnVsbG5hbWUsIGltZywgaW1nX3R5cGUsIHVybCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwgdGhpcyksCiAgICAgICAgICAgICAgICBqaWQsCiAgICAgICAgICAgICAgICBmdW5jdGlvbiAoaXEpIHsKICAgICAgICAgICAgICAgICAgICAvLyBFcnJvciBjYWxsYmFjawogICAgICAgICAgICAgICAgICAgIHZhciBjb250YWN0ID0gY29udmVyc2Uucm9zdGVyLmdldChqaWQpOwogICAgICAgICAgICAgICAgICAgIGlmIChjb250YWN0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhY3Quc2F2ZSh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAndmNhcmRfdXBkYXRlZCc6IG1vbWVudCgpLmZvcm1hdCgpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoZXJyYmFjaykgewogICAgICAgICAgICAgICAgICAgICAgICBlcnJiYWNrKGppZCwgaXEpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgKTsKICAgICAgICB9OwoKICAgICAgICB0aGlzLnJlY29ubmVjdCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgY29udmVyc2UuZ2l2ZUZlZWRiYWNrKF9fKCdSZWNvbm5lY3RpbmcnKSwgJ2Vycm9yJyk7CiAgICAgICAgICAgIGNvbnZlcnNlLmVtaXQoJ3JlY29ubmVjdCcpOwogICAgICAgICAgICBpZiAoIWNvbnZlcnNlLnByZWJpbmQpIHsKICAgICAgICAgICAgICAgIHRoaXMuY29ubmVjdGlvbi5jb25uZWN0KAogICAgICAgICAgICAgICAgICAgIHRoaXMuY29ubmVjdGlvbi5qaWQsCiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25uZWN0aW9uLnBhc3MsCiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKHN0YXR1cywgY29uZGl0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLm9uQ29ubmVjdChzdGF0dXMsIGNvbmRpdGlvbiwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbm5lY3Rpb24ud2FpdCwKICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbm5lY3Rpb24uaG9sZCwKICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbm5lY3Rpb24ucm91dGUKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICB0aGlzLnJlbmRlckxvZ2luUGFuZWwgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGNvbnZlcnNlLl90ZWFyRG93bigpOwogICAgICAgICAgICB2YXIgdmlldyA9IGNvbnZlcnNlLmNoYXRib3h2aWV3cy5nZXQoJ2NvbnRyb2xib3gnKTsKICAgICAgICAgICAgdmlldy5tb2RlbC5zZXQoe2Nvbm5lY3RlZDpmYWxzZX0pOwogICAgICAgICAgICB2aWV3LnJlbmRlckxvZ2luUGFuZWwoKTsKICAgICAgICB9OwoKICAgICAgICB0aGlzLm9uQ29ubmVjdCA9IGZ1bmN0aW9uIChzdGF0dXMsIGNvbmRpdGlvbiwgcmVjb25uZWN0KSB7CiAgICAgICAgICAgIHZhciAkYnV0dG9uLCAkZm9ybTsKICAgICAgICAgICAgaWYgKChzdGF0dXMgPT09IFN0cm9waGUuU3RhdHVzLkNPTk5FQ1RFRCkgfHwKICAgICAgICAgICAgICAgIChzdGF0dXMgPT09IFN0cm9waGUuU3RhdHVzLkFUVEFDSEVEKSkgewogICAgICAgICAgICAgICAgaWYgKCh0eXBlb2YgcmVjb25uZWN0ICE9PSAndW5kZWZpbmVkJykgJiYgKHJlY29ubmVjdCkpIHsKICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS5sb2coc3RhdHVzID09PSBTdHJvcGhlLlN0YXR1cy5DT05ORUNURUQgPyAnUmVjb25uZWN0ZWQnIDogJ1JlYXR0YWNoZWQnKTsKICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS5vblJlY29ubmVjdGVkKCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLmxvZyhzdGF0dXMgPT09IFN0cm9waGUuU3RhdHVzLkNPTk5FQ1RFRCA/ICdDb25uZWN0ZWQnIDogJ0F0dGFjaGVkJyk7CiAgICAgICAgICAgICAgICAgICAgY29udmVyc2Uub25Db25uZWN0ZWQoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChzdGF0dXMgPT09IFN0cm9waGUuU3RhdHVzLkRJU0NPTk5FQ1RFRCkgewogICAgICAgICAgICAgICAgY29udmVyc2UuZ2l2ZUZlZWRiYWNrKF9fKCdEaXNjb25uZWN0ZWQnKSwgJ2Vycm9yJyk7CiAgICAgICAgICAgICAgICBpZiAoY29udmVyc2UuYXV0b19yZWNvbm5lY3QpIHsKICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS5yZWNvbm5lY3QoKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgY29udmVyc2UucmVuZGVyTG9naW5QYW5lbCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKHN0YXR1cyA9PT0gU3Ryb3BoZS5TdGF0dXMuRXJyb3IpIHsKICAgICAgICAgICAgICAgIGNvbnZlcnNlLnJlbmRlckxvZ2luUGFuZWwoKTsKICAgICAgICAgICAgICAgIGNvbnZlcnNlLmdpdmVGZWVkYmFjayhfXygnRXJyb3InKSwgJ2Vycm9yJyk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoc3RhdHVzID09PSBTdHJvcGhlLlN0YXR1cy5DT05ORUNUSU5HKSB7CiAgICAgICAgICAgICAgICBjb252ZXJzZS5naXZlRmVlZGJhY2soX18oJ0Nvbm5lY3RpbmcnKSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoc3RhdHVzID09PSBTdHJvcGhlLlN0YXR1cy5DT05ORkFJTCkgewogICAgICAgICAgICAgICAgY29udmVyc2UucmVuZGVyTG9naW5QYW5lbCgpOwogICAgICAgICAgICAgICAgY29udmVyc2UuZ2l2ZUZlZWRiYWNrKF9fKCdDb25uZWN0aW9uIEZhaWxlZCcpLCAnZXJyb3InKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChzdGF0dXMgPT09IFN0cm9waGUuU3RhdHVzLkFVVEhFTlRJQ0FUSU5HKSB7CiAgICAgICAgICAgICAgICBjb252ZXJzZS5naXZlRmVlZGJhY2soX18oJ0F1dGhlbnRpY2F0aW5nJykpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHN0YXR1cyA9PT0gU3Ryb3BoZS5TdGF0dXMuQVVUSEZBSUwpIHsKICAgICAgICAgICAgICAgIGNvbnZlcnNlLnJlbmRlckxvZ2luUGFuZWwoKTsKICAgICAgICAgICAgICAgIGNvbnZlcnNlLmdpdmVGZWVkYmFjayhfXygnQXV0aGVudGljYXRpb24gRmFpbGVkJyksICdlcnJvcicpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHN0YXR1cyA9PT0gU3Ryb3BoZS5TdGF0dXMuRElTQ09OTkVDVElORykgewogICAgICAgICAgICAgICAgaWYgKCFjb252ZXJzZS5jb25uZWN0aW9uLmNvbm5lY3RlZCkgewogICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLnJlbmRlckxvZ2luUGFuZWwoKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgY29udmVyc2UuZ2l2ZUZlZWRiYWNrKF9fKCdEaXNjb25uZWN0aW5nJyksICdlcnJvcicpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgdGhpcy5hcHBseUhlaWdodFJlc2lzdGFuY2UgPSBmdW5jdGlvbiAoaGVpZ2h0KSB7CiAgICAgICAgICAgIC8qIFRoaXMgbWV0aG9kIGFwcGxpZXMgc29tZSByZXNpc3RhbmNlL2dyYXZpdHkgYXJvdW5kIHRoZQogICAgICAgICAgICAgKiAiZGVmYXVsdF9ib3hfaGVpZ2h0Ii4gSWYgImhlaWdodCIgaXMgY2xvc2UgZW5vdWdoIHRvCiAgICAgICAgICAgICAqIGRlZmF1bHRfYm94X2hlaWdodCwgdGhlbiB0aGF0IGlzIHJldHVybmVkIGluc3RlYWQuCiAgICAgICAgICAgICAqLwogICAgICAgICAgICBpZiAodHlwZW9mIGhlaWdodCA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgICAgICAgIHJldHVybiBjb252ZXJzZS5kZWZhdWx0X2JveF9oZWlnaHQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIHJlc2lzdGFuY2UgPSAxMDsKICAgICAgICAgICAgaWYgKChoZWlnaHQgIT09IGNvbnZlcnNlLmRlZmF1bHRfYm94X2hlaWdodCkgJiYKICAgICAgICAgICAgICAgIChNYXRoLmFicyhoZWlnaHQgLSBjb252ZXJzZS5kZWZhdWx0X2JveF9oZWlnaHQpIDwgcmVzaXN0YW5jZSkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBjb252ZXJzZS5kZWZhdWx0X2JveF9oZWlnaHQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGhlaWdodDsKICAgICAgICB9OwoKICAgICAgICB0aGlzLnVwZGF0ZU1zZ0NvdW50ZXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLm1zZ19jb3VudGVyID4gMCkgewogICAgICAgICAgICAgICAgaWYgKGRvY3VtZW50LnRpdGxlLnNlYXJjaCgvXk1lc3NhZ2VzIFwoXGQrXCkgLykgPT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC50aXRsZSA9ICJNZXNzYWdlcyAoIiArIHRoaXMubXNnX2NvdW50ZXIgKyAiKSAiICsgZG9jdW1lbnQudGl0bGU7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LnRpdGxlID0gZG9jdW1lbnQudGl0bGUucmVwbGFjZSgvXk1lc3NhZ2VzIFwoXGQrXCkgLywgIk1lc3NhZ2VzICgiICsgdGhpcy5tc2dfY291bnRlciArICIpICIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgd2luZG93LmJsdXIoKTsKICAgICAgICAgICAgICAgIHdpbmRvdy5mb2N1cygpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGRvY3VtZW50LnRpdGxlLnNlYXJjaCgvXk1lc3NhZ2VzIFwoXGQrXCkgLykgIT0gLTEpIHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LnRpdGxlID0gZG9jdW1lbnQudGl0bGUucmVwbGFjZSgvXk1lc3NhZ2VzIFwoXGQrXCkgLywgIiIpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgdGhpcy5pbmNyZW1lbnRNc2dDb3VudGVyID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICB0aGlzLm1zZ19jb3VudGVyICs9IDE7CiAgICAgICAgICAgIHRoaXMudXBkYXRlTXNnQ291bnRlcigpOwogICAgICAgIH07CgogICAgICAgIHRoaXMuY2xlYXJNc2dDb3VudGVyID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICB0aGlzLm1zZ19jb3VudGVyID0gMDsKICAgICAgICAgICAgdGhpcy51cGRhdGVNc2dDb3VudGVyKCk7CiAgICAgICAgfTsKCiAgICAgICAgdGhpcy5pbml0U3RhdHVzID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7CiAgICAgICAgICAgIHRoaXMueG1wcHN0YXR1cyA9IG5ldyB0aGlzLlhNUFBTdGF0dXMoKTsKICAgICAgICAgICAgdmFyIGlkID0gYjY0X3NoYTEoJ2NvbnZlcnNlLnhtcHBzdGF0dXMtJytjb252ZXJzZS5iYXJlX2ppZCk7CiAgICAgICAgICAgIHRoaXMueG1wcHN0YXR1cy5pZCA9IGlkOyAvLyBBcHBlYXJzIHRvIGJlIG5lY2Vzc2FyeSBmb3IgYmFja2JvbmUuYnJvd3NlclN0b3JhZ2UKICAgICAgICAgICAgdGhpcy54bXBwc3RhdHVzLmJyb3dzZXJTdG9yYWdlID0gbmV3IEJhY2tib25lLkJyb3dzZXJTdG9yYWdlW2NvbnZlcnNlLnN0b3JhZ2VdKGlkKTsKICAgICAgICAgICAgdGhpcy54bXBwc3RhdHVzLmZldGNoKHtzdWNjZXNzOiBjYWxsYmFjaywgZXJyb3I6IGNhbGxiYWNrfSk7CiAgICAgICAgfTsKCiAgICAgICAgdGhpcy5pbml0U2Vzc2lvbiA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdGhpcy5zZXNzaW9uID0gbmV3IHRoaXMuQk9TSFNlc3Npb24oKTsKICAgICAgICAgICAgdmFyIGlkID0gYjY0X3NoYTEoJ2NvbnZlcnNlLmJvc2gtc2Vzc2lvbicpOwogICAgICAgICAgICB0aGlzLnNlc3Npb24uaWQgPSBpZDsgLy8gQXBwZWFycyB0byBiZSBuZWNlc3NhcnkgZm9yIGJhY2tib25lLmJyb3dzZXJTdG9yYWdlCiAgICAgICAgICAgIHRoaXMuc2Vzc2lvbi5icm93c2VyU3RvcmFnZSA9IG5ldyBCYWNrYm9uZS5Ccm93c2VyU3RvcmFnZVtjb252ZXJzZS5zdG9yYWdlXShpZCk7CiAgICAgICAgICAgIHRoaXMuc2Vzc2lvbi5mZXRjaCgpOwogICAgICAgICAgICAkKHdpbmRvdykub24oJ2JlZm9yZXVubG9hZCcsICQucHJveHkoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgaWYgKGNvbnZlcnNlLmNvbm5lY3Rpb24uY29ubmVjdGVkKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRTZXNzaW9uKCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRoaXMuY2xlYXJTZXNzaW9uKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIHRoaXMpKTsKICAgICAgICB9OwoKICAgICAgICB0aGlzLmNsZWFyU2Vzc2lvbiA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdGhpcy5yb3N0ZXIuYnJvd3NlclN0b3JhZ2UuX2NsZWFyKCk7CiAgICAgICAgICAgIHRoaXMuc2Vzc2lvbi5icm93c2VyU3RvcmFnZS5fY2xlYXIoKTsKICAgICAgICAgICAgLy8gWFhYOiB0aGlzIHNob3VsZCBwZXJoYXBzIGdvIGludG8gdGhlIGJlZm9yZXVubG9hZCBoYW5kbGVyCiAgICAgICAgICAgIGNvbnZlcnNlLmNoYXRib3hlcy5nZXQoJ2NvbnRyb2xib3gnKS5zYXZlKHsnY29ubmVjdGVkJzogZmFsc2V9KTsKICAgICAgICB9OwoKICAgICAgICB0aGlzLnNldFNlc3Npb24gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmtlZXBhbGl2ZSkgewogICAgICAgICAgICAgICAgdGhpcy5zZXNzaW9uLnNhdmUoewogICAgICAgICAgICAgICAgICAgIGppZDogdGhpcy5jb25uZWN0aW9uLmppZCwKICAgICAgICAgICAgICAgICAgICByaWQ6IHRoaXMuY29ubmVjdGlvbi5fcHJvdG8ucmlkLAogICAgICAgICAgICAgICAgICAgIHNpZDogdGhpcy5jb25uZWN0aW9uLl9wcm90by5zaWQKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgdGhpcy5sb2dPdXQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGNvbnZlcnNlLmNoYXRib3h2aWV3cy5jbG9zZUFsbENoYXRCb3hlcyhmYWxzZSk7CiAgICAgICAgICAgIGNvbnZlcnNlLmNsZWFyU2Vzc2lvbigpOwogICAgICAgICAgICBjb252ZXJzZS5jb25uZWN0aW9uLmRpc2Nvbm5lY3QoKTsKICAgICAgICAgICAgY29udmVyc2UuY29ubmVjdGlvbi5yZXNldCgpOwogICAgICAgIH07CgogICAgICAgIHRoaXMucmVnaXN0ZXJHbG9iYWxFdmVudEhhbmRsZXJzID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAkKGRvY3VtZW50KS5jbGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBpZiAoJCgnLnRvZ2dsZS1vdHIgdWwnKS5pcygnOnZpc2libGUnKSkgewogICAgICAgICAgICAgICAgICAgICQoJy50b2dnbGUtb3RyIHVsJywgdGhpcykuc2xpZGVVcCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKCQoJy50b2dnbGUtc21pbGV5IHVsJykuaXMoJzp2aXNpYmxlJykpIHsKICAgICAgICAgICAgICAgICAgICAkKCcudG9nZ2xlLXNtaWxleSB1bCcsIHRoaXMpLnNsaWRlVXAoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAkKGRvY3VtZW50KS5vbignbW91c2Vtb3ZlJywgJC5wcm94eShmdW5jdGlvbiAoZXYpIHsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5yZXNpemVkX2NoYXRib3ggfHwgIXRoaXMuYWxsb3dfZHJhZ3Jlc2l6ZSkgeyByZXR1cm4gdHJ1ZTsgfQogICAgICAgICAgICAgICAgZXYucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgIHRoaXMucmVzaXplZF9jaGF0Ym94LnJlc2l6ZUNoYXRCb3goZXYpOwogICAgICAgICAgICB9LCB0aGlzKSk7CgogICAgICAgICAgICAkKGRvY3VtZW50KS5vbignbW91c2V1cCcsICQucHJveHkoZnVuY3Rpb24gKGV2KSB7CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMucmVzaXplZF9jaGF0Ym94IHx8ICF0aGlzLmFsbG93X2RyYWdyZXNpemUpIHsgcmV0dXJuIHRydWU7IH0KICAgICAgICAgICAgICAgIGV2LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICB2YXIgaGVpZ2h0ID0gdGhpcy5hcHBseUhlaWdodFJlc2lzdGFuY2UodGhpcy5yZXNpemVkX2NoYXRib3guaGVpZ2h0KTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmNvbm5lY3Rpb24uY29ubmVjdGVkKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXNpemVkX2NoYXRib3gubW9kZWwuc2F2ZSh7J2hlaWdodCc6IGhlaWdodH0pOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnJlc2l6ZWRfY2hhdGJveC5tb2RlbC5zZXQoeydoZWlnaHQnOiBoZWlnaHR9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMucmVzaXplZF9jaGF0Ym94ID0gbnVsbDsKICAgICAgICAgICAgfSwgdGhpcykpOwoKICAgICAgICAgICAgJCh3aW5kb3cpLm9uKCJibHVyIGZvY3VzIiwgJC5wcm94eShmdW5jdGlvbiAoZXYpIHsKICAgICAgICAgICAgICAgIGlmICgodGhpcy53aW5kb3dTdGF0ZSAhPSBldi50eXBlKSAmJiAoZXYudHlwZSA9PSAnZm9jdXMnKSkgewogICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLmNsZWFyTXNnQ291bnRlcigpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy53aW5kb3dTdGF0ZSA9IGV2LnR5cGU7CiAgICAgICAgICAgIH0sdGhpcykpOwoKICAgICAgICAgICAgJCh3aW5kb3cpLm9uKCJyZXNpemUiLCBfLmRlYm91bmNlKCQucHJveHkoZnVuY3Rpb24gKGV2KSB7CiAgICAgICAgICAgICAgICB0aGlzLmNoYXRib3h2aWV3cy50cmltQ2hhdHMoKTsKICAgICAgICAgICAgfSx0aGlzKSwgMjAwKSk7CiAgICAgICAgfTsKCiAgICAgICAgdGhpcy5vblJlY29ubmVjdGVkID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAvLyBXZSBuZWVkIHRvIHJlLXJlZ2lzdGVyIGFsbCB0aGUgZXZlbnQgaGFuZGxlcnMgb24gdGhlIG5ld2x5CiAgICAgICAgICAgIC8vIGNyZWF0ZWQgY29ubmVjdGlvbi4KICAgICAgICAgICAgdGhpcy5pbml0U3RhdHVzKCQucHJveHkoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdGhpcy5yZWdpc3RlclJvc3RlclhIYW5kbGVyKCk7CiAgICAgICAgICAgICAgICB0aGlzLnJlZ2lzdGVyUHJlc2VuY2VIYW5kbGVyKCk7CiAgICAgICAgICAgICAgICB0aGlzLmNoYXRib3hlcy5yZWdpc3Rlck1lc3NhZ2VIYW5kbGVyKCk7CiAgICAgICAgICAgICAgICBjb252ZXJzZS54bXBwc3RhdHVzLnNlbmRQcmVzZW5jZSgpOwogICAgICAgICAgICAgICAgdGhpcy5naXZlRmVlZGJhY2soX18oJ09ubGluZSBDb250YWN0cycpKTsKICAgICAgICAgICAgfSwgdGhpcykpOwogICAgICAgIH07CgogICAgICAgIHRoaXMuZW5hYmxlQ2FyYm9ucyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgLyogQXNrIHRoZSBYTVBQIHNlcnZlciB0byBlbmFibGUgTWVzc2FnZSBDYXJib25zCiAgICAgICAgICAgICAqIFNlZSBYRVAtMDI4MCBodHRwczovL3htcHAub3JnL2V4dGVuc2lvbnMveGVwLTAyODAuaHRtbCNlbmFibGluZwogICAgICAgICAgICAgKi8KICAgICAgICAgICAgaWYgKCF0aGlzLm1lc3NhZ2VfY2FyYm9ucykgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBjYXJib25zX2lxID0gbmV3IFN0cm9waGUuQnVpbGRlcignaXEnLCB7CiAgICAgICAgICAgICAgICBmcm9tOiB0aGlzLmNvbm5lY3Rpb24uamlkLAogICAgICAgICAgICAgICAgaWQ6ICdlbmFibGVjYXJib25zJywKICAgICAgICAgICAgICAgIHR5cGU6ICdzZXQnCiAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAuYygnZW5hYmxlJywge3htbG5zOiAndXJuOnhtcHA6Y2FyYm9uczoyJ30pOwogICAgICAgICAgICB0aGlzLmNvbm5lY3Rpb24uc2VuZChjYXJib25zX2lxKTsKICAgICAgICAgICAgdGhpcy5jb25uZWN0aW9uLmFkZEhhbmRsZXIoZnVuY3Rpb24gKGlxKSB7CiAgICAgICAgICAgICAgICAvL1RPRE86IGNoZWNrIGlmIGNhcmJvbnMgd2FzIGVuYWJsZWQ6CiAgICAgICAgICAgIH0sIG51bGwsICJpcSIsIG51bGwsICJlbmFibGVjYXJib25zIik7CiAgICAgICAgfTsKCiAgICAgICAgdGhpcy5vbkNvbm5lY3RlZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuZGVidWcpIHsKICAgICAgICAgICAgICAgIHRoaXMuY29ubmVjdGlvbi54bWxJbnB1dCA9IGZ1bmN0aW9uIChib2R5KSB7IGNvbnNvbGUubG9nKGJvZHkpOyB9OwogICAgICAgICAgICAgICAgdGhpcy5jb25uZWN0aW9uLnhtbE91dHB1dCA9IGZ1bmN0aW9uIChib2R5KSB7IGNvbnNvbGUubG9nKGJvZHkpOyB9OwogICAgICAgICAgICAgICAgU3Ryb3BoZS5sb2cgPSBmdW5jdGlvbiAobGV2ZWwsIG1zZykgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGxldmVsKycgJyttc2cpOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIFN0cm9waGUuZXJyb3IgPSBmdW5jdGlvbiAobXNnKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0VSUk9SOiAnK21zZyk7CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIFdoZW4gcmVjb25uZWN0aW5nLCB0aGVyZSBtaWdodCBiZSBzb21lIG9wZW4gY2hhdCBib3hlcy4gV2UgZG9uJ3QKICAgICAgICAgICAgLy8ga25vdyB3aGV0aGVyIHRoZXNlIGJveGVzIGFyZSBvZiB0aGUgc2FtZSBhY2NvdW50IG9yIG5vdCwgc28gd2UKICAgICAgICAgICAgLy8gY2xvc2UgdGhlbSBub3cuCiAgICAgICAgICAgIHRoaXMuY2hhdGJveHZpZXdzLmNsb3NlQWxsQ2hhdEJveGVzKCk7CiAgICAgICAgICAgIHRoaXMuc2V0U2Vzc2lvbigpOwogICAgICAgICAgICB0aGlzLmppZCA9IHRoaXMuY29ubmVjdGlvbi5qaWQ7CiAgICAgICAgICAgIHRoaXMuYmFyZV9qaWQgPSBTdHJvcGhlLmdldEJhcmVKaWRGcm9tSmlkKHRoaXMuY29ubmVjdGlvbi5qaWQpOwogICAgICAgICAgICB0aGlzLmRvbWFpbiA9IFN0cm9waGUuZ2V0RG9tYWluRnJvbUppZCh0aGlzLmNvbm5lY3Rpb24uamlkKTsKICAgICAgICAgICAgdGhpcy5taW5pbWl6ZWRfY2hhdHMgPSBuZXcgY29udmVyc2UuTWluaW1pemVkQ2hhdHMoe21vZGVsOiB0aGlzLmNoYXRib3hlc30pOwogICAgICAgICAgICB0aGlzLmZlYXR1cmVzID0gbmV3IHRoaXMuRmVhdHVyZXMoKTsKICAgICAgICAgICAgdGhpcy5lbmFibGVDYXJib25zKCk7CiAgICAgICAgICAgIHRoaXMuaW5pdFN0YXR1cygkLnByb3h5KGZ1bmN0aW9uICgpIHsKCiAgICAgICAgICAgICAgICB0aGlzLmNoYXRib3hlcy5vbkNvbm5lY3RlZCgpOwogICAgICAgICAgICAgICAgdGhpcy5naXZlRmVlZGJhY2soX18oJ09ubGluZSBDb250YWN0cycpKTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmNhbGxiYWNrKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuY29ubmVjdGlvbi5zZXJ2aWNlID09PSAnamFzbWluZSB0ZXN0cycpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gWFhYOiBDYWxsIGJhY2sgd2l0aCB0aGUgaW50ZXJuYWwgY29udmVyc2Ugb2JqZWN0LiBUaGlzCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIG9iamVjdCBzaG91bGQgbmV2ZXIgYmUgZXhwb3NlZCB0byBwcm9kdWN0aW9uIHN5c3RlbXMuCiAgICAgICAgICAgICAgICAgICAgICAgIC8vICdqYXNtaW5lIHRlc3RzJyBpcyBhbiBpbnZhbGlkIGh0dHAgYmluZCBzZXJ2aWNlIHZhbHVlLAogICAgICAgICAgICAgICAgICAgICAgICAvLyBzbyB3ZSdyZSBzdXJlIHRoYXQgdGhpcyBpcyBqdXN0IGZvciB0ZXN0cy4KICAgICAgICAgICAgICAgICAgICAgICAgLy8KICAgICAgICAgICAgICAgICAgICAgICAgLy8gVE9ETzogV2UgbWlnaHQgbmVlZCB0byBjb25zaWRlciB3ZWJzb2NrZXRzLCB3aGljaAogICAgICAgICAgICAgICAgICAgICAgICAvLyBwcm9iYWJseSB3b24ndCB1c2UgdGhlICdzZXJ2aWNlJyBhdHRyLiBDdXJyZW50CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHN0cm9waGUuanMgdmVyc2lvbiB1c2VkIGJ5IGNvbnZlcnNlLmpzIGRvZXNuJ3Qgc3VwcG9ydAogICAgICAgICAgICAgICAgICAgICAgICAvLyB3ZWJzb2NrZXRzLgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNhbGxiYWNrKHRoaXMpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSAgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNhbGxiYWNrKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCB0aGlzKSk7CiAgICAgICAgICAgIGNvbnZlcnNlLmVtaXQoJ3JlYWR5Jyk7CiAgICAgICAgfTsKCiAgICAgICAgLy8gQmFja2JvbmUgTW9kZWxzIGFuZCBWaWV3cwogICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAgICB0aGlzLk9UUiA9IEJhY2tib25lLk1vZGVsLmV4dGVuZCh7CiAgICAgICAgICAgIC8vIEEgbW9kZWwgZm9yIG1hbmFnaW5nIE9UUiBzZXR0aW5ncy4KICAgICAgICAgICAgZ2V0U2Vzc2lvblBhc3NwaHJhc2U6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGlmIChjb252ZXJzZS5wcmViaW5kKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGtleSA9IGI2NF9zaGExKGNvbnZlcnNlLmNvbm5lY3Rpb24uamlkKSwKICAgICAgICAgICAgICAgICAgICAgICAgcGFzcyA9IHdpbmRvdy5zZXNzaW9uU3RvcmFnZVtrZXldOwogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgcGFzcyA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcGFzcyA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSo0Mjk0OTY3Mjk1KS50b1N0cmluZygpOwogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuc2Vzc2lvblN0b3JhZ2Vba2V5XSA9IHBhc3M7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiBwYXNzOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29udmVyc2UuY29ubmVjdGlvbi5wYXNzOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgZ2VuZXJhdGVQcml2YXRlS2V5OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB2YXIga2V5ID0gbmV3IERTQSgpOwogICAgICAgICAgICAgICAgdmFyIGppZCA9IGNvbnZlcnNlLmNvbm5lY3Rpb24uamlkOwogICAgICAgICAgICAgICAgaWYgKGNvbnZlcnNlLmNhY2hlX290cl9rZXkpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgY2lwaGVyID0gQ3J5cHRvSlMubGliLlBhc3N3b3JkQmFzZWRDaXBoZXI7CiAgICAgICAgICAgICAgICAgICAgdmFyIHBhc3MgPSB0aGlzLmdldFNlc3Npb25QYXNzcGhyYXNlKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBwYXNzICE9PSAidW5kZWZpbmVkIikgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBFbmNyeXB0IHRoZSBrZXkgYW5kIHNldCBpbiBzZXNzaW9uU3RvcmFnZS4gQWxzbyBzdG9yZSBpbnN0YW5jZSB0YWcuCiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5zZXNzaW9uU3RvcmFnZVtiNjRfc2hhMShqaWQrJ3ByaXZfa2V5JyldID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNpcGhlci5lbmNyeXB0KENyeXB0b0pTLmFsZ28uQUVTLCBrZXkucGFja1ByaXZhdGUoKSwgcGFzcykudG9TdHJpbmcoKTsKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LnNlc3Npb25TdG9yYWdlW2I2NF9zaGExKGppZCsnaW5zdGFuY2VfdGFnJyldID0gaW5zdGFuY2VfdGFnOwogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuc2Vzc2lvblN0b3JhZ2VbYjY0X3NoYTEoamlkKydwYXNzX2NoZWNrJyldID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNpcGhlci5lbmNyeXB0KENyeXB0b0pTLmFsZ28uQUVTLCAnbWF0Y2gnLCBwYXNzKS50b1N0cmluZygpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBrZXk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgdGhpcy5NZXNzYWdlID0gQmFja2JvbmUuTW9kZWw7CiAgICAgICAgdGhpcy5NZXNzYWdlcyA9IEJhY2tib25lLkNvbGxlY3Rpb24uZXh0ZW5kKHsKICAgICAgICAgICAgbW9kZWw6IGNvbnZlcnNlLk1lc3NhZ2UKICAgICAgICB9KTsKCiAgICAgICAgdGhpcy5DaGF0Qm94ID0gQmFja2JvbmUuTW9kZWwuZXh0ZW5kKHsKICAgICAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIGhlaWdodCA9IGNvbnZlcnNlLmFwcGx5SGVpZ2h0UmVzaXN0YW5jZSh0aGlzLmdldCgnaGVpZ2h0JykpOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuZ2V0KCdib3hfaWQnKSAhPT0gJ2NvbnRyb2xib3gnKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5tZXNzYWdlcyA9IG5ldyBjb252ZXJzZS5NZXNzYWdlcygpOwogICAgICAgICAgICAgICAgICAgIHRoaXMubWVzc2FnZXMuYnJvd3NlclN0b3JhZ2UgPSBuZXcgQmFja2JvbmUuQnJvd3NlclN0b3JhZ2VbY29udmVyc2Uuc3RvcmFnZV0oCiAgICAgICAgICAgICAgICAgICAgICAgIGI2NF9zaGExKCdjb252ZXJzZS5tZXNzYWdlcycrdGhpcy5nZXQoJ2ppZCcpK2NvbnZlcnNlLmJhcmVfamlkKSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zYXZlKHsKICAgICAgICAgICAgICAgICAgICAgICAgJ2JveF9pZCcgOiBiNjRfc2hhMSh0aGlzLmdldCgnamlkJykpLAogICAgICAgICAgICAgICAgICAgICAgICAnaGVpZ2h0JzogaGVpZ2h0LAogICAgICAgICAgICAgICAgICAgICAgICAnbWluaW1pemVkJzogdGhpcy5nZXQoJ21pbmltaXplZCcpIHx8IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAnb3RyX3N0YXR1cyc6IHRoaXMuZ2V0KCdvdHJfc3RhdHVzJykgfHwgVU5FTkNSWVBURUQsCiAgICAgICAgICAgICAgICAgICAgICAgICd0aW1lX21pbmltaXplZCc6IHRoaXMuZ2V0KCd0aW1lX21pbmltaXplZCcpIHx8IG1vbWVudCgpLAogICAgICAgICAgICAgICAgICAgICAgICAndGltZV9vcGVuZWQnOiB0aGlzLmdldCgndGltZV9vcGVuZWQnKSB8fCBtb21lbnQoKS52YWx1ZU9mKCksCiAgICAgICAgICAgICAgICAgICAgICAgICd1c2VyX2lkJyA6IFN0cm9waGUuZ2V0Tm9kZUZyb21KaWQodGhpcy5nZXQoJ2ppZCcpKSwKICAgICAgICAgICAgICAgICAgICAgICAgJ251bV91bnJlYWQnOiB0aGlzLmdldCgnbnVtX3VucmVhZCcpIHx8IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICd1cmwnOiAnJwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNldCh7CiAgICAgICAgICAgICAgICAgICAgICAgICdoZWlnaHQnOiBoZWlnaHQsCiAgICAgICAgICAgICAgICAgICAgICAgICd0aW1lX29wZW5lZCc6IG1vbWVudCgwKS52YWx1ZU9mKCksCiAgICAgICAgICAgICAgICAgICAgICAgICdudW1fdW5yZWFkJzogdGhpcy5nZXQoJ251bV91bnJlYWQnKSB8fCAwCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBtYXhpbWl6ZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdGhpcy5zYXZlKHsKICAgICAgICAgICAgICAgICAgICAnbWluaW1pemVkJzogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgJ3RpbWVfb3BlbmVkJzogbW9tZW50KCkudmFsdWVPZigpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIG1pbmltaXplOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB0aGlzLnNhdmUoewogICAgICAgICAgICAgICAgICAgICdtaW5pbWl6ZWQnOiB0cnVlLAogICAgICAgICAgICAgICAgICAgICd0aW1lX21pbmltaXplZCc6IG1vbWVudCgpLmZvcm1hdCgpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGdldFNlc3Npb246IGZ1bmN0aW9uIChjYWxsYmFjaykgewogICAgICAgICAgICAgICAgdmFyIGNpcGhlciA9IENyeXB0b0pTLmxpYi5QYXNzd29yZEJhc2VkQ2lwaGVyOwogICAgICAgICAgICAgICAgdmFyIHJlc3VsdCwgcGFzcywgaW5zdGFuY2VfdGFnLCBzYXZlZF9rZXksIHBhc3NfY2hlY2s7CiAgICAgICAgICAgICAgICBpZiAoY29udmVyc2UuY2FjaGVfb3RyX2tleSkgewogICAgICAgICAgICAgICAgICAgIHBhc3MgPSBjb252ZXJzZS5vdHIuZ2V0U2Vzc2lvblBhc3NwaHJhc2UoKTsKICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHBhc3MgIT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGluc3RhbmNlX3RhZyA9IHdpbmRvdy5zZXNzaW9uU3RvcmFnZVtiNjRfc2hhMSh0aGlzLmlkKydpbnN0YW5jZV90YWcnKV07CiAgICAgICAgICAgICAgICAgICAgICAgIHNhdmVkX2tleSA9IHdpbmRvdy5zZXNzaW9uU3RvcmFnZVtiNjRfc2hhMSh0aGlzLmlkKydwcml2X2tleScpXTsKICAgICAgICAgICAgICAgICAgICAgICAgcGFzc19jaGVjayA9IHdpbmRvdy5zZXNzaW9uU3RvcmFnZVtiNjRfc2hhMSh0aGlzLmNvbm5lY3Rpb24uamlkKydwYXNzX2NoZWNrJyldOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2F2ZWRfa2V5ICYmIGluc3RhbmNlX3RhZyAmJiB0eXBlb2YgcGFzc19jaGVjayAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkZWNyeXB0ZWQgPSBjaXBoZXIuZGVjcnlwdChDcnlwdG9KUy5hbGdvLkFFUywgc2F2ZWRfa2V5LCBwYXNzKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBrZXkgPSBEU0EucGFyc2VQcml2YXRlKGRlY3J5cHRlZC50b1N0cmluZyhDcnlwdG9KUy5lbmMuTGF0aW4xKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2lwaGVyLmRlY3J5cHQoQ3J5cHRvSlMuYWxnby5BRVMsIHBhc3NfY2hlY2ssIHBhc3MpLnRvU3RyaW5nKENyeXB0b0pTLmVuYy5MYXRpbjEpID09PSAnbWF0Y2gnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVmVyaWZpZWQgdGhhdCB0aGUgcGFzc3BocmFzZSBpcyBzdGlsbCB0aGUgc2FtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJpZ2dlcignc2hvd0hlbHBNZXNzYWdlcycsIFtfXygnUmUtZXN0YWJsaXNoaW5nIGVuY3J5cHRlZCBzZXNzaW9uJyldKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdrZXknOiBrZXksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdpbnN0YW5jZV90YWcnOiBpbnN0YW5jZV90YWcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47IC8vIE91ciB3b3JrIGlzIGRvbmUgaGVyZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy8gV2UgbmVlZCB0byBnZW5lcmF0ZSBhIG5ldyBrZXkgYW5kIGluc3RhbmNlIHRhZwogICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCdzaG93SGVscE1lc3NhZ2VzJywgWwogICAgICAgICAgICAgICAgICAgIF9fKCdHZW5lcmF0aW5nIHByaXZhdGUga2V5LicpLAogICAgICAgICAgICAgICAgICAgIF9fKCdZb3VyIGJyb3dzZXIgbWlnaHQgYmVjb21lIHVucmVzcG9uc2l2ZS4nKV0sCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICB0cnVlIC8vIHNob3cgc3Bpbm5lcgogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKHsKICAgICAgICAgICAgICAgICAgICAgICAgJ2tleSc6IGNvbnZlcnNlLm90ci5nZW5lcmF0ZVByaXZhdGVLZXkuYXBwbHkodGhpcyksCiAgICAgICAgICAgICAgICAgICAgICAgICdpbnN0YW5jZV90YWcnOiBPVFIubWFrZUluc3RhbmNlVGFnKCkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0sIDUwMCk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICB1cGRhdGVPVFJTdGF0dXM6IGZ1bmN0aW9uIChzdGF0ZSkgewogICAgICAgICAgICAgICAgc3dpdGNoIChzdGF0ZSkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgT1RSLkNPTlNULlNUQVRVU19BS0VfU1VDQ0VTUzoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMub3RyLm1zZ3N0YXRlID09PSBPVFIuQ09OU1QuTVNHU1RBVEVfRU5DUllQVEVEKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNhdmUoeydvdHJfc3RhdHVzJzogVU5WRVJJRklFRH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgT1RSLkNPTlNULlNUQVRVU19FTkRfT1RSOgogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5vdHIubXNnc3RhdGUgPT09IE9UUi5DT05TVC5NU0dTVEFURV9GSU5JU0hFRCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zYXZlKHsnb3RyX3N0YXR1cyc6IEZJTklTSEVEfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5vdHIubXNnc3RhdGUgPT09IE9UUi5DT05TVC5NU0dTVEFURV9QTEFJTlRFWFQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2F2ZSh7J290cl9zdGF0dXMnOiBVTkVOQ1JZUFRFRH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgb25TTVA6IGZ1bmN0aW9uICh0eXBlLCBkYXRhKSB7CiAgICAgICAgICAgICAgICAvLyBFdmVudCBoYW5kbGVyIGZvciBTTVAgKFNvY2lhbGlzdCdzIE1pbGxpb25haXJlIFByb3RvY29sKQogICAgICAgICAgICAgICAgLy8gdXNlZCBieSBPVFIgKG9mZi10aGUtcmVjb3JkKS4KICAgICAgICAgICAgICAgIHN3aXRjaCAodHlwZSkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgJ3F1ZXN0aW9uJzoKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vdHIuc21wU2VjcmV0KHByb21wdChfXygKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdBdXRoZW50aWNhdGlvbiByZXF1ZXN0IGZyb20gJTEkc1xuXG5Zb3VyIGJ1ZGR5IGlzIGF0dGVtcHRpbmcgdG8gdmVyaWZ5IHlvdXIgaWRlbnRpdHksIGJ5IGFza2luZyB5b3UgdGhlIHF1ZXN0aW9uIGJlbG93LlxuXG4lMiRzJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFt0aGlzLmdldCgnZnVsbG5hbWUnKSwgZGF0YV0pKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgJ3RydXN0JzoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEgPT09IHRydWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2F2ZSh7J290cl9zdGF0dXMnOiBWRVJJRklFRH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzaG93SGVscE1lc3NhZ2VzJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbX18oIkNvdWxkIG5vdCB2ZXJpZnkgdGhpcyB1c2VyJ3MgaWRlbnRpZnkuIildLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdlcnJvcicpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zYXZlKHsnb3RyX3N0YXR1cyc6IFVOVkVSSUZJRUR9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Vua25vd24gdHlwZS4nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGluaXRpYXRlT1RSOiBmdW5jdGlvbiAocXVlcnlfbXNnKSB7CiAgICAgICAgICAgICAgICAvLyBTZXRzIHVwIGFuIE9UUiBvYmplY3QgdGhyb3VnaCB3aGljaCB3ZSBjYW4gc2VuZCBhbmQgcmVjZWl2ZQogICAgICAgICAgICAgICAgLy8gZW5jcnlwdGVkIG1lc3NhZ2VzLgogICAgICAgICAgICAgICAgLy8KICAgICAgICAgICAgICAgIC8vIElmICdxdWVyeV9tc2cnIGlzIHBhc3NlZCBpbiwgaXQgbWVhbnMgdGhlcmUgaXMgYW4gYWxyZWFkIGluY29taW5nCiAgICAgICAgICAgICAgICAvLyBxdWVyeSBtZXNzYWdlIGZyb20gb3VyIGJ1ZGR5LiBPdGhlcndpc2UsIGl0IGlzIHVzIHdobyB3aWxsCiAgICAgICAgICAgICAgICAvLyBzZW5kIHRoZSBxdWVyeSBtZXNzYWdlIHRvIHRoZW0uCiAgICAgICAgICAgICAgICB0aGlzLnNhdmUoeydvdHJfc3RhdHVzJzogVU5FTkNSWVBURUR9KTsKICAgICAgICAgICAgICAgIHZhciBzZXNzaW9uID0gdGhpcy5nZXRTZXNzaW9uKCQucHJveHkoZnVuY3Rpb24gKHNlc3Npb24pIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLm90ciA9IG5ldyBPVFIoewogICAgICAgICAgICAgICAgICAgICAgICBmcmFnbWVudF9zaXplOiAxNDAsCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRfaW50ZXJ2YWw6IDIwMCwKICAgICAgICAgICAgICAgICAgICAgICAgcHJpdjogc2Vzc2lvbi5rZXksCiAgICAgICAgICAgICAgICAgICAgICAgIGluc3RhbmNlX3RhZzogc2Vzc2lvbi5pbnN0YW5jZV90YWcsCiAgICAgICAgICAgICAgICAgICAgICAgIGRlYnVnOiB0aGlzLmRlYnVnCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5vdHIub24oJ3N0YXR1cycsICQucHJveHkodGhpcy51cGRhdGVPVFJTdGF0dXMsIHRoaXMpKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLm90ci5vbignc21wJywgJC5wcm94eSh0aGlzLm9uU01QLCB0aGlzKSk7CgogICAgICAgICAgICAgICAgICAgIHRoaXMub3RyLm9uKCd1aScsICQucHJveHkoZnVuY3Rpb24gKG1zZykgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXIoJ3Nob3dSZWNlaXZlZE9UUk1lc3NhZ2UnLCBtc2cpOwogICAgICAgICAgICAgICAgICAgIH0sIHRoaXMpKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLm90ci5vbignaW8nLCAkLnByb3h5KGZ1bmN0aW9uIChtc2cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCdzZW5kTWVzc2FnZVN0YW56YScsIG1zZyk7CiAgICAgICAgICAgICAgICAgICAgfSwgdGhpcykpOwogICAgICAgICAgICAgICAgICAgIHRoaXMub3RyLm9uKCdlcnJvcicsICQucHJveHkoZnVuY3Rpb24gKG1zZykgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXIoJ3Nob3dPVFJFcnJvcicsIG1zZyk7CiAgICAgICAgICAgICAgICAgICAgfSwgdGhpcykpOwoKICAgICAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXIoJ3Nob3dIZWxwTWVzc2FnZXMnLCBbX18oJ0V4Y2hhbmdpbmcgcHJpdmF0ZSBrZXkgd2l0aCBidWRkeS4nKV0pOwogICAgICAgICAgICAgICAgICAgIGlmIChxdWVyeV9tc2cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vdHIucmVjZWl2ZU1zZyhxdWVyeV9tc2cpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub3RyLnNlbmRRdWVyeU1zZygpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sIHRoaXMpKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGVuZE9UUjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMub3RyKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5vdHIuZW5kT3RyKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLnNhdmUoeydvdHJfc3RhdHVzJzogVU5FTkNSWVBURUR9KTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGNyZWF0ZU1lc3NhZ2U6IGZ1bmN0aW9uICgkbWVzc2FnZSkgewogICAgICAgICAgICAgICAgdmFyIGJvZHkgPSAkbWVzc2FnZS5jaGlsZHJlbignYm9keScpLnRleHQoKSwKICAgICAgICAgICAgICAgICAgICBjb21wb3NpbmcgPSAkbWVzc2FnZS5maW5kKCdjb21wb3NpbmcnKSwKICAgICAgICAgICAgICAgICAgICBwYXVzZWQgPSAkbWVzc2FnZS5maW5kKCdwYXVzZWQnKSwKICAgICAgICAgICAgICAgICAgICBkZWxheWVkID0gJG1lc3NhZ2UuZmluZCgnZGVsYXknKS5sZW5ndGggPiAwLAogICAgICAgICAgICAgICAgICAgIGZ1bGxuYW1lID0gdGhpcy5nZXQoJ2Z1bGxuYW1lJyksCiAgICAgICAgICAgICAgICAgICAgaXNfZ3JvdXBjaGF0ID0gJG1lc3NhZ2UuYXR0cigndHlwZScpID09PSAnZ3JvdXBjaGF0JywKICAgICAgICAgICAgICAgICAgICBtc2dpZCA9ICRtZXNzYWdlLmF0dHIoJ2lkJyksCiAgICAgICAgICAgICAgICAgICAgc3RhbXAsIHRpbWUsIHNlbmRlciwgZnJvbTsKCiAgICAgICAgICAgICAgICBpZiAoaXNfZ3JvdXBjaGF0KSB7CiAgICAgICAgICAgICAgICAgICAgZnJvbSA9IFN0cm9waGUudW5lc2NhcGVOb2RlKFN0cm9waGUuZ2V0UmVzb3VyY2VGcm9tSmlkKCRtZXNzYWdlLmF0dHIoJ2Zyb20nKSkpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBmcm9tID0gU3Ryb3BoZS5nZXRCYXJlSmlkRnJvbUppZCgkbWVzc2FnZS5hdHRyKCdmcm9tJykpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZnVsbG5hbWUgPSAoXy5pc0VtcHR5KGZ1bGxuYW1lKT8gZnJvbTogZnVsbG5hbWUpLnNwbGl0KCcgJylbMF07CgogICAgICAgICAgICAgICAgaWYgKCFib2R5KSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbXBvc2luZy5sZW5ndGggfHwgcGF1c2VkLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBGSVhNRTogdXNlIG9uZSBhdHRyaWJ1dGUgZm9yIGNoYXQgc3RhdGVzIChlLmcuCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNoYXRzdGF0ZSkgaW5zdGVhZCBvZiBzYXZpbmcgJ3BhdXNlZCcgYW5kCiAgICAgICAgICAgICAgICAgICAgICAgIC8vICdjb21wb3NpbmcnIHNlcGFyYXRlbHkuCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubWVzc2FnZXMuYWRkKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGxuYW1lOiBmdWxsbmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRlcjogJ3RoZW0nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsYXllZDogZGVsYXllZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWU6IG1vbWVudCgpLmZvcm1hdCgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tcG9zaW5nOiBjb21wb3NpbmcubGVuZ3RoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF1c2VkOiBwYXVzZWQubGVuZ3RoCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGRlbGF5ZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3RhbXAgPSAkbWVzc2FnZS5maW5kKCdkZWxheScpLmF0dHIoJ3N0YW1wJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWUgPSBzdGFtcDsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB0aW1lID0gbW9tZW50KCkuZm9ybWF0KCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICgoaXNfZ3JvdXBjaGF0ICYmIGZyb20gPT09IHRoaXMuZ2V0KCduaWNrJykpIHx8ICghaXNfZ3JvdXBjaGF0ICYmIGZyb20gPT0gY29udmVyc2UuYmFyZV9qaWQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRlciA9ICdtZSc7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2VuZGVyID0gJ3RoZW0nOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB0aGlzLm1lc3NhZ2VzLmNyZWF0ZSh7CiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGxuYW1lOiBmdWxsbmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgc2VuZGVyOiBzZW5kZXIsCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGF5ZWQ6IGRlbGF5ZWQsCiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWU6IHRpbWUsCiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGJvZHksCiAgICAgICAgICAgICAgICAgICAgICAgIG1zZ2lkOiBtc2dpZAogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgcmVjZWl2ZU1lc3NhZ2U6IGZ1bmN0aW9uICgkbWVzc2FnZSkgewogICAgICAgICAgICAgICAgdmFyICRib2R5ID0gJG1lc3NhZ2UuY2hpbGRyZW4oJ2JvZHknKTsKICAgICAgICAgICAgICAgIHZhciB0ZXh0ID0gKCRib2R5Lmxlbmd0aCA+IDAgPyAkYm9keS50ZXh0KCkgOiB1bmRlZmluZWQpOwogICAgICAgICAgICAgICAgaWYgKCghdGV4dCkgfHwgKCFjb252ZXJzZS5hbGxvd19vdHIpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlTWVzc2FnZSgkbWVzc2FnZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodGV4dC5tYXRjaCgvXlw/T1RSdjIzPy8pKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbml0aWF0ZU9UUih0ZXh0KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKF8uY29udGFpbnMoW1VOVkVSSUZJRUQsIFZFUklGSUVEXSwgdGhpcy5nZXQoJ290cl9zdGF0dXMnKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vdHIucmVjZWl2ZU1zZyh0ZXh0KTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGV4dC5tYXRjaCgvXlw/T1RSLykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5vdHIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmluaXRpYXRlT1RSKHRleHQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm90ci5yZWNlaXZlTXNnKHRleHQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gTm9ybWFsIHVuZW5jcnlwdGVkIG1lc3NhZ2UuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNyZWF0ZU1lc3NhZ2UoJG1lc3NhZ2UpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIHRoaXMuQ2hhdEJveFZpZXcgPSBCYWNrYm9uZS5WaWV3LmV4dGVuZCh7CiAgICAgICAgICAgIGxlbmd0aDogMjAwLAogICAgICAgICAgICB0YWdOYW1lOiAnZGl2JywKICAgICAgICAgICAgY2xhc3NOYW1lOiAnY2hhdGJveCcsCiAgICAgICAgICAgIGlzX2NoYXRyb29tOiBmYWxzZSwgIC8vIFRoaXMgaXMgbm90IGEgbXVsdGktdXNlciBjaGF0cm9vbQoKICAgICAgICAgICAgZXZlbnRzOiB7CiAgICAgICAgICAgICAgICAnY2xpY2sgLmNsb3NlLWNoYXRib3gtYnV0dG9uJzogJ2Nsb3NlJywKICAgICAgICAgICAgICAgICdjbGljayAudG9nZ2xlLWNoYXRib3gtYnV0dG9uJzogJ21pbmltaXplJywKICAgICAgICAgICAgICAgICdrZXlwcmVzcyB0ZXh0YXJlYS5jaGF0LXRleHRhcmVhJzogJ2tleVByZXNzZWQnLAogICAgICAgICAgICAgICAgJ2NsaWNrIC50b2dnbGUtc21pbGV5JzogJ3RvZ2dsZUVtb3RpY29uTWVudScsCiAgICAgICAgICAgICAgICAnY2xpY2sgLnRvZ2dsZS1zbWlsZXkgdWwgbGknOiAnaW5zZXJ0RW1vdGljb24nLAogICAgICAgICAgICAgICAgJ2NsaWNrIC50b2dnbGUtY2xlYXInOiAnY2xlYXJNZXNzYWdlcycsCiAgICAgICAgICAgICAgICAnY2xpY2sgLnRvZ2dsZS1vdHInOiAndG9nZ2xlT1RSTWVudScsCiAgICAgICAgICAgICAgICAnY2xpY2sgLnN0YXJ0LW90cic6ICdzdGFydE9UUkZyb21Ub29sYmFyJywKICAgICAgICAgICAgICAgICdjbGljayAuZW5kLW90cic6ICdlbmRPVFInLAogICAgICAgICAgICAgICAgJ2NsaWNrIC5hdXRoLW90cic6ICdhdXRoT1RSJywKICAgICAgICAgICAgICAgICdjbGljayAudG9nZ2xlLWNhbGwnOiAndG9nZ2xlQ2FsbCcsCiAgICAgICAgICAgICAgICAnbW91c2Vkb3duIC5kcmFncmVzaXplLXRtJzogJ29uRHJhZ1Jlc2l6ZVN0YXJ0JwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKCl7CiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLm1lc3NhZ2VzLm9uKCdhZGQnLCB0aGlzLm9uTWVzc2FnZUFkZGVkLCB0aGlzKTsKICAgICAgICAgICAgICAgIHRoaXMubW9kZWwub24oJ3Nob3cnLCB0aGlzLnNob3csIHRoaXMpOwogICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5vbignZGVzdHJveScsIHRoaXMuaGlkZSwgdGhpcyk7CiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLm9uKCdjaGFuZ2UnLCB0aGlzLm9uQ2hhbmdlLCB0aGlzKTsKICAgICAgICAgICAgICAgIHRoaXMubW9kZWwub24oJ3Nob3dPVFJFcnJvcicsIHRoaXMuc2hvd09UUkVycm9yLCB0aGlzKTsKICAgICAgICAgICAgICAgIHRoaXMubW9kZWwub24oJ2J1ZGR5U3RhcnRzT1RSJywgdGhpcy5idWRkeVN0YXJ0c09UUiwgdGhpcyk7CiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLm9uKCdzaG93SGVscE1lc3NhZ2VzJywgdGhpcy5zaG93SGVscE1lc3NhZ2VzLCB0aGlzKTsKICAgICAgICAgICAgICAgIHRoaXMubW9kZWwub24oJ3NlbmRNZXNzYWdlU3RhbnphJywgdGhpcy5zZW5kTWVzc2FnZVN0YW56YSwgdGhpcyk7CiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLm9uKCdzaG93U2VudE9UUk1lc3NhZ2UnLCBmdW5jdGlvbiAodGV4dCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd01lc3NhZ2UoeydtZXNzYWdlJzogdGV4dCwgJ3NlbmRlcic6ICdtZSd9KTsKICAgICAgICAgICAgICAgIH0sIHRoaXMpOwogICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5vbignc2hvd1JlY2VpdmVkT1RSTWVzc2FnZScsIGZ1bmN0aW9uICh0ZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93TWVzc2FnZSh7J21lc3NhZ2UnOiB0ZXh0LCAnc2VuZGVyJzogJ3RoZW0nfSk7CiAgICAgICAgICAgICAgICB9LCB0aGlzKTsKCiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVZDYXJkKCk7CiAgICAgICAgICAgICAgICB0aGlzLiRlbC5pbnNlcnRBZnRlcihjb252ZXJzZS5jaGF0Ym94dmlld3MuZ2V0KCJjb250cm9sYm94IikuJGVsKTsKICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyKCkubW9kZWwubWVzc2FnZXMuZmV0Y2goe2FkZDogdHJ1ZX0pOwogICAgICAgICAgICAgICAgaWYgKHRoaXMubW9kZWwuZ2V0KCdtaW5pbWl6ZWQnKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuaGlkZSgpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3coKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICgoXy5jb250YWlucyhbVU5WRVJJRklFRCwgVkVSSUZJRURdLCB0aGlzLm1vZGVsLmdldCgnb3RyX3N0YXR1cycpKSkgfHwgY29udmVyc2UudXNlX290cl9ieV9kZWZhdWx0KSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5pbml0aWF0ZU9UUigpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRlbC5hdHRyKCdpZCcsIHRoaXMubW9kZWwuZ2V0KCdib3hfaWQnKSkKICAgICAgICAgICAgICAgICAgICAuaHRtbChjb252ZXJzZS50ZW1wbGF0ZXMuY2hhdGJveCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF8uZXh0ZW5kKHRoaXMubW9kZWwudG9KU09OKCksIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvd190b29sYmFyOiBjb252ZXJzZS5zaG93X3Rvb2xiYXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsX3BlcnNvbmFsX21lc3NhZ2U6IF9fKCdQZXJzb25hbCBtZXNzYWdlJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJUb29sYmFyKCkucmVuZGVyQXZhdGFyKCk7CiAgICAgICAgICAgICAgICBjb252ZXJzZS5lbWl0KCdjaGF0Qm94T3BlbmVkJywgdGhpcyk7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS5yZWZyZXNoV2Via2l0KCk7CiAgICAgICAgICAgICAgICB9LCA1MCk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zaG93U3RhdHVzTWVzc2FnZSgpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgaW5pdERyYWdSZXNpemU6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHRoaXMucHJldl9wYWdlWSA9IDA7IC8vIFRvIHN0b3JlIGxhc3Qga25vd24gbW91c2UgcG9zaXRpb24KICAgICAgICAgICAgICAgIGlmIChjb252ZXJzZS5jb25uZWN0aW9uLmNvbm5lY3RlZCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuaGVpZ2h0ID0gdGhpcy5tb2RlbC5nZXQoJ2hlaWdodCcpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBzaG93U3RhdHVzTm90aWZpY2F0aW9uOiBmdW5jdGlvbiAobWVzc2FnZSwga2VlcF9vbGQpIHsKICAgICAgICAgICAgICAgIHZhciAkY2hhdF9jb250ZW50ID0gdGhpcy4kZWwuZmluZCgnLmNoYXQtY29udGVudCcpOwogICAgICAgICAgICAgICAgaWYgKCFrZWVwX29sZCkgewogICAgICAgICAgICAgICAgICAgICRjaGF0X2NvbnRlbnQuZmluZCgnZGl2LmNoYXQtZXZlbnQnKS5yZW1vdmUoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRjaGF0X2NvbnRlbnQuYXBwZW5kKCQoJzxkaXYgY2xhc3M9ImNoYXQtZXZlbnQiPjwvZGl2PicpLnRleHQobWVzc2FnZSkpOwogICAgICAgICAgICAgICAgdGhpcy5zY3JvbGxEb3duKCk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBjbGVhckNoYXRSb29tTWVzc2FnZXM6IGZ1bmN0aW9uIChldikgewogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBldiAhPT0gInVuZGVmaW5lZCIpIHsgZXYuc3RvcFByb3BhZ2F0aW9uKCk7IH0KICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSBjb25maXJtKF9fKCJBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gY2xlYXIgdGhlIG1lc3NhZ2VzIGZyb20gdGhpcyByb29tPyIpKTsKICAgICAgICAgICAgICAgIGlmIChyZXN1bHQgPT09IHRydWUpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbC5maW5kKCcuY2hhdC1jb250ZW50JykuZW1wdHkoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgc2hvd01lc3NhZ2U6IGZ1bmN0aW9uIChtc2dfZGljdCkgewogICAgICAgICAgICAgICAgdmFyICRjb250ZW50ID0gdGhpcy4kZWwuZmluZCgnLmNoYXQtY29udGVudCcpLAogICAgICAgICAgICAgICAgICAgIG1zZ190aW1lID0gbW9tZW50KG1zZ19kaWN0LnRpbWUpIHx8IG1vbWVudCwKICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gbXNnX2RpY3QubWVzc2FnZSwKICAgICAgICAgICAgICAgICAgICBtYXRjaCA9IHRleHQubWF0Y2goL15cLyguKj8pKD86ICguKikpPyQvKSwKICAgICAgICAgICAgICAgICAgICBmdWxsbmFtZSA9IG1zZ19kaWN0LmZ1bGxuYW1lIHx8IHRoaXMubW9kZWwuZ2V0KCdmdWxsbmFtZScpLCAvLyBYWFggUGVyaGFwcyBhbHdheXMgdXNlIG1vZGVsJ3M/CiAgICAgICAgICAgICAgICAgICAgZXh0cmFfY2xhc3NlcyA9IG1zZ19kaWN0LmRlbGF5ZWQgJiYgJ2RlbGF5ZWQnIHx8ICcnLAogICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlLCB1c2VybmFtZTsKCiAgICAgICAgICAgICAgICBpZiAoKG1hdGNoKSAmJiAobWF0Y2hbMV0gPT09ICdtZScpKSB7CiAgICAgICAgICAgICAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZSgvXlwvbWUvLCAnJyk7CiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGUgPSBjb252ZXJzZS50ZW1wbGF0ZXMuYWN0aW9uOwogICAgICAgICAgICAgICAgICAgIHVzZXJuYW1lID0gZnVsbG5hbWU7CiAgICAgICAgICAgICAgICB9IGVsc2UgIHsKICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZSA9IGNvbnZlcnNlLnRlbXBsYXRlcy5tZXNzYWdlOwogICAgICAgICAgICAgICAgICAgIHVzZXJuYW1lID0gbXNnX2RpY3Quc2VuZGVyID09PSAnbWUnICYmIF9fKCdtZScpIHx8IGZ1bGxuYW1lOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJGNvbnRlbnQuZmluZCgnZGl2LmNoYXQtZXZlbnQnKS5yZW1vdmUoKTsKCiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc19jaGF0cm9vbSAmJiBtc2dfZGljdC5zZW5kZXIgPT0gJ3RoZW0nICYmIChuZXcgUmVnRXhwKCJcXGIiK3RoaXMubW9kZWwuZ2V0KCduaWNrJykrIlxcYiIpKS50ZXN0KHRleHQpKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gQWRkIHNwZWNpYWwgY2xhc3MgdG8gbWFyayBncm91cGNoYXQgbWVzc2FnZXMgaW4gd2hpY2ggd2UKICAgICAgICAgICAgICAgICAgICAvLyBhcmUgbWVudGlvbmVkLgogICAgICAgICAgICAgICAgICAgIGV4dHJhX2NsYXNzZXMgKz0gJyBtZW50aW9uZWQnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSB0ZW1wbGF0ZSh7CiAgICAgICAgICAgICAgICAgICAgJ3NlbmRlcic6IG1zZ19kaWN0LnNlbmRlciwKICAgICAgICAgICAgICAgICAgICAndGltZSc6IG1zZ190aW1lLmZvcm1hdCgnaGg6bW0nKSwKICAgICAgICAgICAgICAgICAgICAndXNlcm5hbWUnOiB1c2VybmFtZSwKICAgICAgICAgICAgICAgICAgICAnbWVzc2FnZSc6ICcnLAogICAgICAgICAgICAgICAgICAgICdleHRyYV9jbGFzc2VzJzogZXh0cmFfY2xhc3NlcwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAkY29udGVudC5hcHBlbmQoJChtZXNzYWdlKS5jaGlsZHJlbignLmNoYXQtbWVzc2FnZS1jb250ZW50JykuZmlyc3QoKS50ZXh0KHRleHQpLmFkZEh5cGVybGlua3MoKS5hZGRFbW90aWNvbnMoKS5wYXJlbnQoKSk7CiAgICAgICAgICAgICAgICB0aGlzLnNjcm9sbERvd24oKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHNob3dIZWxwTWVzc2FnZXM6IGZ1bmN0aW9uIChtc2dzLCB0eXBlLCBzcGlubmVyKSB7CiAgICAgICAgICAgICAgICB2YXIgJGNoYXRfY29udGVudCA9IHRoaXMuJGVsLmZpbmQoJy5jaGF0LWNvbnRlbnQnKSwgaSwKICAgICAgICAgICAgICAgICAgICBtc2dzX2xlbmd0aCA9IG1zZ3MubGVuZ3RoOwogICAgICAgICAgICAgICAgZm9yIChpPTA7IGk8bXNnc19sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgICRjaGF0X2NvbnRlbnQuYXBwZW5kKCQoJzxkaXYgY2xhc3M9ImNoYXQtJysodHlwZXx8J2luZm8nKSsnIj4nK21zZ3NbaV0rJzwvZGl2PicpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChzcGlubmVyID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgICAgICAgJGNoYXRfY29udGVudC5hcHBlbmQoJzxzcGFuIGNsYXNzPSJzcGlubmVyIi8+Jyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNwaW5uZXIgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICAgICAgJGNoYXRfY29udGVudC5maW5kKCdzcGFuLnNwaW5uZXInKS5yZW1vdmUoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNjcm9sbERvd24oKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIG9uTWVzc2FnZUFkZGVkOiBmdW5jdGlvbiAobWVzc2FnZSkgewogICAgICAgICAgICAgICAgdmFyIHRpbWUgPSBtZXNzYWdlLmdldCgndGltZScpLAogICAgICAgICAgICAgICAgICAgIHRpbWVzID0gdGhpcy5tb2RlbC5tZXNzYWdlcy5wbHVjaygndGltZScpLAogICAgICAgICAgICAgICAgICAgIHByZXZpb3VzX21lc3NhZ2UsIGlkeCwgdGhpc19kYXRlLCBwcmV2X2RhdGUsIHRleHQsIG1hdGNoOwoKICAgICAgICAgICAgICAgIC8vIElmIHRoaXMgbWVzc2FnZSBpcyBvbiBhIGRpZmZlcmVudCBkYXkgdGhhbiB0aGUgb25lIHJlY2VpdmVkCiAgICAgICAgICAgICAgICAvLyBwcmlvciwgdGhlbiBpbmRpY2F0ZSBpdCBvbiB0aGUgY2hhdGJveC4KICAgICAgICAgICAgICAgIGlkeCA9IF8uaW5kZXhPZih0aW1lcywgdGltZSktMTsKICAgICAgICAgICAgICAgIGlmIChpZHggPj0gMCkgewogICAgICAgICAgICAgICAgICAgIHByZXZpb3VzX21lc3NhZ2UgPSB0aGlzLm1vZGVsLm1lc3NhZ2VzLmF0KGlkeCk7CiAgICAgICAgICAgICAgICAgICAgcHJldl9kYXRlID0gbW9tZW50KHByZXZpb3VzX21lc3NhZ2UuZ2V0KCd0aW1lJykpOwogICAgICAgICAgICAgICAgICAgIGlmIChwcmV2X2RhdGUuaXNCZWZvcmUodGltZSwgJ2RheScpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXNfZGF0ZSA9IG1vbWVudCh0aW1lKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kZWwuZmluZCgnLmNoYXQtY29udGVudCcpLmFwcGVuZChjb252ZXJzZS50ZW1wbGF0ZXMubmV3X2RheSh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc29kYXRlOiB0aGlzX2RhdGUuZm9ybWF0KCJZWVlZLU1NLUREIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRlc3RyaW5nOiB0aGlzX2RhdGUuZm9ybWF0KCJkZGRkIE1NTSBEbyBZWVlZIikKICAgICAgICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLmdldChDT01QT1NJTkcpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93U3RhdHVzTm90aWZpY2F0aW9uKG1lc3NhZ2UuZ2V0KCdmdWxsbmFtZScpKycgJytfXygnaXMgdHlwaW5nJykpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobWVzc2FnZS5nZXQoUEFVU0VEKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd1N0YXR1c05vdGlmaWNhdGlvbihtZXNzYWdlLmdldCgnZnVsbG5hbWUnKSsnICcrX18oJ2hhcyBzdG9wcGVkIHR5cGluZycpKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd01lc3NhZ2UoXy5jbG9uZShtZXNzYWdlLmF0dHJpYnV0ZXMpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICgobWVzc2FnZS5nZXQoJ3NlbmRlcicpICE9ICdtZScpICYmIChjb252ZXJzZS53aW5kb3dTdGF0ZSA9PSAnYmx1cicpKSB7CiAgICAgICAgICAgICAgICAgICAgY29udmVyc2UuaW5jcmVtZW50TXNnQ291bnRlcigpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2Nyb2xsRG93bigpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgc2VuZE1lc3NhZ2VTdGFuemE6IGZ1bmN0aW9uICh0ZXh0KSB7CiAgICAgICAgICAgICAgICAvKgogICAgICAgICAgICAgICAgICogU2VuZHMgdGhlIGFjdHVhbCBYTUwgc3RhbnphIHRvIHRoZSBYTVBQIHNlcnZlci4KICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgLy8gVE9ETzogTG9vayBpbiBDaGF0UGFydG5lcnMgdG8gc2VlIHdoYXQgcmVzb3VyY2VzIHdlIGhhdmUgZm9yIHRoZSByZWNpcGllbnQuCiAgICAgICAgICAgICAgICAvLyBpZiB3ZSBoYXZlIG9uZSByZXNvdXJjZSwgd2Ugc2VudCB0byBvbmx5IHRoYXQgcmVzb3VyY2VzLCBpZiB3ZSBoYXZlIG11bHRpcGxlCiAgICAgICAgICAgICAgICAvLyB3ZSBzZW5kIHRvIHRoZSBiYXJlIGppZC4KICAgICAgICAgICAgICAgIHZhciB0aW1lc3RhbXAgPSAobmV3IERhdGUoKSkuZ2V0VGltZSgpOwogICAgICAgICAgICAgICAgdmFyIGJhcmVfamlkID0gdGhpcy5tb2RlbC5nZXQoJ2ppZCcpOwogICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSAkbXNnKHtmcm9tOiBjb252ZXJzZS5jb25uZWN0aW9uLmppZCwgdG86IGJhcmVfamlkLCB0eXBlOiAnY2hhdCcsIGlkOiB0aW1lc3RhbXB9KQogICAgICAgICAgICAgICAgICAgIC5jKCdib2R5JykudCh0ZXh0KS51cCgpCiAgICAgICAgICAgICAgICAgICAgLmMoJ2FjdGl2ZScsIHsneG1sbnMnOiAnaHR0cDovL2phYmJlci5vcmcvcHJvdG9jb2wvY2hhdHN0YXRlcyd9KTsKICAgICAgICAgICAgICAgIGNvbnZlcnNlLmNvbm5lY3Rpb24uc2VuZChtZXNzYWdlKTsKICAgICAgICAgICAgICAgIGlmIChjb252ZXJzZS5mb3J3YXJkX21lc3NhZ2VzKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gRm9yd2FyZCB0aGUgbWVzc2FnZSwgc28gdGhhdCBvdGhlciBjb25uZWN0ZWQgcmVzb3VyY2VzIGFyZSBhbHNvIGF3YXJlIG9mIGl0LgogICAgICAgICAgICAgICAgICAgIHZhciBmb3J3YXJkZWQgPSAkbXNnKHt0bzpjb252ZXJzZS5iYXJlX2ppZCwgdHlwZTonY2hhdCcsIGlkOnRpbWVzdGFtcH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jKCdmb3J3YXJkZWQnLCB7eG1sbnM6J3Vybjp4bXBwOmZvcndhcmQ6MCd9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYygnZGVsYXknLCB7eG1uczondXJuOnhtcHA6ZGVsYXknLHN0YW1wOnRpbWVzdGFtcH0pLnVwKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNub2RlKG1lc3NhZ2UudHJlZSgpKTsKICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS5jb25uZWN0aW9uLnNlbmQoZm9yd2FyZGVkKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHNlbmRNZXNzYWdlOiBmdW5jdGlvbiAodGV4dCkgewogICAgICAgICAgICAgICAgdmFyIG1hdGNoID0gdGV4dC5yZXBsYWNlKC9eXHMqLywgIiIpLm1hdGNoKC9eXC8oLiopXHMqJC8pLCBtc2dzOwogICAgICAgICAgICAgICAgaWYgKG1hdGNoKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKG1hdGNoWzFdID09PSAiY2xlYXIiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNsZWFyTWVzc2FnZXMoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAobWF0Y2hbMV0gPT09ICJoZWxwIikgewogICAgICAgICAgICAgICAgICAgICAgICBtc2dzID0gWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxzdHJvbmc+L2hlbHA8L3N0cm9uZz46JytfXygnU2hvdyB0aGlzIG1lbnUnKSsnJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8c3Ryb25nPi9tZTwvc3Ryb25nPjonK19fKCdXcml0ZSBpbiB0aGUgdGhpcmQgcGVyc29uJykrJycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPHN0cm9uZz4vY2xlYXI8L3N0cm9uZz46JytfXygnUmVtb3ZlIG1lc3NhZ2VzJykrJycKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF07CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0hlbHBNZXNzYWdlcyhtc2dzKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoKGNvbnZlcnNlLmFsbG93X290cikgJiYgKG1hdGNoWzFdID09PSAiZW5kb3RyIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZW5kT1RSKCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICgoY29udmVyc2UuYWxsb3dfb3RyKSAmJiAobWF0Y2hbMV0gPT09ICJvdHIiKSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5tb2RlbC5pbml0aWF0ZU9UUigpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChfLmNvbnRhaW5zKFtVTlZFUklGSUVELCBWRVJJRklFRF0sIHRoaXMubW9kZWwuZ2V0KCdvdHJfc3RhdHVzJykpKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gT2ZmLXRoZS1yZWNvcmQgZW5jcnlwdGlvbiBpcyBhY3RpdmUKICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLm90ci5zZW5kTXNnKHRleHQpOwogICAgICAgICAgICAgICAgICAgIHRoaXMubW9kZWwudHJpZ2dlcignc2hvd1NlbnRPVFJNZXNzYWdlJywgdGV4dCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIFdlIG9ubHkgc2F2ZSB1bmVuY3J5cHRlZCBtZXNzYWdlcy4KICAgICAgICAgICAgICAgICAgICB2YXIgZnVsbG5hbWUgPSBjb252ZXJzZS54bXBwc3RhdHVzLmdldCgnZnVsbG5hbWUnKTsKICAgICAgICAgICAgICAgICAgICBmdWxsbmFtZSA9IF8uaXNFbXB0eShmdWxsbmFtZSk/IGNvbnZlcnNlLmJhcmVfamlkOiBmdWxsbmFtZTsKICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLm1lc3NhZ2VzLmNyZWF0ZSh7CiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGxuYW1lOiBmdWxsbmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgc2VuZGVyOiAnbWUnLAogICAgICAgICAgICAgICAgICAgICAgICB0aW1lOiBtb21lbnQoKS5mb3JtYXQoKSwKICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogdGV4dAogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHRoaXMuc2VuZE1lc3NhZ2VTdGFuemEodGV4dCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBrZXlQcmVzc2VkOiBmdW5jdGlvbiAoZXYpIHsKICAgICAgICAgICAgICAgIHZhciAkdGV4dGFyZWEgPSAkKGV2LnRhcmdldCksCiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZSwgbm90aWZ5LCBjb21wb3Npbmc7CiAgICAgICAgICAgICAgICBpZihldi5rZXlDb2RlID09IEtFWS5FTlRFUikgewogICAgICAgICAgICAgICAgICAgIGV2LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZSA9ICR0ZXh0YXJlYS52YWwoKTsKICAgICAgICAgICAgICAgICAgICAkdGV4dGFyZWEudmFsKCcnKS5mb2N1cygpOwogICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlICE9PSAnJykgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5tb2RlbC5nZXQoJ2NoYXRyb29tJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VuZENoYXRSb29tTWVzc2FnZShtZXNzYWdlKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VuZE1lc3NhZ2UobWVzc2FnZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgY29udmVyc2UuZW1pdCgnbWVzc2FnZVNlbmQnLCBtZXNzYWdlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kZWwuZGF0YSgnY29tcG9zaW5nJywgZmFsc2UpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICghdGhpcy5tb2RlbC5nZXQoJ2NoYXRyb29tJykpIHsKICAgICAgICAgICAgICAgICAgICAvLyBjb21wb3NpbmcgZGF0YSBpcyBvbmx5IGZvciBzaW5nbGUgdXNlciBjaGF0CiAgICAgICAgICAgICAgICAgICAgY29tcG9zaW5nID0gdGhpcy4kZWwuZGF0YSgnY29tcG9zaW5nJyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFjb21wb3NpbmcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGV2LmtleUNvZGUgIT0gNDcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFdlIGRvbid0IHNlbmQgY29tcG9zaW5nIG1lc3NhZ2VzIGlmIHRoZSBtZXNzYWdlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBzdGFydHMgd2l0aCBmb3J3YXJkLXNsYXNoLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbm90aWZ5ID0gJG1zZyh7J3RvJzp0aGlzLm1vZGVsLmdldCgnamlkJyksICd0eXBlJzogJ2NoYXQnfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYygnY29tcG9zaW5nJywgeyd4bWxucyc6J2h0dHA6Ly9qYWJiZXIub3JnL3Byb3RvY29sL2NoYXRzdGF0ZXMnfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS5jb25uZWN0aW9uLnNlbmQobm90aWZ5KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbC5kYXRhKCdjb21wb3NpbmcnLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBvbkRyYWdSZXNpemVTdGFydDogZnVuY3Rpb24gKGV2KSB7CiAgICAgICAgICAgICAgICBpZiAoIWNvbnZlcnNlLmFsbG93X2RyYWdyZXNpemUpIHsgcmV0dXJuIHRydWU7IH0KICAgICAgICAgICAgICAgIC8vIFJlY29yZCBlbGVtZW50IGF0dHJpYnV0ZXMgZm9yIG1vdXNlTW92ZSgpLgogICAgICAgICAgICAgICAgdGhpcy5oZWlnaHQgPSB0aGlzLiRlbC5jaGlsZHJlbignLmJveC1mbHlvdXQnKS5oZWlnaHQoKTsKICAgICAgICAgICAgICAgIGNvbnZlcnNlLnJlc2l6ZWRfY2hhdGJveCA9IHRoaXM7CiAgICAgICAgICAgICAgICB0aGlzLnByZXZfcGFnZVkgPSBldi5wYWdlWTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHNldENoYXRCb3hIZWlnaHQ6IGZ1bmN0aW9uIChoZWlnaHQpIHsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5tb2RlbC5nZXQoJ21pbmltaXplZCcpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kZWwuY2hpbGRyZW4oJy5ib3gtZmx5b3V0JylbMF0uc3R5bGUuaGVpZ2h0ID0gY29udmVyc2UuYXBwbHlIZWlnaHRSZXNpc3RhbmNlKGhlaWdodCkrJ3B4JzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHJlc2l6ZUNoYXRCb3g6IGZ1bmN0aW9uIChldikgewogICAgICAgICAgICAgICAgdmFyIGRpZmYgPSBldi5wYWdlWSAtIHRoaXMucHJldl9wYWdlWTsKICAgICAgICAgICAgICAgIGlmICghZGlmZikgeyByZXR1cm47IH0KICAgICAgICAgICAgICAgIHRoaXMuaGVpZ2h0IC09IGRpZmY7CiAgICAgICAgICAgICAgICB0aGlzLnByZXZfcGFnZVkgPSBldi5wYWdlWTsKICAgICAgICAgICAgICAgIHRoaXMuc2V0Q2hhdEJveEhlaWdodCh0aGlzLmhlaWdodCk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBjbGVhck1lc3NhZ2VzOiBmdW5jdGlvbiAoZXYpIHsKICAgICAgICAgICAgICAgIGlmIChldiAmJiBldi5wcmV2ZW50RGVmYXVsdCkgeyBldi5wcmV2ZW50RGVmYXVsdCgpOyB9CiAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gY29uZmlybShfXygiQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIGNsZWFyIHRoZSBtZXNzYWdlcyBmcm9tIHRoaXMgY2hhdCBib3g/IikpOwogICAgICAgICAgICAgICAgaWYgKHJlc3VsdCA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuJGVsLmZpbmQoJy5jaGF0LWNvbnRlbnQnKS5lbXB0eSgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMubW9kZWwubWVzc2FnZXMucmVzZXQoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLm1lc3NhZ2VzLmJyb3dzZXJTdG9yYWdlLl9jbGVhcigpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBpbnNlcnRFbW90aWNvbjogZnVuY3Rpb24gKGV2KSB7CiAgICAgICAgICAgICAgICBldi5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgICAgIHRoaXMuJGVsLmZpbmQoJy50b2dnbGUtc21pbGV5IHVsJykuc2xpZGVUb2dnbGUoMjAwKTsKICAgICAgICAgICAgICAgIHZhciAkdGV4dGJveCA9IHRoaXMuJGVsLmZpbmQoJ3RleHRhcmVhLmNoYXQtdGV4dGFyZWEnKTsKICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9ICR0ZXh0Ym94LnZhbCgpOwogICAgICAgICAgICAgICAgdmFyICR0YXJnZXQgPSAkKGV2LnRhcmdldCk7CiAgICAgICAgICAgICAgICAkdGFyZ2V0ID0gJHRhcmdldC5pcygnYScpID8gJHRhcmdldCA6ICR0YXJnZXQuY2hpbGRyZW4oJ2EnKTsKICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAmJiAodmFsdWVbdmFsdWUubGVuZ3RoLTFdICE9PSAnICcpKSB7CiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZSArICcgJzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICR0ZXh0Ym94LmZvY3VzKCkudmFsKHZhbHVlKyR0YXJnZXQuZGF0YSgnZW1vdGljb24nKSsnICcpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgdG9nZ2xlRW1vdGljb25NZW51OiBmdW5jdGlvbiAoZXYpIHsKICAgICAgICAgICAgICAgIGV2LnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgICAgICAgICAgdGhpcy4kZWwuZmluZCgnLnRvZ2dsZS1zbWlsZXkgdWwnKS5zbGlkZVRvZ2dsZSgyMDApOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgdG9nZ2xlT1RSTWVudTogZnVuY3Rpb24gKGV2KSB7CiAgICAgICAgICAgICAgICBldi5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgICAgIHRoaXMuJGVsLmZpbmQoJy50b2dnbGUtb3RyIHVsJykuc2xpZGVUb2dnbGUoMjAwKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHNob3dPVFJFcnJvcjogZnVuY3Rpb24gKG1zZykgewogICAgICAgICAgICAgICAgaWYgKG1zZyA9PSAnTWVzc2FnZSBjYW5ub3QgYmUgc2VudCBhdCB0aGlzIHRpbWUuJykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0hlbHBNZXNzYWdlcygKICAgICAgICAgICAgICAgICAgICAgICAgW19fKCdZb3VyIG1lc3NhZ2UgY291bGQgbm90IGJlIHNlbnQnKV0sICdlcnJvcicpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChtc2cgPT0gJ1JlY2VpdmVkIGFuIHVuZW5jcnlwdGVkIG1lc3NhZ2UuJykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0hlbHBNZXNzYWdlcygKICAgICAgICAgICAgICAgICAgICAgICAgW19fKCdXZSByZWNlaXZlZCBhbiB1bmVuY3J5cHRlZCBtZXNzYWdlJyldLCAnZXJyb3InKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobXNnID09ICdSZWNlaXZlZCBhbiB1bnJlYWRhYmxlIGVuY3J5cHRlZCBtZXNzYWdlLicpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dIZWxwTWVzc2FnZXMoCiAgICAgICAgICAgICAgICAgICAgICAgIFtfXygnV2UgcmVjZWl2ZWQgYW4gdW5yZWFkYWJsZSBlbmNyeXB0ZWQgbWVzc2FnZScpXSwKICAgICAgICAgICAgICAgICAgICAgICAgJ2Vycm9yJyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0hlbHBNZXNzYWdlcyhbJ0VuY3J5cHRpb24gZXJyb3Igb2NjdXJlZDogJyttc2ddLCAnZXJyb3InKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJPVFIgRVJST1I6Iittc2cpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgYnVkZHlTdGFydHNPVFI6IGZ1bmN0aW9uIChldikgewogICAgICAgICAgICAgICAgdGhpcy5zaG93SGVscE1lc3NhZ2VzKFtfXygnVGhpcyB1c2VyIGhhcyByZXF1ZXN0ZWQgYW4gZW5jcnlwdGVkIHNlc3Npb24uJyldKTsKICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuaW5pdGlhdGVPVFIoKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHN0YXJ0T1RSRnJvbVRvb2xiYXI6IGZ1bmN0aW9uIChldikgewogICAgICAgICAgICAgICAgJChldi50YXJnZXQpLnBhcmVudCgpLnBhcmVudCgpLnNsaWRlVXAoKTsKICAgICAgICAgICAgICAgIGV2LnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5pbml0aWF0ZU9UUigpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgZW5kT1RSOiBmdW5jdGlvbiAoZXYpIHsKICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZXYgIT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgICAgICAgICAgZXYucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgICAgICBldi5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuZW5kT1RSKCk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBhdXRoT1RSOiBmdW5jdGlvbiAoZXYpIHsKICAgICAgICAgICAgICAgIHZhciBzY2hlbWUgPSAkKGV2LnRhcmdldCkuZGF0YSgpLnNjaGVtZTsKICAgICAgICAgICAgICAgIHZhciByZXN1bHQsIHF1ZXN0aW9uLCBhbnN3ZXI7CiAgICAgICAgICAgICAgICBpZiAoc2NoZW1lID09PSAnZmluZ2VycHJpbnQnKSB7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gY29uZmlybShfXygnSGVyZSBhcmUgdGhlIGZpbmdlcnByaW50cywgcGxlYXNlIGNvbmZpcm0gdGhlbSB3aXRoICUxJHMsIG91dHNpZGUgb2YgdGhpcyBjaGF0LlxuXG5GaW5nZXJwcmludCBmb3IgeW91LCAlMiRzOiAlMyRzXG5cbkZpbmdlcnByaW50IGZvciAlMSRzOiAlNCRzXG5cbklmIHlvdSBoYXZlIGNvbmZpcm1lZCB0aGF0IHRoZSBmaW5nZXJwcmludHMgbWF0Y2gsIGNsaWNrIE9LLCBvdGhlcndpc2UgY2xpY2sgQ2FuY2VsLicsIFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuZ2V0KCdmdWxsbmFtZScpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udmVyc2UueG1wcHN0YXR1cy5nZXQoJ2Z1bGxuYW1lJyl8fGNvbnZlcnNlLmJhcmVfamlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5vdHIucHJpdi5maW5nZXJwcmludCgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5vdHIudGhlaXJfcHJpdl9way5maW5nZXJwcmludCgpCiAgICAgICAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgICAgICApKTsKICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0ID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuc2F2ZSh7J290cl9zdGF0dXMnOiBWRVJJRklFRH0pOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuc2F2ZSh7J290cl9zdGF0dXMnOiBVTlZFUklGSUVEfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzY2hlbWUgPT09ICdzbXAnKSB7CiAgICAgICAgICAgICAgICAgICAgYWxlcnQoX18oJ1lvdSB3aWxsIGJlIHByb21wdGVkIHRvIHByb3ZpZGUgYSBzZWN1cml0eSBxdWVzdGlvbiBhbmQgdGhlbiBhbiBhbnN3ZXIgdG8gdGhhdCBxdWVzdGlvbi5cblxuWW91ciBidWRkeSB3aWxsIHRoZW4gYmUgcHJvbXB0ZWQgdGhlIHNhbWUgcXVlc3Rpb24gYW5kIGlmIHRoZXkgdHlwZSB0aGUgZXhhY3Qgc2FtZSBhbnN3ZXIgKGNhc2Ugc2Vuc2l0aXZlKSwgdGhlaXIgaWRlbnRpdHkgd2lsbCBiZSB2ZXJpZmllZC4nKSk7CiAgICAgICAgICAgICAgICAgICAgcXVlc3Rpb24gPSBwcm9tcHQoX18oJ1doYXQgaXMgeW91ciBzZWN1cml0eSBxdWVzdGlvbj8nKSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHF1ZXN0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFuc3dlciA9IHByb21wdChfXygnV2hhdCBpcyB0aGUgYW5zd2VyIHRvIHRoZSBzZWN1cml0eSBxdWVzdGlvbj8nKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW9kZWwub3RyLnNtcFNlY3JldChhbnN3ZXIsIHF1ZXN0aW9uKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0hlbHBNZXNzYWdlcyhbX18oJ0ludmFsaWQgYXV0aGVudGljYXRpb24gc2NoZW1lIHByb3ZpZGVkJyldLCAnZXJyb3InKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHRvZ2dsZUNhbGw6IGZ1bmN0aW9uIChldikgewogICAgICAgICAgICAgICAgZXYuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgICAgICAgICBjb252ZXJzZS5lbWl0KCdjYWxsQnV0dG9uQ2xpY2tlZCcsIHsKICAgICAgICAgICAgICAgICAgICBjb25uZWN0aW9uOiBjb252ZXJzZS5jb25uZWN0aW9uLAogICAgICAgICAgICAgICAgICAgIG1vZGVsOiB0aGlzLm1vZGVsCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIG9uQ2hhbmdlOiBmdW5jdGlvbiAoaXRlbSwgY2hhbmdlZCkgewogICAgICAgICAgICAgICAgaWYgKF8uaGFzKGl0ZW0uY2hhbmdlZCwgJ2NoYXRfc3RhdHVzJykpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgY2hhdF9zdGF0dXMgPSBpdGVtLmdldCgnY2hhdF9zdGF0dXMnKSwKICAgICAgICAgICAgICAgICAgICAgICAgZnVsbG5hbWUgPSBpdGVtLmdldCgnZnVsbG5hbWUnKTsKICAgICAgICAgICAgICAgICAgICBmdWxsbmFtZSA9IF8uaXNFbXB0eShmdWxsbmFtZSk/IGl0ZW0uZ2V0KCdqaWQnKTogZnVsbG5hbWU7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuJGVsLmlzKCc6dmlzaWJsZScpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjaGF0X3N0YXR1cyA9PT0gJ29mZmxpbmUnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dTdGF0dXNOb3RpZmljYXRpb24oZnVsbG5hbWUrJyAnKydoYXMgZ29uZSBvZmZsaW5lJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY2hhdF9zdGF0dXMgPT09ICdhd2F5JykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93U3RhdHVzTm90aWZpY2F0aW9uKGZ1bGxuYW1lKycgJysnaGFzIGdvbmUgYXdheScpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKChjaGF0X3N0YXR1cyA9PT0gJ2RuZCcpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dTdGF0dXNOb3RpZmljYXRpb24oZnVsbG5hbWUrJyAnKydpcyBidXN5Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY2hhdF9zdGF0dXMgPT09ICdvbmxpbmUnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbC5maW5kKCdkaXYuY2hhdC1ldmVudCcpLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLmVtaXQoJ2J1ZGR5U3RhdHVzQ2hhbmdlZCcsIGl0ZW0uYXR0cmlidXRlcywgaXRlbS5nZXQoJ2NoYXRfc3RhdHVzJykpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKF8uaGFzKGl0ZW0uY2hhbmdlZCwgJ3N0YXR1cycpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93U3RhdHVzTWVzc2FnZSgpOwogICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLmVtaXQoJ2J1ZGR5U3RhdHVzTWVzc2FnZUNoYW5nZWQnLCBpdGVtLmF0dHJpYnV0ZXMsIGl0ZW0uZ2V0KCdzdGF0dXMnKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoXy5oYXMoaXRlbS5jaGFuZ2VkLCAnaW1hZ2UnKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyQXZhdGFyKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoXy5oYXMoaXRlbS5jaGFuZ2VkLCAnb3RyX3N0YXR1cycpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJUb29sYmFyKCkuaW5mb3JtT1RSQ2hhbmdlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoXy5oYXMoaXRlbS5jaGFuZ2VkLCAnbWluaW1pemVkJykpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5nZXQoJ21pbmltaXplZCcpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaGlkZSgpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubWF4aW1pemUoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBUT0RPIGNoZWNrIGZvciBjaGFuZ2VkIGZ1bGxuYW1lIGFzIHdlbGwKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHNob3dTdGF0dXNNZXNzYWdlOiBmdW5jdGlvbiAobXNnKSB7CiAgICAgICAgICAgICAgICBtc2cgPSBtc2cgfHwgdGhpcy5tb2RlbC5nZXQoJ3N0YXR1cycpOwogICAgICAgICAgICAgICAgaWYgKG1zZykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuJGVsLmZpbmQoJ3AudXNlci1jdXN0b20tbWVzc2FnZScpLnRleHQobXNnKS5hdHRyKCd0aXRsZScsIG1zZyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGNsb3NlOiBmdW5jdGlvbiAoZXYpIHsKICAgICAgICAgICAgICAgIGlmIChldiAmJiBldi5wcmV2ZW50RGVmYXVsdCkgeyBldi5wcmV2ZW50RGVmYXVsdCgpOyB9CiAgICAgICAgICAgICAgICBpZiAoY29udmVyc2UuY29ubmVjdGlvbi5jb25uZWN0ZWQpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLmRlc3Ryb3koKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlbC50cmlnZ2VyKCdoaWRlJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb252ZXJzZS5lbWl0KCdjaGF0Qm94Q2xvc2VkJywgdGhpcyk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIG1heGltaXplOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAvLyBSZXN0b3JlcyBhIG1pbmltaXplZCBjaGF0IGJveAogICAgICAgICAgICAgICAgdGhpcy4kZWwuaW5zZXJ0QWZ0ZXIoY29udmVyc2UuY2hhdGJveHZpZXdzLmdldCgiY29udHJvbGJveCIpLiRlbCkuc2hvdygnZmFzdCcsICQucHJveHkoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLnJlZnJlc2hXZWJraXQoKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmZvY3VzKCk7CiAgICAgICAgICAgICAgICAgICAgY29udmVyc2UuZW1pdCgnY2hhdEJveE1heGltaXplZCcsIHRoaXMpOwogICAgICAgICAgICAgICAgfSwgdGhpcykpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgbWluaW1pemU6IGZ1bmN0aW9uIChldikgewogICAgICAgICAgICAgICAgaWYgKGV2ICYmIGV2LnByZXZlbnREZWZhdWx0KSB7IGV2LnByZXZlbnREZWZhdWx0KCk7IH0KICAgICAgICAgICAgICAgIC8vIE1pbmltaXplcyBhIGNoYXQgYm94CiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLm1pbmltaXplKCk7CiAgICAgICAgICAgICAgICB0aGlzLiRlbC5oaWRlKCdmYXN0JywgY29udmVyc2UucmVmcmVzaHdlYmtpdCk7CiAgICAgICAgICAgICAgICBjb252ZXJzZS5lbWl0KCdjaGF0Qm94TWluaW1pemVkJywgdGhpcyk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICB1cGRhdGVWQ2FyZDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIGppZCA9IHRoaXMubW9kZWwuZ2V0KCdqaWQnKSwKICAgICAgICAgICAgICAgICAgICBjb250YWN0ID0gY29udmVyc2Uucm9zdGVyLmdldChqaWQpOwogICAgICAgICAgICAgICAgaWYgKChjb250YWN0KSAmJiAoIWNvbnRhY3QuZ2V0KCd2Y2FyZF91cGRhdGVkJykpKSB7CiAgICAgICAgICAgICAgICAgICAgY29udmVyc2UuZ2V0VkNhcmQoCiAgICAgICAgICAgICAgICAgICAgICAgIGppZCwKICAgICAgICAgICAgICAgICAgICAgICAgJC5wcm94eShmdW5jdGlvbiAoamlkLCBmdWxsbmFtZSwgaW1hZ2UsIGltYWdlX3R5cGUsIHVybCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5zYXZlKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZnVsbG5hbWUnIDogZnVsbG5hbWUgfHwgamlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd1cmwnOiB1cmwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2ltYWdlX3R5cGUnOiBpbWFnZV90eXBlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdpbWFnZSc6IGltYWdlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfSwgdGhpcyksCiAgICAgICAgICAgICAgICAgICAgICAgICQucHJveHkoZnVuY3Rpb24gKHN0YW56YSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udmVyc2UubG9nKCJDaGF0Qm94Vmlldy5pbml0aWFsaXplOiBBbiBlcnJvciBvY2N1cmVkIHdoaWxlIGZldGNoaW5nIHZjYXJkIik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0sIHRoaXMpCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGluZm9ybU9UUkNoYW5nZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIGRhdGEgPSB0aGlzLm1vZGVsLnRvSlNPTigpOwogICAgICAgICAgICAgICAgdmFyIG1zZ3MgPSBbXTsKICAgICAgICAgICAgICAgIGlmIChkYXRhLm90cl9zdGF0dXMgPT0gVU5FTkNSWVBURUQpIHsKICAgICAgICAgICAgICAgICAgICBtc2dzLnB1c2goX18oIllvdXIgbWVzc2FnZXMgYXJlIG5vdCBlbmNyeXB0ZWQgYW55bW9yZSIpKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZGF0YS5vdHJfc3RhdHVzID09IFVOVkVSSUZJRUQpewogICAgICAgICAgICAgICAgICAgIG1zZ3MucHVzaChfXygiWW91ciBtZXNzYWdlcyBhcmUgbm93IGVuY3J5cHRlZCBidXQgeW91ciBidWRkeSdzIGlkZW50aXR5IGhhcyBub3QgYmVlbiB2ZXJpZmllZC4iKSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGRhdGEub3RyX3N0YXR1cyA9PSBWRVJJRklFRCl7CiAgICAgICAgICAgICAgICAgICAgbXNncy5wdXNoKF9fKCJZb3VyIGJ1ZGR5J3MgaWRlbnRpZnkgaGFzIGJlZW4gdmVyaWZpZWQuIikpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChkYXRhLm90cl9zdGF0dXMgPT0gRklOSVNIRUQpewogICAgICAgICAgICAgICAgICAgIG1zZ3MucHVzaChfXygiWW91ciBidWRkeSBoYXMgZW5kZWQgZW5jcnlwdGlvbiBvbiB0aGVpciBlbmQsIHlvdSBzaG91bGQgZG8gdGhlIHNhbWUuIikpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2hvd0hlbHBNZXNzYWdlcyhtc2dzLCAnaW5mbycsIGZhbHNlKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHJlbmRlclRvb2xiYXI6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGlmIChjb252ZXJzZS5zaG93X3Rvb2xiYXIpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IHRoaXMubW9kZWwudG9KU09OKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEub3RyX3N0YXR1cyA9PSBVTkVOQ1JZUFRFRCkgewogICAgICAgICAgICAgICAgICAgICAgICBkYXRhLm90cl90b29sdGlwID0gX18oJ1lvdXIgbWVzc2FnZXMgYXJlIG5vdCBlbmNyeXB0ZWQuIENsaWNrIGhlcmUgdG8gZW5hYmxlIE9UUiBlbmNyeXB0aW9uLicpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZGF0YS5vdHJfc3RhdHVzID09IFVOVkVSSUZJRUQpewogICAgICAgICAgICAgICAgICAgICAgICBkYXRhLm90cl90b29sdGlwID0gX18oJ1lvdXIgbWVzc2FnZXMgYXJlIGVuY3J5cHRlZCwgYnV0IHlvdXIgYnVkZHkgaGFzIG5vdCBiZWVuIHZlcmlmaWVkLicpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZGF0YS5vdHJfc3RhdHVzID09IFZFUklGSUVEKXsKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5vdHJfdG9vbHRpcCA9IF9fKCdZb3VyIG1lc3NhZ2VzIGFyZSBlbmNyeXB0ZWQgYW5kIHlvdXIgYnVkZHkgdmVyaWZpZWQuJyk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChkYXRhLm90cl9zdGF0dXMgPT0gRklOSVNIRUQpewogICAgICAgICAgICAgICAgICAgICAgICBkYXRhLm90cl90b29sdGlwID0gX18oJ1lvdXIgYnVkZHkgaGFzIGNsb3NlZCB0aGVpciBlbmQgb2YgdGhlIHByaXZhdGUgc2Vzc2lvbiwgeW91IHNob3VsZCBkbyB0aGUgc2FtZScpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbC5maW5kKCcuY2hhdC10b29sYmFyJykuaHRtbCgKICAgICAgICAgICAgICAgICAgICAgICAgY29udmVyc2UudGVtcGxhdGVzLnRvb2xiYXIoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfLmV4dGVuZChkYXRhLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRklOSVNIRUQ6IEZJTklTSEVELAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFVORU5DUllQVEVEOiBVTkVOQ1JZUFRFRCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBVTlZFUklGSUVEOiBVTlZFUklGSUVELAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFZFUklGSUVEOiBWRVJJRklFRCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGxvd19vdHI6IGNvbnZlcnNlLmFsbG93X290ciAmJiAhdGhpcy5pc19jaGF0cm9vbSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbF9jbGVhcjogX18oJ0NsZWFyIGFsbCBtZXNzYWdlcycpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsX2VuZF9lbmNyeXB0ZWRfY29udmVyc2F0aW9uOiBfXygnRW5kIGVuY3J5cHRlZCBjb252ZXJzYXRpb24nKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbF9oaWRlX3BhcnRpY2lwYW50czogX18oJ0hpZGUgdGhlIGxpc3Qgb2YgcGFydGljaXBhbnRzJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWxfcmVmcmVzaF9lbmNyeXB0ZWRfY29udmVyc2F0aW9uOiBfXygnUmVmcmVzaCBlbmNyeXB0ZWQgY29udmVyc2F0aW9uJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWxfc3RhcnRfY2FsbDogX18oJ1N0YXJ0IGEgY2FsbCcpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsX3N0YXJ0X2VuY3J5cHRlZF9jb252ZXJzYXRpb246IF9fKCdTdGFydCBlbmNyeXB0ZWQgY29udmVyc2F0aW9uJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWxfdmVyaWZ5X3dpdGhfZmluZ2VycHJpbnRzOiBfXygnVmVyaWZ5IHdpdGggZmluZ2VycHJpbnRzJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWxfdmVyaWZ5X3dpdGhfc21wOiBfXygnVmVyaWZ5IHdpdGggU01QJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWxfd2hhdHNfdGhpczogX18oIldoYXRcJ3MgdGhpcz8iKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdHJfc3RhdHVzX2NsYXNzOiBPVFJfQ0xBU1NfTUFQUElOR1tkYXRhLm90cl9zdGF0dXNdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG90cl90cmFuc2xhdGVkX3N0YXR1czogT1RSX1RSQU5TTEFURURfTUFQUElOR1tkYXRhLm90cl9zdGF0dXNdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3dfY2FsbF9idXR0b246IGNvbnZlcnNlLnZpc2libGVfdG9vbGJhcl9idXR0b25zLmNhbGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvd19jbGVhcl9idXR0b246IGNvbnZlcnNlLnZpc2libGVfdG9vbGJhcl9idXR0b25zLmNsZWFyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3dfZW1vdGljb25zOiBjb252ZXJzZS52aXNpYmxlX3Rvb2xiYXJfYnV0dG9ucy5lbW90aWNvbnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvd19wYXJ0aWNpcGFudHNfdG9nZ2xlOiB0aGlzLmlzX2NoYXRyb29tICYmIGNvbnZlcnNlLnZpc2libGVfdG9vbGJhcl9idXR0b25zLnRvZ2dsZV9wYXJ0aWNpcGFudHMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICByZW5kZXJBdmF0YXI6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5tb2RlbC5nZXQoJ2ltYWdlJykpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB2YXIgaW1nX3NyYyA9ICdkYXRhOicrdGhpcy5tb2RlbC5nZXQoJ2ltYWdlX3R5cGUnKSsnO2Jhc2U2NCwnK3RoaXMubW9kZWwuZ2V0KCdpbWFnZScpLAogICAgICAgICAgICAgICAgICAgIGNhbnZhcyA9ICQoJzxjYW52YXMgaGVpZ2h0PSIzMXB4IiB3aWR0aD0iMzFweCIgY2xhc3M9ImF2YXRhciI+PC9jYW52YXM+JykuZ2V0KDApOwoKICAgICAgICAgICAgICAgIGlmICghKGNhbnZhcy5nZXRDb250ZXh0ICYmIGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpKSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdmFyIGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpOwogICAgICAgICAgICAgICAgdmFyIGltZyA9IG5ldyBJbWFnZSgpOyAgIC8vIENyZWF0ZSBuZXcgSW1hZ2Ugb2JqZWN0CiAgICAgICAgICAgICAgICBpbWcub25sb2FkID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIHZhciByYXRpbyA9IGltZy53aWR0aC9pbWcuaGVpZ2h0OwogICAgICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoaW1nLCAwLDAsIDM1KnJhdGlvLCAzNSk7CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgaW1nLnNyYyA9IGltZ19zcmM7CiAgICAgICAgICAgICAgICB0aGlzLiRlbC5maW5kKCcuY2hhdC10aXRsZScpLmJlZm9yZShjYW52YXMpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBmb2N1czogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdGhpcy4kZWwuZmluZCgnLmNoYXQtdGV4dGFyZWEnKS5mb2N1cygpOwogICAgICAgICAgICAgICAgY29udmVyc2UuZW1pdCgnY2hhdEJveEZvY3VzZWQnLCB0aGlzKTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgaGlkZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuJGVsLmlzKCc6dmlzaWJsZScpICYmIHRoaXMuJGVsLmNzcygnb3BhY2l0eScpID09ICIxIikgewogICAgICAgICAgICAgICAgICAgIHRoaXMuJGVsLmhpZGUoKTsKICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS5yZWZyZXNoV2Via2l0KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHNob3c6IGZ1bmN0aW9uIChjYWxsYmFjaykgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuJGVsLmlzKCc6dmlzaWJsZScpICYmIHRoaXMuJGVsLmNzcygnb3BhY2l0eScpID09ICIxIikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmZvY3VzKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLiRlbC5mYWRlSW4oY2FsbGJhY2spOwogICAgICAgICAgICAgICAgaWYgKGNvbnZlcnNlLmNvbm5lY3Rpb24uY29ubmVjdGVkKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gV2l0aG91dCBhIGNvbm5lY3Rpb24sIHdlIGhhdmVuJ3QgeWV0IGluaXRpYWxpemVkCiAgICAgICAgICAgICAgICAgICAgLy8gbG9jYWxzdG9yYWdlCiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5zYXZlKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbml0RHJhZ1Jlc2l6ZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBzY3JvbGxEb3duOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB2YXIgJGNvbnRlbnQgPSB0aGlzLiQoJy5jaGF0LWNvbnRlbnQnKTsKICAgICAgICAgICAgICAgIGlmICgkY29udGVudC5pcygnOnZpc2libGUnKSkgewogICAgICAgICAgICAgICAgICAgICRjb250ZW50LnNjcm9sbFRvcCgkY29udGVudFswXS5zY3JvbGxIZWlnaHQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgdGhpcy5Db250YWN0c1BhbmVsID0gQmFja2JvbmUuVmlldy5leHRlbmQoewogICAgICAgICAgICB0YWdOYW1lOiAnZGl2JywKICAgICAgICAgICAgY2xhc3NOYW1lOiAnY29udHJvbGJveC1wYW5lJywKICAgICAgICAgICAgaWQ6ICd1c2VycycsCiAgICAgICAgICAgIGV2ZW50czogewogICAgICAgICAgICAgICAgJ2NsaWNrIGEudG9nZ2xlLXhtcHAtY29udGFjdC1mb3JtJzogJ3RvZ2dsZUNvbnRhY3RGb3JtJywKICAgICAgICAgICAgICAgICdzdWJtaXQgZm9ybS5hZGQteG1wcC1jb250YWN0JzogJ2FkZENvbnRhY3RGcm9tRm9ybScsCiAgICAgICAgICAgICAgICAnc3VibWl0IGZvcm0uc2VhcmNoLXhtcHAtY29udGFjdCc6ICdzZWFyY2hDb250YWN0cycsCiAgICAgICAgICAgICAgICAnY2xpY2sgYS5zdWJzY3JpYmUtdG8tdXNlcic6ICdhZGRDb250YWN0RnJvbUxpc3QnCiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbiAoY2ZnKSB7CiAgICAgICAgICAgICAgICBjZmcuJHBhcmVudC5hcHBlbmQodGhpcy4kZWwpOwogICAgICAgICAgICAgICAgdGhpcy4kdGFicyA9IGNmZy4kcGFyZW50LnBhcmVudCgpLmZpbmQoJyNjb250cm9sYm94LXRhYnMnKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIG1hcmt1cDsKICAgICAgICAgICAgICAgIHZhciB3aWRnZXRzID0gY29udmVyc2UudGVtcGxhdGVzLmNvbnRhY3RzX3BhbmVsKHsKICAgICAgICAgICAgICAgICAgICBsYWJlbF9vbmxpbmU6IF9fKCdPbmxpbmUnKSwKICAgICAgICAgICAgICAgICAgICBsYWJlbF9idXN5OiBfXygnQnVzeScpLAogICAgICAgICAgICAgICAgICAgIGxhYmVsX2F3YXk6IF9fKCdBd2F5JyksCiAgICAgICAgICAgICAgICAgICAgbGFiZWxfb2ZmbGluZTogX18oJ09mZmxpbmUnKSwKICAgICAgICAgICAgICAgICAgICBsYWJlbF9sb2dvdXQ6IF9fKCdMb2cgb3V0JyksCiAgICAgICAgICAgICAgICAgICAgYWxsb3dfbG9nb3V0OiBjb252ZXJzZS5hbGxvd19sb2dvdXQKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgdGhpcy4kdGFicy5hcHBlbmQoY29udmVyc2UudGVtcGxhdGVzLmNvbnRhY3RzX3RhYih7bGFiZWxfY29udGFjdHM6IExBQkVMX0NPTlRBQ1RTfSkpOwogICAgICAgICAgICAgICAgaWYgKGNvbnZlcnNlLnhocl91c2VyX3NlYXJjaCkgewogICAgICAgICAgICAgICAgICAgIG1hcmt1cCA9IGNvbnZlcnNlLnRlbXBsYXRlcy5zZWFyY2hfY29udGFjdCh7CiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsX2NvbnRhY3RfbmFtZTogX18oJ0NvbnRhY3QgbmFtZScpLAogICAgICAgICAgICAgICAgICAgICAgICBsYWJlbF9zZWFyY2g6IF9fKCdTZWFyY2gnKQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBtYXJrdXAgPSBjb252ZXJzZS50ZW1wbGF0ZXMuYWRkX2NvbnRhY3RfZm9ybSh7CiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsX2NvbnRhY3RfdXNlcm5hbWU6IF9fKCdDb250YWN0IHVzZXJuYW1lJyksCiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsX2FkZDogX18oJ0FkZCcpCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoY29udmVyc2UuYWxsb3dfY29udGFjdF9yZXF1ZXN0cykgewogICAgICAgICAgICAgICAgICAgIHdpZGdldHMgKz0gY29udmVyc2UudGVtcGxhdGVzLmFkZF9jb250YWN0X2Ryb3Bkb3duKHsKICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWxfY2xpY2tfdG9fY2hhdDogX18oJ0NsaWNrIHRvIGFkZCBuZXcgY2hhdCBjb250YWN0cycpLAogICAgICAgICAgICAgICAgICAgICAgICBsYWJlbF9hZGRfY29udGFjdDogX18oJ0FkZCBhIGNvbnRhY3QnKQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy4kZWwuaHRtbCh3aWRnZXRzKTsKICAgICAgICAgICAgICAgIHRoaXMuJGVsLmZpbmQoJy5zZWFyY2gteG1wcCB1bCcpLmFwcGVuZChtYXJrdXApOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICB0b2dnbGVDb250YWN0Rm9ybTogZnVuY3Rpb24gKGV2KSB7CiAgICAgICAgICAgICAgICBldi5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgdGhpcy4kZWwuZmluZCgnLnNlYXJjaC14bXBwJykudG9nZ2xlKCdmYXN0JywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIGlmICgkKHRoaXMpLmlzKCc6dmlzaWJsZScpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykuZmluZCgnaW5wdXQudXNlcm5hbWUnKS5mb2N1cygpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgc2VhcmNoQ29udGFjdHM6IGZ1bmN0aW9uIChldikgewogICAgICAgICAgICAgICAgZXYucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgICQuZ2V0SlNPTihjb252ZXJzZS54aHJfdXNlcl9zZWFyY2hfdXJsKyAiP3E9IiArICQoZXYudGFyZ2V0KS5maW5kKCdpbnB1dC51c2VybmFtZScpLnZhbCgpLCBmdW5jdGlvbiAoZGF0YSkgewogICAgICAgICAgICAgICAgICAgIHZhciAkdWw9ICQoJy5zZWFyY2gteG1wcCB1bCcpOwogICAgICAgICAgICAgICAgICAgICR1bC5maW5kKCdsaS5mb3VuZC11c2VyJykucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICAgICAgJHVsLmZpbmQoJ2xpLmNoYXQtaW5mbycpLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgICAgIGlmICghZGF0YS5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHVsLmFwcGVuZCgnPGxpIGNsYXNzPSJjaGF0LWluZm8iPicrX18oJ05vIHVzZXJzIGZvdW5kJykrJzwvbGk+Jyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICQoZGF0YSkuZWFjaChmdW5jdGlvbiAoaWR4LCBvYmopIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHVsLmFwcGVuZCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJzxsaSBjbGFzcz0iZm91bmQtdXNlciI+PC9saT4nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCc8YSBjbGFzcz0ic3Vic2NyaWJlLXRvLXVzZXIiIGhyZWY9IiMiIHRpdGxlPSInK19fKCdDbGljayB0byBhZGQgYXMgYSBjaGF0IGNvbnRhY3QnKSsnIj48L2E+JykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cignZGF0YS1yZWNpcGllbnQnLCBTdHJvcGhlLmVzY2FwZU5vZGUob2JqLmlkKSsnQCcrY29udmVyc2UuZG9tYWluKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50ZXh0KG9iai5mdWxsbmFtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgYWRkQ29udGFjdEZyb21Gb3JtOiBmdW5jdGlvbiAoZXYpIHsKICAgICAgICAgICAgICAgIGV2LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICB2YXIgJGlucHV0ID0gJChldi50YXJnZXQpLmZpbmQoJ2lucHV0Jyk7CiAgICAgICAgICAgICAgICB2YXIgamlkID0gJGlucHV0LnZhbCgpOwogICAgICAgICAgICAgICAgaWYgKCEgamlkKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gdGhpcyBpcyBub3QgYSB2YWxpZCBKSUQKICAgICAgICAgICAgICAgICAgICAkaW5wdXQuYWRkQ2xhc3MoJ2Vycm9yJyk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5hZGRDb250YWN0KGppZCk7CiAgICAgICAgICAgICAgICAkKCcuc2VhcmNoLXhtcHAnKS5oaWRlKCk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBhZGRDb250YWN0RnJvbUxpc3Q6IGZ1bmN0aW9uIChldikgewogICAgICAgICAgICAgICAgZXYucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgIHZhciAkdGFyZ2V0ID0gJChldi50YXJnZXQpLAogICAgICAgICAgICAgICAgICAgIGppZCA9ICR0YXJnZXQuYXR0cignZGF0YS1yZWNpcGllbnQnKSwKICAgICAgICAgICAgICAgICAgICBuYW1lID0gJHRhcmdldC50ZXh0KCk7CiAgICAgICAgICAgICAgICB0aGlzLmFkZENvbnRhY3QoamlkLCBuYW1lKTsKICAgICAgICAgICAgICAgICR0YXJnZXQucGFyZW50KCkucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICAkKCcuc2VhcmNoLXhtcHAnKS5oaWRlKCk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBhZGRDb250YWN0OiBmdW5jdGlvbiAoamlkLCBuYW1lKSB7CiAgICAgICAgICAgICAgICBuYW1lID0gXy5pc0VtcHR5KG5hbWUpPyBqaWQ6IG5hbWU7CiAgICAgICAgICAgICAgICBjb252ZXJzZS5jb25uZWN0aW9uLnJvc3Rlci5hZGQoamlkLCBuYW1lLCBbXSwgZnVuY3Rpb24gKGlxKSB7CiAgICAgICAgICAgICAgICAgICAgY29udmVyc2UuY29ubmVjdGlvbi5yb3N0ZXIuc3Vic2NyaWJlKGppZCwgbnVsbCwgY29udmVyc2UueG1wcHN0YXR1cy5nZXQoJ2Z1bGxuYW1lJykpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgdGhpcy5Sb29tc1BhbmVsID0gQmFja2JvbmUuVmlldy5leHRlbmQoewogICAgICAgICAgICB0YWdOYW1lOiAnZGl2JywKICAgICAgICAgICAgaWQ6ICdjaGF0cm9vbXMnLAogICAgICAgICAgICBldmVudHM6IHsKICAgICAgICAgICAgICAgICdzdWJtaXQgZm9ybS5hZGQtY2hhdHJvb20nOiAnY3JlYXRlQ2hhdFJvb20nLAogICAgICAgICAgICAgICAgJ2NsaWNrIGlucHV0I3Nob3ctcm9vbXMnOiAnc2hvd1Jvb21zJywKICAgICAgICAgICAgICAgICdjbGljayBhLm9wZW4tcm9vbSc6ICdjcmVhdGVDaGF0Um9vbScsCiAgICAgICAgICAgICAgICAnY2xpY2sgYS5yb29tLWluZm8nOiAnc2hvd1Jvb21JbmZvJwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKGNmZykgewogICAgICAgICAgICAgICAgY2ZnLiRwYXJlbnQuYXBwZW5kKAogICAgICAgICAgICAgICAgICAgIHRoaXMuJGVsLmh0bWwoCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLnRlbXBsYXRlcy5yb29tX3BhbmVsKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzZXJ2ZXJfaW5wdXRfdHlwZSc6IGNvbnZlcnNlLmhpZGVfbXVjX3NlcnZlciAmJiAnaGlkZGVuJyB8fCAndGV4dCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbGFiZWxfcm9vbV9uYW1lJzogX18oJ1Jvb20gbmFtZScpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2xhYmVsX25pY2tuYW1lJzogX18oJ05pY2tuYW1lJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbGFiZWxfc2VydmVyJzogX18oJ1NlcnZlcicpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2xhYmVsX2pvaW4nOiBfXygnSm9pbicpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2xhYmVsX3Nob3dfcm9vbXMnOiBfXygnU2hvdyByb29tcycpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgKS5oaWRlKCkpOwogICAgICAgICAgICAgICAgdGhpcy4kdGFicyA9IGNmZy4kcGFyZW50LnBhcmVudCgpLmZpbmQoJyNjb250cm9sYm94LXRhYnMnKTsKCiAgICAgICAgICAgICAgICB0aGlzLm9uKCd1cGRhdGUtcm9vbXMtbGlzdCcsIGZ1bmN0aW9uIChldikgewogICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlUm9vbXNMaXN0KCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGNvbnZlcnNlLnhtcHBzdGF0dXMub24oImNoYW5nZSIsICQucHJveHkoZnVuY3Rpb24gKG1vZGVsKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCEoXy5oYXMobW9kZWwuY2hhbmdlZCwgJ2Z1bGxuYW1lJykpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdmFyICRuaWNrID0gdGhpcy4kZWwuZmluZCgnaW5wdXQubmV3LWNoYXRyb29tLW5pY2snKTsKICAgICAgICAgICAgICAgICAgICBpZiAoISAkbmljay5pcygnOmZvY3VzJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJG5pY2sudmFsKG1vZGVsLmdldCgnZnVsbG5hbWUnKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwgdGhpcykpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB0aGlzLiR0YWJzLmFwcGVuZChjb252ZXJzZS50ZW1wbGF0ZXMuY2hhdHJvb21zX3RhYih7bGFiZWxfcm9vbXM6IF9fKCdSb29tcycpfSkpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBpbmZvcm1Ob1Jvb21zRm91bmQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciAkYXZhaWxhYmxlX2NoYXRyb29tcyA9IHRoaXMuJGVsLmZpbmQoJyNhdmFpbGFibGUtY2hhdHJvb21zJyk7CiAgICAgICAgICAgICAgICAvLyAjIEZvciB0cmFuc2xhdG9yczogJTEkcyBpcyBhIHZhcmlhYmxlIGFuZCB3aWxsIGJlIHJlcGxhY2VkIHdpdGggdGhlIFhNUFAgc2VydmVyIG5hbWUKICAgICAgICAgICAgICAgICRhdmFpbGFibGVfY2hhdHJvb21zLmh0bWwoJzxkdD4nK19fKCdObyByb29tcyBvbiAlMSRzJyx0aGlzLm11Y19kb21haW4pKyc8L2R0PicpOwogICAgICAgICAgICAgICAgJCgnaW5wdXQjc2hvdy1yb29tcycpLnNob3coKS5zaWJsaW5ncygnc3Bhbi5zcGlubmVyJykucmVtb3ZlKCk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICB1cGRhdGVSb29tc0xpc3Q6IGZ1bmN0aW9uIChkb21haW4pIHsKICAgICAgICAgICAgICAgIGNvbnZlcnNlLmNvbm5lY3Rpb24ubXVjLmxpc3RSb29tcygKICAgICAgICAgICAgICAgICAgICB0aGlzLm11Y19kb21haW4sCiAgICAgICAgICAgICAgICAgICAgJC5wcm94eShmdW5jdGlvbiAoaXEpIHsgLy8gU3VjY2VzcwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgbmFtZSwgamlkLCBpLCBmcmFnbWVudCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQgPSB0aGlzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGF2YWlsYWJsZV9jaGF0cm9vbXMgPSB0aGlzLiRlbC5maW5kKCcjYXZhaWxhYmxlLWNoYXRyb29tcycpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJvb21zID0gJChpcSkuZmluZCgncXVlcnknKS5maW5kKCdpdGVtJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnJvb21zLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gIyBGb3IgdHJhbnNsYXRvcnM6ICUxJHMgaXMgYSB2YXJpYWJsZSBhbmQgd2lsbCBiZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gIyByZXBsYWNlZCB3aXRoIHRoZSBYTVBQIHNlcnZlciBuYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYXZhaWxhYmxlX2NoYXRyb29tcy5odG1sKCc8ZHQ+JytfXygnUm9vbXMgb24gJTEkcycsdGhpcy5tdWNfZG9tYWluKSsnPC9kdD4nKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZyYWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChpPTA7IGk8dGhpcy5yb29tcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUgPSBTdHJvcGhlLnVuZXNjYXBlTm9kZSgkKHRoaXMucm9vbXNbaV0pLmF0dHIoJ25hbWUnKXx8JCh0aGlzLnJvb21zW2ldKS5hdHRyKCdqaWQnKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgamlkID0gJCh0aGlzLnJvb21zW2ldKS5hdHRyKCdqaWQnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZCgkKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS50ZW1wbGF0ZXMucm9vbV9pdGVtKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICduYW1lJzpuYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2ppZCc6amlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ29wZW5fdGl0bGUnOiBfXygnQ2xpY2sgdG8gb3BlbiB0aGlzIHJvb20nKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdpbmZvX3RpdGxlJzogX18oJ1Nob3cgbW9yZSBpbmZvcm1hdGlvbiBvbiB0aGlzIHJvb20nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKVswXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYXZhaWxhYmxlX2NoYXRyb29tcy5hcHBlbmQoZnJhZ21lbnQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnaW5wdXQjc2hvdy1yb29tcycpLnNob3coKS5zaWJsaW5ncygnc3Bhbi5zcGlubmVyJykucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmluZm9ybU5vUm9vbXNGb3VuZCgpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgICAgIH0sIHRoaXMpLAogICAgICAgICAgICAgICAgICAgICQucHJveHkoZnVuY3Rpb24gKGlxKSB7IC8vIEZhaWx1cmUKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbmZvcm1Ob1Jvb21zRm91bmQoKTsKICAgICAgICAgICAgICAgICAgICB9LCB0aGlzKSk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBzaG93Um9vbXM6IGZ1bmN0aW9uIChldikgewogICAgICAgICAgICAgICAgdmFyICRhdmFpbGFibGVfY2hhdHJvb21zID0gdGhpcy4kZWwuZmluZCgnI2F2YWlsYWJsZS1jaGF0cm9vbXMnKTsKICAgICAgICAgICAgICAgIHZhciAkc2VydmVyID0gdGhpcy4kZWwuZmluZCgnaW5wdXQubmV3LWNoYXRyb29tLXNlcnZlcicpOwogICAgICAgICAgICAgICAgdmFyIHNlcnZlciA9ICRzZXJ2ZXIudmFsKCk7CiAgICAgICAgICAgICAgICBpZiAoIXNlcnZlcikgewogICAgICAgICAgICAgICAgICAgICRzZXJ2ZXIuYWRkQ2xhc3MoJ2Vycm9yJyk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy4kZWwuZmluZCgnaW5wdXQubmV3LWNoYXRyb29tLW5hbWUnKS5yZW1vdmVDbGFzcygnZXJyb3InKTsKICAgICAgICAgICAgICAgICRzZXJ2ZXIucmVtb3ZlQ2xhc3MoJ2Vycm9yJyk7CiAgICAgICAgICAgICAgICAkYXZhaWxhYmxlX2NoYXRyb29tcy5lbXB0eSgpOwogICAgICAgICAgICAgICAgJCgnaW5wdXQjc2hvdy1yb29tcycpLmhpZGUoKS5hZnRlcignPHNwYW4gY2xhc3M9InNwaW5uZXIiLz4nKTsKICAgICAgICAgICAgICAgIHRoaXMubXVjX2RvbWFpbiA9IHNlcnZlcjsKICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlUm9vbXNMaXN0KCk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBzaG93Um9vbUluZm86IGZ1bmN0aW9uIChldikgewogICAgICAgICAgICAgICAgdmFyIHRhcmdldCA9IGV2LnRhcmdldCwKICAgICAgICAgICAgICAgICAgICAkZGQgPSAkKHRhcmdldCkucGFyZW50KCdkZCcpLAogICAgICAgICAgICAgICAgICAgICRkaXYgPSAkZGQuZmluZCgnZGl2LnJvb20taW5mbycpOwogICAgICAgICAgICAgICAgaWYgKCRkaXYubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgJGRpdi5yZW1vdmUoKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJGRkLmZpbmQoJ3NwYW4uc3Bpbm5lcicpLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgICAgICRkZC5hcHBlbmQoJzxzcGFuIGNsYXNzPSJzcGlubmVyIGhvcl9jZW50ZXJlZCIvPicpOwogICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLmNvbm5lY3Rpb24uZGlzY28uaW5mbygKICAgICAgICAgICAgICAgICAgICAgICAgJCh0YXJnZXQpLmF0dHIoJ2RhdGEtcm9vbS1qaWQnKSwKICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgJC5wcm94eShmdW5jdGlvbiAoc3RhbnphKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgJHN0YW56YSA9ICQoc3RhbnphKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFsbCBNVUMgZmVhdHVyZXMgZm91bmQgaGVyZTogaHR0cDovL3htcHAub3JnL3JlZ2lzdHJhci9kaXNjby1mZWF0dXJlcy5odG1sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZGQuZmluZCgnc3Bhbi5zcGlubmVyJykucmVwbGFjZVdpdGgoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udmVyc2UudGVtcGxhdGVzLnJvb21fZGVzY3JpcHRpb24oewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGVzYyc6ICRzdGFuemEuZmluZCgnZmllbGRbdmFyPSJtdWMjcm9vbWluZm9fZGVzY3JpcHRpb24iXSB2YWx1ZScpLnRleHQoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ29jYyc6ICRzdGFuemEuZmluZCgnZmllbGRbdmFyPSJtdWMjcm9vbWluZm9fb2NjdXBhbnRzIl0gdmFsdWUnKS50ZXh0KCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdoaWRkZW4nOiAkc3RhbnphLmZpbmQoJ2ZlYXR1cmVbdmFyPSJtdWNfaGlkZGVuIl0nKS5sZW5ndGgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdtZW1iZXJzb25seSc6ICRzdGFuemEuZmluZCgnZmVhdHVyZVt2YXI9Im11Y19tZW1iZXJzb25seSJdJykubGVuZ3RoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbW9kZXJhdGVkJzogJHN0YW56YS5maW5kKCdmZWF0dXJlW3Zhcj0ibXVjX21vZGVyYXRlZCJdJykubGVuZ3RoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbm9uYW5vbnltb3VzJzogJHN0YW56YS5maW5kKCdmZWF0dXJlW3Zhcj0ibXVjX25vbmFub255bW91cyJdJykubGVuZ3RoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnb3Blbic6ICRzdGFuemEuZmluZCgnZmVhdHVyZVt2YXI9Im11Y19vcGVuIl0nKS5sZW5ndGgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdwYXNzd29yZHByb3RlY3RlZCc6ICRzdGFuemEuZmluZCgnZmVhdHVyZVt2YXI9Im11Y19wYXNzd29yZHByb3RlY3RlZCJdJykubGVuZ3RoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncGVyc2lzdGVudCc6ICRzdGFuemEuZmluZCgnZmVhdHVyZVt2YXI9Im11Y19wZXJzaXN0ZW50Il0nKS5sZW5ndGgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdwdWJsaWNyb29tJzogJHN0YW56YS5maW5kKCdmZWF0dXJlW3Zhcj0ibXVjX3B1YmxpYyJdJykubGVuZ3RoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc2VtaWFub255bW91cyc6ICRzdGFuemEuZmluZCgnZmVhdHVyZVt2YXI9Im11Y19zZW1pYW5vbnltb3VzIl0nKS5sZW5ndGgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd0ZW1wb3JhcnknOiAkc3RhbnphLmZpbmQoJ2ZlYXR1cmVbdmFyPSJtdWNfdGVtcG9yYXJ5Il0nKS5sZW5ndGgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd1bm1vZGVyYXRlZCc6ICRzdGFuemEuZmluZCgnZmVhdHVyZVt2YXI9Im11Y191bm1vZGVyYXRlZCJdJykubGVuZ3RoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbGFiZWxfZGVzYyc6IF9fKCdEZXNjcmlwdGlvbjonKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2xhYmVsX29jYyc6IF9fKCdPY2N1cGFudHM6JyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdsYWJlbF9mZWF0dXJlcyc6IF9fKCdGZWF0dXJlczonKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2xhYmVsX3JlcXVpcmVzX2F1dGgnOiBfXygnUmVxdWlyZXMgYXV0aGVudGljYXRpb24nKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2xhYmVsX2hpZGRlbic6IF9fKCdIaWRkZW4nKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2xhYmVsX3JlcXVpcmVzX2ludml0ZSc6IF9fKCdSZXF1aXJlcyBhbiBpbnZpdGF0aW9uJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdsYWJlbF9tb2RlcmF0ZWQnOiBfXygnTW9kZXJhdGVkJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdsYWJlbF9ub25fYW5vbic6IF9fKCdOb24tYW5vbnltb3VzJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdsYWJlbF9vcGVuX3Jvb20nOiBfXygnT3BlbiByb29tJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdsYWJlbF9wZXJtYW5lbnRfcm9vbSc6IF9fKCdQZXJtYW5lbnQgcm9vbScpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbGFiZWxfcHVibGljJzogX18oJ1B1YmxpYycpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbGFiZWxfc2VtaV9hbm9uJzogIF8oJ1NlbWktYW5vbnltb3VzJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdsYWJlbF90ZW1wX3Jvb20nOiAgXygnVGVtcG9yYXJ5IHJvb20nKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2xhYmVsX3VubW9kZXJhdGVkJzogX18oJ1VubW9kZXJhdGVkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0sIHRoaXMpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGNyZWF0ZUNoYXRSb29tOiBmdW5jdGlvbiAoZXYpIHsKICAgICAgICAgICAgICAgIGV2LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICB2YXIgbmFtZSwgJG5hbWUsCiAgICAgICAgICAgICAgICAgICAgc2VydmVyLCAkc2VydmVyLAogICAgICAgICAgICAgICAgICAgIGppZCwKICAgICAgICAgICAgICAgICAgICAkbmljayA9IHRoaXMuJGVsLmZpbmQoJ2lucHV0Lm5ldy1jaGF0cm9vbS1uaWNrJyksCiAgICAgICAgICAgICAgICAgICAgbmljayA9ICRuaWNrLnZhbCgpLAogICAgICAgICAgICAgICAgICAgIGNoYXRyb29tOwoKICAgICAgICAgICAgICAgIGlmICghbmljaykgeyAkbmljay5hZGRDbGFzcygnZXJyb3InKTsgfQogICAgICAgICAgICAgICAgZWxzZSB7ICRuaWNrLnJlbW92ZUNsYXNzKCdlcnJvcicpOyB9CgogICAgICAgICAgICAgICAgaWYgKGV2LnR5cGUgPT09ICdjbGljaycpIHsKICAgICAgICAgICAgICAgICAgICBqaWQgPSAkKGV2LnRhcmdldCkuYXR0cignZGF0YS1yb29tLWppZCcpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkbmFtZSA9IHRoaXMuJGVsLmZpbmQoJ2lucHV0Lm5ldy1jaGF0cm9vbS1uYW1lJyk7CiAgICAgICAgICAgICAgICAgICAgJHNlcnZlcj0gdGhpcy4kZWwuZmluZCgnaW5wdXQubmV3LWNoYXRyb29tLXNlcnZlcicpOwogICAgICAgICAgICAgICAgICAgIHNlcnZlciA9ICRzZXJ2ZXIudmFsKCk7CiAgICAgICAgICAgICAgICAgICAgbmFtZSA9ICRuYW1lLnZhbCgpLnRyaW0oKS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgICAgICRuYW1lLnZhbCgnJyk7IC8vIENsZWFyIHRoZSBpbnB1dAogICAgICAgICAgICAgICAgICAgIGlmIChuYW1lICYmIHNlcnZlcikgewogICAgICAgICAgICAgICAgICAgICAgICBqaWQgPSBTdHJvcGhlLmVzY2FwZU5vZGUobmFtZSkgKyAnQCcgKyBzZXJ2ZXI7CiAgICAgICAgICAgICAgICAgICAgICAgICRuYW1lLnJlbW92ZUNsYXNzKCdlcnJvcicpOwogICAgICAgICAgICAgICAgICAgICAgICAkc2VydmVyLnJlbW92ZUNsYXNzKCdlcnJvcicpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm11Y19kb21haW4gPSBzZXJ2ZXI7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFuYW1lKSB7ICRuYW1lLmFkZENsYXNzKCdlcnJvcicpOyB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghc2VydmVyKSB7ICRzZXJ2ZXIuYWRkQ2xhc3MoJ2Vycm9yJyk7IH0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICghbmljaykgeyByZXR1cm47IH0KICAgICAgICAgICAgICAgIGNoYXRyb29tID0gY29udmVyc2UuY2hhdGJveHZpZXdzLnNob3dDaGF0KHsKICAgICAgICAgICAgICAgICAgICAnaWQnOiBqaWQsCiAgICAgICAgICAgICAgICAgICAgJ2ppZCc6IGppZCwKICAgICAgICAgICAgICAgICAgICAnbmFtZSc6IFN0cm9waGUudW5lc2NhcGVOb2RlKFN0cm9waGUuZ2V0Tm9kZUZyb21KaWQoamlkKSksCiAgICAgICAgICAgICAgICAgICAgJ25pY2snOiBuaWNrLAogICAgICAgICAgICAgICAgICAgICdjaGF0cm9vbSc6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgJ2JveF9pZCcgOiBiNjRfc2hhMShqaWQpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICB0aGlzLkNvbnRyb2xCb3hWaWV3ID0gY29udmVyc2UuQ2hhdEJveFZpZXcuZXh0ZW5kKHsKICAgICAgICAgICAgdGFnTmFtZTogJ2RpdicsCiAgICAgICAgICAgIGNsYXNzTmFtZTogJ2NoYXRib3gnLAogICAgICAgICAgICBpZDogJ2NvbnRyb2xib3gnLAogICAgICAgICAgICBldmVudHM6IHsKICAgICAgICAgICAgICAgICdjbGljayBhLmNsb3NlLWNoYXRib3gtYnV0dG9uJzogJ2Nsb3NlJywKICAgICAgICAgICAgICAgICdjbGljayB1bCNjb250cm9sYm94LXRhYnMgbGkgYSc6ICdzd2l0Y2hUYWInLAogICAgICAgICAgICAgICAgJ21vdXNlZG93biAuZHJhZ3Jlc2l6ZS10bSc6ICdvbkRyYWdSZXNpemVTdGFydCcKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHRoaXMuJGVsLmluc2VydEFmdGVyKGNvbnZlcnNlLmNvbnRyb2xib3h0b2dnbGUuJGVsKTsKICAgICAgICAgICAgICAgIHRoaXMubW9kZWwub24oJ2NoYW5nZTpjb25uZWN0ZWQnLCB0aGlzLm9uQ29ubmVjdGVkLCB0aGlzKTsKICAgICAgICAgICAgICAgIHRoaXMubW9kZWwub24oJ2Rlc3Ryb3knLCB0aGlzLmhpZGUsIHRoaXMpOwogICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5vbignaGlkZScsIHRoaXMuaGlkZSwgdGhpcyk7CiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLm9uKCdzaG93JywgdGhpcy5zaG93LCB0aGlzKTsKICAgICAgICAgICAgICAgIHRoaXMubW9kZWwub24oJ2NoYW5nZTpjbG9zZWQnLCB0aGlzLmVuc3VyZUNsb3NlZFN0YXRlLCB0aGlzKTsKICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyKCk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5tb2RlbC5nZXQoJ2Nvbm5lY3RlZCcpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbml0Um9zdGVyKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMubW9kZWwuZ2V0KCdjbG9zZWQnKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvdygpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmhpZGUoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIG9uQ29ubmVjdGVkOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5tb2RlbC5nZXQoJ2Nvbm5lY3RlZCcpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIoKS5pbml0Um9zdGVyKCk7CiAgICAgICAgICAgICAgICAgICAgY29udmVyc2UuZmVhdHVyZXMub2ZmKCdhZGQnLCB0aGlzLmZlYXR1cmVBZGRlZCwgdGhpcyk7CiAgICAgICAgICAgICAgICAgICAgY29udmVyc2UuZmVhdHVyZXMub24oJ2FkZCcsIHRoaXMuZmVhdHVyZUFkZGVkLCB0aGlzKTsKICAgICAgICAgICAgICAgICAgICAvLyBGZWF0dXJlcyBjb3VsZCBoYXZlIGJlZW4gYWRkZWQgYmVmb3JlIHRoZSBjb250cm9sYm94IHdhcwogICAgICAgICAgICAgICAgICAgIC8vIGluaXRpYWxpemVkLiBDdXJyZW50bHkgd2UncmUgb25seSBpbnRlcmVzdGVkIGluIE1VQwogICAgICAgICAgICAgICAgICAgIHZhciBmZWF0dXJlID0gY29udmVyc2UuZmVhdHVyZXMuZmluZFdoZXJlKHsndmFyJzogJ2h0dHA6Ly9qYWJiZXIub3JnL3Byb3RvY29sL211Yyd9KTsKICAgICAgICAgICAgICAgICAgICBpZiAoZmVhdHVyZSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZlYXR1cmVBZGRlZChmZWF0dXJlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBpbml0Um9zdGVyOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAvKiBXZSBpbml0aWFsaXplIHRoZSByb3N0ZXIsIHdoaWNoIHdpbGwgYXBwZWFyIGluc2lkZSB0aGUKICAgICAgICAgICAgICAgICAqIENvbnRhY3RzIFBhbmVsLgogICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICBjb252ZXJzZS5yb3N0ZXIgPSBuZXcgY29udmVyc2UuUm9zdGVyQ29udGFjdHMoKTsKICAgICAgICAgICAgICAgIGNvbnZlcnNlLnJvc3Rlci5icm93c2VyU3RvcmFnZSA9IG5ldyBCYWNrYm9uZS5Ccm93c2VyU3RvcmFnZVtjb252ZXJzZS5zdG9yYWdlXSgKICAgICAgICAgICAgICAgICAgICBiNjRfc2hhMSgnY29udmVyc2UuY29udGFjdHMtJytjb252ZXJzZS5iYXJlX2ppZCkpOwogICAgICAgICAgICAgICAgdmFyIHJvc3Rlcmdyb3VwcyA9IG5ldyBjb252ZXJzZS5Sb3N0ZXJHcm91cHMoKTsKICAgICAgICAgICAgICAgIHJvc3Rlcmdyb3Vwcy5icm93c2VyU3RvcmFnZSA9IG5ldyBCYWNrYm9uZS5Ccm93c2VyU3RvcmFnZVtjb252ZXJzZS5zdG9yYWdlXSgKICAgICAgICAgICAgICAgICAgICBiNjRfc2hhMSgnY29udmVyc2Uucm9zdGVyLmdyb3VwcycrY29udmVyc2UuYmFyZV9qaWQpKTsKICAgICAgICAgICAgICAgIGNvbnZlcnNlLnJvc3RlcnZpZXcgPSBuZXcgY29udmVyc2UuUm9zdGVyVmlldyh7bW9kZWw6IHJvc3Rlcmdyb3Vwc30pOwogICAgICAgICAgICAgICAgdGhpcy5jb250YWN0c3BhbmVsLiRlbC5hcHBlbmQoY29udmVyc2Uucm9zdGVydmlldy4kZWwpOwogICAgICAgICAgICAgICAgLy8gVE9ETzoKICAgICAgICAgICAgICAgIC8vIFNlZSBpZiB3ZSBzaG91bGRuJ3QgYWxzbyBmZXRjaCB0aGUgcm9zdGVyIGhlcmUuLi4gb3RoZXJ3aXNlCiAgICAgICAgICAgICAgICAvLyB0aGUgcm9zdGVyIGlzIGFsd2F5cyBwb3B1bGF0ZWQgYnkgdGhlIHJvc3RlckhhbmRsZXIgbWV0aG9kLAogICAgICAgICAgICAgICAgLy8gd2hpY2ggYXBwZWFycyB0byBiZSBhIGxlc3MgZWNvbm9taWMgd2F5LgogICAgICAgICAgICAgICAgLy8gaS5lLiBmcm9tIHdoYXQgaXQgc2VlbXMsIG9ubHkgZ3JvdXBzIGFyZSBmZXRjaGVkIGZyb20KICAgICAgICAgICAgICAgIC8vIGJyb3dzZXJTdG9yYWdlLCBhbmQgbm8gY29udGFjdHMuCiAgICAgICAgICAgICAgICAvLyBYWFg6IE1ha2Ugc3VyZSB0aGF0IGlmIGZldGNoIGlzIGNhbGxlZCwgd2UgZG9uJ3Qgc29ydCBvbgogICAgICAgICAgICAgICAgLy8gZWFjaCBpdGVtIGFkZC4uLgogICAgICAgICAgICAgICAgLy8gY29udmVyc2Uucm9zdGVyLmZldGNoKCkKICAgICAgICAgICAgICAgIGNvbnZlcnNlLnJvc3RlcnZpZXcucmVuZGVyKCkuZmV0Y2goKS51cGRhdGUoKTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBpZiAoIWNvbnZlcnNlLmNvbm5lY3Rpb24uY29ubmVjdGVkIHx8ICFjb252ZXJzZS5jb25uZWN0aW9uLmF1dGhlbnRpY2F0ZWQgfHwgY29udmVyc2UuY29ubmVjdGlvbi5kaXNjb25uZWN0aW5nKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gVE9ETzogd2UgbWlnaHQgbmVlZCB0byB0YWtlIHByZWJpbmRpbmcgaW50byBjb25zaWRlcmF0aW9uIGhlcmUuCiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJMb2dpblBhbmVsKCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCF0aGlzLmNvbnRhY3RzcGFuZWwgfHwgIXRoaXMuY29udGFjdHNwYW5lbC4kZWwuaXMoJzp2aXNpYmxlJykpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbmRlckNvbnRhY3RzUGFuZWwoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgcmVuZGVyTG9naW5QYW5lbDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdGhpcy4kZWwuaHRtbChjb252ZXJzZS50ZW1wbGF0ZXMuY29udHJvbGJveCh0aGlzLm1vZGVsLnRvSlNPTigpKSk7CiAgICAgICAgICAgICAgICB2YXIgY2ZnID0geyckcGFyZW50JzogdGhpcy4kZWwuZmluZCgnLmNvbnRyb2xib3gtcGFuZXMnKSwgJ21vZGVsJzogdGhpc307CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMubG9naW5wYW5lbCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMubG9naW5wYW5lbCA9IG5ldyBjb252ZXJzZS5Mb2dpblBhbmVsKGNmZyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRoaXMubG9naW5wYW5lbC5kZWxlZ2F0ZUV2ZW50cygpLmluaXRpYWxpemUoY2ZnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMubG9naW5wYW5lbC5yZW5kZXIoKTsKICAgICAgICAgICAgICAgIHRoaXMuaW5pdERyYWdSZXNpemUoKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHJlbmRlckNvbnRhY3RzUGFuZWw6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHRoaXMuJGVsLmh0bWwoY29udmVyc2UudGVtcGxhdGVzLmNvbnRyb2xib3godGhpcy5tb2RlbC50b0pTT04oKSkpOwogICAgICAgICAgICAgICAgdGhpcy5jb250YWN0c3BhbmVsID0gbmV3IGNvbnZlcnNlLkNvbnRhY3RzUGFuZWwoeyckcGFyZW50JzogdGhpcy4kZWwuZmluZCgnLmNvbnRyb2xib3gtcGFuZXMnKX0pOwogICAgICAgICAgICAgICAgdGhpcy5jb250YWN0c3BhbmVsLnJlbmRlcigpOwogICAgICAgICAgICAgICAgY29udmVyc2UueG1wcHN0YXR1c3ZpZXcgPSBuZXcgY29udmVyc2UuWE1QUFN0YXR1c1ZpZXcoeydtb2RlbCc6IGNvbnZlcnNlLnhtcHBzdGF0dXN9KTsKICAgICAgICAgICAgICAgIGNvbnZlcnNlLnhtcHBzdGF0dXN2aWV3LnJlbmRlcigpOwogICAgICAgICAgICAgICAgaWYgKGNvbnZlcnNlLmFsbG93X211YykgewogICAgICAgICAgICAgICAgICAgIHRoaXMucm9vbXNwYW5lbCA9IG5ldyBjb252ZXJzZS5Sb29tc1BhbmVsKHsnJHBhcmVudCc6IHRoaXMuJGVsLmZpbmQoJy5jb250cm9sYm94LXBhbmVzJyl9KTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnJvb21zcGFuZWwucmVuZGVyKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLmluaXREcmFnUmVzaXplKCk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBjbG9zZTogZnVuY3Rpb24gKGV2KSB7CiAgICAgICAgICAgICAgICBpZiAoZXYgJiYgZXYucHJldmVudERlZmF1bHQpIHsgZXYucHJldmVudERlZmF1bHQoKTsgfQogICAgICAgICAgICAgICAgaWYgKGNvbnZlcnNlLmNvbm5lY3Rpb24uY29ubmVjdGVkKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5zYXZlKHsnY2xvc2VkJzogdHJ1ZX0pOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLnRyaWdnZXIoJ2hpZGUnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvbnZlcnNlLmVtaXQoJ2NvbnRyb2xCb3hDbG9zZWQnLCB0aGlzKTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgZW5zdXJlQ2xvc2VkU3RhdGU6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLm1vZGVsLmdldCgnY2xvc2VkJykpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmhpZGUoKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBoaWRlOiBmdW5jdGlvbiAoY2FsbGJhY2spIHsKICAgICAgICAgICAgICAgIHRoaXMuJGVsLmhpZGUoJ2Zhc3QnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgY29udmVyc2UucmVmcmVzaFdlYmtpdCgpOwogICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLmVtaXQoJ2NoYXRCb3hDbG9zZWQnLCB0aGlzKTsKICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS5jb250cm9sYm94dG9nZ2xlLnNob3coZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGNhbGxiYWNrID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaygpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgc2hvdzogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgY29udmVyc2UuY29udHJvbGJveHRvZ2dsZS5oaWRlKCQucHJveHkoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuJGVsLnNob3coJ2Zhc3QnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb252ZXJzZS5yb3N0ZXJ2aWV3KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS5yb3N0ZXJ2aWV3LnVwZGF0ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLnJlZnJlc2hXZWJraXQoKTsKICAgICAgICAgICAgICAgICAgICB9LmJpbmQodGhpcykpOwogICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLmVtaXQoJ2NvbnRyb2xCb3hPcGVuZWQnLCB0aGlzKTsKICAgICAgICAgICAgICAgIH0sIHRoaXMpKTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgZmVhdHVyZUFkZGVkOiBmdW5jdGlvbiAoZmVhdHVyZSkgewogICAgICAgICAgICAgICAgaWYgKChmZWF0dXJlLmdldCgndmFyJykgPT0gJ2h0dHA6Ly9qYWJiZXIub3JnL3Byb3RvY29sL211YycpICYmIChjb252ZXJzZS5hbGxvd19tdWMpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5yb29tc3BhbmVsLm11Y19kb21haW4gPSBmZWF0dXJlLmdldCgnZnJvbScpOwogICAgICAgICAgICAgICAgICAgIHZhciAkc2VydmVyPSB0aGlzLiRlbC5maW5kKCdpbnB1dC5uZXctY2hhdHJvb20tc2VydmVyJyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCEgJHNlcnZlci5pcygnOmZvY3VzJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHNlcnZlci52YWwodGhpcy5yb29tc3BhbmVsLm11Y19kb21haW4pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoY29udmVyc2UuYXV0b19saXN0X3Jvb21zKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucm9vbXNwYW5lbC50cmlnZ2VyKCd1cGRhdGUtcm9vbXMtbGlzdCcpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHN3aXRjaFRhYjogZnVuY3Rpb24gKGV2KSB7CiAgICAgICAgICAgICAgICBldi5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgdmFyICR0YWIgPSAkKGV2LnRhcmdldCksCiAgICAgICAgICAgICAgICAgICAgJHNpYmxpbmcgPSAkdGFiLnBhcmVudCgpLnNpYmxpbmdzKCdsaScpLmNoaWxkcmVuKCdhJyksCiAgICAgICAgICAgICAgICAgICAgJHRhYl9wYW5lbCA9ICQoJHRhYi5hdHRyKCdocmVmJykpOwogICAgICAgICAgICAgICAgJCgkc2libGluZy5hdHRyKCdocmVmJykpLmhpZGUoKTsKICAgICAgICAgICAgICAgICRzaWJsaW5nLnJlbW92ZUNsYXNzKCdjdXJyZW50Jyk7CiAgICAgICAgICAgICAgICAkdGFiLmFkZENsYXNzKCdjdXJyZW50Jyk7CiAgICAgICAgICAgICAgICAkdGFiX3BhbmVsLnNob3coKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHNob3dIZWxwTWVzc2FnZXM6IGZ1bmN0aW9uIChtc2dzKSB7CiAgICAgICAgICAgICAgICAvLyBPdmVycmlkZSBzaG93SGVscE1lc3NhZ2VzIGluIENoYXRCb3hWaWV3LCBmb3Igbm93IGRvIG5vdGhpbmcuCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgdGhpcy5DaGF0Um9vbU9jY3VwYW50ID0gQmFja2JvbmUuTW9kZWw7CiAgICAgICAgdGhpcy5DaGF0Um9vbU9jY3VwYW50VmlldyA9IEJhY2tib25lLlZpZXcuZXh0ZW5kKHsKICAgICAgICAgICAgdGFnTmFtZTogJ2xpJywKICAgICAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5vbignY2hhbmdlJywgdGhpcy5yZW5kZXIsIHRoaXMpOwogICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5vbignZGVzdHJveScsIHRoaXMuZGVzdHJveSwgdGhpcyk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyICRuZXcgPSBjb252ZXJzZS50ZW1wbGF0ZXMub2NjdXBhbnQoCiAgICAgICAgICAgICAgICAgICAgXy5leHRlbmQoCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW9kZWwudG9KU09OKCksIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkZXNjX21vZGVyYXRvcic6IF9fKCdUaGlzIHVzZXIgaXMgYSBtb2RlcmF0b3InKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkZXNjX3BhcnRpY2lwYW50JzogX18oJ1RoaXMgdXNlciBjYW4gc2VuZCBtZXNzYWdlcyBpbiB0aGlzIHJvb20nKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkZXNjX3Zpc2l0b3InOiBfXygnVGhpcyB1c2VyIGNhbiBOT1Qgc2VuZCBtZXNzYWdlcyBpbiB0aGlzIHJvb20nKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgdGhpcy4kZWwucmVwbGFjZVdpdGgoJG5ldyk7CiAgICAgICAgICAgICAgICB0aGlzLnNldEVsZW1lbnQoJG5ldywgdHJ1ZSk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHRoaXMuJGVsLnJlbW92ZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIHRoaXMuQ2hhdFJvb21PY2N1cGFudHMgPSBCYWNrYm9uZS5Db2xsZWN0aW9uLmV4dGVuZCh7CiAgICAgICAgICAgIG1vZGVsOiBjb252ZXJzZS5DaGF0Um9vbU9jY3VwYW50LAogICAgICAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbiAob3B0aW9ucykgewogICAgICAgICAgICAgICAgdGhpcy5icm93c2VyU3RvcmFnZSA9IG5ldyBCYWNrYm9uZS5Ccm93c2VyU3RvcmFnZVtjb252ZXJzZS5zdG9yYWdlXSgKICAgICAgICAgICAgICAgICAgICBiNjRfc2hhMSgnY29udmVyc2Uub2NjdXBhbnRzJytjb252ZXJzZS5iYXJlX2ppZCtvcHRpb25zLm5pY2spKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICB0aGlzLkNoYXRSb29tT2NjdXBhbnRzVmlldyA9IEJhY2tib25lLk92ZXJ2aWV3LmV4dGVuZCh7CiAgICAgICAgICAgIHRhZ05hbWU6ICdkaXYnLAogICAgICAgICAgICBjbGFzc05hbWU6ICdwYXJ0aWNpcGFudHMnLAoKICAgICAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5vbigiYWRkIiwgdGhpcy5vbk9jY3VwYW50QWRkZWQsIHRoaXMpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRlbC5odG1sKAogICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLnRlbXBsYXRlcy5jaGF0cm9vbV9zaWRlYmFyKHsKICAgICAgICAgICAgICAgICAgICAgICAgJ2xhYmVsX2ludml0YXRpb24nOiBfXygnSW52aXRlLi4uJyksCiAgICAgICAgICAgICAgICAgICAgICAgICdsYWJlbF9vY2N1cGFudHMnOiBfXygnT2NjdXBhbnRzJykKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmluaXRJbnZpdGVXaWRnZXQoKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIG9uT2NjdXBhbnRBZGRlZDogZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgIHZhciB2aWV3ID0gdGhpcy5nZXQoaXRlbS5nZXQoJ2lkJykpOwogICAgICAgICAgICAgICAgaWYgKCF2aWV3KSB7CiAgICAgICAgICAgICAgICAgICAgdmlldyA9IHRoaXMuYWRkKGl0ZW0uZ2V0KCdpZCcpLCBuZXcgY29udmVyc2UuQ2hhdFJvb21PY2N1cGFudFZpZXcoe21vZGVsOiBpdGVtfSkpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBkZWxldGUgdmlldy5tb2RlbDsgLy8gUmVtb3ZlIHJlZiB0byBvbGQgbW9kZWwgdG8gaGVscCBnYXJiYWdlIGNvbGxlY3Rpb24KICAgICAgICAgICAgICAgICAgICB2aWV3Lm1vZGVsID0gaXRlbTsKICAgICAgICAgICAgICAgICAgICB2aWV3LmluaXRpYWxpemUoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuJCgnLnBhcnRpY2lwYW50LWxpc3QnKS5hcHBlbmQodmlldy5yZW5kZXIoKS4kZWwpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgb25DaGF0Um9vbVJvc3RlcjogZnVuY3Rpb24gKHJvc3Rlciwgcm9vbSkgewogICAgICAgICAgICAgICAgdmFyIHJvc3Rlcl9zaXplID0gXy5zaXplKHJvc3RlciksCiAgICAgICAgICAgICAgICAgICAgJHBhcnRpY2lwYW50X2xpc3QgPSB0aGlzLiQoJy5wYXJ0aWNpcGFudC1saXN0JyksCiAgICAgICAgICAgICAgICAgICAgcGFydGljaXBhbnRzID0gW10sCiAgICAgICAgICAgICAgICAgICAga2V5cyA9IF8ua2V5cyhyb3N0ZXIpLAogICAgICAgICAgICAgICAgICAgIG9jY3VwYW50LCBhdHRycywgaSwgbmljazsKCiAgICAgICAgICAgICAgICBmb3IgKGk9MDsgaTxyb3N0ZXJfc2l6ZTsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgbmljayA9IFN0cm9waGUudW5lc2NhcGVOb2RlKGtleXNbaV0pOwogICAgICAgICAgICAgICAgICAgIGF0dHJzID0gewogICAgICAgICAgICAgICAgICAgICAgICAnaWQnOiBuaWNrLAogICAgICAgICAgICAgICAgICAgICAgICAncm9sZSc6IHJvc3RlcltrZXlzW2ldXS5yb2xlLAogICAgICAgICAgICAgICAgICAgICAgICAnbmljayc6IG5pY2sKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIG9jY3VwYW50ID0gdGhpcy5tb2RlbC5nZXQobmljayk7CiAgICAgICAgICAgICAgICAgICAgaWYgKG9jY3VwYW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9jY3VwYW50LnNhdmUoYXR0cnMpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuY3JlYXRlKGF0dHJzKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBfLmVhY2goXy5kaWZmZXJlbmNlKHRoaXMubW9kZWwucGx1Y2soJ2lkJyksIGtleXMpLCBmdW5jdGlvbiAoaWQpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLmdldChpZCkuZGVzdHJveSgpOwogICAgICAgICAgICAgICAgfSwgdGhpcyk7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGluaXRJbnZpdGVXaWRnZXQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciAkZWwgPSB0aGlzLiQoJ2lucHV0Lmludml0ZWQtY29udGFjdCcpOwogICAgICAgICAgICAgICAgJGVsLnR5cGVhaGVhZCh7CiAgICAgICAgICAgICAgICAgICAgbWluTGVuZ3RoOiAxLAogICAgICAgICAgICAgICAgICAgIGhpZ2hsaWdodDogdHJ1ZQogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICdjb250YWN0cy1kYXRhc2V0JywKICAgICAgICAgICAgICAgICAgICBzb3VyY2U6IGZ1bmN0aW9uIChxLCBjYikgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVzdWx0cyA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICBfLmVhY2goY29udmVyc2Uucm9zdGVyLmZpbHRlcihjb250YWlucyhbJ2Z1bGxuYW1lJywgJ2ppZCddLCBxKSksIGZ1bmN0aW9uIChuKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRzLnB1c2goe3ZhbHVlOiBuLmdldCgnZnVsbG5hbWUnKSwgamlkOiBuLmdldCgnamlkJyl9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNiKHJlc3VsdHMpOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN1Z2dlc3Rpb246IF8udGVtcGxhdGUoJzxwIGRhdGEtamlkPSJ7e2ppZH19Ij57e3ZhbHVlfX08L3A+JykKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICRlbC5vbigndHlwZWFoZWFkOnNlbGVjdGVkJywgJC5wcm94eShmdW5jdGlvbiAoZXYsIHN1Z2dlc3Rpb24sIGRuYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHJlYXNvbiA9IHByb21wdCgKICAgICAgICAgICAgICAgICAgICAgICAgX18oX19fKCdZb3UgYXJlIGFib3V0IHRvIGludml0ZSAlMSRzIHRvIHRoZSBjaGF0IHJvb20gIiUyJHMiLiAnKSwgc3VnZ2VzdGlvbi52YWx1ZSwgdGhpcy5tb2RlbC5nZXQoJ2lkJykpICsKICAgICAgICAgICAgICAgICAgICAgICAgX18oIllvdSBtYXkgb3B0aW9uYWxseSBpbmNsdWRlIGEgbWVzc2FnZSwgZXhwbGFpbmluZyB0aGUgcmVhc29uIGZvciB0aGUgaW52aXRhdGlvbi4iKQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlYXNvbiAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS5jb25uZWN0aW9uLm11Yy5yb29tc1t0aGlzLmNoYXRyb29tdmlldy5tb2RlbC5nZXQoJ2lkJyldLmRpcmVjdEludml0ZShzdWdnZXN0aW9uLmppZCwgcmVhc29uKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29udmVyc2UuZW1pdCgncm9vbUludml0ZVNlbnQnLCB0aGlzLCBzdWdnZXN0aW9uLmppZCwgcmVhc29uKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJChldi50YXJnZXQpLnR5cGVhaGVhZCgndmFsJywgJycpOwogICAgICAgICAgICAgICAgfSwgdGhpcykpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0KCiAgICAgICAgfSk7CgogICAgICAgIHRoaXMuQ2hhdFJvb21WaWV3ID0gY29udmVyc2UuQ2hhdEJveFZpZXcuZXh0ZW5kKHsKICAgICAgICAgICAgbGVuZ3RoOiAzMDAsCiAgICAgICAgICAgIHRhZ05hbWU6ICdkaXYnLAogICAgICAgICAgICBjbGFzc05hbWU6ICdjaGF0cm9vbScsCiAgICAgICAgICAgIGV2ZW50czogewogICAgICAgICAgICAgICAgJ2NsaWNrIC5jbG9zZS1jaGF0Ym94LWJ1dHRvbic6ICdjbG9zZScsCiAgICAgICAgICAgICAgICAnY2xpY2sgLnRvZ2dsZS1jaGF0Ym94LWJ1dHRvbic6ICdtaW5pbWl6ZScsCiAgICAgICAgICAgICAgICAnY2xpY2sgLmNvbmZpZ3VyZS1jaGF0cm9vbS1idXR0b24nOiAnY29uZmlndXJlQ2hhdFJvb20nLAogICAgICAgICAgICAgICAgJ2NsaWNrIC50b2dnbGUtc21pbGV5JzogJ3RvZ2dsZUVtb3RpY29uTWVudScsCiAgICAgICAgICAgICAgICAnY2xpY2sgLnRvZ2dsZS1zbWlsZXkgdWwgbGknOiAnaW5zZXJ0RW1vdGljb24nLAogICAgICAgICAgICAgICAgJ2NsaWNrIC50b2dnbGUtY2xlYXInOiAnY2xlYXJDaGF0Um9vbU1lc3NhZ2VzJywKICAgICAgICAgICAgICAgICdjbGljayAudG9nZ2xlLXBhcnRpY2lwYW50cyBhJzogJ3RvZ2dsZU9jY3VwYW50cycsCiAgICAgICAgICAgICAgICAna2V5cHJlc3MgdGV4dGFyZWEuY2hhdC10ZXh0YXJlYSc6ICdrZXlQcmVzc2VkJywKICAgICAgICAgICAgICAgICdtb3VzZWRvd24gLmRyYWdyZXNpemUtdG0nOiAnb25EcmFnUmVzaXplU3RhcnQnCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGlzX2NoYXRyb29tOiB0cnVlLAoKICAgICAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5tZXNzYWdlcy5vbignYWRkJywgdGhpcy5vbk1lc3NhZ2VBZGRlZCwgdGhpcyk7CiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLm9uKCdjaGFuZ2U6bWluaW1pemVkJywgZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5nZXQoJ21pbmltaXplZCcpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaGlkZSgpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubWF4aW1pemUoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCB0aGlzKTsKICAgICAgICAgICAgICAgIHRoaXMubW9kZWwub24oJ2Rlc3Ryb3knLCBmdW5jdGlvbiAobW9kZWwsIHJlc3BvbnNlLCBvcHRpb25zKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5oaWRlKCk7CiAgICAgICAgICAgICAgICAgICAgY29udmVyc2UuY29ubmVjdGlvbi5tdWMubGVhdmUoCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuZ2V0KCdqaWQnKSwKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5nZXQoJ25pY2snKSwKICAgICAgICAgICAgICAgICAgICAgICAgJC5wcm94eSh0aGlzLm9uTGVhdmUsIHRoaXMpLAogICAgICAgICAgICAgICAgICAgICAgICB1bmRlZmluZWQpOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHRoaXMpOwoKICAgICAgICAgICAgICAgIHRoaXMub2NjdXBhbnRzdmlldyA9IG5ldyBjb252ZXJzZS5DaGF0Um9vbU9jY3VwYW50c1ZpZXcoewogICAgICAgICAgICAgICAgICAgIG1vZGVsOiBuZXcgY29udmVyc2UuQ2hhdFJvb21PY2N1cGFudHMoe25pY2s6IHRoaXMubW9kZWwuZ2V0KCduaWNrJyl9KQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB0aGlzLm9jY3VwYW50c3ZpZXcuY2hhdHJvb212aWV3ID0gdGhpczsKICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyKCk7CiAgICAgICAgICAgICAgICB0aGlzLm9jY3VwYW50c3ZpZXcubW9kZWwuZmV0Y2goe2FkZDp0cnVlfSk7CiAgICAgICAgICAgICAgICB0aGlzLmNvbm5lY3QobnVsbCk7CiAgICAgICAgICAgICAgICBjb252ZXJzZS5lbWl0KCdjaGF0Um9vbU9wZW5lZCcsIHRoaXMpOwoKICAgICAgICAgICAgICAgIHRoaXMuJGVsLmluc2VydEFmdGVyKGNvbnZlcnNlLmNoYXRib3h2aWV3cy5nZXQoImNvbnRyb2xib3giKS4kZWwpOwogICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5tZXNzYWdlcy5mZXRjaCh7YWRkOiB0cnVlfSk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5tb2RlbC5nZXQoJ21pbmltaXplZCcpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5oaWRlKCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvdygpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRlbC5hdHRyKCdpZCcsIHRoaXMubW9kZWwuZ2V0KCdib3hfaWQnKSkKICAgICAgICAgICAgICAgICAgICAgICAgLmh0bWwoY29udmVyc2UudGVtcGxhdGVzLmNoYXRyb29tKHRoaXMubW9kZWwudG9KU09OKCkpKTsKICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyQ2hhdEFyZWEoKTsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLnJlZnJlc2hXZWJraXQoKTsKICAgICAgICAgICAgICAgIH0sIDUwKTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgcmVuZGVyQ2hhdEFyZWE6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGlmICghdGhpcy4kKCcuY2hhdC1hcmVhJykubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kKCcuY2hhdC1ib2R5JykuZW1wdHkoKQogICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udmVyc2UudGVtcGxhdGVzLmNoYXRhcmVhKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc2hvd190b29sYmFyJzogY29udmVyc2Uuc2hvd190b29sYmFyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdsYWJlbF9tZXNzYWdlJzogX18oJ01lc3NhZ2UnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpCiAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQodGhpcy5vY2N1cGFudHN2aWV3LnJlbmRlcigpLiRlbCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJUb29sYmFyKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBYWFg6IFRoaXMgaXMgYSBiaXQgb2YgYSBoYWNrLCB0byBtYWtlIHN1cmUgdGhhdCB0aGUKICAgICAgICAgICAgICAgIC8vIHNpZGViYXIncyBzdGF0ZSBpcyByZW1lbWJlcmVkLgogICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5zZXQoe2hpZGRlbl9vY2N1cGFudHM6ICF0aGlzLm1vZGVsLmdldCgnaGlkZGVuX29jY3VwYW50cycpfSk7CiAgICAgICAgICAgICAgICB0aGlzLnRvZ2dsZU9jY3VwYW50cygpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICB0b2dnbGVPY2N1cGFudHM6IGZ1bmN0aW9uIChldikgewogICAgICAgICAgICAgICAgaWYgKGV2KSB7CiAgICAgICAgICAgICAgICAgICAgZXYucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgICAgICBldi5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHZhciAkZWwgPSB0aGlzLiQoJy5pY29uLWhpZGUtdXNlcnMnKTsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5tb2RlbC5nZXQoJ2hpZGRlbl9vY2N1cGFudHMnKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuc2F2ZSh7aGlkZGVuX29jY3VwYW50czogdHJ1ZX0pOwogICAgICAgICAgICAgICAgICAgICRlbC5yZW1vdmVDbGFzcygnaWNvbi1oaWRlLXVzZXJzJykuYWRkQ2xhc3MoJ2ljb24tc2hvdy11c2VycycpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuJCgnZm9ybS5zZW5kWE1QUE1lc3NhZ2UsIC5jaGF0LWFyZWEnKS5hbmltYXRlKHt3aWR0aDogJzEwMCUnfSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kKCdkaXYucGFydGljaXBhbnRzJykuYW5pbWF0ZSh7d2lkdGg6IDB9LCAkLnByb3h5KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zY3JvbGxEb3duKCk7CiAgICAgICAgICAgICAgICAgICAgfSwgdGhpcykpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLnNhdmUoe2hpZGRlbl9vY2N1cGFudHM6IGZhbHNlfSk7CiAgICAgICAgICAgICAgICAgICAgJGVsLnJlbW92ZUNsYXNzKCdpY29uLXNob3ctdXNlcnMnKS5hZGRDbGFzcygnaWNvbi1oaWRlLXVzZXJzJyk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kKCcuY2hhdC1hcmVhLCBmb3JtLnNlbmRYTVBQTWVzc2FnZScpLmNzcyh7d2lkdGg6ICcnfSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kKCdkaXYucGFydGljaXBhbnRzJykuc2hvdygpLmFuaW1hdGUoe3dpZHRoOiAnYXV0byd9LCAkLnByb3h5KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zY3JvbGxEb3duKCk7CiAgICAgICAgICAgICAgICAgICAgfSwgdGhpcykpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgb25Db21tYW5kRXJyb3I6IGZ1bmN0aW9uIChzdGFuemEpIHsKICAgICAgICAgICAgICAgIHRoaXMuc2hvd1N0YXR1c05vdGlmaWNhdGlvbihfXygiRXJyb3I6IGNvdWxkIG5vdCBleGVjdXRlIHRoZSBjb21tYW5kIiksIHRydWUpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgY3JlYXRlQ2hhdFJvb21NZXNzYWdlOiBmdW5jdGlvbiAodGV4dCkgewogICAgICAgICAgICAgICAgdmFyIGZ1bGxuYW1lID0gY29udmVyc2UueG1wcHN0YXR1cy5nZXQoJ2Z1bGxuYW1lJyk7CiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLm1lc3NhZ2VzLmNyZWF0ZSh7CiAgICAgICAgICAgICAgICAgICAgZnVsbG5hbWU6IF8uaXNFbXB0eShmdWxsbmFtZSk/IGNvbnZlcnNlLmJhcmVfamlkOiBmdWxsbmFtZSwKICAgICAgICAgICAgICAgICAgICBzZW5kZXI6ICdtZScsCiAgICAgICAgICAgICAgICAgICAgdGltZTogbW9tZW50KCkuZm9ybWF0KCksCiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogdGV4dCwKICAgICAgICAgICAgICAgICAgICBtc2dpZDogY29udmVyc2UuY29ubmVjdGlvbi5tdWMuZ3JvdXBjaGF0KHRoaXMubW9kZWwuZ2V0KCdqaWQnKSwgdGV4dCwgdW5kZWZpbmVkLCBTdHJpbmcoKG5ldyBEYXRlKCkpLmdldFRpbWUoKSkpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHNlbmRDaGF0Um9vbU1lc3NhZ2U6IGZ1bmN0aW9uICh0ZXh0KSB7CiAgICAgICAgICAgICAgICB2YXIgbWF0Y2ggPSB0ZXh0LnJlcGxhY2UoL15ccyovLCAiIikubWF0Y2goL15cLyguKj8pKD86ICguKikpPyQvKSB8fCBbZmFsc2VdLCBhcmdzOwogICAgICAgICAgICAgICAgc3dpdGNoIChtYXRjaFsxXSkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgJ2Jhbic6CiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MgPSBtYXRjaFsyXS5zcGxpdE9uY2UoJyAnKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29udmVyc2UuY29ubmVjdGlvbi5tdWMuYmFuKHRoaXMubW9kZWwuZ2V0KCdqaWQnKSwgYXJnc1swXSwgYXJnc1sxXSwgdW5kZWZpbmVkLCAkLnByb3h5KHRoaXMub25Db21tYW5kRXJyb3IsIHRoaXMpKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnY2xlYXInOgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNsZWFyQ2hhdFJvb21NZXNzYWdlcygpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICdkZW9wJzoKICAgICAgICAgICAgICAgICAgICAgICAgYXJncyA9IG1hdGNoWzJdLnNwbGl0T25jZSgnICcpOwogICAgICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS5jb25uZWN0aW9uLm11Yy5kZW9wKHRoaXMubW9kZWwuZ2V0KCdqaWQnKSwgYXJnc1swXSwgYXJnc1sxXSwgdW5kZWZpbmVkLCAkLnByb3h5KHRoaXMub25Db21tYW5kRXJyb3IsIHRoaXMpKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnaGVscCc6CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0hlbHBNZXNzYWdlcyhbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPHN0cm9uZz4vYmFuPC9zdHJvbmc+OiAnICAgK19fKCdCYW4gdXNlciBmcm9tIHJvb20nKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8c3Ryb25nPi9jbGVhcjwvc3Ryb25nPjogJyArX18oJ1JlbW92ZSBtZXNzYWdlcycpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxzdHJvbmc+L2hlbHA8L3N0cm9uZz46ICcgICtfXygnU2hvdyB0aGlzIG1lbnUnKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8c3Ryb25nPi9raWNrPC9zdHJvbmc+OiAnICArX18oJ0tpY2sgdXNlciBmcm9tIHJvb20nKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8c3Ryb25nPi9tZTwvc3Ryb25nPjogJyAgICArX18oJ1dyaXRlIGluIDNyZCBwZXJzb24nKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8c3Ryb25nPi9tdXRlPC9zdHJvbmc+OiAnICArX18oIlJlbW92ZSB1c2VyJ3MgYWJpbGl0eSB0byBwb3N0IG1lc3NhZ2VzIiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPHN0cm9uZz4vbmljazwvc3Ryb25nPjogJyAgK19fKCdDaGFuZ2UgeW91ciBuaWNrbmFtZScpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxzdHJvbmc+L3RvcGljPC9zdHJvbmc+OiAnICtfXygnU2V0IHJvb20gdG9waWMnKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8c3Ryb25nPi92b2ljZTwvc3Ryb25nPjogJyArX18oJ0FsbG93IG11dGVkIHVzZXIgdG8gcG9zdCBtZXNzYWdlcycpCiAgICAgICAgICAgICAgICAgICAgICAgIF0pOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICdraWNrJzoKICAgICAgICAgICAgICAgICAgICAgICAgYXJncyA9IG1hdGNoWzJdLnNwbGl0T25jZSgnICcpOwogICAgICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS5jb25uZWN0aW9uLm11Yy5raWNrKHRoaXMubW9kZWwuZ2V0KCdqaWQnKSwgYXJnc1swXSwgYXJnc1sxXSwgdW5kZWZpbmVkLCAkLnByb3h5KHRoaXMub25Db21tYW5kRXJyb3IsIHRoaXMpKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnbXV0ZSc6CiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MgPSBtYXRjaFsyXS5zcGxpdE9uY2UoJyAnKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29udmVyc2UuY29ubmVjdGlvbi5tdWMubXV0ZSh0aGlzLm1vZGVsLmdldCgnamlkJyksIGFyZ3NbMF0sIGFyZ3NbMV0sIHVuZGVmaW5lZCwgJC5wcm94eSh0aGlzLm9uQ29tbWFuZEVycm9yLCB0aGlzKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgJ25pY2snOgogICAgICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS5jb25uZWN0aW9uLm11Yy5jaGFuZ2VOaWNrKHRoaXMubW9kZWwuZ2V0KCdqaWQnKSwgbWF0Y2hbMl0pOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICdvcCc6CiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MgPSBtYXRjaFsyXS5zcGxpdE9uY2UoJyAnKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29udmVyc2UuY29ubmVjdGlvbi5tdWMub3AodGhpcy5tb2RlbC5nZXQoJ2ppZCcpLCBhcmdzWzBdLCBhcmdzWzFdLCB1bmRlZmluZWQsICQucHJveHkodGhpcy5vbkNvbW1hbmRFcnJvciwgdGhpcykpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICd0b3BpYyc6CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLmNvbm5lY3Rpb24ubXVjLnNldFRvcGljKHRoaXMubW9kZWwuZ2V0KCdqaWQnKSwgbWF0Y2hbMl0pOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICd2b2ljZSc6CiAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MgPSBtYXRjaFsyXS5zcGxpdE9uY2UoJyAnKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29udmVyc2UuY29ubmVjdGlvbi5tdWMudm9pY2UodGhpcy5tb2RlbC5nZXQoJ2ppZCcpLCBhcmdzWzBdLCBhcmdzWzFdLCB1bmRlZmluZWQsICQucHJveHkodGhpcy5vbkNvbW1hbmRFcnJvciwgdGhpcykpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNyZWF0ZUNoYXRSb29tTWVzc2FnZSh0ZXh0KTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGNvbm5lY3Q6IGZ1bmN0aW9uIChwYXNzd29yZCkgewogICAgICAgICAgICAgICAgaWYgKF8uaGFzKGNvbnZlcnNlLmNvbm5lY3Rpb24ubXVjLnJvb21zLCB0aGlzLm1vZGVsLmdldCgnamlkJykpKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlIHJvb20gZXhpc3RzLCBpdCBhbHJlYWR5IGhhcyBldmVudCBsaXN0ZW5lcnMsIHNvIHdlCiAgICAgICAgICAgICAgICAgICAgLy8gZG9uJ3QgYWRkIHRoZW0gYWdhaW4uCiAgICAgICAgICAgICAgICAgICAgY29udmVyc2UuY29ubmVjdGlvbi5tdWMuam9pbigKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5nZXQoJ2ppZCcpLCB0aGlzLm1vZGVsLmdldCgnbmljaycpLCBudWxsLCBudWxsLCBudWxsLCBwYXNzd29yZCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLmNvbm5lY3Rpb24ubXVjLmpvaW4oCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuZ2V0KCdqaWQnKSwKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5nZXQoJ25pY2snKSwKICAgICAgICAgICAgICAgICAgICAgICAgJC5wcm94eSh0aGlzLm9uQ2hhdFJvb21NZXNzYWdlLCB0aGlzKSwKICAgICAgICAgICAgICAgICAgICAgICAgJC5wcm94eSh0aGlzLm9uQ2hhdFJvb21QcmVzZW5jZSwgdGhpcyksCiAgICAgICAgICAgICAgICAgICAgICAgICQucHJveHkodGhpcy5vbkNoYXRSb29tUm9zdGVyLCB0aGlzKSwKICAgICAgICAgICAgICAgICAgICAgICAgcGFzc3dvcmQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgb25MZWF2ZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5zZXQoJ2Nvbm5lY3RlZCcsIGZhbHNlKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHJlbmRlckNvbmZpZ3VyYXRpb25Gb3JtOiBmdW5jdGlvbiAoc3RhbnphKSB7CiAgICAgICAgICAgICAgICB2YXIgJGZvcm09IHRoaXMuJGVsLmZpbmQoJ2Zvcm0uY2hhdHJvb20tZm9ybScpLAogICAgICAgICAgICAgICAgICAgICRzdGFuemEgPSAkKHN0YW56YSksCiAgICAgICAgICAgICAgICAgICAgJGZpZWxkcyA9ICRzdGFuemEuZmluZCgnZmllbGQnKSwKICAgICAgICAgICAgICAgICAgICB0aXRsZSA9ICRzdGFuemEuZmluZCgndGl0bGUnKS50ZXh0KCksCiAgICAgICAgICAgICAgICAgICAgaW5zdHJ1Y3Rpb25zID0gJHN0YW56YS5maW5kKCdpbnN0cnVjdGlvbnMnKS50ZXh0KCksCiAgICAgICAgICAgICAgICAgICAgaSwgaiwgb3B0aW9ucz1bXSwgJGZpZWxkLCAkb3B0aW9uczsKICAgICAgICAgICAgICAgIHZhciBpbnB1dF90eXBlcyA9IHsKICAgICAgICAgICAgICAgICAgICAndGV4dC1wcml2YXRlJzogJ3Bhc3N3b3JkJywKICAgICAgICAgICAgICAgICAgICAndGV4dC1zaW5nbGUnOiAndGV4dGxpbmUnLAogICAgICAgICAgICAgICAgICAgICdib29sZWFuJzogJ2NoZWNrYm94JywKICAgICAgICAgICAgICAgICAgICAnaGlkZGVuJzogJ2hpZGRlbicsCiAgICAgICAgICAgICAgICAgICAgJ2xpc3Qtc2luZ2xlJzogJ2Ryb3Bkb3duJwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICRmb3JtLmZpbmQoJ3NwYW4uc3Bpbm5lcicpLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgJGZvcm0uYXBwZW5kKCQoJzxsZWdlbmQ+JykudGV4dCh0aXRsZSkpOwogICAgICAgICAgICAgICAgaWYgKGluc3RydWN0aW9ucyAhPSB0aXRsZSkgewogICAgICAgICAgICAgICAgICAgICRmb3JtLmFwcGVuZCgkKCc8cD4nKS50ZXh0KGluc3RydWN0aW9ucykpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZm9yIChpPTA7IGk8JGZpZWxkcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgICRmaWVsZCA9ICQoJGZpZWxkc1tpXSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCRmaWVsZC5hdHRyKCd0eXBlJykgPT0gJ2xpc3Qtc2luZ2xlJykgewogICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zID0gW107CiAgICAgICAgICAgICAgICAgICAgICAgICRvcHRpb25zID0gJGZpZWxkLmZpbmQoJ29wdGlvbicpOwogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGo9MDsgajwkb3B0aW9ucy5sZW5ndGg7IGorKykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5wdXNoKGNvbnZlcnNlLnRlbXBsYXRlcy5zZWxlY3Rfb3B0aW9uKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogJCgkb3B0aW9uc1tqXSkuZmluZCgndmFsdWUnKS50ZXh0KCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICQoJG9wdGlvbnNbal0pLmF0dHIoJ2xhYmVsJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAkZm9ybS5hcHBlbmQoY29udmVyc2UudGVtcGxhdGVzLmZvcm1fc2VsZWN0KHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICRmaWVsZC5hdHRyKCd2YXInKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiAkZmllbGQuYXR0cignbGFiZWwnKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnM6IG9wdGlvbnMuam9pbignJykKICAgICAgICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoJGZpZWxkLmF0dHIoJ3R5cGUnKSA9PSAnYm9vbGVhbicpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGZvcm0uYXBwZW5kKGNvbnZlcnNlLnRlbXBsYXRlcy5mb3JtX2NoZWNrYm94KHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICRmaWVsZC5hdHRyKCd2YXInKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IGlucHV0X3R5cGVzWyRmaWVsZC5hdHRyKCd0eXBlJyldLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICRmaWVsZC5hdHRyKCdsYWJlbCcpIHx8ICcnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tlZDogJGZpZWxkLmZpbmQoJ3ZhbHVlJykudGV4dCgpID09PSAiMSIgJiYgJ2NoZWNrZWQ9IjEiJyB8fCAnJwogICAgICAgICAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGZvcm0uYXBwZW5kKGNvbnZlcnNlLnRlbXBsYXRlcy5mb3JtX2lucHV0KHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICRmaWVsZC5hdHRyKCd2YXInKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IGlucHV0X3R5cGVzWyRmaWVsZC5hdHRyKCd0eXBlJyldLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICRmaWVsZC5hdHRyKCdsYWJlbCcpIHx8ICcnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6ICRmaWVsZC5maW5kKCd2YWx1ZScpLnRleHQoKQogICAgICAgICAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJGZvcm0uYXBwZW5kKCc8aW5wdXQgdHlwZT0ic3VibWl0IiB2YWx1ZT0iJytfXygnU2F2ZScpKyciLz4nKTsKICAgICAgICAgICAgICAgICRmb3JtLmFwcGVuZCgnPGlucHV0IHR5cGU9ImJ1dHRvbiIgdmFsdWU9IicrX18oJ0NhbmNlbCcpKyciLz4nKTsKICAgICAgICAgICAgICAgICRmb3JtLm9uKCdzdWJtaXQnLCAkLnByb3h5KHRoaXMuc2F2ZUNvbmZpZ3VyYXRpb24sIHRoaXMpKTsKICAgICAgICAgICAgICAgICRmb3JtLmZpbmQoJ2lucHV0W3R5cGU9YnV0dG9uXScpLm9uKCdjbGljaycsICQucHJveHkodGhpcy5jYW5jZWxDb25maWd1cmF0aW9uLCB0aGlzKSk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBzYXZlQ29uZmlndXJhdGlvbjogZnVuY3Rpb24gKGV2KSB7CiAgICAgICAgICAgICAgICBldi5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzOwogICAgICAgICAgICAgICAgdmFyICRpbnB1dHMgPSAkKGV2LnRhcmdldCkuZmluZCgnOmlucHV0Om5vdChbdHlwZT1idXR0b25dKTpub3QoW3R5cGU9c3VibWl0XSknKSwKICAgICAgICAgICAgICAgICAgICBjb3VudCA9ICRpbnB1dHMubGVuZ3RoLAogICAgICAgICAgICAgICAgICAgIGNvbmZpZ0FycmF5ID0gW107CiAgICAgICAgICAgICAgICAkaW5wdXRzLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIHZhciAkaW5wdXQgPSAkKHRoaXMpLCB2YWx1ZTsKICAgICAgICAgICAgICAgICAgICBpZiAoJGlucHV0LmlzKCdbdHlwZT1jaGVja2JveF0nKSkgewogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9ICRpbnB1dC5pcygnOmNoZWNrZWQnKSAmJiAxIHx8IDA7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSAkaW5wdXQudmFsKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHZhciBjbm9kZSA9ICQoY29udmVyc2UudGVtcGxhdGVzLmZpZWxkKHsKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogJGlucHV0LmF0dHIoJ25hbWUnKSwKICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlCiAgICAgICAgICAgICAgICAgICAgfSkpWzBdOwogICAgICAgICAgICAgICAgICAgIGNvbmZpZ0FycmF5LnB1c2goY25vZGUpOwogICAgICAgICAgICAgICAgICAgIGlmICghLS1jb3VudCkgewogICAgICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS5jb25uZWN0aW9uLm11Yy5zYXZlQ29uZmlndXJhdGlvbigKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQubW9kZWwuZ2V0KCdqaWQnKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZ0FycmF5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJC5wcm94eSh0aGF0Lm9uQ29uZmlnU2F2ZWQsIHRoYXQpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJC5wcm94eSh0aGF0Lm9uRXJyb3JDb25maWdTYXZlZCwgdGhhdCkKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHRoaXMuJGVsLmZpbmQoJ2Rpdi5jaGF0cm9vbS1mb3JtLWNvbnRhaW5lcicpLmhpZGUoCiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGF0LiRlbC5maW5kKCcuY2hhdC1hcmVhJykuc2hvdygpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGF0LiRlbC5maW5kKCcucGFydGljaXBhbnRzJykuc2hvdygpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgb25Db25maWdTYXZlZDogZnVuY3Rpb24gKHN0YW56YSkgewogICAgICAgICAgICAgICAgLy8gWFhYCiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBvbkVycm9yQ29uZmlnU2F2ZWQ6IGZ1bmN0aW9uIChzdGFuemEpIHsKICAgICAgICAgICAgICAgIHRoaXMuc2hvd1N0YXR1c05vdGlmaWNhdGlvbihfXygiQW4gZXJyb3Igb2NjdXJyZWQgd2hpbGUgdHJ5aW5nIHRvIHNhdmUgdGhlIGZvcm0uIikpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgY2FuY2VsQ29uZmlndXJhdGlvbjogZnVuY3Rpb24gKGV2KSB7CiAgICAgICAgICAgICAgICBldi5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzOwogICAgICAgICAgICAgICAgdGhpcy4kZWwuZmluZCgnZGl2LmNoYXRyb29tLWZvcm0tY29udGFpbmVyJykuaGlkZSgKICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuJGVsLmZpbmQoJy5jaGF0LWFyZWEnKS5zaG93KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuJGVsLmZpbmQoJy5wYXJ0aWNpcGFudHMnKS5zaG93KCk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBjb25maWd1cmVDaGF0Um9vbTogZnVuY3Rpb24gKGV2KSB7CiAgICAgICAgICAgICAgICBldi5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuJGVsLmZpbmQoJ2Rpdi5jaGF0cm9vbS1mb3JtLWNvbnRhaW5lcicpLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuJCgnLmNoYXQtYm9keScpLmNoaWxkcmVuKCkuaGlkZSgpOwogICAgICAgICAgICAgICAgdGhpcy4kKCcuY2hhdC1ib2R5JykuYXBwZW5kKAogICAgICAgICAgICAgICAgICAgICQoJzxkaXYgY2xhc3M9ImNoYXRyb29tLWZvcm0tY29udGFpbmVyIj4nKwogICAgICAgICAgICAgICAgICAgICAgICAnPGZvcm0gY2xhc3M9ImNoYXRyb29tLWZvcm0iPicrCiAgICAgICAgICAgICAgICAgICAgICAgICc8c3BhbiBjbGFzcz0ic3Bpbm5lciBjZW50ZXJlZCIvPicrCiAgICAgICAgICAgICAgICAgICAgICAgICc8L2Zvcm0+JysKICAgICAgICAgICAgICAgICAgICAnPC9kaXY+JykpOwogICAgICAgICAgICAgICAgY29udmVyc2UuY29ubmVjdGlvbi5tdWMuY29uZmlndXJlKAogICAgICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuZ2V0KCdqaWQnKSwKICAgICAgICAgICAgICAgICAgICAkLnByb3h5KHRoaXMucmVuZGVyQ29uZmlndXJhdGlvbkZvcm0sIHRoaXMpCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgc3VibWl0UGFzc3dvcmQ6IGZ1bmN0aW9uIChldikgewogICAgICAgICAgICAgICAgZXYucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgIHZhciBwYXNzd29yZCA9IHRoaXMuJGVsLmZpbmQoJy5jaGF0cm9vbS1mb3JtJykuZmluZCgnaW5wdXRbdHlwZT1wYXNzd29yZF0nKS52YWwoKTsKICAgICAgICAgICAgICAgIHRoaXMuJGVsLmZpbmQoJy5jaGF0cm9vbS1mb3JtLWNvbnRhaW5lcicpLnJlcGxhY2VXaXRoKCc8c3BhbiBjbGFzcz0ic3Bpbm5lciBjZW50ZXJlZCIvPicpOwogICAgICAgICAgICAgICAgdGhpcy5jb25uZWN0KHBhc3N3b3JkKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHJlbmRlclBhc3N3b3JkRm9ybTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdGhpcy4kKCcuY2hhdC1ib2R5JykuY2hpbGRyZW4oKS5oaWRlKCk7CiAgICAgICAgICAgICAgICB0aGlzLiQoJ3NwYW4uY2VudGVyZWQuc3Bpbm5lcicpLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgdGhpcy4kKCcuY2hhdC1ib2R5JykuYXBwZW5kKAogICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLnRlbXBsYXRlcy5jaGF0cm9vbV9wYXNzd29yZF9mb3JtKHsKICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGluZzogX18oJ1RoaXMgY2hhdHJvb20gcmVxdWlyZXMgYSBwYXNzd29yZCcpLAogICAgICAgICAgICAgICAgICAgICAgICBsYWJlbF9wYXNzd29yZDogX18oJ1Bhc3N3b3JkOiAnKSwKICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWxfc3VibWl0OiBfXygnU3VibWl0JykKICAgICAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgICB0aGlzLiQoJy5jaGF0cm9vbS1mb3JtJykub24oJ3N1Ym1pdCcsICQucHJveHkodGhpcy5zdWJtaXRQYXNzd29yZCwgdGhpcykpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgc2hvd0Rpc2Nvbm5lY3RNZXNzYWdlOiBmdW5jdGlvbiAobXNnKSB7CiAgICAgICAgICAgICAgICB0aGlzLiQoJy5jaGF0LWFyZWEnKS5oaWRlKCk7CiAgICAgICAgICAgICAgICB0aGlzLiQoJy5wYXJ0aWNpcGFudHMnKS5oaWRlKCk7CiAgICAgICAgICAgICAgICB0aGlzLiQoJ3NwYW4uY2VudGVyZWQuc3Bpbm5lcicpLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgdGhpcy4kKCcuY2hhdC1ib2R5JykuYXBwZW5kKCQoJzxwPicrbXNnKyc8L3A+JykpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgLyogaHR0cDovL3htcHAub3JnL2V4dGVuc2lvbnMveGVwLTAwNDUuaHRtbAogICAgICAgICAgICAgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgICAgICAgICAqIDEwMCBtZXNzYWdlICAgICAgRW50ZXJpbmcgYSByb29tICAgICAgICAgSW5mb3JtIHVzZXIgdGhhdCBhbnkgb2NjdXBhbnQgaXMgYWxsb3dlZCB0byBzZWUgdGhlIHVzZXIncyBmdWxsIEpJRAogICAgICAgICAgICAgKiAxMDEgbWVzc2FnZSAob3V0IG9mIGJhbmQpICAgICAgICAgICAgICAgIEFmZmlsaWF0aW9uIGNoYW5nZSAgSW5mb3JtIHVzZXIgdGhhdCBoaXMgb3IgaGVyIGFmZmlsaWF0aW9uIGNoYW5nZWQgd2hpbGUgbm90IGluIHRoZSByb29tCiAgICAgICAgICAgICAqIDEwMiBtZXNzYWdlICAgICAgQ29uZmlndXJhdGlvbiBjaGFuZ2UgICAgSW5mb3JtIG9jY3VwYW50cyB0aGF0IHJvb20gbm93IHNob3dzIHVuYXZhaWxhYmxlIG1lbWJlcnMKICAgICAgICAgICAgICogMTAzIG1lc3NhZ2UgICAgICBDb25maWd1cmF0aW9uIGNoYW5nZSAgICBJbmZvcm0gb2NjdXBhbnRzIHRoYXQgcm9vbSBub3cgZG9lcyBub3Qgc2hvdyB1bmF2YWlsYWJsZSBtZW1iZXJzCiAgICAgICAgICAgICAqIDEwNCBtZXNzYWdlICAgICAgQ29uZmlndXJhdGlvbiBjaGFuZ2UgICAgSW5mb3JtIG9jY3VwYW50cyB0aGF0IGEgbm9uLXByaXZhY3ktcmVsYXRlZCByb29tIGNvbmZpZ3VyYXRpb24gY2hhbmdlIGhhcyBvY2N1cnJlZAogICAgICAgICAgICAgKiAxMTAgcHJlc2VuY2UgICAgIEFueSByb29tIHByZXNlbmNlICAgICAgIEluZm9ybSB1c2VyIHRoYXQgcHJlc2VuY2UgcmVmZXJzIHRvIG9uZSBvZiBpdHMgb3duIHJvb20gb2NjdXBhbnRzCiAgICAgICAgICAgICAqIDE3MCBtZXNzYWdlIG9yIGluaXRpYWwgcHJlc2VuY2UgICAgICAgICAgQ29uZmlndXJhdGlvbiBjaGFuZ2UgICAgSW5mb3JtIG9jY3VwYW50cyB0aGF0IHJvb20gbG9nZ2luZyBpcyBub3cgZW5hYmxlZAogICAgICAgICAgICAgKiAxNzEgbWVzc2FnZSAgICAgIENvbmZpZ3VyYXRpb24gY2hhbmdlICAgIEluZm9ybSBvY2N1cGFudHMgdGhhdCByb29tIGxvZ2dpbmcgaXMgbm93IGRpc2FibGVkCiAgICAgICAgICAgICAqIDE3MiBtZXNzYWdlICAgICAgQ29uZmlndXJhdGlvbiBjaGFuZ2UgICAgSW5mb3JtIG9jY3VwYW50cyB0aGF0IHRoZSByb29tIGlzIG5vdyBub24tYW5vbnltb3VzCiAgICAgICAgICAgICAqIDE3MyBtZXNzYWdlICAgICAgQ29uZmlndXJhdGlvbiBjaGFuZ2UgICAgSW5mb3JtIG9jY3VwYW50cyB0aGF0IHRoZSByb29tIGlzIG5vdyBzZW1pLWFub255bW91cwogICAgICAgICAgICAgKiAxNzQgbWVzc2FnZSAgICAgIENvbmZpZ3VyYXRpb24gY2hhbmdlICAgIEluZm9ybSBvY2N1cGFudHMgdGhhdCB0aGUgcm9vbSBpcyBub3cgZnVsbHktYW5vbnltb3VzCiAgICAgICAgICAgICAqIDIwMSBwcmVzZW5jZSAgICAgRW50ZXJpbmcgYSByb29tICAgICAgICAgSW5mb3JtIHVzZXIgdGhhdCBhIG5ldyByb29tIGhhcyBiZWVuIGNyZWF0ZWQKICAgICAgICAgICAgICogMjEwIHByZXNlbmNlICAgICBFbnRlcmluZyBhIHJvb20gICAgICAgICBJbmZvcm0gdXNlciB0aGF0IHRoZSBzZXJ2aWNlIGhhcyBhc3NpZ25lZCBvciBtb2RpZmllZCB0aGUgb2NjdXBhbnQncyByb29tbmljawogICAgICAgICAgICAgKiAzMDEgcHJlc2VuY2UgICAgIFJlbW92YWwgZnJvbSByb29tICAgICAgIEluZm9ybSB1c2VyIHRoYXQgaGUgb3Igc2hlIGhhcyBiZWVuIGJhbm5lZCBmcm9tIHRoZSByb29tCiAgICAgICAgICAgICAqIDMwMyBwcmVzZW5jZSAgICAgRXhpdGluZyBhIHJvb20gICAgICAgICAgSW5mb3JtIGFsbCBvY2N1cGFudHMgb2YgbmV3IHJvb20gbmlja25hbWUKICAgICAgICAgICAgICogMzA3IHByZXNlbmNlICAgICBSZW1vdmFsIGZyb20gcm9vbSAgICAgICBJbmZvcm0gdXNlciB0aGF0IGhlIG9yIHNoZSBoYXMgYmVlbiBraWNrZWQgZnJvbSB0aGUgcm9vbQogICAgICAgICAgICAgKiAzMjEgcHJlc2VuY2UgICAgIFJlbW92YWwgZnJvbSByb29tICAgICAgIEluZm9ybSB1c2VyIHRoYXQgaGUgb3Igc2hlIGlzIGJlaW5nIHJlbW92ZWQgZnJvbSB0aGUgcm9vbSBiZWNhdXNlIG9mIGFuIGFmZmlsaWF0aW9uIGNoYW5nZQogICAgICAgICAgICAgKiAzMjIgcHJlc2VuY2UgICAgIFJlbW92YWwgZnJvbSByb29tICAgICAgIEluZm9ybSB1c2VyIHRoYXQgaGUgb3Igc2hlIGlzIGJlaW5nIHJlbW92ZWQgZnJvbSB0aGUgcm9vbSBiZWNhdXNlIHRoZSByb29tIGhhcyBiZWVuIGNoYW5nZWQgdG8gbWVtYmVycy1vbmx5IGFuZCB0aGUgdXNlciBpcyBub3QgYSBtZW1iZXIKICAgICAgICAgICAgICogMzMyIHByZXNlbmNlICAgICBSZW1vdmFsIGZyb20gcm9vbSAgICAgICBJbmZvcm0gdXNlciB0aGF0IGhlIG9yIHNoZSBpcyBiZWluZyByZW1vdmVkIGZyb20gdGhlIHJvb20gYmVjYXVzZSBvZiBhIHN5c3RlbSBzaHV0ZG93bgogICAgICAgICAgICAgKi8KICAgICAgICAgICAgaW5mb01lc3NhZ2VzOiB7CiAgICAgICAgICAgICAgICAxMDA6IF9fKCdUaGlzIHJvb20gaXMgbm90IGFub255bW91cycpLAogICAgICAgICAgICAgICAgMTAyOiBfXygnVGhpcyByb29tIG5vdyBzaG93cyB1bmF2YWlsYWJsZSBtZW1iZXJzJyksCiAgICAgICAgICAgICAgICAxMDM6IF9fKCdUaGlzIHJvb20gZG9lcyBub3Qgc2hvdyB1bmF2YWlsYWJsZSBtZW1iZXJzJyksCiAgICAgICAgICAgICAgICAxMDQ6IF9fKCdOb24tcHJpdmFjeS1yZWxhdGVkIHJvb20gY29uZmlndXJhdGlvbiBoYXMgY2hhbmdlZCcpLAogICAgICAgICAgICAgICAgMTcwOiBfXygnUm9vbSBsb2dnaW5nIGlzIG5vdyBlbmFibGVkJyksCiAgICAgICAgICAgICAgICAxNzE6IF9fKCdSb29tIGxvZ2dpbmcgaXMgbm93IGRpc2FibGVkJyksCiAgICAgICAgICAgICAgICAxNzI6IF9fKCdUaGlzIHJvb20gaXMgbm93IG5vbi1hbm9ueW1vdXMnKSwKICAgICAgICAgICAgICAgIDE3MzogX18oJ1RoaXMgcm9vbSBpcyBub3cgc2VtaS1hbm9ueW1vdXMnKSwKICAgICAgICAgICAgICAgIDE3NDogX18oJ1RoaXMgcm9vbSBpcyBub3cgZnVsbHktYW5vbnltb3VzJyksCiAgICAgICAgICAgICAgICAyMDE6IF9fKCdBIG5ldyByb29tIGhhcyBiZWVuIGNyZWF0ZWQnKQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgZGlzY29ubmVjdE1lc3NhZ2VzOiB7CiAgICAgICAgICAgICAgICAzMDE6IF9fKCdZb3UgaGF2ZSBiZWVuIGJhbm5lZCBmcm9tIHRoaXMgcm9vbScpLAogICAgICAgICAgICAgICAgMzA3OiBfXygnWW91IGhhdmUgYmVlbiBraWNrZWQgZnJvbSB0aGlzIHJvb20nKSwKICAgICAgICAgICAgICAgIDMyMTogX18oIllvdSBoYXZlIGJlZW4gcmVtb3ZlZCBmcm9tIHRoaXMgcm9vbSBiZWNhdXNlIG9mIGFuIGFmZmlsaWF0aW9uIGNoYW5nZSIpLAogICAgICAgICAgICAgICAgMzIyOiBfXygiWW91IGhhdmUgYmVlbiByZW1vdmVkIGZyb20gdGhpcyByb29tIGJlY2F1c2UgdGhlIHJvb20gaGFzIGNoYW5nZWQgdG8gbWVtYmVycy1vbmx5IGFuZCB5b3UncmUgbm90IGEgbWVtYmVyIiksCiAgICAgICAgICAgICAgICAzMzI6IF9fKCJZb3UgaGF2ZSBiZWVuIHJlbW92ZWQgZnJvbSB0aGlzIHJvb20gYmVjYXVzZSB0aGUgTVVDIChNdWx0aS11c2VyIGNoYXQpIHNlcnZpY2UgaXMgYmVpbmcgc2h1dCBkb3duLiIpCiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBhY3Rpb25JbmZvTWVzc2FnZXM6IHsKICAgICAgICAgICAgICAgIC8qIFhYWDogTm90ZSB0aGUgdHJpcGxlIHVuZGVyc2NvcmUgZnVuY3Rpb24gYW5kIG5vdCBkb3VibGUKICAgICAgICAgICAgICAgICAqIHVuZGVyc2NvcmUuCiAgICAgICAgICAgICAgICAgKgogICAgICAgICAgICAgICAgICogVGhpcyBpcyBhIGhhY2suIFdlIGNhbid0IHBhc3MgdGhlIHN0cmluZ3MgdG8gX18gYmVjYXVzZSB3ZQogICAgICAgICAgICAgICAgICogZG9uJ3QgeWV0IGtub3cgd2hhdCB0aGUgdmFyaWFibGUgdG8gaW50ZXJwb2xhdGUgaXMuCiAgICAgICAgICAgICAgICAgKgogICAgICAgICAgICAgICAgICogVHJpcGxlIHVuZGVyc2NvcmUgd2lsbCBqdXN0IHJldHVybiB0aGUgc3RyaW5nIGFnYWluLCBidXQgd2UKICAgICAgICAgICAgICAgICAqIGNhbiB0aGVuIGF0IGxlYXN0IHRlbGwgZ2V0dGV4dCB0byBzY2FuIGZvciBpdCBzbyB0aGF0IHRoZXNlCiAgICAgICAgICAgICAgICAgKiBzdHJpbmdzIGFyZSBwaWNrZWQgdXAgYnkgdGhlIHRyYW5zbGF0aW9uIG1hY2hpbmVyeS4KICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgMzAxOiBfX18oIjxzdHJvbmc+JTEkczwvc3Ryb25nPiBoYXMgYmVlbiBiYW5uZWQiKSwKICAgICAgICAgICAgICAgIDMwMzogX19fKCI8c3Ryb25nPiUxJHM8L3N0cm9uZz4ncyBuaWNrbmFtZSBoYXMgY2hhbmdlZCIpLAogICAgICAgICAgICAgICAgMzA3OiBfX18oIjxzdHJvbmc+JTEkczwvc3Ryb25nPiBoYXMgYmVlbiBraWNrZWQgb3V0IiksCiAgICAgICAgICAgICAgICAzMjE6IF9fXygiPHN0cm9uZz4lMSRzPC9zdHJvbmc+IGhhcyBiZWVuIHJlbW92ZWQgYmVjYXVzZSBvZiBhbiBhZmZpbGlhdGlvbiBjaGFuZ2UiKSwKICAgICAgICAgICAgICAgIDMyMjogX19fKCI8c3Ryb25nPiUxJHM8L3N0cm9uZz4gaGFzIGJlZW4gcmVtb3ZlZCBmb3Igbm90IGJlaW5nIGEgbWVtYmVyIikKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIG5ld05pY2tuYW1lTWVzc2FnZXM6IHsKICAgICAgICAgICAgICAgIDIxMDogX19fKCdZb3VyIG5pY2tuYW1lIGhhcyBiZWVuIGF1dG9tYXRpY2FsbHkgY2hhbmdlZCB0bzogPHN0cm9uZz4lMSRzPC9zdHJvbmc+JyksCiAgICAgICAgICAgICAgICAzMDM6IF9fXygnWW91ciBuaWNrbmFtZSBoYXMgYmVlbiBjaGFuZ2VkIHRvOiA8c3Ryb25nPiUxJHM8L3N0cm9uZz4nKQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgc2hvd1N0YXR1c01lc3NhZ2VzOiBmdW5jdGlvbiAoJGVsLCBpc19zZWxmKSB7CiAgICAgICAgICAgICAgICAvKiBDaGVjayBmb3Igc3RhdHVzIGNvZGVzIGFuZCBjb21tdW5pY2F0ZSB0aGVpciBwdXJwb3NlIHRvIHRoZSB1c2VyLgogICAgICAgICAgICAgICAgICogQWxsb3cgdXNlciB0byBjb25maWd1cmUgY2hhdCByb29tIGlmIHRoZXkgYXJlIHRoZSBvd25lci4KICAgICAgICAgICAgICAgICAqIFNlZTogaHR0cDovL3htcHAub3JnL3JlZ2lzdHJhci9tdWNzdGF0dXMuaHRtbAogICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICB2YXIgJGNoYXRfY29udGVudCwKICAgICAgICAgICAgICAgICAgICBkaXNjb25uZWN0X21zZ3MgPSBbXSwKICAgICAgICAgICAgICAgICAgICBtc2dzID0gW10sCiAgICAgICAgICAgICAgICAgICAgcmVhc29ucyA9IFtdOwogICAgICAgICAgICAgICAgJGVsLmZpbmQoJ3hbeG1sbnM9IicrU3Ryb3BoZS5OUy5NVUNfVVNFUisnIl0nKS5lYWNoKCQucHJveHkoZnVuY3Rpb24gKGlkeCwgeCkgewogICAgICAgICAgICAgICAgICAgIHZhciAkaXRlbSA9ICQoeCkuZmluZCgnaXRlbScpOwogICAgICAgICAgICAgICAgICAgIGlmIChTdHJvcGhlLmdldEJhcmVKaWRGcm9tSmlkKCRpdGVtLmF0dHIoJ2ppZCcpKSA9PT0gY29udmVyc2UuYmFyZV9qaWQgJiYgJGl0ZW0uYXR0cignYWZmaWxpYXRpb24nKSA9PT0gJ293bmVyJykgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbC5maW5kKCdhLmNvbmZpZ3VyZS1jaGF0cm9vbS1idXR0b24nKS5zaG93KCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICQoeCkuZmluZCgnaXRlbSByZWFzb24nKS5lYWNoKGZ1bmN0aW9uIChpZHgsIHJlYXNvbikgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJChyZWFzb24pLnRleHQoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVhc29ucy5wdXNoKCQocmVhc29uKS50ZXh0KCkpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgJCh4KS5maW5kKCdzdGF0dXMnKS5lYWNoKCQucHJveHkoZnVuY3Rpb24gKGlkeCwgc3RhdCkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29kZSA9IHN0YXQuZ2V0QXR0cmlidXRlKCdjb2RlJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc19zZWxmICYmIF8uY29udGFpbnMoXy5rZXlzKHRoaXMubmV3Tmlja25hbWVNZXNzYWdlcyksIGNvZGUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLnNhdmUoeyduaWNrJzogU3Ryb3BoZS5nZXRSZXNvdXJjZUZyb21KaWQoJGVsLmF0dHIoJ2Zyb20nKSl9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1zZ3MucHVzaChfXyh0aGlzLm5ld05pY2tuYW1lTWVzc2FnZXNbY29kZV0sICRpdGVtLmF0dHIoJ25pY2snKSkpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGlzX3NlbGYgJiYgXy5jb250YWlucyhfLmtleXModGhpcy5kaXNjb25uZWN0TWVzc2FnZXMpLCBjb2RlKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzY29ubmVjdF9tc2dzLnB1c2godGhpcy5kaXNjb25uZWN0TWVzc2FnZXNbY29kZV0pOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCFpc19zZWxmICYmIF8uY29udGFpbnMoXy5rZXlzKHRoaXMuYWN0aW9uSW5mb01lc3NhZ2VzKSwgY29kZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1zZ3MucHVzaCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfXyh0aGlzLmFjdGlvbkluZm9NZXNzYWdlc1tjb2RlXSwgU3Ryb3BoZS51bmVzY2FwZU5vZGUoU3Ryb3BoZS5nZXRSZXNvdXJjZUZyb21KaWQoJGVsLmF0dHIoJ2Zyb20nKSkpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChfLmNvbnRhaW5zKF8ua2V5cyh0aGlzLmluZm9NZXNzYWdlcyksIGNvZGUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtc2dzLnB1c2godGhpcy5pbmZvTWVzc2FnZXNbY29kZV0pOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNvZGUgIT09ICcxMTAnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJChzdGF0KS50ZXh0KCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtc2dzLnB1c2goJChzdGF0KS50ZXh0KCkpOyAvLyBTb21ldGltZXMgdGhlIHN0YXR1cyBjb250YWlucyBodW1hbiByZWFkYWJsZSB0ZXh0IGFuZCBub3QgYSBjb2RlLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwgdGhpcykpOwogICAgICAgICAgICAgICAgfSwgdGhpcykpOwoKICAgICAgICAgICAgICAgIGlmIChkaXNjb25uZWN0X21zZ3MubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIGZvciAoaT0wOyBpPGRpc2Nvbm5lY3RfbXNncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dEaXNjb25uZWN0TWVzc2FnZShkaXNjb25uZWN0X21zZ3NbaV0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBmb3IgKGk9MDsgaTxyZWFzb25zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0Rpc2Nvbm5lY3RNZXNzYWdlKF9fKCdUaGUgcmVhc29uIGdpdmVuIGlzOiAiJytyZWFzb25zW2ldKyciJyksIHRydWUpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLnNldCgnY29ubmVjdGVkJywgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRjaGF0X2NvbnRlbnQgPSB0aGlzLiRlbC5maW5kKCcuY2hhdC1jb250ZW50Jyk7CiAgICAgICAgICAgICAgICBmb3IgKGk9MDsgaTxtc2dzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgJGNoYXRfY29udGVudC5hcHBlbmQoY29udmVyc2UudGVtcGxhdGVzLmluZm8oe21lc3NhZ2U6IG1zZ3NbaV19KSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBmb3IgKGk9MDsgaTxyZWFzb25zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93U3RhdHVzTm90aWZpY2F0aW9uKF9fKCdUaGUgcmVhc29uIGdpdmVuIGlzOiAiJytyZWFzb25zW2ldKyciJyksIHRydWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2Nyb2xsRG93bigpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgc2hvd0Vycm9yTWVzc2FnZTogZnVuY3Rpb24gKCRlcnJvciwgcm9vbSkgewogICAgICAgICAgICAgICAgLy8gV2UgZGlkbid0IGVudGVyIHRoZSByb29tLCBzbyB3ZSBtdXN0IHJlbW92ZSBpdCBmcm9tIHRoZSBNVUMKICAgICAgICAgICAgICAgIC8vIGFkZC1vbgogICAgICAgICAgICAgICAgZGVsZXRlIGNvbnZlcnNlLmNvbm5lY3Rpb24ubXVjW3Jvb20ubmFtZV07CiAgICAgICAgICAgICAgICBpZiAoJGVycm9yLmF0dHIoJ3R5cGUnKSA9PSAnYXV0aCcpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoJGVycm9yLmZpbmQoJ25vdC1hdXRob3JpemVkJykubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyUGFzc3dvcmRGb3JtKCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICgkZXJyb3IuZmluZCgncmVnaXN0cmF0aW9uLXJlcXVpcmVkJykubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0Rpc2Nvbm5lY3RNZXNzYWdlKF9fKCdZb3UgYXJlIG5vdCBvbiB0aGUgbWVtYmVyIGxpc3Qgb2YgdGhpcyByb29tJykpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoJGVycm9yLmZpbmQoJ2ZvcmJpZGRlbicpLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dEaXNjb25uZWN0TWVzc2FnZShfXygnWW91IGhhdmUgYmVlbiBiYW5uZWQgZnJvbSB0aGlzIHJvb20nKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIGlmICgkZXJyb3IuYXR0cigndHlwZScpID09ICdtb2RpZnknKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCRlcnJvci5maW5kKCdqaWQtbWFsZm9ybWVkJykubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0Rpc2Nvbm5lY3RNZXNzYWdlKF9fKCdObyBuaWNrbmFtZSB3YXMgc3BlY2lmaWVkJykpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoJGVycm9yLmF0dHIoJ3R5cGUnKSA9PSAnY2FuY2VsJykgewogICAgICAgICAgICAgICAgICAgIGlmICgkZXJyb3IuZmluZCgnbm90LWFsbG93ZWQnKS5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93RGlzY29ubmVjdE1lc3NhZ2UoX18oJ1lvdSBhcmUgbm90IGFsbG93ZWQgdG8gY3JlYXRlIG5ldyByb29tcycpKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCRlcnJvci5maW5kKCdub3QtYWNjZXB0YWJsZScpLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dEaXNjb25uZWN0TWVzc2FnZShfXygiWW91ciBuaWNrbmFtZSBkb2Vzbid0IGNvbmZvcm0gdG8gdGhpcyByb29tJ3MgcG9saWNpZXMiKSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICgkZXJyb3IuZmluZCgnY29uZmxpY3QnKS5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gVE9ETzogZ2l2ZSB1c2VyIHRoZSBvcHRpb24gb2YgY2hvb3NpbmcgYSBkaWZmZXJlbnQKICAgICAgICAgICAgICAgICAgICAgICAgLy8gbmlja25hbWUKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93RGlzY29ubmVjdE1lc3NhZ2UoX18oIllvdXIgbmlja25hbWUgaXMgYWxyZWFkeSB0YWtlbiIpKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCRlcnJvci5maW5kKCdpdGVtLW5vdC1mb3VuZCcpLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNob3dEaXNjb25uZWN0TWVzc2FnZShfXygiVGhpcyByb29tIGRvZXMgbm90ICh5ZXQpIGV4aXN0IikpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoJGVycm9yLmZpbmQoJ3NlcnZpY2UtdW5hdmFpbGFibGUnKS5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93RGlzY29ubmVjdE1lc3NhZ2UoX18oIlRoaXMgcm9vbSBoYXMgcmVhY2hlZCBpdCdzIG1heGltdW0gbnVtYmVyIG9mIG9jY3VwYW50cyIpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBvbkNoYXRSb29tUHJlc2VuY2U6IGZ1bmN0aW9uIChwcmVzZW5jZSwgcm9vbSkgewogICAgICAgICAgICAgICAgdmFyICRwcmVzZW5jZSA9ICQocHJlc2VuY2UpLCBpc19zZWxmOwogICAgICAgICAgICAgICAgaWYgKCRwcmVzZW5jZS5hdHRyKCd0eXBlJykgPT09ICdlcnJvcicpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLnNldCgnY29ubmVjdGVkJywgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0Vycm9yTWVzc2FnZSgkcHJlc2VuY2UuZmluZCgnZXJyb3InKSwgcm9vbSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlzX3NlbGYgPSAoJHByZXNlbmNlLmZpbmQoInN0YXR1c1tjb2RlPScxMTAnXSIpLmxlbmd0aCkgfHwgKCRwcmVzZW5jZS5hdHRyKCdmcm9tJykgPT0gcm9vbS5uYW1lKycvJytTdHJvcGhlLmVzY2FwZU5vZGUocm9vbS5uaWNrKSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLm1vZGVsLmdldCgnY29ubmVjZWQnKSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLnNldCgnY29ubmVjdGVkJywgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJCgnc3Bhbi5jZW50ZXJlZC5zcGlubmVyJykucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJGVsLmZpbmQoJy5jaGF0LWJvZHknKS5jaGlsZHJlbigpLnNob3coKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93U3RhdHVzTWVzc2FnZXMoJHByZXNlbmNlLCBpc19zZWxmKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgb25DaGF0Um9vbU1lc3NhZ2U6IGZ1bmN0aW9uIChtZXNzYWdlKSB7CiAgICAgICAgICAgICAgICB2YXIgJG1lc3NhZ2UgPSAkKG1lc3NhZ2UpLAogICAgICAgICAgICAgICAgICAgIGJvZHkgPSAkbWVzc2FnZS5jaGlsZHJlbignYm9keScpLnRleHQoKSwKICAgICAgICAgICAgICAgICAgICBqaWQgPSAkbWVzc2FnZS5hdHRyKCdmcm9tJyksCiAgICAgICAgICAgICAgICAgICAgbXNnaWQgPSAkbWVzc2FnZS5hdHRyKCdpZCcpLAogICAgICAgICAgICAgICAgICAgIHJlc291cmNlID0gU3Ryb3BoZS5nZXRSZXNvdXJjZUZyb21KaWQoamlkKSwKICAgICAgICAgICAgICAgICAgICBzZW5kZXIgPSByZXNvdXJjZSAmJiBTdHJvcGhlLnVuZXNjYXBlTm9kZShyZXNvdXJjZSkgfHwgJycsCiAgICAgICAgICAgICAgICAgICAgZGVsYXllZCA9ICRtZXNzYWdlLmZpbmQoJ2RlbGF5JykubGVuZ3RoID4gMCwKICAgICAgICAgICAgICAgICAgICBzdWJqZWN0ID0gJG1lc3NhZ2UuY2hpbGRyZW4oJ3N1YmplY3QnKS50ZXh0KCk7CgogICAgICAgICAgICAgICAgaWYgKHRoaXMubW9kZWwubWVzc2FnZXMuZmluZFdoZXJlKHttc2dpZDogbXNnaWR9KSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOyAvLyBXZSBhbHJlYWR5IGhhdmUgdGhpcyBtZXNzYWdlIHN0b3JlZC4KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuc2hvd1N0YXR1c01lc3NhZ2VzKCRtZXNzYWdlKTsKICAgICAgICAgICAgICAgIGlmIChzdWJqZWN0KSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kZWwuZmluZCgnLmNoYXRyb29tLXRvcGljJykudGV4dChzdWJqZWN0KS5hdHRyKCd0aXRsZScsIHN1YmplY3QpOwogICAgICAgICAgICAgICAgICAgIC8vICMgRm9yIHRyYW5zbGF0b3JzOiB0aGUgJTEkcyBhbmQgJTIkcyBwYXJ0cyB3aWxsIGdldCByZXBsYWNlZCBieSB0aGUgdXNlciBhbmQgdG9waWMgdGV4dCByZXNwZWN0aXZlbHkKICAgICAgICAgICAgICAgICAgICAvLyAjIEV4YW1wbGU6IFRvcGljIHNldCBieSBKQyBCcmFuZCB0bzogSGVsbG8gV29ybGQhCiAgICAgICAgICAgICAgICAgICAgdGhpcy4kZWwuZmluZCgnLmNoYXQtY29udGVudCcpLmFwcGVuZCgKICAgICAgICAgICAgICAgICAgICAgICAgY29udmVyc2UudGVtcGxhdGVzLmluZm8oewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ21lc3NhZ2UnOiBfXygnVG9waWMgc2V0IGJ5ICUxJHMgdG86ICUyJHMnLCBzZW5kZXIsIHN1YmplY3QpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChzZW5kZXIgPT09ICcnKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLmNyZWF0ZU1lc3NhZ2UoJG1lc3NhZ2UpOwogICAgICAgICAgICAgICAgaWYgKCFkZWxheWVkICYmIHNlbmRlciAhPT0gdGhpcy5tb2RlbC5nZXQoJ25pY2snKSAmJiAobmV3IFJlZ0V4cCgiXFxiIit0aGlzLm1vZGVsLmdldCgnbmljaycpKyJcXGIiKSkudGVzdChib2R5KSkgewogICAgICAgICAgICAgICAgICAgIHBsYXlOb3RpZmljYXRpb24oKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChzZW5kZXIgIT09IHRoaXMubW9kZWwuZ2V0KCduaWNrJykpIHsKICAgICAgICAgICAgICAgICAgICAvLyBXZSBvbmx5IGVtaXQgYW4gZXZlbnQgaWYgaXQncyBub3Qgb3VyIG93biBtZXNzYWdlCiAgICAgICAgICAgICAgICAgICAgY29udmVyc2UuZW1pdCgnbWVzc2FnZScsIG1lc3NhZ2UpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBvbkNoYXRSb29tUm9zdGVyOiBmdW5jdGlvbiAocm9zdGVyLCByb29tKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5vY2N1cGFudHN2aWV3Lm9uQ2hhdFJvb21Sb3N0ZXIocm9zdGVyLCByb29tKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICB0aGlzLkNoYXRCb3hlcyA9IEJhY2tib25lLkNvbGxlY3Rpb24uZXh0ZW5kKHsKICAgICAgICAgICAgbW9kZWw6IGNvbnZlcnNlLkNoYXRCb3gsCiAgICAgICAgICAgIGNvbXBhcmF0b3I6ICd0aW1lX29wZW5lZCcsCgogICAgICAgICAgICByZWdpc3Rlck1lc3NhZ2VIYW5kbGVyOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBjb252ZXJzZS5jb25uZWN0aW9uLmFkZEhhbmRsZXIoCiAgICAgICAgICAgICAgICAgICAgJC5wcm94eShmdW5jdGlvbiAobWVzc2FnZSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9uTWVzc2FnZShtZXNzYWdlKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICAgICAgfSwgdGhpcyksIG51bGwsICdtZXNzYWdlJywgJ2NoYXQnKTsKCiAgICAgICAgICAgICAgICBjb252ZXJzZS5jb25uZWN0aW9uLmFkZEhhbmRsZXIoCiAgICAgICAgICAgICAgICAgICAgJC5wcm94eShmdW5jdGlvbiAobWVzc2FnZSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9uSW52aXRlKG1lc3NhZ2UpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB9LCB0aGlzKSwgJ2phYmJlcjp4OmNvbmZlcmVuY2UnLCAnbWVzc2FnZScpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgb25Db25uZWN0ZWQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHRoaXMuYnJvd3NlclN0b3JhZ2UgPSBuZXcgQmFja2JvbmUuQnJvd3NlclN0b3JhZ2VbY29udmVyc2Uuc3RvcmFnZV0oCiAgICAgICAgICAgICAgICAgICAgYjY0X3NoYTEoJ2NvbnZlcnNlLmNoYXRib3hlcy0nK2NvbnZlcnNlLmJhcmVfamlkKSk7CiAgICAgICAgICAgICAgICB0aGlzLnJlZ2lzdGVyTWVzc2FnZUhhbmRsZXIoKTsKICAgICAgICAgICAgICAgIHRoaXMuZmV0Y2goewogICAgICAgICAgICAgICAgICAgIGFkZDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiAkLnByb3h5KGZ1bmN0aW9uIChjb2xsZWN0aW9uLCByZXNwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghXy5pbmNsdWRlKF8ucGx1Y2socmVzcCwgJ2lkJyksICdjb250cm9sYm94JykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogJ2NvbnRyb2xib3gnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJveF9pZDogJ2NvbnRyb2xib3gnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdldCgnY29udHJvbGJveCcpLnNhdmUoe2Nvbm5lY3RlZDp0cnVlfSk7CiAgICAgICAgICAgICAgICAgICAgfSwgdGhpcykKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgaXNPbmx5Q2hhdFN0YXRlTm90aWZpY2F0aW9uOiBmdW5jdGlvbiAoJG1zZykgewogICAgICAgICAgICAgICAgLy8gU2VlIFhFUC0wMDg1IENoYXQgU3RhdGUgTm90aWZpY2F0aW9uCiAgICAgICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgICAgICAgICRtc2cuZmluZCgnYm9keScpLmxlbmd0aCA9PT0gMCAmJiAoCiAgICAgICAgICAgICAgICAgICAgICAgICRtc2cuZmluZChBQ1RJVkUpLmxlbmd0aCAhPT0gMCB8fAogICAgICAgICAgICAgICAgICAgICAgICAkbXNnLmZpbmQoQ09NUE9TSU5HKS5sZW5ndGggIT09IDAgfHwKICAgICAgICAgICAgICAgICAgICAgICAgJG1zZy5maW5kKElOQUNUSVZFKS5sZW5ndGggIT09IDAgfHwKICAgICAgICAgICAgICAgICAgICAgICAgJG1zZy5maW5kKFBBVVNFRCkubGVuZ3RoICE9PSAwIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICRtc2cuZmluZChHT05FKS5sZW5ndGggIT09IDAKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgb25JbnZpdGU6IGZ1bmN0aW9uIChtZXNzYWdlKSB7CiAgICAgICAgICAgICAgICB2YXIgJG1lc3NhZ2UgPSAkKG1lc3NhZ2UpLAogICAgICAgICAgICAgICAgICAgICR4ID0gJG1lc3NhZ2UuY2hpbGRyZW4oJ3hbeG1sbnM9ImphYmJlcjp4OmNvbmZlcmVuY2UiXScpLAogICAgICAgICAgICAgICAgICAgIGZyb20gPSBTdHJvcGhlLmdldEJhcmVKaWRGcm9tSmlkKCRtZXNzYWdlLmF0dHIoJ2Zyb20nKSksCiAgICAgICAgICAgICAgICAgICAgcm9vbV9qaWQgPSAkeC5hdHRyKCdqaWQnKSwKICAgICAgICAgICAgICAgICAgICByZWFzb24gPSAkeC5hdHRyKCdyZWFzb24nKSwKICAgICAgICAgICAgICAgICAgICBjb250YWN0ID0gY29udmVyc2Uucm9zdGVyLmdldChmcm9tKSwKICAgICAgICAgICAgICAgICAgICByZXN1bHQ7CgogICAgICAgICAgICAgICAgaWYgKCFyZWFzb24pIHsKICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBjb25maXJtKAogICAgICAgICAgICAgICAgICAgICAgICBfXyhfX18oIiUxJHMgaGFzIGludml0ZWQgeW91IHRvIGpvaW4gYSBjaGF0IHJvb206ICUyJHMiKSwgY29udGFjdC5nZXQoJ2Z1bGxuYW1lJyksIHJvb21famlkKQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IGNvbmZpcm0oCiAgICAgICAgICAgICAgICAgICAgICAgICBfXyhfX18oJyUxJHMgaGFzIGludml0ZWQgeW91IHRvIGpvaW4gYSBjaGF0IHJvb206ICUyJHMsIGFuZCBsZWZ0IHRoZSBmb2xsb3dpbmcgcmVhc29uOiAiJTMkcyInKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250YWN0LmdldCgnZnVsbG5hbWUnKSwgcm9vbV9qaWQsIHJlYXNvbikKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHJlc3VsdCA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgICAgIHZhciBjaGF0cm9vbSA9IGNvbnZlcnNlLmNoYXRib3h2aWV3cy5zaG93Q2hhdCh7CiAgICAgICAgICAgICAgICAgICAgICAgICdpZCc6IHJvb21famlkLAogICAgICAgICAgICAgICAgICAgICAgICAnamlkJzogcm9vbV9qaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICduYW1lJzogU3Ryb3BoZS51bmVzY2FwZU5vZGUoU3Ryb3BoZS5nZXROb2RlRnJvbUppZChyb29tX2ppZCkpLAogICAgICAgICAgICAgICAgICAgICAgICAnbmljayc6IFN0cm9waGUudW5lc2NhcGVOb2RlKFN0cm9waGUuZ2V0Tm9kZUZyb21KaWQoY29udmVyc2UuY29ubmVjdGlvbi5qaWQpKSwKICAgICAgICAgICAgICAgICAgICAgICAgJ2NoYXRyb29tJzogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgJ2JveF9pZCcgOiBiNjRfc2hhMShyb29tX2ppZCksCiAgICAgICAgICAgICAgICAgICAgICAgICdwYXNzd29yZCc6ICR4LmF0dHIoJ3Bhc3N3b3JkJykKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBpZiAoIWNoYXRyb29tLmdldCgnY29ubmVjdGVkJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29udmVyc2UuY2hhdGJveHZpZXdzLmdldChyb29tX2ppZCkuY29ubmVjdChudWxsKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBvbk1lc3NhZ2U6IGZ1bmN0aW9uIChtZXNzYWdlKSB7CiAgICAgICAgICAgICAgICB2YXIgJG1lc3NhZ2UgPSAkKG1lc3NhZ2UpOwogICAgICAgICAgICAgICAgdmFyIGJ1ZGR5X2ppZCwgJGZvcndhcmRlZCwgJHJlY2VpdmVkLAogICAgICAgICAgICAgICAgICAgIG1lc3NhZ2VfZnJvbSA9ICRtZXNzYWdlLmF0dHIoJ2Zyb20nKTsKICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlX2Zyb20gPT09IGNvbnZlcnNlLmNvbm5lY3Rpb24uamlkKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gRklYTUU6IEZvcndhcmRlZCBtZXNzYWdlcyBzaG91bGQgYmUgc2VudCB0byBzcGVjaWZpYyByZXNvdXJjZXMsCiAgICAgICAgICAgICAgICAgICAgLy8gbm90IGJyb2FkY2FzdGVkCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkZm9yd2FyZGVkID0gJG1lc3NhZ2UuY2hpbGRyZW4oJ2ZvcndhcmRlZCcpOwogICAgICAgICAgICAgICAgJHJlY2VpdmVkID0gJG1lc3NhZ2UuY2hpbGRyZW4oJ3JlY2VpdmVkW3htbG5zPSJ1cm46eG1wcDpjYXJib25zOjIiXScpOwogICAgICAgICAgICAgICAgaWYgKCRmb3J3YXJkZWQubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgJG1lc3NhZ2UgPSAkZm9yd2FyZGVkLmNoaWxkcmVuKCdtZXNzYWdlJyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCRyZWNlaXZlZC5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICAkbWVzc2FnZSA9ICRyZWNlaXZlZC5jaGlsZHJlbignZm9yd2FyZGVkJykuY2hpbGRyZW4oJ21lc3NhZ2UnKTsKICAgICAgICAgICAgICAgICAgICBtZXNzYWdlX2Zyb20gPSAkbWVzc2FnZS5hdHRyKCdmcm9tJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB2YXIgZnJvbSA9IFN0cm9waGUuZ2V0QmFyZUppZEZyb21KaWQobWVzc2FnZV9mcm9tKSwKICAgICAgICAgICAgICAgICAgICB0byA9IFN0cm9waGUuZ2V0QmFyZUppZEZyb21KaWQoJG1lc3NhZ2UuYXR0cigndG8nKSksCiAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2UsIGNoYXRib3gsIHJvc3Rlcl9pdGVtOwogICAgICAgICAgICAgICAgaWYgKGZyb20gPT0gY29udmVyc2UuYmFyZV9qaWQpIHsKICAgICAgICAgICAgICAgICAgICAvLyBJIGFtIHRoZSBzZW5kZXIsIHNvIHRoaXMgbXVzdCBiZSBhIGZvcndhcmRlZCBtZXNzYWdlLi4uCiAgICAgICAgICAgICAgICAgICAgYnVkZHlfamlkID0gdG87CiAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2UgPSBTdHJvcGhlLmdldFJlc291cmNlRnJvbUppZCgkbWVzc2FnZS5hdHRyKCd0bycpKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgYnVkZHlfamlkID0gZnJvbTsKICAgICAgICAgICAgICAgICAgICByZXNvdXJjZSA9IFN0cm9waGUuZ2V0UmVzb3VyY2VGcm9tSmlkKG1lc3NhZ2VfZnJvbSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjaGF0Ym94ID0gdGhpcy5nZXQoYnVkZHlfamlkKTsKICAgICAgICAgICAgICAgIHJvc3Rlcl9pdGVtID0gY29udmVyc2Uucm9zdGVyLmdldChidWRkeV9qaWQpOwoKICAgICAgICAgICAgICAgIGlmIChyb3N0ZXJfaXRlbSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gVGhlIGJ1ZGR5IHdhcyBsaWtlbHkgcmVtb3ZlZAogICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLmxvZygnQ291bGQgbm90IGdldCByb3N0ZXIgaXRlbSBmb3IgSklEICcrYnVkZHlfamlkLCAnZXJyb3InKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoIWNoYXRib3gpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZnVsbG5hbWUgPSByb3N0ZXJfaXRlbS5nZXQoJ2Z1bGxuYW1lJyk7CiAgICAgICAgICAgICAgICAgICAgZnVsbG5hbWUgPSBfLmlzRW1wdHkoZnVsbG5hbWUpPyBidWRkeV9qaWQ6IGZ1bGxuYW1lOwogICAgICAgICAgICAgICAgICAgIGNoYXRib3ggPSB0aGlzLmNyZWF0ZSh7CiAgICAgICAgICAgICAgICAgICAgICAgICdpZCc6IGJ1ZGR5X2ppZCwKICAgICAgICAgICAgICAgICAgICAgICAgJ2ppZCc6IGJ1ZGR5X2ppZCwKICAgICAgICAgICAgICAgICAgICAgICAgJ2Z1bGxuYW1lJzogZnVsbG5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICdpbWFnZV90eXBlJzogcm9zdGVyX2l0ZW0uZ2V0KCdpbWFnZV90eXBlJyksCiAgICAgICAgICAgICAgICAgICAgICAgICdpbWFnZSc6IHJvc3Rlcl9pdGVtLmdldCgnaW1hZ2UnKSwKICAgICAgICAgICAgICAgICAgICAgICAgJ3VybCc6IHJvc3Rlcl9pdGVtLmdldCgndXJsJykKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICghdGhpcy5pc09ubHlDaGF0U3RhdGVOb3RpZmljYXRpb24oJG1lc3NhZ2UpICYmIGZyb20gIT09IGNvbnZlcnNlLmJhcmVfamlkKSB7CiAgICAgICAgICAgICAgICAgICAgcGxheU5vdGlmaWNhdGlvbigpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2hhdGJveC5yZWNlaXZlTWVzc2FnZSgkbWVzc2FnZSk7CiAgICAgICAgICAgICAgICBjb252ZXJzZS5yb3N0ZXIuYWRkUmVzb3VyY2UoYnVkZHlfamlkLCByZXNvdXJjZSk7CiAgICAgICAgICAgICAgICBjb252ZXJzZS5lbWl0KCdtZXNzYWdlJywgbWVzc2FnZSk7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICB0aGlzLkNoYXRCb3hWaWV3cyA9IEJhY2tib25lLk92ZXJ2aWV3LmV4dGVuZCh7CgogICAgICAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLm9uKCJhZGQiLCB0aGlzLm9uQ2hhdEJveEFkZGVkLCB0aGlzKTsKICAgICAgICAgICAgICAgIHRoaXMubW9kZWwub24oImNoYW5nZTptaW5pbWl6ZWQiLCBmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLmdldCgnbWluaW1pemVkJykgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRyaW1DaGF0cyh0aGlzLmdldChpdGVtLmdldCgnaWQnKSkpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRyaW1DaGF0cygpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sIHRoaXMpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgX2Vuc3VyZUVsZW1lbnQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIC8qIE92ZXJyaWRlIG1ldGhvZCBmcm9tIGJhY2tib25lLmpzCiAgICAgICAgICAgICAgICAgKiBJZiB0aGUgI2NvbnZlcnNlanMgZWxlbWVudCBkb2Vzbid0IGV4aXN0LCBjcmVhdGUgaXQuCiAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgIGlmICghdGhpcy5lbCkgewogICAgICAgICAgICAgICAgICAgIHZhciAkZWwgPSAkKCcjY29udmVyc2VqcycpOwogICAgICAgICAgICAgICAgICAgIGlmICghJGVsLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgICAgICAkZWwgPSAkKCc8ZGl2IGlkPSJjb252ZXJzZWpzIj4nKTsKICAgICAgICAgICAgICAgICAgICAgICAgJCgnYm9keScpLmFwcGVuZCgkZWwpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAkZWwuaHRtbChjb252ZXJzZS50ZW1wbGF0ZXMuY2hhdHNfcGFuZWwoKSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRFbGVtZW50KCRlbCwgZmFsc2UpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEVsZW1lbnQoXy5yZXN1bHQodGhpcywgJ2VsJyksIGZhbHNlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIG9uQ2hhdEJveEFkZGVkOiBmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgICAgdmFyIHZpZXcgPSB0aGlzLmdldChpdGVtLmdldCgnaWQnKSk7CiAgICAgICAgICAgICAgICBpZiAoIXZpZXcpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5nZXQoJ2NoYXRyb29tJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmlldyA9IG5ldyBjb252ZXJzZS5DaGF0Um9vbVZpZXcoeydtb2RlbCc6IGl0ZW19KTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGl0ZW0uZ2V0KCdib3hfaWQnKSA9PT0gJ2NvbnRyb2xib3gnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZpZXcgPSBuZXcgY29udmVyc2UuQ29udHJvbEJveFZpZXcoe21vZGVsOiBpdGVtfSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmlldyA9IG5ldyBjb252ZXJzZS5DaGF0Qm94Vmlldyh7bW9kZWw6IGl0ZW19KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGQoaXRlbS5nZXQoJ2lkJyksIHZpZXcpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBkZWxldGUgdmlldy5tb2RlbDsgLy8gUmVtb3ZlIHJlZiB0byBvbGQgbW9kZWwgdG8gaGVscCBnYXJiYWdlIGNvbGxlY3Rpb24KICAgICAgICAgICAgICAgICAgICB2aWV3Lm1vZGVsID0gaXRlbTsKICAgICAgICAgICAgICAgICAgICB2aWV3LmluaXRpYWxpemUoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMudHJpbUNoYXRzKHZpZXcpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgdHJpbUNoYXRzOiBmdW5jdGlvbiAobmV3Y2hhdCkgewogICAgICAgICAgICAgICAgLyogVGhpcyBtZXRob2QgaXMgY2FsbGVkIHdoZW4gYSBuZXdseSBjcmVhdGVkIGNoYXQgYm94IHdpbGwKICAgICAgICAgICAgICAgICAqIGJlIHNob3duLgogICAgICAgICAgICAgICAgICoKICAgICAgICAgICAgICAgICAqIEl0IGNoZWNrcyB3aGV0aGVyIHRoZXJlIGlzIGVub3VnaCBzcGFjZSBvbiB0aGUgcGFnZSB0byBzaG93CiAgICAgICAgICAgICAgICAgKiBhbm90aGVyIGNoYXQgYm94LiBPdGhlcndpc2UgaXQgbWluaW1pemUgdGhlIG9sZGVzdCBjaGF0IGJveAogICAgICAgICAgICAgICAgICogdG8gY3JlYXRlIHNwYWNlLgogICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICBpZiAoY29udmVyc2Uubm9fdHJpbW1pbmcgfHwgKHRoaXMubW9kZWwubGVuZ3RoIDw9IDEpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdmFyIG9sZGVzdF9jaGF0LAogICAgICAgICAgICAgICAgICAgIGNvbnRyb2xib3hfd2lkdGggPSAwLAogICAgICAgICAgICAgICAgICAgICRtaW5pbWl6ZWQgPSBjb252ZXJzZS5taW5pbWl6ZWRfY2hhdHMuJGVsLAogICAgICAgICAgICAgICAgICAgIG1pbmltaXplZF93aWR0aCA9IF8uY29udGFpbnModGhpcy5tb2RlbC5wbHVjaygnbWluaW1pemVkJyksIHRydWUpID8gJG1pbmltaXplZC5vdXRlcldpZHRoKHRydWUpIDogMCwKICAgICAgICAgICAgICAgICAgICBib3hlc193aWR0aCA9IG5ld2NoYXQgPyBuZXdjaGF0LiRlbC5vdXRlcldpZHRoKHRydWUpIDogMCwKICAgICAgICAgICAgICAgICAgICBuZXdfaWQgPSBuZXdjaGF0ID8gbmV3Y2hhdC5tb2RlbC5nZXQoJ2lkJykgOiBudWxsLAogICAgICAgICAgICAgICAgICAgIGNvbnRyb2xib3ggPSB0aGlzLmdldCgnY29udHJvbGJveCcpOwoKICAgICAgICAgICAgICAgIGlmICghY29udHJvbGJveCB8fCAhY29udHJvbGJveC4kZWwuaXMoJzp2aXNpYmxlJykpIHsKICAgICAgICAgICAgICAgICAgICBjb250cm9sYm94X3dpZHRoID0gY29udmVyc2UuY29udHJvbGJveHRvZ2dsZS4kZWwub3V0ZXJXaWR0aCh0cnVlKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgY29udHJvbGJveF93aWR0aCA9IGNvbnRyb2xib3guJGVsLm91dGVyV2lkdGgodHJ1ZSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgXy5lYWNoKHRoaXMuZ2V0QWxsKCksIGZ1bmN0aW9uICh2aWV3KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGlkID0gdmlldy5tb2RlbC5nZXQoJ2lkJyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKChpZCAhPT0gJ2NvbnRyb2xib3gnKSAmJiAoaWQgIT09IG5ld19pZCkgJiYgKCF2aWV3Lm1vZGVsLmdldCgnbWluaW1pemVkJykpICYmIHZpZXcuJGVsLmlzKCc6dmlzaWJsZScpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGJveGVzX3dpZHRoICs9IHZpZXcuJGVsLm91dGVyV2lkdGgodHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgaWYgKChtaW5pbWl6ZWRfd2lkdGggKyBib3hlc193aWR0aCArIGNvbnRyb2xib3hfd2lkdGgpID4gdGhpcy4kZWwub3V0ZXJXaWR0aCh0cnVlKSkgewogICAgICAgICAgICAgICAgICAgIG9sZGVzdF9jaGF0ID0gdGhpcy5nZXRPbGRlc3RNYXhpbWl6ZWRDaGF0KCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKG9sZGVzdF9jaGF0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9sZGVzdF9jaGF0Lm1pbmltaXplKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgZ2V0T2xkZXN0TWF4aW1pemVkQ2hhdDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgLy8gR2V0IG9sZGVzdCB2aWV3ICh3aGljaCBpcyBub3QgY29udHJvbGJveCkKICAgICAgICAgICAgICAgIHZhciBpID0gMDsKICAgICAgICAgICAgICAgIHZhciBtb2RlbCA9IHRoaXMubW9kZWwuc29ydCgpLmF0KGkpOwogICAgICAgICAgICAgICAgd2hpbGUgKG1vZGVsLmdldCgnaWQnKSA9PT0gJ2NvbnRyb2xib3gnIHx8IG1vZGVsLmdldCgnbWluaW1pemVkJykgPT09IHRydWUpIHsKICAgICAgICAgICAgICAgICAgICBpKys7CiAgICAgICAgICAgICAgICAgICAgbW9kZWwgPSB0aGlzLm1vZGVsLmF0KGkpOwogICAgICAgICAgICAgICAgICAgIGlmICghbW9kZWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIG1vZGVsOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgY2xvc2VBbGxDaGF0Qm94ZXM6IGZ1bmN0aW9uIChpbmNsdWRlX2NvbnRyb2xib3gpIHsKICAgICAgICAgICAgICAgIHZhciBpLCBjaGF0Ym94OwogICAgICAgICAgICAgICAgLy8gVE9ETzogb25jZSBCYWNrYm9uZS5PdmVydmlldyBoYXMgYmVlbiByZWZhY3RvcmVkLCB3ZSBzaG91bGQKICAgICAgICAgICAgICAgIC8vIGJlIGFibGUgdG8gY2FsbCAuZWFjaCBvbiB0aGUgdmlld3MgdGhlbXNlbHZlcy4KICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuZWFjaCgkLnByb3h5KGZ1bmN0aW9uIChtb2RlbCkgewogICAgICAgICAgICAgICAgICAgIHZhciBpZCA9IG1vZGVsLmdldCgnaWQnKTsKICAgICAgICAgICAgICAgICAgICBpZiAoaW5jbHVkZV9jb250cm9sYm94IHx8IGlkICE9PSAnY29udHJvbGJveCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXQoaWQpLmNsb3NlKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwgdGhpcykpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBzaG93Q2hhdDogZnVuY3Rpb24gKGF0dHJzKSB7CiAgICAgICAgICAgICAgICAvKiBGaW5kIHRoZSBjaGF0IGJveCBhbmQgc2hvdyBpdC4KICAgICAgICAgICAgICAgICAqIElmIGl0IGRvZXNuJ3QgZXhpc3QsIGNyZWF0ZSBpdC4KICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgdmFyIGNoYXRib3ggID0gdGhpcy5tb2RlbC5nZXQoYXR0cnMuamlkKTsKICAgICAgICAgICAgICAgIGlmICghY2hhdGJveCkgewogICAgICAgICAgICAgICAgICAgIGNoYXRib3ggPSB0aGlzLm1vZGVsLmNyZWF0ZShhdHRycywgewogICAgICAgICAgICAgICAgICAgICAgICAnZXJyb3InOiBmdW5jdGlvbiAobW9kZWwsIHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS5sb2cocmVzcG9uc2UucmVzcG9uc2VUZXh0KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGNoYXRib3guZ2V0KCdtaW5pbWl6ZWQnKSkgewogICAgICAgICAgICAgICAgICAgIGNoYXRib3gubWF4aW1pemUoKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgY2hhdGJveC50cmlnZ2VyKCdzaG93Jyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gY2hhdGJveDsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICB0aGlzLk1pbmltaXplZENoYXRCb3hWaWV3ID0gQmFja2JvbmUuVmlldy5leHRlbmQoewogICAgICAgICAgICB0YWdOYW1lOiAnZGl2JywKICAgICAgICAgICAgY2xhc3NOYW1lOiAnY2hhdC1oZWFkJywKCiAgICAgICAgICAgIGV2ZW50czogewogICAgICAgICAgICAgICAgJ2NsaWNrIC5jbG9zZS1jaGF0Ym94LWJ1dHRvbic6ICdjbG9zZScsCiAgICAgICAgICAgICAgICAnY2xpY2sgLnJlc3RvcmUtY2hhdCc6ICdyZXN0b3JlJwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5tZXNzYWdlcy5vbignYWRkJywgZnVuY3Rpb24gKG0pIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIShtLmdldCgnY29tcG9zaW5nJykgfHwgbS5nZXQoJ3BhdXNlZCcpKSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVVucmVhZE1lc3NhZ2VzQ291bnRlcigpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sIHRoaXMpOwogICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5vbignY2hhbmdlOm1pbmltaXplZCcsIHRoaXMuY2xlYXJVbnJlYWRNZXNzYWdlc0NvdW50ZXIsIHRoaXMpOwogICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5vbignc2hvd1JlY2VpdmVkT1RSTWVzc2FnZScsIHRoaXMudXBkYXRlVW5yZWFkTWVzc2FnZXNDb3VudGVyLCB0aGlzKTsKICAgICAgICAgICAgICAgIHRoaXMubW9kZWwub24oJ3Nob3dTZW50T1RSTWVzc2FnZScsIHRoaXMudXBkYXRlVW5yZWFkTWVzc2FnZXNDb3VudGVyLCB0aGlzKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIGRhdGEgPSBfLmV4dGVuZCgKICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLnRvSlNPTigpLAogICAgICAgICAgICAgICAgICAgIHsgJ3Rvb2x0aXAnOiBfXygnQ2xpY2sgdG8gcmVzdG9yZSB0aGlzIGNoYXQnKSB9CiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgaWYgKHRoaXMubW9kZWwuZ2V0KCdjaGF0cm9vbScpKSB7CiAgICAgICAgICAgICAgICAgICAgZGF0YS50aXRsZSA9IHRoaXMubW9kZWwuZ2V0KCduYW1lJyk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kZWwuYWRkQ2xhc3MoJ2NoYXQtaGVhZC1jaGF0cm9vbScpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBkYXRhLnRpdGxlID0gdGhpcy5tb2RlbC5nZXQoJ2Z1bGxuYW1lJyk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kZWwuYWRkQ2xhc3MoJ2NoYXQtaGVhZC1jaGF0Ym94Jyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kZWwuaHRtbChjb252ZXJzZS50ZW1wbGF0ZXMudHJpbW1lZF9jaGF0KGRhdGEpKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGNsZWFyVW5yZWFkTWVzc2FnZXNDb3VudGVyOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLnNldCh7J251bV91bnJlYWQnOiAwfSk7CiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcigpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgdXBkYXRlVW5yZWFkTWVzc2FnZXNDb3VudGVyOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLnNldCh7J251bV91bnJlYWQnOiB0aGlzLm1vZGVsLmdldCgnbnVtX3VucmVhZCcpICsgMX0pOwogICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIoKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGNsb3NlOiBmdW5jdGlvbiAoZXYpIHsKICAgICAgICAgICAgICAgIGlmIChldiAmJiBldi5wcmV2ZW50RGVmYXVsdCkgeyBldi5wcmV2ZW50RGVmYXVsdCgpOyB9CiAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5kZXN0cm95KCk7CiAgICAgICAgICAgICAgICBjb252ZXJzZS5lbWl0KCdjaGF0Qm94Q2xvc2VkJywgdGhpcyk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHJlc3RvcmU6IF8uZGVib3VuY2UoZnVuY3Rpb24gKGV2KSB7CiAgICAgICAgICAgICAgICBpZiAoZXYgJiYgZXYucHJldmVudERlZmF1bHQpIHsKICAgICAgICAgICAgICAgICAgICBldi5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5yZW1vdmUoKTsKICAgICAgICAgICAgICAgIHRoaXMubW9kZWwubWF4aW1pemUoKTsKICAgICAgICAgICAgfSwgMjAwKQogICAgICAgIH0pOwoKICAgICAgICB0aGlzLk1pbmltaXplZENoYXRzID0gQmFja2JvbmUuT3ZlcnZpZXcuZXh0ZW5kKHsKICAgICAgICAgICAgZWw6ICIjbWluaW1pemVkLWNoYXRzIiwKCiAgICAgICAgICAgIGV2ZW50czogewogICAgICAgICAgICAgICAgImNsaWNrICN0b2dnbGUtbWluaW1pemVkLWNoYXRzIjogInRvZ2dsZSIKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHRoaXMuaW5pdFRvZ2dsZSgpOwogICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5vbigiYWRkIiwgdGhpcy5vbkNoYW5nZWQsIHRoaXMpOwogICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5vbigiZGVzdHJveSIsIHRoaXMucmVtb3ZlQ2hhdCwgdGhpcyk7CiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLm9uKCJjaGFuZ2U6bWluaW1pemVkIiwgdGhpcy5vbkNoYW5nZWQsIHRoaXMpOwogICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5vbignY2hhbmdlOm51bV91bnJlYWQnLCB0aGlzLnVwZGF0ZVVucmVhZE1lc3NhZ2VzQ291bnRlciwgdGhpcyk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICB0ZWFyRG93bjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5vZmYoImFkZCIsIHRoaXMub25DaGFuZ2VkKTsKICAgICAgICAgICAgICAgIHRoaXMubW9kZWwub2ZmKCJkZXN0cm95IiwgdGhpcy5yZW1vdmVDaGF0KTsKICAgICAgICAgICAgICAgIHRoaXMubW9kZWwub2ZmKCJjaGFuZ2U6bWluaW1pemVkIiwgdGhpcy5vbkNoYW5nZWQpOwogICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5vZmYoJ2NoYW5nZTpudW1fdW5yZWFkJywgdGhpcy51cGRhdGVVbnJlYWRNZXNzYWdlc0NvdW50ZXIpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBpbml0VG9nZ2xlOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB0aGlzLnRvZ2dsZXZpZXcgPSBuZXcgY29udmVyc2UuTWluaW1pemVkQ2hhdHNUb2dnbGVWaWV3KHsKICAgICAgICAgICAgICAgICAgICBtb2RlbDogbmV3IGNvbnZlcnNlLk1pbmltaXplZENoYXRzVG9nZ2xlKCkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgdmFyIGlkID0gYjY0X3NoYTEoJ2NvbnZlcnNlLm1pbmNoYXRzdG9nZ2xlJytjb252ZXJzZS5iYXJlX2ppZCk7CiAgICAgICAgICAgICAgICB0aGlzLnRvZ2dsZXZpZXcubW9kZWwuaWQgPSBpZDsgLy8gQXBwZWFycyB0byBiZSBuZWNlc3NhcnkgZm9yIGJhY2tib25lLmJyb3dzZXJTdG9yYWdlCiAgICAgICAgICAgICAgICB0aGlzLnRvZ2dsZXZpZXcubW9kZWwuYnJvd3NlclN0b3JhZ2UgPSBuZXcgQmFja2JvbmUuQnJvd3NlclN0b3JhZ2VbY29udmVyc2Uuc3RvcmFnZV0oaWQpOwogICAgICAgICAgICAgICAgdGhpcy50b2dnbGV2aWV3Lm1vZGVsLmZldGNoKCk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICByZW5kZXI6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmtleXMoKS5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbC5oaWRlKCdmYXN0Jyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMua2V5cygpLmxlbmd0aCA9PT0gMSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuJGVsLnNob3coJ2Zhc3QnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiRlbDsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHRvZ2dsZTogZnVuY3Rpb24gKGV2KSB7CiAgICAgICAgICAgICAgICBpZiAoZXYgJiYgZXYucHJldmVudERlZmF1bHQpIHsgZXYucHJldmVudERlZmF1bHQoKTsgfQogICAgICAgICAgICAgICAgdGhpcy50b2dnbGV2aWV3Lm1vZGVsLnNhdmUoeydjb2xsYXBzZWQnOiAhdGhpcy50b2dnbGV2aWV3Lm1vZGVsLmdldCgnY29sbGFwc2VkJyl9KTsKICAgICAgICAgICAgICAgIHRoaXMuJCgnLm1pbmltaXplZC1jaGF0cy1mbHlvdXQnKS50b2dnbGUoKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIG9uQ2hhbmdlZDogZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgIGlmIChpdGVtLmdldCgnaWQnKSAhPT0gJ2NvbnRyb2xib3gnICYmIGl0ZW0uZ2V0KCdtaW5pbWl6ZWQnKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkQ2hhdChpdGVtKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5nZXQoaXRlbS5nZXQoJ2lkJykpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVDaGF0KGl0ZW0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgYWRkQ2hhdDogZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgIHZhciBleGlzdGluZyA9IHRoaXMuZ2V0KGl0ZW0uZ2V0KCdpZCcpKTsKICAgICAgICAgICAgICAgIGlmIChleGlzdGluZyAmJiBleGlzdGluZy4kZWwucGFyZW50KCkubGVuZ3RoICE9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdmFyIHZpZXcgPSBuZXcgY29udmVyc2UuTWluaW1pemVkQ2hhdEJveFZpZXcoe21vZGVsOiBpdGVtfSk7CiAgICAgICAgICAgICAgICB0aGlzLiQoJy5taW5pbWl6ZWQtY2hhdHMtZmx5b3V0JykuYXBwZW5kKHZpZXcucmVuZGVyKCkpOwogICAgICAgICAgICAgICAgdGhpcy5hZGQoaXRlbS5nZXQoJ2lkJyksIHZpZXcpOwogICAgICAgICAgICAgICAgdGhpcy50b2dnbGV2aWV3Lm1vZGVsLnNldCh7J251bV9taW5pbWl6ZWQnOiB0aGlzLmtleXMoKS5sZW5ndGh9KTsKICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyKCk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICByZW1vdmVDaGF0OiBmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgICAgdGhpcy5yZW1vdmUoaXRlbS5nZXQoJ2lkJykpOwogICAgICAgICAgICAgICAgdGhpcy50b2dnbGV2aWV3Lm1vZGVsLnNldCh7J251bV9taW5pbWl6ZWQnOiB0aGlzLmtleXMoKS5sZW5ndGh9KTsKICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyKCk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICB1cGRhdGVVbnJlYWRNZXNzYWdlc0NvdW50ZXI6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBscyA9IHRoaXMubW9kZWwucGx1Y2soJ251bV91bnJlYWQnKSwKICAgICAgICAgICAgICAgICAgICBjb3VudCA9IDAsIGk7CiAgICAgICAgICAgICAgICBmb3IgKGk9MDsgaTxscy5sZW5ndGg7IGkrKykgeyBjb3VudCArPSBsc1tpXTsgfQogICAgICAgICAgICAgICAgdGhpcy50b2dnbGV2aWV3Lm1vZGVsLnNldCh7J251bV91bnJlYWQnOiBjb3VudH0pOwogICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIoKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICB0aGlzLk1pbmltaXplZENoYXRzVG9nZ2xlID0gQmFja2JvbmUuTW9kZWwuZXh0ZW5kKHsKICAgICAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdGhpcy5zZXQoewogICAgICAgICAgICAgICAgICAgICdjb2xsYXBzZWQnOiB0aGlzLmdldCgnY29sbGFwc2VkJykgfHwgZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgJ251bV9taW5pbWl6ZWQnOiB0aGlzLmdldCgnbnVtX21pbmltaXplZCcpIHx8IDAsCiAgICAgICAgICAgICAgICAgICAgJ251bV91bnJlYWQnOiAgdGhpcy5nZXQoJ251bV91bnJlYWQnKSB8fCAwCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICB0aGlzLk1pbmltaXplZENoYXRzVG9nZ2xlVmlldyA9IEJhY2tib25lLlZpZXcuZXh0ZW5kKHsKICAgICAgICAgICAgZWw6ICcjdG9nZ2xlLW1pbmltaXplZC1jaGF0cycsCgogICAgICAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLm9uKCdjaGFuZ2U6bnVtX21pbmltaXplZCcsIHRoaXMucmVuZGVyLCB0aGlzKTsKICAgICAgICAgICAgICAgIHRoaXMubW9kZWwub24oJ2NoYW5nZTpudW1fdW5yZWFkJywgdGhpcy5yZW5kZXIsIHRoaXMpOwogICAgICAgICAgICAgICAgdGhpcy4kZmx5b3V0ID0gdGhpcy4kZWwuc2libGluZ3MoJy5taW5pbWl6ZWQtY2hhdHMtZmx5b3V0Jyk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICByZW5kZXI6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHRoaXMuJGVsLmh0bWwoY29udmVyc2UudGVtcGxhdGVzLnRvZ2dsZV9jaGF0cygKICAgICAgICAgICAgICAgICAgICBfLmV4dGVuZCh0aGlzLm1vZGVsLnRvSlNPTigpLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICdNaW5pbWl6ZWQnOiBfXygnTWluaW1pemVkJykKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgKSk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5tb2RlbC5nZXQoJ2NvbGxhcHNlZCcpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kZmx5b3V0LmhpZGUoKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kZmx5b3V0LnNob3coKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiRlbDsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICB0aGlzLlJvc3RlckNvbnRhY3QgPSBCYWNrYm9uZS5Nb2RlbC5leHRlbmQoewogICAgICAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbiAoYXR0cmlidXRlcywgb3B0aW9ucykgewogICAgICAgICAgICAgICAgdmFyIGppZCA9IGF0dHJpYnV0ZXMuamlkOwogICAgICAgICAgICAgICAgdmFyIGF0dHJzID0gXy5leHRlbmQoewogICAgICAgICAgICAgICAgICAgICdpZCc6IGppZCwKICAgICAgICAgICAgICAgICAgICAnZnVsbG5hbWUnOiBqaWQsCiAgICAgICAgICAgICAgICAgICAgJ2NoYXRfc3RhdHVzJzogJ29mZmxpbmUnLAogICAgICAgICAgICAgICAgICAgICd1c2VyX2lkJzogU3Ryb3BoZS5nZXROb2RlRnJvbUppZChqaWQpLAogICAgICAgICAgICAgICAgICAgICdyZXNvdXJjZXMnOiBbXSwKICAgICAgICAgICAgICAgICAgICAnZ3JvdXBzJzogW10sCiAgICAgICAgICAgICAgICAgICAgJ3N0YXR1cyc6ICcnCiAgICAgICAgICAgICAgICB9LCBhdHRyaWJ1dGVzKTsKICAgICAgICAgICAgICAgIHRoaXMuc2V0KGF0dHJzKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHNob3dJblJvc3RlcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuICghY29udmVyc2Uuc2hvd19vbmx5X29ubGluZV91c2VycyB8fCB0aGlzLmdldCgnY2hhdF9zdGF0dXMnKSA9PT0gJ29ubGluZScpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIHRoaXMuUm9zdGVyQ29udGFjdFZpZXcgPSBCYWNrYm9uZS5WaWV3LmV4dGVuZCh7CiAgICAgICAgICAgIHRhZ05hbWU6ICdkZCcsCgogICAgICAgICAgICBldmVudHM6IHsKICAgICAgICAgICAgICAgICJjbGljayAuYWNjZXB0LXhtcHAtcmVxdWVzdCI6ICJhY2NlcHRSZXF1ZXN0IiwKICAgICAgICAgICAgICAgICJjbGljayAuZGVjbGluZS14bXBwLXJlcXVlc3QiOiAiZGVjbGluZVJlcXVlc3QiLAogICAgICAgICAgICAgICAgImNsaWNrIC5vcGVuLWNoYXQiOiAib3BlbkNoYXQiLAogICAgICAgICAgICAgICAgImNsaWNrIC5yZW1vdmUteG1wcC1jb250YWN0IjogInJlbW92ZUNvbnRhY3QiCiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLm9uKCJjaGFuZ2UiLCB0aGlzLnJlbmRlciwgdGhpcyk7CiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLm9uKCJyZW1vdmUiLCB0aGlzLnJlbW92ZSwgdGhpcyk7CiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLm9uKCJkZXN0cm95IiwgdGhpcy5yZW1vdmUsIHRoaXMpOwogICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5vbigib3BlbiIsIHRoaXMub3BlbkNoYXQsIHRoaXMpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgb3BlbkNoYXQ6IGZ1bmN0aW9uIChldikgewogICAgICAgICAgICAgICAgaWYgKGV2ICYmIGV2LnByZXZlbnREZWZhdWx0KSB7IGV2LnByZXZlbnREZWZhdWx0KCk7IH0KICAgICAgICAgICAgICAgIC8vIFhYWDogQ2FuIHRoaXMubW9kZWwuYXR0cmlidXRlcyBiZSB1c2VkIGhlcmUsIGluc3RlYWQgb2YKICAgICAgICAgICAgICAgIC8vIG1hbnVhbGx5IHNwZWNpZnlpbmcgYWxsIGF0dHJpYnV0ZXM/CiAgICAgICAgICAgICAgICByZXR1cm4gY29udmVyc2UuY2hhdGJveHZpZXdzLnNob3dDaGF0KHsKICAgICAgICAgICAgICAgICAgICAnaWQnOiB0aGlzLm1vZGVsLmdldCgnamlkJyksCiAgICAgICAgICAgICAgICAgICAgJ2ppZCc6IHRoaXMubW9kZWwuZ2V0KCdqaWQnKSwKICAgICAgICAgICAgICAgICAgICAnZnVsbG5hbWUnOiB0aGlzLm1vZGVsLmdldCgnZnVsbG5hbWUnKSwKICAgICAgICAgICAgICAgICAgICAnaW1hZ2VfdHlwZSc6IHRoaXMubW9kZWwuZ2V0KCdpbWFnZV90eXBlJyksCiAgICAgICAgICAgICAgICAgICAgJ2ltYWdlJzogdGhpcy5tb2RlbC5nZXQoJ2ltYWdlJyksCiAgICAgICAgICAgICAgICAgICAgJ3VybCc6IHRoaXMubW9kZWwuZ2V0KCd1cmwnKSwKICAgICAgICAgICAgICAgICAgICAnc3RhdHVzJzogdGhpcy5tb2RlbC5nZXQoJ3N0YXR1cycpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHJlbW92ZUNvbnRhY3Q6IGZ1bmN0aW9uIChldikgewogICAgICAgICAgICAgICAgaWYgKGV2ICYmIGV2LnByZXZlbnREZWZhdWx0KSB7IGV2LnByZXZlbnREZWZhdWx0KCk7IH0KICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSBjb25maXJtKF9fKCJBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gcmVtb3ZlIHRoaXMgY29udGFjdD8iKSk7CiAgICAgICAgICAgICAgICBpZiAocmVzdWx0ID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGJhcmVfamlkID0gdGhpcy5tb2RlbC5nZXQoJ2ppZCcpOwogICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLmNvbm5lY3Rpb24ucm9zdGVyLnJlbW92ZShiYXJlX2ppZCwgJC5wcm94eShmdW5jdGlvbiAoaXEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29udmVyc2UuY29ubmVjdGlvbi5yb3N0ZXIudW5hdXRob3JpemUoYmFyZV9qaWQpOwogICAgICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS5yb3N0ZXJ2aWV3Lm1vZGVsLnJlbW92ZShiYXJlX2ppZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuZGVzdHJveSgpOwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgICAgIH0sIHRoaXMpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGFjY2VwdFJlcXVlc3Q6IGZ1bmN0aW9uIChldikgewogICAgICAgICAgICAgICAgaWYgKGV2ICYmIGV2LnByZXZlbnREZWZhdWx0KSB7IGV2LnByZXZlbnREZWZhdWx0KCk7IH0KICAgICAgICAgICAgICAgIHZhciBqaWQgPSB0aGlzLm1vZGVsLmdldCgnamlkJyk7CiAgICAgICAgICAgICAgICBjb252ZXJzZS5jb25uZWN0aW9uLnJvc3Rlci5hdXRob3JpemUoamlkKTsKICAgICAgICAgICAgICAgIGNvbnZlcnNlLmNvbm5lY3Rpb24ucm9zdGVyLmFkZChqaWQsIHRoaXMubW9kZWwuZ2V0KCdmdWxsbmFtZScpLCBbXSwgZnVuY3Rpb24gKGlxKSB7CiAgICAgICAgICAgICAgICAgICAgY29udmVyc2UuY29ubmVjdGlvbi5yb3N0ZXIuc3Vic2NyaWJlKGppZCwgbnVsbCwgY29udmVyc2UueG1wcHN0YXR1cy5nZXQoJ2Z1bGxuYW1lJykpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBkZWNsaW5lUmVxdWVzdDogZnVuY3Rpb24gKGV2KSB7CiAgICAgICAgICAgICAgICBpZiAoZXYgJiYgZXYucHJldmVudERlZmF1bHQpIHsgZXYucHJldmVudERlZmF1bHQoKTsgfQogICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IGNvbmZpcm0oX18oIkFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBkZWNsaW5lIHRoaXMgY29udGFjdCByZXF1ZXN0PyIpKTsKICAgICAgICAgICAgICAgIGlmIChyZXN1bHQgPT09IHRydWUpIHsKICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS5jb25uZWN0aW9uLnJvc3Rlci51bmF1dGhvcml6ZSh0aGlzLm1vZGVsLmdldCgnamlkJykpOwogICAgICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuZGVzdHJveSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICByZW5kZXI6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGlmICghdGhpcy5tb2RlbC5zaG93SW5Sb3N0ZXIoKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuJGVsLmhpZGUoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy4kZWxbMF0uc3R5bGUuZGlzcGxheSA9PT0gIm5vbmUiKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kZWwuc2hvdygpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSB0aGlzLm1vZGVsLAogICAgICAgICAgICAgICAgICAgIGFzayA9IGl0ZW0uZ2V0KCdhc2snKSwKICAgICAgICAgICAgICAgICAgICBjaGF0X3N0YXR1cyA9IGl0ZW0uZ2V0KCdjaGF0X3N0YXR1cycpLAogICAgICAgICAgICAgICAgICAgIHJlcXVlc3RpbmcgID0gaXRlbS5nZXQoJ3JlcXVlc3RpbmcnKSwKICAgICAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb24gPSBpdGVtLmdldCgnc3Vic2NyaXB0aW9uJyk7CgogICAgICAgICAgICAgICAgdmFyIGNsYXNzZXNfdG9fcmVtb3ZlID0gWwogICAgICAgICAgICAgICAgICAgICdjdXJyZW50LXhtcHAtY29udGFjdCcsCiAgICAgICAgICAgICAgICAgICAgJ3BlbmRpbmcteG1wcC1jb250YWN0JywKICAgICAgICAgICAgICAgICAgICAncmVxdWVzdGluZy14bXBwLWNvbnRhY3QnCiAgICAgICAgICAgICAgICAgICAgXS5jb25jYXQoXy5rZXlzKFNUQVRVU0VTKSk7CgogICAgICAgICAgICAgICAgXy5lYWNoKGNsYXNzZXNfdG9fcmVtb3ZlLAogICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChjbHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZWwuY2xhc3NOYW1lLmluZGV4T2YoY2xzKSAhPT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJGVsLnJlbW92ZUNsYXNzKGNscyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LCB0aGlzKTsKICAgICAgICAgICAgICAgIHRoaXMuJGVsLmFkZENsYXNzKGNoYXRfc3RhdHVzKS5kYXRhKCdzdGF0dXMnLCBjaGF0X3N0YXR1cyk7CgogICAgICAgICAgICAgICAgaWYgKChhc2sgPT09ICdzdWJzY3JpYmUnKSB8fCAoc3Vic2NyaXB0aW9uID09PSAnZnJvbScpKSB7CiAgICAgICAgICAgICAgICAgICAgLyogYXNrID09PSAnc3Vic2NyaWJlJwogICAgICAgICAgICAgICAgICAgICAqICAgICAgTWVhbnMgd2UgaGF2ZSBhc2tlZCB0byBzdWJzY3JpYmUgdG8gdGhlbS4KICAgICAgICAgICAgICAgICAgICAgKgogICAgICAgICAgICAgICAgICAgICAqIHN1YnNjcmlwdGlvbiA9PT0gJ2Zyb20nCiAgICAgICAgICAgICAgICAgICAgICogICAgICBUaGV5IGFyZSBzdWJzY3JpYmVkIHRvIHVzZSwgYnV0IG5vdCB2aWNlIHZlcnNhLgogICAgICAgICAgICAgICAgICAgICAqICAgICAgV2UgYXNzdW1lIHRoYXQgdGhlcmUgaXMgYSBwZW5kaW5nIHN1YnNjcmlwdGlvbgogICAgICAgICAgICAgICAgICAgICAqICAgICAgZnJvbSB1cyB0byB0aGVtIChvdGhlcndpc2Ugd2UncmUgaW4gYSBzdGF0ZSBub3QKICAgICAgICAgICAgICAgICAgICAgKiAgICAgIHN1cHBvcnRlZCBieSBjb252ZXJzZS5qcykuCiAgICAgICAgICAgICAgICAgICAgICoKICAgICAgICAgICAgICAgICAgICAgKiAgU28gaW4gYm90aCBjYXNlcyB0aGUgdXNlciBpcyBhICJwZW5kaW5nIiBjb250YWN0LgogICAgICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgICAgIHRoaXMuJGVsLmFkZENsYXNzKCdwZW5kaW5nLXhtcHAtY29udGFjdCcpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuJGVsLmh0bWwoY29udmVyc2UudGVtcGxhdGVzLnBlbmRpbmdfY29udGFjdCgKICAgICAgICAgICAgICAgICAgICAgICAgXy5leHRlbmQoaXRlbS50b0pTT04oKSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Rlc2NfcmVtb3ZlJzogX18oJ0NsaWNrIHRvIHJlbW92ZSB0aGlzIGNvbnRhY3QnKQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICkpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXF1ZXN0aW5nID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kZWwuYWRkQ2xhc3MoJ3JlcXVlc3RpbmcteG1wcC1jb250YWN0Jyk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kZWwuaHRtbChjb252ZXJzZS50ZW1wbGF0ZXMucmVxdWVzdGluZ19jb250YWN0KAogICAgICAgICAgICAgICAgICAgICAgICBfLmV4dGVuZChpdGVtLnRvSlNPTigpLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGVzY19hY2NlcHQnOiBfXygiQ2xpY2sgdG8gYWNjZXB0IHRoaXMgY29udGFjdCByZXF1ZXN0IiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGVzY19kZWNsaW5lJzogX18oIkNsaWNrIHRvIGRlY2xpbmUgdGhpcyBjb250YWN0IHJlcXVlc3QiKQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICkpOwogICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLmNvbnRyb2xib3h0b2dnbGUuc2hvd0NvbnRyb2xCb3goKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc3Vic2NyaXB0aW9uID09PSAnYm90aCcgfHwgc3Vic2NyaXB0aW9uID09PSAndG8nKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kZWwuYWRkQ2xhc3MoJ2N1cnJlbnQteG1wcC1jb250YWN0Jyk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kZWwuaHRtbChjb252ZXJzZS50ZW1wbGF0ZXMucm9zdGVyX2l0ZW0oCiAgICAgICAgICAgICAgICAgICAgICAgIF8uZXh0ZW5kKGl0ZW0udG9KU09OKCksIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkZXNjX3N0YXR1cyc6IFNUQVRVU0VTW2NoYXRfc3RhdHVzfHwnb2ZmbGluZSddLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Rlc2NfY2hhdCc6IF9fKCdDbGljayB0byBjaGF0IHdpdGggdGhpcyBjb250YWN0JyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGVzY19yZW1vdmUnOiBfXygnQ2xpY2sgdG8gcmVtb3ZlIHRoaXMgY29udGFjdCcpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICB0aGlzLlJvc3RlckNvbnRhY3RzID0gQmFja2JvbmUuQ29sbGVjdGlvbi5leHRlbmQoewogICAgICAgICAgICBtb2RlbDogY29udmVyc2UuUm9zdGVyQ29udGFjdCwKICAgICAgICAgICAgY29tcGFyYXRvcjogZnVuY3Rpb24gKGNvbnRhY3QxLCBjb250YWN0MikgewogICAgICAgICAgICAgICAgdmFyIG5hbWUxLCBuYW1lMjsKICAgICAgICAgICAgICAgIHZhciBzdGF0dXMxID0gY29udGFjdDEuZ2V0KCdjaGF0X3N0YXR1cycpIHx8ICdvZmZsaW5lJzsKICAgICAgICAgICAgICAgIHZhciBzdGF0dXMyID0gY29udGFjdDIuZ2V0KCdjaGF0X3N0YXR1cycpIHx8ICdvZmZsaW5lJzsKICAgICAgICAgICAgICAgIGlmIChTVEFUVVNfV0VJR0hUU1tzdGF0dXMxXSA9PT0gU1RBVFVTX1dFSUdIVFNbc3RhdHVzMl0pIHsKICAgICAgICAgICAgICAgICAgICBuYW1lMSA9IGNvbnRhY3QxLmdldCgnZnVsbG5hbWUnKS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgICAgIG5hbWUyID0gY29udGFjdDIuZ2V0KCdmdWxsbmFtZScpLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5hbWUxIDwgbmFtZTIgPyAtMSA6IChuYW1lMSA+IG5hbWUyPyAxIDogMCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gU1RBVFVTX1dFSUdIVFNbc3RhdHVzMV0gPCBTVEFUVVNfV0VJR0hUU1tzdGF0dXMyXSA/IC0xIDogMTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHN1YnNjcmliZVRvU3VnZ2VzdGVkSXRlbXM6IGZ1bmN0aW9uIChtc2cpIHsKICAgICAgICAgICAgICAgICQobXNnKS5maW5kKCdpdGVtJykuZWFjaChmdW5jdGlvbiAoaSwgaXRlbXMpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgJHRoaXMgPSAkKHRoaXMpLAogICAgICAgICAgICAgICAgICAgICAgICBqaWQgPSAkdGhpcy5hdHRyKCdqaWQnKSwKICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uID0gJHRoaXMuYXR0cignYWN0aW9uJyksCiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGxuYW1lID0gJHRoaXMuYXR0cignbmFtZScpOwogICAgICAgICAgICAgICAgICAgIGlmIChhY3Rpb24gPT09ICdhZGQnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLmNvbm5lY3Rpb24ucm9zdGVyLnN1YnNjcmliZShqaWQsIG51bGwsIGNvbnZlcnNlLnhtcHBzdGF0dXMuZ2V0KCdmdWxsbmFtZScpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgaXNTZWxmOiBmdW5jdGlvbiAoamlkKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gKFN0cm9waGUuZ2V0QmFyZUppZEZyb21KaWQoamlkKSA9PT0gU3Ryb3BoZS5nZXRCYXJlSmlkRnJvbUppZChjb252ZXJzZS5jb25uZWN0aW9uLmppZCkpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgYWRkUmVzb3VyY2U6IGZ1bmN0aW9uIChiYXJlX2ppZCwgcmVzb3VyY2UpIHsKICAgICAgICAgICAgICAgIHZhciBpdGVtID0gdGhpcy5nZXQoYmFyZV9qaWQpLAogICAgICAgICAgICAgICAgICAgIHJlc291cmNlczsKICAgICAgICAgICAgICAgIGlmIChpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VzID0gaXRlbS5nZXQoJ3Jlc291cmNlcycpOwogICAgICAgICAgICAgICAgICAgIGlmIChyZXNvdXJjZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF8uaW5kZXhPZihyZXNvdXJjZXMsIHJlc291cmNlKSA9PSAtMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VzLnB1c2gocmVzb3VyY2UpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5zZXQoeydyZXNvdXJjZXMnOiByZXNvdXJjZXN9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSAgewogICAgICAgICAgICAgICAgICAgICAgICBpdGVtLnNldCh7J3Jlc291cmNlcyc6IFtyZXNvdXJjZV19KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICByZW1vdmVSZXNvdXJjZTogZnVuY3Rpb24gKGJhcmVfamlkLCByZXNvdXJjZSkgewogICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSB0aGlzLmdldChiYXJlX2ppZCksCiAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VzLAogICAgICAgICAgICAgICAgICAgIGlkeDsKICAgICAgICAgICAgICAgIGlmIChpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VzID0gaXRlbS5nZXQoJ3Jlc291cmNlcycpOwogICAgICAgICAgICAgICAgICAgIGlkeCA9IF8uaW5kZXhPZihyZXNvdXJjZXMsIHJlc291cmNlKTsKICAgICAgICAgICAgICAgICAgICBpZiAoaWR4ICE9PSAtMSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZXMuc3BsaWNlKGlkeCwgMSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uc2V0KHsncmVzb3VyY2VzJzogcmVzb3VyY2VzfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNvdXJjZXMubGVuZ3RoOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgc3Vic2NyaWJlQmFjazogZnVuY3Rpb24gKGppZCkgewogICAgICAgICAgICAgICAgdmFyIGJhcmVfamlkID0gU3Ryb3BoZS5nZXRCYXJlSmlkRnJvbUppZChqaWQpOwogICAgICAgICAgICAgICAgaWYgKGNvbnZlcnNlLmNvbm5lY3Rpb24ucm9zdGVyLmZpbmRJdGVtKGJhcmVfamlkKSkgewogICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLmNvbm5lY3Rpb24ucm9zdGVyLmF1dGhvcml6ZShiYXJlX2ppZCk7CiAgICAgICAgICAgICAgICAgICAgY29udmVyc2UuY29ubmVjdGlvbi5yb3N0ZXIuc3Vic2NyaWJlKGppZCwgbnVsbCwgY29udmVyc2UueG1wcHN0YXR1cy5nZXQoJ2Z1bGxuYW1lJykpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS5jb25uZWN0aW9uLnJvc3Rlci5hZGQoamlkLCAnJywgW10sIGZ1bmN0aW9uIChpcSkgewogICAgICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS5jb25uZWN0aW9uLnJvc3Rlci5hdXRob3JpemUoYmFyZV9qaWQpOwogICAgICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS5jb25uZWN0aW9uLnJvc3Rlci5zdWJzY3JpYmUoamlkLCBudWxsLCBjb252ZXJzZS54bXBwc3RhdHVzLmdldCgnZnVsbG5hbWUnKSk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICB1bnN1YnNjcmliZTogZnVuY3Rpb24gKGppZCkgewogICAgICAgICAgICAgICAgLyogVXBvbiByZWNlaXZpbmcgdGhlIHByZXNlbmNlIHN0YW56YSBvZiB0eXBlICJ1bnN1YnNjcmliZWQiLAogICAgICAgICAgICAgICAgKiB0aGUgdXNlciBTSE9VTEQgYWNrbm93bGVkZ2UgcmVjZWlwdCBvZiB0aGF0IHN1YnNjcmlwdGlvbiBzdGF0ZQogICAgICAgICAgICAgICAgKiBub3RpZmljYXRpb24gYnkgc2VuZGluZyBhIHByZXNlbmNlIHN0YW56YSBvZiB0eXBlICJ1bnN1YnNjcmliZSIKICAgICAgICAgICAgICAgICogdGhpcyBzdGVwIGxldHMgdGhlIHVzZXIncyBzZXJ2ZXIga25vdyB0aGF0IGl0IE1VU1Qgbm8gbG9uZ2VyCiAgICAgICAgICAgICAgICAqIHNlbmQgbm90aWZpY2F0aW9uIG9mIHRoZSBzdWJzY3JpcHRpb24gc3RhdGUgY2hhbmdlIHRvIHRoZSB1c2VyLgogICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgIGNvbnZlcnNlLnhtcHBzdGF0dXMuc2VuZFByZXNlbmNlKCd1bnN1YnNjcmliZScpOwogICAgICAgICAgICAgICAgaWYgKGNvbnZlcnNlLmNvbm5lY3Rpb24ucm9zdGVyLmZpbmRJdGVtKGppZCkpIHsKICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS5jb25uZWN0aW9uLnJvc3Rlci5yZW1vdmUoamlkLCBmdW5jdGlvbiAoaXEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29udmVyc2Uucm9zdGVydmlldy5tb2RlbC5yZW1vdmUoamlkKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGdldE51bU9ubGluZUNvbnRhY3RzOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB2YXIgY291bnQgPSAwLAogICAgICAgICAgICAgICAgICAgIGlnbm9yZWQgPSBbJ29mZmxpbmUnLCAndW5hdmFpbGFibGUnXSwKICAgICAgICAgICAgICAgICAgICBtb2RlbHMgPSB0aGlzLm1vZGVscywKICAgICAgICAgICAgICAgICAgICBtb2RlbHNfbGVuZ3RoID0gbW9kZWxzLmxlbmd0aCwKICAgICAgICAgICAgICAgICAgICBpOwogICAgICAgICAgICAgICAgaWYgKGNvbnZlcnNlLnNob3dfb25seV9vbmxpbmVfdXNlcnMpIHsKICAgICAgICAgICAgICAgICAgICBpZ25vcmVkID0gXy51bmlvbihpZ25vcmVkLCBbJ2RuZCcsICd4YScsICdhd2F5J10pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZm9yIChpPTA7IGk8bW9kZWxzX2xlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKF8uaW5kZXhPZihpZ25vcmVkLCBtb2RlbHNbaV0uZ2V0KCdjaGF0X3N0YXR1cycpKSA9PT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY291bnQrKzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gY291bnQ7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBjbGVhckNhY2hlOiBmdW5jdGlvbiAoaXRlbXMpIHsKICAgICAgICAgICAgICAgIC8qIFRoZSBsb2NhbHN0b3JhZ2UgY2FjaGUgY29udGFpbmluZyByb3N0ZXIgY29udGFjdHMgbWlnaHQgY29udGFpbgogICAgICAgICAgICAgICAgKiBzb21lIGNvbnRhY3RzIHRoYXQgYXJlbid0IGFjdHVhbGx5IGluIG91ciByb3N0ZXIgYW55bW9yZS4gV2UKICAgICAgICAgICAgICAgICogdGhlcmVmb3JlIG5lZWQgdG8gcmVtb3ZlIHRoZW0gbm93LgogICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgIHZhciBpZCwgaSwgY29udGFjdDsKICAgICAgICAgICAgICAgIGZvciAoaT0wOyBpIDwgdGhpcy5tb2RlbHMubGVuZ3RoOyArK2kpIHsKICAgICAgICAgICAgICAgICAgICBpZCA9IHRoaXMubW9kZWxzW2ldLmdldCgnaWQnKTsKICAgICAgICAgICAgICAgICAgICBpZiAoXy5pbmRleE9mKF8ucGx1Y2soaXRlbXMsICdqaWQnKSwgaWQpID09PSAtMSkgewogICAgICAgICAgICAgICAgICAgICAgICBjb250YWN0ID0gdGhpcy5nZXQoaWQpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29udGFjdCAmJiAhY29udGFjdC5nZXQoJ3JlcXVlc3RpbmcnKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGFjdC5kZXN0cm95KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICAvLyBUT0RPOiBzZWUgaWYgd2UgY2FuIG9ubHkgdXNlIDJuZCBpdGVtIHBhcgogICAgICAgICAgICByb3N0ZXJIYW5kbGVyOiBmdW5jdGlvbiAoaXRlbXMsIGl0ZW0pIHsKICAgICAgICAgICAgICAgIGNvbnZlcnNlLmVtaXQoJ3Jvc3RlcicsIGl0ZW1zKTsKICAgICAgICAgICAgICAgIHRoaXMuY2xlYXJDYWNoZShpdGVtcyk7CiAgICAgICAgICAgICAgICB2YXIgbmV3X2l0ZW1zID0gaXRlbSA/IFtpdGVtXSA6IGl0ZW1zOwogICAgICAgICAgICAgICAgXy5lYWNoKG5ld19pdGVtcywgZnVuY3Rpb24gKGl0ZW0sIGluZGV4LCBpdGVtcykgewogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzU2VsZihpdGVtLmppZCkpIHsgcmV0dXJuOyB9CiAgICAgICAgICAgICAgICAgICAgdmFyIG1vZGVsID0gdGhpcy5nZXQoaXRlbS5qaWQpOwogICAgICAgICAgICAgICAgICAgIGlmICghbW9kZWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGlzX2xhc3QgPSAoaW5kZXggPT09IChpdGVtcy5sZW5ndGgtMSkpID8gdHJ1ZSA6IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoKGl0ZW0uc3Vic2NyaXB0aW9uID09PSAnbm9uZScpICYmIChpdGVtLmFzayA9PT0gbnVsbCkgJiYgIWlzX2xhc3QpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFdlJ3JlIG5vdCBpbnRlcmVzdGVkIGluIHpvbWJpZXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIChIYWNrOiBleGNlcHQgaWYgaXQncyB0aGUgbGFzdCBpdGVtLCB0aGVuIHdlIHN0aWxsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBhZGQgaXQgc28gdGhhdCB0aGUgcm9zdGVyIHdpbGwgYmUgc2hvd24pLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzazogaXRlbS5hc2ssCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdWxsbmFtZTogaXRlbS5uYW1lIHx8IGl0ZW0uamlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JvdXBzOiBpdGVtLmdyb3VwcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGppZDogaXRlbS5qaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb246IGl0ZW0uc3Vic2NyaXB0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgIH0sIHtzb3J0OiBmYWxzZX0pOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoaXRlbS5zdWJzY3JpcHRpb24gPT09ICdub25lJykgJiYgKGl0ZW0uYXNrID09PSBudWxsKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyB1c2VyIGlzIG5vIGxvbmdlciBpbiBvdXIgcm9zdGVyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RlbC5kZXN0cm95KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBXZSBvbmx5IGZpbmQgb3V0IGFib3V0IHJlcXVlc3RpbmcgY29udGFjdHMgdmlhIHRoZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gcHJlc2VuY2UgaGFuZGxlciwgc28gaWYgd2UgcmVjZWl2ZSBhIGNvbnRhY3QKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGhlcmUsIHdlIGtub3cgdGhleSBhcmVuJ3QgcmVxdWVzdGluZyBhbnltb3JlLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2VlIGRvY3MvREVWRUxPUEVSLnJzdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kZWwuc2F2ZSh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uOiBpdGVtLnN1YnNjcmlwdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhc2s6IGl0ZW0uYXNrLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3Rpbmc6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JvdXBzOiBpdGVtLmdyb3VwcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCB0aGlzKTsKCiAgICAgICAgICAgICAgICBpZiAoIWNvbnZlcnNlLmluaXRpYWxfcHJlc2VuY2Vfc2VudCkgewogICAgICAgICAgICAgICAgICAgIC8qIE9uY2Ugd2UndmUgc2VudCBvdXQgb3VyIGluaXRpYWwgcHJlc2VuY2Ugc3RhbnphLCB3ZSdsbAogICAgICAgICAgICAgICAgICAgICAqIHN0YXJ0IHJlY2VpdmluZyBwcmVzZW5jZSBzdGFuemFzIGZyb20gb3VyIGNvbnRhY3RzLgogICAgICAgICAgICAgICAgICAgICAqIFdlIHRoZXJlZm9yZSBvbmx5IHdhbnQgdG8gZG8gdGhpcyBhZnRlciBvdXIgcm9zdGVyIGhhcwogICAgICAgICAgICAgICAgICAgICAqIGJlZW4gc2V0IHVwIChvdGhlcndpc2Ugd2UgY2FuJ3QgbWVhbmluZ2Z1bGx5IHByb2Nlc3MKICAgICAgICAgICAgICAgICAgICAgKiBpbmNvbWluZyBwcmVzZW5jZSBzdGFuemFzKS4KICAgICAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS5pbml0aWFsX3ByZXNlbmNlX3NlbnQgPSAxOwogICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLnhtcHBzdGF0dXMuc2VuZFByZXNlbmNlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBoYW5kbGVJbmNvbWluZ1N1YnNjcmlwdGlvbjogZnVuY3Rpb24gKGppZCkgewogICAgICAgICAgICAgICAgdmFyIGJhcmVfamlkID0gU3Ryb3BoZS5nZXRCYXJlSmlkRnJvbUppZChqaWQpOwogICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSB0aGlzLmdldChiYXJlX2ppZCk7CgogICAgICAgICAgICAgICAgaWYgKCFjb252ZXJzZS5hbGxvd19jb250YWN0X3JlcXVlc3RzKSB7CiAgICAgICAgICAgICAgICAgICAgY29udmVyc2UuY29ubmVjdGlvbi5yb3N0ZXIudW5hdXRob3JpemUoYmFyZV9qaWQpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGNvbnZlcnNlLmF1dG9fc3Vic2NyaWJlKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCghaXRlbSkgfHwgKGl0ZW0uZ2V0KCdzdWJzY3JpcHRpb24nKSAhPSAndG8nKSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN1YnNjcmliZUJhY2soamlkKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS5jb25uZWN0aW9uLnJvc3Rlci5hdXRob3JpemUoYmFyZV9qaWQpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKChpdGVtKSAmJiAoaXRlbS5nZXQoJ3N1YnNjcmlwdGlvbicpICE9ICdub25lJykpICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLmNvbm5lY3Rpb24ucm9zdGVyLmF1dGhvcml6ZShiYXJlX2ppZCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLmdldChiYXJlX2ppZCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLmdldFZDYXJkKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhcmVfamlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQucHJveHkoZnVuY3Rpb24gKGppZCwgZnVsbG5hbWUsIGltZywgaW1nX3R5cGUsIHVybCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqaWQ6IGJhcmVfamlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uOiAnbm9uZScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhc2s6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0aW5nOiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVsbG5hbWU6IGZ1bGxuYW1lIHx8IGppZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltYWdlOiBpbWcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbWFnZV90eXBlOiBpbWdfdHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybDogdXJsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmNhcmRfdXBkYXRlZDogbW9tZW50KCkuZm9ybWF0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgdGhpcyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJC5wcm94eShmdW5jdGlvbiAoamlkLCBpcSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS5sb2coIkVycm9yIHdoaWxlIHJldHJpZXZpbmcgdmNhcmQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGQoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgamlkOiBiYXJlX2ppZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1YnNjcmlwdGlvbjogJ25vbmUnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXNrOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdGluZzogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGxuYW1lOiBiYXJlX2ppZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZjYXJkX3VwZGF0ZWQ6IG1vbWVudCgpLmZvcm1hdCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIHRoaXMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHByZXNlbmNlSGFuZGxlcjogZnVuY3Rpb24gKHByZXNlbmNlKSB7CiAgICAgICAgICAgICAgICB2YXIgJHByZXNlbmNlID0gJChwcmVzZW5jZSksCiAgICAgICAgICAgICAgICAgICAgcHJlc2VuY2VfdHlwZSA9ICRwcmVzZW5jZS5hdHRyKCd0eXBlJyk7CiAgICAgICAgICAgICAgICBpZiAocHJlc2VuY2VfdHlwZSA9PT0gJ2Vycm9yJykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdmFyIGppZCA9ICRwcmVzZW5jZS5hdHRyKCdmcm9tJyksCiAgICAgICAgICAgICAgICAgICAgYmFyZV9qaWQgPSBTdHJvcGhlLmdldEJhcmVKaWRGcm9tSmlkKGppZCksCiAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2UgPSBTdHJvcGhlLmdldFJlc291cmNlRnJvbUppZChqaWQpLAogICAgICAgICAgICAgICAgICAgICRzaG93ID0gJHByZXNlbmNlLmZpbmQoJ3Nob3cnKSwKICAgICAgICAgICAgICAgICAgICBjaGF0X3N0YXR1cyA9ICRzaG93LnRleHQoKSB8fCAnb25saW5lJywKICAgICAgICAgICAgICAgICAgICBzdGF0dXNfbWVzc2FnZSA9ICRwcmVzZW5jZS5maW5kKCdzdGF0dXMnKSwKICAgICAgICAgICAgICAgICAgICBjb250YWN0OwoKICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzU2VsZihiYXJlX2ppZCkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoKGNvbnZlcnNlLmNvbm5lY3Rpb24uamlkICE9PSBqaWQpJiYocHJlc2VuY2VfdHlwZSAhPT0gJ3VuYXZhaWxhYmxlJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gQW5vdGhlciByZXNvdXJjZSBoYXMgY2hhbmdlZCBpdCdzIHN0YXR1cywgd2UnbGwgdXBkYXRlIG91cnMgYXMgd2VsbC4KICAgICAgICAgICAgICAgICAgICAgICAgY29udmVyc2UueG1wcHN0YXR1cy5zYXZlKHsnc3RhdHVzJzogY2hhdF9zdGF0dXN9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCgkcHJlc2VuY2UuZmluZCgneCcpLmF0dHIoJ3htbG5zJykgfHwgJycpLmluZGV4T2YoU3Ryb3BoZS5OUy5NVUMpID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7IC8vIElnbm9yZSBNVUMKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvbnRhY3QgPSB0aGlzLmdldChiYXJlX2ppZCk7CiAgICAgICAgICAgICAgICBpZiAoY29udGFjdCAmJiAoc3RhdHVzX21lc3NhZ2UudGV4dCgpICE9IGNvbnRhY3QuZ2V0KCdzdGF0dXMnKSkpIHsKICAgICAgICAgICAgICAgICAgICBjb250YWN0LnNhdmUoeydzdGF0dXMnOiBzdGF0dXNfbWVzc2FnZS50ZXh0KCl9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICgocHJlc2VuY2VfdHlwZSA9PT0gJ3N1YnNjcmliZWQnKSB8fCAocHJlc2VuY2VfdHlwZSA9PT0gJ3Vuc3Vic2NyaWJlJykpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocHJlc2VuY2VfdHlwZSA9PT0gJ3N1YnNjcmliZScpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5oYW5kbGVJbmNvbWluZ1N1YnNjcmlwdGlvbihqaWQpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChwcmVzZW5jZV90eXBlID09PSAndW5zdWJzY3JpYmVkJykgewogICAgICAgICAgICAgICAgICAgIHRoaXMudW5zdWJzY3JpYmUoYmFyZV9qaWQpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChwcmVzZW5jZV90eXBlID09PSAndW5hdmFpbGFibGUnKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucmVtb3ZlUmVzb3VyY2UoYmFyZV9qaWQsIHJlc291cmNlKSA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29udGFjdCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGFjdC5zYXZlKHsnY2hhdF9zdGF0dXMnOiAnb2ZmbGluZSd9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY29udGFjdCkgewogICAgICAgICAgICAgICAgICAgIC8vIHByZXNlbmNlX3R5cGUgaXMgdW5kZWZpbmVkCiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGRSZXNvdXJjZShiYXJlX2ppZCwgcmVzb3VyY2UpOwogICAgICAgICAgICAgICAgICAgIGNvbnRhY3Quc2F2ZSh7J2NoYXRfc3RhdHVzJzogY2hhdF9zdGF0dXN9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIHRoaXMuUm9zdGVyR3JvdXAgPSBCYWNrYm9uZS5Nb2RlbC5leHRlbmQoewogICAgICAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbiAoYXR0cmlidXRlcywgb3B0aW9ucykgewogICAgICAgICAgICAgICAgdGhpcy5zZXQoXy5leHRlbmQoewogICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBERVNDX0dST1VQX1RPR0dMRSwKICAgICAgICAgICAgICAgICAgICBzdGF0ZTogT1BFTkVECiAgICAgICAgICAgICAgICB9LCBhdHRyaWJ1dGVzKSk7CiAgICAgICAgICAgICAgICAvLyBDb2xsZWN0aW9uIG9mIGNvbnRhY3RzIGJlbG9uZ2luZyB0byB0aGlzIGdyb3VwLgogICAgICAgICAgICAgICAgdGhpcy5jb250YWN0cyA9IG5ldyBjb252ZXJzZS5Sb3N0ZXJDb250YWN0cygpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIHRoaXMuUm9zdGVyR3JvdXBWaWV3ID0gQmFja2JvbmUuT3ZlcnZpZXcuZXh0ZW5kKHsKICAgICAgICAgICAgdGFnTmFtZTogJ2R0JywKICAgICAgICAgICAgY2xhc3NOYW1lOiAncm9zdGVyLWdyb3VwJywKICAgICAgICAgICAgZXZlbnRzOiB7CiAgICAgICAgICAgICAgICAiY2xpY2sgYS5ncm91cC10b2dnbGUiOiAidG9nZ2xlIgogICAgICAgICAgICB9LAoKICAgICAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5jb250YWN0cy5vbigiYWRkIiwgdGhpcy5hZGRDb250YWN0LCB0aGlzKTsKICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuY29udGFjdHMub24oImNoYW5nZTpzdWJzY3JpcHRpb24iLCB0aGlzLm9uQ29udGFjdFN1YnNjcmlwdGlvbkNoYW5nZSwgdGhpcyk7CiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLmNvbnRhY3RzLm9uKCJjaGFuZ2U6cmVxdWVzdGluZyIsIHRoaXMub25Db250YWN0UmVxdWVzdENoYW5nZSwgdGhpcyk7CiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLmNvbnRhY3RzLm9uKCJjaGFuZ2U6Y2hhdF9zdGF0dXMiLCBmdW5jdGlvbiAoY29udGFjdCkgewogICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgbWlnaHQgYmUgb3B0aW1pemVkIGJ5IGluc3RlYWQgb2YgZmlyc3Qgc29ydGluZywKICAgICAgICAgICAgICAgICAgICAvLyBmaW5kaW5nIHRoZSBjb3JyZWN0IHBvc2l0aW9uIGluIHBvc2l0aW9uQ29udGFjdAogICAgICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuY29udGFjdHMuc29ydCgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMucG9zaXRpb25Db250YWN0KGNvbnRhY3QpLnJlbmRlcigpOwogICAgICAgICAgICAgICAgfSwgdGhpcyk7CiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLmNvbnRhY3RzLm9uKCJkZXN0cm95IiwgdGhpcy5vblJlbW92ZSwgdGhpcyk7CiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLmNvbnRhY3RzLm9uKCJyZW1vdmUiLCB0aGlzLm9uUmVtb3ZlLCB0aGlzKTsKICAgICAgICAgICAgICAgIGNvbnZlcnNlLnJvc3Rlci5vbignY2hhbmdlOmdyb3VwcycsIHRoaXMub25Db250YWN0R3JvdXBDaGFuZ2UsIHRoaXMpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRlbC5hdHRyKCdkYXRhLWdyb3VwJywgdGhpcy5tb2RlbC5nZXQoJ25hbWUnKSk7CiAgICAgICAgICAgICAgICB0aGlzLiRlbC5odG1sKAogICAgICAgICAgICAgICAgICAgICQoY29udmVyc2UudGVtcGxhdGVzLmdyb3VwX2hlYWRlcih7CiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsX2dyb3VwOiB0aGlzLm1vZGVsLmdldCgnbmFtZScpLAogICAgICAgICAgICAgICAgICAgICAgICBkZXNjX2dyb3VwX3RvZ2dsZTogdGhpcy5tb2RlbC5nZXQoJ2Rlc2NyaXB0aW9uJyksCiAgICAgICAgICAgICAgICAgICAgICAgIHRvZ2dsZV9zdGF0ZTogdGhpcy5tb2RlbC5nZXQoJ3N0YXRlJykKICAgICAgICAgICAgICAgICAgICB9KSkKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGFkZENvbnRhY3Q6IGZ1bmN0aW9uIChjb250YWN0KSB7CiAgICAgICAgICAgICAgICB2YXIgdmlldyA9IG5ldyBjb252ZXJzZS5Sb3N0ZXJDb250YWN0Vmlldyh7bW9kZWw6IGNvbnRhY3R9KTsKICAgICAgICAgICAgICAgIHRoaXMuYWRkKGNvbnRhY3QuZ2V0KCdpZCcpLCB2aWV3KTsKICAgICAgICAgICAgICAgIHZpZXcgPSB0aGlzLnBvc2l0aW9uQ29udGFjdChjb250YWN0KS5yZW5kZXIoKTsKICAgICAgICAgICAgICAgIGlmIChjb250YWN0LnNob3dJblJvc3RlcigpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMubW9kZWwuZ2V0KCdzdGF0ZScpID09PSBDTE9TRUQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZpZXcuJGVsWzBdLnN0eWxlLmRpc3BsYXkgIT09ICJub25lIikgeyB2aWV3LiRlbC5oaWRlKCk7IH0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuJGVsWzBdLnN0eWxlLmRpc3BsYXkgPT09ICJub25lIikgeyB0aGlzLiRlbC5zaG93KCk7IH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy4kZWxbMF0uc3R5bGUuZGlzcGxheSAhPT0gImJsb2NrIikgeyB0aGlzLnNob3coKTsgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHBvc2l0aW9uQ29udGFjdDogZnVuY3Rpb24gKGNvbnRhY3QpIHsKICAgICAgICAgICAgICAgIC8qIFBsYWNlIHRoZSBjb250YWN0J3MgRE9NIGVsZW1lbnQgaW4gdGhlIGNvcnJlY3QgYWxwaGFiZXRpY2FsCiAgICAgICAgICAgICAgICAgKiBwb3NpdGlvbiBhbW9uZ3N0IHRoZSBvdGhlciBjb250YWN0cyBpbiB0aGlzIGdyb3VwLgogICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICB2YXIgdmlldyA9IHRoaXMuZ2V0KGNvbnRhY3QuZ2V0KCdpZCcpKTsKICAgICAgICAgICAgICAgIHZhciBpbmRleCA9IHRoaXMubW9kZWwuY29udGFjdHMuaW5kZXhPZihjb250YWN0KTsKICAgICAgICAgICAgICAgIHZpZXcuJGVsLmRldGFjaCgpOwogICAgICAgICAgICAgICAgaWYgKGluZGV4ID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kZWwuYWZ0ZXIodmlldy4kZWwpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpbmRleCA9PSAodGhpcy5tb2RlbC5jb250YWN0cy5sZW5ndGgtMSkpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbC5uZXh0VW50aWwoJ2R0JykubGFzdCgpLmFmdGVyKHZpZXcuJGVsKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kZWwubmV4dFVudGlsKCdkdCcpLmVxKGluZGV4KS5iZWZvcmUodmlldy4kZWwpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHZpZXc7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBzaG93OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAvLyBGSVhNRTogVGhlcmUncyBhIGJ1ZyBoZXJlLCBpZiBzaG93X29ubHlfb25saW5lX3VzZXJzIGlzIHRydWUKICAgICAgICAgICAgICAgIC8vIFBvc3NpYmxlIHNvbHV0aW9uLCBnZXQgdGhlIGdyb3VwLCBjYWxsIF8uZWFjaCBhbmQgY2hlY2sKICAgICAgICAgICAgICAgIC8vIHNob3dJblJvc3RlcgogICAgICAgICAgICAgICAgdGhpcy4kZWwubmV4dFVudGlsKCdkdCcpLmFkZEJhY2soKS5zaG93KCk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBoaWRlOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRlbC5uZXh0VW50aWwoJ2R0JykuYWRkQmFjaygpLmhpZGUoKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGZpbHRlcjogZnVuY3Rpb24gKHEpIHsKICAgICAgICAgICAgICAgIC8qIEZpbHRlciB0aGUgZ3JvdXAncyBjb250YWN0cyBiYXNlZCBvbiB0aGUgcXVlcnkgInEiLgogICAgICAgICAgICAgICAgICogVGhlIHF1ZXJ5IGlzIG1hdGNoZWQgYWdhaW5zdCB0aGUgY29udGFjdCdzIGZ1bGwgbmFtZS4KICAgICAgICAgICAgICAgICAqIElmIGFsbCBjb250YWN0cyBhcmUgZmlsdGVyZWQgb3V0IChpLmUuIGhpZGRlbiksIHRoZW4gdGhlCiAgICAgICAgICAgICAgICAgKiBncm91cCBtdXN0IGJlIGZpbHRlcmVkIG91dCBhcyB3ZWxsLgogICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICB2YXIgbWF0Y2hlcywgcmVqZWN0czsKICAgICAgICAgICAgICAgIGlmIChxLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm1vZGVsLmdldCgnc3RhdGUnKSA9PT0gT1BFTkVEKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuY29udGFjdHMuZWFjaCgkLnByb3h5KGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5zaG93SW5Sb3N0ZXIoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0KGl0ZW0uZ2V0KCdpZCcpKS4kZWwuc2hvdygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9LCB0aGlzKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0lmSW52aXNpYmxlKCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHEgPSBxLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgICAgICAgbWF0Y2hlcyA9IHRoaXMubW9kZWwuY29udGFjdHMuZmlsdGVyKGNvbnRhaW5zLm5vdCgnZnVsbG5hbWUnLCBxKSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKG1hdGNoZXMubGVuZ3RoID09PSB0aGlzLm1vZGVsLmNvbnRhY3RzLmxlbmd0aCkgeyAvLyBoaWRlIHRoZSB3aG9sZSBncm91cAogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmhpZGUoKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBfLmVhY2gobWF0Y2hlcywgJC5wcm94eShmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXQoaXRlbS5nZXQoJ2lkJykpLiRlbC5oaWRlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0sIHRoaXMpKTsKICAgICAgICAgICAgICAgICAgICAgICAgXy5lYWNoKHRoaXMubW9kZWwuY29udGFjdHMucmVqZWN0KGNvbnRhaW5zLm5vdCgnZnVsbG5hbWUnLCBxKSksICQucHJveHkoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0KGl0ZW0uZ2V0KCdpZCcpKS4kZWwuc2hvdygpOwogICAgICAgICAgICAgICAgICAgICAgICB9LCB0aGlzKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd0lmSW52aXNpYmxlKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgc2hvd0lmSW52aXNpYmxlOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuJGVsLmlzKCc6dmlzaWJsZScpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kZWwuc2hvdygpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgdG9nZ2xlOiBmdW5jdGlvbiAoZXYpIHsKICAgICAgICAgICAgICAgIGlmIChldiAmJiBldi5wcmV2ZW50RGVmYXVsdCkgeyBldi5wcmV2ZW50RGVmYXVsdCgpOyB9CiAgICAgICAgICAgICAgICB2YXIgJGVsID0gJChldi50YXJnZXQpOwogICAgICAgICAgICAgICAgaWYgKCRlbC5oYXNDbGFzcygiaWNvbi1vcGVuZWQiKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuJGVsLm5leHRVbnRpbCgnZHQnKS5zbGlkZVVwKCk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5zYXZlKHtzdGF0ZTogQ0xPU0VEfSk7CiAgICAgICAgICAgICAgICAgICAgJGVsLnJlbW92ZUNsYXNzKCJpY29uLW9wZW5lZCIpLmFkZENsYXNzKCJpY29uLWNsb3NlZCIpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkZWwucmVtb3ZlQ2xhc3MoImljb24tY2xvc2VkIikuYWRkQ2xhc3MoImljb24tb3BlbmVkIik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5zYXZlKHtzdGF0ZTogT1BFTkVEfSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5maWx0ZXIoCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLnJvc3RlcnZpZXcuJCgnLnJvc3Rlci1maWx0ZXInKS52YWwoKSwKICAgICAgICAgICAgICAgICAgICAgICAgY29udmVyc2Uucm9zdGVydmlldy4kKCcuZmlsdGVyLXR5cGUnKS52YWwoKQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBvbkNvbnRhY3RHcm91cENoYW5nZTogZnVuY3Rpb24gKGNvbnRhY3QpIHsKICAgICAgICAgICAgICAgIHZhciBpbl90aGlzX2dyb3VwID0gXy5jb250YWlucyhjb250YWN0LmdldCgnZ3JvdXBzJyksIHRoaXMubW9kZWwuZ2V0KCduYW1lJykpOwogICAgICAgICAgICAgICAgdmFyIGNpZCA9IGNvbnRhY3QuZ2V0KCdpZCcpOwogICAgICAgICAgICAgICAgdmFyIGluX3RoaXNfb3ZlcnZpZXcgPSAhdGhpcy5nZXQoY2lkKTsKICAgICAgICAgICAgICAgIGlmIChpbl90aGlzX2dyb3VwICYmICFpbl90aGlzX292ZXJ2aWV3KSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5jb250YWN0cy5yZW1vdmUoY2lkKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIWluX3RoaXNfZ3JvdXAgJiYgaW5fdGhpc19vdmVydmlldykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkQ29udGFjdChjb250YWN0KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIG9uQ29udGFjdFN1YnNjcmlwdGlvbkNoYW5nZTogZnVuY3Rpb24gKGNvbnRhY3QpIHsKICAgICAgICAgICAgICAgIGlmICgodGhpcy5tb2RlbC5nZXQoJ25hbWUnKSA9PT0gSEVBREVSX1BFTkRJTkdfQ09OVEFDVFMpICYmIGNvbnRhY3QuZ2V0KCdzdWJzY3JpcHRpb24nKSAhPT0gJ2Zyb20nKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5jb250YWN0cy5yZW1vdmUoY29udGFjdC5nZXQoJ2lkJykpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgb25Db250YWN0UmVxdWVzdENoYW5nZTogZnVuY3Rpb24gKGNvbnRhY3QpIHsKICAgICAgICAgICAgICAgIGlmICgodGhpcy5tb2RlbC5nZXQoJ25hbWUnKSA9PT0gSEVBREVSX1JFUVVFU1RJTkdfQ09OVEFDVFMpICYmICFjb250YWN0LmdldCgncmVxdWVzdGluZycpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5jb250YWN0cy5yZW1vdmUoY29udGFjdC5nZXQoJ2lkJykpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgb25SZW1vdmU6IGZ1bmN0aW9uIChjb250YWN0KSB7CiAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZShjb250YWN0LmdldCgnaWQnKSk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5tb2RlbC5jb250YWN0cy5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbC5oaWRlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgdGhpcy5Sb3N0ZXJHcm91cHMgPSBCYWNrYm9uZS5Db2xsZWN0aW9uLmV4dGVuZCh7CiAgICAgICAgICAgIG1vZGVsOiBjb252ZXJzZS5Sb3N0ZXJHcm91cCwKICAgICAgICAgICAgY29tcGFyYXRvcjogZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgICAgICAgIC8qIEdyb3VwcyBhcmUgc29ydGVkIGFscGhhYmV0aWNhbGx5LCBpZ25vcmluZyBjYXNlLgogICAgICAgICAgICAgICAgICogSG93ZXZlciwgVW5ncm91cGVkLCBSZXF1ZXN0aW5nIENvbnRhY3RzIGFuZCBQZW5kaW5nIENvbnRhY3RzCiAgICAgICAgICAgICAgICAgKiBhcHBlYXIgbGFzdCBhbmQgaW4gdGhhdCBvcmRlci4gKi8KICAgICAgICAgICAgICAgIGEgPSBhLmdldCgnbmFtZScpOwogICAgICAgICAgICAgICAgYiA9IGIuZ2V0KCduYW1lJyk7CiAgICAgICAgICAgICAgICB2YXIgc3BlY2lhbF9ncm91cHMgPSBfLmtleXMoSEVBREVSX1dFSUdIVFMpOwogICAgICAgICAgICAgICAgdmFyIGFfaXNfc3BlY2lhbCA9IF8uY29udGFpbnMoc3BlY2lhbF9ncm91cHMsIGEpOwogICAgICAgICAgICAgICAgdmFyIGJfaXNfc3BlY2lhbCA9IF8uY29udGFpbnMoc3BlY2lhbF9ncm91cHMsIGIpOwogICAgICAgICAgICAgICAgaWYgKCFhX2lzX3NwZWNpYWwgJiYgIWJfaXNfc3BlY2lhbCApIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYS50b0xvd2VyQ2FzZSgpIDwgYi50b0xvd2VyQ2FzZSgpID8gLTEgOiAoYS50b0xvd2VyQ2FzZSgpID4gYi50b0xvd2VyQ2FzZSgpID8gMSA6IDApOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhX2lzX3NwZWNpYWwgJiYgYl9pc19zcGVjaWFsKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEhFQURFUl9XRUlHSFRTW2FdIDwgSEVBREVSX1dFSUdIVFNbYl0gPyAtMSA6IChIRUFERVJfV0VJR0hUU1thXSA+IEhFQURFUl9XRUlHSFRTW2JdID8gMSA6IDApOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICghYV9pc19zcGVjaWFsICYmIGJfaXNfc3BlY2lhbCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAoYiA9PT0gSEVBREVSX0NVUlJFTlRfQ09OVEFDVFMpID8gMSA6IC0xOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhX2lzX3NwZWNpYWwgJiYgIWJfaXNfc3BlY2lhbCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAoYSA9PT0gSEVBREVSX0NVUlJFTlRfQ09OVEFDVFMpID8gLTEgOiAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIHRoaXMuUm9zdGVyVmlldyA9IEJhY2tib25lLk92ZXJ2aWV3LmV4dGVuZCh7CiAgICAgICAgICAgIHRhZ05hbWU6ICdkaXYnLAogICAgICAgICAgICBpZDogJ2NvbnZlcnNlLXJvc3RlcicsCiAgICAgICAgICAgIGV2ZW50czogewogICAgICAgICAgICAgICAgImtleWRvd24gLnJvc3Rlci1maWx0ZXIiOiAibGl2ZUZpbHRlciIsCiAgICAgICAgICAgICAgICAiY2xpY2sgLm9uWCI6ICJjbGVhckZpbHRlciIsCiAgICAgICAgICAgICAgICAibW91c2Vtb3ZlIC54IjogInRvZ2dsZVBvaW50ZXIiLAogICAgICAgICAgICAgICAgImNoYW5nZSAuZmlsdGVyLXR5cGUiOiAiY2hhbmdlRmlsdGVyVHlwZSIKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHRoaXMucmVnaXN0ZXJSb3N0ZXJIYW5kbGVyKCk7CiAgICAgICAgICAgICAgICB0aGlzLnJlZ2lzdGVyUm9zdGVyWEhhbmRsZXIoKTsKICAgICAgICAgICAgICAgIHRoaXMucmVnaXN0ZXJQcmVzZW5jZUhhbmRsZXIoKTsKICAgICAgICAgICAgICAgIGNvbnZlcnNlLnJvc3Rlci5vbigiYWRkIiwgdGhpcy5vbkNvbnRhY3RBZGQsIHRoaXMpOwogICAgICAgICAgICAgICAgY29udmVyc2Uucm9zdGVyLm9uKCdjaGFuZ2UnLCB0aGlzLm9uQ29udGFjdENoYW5nZSwgdGhpcyk7CiAgICAgICAgICAgICAgICBjb252ZXJzZS5yb3N0ZXIub24oImRlc3Ryb3kiLCB0aGlzLnVwZGF0ZSwgdGhpcyk7CiAgICAgICAgICAgICAgICBjb252ZXJzZS5yb3N0ZXIub24oInJlbW92ZSIsIHRoaXMudXBkYXRlLCB0aGlzKTsKICAgICAgICAgICAgICAgIHRoaXMubW9kZWwub24oImFkZCIsIHRoaXMub25Hcm91cEFkZCwgdGhpcyk7CiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLm9uKCJyZXNldCIsIHRoaXMucmVzZXQsIHRoaXMpOwogICAgICAgICAgICAgICAgdGhpcy4kcm9zdGVyID0gJCgnPGRsIGNsYXNzPSJyb3N0ZXItY29udGFjdHMiIHN0eWxlPSJkaXNwbGF5OiBub25lOyI+PC9kbD4nKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHVwZGF0ZTogXy5kZWJvdW5jZShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB2YXIgJGNvdW50ID0gJCgnI29ubGluZS1jb3VudCcpOwogICAgICAgICAgICAgICAgJGNvdW50LnRleHQoJygnK2NvbnZlcnNlLnJvc3Rlci5nZXROdW1PbmxpbmVDb250YWN0cygpKycpJyk7CiAgICAgICAgICAgICAgICBpZiAoISRjb3VudC5pcygnOnZpc2libGUnKSkgewogICAgICAgICAgICAgICAgICAgICRjb3VudC5zaG93KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodGhpcy4kcm9zdGVyLnBhcmVudCgpLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuJGVsLmFwcGVuZCh0aGlzLiRyb3N0ZXIuc2hvdygpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNob3dIaWRlRmlsdGVyKCk7CiAgICAgICAgICAgIH0sIGNvbnZlcnNlLmFuaW1hdGUgPyAxMDAgOiAwKSwKCiAgICAgICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdGhpcy4kZWwuaHRtbChjb252ZXJzZS50ZW1wbGF0ZXMucm9zdGVyKHsKICAgICAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcjogX18oJ1R5cGUgdG8gZmlsdGVyJyksCiAgICAgICAgICAgICAgICAgICAgbGFiZWxfY29udGFjdHM6IExBQkVMX0NPTlRBQ1RTLAogICAgICAgICAgICAgICAgICAgIGxhYmVsX2dyb3VwczogTEFCRUxfR1JPVVBTCiAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGZldGNoOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLmZldGNoKHsKICAgICAgICAgICAgICAgICAgICBzaWxlbnQ6IHRydWUsIC8vIFdlIHVzZSB0aGUgc3VjY2VzcyBoYW5kbGVyIHRvIGhhbmRsZSBncm91cHMgdGhhdCB3ZXJlIGFkZGVkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2UgbmVlZCB0byBmaXJzdCBoYXZlIGFsbCBncm91cHMgYmVmb3JlIHBvc2l0aW9uRmV0Y2hlZEdyb3VwcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2lsbCB3b3JrIHByb3Blcmx5LgogICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6ICQucHJveHkoZnVuY3Rpb24gKGNvbGxlY3Rpb24sIHJlc3AsIG9wdGlvbnMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbGxlY3Rpb24ubGVuZ3RoICE9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBvc2l0aW9uRmV0Y2hlZEdyb3Vwcyhjb2xsZWN0aW9uLCByZXNwLCBvcHRpb25zKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS5yb3N0ZXIuZmV0Y2goewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkOiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKGNvbGxlY3Rpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBYWFg6IEJpdCBvZiBhIGhhY2suCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gc3Ryb3BoZS5yb3N0ZXIgZXhwZWN0cyAuZ2V0IHRvIGJlIGNhbGxlZCBmb3IKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBldmVyeSBwYWdlIGxvYWQgc28gdGhhdCBpdHMgIml0ZW1zIiBhdHRyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZ2V0cyBwb3B1bGF0ZWQuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBpcyB2ZXJ5IGluZWZmaWNpZW50IGZvciBsYXJnZSByb3N0ZXJzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFuZCB3ZSBhbHJlYWR5IGhhdmUgdGhlIHJvc3RlciBjYWNoZWQgaW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBzZXNzaW9uU3RvcmFnZS4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGVyZWZvcmUgd2UgbWFudWFsbHkgcG9wdWxhdGUgdGhlICJpdGVtcyIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBhdHRyLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIElkZWFsbHkgd2Ugc2hvdWxkIGV2ZW50dWFsbHkgcmVwbGFjZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHN0cm9waGUucm9zdGVyIHdpdGggc29tZXRoaW5nIGJldHRlci4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29sbGVjdGlvbi5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbGxlY3Rpb24uZWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udmVyc2UuY29ubmVjdGlvbi5yb3N0ZXIuaXRlbXMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSAgICAgICAgIDogaXRlbS5nZXQoJ2Z1bGxuYW1lJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgamlkICAgICAgICAgIDogaXRlbS5nZXQoJ2ppZCcpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1YnNjcmlwdGlvbiA6IGl0ZW0uZ2V0KCdzdWJzY3JpcHRpb24nKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhc2sgICAgICAgICAgOiBpdGVtLmdldCgnYXNrJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3JvdXBzICAgICAgIDogaXRlbS5nZXQoJ2dyb3VwcycpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc291cmNlcyAgICA6IGl0ZW0uZ2V0KCdyZXNvdXJjZXMnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS5pbml0aWFsX3ByZXNlbmNlX3NlbnQgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS54bXBwc3RhdHVzLnNlbmRQcmVzZW5jZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLmNvbm5lY3Rpb24ucm9zdGVyLmdldCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSwgdGhpcykKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBjaGFuZ2VGaWx0ZXJUeXBlOiBmdW5jdGlvbiAoZXYpIHsKICAgICAgICAgICAgICAgIGlmIChldiAmJiBldi5wcmV2ZW50RGVmYXVsdCkgeyBldi5wcmV2ZW50RGVmYXVsdCgpOyB9CiAgICAgICAgICAgICAgICB0aGlzLmNsZWFyRmlsdGVyKCk7CiAgICAgICAgICAgICAgICB0aGlzLmZpbHRlcigKICAgICAgICAgICAgICAgICAgICB0aGlzLiQoJy5yb3N0ZXItZmlsdGVyJykudmFsKCksCiAgICAgICAgICAgICAgICAgICAgZXYudGFyZ2V0LnZhbHVlCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgdG9nOiBmdW5jdGlvbiAodikgewogICAgICAgICAgICAgICAgcmV0dXJuIHY/J2FkZENsYXNzJzoncmVtb3ZlQ2xhc3MnOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgdG9nZ2xlUG9pbnRlcjogZnVuY3Rpb24gKGV2KSB7CiAgICAgICAgICAgICAgICBpZiAoZXYgJiYgZXYucHJldmVudERlZmF1bHQpIHsgZXYucHJldmVudERlZmF1bHQoKTsgfQogICAgICAgICAgICAgICAgdmFyIGVsID0gZXYudGFyZ2V0OwogICAgICAgICAgICAgICAgJChlbClbdGhpcy50b2coZWwub2Zmc2V0V2lkdGgtMTggPCBldi5jbGllbnRYLWVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmxlZnQpXSgnb25YJyk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBmaWx0ZXI6IGZ1bmN0aW9uIChxdWVyeSwgdHlwZSkgewogICAgICAgICAgICAgICAgdmFyIG1hdGNoZXM7CiAgICAgICAgICAgICAgICBxdWVyeSA9IHF1ZXJ5LnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgICBpZiAodHlwZSA9PT0gJ2dyb3VwcycpIHsKICAgICAgICAgICAgICAgICAgICBfLmVhY2godGhpcy5nZXRBbGwoKSwgZnVuY3Rpb24gKHZpZXcsIGlkeCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAodmlldy5tb2RlbC5nZXQoJ25hbWUnKS50b0xvd2VyQ2FzZSgpLmluZGV4T2YocXVlcnkudG9Mb3dlckNhc2UoKSkgPT09IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aWV3LmhpZGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh2aWV3Lm1vZGVsLmNvbnRhY3RzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpZXcuc2hvdygpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIF8uZWFjaCh0aGlzLmdldEFsbCgpLCBmdW5jdGlvbiAodmlldykgewogICAgICAgICAgICAgICAgICAgICAgICB2aWV3LmZpbHRlcihxdWVyeSwgdHlwZSk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBsaXZlRmlsdGVyOiBfLmRlYm91bmNlKGZ1bmN0aW9uIChldikgewogICAgICAgICAgICAgICAgaWYgKGV2ICYmIGV2LnByZXZlbnREZWZhdWx0KSB7IGV2LnByZXZlbnREZWZhdWx0KCk7IH0KICAgICAgICAgICAgICAgIHZhciBxID0gZXYudGFyZ2V0LnZhbHVlOwogICAgICAgICAgICAgICAgdmFyIHQgPSB0aGlzLiQoJy5maWx0ZXItdHlwZScpLnZhbCgpOwogICAgICAgICAgICAgICAgJChldi50YXJnZXQpW3RoaXMudG9nKHEpXSgneCcpOwogICAgICAgICAgICAgICAgdGhpcy5maWx0ZXIocSwgdCk7CiAgICAgICAgICAgIH0sIDMwMCksCgogICAgICAgICAgICBjbGVhckZpbHRlcjogZnVuY3Rpb24gKGV2KSB7CiAgICAgICAgICAgICAgICBpZiAoZXYgJiYgZXYucHJldmVudERlZmF1bHQpIHsKICAgICAgICAgICAgICAgICAgICBldi5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgICAgICQoZXYudGFyZ2V0KS5yZW1vdmVDbGFzcygneCBvblgnKS52YWwoJycpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5maWx0ZXIoJycpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgc2hvd0hpZGVGaWx0ZXI6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGlmICghdGhpcy4kZWwuaXMoJzp2aXNpYmxlJykpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB2YXIgJGZpbHRlciA9IHRoaXMuJCgnLnJvc3Rlci1maWx0ZXInKTsKICAgICAgICAgICAgICAgIHZhciAkdHlwZSAgPSB0aGlzLiQoJy5maWx0ZXItdHlwZScpOwogICAgICAgICAgICAgICAgdmFyIHZpc2libGUgPSAkZmlsdGVyLmlzKCc6dmlzaWJsZScpOwogICAgICAgICAgICAgICAgaWYgKHZpc2libGUgJiYgJGZpbHRlci52YWwoKS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gRG9uJ3QgaGlkZSBpZiB1c2VyIGlzIGN1cnJlbnRseSBmaWx0ZXJpbmcuCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHRoaXMuJHJvc3Rlci5oYXNTY3JvbGxCYXIoKSkgewogICAgICAgICAgICAgICAgICAgIGlmICghdmlzaWJsZSkgewogICAgICAgICAgICAgICAgICAgICAgICAkZmlsdGVyLnNob3coKTsKICAgICAgICAgICAgICAgICAgICAgICAgJHR5cGUuc2hvdygpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJGZpbHRlci5oaWRlKCk7CiAgICAgICAgICAgICAgICAgICAgJHR5cGUuaGlkZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICByZXNldDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgY29udmVyc2Uucm9zdGVyLnJlc2V0KCk7CiAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZUFsbCgpOwogICAgICAgICAgICAgICAgdGhpcy4kcm9zdGVyID0gJCgnPGRsIGNsYXNzPSJyb3N0ZXItY29udGFjdHMiIHN0eWxlPSJkaXNwbGF5OiBub25lOyI+PC9kbD4nKTsKICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyKCkudXBkYXRlKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHJlZ2lzdGVyUm9zdGVySGFuZGxlcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgLy8gUmVnaXN0ZXIgaGFuZGxlcnMgdGhhdCBkZXBlbmQgb24gdGhlIHJvc3RlcgogICAgICAgICAgICAgICAgY29udmVyc2UuY29ubmVjdGlvbi5yb3N0ZXIucmVnaXN0ZXJDYWxsYmFjaygKICAgICAgICAgICAgICAgICAgICAkLnByb3h5KGNvbnZlcnNlLnJvc3Rlci5yb3N0ZXJIYW5kbGVyLCBjb252ZXJzZS5yb3N0ZXIpCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgcmVnaXN0ZXJSb3N0ZXJYSGFuZGxlcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIHQgPSAwOwogICAgICAgICAgICAgICAgY29udmVyc2UuY29ubmVjdGlvbi5hZGRIYW5kbGVyKAogICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChtc2cpIHsKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LnNldFRpbWVvdXQoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udmVyc2UuY29ubmVjdGlvbi5mbHVzaCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQucHJveHkoY29udmVyc2Uucm9zdGVyLnN1YnNjcmliZVRvU3VnZ2VzdGVkSXRlbXMsIGNvbnZlcnNlLnJvc3RlcikobXNnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0CiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgIHQgKz0gJChtc2cpLmZpbmQoJ2l0ZW0nKS5sZW5ndGgqMjUwOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICdodHRwOi8vamFiYmVyLm9yZy9wcm90b2NvbC9yb3N0ZXJ4JywgJ21lc3NhZ2UnLCBudWxsKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHJlZ2lzdGVyUHJlc2VuY2VIYW5kbGVyOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBjb252ZXJzZS5jb25uZWN0aW9uLmFkZEhhbmRsZXIoCiAgICAgICAgICAgICAgICAgICAgJC5wcm94eShmdW5jdGlvbiAocHJlc2VuY2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29udmVyc2Uucm9zdGVyLnByZXNlbmNlSGFuZGxlcihwcmVzZW5jZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgICAgIH0sIHRoaXMpLCBudWxsLCAncHJlc2VuY2UnLCBudWxsKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIG9uR3JvdXBBZGQ6IGZ1bmN0aW9uIChncm91cCkgewogICAgICAgICAgICAgICAgdmFyIHZpZXcgPSBuZXcgY29udmVyc2UuUm9zdGVyR3JvdXBWaWV3KHttb2RlbDogZ3JvdXB9KTsKICAgICAgICAgICAgICAgIHRoaXMuYWRkKGdyb3VwLmdldCgnbmFtZScpLCB2aWV3LnJlbmRlcigpKTsKICAgICAgICAgICAgICAgIHRoaXMucG9zaXRpb25Hcm91cCh2aWV3KTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIG9uQ29udGFjdEFkZDogZnVuY3Rpb24gKGNvbnRhY3QpIHsKICAgICAgICAgICAgICAgIHRoaXMuYWRkUm9zdGVyQ29udGFjdChjb250YWN0KS51cGRhdGUoKTsKICAgICAgICAgICAgICAgIGlmICghY29udGFjdC5nZXQoJ3ZjYXJkX3VwZGF0ZWQnKSkgewogICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgd2lsbCB1cGRhdGUgdGhlIHZjYXJkLCB3aGljaCB0cmlnZ2VycyBhIGNoYW5nZQogICAgICAgICAgICAgICAgICAgIC8vIHJlcXVlc3Qgd2hpY2ggd2lsbCByZXJlbmRlciB0aGUgcm9zdGVyIGNvbnRhY3QuCiAgICAgICAgICAgICAgICAgICAgY29udmVyc2UuZ2V0VkNhcmQoY29udGFjdC5nZXQoJ2ppZCcpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIG9uQ29udGFjdENoYW5nZTogZnVuY3Rpb24gKGNvbnRhY3QpIHsKICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlQ2hhdEJveChjb250YWN0KS51cGRhdGUoKTsKICAgICAgICAgICAgICAgIGlmIChfLmhhcyhjb250YWN0LmNoYW5nZWQsICdzdWJzY3JpcHRpb24nKSkgewogICAgICAgICAgICAgICAgICAgIGlmIChjb250YWN0LmNoYW5nZWQuc3Vic2NyaXB0aW9uID09ICdmcm9tJykgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZENvbnRhY3RUb0dyb3VwKGNvbnRhY3QsIEhFQURFUl9QRU5ESU5HX0NPTlRBQ1RTKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNvbnRhY3QuZ2V0KCdzdWJzY3JpcHRpb24nKSA9PT0gJ2JvdGgnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkRXhpc3RpbmdDb250YWN0KGNvbnRhY3QpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChfLmhhcyhjb250YWN0LmNoYW5nZWQsICdhc2snKSAmJiBjb250YWN0LmNoYW5nZWQuYXNrID09ICdzdWJzY3JpYmUnKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGRDb250YWN0VG9Hcm91cChjb250YWN0LCBIRUFERVJfUEVORElOR19DT05UQUNUUyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoXy5oYXMoY29udGFjdC5jaGFuZ2VkLCAnc3Vic2NyaXB0aW9uJykgJiYgY29udGFjdC5jaGFuZ2VkLnJlcXVlc3RpbmcgPT0gJ3RydWUnKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGRDb250YWN0VG9Hcm91cChjb250YWN0LCBIRUFERVJfUkVRVUVTVElOR19DT05UQUNUUyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICB1cGRhdGVDaGF0Qm94OiBmdW5jdGlvbiAoY29udGFjdCkgewogICAgICAgICAgICAgICAgdmFyIGNoYXRib3ggPSBjb252ZXJzZS5jaGF0Ym94ZXMuZ2V0KGNvbnRhY3QuZ2V0KCdqaWQnKSksCiAgICAgICAgICAgICAgICAgICAgY2hhbmdlcyA9IHt9OwogICAgICAgICAgICAgICAgaWYgKCFjaGF0Ym94KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoXy5oYXMoY29udGFjdC5jaGFuZ2VkLCAnY2hhdF9zdGF0dXMnKSkgewogICAgICAgICAgICAgICAgICAgIGNoYW5nZXMuY2hhdF9zdGF0dXMgPSBjb250YWN0LmdldCgnY2hhdF9zdGF0dXMnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChfLmhhcyhjb250YWN0LmNoYW5nZWQsICdzdGF0dXMnKSkgewogICAgICAgICAgICAgICAgICAgIGNoYW5nZXMuc3RhdHVzID0gY29udGFjdC5nZXQoJ3N0YXR1cycpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2hhdGJveC5zYXZlKGNoYW5nZXMpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBwb3NpdGlvbkZldGNoZWRHcm91cHM6IGZ1bmN0aW9uIChtb2RlbCwgcmVzcCwgb3B0aW9ucykgewogICAgICAgICAgICAgICAgLyogSW5zdGVhZCBvZiB0aHJvd2luZyBhbiBhZGQgZXZlbnQgZm9yIGVhY2ggZ3JvdXAKICAgICAgICAgICAgICAgICAgICAqIGZldGNoZWQsIHdlIHdhaXQgdW50aWwgdGhleSdyZSBhbGwgZmV0Y2hlZCBhbmQgdGhlbgogICAgICAgICAgICAgICAgICAgICogd2UgcG9zaXRpb24gdGhlbS4KICAgICAgICAgICAgICAgICAgICAqIFdvcmtzIGFyb3VuZCB0aGUgcHJvYmxlbSBvZiBwb3NpdGlvbkdyb3VwIG5vdAogICAgICAgICAgICAgICAgICAgICogd29ya2luZyB3aGVuIGFsbCBncm91cHMgYmVzaWRlcyB0aGUgb25lIGJlaW5nCiAgICAgICAgICAgICAgICAgICAgKiBwb3NpdGlvbmVkIGFyZW4ndCBhbHJlYWR5IGluIGluc2VydGVkIGludG8gdGhlCiAgICAgICAgICAgICAgICAgICAgKiByb3N0ZXIgRE9NIGVsZW1lbnQuCiAgICAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgIG1vZGVsLnNvcnQoKTsKICAgICAgICAgICAgICAgIG1vZGVsLmVhY2goJC5wcm94eShmdW5jdGlvbiAoZ3JvdXAsIGlkeCkgewogICAgICAgICAgICAgICAgICAgIHZhciB2aWV3ID0gdGhpcy5nZXQoZ3JvdXAuZ2V0KCduYW1lJykpOwogICAgICAgICAgICAgICAgICAgIGlmICghdmlldykgewogICAgICAgICAgICAgICAgICAgICAgICB2aWV3ID0gbmV3IGNvbnZlcnNlLlJvc3Rlckdyb3VwVmlldyh7bW9kZWw6IGdyb3VwfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkKGdyb3VwLmdldCgnbmFtZScpLCB2aWV3LnJlbmRlcigpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKGlkeCA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRyb3N0ZXIuYXBwZW5kKHZpZXcuJGVsKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFwcGVuZEdyb3VwKHZpZXcpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sIHRoaXMpKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHBvc2l0aW9uR3JvdXA6IGZ1bmN0aW9uICh2aWV3KSB7CiAgICAgICAgICAgICAgICAvKiBQbGFjZSB0aGUgZ3JvdXAncyBET00gZWxlbWVudCBpbiB0aGUgY29ycmVjdCBhbHBoYWJldGljYWwKICAgICAgICAgICAgICAgICAqIHBvc2l0aW9uIGFtb25nc3QgdGhlIG90aGVyIGdyb3VwcyBpbiB0aGUgcm9zdGVyLgogICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICB2YXIgJGdyb3VwcyA9IHRoaXMuJHJvc3Rlci5maW5kKCcucm9zdGVyLWdyb3VwJyksCiAgICAgICAgICAgICAgICAgICAgaW5kZXggPSAkZ3JvdXBzLmxlbmd0aCA/IHRoaXMubW9kZWwuaW5kZXhPZih2aWV3Lm1vZGVsKSA6IDA7CiAgICAgICAgICAgICAgICBpZiAoaW5kZXggPT09IDApIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRyb3N0ZXIucHJlcGVuZCh2aWV3LiRlbCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGluZGV4ID09ICh0aGlzLm1vZGVsLmxlbmd0aC0xKSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuYXBwZW5kR3JvdXAodmlldyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICQoJGdyb3Vwcy5lcShpbmRleCkpLmJlZm9yZSh2aWV3LiRlbCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGFwcGVuZEdyb3VwOiBmdW5jdGlvbiAodmlldykgewogICAgICAgICAgICAgICAgLyogQWRkIHRoZSBncm91cCBhdCB0aGUgYm90dG9tIG9mIHRoZSByb3N0ZXIKICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgdmFyICRsYXN0ID0gdGhpcy4kcm9zdGVyLmZpbmQoJy5yb3N0ZXItZ3JvdXAnKS5sYXN0KCk7CiAgICAgICAgICAgICAgICB2YXIgJHNpYmxpbmdzID0gJGxhc3Quc2libGluZ3MoJ2RkJyk7CiAgICAgICAgICAgICAgICBpZiAoJHNpYmxpbmdzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICAkc2libGluZ3MubGFzdCgpLmFmdGVyKHZpZXcuJGVsKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJGxhc3QuYWZ0ZXIodmlldy4kZWwpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBnZXRHcm91cDogZnVuY3Rpb24gKG5hbWUpIHsKICAgICAgICAgICAgICAgIC8qIFJldHVybnMgdGhlIGdyb3VwIGFzIHNwZWNpZmllZCBieSBuYW1lLgogICAgICAgICAgICAgICAgICogQ3JlYXRlcyB0aGUgZ3JvdXAgaWYgaXQgZG9lc24ndCBleGlzdC4KICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgdmFyIHZpZXcgPSAgdGhpcy5nZXQobmFtZSk7CiAgICAgICAgICAgICAgICBpZiAodmlldykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB2aWV3Lm1vZGVsOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubW9kZWwuY3JlYXRlKHtuYW1lOiBuYW1lLCBpZDogYjY0X3NoYTEobmFtZSl9KTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGFkZENvbnRhY3RUb0dyb3VwOiBmdW5jdGlvbiAoY29udGFjdCwgbmFtZSkgewogICAgICAgICAgICAgICAgdGhpcy5nZXRHcm91cChuYW1lKS5jb250YWN0cy5hZGQoY29udGFjdCk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBhZGRFeGlzdGluZ0NvbnRhY3Q6IGZ1bmN0aW9uIChjb250YWN0KSB7CiAgICAgICAgICAgICAgICB2YXIgZ3JvdXBzOwogICAgICAgICAgICAgICAgaWYgKGNvbnZlcnNlLnJvc3Rlcl9ncm91cHMpIHsKICAgICAgICAgICAgICAgICAgICBncm91cHMgPSBjb250YWN0LmdldCgnZ3JvdXBzJyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGdyb3Vwcy5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgZ3JvdXBzID0gW0hFQURFUl9VTkdST1VQRURdOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgZ3JvdXBzID0gW0hFQURFUl9DVVJSRU5UX0NPTlRBQ1RTXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIF8uZWFjaChncm91cHMsICQucHJveHkoZnVuY3Rpb24gKG5hbWUpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZENvbnRhY3RUb0dyb3VwKGNvbnRhY3QsIG5hbWUpOwogICAgICAgICAgICAgICAgfSwgdGhpcykpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgYWRkUm9zdGVyQ29udGFjdDogZnVuY3Rpb24gKGNvbnRhY3QpIHsKICAgICAgICAgICAgICAgIGlmIChjb250YWN0LmdldCgnc3Vic2NyaXB0aW9uJykgPT09ICdib3RoJyB8fCBjb250YWN0LmdldCgnc3Vic2NyaXB0aW9uJykgPT09ICd0bycpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZEV4aXN0aW5nQ29udGFjdChjb250YWN0KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKChjb250YWN0LmdldCgnYXNrJykgPT09ICdzdWJzY3JpYmUnKSB8fCAoY29udGFjdC5nZXQoJ3N1YnNjcmlwdGlvbicpID09PSAnZnJvbScpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkQ29udGFjdFRvR3JvdXAoY29udGFjdCwgSEVBREVSX1BFTkRJTkdfQ09OVEFDVFMpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY29udGFjdC5nZXQoJ3JlcXVlc3RpbmcnKSA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZENvbnRhY3RUb0dyb3VwKGNvbnRhY3QsIEhFQURFUl9SRVFVRVNUSU5HX0NPTlRBQ1RTKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICB0aGlzLlhNUFBTdGF0dXMgPSBCYWNrYm9uZS5Nb2RlbC5leHRlbmQoewogICAgICAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB0aGlzLnNldCh7CiAgICAgICAgICAgICAgICAgICAgJ3N0YXR1cycgOiB0aGlzLmdldCgnc3RhdHVzJykgfHwgJ29ubGluZScKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgdGhpcy5vbignY2hhbmdlJywgJC5wcm94eShmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmdldCgnZnVsbG5hbWUnKSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLmdldFZDYXJkKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCwgLy8gTm8gJ3RvJyBhdHRyIHdoZW4gZ2V0dGluZyBvbmUncyBvd24gdkNhcmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICQucHJveHkoZnVuY3Rpb24gKGppZCwgZnVsbG5hbWUsIGltYWdlLCBpbWFnZV90eXBlLCB1cmwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNhdmUoeydmdWxsbmFtZSc6IGZ1bGxuYW1lfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCB0aGlzKQogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoXy5oYXMoaXRlbS5jaGFuZ2VkLCAnc3RhdHVzJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29udmVyc2UuZW1pdCgnc3RhdHVzQ2hhbmdlZCcsIHRoaXMuZ2V0KCdzdGF0dXMnKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChfLmhhcyhpdGVtLmNoYW5nZWQsICdzdGF0dXNfbWVzc2FnZScpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLmVtaXQoJ3N0YXR1c01lc3NhZ2VDaGFuZ2VkJywgdGhpcy5nZXQoJ3N0YXR1c19tZXNzYWdlJykpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sIHRoaXMpKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHNlbmRQcmVzZW5jZTogZnVuY3Rpb24gKHR5cGUpIHsKICAgICAgICAgICAgICAgIGlmICh0eXBlID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICB0eXBlID0gdGhpcy5nZXQoJ3N0YXR1cycpIHx8ICdvbmxpbmUnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdmFyIHN0YXR1c19tZXNzYWdlID0gdGhpcy5nZXQoJ3N0YXR1c19tZXNzYWdlJyksCiAgICAgICAgICAgICAgICAgICAgcHJlc2VuY2U7CiAgICAgICAgICAgICAgICAvLyBNb3N0IG9mIHRoZXNlIHByZXNlbmNlIHR5cGVzIGFyZSBhY3R1YWxseSBub3QgZXhwbGljaXRseSBzZW50LAogICAgICAgICAgICAgICAgLy8gYnV0IEkgYWRkIGFsbCBvZiB0aGVtIGhlcmUgZm9yZSByZWZlcmVuY2UgYW5kIGZ1dHVyZSBwcm9vZmluZy4KICAgICAgICAgICAgICAgIGlmICgodHlwZSA9PT0gJ3VuYXZhaWxhYmxlJykgfHwKICAgICAgICAgICAgICAgICAgICAgICAgKHR5cGUgPT09ICdwcm9iZScpIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICh0eXBlID09PSAnZXJyb3InKSB8fAogICAgICAgICAgICAgICAgICAgICAgICAodHlwZSA9PT0gJ3Vuc3Vic2NyaWJlJykgfHwKICAgICAgICAgICAgICAgICAgICAgICAgKHR5cGUgPT09ICd1bnN1YnNjcmliZWQnKSB8fAogICAgICAgICAgICAgICAgICAgICAgICAodHlwZSA9PT0gJ3N1YnNjcmliZScpIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICh0eXBlID09PSAnc3Vic2NyaWJlZCcpKSB7CiAgICAgICAgICAgICAgICAgICAgcHJlc2VuY2UgPSAkcHJlcyh7J3R5cGUnOnR5cGV9KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGUgPT09ICdvbmxpbmUnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHByZXNlbmNlID0gJHByZXMoKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBwcmVzZW5jZSA9ICRwcmVzKCkuYygnc2hvdycpLnQodHlwZSkudXAoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXR1c19tZXNzYWdlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHByZXNlbmNlLmMoJ3N0YXR1cycpLnQoc3RhdHVzX21lc3NhZ2UpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvbnZlcnNlLmNvbm5lY3Rpb24uc2VuZChwcmVzZW5jZSk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBzZXRTdGF0dXM6IGZ1bmN0aW9uICh2YWx1ZSkgewogICAgICAgICAgICAgICAgdGhpcy5zZW5kUHJlc2VuY2UodmFsdWUpOwogICAgICAgICAgICAgICAgdGhpcy5zYXZlKHsnc3RhdHVzJzogdmFsdWV9KTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHNldFN0YXR1c01lc3NhZ2U6IGZ1bmN0aW9uIChzdGF0dXNfbWVzc2FnZSkgewogICAgICAgICAgICAgICAgY29udmVyc2UuY29ubmVjdGlvbi5zZW5kKCRwcmVzKCkuYygnc2hvdycpLnQodGhpcy5nZXQoJ3N0YXR1cycpKS51cCgpLmMoJ3N0YXR1cycpLnQoc3RhdHVzX21lc3NhZ2UpKTsKICAgICAgICAgICAgICAgIHRoaXMuc2F2ZSh7J3N0YXR1c19tZXNzYWdlJzogc3RhdHVzX21lc3NhZ2V9KTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLnhocl9jdXN0b21fc3RhdHVzKSB7CiAgICAgICAgICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiAgdGhpcy54aHJfY3VzdG9tX3N0YXR1c191cmwsCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdQT1NUJywKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogeydtc2cnOiBzdGF0dXNfbWVzc2FnZX0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICB0aGlzLlhNUFBTdGF0dXNWaWV3ID0gQmFja2JvbmUuVmlldy5leHRlbmQoewogICAgICAgICAgICBlbDogInNwYW4jeG1wcC1zdGF0dXMtaG9sZGVyIiwKCiAgICAgICAgICAgIGV2ZW50czogewogICAgICAgICAgICAgICAgImNsaWNrIGEuY2hvb3NlLXhtcHAtc3RhdHVzIjogInRvZ2dsZU9wdGlvbnMiLAogICAgICAgICAgICAgICAgImNsaWNrICNmYW5jeS14bXBwLXN0YXR1cy1zZWxlY3QgYS5jaGFuZ2UteG1wcC1zdGF0dXMtbWVzc2FnZSI6ICJyZW5kZXJTdGF0dXNDaGFuZ2VGb3JtIiwKICAgICAgICAgICAgICAgICJzdWJtaXQgI3NldC1jdXN0b20teG1wcC1zdGF0dXMiOiAic2V0U3RhdHVzTWVzc2FnZSIsCiAgICAgICAgICAgICAgICAiY2xpY2sgLmRyb3Bkb3duIGRkIHVsIGxpIGEiOiAic2V0U3RhdHVzIgogICAgICAgICAgICB9LAoKICAgICAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5vbigiY2hhbmdlIiwgdGhpcy51cGRhdGVTdGF0dXNVSSwgdGhpcyk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgLy8gUmVwbGFjZSB0aGUgZGVmYXVsdCBkcm9wZG93biB3aXRoIHNvbWV0aGluZyBuaWNlcgogICAgICAgICAgICAgICAgdmFyICRzZWxlY3QgPSB0aGlzLiRlbC5maW5kKCdzZWxlY3Qjc2VsZWN0LXhtcHAtc3RhdHVzJyksCiAgICAgICAgICAgICAgICAgICAgY2hhdF9zdGF0dXMgPSB0aGlzLm1vZGVsLmdldCgnc3RhdHVzJykgfHwgJ29mZmxpbmUnLAogICAgICAgICAgICAgICAgICAgIG9wdGlvbnMgPSAkKCdvcHRpb24nLCAkc2VsZWN0KSwKICAgICAgICAgICAgICAgICAgICAkb3B0aW9uc190YXJnZXQsCiAgICAgICAgICAgICAgICAgICAgb3B0aW9uc19saXN0ID0gW10sCiAgICAgICAgICAgICAgICAgICAgdGhhdCA9IHRoaXM7CiAgICAgICAgICAgICAgICB0aGlzLiRlbC5odG1sKGNvbnZlcnNlLnRlbXBsYXRlcy5jaG9vc2Vfc3RhdHVzKCkpOwogICAgICAgICAgICAgICAgdGhpcy4kZWwuZmluZCgnI2ZhbmN5LXhtcHAtc3RhdHVzLXNlbGVjdCcpCiAgICAgICAgICAgICAgICAgICAgICAgIC5odG1sKGNvbnZlcnNlLnRlbXBsYXRlcy5jaGF0X3N0YXR1cyh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc3RhdHVzX21lc3NhZ2UnOiB0aGlzLm1vZGVsLmdldCgnc3RhdHVzX21lc3NhZ2UnKSB8fCBfXygiSSBhbSAlMSRzIiwgdGhpcy5nZXRQcmV0dHlTdGF0dXMoY2hhdF9zdGF0dXMpKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjaGF0X3N0YXR1cyc6IGNoYXRfc3RhdHVzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Rlc2NfY3VzdG9tX3N0YXR1cyc6IF9fKCdDbGljayBoZXJlIHRvIHdyaXRlIGEgY3VzdG9tIHN0YXR1cyBtZXNzYWdlJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZGVzY19jaGFuZ2Vfc3RhdHVzJzogX18oJ0NsaWNrIHRvIGNoYW5nZSB5b3VyIGNoYXQgc3RhdHVzJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgIC8vIGl0ZXJhdGUgdGhyb3VnaCBhbGwgdGhlIDxvcHRpb24+IGVsZW1lbnRzIGFuZCBhZGQgb3B0aW9uIHZhbHVlcwogICAgICAgICAgICAgICAgb3B0aW9ucy5lYWNoKGZ1bmN0aW9uICgpewogICAgICAgICAgICAgICAgICAgIG9wdGlvbnNfbGlzdC5wdXNoKGNvbnZlcnNlLnRlbXBsYXRlcy5zdGF0dXNfb3B0aW9uKHsKICAgICAgICAgICAgICAgICAgICAgICAgJ3ZhbHVlJzogJCh0aGlzKS52YWwoKSwKICAgICAgICAgICAgICAgICAgICAgICAgJ3RleHQnOiB0aGlzLnRleHQKICAgICAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICRvcHRpb25zX3RhcmdldCA9IHRoaXMuJGVsLmZpbmQoIiN0YXJnZXQgZGQgdWwiKS5oaWRlKCk7CiAgICAgICAgICAgICAgICAkb3B0aW9uc190YXJnZXQuYXBwZW5kKG9wdGlvbnNfbGlzdC5qb2luKCcnKSk7CiAgICAgICAgICAgICAgICAkc2VsZWN0LnJlbW92ZSgpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICB0b2dnbGVPcHRpb25zOiBmdW5jdGlvbiAoZXYpIHsKICAgICAgICAgICAgICAgIGV2LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAkKGV2LnRhcmdldCkucGFyZW50KCkucGFyZW50KCkuc2libGluZ3MoJ2RkJykuZmluZCgndWwnKS50b2dnbGUoJ2Zhc3QnKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHJlbmRlclN0YXR1c0NoYW5nZUZvcm06IGZ1bmN0aW9uIChldikgewogICAgICAgICAgICAgICAgZXYucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgIHZhciBzdGF0dXNfbWVzc2FnZSA9IHRoaXMubW9kZWwuZ2V0KCdzdGF0dXMnKSB8fCAnb2ZmbGluZSc7CiAgICAgICAgICAgICAgICB2YXIgaW5wdXQgPSBjb252ZXJzZS50ZW1wbGF0ZXMuY2hhbmdlX3N0YXR1c19tZXNzYWdlKHsKICAgICAgICAgICAgICAgICAgICAnc3RhdHVzX21lc3NhZ2UnOiBzdGF0dXNfbWVzc2FnZSwKICAgICAgICAgICAgICAgICAgICAnbGFiZWxfY3VzdG9tX3N0YXR1cyc6IF9fKCdDdXN0b20gc3RhdHVzJyksCiAgICAgICAgICAgICAgICAgICAgJ2xhYmVsX3NhdmUnOiBfXygnU2F2ZScpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHRoaXMuJGVsLmZpbmQoJy54bXBwLXN0YXR1cycpLnJlcGxhY2VXaXRoKGlucHV0KTsKICAgICAgICAgICAgICAgIHRoaXMuJGVsLmZpbmQoJy5jdXN0b20teG1wcC1zdGF0dXMnKS5mb2N1cygpLmZvY3VzKCk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBzZXRTdGF0dXNNZXNzYWdlOiBmdW5jdGlvbiAoZXYpIHsKICAgICAgICAgICAgICAgIGV2LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICB2YXIgc3RhdHVzX21lc3NhZ2UgPSAkKGV2LnRhcmdldCkuZmluZCgnaW5wdXQnKS52YWwoKTsKICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuc2V0U3RhdHVzTWVzc2FnZShzdGF0dXNfbWVzc2FnZSk7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBzZXRTdGF0dXM6IGZ1bmN0aW9uIChldikgewogICAgICAgICAgICAgICAgZXYucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgIHZhciAkZWwgPSAkKGV2LnRhcmdldCksCiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSAkZWwuYXR0cignZGF0YS12YWx1ZScpOwogICAgICAgICAgICAgICAgaWYgKHZhbHVlID09PSAnbG9nb3V0JykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuJGVsLmZpbmQoIi5kcm9wZG93biBkZCB1bCIpLmhpZGUoKTsKICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS5sb2dPdXQoKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5zZXRTdGF0dXModmFsdWUpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuJGVsLmZpbmQoIi5kcm9wZG93biBkZCB1bCIpLmhpZGUoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGdldFByZXR0eVN0YXR1czogZnVuY3Rpb24gKHN0YXQpIHsKICAgICAgICAgICAgICAgIHZhciBwcmV0dHlfc3RhdHVzOwogICAgICAgICAgICAgICAgaWYgKHN0YXQgPT09ICdjaGF0JykgewogICAgICAgICAgICAgICAgICAgIHByZXR0eV9zdGF0dXMgPSBfXygnb25saW5lJyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHN0YXQgPT09ICdkbmQnKSB7CiAgICAgICAgICAgICAgICAgICAgcHJldHR5X3N0YXR1cyA9IF9fKCdidXN5Jyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHN0YXQgPT09ICd4YScpIHsKICAgICAgICAgICAgICAgICAgICBwcmV0dHlfc3RhdHVzID0gX18oJ2F3YXkgZm9yIGxvbmcnKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc3RhdCA9PT0gJ2F3YXknKSB7CiAgICAgICAgICAgICAgICAgICAgcHJldHR5X3N0YXR1cyA9IF9fKCdhd2F5Jyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHByZXR0eV9zdGF0dXMgPSBfXyhzdGF0KSB8fCBfXygnb25saW5lJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gcHJldHR5X3N0YXR1czsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHVwZGF0ZVN0YXR1c1VJOiBmdW5jdGlvbiAobW9kZWwpIHsKICAgICAgICAgICAgICAgIGlmICghKF8uaGFzKG1vZGVsLmNoYW5nZWQsICdzdGF0dXMnKSkgJiYgIShfLmhhcyhtb2RlbC5jaGFuZ2VkLCAnc3RhdHVzX21lc3NhZ2UnKSkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB2YXIgc3RhdCA9IG1vZGVsLmdldCgnc3RhdHVzJyk7CiAgICAgICAgICAgICAgICAvLyAjIEZvciB0cmFuc2xhdG9yczogdGhlICUxJHMgcGFydCBnZXRzIHJlcGxhY2VkIHdpdGggdGhlIHN0YXR1cwogICAgICAgICAgICAgICAgLy8gIyBFeGFtcGxlLCBJIGFtIG9ubGluZQogICAgICAgICAgICAgICAgdmFyIHN0YXR1c19tZXNzYWdlID0gbW9kZWwuZ2V0KCdzdGF0dXNfbWVzc2FnZScpIHx8IF9fKCJJIGFtICUxJHMiLCB0aGlzLmdldFByZXR0eVN0YXR1cyhzdGF0KSk7CiAgICAgICAgICAgICAgICB0aGlzLiRlbC5maW5kKCcjZmFuY3kteG1wcC1zdGF0dXMtc2VsZWN0JykuaHRtbCgKICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS50ZW1wbGF0ZXMuY2hhdF9zdGF0dXMoewogICAgICAgICAgICAgICAgICAgICAgICAnY2hhdF9zdGF0dXMnOiBzdGF0LAogICAgICAgICAgICAgICAgICAgICAgICAnc3RhdHVzX21lc3NhZ2UnOiBzdGF0dXNfbWVzc2FnZSwKICAgICAgICAgICAgICAgICAgICAgICAgJ2Rlc2NfY3VzdG9tX3N0YXR1cyc6IF9fKCdDbGljayBoZXJlIHRvIHdyaXRlIGEgY3VzdG9tIHN0YXR1cyBtZXNzYWdlJyksCiAgICAgICAgICAgICAgICAgICAgICAgICdkZXNjX2NoYW5nZV9zdGF0dXMnOiBfXygnQ2xpY2sgdG8gY2hhbmdlIHlvdXIgY2hhdCBzdGF0dXMnKQogICAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICB0aGlzLkJPU0hTZXNzaW9uID0gQmFja2JvbmUuTW9kZWw7CiAgICAgICAgdGhpcy5GZWF0dXJlID0gQmFja2JvbmUuTW9kZWw7CiAgICAgICAgdGhpcy5GZWF0dXJlcyA9IEJhY2tib25lLkNvbGxlY3Rpb24uZXh0ZW5kKHsKICAgICAgICAgICAgLyogU2VydmljZSBEaXNjb3ZlcnkKICAgICAgICAgICAgKiAtLS0tLS0tLS0tLS0tLS0tLQogICAgICAgICAgICAqIFRoaXMgY29sbGVjdGlvbiBzdG9yZXMgRmVhdHVyZSBNb2RlbHMsIHJlcHJlc2VudGluZyBmZWF0dXJlcwogICAgICAgICAgICAqIHByb3ZpZGVkIGJ5IGF2YWlsYWJsZSBYTVBQIGVudGl0aWVzIChlLmcuIHNlcnZlcnMpCiAgICAgICAgICAgICogU2VlIFhFUC0wMDMwIGZvciBtb3JlIGRldGFpbHM6IGh0dHA6Ly94bXBwLm9yZy9leHRlbnNpb25zL3hlcC0wMDMwLmh0bWwKICAgICAgICAgICAgKiBBbGwgZmVhdHVyZXMgYXJlIHNob3duIGhlcmU6IGh0dHA6Ly94bXBwLm9yZy9yZWdpc3RyYXIvZGlzY28tZmVhdHVyZXMuaHRtbAogICAgICAgICAgICAqLwogICAgICAgICAgICBtb2RlbDogY29udmVyc2UuRmVhdHVyZSwKICAgICAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdGhpcy5hZGRDbGllbnRJZGVudGl0aWVzKCkuYWRkQ2xpZW50RmVhdHVyZXMoKTsKICAgICAgICAgICAgICAgIHRoaXMuYnJvd3NlclN0b3JhZ2UgPSBuZXcgQmFja2JvbmUuQnJvd3NlclN0b3JhZ2VbY29udmVyc2Uuc3RvcmFnZV0oCiAgICAgICAgICAgICAgICAgICAgYjY0X3NoYTEoJ2NvbnZlcnNlLmZlYXR1cmVzJytjb252ZXJzZS5iYXJlX2ppZCkpOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuYnJvd3NlclN0b3JhZ2UucmVjb3Jkcy5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgICAgICAvLyBicm93c2VyU3RvcmFnZSBpcyBlbXB0eSwgc28gd2UndmUgbGlrZWx5IG5ldmVyIHF1ZXJpZWQgdGhpcwogICAgICAgICAgICAgICAgICAgIC8vIGRvbWFpbiBmb3IgZmVhdHVyZXMgeWV0CiAgICAgICAgICAgICAgICAgICAgY29udmVyc2UuY29ubmVjdGlvbi5kaXNjby5pbmZvKGNvbnZlcnNlLmRvbWFpbiwgbnVsbCwgJC5wcm94eSh0aGlzLm9uSW5mbywgdGhpcykpOwogICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLmNvbm5lY3Rpb24uZGlzY28uaXRlbXMoY29udmVyc2UuZG9tYWluLCBudWxsLCAkLnByb3h5KHRoaXMub25JdGVtcywgdGhpcykpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmZldGNoKHthZGQ6dHJ1ZX0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgYWRkQ2xpZW50SWRlbnRpdGllczogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgLyogU2VlIGh0dHA6Ly94bXBwLm9yZy9yZWdpc3RyYXIvZGlzY28tY2F0ZWdvcmllcy5odG1sCiAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgICBjb252ZXJzZS5jb25uZWN0aW9uLmRpc2NvLmFkZElkZW50aXR5KCdjbGllbnQnLCAnd2ViJywgJ0NvbnZlcnNlLmpzJyk7CiAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBhZGRDbGllbnRGZWF0dXJlczogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgLyogVGhlIHN0cm9waGUuZGlzY28uanMgcGx1Z2luIGtlZXBzIGEgbGlzdCBvZiBmZWF0dXJlcyB3aGljaAogICAgICAgICAgICAgICAgICogaXQgd2lsbCBhZHZlcnRpc2UgdG8gYW55ICNpbmZvIHF1ZXJpZXMgbWFkZSB0byBpdC4KICAgICAgICAgICAgICAgICAqCiAgICAgICAgICAgICAgICAgKiBTZWU6IGh0dHA6Ly94bXBwLm9yZy9leHRlbnNpb25zL3hlcC0wMDMwLmh0bWwjaW5mbwogICAgICAgICAgICAgICAgICoKICAgICAgICAgICAgICAgICAqIFRPRE86IHRoZXNlIGZlYXR1cmVzIG5lZWQgdG8gYmUgYWRkZWQgaW4gdGhlIHJlbGV2YW50CiAgICAgICAgICAgICAgICAgKiBmZWF0dXJlLXByb3ZpZGluZyBNb2RlbHMsIG5vdCBoZXJlCiAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgICBjb252ZXJzZS5jb25uZWN0aW9uLmRpc2NvLmFkZEZlYXR1cmUoJ2h0dHA6Ly9qYWJiZXIub3JnL3Byb3RvY29sL2NoYXRzdGF0ZXMnKTsgLy8gTGltaXRlZCBzdXBwb3J0CiAgICAgICAgICAgICAgICAgY29udmVyc2UuY29ubmVjdGlvbi5kaXNjby5hZGRGZWF0dXJlKCdodHRwOi8vamFiYmVyLm9yZy9wcm90b2NvbC9yb3N0ZXJ4Jyk7IC8vIExpbWl0ZWQgc3VwcG9ydAogICAgICAgICAgICAgICAgIGNvbnZlcnNlLmNvbm5lY3Rpb24uZGlzY28uYWRkRmVhdHVyZSgnamFiYmVyOng6Y29uZmVyZW5jZScpOwogICAgICAgICAgICAgICAgIGNvbnZlcnNlLmNvbm5lY3Rpb24uZGlzY28uYWRkRmVhdHVyZSgndXJuOnhtcHA6Y2FyYm9uczoyJyk7CiAgICAgICAgICAgICAgICAgY29udmVyc2UuY29ubmVjdGlvbi5kaXNjby5hZGRGZWF0dXJlKCd2Y2FyZC10ZW1wJyk7CiAgICAgICAgICAgICAgICAgY29udmVyc2UuY29ubmVjdGlvbi5kaXNjby5hZGRGZWF0dXJlKFN0cm9waGUuTlMuQk9TSCk7CiAgICAgICAgICAgICAgICAgY29udmVyc2UuY29ubmVjdGlvbi5kaXNjby5hZGRGZWF0dXJlKFN0cm9waGUuTlMuRElTQ09fSU5GTyk7CiAgICAgICAgICAgICAgICAgY29udmVyc2UuY29ubmVjdGlvbi5kaXNjby5hZGRGZWF0dXJlKFN0cm9waGUuTlMuTVVDKTsKICAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIG9uSXRlbXM6IGZ1bmN0aW9uIChzdGFuemEpIHsKICAgICAgICAgICAgICAgICQoc3RhbnphKS5maW5kKCdxdWVyeSBpdGVtJykuZWFjaCgkLnByb3h5KGZ1bmN0aW9uIChpZHgsIGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS5jb25uZWN0aW9uLmRpc2NvLmluZm8oCiAgICAgICAgICAgICAgICAgICAgICAgICQoaXRlbSkuYXR0cignamlkJyksCiAgICAgICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICQucHJveHkodGhpcy5vbkluZm8sIHRoaXMpKTsKICAgICAgICAgICAgICAgIH0sIHRoaXMpKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIG9uSW5mbzogZnVuY3Rpb24gKHN0YW56YSkgewogICAgICAgICAgICAgICAgdmFyICRzdGFuemEgPSAkKHN0YW56YSk7CiAgICAgICAgICAgICAgICBpZiAoKCRzdGFuemEuZmluZCgnaWRlbnRpdHlbY2F0ZWdvcnk9c2VydmVyXVt0eXBlPWltXScpLmxlbmd0aCA9PT0gMCkgJiYKICAgICAgICAgICAgICAgICAgICAoJHN0YW56YS5maW5kKCdpZGVudGl0eVtjYXRlZ29yeT1jb25mZXJlbmNlXVt0eXBlPXRleHRdJykubGVuZ3RoID09PSAwKSkgewogICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgaXNuJ3QgYW4gSU0gc2VydmVyIGNvbXBvbmVudAogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRzdGFuemEuZmluZCgnZmVhdHVyZScpLmVhY2goJC5wcm94eShmdW5jdGlvbiAoaWR4LCBmZWF0dXJlKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5jcmVhdGUoewogICAgICAgICAgICAgICAgICAgICAgICAndmFyJzogJChmZWF0dXJlKS5hdHRyKCd2YXInKSwKICAgICAgICAgICAgICAgICAgICAgICAgJ2Zyb20nOiAkc3RhbnphLmF0dHIoJ2Zyb20nKQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSwgdGhpcykpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIHRoaXMuTG9naW5QYW5lbCA9IEJhY2tib25lLlZpZXcuZXh0ZW5kKHsKICAgICAgICAgICAgdGFnTmFtZTogJ2RpdicsCiAgICAgICAgICAgIGlkOiAibG9naW4tZGlhbG9nIiwKICAgICAgICAgICAgZXZlbnRzOiB7CiAgICAgICAgICAgICAgICAnc3VibWl0IGZvcm0jY29udmVyc2UtbG9naW4nOiAnYXV0aGVudGljYXRlJwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgY29ubmVjdDogZnVuY3Rpb24gKCRmb3JtLCBqaWQsIHBhc3N3b3JkKSB7CiAgICAgICAgICAgICAgICBpZiAoJGZvcm0pIHsKICAgICAgICAgICAgICAgICAgICAkZm9ybS5maW5kKCdpbnB1dFt0eXBlPXN1Ym1pdF0nKS5oaWRlKCkuYWZ0ZXIoJzxzcGFuIGNsYXNzPSJzcGlubmVyIGxvZ2luLXN1Ym1pdCIvPicpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdmFyIHJlc291cmNlID0gU3Ryb3BoZS5nZXRSZXNvdXJjZUZyb21KaWQoamlkKTsKICAgICAgICAgICAgICAgIGlmICghcmVzb3VyY2UpIHsKICAgICAgICAgICAgICAgICAgICBqaWQgKz0gJy9jb252ZXJzZS5qcy0nICsgTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpKjEzOTc0OTgyNSkudG9TdHJpbmcoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvbnZlcnNlLmNvbm5lY3Rpb24uY29ubmVjdChqaWQsIHBhc3N3b3JkLCBjb252ZXJzZS5vbkNvbm5lY3QpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKGNmZykgewogICAgICAgICAgICAgICAgY2ZnLiRwYXJlbnQuaHRtbCh0aGlzLiRlbC5odG1sKAogICAgICAgICAgICAgICAgICAgIGNvbnZlcnNlLnRlbXBsYXRlcy5sb2dpbl9wYW5lbCh7CiAgICAgICAgICAgICAgICAgICAgICAgICdsYWJlbF91c2VybmFtZSc6IF9fKCdYTVBQL0phYmJlciBVc2VybmFtZTonKSwKICAgICAgICAgICAgICAgICAgICAgICAgJ2xhYmVsX3Bhc3N3b3JkJzogX18oJ1Bhc3N3b3JkOicpLAogICAgICAgICAgICAgICAgICAgICAgICAnbGFiZWxfbG9naW4nOiBfXygnTG9nIEluJykKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgKSk7CiAgICAgICAgICAgICAgICB0aGlzLiR0YWJzID0gY2ZnLiRwYXJlbnQucGFyZW50KCkuZmluZCgnI2NvbnRyb2xib3gtdGFicycpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB0aGlzLiR0YWJzLmFwcGVuZChjb252ZXJzZS50ZW1wbGF0ZXMubG9naW5fdGFiKHtsYWJlbF9zaWduX2luOiBfXygnU2lnbiBpbicpfSkpOwogICAgICAgICAgICAgICAgdGhpcy4kZWwuZmluZCgnaW5wdXQjamlkJykuZm9jdXMoKTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgYXV0aGVudGljYXRlOiBmdW5jdGlvbiAoZXYpIHsKICAgICAgICAgICAgICAgIGlmIChldiAmJiBldi5wcmV2ZW50RGVmYXVsdCkgeyBldi5wcmV2ZW50RGVmYXVsdCgpOyB9CiAgICAgICAgICAgICAgICB2YXIgJGZvcm0gPSAkKGV2LnRhcmdldCksCiAgICAgICAgICAgICAgICAgICAgJGppZF9pbnB1dCA9ICRmb3JtLmZpbmQoJ2lucHV0W25hbWU9amlkXScpLAogICAgICAgICAgICAgICAgICAgIGppZCA9ICRqaWRfaW5wdXQudmFsKCksCiAgICAgICAgICAgICAgICAgICAgJHB3X2lucHV0ID0gJGZvcm0uZmluZCgnaW5wdXRbbmFtZT1wYXNzd29yZF0nKSwKICAgICAgICAgICAgICAgICAgICBwYXNzd29yZCA9ICRwd19pbnB1dC52YWwoKSwKICAgICAgICAgICAgICAgICAgICAkYnN1X2lucHV0ID0gbnVsbCwKICAgICAgICAgICAgICAgICAgICBlcnJvcnMgPSBmYWxzZTsKCiAgICAgICAgICAgICAgICBpZiAoISBjb252ZXJzZS5ib3NoX3NlcnZpY2VfdXJsKSB7CiAgICAgICAgICAgICAgICAgICAgJGJzdV9pbnB1dCA9ICRmb3JtLmZpbmQoJ2lucHV0I2Jvc2hfc2VydmljZV91cmwnKTsKICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS5ib3NoX3NlcnZpY2VfdXJsID0gJGJzdV9pbnB1dC52YWwoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoISBjb252ZXJzZS5ib3NoX3NlcnZpY2VfdXJsKSAgewogICAgICAgICAgICAgICAgICAgICAgICBlcnJvcnMgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAkYnN1X2lucHV0LmFkZENsYXNzKCdlcnJvcicpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICghIGppZCkgewogICAgICAgICAgICAgICAgICAgIGVycm9ycyA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgJGppZF9pbnB1dC5hZGRDbGFzcygnZXJyb3InKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICghIHBhc3N3b3JkKSAgewogICAgICAgICAgICAgICAgICAgIGVycm9ycyA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgJHB3X2lucHV0LmFkZENsYXNzKCdlcnJvcicpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGVycm9ycykgeyByZXR1cm47IH0KICAgICAgICAgICAgICAgIHRoaXMuY29ubmVjdCgkZm9ybSwgamlkLCBwYXNzd29yZCk7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICByZW1vdmU6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHRoaXMuJHRhYnMuZW1wdHkoKTsKICAgICAgICAgICAgICAgIHRoaXMuJGVsLnBhcmVudCgpLmVtcHR5KCk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgdGhpcy5Db250cm9sQm94VG9nZ2xlID0gQmFja2JvbmUuVmlldy5leHRlbmQoewogICAgICAgICAgICB0YWdOYW1lOiAnYScsCiAgICAgICAgICAgIGNsYXNzTmFtZTogJ3RvZ2dsZS1jb250cm9sYm94JywKICAgICAgICAgICAgaWQ6ICd0b2dnbGUtY29udHJvbGJveCcsCiAgICAgICAgICAgIGV2ZW50czogewogICAgICAgICAgICAgICAgJ2NsaWNrJzogJ29uQ2xpY2snCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgICAgICAgICdocmVmJzogIiMiCiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcigpOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAkKCcjY29udmVyc2VqcycpLnByZXBlbmQodGhpcy4kZWwuaHRtbCgKICAgICAgICAgICAgICAgICAgICBjb252ZXJzZS50ZW1wbGF0ZXMuY29udHJvbGJveF90b2dnbGUoewogICAgICAgICAgICAgICAgICAgICAgICAnbGFiZWxfdG9nZ2xlJzogX18oJ1RvZ2dsZSBjaGF0JykKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgKSk7CiAgICAgICAgICAgICAgICAvLyBXZSBsZXQgdGhlIHJlbmRlciBtZXRob2Qgb2YgQ29udHJvbEJveFZpZXcgZGVjaWRlIHdoZXRoZXIKICAgICAgICAgICAgICAgIC8vIHRoZSBDb250cm9sQm94IG9yIHRoZSBUb2dnbGUgbXVzdCBiZSBzaG93bi4gVGhpcyBwcmV2ZW50cwogICAgICAgICAgICAgICAgLy8gYXJ0aWZhY3RzIChpLmUuIG9uIHBhZ2UgbG9hZCB0aGUgdG9nZ2xlIGlzIHNob3duIG9ubHkgdG8gdGhlbgogICAgICAgICAgICAgICAgLy8gc2Vjb25kcyBsYXRlciBiZSBoaWRkZW4gaW4gZmF2b3Igb2YgdGhlIGNvbnRyb2wgYm94KS4KICAgICAgICAgICAgICAgIHRoaXMuJGVsLmhpZGUoKTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgaGlkZTogZnVuY3Rpb24gKGNhbGxiYWNrKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRlbC5mYWRlT3V0KCdmYXN0JywgY2FsbGJhY2spOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgc2hvdzogZnVuY3Rpb24gKGNhbGxiYWNrKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRlbC5zaG93KCdmYXN0JywgY2FsbGJhY2spOwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgc2hvd0NvbnRyb2xCb3g6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBjb250cm9sYm94ID0gY29udmVyc2UuY2hhdGJveGVzLmdldCgnY29udHJvbGJveCcpOwogICAgICAgICAgICAgICAgaWYgKCFjb250cm9sYm94KSB7CiAgICAgICAgICAgICAgICAgICAgY29udHJvbGJveCA9IGNvbnZlcnNlLmFkZENvbnRyb2xCb3goKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChjb252ZXJzZS5jb25uZWN0aW9uLmNvbm5lY3RlZCkgewogICAgICAgICAgICAgICAgICAgIGNvbnRyb2xib3guc2F2ZSh7Y2xvc2VkOiBmYWxzZX0pOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBjb250cm9sYm94LnRyaWdnZXIoJ3Nob3cnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICBpZiAoJCgiZGl2I2NvbnRyb2xib3giKS5pcygnOnZpc2libGUnKSkgewogICAgICAgICAgICAgICAgICAgIHZhciBjb250cm9sYm94ID0gY29udmVyc2UuY2hhdGJveGVzLmdldCgnY29udHJvbGJveCcpOwogICAgICAgICAgICAgICAgICAgIGlmIChjb252ZXJzZS5jb25uZWN0aW9uLmNvbm5lY3RlZCkgewogICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sYm94LnNhdmUoe2Nsb3NlZDogdHJ1ZX0pOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xib3gudHJpZ2dlcignaGlkZScpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93Q29udHJvbEJveCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIHRoaXMuYWRkQ29udHJvbEJveCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2hhdGJveGVzLmFkZCh7CiAgICAgICAgICAgICAgICBpZDogJ2NvbnRyb2xib3gnLAogICAgICAgICAgICAgICAgYm94X2lkOiAnY29udHJvbGJveCcsCiAgICAgICAgICAgICAgICBoZWlnaHQ6IHRoaXMuZGVmYXVsdF9ib3hfaGVpZ2h0LAogICAgICAgICAgICAgICAgY2xvc2VkOiAhdGhpcy5zaG93X2NvbnRyb2xib3hfYnlfZGVmYXVsdAogICAgICAgICAgICB9KTsKICAgICAgICB9OwoKICAgICAgICB0aGlzLmluaXRDb25uZWN0aW9uID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgcmlkLCBzaWQsIGppZDsKICAgICAgICAgICAgaWYgKHRoaXMuY29ubmVjdGlvbiAmJiB0aGlzLmNvbm5lY3Rpb24uY29ubmVjdGVkKSB7CiAgICAgICAgICAgICAgICB0aGlzLm9uQ29ubmVjdGVkKCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBYWFg6IGl0J3Mgbm90IHlldCBjbGVhciB3aGF0IHRoZSBvcmRlciBvZiBwcmVmZXJlbmNlIHNob3VsZAogICAgICAgICAgICAgICAgLy8gYmUgYmV0d2VlbiBSSUQgYW5kIFNJRCByZWNlaXZlZCB2aWEgdGhlIGluaXRpYWxpemUgbWV0aG9kIG9yCiAgICAgICAgICAgICAgICAvLyB0aG9zZSByZWNlaXZlZCBmcm9tIHNlc3Npb25TdG9yYWdlLgogICAgICAgICAgICAgICAgLy8KICAgICAgICAgICAgICAgIC8vIFdoYXQgZG8geW91IHdlIGlmIHdlIHJlY2VpdmUgdmFsdWVzIGZyb20gYm90aCBhdmVudWVzPwogICAgICAgICAgICAgICAgLy8KICAgICAgICAgICAgICAgIC8vIEFsc28sIHdoYXQgZG8gd2UgZG8gd2hlbiB0aGUga2VlcGFsaXZlIHNlc3Npb24gdmFsdWVzIGFyZQogICAgICAgICAgICAgICAgLy8gZXhwaXJlZD8gRG8gd2UgdHJ5IHRvIGZhbGwgYmFjaz8KICAgICAgICAgICAgICAgIGlmICghdGhpcy5ib3NoX3NlcnZpY2VfdXJsKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3coIkVycm9yOiB5b3UgbXVzdCBzdXBwbHkgYSB2YWx1ZSBmb3IgdGhlIGJvc2hfc2VydmljZV91cmwiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuY29ubmVjdGlvbiA9IG5ldyBTdHJvcGhlLkNvbm5lY3Rpb24odGhpcy5ib3NoX3NlcnZpY2VfdXJsKTsKCiAgICAgICAgICAgICAgICBpZiAodGhpcy5wcmViaW5kKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuamlkICYmIHRoaXMuc2lkICYmIHRoaXMucmlkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29ubmVjdGlvbi5hdHRhY2godGhpcy5qaWQsIHRoaXMuc2lkLCB0aGlzLnJpZCwgdGhpcy5vbkNvbm5lY3QpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMua2VlcGFsaXZlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93KCJJZiB5b3UgdXNlIHByZWJpbmQgYW5kIGRvbid0IHVzZSBrZWVwYWxpdmUsICIrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ0aGVuIHlvdSBNVVNUIHN1cHBseSBKSUQsIFJJRCBhbmQgU0lEIHZhbHVlcyIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh0aGlzLmtlZXBhbGl2ZSkgewogICAgICAgICAgICAgICAgICAgIHJpZCA9IHRoaXMuc2Vzc2lvbi5nZXQoJ3JpZCcpOwogICAgICAgICAgICAgICAgICAgIHNpZCA9IHRoaXMuc2Vzc2lvbi5nZXQoJ3NpZCcpOwogICAgICAgICAgICAgICAgICAgIGppZCA9IHRoaXMuc2Vzc2lvbi5nZXQoJ2ppZCcpOwogICAgICAgICAgICAgICAgICAgIGlmIChyaWQgJiYgamlkICYmIHNpZCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlc3Npb24uc2F2ZSh7cmlkOiByaWR9KTsgLy8gVGhlIFJJRCBuZWVkcyB0byBiZSBpbmNyZWFzZWQgd2l0aCBlYWNoIHJlcXVlc3QuCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29ubmVjdGlvbi5hdHRhY2goamlkLCBzaWQsIHJpZCwgdGhpcy5vbkNvbm5lY3QpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5wcmViaW5kKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmNvbm5lY3Rpb247CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZW1pdCgnbm9SZXN1bWVhYmxlU2Vzc2lvbicpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIHRoaXMuX3RlYXJEb3duID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAvKiBSZW1vdmUgdGhvc2Ugdmlld3Mgd2hpY2ggYXJlIG9ubHkgYWxsb3dlZCB3aXRoIGEgdmFsaWQKICAgICAgICAgICAgICogY29ubmVjdGlvbi4KICAgICAgICAgICAgICovCiAgICAgICAgICAgIHRoaXMuaW5pdGlhbF9wcmVzZW5jZV9zZW50ID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMucm9zdGVyLm9mZigpLnJlc2V0KCk7IC8vIFJlbW92ZXMgcm9zdGVyIGNvbnRhY3RzCiAgICAgICAgICAgIHRoaXMuY29ubmVjdGlvbi5yb3N0ZXIuX2NhbGxiYWNrcyA9IFtdOyAvLyBSZW1vdmUgYWxsIFJvc3RlciBoYW5kbGVycyAoZS5nLiByb3N0ZXJIYW5kbGVyKQogICAgICAgICAgICB0aGlzLnJvc3RlcnZpZXcubW9kZWwub2ZmKCkucmVzZXQoKTsgLy8gUmVtb3ZlcyByb3N0ZXIgZ3JvdXBzCiAgICAgICAgICAgIHRoaXMucm9zdGVydmlldy51bmRlbGVnYXRlRXZlbnRzKCkucmVtb3ZlKCk7CiAgICAgICAgICAgIHRoaXMuY2hhdGJveGVzLnJlbW92ZSgpOyAvLyBEb24ndCBjYWxsIG9mZigpLCBldmVudHMgd29uJ3QgZ2V0IHJlLXJlZ2lzdGVyZWQgdXBvbiByZWNvbm5lY3QuCiAgICAgICAgICAgIGlmICh0aGlzLmZlYXR1cmVzKSB7CiAgICAgICAgICAgICAgICB0aGlzLmZlYXR1cmVzLnJlc2V0KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHRoaXMubWluaW1pemVkX2NoYXRzKSB7CiAgICAgICAgICAgICAgICB0aGlzLm1pbmltaXplZF9jaGF0cy51bmRlbGVnYXRlRXZlbnRzKCkubW9kZWwucmVzZXQoKTsKICAgICAgICAgICAgICAgIHRoaXMubWluaW1pemVkX2NoYXRzLnJlbW92ZUFsbCgpOyAvLyBSZW1vdmUgc3ViLXZpZXdzCiAgICAgICAgICAgICAgICB0aGlzLm1pbmltaXplZF9jaGF0cy50ZWFyRG93bigpLnJlbW92ZSgpOyAvLyBSZW1vdmUgb3ZlcnZpZXcKICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLm1pbmltaXplZF9jaGF0czsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9OwoKICAgICAgICB0aGlzLl9pbml0aWFsaXplID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICB0aGlzLmNoYXRib3hlcyA9IG5ldyB0aGlzLkNoYXRCb3hlcygpOwogICAgICAgICAgICB0aGlzLmNoYXRib3h2aWV3cyA9IG5ldyB0aGlzLkNoYXRCb3hWaWV3cyh7bW9kZWw6IHRoaXMuY2hhdGJveGVzfSk7CiAgICAgICAgICAgIHRoaXMuY29udHJvbGJveHRvZ2dsZSA9IG5ldyB0aGlzLkNvbnRyb2xCb3hUb2dnbGUoKTsKICAgICAgICAgICAgdGhpcy5vdHIgPSBuZXcgdGhpcy5PVFIoKTsKICAgICAgICAgICAgdGhpcy5pbml0U2Vzc2lvbigpOwogICAgICAgICAgICB0aGlzLmluaXRDb25uZWN0aW9uKCk7CiAgICAgICAgICAgIGlmICh0aGlzLmNvbm5lY3Rpb24pIHsKICAgICAgICAgICAgICAgIHRoaXMuYWRkQ29udHJvbEJveCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH07CgogICAgICAgIHRoaXMuX2luaXRpYWxpemVQbHVnaW5zID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICBfLmVhY2godGhpcy5wbHVnaW5zLCAkLnByb3h5KGZ1bmN0aW9uIChwbHVnaW4pIHsKICAgICAgICAgICAgICAgICQucHJveHkocGx1Z2luLCB0aGlzKSh0aGlzKTsKICAgICAgICAgICAgfSwgdGhpcykpOwogICAgICAgIH07CgogICAgICAgIC8vIEluaXRpYWxpemF0aW9uCiAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0KICAgICAgICAvLyBUaGlzIGlzIHRoZSBlbmQgb2YgdGhlIGluaXRpYWxpemUgbWV0aG9kLgogICAgICAgIHRoaXMuX2luaXRpYWxpemVQbHVnaW5zKCk7CiAgICAgICAgdGhpcy5faW5pdGlhbGl6ZSgpOwogICAgICAgIHRoaXMucmVnaXN0ZXJHbG9iYWxFdmVudEhhbmRsZXJzKCk7CiAgICAgICAgY29udmVyc2UuZW1pdCgnaW5pdGlhbGl6ZWQnKTsKICAgIH07CgogICAgdmFyIHdyYXBwZWRDaGF0Qm94ID0gZnVuY3Rpb24gKGNoYXRib3gpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICAnZW5kT1RSJzogJC5wcm94eShjaGF0Ym94LmVuZE9UUiwgY2hhdGJveCksCiAgICAgICAgICAgICdnZXQnOiAkLnByb3h5KGNoYXRib3guZ2V0LCBjaGF0Ym94KSwKICAgICAgICAgICAgJ2luaXRpYXRlT1RSJzogJC5wcm94eShjaGF0Ym94LmluaXRpYXRlT1RSLCBjaGF0Ym94KSwKICAgICAgICAgICAgJ21heGltaXplJzogJC5wcm94eShjaGF0Ym94Lm1heGltaXplLCBjaGF0Ym94KSwKICAgICAgICAgICAgJ21pbmltaXplJzogJC5wcm94eShjaGF0Ym94Lm1pbmltaXplLCBjaGF0Ym94KSwKICAgICAgICAgICAgJ3NldCc6ICQucHJveHkoY2hhdGJveC5zZXQsIGNoYXRib3gpCiAgICAgICAgfTsKICAgIH07CiAgICByZXR1cm4gewogICAgICAgICdnZXRCdWRkeSc6IGZ1bmN0aW9uIChqaWQpIHsKICAgICAgICAgICAgdmFyIGNvbnRhY3QgPSBjb252ZXJzZS5yb3N0ZXIuZ2V0KFN0cm9waGUuZ2V0QmFyZUppZEZyb21KaWQoamlkKSk7CiAgICAgICAgICAgIGlmIChjb250YWN0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gY29udGFjdC5hdHRyaWJ1dGVzOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICAnZ2V0Q2hhdEJveCc6IGZ1bmN0aW9uIChqaWQpIHsKICAgICAgICAgICAgdmFyIGNoYXRib3ggPSBjb252ZXJzZS5jaGF0Ym94ZXMuZ2V0KGppZCk7CiAgICAgICAgICAgIGlmIChjaGF0Ym94KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gd3JhcHBlZENoYXRCb3goY2hhdGJveCk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgICdnZXRSSUQnOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGlmIChjb252ZXJzZS5leHBvc2VfcmlkX2FuZF9zaWQgJiYgdHlwZW9mIGNvbnZlcnNlLmNvbm5lY3Rpb24gIT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gY29udmVyc2UuY29ubmVjdGlvbi5yaWQgfHwgY29udmVyc2UuY29ubmVjdGlvbi5fcHJvdG8ucmlkOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0sCiAgICAgICAgJ2dldFNJRCc6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgaWYgKGNvbnZlcnNlLmV4cG9zZV9yaWRfYW5kX3NpZCAmJiB0eXBlb2YgY29udmVyc2UuY29ubmVjdGlvbiAhPT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgICAgIHJldHVybiBjb252ZXJzZS5jb25uZWN0aW9uLnNpZCB8fCBjb252ZXJzZS5jb25uZWN0aW9uLl9wcm90by5zaWQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfSwKICAgICAgICAnaW5pdGlhbGl6ZSc6IGZ1bmN0aW9uIChzZXR0aW5ncywgY2FsbGJhY2spIHsKICAgICAgICAgICAgY29udmVyc2UuaW5pdGlhbGl6ZShzZXR0aW5ncywgY2FsbGJhY2spOwogICAgICAgIH0sCiAgICAgICAgJ2pRdWVyeSc6ICQsCiAgICAgICAgJ29wZW5DaGF0Qm94JzogZnVuY3Rpb24gKGppZCkgewogICAgICAgICAgICB2YXIgY29udGFjdCA9IGNvbnZlcnNlLnJvc3Rlci5nZXQoU3Ryb3BoZS5nZXRCYXJlSmlkRnJvbUppZChqaWQpKTsKICAgICAgICAgICAgaWYgKGNvbnRhY3QpIHsKICAgICAgICAgICAgICAgIHJldHVybiB3cmFwcGVkQ2hhdEJveChjb252ZXJzZS5jaGF0Ym94dmlld3Muc2hvd0NoYXQoY29udGFjdC5hdHRyaWJ1dGVzKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgICdvbmNlJzogZnVuY3Rpb24gKGV2dCwgaGFuZGxlcikgewogICAgICAgICAgICBjb252ZXJzZS5vbmNlKGV2dCwgaGFuZGxlcik7CiAgICAgICAgfSwKICAgICAgICAnb24nOiBmdW5jdGlvbiAoZXZ0LCBoYW5kbGVyKSB7CiAgICAgICAgICAgIGNvbnZlcnNlLm9uKGV2dCwgaGFuZGxlcik7CiAgICAgICAgfSwKICAgICAgICAnb2ZmJzogZnVuY3Rpb24gKGV2dCwgaGFuZGxlcikgewogICAgICAgICAgICBjb252ZXJzZS5vZmYoZXZ0LCBoYW5kbGVyKTsKICAgICAgICB9LAogICAgICAgICdyZWdpc3RlclBsdWdpbic6IGZ1bmN0aW9uIChuYW1lLCBjYWxsYmFjaykgewogICAgICAgICAgICBjb252ZXJzZS5wbHVnaW5zW25hbWVdID0gY2FsbGJhY2s7CiAgICAgICAgfQogICAgfTsKfSkpOwoKcmVxdWlyZS5jb25maWcoewogICAgYmFzZVVybDogJy4nLAogICAgcGF0aHM6IHsKICAgICAgICAiYmFja2JvbmUiOiAgICAgICAgICAgICAgICAgImNvbXBvbmVudHMvYmFja2JvbmUvYmFja2JvbmUiLAogICAgICAgICJiYWNrYm9uZS5icm93c2VyU3RvcmFnZSI6ICAiY29tcG9uZW50cy9iYWNrYm9uZS5icm93c2VyU3RvcmFnZS9iYWNrYm9uZS5icm93c2VyU3RvcmFnZSIsCiAgICAgICAgImJhY2tib25lLm92ZXJ2aWV3IjogICAgICAgICJjb21wb25lbnRzL2JhY2tib25lLm92ZXJ2aWV3L2JhY2tib25lLm92ZXJ2aWV3IiwKICAgICAgICAiYm9vdHN0cmFwIjogICAgICAgICAgICAgICAgImNvbXBvbmVudHMvYm9vdHN0cmFwL2Rpc3QvanMvYm9vdHN0cmFwIiwgICAgICAgICAgIC8vIFhYWDogT25seSByZXF1aXJlZCBmb3IgaHR0cHM6Ly9jb252ZXJzZWpzLm9yZyB3ZWJzaXRlCiAgICAgICAgImJvb3RzdHJhcEpTIjogICAgICAgICAgICAgICJjb21wb25lbnRzL2Jvb3RzdHJhcEpTL2luZGV4IiwgICAgICAgICAgICAgICAgICAgICAvLyBYWFg6IE9ubHkgcmVxdWlyZWQgZm9yIGh0dHBzOi8vY29udmVyc2Vqcy5vcmcgd2Vic2l0ZQogICAgICAgICJjb252ZXJzZS1kZXBlbmRlbmNpZXMiOiAgICAic3JjL2RlcHMtd2Vic2l0ZSIsCiAgICAgICAgImNvbnZlcnNlLXRlbXBsYXRlcyI6ICAgICAgICJzcmMvdGVtcGxhdGVzIiwKICAgICAgICAiZXZlbnRlbWl0dGVyIjogICAgICAgICAgICAgImNvbXBvbmVudHMvb3RyL2J1aWxkL2RlcC9ldmVudGVtaXR0ZXIiLAogICAgICAgICJqcXVlcnkiOiAgICAgICAgICAgICAgICAgICAiY29tcG9uZW50cy9qcXVlcnkvZGlzdC9qcXVlcnkiLAogICAgICAgICJqcXVlcnktcHJpdmF0ZSI6ICAgICAgICAgICAic3JjL2pxdWVyeS1wcml2YXRlIiwKICAgICAgICAianF1ZXJ5LmJyb3dzZXIiOiAgICAgICAgICAgImNvbXBvbmVudHMvanF1ZXJ5LmJyb3dzZXIvaW5kZXgiLAogICAgICAgICJqcXVlcnkuZWFzaW5nIjogICAgICAgICAgICAiY29tcG9uZW50cy9qcXVlcnktZWFzaW5nLW9yaWdpbmFsL2luZGV4IiwgICAgICAgICAgLy8gWFhYOiBPbmx5IHJlcXVpcmVkIGZvciBodHRwczovL2NvbnZlcnNlanMub3JnIHdlYnNpdGUKICAgICAgICAibW9tZW50IjogICAgICAgICAgICAgICAgICAgImNvbXBvbmVudHMvbW9tZW50anMvbW9tZW50IiwKICAgICAgICAic3Ryb3BoZSI6ICAgICAgICAgICAgICAgICAgImNvbXBvbmVudHMvc3Ryb3BoZS9zdHJvcGhlIiwKICAgICAgICAic3Ryb3BoZS5kaXNjbyI6ICAgICAgICAgICAgImNvbXBvbmVudHMvc3Ryb3BoZWpzLXBsdWdpbnMvZGlzY28vc3Ryb3BoZS5kaXNjbyIsCiAgICAgICAgInN0cm9waGUubXVjIjogICAgICAgICAgICAgICJjb21wb25lbnRzL3N0cm9waGUubXVjL2luZGV4IiwKICAgICAgICAic3Ryb3BoZS5yb3N0ZXIiOiAgICAgICAgICAgInNyYy9zdHJvcGhlLnJvc3RlciIsCiAgICAgICAgInN0cm9waGUudmNhcmQiOiAgICAgICAgICAgICJjb21wb25lbnRzL3N0cm9waGVqcy1wbHVnaW5zL3ZjYXJkL3N0cm9waGUudmNhcmQiLAogICAgICAgICJ0ZXh0IjogICAgICAgICAgICAgICAgICAgICAnY29tcG9uZW50cy9yZXF1aXJlanMtdGV4dC90ZXh0JywKICAgICAgICAidHBsIjogICAgICAgICAgICAgICAgICAgICAgJ2NvbXBvbmVudHMvcmVxdWlyZWpzLXRwbC1qY2JyYW5kL3RwbCcsCiAgICAgICAgInR5cGVhaGVhZCI6ICAgICAgICAgICAgICAgICJjb21wb25lbnRzL3R5cGVhaGVhZC5qcy9pbmRleCIsCiAgICAgICAgInVuZGVyc2NvcmUiOiAgICAgICAgICAgICAgICJjb21wb25lbnRzL3VuZGVyc2NvcmUvdW5kZXJzY29yZSIsCiAgICAgICAgInV0aWxzIjogICAgICAgICAgICAgICAgICAgICJzcmMvdXRpbHMiLAoKICAgICAgICAvLyBPZmYtdGhlLXJlY29yZC1lbmNyeXB0aW9uCiAgICAgICAgImJpZ2ludCI6ICAgICAgICAgICAgICAgInNyYy9iaWdpbnQiLAogICAgICAgICJjcnlwdG8iOiAgICAgICAgICAgICAgICJzcmMvY3J5cHRvIiwKICAgICAgICAiY3J5cHRvLmFlcyI6ICAgICAgICAgICAiY29tcG9uZW50cy9vdHIvdmVuZG9yL2NyeXB0b2pzL2FlcyIsCiAgICAgICAgImNyeXB0by5jaXBoZXItY29yZSI6ICAgImNvbXBvbmVudHMvb3RyL3ZlbmRvci9jcnlwdG9qcy9jaXBoZXItY29yZSIsCiAgICAgICAgImNyeXB0by5jb3JlIjogICAgICAgICAgImNvbXBvbmVudHMvb3RyL3ZlbmRvci9jcnlwdG9qcy9jb3JlIiwKICAgICAgICAiY3J5cHRvLmVuYy1iYXNlNjQiOiAgICAiY29tcG9uZW50cy9vdHIvdmVuZG9yL2NyeXB0b2pzL2VuYy1iYXNlNjQiLAogICAgICAgICJjcnlwdG8uZXZwa2RmIjogICAgICAgICJjb21wb25lbnRzL2NyeXB0by1qcy1ldmFudm9zYmVyZy9zcmMvZXZwa2RmIiwKICAgICAgICAiY3J5cHRvLmhtYWMiOiAgICAgICAgICAiY29tcG9uZW50cy9vdHIvdmVuZG9yL2NyeXB0b2pzL2htYWMiLAogICAgICAgICJjcnlwdG8ubWQ1IjogICAgICAgICAgICJjb21wb25lbnRzL2NyeXB0by1qcy1ldmFudm9zYmVyZy9zcmMvbWQ1IiwKICAgICAgICAiY3J5cHRvLm1vZGUtY3RyIjogICAgICAiY29tcG9uZW50cy9vdHIvdmVuZG9yL2NyeXB0b2pzL21vZGUtY3RyIiwKICAgICAgICAiY3J5cHRvLnBhZC1ub3BhZGRpbmciOiAiY29tcG9uZW50cy9vdHIvdmVuZG9yL2NyeXB0b2pzL3BhZC1ub3BhZGRpbmciLAogICAgICAgICJjcnlwdG8uc2hhMSI6ICAgICAgICAgImNvbXBvbmVudHMvb3RyL3ZlbmRvci9jcnlwdG9qcy9zaGExIiwKICAgICAgICAiY3J5cHRvLnNoYTI1NiI6ICAgICAgICAiY29tcG9uZW50cy9vdHIvdmVuZG9yL2NyeXB0b2pzL3NoYTI1NiIsCiAgICAgICAgInNhbHNhMjAiOiAgICAgICAgICAgICAgImNvbXBvbmVudHMvb3RyL2J1aWxkL2RlcC9zYWxzYTIwIiwKICAgICAgICAib3RyIjogICAgICAgICAgICAgICAgICAic3JjL290ciIsCgogICAgICAgIC8vIExvY2FsZXMgcGF0aHMKICAgICAgICAibG9jYWxlcyI6ICAgImxvY2FsZS9sb2NhbGVzIiwKICAgICAgICAiamVkIjogICAgICAgImNvbXBvbmVudHMvamVkL2plZCIsCiAgICAgICAgImFmIjogICAgICAgICJsb2NhbGUvYWYvTENfTUVTU0FHRVMvYWYiLAogICAgICAgICJkZSI6ICAgICAgICAibG9jYWxlL2RlL0xDX01FU1NBR0VTL2RlIiwKICAgICAgICAiZW4iOiAgICAgICAgImxvY2FsZS9lbi9MQ19NRVNTQUdFUy9lbiIsCiAgICAgICAgImVzIjogICAgICAgICJsb2NhbGUvZXMvTENfTUVTU0FHRVMvZXMiLAogICAgICAgICJmciI6ICAgICAgICAibG9jYWxlL2ZyL0xDX01FU1NBR0VTL2ZyIiwKICAgICAgICAiaGUiOiAgICAgICAgImxvY2FsZS9oZS9MQ19NRVNTQUdFUy9oZSIsCiAgICAgICAgImh1IjogICAgICAgICJsb2NhbGUvaHUvTENfTUVTU0FHRVMvaHUiLAogICAgICAgICJpZCI6ICAgICAgICAibG9jYWxlL2lkL0xDX01FU1NBR0VTL2lkIiwKICAgICAgICAiaXQiOiAgICAgICAgImxvY2FsZS9pdC9MQ19NRVNTQUdFUy9pdCIsCiAgICAgICAgImphIjogICAgICAgICJsb2NhbGUvamEvTENfTUVTU0FHRVMvamEiLAogICAgICAgICJubCI6ICAgICAgICAibG9jYWxlL25sL0xDX01FU1NBR0VTL25sIiwKICAgICAgICAicHRfQlIiOiAgICAgImxvY2FsZS9wdF9CUi9MQ19NRVNTQUdFUy9wdF9CUiIsCiAgICAgICAgInJ1IjogICAgICAgICJsb2NhbGUvcnUvTENfTUVTU0FHRVMvcnUiLAogICAgICAgICJ6aCI6ICAgICAgICAibG9jYWxlL3poL0xDX01FU1NBR0VTL3poIiwKCiAgICAgICAgLy8gVGVtcGxhdGVzCiAgICAgICAgImFjdGlvbiI6ICAgICAgICAgICAgICAgICAgICJzcmMvdGVtcGxhdGVzL2FjdGlvbiIsCiAgICAgICAgImFkZF9jb250YWN0X2Ryb3Bkb3duIjogICAgICJzcmMvdGVtcGxhdGVzL2FkZF9jb250YWN0X2Ryb3Bkb3duIiwKICAgICAgICAiYWRkX2NvbnRhY3RfZm9ybSI6ICAgICAgICAgInNyYy90ZW1wbGF0ZXMvYWRkX2NvbnRhY3RfZm9ybSIsCiAgICAgICAgImNoYW5nZV9zdGF0dXNfbWVzc2FnZSI6ICAgICJzcmMvdGVtcGxhdGVzL2NoYW5nZV9zdGF0dXNfbWVzc2FnZSIsCiAgICAgICAgImNoYXRfc3RhdHVzIjogICAgICAgICAgICAgICJzcmMvdGVtcGxhdGVzL2NoYXRfc3RhdHVzIiwKICAgICAgICAiY2hhdGFyZWEiOiAgICAgICAgICAgICAgICAgInNyYy90ZW1wbGF0ZXMvY2hhdGFyZWEiLAogICAgICAgICJjaGF0Ym94IjogICAgICAgICAgICAgICAgICAic3JjL3RlbXBsYXRlcy9jaGF0Ym94IiwKICAgICAgICAiY2hhdHJvb20iOiAgICAgICAgICAgICAgICAgInNyYy90ZW1wbGF0ZXMvY2hhdHJvb20iLAogICAgICAgICJjaGF0cm9vbV9wYXNzd29yZF9mb3JtIjogICAic3JjL3RlbXBsYXRlcy9jaGF0cm9vbV9wYXNzd29yZF9mb3JtIiwKICAgICAgICAiY2hhdHJvb21fc2lkZWJhciI6ICAgICAgICAgInNyYy90ZW1wbGF0ZXMvY2hhdHJvb21fc2lkZWJhciIsCiAgICAgICAgImNoYXRyb29tc190YWIiOiAgICAgICAgICAgICJzcmMvdGVtcGxhdGVzL2NoYXRyb29tc190YWIiLAogICAgICAgICJjaGF0c19wYW5lbCI6ICAgICAgICAgICAgICAic3JjL3RlbXBsYXRlcy9jaGF0c19wYW5lbCIsCiAgICAgICAgImNob29zZV9zdGF0dXMiOiAgICAgICAgICAgICJzcmMvdGVtcGxhdGVzL2Nob29zZV9zdGF0dXMiLAogICAgICAgICJjb250YWN0c19wYW5lbCI6ICAgICAgICAgICAic3JjL3RlbXBsYXRlcy9jb250YWN0c19wYW5lbCIsCiAgICAgICAgImNvbnRhY3RzX3RhYiI6ICAgICAgICAgICAgICJzcmMvdGVtcGxhdGVzL2NvbnRhY3RzX3RhYiIsCiAgICAgICAgImNvbnRyb2xib3giOiAgICAgICAgICAgICAgICJzcmMvdGVtcGxhdGVzL2NvbnRyb2xib3giLAogICAgICAgICJjb250cm9sYm94X3RvZ2dsZSI6ICAgICAgICAic3JjL3RlbXBsYXRlcy9jb250cm9sYm94X3RvZ2dsZSIsCiAgICAgICAgImZpZWxkIjogICAgICAgICAgICAgICAgICAgICJzcmMvdGVtcGxhdGVzL2ZpZWxkIiwKICAgICAgICAiZm9ybV9jaGVja2JveCI6ICAgICAgICAgICAgInNyYy90ZW1wbGF0ZXMvZm9ybV9jaGVja2JveCIsCiAgICAgICAgImZvcm1faW5wdXQiOiAgICAgICAgICAgICAgICJzcmMvdGVtcGxhdGVzL2Zvcm1faW5wdXQiLAogICAgICAgICJmb3JtX3NlbGVjdCI6ICAgICAgICAgICAgICAic3JjL3RlbXBsYXRlcy9mb3JtX3NlbGVjdCIsCiAgICAgICAgImdyb3VwX2hlYWRlciI6ICAgICAgICAgICAgICJzcmMvdGVtcGxhdGVzL2dyb3VwX2hlYWRlciIsCiAgICAgICAgImluZm8iOiAgICAgICAgICAgICAgICAgICAgICJzcmMvdGVtcGxhdGVzL2luZm8iLAogICAgICAgICJsb2dpbl9wYW5lbCI6ICAgICAgICAgICAgICAic3JjL3RlbXBsYXRlcy9sb2dpbl9wYW5lbCIsCiAgICAgICAgImxvZ2luX3RhYiI6ICAgICAgICAgICAgICAgICJzcmMvdGVtcGxhdGVzL2xvZ2luX3RhYiIsCiAgICAgICAgIm1lc3NhZ2UiOiAgICAgICAgICAgICAgICAgICJzcmMvdGVtcGxhdGVzL21lc3NhZ2UiLAogICAgICAgICJuZXdfZGF5IjogICAgICAgICAgICAgICAgICAic3JjL3RlbXBsYXRlcy9uZXdfZGF5IiwKICAgICAgICAib2NjdXBhbnQiOiAgICAgICAgICAgICAgICAgInNyYy90ZW1wbGF0ZXMvb2NjdXBhbnQiLAogICAgICAgICJwZW5kaW5nX2NvbnRhY3QiOiAgICAgICAgICAic3JjL3RlbXBsYXRlcy9wZW5kaW5nX2NvbnRhY3QiLAogICAgICAgICJwZW5kaW5nX2NvbnRhY3RzIjogICAgICAgICAic3JjL3RlbXBsYXRlcy9wZW5kaW5nX2NvbnRhY3RzIiwKICAgICAgICAicmVxdWVzdGluZ19jb250YWN0IjogICAgICAgInNyYy90ZW1wbGF0ZXMvcmVxdWVzdGluZ19jb250YWN0IiwKICAgICAgICAicmVxdWVzdGluZ19jb250YWN0cyI6ICAgICAgInNyYy90ZW1wbGF0ZXMvcmVxdWVzdGluZ19jb250YWN0cyIsCiAgICAgICAgInJvb21fZGVzY3JpcHRpb24iOiAgICAgICAgICJzcmMvdGVtcGxhdGVzL3Jvb21fZGVzY3JpcHRpb24iLAogICAgICAgICJyb29tX2l0ZW0iOiAgICAgICAgICAgICAgICAic3JjL3RlbXBsYXRlcy9yb29tX2l0ZW0iLAogICAgICAgICJyb29tX3BhbmVsIjogICAgICAgICAgICAgICAic3JjL3RlbXBsYXRlcy9yb29tX3BhbmVsIiwKICAgICAgICAicm9zdGVyIjogICAgICAgICAgICAgICAgICAgInNyYy90ZW1wbGF0ZXMvcm9zdGVyIiwKICAgICAgICAicm9zdGVyX2l0ZW0iOiAgICAgICAgICAgICAgInNyYy90ZW1wbGF0ZXMvcm9zdGVyX2l0ZW0iLAogICAgICAgICJzZWFyY2hfY29udGFjdCI6ICAgICAgICAgICAic3JjL3RlbXBsYXRlcy9zZWFyY2hfY29udGFjdCIsCiAgICAgICAgInNlbGVjdF9vcHRpb24iOiAgICAgICAgICAgICJzcmMvdGVtcGxhdGVzL3NlbGVjdF9vcHRpb24iLAogICAgICAgICJzdGF0dXNfb3B0aW9uIjogICAgICAgICAgICAic3JjL3RlbXBsYXRlcy9zdGF0dXNfb3B0aW9uIiwKICAgICAgICAidG9nZ2xlX2NoYXRzIjogICAgICAgICAgICAgInNyYy90ZW1wbGF0ZXMvdG9nZ2xlX2NoYXRzIiwKICAgICAgICAidG9vbGJhciI6ICAgICAgICAgICAgICAgICAgInNyYy90ZW1wbGF0ZXMvdG9vbGJhciIsCiAgICAgICAgInRyaW1tZWRfY2hhdCI6ICAgICAgICAgICAgICJzcmMvdGVtcGxhdGVzL3RyaW1tZWRfY2hhdCIKICAgIH0sCgogICAgbWFwOiB7CiAgICAgICAgLy8gJyonIG1lYW5zIGFsbCBtb2R1bGVzIHdpbGwgZ2V0ICdqcXVlcnktcHJpdmF0ZScKICAgICAgICAvLyBmb3IgdGhlaXIgJ2pxdWVyeScgZGVwZW5kZW5jeS4KICAgICAgICAnKic6IHsgJ2pxdWVyeSc6ICdqcXVlcnktcHJpdmF0ZScgfSwKICAgICAgICAvLyAnanF1ZXJ5LXByaXZhdGUnIHdhbnRzIHRoZSByZWFsIGpRdWVyeSBtb2R1bGUKICAgICAgICAvLyB0aG91Z2guIElmIHRoaXMgbGluZSB3YXMgbm90IGhlcmUsIHRoZXJlIHdvdWxkCiAgICAgICAgLy8gYmUgYW4gdW5yZXNvbHZhYmxlIGN5Y2xpYyBkZXBlbmRlbmN5LgogICAgICAgICdqcXVlcnktcHJpdmF0ZSc6IHsgJ2pxdWVyeSc6ICdqcXVlcnknIH0KICAgIH0sCgogICAgdHBsOiB7CiAgICAgICAgLy8gQ29uZmlndXJhdGlvbiBmb3IgcmVxdWlyZWpzLXRwbAogICAgICAgIC8vIFVzZSBNdXN0YWNoZSBzdHlsZSBzeW50YXggZm9yIHZhcmlhYmxlIGludGVycG9sYXRpb24KICAgICAgICB0ZW1wbGF0ZVNldHRpbmdzOiB7CiAgICAgICAgICAgIGV2YWx1YXRlIDogL1x7XFsoW1xzXFNdKz8pXF1cfS9nLAogICAgICAgICAgICBpbnRlcnBvbGF0ZSA6IC9ce1x7KFtcc1xTXSs/KVx9XH0vZwogICAgICAgIH0KICAgIH0sCgogICAgLy8gZGVmaW5lIG1vZHVsZSBkZXBlbmRlbmNpZXMgZm9yIG1vZHVsZXMgbm90IHVzaW5nIGRlZmluZQogICAgc2hpbTogewogICAgICAgICd1bmRlcnNjb3JlJzogICAgICAgICAgIHsgZXhwb3J0czogJ18nIH0sCiAgICAgICAgJ2NyeXB0by5hZXMnOiAgICAgICAgICAgeyBkZXBzOiBbJ2NyeXB0by5jaXBoZXItY29yZSddIH0sCiAgICAgICAgJ2NyeXB0by5jaXBoZXItY29yZSc6ICAgeyBkZXBzOiBbJ2NyeXB0by5lbmMtYmFzZTY0JywgJ2NyeXB0by5ldnBrZGYnXSB9LAogICAgICAgICdjcnlwdG8uZW5jLWJhc2U2NCc6ICAgIHsgZGVwczogWydjcnlwdG8uY29yZSddIH0sCiAgICAgICAgJ2NyeXB0by5ldnBrZGYnOiAgICAgICAgeyBkZXBzOiBbJ2NyeXB0by5tZDUnXSB9LAogICAgICAgICdjcnlwdG8uaG1hYyc6ICAgICAgICAgIHsgZGVwczogWydjcnlwdG8uY29yZSddIH0sCiAgICAgICAgJ2NyeXB0by5tZDUnOiAgICAgICAgICAgeyBkZXBzOiBbJ2NyeXB0by5jb3JlJ10gfSwKICAgICAgICAnY3J5cHRvLm1vZGUtY3RyJzogICAgICB7IGRlcHM6IFsnY3J5cHRvLmNpcGhlci1jb3JlJ10gfSwKICAgICAgICAnY3J5cHRvLnBhZC1ub3BhZGRpbmcnOiB7IGRlcHM6IFsnY3J5cHRvLmNpcGhlci1jb3JlJ10gfSwKICAgICAgICAnY3J5cHRvLnNoYTEnOiAgICAgICAgICB7IGRlcHM6IFsnY3J5cHRvLmNvcmUnXSB9LAogICAgICAgICdjcnlwdG8uc2hhMjU2JzogICAgICAgIHsgZGVwczogWydjcnlwdG8uY29yZSddIH0sCiAgICAgICAgJ2JpZ2ludCc6ICAgICAgICAgICAgICAgeyBkZXBzOiBbJ2NyeXB0byddIH0sCiAgICAgICAgJ3N0cm9waGUnOiAgICAgICAgICAgICAgeyBleHBvcnRzOiAnU3Ryb3BoZScgfSwKICAgICAgICAnc3Ryb3BoZS5kaXNjbyc6ICAgICAgICB7IGRlcHM6IFsnc3Ryb3BoZSddIH0sCiAgICAgICAgJ3N0cm9waGUubXVjJzogICAgICAgICAgeyBkZXBzOiBbJ3N0cm9waGUnXSB9LAogICAgICAgICdzdHJvcGhlLnJvc3Rlcic6ICAgICAgIHsgZGVwczogWydzdHJvcGhlJ10gfSwKICAgICAgICAnc3Ryb3BoZS52Y2FyZCc6ICAgICAgICB7IGRlcHM6IFsnc3Ryb3BoZSddIH0KICAgIH0KfSk7CnJlcXVpcmUoWyJjb252ZXJzZSJdLCBmdW5jdGlvbihjb252ZXJzZSkgewogICAgd2luZG93LmNvbnZlcnNlID0gY29udmVyc2U7Cn0pOwoKZGVmaW5lKCJtYWluIiwgZnVuY3Rpb24oKXt9KTsKCg==",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Thu, 06 Nov 2014 16:25:11 GMT",
                    "Content-Length": "1299901",
                    "Date": "Thu, 06 Nov 2014 16:25:17 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}