{
    "url": "http://localhost:9999/danski/SpahQL/doc-html/js/nav.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Open redirection (DOM-based)",
    "issueType": 5243152,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based open redirection vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the target of a redirection in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause a redirection to an arbitrary external domain. This behavior can be leveraged to facilitate phishing attacks against users of the application. The ability to use an authentic application URL, targeting the correct domain with a valid SSL certificate (if SSL is used) lends credibility to the phishing attack because many users, even if they verify these features, will not notice the subsequent redirection to a different domain.<br><br><b>Note:</b> If an attacker is able to control the start of the string that is passed to the redirection API, then it may be possible to escalate this vulnerability into a JavaScript injection attack, by using a URL with the javascript: pseudo-protocol to execute arbitrary script code when the URL is processed by the browser.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based open redirection vulnerabilities is not to dynamically set redirection targets using data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing an arbitrary URL as a redirection target. In general, this is best achieved by using a whitelist of URLs that are permitted redirection targets, and strictly validating the target against this list before performing the redirection.",
    "issueDetail": "The application may be vulnerable to DOM-based open redirection. Data is read from <b>document.location</b> and written to <b>document.location</b> via the following statement:<ul><li>document.location = document.location.toString().split(\"#\")[0]+dest;</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/danski/SpahQL/doc-html/js/nav.js",
                "path": "/danski/SpahQL/doc-html/js/nav.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9kYW5za2kvU3BhaFFML2RvYy1odG1sL2pzL25hdi5qcyBIVFRQLzEuMQ0KSG9zdDogbG9jYWxob3N0Ojk5OTkNCg0K",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogNjQ1Nw0KQWNjZXB0LVJhbmdlczogYnl0ZXMNCkNvbnRlbnQtVHlwZTogYXBwbGljYXRpb24vamF2YXNjcmlwdA0KRGF0ZTogU2F0LCAwOCBOb3YgMjAxNCAwNToxNjozMyBHTVQNCkxhc3QtTW9kaWZpZWQ6IFNhdCwgMDggTm92IDIwMTQgMDU6MTY6MzIgR01UDQoNCk5hdiA9IGZ1bmN0aW9uKCkgewogIAp9Ck5hdi5pbml0ID0gZnVuY3Rpb24oaW5qZWN0b3JDYWxsYmFjaykgewogIHZhciBvdmVydmlldyA9IHRoaXMuYnVpbGRPdmVydmlldyhpbmplY3RvckNhbGxiYWNrKTsKICB0aGlzLmFkZFNjcm9sbExpc3RlbmVyKG92ZXJ2aWV3KTsKICB0aGlzLmFkZFRvZ2dsZUJlaGF2aW91cnMoKTsKICB0aGlzLmFkZExpbmtCZWhhdmlvdXJzKCk7CiAgCiAgdGhpcy5hZGRIZWxwZXJNYXJrdXAoKTsKICB0aGlzLmZvcm1hdENvZGUoKTsKfQoKTmF2LmFkZEhlbHBlck1hcmt1cCA9IGZ1bmN0aW9uKCkgewogICQoImFydGljbGUgPiBwcmUiKS5lYWNoKGZ1bmN0aW9uKCkgewogICAgdmFyICRwcmUgPSAkKHRoaXMpOwogICAgdmFyICRwcmV2ID0gJHByZS5wcmV2KCk7CgogICAgJHByZS53cmFwKCc8ZGl2IGNsYXNzPSJwcmUtd3JhcHBlciI+PC9kaXY+Jyk7CiAgICAkcHJlID0gJHByZS5jbG9zZXN0KCIucHJlLXdyYXBwZXIiKTsKCiAgICBpZigkcHJldlswXSAmJiAkcHJldlswXS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09ICJwIiAmJiAkcHJldi5odG1sKCkuaW5kZXhPZigiOiIpID09ICRwcmV2Lmh0bWwoKS5sZW5ndGgtMSkgewogICAgICB2YXIgd3JhcHBlciA9ICQoIjxkaXYgY2xhc3M9XCJjb2RlLXBhaXJcIj48L2Rpdj4iKTsKICAgICAgJHByZXYuYmVmb3JlKHdyYXBwZXIpOwoKICAgICAgdmFyIHBXcmFwcGVyID0gJCgiPGRpdiBjbGFzcz1cInRleHQtY29udGFpbmVyXCI+PC9kaXY+Iik7CiAgICAgIHdyYXBwZXIuYXBwZW5kKHBXcmFwcGVyKTsKICAgICAgcFdyYXBwZXIuYXBwZW5kKCRwcmV2KTsKICAgICAgCiAgICAgIHdyYXBwZXIuYXBwZW5kKCRwcmUpOyAKICAgICAgd3JhcHBlci5hcHBlbmQoIjxkaXYgY2xhc3M9XCJjbGVhcmZpeFwiPjwvZGl2PiIpCgogICAgfQogIH0pOwp9OwoKTmF2LmZvcm1hdENvZGUgPSBmdW5jdGlvbigpIHsKICAkKCJjb2RlIikuZWFjaChmdW5jdGlvbigpIHsKICAgIHZhciAkZSA9ICQodGhpcyk7CiAgICB2YXIgY29kZSA9ICRlLmh0bWwoKTsKCiAgICAkZS5odG1sKGNvZGUucmVwbGFjZSgvXHQvZywgIiAgIikpOwogIH0pOwp9OwoKTmF2LmJ1aWxkT3ZlcnZpZXcgPSBmdW5jdGlvbihpbmplY3RvckNhbGxiYWNrKSB7CgogIAogIC8vIEJ1aWxkIHRoZSBoZWFkaW5nIGluZGV4CiAgdmFyIGhUYWdzID0gWyJoMSIsICJoMiIsICJoMyIsICJoNCIsICJoNSIsICJoNiJdOwogIHZhciBoU2VsID0gaFRhZ3Muam9pbigiLCAiKTsKICB2YXIgaFByZXYsIGxpUHJldiwgdGFyZ2V0OwogIAogIC8vIHRhcmdldCBpcyBhbHdheXMgYSBMSVNUIGFuZCB3ZSdyZSBhcHBlbmRpbmcgTEkncyB0byBpdAogIHZhciByb290TGlzdCA9ICQoIjxvbCBjbGFzcz1cImgxXCI+PC9vbD4iKTsKICBpbmplY3RvckNhbGxiYWNrKHJvb3RMaXN0KTsgIAogIAogICQoaFNlbCwgJCgiYXJ0aWNsZSIpKS5lYWNoKGZ1bmN0aW9uKGluZGV4KSB7CiAgICBpZihpbmRleCA9PSAwKSB7CiAgICAgIC8vIEltcG9ydGFudDogRmlyc3QgaGVhZGluZyBpZ25vcmVkIGFzIGl0IGlzIHRoZSBwYWdlIGhlYWRpbmcKICAgIH0KICAgIGVsc2UgewogICAgICB2YXIgJGggPSAkKHRoaXMpOwoKICAgICAgdmFyIG5ld0xpID0gJCgiPGxpIGNsYXNzPVwiaGlkZGVuXCI+PGEgaHJlZj1cIiMiKyRoLmF0dHIoImlkIikrIlwiPiIrJGguaHRtbCgpKyI8L2E+PG9sPjwvb2w+PC9saT4iKTsKCiAgICAgIGlmKGhQcmV2ICYmICh0aGlzLnRhZ05hbWUgPT0gaFByZXYudGFnTmFtZSkpIHsKICAgICAgICAvLyBjb25zb2xlLmxvZygia2VlcGluZyBzY29wZTogIit0aGlzLnRhZ05hbWUrIiAoJyIrJGguaHRtbCgpKyInKSIpOwogICAgICB9CiAgICAgIGVsc2UgaWYoIWhQcmV2IHx8ICh0aGlzLnRhZ05hbWUgPiBoUHJldi50YWdOYW1lKSkgewogICAgICAgIC8vIFN0YXJ0aW5nIG91dCBvciBkZXNjZW5kaW5nIHNjb3BlCiAgICAgICAgLy8gY29uc29sZS5sb2coImVudGVyaW5nIHNjb3BlOiAiK3RoaXMudGFnTmFtZSsiICgnIiskaC5odG1sKCkrIicpIik7CiAgICAgICAgLy8gR28gdG8gbmV3IHRhcmdldAogICAgICAgIHRhcmdldCA9ICgkKCJvbCIsIChsaVByZXYpKS5sZW5ndGggPiAwKT8gJCgib2wiLCBsaVByZXYpLmZpcnN0KCkgOiByb290TGlzdDsKICAgICAgICAvLyBBZGQgdG9nZ2xlciB0byBwcmV2aW91cyB0YXJnZXQKICAgICAgICBpZihsaVByZXYgJiYgaFByZXYpIHsKICAgICAgICAgIGxpUHJldi5hZGRDbGFzcygiaGFzLXN1YnRvcGljcyIpOwogICAgICAgICAgJCgiYSIsIGxpUHJldikuYWRkQ2xhc3MoImhhcy1zdWJ0b3BpY3MiKTsKICAgICAgICAgIGxpUHJldi5wcmVwZW5kKCI8YSBjbGFzcz1cIm5hdi10b2dnbGVcIiBocmVmPVwiI1wiPis8L2E+ICIpOwogICAgICAgICAgdGFyZ2V0LmFkZENsYXNzKHRoaXMudGFnTmFtZS50b0xvd2VyQ2FzZSgpKQogICAgICAgICAgdGFyZ2V0LmhpZGUoKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZWxzZSBpZih0aGlzLnRhZ05hbWUgPCBoUHJldi50YWdOYW1lKSB7CiAgICAgICAgLy8gY29uc29sZS5sb2coImV4aXRpbmcgc2NvcGU6ICIrdGhpcy50YWdOYW1lKyIgKCciKyRoLmh0bWwoKSsiJykiKTsKICAgICAgICAvLyBFeGl0aW5nIHNjb3BlLCBkZXRlcm1pbmUgaG93IG1hbnkgZXhpdHMgd2UncmUgbWFraW5nCiAgICAgICAgdmFyIHByZXZUID0gdGFyZ2V0OwogICAgICAgIHRhcmdldCA9IHRhcmdldC5jbG9zZXN0KCJvbC4iK3RoaXMudGFnTmFtZS50b0xvd2VyQ2FzZSgpKTsKICAgICAgfQogICAgICAvLyBBcHBlbmQgdG8gY3VycmVudCBzY29wZQogICAgICB0YXJnZXQuYXBwZW5kKG5ld0xpKTsKICAgICAgLy8gU2V0IHNjb3BlIGNvbXBhcmlzb24gZmxhZwogICAgICBoUHJldiA9IHRoaXM7CiAgICAgIGxpUHJldiA9IG5ld0xpOyAKICAgIH0KICB9KTsKICAKICByZXR1cm4gcm9vdExpc3Q7Cn0KCk5hdi5hZGRUb2dnbGVCZWhhdmlvdXJzID0gZnVuY3Rpb24oKSB7CiAgLy8gQnVpbGQgdG9nZ2xlcnMKICAkKCJhLm5hdi10b2dnbGUiKS5jbGljayhmdW5jdGlvbihlKSB7CiAgICB2YXIgJGEgPSAkKHRoaXMpOwogICAgdmFyICRsaSA9ICRhLmNsb3Nlc3QoImxpIik7CiAgICAKICAgIGlmKCRsaS5oYXNDbGFzcygiaGlkZGVuIikpIHsKICAgICAgTmF2LmV4cGFuZFRyZWUoJGxpKTsKICAgICAgJGxpLmFkZENsYXNzKCJtYW51YWwiKTsKICAgIH0KICAgIGVsc2UgewogICAgICAkbGkucmVtb3ZlQ2xhc3MoIm1hbnVhbCIpOwogICAgICBOYXYuY29sbGFwc2VUcmVlKCRsaSk7CiAgICB9ICAgIAogICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgcmV0dXJuIGZhbHNlOwogIH0pOwp9CgpOYXYuZXhwYW5kVHJlZSA9IGZ1bmN0aW9uKGxpKSB7CiAgdmFyICRsaSA9ICQobGkpOwogICRsaS5yZW1vdmVDbGFzcygiaGlkZGVuIik7CiAgJGxpLmFkZENsYXNzKCJzaG93biIpOwogIHZhciBzdWJsaXN0ID0gJGxpLmNoaWxkcmVuKCJvbCIpOwogIGlmKHN1Ymxpc3QuY2hpbGRyZW4oImxpIikubGVuZ3RoID4gMCkgewogICAgc3VibGlzdC5zbGlkZURvd24oMjUwKTsKICB9CiAgJGxpLmNoaWxkcmVuKCJhLm5hdi10b2dnbGUiKS5odG1sKCItIik7Cn0KCk5hdi5jb2xsYXBzZVRyZWUgPSBmdW5jdGlvbihsaSkgewogIHZhciAkbGkgPSAkKGxpKTsKICBpZigkbGkuaGFzQ2xhc3MoIm1hbnVhbCIpKSByZXR1cm47CiAgJGxpLnJlbW92ZUNsYXNzKCJzaG93biIpOwogICRsaS5hZGRDbGFzcygiaGlkZGVuIik7CiAgJGxpLmNoaWxkcmVuKCJvbCIpLnNsaWRlVXAoMjUwKTsKICAkbGkuY2hpbGRyZW4oImEubmF2LXRvZ2dsZSIpLmh0bWwoIisiKTsKfQoKTmF2LmFkZExpbmtCZWhhdmlvdXJzID0gZnVuY3Rpb24oKSB7CiAgJCgiYVtocmVmXj0nIyddOm5vdCgubmF2LXRvZ2dsZSkiKS5jbGljayhmdW5jdGlvbihldmVudCkgewogICAgdmFyIGRlc3QgPSAkKHRoaXMpLmF0dHIoImhyZWYiKTsgIAogICAgaWYoZGVzdCE9IiMiKSB7CiAgICAgIE5hdi5uYXZpZ2F0ZShkZXN0KTsgICAgCiAgICAgIC8vIEtpbGwgYWN0dWFsIGxpbmsgYmVoYXZpb3VyCiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICB9KTsKfQoKTmF2LnNjcm9sbFRhcmdldCA9IG51bGw7Ck5hdi5uYXZpZ2F0ZSA9IGZ1bmN0aW9uKGRlc3QpIHsgIAogIC8vIFNjcm9sbCBtYWluIGNvbnRlbnQgdmlldwogIE5hdi5zY3JvbGxUYXJnZXQgPSBkZXN0OwogICQuc2Nyb2xsVG8oJChkZXN0KSwgNTAwLCB7b25BZnRlcjogZnVuY3Rpb24oKSB7CiAgICBkb2N1bWVudC5sb2NhdGlvbiA9IGRvY3VtZW50LmxvY2F0aW9uLnRvU3RyaW5nKCkuc3BsaXQoIiMiKVswXStkZXN0OwogICAgTmF2LnNjcm9sbFRhcmdldCA9IG51bGw7CiAgfX0pOwp9CgpOYXYubWFrZURlc3RpbmF0aW9uQ3VycmVudCA9IGZ1bmN0aW9uKGRlc3QsIGhOYXYpIHsKICB2YXIgbmF2TGkgPSAkKCJuYXYgYVtocmVmPSciK2Rlc3QrIiddIikucGFyZW50cygibGkiKTsKICBuYXZMaS5hZGRDbGFzcygiY3VycmVudCIpOwogIC8vIENvbGxhcHNlIGFsbCBuYXYgdHJlZXMgdGhhdCBhcmVuJ3QgYSBwYXJ0IG9mIHRoaXMKICB2YXIgbmF2SXRlbXMgPSAkKCJsaSIsIGhOYXYpOwogIG5hdkl0ZW1zLmVhY2goZnVuY3Rpb24oaSkgewogICAgdmFyICRpdGVtID0gJCh0aGlzKTsKICAgIC8vIElmIHRoaXMgbGlzdCBpdGVtIGNvbnRhaW5zIGEgbGluayB0byB0aGUgZGVzdGluYXRpb24sIHdlIGV4cGFuZCBpdAogICAgLy8gRWxzZSB3ZSBjb2xsYXBzZSBpdAogICAgaWYoJCgiYVtocmVmPSciK2Rlc3QrIiddIiwgJGl0ZW0pLmxlbmd0aCA+IDApIHsKICAgICAgTmF2LmV4cGFuZFRyZWUodGhpcyk7CiAgICB9CiAgICBlbHNlIHsKICAgICAgTmF2LmNvbGxhcHNlVHJlZSh0aGlzKTsKICAgIH0KICB9KTsKfQoKTmF2LmFkZFNjcm9sbExpc3RlbmVyID0gZnVuY3Rpb24oaE5hdikgewogICQod2luZG93KS5zY3JvbGwoZnVuY3Rpb24oZXZlbnQpIHsKICAgIC8vIEZpbmQgdGhlIGZpcnN0IHZpc2libGUgaGVhZGVyIGFuZCBoaWdobGlnaHQgaXQgYXMgY3VycmVudCBpbiB0aGUgbmF2CiAgICB2YXIgZG9jVmlld1RvcCA9ICQod2luZG93KS5zY3JvbGxUb3AoKTsKICAgIHZhciBkb2NWaWV3Qm90dG9tID0gZG9jVmlld1RvcCArICQod2luZG93KS5oZWlnaHQoKTsKICAgIAogICAgLy8gU3RyaXAgY3VycmVudCBjbGFzc2VzCiAgICAkKCJsaSIsIGhOYXYpLnJlbW92ZUNsYXNzKCJjdXJyZW50Iik7CiAgICAKICAgIC8vIEZpbmQgZmlyc3QgdmlzaWJsZSBoZWFkZXIgYW5kIGlmIG5vIGhlYWRlciBpcyB2aXNpYmxlLCBmaW5kIGNsb3Nlc3QgdG8gZG9jdW1lbnQgdG9wCiAgICAvLyBPUiB0YWtlIHRoZSBjdXJyZW50IGFzeW5jIHNjcm9sbCB0YXJnZXQgZmlyc3QKICAgIGlmKE5hdi5zY3JvbGxUYXJnZXQpIHsKICAgICAgTmF2Lm1ha2VEZXN0aW5hdGlvbkN1cnJlbnQoTmF2LnNjcm9sbFRhcmdldCwgaE5hdik7CiAgICB9CiAgICBlbHNlIHsKICAgICAgdmFyIGxhc3RBYm92ZUZyYW1lSGVhZGVyOwogICAgICAkKCJoMTpub3QoaDE6Zmlyc3QtY2hpbGQpLCBoMiwgaDMsIGg0LCBoNSwgaDYiLCAkKCJhcnRpY2xlIikpLmVhY2goZnVuY3Rpb24oaSkgewogICAgICAgIHZhciAkZWxlbSA9ICQodGhpcyk7CiAgICAgICAgdmFyIGVsZW1Ub3AgPSAkZWxlbS5vZmZzZXQoKS50b3A7CiAgICAgICAgdmFyIGVsZW1Cb3R0b20gPSBlbGVtVG9wICsgJGVsZW0uaGVpZ2h0KCk7CgogICAgICAgIHZhciBhYm92ZUZyYW1lID0gKGVsZW1Cb3R0b20gPCBkb2NWaWV3VG9wKTsKICAgICAgICB2YXIgYmVsb3dGcmFtZSA9IChlbGVtVG9wID4gZG9jVmlld0JvdHRvbSk7CiAgICAgICAgdmFyIGluRnJhbWUgPSAoIWFib3ZlRnJhbWUgJiYgIWJlbG93RnJhbWUpOwoKICAgICAgICBpZihhYm92ZUZyYW1lKSB7CiAgICAgICAgICAvLyBBYm92ZSBmcmFtZSwgc3RvcmUgaW4gZmFsbGJhY2sgcG9pbnRlcgogICAgICAgICAgbGFzdEFib3ZlRnJhbWVIZWFkZXIgPSAkZWxlbTsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZihiZWxvd0ZyYW1lICYmIGxhc3RBYm92ZUZyYW1lSGVhZGVyKSB7CiAgICAgICAgICAvLyBJZiB3ZSB3ZW50IGJlbG93IGZyYW1lLCBydW4gYWN0aW9uIGFnYWluc3QgbGFzdCBhYm92ZUZyYW1lIGhlYWRlcgogICAgICAgICAgTmF2Lm1ha2VEZXN0aW5hdGlvbkN1cnJlbnQoIiMiK2xhc3RBYm92ZUZyYW1lSGVhZGVyLmF0dHIoImlkIiksIGhOYXYpOwogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmKGluRnJhbWUpIHsKICAgICAgICAgIC8vIElmIGluIGZyYW1lLCB0aGlzIGlzIHRoZSBiYWRnZXIKICAgICAgICAgIE5hdi5tYWtlRGVzdGluYXRpb25DdXJyZW50KCIjIiskZWxlbS5hdHRyKCJpZCIpLCBoTmF2KTsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgIH0pOyAKICAgIH0KICB9KTsKfQoKCgo=",
                "body": "TmF2ID0gZnVuY3Rpb24oKSB7CiAgCn0KTmF2LmluaXQgPSBmdW5jdGlvbihpbmplY3RvckNhbGxiYWNrKSB7CiAgdmFyIG92ZXJ2aWV3ID0gdGhpcy5idWlsZE92ZXJ2aWV3KGluamVjdG9yQ2FsbGJhY2spOwogIHRoaXMuYWRkU2Nyb2xsTGlzdGVuZXIob3ZlcnZpZXcpOwogIHRoaXMuYWRkVG9nZ2xlQmVoYXZpb3VycygpOwogIHRoaXMuYWRkTGlua0JlaGF2aW91cnMoKTsKICAKICB0aGlzLmFkZEhlbHBlck1hcmt1cCgpOwogIHRoaXMuZm9ybWF0Q29kZSgpOwp9CgpOYXYuYWRkSGVscGVyTWFya3VwID0gZnVuY3Rpb24oKSB7CiAgJCgiYXJ0aWNsZSA+IHByZSIpLmVhY2goZnVuY3Rpb24oKSB7CiAgICB2YXIgJHByZSA9ICQodGhpcyk7CiAgICB2YXIgJHByZXYgPSAkcHJlLnByZXYoKTsKCiAgICAkcHJlLndyYXAoJzxkaXYgY2xhc3M9InByZS13cmFwcGVyIj48L2Rpdj4nKTsKICAgICRwcmUgPSAkcHJlLmNsb3Nlc3QoIi5wcmUtd3JhcHBlciIpOwoKICAgIGlmKCRwcmV2WzBdICYmICRwcmV2WzBdLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT0gInAiICYmICRwcmV2Lmh0bWwoKS5pbmRleE9mKCI6IikgPT0gJHByZXYuaHRtbCgpLmxlbmd0aC0xKSB7CiAgICAgIHZhciB3cmFwcGVyID0gJCgiPGRpdiBjbGFzcz1cImNvZGUtcGFpclwiPjwvZGl2PiIpOwogICAgICAkcHJldi5iZWZvcmUod3JhcHBlcik7CgogICAgICB2YXIgcFdyYXBwZXIgPSAkKCI8ZGl2IGNsYXNzPVwidGV4dC1jb250YWluZXJcIj48L2Rpdj4iKTsKICAgICAgd3JhcHBlci5hcHBlbmQocFdyYXBwZXIpOwogICAgICBwV3JhcHBlci5hcHBlbmQoJHByZXYpOwogICAgICAKICAgICAgd3JhcHBlci5hcHBlbmQoJHByZSk7IAogICAgICB3cmFwcGVyLmFwcGVuZCgiPGRpdiBjbGFzcz1cImNsZWFyZml4XCI+PC9kaXY+IikKCiAgICB9CiAgfSk7Cn07CgpOYXYuZm9ybWF0Q29kZSA9IGZ1bmN0aW9uKCkgewogICQoImNvZGUiKS5lYWNoKGZ1bmN0aW9uKCkgewogICAgdmFyICRlID0gJCh0aGlzKTsKICAgIHZhciBjb2RlID0gJGUuaHRtbCgpOwoKICAgICRlLmh0bWwoY29kZS5yZXBsYWNlKC9cdC9nLCAiICAiKSk7CiAgfSk7Cn07CgpOYXYuYnVpbGRPdmVydmlldyA9IGZ1bmN0aW9uKGluamVjdG9yQ2FsbGJhY2spIHsKCiAgCiAgLy8gQnVpbGQgdGhlIGhlYWRpbmcgaW5kZXgKICB2YXIgaFRhZ3MgPSBbImgxIiwgImgyIiwgImgzIiwgImg0IiwgImg1IiwgImg2Il07CiAgdmFyIGhTZWwgPSBoVGFncy5qb2luKCIsICIpOwogIHZhciBoUHJldiwgbGlQcmV2LCB0YXJnZXQ7CiAgCiAgLy8gdGFyZ2V0IGlzIGFsd2F5cyBhIExJU1QgYW5kIHdlJ3JlIGFwcGVuZGluZyBMSSdzIHRvIGl0CiAgdmFyIHJvb3RMaXN0ID0gJCgiPG9sIGNsYXNzPVwiaDFcIj48L29sPiIpOwogIGluamVjdG9yQ2FsbGJhY2socm9vdExpc3QpOyAgCiAgCiAgJChoU2VsLCAkKCJhcnRpY2xlIikpLmVhY2goZnVuY3Rpb24oaW5kZXgpIHsKICAgIGlmKGluZGV4ID09IDApIHsKICAgICAgLy8gSW1wb3J0YW50OiBGaXJzdCBoZWFkaW5nIGlnbm9yZWQgYXMgaXQgaXMgdGhlIHBhZ2UgaGVhZGluZwogICAgfQogICAgZWxzZSB7CiAgICAgIHZhciAkaCA9ICQodGhpcyk7CgogICAgICB2YXIgbmV3TGkgPSAkKCI8bGkgY2xhc3M9XCJoaWRkZW5cIj48YSBocmVmPVwiIyIrJGguYXR0cigiaWQiKSsiXCI+IiskaC5odG1sKCkrIjwvYT48b2w+PC9vbD48L2xpPiIpOwoKICAgICAgaWYoaFByZXYgJiYgKHRoaXMudGFnTmFtZSA9PSBoUHJldi50YWdOYW1lKSkgewogICAgICAgIC8vIGNvbnNvbGUubG9nKCJrZWVwaW5nIHNjb3BlOiAiK3RoaXMudGFnTmFtZSsiICgnIiskaC5odG1sKCkrIicpIik7CiAgICAgIH0KICAgICAgZWxzZSBpZighaFByZXYgfHwgKHRoaXMudGFnTmFtZSA+IGhQcmV2LnRhZ05hbWUpKSB7CiAgICAgICAgLy8gU3RhcnRpbmcgb3V0IG9yIGRlc2NlbmRpbmcgc2NvcGUKICAgICAgICAvLyBjb25zb2xlLmxvZygiZW50ZXJpbmcgc2NvcGU6ICIrdGhpcy50YWdOYW1lKyIgKCciKyRoLmh0bWwoKSsiJykiKTsKICAgICAgICAvLyBHbyB0byBuZXcgdGFyZ2V0CiAgICAgICAgdGFyZ2V0ID0gKCQoIm9sIiwgKGxpUHJldikpLmxlbmd0aCA+IDApPyAkKCJvbCIsIGxpUHJldikuZmlyc3QoKSA6IHJvb3RMaXN0OwogICAgICAgIC8vIEFkZCB0b2dnbGVyIHRvIHByZXZpb3VzIHRhcmdldAogICAgICAgIGlmKGxpUHJldiAmJiBoUHJldikgewogICAgICAgICAgbGlQcmV2LmFkZENsYXNzKCJoYXMtc3VidG9waWNzIik7CiAgICAgICAgICAkKCJhIiwgbGlQcmV2KS5hZGRDbGFzcygiaGFzLXN1YnRvcGljcyIpOwogICAgICAgICAgbGlQcmV2LnByZXBlbmQoIjxhIGNsYXNzPVwibmF2LXRvZ2dsZVwiIGhyZWY9XCIjXCI+KzwvYT4gIik7CiAgICAgICAgICB0YXJnZXQuYWRkQ2xhc3ModGhpcy50YWdOYW1lLnRvTG93ZXJDYXNlKCkpCiAgICAgICAgICB0YXJnZXQuaGlkZSgpOwogICAgICAgIH0KICAgICAgfQogICAgICBlbHNlIGlmKHRoaXMudGFnTmFtZSA8IGhQcmV2LnRhZ05hbWUpIHsKICAgICAgICAvLyBjb25zb2xlLmxvZygiZXhpdGluZyBzY29wZTogIit0aGlzLnRhZ05hbWUrIiAoJyIrJGguaHRtbCgpKyInKSIpOwogICAgICAgIC8vIEV4aXRpbmcgc2NvcGUsIGRldGVybWluZSBob3cgbWFueSBleGl0cyB3ZSdyZSBtYWtpbmcKICAgICAgICB2YXIgcHJldlQgPSB0YXJnZXQ7CiAgICAgICAgdGFyZ2V0ID0gdGFyZ2V0LmNsb3Nlc3QoIm9sLiIrdGhpcy50YWdOYW1lLnRvTG93ZXJDYXNlKCkpOwogICAgICB9CiAgICAgIC8vIEFwcGVuZCB0byBjdXJyZW50IHNjb3BlCiAgICAgIHRhcmdldC5hcHBlbmQobmV3TGkpOwogICAgICAvLyBTZXQgc2NvcGUgY29tcGFyaXNvbiBmbGFnCiAgICAgIGhQcmV2ID0gdGhpczsKICAgICAgbGlQcmV2ID0gbmV3TGk7IAogICAgfQogIH0pOwogIAogIHJldHVybiByb290TGlzdDsKfQoKTmF2LmFkZFRvZ2dsZUJlaGF2aW91cnMgPSBmdW5jdGlvbigpIHsKICAvLyBCdWlsZCB0b2dnbGVycwogICQoImEubmF2LXRvZ2dsZSIpLmNsaWNrKGZ1bmN0aW9uKGUpIHsKICAgIHZhciAkYSA9ICQodGhpcyk7CiAgICB2YXIgJGxpID0gJGEuY2xvc2VzdCgibGkiKTsKICAgIAogICAgaWYoJGxpLmhhc0NsYXNzKCJoaWRkZW4iKSkgewogICAgICBOYXYuZXhwYW5kVHJlZSgkbGkpOwogICAgICAkbGkuYWRkQ2xhc3MoIm1hbnVhbCIpOwogICAgfQogICAgZWxzZSB7CiAgICAgICRsaS5yZW1vdmVDbGFzcygibWFudWFsIik7CiAgICAgIE5hdi5jb2xsYXBzZVRyZWUoJGxpKTsKICAgIH0gICAgCiAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICByZXR1cm4gZmFsc2U7CiAgfSk7Cn0KCk5hdi5leHBhbmRUcmVlID0gZnVuY3Rpb24obGkpIHsKICB2YXIgJGxpID0gJChsaSk7CiAgJGxpLnJlbW92ZUNsYXNzKCJoaWRkZW4iKTsKICAkbGkuYWRkQ2xhc3MoInNob3duIik7CiAgdmFyIHN1Ymxpc3QgPSAkbGkuY2hpbGRyZW4oIm9sIik7CiAgaWYoc3VibGlzdC5jaGlsZHJlbigibGkiKS5sZW5ndGggPiAwKSB7CiAgICBzdWJsaXN0LnNsaWRlRG93bigyNTApOwogIH0KICAkbGkuY2hpbGRyZW4oImEubmF2LXRvZ2dsZSIpLmh0bWwoIi0iKTsKfQoKTmF2LmNvbGxhcHNlVHJlZSA9IGZ1bmN0aW9uKGxpKSB7CiAgdmFyICRsaSA9ICQobGkpOwogIGlmKCRsaS5oYXNDbGFzcygibWFudWFsIikpIHJldHVybjsKICAkbGkucmVtb3ZlQ2xhc3MoInNob3duIik7CiAgJGxpLmFkZENsYXNzKCJoaWRkZW4iKTsKICAkbGkuY2hpbGRyZW4oIm9sIikuc2xpZGVVcCgyNTApOwogICRsaS5jaGlsZHJlbigiYS5uYXYtdG9nZ2xlIikuaHRtbCgiKyIpOwp9CgpOYXYuYWRkTGlua0JlaGF2aW91cnMgPSBmdW5jdGlvbigpIHsKICAkKCJhW2hyZWZePScjJ106bm90KC5uYXYtdG9nZ2xlKSIpLmNsaWNrKGZ1bmN0aW9uKGV2ZW50KSB7CiAgICB2YXIgZGVzdCA9ICQodGhpcykuYXR0cigiaHJlZiIpOyAgCiAgICBpZihkZXN0IT0iIyIpIHsKICAgICAgTmF2Lm5hdmlnYXRlKGRlc3QpOyAgICAKICAgICAgLy8gS2lsbCBhY3R1YWwgbGluayBiZWhhdmlvdXIKICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogIH0pOwp9CgpOYXYuc2Nyb2xsVGFyZ2V0ID0gbnVsbDsKTmF2Lm5hdmlnYXRlID0gZnVuY3Rpb24oZGVzdCkgeyAgCiAgLy8gU2Nyb2xsIG1haW4gY29udGVudCB2aWV3CiAgTmF2LnNjcm9sbFRhcmdldCA9IGRlc3Q7CiAgJC5zY3JvbGxUbygkKGRlc3QpLCA1MDAsIHtvbkFmdGVyOiBmdW5jdGlvbigpIHsKICAgIGRvY3VtZW50LmxvY2F0aW9uID0gZG9jdW1lbnQubG9jYXRpb24udG9TdHJpbmcoKS5zcGxpdCgiIyIpWzBdK2Rlc3Q7CiAgICBOYXYuc2Nyb2xsVGFyZ2V0ID0gbnVsbDsKICB9fSk7Cn0KCk5hdi5tYWtlRGVzdGluYXRpb25DdXJyZW50ID0gZnVuY3Rpb24oZGVzdCwgaE5hdikgewogIHZhciBuYXZMaSA9ICQoIm5hdiBhW2hyZWY9JyIrZGVzdCsiJ10iKS5wYXJlbnRzKCJsaSIpOwogIG5hdkxpLmFkZENsYXNzKCJjdXJyZW50Iik7CiAgLy8gQ29sbGFwc2UgYWxsIG5hdiB0cmVlcyB0aGF0IGFyZW4ndCBhIHBhcnQgb2YgdGhpcwogIHZhciBuYXZJdGVtcyA9ICQoImxpIiwgaE5hdik7CiAgbmF2SXRlbXMuZWFjaChmdW5jdGlvbihpKSB7CiAgICB2YXIgJGl0ZW0gPSAkKHRoaXMpOwogICAgLy8gSWYgdGhpcyBsaXN0IGl0ZW0gY29udGFpbnMgYSBsaW5rIHRvIHRoZSBkZXN0aW5hdGlvbiwgd2UgZXhwYW5kIGl0CiAgICAvLyBFbHNlIHdlIGNvbGxhcHNlIGl0CiAgICBpZigkKCJhW2hyZWY9JyIrZGVzdCsiJ10iLCAkaXRlbSkubGVuZ3RoID4gMCkgewogICAgICBOYXYuZXhwYW5kVHJlZSh0aGlzKTsKICAgIH0KICAgIGVsc2UgewogICAgICBOYXYuY29sbGFwc2VUcmVlKHRoaXMpOwogICAgfQogIH0pOwp9CgpOYXYuYWRkU2Nyb2xsTGlzdGVuZXIgPSBmdW5jdGlvbihoTmF2KSB7CiAgJCh3aW5kb3cpLnNjcm9sbChmdW5jdGlvbihldmVudCkgewogICAgLy8gRmluZCB0aGUgZmlyc3QgdmlzaWJsZSBoZWFkZXIgYW5kIGhpZ2hsaWdodCBpdCBhcyBjdXJyZW50IGluIHRoZSBuYXYKICAgIHZhciBkb2NWaWV3VG9wID0gJCh3aW5kb3cpLnNjcm9sbFRvcCgpOwogICAgdmFyIGRvY1ZpZXdCb3R0b20gPSBkb2NWaWV3VG9wICsgJCh3aW5kb3cpLmhlaWdodCgpOwogICAgCiAgICAvLyBTdHJpcCBjdXJyZW50IGNsYXNzZXMKICAgICQoImxpIiwgaE5hdikucmVtb3ZlQ2xhc3MoImN1cnJlbnQiKTsKICAgIAogICAgLy8gRmluZCBmaXJzdCB2aXNpYmxlIGhlYWRlciBhbmQgaWYgbm8gaGVhZGVyIGlzIHZpc2libGUsIGZpbmQgY2xvc2VzdCB0byBkb2N1bWVudCB0b3AKICAgIC8vIE9SIHRha2UgdGhlIGN1cnJlbnQgYXN5bmMgc2Nyb2xsIHRhcmdldCBmaXJzdAogICAgaWYoTmF2LnNjcm9sbFRhcmdldCkgewogICAgICBOYXYubWFrZURlc3RpbmF0aW9uQ3VycmVudChOYXYuc2Nyb2xsVGFyZ2V0LCBoTmF2KTsKICAgIH0KICAgIGVsc2UgewogICAgICB2YXIgbGFzdEFib3ZlRnJhbWVIZWFkZXI7CiAgICAgICQoImgxOm5vdChoMTpmaXJzdC1jaGlsZCksIGgyLCBoMywgaDQsIGg1LCBoNiIsICQoImFydGljbGUiKSkuZWFjaChmdW5jdGlvbihpKSB7CiAgICAgICAgdmFyICRlbGVtID0gJCh0aGlzKTsKICAgICAgICB2YXIgZWxlbVRvcCA9ICRlbGVtLm9mZnNldCgpLnRvcDsKICAgICAgICB2YXIgZWxlbUJvdHRvbSA9IGVsZW1Ub3AgKyAkZWxlbS5oZWlnaHQoKTsKCiAgICAgICAgdmFyIGFib3ZlRnJhbWUgPSAoZWxlbUJvdHRvbSA8IGRvY1ZpZXdUb3ApOwogICAgICAgIHZhciBiZWxvd0ZyYW1lID0gKGVsZW1Ub3AgPiBkb2NWaWV3Qm90dG9tKTsKICAgICAgICB2YXIgaW5GcmFtZSA9ICghYWJvdmVGcmFtZSAmJiAhYmVsb3dGcmFtZSk7CgogICAgICAgIGlmKGFib3ZlRnJhbWUpIHsKICAgICAgICAgIC8vIEFib3ZlIGZyYW1lLCBzdG9yZSBpbiBmYWxsYmFjayBwb2ludGVyCiAgICAgICAgICBsYXN0QWJvdmVGcmFtZUhlYWRlciA9ICRlbGVtOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmKGJlbG93RnJhbWUgJiYgbGFzdEFib3ZlRnJhbWVIZWFkZXIpIHsKICAgICAgICAgIC8vIElmIHdlIHdlbnQgYmVsb3cgZnJhbWUsIHJ1biBhY3Rpb24gYWdhaW5zdCBsYXN0IGFib3ZlRnJhbWUgaGVhZGVyCiAgICAgICAgICBOYXYubWFrZURlc3RpbmF0aW9uQ3VycmVudCgiIyIrbGFzdEFib3ZlRnJhbWVIZWFkZXIuYXR0cigiaWQiKSwgaE5hdik7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYoaW5GcmFtZSkgewogICAgICAgICAgLy8gSWYgaW4gZnJhbWUsIHRoaXMgaXMgdGhlIGJhZGdlcgogICAgICAgICAgTmF2Lm1ha2VEZXN0aW5hdGlvbkN1cnJlbnQoIiMiKyRlbGVtLmF0dHIoImlkIiksIGhOYXYpOwogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgfSk7IAogICAgfQogIH0pOwp9CgoKCg==",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Sat, 08 Nov 2014 05:16:32 GMT",
                    "Content-Length": "6457",
                    "Date": "Sat, 08 Nov 2014 05:16:33 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}