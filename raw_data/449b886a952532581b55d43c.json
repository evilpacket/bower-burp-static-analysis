{
    "url": "http://localhost:9999/oieduardorabelo/sawpf/src/js/datatables/1.9.2/jquery.dataTables.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Cookie manipulation (DOM-based)",
    "issueType": 5245696,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based cookie manipulation vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the value of a cookie in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will set an arbitrary value in the user's cookie.<br><br>The potential impact of the vulnerability depends on the role that the cookie plays within the application. If the cookie is used to control the behavior that results from certain user actions (for example, a 'production' versus 'demo' mode setting), then the attacker may be able to cause the user to perform unintended actions by manipulating the cookie's value. If the cookie is used to track the user's session, then the attacker may be able to perform a session fixation attack, in which they set the cookie's value to a valid token that they have obtained from the application, and then hijack the session during the victim user's subsequent interaction with the application.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based cookie manipulation vulnerabilities is not to dynamically write to cookies using data that originated from any untrusted source. This behavior should never be implemented for cookies that have any role in controlling privileged actions or user sessions within the application.",
    "issueDetail": "The application may be vulnerable to DOM-based cookie manipulation. Data is read from <b>window.location.pathname</b> and written to <b>document.cookie</b> via the following statements:<ul><li>var aParts = window.location.pathname.split('/');</li><li>sFullCookie = sNameFile + \"=\" + encodeURIComponent(sValue) +      \"; expires=\" + date.toGMTString() +\"; path=\" + aParts.join('/')+\"/\";</li><li>document.cookie = sFullCookie;</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/oieduardorabelo/sawpf/src/js/datatables/1.9.2/jquery.dataTables.js",
                "path": "/oieduardorabelo/sawpf/src/js/datatables/1.9.2/jquery.dataTables.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9vaWVkdWFyZG9yYWJlbG8vc2F3cGYvc3JjL2pzL2RhdGF0YWJsZXMvMS45LjIvanF1ZXJ5LmRhdGFUYWJsZXMuanMgSFRUUC8xLjENCkhvc3Q6IGxvY2FsaG9zdDo5OTk5DQoNCg==",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMzY5MDQ4DQpBY2NlcHQtUmFuZ2VzOiBieXRlcw0KQ29udGVudC1UeXBlOiBhcHBsaWNhdGlvbi9qYXZhc2NyaXB0DQpEYXRlOiBTYXQsIDA4IE5vdiAyMDE0IDAzOjU1OjA5IEdNVA0KTGFzdC1Nb2RpZmllZDogU2F0LCAwOCBOb3YgMjAxNCAwMzo1NDo1NSBHTVQNCg0KLyoqCiAqIEBzdW1tYXJ5ICAgICBEYXRhVGFibGVzCiAqIEBkZXNjcmlwdGlvbiBQYWdpbmF0ZSwgc2VhcmNoIGFuZCBzb3J0IEhUTUwgdGFibGVzCiAqIEB2ZXJzaW9uICAgICAxLjkuMgogKiBAZmlsZSAgICAgICAganF1ZXJ5LmRhdGFUYWJsZXMuanMKICogQGF1dGhvciAgICAgIEFsbGFuIEphcmRpbmUgKHd3dy5zcHJ5bWVkaWEuY28udWspCiAqIEBjb250YWN0ICAgICB3d3cuc3ByeW1lZGlhLmNvLnVrL2NvbnRhY3QKICoKICogQGNvcHlyaWdodCBDb3B5cmlnaHQgMjAwOC0yMDEyIEFsbGFuIEphcmRpbmUsIGFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqCiAqIFRoaXMgc291cmNlIGZpbGUgaXMgZnJlZSBzb2Z0d2FyZSwgdW5kZXIgZWl0aGVyIHRoZSBHUEwgdjIgbGljZW5zZSBvciBhCiAqIEJTRCBzdHlsZSBsaWNlbnNlLCBhdmFpbGFibGUgYXQ6CiAqICAgaHR0cDovL2RhdGF0YWJsZXMubmV0L2xpY2Vuc2VfZ3BsMgogKiAgIGh0dHA6Ly9kYXRhdGFibGVzLm5ldC9saWNlbnNlX2JzZAogKiAKICogVGhpcyBzb3VyY2UgZmlsZSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLCBidXQgCiAqIFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YgTUVSQ0hBTlRBQklMSVRZIAogKiBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gU2VlIHRoZSBsaWNlbnNlIGZpbGVzIGZvciBkZXRhaWxzLgogKiAKICogRm9yIGRldGFpbHMgcGxlYXNlIHJlZmVyIHRvOiBodHRwOi8vd3d3LmRhdGF0YWJsZXMubmV0CiAqLwoKLypqc2xpbnQgZXZpbDogdHJ1ZSwgdW5kZWY6IHRydWUsIGJyb3dzZXI6IHRydWUgKi8KLypnbG9iYWxzICQsIGpRdWVyeSxfZm5FeHRlcm5BcGlGdW5jLF9mbkluaXRpYWxpc2UsX2ZuSW5pdENvbXBsZXRlLF9mbkxhbmd1YWdlQ29tcGF0LF9mbkFkZENvbHVtbixfZm5Db2x1bW5PcHRpb25zLF9mbkFkZERhdGEsX2ZuQ3JlYXRlVHIsX2ZuR2F0aGVyRGF0YSxfZm5CdWlsZEhlYWQsX2ZuRHJhd0hlYWQsX2ZuRHJhdyxfZm5SZURyYXcsX2ZuQWpheFVwZGF0ZSxfZm5BamF4UGFyYW1ldGVycyxfZm5BamF4VXBkYXRlRHJhdyxfZm5TZXJ2ZXJQYXJhbXMsX2ZuQWRkT3B0aW9uc0h0bWwsX2ZuRmVhdHVyZUh0bWxUYWJsZSxfZm5TY3JvbGxEcmF3LF9mbkFkanVzdENvbHVtblNpemluZyxfZm5GZWF0dXJlSHRtbEZpbHRlcixfZm5GaWx0ZXJDb21wbGV0ZSxfZm5GaWx0ZXJDdXN0b20sX2ZuRmlsdGVyQ29sdW1uLF9mbkZpbHRlcixfZm5CdWlsZFNlYXJjaEFycmF5LF9mbkJ1aWxkU2VhcmNoUm93LF9mbkZpbHRlckNyZWF0ZVNlYXJjaCxfZm5EYXRhVG9TZWFyY2gsX2ZuU29ydCxfZm5Tb3J0QXR0YWNoTGlzdGVuZXIsX2ZuU29ydGluZ0NsYXNzZXMsX2ZuRmVhdHVyZUh0bWxQYWdpbmF0ZSxfZm5QYWdlQ2hhbmdlLF9mbkZlYXR1cmVIdG1sSW5mbyxfZm5VcGRhdGVJbmZvLF9mbkZlYXR1cmVIdG1sTGVuZ3RoLF9mbkZlYXR1cmVIdG1sUHJvY2Vzc2luZyxfZm5Qcm9jZXNzaW5nRGlzcGxheSxfZm5WaXNpYmxlVG9Db2x1bW5JbmRleCxfZm5Db2x1bW5JbmRleFRvVmlzaWJsZSxfZm5Ob2RlVG9EYXRhSW5kZXgsX2ZuVmlzYmxlQ29sdW1ucyxfZm5DYWxjdWxhdGVFbmQsX2ZuQ29udmVydFRvV2lkdGgsX2ZuQ2FsY3VsYXRlQ29sdW1uV2lkdGhzLF9mblNjcm9sbGluZ1dpZHRoQWRqdXN0LF9mbkdldFdpZGVzdE5vZGUsX2ZuR2V0TWF4TGVuU3RyaW5nLF9mblN0cmluZ1RvQ3NzLF9mbkRldGVjdFR5cGUsX2ZuU2V0dGluZ3NGcm9tTm9kZSxfZm5HZXREYXRhTWFzdGVyLF9mbkdldFRyTm9kZXMsX2ZuR2V0VGROb2RlcyxfZm5Fc2NhcGVSZWdleCxfZm5EZWxldGVJbmRleCxfZm5SZU9yZGVySW5kZXgsX2ZuQ29sdW1uT3JkZXJpbmcsX2ZuTG9nLF9mbkNsZWFyVGFibGUsX2ZuU2F2ZVN0YXRlLF9mbkxvYWRTdGF0ZSxfZm5DcmVhdGVDb29raWUsX2ZuUmVhZENvb2tpZSxfZm5EZXRlY3RIZWFkZXIsX2ZuR2V0VW5pcXVlVGhzLF9mblNjcm9sbEJhcldpZHRoLF9mbkFwcGx5VG9DaGlsZHJlbixfZm5NYXAsX2ZuR2V0Um93RGF0YSxfZm5HZXRDZWxsRGF0YSxfZm5TZXRDZWxsRGF0YSxfZm5HZXRPYmplY3REYXRhRm4sX2ZuU2V0T2JqZWN0RGF0YUZuLF9mbkFwcGx5Q29sdW1uRGVmcyxfZm5CaW5kQWN0aW9uLF9mbkNhbGxiYWNrUmVnLF9mbkNhbGxiYWNrRmlyZSxfZm5Kc29uU3RyaW5nLF9mblJlbmRlcixfZm5Ob2RlVG9Db2x1bW5JbmRleCxfZm5JbmZvTWFjcm9zKi8KCigvKiogQGxlbmRzIDxnbG9iYWw+ICovZnVuY3Rpb24oJCwgd2luZG93LCBkb2N1bWVudCwgdW5kZWZpbmVkKSB7CgkvKiogCgkgKiBEYXRhVGFibGVzIGlzIGEgcGx1Zy1pbiBmb3IgdGhlIGpRdWVyeSBKYXZhc2NyaXB0IGxpYnJhcnkuIEl0IGlzIGEgCgkgKiBoaWdobHkgZmxleGlibGUgdG9vbCwgYmFzZWQgdXBvbiB0aGUgZm91bmRhdGlvbnMgb2YgcHJvZ3Jlc3NpdmUgCgkgKiBlbmhhbmNlbWVudCwgd2hpY2ggd2lsbCBhZGQgYWR2YW5jZWQgaW50ZXJhY3Rpb24gY29udHJvbHMgdG8gYW55IAoJICogSFRNTCB0YWJsZS4gRm9yIGEgZnVsbCBsaXN0IG9mIGZlYXR1cmVzIHBsZWFzZSByZWZlciB0bwoJICogPGEgaHJlZj0iaHR0cDovL2RhdGF0YWJsZXMubmV0Ij5EYXRhVGFibGVzLm5ldDwvYT4uCgkgKgoJICogTm90ZSB0aGF0IHRoZSA8aT5EYXRhVGFibGU8L2k+IG9iamVjdCBpcyBub3QgYSBnbG9iYWwgdmFyaWFibGUgYnV0IGlzCgkgKiBhbGlhc2VkIHRvIDxpPmpRdWVyeS5mbi5EYXRhVGFibGU8L2k+IGFuZCA8aT5qUXVlcnkuZm4uZGF0YVRhYmxlPC9pPiB0aHJvdWdoIHdoaWNoIAoJICogaXQgbWF5IGJlICBhY2Nlc3NlZC4KCSAqCgkgKiAgQGNsYXNzCgkgKiAgQHBhcmFtIHtvYmplY3R9IFtvSW5pdD17fV0gQ29uZmlndXJhdGlvbiBvYmplY3QgZm9yIERhdGFUYWJsZXMuIE9wdGlvbnMKCSAqICAgIGFyZSBkZWZpbmVkIGJ5IHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9CgkgKiAgQHJlcXVpcmVzIGpRdWVyeSAxLjMrCgkgKiAKCSAqICBAZXhhbXBsZQoJICogICAgLy8gQmFzaWMgaW5pdGlhbGlzYXRpb24KCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbiB7CgkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkgKiAgICB9ICk7CgkgKiAgCgkgKiAgQGV4YW1wbGUKCSAqICAgIC8vIEluaXRpYWxpc2F0aW9uIHdpdGggY29uZmlndXJhdGlvbiBvcHRpb25zIC0gaW4gdGhpcyBjYXNlLCBkaXNhYmxlCgkgKiAgICAvLyBwYWdpbmF0aW9uIGFuZCBzb3J0aW5nLgoJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uIHsKCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCSAqICAgICAgICAiYlBhZ2luYXRlIjogZmFsc2UsCgkgKiAgICAgICAgImJTb3J0IjogZmFsc2UgCgkgKiAgICAgIH0gKTsKCSAqICAgIH0gKTsKCSAqLwoJdmFyIERhdGFUYWJsZSA9IGZ1bmN0aW9uKCBvSW5pdCApCgl7CgkJCgkJCgkJLyoqCgkJICogQWRkIGEgY29sdW1uIHRvIHRoZSBsaXN0IHVzZWQgZm9yIHRoZSB0YWJsZSB3aXRoIGRlZmF1bHQgdmFsdWVzCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtub2RlfSBuVGggVGhlIHRoIGVsZW1lbnQgZm9yIHRoaXMgY29sdW1uCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkFkZENvbHVtbiggb1NldHRpbmdzLCBuVGggKQoJCXsKCQkJdmFyIG9EZWZhdWx0cyA9IERhdGFUYWJsZS5kZWZhdWx0cy5jb2x1bW5zOwoJCQl2YXIgaUNvbCA9IG9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoOwoJCQl2YXIgb0NvbCA9ICQuZXh0ZW5kKCB7fSwgRGF0YVRhYmxlLm1vZGVscy5vQ29sdW1uLCBvRGVmYXVsdHMsIHsKCQkJCSJzU29ydGluZ0NsYXNzIjogb1NldHRpbmdzLm9DbGFzc2VzLnNTb3J0YWJsZSwKCQkJCSJzU29ydGluZ0NsYXNzSlVJIjogb1NldHRpbmdzLm9DbGFzc2VzLnNTb3J0SlVJLAoJCQkJIm5UaCI6IG5UaCA/IG5UaCA6IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RoJyksCgkJCQkic1RpdGxlIjogICAgb0RlZmF1bHRzLnNUaXRsZSAgICA/IG9EZWZhdWx0cy5zVGl0bGUgICAgOiBuVGggPyBuVGguaW5uZXJIVE1MIDogJycsCgkJCQkiYURhdGFTb3J0Ijogb0RlZmF1bHRzLmFEYXRhU29ydCA/IG9EZWZhdWx0cy5hRGF0YVNvcnQgOiBbaUNvbF0sCgkJCQkibURhdGFQcm9wIjogb0RlZmF1bHRzLm1EYXRhUHJvcCA/IG9EZWZhdWx0cy5vRGVmYXVsdHMgOiBpQ29sCgkJCX0gKTsKCQkJb1NldHRpbmdzLmFvQ29sdW1ucy5wdXNoKCBvQ29sICk7CgkJCQoJCQkvKiBBZGQgYSBjb2x1bW4gc3BlY2lmaWMgZmlsdGVyICovCgkJCWlmICggb1NldHRpbmdzLmFvUHJlU2VhcmNoQ29sc1sgaUNvbCBdID09PSB1bmRlZmluZWQgfHwgb1NldHRpbmdzLmFvUHJlU2VhcmNoQ29sc1sgaUNvbCBdID09PSBudWxsICkKCQkJewoJCQkJb1NldHRpbmdzLmFvUHJlU2VhcmNoQ29sc1sgaUNvbCBdID0gJC5leHRlbmQoIHt9LCBEYXRhVGFibGUubW9kZWxzLm9TZWFyY2ggKTsKCQkJfQoJCQllbHNlCgkJCXsKCQkJCXZhciBvUHJlID0gb1NldHRpbmdzLmFvUHJlU2VhcmNoQ29sc1sgaUNvbCBdOwoJCQkJCgkJCQkvKiBEb24ndCByZXF1aXJlIHRoYXQgdGhlIHVzZXIgbXVzdCBzcGVjaWZ5IGJSZWdleCwgYlNtYXJ0IG9yIGJDYXNlSW5zZW5zaXRpdmUgKi8KCQkJCWlmICggb1ByZS5iUmVnZXggPT09IHVuZGVmaW5lZCApCgkJCQl7CgkJCQkJb1ByZS5iUmVnZXggPSB0cnVlOwoJCQkJfQoJCQkJCgkJCQlpZiAoIG9QcmUuYlNtYXJ0ID09PSB1bmRlZmluZWQgKQoJCQkJewoJCQkJCW9QcmUuYlNtYXJ0ID0gdHJ1ZTsKCQkJCX0KCQkJCQoJCQkJaWYgKCBvUHJlLmJDYXNlSW5zZW5zaXRpdmUgPT09IHVuZGVmaW5lZCApCgkJCQl7CgkJCQkJb1ByZS5iQ2FzZUluc2Vuc2l0aXZlID0gdHJ1ZTsKCQkJCX0KCQkJfQoJCQkKCQkJLyogVXNlIHRoZSBjb2x1bW4gb3B0aW9ucyBmdW5jdGlvbiB0byBpbml0aWFsaXNlIGNsYXNzZXMgZXRjICovCgkJCV9mbkNvbHVtbk9wdGlvbnMoIG9TZXR0aW5ncywgaUNvbCwgbnVsbCApOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBBcHBseSBvcHRpb25zIGZvciBhIGNvbHVtbgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7aW50fSBpQ29sIGNvbHVtbiBpbmRleCB0byBjb25zaWRlcgoJCSAqICBAcGFyYW0ge29iamVjdH0gb09wdGlvbnMgb2JqZWN0IHdpdGggc1R5cGUsIGJWaXNpYmxlIGFuZCBiU2VhcmNoYWJsZQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5Db2x1bW5PcHRpb25zKCBvU2V0dGluZ3MsIGlDb2wsIG9PcHRpb25zICkKCQl7CgkJCXZhciBvQ29sID0gb1NldHRpbmdzLmFvQ29sdW1uc1sgaUNvbCBdOwoJCQkKCQkJLyogVXNlciBzcGVjaWZpZWQgY29sdW1uIG9wdGlvbnMgKi8KCQkJaWYgKCBvT3B0aW9ucyAhPT0gdW5kZWZpbmVkICYmIG9PcHRpb25zICE9PSBudWxsICkKCQkJewoJCQkJaWYgKCBvT3B0aW9ucy5zVHlwZSAhPT0gdW5kZWZpbmVkICkKCQkJCXsKCQkJCQlvQ29sLnNUeXBlID0gb09wdGlvbnMuc1R5cGU7CgkJCQkJb0NvbC5fYkF1dG9UeXBlID0gZmFsc2U7CgkJCQl9CgkJCQkKCQkJCSQuZXh0ZW5kKCBvQ29sLCBvT3B0aW9ucyApOwoJCQkJX2ZuTWFwKCBvQ29sLCBvT3B0aW9ucywgInNXaWR0aCIsICJzV2lkdGhPcmlnIiApOwoJCQoJCQkJLyogaURhdGFTb3J0IHRvIGJlIGFwcGxpZWQgKGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5KSwgYnV0IGFEYXRhU29ydCB3aWxsIHRha2UKCQkJCSAqIHByaW9yaXR5IGlmIGRlZmluZWQKCQkJCSAqLwoJCQkJaWYgKCBvT3B0aW9ucy5pRGF0YVNvcnQgIT09IHVuZGVmaW5lZCApCgkJCQl7CgkJCQkJb0NvbC5hRGF0YVNvcnQgPSBbIG9PcHRpb25zLmlEYXRhU29ydCBdOwoJCQkJfQoJCQkJX2ZuTWFwKCBvQ29sLCBvT3B0aW9ucywgImFEYXRhU29ydCIgKTsKCQkJfQoJCQoJCQkvKiBDYWNoZSB0aGUgZGF0YSBnZXQgYW5kIHNldCBmdW5jdGlvbnMgZm9yIHNwZWVkICovCgkJCW9Db2wuZm5HZXREYXRhID0gX2ZuR2V0T2JqZWN0RGF0YUZuKCBvQ29sLm1EYXRhUHJvcCApOwoJCQlvQ29sLmZuU2V0RGF0YSA9IF9mblNldE9iamVjdERhdGFGbiggb0NvbC5tRGF0YVByb3AgKTsKCQkJCgkJCS8qIEZlYXR1cmUgc29ydGluZyBvdmVycmlkZXMgY29sdW1uIHNwZWNpZmljIHdoZW4gb2ZmICovCgkJCWlmICggIW9TZXR0aW5ncy5vRmVhdHVyZXMuYlNvcnQgKQoJCQl7CgkJCQlvQ29sLmJTb3J0YWJsZSA9IGZhbHNlOwoJCQl9CgkJCQoJCQkvKiBDaGVjayB0aGF0IHRoZSBjbGFzcyBhc3NpZ25tZW50IGlzIGNvcnJlY3QgZm9yIHNvcnRpbmcgKi8KCQkJaWYgKCAhb0NvbC5iU29ydGFibGUgfHwKCQkJCSAoJC5pbkFycmF5KCdhc2MnLCBvQ29sLmFzU29ydGluZykgPT0gLTEgJiYgJC5pbkFycmF5KCdkZXNjJywgb0NvbC5hc1NvcnRpbmcpID09IC0xKSApCgkJCXsKCQkJCW9Db2wuc1NvcnRpbmdDbGFzcyA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydGFibGVOb25lOwoJCQkJb0NvbC5zU29ydGluZ0NsYXNzSlVJID0gIiI7CgkJCX0KCQkJZWxzZSBpZiAoIG9Db2wuYlNvcnRhYmxlIHx8CgkJCSAgICAgICAgICAoJC5pbkFycmF5KCdhc2MnLCBvQ29sLmFzU29ydGluZykgPT0gLTEgJiYgJC5pbkFycmF5KCdkZXNjJywgb0NvbC5hc1NvcnRpbmcpID09IC0xKSApCgkJCXsKCQkJICBvQ29sLnNTb3J0aW5nQ2xhc3MgPSBvU2V0dGluZ3Mub0NsYXNzZXMuc1NvcnRhYmxlOwoJCQkgIG9Db2wuc1NvcnRpbmdDbGFzc0pVSSA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydEpVSTsKCQkJfQoJCQllbHNlIGlmICggJC5pbkFycmF5KCdhc2MnLCBvQ29sLmFzU29ydGluZykgIT0gLTEgJiYgJC5pbkFycmF5KCdkZXNjJywgb0NvbC5hc1NvcnRpbmcpID09IC0xICkKCQkJewoJCQkJb0NvbC5zU29ydGluZ0NsYXNzID0gb1NldHRpbmdzLm9DbGFzc2VzLnNTb3J0YWJsZUFzYzsKCQkJCW9Db2wuc1NvcnRpbmdDbGFzc0pVSSA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydEpVSUFzY0FsbG93ZWQ7CgkJCX0KCQkJZWxzZSBpZiAoICQuaW5BcnJheSgnYXNjJywgb0NvbC5hc1NvcnRpbmcpID09IC0xICYmICQuaW5BcnJheSgnZGVzYycsIG9Db2wuYXNTb3J0aW5nKSAhPSAtMSApCgkJCXsKCQkJCW9Db2wuc1NvcnRpbmdDbGFzcyA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydGFibGVEZXNjOwoJCQkJb0NvbC5zU29ydGluZ0NsYXNzSlVJID0gb1NldHRpbmdzLm9DbGFzc2VzLnNTb3J0SlVJRGVzY0FsbG93ZWQ7CgkJCX0KCQl9CgkJCgkJCgkJLyoqCgkJICogQWRqdXN0IHRoZSB0YWJsZSBjb2x1bW4gd2lkdGhzIGZvciBuZXcgZGF0YS4gTm90ZTogeW91IHdvdWxkIHByb2JhYmx5IHdhbnQgdG8gCgkJICogZG8gYSByZWRyYXcgYWZ0ZXIgY2FsbGluZyB0aGlzIGZ1bmN0aW9uIQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkFkanVzdENvbHVtblNpemluZyAoIG9TZXR0aW5ncyApCgkJewoJCQkvKiBOb3QgaW50ZXJlc3RlZCBpbiBkb2luZyBjb2x1bW4gd2lkdGggY2FsY3VsYXRpb24gaWYgYXV0b3dpZHRoIGlzIGRpc2FibGVkICovCgkJCWlmICggb1NldHRpbmdzLm9GZWF0dXJlcy5iQXV0b1dpZHRoID09PSBmYWxzZSApCgkJCXsKCQkJCXJldHVybiBmYWxzZTsKCQkJfQoJCQkKCQkJX2ZuQ2FsY3VsYXRlQ29sdW1uV2lkdGhzKCBvU2V0dGluZ3MgKTsKCQkJZm9yICggdmFyIGk9MCAsIGlMZW49b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLm5UaC5zdHlsZS53aWR0aCA9IG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc1dpZHRoOwoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIENvdmVydCB0aGUgaW5kZXggb2YgYSB2aXNpYmxlIGNvbHVtbiB0byB0aGUgaW5kZXggaW4gdGhlIGRhdGEgYXJyYXkgKHRha2UgYWNjb3VudAoJCSAqIG9mIGhpZGRlbiBjb2x1bW5zKQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7aW50fSBpTWF0Y2ggVmlzaWJsZSBjb2x1bW4gaW5kZXggdG8gbG9va3VwCgkJICogIEByZXR1cm5zIHtpbnR9IGkgdGhlIGRhdGEgaW5kZXgKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuVmlzaWJsZVRvQ29sdW1uSW5kZXgoIG9TZXR0aW5ncywgaU1hdGNoICkKCQl7CgkJCXZhciBpQ29sdW1uID0gLTE7CgkJCQoJCQlmb3IgKCB2YXIgaT0wIDsgaTxvU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGkrKyApCgkJCXsKCQkJCWlmICggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5iVmlzaWJsZSA9PT0gdHJ1ZSApCgkJCQl7CgkJCQkJaUNvbHVtbisrOwoJCQkJfQoJCQkJCgkJCQlpZiAoIGlDb2x1bW4gPT0gaU1hdGNoICkKCQkJCXsKCQkJCQlyZXR1cm4gaTsKCQkJCX0KCQkJfQoJCQkKCQkJcmV0dXJuIG51bGw7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIENvdmVydCB0aGUgaW5kZXggb2YgYW4gaW5kZXggaW4gdGhlIGRhdGEgYXJyYXkgYW5kIGNvbnZlcnQgaXQgdG8gdGhlIHZpc2libGUKCQkgKiAgIGNvbHVtbiBpbmRleCAodGFrZSBhY2NvdW50IG9mIGhpZGRlbiBjb2x1bW5zKQoJCSAqICBAcGFyYW0ge2ludH0gaU1hdGNoIENvbHVtbiBpbmRleCB0byBsb29rdXAKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcmV0dXJucyB7aW50fSBpIHRoZSBkYXRhIGluZGV4CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkNvbHVtbkluZGV4VG9WaXNpYmxlKCBvU2V0dGluZ3MsIGlNYXRjaCApCgkJewoJCQl2YXIgaVZpc2libGUgPSAtMTsKCQkJZm9yICggdmFyIGk9MCA7IGk8b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpKysgKQoJCQl7CgkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uYlZpc2libGUgPT09IHRydWUgKQoJCQkJewoJCQkJCWlWaXNpYmxlKys7CgkJCQl9CgkJCQkKCQkJCWlmICggaSA9PSBpTWF0Y2ggKQoJCQkJewoJCQkJCXJldHVybiBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLmJWaXNpYmxlID09PSB0cnVlID8gaVZpc2libGUgOiBudWxsOwoJCQkJfQoJCQl9CgkJCQoJCQlyZXR1cm4gbnVsbDsKCQl9CgkJCgkJCgkJLyoqCgkJICogR2V0IHRoZSBudW1iZXIgb2YgdmlzaWJsZSBjb2x1bW5zCgkJICogIEByZXR1cm5zIHtpbnR9IGkgdGhlIG51bWJlciBvZiB2aXNpYmxlIGNvbHVtbnMKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblZpc2JsZUNvbHVtbnMoIG9TICkKCQl7CgkJCXZhciBpVmlzID0gMDsKCQkJZm9yICggdmFyIGk9MCA7IGk8b1MuYW9Db2x1bW5zLmxlbmd0aCA7IGkrKyApCgkJCXsKCQkJCWlmICggb1MuYW9Db2x1bW5zW2ldLmJWaXNpYmxlID09PSB0cnVlICkKCQkJCXsKCQkJCQlpVmlzKys7CgkJCQl9CgkJCX0KCQkJcmV0dXJuIGlWaXM7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEdldCB0aGUgc29ydCB0eXBlIGJhc2VkIG9uIGFuIGlucHV0IHN0cmluZwoJCSAqICBAcGFyYW0ge3N0cmluZ30gc0RhdGEgZGF0YSB3ZSB3aXNoIHRvIGtub3cgdGhlIHR5cGUgb2YKCQkgKiAgQHJldHVybnMge3N0cmluZ30gdHlwZSAoZGVmYXVsdHMgdG8gJ3N0cmluZycgaWYgbm8gdHlwZSBjYW4gYmUgZGV0ZWN0ZWQpCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkRldGVjdFR5cGUoIHNEYXRhICkKCQl7CgkJCXZhciBhVHlwZXMgPSBEYXRhVGFibGUuZXh0LmFUeXBlczsKCQkJdmFyIGlMZW4gPSBhVHlwZXMubGVuZ3RoOwoJCQkKCQkJZm9yICggdmFyIGk9MCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCXZhciBzVHlwZSA9IGFUeXBlc1tpXSggc0RhdGEgKTsKCQkJCWlmICggc1R5cGUgIT09IG51bGwgKQoJCQkJewoJCQkJCXJldHVybiBzVHlwZTsKCQkJCX0KCQkJfQoJCQkKCQkJcmV0dXJuICdzdHJpbmcnOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBGaWd1cmUgb3V0IGhvdyB0byByZW9yZGVyIGEgZGlzcGxheSBsaXN0CgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHJldHVybnMgYXJyYXkge2ludH0gYWlSZXR1cm4gaW5kZXggbGlzdCBmb3IgcmVvcmRlcmluZwoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5SZU9yZGVySW5kZXggKCBvU2V0dGluZ3MsIHNDb2x1bW5zICkKCQl7CgkJCXZhciBhQ29sdW1ucyA9IHNDb2x1bW5zLnNwbGl0KCcsJyk7CgkJCXZhciBhaVJldHVybiA9IFtdOwoJCQkKCQkJZm9yICggdmFyIGk9MCwgaUxlbj1vU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWZvciAoIHZhciBqPTAgOyBqPGlMZW4gOyBqKysgKQoJCQkJewoJCQkJCWlmICggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zTmFtZSA9PSBhQ29sdW1uc1tqXSApCgkJCQkJewoJCQkJCQlhaVJldHVybi5wdXNoKCBqICk7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCQkJCX0KCQkJfQoJCQkKCQkJcmV0dXJuIGFpUmV0dXJuOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBHZXQgdGhlIGNvbHVtbiBvcmRlcmluZyB0aGF0IERhdGFUYWJsZXMgZXhwZWN0cwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEByZXR1cm5zIHtzdHJpbmd9IGNvbW1hIHNlcGFyYXRlZCBsaXN0IG9mIG5hbWVzCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkNvbHVtbk9yZGVyaW5nICggb1NldHRpbmdzICkKCQl7CgkJCXZhciBzTmFtZXMgPSAnJzsKCQkJZm9yICggdmFyIGk9MCwgaUxlbj1vU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCXNOYW1lcyArPSBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNOYW1lKycsJzsKCQkJfQoJCQlpZiAoIHNOYW1lcy5sZW5ndGggPT0gaUxlbiApCgkJCXsKCQkJCXJldHVybiAiIjsKCQkJfQoJCQlyZXR1cm4gc05hbWVzLnNsaWNlKDAsIC0xKTsKCQl9CgkJCgkJCgkJLyoqCgkJICogVGFrZSB0aGUgY29sdW1uIGRlZmluaXRpb25zIGFuZCBzdGF0aWMgY29sdW1ucyBhcnJheXMgYW5kIGNhbGN1bGF0ZSBob3cKCQkgKiB0aGV5IHJlbGF0ZSB0byBjb2x1bW4gaW5kZXhlcy4gVGhlIGNhbGxiYWNrIGZ1bmN0aW9uIHdpbGwgdGhlbiBhcHBseSB0aGUKCQkgKiBkZWZpbml0aW9uIGZvdW5kIGZvciBhIGNvbHVtbiB0byBhIHN1aXRhYmxlIGNvbmZpZ3VyYXRpb24gb2JqZWN0LgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7YXJyYXl9IGFvQ29sRGVmcyBUaGUgYW9Db2x1bW5EZWZzIGFycmF5IHRoYXQgaXMgdG8gYmUgYXBwbGllZAoJCSAqICBAcGFyYW0ge2FycmF5fSBhb0NvbHMgVGhlIGFvQ29sdW1ucyBhcnJheSB0aGF0IGRlZmluZXMgY29sdW1ucyBpbmRpdmlkdWFsbHkKCQkgKiAgQHBhcmFtIHtmdW5jdGlvbn0gZm4gQ2FsbGJhY2sgZnVuY3Rpb24gLSB0YWtlcyB0d28gcGFyYW1ldGVycywgdGhlIGNhbGN1bGF0ZWQKCQkgKiAgICBjb2x1bW4gaW5kZXggYW5kIHRoZSBkZWZpbml0aW9uIGZvciB0aGF0IGNvbHVtbi4KCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuQXBwbHlDb2x1bW5EZWZzKCBvU2V0dGluZ3MsIGFvQ29sRGVmcywgYW9Db2xzLCBmbiApCgkJewoJCQl2YXIgaSwgaUxlbiwgaiwgakxlbiwgaywga0xlbjsKCQkKCQkJLy8gQ29sdW1uIGRlZmluaXRpb25zIHdpdGggYVRhcmdldHMKCQkJaWYgKCBhb0NvbERlZnMgKQoJCQl7CgkJCQkvKiBMb29wIG92ZXIgdGhlIGRlZmluaXRpb25zIGFycmF5IC0gbG9vcCBpbiByZXZlcnNlIHNvIGZpcnN0IGluc3RhbmNlIGhhcyBwcmlvcml0eSAqLwoJCQkJZm9yICggaT1hb0NvbERlZnMubGVuZ3RoLTEgOyBpPj0wIDsgaS0tICkKCQkJCXsKCQkJCQkvKiBFYWNoIGRlZmluaXRpb24gY2FuIHRhcmdldCBtdWx0aXBsZSBjb2x1bW5zLCBhcyBpdCBpcyBhbiBhcnJheSAqLwoJCQkJCXZhciBhVGFyZ2V0cyA9IGFvQ29sRGVmc1tpXS5hVGFyZ2V0czsKCQkJCQlpZiAoICEkLmlzQXJyYXkoIGFUYXJnZXRzICkgKQoJCQkJCXsKCQkJCQkJX2ZuTG9nKCBvU2V0dGluZ3MsIDEsICdhVGFyZ2V0cyBtdXN0IGJlIGFuIGFycmF5IG9mIHRhcmdldHMsIG5vdCBhICcrKHR5cGVvZiBhVGFyZ2V0cykgKTsKCQkJCQl9CgkJCgkJCQkJZm9yICggaj0wLCBqTGVuPWFUYXJnZXRzLmxlbmd0aCA7IGo8akxlbiA7IGorKyApCgkJCQkJewoJCQkJCQlpZiAoIHR5cGVvZiBhVGFyZ2V0c1tqXSA9PT0gJ251bWJlcicgJiYgYVRhcmdldHNbal0gPj0gMCApCgkJCQkJCXsKCQkJCQkJCS8qIEFkZCBjb2x1bW5zIHRoYXQgd2UgZG9uJ3QgeWV0IGtub3cgYWJvdXQgKi8KCQkJCQkJCXdoaWxlKCBvU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA8PSBhVGFyZ2V0c1tqXSApCgkJCQkJCQl7CgkJCQkJCQkJX2ZuQWRkQ29sdW1uKCBvU2V0dGluZ3MgKTsKCQkJCQkJCX0KCQkKCQkJCQkJCS8qIEludGVnZXIsIGJhc2ljIGluZGV4ICovCgkJCQkJCQlmbiggYVRhcmdldHNbal0sIGFvQ29sRGVmc1tpXSApOwoJCQkJCQl9CgkJCQkJCWVsc2UgaWYgKCB0eXBlb2YgYVRhcmdldHNbal0gPT09ICdudW1iZXInICYmIGFUYXJnZXRzW2pdIDwgMCApCgkJCQkJCXsKCQkJCQkJCS8qIE5lZ2F0aXZlIGludGVnZXIsIHJpZ2h0IHRvIGxlZnQgY29sdW1uIGNvdW50aW5nICovCgkJCQkJCQlmbiggb1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGgrYVRhcmdldHNbal0sIGFvQ29sRGVmc1tpXSApOwoJCQkJCQl9CgkJCQkJCWVsc2UgaWYgKCB0eXBlb2YgYVRhcmdldHNbal0gPT09ICdzdHJpbmcnICkKCQkJCQkJewoJCQkJCQkJLyogQ2xhc3MgbmFtZSBtYXRjaGluZyBvbiBUSCBlbGVtZW50ICovCgkJCQkJCQlmb3IgKCBrPTAsIGtMZW49b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBrPGtMZW4gOyBrKysgKQoJCQkJCQkJewoJCQkJCQkJCWlmICggYVRhcmdldHNbal0gPT0gIl9hbGwiIHx8CgkJCQkJCQkJICAgICAkKG9TZXR0aW5ncy5hb0NvbHVtbnNba10ublRoKS5oYXNDbGFzcyggYVRhcmdldHNbal0gKSApCgkJCQkJCQkJewoJCQkJCQkJCQlmbiggaywgYW9Db2xEZWZzW2ldICk7CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJCgkJCS8vIFN0YXRpY2FsbHkgZGVmaW5lZCBjb2x1bW5zIGFycmF5CgkJCWlmICggYW9Db2xzICkKCQkJewoJCQkJZm9yICggaT0wLCBpTGVuPWFvQ29scy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCWZuKCBpLCBhb0NvbHNbaV0gKTsKCQkJCX0KCQkJfQoJCX0KCQkKCQkKCQkKCQkvKioKCQkgKiBBZGQgYSBkYXRhIGFycmF5IHRvIHRoZSB0YWJsZSwgY3JlYXRpbmcgRE9NIG5vZGUgZXRjLiBUaGlzIGlzIHRoZSBwYXJhbGxlbCB0byAKCQkgKiBfZm5HYXRoZXJEYXRhLCBidXQgZm9yIGFkZGluZyByb3dzIGZyb20gYSBKYXZhc2NyaXB0IHNvdXJjZSwgcmF0aGVyIHRoYW4gYQoJCSAqIERPTSBzb3VyY2UuCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHthcnJheX0gYURhdGEgZGF0YSBhcnJheSB0byBiZSBhZGRlZAoJCSAqICBAcmV0dXJucyB7aW50fSA+PTAgaWYgc3VjY2Vzc2Z1bCAoaW5kZXggb2YgbmV3IGFvRGF0YSBlbnRyeSksIC0xIGlmIGZhaWxlZAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5BZGREYXRhICggb1NldHRpbmdzLCBhRGF0YVN1cHBsaWVkICkKCQl7CgkJCXZhciBvQ29sOwoJCQkKCQkJLyogVGFrZSBhbiBpbmRlcGVuZGVudCBjb3B5IG9mIHRoZSBkYXRhIHNvdXJjZSBzbyB3ZSBjYW4gYmFzaCBpdCBhYm91dCBhcyB3ZSB3aXNoICovCgkJCXZhciBhRGF0YUluID0gKCQuaXNBcnJheShhRGF0YVN1cHBsaWVkKSkgPwoJCQkJYURhdGFTdXBwbGllZC5zbGljZSgpIDoKCQkJCSQuZXh0ZW5kKCB0cnVlLCB7fSwgYURhdGFTdXBwbGllZCApOwoJCQkKCQkJLyogQ3JlYXRlIHRoZSBvYmplY3QgZm9yIHN0b3JpbmcgaW5mb3JtYXRpb24gYWJvdXQgdGhpcyBuZXcgcm93ICovCgkJCXZhciBpUm93ID0gb1NldHRpbmdzLmFvRGF0YS5sZW5ndGg7CgkJCXZhciBvRGF0YSA9ICQuZXh0ZW5kKCB0cnVlLCB7fSwgRGF0YVRhYmxlLm1vZGVscy5vUm93ICk7CgkJCW9EYXRhLl9hRGF0YSA9IGFEYXRhSW47CgkJCW9TZXR0aW5ncy5hb0RhdGEucHVzaCggb0RhdGEgKTsKCQkKCQkJLyogQ3JlYXRlIHRoZSBjZWxscyAqLwoJCQl2YXIgblRkLCBzVGhpc1R5cGU7CgkJCWZvciAoIHZhciBpPTAsIGlMZW49b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlvQ29sID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpXTsKCQkKCQkJCS8qIFVzZSByZW5kZXJlZCBkYXRhIGZvciBmaWx0ZXJpbmcvc29ydGluZyAqLwoJCQkJaWYgKCB0eXBlb2Ygb0NvbC5mblJlbmRlciA9PT0gJ2Z1bmN0aW9uJyAmJiBvQ29sLmJVc2VSZW5kZXJlZCAmJiBvQ29sLm1EYXRhUHJvcCAhPT0gbnVsbCApCgkJCQl7CgkJCQkJX2ZuU2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaSwgX2ZuUmVuZGVyKG9TZXR0aW5ncywgaVJvdywgaSkgKTsKCQkJCX0KCQkJCWVsc2UKCQkJCXsKCQkJCQlfZm5TZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpLCBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpICkgKTsKCQkJCX0KCQkJCQoJCQkJLyogU2VlIGlmIHdlIHNob3VsZCBhdXRvLWRldGVjdCB0aGUgY29sdW1uIHR5cGUgKi8KCQkJCWlmICggb0NvbC5fYkF1dG9UeXBlICYmIG9Db2wuc1R5cGUgIT0gJ3N0cmluZycgKQoJCQkJewoJCQkJCS8qIEF0dGVtcHQgdG8gYXV0byBkZXRlY3QgdGhlIHR5cGUgLSBzYW1lIGFzIF9mbkdhdGhlckRhdGEoKSAqLwoJCQkJCXZhciBzVmFyVHlwZSA9IF9mbkdldENlbGxEYXRhKCBvU2V0dGluZ3MsIGlSb3csIGksICd0eXBlJyApOwoJCQkJCWlmICggc1ZhclR5cGUgIT09IG51bGwgJiYgc1ZhclR5cGUgIT09ICcnICkKCQkJCQl7CgkJCQkJCXNUaGlzVHlwZSA9IF9mbkRldGVjdFR5cGUoIHNWYXJUeXBlICk7CgkJCQkJCWlmICggb0NvbC5zVHlwZSA9PT0gbnVsbCApCgkJCQkJCXsKCQkJCQkJCW9Db2wuc1R5cGUgPSBzVGhpc1R5cGU7CgkJCQkJCX0KCQkJCQkJZWxzZSBpZiAoIG9Db2wuc1R5cGUgIT0gc1RoaXNUeXBlICYmIG9Db2wuc1R5cGUgIT0gImh0bWwiICkKCQkJCQkJewoJCQkJCQkJLyogU3RyaW5nIGlzIGFsd2F5cyB0aGUgJ2ZhbGxiYWNrJyBvcHRpb24gKi8KCQkJCQkJCW9Db2wuc1R5cGUgPSAnc3RyaW5nJzsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJfQoJCQkKCQkJLyogQWRkIHRvIHRoZSBkaXNwbGF5IGFycmF5ICovCgkJCW9TZXR0aW5ncy5haURpc3BsYXlNYXN0ZXIucHVzaCggaVJvdyApOwoJCQoJCQkvKiBDcmVhdGUgdGhlIERPTSBpbWZvcm1hdGlvbiAqLwoJCQlpZiAoICFvU2V0dGluZ3Mub0ZlYXR1cmVzLmJEZWZlclJlbmRlciApCgkJCXsKCQkJCV9mbkNyZWF0ZVRyKCBvU2V0dGluZ3MsIGlSb3cgKTsKCQkJfQoJCQoJCQlyZXR1cm4gaVJvdzsKCQl9CgkJCgkJCgkJLyoqCgkJICogUmVhZCBpbiB0aGUgZGF0YSBmcm9tIHRoZSB0YXJnZXQgdGFibGUgZnJvbSB0aGUgRE9NCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuR2F0aGVyRGF0YSggb1NldHRpbmdzICkKCQl7CgkJCXZhciBpTG9vcCwgaSwgaUxlbiwgaiwgakxlbiwgaklubmVyLAoJCQkgCW5UZHMsIG5UcnMsIG5UZCwgYUxvY2FsRGF0YSwgaVRoaXNJbmRleCwKCQkJCWlSb3csIGlSb3dzLCBpQ29sdW1uLCBpQ29sdW1ucywgc05vZGVOYW1lLAoJCQkJb0NvbCwgb0RhdGE7CgkJCQoJCQkvKgoJCQkgKiBQcm9jZXNzIGJ5IHJvdyBmaXJzdAoJCQkgKiBBZGQgdGhlIGRhdGEgb2JqZWN0IGZvciB0aGUgd2hvbGUgdGFibGUgLSBzdG9yaW5nIHRoZSB0ciBub2RlLiBOb3RlIC0gbm8gcG9pbnQgaW4gZ2V0dGluZwoJCQkgKiBET00gYmFzZWQgZGF0YSBpZiB3ZSBhcmUgZ29pbmcgdG8gZ28gYW5kIHJlcGxhY2UgaXQgd2l0aCBBamF4IHNvdXJjZSBkYXRhLgoJCQkgKi8KCQkJaWYgKCBvU2V0dGluZ3MuYkRlZmVyTG9hZGluZyB8fCBvU2V0dGluZ3Muc0FqYXhTb3VyY2UgPT09IG51bGwgKQoJCQl7CgkJCQluVHJzID0gb1NldHRpbmdzLm5UQm9keS5jaGlsZE5vZGVzOwoJCQkJZm9yICggaT0wLCBpTGVuPW5UcnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQlpZiAoIG5UcnNbaV0ubm9kZU5hbWUudG9VcHBlckNhc2UoKSA9PSAiVFIiICkKCQkJCQl7CgkJCQkJCWlUaGlzSW5kZXggPSBvU2V0dGluZ3MuYW9EYXRhLmxlbmd0aDsKCQkJCQkJblRyc1tpXS5fRFRfUm93SW5kZXggPSBpVGhpc0luZGV4OwoJCQkJCQlvU2V0dGluZ3MuYW9EYXRhLnB1c2goICQuZXh0ZW5kKCB0cnVlLCB7fSwgRGF0YVRhYmxlLm1vZGVscy5vUm93LCB7CgkJCQkJCQkiblRyIjogblRyc1tpXQoJCQkJCQl9ICkgKTsKCQkJCQkJCgkJCQkJCW9TZXR0aW5ncy5haURpc3BsYXlNYXN0ZXIucHVzaCggaVRoaXNJbmRleCApOwoJCQkJCQluVGRzID0gblRyc1tpXS5jaGlsZE5vZGVzOwoJCQkJCQlqSW5uZXIgPSAwOwoJCQkJCQkKCQkJCQkJZm9yICggaj0wLCBqTGVuPW5UZHMubGVuZ3RoIDsgajxqTGVuIDsgaisrICkKCQkJCQkJewoJCQkJCQkJc05vZGVOYW1lID0gblRkc1tqXS5ub2RlTmFtZS50b1VwcGVyQ2FzZSgpOwoJCQkJCQkJaWYgKCBzTm9kZU5hbWUgPT0gIlREIiB8fCBzTm9kZU5hbWUgPT0gIlRIIiApCgkJCQkJCQl7CgkJCQkJCQkJX2ZuU2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVRoaXNJbmRleCwgaklubmVyLCAkLnRyaW0oblRkc1tqXS5pbm5lckhUTUwpICk7CgkJCQkJCQkJaklubmVyKys7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCX0KCQkJCgkJCS8qIEdhdGhlciBpbiB0aGUgVEQgZWxlbWVudHMgb2YgdGhlIFRhYmxlIC0gbm90ZSB0aGF0IHRoaXMgaXMgYmFzaWNhbGx5IHRoZSBzYW1lIGFzCgkJCSAqIGZuR2V0VGROb2RlcywgYnV0IHRoYXQgZnVuY3Rpb24gdGFrZXMgYWNjb3VudCBvZiBoaWRkZW4gY29sdW1ucywgd2hpY2ggd2UgaGF2ZW4ndCB5ZXQKCQkJICogc2V0dXAhCgkJCSAqLwoJCQluVHJzID0gX2ZuR2V0VHJOb2Rlcyggb1NldHRpbmdzICk7CgkJCW5UZHMgPSBbXTsKCQkJZm9yICggaT0wLCBpTGVuPW5UcnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJZm9yICggaj0wLCBqTGVuPW5UcnNbaV0uY2hpbGROb2Rlcy5sZW5ndGggOyBqPGpMZW4gOyBqKysgKQoJCQkJewoJCQkJCW5UZCA9IG5UcnNbaV0uY2hpbGROb2Rlc1tqXTsKCQkJCQlzTm9kZU5hbWUgPSBuVGQubm9kZU5hbWUudG9VcHBlckNhc2UoKTsKCQkJCQlpZiAoIHNOb2RlTmFtZSA9PSAiVEQiIHx8IHNOb2RlTmFtZSA9PSAiVEgiICkKCQkJCQl7CgkJCQkJCW5UZHMucHVzaCggblRkICk7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCQoJCQkvKiBOb3cgcHJvY2VzcyBieSBjb2x1bW4gKi8KCQkJZm9yICggaUNvbHVtbj0wLCBpQ29sdW1ucz1vU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGlDb2x1bW48aUNvbHVtbnMgOyBpQ29sdW1uKysgKQoJCQl7CgkJCQlvQ29sID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpQ29sdW1uXTsKCQkKCQkJCS8qIEdldCB0aGUgdGl0bGUgb2YgdGhlIGNvbHVtbiAtIHVubGVzcyB0aGVyZSBpcyBhIHVzZXIgc2V0IG9uZSAqLwoJCQkJaWYgKCBvQ29sLnNUaXRsZSA9PT0gbnVsbCApCgkJCQl7CgkJCQkJb0NvbC5zVGl0bGUgPSBvQ29sLm5UaC5pbm5lckhUTUw7CgkJCQl9CgkJCQkKCQkJCXZhcgoJCQkJCWJBdXRvVHlwZSA9IG9Db2wuX2JBdXRvVHlwZSwKCQkJCQliUmVuZGVyID0gdHlwZW9mIG9Db2wuZm5SZW5kZXIgPT09ICdmdW5jdGlvbicsCgkJCQkJYkNsYXNzID0gb0NvbC5zQ2xhc3MgIT09IG51bGwsCgkJCQkJYlZpc2libGUgPSBvQ29sLmJWaXNpYmxlLAoJCQkJCW5DZWxsLCBzVGhpc1R5cGUsIHNSZW5kZXJlZCwgc1ZhbFR5cGU7CgkJCQkKCQkJCS8qIEEgc2luZ2xlIGxvb3AgdG8gcnVsZSB0aGVtIGFsbCAoYW5kIGJlIG1vcmUgZWZmaWNpZW50KSAqLwoJCQkJaWYgKCBiQXV0b1R5cGUgfHwgYlJlbmRlciB8fCBiQ2xhc3MgfHwgIWJWaXNpYmxlICkKCQkJCXsKCQkJCQlmb3IgKCBpUm93PTAsIGlSb3dzPW9TZXR0aW5ncy5hb0RhdGEubGVuZ3RoIDsgaVJvdzxpUm93cyA7IGlSb3crKyApCgkJCQkJewoJCQkJCQlvRGF0YSA9IG9TZXR0aW5ncy5hb0RhdGFbaVJvd107CgkJCQkJCW5DZWxsID0gblRkc1sgKGlSb3cqaUNvbHVtbnMpICsgaUNvbHVtbiBdOwoJCQkJCQkKCQkJCQkJLyogVHlwZSBkZXRlY3Rpb24gKi8KCQkJCQkJaWYgKCBiQXV0b1R5cGUgJiYgb0NvbC5zVHlwZSAhPSAnc3RyaW5nJyApCgkJCQkJCXsKCQkJCQkJCXNWYWxUeXBlID0gX2ZuR2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaUNvbHVtbiwgJ3R5cGUnICk7CgkJCQkJCQlpZiAoIHNWYWxUeXBlICE9PSAnJyApCgkJCQkJCQl7CgkJCQkJCQkJc1RoaXNUeXBlID0gX2ZuRGV0ZWN0VHlwZSggc1ZhbFR5cGUgKTsKCQkJCQkJCQlpZiAoIG9Db2wuc1R5cGUgPT09IG51bGwgKQoJCQkJCQkJCXsKCQkJCQkJCQkJb0NvbC5zVHlwZSA9IHNUaGlzVHlwZTsKCQkJCQkJCQl9CgkJCQkJCQkJZWxzZSBpZiAoIG9Db2wuc1R5cGUgIT0gc1RoaXNUeXBlICYmIAoJCQkJCQkJCSAgICAgICAgICBvQ29sLnNUeXBlICE9ICJodG1sIiApCgkJCQkJCQkJewoJCQkJCQkJCQkvKiBTdHJpbmcgaXMgYWx3YXlzIHRoZSAnZmFsbGJhY2snIG9wdGlvbiAqLwoJCQkJCQkJCQlvQ29sLnNUeXBlID0gJ3N0cmluZyc7CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQl9CgkJCgkJCQkJCWlmICggdHlwZW9mIG9Db2wubURhdGFQcm9wID09PSAnZnVuY3Rpb24nICkKCQkJCQkJewoJCQkJCQkJbkNlbGwuaW5uZXJIVE1MID0gX2ZuR2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaUNvbHVtbiwgJ2Rpc3BsYXknICk7CgkJCQkJCX0KCQkJCQkJCgkJCQkJCS8qIFJlbmRlcmluZyAqLwoJCQkJCQlpZiAoIGJSZW5kZXIgKQoJCQkJCQl7CgkJCQkJCQlzUmVuZGVyZWQgPSBfZm5SZW5kZXIoIG9TZXR0aW5ncywgaVJvdywgaUNvbHVtbiApOwoJCQkJCQkJbkNlbGwuaW5uZXJIVE1MID0gc1JlbmRlcmVkOwoJCQkJCQkJaWYgKCBvQ29sLmJVc2VSZW5kZXJlZCApCgkJCQkJCQl7CgkJCQkJCQkJLyogVXNlIHRoZSByZW5kZXJlZCBkYXRhIGZvciBmaWx0ZXJpbmcvc29ydGluZyAqLwoJCQkJCQkJCV9mblNldENlbGxEYXRhKCBvU2V0dGluZ3MsIGlSb3csIGlDb2x1bW4sIHNSZW5kZXJlZCApOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJCQoJCQkJCQkvKiBDbGFzc2VzICovCgkJCQkJCWlmICggYkNsYXNzICkKCQkJCQkJewoJCQkJCQkJbkNlbGwuY2xhc3NOYW1lICs9ICcgJytvQ29sLnNDbGFzczsKCQkJCQkJfQoJCQkJCQkKCQkJCQkJLyogQ29sdW1uIHZpc2FiaWxpdHkgKi8KCQkJCQkJaWYgKCAhYlZpc2libGUgKQoJCQkJCQl7CgkJCQkJCQlvRGF0YS5fYW5IaWRkZW5baUNvbHVtbl0gPSBuQ2VsbDsKCQkJCQkJCW5DZWxsLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoIG5DZWxsICk7CgkJCQkJCX0KCQkJCQkJZWxzZQoJCQkJCQl7CgkJCQkJCQlvRGF0YS5fYW5IaWRkZW5baUNvbHVtbl0gPSBudWxsOwoJCQkJCQl9CgkJCgkJCQkJCWlmICggb0NvbC5mbkNyZWF0ZWRDZWxsICkKCQkJCQkJewoJCQkJCQkJb0NvbC5mbkNyZWF0ZWRDZWxsLmNhbGwoIG9TZXR0aW5ncy5vSW5zdGFuY2UsCgkJCQkJCQkJbkNlbGwsIF9mbkdldENlbGxEYXRhKCBvU2V0dGluZ3MsIGlSb3csIGlDb2x1bW4sICdkaXNwbGF5JyApLCBvRGF0YS5fYURhdGEsIGlSb3csIGlDb2x1bW4KCQkJCQkJCSk7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCX0KCQkKCQkJLyogUm93IGNyZWF0ZWQgY2FsbGJhY2tzICovCgkJCWlmICggb1NldHRpbmdzLmFvUm93Q3JlYXRlZENhbGxiYWNrLmxlbmd0aCAhPT0gMCApCgkJCXsKCQkJCWZvciAoIGk9MCwgaUxlbj1vU2V0dGluZ3MuYW9EYXRhLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJb0RhdGEgPSBvU2V0dGluZ3MuYW9EYXRhW2ldOwoJCQkJCV9mbkNhbGxiYWNrRmlyZSggb1NldHRpbmdzLCAnYW9Sb3dDcmVhdGVkQ2FsbGJhY2snLCBudWxsLCBbb0RhdGEublRyLCBvRGF0YS5fYURhdGEsIGldICk7CgkJCQl9CgkJCX0KCQl9CgkJCgkJCgkJLyoqCgkJICogVGFrZSBhIFRSIGVsZW1lbnQgYW5kIGNvbnZlcnQgaXQgdG8gYW4gaW5kZXggaW4gYW9EYXRhCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtub2RlfSBuIHRoZSBUUiBlbGVtZW50IHRvIGZpbmQKCQkgKiAgQHJldHVybnMge2ludH0gaW5kZXggaWYgdGhlIG5vZGUgaXMgZm91bmQsIG51bGwgaWYgbm90CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbk5vZGVUb0RhdGFJbmRleCggb1NldHRpbmdzLCBuICkKCQl7CgkJCXJldHVybiAobi5fRFRfUm93SW5kZXghPT11bmRlZmluZWQpID8gbi5fRFRfUm93SW5kZXggOiBudWxsOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBUYWtlIGEgVEQgZWxlbWVudCBhbmQgY29udmVydCBpdCBpbnRvIGEgY29sdW1uIGRhdGEgaW5kZXggKG5vdCB0aGUgdmlzaWJsZSBpbmRleCkKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge2ludH0gaVJvdyBUaGUgcm93IG51bWJlciB0aGUgVEQvVEggY2FuIGJlIGZvdW5kIGluCgkJICogIEBwYXJhbSB7bm9kZX0gbiBUaGUgVEQvVEggZWxlbWVudCB0byBmaW5kCgkJICogIEByZXR1cm5zIHtpbnR9IGluZGV4IGlmIHRoZSBub2RlIGlzIGZvdW5kLCAtMSBpZiBub3QKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuTm9kZVRvQ29sdW1uSW5kZXgoIG9TZXR0aW5ncywgaVJvdywgbiApCgkJewoJCQl2YXIgYW5DZWxscyA9IF9mbkdldFRkTm9kZXMoIG9TZXR0aW5ncywgaVJvdyApOwoJCQoJCQlmb3IgKCB2YXIgaT0wLCBpTGVuPW9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJaWYgKCBhbkNlbGxzW2ldID09PSBuICkKCQkJCXsKCQkJCQlyZXR1cm4gaTsKCQkJCX0KCQkJfQoJCQlyZXR1cm4gLTE7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEdldCBhbiBhcnJheSBvZiBkYXRhIGZvciBhIGdpdmVuIHJvdyBmcm9tIHRoZSBpbnRlcm5hbCBkYXRhIGNhY2hlCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtpbnR9IGlSb3cgYW9EYXRhIHJvdyBpZAoJCSAqICBAcGFyYW0ge3N0cmluZ30gc1NwZWNpZmljIGRhdGEgZ2V0IHR5cGUgKCd0eXBlJyAnZmlsdGVyJyAnc29ydCcpCgkJICogIEByZXR1cm5zIHthcnJheX0gRGF0YSBhcnJheQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5HZXRSb3dEYXRhKCBvU2V0dGluZ3MsIGlSb3csIHNTcGVjaWZpYyApCgkJewoJCQl2YXIgb3V0ID0gW107CgkJCWZvciAoIHZhciBpPTAsIGlMZW49b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlvdXQucHVzaCggX2ZuR2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaSwgc1NwZWNpZmljICkgKTsKCQkJfQoJCQlyZXR1cm4gb3V0OwoJCX0KCQkKCQkKCQkvKioKCQkgKiBHZXQgdGhlIGRhdGEgZm9yIGEgZ2l2ZW4gY2VsbCBmcm9tIHRoZSBpbnRlcm5hbCBjYWNoZSwgdGFraW5nIGludG8gYWNjb3VudCBkYXRhIG1hcHBpbmcKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge2ludH0gaVJvdyBhb0RhdGEgcm93IGlkCgkJICogIEBwYXJhbSB7aW50fSBpQ29sIENvbHVtbiBpbmRleAoJCSAqICBAcGFyYW0ge3N0cmluZ30gc1NwZWNpZmljIGRhdGEgZ2V0IHR5cGUgKCdkaXNwbGF5JywgJ3R5cGUnICdmaWx0ZXInICdzb3J0JykKCQkgKiAgQHJldHVybnMgeyp9IENlbGwgZGF0YQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpQ29sLCBzU3BlY2lmaWMgKQoJCXsKCQkJdmFyIHNEYXRhOwoJCQl2YXIgb0NvbCA9IG9TZXR0aW5ncy5hb0NvbHVtbnNbaUNvbF07CgkJCXZhciBvRGF0YSA9IG9TZXR0aW5ncy5hb0RhdGFbaVJvd10uX2FEYXRhOwoJCQoJCQlpZiAoIChzRGF0YT1vQ29sLmZuR2V0RGF0YSggb0RhdGEsIHNTcGVjaWZpYyApKSA9PT0gdW5kZWZpbmVkICkKCQkJewoJCQkJaWYgKCBvU2V0dGluZ3MuaURyYXdFcnJvciAhPSBvU2V0dGluZ3MuaURyYXcgJiYgb0NvbC5zRGVmYXVsdENvbnRlbnQgPT09IG51bGwgKQoJCQkJewoJCQkJCV9mbkxvZyggb1NldHRpbmdzLCAwLCAiUmVxdWVzdGVkIHVua25vd24gcGFyYW1ldGVyICIrCgkJCQkJCSh0eXBlb2Ygb0NvbC5tRGF0YVByb3A9PSdmdW5jdGlvbicgPyAne21EYXRhcHJvcCBmdW5jdGlvbn0nIDogIiciK29Db2wubURhdGFQcm9wKyInIikrCgkJCQkJCSIgZnJvbSB0aGUgZGF0YSBzb3VyY2UgZm9yIHJvdyAiK2lSb3cgKTsKCQkJCQlvU2V0dGluZ3MuaURyYXdFcnJvciA9IG9TZXR0aW5ncy5pRHJhdzsKCQkJCX0KCQkJCXJldHVybiBvQ29sLnNEZWZhdWx0Q29udGVudDsKCQkJfQoJCQoJCQkvKiBXaGVuIHRoZSBkYXRhIHNvdXJjZSBpcyBudWxsLCB3ZSBjYW4gdXNlIGRlZmF1bHQgY29sdW1uIGRhdGEgKi8KCQkJaWYgKCBzRGF0YSA9PT0gbnVsbCAmJiBvQ29sLnNEZWZhdWx0Q29udGVudCAhPT0gbnVsbCApCgkJCXsKCQkJCXNEYXRhID0gb0NvbC5zRGVmYXVsdENvbnRlbnQ7CgkJCX0KCQkJZWxzZSBpZiAoIHR5cGVvZiBzRGF0YSA9PT0gJ2Z1bmN0aW9uJyApCgkJCXsKCQkJCS8qIElmIHRoZSBkYXRhIHNvdXJjZSBpcyBhIGZ1bmN0aW9uLCB0aGVuIHdlIHJ1biBpdCBhbmQgdXNlIHRoZSByZXR1cm4gKi8KCQkJCXJldHVybiBzRGF0YSgpOwoJCQl9CgkJCgkJCWlmICggc1NwZWNpZmljID09ICdkaXNwbGF5JyAmJiBzRGF0YSA9PT0gbnVsbCApCgkJCXsKCQkJCXJldHVybiAnJzsKCQkJfQoJCQlyZXR1cm4gc0RhdGE7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIFNldCB0aGUgdmFsdWUgZm9yIGEgc3BlY2lmaWMgY2VsbCwgaW50byB0aGUgaW50ZXJuYWwgZGF0YSBjYWNoZQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7aW50fSBpUm93IGFvRGF0YSByb3cgaWQKCQkgKiAgQHBhcmFtIHtpbnR9IGlDb2wgQ29sdW1uIGluZGV4CgkJICogIEBwYXJhbSB7Kn0gdmFsIFZhbHVlIHRvIHNldAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5TZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpQ29sLCB2YWwgKQoJCXsKCQkJdmFyIG9Db2wgPSBvU2V0dGluZ3MuYW9Db2x1bW5zW2lDb2xdOwoJCQl2YXIgb0RhdGEgPSBvU2V0dGluZ3MuYW9EYXRhW2lSb3ddLl9hRGF0YTsKCQkKCQkJb0NvbC5mblNldERhdGEoIG9EYXRhLCB2YWwgKTsKCQl9CgkJCgkJCgkJLyoqCgkJICogUmV0dXJuIGEgZnVuY3Rpb24gdGhhdCBjYW4gYmUgdXNlZCB0byBnZXQgZGF0YSBmcm9tIGEgc291cmNlIG9iamVjdCwgdGFraW5nCgkJICogaW50byBhY2NvdW50IHRoZSBhYmlsaXR5IHRvIHVzZSBuZXN0ZWQgb2JqZWN0cyBhcyBhIHNvdXJjZQoJCSAqICBAcGFyYW0ge3N0cmluZ3xpbnR8ZnVuY3Rpb259IG1Tb3VyY2UgVGhlIGRhdGEgc291cmNlIGZvciB0aGUgb2JqZWN0CgkJICogIEByZXR1cm5zIHtmdW5jdGlvbn0gRGF0YSBnZXQgZnVuY3Rpb24KCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuR2V0T2JqZWN0RGF0YUZuKCBtU291cmNlICkKCQl7CgkJCWlmICggbVNvdXJjZSA9PT0gbnVsbCApCgkJCXsKCQkJCS8qIEdpdmUgYW4gZW1wdHkgc3RyaW5nIGZvciByZW5kZXJpbmcgLyBzb3J0aW5nIGV0YyAqLwoJCQkJcmV0dXJuIGZ1bmN0aW9uIChkYXRhLCB0eXBlKSB7CgkJCQkJcmV0dXJuIG51bGw7CgkJCQl9OwoJCQl9CgkJCWVsc2UgaWYgKCB0eXBlb2YgbVNvdXJjZSA9PT0gJ2Z1bmN0aW9uJyApCgkJCXsKCQkJCXJldHVybiBmdW5jdGlvbiAoZGF0YSwgdHlwZSkgewoJCQkJCXJldHVybiBtU291cmNlKCBkYXRhLCB0eXBlICk7CgkJCQl9OwoJCQl9CgkJCWVsc2UgaWYgKCB0eXBlb2YgbVNvdXJjZSA9PT0gJ3N0cmluZycgJiYgbVNvdXJjZS5pbmRleE9mKCcuJykgIT0gLTEgKQoJCQl7CgkJCQkvKiBJZiB0aGVyZSBpcyBhIC4gaW4gdGhlIHNvdXJjZSBzdHJpbmcgdGhlbiB0aGUgZGF0YSBzb3VyY2UgaXMgaW4gYSAKCQkJCSAqIG5lc3RlZCBvYmplY3Qgc28gd2UgbG9vcCBvdmVyIHRoZSBkYXRhIGZvciBlYWNoIGxldmVsIHRvIGdldCB0aGUgbmV4dAoJCQkJICogbGV2ZWwgZG93bi4gT24gZWFjaCBsb29wIHdlIHRlc3QgZm9yIHVuZGVmaW5lZCwgYW5kIGlmIGZvdW5kIGltbWVkaWF0bHkKCQkJCSAqIHJldHVybi4gVGhpcyBhbGxvd3MgZW50aXJlIG9iamVjdHMgdG8gYmUgbWlzc2luZyBhbmQgc0RlZmF1bHRDb250ZW50IHRvCgkJCQkgKiBiZSB1c2VkIGlmIGRlZmluZWQsIHJhdGhlciB0aGFuIHRocm93aW5nIGFuIGVycm9yCgkJCQkgKi8KCQkJCXZhciBhID0gbVNvdXJjZS5zcGxpdCgnLicpOwoJCQkJcmV0dXJuIGZ1bmN0aW9uIChkYXRhLCB0eXBlKSB7CgkJCQkJZm9yICggdmFyIGk9MCwgaUxlbj1hLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQkJewoJCQkJCQlkYXRhID0gZGF0YVsgYVtpXSBdOwoJCQkJCQlpZiAoIGRhdGEgPT09IHVuZGVmaW5lZCApCgkJCQkJCXsKCQkJCQkJCXJldHVybiB1bmRlZmluZWQ7CgkJCQkJCX0KCQkJCQl9CgkJCQkJcmV0dXJuIGRhdGE7CgkJCQl9OwoJCQl9CgkJCWVsc2UKCQkJewoJCQkJLyogQXJyYXkgb3IgZmxhdCBvYmplY3QgbWFwcGluZyAqLwoJCQkJcmV0dXJuIGZ1bmN0aW9uIChkYXRhLCB0eXBlKSB7CgkJCQkJcmV0dXJuIGRhdGFbbVNvdXJjZV07CQoJCQkJfTsKCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBSZXR1cm4gYSBmdW5jdGlvbiB0aGF0IGNhbiBiZSB1c2VkIHRvIHNldCBkYXRhIGZyb20gYSBzb3VyY2Ugb2JqZWN0LCB0YWtpbmcKCQkgKiBpbnRvIGFjY291bnQgdGhlIGFiaWxpdHkgdG8gdXNlIG5lc3RlZCBvYmplY3RzIGFzIGEgc291cmNlCgkJICogIEBwYXJhbSB7c3RyaW5nfGludHxmdW5jdGlvbn0gbVNvdXJjZSBUaGUgZGF0YSBzb3VyY2UgZm9yIHRoZSBvYmplY3QKCQkgKiAgQHJldHVybnMge2Z1bmN0aW9ufSBEYXRhIHNldCBmdW5jdGlvbgoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5TZXRPYmplY3REYXRhRm4oIG1Tb3VyY2UgKQoJCXsKCQkJaWYgKCBtU291cmNlID09PSBudWxsICkKCQkJewoJCQkJLyogTm90aGluZyB0byBkbyB3aGVuIHRoZSBkYXRhIHNvdXJjZSBpcyBudWxsICovCgkJCQlyZXR1cm4gZnVuY3Rpb24gKGRhdGEsIHZhbCkge307CgkJCX0KCQkJZWxzZSBpZiAoIHR5cGVvZiBtU291cmNlID09PSAnZnVuY3Rpb24nICkKCQkJewoJCQkJcmV0dXJuIGZ1bmN0aW9uIChkYXRhLCB2YWwpIHsKCQkJCQltU291cmNlKCBkYXRhLCAnc2V0JywgdmFsICk7CgkJCQl9OwoJCQl9CgkJCWVsc2UgaWYgKCB0eXBlb2YgbVNvdXJjZSA9PT0gJ3N0cmluZycgJiYgbVNvdXJjZS5pbmRleE9mKCcuJykgIT0gLTEgKQoJCQl7CgkJCQkvKiBMaWtlIHRoZSBnZXQsIHdlIG5lZWQgdG8gZ2V0IGRhdGEgZnJvbSBhIG5lc3RlZCBvYmplY3QuICAqLwoJCQkJdmFyIGEgPSBtU291cmNlLnNwbGl0KCcuJyk7CgkJCQlyZXR1cm4gZnVuY3Rpb24gKGRhdGEsIHZhbCkgewoJCQkJCWZvciAoIHZhciBpPTAsIGlMZW49YS5sZW5ndGgtMSA7IGk8aUxlbiA7IGkrKyApCgkJCQkJewoJCQkJCQkvLyBJZiB0aGUgbmVzdGVkIG9iamVjdCBkb2Vzbid0IGN1cnJlbnRseSBleGlzdCAtIHNpbmNlIHdlIGFyZQoJCQkJCQkvLyB0cnlpbmcgdG8gc2V0IHRoZSB2YWx1ZSAtIGNyZWF0ZSBpdAoJCQkJCQlpZiAoIGRhdGFbIGFbaV0gXSA9PT0gdW5kZWZpbmVkICkKCQkJCQkJewoJCQkJCQkJZGF0YVsgYVtpXSBdID0ge307CgkJCQkJCX0KCQkJCQkJZGF0YSA9IGRhdGFbIGFbaV0gXTsKCQkJCQl9CgkJCQkJZGF0YVsgYVthLmxlbmd0aC0xXSBdID0gdmFsOwoJCQkJfTsKCQkJfQoJCQllbHNlCgkJCXsKCQkJCS8qIEFycmF5IG9yIGZsYXQgb2JqZWN0IG1hcHBpbmcgKi8KCQkJCXJldHVybiBmdW5jdGlvbiAoZGF0YSwgdmFsKSB7CgkJCQkJZGF0YVttU291cmNlXSA9IHZhbDsJCgkJCQl9OwoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIFJldHVybiBhbiBhcnJheSB3aXRoIHRoZSBmdWxsIHRhYmxlIGRhdGEKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcmV0dXJucyBhcnJheSB7YXJyYXl9IGFEYXRhIE1hc3RlciBkYXRhIGFycmF5CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkdldERhdGFNYXN0ZXIgKCBvU2V0dGluZ3MgKQoJCXsKCQkJdmFyIGFEYXRhID0gW107CgkJCXZhciBpTGVuID0gb1NldHRpbmdzLmFvRGF0YS5sZW5ndGg7CgkJCWZvciAoIHZhciBpPTAgOyBpPGlMZW47IGkrKyApCgkJCXsKCQkJCWFEYXRhLnB1c2goIG9TZXR0aW5ncy5hb0RhdGFbaV0uX2FEYXRhICk7CgkJCX0KCQkJcmV0dXJuIGFEYXRhOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBOdWtlIHRoZSB0YWJsZQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkNsZWFyVGFibGUoIG9TZXR0aW5ncyApCgkJewoJCQlvU2V0dGluZ3MuYW9EYXRhLnNwbGljZSggMCwgb1NldHRpbmdzLmFvRGF0YS5sZW5ndGggKTsKCQkJb1NldHRpbmdzLmFpRGlzcGxheU1hc3Rlci5zcGxpY2UoIDAsIG9TZXR0aW5ncy5haURpc3BsYXlNYXN0ZXIubGVuZ3RoICk7CgkJCW9TZXR0aW5ncy5haURpc3BsYXkuc3BsaWNlKCAwLCBvU2V0dGluZ3MuYWlEaXNwbGF5Lmxlbmd0aCApOwoJCQlfZm5DYWxjdWxhdGVFbmQoIG9TZXR0aW5ncyApOwoJCX0KCQkKCQkKCQkgLyoqCgkJICogVGFrZSBhbiBhcnJheSBvZiBpbnRlZ2VycyAoaW5kZXggYXJyYXkpIGFuZCByZW1vdmUgYSB0YXJnZXQgaW50ZWdlciAodmFsdWUgLSBub3QgCgkJICogdGhlIGtleSEpCgkJICogIEBwYXJhbSB7YXJyYXl9IGEgSW5kZXggYXJyYXkgdG8gdGFyZ2V0CgkJICogIEBwYXJhbSB7aW50fSBpVGFyZ2V0IHZhbHVlIHRvIGZpbmQKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuRGVsZXRlSW5kZXgoIGEsIGlUYXJnZXQgKQoJCXsKCQkJdmFyIGlUYXJnZXRJbmRleCA9IC0xOwoJCQkKCQkJZm9yICggdmFyIGk9MCwgaUxlbj1hLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWlmICggYVtpXSA9PSBpVGFyZ2V0ICkKCQkJCXsKCQkJCQlpVGFyZ2V0SW5kZXggPSBpOwoJCQkJfQoJCQkJZWxzZSBpZiAoIGFbaV0gPiBpVGFyZ2V0ICkKCQkJCXsKCQkJCQlhW2ldLS07CgkJCQl9CgkJCX0KCQkJCgkJCWlmICggaVRhcmdldEluZGV4ICE9IC0xICkKCQkJewoJCQkJYS5zcGxpY2UoIGlUYXJnZXRJbmRleCwgMSApOwoJCQl9CgkJfQoJCQoJCQoJCSAvKioKCQkgKiBDYWxsIHRoZSBkZXZlbG9wZXIgZGVmaW5lZCBmblJlbmRlciBmdW5jdGlvbiBmb3IgYSBnaXZlbiBjZWxsIChyb3cvY29sdW1uKSB3aXRoCgkJICogdGhlIHJlcXVpcmVkIHBhcmFtZXRlcnMgYW5kIHJldHVybiB0aGUgcmVzdWx0LgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7aW50fSBpUm93IGFvRGF0YSBpbmRleCBmb3IgdGhlIHJvdwoJCSAqICBAcGFyYW0ge2ludH0gaUNvbCBhb0NvbHVtbnMgaW5kZXggZm9yIHRoZSBjb2x1bW4KCQkgKiAgQHJldHVybnMgeyp9IFJldHVybiBvZiB0aGUgZGV2ZWxvcGVyJ3MgZm5SZW5kZXIgZnVuY3Rpb24KCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuUmVuZGVyKCBvU2V0dGluZ3MsIGlSb3csIGlDb2wgKQoJCXsKCQkJdmFyIG9Db2wgPSBvU2V0dGluZ3MuYW9Db2x1bW5zW2lDb2xdOwoJCQoJCQlyZXR1cm4gb0NvbC5mblJlbmRlciggewoJCQkJImlEYXRhUm93IjogICAgaVJvdywKCQkJCSJpRGF0YUNvbHVtbiI6IGlDb2wsCgkJCQkib1NldHRpbmdzIjogICBvU2V0dGluZ3MsCgkJCQkiYURhdGEiOiAgICAgICBvU2V0dGluZ3MuYW9EYXRhW2lSb3ddLl9hRGF0YSwKCQkJCSJtRGF0YVByb3AiOiAgIG9Db2wubURhdGFQcm9wCgkJCX0sIF9mbkdldENlbGxEYXRhKG9TZXR0aW5ncywgaVJvdywgaUNvbCwgJ2Rpc3BsYXknKSApOwoJCX0KCQkKCQkvKioKCQkgKiBDcmVhdGUgYSBuZXcgVFIgZWxlbWVudCAoYW5kIGl0J3MgVEQgY2hpbGRyZW4pIGZvciBhIHJvdwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7aW50fSBpUm93IFJvdyB0byBjb25zaWRlcgoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5DcmVhdGVUciAoIG9TZXR0aW5ncywgaVJvdyApCgkJewoJCQl2YXIgb0RhdGEgPSBvU2V0dGluZ3MuYW9EYXRhW2lSb3ddOwoJCQl2YXIgblRkOwoJCQoJCQlpZiAoIG9EYXRhLm5UciA9PT0gbnVsbCApCgkJCXsKCQkJCW9EYXRhLm5UciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7CgkJCgkJCQkvKiBVc2UgYSBwcml2YXRlIHByb3BlcnR5IG9uIHRoZSBub2RlIHRvIGFsbG93IHJlc2VydmUgbWFwcGluZyBmcm9tIHRoZSBub2RlCgkJCQkgKiB0byB0aGUgYW9EYXRhIGFycmF5IGZvciBmYXN0IGxvb2sgdXAKCQkJCSAqLwoJCQkJb0RhdGEublRyLl9EVF9Sb3dJbmRleCA9IGlSb3c7CgkJCgkJCQkvKiBTcGVjaWFsIHBhcmFtZXRlcnMgY2FuIGJlIGdpdmVuIGJ5IHRoZSBkYXRhIHNvdXJjZSB0byBiZSB1c2VkIG9uIHRoZSByb3cgKi8KCQkJCWlmICggb0RhdGEuX2FEYXRhLkRUX1Jvd0lkICkKCQkJCXsKCQkJCQlvRGF0YS5uVHIuaWQgPSBvRGF0YS5fYURhdGEuRFRfUm93SWQ7CgkJCQl9CgkJCgkJCQlpZiAoIG9EYXRhLl9hRGF0YS5EVF9Sb3dDbGFzcyApCgkJCQl7CgkJCQkJJChvRGF0YS5uVHIpLmFkZENsYXNzKCBvRGF0YS5fYURhdGEuRFRfUm93Q2xhc3MgKTsKCQkJCX0KCQkKCQkJCS8qIFByb2Nlc3MgZWFjaCBjb2x1bW4gKi8KCQkJCWZvciAoIHZhciBpPTAsIGlMZW49b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCXZhciBvQ29sID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpXTsKCQkJCQluVGQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCBvQ29sLnNDZWxsVHlwZSApOwoJCQoJCQkJCS8qIFJlbmRlciBpZiBuZWVkZWQgLSBpZiBiVXNlUmVuZGVyZWQgaXMgdHJ1ZSB0aGVuIHdlIGFscmVhZHkgaGF2ZSB0aGUgcmVuZGVyZWQKCQkJCQkgKiB2YWx1ZSBpbiB0aGUgZGF0YSBzb3VyY2UgLSBzbyBjYW4ganVzdCB1c2UgdGhhdAoJCQkJCSAqLwoJCQkJCW5UZC5pbm5lckhUTUwgPSAodHlwZW9mIG9Db2wuZm5SZW5kZXIgPT09ICdmdW5jdGlvbicgJiYgKCFvQ29sLmJVc2VSZW5kZXJlZCB8fCBvQ29sLm1EYXRhUHJvcCA9PT0gbnVsbCkpID8KCQkJCQkJX2ZuUmVuZGVyKCBvU2V0dGluZ3MsIGlSb3csIGkgKSA6CgkJCQkJCV9mbkdldENlbGxEYXRhKCBvU2V0dGluZ3MsIGlSb3csIGksICdkaXNwbGF5JyApOwoJCQkJCgkJCQkJLyogQWRkIHVzZXIgZGVmaW5lZCBjbGFzcyAqLwoJCQkJCWlmICggb0NvbC5zQ2xhc3MgIT09IG51bGwgKQoJCQkJCXsKCQkJCQkJblRkLmNsYXNzTmFtZSA9IG9Db2wuc0NsYXNzOwoJCQkJCX0KCQkJCQkKCQkJCQlpZiAoIG9Db2wuYlZpc2libGUgKQoJCQkJCXsKCQkJCQkJb0RhdGEublRyLmFwcGVuZENoaWxkKCBuVGQgKTsKCQkJCQkJb0RhdGEuX2FuSGlkZGVuW2ldID0gbnVsbDsKCQkJCQl9CgkJCQkJZWxzZQoJCQkJCXsKCQkJCQkJb0RhdGEuX2FuSGlkZGVuW2ldID0gblRkOwoJCQkJCX0KCQkKCQkJCQlpZiAoIG9Db2wuZm5DcmVhdGVkQ2VsbCApCgkJCQkJewoJCQkJCQlvQ29sLmZuQ3JlYXRlZENlbGwuY2FsbCggb1NldHRpbmdzLm9JbnN0YW5jZSwKCQkJCQkJCW5UZCwgX2ZuR2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaSwgJ2Rpc3BsYXknICksIG9EYXRhLl9hRGF0YSwgaVJvdywgaQoJCQkJCQkpOwoJCQkJCX0KCQkJCX0KCQkKCQkJCV9mbkNhbGxiYWNrRmlyZSggb1NldHRpbmdzLCAnYW9Sb3dDcmVhdGVkQ2FsbGJhY2snLCBudWxsLCBbb0RhdGEublRyLCBvRGF0YS5fYURhdGEsIGlSb3ddICk7CgkJCX0KCQl9CgkJCgkJCgkJLyoqCgkJICogQ3JlYXRlIHRoZSBIVE1MIGhlYWRlciBmb3IgdGhlIHRhYmxlCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuQnVpbGRIZWFkKCBvU2V0dGluZ3MgKQoJCXsKCQkJdmFyIGksIG5UaCwgaUxlbiwgaiwgakxlbjsKCQkJdmFyIGlUaHMgPSBvU2V0dGluZ3MublRIZWFkLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0aCcpLmxlbmd0aDsKCQkJdmFyIGlDb3JyZWN0b3IgPSAwOwoJCQl2YXIganFDaGlsZHJlbjsKCQkJCgkJCS8qIElmIHRoZXJlIGlzIGEgaGVhZGVyIGluIHBsYWNlIC0gdGhlbiB1c2UgaXQgLSBvdGhlcndpc2UgaXQncyBnb2luZyB0byBnZXQgbnVrZWQuLi4gKi8KCQkJaWYgKCBpVGhzICE9PSAwICkKCQkJewoJCQkJLyogV2UndmUgZ290IGEgdGhlYWQgZnJvbSB0aGUgRE9NLCBzbyByZW1vdmUgaGlkZGVuIGNvbHVtbnMgYW5kIGFwcGx5IHdpZHRoIHRvIHZpcyBjb2xzICovCgkJCQlmb3IgKCBpPTAsIGlMZW49b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCW5UaCA9IG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0ublRoOwoJCQkJCW5UaC5zZXRBdHRyaWJ1dGUoJ3JvbGUnLCAnY29sdW1uaGVhZGVyJyk7CgkJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLmJTb3J0YWJsZSApCgkJCQkJewoJCQkJCQluVGguc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsIG9TZXR0aW5ncy5pVGFiSW5kZXgpOwoJCQkJCQluVGguc2V0QXR0cmlidXRlKCdhcmlhLWNvbnRyb2xzJywgb1NldHRpbmdzLnNUYWJsZUlkKTsKCQkJCQl9CgkJCgkJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNDbGFzcyAhPT0gbnVsbCApCgkJCQkJewoJCQkJCQkkKG5UaCkuYWRkQ2xhc3MoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc0NsYXNzICk7CgkJCQkJfQoJCQkJCQoJCQkJCS8qIFNldCB0aGUgdGl0bGUgb2YgdGhlIGNvbHVtbiBpZiBpdCBpcyB1c2VyIGRlZmluZWQgKG5vdCB3aGF0IHdhcyBhdXRvIGRldGVjdGVkKSAqLwoJCQkJCWlmICggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zVGl0bGUgIT0gblRoLmlubmVySFRNTCApCgkJCQkJewoJCQkJCQluVGguaW5uZXJIVE1MID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zVGl0bGU7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCWVsc2UKCQkJewoJCQkJLyogV2UgZG9uJ3QgaGF2ZSBhIGhlYWRlciBpbiB0aGUgRE9NIC0gc28gd2UgYXJlIGdvaW5nIHRvIGhhdmUgdG8gY3JlYXRlIG9uZSAqLwoJCQkJdmFyIG5UciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICJ0ciIgKTsKCQkJCQoJCQkJZm9yICggaT0wLCBpTGVuPW9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQluVGggPSBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLm5UaDsKCQkJCQluVGguaW5uZXJIVE1MID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zVGl0bGU7CgkJCQkJblRoLnNldEF0dHJpYnV0ZSgndGFiaW5kZXgnLCAnMCcpOwoJCQkJCQoJCQkJCWlmICggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zQ2xhc3MgIT09IG51bGwgKQoJCQkJCXsKCQkJCQkJJChuVGgpLmFkZENsYXNzKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNDbGFzcyApOwoJCQkJCX0KCQkJCQkKCQkJCQluVHIuYXBwZW5kQ2hpbGQoIG5UaCApOwoJCQkJfQoJCQkJJChvU2V0dGluZ3MublRIZWFkKS5odG1sKCAnJyApWzBdLmFwcGVuZENoaWxkKCBuVHIgKTsKCQkJCV9mbkRldGVjdEhlYWRlciggb1NldHRpbmdzLmFvSGVhZGVyLCBvU2V0dGluZ3MublRIZWFkICk7CgkJCX0KCQkJCgkJCS8qIEFSSUEgcm9sZSBmb3IgdGhlIHJvd3MgKi8JCgkJCSQob1NldHRpbmdzLm5USGVhZCkuY2hpbGRyZW4oJ3RyJykuYXR0cigncm9sZScsICdyb3cnKTsKCQkJCgkJCS8qIEFkZCB0aGUgZXh0cmEgbWFya3VwIG5lZWRlZCBieSBqUXVlcnkgVUkncyB0aGVtZXMgKi8KCQkJaWYgKCBvU2V0dGluZ3MuYkpVSSApCgkJCXsKCQkJCWZvciAoIGk9MCwgaUxlbj1vU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJblRoID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5uVGg7CgkJCQkJCgkJCQkJdmFyIG5EaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKCQkJCQluRGl2LmNsYXNzTmFtZSA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydEpVSVdyYXBwZXI7CgkJCQkJJChuVGgpLmNvbnRlbnRzKCkuYXBwZW5kVG8obkRpdik7CgkJCQkJCgkJCQkJdmFyIG5TcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpOwoJCQkJCW5TcGFuLmNsYXNzTmFtZSA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydEljb247CgkJCQkJbkRpdi5hcHBlbmRDaGlsZCggblNwYW4gKTsKCQkJCQluVGguYXBwZW5kQ2hpbGQoIG5EaXYgKTsKCQkJCX0KCQkJfQoJCQkKCQkJaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTb3J0ICkKCQkJewoJCQkJZm9yICggaT0wIDsgaTxvU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGkrKyApCgkJCQl7CgkJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLmJTb3J0YWJsZSAhPT0gZmFsc2UgKQoJCQkJCXsKCQkJCQkJX2ZuU29ydEF0dGFjaExpc3RlbmVyKCBvU2V0dGluZ3MsIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0ublRoLCBpICk7CgkJCQkJfQoJCQkJCWVsc2UKCQkJCQl7CgkJCQkJCSQob1NldHRpbmdzLmFvQ29sdW1uc1tpXS5uVGgpLmFkZENsYXNzKCBvU2V0dGluZ3Mub0NsYXNzZXMuc1NvcnRhYmxlTm9uZSApOwoJCQkJCX0KCQkJCX0KCQkJfQoJCQkKCQkJLyogRGVhbCB3aXRoIHRoZSBmb290ZXIgLSBhZGQgY2xhc3NlcyBpZiByZXF1aXJlZCAqLwoJCQlpZiAoIG9TZXR0aW5ncy5vQ2xhc3Nlcy5zRm9vdGVyVEggIT09ICIiICkKCQkJewoJCQkJJChvU2V0dGluZ3MublRGb290KS5jaGlsZHJlbigndHInKS5jaGlsZHJlbigndGgnKS5hZGRDbGFzcyggb1NldHRpbmdzLm9DbGFzc2VzLnNGb290ZXJUSCApOwoJCQl9CgkJCQoJCQkvKiBDYWNoZSB0aGUgZm9vdGVyIGVsZW1lbnRzICovCgkJCWlmICggb1NldHRpbmdzLm5URm9vdCAhPT0gbnVsbCApCgkJCXsKCQkJCXZhciBhbkNlbGxzID0gX2ZuR2V0VW5pcXVlVGhzKCBvU2V0dGluZ3MsIG51bGwsIG9TZXR0aW5ncy5hb0Zvb3RlciApOwoJCQkJZm9yICggaT0wLCBpTGVuPW9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQlpZiAoIGFuQ2VsbHNbaV0gKQoJCQkJCXsKCQkJCQkJb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5uVGYgPSBhbkNlbGxzW2ldOwoJCQkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc0NsYXNzICkKCQkJCQkJewoJCQkJCQkJJChhbkNlbGxzW2ldKS5hZGRDbGFzcyggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zQ2xhc3MgKTsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBEcmF3IHRoZSBoZWFkZXIgKG9yIGZvb3RlcikgZWxlbWVudCBiYXNlZCBvbiB0aGUgY29sdW1uIHZpc2liaWxpdHkgc3RhdGVzLiBUaGUKCQkgKiBtZXRob2RvbG9neSBoZXJlIGlzIHRvIHVzZSB0aGUgbGF5b3V0IGFycmF5IGZyb20gX2ZuRGV0ZWN0SGVhZGVyLCBtb2RpZmllZCBmb3IKCQkgKiB0aGUgaW5zdGFudGFuZW91cyBjb2x1bW4gdmlzaWJpbGl0eSwgdG8gY29uc3RydWN0IHRoZSBuZXcgbGF5b3V0LiBUaGUgZ3JpZCBpcwoJCSAqIHRyYXZlcnNlZCBvdmVyIGNlbGwgYXQgYSB0aW1lIGluIGEgcm93cyB4IGNvbHVtbnMgZ3JpZCBmYXNoaW9uLCBhbHRob3VnaCBlYWNoIAoJCSAqIGNlbGwgaW5zZXJ0IGNhbiBjb3ZlciBtdWx0aXBsZSBlbGVtZW50cyBpbiB0aGUgZ3JpZCAtIHdoaWNoIGlzIHRyYWNrcyB1c2luZyB0aGUKCQkgKiBhQXBwbGllZCBhcnJheS4gQ2VsbCBpbnNlcnRzIGluIHRoZSBncmlkIHdpbGwgb25seSBvY2N1ciB3aGVyZSB0aGVyZSBpc24ndAoJCSAqIGFscmVhZHkgYSBjZWxsIGluIHRoYXQgcG9zaXRpb24uCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIGFycmF5IHtvYmplY3RzfSBhb1NvdXJjZSBMYXlvdXQgYXJyYXkgZnJvbSBfZm5EZXRlY3RIZWFkZXIKCQkgKiAgQHBhcmFtIHtib29sZWFufSBbYkluY2x1ZGVIaWRkZW49ZmFsc2VdIElmIHRydWUgdGhlbiBpbmNsdWRlIHRoZSBoaWRkZW4gY29sdW1ucyBpbiB0aGUgY2FsYywgCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkRyYXdIZWFkKCBvU2V0dGluZ3MsIGFvU291cmNlLCBiSW5jbHVkZUhpZGRlbiApCgkJewoJCQl2YXIgaSwgaUxlbiwgaiwgakxlbiwgaywga0xlbiwgbiwgbkxvY2FsVHI7CgkJCXZhciBhb0xvY2FsID0gW107CgkJCXZhciBhQXBwbGllZCA9IFtdOwoJCQl2YXIgaUNvbHVtbnMgPSBvU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aDsKCQkJdmFyIGlSb3dzcGFuLCBpQ29sc3BhbjsKCQkKCQkJaWYgKCAgYkluY2x1ZGVIaWRkZW4gPT09IHVuZGVmaW5lZCApCgkJCXsKCQkJCWJJbmNsdWRlSGlkZGVuID0gZmFsc2U7CgkJCX0KCQkKCQkJLyogTWFrZSBhIGNvcHkgb2YgdGhlIG1hc3RlciBsYXlvdXQgYXJyYXksIGJ1dCB3aXRob3V0IHRoZSB2aXNpYmxlIGNvbHVtbnMgaW4gaXQgKi8KCQkJZm9yICggaT0wLCBpTGVuPWFvU291cmNlLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWFvTG9jYWxbaV0gPSBhb1NvdXJjZVtpXS5zbGljZSgpOwoJCQkJYW9Mb2NhbFtpXS5uVHIgPSBhb1NvdXJjZVtpXS5uVHI7CgkJCgkJCQkvKiBSZW1vdmUgYW55IGNvbHVtbnMgd2hpY2ggYXJlIGN1cnJlbnRseSBoaWRkZW4gKi8KCQkJCWZvciAoIGo9aUNvbHVtbnMtMSA7IGo+PTAgOyBqLS0gKQoJCQkJewoJCQkJCWlmICggIW9TZXR0aW5ncy5hb0NvbHVtbnNbal0uYlZpc2libGUgJiYgIWJJbmNsdWRlSGlkZGVuICkKCQkJCQl7CgkJCQkJCWFvTG9jYWxbaV0uc3BsaWNlKCBqLCAxICk7CgkJCQkJfQoJCQkJfQoJCQoJCQkJLyogUHJlcCB0aGUgYXBwbGllZCBhcnJheSAtIGl0IG5lZWRzIGFuIGVsZW1lbnQgZm9yIGVhY2ggcm93ICovCgkJCQlhQXBwbGllZC5wdXNoKCBbXSApOwoJCQl9CgkJCgkJCWZvciAoIGk9MCwgaUxlbj1hb0xvY2FsLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCW5Mb2NhbFRyID0gYW9Mb2NhbFtpXS5uVHI7CgkJCQkKCQkJCS8qIEFsbCBjZWxscyBhcmUgZ29pbmcgdG8gYmUgcmVwbGFjZWQsIHNvIGVtcHR5IG91dCB0aGUgcm93ICovCgkJCQlpZiAoIG5Mb2NhbFRyICkKCQkJCXsKCQkJCQl3aGlsZSggKG4gPSBuTG9jYWxUci5maXJzdENoaWxkKSApCgkJCQkJewoJCQkJCQluTG9jYWxUci5yZW1vdmVDaGlsZCggbiApOwoJCQkJCX0KCQkJCX0KCQkKCQkJCWZvciAoIGo9MCwgakxlbj1hb0xvY2FsW2ldLmxlbmd0aCA7IGo8akxlbiA7IGorKyApCgkJCQl7CgkJCQkJaVJvd3NwYW4gPSAxOwoJCQkJCWlDb2xzcGFuID0gMTsKCQkKCQkJCQkvKiBDaGVjayB0byBzZWUgaWYgdGhlcmUgaXMgYWxyZWFkeSBhIGNlbGwgKHJvdy9jb2xzcGFuKSBjb3ZlcmluZyBvdXIgdGFyZ2V0CgkJCQkJICogaW5zZXJ0IHBvaW50LiBJZiB0aGVyZSBpcywgdGhlbiB0aGVyZSBpcyBub3RoaW5nIHRvIGRvLgoJCQkJCSAqLwoJCQkJCWlmICggYUFwcGxpZWRbaV1bal0gPT09IHVuZGVmaW5lZCApCgkJCQkJewoJCQkJCQluTG9jYWxUci5hcHBlbmRDaGlsZCggYW9Mb2NhbFtpXVtqXS5jZWxsICk7CgkJCQkJCWFBcHBsaWVkW2ldW2pdID0gMTsKCQkKCQkJCQkJLyogRXhwYW5kIHRoZSBjZWxsIHRvIGNvdmVyIGFzIG1hbnkgcm93cyBhcyBuZWVkZWQgKi8KCQkJCQkJd2hpbGUgKCBhb0xvY2FsW2kraVJvd3NwYW5dICE9PSB1bmRlZmluZWQgJiYKCQkJCQkJICAgICAgICBhb0xvY2FsW2ldW2pdLmNlbGwgPT0gYW9Mb2NhbFtpK2lSb3dzcGFuXVtqXS5jZWxsICkKCQkJCQkJewoJCQkJCQkJYUFwcGxpZWRbaStpUm93c3Bhbl1bal0gPSAxOwoJCQkJCQkJaVJvd3NwYW4rKzsKCQkJCQkJfQoJCQoJCQkJCQkvKiBFeHBhbmQgdGhlIGNlbGwgdG8gY292ZXIgYXMgbWFueSBjb2x1bW5zIGFzIG5lZWRlZCAqLwoJCQkJCQl3aGlsZSAoIGFvTG9jYWxbaV1baitpQ29sc3Bhbl0gIT09IHVuZGVmaW5lZCAmJgoJCQkJCQkgICAgICAgIGFvTG9jYWxbaV1bal0uY2VsbCA9PSBhb0xvY2FsW2ldW2oraUNvbHNwYW5dLmNlbGwgKQoJCQkJCQl7CgkJCQkJCQkvKiBNdXN0IHVwZGF0ZSB0aGUgYXBwbGllZCBhcnJheSBvdmVyIHRoZSByb3dzIGZvciB0aGUgY29sdW1ucyAqLwoJCQkJCQkJZm9yICggaz0wIDsgazxpUm93c3BhbiA7IGsrKyApCgkJCQkJCQl7CgkJCQkJCQkJYUFwcGxpZWRbaStrXVtqK2lDb2xzcGFuXSA9IDE7CgkJCQkJCQl9CgkJCQkJCQlpQ29sc3BhbisrOwoJCQkJCQl9CgkJCgkJCQkJCS8qIERvIHRoZSBhY3R1YWwgZXhwYW5zaW9uIGluIHRoZSBET00gKi8KCQkJCQkJYW9Mb2NhbFtpXVtqXS5jZWxsLnJvd1NwYW4gPSBpUm93c3BhbjsKCQkJCQkJYW9Mb2NhbFtpXVtqXS5jZWxsLmNvbFNwYW4gPSBpQ29sc3BhbjsKCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgkJCgkJCgkJLyoqCgkJICogSW5zZXJ0IHRoZSByZXF1aXJlZCBUUiBub2RlcyBpbnRvIHRoZSB0YWJsZSBmb3IgZGlzcGxheQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkRyYXcoIG9TZXR0aW5ncyApCgkJewoJCQkvKiBQcm92aWRlIGEgcHJlLWNhbGxiYWNrIGZ1bmN0aW9uIHdoaWNoIGNhbiBiZSB1c2VkIHRvIGNhbmNlbCB0aGUgZHJhdyBpcyBmYWxzZSBpcyByZXR1cm5lZCAqLwoJCQl2YXIgYVByZURyYXcgPSBfZm5DYWxsYmFja0ZpcmUoIG9TZXR0aW5ncywgJ2FvUHJlRHJhd0NhbGxiYWNrJywgJ3ByZURyYXcnLCBbb1NldHRpbmdzXSApOwoJCQlpZiAoICQuaW5BcnJheSggZmFsc2UsIGFQcmVEcmF3ICkgIT09IC0xICkKCQkJewoJCQkJX2ZuUHJvY2Vzc2luZ0Rpc3BsYXkoIG9TZXR0aW5ncywgZmFsc2UgKTsKCQkJCXJldHVybjsKCQkJfQoJCQkKCQkJdmFyIGksIGlMZW4sIG47CgkJCXZhciBhblJvd3MgPSBbXTsKCQkJdmFyIGlSb3dDb3VudCA9IDA7CgkJCXZhciBpU3RyaXBlcyA9IG9TZXR0aW5ncy5hc1N0cmlwZUNsYXNzZXMubGVuZ3RoOwoJCQl2YXIgaU9wZW5Sb3dzID0gb1NldHRpbmdzLmFvT3BlblJvd3MubGVuZ3RoOwoJCQkKCQkJb1NldHRpbmdzLmJEcmF3aW5nID0gdHJ1ZTsKCQkJCgkJCS8qIENoZWNrIGFuZCBzZWUgaWYgd2UgaGF2ZSBhbiBpbml0aWFsIGRyYXcgcG9zaXRpb24gZnJvbSBzdGF0ZSBzYXZpbmcgKi8KCQkJaWYgKCBvU2V0dGluZ3MuaUluaXREaXNwbGF5U3RhcnQgIT09IHVuZGVmaW5lZCAmJiBvU2V0dGluZ3MuaUluaXREaXNwbGF5U3RhcnQgIT0gLTEgKQoJCQl7CgkJCQlpZiAoIG9TZXR0aW5ncy5vRmVhdHVyZXMuYlNlcnZlclNpZGUgKQoJCQkJewoJCQkJCW9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA9IG9TZXR0aW5ncy5pSW5pdERpc3BsYXlTdGFydDsKCQkJCX0KCQkJCWVsc2UKCQkJCXsKCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSAob1NldHRpbmdzLmlJbml0RGlzcGxheVN0YXJ0ID49IG9TZXR0aW5ncy5mblJlY29yZHNEaXNwbGF5KCkpID8KCQkJCQkJMCA6IG9TZXR0aW5ncy5pSW5pdERpc3BsYXlTdGFydDsKCQkJCX0KCQkJCW9TZXR0aW5ncy5pSW5pdERpc3BsYXlTdGFydCA9IC0xOwoJCQkJX2ZuQ2FsY3VsYXRlRW5kKCBvU2V0dGluZ3MgKTsKCQkJfQoJCQkKCQkJLyogU2VydmVyLXNpZGUgcHJvY2Vzc2luZyBkcmF3IGludGVyY2VwdCAqLwoJCQlpZiAoIG9TZXR0aW5ncy5iRGVmZXJMb2FkaW5nICkKCQkJewoJCQkJb1NldHRpbmdzLmJEZWZlckxvYWRpbmcgPSBmYWxzZTsKCQkJCW9TZXR0aW5ncy5pRHJhdysrOwoJCQl9CgkJCWVsc2UgaWYgKCAhb1NldHRpbmdzLm9GZWF0dXJlcy5iU2VydmVyU2lkZSApCgkJCXsKCQkJCW9TZXR0aW5ncy5pRHJhdysrOwoJCQl9CgkJCWVsc2UgaWYgKCAhb1NldHRpbmdzLmJEZXN0cm95aW5nICYmICFfZm5BamF4VXBkYXRlKCBvU2V0dGluZ3MgKSApCgkJCXsKCQkJCXJldHVybjsKCQkJfQoJCQkKCQkJaWYgKCBvU2V0dGluZ3MuYWlEaXNwbGF5Lmxlbmd0aCAhPT0gMCApCgkJCXsKCQkJCXZhciBpU3RhcnQgPSBvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQ7CgkJCQl2YXIgaUVuZCA9IG9TZXR0aW5ncy5faURpc3BsYXlFbmQ7CgkJCQkKCQkJCWlmICggb1NldHRpbmdzLm9GZWF0dXJlcy5iU2VydmVyU2lkZSApCgkJCQl7CgkJCQkJaVN0YXJ0ID0gMDsKCQkJCQlpRW5kID0gb1NldHRpbmdzLmFvRGF0YS5sZW5ndGg7CgkJCQl9CgkJCQkKCQkJCWZvciAoIHZhciBqPWlTdGFydCA7IGo8aUVuZCA7IGorKyApCgkJCQl7CgkJCQkJdmFyIGFvRGF0YSA9IG9TZXR0aW5ncy5hb0RhdGFbIG9TZXR0aW5ncy5haURpc3BsYXlbal0gXTsKCQkJCQlpZiAoIGFvRGF0YS5uVHIgPT09IG51bGwgKQoJCQkJCXsKCQkJCQkJX2ZuQ3JlYXRlVHIoIG9TZXR0aW5ncywgb1NldHRpbmdzLmFpRGlzcGxheVtqXSApOwoJCQkJCX0KCQkKCQkJCQl2YXIgblJvdyA9IGFvRGF0YS5uVHI7CgkJCQkJCgkJCQkJLyogUmVtb3ZlIHRoZSBvbGQgc3RyaXBpbmcgY2xhc3NlcyBhbmQgdGhlbiBhZGQgdGhlIG5ldyBvbmUgKi8KCQkJCQlpZiAoIGlTdHJpcGVzICE9PSAwICkKCQkJCQl7CgkJCQkJCXZhciBzU3RyaXBlID0gb1NldHRpbmdzLmFzU3RyaXBlQ2xhc3Nlc1sgaVJvd0NvdW50ICUgaVN0cmlwZXMgXTsKCQkJCQkJaWYgKCBhb0RhdGEuX3NSb3dTdHJpcGUgIT0gc1N0cmlwZSApCgkJCQkJCXsKCQkJCQkJCSQoblJvdykucmVtb3ZlQ2xhc3MoIGFvRGF0YS5fc1Jvd1N0cmlwZSApLmFkZENsYXNzKCBzU3RyaXBlICk7CgkJCQkJCQlhb0RhdGEuX3NSb3dTdHJpcGUgPSBzU3RyaXBlOwoJCQkJCQl9CgkJCQkJfQoJCQkJCQoJCQkJCS8qIFJvdyBjYWxsYmFjayBmdW5jdGlvbnMgLSBtaWdodCB3YW50IHRvIG1hbmlwdWxlIHRoZSByb3cgKi8KCQkJCQlfZm5DYWxsYmFja0ZpcmUoIG9TZXR0aW5ncywgJ2FvUm93Q2FsbGJhY2snLCBudWxsLCAKCQkJCQkJW25Sb3csIG9TZXR0aW5ncy5hb0RhdGFbIG9TZXR0aW5ncy5haURpc3BsYXlbal0gXS5fYURhdGEsIGlSb3dDb3VudCwgal0gKTsKCQkJCQkKCQkJCQlhblJvd3MucHVzaCggblJvdyApOwoJCQkJCWlSb3dDb3VudCsrOwoJCQkJCQoJCQkJCS8qIElmIHRoZXJlIGlzIGFuIG9wZW4gcm93IC0gYW5kIGl0IGlzIGF0dGFjaGVkIHRvIHRoaXMgcGFyZW50IC0gYXR0YWNoIGl0IG9uIHJlZHJhdyAqLwoJCQkJCWlmICggaU9wZW5Sb3dzICE9PSAwICkKCQkJCQl7CgkJCQkJCWZvciAoIHZhciBrPTAgOyBrPGlPcGVuUm93cyA7IGsrKyApCgkJCQkJCXsKCQkJCQkJCWlmICggblJvdyA9PSBvU2V0dGluZ3MuYW9PcGVuUm93c1trXS5uUGFyZW50ICkKCQkJCQkJCXsKCQkJCQkJCQlhblJvd3MucHVzaCggb1NldHRpbmdzLmFvT3BlblJvd3Nba10ublRyICk7CgkJCQkJCQkJYnJlYWs7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQkvKiBUYWJsZSBpcyBlbXB0eSAtIGNyZWF0ZSBhIHJvdyB3aXRoIGFuIGVtcHR5IG1lc3NhZ2UgaW4gaXQgKi8KCQkJCWFuUm93c1sgMCBdID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ3RyJyApOwoJCQkJCgkJCQlpZiAoIG9TZXR0aW5ncy5hc1N0cmlwZUNsYXNzZXNbMF0gKQoJCQkJewoJCQkJCWFuUm93c1sgMCBdLmNsYXNzTmFtZSA9IG9TZXR0aW5ncy5hc1N0cmlwZUNsYXNzZXNbMF07CgkJCQl9CgkJCgkJCQl2YXIgb0xhbmcgPSBvU2V0dGluZ3Mub0xhbmd1YWdlOwoJCQkJdmFyIHNaZXJvID0gb0xhbmcuc1plcm9SZWNvcmRzOwoJCQkJaWYgKCBvU2V0dGluZ3MuaURyYXcgPT0gMSAmJiBvU2V0dGluZ3Muc0FqYXhTb3VyY2UgIT09IG51bGwgJiYgIW9TZXR0aW5ncy5vRmVhdHVyZXMuYlNlcnZlclNpZGUgKQoJCQkJewoJCQkJCXNaZXJvID0gb0xhbmcuc0xvYWRpbmdSZWNvcmRzOwoJCQkJfQoJCQkJZWxzZSBpZiAoIG9MYW5nLnNFbXB0eVRhYmxlICYmIG9TZXR0aW5ncy5mblJlY29yZHNUb3RhbCgpID09PSAwICkKCQkJCXsKCQkJCQlzWmVybyA9IG9MYW5nLnNFbXB0eVRhYmxlOwoJCQkJfQoJCQoJCQkJdmFyIG5UZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICd0ZCcgKTsKCQkJCW5UZC5zZXRBdHRyaWJ1dGUoICd2YWxpZ24nLCAidG9wIiApOwoJCQkJblRkLmNvbFNwYW4gPSBfZm5WaXNibGVDb2x1bW5zKCBvU2V0dGluZ3MgKTsKCQkJCW5UZC5jbGFzc05hbWUgPSBvU2V0dGluZ3Mub0NsYXNzZXMuc1Jvd0VtcHR5OwoJCQkJblRkLmlubmVySFRNTCA9IF9mbkluZm9NYWNyb3MoIG9TZXR0aW5ncywgc1plcm8gKTsKCQkJCQoJCQkJYW5Sb3dzWyBpUm93Q291bnQgXS5hcHBlbmRDaGlsZCggblRkICk7CgkJCX0KCQkJCgkJCS8qIEhlYWRlciBhbmQgZm9vdGVyIGNhbGxiYWNrcyAqLwoJCQlfZm5DYWxsYmFja0ZpcmUoIG9TZXR0aW5ncywgJ2FvSGVhZGVyQ2FsbGJhY2snLCAnaGVhZGVyJywgWyAkKG9TZXR0aW5ncy5uVEhlYWQpLmNoaWxkcmVuKCd0cicpWzBdLCAKCQkJCV9mbkdldERhdGFNYXN0ZXIoIG9TZXR0aW5ncyApLCBvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQsIG9TZXR0aW5ncy5mbkRpc3BsYXlFbmQoKSwgb1NldHRpbmdzLmFpRGlzcGxheSBdICk7CgkJCQoJCQlfZm5DYWxsYmFja0ZpcmUoIG9TZXR0aW5ncywgJ2FvRm9vdGVyQ2FsbGJhY2snLCAnZm9vdGVyJywgWyAkKG9TZXR0aW5ncy5uVEZvb3QpLmNoaWxkcmVuKCd0cicpWzBdLCAKCQkJCV9mbkdldERhdGFNYXN0ZXIoIG9TZXR0aW5ncyApLCBvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQsIG9TZXR0aW5ncy5mbkRpc3BsYXlFbmQoKSwgb1NldHRpbmdzLmFpRGlzcGxheSBdICk7CgkJCQoJCQkvKiAKCQkJICogTmVlZCB0byByZW1vdmUgYW55IG9sZCByb3cgZnJvbSB0aGUgZGlzcGxheSAtIG5vdGUgd2UgY2FuJ3QganVzdCBlbXB0eSB0aGUgdGJvZHkgdXNpbmcKCQkJICogJCgpLmh0bWwoJycpIHNpbmNlIHRoaXMgd2lsbCB1bmJpbmQgdGhlIGpRdWVyeSBldmVudCBoYW5kbGVycyAoZXZlbiBhbHRob3VnaCB0aGUgbm9kZSAKCQkJICogc3RpbGwgZXhpc3RzISkgLSBlcXVhbGx5IHdlIGNhbid0IHVzZSBpbm5lckhUTUwsIHNpbmNlIElFIHRocm93cyBhbiBleGNlcHRpb24uCgkJCSAqLwoJCQl2YXIKCQkJCW5BZGRGcmFnID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpLAoJCQkJblJlbW92ZUZyYWcgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCksCgkJCQluQm9keVBhciwgblRyczsKCQkJCgkJCWlmICggb1NldHRpbmdzLm5UQm9keSApCgkJCXsKCQkJCW5Cb2R5UGFyID0gb1NldHRpbmdzLm5UQm9keS5wYXJlbnROb2RlOwoJCQkJblJlbW92ZUZyYWcuYXBwZW5kQ2hpbGQoIG9TZXR0aW5ncy5uVEJvZHkgKTsKCQkJCQoJCQkJLyogV2hlbiBkb2luZyBpbmZpbml0ZSBzY3JvbGxpbmcsIG9ubHkgcmVtb3ZlIGNoaWxkIHJvd3Mgd2hlbiBzb3J0aW5nLCBmaWx0ZXJpbmcgb3Igc3RhcnQKCQkJCSAqIHVwLiBXaGVuIG5vdCBpbmZpbml0ZSBzY3JvbGwsIGFsd2F5cyBkbyBpdC4KCQkJCSAqLwoJCQkJaWYgKCAhb1NldHRpbmdzLm9TY3JvbGwuYkluZmluaXRlIHx8ICFvU2V0dGluZ3MuX2JJbml0Q29tcGxldGUgfHwKCQkJCSAJb1NldHRpbmdzLmJTb3J0ZWQgfHwgb1NldHRpbmdzLmJGaWx0ZXJlZCApCgkJCQl7CgkJCQkJd2hpbGUoIChuID0gb1NldHRpbmdzLm5UQm9keS5maXJzdENoaWxkKSApCgkJCQkJewoJCQkJCQlvU2V0dGluZ3MublRCb2R5LnJlbW92ZUNoaWxkKCBuICk7CgkJCQkJfQoJCQkJfQoJCQkJCgkJCQkvKiBQdXQgdGhlIGRyYXcgdGFibGUgaW50byB0aGUgZG9tICovCgkJCQlmb3IgKCBpPTAsIGlMZW49YW5Sb3dzLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJbkFkZEZyYWcuYXBwZW5kQ2hpbGQoIGFuUm93c1tpXSApOwoJCQkJfQoJCQkJCgkJCQlvU2V0dGluZ3MublRCb2R5LmFwcGVuZENoaWxkKCBuQWRkRnJhZyApOwoJCQkJaWYgKCBuQm9keVBhciAhPT0gbnVsbCApCgkJCQl7CgkJCQkJbkJvZHlQYXIuYXBwZW5kQ2hpbGQoIG9TZXR0aW5ncy5uVEJvZHkgKTsKCQkJCX0KCQkJfQoJCQkKCQkJLyogQ2FsbCBhbGwgcmVxdWlyZWQgY2FsbGJhY2sgZnVuY3Rpb25zIGZvciB0aGUgZW5kIG9mIGEgZHJhdyAqLwoJCQlfZm5DYWxsYmFja0ZpcmUoIG9TZXR0aW5ncywgJ2FvRHJhd0NhbGxiYWNrJywgJ2RyYXcnLCBbb1NldHRpbmdzXSApOwoJCQkKCQkJLyogRHJhdyBpcyBjb21wbGV0ZSwgc29ydGluZyBhbmQgZmlsdGVyaW5nIG11c3QgYmUgYXMgd2VsbCAqLwoJCQlvU2V0dGluZ3MuYlNvcnRlZCA9IGZhbHNlOwoJCQlvU2V0dGluZ3MuYkZpbHRlcmVkID0gZmFsc2U7CgkJCW9TZXR0aW5ncy5iRHJhd2luZyA9IGZhbHNlOwoJCQkKCQkJaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTZXJ2ZXJTaWRlICkKCQkJewoJCQkJX2ZuUHJvY2Vzc2luZ0Rpc3BsYXkoIG9TZXR0aW5ncywgZmFsc2UgKTsKCQkJCWlmICggIW9TZXR0aW5ncy5fYkluaXRDb21wbGV0ZSApCgkJCQl7CgkJCQkJX2ZuSW5pdENvbXBsZXRlKCBvU2V0dGluZ3MgKTsKCQkJCX0KCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBSZWRyYXcgdGhlIHRhYmxlIC0gdGFraW5nIGFjY291bnQgb2YgdGhlIHZhcmlvdXMgZmVhdHVyZXMgd2hpY2ggYXJlIGVuYWJsZWQKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5SZURyYXcoIG9TZXR0aW5ncyApCgkJewoJCQlpZiAoIG9TZXR0aW5ncy5vRmVhdHVyZXMuYlNvcnQgKQoJCQl7CgkJCQkvKiBTb3J0aW5nIHdpbGwgcmVmaWx0ZXIgYW5kIGRyYXcgZm9yIHVzICovCgkJCQlfZm5Tb3J0KCBvU2V0dGluZ3MsIG9TZXR0aW5ncy5vUHJldmlvdXNTZWFyY2ggKTsKCQkJfQoJCQllbHNlIGlmICggb1NldHRpbmdzLm9GZWF0dXJlcy5iRmlsdGVyICkKCQkJewoJCQkJLyogRmlsdGVyaW5nIHdpbGwgcmVkcmF3IGZvciB1cyAqLwoJCQkJX2ZuRmlsdGVyQ29tcGxldGUoIG9TZXR0aW5ncywgb1NldHRpbmdzLm9QcmV2aW91c1NlYXJjaCApOwoJCQl9CgkJCWVsc2UKCQkJewoJCQkJX2ZuQ2FsY3VsYXRlRW5kKCBvU2V0dGluZ3MgKTsKCQkJCV9mbkRyYXcoIG9TZXR0aW5ncyApOwoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEFkZCB0aGUgb3B0aW9ucyB0byB0aGUgcGFnZSBIVE1MIGZvciB0aGUgdGFibGUKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5BZGRPcHRpb25zSHRtbCAoIG9TZXR0aW5ncyApCgkJewoJCQkvKgoJCQkgKiBDcmVhdGUgYSB0ZW1wb3JhcnksIGVtcHR5LCBkaXYgd2hpY2ggd2UgY2FuIGxhdGVyIG9uIHJlcGxhY2Ugd2l0aCB3aGF0IHdlIGhhdmUgZ2VuZXJhdGVkCgkJCSAqIHdlIGRvIGl0IHRoaXMgd2F5IHRvIHJlbmRlcmluZyB0aGUgJ29wdGlvbnMnIGh0bWwgb2ZmbGluZSAtIHNwZWVkIDotKQoJCQkgKi8KCQkJdmFyIG5Ib2xkaW5nID0gJCgnPGRpdj48L2Rpdj4nKVswXTsKCQkJb1NldHRpbmdzLm5UYWJsZS5wYXJlbnROb2RlLmluc2VydEJlZm9yZSggbkhvbGRpbmcsIG9TZXR0aW5ncy5uVGFibGUgKTsKCQkJCgkJCS8qIAoJCQkgKiBBbGwgRGF0YVRhYmxlcyBhcmUgd3JhcHBlZCBpbiBhIGRpdgoJCQkgKi8KCQkJb1NldHRpbmdzLm5UYWJsZVdyYXBwZXIgPSAkKCc8ZGl2IGlkPSInK29TZXR0aW5ncy5zVGFibGVJZCsnX3dyYXBwZXIiIGNsYXNzPSInK29TZXR0aW5ncy5vQ2xhc3Nlcy5zV3JhcHBlcisnIiByb2xlPSJncmlkIj48L2Rpdj4nKVswXTsKCQkJb1NldHRpbmdzLm5UYWJsZVJlaW5zZXJ0QmVmb3JlID0gb1NldHRpbmdzLm5UYWJsZS5uZXh0U2libGluZzsKCQkKCQkJLyogVHJhY2sgd2hlcmUgd2Ugd2FudCB0byBpbnNlcnQgdGhlIG9wdGlvbiAqLwoJCQl2YXIgbkluc2VydE5vZGUgPSBvU2V0dGluZ3MublRhYmxlV3JhcHBlcjsKCQkJCgkJCS8qIExvb3Agb3ZlciB0aGUgdXNlciBzZXQgcG9zaXRpb25pbmcgYW5kIHBsYWNlIHRoZSBlbGVtZW50cyBhcyBuZWVkZWQgKi8KCQkJdmFyIGFEb20gPSBvU2V0dGluZ3Muc0RvbS5zcGxpdCgnJyk7CgkJCXZhciBuVG1wLCBpUHVzaEZlYXR1cmUsIGNPcHRpb24sIG5OZXdOb2RlLCBjTmV4dCwgc0F0dHIsIGo7CgkJCWZvciAoIHZhciBpPTAgOyBpPGFEb20ubGVuZ3RoIDsgaSsrICkKCQkJewoJCQkJaVB1c2hGZWF0dXJlID0gMDsKCQkJCWNPcHRpb24gPSBhRG9tW2ldOwoJCQkJCgkJCQlpZiAoIGNPcHRpb24gPT0gJzwnICkKCQkJCXsKCQkJCQkvKiBOZXcgY29udGFpbmVyIGRpdiAqLwoJCQkJCW5OZXdOb2RlID0gJCgnPGRpdj48L2Rpdj4nKVswXTsKCQkJCQkKCQkJCQkvKiBDaGVjayB0byBzZWUgaWYgd2Ugc2hvdWxkIGFwcGVuZCBhbiBpZCBhbmQvb3IgYSBjbGFzcyBuYW1lIHRvIHRoZSBjb250YWluZXIgKi8KCQkJCQljTmV4dCA9IGFEb21baSsxXTsKCQkJCQlpZiAoIGNOZXh0ID09ICInIiB8fCBjTmV4dCA9PSAnIicgKQoJCQkJCXsKCQkJCQkJc0F0dHIgPSAiIjsKCQkJCQkJaiA9IDI7CgkJCQkJCXdoaWxlICggYURvbVtpK2pdICE9IGNOZXh0ICkKCQkJCQkJewoJCQkJCQkJc0F0dHIgKz0gYURvbVtpK2pdOwoJCQkJCQkJaisrOwoJCQkJCQl9CgkJCQkJCQoJCQkJCQkvKiBSZXBsYWNlIGpRdWVyeSBVSSBjb25zdGFudHMgKi8KCQkJCQkJaWYgKCBzQXR0ciA9PSAiSCIgKQoJCQkJCQl7CgkJCQkJCQlzQXR0ciA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zSlVJSGVhZGVyOwoJCQkJCQl9CgkJCQkJCWVsc2UgaWYgKCBzQXR0ciA9PSAiRiIgKQoJCQkJCQl7CgkJCQkJCQlzQXR0ciA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zSlVJRm9vdGVyOwoJCQkJCQl9CgkJCQkJCQoJCQkJCQkvKiBUaGUgYXR0cmlidXRlIGNhbiBiZSBpbiB0aGUgZm9ybWF0IG9mICIjaWQuY2xhc3MiLCAiI2lkIiBvciAiY2xhc3MiIFRoaXMgbG9naWMKCQkJCQkJICogYnJlYWtzIHRoZSBzdHJpbmcgaW50byBwYXJ0cyBhbmQgYXBwbGllcyB0aGVtIGFzIG5lZWRlZAoJCQkJCQkgKi8KCQkJCQkJaWYgKCBzQXR0ci5pbmRleE9mKCcuJykgIT0gLTEgKQoJCQkJCQl7CgkJCQkJCQl2YXIgYVNwbGl0ID0gc0F0dHIuc3BsaXQoJy4nKTsKCQkJCQkJCW5OZXdOb2RlLmlkID0gYVNwbGl0WzBdLnN1YnN0cigxLCBhU3BsaXRbMF0ubGVuZ3RoLTEpOwoJCQkJCQkJbk5ld05vZGUuY2xhc3NOYW1lID0gYVNwbGl0WzFdOwoJCQkJCQl9CgkJCQkJCWVsc2UgaWYgKCBzQXR0ci5jaGFyQXQoMCkgPT0gIiMiICkKCQkJCQkJewoJCQkJCQkJbk5ld05vZGUuaWQgPSBzQXR0ci5zdWJzdHIoMSwgc0F0dHIubGVuZ3RoLTEpOwoJCQkJCQl9CgkJCQkJCWVsc2UKCQkJCQkJewoJCQkJCQkJbk5ld05vZGUuY2xhc3NOYW1lID0gc0F0dHI7CgkJCQkJCX0KCQkJCQkJCgkJCQkJCWkgKz0gajsgLyogTW92ZSBhbG9uZyB0aGUgcG9zaXRpb24gYXJyYXkgKi8KCQkJCQl9CgkJCQkJCgkJCQkJbkluc2VydE5vZGUuYXBwZW5kQ2hpbGQoIG5OZXdOb2RlICk7CgkJCQkJbkluc2VydE5vZGUgPSBuTmV3Tm9kZTsKCQkJCX0KCQkJCWVsc2UgaWYgKCBjT3B0aW9uID09ICc+JyApCgkJCQl7CgkJCQkJLyogRW5kIGNvbnRhaW5lciBkaXYgKi8KCQkJCQluSW5zZXJ0Tm9kZSA9IG5JbnNlcnROb2RlLnBhcmVudE5vZGU7CgkJCQl9CgkJCQllbHNlIGlmICggY09wdGlvbiA9PSAnbCcgJiYgb1NldHRpbmdzLm9GZWF0dXJlcy5iUGFnaW5hdGUgJiYgb1NldHRpbmdzLm9GZWF0dXJlcy5iTGVuZ3RoQ2hhbmdlICkKCQkJCXsKCQkJCQkvKiBMZW5ndGggKi8KCQkJCQluVG1wID0gX2ZuRmVhdHVyZUh0bWxMZW5ndGgoIG9TZXR0aW5ncyApOwoJCQkJCWlQdXNoRmVhdHVyZSA9IDE7CgkJCQl9CgkJCQllbHNlIGlmICggY09wdGlvbiA9PSAnZicgJiYgb1NldHRpbmdzLm9GZWF0dXJlcy5iRmlsdGVyICkKCQkJCXsKCQkJCQkvKiBGaWx0ZXIgKi8KCQkJCQluVG1wID0gX2ZuRmVhdHVyZUh0bWxGaWx0ZXIoIG9TZXR0aW5ncyApOwoJCQkJCWlQdXNoRmVhdHVyZSA9IDE7CgkJCQl9CgkJCQllbHNlIGlmICggY09wdGlvbiA9PSAncicgJiYgb1NldHRpbmdzLm9GZWF0dXJlcy5iUHJvY2Vzc2luZyApCgkJCQl7CgkJCQkJLyogcFJvY2Vzc2luZyAqLwoJCQkJCW5UbXAgPSBfZm5GZWF0dXJlSHRtbFByb2Nlc3NpbmcoIG9TZXR0aW5ncyApOwoJCQkJCWlQdXNoRmVhdHVyZSA9IDE7CgkJCQl9CgkJCQllbHNlIGlmICggY09wdGlvbiA9PSAndCcgKQoJCQkJewoJCQkJCS8qIFRhYmxlICovCgkJCQkJblRtcCA9IF9mbkZlYXR1cmVIdG1sVGFibGUoIG9TZXR0aW5ncyApOwoJCQkJCWlQdXNoRmVhdHVyZSA9IDE7CgkJCQl9CgkJCQllbHNlIGlmICggY09wdGlvbiA9PSAgJ2knICYmIG9TZXR0aW5ncy5vRmVhdHVyZXMuYkluZm8gKQoJCQkJewoJCQkJCS8qIEluZm8gKi8KCQkJCQluVG1wID0gX2ZuRmVhdHVyZUh0bWxJbmZvKCBvU2V0dGluZ3MgKTsKCQkJCQlpUHVzaEZlYXR1cmUgPSAxOwoJCQkJfQoJCQkJZWxzZSBpZiAoIGNPcHRpb24gPT0gJ3AnICYmIG9TZXR0aW5ncy5vRmVhdHVyZXMuYlBhZ2luYXRlICkKCQkJCXsKCQkJCQkvKiBQYWdpbmF0aW9uICovCgkJCQkJblRtcCA9IF9mbkZlYXR1cmVIdG1sUGFnaW5hdGUoIG9TZXR0aW5ncyApOwoJCQkJCWlQdXNoRmVhdHVyZSA9IDE7CgkJCQl9CgkJCQllbHNlIGlmICggRGF0YVRhYmxlLmV4dC5hb0ZlYXR1cmVzLmxlbmd0aCAhPT0gMCApCgkJCQl7CgkJCQkJLyogUGx1Zy1pbiBmZWF0dXJlcyAqLwoJCQkJCXZhciBhb0ZlYXR1cmVzID0gRGF0YVRhYmxlLmV4dC5hb0ZlYXR1cmVzOwoJCQkJCWZvciAoIHZhciBrPTAsIGtMZW49YW9GZWF0dXJlcy5sZW5ndGggOyBrPGtMZW4gOyBrKysgKQoJCQkJCXsKCQkJCQkJaWYgKCBjT3B0aW9uID09IGFvRmVhdHVyZXNba10uY0ZlYXR1cmUgKQoJCQkJCQl7CgkJCQkJCQluVG1wID0gYW9GZWF0dXJlc1trXS5mbkluaXQoIG9TZXR0aW5ncyApOwoJCQkJCQkJaWYgKCBuVG1wICkKCQkJCQkJCXsKCQkJCQkJCQlpUHVzaEZlYXR1cmUgPSAxOwoJCQkJCQkJfQoJCQkJCQkJYnJlYWs7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCQkKCQkJCS8qIEFkZCB0byB0aGUgMkQgZmVhdHVyZXMgYXJyYXkgKi8KCQkJCWlmICggaVB1c2hGZWF0dXJlID09IDEgJiYgblRtcCAhPT0gbnVsbCApCgkJCQl7CgkJCQkJaWYgKCB0eXBlb2Ygb1NldHRpbmdzLmFhbkZlYXR1cmVzW2NPcHRpb25dICE9PSAnb2JqZWN0JyApCgkJCQkJewoJCQkJCQlvU2V0dGluZ3MuYWFuRmVhdHVyZXNbY09wdGlvbl0gPSBbXTsKCQkJCQl9CgkJCQkJb1NldHRpbmdzLmFhbkZlYXR1cmVzW2NPcHRpb25dLnB1c2goIG5UbXAgKTsKCQkJCQluSW5zZXJ0Tm9kZS5hcHBlbmRDaGlsZCggblRtcCApOwoJCQkJfQoJCQl9CgkJCQoJCQkvKiBCdWlsdCBvdXIgRE9NIHN0cnVjdHVyZSAtIHJlcGxhY2UgdGhlIGhvbGRpbmcgZGl2IHdpdGggd2hhdCB3ZSB3YW50ICovCgkJCW5Ib2xkaW5nLnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKCBvU2V0dGluZ3MublRhYmxlV3JhcHBlciwgbkhvbGRpbmcgKTsKCQl9CgkJCgkJCgkJLyoqCgkJICogVXNlIHRoZSBET00gc291cmNlIHRvIGNyZWF0ZSB1cCBhbiBhcnJheSBvZiBoZWFkZXIgY2VsbHMuIFRoZSBpZGVhIGhlcmUgaXMgdG8KCQkgKiBjcmVhdGUgYSBsYXlvdXQgZ3JpZCAoYXJyYXkpIG9mIHJvd3MgeCBjb2x1bW5zLCB3aGljaCBjb250YWlucyBhIHJlZmVyZW5jZQoJCSAqIHRvIHRoZSBjZWxsIHRoYXQgdGhhdCBwb2ludCBpbiB0aGUgZ3JpZCAocmVnYXJkbGVzcyBvZiBjb2wvcm93c3BhbiksIHN1Y2ggdGhhdAoJCSAqIGFueSBjb2x1bW4gLyByb3cgY291bGQgYmUgcmVtb3ZlZCBhbmQgdGhlIG5ldyBncmlkIGNvbnN0cnVjdGVkCgkJICogIEBwYXJhbSBhcnJheSB7b2JqZWN0fSBhTGF5b3V0IEFycmF5IHRvIHN0b3JlIHRoZSBjYWxjdWxhdGVkIGxheW91dCBpbgoJCSAqICBAcGFyYW0ge25vZGV9IG5UaGVhZCBUaGUgaGVhZGVyL2Zvb3RlciBlbGVtZW50IGZvciB0aGUgdGFibGUKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuRGV0ZWN0SGVhZGVyICggYUxheW91dCwgblRoZWFkICkKCQl7CgkJCXZhciBuVHJzID0gJChuVGhlYWQpLmNoaWxkcmVuKCd0cicpOwoJCQl2YXIgbkNlbGw7CgkJCXZhciBpLCBqLCBrLCBsLCBpTGVuLCBqTGVuLCBpQ29sU2hpZnRlZDsKCQkJdmFyIGZuU2hpZnRDb2wgPSBmdW5jdGlvbiAoIGEsIGksIGogKSB7CgkJCQl3aGlsZSAoIGFbaV1bal0gKSB7CgkJCQkJaisrOwoJCQkJfQoJCQkJcmV0dXJuIGo7CgkJCX07CgkJCgkJCWFMYXlvdXQuc3BsaWNlKCAwLCBhTGF5b3V0Lmxlbmd0aCApOwoJCQkKCQkJLyogV2Uga25vdyBob3cgbWFueSByb3dzIHRoZXJlIGFyZSBpbiB0aGUgbGF5b3V0IC0gc28gcHJlcCBpdCAqLwoJCQlmb3IgKCBpPTAsIGlMZW49blRycy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlhTGF5b3V0LnB1c2goIFtdICk7CgkJCX0KCQkJCgkJCS8qIENhbGN1bGF0ZSBhIGxheW91dCBhcnJheSAqLwoJCQlmb3IgKCBpPTAsIGlMZW49blRycy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQl2YXIgaUNvbHVtbiA9IDA7CgkJCQkKCQkJCS8qIEZvciBldmVyeSBjZWxsIGluIHRoZSByb3cuLi4gKi8KCQkJCWZvciAoIGo9MCwgakxlbj1uVHJzW2ldLmNoaWxkTm9kZXMubGVuZ3RoIDsgajxqTGVuIDsgaisrICkKCQkJCXsKCQkJCQluQ2VsbCA9IG5UcnNbaV0uY2hpbGROb2Rlc1tqXTsKCQkKCQkJCQlpZiAoIG5DZWxsLm5vZGVOYW1lLnRvVXBwZXJDYXNlKCkgPT0gIlREIiB8fAoJCQkJCSAgICAgbkNlbGwubm9kZU5hbWUudG9VcHBlckNhc2UoKSA9PSAiVEgiICkKCQkJCQl7CgkJCQkJCS8qIEdldCB0aGUgY29sIGFuZCByb3dzcGFuIGF0dHJpYnV0ZXMgZnJvbSB0aGUgRE9NIGFuZCBzYW5pdGlzZSB0aGVtICovCgkJCQkJCXZhciBpQ29sc3BhbiA9IG5DZWxsLmdldEF0dHJpYnV0ZSgnY29sc3BhbicpICogMTsKCQkJCQkJdmFyIGlSb3dzcGFuID0gbkNlbGwuZ2V0QXR0cmlidXRlKCdyb3dzcGFuJykgKiAxOwoJCQkJCQlpQ29sc3BhbiA9ICghaUNvbHNwYW4gfHwgaUNvbHNwYW49PT0wIHx8IGlDb2xzcGFuPT09MSkgPyAxIDogaUNvbHNwYW47CgkJCQkJCWlSb3dzcGFuID0gKCFpUm93c3BhbiB8fCBpUm93c3Bhbj09PTAgfHwgaVJvd3NwYW49PT0xKSA/IDEgOiBpUm93c3BhbjsKCQkKCQkJCQkJLyogVGhlcmUgbWlnaHQgYmUgY29sc3BhbiBjZWxscyBhbHJlYWR5IGluIHRoaXMgcm93LCBzbyBzaGlmdCBvdXIgdGFyZ2V0IAoJCQkJCQkgKiBhY2NvcmRpbmdseQoJCQkJCQkgKi8KCQkJCQkJaUNvbFNoaWZ0ZWQgPSBmblNoaWZ0Q29sKCBhTGF5b3V0LCBpLCBpQ29sdW1uICk7CgkJCQkJCQoJCQkJCQkvKiBJZiB0aGVyZSBpcyBjb2wgLyByb3dzcGFuLCBjb3B5IHRoZSBpbmZvcm1hdGlvbiBpbnRvIHRoZSBsYXlvdXQgZ3JpZCAqLwoJCQkJCQlmb3IgKCBsPTAgOyBsPGlDb2xzcGFuIDsgbCsrICkKCQkJCQkJewoJCQkJCQkJZm9yICggaz0wIDsgazxpUm93c3BhbiA7IGsrKyApCgkJCQkJCQl7CgkJCQkJCQkJYUxheW91dFtpK2tdW2lDb2xTaGlmdGVkK2xdID0gewoJCQkJCQkJCQkiY2VsbCI6IG5DZWxsLAoJCQkJCQkJCQkidW5pcXVlIjogaUNvbHNwYW4gPT0gMSA/IHRydWUgOiBmYWxzZQoJCQkJCQkJCX07CgkJCQkJCQkJYUxheW91dFtpK2tdLm5UciA9IG5UcnNbaV07CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgkJCgkJCgkJLyoqCgkJICogR2V0IGFuIGFycmF5IG9mIHVuaXF1ZSB0aCBlbGVtZW50cywgb25lIGZvciBlYWNoIGNvbHVtbgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7bm9kZX0gbkhlYWRlciBhdXRvbWF0aWNhbGx5IGRldGVjdCB0aGUgbGF5b3V0IGZyb20gdGhpcyBub2RlIC0gb3B0aW9uYWwKCQkgKiAgQHBhcmFtIHthcnJheX0gYUxheW91dCB0aGVhZC90Zm9vdCBsYXlvdXQgZnJvbSBfZm5EZXRlY3RIZWFkZXIgLSBvcHRpb25hbAoJCSAqICBAcmV0dXJucyBhcnJheSB7bm9kZX0gYVJldHVybiBsaXN0IG9mIHVuaXF1ZSB0aHMKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuR2V0VW5pcXVlVGhzICggb1NldHRpbmdzLCBuSGVhZGVyLCBhTGF5b3V0ICkKCQl7CgkJCXZhciBhUmV0dXJuID0gW107CgkJCWlmICggIWFMYXlvdXQgKQoJCQl7CgkJCQlhTGF5b3V0ID0gb1NldHRpbmdzLmFvSGVhZGVyOwoJCQkJaWYgKCBuSGVhZGVyICkKCQkJCXsKCQkJCQlhTGF5b3V0ID0gW107CgkJCQkJX2ZuRGV0ZWN0SGVhZGVyKCBhTGF5b3V0LCBuSGVhZGVyICk7CgkJCQl9CgkJCX0KCQkKCQkJZm9yICggdmFyIGk9MCwgaUxlbj1hTGF5b3V0Lmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWZvciAoIHZhciBqPTAsIGpMZW49YUxheW91dFtpXS5sZW5ndGggOyBqPGpMZW4gOyBqKysgKQoJCQkJewoJCQkJCWlmICggYUxheW91dFtpXVtqXS51bmlxdWUgJiYgCgkJCQkJCSAoIWFSZXR1cm5bal0gfHwgIW9TZXR0aW5ncy5iU29ydENlbGxzVG9wKSApCgkJCQkJewoJCQkJCQlhUmV0dXJuW2pdID0gYUxheW91dFtpXVtqXS5jZWxsOwoJCQkJCX0KCQkJCX0KCQkJfQoJCQkKCQkJcmV0dXJuIGFSZXR1cm47CgkJfQoJCQoJCQoJCQoJCS8qKgoJCSAqIFVwZGF0ZSB0aGUgdGFibGUgdXNpbmcgYW4gQWpheCBjYWxsCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHJldHVybnMge2Jvb2xlYW59IEJsb2NrIHRoZSB0YWJsZSBkcmF3aW5nIG9yIG5vdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5BamF4VXBkYXRlKCBvU2V0dGluZ3MgKQoJCXsKCQkJaWYgKCBvU2V0dGluZ3MuYkFqYXhEYXRhR2V0ICkKCQkJewoJCQkJb1NldHRpbmdzLmlEcmF3Kys7CgkJCQlfZm5Qcm9jZXNzaW5nRGlzcGxheSggb1NldHRpbmdzLCB0cnVlICk7CgkJCQl2YXIgaUNvbHVtbnMgPSBvU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aDsKCQkJCXZhciBhb0RhdGEgPSBfZm5BamF4UGFyYW1ldGVycyggb1NldHRpbmdzICk7CgkJCQlfZm5TZXJ2ZXJQYXJhbXMoIG9TZXR0aW5ncywgYW9EYXRhICk7CgkJCQkKCQkJCW9TZXR0aW5ncy5mblNlcnZlckRhdGEuY2FsbCggb1NldHRpbmdzLm9JbnN0YW5jZSwgb1NldHRpbmdzLnNBamF4U291cmNlLCBhb0RhdGEsCgkJCQkJZnVuY3Rpb24oanNvbikgewoJCQkJCQlfZm5BamF4VXBkYXRlRHJhdyggb1NldHRpbmdzLCBqc29uICk7CgkJCQkJfSwgb1NldHRpbmdzICk7CgkJCQlyZXR1cm4gZmFsc2U7CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQlyZXR1cm4gdHJ1ZTsKCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBCdWlsZCB1cCB0aGUgcGFyYW1ldGVycyBpbiBhbiBvYmplY3QgbmVlZGVkIGZvciBhIHNlcnZlci1zaWRlIHByb2Nlc3NpbmcgcmVxdWVzdAoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEByZXR1cm5zIHtib29sfSBibG9jayB0aGUgdGFibGUgZHJhd2luZyBvciBub3QKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuQWpheFBhcmFtZXRlcnMoIG9TZXR0aW5ncyApCgkJewoJCQl2YXIgaUNvbHVtbnMgPSBvU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aDsKCQkJdmFyIGFvRGF0YSA9IFtdLCBtRGF0YVByb3AsIGFhU29ydCwgYURhdGFTb3J0OwoJCQl2YXIgaSwgajsKCQkJCgkJCWFvRGF0YS5wdXNoKCB7ICJuYW1lIjogInNFY2hvIiwgICAgICAgICAgInZhbHVlIjogb1NldHRpbmdzLmlEcmF3IH0gKTsKCQkJYW9EYXRhLnB1c2goIHsgIm5hbWUiOiAiaUNvbHVtbnMiLCAgICAgICAidmFsdWUiOiBpQ29sdW1ucyB9ICk7CgkJCWFvRGF0YS5wdXNoKCB7ICJuYW1lIjogInNDb2x1bW5zIiwgICAgICAgInZhbHVlIjogX2ZuQ29sdW1uT3JkZXJpbmcob1NldHRpbmdzKSB9ICk7CgkJCWFvRGF0YS5wdXNoKCB7ICJuYW1lIjogImlEaXNwbGF5U3RhcnQiLCAgInZhbHVlIjogb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0IH0gKTsKCQkJYW9EYXRhLnB1c2goIHsgIm5hbWUiOiAiaURpc3BsYXlMZW5ndGgiLCAidmFsdWUiOiBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJQYWdpbmF0ZSAhPT0gZmFsc2UgPwoJCQkJb1NldHRpbmdzLl9pRGlzcGxheUxlbmd0aCA6IC0xIH0gKTsKCQkJCQoJCQlmb3IgKCBpPTAgOyBpPGlDb2x1bW5zIDsgaSsrICkKCQkJewoJCQkgIG1EYXRhUHJvcCA9IG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0ubURhdGFQcm9wOwoJCQkJYW9EYXRhLnB1c2goIHsgIm5hbWUiOiAibURhdGFQcm9wXyIraSwgInZhbHVlIjogdHlwZW9mKG1EYXRhUHJvcCk9PT0iZnVuY3Rpb24iID8gJ2Z1bmN0aW9uJyA6IG1EYXRhUHJvcCB9ICk7CgkJCX0KCQkJCgkJCS8qIEZpbHRlcmluZyAqLwoJCQlpZiAoIG9TZXR0aW5ncy5vRmVhdHVyZXMuYkZpbHRlciAhPT0gZmFsc2UgKQoJCQl7CgkJCQlhb0RhdGEucHVzaCggeyAibmFtZSI6ICJzU2VhcmNoIiwgInZhbHVlIjogb1NldHRpbmdzLm9QcmV2aW91c1NlYXJjaC5zU2VhcmNoIH0gKTsKCQkJCWFvRGF0YS5wdXNoKCB7ICJuYW1lIjogImJSZWdleCIsICAidmFsdWUiOiBvU2V0dGluZ3Mub1ByZXZpb3VzU2VhcmNoLmJSZWdleCB9ICk7CgkJCQlmb3IgKCBpPTAgOyBpPGlDb2x1bW5zIDsgaSsrICkKCQkJCXsKCQkJCQlhb0RhdGEucHVzaCggeyAibmFtZSI6ICJzU2VhcmNoXyIraSwgICAgICJ2YWx1ZSI6IG9TZXR0aW5ncy5hb1ByZVNlYXJjaENvbHNbaV0uc1NlYXJjaCB9ICk7CgkJCQkJYW9EYXRhLnB1c2goIHsgIm5hbWUiOiAiYlJlZ2V4XyIraSwgICAgICAidmFsdWUiOiBvU2V0dGluZ3MuYW9QcmVTZWFyY2hDb2xzW2ldLmJSZWdleCB9ICk7CgkJCQkJYW9EYXRhLnB1c2goIHsgIm5hbWUiOiAiYlNlYXJjaGFibGVfIitpLCAidmFsdWUiOiBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLmJTZWFyY2hhYmxlIH0gKTsKCQkJCX0KCQkJfQoJCQkKCQkJLyogU29ydGluZyAqLwoJCQlpZiAoIG9TZXR0aW5ncy5vRmVhdHVyZXMuYlNvcnQgIT09IGZhbHNlICkKCQkJewoJCQkJdmFyIGlDb3VudGVyID0gMDsKCQkKCQkJCWFhU29ydCA9ICggb1NldHRpbmdzLmFhU29ydGluZ0ZpeGVkICE9PSBudWxsICkgPwoJCQkJCW9TZXR0aW5ncy5hYVNvcnRpbmdGaXhlZC5jb25jYXQoIG9TZXR0aW5ncy5hYVNvcnRpbmcgKSA6CgkJCQkJb1NldHRpbmdzLmFhU29ydGluZy5zbGljZSgpOwoJCQkJCgkJCQlmb3IgKCBpPTAgOyBpPGFhU29ydC5sZW5ndGggOyBpKysgKQoJCQkJewoJCQkJCWFEYXRhU29ydCA9IG9TZXR0aW5ncy5hb0NvbHVtbnNbIGFhU29ydFtpXVswXSBdLmFEYXRhU29ydDsKCQkJCQkKCQkJCQlmb3IgKCBqPTAgOyBqPGFEYXRhU29ydC5sZW5ndGggOyBqKysgKQoJCQkJCXsKCQkJCQkJYW9EYXRhLnB1c2goIHsgIm5hbWUiOiAiaVNvcnRDb2xfIitpQ291bnRlciwgICJ2YWx1ZSI6IGFEYXRhU29ydFtqXSB9ICk7CgkJCQkJCWFvRGF0YS5wdXNoKCB7ICJuYW1lIjogInNTb3J0RGlyXyIraUNvdW50ZXIsICAidmFsdWUiOiBhYVNvcnRbaV1bMV0gfSApOwoJCQkJCQlpQ291bnRlcisrOwoJCQkJCX0KCQkJCX0KCQkJCWFvRGF0YS5wdXNoKCB7ICJuYW1lIjogImlTb3J0aW5nQ29scyIsICAgInZhbHVlIjogaUNvdW50ZXIgfSApOwoJCQkJCgkJCQlmb3IgKCBpPTAgOyBpPGlDb2x1bW5zIDsgaSsrICkKCQkJCXsKCQkJCQlhb0RhdGEucHVzaCggeyAibmFtZSI6ICJiU29ydGFibGVfIitpLCAgInZhbHVlIjogb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5iU29ydGFibGUgfSApOwoJCQkJfQoJCQl9CgkJCQoJCQlyZXR1cm4gYW9EYXRhOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBBZGQgQWpheCBwYXJhbWV0ZXJzIGZyb20gcGx1Z2lucwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSBhcnJheSB7b2JqZWN0c30gYW9EYXRhIG5hbWUvdmFsdWUgcGFpcnMgdG8gc2VuZCB0byB0aGUgc2VydmVyCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblNlcnZlclBhcmFtcyggb1NldHRpbmdzLCBhb0RhdGEgKQoJCXsKCQkJX2ZuQ2FsbGJhY2tGaXJlKCBvU2V0dGluZ3MsICdhb1NlcnZlclBhcmFtcycsICdzZXJ2ZXJQYXJhbXMnLCBbYW9EYXRhXSApOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBEYXRhIHRoZSBkYXRhIGZyb20gdGhlIHNlcnZlciAobnVraW5nIHRoZSBvbGQpIGFuZCByZWRyYXcgdGhlIHRhYmxlCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtvYmplY3R9IGpzb24ganNvbiBkYXRhIHJldHVybiBmcm9tIHRoZSBzZXJ2ZXIuCgkJICogIEBwYXJhbSB7c3RyaW5nfSBqc29uLnNFY2hvIFRyYWNraW5nIGZsYWcgZm9yIERhdGFUYWJsZXMgdG8gbWF0Y2ggcmVxdWVzdHMKCQkgKiAgQHBhcmFtIHtpbnR9IGpzb24uaVRvdGFsUmVjb3JkcyBOdW1iZXIgb2YgcmVjb3JkcyBpbiB0aGUgZGF0YSBzZXQsIG5vdCBhY2NvdW50aW5nIGZvciBmaWx0ZXJpbmcKCQkgKiAgQHBhcmFtIHtpbnR9IGpzb24uaVRvdGFsRGlzcGxheVJlY29yZHMgTnVtYmVyIG9mIHJlY29yZHMgaW4gdGhlIGRhdGEgc2V0LCBhY2NvdW50aW5nIGZvciBmaWx0ZXJpbmcKCQkgKiAgQHBhcmFtIHthcnJheX0ganNvbi5hYURhdGEgVGhlIGRhdGEgdG8gZGlzcGxheSBvbiB0aGlzIHBhZ2UKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IFtqc29uLnNDb2x1bW5zXSBDb2x1bW4gb3JkZXJpbmcgKHNOYW1lLCBjb21tYSBzZXBhcmF0ZWQpCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkFqYXhVcGRhdGVEcmF3ICggb1NldHRpbmdzLCBqc29uICkKCQl7CgkJCWlmICgganNvbi5zRWNobyAhPT0gdW5kZWZpbmVkICkKCQkJewoJCQkJLyogUHJvdGVjdCBhZ2FpbnN0IG9sZCByZXR1cm5zIG92ZXItd3JpdGluZyBhIG5ldyBvbmUuIFBvc3NpYmxlIHdoZW4geW91IGdldAoJCQkJICogdmVyeSBmYXN0IGludGVyYWN0aW9uLCBhbmQgbGF0ZXIgcXVlaXJlcyBhcmUgY29tcGxldGVkIG11Y2ggZmFzdGVyCgkJCQkgKi8KCQkJCWlmICgganNvbi5zRWNobyoxIDwgb1NldHRpbmdzLmlEcmF3ICkKCQkJCXsKCQkJCQlyZXR1cm47CgkJCQl9CgkJCQllbHNlCgkJCQl7CgkJCQkJb1NldHRpbmdzLmlEcmF3ID0ganNvbi5zRWNobyAqIDE7CgkJCQl9CgkJCX0KCQkJCgkJCWlmICggIW9TZXR0aW5ncy5vU2Nyb2xsLmJJbmZpbml0ZSB8fAoJCQkJICAgKG9TZXR0aW5ncy5vU2Nyb2xsLmJJbmZpbml0ZSAmJiAob1NldHRpbmdzLmJTb3J0ZWQgfHwgb1NldHRpbmdzLmJGaWx0ZXJlZCkpICkKCQkJewoJCQkJX2ZuQ2xlYXJUYWJsZSggb1NldHRpbmdzICk7CgkJCX0KCQkJb1NldHRpbmdzLl9pUmVjb3Jkc1RvdGFsID0gcGFyc2VJbnQoanNvbi5pVG90YWxSZWNvcmRzLCAxMCk7CgkJCW9TZXR0aW5ncy5faVJlY29yZHNEaXNwbGF5ID0gcGFyc2VJbnQoanNvbi5pVG90YWxEaXNwbGF5UmVjb3JkcywgMTApOwoJCQkKCQkJLyogRGV0ZXJtaW5lIGlmIHJlb3JkZXJpbmcgaXMgcmVxdWlyZWQgKi8KCQkJdmFyIHNPcmRlcmluZyA9IF9mbkNvbHVtbk9yZGVyaW5nKG9TZXR0aW5ncyk7CgkJCXZhciBiUmVPcmRlciA9IChqc29uLnNDb2x1bW5zICE9PSB1bmRlZmluZWQgJiYgc09yZGVyaW5nICE9PSAiIiAmJiBqc29uLnNDb2x1bW5zICE9IHNPcmRlcmluZyApOwoJCQl2YXIgYWlJbmRleDsKCQkJaWYgKCBiUmVPcmRlciApCgkJCXsKCQkJCWFpSW5kZXggPSBfZm5SZU9yZGVySW5kZXgoIG9TZXR0aW5ncywganNvbi5zQ29sdW1ucyApOwoJCQl9CgkJCQoJCQl2YXIgYURhdGEgPSBfZm5HZXRPYmplY3REYXRhRm4oIG9TZXR0aW5ncy5zQWpheERhdGFQcm9wICkoIGpzb24gKTsKCQkJZm9yICggdmFyIGk9MCwgaUxlbj1hRGF0YS5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlpZiAoIGJSZU9yZGVyICkKCQkJCXsKCQkJCQkvKiBJZiB3ZSBuZWVkIHRvIHJlLW9yZGVyLCB0aGVuIGNyZWF0ZSBhIG5ldyBhcnJheSB3aXRoIHRoZSBjb3JyZWN0IG9yZGVyIGFuZCBhZGQgaXQgKi8KCQkJCQl2YXIgYURhdGFTb3J0ZWQgPSBbXTsKCQkJCQlmb3IgKCB2YXIgaj0wLCBqTGVuPW9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgajxqTGVuIDsgaisrICkKCQkJCQl7CgkJCQkJCWFEYXRhU29ydGVkLnB1c2goIGFEYXRhW2ldWyBhaUluZGV4W2pdIF0gKTsKCQkJCQl9CgkJCQkJX2ZuQWRkRGF0YSggb1NldHRpbmdzLCBhRGF0YVNvcnRlZCApOwoJCQkJfQoJCQkJZWxzZQoJCQkJewoJCQkJCS8qIE5vIHJlLW9yZGVyIHJlcXVpcmVkLCBzZXZlciBnb3QgaXQgInJpZ2h0IiAtIGp1c3Qgc3RyYWlnaHQgYWRkICovCgkJCQkJX2ZuQWRkRGF0YSggb1NldHRpbmdzLCBhRGF0YVtpXSApOwoJCQkJfQoJCQl9CgkJCW9TZXR0aW5ncy5haURpc3BsYXkgPSBvU2V0dGluZ3MuYWlEaXNwbGF5TWFzdGVyLnNsaWNlKCk7CgkJCQoJCQlvU2V0dGluZ3MuYkFqYXhEYXRhR2V0ID0gZmFsc2U7CgkJCV9mbkRyYXcoIG9TZXR0aW5ncyApOwoJCQlvU2V0dGluZ3MuYkFqYXhEYXRhR2V0ID0gdHJ1ZTsKCQkJX2ZuUHJvY2Vzc2luZ0Rpc3BsYXkoIG9TZXR0aW5ncywgZmFsc2UgKTsKCQl9CgkJCgkJCgkJCgkJLyoqCgkJICogR2VuZXJhdGUgdGhlIG5vZGUgcmVxdWlyZWQgZm9yIGZpbHRlcmluZyB0ZXh0CgkJICogIEByZXR1cm5zIHtub2RlfSBGaWx0ZXIgY29udHJvbCBlbGVtZW50CgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuRmVhdHVyZUh0bWxGaWx0ZXIgKCBvU2V0dGluZ3MgKQoJCXsKCQkJdmFyIG9QcmV2aW91c1NlYXJjaCA9IG9TZXR0aW5ncy5vUHJldmlvdXNTZWFyY2g7CgkJCQoJCQl2YXIgc1NlYXJjaFN0ciA9IG9TZXR0aW5ncy5vTGFuZ3VhZ2Uuc1NlYXJjaDsKCQkJc1NlYXJjaFN0ciA9IChzU2VhcmNoU3RyLmluZGV4T2YoJ19JTlBVVF8nKSAhPT0gLTEpID8KCQkJICBzU2VhcmNoU3RyLnJlcGxhY2UoJ19JTlBVVF8nLCAnPGlucHV0IHR5cGU9InRleHQiIC8+JykgOgoJCQkgIHNTZWFyY2hTdHI9PT0iIiA/ICc8aW5wdXQgdHlwZT0idGV4dCIgLz4nIDogc1NlYXJjaFN0cisnIDxpbnB1dCB0eXBlPSJ0ZXh0IiAvPic7CgkJCQoJCQl2YXIgbkZpbHRlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdkaXYnICk7CgkJCW5GaWx0ZXIuY2xhc3NOYW1lID0gb1NldHRpbmdzLm9DbGFzc2VzLnNGaWx0ZXI7CgkJCW5GaWx0ZXIuaW5uZXJIVE1MID0gJzxsYWJlbD4nK3NTZWFyY2hTdHIrJzwvbGFiZWw+JzsKCQkJaWYgKCAhb1NldHRpbmdzLmFhbkZlYXR1cmVzLmYgKQoJCQl7CgkJCQluRmlsdGVyLmlkID0gb1NldHRpbmdzLnNUYWJsZUlkKydfZmlsdGVyJzsKCQkJfQoJCQkKCQkJdmFyIGpxRmlsdGVyID0gJCgnaW5wdXRbdHlwZT0idGV4dCJdJywgbkZpbHRlcik7CgkJCgkJCS8vIFN0b3JlIGEgcmVmZXJlbmNlIHRvIHRoZSBpbnB1dCBlbGVtZW50LCBzbyBvdGhlciBpbnB1dCBlbGVtZW50cyBjb3VsZCBiZQoJCQkvLyBhZGRlZCB0byB0aGUgZmlsdGVyIHdyYXBwZXIgaWYgbmVlZGVkIChzdWJtaXQgYnV0dG9uIGZvciBleGFtcGxlKQoJCQluRmlsdGVyLl9EVF9JbnB1dCA9IGpxRmlsdGVyWzBdOwoJCQoJCQlqcUZpbHRlci52YWwoIG9QcmV2aW91c1NlYXJjaC5zU2VhcmNoLnJlcGxhY2UoJyInLCcmcXVvdDsnKSApOwoJCQlqcUZpbHRlci5iaW5kKCAna2V5dXAuRFQnLCBmdW5jdGlvbihlKSB7CgkJCQkvKiBVcGRhdGUgYWxsIG90aGVyIGZpbHRlciBpbnB1dCBlbGVtZW50cyBmb3IgdGhlIG5ldyBkaXNwbGF5ICovCgkJCQl2YXIgbiA9IG9TZXR0aW5ncy5hYW5GZWF0dXJlcy5mOwoJCQkJdmFyIHZhbCA9IHRoaXMudmFsdWU9PT0iIiA/ICIiIDogdGhpcy52YWx1ZTsgLy8gbWVudGFsIElFOCBmaXggOi0oCgkJCgkJCQlmb3IgKCB2YXIgaT0wLCBpTGVuPW4ubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQlpZiAoIG5baV0gIT0gJCh0aGlzKS5wYXJlbnRzKCdkaXYuZGF0YVRhYmxlc19maWx0ZXInKVswXSApCgkJCQkJewoJCQkJCQkkKG5baV0uX0RUX0lucHV0KS52YWwoIHZhbCApOwoJCQkJCX0KCQkJCX0KCQkJCQoJCQkJLyogTm93IGRvIHRoZSBmaWx0ZXIgKi8KCQkJCWlmICggdmFsICE9IG9QcmV2aW91c1NlYXJjaC5zU2VhcmNoICkKCQkJCXsKCQkJCQlfZm5GaWx0ZXJDb21wbGV0ZSggb1NldHRpbmdzLCB7IAoJCQkJCQkic1NlYXJjaCI6IHZhbCwgCgkJCQkJCSJiUmVnZXgiOiBvUHJldmlvdXNTZWFyY2guYlJlZ2V4LAoJCQkJCQkiYlNtYXJ0Ijogb1ByZXZpb3VzU2VhcmNoLmJTbWFydCAsCgkJCQkJCSJiQ2FzZUluc2Vuc2l0aXZlIjogb1ByZXZpb3VzU2VhcmNoLmJDYXNlSW5zZW5zaXRpdmUgCgkJCQkJfSApOwoJCQkJfQoJCQl9ICk7CgkJCgkJCWpxRmlsdGVyCgkJCQkuYXR0cignYXJpYS1jb250cm9scycsIG9TZXR0aW5ncy5zVGFibGVJZCkKCQkJCS5iaW5kKCAna2V5cHJlc3MuRFQnLCBmdW5jdGlvbihlKSB7CgkJCQkJLyogUHJldmVudCBmb3JtIHN1Ym1pc3Npb24gKi8KCQkJCQlpZiAoIGUua2V5Q29kZSA9PSAxMyApCgkJCQkJewoJCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQkJfQoJCQkJfQoJCQkpOwoJCQkKCQkJcmV0dXJuIG5GaWx0ZXI7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEZpbHRlciB0aGUgdGFibGUgdXNpbmcgYm90aCB0aGUgZ2xvYmFsIGZpbHRlciBhbmQgY29sdW1uIGJhc2VkIGZpbHRlcmluZwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2VhcmNoIHNlYXJjaCBpbmZvcm1hdGlvbgoJCSAqICBAcGFyYW0ge2ludH0gW2lGb3JjZV0gZm9yY2UgYSByZXNlYXJjaCBvZiB0aGUgbWFzdGVyIGFycmF5ICgxKSBvciBub3QgKHVuZGVmaW5lZCBvciAwKQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5GaWx0ZXJDb21wbGV0ZSAoIG9TZXR0aW5ncywgb0lucHV0LCBpRm9yY2UgKQoJCXsKCQkJdmFyIG9QcmV2U2VhcmNoID0gb1NldHRpbmdzLm9QcmV2aW91c1NlYXJjaDsKCQkJdmFyIGFvUHJldlNlYXJjaCA9IG9TZXR0aW5ncy5hb1ByZVNlYXJjaENvbHM7CgkJCXZhciBmblNhdmVGaWx0ZXIgPSBmdW5jdGlvbiAoIG9GaWx0ZXIgKSB7CgkJCQkvKiBTYXZlIHRoZSBmaWx0ZXJpbmcgdmFsdWVzICovCgkJCQlvUHJldlNlYXJjaC5zU2VhcmNoID0gb0ZpbHRlci5zU2VhcmNoOwoJCQkJb1ByZXZTZWFyY2guYlJlZ2V4ID0gb0ZpbHRlci5iUmVnZXg7CgkJCQlvUHJldlNlYXJjaC5iU21hcnQgPSBvRmlsdGVyLmJTbWFydDsKCQkJCW9QcmV2U2VhcmNoLmJDYXNlSW5zZW5zaXRpdmUgPSBvRmlsdGVyLmJDYXNlSW5zZW5zaXRpdmU7CgkJCX07CgkJCgkJCS8qIEluIHNlcnZlci1zaWRlIHByb2Nlc3NpbmcgYWxsIGZpbHRlcmluZyBpcyBkb25lIGJ5IHRoZSBzZXJ2ZXIsIHNvIG5vIHBvaW50IGhhbmdpbmcgYXJvdW5kIGhlcmUgKi8KCQkJaWYgKCAhb1NldHRpbmdzLm9GZWF0dXJlcy5iU2VydmVyU2lkZSApCgkJCXsKCQkJCS8qIEdsb2JhbCBmaWx0ZXIgKi8KCQkJCV9mbkZpbHRlciggb1NldHRpbmdzLCBvSW5wdXQuc1NlYXJjaCwgaUZvcmNlLCBvSW5wdXQuYlJlZ2V4LCBvSW5wdXQuYlNtYXJ0LCBvSW5wdXQuYkNhc2VJbnNlbnNpdGl2ZSApOwoJCQkJZm5TYXZlRmlsdGVyKCBvSW5wdXQgKTsKCQkKCQkJCS8qIE5vdyBkbyB0aGUgaW5kaXZpZHVhbCBjb2x1bW4gZmlsdGVyICovCgkJCQlmb3IgKCB2YXIgaT0wIDsgaTxvU2V0dGluZ3MuYW9QcmVTZWFyY2hDb2xzLmxlbmd0aCA7IGkrKyApCgkJCQl7CgkJCQkJX2ZuRmlsdGVyQ29sdW1uKCBvU2V0dGluZ3MsIGFvUHJldlNlYXJjaFtpXS5zU2VhcmNoLCBpLCBhb1ByZXZTZWFyY2hbaV0uYlJlZ2V4LCAKCQkJCQkJYW9QcmV2U2VhcmNoW2ldLmJTbWFydCwgYW9QcmV2U2VhcmNoW2ldLmJDYXNlSW5zZW5zaXRpdmUgKTsKCQkJCX0KCQkJCQoJCQkJLyogQ3VzdG9tIGZpbHRlcmluZyAqLwoJCQkJX2ZuRmlsdGVyQ3VzdG9tKCBvU2V0dGluZ3MgKTsKCQkJfQoJCQllbHNlCgkJCXsKCQkJCWZuU2F2ZUZpbHRlciggb0lucHV0ICk7CgkJCX0KCQkJCgkJCS8qIFRlbGwgdGhlIGRyYXcgZnVuY3Rpb24gd2UgaGF2ZSBiZWVuIGZpbHRlcmluZyAqLwoJCQlvU2V0dGluZ3MuYkZpbHRlcmVkID0gdHJ1ZTsKCQkJJChvU2V0dGluZ3Mub0luc3RhbmNlKS50cmlnZ2VyKCdmaWx0ZXInLCBvU2V0dGluZ3MpOwoJCQkKCQkJLyogUmVkcmF3IHRoZSB0YWJsZSAqLwoJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSAwOwoJCQlfZm5DYWxjdWxhdGVFbmQoIG9TZXR0aW5ncyApOwoJCQlfZm5EcmF3KCBvU2V0dGluZ3MgKTsKCQkJCgkJCS8qIFJlYnVpbGQgc2VhcmNoIGFycmF5ICdvZmZsaW5lJyAqLwoJCQlfZm5CdWlsZFNlYXJjaEFycmF5KCBvU2V0dGluZ3MsIDAgKTsKCQl9CgkJCgkJCgkJLyoqCgkJICogQXBwbHkgY3VzdG9tIGZpbHRlcmluZyBmdW5jdGlvbnMKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5GaWx0ZXJDdXN0b20oIG9TZXR0aW5ncyApCgkJewoJCQl2YXIgYWZuRmlsdGVycyA9IERhdGFUYWJsZS5leHQuYWZuRmlsdGVyaW5nOwoJCQlmb3IgKCB2YXIgaT0wLCBpTGVuPWFmbkZpbHRlcnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJdmFyIGlDb3JyZWN0b3IgPSAwOwoJCQkJZm9yICggdmFyIGo9MCwgakxlbj1vU2V0dGluZ3MuYWlEaXNwbGF5Lmxlbmd0aCA7IGo8akxlbiA7IGorKyApCgkJCQl7CgkJCQkJdmFyIGlEaXNJbmRleCA9IG9TZXR0aW5ncy5haURpc3BsYXlbai1pQ29ycmVjdG9yXTsKCQkJCQkKCQkJCQkvKiBDaGVjayBpZiB3ZSBzaG91bGQgdXNlIHRoaXMgcm93IGJhc2VkIG9uIHRoZSBmaWx0ZXJpbmcgZnVuY3Rpb24gKi8KCQkJCQlpZiAoICFhZm5GaWx0ZXJzW2ldKCBvU2V0dGluZ3MsIF9mbkdldFJvd0RhdGEoIG9TZXR0aW5ncywgaURpc0luZGV4LCAnZmlsdGVyJyApLCBpRGlzSW5kZXggKSApCgkJCQkJewoJCQkJCQlvU2V0dGluZ3MuYWlEaXNwbGF5LnNwbGljZSggai1pQ29ycmVjdG9yLCAxICk7CgkJCQkJCWlDb3JyZWN0b3IrKzsKCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgkJCgkJCgkJLyoqCgkJICogRmlsdGVyIHRoZSB0YWJsZSBvbiBhIHBlci1jb2x1bW4gYmFzaXMKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge3N0cmluZ30gc0lucHV0IHN0cmluZyB0byBmaWx0ZXIgb24KCQkgKiAgQHBhcmFtIHtpbnR9IGlDb2x1bW4gY29sdW1uIHRvIGZpbHRlcgoJCSAqICBAcGFyYW0ge2Jvb2x9IGJSZWdleCB0cmVhdCBzZWFyY2ggc3RyaW5nIGFzIGEgcmVndWxhciBleHByZXNzaW9uIG9yIG5vdAoJCSAqICBAcGFyYW0ge2Jvb2x9IGJTbWFydCB1c2Ugc21hcnQgZmlsdGVyaW5nIG9yIG5vdAoJCSAqICBAcGFyYW0ge2Jvb2x9IGJDYXNlSW5zZW5zaXRpdmUgRG8gY2FzZSBpbnNlbnN0aXZlIG1hdGNoaW5nIG9yIG5vdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5GaWx0ZXJDb2x1bW4gKCBvU2V0dGluZ3MsIHNJbnB1dCwgaUNvbHVtbiwgYlJlZ2V4LCBiU21hcnQsIGJDYXNlSW5zZW5zaXRpdmUgKQoJCXsKCQkJaWYgKCBzSW5wdXQgPT09ICIiICkKCQkJewoJCQkJcmV0dXJuOwoJCQl9CgkJCQoJCQl2YXIgaUluZGV4Q29ycmVjdG9yID0gMDsKCQkJdmFyIHJwU2VhcmNoID0gX2ZuRmlsdGVyQ3JlYXRlU2VhcmNoKCBzSW5wdXQsIGJSZWdleCwgYlNtYXJ0LCBiQ2FzZUluc2Vuc2l0aXZlICk7CgkJCQoJCQlmb3IgKCB2YXIgaT1vU2V0dGluZ3MuYWlEaXNwbGF5Lmxlbmd0aC0xIDsgaT49MCA7IGktLSApCgkJCXsKCQkJCXZhciBzRGF0YSA9IF9mbkRhdGFUb1NlYXJjaCggX2ZuR2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgb1NldHRpbmdzLmFpRGlzcGxheVtpXSwgaUNvbHVtbiwgJ2ZpbHRlcicgKSwKCQkJCQlvU2V0dGluZ3MuYW9Db2x1bW5zW2lDb2x1bW5dLnNUeXBlICk7CgkJCQlpZiAoICEgcnBTZWFyY2gudGVzdCggc0RhdGEgKSApCgkJCQl7CgkJCQkJb1NldHRpbmdzLmFpRGlzcGxheS5zcGxpY2UoIGksIDEgKTsKCQkJCQlpSW5kZXhDb3JyZWN0b3IrKzsKCQkJCX0KCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBGaWx0ZXIgdGhlIGRhdGEgdGFibGUgYmFzZWQgb24gdXNlciBpbnB1dCBhbmQgZHJhdyB0aGUgdGFibGUKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge3N0cmluZ30gc0lucHV0IHN0cmluZyB0byBmaWx0ZXIgb24KCQkgKiAgQHBhcmFtIHtpbnR9IGlGb3JjZSBvcHRpb25hbCAtIGZvcmNlIGEgcmVzZWFyY2ggb2YgdGhlIG1hc3RlciBhcnJheSAoMSkgb3Igbm90ICh1bmRlZmluZWQgb3IgMCkKCQkgKiAgQHBhcmFtIHtib29sfSBiUmVnZXggdHJlYXQgYXMgYSByZWd1bGFyIGV4cHJlc3Npb24gb3Igbm90CgkJICogIEBwYXJhbSB7Ym9vbH0gYlNtYXJ0IHBlcmZvcm0gc21hcnQgZmlsdGVyaW5nIG9yIG5vdAoJCSAqICBAcGFyYW0ge2Jvb2x9IGJDYXNlSW5zZW5zaXRpdmUgRG8gY2FzZSBpbnNlbnN0aXZlIG1hdGNoaW5nIG9yIG5vdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5GaWx0ZXIoIG9TZXR0aW5ncywgc0lucHV0LCBpRm9yY2UsIGJSZWdleCwgYlNtYXJ0LCBiQ2FzZUluc2Vuc2l0aXZlICkKCQl7CgkJCXZhciBpOwoJCQl2YXIgcnBTZWFyY2ggPSBfZm5GaWx0ZXJDcmVhdGVTZWFyY2goIHNJbnB1dCwgYlJlZ2V4LCBiU21hcnQsIGJDYXNlSW5zZW5zaXRpdmUgKTsKCQkJdmFyIG9QcmV2U2VhcmNoID0gb1NldHRpbmdzLm9QcmV2aW91c1NlYXJjaDsKCQkJCgkJCS8qIENoZWNrIGlmIHdlIGFyZSBmb3JjaW5nIG9yIG5vdCAtIG9wdGlvbmFsIHBhcmFtZXRlciAqLwoJCQlpZiAoICFpRm9yY2UgKQoJCQl7CgkJCQlpRm9yY2UgPSAwOwoJCQl9CgkJCQoJCQkvKiBOZWVkIHRvIHRha2UgYWNjb3VudCBvZiBjdXN0b20gZmlsdGVyaW5nIGZ1bmN0aW9ucyAtIGFsd2F5cyBmaWx0ZXIgKi8KCQkJaWYgKCBEYXRhVGFibGUuZXh0LmFmbkZpbHRlcmluZy5sZW5ndGggIT09IDAgKQoJCQl7CgkJCQlpRm9yY2UgPSAxOwoJCQl9CgkJCQoJCQkvKgoJCQkgKiBJZiB0aGUgaW5wdXQgaXMgYmxhbmsgLSB3ZSB3YW50IHRoZSBmdWxsIGRhdGEgc2V0CgkJCSAqLwoJCQlpZiAoIHNJbnB1dC5sZW5ndGggPD0gMCApCgkJCXsKCQkJCW9TZXR0aW5ncy5haURpc3BsYXkuc3BsaWNlKCAwLCBvU2V0dGluZ3MuYWlEaXNwbGF5Lmxlbmd0aCk7CgkJCQlvU2V0dGluZ3MuYWlEaXNwbGF5ID0gb1NldHRpbmdzLmFpRGlzcGxheU1hc3Rlci5zbGljZSgpOwoJCQl9CgkJCWVsc2UKCQkJewoJCQkJLyoKCQkJCSAqIFdlIGFyZSBzdGFydGluZyBhIG5ldyBzZWFyY2ggb3IgdGhlIG5ldyBzZWFyY2ggc3RyaW5nIGlzIHNtYWxsZXIgCgkJCQkgKiB0aGVuIHRoZSBvbGQgb25lIChpLmUuIGRlbGV0ZSkuIFNlYXJjaCBmcm9tIHRoZSBtYXN0ZXIgYXJyYXkKCQkJIAkgKi8KCQkJCWlmICggb1NldHRpbmdzLmFpRGlzcGxheS5sZW5ndGggPT0gb1NldHRpbmdzLmFpRGlzcGxheU1hc3Rlci5sZW5ndGggfHwKCQkJCQkgICBvUHJldlNlYXJjaC5zU2VhcmNoLmxlbmd0aCA+IHNJbnB1dC5sZW5ndGggfHwgaUZvcmNlID09IDEgfHwKCQkJCQkgICBzSW5wdXQuaW5kZXhPZihvUHJldlNlYXJjaC5zU2VhcmNoKSAhPT0gMCApCgkJCQl7CgkJCQkJLyogTnVrZSB0aGUgb2xkIGRpc3BsYXkgYXJyYXkgLSB3ZSBhcmUgZ29pbmcgdG8gcmVidWlsZCBpdCAqLwoJCQkJCW9TZXR0aW5ncy5haURpc3BsYXkuc3BsaWNlKCAwLCBvU2V0dGluZ3MuYWlEaXNwbGF5Lmxlbmd0aCk7CgkJCQkJCgkJCQkJLyogRm9yY2UgYSByZWJ1aWxkIG9mIHRoZSBzZWFyY2ggYXJyYXkgKi8KCQkJCQlfZm5CdWlsZFNlYXJjaEFycmF5KCBvU2V0dGluZ3MsIDEgKTsKCQkJCQkKCQkJCQkvKiBTZWFyY2ggdGhyb3VnaCBhbGwgcmVjb3JkcyB0byBwb3B1bGF0ZSB0aGUgc2VhcmNoIGFycmF5CgkJCQkJICogVGhlIHRoZSBvU2V0dGluZ3MuYWlEaXNwbGF5TWFzdGVyIGFuZCBhc0RhdGFTZWFyY2ggYXJyYXlzIGhhdmUgMSB0byAxIAoJCQkJCSAqIG1hcHBpbmcKCQkJCQkgKi8KCQkJCQlmb3IgKCBpPTAgOyBpPG9TZXR0aW5ncy5haURpc3BsYXlNYXN0ZXIubGVuZ3RoIDsgaSsrICkKCQkJCQl7CgkJCQkJCWlmICggcnBTZWFyY2gudGVzdChvU2V0dGluZ3MuYXNEYXRhU2VhcmNoW2ldKSApCgkJCQkJCXsKCQkJCQkJCW9TZXR0aW5ncy5haURpc3BsYXkucHVzaCggb1NldHRpbmdzLmFpRGlzcGxheU1hc3RlcltpXSApOwoJCQkJCQl9CgkJCQkJfQoJCQkgIH0KCQkJICBlbHNlCgkJCQl7CgkJCSAgCS8qIFVzaW5nIG9sZCBzZWFyY2ggYXJyYXkgLSByZWZpbmUgaXQgLSBkbyBpdCB0aGlzIHdheSBmb3Igc3BlZWQKCQkJICAJICogRG9uJ3QgaGF2ZSB0byBzZWFyY2ggdGhlIHdob2xlIG1hc3RlciBhcnJheSBhZ2FpbgoJCQkJCSAqLwoJCQkgIAl2YXIgaUluZGV4Q29ycmVjdG9yID0gMDsKCQkJICAJCgkJCSAgCS8qIFNlYXJjaCB0aGUgY3VycmVudCByZXN1bHRzICovCgkJCSAgCWZvciAoIGk9MCA7IGk8b1NldHRpbmdzLmFzRGF0YVNlYXJjaC5sZW5ndGggOyBpKysgKQoJCQkJCXsKCQkJICAJCWlmICggISBycFNlYXJjaC50ZXN0KG9TZXR0aW5ncy5hc0RhdGFTZWFyY2hbaV0pICkKCQkJCQkJewoJCQkgIAkJCW9TZXR0aW5ncy5haURpc3BsYXkuc3BsaWNlKCBpLWlJbmRleENvcnJlY3RvciwgMSApOwoJCQkgIAkJCWlJbmRleENvcnJlY3RvcisrOwoJCQkgIAkJfQoJCQkgIAl9CgkJCSAgfQoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIENyZWF0ZSBhbiBhcnJheSB3aGljaCBjYW4gYmUgcXVpY2tseSBzZWFyY2ggdGhyb3VnaAoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7aW50fSBpTWFzdGVyIHVzZSB0aGUgbWFzdGVyIGRhdGEgYXJyYXkgLSBvcHRpb25hbAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5CdWlsZFNlYXJjaEFycmF5ICggb1NldHRpbmdzLCBpTWFzdGVyICkKCQl7CgkJCWlmICggIW9TZXR0aW5ncy5vRmVhdHVyZXMuYlNlcnZlclNpZGUgKQoJCQl7CgkJCQkvKiBDbGVhciBvdXQgdGhlIG9sZCBkYXRhICovCgkJCQlvU2V0dGluZ3MuYXNEYXRhU2VhcmNoLnNwbGljZSggMCwgb1NldHRpbmdzLmFzRGF0YVNlYXJjaC5sZW5ndGggKTsKCQkJCQoJCQkJdmFyIGFBcnJheSA9IChpTWFzdGVyICYmIGlNYXN0ZXI9PT0xKSA/CgkJCQkgCW9TZXR0aW5ncy5haURpc3BsYXlNYXN0ZXIgOiBvU2V0dGluZ3MuYWlEaXNwbGF5OwoJCQkJCgkJCQlmb3IgKCB2YXIgaT0wLCBpTGVuPWFBcnJheS5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCW9TZXR0aW5ncy5hc0RhdGFTZWFyY2hbaV0gPSBfZm5CdWlsZFNlYXJjaFJvdyggb1NldHRpbmdzLAoJCQkJCQlfZm5HZXRSb3dEYXRhKCBvU2V0dGluZ3MsIGFBcnJheVtpXSwgJ2ZpbHRlcicgKSApOwoJCQkJfQoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIENyZWF0ZSBhIHNlYXJjaGFibGUgc3RyaW5nIGZyb20gYSBzaW5nbGUgZGF0YSByb3cKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge2FycmF5fSBhRGF0YSBSb3cgZGF0YSBhcnJheSB0byB1c2UgZm9yIHRoZSBkYXRhIHRvIHNlYXJjaAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5CdWlsZFNlYXJjaFJvdyggb1NldHRpbmdzLCBhRGF0YSApCgkJewoJCQl2YXIgc1NlYXJjaCA9ICcnOwoJCQlpZiAoIG9TZXR0aW5ncy5fX25UbXBGaWx0ZXIgPT09IHVuZGVmaW5lZCApCgkJCXsKCQkJCW9TZXR0aW5ncy5fX25UbXBGaWx0ZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKCQkJfQoJCQl2YXIgblRtcCA9IG9TZXR0aW5ncy5fX25UbXBGaWx0ZXI7CgkJCQoJCQlmb3IgKCB2YXIgaj0wLCBqTGVuPW9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgajxqTGVuIDsgaisrICkKCQkJewoJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2pdLmJTZWFyY2hhYmxlICkKCQkJCXsKCQkJCQl2YXIgc0RhdGEgPSBhRGF0YVtqXTsKCQkJCQlzU2VhcmNoICs9IF9mbkRhdGFUb1NlYXJjaCggc0RhdGEsIG9TZXR0aW5ncy5hb0NvbHVtbnNbal0uc1R5cGUgKSsnICAnOwoJCQkJfQoJCQl9CgkJCQoJCQkvKiBJZiBpdCBsb29rcyBsaWtlIHRoZXJlIGlzIGFuIEhUTUwgZW50aXR5IGluIHRoZSBzdHJpbmcsIGF0dGVtcHQgdG8gZGVjb2RlIGl0ICovCgkJCWlmICggc1NlYXJjaC5pbmRleE9mKCcmJykgIT09IC0xICkKCQkJewoJCQkJblRtcC5pbm5lckhUTUwgPSBzU2VhcmNoOwoJCQkJc1NlYXJjaCA9IG5UbXAudGV4dENvbnRlbnQgPyBuVG1wLnRleHRDb250ZW50IDogblRtcC5pbm5lclRleHQ7CgkJCQkKCQkJCS8qIElFIGFuZCBPcGVyYSBhcHBlYXIgdG8gcHV0IGFuIG5ld2xpbmUgd2hlcmUgdGhlcmUgaXMgYSA8YnI+IHRhZyAtIHJlbW92ZSBpdCAqLwoJCQkJc1NlYXJjaCA9IHNTZWFyY2gucmVwbGFjZSgvXG4vZywiICIpLnJlcGxhY2UoL1xyL2csIiIpOwoJCQl9CgkJCQoJCQlyZXR1cm4gc1NlYXJjaDsKCQl9CgkJCgkJLyoqCgkJICogQnVpbGQgYSByZWd1bGFyIGV4cHJlc3Npb24gb2JqZWN0IHN1aXRhYmxlIGZvciBzZWFyY2hpbmcgYSB0YWJsZQoJCSAqICBAcGFyYW0ge3N0cmluZ30gc1NlYXJjaCBzdHJpbmcgdG8gc2VhcmNoIGZvcgoJCSAqICBAcGFyYW0ge2Jvb2x9IGJSZWdleCB0cmVhdCBhcyBhIHJlZ3VsYXIgZXhwcmVzc2lvbiBvciBub3QKCQkgKiAgQHBhcmFtIHtib29sfSBiU21hcnQgcGVyZm9ybSBzbWFydCBmaWx0ZXJpbmcgb3Igbm90CgkJICogIEBwYXJhbSB7Ym9vbH0gYkNhc2VJbnNlbnNpdGl2ZSBEbyBjYXNlIGluc2Vuc3RpdmUgbWF0Y2hpbmcgb3Igbm90CgkJICogIEByZXR1cm5zIHtSZWdFeHB9IGNvbnN0cnVjdGVkIG9iamVjdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5GaWx0ZXJDcmVhdGVTZWFyY2goIHNTZWFyY2gsIGJSZWdleCwgYlNtYXJ0LCBiQ2FzZUluc2Vuc2l0aXZlICkKCQl7CgkJCXZhciBhc1NlYXJjaCwgc1JlZ0V4cFN0cmluZzsKCQkJCgkJCWlmICggYlNtYXJ0ICkKCQkJewoJCQkJLyogR2VuZXJhdGUgdGhlIHJlZ3VsYXIgZXhwcmVzc2lvbiB0byB1c2UuIFNvbWV0aGluZyBhbG9uZyB0aGUgbGluZXMgb2Y6CgkJCQkgKiBeKD89Lio/XGJvbmVcYikoPz0uKj9cYnR3b1xiKSg/PS4qP1xidGhyZWVcYikuKiQKCQkJCSAqLwoJCQkJYXNTZWFyY2ggPSBiUmVnZXggPyBzU2VhcmNoLnNwbGl0KCAnICcgKSA6IF9mbkVzY2FwZVJlZ2V4KCBzU2VhcmNoICkuc3BsaXQoICcgJyApOwoJCQkJc1JlZ0V4cFN0cmluZyA9ICdeKD89Lio/Jythc1NlYXJjaC5qb2luKCAnKSg/PS4qPycgKSsnKS4qJCc7CgkJCQlyZXR1cm4gbmV3IFJlZ0V4cCggc1JlZ0V4cFN0cmluZywgYkNhc2VJbnNlbnNpdGl2ZSA/ICJpIiA6ICIiICk7CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQlzU2VhcmNoID0gYlJlZ2V4ID8gc1NlYXJjaCA6IF9mbkVzY2FwZVJlZ2V4KCBzU2VhcmNoICk7CgkJCQlyZXR1cm4gbmV3IFJlZ0V4cCggc1NlYXJjaCwgYkNhc2VJbnNlbnNpdGl2ZSA/ICJpIiA6ICIiICk7CgkJCX0KCQl9CgkJCgkJCgkJLyoqCgkJICogQ29udmVydCByYXcgZGF0YSBpbnRvIHNvbWV0aGluZyB0aGF0IHRoZSB1c2VyIGNhbiBzZWFyY2ggb24KCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNEYXRhIGRhdGEgdG8gYmUgbW9kaWZpZWQKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNUeXBlIGRhdGEgdHlwZQoJCSAqICBAcmV0dXJucyB7c3RyaW5nfSBzZWFyY2ggc3RyaW5nCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkRhdGFUb1NlYXJjaCAoIHNEYXRhLCBzVHlwZSApCgkJewoJCQlpZiAoIHR5cGVvZiBEYXRhVGFibGUuZXh0Lm9mblNlYXJjaFtzVHlwZV0gPT09ICJmdW5jdGlvbiIgKQoJCQl7CgkJCQlyZXR1cm4gRGF0YVRhYmxlLmV4dC5vZm5TZWFyY2hbc1R5cGVdKCBzRGF0YSApOwoJCQl9CgkJCWVsc2UgaWYgKCBzRGF0YSA9PT0gbnVsbCApCgkJCXsKCQkJCXJldHVybiAnJzsKCQkJfQoJCQllbHNlIGlmICggc1R5cGUgPT0gImh0bWwiICkKCQkJewoJCQkJcmV0dXJuIHNEYXRhLnJlcGxhY2UoL1tcclxuXS9nLCIgIikucmVwbGFjZSggLzwuKj8+L2csICIiICk7CgkJCX0KCQkJZWxzZSBpZiAoIHR5cGVvZiBzRGF0YSA9PT0gInN0cmluZyIgKQoJCQl7CgkJCQlyZXR1cm4gc0RhdGEucmVwbGFjZSgvW1xyXG5dL2csIiAiKTsKCQkJfQoJCQlyZXR1cm4gc0RhdGE7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIHNjYXBlIGEgc3RyaW5nIHN0dWNoIHRoYXQgaXQgY2FuIGJlIHVzZWQgaW4gYSByZWd1bGFyIGV4cHJlc3Npb24KCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNWYWwgc3RyaW5nIHRvIGVzY2FwZQoJCSAqICBAcmV0dXJucyB7c3RyaW5nfSBlc2NhcGVkIHN0cmluZwoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5Fc2NhcGVSZWdleCAoIHNWYWwgKQoJCXsKCQkJdmFyIGFjRXNjYXBlID0gWyAnLycsICcuJywgJyonLCAnKycsICc/JywgJ3wnLCAnKCcsICcpJywgJ1snLCAnXScsICd7JywgJ30nLCAnXFwnLCAnJCcsICdeJywgJy0nIF07CgkJCXZhciByZVJlcGxhY2UgPSBuZXcgUmVnRXhwKCAnKFxcJyArIGFjRXNjYXBlLmpvaW4oJ3xcXCcpICsgJyknLCAnZycgKTsKCQkJcmV0dXJuIHNWYWwucmVwbGFjZShyZVJlcGxhY2UsICdcXCQxJyk7CgkJfQoJCQoJCQoJCQoJCS8qKgoJCSAqIEdlbmVyYXRlIHRoZSBub2RlIHJlcXVpcmVkIGZvciB0aGUgaW5mbyBkaXNwbGF5CgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHJldHVybnMge25vZGV9IEluZm9ybWF0aW9uIGVsZW1lbnQKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuRmVhdHVyZUh0bWxJbmZvICggb1NldHRpbmdzICkKCQl7CgkJCXZhciBuSW5mbyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdkaXYnICk7CgkJCW5JbmZvLmNsYXNzTmFtZSA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zSW5mbzsKCQkJCgkJCS8qIEFjdGlvbnMgdGhhdCBhcmUgdG8gYmUgdGFrZW4gb25jZSBvbmx5IGZvciB0aGlzIGZlYXR1cmUgKi8KCQkJaWYgKCAhb1NldHRpbmdzLmFhbkZlYXR1cmVzLmkgKQoJCQl7CgkJCQkvKiBBZGQgZHJhdyBjYWxsYmFjayAqLwoJCQkJb1NldHRpbmdzLmFvRHJhd0NhbGxiYWNrLnB1c2goIHsKCQkJCQkiZm4iOiBfZm5VcGRhdGVJbmZvLAoJCQkJCSJzTmFtZSI6ICJpbmZvcm1hdGlvbiIKCQkJCX0gKTsKCQkJCQoJCQkJLyogQWRkIGlkICovCgkJCQluSW5mby5pZCA9IG9TZXR0aW5ncy5zVGFibGVJZCsnX2luZm8nOwoJCQl9CgkJCW9TZXR0aW5ncy5uVGFibGUuc2V0QXR0cmlidXRlKCAnYXJpYS1kZXNjcmliZWRieScsIG9TZXR0aW5ncy5zVGFibGVJZCsnX2luZm8nICk7CgkJCQoJCQlyZXR1cm4gbkluZm87CgkJfQoJCQoJCQoJCS8qKgoJCSAqIFVwZGF0ZSB0aGUgaW5mb3JtYXRpb24gZWxlbWVudHMgaW4gdGhlIGRpc3BsYXkKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5VcGRhdGVJbmZvICggb1NldHRpbmdzICkKCQl7CgkJCS8qIFNob3cgaW5mb3JtYXRpb24gYWJvdXQgdGhlIHRhYmxlICovCgkJCWlmICggIW9TZXR0aW5ncy5vRmVhdHVyZXMuYkluZm8gfHwgb1NldHRpbmdzLmFhbkZlYXR1cmVzLmkubGVuZ3RoID09PSAwICkKCQkJewoJCQkJcmV0dXJuOwoJCQl9CgkJCQoJCQl2YXIKCQkJCW9MYW5nID0gb1NldHRpbmdzLm9MYW5ndWFnZSwKCQkJCWlTdGFydCA9IG9TZXR0aW5ncy5faURpc3BsYXlTdGFydCsxLAoJCQkJaUVuZCA9IG9TZXR0aW5ncy5mbkRpc3BsYXlFbmQoKSwKCQkJCWlNYXggPSBvU2V0dGluZ3MuZm5SZWNvcmRzVG90YWwoKSwKCQkJCWlUb3RhbCA9IG9TZXR0aW5ncy5mblJlY29yZHNEaXNwbGF5KCksCgkJCQlzT3V0OwoJCQkKCQkJaWYgKCBpVG90YWwgPT09IDAgJiYgaVRvdGFsID09IGlNYXggKQoJCQl7CgkJCQkvKiBFbXB0eSByZWNvcmQgc2V0ICovCgkJCQlzT3V0ID0gb0xhbmcuc0luZm9FbXB0eTsKCQkJfQoJCQllbHNlIGlmICggaVRvdGFsID09PSAwICkKCQkJewoJCQkJLyogRW1wdHkgcmVjb3JkIHNldCBhZnRlciBmaWx0ZXJpbmcgKi8KCQkJCXNPdXQgPSBvTGFuZy5zSW5mb0VtcHR5ICsnICcrIG9MYW5nLnNJbmZvRmlsdGVyZWQ7CgkJCX0KCQkJZWxzZSBpZiAoIGlUb3RhbCA9PSBpTWF4ICkKCQkJewoJCQkJLyogTm9ybWFsIHJlY29yZCBzZXQgKi8KCQkJCXNPdXQgPSBvTGFuZy5zSW5mbzsKCQkJfQoJCQllbHNlCgkJCXsKCQkJCS8qIFJlY29yZCBzZXQgYWZ0ZXIgZmlsdGVyaW5nICovCgkJCQlzT3V0ID0gb0xhbmcuc0luZm8gKycgJysgb0xhbmcuc0luZm9GaWx0ZXJlZDsKCQkJfQoJCQoJCQkvLyBDb252ZXJ0IHRoZSBtYWNyb3MKCQkJc091dCArPSBvTGFuZy5zSW5mb1Bvc3RGaXg7CgkJCXNPdXQgPSBfZm5JbmZvTWFjcm9zKCBvU2V0dGluZ3MsIHNPdXQgKTsKCQkJCgkJCWlmICggb0xhbmcuZm5JbmZvQ2FsbGJhY2sgIT09IG51bGwgKQoJCQl7CgkJCQlzT3V0ID0gb0xhbmcuZm5JbmZvQ2FsbGJhY2suY2FsbCggb1NldHRpbmdzLm9JbnN0YW5jZSwgCgkJCQkJb1NldHRpbmdzLCBpU3RhcnQsIGlFbmQsIGlNYXgsIGlUb3RhbCwgc091dCApOwoJCQl9CgkJCQoJCQl2YXIgbiA9IG9TZXR0aW5ncy5hYW5GZWF0dXJlcy5pOwoJCQlmb3IgKCB2YXIgaT0wLCBpTGVuPW4ubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJJChuW2ldKS5odG1sKCBzT3V0ICk7CgkJCX0KCQl9CgkJCgkJCgkJZnVuY3Rpb24gX2ZuSW5mb01hY3JvcyAoIG9TZXR0aW5ncywgc3RyICkKCQl7CgkJCXZhcgoJCQkJaVN0YXJ0ID0gb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0KzEsCgkJCQlzU3RhcnQgPSBvU2V0dGluZ3MuZm5Gb3JtYXROdW1iZXIoIGlTdGFydCApLAoJCQkJaUVuZCA9IG9TZXR0aW5ncy5mbkRpc3BsYXlFbmQoKSwKCQkJCXNFbmQgPSBvU2V0dGluZ3MuZm5Gb3JtYXROdW1iZXIoIGlFbmQgKSwKCQkJCWlUb3RhbCA9IG9TZXR0aW5ncy5mblJlY29yZHNEaXNwbGF5KCksCgkJCQlzVG90YWwgPSBvU2V0dGluZ3MuZm5Gb3JtYXROdW1iZXIoIGlUb3RhbCApLAoJCQkJaU1heCA9IG9TZXR0aW5ncy5mblJlY29yZHNUb3RhbCgpLAoJCQkJc01heCA9IG9TZXR0aW5ncy5mbkZvcm1hdE51bWJlciggaU1heCApOwoJCQoJCQkvLyBXaGVuIGluZmluaXRlIHNjcm9sbGluZywgd2UgYXJlIGFsd2F5cyBzdGFydGluZyBhdCAxLiBfaURpc3BsYXlTdGFydCBpcyB1c2VkIG9ubHkKCQkJLy8gaW50ZXJuYWxseQoJCQlpZiAoIG9TZXR0aW5ncy5vU2Nyb2xsLmJJbmZpbml0ZSApCgkJCXsKCQkJCXNTdGFydCA9IG9TZXR0aW5ncy5mbkZvcm1hdE51bWJlciggMSApOwoJCQl9CgkJCgkJCXJldHVybiBzdHIuCgkJCQlyZXBsYWNlKCdfU1RBUlRfJywgc1N0YXJ0KS4KCQkJCXJlcGxhY2UoJ19FTkRfJywgICBzRW5kKS4KCQkJCXJlcGxhY2UoJ19UT1RBTF8nLCBzVG90YWwpLgoJCQkJcmVwbGFjZSgnX01BWF8nLCAgIHNNYXgpOwoJCX0KCQkKCQkKCQkKCQkvKioKCQkgKiBEcmF3IHRoZSB0YWJsZSBmb3IgdGhlIGZpcnN0IHRpbWUsIGFkZGluZyBhbGwgcmVxdWlyZWQgZmVhdHVyZXMKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5Jbml0aWFsaXNlICggb1NldHRpbmdzICkKCQl7CgkJCXZhciBpLCBpTGVuLCBpQWpheFN0YXJ0PW9TZXR0aW5ncy5pSW5pdERpc3BsYXlTdGFydDsKCQkJCgkJCS8qIEVuc3VyZSB0aGF0IHRoZSB0YWJsZSBkYXRhIGlzIGZ1bGx5IGluaXRpYWxpc2VkICovCgkJCWlmICggb1NldHRpbmdzLmJJbml0aWFsaXNlZCA9PT0gZmFsc2UgKQoJCQl7CgkJCQlzZXRUaW1lb3V0KCBmdW5jdGlvbigpeyBfZm5Jbml0aWFsaXNlKCBvU2V0dGluZ3MgKTsgfSwgMjAwICk7CgkJCQlyZXR1cm47CgkJCX0KCQkJCgkJCS8qIFNob3cgdGhlIGRpc3BsYXkgSFRNTCBvcHRpb25zICovCgkJCV9mbkFkZE9wdGlvbnNIdG1sKCBvU2V0dGluZ3MgKTsKCQkJCgkJCS8qIEJ1aWxkIGFuZCBkcmF3IHRoZSBoZWFkZXIgLyBmb290ZXIgZm9yIHRoZSB0YWJsZSAqLwoJCQlfZm5CdWlsZEhlYWQoIG9TZXR0aW5ncyApOwoJCQlfZm5EcmF3SGVhZCggb1NldHRpbmdzLCBvU2V0dGluZ3MuYW9IZWFkZXIgKTsKCQkJaWYgKCBvU2V0dGluZ3MublRGb290ICkKCQkJewoJCQkJX2ZuRHJhd0hlYWQoIG9TZXR0aW5ncywgb1NldHRpbmdzLmFvRm9vdGVyICk7CgkJCX0KCQkKCQkJLyogT2theSB0byBzaG93IHRoYXQgc29tZXRoaW5nIGlzIGdvaW5nIG9uIG5vdyAqLwoJCQlfZm5Qcm9jZXNzaW5nRGlzcGxheSggb1NldHRpbmdzLCB0cnVlICk7CgkJCQoJCQkvKiBDYWxjdWxhdGUgc2l6ZXMgZm9yIGNvbHVtbnMgKi8KCQkJaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJBdXRvV2lkdGggKQoJCQl7CgkJCQlfZm5DYWxjdWxhdGVDb2x1bW5XaWR0aHMoIG9TZXR0aW5ncyApOwoJCQl9CgkJCQoJCQlmb3IgKCBpPTAsIGlMZW49b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc1dpZHRoICE9PSBudWxsICkKCQkJCXsKCQkJCQlvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLm5UaC5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNXaWR0aCApOwoJCQkJfQoJCQl9CgkJCQoJCQkvKiBJZiB0aGVyZSBpcyBkZWZhdWx0IHNvcnRpbmcgcmVxdWlyZWQgLSBsZXQncyBkbyBpdC4gVGhlIHNvcnQgZnVuY3Rpb24gd2lsbCBkbyB0aGUKCQkJICogZHJhd2luZyBmb3IgdXMuIE90aGVyd2lzZSB3ZSBkcmF3IHRoZSB0YWJsZSByZWdhcmRsZXNzIG9mIHRoZSBBamF4IHNvdXJjZSAtIHRoaXMgYWxsb3dzCgkJCSAqIHRoZSB0YWJsZSB0byBsb29rIGluaXRpYWxpc2VkIGZvciBBamF4IHNvdXJjaW5nIGRhdGEgKHNob3cgJ2xvYWRpbmcnIG1lc3NhZ2UgcG9zc2libHkpCgkJCSAqLwoJCQlpZiAoIG9TZXR0aW5ncy5vRmVhdHVyZXMuYlNvcnQgKQoJCQl7CgkJCQlfZm5Tb3J0KCBvU2V0dGluZ3MgKTsKCQkJfQoJCQllbHNlIGlmICggb1NldHRpbmdzLm9GZWF0dXJlcy5iRmlsdGVyICkKCQkJewoJCQkJX2ZuRmlsdGVyQ29tcGxldGUoIG9TZXR0aW5ncywgb1NldHRpbmdzLm9QcmV2aW91c1NlYXJjaCApOwoJCQl9CgkJCWVsc2UKCQkJewoJCQkJb1NldHRpbmdzLmFpRGlzcGxheSA9IG9TZXR0aW5ncy5haURpc3BsYXlNYXN0ZXIuc2xpY2UoKTsKCQkJCV9mbkNhbGN1bGF0ZUVuZCggb1NldHRpbmdzICk7CgkJCQlfZm5EcmF3KCBvU2V0dGluZ3MgKTsKCQkJfQoJCQkKCQkJLyogaWYgdGhlcmUgaXMgYW4gYWpheCBzb3VyY2UgbG9hZCB0aGUgZGF0YSAqLwoJCQlpZiAoIG9TZXR0aW5ncy5zQWpheFNvdXJjZSAhPT0gbnVsbCAmJiAhb1NldHRpbmdzLm9GZWF0dXJlcy5iU2VydmVyU2lkZSApCgkJCXsKCQkJCXZhciBhb0RhdGEgPSBbXTsKCQkJCV9mblNlcnZlclBhcmFtcyggb1NldHRpbmdzLCBhb0RhdGEgKTsKCQkJCW9TZXR0aW5ncy5mblNlcnZlckRhdGEuY2FsbCggb1NldHRpbmdzLm9JbnN0YW5jZSwgb1NldHRpbmdzLnNBamF4U291cmNlLCBhb0RhdGEsIGZ1bmN0aW9uKGpzb24pIHsKCQkJCQl2YXIgYURhdGEgPSAob1NldHRpbmdzLnNBamF4RGF0YVByb3AgIT09ICIiKSA/CgkJCQkJIAlfZm5HZXRPYmplY3REYXRhRm4oIG9TZXR0aW5ncy5zQWpheERhdGFQcm9wICkoanNvbikgOiBqc29uOwoJCQoJCQkJCS8qIEdvdCB0aGUgZGF0YSAtIGFkZCBpdCB0byB0aGUgdGFibGUgKi8KCQkJCQlmb3IgKCBpPTAgOyBpPGFEYXRhLmxlbmd0aCA7IGkrKyApCgkJCQkJewoJCQkJCQlfZm5BZGREYXRhKCBvU2V0dGluZ3MsIGFEYXRhW2ldICk7CgkJCQkJfQoJCQkJCQoJCQkJCS8qIFJlc2V0IHRoZSBpbml0IGRpc3BsYXkgZm9yIGNvb2tpZSBzYXZpbmcuIFdlJ3ZlIGFscmVhZHkgZG9uZSBhIGZpbHRlciwgYW5kCgkJCQkJICogdGhlcmVmb3JlIGNsZWFyZWQgaXQgYmVmb3JlLiBTbyB3ZSBuZWVkIHRvIG1ha2UgaXQgYXBwZWFyICdmcmVzaCcKCQkJCQkgKi8KCQkJCQlvU2V0dGluZ3MuaUluaXREaXNwbGF5U3RhcnQgPSBpQWpheFN0YXJ0OwoJCQkJCQoJCQkJCWlmICggb1NldHRpbmdzLm9GZWF0dXJlcy5iU29ydCApCgkJCQkJewoJCQkJCQlfZm5Tb3J0KCBvU2V0dGluZ3MgKTsKCQkJCQl9CgkJCQkJZWxzZQoJCQkJCXsKCQkJCQkJb1NldHRpbmdzLmFpRGlzcGxheSA9IG9TZXR0aW5ncy5haURpc3BsYXlNYXN0ZXIuc2xpY2UoKTsKCQkJCQkJX2ZuQ2FsY3VsYXRlRW5kKCBvU2V0dGluZ3MgKTsKCQkJCQkJX2ZuRHJhdyggb1NldHRpbmdzICk7CgkJCQkJfQoJCQkJCQoJCQkJCV9mblByb2Nlc3NpbmdEaXNwbGF5KCBvU2V0dGluZ3MsIGZhbHNlICk7CgkJCQkJX2ZuSW5pdENvbXBsZXRlKCBvU2V0dGluZ3MsIGpzb24gKTsKCQkJCX0sIG9TZXR0aW5ncyApOwoJCQkJcmV0dXJuOwoJCQl9CgkJCQoJCQkvKiBTZXJ2ZXItc2lkZSBwcm9jZXNzaW5nIGluaXRpYWxpc2F0aW9uIGNvbXBsZXRlIGlzIGRvbmUgYXQgdGhlIGVuZCBvZiBfZm5EcmF3ICovCgkJCWlmICggIW9TZXR0aW5ncy5vRmVhdHVyZXMuYlNlcnZlclNpZGUgKQoJCQl7CgkJCQlfZm5Qcm9jZXNzaW5nRGlzcGxheSggb1NldHRpbmdzLCBmYWxzZSApOwoJCQkJX2ZuSW5pdENvbXBsZXRlKCBvU2V0dGluZ3MgKTsKCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBEcmF3IHRoZSB0YWJsZSBmb3IgdGhlIGZpcnN0IHRpbWUsIGFkZGluZyBhbGwgcmVxdWlyZWQgZmVhdHVyZXMKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge29iamVjdH0gW2pzb25dIEpTT04gZnJvbSB0aGUgc2VydmVyIHRoYXQgY29tcGxldGVkIHRoZSB0YWJsZSwgaWYgdXNpbmcgQWpheCBzb3VyY2UKCQkgKiAgICB3aXRoIGNsaWVudC1zaWRlIHByb2Nlc3NpbmcgKG9wdGlvbmFsKQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5Jbml0Q29tcGxldGUgKCBvU2V0dGluZ3MsIGpzb24gKQoJCXsKCQkJb1NldHRpbmdzLl9iSW5pdENvbXBsZXRlID0gdHJ1ZTsKCQkJX2ZuQ2FsbGJhY2tGaXJlKCBvU2V0dGluZ3MsICdhb0luaXRDb21wbGV0ZScsICdpbml0JywgW29TZXR0aW5ncywganNvbl0gKTsKCQl9CgkJCgkJCgkJLyoqCgkJICogTGFuZ3VhZ2UgY29tcGF0aWJpbGl0eSAtIHdoZW4gY2VydGFpbiBvcHRpb25zIGFyZSBnaXZlbiwgYW5kIG90aGVycyBhcmVuJ3QsIHdlCgkJICogbmVlZCB0byBkdXBsaWNhdGUgdGhlIHZhbHVlcyBvdmVyLCBpbiBvcmRlciB0byBwcm92aWRlIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5CgkJICogd2l0aCBvbGRlciBsYW5ndWFnZSBmaWxlcy4KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5MYW5ndWFnZUNvbXBhdCggb0xhbmd1YWdlICkKCQl7CgkJCXZhciBvRGVmYXVsdHMgPSBEYXRhVGFibGUuZGVmYXVsdHMub0xhbmd1YWdlOwoJCQoJCQkvKiBCYWNrd2FyZHMgY29tcGF0aWJpbGl0eSAtIGlmIHRoZXJlIGlzIG5vIHNFbXB0eVRhYmxlIGdpdmVuLCB0aGVuIHVzZSB0aGUgc2FtZSBhcwoJCQkgKiBzWmVyb1JlY29yZHMgLSBhc3N1bWluZyB0aGF0IGlzIGdpdmVuLgoJCQkgKi8KCQkJaWYgKCAhb0xhbmd1YWdlLnNFbXB0eVRhYmxlICYmIG9MYW5ndWFnZS5zWmVyb1JlY29yZHMgJiYKCQkJCW9EZWZhdWx0cy5zRW1wdHlUYWJsZSA9PT0gIk5vIGRhdGEgYXZhaWxhYmxlIGluIHRhYmxlIiApCgkJCXsKCQkJCV9mbk1hcCggb0xhbmd1YWdlLCBvTGFuZ3VhZ2UsICdzWmVyb1JlY29yZHMnLCAnc0VtcHR5VGFibGUnICk7CgkJCX0KCQkKCQkJLyogTGlrZXdpc2Ugd2l0aCBsb2FkaW5nIHJlY29yZHMgKi8KCQkJaWYgKCAhb0xhbmd1YWdlLnNMb2FkaW5nUmVjb3JkcyAmJiBvTGFuZ3VhZ2Uuc1plcm9SZWNvcmRzICYmCgkJCQlvRGVmYXVsdHMuc0xvYWRpbmdSZWNvcmRzID09PSAiTG9hZGluZy4uLiIgKQoJCQl7CgkJCQlfZm5NYXAoIG9MYW5ndWFnZSwgb0xhbmd1YWdlLCAnc1plcm9SZWNvcmRzJywgJ3NMb2FkaW5nUmVjb3JkcycgKTsKCQkJfQoJCX0KCQkKCQkKCQkKCQkvKioKCQkgKiBHZW5lcmF0ZSB0aGUgbm9kZSByZXF1aXJlZCBmb3IgdXNlciBkaXNwbGF5IGxlbmd0aCBjaGFuZ2luZwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEByZXR1cm5zIHtub2RlfSBEaXNwbGF5IGxlbmd0aCBmZWF0dXJlIG5vZGUKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuRmVhdHVyZUh0bWxMZW5ndGggKCBvU2V0dGluZ3MgKQoJCXsKCQkJaWYgKCBvU2V0dGluZ3Mub1Njcm9sbC5iSW5maW5pdGUgKQoJCQl7CgkJCQlyZXR1cm4gbnVsbDsKCQkJfQoJCQkKCQkJLyogVGhpcyBjYW4gYmUgb3ZlcnJ1bGVkIGJ5IG5vdCB1c2luZyB0aGUgX01FTlVfIHZhci9tYWNybyBpbiB0aGUgbGFuZ3VhZ2UgdmFyaWFibGUgKi8KCQkJdmFyIHNOYW1lID0gJ25hbWU9Iicrb1NldHRpbmdzLnNUYWJsZUlkKydfbGVuZ3RoIic7CgkJCXZhciBzU3RkTWVudSA9ICc8c2VsZWN0IHNpemU9IjEiICcrc05hbWUrJz4nOwoJCQl2YXIgaSwgaUxlbjsKCQkJdmFyIGFMZW5ndGhNZW51ID0gb1NldHRpbmdzLmFMZW5ndGhNZW51OwoJCQkKCQkJaWYgKCBhTGVuZ3RoTWVudS5sZW5ndGggPT0gMiAmJiB0eXBlb2YgYUxlbmd0aE1lbnVbMF0gPT09ICdvYmplY3QnICYmIAoJCQkJCXR5cGVvZiBhTGVuZ3RoTWVudVsxXSA9PT0gJ29iamVjdCcgKQoJCQl7CgkJCQlmb3IgKCBpPTAsIGlMZW49YUxlbmd0aE1lbnVbMF0ubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQlzU3RkTWVudSArPSAnPG9wdGlvbiB2YWx1ZT0iJythTGVuZ3RoTWVudVswXVtpXSsnIj4nK2FMZW5ndGhNZW51WzFdW2ldKyc8L29wdGlvbj4nOwoJCQkJfQoJCQl9CgkJCWVsc2UKCQkJewoJCQkJZm9yICggaT0wLCBpTGVuPWFMZW5ndGhNZW51Lmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJc1N0ZE1lbnUgKz0gJzxvcHRpb24gdmFsdWU9IicrYUxlbmd0aE1lbnVbaV0rJyI+JythTGVuZ3RoTWVudVtpXSsnPC9vcHRpb24+JzsKCQkJCX0KCQkJfQoJCQlzU3RkTWVudSArPSAnPC9zZWxlY3Q+JzsKCQkJCgkJCXZhciBuTGVuZ3RoID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ2RpdicgKTsKCQkJaWYgKCAhb1NldHRpbmdzLmFhbkZlYXR1cmVzLmwgKQoJCQl7CgkJCQluTGVuZ3RoLmlkID0gb1NldHRpbmdzLnNUYWJsZUlkKydfbGVuZ3RoJzsKCQkJfQoJCQluTGVuZ3RoLmNsYXNzTmFtZSA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zTGVuZ3RoOwoJCQluTGVuZ3RoLmlubmVySFRNTCA9ICc8bGFiZWw+JytvU2V0dGluZ3Mub0xhbmd1YWdlLnNMZW5ndGhNZW51LnJlcGxhY2UoICdfTUVOVV8nLCBzU3RkTWVudSApKyc8L2xhYmVsPic7CgkJCQoJCQkvKgoJCQkgKiBTZXQgdGhlIGxlbmd0aCB0byB0aGUgY3VycmVudCBkaXNwbGF5IGxlbmd0aCAtIHRoYW5rcyB0byBBbmRyZWEgUGF2bG92aWMgZm9yIHRoaXMgZml4LAoJCQkgKiBhbmQgU3RlZmFuIFNrb3BuaWsgZm9yIGZpeGluZyB0aGUgZml4IQoJCQkgKi8KCQkJJCgnc2VsZWN0IG9wdGlvblt2YWx1ZT0iJytvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoKyciXScsIG5MZW5ndGgpLmF0dHIoInNlbGVjdGVkIiwgdHJ1ZSk7CgkJCQoJCQkkKCdzZWxlY3QnLCBuTGVuZ3RoKS5iaW5kKCAnY2hhbmdlLkRUJywgZnVuY3Rpb24oZSkgewoJCQkJdmFyIGlWYWwgPSAkKHRoaXMpLnZhbCgpOwoJCQkJCgkJCQkvKiBVcGRhdGUgYWxsIG90aGVyIGxlbmd0aCBvcHRpb25zIGZvciB0aGUgbmV3IGRpc3BsYXkgKi8KCQkJCXZhciBuID0gb1NldHRpbmdzLmFhbkZlYXR1cmVzLmw7CgkJCQlmb3IgKCBpPTAsIGlMZW49bi5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCWlmICggbltpXSAhPSB0aGlzLnBhcmVudE5vZGUgKQoJCQkJCXsKCQkJCQkJJCgnc2VsZWN0JywgbltpXSkudmFsKCBpVmFsICk7CgkJCQkJfQoJCQkJfQoJCQkJCgkJCQkvKiBSZWRyYXcgdGhlIHRhYmxlICovCgkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoID0gcGFyc2VJbnQoaVZhbCwgMTApOwoJCQkJX2ZuQ2FsY3VsYXRlRW5kKCBvU2V0dGluZ3MgKTsKCQkJCQoJCQkJLyogSWYgd2UgaGF2ZSBzcGFjZSB0byBzaG93IGV4dHJhIHJvd3MgKGJhY2tpbmcgdXAgZnJvbSB0aGUgZW5kIHBvaW50IC0gdGhlbiBkbyBzbyAqLwoJCQkJaWYgKCBvU2V0dGluZ3MuZm5EaXNwbGF5RW5kKCkgPT0gb1NldHRpbmdzLmZuUmVjb3Jkc0Rpc3BsYXkoKSApCgkJCQl7CgkJCQkJb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ID0gb1NldHRpbmdzLmZuRGlzcGxheUVuZCgpIC0gb1NldHRpbmdzLl9pRGlzcGxheUxlbmd0aDsKCQkJCQlpZiAoIG9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA8IDAgKQoJCQkJCXsKCQkJCQkJb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ID0gMDsKCQkJCQl9CgkJCQl9CgkJCQkKCQkJCWlmICggb1NldHRpbmdzLl9pRGlzcGxheUxlbmd0aCA9PSAtMSApCgkJCQl7CgkJCQkJb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ID0gMDsKCQkJCX0KCQkJCQoJCQkJX2ZuRHJhdyggb1NldHRpbmdzICk7CgkJCX0gKTsKCQkKCQkKCQkJJCgnc2VsZWN0Jywgbkxlbmd0aCkuYXR0cignYXJpYS1jb250cm9scycsIG9TZXR0aW5ncy5zVGFibGVJZCk7CgkJCQoJCQlyZXR1cm4gbkxlbmd0aDsKCQl9CgkJCgkJCgkJLyoqCgkJICogUmNhbGN1bGF0ZSB0aGUgZW5kIHBvaW50IGJhc2VkIG9uIHRoZSBzdGFydCBwb2ludAoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkNhbGN1bGF0ZUVuZCggb1NldHRpbmdzICkKCQl7CgkJCWlmICggb1NldHRpbmdzLm9GZWF0dXJlcy5iUGFnaW5hdGUgPT09IGZhbHNlICkKCQkJewoJCQkJb1NldHRpbmdzLl9pRGlzcGxheUVuZCA9IG9TZXR0aW5ncy5haURpc3BsYXkubGVuZ3RoOwoJCQl9CgkJCWVsc2UKCQkJewoJCQkJLyogU2V0IHRoZSBlbmQgcG9pbnQgb2YgdGhlIGRpc3BsYXkgLSBiYXNlZCBvbiBob3cgbWFueSBlbGVtZW50cyB0aGVyZSBhcmUKCQkJCSAqIHN0aWxsIHRvIGRpc3BsYXkKCQkJCSAqLwoJCQkJaWYgKCBvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgKyBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoID4gb1NldHRpbmdzLmFpRGlzcGxheS5sZW5ndGggfHwKCQkJCQkgICBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoID09IC0xICkKCQkJCXsKCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5RW5kID0gb1NldHRpbmdzLmFpRGlzcGxheS5sZW5ndGg7CgkJCQl9CgkJCQllbHNlCgkJCQl7CgkJCQkJb1NldHRpbmdzLl9pRGlzcGxheUVuZCA9IG9TZXR0aW5ncy5faURpc3BsYXlTdGFydCArIG9TZXR0aW5ncy5faURpc3BsYXlMZW5ndGg7CgkJCQl9CgkJCX0KCQl9CgkJCgkJCgkJCgkJLyogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICoKCQkgKiBOb3RlIHRoYXQgbW9zdCBvZiB0aGUgcGFnaW5nIGxvZ2ljIGlzIGRvbmUgaW4gCgkJICogRGF0YVRhYmxlLmV4dC5vUGFnaW5hdGlvbgoJCSAqLwoJCQoJCS8qKgoJCSAqIEdlbmVyYXRlIHRoZSBub2RlIHJlcXVpcmVkIGZvciBkZWZhdWx0IHBhZ2luYXRpb24KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcmV0dXJucyB7bm9kZX0gUGFnaW5hdGlvbiBmZWF0dXJlIG5vZGUKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuRmVhdHVyZUh0bWxQYWdpbmF0ZSAoIG9TZXR0aW5ncyApCgkJewoJCQlpZiAoIG9TZXR0aW5ncy5vU2Nyb2xsLmJJbmZpbml0ZSApCgkJCXsKCQkJCXJldHVybiBudWxsOwoJCQl9CgkJCQoJCQl2YXIgblBhZ2luYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ2RpdicgKTsKCQkJblBhZ2luYXRlLmNsYXNzTmFtZSA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zUGFnaW5nK29TZXR0aW5ncy5zUGFnaW5hdGlvblR5cGU7CgkJCQoJCQlEYXRhVGFibGUuZXh0Lm9QYWdpbmF0aW9uWyBvU2V0dGluZ3Muc1BhZ2luYXRpb25UeXBlIF0uZm5Jbml0KCBvU2V0dGluZ3MsIG5QYWdpbmF0ZSwgCgkJCQlmdW5jdGlvbiggb1NldHRpbmdzICkgewoJCQkJCV9mbkNhbGN1bGF0ZUVuZCggb1NldHRpbmdzICk7CgkJCQkJX2ZuRHJhdyggb1NldHRpbmdzICk7CgkJCQl9CgkJCSk7CgkJCQoJCQkvKiBBZGQgYSBkcmF3IGNhbGxiYWNrIGZvciB0aGUgcGFnaW5hdGlvbiBvbiBmaXJzdCBpbnN0YW5jZSwgdG8gdXBkYXRlIHRoZSBwYWdpbmcgZGlzcGxheSAqLwoJCQlpZiAoICFvU2V0dGluZ3MuYWFuRmVhdHVyZXMucCApCgkJCXsKCQkJCW9TZXR0aW5ncy5hb0RyYXdDYWxsYmFjay5wdXNoKCB7CgkJCQkJImZuIjogZnVuY3Rpb24oIG9TZXR0aW5ncyApIHsKCQkJCQkJRGF0YVRhYmxlLmV4dC5vUGFnaW5hdGlvblsgb1NldHRpbmdzLnNQYWdpbmF0aW9uVHlwZSBdLmZuVXBkYXRlKCBvU2V0dGluZ3MsIGZ1bmN0aW9uKCBvU2V0dGluZ3MgKSB7CgkJCQkJCQlfZm5DYWxjdWxhdGVFbmQoIG9TZXR0aW5ncyApOwoJCQkJCQkJX2ZuRHJhdyggb1NldHRpbmdzICk7CgkJCQkJCX0gKTsKCQkJCQl9LAoJCQkJCSJzTmFtZSI6ICJwYWdpbmF0aW9uIgoJCQkJfSApOwoJCQl9CgkJCXJldHVybiBuUGFnaW5hdGU7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEFsdGVyIHRoZSBkaXNwbGF5IHNldHRpbmdzIHRvIGNoYW5nZSB0aGUgcGFnZQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7c3RyaW5nfGludH0gbUFjdGlvbiBQYWdpbmcgYWN0aW9uIHRvIHRha2U6ICJmaXJzdCIsICJwcmV2aW91cyIsICJuZXh0IiBvciAibGFzdCIKCQkgKiAgICBvciBwYWdlIG51bWJlciB0byBqdW1wIHRvIChpbnRlZ2VyKQoJCSAqICBAcmV0dXJucyB7Ym9vbH0gdHJ1ZSBwYWdlIGhhcyBjaGFuZ2VkLCBmYWxzZSAtIG5vIGNoYW5nZSAobm8gZWZmZWN0KSBlZyAnZmlyc3QnIG9uIHBhZ2UgMQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5QYWdlQ2hhbmdlICggb1NldHRpbmdzLCBtQWN0aW9uICkKCQl7CgkJCXZhciBpT2xkU3RhcnQgPSBvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQ7CgkJCQoJCQlpZiAoIHR5cGVvZiBtQWN0aW9uID09PSAibnVtYmVyIiApCgkJCXsKCQkJCW9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA9IG1BY3Rpb24gKiBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoOwoJCQkJaWYgKCBvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPiBvU2V0dGluZ3MuZm5SZWNvcmRzRGlzcGxheSgpICkKCQkJCXsKCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSAwOwoJCQkJfQoJCQl9CgkJCWVsc2UgaWYgKCBtQWN0aW9uID09ICJmaXJzdCIgKQoJCQl7CgkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSAwOwoJCQl9CgkJCWVsc2UgaWYgKCBtQWN0aW9uID09ICJwcmV2aW91cyIgKQoJCQl7CgkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoPj0wID8KCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgLSBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoIDoKCQkJCQkwOwoJCQkJCgkJCQkvKiBDb3JyZWN0IGZvciB1bmRlcnJ1biAqLwoJCQkJaWYgKCBvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPCAwICkKCQkJCXsKCQkJCSAgb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ID0gMDsKCQkJCX0KCQkJfQoJCQllbHNlIGlmICggbUFjdGlvbiA9PSAibmV4dCIgKQoJCQl7CgkJCQlpZiAoIG9TZXR0aW5ncy5faURpc3BsYXlMZW5ndGggPj0gMCApCgkJCQl7CgkJCQkJLyogTWFrZSBzdXJlIHdlIGFyZSBub3Qgb3ZlciBydW5uaW5nIHRoZSBkaXNwbGF5IGFycmF5ICovCgkJCQkJaWYgKCBvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgKyBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoIDwgb1NldHRpbmdzLmZuUmVjb3Jkc0Rpc3BsYXkoKSApCgkJCQkJewoJCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgKz0gb1NldHRpbmdzLl9pRGlzcGxheUxlbmd0aDsKCQkJCQl9CgkJCQl9CgkJCQllbHNlCgkJCQl7CgkJCQkJb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ID0gMDsKCQkJCX0KCQkJfQoJCQllbHNlIGlmICggbUFjdGlvbiA9PSAibGFzdCIgKQoJCQl7CgkJCQlpZiAoIG9TZXR0aW5ncy5faURpc3BsYXlMZW5ndGggPj0gMCApCgkJCQl7CgkJCQkJdmFyIGlQYWdlcyA9IHBhcnNlSW50KCAob1NldHRpbmdzLmZuUmVjb3Jkc0Rpc3BsYXkoKS0xKSAvIG9TZXR0aW5ncy5faURpc3BsYXlMZW5ndGgsIDEwICkgKyAxOwoJCQkJCW9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA9IChpUGFnZXMtMSkgKiBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoOwoJCQkJfQoJCQkJZWxzZQoJCQkJewoJCQkJCW9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA9IDA7CgkJCQl9CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQlfZm5Mb2coIG9TZXR0aW5ncywgMCwgIlVua25vd24gcGFnaW5nIGFjdGlvbjogIittQWN0aW9uICk7CgkJCX0KCQkJJChvU2V0dGluZ3Mub0luc3RhbmNlKS50cmlnZ2VyKCdwYWdlJywgb1NldHRpbmdzKTsKCQkJCgkJCXJldHVybiBpT2xkU3RhcnQgIT0gb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0OwoJCX0KCQkKCQkKCQkKCQkvKioKCQkgKiBHZW5lcmF0ZSB0aGUgbm9kZSByZXF1aXJlZCBmb3IgdGhlIHByb2Nlc3Npbmcgbm9kZQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEByZXR1cm5zIHtub2RlfSBQcm9jZXNzaW5nIGVsZW1lbnQKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuRmVhdHVyZUh0bWxQcm9jZXNzaW5nICggb1NldHRpbmdzICkKCQl7CgkJCXZhciBuUHJvY2Vzc2luZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdkaXYnICk7CgkJCQoJCQlpZiAoICFvU2V0dGluZ3MuYWFuRmVhdHVyZXMuciApCgkJCXsKCQkJCW5Qcm9jZXNzaW5nLmlkID0gb1NldHRpbmdzLnNUYWJsZUlkKydfcHJvY2Vzc2luZyc7CgkJCX0KCQkJblByb2Nlc3NpbmcuaW5uZXJIVE1MID0gb1NldHRpbmdzLm9MYW5ndWFnZS5zUHJvY2Vzc2luZzsKCQkJblByb2Nlc3NpbmcuY2xhc3NOYW1lID0gb1NldHRpbmdzLm9DbGFzc2VzLnNQcm9jZXNzaW5nOwoJCQlvU2V0dGluZ3MublRhYmxlLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKCBuUHJvY2Vzc2luZywgb1NldHRpbmdzLm5UYWJsZSApOwoJCQkKCQkJcmV0dXJuIG5Qcm9jZXNzaW5nOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBEaXNwbGF5IG9yIGhpZGUgdGhlIHByb2Nlc3NpbmcgaW5kaWNhdG9yCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtib29sfSBiU2hvdyBTaG93IHRoZSBwcm9jZXNzaW5nIGluZGljYXRvciAodHJ1ZSkgb3Igbm90IChmYWxzZSkKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuUHJvY2Vzc2luZ0Rpc3BsYXkgKCBvU2V0dGluZ3MsIGJTaG93ICkKCQl7CgkJCWlmICggb1NldHRpbmdzLm9GZWF0dXJlcy5iUHJvY2Vzc2luZyApCgkJCXsKCQkJCXZhciBhbiA9IG9TZXR0aW5ncy5hYW5GZWF0dXJlcy5yOwoJCQkJZm9yICggdmFyIGk9MCwgaUxlbj1hbi5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCWFuW2ldLnN0eWxlLnZpc2liaWxpdHkgPSBiU2hvdyA/ICJ2aXNpYmxlIiA6ICJoaWRkZW4iOwoJCQkJfQoJCQl9CgkJCgkJCSQob1NldHRpbmdzLm9JbnN0YW5jZSkudHJpZ2dlcigncHJvY2Vzc2luZycsIFtvU2V0dGluZ3MsIGJTaG93XSk7CgkJfQoJCQoJCQoJCQoJCS8qKgoJCSAqIEFkZCBhbnkgY29udHJvbCBlbGVtZW50cyBmb3IgdGhlIHRhYmxlIC0gc3BlY2lmaWNhbGx5IHNjcm9sbGluZwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEByZXR1cm5zIHtub2RlfSBOb2RlIHRvIGFkZCB0byB0aGUgRE9NCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkZlYXR1cmVIdG1sVGFibGUgKCBvU2V0dGluZ3MgKQoJCXsKCQkJLyogQ2hlY2sgaWYgc2Nyb2xsaW5nIGlzIGVuYWJsZWQgb3Igbm90IC0gaWYgbm90IHRoZW4gbGVhdmUgdGhlIERPTSB1bmFsdGVyZWQgKi8KCQkJaWYgKCBvU2V0dGluZ3Mub1Njcm9sbC5zWCA9PT0gIiIgJiYgb1NldHRpbmdzLm9TY3JvbGwuc1kgPT09ICIiICkKCQkJewoJCQkJcmV0dXJuIG9TZXR0aW5ncy5uVGFibGU7CgkJCX0KCQkJCgkJCS8qCgkJCSAqIFRoZSBIVE1MIHN0cnVjdHVyZSB0aGF0IHdlIHdhbnQgdG8gZ2VuZXJhdGUgaW4gdGhpcyBmdW5jdGlvbiBpczoKCQkJICogIGRpdiAtIG5TY3JvbGxlcgoJCQkgKiAgICBkaXYgLSBuU2Nyb2xsSGVhZAoJCQkgKiAgICAgIGRpdiAtIG5TY3JvbGxIZWFkSW5uZXIKCQkJICogICAgICAgIHRhYmxlIC0gblNjcm9sbEhlYWRUYWJsZQoJCQkgKiAgICAgICAgICB0aGVhZCAtIG5UaGVhZAoJCQkgKiAgICBkaXYgLSBuU2Nyb2xsQm9keQoJCQkgKiAgICAgIHRhYmxlIC0gb1NldHRpbmdzLm5UYWJsZQoJCQkgKiAgICAgICAgdGhlYWQgLSBuVGhlYWRTaXplCgkJCSAqICAgICAgICB0Ym9keSAtIG5UYm9keQoJCQkgKiAgICBkaXYgLSBuU2Nyb2xsRm9vdAoJCQkgKiAgICAgIGRpdiAtIG5TY3JvbGxGb290SW5uZXIKCQkJICogICAgICAgIHRhYmxlIC0gblNjcm9sbEZvb3RUYWJsZQoJCQkgKiAgICAgICAgICB0Zm9vdCAtIG5UZm9vdAoJCQkgKi8KCQkJdmFyCgkJCSAJblNjcm9sbGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JyksCgkJCSAJblNjcm9sbEhlYWQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSwKCQkJIAluU2Nyb2xsSGVhZElubmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JyksCgkJCSAJblNjcm9sbEJvZHkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSwKCQkJIAluU2Nyb2xsRm9vdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpLAoJCQkgCW5TY3JvbGxGb290SW5uZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSwKCQkJIAluU2Nyb2xsSGVhZFRhYmxlID0gb1NldHRpbmdzLm5UYWJsZS5jbG9uZU5vZGUoZmFsc2UpLAoJCQkgCW5TY3JvbGxGb290VGFibGUgPSBvU2V0dGluZ3MublRhYmxlLmNsb25lTm9kZShmYWxzZSksCgkJCQluVGhlYWQgPSBvU2V0dGluZ3MublRhYmxlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0aGVhZCcpWzBdLAoJCQkgCW5UZm9vdCA9IG9TZXR0aW5ncy5uVGFibGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3Rmb290JykubGVuZ3RoID09PSAwID8gbnVsbCA6IAoJCQkJCW9TZXR0aW5ncy5uVGFibGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3Rmb290JylbMF0sCgkJCQlvQ2xhc3NlcyA9IG9TZXR0aW5ncy5vQ2xhc3NlczsKCQkJCgkJCW5TY3JvbGxIZWFkLmFwcGVuZENoaWxkKCBuU2Nyb2xsSGVhZElubmVyICk7CgkJCW5TY3JvbGxGb290LmFwcGVuZENoaWxkKCBuU2Nyb2xsRm9vdElubmVyICk7CgkJCW5TY3JvbGxCb2R5LmFwcGVuZENoaWxkKCBvU2V0dGluZ3MublRhYmxlICk7CgkJCW5TY3JvbGxlci5hcHBlbmRDaGlsZCggblNjcm9sbEhlYWQgKTsKCQkJblNjcm9sbGVyLmFwcGVuZENoaWxkKCBuU2Nyb2xsQm9keSApOwoJCQluU2Nyb2xsSGVhZElubmVyLmFwcGVuZENoaWxkKCBuU2Nyb2xsSGVhZFRhYmxlICk7CgkJCW5TY3JvbGxIZWFkVGFibGUuYXBwZW5kQ2hpbGQoIG5UaGVhZCApOwoJCQlpZiAoIG5UZm9vdCAhPT0gbnVsbCApCgkJCXsKCQkJCW5TY3JvbGxlci5hcHBlbmRDaGlsZCggblNjcm9sbEZvb3QgKTsKCQkJCW5TY3JvbGxGb290SW5uZXIuYXBwZW5kQ2hpbGQoIG5TY3JvbGxGb290VGFibGUgKTsKCQkJCW5TY3JvbGxGb290VGFibGUuYXBwZW5kQ2hpbGQoIG5UZm9vdCApOwoJCQl9CgkJCQoJCQluU2Nyb2xsZXIuY2xhc3NOYW1lID0gb0NsYXNzZXMuc1Njcm9sbFdyYXBwZXI7CgkJCW5TY3JvbGxIZWFkLmNsYXNzTmFtZSA9IG9DbGFzc2VzLnNTY3JvbGxIZWFkOwoJCQluU2Nyb2xsSGVhZElubmVyLmNsYXNzTmFtZSA9IG9DbGFzc2VzLnNTY3JvbGxIZWFkSW5uZXI7CgkJCW5TY3JvbGxCb2R5LmNsYXNzTmFtZSA9IG9DbGFzc2VzLnNTY3JvbGxCb2R5OwoJCQluU2Nyb2xsRm9vdC5jbGFzc05hbWUgPSBvQ2xhc3Nlcy5zU2Nyb2xsRm9vdDsKCQkJblNjcm9sbEZvb3RJbm5lci5jbGFzc05hbWUgPSBvQ2xhc3Nlcy5zU2Nyb2xsRm9vdElubmVyOwoJCQkKCQkJaWYgKCBvU2V0dGluZ3Mub1Njcm9sbC5iQXV0b0NzcyApCgkJCXsKCQkJCW5TY3JvbGxIZWFkLnN0eWxlLm92ZXJmbG93ID0gImhpZGRlbiI7CgkJCQluU2Nyb2xsSGVhZC5zdHlsZS5wb3NpdGlvbiA9ICJyZWxhdGl2ZSI7CgkJCQluU2Nyb2xsRm9vdC5zdHlsZS5vdmVyZmxvdyA9ICJoaWRkZW4iOwoJCQkJblNjcm9sbEJvZHkuc3R5bGUub3ZlcmZsb3cgPSAiYXV0byI7CgkJCX0KCQkJCgkJCW5TY3JvbGxIZWFkLnN0eWxlLmJvcmRlciA9ICIwIjsKCQkJblNjcm9sbEhlYWQuc3R5bGUud2lkdGggPSAiMTAwJSI7CgkJCW5TY3JvbGxGb290LnN0eWxlLmJvcmRlciA9ICIwIjsKCQkJblNjcm9sbEhlYWRJbm5lci5zdHlsZS53aWR0aCA9IG9TZXR0aW5ncy5vU2Nyb2xsLnNYSW5uZXIgIT09ICIiID8KCQkJCW9TZXR0aW5ncy5vU2Nyb2xsLnNYSW5uZXIgOiAiMTAwJSI7IC8qIHdpbGwgYmUgb3ZlcndyaXR0ZW4gKi8KCQkJCgkJCS8qIE1vZGlmeSBhdHRyaWJ1dGVzIHRvIHJlc3BlY3QgdGhlIGNsb25lcyAqLwoJCQluU2Nyb2xsSGVhZFRhYmxlLnJlbW92ZUF0dHJpYnV0ZSgnaWQnKTsKCQkJblNjcm9sbEhlYWRUYWJsZS5zdHlsZS5tYXJnaW5MZWZ0ID0gIjAiOwoJCQlvU2V0dGluZ3MublRhYmxlLnN0eWxlLm1hcmdpbkxlZnQgPSAiMCI7CgkJCWlmICggblRmb290ICE9PSBudWxsICkKCQkJewoJCQkJblNjcm9sbEZvb3RUYWJsZS5yZW1vdmVBdHRyaWJ1dGUoJ2lkJyk7CgkJCQluU2Nyb2xsRm9vdFRhYmxlLnN0eWxlLm1hcmdpbkxlZnQgPSAiMCI7CgkJCX0KCQkJCgkJCS8qIE1vdmUgY2FwdGlvbiBlbGVtZW50cyBmcm9tIHRoZSBib2R5IHRvIHRoZSBoZWFkZXIsIGZvb3RlciBvciBsZWF2ZSB3aGVyZSBpdCBpcwoJCQkgKiBkZXBlbmRpbmcgb24gdGhlIGNvbmZpZ3VyYXRpb24uIE5vdGUgdGhhdCB0aGUgRFREIHNheXMgdGhlcmUgY2FuIGJlIG9ubHkgb25lIGNhcHRpb24gKi8KCQkJdmFyIG5DYXB0aW9uID0gJChvU2V0dGluZ3MublRhYmxlKS5jaGlsZHJlbignY2FwdGlvbicpOwoJCQlpZiAoIG5DYXB0aW9uLmxlbmd0aCA+IDAgKQoJCQl7CgkJCQluQ2FwdGlvbiA9IG5DYXB0aW9uWzBdOwoJCQkJaWYgKCBuQ2FwdGlvbi5fY2FwdGlvblNpZGUgPT09ICJ0b3AiICkKCQkJCXsKCQkJCQluU2Nyb2xsSGVhZFRhYmxlLmFwcGVuZENoaWxkKCBuQ2FwdGlvbiApOwoJCQkJfQoJCQkJZWxzZSBpZiAoIG5DYXB0aW9uLl9jYXB0aW9uU2lkZSA9PT0gImJvdHRvbSIgJiYgblRmb290ICkKCQkJCXsKCQkJCQluU2Nyb2xsRm9vdFRhYmxlLmFwcGVuZENoaWxkKCBuQ2FwdGlvbiApOwoJCQkJfQoJCQl9CgkJCQoJCQkvKgoJCQkgKiBTaXppbmcKCQkJICovCgkJCS8qIFdoZW4geHNjcm9sbGluZyBhZGQgdGhlIHdpZHRoIGFuZCBhIHNjcm9sbGVyIHRvIG1vdmUgdGhlIGhlYWRlciB3aXRoIHRoZSBib2R5ICovCgkJCWlmICggb1NldHRpbmdzLm9TY3JvbGwuc1ggIT09ICIiICkKCQkJewoJCQkJblNjcm9sbEhlYWQuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0Nzcyggb1NldHRpbmdzLm9TY3JvbGwuc1ggKTsKCQkJCW5TY3JvbGxCb2R5LnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIG9TZXR0aW5ncy5vU2Nyb2xsLnNYICk7CgkJCQkKCQkJCWlmICggblRmb290ICE9PSBudWxsICkKCQkJCXsKCQkJCQluU2Nyb2xsRm9vdC5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBvU2V0dGluZ3Mub1Njcm9sbC5zWCApOwkKCQkJCX0KCQkJCQoJCQkJLyogV2hlbiB0aGUgYm9keSBpcyBzY3JvbGxlZCwgdGhlbiB3ZSBhbHNvIHdhbnQgdG8gc2Nyb2xsIHRoZSBoZWFkZXJzICovCgkJCQkkKG5TY3JvbGxCb2R5KS5zY3JvbGwoIGZ1bmN0aW9uIChlKSB7CgkJCQkJblNjcm9sbEhlYWQuc2Nyb2xsTGVmdCA9IHRoaXMuc2Nyb2xsTGVmdDsKCQkJCQkKCQkJCQlpZiAoIG5UZm9vdCAhPT0gbnVsbCApCgkJCQkJewoJCQkJCQluU2Nyb2xsRm9vdC5zY3JvbGxMZWZ0ID0gdGhpcy5zY3JvbGxMZWZ0OwoJCQkJCX0KCQkJCX0gKTsKCQkJfQoJCQkKCQkJLyogV2hlbiB5c2Nyb2xsaW5nLCBhZGQgdGhlIGhlaWdodCAqLwoJCQlpZiAoIG9TZXR0aW5ncy5vU2Nyb2xsLnNZICE9PSAiIiApCgkJCXsKCQkJCW5TY3JvbGxCb2R5LnN0eWxlLmhlaWdodCA9IF9mblN0cmluZ1RvQ3NzKCBvU2V0dGluZ3Mub1Njcm9sbC5zWSApOwoJCQl9CgkJCQoJCQkvKiBSZWRyYXcgLSBhbGlnbiBjb2x1bW5zIGFjcm9zcyB0aGUgdGFibGVzICovCgkJCW9TZXR0aW5ncy5hb0RyYXdDYWxsYmFjay5wdXNoKCB7CgkJCQkiZm4iOiBfZm5TY3JvbGxEcmF3LAoJCQkJInNOYW1lIjogInNjcm9sbGluZyIKCQkJfSApOwoJCQkKCQkJLyogSW5maW5pdGUgc2Nyb2xsaW5nIGV2ZW50IGhhbmRsZXJzICovCgkJCWlmICggb1NldHRpbmdzLm9TY3JvbGwuYkluZmluaXRlICkKCQkJewoJCQkJJChuU2Nyb2xsQm9keSkuc2Nyb2xsKCBmdW5jdGlvbigpIHsKCQkJCQkvKiBVc2UgYSBibG9ja2VyIHRvIHN0b3Agc2Nyb2xsaW5nIGZyb20gbG9hZGluZyBtb3JlIGRhdGEgd2hpbGUgb3RoZXIgZGF0YSBpcyBzdGlsbCBsb2FkaW5nICovCgkJCQkJaWYgKCAhb1NldHRpbmdzLmJEcmF3aW5nICYmICQodGhpcykuc2Nyb2xsVG9wKCkgIT09IDAgKQoJCQkJCXsKCQkJCQkJLyogQ2hlY2sgaWYgd2Ugc2hvdWxkIGxvYWQgdGhlIG5leHQgZGF0YSBzZXQgKi8KCQkJCQkJaWYgKCAkKHRoaXMpLnNjcm9sbFRvcCgpICsgJCh0aGlzKS5oZWlnaHQoKSA+IAoJCQkJCQkJJChvU2V0dGluZ3MublRhYmxlKS5oZWlnaHQoKSAtIG9TZXR0aW5ncy5vU2Nyb2xsLmlMb2FkR2FwICkKCQkJCQkJewoJCQkJCQkJLyogT25seSBkbyB0aGUgcmVkcmF3IGlmIHdlIGhhdmUgdG8gLSB3ZSBtaWdodCBiZSBhdCB0aGUgZW5kIG9mIHRoZSBkYXRhICovCgkJCQkJCQlpZiAoIG9TZXR0aW5ncy5mbkRpc3BsYXlFbmQoKSA8IG9TZXR0aW5ncy5mblJlY29yZHNEaXNwbGF5KCkgKQoJCQkJCQkJewoJCQkJCQkJCV9mblBhZ2VDaGFuZ2UoIG9TZXR0aW5ncywgJ25leHQnICk7CgkJCQkJCQkJX2ZuQ2FsY3VsYXRlRW5kKCBvU2V0dGluZ3MgKTsKCQkJCQkJCQlfZm5EcmF3KCBvU2V0dGluZ3MgKTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCQkJCX0gKTsKCQkJfQoJCQkKCQkJb1NldHRpbmdzLm5TY3JvbGxIZWFkID0gblNjcm9sbEhlYWQ7CgkJCW9TZXR0aW5ncy5uU2Nyb2xsRm9vdCA9IG5TY3JvbGxGb290OwoJCQkKCQkJcmV0dXJuIG5TY3JvbGxlcjsKCQl9CgkJCgkJCgkJLyoqCgkJICogVXBkYXRlIHRoZSB2YXJpb3VzIHRhYmxlcyBmb3IgcmVzaXppbmcuIEl0J3MgYSBiaXQgb2YgYSBwaWcgdGhpcyBmdW5jdGlvbiwgYnV0CgkJICogYmFzaWNhbGx5IHRoZSBpZGVhIHRvOgoJCSAqICAgMS4gUmUtY3JlYXRlIHRoZSB0YWJsZSBpbnNpZGUgdGhlIHNjcm9sbGluZyBkaXYKCQkgKiAgIDIuIFRha2UgbGl2ZSBtZWFzdXJlbWVudHMgZnJvbSB0aGUgRE9NCgkJICogICAzLiBBcHBseSB0aGUgbWVhc3VyZW1lbnRzCgkJICogICA0LiBDbGVhbiB1cAoJCSAqICBAcGFyYW0ge29iamVjdH0gbyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcmV0dXJucyB7bm9kZX0gTm9kZSB0byBhZGQgdG8gdGhlIERPTQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5TY3JvbGxEcmF3ICggbyApCgkJewoJCQl2YXIKCQkJCW5TY3JvbGxIZWFkSW5uZXIgPSBvLm5TY3JvbGxIZWFkLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdkaXYnKVswXSwKCQkJCW5TY3JvbGxIZWFkVGFibGUgPSBuU2Nyb2xsSGVhZElubmVyLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0YWJsZScpWzBdLAoJCQkJblNjcm9sbEJvZHkgPSBvLm5UYWJsZS5wYXJlbnROb2RlLAoJCQkJaSwgaUxlbiwgaiwgakxlbiwgYW5IZWFkVG9TaXplLCBhbkhlYWRTaXplcnMsIGFuRm9vdFNpemVycywgYW5Gb290VG9TaXplLCBvU3R5bGUsIGlWaXMsCgkJCQluVGhlYWRTaXplLCBuVGZvb3RTaXplLAoJCQkJaVdpZHRoLCBhQXBwbGllZD1bXSwgaVNhbml0eVdpZHRoLAoJCQkJblNjcm9sbEZvb3RJbm5lciA9IChvLm5URm9vdCAhPT0gbnVsbCkgPyBvLm5TY3JvbGxGb290LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdkaXYnKVswXSA6IG51bGwsCgkJCQluU2Nyb2xsRm9vdFRhYmxlID0gKG8ublRGb290ICE9PSBudWxsKSA/IG5TY3JvbGxGb290SW5uZXIuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RhYmxlJylbMF0gOiBudWxsLAoJCQkJaWU2NyA9ICQuYnJvd3Nlci5tc2llICYmICQuYnJvd3Nlci52ZXJzaW9uIDw9IDc7CgkJCQoJCQkvKgoJCQkgKiAxLiBSZS1jcmVhdGUgdGhlIHRhYmxlIGluc2lkZSB0aGUgc2Nyb2xsaW5nIGRpdgoJCQkgKi8KCQkJCgkJCS8qIFJlbW92ZSB0aGUgb2xkIG1pbmltaXNlZCB0aGVhZCBhbmQgdGZvb3QgZWxlbWVudHMgaW4gdGhlIGlubmVyIHRhYmxlICovCgkJCSQoby5uVGFibGUpLmNoaWxkcmVuKCd0aGVhZCwgdGZvb3QnKS5yZW1vdmUoKTsKCQkKCQkJLyogQ2xvbmUgdGhlIGN1cnJlbnQgaGVhZGVyIGFuZCBmb290ZXIgZWxlbWVudHMgYW5kIHRoZW4gcGxhY2UgaXQgaW50byB0aGUgaW5uZXIgdGFibGUgKi8KCQkJblRoZWFkU2l6ZSA9ICQoby5uVEhlYWQpLmNsb25lKClbMF07CgkJCW8ublRhYmxlLmluc2VydEJlZm9yZSggblRoZWFkU2l6ZSwgby5uVGFibGUuY2hpbGROb2Rlc1swXSApOwoJCQkKCQkJaWYgKCBvLm5URm9vdCAhPT0gbnVsbCApCgkJCXsKCQkJCW5UZm9vdFNpemUgPSAkKG8ublRGb290KS5jbG9uZSgpWzBdOwoJCQkJby5uVGFibGUuaW5zZXJ0QmVmb3JlKCBuVGZvb3RTaXplLCBvLm5UYWJsZS5jaGlsZE5vZGVzWzFdICk7CgkJCX0KCQkJCgkJCS8qCgkJCSAqIDIuIFRha2UgbGl2ZSBtZWFzdXJlbWVudHMgZnJvbSB0aGUgRE9NIC0gZG8gbm90IGFsdGVyIHRoZSBET00gaXRzZWxmIQoJCQkgKi8KCQkJCgkJCS8qIFJlbW92ZSBvbGQgc2l6aW5nIGFuZCBhcHBseSB0aGUgY2FsY3VsYXRlZCBjb2x1bW4gd2lkdGhzCgkJCSAqIEdldCB0aGUgdW5pcXVlIGNvbHVtbiBoZWFkZXJzIGluIHRoZSBuZXdseSBjcmVhdGVkIChjbG9uZWQpIGhlYWRlci4gV2Ugd2FudCB0byBhcHBseSB0aGUKCQkJICogY2FsY2xhdGVkIHNpemVzIHRvIHRoaXMgaGVhZGVyCgkJCSAqLwoJCQlpZiAoIG8ub1Njcm9sbC5zWCA9PT0gIiIgKQoJCQl7CgkJCQluU2Nyb2xsQm9keS5zdHlsZS53aWR0aCA9ICcxMDAlJzsKCQkJCW5TY3JvbGxIZWFkSW5uZXIucGFyZW50Tm9kZS5zdHlsZS53aWR0aCA9ICcxMDAlJzsKCQkJfQoJCQkKCQkJdmFyIG5UaHMgPSBfZm5HZXRVbmlxdWVUaHMoIG8sIG5UaGVhZFNpemUgKTsKCQkJZm9yICggaT0wLCBpTGVuPW5UaHMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJaVZpcyA9IF9mblZpc2libGVUb0NvbHVtbkluZGV4KCBvLCBpICk7CgkJCQluVGhzW2ldLnN0eWxlLndpZHRoID0gby5hb0NvbHVtbnNbaVZpc10uc1dpZHRoOwoJCQl9CgkJCQoJCQlpZiAoIG8ublRGb290ICE9PSBudWxsICkKCQkJewoJCQkJX2ZuQXBwbHlUb0NoaWxkcmVuKCBmdW5jdGlvbihuKSB7CgkJCQkJbi5zdHlsZS53aWR0aCA9ICIiOwoJCQkJfSwgblRmb290U2l6ZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgndHInKSApOwoJCQl9CgkJCgkJCS8vIElmIHNjcm9sbCBjb2xsYXBzZSBpcyBlbmFibGVkLCB3aGVuIHdlIHB1dCB0aGUgaGVhZGVycyBiYWNrIGludG8gdGhlIGJvZHkgZm9yIHNpemluZywgd2UKCQkJLy8gd2lsbCBlbmQgdXAgZm9yY2luZyB0aGUgc2Nyb2xsYmFyIHRvIGFwcGVhciwgbWFraW5nIG91ciBtZWFzdXJlbWVudHMgd3JvbmcgZm9yIHdoZW4gd2UKCQkJLy8gdGhlbiBoaWRlIGl0IChlbmQgb2YgdGhpcyBmdW5jdGlvbiksIHNvIGFkZCB0aGUgaGVhZGVyIGhlaWdodCB0byB0aGUgYm9keSBzY3JvbGxlci4KCQkJaWYgKCBvLm9TY3JvbGwuYkNvbGxhcHNlICYmIG8ub1Njcm9sbC5zWSAhPT0gIiIgKQoJCQl7CgkJCQluU2Nyb2xsQm9keS5zdHlsZS5oZWlnaHQgPSAoblNjcm9sbEJvZHkub2Zmc2V0SGVpZ2h0ICsgby5uVEhlYWQub2Zmc2V0SGVpZ2h0KSsicHgiOwoJCQl9CgkJCQoJCQkvKiBTaXplIHRoZSB0YWJsZSBhcyBhIHdob2xlICovCgkJCWlTYW5pdHlXaWR0aCA9ICQoby5uVGFibGUpLm91dGVyV2lkdGgoKTsKCQkJaWYgKCBvLm9TY3JvbGwuc1ggPT09ICIiICkKCQkJewoJCQkJLyogTm8geCBzY3JvbGxpbmcgKi8KCQkJCW8ublRhYmxlLnN0eWxlLndpZHRoID0gIjEwMCUiOwoJCQkJCgkJCQkvKiBJIGtub3cgdGhpcyBpcyBydWJiaXNoIC0gYnV0IElFNyB3aWxsIG1ha2UgdGhlIHdpZHRoIG9mIHRoZSB0YWJsZSB3aGVuIDEwMCUgaW5jbHVkZQoJCQkJICogdGhlIHNjcm9sbGJhciAtIHdoaWNoIGlzIHNob3VsZG4ndC4gV2hlbiB0aGVyZSBpcyBhIHNjcm9sbGJhciB3ZSBuZWVkIHRvIHRha2UgdGhpcwoJCQkJICogaW50byBhY2NvdW50LgoJCQkJICovCgkJCQlpZiAoIGllNjcgJiYgKCQoJ3Rib2R5JywgblNjcm9sbEJvZHkpLmhlaWdodCgpID4gblNjcm9sbEJvZHkub2Zmc2V0SGVpZ2h0IHx8IAoJCQkJCSQoblNjcm9sbEJvZHkpLmNzcygnb3ZlcmZsb3cteScpID09ICJzY3JvbGwiKSAgKQoJCQkJewoJCQkJCW8ublRhYmxlLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoICQoby5uVGFibGUpLm91dGVyV2lkdGgoKSAtIG8ub1Njcm9sbC5pQmFyV2lkdGgpOwoJCQkJfQoJCQl9CgkJCWVsc2UKCQkJewoJCQkJaWYgKCBvLm9TY3JvbGwuc1hJbm5lciAhPT0gIiIgKQoJCQkJewoJCQkJCS8qIHggc2Nyb2xsIGlubmVyIGhhcyBiZWVuIGdpdmVuIC0gdXNlIGl0ICovCgkJCQkJby5uVGFibGUuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyhvLm9TY3JvbGwuc1hJbm5lcik7CgkJCQl9CgkJCQllbHNlIGlmICggaVNhbml0eVdpZHRoID09ICQoblNjcm9sbEJvZHkpLndpZHRoKCkgJiYKCQkJCSAgICQoblNjcm9sbEJvZHkpLmhlaWdodCgpIDwgJChvLm5UYWJsZSkuaGVpZ2h0KCkgKQoJCQkJewoJCQkJCS8qIFRoZXJlIGlzIHktc2Nyb2xsaW5nIC0gdHJ5IHRvIHRha2UgYWNjb3VudCBvZiB0aGUgeSBzY3JvbGwgYmFyICovCgkJCQkJby5uVGFibGUuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggaVNhbml0eVdpZHRoLW8ub1Njcm9sbC5pQmFyV2lkdGggKTsKCQkJCQlpZiAoICQoby5uVGFibGUpLm91dGVyV2lkdGgoKSA+IGlTYW5pdHlXaWR0aC1vLm9TY3JvbGwuaUJhcldpZHRoICkKCQkJCQl7CgkJCQkJCS8qIE5vdCBwb3NzaWJsZSB0byB0YWtlIGFjY291bnQgb2YgaXQgKi8KCQkJCQkJby5uVGFibGUuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggaVNhbml0eVdpZHRoICk7CgkJCQkJfQoJCQkJfQoJCQkJZWxzZQoJCQkJewoJCQkJCS8qIEFsbCBlbHNlIGZhaWxzICovCgkJCQkJby5uVGFibGUuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggaVNhbml0eVdpZHRoICk7CgkJCQl9CgkJCX0KCQkJCgkJCS8qIFJlY2FsY3VsYXRlIHRoZSBzYW5pdHkgd2lkdGggLSBub3cgdGhhdCB3ZSd2ZSBhcHBsaWVkIHRoZSByZXF1aXJlZCB3aWR0aCwgYmVmb3JlIGl0IHdhcwoJCQkgKiBhIHRlbXBvcmFyeSB2YXJpYWJsZS4gVGhpcyBpcyByZXF1aXJlZCBiZWNhdXNlIHRoZSBjb2x1bW4gd2lkdGggY2FsY3VsYXRpb24gaXMgZG9uZQoJCQkgKiBiZWZvcmUgdGhpcyB0YWJsZSBET00gaXMgY3JlYXRlZC4KCQkJICovCgkJCWlTYW5pdHlXaWR0aCA9ICQoby5uVGFibGUpLm91dGVyV2lkdGgoKTsKCQkJCgkJCS8qIFdlIHdhbnQgdGhlIGhpZGRlbiBoZWFkZXIgdG8gaGF2ZSB6ZXJvIGhlaWdodCwgc28gcmVtb3ZlIHBhZGRpbmcgYW5kIGJvcmRlcnMuIFRoZW4KCQkJICogc2V0IHRoZSB3aWR0aCBiYXNlZCBvbiB0aGUgcmVhbCBoZWFkZXJzCgkJCSAqLwoJCQlhbkhlYWRUb1NpemUgPSBvLm5USGVhZC5nZXRFbGVtZW50c0J5VGFnTmFtZSgndHInKTsKCQkJYW5IZWFkU2l6ZXJzID0gblRoZWFkU2l6ZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgndHInKTsKCQkJCgkJCV9mbkFwcGx5VG9DaGlsZHJlbiggZnVuY3Rpb24oblNpemVyLCBuVG9TaXplKSB7CgkJCQlvU3R5bGUgPSBuU2l6ZXIuc3R5bGU7CgkJCQlvU3R5bGUucGFkZGluZ1RvcCA9ICIwIjsKCQkJCW9TdHlsZS5wYWRkaW5nQm90dG9tID0gIjAiOwoJCQkJb1N0eWxlLmJvcmRlclRvcFdpZHRoID0gIjAiOwoJCQkJb1N0eWxlLmJvcmRlckJvdHRvbVdpZHRoID0gIjAiOwoJCQkJb1N0eWxlLmhlaWdodCA9IDA7CgkJCQkKCQkJCWlXaWR0aCA9ICQoblNpemVyKS53aWR0aCgpOwoJCQkJblRvU2l6ZS5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBpV2lkdGggKTsKCQkJCWFBcHBsaWVkLnB1c2goIGlXaWR0aCApOwoJCQl9LCBhbkhlYWRTaXplcnMsIGFuSGVhZFRvU2l6ZSApOwoJCQkkKGFuSGVhZFNpemVycykuaGVpZ2h0KDApOwoJCQkKCQkJaWYgKCBvLm5URm9vdCAhPT0gbnVsbCApCgkJCXsKCQkJCS8qIENsb25lIHRoZSBjdXJyZW50IGZvb3RlciBhbmQgdGhlbiBwbGFjZSBpdCBpbnRvIHRoZSBib2R5IHRhYmxlIGFzIGEgImhpZGRlbiBoZWFkZXIiICovCgkJCQlhbkZvb3RTaXplcnMgPSBuVGZvb3RTaXplLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0cicpOwoJCQkJYW5Gb290VG9TaXplID0gby5uVEZvb3QuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RyJyk7CgkJCQkKCQkJCV9mbkFwcGx5VG9DaGlsZHJlbiggZnVuY3Rpb24oblNpemVyLCBuVG9TaXplKSB7CgkJCQkJb1N0eWxlID0gblNpemVyLnN0eWxlOwoJCQkJCW9TdHlsZS5wYWRkaW5nVG9wID0gIjAiOwoJCQkJCW9TdHlsZS5wYWRkaW5nQm90dG9tID0gIjAiOwoJCQkJCW9TdHlsZS5ib3JkZXJUb3BXaWR0aCA9ICIwIjsKCQkJCQlvU3R5bGUuYm9yZGVyQm90dG9tV2lkdGggPSAiMCI7CgkJCQkJb1N0eWxlLmhlaWdodCA9IDA7CgkJCQkJCgkJCQkJaVdpZHRoID0gJChuU2l6ZXIpLndpZHRoKCk7CgkJCQkJblRvU2l6ZS5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBpV2lkdGggKTsKCQkJCQlhQXBwbGllZC5wdXNoKCBpV2lkdGggKTsKCQkJCX0sIGFuRm9vdFNpemVycywgYW5Gb290VG9TaXplICk7CgkJCQkkKGFuRm9vdFNpemVycykuaGVpZ2h0KDApOwoJCQl9CgkJCQoJCQkvKgoJCQkgKiAzLiBBcHBseSB0aGUgbWVhc3VyZW1lbnRzCgkJCSAqLwoJCQkKCQkJLyogIkhpZGUiIHRoZSBoZWFkZXIgYW5kIGZvb3RlciB0aGF0IHdlIHVzZWQgZm9yIHRoZSBzaXppbmcuIFdlIHdhbnQgdG8gYWxzbyBmaXggdGhlaXIgd2lkdGgKCQkJICogdG8gd2hhdCB0aGV5IGN1cnJlbnRseSBhcmUKCQkJICovCgkJCV9mbkFwcGx5VG9DaGlsZHJlbiggZnVuY3Rpb24oblNpemVyKSB7CgkJCQluU2l6ZXIuaW5uZXJIVE1MID0gIiI7CgkJCQluU2l6ZXIuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggYUFwcGxpZWQuc2hpZnQoKSApOwoJCQl9LCBhbkhlYWRTaXplcnMgKTsKCQkJCgkJCWlmICggby5uVEZvb3QgIT09IG51bGwgKQoJCQl7CgkJCQlfZm5BcHBseVRvQ2hpbGRyZW4oIGZ1bmN0aW9uKG5TaXplcikgewoJCQkJCW5TaXplci5pbm5lckhUTUwgPSAiIjsKCQkJCQluU2l6ZXIuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggYUFwcGxpZWQuc2hpZnQoKSApOwoJCQkJfSwgYW5Gb290U2l6ZXJzICk7CgkJCX0KCQkJCgkJCS8qIFNhbml0eSBjaGVjayB0aGF0IHRoZSB0YWJsZSBpcyBvZiBhIHNlbnNpYmxlIHdpZHRoLiBJZiBub3QgdGhlbiB3ZSBhcmUgZ29pbmcgdG8gZ2V0CgkJCSAqIG1pc2FsaWdubWVudCAtIHRyeSB0byBwcmV2ZW50IHRoaXMgYnkgbm90IGFsbG93aW5nIHRoZSB0YWJsZSB0byBzaHJpbmsgYmVsb3cgaXRzIG1pbiB3aWR0aAoJCQkgKi8KCQkJaWYgKCAkKG8ublRhYmxlKS5vdXRlcldpZHRoKCkgPCBpU2FuaXR5V2lkdGggKQoJCQl7CgkJCQkvKiBUaGUgbWluIHdpZHRoIGRlcGVuZHMgdXBvbiBpZiB3ZSBoYXZlIGEgdmVydGljYWwgc2Nyb2xsYmFyIHZpc2libGUgb3Igbm90ICovCgkJCQl2YXIgaUNvcnJlY3Rpb24gPSAoKG5TY3JvbGxCb2R5LnNjcm9sbEhlaWdodCA+IG5TY3JvbGxCb2R5Lm9mZnNldEhlaWdodCB8fCAKCQkJCQkkKG5TY3JvbGxCb2R5KS5jc3MoJ292ZXJmbG93LXknKSA9PSAic2Nyb2xsIikpID8KCQkJCQkJaVNhbml0eVdpZHRoK28ub1Njcm9sbC5pQmFyV2lkdGggOiBpU2FuaXR5V2lkdGg7CgkJCQkKCQkJCS8qIElFNi83IGFyZSBhIGxhdyB1bnRvIHRoZW1zZWx2ZXMuLi4gKi8KCQkJCWlmICggaWU2NyAmJiAoblNjcm9sbEJvZHkuc2Nyb2xsSGVpZ2h0ID4gCgkJCQkJblNjcm9sbEJvZHkub2Zmc2V0SGVpZ2h0IHx8ICQoblNjcm9sbEJvZHkpLmNzcygnb3ZlcmZsb3cteScpID09ICJzY3JvbGwiKSAgKQoJCQkJewoJCQkJCW8ublRhYmxlLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGlDb3JyZWN0aW9uLW8ub1Njcm9sbC5pQmFyV2lkdGggKTsKCQkJCX0KCQkJCQoJCQkJLyogQXBwbHkgdGhlIGNhbGN1bGF0ZWQgbWluaW11bSB3aWR0aCB0byB0aGUgdGFibGUgd3JhcHBlcnMgKi8KCQkJCW5TY3JvbGxCb2R5LnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGlDb3JyZWN0aW9uICk7CgkJCQluU2Nyb2xsSGVhZElubmVyLnBhcmVudE5vZGUuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggaUNvcnJlY3Rpb24gKTsKCQkJCQoJCQkJaWYgKCBvLm5URm9vdCAhPT0gbnVsbCApCgkJCQl7CgkJCQkJblNjcm9sbEZvb3RJbm5lci5wYXJlbnROb2RlLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGlDb3JyZWN0aW9uICk7CgkJCQl9CgkJCQkKCQkJCS8qIEFuZCBnaXZlIHRoZSB1c2VyIGEgd2FybmluZyB0aGF0IHdlJ3ZlIHN0b3BwZWQgdGhlIHRhYmxlIGdldHRpbmcgdG9vIHNtYWxsICovCgkJCQlpZiAoIG8ub1Njcm9sbC5zWCA9PT0gIiIgKQoJCQkJewoJCQkJCV9mbkxvZyggbywgMSwgIlRoZSB0YWJsZSBjYW5ub3QgZml0IGludG8gdGhlIGN1cnJlbnQgZWxlbWVudCB3aGljaCB3aWxsIGNhdXNlIGNvbHVtbiIrCgkJCQkJCSIgbWlzYWxpZ25tZW50LiBUaGUgdGFibGUgaGFzIGJlZW4gZHJhd24gYXQgaXRzIG1pbmltdW0gcG9zc2libGUgd2lkdGguIiApOwoJCQkJfQoJCQkJZWxzZSBpZiAoIG8ub1Njcm9sbC5zWElubmVyICE9PSAiIiApCgkJCQl7CgkJCQkJX2ZuTG9nKCBvLCAxLCAiVGhlIHRhYmxlIGNhbm5vdCBmaXQgaW50byB0aGUgY3VycmVudCBlbGVtZW50IHdoaWNoIHdpbGwgY2F1c2UgY29sdW1uIisKCQkJCQkJIiBtaXNhbGlnbm1lbnQuIEluY3JlYXNlIHRoZSBzU2Nyb2xsWElubmVyIHZhbHVlIG9yIHJlbW92ZSBpdCB0byBhbGxvdyBhdXRvbWF0aWMiKwoJCQkJCQkiIGNhbGN1bGF0aW9uIiApOwoJCQkJfQoJCQl9CgkJCWVsc2UKCQkJewoJCQkJblNjcm9sbEJvZHkuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggJzEwMCUnICk7CgkJCQluU2Nyb2xsSGVhZElubmVyLnBhcmVudE5vZGUuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggJzEwMCUnICk7CgkJCQkKCQkJCWlmICggby5uVEZvb3QgIT09IG51bGwgKQoJCQkJewoJCQkJCW5TY3JvbGxGb290SW5uZXIucGFyZW50Tm9kZS5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCAnMTAwJScgKTsKCQkJCX0KCQkJfQoJCQkKCQkJCgkJCS8qCgkJCSAqIDQuIENsZWFuIHVwCgkJCSAqLwoJCQlpZiAoIG8ub1Njcm9sbC5zWSA9PT0gIiIgKQoJCQl7CgkJCQkvKiBJRTc8IHB1dHMgYSB2ZXJ0aWNhbCBzY3JvbGxiYXIgaW4gcGxhY2UgKHdoZW4gaXQgc2hvdWxkbid0IGJlKSBkdWUgdG8gc3VidHJhY3RpbmcKCQkJCSAqIHRoZSBzY3JvbGxiYXIgaGVpZ2h0IGZyb20gdGhlIHZpc2libGUgZGlzcGxheSwgcmF0aGVyIHRoYW4gYWRkaW5nIGl0IG9uLiBXZSBuZWVkIHRvCgkJCQkgKiBzZXQgdGhlIGhlaWdodCBpbiBvcmRlciB0byBzb3J0IHRoaXMuIERvbid0IHdhbnQgdG8gZG8gaXQgaW4gYW55IG90aGVyIGJyb3dzZXJzLgoJCQkJICovCgkJCQlpZiAoIGllNjcgKQoJCQkJewoJCQkJCW5TY3JvbGxCb2R5LnN0eWxlLmhlaWdodCA9IF9mblN0cmluZ1RvQ3NzKCBvLm5UYWJsZS5vZmZzZXRIZWlnaHQrby5vU2Nyb2xsLmlCYXJXaWR0aCApOwoJCQkJfQoJCQl9CgkJCQoJCQlpZiAoIG8ub1Njcm9sbC5zWSAhPT0gIiIgJiYgby5vU2Nyb2xsLmJDb2xsYXBzZSApCgkJCXsKCQkJCW5TY3JvbGxCb2R5LnN0eWxlLmhlaWdodCA9IF9mblN0cmluZ1RvQ3NzKCBvLm9TY3JvbGwuc1kgKTsKCQkJCQoJCQkJdmFyIGlFeHRyYSA9IChvLm9TY3JvbGwuc1ggIT09ICIiICYmIG8ublRhYmxlLm9mZnNldFdpZHRoID4gblNjcm9sbEJvZHkub2Zmc2V0V2lkdGgpID8KCQkJCSAJby5vU2Nyb2xsLmlCYXJXaWR0aCA6IDA7CgkJCQlpZiAoIG8ublRhYmxlLm9mZnNldEhlaWdodCA8IG5TY3JvbGxCb2R5Lm9mZnNldEhlaWdodCApCgkJCQl7CgkJCQkJblNjcm9sbEJvZHkuc3R5bGUuaGVpZ2h0ID0gX2ZuU3RyaW5nVG9Dc3MoIG8ublRhYmxlLm9mZnNldEhlaWdodCtpRXh0cmEgKTsKCQkJCX0KCQkJfQoJCQkKCQkJLyogRmluYWxseSBzZXQgdGhlIHdpZHRoJ3Mgb2YgdGhlIGhlYWRlciBhbmQgZm9vdGVyIHRhYmxlcyAqLwoJCQl2YXIgaU91dGVyV2lkdGggPSAkKG8ublRhYmxlKS5vdXRlcldpZHRoKCk7CgkJCW5TY3JvbGxIZWFkVGFibGUuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggaU91dGVyV2lkdGggKTsKCQkJblNjcm9sbEhlYWRJbm5lci5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBpT3V0ZXJXaWR0aCApOwoJCQoJCQkvLyBGaWd1cmUgb3V0IGlmIHRoZXJlIGFyZSBzY3JvbGxiYXIgcHJlc2VudCAtIGlmIHNvIHRoZW4gd2UgbmVlZCBhIHRoZSBoZWFkZXIgYW5kIGZvb3RlciB0bwoJCQkvLyBwcm92aWRlIGEgYml0IG1vcmUgc3BhY2UgdG8gYWxsb3cgIm92ZXJmbG93IiBzY3JvbGxpbmcgKGkuZS4gcGFzdCB0aGUgc2Nyb2xsYmFyKQoJCQl2YXIgYlNjcm9sbGluZyA9ICQoby5uVGFibGUpLmhlaWdodCgpID4gblNjcm9sbEJvZHkuY2xpZW50SGVpZ2h0IHx8ICQoblNjcm9sbEJvZHkpLmNzcygnb3ZlcmZsb3cteScpID09ICJzY3JvbGwiOwoJCQluU2Nyb2xsSGVhZElubmVyLnN0eWxlLnBhZGRpbmdSaWdodCA9IGJTY3JvbGxpbmcgPyBvLm9TY3JvbGwuaUJhcldpZHRoKyJweCIgOiAiMHB4IjsKCQkJCgkJCWlmICggby5uVEZvb3QgIT09IG51bGwgKQoJCQl7CgkJCQluU2Nyb2xsRm9vdFRhYmxlLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGlPdXRlcldpZHRoICk7CgkJCQluU2Nyb2xsRm9vdElubmVyLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGlPdXRlcldpZHRoICk7CgkJCQluU2Nyb2xsRm9vdElubmVyLnN0eWxlLnBhZGRpbmdSaWdodCA9IGJTY3JvbGxpbmcgPyBvLm9TY3JvbGwuaUJhcldpZHRoKyJweCIgOiAiMHB4IjsKCQkJfQoJCQoJCQkvKiBBZGp1c3QgdGhlIHBvc2l0aW9uIG9mIHRoZSBoZWFkZXIgaW5jYXNlIHdlIGxvb3NlIHRoZSB5LXNjcm9sbGJhciAqLwoJCQkkKG5TY3JvbGxCb2R5KS5zY3JvbGwoKTsKCQkJCgkJCS8qIElmIHNvcnRpbmcgb3IgZmlsdGVyaW5nIGhhcyBvY2N1cnJlZCwganVtcCB0aGUgc2Nyb2xsaW5nIGJhY2sgdG8gdGhlIHRvcCAqLwoJCQlpZiAoIG8uYlNvcnRlZCB8fCBvLmJGaWx0ZXJlZCApCgkJCXsKCQkJCW5TY3JvbGxCb2R5LnNjcm9sbFRvcCA9IDA7CgkJCX0KCQl9CgkJCgkJCgkJLyoqCgkJICogQXBwbHkgYSBnaXZlbiBmdW5jdGlvbiB0byB0aGUgZGlzcGxheSBjaGlsZCBub2RlcyBvZiBhbiBlbGVtZW50IGFycmF5ICh0eXBpY2FsbHkKCQkgKiBURCBjaGlsZHJlbiBvZiBUUiByb3dzCgkJICogIEBwYXJhbSB7ZnVuY3Rpb259IGZuIE1ldGhvZCB0byBhcHBseSB0byB0aGUgb2JqZWN0cwoJCSAqICBAcGFyYW0gYXJyYXkge25vZGVzfSBhbjEgTGlzdCBvZiBlbGVtZW50cyB0byBsb29rIHRocm91Z2ggZm9yIGRpc3BsYXkgY2hpbGRyZW4KCQkgKiAgQHBhcmFtIGFycmF5IHtub2Rlc30gYW4yIEFub3RoZXIgbGlzdCAoaWRlbnRpY2FsIHN0cnVjdHVyZSB0byB0aGUgZmlyc3QpIC0gb3B0aW9uYWwKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuQXBwbHlUb0NoaWxkcmVuKCBmbiwgYW4xLCBhbjIgKQoJCXsKCQkJZm9yICggdmFyIGk9MCwgaUxlbj1hbjEubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJZm9yICggdmFyIGo9MCwgakxlbj1hbjFbaV0uY2hpbGROb2Rlcy5sZW5ndGggOyBqPGpMZW4gOyBqKysgKQoJCQkJewoJCQkJCWlmICggYW4xW2ldLmNoaWxkTm9kZXNbal0ubm9kZVR5cGUgPT0gMSApCgkJCQkJewoJCQkJCQlpZiAoIGFuMiApCgkJCQkJCXsKCQkJCQkJCWZuKCBhbjFbaV0uY2hpbGROb2Rlc1tqXSwgYW4yW2ldLmNoaWxkTm9kZXNbal0gKTsKCQkJCQkJfQoJCQkJCQllbHNlCgkJCQkJCXsKCQkJCQkJCWZuKCBhbjFbaV0uY2hpbGROb2Rlc1tqXSApOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoJCQoJCQoJCQoJCS8qKgoJCSAqIENvbnZlcnQgYSBDU1MgdW5pdCB3aWR0aCB0byBwaXhlbHMgKGUuZy4gMmVtKQoJCSAqICBAcGFyYW0ge3N0cmluZ30gc1dpZHRoIHdpZHRoIHRvIGJlIGNvbnZlcnRlZAoJCSAqICBAcGFyYW0ge25vZGV9IG5QYXJlbnQgcGFyZW50IHRvIGdldCB0aGUgd2l0aCBmb3IgKHJlcXVpcmVkIGZvciByZWxhdGl2ZSB3aWR0aHMpIC0gb3B0aW9uYWwKCQkgKiAgQHJldHVybnMge2ludH0gaVdpZHRoIHdpZHRoIGluIHBpeGVscwoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5Db252ZXJ0VG9XaWR0aCAoIHNXaWR0aCwgblBhcmVudCApCgkJewoJCQlpZiAoICFzV2lkdGggfHwgc1dpZHRoID09PSBudWxsIHx8IHNXaWR0aCA9PT0gJycgKQoJCQl7CgkJCQlyZXR1cm4gMDsKCQkJfQoJCQkKCQkJaWYgKCAhblBhcmVudCApCgkJCXsKCQkJCW5QYXJlbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnYm9keScpWzBdOwoJCQl9CgkJCQoJCQl2YXIgaVdpZHRoOwoJCQl2YXIgblRtcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICJkaXYiICk7CgkJCW5UbXAuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0Nzcyggc1dpZHRoICk7CgkJCQoJCQluUGFyZW50LmFwcGVuZENoaWxkKCBuVG1wICk7CgkJCWlXaWR0aCA9IG5UbXAub2Zmc2V0V2lkdGg7CgkJCW5QYXJlbnQucmVtb3ZlQ2hpbGQoIG5UbXAgKTsKCQkJCgkJCXJldHVybiAoIGlXaWR0aCApOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBDYWxjdWxhdGUgdGhlIHdpZHRoIG9mIGNvbHVtbnMgZm9yIHRoZSB0YWJsZQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkNhbGN1bGF0ZUNvbHVtbldpZHRocyAoIG9TZXR0aW5ncyApCgkJewoJCQl2YXIgaVRhYmxlV2lkdGggPSBvU2V0dGluZ3MublRhYmxlLm9mZnNldFdpZHRoOwoJCQl2YXIgaVVzZXJJbnB1dHMgPSAwOwoJCQl2YXIgaVRtcFdpZHRoOwoJCQl2YXIgaVZpc2libGVDb2x1bW5zID0gMDsKCQkJdmFyIGlDb2x1bXMgPSBvU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aDsKCQkJdmFyIGksIGlJbmRleCwgaUNvcnJlY3RvciwgaVdpZHRoOwoJCQl2YXIgb0hlYWRlcnMgPSAkKCd0aCcsIG9TZXR0aW5ncy5uVEhlYWQpOwoJCQl2YXIgd2lkdGhBdHRyID0gb1NldHRpbmdzLm5UYWJsZS5nZXRBdHRyaWJ1dGUoJ3dpZHRoJyk7CgkJCQoJCQkvKiBDb252ZXJ0IGFueSB1c2VyIGlucHV0IHNpemVzIGludG8gcGl4ZWwgc2l6ZXMgKi8KCQkJZm9yICggaT0wIDsgaTxpQ29sdW1zIDsgaSsrICkKCQkJewoJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLmJWaXNpYmxlICkKCQkJCXsKCQkJCQlpVmlzaWJsZUNvbHVtbnMrKzsKCQkJCQkKCQkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc1dpZHRoICE9PSBudWxsICkKCQkJCQl7CgkJCQkJCWlUbXBXaWR0aCA9IF9mbkNvbnZlcnRUb1dpZHRoKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNXaWR0aE9yaWcsIAoJCQkJCQkJb1NldHRpbmdzLm5UYWJsZS5wYXJlbnROb2RlICk7CgkJCQkJCWlmICggaVRtcFdpZHRoICE9PSBudWxsICkKCQkJCQkJewoJCQkJCQkJb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zV2lkdGggPSBfZm5TdHJpbmdUb0NzcyggaVRtcFdpZHRoICk7CgkJCQkJCX0KCQkJCQkJCQoJCQkJCQlpVXNlcklucHV0cysrOwoJCQkJCX0KCQkJCX0KCQkJfQoJCQkKCQkJLyogSWYgdGhlIG51bWJlciBvZiBjb2x1bW5zIGluIHRoZSBET00gZXF1YWxzIHRoZSBudW1iZXIgdGhhdCB3ZSBoYXZlIHRvIHByb2Nlc3MgaW4gCgkJCSAqIERhdGFUYWJsZXMsIHRoZW4gd2UgY2FuIHVzZSB0aGUgb2Zmc2V0cyB0aGF0IGFyZSBjcmVhdGVkIGJ5IHRoZSB3ZWItYnJvd3Nlci4gTm8gY3VzdG9tIAoJCQkgKiBzaXplcyBjYW4gYmUgc2V0IGluIG9yZGVyIGZvciB0aGlzIHRvIGhhcHBlbiwgbm9yIHNjcm9sbGluZyB1c2VkCgkJCSAqLwoJCQlpZiAoIGlDb2x1bXMgPT0gb0hlYWRlcnMubGVuZ3RoICYmIGlVc2VySW5wdXRzID09PSAwICYmIGlWaXNpYmxlQ29sdW1ucyA9PSBpQ29sdW1zICYmCgkJCQlvU2V0dGluZ3Mub1Njcm9sbC5zWCA9PT0gIiIgJiYgb1NldHRpbmdzLm9TY3JvbGwuc1kgPT09ICIiICkKCQkJewoJCQkJZm9yICggaT0wIDsgaTxvU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGkrKyApCgkJCQl7CgkJCQkJaVRtcFdpZHRoID0gJChvSGVhZGVyc1tpXSkud2lkdGgoKTsKCQkJCQlpZiAoIGlUbXBXaWR0aCAhPT0gbnVsbCApCgkJCQkJewoJCQkJCQlvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNXaWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBpVG1wV2lkdGggKTsKCQkJCQl9CgkJCQl9CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQkvKiBPdGhlcndpc2Ugd2UgYXJlIGdvaW5nIHRvIGhhdmUgdG8gZG8gc29tZSBjYWxjdWxhdGlvbnMgdG8gZ2V0IHRoZSB3aWR0aCBvZiBlYWNoIGNvbHVtbi4KCQkJCSAqIENvbnN0cnVjdCBhIDEgcm93IHRhYmxlIHdpdGggdGhlIHdpZGVzdCBub2RlIGluIHRoZSBkYXRhLCBhbmQgYW55IHVzZXIgZGVmaW5lZCB3aWR0aHMsCgkJCQkgKiB0aGVuIGluc2VydCBpdCBpbnRvIHRoZSBET00gYW5kIGFsbG93IHRoZSBicm93c2VyIHRvIGRvIGFsbCB0aGUgaGFyZCB3b3JrIG9mCgkJCQkgKiBjYWxjdWxhdGluZyB0YWJsZSB3aWR0aHMuCgkJCQkgKi8KCQkJCXZhcgoJCQkJCW5DYWxjVG1wID0gb1NldHRpbmdzLm5UYWJsZS5jbG9uZU5vZGUoIGZhbHNlICksCgkJCQkJblRoZWFkQ2xvbmUgPSBvU2V0dGluZ3MublRIZWFkLmNsb25lTm9kZSh0cnVlKSwKCQkJCQluQm9keSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICd0Ym9keScgKSwKCQkJCQluVHIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAndHInICksCgkJCQkJbkRpdlNpemluZzsKCQkJCQoJCQkJbkNhbGNUbXAucmVtb3ZlQXR0cmlidXRlKCAiaWQiICk7CgkJCQluQ2FsY1RtcC5hcHBlbmRDaGlsZCggblRoZWFkQ2xvbmUgKTsKCQkJCWlmICggb1NldHRpbmdzLm5URm9vdCAhPT0gbnVsbCApCgkJCQl7CgkJCQkJbkNhbGNUbXAuYXBwZW5kQ2hpbGQoIG9TZXR0aW5ncy5uVEZvb3QuY2xvbmVOb2RlKHRydWUpICk7CgkJCQkJX2ZuQXBwbHlUb0NoaWxkcmVuKCBmdW5jdGlvbihuKSB7CgkJCQkJCW4uc3R5bGUud2lkdGggPSAiIjsKCQkJCQl9LCBuQ2FsY1RtcC5nZXRFbGVtZW50c0J5VGFnTmFtZSgndHInKSApOwoJCQkJfQoJCQkJCgkJCQluQ2FsY1RtcC5hcHBlbmRDaGlsZCggbkJvZHkgKTsKCQkJCW5Cb2R5LmFwcGVuZENoaWxkKCBuVHIgKTsKCQkJCQoJCQkJLyogUmVtb3ZlIGFueSBzaXppbmcgdGhhdCB3YXMgcHJldmlvdXNseSBhcHBsaWVkIGJ5IHRoZSBzdHlsZXMgKi8KCQkJCXZhciBqcUNvbFNpemluZyA9ICQoJ3RoZWFkIHRoJywgbkNhbGNUbXApOwoJCQkJaWYgKCBqcUNvbFNpemluZy5sZW5ndGggPT09IDAgKQoJCQkJewoJCQkJCWpxQ29sU2l6aW5nID0gJCgndGJvZHkgdHI6ZXEoMCk+dGQnLCBuQ2FsY1RtcCk7CgkJCQl9CgkJCgkJCQkvKiBBcHBseSBjdXN0b20gc2l6aW5nIHRvIHRoZSBjbG9uZWQgaGVhZGVyICovCgkJCQl2YXIgblRocyA9IF9mbkdldFVuaXF1ZVRocyggb1NldHRpbmdzLCBuVGhlYWRDbG9uZSApOwoJCQkJaUNvcnJlY3RvciA9IDA7CgkJCQlmb3IgKCBpPTAgOyBpPGlDb2x1bXMgOyBpKysgKQoJCQkJewoJCQkJCXZhciBvQ29sdW1uID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpXTsKCQkJCQlpZiAoIG9Db2x1bW4uYlZpc2libGUgJiYgb0NvbHVtbi5zV2lkdGhPcmlnICE9PSBudWxsICYmIG9Db2x1bW4uc1dpZHRoT3JpZyAhPT0gIiIgKQoJCQkJCXsKCQkJCQkJblRoc1tpLWlDb3JyZWN0b3JdLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIG9Db2x1bW4uc1dpZHRoT3JpZyApOwoJCQkJCX0KCQkJCQllbHNlIGlmICggb0NvbHVtbi5iVmlzaWJsZSApCgkJCQkJewoJCQkJCQluVGhzW2ktaUNvcnJlY3Rvcl0uc3R5bGUud2lkdGggPSAiIjsKCQkJCQl9CgkJCQkJZWxzZQoJCQkJCXsKCQkJCQkJaUNvcnJlY3RvcisrOwoJCQkJCX0KCQkJCX0KCQkKCQkJCS8qIEZpbmQgdGhlIGJpZ2dlc3QgdGQgZm9yIGVhY2ggY29sdW1uIGFuZCBwdXQgaXQgaW50byB0aGUgdGFibGUgKi8KCQkJCWZvciAoIGk9MCA7IGk8aUNvbHVtcyA7IGkrKyApCgkJCQl7CgkJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLmJWaXNpYmxlICkKCQkJCQl7CgkJCQkJCXZhciBuVGQgPSBfZm5HZXRXaWRlc3ROb2RlKCBvU2V0dGluZ3MsIGkgKTsKCQkJCQkJaWYgKCBuVGQgIT09IG51bGwgKQoJCQkJCQl7CgkJCQkJCQluVGQgPSBuVGQuY2xvbmVOb2RlKHRydWUpOwoJCQkJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNDb250ZW50UGFkZGluZyAhPT0gIiIgKQoJCQkJCQkJewoJCQkJCQkJCW5UZC5pbm5lckhUTUwgKz0gb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zQ29udGVudFBhZGRpbmc7CgkJCQkJCQl9CgkJCQkJCQluVHIuYXBwZW5kQ2hpbGQoIG5UZCApOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQkJCgkJCQkvKiBCdWlsZCB0aGUgdGFibGUgYW5kICdkaXNwbGF5JyBpdCAqLwoJCQkJdmFyIG5XcmFwcGVyID0gb1NldHRpbmdzLm5UYWJsZS5wYXJlbnROb2RlOwoJCQkJbldyYXBwZXIuYXBwZW5kQ2hpbGQoIG5DYWxjVG1wICk7CgkJCQkKCQkJCS8qIFdoZW4gc2Nyb2xsaW5nIChYIG9yIFkpIHdlIHdhbnQgdG8gc2V0IHRoZSB3aWR0aCBvZiB0aGUgdGFibGUgYXMgYXBwcm9wcmlhdGUuIEhvd2V2ZXIsCgkJCQkgKiB3aGVuIG5vdCBzY3JvbGxpbmcgbGVhdmUgdGhlIHRhYmxlIHdpZHRoIGFzIGl0IGlzLiBUaGlzIHJlc3VsdHMgaW4gc2xpZ2h0bHkgZGlmZmVyZW50LAoJCQkJICogYnV0IEkgdGhpbmsgY29ycmVjdCBiZWhhdmlvdXIKCQkJCSAqLwoJCQkJaWYgKCBvU2V0dGluZ3Mub1Njcm9sbC5zWCAhPT0gIiIgJiYgb1NldHRpbmdzLm9TY3JvbGwuc1hJbm5lciAhPT0gIiIgKQoJCQkJewoJCQkJCW5DYWxjVG1wLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3Mob1NldHRpbmdzLm9TY3JvbGwuc1hJbm5lcik7CgkJCQl9CgkJCQllbHNlIGlmICggb1NldHRpbmdzLm9TY3JvbGwuc1ggIT09ICIiICkKCQkJCXsKCQkJCQluQ2FsY1RtcC5zdHlsZS53aWR0aCA9ICIiOwoJCQkJCWlmICggJChuQ2FsY1RtcCkud2lkdGgoKSA8IG5XcmFwcGVyLm9mZnNldFdpZHRoICkKCQkJCQl7CgkJCQkJCW5DYWxjVG1wLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIG5XcmFwcGVyLm9mZnNldFdpZHRoICk7CgkJCQkJfQoJCQkJfQoJCQkJZWxzZSBpZiAoIG9TZXR0aW5ncy5vU2Nyb2xsLnNZICE9PSAiIiApCgkJCQl7CgkJCQkJbkNhbGNUbXAuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggbldyYXBwZXIub2Zmc2V0V2lkdGggKTsKCQkJCX0KCQkJCWVsc2UgaWYgKCB3aWR0aEF0dHIgKQoJCQkJewoJCQkJCW5DYWxjVG1wLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIHdpZHRoQXR0ciApOwoJCQkJfQoJCQkJbkNhbGNUbXAuc3R5bGUudmlzaWJpbGl0eSA9ICJoaWRkZW4iOwoJCQkJCgkJCQkvKiBTY3JvbGxpbmcgY29uc2lkZXJhdGlvbnMgKi8KCQkJCV9mblNjcm9sbGluZ1dpZHRoQWRqdXN0KCBvU2V0dGluZ3MsIG5DYWxjVG1wICk7CgkJCQkKCQkJCS8qIFJlYWQgdGhlIHdpZHRoJ3MgY2FsY3VsYXRlZCBieSB0aGUgYnJvd3NlciBhbmQgc3RvcmUgdGhlbSBmb3IgdXNlIGJ5IHRoZSBjYWxsZXIuIFdlCgkJCQkgKiBmaXJzdCBvZiBhbGwgdHJ5IHRvIHVzZSB0aGUgZWxlbWVudHMgaW4gdGhlIGJvZHksIGJ1dCBpdCBpcyBwb3NzaWJsZSB0aGF0IHRoZXJlIGFyZQoJCQkJICogbm8gZWxlbWVudHMgdGhlcmUsIHVuZGVyIHdoaWNoIGNpcmN1bXN0YW5jZXMgd2UgdXNlIHRoZSBoZWFkZXIgZWxlbWVudHMKCQkJCSAqLwoJCQkJdmFyIG9Ob2RlcyA9ICQoInRib2R5IHRyOmVxKDApIiwgbkNhbGNUbXApLmNoaWxkcmVuKCk7CgkJCQlpZiAoIG9Ob2Rlcy5sZW5ndGggPT09IDAgKQoJCQkJewoJCQkJCW9Ob2RlcyA9IF9mbkdldFVuaXF1ZVRocyggb1NldHRpbmdzLCAkKCd0aGVhZCcsIG5DYWxjVG1wKVswXSApOwoJCQkJfQoJCQoJCQkJLyogQnJvd3NlcnMgbmVlZCBhIGJpdCBvZiBhIGhhbmQgd2hlbiBhIHdpZHRoIGlzIGFzc2lnbmVkIHRvIGFueSBjb2x1bW5zIHdoZW4gCgkJCQkgKiB4LXNjcm9sbGluZyBhcyB0aGV5IHRlbmQgdG8gY29sbGFwc2UgdGhlIHRhYmxlIHRvIHRoZSBtaW4td2lkdGgsIGV2ZW4gaWYKCQkJCSAqIHdlIHNlbnQgdGhlIGNvbHVtbiB3aWR0aHMuIFNvIHdlIG5lZWQgdG8ga2VlcCB0cmFjayBvZiB3aGF0IHRoZSB0YWJsZSB3aWR0aAoJCQkJICogc2hvdWxkIGJlIGJ5IHN1bW1pbmcgdGhlIHVzZXIgZ2l2ZW4gdmFsdWVzLCBhbmQgdGhlIGF1dG9tYXRpYyB2YWx1ZXMKCQkJCSAqLwoJCQkJaWYgKCBvU2V0dGluZ3Mub1Njcm9sbC5zWCAhPT0gIiIgKQoJCQkJewoJCQkJCXZhciBpVG90YWwgPSAwOwoJCQkJCWlDb3JyZWN0b3IgPSAwOwoJCQkJCWZvciAoIGk9MCA7IGk8b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpKysgKQoJCQkJCXsKCQkJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLmJWaXNpYmxlICkKCQkJCQkJewoJCQkJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNXaWR0aE9yaWcgPT09IG51bGwgKQoJCQkJCQkJewoJCQkJCQkJCWlUb3RhbCArPSAkKG9Ob2Rlc1tpQ29ycmVjdG9yXSkub3V0ZXJXaWR0aCgpOwoJCQkJCQkJfQoJCQkJCQkJZWxzZQoJCQkJCQkJewoJCQkJCQkJCWlUb3RhbCArPSBwYXJzZUludChvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNXaWR0aC5yZXBsYWNlKCdweCcsJycpLCAxMCkgKwoJCQkJCQkJCQkoJChvTm9kZXNbaUNvcnJlY3Rvcl0pLm91dGVyV2lkdGgoKSAtICQob05vZGVzW2lDb3JyZWN0b3JdKS53aWR0aCgpKTsKCQkJCQkJCX0KCQkJCQkJCWlDb3JyZWN0b3IrKzsKCQkJCQkJfQoJCQkJCX0KCQkJCQkKCQkJCQluQ2FsY1RtcC5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBpVG90YWwgKTsKCQkJCQlvU2V0dGluZ3MublRhYmxlLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGlUb3RhbCApOwoJCQkJfQoJCQoJCQkJaUNvcnJlY3RvciA9IDA7CgkJCQlmb3IgKCBpPTAgOyBpPG9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaSsrICkKCQkJCXsKCQkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uYlZpc2libGUgKQoJCQkJCXsKCQkJCQkJaVdpZHRoID0gJChvTm9kZXNbaUNvcnJlY3Rvcl0pLndpZHRoKCk7CgkJCQkJCWlmICggaVdpZHRoICE9PSBudWxsICYmIGlXaWR0aCA+IDAgKQoJCQkJCQl7CgkJCQkJCQlvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNXaWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBpV2lkdGggKTsKCQkJCQkJfQoJCQkJCQlpQ29ycmVjdG9yKys7CgkJCQkJfQoJCQkJfQoJCQoJCQkJdmFyIGNzc1dpZHRoID0gJChuQ2FsY1RtcCkuY3NzKCd3aWR0aCcpOwoJCQkJb1NldHRpbmdzLm5UYWJsZS5zdHlsZS53aWR0aCA9IChjc3NXaWR0aC5pbmRleE9mKCclJykgIT09IC0xKSA/CgkJCQkgICAgY3NzV2lkdGggOiBfZm5TdHJpbmdUb0NzcyggJChuQ2FsY1RtcCkub3V0ZXJXaWR0aCgpICk7CgkJCQluQ2FsY1RtcC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKCBuQ2FsY1RtcCApOwoJCQl9CgkJCgkJCWlmICggd2lkdGhBdHRyICkKCQkJewoJCQkJb1NldHRpbmdzLm5UYWJsZS5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCB3aWR0aEF0dHIgKTsKCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBBZGp1c3QgYSB0YWJsZSdzIHdpZHRoIHRvIHRha2UgYWNjb3VudCBvZiBzY3JvbGxpbmcKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge25vZGV9IG4gdGFibGUgbm9kZQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5TY3JvbGxpbmdXaWR0aEFkanVzdCAoIG9TZXR0aW5ncywgbiApCgkJewoJCQlpZiAoIG9TZXR0aW5ncy5vU2Nyb2xsLnNYID09PSAiIiAmJiBvU2V0dGluZ3Mub1Njcm9sbC5zWSAhPT0gIiIgKQoJCQl7CgkJCQkvKiBXaGVuIHktc2Nyb2xsaW5nIG9ubHksIHdlIHdhbnQgdG8gcmVtb3ZlIHRoZSB3aWR0aCBvZiB0aGUgc2Nyb2xsIGJhciBzbyB0aGUgdGFibGUKCQkJCSAqICsgc2Nyb2xsIGJhciB3aWxsIGZpdCBpbnRvIHRoZSBhcmVhIGF2YWlhbGJsZS4KCQkJCSAqLwoJCQkJdmFyIGlPcmlnV2lkdGggPSAkKG4pLndpZHRoKCk7CgkJCQluLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoICQobikub3V0ZXJXaWR0aCgpLW9TZXR0aW5ncy5vU2Nyb2xsLmlCYXJXaWR0aCApOwoJCQl9CgkJCWVsc2UgaWYgKCBvU2V0dGluZ3Mub1Njcm9sbC5zWCAhPT0gIiIgKQoJCQl7CgkJCQkvKiBXaGVuIHgtc2Nyb2xsaW5nIGJvdGggd2F5cywgZml4IHRoZSB0YWJsZSBhdCBpdCdzIGN1cnJlbnQgc2l6ZSwgd2l0aG91dCBhZGp1c3RpbmcgKi8KCQkJCW4uc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggJChuKS5vdXRlcldpZHRoKCkgKTsKCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBHZXQgdGhlIHdpZGVzdCBub2RlCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtpbnR9IGlDb2wgY29sdW1uIG9mIGludGVyZXN0CgkJICogIEByZXR1cm5zIHtzdHJpbmd9IG1heCBzdHJsZW5zIGZvciBlYWNoIGNvbHVtbgoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5HZXRXaWRlc3ROb2RlKCBvU2V0dGluZ3MsIGlDb2wgKQoJCXsKCQkJdmFyIGlNYXhJbmRleCA9IF9mbkdldE1heExlblN0cmluZyggb1NldHRpbmdzLCBpQ29sICk7CgkJCWlmICggaU1heEluZGV4IDwgMCApCgkJCXsKCQkJCXJldHVybiBudWxsOwoJCQl9CgkJCgkJCWlmICggb1NldHRpbmdzLmFvRGF0YVtpTWF4SW5kZXhdLm5UciA9PT0gbnVsbCApCgkJCXsKCQkJCXZhciBuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTsKCQkJCW4uaW5uZXJIVE1MID0gX2ZuR2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaU1heEluZGV4LCBpQ29sLCAnJyApOwoJCQkJcmV0dXJuIG47CgkJCX0KCQkJcmV0dXJuIF9mbkdldFRkTm9kZXMob1NldHRpbmdzLCBpTWF4SW5kZXgpW2lDb2xdOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBHZXQgdGhlIG1heGltdW0gc3RybGVuIGZvciBlYWNoIGRhdGEgY29sdW1uCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtpbnR9IGlDb2wgY29sdW1uIG9mIGludGVyZXN0CgkJICogIEByZXR1cm5zIHtzdHJpbmd9IG1heCBzdHJsZW5zIGZvciBlYWNoIGNvbHVtbgoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5HZXRNYXhMZW5TdHJpbmcoIG9TZXR0aW5ncywgaUNvbCApCgkJewoJCQl2YXIgaU1heCA9IC0xOwoJCQl2YXIgaU1heEluZGV4ID0gLTE7CgkJCQoJCQlmb3IgKCB2YXIgaT0wIDsgaTxvU2V0dGluZ3MuYW9EYXRhLmxlbmd0aCA7IGkrKyApCgkJCXsKCQkJCXZhciBzID0gX2ZuR2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaSwgaUNvbCwgJ2Rpc3BsYXknICkrIiI7CgkJCQlzID0gcy5yZXBsYWNlKCAvPC4qPz4vZywgIiIgKTsKCQkJCWlmICggcy5sZW5ndGggPiBpTWF4ICkKCQkJCXsKCQkJCQlpTWF4ID0gcy5sZW5ndGg7CgkJCQkJaU1heEluZGV4ID0gaTsKCQkJCX0KCQkJfQoJCQkKCQkJcmV0dXJuIGlNYXhJbmRleDsKCQl9CgkJCgkJCgkJLyoqCgkJICogQXBwZW5kIGEgQ1NTIHVuaXQgKG9ubHkgaWYgcmVxdWlyZWQpIHRvIGEgc3RyaW5nCgkJICogIEBwYXJhbSB7YXJyYXl9IGFBcnJheTEgZmlyc3QgYXJyYXkKCQkgKiAgQHBhcmFtIHthcnJheX0gYUFycmF5MiBzZWNvbmQgYXJyYXkKCQkgKiAgQHJldHVybnMge2ludH0gMCBpZiBtYXRjaCwgMSBpZiBsZW5ndGggaXMgZGlmZmVyZW50LCAyIGlmIG5vIG1hdGNoCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblN0cmluZ1RvQ3NzKCBzICkKCQl7CgkJCWlmICggcyA9PT0gbnVsbCApCgkJCXsKCQkJCXJldHVybiAiMHB4IjsKCQkJfQoJCQkKCQkJaWYgKCB0eXBlb2YgcyA9PSAnbnVtYmVyJyApCgkJCXsKCQkJCWlmICggcyA8IDAgKQoJCQkJewoJCQkJCXJldHVybiAiMHB4IjsKCQkJCX0KCQkJCXJldHVybiBzKyJweCI7CgkJCX0KCQkJCgkJCS8qIENoZWNrIGlmIHRoZSBsYXN0IGNoYXJhY3RlciBpcyBub3QgMC05ICovCgkJCXZhciBjID0gcy5jaGFyQ29kZUF0KCBzLmxlbmd0aC0xICk7CgkJCWlmIChjIDwgMHgzMCB8fCBjID4gMHgzOSkKCQkJewoJCQkJcmV0dXJuIHM7CgkJCX0KCQkJcmV0dXJuIHMrInB4IjsKCQl9CgkJCgkJCgkJLyoqCgkJICogR2V0IHRoZSB3aWR0aCBvZiBhIHNjcm9sbCBiYXIgaW4gdGhpcyBicm93c2VyIGJlaW5nIHVzZWQKCQkgKiAgQHJldHVybnMge2ludH0gd2lkdGggaW4gcGl4ZWxzCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblNjcm9sbEJhcldpZHRoICgpCgkJeyAgCgkJCXZhciBpbm5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTsKCQkJdmFyIHN0eWxlID0gaW5uZXIuc3R5bGU7CgkJCXN0eWxlLndpZHRoID0gIjEwMCUiOwoJCQlzdHlsZS5oZWlnaHQgPSAiMjAwcHgiOwoJCQlzdHlsZS5wYWRkaW5nID0gIjBweCI7CgkJCQoJCQl2YXIgb3V0ZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKCQkJc3R5bGUgPSBvdXRlci5zdHlsZTsKCQkJc3R5bGUucG9zaXRpb24gPSAiYWJzb2x1dGUiOwoJCQlzdHlsZS50b3AgPSAiMHB4IjsKCQkJc3R5bGUubGVmdCA9ICIwcHgiOwoJCQlzdHlsZS52aXNpYmlsaXR5ID0gImhpZGRlbiI7CgkJCXN0eWxlLndpZHRoID0gIjIwMHB4IjsKCQkJc3R5bGUuaGVpZ2h0ID0gIjE1MHB4IjsKCQkJc3R5bGUucGFkZGluZyA9ICIwcHgiOwoJCQlzdHlsZS5vdmVyZmxvdyA9ICJoaWRkZW4iOwoJCQlvdXRlci5hcHBlbmRDaGlsZChpbm5lcik7CgkJCQoJCQlkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKG91dGVyKTsKCQkJdmFyIHcxID0gaW5uZXIub2Zmc2V0V2lkdGg7CgkJCW91dGVyLnN0eWxlLm92ZXJmbG93ID0gJ3Njcm9sbCc7CgkJCXZhciB3MiA9IGlubmVyLm9mZnNldFdpZHRoOwoJCQlpZiAoIHcxID09IHcyICkKCQkJewoJCQkJdzIgPSBvdXRlci5jbGllbnRXaWR0aDsKCQkJfQoJCQkKCQkJZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChvdXRlcik7CgkJCXJldHVybiAodzEgLSB3Mik7ICAKCQl9CgkJCgkJCgkJCgkJLyoqCgkJICogQ2hhbmdlIHRoZSBvcmRlciBvZiB0aGUgdGFibGUKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge2Jvb2x9IGJBcHBseUNsYXNzZXMgb3B0aW9uYWwgLSBzaG91bGQgd2UgYXBwbHkgY2xhc3NlcyBvciBub3QKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuU29ydCAoIG9TZXR0aW5ncywgYkFwcGx5Q2xhc3NlcyApCgkJewoJCQl2YXIKCQkJCWksIGlMZW4sIGosIGpMZW4sIGssIGtMZW4sCgkJCQlzRGF0YVR5cGUsIG5UaCwKCQkJCWFhU29ydCA9IFtdLAoJCQkgCWFpT3JpZyA9IFtdLAoJCQkJb1NvcnQgPSBEYXRhVGFibGUuZXh0Lm9Tb3J0LAoJCQkJYW9EYXRhID0gb1NldHRpbmdzLmFvRGF0YSwKCQkJCWFvQ29sdW1ucyA9IG9TZXR0aW5ncy5hb0NvbHVtbnMsCgkJCQlvQXJpYSA9IG9TZXR0aW5ncy5vTGFuZ3VhZ2Uub0FyaWE7CgkJCQoJCQkvKiBObyBzb3J0aW5nIHJlcXVpcmVkIGlmIHNlcnZlci1zaWRlIG9yIG5vIHNvcnRpbmcgYXJyYXkgKi8KCQkJaWYgKCAhb1NldHRpbmdzLm9GZWF0dXJlcy5iU2VydmVyU2lkZSAmJiAKCQkJCShvU2V0dGluZ3MuYWFTb3J0aW5nLmxlbmd0aCAhPT0gMCB8fCBvU2V0dGluZ3MuYWFTb3J0aW5nRml4ZWQgIT09IG51bGwpICkKCQkJewoJCQkJYWFTb3J0ID0gKCBvU2V0dGluZ3MuYWFTb3J0aW5nRml4ZWQgIT09IG51bGwgKSA/CgkJCQkJb1NldHRpbmdzLmFhU29ydGluZ0ZpeGVkLmNvbmNhdCggb1NldHRpbmdzLmFhU29ydGluZyApIDoKCQkJCQlvU2V0dGluZ3MuYWFTb3J0aW5nLnNsaWNlKCk7CgkJCQkKCQkJCS8qIElmIHRoZXJlIGlzIGEgc29ydGluZyBkYXRhIHR5cGUsIGFuZCBhIGZ1Y3Rpb24gYmVsb25naW5nIHRvIGl0LCB0aGVuIHdlIG5lZWQgdG8KCQkJCSAqIGdldCB0aGUgZGF0YSBmcm9tIHRoZSBkZXZlbG9wZXIncyBmdW5jdGlvbiBhbmQgYXBwbHkgaXQgZm9yIHRoaXMgY29sdW1uCgkJCQkgKi8KCQkJCWZvciAoIGk9MCA7IGk8YWFTb3J0Lmxlbmd0aCA7IGkrKyApCgkJCQl7CgkJCQkJdmFyIGlDb2x1bW4gPSBhYVNvcnRbaV1bMF07CgkJCQkJdmFyIGlWaXNDb2x1bW4gPSBfZm5Db2x1bW5JbmRleFRvVmlzaWJsZSggb1NldHRpbmdzLCBpQ29sdW1uICk7CgkJCQkJc0RhdGFUeXBlID0gb1NldHRpbmdzLmFvQ29sdW1uc1sgaUNvbHVtbiBdLnNTb3J0RGF0YVR5cGU7CgkJCQkJaWYgKCBEYXRhVGFibGUuZXh0LmFmblNvcnREYXRhW3NEYXRhVHlwZV0gKQoJCQkJCXsKCQkJCQkJdmFyIGFEYXRhID0gRGF0YVRhYmxlLmV4dC5hZm5Tb3J0RGF0YVtzRGF0YVR5cGVdLmNhbGwoIAoJCQkJCQkJb1NldHRpbmdzLm9JbnN0YW5jZSwgb1NldHRpbmdzLCBpQ29sdW1uLCBpVmlzQ29sdW1uCgkJCQkJCSk7CgkJCQkJCWlmICggYURhdGEubGVuZ3RoID09PSBhb0RhdGEubGVuZ3RoICkKCQkJCQkJewoJCQkJCQkJZm9yICggaj0wLCBqTGVuPWFvRGF0YS5sZW5ndGggOyBqPGpMZW4gOyBqKysgKQoJCQkJCQkJewoJCQkJCQkJCV9mblNldENlbGxEYXRhKCBvU2V0dGluZ3MsIGosIGlDb2x1bW4sIGFEYXRhW2pdICk7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJZWxzZQoJCQkJCQl7CgkJCQkJCQlfZm5Mb2coIG9TZXR0aW5ncywgMCwgIlJldHVybmVkIGRhdGEgc29ydCBhcnJheSAoY29sICIraUNvbHVtbisiKSBpcyB0aGUgd3JvbmcgbGVuZ3RoIiApOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQkJCgkJCQkvKiBDcmVhdGUgYSB2YWx1ZSAtIGtleSBhcnJheSBvZiB0aGUgY3VycmVudCByb3cgcG9zaXRpb25zIHN1Y2ggdGhhdCB3ZSBjYW4gdXNlIHRoZWlyCgkJCQkgKiBjdXJyZW50IHBvc2l0aW9uIGR1cmluZyB0aGUgc29ydCwgaWYgdmFsdWVzIG1hdGNoLCBpbiBvcmRlciB0byBwZXJmb3JtIHN0YWJsZSBzb3J0aW5nCgkJCQkgKi8KCQkJCWZvciAoIGk9MCwgaUxlbj1vU2V0dGluZ3MuYWlEaXNwbGF5TWFzdGVyLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJYWlPcmlnWyBvU2V0dGluZ3MuYWlEaXNwbGF5TWFzdGVyW2ldIF0gPSBpOwoJCQkJfQoJCQoJCQkJLyogQnVpbGQgYW4gaW50ZXJuYWwgZGF0YSBhcnJheSB3aGljaCBpcyBzcGVjaWZpYyB0byB0aGUgc29ydCwgc28gd2UgY2FuIGdldCBhbmQgcHJlcAoJCQkJICogdGhlIGRhdGEgdG8gYmUgc29ydGVkIG9ubHkgb25jZSwgcmF0aGVyIHRoYW4gbmVlZGluZyB0byBkbyBpdCBldmVyeSB0aW1lIHRoZSBzb3J0aW5nCgkJCQkgKiBmdW5jdGlvbiBydW5zLiBUaGlzIG1ha2UgdGhlIHNvcnRpbmcgZnVuY3Rpb24gYSB2ZXJ5IHNpbXBsZSBjb21wYXJpc29uCgkJCQkgKi8KCQkJCXZhciBpU29ydExlbiA9IGFhU29ydC5sZW5ndGg7CgkJCQl2YXIgZm5Tb3J0Rm9ybWF0LCBhRGF0YVNvcnQ7CgkJCQlmb3IgKCBpPTAsIGlMZW49YW9EYXRhLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJZm9yICggaj0wIDsgajxpU29ydExlbiA7IGorKyApCgkJCQkJewoJCQkJCQlhRGF0YVNvcnQgPSBhb0NvbHVtbnNbIGFhU29ydFtqXVswXSBdLmFEYXRhU29ydDsKCQkKCQkJCQkJZm9yICggaz0wLCBrTGVuPWFEYXRhU29ydC5sZW5ndGggOyBrPGtMZW4gOyBrKysgKQoJCQkJCQl7CgkJCQkJCQlzRGF0YVR5cGUgPSBhb0NvbHVtbnNbIGFEYXRhU29ydFtrXSBdLnNUeXBlOwoJCQkJCQkJZm5Tb3J0Rm9ybWF0ID0gb1NvcnRbIChzRGF0YVR5cGUgPyBzRGF0YVR5cGUgOiAnc3RyaW5nJykrIi1wcmUiIF07CgkJCQkJCQkKCQkJCQkJCWFvRGF0YVtpXS5fYVNvcnREYXRhWyBhRGF0YVNvcnRba10gXSA9IGZuU29ydEZvcm1hdCA/CgkJCQkJCQkJZm5Tb3J0Rm9ybWF0KCBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpLCBhRGF0YVNvcnRba10sICdzb3J0JyApICkgOgoJCQkJCQkJCV9mbkdldENlbGxEYXRhKCBvU2V0dGluZ3MsIGksIGFEYXRhU29ydFtrXSwgJ3NvcnQnICk7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCQkKCQkJCS8qIERvIHRoZSBzb3J0IC0gaGVyZSB3ZSB3YW50IG11bHRpLWNvbHVtbiBzb3J0aW5nIGJhc2VkIG9uIGEgZ2l2ZW4gZGF0YSBzb3VyY2UgKGNvbHVtbikKCQkJCSAqIGFuZCBzb3J0aW5nIGZ1bmN0aW9uIChmcm9tIG9Tb3J0KSBpbiBhIGNlcnRhaW4gZGlyZWN0aW9uLiBJdCdzIHJlYXNvbmFibHkgY29tcGxleCB0bwoJCQkJICogZm9sbG93IG9uIGl0J3Mgb3duLCBidXQgdGhpcyBpcyB3aGF0IHdlIHdhbnQgKGV4YW1wbGUgdHdvIGNvbHVtbiBzb3J0aW5nKToKCQkJCSAqICBmbkxvY2FsU29ydGluZyA9IGZ1bmN0aW9uKGEsYil7CgkJCQkgKiAgCXZhciBpVGVzdDsKCQkJCSAqICAJaVRlc3QgPSBvU29ydFsnc3RyaW5nLWFzYyddKCdkYXRhMTEnLCAnZGF0YTEyJyk7CgkJCQkgKiAgCWlmIChpVGVzdCAhPT0gMCkKCQkJCSAqICAJCXJldHVybiBpVGVzdDsKCQkJCSAqICAgIGlUZXN0ID0gb1NvcnRbJ251bWVyaWMtZGVzYyddKCdkYXRhMjEnLCAnZGF0YTIyJyk7CgkJCQkgKiAgICBpZiAoaVRlc3QgIT09IDApCgkJCQkgKiAgCQlyZXR1cm4gaVRlc3Q7CgkJCQkgKiAgCXJldHVybiBvU29ydFsnbnVtZXJpYy1hc2MnXSggYWlPcmlnW2FdLCBhaU9yaWdbYl0gKTsKCQkJCSAqICB9CgkJCQkgKiBCYXNpY2FsbHkgd2UgaGF2ZSBhIHRlc3QgZm9yIGVhY2ggc29ydGluZyBjb2x1bW4sIGlmIHRoZSBkYXRhIGluIHRoYXQgY29sdW1uIGlzIGVxdWFsLAoJCQkJICogdGVzdCB0aGUgbmV4dCBjb2x1bW4uIElmIGFsbCBjb2x1bW5zIG1hdGNoLCB0aGVuIHdlIHVzZSBhIG51bWVyaWMgc29ydCBvbiB0aGUgcm93IAoJCQkJICogcG9zaXRpb25zIGluIHRoZSBvcmlnaW5hbCBkYXRhIGFycmF5IHRvIHByb3ZpZGUgYSBzdGFibGUgc29ydC4KCQkJCSAqLwoJCQkJb1NldHRpbmdzLmFpRGlzcGxheU1hc3Rlci5zb3J0KCBmdW5jdGlvbiAoIGEsIGIgKSB7CgkJCQkJdmFyIGssIGwsIGxMZW4sIGlUZXN0LCBhRGF0YVNvcnQsIHNEYXRhVHlwZTsKCQkJCQlmb3IgKCBrPTAgOyBrPGlTb3J0TGVuIDsgaysrICkKCQkJCQl7CgkJCQkJCWFEYXRhU29ydCA9IGFvQ29sdW1uc1sgYWFTb3J0W2tdWzBdIF0uYURhdGFTb3J0OwoJCQoJCQkJCQlmb3IgKCBsPTAsIGxMZW49YURhdGFTb3J0Lmxlbmd0aCA7IGw8bExlbiA7IGwrKyApCgkJCQkJCXsKCQkJCQkJCXNEYXRhVHlwZSA9IGFvQ29sdW1uc1sgYURhdGFTb3J0W2xdIF0uc1R5cGU7CgkJCQkJCQkKCQkJCQkJCWlUZXN0ID0gb1NvcnRbIChzRGF0YVR5cGUgPyBzRGF0YVR5cGUgOiAnc3RyaW5nJykrIi0iK2FhU29ydFtrXVsxXSBdKAoJCQkJCQkJCWFvRGF0YVthXS5fYVNvcnREYXRhWyBhRGF0YVNvcnRbbF0gXSwKCQkJCQkJCQlhb0RhdGFbYl0uX2FTb3J0RGF0YVsgYURhdGFTb3J0W2xdIF0KCQkJCQkJCSk7CgkJCQkJCQoJCQkJCQkJaWYgKCBpVGVzdCAhPT0gMCApCgkJCQkJCQl7CgkJCQkJCQkJcmV0dXJuIGlUZXN0OwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoJCQkJCQoJCQkJCXJldHVybiBvU29ydFsnbnVtZXJpYy1hc2MnXSggYWlPcmlnW2FdLCBhaU9yaWdbYl0gKTsKCQkJCX0gKTsKCQkJfQoJCQkKCQkJLyogQWx0ZXIgdGhlIHNvcnRpbmcgY2xhc3NlcyB0byB0YWtlIGFjY291bnQgb2YgdGhlIGNoYW5nZXMgKi8KCQkJaWYgKCAoYkFwcGx5Q2xhc3NlcyA9PT0gdW5kZWZpbmVkIHx8IGJBcHBseUNsYXNzZXMpICYmICFvU2V0dGluZ3Mub0ZlYXR1cmVzLmJEZWZlclJlbmRlciApCgkJCXsKCQkJCV9mblNvcnRpbmdDbGFzc2VzKCBvU2V0dGluZ3MgKTsKCQkJfQoJCQoJCQlmb3IgKCBpPTAsIGlMZW49b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQl2YXIgc1RpdGxlID0gYW9Db2x1bW5zW2ldLnNUaXRsZS5yZXBsYWNlKCAvPC4qPz4vZywgIiIgKTsKCQkJCW5UaCA9IGFvQ29sdW1uc1tpXS5uVGg7CgkJCQluVGgucmVtb3ZlQXR0cmlidXRlKCdhcmlhLXNvcnQnKTsKCQkJCW5UaC5yZW1vdmVBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnKTsKCQkJCQoJCQkJLyogSW4gQVJJQSBvbmx5IHRoZSBmaXJzdCBzb3J0aW5nIGNvbHVtbiBjYW4gYmUgbWFya2VkIGFzIHNvcnRpbmcgLSBubyBtdWx0aS1zb3J0IG9wdGlvbiAqLwoJCQkJaWYgKCBhb0NvbHVtbnNbaV0uYlNvcnRhYmxlICkKCQkJCXsKCQkJCQlpZiAoIGFhU29ydC5sZW5ndGggPiAwICYmIGFhU29ydFswXVswXSA9PSBpICkKCQkJCQl7CgkJCQkJCW5UaC5zZXRBdHRyaWJ1dGUoJ2FyaWEtc29ydCcsIGFhU29ydFswXVsxXT09ImFzYyIgPyAiYXNjZW5kaW5nIiA6ICJkZXNjZW5kaW5nIiApOwoJCQkJCQkKCQkJCQkJdmFyIG5leHRTb3J0ID0gKGFvQ29sdW1uc1tpXS5hc1NvcnRpbmdbIGFhU29ydFswXVsyXSsxIF0pID8gCgkJCQkJCQlhb0NvbHVtbnNbaV0uYXNTb3J0aW5nWyBhYVNvcnRbMF1bMl0rMSBdIDogYW9Db2x1bW5zW2ldLmFzU29ydGluZ1swXTsKCQkJCQkJblRoLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsIHNUaXRsZSsKCQkJCQkJCShuZXh0U29ydD09ImFzYyIgPyBvQXJpYS5zU29ydEFzY2VuZGluZyA6IG9BcmlhLnNTb3J0RGVzY2VuZGluZykgKTsKCQkJCQl9CgkJCQkJZWxzZQoJCQkJCXsKCQkJCQkJblRoLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsIHNUaXRsZSsKCQkJCQkJCShhb0NvbHVtbnNbaV0uYXNTb3J0aW5nWzBdPT0iYXNjIiA/IG9BcmlhLnNTb3J0QXNjZW5kaW5nIDogb0FyaWEuc1NvcnREZXNjZW5kaW5nKSApOwoJCQkJCX0KCQkJCX0KCQkJCWVsc2UKCQkJCXsKCQkJCQluVGguc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgc1RpdGxlKTsKCQkJCX0KCQkJfQoJCQkKCQkJLyogVGVsbCB0aGUgZHJhdyBmdW5jdGlvbiB0aGF0IHdlIGhhdmUgc29ydGVkIHRoZSBkYXRhICovCgkJCW9TZXR0aW5ncy5iU29ydGVkID0gdHJ1ZTsKCQkJJChvU2V0dGluZ3Mub0luc3RhbmNlKS50cmlnZ2VyKCdzb3J0Jywgb1NldHRpbmdzKTsKCQkJCgkJCS8qIENvcHkgdGhlIG1hc3RlciBkYXRhIGludG8gdGhlIGRyYXcgYXJyYXkgYW5kIHJlLWRyYXcgKi8KCQkJaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJGaWx0ZXIgKQoJCQl7CgkJCQkvKiBfZm5GaWx0ZXIoKSB3aWxsIHJlZHJhdyB0aGUgdGFibGUgZm9yIHVzICovCgkJCQlfZm5GaWx0ZXJDb21wbGV0ZSggb1NldHRpbmdzLCBvU2V0dGluZ3Mub1ByZXZpb3VzU2VhcmNoLCAxICk7CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQlvU2V0dGluZ3MuYWlEaXNwbGF5ID0gb1NldHRpbmdzLmFpRGlzcGxheU1hc3Rlci5zbGljZSgpOwoJCQkJb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ID0gMDsgLyogcmVzZXQgZGlzcGxheSBiYWNrIHRvIHBhZ2UgMCAqLwoJCQkJX2ZuQ2FsY3VsYXRlRW5kKCBvU2V0dGluZ3MgKTsKCQkJCV9mbkRyYXcoIG9TZXR0aW5ncyApOwoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEF0dGFjaCBhIHNvcnQgaGFuZGxlciAoY2xpY2spIHRvIGEgbm9kZQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7bm9kZX0gbk5vZGUgbm9kZSB0byBhdHRhY2ggdGhlIGhhbmRsZXIgdG8KCQkgKiAgQHBhcmFtIHtpbnR9IGlEYXRhSW5kZXggY29sdW1uIHNvcnRpbmcgaW5kZXgKCQkgKiAgQHBhcmFtIHtmdW5jdGlvbn0gW2ZuQ2FsbGJhY2tdIGNhbGxiYWNrIGZ1bmN0aW9uCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblNvcnRBdHRhY2hMaXN0ZW5lciAoIG9TZXR0aW5ncywgbk5vZGUsIGlEYXRhSW5kZXgsIGZuQ2FsbGJhY2sgKQoJCXsKCQkJX2ZuQmluZEFjdGlvbiggbk5vZGUsIHt9LCBmdW5jdGlvbiAoZSkgewoJCQkJLyogSWYgdGhlIGNvbHVtbiBpcyBub3Qgc29ydGFibGUgLSBkb24ndCB0byBhbnl0aGluZyAqLwoJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2lEYXRhSW5kZXhdLmJTb3J0YWJsZSA9PT0gZmFsc2UgKQoJCQkJewoJCQkJCXJldHVybjsKCQkJCX0KCQkJCQoJCQkJLyoKCQkJCSAqIFRoaXMgaXMgYSBsaXR0bGUgYml0IG9kZCBJIGFkbWl0Li4uIEkgZGVjbGFyZSBhIHRlbXBvcmFyeSBmdW5jdGlvbiBpbnNpZGUgdGhlIHNjb3BlIG9mCgkJCQkgKiBfZm5CdWlsZEhlYWQgYW5kIHRoZSBjbGljayBoYW5kbGVyIGluIG9yZGVyIHRoYXQgdGhlIGNvZGUgcHJlc2VudGVkIGhlcmUgY2FuIGJlIHVzZWQgCgkJCQkgKiB0d2ljZSAtIG9uY2UgZm9yIHdoZW4gYlByb2Nlc3NpbmcgaXMgZW5hYmxlZCwgYW5kIGFub3RoZXIgdGltZSBmb3Igd2hlbiBpdCBpcyAKCQkJCSAqIGRpc2FibGVkLCBhcyB3ZSBuZWVkIHRvIHBlcmZvcm0gc2xpZ2h0bHkgZGlmZmVyZW50IGFjdGlvbnMuCgkJCQkgKiAgIEJhc2ljYWxseSB0aGUgaXNzdWUgaGVyZSBpcyB0aGF0IHRoZSBKYXZhc2NyaXB0IGVuZ2luZSBpbiBtb2Rlcm4gYnJvd3NlcnMgZG9uJ3QgCgkJCQkgKiBhcHBlYXIgdG8gYWxsb3cgdGhlIHJlbmRlcmluZyBlbmdpbmUgdG8gdXBkYXRlIHRoZSBkaXNwbGF5IHdoaWxlIGl0IGlzIHN0aWxsIGV4Y3V0aW5nCgkJCQkgKiBpdCdzIHRocmVhZCAod2VsbCAtIGl0IGRvZXMgYnV0IG9ubHkgYWZ0ZXIgbG9uZyBpbnRlcnZhbHMpLiBUaGlzIG1lYW5zIHRoYXQgdGhlIAoJCQkJICogJ3Byb2Nlc3NpbmcnIGRpc3BsYXkgZG9lc24ndCBhcHBlYXIgZm9yIGEgdGFibGUgc29ydC4gVG8gYnJlYWsgdGhlIGpzIHRocmVhZCB1cCBhIGJpdAoJCQkJICogSSBmb3JjZSBhbiBleGVjdXRpb24gYnJlYWsgYnkgdXNpbmcgc2V0VGltZW91dCAtIGJ1dCB0aGlzIGJyZWFrcyB0aGUgZXhwZWN0ZWQgCgkJCQkgKiB0aHJlYWQgY29udGludWF0aW9uIGZvciB0aGUgZW5kLWRldmVsb3BlcidzIHBvaW50IG9mIHZpZXcgKHRoZWlyIGNvZGUgd291bGQgZXhlY3V0ZQoJCQkJICogdG9vIGVhcmx5KSwgc28gd2Ugb247eSBkbyBpdCB3aGVuIHdlIGFic29sdXRlbHkgaGF2ZSB0by4KCQkJCSAqLwoJCQkJdmFyIGZuSW5uZXJTb3J0aW5nID0gZnVuY3Rpb24gKCkgewoJCQkJCXZhciBpQ29sdW1uLCBpTmV4dFNvcnQ7CgkJCQkJCgkJCQkJLyogSWYgdGhlIHNoaWZ0IGtleSBpcyBwcmVzc2VkIHRoZW4gd2UgYXJlIG11bHRpcGUgY29sdW1uIHNvcnRpbmcgKi8KCQkJCQlpZiAoIGUuc2hpZnRLZXkgKQoJCQkJCXsKCQkJCQkJLyogQXJlIHdlIGFscmVhZHkgZG9pbmcgc29tZSBraW5kIG9mIHNvcnQgb24gdGhpcyBjb2x1bW4/ICovCgkJCQkJCXZhciBiRm91bmQgPSBmYWxzZTsKCQkJCQkJZm9yICggdmFyIGk9MCA7IGk8b1NldHRpbmdzLmFhU29ydGluZy5sZW5ndGggOyBpKysgKQoJCQkJCQl7CgkJCQkJCQlpZiAoIG9TZXR0aW5ncy5hYVNvcnRpbmdbaV1bMF0gPT0gaURhdGFJbmRleCApCgkJCQkJCQl7CgkJCQkJCQkJYkZvdW5kID0gdHJ1ZTsKCQkJCQkJCQlpQ29sdW1uID0gb1NldHRpbmdzLmFhU29ydGluZ1tpXVswXTsKCQkJCQkJCQlpTmV4dFNvcnQgPSBvU2V0dGluZ3MuYWFTb3J0aW5nW2ldWzJdKzE7CgkJCQkJCQkJCgkJCQkJCQkJaWYgKCAhb1NldHRpbmdzLmFvQ29sdW1uc1tpQ29sdW1uXS5hc1NvcnRpbmdbaU5leHRTb3J0XSApCgkJCQkJCQkJewoJCQkJCQkJCQkvKiBSZWFjaGVkIHRoZSBlbmQgb2YgdGhlIHNvcnRpbmcgb3B0aW9ucywgcmVtb3ZlIGZyb20gbXVsdGktY29sIHNvcnQgKi8KCQkJCQkJCQkJb1NldHRpbmdzLmFhU29ydGluZy5zcGxpY2UoIGksIDEgKTsKCQkJCQkJCQl9CgkJCQkJCQkJZWxzZQoJCQkJCQkJCXsKCQkJCQkJCQkJLyogTW92ZSBvbnRvIG5leHQgc29ydGluZyBkaXJlY3Rpb24gKi8KCQkJCQkJCQkJb1NldHRpbmdzLmFhU29ydGluZ1tpXVsxXSA9IG9TZXR0aW5ncy5hb0NvbHVtbnNbaUNvbHVtbl0uYXNTb3J0aW5nW2lOZXh0U29ydF07CgkJCQkJCQkJCW9TZXR0aW5ncy5hYVNvcnRpbmdbaV1bMl0gPSBpTmV4dFNvcnQ7CgkJCQkJCQkJfQoJCQkJCQkJCWJyZWFrOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJCQoJCQkJCQkvKiBObyBzb3J0IHlldCAtIGFkZCBpdCBpbiAqLwoJCQkJCQlpZiAoIGJGb3VuZCA9PT0gZmFsc2UgKQoJCQkJCQl7CgkJCQkJCQlvU2V0dGluZ3MuYWFTb3J0aW5nLnB1c2goIFsgaURhdGFJbmRleCwgCgkJCQkJCQkJb1NldHRpbmdzLmFvQ29sdW1uc1tpRGF0YUluZGV4XS5hc1NvcnRpbmdbMF0sIDAgXSApOwoJCQkJCQl9CgkJCQkJfQoJCQkJCWVsc2UKCQkJCQl7CgkJCQkJCS8qIElmIG5vIHNoaWZ0IGtleSB0aGVuIHNpbmdsZSBjb2x1bW4gc29ydCAqLwoJCQkJCQlpZiAoIG9TZXR0aW5ncy5hYVNvcnRpbmcubGVuZ3RoID09IDEgJiYgb1NldHRpbmdzLmFhU29ydGluZ1swXVswXSA9PSBpRGF0YUluZGV4ICkKCQkJCQkJewoJCQkJCQkJaUNvbHVtbiA9IG9TZXR0aW5ncy5hYVNvcnRpbmdbMF1bMF07CgkJCQkJCQlpTmV4dFNvcnQgPSBvU2V0dGluZ3MuYWFTb3J0aW5nWzBdWzJdKzE7CgkJCQkJCQlpZiAoICFvU2V0dGluZ3MuYW9Db2x1bW5zW2lDb2x1bW5dLmFzU29ydGluZ1tpTmV4dFNvcnRdICkKCQkJCQkJCXsKCQkJCQkJCQlpTmV4dFNvcnQgPSAwOwoJCQkJCQkJfQoJCQkJCQkJb1NldHRpbmdzLmFhU29ydGluZ1swXVsxXSA9IG9TZXR0aW5ncy5hb0NvbHVtbnNbaUNvbHVtbl0uYXNTb3J0aW5nW2lOZXh0U29ydF07CgkJCQkJCQlvU2V0dGluZ3MuYWFTb3J0aW5nWzBdWzJdID0gaU5leHRTb3J0OwoJCQkJCQl9CgkJCQkJCWVsc2UKCQkJCQkJewoJCQkJCQkJb1NldHRpbmdzLmFhU29ydGluZy5zcGxpY2UoIDAsIG9TZXR0aW5ncy5hYVNvcnRpbmcubGVuZ3RoICk7CgkJCQkJCQlvU2V0dGluZ3MuYWFTb3J0aW5nLnB1c2goIFsgaURhdGFJbmRleCwgCgkJCQkJCQkJb1NldHRpbmdzLmFvQ29sdW1uc1tpRGF0YUluZGV4XS5hc1NvcnRpbmdbMF0sIDAgXSApOwoJCQkJCQl9CgkJCQkJfQoJCQkJCQoJCQkJCS8qIFJ1biB0aGUgc29ydCAqLwoJCQkJCV9mblNvcnQoIG9TZXR0aW5ncyApOwoJCQkJfTsgLyogL2ZuSW5uZXJTb3J0aW5nICovCgkJCQkKCQkJCWlmICggIW9TZXR0aW5ncy5vRmVhdHVyZXMuYlByb2Nlc3NpbmcgKQoJCQkJewoJCQkJCWZuSW5uZXJTb3J0aW5nKCk7CgkJCQl9CgkJCQllbHNlCgkJCQl7CgkJCQkJX2ZuUHJvY2Vzc2luZ0Rpc3BsYXkoIG9TZXR0aW5ncywgdHJ1ZSApOwoJCQkJCXNldFRpbWVvdXQoIGZ1bmN0aW9uKCkgewoJCQkJCQlmbklubmVyU29ydGluZygpOwoJCQkJCQlpZiAoICFvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTZXJ2ZXJTaWRlICkKCQkJCQkJewoJCQkJCQkJX2ZuUHJvY2Vzc2luZ0Rpc3BsYXkoIG9TZXR0aW5ncywgZmFsc2UgKTsKCQkJCQkJfQoJCQkJCX0sIDAgKTsKCQkJCX0KCQkJCQoJCQkJLyogQ2FsbCB0aGUgdXNlciBzcGVjaWZpZWQgY2FsbGJhY2sgZnVuY3Rpb24gLSB1c2VkIGZvciBhc3luYyB1c2VyIGludGVyYWN0aW9uICovCgkJCQlpZiAoIHR5cGVvZiBmbkNhbGxiYWNrID09ICdmdW5jdGlvbicgKQoJCQkJewoJCQkJCWZuQ2FsbGJhY2soIG9TZXR0aW5ncyApOwoJCQkJfQoJCQl9ICk7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIFNldCB0aGUgc29ydGluZyBjbGFzc2VzIG9uIHRoZSBoZWFkZXIsIE5vdGU6IGl0IGlzIHNhZmUgdG8gY2FsbCB0aGlzIGZ1bmN0aW9uIAoJCSAqIHdoZW4gYlNvcnQgYW5kIGJTb3J0Q2xhc3NlcyBhcmUgZmFsc2UKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5Tb3J0aW5nQ2xhc3Nlcyggb1NldHRpbmdzICkKCQl7CgkJCXZhciBpLCBpTGVuLCBqLCBqTGVuLCBpRm91bmQ7CgkJCXZhciBhYVNvcnQsIHNDbGFzczsKCQkJdmFyIGlDb2x1bW5zID0gb1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGg7CgkJCXZhciBvQ2xhc3NlcyA9IG9TZXR0aW5ncy5vQ2xhc3NlczsKCQkJCgkJCWZvciAoIGk9MCA7IGk8aUNvbHVtbnMgOyBpKysgKQoJCQl7CgkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uYlNvcnRhYmxlICkKCQkJCXsKCQkJCQkkKG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0ublRoKS5yZW1vdmVDbGFzcyggb0NsYXNzZXMuc1NvcnRBc2MgKyIgIisgb0NsYXNzZXMuc1NvcnREZXNjICsKCQkJCQkJIiAiKyBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNTb3J0aW5nQ2xhc3MgKTsKCQkJCX0KCQkJfQoJCQkKCQkJaWYgKCBvU2V0dGluZ3MuYWFTb3J0aW5nRml4ZWQgIT09IG51bGwgKQoJCQl7CgkJCQlhYVNvcnQgPSBvU2V0dGluZ3MuYWFTb3J0aW5nRml4ZWQuY29uY2F0KCBvU2V0dGluZ3MuYWFTb3J0aW5nICk7CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQlhYVNvcnQgPSBvU2V0dGluZ3MuYWFTb3J0aW5nLnNsaWNlKCk7CgkJCX0KCQkJCgkJCS8qIEFwcGx5IHRoZSByZXF1aXJlZCBjbGFzc2VzIHRvIHRoZSBoZWFkZXIgKi8KCQkJZm9yICggaT0wIDsgaTxvU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGkrKyApCgkJCXsKCQkJCWlmICggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5iU29ydGFibGUgKQoJCQkJewoJCQkJCXNDbGFzcyA9IG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc1NvcnRpbmdDbGFzczsKCQkJCQlpRm91bmQgPSAtMTsKCQkJCQlmb3IgKCBqPTAgOyBqPGFhU29ydC5sZW5ndGggOyBqKysgKQoJCQkJCXsKCQkJCQkJaWYgKCBhYVNvcnRbal1bMF0gPT0gaSApCgkJCQkJCXsKCQkJCQkJCXNDbGFzcyA9ICggYWFTb3J0W2pdWzFdID09ICJhc2MiICkgPwoJCQkJCQkJCW9DbGFzc2VzLnNTb3J0QXNjIDogb0NsYXNzZXMuc1NvcnREZXNjOwoJCQkJCQkJaUZvdW5kID0gajsKCQkJCQkJCWJyZWFrOwoJCQkJCQl9CgkJCQkJfQoJCQkJCSQob1NldHRpbmdzLmFvQ29sdW1uc1tpXS5uVGgpLmFkZENsYXNzKCBzQ2xhc3MgKTsKCQkJCQkKCQkJCQlpZiAoIG9TZXR0aW5ncy5iSlVJICkKCQkJCQl7CgkJCQkJCS8qIGpRdWVyeSBVSSB1c2VzIGV4dHJhIG1hcmt1cCAqLwoJCQkJCQl2YXIganFTcGFuID0gJCgic3Bhbi4iK29DbGFzc2VzLnNTb3J0SWNvbiwgIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0ublRoKTsKCQkJCQkJanFTcGFuLnJlbW92ZUNsYXNzKG9DbGFzc2VzLnNTb3J0SlVJQXNjICsiICIrIG9DbGFzc2VzLnNTb3J0SlVJRGVzYyArIiAiKyAKCQkJCQkJCW9DbGFzc2VzLnNTb3J0SlVJICsiICIrIG9DbGFzc2VzLnNTb3J0SlVJQXNjQWxsb3dlZCArIiAiKyBvQ2xhc3Nlcy5zU29ydEpVSURlc2NBbGxvd2VkICk7CgkJCQkJCQoJCQkJCQl2YXIgc1NwYW5DbGFzczsKCQkJCQkJaWYgKCBpRm91bmQgPT0gLTEgKQoJCQkJCQl7CgkJCQkJCSAJc1NwYW5DbGFzcyA9IG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc1NvcnRpbmdDbGFzc0pVSTsKCQkJCQkJfQoJCQkJCQllbHNlIGlmICggYWFTb3J0W2lGb3VuZF1bMV0gPT0gImFzYyIgKQoJCQkJCQl7CgkJCQkJCQlzU3BhbkNsYXNzID0gb0NsYXNzZXMuc1NvcnRKVUlBc2M7CgkJCQkJCX0KCQkJCQkJZWxzZQoJCQkJCQl7CgkJCQkJCQlzU3BhbkNsYXNzID0gb0NsYXNzZXMuc1NvcnRKVUlEZXNjOwoJCQkJCQl9CgkJCQkJCQoJCQkJCQlqcVNwYW4uYWRkQ2xhc3MoIHNTcGFuQ2xhc3MgKTsKCQkJCQl9CgkJCQl9CgkJCQllbHNlCgkJCQl7CgkJCQkJLyogTm8gc29ydGluZyBvbiB0aGlzIGNvbHVtbiwgc28gYWRkIHRoZSBiYXNlIGNsYXNzLiBUaGlzIHdpbGwgaGF2ZSBiZWVuIGFzc2lnbmVkIGJ5CgkJCQkJICogX2ZuQWRkQ29sdW1uCgkJCQkJICovCgkJCQkJJChvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLm5UaCkuYWRkQ2xhc3MoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc1NvcnRpbmdDbGFzcyApOwoJCQkJfQoJCQl9CgkJCQoJCQkvKiAKCQkJICogQXBwbHkgdGhlIHJlcXVpcmVkIGNsYXNzZXMgdG8gdGhlIHRhYmxlIGJvZHkKCQkJICogTm90ZSB0aGF0IHRoaXMgaXMgZ2l2ZW4gYXMgYSBmZWF0dXJlIHN3aXRjaCBzaW5jZSBpdCBjYW4gc2lnbmlmaWNhbnRseSBzbG93IGRvd24gYSBzb3J0CgkJCSAqIG9uIGxhcmdlIGRhdGEgc2V0cyAoYWRkaW5nIGFuZCByZW1vdmluZyBvZiBjbGFzc2VzIGlzIGFsd2F5cyBzbG93IGF0IHRoZSBiZXN0IG9mIHRpbWVzLi4pCgkJCSAqIEZ1cnRoZXIgdG8gdGhpcywgbm90ZSB0aGF0IHRoaXMgY29kZSBpcyBhZG1pdGFkbHkgZmFpcmx5IHVnbHkuIEl0IGNvdWxkIGJlIG1hZGUgYSBsb3QgCgkJCSAqIHNpbXBpbGVyIHVzaW5nIGpRdWVyeSBzZWxlY3RvcnMgYW5kIGFkZC9yZW1vdmVDbGFzcywgYnV0IHRoYXQgaXMgc2lnbmlmaWNhbnRseSBzbG93ZXIKCQkJICogKG9uIHRoZSBvcmRlciBvZiA1IHRpbWVzIHNsb3dlcikgLSBoZW5jZSB0aGUgZGlyZWN0IERPTSBtYW5pcHVsYXRpb24gaGVyZS4KCQkJICogTm90ZSB0aGF0IGZvciBkZWZlcmVkIGRyYXdpbmcgd2UgZG8gdXNlIGpRdWVyeSAtIHRoZSByZWFzb24gYmVpbmcgdGhhdCB0YWtpbmcgdGhlIGZpcnN0CgkJCSAqIHJvdyBmb3VuZCB0byBzZWUgaWYgdGhlIHdob2xlIGNvbHVtbiBuZWVkcyBwcm9jZXNzZWQgY2FuIG1pc3MgY2xhc3NlcyBzaW5jZSB0aGUgZmlyc3QKCQkJICogY29sdW1uIG1pZ2h0IGJlIG5ldy4KCQkJICovCgkJCXNDbGFzcyA9IG9DbGFzc2VzLnNTb3J0Q29sdW1uOwoJCQkKCQkJaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTb3J0ICYmIG9TZXR0aW5ncy5vRmVhdHVyZXMuYlNvcnRDbGFzc2VzICkKCQkJewoJCQkJdmFyIG5UZHMgPSBfZm5HZXRUZE5vZGVzKCBvU2V0dGluZ3MgKTsKCQkKCQkJCS8qIFJlbW92ZSB0aGUgb2xkIGNsYXNzZXMgKi8KCQkJCWlmICggb1NldHRpbmdzLm9GZWF0dXJlcy5iRGVmZXJSZW5kZXIgKQoJCQkJewoJCQkJCSQoblRkcykucmVtb3ZlQ2xhc3Moc0NsYXNzKycxICcrc0NsYXNzKycyICcrc0NsYXNzKyczJyk7CgkJCQl9CgkJCQllbHNlIGlmICggblRkcy5sZW5ndGggPj0gaUNvbHVtbnMgKQoJCQkJewoJCQkJCWZvciAoIGk9MCA7IGk8aUNvbHVtbnMgOyBpKysgKQoJCQkJCXsKCQkJCQkJaWYgKCBuVGRzW2ldLmNsYXNzTmFtZS5pbmRleE9mKHNDbGFzcysiMSIpICE9IC0xICkKCQkJCQkJewoJCQkJCQkJZm9yICggaj0wLCBqTGVuPShuVGRzLmxlbmd0aC9pQ29sdW1ucykgOyBqPGpMZW4gOyBqKysgKQoJCQkJCQkJewoJCQkJCQkJCW5UZHNbKGlDb2x1bW5zKmopK2ldLmNsYXNzTmFtZSA9IAoJCQkJCQkJCQkkLnRyaW0oIG5UZHNbKGlDb2x1bW5zKmopK2ldLmNsYXNzTmFtZS5yZXBsYWNlKCBzQ2xhc3MrIjEiLCAiIiApICk7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJZWxzZSBpZiAoIG5UZHNbaV0uY2xhc3NOYW1lLmluZGV4T2Yoc0NsYXNzKyIyIikgIT0gLTEgKQoJCQkJCQl7CgkJCQkJCQlmb3IgKCBqPTAsIGpMZW49KG5UZHMubGVuZ3RoL2lDb2x1bW5zKSA7IGo8akxlbiA7IGorKyApCgkJCQkJCQl7CgkJCQkJCQkJblRkc1soaUNvbHVtbnMqaikraV0uY2xhc3NOYW1lID0gCgkJCQkJCQkJCSQudHJpbSggblRkc1soaUNvbHVtbnMqaikraV0uY2xhc3NOYW1lLnJlcGxhY2UoIHNDbGFzcysiMiIsICIiICkgKTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQllbHNlIGlmICggblRkc1tpXS5jbGFzc05hbWUuaW5kZXhPZihzQ2xhc3MrIjMiKSAhPSAtMSApCgkJCQkJCXsKCQkJCQkJCWZvciAoIGo9MCwgakxlbj0oblRkcy5sZW5ndGgvaUNvbHVtbnMpIDsgajxqTGVuIDsgaisrICkKCQkJCQkJCXsKCQkJCQkJCQluVGRzWyhpQ29sdW1ucypqKStpXS5jbGFzc05hbWUgPSAKCQkJCQkJCQkJJC50cmltKCBuVGRzWyhpQ29sdW1ucypqKStpXS5jbGFzc05hbWUucmVwbGFjZSggIiAiK3NDbGFzcysiMyIsICIiICkgKTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJCQoJCQkJLyogQWRkIHRoZSBuZXcgY2xhc3NlcyB0byB0aGUgdGFibGUgKi8KCQkJCXZhciBpQ2xhc3MgPSAxLCBpVGFyZ2V0Q29sOwoJCQkJZm9yICggaT0wIDsgaTxhYVNvcnQubGVuZ3RoIDsgaSsrICkKCQkJCXsKCQkJCQlpVGFyZ2V0Q29sID0gcGFyc2VJbnQoIGFhU29ydFtpXVswXSwgMTAgKTsKCQkJCQlmb3IgKCBqPTAsIGpMZW49KG5UZHMubGVuZ3RoL2lDb2x1bW5zKSA7IGo8akxlbiA7IGorKyApCgkJCQkJewoJCQkJCQluVGRzWyhpQ29sdW1ucypqKStpVGFyZ2V0Q29sXS5jbGFzc05hbWUgKz0gIiAiK3NDbGFzcytpQ2xhc3M7CgkJCQkJfQoJCQkJCQoJCQkJCWlmICggaUNsYXNzIDwgMyApCgkJCQkJewoJCQkJCQlpQ2xhc3MrKzsKCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgkJCgkJCgkJCgkJLyoqCgkJICogU2F2ZSB0aGUgc3RhdGUgb2YgYSB0YWJsZSBpbiBhIGNvb2tpZSBzdWNoIHRoYXQgdGhlIHBhZ2UgY2FuIGJlIHJlbG9hZGVkCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuU2F2ZVN0YXRlICggb1NldHRpbmdzICkKCQl7CgkJCWlmICggIW9TZXR0aW5ncy5vRmVhdHVyZXMuYlN0YXRlU2F2ZSB8fCBvU2V0dGluZ3MuYkRlc3Ryb3lpbmcgKQoJCQl7CgkJCQlyZXR1cm47CgkJCX0KCQkKCQkJLyogU3RvcmUgdGhlIGludGVyZXN0aW5nIHZhcmlhYmxlcyAqLwoJCQl2YXIgaSwgaUxlbiwgYkluZmluaXRlPW9TZXR0aW5ncy5vU2Nyb2xsLmJJbmZpbml0ZTsKCQkJdmFyIG9TdGF0ZSA9IHsKCQkJCSJpQ3JlYXRlIjogICAgICBuZXcgRGF0ZSgpLmdldFRpbWUoKSwKCQkJCSJpU3RhcnQiOiAgICAgICAoYkluZmluaXRlID8gMCA6IG9TZXR0aW5ncy5faURpc3BsYXlTdGFydCksCgkJCQkiaUVuZCI6ICAgICAgICAgKGJJbmZpbml0ZSA/IG9TZXR0aW5ncy5faURpc3BsYXlMZW5ndGggOiBvU2V0dGluZ3MuX2lEaXNwbGF5RW5kKSwKCQkJCSJpTGVuZ3RoIjogICAgICBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoLAoJCQkJImFhU29ydGluZyI6ICAgICQuZXh0ZW5kKCB0cnVlLCBbXSwgb1NldHRpbmdzLmFhU29ydGluZyApLAoJCQkJIm9TZWFyY2giOiAgICAgICQuZXh0ZW5kKCB0cnVlLCB7fSwgb1NldHRpbmdzLm9QcmV2aW91c1NlYXJjaCApLAoJCQkJImFvU2VhcmNoQ29scyI6ICQuZXh0ZW5kKCB0cnVlLCBbXSwgb1NldHRpbmdzLmFvUHJlU2VhcmNoQ29scyApLAoJCQkJImFiVmlzQ29scyI6ICAgIFtdCgkJCX07CgkJCgkJCWZvciAoIGk9MCwgaUxlbj1vU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCW9TdGF0ZS5hYlZpc0NvbHMucHVzaCggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5iVmlzaWJsZSApOwoJCQl9CgkJCgkJCV9mbkNhbGxiYWNrRmlyZSggb1NldHRpbmdzLCAiYW9TdGF0ZVNhdmVQYXJhbXMiLCAnc3RhdGVTYXZlUGFyYW1zJywgW29TZXR0aW5ncywgb1N0YXRlXSApOwoJCQkKCQkJb1NldHRpbmdzLmZuU3RhdGVTYXZlLmNhbGwoIG9TZXR0aW5ncy5vSW5zdGFuY2UsIG9TZXR0aW5ncywgb1N0YXRlICk7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEF0dGVtcHQgdG8gbG9hZCBhIHNhdmVkIHRhYmxlIHN0YXRlIGZyb20gYSBjb29raWUKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge29iamVjdH0gb0luaXQgRGF0YVRhYmxlcyBpbml0IG9iamVjdCBzbyB3ZSBjYW4gb3ZlcnJpZGUgc2V0dGluZ3MKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuTG9hZFN0YXRlICggb1NldHRpbmdzLCBvSW5pdCApCgkJewoJCQlpZiAoICFvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTdGF0ZVNhdmUgKQoJCQl7CgkJCQlyZXR1cm47CgkJCX0KCQkKCQkJdmFyIG9EYXRhID0gb1NldHRpbmdzLmZuU3RhdGVMb2FkLmNhbGwoIG9TZXR0aW5ncy5vSW5zdGFuY2UsIG9TZXR0aW5ncyApOwoJCQlpZiAoICFvRGF0YSApCgkJCXsKCQkJCXJldHVybjsKCQkJfQoJCQkKCQkJLyogQWxsb3cgY3VzdG9tIGFuZCBwbHVnLWluIG1hbmlwdWxhdGlvbiBmdW5jdGlvbnMgdG8gYWx0ZXIgdGhlIHNhdmVkIGRhdGEgc2V0IGFuZAoJCQkgKiBjYW5jZWxsaW5nIG9mIGxvYWRpbmcgYnkgcmV0dXJuaW5nIGZhbHNlCgkJCSAqLwoJCQl2YXIgYWJTdGF0ZUxvYWQgPSBfZm5DYWxsYmFja0ZpcmUoIG9TZXR0aW5ncywgJ2FvU3RhdGVMb2FkUGFyYW1zJywgJ3N0YXRlTG9hZFBhcmFtcycsIFtvU2V0dGluZ3MsIG9EYXRhXSApOwoJCQlpZiAoICQuaW5BcnJheSggZmFsc2UsIGFiU3RhdGVMb2FkICkgIT09IC0xICkKCQkJewoJCQkJcmV0dXJuOwoJCQl9CgkJCQoJCQkvKiBTdG9yZSB0aGUgc2F2ZWQgc3RhdGUgc28gaXQgbWlnaHQgYmUgYWNjZXNzZWQgYXQgYW55IHRpbWUgKi8KCQkJb1NldHRpbmdzLm9Mb2FkZWRTdGF0ZSA9ICQuZXh0ZW5kKCB0cnVlLCB7fSwgb0RhdGEgKTsKCQkJCgkJCS8qIFJlc3RvcmUga2V5IGZlYXR1cmVzICovCgkJCW9TZXR0aW5ncy5faURpc3BsYXlTdGFydCAgICA9IG9EYXRhLmlTdGFydDsKCQkJb1NldHRpbmdzLmlJbml0RGlzcGxheVN0YXJ0ID0gb0RhdGEuaVN0YXJ0OwoJCQlvU2V0dGluZ3MuX2lEaXNwbGF5RW5kICAgICAgPSBvRGF0YS5pRW5kOwoJCQlvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoICAgPSBvRGF0YS5pTGVuZ3RoOwoJCQlvU2V0dGluZ3MuYWFTb3J0aW5nICAgICAgICAgPSBvRGF0YS5hYVNvcnRpbmcuc2xpY2UoKTsKCQkJb1NldHRpbmdzLnNhdmVkX2FhU29ydGluZyAgID0gb0RhdGEuYWFTb3J0aW5nLnNsaWNlKCk7CgkJCQoJCQkvKiBTZWFyY2ggZmlsdGVyaW5nICAqLwoJCQkkLmV4dGVuZCggb1NldHRpbmdzLm9QcmV2aW91c1NlYXJjaCwgb0RhdGEub1NlYXJjaCApOwoJCQkkLmV4dGVuZCggdHJ1ZSwgb1NldHRpbmdzLmFvUHJlU2VhcmNoQ29scywgb0RhdGEuYW9TZWFyY2hDb2xzICk7CgkJCQoJCQkvKiBDb2x1bW4gdmlzaWJpbGl0eSBzdGF0ZQoJCQkgKiBQYXNzIGJhY2sgdmlzaWJpbGl5IHNldHRpbmdzIHRvIHRoZSBpbml0IGhhbmRsZXIsIGJ1dCB0byBkbyBub3QgaGVyZSBvdmVycmlkZQoJCQkgKiB0aGUgaW5pdCBvYmplY3QgdGhhdCB0aGUgdXNlciBtaWdodCBoYXZlIHBhc3NlZCBpbgoJCQkgKi8KCQkJb0luaXQuc2F2ZWRfYW9Db2x1bW5zID0gW107CgkJCWZvciAoIHZhciBpPTAgOyBpPG9EYXRhLmFiVmlzQ29scy5sZW5ndGggOyBpKysgKQoJCQl7CgkJCQlvSW5pdC5zYXZlZF9hb0NvbHVtbnNbaV0gPSB7fTsKCQkJCW9Jbml0LnNhdmVkX2FvQ29sdW1uc1tpXS5iVmlzaWJsZSA9IG9EYXRhLmFiVmlzQ29sc1tpXTsKCQkJfQoJCQoJCQlfZm5DYWxsYmFja0ZpcmUoIG9TZXR0aW5ncywgJ2FvU3RhdGVMb2FkZWQnLCAnc3RhdGVMb2FkZWQnLCBbb1NldHRpbmdzLCBvRGF0YV0gKTsKCQl9CgkJCgkJCgkJLyoqCgkJICogQ3JlYXRlIGEgbmV3IGNvb2tpZSB3aXRoIGEgdmFsdWUgdG8gc3RvcmUgdGhlIHN0YXRlIG9mIGEgdGFibGUKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNOYW1lIG5hbWUgb2YgdGhlIGNvb2tpZSB0byBjcmVhdGUKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNWYWx1ZSB0aGUgdmFsdWUgdGhlIGNvb2tpZSBzaG91bGQgdGFrZQoJCSAqICBAcGFyYW0ge2ludH0gaVNlY3MgZHVyYXRpb24gb2YgdGhlIGNvb2tpZQoJCSAqICBAcGFyYW0ge3N0cmluZ30gc0Jhc2VOYW1lIHNOYW1lIGlzIG1hZGUgdXAgb2YgdGhlIGJhc2UgKyBmaWxlIG5hbWUgLSB0aGlzIGlzIHRoZSBiYXNlCgkJICogIEBwYXJhbSB7ZnVuY3Rpb259IGZuQ2FsbGJhY2sgVXNlciBkZWZpbmFibGUgZnVuY3Rpb24gdG8gbW9kaWZ5IHRoZSBjb29raWUKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuQ3JlYXRlQ29va2llICggc05hbWUsIHNWYWx1ZSwgaVNlY3MsIHNCYXNlTmFtZSwgZm5DYWxsYmFjayApCgkJewoJCQl2YXIgZGF0ZSA9IG5ldyBEYXRlKCk7CgkJCWRhdGUuc2V0VGltZSggZGF0ZS5nZXRUaW1lKCkrKGlTZWNzKjEwMDApICk7CgkJCQoJCQkvKiAKCQkJICogU2hvY2tpbmcgYnV0IHRydWUgLSBpdCB3b3VsZCBhcHBlYXIgSUUgaGFzIG1ham9yIGlzc3VlcyB3aXRoIGhhdmluZyB0aGUgcGF0aCBub3QgaGF2aW5nCgkJCSAqIGEgdHJhaWxpbmcgc2xhc2ggb24gaXQuIFdlIG5lZWQgdGhlIGNvb2tpZSB0byBiZSBhdmFpbGFibGUgYmFzZWQgb24gdGhlIHBhdGgsIHNvIHdlCgkJCSAqIGhhdmUgdG8gYXBwZW5kIHRoZSBmaWxlIG5hbWUgdG8gdGhlIGNvb2tpZSBuYW1lLiBBcHBhbGxpbmcuIFRoYW5rcyB0byB2ZXggZm9yIGFkZGluZyB0aGUKCQkJICogcGF0Y2ggdG8gdXNlIGF0IGxlYXN0IHNvbWUgb2YgdGhlIHBhdGgKCQkJICovCgkJCXZhciBhUGFydHMgPSB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUuc3BsaXQoJy8nKTsKCQkJdmFyIHNOYW1lRmlsZSA9IHNOYW1lICsgJ18nICsgYVBhcnRzLnBvcCgpLnJlcGxhY2UoL1tcLzpdL2csIiIpLnRvTG93ZXJDYXNlKCk7CgkJCXZhciBzRnVsbENvb2tpZSwgb0RhdGE7CgkJCQoJCQlpZiAoIGZuQ2FsbGJhY2sgIT09IG51bGwgKQoJCQl7CgkJCQlvRGF0YSA9ICh0eXBlb2YgJC5wYXJzZUpTT04gPT09ICdmdW5jdGlvbicpID8gCgkJCQkJJC5wYXJzZUpTT04oIHNWYWx1ZSApIDogZXZhbCggJygnK3NWYWx1ZSsnKScgKTsKCQkJCXNGdWxsQ29va2llID0gZm5DYWxsYmFjayggc05hbWVGaWxlLCBvRGF0YSwgZGF0ZS50b0dNVFN0cmluZygpLAoJCQkJCWFQYXJ0cy5qb2luKCcvJykrIi8iICk7CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQlzRnVsbENvb2tpZSA9IHNOYW1lRmlsZSArICI9IiArIGVuY29kZVVSSUNvbXBvbmVudChzVmFsdWUpICsKCQkJCQkiOyBleHBpcmVzPSIgKyBkYXRlLnRvR01UU3RyaW5nKCkgKyI7IHBhdGg9IiArIGFQYXJ0cy5qb2luKCcvJykrIi8iOwoJCQl9CgkJCQoJCQkvKiBBcmUgd2UgZ29pbmcgdG8gZ28gb3ZlciB0aGUgY29va2llIGxpbWl0IG9mIDRLaUI/IElmIHNvLCB0cnkgdG8gZGVsZXRlIGEgY29va2llcwoJCQkgKiBiZWxvbmdpbmcgdG8gRGF0YVRhYmxlcy4gVGhpcyBpcyBGQVIgZnJvbSBidWxsZXQgcHJvb2YKCQkJICovCgkJCXZhciBzT2xkTmFtZT0iIiwgaU9sZFRpbWU9OTk5OTk5OTk5OTk5OTsKCQkJdmFyIGlMZW5ndGggPSBfZm5SZWFkQ29va2llKCBzTmFtZUZpbGUgKSE9PW51bGwgPyBkb2N1bWVudC5jb29raWUubGVuZ3RoIDogCgkJCQlzRnVsbENvb2tpZS5sZW5ndGggKyBkb2N1bWVudC5jb29raWUubGVuZ3RoOwoJCQkKCQkJaWYgKCBpTGVuZ3RoKzEwID4gNDA5NiApIC8qIE1hZ2ljIDEwIGZvciBwYWRkaW5nICovCgkJCXsKCQkJCXZhciBhQ29va2llcyA9ZG9jdW1lbnQuY29va2llLnNwbGl0KCc7Jyk7CgkJCQlmb3IgKCB2YXIgaT0wLCBpTGVuPWFDb29raWVzLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJaWYgKCBhQ29va2llc1tpXS5pbmRleE9mKCBzQmFzZU5hbWUgKSAhPSAtMSApCgkJCQkJewoJCQkJCQkvKiBJdCdzIGEgRGF0YVRhYmxlcyBjb29raWUsIHNvIGV2YWwgaXQgYW5kIGNoZWNrIHRoZSB0aW1lIHN0YW1wICovCgkJCQkJCXZhciBhU3BsaXRDb29raWUgPSBhQ29va2llc1tpXS5zcGxpdCgnPScpOwoJCQkJCQl0cnkgeyBvRGF0YSA9IGV2YWwoICcoJytkZWNvZGVVUklDb21wb25lbnQoYVNwbGl0Q29va2llWzFdKSsnKScgKTsgfQoJCQkJCQljYXRjaCggZSApIHsgY29udGludWU7IH0KCQkJCQkJCgkJCQkJCWlmICggb0RhdGEuaUNyZWF0ZSAmJiBvRGF0YS5pQ3JlYXRlIDwgaU9sZFRpbWUgKQoJCQkJCQl7CgkJCQkJCQlzT2xkTmFtZSA9IGFTcGxpdENvb2tpZVswXTsKCQkJCQkJCWlPbGRUaW1lID0gb0RhdGEuaUNyZWF0ZTsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJCQoJCQkJaWYgKCBzT2xkTmFtZSAhPT0gIiIgKQoJCQkJewoJCQkJCWRvY3VtZW50LmNvb2tpZSA9IHNPbGROYW1lKyI9OyBleHBpcmVzPVRodSwgMDEtSmFuLTE5NzAgMDA6MDA6MDEgR01UOyBwYXRoPSIrCgkJCQkJCWFQYXJ0cy5qb2luKCcvJykgKyAiLyI7CgkJCQl9CgkJCX0KCQkJCgkJCWRvY3VtZW50LmNvb2tpZSA9IHNGdWxsQ29va2llOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBSZWFkIGFuIG9sZCBjb29raWUgdG8gZ2V0IGEgY29va2llIHdpdGggYW4gb2xkIHRhYmxlIHN0YXRlCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzTmFtZSBuYW1lIG9mIHRoZSBjb29raWUgdG8gcmVhZAoJCSAqICBAcmV0dXJucyB7c3RyaW5nfSBjb250ZW50cyBvZiB0aGUgY29va2llIC0gb3IgbnVsbCBpZiBubyBjb29raWUgd2l0aCB0aGF0IG5hbWUgZm91bmQKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuUmVhZENvb2tpZSAoIHNOYW1lICkKCQl7CgkJCXZhcgoJCQkJYVBhcnRzID0gd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lLnNwbGl0KCcvJyksCgkJCQlzTmFtZUVRID0gc05hbWUgKyAnXycgKyBhUGFydHNbYVBhcnRzLmxlbmd0aC0xXS5yZXBsYWNlKC9bXC86XS9nLCIiKS50b0xvd2VyQ2FzZSgpICsgJz0nLAoJCQkgCXNDb29raWVDb250ZW50cyA9IGRvY3VtZW50LmNvb2tpZS5zcGxpdCgnOycpOwoJCQkKCQkJZm9yKCB2YXIgaT0wIDsgaTxzQ29va2llQ29udGVudHMubGVuZ3RoIDsgaSsrICkKCQkJewoJCQkJdmFyIGMgPSBzQ29va2llQ29udGVudHNbaV07CgkJCQkKCQkJCXdoaWxlIChjLmNoYXJBdCgwKT09JyAnKQoJCQkJewoJCQkJCWMgPSBjLnN1YnN0cmluZygxLGMubGVuZ3RoKTsKCQkJCX0KCQkJCQoJCQkJaWYgKGMuaW5kZXhPZihzTmFtZUVRKSA9PT0gMCkKCQkJCXsKCQkJCQlyZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KCBjLnN1YnN0cmluZyhzTmFtZUVRLmxlbmd0aCxjLmxlbmd0aCkgKTsKCQkJCX0KCQkJfQoJCQlyZXR1cm4gbnVsbDsKCQl9CgkJCgkJCgkJCgkJLyoqCgkJICogUmV0dXJuIHRoZSBzZXR0aW5ncyBvYmplY3QgZm9yIGEgcGFydGljdWxhciB0YWJsZQoJCSAqICBAcGFyYW0ge25vZGV9IG5UYWJsZSB0YWJsZSB3ZSBhcmUgdXNpbmcgYXMgYSBkYXRhVGFibGUKCQkgKiAgQHJldHVybnMge29iamVjdH0gU2V0dGluZ3Mgb2JqZWN0IC0gb3IgbnVsbCBpZiBub3QgZm91bmQKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuU2V0dGluZ3NGcm9tTm9kZSAoIG5UYWJsZSApCgkJewoJCQlmb3IgKCB2YXIgaT0wIDsgaTxEYXRhVGFibGUuc2V0dGluZ3MubGVuZ3RoIDsgaSsrICkKCQkJewoJCQkJaWYgKCBEYXRhVGFibGUuc2V0dGluZ3NbaV0ublRhYmxlID09PSBuVGFibGUgKQoJCQkJewoJCQkJCXJldHVybiBEYXRhVGFibGUuc2V0dGluZ3NbaV07CgkJCQl9CgkJCX0KCQkJCgkJCXJldHVybiBudWxsOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBSZXR1cm4gYW4gYXJyYXkgd2l0aCB0aGUgVFIgbm9kZXMgZm9yIHRoZSB0YWJsZQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEByZXR1cm5zIHthcnJheX0gVFIgYXJyYXkKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuR2V0VHJOb2RlcyAoIG9TZXR0aW5ncyApCgkJewoJCQl2YXIgYU5vZGVzID0gW107CgkJCXZhciBhb0RhdGEgPSBvU2V0dGluZ3MuYW9EYXRhOwoJCQlmb3IgKCB2YXIgaT0wLCBpTGVuPWFvRGF0YS5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlpZiAoIGFvRGF0YVtpXS5uVHIgIT09IG51bGwgKQoJCQkJewoJCQkJCWFOb2Rlcy5wdXNoKCBhb0RhdGFbaV0ublRyICk7CgkJCQl9CgkJCX0KCQkJcmV0dXJuIGFOb2RlczsKCQl9CgkJCgkJCgkJLyoqCgkJICogUmV0dXJuIGFuIGZsYXQgYXJyYXkgd2l0aCBhbGwgVEQgbm9kZXMgZm9yIHRoZSB0YWJsZSwgb3Igcm93CgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtpbnR9IFtpSW5kaXZpZHVhbFJvd10gYW9EYXRhIGluZGV4IHRvIGdldCB0aGUgbm9kZXMgZm9yIC0gb3B0aW9uYWwgCgkJICogICAgaWYgbm90IGdpdmVuIHRoZW4gdGhlIHJldHVybiBhcnJheSB3aWxsIGNvbnRhaW4gYWxsIG5vZGVzIGZvciB0aGUgdGFibGUKCQkgKiAgQHJldHVybnMge2FycmF5fSBURCBhcnJheQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5HZXRUZE5vZGVzICggb1NldHRpbmdzLCBpSW5kaXZpZHVhbFJvdyApCgkJewoJCQl2YXIgYW5SZXR1cm4gPSBbXTsKCQkJdmFyIGlDb3JyZWN0b3I7CgkJCXZhciBhblRkczsKCQkJdmFyIGlSb3csIGlSb3dzPW9TZXR0aW5ncy5hb0RhdGEubGVuZ3RoLAoJCQkJaUNvbHVtbiwgaUNvbHVtbnMsIG9EYXRhLCBzTm9kZU5hbWUsIGlTdGFydD0wLCBpRW5kPWlSb3dzOwoJCQkKCQkJLyogQWxsb3cgdGhlIGNvbGxlY3Rpb24gdG8gYmUgbGltaXRlZCB0byBqdXN0IG9uZSByb3cgKi8KCQkJaWYgKCBpSW5kaXZpZHVhbFJvdyAhPT0gdW5kZWZpbmVkICkKCQkJewoJCQkJaVN0YXJ0ID0gaUluZGl2aWR1YWxSb3c7CgkJCQlpRW5kID0gaUluZGl2aWR1YWxSb3crMTsKCQkJfQoJCQoJCQlmb3IgKCBpUm93PWlTdGFydCA7IGlSb3c8aUVuZCA7IGlSb3crKyApCgkJCXsKCQkJCW9EYXRhID0gb1NldHRpbmdzLmFvRGF0YVtpUm93XTsKCQkJCWlmICggb0RhdGEublRyICE9PSBudWxsICkKCQkJCXsKCQkJCQkvKiBnZXQgdGhlIFREIGNoaWxkIG5vZGVzIC0gdGFraW5nIGludG8gYWNjb3VudCB0ZXh0IGV0YyBub2RlcyAqLwoJCQkJCWFuVGRzID0gW107CgkJCQkJZm9yICggaUNvbHVtbj0wLCBpQ29sdW1ucz1vRGF0YS5uVHIuY2hpbGROb2Rlcy5sZW5ndGggOyBpQ29sdW1uPGlDb2x1bW5zIDsgaUNvbHVtbisrICkKCQkJCQl7CgkJCQkJCXNOb2RlTmFtZSA9IG9EYXRhLm5Uci5jaGlsZE5vZGVzW2lDb2x1bW5dLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7CgkJCQkJCWlmICggc05vZGVOYW1lID09ICd0ZCcgfHwgc05vZGVOYW1lID09ICd0aCcgKQoJCQkJCQl7CgkJCQkJCQlhblRkcy5wdXNoKCBvRGF0YS5uVHIuY2hpbGROb2Rlc1tpQ29sdW1uXSApOwoJCQkJCQl9CgkJCQkJfQoJCQoJCQkJCWlDb3JyZWN0b3IgPSAwOwoJCQkJCWZvciAoIGlDb2x1bW49MCwgaUNvbHVtbnM9b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpQ29sdW1uPGlDb2x1bW5zIDsgaUNvbHVtbisrICkKCQkJCQl7CgkJCQkJCWlmICggb1NldHRpbmdzLmFvQ29sdW1uc1tpQ29sdW1uXS5iVmlzaWJsZSApCgkJCQkJCXsKCQkJCQkJCWFuUmV0dXJuLnB1c2goIGFuVGRzW2lDb2x1bW4taUNvcnJlY3Rvcl0gKTsKCQkJCQkJfQoJCQkJCQllbHNlCgkJCQkJCXsKCQkJCQkJCWFuUmV0dXJuLnB1c2goIG9EYXRhLl9hbkhpZGRlbltpQ29sdW1uXSApOwoJCQkJCQkJaUNvcnJlY3RvcisrOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJCgkJCXJldHVybiBhblJldHVybjsKCQl9CgkJCgkJCgkJLyoqCgkJICogTG9nIGFuIGVycm9yIG1lc3NhZ2UKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge2ludH0gaUxldmVsIGxvZyBlcnJvciBtZXNzYWdlcywgb3IgZGlzcGxheSB0aGVtIHRvIHRoZSB1c2VyCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzTWVzZyBlcnJvciBtZXNzYWdlCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkxvZyggb1NldHRpbmdzLCBpTGV2ZWwsIHNNZXNnICkKCQl7CgkJCXZhciBzQWxlcnQgPSAob1NldHRpbmdzPT09bnVsbCkgPwoJCQkJIkRhdGFUYWJsZXMgd2FybmluZzogIitzTWVzZyA6CgkJCQkiRGF0YVRhYmxlcyB3YXJuaW5nICh0YWJsZSBpZCA9ICciK29TZXR0aW5ncy5zVGFibGVJZCsiJyk6ICIrc01lc2c7CgkJCQoJCQlpZiAoIGlMZXZlbCA9PT0gMCApCgkJCXsKCQkJCWlmICggRGF0YVRhYmxlLmV4dC5zRXJyTW9kZSA9PSAnYWxlcnQnICkKCQkJCXsKCQkJCQlhbGVydCggc0FsZXJ0ICk7CgkJCQl9CgkJCQllbHNlCgkJCQl7CgkJCQkJdGhyb3cgbmV3IEVycm9yKHNBbGVydCk7CgkJCQl9CgkJCQlyZXR1cm47CgkJCX0KCQkJZWxzZSBpZiAoIHdpbmRvdy5jb25zb2xlICYmIGNvbnNvbGUubG9nICkKCQkJewoJCQkJY29uc29sZS5sb2coIHNBbGVydCApOwoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIFNlZSBpZiBhIHByb3BlcnR5IGlzIGRlZmluZWQgb24gb25lIG9iamVjdCwgaWYgc28gYXNzaWduIGl0IHRvIHRoZSBvdGhlciBvYmplY3QKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9SZXQgdGFyZ2V0IG9iamVjdAoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NyYyBzb3VyY2Ugb2JqZWN0CgkJICogIEBwYXJhbSB7c3RyaW5nfSBzTmFtZSBwcm9wZXJ0eQoJCSAqICBAcGFyYW0ge3N0cmluZ30gW3NNYXBwZWROYW1lXSBuYW1lIHRvIG1hcCB0b28gLSBvcHRpb25hbCwgc05hbWUgdXNlZCBpZiBub3QgZ2l2ZW4KCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuTWFwKCBvUmV0LCBvU3JjLCBzTmFtZSwgc01hcHBlZE5hbWUgKQoJCXsKCQkJaWYgKCBzTWFwcGVkTmFtZSA9PT0gdW5kZWZpbmVkICkKCQkJewoJCQkJc01hcHBlZE5hbWUgPSBzTmFtZTsKCQkJfQoJCQlpZiAoIG9TcmNbc05hbWVdICE9PSB1bmRlZmluZWQgKQoJCQl7CgkJCQlvUmV0W3NNYXBwZWROYW1lXSA9IG9TcmNbc05hbWVdOwoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEV4dGVuZCBvYmplY3RzIC0gdmVyeSBzaW1pbGFyIHRvIGpRdWVyeS5leHRlbmQsIGJ1dCBkZWVwIGNvcHkgb2JqZWN0cywgYW5kIHNoYWxsb3cKCQkgKiBjb3B5IGFycmF5cy4gVGhlIHJlYXNvbiB3ZSBuZWVkIHRvIGRvIHRoaXMsIGlzIHRoYXQgd2UgZG9uJ3Qgd2FudCB0byBkZWVwIGNvcHkgYXJyYXkKCQkgKiBpbml0IHZhbHVlcyAoc3VjaCBhcyBhYVNvcnRpbmcpIHNpbmNlIHRoZSBkZXYgd291bGRuJ3QgYmUgYWJsZSB0byBvdmVycmlkZSB0aGVtLCBidXQKCQkgKiB3ZSBkbyB3YW50IHRvIGRlZXAgY29weSBhcnJheXMuCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvT3V0IE9iamVjdCB0byBleHRlbmQKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9FeHRlbmRlciBPYmplY3QgZnJvbSB3aGljaCB0aGUgcHJvcGVydGllcyB3aWxsIGJlIGFwcGxpZWQgdG8gb091dAoJCSAqICBAcmV0dXJucyB7b2JqZWN0fSBvT3V0IFJlZmVyZW5jZSwganVzdCBmb3IgY29udmVuaWVuY2UgLSBvT3V0ID09PSB0aGUgcmV0dXJuLgoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKiAgQHRvZG8gVGhpcyBkb2Vzbid0IHRha2UgYWNjb3VudCBvZiBhcnJheXMgaW5zaWRlIHRoZSBkZWVwIGNvcGllZCBvYmplY3RzLgoJCSAqLwoJCWZ1bmN0aW9uIF9mbkV4dGVuZCggb091dCwgb0V4dGVuZGVyICkKCQl7CgkJCWZvciAoIHZhciBwcm9wIGluIG9FeHRlbmRlciApCgkJCXsKCQkJCWlmICggb0V4dGVuZGVyLmhhc093blByb3BlcnR5KHByb3ApICkKCQkJCXsKCQkJCQlpZiAoIHR5cGVvZiBvSW5pdFtwcm9wXSA9PT0gJ29iamVjdCcgJiYgJC5pc0FycmF5KG9FeHRlbmRlcltwcm9wXSkgPT09IGZhbHNlICkKCQkJCQl7CgkJCQkJCSQuZXh0ZW5kKCB0cnVlLCBvT3V0W3Byb3BdLCBvRXh0ZW5kZXJbcHJvcF0gKTsKCQkJCQl9CgkJCQkJZWxzZQoJCQkJCXsKCQkJCQkJb091dFtwcm9wXSA9IG9FeHRlbmRlcltwcm9wXTsKCQkJCQl9CgkJCQl9CgkJCX0KCQkKCQkJcmV0dXJuIG9PdXQ7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEJpbmQgYW4gZXZlbnQgaGFuZGVycyB0byBhbGxvdyBhIGNsaWNrIG9yIHJldHVybiBrZXkgdG8gYWN0aXZhdGUgdGhlIGNhbGxiYWNrLgoJCSAqIFRoaXMgaXMgZ29vZCBmb3IgYWNjZXNzYWJpbGl0eSBzaW5jZSBhIHJldHVybiBvbiB0aGUga2V5Ym9hcmQgd2lsbCBoYXZlIHRoZQoJCSAqIHNhbWUgZWZmZWN0IGFzIGEgY2xpY2ssIGlmIHRoZSBlbGVtZW50IGhhcyBmb2N1cy4KCQkgKiAgQHBhcmFtIHtlbGVtZW50fSBuIEVsZW1lbnQgdG8gYmluZCB0aGUgYWN0aW9uIHRvCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvRGF0YSBEYXRhIG9iamVjdCB0byBwYXNzIHRvIHRoZSB0cmlnZ2VyZWQgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHtmdW5jdGlvbn0gZm4gQ2FsbGJhY2sgZnVuY3Rpb24gZm9yIHdoZW4gdGhlIGV2ZW50IGlzIHRyaWdnZXJlZAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5CaW5kQWN0aW9uKCBuLCBvRGF0YSwgZm4gKQoJCXsKCQkJJChuKQoJCQkJLmJpbmQoICdjbGljay5EVCcsIG9EYXRhLCBmdW5jdGlvbiAoZSkgewoJCQkJCQluLmJsdXIoKTsgLy8gUmVtb3ZlIGZvY3VzIG91dGxpbmUgZm9yIG1vdXNlIHVzZXJzCgkJCQkJCWZuKGUpOwoJCQkJCX0gKQoJCQkJLmJpbmQoICdrZXlwcmVzcy5EVCcsIG9EYXRhLCBmdW5jdGlvbiAoZSl7CgkJCQkJaWYgKCBlLndoaWNoID09PSAxMyApIHsKCQkJCQkJZm4oZSk7CgkJCQkJfSB9ICkKCQkJCS5iaW5kKCAnc2VsZWN0c3RhcnQuRFQnLCBmdW5jdGlvbiAoKSB7CgkJCQkJLyogVGFrZSB0aGUgYnJ1dGFsIGFwcHJvYWNoIHRvIGNhbmNlbGxpbmcgdGV4dCBzZWxlY3Rpb24gKi8KCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQkJfSApOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBSZWdpc3RlciBhIGNhbGxiYWNrIGZ1bmN0aW9uLiBFYXNpbHkgYWxsb3dzIGEgY2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgYWRkZWQgdG8KCQkgKiBhbiBhcnJheSBzdG9yZSBvZiBjYWxsYmFjayBmdW5jdGlvbnMgdGhhdCBjYW4gdGhlbiBhbGwgYmUgY2FsbGVkIHRvZ2V0aGVyLgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7c3RyaW5nfSBzU3RvcmUgTmFtZSBvZiB0aGUgYXJyYXkgc3RvcmVhZ2UgZm9yIHRoZSBjYWxsYmFja3MgaW4gb1NldHRpbmdzCgkJICogIEBwYXJhbSB7ZnVuY3Rpb259IGZuIEZ1bmN0aW9uIHRvIGJlIGNhbGxlZCBiYWNrCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzTmFtZSBJZGVudGlmeWluZyBuYW1lIGZvciB0aGUgY2FsbGJhY2sgKGkuZS4gYSBsYWJlbCkKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuQ2FsbGJhY2tSZWcoIG9TZXR0aW5ncywgc1N0b3JlLCBmbiwgc05hbWUgKQoJCXsKCQkJaWYgKCBmbiApCgkJCXsKCQkJCW9TZXR0aW5nc1tzU3RvcmVdLnB1c2goIHsKCQkJCQkiZm4iOiBmbiwKCQkJCQkic05hbWUiOiBzTmFtZQoJCQkJfSApOwoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEZpcmUgY2FsbGJhY2sgZnVuY3Rpb25zIGFuZCB0cmlnZ2VyIGV2ZW50cy4gTm90ZSB0aGF0IHRoZSBsb29wIG92ZXIgdGhlIGNhbGxiYWNrCgkJICogYXJyYXkgc3RvcmUgaXMgZG9uZSBiYWNrd2FyZHMhIEZ1cnRoZXIgbm90ZSB0aGF0IHlvdSBkbyBub3Qgd2FudCB0byBmaXJlIG9mZiB0cmlnZ2VycwoJCSAqIGluIHRpbWUgc2Vuc2l0aXZlIGFwcGxpY2F0aW9ucyAoZm9yIGV4YW1wbGUgY2VsbCBjcmVhdGlvbikgYXMgaXRzIHNsb3cuCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNTdG9yZSBOYW1lIG9mIHRoZSBhcnJheSBzdG9yZWFnZSBmb3IgdGhlIGNhbGxiYWNrcyBpbiBvU2V0dGluZ3MKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNUcmlnZ2VyIE5hbWUgb2YgdGhlIGpRdWVyeSBjdXN0b20gZXZlbnQgdG8gdHJpZ2dlci4gSWYgbnVsbCBubyB0cmlnZ2VyCgkJICogICAgaXMgZmlyZWQKCQkgKiAgQHBhcmFtIHthcnJheX0gYUFyZ3MgQXJyYXkgb2YgYXJndW1lbnRzIHRvIHBhc3MgdG8gdGhlIGNhbGxiYWNrIGZ1bmN0aW9uIC8gdHJpZ2dlcgoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5DYWxsYmFja0ZpcmUoIG9TZXR0aW5ncywgc1N0b3JlLCBzVHJpZ2dlciwgYUFyZ3MgKQoJCXsKCQkJdmFyIGFvU3RvcmUgPSBvU2V0dGluZ3Nbc1N0b3JlXTsKCQkJdmFyIGFSZXQgPVtdOwoJCQoJCQlmb3IgKCB2YXIgaT1hb1N0b3JlLmxlbmd0aC0xIDsgaT49MCA7IGktLSApCgkJCXsKCQkJCWFSZXQucHVzaCggYW9TdG9yZVtpXS5mbi5hcHBseSggb1NldHRpbmdzLm9JbnN0YW5jZSwgYUFyZ3MgKSApOwoJCQl9CgkJCgkJCWlmICggc1RyaWdnZXIgIT09IG51bGwgKQoJCQl7CgkJCQkkKG9TZXR0aW5ncy5vSW5zdGFuY2UpLnRyaWdnZXIoc1RyaWdnZXIsIGFBcmdzKTsKCQkJfQoJCQoJCQlyZXR1cm4gYVJldDsKCQl9CgkJCgkJCgkJLyoqCgkJICogSlNPTiBzdHJpbmdpZnkuIElmIEpTT04uc3RyaW5naWZ5IGl0IHByb3ZpZGVkIGJ5IHRoZSBicm93c2VyLCBqc29uMi5qcyBvciBhbnkgb3RoZXIKCQkgKiBsaWJyYXJ5LCB0aGVuIHdlIHVzZSB0aGF0IGFzIGl0IGlzIGZhc3QsIHNhZmUgYW5kIGFjY3VyYXRlLiBJZiB0aGUgZnVuY3Rpb24gaXNuJ3QgCgkJICogYXZhaWxhYmxlIHRoZW4gd2UgbmVlZCB0byBidWlsdCBpdCBvdXJzZWx2ZXMgLSB0aGUgaW5zcGVyYXRpb24gZm9yIHRoaXMgZnVuY3Rpb24gY29tZXMKCQkgKiBmcm9tIENyYWlnIEJ1Y2tsZXIgKCBodHRwOi8vd3d3LnNpdGVwb2ludC5jb20vamF2YXNjcmlwdC1qc29uLXNlcmlhbGl6YXRpb24vICkuIEl0IGlzCgkJICogbm90IHBlcmZlY3QgYW5kIGFic29sdXRlbHkgc2hvdWxkIG5vdCBiZSB1c2VkIGFzIGEgcmVwbGFjZW1lbnQgdG8ganNvbjIuanMgLSBidXQgaXQgZG9lcwoJCSAqIGRvIHdoYXQgd2UgbmVlZCwgd2l0aG91dCByZXF1aXJpbmcgYSBkZXBlbmRlbmN5IGZvciBEYXRhVGFibGVzLgoJCSAqICBAcGFyYW0ge29iamVjdH0gbyBKU09OIG9iamVjdCB0byBiZSBjb252ZXJ0ZWQKCQkgKiAgQHJldHVybnMge3N0cmluZ30gSlNPTiBzdHJpbmcKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJdmFyIF9mbkpzb25TdHJpbmcgPSAod2luZG93LkpTT04pID8gSlNPTi5zdHJpbmdpZnkgOiBmdW5jdGlvbiggbyApCgkJewoJCQkvKiBOb3QgYW4gb2JqZWN0IG9yIGFycmF5ICovCgkJCXZhciBzVHlwZSA9IHR5cGVvZiBvOwoJCQlpZiAoc1R5cGUgIT09ICJvYmplY3QiIHx8IG8gPT09IG51bGwpCgkJCXsKCQkJCS8vIHNpbXBsZSBkYXRhIHR5cGUKCQkJCWlmIChzVHlwZSA9PT0gInN0cmluZyIpCgkJCQl7CgkJCQkJbyA9ICciJytvKyciJzsKCQkJCX0KCQkJCXJldHVybiBvKyIiOwoJCQl9CgkJCgkJCS8qIElmIG9iamVjdCBvciBhcnJheSwgbmVlZCB0byByZWN1cnNlIG92ZXIgaXQgKi8KCQkJdmFyCgkJCQlzUHJvcCwgbVZhbHVlLAoJCQkJanNvbiA9IFtdLAoJCQkJYkFyciA9ICQuaXNBcnJheShvKTsKCQkJCgkJCWZvciAoc1Byb3AgaW4gbykKCQkJewoJCQkJbVZhbHVlID0gb1tzUHJvcF07CgkJCQlzVHlwZSA9IHR5cGVvZiBtVmFsdWU7CgkJCgkJCQlpZiAoc1R5cGUgPT09ICJzdHJpbmciKQoJCQkJewoJCQkJCW1WYWx1ZSA9ICciJyttVmFsdWUrJyInOwoJCQkJfQoJCQkJZWxzZSBpZiAoc1R5cGUgPT09ICJvYmplY3QiICYmIG1WYWx1ZSAhPT0gbnVsbCkKCQkJCXsKCQkJCQltVmFsdWUgPSBfZm5Kc29uU3RyaW5nKG1WYWx1ZSk7CgkJCQl9CgkJCgkJCQlqc29uLnB1c2goKGJBcnIgPyAiIiA6ICciJytzUHJvcCsnIjonKSArIG1WYWx1ZSk7CgkJCX0KCQkKCQkJcmV0dXJuIChiQXJyID8gIlsiIDogInsiKSArIGpzb24gKyAoYkFyciA/ICJdIiA6ICJ9Iik7CgkJfTsKCQkKCgkJCgkJCgkJLyoqCgkJICogUGVyZm9ybSBhIGpRdWVyeSBzZWxlY3RvciBhY3Rpb24gb24gdGhlIHRhYmxlJ3MgVFIgZWxlbWVudHMgKGZyb20gdGhlIHRib2R5KSBhbmQKCQkgKiByZXR1cm4gdGhlIHJlc3VsdGluZyBqUXVlcnkgb2JqZWN0LgoJCSAqICBAcGFyYW0ge3N0cmluZ3xub2RlfGpRdWVyeX0gc1NlbGVjdG9yIGpRdWVyeSBzZWxlY3RvciBvciBub2RlIGNvbGxlY3Rpb24gdG8gYWN0IG9uCgkJICogIEBwYXJhbSB7b2JqZWN0fSBbb09wdHNdIE9wdGlvbmFsIHBhcmFtZXRlcnMgZm9yIG1vZGlmeWluZyB0aGUgcm93cyB0byBiZSBpbmNsdWRlZAoJCSAqICBAcGFyYW0ge3N0cmluZ30gW29PcHRzLmZpbHRlcj1ub25lXSBTZWxlY3QgVFIgZWxlbWVudHMgdGhhdCBtZWV0IHRoZSBjdXJyZW50IGZpbHRlcgoJCSAqICAgIGNyaXRlcmlvbiAoImFwcGxpZWQiKSBvciBhbGwgVFIgZWxlbWVudHMgKGkuZS4gbm8gZmlsdGVyKS4KCQkgKiAgQHBhcmFtIHtzdHJpbmd9IFtvT3B0cy5vcmRlcj1jdXJyZW50XSBPcmRlciBvZiB0aGUgVFIgZWxlbWVudHMgaW4gdGhlIHByb2Nlc3NlZCBhcnJheS4KCQkgKiAgICBDYW4gYmUgZWl0aGVyICdjdXJyZW50Jywgd2hlcmVieSB0aGUgY3VycmVudCBzb3J0aW5nIG9mIHRoZSB0YWJsZSBpcyB1c2VkLCBvcgoJCSAqICAgICdvcmlnaW5hbCcgd2hlcmVieSB0aGUgb3JpZ2luYWwgb3JkZXIgdGhlIGRhdGEgd2FzIHJlYWQgaW50byB0aGUgdGFibGUgaXMgdXNlZC4KCQkgKiAgQHBhcmFtIHtzdHJpbmd9IFtvT3B0cy5wYWdlPWFsbF0gTGltaXQgdGhlIHNlbGVjdGlvbiB0byB0aGUgY3VycmVudGx5IGRpc3BsYXllZCBwYWdlCgkJICogICAgKCJjdXJyZW50Iikgb3Igbm90ICgiYWxsIikuIElmICdjdXJyZW50JyBpcyBnaXZlbiwgdGhlbiBvcmRlciBpcyBhc3N1bWVkIHRvIGJlIAoJCSAqICAgICdjdXJyZW50JyBhbmQgZmlsdGVyIGlzICdhcHBsaWVkJywgcmVnYXJkbGVzcyBvZiB3aGF0IHRoZXkgbWlnaHQgYmUgZ2l2ZW4gYXMuCgkJICogIEByZXR1cm5zIHtvYmplY3R9IGpRdWVyeSBvYmplY3QsIGZpbHRlcmVkIGJ5IHRoZSBnaXZlbiBzZWxlY3Rvci4KCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKgoJCSAqICAgICAgLy8gSGlnaGxpZ2h0IGV2ZXJ5IHNlY29uZCByb3cKCQkgKiAgICAgIG9UYWJsZS4kKCd0cjpvZGQnKS5jc3MoJ2JhY2tncm91bmRDb2xvcicsICdibHVlJyk7CgkJICogICAgfSApOwoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKgoJCSAqICAgICAgLy8gRmlsdGVyIHRvIHJvd3Mgd2l0aCAnV2Via2l0JyBpbiB0aGVtLCBhZGQgYSBiYWNrZ3JvdW5kIGNvbG91ciBhbmQgdGhlbgoJCSAqICAgICAgLy8gcmVtb3ZlIHRoZSBmaWx0ZXIsIHRodXMgaGlnaGxpZ2h0aW5nIHRoZSAnV2Via2l0JyByb3dzIG9ubHkuCgkJICogICAgICBvVGFibGUuZm5GaWx0ZXIoJ1dlYmtpdCcpOwoJCSAqICAgICAgb1RhYmxlLiQoJ3RyJywgeyJmaWx0ZXIiOiAiYXBwbGllZCJ9KS5jc3MoJ2JhY2tncm91bmRDb2xvcicsICdibHVlJyk7CgkJICogICAgICBvVGFibGUuZm5GaWx0ZXIoJycpOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLiQgPSBmdW5jdGlvbiAoIHNTZWxlY3Rvciwgb09wdHMgKQoJCXsKCQkJdmFyIGksIGlMZW4sIGEgPSBbXSwgdHI7CgkJCXZhciBvU2V0dGluZ3MgPSBfZm5TZXR0aW5nc0Zyb21Ob2RlKCB0aGlzW0RhdGFUYWJsZS5leHQuaUFwaUluZGV4XSApOwoJCQl2YXIgYW9EYXRhID0gb1NldHRpbmdzLmFvRGF0YTsKCQkJdmFyIGFpRGlzcGxheSA9IG9TZXR0aW5ncy5haURpc3BsYXk7CgkJCXZhciBhaURpc3BsYXlNYXN0ZXIgPSBvU2V0dGluZ3MuYWlEaXNwbGF5TWFzdGVyOwoJCQoJCQlpZiAoICFvT3B0cyApCgkJCXsKCQkJCW9PcHRzID0ge307CgkJCX0KCQkKCQkJb09wdHMgPSAkLmV4dGVuZCgge30sIHsKCQkJCSJmaWx0ZXIiOiAibm9uZSIsIC8vIGFwcGxpZWQKCQkJCSJvcmRlciI6ICJjdXJyZW50IiwgLy8gIm9yaWdpbmFsIgoJCQkJInBhZ2UiOiAiYWxsIiAvLyBjdXJyZW50CgkJCX0sIG9PcHRzICk7CgkJCgkJCS8vIEN1cnJlbnQgcGFnZSBpbXBsaWVzIHRoYXQgb3JkZXI9Y3VycmVudCBhbmQgZml0bGVyPWFwcGxpZWQsIHNpbmNlIGl0IGlzIGZhaXJseQoJCQkvLyBzZW5zZWxlc3Mgb3RoZXJ3aXNlCgkJCWlmICggb09wdHMucGFnZSA9PSAnY3VycmVudCcgKQoJCQl7CgkJCQlmb3IgKCBpPW9TZXR0aW5ncy5faURpc3BsYXlTdGFydCwgaUxlbj1vU2V0dGluZ3MuZm5EaXNwbGF5RW5kKCkgOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCXRyID0gYW9EYXRhWyBhaURpc3BsYXlbaV0gXS5uVHI7CgkJCQkJaWYgKCB0ciApCgkJCQkJewoJCQkJCQlhLnB1c2goIHRyICk7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCWVsc2UgaWYgKCBvT3B0cy5vcmRlciA9PSAiY3VycmVudCIgJiYgb09wdHMuZmlsdGVyID09ICJub25lIiApCgkJCXsKCQkJCWZvciAoIGk9MCwgaUxlbj1haURpc3BsYXlNYXN0ZXIubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQl0ciA9IGFvRGF0YVsgYWlEaXNwbGF5TWFzdGVyW2ldIF0ublRyOwoJCQkJCWlmICggdHIgKQoJCQkJCXsKCQkJCQkJYS5wdXNoKCB0ciApOwoJCQkJCX0KCQkJCX0KCQkJfQoJCQllbHNlIGlmICggb09wdHMub3JkZXIgPT0gImN1cnJlbnQiICYmIG9PcHRzLmZpbHRlciA9PSAiYXBwbGllZCIgKQoJCQl7CgkJCQlmb3IgKCBpPTAsIGlMZW49YWlEaXNwbGF5Lmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJdHIgPSBhb0RhdGFbIGFpRGlzcGxheVtpXSBdLm5UcjsKCQkJCQlpZiAoIHRyICkKCQkJCQl7CgkJCQkJCWEucHVzaCggdHIgKTsKCQkJCQl9CgkJCQl9CgkJCX0KCQkJZWxzZSBpZiAoIG9PcHRzLm9yZGVyID09ICJvcmlnaW5hbCIgJiYgb09wdHMuZmlsdGVyID09ICJub25lIiApCgkJCXsKCQkJCWZvciAoIGk9MCwgaUxlbj1hb0RhdGEubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQl0ciA9IGFvRGF0YVsgaSBdLm5UciA7CgkJCQkJaWYgKCB0ciApCgkJCQkJewoJCQkJCQlhLnB1c2goIHRyICk7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCWVsc2UgaWYgKCBvT3B0cy5vcmRlciA9PSAib3JpZ2luYWwiICYmIG9PcHRzLmZpbHRlciA9PSAiYXBwbGllZCIgKQoJCQl7CgkJCQlmb3IgKCBpPTAsIGlMZW49YW9EYXRhLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJdHIgPSBhb0RhdGFbIGkgXS5uVHI7CgkJCQkJaWYgKCAkLmluQXJyYXkoIGksIGFpRGlzcGxheSApICE9PSAtMSAmJiB0ciApCgkJCQkJewoJCQkJCQlhLnB1c2goIHRyICk7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCWVsc2UKCQkJewoJCQkJX2ZuTG9nKCBvU2V0dGluZ3MsIDEsICJVbmtub3duIHNlbGVjdGlvbiBvcHRpb25zIiApOwoJCQl9CgkJCgkJCS8qIFdlIG5lZWQgdG8gZmlsdGVyIG9uIHRoZSBUUiBlbGVtZW50cyBhbmQgYWxzbyAnZmluZCcgaW4gdGhlaXIgZGVzY2VuZGFudHMKCQkJICogdG8gbWFrZSB0aGUgc2VsZWN0b3IgYWN0IGxpa2UgaXQgd291bGQgaW4gYSBmdWxsIHRhYmxlIC0gc28gd2UgbmVlZAoJCQkgKiB0byBidWlsZCBib3RoIHJlc3VsdHMgYW5kIHRoZW4gY29tYmluZSB0aGVtIHRvZ2V0aGVyCgkJCSAqLwoJCQl2YXIganFBID0gJChhKTsKCQkJdmFyIGpxVFJzID0ganFBLmZpbHRlciggc1NlbGVjdG9yICk7CgkJCXZhciBqcURlc2NlbmRhbnRzID0ganFBLmZpbmQoIHNTZWxlY3RvciApOwoJCQoJCQlyZXR1cm4gJCggW10uY29uY2F0KCQubWFrZUFycmF5KGpxVFJzKSwgJC5tYWtlQXJyYXkoanFEZXNjZW5kYW50cykpICk7CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBBbG1vc3QgaWRlbnRpY2FsIHRvICQgaW4gb3BlcmF0aW9uLCBidXQgaW4gdGhpcyBjYXNlIHJldHVybnMgdGhlIGRhdGEgZm9yIHRoZSBtYXRjaGVkCgkJICogcm93cyAtIGFzIHN1Y2gsIHRoZSBqUXVlcnkgc2VsZWN0b3IgdXNlZCBzaG91bGQgbWF0Y2ggVFIgcm93IG5vZGVzIG9yIFREL1RIIGNlbGwgbm9kZXMKCQkgKiByYXRoZXIgdGhhbiBhbnkgZGVjZW5kZW50cywgc28gdGhlIGRhdGEgY2FuIGJlIG9idGFpbmVkIGZvciB0aGUgcm93L2NlbGwuIElmIG1hdGNoaW5nCgkJICogcm93cyBhcmUgZm91bmQsIHRoZSBkYXRhIHJldHVybmVkIGlzIHRoZSBvcmlnaW5hbCBkYXRhIGFycmF5L29iamVjdCB0aGF0IHdhcyB1c2VkIHRvICAKCQkgKiBjcmVhdGUgdGhlIHJvdyAob3IgYSBnZW5lcmF0ZWQgYXJyYXkgaWYgZnJvbSBhIERPTSBzb3VyY2UpLgoJCSAqCgkJICogVGhpcyBtZXRob2QgaXMgb2Z0ZW4gdXNlZnVsIGluY29tYmluYXRpb24gd2l0aCAkIHdoZXJlIGJvdGggZnVuY3Rpb25zIGFyZSBnaXZlbiB0aGUKCQkgKiBzYW1lIHBhcmFtZXRlcnMgYW5kIHRoZSBhcnJheSBpbmRleGVzIHdpbGwgbWF0Y2ggaWRlbnRpY2FsbHkuCgkJICogIEBwYXJhbSB7c3RyaW5nfG5vZGV8alF1ZXJ5fSBzU2VsZWN0b3IgalF1ZXJ5IHNlbGVjdG9yIG9yIG5vZGUgY29sbGVjdGlvbiB0byBhY3Qgb24KCQkgKiAgQHBhcmFtIHtvYmplY3R9IFtvT3B0c10gT3B0aW9uYWwgcGFyYW1ldGVycyBmb3IgbW9kaWZ5aW5nIHRoZSByb3dzIHRvIGJlIGluY2x1ZGVkCgkJICogIEBwYXJhbSB7c3RyaW5nfSBbb09wdHMuZmlsdGVyPW5vbmVdIFNlbGVjdCBlbGVtZW50cyB0aGF0IG1lZXQgdGhlIGN1cnJlbnQgZmlsdGVyCgkJICogICAgY3JpdGVyaW9uICgiYXBwbGllZCIpIG9yIGFsbCBlbGVtZW50cyAoaS5lLiBubyBmaWx0ZXIpLgoJCSAqICBAcGFyYW0ge3N0cmluZ30gW29PcHRzLm9yZGVyPWN1cnJlbnRdIE9yZGVyIG9mIHRoZSBkYXRhIGluIHRoZSBwcm9jZXNzZWQgYXJyYXkuCgkJICogICAgQ2FuIGJlIGVpdGhlciAnY3VycmVudCcsIHdoZXJlYnkgdGhlIGN1cnJlbnQgc29ydGluZyBvZiB0aGUgdGFibGUgaXMgdXNlZCwgb3IKCQkgKiAgICAnb3JpZ2luYWwnIHdoZXJlYnkgdGhlIG9yaWdpbmFsIG9yZGVyIHRoZSBkYXRhIHdhcyByZWFkIGludG8gdGhlIHRhYmxlIGlzIHVzZWQuCgkJICogIEBwYXJhbSB7c3RyaW5nfSBbb09wdHMucGFnZT1hbGxdIExpbWl0IHRoZSBzZWxlY3Rpb24gdG8gdGhlIGN1cnJlbnRseSBkaXNwbGF5ZWQgcGFnZQoJCSAqICAgICgiY3VycmVudCIpIG9yIG5vdCAoImFsbCIpLiBJZiAnY3VycmVudCcgaXMgZ2l2ZW4sIHRoZW4gb3JkZXIgaXMgYXNzdW1lZCB0byBiZSAKCQkgKiAgICAnY3VycmVudCcgYW5kIGZpbHRlciBpcyAnYXBwbGllZCcsIHJlZ2FyZGxlc3Mgb2Ygd2hhdCB0aGV5IG1pZ2h0IGJlIGdpdmVuIGFzLgoJCSAqICBAcmV0dXJucyB7YXJyYXl9IERhdGEgZm9yIHRoZSBtYXRjaGVkIGVsZW1lbnRzLiBJZiBhbnkgZWxlbWVudHMsIGFzIGEgcmVzdWx0IG9mIHRoZQoJCSAqICAgIHNlbGVjdG9yLCB3ZXJlIG5vdCBUUiwgVEQgb3IgVEggZWxlbWVudHMgaW4gdGhlIERhdGFUYWJsZSwgdGhleSB3aWxsIGhhdmUgYSBudWxsIAoJCSAqICAgIGVudHJ5IGluIHRoZSBhcnJheS4KCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKgoJCSAqICAgICAgLy8gR2V0IHRoZSBkYXRhIGZyb20gdGhlIGZpcnN0IHJvdyBpbiB0aGUgdGFibGUKCQkgKiAgICAgIHZhciBkYXRhID0gb1RhYmxlLl8oJ3RyOmZpcnN0Jyk7CgkJICoKCQkgKiAgICAgIC8vIERvIHNvbWV0aGluZyB1c2VmdWwgd2l0aCB0aGUgZGF0YQoJCSAqICAgICAgYWxlcnQoICJGaXJzdCBjZWxsIGlzOiAiK2RhdGFbMF0gKTsKCQkgKiAgICB9ICk7CgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqCgkJICogICAgICAvLyBGaWx0ZXIgdG8gJ1dlYmtpdCcgYW5kIGdldCBhbGwgZGF0YSBmb3IgCgkJICogICAgICBvVGFibGUuZm5GaWx0ZXIoJ1dlYmtpdCcpOwoJCSAqICAgICAgdmFyIGRhdGEgPSBvVGFibGUuXygndHInLCB7ImZpbHRlciI6ICJhcHBsaWVkIn0pOwoJCSAqICAgICAgCgkJICogICAgICAvLyBEbyBzb21ldGhpbmcgd2l0aCB0aGUgZGF0YQoJCSAqICAgICAgYWxlcnQoIGRhdGEubGVuZ3RoKyIgcm93cyBtYXRjaGVkIHRoZSBmaWx0ZXIiICk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuXyA9IGZ1bmN0aW9uICggc1NlbGVjdG9yLCBvT3B0cyApCgkJewoJCQl2YXIgYU91dCA9IFtdOwoJCQl2YXIgaSwgaUxlbiwgaUluZGV4OwoJCQl2YXIgYVRycyA9IHRoaXMuJCggc1NlbGVjdG9yLCBvT3B0cyApOwoJCQoJCQlmb3IgKCBpPTAsIGlMZW49YVRycy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlhT3V0LnB1c2goIHRoaXMuZm5HZXREYXRhKGFUcnNbaV0pICk7CgkJCX0KCQkKCQkJcmV0dXJuIGFPdXQ7CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBBZGQgYSBzaW5nbGUgbmV3IHJvdyBvciBtdWx0aXBsZSByb3dzIG9mIGRhdGEgdG8gdGhlIHRhYmxlLiBQbGVhc2Ugbm90ZQoJCSAqIHRoYXQgdGhpcyBpcyBzdWl0YWJsZSBmb3IgY2xpZW50LXNpZGUgcHJvY2Vzc2luZyBvbmx5IC0gaWYgeW91IGFyZSB1c2luZyAKCQkgKiBzZXJ2ZXItc2lkZSBwcm9jZXNzaW5nIChpLmUuICJiU2VydmVyU2lkZSI6IHRydWUpLCB0aGVuIHRvIGFkZCBkYXRhLCB5b3UKCQkgKiBtdXN0IGFkZCBpdCB0byB0aGUgZGF0YSBzb3VyY2UsIGkuZS4gdGhlIHNlcnZlci1zaWRlLCB0aHJvdWdoIGFuIEFqYXggY2FsbC4KCQkgKiAgQHBhcmFtIHthcnJheXxvYmplY3R9IG1EYXRhIFRoZSBkYXRhIHRvIGJlIGFkZGVkIHRvIHRoZSB0YWJsZS4gVGhpcyBjYW4gYmU6CgkJICogICAgPHVsPgoJCSAqICAgICAgPGxpPjFEIGFycmF5IG9mIGRhdGEgLSBhZGQgYSBzaW5nbGUgcm93IHdpdGggdGhlIGRhdGEgcHJvdmlkZWQ8L2xpPgoJCSAqICAgICAgPGxpPjJEIGFycmF5IG9mIGFycmF5cyAtIGFkZCBtdWx0aXBsZSByb3dzIGluIGEgc2luZ2xlIGNhbGw8L2xpPgoJCSAqICAgICAgPGxpPm9iamVjdCAtIGRhdGEgb2JqZWN0IHdoZW4gdXNpbmcgPGk+bURhdGFQcm9wPC9pPjwvbGk+CgkJICogICAgICA8bGk+YXJyYXkgb2Ygb2JqZWN0cyAtIG11bHRpcGxlIGRhdGEgb2JqZWN0cyB3aGVuIHVzaW5nIDxpPm1EYXRhUHJvcDwvaT48L2xpPgoJCSAqICAgIDwvdWw+CgkJICogIEBwYXJhbSB7Ym9vbH0gW2JSZWRyYXc9dHJ1ZV0gcmVkcmF3IHRoZSB0YWJsZSBvciBub3QKCQkgKiAgQHJldHVybnMge2FycmF5fSBBbiBhcnJheSBvZiBpbnRlZ2VycywgcmVwcmVzZW50aW5nIHRoZSBsaXN0IG9mIGluZGV4ZXMgaW4gCgkJICogICAgPGk+YW9EYXRhPC9pPiAoe0BsaW5rIERhdGFUYWJsZS5tb2RlbHMub1NldHRpbmdzfSkgdGhhdCBoYXZlIGJlZW4gYWRkZWQgdG8gCgkJICogICAgdGhlIHRhYmxlLgoJCSAqICBAZHRvcHQgQVBJCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBHbG9iYWwgdmFyIGZvciBjb3VudGVyCgkJICogICAgdmFyIGdpQ291bnQgPSAyOwoJCSAqICAgIAoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogICAgZnVuY3Rpb24gZm5DbGlja0FkZFJvdygpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCkuZm5BZGREYXRhKCBbCgkJICogICAgICAgIGdpQ291bnQrIi4xIiwKCQkgKiAgICAgICAgZ2lDb3VudCsiLjIiLAoJCSAqICAgICAgICBnaUNvdW50KyIuMyIsCgkJICogICAgICAgIGdpQ291bnQrIi40IiBdCgkJICogICAgICApOwoJCSAqICAgICAgICAKCQkgKiAgICAgIGdpQ291bnQrKzsKCQkgKiAgICB9CgkJICovCgkJdGhpcy5mbkFkZERhdGEgPSBmdW5jdGlvbiggbURhdGEsIGJSZWRyYXcgKQoJCXsKCQkJaWYgKCBtRGF0YS5sZW5ndGggPT09IDAgKQoJCQl7CgkJCQlyZXR1cm4gW107CgkJCX0KCQkJCgkJCXZhciBhaVJldHVybiA9IFtdOwoJCQl2YXIgaVRlc3Q7CgkJCQoJCQkvKiBGaW5kIHNldHRpbmdzIGZyb20gdGFibGUgbm9kZSAqLwoJCQl2YXIgb1NldHRpbmdzID0gX2ZuU2V0dGluZ3NGcm9tTm9kZSggdGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0gKTsKCQkJCgkJCS8qIENoZWNrIGlmIHdlIHdhbnQgdG8gYWRkIG11bHRpcGxlIHJvd3Mgb3Igbm90ICovCgkJCWlmICggdHlwZW9mIG1EYXRhWzBdID09PSAib2JqZWN0IiAmJiBtRGF0YVswXSAhPT0gbnVsbCApCgkJCXsKCQkJCWZvciAoIHZhciBpPTAgOyBpPG1EYXRhLmxlbmd0aCA7IGkrKyApCgkJCQl7CgkJCQkJaVRlc3QgPSBfZm5BZGREYXRhKCBvU2V0dGluZ3MsIG1EYXRhW2ldICk7CgkJCQkJaWYgKCBpVGVzdCA9PSAtMSApCgkJCQkJewoJCQkJCQlyZXR1cm4gYWlSZXR1cm47CgkJCQkJfQoJCQkJCWFpUmV0dXJuLnB1c2goIGlUZXN0ICk7CgkJCQl9CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQlpVGVzdCA9IF9mbkFkZERhdGEoIG9TZXR0aW5ncywgbURhdGEgKTsKCQkJCWlmICggaVRlc3QgPT0gLTEgKQoJCQkJewoJCQkJCXJldHVybiBhaVJldHVybjsKCQkJCX0KCQkJCWFpUmV0dXJuLnB1c2goIGlUZXN0ICk7CgkJCX0KCQkJCgkJCW9TZXR0aW5ncy5haURpc3BsYXkgPSBvU2V0dGluZ3MuYWlEaXNwbGF5TWFzdGVyLnNsaWNlKCk7CgkJCQoJCQlpZiAoIGJSZWRyYXcgPT09IHVuZGVmaW5lZCB8fCBiUmVkcmF3ICkKCQkJewoJCQkJX2ZuUmVEcmF3KCBvU2V0dGluZ3MgKTsKCQkJfQoJCQlyZXR1cm4gYWlSZXR1cm47CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBUaGlzIGZ1bmN0aW9uIHdpbGwgbWFrZSBEYXRhVGFibGVzIHJlY2FsY3VsYXRlIHRoZSBjb2x1bW4gc2l6ZXMsIGJhc2VkIG9uIHRoZSBkYXRhIAoJCSAqIGNvbnRhaW5lZCBpbiB0aGUgdGFibGUgYW5kIHRoZSBzaXplcyBhcHBsaWVkIHRvIHRoZSBjb2x1bW5zIChpbiB0aGUgRE9NLCBDU1Mgb3IgCgkJICogdGhyb3VnaCB0aGUgc1dpZHRoIHBhcmFtZXRlcikuIFRoaXMgY2FuIGJlIHVzZWZ1bCB3aGVuIHRoZSB3aWR0aCBvZiB0aGUgdGFibGUncyAKCQkgKiBwYXJlbnQgZWxlbWVudCBjaGFuZ2VzIChmb3IgZXhhbXBsZSBhIHdpbmRvdyByZXNpemUpLgoJCSAqICBAcGFyYW0ge2Jvb2xlYW59IFtiUmVkcmF3PXRydWVdIFJlZHJhdyB0aGUgdGFibGUgb3Igbm90LCB5b3Ugd2lsbCB0eXBpY2FsbHkgd2FudCB0bwoJCSAqICBAZHRvcHQgQVBJCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic1Njcm9sbFkiOiAiMjAwcHgiLAoJCSAqICAgICAgICAiYlBhZ2luYXRlIjogZmFsc2UKCQkgKiAgICAgIH0gKTsKCQkgKiAgICAgIAoJCSAqICAgICAgJCh3aW5kb3cpLmJpbmQoJ3Jlc2l6ZScsIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICAgb1RhYmxlLmZuQWRqdXN0Q29sdW1uU2l6aW5nKCk7CgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuZm5BZGp1c3RDb2x1bW5TaXppbmcgPSBmdW5jdGlvbiAoIGJSZWRyYXcgKQoJCXsKCQkJdmFyIG9TZXR0aW5ncyA9IF9mblNldHRpbmdzRnJvbU5vZGUodGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0pOwoJCQlfZm5BZGp1c3RDb2x1bW5TaXppbmcoIG9TZXR0aW5ncyApOwoJCQkKCQkJaWYgKCBiUmVkcmF3ID09PSB1bmRlZmluZWQgfHwgYlJlZHJhdyApCgkJCXsKCQkJCXRoaXMuZm5EcmF3KCBmYWxzZSApOwoJCQl9CgkJCWVsc2UgaWYgKCBvU2V0dGluZ3Mub1Njcm9sbC5zWCAhPT0gIiIgfHwgb1NldHRpbmdzLm9TY3JvbGwuc1kgIT09ICIiICkKCQkJewoJCQkJLyogSWYgbm90IHJlZHJhd2luZywgYnV0IHNjcm9sbGluZywgd2Ugd2FudCB0byBhcHBseSB0aGUgbmV3IGNvbHVtbiBzaXplcyBhbnl3YXkgKi8KCQkJCXRoaXMub0FwaS5fZm5TY3JvbGxEcmF3KG9TZXR0aW5ncyk7CgkJCX0KCQl9OwoJCQoJCQoJCS8qKgoJCSAqIFF1aWNrbHkgYW5kIHNpbXBseSBjbGVhciBhIHRhYmxlCgkJICogIEBwYXJhbSB7Ym9vbH0gW2JSZWRyYXc9dHJ1ZV0gcmVkcmF3IHRoZSB0YWJsZSBvciBub3QKCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICAgIAoJCSAqICAgICAgLy8gSW1tZWRpYXRlbHkgJ251a2UnIHRoZSBjdXJyZW50IHJvd3MgKHBlcmhhcHMgd2FpdGluZyBmb3IgYW4gQWpheCBjYWxsYmFjay4uLikKCQkgKiAgICAgIG9UYWJsZS5mbkNsZWFyVGFibGUoKTsKCQkgKiAgICB9ICk7CgkJICovCgkJdGhpcy5mbkNsZWFyVGFibGUgPSBmdW5jdGlvbiggYlJlZHJhdyApCgkJewoJCQkvKiBGaW5kIHNldHRpbmdzIGZyb20gdGFibGUgbm9kZSAqLwoJCQl2YXIgb1NldHRpbmdzID0gX2ZuU2V0dGluZ3NGcm9tTm9kZSggdGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0gKTsKCQkJX2ZuQ2xlYXJUYWJsZSggb1NldHRpbmdzICk7CgkJCQoJCQlpZiAoIGJSZWRyYXcgPT09IHVuZGVmaW5lZCB8fCBiUmVkcmF3ICkKCQkJewoJCQkJX2ZuRHJhdyggb1NldHRpbmdzICk7CgkJCX0KCQl9OwoJCQoJCQoJCS8qKgoJCSAqIFRoZSBleGFjdCBvcHBvc2l0ZSBvZiAnb3BlbmluZycgYSByb3csIHRoaXMgZnVuY3Rpb24gd2lsbCBjbG9zZSBhbnkgcm93cyB3aGljaCAKCQkgKiBhcmUgY3VycmVudGx5ICdvcGVuJy4KCQkgKiAgQHBhcmFtIHtub2RlfSBuVHIgdGhlIHRhYmxlIHJvdyB0byAnY2xvc2UnCgkJICogIEByZXR1cm5zIHtpbnR9IDAgb24gc3VjY2Vzcywgb3IgMSBpZiBmYWlsZWQgKGNhbid0IGZpbmQgdGhlIHJvdykKCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlOwoJCSAqICAgICAgCgkJICogICAgICAvLyAnb3BlbicgYW4gaW5mb3JtYXRpb24gcm93IHdoZW4gYSByb3cgaXMgY2xpY2tlZCBvbgoJCSAqICAgICAgJCgnI2V4YW1wbGUgdGJvZHkgdHInKS5jbGljayggZnVuY3Rpb24gKCkgewoJCSAqICAgICAgICBpZiAoIG9UYWJsZS5mbklzT3Blbih0aGlzKSApIHsKCQkgKiAgICAgICAgICBvVGFibGUuZm5DbG9zZSggdGhpcyApOwoJCSAqICAgICAgICB9IGVsc2UgewoJCSAqICAgICAgICAgIG9UYWJsZS5mbk9wZW4oIHRoaXMsICJUZW1wb3Jhcnkgcm93IG9wZW5lZCIsICJpbmZvX3JvdyIgKTsKCQkgKiAgICAgICAgfQoJCSAqICAgICAgfSApOwoJCSAqICAgICAgCgkJICogICAgICBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLmZuQ2xvc2UgPSBmdW5jdGlvbiggblRyICkKCQl7CgkJCS8qIEZpbmQgc2V0dGluZ3MgZnJvbSB0YWJsZSBub2RlICovCgkJCXZhciBvU2V0dGluZ3MgPSBfZm5TZXR0aW5nc0Zyb21Ob2RlKCB0aGlzW0RhdGFUYWJsZS5leHQuaUFwaUluZGV4XSApOwoJCQkKCQkJZm9yICggdmFyIGk9MCA7IGk8b1NldHRpbmdzLmFvT3BlblJvd3MubGVuZ3RoIDsgaSsrICkKCQkJewoJCQkJaWYgKCBvU2V0dGluZ3MuYW9PcGVuUm93c1tpXS5uUGFyZW50ID09IG5UciApCgkJCQl7CgkJCQkJdmFyIG5UclBhcmVudCA9IG9TZXR0aW5ncy5hb09wZW5Sb3dzW2ldLm5Uci5wYXJlbnROb2RlOwoJCQkJCWlmICggblRyUGFyZW50ICkKCQkJCQl7CgkJCQkJCS8qIFJlbW92ZSBpdCBpZiBpdCBpcyBjdXJyZW50bHkgb24gZGlzcGxheSAqLwoJCQkJCQluVHJQYXJlbnQucmVtb3ZlQ2hpbGQoIG9TZXR0aW5ncy5hb09wZW5Sb3dzW2ldLm5UciApOwoJCQkJCX0KCQkJCQlvU2V0dGluZ3MuYW9PcGVuUm93cy5zcGxpY2UoIGksIDEgKTsKCQkJCQlyZXR1cm4gMDsKCQkJCX0KCQkJfQoJCQlyZXR1cm4gMTsKCQl9OwoJCQoJCQoJCS8qKgoJCSAqIFJlbW92ZSBhIHJvdyBmb3IgdGhlIHRhYmxlCgkJICogIEBwYXJhbSB7bWl4ZWR9IG1UYXJnZXQgVGhlIGluZGV4IG9mIHRoZSByb3cgZnJvbSBhb0RhdGEgdG8gYmUgZGVsZXRlZCwgb3IKCQkgKiAgICB0aGUgVFIgZWxlbWVudCB5b3Ugd2FudCB0byBkZWxldGUKCQkgKiAgQHBhcmFtIHtmdW5jdGlvbnxudWxsfSBbZm5DYWxsQmFja10gQ2FsbGJhY2sgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHtib29sfSBbYlJlZHJhdz10cnVlXSBSZWRyYXcgdGhlIHRhYmxlIG9yIG5vdAoJCSAqICBAcmV0dXJucyB7YXJyYXl9IFRoZSByb3cgdGhhdCB3YXMgZGVsZXRlZAoJCSAqICBAZHRvcHQgQVBJCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqICAgICAgCgkJICogICAgICAvLyBJbW1lZGlhdGVseSByZW1vdmUgdGhlIGZpcnN0IHJvdwoJCSAqICAgICAgb1RhYmxlLmZuRGVsZXRlUm93KCAwICk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuZm5EZWxldGVSb3cgPSBmdW5jdGlvbiggbVRhcmdldCwgZm5DYWxsQmFjaywgYlJlZHJhdyApCgkJewoJCQkvKiBGaW5kIHNldHRpbmdzIGZyb20gdGFibGUgbm9kZSAqLwoJCQl2YXIgb1NldHRpbmdzID0gX2ZuU2V0dGluZ3NGcm9tTm9kZSggdGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0gKTsKCQkJdmFyIGksIGlMZW4sIGlBT0RhdGFJbmRleDsKCQkJCgkJCWlBT0RhdGFJbmRleCA9ICh0eXBlb2YgbVRhcmdldCA9PT0gJ29iamVjdCcpID8gCgkJCQlfZm5Ob2RlVG9EYXRhSW5kZXgob1NldHRpbmdzLCBtVGFyZ2V0KSA6IG1UYXJnZXQ7CgkJCQoJCQkvKiBSZXR1cm4gdGhlIGRhdGEgYXJyYXkgZnJvbSB0aGlzIHJvdyAqLwoJCQl2YXIgb0RhdGEgPSBvU2V0dGluZ3MuYW9EYXRhLnNwbGljZSggaUFPRGF0YUluZGV4LCAxICk7CgkJCgkJCS8qIFVwZGF0ZSB0aGUgX0RUX1Jvd0luZGV4IHBhcmFtZXRlciAqLwoJCQlmb3IgKCBpPTAsIGlMZW49b1NldHRpbmdzLmFvRGF0YS5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlpZiAoIG9TZXR0aW5ncy5hb0RhdGFbaV0ublRyICE9PSBudWxsICkKCQkJCXsKCQkJCQlvU2V0dGluZ3MuYW9EYXRhW2ldLm5Uci5fRFRfUm93SW5kZXggPSBpOwoJCQkJfQoJCQl9CgkJCQoJCQkvKiBSZW1vdmUgdGhlIHRhcmdldCByb3cgZnJvbSB0aGUgc2VhcmNoIGFycmF5ICovCgkJCXZhciBpRGlzcGxheUluZGV4ID0gJC5pbkFycmF5KCBpQU9EYXRhSW5kZXgsIG9TZXR0aW5ncy5haURpc3BsYXkgKTsKCQkJb1NldHRpbmdzLmFzRGF0YVNlYXJjaC5zcGxpY2UoIGlEaXNwbGF5SW5kZXgsIDEgKTsKCQkJCgkJCS8qIERlbGV0ZSBmcm9tIHRoZSBkaXNwbGF5IGFycmF5cyAqLwoJCQlfZm5EZWxldGVJbmRleCggb1NldHRpbmdzLmFpRGlzcGxheU1hc3RlciwgaUFPRGF0YUluZGV4ICk7CgkJCV9mbkRlbGV0ZUluZGV4KCBvU2V0dGluZ3MuYWlEaXNwbGF5LCBpQU9EYXRhSW5kZXggKTsKCQkJCgkJCS8qIElmIHRoZXJlIGlzIGEgdXNlciBjYWxsYmFjayBmdW5jdGlvbiAtIGNhbGwgaXQgKi8KCQkJaWYgKCB0eXBlb2YgZm5DYWxsQmFjayA9PT0gImZ1bmN0aW9uIiApCgkJCXsKCQkJCWZuQ2FsbEJhY2suY2FsbCggdGhpcywgb1NldHRpbmdzLCBvRGF0YSApOwoJCQl9CgkJCQoJCQkvKiBDaGVjayBmb3IgYW4gJ292ZXJmbG93JyB0aGV5IGNhc2UgZm9yIGRpc3BsYXlpbmcgdGhlIHRhYmxlICovCgkJCWlmICggb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ID49IG9TZXR0aW5ncy5mblJlY29yZHNEaXNwbGF5KCkgKQoJCQl7CgkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgLT0gb1NldHRpbmdzLl9pRGlzcGxheUxlbmd0aDsKCQkJCWlmICggb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0IDwgMCApCgkJCQl7CgkJCQkJb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ID0gMDsKCQkJCX0KCQkJfQoJCQkKCQkJaWYgKCBiUmVkcmF3ID09PSB1bmRlZmluZWQgfHwgYlJlZHJhdyApCgkJCXsKCQkJCV9mbkNhbGN1bGF0ZUVuZCggb1NldHRpbmdzICk7CgkJCQlfZm5EcmF3KCBvU2V0dGluZ3MgKTsKCQkJfQoJCQkKCQkJcmV0dXJuIG9EYXRhOwoJCX07CgkJCgkJCgkJLyoqCgkJICogUmVzdG9yZSB0aGUgdGFibGUgdG8gaXQncyBvcmlnaW5hbCBzdGF0ZSBpbiB0aGUgRE9NIGJ5IHJlbW92aW5nIGFsbCBvZiBEYXRhVGFibGVzIAoJCSAqIGVuaGFuY2VtZW50cywgYWx0ZXJhdGlvbnMgdG8gdGhlIERPTSBzdHJ1Y3R1cmUgb2YgdGhlIHRhYmxlIGFuZCBldmVudCBsaXN0ZW5lcnMuCgkJICogIEBwYXJhbSB7Ym9vbGVhbn0gW2JSZW1vdmU9ZmFsc2VdIENvbXBsZXRlbHkgcmVtb3ZlIHRoZSB0YWJsZSBmcm9tIHRoZSBET00KCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAvLyBUaGlzIGV4YW1wbGUgaXMgZmFpcmx5IHBvaW50bGVzcyBpbiByZWFsaXR5LCBidXQgc2hvd3MgaG93IGZuRGVzdHJveSBjYW4gYmUgdXNlZAoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICogICAgICBvVGFibGUuZm5EZXN0cm95KCk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuZm5EZXN0cm95ID0gZnVuY3Rpb24gKCBiUmVtb3ZlICkKCQl7CgkJCXZhciBvU2V0dGluZ3MgPSBfZm5TZXR0aW5nc0Zyb21Ob2RlKCB0aGlzW0RhdGFUYWJsZS5leHQuaUFwaUluZGV4XSApOwoJCQl2YXIgbk9yaWcgPSBvU2V0dGluZ3MublRhYmxlV3JhcHBlci5wYXJlbnROb2RlOwoJCQl2YXIgbkJvZHkgPSBvU2V0dGluZ3MublRCb2R5OwoJCQl2YXIgaSwgaUxlbjsKCQkKCQkJYlJlbW92ZSA9IChiUmVtb3ZlPT09dW5kZWZpbmVkKSA/IGZhbHNlIDogdHJ1ZTsKCQkJCgkJCS8qIEZsYWcgdG8gbm90ZSB0aGF0IHRoZSB0YWJsZSBpcyBjdXJyZW50bHkgYmVpbmcgZGVzdHJveWVkIC0gbm8gYWN0aW9uIHNob3VsZCBiZSB0YWtlbiAqLwoJCQlvU2V0dGluZ3MuYkRlc3Ryb3lpbmcgPSB0cnVlOwoJCQkKCQkJLyogRmlyZSBvZmYgdGhlIGRlc3Ryb3kgY2FsbGJhY2tzIGZvciBwbHVnLWlucyBldGMgKi8KCQkJX2ZuQ2FsbGJhY2tGaXJlKCBvU2V0dGluZ3MsICJhb0Rlc3Ryb3lDYWxsYmFjayIsICJkZXN0cm95IiwgW29TZXR0aW5nc10gKTsKCQkJCgkJCS8qIFJlc3RvcmUgaGlkZGVuIGNvbHVtbnMgKi8KCQkJZm9yICggaT0wLCBpTGVuPW9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLmJWaXNpYmxlID09PSBmYWxzZSApCgkJCQl7CgkJCQkJdGhpcy5mblNldENvbHVtblZpcyggaSwgdHJ1ZSApOwoJCQkJfQoJCQl9CgkJCQoJCQkvKiBCbGl0eiBhbGwgRFQgZXZlbnRzICovCgkJCSQob1NldHRpbmdzLm5UYWJsZVdyYXBwZXIpLmZpbmQoJyonKS5hbmRTZWxmKCkudW5iaW5kKCcuRFQnKTsKCQkJCgkJCS8qIElmIHRoZXJlIGlzIGFuICdlbXB0eScgaW5kaWNhdG9yIHJvdywgcmVtb3ZlIGl0ICovCgkJCSQoJ3Rib2R5PnRyPnRkLicrb1NldHRpbmdzLm9DbGFzc2VzLnNSb3dFbXB0eSwgb1NldHRpbmdzLm5UYWJsZSkucGFyZW50KCkucmVtb3ZlKCk7CgkJCQoJCQkvKiBXaGVuIHNjcm9sbGluZyB3ZSBoYWQgdG8gYnJlYWsgdGhlIHRhYmxlIHVwIC0gcmVzdG9yZSBpdCAqLwoJCQlpZiAoIG9TZXR0aW5ncy5uVGFibGUgIT0gb1NldHRpbmdzLm5USGVhZC5wYXJlbnROb2RlICkKCQkJewoJCQkJJChvU2V0dGluZ3MublRhYmxlKS5jaGlsZHJlbigndGhlYWQnKS5yZW1vdmUoKTsKCQkJCW9TZXR0aW5ncy5uVGFibGUuYXBwZW5kQ2hpbGQoIG9TZXR0aW5ncy5uVEhlYWQgKTsKCQkJfQoJCQkKCQkJaWYgKCBvU2V0dGluZ3MublRGb290ICYmIG9TZXR0aW5ncy5uVGFibGUgIT0gb1NldHRpbmdzLm5URm9vdC5wYXJlbnROb2RlICkKCQkJewoJCQkJJChvU2V0dGluZ3MublRhYmxlKS5jaGlsZHJlbigndGZvb3QnKS5yZW1vdmUoKTsKCQkJCW9TZXR0aW5ncy5uVGFibGUuYXBwZW5kQ2hpbGQoIG9TZXR0aW5ncy5uVEZvb3QgKTsKCQkJfQoJCQkKCQkJLyogUmVtb3ZlIHRoZSBEYXRhVGFibGVzIGdlbmVyYXRlZCBub2RlcywgZXZlbnRzIGFuZCBjbGFzc2VzICovCgkJCW9TZXR0aW5ncy5uVGFibGUucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCggb1NldHRpbmdzLm5UYWJsZSApOwoJCQkkKG9TZXR0aW5ncy5uVGFibGVXcmFwcGVyKS5yZW1vdmUoKTsKCQkJCgkJCW9TZXR0aW5ncy5hYVNvcnRpbmcgPSBbXTsKCQkJb1NldHRpbmdzLmFhU29ydGluZ0ZpeGVkID0gW107CgkJCV9mblNvcnRpbmdDbGFzc2VzKCBvU2V0dGluZ3MgKTsKCQkJCgkJCSQoX2ZuR2V0VHJOb2Rlcyggb1NldHRpbmdzICkpLnJlbW92ZUNsYXNzKCBvU2V0dGluZ3MuYXNTdHJpcGVDbGFzc2VzLmpvaW4oJyAnKSApOwoJCQkKCQkJJCgndGgsIHRkJywgb1NldHRpbmdzLm5USGVhZCkucmVtb3ZlQ2xhc3MoIFsKCQkJCW9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydGFibGUsCgkJCQlvU2V0dGluZ3Mub0NsYXNzZXMuc1NvcnRhYmxlQXNjLAoJCQkJb1NldHRpbmdzLm9DbGFzc2VzLnNTb3J0YWJsZURlc2MsCgkJCQlvU2V0dGluZ3Mub0NsYXNzZXMuc1NvcnRhYmxlTm9uZSBdLmpvaW4oJyAnKQoJCQkpOwoJCQlpZiAoIG9TZXR0aW5ncy5iSlVJICkKCQkJewoJCQkJJCgndGggc3Bhbi4nK29TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydEljb24KCQkJCQkrICcsIHRkIHNwYW4uJytvU2V0dGluZ3Mub0NsYXNzZXMuc1NvcnRJY29uLCBvU2V0dGluZ3MublRIZWFkKS5yZW1vdmUoKTsKCQkKCQkJCSQoJ3RoLCB0ZCcsIG9TZXR0aW5ncy5uVEhlYWQpLmVhY2goIGZ1bmN0aW9uICgpIHsKCQkJCQl2YXIganFXcmFwcGVyID0gJCgnZGl2Licrb1NldHRpbmdzLm9DbGFzc2VzLnNTb3J0SlVJV3JhcHBlciwgdGhpcyk7CgkJCQkJdmFyIGtpZHMgPSBqcVdyYXBwZXIuY29udGVudHMoKTsKCQkJCQkkKHRoaXMpLmFwcGVuZCgga2lkcyApOwoJCQkJCWpxV3JhcHBlci5yZW1vdmUoKTsKCQkJCX0gKTsKCQkJfQoJCQkKCQkJLyogQWRkIHRoZSBUUiBlbGVtZW50cyBiYWNrIGludG8gdGhlIHRhYmxlIGluIHRoZWlyIG9yaWdpbmFsIG9yZGVyICovCgkJCWlmICggIWJSZW1vdmUgJiYgb1NldHRpbmdzLm5UYWJsZVJlaW5zZXJ0QmVmb3JlICkKCQkJewoJCQkJbk9yaWcuaW5zZXJ0QmVmb3JlKCBvU2V0dGluZ3MublRhYmxlLCBvU2V0dGluZ3MublRhYmxlUmVpbnNlcnRCZWZvcmUgKTsKCQkJfQoJCQllbHNlIGlmICggIWJSZW1vdmUgKQoJCQl7CgkJCQluT3JpZy5hcHBlbmRDaGlsZCggb1NldHRpbmdzLm5UYWJsZSApOwoJCQl9CgkJCgkJCWZvciAoIGk9MCwgaUxlbj1vU2V0dGluZ3MuYW9EYXRhLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWlmICggb1NldHRpbmdzLmFvRGF0YVtpXS5uVHIgIT09IG51bGwgKQoJCQkJewoJCQkJCW5Cb2R5LmFwcGVuZENoaWxkKCBvU2V0dGluZ3MuYW9EYXRhW2ldLm5UciApOwoJCQkJfQoJCQl9CgkJCQoJCQkvKiBSZXN0b3JlIHRoZSB3aWR0aCBvZiB0aGUgb3JpZ2luYWwgdGFibGUgKi8KCQkJaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJBdXRvV2lkdGggPT09IHRydWUgKQoJCQl7CgkJCSAgb1NldHRpbmdzLm5UYWJsZS5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKG9TZXR0aW5ncy5zRGVzdHJveVdpZHRoKTsKCQkJfQoJCQkKCQkJLyogSWYgdGhlIHdlcmUgb3JpZ2luYWxseSBvZGQvZXZlbiB0eXBlIGNsYXNzZXMgLSB0aGVuIHdlIGFkZCB0aGVtIGJhY2sgaGVyZS4gTm90ZQoJCQkgKiB0aGlzIGlzIG5vdCBmb29sIHByb29mIChmb3IgZXhhbXBsZSBpZiBub3QgYWxsIHJvd3MgYXMgb2RkL2V2ZW4gY2xhc3NlcyAtIGJ1dCAKCQkJICogaXQncyBhIGdvb2QgZWZmb3J0IHdpdGhvdXQgZ2V0dGluZyBjYXJyaWVkIGF3YXkKCQkJICovCgkJCSQobkJvZHkpLmNoaWxkcmVuKCd0cjpldmVuJykuYWRkQ2xhc3MoIG9TZXR0aW5ncy5hc0Rlc3Ryb3lTdHJpcGVzWzBdICk7CgkJCSQobkJvZHkpLmNoaWxkcmVuKCd0cjpvZGQnKS5hZGRDbGFzcyggb1NldHRpbmdzLmFzRGVzdHJveVN0cmlwZXNbMV0gKTsKCQkJCgkJCS8qIFJlbW92ZSB0aGUgc2V0dGluZ3Mgb2JqZWN0IGZyb20gdGhlIHNldHRpbmdzIGFycmF5ICovCgkJCWZvciAoIGk9MCwgaUxlbj1EYXRhVGFibGUuc2V0dGluZ3MubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJaWYgKCBEYXRhVGFibGUuc2V0dGluZ3NbaV0gPT0gb1NldHRpbmdzICkKCQkJCXsKCQkJCQlEYXRhVGFibGUuc2V0dGluZ3Muc3BsaWNlKCBpLCAxICk7CgkJCQl9CgkJCX0KCQkJCgkJCS8qIEVuZCBpdCBhbGwgKi8KCQkJb1NldHRpbmdzID0gbnVsbDsKCQl9OwoJCQoJCQoJCS8qKgoJCSAqIFJlZHJhdyB0aGUgdGFibGUKCQkgKiAgQHBhcmFtIHtib29sfSBbYkNvbXBsZXRlPXRydWVdIFJlLWZpbHRlciBhbmQgcmVzb3J0IChpZiBlbmFibGVkKSB0aGUgdGFibGUgYmVmb3JlIHRoZSBkcmF3LgoJCSAqICBAZHRvcHQgQVBJCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqICAgICAgCgkJICogICAgICAvLyBSZS1kcmF3IHRoZSB0YWJsZSAtIHlvdSB3b3VsZG4ndCB3YW50IHRvIGRvIGl0IGhlcmUsIGJ1dCBpdCdzIGFuIGV4YW1wbGUgOi0pCgkJICogICAgICBvVGFibGUuZm5EcmF3KCk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuZm5EcmF3ID0gZnVuY3Rpb24oIGJDb21wbGV0ZSApCgkJewoJCQl2YXIgb1NldHRpbmdzID0gX2ZuU2V0dGluZ3NGcm9tTm9kZSggdGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0gKTsKCQkJaWYgKCBiQ29tcGxldGUgPT09IGZhbHNlICkKCQkJewoJCQkJX2ZuQ2FsY3VsYXRlRW5kKCBvU2V0dGluZ3MgKTsKCQkJCV9mbkRyYXcoIG9TZXR0aW5ncyApOwoJCQl9CgkJCWVsc2UKCQkJewoJCQkJX2ZuUmVEcmF3KCBvU2V0dGluZ3MgKTsKCQkJfQoJCX07CgkJCgkJCgkJLyoqCgkJICogRmlsdGVyIHRoZSBpbnB1dCBiYXNlZCBvbiBkYXRhCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzSW5wdXQgU3RyaW5nIHRvIGZpbHRlciB0aGUgdGFibGUgb24KCQkgKiAgQHBhcmFtIHtpbnR8bnVsbH0gW2lDb2x1bW5dIENvbHVtbiB0byBsaW1pdCBmaWx0ZXJpbmcgdG8KCQkgKiAgQHBhcmFtIHtib29sfSBbYlJlZ2V4PWZhbHNlXSBUcmVhdCBhcyByZWd1bGFyIGV4cHJlc3Npb24gb3Igbm90CgkJICogIEBwYXJhbSB7Ym9vbH0gW2JTbWFydD10cnVlXSBQZXJmb3JtIHNtYXJ0IGZpbHRlcmluZyBvciBub3QKCQkgKiAgQHBhcmFtIHtib29sfSBbYlNob3dHbG9iYWw9dHJ1ZV0gU2hvdyB0aGUgaW5wdXQgZ2xvYmFsIGZpbHRlciBpbiBpdCdzIGlucHV0IGJveChlcykKCQkgKiAgQHBhcmFtIHtib29sfSBbYkNhc2VJbnNlbnNpdGl2ZT10cnVlXSBEbyBjYXNlLWluc2Vuc2l0aXZlIG1hdGNoaW5nICh0cnVlKSBvciBub3QgKGZhbHNlKQoJCSAqICBAZHRvcHQgQVBJCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqICAgICAgCgkJICogICAgICAvLyBTb21ldGltZSBsYXRlciAtIGZpbHRlci4uLgoJCSAqICAgICAgb1RhYmxlLmZuRmlsdGVyKCAndGVzdCBzdHJpbmcnICk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuZm5GaWx0ZXIgPSBmdW5jdGlvbiggc0lucHV0LCBpQ29sdW1uLCBiUmVnZXgsIGJTbWFydCwgYlNob3dHbG9iYWwsIGJDYXNlSW5zZW5zaXRpdmUgKQoJCXsKCQkJdmFyIG9TZXR0aW5ncyA9IF9mblNldHRpbmdzRnJvbU5vZGUoIHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdICk7CgkJCQoJCQlpZiAoICFvU2V0dGluZ3Mub0ZlYXR1cmVzLmJGaWx0ZXIgKQoJCQl7CgkJCQlyZXR1cm47CgkJCX0KCQkJCgkJCWlmICggYlJlZ2V4ID09PSB1bmRlZmluZWQgfHwgYlJlZ2V4ID09PSBudWxsICkKCQkJewoJCQkJYlJlZ2V4ID0gZmFsc2U7CgkJCX0KCQkJCgkJCWlmICggYlNtYXJ0ID09PSB1bmRlZmluZWQgfHwgYlNtYXJ0ID09PSBudWxsICkKCQkJewoJCQkJYlNtYXJ0ID0gdHJ1ZTsKCQkJfQoJCQkKCQkJaWYgKCBiU2hvd0dsb2JhbCA9PT0gdW5kZWZpbmVkIHx8IGJTaG93R2xvYmFsID09PSBudWxsICkKCQkJewoJCQkJYlNob3dHbG9iYWwgPSB0cnVlOwoJCQl9CgkJCQoJCQlpZiAoIGJDYXNlSW5zZW5zaXRpdmUgPT09IHVuZGVmaW5lZCB8fCBiQ2FzZUluc2Vuc2l0aXZlID09PSBudWxsICkKCQkJewoJCQkJYkNhc2VJbnNlbnNpdGl2ZSA9IHRydWU7CgkJCX0KCQkJCgkJCWlmICggaUNvbHVtbiA9PT0gdW5kZWZpbmVkIHx8IGlDb2x1bW4gPT09IG51bGwgKQoJCQl7CgkJCQkvKiBHbG9iYWwgZmlsdGVyICovCgkJCQlfZm5GaWx0ZXJDb21wbGV0ZSggb1NldHRpbmdzLCB7CgkJCQkJInNTZWFyY2giOnNJbnB1dCsiIiwKCQkJCQkiYlJlZ2V4IjogYlJlZ2V4LAoJCQkJCSJiU21hcnQiOiBiU21hcnQsCgkJCQkJImJDYXNlSW5zZW5zaXRpdmUiOiBiQ2FzZUluc2Vuc2l0aXZlCgkJCQl9LCAxICk7CgkJCQkKCQkJCWlmICggYlNob3dHbG9iYWwgJiYgb1NldHRpbmdzLmFhbkZlYXR1cmVzLmYgKQoJCQkJewoJCQkJCXZhciBuID0gb1NldHRpbmdzLmFhbkZlYXR1cmVzLmY7CgkJCQkJZm9yICggdmFyIGk9MCwgaUxlbj1uLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQkJewoJCQkJCQkkKG5baV0uX0RUX0lucHV0KS52YWwoIHNJbnB1dCApOwoJCQkJCX0KCQkJCX0KCQkJfQoJCQllbHNlCgkJCXsKCQkJCS8qIFNpbmdsZSBjb2x1bW4gZmlsdGVyICovCgkJCQkkLmV4dGVuZCggb1NldHRpbmdzLmFvUHJlU2VhcmNoQ29sc1sgaUNvbHVtbiBdLCB7CgkJCQkJInNTZWFyY2giOiBzSW5wdXQrIiIsCgkJCQkJImJSZWdleCI6IGJSZWdleCwKCQkJCQkiYlNtYXJ0IjogYlNtYXJ0LAoJCQkJCSJiQ2FzZUluc2Vuc2l0aXZlIjogYkNhc2VJbnNlbnNpdGl2ZQoJCQkJfSApOwoJCQkJX2ZuRmlsdGVyQ29tcGxldGUoIG9TZXR0aW5ncywgb1NldHRpbmdzLm9QcmV2aW91c1NlYXJjaCwgMSApOwoJCQl9CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBHZXQgdGhlIGRhdGEgZm9yIHRoZSB3aG9sZSB0YWJsZSwgYW4gaW5kaXZpZHVhbCByb3cgb3IgYW4gaW5kaXZpZHVhbCBjZWxsIGJhc2VkIG9uIHRoZSAKCQkgKiBwcm92aWRlZCBwYXJhbWV0ZXJzLgoJCSAqICBAcGFyYW0ge2ludHxub2RlfSBbbVJvd10gQSBUUiByb3cgbm9kZSwgVEQvVEggY2VsbCBub2RlIG9yIGFuIGludGVnZXIuIElmIGdpdmVuIGFzCgkJICogICAgYSBUUiBub2RlIHRoZW4gdGhlIGRhdGEgc291cmNlIGZvciB0aGUgd2hvbGUgcm93IHdpbGwgYmUgcmV0dXJuZWQuIElmIGdpdmVuIGFzIGEKCQkgKiAgICBURC9USCBjZWxsIG5vZGUgdGhlbiBpQ29sIHdpbGwgYmUgYXV0b21hdGljYWxseSBjYWxjdWxhdGVkIGFuZCB0aGUgZGF0YSBmb3IgdGhlCgkJICogICAgY2VsbCByZXR1cm5lZC4gSWYgZ2l2ZW4gYXMgYW4gaW50ZWdlciwgdGhlbiB0aGlzIGlzIHRyZWF0ZWQgYXMgdGhlIGFvRGF0YSBpbnRlcm5hbAoJCSAqICAgIGRhdGEgaW5kZXggZm9yIHRoZSByb3cgKHNlZSBmbkdldFBvc2l0aW9uKSBhbmQgdGhlIGRhdGEgZm9yIHRoYXQgcm93IHVzZWQuCgkJICogIEBwYXJhbSB7aW50fSBbaUNvbF0gT3B0aW9uYWwgY29sdW1uIGluZGV4IHRoYXQgeW91IHdhbnQgdGhlIGRhdGEgb2YuCgkJICogIEByZXR1cm5zIHthcnJheXxvYmplY3R8c3RyaW5nfSBJZiBtUm93IGlzIHVuZGVmaW5lZCwgdGhlbiB0aGUgZGF0YSBmb3IgYWxsIHJvd3MgaXMKCQkgKiAgICByZXR1cm5lZC4gSWYgbVJvdyBpcyBkZWZpbmVkLCBqdXN0IGRhdGEgZm9yIHRoYXQgcm93LCBhbmQgaXMgaUNvbCBpcwoJCSAqICAgIGRlZmluZWQsIG9ubHkgZGF0YSBmb3IgdGhlIGRlc2lnbmF0ZWQgY2VsbCBpcyByZXR1cm5lZC4KCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gUm93IGRhdGEKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICoKCQkgKiAgICAgIG9UYWJsZS4kKCd0cicpLmNsaWNrKCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAgIHZhciBkYXRhID0gb1RhYmxlLmZuR2V0RGF0YSggdGhpcyApOwoJCSAqICAgICAgICAvLyAuLi4gZG8gc29tZXRoaW5nIHdpdGggdGhlIGFycmF5IC8gb2JqZWN0IG9mIGRhdGEgZm9yIHRoZSByb3cKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBJbmRpdmlkdWFsIGNlbGwgZGF0YQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKgoJCSAqICAgICAgb1RhYmxlLiQoJ3RkJykuY2xpY2soIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICAgdmFyIHNEYXRhID0gb1RhYmxlLmZuR2V0RGF0YSggdGhpcyApOwoJCSAqICAgICAgICBhbGVydCggJ1RoZSBjZWxsIGNsaWNrZWQgb24gaGFkIHRoZSB2YWx1ZSBvZiAnK3NEYXRhICk7CgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuZm5HZXREYXRhID0gZnVuY3Rpb24oIG1Sb3csIGlDb2wgKQoJCXsKCQkJdmFyIG9TZXR0aW5ncyA9IF9mblNldHRpbmdzRnJvbU5vZGUoIHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdICk7CgkJCQoJCQlpZiAoIG1Sb3cgIT09IHVuZGVmaW5lZCApCgkJCXsKCQkJCXZhciBpUm93ID0gbVJvdzsKCQkJCWlmICggdHlwZW9mIG1Sb3cgPT09ICdvYmplY3QnICkKCQkJCXsKCQkJCQl2YXIgc05vZGUgPSBtUm93Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7CgkJCQkJaWYgKHNOb2RlID09PSAidHIiICkKCQkJCQl7CgkJCQkJCWlSb3cgPSBfZm5Ob2RlVG9EYXRhSW5kZXgob1NldHRpbmdzLCBtUm93KTsKCQkJCQl9CgkJCQkJZWxzZSBpZiAoIHNOb2RlID09PSAidGQiICkKCQkJCQl7CgkJCQkJCWlSb3cgPSBfZm5Ob2RlVG9EYXRhSW5kZXgob1NldHRpbmdzLCBtUm93LnBhcmVudE5vZGUpOwoJCQkJCQlpQ29sID0gX2ZuTm9kZVRvQ29sdW1uSW5kZXgoIG9TZXR0aW5ncywgaVJvdywgbVJvdyApOwoJCQkJCX0KCQkJCX0KCQkKCQkJCWlmICggaUNvbCAhPT0gdW5kZWZpbmVkICkKCQkJCXsKCQkJCQlyZXR1cm4gX2ZuR2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaUNvbCwgJycgKTsKCQkJCX0KCQkJCXJldHVybiAob1NldHRpbmdzLmFvRGF0YVtpUm93XSE9PXVuZGVmaW5lZCkgPwoJCQkJCW9TZXR0aW5ncy5hb0RhdGFbaVJvd10uX2FEYXRhIDogbnVsbDsKCQkJfQoJCQlyZXR1cm4gX2ZuR2V0RGF0YU1hc3Rlciggb1NldHRpbmdzICk7CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBHZXQgYW4gYXJyYXkgb2YgdGhlIFRSIG5vZGVzIHRoYXQgYXJlIHVzZWQgaW4gdGhlIHRhYmxlJ3MgYm9keS4gTm90ZSB0aGF0IHlvdSB3aWxsIAoJCSAqIHR5cGljYWxseSB3YW50IHRvIHVzZSB0aGUgJyQnIEFQSSBtZXRob2QgaW4gcHJlZmVyZW5jZSB0byB0aGlzIGFzIGl0IGlzIG1vcmUgCgkJICogZmxleGlibGUuCgkJICogIEBwYXJhbSB7aW50fSBbaVJvd10gT3B0aW9uYWwgcm93IGluZGV4IGZvciB0aGUgVFIgZWxlbWVudCB5b3Ugd2FudAoJCSAqICBAcmV0dXJucyB7YXJyYXl8bm9kZX0gSWYgaVJvdyBpcyB1bmRlZmluZWQsIHJldHVybnMgYW4gYXJyYXkgb2YgYWxsIFRSIGVsZW1lbnRzCgkJICogICAgaW4gdGhlIHRhYmxlJ3MgYm9keSwgb3IgaVJvdyBpcyBkZWZpbmVkLCBqdXN0IHRoZSBUUiBlbGVtZW50IHJlcXVlc3RlZC4KCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICAgIAoJCSAqICAgICAgLy8gR2V0IHRoZSBub2RlcyBmcm9tIHRoZSB0YWJsZQoJCSAqICAgICAgdmFyIG5Ob2RlcyA9IG9UYWJsZS5mbkdldE5vZGVzKCApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLmZuR2V0Tm9kZXMgPSBmdW5jdGlvbiggaVJvdyApCgkJewoJCQl2YXIgb1NldHRpbmdzID0gX2ZuU2V0dGluZ3NGcm9tTm9kZSggdGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0gKTsKCQkJCgkJCWlmICggaVJvdyAhPT0gdW5kZWZpbmVkICkgewoJCQkJcmV0dXJuIChvU2V0dGluZ3MuYW9EYXRhW2lSb3ddIT09dW5kZWZpbmVkKSA/CgkJCQkJb1NldHRpbmdzLmFvRGF0YVtpUm93XS5uVHIgOiBudWxsOwoJCQl9CgkJCXJldHVybiBfZm5HZXRUck5vZGVzKCBvU2V0dGluZ3MgKTsKCQl9OwoJCQoJCQoJCS8qKgoJCSAqIEdldCB0aGUgYXJyYXkgaW5kZXhlcyBvZiBhIHBhcnRpY3VsYXIgY2VsbCBmcm9tIGl0J3MgRE9NIGVsZW1lbnQKCQkgKiBhbmQgY29sdW1uIGluZGV4IGluY2x1ZGluZyBoaWRkZW4gY29sdW1ucwoJCSAqICBAcGFyYW0ge25vZGV9IG5Ob2RlIHRoaXMgY2FuIGVpdGhlciBiZSBhIFRSLCBURCBvciBUSCBpbiB0aGUgdGFibGUncyBib2R5CgkJICogIEByZXR1cm5zIHtpbnR9IElmIG5Ob2RlIGlzIGdpdmVuIGFzIGEgVFIsIHRoZW4gYSBzaW5nbGUgaW5kZXggaXMgcmV0dXJuZWQsIG9yCgkJICogICAgaWYgZ2l2ZW4gYXMgYSBjZWxsLCBhbiBhcnJheSBvZiBbcm93IGluZGV4LCBjb2x1bW4gaW5kZXggKHZpc2libGUpXSBpcyBnaXZlbi4KCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZSB0Ym9keSB0ZCcpLmNsaWNrKCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAgIC8vIEdldCB0aGUgcG9zaXRpb24gb2YgdGhlIGN1cnJlbnQgZGF0YSBmcm9tIHRoZSBub2RlCgkJICogICAgICAgIHZhciBhUG9zID0gb1RhYmxlLmZuR2V0UG9zaXRpb24oIHRoaXMgKTsKCQkgKiAgICAgICAgCgkJICogICAgICAgIC8vIEdldCB0aGUgZGF0YSBhcnJheSBmb3IgdGhpcyByb3cKCQkgKiAgICAgICAgdmFyIGFEYXRhID0gb1RhYmxlLmZuR2V0RGF0YSggYVBvc1swXSApOwoJCSAqICAgICAgICAKCQkgKiAgICAgICAgLy8gVXBkYXRlIHRoZSBkYXRhIGFycmF5IGFuZCByZXR1cm4gdGhlIHZhbHVlCgkJICogICAgICAgIGFEYXRhWyBhUG9zWzFdIF0gPSAnY2xpY2tlZCc7CgkJICogICAgICAgIHRoaXMuaW5uZXJIVE1MID0gJ2NsaWNrZWQnOwoJCSAqICAgICAgfSApOwoJCSAqICAgICAgCgkJICogICAgICAvLyBJbml0IERhdGFUYWJsZXMKCQkgKiAgICAgIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuZm5HZXRQb3NpdGlvbiA9IGZ1bmN0aW9uKCBuTm9kZSApCgkJewoJCQl2YXIgb1NldHRpbmdzID0gX2ZuU2V0dGluZ3NGcm9tTm9kZSggdGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0gKTsKCQkJdmFyIHNOb2RlTmFtZSA9IG5Ob2RlLm5vZGVOYW1lLnRvVXBwZXJDYXNlKCk7CgkJCQoJCQlpZiAoIHNOb2RlTmFtZSA9PSAiVFIiICkKCQkJewoJCQkJcmV0dXJuIF9mbk5vZGVUb0RhdGFJbmRleChvU2V0dGluZ3MsIG5Ob2RlKTsKCQkJfQoJCQllbHNlIGlmICggc05vZGVOYW1lID09ICJURCIgfHwgc05vZGVOYW1lID09ICJUSCIgKQoJCQl7CgkJCQl2YXIgaURhdGFJbmRleCA9IF9mbk5vZGVUb0RhdGFJbmRleCggb1NldHRpbmdzLCBuTm9kZS5wYXJlbnROb2RlICk7CgkJCQl2YXIgaUNvbHVtbkluZGV4ID0gX2ZuTm9kZVRvQ29sdW1uSW5kZXgoIG9TZXR0aW5ncywgaURhdGFJbmRleCwgbk5vZGUgKTsKCQkJCXJldHVybiBbIGlEYXRhSW5kZXgsIF9mbkNvbHVtbkluZGV4VG9WaXNpYmxlKG9TZXR0aW5ncywgaUNvbHVtbkluZGV4ICksIGlDb2x1bW5JbmRleCBdOwoJCQl9CgkJCXJldHVybiBudWxsOwoJCX07CgkJCgkJCgkJLyoqCgkJICogQ2hlY2sgdG8gc2VlIGlmIGEgcm93IGlzICdvcGVuJyBvciBub3QuCgkJICogIEBwYXJhbSB7bm9kZX0gblRyIHRoZSB0YWJsZSByb3cgdG8gY2hlY2sKCQkgKiAgQHJldHVybnMge2Jvb2xlYW59IHRydWUgaWYgdGhlIHJvdyBpcyBjdXJyZW50bHkgb3BlbiwgZmFsc2Ugb3RoZXJ3aXNlCgkJICogIEBkdG9wdCBBUEkKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZTsKCQkgKiAgICAgIAoJCSAqICAgICAgLy8gJ29wZW4nIGFuIGluZm9ybWF0aW9uIHJvdyB3aGVuIGEgcm93IGlzIGNsaWNrZWQgb24KCQkgKiAgICAgICQoJyNleGFtcGxlIHRib2R5IHRyJykuY2xpY2soIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICAgaWYgKCBvVGFibGUuZm5Jc09wZW4odGhpcykgKSB7CgkJICogICAgICAgICAgb1RhYmxlLmZuQ2xvc2UoIHRoaXMgKTsKCQkgKiAgICAgICAgfSBlbHNlIHsKCQkgKiAgICAgICAgICBvVGFibGUuZm5PcGVuKCB0aGlzLCAiVGVtcG9yYXJ5IHJvdyBvcGVuZWQiLCAiaW5mb19yb3ciICk7CgkJICogICAgICAgIH0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICAgIAoJCSAqICAgICAgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICB9ICk7CgkJICovCgkJdGhpcy5mbklzT3BlbiA9IGZ1bmN0aW9uKCBuVHIgKQoJCXsKCQkJdmFyIG9TZXR0aW5ncyA9IF9mblNldHRpbmdzRnJvbU5vZGUoIHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdICk7CgkJCXZhciBhb09wZW5Sb3dzID0gb1NldHRpbmdzLmFvT3BlblJvd3M7CgkJCQoJCQlmb3IgKCB2YXIgaT0wIDsgaTxvU2V0dGluZ3MuYW9PcGVuUm93cy5sZW5ndGggOyBpKysgKQoJCQl7CgkJCQlpZiAoIG9TZXR0aW5ncy5hb09wZW5Sb3dzW2ldLm5QYXJlbnQgPT0gblRyICkKCQkJCXsKCQkJCQlyZXR1cm4gdHJ1ZTsKCQkJCX0KCQkJfQoJCQlyZXR1cm4gZmFsc2U7CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBUaGlzIGZ1bmN0aW9uIHdpbGwgcGxhY2UgYSBuZXcgcm93IGRpcmVjdGx5IGFmdGVyIGEgcm93IHdoaWNoIGlzIGN1cnJlbnRseSAKCQkgKiBvbiBkaXNwbGF5IG9uIHRoZSBwYWdlLCB3aXRoIHRoZSBIVE1MIGNvbnRlbnRzIHRoYXQgaXMgcGFzc2VkIGludG8gdGhlIAoJCSAqIGZ1bmN0aW9uLiBUaGlzIGNhbiBiZSB1c2VkLCBmb3IgZXhhbXBsZSwgdG8gYXNrIGZvciBjb25maXJtYXRpb24gdGhhdCBhIAoJCSAqIHBhcnRpY3VsYXIgcmVjb3JkIHNob3VsZCBiZSBkZWxldGVkLgoJCSAqICBAcGFyYW0ge25vZGV9IG5UciBUaGUgdGFibGUgcm93IHRvICdvcGVuJwoJCSAqICBAcGFyYW0ge3N0cmluZ3xub2RlfGpRdWVyeX0gbUh0bWwgVGhlIEhUTUwgdG8gcHV0IGludG8gdGhlIHJvdwoJCSAqICBAcGFyYW0ge3N0cmluZ30gc0NsYXNzIENsYXNzIHRvIGdpdmUgdGhlIG5ldyBURCBjZWxsCgkJICogIEByZXR1cm5zIHtub2RlfSBUaGUgcm93IG9wZW5lZC4gTm90ZSB0aGF0IGlmIHRoZSB0YWJsZSByb3cgcGFzc2VkIGluIGFzIHRoZQoJCSAqICAgIGZpcnN0IHBhcmFtZXRlciwgaXMgbm90IGZvdW5kIGluIHRoZSB0YWJsZSwgdGhpcyBtZXRob2Qgd2lsbCBzaWxlbnRseQoJCSAqICAgIHJldHVybi4KCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlOwoJCSAqICAgICAgCgkJICogICAgICAvLyAnb3BlbicgYW4gaW5mb3JtYXRpb24gcm93IHdoZW4gYSByb3cgaXMgY2xpY2tlZCBvbgoJCSAqICAgICAgJCgnI2V4YW1wbGUgdGJvZHkgdHInKS5jbGljayggZnVuY3Rpb24gKCkgewoJCSAqICAgICAgICBpZiAoIG9UYWJsZS5mbklzT3Blbih0aGlzKSApIHsKCQkgKiAgICAgICAgICBvVGFibGUuZm5DbG9zZSggdGhpcyApOwoJCSAqICAgICAgICB9IGVsc2UgewoJCSAqICAgICAgICAgIG9UYWJsZS5mbk9wZW4oIHRoaXMsICJUZW1wb3Jhcnkgcm93IG9wZW5lZCIsICJpbmZvX3JvdyIgKTsKCQkgKiAgICAgICAgfQoJCSAqICAgICAgfSApOwoJCSAqICAgICAgCgkJICogICAgICBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLmZuT3BlbiA9IGZ1bmN0aW9uKCBuVHIsIG1IdG1sLCBzQ2xhc3MgKQoJCXsKCQkJLyogRmluZCBzZXR0aW5ncyBmcm9tIHRhYmxlIG5vZGUgKi8KCQkJdmFyIG9TZXR0aW5ncyA9IF9mblNldHRpbmdzRnJvbU5vZGUoIHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdICk7CgkJCgkJCS8qIENoZWNrIHRoYXQgdGhlIHJvdyBnaXZlbiBpcyBpbiB0aGUgdGFibGUgKi8KCQkJdmFyIG5UYWJsZVJvd3MgPSBfZm5HZXRUck5vZGVzKCBvU2V0dGluZ3MgKTsKCQkJaWYgKCAkLmluQXJyYXkoblRyLCBuVGFibGVSb3dzKSA9PT0gLTEgKQoJCQl7CgkJCQlyZXR1cm47CgkJCX0KCQkJCgkJCS8qIHRoZSBvbGQgb3BlbiBvbmUgaWYgdGhlcmUgaXMgb25lICovCgkJCXRoaXMuZm5DbG9zZSggblRyICk7CgkJCQoJCQl2YXIgbk5ld1JvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRyIik7CgkJCXZhciBuTmV3Q2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRkIik7CgkJCW5OZXdSb3cuYXBwZW5kQ2hpbGQoIG5OZXdDZWxsICk7CgkJCW5OZXdDZWxsLmNsYXNzTmFtZSA9IHNDbGFzczsKCQkJbk5ld0NlbGwuY29sU3BhbiA9IF9mblZpc2JsZUNvbHVtbnMoIG9TZXR0aW5ncyApOwoJCQoJCQlpZiAodHlwZW9mIG1IdG1sID09PSAic3RyaW5nIikKCQkJewoJCQkJbk5ld0NlbGwuaW5uZXJIVE1MID0gbUh0bWw7CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQkkKG5OZXdDZWxsKS5odG1sKCBtSHRtbCApOwoJCQl9CgkJCgkJCS8qIElmIHRoZSBuVHIgaXNuJ3Qgb24gdGhlIHBhZ2UgYXQgdGhlIG1vbWVudCAtIHRoZW4gd2UgZG9uJ3QgaW5zZXJ0IGF0IHRoZSBtb21lbnQgKi8KCQkJdmFyIG5UcnMgPSAkKCd0cicsIG9TZXR0aW5ncy5uVEJvZHkpOwoJCQlpZiAoICQuaW5BcnJheShuVHIsIG5UcnMpICE9IC0xICApCgkJCXsKCQkJCSQobk5ld1JvdykuaW5zZXJ0QWZ0ZXIoblRyKTsKCQkJfQoJCQkKCQkJb1NldHRpbmdzLmFvT3BlblJvd3MucHVzaCggewoJCQkJIm5UciI6IG5OZXdSb3csCgkJCQkiblBhcmVudCI6IG5UcgoJCQl9ICk7CgkJCQoJCQlyZXR1cm4gbk5ld1JvdzsKCQl9OwoJCQoJCQoJCS8qKgoJCSAqIENoYW5nZSB0aGUgcGFnaW5hdGlvbiAtIHByb3ZpZGVzIHRoZSBpbnRlcm5hbCBsb2dpYyBmb3IgcGFnaW5hdGlvbiBpbiBhIHNpbXBsZSBBUEkgCgkJICogZnVuY3Rpb24uIFdpdGggdGhpcyBmdW5jdGlvbiB5b3UgY2FuIGhhdmUgYSBEYXRhVGFibGVzIHRhYmxlIGdvIHRvIHRoZSBuZXh0LCAKCQkgKiBwcmV2aW91cywgZmlyc3Qgb3IgbGFzdCBwYWdlcy4KCQkgKiAgQHBhcmFtIHtzdHJpbmd8aW50fSBtQWN0aW9uIFBhZ2luZyBhY3Rpb24gdG8gdGFrZTogImZpcnN0IiwgInByZXZpb3VzIiwgIm5leHQiIG9yICJsYXN0IgoJCSAqICAgIG9yIHBhZ2UgbnVtYmVyIHRvIGp1bXAgdG8gKGludGVnZXIpLCBub3RlIHRoYXQgcGFnZSAwIGlzIHRoZSBmaXJzdCBwYWdlLgoJCSAqICBAcGFyYW0ge2Jvb2x9IFtiUmVkcmF3PXRydWVdIFJlZHJhdyB0aGUgdGFibGUgb3Igbm90CgkJICogIEBkdG9wdCBBUEkKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICogICAgICBvVGFibGUuZm5QYWdlQ2hhbmdlKCAnbmV4dCcgKTsKCQkgKiAgICB9ICk7CgkJICovCgkJdGhpcy5mblBhZ2VDaGFuZ2UgPSBmdW5jdGlvbiAoIG1BY3Rpb24sIGJSZWRyYXcgKQoJCXsKCQkJdmFyIG9TZXR0aW5ncyA9IF9mblNldHRpbmdzRnJvbU5vZGUoIHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdICk7CgkJCV9mblBhZ2VDaGFuZ2UoIG9TZXR0aW5ncywgbUFjdGlvbiApOwoJCQlfZm5DYWxjdWxhdGVFbmQoIG9TZXR0aW5ncyApOwoJCQkKCQkJaWYgKCBiUmVkcmF3ID09PSB1bmRlZmluZWQgfHwgYlJlZHJhdyApCgkJCXsKCQkJCV9mbkRyYXcoIG9TZXR0aW5ncyApOwoJCQl9CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBTaG93IGEgcGFydGljdWxhciBjb2x1bW4KCQkgKiAgQHBhcmFtIHtpbnR9IGlDb2wgVGhlIGNvbHVtbiB3aG9zZSBkaXNwbGF5IHNob3VsZCBiZSBjaGFuZ2VkCgkJICogIEBwYXJhbSB7Ym9vbH0gYlNob3cgU2hvdyAodHJ1ZSkgb3IgaGlkZSAoZmFsc2UpIHRoZSBjb2x1bW4KCQkgKiAgQHBhcmFtIHtib29sfSBbYlJlZHJhdz10cnVlXSBSZWRyYXcgdGhlIHRhYmxlIG9yIG5vdAoJCSAqICBAZHRvcHQgQVBJCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqICAgICAgCgkJICogICAgICAvLyBIaWRlIHRoZSBzZWNvbmQgY29sdW1uIGFmdGVyIGluaXRpYWxpc2F0aW9uCgkJICogICAgICBvVGFibGUuZm5TZXRDb2x1bW5WaXMoIDEsIGZhbHNlICk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuZm5TZXRDb2x1bW5WaXMgPSBmdW5jdGlvbiAoIGlDb2wsIGJTaG93LCBiUmVkcmF3ICkKCQl7CgkJCXZhciBvU2V0dGluZ3MgPSBfZm5TZXR0aW5nc0Zyb21Ob2RlKCB0aGlzW0RhdGFUYWJsZS5leHQuaUFwaUluZGV4XSApOwoJCQl2YXIgaSwgaUxlbjsKCQkJdmFyIGFvQ29sdW1ucyA9IG9TZXR0aW5ncy5hb0NvbHVtbnM7CgkJCXZhciBhb0RhdGEgPSBvU2V0dGluZ3MuYW9EYXRhOwoJCQl2YXIgblRkLCBiQXBwZW5kLCBpQmVmb3JlOwoJCQkKCQkJLyogTm8gcG9pbnQgaW4gZG9pbmcgYW55dGhpbmcgaWYgd2UgYXJlIHJlcXVlc3Rpbmcgd2hhdCBpcyBhbHJlYWR5IHRydWUgKi8KCQkJaWYgKCBhb0NvbHVtbnNbaUNvbF0uYlZpc2libGUgPT0gYlNob3cgKQoJCQl7CgkJCQlyZXR1cm47CgkJCX0KCQkJCgkJCS8qIFNob3cgdGhlIGNvbHVtbiAqLwoJCQlpZiAoIGJTaG93ICkKCQkJewoJCQkJdmFyIGlJbnNlcnQgPSAwOwoJCQkJZm9yICggaT0wIDsgaTxpQ29sIDsgaSsrICkKCQkJCXsKCQkJCQlpZiAoIGFvQ29sdW1uc1tpXS5iVmlzaWJsZSApCgkJCQkJewoJCQkJCQlpSW5zZXJ0Kys7CgkJCQkJfQoJCQkJfQoJCQkJCgkJCQkvKiBOZWVkIHRvIGRlY2lkZSBpZiB3ZSBzaG91bGQgdXNlIGFwcGVuZENoaWxkIG9yIGluc2VydEJlZm9yZSAqLwoJCQkJYkFwcGVuZCA9IChpSW5zZXJ0ID49IF9mblZpc2JsZUNvbHVtbnMoIG9TZXR0aW5ncyApKTsKCQkKCQkJCS8qIFdoaWNoIGNvbG91bW4gc2hvdWxkIHdlIGJlIGluc2VydGluZyBiZWZvcmU/ICovCgkJCQlpZiAoICFiQXBwZW5kICkKCQkJCXsKCQkJCQlmb3IgKCBpPWlDb2wgOyBpPGFvQ29sdW1ucy5sZW5ndGggOyBpKysgKQoJCQkJCXsKCQkJCQkJaWYgKCBhb0NvbHVtbnNbaV0uYlZpc2libGUgKQoJCQkJCQl7CgkJCQkJCQlpQmVmb3JlID0gaTsKCQkJCQkJCWJyZWFrOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQoJCQkJZm9yICggaT0wLCBpTGVuPWFvRGF0YS5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCWlmICggYW9EYXRhW2ldLm5UciAhPT0gbnVsbCApCgkJCQkJewoJCQkJCQlpZiAoIGJBcHBlbmQgKQoJCQkJCQl7CgkJCQkJCQlhb0RhdGFbaV0ublRyLmFwcGVuZENoaWxkKCAKCQkJCQkJCQlhb0RhdGFbaV0uX2FuSGlkZGVuW2lDb2xdCgkJCQkJCQkpOwoJCQkJCQl9CgkJCQkJCWVsc2UKCQkJCQkJewoJCQkJCQkJYW9EYXRhW2ldLm5Uci5pbnNlcnRCZWZvcmUoCgkJCQkJCQkJYW9EYXRhW2ldLl9hbkhpZGRlbltpQ29sXSwgCgkJCQkJCQkJX2ZuR2V0VGROb2Rlcyggb1NldHRpbmdzLCBpIClbaUJlZm9yZV0gKTsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJfQoJCQllbHNlCgkJCXsKCQkJCS8qIFJlbW92ZSBhIGNvbHVtbiBmcm9tIGRpc3BsYXkgKi8KCQkJCWZvciAoIGk9MCwgaUxlbj1hb0RhdGEubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQlpZiAoIGFvRGF0YVtpXS5uVHIgIT09IG51bGwgKQoJCQkJCXsKCQkJCQkJblRkID0gX2ZuR2V0VGROb2Rlcyggb1NldHRpbmdzLCBpIClbaUNvbF07CgkJCQkJCWFvRGF0YVtpXS5fYW5IaWRkZW5baUNvbF0gPSBuVGQ7CgkJCQkJCW5UZC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKCBuVGQgKTsKCQkJCQl9CgkJCQl9CgkJCX0KCQkKCQkJLyogQ2xlYXIgdG8gc2V0IHRoZSB2aXNpYmxlIGZsYWcgKi8KCQkJYW9Db2x1bW5zW2lDb2xdLmJWaXNpYmxlID0gYlNob3c7CgkJCgkJCS8qIFJlZHJhdyB0aGUgaGVhZGVyIGFuZCBmb290ZXIgYmFzZWQgb24gdGhlIG5ldyBjb2x1bW4gdmlzaWJpbGl0eSAqLwoJCQlfZm5EcmF3SGVhZCggb1NldHRpbmdzLCBvU2V0dGluZ3MuYW9IZWFkZXIgKTsKCQkJaWYgKCBvU2V0dGluZ3MublRGb290ICkKCQkJewoJCQkJX2ZuRHJhd0hlYWQoIG9TZXR0aW5ncywgb1NldHRpbmdzLmFvRm9vdGVyICk7CgkJCX0KCQkJCgkJCS8qIElmIHRoZXJlIGFyZSBhbnkgJ29wZW4nIHJvd3MsIHRoZW4gd2UgbmVlZCB0byBhbHRlciB0aGUgY29sc3BhbiBmb3IgdGhpcyBjb2wgY2hhbmdlICovCgkJCWZvciAoIGk9MCwgaUxlbj1vU2V0dGluZ3MuYW9PcGVuUm93cy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlvU2V0dGluZ3MuYW9PcGVuUm93c1tpXS5uVHIuY29sU3BhbiA9IF9mblZpc2JsZUNvbHVtbnMoIG9TZXR0aW5ncyApOwoJCQl9CgkJCQoJCQkvKiBEbyBhIHJlZHJhdyBpbmNhc2UgYW55dGhpbmcgZGVwZW5kaW5nIG9uIHRoZSB0YWJsZSBjb2x1bW5zIG5lZWRzIGl0IAoJCQkgKiAoYnVpbHQtaW46IHNjcm9sbGluZykgCgkJCSAqLwoJCQlpZiAoIGJSZWRyYXcgPT09IHVuZGVmaW5lZCB8fCBiUmVkcmF3ICkKCQkJewoJCQkJX2ZuQWRqdXN0Q29sdW1uU2l6aW5nKCBvU2V0dGluZ3MgKTsKCQkJCV9mbkRyYXcoIG9TZXR0aW5ncyApOwoJCQl9CgkJCQoJCQlfZm5TYXZlU3RhdGUoIG9TZXR0aW5ncyApOwoJCX07CgkJCgkJCgkJLyoqCgkJICogR2V0IHRoZSBzZXR0aW5ncyBmb3IgYSBwYXJ0aWN1bGFyIHRhYmxlIGZvciBleHRlcm5hbCBtYW5pcHVsYXRpb24KCQkgKiAgQHJldHVybnMge29iamVjdH0gRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QuIFNlZSAKCQkgKiAgICB7QGxpbmsgRGF0YVRhYmxlLm1vZGVscy5vU2V0dGluZ3N9CgkJICogIEBkdG9wdCBBUEkKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICogICAgICB2YXIgb1NldHRpbmdzID0gb1RhYmxlLmZuU2V0dGluZ3MoKTsKCQkgKiAgICAgIAoJCSAqICAgICAgLy8gU2hvdyBhbiBleGFtcGxlIHBhcmFtZXRlciBmcm9tIHRoZSBzZXR0aW5ncwoJCSAqICAgICAgYWxlcnQoIG9TZXR0aW5ncy5faURpc3BsYXlTdGFydCApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLmZuU2V0dGluZ3MgPSBmdW5jdGlvbigpCgkJewoJCQlyZXR1cm4gX2ZuU2V0dGluZ3NGcm9tTm9kZSggdGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0gKTsKCQl9OwoJCQoJCQoJCS8qKgoJCSAqIFNvcnQgdGhlIHRhYmxlIGJ5IGEgcGFydGljdWxhciBjb2x1bW4KCQkgKiAgQHBhcmFtIHtpbnR9IGlDb2wgdGhlIGRhdGEgaW5kZXggdG8gc29ydCBvbi4gTm90ZSB0aGF0IHRoaXMgd2lsbCBub3QgbWF0Y2ggdGhlIAoJCSAqICAgICdkaXNwbGF5IGluZGV4JyBpZiB5b3UgaGF2ZSBoaWRkZW4gZGF0YSBlbnRyaWVzCgkJICogIEBkdG9wdCBBUEkKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICogICAgICAKCQkgKiAgICAgIC8vIFNvcnQgaW1tZWRpYXRlbHkgd2l0aCBjb2x1bW5zIDAgYW5kIDEKCQkgKiAgICAgIG9UYWJsZS5mblNvcnQoIFsgWzAsJ2FzYyddLCBbMSwnYXNjJ10gXSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLmZuU29ydCA9IGZ1bmN0aW9uKCBhYVNvcnQgKQoJCXsKCQkJdmFyIG9TZXR0aW5ncyA9IF9mblNldHRpbmdzRnJvbU5vZGUoIHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdICk7CgkJCW9TZXR0aW5ncy5hYVNvcnRpbmcgPSBhYVNvcnQ7CgkJCV9mblNvcnQoIG9TZXR0aW5ncyApOwoJCX07CgkJCgkJCgkJLyoqCgkJICogQXR0YWNoIGEgc29ydCBsaXN0ZW5lciB0byBhbiBlbGVtZW50IGZvciBhIGdpdmVuIGNvbHVtbgoJCSAqICBAcGFyYW0ge25vZGV9IG5Ob2RlIHRoZSBlbGVtZW50IHRvIGF0dGFjaCB0aGUgc29ydCBsaXN0ZW5lciB0bwoJCSAqICBAcGFyYW0ge2ludH0gaUNvbHVtbiB0aGUgY29sdW1uIHRoYXQgYSBjbGljayBvbiB0aGlzIG5vZGUgd2lsbCBzb3J0IG9uCgkJICogIEBwYXJhbSB7ZnVuY3Rpb259IFtmbkNhbGxiYWNrXSBjYWxsYmFjayBmdW5jdGlvbiB3aGVuIHNvcnQgaXMgcnVuCgkJICogIEBkdG9wdCBBUEkKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICogICAgICAKCQkgKiAgICAgIC8vIFNvcnQgb24gY29sdW1uIDEsIHdoZW4gJ3NvcnRlcicgaXMgY2xpY2tlZCBvbgoJCSAqICAgICAgb1RhYmxlLmZuU29ydExpc3RlbmVyKCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc29ydGVyJyksIDEgKTsKCQkgKiAgICB9ICk7CgkJICovCgkJdGhpcy5mblNvcnRMaXN0ZW5lciA9IGZ1bmN0aW9uKCBuTm9kZSwgaUNvbHVtbiwgZm5DYWxsYmFjayApCgkJewoJCQlfZm5Tb3J0QXR0YWNoTGlzdGVuZXIoIF9mblNldHRpbmdzRnJvbU5vZGUoIHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdICksIG5Ob2RlLCBpQ29sdW1uLAoJCQkgCWZuQ2FsbGJhY2sgKTsKCQl9OwoJCQoJCQoJCS8qKgoJCSAqIFVwZGF0ZSBhIHRhYmxlIGNlbGwgb3Igcm93IC0gdGhpcyBtZXRob2Qgd2lsbCBhY2NlcHQgZWl0aGVyIGEgc2luZ2xlIHZhbHVlIHRvCgkJICogdXBkYXRlIHRoZSBjZWxsIHdpdGgsIGFuIGFycmF5IG9mIHZhbHVlcyB3aXRoIG9uZSBlbGVtZW50IGZvciBlYWNoIGNvbHVtbiBvcgoJCSAqIGFuIG9iamVjdCBpbiB0aGUgc2FtZSBmb3JtYXQgYXMgdGhlIG9yaWdpbmFsIGRhdGEgc291cmNlLiBUaGUgZnVuY3Rpb24gaXMKCQkgKiBzZWxmLXJlZmVyZW5jaW5nIGluIG9yZGVyIHRvIG1ha2UgdGhlIG11bHRpIGNvbHVtbiB1cGRhdGVzIGVhc2llci4KCQkgKiAgQHBhcmFtIHtvYmplY3R8YXJyYXl8c3RyaW5nfSBtRGF0YSBEYXRhIHRvIHVwZGF0ZSB0aGUgY2VsbC9yb3cgd2l0aAoJCSAqICBAcGFyYW0ge25vZGV8aW50fSBtUm93IFRSIGVsZW1lbnQgeW91IHdhbnQgdG8gdXBkYXRlIG9yIHRoZSBhb0RhdGEgaW5kZXgKCQkgKiAgQHBhcmFtIHtpbnR9IFtpQ29sdW1uXSBUaGUgY29sdW1uIHRvIHVwZGF0ZSAobm90IHVzZWQgb2YgbURhdGEgaXMgYW4gYXJyYXkgb3Igb2JqZWN0KQoJCSAqICBAcGFyYW0ge2Jvb2x9IFtiUmVkcmF3PXRydWVdIFJlZHJhdyB0aGUgdGFibGUgb3Igbm90CgkJICogIEBwYXJhbSB7Ym9vbH0gW2JBY3Rpb249dHJ1ZV0gUGVyZm9ybSBwcmVkcmF3IGFjdGlvbnMgb3Igbm90CgkJICogIEByZXR1cm5zIHtpbnR9IDAgb24gc3VjY2VzcywgMSBvbiBlcnJvcgoJCSAqICBAZHRvcHQgQVBJCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqICAgICAgb1RhYmxlLmZuVXBkYXRlKCAnRXhhbXBsZSB1cGRhdGUnLCAwLCAwICk7IC8vIFNpbmdsZSBjZWxsCgkJICogICAgICBvVGFibGUuZm5VcGRhdGUoIFsnYScsICdiJywgJ2MnLCAnZCcsICdlJ10sIDEsIDAgKTsgLy8gUm93CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuZm5VcGRhdGUgPSBmdW5jdGlvbiggbURhdGEsIG1Sb3csIGlDb2x1bW4sIGJSZWRyYXcsIGJBY3Rpb24gKQoJCXsKCQkJdmFyIG9TZXR0aW5ncyA9IF9mblNldHRpbmdzRnJvbU5vZGUoIHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdICk7CgkJCXZhciBpLCBpTGVuLCBzRGlzcGxheTsKCQkJdmFyIGlSb3cgPSAodHlwZW9mIG1Sb3cgPT09ICdvYmplY3QnKSA/IAoJCQkJX2ZuTm9kZVRvRGF0YUluZGV4KG9TZXR0aW5ncywgbVJvdykgOiBtUm93OwoJCQkKCQkJaWYgKCBvU2V0dGluZ3MuX19mblVwZGF0ZURlZXAgPT09IHVuZGVmaW5lZCAmJiAkLmlzQXJyYXkobURhdGEpICYmIHR5cGVvZiBtRGF0YSA9PT0gJ29iamVjdCcgKQoJCQl7CgkJCQkvKiBBcnJheSB1cGRhdGUgLSB1cGRhdGUgdGhlIHdob2xlIHJvdyAqLwoJCQkJb1NldHRpbmdzLmFvRGF0YVtpUm93XS5fYURhdGEgPSBtRGF0YS5zbGljZSgpOwoJCQkJCgkJCQkvKiBGbGFnIHRvIHRoZSBmdW5jdGlvbiB0aGF0IHdlIGFyZSByZWN1cnNpbmcgKi8KCQkJCW9TZXR0aW5ncy5fX2ZuVXBkYXRlRGVlcCA9IHRydWU7CgkJCQlmb3IgKCBpPTAgOyBpPG9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaSsrICkKCQkJCXsKCQkJCQl0aGlzLmZuVXBkYXRlKCBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpICksIGlSb3csIGksIGZhbHNlLCBmYWxzZSApOwoJCQkJfQoJCQkJb1NldHRpbmdzLl9fZm5VcGRhdGVEZWVwID0gdW5kZWZpbmVkOwoJCQl9CgkJCWVsc2UgaWYgKCBvU2V0dGluZ3MuX19mblVwZGF0ZURlZXAgPT09IHVuZGVmaW5lZCAmJiBtRGF0YSAhPT0gbnVsbCAmJiB0eXBlb2YgbURhdGEgPT09ICdvYmplY3QnICkKCQkJewoJCQkJLyogT2JqZWN0IHVwZGF0ZSAtIHVwZGF0ZSB0aGUgd2hvbGUgcm93IC0gYXNzdW1lIHRoZSBkZXZlbG9wZXIgZ2V0cyB0aGUgb2JqZWN0IHJpZ2h0ICovCgkJCQlvU2V0dGluZ3MuYW9EYXRhW2lSb3ddLl9hRGF0YSA9ICQuZXh0ZW5kKCB0cnVlLCB7fSwgbURhdGEgKTsKCQkKCQkJCW9TZXR0aW5ncy5fX2ZuVXBkYXRlRGVlcCA9IHRydWU7CgkJCQlmb3IgKCBpPTAgOyBpPG9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaSsrICkKCQkJCXsKCQkJCQl0aGlzLmZuVXBkYXRlKCBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpICksIGlSb3csIGksIGZhbHNlLCBmYWxzZSApOwoJCQkJfQoJCQkJb1NldHRpbmdzLl9fZm5VcGRhdGVEZWVwID0gdW5kZWZpbmVkOwoJCQl9CgkJCWVsc2UKCQkJewoJCQkJLyogSW5kaXZpZHVhbCBjZWxsIHVwZGF0ZSAqLwoJCQkJX2ZuU2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaUNvbHVtbiwgbURhdGEgKTsKCQkJCXNEaXNwbGF5ID0gX2ZuR2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaUNvbHVtbiwgJ2Rpc3BsYXknICk7CgkJCQkKCQkJCXZhciBvQ29sID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpQ29sdW1uXTsKCQkJCWlmICggb0NvbC5mblJlbmRlciAhPT0gbnVsbCApCgkJCQl7CgkJCQkJc0Rpc3BsYXkgPSBfZm5SZW5kZXIoIG9TZXR0aW5ncywgaVJvdywgaUNvbHVtbiApOwoJCQkJCWlmICggb0NvbC5iVXNlUmVuZGVyZWQgKQoJCQkJCXsKCQkJCQkJX2ZuU2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaUNvbHVtbiwgc0Rpc3BsYXkgKTsKCQkJCQl9CgkJCQl9CgkJCQkKCQkJCWlmICggb1NldHRpbmdzLmFvRGF0YVtpUm93XS5uVHIgIT09IG51bGwgKQoJCQkJewoJCQkJCS8qIERvIHRoZSBhY3R1YWwgSFRNTCB1cGRhdGUgKi8KCQkJCQlfZm5HZXRUZE5vZGVzKCBvU2V0dGluZ3MsIGlSb3cgKVtpQ29sdW1uXS5pbm5lckhUTUwgPSBzRGlzcGxheTsKCQkJCX0KCQkJfQoJCQkKCQkJLyogTW9kaWZ5IHRoZSBzZWFyY2ggaW5kZXggZm9yIHRoaXMgcm93IChzdHJpY3RseSB0aGlzIGlzIGxpa2VseSBub3QgbmVlZGVkLCBzaW5jZSBmblJlRHJhdwoJCQkgKiB3aWxsIHJlYnVpbGQgdGhlIHNlYXJjaCBhcnJheSAtIGhvd2V2ZXIsIHRoZSByZWRyYXcgbWlnaHQgYmUgZGlzYWJsZWQgYnkgdGhlIHVzZXIpCgkJCSAqLwoJCQl2YXIgaURpc3BsYXlJbmRleCA9ICQuaW5BcnJheSggaVJvdywgb1NldHRpbmdzLmFpRGlzcGxheSApOwoJCQlvU2V0dGluZ3MuYXNEYXRhU2VhcmNoW2lEaXNwbGF5SW5kZXhdID0gX2ZuQnVpbGRTZWFyY2hSb3coIG9TZXR0aW5ncywgCgkJCQlfZm5HZXRSb3dEYXRhKCBvU2V0dGluZ3MsIGlSb3csICdmaWx0ZXInICkgKTsKCQkJCgkJCS8qIFBlcmZvcm0gcHJlLWRyYXcgYWN0aW9ucyAqLwoJCQlpZiAoIGJBY3Rpb24gPT09IHVuZGVmaW5lZCB8fCBiQWN0aW9uICkKCQkJewoJCQkJX2ZuQWRqdXN0Q29sdW1uU2l6aW5nKCBvU2V0dGluZ3MgKTsKCQkJfQoJCQkKCQkJLyogUmVkcmF3IHRoZSB0YWJsZSAqLwoJCQlpZiAoIGJSZWRyYXcgPT09IHVuZGVmaW5lZCB8fCBiUmVkcmF3ICkKCQkJewoJCQkJX2ZuUmVEcmF3KCBvU2V0dGluZ3MgKTsKCQkJfQoJCQlyZXR1cm4gMDsKCQl9OwoJCQoJCQoJCS8qKgoJCSAqIFByb3ZpZGUgYSBjb21tb24gbWV0aG9kIGZvciBwbHVnLWlucyB0byBjaGVjayB0aGUgdmVyc2lvbiBvZiBEYXRhVGFibGVzIGJlaW5nIHVzZWQsIGluIG9yZGVyCgkJICogdG8gZW5zdXJlIGNvbXBhdGliaWxpdHkuCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzVmVyc2lvbiBWZXJzaW9uIHN0cmluZyB0byBjaGVjayBmb3IsIGluIHRoZSBmb3JtYXQgIlguWS5aIi4gTm90ZSB0aGF0IHRoZQoJCSAqICAgIGZvcm1hdHMgIlgiIGFuZCAiWC5ZIiBhcmUgYWxzbyBhY2NlcHRhYmxlLgoJCSAqICBAcmV0dXJucyB7Ym9vbGVhbn0gdHJ1ZSBpZiB0aGlzIHZlcnNpb24gb2YgRGF0YVRhYmxlcyBpcyBncmVhdGVyIG9yIGVxdWFsIHRvIHRoZSByZXF1aXJlZAoJCSAqICAgIHZlcnNpb24sIG9yIGZhbHNlIGlmIHRoaXMgdmVyc2lvbiBvZiBEYXRhVGFsZXMgaXMgbm90IHN1aXRhYmxlCgkJICogIEBtZXRob2QKCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICAgIGFsZXJ0KCBvVGFibGUuZm5WZXJzaW9uQ2hlY2soICcxLjkuMCcgKSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLmZuVmVyc2lvbkNoZWNrID0gRGF0YVRhYmxlLmV4dC5mblZlcnNpb25DaGVjazsKCQkKCQkKCQkvKgoJCSAqIFRoaXMgaXMgcmVhbGx5IGEgZ29vZCBiaXQgcnViYmlzaCB0aGlzIG1ldGhvZCBvZiBleHBvc2luZyB0aGUgaW50ZXJuYWwgbWV0aG9kcwoJCSAqIHB1YmxpY2FsbHkuLi4gLSBUbyBiZSBmaXhlZCBpbiAyLjAgdXNpbmcgbWV0aG9kcyBvbiB0aGUgcHJvdG90eXBlCgkJICovCgkJCgkJCgkJLyoqCgkJICogQ3JlYXRlIGEgd3JhcHBlciBmdW5jdGlvbiBmb3IgZXhwb3J0aW5nIGFuIGludGVybmFsIGZ1bmN0aW9ucyB0byBhbiBleHRlcm5hbCBBUEkuCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzRnVuYyBBUEkgZnVuY3Rpb24gbmFtZQoJCSAqICBAcmV0dXJucyB7ZnVuY3Rpb259IHdyYXBwZWQgZnVuY3Rpb24KCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuRXh0ZXJuQXBpRnVuYyAoc0Z1bmMpCgkJewoJCQlyZXR1cm4gZnVuY3Rpb24oKSB7CgkJCQl2YXIgYUFyZ3MgPSBbX2ZuU2V0dGluZ3NGcm9tTm9kZSh0aGlzW0RhdGFUYWJsZS5leHQuaUFwaUluZGV4XSldLmNvbmNhdCggCgkJCQkJQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKSApOwoJCQkJcmV0dXJuIERhdGFUYWJsZS5leHQub0FwaVtzRnVuY10uYXBwbHkoIHRoaXMsIGFBcmdzICk7CgkJCX07CgkJfQoJCQoJCQoJCS8qKgoJCSAqIFJlZmVyZW5jZSB0byBpbnRlcm5hbCBmdW5jdGlvbnMgZm9yIHVzZSBieSBwbHVnLWluIGRldmVsb3BlcnMuIE5vdGUgdGhhdCB0aGVzZQoJCSAqIG1ldGhvZHMgYXJlIHJlZmVyZW5jZXMgdG8gaW50ZXJuYWwgZnVuY3Rpb25zIGFuZCBhcmUgY29uc2lkZXJlZCB0byBiZSBwcml2YXRlLgoJCSAqIElmIHlvdSB1c2UgdGhlc2UgbWV0aG9kcywgYmUgYXdhcmUgdGhhdCB0aGV5IGFyZSBsaWFibGUgdG8gY2hhbmdlIGJldHdlZW4gdmVyc2lvbnMKCQkgKiAoY2hlY2sgdGhlIHVwZ3JhZGUgbm90ZXMpLgoJCSAqICBAbmFtZXNwYWNlCgkJICovCgkJdGhpcy5vQXBpID0gewoJCQkiX2ZuRXh0ZXJuQXBpRnVuYyI6IF9mbkV4dGVybkFwaUZ1bmMsCgkJCSJfZm5Jbml0aWFsaXNlIjogX2ZuSW5pdGlhbGlzZSwKCQkJIl9mbkluaXRDb21wbGV0ZSI6IF9mbkluaXRDb21wbGV0ZSwKCQkJIl9mbkxhbmd1YWdlQ29tcGF0IjogX2ZuTGFuZ3VhZ2VDb21wYXQsCgkJCSJfZm5BZGRDb2x1bW4iOiBfZm5BZGRDb2x1bW4sCgkJCSJfZm5Db2x1bW5PcHRpb25zIjogX2ZuQ29sdW1uT3B0aW9ucywKCQkJIl9mbkFkZERhdGEiOiBfZm5BZGREYXRhLAoJCQkiX2ZuQ3JlYXRlVHIiOiBfZm5DcmVhdGVUciwKCQkJIl9mbkdhdGhlckRhdGEiOiBfZm5HYXRoZXJEYXRhLAoJCQkiX2ZuQnVpbGRIZWFkIjogX2ZuQnVpbGRIZWFkLAoJCQkiX2ZuRHJhd0hlYWQiOiBfZm5EcmF3SGVhZCwKCQkJIl9mbkRyYXciOiBfZm5EcmF3LAoJCQkiX2ZuUmVEcmF3IjogX2ZuUmVEcmF3LAoJCQkiX2ZuQWpheFVwZGF0ZSI6IF9mbkFqYXhVcGRhdGUsCgkJCSJfZm5BamF4UGFyYW1ldGVycyI6IF9mbkFqYXhQYXJhbWV0ZXJzLAoJCQkiX2ZuQWpheFVwZGF0ZURyYXciOiBfZm5BamF4VXBkYXRlRHJhdywKCQkJIl9mblNlcnZlclBhcmFtcyI6IF9mblNlcnZlclBhcmFtcywKCQkJIl9mbkFkZE9wdGlvbnNIdG1sIjogX2ZuQWRkT3B0aW9uc0h0bWwsCgkJCSJfZm5GZWF0dXJlSHRtbFRhYmxlIjogX2ZuRmVhdHVyZUh0bWxUYWJsZSwKCQkJIl9mblNjcm9sbERyYXciOiBfZm5TY3JvbGxEcmF3LAoJCQkiX2ZuQWRqdXN0Q29sdW1uU2l6aW5nIjogX2ZuQWRqdXN0Q29sdW1uU2l6aW5nLAoJCQkiX2ZuRmVhdHVyZUh0bWxGaWx0ZXIiOiBfZm5GZWF0dXJlSHRtbEZpbHRlciwKCQkJIl9mbkZpbHRlckNvbXBsZXRlIjogX2ZuRmlsdGVyQ29tcGxldGUsCgkJCSJfZm5GaWx0ZXJDdXN0b20iOiBfZm5GaWx0ZXJDdXN0b20sCgkJCSJfZm5GaWx0ZXJDb2x1bW4iOiBfZm5GaWx0ZXJDb2x1bW4sCgkJCSJfZm5GaWx0ZXIiOiBfZm5GaWx0ZXIsCgkJCSJfZm5CdWlsZFNlYXJjaEFycmF5IjogX2ZuQnVpbGRTZWFyY2hBcnJheSwKCQkJIl9mbkJ1aWxkU2VhcmNoUm93IjogX2ZuQnVpbGRTZWFyY2hSb3csCgkJCSJfZm5GaWx0ZXJDcmVhdGVTZWFyY2giOiBfZm5GaWx0ZXJDcmVhdGVTZWFyY2gsCgkJCSJfZm5EYXRhVG9TZWFyY2giOiBfZm5EYXRhVG9TZWFyY2gsCgkJCSJfZm5Tb3J0IjogX2ZuU29ydCwKCQkJIl9mblNvcnRBdHRhY2hMaXN0ZW5lciI6IF9mblNvcnRBdHRhY2hMaXN0ZW5lciwKCQkJIl9mblNvcnRpbmdDbGFzc2VzIjogX2ZuU29ydGluZ0NsYXNzZXMsCgkJCSJfZm5GZWF0dXJlSHRtbFBhZ2luYXRlIjogX2ZuRmVhdHVyZUh0bWxQYWdpbmF0ZSwKCQkJIl9mblBhZ2VDaGFuZ2UiOiBfZm5QYWdlQ2hhbmdlLAoJCQkiX2ZuRmVhdHVyZUh0bWxJbmZvIjogX2ZuRmVhdHVyZUh0bWxJbmZvLAoJCQkiX2ZuVXBkYXRlSW5mbyI6IF9mblVwZGF0ZUluZm8sCgkJCSJfZm5GZWF0dXJlSHRtbExlbmd0aCI6IF9mbkZlYXR1cmVIdG1sTGVuZ3RoLAoJCQkiX2ZuRmVhdHVyZUh0bWxQcm9jZXNzaW5nIjogX2ZuRmVhdHVyZUh0bWxQcm9jZXNzaW5nLAoJCQkiX2ZuUHJvY2Vzc2luZ0Rpc3BsYXkiOiBfZm5Qcm9jZXNzaW5nRGlzcGxheSwKCQkJIl9mblZpc2libGVUb0NvbHVtbkluZGV4IjogX2ZuVmlzaWJsZVRvQ29sdW1uSW5kZXgsCgkJCSJfZm5Db2x1bW5JbmRleFRvVmlzaWJsZSI6IF9mbkNvbHVtbkluZGV4VG9WaXNpYmxlLAoJCQkiX2ZuTm9kZVRvRGF0YUluZGV4IjogX2ZuTm9kZVRvRGF0YUluZGV4LAoJCQkiX2ZuVmlzYmxlQ29sdW1ucyI6IF9mblZpc2JsZUNvbHVtbnMsCgkJCSJfZm5DYWxjdWxhdGVFbmQiOiBfZm5DYWxjdWxhdGVFbmQsCgkJCSJfZm5Db252ZXJ0VG9XaWR0aCI6IF9mbkNvbnZlcnRUb1dpZHRoLAoJCQkiX2ZuQ2FsY3VsYXRlQ29sdW1uV2lkdGhzIjogX2ZuQ2FsY3VsYXRlQ29sdW1uV2lkdGhzLAoJCQkiX2ZuU2Nyb2xsaW5nV2lkdGhBZGp1c3QiOiBfZm5TY3JvbGxpbmdXaWR0aEFkanVzdCwKCQkJIl9mbkdldFdpZGVzdE5vZGUiOiBfZm5HZXRXaWRlc3ROb2RlLAoJCQkiX2ZuR2V0TWF4TGVuU3RyaW5nIjogX2ZuR2V0TWF4TGVuU3RyaW5nLAoJCQkiX2ZuU3RyaW5nVG9Dc3MiOiBfZm5TdHJpbmdUb0NzcywKCQkJIl9mbkRldGVjdFR5cGUiOiBfZm5EZXRlY3RUeXBlLAoJCQkiX2ZuU2V0dGluZ3NGcm9tTm9kZSI6IF9mblNldHRpbmdzRnJvbU5vZGUsCgkJCSJfZm5HZXREYXRhTWFzdGVyIjogX2ZuR2V0RGF0YU1hc3RlciwKCQkJIl9mbkdldFRyTm9kZXMiOiBfZm5HZXRUck5vZGVzLAoJCQkiX2ZuR2V0VGROb2RlcyI6IF9mbkdldFRkTm9kZXMsCgkJCSJfZm5Fc2NhcGVSZWdleCI6IF9mbkVzY2FwZVJlZ2V4LAoJCQkiX2ZuRGVsZXRlSW5kZXgiOiBfZm5EZWxldGVJbmRleCwKCQkJIl9mblJlT3JkZXJJbmRleCI6IF9mblJlT3JkZXJJbmRleCwKCQkJIl9mbkNvbHVtbk9yZGVyaW5nIjogX2ZuQ29sdW1uT3JkZXJpbmcsCgkJCSJfZm5Mb2ciOiBfZm5Mb2csCgkJCSJfZm5DbGVhclRhYmxlIjogX2ZuQ2xlYXJUYWJsZSwKCQkJIl9mblNhdmVTdGF0ZSI6IF9mblNhdmVTdGF0ZSwKCQkJIl9mbkxvYWRTdGF0ZSI6IF9mbkxvYWRTdGF0ZSwKCQkJIl9mbkNyZWF0ZUNvb2tpZSI6IF9mbkNyZWF0ZUNvb2tpZSwKCQkJIl9mblJlYWRDb29raWUiOiBfZm5SZWFkQ29va2llLAoJCQkiX2ZuRGV0ZWN0SGVhZGVyIjogX2ZuRGV0ZWN0SGVhZGVyLAoJCQkiX2ZuR2V0VW5pcXVlVGhzIjogX2ZuR2V0VW5pcXVlVGhzLAoJCQkiX2ZuU2Nyb2xsQmFyV2lkdGgiOiBfZm5TY3JvbGxCYXJXaWR0aCwKCQkJIl9mbkFwcGx5VG9DaGlsZHJlbiI6IF9mbkFwcGx5VG9DaGlsZHJlbiwKCQkJIl9mbk1hcCI6IF9mbk1hcCwKCQkJIl9mbkdldFJvd0RhdGEiOiBfZm5HZXRSb3dEYXRhLAoJCQkiX2ZuR2V0Q2VsbERhdGEiOiBfZm5HZXRDZWxsRGF0YSwKCQkJIl9mblNldENlbGxEYXRhIjogX2ZuU2V0Q2VsbERhdGEsCgkJCSJfZm5HZXRPYmplY3REYXRhRm4iOiBfZm5HZXRPYmplY3REYXRhRm4sCgkJCSJfZm5TZXRPYmplY3REYXRhRm4iOiBfZm5TZXRPYmplY3REYXRhRm4sCgkJCSJfZm5BcHBseUNvbHVtbkRlZnMiOiBfZm5BcHBseUNvbHVtbkRlZnMsCgkJCSJfZm5CaW5kQWN0aW9uIjogX2ZuQmluZEFjdGlvbiwKCQkJIl9mbkV4dGVuZCI6IF9mbkV4dGVuZCwKCQkJIl9mbkNhbGxiYWNrUmVnIjogX2ZuQ2FsbGJhY2tSZWcsCgkJCSJfZm5DYWxsYmFja0ZpcmUiOiBfZm5DYWxsYmFja0ZpcmUsCgkJCSJfZm5Kc29uU3RyaW5nIjogX2ZuSnNvblN0cmluZywKCQkJIl9mblJlbmRlciI6IF9mblJlbmRlciwKCQkJIl9mbk5vZGVUb0NvbHVtbkluZGV4IjogX2ZuTm9kZVRvQ29sdW1uSW5kZXgsCgkJCSJfZm5JbmZvTWFjcm9zIjogX2ZuSW5mb01hY3JvcwoJCX07CgkJCgkJJC5leHRlbmQoIERhdGFUYWJsZS5leHQub0FwaSwgdGhpcy5vQXBpICk7CgkJCgkJZm9yICggdmFyIHNGdW5jIGluIERhdGFUYWJsZS5leHQub0FwaSApCgkJewoJCQlpZiAoIHNGdW5jICkKCQkJewoJCQkJdGhpc1tzRnVuY10gPSBfZm5FeHRlcm5BcGlGdW5jKHNGdW5jKTsKCQkJfQoJCX0KCQkKCQkKCQl2YXIgX3RoYXQgPSB0aGlzOwoJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CgkJCQoJCQl2YXIgaT0wLCBpTGVuLCBqLCBqTGVuLCBrLCBrTGVuOwoJCQl2YXIgc0lkID0gdGhpcy5nZXRBdHRyaWJ1dGUoICdpZCcgKTsKCQkJdmFyIGJJbml0SGFuZGVkT2ZmID0gZmFsc2U7CgkJCXZhciBiVXNlUGFzc2VkRGF0YSA9IGZhbHNlOwoJCQkKCQkJCgkJCS8qIFNhbml0eSBjaGVjayAqLwoJCQlpZiAoIHRoaXMubm9kZU5hbWUudG9Mb3dlckNhc2UoKSAhPSAndGFibGUnICkKCQkJewoJCQkJX2ZuTG9nKCBudWxsLCAwLCAiQXR0ZW1wdGVkIHRvIGluaXRpYWxpc2UgRGF0YVRhYmxlcyBvbiBhIG5vZGUgd2hpY2ggaXMgbm90IGEgIisKCQkJCQkidGFibGU6ICIrdGhpcy5ub2RlTmFtZSApOwoJCQkJcmV0dXJuOwoJCQl9CgkJCQoJCQkvKiBDaGVjayB0byBzZWUgaWYgd2UgYXJlIHJlLWluaXRpYWxpc2luZyBhIHRhYmxlICovCgkJCWZvciAoIGk9MCwgaUxlbj1EYXRhVGFibGUuc2V0dGluZ3MubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJLyogQmFzZSBjaGVjayBvbiB0YWJsZSBub2RlICovCgkJCQlpZiAoIERhdGFUYWJsZS5zZXR0aW5nc1tpXS5uVGFibGUgPT0gdGhpcyApCgkJCQl7CgkJCQkJaWYgKCBvSW5pdCA9PT0gdW5kZWZpbmVkIHx8IG9Jbml0LmJSZXRyaWV2ZSApCgkJCQkJewoJCQkJCQlyZXR1cm4gRGF0YVRhYmxlLnNldHRpbmdzW2ldLm9JbnN0YW5jZTsKCQkJCQl9CgkJCQkJZWxzZSBpZiAoIG9Jbml0LmJEZXN0cm95ICkKCQkJCQl7CgkJCQkJCURhdGFUYWJsZS5zZXR0aW5nc1tpXS5vSW5zdGFuY2UuZm5EZXN0cm95KCk7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCQkJCQllbHNlCgkJCQkJewoJCQkJCQlfZm5Mb2coIERhdGFUYWJsZS5zZXR0aW5nc1tpXSwgMCwgIkNhbm5vdCByZWluaXRpYWxpc2UgRGF0YVRhYmxlLlxuXG4iKwoJCQkJCQkJIlRvIHJldHJpZXZlIHRoZSBEYXRhVGFibGVzIG9iamVjdCBmb3IgdGhpcyB0YWJsZSwgcGFzcyBubyBhcmd1bWVudHMgb3Igc2VlICIrCgkJCQkJCQkidGhlIGRvY3MgZm9yIGJSZXRyaWV2ZSBhbmQgYkRlc3Ryb3kiICk7CgkJCQkJCXJldHVybjsKCQkJCQl9CgkJCQl9CgkJCQkKCQkJCS8qIElmIHRoZSBlbGVtZW50IHdlIGFyZSBpbml0aWFsaXNpbmcgaGFzIHRoZSBzYW1lIElEIGFzIGEgdGFibGUgd2hpY2ggd2FzIHByZXZpb3VzbHkKCQkJCSAqIGluaXRpYWxpc2VkLCBidXQgdGhlIHRhYmxlIG5vZGVzIGRvbid0IG1hdGNoIChmcm9tIGJlZm9yZSkgdGhlbiB3ZSBkZXN0cm95IHRoZSBvbGQKCQkJCSAqIGluc3RhbmNlIGJ5IHNpbXBseSBkZWxldGluZyBpdC4gVGhpcyBpcyB1bmRlciB0aGUgYXNzdW1wdGlvbiB0aGF0IHRoZSB0YWJsZSBoYXMgYmVlbgoJCQkJICogZGVzdHJveWVkIGJ5IG90aGVyIG1ldGhvZHMuIEFueW9uZSB1c2luZyBub24taWQgc2VsZWN0b3JzIHdpbGwgbmVlZCB0byBkbyB0aGlzIG1hbnVhbGx5CgkJCQkgKi8KCQkJCWlmICggRGF0YVRhYmxlLnNldHRpbmdzW2ldLnNUYWJsZUlkID09IHRoaXMuaWQgKQoJCQkJewoJCQkJCURhdGFUYWJsZS5zZXR0aW5ncy5zcGxpY2UoIGksIDEgKTsKCQkJCQlicmVhazsKCQkJCX0KCQkJfQoJCQkKCQkJLyogRW5zdXJlIHRoZSB0YWJsZSBoYXMgYW4gSUQgLSByZXF1aXJlZCBmb3IgYWNjZXNzaWJpbGl0eSAqLwoJCQlpZiAoIHNJZCA9PT0gbnVsbCB8fCBzSWQgPT09ICIiICkKCQkJewoJCQkJc0lkID0gIkRhdGFUYWJsZXNfVGFibGVfIisoRGF0YVRhYmxlLmV4dC5fb0V4dGVybkNvbmZpZy5pTmV4dFVuaXF1ZSsrKTsKCQkJCXRoaXMuaWQgPSBzSWQ7CgkJCX0KCQkJCgkJCS8qIENyZWF0ZSB0aGUgc2V0dGluZ3Mgb2JqZWN0IGZvciB0aGlzIHRhYmxlIGFuZCBzZXQgc29tZSBvZiB0aGUgZGVmYXVsdCBwYXJhbWV0ZXJzICovCgkJCXZhciBvU2V0dGluZ3MgPSAkLmV4dGVuZCggdHJ1ZSwge30sIERhdGFUYWJsZS5tb2RlbHMub1NldHRpbmdzLCB7CgkJCQkiblRhYmxlIjogICAgICAgIHRoaXMsCgkJCQkib0FwaSI6ICAgICAgICAgIF90aGF0Lm9BcGksCgkJCQkib0luaXQiOiAgICAgICAgIG9Jbml0LAoJCQkJInNEZXN0cm95V2lkdGgiOiAkKHRoaXMpLndpZHRoKCksCgkJCQkic0luc3RhbmNlIjogICAgIHNJZCwKCQkJCSJzVGFibGVJZCI6ICAgICAgc0lkCgkJCX0gKTsKCQkJRGF0YVRhYmxlLnNldHRpbmdzLnB1c2goIG9TZXR0aW5ncyApOwoJCQkKCQkJLy8gTmVlZCB0byBhZGQgdGhlIGluc3RhbmNlIGFmdGVyIHRoZSBpbnN0YW5jZSBhZnRlciB0aGUgc2V0dGluZ3Mgb2JqZWN0IGhhcyBiZWVuIGFkZGVkCgkJCS8vIHRvIHRoZSBzZXR0aW5ncyBhcnJheSwgc28gd2UgY2FuIHNlbGYgcmVmZXJlbmNlIHRoZSB0YWJsZSBpbnN0YW5jZSBpZiBtb3JlIHRoYW4gb25lCgkJCW9TZXR0aW5ncy5vSW5zdGFuY2UgPSAoX3RoYXQubGVuZ3RoPT09MSkgPyBfdGhhdCA6ICQodGhpcykuZGF0YVRhYmxlKCk7CgkJCQoJCQkvKiBTZXR0aW5nIHVwIHRoZSBpbml0aWFsaXNhdGlvbiBvYmplY3QgKi8KCQkJaWYgKCAhb0luaXQgKQoJCQl7CgkJCQlvSW5pdCA9IHt9OwoJCQl9CgkJCQoJCQkvLyBCYWNrd2FyZHMgY29tcGF0aWJpbGl0eSwgYmVmb3JlIHdlIGFwcGx5IGFsbCB0aGUgZGVmYXVsdHMKCQkJaWYgKCBvSW5pdC5vTGFuZ3VhZ2UgKQoJCQl7CgkJCQlfZm5MYW5ndWFnZUNvbXBhdCggb0luaXQub0xhbmd1YWdlICk7CgkJCX0KCQkJCgkJCW9Jbml0ID0gX2ZuRXh0ZW5kKCAkLmV4dGVuZCh0cnVlLCB7fSwgRGF0YVRhYmxlLmRlZmF1bHRzKSwgb0luaXQgKTsKCQkJCgkJCS8vIE1hcCB0aGUgaW5pdGlhbGlzYXRpb24gb3B0aW9ucyBvbnRvIHRoZSBzZXR0aW5ncyBvYmplY3QKCQkJX2ZuTWFwKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLCBvSW5pdCwgImJQYWdpbmF0ZSIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLCBvSW5pdCwgImJMZW5ndGhDaGFuZ2UiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLm9GZWF0dXJlcywgb0luaXQsICJiRmlsdGVyIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vRmVhdHVyZXMsIG9Jbml0LCAiYlNvcnQiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLm9GZWF0dXJlcywgb0luaXQsICJiSW5mbyIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLCBvSW5pdCwgImJQcm9jZXNzaW5nIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vRmVhdHVyZXMsIG9Jbml0LCAiYkF1dG9XaWR0aCIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLCBvSW5pdCwgImJTb3J0Q2xhc3NlcyIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLCBvSW5pdCwgImJTZXJ2ZXJTaWRlIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vRmVhdHVyZXMsIG9Jbml0LCAiYkRlZmVyUmVuZGVyIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vU2Nyb2xsLCBvSW5pdCwgInNTY3JvbGxYIiwgInNYIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vU2Nyb2xsLCBvSW5pdCwgInNTY3JvbGxYSW5uZXIiLCAic1hJbm5lciIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3Mub1Njcm9sbCwgb0luaXQsICJzU2Nyb2xsWSIsICJzWSIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3Mub1Njcm9sbCwgb0luaXQsICJiU2Nyb2xsQ29sbGFwc2UiLCAiYkNvbGxhcHNlIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vU2Nyb2xsLCBvSW5pdCwgImJTY3JvbGxJbmZpbml0ZSIsICJiSW5maW5pdGUiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLm9TY3JvbGwsIG9Jbml0LCAiaVNjcm9sbExvYWRHYXAiLCAiaUxvYWRHYXAiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLm9TY3JvbGwsIG9Jbml0LCAiYlNjcm9sbEF1dG9Dc3MiLCAiYkF1dG9Dc3MiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLCBvSW5pdCwgImFzU3RyaXBlQ2xhc3NlcyIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAiYXNTdHJpcENsYXNzZXMiLCAiYXNTdHJpcGVDbGFzc2VzIiApOyAvLyBsZWdhY3kKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAiZm5TZXJ2ZXJEYXRhIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJmbkZvcm1hdE51bWJlciIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAic1NlcnZlck1ldGhvZCIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAiYWFTb3J0aW5nIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJhYVNvcnRpbmdGaXhlZCIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAiYUxlbmd0aE1lbnUiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLCBvSW5pdCwgInNQYWdpbmF0aW9uVHlwZSIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAic0FqYXhTb3VyY2UiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLCBvSW5pdCwgInNBamF4RGF0YVByb3AiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLCBvSW5pdCwgImlDb29raWVEdXJhdGlvbiIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAic0Nvb2tpZVByZWZpeCIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAic0RvbSIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAiYlNvcnRDZWxsc1RvcCIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAiaVRhYkluZGV4IiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJvU2VhcmNoIiwgIm9QcmV2aW91c1NlYXJjaCIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAiYW9TZWFyY2hDb2xzIiwgImFvUHJlU2VhcmNoQ29scyIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAiaURpc3BsYXlMZW5ndGgiLCAiX2lEaXNwbGF5TGVuZ3RoIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJiSlF1ZXJ5VUkiLCAiYkpVSSIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAiZm5Db29raWVDYWxsYmFjayIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAiZm5TdGF0ZUxvYWQiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLCBvSW5pdCwgImZuU3RhdGVTYXZlIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vTGFuZ3VhZ2UsIG9Jbml0LCAiZm5JbmZvQ2FsbGJhY2siICk7CgkJCQoJCQkvKiBDYWxsYmFjayBmdW5jdGlvbnMgd2hpY2ggYXJlIGFycmF5IGRyaXZlbiAqLwoJCQlfZm5DYWxsYmFja1JlZyggb1NldHRpbmdzLCAnYW9EcmF3Q2FsbGJhY2snLCAgICAgICBvSW5pdC5mbkRyYXdDYWxsYmFjaywgICAgICAndXNlcicgKTsKCQkJX2ZuQ2FsbGJhY2tSZWcoIG9TZXR0aW5ncywgJ2FvU2VydmVyUGFyYW1zJywgICAgICAgb0luaXQuZm5TZXJ2ZXJQYXJhbXMsICAgICAgJ3VzZXInICk7CgkJCV9mbkNhbGxiYWNrUmVnKCBvU2V0dGluZ3MsICdhb1N0YXRlU2F2ZVBhcmFtcycsICAgIG9Jbml0LmZuU3RhdGVTYXZlUGFyYW1zLCAgICd1c2VyJyApOwoJCQlfZm5DYWxsYmFja1JlZyggb1NldHRpbmdzLCAnYW9TdGF0ZUxvYWRQYXJhbXMnLCAgICBvSW5pdC5mblN0YXRlTG9hZFBhcmFtcywgICAndXNlcicgKTsKCQkJX2ZuQ2FsbGJhY2tSZWcoIG9TZXR0aW5ncywgJ2FvU3RhdGVMb2FkZWQnLCAgICAgICAgb0luaXQuZm5TdGF0ZUxvYWRlZCwgICAgICAgJ3VzZXInICk7CgkJCV9mbkNhbGxiYWNrUmVnKCBvU2V0dGluZ3MsICdhb1Jvd0NhbGxiYWNrJywgICAgICAgIG9Jbml0LmZuUm93Q2FsbGJhY2ssICAgICAgICd1c2VyJyApOwoJCQlfZm5DYWxsYmFja1JlZyggb1NldHRpbmdzLCAnYW9Sb3dDcmVhdGVkQ2FsbGJhY2snLCBvSW5pdC5mbkNyZWF0ZWRSb3csICAgICAgICAndXNlcicgKTsKCQkJX2ZuQ2FsbGJhY2tSZWcoIG9TZXR0aW5ncywgJ2FvSGVhZGVyQ2FsbGJhY2snLCAgICAgb0luaXQuZm5IZWFkZXJDYWxsYmFjaywgICAgJ3VzZXInICk7CgkJCV9mbkNhbGxiYWNrUmVnKCBvU2V0dGluZ3MsICdhb0Zvb3RlckNhbGxiYWNrJywgICAgIG9Jbml0LmZuRm9vdGVyQ2FsbGJhY2ssICAgICd1c2VyJyApOwoJCQlfZm5DYWxsYmFja1JlZyggb1NldHRpbmdzLCAnYW9Jbml0Q29tcGxldGUnLCAgICAgICBvSW5pdC5mbkluaXRDb21wbGV0ZSwgICAgICAndXNlcicgKTsKCQkJX2ZuQ2FsbGJhY2tSZWcoIG9TZXR0aW5ncywgJ2FvUHJlRHJhd0NhbGxiYWNrJywgICAgb0luaXQuZm5QcmVEcmF3Q2FsbGJhY2ssICAgJ3VzZXInICk7CgkJCQoJCQlpZiAoIG9TZXR0aW5ncy5vRmVhdHVyZXMuYlNlcnZlclNpZGUgJiYgb1NldHRpbmdzLm9GZWF0dXJlcy5iU29ydCAmJgoJCQkJICAgb1NldHRpbmdzLm9GZWF0dXJlcy5iU29ydENsYXNzZXMgKQoJCQl7CgkJCQkvKiBFbmFibGUgc29ydCBjbGFzc2VzIGZvciBzZXJ2ZXItc2lkZSBwcm9jZXNzaW5nLiBTYWZlIHRvIGRvIGl0IGhlcmUsIHNpbmNlIHNlcnZlci1zaWRlCgkJCQkgKiBwcm9jZXNzaW5nIG11c3QgYmUgZW5hYmxlZCBieSB0aGUgZGV2ZWxvcGVyCgkJCQkgKi8KCQkJCV9mbkNhbGxiYWNrUmVnKCBvU2V0dGluZ3MsICdhb0RyYXdDYWxsYmFjaycsIF9mblNvcnRpbmdDbGFzc2VzLCAnc2VydmVyX3NpZGVfc29ydF9jbGFzc2VzJyApOwoJCQl9CgkJCWVsc2UgaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJEZWZlclJlbmRlciApCgkJCXsKCQkJCV9mbkNhbGxiYWNrUmVnKCBvU2V0dGluZ3MsICdhb0RyYXdDYWxsYmFjaycsIF9mblNvcnRpbmdDbGFzc2VzLCAnZGVmZXJfc29ydF9jbGFzc2VzJyApOwoJCQl9CgkJCQoJCQlpZiAoIG9Jbml0LmJKUXVlcnlVSSApCgkJCXsKCQkJCS8qIFVzZSB0aGUgSlVJIGNsYXNzZXMgb2JqZWN0IGZvciBkaXNwbGF5LiBZb3UgY291bGQgY2xvbmUgdGhlIG9TdGRDbGFzc2VzIG9iamVjdCBpZiAKCQkJCSAqIHlvdSB3YW50IHRvIGhhdmUgbXVsdGlwbGUgdGFibGVzIHdpdGggbXVsdGlwbGUgaW5kZXBlbmRlbnQgY2xhc3NlcyAKCQkJCSAqLwoJCQkJJC5leHRlbmQoIG9TZXR0aW5ncy5vQ2xhc3NlcywgRGF0YVRhYmxlLmV4dC5vSlVJQ2xhc3NlcyApOwoJCQkJCgkJCQlpZiAoIG9Jbml0LnNEb20gPT09IERhdGFUYWJsZS5kZWZhdWx0cy5zRG9tICYmIERhdGFUYWJsZS5kZWZhdWx0cy5zRG9tID09PSAibGZydGlwIiApCgkJCQl7CgkJCQkJLyogU2V0IHRoZSBET00gdG8gdXNlIGEgbGF5b3V0IHN1aXRhYmxlIGZvciBqUXVlcnkgVUkncyB0aGVtaW5nICovCgkJCQkJb1NldHRpbmdzLnNEb20gPSAnPCJIImxmcj50PCJGImlwPic7CgkJCQl9CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQkkLmV4dGVuZCggb1NldHRpbmdzLm9DbGFzc2VzLCBEYXRhVGFibGUuZXh0Lm9TdGRDbGFzc2VzICk7CgkJCX0KCQkJJCh0aGlzKS5hZGRDbGFzcyggb1NldHRpbmdzLm9DbGFzc2VzLnNUYWJsZSApOwoJCQkKCQkJLyogQ2FsY3VsYXRlIHRoZSBzY3JvbGwgYmFyIHdpZHRoIGFuZCBjYWNoZSBpdCBmb3IgdXNlIGxhdGVyIG9uICovCgkJCWlmICggb1NldHRpbmdzLm9TY3JvbGwuc1ggIT09ICIiIHx8IG9TZXR0aW5ncy5vU2Nyb2xsLnNZICE9PSAiIiApCgkJCXsKCQkJCW9TZXR0aW5ncy5vU2Nyb2xsLmlCYXJXaWR0aCA9IF9mblNjcm9sbEJhcldpZHRoKCk7CgkJCX0KCQkJCgkJCWlmICggb1NldHRpbmdzLmlJbml0RGlzcGxheVN0YXJ0ID09PSB1bmRlZmluZWQgKQoJCQl7CgkJCQkvKiBEaXNwbGF5IHN0YXJ0IHBvaW50LCB0YWtpbmcgaW50byBhY2NvdW50IHRoZSBzYXZlIHNhdmluZyAqLwoJCQkJb1NldHRpbmdzLmlJbml0RGlzcGxheVN0YXJ0ID0gb0luaXQuaURpc3BsYXlTdGFydDsKCQkJCW9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA9IG9Jbml0LmlEaXNwbGF5U3RhcnQ7CgkJCX0KCQkJCgkJCS8qIE11c3QgYmUgZG9uZSBhZnRlciBldmVyeXRoaW5nIHdoaWNoIGNhbiBiZSBvdmVycmlkZGVuIGJ5IGEgY29va2llISAqLwoJCQlpZiAoIG9Jbml0LmJTdGF0ZVNhdmUgKQoJCQl7CgkJCQlvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTdGF0ZVNhdmUgPSB0cnVlOwoJCQkJX2ZuTG9hZFN0YXRlKCBvU2V0dGluZ3MsIG9Jbml0ICk7CgkJCQlfZm5DYWxsYmFja1JlZyggb1NldHRpbmdzLCAnYW9EcmF3Q2FsbGJhY2snLCBfZm5TYXZlU3RhdGUsICdzdGF0ZV9zYXZlJyApOwoJCQl9CgkJCQoJCQlpZiAoIG9Jbml0LmlEZWZlckxvYWRpbmcgIT09IG51bGwgKQoJCQl7CgkJCQlvU2V0dGluZ3MuYkRlZmVyTG9hZGluZyA9IHRydWU7CgkJCQl2YXIgdG1wID0gJC5pc0FycmF5KCBvSW5pdC5pRGVmZXJMb2FkaW5nICk7CgkJCQlvU2V0dGluZ3MuX2lSZWNvcmRzRGlzcGxheSA9IHRtcCA/IG9Jbml0LmlEZWZlckxvYWRpbmdbMF0gOiBvSW5pdC5pRGVmZXJMb2FkaW5nOwoJCQkJb1NldHRpbmdzLl9pUmVjb3Jkc1RvdGFsID0gdG1wID8gb0luaXQuaURlZmVyTG9hZGluZ1sxXSA6IG9Jbml0LmlEZWZlckxvYWRpbmc7CgkJCX0KCQkJCgkJCWlmICggb0luaXQuYWFEYXRhICE9PSBudWxsICkKCQkJewoJCQkJYlVzZVBhc3NlZERhdGEgPSB0cnVlOwoJCQl9CgkJCQoJCQkvKiBMYW5ndWFnZSBkZWZpbml0aW9ucyAqLwoJCQlpZiAoIG9Jbml0Lm9MYW5ndWFnZS5zVXJsICE9PSAiIiApCgkJCXsKCQkJCS8qIEdldCB0aGUgbGFuZ3VhZ2UgZGVmaW5pdGlvbnMgZnJvbSBhIGZpbGUgLSBiZWNhdXNlIHRoaXMgQWpheCBjYWxsIG1ha2VzIHRoZSBsYW5ndWFnZQoJCQkJICogZ2V0IGFzeW5jIHRvIHRoZSByZW1haW5kZXIgb2YgdGhpcyBmdW5jdGlvbiB3ZSB1c2UgYkluaXRIYW5kZWRPZmYgdG8gaW5kaWNhdGUgdGhhdCAKCQkJCSAqIF9mbkluaXRpYWxpc2Ugd2lsbCBiZSBmaXJlZCBieSB0aGUgcmV0dXJuZWQgQWpheCBoYW5kbGVyLCByYXRoZXIgdGhhbiB0aGUgY29uc3RydWN0b3IKCQkJCSAqLwoJCQkJb1NldHRpbmdzLm9MYW5ndWFnZS5zVXJsID0gb0luaXQub0xhbmd1YWdlLnNVcmw7CgkJCQkkLmdldEpTT04oIG9TZXR0aW5ncy5vTGFuZ3VhZ2Uuc1VybCwgbnVsbCwgZnVuY3Rpb24oIGpzb24gKSB7CgkJCQkJX2ZuTGFuZ3VhZ2VDb21wYXQoIGpzb24gKTsKCQkJCQkkLmV4dGVuZCggdHJ1ZSwgb1NldHRpbmdzLm9MYW5ndWFnZSwgb0luaXQub0xhbmd1YWdlLCBqc29uICk7CgkJCQkJX2ZuSW5pdGlhbGlzZSggb1NldHRpbmdzICk7CgkJCQl9ICk7CgkJCQliSW5pdEhhbmRlZE9mZiA9IHRydWU7CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQkkLmV4dGVuZCggdHJ1ZSwgb1NldHRpbmdzLm9MYW5ndWFnZSwgb0luaXQub0xhbmd1YWdlICk7CgkJCX0KCQkJCgkJCQoJCQkvKgoJCQkgKiBTdHJpcGVzCgkJCSAqLwoJCQlpZiAoIG9Jbml0LmFzU3RyaXBlQ2xhc3NlcyA9PT0gbnVsbCApCgkJCXsKCQkJCW9TZXR0aW5ncy5hc1N0cmlwZUNsYXNzZXMgPVsKCQkJCQlvU2V0dGluZ3Mub0NsYXNzZXMuc1N0cmlwZU9kZCwKCQkJCQlvU2V0dGluZ3Mub0NsYXNzZXMuc1N0cmlwZUV2ZW4KCQkJCV07CgkJCX0KCQkJCgkJCS8qIFJlbW92ZSByb3cgc3RyaXBlIGNsYXNzZXMgaWYgdGhleSBhcmUgYWxyZWFkeSBvbiB0aGUgdGFibGUgcm93ICovCgkJCXZhciBiU3RyaXBlUmVtb3ZlID0gZmFsc2U7CgkJCXZhciBhblJvd3MgPSAkKHRoaXMpLmNoaWxkcmVuKCd0Ym9keScpLmNoaWxkcmVuKCd0cicpOwoJCQlmb3IgKCBpPTAsIGlMZW49b1NldHRpbmdzLmFzU3RyaXBlQ2xhc3Nlcy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlpZiAoIGFuUm93cy5maWx0ZXIoIjpsdCgyKSIpLmhhc0NsYXNzKCBvU2V0dGluZ3MuYXNTdHJpcGVDbGFzc2VzW2ldKSApCgkJCQl7CgkJCQkJYlN0cmlwZVJlbW92ZSA9IHRydWU7CgkJCQkJYnJlYWs7CgkJCQl9CgkJCX0KCQkJCQkKCQkJaWYgKCBiU3RyaXBlUmVtb3ZlICkKCQkJewoJCQkJLyogU3RvcmUgdGhlIGNsYXNzZXMgd2hpY2ggd2UgYXJlIGFib3V0IHRvIHJlbW92ZSBzbyB0aGV5IGNhbiBiZSByZWFkZGVkIG9uIGRlc3Ryb3kgKi8KCQkJCW9TZXR0aW5ncy5hc0Rlc3Ryb3lTdHJpcGVzID0gWyAnJywgJycgXTsKCQkJCWlmICggJChhblJvd3NbMF0pLmhhc0NsYXNzKG9TZXR0aW5ncy5vQ2xhc3Nlcy5zU3RyaXBlT2RkKSApCgkJCQl7CgkJCQkJb1NldHRpbmdzLmFzRGVzdHJveVN0cmlwZXNbMF0gKz0gb1NldHRpbmdzLm9DbGFzc2VzLnNTdHJpcGVPZGQrIiAiOwoJCQkJfQoJCQkJaWYgKCAkKGFuUm93c1swXSkuaGFzQ2xhc3Mob1NldHRpbmdzLm9DbGFzc2VzLnNTdHJpcGVFdmVuKSApCgkJCQl7CgkJCQkJb1NldHRpbmdzLmFzRGVzdHJveVN0cmlwZXNbMF0gKz0gb1NldHRpbmdzLm9DbGFzc2VzLnNTdHJpcGVFdmVuOwoJCQkJfQoJCQkJaWYgKCAkKGFuUm93c1sxXSkuaGFzQ2xhc3Mob1NldHRpbmdzLm9DbGFzc2VzLnNTdHJpcGVPZGQpICkKCQkJCXsKCQkJCQlvU2V0dGluZ3MuYXNEZXN0cm95U3RyaXBlc1sxXSArPSBvU2V0dGluZ3Mub0NsYXNzZXMuc1N0cmlwZU9kZCsiICI7CgkJCQl9CgkJCQlpZiAoICQoYW5Sb3dzWzFdKS5oYXNDbGFzcyhvU2V0dGluZ3Mub0NsYXNzZXMuc1N0cmlwZUV2ZW4pICkKCQkJCXsKCQkJCQlvU2V0dGluZ3MuYXNEZXN0cm95U3RyaXBlc1sxXSArPSBvU2V0dGluZ3Mub0NsYXNzZXMuc1N0cmlwZUV2ZW47CgkJCQl9CgkJCQkKCQkJCWFuUm93cy5yZW1vdmVDbGFzcyggb1NldHRpbmdzLmFzU3RyaXBlQ2xhc3Nlcy5qb2luKCcgJykgKTsKCQkJfQoJCQkKCQkJCgkJCS8qCgkJCSAqIENvbHVtbnMKCQkJICogU2VlIGlmIHdlIHNob3VsZCBsb2FkIGNvbHVtbnMgYXV0b21hdGljYWxseSBvciB1c2UgZGVmaW5lZCBvbmVzCgkJCSAqLwoJCQl2YXIgYW5UaHMgPSBbXTsKCQkJdmFyIGFvQ29sdW1uc0luaXQ7CgkJCXZhciBuVGhlYWQgPSB0aGlzLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0aGVhZCcpOwoJCQlpZiAoIG5UaGVhZC5sZW5ndGggIT09IDAgKQoJCQl7CgkJCQlfZm5EZXRlY3RIZWFkZXIoIG9TZXR0aW5ncy5hb0hlYWRlciwgblRoZWFkWzBdICk7CgkJCQlhblRocyA9IF9mbkdldFVuaXF1ZVRocyggb1NldHRpbmdzICk7CgkJCX0KCQkJCgkJCS8qIElmIG5vdCBnaXZlbiBhIGNvbHVtbiBhcnJheSwgZ2VuZXJhdGUgb25lIHdpdGggbnVsbHMgKi8KCQkJaWYgKCBvSW5pdC5hb0NvbHVtbnMgPT09IG51bGwgKQoJCQl7CgkJCQlhb0NvbHVtbnNJbml0ID0gW107CgkJCQlmb3IgKCBpPTAsIGlMZW49YW5UaHMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQlhb0NvbHVtbnNJbml0LnB1c2goIG51bGwgKTsKCQkJCX0KCQkJfQoJCQllbHNlCgkJCXsKCQkJCWFvQ29sdW1uc0luaXQgPSBvSW5pdC5hb0NvbHVtbnM7CgkJCX0KCQkJCgkJCS8qIEFkZCB0aGUgY29sdW1ucyAqLwoJCQlmb3IgKCBpPTAsIGlMZW49YW9Db2x1bW5zSW5pdC5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQkvKiBTaG9ydCBjdXQgLSB1c2UgdGhlIGxvb3AgdG8gY2hlY2sgaWYgd2UgaGF2ZSBjb2x1bW4gdmlzaWJpbGl0eSBzdGF0ZSB0byByZXN0b3JlICovCgkJCQlpZiAoIG9Jbml0LnNhdmVkX2FvQ29sdW1ucyAhPT0gdW5kZWZpbmVkICYmIG9Jbml0LnNhdmVkX2FvQ29sdW1ucy5sZW5ndGggPT0gaUxlbiApCgkJCQl7CgkJCQkJaWYgKCBhb0NvbHVtbnNJbml0W2ldID09PSBudWxsICkKCQkJCQl7CgkJCQkJCWFvQ29sdW1uc0luaXRbaV0gPSB7fTsKCQkJCQl9CgkJCQkJYW9Db2x1bW5zSW5pdFtpXS5iVmlzaWJsZSA9IG9Jbml0LnNhdmVkX2FvQ29sdW1uc1tpXS5iVmlzaWJsZTsKCQkJCX0KCQkJCQoJCQkJX2ZuQWRkQ29sdW1uKCBvU2V0dGluZ3MsIGFuVGhzID8gYW5UaHNbaV0gOiBudWxsICk7CgkJCX0KCQkJCgkJCS8qIEFwcGx5IHRoZSBjb2x1bW4gZGVmaW5pdGlvbnMgKi8KCQkJX2ZuQXBwbHlDb2x1bW5EZWZzKCBvU2V0dGluZ3MsIG9Jbml0LmFvQ29sdW1uRGVmcywgYW9Db2x1bW5zSW5pdCwgZnVuY3Rpb24gKGlDb2wsIG9EZWYpIHsKCQkJCV9mbkNvbHVtbk9wdGlvbnMoIG9TZXR0aW5ncywgaUNvbCwgb0RlZiApOwoJCQl9ICk7CgkJCQoJCQkKCQkJLyoKCQkJICogU29ydGluZwoJCQkgKiBDaGVjayB0aGUgYWFTb3J0aW5nIGFycmF5CgkJCSAqLwoJCQlmb3IgKCBpPTAsIGlMZW49b1NldHRpbmdzLmFhU29ydGluZy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlpZiAoIG9TZXR0aW5ncy5hYVNvcnRpbmdbaV1bMF0gPj0gb1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggKQoJCQkJewoJCQkJCW9TZXR0aW5ncy5hYVNvcnRpbmdbaV1bMF0gPSAwOwoJCQkJfQoJCQkJdmFyIG9Db2x1bW4gPSBvU2V0dGluZ3MuYW9Db2x1bW5zWyBvU2V0dGluZ3MuYWFTb3J0aW5nW2ldWzBdIF07CgkJCQkKCQkJCS8qIEFkZCBhIGRlZmF1bHQgc29ydGluZyBpbmRleCAqLwoJCQkJaWYgKCBvU2V0dGluZ3MuYWFTb3J0aW5nW2ldWzJdID09PSB1bmRlZmluZWQgKQoJCQkJewoJCQkJCW9TZXR0aW5ncy5hYVNvcnRpbmdbaV1bMl0gPSAwOwoJCQkJfQoJCQkJCgkJCQkvKiBJZiBhYVNvcnRpbmcgaXMgbm90IGRlZmluZWQsIHRoZW4gd2UgdXNlIHRoZSBmaXJzdCBpbmRpY2F0b3IgaW4gYXNTb3J0aW5nICovCgkJCQlpZiAoIG9Jbml0LmFhU29ydGluZyA9PT0gdW5kZWZpbmVkICYmIG9TZXR0aW5ncy5zYXZlZF9hYVNvcnRpbmcgPT09IHVuZGVmaW5lZCApCgkJCQl7CgkJCQkJb1NldHRpbmdzLmFhU29ydGluZ1tpXVsxXSA9IG9Db2x1bW4uYXNTb3J0aW5nWzBdOwoJCQkJfQoJCQkJCgkJCQkvKiBTZXQgdGhlIGN1cnJlbnQgc29ydGluZyBpbmRleCBiYXNlZCBvbiBhb0NvbHVtbnMuYXNTb3J0aW5nICovCgkJCQlmb3IgKCBqPTAsIGpMZW49b0NvbHVtbi5hc1NvcnRpbmcubGVuZ3RoIDsgajxqTGVuIDsgaisrICkKCQkJCXsKCQkJCQlpZiAoIG9TZXR0aW5ncy5hYVNvcnRpbmdbaV1bMV0gPT0gb0NvbHVtbi5hc1NvcnRpbmdbal0gKQoJCQkJCXsKCQkJCQkJb1NldHRpbmdzLmFhU29ydGluZ1tpXVsyXSA9IGo7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCQkJCX0KCQkJfQoJCQkJCgkJCS8qIERvIGEgZmlyc3QgcGFzcyBvbiB0aGUgc29ydGluZyBjbGFzc2VzIChhbGxvd3MgYW55IHNpemUgY2hhbmdlcyB0byBiZSB0YWtlbiBpbnRvCgkJCSAqIGFjY291bnQsIGFuZCBhbHNvIHdpbGwgYXBwbHkgc29ydGluZyBkaXNhYmxlZCBjbGFzc2VzIGlmIGRpc2FibGVkCgkJCSAqLwoJCQlfZm5Tb3J0aW5nQ2xhc3Nlcyggb1NldHRpbmdzICk7CgkJCQoJCQkKCQkJLyoKCQkJICogRmluYWwgaW5pdAoJCQkgKiBDYWNoZSB0aGUgaGVhZGVyLCBib2R5IGFuZCBmb290ZXIgYXMgcmVxdWlyZWQsIGNyZWF0aW5nIHRoZW0gaWYgbmVlZGVkCgkJCSAqLwoJCQkKCQkJLy8gV29yayBhcm91bmQgZm9yIFdlYmtpdCBidWcgODM4NjcgLSBzdG9yZSB0aGUgY2FwdGlvbi1zaWRlIGJlZm9yZSByZW1vdmluZyBmcm9tIGRvYwoJCQl2YXIgY2FwdGlvbnMgPSAkKHRoaXMpLmNoaWxkcmVuKCdjYXB0aW9uJykuZWFjaCggZnVuY3Rpb24gKCkgewoJCQkJdGhpcy5fY2FwdGlvblNpZGUgPSAkKHRoaXMpLmNzcygnY2FwdGlvbi1zaWRlJyk7CgkJCX0gKTsKCQkJCgkJCXZhciB0aGVhZCA9ICQodGhpcykuY2hpbGRyZW4oJ3RoZWFkJyk7CgkJCWlmICggdGhlYWQubGVuZ3RoID09PSAwICkKCQkJewoJCQkJdGhlYWQgPSBbIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICd0aGVhZCcgKSBdOwoJCQkJdGhpcy5hcHBlbmRDaGlsZCggdGhlYWRbMF0gKTsKCQkJfQoJCQlvU2V0dGluZ3MublRIZWFkID0gdGhlYWRbMF07CgkJCQoJCQl2YXIgdGJvZHkgPSAkKHRoaXMpLmNoaWxkcmVuKCd0Ym9keScpOwoJCQlpZiAoIHRib2R5Lmxlbmd0aCA9PT0gMCApCgkJCXsKCQkJCXRib2R5ID0gWyBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAndGJvZHknICkgXTsKCQkJCXRoaXMuYXBwZW5kQ2hpbGQoIHRib2R5WzBdICk7CgkJCX0KCQkJb1NldHRpbmdzLm5UQm9keSA9IHRib2R5WzBdOwoJCQlvU2V0dGluZ3MublRCb2R5LnNldEF0dHJpYnV0ZSggInJvbGUiLCAiYWxlcnQiICk7CgkJCW9TZXR0aW5ncy5uVEJvZHkuc2V0QXR0cmlidXRlKCAiYXJpYS1saXZlIiwgInBvbGl0ZSIgKTsKCQkJb1NldHRpbmdzLm5UQm9keS5zZXRBdHRyaWJ1dGUoICJhcmlhLXJlbGV2YW50IiwgImFsbCIgKTsKCQkJCgkJCXZhciB0Zm9vdCA9ICQodGhpcykuY2hpbGRyZW4oJ3Rmb290Jyk7CgkJCWlmICggdGZvb3QubGVuZ3RoID09PSAwICYmIGNhcHRpb25zLmxlbmd0aCA+IDAgJiYgKG9TZXR0aW5ncy5vU2Nyb2xsLnNYICE9PSAiIiB8fCBvU2V0dGluZ3Mub1Njcm9sbC5zWSAhPT0gIiIpICkKCQkJewoJCQkJLy8gSWYgd2UgYXJlIGEgc2Nyb2xsaW5nIHRhYmxlLCBhbmQgbm8gZm9vdGVyIGhhcyBiZWVuIGdpdmVuLCB0aGVuIHdlIG5lZWQgdG8gY3JlYXRlCgkJCQkvLyBhIHRmb290IGVsZW1lbnQgZm9yIHRoZSBjYXB0aW9uIGVsZW1lbnQgdG8gYmUgYXBwZW5kZWQgdG8KCQkJCXRmb290ID0gWyBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAndGZvb3QnICkgXTsKCQkJCXRoaXMuYXBwZW5kQ2hpbGQoIHRmb290WzBdICk7CgkJCX0KCQkJCgkJCWlmICggdGZvb3QubGVuZ3RoID4gMCApCgkJCXsKCQkJCW9TZXR0aW5ncy5uVEZvb3QgPSB0Zm9vdFswXTsKCQkJCV9mbkRldGVjdEhlYWRlciggb1NldHRpbmdzLmFvRm9vdGVyLCBvU2V0dGluZ3MublRGb290ICk7CgkJCX0KCQkJCgkJCS8qIENoZWNrIGlmIHRoZXJlIGlzIGRhdGEgcGFzc2luZyBpbnRvIHRoZSBjb25zdHJ1Y3RvciAqLwoJCQlpZiAoIGJVc2VQYXNzZWREYXRhICkKCQkJewoJCQkJZm9yICggaT0wIDsgaTxvSW5pdC5hYURhdGEubGVuZ3RoIDsgaSsrICkKCQkJCXsKCQkJCQlfZm5BZGREYXRhKCBvU2V0dGluZ3MsIG9Jbml0LmFhRGF0YVsgaSBdICk7CgkJCQl9CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQkvKiBHcmFiIHRoZSBkYXRhIGZyb20gdGhlIHBhZ2UgKi8KCQkJCV9mbkdhdGhlckRhdGEoIG9TZXR0aW5ncyApOwoJCQl9CgkJCQoJCQkvKiBDb3B5IHRoZSBkYXRhIGluZGV4IGFycmF5ICovCgkJCW9TZXR0aW5ncy5haURpc3BsYXkgPSBvU2V0dGluZ3MuYWlEaXNwbGF5TWFzdGVyLnNsaWNlKCk7CgkJCQoJCQkvKiBJbml0aWFsaXNhdGlvbiBjb21wbGV0ZSAtIHRhYmxlIGNhbiBiZSBkcmF3biAqLwoJCQlvU2V0dGluZ3MuYkluaXRpYWxpc2VkID0gdHJ1ZTsKCQkJCgkJCS8qIENoZWNrIGlmIHdlIG5lZWQgdG8gaW5pdGlhbGlzZSB0aGUgdGFibGUgKGl0IG1pZ2h0IG5vdCBoYXZlIGJlZW4gaGFuZGVkIG9mZiB0byB0aGUKCQkJICogbGFuZ3VhZ2UgcHJvY2Vzc29yKQoJCQkgKi8KCQkJaWYgKCBiSW5pdEhhbmRlZE9mZiA9PT0gZmFsc2UgKQoJCQl7CgkJCQlfZm5Jbml0aWFsaXNlKCBvU2V0dGluZ3MgKTsKCQkJfQoJCX0gKTsKCX07CgoJCgkKCS8qKgoJICogUHJvdmlkZSBhIGNvbW1vbiBtZXRob2QgZm9yIHBsdWctaW5zIHRvIGNoZWNrIHRoZSB2ZXJzaW9uIG9mIERhdGFUYWJsZXMgYmVpbmcgdXNlZCwgaW4gb3JkZXIKCSAqIHRvIGVuc3VyZSBjb21wYXRpYmlsaXR5LgoJICogIEBwYXJhbSB7c3RyaW5nfSBzVmVyc2lvbiBWZXJzaW9uIHN0cmluZyB0byBjaGVjayBmb3IsIGluIHRoZSBmb3JtYXQgIlguWS5aIi4gTm90ZSB0aGF0IHRoZQoJICogICAgZm9ybWF0cyAiWCIgYW5kICJYLlkiIGFyZSBhbHNvIGFjY2VwdGFibGUuCgkgKiAgQHJldHVybnMge2Jvb2xlYW59IHRydWUgaWYgdGhpcyB2ZXJzaW9uIG9mIERhdGFUYWJsZXMgaXMgZ3JlYXRlciBvciBlcXVhbCB0byB0aGUgcmVxdWlyZWQKCSAqICAgIHZlcnNpb24sIG9yIGZhbHNlIGlmIHRoaXMgdmVyc2lvbiBvZiBEYXRhVGFsZXMgaXMgbm90IHN1aXRhYmxlCgkgKiAgQHN0YXRpYwoJICogIEBkdG9wdCBBUEktU3RhdGljCgkgKgoJICogIEBleGFtcGxlCgkgKiAgICBhbGVydCggJC5mbi5kYXRhVGFibGUuZm5WZXJzaW9uQ2hlY2soICcxLjkuMCcgKSApOwoJICovCglEYXRhVGFibGUuZm5WZXJzaW9uQ2hlY2sgPSBmdW5jdGlvbiggc1ZlcnNpb24gKQoJewoJCS8qIFRoaXMgaXMgY2hlYXAsIGJ1dCBlZmZlY3RpdmUgKi8KCQl2YXIgZm5aUGFkID0gZnVuY3Rpb24gKFpwYWQsIGNvdW50KQoJCXsKCQkJd2hpbGUoWnBhZC5sZW5ndGggPCBjb3VudCkgewoJCQkJWnBhZCArPSAnMCc7CgkJCX0KCQkJcmV0dXJuIFpwYWQ7CgkJfTsKCQl2YXIgYVRoaXMgPSBEYXRhVGFibGUuZXh0LnNWZXJzaW9uLnNwbGl0KCcuJyk7CgkJdmFyIGFUaGF0ID0gc1ZlcnNpb24uc3BsaXQoJy4nKTsKCQl2YXIgc1RoaXMgPSAnJywgc1RoYXQgPSAnJzsKCQkKCQlmb3IgKCB2YXIgaT0wLCBpTGVuPWFUaGF0Lmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJewoJCQlzVGhpcyArPSBmblpQYWQoIGFUaGlzW2ldLCAzICk7CgkJCXNUaGF0ICs9IGZuWlBhZCggYVRoYXRbaV0sIDMgKTsKCQl9CgkJCgkJcmV0dXJuIHBhcnNlSW50KHNUaGlzLCAxMCkgPj0gcGFyc2VJbnQoc1RoYXQsIDEwKTsKCX07CgkKCQoJLyoqCgkgKiBDaGVjayBpZiBhIFRBQkxFIG5vZGUgaXMgYSBEYXRhVGFibGUgdGFibGUgYWxyZWFkeSBvciBub3QuCgkgKiAgQHBhcmFtIHtub2RlfSBuVGFibGUgVGhlIFRBQkxFIG5vZGUgdG8gY2hlY2sgaWYgaXQgaXMgYSBEYXRhVGFibGUgb3Igbm90IChub3RlIHRoYXQgb3RoZXIKCSAqICAgIG5vZGUgdHlwZXMgY2FuIGJlIHBhc3NlZCBpbiwgYnV0IHdpbGwgYWx3YXlzIHJldHVybiBmYWxzZSkuCgkgKiAgQHJldHVybnMge2Jvb2xlYW59IHRydWUgdGhlIHRhYmxlIGdpdmVuIGlzIGEgRGF0YVRhYmxlLCBvciBmYWxzZSBvdGhlcndpc2UKCSAqICBAc3RhdGljCgkgKiAgQGR0b3B0IEFQSS1TdGF0aWMKCSAqCgkgKiAgQGV4YW1wbGUKCSAqICAgIHZhciBleCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdleGFtcGxlJyk7CgkgKiAgICBpZiAoICEgJC5mbi5EYXRhVGFibGUuZm5Jc0RhdGFUYWJsZSggZXggKSApIHsKCSAqICAgICAgJChleCkuZGF0YVRhYmxlKCk7CgkgKiAgICB9CgkgKi8KCURhdGFUYWJsZS5mbklzRGF0YVRhYmxlID0gZnVuY3Rpb24gKCBuVGFibGUgKQoJewoJCXZhciBvID0gRGF0YVRhYmxlLnNldHRpbmdzOwoJCgkJZm9yICggdmFyIGk9MCA7IGk8by5sZW5ndGggOyBpKysgKQoJCXsKCQkJaWYgKCBvW2ldLm5UYWJsZSA9PT0gblRhYmxlIHx8IG9baV0ublNjcm9sbEhlYWQgPT09IG5UYWJsZSB8fCBvW2ldLm5TY3JvbGxGb290ID09PSBuVGFibGUgKQoJCQl7CgkJCQlyZXR1cm4gdHJ1ZTsKCQkJfQoJCX0KCQoJCXJldHVybiBmYWxzZTsKCX07CgkKCQoJLyoqCgkgKiBHZXQgYWxsIERhdGFUYWJsZSB0YWJsZXMgdGhhdCBoYXZlIGJlZW4gaW5pdGlhbGlzZWQgLSBvcHRpb25hbGx5IHlvdSBjYW4gc2VsZWN0IHRvCgkgKiBnZXQgb25seSBjdXJyZW50bHkgdmlzaWJsZSB0YWJsZXMuCgkgKiAgQHBhcmFtIHtib29sZWFufSBbYlZpc2libGU9ZmFsc2VdIEZsYWcgdG8gaW5kaWNhdGUgaWYgeW91IHdhbnQgYWxsIChkZWZhdWx0KSBvciAKCSAqICAgIHZpc2libGUgdGFibGVzIG9ubHkuCgkgKiAgQHJldHVybnMge2FycmF5fSBBcnJheSBvZiBUQUJMRSBub2RlcyAobm90IERhdGFUYWJsZSBpbnN0YW5jZXMpIHdoaWNoIGFyZSBEYXRhVGFibGVzCgkgKiAgQHN0YXRpYwoJICogIEBkdG9wdCBBUEktU3RhdGljCgkgKgoJICogIEBleGFtcGxlCgkgKiAgICB2YXIgdGFibGUgPSAkLmZuLmRhdGFUYWJsZS5mblRhYmxlcyh0cnVlKTsKCSAqICAgIGlmICggdGFibGUubGVuZ3RoID4gMCApIHsKCSAqICAgICAgJCh0YWJsZSkuZGF0YVRhYmxlKCkuZm5BZGp1c3RDb2x1bW5TaXppbmcoKTsKCSAqICAgIH0KCSAqLwoJRGF0YVRhYmxlLmZuVGFibGVzID0gZnVuY3Rpb24gKCBiVmlzaWJsZSApCgl7CgkJdmFyIG91dCA9IFtdOwoJCgkJalF1ZXJ5LmVhY2goIERhdGFUYWJsZS5zZXR0aW5ncywgZnVuY3Rpb24gKGksIG8pIHsKCQkJaWYgKCAhYlZpc2libGUgfHwgKGJWaXNpYmxlID09PSB0cnVlICYmICQoby5uVGFibGUpLmlzKCc6dmlzaWJsZScpKSApCgkJCXsKCQkJCW91dC5wdXNoKCBvLm5UYWJsZSApOwoJCQl9CgkJfSApOwoJCgkJcmV0dXJuIG91dDsKCX07CgkKCgkvKioKCSAqIFZlcnNpb24gc3RyaW5nIGZvciBwbHVnLWlucyB0byBjaGVjayBjb21wYXRpYmlsaXR5LiBBbGxvd2VkIGZvcm1hdCBpcwoJICogYS5iLmMuZC5lIHdoZXJlOiBhOmludCwgYjppbnQsIGM6aW50LCBkOnN0cmluZyhkZXZ8YmV0YSksIGU6aW50LiBkIGFuZAoJICogZSBhcmUgb3B0aW9uYWwKCSAqICBAbWVtYmVyCgkgKiAgQHR5cGUgc3RyaW5nCgkgKiAgQGRlZmF1bHQgVmVyc2lvbiBudW1iZXIKCSAqLwoJRGF0YVRhYmxlLnZlcnNpb24gPSAiMS45LjIiOwoKCS8qKgoJICogUHJpdmF0ZSBkYXRhIHN0b3JlLCBjb250YWluaW5nIGFsbCBvZiB0aGUgc2V0dGluZ3Mgb2JqZWN0cyB0aGF0IGFyZSBjcmVhdGVkIGZvciB0aGUKCSAqIHRhYmxlcyBvbiBhIGdpdmVuIHBhZ2UuCgkgKiAKCSAqIE5vdGUgdGhhdCB0aGUgPGk+RGF0YVRhYmxlLnNldHRpbmdzPC9pPiBvYmplY3QgaXMgYWxpYXNlZCB0byA8aT5qUXVlcnkuZm4uZGF0YVRhYmxlRXh0PC9pPiAKCSAqIHRocm91Z2ggd2hpY2ggaXQgbWF5IGJlIGFjY2Vzc2VkIGFuZCBtYW5pcHVsYXRlZCwgb3IgPGk+alF1ZXJ5LmZuLmRhdGFUYWJsZS5zZXR0aW5nczwvaT4uCgkgKiAgQG1lbWJlcgoJICogIEB0eXBlIGFycmF5CgkgKiAgQGRlZmF1bHQgW10KCSAqICBAcHJpdmF0ZQoJICovCglEYXRhVGFibGUuc2V0dGluZ3MgPSBbXTsKCgkvKioKCSAqIE9iamVjdCBtb2RlbHMgY29udGFpbmVyLCBmb3IgdGhlIHZhcmlvdXMgbW9kZWxzIHRoYXQgRGF0YVRhYmxlcyBoYXMgYXZhaWxhYmxlCgkgKiB0byBpdC4gVGhlc2UgbW9kZWxzIGRlZmluZSB0aGUgb2JqZWN0cyB0aGF0IGFyZSB1c2VkIHRvIGhvbGQgdGhlIGFjdGl2ZSBzdGF0ZSAKCSAqIGFuZCBjb25maWd1cmF0aW9uIG9mIHRoZSB0YWJsZS4KCSAqICBAbmFtZXNwYWNlCgkgKi8KCURhdGFUYWJsZS5tb2RlbHMgPSB7fTsKCQoJCgkvKioKCSAqIERhdGFUYWJsZXMgZXh0ZW5zaW9uIG9wdGlvbnMgYW5kIHBsdWctaW5zLiBUaGlzIG5hbWVzcGFjZSBhY3RzIGFzIGEgY29sbGVjdGlvbiAiYXJlYSIKCSAqIGZvciBwbHVnLWlucyB0aGF0IGNhbiBiZSB1c2VkIHRvIGV4dGVuZCB0aGUgZGVmYXVsdCBEYXRhVGFibGVzIGJlaGF2aW91ciAtIGluZGVlZCBtYW55CgkgKiBvZiB0aGUgYnVpbGQgaW4gbWV0aG9kcyB1c2UgdGhpcyBtZXRob2QgdG8gcHJvdmlkZSB0aGVpciBvd24gY2FwYWJpbGl0aWVzIChzb3J0aW5nIG1ldGhvZHMKCSAqIGZvciBleGFtcGxlKS4KCSAqIAoJICogTm90ZSB0aGF0IHRoaXMgbmFtZXNwYWNlIGlzIGFsaWFzZWQgdG8galF1ZXJ5LmZuLmRhdGFUYWJsZUV4dCBzbyBpdCBjYW4gYmUgcmVhZGlseSBhY2Nlc3NlZAoJICogYW5kIG1vZGlmaWVkIGJ5IHBsdWctaW5zLgoJICogIEBuYW1lc3BhY2UKCSAqLwoJRGF0YVRhYmxlLm1vZGVscy5leHQgPSB7CgkJLyoqCgkJICogUGx1Zy1pbiBmaWx0ZXJpbmcgZnVuY3Rpb25zIC0gdGhpcyBtZXRob2Qgb2YgZmlsdGVyaW5nIGlzIGNvbXBsaW1lbnRhcnkgdG8gdGhlIGRlZmF1bHQKCQkgKiB0eXBlIGJhc2VkIGZpbHRlcmluZywgYW5kIGEgbG90IG1vcmUgY29tcHJlaGVuc2l2ZSBhcyBpdCBhbGxvd3MgeW91IGNvbXBsZXRlIGNvbnRyb2wKCQkgKiBvdmVyIHRoZSBmaWx0ZXJpbmcgbG9naWMuIEVhY2ggZWxlbWVudCBpbiB0aGlzIGFycmF5IGlzIGEgZnVuY3Rpb24gKHBhcmFtZXRlcnMKCQkgKiBkZXNjcmliZWQgYmVsb3cpIHRoYXQgaXMgY2FsbGVkIGZvciBldmVyeSByb3cgaW4gdGhlIHRhYmxlLCBhbmQgeW91ciBsb2dpYyBkZWNpZGVzIGlmCgkJICogaXQgc2hvdWxkIGJlIGluY2x1ZGVkIGluIHRoZSBmaWx0ZXJlZCBkYXRhIHNldCBvciBub3QuCgkJICogICA8dWw+CgkJICogICAgIDxsaT4KCQkgKiAgICAgICBGdW5jdGlvbiBpbnB1dCBwYXJhbWV0ZXJzOgoJCSAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT57b2JqZWN0fSBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdDogc2VlIHtAbGluayBEYXRhVGFibGUubW9kZWxzLm9TZXR0aW5nc30uPC9saT4KCQkgKiAgICAgICAgIDxsaT57YXJyYXl8b2JqZWN0fSBEYXRhIGZvciB0aGUgcm93IHRvIGJlIHByb2Nlc3NlZCAoc2FtZSBhcyB0aGUgb3JpZ2luYWwgZm9ybWF0CgkJICogICAgICAgICAgIHRoYXQgd2FzIHBhc3NlZCBpbiBhcyB0aGUgZGF0YSBzb3VyY2UsIG9yIGFuIGFycmF5IGZyb20gYSBET00gZGF0YSBzb3VyY2U8L2xpPgoJCSAqICAgICAgICAgPGxpPntpbnR9IFJvdyBpbmRleCBpbiBhb0RhdGEgKHtAbGluayBEYXRhVGFibGUubW9kZWxzLm9TZXR0aW5ncy5hb0RhdGF9KSwgd2hpY2ggY2FuCgkJICogICAgICAgICAgIGJlIHVzZWZ1bCB0byByZXRyaWV2ZSB0aGUgVFIgZWxlbWVudCBpZiB5b3UgbmVlZCBET00gaW50ZXJhY3Rpb24uPC9saT4KCQkgKiAgICAgICA8L3VsPgoJCSAqICAgICA8L2xpPgoJCSAqICAgICA8bGk+CgkJICogICAgICAgRnVuY3Rpb24gcmV0dXJuOgoJCSAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT57Ym9vbGVhbn0gSW5jbHVkZSB0aGUgcm93IGluIHRoZSBmaWx0ZXJlZCByZXN1bHQgc2V0ICh0cnVlKSBvciBub3QgKGZhbHNlKTwvbGk+CgkJICogICAgICAgPC91bD4KCQkgKiAgICAgPC9pbD4KCQkgKiAgIDwvdWw+CgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBUaGUgZm9sbG93aW5nIGV4YW1wbGUgc2hvd3MgY3VzdG9tIGZpbHRlcmluZyBiZWluZyBhcHBsaWVkIHRvIHRoZSBmb3VydGggY29sdW1uIChpLmUuCgkJICogICAgLy8gdGhlIGFEYXRhWzNdIGluZGV4KSBiYXNlZCBvbiB0d28gaW5wdXQgdmFsdWVzIGZyb20gdGhlIGVuZC11c2VyLCBtYXRjaGluZyB0aGUgZGF0YSBpbiAKCQkgKiAgICAvLyBhIGNlcnRhaW4gcmFuZ2UuCgkJICogICAgJC5mbi5kYXRhVGFibGVFeHQuYWZuRmlsdGVyaW5nLnB1c2goCgkJICogICAgICBmdW5jdGlvbiggb1NldHRpbmdzLCBhRGF0YSwgaURhdGFJbmRleCApIHsKCQkgKiAgICAgICAgdmFyIGlNaW4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWluJykudmFsdWUgKiAxOwoJCSAqICAgICAgICB2YXIgaU1heCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXgnKS52YWx1ZSAqIDE7CgkJICogICAgICAgIHZhciBpVmVyc2lvbiA9IGFEYXRhWzNdID09ICItIiA/IDAgOiBhRGF0YVszXSoxOwoJCSAqICAgICAgICBpZiAoIGlNaW4gPT0gIiIgJiYgaU1heCA9PSAiIiApIHsKCQkgKiAgICAgICAgICByZXR1cm4gdHJ1ZTsKCQkgKiAgICAgICAgfQoJCSAqICAgICAgICBlbHNlIGlmICggaU1pbiA9PSAiIiAmJiBpVmVyc2lvbiA8IGlNYXggKSB7CgkJICogICAgICAgICAgcmV0dXJuIHRydWU7CgkJICogICAgICAgIH0KCQkgKiAgICAgICAgZWxzZSBpZiAoIGlNaW4gPCBpVmVyc2lvbiAmJiAiIiA9PSBpTWF4ICkgewoJCSAqICAgICAgICAgIHJldHVybiB0cnVlOwoJCSAqICAgICAgICB9CgkJICogICAgICAgIGVsc2UgaWYgKCBpTWluIDwgaVZlcnNpb24gJiYgaVZlcnNpb24gPCBpTWF4ICkgewoJCSAqICAgICAgICAgIHJldHVybiB0cnVlOwoJCSAqICAgICAgICB9CgkJICogICAgICAgIHJldHVybiBmYWxzZTsKCQkgKiAgICAgIH0KCQkgKiAgICApOwoJCSAqLwoJCSJhZm5GaWx0ZXJpbmciOiBbXSwKCQoJCgkJLyoqCgkJICogUGx1Zy1pbiBzb3J0aW5nIGZ1bmN0aW9ucyAtIHRoaXMgbWV0aG9kIG9mIHNvcnRpbmcgaXMgY29tcGxpbWVudGFyeSB0byB0aGUgZGVmYXVsdCB0eXBlCgkJICogYmFzZWQgc29ydGluZyB0aGF0IERhdGFUYWJsZXMgZG9lcyBhdXRvbWF0aWNhbGx5LCBhbGxvd2luZyBtdWNoIGdyZWF0ZXIgY29udHJvbCBvdmVyIHRoZQoJCSAqIHRoZSBkYXRhIHRoYXQgaXMgYmVpbmcgdXNlZCB0byBzb3J0IGEgY29sdW1uLiBUaGlzIGlzIHVzZWZ1bCBpZiB5b3Ugd2FudCB0byBkbyBzb3J0aW5nCgkJICogYmFzZWQgb24gbGl2ZSBkYXRhIChmb3IgZXhhbXBsZSB0aGUgY29udGVudHMgb2YgYW4gJ2lucHV0JyBlbGVtZW50KSByYXRoZXIgdGhhbiBqdXN0IHRoZQoJCSAqIHN0YXRpYyBzdHJpbmcgdGhhdCBEYXRhVGFibGVzIGtub3dzIG9mLiBUaGUgd2F5IHRoZXNlIHBsdWctaW5zIHdvcmsgaXMgdGhhdCB5b3UgY3JlYXRlCgkJICogYW4gYXJyYXkgb2YgdGhlIHZhbHVlcyB5b3Ugd2lzaCB0byBiZSBzb3J0ZWQgZm9yIHRoZSBjb2x1bW4gaW4gcXVlc3Rpb24gYW5kIHRoZW4gcmV0dXJuCgkJICogdGhhdCBhcnJheS4gV2hpY2ggcHJlLXNvcnRpbmcgZnVuY3Rpb24gaXMgcnVuIGhlcmUgZGVwZW5kcyBvbiB0aGUgc1NvcnREYXRhVHlwZSBwYXJhbWV0ZXIKCQkgKiB0aGF0IGlzIHVzZWQgZm9yIHRoZSBjb2x1bW4gKGlmIGFueSkuIFRoaXMgaXMgdGhlIGNvcm9sbGFyeSBvZiA8aT5vZm5TZWFyY2g8L2k+IGZvciBzb3J0IAoJCSAqIGRhdGEuCgkJICogICA8dWw+CgkgICAgICogICAgIDxsaT4KCSAgICAgKiAgICAgICBGdW5jdGlvbiBpbnB1dCBwYXJhbWV0ZXJzOgoJICAgICAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT57b2JqZWN0fSBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdDogc2VlIHtAbGluayBEYXRhVGFibGUubW9kZWxzLm9TZXR0aW5nc30uPC9saT4KCSAgICAgKiAgICAgICAgIDxsaT57aW50fSBUYXJnZXQgY29sdW1uIGluZGV4PC9saT4KCSAgICAgKiAgICAgICA8L3VsPgoJICAgICAqICAgICA8L2xpPgoJCSAqICAgICA8bGk+CgkJICogICAgICAgRnVuY3Rpb24gcmV0dXJuOgoJCSAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT57YXJyYXl9IERhdGEgZm9yIHRoZSBjb2x1bW4gdG8gYmUgc29ydGVkIHVwb248L2xpPgoJCSAqICAgICAgIDwvdWw+CgkJICogICAgIDwvaWw+CgkJICogICA8L3VsPgoJCSAqICAKCQkgKiBOb3RlIHRoYXQgYXMgb2YgdjEuOSwgaXQgaXMgdHlwaWNhbGx5IHByZWZlcmFibGUgdG8gdXNlIDxpPm1EYXRhUHJvcDwvaT4gdG8gcHJlcGFyZSBkYXRhIGZvcgoJCSAqIHRoZSBkaWZmZXJlbnQgdXNlcyB0aGF0IERhdGFUYWJsZXMgY2FuIHB1dCB0aGUgZGF0YSB0by4gU3BlY2lmaWNhbGx5IDxpPm1EYXRhUHJvcDwvaT4gd2hlbgoJCSAqIHVzZWQgYXMgYSBmdW5jdGlvbiB3aWxsIGdpdmUgeW91IGEgJ3R5cGUnIChzb3J0aW5nLCBmaWx0ZXJpbmcgZXRjKSB0aGF0IHlvdSBjYW4gdXNlIHRvIAoJCSAqIHByZXBhcmUgdGhlIGRhdGEgYXMgcmVxdWlyZWQgZm9yIHRoZSBkaWZmZXJlbnQgdHlwZXMuIEFzIHN1Y2gsIHRoaXMgbWV0aG9kIGlzIGRlcHJlY2F0ZWQuCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICogIEBkZXByZWNhdGVkCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVcGRhdGluZyB0aGUgY2FjaGVkIHNvcnRpbmcgaW5mb3JtYXRpb24gd2l0aCB1c2VyIGVudGVyZWQgdmFsdWVzIGluIEhUTUwgaW5wdXQgZWxlbWVudHMKCQkgKiAgICBqUXVlcnkuZm4uZGF0YVRhYmxlRXh0LmFmblNvcnREYXRhWydkb20tdGV4dCddID0gZnVuY3Rpb24gKCBvU2V0dGluZ3MsIGlDb2x1bW4gKQoJCSAqICAgIHsKCQkgKiAgICAgIHZhciBhRGF0YSA9IFtdOwoJCSAqICAgICAgJCggJ3RkOmVxKCcraUNvbHVtbisnKSBpbnB1dCcsIG9TZXR0aW5ncy5vQXBpLl9mbkdldFRyTm9kZXMob1NldHRpbmdzKSApLmVhY2goIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICAgYURhdGEucHVzaCggdGhpcy52YWx1ZSApOwoJCSAqICAgICAgfSApOwoJCSAqICAgICAgcmV0dXJuIGFEYXRhOwoJCSAqICAgIH0KCQkgKi8KCQkiYWZuU29ydERhdGEiOiBbXSwKCQoJCgkJLyoqCgkJICogRmVhdHVyZSBwbHVnLWlucyAtIFRoaXMgaXMgYW4gYXJyYXkgb2Ygb2JqZWN0cyB3aGljaCBkZXNjcmliZSB0aGUgZmVhdHVyZSBwbHVnLWlucyB0aGF0IGFyZQoJCSAqIGF2YWlsYWJsZSB0byBEYXRhVGFibGVzLiBUaGVzZSBmZWF0dXJlIHBsdWctaW5zIGFyZSBhY2Nlc3NpYmxlIHRocm91Z2ggdGhlIHNEb20gaW5pdGlhbGlzYXRpb24KCQkgKiBvcHRpb24uIEFzIHN1Y2gsIGVhY2ggZmVhdHVyZSBwbHVnLWluIG11c3QgZGVzY3JpYmUgYSBmdW5jdGlvbiB0aGF0IGlzIHVzZWQgdG8gaW5pdGlhbGlzZQoJCSAqIGl0c2VsZiAoZm5Jbml0KSwgYSBjaGFyYWN0ZXIgc28gdGhlIGZlYXR1cmUgY2FuIGJlIGVuYWJsZWQgYnkgc0RvbSAoY0ZlYXR1cmUpIGFuZCB0aGUgbmFtZQoJCSAqIG9mIHRoZSBmZWF0dXJlIChzRmVhdHVyZSkuIFRodXMgdGhlIG9iamVjdHMgYXR0YWNoZWQgdG8gdGhpcyBtZXRob2QgbXVzdCBwcm92aWRlOgoJCSAqICAgPHVsPgoJCSAqICAgICA8bGk+e2Z1bmN0aW9ufSBmbkluaXQgSW5pdGlhbGlzYXRpb24gb2YgdGhlIHBsdWctaW4KCQkgKiAgICAgICA8dWw+CgkgICAgICogICAgICAgICA8bGk+CgkgICAgICogICAgICAgICAgIEZ1bmN0aW9uIGlucHV0IHBhcmFtZXRlcnM6CgkgICAgICogICAgICAgICAgIDx1bD4KCQkgKiAgICAgICAgICAgICA8bGk+e29iamVjdH0gRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3Q6IHNlZSB7QGxpbmsgRGF0YVRhYmxlLm1vZGVscy5vU2V0dGluZ3N9LjwvbGk+CgkgICAgICogICAgICAgICAgIDwvdWw+CgkgICAgICogICAgICAgICA8L2xpPgoJCSAqICAgICAgICAgPGxpPgoJCSAqICAgICAgICAgICBGdW5jdGlvbiByZXR1cm46CgkJICogICAgICAgICAgIDx1bD4KCQkgKiAgICAgICAgICAgICA8bGk+e25vZGV8bnVsbH0gVGhlIGVsZW1lbnQgd2hpY2ggY29udGFpbnMgeW91ciBmZWF0dXJlLiBOb3RlIHRoYXQgdGhlIHJldHVybgoJCSAqICAgICAgICAgICAgICAgIG1heSBhbHNvIGJlIHZvaWQgaWYgeW91ciBwbHVnLWluIGRvZXMgbm90IHJlcXVpcmUgdG8gaW5qZWN0IGFueSBET00gZWxlbWVudHMgCgkJICogICAgICAgICAgICAgICAgaW50byBEYXRhVGFibGVzIGNvbnRyb2wgKHNEb20pIC0gZm9yIGV4YW1wbGUgdGhpcyBtaWdodCBiZSB1c2VmdWwgd2hlbiAKCQkgKiAgICAgICAgICAgICAgICBkZXZlbG9waW5nIGEgcGx1Zy1pbiB3aGljaCBhbGxvd3MgdGFibGUgY29udHJvbCB2aWEga2V5Ym9hcmQgZW50cnkuPC9saT4KCQkgKiAgICAgICAgICAgPC91bD4KCQkgKiAgICAgICAgIDwvaWw+CgkJICogICAgICAgPC91bD4KCQkgKiAgICAgPC9saT4KCQkgKiAgICAgPGxpPntjaGFyYWN0ZXJ9IGNGZWF0dXJlIENoYXJhY3RlciB0aGF0IHdpbGwgYmUgbWF0Y2hlZCBpbiBzRG9tIC0gY2FzZSBzZW5zaXRpdmU8L2xpPgoJCSAqICAgICA8bGk+e3N0cmluZ30gc0ZlYXR1cmUgRmVhdHVyZSBuYW1lPC9saT4KCQkgKiAgIDwvdWw+CgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gSG93IFRhYmxlVG9vbHMgaW5pdGlhbGlzZXMgaXRzZWxmLgoJCSAqICAgICQuZm4uZGF0YVRhYmxlRXh0LmFvRmVhdHVyZXMucHVzaCggewoJCSAqICAgICAgImZuSW5pdCI6IGZ1bmN0aW9uKCBvU2V0dGluZ3MgKSB7CgkJICogICAgICAgIHJldHVybiBuZXcgVGFibGVUb29scyggeyAib0RUU2V0dGluZ3MiOiBvU2V0dGluZ3MgfSApOwoJCSAqICAgICAgfSwKCQkgKiAgICAgICJjRmVhdHVyZSI6ICJUIiwKCQkgKiAgICAgICJzRmVhdHVyZSI6ICJUYWJsZVRvb2xzIgoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYW9GZWF0dXJlcyI6IFtdLAoJCgkKCQkvKioKCQkgKiBUeXBlIGRldGVjdGlvbiBwbHVnLWluIGZ1bmN0aW9ucyAtIERhdGFUYWJsZXMgdXRpbGlzZXMgdHlwZXMgdG8gZGVmaW5lIGhvdyBzb3J0aW5nIGFuZAoJCSAqIGZpbHRlcmluZyBiZWhhdmUsIGFuZCB0eXBlcyBjYW4gYmUgZWl0aGVyICBiZSBkZWZpbmVkIGJ5IHRoZSBkZXZlbG9wZXIgKHNUeXBlIGZvciB0aGUKCQkgKiBjb2x1bW4pIG9yIHRoZXkgY2FuIGJlIGF1dG9tYXRpY2FsbHkgZGV0ZWN0ZWQgYnkgdGhlIG1ldGhvZHMgaW4gdGhpcyBhcnJheS4gVGhlIGZ1bmN0aW9ucwoJCSAqIGRlZmluZWQgaW4gdGhlIGFycmF5IGFyZSBxdWl0ZSBzaW1wbGUsIHRha2luZyBhIHNpbmdsZSBwYXJhbWV0ZXIgKHRoZSBkYXRhIHRvIGFuYWx5c2UpIAoJCSAqIGFuZCByZXR1cm5pbmcgdGhlIHR5cGUgaWYgaXQgaXMgYSBrbm93biB0eXBlLCBvciBudWxsIG90aGVyd2lzZS4KCQkgKiAgIDx1bD4KCSAgICAgKiAgICAgPGxpPgoJICAgICAqICAgICAgIEZ1bmN0aW9uIGlucHV0IHBhcmFtZXRlcnM6CgkgICAgICogICAgICAgPHVsPgoJCSAqICAgICAgICAgPGxpPnsqfSBEYXRhIGZyb20gdGhlIGNvbHVtbiBjZWxsIHRvIGJlIGFuYWx5c2VkPC9saT4KCSAgICAgKiAgICAgICA8L3VsPgoJICAgICAqICAgICA8L2xpPgoJCSAqICAgICA8bGk+CgkJICogICAgICAgRnVuY3Rpb24gcmV0dXJuOgoJCSAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT57c3RyaW5nfG51bGx9IERhdGEgdHlwZSBkZXRlY3RlZCwgb3IgbnVsbCBpZiB1bmtub3duIChhbmQgdGh1cyBwYXNzIGl0CgkJICogICAgICAgICAgIG9uIHRvIHRoZSBvdGhlciB0eXBlIGRldGVjdGlvbiBmdW5jdGlvbnMuPC9saT4KCQkgKiAgICAgICA8L3VsPgoJCSAqICAgICA8L2lsPgoJCSAqICAgPC91bD4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKiAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gQ3VycmVuY3kgdHlwZSBkZXRlY3Rpb24gcGx1Zy1pbjoKCQkgKiAgICBqUXVlcnkuZm4uZGF0YVRhYmxlRXh0LmFUeXBlcy5wdXNoKAoJCSAqICAgICAgZnVuY3Rpb24gKCBzRGF0YSApIHsKCQkgKiAgICAgICAgdmFyIHNWYWxpZENoYXJzID0gIjAxMjM0NTY3ODkuLSI7CgkJICogICAgICAgIHZhciBDaGFyOwoJCSAqICAgICAgICAKCQkgKiAgICAgICAgLy8gQ2hlY2sgdGhlIG51bWVyaWMgcGFydAoJCSAqICAgICAgICBmb3IgKCBpPTEgOyBpPHNEYXRhLmxlbmd0aCA7IGkrKyApIHsKCQkgKiAgICAgICAgICBDaGFyID0gc0RhdGEuY2hhckF0KGkpOyAKCQkgKiAgICAgICAgICBpZiAoc1ZhbGlkQ2hhcnMuaW5kZXhPZihDaGFyKSA9PSAtMSkgewoJCSAqICAgICAgICAgICAgcmV0dXJuIG51bGw7CgkJICogICAgICAgICAgfQoJCSAqICAgICAgICB9CgkJICogICAgICAgIAoJCSAqICAgICAgICAvLyBDaGVjayBwcmVmaXhlZCBieSBjdXJyZW5jeQoJCSAqICAgICAgICBpZiAoIHNEYXRhLmNoYXJBdCgwKSA9PSAnJCcgfHwgc0RhdGEuY2hhckF0KDApID09ICcmcG91bmQ7JyApIHsKCQkgKiAgICAgICAgICByZXR1cm4gJ2N1cnJlbmN5JzsKCQkgKiAgICAgICAgfQoJCSAqICAgICAgICByZXR1cm4gbnVsbDsKCQkgKiAgICAgIH0KCQkgKiAgICApOwoJCSAqLwoJCSJhVHlwZXMiOiBbXSwKCQoJCgkJLyoqCgkJICogUHJvdmlkZSBhIGNvbW1vbiBtZXRob2QgZm9yIHBsdWctaW5zIHRvIGNoZWNrIHRoZSB2ZXJzaW9uIG9mIERhdGFUYWJsZXMgYmVpbmcgdXNlZCwgCgkJICogaW4gb3JkZXIgdG8gZW5zdXJlIGNvbXBhdGliaWxpdHkuCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzVmVyc2lvbiBWZXJzaW9uIHN0cmluZyB0byBjaGVjayBmb3IsIGluIHRoZSBmb3JtYXQgIlguWS5aIi4gTm90ZSAKCQkgKiAgICB0aGF0IHRoZSBmb3JtYXRzICJYIiBhbmQgIlguWSIgYXJlIGFsc28gYWNjZXB0YWJsZS4KCQkgKiAgQHJldHVybnMge2Jvb2xlYW59IHRydWUgaWYgdGhpcyB2ZXJzaW9uIG9mIERhdGFUYWJsZXMgaXMgZ3JlYXRlciBvciBlcXVhbCB0byB0aGUgCgkJICogICAgcmVxdWlyZWQgdmVyc2lvbiwgb3IgZmFsc2UgaWYgdGhpcyB2ZXJzaW9uIG9mIERhdGFUYWxlcyBpcyBub3Qgc3VpdGFibGUKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICogICAgICBhbGVydCggb1RhYmxlLmZuVmVyc2lvbkNoZWNrKCAnMS45LjAnICkgKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImZuVmVyc2lvbkNoZWNrIjogRGF0YVRhYmxlLmZuVmVyc2lvbkNoZWNrLAoJCgkKCQkvKioKCQkgKiBJbmRleCBmb3Igd2hhdCAndGhpcycgaW5kZXggQVBJIGZ1bmN0aW9ucyBzaG91bGQgdXNlCgkJICogIEB0eXBlIGludAoJCSAqICBAZGVmYXVsdCAwCgkJICovCgkJImlBcGlJbmRleCI6IDAsCgkKCQoJCS8qKgoJCSAqIFByZS1wcm9jZXNzaW5nIG9mIGZpbHRlcmluZyBkYXRhIHBsdWctaW5zIC0gV2hlbiB5b3UgYXNzaWduIHRoZSBzVHlwZSBmb3IgYSBjb2x1bW4KCQkgKiAob3IgaGF2ZSBpdCBhdXRvbWF0aWNhbGx5IGRldGVjdGVkIGZvciB5b3UgYnkgRGF0YVRhYmxlcyBvciBhIHR5cGUgZGV0ZWN0aW9uIHBsdWctaW4pLCAKCQkgKiB5b3Ugd2lsbCB0eXBpY2FsbHkgYmUgdXNpbmcgdGhpcyBmb3IgY3VzdG9tIHNvcnRpbmcsIGJ1dCBpdCBjYW4gYWxzbyBiZSB1c2VkIHRvIHByb3ZpZGUgCgkJICogY3VzdG9tIGZpbHRlcmluZyBieSBhbGxvd2luZyB5b3UgdG8gcHJlLXByb2Nlc3NpbmcgdGhlIGRhdGEgYW5kIHJldHVybmluZyB0aGUgZGF0YSBpbgoJCSAqIHRoZSBmb3JtYXQgdGhhdCBzaG91bGQgYmUgZmlsdGVyZWQgdXBvbi4gVGhpcyBpcyBkb25lIGJ5IGFkZGluZyBmdW5jdGlvbnMgdGhpcyBvYmplY3QgCgkJICogd2l0aCBhIHBhcmFtZXRlciBuYW1lIHdoaWNoIG1hdGNoZXMgdGhlIHNUeXBlIGZvciB0aGF0IHRhcmdldCBjb2x1bW4uIFRoaXMgaXMgdGhlCgkJICogY29yb2xsYXJ5IG9mIDxpPmFmblNvcnREYXRhPC9pPiBmb3IgZmlsdGVyaW5nIGRhdGEuCgkJICogICA8dWw+CgkgICAgICogICAgIDxsaT4KCSAgICAgKiAgICAgICBGdW5jdGlvbiBpbnB1dCBwYXJhbWV0ZXJzOgoJICAgICAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT57Kn0gRGF0YSBmcm9tIHRoZSBjb2x1bW4gY2VsbCB0byBiZSBwcmVwYXJlZCBmb3IgZmlsdGVyaW5nPC9saT4KCSAgICAgKiAgICAgICA8L3VsPgoJICAgICAqICAgICA8L2xpPgoJCSAqICAgICA8bGk+CgkJICogICAgICAgRnVuY3Rpb24gcmV0dXJuOgoJCSAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT57c3RyaW5nfG51bGx9IEZvcm1hdHRlZCBzdHJpbmcgdGhhdCB3aWxsIGJlIHVzZWQgZm9yIHRoZSBmaWx0ZXJpbmcuPC9saT4KCQkgKiAgICAgICA8L3VsPgoJCSAqICAgICA8L2lsPgoJCSAqICAgPC91bD4KCQkgKiAKCQkgKiBOb3RlIHRoYXQgYXMgb2YgdjEuOSwgaXQgaXMgdHlwaWNhbGx5IHByZWZlcmFibGUgdG8gdXNlIDxpPm1EYXRhUHJvcDwvaT4gdG8gcHJlcGFyZSBkYXRhIGZvcgoJCSAqIHRoZSBkaWZmZXJlbnQgdXNlcyB0aGF0IERhdGFUYWJsZXMgY2FuIHB1dCB0aGUgZGF0YSB0by4gU3BlY2lmaWNhbGx5IDxpPm1EYXRhUHJvcDwvaT4gd2hlbgoJCSAqIHVzZWQgYXMgYSBmdW5jdGlvbiB3aWxsIGdpdmUgeW91IGEgJ3R5cGUnIChzb3J0aW5nLCBmaWx0ZXJpbmcgZXRjKSB0aGF0IHlvdSBjYW4gdXNlIHRvIAoJCSAqIHByZXBhcmUgdGhlIGRhdGEgYXMgcmVxdWlyZWQgZm9yIHRoZSBkaWZmZXJlbnQgdHlwZXMuIEFzIHN1Y2gsIHRoaXMgbWV0aG9kIGlzIGRlcHJlY2F0ZWQuCgkJICogIEB0eXBlIG9iamVjdAoJCSAqICBAZGVmYXVsdCB7fQoJCSAqICBAZGVwcmVjYXRlZAoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJC5mbi5kYXRhVGFibGVFeHQub2ZuU2VhcmNoWyd0aXRsZS1udW1lcmljJ10gPSBmdW5jdGlvbiAoIHNEYXRhICkgewoJCSAqICAgICAgcmV0dXJuIHNEYXRhLnJlcGxhY2UoL1xuL2csIiAiKS5yZXBsYWNlKCAvPC4qPz4vZywgIiIgKTsKCQkgKiAgICB9CgkJICovCgkJIm9mblNlYXJjaCI6IHt9LAoJCgkKCQkvKioKCQkgKiBDb250YWluZXIgZm9yIGFsbCBwcml2YXRlIGZ1bmN0aW9ucyBpbiBEYXRhVGFibGVzIHNvIHRoZXkgY2FuIGJlIGV4cG9zZWQgZXh0ZXJuYWxseQoJCSAqICBAdHlwZSBvYmplY3QKCQkgKiAgQGRlZmF1bHQge30KCQkgKi8KCQkib0FwaSI6IHt9LAoJCgkKCQkvKioKCQkgKiBTdG9yYWdlIGZvciB0aGUgdmFyaW91cyBjbGFzc2VzIHRoYXQgRGF0YVRhYmxlcyB1c2VzCgkJICogIEB0eXBlIG9iamVjdAoJCSAqICBAZGVmYXVsdCB7fQoJCSAqLwoJCSJvU3RkQ2xhc3NlcyI6IHt9LAoJCQoJCgkJLyoqCgkJICogU3RvcmFnZSBmb3IgdGhlIHZhcmlvdXMgY2xhc3NlcyB0aGF0IERhdGFUYWJsZXMgdXNlcyAtIGpRdWVyeSBVSSBzdWl0YWJsZQoJCSAqICBAdHlwZSBvYmplY3QKCQkgKiAgQGRlZmF1bHQge30KCQkgKi8KCQkib0pVSUNsYXNzZXMiOiB7fSwKCQoJCgkJLyoqCgkJICogUGFnaW5hdGlvbiBwbHVnLWluIG1ldGhvZHMgLSBUaGUgc3R5bGUgYW5kIGNvbnRyb2xzIG9mIHRoZSBwYWdpbmF0aW9uIGNhbiBzaWduaWZpY2FudGx5IAoJCSAqIGltcGFjdCBvbiBob3cgdGhlIGVuZCB1c2VyIGludGVyYWN0cyB3aXRoIHRoZSBkYXRhIGluIHlvdXIgdGFibGUsIGFuZCBEYXRhVGFibGVzIGFsbG93cyAKCQkgKiB0aGUgYWRkaXRpb24gb2YgcGFnaW5hdGlvbiBjb250cm9scyBieSBleHRlbmRpbmcgdGhpcyBvYmplY3QsIHdoaWNoIGNhbiB0aGVuIGJlIGVuYWJsZWQKCQkgKiB0aHJvdWdoIHRoZSA8aT5zUGFnaW5hdGlvblR5cGU8L2k+IGluaXRpYWxpc2F0aW9uIHBhcmFtZXRlci4gRWFjaCBwYWdpbmF0aW9uIHR5cGUgdGhhdAoJCSAqIGlzIGFkZGVkIGlzIGFuIG9iamVjdCAodGhlIHByb3BlcnR5IG5hbWUgb2Ygd2hpY2ggaXMgd2hhdCA8aT5zUGFnaW5hdGlvblR5cGU8L2k+IHJlZmVycwoJCSAqIHRvKSB0aGF0IGhhcyB0d28gcHJvcGVydGllcywgYm90aCBtZXRob2RzIHRoYXQgYXJlIHVzZWQgYnkgRGF0YVRhYmxlcyB0byB1cGRhdGUgdGhlCgkJICogY29udHJvbCdzIHN0YXRlLgoJCSAqICAgPHVsPgoJCSAqICAgICA8bGk+CgkJICogICAgICAgZm5Jbml0IC0gIEluaXRpYWxpc2F0aW9uIG9mIHRoZSBwYWdpbmcgY29udHJvbHMuIENhbGxlZCBvbmx5IGR1cmluZyBpbml0aWFsaXNhdGlvbiAKCQkgKiAgICAgICAgIG9mIHRoZSB0YWJsZS4gSXQgaXMgZXhwZWN0ZWQgdGhhdCB0aGlzIGZ1bmN0aW9uIHdpbGwgYWRkIHRoZSByZXF1aXJlZCBET00gZWxlbWVudHMgCgkJICogICAgICAgICB0byB0aGUgcGFnZSBmb3IgdGhlIHBhZ2luZyBjb250cm9scyB0byB3b3JrLiBUaGUgZWxlbWVudCBwb2ludGVyIAoJCSAqICAgICAgICAgJ29TZXR0aW5ncy5hYW5GZWF0dXJlcy5wJyBhcnJheSBpcyBwcm92aWRlZCBieSBEYXRhVGFibGVzIHRvIGNvbnRhaW4gdGhlIHBhZ2luZyAKCQkgKiAgICAgICAgIGNvbnRyb2xzIChub3RlIHRoYXQgdGhpcyBpcyBhIDJEIGFycmF5IHRvIGFsbG93IGZvciBtdWx0aXBsZSBpbnN0YW5jZXMgb2YgZWFjaCAKCQkgKiAgICAgICAgIERhdGFUYWJsZXMgRE9NIGVsZW1lbnQpLiBJdCBpcyBzdWdnZXN0ZWQgdGhhdCB5b3UgYWRkIHRoZSBjb250cm9scyB0byB0aGlzIGVsZW1lbnQgCgkJICogICAgICAgICBhcyBjaGlsZHJlbgoJCSAqICAgICAgIDx1bD4KCSAgICAgKiAgICAgICAgIDxsaT4KCSAgICAgKiAgICAgICAgICAgRnVuY3Rpb24gaW5wdXQgcGFyYW1ldGVyczoKCSAgICAgKiAgICAgICAgICAgPHVsPgoJCSAqICAgICAgICAgICAgIDxsaT57b2JqZWN0fSBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdDogc2VlIHtAbGluayBEYXRhVGFibGUubW9kZWxzLm9TZXR0aW5nc30uPC9saT4KCQkgKiAgICAgICAgICAgICA8bGk+e25vZGV9IENvbnRhaW5lciBpbnRvIHdoaWNoIHRoZSBwYWdpbmF0aW9uIGNvbnRyb2xzIG11c3QgYmUgaW5zZXJ0ZWQ8L2xpPgoJCSAqICAgICAgICAgICAgIDxsaT57ZnVuY3Rpb259IERyYXcgY2FsbGJhY2sgZnVuY3Rpb24gLSB3aGVuZXZlciB0aGUgY29udHJvbHMgY2F1c2UgYSBwYWdlCgkJICogICAgICAgICAgICAgICBjaGFuZ2UsIHRoaXMgbWV0aG9kIG11c3QgYmUgY2FsbGVkIHRvIHJlZHJhdyB0aGUgdGFibGUuPC9saT4KCSAgICAgKiAgICAgICAgICAgPC91bD4KCSAgICAgKiAgICAgICAgIDwvbGk+CgkJICogICAgICAgICA8bGk+CgkJICogICAgICAgICAgIEZ1bmN0aW9uIHJldHVybjoKCQkgKiAgICAgICAgICAgPHVsPgoJCSAqICAgICAgICAgICAgIDxsaT5ObyByZXR1cm4gcmVxdWlyZWQ8L2xpPgoJCSAqICAgICAgICAgICA8L3VsPgoJCSAqICAgICAgICAgPC9pbD4KCQkgKiAgICAgICA8L3VsPgoJCSAqICAgICA8L2lsPgoJCSAqICAgICA8bGk+CgkJICogICAgICAgZm5Jbml0IC0gIFRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIHdoZW5ldmVyIHRoZSBwYWdpbmcgc3RhdHVzIG9mIHRoZSB0YWJsZSBjaGFuZ2VzIGFuZCBpcwoJCSAqICAgICAgICAgdHlwaWNhbGx5IHVzZWQgdG8gdXBkYXRlIGNsYXNzZXMgYW5kL29yIHRleHQgb2YgdGhlIHBhZ2luZyBjb250cm9scyB0byByZWZsZXggdGhlIG5ldyAKCQkgKiAgICAgICAgIHN0YXR1cy4KCQkgKiAgICAgICA8dWw+CgkgICAgICogICAgICAgICA8bGk+CgkgICAgICogICAgICAgICAgIEZ1bmN0aW9uIGlucHV0IHBhcmFtZXRlcnM6CgkgICAgICogICAgICAgICAgIDx1bD4KCQkgKiAgICAgICAgICAgICA8bGk+e29iamVjdH0gRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3Q6IHNlZSB7QGxpbmsgRGF0YVRhYmxlLm1vZGVscy5vU2V0dGluZ3N9LjwvbGk+CgkJICogICAgICAgICAgICAgPGxpPntmdW5jdGlvbn0gRHJhdyBjYWxsYmFjayBmdW5jdGlvbiAtIGluIGNhc2UgeW91IG5lZWQgdG8gcmVkcmF3IHRoZSB0YWJsZSBhZ2FpbgoJCSAqICAgICAgICAgICAgICAgb3IgYXR0YWNoIG5ldyBldmVudCBsaXN0ZW5lcnM8L2xpPgoJICAgICAqICAgICAgICAgICA8L3VsPgoJICAgICAqICAgICAgICAgPC9saT4KCQkgKiAgICAgICAgIDxsaT4KCQkgKiAgICAgICAgICAgRnVuY3Rpb24gcmV0dXJuOgoJCSAqICAgICAgICAgICA8dWw+CgkJICogICAgICAgICAgICAgPGxpPk5vIHJldHVybiByZXF1aXJlZDwvbGk+CgkJICogICAgICAgICAgIDwvdWw+CgkJICogICAgICAgICA8L2lsPgoJCSAqICAgICAgIDwvdWw+CgkJICogICAgIDwvaWw+CgkJICogICA8L3VsPgoJCSAqICBAdHlwZSBvYmplY3QKCQkgKiAgQGRlZmF1bHQge30KCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQuZm4uZGF0YVRhYmxlRXh0Lm9QYWdpbmF0aW9uLmZvdXJfYnV0dG9uID0gewoJCSAqICAgICAgImZuSW5pdCI6IGZ1bmN0aW9uICggb1NldHRpbmdzLCBuUGFnaW5nLCBmbkNhbGxiYWNrRHJhdyApIHsKCQkgKiAgICAgICAgbkZpcnN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ3NwYW4nICk7CgkJICogICAgICAgIG5QcmV2aW91cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdzcGFuJyApOwoJCSAqICAgICAgICBuTmV4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdzcGFuJyApOwoJCSAqICAgICAgICBuTGFzdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdzcGFuJyApOwoJCSAqICAgICAgICAKCQkgKiAgICAgICAgbkZpcnN0LmFwcGVuZENoaWxkKCBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSggb1NldHRpbmdzLm9MYW5ndWFnZS5vUGFnaW5hdGUuc0ZpcnN0ICkgKTsKCQkgKiAgICAgICAgblByZXZpb3VzLmFwcGVuZENoaWxkKCBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSggb1NldHRpbmdzLm9MYW5ndWFnZS5vUGFnaW5hdGUuc1ByZXZpb3VzICkgKTsKCQkgKiAgICAgICAgbk5leHQuYXBwZW5kQ2hpbGQoIGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCBvU2V0dGluZ3Mub0xhbmd1YWdlLm9QYWdpbmF0ZS5zTmV4dCApICk7CgkJICogICAgICAgIG5MYXN0LmFwcGVuZENoaWxkKCBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSggb1NldHRpbmdzLm9MYW5ndWFnZS5vUGFnaW5hdGUuc0xhc3QgKSApOwoJCSAqICAgICAgICAKCQkgKiAgICAgICAgbkZpcnN0LmNsYXNzTmFtZSA9ICJwYWdpbmF0ZV9idXR0b24gZmlyc3QiOwoJCSAqICAgICAgICBuUHJldmlvdXMuY2xhc3NOYW1lID0gInBhZ2luYXRlX2J1dHRvbiBwcmV2aW91cyI7CgkJICogICAgICAgIG5OZXh0LmNsYXNzTmFtZT0icGFnaW5hdGVfYnV0dG9uIG5leHQiOwoJCSAqICAgICAgICBuTGFzdC5jbGFzc05hbWUgPSAicGFnaW5hdGVfYnV0dG9uIGxhc3QiOwoJCSAqICAgICAgICAKCQkgKiAgICAgICAgblBhZ2luZy5hcHBlbmRDaGlsZCggbkZpcnN0ICk7CgkJICogICAgICAgIG5QYWdpbmcuYXBwZW5kQ2hpbGQoIG5QcmV2aW91cyApOwoJCSAqICAgICAgICBuUGFnaW5nLmFwcGVuZENoaWxkKCBuTmV4dCApOwoJCSAqICAgICAgICBuUGFnaW5nLmFwcGVuZENoaWxkKCBuTGFzdCApOwoJCSAqICAgICAgICAKCQkgKiAgICAgICAgJChuRmlyc3QpLmNsaWNrKCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAgICAgb1NldHRpbmdzLm9BcGkuX2ZuUGFnZUNoYW5nZSggb1NldHRpbmdzLCAiZmlyc3QiICk7CgkJICogICAgICAgICAgZm5DYWxsYmFja0RyYXcoIG9TZXR0aW5ncyApOwoJCSAqICAgICAgICB9ICk7CgkJICogICAgICAgIAoJCSAqICAgICAgICAkKG5QcmV2aW91cykuY2xpY2soIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgICAgIG9TZXR0aW5ncy5vQXBpLl9mblBhZ2VDaGFuZ2UoIG9TZXR0aW5ncywgInByZXZpb3VzIiApOwoJCSAqICAgICAgICAgIGZuQ2FsbGJhY2tEcmF3KCBvU2V0dGluZ3MgKTsKCQkgKiAgICAgICAgfSApOwoJCSAqICAgICAgICAKCQkgKiAgICAgICAgJChuTmV4dCkuY2xpY2soIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgICAgIG9TZXR0aW5ncy5vQXBpLl9mblBhZ2VDaGFuZ2UoIG9TZXR0aW5ncywgIm5leHQiICk7CgkJICogICAgICAgICAgZm5DYWxsYmFja0RyYXcoIG9TZXR0aW5ncyApOwoJCSAqICAgICAgICB9ICk7CgkJICogICAgICAgIAoJCSAqICAgICAgICAkKG5MYXN0KS5jbGljayggZnVuY3Rpb24oKSB7CgkJICogICAgICAgICAgb1NldHRpbmdzLm9BcGkuX2ZuUGFnZUNoYW5nZSggb1NldHRpbmdzLCAibGFzdCIgKTsKCQkgKiAgICAgICAgICBmbkNhbGxiYWNrRHJhdyggb1NldHRpbmdzICk7CgkJICogICAgICAgIH0gKTsKCQkgKiAgICAgICAgCgkJICogICAgICAgICQobkZpcnN0KS5iaW5kKCAnc2VsZWN0c3RhcnQnLCBmdW5jdGlvbiAoKSB7IHJldHVybiBmYWxzZTsgfSApOwoJCSAqICAgICAgICAkKG5QcmV2aW91cykuYmluZCggJ3NlbGVjdHN0YXJ0JywgZnVuY3Rpb24gKCkgeyByZXR1cm4gZmFsc2U7IH0gKTsKCQkgKiAgICAgICAgJChuTmV4dCkuYmluZCggJ3NlbGVjdHN0YXJ0JywgZnVuY3Rpb24gKCkgeyByZXR1cm4gZmFsc2U7IH0gKTsKCQkgKiAgICAgICAgJChuTGFzdCkuYmluZCggJ3NlbGVjdHN0YXJ0JywgZnVuY3Rpb24gKCkgeyByZXR1cm4gZmFsc2U7IH0gKTsKCQkgKiAgICAgIH0sCgkJICogICAgICAKCQkgKiAgICAgICJmblVwZGF0ZSI6IGZ1bmN0aW9uICggb1NldHRpbmdzLCBmbkNhbGxiYWNrRHJhdyApIHsKCQkgKiAgICAgICAgaWYgKCAhb1NldHRpbmdzLmFhbkZlYXR1cmVzLnAgKSB7CgkJICogICAgICAgICAgcmV0dXJuOwoJCSAqICAgICAgICB9CgkJICogICAgICAgIAoJCSAqICAgICAgICAvLyBMb29wIG92ZXIgZWFjaCBpbnN0YW5jZSBvZiB0aGUgcGFnZXIKCQkgKiAgICAgICAgdmFyIGFuID0gb1NldHRpbmdzLmFhbkZlYXR1cmVzLnA7CgkJICogICAgICAgIGZvciAoIHZhciBpPTAsIGlMZW49YW4ubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkgewoJCSAqICAgICAgICAgIHZhciBidXR0b25zID0gYW5baV0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3NwYW4nKTsKCQkgKiAgICAgICAgICBpZiAoIG9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA9PT0gMCApIHsKCQkgKiAgICAgICAgICAgIGJ1dHRvbnNbMF0uY2xhc3NOYW1lID0gInBhZ2luYXRlX2Rpc2FibGVkX3ByZXZpb3VzIjsKCQkgKiAgICAgICAgICAgIGJ1dHRvbnNbMV0uY2xhc3NOYW1lID0gInBhZ2luYXRlX2Rpc2FibGVkX3ByZXZpb3VzIjsKCQkgKiAgICAgICAgICB9CgkJICogICAgICAgICAgZWxzZSB7CgkJICogICAgICAgICAgICBidXR0b25zWzBdLmNsYXNzTmFtZSA9ICJwYWdpbmF0ZV9lbmFibGVkX3ByZXZpb3VzIjsKCQkgKiAgICAgICAgICAgIGJ1dHRvbnNbMV0uY2xhc3NOYW1lID0gInBhZ2luYXRlX2VuYWJsZWRfcHJldmlvdXMiOwoJCSAqICAgICAgICAgIH0KCQkgKiAgICAgICAgICAKCQkgKiAgICAgICAgICBpZiAoIG9TZXR0aW5ncy5mbkRpc3BsYXlFbmQoKSA9PSBvU2V0dGluZ3MuZm5SZWNvcmRzRGlzcGxheSgpICkgewoJCSAqICAgICAgICAgICAgYnV0dG9uc1syXS5jbGFzc05hbWUgPSAicGFnaW5hdGVfZGlzYWJsZWRfbmV4dCI7CgkJICogICAgICAgICAgICBidXR0b25zWzNdLmNsYXNzTmFtZSA9ICJwYWdpbmF0ZV9kaXNhYmxlZF9uZXh0IjsKCQkgKiAgICAgICAgICB9CgkJICogICAgICAgICAgZWxzZSB7CgkJICogICAgICAgICAgICBidXR0b25zWzJdLmNsYXNzTmFtZSA9ICJwYWdpbmF0ZV9lbmFibGVkX25leHQiOwoJCSAqICAgICAgICAgICAgYnV0dG9uc1szXS5jbGFzc05hbWUgPSAicGFnaW5hdGVfZW5hYmxlZF9uZXh0IjsKCQkgKiAgICAgICAgICB9CgkJICogICAgICAgIH0KCQkgKiAgICAgIH0KCQkgKiAgICB9OwoJCSAqLwoJCSJvUGFnaW5hdGlvbiI6IHt9LAoJCgkKCQkvKioKCQkgKiBTb3J0aW5nIHBsdWctaW4gbWV0aG9kcyAtIFNvcnRpbmcgaW4gRGF0YVRhYmxlcyBpcyBiYXNlZCBvbiB0aGUgZGV0ZWN0ZWQgdHlwZSBvZiB0aGUKCQkgKiBkYXRhIGNvbHVtbiAoeW91IGNhbiBhZGQgeW91ciBvd24gdHlwZSBkZXRlY3Rpb24gZnVuY3Rpb25zLCBvciBvdmVycmlkZSBhdXRvbWF0aWMgCgkJICogZGV0ZWN0aW9uIHVzaW5nIHNUeXBlKS4gV2l0aCB0aGlzIHNwZWNpZmljIHR5cGUgZ2l2ZW4gdG8gdGhlIGNvbHVtbiwgRGF0YVRhYmxlcyB3aWxsIAoJCSAqIGFwcGx5IHRoZSByZXF1aXJlZCBzb3J0IGZyb20gdGhlIGZ1bmN0aW9ucyBpbiB0aGUgb2JqZWN0LiBFYWNoIHNvcnQgdHlwZSBtdXN0IHByb3ZpZGUKCQkgKiB0d28gbWFuZGF0b3J5IG1ldGhvZHMsIG9uZSBlYWNoIGZvciBhc2NlbmRpbmcgYW5kIGRlc2NlbmRpbmcgc29ydGluZywgYW5kIGNhbiBvcHRpb25hbGx5CgkJICogcHJvdmlkZSBhIHByZS1mb3JtYXR0aW5nIG1ldGhvZCB0aGF0IHdpbGwgaGVscCBzcGVlZCB1cCBzb3J0aW5nIGJ5IGFsbG93aW5nIERhdGFUYWJsZXMKCQkgKiB0byBwcmUtZm9ybWF0IHRoZSBzb3J0IGRhdGEgb25seSBvbmNlIChyYXRoZXIgdGhhbiBldmVyeSB0aW1lIHRoZSBhY3R1YWwgc29ydCBmdW5jdGlvbnMKCQkgKiBhcmUgcnVuKS4gVGhlIHR3byBzb3J0aW5nIGZ1bmN0aW9ucyBhcmUgdHlwaWNhbCBKYXZhc2NyaXB0IHNvcnQgbWV0aG9kczoKCQkgKiAgIDx1bD4KCSAgICAgKiAgICAgPGxpPgoJICAgICAqICAgICAgIEZ1bmN0aW9uIGlucHV0IHBhcmFtZXRlcnM6CgkgICAgICogICAgICAgPHVsPgoJCSAqICAgICAgICAgPGxpPnsqfSBEYXRhIHRvIGNvbXBhcmUgdG8gdGhlIHNlY29uZCBwYXJhbWV0ZXI8L2xpPgoJCSAqICAgICAgICAgPGxpPnsqfSBEYXRhIHRvIGNvbXBhcmUgdG8gdGhlIGZpcnN0IHBhcmFtZXRlcjwvbGk+CgkgICAgICogICAgICAgPC91bD4KCSAgICAgKiAgICAgPC9saT4KCQkgKiAgICAgPGxpPgoJCSAqICAgICAgIEZ1bmN0aW9uIHJldHVybjoKCQkgKiAgICAgICA8dWw+CgkJICogICAgICAgICA8bGk+e2ludH0gU29ydGluZyBtYXRjaDogPDAgaWYgZmlyc3QgcGFyYW1ldGVyIHNob3VsZCBiZSBzb3J0ZWQgbG93ZXIgdGhhbgoJCSAqICAgICAgICAgICB0aGUgc2Vjb25kIHBhcmFtZXRlciwgPT09MCBpZiB0aGUgdHdvIHBhcmFtZXRlcnMgYXJlIGVxdWFsIGFuZCA+MCBpZgoJCSAqICAgICAgICAgICB0aGUgZmlyc3QgcGFyYW1ldGVyIHNob3VsZCBiZSBzb3J0ZWQgaGVpZ2h0IHRoYW4gdGhlIHNlY29uZCBwYXJhbWV0ZXIuPC9saT4KCQkgKiAgICAgICA8L3VsPgoJCSAqICAgICA8L2lsPgoJCSAqICAgPC91bD4KCQkgKiAgQHR5cGUgb2JqZWN0CgkJICogIEBkZWZhdWx0IHt9CgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBDYXNlLXNlbnNpdGl2ZSBzdHJpbmcgc29ydGluZywgd2l0aCBubyBwcmUtZm9ybWF0dGluZyBtZXRob2QKCQkgKiAgICAkLmV4dGVuZCggJC5mbi5kYXRhVGFibGVFeHQub1NvcnQsIHsKCQkgKiAgICAgICJzdHJpbmctY2FzZS1hc2MiOiBmdW5jdGlvbih4LHkpIHsKCQkgKiAgICAgICAgcmV0dXJuICgoeCA8IHkpID8gLTEgOiAoKHggPiB5KSA/IDEgOiAwKSk7CgkJICogICAgICB9LAoJCSAqICAgICAgInN0cmluZy1jYXNlLWRlc2MiOiBmdW5jdGlvbih4LHkpIHsKCQkgKiAgICAgICAgcmV0dXJuICgoeCA8IHkpID8gMSA6ICgoeCA+IHkpID8gLTEgOiAwKSk7CgkJICogICAgICB9CgkJICogICAgfSApOwoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gQ2FzZS1pbnNlbnNpdGl2ZSBzdHJpbmcgc29ydGluZywgd2l0aCBwcmUtZm9ybWF0dGluZwoJCSAqICAgICQuZXh0ZW5kKCAkLmZuLmRhdGFUYWJsZUV4dC5vU29ydCwgewoJCSAqICAgICAgInN0cmluZy1wcmUiOiBmdW5jdGlvbih4KSB7CgkJICogICAgICAgIHJldHVybiB4LnRvTG93ZXJDYXNlKCk7CgkJICogICAgICB9LAoJCSAqICAgICAgInN0cmluZy1hc2MiOiBmdW5jdGlvbih4LHkpIHsKCQkgKiAgICAgICAgcmV0dXJuICgoeCA8IHkpID8gLTEgOiAoKHggPiB5KSA/IDEgOiAwKSk7CgkJICogICAgICB9LAoJCSAqICAgICAgInN0cmluZy1kZXNjIjogZnVuY3Rpb24oeCx5KSB7CgkJICogICAgICAgIHJldHVybiAoKHggPCB5KSA/IDEgOiAoKHggPiB5KSA/IC0xIDogMCkpOwoJCSAqICAgICAgfQoJCSAqICAgIH0gKTsKCQkgKi8KCQkib1NvcnQiOiB7fSwKCQoJCgkJLyoqCgkJICogVmVyc2lvbiBzdHJpbmcgZm9yIHBsdWctaW5zIHRvIGNoZWNrIGNvbXBhdGliaWxpdHkuIEFsbG93ZWQgZm9ybWF0IGlzCgkJICogYS5iLmMuZC5lIHdoZXJlOiBhOmludCwgYjppbnQsIGM6aW50LCBkOnN0cmluZyhkZXZ8YmV0YSksIGU6aW50LiBkIGFuZAoJCSAqIGUgYXJlIG9wdGlvbmFsCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBWZXJzaW9uIG51bWJlcgoJCSAqLwoJCSJzVmVyc2lvbiI6IERhdGFUYWJsZS52ZXJzaW9uLAoJCgkKCQkvKioKCQkgKiBIb3cgc2hvdWxkIERhdGFUYWJsZXMgcmVwb3J0IGFuIGVycm9yLiBDYW4gdGFrZSB0aGUgdmFsdWUgJ2FsZXJ0JyBvciAndGhyb3cnCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBhbGVydAoJCSAqLwoJCSJzRXJyTW9kZSI6ICJhbGVydCIsCgkKCQoJCS8qKgoJCSAqIFN0b3JlIGluZm9ybWF0aW9uIGZvciBEYXRhVGFibGVzIHRvIGFjY2VzcyBnbG9iYWxseSBhYm91dCBvdGhlciBpbnN0YW5jZXMKCQkgKiAgQG5hbWVzcGFjZQoJCSAqICBAcHJpdmF0ZQoJCSAqLwoJCSJfb0V4dGVybkNvbmZpZyI6IHsKCQkJLyogaW50OmlOZXh0VW5pcXVlIC0gbmV4dCB1bmlxdWUgbnVtYmVyIGZvciBhbiBpbnN0YW5jZSAqLwoJCQkiaU5leHRVbmlxdWUiOiAwCgkJfQoJfTsKCQoJCgkKCQoJLyoqCgkgKiBUZW1wbGF0ZSBvYmplY3QgZm9yIHRoZSB3YXkgaW4gd2hpY2ggRGF0YVRhYmxlcyBob2xkcyBpbmZvcm1hdGlvbiBhYm91dAoJICogc2VhcmNoIGluZm9ybWF0aW9uIGZvciB0aGUgZ2xvYmFsIGZpbHRlciBhbmQgaW5kaXZpZHVhbCBjb2x1bW4gZmlsdGVycy4KCSAqICBAbmFtZXNwYWNlCgkgKi8KCURhdGFUYWJsZS5tb2RlbHMub1NlYXJjaCA9IHsKCQkvKioKCQkgKiBGbGFnIHRvIGluZGljYXRlIGlmIHRoZSBmaWx0ZXJpbmcgc2hvdWxkIGJlIGNhc2UgaW5zZW5zaXRpdmUgb3Igbm90CgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgdHJ1ZQoJCSAqLwoJCSJiQ2FzZUluc2Vuc2l0aXZlIjogdHJ1ZSwKCQoJCS8qKgoJCSAqIEFwcGxpZWQgc2VhcmNoIHRlcm0KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IDxpPkVtcHR5IHN0cmluZzwvaT4KCQkgKi8KCQkic1NlYXJjaCI6ICIiLAoJCgkJLyoqCgkJICogRmxhZyB0byBpbmRpY2F0ZSBpZiB0aGUgc2VhcmNoIHRlcm0gc2hvdWxkIGJlIGludGVycHJldGVkIGFzIGEKCQkgKiByZWd1bGFyIGV4cHJlc3Npb24gKHRydWUpIG9yIG5vdCAoZmFsc2UpIGFuZCB0aGVyZWZvcmUgYW5kIHNwZWNpYWwKCQkgKiByZWdleCBjaGFyYWN0ZXJzIGVzY2FwZWQuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkgKi8KCQkiYlJlZ2V4IjogZmFsc2UsCgkKCQkvKioKCQkgKiBGbGFnIHRvIGluZGljYXRlIGlmIERhdGFUYWJsZXMgaXMgdG8gdXNlIGl0cyBzbWFydCBmaWx0ZXJpbmcgb3Igbm90LgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IHRydWUKCQkgKi8KCQkiYlNtYXJ0IjogdHJ1ZQoJfTsKCQoJCgkKCQoJLyoqCgkgKiBUZW1wbGF0ZSBvYmplY3QgZm9yIHRoZSB3YXkgaW4gd2hpY2ggRGF0YVRhYmxlcyBob2xkcyBpbmZvcm1hdGlvbiBhYm91dAoJICogZWFjaCBpbmRpdmlkdWFsIHJvdy4gVGhpcyBpcyB0aGUgb2JqZWN0IGZvcm1hdCB1c2VkIGZvciB0aGUgc2V0dGluZ3MgCgkgKiBhb0RhdGEgYXJyYXkuCgkgKiAgQG5hbWVzcGFjZQoJICovCglEYXRhVGFibGUubW9kZWxzLm9Sb3cgPSB7CgkJLyoqCgkJICogVFIgZWxlbWVudCBmb3IgdGhlIHJvdwoJCSAqICBAdHlwZSBub2RlCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkiblRyIjogbnVsbCwKCQoJCS8qKgoJCSAqIERhdGEgb2JqZWN0IGZyb20gdGhlIG9yaWdpbmFsIGRhdGEgc291cmNlIGZvciB0aGUgcm93LiBUaGlzIGlzIGVpdGhlcgoJCSAqIGFuIGFycmF5IGlmIHVzaW5nIHRoZSB0cmFkaXRpb25hbCBmb3JtIG9mIERhdGFUYWJsZXMsIG9yIGFuIG9iamVjdCBpZgoJCSAqIHVzaW5nIG1EYXRhUHJvcCBvcHRpb25zLiBUaGUgZXhhY3QgdHlwZSB3aWxsIGRlcGVuZCBvbiB0aGUgcGFzc2VkIGluCgkJICogZGF0YSBmcm9tIHRoZSBkYXRhIHNvdXJjZSwgb3Igd2lsbCBiZSBhbiBhcnJheSBpZiB1c2luZyBET00gYSBkYXRhIAoJCSAqIHNvdXJjZS4KCQkgKiAgQHR5cGUgYXJyYXl8b2JqZWN0CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJIl9hRGF0YSI6IFtdLAoJCgkJLyoqCgkJICogU29ydGluZyBkYXRhIGNhY2hlIC0gdGhpcyBhcnJheSBpcyBvc3RlbnNpYmx5IHRoZSBzYW1lIGxlbmd0aCBhcyB0aGUKCQkgKiBudW1iZXIgb2YgY29sdW1ucyAoYWx0aG91Z2ggZWFjaCBpbmRleCBpcyBnZW5lcmF0ZWQgb25seSBhcyBpdCBpcyAKCQkgKiBuZWVkZWQpLCBhbmQgaG9sZHMgdGhlIGRhdGEgdGhhdCBpcyB1c2VkIGZvciBzb3J0aW5nIGVhY2ggY29sdW1uIGluIHRoZQoJCSAqIHJvdy4gV2UgZG8gdGhpcyBjYWNoZSBnZW5lcmF0aW9uIGF0IHRoZSBzdGFydCBvZiB0aGUgc29ydCBpbiBvcmRlciB0aGF0CgkJICogdGhlIGZvcm1hdHRpbmcgb2YgdGhlIHNvcnQgZGF0YSBuZWVkIGJlIGRvbmUgb25seSBvbmNlIGZvciBlYWNoIGNlbGwKCQkgKiBwZXIgc29ydC4gVGhpcyBhcnJheSBzaG91bGQgbm90IGJlIHJlYWQgZnJvbSBvciB3cml0dGVuIHRvIGJ5IGFueXRoaW5nCgkJICogb3RoZXIgdGhhbiB0aGUgbWFzdGVyIHNvcnRpbmcgbWV0aG9kcy4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKiAgQHByaXZhdGUKCQkgKi8KCQkiX2FTb3J0RGF0YSI6IFtdLAoJCgkJLyoqCgkJICogQXJyYXkgb2YgVEQgZWxlbWVudHMgdGhhdCBhcmUgY2FjaGVkIGZvciBoaWRkZW4gcm93cywgc28gdGhleSBjYW4gYmUKCQkgKiByZWluc2VydGVkIGludG8gdGhlIHRhYmxlIGlmIGEgY29sdW1uIGlzIG1hZGUgdmlzaWJsZSBhZ2FpbiAob3IgdG8gYWN0CgkJICogYXMgYSBzdG9yZSBpZiBhIGNvbHVtbiBpcyBtYWRlIGhpZGRlbikuIE9ubHkgaGlkZGVuIGNvbHVtbnMgaGF2ZSBhIAoJCSAqIHJlZmVyZW5jZSBpbiB0aGUgYXJyYXkuIEZvciBub24taGlkZGVuIGNvbHVtbnMgdGhlIHZhbHVlIGlzIGVpdGhlcgoJCSAqIHVuZGVmaW5lZCBvciBudWxsLgoJCSAqICBAdHlwZSBhcnJheSBub2RlcwoJCSAqICBAZGVmYXVsdCBbXQoJCSAqICBAcHJpdmF0ZQoJCSAqLwoJCSJfYW5IaWRkZW4iOiBbXSwKCQoJCS8qKgoJCSAqIENhY2hlIG9mIHRoZSBjbGFzcyBuYW1lIHRoYXQgRGF0YVRhYmxlcyBoYXMgYXBwbGllZCB0byB0aGUgcm93LCBzbyB3ZQoJCSAqIGNhbiBxdWlja2x5IGxvb2sgYXQgdGhpcyB2YXJpYWJsZSByYXRoZXIgdGhhbiBuZWVkaW5nIHRvIGRvIGEgRE9NIGNoZWNrCgkJICogb24gY2xhc3NOYW1lIGZvciB0aGUgblRyIHByb3BlcnR5LgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgPGk+RW1wdHkgc3RyaW5nPC9pPgoJCSAqICBAcHJpdmF0ZQoJCSAqLwoJCSJfc1Jvd1N0cmlwZSI6ICIiCgl9OwoJCgkKCQoJLyoqCgkgKiBUZW1wbGF0ZSBvYmplY3QgZm9yIHRoZSBjb2x1bW4gaW5mb3JtYXRpb24gb2JqZWN0IGluIERhdGFUYWJsZXMuIFRoaXMgb2JqZWN0CgkgKiBpcyBoZWxkIGluIHRoZSBzZXR0aW5ncyBhb0NvbHVtbnMgYXJyYXkgYW5kIGNvbnRhaW5zIGFsbCB0aGUgaW5mb3JtYXRpb24gdGhhdAoJICogRGF0YVRhYmxlcyBuZWVkcyBhYm91dCBlYWNoIGluZGl2aWR1YWwgY29sdW1uLgoJICogCgkgKiBOb3RlIHRoYXQgdGhpcyBvYmplY3QgaXMgcmVsYXRlZCB0byB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzLmNvbHVtbnN9IAoJICogYnV0IHRoaXMgb25lIGlzIHRoZSBpbnRlcm5hbCBkYXRhIHN0b3JlIGZvciBEYXRhVGFibGVzJ3MgY2FjaGUgb2YgY29sdW1ucy4KCSAqIEl0IHNob3VsZCBOT1QgYmUgbWFuaXB1bGF0ZWQgb3V0c2lkZSBvZiBEYXRhVGFibGVzLiBBbnkgY29uZmlndXJhdGlvbiBzaG91bGQKCSAqIGJlIGRvbmUgdGhyb3VnaCB0aGUgaW5pdGlhbGlzYXRpb24gb3B0aW9ucy4KCSAqICBAbmFtZXNwYWNlCgkgKi8KCURhdGFUYWJsZS5tb2RlbHMub0NvbHVtbiA9IHsKCQkvKioKCQkgKiBBIGxpc3Qgb2YgdGhlIGNvbHVtbnMgdGhhdCBzb3J0aW5nIHNob3VsZCBvY2N1ciBvbiB3aGVuIHRoaXMgY29sdW1uCgkJICogaXMgc29ydGVkLiBUaGF0IHRoaXMgcHJvcGVydHkgaXMgYW4gYXJyYXkgYWxsb3dzIG11bHRpLWNvbHVtbiBzb3J0aW5nCgkJICogdG8gYmUgZGVmaW5lZCBmb3IgYSBjb2x1bW4gKGZvciBleGFtcGxlIGZpcnN0IG5hbWUgLyBsYXN0IG5hbWUgY29sdW1ucwoJCSAqIHdvdWxkIGJlbmVmaXQgZnJvbSB0aGlzKS4gVGhlIHZhbHVlcyBhcmUgaW50ZWdlcnMgcG9pbnRpbmcgdG8gdGhlCgkJICogY29sdW1ucyB0byBiZSBzb3J0ZWQgb24gKHR5cGljYWxseSBpdCB3aWxsIGJlIGEgc2luZ2xlIGludGVnZXIgcG9pbnRpbmcKCQkgKiBhdCBpdHNlbGYsIGJ1dCB0aGF0IGRvZXNuJ3QgbmVlZCB0byBiZSB0aGUgY2FzZSkuCgkJICogIEB0eXBlIGFycmF5CgkJICovCgkJImFEYXRhU29ydCI6IG51bGwsCgkKCQkvKioKCQkgKiBEZWZpbmUgdGhlIHNvcnRpbmcgZGlyZWN0aW9ucyB0aGF0IGFyZSBhcHBsaWVkIHRvIHRoZSBjb2x1bW4sIGluIHNlcXVlbmNlCgkJICogYXMgdGhlIGNvbHVtbiBpcyByZXBlYXRlZGx5IHNvcnRlZCB1cG9uIC0gaS5lLiB0aGUgZmlyc3QgdmFsdWUgaXMgdXNlZAoJCSAqIGFzIHRoZSBzb3J0aW5nIGRpcmVjdGlvbiB3aGVuIHRoZSBjb2x1bW4gaWYgZmlyc3Qgc29ydGVkIChjbGlja2VkIG9uKS4KCQkgKiBTb3J0IGl0IGFnYWluIChjbGljayBhZ2FpbikgYW5kIGl0IHdpbGwgbW92ZSBvbiB0byB0aGUgbmV4dCBpbmRleC4KCQkgKiBSZXBlYXQgdW50aWwgbG9vcC4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKi8KCQkiYXNTb3J0aW5nIjogbnVsbCwKCQkKCQkvKioKCQkgKiBGbGFnIHRvIGluZGljYXRlIGlmIHRoZSBjb2x1bW4gaXMgc2VhcmNoYWJsZSwgYW5kIHRodXMgc2hvdWxkIGJlIGluY2x1ZGVkCgkJICogaW4gdGhlIGZpbHRlcmluZyBvciBub3QuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKi8KCQkiYlNlYXJjaGFibGUiOiBudWxsLAoJCQoJCS8qKgoJCSAqIEZsYWcgdG8gaW5kaWNhdGUgaWYgdGhlIGNvbHVtbiBpcyBzb3J0YWJsZSBvciBub3QuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKi8KCQkiYlNvcnRhYmxlIjogbnVsbCwKCQkKCQkvKioKCQkgKiBXaGVuIHVzaW5nIGZuUmVuZGVyLCB5b3UgaGF2ZSB0d28gb3B0aW9ucyBmb3Igd2hhdCB0byBkbyB3aXRoIHRoZSBkYXRhLAoJCSAqIGFuZCB0aGlzIHByb3BlcnR5IHNlcnZlcyBhcyB0aGUgc3dpdGNoLiBGaXJzdGx5LCB5b3UgY2FuIGhhdmUgdGhlIHNvcnRpbmcKCQkgKiBhbmQgZmlsdGVyaW5nIHVzZSB0aGUgcmVuZGVyZWQgdmFsdWUgKHRydWUgLSBkZWZhdWx0KSwgb3IgeW91IGNhbiBoYXZlCgkJICogdGhlIHNvcnRpbmcgYW5kIGZpbHRlcmluZyB1cyB0aGUgb3JpZ2luYWwgdmFsdWUgKGZhbHNlKS4KCQkgKiAKCQkgKiAqTk9URSogSXQgaXMgaXQgaXMgYWR2aXNhYmxlIG5vdyB0byB1c2UgbURhdGFQcm9wIGFzIGEgZnVuY3Rpb24gYW5kIG1ha2UgCgkJICogdXNlIG9mIHRoZSAndHlwZScgdGhhdCBpdCBnaXZlcywgYWxsb3dpbmcgKHBvdGVudGlhbGx5KSBkaWZmZXJlbnQgZGF0YSB0bwoJCSAqIGJlIHVzZWQgZm9yIHNvcnRpbmcsIGZpbHRlcmluZywgZGlzcGxheSBhbmQgdHlwZSBkZXRlY3Rpb24uCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlcHJlY2F0ZWQKCQkgKi8KCQkiYlVzZVJlbmRlcmVkIjogbnVsbCwKCQkKCQkvKioKCQkgKiBGbGFnIHRvIGluZGljYXRlIGlmIHRoZSBjb2x1bW4gaXMgY3VycmVudGx5IHZpc2libGUgaW4gdGhlIHRhYmxlIG9yIG5vdAoJCSAqICBAdHlwZSBib29sZWFuCgkJICovCgkJImJWaXNpYmxlIjogbnVsbCwKCQkKCQkvKioKCQkgKiBGbGFnIHRvIGluZGljYXRlIHRvIHRoZSB0eXBlIGRldGVjdGlvbiBtZXRob2QgaWYgdGhlIGF1dG9tYXRpYyB0eXBlCgkJICogZGV0ZWN0aW9uIHNob3VsZCBiZSB1c2VkLCBvciBpZiBhIGNvbHVtbiB0eXBlIChzVHlwZSkgaGFzIGJlZW4gc3BlY2lmaWVkCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgdHJ1ZQoJCSAqICBAcHJpdmF0ZQoJCSAqLwoJCSJfYkF1dG9UeXBlIjogdHJ1ZSwKCQkKCQkvKioKCQkgKiBEZXZlbG9wZXIgZGVmaW5hYmxlIGZ1bmN0aW9uIHRoYXQgaXMgY2FsbGVkIHdoZW5ldmVyIGEgY2VsbCBpcyBjcmVhdGVkIChBamF4IHNvdXJjZSwKCQkgKiBldGMpIG9yIHByb2Nlc3NlZCBmb3IgaW5wdXQgKERPTSBzb3VyY2UpLiBUaGlzIGNhbiBiZSB1c2VkIGFzIGEgY29tcGxpbWVudCB0byBmblJlbmRlcgoJCSAqIGFsbG93aW5nIHlvdSB0byBtb2RpZnkgdGhlIERPTSBlbGVtZW50IChhZGQgYmFja2dyb3VuZCBjb2xvdXIgZm9yIGV4YW1wbGUpIHdoZW4gdGhlCgkJICogZWxlbWVudCBpcyBhdmFpbGFibGUgKHNpbmNlIGl0IGlzIG5vdCB3aGVuIGZuUmVuZGVyIGlzIGNhbGxlZCkuCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7ZWxlbWVudH0gblRkIFRoZSBURCBub2RlIHRoYXQgaGFzIGJlZW4gY3JlYXRlZAoJCSAqICBAcGFyYW0geyp9IHNEYXRhIFRoZSBEYXRhIGZvciB0aGUgY2VsbAoJCSAqICBAcGFyYW0ge2FycmF5fG9iamVjdH0gb0RhdGEgVGhlIGRhdGEgZm9yIHRoZSB3aG9sZSByb3cKCQkgKiAgQHBhcmFtIHtpbnR9IGlSb3cgVGhlIHJvdyBpbmRleCBmb3IgdGhlIGFvRGF0YSBkYXRhIHN0b3JlCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkiZm5DcmVhdGVkQ2VsbCI6IG51bGwsCgkJCgkJLyoqCgkJICogRnVuY3Rpb24gdG8gZ2V0IGRhdGEgZnJvbSBhIGNlbGwgaW4gYSBjb2x1bW4uIFlvdSBzaG91bGQgPGI+bmV2ZXI8L2I+CgkJICogYWNjZXNzIGRhdGEgZGlyZWN0bHkgdGhyb3VnaCBfYURhdGEgaW50ZXJuYWxseSBpbiBEYXRhVGFibGVzIC0gYWx3YXlzIHVzZQoJCSAqIHRoZSBtZXRob2QgYXR0YWNoZWQgdG8gdGhpcyBwcm9wZXJ0eS4gSXQgYWxsb3dzIG1EYXRhUHJvcCB0byBmdW5jdGlvbiBhcwoJCSAqIHJlcXVpcmVkLiBUaGlzIGZ1bmN0aW9uIGlzIGF1dG9tYXRpY2FsbHkgYXNzaWduZWQgYnkgdGhlIGNvbHVtbiAKCQkgKiBpbml0aWFsaXNhdGlvbiBtZXRob2QKCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHthcnJheXxvYmplY3R9IG9EYXRhIFRoZSBkYXRhIGFycmF5L29iamVjdCBmb3IgdGhlIGFycmF5IAoJCSAqICAgIChpLmUuIGFvRGF0YVtdLl9hRGF0YSkKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNTcGVjaWZpYyBUaGUgc3BlY2lmaWMgZGF0YSB0eXBlIHlvdSB3YW50IHRvIGdldCAtIAoJCSAqICAgICdkaXNwbGF5JywgJ3R5cGUnICdmaWx0ZXInICdzb3J0JwoJCSAqICBAcmV0dXJucyB7Kn0gVGhlIGRhdGEgZm9yIHRoZSBjZWxsIGZyb20gdGhlIGdpdmVuIHJvdydzIGRhdGEKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJmbkdldERhdGEiOiBudWxsLAoJCQoJCS8qKgoJCSAqIEN1c3RvbSBkaXNwbGF5IGZ1bmN0aW9uIHRoYXQgd2lsbCBiZSBjYWxsZWQgZm9yIHRoZSBkaXNwbGF5IG9mIGVhY2ggY2VsbCAKCQkgKiBpbiB0aGlzIGNvbHVtbi4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG8gT2JqZWN0IHdpdGggdGhlIGZvbGxvd2luZyBwYXJhbWV0ZXJzOgoJCSAqICBAcGFyYW0ge2ludH0gICAgby5pRGF0YVJvdyBUaGUgcm93IGluIGFvRGF0YQoJCSAqICBAcGFyYW0ge2ludH0gICAgby5pRGF0YUNvbHVtbiBUaGUgY29sdW1uIGluIHF1ZXN0aW9uCgkJICogIEBwYXJhbSB7YXJyYXl9ICBvLmFEYXRhIFRoZSBkYXRhIGZvciB0aGUgcm93IGluIHF1ZXN0aW9uCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvLm9TZXR0aW5ncyBUaGUgc2V0dGluZ3Mgb2JqZWN0IGZvciB0aGlzIERhdGFUYWJsZXMgaW5zdGFuY2UKCQkgKiAgQHJldHVybnMge3N0cmluZ30gVGhlIHN0cmluZyB5b3Ugd2hpY2ggdG8gdXNlIGluIHRoZSBkaXNwbGF5CgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkiZm5SZW5kZXIiOiBudWxsLAoJCQoJCS8qKgoJCSAqIEZ1bmN0aW9uIHRvIHNldCBkYXRhIGZvciBhIGNlbGwgaW4gdGhlIGNvbHVtbi4gWW91IHNob3VsZCA8Yj5uZXZlcjwvYj4gCgkJICogc2V0IHRoZSBkYXRhIGRpcmVjdGx5IHRvIF9hRGF0YSBpbnRlcm5hbGx5IGluIERhdGFUYWJsZXMgLSBhbHdheXMgdXNlCgkJICogdGhpcyBtZXRob2QuIEl0IGFsbG93cyBtRGF0YVByb3AgdG8gZnVuY3Rpb24gYXMgcmVxdWlyZWQuIFRoaXMgZnVuY3Rpb24KCQkgKiBpcyBhdXRvbWF0aWNhbGx5IGFzc2lnbmVkIGJ5IHRoZSBjb2x1bW4gaW5pdGlhbGlzYXRpb24gbWV0aG9kCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7YXJyYXl8b2JqZWN0fSBvRGF0YSBUaGUgZGF0YSBhcnJheS9vYmplY3QgZm9yIHRoZSBhcnJheSAKCQkgKiAgICAoaS5lLiBhb0RhdGFbXS5fYURhdGEpCgkJICogIEBwYXJhbSB7Kn0gc1ZhbHVlIFZhbHVlIHRvIHNldAoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJImZuU2V0RGF0YSI6IG51bGwsCgkJCgkJLyoqCgkJICogUHJvcGVydHkgdG8gcmVhZCB0aGUgdmFsdWUgZm9yIHRoZSBjZWxscyBpbiB0aGUgY29sdW1uIGZyb20gdGhlIGRhdGEgCgkJICogc291cmNlIGFycmF5IC8gb2JqZWN0LiBJZiBudWxsLCB0aGVuIHRoZSBkZWZhdWx0IGNvbnRlbnQgaXMgdXNlZCwgaWYgYQoJCSAqIGZ1bmN0aW9uIGlzIGdpdmVuIHRoZW4gdGhlIHJldHVybiBmcm9tIHRoZSBmdW5jdGlvbiBpcyB1c2VkLgoJCSAqICBAdHlwZSBmdW5jdGlvbnxpbnR8c3RyaW5nfG51bGwKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJtRGF0YVByb3AiOiBudWxsLAoJCQoJCS8qKgoJCSAqIFVuaXF1ZSBoZWFkZXIgVEgvVEQgZWxlbWVudCBmb3IgdGhpcyBjb2x1bW4gLSB0aGlzIGlzIHdoYXQgdGhlIHNvcnRpbmcKCQkgKiBsaXN0ZW5lciBpcyBhdHRhY2hlZCB0byAoaWYgc29ydGluZyBpcyBlbmFibGVkLikKCQkgKiAgQHR5cGUgbm9kZQoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJIm5UaCI6IG51bGwsCgkJCgkJLyoqCgkJICogVW5pcXVlIGZvb3RlciBUSC9URCBlbGVtZW50IGZvciB0aGlzIGNvbHVtbiAoaWYgdGhlcmUgaXMgb25lKS4gTm90IHVzZWQgCgkJICogaW4gRGF0YVRhYmxlcyBhcyBzdWNoLCBidXQgY2FuIGJlIHVzZWQgZm9yIHBsdWctaW5zIHRvIHJlZmVyZW5jZSB0aGUgCgkJICogZm9vdGVyIGZvciBlYWNoIGNvbHVtbi4KCQkgKiAgQHR5cGUgbm9kZQoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJIm5UZiI6IG51bGwsCgkJCgkJLyoqCgkJICogVGhlIGNsYXNzIHRvIGFwcGx5IHRvIGFsbCBURCBlbGVtZW50cyBpbiB0aGUgdGFibGUncyBUQk9EWSBmb3IgdGhlIGNvbHVtbgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJzQ2xhc3MiOiBudWxsLAoJCQoJCS8qKgoJCSAqIFdoZW4gRGF0YVRhYmxlcyBjYWxjdWxhdGVzIHRoZSBjb2x1bW4gd2lkdGhzIHRvIGFzc2lnbiB0byBlYWNoIGNvbHVtbiwKCQkgKiBpdCBmaW5kcyB0aGUgbG9uZ2VzdCBzdHJpbmcgaW4gZWFjaCBjb2x1bW4gYW5kIHRoZW4gY29uc3RydWN0cyBhCgkJICogdGVtcG9yYXJ5IHRhYmxlIGFuZCByZWFkcyB0aGUgd2lkdGhzIGZyb20gdGhhdC4gVGhlIHByb2JsZW0gd2l0aCB0aGlzCgkJICogaXMgdGhhdCAibW1tIiBpcyBtdWNoIHdpZGVyIHRoZW4gImlpaWkiLCBidXQgdGhlIGxhdHRlciBpcyBhIGxvbmdlciAKCQkgKiBzdHJpbmcgLSB0aHVzIHRoZSBjYWxjdWxhdGlvbiBjYW4gZ28gd3JvbmcgKGRvaW5nIGl0IHByb3Blcmx5IGFuZCBwdXR0aW5nCgkJICogaXQgaW50byBhbiBET00gb2JqZWN0IGFuZCBtZWFzdXJpbmcgdGhhdCBpcyBob3JyaWJseSghKSBzbG93KS4gVGh1cyBhcwoJCSAqIGEgIndvcmsgYXJvdW5kIiB3ZSBwcm92aWRlIHRoaXMgb3B0aW9uLiBJdCB3aWxsIGFwcGVuZCBpdHMgdmFsdWUgdG8gdGhlCgkJICogdGV4dCB0aGF0IGlzIGZvdW5kIHRvIGJlIHRoZSBsb25nZXN0IHN0cmluZyBmb3IgdGhlIGNvbHVtbiAtIGkuZS4gcGFkZGluZy4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICovCgkJInNDb250ZW50UGFkZGluZyI6IG51bGwsCgkJCgkJLyoqCgkJICogQWxsb3dzIGEgZGVmYXVsdCB2YWx1ZSB0byBiZSBnaXZlbiBmb3IgYSBjb2x1bW4ncyBkYXRhLCBhbmQgd2lsbCBiZSB1c2VkCgkJICogd2hlbmV2ZXIgYSBudWxsIGRhdGEgc291cmNlIGlzIGVuY291bnRlcmVkICh0aGlzIGNhbiBiZSBiZWNhdXNlIG1EYXRhUHJvcAoJCSAqIGlzIHNldCB0byBudWxsLCBvciBiZWNhdXNlIHRoZSBkYXRhIHNvdXJjZSBpdHNlbGYgaXMgbnVsbCkuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJInNEZWZhdWx0Q29udGVudCI6IG51bGwsCgkJCgkJLyoqCgkJICogTmFtZSBmb3IgdGhlIGNvbHVtbiwgYWxsb3dpbmcgcmVmZXJlbmNlIHRvIHRoZSBjb2x1bW4gYnkgbmFtZSBhcyB3ZWxsIGFzCgkJICogYnkgaW5kZXggKG5lZWRzIGEgbG9va3VwIHRvIHdvcmsgYnkgbmFtZSkuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqLwoJCSJzTmFtZSI6IG51bGwsCgkJCgkJLyoqCgkJICogQ3VzdG9tIHNvcnRpbmcgZGF0YSB0eXBlIC0gZGVmaW5lcyB3aGljaCBvZiB0aGUgYXZhaWxhYmxlIHBsdWctaW5zIGluCgkJICogYWZuU29ydERhdGEgdGhlIGN1c3RvbSBzb3J0aW5nIHdpbGwgdXNlIC0gaWYgYW55IGlzIGRlZmluZWQuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBzdGQKCQkgKi8KCQkic1NvcnREYXRhVHlwZSI6ICdzdGQnLAoJCQoJCS8qKgoJCSAqIENsYXNzIHRvIGJlIGFwcGxpZWQgdG8gdGhlIGhlYWRlciBlbGVtZW50IHdoZW4gc29ydGluZyBvbiB0aGlzIGNvbHVtbgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJzU29ydGluZ0NsYXNzIjogbnVsbCwKCQkKCQkvKioKCQkgKiBDbGFzcyB0byBiZSBhcHBsaWVkIHRvIHRoZSBoZWFkZXIgZWxlbWVudCB3aGVuIHNvcnRpbmcgb24gdGhpcyBjb2x1bW4gLQoJCSAqIHdoZW4galF1ZXJ5IFVJIHRoZW1pbmcgaXMgdXNlZC4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkic1NvcnRpbmdDbGFzc0pVSSI6IG51bGwsCgkJCgkJLyoqCgkJICogVGl0bGUgb2YgdGhlIGNvbHVtbiAtIHdoYXQgaXMgc2VlbiBpbiB0aGUgVEggZWxlbWVudCAoblRoKS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICovCgkJInNUaXRsZSI6IG51bGwsCgkJCgkJLyoqCgkJICogQ29sdW1uIHNvcnRpbmcgYW5kIGZpbHRlcmluZyB0eXBlCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJInNUeXBlIjogbnVsbCwKCQkKCQkvKioKCQkgKiBXaWR0aCBvZiB0aGUgY29sdW1uCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJInNXaWR0aCI6IG51bGwsCgkJCgkJLyoqCgkJICogV2lkdGggb2YgdGhlIGNvbHVtbiB3aGVuIGl0IHdhcyBmaXJzdCAiZW5jb3VudGVyZWQiCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJInNXaWR0aE9yaWciOiBudWxsCgl9OwoJCgkKCQoJLyoqCgkgKiBJbml0aWFsaXNhdGlvbiBvcHRpb25zIHRoYXQgY2FuIGJlIGdpdmVuIHRvIERhdGFUYWJsZXMgYXQgaW5pdGlhbGlzYXRpb24gCgkgKiB0aW1lLgoJICogIEBuYW1lc3BhY2UKCSAqLwoJRGF0YVRhYmxlLmRlZmF1bHRzID0gewoJCS8qKgoJCSAqIEFuIGFycmF5IG9mIGRhdGEgdG8gdXNlIGZvciB0aGUgdGFibGUsIHBhc3NlZCBpbiBhdCBpbml0aWFsaXNhdGlvbiB3aGljaCAKCQkgKiB3aWxsIGJlIHVzZWQgaW4gcHJlZmVyZW5jZSB0byBhbnkgZGF0YSB3aGljaCBpcyBhbHJlYWR5IGluIHRoZSBET00uIFRoaXMgaXMKCQkgKiBwYXJ0aWN1bGFybHkgdXNlZnVsIGZvciBjb25zdHJ1Y3RpbmcgdGFibGVzIHB1cmVseSBpbiBKYXZhc2NyaXB0LCBmb3IKCQkgKiBleGFtcGxlIHdpdGggYSBjdXN0b20gQWpheCBjYWxsLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBudWxsCgkJICogIEBkdG9wdCBPcHRpb24KCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhIDJEIGFycmF5IGRhdGEgc291cmNlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhYURhdGEiOiBbCgkJICogICAgICAgICAgWydUcmlkZW50JywgJ0ludGVybmV0IEV4cGxvcmVyIDQuMCcsICdXaW4gOTUrJywgNCwgJ1gnXSwKCQkgKiAgICAgICAgICBbJ1RyaWRlbnQnLCAnSW50ZXJuZXQgRXhwbG9yZXIgNS4wJywgJ1dpbiA5NSsnLCA1LCAnQyddLAoJCSAqICAgICAgICBdLAoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWwoJCSAqICAgICAgICAgIHsgInNUaXRsZSI6ICJFbmdpbmUiIH0sCgkJICogICAgICAgICAgeyAic1RpdGxlIjogIkJyb3dzZXIiIH0sCgkJICogICAgICAgICAgeyAic1RpdGxlIjogIlBsYXRmb3JtIiB9LAoJCSAqICAgICAgICAgIHsgInNUaXRsZSI6ICJWZXJzaW9uIiB9LAoJCSAqICAgICAgICAgIHsgInNUaXRsZSI6ICJHcmFkZSIgfQoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFuIGFycmF5IG9mIG9iamVjdHMgYXMgYSBkYXRhIHNvdXJjZSAobURhdGFQcm9wKQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYWFEYXRhIjogWwoJCSAqICAgICAgICAgIHsKCQkgKiAgICAgICAgICAgICJlbmdpbmUiOiAgICJUcmlkZW50IiwKCQkgKiAgICAgICAgICAgICJicm93c2VyIjogICJJbnRlcm5ldCBFeHBsb3JlciA0LjAiLAoJCSAqICAgICAgICAgICAgInBsYXRmb3JtIjogIldpbiA5NSsiLAoJCSAqICAgICAgICAgICAgInZlcnNpb24iOiAgNCwKCQkgKiAgICAgICAgICAgICJncmFkZSI6ICAgICJYIgoJCSAqICAgICAgICAgIH0sCgkJICogICAgICAgICAgewoJCSAqICAgICAgICAgICAgImVuZ2luZSI6ICAgIlRyaWRlbnQiLAoJCSAqICAgICAgICAgICAgImJyb3dzZXIiOiAgIkludGVybmV0IEV4cGxvcmVyIDUuMCIsCgkJICogICAgICAgICAgICAicGxhdGZvcm0iOiAiV2luIDk1KyIsCgkJICogICAgICAgICAgICAidmVyc2lvbiI6ICA1LAoJCSAqICAgICAgICAgICAgImdyYWRlIjogICAgIkMiCgkJICogICAgICAgICAgfQoJCSAqICAgICAgICBdLAoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWwoJCSAqICAgICAgICAgIHsgInNUaXRsZSI6ICJFbmdpbmUiLCAgICJtRGF0YVByb3AiOiAiZW5naW5lIiB9LAoJCSAqICAgICAgICAgIHsgInNUaXRsZSI6ICJCcm93c2VyIiwgICJtRGF0YVByb3AiOiAiYnJvd3NlciIgfSwKCQkgKiAgICAgICAgICB7ICJzVGl0bGUiOiAiUGxhdGZvcm0iLCAibURhdGFQcm9wIjogInBsYXRmb3JtIiB9LAoJCSAqICAgICAgICAgIHsgInNUaXRsZSI6ICJWZXJzaW9uIiwgICJtRGF0YVByb3AiOiAidmVyc2lvbiIgfSwKCQkgKiAgICAgICAgICB7ICJzVGl0bGUiOiAiR3JhZGUiLCAgICAibURhdGFQcm9wIjogImdyYWRlIiB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImFhRGF0YSI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIElmIHNvcnRpbmcgaXMgZW5hYmxlZCwgdGhlbiBEYXRhVGFibGVzIHdpbGwgcGVyZm9ybSBhIGZpcnN0IHBhc3Mgc29ydCBvbiAKCQkgKiBpbml0aWFsaXNhdGlvbi4gWW91IGNhbiBkZWZpbmUgd2hpY2ggY29sdW1uKHMpIHRoZSBzb3J0IGlzIHBlcmZvcm1lZCB1cG9uLCAKCQkgKiBhbmQgdGhlIHNvcnRpbmcgZGlyZWN0aW9uLCB3aXRoIHRoaXMgdmFyaWFibGUuIFRoZSBhYVNvcnRpbmcgYXJyYXkgc2hvdWxkIAoJCSAqIGNvbnRhaW4gYW4gYXJyYXkgZm9yIGVhY2ggY29sdW1uIHRvIGJlIHNvcnRlZCBpbml0aWFsbHkgY29udGFpbmluZyB0aGUgCgkJICogY29sdW1uJ3MgaW5kZXggYW5kIGEgZGlyZWN0aW9uIHN0cmluZyAoJ2FzYycgb3IgJ2Rlc2MnKS4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW1swLCdhc2MnXV0KCQkgKiAgQGR0b3B0IE9wdGlvbgoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFNvcnQgYnkgM3JkIGNvbHVtbiBmaXJzdCwgYW5kIHRoZW4gNHRoIGNvbHVtbgoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhYVNvcnRpbmciOiBbWzIsJ2FzYyddLCBbMywnZGVzYyddXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKiAgICAKCQkgKiAgICAvLyBObyBpbml0aWFsIHNvcnRpbmcKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYWFTb3J0aW5nIjogW10KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImFhU29ydGluZyI6IFtbMCwnYXNjJ11dLAoJCgkKCQkvKioKCQkgKiBUaGlzIHBhcmFtZXRlciBpcyBiYXNpY2FsbHkgaWRlbnRpY2FsIHRvIHRoZSBhYVNvcnRpbmcgcGFyYW1ldGVyLCBidXQgCgkJICogY2Fubm90IGJlIG92ZXJyaWRkZW4gYnkgdXNlciBpbnRlcmFjdGlvbiB3aXRoIHRoZSB0YWJsZS4gV2hhdCB0aGlzIG1lYW5zIAoJCSAqIGlzIHRoYXQgeW91IGNvdWxkIGhhdmUgYSBjb2x1bW4gKHZpc2libGUgb3IgaGlkZGVuKSB3aGljaCB0aGUgc29ydGluZyB3aWxsIAoJCSAqIGFsd2F5cyBiZSBmb3JjZWQgb24gZmlyc3QgLSBhbnkgc29ydGluZyBhZnRlciB0aGF0IChmcm9tIHRoZSB1c2VyKSB3aWxsIAoJCSAqIHRoZW4gYmUgcGVyZm9ybWVkIGFzIHJlcXVpcmVkLiBUaGlzIGNhbiBiZSB1c2VmdWwgZm9yIGdyb3VwaW5nIHJvd3MgCgkJICogdG9nZXRoZXIuCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IG51bGwKCQkgKiAgQGR0b3B0IE9wdGlvbgoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhYVNvcnRpbmdGaXhlZCI6IFtbMCwnYXNjJ11dCgkJICogICAgICB9ICk7CgkJICogICAgfSApCgkJICovCgkJImFhU29ydGluZ0ZpeGVkIjogbnVsbCwKCQoJCgkJLyoqCgkJICogVGhpcyBwYXJhbWV0ZXIgYWxsb3dzIHlvdSB0byByZWFkaWx5IHNwZWNpZnkgdGhlIGVudHJpZXMgaW4gdGhlIGxlbmd0aCBkcm9wCgkJICogZG93biBtZW51IHRoYXQgRGF0YVRhYmxlcyBzaG93cyB3aGVuIHBhZ2luYXRpb24gaXMgZW5hYmxlZC4gSXQgY2FuIGJlIAoJCSAqIGVpdGhlciBhIDFEIGFycmF5IG9mIG9wdGlvbnMgd2hpY2ggd2lsbCBiZSB1c2VkIGZvciBib3RoIHRoZSBkaXNwbGF5ZWQgCgkJICogb3B0aW9uIGFuZCB0aGUgdmFsdWUsIG9yIGEgMkQgYXJyYXkgd2hpY2ggd2lsbCB1c2UgdGhlIGFycmF5IGluIHRoZSBmaXJzdCAKCQkgKiBwb3NpdGlvbiBhcyB0aGUgdmFsdWUsIGFuZCB0aGUgYXJyYXkgaW4gdGhlIHNlY29uZCBwb3NpdGlvbiBhcyB0aGUgCgkJICogZGlzcGxheWVkIG9wdGlvbnMgKHVzZWZ1bCBmb3IgbGFuZ3VhZ2Ugc3RyaW5ncyBzdWNoIGFzICdBbGwnKS4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgWyAxMCwgMjUsIDUwLCAxMDAgXQoJCSAqICBAZHRvcHQgT3B0aW9uCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYUxlbmd0aE1lbnUiOiBbWzEwLCAyNSwgNTAsIC0xXSwgWzEwLCAyNSwgNTAsICJBbGwiXV0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFNldHRpbmcgdGhlIGRlZmF1bHQgZGlzcGxheSBsZW5ndGggYXMgd2VsbCBhcyBsZW5ndGggbWVudQoJCSAqICAgIC8vIFRoaXMgaXMgbGlrZWx5IHRvIGJlIHdhbnRlZCBpZiB5b3UgcmVtb3ZlIHRoZSAnMTAnIG9wdGlvbiB3aGljaAoJCSAqICAgIC8vIGlzIHRoZSBpRGlzcGxheUxlbmd0aCBkZWZhdWx0LgoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImlEaXNwbGF5TGVuZ3RoIjogMjUsCgkJICogICAgICAgICJhTGVuZ3RoTWVudSI6IFtbMjUsIDUwLCAxMDAsIC0xXSwgWzI1LCA1MCwgMTAwLCAiQWxsIl1dCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJhTGVuZ3RoTWVudSI6IFsgMTAsIDI1LCA1MCwgMTAwIF0sCgkKCQoJCS8qKgoJCSAqIFRoZSBhb0NvbHVtbnMgb3B0aW9uIGluIHRoZSBpbml0aWFsaXNhdGlvbiBwYXJhbWV0ZXIgYWxsb3dzIHlvdSB0byBkZWZpbmUKCQkgKiBkZXRhaWxzIGFib3V0IHRoZSB3YXkgaW5kaXZpZHVhbCBjb2x1bW5zIGJlaGF2ZS4gRm9yIGEgZnVsbCBsaXN0IG9mCgkJICogY29sdW1uIG9wdGlvbnMgdGhhdCBjYW4gYmUgc2V0LCBwbGVhc2Ugc2VlIAoJCSAqIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHMuY29sdW1uc30uIE5vdGUgdGhhdCBpZiB5b3UgdXNlIGFvQ29sdW1ucyB0bwoJCSAqIGRlZmluZSB5b3VyIGNvbHVtbnMsIHlvdSBtdXN0IGhhdmUgYW4gZW50cnkgaW4gdGhlIGFycmF5IGZvciBldmVyeSBzaW5nbGUKCQkgKiBjb2x1bW4gdGhhdCB5b3UgaGF2ZSBpbiB5b3VyIHRhYmxlICh0aGVzZSBjYW4gYmUgbnVsbCBpZiB5b3UgZG9uJ3Qgd2hpY2gKCQkgKiB0byBzcGVjaWZ5IGFueSBvcHRpb25zKS4KCQkgKiAgQG1lbWJlcgoJCSAqLwoJCSJhb0NvbHVtbnMiOiBudWxsLAoJCgkJLyoqCgkJICogVmVyeSBzaW1pbGFyIHRvIGFvQ29sdW1ucywgYW9Db2x1bW5EZWZzIGFsbG93cyB5b3UgdG8gdGFyZ2V0IGEgc3BlY2lmaWMgCgkJICogY29sdW1uLCBtdWx0aXBsZSBjb2x1bW5zLCBvciBhbGwgY29sdW1ucywgdXNpbmcgdGhlIGFUYXJnZXRzIHByb3BlcnR5IG9mIAoJCSAqIGVhY2ggb2JqZWN0IGluIHRoZSBhcnJheS4gVGhpcyBhbGxvd3MgZ3JlYXQgZmxleGliaWxpdHkgd2hlbiBjcmVhdGluZyAKCQkgKiB0YWJsZXMsIGFzIHRoZSBhb0NvbHVtbkRlZnMgYXJyYXlzIGNhbiBiZSBvZiBhbnkgbGVuZ3RoLCB0YXJnZXRpbmcgdGhlIAoJCSAqIGNvbHVtbnMgeW91IHNwZWNpZmljYWxseSB3YW50LiBhb0NvbHVtbkRlZnMgbWF5IHVzZSBhbnkgb2YgdGhlIGNvbHVtbiAKCQkgKiBvcHRpb25zIGF2YWlsYWJsZToge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0cy5jb2x1bW5zfSwgYnV0IGl0IF9tdXN0XwoJCSAqIGhhdmUgYVRhcmdldHMgZGVmaW5lZCBpbiBlYWNoIG9iamVjdCBpbiB0aGUgYXJyYXkuIFZhbHVlcyBpbiB0aGUgYVRhcmdldHMKCQkgKiBhcnJheSBtYXkgYmU6CgkJICogICA8dWw+CgkJICogICAgIDxsaT5hIHN0cmluZyAtIGNsYXNzIG5hbWUgd2lsbCBiZSBtYXRjaGVkIG9uIHRoZSBUSCBmb3IgdGhlIGNvbHVtbjwvbGk+CgkJICogICAgIDxsaT4wIG9yIGEgcG9zaXRpdmUgaW50ZWdlciAtIGNvbHVtbiBpbmRleCBjb3VudGluZyBmcm9tIHRoZSBsZWZ0PC9saT4KCQkgKiAgICAgPGxpPmEgbmVnYXRpdmUgaW50ZWdlciAtIGNvbHVtbiBpbmRleCBjb3VudGluZyBmcm9tIHRoZSByaWdodDwvbGk+CgkJICogICAgIDxsaT50aGUgc3RyaW5nICJfYWxsIiAtIGFsbCBjb2x1bW5zIChpLmUuIGFzc2lnbiBhIGRlZmF1bHQpPC9saT4KCQkgKiAgIDwvdWw+CgkJICogIEBtZW1iZXIKCQkgKi8KCQkiYW9Db2x1bW5EZWZzIjogbnVsbCwKCQoJCgkJLyoqCgkJICogQmFzaWNhbGx5IHRoZSBzYW1lIGFzIG9TZWFyY2gsIHRoaXMgcGFyYW1ldGVyIGRlZmluZXMgdGhlIGluZGl2aWR1YWwgY29sdW1uCgkJICogZmlsdGVyaW5nIHN0YXRlIGF0IGluaXRpYWxpc2F0aW9uIHRpbWUuIFRoZSBhcnJheSBtdXN0IGJlIG9mIHRoZSBzYW1lIHNpemUgCgkJICogYXMgdGhlIG51bWJlciBvZiBjb2x1bW5zLCBhbmQgZWFjaCBlbGVtZW50IGJlIGFuIG9iamVjdCB3aXRoIHRoZSBwYXJhbWV0ZXJzCgkJICogInNTZWFyY2giIGFuZCAiYkVzY2FwZVJlZ2V4IiAodGhlIGxhdHRlciBpcyBvcHRpb25hbCkuICdudWxsJyBpcyBhbHNvCgkJICogYWNjZXB0ZWQgYW5kIHRoZSBkZWZhdWx0IHdpbGwgYmUgdXNlZC4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKiAgQGR0b3B0IE9wdGlvbgoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb1NlYXJjaENvbHMiOiBbCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICB7ICJzU2VhcmNoIjogIk15IGZpbHRlciIgfSwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIHsgInNTZWFyY2giOiAiXlswLTldIiwgImJFc2NhcGVSZWdleCI6IGZhbHNlIH0KCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKQoJCSAqLwoJCSJhb1NlYXJjaENvbHMiOiBbXSwKCQoJCgkJLyoqCgkJICogQW4gYXJyYXkgb2YgQ1NTIGNsYXNzZXMgdGhhdCBzaG91bGQgYmUgYXBwbGllZCB0byBkaXNwbGF5ZWQgcm93cy4gVGhpcyAKCQkgKiBhcnJheSBtYXkgYmUgb2YgYW55IGxlbmd0aCwgYW5kIERhdGFUYWJsZXMgd2lsbCBhcHBseSBlYWNoIGNsYXNzIAoJCSAqIHNlcXVlbnRpYWxseSwgbG9vcGluZyB3aGVuIHJlcXVpcmVkLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBudWxsIDxpPldpbGwgdGFrZSB0aGUgdmFsdWVzIGRldGVybWludGVkIGJ5IHRoZSBvQ2xhc3Nlcy5zU3RyaXBlKgoJCSAqICAgIG9wdGlvbnM8L2k+CgkJICogIEBkdG9wdCBPcHRpb24KCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYXNTdHJpcGVDbGFzc2VzIjogWyAnc3RyaXAxJywgJ3N0cmlwMicsICdzdHJpcDMnIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICkKCQkgKi8KCQkiYXNTdHJpcGVDbGFzc2VzIjogbnVsbCwKCQoJCgkJLyoqCgkJICogRW5hYmxlIG9yIGRpc2FibGUgYXV0b21hdGljIGNvbHVtbiB3aWR0aCBjYWxjdWxhdGlvbi4gVGhpcyBjYW4gYmUgZGlzYWJsZWQKCQkgKiBhcyBhbiBvcHRpbWlzYXRpb24gKGl0IHRha2VzIHNvbWUgdGltZSB0byBjYWxjdWxhdGUgdGhlIHdpZHRocykgaWYgdGhlCgkJICogdGFibGVzIHdpZHRocyBhcmUgcGFzc2VkIGluIHVzaW5nIGFvQ29sdW1ucy4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCB0cnVlCgkJICogIEBkdG9wdCBGZWF0dXJlcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYkF1dG9XaWR0aCI6IGZhbHNlCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJiQXV0b1dpZHRoIjogdHJ1ZSwKCQoJCgkJLyoqCgkJICogRGVmZXJyZWQgcmVuZGVyaW5nIGNhbiBwcm92aWRlIERhdGFUYWJsZXMgd2l0aCBhIGh1Z2Ugc3BlZWQgYm9vc3Qgd2hlbiB5b3UKCQkgKiBhcmUgdXNpbmcgYW4gQWpheCBvciBKUyBkYXRhIHNvdXJjZSBmb3IgdGhlIHRhYmxlLiBUaGlzIG9wdGlvbiwgd2hlbiBzZXQgdG8KCQkgKiB0cnVlLCB3aWxsIGNhdXNlIERhdGFUYWJsZXMgdG8gZGVmZXIgdGhlIGNyZWF0aW9uIG9mIHRoZSB0YWJsZSBlbGVtZW50cyBmb3IKCQkgKiBlYWNoIHJvdyB1bnRpbCB0aGV5IGFyZSBuZWVkZWQgZm9yIGEgZHJhdyAtIHNhdmluZyBhIHNpZ25pZmljYW50IGFtb3VudCBvZgoJCSAqIHRpbWUuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkgKiAgQGR0b3B0IEZlYXR1cmVzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgInNBamF4U291cmNlIjogInNvdXJjZXMvYXJyYXlzLnR4dCIsCgkJICogICAgICAgICJiRGVmZXJSZW5kZXIiOiB0cnVlCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJiRGVmZXJSZW5kZXIiOiBmYWxzZSwKCQoJCgkJLyoqCgkJICogUmVwbGFjZSBhIERhdGFUYWJsZSB3aGljaCBtYXRjaGVzIHRoZSBnaXZlbiBzZWxlY3RvciBhbmQgcmVwbGFjZSBpdCB3aXRoIAoJCSAqIG9uZSB3aGljaCBoYXMgdGhlIHByb3BlcnRpZXMgb2YgdGhlIG5ldyBpbml0aWFsaXNhdGlvbiBvYmplY3QgcGFzc2VkLiBJZiBubwoJCSAqIHRhYmxlIG1hdGNoZXMgdGhlIHNlbGVjdG9yLCB0aGVuIHRoZSBuZXcgRGF0YVRhYmxlIHdpbGwgYmUgY29uc3RydWN0ZWQgYXMKCQkgKiBwZXIgbm9ybWFsLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IGZhbHNlCgkJICogIEBkdG9wdCBPcHRpb25zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic1Njcm9sbFkiOiAiMjAwcHgiLAoJCSAqICAgICAgICAiYlBhZ2luYXRlIjogZmFsc2UKCQkgKiAgICAgIH0gKTsKCQkgKiAgICAgIAoJCSAqICAgICAgLy8gU29tZSB0aW1lIGxhdGVyLi4uLgoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJGaWx0ZXIiOiBmYWxzZSwKCQkgKiAgICAgICAgImJEZXN0cm95IjogdHJ1ZQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYkRlc3Ryb3kiOiBmYWxzZSwKCQoJCgkJLyoqCgkJICogRW5hYmxlIG9yIGRpc2FibGUgZmlsdGVyaW5nIG9mIGRhdGEuIEZpbHRlcmluZyBpbiBEYXRhVGFibGVzIGlzICJzbWFydCIgaW4KCQkgKiB0aGF0IGl0IGFsbG93cyB0aGUgZW5kIHVzZXIgdG8gaW5wdXQgbXVsdGlwbGUgd29yZHMgKHNwYWNlIHNlcGFyYXRlZCkgYW5kCgkJICogd2lsbCBtYXRjaCBhIHJvdyBjb250YWluaW5nIHRob3NlIHdvcmRzLCBldmVuIGlmIG5vdCBpbiB0aGUgb3JkZXIgdGhhdCB3YXMKCQkgKiBzcGVjaWZpZWQgKHRoaXMgYWxsb3cgbWF0Y2hpbmcgYWNyb3NzIG11bHRpcGxlIGNvbHVtbnMpLiBOb3RlIHRoYXQgaWYgeW91CgkJICogd2lzaCB0byB1c2UgZmlsdGVyaW5nIGluIERhdGFUYWJsZXMgdGhpcyBtdXN0IHJlbWFpbiAndHJ1ZScgLSB0byByZW1vdmUgdGhlCgkJICogZGVmYXVsdCBmaWx0ZXJpbmcgaW5wdXQgYm94IGFuZCByZXRhaW4gZmlsdGVyaW5nIGFiaWxpdGllcywgcGxlYXNlIHVzZQoJCSAqIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHMuc0RvbX0uCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgdHJ1ZQoJCSAqICBAZHRvcHQgRmVhdHVyZXMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24gKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJGaWx0ZXIiOiBmYWxzZQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYkZpbHRlciI6IHRydWUsCgkKCQoJCS8qKgoJCSAqIEVuYWJsZSBvciBkaXNhYmxlIHRoZSB0YWJsZSBpbmZvcm1hdGlvbiBkaXNwbGF5LiBUaGlzIHNob3dzIGluZm9ybWF0aW9uIAoJCSAqIGFib3V0IHRoZSBkYXRhIHRoYXQgaXMgY3VycmVudGx5IHZpc2libGUgb24gdGhlIHBhZ2UsIGluY2x1ZGluZyBpbmZvcm1hdGlvbgoJCSAqIGFib3V0IGZpbHRlcmVkIGRhdGEgaWYgdGhhdCBhY3Rpb24gaXMgYmVpbmcgcGVyZm9ybWVkLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IHRydWUKCQkgKiAgQGR0b3B0IEZlYXR1cmVzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiSW5mbyI6IGZhbHNlCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJiSW5mbyI6IHRydWUsCgkKCQoJCS8qKgoJCSAqIEVuYWJsZSBqUXVlcnkgVUkgVGhlbWVSb2xsZXIgc3VwcG9ydCAocmVxdWlyZWQgYXMgVGhlbWVSb2xsZXIgcmVxdWlyZXMgc29tZQoJCSAqIHNsaWdodGx5IGRpZmZlcmVudCBhbmQgYWRkaXRpb25hbCBtYXJrLXVwIGZyb20gd2hhdCBEYXRhVGFibGVzIGhhcwoJCSAqIHRyYWRpdGlvbmFsbHkgdXNlZCkuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkgKiAgQGR0b3B0IEZlYXR1cmVzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJKUXVlcnlVSSI6IHRydWUKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImJKUXVlcnlVSSI6IGZhbHNlLAoJCgkKCQkvKioKCQkgKiBBbGxvd3MgdGhlIGVuZCB1c2VyIHRvIHNlbGVjdCB0aGUgc2l6ZSBvZiBhIGZvcm1hdHRlZCBwYWdlIGZyb20gYSBzZWxlY3QKCQkgKiBtZW51IChzaXplcyBhcmUgMTAsIDI1LCA1MCBhbmQgMTAwKS4gUmVxdWlyZXMgcGFnaW5hdGlvbiAoYlBhZ2luYXRlKS4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCB0cnVlCgkJICogIEBkdG9wdCBGZWF0dXJlcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYkxlbmd0aENoYW5nZSI6IGZhbHNlCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJiTGVuZ3RoQ2hhbmdlIjogdHJ1ZSwKCQoJCgkJLyoqCgkJICogRW5hYmxlIG9yIGRpc2FibGUgcGFnaW5hdGlvbi4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCB0cnVlCgkJICogIEBkdG9wdCBGZWF0dXJlcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYlBhZ2luYXRlIjogZmFsc2UKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImJQYWdpbmF0ZSI6IHRydWUsCgkKCQoJCS8qKgoJCSAqIEVuYWJsZSBvciBkaXNhYmxlIHRoZSBkaXNwbGF5IG9mIGEgJ3Byb2Nlc3NpbmcnIGluZGljYXRvciB3aGVuIHRoZSB0YWJsZSBpcwoJCSAqIGJlaW5nIHByb2Nlc3NlZCAoZS5nLiBhIHNvcnQpLiBUaGlzIGlzIHBhcnRpY3VsYXJseSB1c2VmdWwgZm9yIHRhYmxlcyB3aXRoCgkJICogbGFyZ2UgYW1vdW50cyBvZiBkYXRhIHdoZXJlIGl0IGNhbiB0YWtlIGEgbm90aWNlYWJsZSBhbW91bnQgb2YgdGltZSB0byBzb3J0CgkJICogdGhlIGVudHJpZXMuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkgKiAgQGR0b3B0IEZlYXR1cmVzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiUHJvY2Vzc2luZyI6IHRydWUKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImJQcm9jZXNzaW5nIjogZmFsc2UsCgkKCQoJCS8qKgoJCSAqIFJldHJpZXZlIHRoZSBEYXRhVGFibGVzIG9iamVjdCBmb3IgdGhlIGdpdmVuIHNlbGVjdG9yLiBOb3RlIHRoYXQgaWYgdGhlCgkJICogdGFibGUgaGFzIGFscmVhZHkgYmVlbiBpbml0aWFsaXNlZCwgdGhpcyBwYXJhbWV0ZXIgd2lsbCBjYXVzZSBEYXRhVGFibGVzCgkJICogdG8gc2ltcGx5IHJldHVybiB0aGUgb2JqZWN0IHRoYXQgaGFzIGFscmVhZHkgYmVlbiBzZXQgdXAgLSBpdCB3aWxsIG5vdCB0YWtlCgkJICogYWNjb3VudCBvZiBhbnkgY2hhbmdlcyB5b3UgbWlnaHQgaGF2ZSBtYWRlIHRvIHRoZSBpbml0aWFsaXNhdGlvbiBvYmplY3QKCQkgKiBwYXNzZWQgdG8gRGF0YVRhYmxlcyAoc2V0dGluZyB0aGlzIHBhcmFtZXRlciB0byB0cnVlIGlzIGFuIGFja25vd2xlZGdlbWVudAoJCSAqIHRoYXQgeW91IHVuZGVyc3RhbmQgdGhpcykuIGJEZXN0cm95IGNhbiBiZSB1c2VkIHRvIHJlaW5pdGlhbGlzZSBhIHRhYmxlIGlmCgkJICogeW91IG5lZWQuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIGluaXRUYWJsZSgpOwoJCSAqICAgICAgdGFibGVBY3Rpb25zKCk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICAgIGZ1bmN0aW9uIGluaXRUYWJsZSAoKQoJCSAqICAgIHsKCQkgKiAgICAgIHJldHVybiAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic1Njcm9sbFkiOiAiMjAwcHgiLAoJCSAqICAgICAgICAiYlBhZ2luYXRlIjogZmFsc2UsCgkJICogICAgICAgICJiUmV0cmlldmUiOiB0cnVlCgkJICogICAgICB9ICk7CgkJICogICAgfQoJCSAqICAgIAoJCSAqICAgIGZ1bmN0aW9uIHRhYmxlQWN0aW9ucyAoKQoJCSAqICAgIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSBpbml0VGFibGUoKTsKCQkgKiAgICAgIC8vIHBlcmZvcm0gQVBJIG9wZXJhdGlvbnMgd2l0aCBvVGFibGUgCgkJICogICAgfQoJCSAqLwoJCSJiUmV0cmlldmUiOiBmYWxzZSwKCQoJCgkJLyoqCgkJICogSW5kaWNhdGUgaWYgRGF0YVRhYmxlcyBzaG91bGQgYmUgYWxsb3dlZCB0byBzZXQgdGhlIHBhZGRpbmcgLyBtYXJnaW4KCQkgKiBldGMgZm9yIHRoZSBzY3JvbGxpbmcgaGVhZGVyIGVsZW1lbnRzIG9yIG5vdC4gVHlwaWNhbGx5IHlvdSB3aWxsIHdhbnQKCQkgKiB0aGlzLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IHRydWUKCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU2Nyb2xsQXV0b0NzcyI6IGZhbHNlLAoJCSAqICAgICAgICAic1Njcm9sbFkiOiAiMjAwcHgiCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJiU2Nyb2xsQXV0b0NzcyI6IHRydWUsCgkKCQoJCS8qKgoJCSAqIFdoZW4gdmVydGljYWwgKHkpIHNjcm9sbGluZyBpcyBlbmFibGVkLCBEYXRhVGFibGVzIHdpbGwgZm9yY2UgdGhlIGhlaWdodCBvZgoJCSAqIHRoZSB0YWJsZSdzIHZpZXdwb3J0IHRvIHRoZSBnaXZlbiBoZWlnaHQgYXQgYWxsIHRpbWVzICh1c2VmdWwgZm9yIGxheW91dCkuCgkJICogSG93ZXZlciwgdGhpcyBjYW4gbG9vayBvZGQgd2hlbiBmaWx0ZXJpbmcgZGF0YSBkb3duIHRvIGEgc21hbGwgZGF0YSBzZXQsCgkJICogYW5kIHRoZSBmb290ZXIgaXMgbGVmdCAiZmxvYXRpbmciIGZ1cnRoZXIgZG93bi4gVGhpcyBwYXJhbWV0ZXIgKHdoZW4KCQkgKiBlbmFibGVkKSB3aWxsIGNhdXNlIERhdGFUYWJsZXMgdG8gY29sbGFwc2UgdGhlIHRhYmxlJ3Mgdmlld3BvcnQgZG93biB3aGVuCgkJICogdGhlIHJlc3VsdCBzZXQgd2lsbCBmaXQgd2l0aGluIHRoZSBnaXZlbiBZIGhlaWdodC4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCBmYWxzZQoJCSAqICBAZHRvcHQgT3B0aW9ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgInNTY3JvbGxZIjogIjIwMCIsCgkJICogICAgICAgICJiU2Nyb2xsQ29sbGFwc2UiOiB0cnVlCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJiU2Nyb2xsQ29sbGFwc2UiOiBmYWxzZSwKCQoJCgkJLyoqCgkJICogRW5hYmxlIGluZmluaXRlIHNjcm9sbGluZyBmb3IgRGF0YVRhYmxlcyAodG8gYmUgdXNlZCBpbiBjb21iaW5hdGlvbiB3aXRoCgkJICogc1Njcm9sbFkpLiBJbmZpbml0ZSBzY3JvbGxpbmcgbWVhbnMgdGhhdCBEYXRhVGFibGVzIHdpbGwgY29udGludWFsbHkgbG9hZAoJCSAqIGRhdGEgYXMgYSB1c2VyIHNjcm9sbHMgdGhyb3VnaCBhIHRhYmxlLCB3aGljaCBpcyB2ZXJ5IHVzZWZ1bCBmb3IgbGFyZ2UKCQkgKiBkYXRhc2V0LiBUaGlzIGNhbm5vdCBiZSB1c2VkIHdpdGggcGFnaW5hdGlvbiwgd2hpY2ggaXMgYXV0b21hdGljYWxseQoJCSAqIGRpc2FibGVkLiBOb3RlIC0gdGhlIFNjcm9sbGVyIGV4dHJhIGZvciBEYXRhVGFibGVzIGlzIHJlY29tbWVuZGVkIGluCgkJICogaW4gcHJlZmVyZW5jZSB0byB0aGlzIG9wdGlvbi4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCBmYWxzZQoJCSAqICBAZHRvcHQgRmVhdHVyZXMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU2Nyb2xsSW5maW5pdGUiOiB0cnVlLAoJCSAqICAgICAgICAiYlNjcm9sbENvbGxhcHNlIjogdHJ1ZSwKCQkgKiAgICAgICAgInNTY3JvbGxZIjogIjIwMHB4IgoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYlNjcm9sbEluZmluaXRlIjogZmFsc2UsCgkKCQoJCS8qKgoJCSAqIENvbmZpZ3VyZSBEYXRhVGFibGVzIHRvIHVzZSBzZXJ2ZXItc2lkZSBwcm9jZXNzaW5nLiBOb3RlIHRoYXQgdGhlCgkJICogc0FqYXhTb3VyY2UgcGFyYW1ldGVyIG11c3QgYWxzbyBiZSBnaXZlbiBpbiBvcmRlciB0byBnaXZlIERhdGFUYWJsZXMgYQoJCSAqIHNvdXJjZSB0byBvYnRhaW4gdGhlIHJlcXVpcmVkIGRhdGEgZm9yIGVhY2ggZHJhdy4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCBmYWxzZQoJCSAqICBAZHRvcHQgRmVhdHVyZXMKCQkgKiAgQGR0b3B0IFNlcnZlci1zaWRlCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU2VydmVyU2lkZSI6IHRydWUsCgkJICogICAgICAgICJzQWpheFNvdXJjZSI6ICJ4aHIucGhwIgoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYlNlcnZlclNpZGUiOiBmYWxzZSwKCQoJCgkJLyoqCgkJICogRW5hYmxlIG9yIGRpc2FibGUgc29ydGluZyBvZiBjb2x1bW5zLiBTb3J0aW5nIG9mIGluZGl2aWR1YWwgY29sdW1ucyBjYW4gYmUKCQkgKiBkaXNhYmxlZCBieSB0aGUgImJTb3J0YWJsZSIgb3B0aW9uIGZvciBlYWNoIGNvbHVtbi4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCB0cnVlCgkJICogIEBkdG9wdCBGZWF0dXJlcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYlNvcnQiOiBmYWxzZQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYlNvcnQiOiB0cnVlLAoJCgkKCQkvKioKCQkgKiBBbGxvd3MgY29udHJvbCBvdmVyIHdoZXRoZXIgRGF0YVRhYmxlcyBzaG91bGQgdXNlIHRoZSB0b3AgKHRydWUpIHVuaXF1ZQoJCSAqIGNlbGwgdGhhdCBpcyBmb3VuZCBmb3IgYSBzaW5nbGUgY29sdW1uLCBvciB0aGUgYm90dG9tIChmYWxzZSAtIGRlZmF1bHQpLgoJCSAqIFRoaXMgaXMgdXNlZnVsIHdoZW4gdXNpbmcgY29tcGxleCBoZWFkZXJzLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IGZhbHNlCgkJICogIEBkdG9wdCBPcHRpb25zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYlNvcnRDZWxsc1RvcCI6IHRydWUKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImJTb3J0Q2VsbHNUb3AiOiBmYWxzZSwKCQoJCgkJLyoqCgkJICogRW5hYmxlIG9yIGRpc2FibGUgdGhlIGFkZGl0aW9uIG9mIHRoZSBjbGFzc2VzICdzb3J0aW5nXzEnLCAnc29ydGluZ18yJyBhbmQKCQkgKiAnc29ydGluZ18zJyB0byB0aGUgY29sdW1ucyB3aGljaCBhcmUgY3VycmVudGx5IGJlaW5nIHNvcnRlZCBvbi4gVGhpcyBpcwoJCSAqIHByZXNlbnRlZCBhcyBhIGZlYXR1cmUgc3dpdGNoIGFzIGl0IGNhbiBpbmNyZWFzZSBwcm9jZXNzaW5nIHRpbWUgKHdoaWxlCgkJICogY2xhc3NlcyBhcmUgcmVtb3ZlZCBhbmQgYWRkZWQpIHNvIGZvciBsYXJnZSBkYXRhIHNldHMgeW91IG1pZ2h0IHdhbnQgdG8KCQkgKiB0dXJuIHRoaXMgb2ZmLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IHRydWUKCQkgKiAgQGR0b3B0IEZlYXR1cmVzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU29ydENsYXNzZXMiOiBmYWxzZQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYlNvcnRDbGFzc2VzIjogdHJ1ZSwKCQoJCgkJLyoqCgkJICogRW5hYmxlIG9yIGRpc2FibGUgc3RhdGUgc2F2aW5nLiBXaGVuIGVuYWJsZWQgYSBjb29raWUgd2lsbCBiZSB1c2VkIHRvIHNhdmUKCQkgKiB0YWJsZSBkaXNwbGF5IGluZm9ybWF0aW9uIHN1Y2ggYXMgcGFnaW5hdGlvbiBpbmZvcm1hdGlvbiwgZGlzcGxheSBsZW5ndGgsCgkJICogZmlsdGVyaW5nIGFuZCBzb3J0aW5nLiBBcyBzdWNoIHdoZW4gdGhlIGVuZCB1c2VyIHJlbG9hZHMgdGhlIHBhZ2UgdGhlCgkJICogZGlzcGxheSBkaXNwbGF5IHdpbGwgbWF0Y2ggd2hhdCB0aHkgaGFkIHByZXZpb3VzbHkgc2V0IHVwLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IGZhbHNlCgkJICogIEBkdG9wdCBGZWF0dXJlcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYlN0YXRlU2F2ZSI6IHRydWUKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImJTdGF0ZVNhdmUiOiBmYWxzZSwKCQoJCgkJLyoqCgkJICogQ3VzdG9taXNlIHRoZSBjb29raWUgYW5kIC8gb3IgdGhlIHBhcmFtZXRlcnMgYmVpbmcgc3RvcmVkIHdoZW4gdXNpbmcKCQkgKiBEYXRhVGFibGVzIHdpdGggc3RhdGUgc2F2aW5nIGVuYWJsZWQuIFRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIHdoZW5ldmVyCgkJICogdGhlIGNvb2tpZSBpcyBtb2RpZmllZCwgYW5kIGl0IGV4cGVjdHMgYSBmdWxseSBmb3JtZWQgY29va2llIHN0cmluZyB0byBiZQoJCSAqIHJldHVybmVkLiBOb3RlIHRoYXQgdGhlIGRhdGEgb2JqZWN0IHBhc3NlZCBpbiBpcyBhIEphdmFzY3JpcHQgb2JqZWN0IHdoaWNoCgkJICogbXVzdCBiZSBjb252ZXJ0ZWQgdG8gYSBzdHJpbmcgKEpTT04uc3RyaW5naWZ5IGZvciBleGFtcGxlKS4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNOYW1lIE5hbWUgb2YgdGhlIGNvb2tpZSBkZWZpbmVkIGJ5IERhdGFUYWJsZXMKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9EYXRhIERhdGEgdG8gYmUgc3RvcmVkIGluIHRoZSBjb29raWUKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNFeHBpcmVzIENvb2tpZSBleHBpcmVzIHN0cmluZwoJCSAqICBAcGFyYW0ge3N0cmluZ30gc1BhdGggUGF0aCBvZiB0aGUgY29va2llIHRvIHNldAoJCSAqICBAcmV0dXJucyB7c3RyaW5nfSBDb29raWUgZm9ybWF0dGVkIHN0cmluZyAod2hpY2ggc2hvdWxkIGJlIGVuY29kZWQgYnkKCQkgKiAgICB1c2luZyBlbmNvZGVVUklDb21wb25lbnQoKSkKCQkgKiAgQGR0b3B0IENhbGxiYWNrcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiZm5Db29raWVDYWxsYmFjayI6IGZ1bmN0aW9uIChzTmFtZSwgb0RhdGEsIHNFeHBpcmVzLCBzUGF0aCkgewoJCSAqICAgICAgICAgIC8vIEN1c3RvbWlzZSBvRGF0YSBvciBzTmFtZSBvciB3aGF0ZXZlciBlbHNlIGhlcmUKCQkgKiAgICAgICAgICByZXR1cm4gc05hbWUgKyAiPSIrSlNPTi5zdHJpbmdpZnkob0RhdGEpKyI7IGV4cGlyZXM9IiArIHNFeHBpcmVzICsiOyBwYXRoPSIgKyBzUGF0aDsKCQkgKiAgICAgICAgfQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiZm5Db29raWVDYWxsYmFjayI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIFRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIHdoZW4gYSBUUiBlbGVtZW50IGlzIGNyZWF0ZWQgKGFuZCBhbGwgVEQgY2hpbGQKCQkgKiBlbGVtZW50cyBoYXZlIGJlZW4gaW5zZXJ0ZWQpLCBvciByZWdpc3RlcmVkIGlmIHVzaW5nIGEgRE9NIHNvdXJjZSwgYWxsb3dpbmcKCQkgKiBtYW5pcHVsYXRpb24gb2YgdGhlIFRSIGVsZW1lbnQgKGFkZGluZyBjbGFzc2VzIGV0YykuCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7bm9kZX0gblJvdyAiVFIiIGVsZW1lbnQgZm9yIHRoZSBjdXJyZW50IHJvdwoJCSAqICBAcGFyYW0ge2FycmF5fSBhRGF0YSBSYXcgZGF0YSBhcnJheSBmb3IgdGhpcyByb3cKCQkgKiAgQHBhcmFtIHtpbnR9IGlEYXRhSW5kZXggVGhlIGluZGV4IG9mIHRoaXMgcm93IGluIGFvRGF0YQoJCSAqICBAZHRvcHQgQ2FsbGJhY2tzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiZm5DcmVhdGVkUm93IjogZnVuY3Rpb24oIG5Sb3csIGFEYXRhLCBpRGF0YUluZGV4ICkgewoJCSAqICAgICAgICAgIC8vIEJvbGQgdGhlIGdyYWRlIGZvciBhbGwgJ0EnIGdyYWRlIGJyb3dzZXJzCgkJICogICAgICAgICAgaWYgKCBhRGF0YVs0XSA9PSAiQSIgKQoJCSAqICAgICAgICAgIHsKCQkgKiAgICAgICAgICAgICQoJ3RkOmVxKDQpJywgblJvdykuaHRtbCggJzxiPkE8L2I+JyApOwoJCSAqICAgICAgICAgIH0KCQkgKiAgICAgICAgfQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiZm5DcmVhdGVkUm93IjogbnVsbCwKCQoJCgkJLyoqCgkJICogVGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgb24gZXZlcnkgJ2RyYXcnIGV2ZW50LCBhbmQgYWxsb3dzIHlvdSB0bwoJCSAqIGR5bmFtaWNhbGx5IG1vZGlmeSBhbnkgYXNwZWN0IHlvdSB3YW50IGFib3V0IHRoZSBjcmVhdGVkIERPTS4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAZHRvcHQgQ2FsbGJhY2tzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImZuRHJhd0NhbGxiYWNrIjogZnVuY3Rpb24oIG9TZXR0aW5ncyApIHsKCQkgKiAgICAgICAgICBhbGVydCggJ0RhdGFUYWJsZXMgaGFzIHJlZHJhd24gdGhlIHRhYmxlJyApOwoJCSAqICAgICAgICB9CgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJmbkRyYXdDYWxsYmFjayI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIElkZW50aWNhbCB0byBmbkhlYWRlckNhbGxiYWNrKCkgYnV0IGZvciB0aGUgdGFibGUgZm9vdGVyIHRoaXMgZnVuY3Rpb24KCQkgKiBhbGxvd3MgeW91IHRvIG1vZGlmeSB0aGUgdGFibGUgZm9vdGVyIG9uIGV2ZXJ5ICdkcmF3JyBldmVuLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAcGFyYW0ge25vZGV9IG5Gb290ICJUUiIgZWxlbWVudCBmb3IgdGhlIGZvb3RlcgoJCSAqICBAcGFyYW0ge2FycmF5fSBhRGF0YSBGdWxsIHRhYmxlIGRhdGEgKGFzIGRlcml2ZWQgZnJvbSB0aGUgb3JpZ2luYWwgSFRNTCkKCQkgKiAgQHBhcmFtIHtpbnR9IGlTdGFydCBJbmRleCBmb3IgdGhlIGN1cnJlbnQgZGlzcGxheSBzdGFydGluZyBwb2ludCBpbiB0aGUgCgkJICogICAgZGlzcGxheSBhcnJheQoJCSAqICBAcGFyYW0ge2ludH0gaUVuZCBJbmRleCBmb3IgdGhlIGN1cnJlbnQgZGlzcGxheSBlbmRpbmcgcG9pbnQgaW4gdGhlIAoJCSAqICAgIGRpc3BsYXkgYXJyYXkKCQkgKiAgQHBhcmFtIHthcnJheSBpbnR9IGFpRGlzcGxheSBJbmRleCBhcnJheSB0byB0cmFuc2xhdGUgdGhlIHZpc3VhbCBwb3NpdGlvbgoJCSAqICAgIHRvIHRoZSBmdWxsIGRhdGEgYXJyYXkKCQkgKiAgQGR0b3B0IENhbGxiYWNrcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJmbkZvb3RlckNhbGxiYWNrIjogZnVuY3Rpb24oIG5Gb290LCBhRGF0YSwgaVN0YXJ0LCBpRW5kLCBhaURpc3BsYXkgKSB7CgkJICogICAgICAgICAgbkZvb3QuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RoJylbMF0uaW5uZXJIVE1MID0gIlN0YXJ0aW5nIGluZGV4IGlzICIraVN0YXJ0OwoJCSAqICAgICAgICB9CgkJICogICAgICB9ICk7CgkJICogICAgfSApCgkJICovCgkJImZuRm9vdGVyQ2FsbGJhY2siOiBudWxsLAoJCgkKCQkvKioKCQkgKiBXaGVuIHJlbmRlcmluZyBsYXJnZSBudW1iZXJzIGluIHRoZSBpbmZvcm1hdGlvbiBlbGVtZW50IGZvciB0aGUgdGFibGUKCQkgKiAoaS5lLiAiU2hvd2luZyAxIHRvIDEwIG9mIDU3IGVudHJpZXMiKSBEYXRhVGFibGVzIHdpbGwgcmVuZGVyIGxhcmdlIG51bWJlcnMKCQkgKiB0byBoYXZlIGEgY29tbWEgc2VwYXJhdG9yIGZvciB0aGUgJ3Rob3VzYW5kcycgdW5pdHMgKGUuZy4gMSBtaWxsaW9uIGlzCgkJICogcmVuZGVyZWQgYXMgIjEsMDAwLDAwMCIpIHRvIGhlbHAgcmVhZGFiaWxpdHkgZm9yIHRoZSBlbmQgdXNlci4gVGhpcwoJCSAqIGZ1bmN0aW9uIHdpbGwgb3ZlcnJpZGUgdGhlIGRlZmF1bHQgbWV0aG9kIERhdGFUYWJsZXMgdXNlcy4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQG1lbWJlcgoJCSAqICBAcGFyYW0ge2ludH0gaUluIG51bWJlciB0byBiZSBmb3JtYXR0ZWQKCQkgKiAgQHJldHVybnMge3N0cmluZ30gZm9ybWF0dGVkIHN0cmluZyBmb3IgRGF0YVRhYmxlcyB0byBzaG93IHRoZSBudW1iZXIKCQkgKiAgQGR0b3B0IENhbGxiYWNrcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImZuRm9ybWF0TnVtYmVyIjogZnVuY3Rpb24gKCBpSW4gKSB7CgkJICogICAgICAgICAgaWYgKCBpSW4gJmx0OyAxMDAwICkgewoJCSAqICAgICAgICAgICAgcmV0dXJuIGlJbjsKCQkgKiAgICAgICAgICB9IGVsc2UgewoJCSAqICAgICAgICAgICAgdmFyIAoJCSAqICAgICAgICAgICAgICBzPShpSW4rIiIpLCAKCQkgKiAgICAgICAgICAgICAgYT1zLnNwbGl0KCIiKSwgb3V0PSIiLCAKCQkgKiAgICAgICAgICAgICAgaUxlbj1zLmxlbmd0aDsKCQkgKiAgICAgICAgICAgIAoJCSAqICAgICAgICAgICAgZm9yICggdmFyIGk9MCA7IGkmbHQ7aUxlbiA7IGkrKyApIHsKCQkgKiAgICAgICAgICAgICAgaWYgKCBpJTMgPT09IDAgJmFtcDsmYW1wOyBpICE9PSAwICkgewoJCSAqICAgICAgICAgICAgICAgIG91dCA9ICInIitvdXQ7CgkJICogICAgICAgICAgICAgIH0KCQkgKiAgICAgICAgICAgICAgb3V0ID0gYVtpTGVuLWktMV0rb3V0OwoJCSAqICAgICAgICAgICAgfQoJCSAqICAgICAgICAgIH0KCQkgKiAgICAgICAgICByZXR1cm4gb3V0OwoJCSAqICAgICAgICB9OwoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiZm5Gb3JtYXROdW1iZXIiOiBmdW5jdGlvbiAoIGlJbiApIHsKCQkJaWYgKCBpSW4gPCAxMDAwICkKCQkJewoJCQkJLy8gQSBzbWFsbCBvcHRpbWlzYXRpb24gZm9yIHdoYXQgaXMgbGlrZWx5IHRvIGJlIHRoZSBtYWpvcml0eSBvZiB1c2UgY2FzZXMKCQkJCXJldHVybiBpSW47CgkJCX0KCQoJCQl2YXIgcz0oaUluKyIiKSwgYT1zLnNwbGl0KCIiKSwgb3V0PSIiLCBpTGVuPXMubGVuZ3RoOwoJCQkKCQkJZm9yICggdmFyIGk9MCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWlmICggaSUzID09PSAwICYmIGkgIT09IDAgKQoJCQkJewoJCQkJCW91dCA9IHRoaXMub0xhbmd1YWdlLnNJbmZvVGhvdXNhbmRzK291dDsKCQkJCX0KCQkJCW91dCA9IGFbaUxlbi1pLTFdK291dDsKCQkJfQoJCQlyZXR1cm4gb3V0OwoJCX0sCgkKCQoJCS8qKgoJCSAqIFRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIG9uIGV2ZXJ5ICdkcmF3JyBldmVudCwgYW5kIGFsbG93cyB5b3UgdG8KCQkgKiBkeW5hbWljYWxseSBtb2RpZnkgdGhlIGhlYWRlciByb3cuIFRoaXMgY2FuIGJlIHVzZWQgdG8gY2FsY3VsYXRlIGFuZAoJCSAqIGRpc3BsYXkgdXNlZnVsIGluZm9ybWF0aW9uIGFib3V0IHRoZSB0YWJsZS4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHtub2RlfSBuSGVhZCAiVFIiIGVsZW1lbnQgZm9yIHRoZSBoZWFkZXIKCQkgKiAgQHBhcmFtIHthcnJheX0gYURhdGEgRnVsbCB0YWJsZSBkYXRhIChhcyBkZXJpdmVkIGZyb20gdGhlIG9yaWdpbmFsIEhUTUwpCgkJICogIEBwYXJhbSB7aW50fSBpU3RhcnQgSW5kZXggZm9yIHRoZSBjdXJyZW50IGRpc3BsYXkgc3RhcnRpbmcgcG9pbnQgaW4gdGhlCgkJICogICAgZGlzcGxheSBhcnJheQoJCSAqICBAcGFyYW0ge2ludH0gaUVuZCBJbmRleCBmb3IgdGhlIGN1cnJlbnQgZGlzcGxheSBlbmRpbmcgcG9pbnQgaW4gdGhlCgkJICogICAgZGlzcGxheSBhcnJheQoJCSAqICBAcGFyYW0ge2FycmF5IGludH0gYWlEaXNwbGF5IEluZGV4IGFycmF5IHRvIHRyYW5zbGF0ZSB0aGUgdmlzdWFsIHBvc2l0aW9uCgkJICogICAgdG8gdGhlIGZ1bGwgZGF0YSBhcnJheQoJCSAqICBAZHRvcHQgQ2FsbGJhY2tzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImZuSGVhZGVyQ2FsbGJhY2siOiBmdW5jdGlvbiggbkhlYWQsIGFEYXRhLCBpU3RhcnQsIGlFbmQsIGFpRGlzcGxheSApIHsKCQkgKiAgICAgICAgICBuSGVhZC5nZXRFbGVtZW50c0J5VGFnTmFtZSgndGgnKVswXS5pbm5lckhUTUwgPSAiRGlzcGxheWluZyAiKyhpRW5kLWlTdGFydCkrIiByZWNvcmRzIjsKCQkgKiAgICAgICAgfQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKQoJCSAqLwoJCSJmbkhlYWRlckNhbGxiYWNrIjogbnVsbCwKCQoJCgkJLyoqCgkJICogVGhlIGluZm9ybWF0aW9uIGVsZW1lbnQgY2FuIGJlIHVzZWQgdG8gY29udmV5IGluZm9ybWF0aW9uIGFib3V0IHRoZSBjdXJyZW50CgkJICogc3RhdGUgb2YgdGhlIHRhYmxlLiBBbHRob3VnaCB0aGUgaW50ZXJuYXRpb25hbGlzYXRpb24gb3B0aW9ucyBwcmVzZW50ZWQgYnkKCQkgKiBEYXRhVGFibGVzIGFyZSBxdWl0ZSBjYXBhYmxlIG9mIGRlYWxpbmcgd2l0aCBtb3N0IGN1c3RvbWlzYXRpb25zLCB0aGVyZSBtYXkKCQkgKiBiZSB0aW1lcyB3aGVyZSB5b3Ugd2lzaCB0byBjdXN0b21pc2UgdGhlIHN0cmluZyBmdXJ0aGVyLiBUaGlzIGNhbGxiYWNrCgkJICogYWxsb3dzIHlvdSB0byBkbyBleGFjdGx5IHRoYXQuCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtpbnR9IGlTdGFydCBTdGFydGluZyBwb3NpdGlvbiBpbiBkYXRhIGZvciB0aGUgZHJhdwoJCSAqICBAcGFyYW0ge2ludH0gaUVuZCBFbmQgcG9zaXRpb24gaW4gZGF0YSBmb3IgdGhlIGRyYXcKCQkgKiAgQHBhcmFtIHtpbnR9IGlNYXggVG90YWwgbnVtYmVyIG9mIHJvd3MgaW4gdGhlIHRhYmxlIChyZWdhcmRsZXNzIG9mCgkJICogICAgZmlsdGVyaW5nKQoJCSAqICBAcGFyYW0ge2ludH0gaVRvdGFsIFRvdGFsIG51bWJlciBvZiByb3dzIGluIHRoZSBkYXRhIHNldCwgYWZ0ZXIgZmlsdGVyaW5nCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzUHJlIFRoZSBzdHJpbmcgdGhhdCBEYXRhVGFibGVzIGhhcyBmb3JtYXR0ZWQgdXNpbmcgaXQncwoJCSAqICAgIG93biBydWxlcwoJCSAqICBAcmV0dXJucyB7c3RyaW5nfSBUaGUgc3RyaW5nIHRvIGJlIGRpc3BsYXllZCBpbiB0aGUgaW5mb3JtYXRpb24gZWxlbWVudC4KCQkgKiAgQGR0b3B0IENhbGxiYWNrcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAiZm5JbmZvQ2FsbGJhY2siOiBmdW5jdGlvbiggb1NldHRpbmdzLCBpU3RhcnQsIGlFbmQsIGlNYXgsIGlUb3RhbCwgc1ByZSApIHsKCQkgKiAgICAgICAgcmV0dXJuIGlTdGFydCArIiB0byAiKyBpRW5kOwoJCSAqICAgICAgfQoJCSAqICAgIH0gKTsKCQkgKi8KCQkiZm5JbmZvQ2FsbGJhY2siOiBudWxsLAoJCgkKCQkvKioKCQkgKiBDYWxsZWQgd2hlbiB0aGUgdGFibGUgaGFzIGJlZW4gaW5pdGlhbGlzZWQuIE5vcm1hbGx5IERhdGFUYWJsZXMgd2lsbAoJCSAqIGluaXRpYWxpc2Ugc2VxdWVudGlhbGx5IGFuZCB0aGVyZSB3aWxsIGJlIG5vIG5lZWQgZm9yIHRoaXMgZnVuY3Rpb24sCgkJICogaG93ZXZlciwgdGhpcyBkb2VzIG5vdCBob2xkIHRydWUgd2hlbiB1c2luZyBleHRlcm5hbCBsYW5ndWFnZSBpbmZvcm1hdGlvbgoJCSAqIHNpbmNlIHRoYXQgaXMgb2J0YWluZWQgdXNpbmcgYW4gYXN5bmMgWEhSIGNhbGwuCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtvYmplY3R9IGpzb24gVGhlIEpTT04gb2JqZWN0IHJlcXVlc3QgZnJvbSB0aGUgc2VydmVyIC0gb25seQoJCSAqICAgIHByZXNlbnQgaWYgY2xpZW50LXNpZGUgQWpheCBzb3VyY2VkIGRhdGEgaXMgdXNlZAoJCSAqICBAZHRvcHQgQ2FsbGJhY2tzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImZuSW5pdENvbXBsZXRlIjogZnVuY3Rpb24ob1NldHRpbmdzLCBqc29uKSB7CgkJICogICAgICAgICAgYWxlcnQoICdEYXRhVGFibGVzIGhhcyBmaW5pc2hlZCBpdHMgaW5pdGlhbGlzYXRpb24uJyApOwoJCSAqICAgICAgICB9CgkJICogICAgICB9ICk7CgkJICogICAgfSApCgkJICovCgkJImZuSW5pdENvbXBsZXRlIjogbnVsbCwKCQoJCgkJLyoqCgkJICogQ2FsbGVkIGF0IHRoZSB2ZXJ5IHN0YXJ0IG9mIGVhY2ggdGFibGUgZHJhdyBhbmQgY2FuIGJlIHVzZWQgdG8gY2FuY2VsIHRoZQoJCSAqIGRyYXcgYnkgcmV0dXJuaW5nIGZhbHNlLCBhbnkgb3RoZXIgcmV0dXJuIChpbmNsdWRpbmcgdW5kZWZpbmVkKSByZXN1bHRzIGluCgkJICogdGhlIGZ1bGwgZHJhdyBvY2N1cnJpbmcpLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEByZXR1cm5zIHtib29sZWFufSBGYWxzZSB3aWxsIGNhbmNlbCB0aGUgZHJhdywgYW55dGhpbmcgZWxzZSAoaW5jbHVkaW5nIG5vCgkJICogICAgcmV0dXJuKSB3aWxsIGFsbG93IGl0IHRvIGNvbXBsZXRlLgoJCSAqICBAZHRvcHQgQ2FsbGJhY2tzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImZuUHJlRHJhd0NhbGxiYWNrIjogZnVuY3Rpb24oIG9TZXR0aW5ncyApIHsKCQkgKiAgICAgICAgICBpZiAoICQoJyN0ZXN0JykudmFsKCkgPT0gMSApIHsKCQkgKiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCQkgKiAgICAgICAgICB9CgkJICogICAgICAgIH0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImZuUHJlRHJhd0NhbGxiYWNrIjogbnVsbCwKCQoJCgkJLyoqCgkJICogVGhpcyBmdW5jdGlvbiBhbGxvd3MgeW91IHRvICdwb3N0IHByb2Nlc3MnIGVhY2ggcm93IGFmdGVyIGl0IGhhdmUgYmVlbgoJCSAqIGdlbmVyYXRlZCBmb3IgZWFjaCB0YWJsZSBkcmF3LCBidXQgYmVmb3JlIGl0IGlzIHJlbmRlcmVkIG9uIHNjcmVlbi4gVGhpcwoJCSAqIGZ1bmN0aW9uIG1pZ2h0IGJlIHVzZWQgZm9yIHNldHRpbmcgdGhlIHJvdyBjbGFzcyBuYW1lIGV0Yy4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHtub2RlfSBuUm93ICJUUiIgZWxlbWVudCBmb3IgdGhlIGN1cnJlbnQgcm93CgkJICogIEBwYXJhbSB7YXJyYXl9IGFEYXRhIFJhdyBkYXRhIGFycmF5IGZvciB0aGlzIHJvdwoJCSAqICBAcGFyYW0ge2ludH0gaURpc3BsYXlJbmRleCBUaGUgZGlzcGxheSBpbmRleCBmb3IgdGhlIGN1cnJlbnQgdGFibGUgZHJhdwoJCSAqICBAcGFyYW0ge2ludH0gaURpc3BsYXlJbmRleEZ1bGwgVGhlIGluZGV4IG9mIHRoZSBkYXRhIGluIHRoZSBmdWxsIGxpc3Qgb2YKCQkgKiAgICByb3dzIChhZnRlciBmaWx0ZXJpbmcpCgkJICogIEBkdG9wdCBDYWxsYmFja3MKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJmblJvd0NhbGxiYWNrIjogZnVuY3Rpb24oIG5Sb3csIGFEYXRhLCBpRGlzcGxheUluZGV4LCBpRGlzcGxheUluZGV4RnVsbCApIHsKCQkgKiAgICAgICAgICAvLyBCb2xkIHRoZSBncmFkZSBmb3IgYWxsICdBJyBncmFkZSBicm93c2VycwoJCSAqICAgICAgICAgIGlmICggYURhdGFbNF0gPT0gIkEiICkKCQkgKiAgICAgICAgICB7CgkJICogICAgICAgICAgICAkKCd0ZDplcSg0KScsIG5Sb3cpLmh0bWwoICc8Yj5BPC9iPicgKTsKCQkgKiAgICAgICAgICB9CgkJICogICAgICAgIH0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImZuUm93Q2FsbGJhY2siOiBudWxsLAoJCgkKCQkvKioKCQkgKiBUaGlzIHBhcmFtZXRlciBhbGxvd3MgeW91IHRvIG92ZXJyaWRlIHRoZSBkZWZhdWx0IGZ1bmN0aW9uIHdoaWNoIG9idGFpbnMKCQkgKiB0aGUgZGF0YSBmcm9tIHRoZSBzZXJ2ZXIgKCQuZ2V0SlNPTikgc28gc29tZXRoaW5nIG1vcmUgc3VpdGFibGUgZm9yIHlvdXIKCQkgKiBhcHBsaWNhdGlvbi4gRm9yIGV4YW1wbGUgeW91IGNvdWxkIHVzZSBQT1NUIGRhdGEsIG9yIHB1bGwgaW5mb3JtYXRpb24gZnJvbQoJCSAqIGEgR2VhcnMgb3IgQUlSIGRhdGFiYXNlLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAbWVtYmVyCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzU291cmNlIEhUVFAgc291cmNlIHRvIG9idGFpbiB0aGUgZGF0YSBmcm9tIChzQWpheFNvdXJjZSkKCQkgKiAgQHBhcmFtIHthcnJheX0gYW9EYXRhIEEga2V5L3ZhbHVlIHBhaXIgb2JqZWN0IGNvbnRhaW5pbmcgdGhlIGRhdGEgdG8gc2VuZAoJCSAqICAgIHRvIHRoZSBzZXJ2ZXIKCQkgKiAgQHBhcmFtIHtmdW5jdGlvbn0gZm5DYWxsYmFjayB0byBiZSBjYWxsZWQgb24gY29tcGxldGlvbiBvZiB0aGUgZGF0YSBnZXQKCQkgKiAgICBwcm9jZXNzIHRoYXQgd2lsbCBkcmF3IHRoZSBkYXRhIG9uIHRoZSBwYWdlLgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBkdG9wdCBDYWxsYmFja3MKCQkgKiAgQGR0b3B0IFNlcnZlci1zaWRlCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gUE9TVCBkYXRhIHRvIHNlcnZlcgoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJQcm9jZXNzaW5nIjogdHJ1ZSwKCQkgKiAgICAgICAgImJTZXJ2ZXJTaWRlIjogdHJ1ZSwKCQkgKiAgICAgICAgInNBamF4U291cmNlIjogInhoci5waHAiLAoJCSAqICAgICAgICAiZm5TZXJ2ZXJEYXRhIjogZnVuY3Rpb24gKCBzU291cmNlLCBhb0RhdGEsIGZuQ2FsbGJhY2ssIG9TZXR0aW5ncyApIHsKCQkgKiAgICAgICAgICBvU2V0dGluZ3MuanFYSFIgPSAkLmFqYXgoIHsKCQkgKiAgICAgICAgICAgICJkYXRhVHlwZSI6ICdqc29uJywgCgkJICogICAgICAgICAgICAidHlwZSI6ICJQT1NUIiwgCgkJICogICAgICAgICAgICAidXJsIjogc1NvdXJjZSwgCgkJICogICAgICAgICAgICAiZGF0YSI6IGFvRGF0YSwgCgkJICogICAgICAgICAgICAic3VjY2VzcyI6IGZuQ2FsbGJhY2sKCQkgKiAgICAgICAgICB9ICk7CgkJICogICAgICAgIH0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImZuU2VydmVyRGF0YSI6IGZ1bmN0aW9uICggc1VybCwgYW9EYXRhLCBmbkNhbGxiYWNrLCBvU2V0dGluZ3MgKSB7CgkJCW9TZXR0aW5ncy5qcVhIUiA9ICQuYWpheCggewoJCQkJInVybCI6ICBzVXJsLAoJCQkJImRhdGEiOiBhb0RhdGEsCgkJCQkic3VjY2VzcyI6IGZ1bmN0aW9uIChqc29uKSB7CgkJCQkJJChvU2V0dGluZ3Mub0luc3RhbmNlKS50cmlnZ2VyKCd4aHInLCBvU2V0dGluZ3MpOwoJCQkJCWZuQ2FsbGJhY2soIGpzb24gKTsKCQkJCX0sCgkJCQkiZGF0YVR5cGUiOiAianNvbiIsCgkJCQkiY2FjaGUiOiBmYWxzZSwKCQkJCSJ0eXBlIjogb1NldHRpbmdzLnNTZXJ2ZXJNZXRob2QsCgkJCQkiZXJyb3IiOiBmdW5jdGlvbiAoeGhyLCBlcnJvciwgdGhyb3duKSB7CgkJCQkJaWYgKCBlcnJvciA9PSAicGFyc2VyZXJyb3IiICkgewoJCQkJCQlvU2V0dGluZ3Mub0FwaS5fZm5Mb2coIG9TZXR0aW5ncywgMCwgIkRhdGFUYWJsZXMgd2FybmluZzogSlNPTiBkYXRhIGZyb20gIisKCQkJCQkJCSJzZXJ2ZXIgY291bGQgbm90IGJlIHBhcnNlZC4gVGhpcyBpcyBjYXVzZWQgYnkgYSBKU09OIGZvcm1hdHRpbmcgZXJyb3IuIiApOwoJCQkJCX0KCQkJCX0KCQkJfSApOwoJCX0sCgkKCQoJCS8qKgoJCSAqIEl0IGlzIG9mdGVuIHVzZWZ1bCB0byBzZW5kIGV4dHJhIGRhdGEgdG8gdGhlIHNlcnZlciB3aGVuIG1ha2luZyBhbiBBamF4CgkJICogcmVxdWVzdCAtIGZvciBleGFtcGxlIGN1c3RvbSBmaWx0ZXJpbmcgaW5mb3JtYXRpb24sIGFuZCB0aGlzIGNhbGxiYWNrCgkJICogZnVuY3Rpb24gbWFrZXMgaXQgdHJpdmlhbCB0byBzZW5kIGV4dHJhIGluZm9ybWF0aW9uIHRvIHRoZSBzZXJ2ZXIuIFRoZQoJCSAqIHBhc3NlZCBpbiBwYXJhbWV0ZXIgaXMgdGhlIGRhdGEgc2V0IHRoYXQgaGFzIGJlZW4gY29uc3RydWN0ZWQgYnkKCQkgKiBEYXRhVGFibGVzLCBhbmQgeW91IGNhbiBhZGQgdG8gdGhpcyBvciBtb2RpZnkgaXQgYXMgeW91IHJlcXVpcmUuCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7YXJyYXl9IGFvRGF0YSBEYXRhIGFycmF5IChhcnJheSBvZiBvYmplY3RzIHdoaWNoIGFyZSBuYW1lL3ZhbHVlCgkJICogICAgcGFpcnMpIHRoYXQgaGFzIGJlZW4gY29uc3RydWN0ZWQgYnkgRGF0YVRhYmxlcyBhbmQgd2lsbCBiZSBzZW50IHRvIHRoZQoJCSAqICAgIHNlcnZlci4gSW4gdGhlIGNhc2Ugb2YgQWpheCBzb3VyY2VkIGRhdGEgd2l0aCBzZXJ2ZXItc2lkZSBwcm9jZXNzaW5nCgkJICogICAgdGhpcyB3aWxsIGJlIGFuIGVtcHR5IGFycmF5LCBmb3Igc2VydmVyLXNpZGUgcHJvY2Vzc2luZyB0aGVyZSB3aWxsIGJlIGEKCQkgKiAgICBzaWduaWZpY2FudCBudW1iZXIgb2YgcGFyYW1ldGVycyEKCQkgKiAgQHJldHVybnMge3VuZGVmaW5lZH0gRW5zdXJlIHRoYXQgeW91IG1vZGlmeSB0aGUgYW9EYXRhIGFycmF5IHBhc3NlZCBpbiwKCQkgKiAgICBhcyB0aGlzIGlzIHBhc3NlZCBieSByZWZlcmVuY2UuCgkJICogIEBkdG9wdCBDYWxsYmFja3MKCQkgKiAgQGR0b3B0IFNlcnZlci1zaWRlCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYlByb2Nlc3NpbmciOiB0cnVlLAoJCSAqICAgICAgICAiYlNlcnZlclNpZGUiOiB0cnVlLAoJCSAqICAgICAgICAic0FqYXhTb3VyY2UiOiAic2NyaXB0cy9zZXJ2ZXJfcHJvY2Vzc2luZy5waHAiLAoJCSAqICAgICAgICAiZm5TZXJ2ZXJQYXJhbXMiOiBmdW5jdGlvbiAoIGFvRGF0YSApIHsKCQkgKiAgICAgICAgICBhb0RhdGEucHVzaCggeyAibmFtZSI6ICJtb3JlX2RhdGEiLCAidmFsdWUiOiAibXlfdmFsdWUiIH0gKTsKCQkgKiAgICAgICAgfQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiZm5TZXJ2ZXJQYXJhbXMiOiBudWxsLAoJCgkKCQkvKioKCQkgKiBMb2FkIHRoZSB0YWJsZSBzdGF0ZS4gV2l0aCB0aGlzIGZ1bmN0aW9uIHlvdSBjYW4gZGVmaW5lIGZyb20gd2hlcmUsIGFuZCBob3csIHRoZQoJCSAqIHN0YXRlIG9mIGEgdGFibGUgaXMgbG9hZGVkLiBCeSBkZWZhdWx0IERhdGFUYWJsZXMgd2lsbCBsb2FkIGZyb20gaXRzIHN0YXRlIHNhdmluZwoJCSAqIGNvb2tpZSwgYnV0IHlvdSBtaWdodCB3aXNoIHRvIHVzZSBsb2NhbCBzdG9yYWdlIChIVE1MNSkgb3IgYSBzZXJ2ZXItc2lkZSBkYXRhYmFzZS4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQG1lbWJlcgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEByZXR1cm4ge29iamVjdH0gVGhlIERhdGFUYWJsZXMgc3RhdGUgb2JqZWN0IHRvIGJlIGxvYWRlZAoJCSAqICBAZHRvcHQgQ2FsbGJhY2tzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYlN0YXRlU2F2ZSI6IHRydWUsCgkJICogICAgICAgICJmblN0YXRlTG9hZCI6IGZ1bmN0aW9uIChvU2V0dGluZ3MpIHsKCQkgKiAgICAgICAgICB2YXIgbzsKCQkgKiAgICAgICAgICAKCQkgKiAgICAgICAgICAvLyBTZW5kIGFuIEFqYXggcmVxdWVzdCB0byB0aGUgc2VydmVyIHRvIGdldCB0aGUgZGF0YS4gTm90ZSB0aGF0CgkJICogICAgICAgICAgLy8gdGhpcyBpcyBhIHN5bmNocm9ub3VzIHJlcXVlc3QuCgkJICogICAgICAgICAgJC5hamF4KCB7CgkJICogICAgICAgICAgICAidXJsIjogIi9zdGF0ZV9sb2FkIiwKCQkgKiAgICAgICAgICAgICJhc3luYyI6IGZhbHNlLAoJCSAqICAgICAgICAgICAgImRhdGFUeXBlIjogImpzb24iLAoJCSAqICAgICAgICAgICAgInN1Y2Nlc3MiOiBmdW5jdGlvbiAoanNvbikgewoJCSAqICAgICAgICAgICAgICBvID0ganNvbjsKCQkgKiAgICAgICAgICAgIH0KCQkgKiAgICAgICAgICB9ICk7CgkJICogICAgICAgICAgCgkJICogICAgICAgICAgcmV0dXJuIG87CgkJICogICAgICAgIH0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImZuU3RhdGVMb2FkIjogZnVuY3Rpb24gKCBvU2V0dGluZ3MgKSB7CgkJCXZhciBzRGF0YSA9IHRoaXMub0FwaS5fZm5SZWFkQ29va2llKCBvU2V0dGluZ3Muc0Nvb2tpZVByZWZpeCtvU2V0dGluZ3Muc0luc3RhbmNlICk7CgkJCXZhciBvRGF0YTsKCQoJCQl0cnkgewoJCQkJb0RhdGEgPSAodHlwZW9mICQucGFyc2VKU09OID09PSAnZnVuY3Rpb24nKSA/IAoJCQkJCSQucGFyc2VKU09OKHNEYXRhKSA6IGV2YWwoICcoJytzRGF0YSsnKScgKTsKCQkJfSBjYXRjaCAoZSkgewoJCQkJb0RhdGEgPSBudWxsOwoJCQl9CgkKCQkJcmV0dXJuIG9EYXRhOwoJCX0sCgkKCQoJCS8qKgoJCSAqIENhbGxiYWNrIHdoaWNoIGFsbG93cyBtb2RpZmljYXRpb24gb2YgdGhlIHNhdmVkIHN0YXRlIHByaW9yIHRvIGxvYWRpbmcgdGhhdCBzdGF0ZS4KCQkgKiBUaGlzIGNhbGxiYWNrIGlzIGNhbGxlZCB3aGVuIHRoZSB0YWJsZSBpcyBsb2FkaW5nIHN0YXRlIGZyb20gdGhlIHN0b3JlZCBkYXRhLCBidXQKCQkgKiBwcmlvciB0byB0aGUgc2V0dGluZ3Mgb2JqZWN0IGJlaW5nIG1vZGlmaWVkIGJ5IHRoZSBzYXZlZCBzdGF0ZS4gTm90ZSB0aGF0IGZvciAKCQkgKiBwbHVnLWluIGF1dGhvcnMsIHlvdSBzaG91bGQgdXNlIHRoZSAnc3RhdGVMb2FkUGFyYW1zJyBldmVudCB0byBsb2FkIHBhcmFtZXRlcnMgZm9yIAoJCSAqIGEgcGx1Zy1pbi4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge29iamVjdH0gb0RhdGEgVGhlIHN0YXRlIG9iamVjdCB0aGF0IGlzIHRvIGJlIGxvYWRlZAoJCSAqICBAZHRvcHQgQ2FsbGJhY2tzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gUmVtb3ZlIGEgc2F2ZWQgZmlsdGVyLCBzbyBmaWx0ZXJpbmcgaXMgbmV2ZXIgbG9hZGVkCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYlN0YXRlU2F2ZSI6IHRydWUsCgkJICogICAgICAgICJmblN0YXRlTG9hZFBhcmFtcyI6IGZ1bmN0aW9uIChvU2V0dGluZ3MsIG9EYXRhKSB7CgkJICogICAgICAgICAgb0RhdGEub1NlYXJjaC5zU2VhcmNoID0gIiI7CgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIERpc2FsbG93IHN0YXRlIGxvYWRpbmcgYnkgcmV0dXJuaW5nIGZhbHNlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYlN0YXRlU2F2ZSI6IHRydWUsCgkJICogICAgICAgICJmblN0YXRlTG9hZFBhcmFtcyI6IGZ1bmN0aW9uIChvU2V0dGluZ3MsIG9EYXRhKSB7CgkJICogICAgICAgICAgcmV0dXJuIGZhbHNlOwoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiZm5TdGF0ZUxvYWRQYXJhbXMiOiBudWxsLAoJCgkKCQkvKioKCQkgKiBDYWxsYmFjayB0aGF0IGlzIGNhbGxlZCB3aGVuIHRoZSBzdGF0ZSBoYXMgYmVlbiBsb2FkZWQgZnJvbSB0aGUgc3RhdGUgc2F2aW5nIG1ldGhvZAoJCSAqIGFuZCB0aGUgRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QgaGFzIGJlZW4gbW9kaWZpZWQgYXMgYSByZXN1bHQgb2YgdGhlIGxvYWRlZCBzdGF0ZS4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge29iamVjdH0gb0RhdGEgVGhlIHN0YXRlIG9iamVjdCB0aGF0IHdhcyBsb2FkZWQKCQkgKiAgQGR0b3B0IENhbGxiYWNrcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFNob3cgYW4gYWxlcnQgd2l0aCB0aGUgZmlsdGVyaW5nIHZhbHVlIHRoYXQgd2FzIHNhdmVkCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYlN0YXRlU2F2ZSI6IHRydWUsCgkJICogICAgICAgICJmblN0YXRlTG9hZGVkIjogZnVuY3Rpb24gKG9TZXR0aW5ncywgb0RhdGEpIHsKCQkgKiAgICAgICAgICBhbGVydCggJ1NhdmVkIGZpbHRlciB3YXM6ICcrb0RhdGEub1NlYXJjaC5zU2VhcmNoICk7CgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJmblN0YXRlTG9hZGVkIjogbnVsbCwKCQoJCgkJLyoqCgkJICogU2F2ZSB0aGUgdGFibGUgc3RhdGUuIFRoaXMgZnVuY3Rpb24gYWxsb3dzIHlvdSB0byBkZWZpbmUgd2hlcmUgYW5kIGhvdyB0aGUgc3RhdGUKCQkgKiBpbmZvcm1hdGlvbiBmb3IgdGhlIHRhYmxlIGlzIHN0b3JlZCAtIGJ5IGRlZmF1bHQgaXQgd2lsbCB1c2UgYSBjb29raWUsIGJ1dCB5b3UKCQkgKiBtaWdodCB3YW50IHRvIHVzZSBsb2NhbCBzdG9yYWdlIChIVE1MNSkgb3IgYSBzZXJ2ZXItc2lkZSBkYXRhYmFzZS4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQG1lbWJlcgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7b2JqZWN0fSBvRGF0YSBUaGUgc3RhdGUgb2JqZWN0IHRvIGJlIHNhdmVkCgkJICogIEBkdG9wdCBDYWxsYmFja3MKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU3RhdGVTYXZlIjogdHJ1ZSwKCQkgKiAgICAgICAgImZuU3RhdGVTYXZlIjogZnVuY3Rpb24gKG9TZXR0aW5ncywgb0RhdGEpIHsKCQkgKiAgICAgICAgICAvLyBTZW5kIGFuIEFqYXggcmVxdWVzdCB0byB0aGUgc2VydmVyIHdpdGggdGhlIHN0YXRlIG9iamVjdAoJCSAqICAgICAgICAgICQuYWpheCggewoJCSAqICAgICAgICAgICAgInVybCI6ICIvc3RhdGVfc2F2ZSIsCgkJICogICAgICAgICAgICAiZGF0YSI6IG9EYXRhLAoJCSAqICAgICAgICAgICAgImRhdGFUeXBlIjogImpzb24iLAoJCSAqICAgICAgICAgICAgIm1ldGhvZCI6ICJQT1NUIgoJCSAqICAgICAgICAgICAgInN1Y2Nlc3MiOiBmdW5jdGlvbiAoKSB7fQoJCSAqICAgICAgICAgIH0gKTsKCQkgKiAgICAgICAgfQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiZm5TdGF0ZVNhdmUiOiBmdW5jdGlvbiAoIG9TZXR0aW5ncywgb0RhdGEgKSB7CgkJCXRoaXMub0FwaS5fZm5DcmVhdGVDb29raWUoIAoJCQkJb1NldHRpbmdzLnNDb29raWVQcmVmaXgrb1NldHRpbmdzLnNJbnN0YW5jZSwgCgkJCQl0aGlzLm9BcGkuX2ZuSnNvblN0cmluZyhvRGF0YSksIAoJCQkJb1NldHRpbmdzLmlDb29raWVEdXJhdGlvbiwgCgkJCQlvU2V0dGluZ3Muc0Nvb2tpZVByZWZpeCwgCgkJCQlvU2V0dGluZ3MuZm5Db29raWVDYWxsYmFjawoJCQkpOwoJCX0sCgkKCQoJCS8qKgoJCSAqIENhbGxiYWNrIHdoaWNoIGFsbG93cyBtb2RpZmljYXRpb24gb2YgdGhlIHN0YXRlIHRvIGJlIHNhdmVkLiBDYWxsZWQgd2hlbiB0aGUgdGFibGUgCgkJICogaGFzIGNoYW5nZWQgc3RhdGUgYSBuZXcgc3RhdGUgc2F2ZSBpcyByZXF1aXJlZC4gVGhpcyBtZXRob2QgYWxsb3dzIG1vZGlmaWNhdGlvbiBvZgoJCSAqIHRoZSBzdGF0ZSBzYXZpbmcgb2JqZWN0IHByaW9yIHRvIGFjdHVhbGx5IGRvaW5nIHRoZSBzYXZlLCBpbmNsdWRpbmcgYWRkaXRpb24gb3IgCgkJICogb3RoZXIgc3RhdGUgcHJvcGVydGllcyBvciBtb2RpZmljYXRpb24uIE5vdGUgdGhhdCBmb3IgcGx1Zy1pbiBhdXRob3JzLCB5b3Ugc2hvdWxkIAoJCSAqIHVzZSB0aGUgJ3N0YXRlU2F2ZVBhcmFtcycgZXZlbnQgdG8gc2F2ZSBwYXJhbWV0ZXJzIGZvciBhIHBsdWctaW4uCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9EYXRhIFRoZSBzdGF0ZSBvYmplY3QgdG8gYmUgc2F2ZWQKCQkgKiAgQGR0b3B0IENhbGxiYWNrcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFJlbW92ZSBhIHNhdmVkIGZpbHRlciwgc28gZmlsdGVyaW5nIGlzIG5ldmVyIHNhdmVkCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYlN0YXRlU2F2ZSI6IHRydWUsCgkJICogICAgICAgICJmblN0YXRlU2F2ZVBhcmFtcyI6IGZ1bmN0aW9uIChvU2V0dGluZ3MsIG9EYXRhKSB7CgkJICogICAgICAgICAgb0RhdGEub1NlYXJjaC5zU2VhcmNoID0gIiI7CgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJmblN0YXRlU2F2ZVBhcmFtcyI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIER1cmF0aW9uIG9mIHRoZSBjb29raWUgd2hpY2ggaXMgdXNlZCBmb3Igc3RvcmluZyBzZXNzaW9uIGluZm9ybWF0aW9uLiBUaGlzCgkJICogdmFsdWUgaXMgZ2l2ZW4gaW4gc2Vjb25kcy4KCQkgKiAgQHR5cGUgaW50CgkJICogIEBkZWZhdWx0IDcyMDAgPGk+KDIgaG91cnMpPC9pPgoJCSAqICBAZHRvcHQgT3B0aW9ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJpQ29va2llRHVyYXRpb24iOiA2MCo2MCoyNCAvLyAxIGRheQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKQoJCSAqLwoJCSJpQ29va2llRHVyYXRpb24iOiA3MjAwLAoJCgkKCQkvKioKCQkgKiBXaGVuIGVuYWJsZWQgRGF0YVRhYmxlcyB3aWxsIG5vdCBtYWtlIGEgcmVxdWVzdCB0byB0aGUgc2VydmVyIGZvciB0aGUgZmlyc3QKCQkgKiBwYWdlIGRyYXcgLSByYXRoZXIgaXQgd2lsbCB1c2UgdGhlIGRhdGEgYWxyZWFkeSBvbiB0aGUgcGFnZSAobm8gc29ydGluZyBldGMKCQkgKiB3aWxsIGJlIGFwcGxpZWQgdG8gaXQpLCB0aHVzIHNhdmluZyBvbiBhbiBYSFIgYXQgbG9hZCB0aW1lLiBpRGVmZXJMb2FkaW5nCgkJICogaXMgdXNlZCB0byBpbmRpY2F0ZSB0aGF0IGRlZmVycmVkIGxvYWRpbmcgaXMgcmVxdWlyZWQsIGJ1dCBpdCBpcyBhbHNvIHVzZWQKCQkgKiB0byB0ZWxsIERhdGFUYWJsZXMgaG93IG1hbnkgcmVjb3JkcyB0aGVyZSBhcmUgaW4gdGhlIGZ1bGwgdGFibGUgKGFsbG93aW5nCgkJICogdGhlIGluZm9ybWF0aW9uIGVsZW1lbnQgYW5kIHBhZ2luYXRpb24gdG8gYmUgZGlzcGxheWVkIGNvcnJlY3RseSkuIEluIHRoZSBjYXNlCgkJICogd2hlcmUgYSBmaWx0ZXJpbmcgaXMgYXBwbGllZCB0byB0aGUgdGFibGUgb24gaW5pdGlhbCBsb2FkLCB0aGlzIGNhbiBiZQoJCSAqIGluZGljYXRlZCBieSBnaXZpbmcgdGhlIHBhcmFtZXRlciBhcyBhbiBhcnJheSwgd2hlcmUgdGhlIGZpcnN0IGVsZW1lbnQgaXMKCQkgKiB0aGUgbnVtYmVyIG9mIHJlY29yZHMgYXZhaWxhYmxlIGFmdGVyIGZpbHRlcmluZyBhbmQgdGhlIHNlY29uZCBlbGVtZW50IGlzIHRoZQoJCSAqIG51bWJlciBvZiByZWNvcmRzIHdpdGhvdXQgZmlsdGVyaW5nIChhbGxvd2luZyB0aGUgdGFibGUgaW5mb3JtYXRpb24gZWxlbWVudAoJCSAqIHRvIGJlIHNob3duIGNvcnJlY3RseSkuCgkJICogIEB0eXBlIGludCB8IGFycmF5CgkJICogIEBkZWZhdWx0IG51bGwKCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyA1NyByZWNvcmRzIGF2YWlsYWJsZSBpbiB0aGUgdGFibGUsIG5vIGZpbHRlcmluZyBhcHBsaWVkCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYlNlcnZlclNpZGUiOiB0cnVlLAoJCSAqICAgICAgICAic0FqYXhTb3VyY2UiOiAic2NyaXB0cy9zZXJ2ZXJfcHJvY2Vzc2luZy5waHAiLAoJCSAqICAgICAgICAiaURlZmVyTG9hZGluZyI6IDU3CgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIDU3IHJlY29yZHMgYWZ0ZXIgZmlsdGVyaW5nLCAxMDAgd2l0aG91dCBmaWx0ZXJpbmcgKGFuIGluaXRpYWwgZmlsdGVyIGFwcGxpZWQpCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYlNlcnZlclNpZGUiOiB0cnVlLAoJCSAqICAgICAgICAic0FqYXhTb3VyY2UiOiAic2NyaXB0cy9zZXJ2ZXJfcHJvY2Vzc2luZy5waHAiLAoJCSAqICAgICAgICAiaURlZmVyTG9hZGluZyI6IFsgNTcsIDEwMCBdLAoJCSAqICAgICAgICAib1NlYXJjaCI6IHsKCQkgKiAgICAgICAgICAic1NlYXJjaCI6ICJteV9maWx0ZXIiCgkJICogICAgICAgIH0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImlEZWZlckxvYWRpbmciOiBudWxsLAoJCgkKCQkvKioKCQkgKiBOdW1iZXIgb2Ygcm93cyB0byBkaXNwbGF5IG9uIGEgc2luZ2xlIHBhZ2Ugd2hlbiB1c2luZyBwYWdpbmF0aW9uLiBJZgoJCSAqIGZlYXR1cmUgZW5hYmxlZCAoYkxlbmd0aENoYW5nZSkgdGhlbiB0aGUgZW5kIHVzZXIgd2lsbCBiZSBhYmxlIHRvIG92ZXJyaWRlCgkJICogdGhpcyB0byBhIGN1c3RvbSBzZXR0aW5nIHVzaW5nIGEgcG9wLXVwIG1lbnUuCgkJICogIEB0eXBlIGludAoJCSAqICBAZGVmYXVsdCAxMAoJCSAqICBAZHRvcHQgT3B0aW9ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJpRGlzcGxheUxlbmd0aCI6IDUwCgkJICogICAgICB9ICk7CgkJICogICAgfSApCgkJICovCgkJImlEaXNwbGF5TGVuZ3RoIjogMTAsCgkKCQoJCS8qKgoJCSAqIERlZmluZSB0aGUgc3RhcnRpbmcgcG9pbnQgZm9yIGRhdGEgZGlzcGxheSB3aGVuIHVzaW5nIERhdGFUYWJsZXMgd2l0aAoJCSAqIHBhZ2luYXRpb24uIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciBpcyB0aGUgbnVtYmVyIG9mIHJlY29yZHMsIHJhdGhlciB0aGFuCgkJICogdGhlIHBhZ2UgbnVtYmVyLCBzbyBpZiB5b3UgaGF2ZSAxMCByZWNvcmRzIHBlciBwYWdlIGFuZCB3YW50IHRvIHN0YXJ0IG9uCgkJICogdGhlIHRoaXJkIHBhZ2UsIGl0IHNob3VsZCBiZSAiMjAiLgoJCSAqICBAdHlwZSBpbnQKCQkgKiAgQGRlZmF1bHQgMAoJCSAqICBAZHRvcHQgT3B0aW9ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJpRGlzcGxheVN0YXJ0IjogMjAKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICkKCQkgKi8KCQkiaURpc3BsYXlTdGFydCI6IDAsCgkKCQoJCS8qKgoJCSAqIFRoZSBzY3JvbGwgZ2FwIGlzIHRoZSBhbW91bnQgb2Ygc2Nyb2xsaW5nIHRoYXQgaXMgbGVmdCB0byBnbyBiZWZvcmUKCQkgKiBEYXRhVGFibGVzIHdpbGwgbG9hZCB0aGUgbmV4dCAncGFnZScgb2YgZGF0YSBhdXRvbWF0aWNhbGx5LiBZb3UgdHlwaWNhbGx5CgkJICogd2FudCBhIGdhcCB3aGljaCBpcyBiaWcgZW5vdWdoIHRoYXQgdGhlIHNjcm9sbGluZyB3aWxsIGJlIHNtb290aCBmb3IgdGhlCgkJICogdXNlciwgd2hpbGUgbm90IHNvIGxhcmdlIHRoYXQgaXQgd2lsbCBsb2FkIG1vcmUgZGF0YSB0aGFuIG5lZWQuCgkJICogIEB0eXBlIGludAoJCSAqICBAZGVmYXVsdCAxMDAKCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU2Nyb2xsSW5maW5pdGUiOiB0cnVlLAoJCSAqICAgICAgICAiYlNjcm9sbENvbGxhcHNlIjogdHJ1ZSwKCQkgKiAgICAgICAgInNTY3JvbGxZIjogIjIwMHB4IiwKCQkgKiAgICAgICAgImlTY3JvbGxMb2FkR2FwIjogNTAKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImlTY3JvbGxMb2FkR2FwIjogMTAwLAoJCgkKCQkvKioKCQkgKiBCeSBkZWZhdWx0IERhdGFUYWJsZXMgYWxsb3dzIGtleWJvYXJkIG5hdmlnYXRpb24gb2YgdGhlIHRhYmxlIChzb3J0aW5nLCBwYWdpbmcsCgkJICogYW5kIGZpbHRlcmluZykgYnkgYWRkaW5nIGEgdGFiaW5kZXggYXR0cmlidXRlIHRvIHRoZSByZXF1aXJlZCBlbGVtZW50cy4gVGhpcwoJCSAqIGFsbG93cyB5b3UgdG8gdGFiIHRocm91Z2ggdGhlIGNvbnRyb2xzIGFuZCBwcmVzcyB0aGUgZW50ZXIga2V5IHRvIGFjdGl2YXRlIHRoZW0uCgkJICogVGhlIHRhYmluZGV4IGlzIGRlZmF1bHQgMCwgbWVhbmluZyB0aGF0IHRoZSB0YWIgZm9sbG93cyB0aGUgZmxvdyBvZiB0aGUgZG9jdW1lbnQuCgkJICogWW91IGNhbiBvdmVycnVsZSB0aGlzIHVzaW5nIHRoaXMgcGFyYW1ldGVyIGlmIHlvdSB3aXNoLiBVc2UgYSB2YWx1ZSBvZiAtMSB0bwoJCSAqIGRpc2FibGUgYnVpbHQtaW4ga2V5Ym9hcmQgbmF2aWdhdGlvbi4KCQkgKiAgQHR5cGUgaW50CgkJICogIEBkZWZhdWx0IDAKCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJpVGFiSW5kZXgiOiAxCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJpVGFiSW5kZXgiOiAwLAoJCgkKCQkvKioKCQkgKiBBbGwgc3RyaW5ncyB0aGF0IERhdGFUYWJsZXMgdXNlcyBpbiB0aGUgdXNlciBpbnRlcmZhY2UgdGhhdCBpdCBjcmVhdGVzCgkJICogYXJlIGRlZmluZWQgaW4gdGhpcyBvYmplY3QsIGFsbG93aW5nIHlvdSB0byBtb2RpZmllZCB0aGVtIGluZGl2aWR1YWxseSBvcgoJCSAqIGNvbXBsZXRlbHkgcmVwbGFjZSB0aGVtIGFsbCBhcyByZXF1aXJlZC4KCQkgKiAgQG5hbWVzcGFjZQoJCSAqLwoJCSJvTGFuZ3VhZ2UiOiB7CgkJCS8qKgoJCQkgKiBTdHJpbmdzIHRoYXQgYXJlIHVzZWQgZm9yIFdBSS1BUklBIGxhYmVscyBhbmQgY29udHJvbHMgb25seSAodGhlc2UgYXJlIG5vdAoJCQkgKiBhY3R1YWxseSB2aXNpYmxlIG9uIHRoZSBwYWdlLCBidXQgd2lsbCBiZSByZWFkIGJ5IHNjcmVlbnJlYWRlcnMsIGFuZCB0aHVzCgkJCSAqIG11c3QgYmUgaW50ZXJuYXRpb25hbGlzZWQgYXMgd2VsbCkuCgkJCSAqICBAbmFtZXNwYWNlCgkJCSAqLwoJCQkib0FyaWEiOiB7CgkJCQkvKioKCQkJCSAqIEFSSUEgbGFiZWwgdGhhdCBpcyBhZGRlZCB0byB0aGUgdGFibGUgaGVhZGVycyB3aGVuIHRoZSBjb2x1bW4gbWF5IGJlCgkJCQkgKiBzb3J0ZWQgYXNjZW5kaW5nIGJ5IGFjdGl2aW5nIHRoZSBjb2x1bW4gKGNsaWNrIG9yIHJldHVybiB3aGVuIGZvY3VzZWQpLgoJCQkJICogTm90ZSB0aGF0IHRoZSBjb2x1bW4gaGVhZGVyIGlzIHByZWZpeGVkIHRvIHRoaXMgc3RyaW5nLgoJCQkJICogIEB0eXBlIHN0cmluZwoJCQkJICogIEBkZWZhdWx0IDogYWN0aXZhdGUgdG8gc29ydCBjb2x1bW4gYXNjZW5kaW5nCgkJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCQkgKiAKCQkJCSAqICBAZXhhbXBsZQoJCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJCQkgKiAgICAgICAgIm9MYW5ndWFnZSI6IHsKCQkJCSAqICAgICAgICAgICJvQXJpYSI6IHsKCQkJCSAqICAgICAgICAgICAgInNTb3J0QXNjZW5kaW5nIjogIiAtIGNsaWNrL3JldHVybiB0byBzb3J0IGFzY2VuZGluZyIKCQkJCSAqICAgICAgICAgIH0KCQkJCSAqICAgICAgICB9CgkJCQkgKiAgICAgIH0gKTsKCQkJCSAqICAgIH0gKTsKCQkJCSAqLwoJCQkJInNTb3J0QXNjZW5kaW5nIjogIjogYWN0aXZhdGUgdG8gc29ydCBjb2x1bW4gYXNjZW5kaW5nIiwKCQoJCQkJLyoqCgkJCQkgKiBBUklBIGxhYmVsIHRoYXQgaXMgYWRkZWQgdG8gdGhlIHRhYmxlIGhlYWRlcnMgd2hlbiB0aGUgY29sdW1uIG1heSBiZQoJCQkJICogc29ydGVkIGRlc2NlbmRpbmcgYnkgYWN0aXZpbmcgdGhlIGNvbHVtbiAoY2xpY2sgb3IgcmV0dXJuIHdoZW4gZm9jdXNlZCkuCgkJCQkgKiBOb3RlIHRoYXQgdGhlIGNvbHVtbiBoZWFkZXIgaXMgcHJlZml4ZWQgdG8gdGhpcyBzdHJpbmcuCgkJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCQkgKiAgQGRlZmF1bHQgOiBhY3RpdmF0ZSB0byBzb3J0IGNvbHVtbiBhc2NlbmRpbmcKCQkJCSAqICBAZHRvcHQgTGFuZ3VhZ2UKCQkJCSAqIAoJCQkJICogIEBleGFtcGxlCgkJCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJCSAqICAgICAgICAib0xhbmd1YWdlIjogewoJCQkJICogICAgICAgICAgIm9BcmlhIjogewoJCQkJICogICAgICAgICAgICAic1NvcnREZXNjZW5kaW5nIjogIiAtIGNsaWNrL3JldHVybiB0byBzb3J0IGRlc2NlbmRpbmciCgkJCQkgKiAgICAgICAgICB9CgkJCQkgKiAgICAgICAgfQoJCQkJICogICAgICB9ICk7CgkJCQkgKiAgICB9ICk7CgkJCQkgKi8KCQkJCSJzU29ydERlc2NlbmRpbmciOiAiOiBhY3RpdmF0ZSB0byBzb3J0IGNvbHVtbiBkZXNjZW5kaW5nIgoJCQl9LAoJCgkJCS8qKgoJCQkgKiBQYWdpbmF0aW9uIHN0cmluZyB1c2VkIGJ5IERhdGFUYWJsZXMgZm9yIHRoZSB0d28gYnVpbHQtaW4gcGFnaW5hdGlvbgoJCQkgKiBjb250cm9sIHR5cGVzICgidHdvX2J1dHRvbiIgYW5kICJmdWxsX251bWJlcnMiKQoJCQkgKiAgQG5hbWVzcGFjZQoJCQkgKi8KCQkJIm9QYWdpbmF0ZSI6IHsKCQkJCS8qKgoJCQkJICogVGV4dCB0byB1c2Ugd2hlbiB1c2luZyB0aGUgJ2Z1bGxfbnVtYmVycycgdHlwZSBvZiBwYWdpbmF0aW9uIGZvciB0aGUKCQkJCSAqIGJ1dHRvbiB0byB0YWtlIHRoZSB1c2VyIHRvIHRoZSBmaXJzdCBwYWdlLgoJCQkJICogIEB0eXBlIHN0cmluZwoJCQkJICogIEBkZWZhdWx0IEZpcnN0CgkJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCQkgKiAKCQkJCSAqICBAZXhhbXBsZQoJCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJCQkgKiAgICAgICAgIm9MYW5ndWFnZSI6IHsKCQkJCSAqICAgICAgICAgICJvUGFnaW5hdGUiOiB7CgkJCQkgKiAgICAgICAgICAgICJzRmlyc3QiOiAiRmlyc3QgcGFnZSIKCQkJCSAqICAgICAgICAgIH0KCQkJCSAqICAgICAgICB9CgkJCQkgKiAgICAgIH0gKTsKCQkJCSAqICAgIH0gKTsKCQkJCSAqLwoJCQkJInNGaXJzdCI6ICJGaXJzdCIsCgkJCQoJCQkKCQkJCS8qKgoJCQkJICogVGV4dCB0byB1c2Ugd2hlbiB1c2luZyB0aGUgJ2Z1bGxfbnVtYmVycycgdHlwZSBvZiBwYWdpbmF0aW9uIGZvciB0aGUKCQkJCSAqIGJ1dHRvbiB0byB0YWtlIHRoZSB1c2VyIHRvIHRoZSBsYXN0IHBhZ2UuCgkJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCQkgKiAgQGRlZmF1bHQgTGFzdAoJCQkJICogIEBkdG9wdCBMYW5ndWFnZQoJCQkJICogCgkJCQkgKiAgQGV4YW1wbGUKCQkJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCQkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCQkgKiAgICAgICAgICAib1BhZ2luYXRlIjogewoJCQkJICogICAgICAgICAgICAic0xhc3QiOiAiTGFzdCBwYWdlIgoJCQkJICogICAgICAgICAgfQoJCQkJICogICAgICAgIH0KCQkJCSAqICAgICAgfSApOwoJCQkJICogICAgfSApOwoJCQkJICovCgkJCQkic0xhc3QiOiAiTGFzdCIsCgkJCQoJCQkKCQkJCS8qKgoJCQkJICogVGV4dCB0byB1c2Ugd2hlbiB1c2luZyB0aGUgJ2Z1bGxfbnVtYmVycycgdHlwZSBvZiBwYWdpbmF0aW9uIGZvciB0aGUKCQkJCSAqIGJ1dHRvbiB0byB0YWtlIHRoZSB1c2VyIHRvIHRoZSBuZXh0IHBhZ2UuCgkJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCQkgKiAgQGRlZmF1bHQgTmV4dAoJCQkJICogIEBkdG9wdCBMYW5ndWFnZQoJCQkJICogCgkJCQkgKiAgQGV4YW1wbGUKCQkJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCQkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCQkgKiAgICAgICAgICAib1BhZ2luYXRlIjogewoJCQkJICogICAgICAgICAgICAic05leHQiOiAiTmV4dCBwYWdlIgoJCQkJICogICAgICAgICAgfQoJCQkJICogICAgICAgIH0KCQkJCSAqICAgICAgfSApOwoJCQkJICogICAgfSApOwoJCQkJICovCgkJCQkic05leHQiOiAiTmV4dCIsCgkJCQoJCQkKCQkJCS8qKgoJCQkJICogVGV4dCB0byB1c2Ugd2hlbiB1c2luZyB0aGUgJ2Z1bGxfbnVtYmVycycgdHlwZSBvZiBwYWdpbmF0aW9uIGZvciB0aGUKCQkJCSAqIGJ1dHRvbiB0byB0YWtlIHRoZSB1c2VyIHRvIHRoZSBwcmV2aW91cyBwYWdlLgoJCQkJICogIEB0eXBlIHN0cmluZwoJCQkJICogIEBkZWZhdWx0IFByZXZpb3VzCgkJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCQkgKiAKCQkJCSAqICBAZXhhbXBsZQoJCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJCQkgKiAgICAgICAgIm9MYW5ndWFnZSI6IHsKCQkJCSAqICAgICAgICAgICJvUGFnaW5hdGUiOiB7CgkJCQkgKiAgICAgICAgICAgICJzUHJldmlvdXMiOiAiUHJldmlvdXMgcGFnZSIKCQkJCSAqICAgICAgICAgIH0KCQkJCSAqICAgICAgICB9CgkJCQkgKiAgICAgIH0gKTsKCQkJCSAqICAgIH0gKTsKCQkJCSAqLwoJCQkJInNQcmV2aW91cyI6ICJQcmV2aW91cyIKCQkJfSwKCQkKCQkJLyoqCgkJCSAqIFRoaXMgc3RyaW5nIGlzIHNob3duIGluIHByZWZlcmVuY2UgdG8gc1plcm9SZWNvcmRzIHdoZW4gdGhlIHRhYmxlIGlzCgkJCSAqIGVtcHR5IG9mIGRhdGEgKHJlZ2FyZGxlc3Mgb2YgZmlsdGVyaW5nKS4gTm90ZSB0aGF0IHRoaXMgaXMgYW4gb3B0aW9uYWwKCQkJICogcGFyYW1ldGVyIC0gaWYgaXQgaXMgbm90IGdpdmVuLCB0aGUgdmFsdWUgb2Ygc1plcm9SZWNvcmRzIHdpbGwgYmUgdXNlZAoJCQkgKiBpbnN0ZWFkIChlaXRoZXIgdGhlIGRlZmF1bHQgb3IgZ2l2ZW4gdmFsdWUpLgoJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCSAqICBAZGVmYXVsdCBObyBkYXRhIGF2YWlsYWJsZSBpbiB0YWJsZQoJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCSAqIAoJCQkgKiAgQGV4YW1wbGUKCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzRW1wdHlUYWJsZSI6ICJObyBkYXRhIGF2YWlsYWJsZSBpbiB0YWJsZSIKCQkJICogICAgICAgIH0KCQkJICogICAgICB9ICk7CgkJCSAqICAgIH0gKTsKCQkJICovCgkJCSJzRW1wdHlUYWJsZSI6ICJObyBkYXRhIGF2YWlsYWJsZSBpbiB0YWJsZSIsCgkJCgkJCgkJCS8qKgoJCQkgKiBUaGlzIHN0cmluZyBnaXZlcyBpbmZvcm1hdGlvbiB0byB0aGUgZW5kIHVzZXIgYWJvdXQgdGhlIGluZm9ybWF0aW9uIHRoYXQgCgkJCSAqIGlzIGN1cnJlbnQgb24gZGlzcGxheSBvbiB0aGUgcGFnZS4gVGhlIF9TVEFSVF8sIF9FTkRfIGFuZCBfVE9UQUxfIAoJCQkgKiB2YXJpYWJsZXMgYXJlIGFsbCBkeW5hbWljYWxseSByZXBsYWNlZCBhcyB0aGUgdGFibGUgZGlzcGxheSB1cGRhdGVzLCBhbmQgCgkJCSAqIGNhbiBiZSBmcmVlbHkgbW92ZWQgb3IgcmVtb3ZlZCBhcyB0aGUgbGFuZ3VhZ2UgcmVxdWlyZW1lbnRzIGNoYW5nZS4KCQkJICogIEB0eXBlIHN0cmluZwoJCQkgKiAgQGRlZmF1bHQgU2hvd2luZyBfU1RBUlRfIHRvIF9FTkRfIG9mIF9UT1RBTF8gZW50cmllcwoJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCSAqIAoJCQkgKiAgQGV4YW1wbGUKCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzSW5mbyI6ICJHb3QgYSB0b3RhbCBvZiBfVE9UQUxfIGVudHJpZXMgdG8gc2hvdyAoX1NUQVJUXyB0byBfRU5EXykiCgkJCSAqICAgICAgICB9CgkJCSAqICAgICAgfSApOwoJCQkgKiAgICB9ICk7CgkJCSAqLwoJCQkic0luZm8iOiAiU2hvd2luZyBfU1RBUlRfIHRvIF9FTkRfIG9mIF9UT1RBTF8gZW50cmllcyIsCgkJCgkJCgkJCS8qKgoJCQkgKiBEaXNwbGF5IGluZm9ybWF0aW9uIHN0cmluZyBmb3Igd2hlbiB0aGUgdGFibGUgaXMgZW1wdHkuIFR5cGljYWxseSB0aGUgCgkJCSAqIGZvcm1hdCBvZiB0aGlzIHN0cmluZyBzaG91bGQgbWF0Y2ggc0luZm8uCgkJCSAqICBAdHlwZSBzdHJpbmcKCQkJICogIEBkZWZhdWx0IFNob3dpbmcgMCB0byAwIG9mIDAgZW50cmllcwoJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCSAqIAoJCQkgKiAgQGV4YW1wbGUKCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzSW5mb0VtcHR5IjogIk5vIGVudHJpZXMgdG8gc2hvdyIKCQkJICogICAgICAgIH0KCQkJICogICAgICB9ICk7CgkJCSAqICAgIH0gKTsKCQkJICovCgkJCSJzSW5mb0VtcHR5IjogIlNob3dpbmcgMCB0byAwIG9mIDAgZW50cmllcyIsCgkJCgkJCgkJCS8qKgoJCQkgKiBXaGVuIGEgdXNlciBmaWx0ZXJzIHRoZSBpbmZvcm1hdGlvbiBpbiBhIHRhYmxlLCB0aGlzIHN0cmluZyBpcyBhcHBlbmRlZCAKCQkJICogdG8gdGhlIGluZm9ybWF0aW9uIChzSW5mbykgdG8gZ2l2ZSBhbiBpZGVhIG9mIGhvdyBzdHJvbmcgdGhlIGZpbHRlcmluZyAKCQkJICogaXMuIFRoZSB2YXJpYWJsZSBfTUFYXyBpcyBkeW5hbWljYWxseSB1cGRhdGVkLgoJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCSAqICBAZGVmYXVsdCAoZmlsdGVyZWQgZnJvbSBfTUFYXyB0b3RhbCBlbnRyaWVzKQoJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCSAqIAoJCQkgKiAgQGV4YW1wbGUKCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzSW5mb0ZpbHRlcmVkIjogIiAtIGZpbHRlcmluZyBmcm9tIF9NQVhfIHJlY29yZHMiCgkJCSAqICAgICAgICB9CgkJCSAqICAgICAgfSApOwoJCQkgKiAgICB9ICk7CgkJCSAqLwoJCQkic0luZm9GaWx0ZXJlZCI6ICIoZmlsdGVyZWQgZnJvbSBfTUFYXyB0b3RhbCBlbnRyaWVzKSIsCgkJCgkJCgkJCS8qKgoJCQkgKiBJZiBjYW4gYmUgdXNlZnVsIHRvIGFwcGVuZCBleHRyYSBpbmZvcm1hdGlvbiB0byB0aGUgaW5mbyBzdHJpbmcgYXQgdGltZXMsCgkJCSAqIGFuZCB0aGlzIHZhcmlhYmxlIGRvZXMgZXhhY3RseSB0aGF0LiBUaGlzIGluZm9ybWF0aW9uIHdpbGwgYmUgYXBwZW5kZWQgdG8KCQkJICogdGhlIHNJbmZvIChzSW5mb0VtcHR5IGFuZCBzSW5mb0ZpbHRlcmVkIGluIHdoYXRldmVyIGNvbWJpbmF0aW9uIHRoZXkgYXJlCgkJCSAqIGJlaW5nIHVzZWQpIGF0IGFsbCB0aW1lcy4KCQkJICogIEB0eXBlIHN0cmluZwoJCQkgKiAgQGRlZmF1bHQgPGk+RW1wdHkgc3RyaW5nPC9pPgoJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCSAqIAoJCQkgKiAgQGV4YW1wbGUKCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzSW5mb1Bvc3RGaXgiOiAiQWxsIHJlY29yZHMgc2hvd24gYXJlIGRlcml2ZWQgZnJvbSByZWFsIGluZm9ybWF0aW9uLiIKCQkJICogICAgICAgIH0KCQkJICogICAgICB9ICk7CgkJCSAqICAgIH0gKTsKCQkJICovCgkJCSJzSW5mb1Bvc3RGaXgiOiAiIiwKCQkKCQkKCQkJLyoqCgkJCSAqIERhdGFUYWJsZXMgaGFzIGEgYnVpbGQgaW4gbnVtYmVyIGZvcm1hdHRlciAoZm5Gb3JtYXROdW1iZXIpIHdoaWNoIGlzIHVzZWQKCQkJICogdG8gZm9ybWF0IGxhcmdlIG51bWJlcnMgdGhhdCBhcmUgdXNlZCBpbiB0aGUgdGFibGUgaW5mb3JtYXRpb24uIEJ5CgkJCSAqIGRlZmF1bHQgYSBjb21tYSBpcyB1c2VkLCBidXQgdGhpcyBjYW4gYmUgdHJpdmlhbGx5IGNoYW5nZWQgdG8gYW55CgkJCSAqIGNoYXJhY3RlciB5b3Ugd2lzaCB3aXRoIHRoaXMgcGFyYW1ldGVyLgoJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCSAqICBAZGVmYXVsdCAsCgkJCSAqICBAZHRvcHQgTGFuZ3VhZ2UKCQkJICogCgkJCSAqICBAZXhhbXBsZQoJCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCQkgKiAgICAgICAgIm9MYW5ndWFnZSI6IHsKCQkJICogICAgICAgICAgInNJbmZvVGhvdXNhbmRzIjogIiciCgkJCSAqICAgICAgICB9CgkJCSAqICAgICAgfSApOwoJCQkgKiAgICB9ICk7CgkJCSAqLwoJCQkic0luZm9UaG91c2FuZHMiOiAiLCIsCgkJCgkJCgkJCS8qKgoJCQkgKiBEZXRhaWwgdGhlIGFjdGlvbiB0aGF0IHdpbGwgYmUgdGFrZW4gd2hlbiB0aGUgZHJvcCBkb3duIG1lbnUgZm9yIHRoZQoJCQkgKiBwYWdpbmF0aW9uIGxlbmd0aCBvcHRpb24gaXMgY2hhbmdlZC4gVGhlICdfTUVOVV8nIHZhcmlhYmxlIGlzIHJlcGxhY2VkCgkJCSAqIHdpdGggYSBkZWZhdWx0IHNlbGVjdCBsaXN0IG9mIDEwLCAyNSwgNTAgYW5kIDEwMCwgYW5kIGNhbiBiZSByZXBsYWNlZAoJCQkgKiB3aXRoIGEgY3VzdG9tIHNlbGVjdCBib3ggaWYgcmVxdWlyZWQuCgkJCSAqICBAdHlwZSBzdHJpbmcKCQkJICogIEBkZWZhdWx0IFNob3cgX01FTlVfIGVudHJpZXMKCQkJICogIEBkdG9wdCBMYW5ndWFnZQoJCQkgKiAKCQkJICogIEBleGFtcGxlCgkJCSAqICAgIC8vIExhbmd1YWdlIGNoYW5nZSBvbmx5CgkJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJCSAqICAgICAgICAib0xhbmd1YWdlIjogewoJCQkgKiAgICAgICAgICAic0xlbmd0aE1lbnUiOiAiRGlzcGxheSBfTUVOVV8gcmVjb3JkcyIKCQkJICogICAgICAgIH0KCQkJICogICAgICB9ICk7CgkJCSAqICAgIH0gKTsKCQkJICogICAgCgkJCSAqICBAZXhhbXBsZQoJCQkgKiAgICAvLyBMYW5ndWFnZSBhbmQgb3B0aW9ucyBjaGFuZ2UKCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzTGVuZ3RoTWVudSI6ICdEaXNwbGF5IDxzZWxlY3Q+JysKCQkJICogICAgICAgICAgICAnPG9wdGlvbiB2YWx1ZT0iMTAiPjEwPC9vcHRpb24+JysKCQkJICogICAgICAgICAgICAnPG9wdGlvbiB2YWx1ZT0iMjAiPjIwPC9vcHRpb24+JysKCQkJICogICAgICAgICAgICAnPG9wdGlvbiB2YWx1ZT0iMzAiPjMwPC9vcHRpb24+JysKCQkJICogICAgICAgICAgICAnPG9wdGlvbiB2YWx1ZT0iNDAiPjQwPC9vcHRpb24+JysKCQkJICogICAgICAgICAgICAnPG9wdGlvbiB2YWx1ZT0iNTAiPjUwPC9vcHRpb24+JysKCQkJICogICAgICAgICAgICAnPG9wdGlvbiB2YWx1ZT0iLTEiPkFsbDwvb3B0aW9uPicrCgkJCSAqICAgICAgICAgICAgJzwvc2VsZWN0PiByZWNvcmRzJwoJCQkgKiAgICAgICAgfQoJCQkgKiAgICAgIH0gKTsKCQkJICogICAgfSApOwoJCQkgKi8KCQkJInNMZW5ndGhNZW51IjogIlNob3cgX01FTlVfIGVudHJpZXMiLAoJCQoJCQoJCQkvKioKCQkJICogV2hlbiB1c2luZyBBamF4IHNvdXJjZWQgZGF0YSBhbmQgZHVyaW5nIHRoZSBmaXJzdCBkcmF3IHdoZW4gRGF0YVRhYmxlcyBpcwoJCQkgKiBnYXRoZXJpbmcgdGhlIGRhdGEsIHRoaXMgbWVzc2FnZSBpcyBzaG93biBpbiBhbiBlbXB0eSByb3cgaW4gdGhlIHRhYmxlIHRvCgkJCSAqIGluZGljYXRlIHRvIHRoZSBlbmQgdXNlciB0aGUgdGhlIGRhdGEgaXMgYmVpbmcgbG9hZGVkLiBOb3RlIHRoYXQgdGhpcwoJCQkgKiBwYXJhbWV0ZXIgaXMgbm90IHVzZWQgd2hlbiBsb2FkaW5nIGRhdGEgYnkgc2VydmVyLXNpZGUgcHJvY2Vzc2luZywganVzdAoJCQkgKiBBamF4IHNvdXJjZWQgZGF0YSB3aXRoIGNsaWVudC1zaWRlIHByb2Nlc3NpbmcuCgkJCSAqICBAdHlwZSBzdHJpbmcKCQkJICogIEBkZWZhdWx0IExvYWRpbmcuLi4KCQkJICogIEBkdG9wdCBMYW5ndWFnZQoJCQkgKiAKCQkJICogIEBleGFtcGxlCgkJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCQkgKiAgICAgICAgIm9MYW5ndWFnZSI6IHsKCQkJICogICAgICAgICAgInNMb2FkaW5nUmVjb3JkcyI6ICJQbGVhc2Ugd2FpdCAtIGxvYWRpbmcuLi4iCgkJCSAqICAgICAgICB9CgkJCSAqICAgICAgfSApOwoJCQkgKiAgICB9ICk7CgkJCSAqLwoJCQkic0xvYWRpbmdSZWNvcmRzIjogIkxvYWRpbmcuLi4iLAoJCQoJCQoJCQkvKioKCQkJICogVGV4dCB3aGljaCBpcyBkaXNwbGF5ZWQgd2hlbiB0aGUgdGFibGUgaXMgcHJvY2Vzc2luZyBhIHVzZXIgYWN0aW9uCgkJCSAqICh1c3VhbGx5IGEgc29ydCBjb21tYW5kIG9yIHNpbWlsYXIpLgoJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCSAqICBAZGVmYXVsdCBQcm9jZXNzaW5nLi4uCgkJCSAqICBAZHRvcHQgTGFuZ3VhZ2UKCQkJICogCgkJCSAqICBAZXhhbXBsZQoJCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCQkgKiAgICAgICAgIm9MYW5ndWFnZSI6IHsKCQkJICogICAgICAgICAgInNQcm9jZXNzaW5nIjogIkRhdGFUYWJsZXMgaXMgY3VycmVudGx5IGJ1c3kiCgkJCSAqICAgICAgICB9CgkJCSAqICAgICAgfSApOwoJCQkgKiAgICB9ICk7CgkJCSAqLwoJCQkic1Byb2Nlc3NpbmciOiAiUHJvY2Vzc2luZy4uLiIsCgkJCgkJCgkJCS8qKgoJCQkgKiBEZXRhaWxzIHRoZSBhY3Rpb25zIHRoYXQgd2lsbCBiZSB0YWtlbiB3aGVuIHRoZSB1c2VyIHR5cGVzIGludG8gdGhlCgkJCSAqIGZpbHRlcmluZyBpbnB1dCB0ZXh0IGJveC4gVGhlIHZhcmlhYmxlICJfSU5QVVRfIiwgaWYgdXNlZCBpbiB0aGUgc3RyaW5nLAoJCQkgKiBpcyByZXBsYWNlZCB3aXRoIHRoZSBIVE1MIHRleHQgYm94IGZvciB0aGUgZmlsdGVyaW5nIGlucHV0IGFsbG93aW5nCgkJCSAqIGNvbnRyb2wgb3ZlciB3aGVyZSBpdCBhcHBlYXJzIGluIHRoZSBzdHJpbmcuIElmICJfSU5QVVRfIiBpcyBub3QgZ2l2ZW4KCQkJICogdGhlbiB0aGUgaW5wdXQgYm94IGlzIGFwcGVuZGVkIHRvIHRoZSBzdHJpbmcgYXV0b21hdGljYWxseS4KCQkJICogIEB0eXBlIHN0cmluZwoJCQkgKiAgQGRlZmF1bHQgU2VhcmNoOgoJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCSAqIAoJCQkgKiAgQGV4YW1wbGUKCQkJICogICAgLy8gSW5wdXQgdGV4dCBib3ggd2lsbCBiZSBhcHBlbmRlZCBhdCB0aGUgZW5kIGF1dG9tYXRpY2FsbHkKCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzU2VhcmNoIjogIkZpbHRlciByZWNvcmRzOiIKCQkJICogICAgICAgIH0KCQkJICogICAgICB9ICk7CgkJCSAqICAgIH0gKTsKCQkJICogICAgCgkJCSAqICBAZXhhbXBsZQoJCQkgKiAgICAvLyBTcGVjaWZ5IHdoZXJlIHRoZSBmaWx0ZXIgc2hvdWxkIGFwcGVhcgoJCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCQkgKiAgICAgICAgIm9MYW5ndWFnZSI6IHsKCQkJICogICAgICAgICAgInNTZWFyY2giOiAiQXBwbHkgZmlsdGVyIF9JTlBVVF8gdG8gdGFibGUiCgkJCSAqICAgICAgICB9CgkJCSAqICAgICAgfSApOwoJCQkgKiAgICB9ICk7CgkJCSAqLwoJCQkic1NlYXJjaCI6ICJTZWFyY2g6IiwKCQkKCQkKCQkJLyoqCgkJCSAqIEFsbCBvZiB0aGUgbGFuZ3VhZ2UgaW5mb3JtYXRpb24gY2FuIGJlIHN0b3JlZCBpbiBhIGZpbGUgb24gdGhlCgkJCSAqIHNlcnZlci1zaWRlLCB3aGljaCBEYXRhVGFibGVzIHdpbGwgbG9vayB1cCBpZiB0aGlzIHBhcmFtZXRlciBpcyBwYXNzZWQuCgkJCSAqIEl0IG11c3Qgc3RvcmUgdGhlIFVSTCBvZiB0aGUgbGFuZ3VhZ2UgZmlsZSwgd2hpY2ggaXMgaW4gYSBKU09OIGZvcm1hdCwKCQkJICogYW5kIHRoZSBvYmplY3QgaGFzIHRoZSBzYW1lIHByb3BlcnRpZXMgYXMgdGhlIG9MYW5ndWFnZSBvYmplY3QgaW4gdGhlCgkJCSAqIGluaXRpYWxpc2VyIG9iamVjdCAoaS5lLiB0aGUgYWJvdmUgcGFyYW1ldGVycykuIFBsZWFzZSByZWZlciB0byBvbmUgb2YKCQkJICogdGhlIGV4YW1wbGUgbGFuZ3VhZ2UgZmlsZXMgdG8gc2VlIGhvdyB0aGlzIHdvcmtzIGluIGFjdGlvbi4KCQkJICogIEB0eXBlIHN0cmluZwoJCQkgKiAgQGRlZmF1bHQgPGk+RW1wdHkgc3RyaW5nIC0gaS5lLiBkaXNhYmxlZDwvaT4KCQkJICogIEBkdG9wdCBMYW5ndWFnZQoJCQkgKiAKCQkJICogIEBleGFtcGxlCgkJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJCSAqICAgICAgICAib0xhbmd1YWdlIjogewoJCQkgKiAgICAgICAgICAic1VybCI6ICJodHRwOi8vd3d3LnNwcnltZWRpYS5jby51ay9kYXRhVGFibGVzL2xhbmcudHh0IgoJCQkgKiAgICAgICAgfQoJCQkgKiAgICAgIH0gKTsKCQkJICogICAgfSApOwoJCQkgKi8KCQkJInNVcmwiOiAiIiwKCQkKCQkKCQkJLyoqCgkJCSAqIFRleHQgc2hvd24gaW5zaWRlIHRoZSB0YWJsZSByZWNvcmRzIHdoZW4gdGhlIGlzIG5vIGluZm9ybWF0aW9uIHRvIGJlCgkJCSAqIGRpc3BsYXllZCBhZnRlciBmaWx0ZXJpbmcuIHNFbXB0eVRhYmxlIGlzIHNob3duIHdoZW4gdGhlcmUgaXMgc2ltcGx5IG5vCgkJCSAqIGluZm9ybWF0aW9uIGluIHRoZSB0YWJsZSBhdCBhbGwgKHJlZ2FyZGxlc3Mgb2YgZmlsdGVyaW5nKS4KCQkJICogIEB0eXBlIHN0cmluZwoJCQkgKiAgQGRlZmF1bHQgTm8gbWF0Y2hpbmcgcmVjb3JkcyBmb3VuZAoJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCSAqIAoJCQkgKiAgQGV4YW1wbGUKCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzWmVyb1JlY29yZHMiOiAiTm8gcmVjb3JkcyB0byBkaXNwbGF5IgoJCQkgKiAgICAgICAgfQoJCQkgKiAgICAgIH0gKTsKCQkJICogICAgfSApOwoJCQkgKi8KCQkJInNaZXJvUmVjb3JkcyI6ICJObyBtYXRjaGluZyByZWNvcmRzIGZvdW5kIgoJCX0sCgkKCQoJCS8qKgoJCSAqIFRoaXMgcGFyYW1ldGVyIGFsbG93cyB5b3UgdG8gaGF2ZSBkZWZpbmUgdGhlIGdsb2JhbCBmaWx0ZXJpbmcgc3RhdGUgYXQKCQkgKiBpbml0aWFsaXNhdGlvbiB0aW1lLiBBcyBhbiBvYmplY3QgdGhlICJzU2VhcmNoIiBwYXJhbWV0ZXIgbXVzdCBiZQoJCSAqIGRlZmluZWQsIGJ1dCBhbGwgb3RoZXIgcGFyYW1ldGVycyBhcmUgb3B0aW9uYWwuIFdoZW4gImJSZWdleCIgaXMgdHJ1ZSwKCQkgKiB0aGUgc2VhcmNoIHN0cmluZyB3aWxsIGJlIHRyZWF0ZWQgYXMgYSByZWd1bGFyIGV4cHJlc3Npb24sIHdoZW4gZmFsc2UKCQkgKiAoZGVmYXVsdCkgaXQgd2lsbCBiZSB0cmVhdGVkIGFzIGEgc3RyYWlnaHQgc3RyaW5nLiBXaGVuICJiU21hcnQiCgkJICogRGF0YVRhYmxlcyB3aWxsIHVzZSBpdCdzIHNtYXJ0IGZpbHRlcmluZyBtZXRob2RzICh0byB3b3JkIG1hdGNoIGF0CgkJICogYW55IHBvaW50IGluIHRoZSBkYXRhKSwgd2hlbiBmYWxzZSB0aGlzIHdpbGwgbm90IGJlIGRvbmUuCgkJICogIEBuYW1lc3BhY2UKCQkgKiAgQGV4dGVuZHMgRGF0YVRhYmxlLm1vZGVscy5vU2VhcmNoCgkJICogIEBkdG9wdCBPcHRpb25zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgIm9TZWFyY2giOiB7InNTZWFyY2giOiAiSW5pdGlhbCBzZWFyY2gifQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKQoJCSAqLwoJCSJvU2VhcmNoIjogJC5leHRlbmQoIHt9LCBEYXRhVGFibGUubW9kZWxzLm9TZWFyY2ggKSwKCQoJCgkJLyoqCgkJICogQnkgZGVmYXVsdCBEYXRhVGFibGVzIHdpbGwgbG9vayBmb3IgdGhlIHByb3BlcnR5ICdhYURhdGEnIHdoZW4gb2J0YWluaW5nCgkJICogZGF0YSBmcm9tIGFuIEFqYXggc291cmNlIG9yIGZvciBzZXJ2ZXItc2lkZSBwcm9jZXNzaW5nIC0gdGhpcyBwYXJhbWV0ZXIKCQkgKiBhbGxvd3MgdGhhdCBwcm9wZXJ0eSB0byBiZSBjaGFuZ2VkLiBZb3UgY2FuIHVzZSBKYXZhc2NyaXB0IGRvdHRlZCBvYmplY3QKCQkgKiBub3RhdGlvbiB0byBnZXQgYSBkYXRhIHNvdXJjZSBmb3IgbXVsdGlwbGUgbGV2ZWxzIG9mIG5lc3RpbmcuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBhYURhdGEKCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAgQGR0b3B0IFNlcnZlci1zaWRlCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gR2V0IGRhdGEgZnJvbSB7ICJkYXRhIjogWy4uLl0gfQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJzQWpheFNvdXJjZSI6ICJzb3VyY2VzL2RhdGEudHh0IiwKCQkgKiAgICAgICAgInNBamF4RGF0YVByb3AiOiAiZGF0YSIKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gR2V0IGRhdGEgZnJvbSB7ICJkYXRhIjogeyAiaW5uZXIiOiBbLi4uXSB9IH0KCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic0FqYXhTb3VyY2UiOiAic291cmNlcy9kYXRhLnR4dCIsCgkJICogICAgICAgICJzQWpheERhdGFQcm9wIjogImRhdGEuaW5uZXIiCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJzQWpheERhdGFQcm9wIjogImFhRGF0YSIsCgkKCQoJCS8qKgoJCSAqIFlvdSBjYW4gaW5zdHJ1Y3QgRGF0YVRhYmxlcyB0byBsb2FkIGRhdGEgZnJvbSBhbiBleHRlcm5hbCBzb3VyY2UgdXNpbmcgdGhpcwoJCSAqIHBhcmFtZXRlciAodXNlIGFEYXRhIGlmIHlvdSB3YW50IHRvIHBhc3MgZGF0YSBpbiB5b3UgYWxyZWFkeSBoYXZlKS4gU2ltcGx5CgkJICogcHJvdmlkZSBhIHVybCBhIEpTT04gb2JqZWN0IGNhbiBiZSBvYnRhaW5lZCBmcm9tLiBUaGlzIG9iamVjdCBtdXN0IGluY2x1ZGUKCQkgKiB0aGUgcGFyYW1ldGVyICdhYURhdGEnIHdoaWNoIGlzIHRoZSBkYXRhIHNvdXJjZSBmb3IgdGhlIHRhYmxlLgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqICBAZHRvcHQgT3B0aW9ucwoJCSAqICBAZHRvcHQgU2VydmVyLXNpZGUKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic0FqYXhTb3VyY2UiOiAiaHR0cDovL3d3dy5zcHJ5bWVkaWEuY28udWsvZGF0YVRhYmxlcy9qc29uLnBocCIKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICkKCQkgKi8KCQkic0FqYXhTb3VyY2UiOiBudWxsLAoJCgkKCQkvKioKCQkgKiBUaGlzIHBhcmFtZXRlciBjYW4gYmUgdXNlZCB0byBvdmVycmlkZSB0aGUgZGVmYXVsdCBwcmVmaXggdGhhdCBEYXRhVGFibGVzCgkJICogYXNzaWducyB0byBhIGNvb2tpZSB3aGVuIHN0YXRlIHNhdmluZyBpcyBlbmFibGVkLgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgU3ByeU1lZGlhX0RhdGFUYWJsZXNfCgkJICogIEBkdG9wdCBPcHRpb25zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic0Nvb2tpZVByZWZpeCI6ICJteV9kYXRhdGFibGVfIiwKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJInNDb29raWVQcmVmaXgiOiAiU3ByeU1lZGlhX0RhdGFUYWJsZXNfIiwKCQoJCgkJLyoqCgkJICogVGhpcyBpbml0aWFsaXNhdGlvbiB2YXJpYWJsZSBhbGxvd3MgeW91IHRvIHNwZWNpZnkgZXhhY3RseSB3aGVyZSBpbiB0aGUKCQkgKiBET00geW91IHdhbnQgRGF0YVRhYmxlcyB0byBpbmplY3QgdGhlIHZhcmlvdXMgY29udHJvbHMgaXQgYWRkcyB0byB0aGUgcGFnZQoJCSAqIChmb3IgZXhhbXBsZSB5b3UgbWlnaHQgd2FudCB0aGUgcGFnaW5hdGlvbiBjb250cm9scyBhdCB0aGUgdG9wIG9mIHRoZQoJCSAqIHRhYmxlKS4gRElWIGVsZW1lbnRzICh3aXRoIG9yIHdpdGhvdXQgYSBjdXN0b20gY2xhc3MpIGNhbiBhbHNvIGJlIGFkZGVkIHRvCgkJICogYWlkIHN0eWxpbmcuIFRoZSBmb2xsb3cgc3ludGF4IGlzIHVzZWQ6CgkJICogICA8dWw+CgkJICogICAgIDxsaT5UaGUgZm9sbG93aW5nIG9wdGlvbnMgYXJlIGFsbG93ZWQ6CQoJCSAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT4nbCcgLSBMZW5ndGggY2hhbmdpbmc8L2xpCgkJICogICAgICAgICA8bGk+J2YnIC0gRmlsdGVyaW5nIGlucHV0PC9saT4KCQkgKiAgICAgICAgIDxsaT4ndCcgLSBUaGUgdGFibGUhPC9saT4KCQkgKiAgICAgICAgIDxsaT4naScgLSBJbmZvcm1hdGlvbjwvbGk+CgkJICogICAgICAgICA8bGk+J3AnIC0gUGFnaW5hdGlvbjwvbGk+CgkJICogICAgICAgICA8bGk+J3InIC0gcFJvY2Vzc2luZzwvbGk+CgkJICogICAgICAgPC91bD4KCQkgKiAgICAgPC9saT4KCQkgKiAgICAgPGxpPlRoZSBmb2xsb3dpbmcgY29uc3RhbnRzIGFyZSBhbGxvd2VkOgoJCSAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT4nSCcgLSBqUXVlcnlVSSB0aGVtZSAiaGVhZGVyIiBjbGFzc2VzICgnZmctdG9vbGJhciB1aS13aWRnZXQtaGVhZGVyIHVpLWNvcm5lci10bCB1aS1jb3JuZXItdHIgdWktaGVscGVyLWNsZWFyZml4Jyk8L2xpPgoJCSAqICAgICAgICAgPGxpPidGJyAtIGpRdWVyeVVJIHRoZW1lICJmb290ZXIiIGNsYXNzZXMgKCdmZy10b29sYmFyIHVpLXdpZGdldC1oZWFkZXIgdWktY29ybmVyLWJsIHVpLWNvcm5lci1iciB1aS1oZWxwZXItY2xlYXJmaXgnKTwvbGk+CgkJICogICAgICAgPC91bD4KCQkgKiAgICAgPC9saT4KCQkgKiAgICAgPGxpPlRoZSBmb2xsb3dpbmcgc3ludGF4IGlzIGV4cGVjdGVkOgoJCSAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT4nJmx0OycgYW5kICcmZ3Q7JyAtIGRpdiBlbGVtZW50czwvbGk+CgkJICogICAgICAgICA8bGk+JyZsdDsiY2xhc3MiIGFuZCAnJmd0OycgLSBkaXYgd2l0aCBhIGNsYXNzPC9saT4KCQkgKiAgICAgICAgIDxsaT4nJmx0OyIjaWQiIGFuZCAnJmd0OycgLSBkaXYgd2l0aCBhbiBJRDwvbGk+CgkJICogICAgICAgPC91bD4KCQkgKiAgICAgPC9saT4KCQkgKiAgICAgPGxpPkV4YW1wbGVzOgoJCSAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT4nJmx0OyJ3cmFwcGVyImZsaXB0Jmd0Oyc8L2xpPgoJCSAqICAgICAgICAgPGxpPicmbHQ7bGYmbHQ7dCZndDtpcCZndDsnPC9saT4KCQkgKiAgICAgICA8L3VsPgoJCSAqICAgICA8L2xpPgoJCSAqICAgPC91bD4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IGxmcnRpcCA8aT4od2hlbiBiSlF1ZXJ5VUkgaXMgZmFsc2UpPC9pPiA8Yj5vcjwvYj4gCgkJICogICAgPCJIImxmcj50PCJGImlwPiA8aT4od2hlbiBiSlF1ZXJ5VUkgaXMgdHJ1ZSk8L2k+CgkJICogIEBkdG9wdCBPcHRpb25zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic0RvbSI6ICcmbHQ7InRvcCJpJmd0O3J0Jmx0OyJib3R0b20iZmxwJmd0OyZsdDsiY2xlYXIiJmd0OycKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJInNEb20iOiAibGZydGlwIiwKCQoJCgkJLyoqCgkJICogRGF0YVRhYmxlcyBmZWF0dXJlcyB0d28gZGlmZmVyZW50IGJ1aWx0LWluIHBhZ2luYXRpb24gaW50ZXJhY3Rpb24gbWV0aG9kcwoJCSAqICgndHdvX2J1dHRvbicgb3IgJ2Z1bGxfbnVtYmVycycpIHdoaWNoIHByZXNlbnQgZGlmZmVyZW50IHBhZ2UgY29udHJvbHMgdG8KCQkgKiB0aGUgZW5kIHVzZXIuIEZ1cnRoZXIgbWV0aG9kcyBjYW4gYmUgYWRkZWQgdXNpbmcgdGhlIEFQSSAoc2VlIGJlbG93KS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IHR3b19idXR0b24KCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic1BhZ2luYXRpb25UeXBlIjogImZ1bGxfbnVtYmVycyIKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICkKCQkgKi8KCQkic1BhZ2luYXRpb25UeXBlIjogInR3b19idXR0b24iLAoJCgkKCQkvKioKCQkgKiBFbmFibGUgaG9yaXpvbnRhbCBzY3JvbGxpbmcuIFdoZW4gYSB0YWJsZSBpcyB0b28gd2lkZSB0byBmaXQgaW50byBhIGNlcnRhaW4KCQkgKiBsYXlvdXQsIG9yIHlvdSBoYXZlIGEgbGFyZ2UgbnVtYmVyIG9mIGNvbHVtbnMgaW4gdGhlIHRhYmxlLCB5b3UgY2FuIGVuYWJsZQoJCSAqIHgtc2Nyb2xsaW5nIHRvIHNob3cgdGhlIHRhYmxlIGluIGEgdmlld3BvcnQsIHdoaWNoIGNhbiBiZSBzY3JvbGxlZC4gVGhpcwoJCSAqIHByb3BlcnR5IGNhbiBiZSBhbnkgQ1NTIHVuaXQsIG9yIGEgbnVtYmVyIChpbiB3aGljaCBjYXNlIGl0IHdpbGwgYmUgdHJlYXRlZAoJCSAqIGFzIGEgcGl4ZWwgbWVhc3VyZW1lbnQpLgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgPGk+Ymxhbmsgc3RyaW5nIC0gaS5lLiBkaXNhYmxlZDwvaT4KCQkgKiAgQGR0b3B0IEZlYXR1cmVzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic1Njcm9sbFgiOiAiMTAwJSIsCgkJICogICAgICAgICJiU2Nyb2xsQ29sbGFwc2UiOiB0cnVlCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJzU2Nyb2xsWCI6ICIiLAoJCgkKCQkvKioKCQkgKiBUaGlzIHByb3BlcnR5IGNhbiBiZSB1c2VkIHRvIGZvcmNlIGEgRGF0YVRhYmxlIHRvIHVzZSBtb3JlIHdpZHRoIHRoYW4gaXQKCQkgKiBtaWdodCBvdGhlcndpc2UgZG8gd2hlbiB4LXNjcm9sbGluZyBpcyBlbmFibGVkLiBGb3IgZXhhbXBsZSBpZiB5b3UgaGF2ZSBhCgkJICogdGFibGUgd2hpY2ggcmVxdWlyZXMgdG8gYmUgd2VsbCBzcGFjZWQsIHRoaXMgcGFyYW1ldGVyIGlzIHVzZWZ1bCBmb3IKCQkgKiAib3Zlci1zaXppbmciIHRoZSB0YWJsZSwgYW5kIHRodXMgZm9yY2luZyBzY3JvbGxpbmcuIFRoaXMgcHJvcGVydHkgY2FuIGJ5CgkJICogYW55IENTUyB1bml0LCBvciBhIG51bWJlciAoaW4gd2hpY2ggY2FzZSBpdCB3aWxsIGJlIHRyZWF0ZWQgYXMgYSBwaXhlbAoJCSAqIG1lYXN1cmVtZW50KS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IDxpPmJsYW5rIHN0cmluZyAtIGkuZS4gZGlzYWJsZWQ8L2k+CgkJICogIEBkdG9wdCBPcHRpb25zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic1Njcm9sbFgiOiAiMTAwJSIsCgkJICogICAgICAgICJzU2Nyb2xsWElubmVyIjogIjExMCUiCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJzU2Nyb2xsWElubmVyIjogIiIsCgkKCQoJCS8qKgoJCSAqIEVuYWJsZSB2ZXJ0aWNhbCBzY3JvbGxpbmcuIFZlcnRpY2FsIHNjcm9sbGluZyB3aWxsIGNvbnN0cmFpbiB0aGUgRGF0YVRhYmxlCgkJICogdG8gdGhlIGdpdmVuIGhlaWdodCwgYW5kIGVuYWJsZSBzY3JvbGxpbmcgZm9yIGFueSBkYXRhIHdoaWNoIG92ZXJmbG93cyB0aGUKCQkgKiBjdXJyZW50IHZpZXdwb3J0LiBUaGlzIGNhbiBiZSB1c2VkIGFzIGFuIGFsdGVybmF0aXZlIHRvIHBhZ2luZyB0byBkaXNwbGF5CgkJICogYSBsb3Qgb2YgZGF0YSBpbiBhIHNtYWxsIGFyZWEgKGFsdGhvdWdoIHBhZ2luZyBhbmQgc2Nyb2xsaW5nIGNhbiBib3RoIGJlCgkJICogZW5hYmxlZCBhdCB0aGUgc2FtZSB0aW1lKS4gVGhpcyBwcm9wZXJ0eSBjYW4gYmUgYW55IENTUyB1bml0LCBvciBhIG51bWJlcgoJCSAqIChpbiB3aGljaCBjYXNlIGl0IHdpbGwgYmUgdHJlYXRlZCBhcyBhIHBpeGVsIG1lYXN1cmVtZW50KS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IDxpPmJsYW5rIHN0cmluZyAtIGkuZS4gZGlzYWJsZWQ8L2k+CgkJICogIEBkdG9wdCBGZWF0dXJlcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgInNTY3JvbGxZIjogIjIwMHB4IiwKCQkgKiAgICAgICAgImJQYWdpbmF0ZSI6IGZhbHNlCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJzU2Nyb2xsWSI6ICIiLAoJCgkKCQkvKioKCQkgKiBTZXQgdGhlIEhUVFAgbWV0aG9kIHRoYXQgaXMgdXNlZCB0byBtYWtlIHRoZSBBamF4IGNhbGwgZm9yIHNlcnZlci1zaWRlCgkJICogcHJvY2Vzc2luZyBvciBBamF4IHNvdXJjZWQgZGF0YS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IEdFVAoJCSAqICBAZHRvcHQgT3B0aW9ucwoJCSAqICBAZHRvcHQgU2VydmVyLXNpZGUKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU2VydmVyU2lkZSI6IHRydWUsCgkJICogICAgICAgICJzQWpheFNvdXJjZSI6ICJzY3JpcHRzL3Bvc3QucGhwIiwKCQkgKiAgICAgICAgInNTZXJ2ZXJNZXRob2QiOiAiUE9TVCIKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJInNTZXJ2ZXJNZXRob2QiOiAiR0VUIgoJfTsKCQoJCgkKCS8qKgoJICogQ29sdW1uIG9wdGlvbnMgdGhhdCBjYW4gYmUgZ2l2ZW4gdG8gRGF0YVRhYmxlcyBhdCBpbml0aWFsaXNhdGlvbiB0aW1lLgoJICogIEBuYW1lc3BhY2UKCSAqLwoJRGF0YVRhYmxlLmRlZmF1bHRzLmNvbHVtbnMgPSB7CgkJLyoqCgkJICogQWxsb3dzIGEgY29sdW1uJ3Mgc29ydGluZyB0byB0YWtlIG11bHRpcGxlIGNvbHVtbnMgaW50byBhY2NvdW50IHdoZW4gCgkJICogZG9pbmcgYSBzb3J0LiBGb3IgZXhhbXBsZSBmaXJzdCBuYW1lIC8gbGFzdCBuYW1lIGNvbHVtbnMgbWFrZSBzZW5zZSB0byAKCQkgKiBkbyBhIG11bHRpLWNvbHVtbiBzb3J0IG92ZXIgdGhlIHR3byBjb2x1bW5zLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBudWxsIDxpPlRha2VzIHRoZSB2YWx1ZSBvZiB0aGUgY29sdW1uIGluZGV4IGF1dG9tYXRpY2FsbHk8L2k+CgkJICogIEBkdG9wdCBDb2x1bW5zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5EZWZzCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5EZWZzIjogWwoJCSAqICAgICAgICAgIHsgImFEYXRhU29ydCI6IFsgMCwgMSBdLCAiYVRhcmdldHMiOiBbIDAgXSB9LAoJCSAqICAgICAgICAgIHsgImFEYXRhU29ydCI6IFsgMSwgMCBdLCAiYVRhcmdldHMiOiBbIDEgXSB9LAoJCSAqICAgICAgICAgIHsgImFEYXRhU29ydCI6IFsgMiwgMywgNCBdLCAiYVRhcmdldHMiOiBbIDIgXSB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5zCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWwoJCSAqICAgICAgICAgIHsgImFEYXRhU29ydCI6IFsgMCwgMSBdIH0sCgkJICogICAgICAgICAgeyAiYURhdGFTb3J0IjogWyAxLCAwIF0gfSwKCQkgKiAgICAgICAgICB7ICJhRGF0YVNvcnQiOiBbIDIsIDMsIDQgXSB9LAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbAoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJhRGF0YVNvcnQiOiBudWxsLAoJCgkKCQkvKioKCQkgKiBZb3UgY2FuIGNvbnRyb2wgdGhlIGRlZmF1bHQgc29ydGluZyBkaXJlY3Rpb24sIGFuZCBldmVuIGFsdGVyIHRoZSBiZWhhdmlvdXIKCQkgKiBvZiB0aGUgc29ydCBoYW5kbGVyIChpLmUuIG9ubHkgYWxsb3cgYXNjZW5kaW5nIHNvcnRpbmcgZXRjKSB1c2luZyB0aGlzCgkJICogcGFyYW1ldGVyLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbICdhc2MnLCAnZGVzYycgXQoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1uRGVmcwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1uRGVmcyI6IFsKCQkgKiAgICAgICAgICB7ICJhc1NvcnRpbmciOiBbICJhc2MiIF0sICJhVGFyZ2V0cyI6IFsgMSBdIH0sCgkJICogICAgICAgICAgeyAiYXNTb3J0aW5nIjogWyAiZGVzYyIsICJhc2MiLCAiYXNjIiBdLCAiYVRhcmdldHMiOiBbIDIgXSB9LAoJCSAqICAgICAgICAgIHsgImFzU29ydGluZyI6IFsgImRlc2MiIF0sICJhVGFyZ2V0cyI6IFsgMyBdIH0KCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKiAgICAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbnMiOiBbCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICB7ICJhc1NvcnRpbmciOiBbICJhc2MiIF0gfSwKCQkgKiAgICAgICAgICB7ICJhc1NvcnRpbmciOiBbICJkZXNjIiwgImFzYyIsICJhc2MiIF0gfSwKCQkgKiAgICAgICAgICB7ICJhc1NvcnRpbmciOiBbICJkZXNjIiBdIH0sCgkJICogICAgICAgICAgbnVsbAoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJhc1NvcnRpbmciOiBbICdhc2MnLCAnZGVzYycgXSwKCQoJCgkJLyoqCgkJICogRW5hYmxlIG9yIGRpc2FibGUgZmlsdGVyaW5nIG9uIHRoZSBkYXRhIGluIHRoaXMgY29sdW1uLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IHRydWUKCQkgKiAgQGR0b3B0IENvbHVtbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbkRlZnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbkRlZnMiOiBbIAoJCSAqICAgICAgICAgIHsgImJTZWFyY2hhYmxlIjogZmFsc2UsICJhVGFyZ2V0cyI6IFsgMCBdIH0KCQkgKiAgICAgICAgXSB9ICk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1ucwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1ucyI6IFsgCgkJICogICAgICAgICAgeyAiYlNlYXJjaGFibGUiOiBmYWxzZSB9LAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwKCQkgKiAgICAgICAgXSB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJiU2VhcmNoYWJsZSI6IHRydWUsCgkKCQoJCS8qKgoJCSAqIEVuYWJsZSBvciBkaXNhYmxlIHNvcnRpbmcgb24gdGhpcyBjb2x1bW4uCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgdHJ1ZQoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1uRGVmcwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1uRGVmcyI6IFsgCgkJICogICAgICAgICAgeyAiYlNvcnRhYmxlIjogZmFsc2UsICJhVGFyZ2V0cyI6IFsgMCBdIH0KCQkgKiAgICAgICAgXSB9ICk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1ucwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1ucyI6IFsgCgkJICogICAgICAgICAgeyAiYlNvcnRhYmxlIjogZmFsc2UgfSwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsCgkJICogICAgICAgIF0gfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYlNvcnRhYmxlIjogdHJ1ZSwKCQoJCgkJLyoqCgkJICogV2hlbiB1c2luZyBmblJlbmRlcigpIGZvciBhIGNvbHVtbiwgeW91IG1heSB3aXNoIHRvIHVzZSB0aGUgb3JpZ2luYWwgZGF0YQoJCSAqIChiZWZvcmUgcmVuZGVyaW5nKSBmb3Igc29ydGluZyBhbmQgZmlsdGVyaW5nICh0aGUgZGVmYXVsdCBpcyB0byB1c2VkIHRoZQoJCSAqIHJlbmRlcmVkIGRhdGEgdGhhdCB0aGUgdXNlciBjYW4gc2VlKS4gVGhpcyBtYXkgYmUgdXNlZnVsIGZvciBkYXRlcyBldGMuCgkJICogCgkJICogKk5PVEUqIEl0IGlzIGl0IGlzIGFkdmlzYWJsZSBub3cgdG8gdXNlIG1EYXRhUHJvcCBhcyBhIGZ1bmN0aW9uIGFuZCBtYWtlIAoJCSAqIHVzZSBvZiB0aGUgJ3R5cGUnIHRoYXQgaXQgZ2l2ZXMsIGFsbG93aW5nIChwb3RlbnRpYWxseSkgZGlmZmVyZW50IGRhdGEgdG8KCQkgKiBiZSB1c2VkIGZvciBzb3J0aW5nLCBmaWx0ZXJpbmcsIGRpc3BsYXkgYW5kIHR5cGUgZGV0ZWN0aW9uLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IHRydWUKCQkgKiAgQGR0b3B0IENvbHVtbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbkRlZnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbkRlZnMiOiBbIAoJCSAqICAgICAgICAgIHsKCQkgKiAgICAgICAgICAgICJmblJlbmRlciI6IGZ1bmN0aW9uICggb09iaiApIHsKCQkgKiAgICAgICAgICAgICAgcmV0dXJuIG9PYmouYURhdGFbMF0gKycgJysgb09iai5hRGF0YVszXTsKCQkgKiAgICAgICAgICAgIH0sCgkJICogICAgICAgICAgICAiYlVzZVJlbmRlcmVkIjogZmFsc2UsCgkJICogICAgICAgICAgICAiYVRhcmdldHMiOiBbIDAgXQoJCSAqICAgICAgICAgIH0KCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKiAgICAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbnMiOiBbIAoJCSAqICAgICAgICAgIHsKCQkgKiAgICAgICAgICAgICJmblJlbmRlciI6IGZ1bmN0aW9uICggb09iaiApIHsKCQkgKiAgICAgICAgICAgICAgcmV0dXJuIG9PYmouYURhdGFbMF0gKycgJysgb09iai5hRGF0YVszXTsKCQkgKiAgICAgICAgICAgIH0sCgkJICogICAgICAgICAgICAiYlVzZVJlbmRlcmVkIjogZmFsc2UKCQkgKiAgICAgICAgICB9LAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwKCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYlVzZVJlbmRlcmVkIjogdHJ1ZSwKCQoJCgkJLyoqCgkJICogRW5hYmxlIG9yIGRpc2FibGUgdGhlIGRpc3BsYXkgb2YgdGhpcyBjb2x1bW4uCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgdHJ1ZQoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1uRGVmcwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1uRGVmcyI6IFsgCgkJICogICAgICAgICAgeyAiYlZpc2libGUiOiBmYWxzZSwgImFUYXJnZXRzIjogWyAwIF0gfQoJCSAqICAgICAgICBdIH0gKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5zCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWyAKCQkgKiAgICAgICAgICB7ICJiVmlzaWJsZSI6IGZhbHNlIH0sCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbAoJCSAqICAgICAgICBdIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImJWaXNpYmxlIjogdHJ1ZSwKCQkKCQkKCQkvKioKCQkgKiBEZXZlbG9wZXIgZGVmaW5hYmxlIGZ1bmN0aW9uIHRoYXQgaXMgY2FsbGVkIHdoZW5ldmVyIGEgY2VsbCBpcyBjcmVhdGVkIChBamF4IHNvdXJjZSwKCQkgKiBldGMpIG9yIHByb2Nlc3NlZCBmb3IgaW5wdXQgKERPTSBzb3VyY2UpLiBUaGlzIGNhbiBiZSB1c2VkIGFzIGEgY29tcGxpbWVudCB0byBmblJlbmRlcgoJCSAqIGFsbG93aW5nIHlvdSB0byBtb2RpZnkgdGhlIERPTSBlbGVtZW50IChhZGQgYmFja2dyb3VuZCBjb2xvdXIgZm9yIGV4YW1wbGUpIHdoZW4gdGhlCgkJICogZWxlbWVudCBpcyBhdmFpbGFibGUgKHNpbmNlIGl0IGlzIG5vdCB3aGVuIGZuUmVuZGVyIGlzIGNhbGxlZCkuCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7ZWxlbWVudH0gblRkIFRoZSBURCBub2RlIHRoYXQgaGFzIGJlZW4gY3JlYXRlZAoJCSAqICBAcGFyYW0geyp9IHNEYXRhIFRoZSBEYXRhIGZvciB0aGUgY2VsbAoJCSAqICBAcGFyYW0ge2FycmF5fG9iamVjdH0gb0RhdGEgVGhlIGRhdGEgZm9yIHRoZSB3aG9sZSByb3cKCQkgKiAgQHBhcmFtIHtpbnR9IGlSb3cgVGhlIHJvdyBpbmRleCBmb3IgdGhlIGFvRGF0YSBkYXRhIHN0b3JlCgkJICogIEBwYXJhbSB7aW50fSBpQ29sIFRoZSBjb2x1bW4gaW5kZXggZm9yIGFvQ29sdW1ucwoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1uRGVmcyI6IFsgewoJCSAqICAgICAgICAgICJhVGFyZ2V0cyI6IFszXSwKCQkgKiAgICAgICAgICAiZm5DcmVhdGVkQ2VsbCI6IGZ1bmN0aW9uIChuVGQsIHNEYXRhLCBvRGF0YSwgaVJvdywgaUNvbCkgewoJCSAqICAgICAgICAgICAgaWYgKCBzRGF0YSA9PSAiMS43IiApIHsKCQkgKiAgICAgICAgICAgICAgJChuVGQpLmNzcygnY29sb3InLCAnYmx1ZScpCgkJICogICAgICAgICAgICB9CgkJICogICAgICAgICAgfQoJCSAqICAgICAgICB9IF0KCQkgKiAgICAgIH0pOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiZm5DcmVhdGVkQ2VsbCI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIEN1c3RvbSBkaXNwbGF5IGZ1bmN0aW9uIHRoYXQgd2lsbCBiZSBjYWxsZWQgZm9yIHRoZSBkaXNwbGF5IG9mIGVhY2ggY2VsbCBpbgoJCSAqIHRoaXMgY29sdW1uLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAcGFyYW0ge29iamVjdH0gbyBPYmplY3Qgd2l0aCB0aGUgZm9sbG93aW5nIHBhcmFtZXRlcnM6CgkJICogIEBwYXJhbSB7aW50fSAgICBvLmlEYXRhUm93IFRoZSByb3cgaW4gYW9EYXRhCgkJICogIEBwYXJhbSB7aW50fSAgICBvLmlEYXRhQ29sdW1uIFRoZSBjb2x1bW4gaW4gcXVlc3Rpb24KCQkgKiAgQHBhcmFtIHthcnJheX0gIG8uYURhdGEgVGhlIGRhdGEgZm9yIHRoZSByb3cgaW4gcXVlc3Rpb24KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG8ub1NldHRpbmdzIFRoZSBzZXR0aW5ncyBvYmplY3QgZm9yIHRoaXMgRGF0YVRhYmxlcyBpbnN0YW5jZQoJCSAqICBAcGFyYW0ge29iamVjdH0gby5tRGF0YVByb3AgVGhlIGRhdGEgcHJvcGVydHkgdXNlZCBmb3IgdGhpcyBjb2x1bW4KCQkgKiAgQHBhcmFtIHsqfSAgICAgIHZhbCBUaGUgY3VycmVudCBjZWxsIHZhbHVlCgkJICogIEByZXR1cm5zIHtzdHJpbmd9IFRoZSBzdHJpbmcgeW91IHdoaWNoIHRvIHVzZSBpbiB0aGUgZGlzcGxheQoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1uRGVmcwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1uRGVmcyI6IFsgCgkJICogICAgICAgICAgewoJCSAqICAgICAgICAgICAgImZuUmVuZGVyIjogZnVuY3Rpb24gKCBvLCB2YWwgKSB7CgkJICogICAgICAgICAgICAgIHJldHVybiBvLmFEYXRhWzBdICsnICcrIG8uYURhdGFbM107CgkJICogICAgICAgICAgICB9LAoJCSAqICAgICAgICAgICAgImFUYXJnZXRzIjogWyAwIF0KCQkgKiAgICAgICAgICB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5zCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWyAKCQkgKiAgICAgICAgICB7ICJmblJlbmRlciI6IGZ1bmN0aW9uICggbywgdmFsICkgewoJCSAqICAgICAgICAgICAgcmV0dXJuIG8uYURhdGFbMF0gKycgJysgby5hRGF0YVszXTsKCQkgKiAgICAgICAgICB9IH0sCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbAoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJmblJlbmRlciI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIFRoZSBjb2x1bW4gaW5kZXggKHN0YXJ0aW5nIGZyb20gMCEpIHRoYXQgeW91IHdpc2ggYSBzb3J0IHRvIGJlIHBlcmZvcm1lZAoJCSAqIHVwb24gd2hlbiB0aGlzIGNvbHVtbiBpcyBzZWxlY3RlZCBmb3Igc29ydGluZy4gVGhpcyBjYW4gYmUgdXNlZCBmb3Igc29ydGluZwoJCSAqIG9uIGhpZGRlbiBjb2x1bW5zIGZvciBleGFtcGxlLgoJCSAqICBAdHlwZSBpbnQKCQkgKiAgQGRlZmF1bHQgLTEgPGk+VXNlIGF1dG9tYXRpY2FsbHkgY2FsY3VsYXRlZCBjb2x1bW4gaW5kZXg8L2k+CgkJICogIEBkdG9wdCBDb2x1bW5zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5EZWZzCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5EZWZzIjogWyAKCQkgKiAgICAgICAgICB7ICJpRGF0YVNvcnQiOiAxLCAiYVRhcmdldHMiOiBbIDAgXSB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5zCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWyAKCQkgKiAgICAgICAgICB7ICJpRGF0YVNvcnQiOiAxIH0sCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbAoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJpRGF0YVNvcnQiOiAtMSwKCQoJCgkJLyoqCgkJICogVGhpcyBwcm9wZXJ0eSBjYW4gYmUgdXNlZCB0byByZWFkIGRhdGEgZnJvbSBhbnkgSlNPTiBkYXRhIHNvdXJjZSBwcm9wZXJ0eSwKCQkgKiBpbmNsdWRpbmcgZGVlcGx5IG5lc3RlZCBvYmplY3RzIC8gcHJvcGVydGllcy4gbURhdGFQcm9wIGNhbiBiZSBnaXZlbiBpbiBhCgkJICogbnVtYmVyIG9mIGRpZmZlcmVudCB3YXlzIHdoaWNoIGVmZmVjdCBpdHMgYmVoYXZpb3VyOgoJCSAqICAgPHVsPgoJCSAqICAgICA8bGk+aW50ZWdlciAtIHRyZWF0ZWQgYXMgYW4gYXJyYXkgaW5kZXggZm9yIHRoZSBkYXRhIHNvdXJjZS4gVGhpcyBpcyB0aGUKCQkgKiAgICAgICBkZWZhdWx0IHRoYXQgRGF0YVRhYmxlcyB1c2VzIChpbmNyZW1lbnRhbGx5IGluY3JlYXNlZCBmb3IgZWFjaCBjb2x1bW4pLjwvbGk+CgkJICogICAgIDxsaT5zdHJpbmcgLSByZWFkIGFuIG9iamVjdCBwcm9wZXJ0eSBmcm9tIHRoZSBkYXRhIHNvdXJjZS4gTm90ZSB0aGF0IHlvdSBjYW4KCQkgKiAgICAgICB1c2UgSmF2YXNjcmlwdCBkb3R0ZWQgbm90YXRpb24gdG8gcmVhZCBkZWVwIHByb3BlcnRpZXMvYXJyYXlzIGZyb20gdGhlCgkJICogICAgICAgZGF0YSBzb3VyY2UuPC9saT4KCQkgKiAgICAgPGxpPm51bGwgLSB0aGUgc0RlZmF1bHRDb250ZW50IG9wdGlvbiB3aWxsIGJlIHVzZWQgZm9yIHRoZSBjZWxsIChudWxsCgkJICogICAgICAgYnkgZGVmYXVsdCwgc28geW91IHdpbGwgbmVlZCB0byBzcGVjaWZ5IHRoZSBkZWZhdWx0IGNvbnRlbnQgeW91IHdhbnQgLQoJCSAqICAgICAgIHR5cGljYWxseSBhbiBlbXB0eSBzdHJpbmcpLiBUaGlzIGNhbiBiZSB1c2VmdWwgb24gZ2VuZXJhdGVkIGNvbHVtbnMgc3VjaCAKCQkgKiAgICAgICBhcyBlZGl0IC8gZGVsZXRlIGFjdGlvbiBjb2x1bW5zLjwvbGk+CgkJICogICAgIDxsaT5mdW5jdGlvbiAtIHRoZSBmdW5jdGlvbiBnaXZlbiB3aWxsIGJlIGV4ZWN1dGVkIHdoZW5ldmVyIERhdGFUYWJsZXMgCgkJICogICAgICAgbmVlZHMgdG8gc2V0IG9yIGdldCB0aGUgZGF0YSBmb3IgYSBjZWxsIGluIHRoZSBjb2x1bW4uIFRoZSBmdW5jdGlvbiAKCQkgKiAgICAgICB0YWtlcyB0aHJlZSBwYXJhbWV0ZXJzOgoJCSAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT57YXJyYXl8b2JqZWN0fSBUaGUgZGF0YSBzb3VyY2UgZm9yIHRoZSByb3c8L2xpPgoJCSAqICAgICAgICAgPGxpPntzdHJpbmd9IFRoZSB0eXBlIGNhbGwgZGF0YSByZXF1ZXN0ZWQgLSB0aGlzIHdpbGwgYmUgJ3NldCcgd2hlbgoJCSAqICAgICAgICAgICBzZXR0aW5nIGRhdGEgb3IgJ2ZpbHRlcicsICdkaXNwbGF5JywgJ3R5cGUnLCAnc29ydCcgb3IgdW5kZWZpbmVkIHdoZW4gCgkJICogICAgICAgICAgIGdhdGhlcmluZyBkYXRhLiBOb3RlIHRoYXQgd2hlbiA8aT51bmRlZmluZWQ8L2k+IGlzIGdpdmVuIGZvciB0aGUgdHlwZQoJCSAqICAgICAgICAgICBEYXRhVGFibGVzIGV4cGVjdHMgdG8gZ2V0IHRoZSByYXcgZGF0YSBmb3IgdGhlIG9iamVjdCBiYWNrPC9saT4KCQkgKiAgICAgICAgIDxsaT57Kn0gRGF0YSB0byBzZXQgd2hlbiB0aGUgc2Vjb25kIHBhcmFtZXRlciBpcyAnc2V0Jy48L2xpPgoJCSAqICAgICAgIDwvdWw+CgkJICogICAgICAgVGhlIHJldHVybiB2YWx1ZSBmcm9tIHRoZSBmdW5jdGlvbiBpcyBub3QgcmVxdWlyZWQgd2hlbiAnc2V0JyBpcyB0aGUgdHlwZQoJCSAqICAgICAgIG9mIGNhbGwsIGJ1dCBvdGhlcndpc2UgdGhlIHJldHVybiBpcyB3aGF0IHdpbGwgYmUgdXNlZCBmb3IgdGhlIGRhdGEKCQkgKiAgICAgICByZXF1ZXN0ZWQuPC9saT4KCQkgKiAgICA8L3VsPgoJCSAqICBAdHlwZSBzdHJpbmd8aW50fGZ1bmN0aW9ufG51bGwKCQkgKiAgQGRlZmF1bHQgbnVsbCA8aT5Vc2UgYXV0b21hdGljYWxseSBjYWxjdWxhdGVkIGNvbHVtbiBpbmRleDwvaT4KCQkgKiAgQGR0b3B0IENvbHVtbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBSZWFkIHRhYmxlIGRhdGEgZnJvbSBvYmplY3RzCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgInNBamF4U291cmNlIjogInNvdXJjZXMvZGVlcC50eHQiLAoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWwoJCSAqICAgICAgICAgIHsgIm1EYXRhUHJvcCI6ICJlbmdpbmUiIH0sCgkJICogICAgICAgICAgeyAibURhdGFQcm9wIjogImJyb3dzZXIiIH0sCgkJICogICAgICAgICAgeyAibURhdGFQcm9wIjogInBsYXRmb3JtLmlubmVyIiB9LAoJCSAqICAgICAgICAgIHsgIm1EYXRhUHJvcCI6ICJwbGF0Zm9ybS5kZXRhaWxzLjAiIH0sCgkJICogICAgICAgICAgeyAibURhdGFQcm9wIjogInBsYXRmb3JtLmRldGFpbHMuMSIgfQoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIG1EYXRhUHJvcCBhcyBhIGZ1bmN0aW9uIHRvIHByb3ZpZGUgZGlmZmVyZW50IGluZm9ybWF0aW9uIGZvcgoJCSAqICAgIC8vIHNvcnRpbmcsIGZpbHRlcmluZyBhbmQgZGlzcGxheS4gSW4gdGhpcyBjYXNlLCBjdXJyZW5jeSAocHJpY2UpCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1uRGVmcyI6IFsKCQkgKiAgICAgICAgewoJCSAqICAgICAgICAgICJhVGFyZ2V0cyI6IFsgMCBdLAoJCSAqICAgICAgICAgICJtRGF0YVByb3AiOiBmdW5jdGlvbiAoIHNvdXJjZSwgdHlwZSwgdmFsICkgewoJCSAqICAgICAgICAgICAgaWYgKHR5cGUgPT09ICdzZXQnKSB7CgkJICogICAgICAgICAgICAgIHNvdXJjZS5wcmljZSA9IHZhbDsKCQkgKiAgICAgICAgICAgICAgLy8gU3RvcmUgdGhlIGNvbXB1dGVkIGRpc2xheSBhbmQgZmlsdGVyIHZhbHVlcyBmb3IgZWZmaWNpZW5jeQoJCSAqICAgICAgICAgICAgICBzb3VyY2UucHJpY2VfZGlzcGxheSA9IHZhbD09IiIgPyAiIiA6ICIkIitudW1iZXJGb3JtYXQodmFsKTsKCQkgKiAgICAgICAgICAgICAgc291cmNlLnByaWNlX2ZpbHRlciAgPSB2YWw9PSIiID8gIiIgOiAiJCIrbnVtYmVyRm9ybWF0KHZhbCkrIiAiK3ZhbDsKCQkgKiAgICAgICAgICAgICAgcmV0dXJuOwoJCSAqICAgICAgICAgICAgfQoJCSAqICAgICAgICAgICAgZWxzZSBpZiAodHlwZSA9PT0gJ2Rpc3BsYXknKSB7CgkJICogICAgICAgICAgICAgIHJldHVybiBzb3VyY2UucHJpY2VfZGlzcGxheTsKCQkgKiAgICAgICAgICAgIH0KCQkgKiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGUgPT09ICdmaWx0ZXInKSB7CgkJICogICAgICAgICAgICAgIHJldHVybiBzb3VyY2UucHJpY2VfZmlsdGVyOwoJCSAqICAgICAgICAgICAgfQoJCSAqICAgICAgICAgICAgLy8gJ3NvcnQnLCAndHlwZScgYW5kIHVuZGVmaW5lZCBhbGwganVzdCB1c2UgdGhlIGludGVnZXIKCQkgKiAgICAgICAgICAgIHJldHVybiBzb3VyY2UucHJpY2U7CgkJICogICAgICAgICAgfQoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJtRGF0YVByb3AiOiBudWxsLAoJCgkKCQkvKioKCQkgKiBDaGFuZ2UgdGhlIGNlbGwgdHlwZSBjcmVhdGVkIGZvciB0aGUgY29sdW1uIC0gZWl0aGVyIFREIGNlbGxzIG9yIFRIIGNlbGxzLiBUaGlzCgkJICogY2FuIGJlIHVzZWZ1bCBhcyBUSCBjZWxscyBoYXZlIHNlbWFudGljIG1lYW5pbmcgaW4gdGhlIHRhYmxlIGJvZHksIGFsbG93aW5nIHRoZW0KCQkgKiB0byBhY3QgYXMgYSBoZWFkZXIgZm9yIGEgcm93ICh5b3UgbWF5IHdpc2ggdG8gYWRkIHNjb3BlPSdyb3cnIHRvIHRoZSBUSCBlbGVtZW50cykuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCB0ZAoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIE1ha2UgdGhlIGZpcnN0IGNvbHVtbiB1c2UgVEggY2VsbHMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5EZWZzIjogWwoJCSAqICAgICAgICB7CgkJICogICAgICAgICAgImFUYXJnZXRzIjogWyAwIF0sCgkJICogICAgICAgICAgInNDZWxsVHlwZSI6ICJ0aCIKCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkic0NlbGxUeXBlIjogInRkIiwKCQoJCgkJLyoqCgkJICogQ2xhc3MgdG8gZ2l2ZSB0byBlYWNoIGNlbGwgaW4gdGhpcyBjb2x1bW4uCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCA8aT5FbXB0eSBzdHJpbmc8L2k+CgkJICogIEBkdG9wdCBDb2x1bW5zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5EZWZzCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5EZWZzIjogWyAKCQkgKiAgICAgICAgICB7ICJzQ2xhc3MiOiAibXlfY2xhc3MiLCAiYVRhcmdldHMiOiBbIDAgXSB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5zCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWyAKCQkgKiAgICAgICAgICB7ICJzQ2xhc3MiOiAibXlfY2xhc3MiIH0sCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbAoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJzQ2xhc3MiOiAiIiwKCQkKCQkvKioKCQkgKiBXaGVuIERhdGFUYWJsZXMgY2FsY3VsYXRlcyB0aGUgY29sdW1uIHdpZHRocyB0byBhc3NpZ24gdG8gZWFjaCBjb2x1bW4sCgkJICogaXQgZmluZHMgdGhlIGxvbmdlc3Qgc3RyaW5nIGluIGVhY2ggY29sdW1uIGFuZCB0aGVuIGNvbnN0cnVjdHMgYQoJCSAqIHRlbXBvcmFyeSB0YWJsZSBhbmQgcmVhZHMgdGhlIHdpZHRocyBmcm9tIHRoYXQuIFRoZSBwcm9ibGVtIHdpdGggdGhpcwoJCSAqIGlzIHRoYXQgIm1tbSIgaXMgbXVjaCB3aWRlciB0aGVuICJpaWlpIiwgYnV0IHRoZSBsYXR0ZXIgaXMgYSBsb25nZXIgCgkJICogc3RyaW5nIC0gdGh1cyB0aGUgY2FsY3VsYXRpb24gY2FuIGdvIHdyb25nIChkb2luZyBpdCBwcm9wZXJseSBhbmQgcHV0dGluZwoJCSAqIGl0IGludG8gYW4gRE9NIG9iamVjdCBhbmQgbWVhc3VyaW5nIHRoYXQgaXMgaG9ycmlibHkoISkgc2xvdykuIFRodXMgYXMKCQkgKiBhICJ3b3JrIGFyb3VuZCIgd2UgcHJvdmlkZSB0aGlzIG9wdGlvbi4gSXQgd2lsbCBhcHBlbmQgaXRzIHZhbHVlIHRvIHRoZQoJCSAqIHRleHQgdGhhdCBpcyBmb3VuZCB0byBiZSB0aGUgbG9uZ2VzdCBzdHJpbmcgZm9yIHRoZSBjb2x1bW4gLSBpLmUuIHBhZGRpbmcuCgkJICogR2VuZXJhbGx5IHlvdSBzaG91bGRuJ3QgbmVlZCB0aGlzLCBhbmQgaXQgaXMgbm90IGRvY3VtZW50ZWQgb24gdGhlIAoJCSAqIGdlbmVyYWwgRGF0YVRhYmxlcy5uZXQgZG9jdW1lbnRhdGlvbgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgPGk+RW1wdHkgc3RyaW5nPGk+CgkJICogIEBkdG9wdCBDb2x1bW5zCgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5zCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWyAKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICB7CgkJICogICAgICAgICAgICAic0NvbnRlbnRQYWRkaW5nIjogIm1tbSIKCQkgKiAgICAgICAgICB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJInNDb250ZW50UGFkZGluZyI6ICIiLAoJCgkKCQkvKioKCQkgKiBBbGxvd3MgYSBkZWZhdWx0IHZhbHVlIHRvIGJlIGdpdmVuIGZvciBhIGNvbHVtbidzIGRhdGEsIGFuZCB3aWxsIGJlIHVzZWQKCQkgKiB3aGVuZXZlciBhIG51bGwgZGF0YSBzb3VyY2UgaXMgZW5jb3VudGVyZWQgKHRoaXMgY2FuIGJlIGJlY2F1c2UgbURhdGFQcm9wCgkJICogaXMgc2V0IHRvIG51bGwsIG9yIGJlY2F1c2UgdGhlIGRhdGEgc291cmNlIGl0c2VsZiBpcyBudWxsKS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKiAgQGR0b3B0IENvbHVtbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbkRlZnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbkRlZnMiOiBbIAoJCSAqICAgICAgICAgIHsKCQkgKiAgICAgICAgICAgICJtRGF0YVByb3AiOiBudWxsLAoJCSAqICAgICAgICAgICAgInNEZWZhdWx0Q29udGVudCI6ICJFZGl0IiwKCQkgKiAgICAgICAgICAgICJhVGFyZ2V0cyI6IFsgLTEgXQoJCSAqICAgICAgICAgIH0KCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKiAgICAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbnMiOiBbIAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIHsKCQkgKiAgICAgICAgICAgICJtRGF0YVByb3AiOiBudWxsLAoJCSAqICAgICAgICAgICAgInNEZWZhdWx0Q29udGVudCI6ICJFZGl0IgoJCSAqICAgICAgICAgIH0KCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkic0RlZmF1bHRDb250ZW50IjogbnVsbCwKCQoJCgkJLyoqCgkJICogVGhpcyBwYXJhbWV0ZXIgaXMgb25seSB1c2VkIGluIERhdGFUYWJsZXMnIHNlcnZlci1zaWRlIHByb2Nlc3NpbmcuIEl0IGNhbgoJCSAqIGJlIGV4Y2VwdGlvbmFsbHkgdXNlZnVsIHRvIGtub3cgd2hhdCBjb2x1bW5zIGFyZSBiZWluZyBkaXNwbGF5ZWQgb24gdGhlCgkJICogY2xpZW50IHNpZGUsIGFuZCB0byBtYXAgdGhlc2UgdG8gZGF0YWJhc2UgZmllbGRzLiBXaGVuIGRlZmluZWQsIHRoZSBuYW1lcwoJCSAqIGFsc28gYWxsb3cgRGF0YVRhYmxlcyB0byByZW9yZGVyIGluZm9ybWF0aW9uIGZyb20gdGhlIHNlcnZlciBpZiBpdCBjb21lcwoJCSAqIGJhY2sgaW4gYW4gdW5leHBlY3RlZCBvcmRlciAoaS5lLiBpZiB5b3Ugc3dpdGNoIHlvdXIgY29sdW1ucyBhcm91bmQgb24gdGhlCgkJICogY2xpZW50LXNpZGUsIHlvdXIgc2VydmVyLXNpZGUgY29kZSBkb2VzIG5vdCBhbHNvIG5lZWQgdXBkYXRpbmcpLgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgPGk+RW1wdHkgc3RyaW5nPC9pPgoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1uRGVmcwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1uRGVmcyI6IFsgCgkJICogICAgICAgICAgeyAic05hbWUiOiAiZW5naW5lIiwgImFUYXJnZXRzIjogWyAwIF0gfSwKCQkgKiAgICAgICAgICB7ICJzTmFtZSI6ICJicm93c2VyIiwgImFUYXJnZXRzIjogWyAxIF0gfSwKCQkgKiAgICAgICAgICB7ICJzTmFtZSI6ICJwbGF0Zm9ybSIsICJhVGFyZ2V0cyI6IFsgMiBdIH0sCgkJICogICAgICAgICAgeyAic05hbWUiOiAidmVyc2lvbiIsICJhVGFyZ2V0cyI6IFsgMyBdIH0sCgkJICogICAgICAgICAgeyAic05hbWUiOiAiZ3JhZGUiLCAiYVRhcmdldHMiOiBbIDQgXSB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5zCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWyAKCQkgKiAgICAgICAgICB7ICJzTmFtZSI6ICJlbmdpbmUiIH0sCgkJICogICAgICAgICAgeyAic05hbWUiOiAiYnJvd3NlciIgfSwKCQkgKiAgICAgICAgICB7ICJzTmFtZSI6ICJwbGF0Zm9ybSIgfSwKCQkgKiAgICAgICAgICB7ICJzTmFtZSI6ICJ2ZXJzaW9uIiB9LAoJCSAqICAgICAgICAgIHsgInNOYW1lIjogImdyYWRlIiB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJInNOYW1lIjogIiIsCgkKCQoJCS8qKgoJCSAqIERlZmluZXMgYSBkYXRhIHNvdXJjZSB0eXBlIGZvciB0aGUgc29ydGluZyB3aGljaCBjYW4gYmUgdXNlZCB0byByZWFkCgkJICogcmVhbHRpbWUgaW5mb3JtYXRpb24gZnJvbSB0aGUgdGFibGUgKHVwZGF0aW5nIHRoZSBpbnRlcm5hbGx5IGNhY2hlZAoJCSAqIHZlcnNpb24pIHByaW9yIHRvIHNvcnRpbmcuIFRoaXMgYWxsb3dzIHNvcnRpbmcgdG8gb2NjdXIgb24gdXNlciBlZGl0YWJsZQoJCSAqIGVsZW1lbnRzIHN1Y2ggYXMgZm9ybSBpbnB1dHMuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBzdGQKCQkgKiAgQGR0b3B0IENvbHVtbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbkRlZnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbkRlZnMiOiBbCgkJICogICAgICAgICAgeyAic1NvcnREYXRhVHlwZSI6ICJkb20tdGV4dCIsICJhVGFyZ2V0cyI6IFsgMiwgMyBdIH0sCgkJICogICAgICAgICAgeyAic1R5cGUiOiAibnVtZXJpYyIsICJhVGFyZ2V0cyI6IFsgMyBdIH0sCgkJICogICAgICAgICAgeyAic1NvcnREYXRhVHlwZSI6ICJkb20tc2VsZWN0IiwgImFUYXJnZXRzIjogWyA0IF0gfSwKCQkgKiAgICAgICAgICB7ICJzU29ydERhdGFUeXBlIjogImRvbS1jaGVja2JveCIsICJhVGFyZ2V0cyI6IFsgNSBdIH0KCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKiAgICAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbnMiOiBbCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIHsgInNTb3J0RGF0YVR5cGUiOiAiZG9tLXRleHQiIH0sCgkJICogICAgICAgICAgeyAic1NvcnREYXRhVHlwZSI6ICJkb20tdGV4dCIsICJzVHlwZSI6ICJudW1lcmljIiB9LAoJCSAqICAgICAgICAgIHsgInNTb3J0RGF0YVR5cGUiOiAiZG9tLXNlbGVjdCIgfSwKCQkgKiAgICAgICAgICB7ICJzU29ydERhdGFUeXBlIjogImRvbS1jaGVja2JveCIgfQoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJzU29ydERhdGFUeXBlIjogInN0ZCIsCgkKCQoJCS8qKgoJCSAqIFRoZSB0aXRsZSBvZiB0aGlzIGNvbHVtbi4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IG51bGwgPGk+RGVyaXZlZCBmcm9tIHRoZSAnVEgnIHZhbHVlIGZvciB0aGlzIGNvbHVtbiBpbiB0aGUgCgkJICogICAgb3JpZ2luYWwgSFRNTCB0YWJsZS48L2k+CgkJICogIEBkdG9wdCBDb2x1bW5zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5EZWZzCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5EZWZzIjogWyAKCQkgKiAgICAgICAgICB7ICJzVGl0bGUiOiAiTXkgY29sdW1uIHRpdGxlIiwgImFUYXJnZXRzIjogWyAwIF0gfQoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1ucwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1ucyI6IFsgCgkJICogICAgICAgICAgeyAic1RpdGxlIjogIk15IGNvbHVtbiB0aXRsZSIgfSwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsCgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJInNUaXRsZSI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIFRoZSB0eXBlIGFsbG93cyB5b3UgdG8gc3BlY2lmeSBob3cgdGhlIGRhdGEgZm9yIHRoaXMgY29sdW1uIHdpbGwgYmUgc29ydGVkLgoJCSAqIEZvdXIgdHlwZXMgKHN0cmluZywgbnVtZXJpYywgZGF0ZSBhbmQgaHRtbCAod2hpY2ggd2lsbCBzdHJpcCBIVE1MIHRhZ3MKCQkgKiBiZWZvcmUgc29ydGluZykpIGFyZSBjdXJyZW50bHkgYXZhaWxhYmxlLiBOb3RlIHRoYXQgb25seSBkYXRlIGZvcm1hdHMKCQkgKiB1bmRlcnN0b29kIGJ5IEphdmFzY3JpcHQncyBEYXRlKCkgb2JqZWN0IHdpbGwgYmUgYWNjZXB0ZWQgYXMgdHlwZSBkYXRlLiBGb3IKCQkgKiBleGFtcGxlOiAiTWFyIDI2LCAyMDA4IDU6MDMgUE0iLiBNYXkgdGFrZSB0aGUgdmFsdWVzOiAnc3RyaW5nJywgJ251bWVyaWMnLAoJCSAqICdkYXRlJyBvciAnaHRtbCcgKGJ5IGRlZmF1bHQpLiBGdXJ0aGVyIHR5cGVzIGNhbiBiZSBhZGRpbmcgdGhyb3VnaAoJCSAqIHBsdWctaW5zLgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgbnVsbCA8aT5BdXRvLWRldGVjdGVkIGZyb20gcmF3IGRhdGE8L2k+CgkJICogIEBkdG9wdCBDb2x1bW5zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5EZWZzCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5EZWZzIjogWyAKCQkgKiAgICAgICAgICB7ICJzVHlwZSI6ICJodG1sIiwgImFUYXJnZXRzIjogWyAwIF0gfQoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1ucwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1ucyI6IFsgCgkJICogICAgICAgICAgeyAic1R5cGUiOiAiaHRtbCIgfSwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsCgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJInNUeXBlIjogbnVsbCwKCQoJCgkJLyoqCgkJICogRGVmaW5pbmcgdGhlIHdpZHRoIG9mIHRoZSBjb2x1bW4sIHRoaXMgcGFyYW1ldGVyIG1heSB0YWtlIGFueSBDU1MgdmFsdWUKCQkgKiAoM2VtLCAyMHB4IGV0YykuIERhdGFUYWJsZXMgYXBwbHlzICdzbWFydCcgd2lkdGhzIHRvIGNvbHVtbnMgd2hpY2ggaGF2ZSBub3QKCQkgKiBiZWVuIGdpdmVuIGEgc3BlY2lmaWMgd2lkdGggdGhyb3VnaCB0aGlzIGludGVyZmFjZSBlbnN1cmluZyB0aGF0IHRoZSB0YWJsZQoJCSAqIHJlbWFpbnMgcmVhZGFibGUuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBudWxsIDxpPkF1dG9tYXRpYzwvaT4KCQkgKiAgQGR0b3B0IENvbHVtbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbkRlZnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbkRlZnMiOiBbIAoJCSAqICAgICAgICAgIHsgInNXaWR0aCI6ICIyMCUiLCAiYVRhcmdldHMiOiBbIDAgXSB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5zCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWyAKCQkgKiAgICAgICAgICB7ICJzV2lkdGgiOiAiMjAlIiB9LAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwKCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkic1dpZHRoIjogbnVsbAoJfTsKCQoJCgkKCS8qKgoJICogRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QgLSB0aGlzIGhvbGRzIGFsbCB0aGUgaW5mb3JtYXRpb24gbmVlZGVkIGZvciBhCgkgKiBnaXZlbiB0YWJsZSwgaW5jbHVkaW5nIGNvbmZpZ3VyYXRpb24sIGRhdGEgYW5kIGN1cnJlbnQgYXBwbGljYXRpb24gb2YgdGhlCgkgKiB0YWJsZSBvcHRpb25zLiBEYXRhVGFibGVzIGRvZXMgbm90IGhhdmUgYSBzaW5nbGUgaW5zdGFuY2UgZm9yIGVhY2ggRGF0YVRhYmxlCgkgKiB3aXRoIHRoZSBzZXR0aW5ncyBhdHRhY2hlZCB0byB0aGF0IGluc3RhbmNlLCBidXQgcmF0aGVyIGluc3RhbmNlcyBvZiB0aGUKCSAqIERhdGFUYWJsZSAiY2xhc3MiIGFyZSBjcmVhdGVkIG9uLXRoZS1mbHkgYXMgbmVlZGVkICh0eXBpY2FsbHkgYnkgYSAKCSAqICQoKS5kYXRhVGFibGUoKSBjYWxsKSBhbmQgdGhlIHNldHRpbmdzIG9iamVjdCBpcyB0aGVuIGFwcGxpZWQgdG8gdGhhdAoJICogaW5zdGFuY2UuCgkgKiAKCSAqIE5vdGUgdGhhdCB0aGlzIG9iamVjdCBpcyByZWxhdGVkIHRvIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9IGJ1dCB0aGlzIAoJICogb25lIGlzIHRoZSBpbnRlcm5hbCBkYXRhIHN0b3JlIGZvciBEYXRhVGFibGVzJ3MgY2FjaGUgb2YgY29sdW1ucy4gSXQgc2hvdWxkCgkgKiBOT1QgYmUgbWFuaXB1bGF0ZWQgb3V0c2lkZSBvZiBEYXRhVGFibGVzLiBBbnkgY29uZmlndXJhdGlvbiBzaG91bGQgYmUgZG9uZQoJICogdGhyb3VnaCB0aGUgaW5pdGlhbGlzYXRpb24gb3B0aW9ucy4KCSAqICBAbmFtZXNwYWNlCgkgKiAgQHRvZG8gUmVhbGx5IHNob3VsZCBhdHRhY2ggdGhlIHNldHRpbmdzIG9iamVjdCB0byBpbmRpdmlkdWFsIGluc3RhbmNlcyBzbyB3ZQoJICogICAgZG9uJ3QgbmVlZCB0byBjcmVhdGUgbmV3IGluc3RhbmNlcyBvbiBlYWNoICQoKS5kYXRhVGFibGUoKSBjYWxsIChpZiB0aGUKCSAqICAgIHRhYmxlIGFscmVhZHkgZXhpc3RzKS4gSXQgd291bGQgYWxzbyBzYXZlIHBhc3Npbmcgb1NldHRpbmdzIGFyb3VuZCBhbmQKCSAqICAgIGludG8gZXZlcnkgc2luZ2xlIGZ1bmN0aW9uLiBIb3dldmVyLCB0aGlzIGlzIGEgdmVyeSBzaWduaWZpY2FudCAKCSAqICAgIGFyY2hpdGVjdHVyZSBjaGFuZ2UgZm9yIERhdGFUYWJsZXMgYW5kIHdpbGwgYWxtb3N0IGNlcnRhaW5seSBicmVhawoJICogICAgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkgd2l0aCBvbGRlciBpbnN0YWxsYXRpb25zLiBUaGlzIGlzIHNvbWV0aGluZyB0aGF0CgkgKiAgICB3aWxsIGJlIGRvbmUgaW4gMi4wLgoJICovCglEYXRhVGFibGUubW9kZWxzLm9TZXR0aW5ncyA9IHsKCQkvKioKCQkgKiBQcmltYXJ5IGZlYXR1cmVzIG9mIERhdGFUYWJsZXMgYW5kIHRoZWlyIGVuYWJsZW1lbnQgc3RhdGUuCgkJICogIEBuYW1lc3BhY2UKCQkgKi8KCQkib0ZlYXR1cmVzIjogewoJCQkKCQkJLyoqCgkJCSAqIEZsYWcgdG8gc2F5IGlmIERhdGFUYWJsZXMgc2hvdWxkIGF1dG9tYXRpY2FsbHkgdHJ5IHRvIGNhbGN1bGF0ZSB0aGUKCQkJICogb3B0aW11bSB0YWJsZSBhbmQgY29sdW1ucyB3aWR0aHMgKHRydWUpIG9yIG5vdCAoZmFsc2UpLgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCQkgKiAgQHR5cGUgYm9vbGVhbgoJCQkgKi8KCQkJImJBdXRvV2lkdGgiOiBudWxsLAoJCgkJCS8qKgoJCQkgKiBEZWxheSB0aGUgY3JlYXRpb24gb2YgVFIgYW5kIFREIGVsZW1lbnRzIHVudGlsIHRoZXkgYXJlIGFjdHVhbGx5CgkJCSAqIG5lZWRlZCBieSBhIGRyaXZlbiBwYWdlIGRyYXcuIFRoaXMgY2FuIGdpdmUgYSBzaWduaWZpY2FudCBzcGVlZAoJCQkgKiBpbmNyZWFzZSBmb3IgQWpheCBzb3VyY2UgYW5kIEphdmFzY3JpcHQgc291cmNlIGRhdGEsIGJ1dCBtYWtlcyBubwoJCQkgKiBkaWZmZXJlbmNlIGF0IGFsbCBmcm8gRE9NIGFuZCBzZXJ2ZXItc2lkZSBwcm9jZXNzaW5nIHRhYmxlcy4KCQkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkJICogIEB0eXBlIGJvb2xlYW4KCQkJICovCgkJCSJiRGVmZXJSZW5kZXIiOiBudWxsLAoJCQkKCQkJLyoqCgkJCSAqIEVuYWJsZSBmaWx0ZXJpbmcgb24gdGhlIHRhYmxlIG9yIG5vdC4gTm90ZSB0aGF0IGlmIHRoaXMgaXMgZGlzYWJsZWQKCQkJICogdGhlbiB0aGVyZSBpcyBubyBmaWx0ZXJpbmcgYXQgYWxsIG9uIHRoZSB0YWJsZSwgaW5jbHVkaW5nIGZuRmlsdGVyLgoJCQkgKiBUbyBqdXN0IHJlbW92ZSB0aGUgZmlsdGVyaW5nIGlucHV0IHVzZSBzRG9tIGFuZCByZW1vdmUgdGhlICdmJyBvcHRpb24uCgkJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJCSAqICBAdHlwZSBib29sZWFuCgkJCSAqLwoJCQkiYkZpbHRlciI6IG51bGwsCgkJCQoJCQkvKioKCQkJICogVGFibGUgaW5mb3JtYXRpb24gZWxlbWVudCAodGhlICdTaG93aW5nIHggb2YgeSByZWNvcmRzJyBkaXYpIGVuYWJsZQoJCQkgKiBmbGFnLgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCQkgKiAgQHR5cGUgYm9vbGVhbgoJCQkgKi8KCQkJImJJbmZvIjogbnVsbCwKCQkJCgkJCS8qKgoJCQkgKiBQcmVzZW50IGEgdXNlciBjb250cm9sIGFsbG93aW5nIHRoZSBlbmQgdXNlciB0byBjaGFuZ2UgdGhlIHBhZ2Ugc2l6ZQoJCQkgKiB3aGVuIHBhZ2luYXRpb24gaXMgZW5hYmxlZC4KCQkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkJICogIEB0eXBlIGJvb2xlYW4KCQkJICovCgkJCSJiTGVuZ3RoQ2hhbmdlIjogbnVsbCwKCQoJCQkvKioKCQkJICogUGFnaW5hdGlvbiBlbmFibGVkIG9yIG5vdC4gTm90ZSB0aGF0IGlmIHRoaXMgaXMgZGlzYWJsZWQgdGhlbiBsZW5ndGgKCQkJICogY2hhbmdpbmcgbXVzdCBhbHNvIGJlIGRpc2FibGVkLgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCQkgKiAgQHR5cGUgYm9vbGVhbgoJCQkgKi8KCQkJImJQYWdpbmF0ZSI6IG51bGwsCgkJCQoJCQkvKioKCQkJICogUHJvY2Vzc2luZyBpbmRpY2F0b3IgZW5hYmxlIGZsYWcgd2hlbmV2ZXIgRGF0YVRhYmxlcyBpcyBlbmFjdGluZyBhCgkJCSAqIHVzZXIgcmVxdWVzdCAtIHR5cGljYWxseSBhbiBBamF4IHJlcXVlc3QgZm9yIHNlcnZlci1zaWRlIHByb2Nlc3NpbmcuCgkJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJCSAqICBAdHlwZSBib29sZWFuCgkJCSAqLwoJCQkiYlByb2Nlc3NpbmciOiBudWxsLAoJCQkKCQkJLyoqCgkJCSAqIFNlcnZlci1zaWRlIHByb2Nlc3NpbmcgZW5hYmxlZCBmbGFnIC0gd2hlbiBlbmFibGVkIERhdGFUYWJsZXMgd2lsbAoJCQkgKiBnZXQgYWxsIGRhdGEgZnJvbSB0aGUgc2VydmVyIGZvciBldmVyeSBkcmF3IC0gdGhlcmUgaXMgbm8gZmlsdGVyaW5nLAoJCQkgKiBzb3J0aW5nIG9yIHBhZ2luZyBkb25lIG9uIHRoZSBjbGllbnQtc2lkZS4KCQkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkJICogIEB0eXBlIGJvb2xlYW4KCQkJICovCgkJCSJiU2VydmVyU2lkZSI6IG51bGwsCgkJCQoJCQkvKioKCQkJICogU29ydGluZyBlbmFibGVtZW50IGZsYWcuCgkJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJCSAqICBAdHlwZSBib29sZWFuCgkJCSAqLwoJCQkiYlNvcnQiOiBudWxsLAoJCQkKCQkJLyoqCgkJCSAqIEFwcGx5IGEgY2xhc3MgdG8gdGhlIGNvbHVtbnMgd2hpY2ggYXJlIGJlaW5nIHNvcnRlZCB0byBwcm92aWRlIGEKCQkJICogdmlzdWFsIGhpZ2hsaWdodCBvciBub3QuIFRoaXMgY2FuIHNsb3cgdGhpbmdzIGRvd24gd2hlbiBlbmFibGVkIHNpbmNlCgkJCSAqIHRoZXJlIGlzIGEgbG90IG9mIERPTSBpbnRlcmFjdGlvbi4KCQkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkJICogIEB0eXBlIGJvb2xlYW4KCQkJICovCgkJCSJiU29ydENsYXNzZXMiOiBudWxsLAoJCQkKCQkJLyoqCgkJCSAqIFN0YXRlIHNhdmluZyBlbmFibGVtZW50IGZsYWcuCgkJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJCSAqICBAdHlwZSBib29sZWFuCgkJCSAqLwoJCQkiYlN0YXRlU2F2ZSI6IG51bGwKCQl9LAoJCQoJCgkJLyoqCgkJICogU2Nyb2xsaW5nIHNldHRpbmdzIGZvciBhIHRhYmxlLgoJCSAqICBAbmFtZXNwYWNlCgkJICovCgkJIm9TY3JvbGwiOiB7CgkJCS8qKgoJCQkgKiBJbmRpY2F0ZSBpZiBEYXRhVGFibGVzIHNob3VsZCBiZSBhbGxvd2VkIHRvIHNldCB0aGUgcGFkZGluZyAvIG1hcmdpbgoJCQkgKiBldGMgZm9yIHRoZSBzY3JvbGxpbmcgaGVhZGVyIGVsZW1lbnRzIG9yIG5vdC4gVHlwaWNhbGx5IHlvdSB3aWxsIHdhbnQKCQkJICogdGhpcy4KCQkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkJICogIEB0eXBlIGJvb2xlYW4KCQkJICovCgkJCSJiQXV0b0NzcyI6IG51bGwsCgkJCQoJCQkvKioKCQkJICogV2hlbiB0aGUgdGFibGUgaXMgc2hvcnRlciBpbiBoZWlnaHQgdGhhbiBzU2Nyb2xsWSwgY29sbGFwc2UgdGhlCgkJCSAqIHRhYmxlIGNvbnRhaW5lciBkb3duIHRvIHRoZSBoZWlnaHQgb2YgdGhlIHRhYmxlICh3aGVuIHRydWUpLgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCQkgKiAgQHR5cGUgYm9vbGVhbgoJCQkgKi8KCQkJImJDb2xsYXBzZSI6IG51bGwsCgkJCQoJCQkvKioKCQkJICogSW5maW5pdGUgc2Nyb2xsaW5nIGVuYWJsZW1lbnQgZmxhZy4gTm93IGRlcHJlY2F0ZWQgaW4gZmF2b3VyIG9mCgkJCSAqIHVzaW5nIHRoZSBTY3JvbGxlciBwbHVnLWluLgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCQkgKiAgQHR5cGUgYm9vbGVhbgoJCQkgKi8KCQkJImJJbmZpbml0ZSI6IG51bGwsCgkJCQoJCQkvKioKCQkJICogV2lkdGggb2YgdGhlIHNjcm9sbGJhciBmb3IgdGhlIHdlYi1icm93c2VyJ3MgcGxhdGZvcm0uIENhbGN1bGF0ZWQKCQkJICogZHVyaW5nIHRhYmxlIGluaXRpYWxpc2F0aW9uLgoJCQkgKiAgQHR5cGUgaW50CgkJCSAqICBAZGVmYXVsdCAwCgkJCSAqLwoJCQkiaUJhcldpZHRoIjogMCwKCQkJCgkJCS8qKgoJCQkgKiBTcGFjZSAoaW4gcGl4ZWxzKSBiZXR3ZWVuIHRoZSBib3R0b20gb2YgdGhlIHNjcm9sbGluZyBjb250YWluZXIgYW5kIAoJCQkgKiB0aGUgYm90dG9tIG9mIHRoZSBzY3JvbGxpbmcgdmlld3BvcnQgYmVmb3JlIHRoZSBuZXh0IHBhZ2UgaXMgbG9hZGVkCgkJCSAqIHdoZW4gdXNpbmcgaW5maW5pdGUgc2Nyb2xsaW5nLgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCQkgKiAgQHR5cGUgaW50CgkJCSAqLwoJCQkiaUxvYWRHYXAiOiBudWxsLAoJCQkKCQkJLyoqCgkJCSAqIFZpZXdwb3J0IHdpZHRoIGZvciBob3Jpem9udGFsIHNjcm9sbGluZy4gSG9yaXpvbnRhbCBzY3JvbGxpbmcgaXMgCgkJCSAqIGRpc2FibGVkIGlmIGFuIGVtcHR5IHN0cmluZy4KCQkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkJICogIEB0eXBlIHN0cmluZwoJCQkgKi8KCQkJInNYIjogbnVsbCwKCQkJCgkJCS8qKgoJCQkgKiBXaWR0aCB0byBleHBhbmQgdGhlIHRhYmxlIHRvIHdoZW4gdXNpbmcgeC1zY3JvbGxpbmcuIFR5cGljYWxseSB5b3UKCQkJICogc2hvdWxkIG5vdCBuZWVkIHRvIHVzZSB0aGlzLgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCSAqICBAZGVwcmVjYXRlZAoJCQkgKi8KCQkJInNYSW5uZXIiOiBudWxsLAoJCQkKCQkJLyoqCgkJCSAqIFZpZXdwb3J0IGhlaWdodCBmb3IgdmVydGljYWwgc2Nyb2xsaW5nLiBWZXJ0aWNhbCBzY3JvbGxpbmcgaXMgZGlzYWJsZWQKCQkJICogaWYgYW4gZW1wdHkgc3RyaW5nLgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCSAqLwoJCQkic1kiOiBudWxsCgkJfSwKCQkKCQkvKioKCQkgKiBMYW5ndWFnZSBpbmZvcm1hdGlvbiBmb3IgdGhlIHRhYmxlLgoJCSAqICBAbmFtZXNwYWNlCgkJICogIEBleHRlbmRzIERhdGFUYWJsZS5kZWZhdWx0cy5vTGFuZ3VhZ2UKCQkgKi8KCQkib0xhbmd1YWdlIjogewoJCQkvKioKCQkJICogSW5mb3JtYXRpb24gY2FsbGJhY2sgZnVuY3Rpb24uIFNlZSAKCQkJICoge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0cy5mbkluZm9DYWxsYmFja30KCQkJICogIEB0eXBlIGZ1bmN0aW9uCgkJCSAqICBAZGVmYXVsdCAKCQkJICovCgkJCSJmbkluZm9DYWxsYmFjayI6IG51bGwKCQl9LAoJCQoJCS8qKgoJCSAqIEFycmF5IHJlZmVyZW5jaW5nIHRoZSBub2RlcyB3aGljaCBhcmUgdXNlZCBmb3IgdGhlIGZlYXR1cmVzLiBUaGUgCgkJICogcGFyYW1ldGVycyBvZiB0aGlzIG9iamVjdCBtYXRjaCB3aGF0IGlzIGFsbG93ZWQgYnkgc0RvbSAtIGkuZS4KCQkgKiAgIDx1bD4KCQkgKiAgICAgPGxpPidsJyAtIExlbmd0aCBjaGFuZ2luZzwvbGk+CgkJICogICAgIDxsaT4nZicgLSBGaWx0ZXJpbmcgaW5wdXQ8L2xpPgoJCSAqICAgICA8bGk+J3QnIC0gVGhlIHRhYmxlITwvbGk+CgkJICogICAgIDxsaT4naScgLSBJbmZvcm1hdGlvbjwvbGk+CgkJICogICAgIDxsaT4ncCcgLSBQYWdpbmF0aW9uPC9saT4KCQkgKiAgICAgPGxpPidyJyAtIHBSb2Nlc3Npbmc8L2xpPgoJCSAqICAgPC91bD4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYWFuRmVhdHVyZXMiOiBbXSwKCQkKCQkvKioKCQkgKiBTdG9yZSBkYXRhIGluZm9ybWF0aW9uIC0gc2VlIHtAbGluayBEYXRhVGFibGUubW9kZWxzLm9Sb3d9IGZvciBkZXRhaWxlZAoJCSAqIGluZm9ybWF0aW9uLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb0RhdGEiOiBbXSwKCQkKCQkvKioKCQkgKiBBcnJheSBvZiBpbmRleGVzIHdoaWNoIGFyZSBpbiB0aGUgY3VycmVudCBkaXNwbGF5IChhZnRlciBmaWx0ZXJpbmcgZXRjKQoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhaURpc3BsYXkiOiBbXSwKCQkKCQkvKioKCQkgKiBBcnJheSBvZiBpbmRleGVzIGZvciBkaXNwbGF5IC0gbm8gZmlsdGVyaW5nCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFpRGlzcGxheU1hc3RlciI6IFtdLAoJCQoJCS8qKgoJCSAqIFN0b3JlIGluZm9ybWF0aW9uIGFib3V0IGVhY2ggY29sdW1uIHRoYXQgaXMgaW4gdXNlCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFvQ29sdW1ucyI6IFtdLAoJCQoJCS8qKgoJCSAqIFN0b3JlIGluZm9ybWF0aW9uIGFib3V0IHRoZSB0YWJsZSdzIGhlYWRlcgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb0hlYWRlciI6IFtdLAoJCQoJCS8qKgoJCSAqIFN0b3JlIGluZm9ybWF0aW9uIGFib3V0IHRoZSB0YWJsZSdzIGZvb3RlcgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb0Zvb3RlciI6IFtdLAoJCQoJCS8qKgoJCSAqIFNlYXJjaCBkYXRhIGFycmF5IGZvciByZWd1bGFyIGV4cHJlc3Npb24gc2VhcmNoaW5nCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFzRGF0YVNlYXJjaCI6IFtdLAoJCQoJCS8qKgoJCSAqIFN0b3JlIHRoZSBhcHBsaWVkIGdsb2JhbCBzZWFyY2ggaW5mb3JtYXRpb24gaW4gY2FzZSB3ZSB3YW50IHRvIGZvcmNlIGEgCgkJICogcmVzZWFyY2ggb3IgY29tcGFyZSB0aGUgb2xkIHNlYXJjaCB0byBhIG5ldyBvbmUuCgkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCSAqICBAbmFtZXNwYWNlCgkJICogIEBleHRlbmRzIERhdGFUYWJsZS5tb2RlbHMub1NlYXJjaAoJCSAqLwoJCSJvUHJldmlvdXNTZWFyY2giOiB7fSwKCQkKCQkvKioKCQkgKiBTdG9yZSB0aGUgYXBwbGllZCBzZWFyY2ggZm9yIGVhY2ggY29sdW1uIC0gc2VlIAoJCSAqIHtAbGluayBEYXRhVGFibGUubW9kZWxzLm9TZWFyY2h9IGZvciB0aGUgZm9ybWF0IHRoYXQgaXMgdXNlZCBmb3IgdGhlCgkJICogZmlsdGVyaW5nIGluZm9ybWF0aW9uIGZvciBlYWNoIGNvbHVtbi4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYW9QcmVTZWFyY2hDb2xzIjogW10sCgkJCgkJLyoqCgkJICogU29ydGluZyB0aGF0IGlzIGFwcGxpZWQgdG8gdGhlIHRhYmxlLiBOb3RlIHRoYXQgdGhlIGlubmVyIGFycmF5cyBhcmUKCQkgKiB1c2VkIGluIHRoZSBmb2xsb3dpbmcgbWFubmVyOgoJCSAqIDx1bD4KCQkgKiAgIDxsaT5JbmRleCAwIC0gY29sdW1uIG51bWJlcjwvbGk+CgkJICogICA8bGk+SW5kZXggMSAtIGN1cnJlbnQgc29ydGluZyBkaXJlY3Rpb248L2xpPgoJCSAqICAgPGxpPkluZGV4IDIgLSBpbmRleCBvZiBhc1NvcnRpbmcgZm9yIHRoaXMgY29sdW1uPC9saT4KCQkgKiA8L3VsPgoJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQHRvZG8gVGhlc2UgaW5uZXIgYXJyYXlzIHNob3VsZCByZWFsbHkgYmUgb2JqZWN0cwoJCSAqLwoJCSJhYVNvcnRpbmciOiBudWxsLAoJCQoJCS8qKgoJCSAqIFNvcnRpbmcgdGhhdCBpcyBhbHdheXMgYXBwbGllZCB0byB0aGUgdGFibGUgKGkuZS4gcHJlZml4ZWQgaW4gZnJvbnQgb2YKCQkgKiBhYVNvcnRpbmcpLgoJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkgKiAgQHR5cGUgYXJyYXl8bnVsbAoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJImFhU29ydGluZ0ZpeGVkIjogbnVsbCwKCQkKCQkvKioKCQkgKiBDbGFzc2VzIHRvIHVzZSBmb3IgdGhlIHN0cmlwaW5nIG9mIGEgdGFibGUuCgkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhc1N0cmlwZUNsYXNzZXMiOiBudWxsLAoJCQoJCS8qKgoJCSAqIElmIHJlc3RvcmluZyBhIHRhYmxlIC0gd2Ugc2hvdWxkIHJlc3RvcmUgaXRzIHN0cmlwaW5nIGNsYXNzZXMgYXMgd2VsbAoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhc0Rlc3Ryb3lTdHJpcGVzIjogW10sCgkJCgkJLyoqCgkJICogSWYgcmVzdG9yaW5nIGEgdGFibGUgLSB3ZSBzaG91bGQgcmVzdG9yZSBpdHMgd2lkdGggCgkJICogIEB0eXBlIGludAoJCSAqICBAZGVmYXVsdCAwCgkJICovCgkJInNEZXN0cm95V2lkdGgiOiAwLAoJCQoJCS8qKgoJCSAqIENhbGxiYWNrIGZ1bmN0aW9ucyBhcnJheSBmb3IgZXZlcnkgdGltZSBhIHJvdyBpcyBpbnNlcnRlZCAoaS5lLiBvbiBhIGRyYXcpLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb1Jvd0NhbGxiYWNrIjogW10sCgkJCgkJLyoqCgkJICogQ2FsbGJhY2sgZnVuY3Rpb25zIGZvciB0aGUgaGVhZGVyIG9uIGVhY2ggZHJhdy4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYW9IZWFkZXJDYWxsYmFjayI6IFtdLAoJCQoJCS8qKgoJCSAqIENhbGxiYWNrIGZ1bmN0aW9uIGZvciB0aGUgZm9vdGVyIG9uIGVhY2ggZHJhdy4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYW9Gb290ZXJDYWxsYmFjayI6IFtdLAoJCQoJCS8qKgoJCSAqIEFycmF5IG9mIGNhbGxiYWNrIGZ1bmN0aW9ucyBmb3IgZHJhdyBjYWxsYmFjayBmdW5jdGlvbnMKCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYW9EcmF3Q2FsbGJhY2siOiBbXSwKCQkKCQkvKioKCQkgKiBBcnJheSBvZiBjYWxsYmFjayBmdW5jdGlvbnMgZm9yIHJvdyBjcmVhdGVkIGZ1bmN0aW9uCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFvUm93Q3JlYXRlZENhbGxiYWNrIjogW10sCgkJCgkJLyoqCgkJICogQ2FsbGJhY2sgZnVuY3Rpb25zIGZvciBqdXN0IGJlZm9yZSB0aGUgdGFibGUgaXMgcmVkcmF3bi4gQSByZXR1cm4gb2YgCgkJICogZmFsc2Ugd2lsbCBiZSB1c2VkIHRvIGNhbmNlbCB0aGUgZHJhdy4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYW9QcmVEcmF3Q2FsbGJhY2siOiBbXSwKCQkKCQkvKioKCQkgKiBDYWxsYmFjayBmdW5jdGlvbnMgZm9yIHdoZW4gdGhlIHRhYmxlIGhhcyBiZWVuIGluaXRpYWxpc2VkLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb0luaXRDb21wbGV0ZSI6IFtdLAoJCgkJCgkJLyoqCgkJICogQ2FsbGJhY2tzIGZvciBtb2RpZnlpbmcgdGhlIHNldHRpbmdzIHRvIGJlIHN0b3JlZCBmb3Igc3RhdGUgc2F2aW5nLCBwcmlvciB0bwoJCSAqIHNhdmluZyBzdGF0ZS4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYW9TdGF0ZVNhdmVQYXJhbXMiOiBbXSwKCQkKCQkvKioKCQkgKiBDYWxsYmFja3MgZm9yIG1vZGlmeWluZyB0aGUgc2V0dGluZ3MgdGhhdCBoYXZlIGJlZW4gc3RvcmVkIGZvciBzdGF0ZSBzYXZpbmcKCQkgKiBwcmlvciB0byB1c2luZyB0aGUgc3RvcmVkIHZhbHVlcyB0byByZXN0b3JlIHRoZSBzdGF0ZS4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYW9TdGF0ZUxvYWRQYXJhbXMiOiBbXSwKCQkKCQkvKioKCQkgKiBDYWxsYmFja3MgZm9yIG9wZXJhdGluZyBvbiB0aGUgc2V0dGluZ3Mgb2JqZWN0IG9uY2UgdGhlIHNhdmVkIHN0YXRlIGhhcyBiZWVuCgkJICogbG9hZGVkCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFvU3RhdGVMb2FkZWQiOiBbXSwKCQkKCQkvKioKCQkgKiBDYWNoZSB0aGUgdGFibGUgSUQgZm9yIHF1aWNrIGFjY2VzcwoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgPGk+RW1wdHkgc3RyaW5nPC9pPgoJCSAqLwoJCSJzVGFibGVJZCI6ICIiLAoJCQoJCS8qKgoJCSAqIFRoZSBUQUJMRSBub2RlIGZvciB0aGUgbWFpbiB0YWJsZQoJCSAqICBAdHlwZSBub2RlCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkiblRhYmxlIjogbnVsbCwKCQkKCQkvKioKCQkgKiBQZXJtYW5lbnQgcmVmIHRvIHRoZSB0aGVhZCBlbGVtZW50CgkJICogIEB0eXBlIG5vZGUKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJuVEhlYWQiOiBudWxsLAoJCQoJCS8qKgoJCSAqIFBlcm1hbmVudCByZWYgdG8gdGhlIHRmb290IGVsZW1lbnQgLSBpZiBpdCBleGlzdHMKCQkgKiAgQHR5cGUgbm9kZQoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJIm5URm9vdCI6IG51bGwsCgkJCgkJLyoqCgkJICogUGVybWFuZW50IHJlZiB0byB0aGUgdGJvZHkgZWxlbWVudAoJCSAqICBAdHlwZSBub2RlCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkiblRCb2R5IjogbnVsbCwKCQkKCQkvKioKCQkgKiBDYWNoZSB0aGUgd3JhcHBlciBub2RlIChjb250YWlucyBhbGwgRGF0YVRhYmxlcyBjb250cm9sbGVkIGVsZW1lbnRzKQoJCSAqICBAdHlwZSBub2RlCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkiblRhYmxlV3JhcHBlciI6IG51bGwsCgkJCgkJLyoqCgkJICogSW5kaWNhdGUgaWYgd2hlbiB1c2luZyBzZXJ2ZXItc2lkZSBwcm9jZXNzaW5nIHRoZSBsb2FkaW5nIG9mIGRhdGEgCgkJICogc2hvdWxkIGJlIGRlZmVycmVkIHVudGlsIHRoZSBzZWNvbmQgZHJhdy4KCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkgKi8KCQkiYkRlZmVyTG9hZGluZyI6IGZhbHNlLAoJCQoJCS8qKgoJCSAqIEluZGljYXRlIGlmIGFsbCByZXF1aXJlZCBpbmZvcm1hdGlvbiBoYXMgYmVlbiByZWFkIGluCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkgKi8KCQkiYkluaXRpYWxpc2VkIjogZmFsc2UsCgkJCgkJLyoqCgkJICogSW5mb3JtYXRpb24gYWJvdXQgb3BlbiByb3dzLiBFYWNoIG9iamVjdCBpbiB0aGUgYXJyYXkgaGFzIHRoZSBwYXJhbWV0ZXJzCgkJICogJ25UcicgYW5kICduUGFyZW50JwoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb09wZW5Sb3dzIjogW10sCgkJCgkJLyoqCgkJICogRGljdGF0ZSB0aGUgcG9zaXRpb25pbmcgb2YgRGF0YVRhYmxlcycgY29udHJvbCBlbGVtZW50cyAtIHNlZQoJCSAqIHtAbGluayBEYXRhVGFibGUubW9kZWwub0luaXQuc0RvbX0uCgkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJzRG9tIjogbnVsbCwKCQkKCQkvKioKCQkgKiBXaGljaCB0eXBlIG9mIHBhZ2luYXRpb24gc2hvdWxkIGJlIHVzZWQuCgkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCSAqICBAdHlwZSBzdHJpbmcgCgkJICogIEBkZWZhdWx0IHR3b19idXR0b24KCQkgKi8KCQkic1BhZ2luYXRpb25UeXBlIjogInR3b19idXR0b24iLAoJCQoJCS8qKgoJCSAqIFRoZSBjb29raWUgZHVyYXRpb24gKGZvciBiU3RhdGVTYXZlKSBpbiBzZWNvbmRzLgoJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkgKiAgQHR5cGUgaW50CgkJICogIEBkZWZhdWx0IDAKCQkgKi8KCQkiaUNvb2tpZUR1cmF0aW9uIjogMCwKCQkKCQkvKioKCQkgKiBUaGUgY29va2llIG5hbWUgcHJlZml4LgoJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IDxpPkVtcHR5IHN0cmluZzwvaT4KCQkgKi8KCQkic0Nvb2tpZVByZWZpeCI6ICIiLAoJCQoJCS8qKgoJCSAqIENhbGxiYWNrIGZ1bmN0aW9uIGZvciBjb29raWUgY3JlYXRpb24uCgkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJImZuQ29va2llQ2FsbGJhY2siOiBudWxsLAoJCQoJCS8qKgoJCSAqIEFycmF5IG9mIGNhbGxiYWNrIGZ1bmN0aW9ucyBmb3Igc3RhdGUgc2F2aW5nLiBFYWNoIGFycmF5IGVsZW1lbnQgaXMgYW4gCgkJICogb2JqZWN0IHdpdGggdGhlIGZvbGxvd2luZyBwYXJhbWV0ZXJzOgoJCSAqICAgPHVsPgoJCSAqICAgICA8bGk+ZnVuY3Rpb246Zm4gLSBmdW5jdGlvbiB0byBjYWxsLiBUYWtlcyB0d28gcGFyYW1ldGVycywgb1NldHRpbmdzCgkJICogICAgICAgYW5kIHRoZSBKU09OIHN0cmluZyB0byBzYXZlIHRoYXQgaGFzIGJlZW4gdGh1cyBmYXIgY3JlYXRlZC4gUmV0dXJucwoJCSAqICAgICAgIGEgSlNPTiBzdHJpbmcgdG8gYmUgaW5zZXJ0ZWQgaW50byBhIGpzb24gb2JqZWN0IAoJCSAqICAgICAgIChpLmUuICcicGFyYW0iOiBbIDAsIDEsIDJdJyk8L2xpPgoJCSAqICAgICA8bGk+c3RyaW5nOnNOYW1lIC0gbmFtZSBvZiBjYWxsYmFjazwvbGk+CgkJICogICA8L3VsPgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb1N0YXRlU2F2ZSI6IFtdLAoJCQoJCS8qKgoJCSAqIEFycmF5IG9mIGNhbGxiYWNrIGZ1bmN0aW9ucyBmb3Igc3RhdGUgbG9hZGluZy4gRWFjaCBhcnJheSBlbGVtZW50IGlzIGFuIAoJCSAqIG9iamVjdCB3aXRoIHRoZSBmb2xsb3dpbmcgcGFyYW1ldGVyczoKCQkgKiAgIDx1bD4KCQkgKiAgICAgPGxpPmZ1bmN0aW9uOmZuIC0gZnVuY3Rpb24gdG8gY2FsbC4gVGFrZXMgdHdvIHBhcmFtZXRlcnMsIG9TZXR0aW5ncyAKCQkgKiAgICAgICBhbmQgdGhlIG9iamVjdCBzdG9yZWQuIE1heSByZXR1cm4gZmFsc2UgdG8gY2FuY2VsIHN0YXRlIGxvYWRpbmc8L2xpPgoJCSAqICAgICA8bGk+c3RyaW5nOnNOYW1lIC0gbmFtZSBvZiBjYWxsYmFjazwvbGk+CgkJICogICA8L3VsPgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb1N0YXRlTG9hZCI6IFtdLAoJCQoJCS8qKgoJCSAqIFN0YXRlIHRoYXQgd2FzIGxvYWRlZCBmcm9tIHRoZSBjb29raWUuIFVzZWZ1bCBmb3IgYmFjayByZWZlcmVuY2UKCQkgKiAgQHR5cGUgb2JqZWN0CgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkib0xvYWRlZFN0YXRlIjogbnVsbCwKCQkKCQkvKioKCQkgKiBTb3VyY2UgdXJsIGZvciBBSkFYIGRhdGEgZm9yIHRoZSB0YWJsZS4KCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJInNBamF4U291cmNlIjogbnVsbCwKCQkKCQkvKioKCQkgKiBQcm9wZXJ0eSBmcm9tIGEgZ2l2ZW4gb2JqZWN0IGZyb20gd2hpY2ggdG8gcmVhZCB0aGUgdGFibGUgZGF0YSBmcm9tLiBUaGlzCgkJICogY2FuIGJlIGFuIGVtcHR5IHN0cmluZyAod2hlbiBub3Qgc2VydmVyLXNpZGUgcHJvY2Vzc2luZyksIGluIHdoaWNoIGNhc2UgCgkJICogaXQgaXMgIGFzc3VtZWQgYW4gYW4gYXJyYXkgaXMgZ2l2ZW4gZGlyZWN0bHkuCgkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKi8KCQkic0FqYXhEYXRhUHJvcCI6IG51bGwsCgkJCgkJLyoqCgkJICogTm90ZSBpZiBkcmF3IHNob3VsZCBiZSBibG9ja2VkIHdoaWxlIGdldHRpbmcgZGF0YQoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IHRydWUKCQkgKi8KCQkiYkFqYXhEYXRhR2V0IjogdHJ1ZSwKCQkKCQkvKioKCQkgKiBUaGUgbGFzdCBqUXVlcnkgWEhSIG9iamVjdCB0aGF0IHdhcyB1c2VkIGZvciBzZXJ2ZXItc2lkZSBkYXRhIGdhdGhlcmluZy4gCgkJICogVGhpcyBjYW4gYmUgdXNlZCBmb3Igd29ya2luZyB3aXRoIHRoZSBYSFIgaW5mb3JtYXRpb24gaW4gb25lIG9mIHRoZSAKCQkgKiBjYWxsYmFja3MKCQkgKiAgQHR5cGUgb2JqZWN0CgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkianFYSFIiOiBudWxsLAoJCQoJCS8qKgoJCSAqIEZ1bmN0aW9uIHRvIGdldCB0aGUgc2VydmVyLXNpZGUgZGF0YS4KCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICovCgkJImZuU2VydmVyRGF0YSI6IG51bGwsCgkJCgkJLyoqCgkJICogRnVuY3Rpb25zIHdoaWNoIGFyZSBjYWxsZWQgcHJpb3IgdG8gc2VuZGluZyBhbiBBamF4IHJlcXVlc3Qgc28gZXh0cmEgCgkJICogcGFyYW1ldGVycyBjYW4gZWFzaWx5IGJlIHNlbnQgdG8gdGhlIHNlcnZlcgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb1NlcnZlclBhcmFtcyI6IFtdLAoJCQoJCS8qKgoJCSAqIFNlbmQgdGhlIFhIUiBIVFRQIG1ldGhvZCAtIEdFVCBvciBQT1NUIChjb3VsZCBiZSBQVVQgb3IgREVMRVRFIGlmIAoJCSAqIHJlcXVpcmVkKS4KCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJICogIEB0eXBlIHN0cmluZwoJCSAqLwoJCSJzU2VydmVyTWV0aG9kIjogbnVsbCwKCQkKCQkvKioKCQkgKiBGb3JtYXQgbnVtYmVycyBmb3IgZGlzcGxheS4KCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICovCgkJImZuRm9ybWF0TnVtYmVyIjogbnVsbCwKCQkKCQkvKioKCQkgKiBMaXN0IG9mIG9wdGlvbnMgdGhhdCBjYW4gYmUgdXNlZCBmb3IgdGhlIHVzZXIgc2VsZWN0YWJsZSBsZW5ndGggbWVudS4KCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFMZW5ndGhNZW51IjogbnVsbCwKCQkKCQkvKioKCQkgKiBDb3VudGVyIGZvciB0aGUgZHJhd3MgdGhhdCB0aGUgdGFibGUgZG9lcy4gQWxzbyB1c2VkIGFzIGEgdHJhY2tlciBmb3IKCQkgKiBzZXJ2ZXItc2lkZSBwcm9jZXNzaW5nCgkJICogIEB0eXBlIGludAoJCSAqICBAZGVmYXVsdCAwCgkJICovCgkJImlEcmF3IjogMCwKCQkKCQkvKioKCQkgKiBJbmRpY2F0ZSBpZiBhIHJlZHJhdyBpcyBiZWluZyBkb25lIC0gdXNlZnVsIGZvciBBamF4CgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkgKi8KCQkiYkRyYXdpbmciOiBmYWxzZSwKCQkKCQkvKioKCQkgKiBEcmF3IGluZGV4IChpRHJhdykgb2YgdGhlIGxhc3QgZXJyb3Igd2hlbiBwYXJzaW5nIHRoZSByZXR1cm5lZCBkYXRhCgkJICogIEB0eXBlIGludAoJCSAqICBAZGVmYXVsdCAtMQoJCSAqLwoJCSJpRHJhd0Vycm9yIjogLTEsCgkJCgkJLyoqCgkJICogUGFnaW5nIGRpc3BsYXkgbGVuZ3RoCgkJICogIEB0eXBlIGludAoJCSAqICBAZGVmYXVsdCAxMAoJCSAqLwoJCSJfaURpc3BsYXlMZW5ndGgiOiAxMCwKCQoJCS8qKgoJCSAqIFBhZ2luZyBzdGFydCBwb2ludCAtIGFpRGlzcGxheSBpbmRleAoJCSAqICBAdHlwZSBpbnQKCQkgKiAgQGRlZmF1bHQgMAoJCSAqLwoJCSJfaURpc3BsYXlTdGFydCI6IDAsCgkKCQkvKioKCQkgKiBQYWdpbmcgZW5kIHBvaW50IC0gYWlEaXNwbGF5IGluZGV4LiBVc2UgZm5EaXNwbGF5RW5kIHJhdGhlciB0aGFuCgkJICogdGhpcyBwcm9wZXJ0eSB0byBnZXQgdGhlIGVuZCBwb2ludAoJCSAqICBAdHlwZSBpbnQKCQkgKiAgQGRlZmF1bHQgMTAKCQkgKiAgQHByaXZhdGUKCQkgKi8KCQkiX2lEaXNwbGF5RW5kIjogMTAsCgkJCgkJLyoqCgkJICogU2VydmVyLXNpZGUgcHJvY2Vzc2luZyAtIG51bWJlciBvZiByZWNvcmRzIGluIHRoZSByZXN1bHQgc2V0CgkJICogKGkuZS4gYmVmb3JlIGZpbHRlcmluZyksIFVzZSBmblJlY29yZHNUb3RhbCByYXRoZXIgdGhhbgoJCSAqIHRoaXMgcHJvcGVydHkgdG8gZ2V0IHRoZSB2YWx1ZSBvZiB0aGUgbnVtYmVyIG9mIHJlY29yZHMsIHJlZ2FyZGxlc3Mgb2YKCQkgKiB0aGUgc2VydmVyLXNpZGUgcHJvY2Vzc2luZyBzZXR0aW5nLgoJCSAqICBAdHlwZSBpbnQKCQkgKiAgQGRlZmF1bHQgMAoJCSAqICBAcHJpdmF0ZQoJCSAqLwoJCSJfaVJlY29yZHNUb3RhbCI6IDAsCgkKCQkvKioKCQkgKiBTZXJ2ZXItc2lkZSBwcm9jZXNzaW5nIC0gbnVtYmVyIG9mIHJlY29yZHMgaW4gdGhlIGN1cnJlbnQgZGlzcGxheSBzZXQKCQkgKiAoaS5lLiBhZnRlciBmaWx0ZXJpbmcpLiBVc2UgZm5SZWNvcmRzRGlzcGxheSByYXRoZXIgdGhhbgoJCSAqIHRoaXMgcHJvcGVydHkgdG8gZ2V0IHRoZSB2YWx1ZSBvZiB0aGUgbnVtYmVyIG9mIHJlY29yZHMsIHJlZ2FyZGxlc3Mgb2YKCQkgKiB0aGUgc2VydmVyLXNpZGUgcHJvY2Vzc2luZyBzZXR0aW5nLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IDAKCQkgKiAgQHByaXZhdGUKCQkgKi8KCQkiX2lSZWNvcmRzRGlzcGxheSI6IDAsCgkJCgkJLyoqCgkJICogRmxhZyB0byBpbmRpY2F0ZSBpZiBqUXVlcnkgVUkgbWFya2luZyBhbmQgY2xhc3NlcyBzaG91bGQgYmUgdXNlZC4KCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKi8KCQkiYkpVSSI6IG51bGwsCgkJCgkJLyoqCgkJICogVGhlIGNsYXNzZXMgdG8gdXNlIGZvciB0aGUgdGFibGUKCQkgKiAgQHR5cGUgb2JqZWN0CgkJICogIEBkZWZhdWx0IHt9CgkJICovCgkJIm9DbGFzc2VzIjoge30sCgkJCgkJLyoqCgkJICogRmxhZyBhdHRhY2hlZCB0byB0aGUgc2V0dGluZ3Mgb2JqZWN0IHNvIHlvdSBjYW4gY2hlY2sgaW4gdGhlIGRyYXcgCgkJICogY2FsbGJhY2sgaWYgZmlsdGVyaW5nIGhhcyBiZWVuIGRvbmUgaW4gdGhlIGRyYXcuIERlcHJlY2F0ZWQgaW4gZmF2b3VyIG9mCgkJICogZXZlbnRzLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IGZhbHNlCgkJICogIEBkZXByZWNhdGVkCgkJICovCgkJImJGaWx0ZXJlZCI6IGZhbHNlLAoJCQoJCS8qKgoJCSAqIEZsYWcgYXR0YWNoZWQgdG8gdGhlIHNldHRpbmdzIG9iamVjdCBzbyB5b3UgY2FuIGNoZWNrIGluIHRoZSBkcmF3IAoJCSAqIGNhbGxiYWNrIGlmIHNvcnRpbmcgaGFzIGJlZW4gZG9uZSBpbiB0aGUgZHJhdy4gRGVwcmVjYXRlZCBpbiBmYXZvdXIgb2YKCQkgKiBldmVudHMuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkgKiAgQGRlcHJlY2F0ZWQKCQkgKi8KCQkiYlNvcnRlZCI6IGZhbHNlLAoJCQoJCS8qKgoJCSAqIEluZGljYXRlIHRoYXQgaWYgbXVsdGlwbGUgcm93cyBhcmUgaW4gdGhlIGhlYWRlciBhbmQgdGhlcmUgaXMgbW9yZSB0aGFuIAoJCSAqIG9uZSB1bmlxdWUgY2VsbCBwZXIgY29sdW1uLCBpZiB0aGUgdG9wIG9uZSAodHJ1ZSkgb3IgYm90dG9tIG9uZSAoZmFsc2UpIAoJCSAqIHNob3VsZCBiZSB1c2VkIGZvciBzb3J0aW5nIC8gdGl0bGUgYnkgRGF0YVRhYmxlcy4KCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKi8KCQkiYlNvcnRDZWxsc1RvcCI6IG51bGwsCgkJCgkJLyoqCgkJICogSW5pdGlhbGlzYXRpb24gb2JqZWN0IHRoYXQgaXMgdXNlZCBmb3IgdGhlIHRhYmxlCgkJICogIEB0eXBlIG9iamVjdAoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJIm9Jbml0IjogbnVsbCwKCQkKCQkvKioKCQkgKiBEZXN0cm95IGNhbGxiYWNrIGZ1bmN0aW9ucyAtIGZvciBwbHVnLWlucyB0byBhdHRhY2ggdGhlbXNlbHZlcyB0byB0aGUKCQkgKiBkZXN0cm95IHNvIHRoZXkgY2FuIGNsZWFuIHVwIG1hcmt1cCBhbmQgZXZlbnRzLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb0Rlc3Ryb3lDYWxsYmFjayI6IFtdLAoJCgkJCgkJLyoqCgkJICogR2V0IHRoZSBudW1iZXIgb2YgcmVjb3JkcyBpbiB0aGUgY3VycmVudCByZWNvcmQgc2V0LCBiZWZvcmUgZmlsdGVyaW5nCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICovCgkJImZuUmVjb3Jkc1RvdGFsIjogZnVuY3Rpb24gKCkKCQl7CgkJCWlmICggdGhpcy5vRmVhdHVyZXMuYlNlcnZlclNpZGUgKSB7CgkJCQlyZXR1cm4gcGFyc2VJbnQodGhpcy5faVJlY29yZHNUb3RhbCwgMTApOwoJCQl9IGVsc2UgewoJCQkJcmV0dXJuIHRoaXMuYWlEaXNwbGF5TWFzdGVyLmxlbmd0aDsKCQkJfQoJCX0sCgkJCgkJLyoqCgkJICogR2V0IHRoZSBudW1iZXIgb2YgcmVjb3JkcyBpbiB0aGUgY3VycmVudCByZWNvcmQgc2V0LCBhZnRlciBmaWx0ZXJpbmcKCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKi8KCQkiZm5SZWNvcmRzRGlzcGxheSI6IGZ1bmN0aW9uICgpCgkJewoJCQlpZiAoIHRoaXMub0ZlYXR1cmVzLmJTZXJ2ZXJTaWRlICkgewoJCQkJcmV0dXJuIHBhcnNlSW50KHRoaXMuX2lSZWNvcmRzRGlzcGxheSwgMTApOwoJCQl9IGVsc2UgewoJCQkJcmV0dXJuIHRoaXMuYWlEaXNwbGF5Lmxlbmd0aDsKCQkJfQoJCX0sCgkJCgkJLyoqCgkJICogU2V0IHRoZSBkaXNwbGF5IGVuZCBwb2ludCAtIGFpRGlzcGxheSBpbmRleAoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAdG9kbyBTaG91bGQgZG8gYXdheSB3aXRoIF9pRGlzcGxheUVuZCBhbmQgY2FsY3VsYXRlIGl0IG9uLXRoZS1mbHkgaGVyZQoJCSAqLwoJCSJmbkRpc3BsYXlFbmQiOiBmdW5jdGlvbiAoKQoJCXsKCQkJaWYgKCB0aGlzLm9GZWF0dXJlcy5iU2VydmVyU2lkZSApIHsKCQkJCWlmICggdGhpcy5vRmVhdHVyZXMuYlBhZ2luYXRlID09PSBmYWxzZSB8fCB0aGlzLl9pRGlzcGxheUxlbmd0aCA9PSAtMSApIHsKCQkJCQlyZXR1cm4gdGhpcy5faURpc3BsYXlTdGFydCt0aGlzLmFpRGlzcGxheS5sZW5ndGg7CgkJCQl9IGVsc2UgewoJCQkJCXJldHVybiBNYXRoLm1pbiggdGhpcy5faURpc3BsYXlTdGFydCt0aGlzLl9pRGlzcGxheUxlbmd0aCwgCgkJCQkJCXRoaXMuX2lSZWNvcmRzRGlzcGxheSApOwoJCQkJfQoJCQl9IGVsc2UgewoJCQkJcmV0dXJuIHRoaXMuX2lEaXNwbGF5RW5kOwoJCQl9CgkJfSwKCQkKCQkvKioKCQkgKiBUaGUgRGF0YVRhYmxlcyBvYmplY3QgZm9yIHRoaXMgdGFibGUKCQkgKiAgQHR5cGUgb2JqZWN0CgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkib0luc3RhbmNlIjogbnVsbCwKCQkKCQkvKioKCQkgKiBVbmlxdWUgaWRlbnRpZmllciBmb3IgZWFjaCBpbnN0YW5jZSBvZiB0aGUgRGF0YVRhYmxlcyBvYmplY3QuIElmIHRoZXJlCgkJICogaXMgYW4gSUQgb24gdGhlIHRhYmxlIG5vZGUsIHRoZW4gaXQgdGFrZXMgdGhhdCB2YWx1ZSwgb3RoZXJ3aXNlIGFuCgkJICogaW5jcmVtZW50aW5nIGludGVybmFsIGNvdW50ZXIgaXMgdXNlZC4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkic0luc3RhbmNlIjogbnVsbCwKCQoJCS8qKgoJCSAqIHRhYmluZGV4IGF0dHJpYnV0ZSB2YWx1ZSB0aGF0IGlzIGFkZGVkIHRvIERhdGFUYWJsZXMgY29udHJvbCBlbGVtZW50cywgYWxsb3dpbmcKCQkgKiBrZXlib2FyZCBuYXZpZ2F0aW9uIG9mIHRoZSB0YWJsZSBhbmQgaXRzIGNvbnRyb2xzLgoJCSAqLwoJCSJpVGFiSW5kZXgiOiAwLAoJCgkJLyoqCgkJICogRElWIGNvbnRhaW5lciBmb3IgdGhlIGZvb3RlciBzY3JvbGxpbmcgdGFibGUgaWYgc2Nyb2xsaW5nCgkJICovCgkJIm5TY3JvbGxIZWFkIjogbnVsbCwKCQoJCS8qKgoJCSAqIERJViBjb250YWluZXIgZm9yIHRoZSBmb290ZXIgc2Nyb2xsaW5nIHRhYmxlIGlmIHNjcm9sbGluZwoJCSAqLwoJCSJuU2Nyb2xsRm9vdCI6IG51bGwKCX07CgoJLyoqCgkgKiBFeHRlbnNpb24gb2JqZWN0IGZvciBEYXRhVGFibGVzIHRoYXQgaXMgdXNlZCB0byBwcm92aWRlIGFsbCBleHRlbnNpb24gb3B0aW9ucy4KCSAqIAoJICogTm90ZSB0aGF0IHRoZSA8aT5EYXRhVGFibGUuZXh0PC9pPiBvYmplY3QgaXMgYXZhaWxhYmxlIHRocm91Z2gKCSAqIDxpPmpRdWVyeS5mbi5kYXRhVGFibGUuZXh0PC9pPiB3aGVyZSBpdCBtYXkgYmUgYWNjZXNzZWQgYW5kIG1hbmlwdWxhdGVkLiBJdCBpcwoJICogYWxzbyBhbGlhc2VkIHRvIDxpPmpRdWVyeS5mbi5kYXRhVGFibGVFeHQ8L2k+IGZvciBoaXN0b3JpYyByZWFzb25zLgoJICogIEBuYW1lc3BhY2UKCSAqICBAZXh0ZW5kcyBEYXRhVGFibGUubW9kZWxzLmV4dAoJICovCglEYXRhVGFibGUuZXh0ID0gJC5leHRlbmQoIHRydWUsIHt9LCBEYXRhVGFibGUubW9kZWxzLmV4dCApOwoJCgkkLmV4dGVuZCggRGF0YVRhYmxlLmV4dC5vU3RkQ2xhc3NlcywgewoJCSJzVGFibGUiOiAiZGF0YVRhYmxlIiwKCQoJCS8qIFR3byBidXR0b25zIGJ1dHRvbnMgKi8KCQkic1BhZ2VQcmV2RW5hYmxlZCI6ICJwYWdpbmF0ZV9lbmFibGVkX3ByZXZpb3VzIiwKCQkic1BhZ2VQcmV2RGlzYWJsZWQiOiAicGFnaW5hdGVfZGlzYWJsZWRfcHJldmlvdXMiLAoJCSJzUGFnZU5leHRFbmFibGVkIjogInBhZ2luYXRlX2VuYWJsZWRfbmV4dCIsCgkJInNQYWdlTmV4dERpc2FibGVkIjogInBhZ2luYXRlX2Rpc2FibGVkX25leHQiLAoJCSJzUGFnZUpVSU5leHQiOiAiIiwKCQkic1BhZ2VKVUlQcmV2IjogIiIsCgkJCgkJLyogRnVsbCBudW1iZXJzIHBhZ2luZyBidXR0b25zICovCgkJInNQYWdlQnV0dG9uIjogInBhZ2luYXRlX2J1dHRvbiIsCgkJInNQYWdlQnV0dG9uQWN0aXZlIjogInBhZ2luYXRlX2FjdGl2ZSIsCgkJInNQYWdlQnV0dG9uU3RhdGljRGlzYWJsZWQiOiAicGFnaW5hdGVfYnV0dG9uIHBhZ2luYXRlX2J1dHRvbl9kaXNhYmxlZCIsCgkJInNQYWdlRmlyc3QiOiAiZmlyc3QiLAoJCSJzUGFnZVByZXZpb3VzIjogInByZXZpb3VzIiwKCQkic1BhZ2VOZXh0IjogIm5leHQiLAoJCSJzUGFnZUxhc3QiOiAibGFzdCIsCgkJCgkJLyogU3RyaXBpbmcgY2xhc3NlcyAqLwoJCSJzU3RyaXBlT2RkIjogIm9kZCIsCgkJInNTdHJpcGVFdmVuIjogImV2ZW4iLAoJCQoJCS8qIEVtcHR5IHJvdyAqLwoJCSJzUm93RW1wdHkiOiAiZGF0YVRhYmxlc19lbXB0eSIsCgkJCgkJLyogRmVhdHVyZXMgKi8KCQkic1dyYXBwZXIiOiAiZGF0YVRhYmxlc193cmFwcGVyIiwKCQkic0ZpbHRlciI6ICJkYXRhVGFibGVzX2ZpbHRlciIsCgkJInNJbmZvIjogImRhdGFUYWJsZXNfaW5mbyIsCgkJInNQYWdpbmciOiAiZGF0YVRhYmxlc19wYWdpbmF0ZSBwYWdpbmdfIiwgLyogTm90ZSB0aGF0IHRoZSB0eXBlIGlzIHBvc3RmaXhlZCAqLwoJCSJzTGVuZ3RoIjogImRhdGFUYWJsZXNfbGVuZ3RoIiwKCQkic1Byb2Nlc3NpbmciOiAiZGF0YVRhYmxlc19wcm9jZXNzaW5nIiwKCQkKCQkvKiBTb3J0aW5nICovCgkJInNTb3J0QXNjIjogInNvcnRpbmdfYXNjIiwKCQkic1NvcnREZXNjIjogInNvcnRpbmdfZGVzYyIsCgkJInNTb3J0YWJsZSI6ICJzb3J0aW5nIiwgLyogU29ydGFibGUgaW4gYm90aCBkaXJlY3Rpb25zICovCgkJInNTb3J0YWJsZUFzYyI6ICJzb3J0aW5nX2FzY19kaXNhYmxlZCIsCgkJInNTb3J0YWJsZURlc2MiOiAic29ydGluZ19kZXNjX2Rpc2FibGVkIiwKCQkic1NvcnRhYmxlTm9uZSI6ICJzb3J0aW5nX2Rpc2FibGVkIiwKCQkic1NvcnRDb2x1bW4iOiAic29ydGluZ18iLCAvKiBOb3RlIHRoYXQgYW4gaW50IGlzIHBvc3RmaXhlZCBmb3IgdGhlIHNvcnRpbmcgb3JkZXIgKi8KCQkic1NvcnRKVUlBc2MiOiAiIiwKCQkic1NvcnRKVUlEZXNjIjogIiIsCgkJInNTb3J0SlVJIjogIiIsCgkJInNTb3J0SlVJQXNjQWxsb3dlZCI6ICIiLAoJCSJzU29ydEpVSURlc2NBbGxvd2VkIjogIiIsCgkJInNTb3J0SlVJV3JhcHBlciI6ICIiLAoJCSJzU29ydEljb24iOiAiIiwKCQkKCQkvKiBTY3JvbGxpbmcgKi8KCQkic1Njcm9sbFdyYXBwZXIiOiAiZGF0YVRhYmxlc19zY3JvbGwiLAoJCSJzU2Nyb2xsSGVhZCI6ICJkYXRhVGFibGVzX3Njcm9sbEhlYWQiLAoJCSJzU2Nyb2xsSGVhZElubmVyIjogImRhdGFUYWJsZXNfc2Nyb2xsSGVhZElubmVyIiwKCQkic1Njcm9sbEJvZHkiOiAiZGF0YVRhYmxlc19zY3JvbGxCb2R5IiwKCQkic1Njcm9sbEZvb3QiOiAiZGF0YVRhYmxlc19zY3JvbGxGb290IiwKCQkic1Njcm9sbEZvb3RJbm5lciI6ICJkYXRhVGFibGVzX3Njcm9sbEZvb3RJbm5lciIsCgkJCgkJLyogTWlzYyAqLwoJCSJzRm9vdGVyVEgiOiAiIiwKCQkic0pVSUhlYWRlciI6ICIiLAoJCSJzSlVJRm9vdGVyIjogIiIKCX0gKTsKCQoJCgkkLmV4dGVuZCggRGF0YVRhYmxlLmV4dC5vSlVJQ2xhc3NlcywgRGF0YVRhYmxlLmV4dC5vU3RkQ2xhc3NlcywgewoJCS8qIFR3byBidXR0b25zIGJ1dHRvbnMgKi8KCQkic1BhZ2VQcmV2RW5hYmxlZCI6ICJmZy1idXR0b24gdWktYnV0dG9uIHVpLXN0YXRlLWRlZmF1bHQgdWktY29ybmVyLWxlZnQiLAoJCSJzUGFnZVByZXZEaXNhYmxlZCI6ICJmZy1idXR0b24gdWktYnV0dG9uIHVpLXN0YXRlLWRlZmF1bHQgdWktY29ybmVyLWxlZnQgdWktc3RhdGUtZGlzYWJsZWQiLAoJCSJzUGFnZU5leHRFbmFibGVkIjogImZnLWJ1dHRvbiB1aS1idXR0b24gdWktc3RhdGUtZGVmYXVsdCB1aS1jb3JuZXItcmlnaHQiLAoJCSJzUGFnZU5leHREaXNhYmxlZCI6ICJmZy1idXR0b24gdWktYnV0dG9uIHVpLXN0YXRlLWRlZmF1bHQgdWktY29ybmVyLXJpZ2h0IHVpLXN0YXRlLWRpc2FibGVkIiwKCQkic1BhZ2VKVUlOZXh0IjogInVpLWljb24gdWktaWNvbi1jaXJjbGUtYXJyb3ctZSIsCgkJInNQYWdlSlVJUHJldiI6ICJ1aS1pY29uIHVpLWljb24tY2lyY2xlLWFycm93LXciLAoJCQoJCS8qIEZ1bGwgbnVtYmVycyBwYWdpbmcgYnV0dG9ucyAqLwoJCSJzUGFnZUJ1dHRvbiI6ICJmZy1idXR0b24gdWktYnV0dG9uIHVpLXN0YXRlLWRlZmF1bHQiLAoJCSJzUGFnZUJ1dHRvbkFjdGl2ZSI6ICJmZy1idXR0b24gdWktYnV0dG9uIHVpLXN0YXRlLWRlZmF1bHQgdWktc3RhdGUtZGlzYWJsZWQiLAoJCSJzUGFnZUJ1dHRvblN0YXRpY0Rpc2FibGVkIjogImZnLWJ1dHRvbiB1aS1idXR0b24gdWktc3RhdGUtZGVmYXVsdCB1aS1zdGF0ZS1kaXNhYmxlZCIsCgkJInNQYWdlRmlyc3QiOiAiZmlyc3QgdWktY29ybmVyLXRsIHVpLWNvcm5lci1ibCIsCgkJInNQYWdlTGFzdCI6ICJsYXN0IHVpLWNvcm5lci10ciB1aS1jb3JuZXItYnIiLAoJCQoJCS8qIEZlYXR1cmVzICovCgkJInNQYWdpbmciOiAiZGF0YVRhYmxlc19wYWdpbmF0ZSBmZy1idXR0b25zZXQgdWktYnV0dG9uc2V0IGZnLWJ1dHRvbnNldC1tdWx0aSAiKwoJCQkidWktYnV0dG9uc2V0LW11bHRpIHBhZ2luZ18iLCAvKiBOb3RlIHRoYXQgdGhlIHR5cGUgaXMgcG9zdGZpeGVkICovCgkJCgkJLyogU29ydGluZyAqLwoJCSJzU29ydEFzYyI6ICJ1aS1zdGF0ZS1kZWZhdWx0IiwKCQkic1NvcnREZXNjIjogInVpLXN0YXRlLWRlZmF1bHQiLAoJCSJzU29ydGFibGUiOiAidWktc3RhdGUtZGVmYXVsdCIsCgkJInNTb3J0YWJsZUFzYyI6ICJ1aS1zdGF0ZS1kZWZhdWx0IiwKCQkic1NvcnRhYmxlRGVzYyI6ICJ1aS1zdGF0ZS1kZWZhdWx0IiwKCQkic1NvcnRhYmxlTm9uZSI6ICJ1aS1zdGF0ZS1kZWZhdWx0IiwKCQkic1NvcnRKVUlBc2MiOiAiY3NzX3JpZ2h0IHVpLWljb24gdWktaWNvbi10cmlhbmdsZS0xLW4iLAoJCSJzU29ydEpVSURlc2MiOiAiY3NzX3JpZ2h0IHVpLWljb24gdWktaWNvbi10cmlhbmdsZS0xLXMiLAoJCSJzU29ydEpVSSI6ICJjc3NfcmlnaHQgdWktaWNvbiB1aS1pY29uLWNhcmF0LTItbi1zIiwKCQkic1NvcnRKVUlBc2NBbGxvd2VkIjogImNzc19yaWdodCB1aS1pY29uIHVpLWljb24tY2FyYXQtMS1uIiwKCQkic1NvcnRKVUlEZXNjQWxsb3dlZCI6ICJjc3NfcmlnaHQgdWktaWNvbiB1aS1pY29uLWNhcmF0LTEtcyIsCgkJInNTb3J0SlVJV3JhcHBlciI6ICJEYXRhVGFibGVzX3NvcnRfd3JhcHBlciIsCgkJInNTb3J0SWNvbiI6ICJEYXRhVGFibGVzX3NvcnRfaWNvbiIsCgkJCgkJLyogU2Nyb2xsaW5nICovCgkJInNTY3JvbGxIZWFkIjogImRhdGFUYWJsZXNfc2Nyb2xsSGVhZCB1aS1zdGF0ZS1kZWZhdWx0IiwKCQkic1Njcm9sbEZvb3QiOiAiZGF0YVRhYmxlc19zY3JvbGxGb290IHVpLXN0YXRlLWRlZmF1bHQiLAoJCQoJCS8qIE1pc2MgKi8KCQkic0Zvb3RlclRIIjogInVpLXN0YXRlLWRlZmF1bHQiLAoJCSJzSlVJSGVhZGVyIjogImZnLXRvb2xiYXIgdWktdG9vbGJhciB1aS13aWRnZXQtaGVhZGVyIHVpLWNvcm5lci10bCB1aS1jb3JuZXItdHIgdWktaGVscGVyLWNsZWFyZml4IiwKCQkic0pVSUZvb3RlciI6ICJmZy10b29sYmFyIHVpLXRvb2xiYXIgdWktd2lkZ2V0LWhlYWRlciB1aS1jb3JuZXItYmwgdWktY29ybmVyLWJyIHVpLWhlbHBlci1jbGVhcmZpeCIKCX0gKTsKCQoJCgkvKgoJICogVmFyaWFibGU6IG9QYWdpbmF0aW9uCgkgKiBQdXJwb3NlOiAgCgkgKiBTY29wZTogICAgalF1ZXJ5LmZuLmRhdGFUYWJsZUV4dAoJICovCgkkLmV4dGVuZCggRGF0YVRhYmxlLmV4dC5vUGFnaW5hdGlvbiwgewoJCS8qCgkJICogVmFyaWFibGU6IHR3b19idXR0b24KCQkgKiBQdXJwb3NlOiAgU3RhbmRhcmQgdHdvIGJ1dHRvbiAoZm9yd2FyZC9iYWNrKSBwYWdpbmF0aW9uCgkJICogU2NvcGU6ICAgIGpRdWVyeS5mbi5kYXRhVGFibGVFeHQub1BhZ2luYXRpb24KCQkgKi8KCQkidHdvX2J1dHRvbiI6IHsKCQkJLyoKCQkJICogRnVuY3Rpb246IG9QYWdpbmF0aW9uLnR3b19idXR0b24uZm5Jbml0CgkJCSAqIFB1cnBvc2U6ICBJbml0aWFsaXNlIGRvbSBlbGVtZW50cyByZXF1aXJlZCBmb3IgcGFnaW5hdGlvbiB3aXRoIGZvcndhcmQvYmFjayBidXR0b25zIG9ubHkKCQkJICogUmV0dXJuczogIC0KCQkJICogSW5wdXRzOiAgIG9iamVjdDpvU2V0dGluZ3MgLSBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCQkgKiAgICAgICAgICAgbm9kZTpuUGFnaW5nIC0gdGhlIERJViB3aGljaCBjb250YWlucyB0aGlzIHBhZ2luYXRpb24gY29udHJvbAoJCQkgKiAgICAgICAgICAgZnVuY3Rpb246Zm5DYWxsYmFja0RyYXcgLSBkcmF3IGZ1bmN0aW9uIHdoaWNoIG11c3QgYmUgY2FsbGVkIG9uIHVwZGF0ZQoJCQkgKi8KCQkJImZuSW5pdCI6IGZ1bmN0aW9uICggb1NldHRpbmdzLCBuUGFnaW5nLCBmbkNhbGxiYWNrRHJhdyApCgkJCXsKCQkJCXZhciBvTGFuZyA9IG9TZXR0aW5ncy5vTGFuZ3VhZ2Uub1BhZ2luYXRlOwoJCQkJdmFyIG9DbGFzc2VzID0gb1NldHRpbmdzLm9DbGFzc2VzOwoJCQkJdmFyIGZuQ2xpY2tIYW5kbGVyID0gZnVuY3Rpb24gKCBlICkgewoJCQkJCWlmICggb1NldHRpbmdzLm9BcGkuX2ZuUGFnZUNoYW5nZSggb1NldHRpbmdzLCBlLmRhdGEuYWN0aW9uICkgKQoJCQkJCXsKCQkJCQkJZm5DYWxsYmFja0RyYXcoIG9TZXR0aW5ncyApOwoJCQkJCX0KCQkJCX07CgkKCQkJCXZhciBzQXBwZW5kID0gKCFvU2V0dGluZ3MuYkpVSSkgPwoJCQkJCSc8YSBjbGFzcz0iJytvU2V0dGluZ3Mub0NsYXNzZXMuc1BhZ2VQcmV2RGlzYWJsZWQrJyIgdGFiaW5kZXg9Iicrb1NldHRpbmdzLmlUYWJJbmRleCsnIiByb2xlPSJidXR0b24iPicrb0xhbmcuc1ByZXZpb3VzKyc8L2E+JysKCQkJCQknPGEgY2xhc3M9Iicrb1NldHRpbmdzLm9DbGFzc2VzLnNQYWdlTmV4dERpc2FibGVkKyciIHRhYmluZGV4PSInK29TZXR0aW5ncy5pVGFiSW5kZXgrJyIgcm9sZT0iYnV0dG9uIj4nK29MYW5nLnNOZXh0Kyc8L2E+JwoJCQkJCToKCQkJCQknPGEgY2xhc3M9Iicrb1NldHRpbmdzLm9DbGFzc2VzLnNQYWdlUHJldkRpc2FibGVkKyciIHRhYmluZGV4PSInK29TZXR0aW5ncy5pVGFiSW5kZXgrJyIgcm9sZT0iYnV0dG9uIj48c3BhbiBjbGFzcz0iJytvU2V0dGluZ3Mub0NsYXNzZXMuc1BhZ2VKVUlQcmV2KyciPjwvc3Bhbj48L2E+JysKCQkJCQknPGEgY2xhc3M9Iicrb1NldHRpbmdzLm9DbGFzc2VzLnNQYWdlTmV4dERpc2FibGVkKyciIHRhYmluZGV4PSInK29TZXR0aW5ncy5pVGFiSW5kZXgrJyIgcm9sZT0iYnV0dG9uIj48c3BhbiBjbGFzcz0iJytvU2V0dGluZ3Mub0NsYXNzZXMuc1BhZ2VKVUlOZXh0KyciPjwvc3Bhbj48L2E+JzsKCQkJCSQoblBhZ2luZykuYXBwZW5kKCBzQXBwZW5kICk7CgkJCQkKCQkJCXZhciBlbHMgPSAkKCdhJywgblBhZ2luZyk7CgkJCQl2YXIgblByZXZpb3VzID0gZWxzWzBdLAoJCQkJCW5OZXh0ID0gZWxzWzFdOwoJCQkJCgkJCQlvU2V0dGluZ3Mub0FwaS5fZm5CaW5kQWN0aW9uKCBuUHJldmlvdXMsIHthY3Rpb246ICJwcmV2aW91cyJ9LCBmbkNsaWNrSGFuZGxlciApOwoJCQkJb1NldHRpbmdzLm9BcGkuX2ZuQmluZEFjdGlvbiggbk5leHQsICAgICB7YWN0aW9uOiAibmV4dCJ9LCAgICAgZm5DbGlja0hhbmRsZXIgKTsKCQkJCQoJCQkJLyogSUQgdGhlIGZpcnN0IGVsZW1lbnRzIG9ubHkgKi8KCQkJCWlmICggIW9TZXR0aW5ncy5hYW5GZWF0dXJlcy5wICkKCQkJCXsKCQkJCQluUGFnaW5nLmlkID0gb1NldHRpbmdzLnNUYWJsZUlkKydfcGFnaW5hdGUnOwoJCQkJCW5QcmV2aW91cy5pZCA9IG9TZXR0aW5ncy5zVGFibGVJZCsnX3ByZXZpb3VzJzsKCQkJCQluTmV4dC5pZCA9IG9TZXR0aW5ncy5zVGFibGVJZCsnX25leHQnOwoJCgkJCQkJblByZXZpb3VzLnNldEF0dHJpYnV0ZSgnYXJpYS1jb250cm9scycsIG9TZXR0aW5ncy5zVGFibGVJZCk7CgkJCQkJbk5leHQuc2V0QXR0cmlidXRlKCdhcmlhLWNvbnRyb2xzJywgb1NldHRpbmdzLnNUYWJsZUlkKTsKCQkJCX0KCQkJfSwKCQkJCgkJCS8qCgkJCSAqIEZ1bmN0aW9uOiBvUGFnaW5hdGlvbi50d29fYnV0dG9uLmZuVXBkYXRlCgkJCSAqIFB1cnBvc2U6ICBVcGRhdGUgdGhlIHR3byBidXR0b24gcGFnaW5hdGlvbiBhdCB0aGUgZW5kIG9mIHRoZSBkcmF3CgkJCSAqIFJldHVybnM6ICAtCgkJCSAqIElucHV0czogICBvYmplY3Q6b1NldHRpbmdzIC0gZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkJICogICAgICAgICAgIGZ1bmN0aW9uOmZuQ2FsbGJhY2tEcmF3IC0gZHJhdyBmdW5jdGlvbiB0byBjYWxsIG9uIHBhZ2UgY2hhbmdlCgkJCSAqLwoJCQkiZm5VcGRhdGUiOiBmdW5jdGlvbiAoIG9TZXR0aW5ncywgZm5DYWxsYmFja0RyYXcgKQoJCQl7CgkJCQlpZiAoICFvU2V0dGluZ3MuYWFuRmVhdHVyZXMucCApCgkJCQl7CgkJCQkJcmV0dXJuOwoJCQkJfQoJCQkJCgkJCQl2YXIgb0NsYXNzZXMgPSBvU2V0dGluZ3Mub0NsYXNzZXM7CgkJCQl2YXIgYW4gPSBvU2V0dGluZ3MuYWFuRmVhdHVyZXMucDsKCQoJCQkJLyogTG9vcCBvdmVyIGVhY2ggaW5zdGFuY2Ugb2YgdGhlIHBhZ2VyICovCgkJCQlmb3IgKCB2YXIgaT0wLCBpTGVuPWFuLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJaWYgKCBhbltpXS5jaGlsZE5vZGVzLmxlbmd0aCAhPT0gMCApCgkJCQkJewoJCQkJCQlhbltpXS5jaGlsZE5vZGVzWzBdLmNsYXNzTmFtZSA9ICggb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ID09PSAwICkgPyAKCQkJCQkJCW9DbGFzc2VzLnNQYWdlUHJldkRpc2FibGVkIDogb0NsYXNzZXMuc1BhZ2VQcmV2RW5hYmxlZDsKCQkJCQkJCgkJCQkJCWFuW2ldLmNoaWxkTm9kZXNbMV0uY2xhc3NOYW1lID0gKCBvU2V0dGluZ3MuZm5EaXNwbGF5RW5kKCkgPT0gb1NldHRpbmdzLmZuUmVjb3Jkc0Rpc3BsYXkoKSApID8gCgkJCQkJCQlvQ2xhc3Nlcy5zUGFnZU5leHREaXNhYmxlZCA6IG9DbGFzc2VzLnNQYWdlTmV4dEVuYWJsZWQ7CgkJCQkJfQoJCQkJfQoJCQl9CgkJfSwKCQkKCQkKCQkvKgoJCSAqIFZhcmlhYmxlOiBpRnVsbE51bWJlcnNTaG93UGFnZXMKCQkgKiBQdXJwb3NlOiAgQ2hhbmdlIHRoZSBudW1iZXIgb2YgcGFnZXMgd2hpY2ggY2FuIGJlIHNlZW4KCQkgKiBTY29wZTogICAgalF1ZXJ5LmZuLmRhdGFUYWJsZUV4dC5vUGFnaW5hdGlvbgoJCSAqLwoJCSJpRnVsbE51bWJlcnNTaG93UGFnZXMiOiA1LAoJCQoJCS8qCgkJICogVmFyaWFibGU6IGZ1bGxfbnVtYmVycwoJCSAqIFB1cnBvc2U6ICBGdWxsIG51bWJlcnMgcGFnaW5hdGlvbgoJCSAqIFNjb3BlOiAgICBqUXVlcnkuZm4uZGF0YVRhYmxlRXh0Lm9QYWdpbmF0aW9uCgkJICovCgkJImZ1bGxfbnVtYmVycyI6IHsKCQkJLyoKCQkJICogRnVuY3Rpb246IG9QYWdpbmF0aW9uLmZ1bGxfbnVtYmVycy5mbkluaXQKCQkJICogUHVycG9zZTogIEluaXRpYWxpc2UgZG9tIGVsZW1lbnRzIHJlcXVpcmVkIGZvciBwYWdpbmF0aW9uIHdpdGggYSBsaXN0IG9mIHRoZSBwYWdlcwoJCQkgKiBSZXR1cm5zOiAgLQoJCQkgKiBJbnB1dHM6ICAgb2JqZWN0Om9TZXR0aW5ncyAtIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJCSAqICAgICAgICAgICBub2RlOm5QYWdpbmcgLSB0aGUgRElWIHdoaWNoIGNvbnRhaW5zIHRoaXMgcGFnaW5hdGlvbiBjb250cm9sCgkJCSAqICAgICAgICAgICBmdW5jdGlvbjpmbkNhbGxiYWNrRHJhdyAtIGRyYXcgZnVuY3Rpb24gd2hpY2ggbXVzdCBiZSBjYWxsZWQgb24gdXBkYXRlCgkJCSAqLwoJCQkiZm5Jbml0IjogZnVuY3Rpb24gKCBvU2V0dGluZ3MsIG5QYWdpbmcsIGZuQ2FsbGJhY2tEcmF3ICkKCQkJewoJCQkJdmFyIG9MYW5nID0gb1NldHRpbmdzLm9MYW5ndWFnZS5vUGFnaW5hdGU7CgkJCQl2YXIgb0NsYXNzZXMgPSBvU2V0dGluZ3Mub0NsYXNzZXM7CgkJCQl2YXIgZm5DbGlja0hhbmRsZXIgPSBmdW5jdGlvbiAoIGUgKSB7CgkJCQkJaWYgKCBvU2V0dGluZ3Mub0FwaS5fZm5QYWdlQ2hhbmdlKCBvU2V0dGluZ3MsIGUuZGF0YS5hY3Rpb24gKSApCgkJCQkJewoJCQkJCQlmbkNhbGxiYWNrRHJhdyggb1NldHRpbmdzICk7CgkJCQkJfQoJCQkJfTsKCQoJCQkJJChuUGFnaW5nKS5hcHBlbmQoCgkJCQkJJzxhICB0YWJpbmRleD0iJytvU2V0dGluZ3MuaVRhYkluZGV4KyciIGNsYXNzPSInK29DbGFzc2VzLnNQYWdlQnV0dG9uKyIgIitvQ2xhc3Nlcy5zUGFnZUZpcnN0KyciPicrb0xhbmcuc0ZpcnN0Kyc8L2E+JysKCQkJCQknPGEgIHRhYmluZGV4PSInK29TZXR0aW5ncy5pVGFiSW5kZXgrJyIgY2xhc3M9Iicrb0NsYXNzZXMuc1BhZ2VCdXR0b24rIiAiK29DbGFzc2VzLnNQYWdlUHJldmlvdXMrJyI+JytvTGFuZy5zUHJldmlvdXMrJzwvYT4nKwoJCQkJCSc8c3Bhbj48L3NwYW4+JysKCQkJCQknPGEgdGFiaW5kZXg9Iicrb1NldHRpbmdzLmlUYWJJbmRleCsnIiBjbGFzcz0iJytvQ2xhc3Nlcy5zUGFnZUJ1dHRvbisiICIrb0NsYXNzZXMuc1BhZ2VOZXh0KyciPicrb0xhbmcuc05leHQrJzwvYT4nKwoJCQkJCSc8YSB0YWJpbmRleD0iJytvU2V0dGluZ3MuaVRhYkluZGV4KyciIGNsYXNzPSInK29DbGFzc2VzLnNQYWdlQnV0dG9uKyIgIitvQ2xhc3Nlcy5zUGFnZUxhc3QrJyI+JytvTGFuZy5zTGFzdCsnPC9hPicKCQkJCSk7CgkJCQl2YXIgZWxzID0gJCgnYScsIG5QYWdpbmcpOwoJCQkJdmFyIG5GaXJzdCA9IGVsc1swXSwKCQkJCQluUHJldiA9IGVsc1sxXSwKCQkJCQluTmV4dCA9IGVsc1syXSwKCQkJCQluTGFzdCA9IGVsc1szXTsKCQkJCQoJCQkJb1NldHRpbmdzLm9BcGkuX2ZuQmluZEFjdGlvbiggbkZpcnN0LCB7YWN0aW9uOiAiZmlyc3QifSwgICAgZm5DbGlja0hhbmRsZXIgKTsKCQkJCW9TZXR0aW5ncy5vQXBpLl9mbkJpbmRBY3Rpb24oIG5QcmV2LCAge2FjdGlvbjogInByZXZpb3VzIn0sIGZuQ2xpY2tIYW5kbGVyICk7CgkJCQlvU2V0dGluZ3Mub0FwaS5fZm5CaW5kQWN0aW9uKCBuTmV4dCwgIHthY3Rpb246ICJuZXh0In0sICAgICBmbkNsaWNrSGFuZGxlciApOwoJCQkJb1NldHRpbmdzLm9BcGkuX2ZuQmluZEFjdGlvbiggbkxhc3QsICB7YWN0aW9uOiAibGFzdCJ9LCAgICAgZm5DbGlja0hhbmRsZXIgKTsKCQkJCQoJCQkJLyogSUQgdGhlIGZpcnN0IGVsZW1lbnRzIG9ubHkgKi8KCQkJCWlmICggIW9TZXR0aW5ncy5hYW5GZWF0dXJlcy5wICkKCQkJCXsKCQkJCQluUGFnaW5nLmlkID0gb1NldHRpbmdzLnNUYWJsZUlkKydfcGFnaW5hdGUnOwoJCQkJCW5GaXJzdC5pZCA9b1NldHRpbmdzLnNUYWJsZUlkKydfZmlyc3QnOwoJCQkJCW5QcmV2LmlkID1vU2V0dGluZ3Muc1RhYmxlSWQrJ19wcmV2aW91cyc7CgkJCQkJbk5leHQuaWQgPW9TZXR0aW5ncy5zVGFibGVJZCsnX25leHQnOwoJCQkJCW5MYXN0LmlkID1vU2V0dGluZ3Muc1RhYmxlSWQrJ19sYXN0JzsKCQkJCX0KCQkJfSwKCQkJCgkJCS8qCgkJCSAqIEZ1bmN0aW9uOiBvUGFnaW5hdGlvbi5mdWxsX251bWJlcnMuZm5VcGRhdGUKCQkJICogUHVycG9zZTogIFVwZGF0ZSB0aGUgbGlzdCBvZiBwYWdlIGJ1dHRvbnMgc2hvd3MKCQkJICogUmV0dXJuczogIC0KCQkJICogSW5wdXRzOiAgIG9iamVjdDpvU2V0dGluZ3MgLSBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCQkgKiAgICAgICAgICAgZnVuY3Rpb246Zm5DYWxsYmFja0RyYXcgLSBkcmF3IGZ1bmN0aW9uIHRvIGNhbGwgb24gcGFnZSBjaGFuZ2UKCQkJICovCgkJCSJmblVwZGF0ZSI6IGZ1bmN0aW9uICggb1NldHRpbmdzLCBmbkNhbGxiYWNrRHJhdyApCgkJCXsKCQkJCWlmICggIW9TZXR0aW5ncy5hYW5GZWF0dXJlcy5wICkKCQkJCXsKCQkJCQlyZXR1cm47CgkJCQl9CgkJCQkKCQkJCXZhciBpUGFnZUNvdW50ID0gRGF0YVRhYmxlLmV4dC5vUGFnaW5hdGlvbi5pRnVsbE51bWJlcnNTaG93UGFnZXM7CgkJCQl2YXIgaVBhZ2VDb3VudEhhbGYgPSBNYXRoLmZsb29yKGlQYWdlQ291bnQgLyAyKTsKCQkJCXZhciBpUGFnZXMgPSBNYXRoLmNlaWwoKG9TZXR0aW5ncy5mblJlY29yZHNEaXNwbGF5KCkpIC8gb1NldHRpbmdzLl9pRGlzcGxheUxlbmd0aCk7CgkJCQl2YXIgaUN1cnJlbnRQYWdlID0gTWF0aC5jZWlsKG9TZXR0aW5ncy5faURpc3BsYXlTdGFydCAvIG9TZXR0aW5ncy5faURpc3BsYXlMZW5ndGgpICsgMTsKCQkJCXZhciBzTGlzdCA9ICIiOwoJCQkJdmFyIGlTdGFydEJ1dHRvbiwgaUVuZEJ1dHRvbiwgaSwgaUxlbjsKCQkJCXZhciBvQ2xhc3NlcyA9IG9TZXR0aW5ncy5vQ2xhc3NlczsKCQkJCXZhciBhbkJ1dHRvbnMsIGFuU3RhdGljLCBuUGFnaW5hdGVMaXN0OwoJCQkJdmFyIGFuID0gb1NldHRpbmdzLmFhbkZlYXR1cmVzLnA7CgkJCQl2YXIgZm5CaW5kID0gZnVuY3Rpb24gKGopIHsKCQkJCQlvU2V0dGluZ3Mub0FwaS5fZm5CaW5kQWN0aW9uKCB0aGlzLCB7InBhZ2UiOiBqK2lTdGFydEJ1dHRvbi0xfSwgZnVuY3Rpb24oZSkgewoJCQkJCQkvKiBVc2UgdGhlIGluZm9ybWF0aW9uIGluIHRoZSBlbGVtZW50IHRvIGp1bXAgdG8gdGhlIHJlcXVpcmVkIHBhZ2UgKi8KCQkJCQkJb1NldHRpbmdzLm9BcGkuX2ZuUGFnZUNoYW5nZSggb1NldHRpbmdzLCBlLmRhdGEucGFnZSApOwoJCQkJCQlmbkNhbGxiYWNrRHJhdyggb1NldHRpbmdzICk7CgkJCQkJCWUucHJldmVudERlZmF1bHQoKTsKCQkJCQl9ICk7CgkJCQl9OwoJCQkJCgkJCQkvKiBQYWdlcyBjYWxjdWxhdGlvbiAqLwoJCQkJaWYgKCBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoID09PSAtMSApCgkJCQl7CgkJCQkJaVN0YXJ0QnV0dG9uID0gMTsKCQkJCQlpRW5kQnV0dG9uID0gMTsKCQkJCQlpQ3VycmVudFBhZ2UgPSAxOwoJCQkJfQoJCQkJZWxzZSBpZiAoaVBhZ2VzIDwgaVBhZ2VDb3VudCkKCQkJCXsKCQkJCQlpU3RhcnRCdXR0b24gPSAxOwoJCQkJCWlFbmRCdXR0b24gPSBpUGFnZXM7CgkJCQl9CgkJCQllbHNlIGlmIChpQ3VycmVudFBhZ2UgPD0gaVBhZ2VDb3VudEhhbGYpCgkJCQl7CgkJCQkJaVN0YXJ0QnV0dG9uID0gMTsKCQkJCQlpRW5kQnV0dG9uID0gaVBhZ2VDb3VudDsKCQkJCX0KCQkJCWVsc2UgaWYgKGlDdXJyZW50UGFnZSA+PSAoaVBhZ2VzIC0gaVBhZ2VDb3VudEhhbGYpKQoJCQkJewoJCQkJCWlTdGFydEJ1dHRvbiA9IGlQYWdlcyAtIGlQYWdlQ291bnQgKyAxOwoJCQkJCWlFbmRCdXR0b24gPSBpUGFnZXM7CgkJCQl9CgkJCQllbHNlCgkJCQl7CgkJCQkJaVN0YXJ0QnV0dG9uID0gaUN1cnJlbnRQYWdlIC0gTWF0aC5jZWlsKGlQYWdlQ291bnQgLyAyKSArIDE7CgkJCQkJaUVuZEJ1dHRvbiA9IGlTdGFydEJ1dHRvbiArIGlQYWdlQ291bnQgLSAxOwoJCQkJfQoJCgkJCQkKCQkJCS8qIEJ1aWxkIHRoZSBkeW5hbWljIGxpc3QgKi8KCQkJCWZvciAoIGk9aVN0YXJ0QnV0dG9uIDsgaTw9aUVuZEJ1dHRvbiA7IGkrKyApCgkJCQl7CgkJCQkJc0xpc3QgKz0gKGlDdXJyZW50UGFnZSAhPT0gaSkgPwoJCQkJCQknPGEgdGFiaW5kZXg9Iicrb1NldHRpbmdzLmlUYWJJbmRleCsnIiBjbGFzcz0iJytvQ2xhc3Nlcy5zUGFnZUJ1dHRvbisnIj4nK29TZXR0aW5ncy5mbkZvcm1hdE51bWJlcihpKSsnPC9hPicgOgoJCQkJCQknPGEgdGFiaW5kZXg9Iicrb1NldHRpbmdzLmlUYWJJbmRleCsnIiBjbGFzcz0iJytvQ2xhc3Nlcy5zUGFnZUJ1dHRvbkFjdGl2ZSsnIj4nK29TZXR0aW5ncy5mbkZvcm1hdE51bWJlcihpKSsnPC9hPic7CgkJCQl9CgkJCQkKCQkJCS8qIExvb3Agb3ZlciBlYWNoIGluc3RhbmNlIG9mIHRoZSBwYWdlciAqLwoJCQkJZm9yICggaT0wLCBpTGVuPWFuLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJaWYgKCBhbltpXS5jaGlsZE5vZGVzLmxlbmd0aCA9PT0gMCApCgkJCQkJewoJCQkJCQljb250aW51ZTsKCQkJCQl9CgkJCQkJCgkJCQkJLyogQnVpbGQgdXAgdGhlIGR5bmFtaWMgbGlzdCBmb3JzdCAtIGh0bWwgYW5kIGxpc3RlbmVycyAqLwoJCQkJCSQoJ3NwYW46ZXEoMCknLCBhbltpXSkKCQkJCQkJLmh0bWwoIHNMaXN0ICkKCQkJCQkJLmNoaWxkcmVuKCdhJykuZWFjaCggZm5CaW5kICk7CgkJCQkJCgkJCQkJLyogVXBkYXRlIHRoZSBwcmVtYW5lbnQgYm90dG9uJ3MgY2xhc3NlcyAqLwoJCQkJCWFuQnV0dG9ucyA9IGFuW2ldLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdhJyk7CgkJCQkJYW5TdGF0aWMgPSBbCgkJCQkJCWFuQnV0dG9uc1swXSwgYW5CdXR0b25zWzFdLCAKCQkJCQkJYW5CdXR0b25zW2FuQnV0dG9ucy5sZW5ndGgtMl0sIGFuQnV0dG9uc1thbkJ1dHRvbnMubGVuZ3RoLTFdCgkJCQkJXTsKCQoJCQkJCSQoYW5TdGF0aWMpLnJlbW92ZUNsYXNzKCBvQ2xhc3Nlcy5zUGFnZUJ1dHRvbisiICIrb0NsYXNzZXMuc1BhZ2VCdXR0b25BY3RpdmUrIiAiK29DbGFzc2VzLnNQYWdlQnV0dG9uU3RhdGljRGlzYWJsZWQgKTsKCQkJCQkkKFthblN0YXRpY1swXSwgYW5TdGF0aWNbMV1dKS5hZGRDbGFzcyggCgkJCQkJCShpQ3VycmVudFBhZ2U9PTEpID8KCQkJCQkJCW9DbGFzc2VzLnNQYWdlQnV0dG9uU3RhdGljRGlzYWJsZWQgOgoJCQkJCQkJb0NsYXNzZXMuc1BhZ2VCdXR0b24KCQkJCQkpOwoJCQkJCSQoW2FuU3RhdGljWzJdLCBhblN0YXRpY1szXV0pLmFkZENsYXNzKAoJCQkJCQkoaVBhZ2VzPT09MCB8fCBpQ3VycmVudFBhZ2U9PT1pUGFnZXMgfHwgb1NldHRpbmdzLl9pRGlzcGxheUxlbmd0aD09PS0xKSA/CgkJCQkJCQlvQ2xhc3Nlcy5zUGFnZUJ1dHRvblN0YXRpY0Rpc2FibGVkIDoKCQkJCQkJCW9DbGFzc2VzLnNQYWdlQnV0dG9uCgkJCQkJKTsKCQkJCX0KCQkJfQoJCX0KCX0gKTsKCQoJJC5leHRlbmQoIERhdGFUYWJsZS5leHQub1NvcnQsIHsKCQkvKgoJCSAqIHRleHQgc29ydGluZwoJCSAqLwoJCSJzdHJpbmctcHJlIjogZnVuY3Rpb24gKCBhICkKCQl7CgkJCWlmICggdHlwZW9mIGEgIT0gJ3N0cmluZycgKSB7CgkJCQlhID0gKGEgIT09IG51bGwgJiYgYS50b1N0cmluZykgPyBhLnRvU3RyaW5nKCkgOiAnJzsKCQkJfQoJCQlyZXR1cm4gYS50b0xvd2VyQ2FzZSgpOwoJCX0sCgkKCQkic3RyaW5nLWFzYyI6IGZ1bmN0aW9uICggeCwgeSApCgkJewoJCQlyZXR1cm4gKCh4IDwgeSkgPyAtMSA6ICgoeCA+IHkpID8gMSA6IDApKTsKCQl9LAoJCQoJCSJzdHJpbmctZGVzYyI6IGZ1bmN0aW9uICggeCwgeSApCgkJewoJCQlyZXR1cm4gKCh4IDwgeSkgPyAxIDogKCh4ID4geSkgPyAtMSA6IDApKTsKCQl9LAoJCQoJCQoJCS8qCgkJICogaHRtbCBzb3J0aW5nIChpZ25vcmUgaHRtbCB0YWdzKQoJCSAqLwoJCSJodG1sLXByZSI6IGZ1bmN0aW9uICggYSApCgkJewoJCQlyZXR1cm4gYS5yZXBsYWNlKCAvPC4qPz4vZywgIiIgKS50b0xvd2VyQ2FzZSgpOwoJCX0sCgkJCgkJImh0bWwtYXNjIjogZnVuY3Rpb24gKCB4LCB5ICkKCQl7CgkJCXJldHVybiAoKHggPCB5KSA/IC0xIDogKCh4ID4geSkgPyAxIDogMCkpOwoJCX0sCgkJCgkJImh0bWwtZGVzYyI6IGZ1bmN0aW9uICggeCwgeSApCgkJewoJCQlyZXR1cm4gKCh4IDwgeSkgPyAxIDogKCh4ID4geSkgPyAtMSA6IDApKTsKCQl9LAoJCQoJCQoJCS8qCgkJICogZGF0ZSBzb3J0aW5nCgkJICovCgkJImRhdGUtcHJlIjogZnVuY3Rpb24gKCBhICkKCQl7CgkJCXZhciB4ID0gRGF0ZS5wYXJzZSggYSApOwoJCQkKCQkJaWYgKCBpc05hTih4KSB8fCB4PT09IiIgKQoJCQl7CgkJCQl4ID0gRGF0ZS5wYXJzZSggIjAxLzAxLzE5NzAgMDA6MDA6MDAiICk7CgkJCX0KCQkJcmV0dXJuIHg7CgkJfSwKCQoJCSJkYXRlLWFzYyI6IGZ1bmN0aW9uICggeCwgeSApCgkJewoJCQlyZXR1cm4geCAtIHk7CgkJfSwKCQkKCQkiZGF0ZS1kZXNjIjogZnVuY3Rpb24gKCB4LCB5ICkKCQl7CgkJCXJldHVybiB5IC0geDsKCQl9LAoJCQoJCQoJCS8qCgkJICogbnVtZXJpY2FsIHNvcnRpbmcKCQkgKi8KCQkibnVtZXJpYy1wcmUiOiBmdW5jdGlvbiAoIGEgKQoJCXsKCQkJcmV0dXJuIChhPT0iLSIgfHwgYT09PSIiKSA/IDAgOiBhKjE7CgkJfSwKCQoJCSJudW1lcmljLWFzYyI6IGZ1bmN0aW9uICggeCwgeSApCgkJewoJCQlyZXR1cm4geCAtIHk7CgkJfSwKCQkKCQkibnVtZXJpYy1kZXNjIjogZnVuY3Rpb24gKCB4LCB5ICkKCQl7CgkJCXJldHVybiB5IC0geDsKCQl9Cgl9ICk7CgkKCQoJJC5leHRlbmQoIERhdGFUYWJsZS5leHQuYVR5cGVzLCBbCgkJLyoKCQkgKiBGdW5jdGlvbjogLQoJCSAqIFB1cnBvc2U6ICBDaGVjayB0byBzZWUgaWYgYSBzdHJpbmcgaXMgbnVtZXJpYwoJCSAqIFJldHVybnM6ICBzdHJpbmc6J251bWVyaWMnIG9yIG51bGwKCQkgKiBJbnB1dHM6ICAgbWl4ZWQ6c1RleHQgLSBzdHJpbmcgdG8gY2hlY2sKCQkgKi8KCQlmdW5jdGlvbiAoIHNEYXRhICkKCQl7CgkJCS8qIEFsbG93IHplcm8gbGVuZ3RoIHN0cmluZ3MgYXMgYSBudW1iZXIgKi8KCQkJaWYgKCB0eXBlb2Ygc0RhdGEgPT09ICdudW1iZXInICkKCQkJewoJCQkJcmV0dXJuICdudW1lcmljJzsKCQkJfQoJCQllbHNlIGlmICggdHlwZW9mIHNEYXRhICE9PSAnc3RyaW5nJyApCgkJCXsKCQkJCXJldHVybiBudWxsOwoJCQl9CgkJCQoJCQl2YXIgc1ZhbGlkRmlyc3RDaGFycyA9ICIwMTIzNDU2Nzg5LSI7CgkJCXZhciBzVmFsaWRDaGFycyA9ICIwMTIzNDU2Nzg5LiI7CgkJCXZhciBDaGFyOwoJCQl2YXIgYkRlY2ltYWwgPSBmYWxzZTsKCQkJCgkJCS8qIENoZWNrIGZvciBhIHZhbGlkIGZpcnN0IGNoYXIgKG5vIHBlcmlvZCBhbmQgYWxsb3cgbmVnYXRpdmVzKSAqLwoJCQlDaGFyID0gc0RhdGEuY2hhckF0KDApOyAKCQkJaWYgKHNWYWxpZEZpcnN0Q2hhcnMuaW5kZXhPZihDaGFyKSA9PSAtMSkgCgkJCXsKCQkJCXJldHVybiBudWxsOwoJCQl9CgkJCQoJCQkvKiBDaGVjayBhbGwgdGhlIG90aGVyIGNoYXJhY3RlcnMgYXJlIHZhbGlkICovCgkJCWZvciAoIHZhciBpPTEgOyBpPHNEYXRhLmxlbmd0aCA7IGkrKyApIAoJCQl7CgkJCQlDaGFyID0gc0RhdGEuY2hhckF0KGkpOyAKCQkJCWlmIChzVmFsaWRDaGFycy5pbmRleE9mKENoYXIpID09IC0xKSAKCQkJCXsKCQkJCQlyZXR1cm4gbnVsbDsKCQkJCX0KCQkJCQoJCQkJLyogT25seSBhbGxvd2VkIG9uZSBkZWNpbWFsIHBsYWNlLi4uICovCgkJCQlpZiAoIENoYXIgPT0gIi4iICkKCQkJCXsKCQkJCQlpZiAoIGJEZWNpbWFsICkKCQkJCQl7CgkJCQkJCXJldHVybiBudWxsOwoJCQkJCX0KCQkJCQliRGVjaW1hbCA9IHRydWU7CgkJCQl9CgkJCX0KCQkJCgkJCXJldHVybiAnbnVtZXJpYyc7CgkJfSwKCQkKCQkvKgoJCSAqIEZ1bmN0aW9uOiAtCgkJICogUHVycG9zZTogIENoZWNrIHRvIHNlZSBpZiBhIHN0cmluZyBpcyBhY3R1YWxseSBhIGZvcm1hdHRlZCBkYXRlCgkJICogUmV0dXJuczogIHN0cmluZzonZGF0ZScgb3IgbnVsbAoJCSAqIElucHV0czogICBzdHJpbmc6c1RleHQgLSBzdHJpbmcgdG8gY2hlY2sKCQkgKi8KCQlmdW5jdGlvbiAoIHNEYXRhICkKCQl7CgkJCXZhciBpUGFyc2UgPSBEYXRlLnBhcnNlKHNEYXRhKTsKCQkJaWYgKCAoaVBhcnNlICE9PSBudWxsICYmICFpc05hTihpUGFyc2UpKSB8fCAodHlwZW9mIHNEYXRhID09PSAnc3RyaW5nJyAmJiBzRGF0YS5sZW5ndGggPT09IDApICkKCQkJewoJCQkJcmV0dXJuICdkYXRlJzsKCQkJfQoJCQlyZXR1cm4gbnVsbDsKCQl9LAoJCQoJCS8qCgkJICogRnVuY3Rpb246IC0KCQkgKiBQdXJwb3NlOiAgQ2hlY2sgdG8gc2VlIGlmIGEgc3RyaW5nIHNob3VsZCBiZSB0cmVhdGVkIGFzIGFuIEhUTUwgc3RyaW5nCgkJICogUmV0dXJuczogIHN0cmluZzonaHRtbCcgb3IgbnVsbAoJCSAqIElucHV0czogICBzdHJpbmc6c1RleHQgLSBzdHJpbmcgdG8gY2hlY2sKCQkgKi8KCQlmdW5jdGlvbiAoIHNEYXRhICkKCQl7CgkJCWlmICggdHlwZW9mIHNEYXRhID09PSAnc3RyaW5nJyAmJiBzRGF0YS5pbmRleE9mKCc8JykgIT0gLTEgJiYgc0RhdGEuaW5kZXhPZignPicpICE9IC0xICkKCQkJewoJCQkJcmV0dXJuICdodG1sJzsKCQkJfQoJCQlyZXR1cm4gbnVsbDsKCQl9CgldICk7CgkKCgkvLyBqUXVlcnkgYWxpYXNlcwoJJC5mbi5EYXRhVGFibGUgPSBEYXRhVGFibGU7CgkkLmZuLmRhdGFUYWJsZSA9IERhdGFUYWJsZTsKCSQuZm4uZGF0YVRhYmxlU2V0dGluZ3MgPSBEYXRhVGFibGUuc2V0dGluZ3M7CgkkLmZuLmRhdGFUYWJsZUV4dCA9IERhdGFUYWJsZS5leHQ7CgoKCS8vIEluZm9ybWF0aW9uIGFib3V0IGV2ZW50cyBmaXJlZCBieSBEYXRhVGFibGVzIC0gZm9yIGRvY3VtZW50YXRpb24uCgkvKioKCSAqIERyYXcgZXZlbnQsIGZpcmVkIHdoZW5ldmVyIHRoZSB0YWJsZSBpcyByZWRyYXduIG9uIHRoZSBwYWdlLCBhdCB0aGUgc2FtZSBwb2ludCBhcwoJICogZm5EcmF3Q2FsbGJhY2suIFRoaXMgbWF5IGJlIHVzZWZ1bCBmb3IgYmluZGluZyBldmVudHMgb3IgcGVyZm9ybWluZyBjYWxjdWxhdGlvbnMgd2hlbgoJICogdGhlIHRhYmxlIGlzIGFsdGVyZWQgYXQgYWxsLgoJICogIEBuYW1lIERhdGFUYWJsZSNkcmF3CgkgKiAgQGV2ZW50CgkgKiAgQHBhcmFtIHtldmVudH0gZSBqUXVlcnkgZXZlbnQgb2JqZWN0CgkgKiAgQHBhcmFtIHtvYmplY3R9IG8gRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3Qge0BsaW5rIERhdGFUYWJsZS5tb2RlbHMub1NldHRpbmdzfQoJICovCgoJLyoqCgkgKiBGaWx0ZXIgZXZlbnQsIGZpcmVkIHdoZW4gdGhlIGZpbHRlcmluZyBhcHBsaWVkIHRvIHRoZSB0YWJsZSAodXNpbmcgdGhlIGJ1aWxkIGluIGdsb2JhbAoJICogZ2xvYmFsIGZpbHRlciwgb3IgY29sdW1uIGZpbHRlcnMpIGlzIGFsdGVyZWQuCgkgKiAgQG5hbWUgRGF0YVRhYmxlI2ZpbHRlcgoJICogIEBldmVudAoJICogIEBwYXJhbSB7ZXZlbnR9IGUgalF1ZXJ5IGV2ZW50IG9iamVjdAoJICogIEBwYXJhbSB7b2JqZWN0fSBvIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0IHtAbGluayBEYXRhVGFibGUubW9kZWxzLm9TZXR0aW5nc30KCSAqLwoKCS8qKgoJICogUGFnZSBjaGFuZ2UgZXZlbnQsIGZpcmVkIHdoZW4gdGhlIHBhZ2luZyBvZiB0aGUgdGFibGUgaXMgYWx0ZXJlZC4KCSAqICBAbmFtZSBEYXRhVGFibGUjcGFnZQoJICogIEBldmVudAoJICogIEBwYXJhbSB7ZXZlbnR9IGUgalF1ZXJ5IGV2ZW50IG9iamVjdAoJICogIEBwYXJhbSB7b2JqZWN0fSBvIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0IHtAbGluayBEYXRhVGFibGUubW9kZWxzLm9TZXR0aW5nc30KCSAqLwoKCS8qKgoJICogU29ydCBldmVudCwgZmlyZWQgd2hlbiB0aGUgc29ydGluZyBhcHBsaWVkIHRvIHRoZSB0YWJsZSBpcyBhbHRlcmVkLgoJICogIEBuYW1lIERhdGFUYWJsZSNzb3J0CgkgKiAgQGV2ZW50CgkgKiAgQHBhcmFtIHtldmVudH0gZSBqUXVlcnkgZXZlbnQgb2JqZWN0CgkgKiAgQHBhcmFtIHtvYmplY3R9IG8gRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3Qge0BsaW5rIERhdGFUYWJsZS5tb2RlbHMub1NldHRpbmdzfQoJICovCgoJLyoqCgkgKiBEYXRhVGFibGVzIGluaXRpYWxpc2F0aW9uIGNvbXBsZXRlIGV2ZW50LCBmaXJlZCB3aGVuIHRoZSB0YWJsZSBpcyBmdWxseSBkcmF3biwKCSAqIGluY2x1ZGluZyBBamF4IGRhdGEgbG9hZGVkLCBpZiBBamF4IGRhdGEgaXMgcmVxdWlyZWQuCgkgKiAgQG5hbWUgRGF0YVRhYmxlI2luaXQKCSAqICBAZXZlbnQKCSAqICBAcGFyYW0ge2V2ZW50fSBlIGpRdWVyeSBldmVudCBvYmplY3QKCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkgKiAgQHBhcmFtIHtvYmplY3R9IGpzb24gVGhlIEpTT04gb2JqZWN0IHJlcXVlc3QgZnJvbSB0aGUgc2VydmVyIC0gb25seQoJICogICAgcHJlc2VudCBpZiBjbGllbnQtc2lkZSBBamF4IHNvdXJjZWQgZGF0YSBpcyB1c2VkPC9saT48L29sPgoJICovCgoJLyoqCgkgKiBTdGF0ZSBzYXZlIGV2ZW50LCBmaXJlZCB3aGVuIHRoZSB0YWJsZSBoYXMgY2hhbmdlZCBzdGF0ZSBhIG5ldyBzdGF0ZSBzYXZlIGlzIHJlcXVpcmVkLgoJICogVGhpcyBtZXRob2QgYWxsb3dzIG1vZGlmaWNhdGlvbiBvZiB0aGUgc3RhdGUgc2F2aW5nIG9iamVjdCBwcmlvciB0byBhY3R1YWxseSBkb2luZyB0aGUKCSAqIHNhdmUsIGluY2x1ZGluZyBhZGRpdGlvbiBvciBvdGhlciBzdGF0ZSBwcm9wZXJ0aWVzIChmb3IgcGx1Zy1pbnMpIG9yIG1vZGlmaWNhdGlvbgoJICogb2YgYSBEYXRhVGFibGVzIGNvcmUgcHJvcGVydHkuCgkgKiAgQG5hbWUgRGF0YVRhYmxlI3N0YXRlU2F2ZVBhcmFtcwoJICogIEBldmVudAoJICogIEBwYXJhbSB7ZXZlbnR9IGUgalF1ZXJ5IGV2ZW50IG9iamVjdAoJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCSAqICBAcGFyYW0ge29iamVjdH0ganNvbiBUaGUgc3RhdGUgaW5mb3JtYXRpb24gdG8gYmUgc2F2ZWQKCSAqLwoKCS8qKgoJICogU3RhdGUgbG9hZCBldmVudCwgZmlyZWQgd2hlbiB0aGUgdGFibGUgaXMgbG9hZGluZyBzdGF0ZSBmcm9tIHRoZSBzdG9yZWQgZGF0YSwgYnV0CgkgKiBwcmlvciB0byB0aGUgc2V0dGluZ3Mgb2JqZWN0IGJlaW5nIG1vZGlmaWVkIGJ5IHRoZSBzYXZlZCBzdGF0ZSAtIGFsbG93aW5nIG1vZGlmaWNhdGlvbgoJICogb2YgdGhlIHNhdmVkIHN0YXRlIGlzIHJlcXVpcmVkIG9yIGxvYWRpbmcgb2Ygc3RhdGUgZm9yIGEgcGx1Zy1pbi4KCSAqICBAbmFtZSBEYXRhVGFibGUjc3RhdGVMb2FkUGFyYW1zCgkgKiAgQGV2ZW50CgkgKiAgQHBhcmFtIHtldmVudH0gZSBqUXVlcnkgZXZlbnQgb2JqZWN0CgkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJICogIEBwYXJhbSB7b2JqZWN0fSBqc29uIFRoZSBzYXZlZCBzdGF0ZSBpbmZvcm1hdGlvbgoJICovCgoJLyoqCgkgKiBTdGF0ZSBsb2FkZWQgZXZlbnQsIGZpcmVkIHdoZW4gc3RhdGUgaGFzIGJlZW4gbG9hZGVkIGZyb20gc3RvcmVkIGRhdGEgYW5kIHRoZSBzZXR0aW5ncwoJICogb2JqZWN0IGhhcyBiZWVuIG1vZGlmaWVkIGJ5IHRoZSBsb2FkZWQgZGF0YS4KCSAqICBAbmFtZSBEYXRhVGFibGUjc3RhdGVMb2FkZWQKCSAqICBAZXZlbnQKCSAqICBAcGFyYW0ge2V2ZW50fSBlIGpRdWVyeSBldmVudCBvYmplY3QKCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkgKiAgQHBhcmFtIHtvYmplY3R9IGpzb24gVGhlIHNhdmVkIHN0YXRlIGluZm9ybWF0aW9uCgkgKi8KCgkvKioKCSAqIFByb2Nlc3NpbmcgZXZlbnQsIGZpcmVkIHdoZW4gRGF0YVRhYmxlcyBpcyBkb2luZyBzb21lIGtpbmQgb2YgcHJvY2Vzc2luZyAoYmUgaXQsCgkgKiBzb3J0LCBmaWx0ZXIgb3IgYW55dGhpbmcgZWxzZSkuIENhbiBiZSB1c2VkIHRvIGluZGljYXRlIHRvIHRoZSBlbmQgdXNlciB0aGF0CgkgKiB0aGVyZSBpcyBzb21ldGhpbmcgaGFwcGVuaW5nLCBvciB0aGF0IHNvbWV0aGluZyBoYXMgZmluaXNoZWQuCgkgKiAgQG5hbWUgRGF0YVRhYmxlI3Byb2Nlc3NpbmcKCSAqICBAZXZlbnQKCSAqICBAcGFyYW0ge2V2ZW50fSBlIGpRdWVyeSBldmVudCBvYmplY3QKCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkgKiAgQHBhcmFtIHtib29sZWFufSBiU2hvdyBGbGFnIGZvciBpZiBEYXRhVGFibGVzIGlzIGRvaW5nIHByb2Nlc3Npbmcgb3Igbm90CgkgKi8KCgkvKioKCSAqIEFqYXggKFhIUikgZXZlbnQsIGZpcmVkIHdoZW5ldmVyIGFuIEFqYXggcmVxdWVzdCBpcyBjb21wbGV0ZWQgZnJvbSBhIHJlcXVlc3QgdG8gCgkgKiBtYWRlIHRvIHRoZSBzZXJ2ZXIgZm9yIG5ldyBkYXRhIChub3RlIHRoYXQgdGhpcyB0cmlnZ2VyIGlzIGNhbGxlZCBpbiBmblNlcnZlckRhdGEsCgkgKiBpZiB5b3Ugb3ZlcnJpZGUgZm5TZXJ2ZXJEYXRhIGFuZCB3aGljaCB0byB1c2UgdGhpcyBldmVudCwgeW91IG5lZWQgdG8gdHJpZ2dlciBpdCBpbgoJICogeW91IHN1Y2Nlc3MgZnVuY3Rpb24pLgoJICogIEBuYW1lIERhdGFUYWJsZSN4aHIKCSAqICBAZXZlbnQKCSAqICBAcGFyYW0ge2V2ZW50fSBlIGpRdWVyeSBldmVudCBvYmplY3QKCSAqICBAcGFyYW0ge29iamVjdH0gbyBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdCB7QGxpbmsgRGF0YVRhYmxlLm1vZGVscy5vU2V0dGluZ3N9CgkgKi8KCgkvKioKCSAqIERlc3Ryb3kgZXZlbnQsIGZpcmVkIHdoZW4gdGhlIERhdGFUYWJsZSBpcyBkZXN0cm95ZWQgYnkgY2FsbGluZyBmbkRlc3Ryb3kgb3IgcGFzc2luZwoJICogdGhlIGJEZXN0cm95OnRydWUgcGFyYW1ldGVyIGluIHRoZSBpbml0aWFsaXNhdGlvbiBvYmplY3QuIFRoaXMgY2FuIGJlIHVzZWQgdG8gcmVtb3ZlCgkgKiBib3VuZCBldmVudHMsIGFkZGVkIERPTSBub2RlcywgZXRjLgoJICogIEBuYW1lIERhdGFUYWJsZSNkZXN0cm95CgkgKiAgQGV2ZW50CgkgKiAgQHBhcmFtIHtldmVudH0gZSBqUXVlcnkgZXZlbnQgb2JqZWN0CgkgKiAgQHBhcmFtIHtvYmplY3R9IG8gRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3Qge0BsaW5rIERhdGFUYWJsZS5tb2RlbHMub1NldHRpbmdzfQoJICovCn0oalF1ZXJ5LCB3aW5kb3csIGRvY3VtZW50LCB1bmRlZmluZWQpKTsK",
                "body": "LyoqCiAqIEBzdW1tYXJ5ICAgICBEYXRhVGFibGVzCiAqIEBkZXNjcmlwdGlvbiBQYWdpbmF0ZSwgc2VhcmNoIGFuZCBzb3J0IEhUTUwgdGFibGVzCiAqIEB2ZXJzaW9uICAgICAxLjkuMgogKiBAZmlsZSAgICAgICAganF1ZXJ5LmRhdGFUYWJsZXMuanMKICogQGF1dGhvciAgICAgIEFsbGFuIEphcmRpbmUgKHd3dy5zcHJ5bWVkaWEuY28udWspCiAqIEBjb250YWN0ICAgICB3d3cuc3ByeW1lZGlhLmNvLnVrL2NvbnRhY3QKICoKICogQGNvcHlyaWdodCBDb3B5cmlnaHQgMjAwOC0yMDEyIEFsbGFuIEphcmRpbmUsIGFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqCiAqIFRoaXMgc291cmNlIGZpbGUgaXMgZnJlZSBzb2Z0d2FyZSwgdW5kZXIgZWl0aGVyIHRoZSBHUEwgdjIgbGljZW5zZSBvciBhCiAqIEJTRCBzdHlsZSBsaWNlbnNlLCBhdmFpbGFibGUgYXQ6CiAqICAgaHR0cDovL2RhdGF0YWJsZXMubmV0L2xpY2Vuc2VfZ3BsMgogKiAgIGh0dHA6Ly9kYXRhdGFibGVzLm5ldC9saWNlbnNlX2JzZAogKiAKICogVGhpcyBzb3VyY2UgZmlsZSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLCBidXQgCiAqIFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YgTUVSQ0hBTlRBQklMSVRZIAogKiBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gU2VlIHRoZSBsaWNlbnNlIGZpbGVzIGZvciBkZXRhaWxzLgogKiAKICogRm9yIGRldGFpbHMgcGxlYXNlIHJlZmVyIHRvOiBodHRwOi8vd3d3LmRhdGF0YWJsZXMubmV0CiAqLwoKLypqc2xpbnQgZXZpbDogdHJ1ZSwgdW5kZWY6IHRydWUsIGJyb3dzZXI6IHRydWUgKi8KLypnbG9iYWxzICQsIGpRdWVyeSxfZm5FeHRlcm5BcGlGdW5jLF9mbkluaXRpYWxpc2UsX2ZuSW5pdENvbXBsZXRlLF9mbkxhbmd1YWdlQ29tcGF0LF9mbkFkZENvbHVtbixfZm5Db2x1bW5PcHRpb25zLF9mbkFkZERhdGEsX2ZuQ3JlYXRlVHIsX2ZuR2F0aGVyRGF0YSxfZm5CdWlsZEhlYWQsX2ZuRHJhd0hlYWQsX2ZuRHJhdyxfZm5SZURyYXcsX2ZuQWpheFVwZGF0ZSxfZm5BamF4UGFyYW1ldGVycyxfZm5BamF4VXBkYXRlRHJhdyxfZm5TZXJ2ZXJQYXJhbXMsX2ZuQWRkT3B0aW9uc0h0bWwsX2ZuRmVhdHVyZUh0bWxUYWJsZSxfZm5TY3JvbGxEcmF3LF9mbkFkanVzdENvbHVtblNpemluZyxfZm5GZWF0dXJlSHRtbEZpbHRlcixfZm5GaWx0ZXJDb21wbGV0ZSxfZm5GaWx0ZXJDdXN0b20sX2ZuRmlsdGVyQ29sdW1uLF9mbkZpbHRlcixfZm5CdWlsZFNlYXJjaEFycmF5LF9mbkJ1aWxkU2VhcmNoUm93LF9mbkZpbHRlckNyZWF0ZVNlYXJjaCxfZm5EYXRhVG9TZWFyY2gsX2ZuU29ydCxfZm5Tb3J0QXR0YWNoTGlzdGVuZXIsX2ZuU29ydGluZ0NsYXNzZXMsX2ZuRmVhdHVyZUh0bWxQYWdpbmF0ZSxfZm5QYWdlQ2hhbmdlLF9mbkZlYXR1cmVIdG1sSW5mbyxfZm5VcGRhdGVJbmZvLF9mbkZlYXR1cmVIdG1sTGVuZ3RoLF9mbkZlYXR1cmVIdG1sUHJvY2Vzc2luZyxfZm5Qcm9jZXNzaW5nRGlzcGxheSxfZm5WaXNpYmxlVG9Db2x1bW5JbmRleCxfZm5Db2x1bW5JbmRleFRvVmlzaWJsZSxfZm5Ob2RlVG9EYXRhSW5kZXgsX2ZuVmlzYmxlQ29sdW1ucyxfZm5DYWxjdWxhdGVFbmQsX2ZuQ29udmVydFRvV2lkdGgsX2ZuQ2FsY3VsYXRlQ29sdW1uV2lkdGhzLF9mblNjcm9sbGluZ1dpZHRoQWRqdXN0LF9mbkdldFdpZGVzdE5vZGUsX2ZuR2V0TWF4TGVuU3RyaW5nLF9mblN0cmluZ1RvQ3NzLF9mbkRldGVjdFR5cGUsX2ZuU2V0dGluZ3NGcm9tTm9kZSxfZm5HZXREYXRhTWFzdGVyLF9mbkdldFRyTm9kZXMsX2ZuR2V0VGROb2RlcyxfZm5Fc2NhcGVSZWdleCxfZm5EZWxldGVJbmRleCxfZm5SZU9yZGVySW5kZXgsX2ZuQ29sdW1uT3JkZXJpbmcsX2ZuTG9nLF9mbkNsZWFyVGFibGUsX2ZuU2F2ZVN0YXRlLF9mbkxvYWRTdGF0ZSxfZm5DcmVhdGVDb29raWUsX2ZuUmVhZENvb2tpZSxfZm5EZXRlY3RIZWFkZXIsX2ZuR2V0VW5pcXVlVGhzLF9mblNjcm9sbEJhcldpZHRoLF9mbkFwcGx5VG9DaGlsZHJlbixfZm5NYXAsX2ZuR2V0Um93RGF0YSxfZm5HZXRDZWxsRGF0YSxfZm5TZXRDZWxsRGF0YSxfZm5HZXRPYmplY3REYXRhRm4sX2ZuU2V0T2JqZWN0RGF0YUZuLF9mbkFwcGx5Q29sdW1uRGVmcyxfZm5CaW5kQWN0aW9uLF9mbkNhbGxiYWNrUmVnLF9mbkNhbGxiYWNrRmlyZSxfZm5Kc29uU3RyaW5nLF9mblJlbmRlcixfZm5Ob2RlVG9Db2x1bW5JbmRleCxfZm5JbmZvTWFjcm9zKi8KCigvKiogQGxlbmRzIDxnbG9iYWw+ICovZnVuY3Rpb24oJCwgd2luZG93LCBkb2N1bWVudCwgdW5kZWZpbmVkKSB7CgkvKiogCgkgKiBEYXRhVGFibGVzIGlzIGEgcGx1Zy1pbiBmb3IgdGhlIGpRdWVyeSBKYXZhc2NyaXB0IGxpYnJhcnkuIEl0IGlzIGEgCgkgKiBoaWdobHkgZmxleGlibGUgdG9vbCwgYmFzZWQgdXBvbiB0aGUgZm91bmRhdGlvbnMgb2YgcHJvZ3Jlc3NpdmUgCgkgKiBlbmhhbmNlbWVudCwgd2hpY2ggd2lsbCBhZGQgYWR2YW5jZWQgaW50ZXJhY3Rpb24gY29udHJvbHMgdG8gYW55IAoJICogSFRNTCB0YWJsZS4gRm9yIGEgZnVsbCBsaXN0IG9mIGZlYXR1cmVzIHBsZWFzZSByZWZlciB0bwoJICogPGEgaHJlZj0iaHR0cDovL2RhdGF0YWJsZXMubmV0Ij5EYXRhVGFibGVzLm5ldDwvYT4uCgkgKgoJICogTm90ZSB0aGF0IHRoZSA8aT5EYXRhVGFibGU8L2k+IG9iamVjdCBpcyBub3QgYSBnbG9iYWwgdmFyaWFibGUgYnV0IGlzCgkgKiBhbGlhc2VkIHRvIDxpPmpRdWVyeS5mbi5EYXRhVGFibGU8L2k+IGFuZCA8aT5qUXVlcnkuZm4uZGF0YVRhYmxlPC9pPiB0aHJvdWdoIHdoaWNoIAoJICogaXQgbWF5IGJlICBhY2Nlc3NlZC4KCSAqCgkgKiAgQGNsYXNzCgkgKiAgQHBhcmFtIHtvYmplY3R9IFtvSW5pdD17fV0gQ29uZmlndXJhdGlvbiBvYmplY3QgZm9yIERhdGFUYWJsZXMuIE9wdGlvbnMKCSAqICAgIGFyZSBkZWZpbmVkIGJ5IHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9CgkgKiAgQHJlcXVpcmVzIGpRdWVyeSAxLjMrCgkgKiAKCSAqICBAZXhhbXBsZQoJICogICAgLy8gQmFzaWMgaW5pdGlhbGlzYXRpb24KCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbiB7CgkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkgKiAgICB9ICk7CgkgKiAgCgkgKiAgQGV4YW1wbGUKCSAqICAgIC8vIEluaXRpYWxpc2F0aW9uIHdpdGggY29uZmlndXJhdGlvbiBvcHRpb25zIC0gaW4gdGhpcyBjYXNlLCBkaXNhYmxlCgkgKiAgICAvLyBwYWdpbmF0aW9uIGFuZCBzb3J0aW5nLgoJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uIHsKCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCSAqICAgICAgICAiYlBhZ2luYXRlIjogZmFsc2UsCgkgKiAgICAgICAgImJTb3J0IjogZmFsc2UgCgkgKiAgICAgIH0gKTsKCSAqICAgIH0gKTsKCSAqLwoJdmFyIERhdGFUYWJsZSA9IGZ1bmN0aW9uKCBvSW5pdCApCgl7CgkJCgkJCgkJLyoqCgkJICogQWRkIGEgY29sdW1uIHRvIHRoZSBsaXN0IHVzZWQgZm9yIHRoZSB0YWJsZSB3aXRoIGRlZmF1bHQgdmFsdWVzCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtub2RlfSBuVGggVGhlIHRoIGVsZW1lbnQgZm9yIHRoaXMgY29sdW1uCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkFkZENvbHVtbiggb1NldHRpbmdzLCBuVGggKQoJCXsKCQkJdmFyIG9EZWZhdWx0cyA9IERhdGFUYWJsZS5kZWZhdWx0cy5jb2x1bW5zOwoJCQl2YXIgaUNvbCA9IG9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoOwoJCQl2YXIgb0NvbCA9ICQuZXh0ZW5kKCB7fSwgRGF0YVRhYmxlLm1vZGVscy5vQ29sdW1uLCBvRGVmYXVsdHMsIHsKCQkJCSJzU29ydGluZ0NsYXNzIjogb1NldHRpbmdzLm9DbGFzc2VzLnNTb3J0YWJsZSwKCQkJCSJzU29ydGluZ0NsYXNzSlVJIjogb1NldHRpbmdzLm9DbGFzc2VzLnNTb3J0SlVJLAoJCQkJIm5UaCI6IG5UaCA/IG5UaCA6IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RoJyksCgkJCQkic1RpdGxlIjogICAgb0RlZmF1bHRzLnNUaXRsZSAgICA/IG9EZWZhdWx0cy5zVGl0bGUgICAgOiBuVGggPyBuVGguaW5uZXJIVE1MIDogJycsCgkJCQkiYURhdGFTb3J0Ijogb0RlZmF1bHRzLmFEYXRhU29ydCA/IG9EZWZhdWx0cy5hRGF0YVNvcnQgOiBbaUNvbF0sCgkJCQkibURhdGFQcm9wIjogb0RlZmF1bHRzLm1EYXRhUHJvcCA/IG9EZWZhdWx0cy5vRGVmYXVsdHMgOiBpQ29sCgkJCX0gKTsKCQkJb1NldHRpbmdzLmFvQ29sdW1ucy5wdXNoKCBvQ29sICk7CgkJCQoJCQkvKiBBZGQgYSBjb2x1bW4gc3BlY2lmaWMgZmlsdGVyICovCgkJCWlmICggb1NldHRpbmdzLmFvUHJlU2VhcmNoQ29sc1sgaUNvbCBdID09PSB1bmRlZmluZWQgfHwgb1NldHRpbmdzLmFvUHJlU2VhcmNoQ29sc1sgaUNvbCBdID09PSBudWxsICkKCQkJewoJCQkJb1NldHRpbmdzLmFvUHJlU2VhcmNoQ29sc1sgaUNvbCBdID0gJC5leHRlbmQoIHt9LCBEYXRhVGFibGUubW9kZWxzLm9TZWFyY2ggKTsKCQkJfQoJCQllbHNlCgkJCXsKCQkJCXZhciBvUHJlID0gb1NldHRpbmdzLmFvUHJlU2VhcmNoQ29sc1sgaUNvbCBdOwoJCQkJCgkJCQkvKiBEb24ndCByZXF1aXJlIHRoYXQgdGhlIHVzZXIgbXVzdCBzcGVjaWZ5IGJSZWdleCwgYlNtYXJ0IG9yIGJDYXNlSW5zZW5zaXRpdmUgKi8KCQkJCWlmICggb1ByZS5iUmVnZXggPT09IHVuZGVmaW5lZCApCgkJCQl7CgkJCQkJb1ByZS5iUmVnZXggPSB0cnVlOwoJCQkJfQoJCQkJCgkJCQlpZiAoIG9QcmUuYlNtYXJ0ID09PSB1bmRlZmluZWQgKQoJCQkJewoJCQkJCW9QcmUuYlNtYXJ0ID0gdHJ1ZTsKCQkJCX0KCQkJCQoJCQkJaWYgKCBvUHJlLmJDYXNlSW5zZW5zaXRpdmUgPT09IHVuZGVmaW5lZCApCgkJCQl7CgkJCQkJb1ByZS5iQ2FzZUluc2Vuc2l0aXZlID0gdHJ1ZTsKCQkJCX0KCQkJfQoJCQkKCQkJLyogVXNlIHRoZSBjb2x1bW4gb3B0aW9ucyBmdW5jdGlvbiB0byBpbml0aWFsaXNlIGNsYXNzZXMgZXRjICovCgkJCV9mbkNvbHVtbk9wdGlvbnMoIG9TZXR0aW5ncywgaUNvbCwgbnVsbCApOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBBcHBseSBvcHRpb25zIGZvciBhIGNvbHVtbgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7aW50fSBpQ29sIGNvbHVtbiBpbmRleCB0byBjb25zaWRlcgoJCSAqICBAcGFyYW0ge29iamVjdH0gb09wdGlvbnMgb2JqZWN0IHdpdGggc1R5cGUsIGJWaXNpYmxlIGFuZCBiU2VhcmNoYWJsZQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5Db2x1bW5PcHRpb25zKCBvU2V0dGluZ3MsIGlDb2wsIG9PcHRpb25zICkKCQl7CgkJCXZhciBvQ29sID0gb1NldHRpbmdzLmFvQ29sdW1uc1sgaUNvbCBdOwoJCQkKCQkJLyogVXNlciBzcGVjaWZpZWQgY29sdW1uIG9wdGlvbnMgKi8KCQkJaWYgKCBvT3B0aW9ucyAhPT0gdW5kZWZpbmVkICYmIG9PcHRpb25zICE9PSBudWxsICkKCQkJewoJCQkJaWYgKCBvT3B0aW9ucy5zVHlwZSAhPT0gdW5kZWZpbmVkICkKCQkJCXsKCQkJCQlvQ29sLnNUeXBlID0gb09wdGlvbnMuc1R5cGU7CgkJCQkJb0NvbC5fYkF1dG9UeXBlID0gZmFsc2U7CgkJCQl9CgkJCQkKCQkJCSQuZXh0ZW5kKCBvQ29sLCBvT3B0aW9ucyApOwoJCQkJX2ZuTWFwKCBvQ29sLCBvT3B0aW9ucywgInNXaWR0aCIsICJzV2lkdGhPcmlnIiApOwoJCQoJCQkJLyogaURhdGFTb3J0IHRvIGJlIGFwcGxpZWQgKGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5KSwgYnV0IGFEYXRhU29ydCB3aWxsIHRha2UKCQkJCSAqIHByaW9yaXR5IGlmIGRlZmluZWQKCQkJCSAqLwoJCQkJaWYgKCBvT3B0aW9ucy5pRGF0YVNvcnQgIT09IHVuZGVmaW5lZCApCgkJCQl7CgkJCQkJb0NvbC5hRGF0YVNvcnQgPSBbIG9PcHRpb25zLmlEYXRhU29ydCBdOwoJCQkJfQoJCQkJX2ZuTWFwKCBvQ29sLCBvT3B0aW9ucywgImFEYXRhU29ydCIgKTsKCQkJfQoJCQoJCQkvKiBDYWNoZSB0aGUgZGF0YSBnZXQgYW5kIHNldCBmdW5jdGlvbnMgZm9yIHNwZWVkICovCgkJCW9Db2wuZm5HZXREYXRhID0gX2ZuR2V0T2JqZWN0RGF0YUZuKCBvQ29sLm1EYXRhUHJvcCApOwoJCQlvQ29sLmZuU2V0RGF0YSA9IF9mblNldE9iamVjdERhdGFGbiggb0NvbC5tRGF0YVByb3AgKTsKCQkJCgkJCS8qIEZlYXR1cmUgc29ydGluZyBvdmVycmlkZXMgY29sdW1uIHNwZWNpZmljIHdoZW4gb2ZmICovCgkJCWlmICggIW9TZXR0aW5ncy5vRmVhdHVyZXMuYlNvcnQgKQoJCQl7CgkJCQlvQ29sLmJTb3J0YWJsZSA9IGZhbHNlOwoJCQl9CgkJCQoJCQkvKiBDaGVjayB0aGF0IHRoZSBjbGFzcyBhc3NpZ25tZW50IGlzIGNvcnJlY3QgZm9yIHNvcnRpbmcgKi8KCQkJaWYgKCAhb0NvbC5iU29ydGFibGUgfHwKCQkJCSAoJC5pbkFycmF5KCdhc2MnLCBvQ29sLmFzU29ydGluZykgPT0gLTEgJiYgJC5pbkFycmF5KCdkZXNjJywgb0NvbC5hc1NvcnRpbmcpID09IC0xKSApCgkJCXsKCQkJCW9Db2wuc1NvcnRpbmdDbGFzcyA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydGFibGVOb25lOwoJCQkJb0NvbC5zU29ydGluZ0NsYXNzSlVJID0gIiI7CgkJCX0KCQkJZWxzZSBpZiAoIG9Db2wuYlNvcnRhYmxlIHx8CgkJCSAgICAgICAgICAoJC5pbkFycmF5KCdhc2MnLCBvQ29sLmFzU29ydGluZykgPT0gLTEgJiYgJC5pbkFycmF5KCdkZXNjJywgb0NvbC5hc1NvcnRpbmcpID09IC0xKSApCgkJCXsKCQkJICBvQ29sLnNTb3J0aW5nQ2xhc3MgPSBvU2V0dGluZ3Mub0NsYXNzZXMuc1NvcnRhYmxlOwoJCQkgIG9Db2wuc1NvcnRpbmdDbGFzc0pVSSA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydEpVSTsKCQkJfQoJCQllbHNlIGlmICggJC5pbkFycmF5KCdhc2MnLCBvQ29sLmFzU29ydGluZykgIT0gLTEgJiYgJC5pbkFycmF5KCdkZXNjJywgb0NvbC5hc1NvcnRpbmcpID09IC0xICkKCQkJewoJCQkJb0NvbC5zU29ydGluZ0NsYXNzID0gb1NldHRpbmdzLm9DbGFzc2VzLnNTb3J0YWJsZUFzYzsKCQkJCW9Db2wuc1NvcnRpbmdDbGFzc0pVSSA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydEpVSUFzY0FsbG93ZWQ7CgkJCX0KCQkJZWxzZSBpZiAoICQuaW5BcnJheSgnYXNjJywgb0NvbC5hc1NvcnRpbmcpID09IC0xICYmICQuaW5BcnJheSgnZGVzYycsIG9Db2wuYXNTb3J0aW5nKSAhPSAtMSApCgkJCXsKCQkJCW9Db2wuc1NvcnRpbmdDbGFzcyA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydGFibGVEZXNjOwoJCQkJb0NvbC5zU29ydGluZ0NsYXNzSlVJID0gb1NldHRpbmdzLm9DbGFzc2VzLnNTb3J0SlVJRGVzY0FsbG93ZWQ7CgkJCX0KCQl9CgkJCgkJCgkJLyoqCgkJICogQWRqdXN0IHRoZSB0YWJsZSBjb2x1bW4gd2lkdGhzIGZvciBuZXcgZGF0YS4gTm90ZTogeW91IHdvdWxkIHByb2JhYmx5IHdhbnQgdG8gCgkJICogZG8gYSByZWRyYXcgYWZ0ZXIgY2FsbGluZyB0aGlzIGZ1bmN0aW9uIQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkFkanVzdENvbHVtblNpemluZyAoIG9TZXR0aW5ncyApCgkJewoJCQkvKiBOb3QgaW50ZXJlc3RlZCBpbiBkb2luZyBjb2x1bW4gd2lkdGggY2FsY3VsYXRpb24gaWYgYXV0b3dpZHRoIGlzIGRpc2FibGVkICovCgkJCWlmICggb1NldHRpbmdzLm9GZWF0dXJlcy5iQXV0b1dpZHRoID09PSBmYWxzZSApCgkJCXsKCQkJCXJldHVybiBmYWxzZTsKCQkJfQoJCQkKCQkJX2ZuQ2FsY3VsYXRlQ29sdW1uV2lkdGhzKCBvU2V0dGluZ3MgKTsKCQkJZm9yICggdmFyIGk9MCAsIGlMZW49b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLm5UaC5zdHlsZS53aWR0aCA9IG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc1dpZHRoOwoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIENvdmVydCB0aGUgaW5kZXggb2YgYSB2aXNpYmxlIGNvbHVtbiB0byB0aGUgaW5kZXggaW4gdGhlIGRhdGEgYXJyYXkgKHRha2UgYWNjb3VudAoJCSAqIG9mIGhpZGRlbiBjb2x1bW5zKQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7aW50fSBpTWF0Y2ggVmlzaWJsZSBjb2x1bW4gaW5kZXggdG8gbG9va3VwCgkJICogIEByZXR1cm5zIHtpbnR9IGkgdGhlIGRhdGEgaW5kZXgKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuVmlzaWJsZVRvQ29sdW1uSW5kZXgoIG9TZXR0aW5ncywgaU1hdGNoICkKCQl7CgkJCXZhciBpQ29sdW1uID0gLTE7CgkJCQoJCQlmb3IgKCB2YXIgaT0wIDsgaTxvU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGkrKyApCgkJCXsKCQkJCWlmICggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5iVmlzaWJsZSA9PT0gdHJ1ZSApCgkJCQl7CgkJCQkJaUNvbHVtbisrOwoJCQkJfQoJCQkJCgkJCQlpZiAoIGlDb2x1bW4gPT0gaU1hdGNoICkKCQkJCXsKCQkJCQlyZXR1cm4gaTsKCQkJCX0KCQkJfQoJCQkKCQkJcmV0dXJuIG51bGw7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIENvdmVydCB0aGUgaW5kZXggb2YgYW4gaW5kZXggaW4gdGhlIGRhdGEgYXJyYXkgYW5kIGNvbnZlcnQgaXQgdG8gdGhlIHZpc2libGUKCQkgKiAgIGNvbHVtbiBpbmRleCAodGFrZSBhY2NvdW50IG9mIGhpZGRlbiBjb2x1bW5zKQoJCSAqICBAcGFyYW0ge2ludH0gaU1hdGNoIENvbHVtbiBpbmRleCB0byBsb29rdXAKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcmV0dXJucyB7aW50fSBpIHRoZSBkYXRhIGluZGV4CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkNvbHVtbkluZGV4VG9WaXNpYmxlKCBvU2V0dGluZ3MsIGlNYXRjaCApCgkJewoJCQl2YXIgaVZpc2libGUgPSAtMTsKCQkJZm9yICggdmFyIGk9MCA7IGk8b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpKysgKQoJCQl7CgkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uYlZpc2libGUgPT09IHRydWUgKQoJCQkJewoJCQkJCWlWaXNpYmxlKys7CgkJCQl9CgkJCQkKCQkJCWlmICggaSA9PSBpTWF0Y2ggKQoJCQkJewoJCQkJCXJldHVybiBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLmJWaXNpYmxlID09PSB0cnVlID8gaVZpc2libGUgOiBudWxsOwoJCQkJfQoJCQl9CgkJCQoJCQlyZXR1cm4gbnVsbDsKCQl9CgkJCgkJCgkJLyoqCgkJICogR2V0IHRoZSBudW1iZXIgb2YgdmlzaWJsZSBjb2x1bW5zCgkJICogIEByZXR1cm5zIHtpbnR9IGkgdGhlIG51bWJlciBvZiB2aXNpYmxlIGNvbHVtbnMKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblZpc2JsZUNvbHVtbnMoIG9TICkKCQl7CgkJCXZhciBpVmlzID0gMDsKCQkJZm9yICggdmFyIGk9MCA7IGk8b1MuYW9Db2x1bW5zLmxlbmd0aCA7IGkrKyApCgkJCXsKCQkJCWlmICggb1MuYW9Db2x1bW5zW2ldLmJWaXNpYmxlID09PSB0cnVlICkKCQkJCXsKCQkJCQlpVmlzKys7CgkJCQl9CgkJCX0KCQkJcmV0dXJuIGlWaXM7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEdldCB0aGUgc29ydCB0eXBlIGJhc2VkIG9uIGFuIGlucHV0IHN0cmluZwoJCSAqICBAcGFyYW0ge3N0cmluZ30gc0RhdGEgZGF0YSB3ZSB3aXNoIHRvIGtub3cgdGhlIHR5cGUgb2YKCQkgKiAgQHJldHVybnMge3N0cmluZ30gdHlwZSAoZGVmYXVsdHMgdG8gJ3N0cmluZycgaWYgbm8gdHlwZSBjYW4gYmUgZGV0ZWN0ZWQpCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkRldGVjdFR5cGUoIHNEYXRhICkKCQl7CgkJCXZhciBhVHlwZXMgPSBEYXRhVGFibGUuZXh0LmFUeXBlczsKCQkJdmFyIGlMZW4gPSBhVHlwZXMubGVuZ3RoOwoJCQkKCQkJZm9yICggdmFyIGk9MCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCXZhciBzVHlwZSA9IGFUeXBlc1tpXSggc0RhdGEgKTsKCQkJCWlmICggc1R5cGUgIT09IG51bGwgKQoJCQkJewoJCQkJCXJldHVybiBzVHlwZTsKCQkJCX0KCQkJfQoJCQkKCQkJcmV0dXJuICdzdHJpbmcnOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBGaWd1cmUgb3V0IGhvdyB0byByZW9yZGVyIGEgZGlzcGxheSBsaXN0CgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHJldHVybnMgYXJyYXkge2ludH0gYWlSZXR1cm4gaW5kZXggbGlzdCBmb3IgcmVvcmRlcmluZwoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5SZU9yZGVySW5kZXggKCBvU2V0dGluZ3MsIHNDb2x1bW5zICkKCQl7CgkJCXZhciBhQ29sdW1ucyA9IHNDb2x1bW5zLnNwbGl0KCcsJyk7CgkJCXZhciBhaVJldHVybiA9IFtdOwoJCQkKCQkJZm9yICggdmFyIGk9MCwgaUxlbj1vU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWZvciAoIHZhciBqPTAgOyBqPGlMZW4gOyBqKysgKQoJCQkJewoJCQkJCWlmICggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zTmFtZSA9PSBhQ29sdW1uc1tqXSApCgkJCQkJewoJCQkJCQlhaVJldHVybi5wdXNoKCBqICk7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCQkJCX0KCQkJfQoJCQkKCQkJcmV0dXJuIGFpUmV0dXJuOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBHZXQgdGhlIGNvbHVtbiBvcmRlcmluZyB0aGF0IERhdGFUYWJsZXMgZXhwZWN0cwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEByZXR1cm5zIHtzdHJpbmd9IGNvbW1hIHNlcGFyYXRlZCBsaXN0IG9mIG5hbWVzCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkNvbHVtbk9yZGVyaW5nICggb1NldHRpbmdzICkKCQl7CgkJCXZhciBzTmFtZXMgPSAnJzsKCQkJZm9yICggdmFyIGk9MCwgaUxlbj1vU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCXNOYW1lcyArPSBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNOYW1lKycsJzsKCQkJfQoJCQlpZiAoIHNOYW1lcy5sZW5ndGggPT0gaUxlbiApCgkJCXsKCQkJCXJldHVybiAiIjsKCQkJfQoJCQlyZXR1cm4gc05hbWVzLnNsaWNlKDAsIC0xKTsKCQl9CgkJCgkJCgkJLyoqCgkJICogVGFrZSB0aGUgY29sdW1uIGRlZmluaXRpb25zIGFuZCBzdGF0aWMgY29sdW1ucyBhcnJheXMgYW5kIGNhbGN1bGF0ZSBob3cKCQkgKiB0aGV5IHJlbGF0ZSB0byBjb2x1bW4gaW5kZXhlcy4gVGhlIGNhbGxiYWNrIGZ1bmN0aW9uIHdpbGwgdGhlbiBhcHBseSB0aGUKCQkgKiBkZWZpbml0aW9uIGZvdW5kIGZvciBhIGNvbHVtbiB0byBhIHN1aXRhYmxlIGNvbmZpZ3VyYXRpb24gb2JqZWN0LgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7YXJyYXl9IGFvQ29sRGVmcyBUaGUgYW9Db2x1bW5EZWZzIGFycmF5IHRoYXQgaXMgdG8gYmUgYXBwbGllZAoJCSAqICBAcGFyYW0ge2FycmF5fSBhb0NvbHMgVGhlIGFvQ29sdW1ucyBhcnJheSB0aGF0IGRlZmluZXMgY29sdW1ucyBpbmRpdmlkdWFsbHkKCQkgKiAgQHBhcmFtIHtmdW5jdGlvbn0gZm4gQ2FsbGJhY2sgZnVuY3Rpb24gLSB0YWtlcyB0d28gcGFyYW1ldGVycywgdGhlIGNhbGN1bGF0ZWQKCQkgKiAgICBjb2x1bW4gaW5kZXggYW5kIHRoZSBkZWZpbml0aW9uIGZvciB0aGF0IGNvbHVtbi4KCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuQXBwbHlDb2x1bW5EZWZzKCBvU2V0dGluZ3MsIGFvQ29sRGVmcywgYW9Db2xzLCBmbiApCgkJewoJCQl2YXIgaSwgaUxlbiwgaiwgakxlbiwgaywga0xlbjsKCQkKCQkJLy8gQ29sdW1uIGRlZmluaXRpb25zIHdpdGggYVRhcmdldHMKCQkJaWYgKCBhb0NvbERlZnMgKQoJCQl7CgkJCQkvKiBMb29wIG92ZXIgdGhlIGRlZmluaXRpb25zIGFycmF5IC0gbG9vcCBpbiByZXZlcnNlIHNvIGZpcnN0IGluc3RhbmNlIGhhcyBwcmlvcml0eSAqLwoJCQkJZm9yICggaT1hb0NvbERlZnMubGVuZ3RoLTEgOyBpPj0wIDsgaS0tICkKCQkJCXsKCQkJCQkvKiBFYWNoIGRlZmluaXRpb24gY2FuIHRhcmdldCBtdWx0aXBsZSBjb2x1bW5zLCBhcyBpdCBpcyBhbiBhcnJheSAqLwoJCQkJCXZhciBhVGFyZ2V0cyA9IGFvQ29sRGVmc1tpXS5hVGFyZ2V0czsKCQkJCQlpZiAoICEkLmlzQXJyYXkoIGFUYXJnZXRzICkgKQoJCQkJCXsKCQkJCQkJX2ZuTG9nKCBvU2V0dGluZ3MsIDEsICdhVGFyZ2V0cyBtdXN0IGJlIGFuIGFycmF5IG9mIHRhcmdldHMsIG5vdCBhICcrKHR5cGVvZiBhVGFyZ2V0cykgKTsKCQkJCQl9CgkJCgkJCQkJZm9yICggaj0wLCBqTGVuPWFUYXJnZXRzLmxlbmd0aCA7IGo8akxlbiA7IGorKyApCgkJCQkJewoJCQkJCQlpZiAoIHR5cGVvZiBhVGFyZ2V0c1tqXSA9PT0gJ251bWJlcicgJiYgYVRhcmdldHNbal0gPj0gMCApCgkJCQkJCXsKCQkJCQkJCS8qIEFkZCBjb2x1bW5zIHRoYXQgd2UgZG9uJ3QgeWV0IGtub3cgYWJvdXQgKi8KCQkJCQkJCXdoaWxlKCBvU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA8PSBhVGFyZ2V0c1tqXSApCgkJCQkJCQl7CgkJCQkJCQkJX2ZuQWRkQ29sdW1uKCBvU2V0dGluZ3MgKTsKCQkJCQkJCX0KCQkKCQkJCQkJCS8qIEludGVnZXIsIGJhc2ljIGluZGV4ICovCgkJCQkJCQlmbiggYVRhcmdldHNbal0sIGFvQ29sRGVmc1tpXSApOwoJCQkJCQl9CgkJCQkJCWVsc2UgaWYgKCB0eXBlb2YgYVRhcmdldHNbal0gPT09ICdudW1iZXInICYmIGFUYXJnZXRzW2pdIDwgMCApCgkJCQkJCXsKCQkJCQkJCS8qIE5lZ2F0aXZlIGludGVnZXIsIHJpZ2h0IHRvIGxlZnQgY29sdW1uIGNvdW50aW5nICovCgkJCQkJCQlmbiggb1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGgrYVRhcmdldHNbal0sIGFvQ29sRGVmc1tpXSApOwoJCQkJCQl9CgkJCQkJCWVsc2UgaWYgKCB0eXBlb2YgYVRhcmdldHNbal0gPT09ICdzdHJpbmcnICkKCQkJCQkJewoJCQkJCQkJLyogQ2xhc3MgbmFtZSBtYXRjaGluZyBvbiBUSCBlbGVtZW50ICovCgkJCQkJCQlmb3IgKCBrPTAsIGtMZW49b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBrPGtMZW4gOyBrKysgKQoJCQkJCQkJewoJCQkJCQkJCWlmICggYVRhcmdldHNbal0gPT0gIl9hbGwiIHx8CgkJCQkJCQkJICAgICAkKG9TZXR0aW5ncy5hb0NvbHVtbnNba10ublRoKS5oYXNDbGFzcyggYVRhcmdldHNbal0gKSApCgkJCQkJCQkJewoJCQkJCQkJCQlmbiggaywgYW9Db2xEZWZzW2ldICk7CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJCgkJCS8vIFN0YXRpY2FsbHkgZGVmaW5lZCBjb2x1bW5zIGFycmF5CgkJCWlmICggYW9Db2xzICkKCQkJewoJCQkJZm9yICggaT0wLCBpTGVuPWFvQ29scy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCWZuKCBpLCBhb0NvbHNbaV0gKTsKCQkJCX0KCQkJfQoJCX0KCQkKCQkKCQkKCQkvKioKCQkgKiBBZGQgYSBkYXRhIGFycmF5IHRvIHRoZSB0YWJsZSwgY3JlYXRpbmcgRE9NIG5vZGUgZXRjLiBUaGlzIGlzIHRoZSBwYXJhbGxlbCB0byAKCQkgKiBfZm5HYXRoZXJEYXRhLCBidXQgZm9yIGFkZGluZyByb3dzIGZyb20gYSBKYXZhc2NyaXB0IHNvdXJjZSwgcmF0aGVyIHRoYW4gYQoJCSAqIERPTSBzb3VyY2UuCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHthcnJheX0gYURhdGEgZGF0YSBhcnJheSB0byBiZSBhZGRlZAoJCSAqICBAcmV0dXJucyB7aW50fSA+PTAgaWYgc3VjY2Vzc2Z1bCAoaW5kZXggb2YgbmV3IGFvRGF0YSBlbnRyeSksIC0xIGlmIGZhaWxlZAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5BZGREYXRhICggb1NldHRpbmdzLCBhRGF0YVN1cHBsaWVkICkKCQl7CgkJCXZhciBvQ29sOwoJCQkKCQkJLyogVGFrZSBhbiBpbmRlcGVuZGVudCBjb3B5IG9mIHRoZSBkYXRhIHNvdXJjZSBzbyB3ZSBjYW4gYmFzaCBpdCBhYm91dCBhcyB3ZSB3aXNoICovCgkJCXZhciBhRGF0YUluID0gKCQuaXNBcnJheShhRGF0YVN1cHBsaWVkKSkgPwoJCQkJYURhdGFTdXBwbGllZC5zbGljZSgpIDoKCQkJCSQuZXh0ZW5kKCB0cnVlLCB7fSwgYURhdGFTdXBwbGllZCApOwoJCQkKCQkJLyogQ3JlYXRlIHRoZSBvYmplY3QgZm9yIHN0b3JpbmcgaW5mb3JtYXRpb24gYWJvdXQgdGhpcyBuZXcgcm93ICovCgkJCXZhciBpUm93ID0gb1NldHRpbmdzLmFvRGF0YS5sZW5ndGg7CgkJCXZhciBvRGF0YSA9ICQuZXh0ZW5kKCB0cnVlLCB7fSwgRGF0YVRhYmxlLm1vZGVscy5vUm93ICk7CgkJCW9EYXRhLl9hRGF0YSA9IGFEYXRhSW47CgkJCW9TZXR0aW5ncy5hb0RhdGEucHVzaCggb0RhdGEgKTsKCQkKCQkJLyogQ3JlYXRlIHRoZSBjZWxscyAqLwoJCQl2YXIgblRkLCBzVGhpc1R5cGU7CgkJCWZvciAoIHZhciBpPTAsIGlMZW49b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlvQ29sID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpXTsKCQkKCQkJCS8qIFVzZSByZW5kZXJlZCBkYXRhIGZvciBmaWx0ZXJpbmcvc29ydGluZyAqLwoJCQkJaWYgKCB0eXBlb2Ygb0NvbC5mblJlbmRlciA9PT0gJ2Z1bmN0aW9uJyAmJiBvQ29sLmJVc2VSZW5kZXJlZCAmJiBvQ29sLm1EYXRhUHJvcCAhPT0gbnVsbCApCgkJCQl7CgkJCQkJX2ZuU2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaSwgX2ZuUmVuZGVyKG9TZXR0aW5ncywgaVJvdywgaSkgKTsKCQkJCX0KCQkJCWVsc2UKCQkJCXsKCQkJCQlfZm5TZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpLCBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpICkgKTsKCQkJCX0KCQkJCQoJCQkJLyogU2VlIGlmIHdlIHNob3VsZCBhdXRvLWRldGVjdCB0aGUgY29sdW1uIHR5cGUgKi8KCQkJCWlmICggb0NvbC5fYkF1dG9UeXBlICYmIG9Db2wuc1R5cGUgIT0gJ3N0cmluZycgKQoJCQkJewoJCQkJCS8qIEF0dGVtcHQgdG8gYXV0byBkZXRlY3QgdGhlIHR5cGUgLSBzYW1lIGFzIF9mbkdhdGhlckRhdGEoKSAqLwoJCQkJCXZhciBzVmFyVHlwZSA9IF9mbkdldENlbGxEYXRhKCBvU2V0dGluZ3MsIGlSb3csIGksICd0eXBlJyApOwoJCQkJCWlmICggc1ZhclR5cGUgIT09IG51bGwgJiYgc1ZhclR5cGUgIT09ICcnICkKCQkJCQl7CgkJCQkJCXNUaGlzVHlwZSA9IF9mbkRldGVjdFR5cGUoIHNWYXJUeXBlICk7CgkJCQkJCWlmICggb0NvbC5zVHlwZSA9PT0gbnVsbCApCgkJCQkJCXsKCQkJCQkJCW9Db2wuc1R5cGUgPSBzVGhpc1R5cGU7CgkJCQkJCX0KCQkJCQkJZWxzZSBpZiAoIG9Db2wuc1R5cGUgIT0gc1RoaXNUeXBlICYmIG9Db2wuc1R5cGUgIT0gImh0bWwiICkKCQkJCQkJewoJCQkJCQkJLyogU3RyaW5nIGlzIGFsd2F5cyB0aGUgJ2ZhbGxiYWNrJyBvcHRpb24gKi8KCQkJCQkJCW9Db2wuc1R5cGUgPSAnc3RyaW5nJzsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJfQoJCQkKCQkJLyogQWRkIHRvIHRoZSBkaXNwbGF5IGFycmF5ICovCgkJCW9TZXR0aW5ncy5haURpc3BsYXlNYXN0ZXIucHVzaCggaVJvdyApOwoJCQoJCQkvKiBDcmVhdGUgdGhlIERPTSBpbWZvcm1hdGlvbiAqLwoJCQlpZiAoICFvU2V0dGluZ3Mub0ZlYXR1cmVzLmJEZWZlclJlbmRlciApCgkJCXsKCQkJCV9mbkNyZWF0ZVRyKCBvU2V0dGluZ3MsIGlSb3cgKTsKCQkJfQoJCQoJCQlyZXR1cm4gaVJvdzsKCQl9CgkJCgkJCgkJLyoqCgkJICogUmVhZCBpbiB0aGUgZGF0YSBmcm9tIHRoZSB0YXJnZXQgdGFibGUgZnJvbSB0aGUgRE9NCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuR2F0aGVyRGF0YSggb1NldHRpbmdzICkKCQl7CgkJCXZhciBpTG9vcCwgaSwgaUxlbiwgaiwgakxlbiwgaklubmVyLAoJCQkgCW5UZHMsIG5UcnMsIG5UZCwgYUxvY2FsRGF0YSwgaVRoaXNJbmRleCwKCQkJCWlSb3csIGlSb3dzLCBpQ29sdW1uLCBpQ29sdW1ucywgc05vZGVOYW1lLAoJCQkJb0NvbCwgb0RhdGE7CgkJCQoJCQkvKgoJCQkgKiBQcm9jZXNzIGJ5IHJvdyBmaXJzdAoJCQkgKiBBZGQgdGhlIGRhdGEgb2JqZWN0IGZvciB0aGUgd2hvbGUgdGFibGUgLSBzdG9yaW5nIHRoZSB0ciBub2RlLiBOb3RlIC0gbm8gcG9pbnQgaW4gZ2V0dGluZwoJCQkgKiBET00gYmFzZWQgZGF0YSBpZiB3ZSBhcmUgZ29pbmcgdG8gZ28gYW5kIHJlcGxhY2UgaXQgd2l0aCBBamF4IHNvdXJjZSBkYXRhLgoJCQkgKi8KCQkJaWYgKCBvU2V0dGluZ3MuYkRlZmVyTG9hZGluZyB8fCBvU2V0dGluZ3Muc0FqYXhTb3VyY2UgPT09IG51bGwgKQoJCQl7CgkJCQluVHJzID0gb1NldHRpbmdzLm5UQm9keS5jaGlsZE5vZGVzOwoJCQkJZm9yICggaT0wLCBpTGVuPW5UcnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQlpZiAoIG5UcnNbaV0ubm9kZU5hbWUudG9VcHBlckNhc2UoKSA9PSAiVFIiICkKCQkJCQl7CgkJCQkJCWlUaGlzSW5kZXggPSBvU2V0dGluZ3MuYW9EYXRhLmxlbmd0aDsKCQkJCQkJblRyc1tpXS5fRFRfUm93SW5kZXggPSBpVGhpc0luZGV4OwoJCQkJCQlvU2V0dGluZ3MuYW9EYXRhLnB1c2goICQuZXh0ZW5kKCB0cnVlLCB7fSwgRGF0YVRhYmxlLm1vZGVscy5vUm93LCB7CgkJCQkJCQkiblRyIjogblRyc1tpXQoJCQkJCQl9ICkgKTsKCQkJCQkJCgkJCQkJCW9TZXR0aW5ncy5haURpc3BsYXlNYXN0ZXIucHVzaCggaVRoaXNJbmRleCApOwoJCQkJCQluVGRzID0gblRyc1tpXS5jaGlsZE5vZGVzOwoJCQkJCQlqSW5uZXIgPSAwOwoJCQkJCQkKCQkJCQkJZm9yICggaj0wLCBqTGVuPW5UZHMubGVuZ3RoIDsgajxqTGVuIDsgaisrICkKCQkJCQkJewoJCQkJCQkJc05vZGVOYW1lID0gblRkc1tqXS5ub2RlTmFtZS50b1VwcGVyQ2FzZSgpOwoJCQkJCQkJaWYgKCBzTm9kZU5hbWUgPT0gIlREIiB8fCBzTm9kZU5hbWUgPT0gIlRIIiApCgkJCQkJCQl7CgkJCQkJCQkJX2ZuU2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVRoaXNJbmRleCwgaklubmVyLCAkLnRyaW0oblRkc1tqXS5pbm5lckhUTUwpICk7CgkJCQkJCQkJaklubmVyKys7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCX0KCQkJCgkJCS8qIEdhdGhlciBpbiB0aGUgVEQgZWxlbWVudHMgb2YgdGhlIFRhYmxlIC0gbm90ZSB0aGF0IHRoaXMgaXMgYmFzaWNhbGx5IHRoZSBzYW1lIGFzCgkJCSAqIGZuR2V0VGROb2RlcywgYnV0IHRoYXQgZnVuY3Rpb24gdGFrZXMgYWNjb3VudCBvZiBoaWRkZW4gY29sdW1ucywgd2hpY2ggd2UgaGF2ZW4ndCB5ZXQKCQkJICogc2V0dXAhCgkJCSAqLwoJCQluVHJzID0gX2ZuR2V0VHJOb2Rlcyggb1NldHRpbmdzICk7CgkJCW5UZHMgPSBbXTsKCQkJZm9yICggaT0wLCBpTGVuPW5UcnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJZm9yICggaj0wLCBqTGVuPW5UcnNbaV0uY2hpbGROb2Rlcy5sZW5ndGggOyBqPGpMZW4gOyBqKysgKQoJCQkJewoJCQkJCW5UZCA9IG5UcnNbaV0uY2hpbGROb2Rlc1tqXTsKCQkJCQlzTm9kZU5hbWUgPSBuVGQubm9kZU5hbWUudG9VcHBlckNhc2UoKTsKCQkJCQlpZiAoIHNOb2RlTmFtZSA9PSAiVEQiIHx8IHNOb2RlTmFtZSA9PSAiVEgiICkKCQkJCQl7CgkJCQkJCW5UZHMucHVzaCggblRkICk7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCQoJCQkvKiBOb3cgcHJvY2VzcyBieSBjb2x1bW4gKi8KCQkJZm9yICggaUNvbHVtbj0wLCBpQ29sdW1ucz1vU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGlDb2x1bW48aUNvbHVtbnMgOyBpQ29sdW1uKysgKQoJCQl7CgkJCQlvQ29sID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpQ29sdW1uXTsKCQkKCQkJCS8qIEdldCB0aGUgdGl0bGUgb2YgdGhlIGNvbHVtbiAtIHVubGVzcyB0aGVyZSBpcyBhIHVzZXIgc2V0IG9uZSAqLwoJCQkJaWYgKCBvQ29sLnNUaXRsZSA9PT0gbnVsbCApCgkJCQl7CgkJCQkJb0NvbC5zVGl0bGUgPSBvQ29sLm5UaC5pbm5lckhUTUw7CgkJCQl9CgkJCQkKCQkJCXZhcgoJCQkJCWJBdXRvVHlwZSA9IG9Db2wuX2JBdXRvVHlwZSwKCQkJCQliUmVuZGVyID0gdHlwZW9mIG9Db2wuZm5SZW5kZXIgPT09ICdmdW5jdGlvbicsCgkJCQkJYkNsYXNzID0gb0NvbC5zQ2xhc3MgIT09IG51bGwsCgkJCQkJYlZpc2libGUgPSBvQ29sLmJWaXNpYmxlLAoJCQkJCW5DZWxsLCBzVGhpc1R5cGUsIHNSZW5kZXJlZCwgc1ZhbFR5cGU7CgkJCQkKCQkJCS8qIEEgc2luZ2xlIGxvb3AgdG8gcnVsZSB0aGVtIGFsbCAoYW5kIGJlIG1vcmUgZWZmaWNpZW50KSAqLwoJCQkJaWYgKCBiQXV0b1R5cGUgfHwgYlJlbmRlciB8fCBiQ2xhc3MgfHwgIWJWaXNpYmxlICkKCQkJCXsKCQkJCQlmb3IgKCBpUm93PTAsIGlSb3dzPW9TZXR0aW5ncy5hb0RhdGEubGVuZ3RoIDsgaVJvdzxpUm93cyA7IGlSb3crKyApCgkJCQkJewoJCQkJCQlvRGF0YSA9IG9TZXR0aW5ncy5hb0RhdGFbaVJvd107CgkJCQkJCW5DZWxsID0gblRkc1sgKGlSb3cqaUNvbHVtbnMpICsgaUNvbHVtbiBdOwoJCQkJCQkKCQkJCQkJLyogVHlwZSBkZXRlY3Rpb24gKi8KCQkJCQkJaWYgKCBiQXV0b1R5cGUgJiYgb0NvbC5zVHlwZSAhPSAnc3RyaW5nJyApCgkJCQkJCXsKCQkJCQkJCXNWYWxUeXBlID0gX2ZuR2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaUNvbHVtbiwgJ3R5cGUnICk7CgkJCQkJCQlpZiAoIHNWYWxUeXBlICE9PSAnJyApCgkJCQkJCQl7CgkJCQkJCQkJc1RoaXNUeXBlID0gX2ZuRGV0ZWN0VHlwZSggc1ZhbFR5cGUgKTsKCQkJCQkJCQlpZiAoIG9Db2wuc1R5cGUgPT09IG51bGwgKQoJCQkJCQkJCXsKCQkJCQkJCQkJb0NvbC5zVHlwZSA9IHNUaGlzVHlwZTsKCQkJCQkJCQl9CgkJCQkJCQkJZWxzZSBpZiAoIG9Db2wuc1R5cGUgIT0gc1RoaXNUeXBlICYmIAoJCQkJCQkJCSAgICAgICAgICBvQ29sLnNUeXBlICE9ICJodG1sIiApCgkJCQkJCQkJewoJCQkJCQkJCQkvKiBTdHJpbmcgaXMgYWx3YXlzIHRoZSAnZmFsbGJhY2snIG9wdGlvbiAqLwoJCQkJCQkJCQlvQ29sLnNUeXBlID0gJ3N0cmluZyc7CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQl9CgkJCgkJCQkJCWlmICggdHlwZW9mIG9Db2wubURhdGFQcm9wID09PSAnZnVuY3Rpb24nICkKCQkJCQkJewoJCQkJCQkJbkNlbGwuaW5uZXJIVE1MID0gX2ZuR2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaUNvbHVtbiwgJ2Rpc3BsYXknICk7CgkJCQkJCX0KCQkJCQkJCgkJCQkJCS8qIFJlbmRlcmluZyAqLwoJCQkJCQlpZiAoIGJSZW5kZXIgKQoJCQkJCQl7CgkJCQkJCQlzUmVuZGVyZWQgPSBfZm5SZW5kZXIoIG9TZXR0aW5ncywgaVJvdywgaUNvbHVtbiApOwoJCQkJCQkJbkNlbGwuaW5uZXJIVE1MID0gc1JlbmRlcmVkOwoJCQkJCQkJaWYgKCBvQ29sLmJVc2VSZW5kZXJlZCApCgkJCQkJCQl7CgkJCQkJCQkJLyogVXNlIHRoZSByZW5kZXJlZCBkYXRhIGZvciBmaWx0ZXJpbmcvc29ydGluZyAqLwoJCQkJCQkJCV9mblNldENlbGxEYXRhKCBvU2V0dGluZ3MsIGlSb3csIGlDb2x1bW4sIHNSZW5kZXJlZCApOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJCQoJCQkJCQkvKiBDbGFzc2VzICovCgkJCQkJCWlmICggYkNsYXNzICkKCQkJCQkJewoJCQkJCQkJbkNlbGwuY2xhc3NOYW1lICs9ICcgJytvQ29sLnNDbGFzczsKCQkJCQkJfQoJCQkJCQkKCQkJCQkJLyogQ29sdW1uIHZpc2FiaWxpdHkgKi8KCQkJCQkJaWYgKCAhYlZpc2libGUgKQoJCQkJCQl7CgkJCQkJCQlvRGF0YS5fYW5IaWRkZW5baUNvbHVtbl0gPSBuQ2VsbDsKCQkJCQkJCW5DZWxsLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoIG5DZWxsICk7CgkJCQkJCX0KCQkJCQkJZWxzZQoJCQkJCQl7CgkJCQkJCQlvRGF0YS5fYW5IaWRkZW5baUNvbHVtbl0gPSBudWxsOwoJCQkJCQl9CgkJCgkJCQkJCWlmICggb0NvbC5mbkNyZWF0ZWRDZWxsICkKCQkJCQkJewoJCQkJCQkJb0NvbC5mbkNyZWF0ZWRDZWxsLmNhbGwoIG9TZXR0aW5ncy5vSW5zdGFuY2UsCgkJCQkJCQkJbkNlbGwsIF9mbkdldENlbGxEYXRhKCBvU2V0dGluZ3MsIGlSb3csIGlDb2x1bW4sICdkaXNwbGF5JyApLCBvRGF0YS5fYURhdGEsIGlSb3csIGlDb2x1bW4KCQkJCQkJCSk7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCX0KCQkKCQkJLyogUm93IGNyZWF0ZWQgY2FsbGJhY2tzICovCgkJCWlmICggb1NldHRpbmdzLmFvUm93Q3JlYXRlZENhbGxiYWNrLmxlbmd0aCAhPT0gMCApCgkJCXsKCQkJCWZvciAoIGk9MCwgaUxlbj1vU2V0dGluZ3MuYW9EYXRhLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJb0RhdGEgPSBvU2V0dGluZ3MuYW9EYXRhW2ldOwoJCQkJCV9mbkNhbGxiYWNrRmlyZSggb1NldHRpbmdzLCAnYW9Sb3dDcmVhdGVkQ2FsbGJhY2snLCBudWxsLCBbb0RhdGEublRyLCBvRGF0YS5fYURhdGEsIGldICk7CgkJCQl9CgkJCX0KCQl9CgkJCgkJCgkJLyoqCgkJICogVGFrZSBhIFRSIGVsZW1lbnQgYW5kIGNvbnZlcnQgaXQgdG8gYW4gaW5kZXggaW4gYW9EYXRhCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtub2RlfSBuIHRoZSBUUiBlbGVtZW50IHRvIGZpbmQKCQkgKiAgQHJldHVybnMge2ludH0gaW5kZXggaWYgdGhlIG5vZGUgaXMgZm91bmQsIG51bGwgaWYgbm90CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbk5vZGVUb0RhdGFJbmRleCggb1NldHRpbmdzLCBuICkKCQl7CgkJCXJldHVybiAobi5fRFRfUm93SW5kZXghPT11bmRlZmluZWQpID8gbi5fRFRfUm93SW5kZXggOiBudWxsOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBUYWtlIGEgVEQgZWxlbWVudCBhbmQgY29udmVydCBpdCBpbnRvIGEgY29sdW1uIGRhdGEgaW5kZXggKG5vdCB0aGUgdmlzaWJsZSBpbmRleCkKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge2ludH0gaVJvdyBUaGUgcm93IG51bWJlciB0aGUgVEQvVEggY2FuIGJlIGZvdW5kIGluCgkJICogIEBwYXJhbSB7bm9kZX0gbiBUaGUgVEQvVEggZWxlbWVudCB0byBmaW5kCgkJICogIEByZXR1cm5zIHtpbnR9IGluZGV4IGlmIHRoZSBub2RlIGlzIGZvdW5kLCAtMSBpZiBub3QKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuTm9kZVRvQ29sdW1uSW5kZXgoIG9TZXR0aW5ncywgaVJvdywgbiApCgkJewoJCQl2YXIgYW5DZWxscyA9IF9mbkdldFRkTm9kZXMoIG9TZXR0aW5ncywgaVJvdyApOwoJCQoJCQlmb3IgKCB2YXIgaT0wLCBpTGVuPW9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJaWYgKCBhbkNlbGxzW2ldID09PSBuICkKCQkJCXsKCQkJCQlyZXR1cm4gaTsKCQkJCX0KCQkJfQoJCQlyZXR1cm4gLTE7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEdldCBhbiBhcnJheSBvZiBkYXRhIGZvciBhIGdpdmVuIHJvdyBmcm9tIHRoZSBpbnRlcm5hbCBkYXRhIGNhY2hlCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtpbnR9IGlSb3cgYW9EYXRhIHJvdyBpZAoJCSAqICBAcGFyYW0ge3N0cmluZ30gc1NwZWNpZmljIGRhdGEgZ2V0IHR5cGUgKCd0eXBlJyAnZmlsdGVyJyAnc29ydCcpCgkJICogIEByZXR1cm5zIHthcnJheX0gRGF0YSBhcnJheQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5HZXRSb3dEYXRhKCBvU2V0dGluZ3MsIGlSb3csIHNTcGVjaWZpYyApCgkJewoJCQl2YXIgb3V0ID0gW107CgkJCWZvciAoIHZhciBpPTAsIGlMZW49b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlvdXQucHVzaCggX2ZuR2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaSwgc1NwZWNpZmljICkgKTsKCQkJfQoJCQlyZXR1cm4gb3V0OwoJCX0KCQkKCQkKCQkvKioKCQkgKiBHZXQgdGhlIGRhdGEgZm9yIGEgZ2l2ZW4gY2VsbCBmcm9tIHRoZSBpbnRlcm5hbCBjYWNoZSwgdGFraW5nIGludG8gYWNjb3VudCBkYXRhIG1hcHBpbmcKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge2ludH0gaVJvdyBhb0RhdGEgcm93IGlkCgkJICogIEBwYXJhbSB7aW50fSBpQ29sIENvbHVtbiBpbmRleAoJCSAqICBAcGFyYW0ge3N0cmluZ30gc1NwZWNpZmljIGRhdGEgZ2V0IHR5cGUgKCdkaXNwbGF5JywgJ3R5cGUnICdmaWx0ZXInICdzb3J0JykKCQkgKiAgQHJldHVybnMgeyp9IENlbGwgZGF0YQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpQ29sLCBzU3BlY2lmaWMgKQoJCXsKCQkJdmFyIHNEYXRhOwoJCQl2YXIgb0NvbCA9IG9TZXR0aW5ncy5hb0NvbHVtbnNbaUNvbF07CgkJCXZhciBvRGF0YSA9IG9TZXR0aW5ncy5hb0RhdGFbaVJvd10uX2FEYXRhOwoJCQoJCQlpZiAoIChzRGF0YT1vQ29sLmZuR2V0RGF0YSggb0RhdGEsIHNTcGVjaWZpYyApKSA9PT0gdW5kZWZpbmVkICkKCQkJewoJCQkJaWYgKCBvU2V0dGluZ3MuaURyYXdFcnJvciAhPSBvU2V0dGluZ3MuaURyYXcgJiYgb0NvbC5zRGVmYXVsdENvbnRlbnQgPT09IG51bGwgKQoJCQkJewoJCQkJCV9mbkxvZyggb1NldHRpbmdzLCAwLCAiUmVxdWVzdGVkIHVua25vd24gcGFyYW1ldGVyICIrCgkJCQkJCSh0eXBlb2Ygb0NvbC5tRGF0YVByb3A9PSdmdW5jdGlvbicgPyAne21EYXRhcHJvcCBmdW5jdGlvbn0nIDogIiciK29Db2wubURhdGFQcm9wKyInIikrCgkJCQkJCSIgZnJvbSB0aGUgZGF0YSBzb3VyY2UgZm9yIHJvdyAiK2lSb3cgKTsKCQkJCQlvU2V0dGluZ3MuaURyYXdFcnJvciA9IG9TZXR0aW5ncy5pRHJhdzsKCQkJCX0KCQkJCXJldHVybiBvQ29sLnNEZWZhdWx0Q29udGVudDsKCQkJfQoJCQoJCQkvKiBXaGVuIHRoZSBkYXRhIHNvdXJjZSBpcyBudWxsLCB3ZSBjYW4gdXNlIGRlZmF1bHQgY29sdW1uIGRhdGEgKi8KCQkJaWYgKCBzRGF0YSA9PT0gbnVsbCAmJiBvQ29sLnNEZWZhdWx0Q29udGVudCAhPT0gbnVsbCApCgkJCXsKCQkJCXNEYXRhID0gb0NvbC5zRGVmYXVsdENvbnRlbnQ7CgkJCX0KCQkJZWxzZSBpZiAoIHR5cGVvZiBzRGF0YSA9PT0gJ2Z1bmN0aW9uJyApCgkJCXsKCQkJCS8qIElmIHRoZSBkYXRhIHNvdXJjZSBpcyBhIGZ1bmN0aW9uLCB0aGVuIHdlIHJ1biBpdCBhbmQgdXNlIHRoZSByZXR1cm4gKi8KCQkJCXJldHVybiBzRGF0YSgpOwoJCQl9CgkJCgkJCWlmICggc1NwZWNpZmljID09ICdkaXNwbGF5JyAmJiBzRGF0YSA9PT0gbnVsbCApCgkJCXsKCQkJCXJldHVybiAnJzsKCQkJfQoJCQlyZXR1cm4gc0RhdGE7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIFNldCB0aGUgdmFsdWUgZm9yIGEgc3BlY2lmaWMgY2VsbCwgaW50byB0aGUgaW50ZXJuYWwgZGF0YSBjYWNoZQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7aW50fSBpUm93IGFvRGF0YSByb3cgaWQKCQkgKiAgQHBhcmFtIHtpbnR9IGlDb2wgQ29sdW1uIGluZGV4CgkJICogIEBwYXJhbSB7Kn0gdmFsIFZhbHVlIHRvIHNldAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5TZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpQ29sLCB2YWwgKQoJCXsKCQkJdmFyIG9Db2wgPSBvU2V0dGluZ3MuYW9Db2x1bW5zW2lDb2xdOwoJCQl2YXIgb0RhdGEgPSBvU2V0dGluZ3MuYW9EYXRhW2lSb3ddLl9hRGF0YTsKCQkKCQkJb0NvbC5mblNldERhdGEoIG9EYXRhLCB2YWwgKTsKCQl9CgkJCgkJCgkJLyoqCgkJICogUmV0dXJuIGEgZnVuY3Rpb24gdGhhdCBjYW4gYmUgdXNlZCB0byBnZXQgZGF0YSBmcm9tIGEgc291cmNlIG9iamVjdCwgdGFraW5nCgkJICogaW50byBhY2NvdW50IHRoZSBhYmlsaXR5IHRvIHVzZSBuZXN0ZWQgb2JqZWN0cyBhcyBhIHNvdXJjZQoJCSAqICBAcGFyYW0ge3N0cmluZ3xpbnR8ZnVuY3Rpb259IG1Tb3VyY2UgVGhlIGRhdGEgc291cmNlIGZvciB0aGUgb2JqZWN0CgkJICogIEByZXR1cm5zIHtmdW5jdGlvbn0gRGF0YSBnZXQgZnVuY3Rpb24KCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuR2V0T2JqZWN0RGF0YUZuKCBtU291cmNlICkKCQl7CgkJCWlmICggbVNvdXJjZSA9PT0gbnVsbCApCgkJCXsKCQkJCS8qIEdpdmUgYW4gZW1wdHkgc3RyaW5nIGZvciByZW5kZXJpbmcgLyBzb3J0aW5nIGV0YyAqLwoJCQkJcmV0dXJuIGZ1bmN0aW9uIChkYXRhLCB0eXBlKSB7CgkJCQkJcmV0dXJuIG51bGw7CgkJCQl9OwoJCQl9CgkJCWVsc2UgaWYgKCB0eXBlb2YgbVNvdXJjZSA9PT0gJ2Z1bmN0aW9uJyApCgkJCXsKCQkJCXJldHVybiBmdW5jdGlvbiAoZGF0YSwgdHlwZSkgewoJCQkJCXJldHVybiBtU291cmNlKCBkYXRhLCB0eXBlICk7CgkJCQl9OwoJCQl9CgkJCWVsc2UgaWYgKCB0eXBlb2YgbVNvdXJjZSA9PT0gJ3N0cmluZycgJiYgbVNvdXJjZS5pbmRleE9mKCcuJykgIT0gLTEgKQoJCQl7CgkJCQkvKiBJZiB0aGVyZSBpcyBhIC4gaW4gdGhlIHNvdXJjZSBzdHJpbmcgdGhlbiB0aGUgZGF0YSBzb3VyY2UgaXMgaW4gYSAKCQkJCSAqIG5lc3RlZCBvYmplY3Qgc28gd2UgbG9vcCBvdmVyIHRoZSBkYXRhIGZvciBlYWNoIGxldmVsIHRvIGdldCB0aGUgbmV4dAoJCQkJICogbGV2ZWwgZG93bi4gT24gZWFjaCBsb29wIHdlIHRlc3QgZm9yIHVuZGVmaW5lZCwgYW5kIGlmIGZvdW5kIGltbWVkaWF0bHkKCQkJCSAqIHJldHVybi4gVGhpcyBhbGxvd3MgZW50aXJlIG9iamVjdHMgdG8gYmUgbWlzc2luZyBhbmQgc0RlZmF1bHRDb250ZW50IHRvCgkJCQkgKiBiZSB1c2VkIGlmIGRlZmluZWQsIHJhdGhlciB0aGFuIHRocm93aW5nIGFuIGVycm9yCgkJCQkgKi8KCQkJCXZhciBhID0gbVNvdXJjZS5zcGxpdCgnLicpOwoJCQkJcmV0dXJuIGZ1bmN0aW9uIChkYXRhLCB0eXBlKSB7CgkJCQkJZm9yICggdmFyIGk9MCwgaUxlbj1hLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQkJewoJCQkJCQlkYXRhID0gZGF0YVsgYVtpXSBdOwoJCQkJCQlpZiAoIGRhdGEgPT09IHVuZGVmaW5lZCApCgkJCQkJCXsKCQkJCQkJCXJldHVybiB1bmRlZmluZWQ7CgkJCQkJCX0KCQkJCQl9CgkJCQkJcmV0dXJuIGRhdGE7CgkJCQl9OwoJCQl9CgkJCWVsc2UKCQkJewoJCQkJLyogQXJyYXkgb3IgZmxhdCBvYmplY3QgbWFwcGluZyAqLwoJCQkJcmV0dXJuIGZ1bmN0aW9uIChkYXRhLCB0eXBlKSB7CgkJCQkJcmV0dXJuIGRhdGFbbVNvdXJjZV07CQoJCQkJfTsKCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBSZXR1cm4gYSBmdW5jdGlvbiB0aGF0IGNhbiBiZSB1c2VkIHRvIHNldCBkYXRhIGZyb20gYSBzb3VyY2Ugb2JqZWN0LCB0YWtpbmcKCQkgKiBpbnRvIGFjY291bnQgdGhlIGFiaWxpdHkgdG8gdXNlIG5lc3RlZCBvYmplY3RzIGFzIGEgc291cmNlCgkJICogIEBwYXJhbSB7c3RyaW5nfGludHxmdW5jdGlvbn0gbVNvdXJjZSBUaGUgZGF0YSBzb3VyY2UgZm9yIHRoZSBvYmplY3QKCQkgKiAgQHJldHVybnMge2Z1bmN0aW9ufSBEYXRhIHNldCBmdW5jdGlvbgoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5TZXRPYmplY3REYXRhRm4oIG1Tb3VyY2UgKQoJCXsKCQkJaWYgKCBtU291cmNlID09PSBudWxsICkKCQkJewoJCQkJLyogTm90aGluZyB0byBkbyB3aGVuIHRoZSBkYXRhIHNvdXJjZSBpcyBudWxsICovCgkJCQlyZXR1cm4gZnVuY3Rpb24gKGRhdGEsIHZhbCkge307CgkJCX0KCQkJZWxzZSBpZiAoIHR5cGVvZiBtU291cmNlID09PSAnZnVuY3Rpb24nICkKCQkJewoJCQkJcmV0dXJuIGZ1bmN0aW9uIChkYXRhLCB2YWwpIHsKCQkJCQltU291cmNlKCBkYXRhLCAnc2V0JywgdmFsICk7CgkJCQl9OwoJCQl9CgkJCWVsc2UgaWYgKCB0eXBlb2YgbVNvdXJjZSA9PT0gJ3N0cmluZycgJiYgbVNvdXJjZS5pbmRleE9mKCcuJykgIT0gLTEgKQoJCQl7CgkJCQkvKiBMaWtlIHRoZSBnZXQsIHdlIG5lZWQgdG8gZ2V0IGRhdGEgZnJvbSBhIG5lc3RlZCBvYmplY3QuICAqLwoJCQkJdmFyIGEgPSBtU291cmNlLnNwbGl0KCcuJyk7CgkJCQlyZXR1cm4gZnVuY3Rpb24gKGRhdGEsIHZhbCkgewoJCQkJCWZvciAoIHZhciBpPTAsIGlMZW49YS5sZW5ndGgtMSA7IGk8aUxlbiA7IGkrKyApCgkJCQkJewoJCQkJCQkvLyBJZiB0aGUgbmVzdGVkIG9iamVjdCBkb2Vzbid0IGN1cnJlbnRseSBleGlzdCAtIHNpbmNlIHdlIGFyZQoJCQkJCQkvLyB0cnlpbmcgdG8gc2V0IHRoZSB2YWx1ZSAtIGNyZWF0ZSBpdAoJCQkJCQlpZiAoIGRhdGFbIGFbaV0gXSA9PT0gdW5kZWZpbmVkICkKCQkJCQkJewoJCQkJCQkJZGF0YVsgYVtpXSBdID0ge307CgkJCQkJCX0KCQkJCQkJZGF0YSA9IGRhdGFbIGFbaV0gXTsKCQkJCQl9CgkJCQkJZGF0YVsgYVthLmxlbmd0aC0xXSBdID0gdmFsOwoJCQkJfTsKCQkJfQoJCQllbHNlCgkJCXsKCQkJCS8qIEFycmF5IG9yIGZsYXQgb2JqZWN0IG1hcHBpbmcgKi8KCQkJCXJldHVybiBmdW5jdGlvbiAoZGF0YSwgdmFsKSB7CgkJCQkJZGF0YVttU291cmNlXSA9IHZhbDsJCgkJCQl9OwoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIFJldHVybiBhbiBhcnJheSB3aXRoIHRoZSBmdWxsIHRhYmxlIGRhdGEKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcmV0dXJucyBhcnJheSB7YXJyYXl9IGFEYXRhIE1hc3RlciBkYXRhIGFycmF5CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkdldERhdGFNYXN0ZXIgKCBvU2V0dGluZ3MgKQoJCXsKCQkJdmFyIGFEYXRhID0gW107CgkJCXZhciBpTGVuID0gb1NldHRpbmdzLmFvRGF0YS5sZW5ndGg7CgkJCWZvciAoIHZhciBpPTAgOyBpPGlMZW47IGkrKyApCgkJCXsKCQkJCWFEYXRhLnB1c2goIG9TZXR0aW5ncy5hb0RhdGFbaV0uX2FEYXRhICk7CgkJCX0KCQkJcmV0dXJuIGFEYXRhOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBOdWtlIHRoZSB0YWJsZQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkNsZWFyVGFibGUoIG9TZXR0aW5ncyApCgkJewoJCQlvU2V0dGluZ3MuYW9EYXRhLnNwbGljZSggMCwgb1NldHRpbmdzLmFvRGF0YS5sZW5ndGggKTsKCQkJb1NldHRpbmdzLmFpRGlzcGxheU1hc3Rlci5zcGxpY2UoIDAsIG9TZXR0aW5ncy5haURpc3BsYXlNYXN0ZXIubGVuZ3RoICk7CgkJCW9TZXR0aW5ncy5haURpc3BsYXkuc3BsaWNlKCAwLCBvU2V0dGluZ3MuYWlEaXNwbGF5Lmxlbmd0aCApOwoJCQlfZm5DYWxjdWxhdGVFbmQoIG9TZXR0aW5ncyApOwoJCX0KCQkKCQkKCQkgLyoqCgkJICogVGFrZSBhbiBhcnJheSBvZiBpbnRlZ2VycyAoaW5kZXggYXJyYXkpIGFuZCByZW1vdmUgYSB0YXJnZXQgaW50ZWdlciAodmFsdWUgLSBub3QgCgkJICogdGhlIGtleSEpCgkJICogIEBwYXJhbSB7YXJyYXl9IGEgSW5kZXggYXJyYXkgdG8gdGFyZ2V0CgkJICogIEBwYXJhbSB7aW50fSBpVGFyZ2V0IHZhbHVlIHRvIGZpbmQKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuRGVsZXRlSW5kZXgoIGEsIGlUYXJnZXQgKQoJCXsKCQkJdmFyIGlUYXJnZXRJbmRleCA9IC0xOwoJCQkKCQkJZm9yICggdmFyIGk9MCwgaUxlbj1hLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWlmICggYVtpXSA9PSBpVGFyZ2V0ICkKCQkJCXsKCQkJCQlpVGFyZ2V0SW5kZXggPSBpOwoJCQkJfQoJCQkJZWxzZSBpZiAoIGFbaV0gPiBpVGFyZ2V0ICkKCQkJCXsKCQkJCQlhW2ldLS07CgkJCQl9CgkJCX0KCQkJCgkJCWlmICggaVRhcmdldEluZGV4ICE9IC0xICkKCQkJewoJCQkJYS5zcGxpY2UoIGlUYXJnZXRJbmRleCwgMSApOwoJCQl9CgkJfQoJCQoJCQoJCSAvKioKCQkgKiBDYWxsIHRoZSBkZXZlbG9wZXIgZGVmaW5lZCBmblJlbmRlciBmdW5jdGlvbiBmb3IgYSBnaXZlbiBjZWxsIChyb3cvY29sdW1uKSB3aXRoCgkJICogdGhlIHJlcXVpcmVkIHBhcmFtZXRlcnMgYW5kIHJldHVybiB0aGUgcmVzdWx0LgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7aW50fSBpUm93IGFvRGF0YSBpbmRleCBmb3IgdGhlIHJvdwoJCSAqICBAcGFyYW0ge2ludH0gaUNvbCBhb0NvbHVtbnMgaW5kZXggZm9yIHRoZSBjb2x1bW4KCQkgKiAgQHJldHVybnMgeyp9IFJldHVybiBvZiB0aGUgZGV2ZWxvcGVyJ3MgZm5SZW5kZXIgZnVuY3Rpb24KCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuUmVuZGVyKCBvU2V0dGluZ3MsIGlSb3csIGlDb2wgKQoJCXsKCQkJdmFyIG9Db2wgPSBvU2V0dGluZ3MuYW9Db2x1bW5zW2lDb2xdOwoJCQoJCQlyZXR1cm4gb0NvbC5mblJlbmRlciggewoJCQkJImlEYXRhUm93IjogICAgaVJvdywKCQkJCSJpRGF0YUNvbHVtbiI6IGlDb2wsCgkJCQkib1NldHRpbmdzIjogICBvU2V0dGluZ3MsCgkJCQkiYURhdGEiOiAgICAgICBvU2V0dGluZ3MuYW9EYXRhW2lSb3ddLl9hRGF0YSwKCQkJCSJtRGF0YVByb3AiOiAgIG9Db2wubURhdGFQcm9wCgkJCX0sIF9mbkdldENlbGxEYXRhKG9TZXR0aW5ncywgaVJvdywgaUNvbCwgJ2Rpc3BsYXknKSApOwoJCX0KCQkKCQkvKioKCQkgKiBDcmVhdGUgYSBuZXcgVFIgZWxlbWVudCAoYW5kIGl0J3MgVEQgY2hpbGRyZW4pIGZvciBhIHJvdwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7aW50fSBpUm93IFJvdyB0byBjb25zaWRlcgoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5DcmVhdGVUciAoIG9TZXR0aW5ncywgaVJvdyApCgkJewoJCQl2YXIgb0RhdGEgPSBvU2V0dGluZ3MuYW9EYXRhW2lSb3ddOwoJCQl2YXIgblRkOwoJCQoJCQlpZiAoIG9EYXRhLm5UciA9PT0gbnVsbCApCgkJCXsKCQkJCW9EYXRhLm5UciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7CgkJCgkJCQkvKiBVc2UgYSBwcml2YXRlIHByb3BlcnR5IG9uIHRoZSBub2RlIHRvIGFsbG93IHJlc2VydmUgbWFwcGluZyBmcm9tIHRoZSBub2RlCgkJCQkgKiB0byB0aGUgYW9EYXRhIGFycmF5IGZvciBmYXN0IGxvb2sgdXAKCQkJCSAqLwoJCQkJb0RhdGEublRyLl9EVF9Sb3dJbmRleCA9IGlSb3c7CgkJCgkJCQkvKiBTcGVjaWFsIHBhcmFtZXRlcnMgY2FuIGJlIGdpdmVuIGJ5IHRoZSBkYXRhIHNvdXJjZSB0byBiZSB1c2VkIG9uIHRoZSByb3cgKi8KCQkJCWlmICggb0RhdGEuX2FEYXRhLkRUX1Jvd0lkICkKCQkJCXsKCQkJCQlvRGF0YS5uVHIuaWQgPSBvRGF0YS5fYURhdGEuRFRfUm93SWQ7CgkJCQl9CgkJCgkJCQlpZiAoIG9EYXRhLl9hRGF0YS5EVF9Sb3dDbGFzcyApCgkJCQl7CgkJCQkJJChvRGF0YS5uVHIpLmFkZENsYXNzKCBvRGF0YS5fYURhdGEuRFRfUm93Q2xhc3MgKTsKCQkJCX0KCQkKCQkJCS8qIFByb2Nlc3MgZWFjaCBjb2x1bW4gKi8KCQkJCWZvciAoIHZhciBpPTAsIGlMZW49b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCXZhciBvQ29sID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpXTsKCQkJCQluVGQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCBvQ29sLnNDZWxsVHlwZSApOwoJCQoJCQkJCS8qIFJlbmRlciBpZiBuZWVkZWQgLSBpZiBiVXNlUmVuZGVyZWQgaXMgdHJ1ZSB0aGVuIHdlIGFscmVhZHkgaGF2ZSB0aGUgcmVuZGVyZWQKCQkJCQkgKiB2YWx1ZSBpbiB0aGUgZGF0YSBzb3VyY2UgLSBzbyBjYW4ganVzdCB1c2UgdGhhdAoJCQkJCSAqLwoJCQkJCW5UZC5pbm5lckhUTUwgPSAodHlwZW9mIG9Db2wuZm5SZW5kZXIgPT09ICdmdW5jdGlvbicgJiYgKCFvQ29sLmJVc2VSZW5kZXJlZCB8fCBvQ29sLm1EYXRhUHJvcCA9PT0gbnVsbCkpID8KCQkJCQkJX2ZuUmVuZGVyKCBvU2V0dGluZ3MsIGlSb3csIGkgKSA6CgkJCQkJCV9mbkdldENlbGxEYXRhKCBvU2V0dGluZ3MsIGlSb3csIGksICdkaXNwbGF5JyApOwoJCQkJCgkJCQkJLyogQWRkIHVzZXIgZGVmaW5lZCBjbGFzcyAqLwoJCQkJCWlmICggb0NvbC5zQ2xhc3MgIT09IG51bGwgKQoJCQkJCXsKCQkJCQkJblRkLmNsYXNzTmFtZSA9IG9Db2wuc0NsYXNzOwoJCQkJCX0KCQkJCQkKCQkJCQlpZiAoIG9Db2wuYlZpc2libGUgKQoJCQkJCXsKCQkJCQkJb0RhdGEublRyLmFwcGVuZENoaWxkKCBuVGQgKTsKCQkJCQkJb0RhdGEuX2FuSGlkZGVuW2ldID0gbnVsbDsKCQkJCQl9CgkJCQkJZWxzZQoJCQkJCXsKCQkJCQkJb0RhdGEuX2FuSGlkZGVuW2ldID0gblRkOwoJCQkJCX0KCQkKCQkJCQlpZiAoIG9Db2wuZm5DcmVhdGVkQ2VsbCApCgkJCQkJewoJCQkJCQlvQ29sLmZuQ3JlYXRlZENlbGwuY2FsbCggb1NldHRpbmdzLm9JbnN0YW5jZSwKCQkJCQkJCW5UZCwgX2ZuR2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaSwgJ2Rpc3BsYXknICksIG9EYXRhLl9hRGF0YSwgaVJvdywgaQoJCQkJCQkpOwoJCQkJCX0KCQkJCX0KCQkKCQkJCV9mbkNhbGxiYWNrRmlyZSggb1NldHRpbmdzLCAnYW9Sb3dDcmVhdGVkQ2FsbGJhY2snLCBudWxsLCBbb0RhdGEublRyLCBvRGF0YS5fYURhdGEsIGlSb3ddICk7CgkJCX0KCQl9CgkJCgkJCgkJLyoqCgkJICogQ3JlYXRlIHRoZSBIVE1MIGhlYWRlciBmb3IgdGhlIHRhYmxlCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuQnVpbGRIZWFkKCBvU2V0dGluZ3MgKQoJCXsKCQkJdmFyIGksIG5UaCwgaUxlbiwgaiwgakxlbjsKCQkJdmFyIGlUaHMgPSBvU2V0dGluZ3MublRIZWFkLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0aCcpLmxlbmd0aDsKCQkJdmFyIGlDb3JyZWN0b3IgPSAwOwoJCQl2YXIganFDaGlsZHJlbjsKCQkJCgkJCS8qIElmIHRoZXJlIGlzIGEgaGVhZGVyIGluIHBsYWNlIC0gdGhlbiB1c2UgaXQgLSBvdGhlcndpc2UgaXQncyBnb2luZyB0byBnZXQgbnVrZWQuLi4gKi8KCQkJaWYgKCBpVGhzICE9PSAwICkKCQkJewoJCQkJLyogV2UndmUgZ290IGEgdGhlYWQgZnJvbSB0aGUgRE9NLCBzbyByZW1vdmUgaGlkZGVuIGNvbHVtbnMgYW5kIGFwcGx5IHdpZHRoIHRvIHZpcyBjb2xzICovCgkJCQlmb3IgKCBpPTAsIGlMZW49b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCW5UaCA9IG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0ublRoOwoJCQkJCW5UaC5zZXRBdHRyaWJ1dGUoJ3JvbGUnLCAnY29sdW1uaGVhZGVyJyk7CgkJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLmJTb3J0YWJsZSApCgkJCQkJewoJCQkJCQluVGguc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsIG9TZXR0aW5ncy5pVGFiSW5kZXgpOwoJCQkJCQluVGguc2V0QXR0cmlidXRlKCdhcmlhLWNvbnRyb2xzJywgb1NldHRpbmdzLnNUYWJsZUlkKTsKCQkJCQl9CgkJCgkJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNDbGFzcyAhPT0gbnVsbCApCgkJCQkJewoJCQkJCQkkKG5UaCkuYWRkQ2xhc3MoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc0NsYXNzICk7CgkJCQkJfQoJCQkJCQoJCQkJCS8qIFNldCB0aGUgdGl0bGUgb2YgdGhlIGNvbHVtbiBpZiBpdCBpcyB1c2VyIGRlZmluZWQgKG5vdCB3aGF0IHdhcyBhdXRvIGRldGVjdGVkKSAqLwoJCQkJCWlmICggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zVGl0bGUgIT0gblRoLmlubmVySFRNTCApCgkJCQkJewoJCQkJCQluVGguaW5uZXJIVE1MID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zVGl0bGU7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCWVsc2UKCQkJewoJCQkJLyogV2UgZG9uJ3QgaGF2ZSBhIGhlYWRlciBpbiB0aGUgRE9NIC0gc28gd2UgYXJlIGdvaW5nIHRvIGhhdmUgdG8gY3JlYXRlIG9uZSAqLwoJCQkJdmFyIG5UciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICJ0ciIgKTsKCQkJCQoJCQkJZm9yICggaT0wLCBpTGVuPW9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQluVGggPSBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLm5UaDsKCQkJCQluVGguaW5uZXJIVE1MID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zVGl0bGU7CgkJCQkJblRoLnNldEF0dHJpYnV0ZSgndGFiaW5kZXgnLCAnMCcpOwoJCQkJCQoJCQkJCWlmICggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zQ2xhc3MgIT09IG51bGwgKQoJCQkJCXsKCQkJCQkJJChuVGgpLmFkZENsYXNzKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNDbGFzcyApOwoJCQkJCX0KCQkJCQkKCQkJCQluVHIuYXBwZW5kQ2hpbGQoIG5UaCApOwoJCQkJfQoJCQkJJChvU2V0dGluZ3MublRIZWFkKS5odG1sKCAnJyApWzBdLmFwcGVuZENoaWxkKCBuVHIgKTsKCQkJCV9mbkRldGVjdEhlYWRlciggb1NldHRpbmdzLmFvSGVhZGVyLCBvU2V0dGluZ3MublRIZWFkICk7CgkJCX0KCQkJCgkJCS8qIEFSSUEgcm9sZSBmb3IgdGhlIHJvd3MgKi8JCgkJCSQob1NldHRpbmdzLm5USGVhZCkuY2hpbGRyZW4oJ3RyJykuYXR0cigncm9sZScsICdyb3cnKTsKCQkJCgkJCS8qIEFkZCB0aGUgZXh0cmEgbWFya3VwIG5lZWRlZCBieSBqUXVlcnkgVUkncyB0aGVtZXMgKi8KCQkJaWYgKCBvU2V0dGluZ3MuYkpVSSApCgkJCXsKCQkJCWZvciAoIGk9MCwgaUxlbj1vU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJblRoID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5uVGg7CgkJCQkJCgkJCQkJdmFyIG5EaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKCQkJCQluRGl2LmNsYXNzTmFtZSA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydEpVSVdyYXBwZXI7CgkJCQkJJChuVGgpLmNvbnRlbnRzKCkuYXBwZW5kVG8obkRpdik7CgkJCQkJCgkJCQkJdmFyIG5TcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpOwoJCQkJCW5TcGFuLmNsYXNzTmFtZSA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydEljb247CgkJCQkJbkRpdi5hcHBlbmRDaGlsZCggblNwYW4gKTsKCQkJCQluVGguYXBwZW5kQ2hpbGQoIG5EaXYgKTsKCQkJCX0KCQkJfQoJCQkKCQkJaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTb3J0ICkKCQkJewoJCQkJZm9yICggaT0wIDsgaTxvU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGkrKyApCgkJCQl7CgkJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLmJTb3J0YWJsZSAhPT0gZmFsc2UgKQoJCQkJCXsKCQkJCQkJX2ZuU29ydEF0dGFjaExpc3RlbmVyKCBvU2V0dGluZ3MsIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0ublRoLCBpICk7CgkJCQkJfQoJCQkJCWVsc2UKCQkJCQl7CgkJCQkJCSQob1NldHRpbmdzLmFvQ29sdW1uc1tpXS5uVGgpLmFkZENsYXNzKCBvU2V0dGluZ3Mub0NsYXNzZXMuc1NvcnRhYmxlTm9uZSApOwoJCQkJCX0KCQkJCX0KCQkJfQoJCQkKCQkJLyogRGVhbCB3aXRoIHRoZSBmb290ZXIgLSBhZGQgY2xhc3NlcyBpZiByZXF1aXJlZCAqLwoJCQlpZiAoIG9TZXR0aW5ncy5vQ2xhc3Nlcy5zRm9vdGVyVEggIT09ICIiICkKCQkJewoJCQkJJChvU2V0dGluZ3MublRGb290KS5jaGlsZHJlbigndHInKS5jaGlsZHJlbigndGgnKS5hZGRDbGFzcyggb1NldHRpbmdzLm9DbGFzc2VzLnNGb290ZXJUSCApOwoJCQl9CgkJCQoJCQkvKiBDYWNoZSB0aGUgZm9vdGVyIGVsZW1lbnRzICovCgkJCWlmICggb1NldHRpbmdzLm5URm9vdCAhPT0gbnVsbCApCgkJCXsKCQkJCXZhciBhbkNlbGxzID0gX2ZuR2V0VW5pcXVlVGhzKCBvU2V0dGluZ3MsIG51bGwsIG9TZXR0aW5ncy5hb0Zvb3RlciApOwoJCQkJZm9yICggaT0wLCBpTGVuPW9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQlpZiAoIGFuQ2VsbHNbaV0gKQoJCQkJCXsKCQkJCQkJb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5uVGYgPSBhbkNlbGxzW2ldOwoJCQkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc0NsYXNzICkKCQkJCQkJewoJCQkJCQkJJChhbkNlbGxzW2ldKS5hZGRDbGFzcyggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zQ2xhc3MgKTsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBEcmF3IHRoZSBoZWFkZXIgKG9yIGZvb3RlcikgZWxlbWVudCBiYXNlZCBvbiB0aGUgY29sdW1uIHZpc2liaWxpdHkgc3RhdGVzLiBUaGUKCQkgKiBtZXRob2RvbG9neSBoZXJlIGlzIHRvIHVzZSB0aGUgbGF5b3V0IGFycmF5IGZyb20gX2ZuRGV0ZWN0SGVhZGVyLCBtb2RpZmllZCBmb3IKCQkgKiB0aGUgaW5zdGFudGFuZW91cyBjb2x1bW4gdmlzaWJpbGl0eSwgdG8gY29uc3RydWN0IHRoZSBuZXcgbGF5b3V0LiBUaGUgZ3JpZCBpcwoJCSAqIHRyYXZlcnNlZCBvdmVyIGNlbGwgYXQgYSB0aW1lIGluIGEgcm93cyB4IGNvbHVtbnMgZ3JpZCBmYXNoaW9uLCBhbHRob3VnaCBlYWNoIAoJCSAqIGNlbGwgaW5zZXJ0IGNhbiBjb3ZlciBtdWx0aXBsZSBlbGVtZW50cyBpbiB0aGUgZ3JpZCAtIHdoaWNoIGlzIHRyYWNrcyB1c2luZyB0aGUKCQkgKiBhQXBwbGllZCBhcnJheS4gQ2VsbCBpbnNlcnRzIGluIHRoZSBncmlkIHdpbGwgb25seSBvY2N1ciB3aGVyZSB0aGVyZSBpc24ndAoJCSAqIGFscmVhZHkgYSBjZWxsIGluIHRoYXQgcG9zaXRpb24uCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIGFycmF5IHtvYmplY3RzfSBhb1NvdXJjZSBMYXlvdXQgYXJyYXkgZnJvbSBfZm5EZXRlY3RIZWFkZXIKCQkgKiAgQHBhcmFtIHtib29sZWFufSBbYkluY2x1ZGVIaWRkZW49ZmFsc2VdIElmIHRydWUgdGhlbiBpbmNsdWRlIHRoZSBoaWRkZW4gY29sdW1ucyBpbiB0aGUgY2FsYywgCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkRyYXdIZWFkKCBvU2V0dGluZ3MsIGFvU291cmNlLCBiSW5jbHVkZUhpZGRlbiApCgkJewoJCQl2YXIgaSwgaUxlbiwgaiwgakxlbiwgaywga0xlbiwgbiwgbkxvY2FsVHI7CgkJCXZhciBhb0xvY2FsID0gW107CgkJCXZhciBhQXBwbGllZCA9IFtdOwoJCQl2YXIgaUNvbHVtbnMgPSBvU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aDsKCQkJdmFyIGlSb3dzcGFuLCBpQ29sc3BhbjsKCQkKCQkJaWYgKCAgYkluY2x1ZGVIaWRkZW4gPT09IHVuZGVmaW5lZCApCgkJCXsKCQkJCWJJbmNsdWRlSGlkZGVuID0gZmFsc2U7CgkJCX0KCQkKCQkJLyogTWFrZSBhIGNvcHkgb2YgdGhlIG1hc3RlciBsYXlvdXQgYXJyYXksIGJ1dCB3aXRob3V0IHRoZSB2aXNpYmxlIGNvbHVtbnMgaW4gaXQgKi8KCQkJZm9yICggaT0wLCBpTGVuPWFvU291cmNlLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWFvTG9jYWxbaV0gPSBhb1NvdXJjZVtpXS5zbGljZSgpOwoJCQkJYW9Mb2NhbFtpXS5uVHIgPSBhb1NvdXJjZVtpXS5uVHI7CgkJCgkJCQkvKiBSZW1vdmUgYW55IGNvbHVtbnMgd2hpY2ggYXJlIGN1cnJlbnRseSBoaWRkZW4gKi8KCQkJCWZvciAoIGo9aUNvbHVtbnMtMSA7IGo+PTAgOyBqLS0gKQoJCQkJewoJCQkJCWlmICggIW9TZXR0aW5ncy5hb0NvbHVtbnNbal0uYlZpc2libGUgJiYgIWJJbmNsdWRlSGlkZGVuICkKCQkJCQl7CgkJCQkJCWFvTG9jYWxbaV0uc3BsaWNlKCBqLCAxICk7CgkJCQkJfQoJCQkJfQoJCQoJCQkJLyogUHJlcCB0aGUgYXBwbGllZCBhcnJheSAtIGl0IG5lZWRzIGFuIGVsZW1lbnQgZm9yIGVhY2ggcm93ICovCgkJCQlhQXBwbGllZC5wdXNoKCBbXSApOwoJCQl9CgkJCgkJCWZvciAoIGk9MCwgaUxlbj1hb0xvY2FsLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCW5Mb2NhbFRyID0gYW9Mb2NhbFtpXS5uVHI7CgkJCQkKCQkJCS8qIEFsbCBjZWxscyBhcmUgZ29pbmcgdG8gYmUgcmVwbGFjZWQsIHNvIGVtcHR5IG91dCB0aGUgcm93ICovCgkJCQlpZiAoIG5Mb2NhbFRyICkKCQkJCXsKCQkJCQl3aGlsZSggKG4gPSBuTG9jYWxUci5maXJzdENoaWxkKSApCgkJCQkJewoJCQkJCQluTG9jYWxUci5yZW1vdmVDaGlsZCggbiApOwoJCQkJCX0KCQkJCX0KCQkKCQkJCWZvciAoIGo9MCwgakxlbj1hb0xvY2FsW2ldLmxlbmd0aCA7IGo8akxlbiA7IGorKyApCgkJCQl7CgkJCQkJaVJvd3NwYW4gPSAxOwoJCQkJCWlDb2xzcGFuID0gMTsKCQkKCQkJCQkvKiBDaGVjayB0byBzZWUgaWYgdGhlcmUgaXMgYWxyZWFkeSBhIGNlbGwgKHJvdy9jb2xzcGFuKSBjb3ZlcmluZyBvdXIgdGFyZ2V0CgkJCQkJICogaW5zZXJ0IHBvaW50LiBJZiB0aGVyZSBpcywgdGhlbiB0aGVyZSBpcyBub3RoaW5nIHRvIGRvLgoJCQkJCSAqLwoJCQkJCWlmICggYUFwcGxpZWRbaV1bal0gPT09IHVuZGVmaW5lZCApCgkJCQkJewoJCQkJCQluTG9jYWxUci5hcHBlbmRDaGlsZCggYW9Mb2NhbFtpXVtqXS5jZWxsICk7CgkJCQkJCWFBcHBsaWVkW2ldW2pdID0gMTsKCQkKCQkJCQkJLyogRXhwYW5kIHRoZSBjZWxsIHRvIGNvdmVyIGFzIG1hbnkgcm93cyBhcyBuZWVkZWQgKi8KCQkJCQkJd2hpbGUgKCBhb0xvY2FsW2kraVJvd3NwYW5dICE9PSB1bmRlZmluZWQgJiYKCQkJCQkJICAgICAgICBhb0xvY2FsW2ldW2pdLmNlbGwgPT0gYW9Mb2NhbFtpK2lSb3dzcGFuXVtqXS5jZWxsICkKCQkJCQkJewoJCQkJCQkJYUFwcGxpZWRbaStpUm93c3Bhbl1bal0gPSAxOwoJCQkJCQkJaVJvd3NwYW4rKzsKCQkJCQkJfQoJCQoJCQkJCQkvKiBFeHBhbmQgdGhlIGNlbGwgdG8gY292ZXIgYXMgbWFueSBjb2x1bW5zIGFzIG5lZWRlZCAqLwoJCQkJCQl3aGlsZSAoIGFvTG9jYWxbaV1baitpQ29sc3Bhbl0gIT09IHVuZGVmaW5lZCAmJgoJCQkJCQkgICAgICAgIGFvTG9jYWxbaV1bal0uY2VsbCA9PSBhb0xvY2FsW2ldW2oraUNvbHNwYW5dLmNlbGwgKQoJCQkJCQl7CgkJCQkJCQkvKiBNdXN0IHVwZGF0ZSB0aGUgYXBwbGllZCBhcnJheSBvdmVyIHRoZSByb3dzIGZvciB0aGUgY29sdW1ucyAqLwoJCQkJCQkJZm9yICggaz0wIDsgazxpUm93c3BhbiA7IGsrKyApCgkJCQkJCQl7CgkJCQkJCQkJYUFwcGxpZWRbaStrXVtqK2lDb2xzcGFuXSA9IDE7CgkJCQkJCQl9CgkJCQkJCQlpQ29sc3BhbisrOwoJCQkJCQl9CgkJCgkJCQkJCS8qIERvIHRoZSBhY3R1YWwgZXhwYW5zaW9uIGluIHRoZSBET00gKi8KCQkJCQkJYW9Mb2NhbFtpXVtqXS5jZWxsLnJvd1NwYW4gPSBpUm93c3BhbjsKCQkJCQkJYW9Mb2NhbFtpXVtqXS5jZWxsLmNvbFNwYW4gPSBpQ29sc3BhbjsKCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgkJCgkJCgkJLyoqCgkJICogSW5zZXJ0IHRoZSByZXF1aXJlZCBUUiBub2RlcyBpbnRvIHRoZSB0YWJsZSBmb3IgZGlzcGxheQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkRyYXcoIG9TZXR0aW5ncyApCgkJewoJCQkvKiBQcm92aWRlIGEgcHJlLWNhbGxiYWNrIGZ1bmN0aW9uIHdoaWNoIGNhbiBiZSB1c2VkIHRvIGNhbmNlbCB0aGUgZHJhdyBpcyBmYWxzZSBpcyByZXR1cm5lZCAqLwoJCQl2YXIgYVByZURyYXcgPSBfZm5DYWxsYmFja0ZpcmUoIG9TZXR0aW5ncywgJ2FvUHJlRHJhd0NhbGxiYWNrJywgJ3ByZURyYXcnLCBbb1NldHRpbmdzXSApOwoJCQlpZiAoICQuaW5BcnJheSggZmFsc2UsIGFQcmVEcmF3ICkgIT09IC0xICkKCQkJewoJCQkJX2ZuUHJvY2Vzc2luZ0Rpc3BsYXkoIG9TZXR0aW5ncywgZmFsc2UgKTsKCQkJCXJldHVybjsKCQkJfQoJCQkKCQkJdmFyIGksIGlMZW4sIG47CgkJCXZhciBhblJvd3MgPSBbXTsKCQkJdmFyIGlSb3dDb3VudCA9IDA7CgkJCXZhciBpU3RyaXBlcyA9IG9TZXR0aW5ncy5hc1N0cmlwZUNsYXNzZXMubGVuZ3RoOwoJCQl2YXIgaU9wZW5Sb3dzID0gb1NldHRpbmdzLmFvT3BlblJvd3MubGVuZ3RoOwoJCQkKCQkJb1NldHRpbmdzLmJEcmF3aW5nID0gdHJ1ZTsKCQkJCgkJCS8qIENoZWNrIGFuZCBzZWUgaWYgd2UgaGF2ZSBhbiBpbml0aWFsIGRyYXcgcG9zaXRpb24gZnJvbSBzdGF0ZSBzYXZpbmcgKi8KCQkJaWYgKCBvU2V0dGluZ3MuaUluaXREaXNwbGF5U3RhcnQgIT09IHVuZGVmaW5lZCAmJiBvU2V0dGluZ3MuaUluaXREaXNwbGF5U3RhcnQgIT0gLTEgKQoJCQl7CgkJCQlpZiAoIG9TZXR0aW5ncy5vRmVhdHVyZXMuYlNlcnZlclNpZGUgKQoJCQkJewoJCQkJCW9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA9IG9TZXR0aW5ncy5pSW5pdERpc3BsYXlTdGFydDsKCQkJCX0KCQkJCWVsc2UKCQkJCXsKCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSAob1NldHRpbmdzLmlJbml0RGlzcGxheVN0YXJ0ID49IG9TZXR0aW5ncy5mblJlY29yZHNEaXNwbGF5KCkpID8KCQkJCQkJMCA6IG9TZXR0aW5ncy5pSW5pdERpc3BsYXlTdGFydDsKCQkJCX0KCQkJCW9TZXR0aW5ncy5pSW5pdERpc3BsYXlTdGFydCA9IC0xOwoJCQkJX2ZuQ2FsY3VsYXRlRW5kKCBvU2V0dGluZ3MgKTsKCQkJfQoJCQkKCQkJLyogU2VydmVyLXNpZGUgcHJvY2Vzc2luZyBkcmF3IGludGVyY2VwdCAqLwoJCQlpZiAoIG9TZXR0aW5ncy5iRGVmZXJMb2FkaW5nICkKCQkJewoJCQkJb1NldHRpbmdzLmJEZWZlckxvYWRpbmcgPSBmYWxzZTsKCQkJCW9TZXR0aW5ncy5pRHJhdysrOwoJCQl9CgkJCWVsc2UgaWYgKCAhb1NldHRpbmdzLm9GZWF0dXJlcy5iU2VydmVyU2lkZSApCgkJCXsKCQkJCW9TZXR0aW5ncy5pRHJhdysrOwoJCQl9CgkJCWVsc2UgaWYgKCAhb1NldHRpbmdzLmJEZXN0cm95aW5nICYmICFfZm5BamF4VXBkYXRlKCBvU2V0dGluZ3MgKSApCgkJCXsKCQkJCXJldHVybjsKCQkJfQoJCQkKCQkJaWYgKCBvU2V0dGluZ3MuYWlEaXNwbGF5Lmxlbmd0aCAhPT0gMCApCgkJCXsKCQkJCXZhciBpU3RhcnQgPSBvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQ7CgkJCQl2YXIgaUVuZCA9IG9TZXR0aW5ncy5faURpc3BsYXlFbmQ7CgkJCQkKCQkJCWlmICggb1NldHRpbmdzLm9GZWF0dXJlcy5iU2VydmVyU2lkZSApCgkJCQl7CgkJCQkJaVN0YXJ0ID0gMDsKCQkJCQlpRW5kID0gb1NldHRpbmdzLmFvRGF0YS5sZW5ndGg7CgkJCQl9CgkJCQkKCQkJCWZvciAoIHZhciBqPWlTdGFydCA7IGo8aUVuZCA7IGorKyApCgkJCQl7CgkJCQkJdmFyIGFvRGF0YSA9IG9TZXR0aW5ncy5hb0RhdGFbIG9TZXR0aW5ncy5haURpc3BsYXlbal0gXTsKCQkJCQlpZiAoIGFvRGF0YS5uVHIgPT09IG51bGwgKQoJCQkJCXsKCQkJCQkJX2ZuQ3JlYXRlVHIoIG9TZXR0aW5ncywgb1NldHRpbmdzLmFpRGlzcGxheVtqXSApOwoJCQkJCX0KCQkKCQkJCQl2YXIgblJvdyA9IGFvRGF0YS5uVHI7CgkJCQkJCgkJCQkJLyogUmVtb3ZlIHRoZSBvbGQgc3RyaXBpbmcgY2xhc3NlcyBhbmQgdGhlbiBhZGQgdGhlIG5ldyBvbmUgKi8KCQkJCQlpZiAoIGlTdHJpcGVzICE9PSAwICkKCQkJCQl7CgkJCQkJCXZhciBzU3RyaXBlID0gb1NldHRpbmdzLmFzU3RyaXBlQ2xhc3Nlc1sgaVJvd0NvdW50ICUgaVN0cmlwZXMgXTsKCQkJCQkJaWYgKCBhb0RhdGEuX3NSb3dTdHJpcGUgIT0gc1N0cmlwZSApCgkJCQkJCXsKCQkJCQkJCSQoblJvdykucmVtb3ZlQ2xhc3MoIGFvRGF0YS5fc1Jvd1N0cmlwZSApLmFkZENsYXNzKCBzU3RyaXBlICk7CgkJCQkJCQlhb0RhdGEuX3NSb3dTdHJpcGUgPSBzU3RyaXBlOwoJCQkJCQl9CgkJCQkJfQoJCQkJCQoJCQkJCS8qIFJvdyBjYWxsYmFjayBmdW5jdGlvbnMgLSBtaWdodCB3YW50IHRvIG1hbmlwdWxlIHRoZSByb3cgKi8KCQkJCQlfZm5DYWxsYmFja0ZpcmUoIG9TZXR0aW5ncywgJ2FvUm93Q2FsbGJhY2snLCBudWxsLCAKCQkJCQkJW25Sb3csIG9TZXR0aW5ncy5hb0RhdGFbIG9TZXR0aW5ncy5haURpc3BsYXlbal0gXS5fYURhdGEsIGlSb3dDb3VudCwgal0gKTsKCQkJCQkKCQkJCQlhblJvd3MucHVzaCggblJvdyApOwoJCQkJCWlSb3dDb3VudCsrOwoJCQkJCQoJCQkJCS8qIElmIHRoZXJlIGlzIGFuIG9wZW4gcm93IC0gYW5kIGl0IGlzIGF0dGFjaGVkIHRvIHRoaXMgcGFyZW50IC0gYXR0YWNoIGl0IG9uIHJlZHJhdyAqLwoJCQkJCWlmICggaU9wZW5Sb3dzICE9PSAwICkKCQkJCQl7CgkJCQkJCWZvciAoIHZhciBrPTAgOyBrPGlPcGVuUm93cyA7IGsrKyApCgkJCQkJCXsKCQkJCQkJCWlmICggblJvdyA9PSBvU2V0dGluZ3MuYW9PcGVuUm93c1trXS5uUGFyZW50ICkKCQkJCQkJCXsKCQkJCQkJCQlhblJvd3MucHVzaCggb1NldHRpbmdzLmFvT3BlblJvd3Nba10ublRyICk7CgkJCQkJCQkJYnJlYWs7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQkvKiBUYWJsZSBpcyBlbXB0eSAtIGNyZWF0ZSBhIHJvdyB3aXRoIGFuIGVtcHR5IG1lc3NhZ2UgaW4gaXQgKi8KCQkJCWFuUm93c1sgMCBdID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ3RyJyApOwoJCQkJCgkJCQlpZiAoIG9TZXR0aW5ncy5hc1N0cmlwZUNsYXNzZXNbMF0gKQoJCQkJewoJCQkJCWFuUm93c1sgMCBdLmNsYXNzTmFtZSA9IG9TZXR0aW5ncy5hc1N0cmlwZUNsYXNzZXNbMF07CgkJCQl9CgkJCgkJCQl2YXIgb0xhbmcgPSBvU2V0dGluZ3Mub0xhbmd1YWdlOwoJCQkJdmFyIHNaZXJvID0gb0xhbmcuc1plcm9SZWNvcmRzOwoJCQkJaWYgKCBvU2V0dGluZ3MuaURyYXcgPT0gMSAmJiBvU2V0dGluZ3Muc0FqYXhTb3VyY2UgIT09IG51bGwgJiYgIW9TZXR0aW5ncy5vRmVhdHVyZXMuYlNlcnZlclNpZGUgKQoJCQkJewoJCQkJCXNaZXJvID0gb0xhbmcuc0xvYWRpbmdSZWNvcmRzOwoJCQkJfQoJCQkJZWxzZSBpZiAoIG9MYW5nLnNFbXB0eVRhYmxlICYmIG9TZXR0aW5ncy5mblJlY29yZHNUb3RhbCgpID09PSAwICkKCQkJCXsKCQkJCQlzWmVybyA9IG9MYW5nLnNFbXB0eVRhYmxlOwoJCQkJfQoJCQoJCQkJdmFyIG5UZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICd0ZCcgKTsKCQkJCW5UZC5zZXRBdHRyaWJ1dGUoICd2YWxpZ24nLCAidG9wIiApOwoJCQkJblRkLmNvbFNwYW4gPSBfZm5WaXNibGVDb2x1bW5zKCBvU2V0dGluZ3MgKTsKCQkJCW5UZC5jbGFzc05hbWUgPSBvU2V0dGluZ3Mub0NsYXNzZXMuc1Jvd0VtcHR5OwoJCQkJblRkLmlubmVySFRNTCA9IF9mbkluZm9NYWNyb3MoIG9TZXR0aW5ncywgc1plcm8gKTsKCQkJCQoJCQkJYW5Sb3dzWyBpUm93Q291bnQgXS5hcHBlbmRDaGlsZCggblRkICk7CgkJCX0KCQkJCgkJCS8qIEhlYWRlciBhbmQgZm9vdGVyIGNhbGxiYWNrcyAqLwoJCQlfZm5DYWxsYmFja0ZpcmUoIG9TZXR0aW5ncywgJ2FvSGVhZGVyQ2FsbGJhY2snLCAnaGVhZGVyJywgWyAkKG9TZXR0aW5ncy5uVEhlYWQpLmNoaWxkcmVuKCd0cicpWzBdLCAKCQkJCV9mbkdldERhdGFNYXN0ZXIoIG9TZXR0aW5ncyApLCBvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQsIG9TZXR0aW5ncy5mbkRpc3BsYXlFbmQoKSwgb1NldHRpbmdzLmFpRGlzcGxheSBdICk7CgkJCQoJCQlfZm5DYWxsYmFja0ZpcmUoIG9TZXR0aW5ncywgJ2FvRm9vdGVyQ2FsbGJhY2snLCAnZm9vdGVyJywgWyAkKG9TZXR0aW5ncy5uVEZvb3QpLmNoaWxkcmVuKCd0cicpWzBdLCAKCQkJCV9mbkdldERhdGFNYXN0ZXIoIG9TZXR0aW5ncyApLCBvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQsIG9TZXR0aW5ncy5mbkRpc3BsYXlFbmQoKSwgb1NldHRpbmdzLmFpRGlzcGxheSBdICk7CgkJCQoJCQkvKiAKCQkJICogTmVlZCB0byByZW1vdmUgYW55IG9sZCByb3cgZnJvbSB0aGUgZGlzcGxheSAtIG5vdGUgd2UgY2FuJ3QganVzdCBlbXB0eSB0aGUgdGJvZHkgdXNpbmcKCQkJICogJCgpLmh0bWwoJycpIHNpbmNlIHRoaXMgd2lsbCB1bmJpbmQgdGhlIGpRdWVyeSBldmVudCBoYW5kbGVycyAoZXZlbiBhbHRob3VnaCB0aGUgbm9kZSAKCQkJICogc3RpbGwgZXhpc3RzISkgLSBlcXVhbGx5IHdlIGNhbid0IHVzZSBpbm5lckhUTUwsIHNpbmNlIElFIHRocm93cyBhbiBleGNlcHRpb24uCgkJCSAqLwoJCQl2YXIKCQkJCW5BZGRGcmFnID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpLAoJCQkJblJlbW92ZUZyYWcgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCksCgkJCQluQm9keVBhciwgblRyczsKCQkJCgkJCWlmICggb1NldHRpbmdzLm5UQm9keSApCgkJCXsKCQkJCW5Cb2R5UGFyID0gb1NldHRpbmdzLm5UQm9keS5wYXJlbnROb2RlOwoJCQkJblJlbW92ZUZyYWcuYXBwZW5kQ2hpbGQoIG9TZXR0aW5ncy5uVEJvZHkgKTsKCQkJCQoJCQkJLyogV2hlbiBkb2luZyBpbmZpbml0ZSBzY3JvbGxpbmcsIG9ubHkgcmVtb3ZlIGNoaWxkIHJvd3Mgd2hlbiBzb3J0aW5nLCBmaWx0ZXJpbmcgb3Igc3RhcnQKCQkJCSAqIHVwLiBXaGVuIG5vdCBpbmZpbml0ZSBzY3JvbGwsIGFsd2F5cyBkbyBpdC4KCQkJCSAqLwoJCQkJaWYgKCAhb1NldHRpbmdzLm9TY3JvbGwuYkluZmluaXRlIHx8ICFvU2V0dGluZ3MuX2JJbml0Q29tcGxldGUgfHwKCQkJCSAJb1NldHRpbmdzLmJTb3J0ZWQgfHwgb1NldHRpbmdzLmJGaWx0ZXJlZCApCgkJCQl7CgkJCQkJd2hpbGUoIChuID0gb1NldHRpbmdzLm5UQm9keS5maXJzdENoaWxkKSApCgkJCQkJewoJCQkJCQlvU2V0dGluZ3MublRCb2R5LnJlbW92ZUNoaWxkKCBuICk7CgkJCQkJfQoJCQkJfQoJCQkJCgkJCQkvKiBQdXQgdGhlIGRyYXcgdGFibGUgaW50byB0aGUgZG9tICovCgkJCQlmb3IgKCBpPTAsIGlMZW49YW5Sb3dzLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJbkFkZEZyYWcuYXBwZW5kQ2hpbGQoIGFuUm93c1tpXSApOwoJCQkJfQoJCQkJCgkJCQlvU2V0dGluZ3MublRCb2R5LmFwcGVuZENoaWxkKCBuQWRkRnJhZyApOwoJCQkJaWYgKCBuQm9keVBhciAhPT0gbnVsbCApCgkJCQl7CgkJCQkJbkJvZHlQYXIuYXBwZW5kQ2hpbGQoIG9TZXR0aW5ncy5uVEJvZHkgKTsKCQkJCX0KCQkJfQoJCQkKCQkJLyogQ2FsbCBhbGwgcmVxdWlyZWQgY2FsbGJhY2sgZnVuY3Rpb25zIGZvciB0aGUgZW5kIG9mIGEgZHJhdyAqLwoJCQlfZm5DYWxsYmFja0ZpcmUoIG9TZXR0aW5ncywgJ2FvRHJhd0NhbGxiYWNrJywgJ2RyYXcnLCBbb1NldHRpbmdzXSApOwoJCQkKCQkJLyogRHJhdyBpcyBjb21wbGV0ZSwgc29ydGluZyBhbmQgZmlsdGVyaW5nIG11c3QgYmUgYXMgd2VsbCAqLwoJCQlvU2V0dGluZ3MuYlNvcnRlZCA9IGZhbHNlOwoJCQlvU2V0dGluZ3MuYkZpbHRlcmVkID0gZmFsc2U7CgkJCW9TZXR0aW5ncy5iRHJhd2luZyA9IGZhbHNlOwoJCQkKCQkJaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTZXJ2ZXJTaWRlICkKCQkJewoJCQkJX2ZuUHJvY2Vzc2luZ0Rpc3BsYXkoIG9TZXR0aW5ncywgZmFsc2UgKTsKCQkJCWlmICggIW9TZXR0aW5ncy5fYkluaXRDb21wbGV0ZSApCgkJCQl7CgkJCQkJX2ZuSW5pdENvbXBsZXRlKCBvU2V0dGluZ3MgKTsKCQkJCX0KCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBSZWRyYXcgdGhlIHRhYmxlIC0gdGFraW5nIGFjY291bnQgb2YgdGhlIHZhcmlvdXMgZmVhdHVyZXMgd2hpY2ggYXJlIGVuYWJsZWQKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5SZURyYXcoIG9TZXR0aW5ncyApCgkJewoJCQlpZiAoIG9TZXR0aW5ncy5vRmVhdHVyZXMuYlNvcnQgKQoJCQl7CgkJCQkvKiBTb3J0aW5nIHdpbGwgcmVmaWx0ZXIgYW5kIGRyYXcgZm9yIHVzICovCgkJCQlfZm5Tb3J0KCBvU2V0dGluZ3MsIG9TZXR0aW5ncy5vUHJldmlvdXNTZWFyY2ggKTsKCQkJfQoJCQllbHNlIGlmICggb1NldHRpbmdzLm9GZWF0dXJlcy5iRmlsdGVyICkKCQkJewoJCQkJLyogRmlsdGVyaW5nIHdpbGwgcmVkcmF3IGZvciB1cyAqLwoJCQkJX2ZuRmlsdGVyQ29tcGxldGUoIG9TZXR0aW5ncywgb1NldHRpbmdzLm9QcmV2aW91c1NlYXJjaCApOwoJCQl9CgkJCWVsc2UKCQkJewoJCQkJX2ZuQ2FsY3VsYXRlRW5kKCBvU2V0dGluZ3MgKTsKCQkJCV9mbkRyYXcoIG9TZXR0aW5ncyApOwoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEFkZCB0aGUgb3B0aW9ucyB0byB0aGUgcGFnZSBIVE1MIGZvciB0aGUgdGFibGUKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5BZGRPcHRpb25zSHRtbCAoIG9TZXR0aW5ncyApCgkJewoJCQkvKgoJCQkgKiBDcmVhdGUgYSB0ZW1wb3JhcnksIGVtcHR5LCBkaXYgd2hpY2ggd2UgY2FuIGxhdGVyIG9uIHJlcGxhY2Ugd2l0aCB3aGF0IHdlIGhhdmUgZ2VuZXJhdGVkCgkJCSAqIHdlIGRvIGl0IHRoaXMgd2F5IHRvIHJlbmRlcmluZyB0aGUgJ29wdGlvbnMnIGh0bWwgb2ZmbGluZSAtIHNwZWVkIDotKQoJCQkgKi8KCQkJdmFyIG5Ib2xkaW5nID0gJCgnPGRpdj48L2Rpdj4nKVswXTsKCQkJb1NldHRpbmdzLm5UYWJsZS5wYXJlbnROb2RlLmluc2VydEJlZm9yZSggbkhvbGRpbmcsIG9TZXR0aW5ncy5uVGFibGUgKTsKCQkJCgkJCS8qIAoJCQkgKiBBbGwgRGF0YVRhYmxlcyBhcmUgd3JhcHBlZCBpbiBhIGRpdgoJCQkgKi8KCQkJb1NldHRpbmdzLm5UYWJsZVdyYXBwZXIgPSAkKCc8ZGl2IGlkPSInK29TZXR0aW5ncy5zVGFibGVJZCsnX3dyYXBwZXIiIGNsYXNzPSInK29TZXR0aW5ncy5vQ2xhc3Nlcy5zV3JhcHBlcisnIiByb2xlPSJncmlkIj48L2Rpdj4nKVswXTsKCQkJb1NldHRpbmdzLm5UYWJsZVJlaW5zZXJ0QmVmb3JlID0gb1NldHRpbmdzLm5UYWJsZS5uZXh0U2libGluZzsKCQkKCQkJLyogVHJhY2sgd2hlcmUgd2Ugd2FudCB0byBpbnNlcnQgdGhlIG9wdGlvbiAqLwoJCQl2YXIgbkluc2VydE5vZGUgPSBvU2V0dGluZ3MublRhYmxlV3JhcHBlcjsKCQkJCgkJCS8qIExvb3Agb3ZlciB0aGUgdXNlciBzZXQgcG9zaXRpb25pbmcgYW5kIHBsYWNlIHRoZSBlbGVtZW50cyBhcyBuZWVkZWQgKi8KCQkJdmFyIGFEb20gPSBvU2V0dGluZ3Muc0RvbS5zcGxpdCgnJyk7CgkJCXZhciBuVG1wLCBpUHVzaEZlYXR1cmUsIGNPcHRpb24sIG5OZXdOb2RlLCBjTmV4dCwgc0F0dHIsIGo7CgkJCWZvciAoIHZhciBpPTAgOyBpPGFEb20ubGVuZ3RoIDsgaSsrICkKCQkJewoJCQkJaVB1c2hGZWF0dXJlID0gMDsKCQkJCWNPcHRpb24gPSBhRG9tW2ldOwoJCQkJCgkJCQlpZiAoIGNPcHRpb24gPT0gJzwnICkKCQkJCXsKCQkJCQkvKiBOZXcgY29udGFpbmVyIGRpdiAqLwoJCQkJCW5OZXdOb2RlID0gJCgnPGRpdj48L2Rpdj4nKVswXTsKCQkJCQkKCQkJCQkvKiBDaGVjayB0byBzZWUgaWYgd2Ugc2hvdWxkIGFwcGVuZCBhbiBpZCBhbmQvb3IgYSBjbGFzcyBuYW1lIHRvIHRoZSBjb250YWluZXIgKi8KCQkJCQljTmV4dCA9IGFEb21baSsxXTsKCQkJCQlpZiAoIGNOZXh0ID09ICInIiB8fCBjTmV4dCA9PSAnIicgKQoJCQkJCXsKCQkJCQkJc0F0dHIgPSAiIjsKCQkJCQkJaiA9IDI7CgkJCQkJCXdoaWxlICggYURvbVtpK2pdICE9IGNOZXh0ICkKCQkJCQkJewoJCQkJCQkJc0F0dHIgKz0gYURvbVtpK2pdOwoJCQkJCQkJaisrOwoJCQkJCQl9CgkJCQkJCQoJCQkJCQkvKiBSZXBsYWNlIGpRdWVyeSBVSSBjb25zdGFudHMgKi8KCQkJCQkJaWYgKCBzQXR0ciA9PSAiSCIgKQoJCQkJCQl7CgkJCQkJCQlzQXR0ciA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zSlVJSGVhZGVyOwoJCQkJCQl9CgkJCQkJCWVsc2UgaWYgKCBzQXR0ciA9PSAiRiIgKQoJCQkJCQl7CgkJCQkJCQlzQXR0ciA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zSlVJRm9vdGVyOwoJCQkJCQl9CgkJCQkJCQoJCQkJCQkvKiBUaGUgYXR0cmlidXRlIGNhbiBiZSBpbiB0aGUgZm9ybWF0IG9mICIjaWQuY2xhc3MiLCAiI2lkIiBvciAiY2xhc3MiIFRoaXMgbG9naWMKCQkJCQkJICogYnJlYWtzIHRoZSBzdHJpbmcgaW50byBwYXJ0cyBhbmQgYXBwbGllcyB0aGVtIGFzIG5lZWRlZAoJCQkJCQkgKi8KCQkJCQkJaWYgKCBzQXR0ci5pbmRleE9mKCcuJykgIT0gLTEgKQoJCQkJCQl7CgkJCQkJCQl2YXIgYVNwbGl0ID0gc0F0dHIuc3BsaXQoJy4nKTsKCQkJCQkJCW5OZXdOb2RlLmlkID0gYVNwbGl0WzBdLnN1YnN0cigxLCBhU3BsaXRbMF0ubGVuZ3RoLTEpOwoJCQkJCQkJbk5ld05vZGUuY2xhc3NOYW1lID0gYVNwbGl0WzFdOwoJCQkJCQl9CgkJCQkJCWVsc2UgaWYgKCBzQXR0ci5jaGFyQXQoMCkgPT0gIiMiICkKCQkJCQkJewoJCQkJCQkJbk5ld05vZGUuaWQgPSBzQXR0ci5zdWJzdHIoMSwgc0F0dHIubGVuZ3RoLTEpOwoJCQkJCQl9CgkJCQkJCWVsc2UKCQkJCQkJewoJCQkJCQkJbk5ld05vZGUuY2xhc3NOYW1lID0gc0F0dHI7CgkJCQkJCX0KCQkJCQkJCgkJCQkJCWkgKz0gajsgLyogTW92ZSBhbG9uZyB0aGUgcG9zaXRpb24gYXJyYXkgKi8KCQkJCQl9CgkJCQkJCgkJCQkJbkluc2VydE5vZGUuYXBwZW5kQ2hpbGQoIG5OZXdOb2RlICk7CgkJCQkJbkluc2VydE5vZGUgPSBuTmV3Tm9kZTsKCQkJCX0KCQkJCWVsc2UgaWYgKCBjT3B0aW9uID09ICc+JyApCgkJCQl7CgkJCQkJLyogRW5kIGNvbnRhaW5lciBkaXYgKi8KCQkJCQluSW5zZXJ0Tm9kZSA9IG5JbnNlcnROb2RlLnBhcmVudE5vZGU7CgkJCQl9CgkJCQllbHNlIGlmICggY09wdGlvbiA9PSAnbCcgJiYgb1NldHRpbmdzLm9GZWF0dXJlcy5iUGFnaW5hdGUgJiYgb1NldHRpbmdzLm9GZWF0dXJlcy5iTGVuZ3RoQ2hhbmdlICkKCQkJCXsKCQkJCQkvKiBMZW5ndGggKi8KCQkJCQluVG1wID0gX2ZuRmVhdHVyZUh0bWxMZW5ndGgoIG9TZXR0aW5ncyApOwoJCQkJCWlQdXNoRmVhdHVyZSA9IDE7CgkJCQl9CgkJCQllbHNlIGlmICggY09wdGlvbiA9PSAnZicgJiYgb1NldHRpbmdzLm9GZWF0dXJlcy5iRmlsdGVyICkKCQkJCXsKCQkJCQkvKiBGaWx0ZXIgKi8KCQkJCQluVG1wID0gX2ZuRmVhdHVyZUh0bWxGaWx0ZXIoIG9TZXR0aW5ncyApOwoJCQkJCWlQdXNoRmVhdHVyZSA9IDE7CgkJCQl9CgkJCQllbHNlIGlmICggY09wdGlvbiA9PSAncicgJiYgb1NldHRpbmdzLm9GZWF0dXJlcy5iUHJvY2Vzc2luZyApCgkJCQl7CgkJCQkJLyogcFJvY2Vzc2luZyAqLwoJCQkJCW5UbXAgPSBfZm5GZWF0dXJlSHRtbFByb2Nlc3NpbmcoIG9TZXR0aW5ncyApOwoJCQkJCWlQdXNoRmVhdHVyZSA9IDE7CgkJCQl9CgkJCQllbHNlIGlmICggY09wdGlvbiA9PSAndCcgKQoJCQkJewoJCQkJCS8qIFRhYmxlICovCgkJCQkJblRtcCA9IF9mbkZlYXR1cmVIdG1sVGFibGUoIG9TZXR0aW5ncyApOwoJCQkJCWlQdXNoRmVhdHVyZSA9IDE7CgkJCQl9CgkJCQllbHNlIGlmICggY09wdGlvbiA9PSAgJ2knICYmIG9TZXR0aW5ncy5vRmVhdHVyZXMuYkluZm8gKQoJCQkJewoJCQkJCS8qIEluZm8gKi8KCQkJCQluVG1wID0gX2ZuRmVhdHVyZUh0bWxJbmZvKCBvU2V0dGluZ3MgKTsKCQkJCQlpUHVzaEZlYXR1cmUgPSAxOwoJCQkJfQoJCQkJZWxzZSBpZiAoIGNPcHRpb24gPT0gJ3AnICYmIG9TZXR0aW5ncy5vRmVhdHVyZXMuYlBhZ2luYXRlICkKCQkJCXsKCQkJCQkvKiBQYWdpbmF0aW9uICovCgkJCQkJblRtcCA9IF9mbkZlYXR1cmVIdG1sUGFnaW5hdGUoIG9TZXR0aW5ncyApOwoJCQkJCWlQdXNoRmVhdHVyZSA9IDE7CgkJCQl9CgkJCQllbHNlIGlmICggRGF0YVRhYmxlLmV4dC5hb0ZlYXR1cmVzLmxlbmd0aCAhPT0gMCApCgkJCQl7CgkJCQkJLyogUGx1Zy1pbiBmZWF0dXJlcyAqLwoJCQkJCXZhciBhb0ZlYXR1cmVzID0gRGF0YVRhYmxlLmV4dC5hb0ZlYXR1cmVzOwoJCQkJCWZvciAoIHZhciBrPTAsIGtMZW49YW9GZWF0dXJlcy5sZW5ndGggOyBrPGtMZW4gOyBrKysgKQoJCQkJCXsKCQkJCQkJaWYgKCBjT3B0aW9uID09IGFvRmVhdHVyZXNba10uY0ZlYXR1cmUgKQoJCQkJCQl7CgkJCQkJCQluVG1wID0gYW9GZWF0dXJlc1trXS5mbkluaXQoIG9TZXR0aW5ncyApOwoJCQkJCQkJaWYgKCBuVG1wICkKCQkJCQkJCXsKCQkJCQkJCQlpUHVzaEZlYXR1cmUgPSAxOwoJCQkJCQkJfQoJCQkJCQkJYnJlYWs7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCQkKCQkJCS8qIEFkZCB0byB0aGUgMkQgZmVhdHVyZXMgYXJyYXkgKi8KCQkJCWlmICggaVB1c2hGZWF0dXJlID09IDEgJiYgblRtcCAhPT0gbnVsbCApCgkJCQl7CgkJCQkJaWYgKCB0eXBlb2Ygb1NldHRpbmdzLmFhbkZlYXR1cmVzW2NPcHRpb25dICE9PSAnb2JqZWN0JyApCgkJCQkJewoJCQkJCQlvU2V0dGluZ3MuYWFuRmVhdHVyZXNbY09wdGlvbl0gPSBbXTsKCQkJCQl9CgkJCQkJb1NldHRpbmdzLmFhbkZlYXR1cmVzW2NPcHRpb25dLnB1c2goIG5UbXAgKTsKCQkJCQluSW5zZXJ0Tm9kZS5hcHBlbmRDaGlsZCggblRtcCApOwoJCQkJfQoJCQl9CgkJCQoJCQkvKiBCdWlsdCBvdXIgRE9NIHN0cnVjdHVyZSAtIHJlcGxhY2UgdGhlIGhvbGRpbmcgZGl2IHdpdGggd2hhdCB3ZSB3YW50ICovCgkJCW5Ib2xkaW5nLnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKCBvU2V0dGluZ3MublRhYmxlV3JhcHBlciwgbkhvbGRpbmcgKTsKCQl9CgkJCgkJCgkJLyoqCgkJICogVXNlIHRoZSBET00gc291cmNlIHRvIGNyZWF0ZSB1cCBhbiBhcnJheSBvZiBoZWFkZXIgY2VsbHMuIFRoZSBpZGVhIGhlcmUgaXMgdG8KCQkgKiBjcmVhdGUgYSBsYXlvdXQgZ3JpZCAoYXJyYXkpIG9mIHJvd3MgeCBjb2x1bW5zLCB3aGljaCBjb250YWlucyBhIHJlZmVyZW5jZQoJCSAqIHRvIHRoZSBjZWxsIHRoYXQgdGhhdCBwb2ludCBpbiB0aGUgZ3JpZCAocmVnYXJkbGVzcyBvZiBjb2wvcm93c3BhbiksIHN1Y2ggdGhhdAoJCSAqIGFueSBjb2x1bW4gLyByb3cgY291bGQgYmUgcmVtb3ZlZCBhbmQgdGhlIG5ldyBncmlkIGNvbnN0cnVjdGVkCgkJICogIEBwYXJhbSBhcnJheSB7b2JqZWN0fSBhTGF5b3V0IEFycmF5IHRvIHN0b3JlIHRoZSBjYWxjdWxhdGVkIGxheW91dCBpbgoJCSAqICBAcGFyYW0ge25vZGV9IG5UaGVhZCBUaGUgaGVhZGVyL2Zvb3RlciBlbGVtZW50IGZvciB0aGUgdGFibGUKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuRGV0ZWN0SGVhZGVyICggYUxheW91dCwgblRoZWFkICkKCQl7CgkJCXZhciBuVHJzID0gJChuVGhlYWQpLmNoaWxkcmVuKCd0cicpOwoJCQl2YXIgbkNlbGw7CgkJCXZhciBpLCBqLCBrLCBsLCBpTGVuLCBqTGVuLCBpQ29sU2hpZnRlZDsKCQkJdmFyIGZuU2hpZnRDb2wgPSBmdW5jdGlvbiAoIGEsIGksIGogKSB7CgkJCQl3aGlsZSAoIGFbaV1bal0gKSB7CgkJCQkJaisrOwoJCQkJfQoJCQkJcmV0dXJuIGo7CgkJCX07CgkJCgkJCWFMYXlvdXQuc3BsaWNlKCAwLCBhTGF5b3V0Lmxlbmd0aCApOwoJCQkKCQkJLyogV2Uga25vdyBob3cgbWFueSByb3dzIHRoZXJlIGFyZSBpbiB0aGUgbGF5b3V0IC0gc28gcHJlcCBpdCAqLwoJCQlmb3IgKCBpPTAsIGlMZW49blRycy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlhTGF5b3V0LnB1c2goIFtdICk7CgkJCX0KCQkJCgkJCS8qIENhbGN1bGF0ZSBhIGxheW91dCBhcnJheSAqLwoJCQlmb3IgKCBpPTAsIGlMZW49blRycy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQl2YXIgaUNvbHVtbiA9IDA7CgkJCQkKCQkJCS8qIEZvciBldmVyeSBjZWxsIGluIHRoZSByb3cuLi4gKi8KCQkJCWZvciAoIGo9MCwgakxlbj1uVHJzW2ldLmNoaWxkTm9kZXMubGVuZ3RoIDsgajxqTGVuIDsgaisrICkKCQkJCXsKCQkJCQluQ2VsbCA9IG5UcnNbaV0uY2hpbGROb2Rlc1tqXTsKCQkKCQkJCQlpZiAoIG5DZWxsLm5vZGVOYW1lLnRvVXBwZXJDYXNlKCkgPT0gIlREIiB8fAoJCQkJCSAgICAgbkNlbGwubm9kZU5hbWUudG9VcHBlckNhc2UoKSA9PSAiVEgiICkKCQkJCQl7CgkJCQkJCS8qIEdldCB0aGUgY29sIGFuZCByb3dzcGFuIGF0dHJpYnV0ZXMgZnJvbSB0aGUgRE9NIGFuZCBzYW5pdGlzZSB0aGVtICovCgkJCQkJCXZhciBpQ29sc3BhbiA9IG5DZWxsLmdldEF0dHJpYnV0ZSgnY29sc3BhbicpICogMTsKCQkJCQkJdmFyIGlSb3dzcGFuID0gbkNlbGwuZ2V0QXR0cmlidXRlKCdyb3dzcGFuJykgKiAxOwoJCQkJCQlpQ29sc3BhbiA9ICghaUNvbHNwYW4gfHwgaUNvbHNwYW49PT0wIHx8IGlDb2xzcGFuPT09MSkgPyAxIDogaUNvbHNwYW47CgkJCQkJCWlSb3dzcGFuID0gKCFpUm93c3BhbiB8fCBpUm93c3Bhbj09PTAgfHwgaVJvd3NwYW49PT0xKSA/IDEgOiBpUm93c3BhbjsKCQkKCQkJCQkJLyogVGhlcmUgbWlnaHQgYmUgY29sc3BhbiBjZWxscyBhbHJlYWR5IGluIHRoaXMgcm93LCBzbyBzaGlmdCBvdXIgdGFyZ2V0IAoJCQkJCQkgKiBhY2NvcmRpbmdseQoJCQkJCQkgKi8KCQkJCQkJaUNvbFNoaWZ0ZWQgPSBmblNoaWZ0Q29sKCBhTGF5b3V0LCBpLCBpQ29sdW1uICk7CgkJCQkJCQoJCQkJCQkvKiBJZiB0aGVyZSBpcyBjb2wgLyByb3dzcGFuLCBjb3B5IHRoZSBpbmZvcm1hdGlvbiBpbnRvIHRoZSBsYXlvdXQgZ3JpZCAqLwoJCQkJCQlmb3IgKCBsPTAgOyBsPGlDb2xzcGFuIDsgbCsrICkKCQkJCQkJewoJCQkJCQkJZm9yICggaz0wIDsgazxpUm93c3BhbiA7IGsrKyApCgkJCQkJCQl7CgkJCQkJCQkJYUxheW91dFtpK2tdW2lDb2xTaGlmdGVkK2xdID0gewoJCQkJCQkJCQkiY2VsbCI6IG5DZWxsLAoJCQkJCQkJCQkidW5pcXVlIjogaUNvbHNwYW4gPT0gMSA/IHRydWUgOiBmYWxzZQoJCQkJCQkJCX07CgkJCQkJCQkJYUxheW91dFtpK2tdLm5UciA9IG5UcnNbaV07CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgkJCgkJCgkJLyoqCgkJICogR2V0IGFuIGFycmF5IG9mIHVuaXF1ZSB0aCBlbGVtZW50cywgb25lIGZvciBlYWNoIGNvbHVtbgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7bm9kZX0gbkhlYWRlciBhdXRvbWF0aWNhbGx5IGRldGVjdCB0aGUgbGF5b3V0IGZyb20gdGhpcyBub2RlIC0gb3B0aW9uYWwKCQkgKiAgQHBhcmFtIHthcnJheX0gYUxheW91dCB0aGVhZC90Zm9vdCBsYXlvdXQgZnJvbSBfZm5EZXRlY3RIZWFkZXIgLSBvcHRpb25hbAoJCSAqICBAcmV0dXJucyBhcnJheSB7bm9kZX0gYVJldHVybiBsaXN0IG9mIHVuaXF1ZSB0aHMKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuR2V0VW5pcXVlVGhzICggb1NldHRpbmdzLCBuSGVhZGVyLCBhTGF5b3V0ICkKCQl7CgkJCXZhciBhUmV0dXJuID0gW107CgkJCWlmICggIWFMYXlvdXQgKQoJCQl7CgkJCQlhTGF5b3V0ID0gb1NldHRpbmdzLmFvSGVhZGVyOwoJCQkJaWYgKCBuSGVhZGVyICkKCQkJCXsKCQkJCQlhTGF5b3V0ID0gW107CgkJCQkJX2ZuRGV0ZWN0SGVhZGVyKCBhTGF5b3V0LCBuSGVhZGVyICk7CgkJCQl9CgkJCX0KCQkKCQkJZm9yICggdmFyIGk9MCwgaUxlbj1hTGF5b3V0Lmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWZvciAoIHZhciBqPTAsIGpMZW49YUxheW91dFtpXS5sZW5ndGggOyBqPGpMZW4gOyBqKysgKQoJCQkJewoJCQkJCWlmICggYUxheW91dFtpXVtqXS51bmlxdWUgJiYgCgkJCQkJCSAoIWFSZXR1cm5bal0gfHwgIW9TZXR0aW5ncy5iU29ydENlbGxzVG9wKSApCgkJCQkJewoJCQkJCQlhUmV0dXJuW2pdID0gYUxheW91dFtpXVtqXS5jZWxsOwoJCQkJCX0KCQkJCX0KCQkJfQoJCQkKCQkJcmV0dXJuIGFSZXR1cm47CgkJfQoJCQoJCQoJCQoJCS8qKgoJCSAqIFVwZGF0ZSB0aGUgdGFibGUgdXNpbmcgYW4gQWpheCBjYWxsCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHJldHVybnMge2Jvb2xlYW59IEJsb2NrIHRoZSB0YWJsZSBkcmF3aW5nIG9yIG5vdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5BamF4VXBkYXRlKCBvU2V0dGluZ3MgKQoJCXsKCQkJaWYgKCBvU2V0dGluZ3MuYkFqYXhEYXRhR2V0ICkKCQkJewoJCQkJb1NldHRpbmdzLmlEcmF3Kys7CgkJCQlfZm5Qcm9jZXNzaW5nRGlzcGxheSggb1NldHRpbmdzLCB0cnVlICk7CgkJCQl2YXIgaUNvbHVtbnMgPSBvU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aDsKCQkJCXZhciBhb0RhdGEgPSBfZm5BamF4UGFyYW1ldGVycyggb1NldHRpbmdzICk7CgkJCQlfZm5TZXJ2ZXJQYXJhbXMoIG9TZXR0aW5ncywgYW9EYXRhICk7CgkJCQkKCQkJCW9TZXR0aW5ncy5mblNlcnZlckRhdGEuY2FsbCggb1NldHRpbmdzLm9JbnN0YW5jZSwgb1NldHRpbmdzLnNBamF4U291cmNlLCBhb0RhdGEsCgkJCQkJZnVuY3Rpb24oanNvbikgewoJCQkJCQlfZm5BamF4VXBkYXRlRHJhdyggb1NldHRpbmdzLCBqc29uICk7CgkJCQkJfSwgb1NldHRpbmdzICk7CgkJCQlyZXR1cm4gZmFsc2U7CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQlyZXR1cm4gdHJ1ZTsKCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBCdWlsZCB1cCB0aGUgcGFyYW1ldGVycyBpbiBhbiBvYmplY3QgbmVlZGVkIGZvciBhIHNlcnZlci1zaWRlIHByb2Nlc3NpbmcgcmVxdWVzdAoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEByZXR1cm5zIHtib29sfSBibG9jayB0aGUgdGFibGUgZHJhd2luZyBvciBub3QKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuQWpheFBhcmFtZXRlcnMoIG9TZXR0aW5ncyApCgkJewoJCQl2YXIgaUNvbHVtbnMgPSBvU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aDsKCQkJdmFyIGFvRGF0YSA9IFtdLCBtRGF0YVByb3AsIGFhU29ydCwgYURhdGFTb3J0OwoJCQl2YXIgaSwgajsKCQkJCgkJCWFvRGF0YS5wdXNoKCB7ICJuYW1lIjogInNFY2hvIiwgICAgICAgICAgInZhbHVlIjogb1NldHRpbmdzLmlEcmF3IH0gKTsKCQkJYW9EYXRhLnB1c2goIHsgIm5hbWUiOiAiaUNvbHVtbnMiLCAgICAgICAidmFsdWUiOiBpQ29sdW1ucyB9ICk7CgkJCWFvRGF0YS5wdXNoKCB7ICJuYW1lIjogInNDb2x1bW5zIiwgICAgICAgInZhbHVlIjogX2ZuQ29sdW1uT3JkZXJpbmcob1NldHRpbmdzKSB9ICk7CgkJCWFvRGF0YS5wdXNoKCB7ICJuYW1lIjogImlEaXNwbGF5U3RhcnQiLCAgInZhbHVlIjogb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0IH0gKTsKCQkJYW9EYXRhLnB1c2goIHsgIm5hbWUiOiAiaURpc3BsYXlMZW5ndGgiLCAidmFsdWUiOiBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJQYWdpbmF0ZSAhPT0gZmFsc2UgPwoJCQkJb1NldHRpbmdzLl9pRGlzcGxheUxlbmd0aCA6IC0xIH0gKTsKCQkJCQoJCQlmb3IgKCBpPTAgOyBpPGlDb2x1bW5zIDsgaSsrICkKCQkJewoJCQkgIG1EYXRhUHJvcCA9IG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0ubURhdGFQcm9wOwoJCQkJYW9EYXRhLnB1c2goIHsgIm5hbWUiOiAibURhdGFQcm9wXyIraSwgInZhbHVlIjogdHlwZW9mKG1EYXRhUHJvcCk9PT0iZnVuY3Rpb24iID8gJ2Z1bmN0aW9uJyA6IG1EYXRhUHJvcCB9ICk7CgkJCX0KCQkJCgkJCS8qIEZpbHRlcmluZyAqLwoJCQlpZiAoIG9TZXR0aW5ncy5vRmVhdHVyZXMuYkZpbHRlciAhPT0gZmFsc2UgKQoJCQl7CgkJCQlhb0RhdGEucHVzaCggeyAibmFtZSI6ICJzU2VhcmNoIiwgInZhbHVlIjogb1NldHRpbmdzLm9QcmV2aW91c1NlYXJjaC5zU2VhcmNoIH0gKTsKCQkJCWFvRGF0YS5wdXNoKCB7ICJuYW1lIjogImJSZWdleCIsICAidmFsdWUiOiBvU2V0dGluZ3Mub1ByZXZpb3VzU2VhcmNoLmJSZWdleCB9ICk7CgkJCQlmb3IgKCBpPTAgOyBpPGlDb2x1bW5zIDsgaSsrICkKCQkJCXsKCQkJCQlhb0RhdGEucHVzaCggeyAibmFtZSI6ICJzU2VhcmNoXyIraSwgICAgICJ2YWx1ZSI6IG9TZXR0aW5ncy5hb1ByZVNlYXJjaENvbHNbaV0uc1NlYXJjaCB9ICk7CgkJCQkJYW9EYXRhLnB1c2goIHsgIm5hbWUiOiAiYlJlZ2V4XyIraSwgICAgICAidmFsdWUiOiBvU2V0dGluZ3MuYW9QcmVTZWFyY2hDb2xzW2ldLmJSZWdleCB9ICk7CgkJCQkJYW9EYXRhLnB1c2goIHsgIm5hbWUiOiAiYlNlYXJjaGFibGVfIitpLCAidmFsdWUiOiBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLmJTZWFyY2hhYmxlIH0gKTsKCQkJCX0KCQkJfQoJCQkKCQkJLyogU29ydGluZyAqLwoJCQlpZiAoIG9TZXR0aW5ncy5vRmVhdHVyZXMuYlNvcnQgIT09IGZhbHNlICkKCQkJewoJCQkJdmFyIGlDb3VudGVyID0gMDsKCQkKCQkJCWFhU29ydCA9ICggb1NldHRpbmdzLmFhU29ydGluZ0ZpeGVkICE9PSBudWxsICkgPwoJCQkJCW9TZXR0aW5ncy5hYVNvcnRpbmdGaXhlZC5jb25jYXQoIG9TZXR0aW5ncy5hYVNvcnRpbmcgKSA6CgkJCQkJb1NldHRpbmdzLmFhU29ydGluZy5zbGljZSgpOwoJCQkJCgkJCQlmb3IgKCBpPTAgOyBpPGFhU29ydC5sZW5ndGggOyBpKysgKQoJCQkJewoJCQkJCWFEYXRhU29ydCA9IG9TZXR0aW5ncy5hb0NvbHVtbnNbIGFhU29ydFtpXVswXSBdLmFEYXRhU29ydDsKCQkJCQkKCQkJCQlmb3IgKCBqPTAgOyBqPGFEYXRhU29ydC5sZW5ndGggOyBqKysgKQoJCQkJCXsKCQkJCQkJYW9EYXRhLnB1c2goIHsgIm5hbWUiOiAiaVNvcnRDb2xfIitpQ291bnRlciwgICJ2YWx1ZSI6IGFEYXRhU29ydFtqXSB9ICk7CgkJCQkJCWFvRGF0YS5wdXNoKCB7ICJuYW1lIjogInNTb3J0RGlyXyIraUNvdW50ZXIsICAidmFsdWUiOiBhYVNvcnRbaV1bMV0gfSApOwoJCQkJCQlpQ291bnRlcisrOwoJCQkJCX0KCQkJCX0KCQkJCWFvRGF0YS5wdXNoKCB7ICJuYW1lIjogImlTb3J0aW5nQ29scyIsICAgInZhbHVlIjogaUNvdW50ZXIgfSApOwoJCQkJCgkJCQlmb3IgKCBpPTAgOyBpPGlDb2x1bW5zIDsgaSsrICkKCQkJCXsKCQkJCQlhb0RhdGEucHVzaCggeyAibmFtZSI6ICJiU29ydGFibGVfIitpLCAgInZhbHVlIjogb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5iU29ydGFibGUgfSApOwoJCQkJfQoJCQl9CgkJCQoJCQlyZXR1cm4gYW9EYXRhOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBBZGQgQWpheCBwYXJhbWV0ZXJzIGZyb20gcGx1Z2lucwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSBhcnJheSB7b2JqZWN0c30gYW9EYXRhIG5hbWUvdmFsdWUgcGFpcnMgdG8gc2VuZCB0byB0aGUgc2VydmVyCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblNlcnZlclBhcmFtcyggb1NldHRpbmdzLCBhb0RhdGEgKQoJCXsKCQkJX2ZuQ2FsbGJhY2tGaXJlKCBvU2V0dGluZ3MsICdhb1NlcnZlclBhcmFtcycsICdzZXJ2ZXJQYXJhbXMnLCBbYW9EYXRhXSApOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBEYXRhIHRoZSBkYXRhIGZyb20gdGhlIHNlcnZlciAobnVraW5nIHRoZSBvbGQpIGFuZCByZWRyYXcgdGhlIHRhYmxlCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtvYmplY3R9IGpzb24ganNvbiBkYXRhIHJldHVybiBmcm9tIHRoZSBzZXJ2ZXIuCgkJICogIEBwYXJhbSB7c3RyaW5nfSBqc29uLnNFY2hvIFRyYWNraW5nIGZsYWcgZm9yIERhdGFUYWJsZXMgdG8gbWF0Y2ggcmVxdWVzdHMKCQkgKiAgQHBhcmFtIHtpbnR9IGpzb24uaVRvdGFsUmVjb3JkcyBOdW1iZXIgb2YgcmVjb3JkcyBpbiB0aGUgZGF0YSBzZXQsIG5vdCBhY2NvdW50aW5nIGZvciBmaWx0ZXJpbmcKCQkgKiAgQHBhcmFtIHtpbnR9IGpzb24uaVRvdGFsRGlzcGxheVJlY29yZHMgTnVtYmVyIG9mIHJlY29yZHMgaW4gdGhlIGRhdGEgc2V0LCBhY2NvdW50aW5nIGZvciBmaWx0ZXJpbmcKCQkgKiAgQHBhcmFtIHthcnJheX0ganNvbi5hYURhdGEgVGhlIGRhdGEgdG8gZGlzcGxheSBvbiB0aGlzIHBhZ2UKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IFtqc29uLnNDb2x1bW5zXSBDb2x1bW4gb3JkZXJpbmcgKHNOYW1lLCBjb21tYSBzZXBhcmF0ZWQpCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkFqYXhVcGRhdGVEcmF3ICggb1NldHRpbmdzLCBqc29uICkKCQl7CgkJCWlmICgganNvbi5zRWNobyAhPT0gdW5kZWZpbmVkICkKCQkJewoJCQkJLyogUHJvdGVjdCBhZ2FpbnN0IG9sZCByZXR1cm5zIG92ZXItd3JpdGluZyBhIG5ldyBvbmUuIFBvc3NpYmxlIHdoZW4geW91IGdldAoJCQkJICogdmVyeSBmYXN0IGludGVyYWN0aW9uLCBhbmQgbGF0ZXIgcXVlaXJlcyBhcmUgY29tcGxldGVkIG11Y2ggZmFzdGVyCgkJCQkgKi8KCQkJCWlmICgganNvbi5zRWNobyoxIDwgb1NldHRpbmdzLmlEcmF3ICkKCQkJCXsKCQkJCQlyZXR1cm47CgkJCQl9CgkJCQllbHNlCgkJCQl7CgkJCQkJb1NldHRpbmdzLmlEcmF3ID0ganNvbi5zRWNobyAqIDE7CgkJCQl9CgkJCX0KCQkJCgkJCWlmICggIW9TZXR0aW5ncy5vU2Nyb2xsLmJJbmZpbml0ZSB8fAoJCQkJICAgKG9TZXR0aW5ncy5vU2Nyb2xsLmJJbmZpbml0ZSAmJiAob1NldHRpbmdzLmJTb3J0ZWQgfHwgb1NldHRpbmdzLmJGaWx0ZXJlZCkpICkKCQkJewoJCQkJX2ZuQ2xlYXJUYWJsZSggb1NldHRpbmdzICk7CgkJCX0KCQkJb1NldHRpbmdzLl9pUmVjb3Jkc1RvdGFsID0gcGFyc2VJbnQoanNvbi5pVG90YWxSZWNvcmRzLCAxMCk7CgkJCW9TZXR0aW5ncy5faVJlY29yZHNEaXNwbGF5ID0gcGFyc2VJbnQoanNvbi5pVG90YWxEaXNwbGF5UmVjb3JkcywgMTApOwoJCQkKCQkJLyogRGV0ZXJtaW5lIGlmIHJlb3JkZXJpbmcgaXMgcmVxdWlyZWQgKi8KCQkJdmFyIHNPcmRlcmluZyA9IF9mbkNvbHVtbk9yZGVyaW5nKG9TZXR0aW5ncyk7CgkJCXZhciBiUmVPcmRlciA9IChqc29uLnNDb2x1bW5zICE9PSB1bmRlZmluZWQgJiYgc09yZGVyaW5nICE9PSAiIiAmJiBqc29uLnNDb2x1bW5zICE9IHNPcmRlcmluZyApOwoJCQl2YXIgYWlJbmRleDsKCQkJaWYgKCBiUmVPcmRlciApCgkJCXsKCQkJCWFpSW5kZXggPSBfZm5SZU9yZGVySW5kZXgoIG9TZXR0aW5ncywganNvbi5zQ29sdW1ucyApOwoJCQl9CgkJCQoJCQl2YXIgYURhdGEgPSBfZm5HZXRPYmplY3REYXRhRm4oIG9TZXR0aW5ncy5zQWpheERhdGFQcm9wICkoIGpzb24gKTsKCQkJZm9yICggdmFyIGk9MCwgaUxlbj1hRGF0YS5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlpZiAoIGJSZU9yZGVyICkKCQkJCXsKCQkJCQkvKiBJZiB3ZSBuZWVkIHRvIHJlLW9yZGVyLCB0aGVuIGNyZWF0ZSBhIG5ldyBhcnJheSB3aXRoIHRoZSBjb3JyZWN0IG9yZGVyIGFuZCBhZGQgaXQgKi8KCQkJCQl2YXIgYURhdGFTb3J0ZWQgPSBbXTsKCQkJCQlmb3IgKCB2YXIgaj0wLCBqTGVuPW9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgajxqTGVuIDsgaisrICkKCQkJCQl7CgkJCQkJCWFEYXRhU29ydGVkLnB1c2goIGFEYXRhW2ldWyBhaUluZGV4W2pdIF0gKTsKCQkJCQl9CgkJCQkJX2ZuQWRkRGF0YSggb1NldHRpbmdzLCBhRGF0YVNvcnRlZCApOwoJCQkJfQoJCQkJZWxzZQoJCQkJewoJCQkJCS8qIE5vIHJlLW9yZGVyIHJlcXVpcmVkLCBzZXZlciBnb3QgaXQgInJpZ2h0IiAtIGp1c3Qgc3RyYWlnaHQgYWRkICovCgkJCQkJX2ZuQWRkRGF0YSggb1NldHRpbmdzLCBhRGF0YVtpXSApOwoJCQkJfQoJCQl9CgkJCW9TZXR0aW5ncy5haURpc3BsYXkgPSBvU2V0dGluZ3MuYWlEaXNwbGF5TWFzdGVyLnNsaWNlKCk7CgkJCQoJCQlvU2V0dGluZ3MuYkFqYXhEYXRhR2V0ID0gZmFsc2U7CgkJCV9mbkRyYXcoIG9TZXR0aW5ncyApOwoJCQlvU2V0dGluZ3MuYkFqYXhEYXRhR2V0ID0gdHJ1ZTsKCQkJX2ZuUHJvY2Vzc2luZ0Rpc3BsYXkoIG9TZXR0aW5ncywgZmFsc2UgKTsKCQl9CgkJCgkJCgkJCgkJLyoqCgkJICogR2VuZXJhdGUgdGhlIG5vZGUgcmVxdWlyZWQgZm9yIGZpbHRlcmluZyB0ZXh0CgkJICogIEByZXR1cm5zIHtub2RlfSBGaWx0ZXIgY29udHJvbCBlbGVtZW50CgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuRmVhdHVyZUh0bWxGaWx0ZXIgKCBvU2V0dGluZ3MgKQoJCXsKCQkJdmFyIG9QcmV2aW91c1NlYXJjaCA9IG9TZXR0aW5ncy5vUHJldmlvdXNTZWFyY2g7CgkJCQoJCQl2YXIgc1NlYXJjaFN0ciA9IG9TZXR0aW5ncy5vTGFuZ3VhZ2Uuc1NlYXJjaDsKCQkJc1NlYXJjaFN0ciA9IChzU2VhcmNoU3RyLmluZGV4T2YoJ19JTlBVVF8nKSAhPT0gLTEpID8KCQkJICBzU2VhcmNoU3RyLnJlcGxhY2UoJ19JTlBVVF8nLCAnPGlucHV0IHR5cGU9InRleHQiIC8+JykgOgoJCQkgIHNTZWFyY2hTdHI9PT0iIiA/ICc8aW5wdXQgdHlwZT0idGV4dCIgLz4nIDogc1NlYXJjaFN0cisnIDxpbnB1dCB0eXBlPSJ0ZXh0IiAvPic7CgkJCQoJCQl2YXIgbkZpbHRlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdkaXYnICk7CgkJCW5GaWx0ZXIuY2xhc3NOYW1lID0gb1NldHRpbmdzLm9DbGFzc2VzLnNGaWx0ZXI7CgkJCW5GaWx0ZXIuaW5uZXJIVE1MID0gJzxsYWJlbD4nK3NTZWFyY2hTdHIrJzwvbGFiZWw+JzsKCQkJaWYgKCAhb1NldHRpbmdzLmFhbkZlYXR1cmVzLmYgKQoJCQl7CgkJCQluRmlsdGVyLmlkID0gb1NldHRpbmdzLnNUYWJsZUlkKydfZmlsdGVyJzsKCQkJfQoJCQkKCQkJdmFyIGpxRmlsdGVyID0gJCgnaW5wdXRbdHlwZT0idGV4dCJdJywgbkZpbHRlcik7CgkJCgkJCS8vIFN0b3JlIGEgcmVmZXJlbmNlIHRvIHRoZSBpbnB1dCBlbGVtZW50LCBzbyBvdGhlciBpbnB1dCBlbGVtZW50cyBjb3VsZCBiZQoJCQkvLyBhZGRlZCB0byB0aGUgZmlsdGVyIHdyYXBwZXIgaWYgbmVlZGVkIChzdWJtaXQgYnV0dG9uIGZvciBleGFtcGxlKQoJCQluRmlsdGVyLl9EVF9JbnB1dCA9IGpxRmlsdGVyWzBdOwoJCQoJCQlqcUZpbHRlci52YWwoIG9QcmV2aW91c1NlYXJjaC5zU2VhcmNoLnJlcGxhY2UoJyInLCcmcXVvdDsnKSApOwoJCQlqcUZpbHRlci5iaW5kKCAna2V5dXAuRFQnLCBmdW5jdGlvbihlKSB7CgkJCQkvKiBVcGRhdGUgYWxsIG90aGVyIGZpbHRlciBpbnB1dCBlbGVtZW50cyBmb3IgdGhlIG5ldyBkaXNwbGF5ICovCgkJCQl2YXIgbiA9IG9TZXR0aW5ncy5hYW5GZWF0dXJlcy5mOwoJCQkJdmFyIHZhbCA9IHRoaXMudmFsdWU9PT0iIiA/ICIiIDogdGhpcy52YWx1ZTsgLy8gbWVudGFsIElFOCBmaXggOi0oCgkJCgkJCQlmb3IgKCB2YXIgaT0wLCBpTGVuPW4ubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQlpZiAoIG5baV0gIT0gJCh0aGlzKS5wYXJlbnRzKCdkaXYuZGF0YVRhYmxlc19maWx0ZXInKVswXSApCgkJCQkJewoJCQkJCQkkKG5baV0uX0RUX0lucHV0KS52YWwoIHZhbCApOwoJCQkJCX0KCQkJCX0KCQkJCQoJCQkJLyogTm93IGRvIHRoZSBmaWx0ZXIgKi8KCQkJCWlmICggdmFsICE9IG9QcmV2aW91c1NlYXJjaC5zU2VhcmNoICkKCQkJCXsKCQkJCQlfZm5GaWx0ZXJDb21wbGV0ZSggb1NldHRpbmdzLCB7IAoJCQkJCQkic1NlYXJjaCI6IHZhbCwgCgkJCQkJCSJiUmVnZXgiOiBvUHJldmlvdXNTZWFyY2guYlJlZ2V4LAoJCQkJCQkiYlNtYXJ0Ijogb1ByZXZpb3VzU2VhcmNoLmJTbWFydCAsCgkJCQkJCSJiQ2FzZUluc2Vuc2l0aXZlIjogb1ByZXZpb3VzU2VhcmNoLmJDYXNlSW5zZW5zaXRpdmUgCgkJCQkJfSApOwoJCQkJfQoJCQl9ICk7CgkJCgkJCWpxRmlsdGVyCgkJCQkuYXR0cignYXJpYS1jb250cm9scycsIG9TZXR0aW5ncy5zVGFibGVJZCkKCQkJCS5iaW5kKCAna2V5cHJlc3MuRFQnLCBmdW5jdGlvbihlKSB7CgkJCQkJLyogUHJldmVudCBmb3JtIHN1Ym1pc3Npb24gKi8KCQkJCQlpZiAoIGUua2V5Q29kZSA9PSAxMyApCgkJCQkJewoJCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQkJfQoJCQkJfQoJCQkpOwoJCQkKCQkJcmV0dXJuIG5GaWx0ZXI7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEZpbHRlciB0aGUgdGFibGUgdXNpbmcgYm90aCB0aGUgZ2xvYmFsIGZpbHRlciBhbmQgY29sdW1uIGJhc2VkIGZpbHRlcmluZwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2VhcmNoIHNlYXJjaCBpbmZvcm1hdGlvbgoJCSAqICBAcGFyYW0ge2ludH0gW2lGb3JjZV0gZm9yY2UgYSByZXNlYXJjaCBvZiB0aGUgbWFzdGVyIGFycmF5ICgxKSBvciBub3QgKHVuZGVmaW5lZCBvciAwKQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5GaWx0ZXJDb21wbGV0ZSAoIG9TZXR0aW5ncywgb0lucHV0LCBpRm9yY2UgKQoJCXsKCQkJdmFyIG9QcmV2U2VhcmNoID0gb1NldHRpbmdzLm9QcmV2aW91c1NlYXJjaDsKCQkJdmFyIGFvUHJldlNlYXJjaCA9IG9TZXR0aW5ncy5hb1ByZVNlYXJjaENvbHM7CgkJCXZhciBmblNhdmVGaWx0ZXIgPSBmdW5jdGlvbiAoIG9GaWx0ZXIgKSB7CgkJCQkvKiBTYXZlIHRoZSBmaWx0ZXJpbmcgdmFsdWVzICovCgkJCQlvUHJldlNlYXJjaC5zU2VhcmNoID0gb0ZpbHRlci5zU2VhcmNoOwoJCQkJb1ByZXZTZWFyY2guYlJlZ2V4ID0gb0ZpbHRlci5iUmVnZXg7CgkJCQlvUHJldlNlYXJjaC5iU21hcnQgPSBvRmlsdGVyLmJTbWFydDsKCQkJCW9QcmV2U2VhcmNoLmJDYXNlSW5zZW5zaXRpdmUgPSBvRmlsdGVyLmJDYXNlSW5zZW5zaXRpdmU7CgkJCX07CgkJCgkJCS8qIEluIHNlcnZlci1zaWRlIHByb2Nlc3NpbmcgYWxsIGZpbHRlcmluZyBpcyBkb25lIGJ5IHRoZSBzZXJ2ZXIsIHNvIG5vIHBvaW50IGhhbmdpbmcgYXJvdW5kIGhlcmUgKi8KCQkJaWYgKCAhb1NldHRpbmdzLm9GZWF0dXJlcy5iU2VydmVyU2lkZSApCgkJCXsKCQkJCS8qIEdsb2JhbCBmaWx0ZXIgKi8KCQkJCV9mbkZpbHRlciggb1NldHRpbmdzLCBvSW5wdXQuc1NlYXJjaCwgaUZvcmNlLCBvSW5wdXQuYlJlZ2V4LCBvSW5wdXQuYlNtYXJ0LCBvSW5wdXQuYkNhc2VJbnNlbnNpdGl2ZSApOwoJCQkJZm5TYXZlRmlsdGVyKCBvSW5wdXQgKTsKCQkKCQkJCS8qIE5vdyBkbyB0aGUgaW5kaXZpZHVhbCBjb2x1bW4gZmlsdGVyICovCgkJCQlmb3IgKCB2YXIgaT0wIDsgaTxvU2V0dGluZ3MuYW9QcmVTZWFyY2hDb2xzLmxlbmd0aCA7IGkrKyApCgkJCQl7CgkJCQkJX2ZuRmlsdGVyQ29sdW1uKCBvU2V0dGluZ3MsIGFvUHJldlNlYXJjaFtpXS5zU2VhcmNoLCBpLCBhb1ByZXZTZWFyY2hbaV0uYlJlZ2V4LCAKCQkJCQkJYW9QcmV2U2VhcmNoW2ldLmJTbWFydCwgYW9QcmV2U2VhcmNoW2ldLmJDYXNlSW5zZW5zaXRpdmUgKTsKCQkJCX0KCQkJCQoJCQkJLyogQ3VzdG9tIGZpbHRlcmluZyAqLwoJCQkJX2ZuRmlsdGVyQ3VzdG9tKCBvU2V0dGluZ3MgKTsKCQkJfQoJCQllbHNlCgkJCXsKCQkJCWZuU2F2ZUZpbHRlciggb0lucHV0ICk7CgkJCX0KCQkJCgkJCS8qIFRlbGwgdGhlIGRyYXcgZnVuY3Rpb24gd2UgaGF2ZSBiZWVuIGZpbHRlcmluZyAqLwoJCQlvU2V0dGluZ3MuYkZpbHRlcmVkID0gdHJ1ZTsKCQkJJChvU2V0dGluZ3Mub0luc3RhbmNlKS50cmlnZ2VyKCdmaWx0ZXInLCBvU2V0dGluZ3MpOwoJCQkKCQkJLyogUmVkcmF3IHRoZSB0YWJsZSAqLwoJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSAwOwoJCQlfZm5DYWxjdWxhdGVFbmQoIG9TZXR0aW5ncyApOwoJCQlfZm5EcmF3KCBvU2V0dGluZ3MgKTsKCQkJCgkJCS8qIFJlYnVpbGQgc2VhcmNoIGFycmF5ICdvZmZsaW5lJyAqLwoJCQlfZm5CdWlsZFNlYXJjaEFycmF5KCBvU2V0dGluZ3MsIDAgKTsKCQl9CgkJCgkJCgkJLyoqCgkJICogQXBwbHkgY3VzdG9tIGZpbHRlcmluZyBmdW5jdGlvbnMKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5GaWx0ZXJDdXN0b20oIG9TZXR0aW5ncyApCgkJewoJCQl2YXIgYWZuRmlsdGVycyA9IERhdGFUYWJsZS5leHQuYWZuRmlsdGVyaW5nOwoJCQlmb3IgKCB2YXIgaT0wLCBpTGVuPWFmbkZpbHRlcnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJdmFyIGlDb3JyZWN0b3IgPSAwOwoJCQkJZm9yICggdmFyIGo9MCwgakxlbj1vU2V0dGluZ3MuYWlEaXNwbGF5Lmxlbmd0aCA7IGo8akxlbiA7IGorKyApCgkJCQl7CgkJCQkJdmFyIGlEaXNJbmRleCA9IG9TZXR0aW5ncy5haURpc3BsYXlbai1pQ29ycmVjdG9yXTsKCQkJCQkKCQkJCQkvKiBDaGVjayBpZiB3ZSBzaG91bGQgdXNlIHRoaXMgcm93IGJhc2VkIG9uIHRoZSBmaWx0ZXJpbmcgZnVuY3Rpb24gKi8KCQkJCQlpZiAoICFhZm5GaWx0ZXJzW2ldKCBvU2V0dGluZ3MsIF9mbkdldFJvd0RhdGEoIG9TZXR0aW5ncywgaURpc0luZGV4LCAnZmlsdGVyJyApLCBpRGlzSW5kZXggKSApCgkJCQkJewoJCQkJCQlvU2V0dGluZ3MuYWlEaXNwbGF5LnNwbGljZSggai1pQ29ycmVjdG9yLCAxICk7CgkJCQkJCWlDb3JyZWN0b3IrKzsKCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgkJCgkJCgkJLyoqCgkJICogRmlsdGVyIHRoZSB0YWJsZSBvbiBhIHBlci1jb2x1bW4gYmFzaXMKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge3N0cmluZ30gc0lucHV0IHN0cmluZyB0byBmaWx0ZXIgb24KCQkgKiAgQHBhcmFtIHtpbnR9IGlDb2x1bW4gY29sdW1uIHRvIGZpbHRlcgoJCSAqICBAcGFyYW0ge2Jvb2x9IGJSZWdleCB0cmVhdCBzZWFyY2ggc3RyaW5nIGFzIGEgcmVndWxhciBleHByZXNzaW9uIG9yIG5vdAoJCSAqICBAcGFyYW0ge2Jvb2x9IGJTbWFydCB1c2Ugc21hcnQgZmlsdGVyaW5nIG9yIG5vdAoJCSAqICBAcGFyYW0ge2Jvb2x9IGJDYXNlSW5zZW5zaXRpdmUgRG8gY2FzZSBpbnNlbnN0aXZlIG1hdGNoaW5nIG9yIG5vdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5GaWx0ZXJDb2x1bW4gKCBvU2V0dGluZ3MsIHNJbnB1dCwgaUNvbHVtbiwgYlJlZ2V4LCBiU21hcnQsIGJDYXNlSW5zZW5zaXRpdmUgKQoJCXsKCQkJaWYgKCBzSW5wdXQgPT09ICIiICkKCQkJewoJCQkJcmV0dXJuOwoJCQl9CgkJCQoJCQl2YXIgaUluZGV4Q29ycmVjdG9yID0gMDsKCQkJdmFyIHJwU2VhcmNoID0gX2ZuRmlsdGVyQ3JlYXRlU2VhcmNoKCBzSW5wdXQsIGJSZWdleCwgYlNtYXJ0LCBiQ2FzZUluc2Vuc2l0aXZlICk7CgkJCQoJCQlmb3IgKCB2YXIgaT1vU2V0dGluZ3MuYWlEaXNwbGF5Lmxlbmd0aC0xIDsgaT49MCA7IGktLSApCgkJCXsKCQkJCXZhciBzRGF0YSA9IF9mbkRhdGFUb1NlYXJjaCggX2ZuR2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgb1NldHRpbmdzLmFpRGlzcGxheVtpXSwgaUNvbHVtbiwgJ2ZpbHRlcicgKSwKCQkJCQlvU2V0dGluZ3MuYW9Db2x1bW5zW2lDb2x1bW5dLnNUeXBlICk7CgkJCQlpZiAoICEgcnBTZWFyY2gudGVzdCggc0RhdGEgKSApCgkJCQl7CgkJCQkJb1NldHRpbmdzLmFpRGlzcGxheS5zcGxpY2UoIGksIDEgKTsKCQkJCQlpSW5kZXhDb3JyZWN0b3IrKzsKCQkJCX0KCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBGaWx0ZXIgdGhlIGRhdGEgdGFibGUgYmFzZWQgb24gdXNlciBpbnB1dCBhbmQgZHJhdyB0aGUgdGFibGUKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge3N0cmluZ30gc0lucHV0IHN0cmluZyB0byBmaWx0ZXIgb24KCQkgKiAgQHBhcmFtIHtpbnR9IGlGb3JjZSBvcHRpb25hbCAtIGZvcmNlIGEgcmVzZWFyY2ggb2YgdGhlIG1hc3RlciBhcnJheSAoMSkgb3Igbm90ICh1bmRlZmluZWQgb3IgMCkKCQkgKiAgQHBhcmFtIHtib29sfSBiUmVnZXggdHJlYXQgYXMgYSByZWd1bGFyIGV4cHJlc3Npb24gb3Igbm90CgkJICogIEBwYXJhbSB7Ym9vbH0gYlNtYXJ0IHBlcmZvcm0gc21hcnQgZmlsdGVyaW5nIG9yIG5vdAoJCSAqICBAcGFyYW0ge2Jvb2x9IGJDYXNlSW5zZW5zaXRpdmUgRG8gY2FzZSBpbnNlbnN0aXZlIG1hdGNoaW5nIG9yIG5vdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5GaWx0ZXIoIG9TZXR0aW5ncywgc0lucHV0LCBpRm9yY2UsIGJSZWdleCwgYlNtYXJ0LCBiQ2FzZUluc2Vuc2l0aXZlICkKCQl7CgkJCXZhciBpOwoJCQl2YXIgcnBTZWFyY2ggPSBfZm5GaWx0ZXJDcmVhdGVTZWFyY2goIHNJbnB1dCwgYlJlZ2V4LCBiU21hcnQsIGJDYXNlSW5zZW5zaXRpdmUgKTsKCQkJdmFyIG9QcmV2U2VhcmNoID0gb1NldHRpbmdzLm9QcmV2aW91c1NlYXJjaDsKCQkJCgkJCS8qIENoZWNrIGlmIHdlIGFyZSBmb3JjaW5nIG9yIG5vdCAtIG9wdGlvbmFsIHBhcmFtZXRlciAqLwoJCQlpZiAoICFpRm9yY2UgKQoJCQl7CgkJCQlpRm9yY2UgPSAwOwoJCQl9CgkJCQoJCQkvKiBOZWVkIHRvIHRha2UgYWNjb3VudCBvZiBjdXN0b20gZmlsdGVyaW5nIGZ1bmN0aW9ucyAtIGFsd2F5cyBmaWx0ZXIgKi8KCQkJaWYgKCBEYXRhVGFibGUuZXh0LmFmbkZpbHRlcmluZy5sZW5ndGggIT09IDAgKQoJCQl7CgkJCQlpRm9yY2UgPSAxOwoJCQl9CgkJCQoJCQkvKgoJCQkgKiBJZiB0aGUgaW5wdXQgaXMgYmxhbmsgLSB3ZSB3YW50IHRoZSBmdWxsIGRhdGEgc2V0CgkJCSAqLwoJCQlpZiAoIHNJbnB1dC5sZW5ndGggPD0gMCApCgkJCXsKCQkJCW9TZXR0aW5ncy5haURpc3BsYXkuc3BsaWNlKCAwLCBvU2V0dGluZ3MuYWlEaXNwbGF5Lmxlbmd0aCk7CgkJCQlvU2V0dGluZ3MuYWlEaXNwbGF5ID0gb1NldHRpbmdzLmFpRGlzcGxheU1hc3Rlci5zbGljZSgpOwoJCQl9CgkJCWVsc2UKCQkJewoJCQkJLyoKCQkJCSAqIFdlIGFyZSBzdGFydGluZyBhIG5ldyBzZWFyY2ggb3IgdGhlIG5ldyBzZWFyY2ggc3RyaW5nIGlzIHNtYWxsZXIgCgkJCQkgKiB0aGVuIHRoZSBvbGQgb25lIChpLmUuIGRlbGV0ZSkuIFNlYXJjaCBmcm9tIHRoZSBtYXN0ZXIgYXJyYXkKCQkJIAkgKi8KCQkJCWlmICggb1NldHRpbmdzLmFpRGlzcGxheS5sZW5ndGggPT0gb1NldHRpbmdzLmFpRGlzcGxheU1hc3Rlci5sZW5ndGggfHwKCQkJCQkgICBvUHJldlNlYXJjaC5zU2VhcmNoLmxlbmd0aCA+IHNJbnB1dC5sZW5ndGggfHwgaUZvcmNlID09IDEgfHwKCQkJCQkgICBzSW5wdXQuaW5kZXhPZihvUHJldlNlYXJjaC5zU2VhcmNoKSAhPT0gMCApCgkJCQl7CgkJCQkJLyogTnVrZSB0aGUgb2xkIGRpc3BsYXkgYXJyYXkgLSB3ZSBhcmUgZ29pbmcgdG8gcmVidWlsZCBpdCAqLwoJCQkJCW9TZXR0aW5ncy5haURpc3BsYXkuc3BsaWNlKCAwLCBvU2V0dGluZ3MuYWlEaXNwbGF5Lmxlbmd0aCk7CgkJCQkJCgkJCQkJLyogRm9yY2UgYSByZWJ1aWxkIG9mIHRoZSBzZWFyY2ggYXJyYXkgKi8KCQkJCQlfZm5CdWlsZFNlYXJjaEFycmF5KCBvU2V0dGluZ3MsIDEgKTsKCQkJCQkKCQkJCQkvKiBTZWFyY2ggdGhyb3VnaCBhbGwgcmVjb3JkcyB0byBwb3B1bGF0ZSB0aGUgc2VhcmNoIGFycmF5CgkJCQkJICogVGhlIHRoZSBvU2V0dGluZ3MuYWlEaXNwbGF5TWFzdGVyIGFuZCBhc0RhdGFTZWFyY2ggYXJyYXlzIGhhdmUgMSB0byAxIAoJCQkJCSAqIG1hcHBpbmcKCQkJCQkgKi8KCQkJCQlmb3IgKCBpPTAgOyBpPG9TZXR0aW5ncy5haURpc3BsYXlNYXN0ZXIubGVuZ3RoIDsgaSsrICkKCQkJCQl7CgkJCQkJCWlmICggcnBTZWFyY2gudGVzdChvU2V0dGluZ3MuYXNEYXRhU2VhcmNoW2ldKSApCgkJCQkJCXsKCQkJCQkJCW9TZXR0aW5ncy5haURpc3BsYXkucHVzaCggb1NldHRpbmdzLmFpRGlzcGxheU1hc3RlcltpXSApOwoJCQkJCQl9CgkJCQkJfQoJCQkgIH0KCQkJICBlbHNlCgkJCQl7CgkJCSAgCS8qIFVzaW5nIG9sZCBzZWFyY2ggYXJyYXkgLSByZWZpbmUgaXQgLSBkbyBpdCB0aGlzIHdheSBmb3Igc3BlZWQKCQkJICAJICogRG9uJ3QgaGF2ZSB0byBzZWFyY2ggdGhlIHdob2xlIG1hc3RlciBhcnJheSBhZ2FpbgoJCQkJCSAqLwoJCQkgIAl2YXIgaUluZGV4Q29ycmVjdG9yID0gMDsKCQkJICAJCgkJCSAgCS8qIFNlYXJjaCB0aGUgY3VycmVudCByZXN1bHRzICovCgkJCSAgCWZvciAoIGk9MCA7IGk8b1NldHRpbmdzLmFzRGF0YVNlYXJjaC5sZW5ndGggOyBpKysgKQoJCQkJCXsKCQkJICAJCWlmICggISBycFNlYXJjaC50ZXN0KG9TZXR0aW5ncy5hc0RhdGFTZWFyY2hbaV0pICkKCQkJCQkJewoJCQkgIAkJCW9TZXR0aW5ncy5haURpc3BsYXkuc3BsaWNlKCBpLWlJbmRleENvcnJlY3RvciwgMSApOwoJCQkgIAkJCWlJbmRleENvcnJlY3RvcisrOwoJCQkgIAkJfQoJCQkgIAl9CgkJCSAgfQoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIENyZWF0ZSBhbiBhcnJheSB3aGljaCBjYW4gYmUgcXVpY2tseSBzZWFyY2ggdGhyb3VnaAoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7aW50fSBpTWFzdGVyIHVzZSB0aGUgbWFzdGVyIGRhdGEgYXJyYXkgLSBvcHRpb25hbAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5CdWlsZFNlYXJjaEFycmF5ICggb1NldHRpbmdzLCBpTWFzdGVyICkKCQl7CgkJCWlmICggIW9TZXR0aW5ncy5vRmVhdHVyZXMuYlNlcnZlclNpZGUgKQoJCQl7CgkJCQkvKiBDbGVhciBvdXQgdGhlIG9sZCBkYXRhICovCgkJCQlvU2V0dGluZ3MuYXNEYXRhU2VhcmNoLnNwbGljZSggMCwgb1NldHRpbmdzLmFzRGF0YVNlYXJjaC5sZW5ndGggKTsKCQkJCQoJCQkJdmFyIGFBcnJheSA9IChpTWFzdGVyICYmIGlNYXN0ZXI9PT0xKSA/CgkJCQkgCW9TZXR0aW5ncy5haURpc3BsYXlNYXN0ZXIgOiBvU2V0dGluZ3MuYWlEaXNwbGF5OwoJCQkJCgkJCQlmb3IgKCB2YXIgaT0wLCBpTGVuPWFBcnJheS5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCW9TZXR0aW5ncy5hc0RhdGFTZWFyY2hbaV0gPSBfZm5CdWlsZFNlYXJjaFJvdyggb1NldHRpbmdzLAoJCQkJCQlfZm5HZXRSb3dEYXRhKCBvU2V0dGluZ3MsIGFBcnJheVtpXSwgJ2ZpbHRlcicgKSApOwoJCQkJfQoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIENyZWF0ZSBhIHNlYXJjaGFibGUgc3RyaW5nIGZyb20gYSBzaW5nbGUgZGF0YSByb3cKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge2FycmF5fSBhRGF0YSBSb3cgZGF0YSBhcnJheSB0byB1c2UgZm9yIHRoZSBkYXRhIHRvIHNlYXJjaAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5CdWlsZFNlYXJjaFJvdyggb1NldHRpbmdzLCBhRGF0YSApCgkJewoJCQl2YXIgc1NlYXJjaCA9ICcnOwoJCQlpZiAoIG9TZXR0aW5ncy5fX25UbXBGaWx0ZXIgPT09IHVuZGVmaW5lZCApCgkJCXsKCQkJCW9TZXR0aW5ncy5fX25UbXBGaWx0ZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKCQkJfQoJCQl2YXIgblRtcCA9IG9TZXR0aW5ncy5fX25UbXBGaWx0ZXI7CgkJCQoJCQlmb3IgKCB2YXIgaj0wLCBqTGVuPW9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgajxqTGVuIDsgaisrICkKCQkJewoJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2pdLmJTZWFyY2hhYmxlICkKCQkJCXsKCQkJCQl2YXIgc0RhdGEgPSBhRGF0YVtqXTsKCQkJCQlzU2VhcmNoICs9IF9mbkRhdGFUb1NlYXJjaCggc0RhdGEsIG9TZXR0aW5ncy5hb0NvbHVtbnNbal0uc1R5cGUgKSsnICAnOwoJCQkJfQoJCQl9CgkJCQoJCQkvKiBJZiBpdCBsb29rcyBsaWtlIHRoZXJlIGlzIGFuIEhUTUwgZW50aXR5IGluIHRoZSBzdHJpbmcsIGF0dGVtcHQgdG8gZGVjb2RlIGl0ICovCgkJCWlmICggc1NlYXJjaC5pbmRleE9mKCcmJykgIT09IC0xICkKCQkJewoJCQkJblRtcC5pbm5lckhUTUwgPSBzU2VhcmNoOwoJCQkJc1NlYXJjaCA9IG5UbXAudGV4dENvbnRlbnQgPyBuVG1wLnRleHRDb250ZW50IDogblRtcC5pbm5lclRleHQ7CgkJCQkKCQkJCS8qIElFIGFuZCBPcGVyYSBhcHBlYXIgdG8gcHV0IGFuIG5ld2xpbmUgd2hlcmUgdGhlcmUgaXMgYSA8YnI+IHRhZyAtIHJlbW92ZSBpdCAqLwoJCQkJc1NlYXJjaCA9IHNTZWFyY2gucmVwbGFjZSgvXG4vZywiICIpLnJlcGxhY2UoL1xyL2csIiIpOwoJCQl9CgkJCQoJCQlyZXR1cm4gc1NlYXJjaDsKCQl9CgkJCgkJLyoqCgkJICogQnVpbGQgYSByZWd1bGFyIGV4cHJlc3Npb24gb2JqZWN0IHN1aXRhYmxlIGZvciBzZWFyY2hpbmcgYSB0YWJsZQoJCSAqICBAcGFyYW0ge3N0cmluZ30gc1NlYXJjaCBzdHJpbmcgdG8gc2VhcmNoIGZvcgoJCSAqICBAcGFyYW0ge2Jvb2x9IGJSZWdleCB0cmVhdCBhcyBhIHJlZ3VsYXIgZXhwcmVzc2lvbiBvciBub3QKCQkgKiAgQHBhcmFtIHtib29sfSBiU21hcnQgcGVyZm9ybSBzbWFydCBmaWx0ZXJpbmcgb3Igbm90CgkJICogIEBwYXJhbSB7Ym9vbH0gYkNhc2VJbnNlbnNpdGl2ZSBEbyBjYXNlIGluc2Vuc3RpdmUgbWF0Y2hpbmcgb3Igbm90CgkJICogIEByZXR1cm5zIHtSZWdFeHB9IGNvbnN0cnVjdGVkIG9iamVjdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5GaWx0ZXJDcmVhdGVTZWFyY2goIHNTZWFyY2gsIGJSZWdleCwgYlNtYXJ0LCBiQ2FzZUluc2Vuc2l0aXZlICkKCQl7CgkJCXZhciBhc1NlYXJjaCwgc1JlZ0V4cFN0cmluZzsKCQkJCgkJCWlmICggYlNtYXJ0ICkKCQkJewoJCQkJLyogR2VuZXJhdGUgdGhlIHJlZ3VsYXIgZXhwcmVzc2lvbiB0byB1c2UuIFNvbWV0aGluZyBhbG9uZyB0aGUgbGluZXMgb2Y6CgkJCQkgKiBeKD89Lio/XGJvbmVcYikoPz0uKj9cYnR3b1xiKSg/PS4qP1xidGhyZWVcYikuKiQKCQkJCSAqLwoJCQkJYXNTZWFyY2ggPSBiUmVnZXggPyBzU2VhcmNoLnNwbGl0KCAnICcgKSA6IF9mbkVzY2FwZVJlZ2V4KCBzU2VhcmNoICkuc3BsaXQoICcgJyApOwoJCQkJc1JlZ0V4cFN0cmluZyA9ICdeKD89Lio/Jythc1NlYXJjaC5qb2luKCAnKSg/PS4qPycgKSsnKS4qJCc7CgkJCQlyZXR1cm4gbmV3IFJlZ0V4cCggc1JlZ0V4cFN0cmluZywgYkNhc2VJbnNlbnNpdGl2ZSA/ICJpIiA6ICIiICk7CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQlzU2VhcmNoID0gYlJlZ2V4ID8gc1NlYXJjaCA6IF9mbkVzY2FwZVJlZ2V4KCBzU2VhcmNoICk7CgkJCQlyZXR1cm4gbmV3IFJlZ0V4cCggc1NlYXJjaCwgYkNhc2VJbnNlbnNpdGl2ZSA/ICJpIiA6ICIiICk7CgkJCX0KCQl9CgkJCgkJCgkJLyoqCgkJICogQ29udmVydCByYXcgZGF0YSBpbnRvIHNvbWV0aGluZyB0aGF0IHRoZSB1c2VyIGNhbiBzZWFyY2ggb24KCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNEYXRhIGRhdGEgdG8gYmUgbW9kaWZpZWQKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNUeXBlIGRhdGEgdHlwZQoJCSAqICBAcmV0dXJucyB7c3RyaW5nfSBzZWFyY2ggc3RyaW5nCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkRhdGFUb1NlYXJjaCAoIHNEYXRhLCBzVHlwZSApCgkJewoJCQlpZiAoIHR5cGVvZiBEYXRhVGFibGUuZXh0Lm9mblNlYXJjaFtzVHlwZV0gPT09ICJmdW5jdGlvbiIgKQoJCQl7CgkJCQlyZXR1cm4gRGF0YVRhYmxlLmV4dC5vZm5TZWFyY2hbc1R5cGVdKCBzRGF0YSApOwoJCQl9CgkJCWVsc2UgaWYgKCBzRGF0YSA9PT0gbnVsbCApCgkJCXsKCQkJCXJldHVybiAnJzsKCQkJfQoJCQllbHNlIGlmICggc1R5cGUgPT0gImh0bWwiICkKCQkJewoJCQkJcmV0dXJuIHNEYXRhLnJlcGxhY2UoL1tcclxuXS9nLCIgIikucmVwbGFjZSggLzwuKj8+L2csICIiICk7CgkJCX0KCQkJZWxzZSBpZiAoIHR5cGVvZiBzRGF0YSA9PT0gInN0cmluZyIgKQoJCQl7CgkJCQlyZXR1cm4gc0RhdGEucmVwbGFjZSgvW1xyXG5dL2csIiAiKTsKCQkJfQoJCQlyZXR1cm4gc0RhdGE7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIHNjYXBlIGEgc3RyaW5nIHN0dWNoIHRoYXQgaXQgY2FuIGJlIHVzZWQgaW4gYSByZWd1bGFyIGV4cHJlc3Npb24KCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNWYWwgc3RyaW5nIHRvIGVzY2FwZQoJCSAqICBAcmV0dXJucyB7c3RyaW5nfSBlc2NhcGVkIHN0cmluZwoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5Fc2NhcGVSZWdleCAoIHNWYWwgKQoJCXsKCQkJdmFyIGFjRXNjYXBlID0gWyAnLycsICcuJywgJyonLCAnKycsICc/JywgJ3wnLCAnKCcsICcpJywgJ1snLCAnXScsICd7JywgJ30nLCAnXFwnLCAnJCcsICdeJywgJy0nIF07CgkJCXZhciByZVJlcGxhY2UgPSBuZXcgUmVnRXhwKCAnKFxcJyArIGFjRXNjYXBlLmpvaW4oJ3xcXCcpICsgJyknLCAnZycgKTsKCQkJcmV0dXJuIHNWYWwucmVwbGFjZShyZVJlcGxhY2UsICdcXCQxJyk7CgkJfQoJCQoJCQoJCQoJCS8qKgoJCSAqIEdlbmVyYXRlIHRoZSBub2RlIHJlcXVpcmVkIGZvciB0aGUgaW5mbyBkaXNwbGF5CgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHJldHVybnMge25vZGV9IEluZm9ybWF0aW9uIGVsZW1lbnQKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuRmVhdHVyZUh0bWxJbmZvICggb1NldHRpbmdzICkKCQl7CgkJCXZhciBuSW5mbyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdkaXYnICk7CgkJCW5JbmZvLmNsYXNzTmFtZSA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zSW5mbzsKCQkJCgkJCS8qIEFjdGlvbnMgdGhhdCBhcmUgdG8gYmUgdGFrZW4gb25jZSBvbmx5IGZvciB0aGlzIGZlYXR1cmUgKi8KCQkJaWYgKCAhb1NldHRpbmdzLmFhbkZlYXR1cmVzLmkgKQoJCQl7CgkJCQkvKiBBZGQgZHJhdyBjYWxsYmFjayAqLwoJCQkJb1NldHRpbmdzLmFvRHJhd0NhbGxiYWNrLnB1c2goIHsKCQkJCQkiZm4iOiBfZm5VcGRhdGVJbmZvLAoJCQkJCSJzTmFtZSI6ICJpbmZvcm1hdGlvbiIKCQkJCX0gKTsKCQkJCQoJCQkJLyogQWRkIGlkICovCgkJCQluSW5mby5pZCA9IG9TZXR0aW5ncy5zVGFibGVJZCsnX2luZm8nOwoJCQl9CgkJCW9TZXR0aW5ncy5uVGFibGUuc2V0QXR0cmlidXRlKCAnYXJpYS1kZXNjcmliZWRieScsIG9TZXR0aW5ncy5zVGFibGVJZCsnX2luZm8nICk7CgkJCQoJCQlyZXR1cm4gbkluZm87CgkJfQoJCQoJCQoJCS8qKgoJCSAqIFVwZGF0ZSB0aGUgaW5mb3JtYXRpb24gZWxlbWVudHMgaW4gdGhlIGRpc3BsYXkKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5VcGRhdGVJbmZvICggb1NldHRpbmdzICkKCQl7CgkJCS8qIFNob3cgaW5mb3JtYXRpb24gYWJvdXQgdGhlIHRhYmxlICovCgkJCWlmICggIW9TZXR0aW5ncy5vRmVhdHVyZXMuYkluZm8gfHwgb1NldHRpbmdzLmFhbkZlYXR1cmVzLmkubGVuZ3RoID09PSAwICkKCQkJewoJCQkJcmV0dXJuOwoJCQl9CgkJCQoJCQl2YXIKCQkJCW9MYW5nID0gb1NldHRpbmdzLm9MYW5ndWFnZSwKCQkJCWlTdGFydCA9IG9TZXR0aW5ncy5faURpc3BsYXlTdGFydCsxLAoJCQkJaUVuZCA9IG9TZXR0aW5ncy5mbkRpc3BsYXlFbmQoKSwKCQkJCWlNYXggPSBvU2V0dGluZ3MuZm5SZWNvcmRzVG90YWwoKSwKCQkJCWlUb3RhbCA9IG9TZXR0aW5ncy5mblJlY29yZHNEaXNwbGF5KCksCgkJCQlzT3V0OwoJCQkKCQkJaWYgKCBpVG90YWwgPT09IDAgJiYgaVRvdGFsID09IGlNYXggKQoJCQl7CgkJCQkvKiBFbXB0eSByZWNvcmQgc2V0ICovCgkJCQlzT3V0ID0gb0xhbmcuc0luZm9FbXB0eTsKCQkJfQoJCQllbHNlIGlmICggaVRvdGFsID09PSAwICkKCQkJewoJCQkJLyogRW1wdHkgcmVjb3JkIHNldCBhZnRlciBmaWx0ZXJpbmcgKi8KCQkJCXNPdXQgPSBvTGFuZy5zSW5mb0VtcHR5ICsnICcrIG9MYW5nLnNJbmZvRmlsdGVyZWQ7CgkJCX0KCQkJZWxzZSBpZiAoIGlUb3RhbCA9PSBpTWF4ICkKCQkJewoJCQkJLyogTm9ybWFsIHJlY29yZCBzZXQgKi8KCQkJCXNPdXQgPSBvTGFuZy5zSW5mbzsKCQkJfQoJCQllbHNlCgkJCXsKCQkJCS8qIFJlY29yZCBzZXQgYWZ0ZXIgZmlsdGVyaW5nICovCgkJCQlzT3V0ID0gb0xhbmcuc0luZm8gKycgJysgb0xhbmcuc0luZm9GaWx0ZXJlZDsKCQkJfQoJCQoJCQkvLyBDb252ZXJ0IHRoZSBtYWNyb3MKCQkJc091dCArPSBvTGFuZy5zSW5mb1Bvc3RGaXg7CgkJCXNPdXQgPSBfZm5JbmZvTWFjcm9zKCBvU2V0dGluZ3MsIHNPdXQgKTsKCQkJCgkJCWlmICggb0xhbmcuZm5JbmZvQ2FsbGJhY2sgIT09IG51bGwgKQoJCQl7CgkJCQlzT3V0ID0gb0xhbmcuZm5JbmZvQ2FsbGJhY2suY2FsbCggb1NldHRpbmdzLm9JbnN0YW5jZSwgCgkJCQkJb1NldHRpbmdzLCBpU3RhcnQsIGlFbmQsIGlNYXgsIGlUb3RhbCwgc091dCApOwoJCQl9CgkJCQoJCQl2YXIgbiA9IG9TZXR0aW5ncy5hYW5GZWF0dXJlcy5pOwoJCQlmb3IgKCB2YXIgaT0wLCBpTGVuPW4ubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJJChuW2ldKS5odG1sKCBzT3V0ICk7CgkJCX0KCQl9CgkJCgkJCgkJZnVuY3Rpb24gX2ZuSW5mb01hY3JvcyAoIG9TZXR0aW5ncywgc3RyICkKCQl7CgkJCXZhcgoJCQkJaVN0YXJ0ID0gb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0KzEsCgkJCQlzU3RhcnQgPSBvU2V0dGluZ3MuZm5Gb3JtYXROdW1iZXIoIGlTdGFydCApLAoJCQkJaUVuZCA9IG9TZXR0aW5ncy5mbkRpc3BsYXlFbmQoKSwKCQkJCXNFbmQgPSBvU2V0dGluZ3MuZm5Gb3JtYXROdW1iZXIoIGlFbmQgKSwKCQkJCWlUb3RhbCA9IG9TZXR0aW5ncy5mblJlY29yZHNEaXNwbGF5KCksCgkJCQlzVG90YWwgPSBvU2V0dGluZ3MuZm5Gb3JtYXROdW1iZXIoIGlUb3RhbCApLAoJCQkJaU1heCA9IG9TZXR0aW5ncy5mblJlY29yZHNUb3RhbCgpLAoJCQkJc01heCA9IG9TZXR0aW5ncy5mbkZvcm1hdE51bWJlciggaU1heCApOwoJCQoJCQkvLyBXaGVuIGluZmluaXRlIHNjcm9sbGluZywgd2UgYXJlIGFsd2F5cyBzdGFydGluZyBhdCAxLiBfaURpc3BsYXlTdGFydCBpcyB1c2VkIG9ubHkKCQkJLy8gaW50ZXJuYWxseQoJCQlpZiAoIG9TZXR0aW5ncy5vU2Nyb2xsLmJJbmZpbml0ZSApCgkJCXsKCQkJCXNTdGFydCA9IG9TZXR0aW5ncy5mbkZvcm1hdE51bWJlciggMSApOwoJCQl9CgkJCgkJCXJldHVybiBzdHIuCgkJCQlyZXBsYWNlKCdfU1RBUlRfJywgc1N0YXJ0KS4KCQkJCXJlcGxhY2UoJ19FTkRfJywgICBzRW5kKS4KCQkJCXJlcGxhY2UoJ19UT1RBTF8nLCBzVG90YWwpLgoJCQkJcmVwbGFjZSgnX01BWF8nLCAgIHNNYXgpOwoJCX0KCQkKCQkKCQkKCQkvKioKCQkgKiBEcmF3IHRoZSB0YWJsZSBmb3IgdGhlIGZpcnN0IHRpbWUsIGFkZGluZyBhbGwgcmVxdWlyZWQgZmVhdHVyZXMKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5Jbml0aWFsaXNlICggb1NldHRpbmdzICkKCQl7CgkJCXZhciBpLCBpTGVuLCBpQWpheFN0YXJ0PW9TZXR0aW5ncy5pSW5pdERpc3BsYXlTdGFydDsKCQkJCgkJCS8qIEVuc3VyZSB0aGF0IHRoZSB0YWJsZSBkYXRhIGlzIGZ1bGx5IGluaXRpYWxpc2VkICovCgkJCWlmICggb1NldHRpbmdzLmJJbml0aWFsaXNlZCA9PT0gZmFsc2UgKQoJCQl7CgkJCQlzZXRUaW1lb3V0KCBmdW5jdGlvbigpeyBfZm5Jbml0aWFsaXNlKCBvU2V0dGluZ3MgKTsgfSwgMjAwICk7CgkJCQlyZXR1cm47CgkJCX0KCQkJCgkJCS8qIFNob3cgdGhlIGRpc3BsYXkgSFRNTCBvcHRpb25zICovCgkJCV9mbkFkZE9wdGlvbnNIdG1sKCBvU2V0dGluZ3MgKTsKCQkJCgkJCS8qIEJ1aWxkIGFuZCBkcmF3IHRoZSBoZWFkZXIgLyBmb290ZXIgZm9yIHRoZSB0YWJsZSAqLwoJCQlfZm5CdWlsZEhlYWQoIG9TZXR0aW5ncyApOwoJCQlfZm5EcmF3SGVhZCggb1NldHRpbmdzLCBvU2V0dGluZ3MuYW9IZWFkZXIgKTsKCQkJaWYgKCBvU2V0dGluZ3MublRGb290ICkKCQkJewoJCQkJX2ZuRHJhd0hlYWQoIG9TZXR0aW5ncywgb1NldHRpbmdzLmFvRm9vdGVyICk7CgkJCX0KCQkKCQkJLyogT2theSB0byBzaG93IHRoYXQgc29tZXRoaW5nIGlzIGdvaW5nIG9uIG5vdyAqLwoJCQlfZm5Qcm9jZXNzaW5nRGlzcGxheSggb1NldHRpbmdzLCB0cnVlICk7CgkJCQoJCQkvKiBDYWxjdWxhdGUgc2l6ZXMgZm9yIGNvbHVtbnMgKi8KCQkJaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJBdXRvV2lkdGggKQoJCQl7CgkJCQlfZm5DYWxjdWxhdGVDb2x1bW5XaWR0aHMoIG9TZXR0aW5ncyApOwoJCQl9CgkJCQoJCQlmb3IgKCBpPTAsIGlMZW49b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc1dpZHRoICE9PSBudWxsICkKCQkJCXsKCQkJCQlvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLm5UaC5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNXaWR0aCApOwoJCQkJfQoJCQl9CgkJCQoJCQkvKiBJZiB0aGVyZSBpcyBkZWZhdWx0IHNvcnRpbmcgcmVxdWlyZWQgLSBsZXQncyBkbyBpdC4gVGhlIHNvcnQgZnVuY3Rpb24gd2lsbCBkbyB0aGUKCQkJICogZHJhd2luZyBmb3IgdXMuIE90aGVyd2lzZSB3ZSBkcmF3IHRoZSB0YWJsZSByZWdhcmRsZXNzIG9mIHRoZSBBamF4IHNvdXJjZSAtIHRoaXMgYWxsb3dzCgkJCSAqIHRoZSB0YWJsZSB0byBsb29rIGluaXRpYWxpc2VkIGZvciBBamF4IHNvdXJjaW5nIGRhdGEgKHNob3cgJ2xvYWRpbmcnIG1lc3NhZ2UgcG9zc2libHkpCgkJCSAqLwoJCQlpZiAoIG9TZXR0aW5ncy5vRmVhdHVyZXMuYlNvcnQgKQoJCQl7CgkJCQlfZm5Tb3J0KCBvU2V0dGluZ3MgKTsKCQkJfQoJCQllbHNlIGlmICggb1NldHRpbmdzLm9GZWF0dXJlcy5iRmlsdGVyICkKCQkJewoJCQkJX2ZuRmlsdGVyQ29tcGxldGUoIG9TZXR0aW5ncywgb1NldHRpbmdzLm9QcmV2aW91c1NlYXJjaCApOwoJCQl9CgkJCWVsc2UKCQkJewoJCQkJb1NldHRpbmdzLmFpRGlzcGxheSA9IG9TZXR0aW5ncy5haURpc3BsYXlNYXN0ZXIuc2xpY2UoKTsKCQkJCV9mbkNhbGN1bGF0ZUVuZCggb1NldHRpbmdzICk7CgkJCQlfZm5EcmF3KCBvU2V0dGluZ3MgKTsKCQkJfQoJCQkKCQkJLyogaWYgdGhlcmUgaXMgYW4gYWpheCBzb3VyY2UgbG9hZCB0aGUgZGF0YSAqLwoJCQlpZiAoIG9TZXR0aW5ncy5zQWpheFNvdXJjZSAhPT0gbnVsbCAmJiAhb1NldHRpbmdzLm9GZWF0dXJlcy5iU2VydmVyU2lkZSApCgkJCXsKCQkJCXZhciBhb0RhdGEgPSBbXTsKCQkJCV9mblNlcnZlclBhcmFtcyggb1NldHRpbmdzLCBhb0RhdGEgKTsKCQkJCW9TZXR0aW5ncy5mblNlcnZlckRhdGEuY2FsbCggb1NldHRpbmdzLm9JbnN0YW5jZSwgb1NldHRpbmdzLnNBamF4U291cmNlLCBhb0RhdGEsIGZ1bmN0aW9uKGpzb24pIHsKCQkJCQl2YXIgYURhdGEgPSAob1NldHRpbmdzLnNBamF4RGF0YVByb3AgIT09ICIiKSA/CgkJCQkJIAlfZm5HZXRPYmplY3REYXRhRm4oIG9TZXR0aW5ncy5zQWpheERhdGFQcm9wICkoanNvbikgOiBqc29uOwoJCQoJCQkJCS8qIEdvdCB0aGUgZGF0YSAtIGFkZCBpdCB0byB0aGUgdGFibGUgKi8KCQkJCQlmb3IgKCBpPTAgOyBpPGFEYXRhLmxlbmd0aCA7IGkrKyApCgkJCQkJewoJCQkJCQlfZm5BZGREYXRhKCBvU2V0dGluZ3MsIGFEYXRhW2ldICk7CgkJCQkJfQoJCQkJCQoJCQkJCS8qIFJlc2V0IHRoZSBpbml0IGRpc3BsYXkgZm9yIGNvb2tpZSBzYXZpbmcuIFdlJ3ZlIGFscmVhZHkgZG9uZSBhIGZpbHRlciwgYW5kCgkJCQkJICogdGhlcmVmb3JlIGNsZWFyZWQgaXQgYmVmb3JlLiBTbyB3ZSBuZWVkIHRvIG1ha2UgaXQgYXBwZWFyICdmcmVzaCcKCQkJCQkgKi8KCQkJCQlvU2V0dGluZ3MuaUluaXREaXNwbGF5U3RhcnQgPSBpQWpheFN0YXJ0OwoJCQkJCQoJCQkJCWlmICggb1NldHRpbmdzLm9GZWF0dXJlcy5iU29ydCApCgkJCQkJewoJCQkJCQlfZm5Tb3J0KCBvU2V0dGluZ3MgKTsKCQkJCQl9CgkJCQkJZWxzZQoJCQkJCXsKCQkJCQkJb1NldHRpbmdzLmFpRGlzcGxheSA9IG9TZXR0aW5ncy5haURpc3BsYXlNYXN0ZXIuc2xpY2UoKTsKCQkJCQkJX2ZuQ2FsY3VsYXRlRW5kKCBvU2V0dGluZ3MgKTsKCQkJCQkJX2ZuRHJhdyggb1NldHRpbmdzICk7CgkJCQkJfQoJCQkJCQoJCQkJCV9mblByb2Nlc3NpbmdEaXNwbGF5KCBvU2V0dGluZ3MsIGZhbHNlICk7CgkJCQkJX2ZuSW5pdENvbXBsZXRlKCBvU2V0dGluZ3MsIGpzb24gKTsKCQkJCX0sIG9TZXR0aW5ncyApOwoJCQkJcmV0dXJuOwoJCQl9CgkJCQoJCQkvKiBTZXJ2ZXItc2lkZSBwcm9jZXNzaW5nIGluaXRpYWxpc2F0aW9uIGNvbXBsZXRlIGlzIGRvbmUgYXQgdGhlIGVuZCBvZiBfZm5EcmF3ICovCgkJCWlmICggIW9TZXR0aW5ncy5vRmVhdHVyZXMuYlNlcnZlclNpZGUgKQoJCQl7CgkJCQlfZm5Qcm9jZXNzaW5nRGlzcGxheSggb1NldHRpbmdzLCBmYWxzZSApOwoJCQkJX2ZuSW5pdENvbXBsZXRlKCBvU2V0dGluZ3MgKTsKCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBEcmF3IHRoZSB0YWJsZSBmb3IgdGhlIGZpcnN0IHRpbWUsIGFkZGluZyBhbGwgcmVxdWlyZWQgZmVhdHVyZXMKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge29iamVjdH0gW2pzb25dIEpTT04gZnJvbSB0aGUgc2VydmVyIHRoYXQgY29tcGxldGVkIHRoZSB0YWJsZSwgaWYgdXNpbmcgQWpheCBzb3VyY2UKCQkgKiAgICB3aXRoIGNsaWVudC1zaWRlIHByb2Nlc3NpbmcgKG9wdGlvbmFsKQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5Jbml0Q29tcGxldGUgKCBvU2V0dGluZ3MsIGpzb24gKQoJCXsKCQkJb1NldHRpbmdzLl9iSW5pdENvbXBsZXRlID0gdHJ1ZTsKCQkJX2ZuQ2FsbGJhY2tGaXJlKCBvU2V0dGluZ3MsICdhb0luaXRDb21wbGV0ZScsICdpbml0JywgW29TZXR0aW5ncywganNvbl0gKTsKCQl9CgkJCgkJCgkJLyoqCgkJICogTGFuZ3VhZ2UgY29tcGF0aWJpbGl0eSAtIHdoZW4gY2VydGFpbiBvcHRpb25zIGFyZSBnaXZlbiwgYW5kIG90aGVycyBhcmVuJ3QsIHdlCgkJICogbmVlZCB0byBkdXBsaWNhdGUgdGhlIHZhbHVlcyBvdmVyLCBpbiBvcmRlciB0byBwcm92aWRlIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5CgkJICogd2l0aCBvbGRlciBsYW5ndWFnZSBmaWxlcy4KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5MYW5ndWFnZUNvbXBhdCggb0xhbmd1YWdlICkKCQl7CgkJCXZhciBvRGVmYXVsdHMgPSBEYXRhVGFibGUuZGVmYXVsdHMub0xhbmd1YWdlOwoJCQoJCQkvKiBCYWNrd2FyZHMgY29tcGF0aWJpbGl0eSAtIGlmIHRoZXJlIGlzIG5vIHNFbXB0eVRhYmxlIGdpdmVuLCB0aGVuIHVzZSB0aGUgc2FtZSBhcwoJCQkgKiBzWmVyb1JlY29yZHMgLSBhc3N1bWluZyB0aGF0IGlzIGdpdmVuLgoJCQkgKi8KCQkJaWYgKCAhb0xhbmd1YWdlLnNFbXB0eVRhYmxlICYmIG9MYW5ndWFnZS5zWmVyb1JlY29yZHMgJiYKCQkJCW9EZWZhdWx0cy5zRW1wdHlUYWJsZSA9PT0gIk5vIGRhdGEgYXZhaWxhYmxlIGluIHRhYmxlIiApCgkJCXsKCQkJCV9mbk1hcCggb0xhbmd1YWdlLCBvTGFuZ3VhZ2UsICdzWmVyb1JlY29yZHMnLCAnc0VtcHR5VGFibGUnICk7CgkJCX0KCQkKCQkJLyogTGlrZXdpc2Ugd2l0aCBsb2FkaW5nIHJlY29yZHMgKi8KCQkJaWYgKCAhb0xhbmd1YWdlLnNMb2FkaW5nUmVjb3JkcyAmJiBvTGFuZ3VhZ2Uuc1plcm9SZWNvcmRzICYmCgkJCQlvRGVmYXVsdHMuc0xvYWRpbmdSZWNvcmRzID09PSAiTG9hZGluZy4uLiIgKQoJCQl7CgkJCQlfZm5NYXAoIG9MYW5ndWFnZSwgb0xhbmd1YWdlLCAnc1plcm9SZWNvcmRzJywgJ3NMb2FkaW5nUmVjb3JkcycgKTsKCQkJfQoJCX0KCQkKCQkKCQkKCQkvKioKCQkgKiBHZW5lcmF0ZSB0aGUgbm9kZSByZXF1aXJlZCBmb3IgdXNlciBkaXNwbGF5IGxlbmd0aCBjaGFuZ2luZwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEByZXR1cm5zIHtub2RlfSBEaXNwbGF5IGxlbmd0aCBmZWF0dXJlIG5vZGUKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuRmVhdHVyZUh0bWxMZW5ndGggKCBvU2V0dGluZ3MgKQoJCXsKCQkJaWYgKCBvU2V0dGluZ3Mub1Njcm9sbC5iSW5maW5pdGUgKQoJCQl7CgkJCQlyZXR1cm4gbnVsbDsKCQkJfQoJCQkKCQkJLyogVGhpcyBjYW4gYmUgb3ZlcnJ1bGVkIGJ5IG5vdCB1c2luZyB0aGUgX01FTlVfIHZhci9tYWNybyBpbiB0aGUgbGFuZ3VhZ2UgdmFyaWFibGUgKi8KCQkJdmFyIHNOYW1lID0gJ25hbWU9Iicrb1NldHRpbmdzLnNUYWJsZUlkKydfbGVuZ3RoIic7CgkJCXZhciBzU3RkTWVudSA9ICc8c2VsZWN0IHNpemU9IjEiICcrc05hbWUrJz4nOwoJCQl2YXIgaSwgaUxlbjsKCQkJdmFyIGFMZW5ndGhNZW51ID0gb1NldHRpbmdzLmFMZW5ndGhNZW51OwoJCQkKCQkJaWYgKCBhTGVuZ3RoTWVudS5sZW5ndGggPT0gMiAmJiB0eXBlb2YgYUxlbmd0aE1lbnVbMF0gPT09ICdvYmplY3QnICYmIAoJCQkJCXR5cGVvZiBhTGVuZ3RoTWVudVsxXSA9PT0gJ29iamVjdCcgKQoJCQl7CgkJCQlmb3IgKCBpPTAsIGlMZW49YUxlbmd0aE1lbnVbMF0ubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQlzU3RkTWVudSArPSAnPG9wdGlvbiB2YWx1ZT0iJythTGVuZ3RoTWVudVswXVtpXSsnIj4nK2FMZW5ndGhNZW51WzFdW2ldKyc8L29wdGlvbj4nOwoJCQkJfQoJCQl9CgkJCWVsc2UKCQkJewoJCQkJZm9yICggaT0wLCBpTGVuPWFMZW5ndGhNZW51Lmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJc1N0ZE1lbnUgKz0gJzxvcHRpb24gdmFsdWU9IicrYUxlbmd0aE1lbnVbaV0rJyI+JythTGVuZ3RoTWVudVtpXSsnPC9vcHRpb24+JzsKCQkJCX0KCQkJfQoJCQlzU3RkTWVudSArPSAnPC9zZWxlY3Q+JzsKCQkJCgkJCXZhciBuTGVuZ3RoID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ2RpdicgKTsKCQkJaWYgKCAhb1NldHRpbmdzLmFhbkZlYXR1cmVzLmwgKQoJCQl7CgkJCQluTGVuZ3RoLmlkID0gb1NldHRpbmdzLnNUYWJsZUlkKydfbGVuZ3RoJzsKCQkJfQoJCQluTGVuZ3RoLmNsYXNzTmFtZSA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zTGVuZ3RoOwoJCQluTGVuZ3RoLmlubmVySFRNTCA9ICc8bGFiZWw+JytvU2V0dGluZ3Mub0xhbmd1YWdlLnNMZW5ndGhNZW51LnJlcGxhY2UoICdfTUVOVV8nLCBzU3RkTWVudSApKyc8L2xhYmVsPic7CgkJCQoJCQkvKgoJCQkgKiBTZXQgdGhlIGxlbmd0aCB0byB0aGUgY3VycmVudCBkaXNwbGF5IGxlbmd0aCAtIHRoYW5rcyB0byBBbmRyZWEgUGF2bG92aWMgZm9yIHRoaXMgZml4LAoJCQkgKiBhbmQgU3RlZmFuIFNrb3BuaWsgZm9yIGZpeGluZyB0aGUgZml4IQoJCQkgKi8KCQkJJCgnc2VsZWN0IG9wdGlvblt2YWx1ZT0iJytvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoKyciXScsIG5MZW5ndGgpLmF0dHIoInNlbGVjdGVkIiwgdHJ1ZSk7CgkJCQoJCQkkKCdzZWxlY3QnLCBuTGVuZ3RoKS5iaW5kKCAnY2hhbmdlLkRUJywgZnVuY3Rpb24oZSkgewoJCQkJdmFyIGlWYWwgPSAkKHRoaXMpLnZhbCgpOwoJCQkJCgkJCQkvKiBVcGRhdGUgYWxsIG90aGVyIGxlbmd0aCBvcHRpb25zIGZvciB0aGUgbmV3IGRpc3BsYXkgKi8KCQkJCXZhciBuID0gb1NldHRpbmdzLmFhbkZlYXR1cmVzLmw7CgkJCQlmb3IgKCBpPTAsIGlMZW49bi5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCWlmICggbltpXSAhPSB0aGlzLnBhcmVudE5vZGUgKQoJCQkJCXsKCQkJCQkJJCgnc2VsZWN0JywgbltpXSkudmFsKCBpVmFsICk7CgkJCQkJfQoJCQkJfQoJCQkJCgkJCQkvKiBSZWRyYXcgdGhlIHRhYmxlICovCgkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoID0gcGFyc2VJbnQoaVZhbCwgMTApOwoJCQkJX2ZuQ2FsY3VsYXRlRW5kKCBvU2V0dGluZ3MgKTsKCQkJCQoJCQkJLyogSWYgd2UgaGF2ZSBzcGFjZSB0byBzaG93IGV4dHJhIHJvd3MgKGJhY2tpbmcgdXAgZnJvbSB0aGUgZW5kIHBvaW50IC0gdGhlbiBkbyBzbyAqLwoJCQkJaWYgKCBvU2V0dGluZ3MuZm5EaXNwbGF5RW5kKCkgPT0gb1NldHRpbmdzLmZuUmVjb3Jkc0Rpc3BsYXkoKSApCgkJCQl7CgkJCQkJb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ID0gb1NldHRpbmdzLmZuRGlzcGxheUVuZCgpIC0gb1NldHRpbmdzLl9pRGlzcGxheUxlbmd0aDsKCQkJCQlpZiAoIG9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA8IDAgKQoJCQkJCXsKCQkJCQkJb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ID0gMDsKCQkJCQl9CgkJCQl9CgkJCQkKCQkJCWlmICggb1NldHRpbmdzLl9pRGlzcGxheUxlbmd0aCA9PSAtMSApCgkJCQl7CgkJCQkJb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ID0gMDsKCQkJCX0KCQkJCQoJCQkJX2ZuRHJhdyggb1NldHRpbmdzICk7CgkJCX0gKTsKCQkKCQkKCQkJJCgnc2VsZWN0Jywgbkxlbmd0aCkuYXR0cignYXJpYS1jb250cm9scycsIG9TZXR0aW5ncy5zVGFibGVJZCk7CgkJCQoJCQlyZXR1cm4gbkxlbmd0aDsKCQl9CgkJCgkJCgkJLyoqCgkJICogUmNhbGN1bGF0ZSB0aGUgZW5kIHBvaW50IGJhc2VkIG9uIHRoZSBzdGFydCBwb2ludAoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkNhbGN1bGF0ZUVuZCggb1NldHRpbmdzICkKCQl7CgkJCWlmICggb1NldHRpbmdzLm9GZWF0dXJlcy5iUGFnaW5hdGUgPT09IGZhbHNlICkKCQkJewoJCQkJb1NldHRpbmdzLl9pRGlzcGxheUVuZCA9IG9TZXR0aW5ncy5haURpc3BsYXkubGVuZ3RoOwoJCQl9CgkJCWVsc2UKCQkJewoJCQkJLyogU2V0IHRoZSBlbmQgcG9pbnQgb2YgdGhlIGRpc3BsYXkgLSBiYXNlZCBvbiBob3cgbWFueSBlbGVtZW50cyB0aGVyZSBhcmUKCQkJCSAqIHN0aWxsIHRvIGRpc3BsYXkKCQkJCSAqLwoJCQkJaWYgKCBvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgKyBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoID4gb1NldHRpbmdzLmFpRGlzcGxheS5sZW5ndGggfHwKCQkJCQkgICBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoID09IC0xICkKCQkJCXsKCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5RW5kID0gb1NldHRpbmdzLmFpRGlzcGxheS5sZW5ndGg7CgkJCQl9CgkJCQllbHNlCgkJCQl7CgkJCQkJb1NldHRpbmdzLl9pRGlzcGxheUVuZCA9IG9TZXR0aW5ncy5faURpc3BsYXlTdGFydCArIG9TZXR0aW5ncy5faURpc3BsYXlMZW5ndGg7CgkJCQl9CgkJCX0KCQl9CgkJCgkJCgkJCgkJLyogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICoKCQkgKiBOb3RlIHRoYXQgbW9zdCBvZiB0aGUgcGFnaW5nIGxvZ2ljIGlzIGRvbmUgaW4gCgkJICogRGF0YVRhYmxlLmV4dC5vUGFnaW5hdGlvbgoJCSAqLwoJCQoJCS8qKgoJCSAqIEdlbmVyYXRlIHRoZSBub2RlIHJlcXVpcmVkIGZvciBkZWZhdWx0IHBhZ2luYXRpb24KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcmV0dXJucyB7bm9kZX0gUGFnaW5hdGlvbiBmZWF0dXJlIG5vZGUKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuRmVhdHVyZUh0bWxQYWdpbmF0ZSAoIG9TZXR0aW5ncyApCgkJewoJCQlpZiAoIG9TZXR0aW5ncy5vU2Nyb2xsLmJJbmZpbml0ZSApCgkJCXsKCQkJCXJldHVybiBudWxsOwoJCQl9CgkJCQoJCQl2YXIgblBhZ2luYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ2RpdicgKTsKCQkJblBhZ2luYXRlLmNsYXNzTmFtZSA9IG9TZXR0aW5ncy5vQ2xhc3Nlcy5zUGFnaW5nK29TZXR0aW5ncy5zUGFnaW5hdGlvblR5cGU7CgkJCQoJCQlEYXRhVGFibGUuZXh0Lm9QYWdpbmF0aW9uWyBvU2V0dGluZ3Muc1BhZ2luYXRpb25UeXBlIF0uZm5Jbml0KCBvU2V0dGluZ3MsIG5QYWdpbmF0ZSwgCgkJCQlmdW5jdGlvbiggb1NldHRpbmdzICkgewoJCQkJCV9mbkNhbGN1bGF0ZUVuZCggb1NldHRpbmdzICk7CgkJCQkJX2ZuRHJhdyggb1NldHRpbmdzICk7CgkJCQl9CgkJCSk7CgkJCQoJCQkvKiBBZGQgYSBkcmF3IGNhbGxiYWNrIGZvciB0aGUgcGFnaW5hdGlvbiBvbiBmaXJzdCBpbnN0YW5jZSwgdG8gdXBkYXRlIHRoZSBwYWdpbmcgZGlzcGxheSAqLwoJCQlpZiAoICFvU2V0dGluZ3MuYWFuRmVhdHVyZXMucCApCgkJCXsKCQkJCW9TZXR0aW5ncy5hb0RyYXdDYWxsYmFjay5wdXNoKCB7CgkJCQkJImZuIjogZnVuY3Rpb24oIG9TZXR0aW5ncyApIHsKCQkJCQkJRGF0YVRhYmxlLmV4dC5vUGFnaW5hdGlvblsgb1NldHRpbmdzLnNQYWdpbmF0aW9uVHlwZSBdLmZuVXBkYXRlKCBvU2V0dGluZ3MsIGZ1bmN0aW9uKCBvU2V0dGluZ3MgKSB7CgkJCQkJCQlfZm5DYWxjdWxhdGVFbmQoIG9TZXR0aW5ncyApOwoJCQkJCQkJX2ZuRHJhdyggb1NldHRpbmdzICk7CgkJCQkJCX0gKTsKCQkJCQl9LAoJCQkJCSJzTmFtZSI6ICJwYWdpbmF0aW9uIgoJCQkJfSApOwoJCQl9CgkJCXJldHVybiBuUGFnaW5hdGU7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEFsdGVyIHRoZSBkaXNwbGF5IHNldHRpbmdzIHRvIGNoYW5nZSB0aGUgcGFnZQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7c3RyaW5nfGludH0gbUFjdGlvbiBQYWdpbmcgYWN0aW9uIHRvIHRha2U6ICJmaXJzdCIsICJwcmV2aW91cyIsICJuZXh0IiBvciAibGFzdCIKCQkgKiAgICBvciBwYWdlIG51bWJlciB0byBqdW1wIHRvIChpbnRlZ2VyKQoJCSAqICBAcmV0dXJucyB7Ym9vbH0gdHJ1ZSBwYWdlIGhhcyBjaGFuZ2VkLCBmYWxzZSAtIG5vIGNoYW5nZSAobm8gZWZmZWN0KSBlZyAnZmlyc3QnIG9uIHBhZ2UgMQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5QYWdlQ2hhbmdlICggb1NldHRpbmdzLCBtQWN0aW9uICkKCQl7CgkJCXZhciBpT2xkU3RhcnQgPSBvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQ7CgkJCQoJCQlpZiAoIHR5cGVvZiBtQWN0aW9uID09PSAibnVtYmVyIiApCgkJCXsKCQkJCW9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA9IG1BY3Rpb24gKiBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoOwoJCQkJaWYgKCBvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPiBvU2V0dGluZ3MuZm5SZWNvcmRzRGlzcGxheSgpICkKCQkJCXsKCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSAwOwoJCQkJfQoJCQl9CgkJCWVsc2UgaWYgKCBtQWN0aW9uID09ICJmaXJzdCIgKQoJCQl7CgkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSAwOwoJCQl9CgkJCWVsc2UgaWYgKCBtQWN0aW9uID09ICJwcmV2aW91cyIgKQoJCQl7CgkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPSBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoPj0wID8KCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgLSBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoIDoKCQkJCQkwOwoJCQkJCgkJCQkvKiBDb3JyZWN0IGZvciB1bmRlcnJ1biAqLwoJCQkJaWYgKCBvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgPCAwICkKCQkJCXsKCQkJCSAgb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ID0gMDsKCQkJCX0KCQkJfQoJCQllbHNlIGlmICggbUFjdGlvbiA9PSAibmV4dCIgKQoJCQl7CgkJCQlpZiAoIG9TZXR0aW5ncy5faURpc3BsYXlMZW5ndGggPj0gMCApCgkJCQl7CgkJCQkJLyogTWFrZSBzdXJlIHdlIGFyZSBub3Qgb3ZlciBydW5uaW5nIHRoZSBkaXNwbGF5IGFycmF5ICovCgkJCQkJaWYgKCBvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgKyBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoIDwgb1NldHRpbmdzLmZuUmVjb3Jkc0Rpc3BsYXkoKSApCgkJCQkJewoJCQkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgKz0gb1NldHRpbmdzLl9pRGlzcGxheUxlbmd0aDsKCQkJCQl9CgkJCQl9CgkJCQllbHNlCgkJCQl7CgkJCQkJb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ID0gMDsKCQkJCX0KCQkJfQoJCQllbHNlIGlmICggbUFjdGlvbiA9PSAibGFzdCIgKQoJCQl7CgkJCQlpZiAoIG9TZXR0aW5ncy5faURpc3BsYXlMZW5ndGggPj0gMCApCgkJCQl7CgkJCQkJdmFyIGlQYWdlcyA9IHBhcnNlSW50KCAob1NldHRpbmdzLmZuUmVjb3Jkc0Rpc3BsYXkoKS0xKSAvIG9TZXR0aW5ncy5faURpc3BsYXlMZW5ndGgsIDEwICkgKyAxOwoJCQkJCW9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA9IChpUGFnZXMtMSkgKiBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoOwoJCQkJfQoJCQkJZWxzZQoJCQkJewoJCQkJCW9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA9IDA7CgkJCQl9CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQlfZm5Mb2coIG9TZXR0aW5ncywgMCwgIlVua25vd24gcGFnaW5nIGFjdGlvbjogIittQWN0aW9uICk7CgkJCX0KCQkJJChvU2V0dGluZ3Mub0luc3RhbmNlKS50cmlnZ2VyKCdwYWdlJywgb1NldHRpbmdzKTsKCQkJCgkJCXJldHVybiBpT2xkU3RhcnQgIT0gb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0OwoJCX0KCQkKCQkKCQkKCQkvKioKCQkgKiBHZW5lcmF0ZSB0aGUgbm9kZSByZXF1aXJlZCBmb3IgdGhlIHByb2Nlc3Npbmcgbm9kZQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEByZXR1cm5zIHtub2RlfSBQcm9jZXNzaW5nIGVsZW1lbnQKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuRmVhdHVyZUh0bWxQcm9jZXNzaW5nICggb1NldHRpbmdzICkKCQl7CgkJCXZhciBuUHJvY2Vzc2luZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdkaXYnICk7CgkJCQoJCQlpZiAoICFvU2V0dGluZ3MuYWFuRmVhdHVyZXMuciApCgkJCXsKCQkJCW5Qcm9jZXNzaW5nLmlkID0gb1NldHRpbmdzLnNUYWJsZUlkKydfcHJvY2Vzc2luZyc7CgkJCX0KCQkJblByb2Nlc3NpbmcuaW5uZXJIVE1MID0gb1NldHRpbmdzLm9MYW5ndWFnZS5zUHJvY2Vzc2luZzsKCQkJblByb2Nlc3NpbmcuY2xhc3NOYW1lID0gb1NldHRpbmdzLm9DbGFzc2VzLnNQcm9jZXNzaW5nOwoJCQlvU2V0dGluZ3MublRhYmxlLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKCBuUHJvY2Vzc2luZywgb1NldHRpbmdzLm5UYWJsZSApOwoJCQkKCQkJcmV0dXJuIG5Qcm9jZXNzaW5nOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBEaXNwbGF5IG9yIGhpZGUgdGhlIHByb2Nlc3NpbmcgaW5kaWNhdG9yCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtib29sfSBiU2hvdyBTaG93IHRoZSBwcm9jZXNzaW5nIGluZGljYXRvciAodHJ1ZSkgb3Igbm90IChmYWxzZSkKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuUHJvY2Vzc2luZ0Rpc3BsYXkgKCBvU2V0dGluZ3MsIGJTaG93ICkKCQl7CgkJCWlmICggb1NldHRpbmdzLm9GZWF0dXJlcy5iUHJvY2Vzc2luZyApCgkJCXsKCQkJCXZhciBhbiA9IG9TZXR0aW5ncy5hYW5GZWF0dXJlcy5yOwoJCQkJZm9yICggdmFyIGk9MCwgaUxlbj1hbi5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCWFuW2ldLnN0eWxlLnZpc2liaWxpdHkgPSBiU2hvdyA/ICJ2aXNpYmxlIiA6ICJoaWRkZW4iOwoJCQkJfQoJCQl9CgkJCgkJCSQob1NldHRpbmdzLm9JbnN0YW5jZSkudHJpZ2dlcigncHJvY2Vzc2luZycsIFtvU2V0dGluZ3MsIGJTaG93XSk7CgkJfQoJCQoJCQoJCQoJCS8qKgoJCSAqIEFkZCBhbnkgY29udHJvbCBlbGVtZW50cyBmb3IgdGhlIHRhYmxlIC0gc3BlY2lmaWNhbGx5IHNjcm9sbGluZwoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEByZXR1cm5zIHtub2RlfSBOb2RlIHRvIGFkZCB0byB0aGUgRE9NCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkZlYXR1cmVIdG1sVGFibGUgKCBvU2V0dGluZ3MgKQoJCXsKCQkJLyogQ2hlY2sgaWYgc2Nyb2xsaW5nIGlzIGVuYWJsZWQgb3Igbm90IC0gaWYgbm90IHRoZW4gbGVhdmUgdGhlIERPTSB1bmFsdGVyZWQgKi8KCQkJaWYgKCBvU2V0dGluZ3Mub1Njcm9sbC5zWCA9PT0gIiIgJiYgb1NldHRpbmdzLm9TY3JvbGwuc1kgPT09ICIiICkKCQkJewoJCQkJcmV0dXJuIG9TZXR0aW5ncy5uVGFibGU7CgkJCX0KCQkJCgkJCS8qCgkJCSAqIFRoZSBIVE1MIHN0cnVjdHVyZSB0aGF0IHdlIHdhbnQgdG8gZ2VuZXJhdGUgaW4gdGhpcyBmdW5jdGlvbiBpczoKCQkJICogIGRpdiAtIG5TY3JvbGxlcgoJCQkgKiAgICBkaXYgLSBuU2Nyb2xsSGVhZAoJCQkgKiAgICAgIGRpdiAtIG5TY3JvbGxIZWFkSW5uZXIKCQkJICogICAgICAgIHRhYmxlIC0gblNjcm9sbEhlYWRUYWJsZQoJCQkgKiAgICAgICAgICB0aGVhZCAtIG5UaGVhZAoJCQkgKiAgICBkaXYgLSBuU2Nyb2xsQm9keQoJCQkgKiAgICAgIHRhYmxlIC0gb1NldHRpbmdzLm5UYWJsZQoJCQkgKiAgICAgICAgdGhlYWQgLSBuVGhlYWRTaXplCgkJCSAqICAgICAgICB0Ym9keSAtIG5UYm9keQoJCQkgKiAgICBkaXYgLSBuU2Nyb2xsRm9vdAoJCQkgKiAgICAgIGRpdiAtIG5TY3JvbGxGb290SW5uZXIKCQkJICogICAgICAgIHRhYmxlIC0gblNjcm9sbEZvb3RUYWJsZQoJCQkgKiAgICAgICAgICB0Zm9vdCAtIG5UZm9vdAoJCQkgKi8KCQkJdmFyCgkJCSAJblNjcm9sbGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JyksCgkJCSAJblNjcm9sbEhlYWQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSwKCQkJIAluU2Nyb2xsSGVhZElubmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JyksCgkJCSAJblNjcm9sbEJvZHkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSwKCQkJIAluU2Nyb2xsRm9vdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpLAoJCQkgCW5TY3JvbGxGb290SW5uZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSwKCQkJIAluU2Nyb2xsSGVhZFRhYmxlID0gb1NldHRpbmdzLm5UYWJsZS5jbG9uZU5vZGUoZmFsc2UpLAoJCQkgCW5TY3JvbGxGb290VGFibGUgPSBvU2V0dGluZ3MublRhYmxlLmNsb25lTm9kZShmYWxzZSksCgkJCQluVGhlYWQgPSBvU2V0dGluZ3MublRhYmxlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0aGVhZCcpWzBdLAoJCQkgCW5UZm9vdCA9IG9TZXR0aW5ncy5uVGFibGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3Rmb290JykubGVuZ3RoID09PSAwID8gbnVsbCA6IAoJCQkJCW9TZXR0aW5ncy5uVGFibGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3Rmb290JylbMF0sCgkJCQlvQ2xhc3NlcyA9IG9TZXR0aW5ncy5vQ2xhc3NlczsKCQkJCgkJCW5TY3JvbGxIZWFkLmFwcGVuZENoaWxkKCBuU2Nyb2xsSGVhZElubmVyICk7CgkJCW5TY3JvbGxGb290LmFwcGVuZENoaWxkKCBuU2Nyb2xsRm9vdElubmVyICk7CgkJCW5TY3JvbGxCb2R5LmFwcGVuZENoaWxkKCBvU2V0dGluZ3MublRhYmxlICk7CgkJCW5TY3JvbGxlci5hcHBlbmRDaGlsZCggblNjcm9sbEhlYWQgKTsKCQkJblNjcm9sbGVyLmFwcGVuZENoaWxkKCBuU2Nyb2xsQm9keSApOwoJCQluU2Nyb2xsSGVhZElubmVyLmFwcGVuZENoaWxkKCBuU2Nyb2xsSGVhZFRhYmxlICk7CgkJCW5TY3JvbGxIZWFkVGFibGUuYXBwZW5kQ2hpbGQoIG5UaGVhZCApOwoJCQlpZiAoIG5UZm9vdCAhPT0gbnVsbCApCgkJCXsKCQkJCW5TY3JvbGxlci5hcHBlbmRDaGlsZCggblNjcm9sbEZvb3QgKTsKCQkJCW5TY3JvbGxGb290SW5uZXIuYXBwZW5kQ2hpbGQoIG5TY3JvbGxGb290VGFibGUgKTsKCQkJCW5TY3JvbGxGb290VGFibGUuYXBwZW5kQ2hpbGQoIG5UZm9vdCApOwoJCQl9CgkJCQoJCQluU2Nyb2xsZXIuY2xhc3NOYW1lID0gb0NsYXNzZXMuc1Njcm9sbFdyYXBwZXI7CgkJCW5TY3JvbGxIZWFkLmNsYXNzTmFtZSA9IG9DbGFzc2VzLnNTY3JvbGxIZWFkOwoJCQluU2Nyb2xsSGVhZElubmVyLmNsYXNzTmFtZSA9IG9DbGFzc2VzLnNTY3JvbGxIZWFkSW5uZXI7CgkJCW5TY3JvbGxCb2R5LmNsYXNzTmFtZSA9IG9DbGFzc2VzLnNTY3JvbGxCb2R5OwoJCQluU2Nyb2xsRm9vdC5jbGFzc05hbWUgPSBvQ2xhc3Nlcy5zU2Nyb2xsRm9vdDsKCQkJblNjcm9sbEZvb3RJbm5lci5jbGFzc05hbWUgPSBvQ2xhc3Nlcy5zU2Nyb2xsRm9vdElubmVyOwoJCQkKCQkJaWYgKCBvU2V0dGluZ3Mub1Njcm9sbC5iQXV0b0NzcyApCgkJCXsKCQkJCW5TY3JvbGxIZWFkLnN0eWxlLm92ZXJmbG93ID0gImhpZGRlbiI7CgkJCQluU2Nyb2xsSGVhZC5zdHlsZS5wb3NpdGlvbiA9ICJyZWxhdGl2ZSI7CgkJCQluU2Nyb2xsRm9vdC5zdHlsZS5vdmVyZmxvdyA9ICJoaWRkZW4iOwoJCQkJblNjcm9sbEJvZHkuc3R5bGUub3ZlcmZsb3cgPSAiYXV0byI7CgkJCX0KCQkJCgkJCW5TY3JvbGxIZWFkLnN0eWxlLmJvcmRlciA9ICIwIjsKCQkJblNjcm9sbEhlYWQuc3R5bGUud2lkdGggPSAiMTAwJSI7CgkJCW5TY3JvbGxGb290LnN0eWxlLmJvcmRlciA9ICIwIjsKCQkJblNjcm9sbEhlYWRJbm5lci5zdHlsZS53aWR0aCA9IG9TZXR0aW5ncy5vU2Nyb2xsLnNYSW5uZXIgIT09ICIiID8KCQkJCW9TZXR0aW5ncy5vU2Nyb2xsLnNYSW5uZXIgOiAiMTAwJSI7IC8qIHdpbGwgYmUgb3ZlcndyaXR0ZW4gKi8KCQkJCgkJCS8qIE1vZGlmeSBhdHRyaWJ1dGVzIHRvIHJlc3BlY3QgdGhlIGNsb25lcyAqLwoJCQluU2Nyb2xsSGVhZFRhYmxlLnJlbW92ZUF0dHJpYnV0ZSgnaWQnKTsKCQkJblNjcm9sbEhlYWRUYWJsZS5zdHlsZS5tYXJnaW5MZWZ0ID0gIjAiOwoJCQlvU2V0dGluZ3MublRhYmxlLnN0eWxlLm1hcmdpbkxlZnQgPSAiMCI7CgkJCWlmICggblRmb290ICE9PSBudWxsICkKCQkJewoJCQkJblNjcm9sbEZvb3RUYWJsZS5yZW1vdmVBdHRyaWJ1dGUoJ2lkJyk7CgkJCQluU2Nyb2xsRm9vdFRhYmxlLnN0eWxlLm1hcmdpbkxlZnQgPSAiMCI7CgkJCX0KCQkJCgkJCS8qIE1vdmUgY2FwdGlvbiBlbGVtZW50cyBmcm9tIHRoZSBib2R5IHRvIHRoZSBoZWFkZXIsIGZvb3RlciBvciBsZWF2ZSB3aGVyZSBpdCBpcwoJCQkgKiBkZXBlbmRpbmcgb24gdGhlIGNvbmZpZ3VyYXRpb24uIE5vdGUgdGhhdCB0aGUgRFREIHNheXMgdGhlcmUgY2FuIGJlIG9ubHkgb25lIGNhcHRpb24gKi8KCQkJdmFyIG5DYXB0aW9uID0gJChvU2V0dGluZ3MublRhYmxlKS5jaGlsZHJlbignY2FwdGlvbicpOwoJCQlpZiAoIG5DYXB0aW9uLmxlbmd0aCA+IDAgKQoJCQl7CgkJCQluQ2FwdGlvbiA9IG5DYXB0aW9uWzBdOwoJCQkJaWYgKCBuQ2FwdGlvbi5fY2FwdGlvblNpZGUgPT09ICJ0b3AiICkKCQkJCXsKCQkJCQluU2Nyb2xsSGVhZFRhYmxlLmFwcGVuZENoaWxkKCBuQ2FwdGlvbiApOwoJCQkJfQoJCQkJZWxzZSBpZiAoIG5DYXB0aW9uLl9jYXB0aW9uU2lkZSA9PT0gImJvdHRvbSIgJiYgblRmb290ICkKCQkJCXsKCQkJCQluU2Nyb2xsRm9vdFRhYmxlLmFwcGVuZENoaWxkKCBuQ2FwdGlvbiApOwoJCQkJfQoJCQl9CgkJCQoJCQkvKgoJCQkgKiBTaXppbmcKCQkJICovCgkJCS8qIFdoZW4geHNjcm9sbGluZyBhZGQgdGhlIHdpZHRoIGFuZCBhIHNjcm9sbGVyIHRvIG1vdmUgdGhlIGhlYWRlciB3aXRoIHRoZSBib2R5ICovCgkJCWlmICggb1NldHRpbmdzLm9TY3JvbGwuc1ggIT09ICIiICkKCQkJewoJCQkJblNjcm9sbEhlYWQuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0Nzcyggb1NldHRpbmdzLm9TY3JvbGwuc1ggKTsKCQkJCW5TY3JvbGxCb2R5LnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIG9TZXR0aW5ncy5vU2Nyb2xsLnNYICk7CgkJCQkKCQkJCWlmICggblRmb290ICE9PSBudWxsICkKCQkJCXsKCQkJCQluU2Nyb2xsRm9vdC5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBvU2V0dGluZ3Mub1Njcm9sbC5zWCApOwkKCQkJCX0KCQkJCQoJCQkJLyogV2hlbiB0aGUgYm9keSBpcyBzY3JvbGxlZCwgdGhlbiB3ZSBhbHNvIHdhbnQgdG8gc2Nyb2xsIHRoZSBoZWFkZXJzICovCgkJCQkkKG5TY3JvbGxCb2R5KS5zY3JvbGwoIGZ1bmN0aW9uIChlKSB7CgkJCQkJblNjcm9sbEhlYWQuc2Nyb2xsTGVmdCA9IHRoaXMuc2Nyb2xsTGVmdDsKCQkJCQkKCQkJCQlpZiAoIG5UZm9vdCAhPT0gbnVsbCApCgkJCQkJewoJCQkJCQluU2Nyb2xsRm9vdC5zY3JvbGxMZWZ0ID0gdGhpcy5zY3JvbGxMZWZ0OwoJCQkJCX0KCQkJCX0gKTsKCQkJfQoJCQkKCQkJLyogV2hlbiB5c2Nyb2xsaW5nLCBhZGQgdGhlIGhlaWdodCAqLwoJCQlpZiAoIG9TZXR0aW5ncy5vU2Nyb2xsLnNZICE9PSAiIiApCgkJCXsKCQkJCW5TY3JvbGxCb2R5LnN0eWxlLmhlaWdodCA9IF9mblN0cmluZ1RvQ3NzKCBvU2V0dGluZ3Mub1Njcm9sbC5zWSApOwoJCQl9CgkJCQoJCQkvKiBSZWRyYXcgLSBhbGlnbiBjb2x1bW5zIGFjcm9zcyB0aGUgdGFibGVzICovCgkJCW9TZXR0aW5ncy5hb0RyYXdDYWxsYmFjay5wdXNoKCB7CgkJCQkiZm4iOiBfZm5TY3JvbGxEcmF3LAoJCQkJInNOYW1lIjogInNjcm9sbGluZyIKCQkJfSApOwoJCQkKCQkJLyogSW5maW5pdGUgc2Nyb2xsaW5nIGV2ZW50IGhhbmRsZXJzICovCgkJCWlmICggb1NldHRpbmdzLm9TY3JvbGwuYkluZmluaXRlICkKCQkJewoJCQkJJChuU2Nyb2xsQm9keSkuc2Nyb2xsKCBmdW5jdGlvbigpIHsKCQkJCQkvKiBVc2UgYSBibG9ja2VyIHRvIHN0b3Agc2Nyb2xsaW5nIGZyb20gbG9hZGluZyBtb3JlIGRhdGEgd2hpbGUgb3RoZXIgZGF0YSBpcyBzdGlsbCBsb2FkaW5nICovCgkJCQkJaWYgKCAhb1NldHRpbmdzLmJEcmF3aW5nICYmICQodGhpcykuc2Nyb2xsVG9wKCkgIT09IDAgKQoJCQkJCXsKCQkJCQkJLyogQ2hlY2sgaWYgd2Ugc2hvdWxkIGxvYWQgdGhlIG5leHQgZGF0YSBzZXQgKi8KCQkJCQkJaWYgKCAkKHRoaXMpLnNjcm9sbFRvcCgpICsgJCh0aGlzKS5oZWlnaHQoKSA+IAoJCQkJCQkJJChvU2V0dGluZ3MublRhYmxlKS5oZWlnaHQoKSAtIG9TZXR0aW5ncy5vU2Nyb2xsLmlMb2FkR2FwICkKCQkJCQkJewoJCQkJCQkJLyogT25seSBkbyB0aGUgcmVkcmF3IGlmIHdlIGhhdmUgdG8gLSB3ZSBtaWdodCBiZSBhdCB0aGUgZW5kIG9mIHRoZSBkYXRhICovCgkJCQkJCQlpZiAoIG9TZXR0aW5ncy5mbkRpc3BsYXlFbmQoKSA8IG9TZXR0aW5ncy5mblJlY29yZHNEaXNwbGF5KCkgKQoJCQkJCQkJewoJCQkJCQkJCV9mblBhZ2VDaGFuZ2UoIG9TZXR0aW5ncywgJ25leHQnICk7CgkJCQkJCQkJX2ZuQ2FsY3VsYXRlRW5kKCBvU2V0dGluZ3MgKTsKCQkJCQkJCQlfZm5EcmF3KCBvU2V0dGluZ3MgKTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCQkJCX0gKTsKCQkJfQoJCQkKCQkJb1NldHRpbmdzLm5TY3JvbGxIZWFkID0gblNjcm9sbEhlYWQ7CgkJCW9TZXR0aW5ncy5uU2Nyb2xsRm9vdCA9IG5TY3JvbGxGb290OwoJCQkKCQkJcmV0dXJuIG5TY3JvbGxlcjsKCQl9CgkJCgkJCgkJLyoqCgkJICogVXBkYXRlIHRoZSB2YXJpb3VzIHRhYmxlcyBmb3IgcmVzaXppbmcuIEl0J3MgYSBiaXQgb2YgYSBwaWcgdGhpcyBmdW5jdGlvbiwgYnV0CgkJICogYmFzaWNhbGx5IHRoZSBpZGVhIHRvOgoJCSAqICAgMS4gUmUtY3JlYXRlIHRoZSB0YWJsZSBpbnNpZGUgdGhlIHNjcm9sbGluZyBkaXYKCQkgKiAgIDIuIFRha2UgbGl2ZSBtZWFzdXJlbWVudHMgZnJvbSB0aGUgRE9NCgkJICogICAzLiBBcHBseSB0aGUgbWVhc3VyZW1lbnRzCgkJICogICA0LiBDbGVhbiB1cAoJCSAqICBAcGFyYW0ge29iamVjdH0gbyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcmV0dXJucyB7bm9kZX0gTm9kZSB0byBhZGQgdG8gdGhlIERPTQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5TY3JvbGxEcmF3ICggbyApCgkJewoJCQl2YXIKCQkJCW5TY3JvbGxIZWFkSW5uZXIgPSBvLm5TY3JvbGxIZWFkLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdkaXYnKVswXSwKCQkJCW5TY3JvbGxIZWFkVGFibGUgPSBuU2Nyb2xsSGVhZElubmVyLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0YWJsZScpWzBdLAoJCQkJblNjcm9sbEJvZHkgPSBvLm5UYWJsZS5wYXJlbnROb2RlLAoJCQkJaSwgaUxlbiwgaiwgakxlbiwgYW5IZWFkVG9TaXplLCBhbkhlYWRTaXplcnMsIGFuRm9vdFNpemVycywgYW5Gb290VG9TaXplLCBvU3R5bGUsIGlWaXMsCgkJCQluVGhlYWRTaXplLCBuVGZvb3RTaXplLAoJCQkJaVdpZHRoLCBhQXBwbGllZD1bXSwgaVNhbml0eVdpZHRoLAoJCQkJblNjcm9sbEZvb3RJbm5lciA9IChvLm5URm9vdCAhPT0gbnVsbCkgPyBvLm5TY3JvbGxGb290LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdkaXYnKVswXSA6IG51bGwsCgkJCQluU2Nyb2xsRm9vdFRhYmxlID0gKG8ublRGb290ICE9PSBudWxsKSA/IG5TY3JvbGxGb290SW5uZXIuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RhYmxlJylbMF0gOiBudWxsLAoJCQkJaWU2NyA9ICQuYnJvd3Nlci5tc2llICYmICQuYnJvd3Nlci52ZXJzaW9uIDw9IDc7CgkJCQoJCQkvKgoJCQkgKiAxLiBSZS1jcmVhdGUgdGhlIHRhYmxlIGluc2lkZSB0aGUgc2Nyb2xsaW5nIGRpdgoJCQkgKi8KCQkJCgkJCS8qIFJlbW92ZSB0aGUgb2xkIG1pbmltaXNlZCB0aGVhZCBhbmQgdGZvb3QgZWxlbWVudHMgaW4gdGhlIGlubmVyIHRhYmxlICovCgkJCSQoby5uVGFibGUpLmNoaWxkcmVuKCd0aGVhZCwgdGZvb3QnKS5yZW1vdmUoKTsKCQkKCQkJLyogQ2xvbmUgdGhlIGN1cnJlbnQgaGVhZGVyIGFuZCBmb290ZXIgZWxlbWVudHMgYW5kIHRoZW4gcGxhY2UgaXQgaW50byB0aGUgaW5uZXIgdGFibGUgKi8KCQkJblRoZWFkU2l6ZSA9ICQoby5uVEhlYWQpLmNsb25lKClbMF07CgkJCW8ublRhYmxlLmluc2VydEJlZm9yZSggblRoZWFkU2l6ZSwgby5uVGFibGUuY2hpbGROb2Rlc1swXSApOwoJCQkKCQkJaWYgKCBvLm5URm9vdCAhPT0gbnVsbCApCgkJCXsKCQkJCW5UZm9vdFNpemUgPSAkKG8ublRGb290KS5jbG9uZSgpWzBdOwoJCQkJby5uVGFibGUuaW5zZXJ0QmVmb3JlKCBuVGZvb3RTaXplLCBvLm5UYWJsZS5jaGlsZE5vZGVzWzFdICk7CgkJCX0KCQkJCgkJCS8qCgkJCSAqIDIuIFRha2UgbGl2ZSBtZWFzdXJlbWVudHMgZnJvbSB0aGUgRE9NIC0gZG8gbm90IGFsdGVyIHRoZSBET00gaXRzZWxmIQoJCQkgKi8KCQkJCgkJCS8qIFJlbW92ZSBvbGQgc2l6aW5nIGFuZCBhcHBseSB0aGUgY2FsY3VsYXRlZCBjb2x1bW4gd2lkdGhzCgkJCSAqIEdldCB0aGUgdW5pcXVlIGNvbHVtbiBoZWFkZXJzIGluIHRoZSBuZXdseSBjcmVhdGVkIChjbG9uZWQpIGhlYWRlci4gV2Ugd2FudCB0byBhcHBseSB0aGUKCQkJICogY2FsY2xhdGVkIHNpemVzIHRvIHRoaXMgaGVhZGVyCgkJCSAqLwoJCQlpZiAoIG8ub1Njcm9sbC5zWCA9PT0gIiIgKQoJCQl7CgkJCQluU2Nyb2xsQm9keS5zdHlsZS53aWR0aCA9ICcxMDAlJzsKCQkJCW5TY3JvbGxIZWFkSW5uZXIucGFyZW50Tm9kZS5zdHlsZS53aWR0aCA9ICcxMDAlJzsKCQkJfQoJCQkKCQkJdmFyIG5UaHMgPSBfZm5HZXRVbmlxdWVUaHMoIG8sIG5UaGVhZFNpemUgKTsKCQkJZm9yICggaT0wLCBpTGVuPW5UaHMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJaVZpcyA9IF9mblZpc2libGVUb0NvbHVtbkluZGV4KCBvLCBpICk7CgkJCQluVGhzW2ldLnN0eWxlLndpZHRoID0gby5hb0NvbHVtbnNbaVZpc10uc1dpZHRoOwoJCQl9CgkJCQoJCQlpZiAoIG8ublRGb290ICE9PSBudWxsICkKCQkJewoJCQkJX2ZuQXBwbHlUb0NoaWxkcmVuKCBmdW5jdGlvbihuKSB7CgkJCQkJbi5zdHlsZS53aWR0aCA9ICIiOwoJCQkJfSwgblRmb290U2l6ZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgndHInKSApOwoJCQl9CgkJCgkJCS8vIElmIHNjcm9sbCBjb2xsYXBzZSBpcyBlbmFibGVkLCB3aGVuIHdlIHB1dCB0aGUgaGVhZGVycyBiYWNrIGludG8gdGhlIGJvZHkgZm9yIHNpemluZywgd2UKCQkJLy8gd2lsbCBlbmQgdXAgZm9yY2luZyB0aGUgc2Nyb2xsYmFyIHRvIGFwcGVhciwgbWFraW5nIG91ciBtZWFzdXJlbWVudHMgd3JvbmcgZm9yIHdoZW4gd2UKCQkJLy8gdGhlbiBoaWRlIGl0IChlbmQgb2YgdGhpcyBmdW5jdGlvbiksIHNvIGFkZCB0aGUgaGVhZGVyIGhlaWdodCB0byB0aGUgYm9keSBzY3JvbGxlci4KCQkJaWYgKCBvLm9TY3JvbGwuYkNvbGxhcHNlICYmIG8ub1Njcm9sbC5zWSAhPT0gIiIgKQoJCQl7CgkJCQluU2Nyb2xsQm9keS5zdHlsZS5oZWlnaHQgPSAoblNjcm9sbEJvZHkub2Zmc2V0SGVpZ2h0ICsgby5uVEhlYWQub2Zmc2V0SGVpZ2h0KSsicHgiOwoJCQl9CgkJCQoJCQkvKiBTaXplIHRoZSB0YWJsZSBhcyBhIHdob2xlICovCgkJCWlTYW5pdHlXaWR0aCA9ICQoby5uVGFibGUpLm91dGVyV2lkdGgoKTsKCQkJaWYgKCBvLm9TY3JvbGwuc1ggPT09ICIiICkKCQkJewoJCQkJLyogTm8geCBzY3JvbGxpbmcgKi8KCQkJCW8ublRhYmxlLnN0eWxlLndpZHRoID0gIjEwMCUiOwoJCQkJCgkJCQkvKiBJIGtub3cgdGhpcyBpcyBydWJiaXNoIC0gYnV0IElFNyB3aWxsIG1ha2UgdGhlIHdpZHRoIG9mIHRoZSB0YWJsZSB3aGVuIDEwMCUgaW5jbHVkZQoJCQkJICogdGhlIHNjcm9sbGJhciAtIHdoaWNoIGlzIHNob3VsZG4ndC4gV2hlbiB0aGVyZSBpcyBhIHNjcm9sbGJhciB3ZSBuZWVkIHRvIHRha2UgdGhpcwoJCQkJICogaW50byBhY2NvdW50LgoJCQkJICovCgkJCQlpZiAoIGllNjcgJiYgKCQoJ3Rib2R5JywgblNjcm9sbEJvZHkpLmhlaWdodCgpID4gblNjcm9sbEJvZHkub2Zmc2V0SGVpZ2h0IHx8IAoJCQkJCSQoblNjcm9sbEJvZHkpLmNzcygnb3ZlcmZsb3cteScpID09ICJzY3JvbGwiKSAgKQoJCQkJewoJCQkJCW8ublRhYmxlLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoICQoby5uVGFibGUpLm91dGVyV2lkdGgoKSAtIG8ub1Njcm9sbC5pQmFyV2lkdGgpOwoJCQkJfQoJCQl9CgkJCWVsc2UKCQkJewoJCQkJaWYgKCBvLm9TY3JvbGwuc1hJbm5lciAhPT0gIiIgKQoJCQkJewoJCQkJCS8qIHggc2Nyb2xsIGlubmVyIGhhcyBiZWVuIGdpdmVuIC0gdXNlIGl0ICovCgkJCQkJby5uVGFibGUuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyhvLm9TY3JvbGwuc1hJbm5lcik7CgkJCQl9CgkJCQllbHNlIGlmICggaVNhbml0eVdpZHRoID09ICQoblNjcm9sbEJvZHkpLndpZHRoKCkgJiYKCQkJCSAgICQoblNjcm9sbEJvZHkpLmhlaWdodCgpIDwgJChvLm5UYWJsZSkuaGVpZ2h0KCkgKQoJCQkJewoJCQkJCS8qIFRoZXJlIGlzIHktc2Nyb2xsaW5nIC0gdHJ5IHRvIHRha2UgYWNjb3VudCBvZiB0aGUgeSBzY3JvbGwgYmFyICovCgkJCQkJby5uVGFibGUuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggaVNhbml0eVdpZHRoLW8ub1Njcm9sbC5pQmFyV2lkdGggKTsKCQkJCQlpZiAoICQoby5uVGFibGUpLm91dGVyV2lkdGgoKSA+IGlTYW5pdHlXaWR0aC1vLm9TY3JvbGwuaUJhcldpZHRoICkKCQkJCQl7CgkJCQkJCS8qIE5vdCBwb3NzaWJsZSB0byB0YWtlIGFjY291bnQgb2YgaXQgKi8KCQkJCQkJby5uVGFibGUuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggaVNhbml0eVdpZHRoICk7CgkJCQkJfQoJCQkJfQoJCQkJZWxzZQoJCQkJewoJCQkJCS8qIEFsbCBlbHNlIGZhaWxzICovCgkJCQkJby5uVGFibGUuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggaVNhbml0eVdpZHRoICk7CgkJCQl9CgkJCX0KCQkJCgkJCS8qIFJlY2FsY3VsYXRlIHRoZSBzYW5pdHkgd2lkdGggLSBub3cgdGhhdCB3ZSd2ZSBhcHBsaWVkIHRoZSByZXF1aXJlZCB3aWR0aCwgYmVmb3JlIGl0IHdhcwoJCQkgKiBhIHRlbXBvcmFyeSB2YXJpYWJsZS4gVGhpcyBpcyByZXF1aXJlZCBiZWNhdXNlIHRoZSBjb2x1bW4gd2lkdGggY2FsY3VsYXRpb24gaXMgZG9uZQoJCQkgKiBiZWZvcmUgdGhpcyB0YWJsZSBET00gaXMgY3JlYXRlZC4KCQkJICovCgkJCWlTYW5pdHlXaWR0aCA9ICQoby5uVGFibGUpLm91dGVyV2lkdGgoKTsKCQkJCgkJCS8qIFdlIHdhbnQgdGhlIGhpZGRlbiBoZWFkZXIgdG8gaGF2ZSB6ZXJvIGhlaWdodCwgc28gcmVtb3ZlIHBhZGRpbmcgYW5kIGJvcmRlcnMuIFRoZW4KCQkJICogc2V0IHRoZSB3aWR0aCBiYXNlZCBvbiB0aGUgcmVhbCBoZWFkZXJzCgkJCSAqLwoJCQlhbkhlYWRUb1NpemUgPSBvLm5USGVhZC5nZXRFbGVtZW50c0J5VGFnTmFtZSgndHInKTsKCQkJYW5IZWFkU2l6ZXJzID0gblRoZWFkU2l6ZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgndHInKTsKCQkJCgkJCV9mbkFwcGx5VG9DaGlsZHJlbiggZnVuY3Rpb24oblNpemVyLCBuVG9TaXplKSB7CgkJCQlvU3R5bGUgPSBuU2l6ZXIuc3R5bGU7CgkJCQlvU3R5bGUucGFkZGluZ1RvcCA9ICIwIjsKCQkJCW9TdHlsZS5wYWRkaW5nQm90dG9tID0gIjAiOwoJCQkJb1N0eWxlLmJvcmRlclRvcFdpZHRoID0gIjAiOwoJCQkJb1N0eWxlLmJvcmRlckJvdHRvbVdpZHRoID0gIjAiOwoJCQkJb1N0eWxlLmhlaWdodCA9IDA7CgkJCQkKCQkJCWlXaWR0aCA9ICQoblNpemVyKS53aWR0aCgpOwoJCQkJblRvU2l6ZS5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBpV2lkdGggKTsKCQkJCWFBcHBsaWVkLnB1c2goIGlXaWR0aCApOwoJCQl9LCBhbkhlYWRTaXplcnMsIGFuSGVhZFRvU2l6ZSApOwoJCQkkKGFuSGVhZFNpemVycykuaGVpZ2h0KDApOwoJCQkKCQkJaWYgKCBvLm5URm9vdCAhPT0gbnVsbCApCgkJCXsKCQkJCS8qIENsb25lIHRoZSBjdXJyZW50IGZvb3RlciBhbmQgdGhlbiBwbGFjZSBpdCBpbnRvIHRoZSBib2R5IHRhYmxlIGFzIGEgImhpZGRlbiBoZWFkZXIiICovCgkJCQlhbkZvb3RTaXplcnMgPSBuVGZvb3RTaXplLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0cicpOwoJCQkJYW5Gb290VG9TaXplID0gby5uVEZvb3QuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RyJyk7CgkJCQkKCQkJCV9mbkFwcGx5VG9DaGlsZHJlbiggZnVuY3Rpb24oblNpemVyLCBuVG9TaXplKSB7CgkJCQkJb1N0eWxlID0gblNpemVyLnN0eWxlOwoJCQkJCW9TdHlsZS5wYWRkaW5nVG9wID0gIjAiOwoJCQkJCW9TdHlsZS5wYWRkaW5nQm90dG9tID0gIjAiOwoJCQkJCW9TdHlsZS5ib3JkZXJUb3BXaWR0aCA9ICIwIjsKCQkJCQlvU3R5bGUuYm9yZGVyQm90dG9tV2lkdGggPSAiMCI7CgkJCQkJb1N0eWxlLmhlaWdodCA9IDA7CgkJCQkJCgkJCQkJaVdpZHRoID0gJChuU2l6ZXIpLndpZHRoKCk7CgkJCQkJblRvU2l6ZS5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBpV2lkdGggKTsKCQkJCQlhQXBwbGllZC5wdXNoKCBpV2lkdGggKTsKCQkJCX0sIGFuRm9vdFNpemVycywgYW5Gb290VG9TaXplICk7CgkJCQkkKGFuRm9vdFNpemVycykuaGVpZ2h0KDApOwoJCQl9CgkJCQoJCQkvKgoJCQkgKiAzLiBBcHBseSB0aGUgbWVhc3VyZW1lbnRzCgkJCSAqLwoJCQkKCQkJLyogIkhpZGUiIHRoZSBoZWFkZXIgYW5kIGZvb3RlciB0aGF0IHdlIHVzZWQgZm9yIHRoZSBzaXppbmcuIFdlIHdhbnQgdG8gYWxzbyBmaXggdGhlaXIgd2lkdGgKCQkJICogdG8gd2hhdCB0aGV5IGN1cnJlbnRseSBhcmUKCQkJICovCgkJCV9mbkFwcGx5VG9DaGlsZHJlbiggZnVuY3Rpb24oblNpemVyKSB7CgkJCQluU2l6ZXIuaW5uZXJIVE1MID0gIiI7CgkJCQluU2l6ZXIuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggYUFwcGxpZWQuc2hpZnQoKSApOwoJCQl9LCBhbkhlYWRTaXplcnMgKTsKCQkJCgkJCWlmICggby5uVEZvb3QgIT09IG51bGwgKQoJCQl7CgkJCQlfZm5BcHBseVRvQ2hpbGRyZW4oIGZ1bmN0aW9uKG5TaXplcikgewoJCQkJCW5TaXplci5pbm5lckhUTUwgPSAiIjsKCQkJCQluU2l6ZXIuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggYUFwcGxpZWQuc2hpZnQoKSApOwoJCQkJfSwgYW5Gb290U2l6ZXJzICk7CgkJCX0KCQkJCgkJCS8qIFNhbml0eSBjaGVjayB0aGF0IHRoZSB0YWJsZSBpcyBvZiBhIHNlbnNpYmxlIHdpZHRoLiBJZiBub3QgdGhlbiB3ZSBhcmUgZ29pbmcgdG8gZ2V0CgkJCSAqIG1pc2FsaWdubWVudCAtIHRyeSB0byBwcmV2ZW50IHRoaXMgYnkgbm90IGFsbG93aW5nIHRoZSB0YWJsZSB0byBzaHJpbmsgYmVsb3cgaXRzIG1pbiB3aWR0aAoJCQkgKi8KCQkJaWYgKCAkKG8ublRhYmxlKS5vdXRlcldpZHRoKCkgPCBpU2FuaXR5V2lkdGggKQoJCQl7CgkJCQkvKiBUaGUgbWluIHdpZHRoIGRlcGVuZHMgdXBvbiBpZiB3ZSBoYXZlIGEgdmVydGljYWwgc2Nyb2xsYmFyIHZpc2libGUgb3Igbm90ICovCgkJCQl2YXIgaUNvcnJlY3Rpb24gPSAoKG5TY3JvbGxCb2R5LnNjcm9sbEhlaWdodCA+IG5TY3JvbGxCb2R5Lm9mZnNldEhlaWdodCB8fCAKCQkJCQkkKG5TY3JvbGxCb2R5KS5jc3MoJ292ZXJmbG93LXknKSA9PSAic2Nyb2xsIikpID8KCQkJCQkJaVNhbml0eVdpZHRoK28ub1Njcm9sbC5pQmFyV2lkdGggOiBpU2FuaXR5V2lkdGg7CgkJCQkKCQkJCS8qIElFNi83IGFyZSBhIGxhdyB1bnRvIHRoZW1zZWx2ZXMuLi4gKi8KCQkJCWlmICggaWU2NyAmJiAoblNjcm9sbEJvZHkuc2Nyb2xsSGVpZ2h0ID4gCgkJCQkJblNjcm9sbEJvZHkub2Zmc2V0SGVpZ2h0IHx8ICQoblNjcm9sbEJvZHkpLmNzcygnb3ZlcmZsb3cteScpID09ICJzY3JvbGwiKSAgKQoJCQkJewoJCQkJCW8ublRhYmxlLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGlDb3JyZWN0aW9uLW8ub1Njcm9sbC5pQmFyV2lkdGggKTsKCQkJCX0KCQkJCQoJCQkJLyogQXBwbHkgdGhlIGNhbGN1bGF0ZWQgbWluaW11bSB3aWR0aCB0byB0aGUgdGFibGUgd3JhcHBlcnMgKi8KCQkJCW5TY3JvbGxCb2R5LnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGlDb3JyZWN0aW9uICk7CgkJCQluU2Nyb2xsSGVhZElubmVyLnBhcmVudE5vZGUuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggaUNvcnJlY3Rpb24gKTsKCQkJCQoJCQkJaWYgKCBvLm5URm9vdCAhPT0gbnVsbCApCgkJCQl7CgkJCQkJblNjcm9sbEZvb3RJbm5lci5wYXJlbnROb2RlLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGlDb3JyZWN0aW9uICk7CgkJCQl9CgkJCQkKCQkJCS8qIEFuZCBnaXZlIHRoZSB1c2VyIGEgd2FybmluZyB0aGF0IHdlJ3ZlIHN0b3BwZWQgdGhlIHRhYmxlIGdldHRpbmcgdG9vIHNtYWxsICovCgkJCQlpZiAoIG8ub1Njcm9sbC5zWCA9PT0gIiIgKQoJCQkJewoJCQkJCV9mbkxvZyggbywgMSwgIlRoZSB0YWJsZSBjYW5ub3QgZml0IGludG8gdGhlIGN1cnJlbnQgZWxlbWVudCB3aGljaCB3aWxsIGNhdXNlIGNvbHVtbiIrCgkJCQkJCSIgbWlzYWxpZ25tZW50LiBUaGUgdGFibGUgaGFzIGJlZW4gZHJhd24gYXQgaXRzIG1pbmltdW0gcG9zc2libGUgd2lkdGguIiApOwoJCQkJfQoJCQkJZWxzZSBpZiAoIG8ub1Njcm9sbC5zWElubmVyICE9PSAiIiApCgkJCQl7CgkJCQkJX2ZuTG9nKCBvLCAxLCAiVGhlIHRhYmxlIGNhbm5vdCBmaXQgaW50byB0aGUgY3VycmVudCBlbGVtZW50IHdoaWNoIHdpbGwgY2F1c2UgY29sdW1uIisKCQkJCQkJIiBtaXNhbGlnbm1lbnQuIEluY3JlYXNlIHRoZSBzU2Nyb2xsWElubmVyIHZhbHVlIG9yIHJlbW92ZSBpdCB0byBhbGxvdyBhdXRvbWF0aWMiKwoJCQkJCQkiIGNhbGN1bGF0aW9uIiApOwoJCQkJfQoJCQl9CgkJCWVsc2UKCQkJewoJCQkJblNjcm9sbEJvZHkuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggJzEwMCUnICk7CgkJCQluU2Nyb2xsSGVhZElubmVyLnBhcmVudE5vZGUuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggJzEwMCUnICk7CgkJCQkKCQkJCWlmICggby5uVEZvb3QgIT09IG51bGwgKQoJCQkJewoJCQkJCW5TY3JvbGxGb290SW5uZXIucGFyZW50Tm9kZS5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCAnMTAwJScgKTsKCQkJCX0KCQkJfQoJCQkKCQkJCgkJCS8qCgkJCSAqIDQuIENsZWFuIHVwCgkJCSAqLwoJCQlpZiAoIG8ub1Njcm9sbC5zWSA9PT0gIiIgKQoJCQl7CgkJCQkvKiBJRTc8IHB1dHMgYSB2ZXJ0aWNhbCBzY3JvbGxiYXIgaW4gcGxhY2UgKHdoZW4gaXQgc2hvdWxkbid0IGJlKSBkdWUgdG8gc3VidHJhY3RpbmcKCQkJCSAqIHRoZSBzY3JvbGxiYXIgaGVpZ2h0IGZyb20gdGhlIHZpc2libGUgZGlzcGxheSwgcmF0aGVyIHRoYW4gYWRkaW5nIGl0IG9uLiBXZSBuZWVkIHRvCgkJCQkgKiBzZXQgdGhlIGhlaWdodCBpbiBvcmRlciB0byBzb3J0IHRoaXMuIERvbid0IHdhbnQgdG8gZG8gaXQgaW4gYW55IG90aGVyIGJyb3dzZXJzLgoJCQkJICovCgkJCQlpZiAoIGllNjcgKQoJCQkJewoJCQkJCW5TY3JvbGxCb2R5LnN0eWxlLmhlaWdodCA9IF9mblN0cmluZ1RvQ3NzKCBvLm5UYWJsZS5vZmZzZXRIZWlnaHQrby5vU2Nyb2xsLmlCYXJXaWR0aCApOwoJCQkJfQoJCQl9CgkJCQoJCQlpZiAoIG8ub1Njcm9sbC5zWSAhPT0gIiIgJiYgby5vU2Nyb2xsLmJDb2xsYXBzZSApCgkJCXsKCQkJCW5TY3JvbGxCb2R5LnN0eWxlLmhlaWdodCA9IF9mblN0cmluZ1RvQ3NzKCBvLm9TY3JvbGwuc1kgKTsKCQkJCQoJCQkJdmFyIGlFeHRyYSA9IChvLm9TY3JvbGwuc1ggIT09ICIiICYmIG8ublRhYmxlLm9mZnNldFdpZHRoID4gblNjcm9sbEJvZHkub2Zmc2V0V2lkdGgpID8KCQkJCSAJby5vU2Nyb2xsLmlCYXJXaWR0aCA6IDA7CgkJCQlpZiAoIG8ublRhYmxlLm9mZnNldEhlaWdodCA8IG5TY3JvbGxCb2R5Lm9mZnNldEhlaWdodCApCgkJCQl7CgkJCQkJblNjcm9sbEJvZHkuc3R5bGUuaGVpZ2h0ID0gX2ZuU3RyaW5nVG9Dc3MoIG8ublRhYmxlLm9mZnNldEhlaWdodCtpRXh0cmEgKTsKCQkJCX0KCQkJfQoJCQkKCQkJLyogRmluYWxseSBzZXQgdGhlIHdpZHRoJ3Mgb2YgdGhlIGhlYWRlciBhbmQgZm9vdGVyIHRhYmxlcyAqLwoJCQl2YXIgaU91dGVyV2lkdGggPSAkKG8ublRhYmxlKS5vdXRlcldpZHRoKCk7CgkJCW5TY3JvbGxIZWFkVGFibGUuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggaU91dGVyV2lkdGggKTsKCQkJblNjcm9sbEhlYWRJbm5lci5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBpT3V0ZXJXaWR0aCApOwoJCQoJCQkvLyBGaWd1cmUgb3V0IGlmIHRoZXJlIGFyZSBzY3JvbGxiYXIgcHJlc2VudCAtIGlmIHNvIHRoZW4gd2UgbmVlZCBhIHRoZSBoZWFkZXIgYW5kIGZvb3RlciB0bwoJCQkvLyBwcm92aWRlIGEgYml0IG1vcmUgc3BhY2UgdG8gYWxsb3cgIm92ZXJmbG93IiBzY3JvbGxpbmcgKGkuZS4gcGFzdCB0aGUgc2Nyb2xsYmFyKQoJCQl2YXIgYlNjcm9sbGluZyA9ICQoby5uVGFibGUpLmhlaWdodCgpID4gblNjcm9sbEJvZHkuY2xpZW50SGVpZ2h0IHx8ICQoblNjcm9sbEJvZHkpLmNzcygnb3ZlcmZsb3cteScpID09ICJzY3JvbGwiOwoJCQluU2Nyb2xsSGVhZElubmVyLnN0eWxlLnBhZGRpbmdSaWdodCA9IGJTY3JvbGxpbmcgPyBvLm9TY3JvbGwuaUJhcldpZHRoKyJweCIgOiAiMHB4IjsKCQkJCgkJCWlmICggby5uVEZvb3QgIT09IG51bGwgKQoJCQl7CgkJCQluU2Nyb2xsRm9vdFRhYmxlLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGlPdXRlcldpZHRoICk7CgkJCQluU2Nyb2xsRm9vdElubmVyLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGlPdXRlcldpZHRoICk7CgkJCQluU2Nyb2xsRm9vdElubmVyLnN0eWxlLnBhZGRpbmdSaWdodCA9IGJTY3JvbGxpbmcgPyBvLm9TY3JvbGwuaUJhcldpZHRoKyJweCIgOiAiMHB4IjsKCQkJfQoJCQoJCQkvKiBBZGp1c3QgdGhlIHBvc2l0aW9uIG9mIHRoZSBoZWFkZXIgaW5jYXNlIHdlIGxvb3NlIHRoZSB5LXNjcm9sbGJhciAqLwoJCQkkKG5TY3JvbGxCb2R5KS5zY3JvbGwoKTsKCQkJCgkJCS8qIElmIHNvcnRpbmcgb3IgZmlsdGVyaW5nIGhhcyBvY2N1cnJlZCwganVtcCB0aGUgc2Nyb2xsaW5nIGJhY2sgdG8gdGhlIHRvcCAqLwoJCQlpZiAoIG8uYlNvcnRlZCB8fCBvLmJGaWx0ZXJlZCApCgkJCXsKCQkJCW5TY3JvbGxCb2R5LnNjcm9sbFRvcCA9IDA7CgkJCX0KCQl9CgkJCgkJCgkJLyoqCgkJICogQXBwbHkgYSBnaXZlbiBmdW5jdGlvbiB0byB0aGUgZGlzcGxheSBjaGlsZCBub2RlcyBvZiBhbiBlbGVtZW50IGFycmF5ICh0eXBpY2FsbHkKCQkgKiBURCBjaGlsZHJlbiBvZiBUUiByb3dzCgkJICogIEBwYXJhbSB7ZnVuY3Rpb259IGZuIE1ldGhvZCB0byBhcHBseSB0byB0aGUgb2JqZWN0cwoJCSAqICBAcGFyYW0gYXJyYXkge25vZGVzfSBhbjEgTGlzdCBvZiBlbGVtZW50cyB0byBsb29rIHRocm91Z2ggZm9yIGRpc3BsYXkgY2hpbGRyZW4KCQkgKiAgQHBhcmFtIGFycmF5IHtub2Rlc30gYW4yIEFub3RoZXIgbGlzdCAoaWRlbnRpY2FsIHN0cnVjdHVyZSB0byB0aGUgZmlyc3QpIC0gb3B0aW9uYWwKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuQXBwbHlUb0NoaWxkcmVuKCBmbiwgYW4xLCBhbjIgKQoJCXsKCQkJZm9yICggdmFyIGk9MCwgaUxlbj1hbjEubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJZm9yICggdmFyIGo9MCwgakxlbj1hbjFbaV0uY2hpbGROb2Rlcy5sZW5ndGggOyBqPGpMZW4gOyBqKysgKQoJCQkJewoJCQkJCWlmICggYW4xW2ldLmNoaWxkTm9kZXNbal0ubm9kZVR5cGUgPT0gMSApCgkJCQkJewoJCQkJCQlpZiAoIGFuMiApCgkJCQkJCXsKCQkJCQkJCWZuKCBhbjFbaV0uY2hpbGROb2Rlc1tqXSwgYW4yW2ldLmNoaWxkTm9kZXNbal0gKTsKCQkJCQkJfQoJCQkJCQllbHNlCgkJCQkJCXsKCQkJCQkJCWZuKCBhbjFbaV0uY2hpbGROb2Rlc1tqXSApOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoJCQoJCQoJCQoJCS8qKgoJCSAqIENvbnZlcnQgYSBDU1MgdW5pdCB3aWR0aCB0byBwaXhlbHMgKGUuZy4gMmVtKQoJCSAqICBAcGFyYW0ge3N0cmluZ30gc1dpZHRoIHdpZHRoIHRvIGJlIGNvbnZlcnRlZAoJCSAqICBAcGFyYW0ge25vZGV9IG5QYXJlbnQgcGFyZW50IHRvIGdldCB0aGUgd2l0aCBmb3IgKHJlcXVpcmVkIGZvciByZWxhdGl2ZSB3aWR0aHMpIC0gb3B0aW9uYWwKCQkgKiAgQHJldHVybnMge2ludH0gaVdpZHRoIHdpZHRoIGluIHBpeGVscwoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5Db252ZXJ0VG9XaWR0aCAoIHNXaWR0aCwgblBhcmVudCApCgkJewoJCQlpZiAoICFzV2lkdGggfHwgc1dpZHRoID09PSBudWxsIHx8IHNXaWR0aCA9PT0gJycgKQoJCQl7CgkJCQlyZXR1cm4gMDsKCQkJfQoJCQkKCQkJaWYgKCAhblBhcmVudCApCgkJCXsKCQkJCW5QYXJlbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnYm9keScpWzBdOwoJCQl9CgkJCQoJCQl2YXIgaVdpZHRoOwoJCQl2YXIgblRtcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICJkaXYiICk7CgkJCW5UbXAuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0Nzcyggc1dpZHRoICk7CgkJCQoJCQluUGFyZW50LmFwcGVuZENoaWxkKCBuVG1wICk7CgkJCWlXaWR0aCA9IG5UbXAub2Zmc2V0V2lkdGg7CgkJCW5QYXJlbnQucmVtb3ZlQ2hpbGQoIG5UbXAgKTsKCQkJCgkJCXJldHVybiAoIGlXaWR0aCApOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBDYWxjdWxhdGUgdGhlIHdpZHRoIG9mIGNvbHVtbnMgZm9yIHRoZSB0YWJsZQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkNhbGN1bGF0ZUNvbHVtbldpZHRocyAoIG9TZXR0aW5ncyApCgkJewoJCQl2YXIgaVRhYmxlV2lkdGggPSBvU2V0dGluZ3MublRhYmxlLm9mZnNldFdpZHRoOwoJCQl2YXIgaVVzZXJJbnB1dHMgPSAwOwoJCQl2YXIgaVRtcFdpZHRoOwoJCQl2YXIgaVZpc2libGVDb2x1bW5zID0gMDsKCQkJdmFyIGlDb2x1bXMgPSBvU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aDsKCQkJdmFyIGksIGlJbmRleCwgaUNvcnJlY3RvciwgaVdpZHRoOwoJCQl2YXIgb0hlYWRlcnMgPSAkKCd0aCcsIG9TZXR0aW5ncy5uVEhlYWQpOwoJCQl2YXIgd2lkdGhBdHRyID0gb1NldHRpbmdzLm5UYWJsZS5nZXRBdHRyaWJ1dGUoJ3dpZHRoJyk7CgkJCQoJCQkvKiBDb252ZXJ0IGFueSB1c2VyIGlucHV0IHNpemVzIGludG8gcGl4ZWwgc2l6ZXMgKi8KCQkJZm9yICggaT0wIDsgaTxpQ29sdW1zIDsgaSsrICkKCQkJewoJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLmJWaXNpYmxlICkKCQkJCXsKCQkJCQlpVmlzaWJsZUNvbHVtbnMrKzsKCQkJCQkKCQkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc1dpZHRoICE9PSBudWxsICkKCQkJCQl7CgkJCQkJCWlUbXBXaWR0aCA9IF9mbkNvbnZlcnRUb1dpZHRoKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNXaWR0aE9yaWcsIAoJCQkJCQkJb1NldHRpbmdzLm5UYWJsZS5wYXJlbnROb2RlICk7CgkJCQkJCWlmICggaVRtcFdpZHRoICE9PSBudWxsICkKCQkJCQkJewoJCQkJCQkJb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zV2lkdGggPSBfZm5TdHJpbmdUb0NzcyggaVRtcFdpZHRoICk7CgkJCQkJCX0KCQkJCQkJCQoJCQkJCQlpVXNlcklucHV0cysrOwoJCQkJCX0KCQkJCX0KCQkJfQoJCQkKCQkJLyogSWYgdGhlIG51bWJlciBvZiBjb2x1bW5zIGluIHRoZSBET00gZXF1YWxzIHRoZSBudW1iZXIgdGhhdCB3ZSBoYXZlIHRvIHByb2Nlc3MgaW4gCgkJCSAqIERhdGFUYWJsZXMsIHRoZW4gd2UgY2FuIHVzZSB0aGUgb2Zmc2V0cyB0aGF0IGFyZSBjcmVhdGVkIGJ5IHRoZSB3ZWItYnJvd3Nlci4gTm8gY3VzdG9tIAoJCQkgKiBzaXplcyBjYW4gYmUgc2V0IGluIG9yZGVyIGZvciB0aGlzIHRvIGhhcHBlbiwgbm9yIHNjcm9sbGluZyB1c2VkCgkJCSAqLwoJCQlpZiAoIGlDb2x1bXMgPT0gb0hlYWRlcnMubGVuZ3RoICYmIGlVc2VySW5wdXRzID09PSAwICYmIGlWaXNpYmxlQ29sdW1ucyA9PSBpQ29sdW1zICYmCgkJCQlvU2V0dGluZ3Mub1Njcm9sbC5zWCA9PT0gIiIgJiYgb1NldHRpbmdzLm9TY3JvbGwuc1kgPT09ICIiICkKCQkJewoJCQkJZm9yICggaT0wIDsgaTxvU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGkrKyApCgkJCQl7CgkJCQkJaVRtcFdpZHRoID0gJChvSGVhZGVyc1tpXSkud2lkdGgoKTsKCQkJCQlpZiAoIGlUbXBXaWR0aCAhPT0gbnVsbCApCgkJCQkJewoJCQkJCQlvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNXaWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBpVG1wV2lkdGggKTsKCQkJCQl9CgkJCQl9CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQkvKiBPdGhlcndpc2Ugd2UgYXJlIGdvaW5nIHRvIGhhdmUgdG8gZG8gc29tZSBjYWxjdWxhdGlvbnMgdG8gZ2V0IHRoZSB3aWR0aCBvZiBlYWNoIGNvbHVtbi4KCQkJCSAqIENvbnN0cnVjdCBhIDEgcm93IHRhYmxlIHdpdGggdGhlIHdpZGVzdCBub2RlIGluIHRoZSBkYXRhLCBhbmQgYW55IHVzZXIgZGVmaW5lZCB3aWR0aHMsCgkJCQkgKiB0aGVuIGluc2VydCBpdCBpbnRvIHRoZSBET00gYW5kIGFsbG93IHRoZSBicm93c2VyIHRvIGRvIGFsbCB0aGUgaGFyZCB3b3JrIG9mCgkJCQkgKiBjYWxjdWxhdGluZyB0YWJsZSB3aWR0aHMuCgkJCQkgKi8KCQkJCXZhcgoJCQkJCW5DYWxjVG1wID0gb1NldHRpbmdzLm5UYWJsZS5jbG9uZU5vZGUoIGZhbHNlICksCgkJCQkJblRoZWFkQ2xvbmUgPSBvU2V0dGluZ3MublRIZWFkLmNsb25lTm9kZSh0cnVlKSwKCQkJCQluQm9keSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICd0Ym9keScgKSwKCQkJCQluVHIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAndHInICksCgkJCQkJbkRpdlNpemluZzsKCQkJCQoJCQkJbkNhbGNUbXAucmVtb3ZlQXR0cmlidXRlKCAiaWQiICk7CgkJCQluQ2FsY1RtcC5hcHBlbmRDaGlsZCggblRoZWFkQ2xvbmUgKTsKCQkJCWlmICggb1NldHRpbmdzLm5URm9vdCAhPT0gbnVsbCApCgkJCQl7CgkJCQkJbkNhbGNUbXAuYXBwZW5kQ2hpbGQoIG9TZXR0aW5ncy5uVEZvb3QuY2xvbmVOb2RlKHRydWUpICk7CgkJCQkJX2ZuQXBwbHlUb0NoaWxkcmVuKCBmdW5jdGlvbihuKSB7CgkJCQkJCW4uc3R5bGUud2lkdGggPSAiIjsKCQkJCQl9LCBuQ2FsY1RtcC5nZXRFbGVtZW50c0J5VGFnTmFtZSgndHInKSApOwoJCQkJfQoJCQkJCgkJCQluQ2FsY1RtcC5hcHBlbmRDaGlsZCggbkJvZHkgKTsKCQkJCW5Cb2R5LmFwcGVuZENoaWxkKCBuVHIgKTsKCQkJCQoJCQkJLyogUmVtb3ZlIGFueSBzaXppbmcgdGhhdCB3YXMgcHJldmlvdXNseSBhcHBsaWVkIGJ5IHRoZSBzdHlsZXMgKi8KCQkJCXZhciBqcUNvbFNpemluZyA9ICQoJ3RoZWFkIHRoJywgbkNhbGNUbXApOwoJCQkJaWYgKCBqcUNvbFNpemluZy5sZW5ndGggPT09IDAgKQoJCQkJewoJCQkJCWpxQ29sU2l6aW5nID0gJCgndGJvZHkgdHI6ZXEoMCk+dGQnLCBuQ2FsY1RtcCk7CgkJCQl9CgkJCgkJCQkvKiBBcHBseSBjdXN0b20gc2l6aW5nIHRvIHRoZSBjbG9uZWQgaGVhZGVyICovCgkJCQl2YXIgblRocyA9IF9mbkdldFVuaXF1ZVRocyggb1NldHRpbmdzLCBuVGhlYWRDbG9uZSApOwoJCQkJaUNvcnJlY3RvciA9IDA7CgkJCQlmb3IgKCBpPTAgOyBpPGlDb2x1bXMgOyBpKysgKQoJCQkJewoJCQkJCXZhciBvQ29sdW1uID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpXTsKCQkJCQlpZiAoIG9Db2x1bW4uYlZpc2libGUgJiYgb0NvbHVtbi5zV2lkdGhPcmlnICE9PSBudWxsICYmIG9Db2x1bW4uc1dpZHRoT3JpZyAhPT0gIiIgKQoJCQkJCXsKCQkJCQkJblRoc1tpLWlDb3JyZWN0b3JdLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIG9Db2x1bW4uc1dpZHRoT3JpZyApOwoJCQkJCX0KCQkJCQllbHNlIGlmICggb0NvbHVtbi5iVmlzaWJsZSApCgkJCQkJewoJCQkJCQluVGhzW2ktaUNvcnJlY3Rvcl0uc3R5bGUud2lkdGggPSAiIjsKCQkJCQl9CgkJCQkJZWxzZQoJCQkJCXsKCQkJCQkJaUNvcnJlY3RvcisrOwoJCQkJCX0KCQkJCX0KCQkKCQkJCS8qIEZpbmQgdGhlIGJpZ2dlc3QgdGQgZm9yIGVhY2ggY29sdW1uIGFuZCBwdXQgaXQgaW50byB0aGUgdGFibGUgKi8KCQkJCWZvciAoIGk9MCA7IGk8aUNvbHVtcyA7IGkrKyApCgkJCQl7CgkJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLmJWaXNpYmxlICkKCQkJCQl7CgkJCQkJCXZhciBuVGQgPSBfZm5HZXRXaWRlc3ROb2RlKCBvU2V0dGluZ3MsIGkgKTsKCQkJCQkJaWYgKCBuVGQgIT09IG51bGwgKQoJCQkJCQl7CgkJCQkJCQluVGQgPSBuVGQuY2xvbmVOb2RlKHRydWUpOwoJCQkJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNDb250ZW50UGFkZGluZyAhPT0gIiIgKQoJCQkJCQkJewoJCQkJCQkJCW5UZC5pbm5lckhUTUwgKz0gb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5zQ29udGVudFBhZGRpbmc7CgkJCQkJCQl9CgkJCQkJCQluVHIuYXBwZW5kQ2hpbGQoIG5UZCApOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQkJCgkJCQkvKiBCdWlsZCB0aGUgdGFibGUgYW5kICdkaXNwbGF5JyBpdCAqLwoJCQkJdmFyIG5XcmFwcGVyID0gb1NldHRpbmdzLm5UYWJsZS5wYXJlbnROb2RlOwoJCQkJbldyYXBwZXIuYXBwZW5kQ2hpbGQoIG5DYWxjVG1wICk7CgkJCQkKCQkJCS8qIFdoZW4gc2Nyb2xsaW5nIChYIG9yIFkpIHdlIHdhbnQgdG8gc2V0IHRoZSB3aWR0aCBvZiB0aGUgdGFibGUgYXMgYXBwcm9wcmlhdGUuIEhvd2V2ZXIsCgkJCQkgKiB3aGVuIG5vdCBzY3JvbGxpbmcgbGVhdmUgdGhlIHRhYmxlIHdpZHRoIGFzIGl0IGlzLiBUaGlzIHJlc3VsdHMgaW4gc2xpZ2h0bHkgZGlmZmVyZW50LAoJCQkJICogYnV0IEkgdGhpbmsgY29ycmVjdCBiZWhhdmlvdXIKCQkJCSAqLwoJCQkJaWYgKCBvU2V0dGluZ3Mub1Njcm9sbC5zWCAhPT0gIiIgJiYgb1NldHRpbmdzLm9TY3JvbGwuc1hJbm5lciAhPT0gIiIgKQoJCQkJewoJCQkJCW5DYWxjVG1wLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3Mob1NldHRpbmdzLm9TY3JvbGwuc1hJbm5lcik7CgkJCQl9CgkJCQllbHNlIGlmICggb1NldHRpbmdzLm9TY3JvbGwuc1ggIT09ICIiICkKCQkJCXsKCQkJCQluQ2FsY1RtcC5zdHlsZS53aWR0aCA9ICIiOwoJCQkJCWlmICggJChuQ2FsY1RtcCkud2lkdGgoKSA8IG5XcmFwcGVyLm9mZnNldFdpZHRoICkKCQkJCQl7CgkJCQkJCW5DYWxjVG1wLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIG5XcmFwcGVyLm9mZnNldFdpZHRoICk7CgkJCQkJfQoJCQkJfQoJCQkJZWxzZSBpZiAoIG9TZXR0aW5ncy5vU2Nyb2xsLnNZICE9PSAiIiApCgkJCQl7CgkJCQkJbkNhbGNUbXAuc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggbldyYXBwZXIub2Zmc2V0V2lkdGggKTsKCQkJCX0KCQkJCWVsc2UgaWYgKCB3aWR0aEF0dHIgKQoJCQkJewoJCQkJCW5DYWxjVG1wLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIHdpZHRoQXR0ciApOwoJCQkJfQoJCQkJbkNhbGNUbXAuc3R5bGUudmlzaWJpbGl0eSA9ICJoaWRkZW4iOwoJCQkJCgkJCQkvKiBTY3JvbGxpbmcgY29uc2lkZXJhdGlvbnMgKi8KCQkJCV9mblNjcm9sbGluZ1dpZHRoQWRqdXN0KCBvU2V0dGluZ3MsIG5DYWxjVG1wICk7CgkJCQkKCQkJCS8qIFJlYWQgdGhlIHdpZHRoJ3MgY2FsY3VsYXRlZCBieSB0aGUgYnJvd3NlciBhbmQgc3RvcmUgdGhlbSBmb3IgdXNlIGJ5IHRoZSBjYWxsZXIuIFdlCgkJCQkgKiBmaXJzdCBvZiBhbGwgdHJ5IHRvIHVzZSB0aGUgZWxlbWVudHMgaW4gdGhlIGJvZHksIGJ1dCBpdCBpcyBwb3NzaWJsZSB0aGF0IHRoZXJlIGFyZQoJCQkJICogbm8gZWxlbWVudHMgdGhlcmUsIHVuZGVyIHdoaWNoIGNpcmN1bXN0YW5jZXMgd2UgdXNlIHRoZSBoZWFkZXIgZWxlbWVudHMKCQkJCSAqLwoJCQkJdmFyIG9Ob2RlcyA9ICQoInRib2R5IHRyOmVxKDApIiwgbkNhbGNUbXApLmNoaWxkcmVuKCk7CgkJCQlpZiAoIG9Ob2Rlcy5sZW5ndGggPT09IDAgKQoJCQkJewoJCQkJCW9Ob2RlcyA9IF9mbkdldFVuaXF1ZVRocyggb1NldHRpbmdzLCAkKCd0aGVhZCcsIG5DYWxjVG1wKVswXSApOwoJCQkJfQoJCQoJCQkJLyogQnJvd3NlcnMgbmVlZCBhIGJpdCBvZiBhIGhhbmQgd2hlbiBhIHdpZHRoIGlzIGFzc2lnbmVkIHRvIGFueSBjb2x1bW5zIHdoZW4gCgkJCQkgKiB4LXNjcm9sbGluZyBhcyB0aGV5IHRlbmQgdG8gY29sbGFwc2UgdGhlIHRhYmxlIHRvIHRoZSBtaW4td2lkdGgsIGV2ZW4gaWYKCQkJCSAqIHdlIHNlbnQgdGhlIGNvbHVtbiB3aWR0aHMuIFNvIHdlIG5lZWQgdG8ga2VlcCB0cmFjayBvZiB3aGF0IHRoZSB0YWJsZSB3aWR0aAoJCQkJICogc2hvdWxkIGJlIGJ5IHN1bW1pbmcgdGhlIHVzZXIgZ2l2ZW4gdmFsdWVzLCBhbmQgdGhlIGF1dG9tYXRpYyB2YWx1ZXMKCQkJCSAqLwoJCQkJaWYgKCBvU2V0dGluZ3Mub1Njcm9sbC5zWCAhPT0gIiIgKQoJCQkJewoJCQkJCXZhciBpVG90YWwgPSAwOwoJCQkJCWlDb3JyZWN0b3IgPSAwOwoJCQkJCWZvciAoIGk9MCA7IGk8b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpKysgKQoJCQkJCXsKCQkJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLmJWaXNpYmxlICkKCQkJCQkJewoJCQkJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNXaWR0aE9yaWcgPT09IG51bGwgKQoJCQkJCQkJewoJCQkJCQkJCWlUb3RhbCArPSAkKG9Ob2Rlc1tpQ29ycmVjdG9yXSkub3V0ZXJXaWR0aCgpOwoJCQkJCQkJfQoJCQkJCQkJZWxzZQoJCQkJCQkJewoJCQkJCQkJCWlUb3RhbCArPSBwYXJzZUludChvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNXaWR0aC5yZXBsYWNlKCdweCcsJycpLCAxMCkgKwoJCQkJCQkJCQkoJChvTm9kZXNbaUNvcnJlY3Rvcl0pLm91dGVyV2lkdGgoKSAtICQob05vZGVzW2lDb3JyZWN0b3JdKS53aWR0aCgpKTsKCQkJCQkJCX0KCQkJCQkJCWlDb3JyZWN0b3IrKzsKCQkJCQkJfQoJCQkJCX0KCQkJCQkKCQkJCQluQ2FsY1RtcC5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBpVG90YWwgKTsKCQkJCQlvU2V0dGluZ3MublRhYmxlLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoIGlUb3RhbCApOwoJCQkJfQoJCQoJCQkJaUNvcnJlY3RvciA9IDA7CgkJCQlmb3IgKCBpPTAgOyBpPG9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaSsrICkKCQkJCXsKCQkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uYlZpc2libGUgKQoJCQkJCXsKCQkJCQkJaVdpZHRoID0gJChvTm9kZXNbaUNvcnJlY3Rvcl0pLndpZHRoKCk7CgkJCQkJCWlmICggaVdpZHRoICE9PSBudWxsICYmIGlXaWR0aCA+IDAgKQoJCQkJCQl7CgkJCQkJCQlvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNXaWR0aCA9IF9mblN0cmluZ1RvQ3NzKCBpV2lkdGggKTsKCQkJCQkJfQoJCQkJCQlpQ29ycmVjdG9yKys7CgkJCQkJfQoJCQkJfQoJCQoJCQkJdmFyIGNzc1dpZHRoID0gJChuQ2FsY1RtcCkuY3NzKCd3aWR0aCcpOwoJCQkJb1NldHRpbmdzLm5UYWJsZS5zdHlsZS53aWR0aCA9IChjc3NXaWR0aC5pbmRleE9mKCclJykgIT09IC0xKSA/CgkJCQkgICAgY3NzV2lkdGggOiBfZm5TdHJpbmdUb0NzcyggJChuQ2FsY1RtcCkub3V0ZXJXaWR0aCgpICk7CgkJCQluQ2FsY1RtcC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKCBuQ2FsY1RtcCApOwoJCQl9CgkJCgkJCWlmICggd2lkdGhBdHRyICkKCQkJewoJCQkJb1NldHRpbmdzLm5UYWJsZS5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKCB3aWR0aEF0dHIgKTsKCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBBZGp1c3QgYSB0YWJsZSdzIHdpZHRoIHRvIHRha2UgYWNjb3VudCBvZiBzY3JvbGxpbmcKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge25vZGV9IG4gdGFibGUgbm9kZQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5TY3JvbGxpbmdXaWR0aEFkanVzdCAoIG9TZXR0aW5ncywgbiApCgkJewoJCQlpZiAoIG9TZXR0aW5ncy5vU2Nyb2xsLnNYID09PSAiIiAmJiBvU2V0dGluZ3Mub1Njcm9sbC5zWSAhPT0gIiIgKQoJCQl7CgkJCQkvKiBXaGVuIHktc2Nyb2xsaW5nIG9ubHksIHdlIHdhbnQgdG8gcmVtb3ZlIHRoZSB3aWR0aCBvZiB0aGUgc2Nyb2xsIGJhciBzbyB0aGUgdGFibGUKCQkJCSAqICsgc2Nyb2xsIGJhciB3aWxsIGZpdCBpbnRvIHRoZSBhcmVhIGF2YWlhbGJsZS4KCQkJCSAqLwoJCQkJdmFyIGlPcmlnV2lkdGggPSAkKG4pLndpZHRoKCk7CgkJCQluLnN0eWxlLndpZHRoID0gX2ZuU3RyaW5nVG9Dc3MoICQobikub3V0ZXJXaWR0aCgpLW9TZXR0aW5ncy5vU2Nyb2xsLmlCYXJXaWR0aCApOwoJCQl9CgkJCWVsc2UgaWYgKCBvU2V0dGluZ3Mub1Njcm9sbC5zWCAhPT0gIiIgKQoJCQl7CgkJCQkvKiBXaGVuIHgtc2Nyb2xsaW5nIGJvdGggd2F5cywgZml4IHRoZSB0YWJsZSBhdCBpdCdzIGN1cnJlbnQgc2l6ZSwgd2l0aG91dCBhZGp1c3RpbmcgKi8KCQkJCW4uc3R5bGUud2lkdGggPSBfZm5TdHJpbmdUb0NzcyggJChuKS5vdXRlcldpZHRoKCkgKTsKCQkJfQoJCX0KCQkKCQkKCQkvKioKCQkgKiBHZXQgdGhlIHdpZGVzdCBub2RlCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtpbnR9IGlDb2wgY29sdW1uIG9mIGludGVyZXN0CgkJICogIEByZXR1cm5zIHtzdHJpbmd9IG1heCBzdHJsZW5zIGZvciBlYWNoIGNvbHVtbgoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5HZXRXaWRlc3ROb2RlKCBvU2V0dGluZ3MsIGlDb2wgKQoJCXsKCQkJdmFyIGlNYXhJbmRleCA9IF9mbkdldE1heExlblN0cmluZyggb1NldHRpbmdzLCBpQ29sICk7CgkJCWlmICggaU1heEluZGV4IDwgMCApCgkJCXsKCQkJCXJldHVybiBudWxsOwoJCQl9CgkJCgkJCWlmICggb1NldHRpbmdzLmFvRGF0YVtpTWF4SW5kZXhdLm5UciA9PT0gbnVsbCApCgkJCXsKCQkJCXZhciBuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTsKCQkJCW4uaW5uZXJIVE1MID0gX2ZuR2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaU1heEluZGV4LCBpQ29sLCAnJyApOwoJCQkJcmV0dXJuIG47CgkJCX0KCQkJcmV0dXJuIF9mbkdldFRkTm9kZXMob1NldHRpbmdzLCBpTWF4SW5kZXgpW2lDb2xdOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBHZXQgdGhlIG1heGltdW0gc3RybGVuIGZvciBlYWNoIGRhdGEgY29sdW1uCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtpbnR9IGlDb2wgY29sdW1uIG9mIGludGVyZXN0CgkJICogIEByZXR1cm5zIHtzdHJpbmd9IG1heCBzdHJsZW5zIGZvciBlYWNoIGNvbHVtbgoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5HZXRNYXhMZW5TdHJpbmcoIG9TZXR0aW5ncywgaUNvbCApCgkJewoJCQl2YXIgaU1heCA9IC0xOwoJCQl2YXIgaU1heEluZGV4ID0gLTE7CgkJCQoJCQlmb3IgKCB2YXIgaT0wIDsgaTxvU2V0dGluZ3MuYW9EYXRhLmxlbmd0aCA7IGkrKyApCgkJCXsKCQkJCXZhciBzID0gX2ZuR2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaSwgaUNvbCwgJ2Rpc3BsYXknICkrIiI7CgkJCQlzID0gcy5yZXBsYWNlKCAvPC4qPz4vZywgIiIgKTsKCQkJCWlmICggcy5sZW5ndGggPiBpTWF4ICkKCQkJCXsKCQkJCQlpTWF4ID0gcy5sZW5ndGg7CgkJCQkJaU1heEluZGV4ID0gaTsKCQkJCX0KCQkJfQoJCQkKCQkJcmV0dXJuIGlNYXhJbmRleDsKCQl9CgkJCgkJCgkJLyoqCgkJICogQXBwZW5kIGEgQ1NTIHVuaXQgKG9ubHkgaWYgcmVxdWlyZWQpIHRvIGEgc3RyaW5nCgkJICogIEBwYXJhbSB7YXJyYXl9IGFBcnJheTEgZmlyc3QgYXJyYXkKCQkgKiAgQHBhcmFtIHthcnJheX0gYUFycmF5MiBzZWNvbmQgYXJyYXkKCQkgKiAgQHJldHVybnMge2ludH0gMCBpZiBtYXRjaCwgMSBpZiBsZW5ndGggaXMgZGlmZmVyZW50LCAyIGlmIG5vIG1hdGNoCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblN0cmluZ1RvQ3NzKCBzICkKCQl7CgkJCWlmICggcyA9PT0gbnVsbCApCgkJCXsKCQkJCXJldHVybiAiMHB4IjsKCQkJfQoJCQkKCQkJaWYgKCB0eXBlb2YgcyA9PSAnbnVtYmVyJyApCgkJCXsKCQkJCWlmICggcyA8IDAgKQoJCQkJewoJCQkJCXJldHVybiAiMHB4IjsKCQkJCX0KCQkJCXJldHVybiBzKyJweCI7CgkJCX0KCQkJCgkJCS8qIENoZWNrIGlmIHRoZSBsYXN0IGNoYXJhY3RlciBpcyBub3QgMC05ICovCgkJCXZhciBjID0gcy5jaGFyQ29kZUF0KCBzLmxlbmd0aC0xICk7CgkJCWlmIChjIDwgMHgzMCB8fCBjID4gMHgzOSkKCQkJewoJCQkJcmV0dXJuIHM7CgkJCX0KCQkJcmV0dXJuIHMrInB4IjsKCQl9CgkJCgkJCgkJLyoqCgkJICogR2V0IHRoZSB3aWR0aCBvZiBhIHNjcm9sbCBiYXIgaW4gdGhpcyBicm93c2VyIGJlaW5nIHVzZWQKCQkgKiAgQHJldHVybnMge2ludH0gd2lkdGggaW4gcGl4ZWxzCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblNjcm9sbEJhcldpZHRoICgpCgkJeyAgCgkJCXZhciBpbm5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTsKCQkJdmFyIHN0eWxlID0gaW5uZXIuc3R5bGU7CgkJCXN0eWxlLndpZHRoID0gIjEwMCUiOwoJCQlzdHlsZS5oZWlnaHQgPSAiMjAwcHgiOwoJCQlzdHlsZS5wYWRkaW5nID0gIjBweCI7CgkJCQoJCQl2YXIgb3V0ZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKCQkJc3R5bGUgPSBvdXRlci5zdHlsZTsKCQkJc3R5bGUucG9zaXRpb24gPSAiYWJzb2x1dGUiOwoJCQlzdHlsZS50b3AgPSAiMHB4IjsKCQkJc3R5bGUubGVmdCA9ICIwcHgiOwoJCQlzdHlsZS52aXNpYmlsaXR5ID0gImhpZGRlbiI7CgkJCXN0eWxlLndpZHRoID0gIjIwMHB4IjsKCQkJc3R5bGUuaGVpZ2h0ID0gIjE1MHB4IjsKCQkJc3R5bGUucGFkZGluZyA9ICIwcHgiOwoJCQlzdHlsZS5vdmVyZmxvdyA9ICJoaWRkZW4iOwoJCQlvdXRlci5hcHBlbmRDaGlsZChpbm5lcik7CgkJCQoJCQlkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKG91dGVyKTsKCQkJdmFyIHcxID0gaW5uZXIub2Zmc2V0V2lkdGg7CgkJCW91dGVyLnN0eWxlLm92ZXJmbG93ID0gJ3Njcm9sbCc7CgkJCXZhciB3MiA9IGlubmVyLm9mZnNldFdpZHRoOwoJCQlpZiAoIHcxID09IHcyICkKCQkJewoJCQkJdzIgPSBvdXRlci5jbGllbnRXaWR0aDsKCQkJfQoJCQkKCQkJZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChvdXRlcik7CgkJCXJldHVybiAodzEgLSB3Mik7ICAKCQl9CgkJCgkJCgkJCgkJLyoqCgkJICogQ2hhbmdlIHRoZSBvcmRlciBvZiB0aGUgdGFibGUKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge2Jvb2x9IGJBcHBseUNsYXNzZXMgb3B0aW9uYWwgLSBzaG91bGQgd2UgYXBwbHkgY2xhc3NlcyBvciBub3QKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuU29ydCAoIG9TZXR0aW5ncywgYkFwcGx5Q2xhc3NlcyApCgkJewoJCQl2YXIKCQkJCWksIGlMZW4sIGosIGpMZW4sIGssIGtMZW4sCgkJCQlzRGF0YVR5cGUsIG5UaCwKCQkJCWFhU29ydCA9IFtdLAoJCQkgCWFpT3JpZyA9IFtdLAoJCQkJb1NvcnQgPSBEYXRhVGFibGUuZXh0Lm9Tb3J0LAoJCQkJYW9EYXRhID0gb1NldHRpbmdzLmFvRGF0YSwKCQkJCWFvQ29sdW1ucyA9IG9TZXR0aW5ncy5hb0NvbHVtbnMsCgkJCQlvQXJpYSA9IG9TZXR0aW5ncy5vTGFuZ3VhZ2Uub0FyaWE7CgkJCQoJCQkvKiBObyBzb3J0aW5nIHJlcXVpcmVkIGlmIHNlcnZlci1zaWRlIG9yIG5vIHNvcnRpbmcgYXJyYXkgKi8KCQkJaWYgKCAhb1NldHRpbmdzLm9GZWF0dXJlcy5iU2VydmVyU2lkZSAmJiAKCQkJCShvU2V0dGluZ3MuYWFTb3J0aW5nLmxlbmd0aCAhPT0gMCB8fCBvU2V0dGluZ3MuYWFTb3J0aW5nRml4ZWQgIT09IG51bGwpICkKCQkJewoJCQkJYWFTb3J0ID0gKCBvU2V0dGluZ3MuYWFTb3J0aW5nRml4ZWQgIT09IG51bGwgKSA/CgkJCQkJb1NldHRpbmdzLmFhU29ydGluZ0ZpeGVkLmNvbmNhdCggb1NldHRpbmdzLmFhU29ydGluZyApIDoKCQkJCQlvU2V0dGluZ3MuYWFTb3J0aW5nLnNsaWNlKCk7CgkJCQkKCQkJCS8qIElmIHRoZXJlIGlzIGEgc29ydGluZyBkYXRhIHR5cGUsIGFuZCBhIGZ1Y3Rpb24gYmVsb25naW5nIHRvIGl0LCB0aGVuIHdlIG5lZWQgdG8KCQkJCSAqIGdldCB0aGUgZGF0YSBmcm9tIHRoZSBkZXZlbG9wZXIncyBmdW5jdGlvbiBhbmQgYXBwbHkgaXQgZm9yIHRoaXMgY29sdW1uCgkJCQkgKi8KCQkJCWZvciAoIGk9MCA7IGk8YWFTb3J0Lmxlbmd0aCA7IGkrKyApCgkJCQl7CgkJCQkJdmFyIGlDb2x1bW4gPSBhYVNvcnRbaV1bMF07CgkJCQkJdmFyIGlWaXNDb2x1bW4gPSBfZm5Db2x1bW5JbmRleFRvVmlzaWJsZSggb1NldHRpbmdzLCBpQ29sdW1uICk7CgkJCQkJc0RhdGFUeXBlID0gb1NldHRpbmdzLmFvQ29sdW1uc1sgaUNvbHVtbiBdLnNTb3J0RGF0YVR5cGU7CgkJCQkJaWYgKCBEYXRhVGFibGUuZXh0LmFmblNvcnREYXRhW3NEYXRhVHlwZV0gKQoJCQkJCXsKCQkJCQkJdmFyIGFEYXRhID0gRGF0YVRhYmxlLmV4dC5hZm5Tb3J0RGF0YVtzRGF0YVR5cGVdLmNhbGwoIAoJCQkJCQkJb1NldHRpbmdzLm9JbnN0YW5jZSwgb1NldHRpbmdzLCBpQ29sdW1uLCBpVmlzQ29sdW1uCgkJCQkJCSk7CgkJCQkJCWlmICggYURhdGEubGVuZ3RoID09PSBhb0RhdGEubGVuZ3RoICkKCQkJCQkJewoJCQkJCQkJZm9yICggaj0wLCBqTGVuPWFvRGF0YS5sZW5ndGggOyBqPGpMZW4gOyBqKysgKQoJCQkJCQkJewoJCQkJCQkJCV9mblNldENlbGxEYXRhKCBvU2V0dGluZ3MsIGosIGlDb2x1bW4sIGFEYXRhW2pdICk7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJZWxzZQoJCQkJCQl7CgkJCQkJCQlfZm5Mb2coIG9TZXR0aW5ncywgMCwgIlJldHVybmVkIGRhdGEgc29ydCBhcnJheSAoY29sICIraUNvbHVtbisiKSBpcyB0aGUgd3JvbmcgbGVuZ3RoIiApOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQkJCgkJCQkvKiBDcmVhdGUgYSB2YWx1ZSAtIGtleSBhcnJheSBvZiB0aGUgY3VycmVudCByb3cgcG9zaXRpb25zIHN1Y2ggdGhhdCB3ZSBjYW4gdXNlIHRoZWlyCgkJCQkgKiBjdXJyZW50IHBvc2l0aW9uIGR1cmluZyB0aGUgc29ydCwgaWYgdmFsdWVzIG1hdGNoLCBpbiBvcmRlciB0byBwZXJmb3JtIHN0YWJsZSBzb3J0aW5nCgkJCQkgKi8KCQkJCWZvciAoIGk9MCwgaUxlbj1vU2V0dGluZ3MuYWlEaXNwbGF5TWFzdGVyLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJYWlPcmlnWyBvU2V0dGluZ3MuYWlEaXNwbGF5TWFzdGVyW2ldIF0gPSBpOwoJCQkJfQoJCQoJCQkJLyogQnVpbGQgYW4gaW50ZXJuYWwgZGF0YSBhcnJheSB3aGljaCBpcyBzcGVjaWZpYyB0byB0aGUgc29ydCwgc28gd2UgY2FuIGdldCBhbmQgcHJlcAoJCQkJICogdGhlIGRhdGEgdG8gYmUgc29ydGVkIG9ubHkgb25jZSwgcmF0aGVyIHRoYW4gbmVlZGluZyB0byBkbyBpdCBldmVyeSB0aW1lIHRoZSBzb3J0aW5nCgkJCQkgKiBmdW5jdGlvbiBydW5zLiBUaGlzIG1ha2UgdGhlIHNvcnRpbmcgZnVuY3Rpb24gYSB2ZXJ5IHNpbXBsZSBjb21wYXJpc29uCgkJCQkgKi8KCQkJCXZhciBpU29ydExlbiA9IGFhU29ydC5sZW5ndGg7CgkJCQl2YXIgZm5Tb3J0Rm9ybWF0LCBhRGF0YVNvcnQ7CgkJCQlmb3IgKCBpPTAsIGlMZW49YW9EYXRhLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJZm9yICggaj0wIDsgajxpU29ydExlbiA7IGorKyApCgkJCQkJewoJCQkJCQlhRGF0YVNvcnQgPSBhb0NvbHVtbnNbIGFhU29ydFtqXVswXSBdLmFEYXRhU29ydDsKCQkKCQkJCQkJZm9yICggaz0wLCBrTGVuPWFEYXRhU29ydC5sZW5ndGggOyBrPGtMZW4gOyBrKysgKQoJCQkJCQl7CgkJCQkJCQlzRGF0YVR5cGUgPSBhb0NvbHVtbnNbIGFEYXRhU29ydFtrXSBdLnNUeXBlOwoJCQkJCQkJZm5Tb3J0Rm9ybWF0ID0gb1NvcnRbIChzRGF0YVR5cGUgPyBzRGF0YVR5cGUgOiAnc3RyaW5nJykrIi1wcmUiIF07CgkJCQkJCQkKCQkJCQkJCWFvRGF0YVtpXS5fYVNvcnREYXRhWyBhRGF0YVNvcnRba10gXSA9IGZuU29ydEZvcm1hdCA/CgkJCQkJCQkJZm5Tb3J0Rm9ybWF0KCBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpLCBhRGF0YVNvcnRba10sICdzb3J0JyApICkgOgoJCQkJCQkJCV9mbkdldENlbGxEYXRhKCBvU2V0dGluZ3MsIGksIGFEYXRhU29ydFtrXSwgJ3NvcnQnICk7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCQkKCQkJCS8qIERvIHRoZSBzb3J0IC0gaGVyZSB3ZSB3YW50IG11bHRpLWNvbHVtbiBzb3J0aW5nIGJhc2VkIG9uIGEgZ2l2ZW4gZGF0YSBzb3VyY2UgKGNvbHVtbikKCQkJCSAqIGFuZCBzb3J0aW5nIGZ1bmN0aW9uIChmcm9tIG9Tb3J0KSBpbiBhIGNlcnRhaW4gZGlyZWN0aW9uLiBJdCdzIHJlYXNvbmFibHkgY29tcGxleCB0bwoJCQkJICogZm9sbG93IG9uIGl0J3Mgb3duLCBidXQgdGhpcyBpcyB3aGF0IHdlIHdhbnQgKGV4YW1wbGUgdHdvIGNvbHVtbiBzb3J0aW5nKToKCQkJCSAqICBmbkxvY2FsU29ydGluZyA9IGZ1bmN0aW9uKGEsYil7CgkJCQkgKiAgCXZhciBpVGVzdDsKCQkJCSAqICAJaVRlc3QgPSBvU29ydFsnc3RyaW5nLWFzYyddKCdkYXRhMTEnLCAnZGF0YTEyJyk7CgkJCQkgKiAgCWlmIChpVGVzdCAhPT0gMCkKCQkJCSAqICAJCXJldHVybiBpVGVzdDsKCQkJCSAqICAgIGlUZXN0ID0gb1NvcnRbJ251bWVyaWMtZGVzYyddKCdkYXRhMjEnLCAnZGF0YTIyJyk7CgkJCQkgKiAgICBpZiAoaVRlc3QgIT09IDApCgkJCQkgKiAgCQlyZXR1cm4gaVRlc3Q7CgkJCQkgKiAgCXJldHVybiBvU29ydFsnbnVtZXJpYy1hc2MnXSggYWlPcmlnW2FdLCBhaU9yaWdbYl0gKTsKCQkJCSAqICB9CgkJCQkgKiBCYXNpY2FsbHkgd2UgaGF2ZSBhIHRlc3QgZm9yIGVhY2ggc29ydGluZyBjb2x1bW4sIGlmIHRoZSBkYXRhIGluIHRoYXQgY29sdW1uIGlzIGVxdWFsLAoJCQkJICogdGVzdCB0aGUgbmV4dCBjb2x1bW4uIElmIGFsbCBjb2x1bW5zIG1hdGNoLCB0aGVuIHdlIHVzZSBhIG51bWVyaWMgc29ydCBvbiB0aGUgcm93IAoJCQkJICogcG9zaXRpb25zIGluIHRoZSBvcmlnaW5hbCBkYXRhIGFycmF5IHRvIHByb3ZpZGUgYSBzdGFibGUgc29ydC4KCQkJCSAqLwoJCQkJb1NldHRpbmdzLmFpRGlzcGxheU1hc3Rlci5zb3J0KCBmdW5jdGlvbiAoIGEsIGIgKSB7CgkJCQkJdmFyIGssIGwsIGxMZW4sIGlUZXN0LCBhRGF0YVNvcnQsIHNEYXRhVHlwZTsKCQkJCQlmb3IgKCBrPTAgOyBrPGlTb3J0TGVuIDsgaysrICkKCQkJCQl7CgkJCQkJCWFEYXRhU29ydCA9IGFvQ29sdW1uc1sgYWFTb3J0W2tdWzBdIF0uYURhdGFTb3J0OwoJCQoJCQkJCQlmb3IgKCBsPTAsIGxMZW49YURhdGFTb3J0Lmxlbmd0aCA7IGw8bExlbiA7IGwrKyApCgkJCQkJCXsKCQkJCQkJCXNEYXRhVHlwZSA9IGFvQ29sdW1uc1sgYURhdGFTb3J0W2xdIF0uc1R5cGU7CgkJCQkJCQkKCQkJCQkJCWlUZXN0ID0gb1NvcnRbIChzRGF0YVR5cGUgPyBzRGF0YVR5cGUgOiAnc3RyaW5nJykrIi0iK2FhU29ydFtrXVsxXSBdKAoJCQkJCQkJCWFvRGF0YVthXS5fYVNvcnREYXRhWyBhRGF0YVNvcnRbbF0gXSwKCQkJCQkJCQlhb0RhdGFbYl0uX2FTb3J0RGF0YVsgYURhdGFTb3J0W2xdIF0KCQkJCQkJCSk7CgkJCQkJCQoJCQkJCQkJaWYgKCBpVGVzdCAhPT0gMCApCgkJCQkJCQl7CgkJCQkJCQkJcmV0dXJuIGlUZXN0OwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoJCQkJCQoJCQkJCXJldHVybiBvU29ydFsnbnVtZXJpYy1hc2MnXSggYWlPcmlnW2FdLCBhaU9yaWdbYl0gKTsKCQkJCX0gKTsKCQkJfQoJCQkKCQkJLyogQWx0ZXIgdGhlIHNvcnRpbmcgY2xhc3NlcyB0byB0YWtlIGFjY291bnQgb2YgdGhlIGNoYW5nZXMgKi8KCQkJaWYgKCAoYkFwcGx5Q2xhc3NlcyA9PT0gdW5kZWZpbmVkIHx8IGJBcHBseUNsYXNzZXMpICYmICFvU2V0dGluZ3Mub0ZlYXR1cmVzLmJEZWZlclJlbmRlciApCgkJCXsKCQkJCV9mblNvcnRpbmdDbGFzc2VzKCBvU2V0dGluZ3MgKTsKCQkJfQoJCQoJCQlmb3IgKCBpPTAsIGlMZW49b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQl2YXIgc1RpdGxlID0gYW9Db2x1bW5zW2ldLnNUaXRsZS5yZXBsYWNlKCAvPC4qPz4vZywgIiIgKTsKCQkJCW5UaCA9IGFvQ29sdW1uc1tpXS5uVGg7CgkJCQluVGgucmVtb3ZlQXR0cmlidXRlKCdhcmlhLXNvcnQnKTsKCQkJCW5UaC5yZW1vdmVBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnKTsKCQkJCQoJCQkJLyogSW4gQVJJQSBvbmx5IHRoZSBmaXJzdCBzb3J0aW5nIGNvbHVtbiBjYW4gYmUgbWFya2VkIGFzIHNvcnRpbmcgLSBubyBtdWx0aS1zb3J0IG9wdGlvbiAqLwoJCQkJaWYgKCBhb0NvbHVtbnNbaV0uYlNvcnRhYmxlICkKCQkJCXsKCQkJCQlpZiAoIGFhU29ydC5sZW5ndGggPiAwICYmIGFhU29ydFswXVswXSA9PSBpICkKCQkJCQl7CgkJCQkJCW5UaC5zZXRBdHRyaWJ1dGUoJ2FyaWEtc29ydCcsIGFhU29ydFswXVsxXT09ImFzYyIgPyAiYXNjZW5kaW5nIiA6ICJkZXNjZW5kaW5nIiApOwoJCQkJCQkKCQkJCQkJdmFyIG5leHRTb3J0ID0gKGFvQ29sdW1uc1tpXS5hc1NvcnRpbmdbIGFhU29ydFswXVsyXSsxIF0pID8gCgkJCQkJCQlhb0NvbHVtbnNbaV0uYXNTb3J0aW5nWyBhYVNvcnRbMF1bMl0rMSBdIDogYW9Db2x1bW5zW2ldLmFzU29ydGluZ1swXTsKCQkJCQkJblRoLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsIHNUaXRsZSsKCQkJCQkJCShuZXh0U29ydD09ImFzYyIgPyBvQXJpYS5zU29ydEFzY2VuZGluZyA6IG9BcmlhLnNTb3J0RGVzY2VuZGluZykgKTsKCQkJCQl9CgkJCQkJZWxzZQoJCQkJCXsKCQkJCQkJblRoLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsIHNUaXRsZSsKCQkJCQkJCShhb0NvbHVtbnNbaV0uYXNTb3J0aW5nWzBdPT0iYXNjIiA/IG9BcmlhLnNTb3J0QXNjZW5kaW5nIDogb0FyaWEuc1NvcnREZXNjZW5kaW5nKSApOwoJCQkJCX0KCQkJCX0KCQkJCWVsc2UKCQkJCXsKCQkJCQluVGguc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgc1RpdGxlKTsKCQkJCX0KCQkJfQoJCQkKCQkJLyogVGVsbCB0aGUgZHJhdyBmdW5jdGlvbiB0aGF0IHdlIGhhdmUgc29ydGVkIHRoZSBkYXRhICovCgkJCW9TZXR0aW5ncy5iU29ydGVkID0gdHJ1ZTsKCQkJJChvU2V0dGluZ3Mub0luc3RhbmNlKS50cmlnZ2VyKCdzb3J0Jywgb1NldHRpbmdzKTsKCQkJCgkJCS8qIENvcHkgdGhlIG1hc3RlciBkYXRhIGludG8gdGhlIGRyYXcgYXJyYXkgYW5kIHJlLWRyYXcgKi8KCQkJaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJGaWx0ZXIgKQoJCQl7CgkJCQkvKiBfZm5GaWx0ZXIoKSB3aWxsIHJlZHJhdyB0aGUgdGFibGUgZm9yIHVzICovCgkJCQlfZm5GaWx0ZXJDb21wbGV0ZSggb1NldHRpbmdzLCBvU2V0dGluZ3Mub1ByZXZpb3VzU2VhcmNoLCAxICk7CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQlvU2V0dGluZ3MuYWlEaXNwbGF5ID0gb1NldHRpbmdzLmFpRGlzcGxheU1hc3Rlci5zbGljZSgpOwoJCQkJb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ID0gMDsgLyogcmVzZXQgZGlzcGxheSBiYWNrIHRvIHBhZ2UgMCAqLwoJCQkJX2ZuQ2FsY3VsYXRlRW5kKCBvU2V0dGluZ3MgKTsKCQkJCV9mbkRyYXcoIG9TZXR0aW5ncyApOwoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEF0dGFjaCBhIHNvcnQgaGFuZGxlciAoY2xpY2spIHRvIGEgbm9kZQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7bm9kZX0gbk5vZGUgbm9kZSB0byBhdHRhY2ggdGhlIGhhbmRsZXIgdG8KCQkgKiAgQHBhcmFtIHtpbnR9IGlEYXRhSW5kZXggY29sdW1uIHNvcnRpbmcgaW5kZXgKCQkgKiAgQHBhcmFtIHtmdW5jdGlvbn0gW2ZuQ2FsbGJhY2tdIGNhbGxiYWNrIGZ1bmN0aW9uCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mblNvcnRBdHRhY2hMaXN0ZW5lciAoIG9TZXR0aW5ncywgbk5vZGUsIGlEYXRhSW5kZXgsIGZuQ2FsbGJhY2sgKQoJCXsKCQkJX2ZuQmluZEFjdGlvbiggbk5vZGUsIHt9LCBmdW5jdGlvbiAoZSkgewoJCQkJLyogSWYgdGhlIGNvbHVtbiBpcyBub3Qgc29ydGFibGUgLSBkb24ndCB0byBhbnl0aGluZyAqLwoJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2lEYXRhSW5kZXhdLmJTb3J0YWJsZSA9PT0gZmFsc2UgKQoJCQkJewoJCQkJCXJldHVybjsKCQkJCX0KCQkJCQoJCQkJLyoKCQkJCSAqIFRoaXMgaXMgYSBsaXR0bGUgYml0IG9kZCBJIGFkbWl0Li4uIEkgZGVjbGFyZSBhIHRlbXBvcmFyeSBmdW5jdGlvbiBpbnNpZGUgdGhlIHNjb3BlIG9mCgkJCQkgKiBfZm5CdWlsZEhlYWQgYW5kIHRoZSBjbGljayBoYW5kbGVyIGluIG9yZGVyIHRoYXQgdGhlIGNvZGUgcHJlc2VudGVkIGhlcmUgY2FuIGJlIHVzZWQgCgkJCQkgKiB0d2ljZSAtIG9uY2UgZm9yIHdoZW4gYlByb2Nlc3NpbmcgaXMgZW5hYmxlZCwgYW5kIGFub3RoZXIgdGltZSBmb3Igd2hlbiBpdCBpcyAKCQkJCSAqIGRpc2FibGVkLCBhcyB3ZSBuZWVkIHRvIHBlcmZvcm0gc2xpZ2h0bHkgZGlmZmVyZW50IGFjdGlvbnMuCgkJCQkgKiAgIEJhc2ljYWxseSB0aGUgaXNzdWUgaGVyZSBpcyB0aGF0IHRoZSBKYXZhc2NyaXB0IGVuZ2luZSBpbiBtb2Rlcm4gYnJvd3NlcnMgZG9uJ3QgCgkJCQkgKiBhcHBlYXIgdG8gYWxsb3cgdGhlIHJlbmRlcmluZyBlbmdpbmUgdG8gdXBkYXRlIHRoZSBkaXNwbGF5IHdoaWxlIGl0IGlzIHN0aWxsIGV4Y3V0aW5nCgkJCQkgKiBpdCdzIHRocmVhZCAod2VsbCAtIGl0IGRvZXMgYnV0IG9ubHkgYWZ0ZXIgbG9uZyBpbnRlcnZhbHMpLiBUaGlzIG1lYW5zIHRoYXQgdGhlIAoJCQkJICogJ3Byb2Nlc3NpbmcnIGRpc3BsYXkgZG9lc24ndCBhcHBlYXIgZm9yIGEgdGFibGUgc29ydC4gVG8gYnJlYWsgdGhlIGpzIHRocmVhZCB1cCBhIGJpdAoJCQkJICogSSBmb3JjZSBhbiBleGVjdXRpb24gYnJlYWsgYnkgdXNpbmcgc2V0VGltZW91dCAtIGJ1dCB0aGlzIGJyZWFrcyB0aGUgZXhwZWN0ZWQgCgkJCQkgKiB0aHJlYWQgY29udGludWF0aW9uIGZvciB0aGUgZW5kLWRldmVsb3BlcidzIHBvaW50IG9mIHZpZXcgKHRoZWlyIGNvZGUgd291bGQgZXhlY3V0ZQoJCQkJICogdG9vIGVhcmx5KSwgc28gd2Ugb247eSBkbyBpdCB3aGVuIHdlIGFic29sdXRlbHkgaGF2ZSB0by4KCQkJCSAqLwoJCQkJdmFyIGZuSW5uZXJTb3J0aW5nID0gZnVuY3Rpb24gKCkgewoJCQkJCXZhciBpQ29sdW1uLCBpTmV4dFNvcnQ7CgkJCQkJCgkJCQkJLyogSWYgdGhlIHNoaWZ0IGtleSBpcyBwcmVzc2VkIHRoZW4gd2UgYXJlIG11bHRpcGUgY29sdW1uIHNvcnRpbmcgKi8KCQkJCQlpZiAoIGUuc2hpZnRLZXkgKQoJCQkJCXsKCQkJCQkJLyogQXJlIHdlIGFscmVhZHkgZG9pbmcgc29tZSBraW5kIG9mIHNvcnQgb24gdGhpcyBjb2x1bW4/ICovCgkJCQkJCXZhciBiRm91bmQgPSBmYWxzZTsKCQkJCQkJZm9yICggdmFyIGk9MCA7IGk8b1NldHRpbmdzLmFhU29ydGluZy5sZW5ndGggOyBpKysgKQoJCQkJCQl7CgkJCQkJCQlpZiAoIG9TZXR0aW5ncy5hYVNvcnRpbmdbaV1bMF0gPT0gaURhdGFJbmRleCApCgkJCQkJCQl7CgkJCQkJCQkJYkZvdW5kID0gdHJ1ZTsKCQkJCQkJCQlpQ29sdW1uID0gb1NldHRpbmdzLmFhU29ydGluZ1tpXVswXTsKCQkJCQkJCQlpTmV4dFNvcnQgPSBvU2V0dGluZ3MuYWFTb3J0aW5nW2ldWzJdKzE7CgkJCQkJCQkJCgkJCQkJCQkJaWYgKCAhb1NldHRpbmdzLmFvQ29sdW1uc1tpQ29sdW1uXS5hc1NvcnRpbmdbaU5leHRTb3J0XSApCgkJCQkJCQkJewoJCQkJCQkJCQkvKiBSZWFjaGVkIHRoZSBlbmQgb2YgdGhlIHNvcnRpbmcgb3B0aW9ucywgcmVtb3ZlIGZyb20gbXVsdGktY29sIHNvcnQgKi8KCQkJCQkJCQkJb1NldHRpbmdzLmFhU29ydGluZy5zcGxpY2UoIGksIDEgKTsKCQkJCQkJCQl9CgkJCQkJCQkJZWxzZQoJCQkJCQkJCXsKCQkJCQkJCQkJLyogTW92ZSBvbnRvIG5leHQgc29ydGluZyBkaXJlY3Rpb24gKi8KCQkJCQkJCQkJb1NldHRpbmdzLmFhU29ydGluZ1tpXVsxXSA9IG9TZXR0aW5ncy5hb0NvbHVtbnNbaUNvbHVtbl0uYXNTb3J0aW5nW2lOZXh0U29ydF07CgkJCQkJCQkJCW9TZXR0aW5ncy5hYVNvcnRpbmdbaV1bMl0gPSBpTmV4dFNvcnQ7CgkJCQkJCQkJfQoJCQkJCQkJCWJyZWFrOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJCQoJCQkJCQkvKiBObyBzb3J0IHlldCAtIGFkZCBpdCBpbiAqLwoJCQkJCQlpZiAoIGJGb3VuZCA9PT0gZmFsc2UgKQoJCQkJCQl7CgkJCQkJCQlvU2V0dGluZ3MuYWFTb3J0aW5nLnB1c2goIFsgaURhdGFJbmRleCwgCgkJCQkJCQkJb1NldHRpbmdzLmFvQ29sdW1uc1tpRGF0YUluZGV4XS5hc1NvcnRpbmdbMF0sIDAgXSApOwoJCQkJCQl9CgkJCQkJfQoJCQkJCWVsc2UKCQkJCQl7CgkJCQkJCS8qIElmIG5vIHNoaWZ0IGtleSB0aGVuIHNpbmdsZSBjb2x1bW4gc29ydCAqLwoJCQkJCQlpZiAoIG9TZXR0aW5ncy5hYVNvcnRpbmcubGVuZ3RoID09IDEgJiYgb1NldHRpbmdzLmFhU29ydGluZ1swXVswXSA9PSBpRGF0YUluZGV4ICkKCQkJCQkJewoJCQkJCQkJaUNvbHVtbiA9IG9TZXR0aW5ncy5hYVNvcnRpbmdbMF1bMF07CgkJCQkJCQlpTmV4dFNvcnQgPSBvU2V0dGluZ3MuYWFTb3J0aW5nWzBdWzJdKzE7CgkJCQkJCQlpZiAoICFvU2V0dGluZ3MuYW9Db2x1bW5zW2lDb2x1bW5dLmFzU29ydGluZ1tpTmV4dFNvcnRdICkKCQkJCQkJCXsKCQkJCQkJCQlpTmV4dFNvcnQgPSAwOwoJCQkJCQkJfQoJCQkJCQkJb1NldHRpbmdzLmFhU29ydGluZ1swXVsxXSA9IG9TZXR0aW5ncy5hb0NvbHVtbnNbaUNvbHVtbl0uYXNTb3J0aW5nW2lOZXh0U29ydF07CgkJCQkJCQlvU2V0dGluZ3MuYWFTb3J0aW5nWzBdWzJdID0gaU5leHRTb3J0OwoJCQkJCQl9CgkJCQkJCWVsc2UKCQkJCQkJewoJCQkJCQkJb1NldHRpbmdzLmFhU29ydGluZy5zcGxpY2UoIDAsIG9TZXR0aW5ncy5hYVNvcnRpbmcubGVuZ3RoICk7CgkJCQkJCQlvU2V0dGluZ3MuYWFTb3J0aW5nLnB1c2goIFsgaURhdGFJbmRleCwgCgkJCQkJCQkJb1NldHRpbmdzLmFvQ29sdW1uc1tpRGF0YUluZGV4XS5hc1NvcnRpbmdbMF0sIDAgXSApOwoJCQkJCQl9CgkJCQkJfQoJCQkJCQoJCQkJCS8qIFJ1biB0aGUgc29ydCAqLwoJCQkJCV9mblNvcnQoIG9TZXR0aW5ncyApOwoJCQkJfTsgLyogL2ZuSW5uZXJTb3J0aW5nICovCgkJCQkKCQkJCWlmICggIW9TZXR0aW5ncy5vRmVhdHVyZXMuYlByb2Nlc3NpbmcgKQoJCQkJewoJCQkJCWZuSW5uZXJTb3J0aW5nKCk7CgkJCQl9CgkJCQllbHNlCgkJCQl7CgkJCQkJX2ZuUHJvY2Vzc2luZ0Rpc3BsYXkoIG9TZXR0aW5ncywgdHJ1ZSApOwoJCQkJCXNldFRpbWVvdXQoIGZ1bmN0aW9uKCkgewoJCQkJCQlmbklubmVyU29ydGluZygpOwoJCQkJCQlpZiAoICFvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTZXJ2ZXJTaWRlICkKCQkJCQkJewoJCQkJCQkJX2ZuUHJvY2Vzc2luZ0Rpc3BsYXkoIG9TZXR0aW5ncywgZmFsc2UgKTsKCQkJCQkJfQoJCQkJCX0sIDAgKTsKCQkJCX0KCQkJCQoJCQkJLyogQ2FsbCB0aGUgdXNlciBzcGVjaWZpZWQgY2FsbGJhY2sgZnVuY3Rpb24gLSB1c2VkIGZvciBhc3luYyB1c2VyIGludGVyYWN0aW9uICovCgkJCQlpZiAoIHR5cGVvZiBmbkNhbGxiYWNrID09ICdmdW5jdGlvbicgKQoJCQkJewoJCQkJCWZuQ2FsbGJhY2soIG9TZXR0aW5ncyApOwoJCQkJfQoJCQl9ICk7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIFNldCB0aGUgc29ydGluZyBjbGFzc2VzIG9uIHRoZSBoZWFkZXIsIE5vdGU6IGl0IGlzIHNhZmUgdG8gY2FsbCB0aGlzIGZ1bmN0aW9uIAoJCSAqIHdoZW4gYlNvcnQgYW5kIGJTb3J0Q2xhc3NlcyBhcmUgZmFsc2UKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5Tb3J0aW5nQ2xhc3Nlcyggb1NldHRpbmdzICkKCQl7CgkJCXZhciBpLCBpTGVuLCBqLCBqTGVuLCBpRm91bmQ7CgkJCXZhciBhYVNvcnQsIHNDbGFzczsKCQkJdmFyIGlDb2x1bW5zID0gb1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGg7CgkJCXZhciBvQ2xhc3NlcyA9IG9TZXR0aW5ncy5vQ2xhc3NlczsKCQkJCgkJCWZvciAoIGk9MCA7IGk8aUNvbHVtbnMgOyBpKysgKQoJCQl7CgkJCQlpZiAoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uYlNvcnRhYmxlICkKCQkJCXsKCQkJCQkkKG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0ublRoKS5yZW1vdmVDbGFzcyggb0NsYXNzZXMuc1NvcnRBc2MgKyIgIisgb0NsYXNzZXMuc1NvcnREZXNjICsKCQkJCQkJIiAiKyBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLnNTb3J0aW5nQ2xhc3MgKTsKCQkJCX0KCQkJfQoJCQkKCQkJaWYgKCBvU2V0dGluZ3MuYWFTb3J0aW5nRml4ZWQgIT09IG51bGwgKQoJCQl7CgkJCQlhYVNvcnQgPSBvU2V0dGluZ3MuYWFTb3J0aW5nRml4ZWQuY29uY2F0KCBvU2V0dGluZ3MuYWFTb3J0aW5nICk7CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQlhYVNvcnQgPSBvU2V0dGluZ3MuYWFTb3J0aW5nLnNsaWNlKCk7CgkJCX0KCQkJCgkJCS8qIEFwcGx5IHRoZSByZXF1aXJlZCBjbGFzc2VzIHRvIHRoZSBoZWFkZXIgKi8KCQkJZm9yICggaT0wIDsgaTxvU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGkrKyApCgkJCXsKCQkJCWlmICggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5iU29ydGFibGUgKQoJCQkJewoJCQkJCXNDbGFzcyA9IG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc1NvcnRpbmdDbGFzczsKCQkJCQlpRm91bmQgPSAtMTsKCQkJCQlmb3IgKCBqPTAgOyBqPGFhU29ydC5sZW5ndGggOyBqKysgKQoJCQkJCXsKCQkJCQkJaWYgKCBhYVNvcnRbal1bMF0gPT0gaSApCgkJCQkJCXsKCQkJCQkJCXNDbGFzcyA9ICggYWFTb3J0W2pdWzFdID09ICJhc2MiICkgPwoJCQkJCQkJCW9DbGFzc2VzLnNTb3J0QXNjIDogb0NsYXNzZXMuc1NvcnREZXNjOwoJCQkJCQkJaUZvdW5kID0gajsKCQkJCQkJCWJyZWFrOwoJCQkJCQl9CgkJCQkJfQoJCQkJCSQob1NldHRpbmdzLmFvQ29sdW1uc1tpXS5uVGgpLmFkZENsYXNzKCBzQ2xhc3MgKTsKCQkJCQkKCQkJCQlpZiAoIG9TZXR0aW5ncy5iSlVJICkKCQkJCQl7CgkJCQkJCS8qIGpRdWVyeSBVSSB1c2VzIGV4dHJhIG1hcmt1cCAqLwoJCQkJCQl2YXIganFTcGFuID0gJCgic3Bhbi4iK29DbGFzc2VzLnNTb3J0SWNvbiwgIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0ublRoKTsKCQkJCQkJanFTcGFuLnJlbW92ZUNsYXNzKG9DbGFzc2VzLnNTb3J0SlVJQXNjICsiICIrIG9DbGFzc2VzLnNTb3J0SlVJRGVzYyArIiAiKyAKCQkJCQkJCW9DbGFzc2VzLnNTb3J0SlVJICsiICIrIG9DbGFzc2VzLnNTb3J0SlVJQXNjQWxsb3dlZCArIiAiKyBvQ2xhc3Nlcy5zU29ydEpVSURlc2NBbGxvd2VkICk7CgkJCQkJCQoJCQkJCQl2YXIgc1NwYW5DbGFzczsKCQkJCQkJaWYgKCBpRm91bmQgPT0gLTEgKQoJCQkJCQl7CgkJCQkJCSAJc1NwYW5DbGFzcyA9IG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc1NvcnRpbmdDbGFzc0pVSTsKCQkJCQkJfQoJCQkJCQllbHNlIGlmICggYWFTb3J0W2lGb3VuZF1bMV0gPT0gImFzYyIgKQoJCQkJCQl7CgkJCQkJCQlzU3BhbkNsYXNzID0gb0NsYXNzZXMuc1NvcnRKVUlBc2M7CgkJCQkJCX0KCQkJCQkJZWxzZQoJCQkJCQl7CgkJCQkJCQlzU3BhbkNsYXNzID0gb0NsYXNzZXMuc1NvcnRKVUlEZXNjOwoJCQkJCQl9CgkJCQkJCQoJCQkJCQlqcVNwYW4uYWRkQ2xhc3MoIHNTcGFuQ2xhc3MgKTsKCQkJCQl9CgkJCQl9CgkJCQllbHNlCgkJCQl7CgkJCQkJLyogTm8gc29ydGluZyBvbiB0aGlzIGNvbHVtbiwgc28gYWRkIHRoZSBiYXNlIGNsYXNzLiBUaGlzIHdpbGwgaGF2ZSBiZWVuIGFzc2lnbmVkIGJ5CgkJCQkJICogX2ZuQWRkQ29sdW1uCgkJCQkJICovCgkJCQkJJChvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLm5UaCkuYWRkQ2xhc3MoIG9TZXR0aW5ncy5hb0NvbHVtbnNbaV0uc1NvcnRpbmdDbGFzcyApOwoJCQkJfQoJCQl9CgkJCQoJCQkvKiAKCQkJICogQXBwbHkgdGhlIHJlcXVpcmVkIGNsYXNzZXMgdG8gdGhlIHRhYmxlIGJvZHkKCQkJICogTm90ZSB0aGF0IHRoaXMgaXMgZ2l2ZW4gYXMgYSBmZWF0dXJlIHN3aXRjaCBzaW5jZSBpdCBjYW4gc2lnbmlmaWNhbnRseSBzbG93IGRvd24gYSBzb3J0CgkJCSAqIG9uIGxhcmdlIGRhdGEgc2V0cyAoYWRkaW5nIGFuZCByZW1vdmluZyBvZiBjbGFzc2VzIGlzIGFsd2F5cyBzbG93IGF0IHRoZSBiZXN0IG9mIHRpbWVzLi4pCgkJCSAqIEZ1cnRoZXIgdG8gdGhpcywgbm90ZSB0aGF0IHRoaXMgY29kZSBpcyBhZG1pdGFkbHkgZmFpcmx5IHVnbHkuIEl0IGNvdWxkIGJlIG1hZGUgYSBsb3QgCgkJCSAqIHNpbXBpbGVyIHVzaW5nIGpRdWVyeSBzZWxlY3RvcnMgYW5kIGFkZC9yZW1vdmVDbGFzcywgYnV0IHRoYXQgaXMgc2lnbmlmaWNhbnRseSBzbG93ZXIKCQkJICogKG9uIHRoZSBvcmRlciBvZiA1IHRpbWVzIHNsb3dlcikgLSBoZW5jZSB0aGUgZGlyZWN0IERPTSBtYW5pcHVsYXRpb24gaGVyZS4KCQkJICogTm90ZSB0aGF0IGZvciBkZWZlcmVkIGRyYXdpbmcgd2UgZG8gdXNlIGpRdWVyeSAtIHRoZSByZWFzb24gYmVpbmcgdGhhdCB0YWtpbmcgdGhlIGZpcnN0CgkJCSAqIHJvdyBmb3VuZCB0byBzZWUgaWYgdGhlIHdob2xlIGNvbHVtbiBuZWVkcyBwcm9jZXNzZWQgY2FuIG1pc3MgY2xhc3NlcyBzaW5jZSB0aGUgZmlyc3QKCQkJICogY29sdW1uIG1pZ2h0IGJlIG5ldy4KCQkJICovCgkJCXNDbGFzcyA9IG9DbGFzc2VzLnNTb3J0Q29sdW1uOwoJCQkKCQkJaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTb3J0ICYmIG9TZXR0aW5ncy5vRmVhdHVyZXMuYlNvcnRDbGFzc2VzICkKCQkJewoJCQkJdmFyIG5UZHMgPSBfZm5HZXRUZE5vZGVzKCBvU2V0dGluZ3MgKTsKCQkKCQkJCS8qIFJlbW92ZSB0aGUgb2xkIGNsYXNzZXMgKi8KCQkJCWlmICggb1NldHRpbmdzLm9GZWF0dXJlcy5iRGVmZXJSZW5kZXIgKQoJCQkJewoJCQkJCSQoblRkcykucmVtb3ZlQ2xhc3Moc0NsYXNzKycxICcrc0NsYXNzKycyICcrc0NsYXNzKyczJyk7CgkJCQl9CgkJCQllbHNlIGlmICggblRkcy5sZW5ndGggPj0gaUNvbHVtbnMgKQoJCQkJewoJCQkJCWZvciAoIGk9MCA7IGk8aUNvbHVtbnMgOyBpKysgKQoJCQkJCXsKCQkJCQkJaWYgKCBuVGRzW2ldLmNsYXNzTmFtZS5pbmRleE9mKHNDbGFzcysiMSIpICE9IC0xICkKCQkJCQkJewoJCQkJCQkJZm9yICggaj0wLCBqTGVuPShuVGRzLmxlbmd0aC9pQ29sdW1ucykgOyBqPGpMZW4gOyBqKysgKQoJCQkJCQkJewoJCQkJCQkJCW5UZHNbKGlDb2x1bW5zKmopK2ldLmNsYXNzTmFtZSA9IAoJCQkJCQkJCQkkLnRyaW0oIG5UZHNbKGlDb2x1bW5zKmopK2ldLmNsYXNzTmFtZS5yZXBsYWNlKCBzQ2xhc3MrIjEiLCAiIiApICk7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJZWxzZSBpZiAoIG5UZHNbaV0uY2xhc3NOYW1lLmluZGV4T2Yoc0NsYXNzKyIyIikgIT0gLTEgKQoJCQkJCQl7CgkJCQkJCQlmb3IgKCBqPTAsIGpMZW49KG5UZHMubGVuZ3RoL2lDb2x1bW5zKSA7IGo8akxlbiA7IGorKyApCgkJCQkJCQl7CgkJCQkJCQkJblRkc1soaUNvbHVtbnMqaikraV0uY2xhc3NOYW1lID0gCgkJCQkJCQkJCSQudHJpbSggblRkc1soaUNvbHVtbnMqaikraV0uY2xhc3NOYW1lLnJlcGxhY2UoIHNDbGFzcysiMiIsICIiICkgKTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQllbHNlIGlmICggblRkc1tpXS5jbGFzc05hbWUuaW5kZXhPZihzQ2xhc3MrIjMiKSAhPSAtMSApCgkJCQkJCXsKCQkJCQkJCWZvciAoIGo9MCwgakxlbj0oblRkcy5sZW5ndGgvaUNvbHVtbnMpIDsgajxqTGVuIDsgaisrICkKCQkJCQkJCXsKCQkJCQkJCQluVGRzWyhpQ29sdW1ucypqKStpXS5jbGFzc05hbWUgPSAKCQkJCQkJCQkJJC50cmltKCBuVGRzWyhpQ29sdW1ucypqKStpXS5jbGFzc05hbWUucmVwbGFjZSggIiAiK3NDbGFzcysiMyIsICIiICkgKTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJCQoJCQkJLyogQWRkIHRoZSBuZXcgY2xhc3NlcyB0byB0aGUgdGFibGUgKi8KCQkJCXZhciBpQ2xhc3MgPSAxLCBpVGFyZ2V0Q29sOwoJCQkJZm9yICggaT0wIDsgaTxhYVNvcnQubGVuZ3RoIDsgaSsrICkKCQkJCXsKCQkJCQlpVGFyZ2V0Q29sID0gcGFyc2VJbnQoIGFhU29ydFtpXVswXSwgMTAgKTsKCQkJCQlmb3IgKCBqPTAsIGpMZW49KG5UZHMubGVuZ3RoL2lDb2x1bW5zKSA7IGo8akxlbiA7IGorKyApCgkJCQkJewoJCQkJCQluVGRzWyhpQ29sdW1ucypqKStpVGFyZ2V0Q29sXS5jbGFzc05hbWUgKz0gIiAiK3NDbGFzcytpQ2xhc3M7CgkJCQkJfQoJCQkJCQoJCQkJCWlmICggaUNsYXNzIDwgMyApCgkJCQkJewoJCQkJCQlpQ2xhc3MrKzsKCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgkJCgkJCgkJCgkJLyoqCgkJICogU2F2ZSB0aGUgc3RhdGUgb2YgYSB0YWJsZSBpbiBhIGNvb2tpZSBzdWNoIHRoYXQgdGhlIHBhZ2UgY2FuIGJlIHJlbG9hZGVkCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuU2F2ZVN0YXRlICggb1NldHRpbmdzICkKCQl7CgkJCWlmICggIW9TZXR0aW5ncy5vRmVhdHVyZXMuYlN0YXRlU2F2ZSB8fCBvU2V0dGluZ3MuYkRlc3Ryb3lpbmcgKQoJCQl7CgkJCQlyZXR1cm47CgkJCX0KCQkKCQkJLyogU3RvcmUgdGhlIGludGVyZXN0aW5nIHZhcmlhYmxlcyAqLwoJCQl2YXIgaSwgaUxlbiwgYkluZmluaXRlPW9TZXR0aW5ncy5vU2Nyb2xsLmJJbmZpbml0ZTsKCQkJdmFyIG9TdGF0ZSA9IHsKCQkJCSJpQ3JlYXRlIjogICAgICBuZXcgRGF0ZSgpLmdldFRpbWUoKSwKCQkJCSJpU3RhcnQiOiAgICAgICAoYkluZmluaXRlID8gMCA6IG9TZXR0aW5ncy5faURpc3BsYXlTdGFydCksCgkJCQkiaUVuZCI6ICAgICAgICAgKGJJbmZpbml0ZSA/IG9TZXR0aW5ncy5faURpc3BsYXlMZW5ndGggOiBvU2V0dGluZ3MuX2lEaXNwbGF5RW5kKSwKCQkJCSJpTGVuZ3RoIjogICAgICBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoLAoJCQkJImFhU29ydGluZyI6ICAgICQuZXh0ZW5kKCB0cnVlLCBbXSwgb1NldHRpbmdzLmFhU29ydGluZyApLAoJCQkJIm9TZWFyY2giOiAgICAgICQuZXh0ZW5kKCB0cnVlLCB7fSwgb1NldHRpbmdzLm9QcmV2aW91c1NlYXJjaCApLAoJCQkJImFvU2VhcmNoQ29scyI6ICQuZXh0ZW5kKCB0cnVlLCBbXSwgb1NldHRpbmdzLmFvUHJlU2VhcmNoQ29scyApLAoJCQkJImFiVmlzQ29scyI6ICAgIFtdCgkJCX07CgkJCgkJCWZvciAoIGk9MCwgaUxlbj1vU2V0dGluZ3MuYW9Db2x1bW5zLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCW9TdGF0ZS5hYlZpc0NvbHMucHVzaCggb1NldHRpbmdzLmFvQ29sdW1uc1tpXS5iVmlzaWJsZSApOwoJCQl9CgkJCgkJCV9mbkNhbGxiYWNrRmlyZSggb1NldHRpbmdzLCAiYW9TdGF0ZVNhdmVQYXJhbXMiLCAnc3RhdGVTYXZlUGFyYW1zJywgW29TZXR0aW5ncywgb1N0YXRlXSApOwoJCQkKCQkJb1NldHRpbmdzLmZuU3RhdGVTYXZlLmNhbGwoIG9TZXR0aW5ncy5vSW5zdGFuY2UsIG9TZXR0aW5ncywgb1N0YXRlICk7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEF0dGVtcHQgdG8gbG9hZCBhIHNhdmVkIHRhYmxlIHN0YXRlIGZyb20gYSBjb29raWUKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge29iamVjdH0gb0luaXQgRGF0YVRhYmxlcyBpbml0IG9iamVjdCBzbyB3ZSBjYW4gb3ZlcnJpZGUgc2V0dGluZ3MKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuTG9hZFN0YXRlICggb1NldHRpbmdzLCBvSW5pdCApCgkJewoJCQlpZiAoICFvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTdGF0ZVNhdmUgKQoJCQl7CgkJCQlyZXR1cm47CgkJCX0KCQkKCQkJdmFyIG9EYXRhID0gb1NldHRpbmdzLmZuU3RhdGVMb2FkLmNhbGwoIG9TZXR0aW5ncy5vSW5zdGFuY2UsIG9TZXR0aW5ncyApOwoJCQlpZiAoICFvRGF0YSApCgkJCXsKCQkJCXJldHVybjsKCQkJfQoJCQkKCQkJLyogQWxsb3cgY3VzdG9tIGFuZCBwbHVnLWluIG1hbmlwdWxhdGlvbiBmdW5jdGlvbnMgdG8gYWx0ZXIgdGhlIHNhdmVkIGRhdGEgc2V0IGFuZAoJCQkgKiBjYW5jZWxsaW5nIG9mIGxvYWRpbmcgYnkgcmV0dXJuaW5nIGZhbHNlCgkJCSAqLwoJCQl2YXIgYWJTdGF0ZUxvYWQgPSBfZm5DYWxsYmFja0ZpcmUoIG9TZXR0aW5ncywgJ2FvU3RhdGVMb2FkUGFyYW1zJywgJ3N0YXRlTG9hZFBhcmFtcycsIFtvU2V0dGluZ3MsIG9EYXRhXSApOwoJCQlpZiAoICQuaW5BcnJheSggZmFsc2UsIGFiU3RhdGVMb2FkICkgIT09IC0xICkKCQkJewoJCQkJcmV0dXJuOwoJCQl9CgkJCQoJCQkvKiBTdG9yZSB0aGUgc2F2ZWQgc3RhdGUgc28gaXQgbWlnaHQgYmUgYWNjZXNzZWQgYXQgYW55IHRpbWUgKi8KCQkJb1NldHRpbmdzLm9Mb2FkZWRTdGF0ZSA9ICQuZXh0ZW5kKCB0cnVlLCB7fSwgb0RhdGEgKTsKCQkJCgkJCS8qIFJlc3RvcmUga2V5IGZlYXR1cmVzICovCgkJCW9TZXR0aW5ncy5faURpc3BsYXlTdGFydCAgICA9IG9EYXRhLmlTdGFydDsKCQkJb1NldHRpbmdzLmlJbml0RGlzcGxheVN0YXJ0ID0gb0RhdGEuaVN0YXJ0OwoJCQlvU2V0dGluZ3MuX2lEaXNwbGF5RW5kICAgICAgPSBvRGF0YS5pRW5kOwoJCQlvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoICAgPSBvRGF0YS5pTGVuZ3RoOwoJCQlvU2V0dGluZ3MuYWFTb3J0aW5nICAgICAgICAgPSBvRGF0YS5hYVNvcnRpbmcuc2xpY2UoKTsKCQkJb1NldHRpbmdzLnNhdmVkX2FhU29ydGluZyAgID0gb0RhdGEuYWFTb3J0aW5nLnNsaWNlKCk7CgkJCQoJCQkvKiBTZWFyY2ggZmlsdGVyaW5nICAqLwoJCQkkLmV4dGVuZCggb1NldHRpbmdzLm9QcmV2aW91c1NlYXJjaCwgb0RhdGEub1NlYXJjaCApOwoJCQkkLmV4dGVuZCggdHJ1ZSwgb1NldHRpbmdzLmFvUHJlU2VhcmNoQ29scywgb0RhdGEuYW9TZWFyY2hDb2xzICk7CgkJCQoJCQkvKiBDb2x1bW4gdmlzaWJpbGl0eSBzdGF0ZQoJCQkgKiBQYXNzIGJhY2sgdmlzaWJpbGl5IHNldHRpbmdzIHRvIHRoZSBpbml0IGhhbmRsZXIsIGJ1dCB0byBkbyBub3QgaGVyZSBvdmVycmlkZQoJCQkgKiB0aGUgaW5pdCBvYmplY3QgdGhhdCB0aGUgdXNlciBtaWdodCBoYXZlIHBhc3NlZCBpbgoJCQkgKi8KCQkJb0luaXQuc2F2ZWRfYW9Db2x1bW5zID0gW107CgkJCWZvciAoIHZhciBpPTAgOyBpPG9EYXRhLmFiVmlzQ29scy5sZW5ndGggOyBpKysgKQoJCQl7CgkJCQlvSW5pdC5zYXZlZF9hb0NvbHVtbnNbaV0gPSB7fTsKCQkJCW9Jbml0LnNhdmVkX2FvQ29sdW1uc1tpXS5iVmlzaWJsZSA9IG9EYXRhLmFiVmlzQ29sc1tpXTsKCQkJfQoJCQoJCQlfZm5DYWxsYmFja0ZpcmUoIG9TZXR0aW5ncywgJ2FvU3RhdGVMb2FkZWQnLCAnc3RhdGVMb2FkZWQnLCBbb1NldHRpbmdzLCBvRGF0YV0gKTsKCQl9CgkJCgkJCgkJLyoqCgkJICogQ3JlYXRlIGEgbmV3IGNvb2tpZSB3aXRoIGEgdmFsdWUgdG8gc3RvcmUgdGhlIHN0YXRlIG9mIGEgdGFibGUKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNOYW1lIG5hbWUgb2YgdGhlIGNvb2tpZSB0byBjcmVhdGUKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNWYWx1ZSB0aGUgdmFsdWUgdGhlIGNvb2tpZSBzaG91bGQgdGFrZQoJCSAqICBAcGFyYW0ge2ludH0gaVNlY3MgZHVyYXRpb24gb2YgdGhlIGNvb2tpZQoJCSAqICBAcGFyYW0ge3N0cmluZ30gc0Jhc2VOYW1lIHNOYW1lIGlzIG1hZGUgdXAgb2YgdGhlIGJhc2UgKyBmaWxlIG5hbWUgLSB0aGlzIGlzIHRoZSBiYXNlCgkJICogIEBwYXJhbSB7ZnVuY3Rpb259IGZuQ2FsbGJhY2sgVXNlciBkZWZpbmFibGUgZnVuY3Rpb24gdG8gbW9kaWZ5IHRoZSBjb29raWUKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuQ3JlYXRlQ29va2llICggc05hbWUsIHNWYWx1ZSwgaVNlY3MsIHNCYXNlTmFtZSwgZm5DYWxsYmFjayApCgkJewoJCQl2YXIgZGF0ZSA9IG5ldyBEYXRlKCk7CgkJCWRhdGUuc2V0VGltZSggZGF0ZS5nZXRUaW1lKCkrKGlTZWNzKjEwMDApICk7CgkJCQoJCQkvKiAKCQkJICogU2hvY2tpbmcgYnV0IHRydWUgLSBpdCB3b3VsZCBhcHBlYXIgSUUgaGFzIG1ham9yIGlzc3VlcyB3aXRoIGhhdmluZyB0aGUgcGF0aCBub3QgaGF2aW5nCgkJCSAqIGEgdHJhaWxpbmcgc2xhc2ggb24gaXQuIFdlIG5lZWQgdGhlIGNvb2tpZSB0byBiZSBhdmFpbGFibGUgYmFzZWQgb24gdGhlIHBhdGgsIHNvIHdlCgkJCSAqIGhhdmUgdG8gYXBwZW5kIHRoZSBmaWxlIG5hbWUgdG8gdGhlIGNvb2tpZSBuYW1lLiBBcHBhbGxpbmcuIFRoYW5rcyB0byB2ZXggZm9yIGFkZGluZyB0aGUKCQkJICogcGF0Y2ggdG8gdXNlIGF0IGxlYXN0IHNvbWUgb2YgdGhlIHBhdGgKCQkJICovCgkJCXZhciBhUGFydHMgPSB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUuc3BsaXQoJy8nKTsKCQkJdmFyIHNOYW1lRmlsZSA9IHNOYW1lICsgJ18nICsgYVBhcnRzLnBvcCgpLnJlcGxhY2UoL1tcLzpdL2csIiIpLnRvTG93ZXJDYXNlKCk7CgkJCXZhciBzRnVsbENvb2tpZSwgb0RhdGE7CgkJCQoJCQlpZiAoIGZuQ2FsbGJhY2sgIT09IG51bGwgKQoJCQl7CgkJCQlvRGF0YSA9ICh0eXBlb2YgJC5wYXJzZUpTT04gPT09ICdmdW5jdGlvbicpID8gCgkJCQkJJC5wYXJzZUpTT04oIHNWYWx1ZSApIDogZXZhbCggJygnK3NWYWx1ZSsnKScgKTsKCQkJCXNGdWxsQ29va2llID0gZm5DYWxsYmFjayggc05hbWVGaWxlLCBvRGF0YSwgZGF0ZS50b0dNVFN0cmluZygpLAoJCQkJCWFQYXJ0cy5qb2luKCcvJykrIi8iICk7CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQlzRnVsbENvb2tpZSA9IHNOYW1lRmlsZSArICI9IiArIGVuY29kZVVSSUNvbXBvbmVudChzVmFsdWUpICsKCQkJCQkiOyBleHBpcmVzPSIgKyBkYXRlLnRvR01UU3RyaW5nKCkgKyI7IHBhdGg9IiArIGFQYXJ0cy5qb2luKCcvJykrIi8iOwoJCQl9CgkJCQoJCQkvKiBBcmUgd2UgZ29pbmcgdG8gZ28gb3ZlciB0aGUgY29va2llIGxpbWl0IG9mIDRLaUI/IElmIHNvLCB0cnkgdG8gZGVsZXRlIGEgY29va2llcwoJCQkgKiBiZWxvbmdpbmcgdG8gRGF0YVRhYmxlcy4gVGhpcyBpcyBGQVIgZnJvbSBidWxsZXQgcHJvb2YKCQkJICovCgkJCXZhciBzT2xkTmFtZT0iIiwgaU9sZFRpbWU9OTk5OTk5OTk5OTk5OTsKCQkJdmFyIGlMZW5ndGggPSBfZm5SZWFkQ29va2llKCBzTmFtZUZpbGUgKSE9PW51bGwgPyBkb2N1bWVudC5jb29raWUubGVuZ3RoIDogCgkJCQlzRnVsbENvb2tpZS5sZW5ndGggKyBkb2N1bWVudC5jb29raWUubGVuZ3RoOwoJCQkKCQkJaWYgKCBpTGVuZ3RoKzEwID4gNDA5NiApIC8qIE1hZ2ljIDEwIGZvciBwYWRkaW5nICovCgkJCXsKCQkJCXZhciBhQ29va2llcyA9ZG9jdW1lbnQuY29va2llLnNwbGl0KCc7Jyk7CgkJCQlmb3IgKCB2YXIgaT0wLCBpTGVuPWFDb29raWVzLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJaWYgKCBhQ29va2llc1tpXS5pbmRleE9mKCBzQmFzZU5hbWUgKSAhPSAtMSApCgkJCQkJewoJCQkJCQkvKiBJdCdzIGEgRGF0YVRhYmxlcyBjb29raWUsIHNvIGV2YWwgaXQgYW5kIGNoZWNrIHRoZSB0aW1lIHN0YW1wICovCgkJCQkJCXZhciBhU3BsaXRDb29raWUgPSBhQ29va2llc1tpXS5zcGxpdCgnPScpOwoJCQkJCQl0cnkgeyBvRGF0YSA9IGV2YWwoICcoJytkZWNvZGVVUklDb21wb25lbnQoYVNwbGl0Q29va2llWzFdKSsnKScgKTsgfQoJCQkJCQljYXRjaCggZSApIHsgY29udGludWU7IH0KCQkJCQkJCgkJCQkJCWlmICggb0RhdGEuaUNyZWF0ZSAmJiBvRGF0YS5pQ3JlYXRlIDwgaU9sZFRpbWUgKQoJCQkJCQl7CgkJCQkJCQlzT2xkTmFtZSA9IGFTcGxpdENvb2tpZVswXTsKCQkJCQkJCWlPbGRUaW1lID0gb0RhdGEuaUNyZWF0ZTsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJCQoJCQkJaWYgKCBzT2xkTmFtZSAhPT0gIiIgKQoJCQkJewoJCQkJCWRvY3VtZW50LmNvb2tpZSA9IHNPbGROYW1lKyI9OyBleHBpcmVzPVRodSwgMDEtSmFuLTE5NzAgMDA6MDA6MDEgR01UOyBwYXRoPSIrCgkJCQkJCWFQYXJ0cy5qb2luKCcvJykgKyAiLyI7CgkJCQl9CgkJCX0KCQkJCgkJCWRvY3VtZW50LmNvb2tpZSA9IHNGdWxsQ29va2llOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBSZWFkIGFuIG9sZCBjb29raWUgdG8gZ2V0IGEgY29va2llIHdpdGggYW4gb2xkIHRhYmxlIHN0YXRlCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzTmFtZSBuYW1lIG9mIHRoZSBjb29raWUgdG8gcmVhZAoJCSAqICBAcmV0dXJucyB7c3RyaW5nfSBjb250ZW50cyBvZiB0aGUgY29va2llIC0gb3IgbnVsbCBpZiBubyBjb29raWUgd2l0aCB0aGF0IG5hbWUgZm91bmQKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuUmVhZENvb2tpZSAoIHNOYW1lICkKCQl7CgkJCXZhcgoJCQkJYVBhcnRzID0gd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lLnNwbGl0KCcvJyksCgkJCQlzTmFtZUVRID0gc05hbWUgKyAnXycgKyBhUGFydHNbYVBhcnRzLmxlbmd0aC0xXS5yZXBsYWNlKC9bXC86XS9nLCIiKS50b0xvd2VyQ2FzZSgpICsgJz0nLAoJCQkgCXNDb29raWVDb250ZW50cyA9IGRvY3VtZW50LmNvb2tpZS5zcGxpdCgnOycpOwoJCQkKCQkJZm9yKCB2YXIgaT0wIDsgaTxzQ29va2llQ29udGVudHMubGVuZ3RoIDsgaSsrICkKCQkJewoJCQkJdmFyIGMgPSBzQ29va2llQ29udGVudHNbaV07CgkJCQkKCQkJCXdoaWxlIChjLmNoYXJBdCgwKT09JyAnKQoJCQkJewoJCQkJCWMgPSBjLnN1YnN0cmluZygxLGMubGVuZ3RoKTsKCQkJCX0KCQkJCQoJCQkJaWYgKGMuaW5kZXhPZihzTmFtZUVRKSA9PT0gMCkKCQkJCXsKCQkJCQlyZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KCBjLnN1YnN0cmluZyhzTmFtZUVRLmxlbmd0aCxjLmxlbmd0aCkgKTsKCQkJCX0KCQkJfQoJCQlyZXR1cm4gbnVsbDsKCQl9CgkJCgkJCgkJCgkJLyoqCgkJICogUmV0dXJuIHRoZSBzZXR0aW5ncyBvYmplY3QgZm9yIGEgcGFydGljdWxhciB0YWJsZQoJCSAqICBAcGFyYW0ge25vZGV9IG5UYWJsZSB0YWJsZSB3ZSBhcmUgdXNpbmcgYXMgYSBkYXRhVGFibGUKCQkgKiAgQHJldHVybnMge29iamVjdH0gU2V0dGluZ3Mgb2JqZWN0IC0gb3IgbnVsbCBpZiBub3QgZm91bmQKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuU2V0dGluZ3NGcm9tTm9kZSAoIG5UYWJsZSApCgkJewoJCQlmb3IgKCB2YXIgaT0wIDsgaTxEYXRhVGFibGUuc2V0dGluZ3MubGVuZ3RoIDsgaSsrICkKCQkJewoJCQkJaWYgKCBEYXRhVGFibGUuc2V0dGluZ3NbaV0ublRhYmxlID09PSBuVGFibGUgKQoJCQkJewoJCQkJCXJldHVybiBEYXRhVGFibGUuc2V0dGluZ3NbaV07CgkJCQl9CgkJCX0KCQkJCgkJCXJldHVybiBudWxsOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBSZXR1cm4gYW4gYXJyYXkgd2l0aCB0aGUgVFIgbm9kZXMgZm9yIHRoZSB0YWJsZQoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEByZXR1cm5zIHthcnJheX0gVFIgYXJyYXkKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuR2V0VHJOb2RlcyAoIG9TZXR0aW5ncyApCgkJewoJCQl2YXIgYU5vZGVzID0gW107CgkJCXZhciBhb0RhdGEgPSBvU2V0dGluZ3MuYW9EYXRhOwoJCQlmb3IgKCB2YXIgaT0wLCBpTGVuPWFvRGF0YS5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlpZiAoIGFvRGF0YVtpXS5uVHIgIT09IG51bGwgKQoJCQkJewoJCQkJCWFOb2Rlcy5wdXNoKCBhb0RhdGFbaV0ublRyICk7CgkJCQl9CgkJCX0KCQkJcmV0dXJuIGFOb2RlczsKCQl9CgkJCgkJCgkJLyoqCgkJICogUmV0dXJuIGFuIGZsYXQgYXJyYXkgd2l0aCBhbGwgVEQgbm9kZXMgZm9yIHRoZSB0YWJsZSwgb3Igcm93CgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtpbnR9IFtpSW5kaXZpZHVhbFJvd10gYW9EYXRhIGluZGV4IHRvIGdldCB0aGUgbm9kZXMgZm9yIC0gb3B0aW9uYWwgCgkJICogICAgaWYgbm90IGdpdmVuIHRoZW4gdGhlIHJldHVybiBhcnJheSB3aWxsIGNvbnRhaW4gYWxsIG5vZGVzIGZvciB0aGUgdGFibGUKCQkgKiAgQHJldHVybnMge2FycmF5fSBURCBhcnJheQoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5HZXRUZE5vZGVzICggb1NldHRpbmdzLCBpSW5kaXZpZHVhbFJvdyApCgkJewoJCQl2YXIgYW5SZXR1cm4gPSBbXTsKCQkJdmFyIGlDb3JyZWN0b3I7CgkJCXZhciBhblRkczsKCQkJdmFyIGlSb3csIGlSb3dzPW9TZXR0aW5ncy5hb0RhdGEubGVuZ3RoLAoJCQkJaUNvbHVtbiwgaUNvbHVtbnMsIG9EYXRhLCBzTm9kZU5hbWUsIGlTdGFydD0wLCBpRW5kPWlSb3dzOwoJCQkKCQkJLyogQWxsb3cgdGhlIGNvbGxlY3Rpb24gdG8gYmUgbGltaXRlZCB0byBqdXN0IG9uZSByb3cgKi8KCQkJaWYgKCBpSW5kaXZpZHVhbFJvdyAhPT0gdW5kZWZpbmVkICkKCQkJewoJCQkJaVN0YXJ0ID0gaUluZGl2aWR1YWxSb3c7CgkJCQlpRW5kID0gaUluZGl2aWR1YWxSb3crMTsKCQkJfQoJCQoJCQlmb3IgKCBpUm93PWlTdGFydCA7IGlSb3c8aUVuZCA7IGlSb3crKyApCgkJCXsKCQkJCW9EYXRhID0gb1NldHRpbmdzLmFvRGF0YVtpUm93XTsKCQkJCWlmICggb0RhdGEublRyICE9PSBudWxsICkKCQkJCXsKCQkJCQkvKiBnZXQgdGhlIFREIGNoaWxkIG5vZGVzIC0gdGFraW5nIGludG8gYWNjb3VudCB0ZXh0IGV0YyBub2RlcyAqLwoJCQkJCWFuVGRzID0gW107CgkJCQkJZm9yICggaUNvbHVtbj0wLCBpQ29sdW1ucz1vRGF0YS5uVHIuY2hpbGROb2Rlcy5sZW5ndGggOyBpQ29sdW1uPGlDb2x1bW5zIDsgaUNvbHVtbisrICkKCQkJCQl7CgkJCQkJCXNOb2RlTmFtZSA9IG9EYXRhLm5Uci5jaGlsZE5vZGVzW2lDb2x1bW5dLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7CgkJCQkJCWlmICggc05vZGVOYW1lID09ICd0ZCcgfHwgc05vZGVOYW1lID09ICd0aCcgKQoJCQkJCQl7CgkJCQkJCQlhblRkcy5wdXNoKCBvRGF0YS5uVHIuY2hpbGROb2Rlc1tpQ29sdW1uXSApOwoJCQkJCQl9CgkJCQkJfQoJCQoJCQkJCWlDb3JyZWN0b3IgPSAwOwoJCQkJCWZvciAoIGlDb2x1bW49MCwgaUNvbHVtbnM9b1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggOyBpQ29sdW1uPGlDb2x1bW5zIDsgaUNvbHVtbisrICkKCQkJCQl7CgkJCQkJCWlmICggb1NldHRpbmdzLmFvQ29sdW1uc1tpQ29sdW1uXS5iVmlzaWJsZSApCgkJCQkJCXsKCQkJCQkJCWFuUmV0dXJuLnB1c2goIGFuVGRzW2lDb2x1bW4taUNvcnJlY3Rvcl0gKTsKCQkJCQkJfQoJCQkJCQllbHNlCgkJCQkJCXsKCQkJCQkJCWFuUmV0dXJuLnB1c2goIG9EYXRhLl9hbkhpZGRlbltpQ29sdW1uXSApOwoJCQkJCQkJaUNvcnJlY3RvcisrOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJCgkJCXJldHVybiBhblJldHVybjsKCQl9CgkJCgkJCgkJLyoqCgkJICogTG9nIGFuIGVycm9yIG1lc3NhZ2UKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge2ludH0gaUxldmVsIGxvZyBlcnJvciBtZXNzYWdlcywgb3IgZGlzcGxheSB0aGVtIHRvIHRoZSB1c2VyCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzTWVzZyBlcnJvciBtZXNzYWdlCgkJICogIEBtZW1iZXJvZiBEYXRhVGFibGUjb0FwaQoJCSAqLwoJCWZ1bmN0aW9uIF9mbkxvZyggb1NldHRpbmdzLCBpTGV2ZWwsIHNNZXNnICkKCQl7CgkJCXZhciBzQWxlcnQgPSAob1NldHRpbmdzPT09bnVsbCkgPwoJCQkJIkRhdGFUYWJsZXMgd2FybmluZzogIitzTWVzZyA6CgkJCQkiRGF0YVRhYmxlcyB3YXJuaW5nICh0YWJsZSBpZCA9ICciK29TZXR0aW5ncy5zVGFibGVJZCsiJyk6ICIrc01lc2c7CgkJCQoJCQlpZiAoIGlMZXZlbCA9PT0gMCApCgkJCXsKCQkJCWlmICggRGF0YVRhYmxlLmV4dC5zRXJyTW9kZSA9PSAnYWxlcnQnICkKCQkJCXsKCQkJCQlhbGVydCggc0FsZXJ0ICk7CgkJCQl9CgkJCQllbHNlCgkJCQl7CgkJCQkJdGhyb3cgbmV3IEVycm9yKHNBbGVydCk7CgkJCQl9CgkJCQlyZXR1cm47CgkJCX0KCQkJZWxzZSBpZiAoIHdpbmRvdy5jb25zb2xlICYmIGNvbnNvbGUubG9nICkKCQkJewoJCQkJY29uc29sZS5sb2coIHNBbGVydCApOwoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIFNlZSBpZiBhIHByb3BlcnR5IGlzIGRlZmluZWQgb24gb25lIG9iamVjdCwgaWYgc28gYXNzaWduIGl0IHRvIHRoZSBvdGhlciBvYmplY3QKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9SZXQgdGFyZ2V0IG9iamVjdAoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NyYyBzb3VyY2Ugb2JqZWN0CgkJICogIEBwYXJhbSB7c3RyaW5nfSBzTmFtZSBwcm9wZXJ0eQoJCSAqICBAcGFyYW0ge3N0cmluZ30gW3NNYXBwZWROYW1lXSBuYW1lIHRvIG1hcCB0b28gLSBvcHRpb25hbCwgc05hbWUgdXNlZCBpZiBub3QgZ2l2ZW4KCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuTWFwKCBvUmV0LCBvU3JjLCBzTmFtZSwgc01hcHBlZE5hbWUgKQoJCXsKCQkJaWYgKCBzTWFwcGVkTmFtZSA9PT0gdW5kZWZpbmVkICkKCQkJewoJCQkJc01hcHBlZE5hbWUgPSBzTmFtZTsKCQkJfQoJCQlpZiAoIG9TcmNbc05hbWVdICE9PSB1bmRlZmluZWQgKQoJCQl7CgkJCQlvUmV0W3NNYXBwZWROYW1lXSA9IG9TcmNbc05hbWVdOwoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEV4dGVuZCBvYmplY3RzIC0gdmVyeSBzaW1pbGFyIHRvIGpRdWVyeS5leHRlbmQsIGJ1dCBkZWVwIGNvcHkgb2JqZWN0cywgYW5kIHNoYWxsb3cKCQkgKiBjb3B5IGFycmF5cy4gVGhlIHJlYXNvbiB3ZSBuZWVkIHRvIGRvIHRoaXMsIGlzIHRoYXQgd2UgZG9uJ3Qgd2FudCB0byBkZWVwIGNvcHkgYXJyYXkKCQkgKiBpbml0IHZhbHVlcyAoc3VjaCBhcyBhYVNvcnRpbmcpIHNpbmNlIHRoZSBkZXYgd291bGRuJ3QgYmUgYWJsZSB0byBvdmVycmlkZSB0aGVtLCBidXQKCQkgKiB3ZSBkbyB3YW50IHRvIGRlZXAgY29weSBhcnJheXMuCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvT3V0IE9iamVjdCB0byBleHRlbmQKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9FeHRlbmRlciBPYmplY3QgZnJvbSB3aGljaCB0aGUgcHJvcGVydGllcyB3aWxsIGJlIGFwcGxpZWQgdG8gb091dAoJCSAqICBAcmV0dXJucyB7b2JqZWN0fSBvT3V0IFJlZmVyZW5jZSwganVzdCBmb3IgY29udmVuaWVuY2UgLSBvT3V0ID09PSB0aGUgcmV0dXJuLgoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKiAgQHRvZG8gVGhpcyBkb2Vzbid0IHRha2UgYWNjb3VudCBvZiBhcnJheXMgaW5zaWRlIHRoZSBkZWVwIGNvcGllZCBvYmplY3RzLgoJCSAqLwoJCWZ1bmN0aW9uIF9mbkV4dGVuZCggb091dCwgb0V4dGVuZGVyICkKCQl7CgkJCWZvciAoIHZhciBwcm9wIGluIG9FeHRlbmRlciApCgkJCXsKCQkJCWlmICggb0V4dGVuZGVyLmhhc093blByb3BlcnR5KHByb3ApICkKCQkJCXsKCQkJCQlpZiAoIHR5cGVvZiBvSW5pdFtwcm9wXSA9PT0gJ29iamVjdCcgJiYgJC5pc0FycmF5KG9FeHRlbmRlcltwcm9wXSkgPT09IGZhbHNlICkKCQkJCQl7CgkJCQkJCSQuZXh0ZW5kKCB0cnVlLCBvT3V0W3Byb3BdLCBvRXh0ZW5kZXJbcHJvcF0gKTsKCQkJCQl9CgkJCQkJZWxzZQoJCQkJCXsKCQkJCQkJb091dFtwcm9wXSA9IG9FeHRlbmRlcltwcm9wXTsKCQkJCQl9CgkJCQl9CgkJCX0KCQkKCQkJcmV0dXJuIG9PdXQ7CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEJpbmQgYW4gZXZlbnQgaGFuZGVycyB0byBhbGxvdyBhIGNsaWNrIG9yIHJldHVybiBrZXkgdG8gYWN0aXZhdGUgdGhlIGNhbGxiYWNrLgoJCSAqIFRoaXMgaXMgZ29vZCBmb3IgYWNjZXNzYWJpbGl0eSBzaW5jZSBhIHJldHVybiBvbiB0aGUga2V5Ym9hcmQgd2lsbCBoYXZlIHRoZQoJCSAqIHNhbWUgZWZmZWN0IGFzIGEgY2xpY2ssIGlmIHRoZSBlbGVtZW50IGhhcyBmb2N1cy4KCQkgKiAgQHBhcmFtIHtlbGVtZW50fSBuIEVsZW1lbnQgdG8gYmluZCB0aGUgYWN0aW9uIHRvCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvRGF0YSBEYXRhIG9iamVjdCB0byBwYXNzIHRvIHRoZSB0cmlnZ2VyZWQgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHtmdW5jdGlvbn0gZm4gQ2FsbGJhY2sgZnVuY3Rpb24gZm9yIHdoZW4gdGhlIGV2ZW50IGlzIHRyaWdnZXJlZAoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5CaW5kQWN0aW9uKCBuLCBvRGF0YSwgZm4gKQoJCXsKCQkJJChuKQoJCQkJLmJpbmQoICdjbGljay5EVCcsIG9EYXRhLCBmdW5jdGlvbiAoZSkgewoJCQkJCQluLmJsdXIoKTsgLy8gUmVtb3ZlIGZvY3VzIG91dGxpbmUgZm9yIG1vdXNlIHVzZXJzCgkJCQkJCWZuKGUpOwoJCQkJCX0gKQoJCQkJLmJpbmQoICdrZXlwcmVzcy5EVCcsIG9EYXRhLCBmdW5jdGlvbiAoZSl7CgkJCQkJaWYgKCBlLndoaWNoID09PSAxMyApIHsKCQkJCQkJZm4oZSk7CgkJCQkJfSB9ICkKCQkJCS5iaW5kKCAnc2VsZWN0c3RhcnQuRFQnLCBmdW5jdGlvbiAoKSB7CgkJCQkJLyogVGFrZSB0aGUgYnJ1dGFsIGFwcHJvYWNoIHRvIGNhbmNlbGxpbmcgdGV4dCBzZWxlY3Rpb24gKi8KCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQkJfSApOwoJCX0KCQkKCQkKCQkvKioKCQkgKiBSZWdpc3RlciBhIGNhbGxiYWNrIGZ1bmN0aW9uLiBFYXNpbHkgYWxsb3dzIGEgY2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgYWRkZWQgdG8KCQkgKiBhbiBhcnJheSBzdG9yZSBvZiBjYWxsYmFjayBmdW5jdGlvbnMgdGhhdCBjYW4gdGhlbiBhbGwgYmUgY2FsbGVkIHRvZ2V0aGVyLgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7c3RyaW5nfSBzU3RvcmUgTmFtZSBvZiB0aGUgYXJyYXkgc3RvcmVhZ2UgZm9yIHRoZSBjYWxsYmFja3MgaW4gb1NldHRpbmdzCgkJICogIEBwYXJhbSB7ZnVuY3Rpb259IGZuIEZ1bmN0aW9uIHRvIGJlIGNhbGxlZCBiYWNrCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzTmFtZSBJZGVudGlmeWluZyBuYW1lIGZvciB0aGUgY2FsbGJhY2sgKGkuZS4gYSBsYWJlbCkKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuQ2FsbGJhY2tSZWcoIG9TZXR0aW5ncywgc1N0b3JlLCBmbiwgc05hbWUgKQoJCXsKCQkJaWYgKCBmbiApCgkJCXsKCQkJCW9TZXR0aW5nc1tzU3RvcmVdLnB1c2goIHsKCQkJCQkiZm4iOiBmbiwKCQkJCQkic05hbWUiOiBzTmFtZQoJCQkJfSApOwoJCQl9CgkJfQoJCQoJCQoJCS8qKgoJCSAqIEZpcmUgY2FsbGJhY2sgZnVuY3Rpb25zIGFuZCB0cmlnZ2VyIGV2ZW50cy4gTm90ZSB0aGF0IHRoZSBsb29wIG92ZXIgdGhlIGNhbGxiYWNrCgkJICogYXJyYXkgc3RvcmUgaXMgZG9uZSBiYWNrd2FyZHMhIEZ1cnRoZXIgbm90ZSB0aGF0IHlvdSBkbyBub3Qgd2FudCB0byBmaXJlIG9mZiB0cmlnZ2VycwoJCSAqIGluIHRpbWUgc2Vuc2l0aXZlIGFwcGxpY2F0aW9ucyAoZm9yIGV4YW1wbGUgY2VsbCBjcmVhdGlvbikgYXMgaXRzIHNsb3cuCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNTdG9yZSBOYW1lIG9mIHRoZSBhcnJheSBzdG9yZWFnZSBmb3IgdGhlIGNhbGxiYWNrcyBpbiBvU2V0dGluZ3MKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNUcmlnZ2VyIE5hbWUgb2YgdGhlIGpRdWVyeSBjdXN0b20gZXZlbnQgdG8gdHJpZ2dlci4gSWYgbnVsbCBubyB0cmlnZ2VyCgkJICogICAgaXMgZmlyZWQKCQkgKiAgQHBhcmFtIHthcnJheX0gYUFyZ3MgQXJyYXkgb2YgYXJndW1lbnRzIHRvIHBhc3MgdG8gdGhlIGNhbGxiYWNrIGZ1bmN0aW9uIC8gdHJpZ2dlcgoJCSAqICBAbWVtYmVyb2YgRGF0YVRhYmxlI29BcGkKCQkgKi8KCQlmdW5jdGlvbiBfZm5DYWxsYmFja0ZpcmUoIG9TZXR0aW5ncywgc1N0b3JlLCBzVHJpZ2dlciwgYUFyZ3MgKQoJCXsKCQkJdmFyIGFvU3RvcmUgPSBvU2V0dGluZ3Nbc1N0b3JlXTsKCQkJdmFyIGFSZXQgPVtdOwoJCQoJCQlmb3IgKCB2YXIgaT1hb1N0b3JlLmxlbmd0aC0xIDsgaT49MCA7IGktLSApCgkJCXsKCQkJCWFSZXQucHVzaCggYW9TdG9yZVtpXS5mbi5hcHBseSggb1NldHRpbmdzLm9JbnN0YW5jZSwgYUFyZ3MgKSApOwoJCQl9CgkJCgkJCWlmICggc1RyaWdnZXIgIT09IG51bGwgKQoJCQl7CgkJCQkkKG9TZXR0aW5ncy5vSW5zdGFuY2UpLnRyaWdnZXIoc1RyaWdnZXIsIGFBcmdzKTsKCQkJfQoJCQoJCQlyZXR1cm4gYVJldDsKCQl9CgkJCgkJCgkJLyoqCgkJICogSlNPTiBzdHJpbmdpZnkuIElmIEpTT04uc3RyaW5naWZ5IGl0IHByb3ZpZGVkIGJ5IHRoZSBicm93c2VyLCBqc29uMi5qcyBvciBhbnkgb3RoZXIKCQkgKiBsaWJyYXJ5LCB0aGVuIHdlIHVzZSB0aGF0IGFzIGl0IGlzIGZhc3QsIHNhZmUgYW5kIGFjY3VyYXRlLiBJZiB0aGUgZnVuY3Rpb24gaXNuJ3QgCgkJICogYXZhaWxhYmxlIHRoZW4gd2UgbmVlZCB0byBidWlsdCBpdCBvdXJzZWx2ZXMgLSB0aGUgaW5zcGVyYXRpb24gZm9yIHRoaXMgZnVuY3Rpb24gY29tZXMKCQkgKiBmcm9tIENyYWlnIEJ1Y2tsZXIgKCBodHRwOi8vd3d3LnNpdGVwb2ludC5jb20vamF2YXNjcmlwdC1qc29uLXNlcmlhbGl6YXRpb24vICkuIEl0IGlzCgkJICogbm90IHBlcmZlY3QgYW5kIGFic29sdXRlbHkgc2hvdWxkIG5vdCBiZSB1c2VkIGFzIGEgcmVwbGFjZW1lbnQgdG8ganNvbjIuanMgLSBidXQgaXQgZG9lcwoJCSAqIGRvIHdoYXQgd2UgbmVlZCwgd2l0aG91dCByZXF1aXJpbmcgYSBkZXBlbmRlbmN5IGZvciBEYXRhVGFibGVzLgoJCSAqICBAcGFyYW0ge29iamVjdH0gbyBKU09OIG9iamVjdCB0byBiZSBjb252ZXJ0ZWQKCQkgKiAgQHJldHVybnMge3N0cmluZ30gSlNPTiBzdHJpbmcKCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJdmFyIF9mbkpzb25TdHJpbmcgPSAod2luZG93LkpTT04pID8gSlNPTi5zdHJpbmdpZnkgOiBmdW5jdGlvbiggbyApCgkJewoJCQkvKiBOb3QgYW4gb2JqZWN0IG9yIGFycmF5ICovCgkJCXZhciBzVHlwZSA9IHR5cGVvZiBvOwoJCQlpZiAoc1R5cGUgIT09ICJvYmplY3QiIHx8IG8gPT09IG51bGwpCgkJCXsKCQkJCS8vIHNpbXBsZSBkYXRhIHR5cGUKCQkJCWlmIChzVHlwZSA9PT0gInN0cmluZyIpCgkJCQl7CgkJCQkJbyA9ICciJytvKyciJzsKCQkJCX0KCQkJCXJldHVybiBvKyIiOwoJCQl9CgkJCgkJCS8qIElmIG9iamVjdCBvciBhcnJheSwgbmVlZCB0byByZWN1cnNlIG92ZXIgaXQgKi8KCQkJdmFyCgkJCQlzUHJvcCwgbVZhbHVlLAoJCQkJanNvbiA9IFtdLAoJCQkJYkFyciA9ICQuaXNBcnJheShvKTsKCQkJCgkJCWZvciAoc1Byb3AgaW4gbykKCQkJewoJCQkJbVZhbHVlID0gb1tzUHJvcF07CgkJCQlzVHlwZSA9IHR5cGVvZiBtVmFsdWU7CgkJCgkJCQlpZiAoc1R5cGUgPT09ICJzdHJpbmciKQoJCQkJewoJCQkJCW1WYWx1ZSA9ICciJyttVmFsdWUrJyInOwoJCQkJfQoJCQkJZWxzZSBpZiAoc1R5cGUgPT09ICJvYmplY3QiICYmIG1WYWx1ZSAhPT0gbnVsbCkKCQkJCXsKCQkJCQltVmFsdWUgPSBfZm5Kc29uU3RyaW5nKG1WYWx1ZSk7CgkJCQl9CgkJCgkJCQlqc29uLnB1c2goKGJBcnIgPyAiIiA6ICciJytzUHJvcCsnIjonKSArIG1WYWx1ZSk7CgkJCX0KCQkKCQkJcmV0dXJuIChiQXJyID8gIlsiIDogInsiKSArIGpzb24gKyAoYkFyciA/ICJdIiA6ICJ9Iik7CgkJfTsKCQkKCgkJCgkJCgkJLyoqCgkJICogUGVyZm9ybSBhIGpRdWVyeSBzZWxlY3RvciBhY3Rpb24gb24gdGhlIHRhYmxlJ3MgVFIgZWxlbWVudHMgKGZyb20gdGhlIHRib2R5KSBhbmQKCQkgKiByZXR1cm4gdGhlIHJlc3VsdGluZyBqUXVlcnkgb2JqZWN0LgoJCSAqICBAcGFyYW0ge3N0cmluZ3xub2RlfGpRdWVyeX0gc1NlbGVjdG9yIGpRdWVyeSBzZWxlY3RvciBvciBub2RlIGNvbGxlY3Rpb24gdG8gYWN0IG9uCgkJICogIEBwYXJhbSB7b2JqZWN0fSBbb09wdHNdIE9wdGlvbmFsIHBhcmFtZXRlcnMgZm9yIG1vZGlmeWluZyB0aGUgcm93cyB0byBiZSBpbmNsdWRlZAoJCSAqICBAcGFyYW0ge3N0cmluZ30gW29PcHRzLmZpbHRlcj1ub25lXSBTZWxlY3QgVFIgZWxlbWVudHMgdGhhdCBtZWV0IHRoZSBjdXJyZW50IGZpbHRlcgoJCSAqICAgIGNyaXRlcmlvbiAoImFwcGxpZWQiKSBvciBhbGwgVFIgZWxlbWVudHMgKGkuZS4gbm8gZmlsdGVyKS4KCQkgKiAgQHBhcmFtIHtzdHJpbmd9IFtvT3B0cy5vcmRlcj1jdXJyZW50XSBPcmRlciBvZiB0aGUgVFIgZWxlbWVudHMgaW4gdGhlIHByb2Nlc3NlZCBhcnJheS4KCQkgKiAgICBDYW4gYmUgZWl0aGVyICdjdXJyZW50Jywgd2hlcmVieSB0aGUgY3VycmVudCBzb3J0aW5nIG9mIHRoZSB0YWJsZSBpcyB1c2VkLCBvcgoJCSAqICAgICdvcmlnaW5hbCcgd2hlcmVieSB0aGUgb3JpZ2luYWwgb3JkZXIgdGhlIGRhdGEgd2FzIHJlYWQgaW50byB0aGUgdGFibGUgaXMgdXNlZC4KCQkgKiAgQHBhcmFtIHtzdHJpbmd9IFtvT3B0cy5wYWdlPWFsbF0gTGltaXQgdGhlIHNlbGVjdGlvbiB0byB0aGUgY3VycmVudGx5IGRpc3BsYXllZCBwYWdlCgkJICogICAgKCJjdXJyZW50Iikgb3Igbm90ICgiYWxsIikuIElmICdjdXJyZW50JyBpcyBnaXZlbiwgdGhlbiBvcmRlciBpcyBhc3N1bWVkIHRvIGJlIAoJCSAqICAgICdjdXJyZW50JyBhbmQgZmlsdGVyIGlzICdhcHBsaWVkJywgcmVnYXJkbGVzcyBvZiB3aGF0IHRoZXkgbWlnaHQgYmUgZ2l2ZW4gYXMuCgkJICogIEByZXR1cm5zIHtvYmplY3R9IGpRdWVyeSBvYmplY3QsIGZpbHRlcmVkIGJ5IHRoZSBnaXZlbiBzZWxlY3Rvci4KCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKgoJCSAqICAgICAgLy8gSGlnaGxpZ2h0IGV2ZXJ5IHNlY29uZCByb3cKCQkgKiAgICAgIG9UYWJsZS4kKCd0cjpvZGQnKS5jc3MoJ2JhY2tncm91bmRDb2xvcicsICdibHVlJyk7CgkJICogICAgfSApOwoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKgoJCSAqICAgICAgLy8gRmlsdGVyIHRvIHJvd3Mgd2l0aCAnV2Via2l0JyBpbiB0aGVtLCBhZGQgYSBiYWNrZ3JvdW5kIGNvbG91ciBhbmQgdGhlbgoJCSAqICAgICAgLy8gcmVtb3ZlIHRoZSBmaWx0ZXIsIHRodXMgaGlnaGxpZ2h0aW5nIHRoZSAnV2Via2l0JyByb3dzIG9ubHkuCgkJICogICAgICBvVGFibGUuZm5GaWx0ZXIoJ1dlYmtpdCcpOwoJCSAqICAgICAgb1RhYmxlLiQoJ3RyJywgeyJmaWx0ZXIiOiAiYXBwbGllZCJ9KS5jc3MoJ2JhY2tncm91bmRDb2xvcicsICdibHVlJyk7CgkJICogICAgICBvVGFibGUuZm5GaWx0ZXIoJycpOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLiQgPSBmdW5jdGlvbiAoIHNTZWxlY3Rvciwgb09wdHMgKQoJCXsKCQkJdmFyIGksIGlMZW4sIGEgPSBbXSwgdHI7CgkJCXZhciBvU2V0dGluZ3MgPSBfZm5TZXR0aW5nc0Zyb21Ob2RlKCB0aGlzW0RhdGFUYWJsZS5leHQuaUFwaUluZGV4XSApOwoJCQl2YXIgYW9EYXRhID0gb1NldHRpbmdzLmFvRGF0YTsKCQkJdmFyIGFpRGlzcGxheSA9IG9TZXR0aW5ncy5haURpc3BsYXk7CgkJCXZhciBhaURpc3BsYXlNYXN0ZXIgPSBvU2V0dGluZ3MuYWlEaXNwbGF5TWFzdGVyOwoJCQoJCQlpZiAoICFvT3B0cyApCgkJCXsKCQkJCW9PcHRzID0ge307CgkJCX0KCQkKCQkJb09wdHMgPSAkLmV4dGVuZCgge30sIHsKCQkJCSJmaWx0ZXIiOiAibm9uZSIsIC8vIGFwcGxpZWQKCQkJCSJvcmRlciI6ICJjdXJyZW50IiwgLy8gIm9yaWdpbmFsIgoJCQkJInBhZ2UiOiAiYWxsIiAvLyBjdXJyZW50CgkJCX0sIG9PcHRzICk7CgkJCgkJCS8vIEN1cnJlbnQgcGFnZSBpbXBsaWVzIHRoYXQgb3JkZXI9Y3VycmVudCBhbmQgZml0bGVyPWFwcGxpZWQsIHNpbmNlIGl0IGlzIGZhaXJseQoJCQkvLyBzZW5zZWxlc3Mgb3RoZXJ3aXNlCgkJCWlmICggb09wdHMucGFnZSA9PSAnY3VycmVudCcgKQoJCQl7CgkJCQlmb3IgKCBpPW9TZXR0aW5ncy5faURpc3BsYXlTdGFydCwgaUxlbj1vU2V0dGluZ3MuZm5EaXNwbGF5RW5kKCkgOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCXRyID0gYW9EYXRhWyBhaURpc3BsYXlbaV0gXS5uVHI7CgkJCQkJaWYgKCB0ciApCgkJCQkJewoJCQkJCQlhLnB1c2goIHRyICk7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCWVsc2UgaWYgKCBvT3B0cy5vcmRlciA9PSAiY3VycmVudCIgJiYgb09wdHMuZmlsdGVyID09ICJub25lIiApCgkJCXsKCQkJCWZvciAoIGk9MCwgaUxlbj1haURpc3BsYXlNYXN0ZXIubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQl0ciA9IGFvRGF0YVsgYWlEaXNwbGF5TWFzdGVyW2ldIF0ublRyOwoJCQkJCWlmICggdHIgKQoJCQkJCXsKCQkJCQkJYS5wdXNoKCB0ciApOwoJCQkJCX0KCQkJCX0KCQkJfQoJCQllbHNlIGlmICggb09wdHMub3JkZXIgPT0gImN1cnJlbnQiICYmIG9PcHRzLmZpbHRlciA9PSAiYXBwbGllZCIgKQoJCQl7CgkJCQlmb3IgKCBpPTAsIGlMZW49YWlEaXNwbGF5Lmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJdHIgPSBhb0RhdGFbIGFpRGlzcGxheVtpXSBdLm5UcjsKCQkJCQlpZiAoIHRyICkKCQkJCQl7CgkJCQkJCWEucHVzaCggdHIgKTsKCQkJCQl9CgkJCQl9CgkJCX0KCQkJZWxzZSBpZiAoIG9PcHRzLm9yZGVyID09ICJvcmlnaW5hbCIgJiYgb09wdHMuZmlsdGVyID09ICJub25lIiApCgkJCXsKCQkJCWZvciAoIGk9MCwgaUxlbj1hb0RhdGEubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQl0ciA9IGFvRGF0YVsgaSBdLm5UciA7CgkJCQkJaWYgKCB0ciApCgkJCQkJewoJCQkJCQlhLnB1c2goIHRyICk7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCWVsc2UgaWYgKCBvT3B0cy5vcmRlciA9PSAib3JpZ2luYWwiICYmIG9PcHRzLmZpbHRlciA9PSAiYXBwbGllZCIgKQoJCQl7CgkJCQlmb3IgKCBpPTAsIGlMZW49YW9EYXRhLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJdHIgPSBhb0RhdGFbIGkgXS5uVHI7CgkJCQkJaWYgKCAkLmluQXJyYXkoIGksIGFpRGlzcGxheSApICE9PSAtMSAmJiB0ciApCgkJCQkJewoJCQkJCQlhLnB1c2goIHRyICk7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCWVsc2UKCQkJewoJCQkJX2ZuTG9nKCBvU2V0dGluZ3MsIDEsICJVbmtub3duIHNlbGVjdGlvbiBvcHRpb25zIiApOwoJCQl9CgkJCgkJCS8qIFdlIG5lZWQgdG8gZmlsdGVyIG9uIHRoZSBUUiBlbGVtZW50cyBhbmQgYWxzbyAnZmluZCcgaW4gdGhlaXIgZGVzY2VuZGFudHMKCQkJICogdG8gbWFrZSB0aGUgc2VsZWN0b3IgYWN0IGxpa2UgaXQgd291bGQgaW4gYSBmdWxsIHRhYmxlIC0gc28gd2UgbmVlZAoJCQkgKiB0byBidWlsZCBib3RoIHJlc3VsdHMgYW5kIHRoZW4gY29tYmluZSB0aGVtIHRvZ2V0aGVyCgkJCSAqLwoJCQl2YXIganFBID0gJChhKTsKCQkJdmFyIGpxVFJzID0ganFBLmZpbHRlciggc1NlbGVjdG9yICk7CgkJCXZhciBqcURlc2NlbmRhbnRzID0ganFBLmZpbmQoIHNTZWxlY3RvciApOwoJCQoJCQlyZXR1cm4gJCggW10uY29uY2F0KCQubWFrZUFycmF5KGpxVFJzKSwgJC5tYWtlQXJyYXkoanFEZXNjZW5kYW50cykpICk7CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBBbG1vc3QgaWRlbnRpY2FsIHRvICQgaW4gb3BlcmF0aW9uLCBidXQgaW4gdGhpcyBjYXNlIHJldHVybnMgdGhlIGRhdGEgZm9yIHRoZSBtYXRjaGVkCgkJICogcm93cyAtIGFzIHN1Y2gsIHRoZSBqUXVlcnkgc2VsZWN0b3IgdXNlZCBzaG91bGQgbWF0Y2ggVFIgcm93IG5vZGVzIG9yIFREL1RIIGNlbGwgbm9kZXMKCQkgKiByYXRoZXIgdGhhbiBhbnkgZGVjZW5kZW50cywgc28gdGhlIGRhdGEgY2FuIGJlIG9idGFpbmVkIGZvciB0aGUgcm93L2NlbGwuIElmIG1hdGNoaW5nCgkJICogcm93cyBhcmUgZm91bmQsIHRoZSBkYXRhIHJldHVybmVkIGlzIHRoZSBvcmlnaW5hbCBkYXRhIGFycmF5L29iamVjdCB0aGF0IHdhcyB1c2VkIHRvICAKCQkgKiBjcmVhdGUgdGhlIHJvdyAob3IgYSBnZW5lcmF0ZWQgYXJyYXkgaWYgZnJvbSBhIERPTSBzb3VyY2UpLgoJCSAqCgkJICogVGhpcyBtZXRob2QgaXMgb2Z0ZW4gdXNlZnVsIGluY29tYmluYXRpb24gd2l0aCAkIHdoZXJlIGJvdGggZnVuY3Rpb25zIGFyZSBnaXZlbiB0aGUKCQkgKiBzYW1lIHBhcmFtZXRlcnMgYW5kIHRoZSBhcnJheSBpbmRleGVzIHdpbGwgbWF0Y2ggaWRlbnRpY2FsbHkuCgkJICogIEBwYXJhbSB7c3RyaW5nfG5vZGV8alF1ZXJ5fSBzU2VsZWN0b3IgalF1ZXJ5IHNlbGVjdG9yIG9yIG5vZGUgY29sbGVjdGlvbiB0byBhY3Qgb24KCQkgKiAgQHBhcmFtIHtvYmplY3R9IFtvT3B0c10gT3B0aW9uYWwgcGFyYW1ldGVycyBmb3IgbW9kaWZ5aW5nIHRoZSByb3dzIHRvIGJlIGluY2x1ZGVkCgkJICogIEBwYXJhbSB7c3RyaW5nfSBbb09wdHMuZmlsdGVyPW5vbmVdIFNlbGVjdCBlbGVtZW50cyB0aGF0IG1lZXQgdGhlIGN1cnJlbnQgZmlsdGVyCgkJICogICAgY3JpdGVyaW9uICgiYXBwbGllZCIpIG9yIGFsbCBlbGVtZW50cyAoaS5lLiBubyBmaWx0ZXIpLgoJCSAqICBAcGFyYW0ge3N0cmluZ30gW29PcHRzLm9yZGVyPWN1cnJlbnRdIE9yZGVyIG9mIHRoZSBkYXRhIGluIHRoZSBwcm9jZXNzZWQgYXJyYXkuCgkJICogICAgQ2FuIGJlIGVpdGhlciAnY3VycmVudCcsIHdoZXJlYnkgdGhlIGN1cnJlbnQgc29ydGluZyBvZiB0aGUgdGFibGUgaXMgdXNlZCwgb3IKCQkgKiAgICAnb3JpZ2luYWwnIHdoZXJlYnkgdGhlIG9yaWdpbmFsIG9yZGVyIHRoZSBkYXRhIHdhcyByZWFkIGludG8gdGhlIHRhYmxlIGlzIHVzZWQuCgkJICogIEBwYXJhbSB7c3RyaW5nfSBbb09wdHMucGFnZT1hbGxdIExpbWl0IHRoZSBzZWxlY3Rpb24gdG8gdGhlIGN1cnJlbnRseSBkaXNwbGF5ZWQgcGFnZQoJCSAqICAgICgiY3VycmVudCIpIG9yIG5vdCAoImFsbCIpLiBJZiAnY3VycmVudCcgaXMgZ2l2ZW4sIHRoZW4gb3JkZXIgaXMgYXNzdW1lZCB0byBiZSAKCQkgKiAgICAnY3VycmVudCcgYW5kIGZpbHRlciBpcyAnYXBwbGllZCcsIHJlZ2FyZGxlc3Mgb2Ygd2hhdCB0aGV5IG1pZ2h0IGJlIGdpdmVuIGFzLgoJCSAqICBAcmV0dXJucyB7YXJyYXl9IERhdGEgZm9yIHRoZSBtYXRjaGVkIGVsZW1lbnRzLiBJZiBhbnkgZWxlbWVudHMsIGFzIGEgcmVzdWx0IG9mIHRoZQoJCSAqICAgIHNlbGVjdG9yLCB3ZXJlIG5vdCBUUiwgVEQgb3IgVEggZWxlbWVudHMgaW4gdGhlIERhdGFUYWJsZSwgdGhleSB3aWxsIGhhdmUgYSBudWxsIAoJCSAqICAgIGVudHJ5IGluIHRoZSBhcnJheS4KCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKgoJCSAqICAgICAgLy8gR2V0IHRoZSBkYXRhIGZyb20gdGhlIGZpcnN0IHJvdyBpbiB0aGUgdGFibGUKCQkgKiAgICAgIHZhciBkYXRhID0gb1RhYmxlLl8oJ3RyOmZpcnN0Jyk7CgkJICoKCQkgKiAgICAgIC8vIERvIHNvbWV0aGluZyB1c2VmdWwgd2l0aCB0aGUgZGF0YQoJCSAqICAgICAgYWxlcnQoICJGaXJzdCBjZWxsIGlzOiAiK2RhdGFbMF0gKTsKCQkgKiAgICB9ICk7CgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqCgkJICogICAgICAvLyBGaWx0ZXIgdG8gJ1dlYmtpdCcgYW5kIGdldCBhbGwgZGF0YSBmb3IgCgkJICogICAgICBvVGFibGUuZm5GaWx0ZXIoJ1dlYmtpdCcpOwoJCSAqICAgICAgdmFyIGRhdGEgPSBvVGFibGUuXygndHInLCB7ImZpbHRlciI6ICJhcHBsaWVkIn0pOwoJCSAqICAgICAgCgkJICogICAgICAvLyBEbyBzb21ldGhpbmcgd2l0aCB0aGUgZGF0YQoJCSAqICAgICAgYWxlcnQoIGRhdGEubGVuZ3RoKyIgcm93cyBtYXRjaGVkIHRoZSBmaWx0ZXIiICk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuXyA9IGZ1bmN0aW9uICggc1NlbGVjdG9yLCBvT3B0cyApCgkJewoJCQl2YXIgYU91dCA9IFtdOwoJCQl2YXIgaSwgaUxlbiwgaUluZGV4OwoJCQl2YXIgYVRycyA9IHRoaXMuJCggc1NlbGVjdG9yLCBvT3B0cyApOwoJCQoJCQlmb3IgKCBpPTAsIGlMZW49YVRycy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlhT3V0LnB1c2goIHRoaXMuZm5HZXREYXRhKGFUcnNbaV0pICk7CgkJCX0KCQkKCQkJcmV0dXJuIGFPdXQ7CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBBZGQgYSBzaW5nbGUgbmV3IHJvdyBvciBtdWx0aXBsZSByb3dzIG9mIGRhdGEgdG8gdGhlIHRhYmxlLiBQbGVhc2Ugbm90ZQoJCSAqIHRoYXQgdGhpcyBpcyBzdWl0YWJsZSBmb3IgY2xpZW50LXNpZGUgcHJvY2Vzc2luZyBvbmx5IC0gaWYgeW91IGFyZSB1c2luZyAKCQkgKiBzZXJ2ZXItc2lkZSBwcm9jZXNzaW5nIChpLmUuICJiU2VydmVyU2lkZSI6IHRydWUpLCB0aGVuIHRvIGFkZCBkYXRhLCB5b3UKCQkgKiBtdXN0IGFkZCBpdCB0byB0aGUgZGF0YSBzb3VyY2UsIGkuZS4gdGhlIHNlcnZlci1zaWRlLCB0aHJvdWdoIGFuIEFqYXggY2FsbC4KCQkgKiAgQHBhcmFtIHthcnJheXxvYmplY3R9IG1EYXRhIFRoZSBkYXRhIHRvIGJlIGFkZGVkIHRvIHRoZSB0YWJsZS4gVGhpcyBjYW4gYmU6CgkJICogICAgPHVsPgoJCSAqICAgICAgPGxpPjFEIGFycmF5IG9mIGRhdGEgLSBhZGQgYSBzaW5nbGUgcm93IHdpdGggdGhlIGRhdGEgcHJvdmlkZWQ8L2xpPgoJCSAqICAgICAgPGxpPjJEIGFycmF5IG9mIGFycmF5cyAtIGFkZCBtdWx0aXBsZSByb3dzIGluIGEgc2luZ2xlIGNhbGw8L2xpPgoJCSAqICAgICAgPGxpPm9iamVjdCAtIGRhdGEgb2JqZWN0IHdoZW4gdXNpbmcgPGk+bURhdGFQcm9wPC9pPjwvbGk+CgkJICogICAgICA8bGk+YXJyYXkgb2Ygb2JqZWN0cyAtIG11bHRpcGxlIGRhdGEgb2JqZWN0cyB3aGVuIHVzaW5nIDxpPm1EYXRhUHJvcDwvaT48L2xpPgoJCSAqICAgIDwvdWw+CgkJICogIEBwYXJhbSB7Ym9vbH0gW2JSZWRyYXc9dHJ1ZV0gcmVkcmF3IHRoZSB0YWJsZSBvciBub3QKCQkgKiAgQHJldHVybnMge2FycmF5fSBBbiBhcnJheSBvZiBpbnRlZ2VycywgcmVwcmVzZW50aW5nIHRoZSBsaXN0IG9mIGluZGV4ZXMgaW4gCgkJICogICAgPGk+YW9EYXRhPC9pPiAoe0BsaW5rIERhdGFUYWJsZS5tb2RlbHMub1NldHRpbmdzfSkgdGhhdCBoYXZlIGJlZW4gYWRkZWQgdG8gCgkJICogICAgdGhlIHRhYmxlLgoJCSAqICBAZHRvcHQgQVBJCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBHbG9iYWwgdmFyIGZvciBjb3VudGVyCgkJICogICAgdmFyIGdpQ291bnQgPSAyOwoJCSAqICAgIAoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogICAgZnVuY3Rpb24gZm5DbGlja0FkZFJvdygpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCkuZm5BZGREYXRhKCBbCgkJICogICAgICAgIGdpQ291bnQrIi4xIiwKCQkgKiAgICAgICAgZ2lDb3VudCsiLjIiLAoJCSAqICAgICAgICBnaUNvdW50KyIuMyIsCgkJICogICAgICAgIGdpQ291bnQrIi40IiBdCgkJICogICAgICApOwoJCSAqICAgICAgICAKCQkgKiAgICAgIGdpQ291bnQrKzsKCQkgKiAgICB9CgkJICovCgkJdGhpcy5mbkFkZERhdGEgPSBmdW5jdGlvbiggbURhdGEsIGJSZWRyYXcgKQoJCXsKCQkJaWYgKCBtRGF0YS5sZW5ndGggPT09IDAgKQoJCQl7CgkJCQlyZXR1cm4gW107CgkJCX0KCQkJCgkJCXZhciBhaVJldHVybiA9IFtdOwoJCQl2YXIgaVRlc3Q7CgkJCQoJCQkvKiBGaW5kIHNldHRpbmdzIGZyb20gdGFibGUgbm9kZSAqLwoJCQl2YXIgb1NldHRpbmdzID0gX2ZuU2V0dGluZ3NGcm9tTm9kZSggdGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0gKTsKCQkJCgkJCS8qIENoZWNrIGlmIHdlIHdhbnQgdG8gYWRkIG11bHRpcGxlIHJvd3Mgb3Igbm90ICovCgkJCWlmICggdHlwZW9mIG1EYXRhWzBdID09PSAib2JqZWN0IiAmJiBtRGF0YVswXSAhPT0gbnVsbCApCgkJCXsKCQkJCWZvciAoIHZhciBpPTAgOyBpPG1EYXRhLmxlbmd0aCA7IGkrKyApCgkJCQl7CgkJCQkJaVRlc3QgPSBfZm5BZGREYXRhKCBvU2V0dGluZ3MsIG1EYXRhW2ldICk7CgkJCQkJaWYgKCBpVGVzdCA9PSAtMSApCgkJCQkJewoJCQkJCQlyZXR1cm4gYWlSZXR1cm47CgkJCQkJfQoJCQkJCWFpUmV0dXJuLnB1c2goIGlUZXN0ICk7CgkJCQl9CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQlpVGVzdCA9IF9mbkFkZERhdGEoIG9TZXR0aW5ncywgbURhdGEgKTsKCQkJCWlmICggaVRlc3QgPT0gLTEgKQoJCQkJewoJCQkJCXJldHVybiBhaVJldHVybjsKCQkJCX0KCQkJCWFpUmV0dXJuLnB1c2goIGlUZXN0ICk7CgkJCX0KCQkJCgkJCW9TZXR0aW5ncy5haURpc3BsYXkgPSBvU2V0dGluZ3MuYWlEaXNwbGF5TWFzdGVyLnNsaWNlKCk7CgkJCQoJCQlpZiAoIGJSZWRyYXcgPT09IHVuZGVmaW5lZCB8fCBiUmVkcmF3ICkKCQkJewoJCQkJX2ZuUmVEcmF3KCBvU2V0dGluZ3MgKTsKCQkJfQoJCQlyZXR1cm4gYWlSZXR1cm47CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBUaGlzIGZ1bmN0aW9uIHdpbGwgbWFrZSBEYXRhVGFibGVzIHJlY2FsY3VsYXRlIHRoZSBjb2x1bW4gc2l6ZXMsIGJhc2VkIG9uIHRoZSBkYXRhIAoJCSAqIGNvbnRhaW5lZCBpbiB0aGUgdGFibGUgYW5kIHRoZSBzaXplcyBhcHBsaWVkIHRvIHRoZSBjb2x1bW5zIChpbiB0aGUgRE9NLCBDU1Mgb3IgCgkJICogdGhyb3VnaCB0aGUgc1dpZHRoIHBhcmFtZXRlcikuIFRoaXMgY2FuIGJlIHVzZWZ1bCB3aGVuIHRoZSB3aWR0aCBvZiB0aGUgdGFibGUncyAKCQkgKiBwYXJlbnQgZWxlbWVudCBjaGFuZ2VzIChmb3IgZXhhbXBsZSBhIHdpbmRvdyByZXNpemUpLgoJCSAqICBAcGFyYW0ge2Jvb2xlYW59IFtiUmVkcmF3PXRydWVdIFJlZHJhdyB0aGUgdGFibGUgb3Igbm90LCB5b3Ugd2lsbCB0eXBpY2FsbHkgd2FudCB0bwoJCSAqICBAZHRvcHQgQVBJCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic1Njcm9sbFkiOiAiMjAwcHgiLAoJCSAqICAgICAgICAiYlBhZ2luYXRlIjogZmFsc2UKCQkgKiAgICAgIH0gKTsKCQkgKiAgICAgIAoJCSAqICAgICAgJCh3aW5kb3cpLmJpbmQoJ3Jlc2l6ZScsIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICAgb1RhYmxlLmZuQWRqdXN0Q29sdW1uU2l6aW5nKCk7CgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuZm5BZGp1c3RDb2x1bW5TaXppbmcgPSBmdW5jdGlvbiAoIGJSZWRyYXcgKQoJCXsKCQkJdmFyIG9TZXR0aW5ncyA9IF9mblNldHRpbmdzRnJvbU5vZGUodGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0pOwoJCQlfZm5BZGp1c3RDb2x1bW5TaXppbmcoIG9TZXR0aW5ncyApOwoJCQkKCQkJaWYgKCBiUmVkcmF3ID09PSB1bmRlZmluZWQgfHwgYlJlZHJhdyApCgkJCXsKCQkJCXRoaXMuZm5EcmF3KCBmYWxzZSApOwoJCQl9CgkJCWVsc2UgaWYgKCBvU2V0dGluZ3Mub1Njcm9sbC5zWCAhPT0gIiIgfHwgb1NldHRpbmdzLm9TY3JvbGwuc1kgIT09ICIiICkKCQkJewoJCQkJLyogSWYgbm90IHJlZHJhd2luZywgYnV0IHNjcm9sbGluZywgd2Ugd2FudCB0byBhcHBseSB0aGUgbmV3IGNvbHVtbiBzaXplcyBhbnl3YXkgKi8KCQkJCXRoaXMub0FwaS5fZm5TY3JvbGxEcmF3KG9TZXR0aW5ncyk7CgkJCX0KCQl9OwoJCQoJCQoJCS8qKgoJCSAqIFF1aWNrbHkgYW5kIHNpbXBseSBjbGVhciBhIHRhYmxlCgkJICogIEBwYXJhbSB7Ym9vbH0gW2JSZWRyYXc9dHJ1ZV0gcmVkcmF3IHRoZSB0YWJsZSBvciBub3QKCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICAgIAoJCSAqICAgICAgLy8gSW1tZWRpYXRlbHkgJ251a2UnIHRoZSBjdXJyZW50IHJvd3MgKHBlcmhhcHMgd2FpdGluZyBmb3IgYW4gQWpheCBjYWxsYmFjay4uLikKCQkgKiAgICAgIG9UYWJsZS5mbkNsZWFyVGFibGUoKTsKCQkgKiAgICB9ICk7CgkJICovCgkJdGhpcy5mbkNsZWFyVGFibGUgPSBmdW5jdGlvbiggYlJlZHJhdyApCgkJewoJCQkvKiBGaW5kIHNldHRpbmdzIGZyb20gdGFibGUgbm9kZSAqLwoJCQl2YXIgb1NldHRpbmdzID0gX2ZuU2V0dGluZ3NGcm9tTm9kZSggdGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0gKTsKCQkJX2ZuQ2xlYXJUYWJsZSggb1NldHRpbmdzICk7CgkJCQoJCQlpZiAoIGJSZWRyYXcgPT09IHVuZGVmaW5lZCB8fCBiUmVkcmF3ICkKCQkJewoJCQkJX2ZuRHJhdyggb1NldHRpbmdzICk7CgkJCX0KCQl9OwoJCQoJCQoJCS8qKgoJCSAqIFRoZSBleGFjdCBvcHBvc2l0ZSBvZiAnb3BlbmluZycgYSByb3csIHRoaXMgZnVuY3Rpb24gd2lsbCBjbG9zZSBhbnkgcm93cyB3aGljaCAKCQkgKiBhcmUgY3VycmVudGx5ICdvcGVuJy4KCQkgKiAgQHBhcmFtIHtub2RlfSBuVHIgdGhlIHRhYmxlIHJvdyB0byAnY2xvc2UnCgkJICogIEByZXR1cm5zIHtpbnR9IDAgb24gc3VjY2Vzcywgb3IgMSBpZiBmYWlsZWQgKGNhbid0IGZpbmQgdGhlIHJvdykKCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlOwoJCSAqICAgICAgCgkJICogICAgICAvLyAnb3BlbicgYW4gaW5mb3JtYXRpb24gcm93IHdoZW4gYSByb3cgaXMgY2xpY2tlZCBvbgoJCSAqICAgICAgJCgnI2V4YW1wbGUgdGJvZHkgdHInKS5jbGljayggZnVuY3Rpb24gKCkgewoJCSAqICAgICAgICBpZiAoIG9UYWJsZS5mbklzT3Blbih0aGlzKSApIHsKCQkgKiAgICAgICAgICBvVGFibGUuZm5DbG9zZSggdGhpcyApOwoJCSAqICAgICAgICB9IGVsc2UgewoJCSAqICAgICAgICAgIG9UYWJsZS5mbk9wZW4oIHRoaXMsICJUZW1wb3Jhcnkgcm93IG9wZW5lZCIsICJpbmZvX3JvdyIgKTsKCQkgKiAgICAgICAgfQoJCSAqICAgICAgfSApOwoJCSAqICAgICAgCgkJICogICAgICBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLmZuQ2xvc2UgPSBmdW5jdGlvbiggblRyICkKCQl7CgkJCS8qIEZpbmQgc2V0dGluZ3MgZnJvbSB0YWJsZSBub2RlICovCgkJCXZhciBvU2V0dGluZ3MgPSBfZm5TZXR0aW5nc0Zyb21Ob2RlKCB0aGlzW0RhdGFUYWJsZS5leHQuaUFwaUluZGV4XSApOwoJCQkKCQkJZm9yICggdmFyIGk9MCA7IGk8b1NldHRpbmdzLmFvT3BlblJvd3MubGVuZ3RoIDsgaSsrICkKCQkJewoJCQkJaWYgKCBvU2V0dGluZ3MuYW9PcGVuUm93c1tpXS5uUGFyZW50ID09IG5UciApCgkJCQl7CgkJCQkJdmFyIG5UclBhcmVudCA9IG9TZXR0aW5ncy5hb09wZW5Sb3dzW2ldLm5Uci5wYXJlbnROb2RlOwoJCQkJCWlmICggblRyUGFyZW50ICkKCQkJCQl7CgkJCQkJCS8qIFJlbW92ZSBpdCBpZiBpdCBpcyBjdXJyZW50bHkgb24gZGlzcGxheSAqLwoJCQkJCQluVHJQYXJlbnQucmVtb3ZlQ2hpbGQoIG9TZXR0aW5ncy5hb09wZW5Sb3dzW2ldLm5UciApOwoJCQkJCX0KCQkJCQlvU2V0dGluZ3MuYW9PcGVuUm93cy5zcGxpY2UoIGksIDEgKTsKCQkJCQlyZXR1cm4gMDsKCQkJCX0KCQkJfQoJCQlyZXR1cm4gMTsKCQl9OwoJCQoJCQoJCS8qKgoJCSAqIFJlbW92ZSBhIHJvdyBmb3IgdGhlIHRhYmxlCgkJICogIEBwYXJhbSB7bWl4ZWR9IG1UYXJnZXQgVGhlIGluZGV4IG9mIHRoZSByb3cgZnJvbSBhb0RhdGEgdG8gYmUgZGVsZXRlZCwgb3IKCQkgKiAgICB0aGUgVFIgZWxlbWVudCB5b3Ugd2FudCB0byBkZWxldGUKCQkgKiAgQHBhcmFtIHtmdW5jdGlvbnxudWxsfSBbZm5DYWxsQmFja10gQ2FsbGJhY2sgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHtib29sfSBbYlJlZHJhdz10cnVlXSBSZWRyYXcgdGhlIHRhYmxlIG9yIG5vdAoJCSAqICBAcmV0dXJucyB7YXJyYXl9IFRoZSByb3cgdGhhdCB3YXMgZGVsZXRlZAoJCSAqICBAZHRvcHQgQVBJCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqICAgICAgCgkJICogICAgICAvLyBJbW1lZGlhdGVseSByZW1vdmUgdGhlIGZpcnN0IHJvdwoJCSAqICAgICAgb1RhYmxlLmZuRGVsZXRlUm93KCAwICk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuZm5EZWxldGVSb3cgPSBmdW5jdGlvbiggbVRhcmdldCwgZm5DYWxsQmFjaywgYlJlZHJhdyApCgkJewoJCQkvKiBGaW5kIHNldHRpbmdzIGZyb20gdGFibGUgbm9kZSAqLwoJCQl2YXIgb1NldHRpbmdzID0gX2ZuU2V0dGluZ3NGcm9tTm9kZSggdGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0gKTsKCQkJdmFyIGksIGlMZW4sIGlBT0RhdGFJbmRleDsKCQkJCgkJCWlBT0RhdGFJbmRleCA9ICh0eXBlb2YgbVRhcmdldCA9PT0gJ29iamVjdCcpID8gCgkJCQlfZm5Ob2RlVG9EYXRhSW5kZXgob1NldHRpbmdzLCBtVGFyZ2V0KSA6IG1UYXJnZXQ7CgkJCQoJCQkvKiBSZXR1cm4gdGhlIGRhdGEgYXJyYXkgZnJvbSB0aGlzIHJvdyAqLwoJCQl2YXIgb0RhdGEgPSBvU2V0dGluZ3MuYW9EYXRhLnNwbGljZSggaUFPRGF0YUluZGV4LCAxICk7CgkJCgkJCS8qIFVwZGF0ZSB0aGUgX0RUX1Jvd0luZGV4IHBhcmFtZXRlciAqLwoJCQlmb3IgKCBpPTAsIGlMZW49b1NldHRpbmdzLmFvRGF0YS5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlpZiAoIG9TZXR0aW5ncy5hb0RhdGFbaV0ublRyICE9PSBudWxsICkKCQkJCXsKCQkJCQlvU2V0dGluZ3MuYW9EYXRhW2ldLm5Uci5fRFRfUm93SW5kZXggPSBpOwoJCQkJfQoJCQl9CgkJCQoJCQkvKiBSZW1vdmUgdGhlIHRhcmdldCByb3cgZnJvbSB0aGUgc2VhcmNoIGFycmF5ICovCgkJCXZhciBpRGlzcGxheUluZGV4ID0gJC5pbkFycmF5KCBpQU9EYXRhSW5kZXgsIG9TZXR0aW5ncy5haURpc3BsYXkgKTsKCQkJb1NldHRpbmdzLmFzRGF0YVNlYXJjaC5zcGxpY2UoIGlEaXNwbGF5SW5kZXgsIDEgKTsKCQkJCgkJCS8qIERlbGV0ZSBmcm9tIHRoZSBkaXNwbGF5IGFycmF5cyAqLwoJCQlfZm5EZWxldGVJbmRleCggb1NldHRpbmdzLmFpRGlzcGxheU1hc3RlciwgaUFPRGF0YUluZGV4ICk7CgkJCV9mbkRlbGV0ZUluZGV4KCBvU2V0dGluZ3MuYWlEaXNwbGF5LCBpQU9EYXRhSW5kZXggKTsKCQkJCgkJCS8qIElmIHRoZXJlIGlzIGEgdXNlciBjYWxsYmFjayBmdW5jdGlvbiAtIGNhbGwgaXQgKi8KCQkJaWYgKCB0eXBlb2YgZm5DYWxsQmFjayA9PT0gImZ1bmN0aW9uIiApCgkJCXsKCQkJCWZuQ2FsbEJhY2suY2FsbCggdGhpcywgb1NldHRpbmdzLCBvRGF0YSApOwoJCQl9CgkJCQoJCQkvKiBDaGVjayBmb3IgYW4gJ292ZXJmbG93JyB0aGV5IGNhc2UgZm9yIGRpc3BsYXlpbmcgdGhlIHRhYmxlICovCgkJCWlmICggb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ID49IG9TZXR0aW5ncy5mblJlY29yZHNEaXNwbGF5KCkgKQoJCQl7CgkJCQlvU2V0dGluZ3MuX2lEaXNwbGF5U3RhcnQgLT0gb1NldHRpbmdzLl9pRGlzcGxheUxlbmd0aDsKCQkJCWlmICggb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0IDwgMCApCgkJCQl7CgkJCQkJb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ID0gMDsKCQkJCX0KCQkJfQoJCQkKCQkJaWYgKCBiUmVkcmF3ID09PSB1bmRlZmluZWQgfHwgYlJlZHJhdyApCgkJCXsKCQkJCV9mbkNhbGN1bGF0ZUVuZCggb1NldHRpbmdzICk7CgkJCQlfZm5EcmF3KCBvU2V0dGluZ3MgKTsKCQkJfQoJCQkKCQkJcmV0dXJuIG9EYXRhOwoJCX07CgkJCgkJCgkJLyoqCgkJICogUmVzdG9yZSB0aGUgdGFibGUgdG8gaXQncyBvcmlnaW5hbCBzdGF0ZSBpbiB0aGUgRE9NIGJ5IHJlbW92aW5nIGFsbCBvZiBEYXRhVGFibGVzIAoJCSAqIGVuaGFuY2VtZW50cywgYWx0ZXJhdGlvbnMgdG8gdGhlIERPTSBzdHJ1Y3R1cmUgb2YgdGhlIHRhYmxlIGFuZCBldmVudCBsaXN0ZW5lcnMuCgkJICogIEBwYXJhbSB7Ym9vbGVhbn0gW2JSZW1vdmU9ZmFsc2VdIENvbXBsZXRlbHkgcmVtb3ZlIHRoZSB0YWJsZSBmcm9tIHRoZSBET00KCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAvLyBUaGlzIGV4YW1wbGUgaXMgZmFpcmx5IHBvaW50bGVzcyBpbiByZWFsaXR5LCBidXQgc2hvd3MgaG93IGZuRGVzdHJveSBjYW4gYmUgdXNlZAoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICogICAgICBvVGFibGUuZm5EZXN0cm95KCk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuZm5EZXN0cm95ID0gZnVuY3Rpb24gKCBiUmVtb3ZlICkKCQl7CgkJCXZhciBvU2V0dGluZ3MgPSBfZm5TZXR0aW5nc0Zyb21Ob2RlKCB0aGlzW0RhdGFUYWJsZS5leHQuaUFwaUluZGV4XSApOwoJCQl2YXIgbk9yaWcgPSBvU2V0dGluZ3MublRhYmxlV3JhcHBlci5wYXJlbnROb2RlOwoJCQl2YXIgbkJvZHkgPSBvU2V0dGluZ3MublRCb2R5OwoJCQl2YXIgaSwgaUxlbjsKCQkKCQkJYlJlbW92ZSA9IChiUmVtb3ZlPT09dW5kZWZpbmVkKSA/IGZhbHNlIDogdHJ1ZTsKCQkJCgkJCS8qIEZsYWcgdG8gbm90ZSB0aGF0IHRoZSB0YWJsZSBpcyBjdXJyZW50bHkgYmVpbmcgZGVzdHJveWVkIC0gbm8gYWN0aW9uIHNob3VsZCBiZSB0YWtlbiAqLwoJCQlvU2V0dGluZ3MuYkRlc3Ryb3lpbmcgPSB0cnVlOwoJCQkKCQkJLyogRmlyZSBvZmYgdGhlIGRlc3Ryb3kgY2FsbGJhY2tzIGZvciBwbHVnLWlucyBldGMgKi8KCQkJX2ZuQ2FsbGJhY2tGaXJlKCBvU2V0dGluZ3MsICJhb0Rlc3Ryb3lDYWxsYmFjayIsICJkZXN0cm95IiwgW29TZXR0aW5nc10gKTsKCQkJCgkJCS8qIFJlc3RvcmUgaGlkZGVuIGNvbHVtbnMgKi8KCQkJZm9yICggaT0wLCBpTGVuPW9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJaWYgKCBvU2V0dGluZ3MuYW9Db2x1bW5zW2ldLmJWaXNpYmxlID09PSBmYWxzZSApCgkJCQl7CgkJCQkJdGhpcy5mblNldENvbHVtblZpcyggaSwgdHJ1ZSApOwoJCQkJfQoJCQl9CgkJCQoJCQkvKiBCbGl0eiBhbGwgRFQgZXZlbnRzICovCgkJCSQob1NldHRpbmdzLm5UYWJsZVdyYXBwZXIpLmZpbmQoJyonKS5hbmRTZWxmKCkudW5iaW5kKCcuRFQnKTsKCQkJCgkJCS8qIElmIHRoZXJlIGlzIGFuICdlbXB0eScgaW5kaWNhdG9yIHJvdywgcmVtb3ZlIGl0ICovCgkJCSQoJ3Rib2R5PnRyPnRkLicrb1NldHRpbmdzLm9DbGFzc2VzLnNSb3dFbXB0eSwgb1NldHRpbmdzLm5UYWJsZSkucGFyZW50KCkucmVtb3ZlKCk7CgkJCQoJCQkvKiBXaGVuIHNjcm9sbGluZyB3ZSBoYWQgdG8gYnJlYWsgdGhlIHRhYmxlIHVwIC0gcmVzdG9yZSBpdCAqLwoJCQlpZiAoIG9TZXR0aW5ncy5uVGFibGUgIT0gb1NldHRpbmdzLm5USGVhZC5wYXJlbnROb2RlICkKCQkJewoJCQkJJChvU2V0dGluZ3MublRhYmxlKS5jaGlsZHJlbigndGhlYWQnKS5yZW1vdmUoKTsKCQkJCW9TZXR0aW5ncy5uVGFibGUuYXBwZW5kQ2hpbGQoIG9TZXR0aW5ncy5uVEhlYWQgKTsKCQkJfQoJCQkKCQkJaWYgKCBvU2V0dGluZ3MublRGb290ICYmIG9TZXR0aW5ncy5uVGFibGUgIT0gb1NldHRpbmdzLm5URm9vdC5wYXJlbnROb2RlICkKCQkJewoJCQkJJChvU2V0dGluZ3MublRhYmxlKS5jaGlsZHJlbigndGZvb3QnKS5yZW1vdmUoKTsKCQkJCW9TZXR0aW5ncy5uVGFibGUuYXBwZW5kQ2hpbGQoIG9TZXR0aW5ncy5uVEZvb3QgKTsKCQkJfQoJCQkKCQkJLyogUmVtb3ZlIHRoZSBEYXRhVGFibGVzIGdlbmVyYXRlZCBub2RlcywgZXZlbnRzIGFuZCBjbGFzc2VzICovCgkJCW9TZXR0aW5ncy5uVGFibGUucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCggb1NldHRpbmdzLm5UYWJsZSApOwoJCQkkKG9TZXR0aW5ncy5uVGFibGVXcmFwcGVyKS5yZW1vdmUoKTsKCQkJCgkJCW9TZXR0aW5ncy5hYVNvcnRpbmcgPSBbXTsKCQkJb1NldHRpbmdzLmFhU29ydGluZ0ZpeGVkID0gW107CgkJCV9mblNvcnRpbmdDbGFzc2VzKCBvU2V0dGluZ3MgKTsKCQkJCgkJCSQoX2ZuR2V0VHJOb2Rlcyggb1NldHRpbmdzICkpLnJlbW92ZUNsYXNzKCBvU2V0dGluZ3MuYXNTdHJpcGVDbGFzc2VzLmpvaW4oJyAnKSApOwoJCQkKCQkJJCgndGgsIHRkJywgb1NldHRpbmdzLm5USGVhZCkucmVtb3ZlQ2xhc3MoIFsKCQkJCW9TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydGFibGUsCgkJCQlvU2V0dGluZ3Mub0NsYXNzZXMuc1NvcnRhYmxlQXNjLAoJCQkJb1NldHRpbmdzLm9DbGFzc2VzLnNTb3J0YWJsZURlc2MsCgkJCQlvU2V0dGluZ3Mub0NsYXNzZXMuc1NvcnRhYmxlTm9uZSBdLmpvaW4oJyAnKQoJCQkpOwoJCQlpZiAoIG9TZXR0aW5ncy5iSlVJICkKCQkJewoJCQkJJCgndGggc3Bhbi4nK29TZXR0aW5ncy5vQ2xhc3Nlcy5zU29ydEljb24KCQkJCQkrICcsIHRkIHNwYW4uJytvU2V0dGluZ3Mub0NsYXNzZXMuc1NvcnRJY29uLCBvU2V0dGluZ3MublRIZWFkKS5yZW1vdmUoKTsKCQkKCQkJCSQoJ3RoLCB0ZCcsIG9TZXR0aW5ncy5uVEhlYWQpLmVhY2goIGZ1bmN0aW9uICgpIHsKCQkJCQl2YXIganFXcmFwcGVyID0gJCgnZGl2Licrb1NldHRpbmdzLm9DbGFzc2VzLnNTb3J0SlVJV3JhcHBlciwgdGhpcyk7CgkJCQkJdmFyIGtpZHMgPSBqcVdyYXBwZXIuY29udGVudHMoKTsKCQkJCQkkKHRoaXMpLmFwcGVuZCgga2lkcyApOwoJCQkJCWpxV3JhcHBlci5yZW1vdmUoKTsKCQkJCX0gKTsKCQkJfQoJCQkKCQkJLyogQWRkIHRoZSBUUiBlbGVtZW50cyBiYWNrIGludG8gdGhlIHRhYmxlIGluIHRoZWlyIG9yaWdpbmFsIG9yZGVyICovCgkJCWlmICggIWJSZW1vdmUgJiYgb1NldHRpbmdzLm5UYWJsZVJlaW5zZXJ0QmVmb3JlICkKCQkJewoJCQkJbk9yaWcuaW5zZXJ0QmVmb3JlKCBvU2V0dGluZ3MublRhYmxlLCBvU2V0dGluZ3MublRhYmxlUmVpbnNlcnRCZWZvcmUgKTsKCQkJfQoJCQllbHNlIGlmICggIWJSZW1vdmUgKQoJCQl7CgkJCQluT3JpZy5hcHBlbmRDaGlsZCggb1NldHRpbmdzLm5UYWJsZSApOwoJCQl9CgkJCgkJCWZvciAoIGk9MCwgaUxlbj1vU2V0dGluZ3MuYW9EYXRhLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWlmICggb1NldHRpbmdzLmFvRGF0YVtpXS5uVHIgIT09IG51bGwgKQoJCQkJewoJCQkJCW5Cb2R5LmFwcGVuZENoaWxkKCBvU2V0dGluZ3MuYW9EYXRhW2ldLm5UciApOwoJCQkJfQoJCQl9CgkJCQoJCQkvKiBSZXN0b3JlIHRoZSB3aWR0aCBvZiB0aGUgb3JpZ2luYWwgdGFibGUgKi8KCQkJaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJBdXRvV2lkdGggPT09IHRydWUgKQoJCQl7CgkJCSAgb1NldHRpbmdzLm5UYWJsZS5zdHlsZS53aWR0aCA9IF9mblN0cmluZ1RvQ3NzKG9TZXR0aW5ncy5zRGVzdHJveVdpZHRoKTsKCQkJfQoJCQkKCQkJLyogSWYgdGhlIHdlcmUgb3JpZ2luYWxseSBvZGQvZXZlbiB0eXBlIGNsYXNzZXMgLSB0aGVuIHdlIGFkZCB0aGVtIGJhY2sgaGVyZS4gTm90ZQoJCQkgKiB0aGlzIGlzIG5vdCBmb29sIHByb29mIChmb3IgZXhhbXBsZSBpZiBub3QgYWxsIHJvd3MgYXMgb2RkL2V2ZW4gY2xhc3NlcyAtIGJ1dCAKCQkJICogaXQncyBhIGdvb2QgZWZmb3J0IHdpdGhvdXQgZ2V0dGluZyBjYXJyaWVkIGF3YXkKCQkJICovCgkJCSQobkJvZHkpLmNoaWxkcmVuKCd0cjpldmVuJykuYWRkQ2xhc3MoIG9TZXR0aW5ncy5hc0Rlc3Ryb3lTdHJpcGVzWzBdICk7CgkJCSQobkJvZHkpLmNoaWxkcmVuKCd0cjpvZGQnKS5hZGRDbGFzcyggb1NldHRpbmdzLmFzRGVzdHJveVN0cmlwZXNbMV0gKTsKCQkJCgkJCS8qIFJlbW92ZSB0aGUgc2V0dGluZ3Mgb2JqZWN0IGZyb20gdGhlIHNldHRpbmdzIGFycmF5ICovCgkJCWZvciAoIGk9MCwgaUxlbj1EYXRhVGFibGUuc2V0dGluZ3MubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJaWYgKCBEYXRhVGFibGUuc2V0dGluZ3NbaV0gPT0gb1NldHRpbmdzICkKCQkJCXsKCQkJCQlEYXRhVGFibGUuc2V0dGluZ3Muc3BsaWNlKCBpLCAxICk7CgkJCQl9CgkJCX0KCQkJCgkJCS8qIEVuZCBpdCBhbGwgKi8KCQkJb1NldHRpbmdzID0gbnVsbDsKCQl9OwoJCQoJCQoJCS8qKgoJCSAqIFJlZHJhdyB0aGUgdGFibGUKCQkgKiAgQHBhcmFtIHtib29sfSBbYkNvbXBsZXRlPXRydWVdIFJlLWZpbHRlciBhbmQgcmVzb3J0IChpZiBlbmFibGVkKSB0aGUgdGFibGUgYmVmb3JlIHRoZSBkcmF3LgoJCSAqICBAZHRvcHQgQVBJCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqICAgICAgCgkJICogICAgICAvLyBSZS1kcmF3IHRoZSB0YWJsZSAtIHlvdSB3b3VsZG4ndCB3YW50IHRvIGRvIGl0IGhlcmUsIGJ1dCBpdCdzIGFuIGV4YW1wbGUgOi0pCgkJICogICAgICBvVGFibGUuZm5EcmF3KCk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuZm5EcmF3ID0gZnVuY3Rpb24oIGJDb21wbGV0ZSApCgkJewoJCQl2YXIgb1NldHRpbmdzID0gX2ZuU2V0dGluZ3NGcm9tTm9kZSggdGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0gKTsKCQkJaWYgKCBiQ29tcGxldGUgPT09IGZhbHNlICkKCQkJewoJCQkJX2ZuQ2FsY3VsYXRlRW5kKCBvU2V0dGluZ3MgKTsKCQkJCV9mbkRyYXcoIG9TZXR0aW5ncyApOwoJCQl9CgkJCWVsc2UKCQkJewoJCQkJX2ZuUmVEcmF3KCBvU2V0dGluZ3MgKTsKCQkJfQoJCX07CgkJCgkJCgkJLyoqCgkJICogRmlsdGVyIHRoZSBpbnB1dCBiYXNlZCBvbiBkYXRhCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzSW5wdXQgU3RyaW5nIHRvIGZpbHRlciB0aGUgdGFibGUgb24KCQkgKiAgQHBhcmFtIHtpbnR8bnVsbH0gW2lDb2x1bW5dIENvbHVtbiB0byBsaW1pdCBmaWx0ZXJpbmcgdG8KCQkgKiAgQHBhcmFtIHtib29sfSBbYlJlZ2V4PWZhbHNlXSBUcmVhdCBhcyByZWd1bGFyIGV4cHJlc3Npb24gb3Igbm90CgkJICogIEBwYXJhbSB7Ym9vbH0gW2JTbWFydD10cnVlXSBQZXJmb3JtIHNtYXJ0IGZpbHRlcmluZyBvciBub3QKCQkgKiAgQHBhcmFtIHtib29sfSBbYlNob3dHbG9iYWw9dHJ1ZV0gU2hvdyB0aGUgaW5wdXQgZ2xvYmFsIGZpbHRlciBpbiBpdCdzIGlucHV0IGJveChlcykKCQkgKiAgQHBhcmFtIHtib29sfSBbYkNhc2VJbnNlbnNpdGl2ZT10cnVlXSBEbyBjYXNlLWluc2Vuc2l0aXZlIG1hdGNoaW5nICh0cnVlKSBvciBub3QgKGZhbHNlKQoJCSAqICBAZHRvcHQgQVBJCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqICAgICAgCgkJICogICAgICAvLyBTb21ldGltZSBsYXRlciAtIGZpbHRlci4uLgoJCSAqICAgICAgb1RhYmxlLmZuRmlsdGVyKCAndGVzdCBzdHJpbmcnICk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuZm5GaWx0ZXIgPSBmdW5jdGlvbiggc0lucHV0LCBpQ29sdW1uLCBiUmVnZXgsIGJTbWFydCwgYlNob3dHbG9iYWwsIGJDYXNlSW5zZW5zaXRpdmUgKQoJCXsKCQkJdmFyIG9TZXR0aW5ncyA9IF9mblNldHRpbmdzRnJvbU5vZGUoIHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdICk7CgkJCQoJCQlpZiAoICFvU2V0dGluZ3Mub0ZlYXR1cmVzLmJGaWx0ZXIgKQoJCQl7CgkJCQlyZXR1cm47CgkJCX0KCQkJCgkJCWlmICggYlJlZ2V4ID09PSB1bmRlZmluZWQgfHwgYlJlZ2V4ID09PSBudWxsICkKCQkJewoJCQkJYlJlZ2V4ID0gZmFsc2U7CgkJCX0KCQkJCgkJCWlmICggYlNtYXJ0ID09PSB1bmRlZmluZWQgfHwgYlNtYXJ0ID09PSBudWxsICkKCQkJewoJCQkJYlNtYXJ0ID0gdHJ1ZTsKCQkJfQoJCQkKCQkJaWYgKCBiU2hvd0dsb2JhbCA9PT0gdW5kZWZpbmVkIHx8IGJTaG93R2xvYmFsID09PSBudWxsICkKCQkJewoJCQkJYlNob3dHbG9iYWwgPSB0cnVlOwoJCQl9CgkJCQoJCQlpZiAoIGJDYXNlSW5zZW5zaXRpdmUgPT09IHVuZGVmaW5lZCB8fCBiQ2FzZUluc2Vuc2l0aXZlID09PSBudWxsICkKCQkJewoJCQkJYkNhc2VJbnNlbnNpdGl2ZSA9IHRydWU7CgkJCX0KCQkJCgkJCWlmICggaUNvbHVtbiA9PT0gdW5kZWZpbmVkIHx8IGlDb2x1bW4gPT09IG51bGwgKQoJCQl7CgkJCQkvKiBHbG9iYWwgZmlsdGVyICovCgkJCQlfZm5GaWx0ZXJDb21wbGV0ZSggb1NldHRpbmdzLCB7CgkJCQkJInNTZWFyY2giOnNJbnB1dCsiIiwKCQkJCQkiYlJlZ2V4IjogYlJlZ2V4LAoJCQkJCSJiU21hcnQiOiBiU21hcnQsCgkJCQkJImJDYXNlSW5zZW5zaXRpdmUiOiBiQ2FzZUluc2Vuc2l0aXZlCgkJCQl9LCAxICk7CgkJCQkKCQkJCWlmICggYlNob3dHbG9iYWwgJiYgb1NldHRpbmdzLmFhbkZlYXR1cmVzLmYgKQoJCQkJewoJCQkJCXZhciBuID0gb1NldHRpbmdzLmFhbkZlYXR1cmVzLmY7CgkJCQkJZm9yICggdmFyIGk9MCwgaUxlbj1uLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQkJewoJCQkJCQkkKG5baV0uX0RUX0lucHV0KS52YWwoIHNJbnB1dCApOwoJCQkJCX0KCQkJCX0KCQkJfQoJCQllbHNlCgkJCXsKCQkJCS8qIFNpbmdsZSBjb2x1bW4gZmlsdGVyICovCgkJCQkkLmV4dGVuZCggb1NldHRpbmdzLmFvUHJlU2VhcmNoQ29sc1sgaUNvbHVtbiBdLCB7CgkJCQkJInNTZWFyY2giOiBzSW5wdXQrIiIsCgkJCQkJImJSZWdleCI6IGJSZWdleCwKCQkJCQkiYlNtYXJ0IjogYlNtYXJ0LAoJCQkJCSJiQ2FzZUluc2Vuc2l0aXZlIjogYkNhc2VJbnNlbnNpdGl2ZQoJCQkJfSApOwoJCQkJX2ZuRmlsdGVyQ29tcGxldGUoIG9TZXR0aW5ncywgb1NldHRpbmdzLm9QcmV2aW91c1NlYXJjaCwgMSApOwoJCQl9CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBHZXQgdGhlIGRhdGEgZm9yIHRoZSB3aG9sZSB0YWJsZSwgYW4gaW5kaXZpZHVhbCByb3cgb3IgYW4gaW5kaXZpZHVhbCBjZWxsIGJhc2VkIG9uIHRoZSAKCQkgKiBwcm92aWRlZCBwYXJhbWV0ZXJzLgoJCSAqICBAcGFyYW0ge2ludHxub2RlfSBbbVJvd10gQSBUUiByb3cgbm9kZSwgVEQvVEggY2VsbCBub2RlIG9yIGFuIGludGVnZXIuIElmIGdpdmVuIGFzCgkJICogICAgYSBUUiBub2RlIHRoZW4gdGhlIGRhdGEgc291cmNlIGZvciB0aGUgd2hvbGUgcm93IHdpbGwgYmUgcmV0dXJuZWQuIElmIGdpdmVuIGFzIGEKCQkgKiAgICBURC9USCBjZWxsIG5vZGUgdGhlbiBpQ29sIHdpbGwgYmUgYXV0b21hdGljYWxseSBjYWxjdWxhdGVkIGFuZCB0aGUgZGF0YSBmb3IgdGhlCgkJICogICAgY2VsbCByZXR1cm5lZC4gSWYgZ2l2ZW4gYXMgYW4gaW50ZWdlciwgdGhlbiB0aGlzIGlzIHRyZWF0ZWQgYXMgdGhlIGFvRGF0YSBpbnRlcm5hbAoJCSAqICAgIGRhdGEgaW5kZXggZm9yIHRoZSByb3cgKHNlZSBmbkdldFBvc2l0aW9uKSBhbmQgdGhlIGRhdGEgZm9yIHRoYXQgcm93IHVzZWQuCgkJICogIEBwYXJhbSB7aW50fSBbaUNvbF0gT3B0aW9uYWwgY29sdW1uIGluZGV4IHRoYXQgeW91IHdhbnQgdGhlIGRhdGEgb2YuCgkJICogIEByZXR1cm5zIHthcnJheXxvYmplY3R8c3RyaW5nfSBJZiBtUm93IGlzIHVuZGVmaW5lZCwgdGhlbiB0aGUgZGF0YSBmb3IgYWxsIHJvd3MgaXMKCQkgKiAgICByZXR1cm5lZC4gSWYgbVJvdyBpcyBkZWZpbmVkLCBqdXN0IGRhdGEgZm9yIHRoYXQgcm93LCBhbmQgaXMgaUNvbCBpcwoJCSAqICAgIGRlZmluZWQsIG9ubHkgZGF0YSBmb3IgdGhlIGRlc2lnbmF0ZWQgY2VsbCBpcyByZXR1cm5lZC4KCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gUm93IGRhdGEKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICoKCQkgKiAgICAgIG9UYWJsZS4kKCd0cicpLmNsaWNrKCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAgIHZhciBkYXRhID0gb1RhYmxlLmZuR2V0RGF0YSggdGhpcyApOwoJCSAqICAgICAgICAvLyAuLi4gZG8gc29tZXRoaW5nIHdpdGggdGhlIGFycmF5IC8gb2JqZWN0IG9mIGRhdGEgZm9yIHRoZSByb3cKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBJbmRpdmlkdWFsIGNlbGwgZGF0YQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKgoJCSAqICAgICAgb1RhYmxlLiQoJ3RkJykuY2xpY2soIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICAgdmFyIHNEYXRhID0gb1RhYmxlLmZuR2V0RGF0YSggdGhpcyApOwoJCSAqICAgICAgICBhbGVydCggJ1RoZSBjZWxsIGNsaWNrZWQgb24gaGFkIHRoZSB2YWx1ZSBvZiAnK3NEYXRhICk7CgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuZm5HZXREYXRhID0gZnVuY3Rpb24oIG1Sb3csIGlDb2wgKQoJCXsKCQkJdmFyIG9TZXR0aW5ncyA9IF9mblNldHRpbmdzRnJvbU5vZGUoIHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdICk7CgkJCQoJCQlpZiAoIG1Sb3cgIT09IHVuZGVmaW5lZCApCgkJCXsKCQkJCXZhciBpUm93ID0gbVJvdzsKCQkJCWlmICggdHlwZW9mIG1Sb3cgPT09ICdvYmplY3QnICkKCQkJCXsKCQkJCQl2YXIgc05vZGUgPSBtUm93Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7CgkJCQkJaWYgKHNOb2RlID09PSAidHIiICkKCQkJCQl7CgkJCQkJCWlSb3cgPSBfZm5Ob2RlVG9EYXRhSW5kZXgob1NldHRpbmdzLCBtUm93KTsKCQkJCQl9CgkJCQkJZWxzZSBpZiAoIHNOb2RlID09PSAidGQiICkKCQkJCQl7CgkJCQkJCWlSb3cgPSBfZm5Ob2RlVG9EYXRhSW5kZXgob1NldHRpbmdzLCBtUm93LnBhcmVudE5vZGUpOwoJCQkJCQlpQ29sID0gX2ZuTm9kZVRvQ29sdW1uSW5kZXgoIG9TZXR0aW5ncywgaVJvdywgbVJvdyApOwoJCQkJCX0KCQkJCX0KCQkKCQkJCWlmICggaUNvbCAhPT0gdW5kZWZpbmVkICkKCQkJCXsKCQkJCQlyZXR1cm4gX2ZuR2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaUNvbCwgJycgKTsKCQkJCX0KCQkJCXJldHVybiAob1NldHRpbmdzLmFvRGF0YVtpUm93XSE9PXVuZGVmaW5lZCkgPwoJCQkJCW9TZXR0aW5ncy5hb0RhdGFbaVJvd10uX2FEYXRhIDogbnVsbDsKCQkJfQoJCQlyZXR1cm4gX2ZuR2V0RGF0YU1hc3Rlciggb1NldHRpbmdzICk7CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBHZXQgYW4gYXJyYXkgb2YgdGhlIFRSIG5vZGVzIHRoYXQgYXJlIHVzZWQgaW4gdGhlIHRhYmxlJ3MgYm9keS4gTm90ZSB0aGF0IHlvdSB3aWxsIAoJCSAqIHR5cGljYWxseSB3YW50IHRvIHVzZSB0aGUgJyQnIEFQSSBtZXRob2QgaW4gcHJlZmVyZW5jZSB0byB0aGlzIGFzIGl0IGlzIG1vcmUgCgkJICogZmxleGlibGUuCgkJICogIEBwYXJhbSB7aW50fSBbaVJvd10gT3B0aW9uYWwgcm93IGluZGV4IGZvciB0aGUgVFIgZWxlbWVudCB5b3Ugd2FudAoJCSAqICBAcmV0dXJucyB7YXJyYXl8bm9kZX0gSWYgaVJvdyBpcyB1bmRlZmluZWQsIHJldHVybnMgYW4gYXJyYXkgb2YgYWxsIFRSIGVsZW1lbnRzCgkJICogICAgaW4gdGhlIHRhYmxlJ3MgYm9keSwgb3IgaVJvdyBpcyBkZWZpbmVkLCBqdXN0IHRoZSBUUiBlbGVtZW50IHJlcXVlc3RlZC4KCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICAgIAoJCSAqICAgICAgLy8gR2V0IHRoZSBub2RlcyBmcm9tIHRoZSB0YWJsZQoJCSAqICAgICAgdmFyIG5Ob2RlcyA9IG9UYWJsZS5mbkdldE5vZGVzKCApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLmZuR2V0Tm9kZXMgPSBmdW5jdGlvbiggaVJvdyApCgkJewoJCQl2YXIgb1NldHRpbmdzID0gX2ZuU2V0dGluZ3NGcm9tTm9kZSggdGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0gKTsKCQkJCgkJCWlmICggaVJvdyAhPT0gdW5kZWZpbmVkICkgewoJCQkJcmV0dXJuIChvU2V0dGluZ3MuYW9EYXRhW2lSb3ddIT09dW5kZWZpbmVkKSA/CgkJCQkJb1NldHRpbmdzLmFvRGF0YVtpUm93XS5uVHIgOiBudWxsOwoJCQl9CgkJCXJldHVybiBfZm5HZXRUck5vZGVzKCBvU2V0dGluZ3MgKTsKCQl9OwoJCQoJCQoJCS8qKgoJCSAqIEdldCB0aGUgYXJyYXkgaW5kZXhlcyBvZiBhIHBhcnRpY3VsYXIgY2VsbCBmcm9tIGl0J3MgRE9NIGVsZW1lbnQKCQkgKiBhbmQgY29sdW1uIGluZGV4IGluY2x1ZGluZyBoaWRkZW4gY29sdW1ucwoJCSAqICBAcGFyYW0ge25vZGV9IG5Ob2RlIHRoaXMgY2FuIGVpdGhlciBiZSBhIFRSLCBURCBvciBUSCBpbiB0aGUgdGFibGUncyBib2R5CgkJICogIEByZXR1cm5zIHtpbnR9IElmIG5Ob2RlIGlzIGdpdmVuIGFzIGEgVFIsIHRoZW4gYSBzaW5nbGUgaW5kZXggaXMgcmV0dXJuZWQsIG9yCgkJICogICAgaWYgZ2l2ZW4gYXMgYSBjZWxsLCBhbiBhcnJheSBvZiBbcm93IGluZGV4LCBjb2x1bW4gaW5kZXggKHZpc2libGUpXSBpcyBnaXZlbi4KCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZSB0Ym9keSB0ZCcpLmNsaWNrKCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAgIC8vIEdldCB0aGUgcG9zaXRpb24gb2YgdGhlIGN1cnJlbnQgZGF0YSBmcm9tIHRoZSBub2RlCgkJICogICAgICAgIHZhciBhUG9zID0gb1RhYmxlLmZuR2V0UG9zaXRpb24oIHRoaXMgKTsKCQkgKiAgICAgICAgCgkJICogICAgICAgIC8vIEdldCB0aGUgZGF0YSBhcnJheSBmb3IgdGhpcyByb3cKCQkgKiAgICAgICAgdmFyIGFEYXRhID0gb1RhYmxlLmZuR2V0RGF0YSggYVBvc1swXSApOwoJCSAqICAgICAgICAKCQkgKiAgICAgICAgLy8gVXBkYXRlIHRoZSBkYXRhIGFycmF5IGFuZCByZXR1cm4gdGhlIHZhbHVlCgkJICogICAgICAgIGFEYXRhWyBhUG9zWzFdIF0gPSAnY2xpY2tlZCc7CgkJICogICAgICAgIHRoaXMuaW5uZXJIVE1MID0gJ2NsaWNrZWQnOwoJCSAqICAgICAgfSApOwoJCSAqICAgICAgCgkJICogICAgICAvLyBJbml0IERhdGFUYWJsZXMKCQkgKiAgICAgIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuZm5HZXRQb3NpdGlvbiA9IGZ1bmN0aW9uKCBuTm9kZSApCgkJewoJCQl2YXIgb1NldHRpbmdzID0gX2ZuU2V0dGluZ3NGcm9tTm9kZSggdGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0gKTsKCQkJdmFyIHNOb2RlTmFtZSA9IG5Ob2RlLm5vZGVOYW1lLnRvVXBwZXJDYXNlKCk7CgkJCQoJCQlpZiAoIHNOb2RlTmFtZSA9PSAiVFIiICkKCQkJewoJCQkJcmV0dXJuIF9mbk5vZGVUb0RhdGFJbmRleChvU2V0dGluZ3MsIG5Ob2RlKTsKCQkJfQoJCQllbHNlIGlmICggc05vZGVOYW1lID09ICJURCIgfHwgc05vZGVOYW1lID09ICJUSCIgKQoJCQl7CgkJCQl2YXIgaURhdGFJbmRleCA9IF9mbk5vZGVUb0RhdGFJbmRleCggb1NldHRpbmdzLCBuTm9kZS5wYXJlbnROb2RlICk7CgkJCQl2YXIgaUNvbHVtbkluZGV4ID0gX2ZuTm9kZVRvQ29sdW1uSW5kZXgoIG9TZXR0aW5ncywgaURhdGFJbmRleCwgbk5vZGUgKTsKCQkJCXJldHVybiBbIGlEYXRhSW5kZXgsIF9mbkNvbHVtbkluZGV4VG9WaXNpYmxlKG9TZXR0aW5ncywgaUNvbHVtbkluZGV4ICksIGlDb2x1bW5JbmRleCBdOwoJCQl9CgkJCXJldHVybiBudWxsOwoJCX07CgkJCgkJCgkJLyoqCgkJICogQ2hlY2sgdG8gc2VlIGlmIGEgcm93IGlzICdvcGVuJyBvciBub3QuCgkJICogIEBwYXJhbSB7bm9kZX0gblRyIHRoZSB0YWJsZSByb3cgdG8gY2hlY2sKCQkgKiAgQHJldHVybnMge2Jvb2xlYW59IHRydWUgaWYgdGhlIHJvdyBpcyBjdXJyZW50bHkgb3BlbiwgZmFsc2Ugb3RoZXJ3aXNlCgkJICogIEBkdG9wdCBBUEkKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZTsKCQkgKiAgICAgIAoJCSAqICAgICAgLy8gJ29wZW4nIGFuIGluZm9ybWF0aW9uIHJvdyB3aGVuIGEgcm93IGlzIGNsaWNrZWQgb24KCQkgKiAgICAgICQoJyNleGFtcGxlIHRib2R5IHRyJykuY2xpY2soIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICAgaWYgKCBvVGFibGUuZm5Jc09wZW4odGhpcykgKSB7CgkJICogICAgICAgICAgb1RhYmxlLmZuQ2xvc2UoIHRoaXMgKTsKCQkgKiAgICAgICAgfSBlbHNlIHsKCQkgKiAgICAgICAgICBvVGFibGUuZm5PcGVuKCB0aGlzLCAiVGVtcG9yYXJ5IHJvdyBvcGVuZWQiLCAiaW5mb19yb3ciICk7CgkJICogICAgICAgIH0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICAgIAoJCSAqICAgICAgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICB9ICk7CgkJICovCgkJdGhpcy5mbklzT3BlbiA9IGZ1bmN0aW9uKCBuVHIgKQoJCXsKCQkJdmFyIG9TZXR0aW5ncyA9IF9mblNldHRpbmdzRnJvbU5vZGUoIHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdICk7CgkJCXZhciBhb09wZW5Sb3dzID0gb1NldHRpbmdzLmFvT3BlblJvd3M7CgkJCQoJCQlmb3IgKCB2YXIgaT0wIDsgaTxvU2V0dGluZ3MuYW9PcGVuUm93cy5sZW5ndGggOyBpKysgKQoJCQl7CgkJCQlpZiAoIG9TZXR0aW5ncy5hb09wZW5Sb3dzW2ldLm5QYXJlbnQgPT0gblRyICkKCQkJCXsKCQkJCQlyZXR1cm4gdHJ1ZTsKCQkJCX0KCQkJfQoJCQlyZXR1cm4gZmFsc2U7CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBUaGlzIGZ1bmN0aW9uIHdpbGwgcGxhY2UgYSBuZXcgcm93IGRpcmVjdGx5IGFmdGVyIGEgcm93IHdoaWNoIGlzIGN1cnJlbnRseSAKCQkgKiBvbiBkaXNwbGF5IG9uIHRoZSBwYWdlLCB3aXRoIHRoZSBIVE1MIGNvbnRlbnRzIHRoYXQgaXMgcGFzc2VkIGludG8gdGhlIAoJCSAqIGZ1bmN0aW9uLiBUaGlzIGNhbiBiZSB1c2VkLCBmb3IgZXhhbXBsZSwgdG8gYXNrIGZvciBjb25maXJtYXRpb24gdGhhdCBhIAoJCSAqIHBhcnRpY3VsYXIgcmVjb3JkIHNob3VsZCBiZSBkZWxldGVkLgoJCSAqICBAcGFyYW0ge25vZGV9IG5UciBUaGUgdGFibGUgcm93IHRvICdvcGVuJwoJCSAqICBAcGFyYW0ge3N0cmluZ3xub2RlfGpRdWVyeX0gbUh0bWwgVGhlIEhUTUwgdG8gcHV0IGludG8gdGhlIHJvdwoJCSAqICBAcGFyYW0ge3N0cmluZ30gc0NsYXNzIENsYXNzIHRvIGdpdmUgdGhlIG5ldyBURCBjZWxsCgkJICogIEByZXR1cm5zIHtub2RlfSBUaGUgcm93IG9wZW5lZC4gTm90ZSB0aGF0IGlmIHRoZSB0YWJsZSByb3cgcGFzc2VkIGluIGFzIHRoZQoJCSAqICAgIGZpcnN0IHBhcmFtZXRlciwgaXMgbm90IGZvdW5kIGluIHRoZSB0YWJsZSwgdGhpcyBtZXRob2Qgd2lsbCBzaWxlbnRseQoJCSAqICAgIHJldHVybi4KCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlOwoJCSAqICAgICAgCgkJICogICAgICAvLyAnb3BlbicgYW4gaW5mb3JtYXRpb24gcm93IHdoZW4gYSByb3cgaXMgY2xpY2tlZCBvbgoJCSAqICAgICAgJCgnI2V4YW1wbGUgdGJvZHkgdHInKS5jbGljayggZnVuY3Rpb24gKCkgewoJCSAqICAgICAgICBpZiAoIG9UYWJsZS5mbklzT3Blbih0aGlzKSApIHsKCQkgKiAgICAgICAgICBvVGFibGUuZm5DbG9zZSggdGhpcyApOwoJCSAqICAgICAgICB9IGVsc2UgewoJCSAqICAgICAgICAgIG9UYWJsZS5mbk9wZW4oIHRoaXMsICJUZW1wb3Jhcnkgcm93IG9wZW5lZCIsICJpbmZvX3JvdyIgKTsKCQkgKiAgICAgICAgfQoJCSAqICAgICAgfSApOwoJCSAqICAgICAgCgkJICogICAgICBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLmZuT3BlbiA9IGZ1bmN0aW9uKCBuVHIsIG1IdG1sLCBzQ2xhc3MgKQoJCXsKCQkJLyogRmluZCBzZXR0aW5ncyBmcm9tIHRhYmxlIG5vZGUgKi8KCQkJdmFyIG9TZXR0aW5ncyA9IF9mblNldHRpbmdzRnJvbU5vZGUoIHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdICk7CgkJCgkJCS8qIENoZWNrIHRoYXQgdGhlIHJvdyBnaXZlbiBpcyBpbiB0aGUgdGFibGUgKi8KCQkJdmFyIG5UYWJsZVJvd3MgPSBfZm5HZXRUck5vZGVzKCBvU2V0dGluZ3MgKTsKCQkJaWYgKCAkLmluQXJyYXkoblRyLCBuVGFibGVSb3dzKSA9PT0gLTEgKQoJCQl7CgkJCQlyZXR1cm47CgkJCX0KCQkJCgkJCS8qIHRoZSBvbGQgb3BlbiBvbmUgaWYgdGhlcmUgaXMgb25lICovCgkJCXRoaXMuZm5DbG9zZSggblRyICk7CgkJCQoJCQl2YXIgbk5ld1JvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRyIik7CgkJCXZhciBuTmV3Q2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRkIik7CgkJCW5OZXdSb3cuYXBwZW5kQ2hpbGQoIG5OZXdDZWxsICk7CgkJCW5OZXdDZWxsLmNsYXNzTmFtZSA9IHNDbGFzczsKCQkJbk5ld0NlbGwuY29sU3BhbiA9IF9mblZpc2JsZUNvbHVtbnMoIG9TZXR0aW5ncyApOwoJCQoJCQlpZiAodHlwZW9mIG1IdG1sID09PSAic3RyaW5nIikKCQkJewoJCQkJbk5ld0NlbGwuaW5uZXJIVE1MID0gbUh0bWw7CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQkkKG5OZXdDZWxsKS5odG1sKCBtSHRtbCApOwoJCQl9CgkJCgkJCS8qIElmIHRoZSBuVHIgaXNuJ3Qgb24gdGhlIHBhZ2UgYXQgdGhlIG1vbWVudCAtIHRoZW4gd2UgZG9uJ3QgaW5zZXJ0IGF0IHRoZSBtb21lbnQgKi8KCQkJdmFyIG5UcnMgPSAkKCd0cicsIG9TZXR0aW5ncy5uVEJvZHkpOwoJCQlpZiAoICQuaW5BcnJheShuVHIsIG5UcnMpICE9IC0xICApCgkJCXsKCQkJCSQobk5ld1JvdykuaW5zZXJ0QWZ0ZXIoblRyKTsKCQkJfQoJCQkKCQkJb1NldHRpbmdzLmFvT3BlblJvd3MucHVzaCggewoJCQkJIm5UciI6IG5OZXdSb3csCgkJCQkiblBhcmVudCI6IG5UcgoJCQl9ICk7CgkJCQoJCQlyZXR1cm4gbk5ld1JvdzsKCQl9OwoJCQoJCQoJCS8qKgoJCSAqIENoYW5nZSB0aGUgcGFnaW5hdGlvbiAtIHByb3ZpZGVzIHRoZSBpbnRlcm5hbCBsb2dpYyBmb3IgcGFnaW5hdGlvbiBpbiBhIHNpbXBsZSBBUEkgCgkJICogZnVuY3Rpb24uIFdpdGggdGhpcyBmdW5jdGlvbiB5b3UgY2FuIGhhdmUgYSBEYXRhVGFibGVzIHRhYmxlIGdvIHRvIHRoZSBuZXh0LCAKCQkgKiBwcmV2aW91cywgZmlyc3Qgb3IgbGFzdCBwYWdlcy4KCQkgKiAgQHBhcmFtIHtzdHJpbmd8aW50fSBtQWN0aW9uIFBhZ2luZyBhY3Rpb24gdG8gdGFrZTogImZpcnN0IiwgInByZXZpb3VzIiwgIm5leHQiIG9yICJsYXN0IgoJCSAqICAgIG9yIHBhZ2UgbnVtYmVyIHRvIGp1bXAgdG8gKGludGVnZXIpLCBub3RlIHRoYXQgcGFnZSAwIGlzIHRoZSBmaXJzdCBwYWdlLgoJCSAqICBAcGFyYW0ge2Jvb2x9IFtiUmVkcmF3PXRydWVdIFJlZHJhdyB0aGUgdGFibGUgb3Igbm90CgkJICogIEBkdG9wdCBBUEkKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICogICAgICBvVGFibGUuZm5QYWdlQ2hhbmdlKCAnbmV4dCcgKTsKCQkgKiAgICB9ICk7CgkJICovCgkJdGhpcy5mblBhZ2VDaGFuZ2UgPSBmdW5jdGlvbiAoIG1BY3Rpb24sIGJSZWRyYXcgKQoJCXsKCQkJdmFyIG9TZXR0aW5ncyA9IF9mblNldHRpbmdzRnJvbU5vZGUoIHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdICk7CgkJCV9mblBhZ2VDaGFuZ2UoIG9TZXR0aW5ncywgbUFjdGlvbiApOwoJCQlfZm5DYWxjdWxhdGVFbmQoIG9TZXR0aW5ncyApOwoJCQkKCQkJaWYgKCBiUmVkcmF3ID09PSB1bmRlZmluZWQgfHwgYlJlZHJhdyApCgkJCXsKCQkJCV9mbkRyYXcoIG9TZXR0aW5ncyApOwoJCQl9CgkJfTsKCQkKCQkKCQkvKioKCQkgKiBTaG93IGEgcGFydGljdWxhciBjb2x1bW4KCQkgKiAgQHBhcmFtIHtpbnR9IGlDb2wgVGhlIGNvbHVtbiB3aG9zZSBkaXNwbGF5IHNob3VsZCBiZSBjaGFuZ2VkCgkJICogIEBwYXJhbSB7Ym9vbH0gYlNob3cgU2hvdyAodHJ1ZSkgb3IgaGlkZSAoZmFsc2UpIHRoZSBjb2x1bW4KCQkgKiAgQHBhcmFtIHtib29sfSBbYlJlZHJhdz10cnVlXSBSZWRyYXcgdGhlIHRhYmxlIG9yIG5vdAoJCSAqICBAZHRvcHQgQVBJCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqICAgICAgCgkJICogICAgICAvLyBIaWRlIHRoZSBzZWNvbmQgY29sdW1uIGFmdGVyIGluaXRpYWxpc2F0aW9uCgkJICogICAgICBvVGFibGUuZm5TZXRDb2x1bW5WaXMoIDEsIGZhbHNlICk7CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuZm5TZXRDb2x1bW5WaXMgPSBmdW5jdGlvbiAoIGlDb2wsIGJTaG93LCBiUmVkcmF3ICkKCQl7CgkJCXZhciBvU2V0dGluZ3MgPSBfZm5TZXR0aW5nc0Zyb21Ob2RlKCB0aGlzW0RhdGFUYWJsZS5leHQuaUFwaUluZGV4XSApOwoJCQl2YXIgaSwgaUxlbjsKCQkJdmFyIGFvQ29sdW1ucyA9IG9TZXR0aW5ncy5hb0NvbHVtbnM7CgkJCXZhciBhb0RhdGEgPSBvU2V0dGluZ3MuYW9EYXRhOwoJCQl2YXIgblRkLCBiQXBwZW5kLCBpQmVmb3JlOwoJCQkKCQkJLyogTm8gcG9pbnQgaW4gZG9pbmcgYW55dGhpbmcgaWYgd2UgYXJlIHJlcXVlc3Rpbmcgd2hhdCBpcyBhbHJlYWR5IHRydWUgKi8KCQkJaWYgKCBhb0NvbHVtbnNbaUNvbF0uYlZpc2libGUgPT0gYlNob3cgKQoJCQl7CgkJCQlyZXR1cm47CgkJCX0KCQkJCgkJCS8qIFNob3cgdGhlIGNvbHVtbiAqLwoJCQlpZiAoIGJTaG93ICkKCQkJewoJCQkJdmFyIGlJbnNlcnQgPSAwOwoJCQkJZm9yICggaT0wIDsgaTxpQ29sIDsgaSsrICkKCQkJCXsKCQkJCQlpZiAoIGFvQ29sdW1uc1tpXS5iVmlzaWJsZSApCgkJCQkJewoJCQkJCQlpSW5zZXJ0Kys7CgkJCQkJfQoJCQkJfQoJCQkJCgkJCQkvKiBOZWVkIHRvIGRlY2lkZSBpZiB3ZSBzaG91bGQgdXNlIGFwcGVuZENoaWxkIG9yIGluc2VydEJlZm9yZSAqLwoJCQkJYkFwcGVuZCA9IChpSW5zZXJ0ID49IF9mblZpc2JsZUNvbHVtbnMoIG9TZXR0aW5ncyApKTsKCQkKCQkJCS8qIFdoaWNoIGNvbG91bW4gc2hvdWxkIHdlIGJlIGluc2VydGluZyBiZWZvcmU/ICovCgkJCQlpZiAoICFiQXBwZW5kICkKCQkJCXsKCQkJCQlmb3IgKCBpPWlDb2wgOyBpPGFvQ29sdW1ucy5sZW5ndGggOyBpKysgKQoJCQkJCXsKCQkJCQkJaWYgKCBhb0NvbHVtbnNbaV0uYlZpc2libGUgKQoJCQkJCQl7CgkJCQkJCQlpQmVmb3JlID0gaTsKCQkJCQkJCWJyZWFrOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQoJCQkJZm9yICggaT0wLCBpTGVuPWFvRGF0YS5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQkJewoJCQkJCWlmICggYW9EYXRhW2ldLm5UciAhPT0gbnVsbCApCgkJCQkJewoJCQkJCQlpZiAoIGJBcHBlbmQgKQoJCQkJCQl7CgkJCQkJCQlhb0RhdGFbaV0ublRyLmFwcGVuZENoaWxkKCAKCQkJCQkJCQlhb0RhdGFbaV0uX2FuSGlkZGVuW2lDb2xdCgkJCQkJCQkpOwoJCQkJCQl9CgkJCQkJCWVsc2UKCQkJCQkJewoJCQkJCQkJYW9EYXRhW2ldLm5Uci5pbnNlcnRCZWZvcmUoCgkJCQkJCQkJYW9EYXRhW2ldLl9hbkhpZGRlbltpQ29sXSwgCgkJCQkJCQkJX2ZuR2V0VGROb2Rlcyggb1NldHRpbmdzLCBpIClbaUJlZm9yZV0gKTsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJfQoJCQllbHNlCgkJCXsKCQkJCS8qIFJlbW92ZSBhIGNvbHVtbiBmcm9tIGRpc3BsYXkgKi8KCQkJCWZvciAoIGk9MCwgaUxlbj1hb0RhdGEubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQlpZiAoIGFvRGF0YVtpXS5uVHIgIT09IG51bGwgKQoJCQkJCXsKCQkJCQkJblRkID0gX2ZuR2V0VGROb2Rlcyggb1NldHRpbmdzLCBpIClbaUNvbF07CgkJCQkJCWFvRGF0YVtpXS5fYW5IaWRkZW5baUNvbF0gPSBuVGQ7CgkJCQkJCW5UZC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKCBuVGQgKTsKCQkJCQl9CgkJCQl9CgkJCX0KCQkKCQkJLyogQ2xlYXIgdG8gc2V0IHRoZSB2aXNpYmxlIGZsYWcgKi8KCQkJYW9Db2x1bW5zW2lDb2xdLmJWaXNpYmxlID0gYlNob3c7CgkJCgkJCS8qIFJlZHJhdyB0aGUgaGVhZGVyIGFuZCBmb290ZXIgYmFzZWQgb24gdGhlIG5ldyBjb2x1bW4gdmlzaWJpbGl0eSAqLwoJCQlfZm5EcmF3SGVhZCggb1NldHRpbmdzLCBvU2V0dGluZ3MuYW9IZWFkZXIgKTsKCQkJaWYgKCBvU2V0dGluZ3MublRGb290ICkKCQkJewoJCQkJX2ZuRHJhd0hlYWQoIG9TZXR0aW5ncywgb1NldHRpbmdzLmFvRm9vdGVyICk7CgkJCX0KCQkJCgkJCS8qIElmIHRoZXJlIGFyZSBhbnkgJ29wZW4nIHJvd3MsIHRoZW4gd2UgbmVlZCB0byBhbHRlciB0aGUgY29sc3BhbiBmb3IgdGhpcyBjb2wgY2hhbmdlICovCgkJCWZvciAoIGk9MCwgaUxlbj1vU2V0dGluZ3MuYW9PcGVuUm93cy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlvU2V0dGluZ3MuYW9PcGVuUm93c1tpXS5uVHIuY29sU3BhbiA9IF9mblZpc2JsZUNvbHVtbnMoIG9TZXR0aW5ncyApOwoJCQl9CgkJCQoJCQkvKiBEbyBhIHJlZHJhdyBpbmNhc2UgYW55dGhpbmcgZGVwZW5kaW5nIG9uIHRoZSB0YWJsZSBjb2x1bW5zIG5lZWRzIGl0IAoJCQkgKiAoYnVpbHQtaW46IHNjcm9sbGluZykgCgkJCSAqLwoJCQlpZiAoIGJSZWRyYXcgPT09IHVuZGVmaW5lZCB8fCBiUmVkcmF3ICkKCQkJewoJCQkJX2ZuQWRqdXN0Q29sdW1uU2l6aW5nKCBvU2V0dGluZ3MgKTsKCQkJCV9mbkRyYXcoIG9TZXR0aW5ncyApOwoJCQl9CgkJCQoJCQlfZm5TYXZlU3RhdGUoIG9TZXR0aW5ncyApOwoJCX07CgkJCgkJCgkJLyoqCgkJICogR2V0IHRoZSBzZXR0aW5ncyBmb3IgYSBwYXJ0aWN1bGFyIHRhYmxlIGZvciBleHRlcm5hbCBtYW5pcHVsYXRpb24KCQkgKiAgQHJldHVybnMge29iamVjdH0gRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QuIFNlZSAKCQkgKiAgICB7QGxpbmsgRGF0YVRhYmxlLm1vZGVscy5vU2V0dGluZ3N9CgkJICogIEBkdG9wdCBBUEkKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICogICAgICB2YXIgb1NldHRpbmdzID0gb1RhYmxlLmZuU2V0dGluZ3MoKTsKCQkgKiAgICAgIAoJCSAqICAgICAgLy8gU2hvdyBhbiBleGFtcGxlIHBhcmFtZXRlciBmcm9tIHRoZSBzZXR0aW5ncwoJCSAqICAgICAgYWxlcnQoIG9TZXR0aW5ncy5faURpc3BsYXlTdGFydCApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLmZuU2V0dGluZ3MgPSBmdW5jdGlvbigpCgkJewoJCQlyZXR1cm4gX2ZuU2V0dGluZ3NGcm9tTm9kZSggdGhpc1tEYXRhVGFibGUuZXh0LmlBcGlJbmRleF0gKTsKCQl9OwoJCQoJCQoJCS8qKgoJCSAqIFNvcnQgdGhlIHRhYmxlIGJ5IGEgcGFydGljdWxhciBjb2x1bW4KCQkgKiAgQHBhcmFtIHtpbnR9IGlDb2wgdGhlIGRhdGEgaW5kZXggdG8gc29ydCBvbi4gTm90ZSB0aGF0IHRoaXMgd2lsbCBub3QgbWF0Y2ggdGhlIAoJCSAqICAgICdkaXNwbGF5IGluZGV4JyBpZiB5b3UgaGF2ZSBoaWRkZW4gZGF0YSBlbnRyaWVzCgkJICogIEBkdG9wdCBBUEkKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICogICAgICAKCQkgKiAgICAgIC8vIFNvcnQgaW1tZWRpYXRlbHkgd2l0aCBjb2x1bW5zIDAgYW5kIDEKCQkgKiAgICAgIG9UYWJsZS5mblNvcnQoIFsgWzAsJ2FzYyddLCBbMSwnYXNjJ10gXSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLmZuU29ydCA9IGZ1bmN0aW9uKCBhYVNvcnQgKQoJCXsKCQkJdmFyIG9TZXR0aW5ncyA9IF9mblNldHRpbmdzRnJvbU5vZGUoIHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdICk7CgkJCW9TZXR0aW5ncy5hYVNvcnRpbmcgPSBhYVNvcnQ7CgkJCV9mblNvcnQoIG9TZXR0aW5ncyApOwoJCX07CgkJCgkJCgkJLyoqCgkJICogQXR0YWNoIGEgc29ydCBsaXN0ZW5lciB0byBhbiBlbGVtZW50IGZvciBhIGdpdmVuIGNvbHVtbgoJCSAqICBAcGFyYW0ge25vZGV9IG5Ob2RlIHRoZSBlbGVtZW50IHRvIGF0dGFjaCB0aGUgc29ydCBsaXN0ZW5lciB0bwoJCSAqICBAcGFyYW0ge2ludH0gaUNvbHVtbiB0aGUgY29sdW1uIHRoYXQgYSBjbGljayBvbiB0aGlzIG5vZGUgd2lsbCBzb3J0IG9uCgkJICogIEBwYXJhbSB7ZnVuY3Rpb259IFtmbkNhbGxiYWNrXSBjYWxsYmFjayBmdW5jdGlvbiB3aGVuIHNvcnQgaXMgcnVuCgkJICogIEBkdG9wdCBBUEkKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICogICAgICAKCQkgKiAgICAgIC8vIFNvcnQgb24gY29sdW1uIDEsIHdoZW4gJ3NvcnRlcicgaXMgY2xpY2tlZCBvbgoJCSAqICAgICAgb1RhYmxlLmZuU29ydExpc3RlbmVyKCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc29ydGVyJyksIDEgKTsKCQkgKiAgICB9ICk7CgkJICovCgkJdGhpcy5mblNvcnRMaXN0ZW5lciA9IGZ1bmN0aW9uKCBuTm9kZSwgaUNvbHVtbiwgZm5DYWxsYmFjayApCgkJewoJCQlfZm5Tb3J0QXR0YWNoTGlzdGVuZXIoIF9mblNldHRpbmdzRnJvbU5vZGUoIHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdICksIG5Ob2RlLCBpQ29sdW1uLAoJCQkgCWZuQ2FsbGJhY2sgKTsKCQl9OwoJCQoJCQoJCS8qKgoJCSAqIFVwZGF0ZSBhIHRhYmxlIGNlbGwgb3Igcm93IC0gdGhpcyBtZXRob2Qgd2lsbCBhY2NlcHQgZWl0aGVyIGEgc2luZ2xlIHZhbHVlIHRvCgkJICogdXBkYXRlIHRoZSBjZWxsIHdpdGgsIGFuIGFycmF5IG9mIHZhbHVlcyB3aXRoIG9uZSBlbGVtZW50IGZvciBlYWNoIGNvbHVtbiBvcgoJCSAqIGFuIG9iamVjdCBpbiB0aGUgc2FtZSBmb3JtYXQgYXMgdGhlIG9yaWdpbmFsIGRhdGEgc291cmNlLiBUaGUgZnVuY3Rpb24gaXMKCQkgKiBzZWxmLXJlZmVyZW5jaW5nIGluIG9yZGVyIHRvIG1ha2UgdGhlIG11bHRpIGNvbHVtbiB1cGRhdGVzIGVhc2llci4KCQkgKiAgQHBhcmFtIHtvYmplY3R8YXJyYXl8c3RyaW5nfSBtRGF0YSBEYXRhIHRvIHVwZGF0ZSB0aGUgY2VsbC9yb3cgd2l0aAoJCSAqICBAcGFyYW0ge25vZGV8aW50fSBtUm93IFRSIGVsZW1lbnQgeW91IHdhbnQgdG8gdXBkYXRlIG9yIHRoZSBhb0RhdGEgaW5kZXgKCQkgKiAgQHBhcmFtIHtpbnR9IFtpQ29sdW1uXSBUaGUgY29sdW1uIHRvIHVwZGF0ZSAobm90IHVzZWQgb2YgbURhdGEgaXMgYW4gYXJyYXkgb3Igb2JqZWN0KQoJCSAqICBAcGFyYW0ge2Jvb2x9IFtiUmVkcmF3PXRydWVdIFJlZHJhdyB0aGUgdGFibGUgb3Igbm90CgkJICogIEBwYXJhbSB7Ym9vbH0gW2JBY3Rpb249dHJ1ZV0gUGVyZm9ybSBwcmVkcmF3IGFjdGlvbnMgb3Igbm90CgkJICogIEByZXR1cm5zIHtpbnR9IDAgb24gc3VjY2VzcywgMSBvbiBlcnJvcgoJCSAqICBAZHRvcHQgQVBJCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSgpOwoJCSAqICAgICAgb1RhYmxlLmZuVXBkYXRlKCAnRXhhbXBsZSB1cGRhdGUnLCAwLCAwICk7IC8vIFNpbmdsZSBjZWxsCgkJICogICAgICBvVGFibGUuZm5VcGRhdGUoIFsnYScsICdiJywgJ2MnLCAnZCcsICdlJ10sIDEsIDAgKTsgLy8gUm93CgkJICogICAgfSApOwoJCSAqLwoJCXRoaXMuZm5VcGRhdGUgPSBmdW5jdGlvbiggbURhdGEsIG1Sb3csIGlDb2x1bW4sIGJSZWRyYXcsIGJBY3Rpb24gKQoJCXsKCQkJdmFyIG9TZXR0aW5ncyA9IF9mblNldHRpbmdzRnJvbU5vZGUoIHRoaXNbRGF0YVRhYmxlLmV4dC5pQXBpSW5kZXhdICk7CgkJCXZhciBpLCBpTGVuLCBzRGlzcGxheTsKCQkJdmFyIGlSb3cgPSAodHlwZW9mIG1Sb3cgPT09ICdvYmplY3QnKSA/IAoJCQkJX2ZuTm9kZVRvRGF0YUluZGV4KG9TZXR0aW5ncywgbVJvdykgOiBtUm93OwoJCQkKCQkJaWYgKCBvU2V0dGluZ3MuX19mblVwZGF0ZURlZXAgPT09IHVuZGVmaW5lZCAmJiAkLmlzQXJyYXkobURhdGEpICYmIHR5cGVvZiBtRGF0YSA9PT0gJ29iamVjdCcgKQoJCQl7CgkJCQkvKiBBcnJheSB1cGRhdGUgLSB1cGRhdGUgdGhlIHdob2xlIHJvdyAqLwoJCQkJb1NldHRpbmdzLmFvRGF0YVtpUm93XS5fYURhdGEgPSBtRGF0YS5zbGljZSgpOwoJCQkJCgkJCQkvKiBGbGFnIHRvIHRoZSBmdW5jdGlvbiB0aGF0IHdlIGFyZSByZWN1cnNpbmcgKi8KCQkJCW9TZXR0aW5ncy5fX2ZuVXBkYXRlRGVlcCA9IHRydWU7CgkJCQlmb3IgKCBpPTAgOyBpPG9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaSsrICkKCQkJCXsKCQkJCQl0aGlzLmZuVXBkYXRlKCBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpICksIGlSb3csIGksIGZhbHNlLCBmYWxzZSApOwoJCQkJfQoJCQkJb1NldHRpbmdzLl9fZm5VcGRhdGVEZWVwID0gdW5kZWZpbmVkOwoJCQl9CgkJCWVsc2UgaWYgKCBvU2V0dGluZ3MuX19mblVwZGF0ZURlZXAgPT09IHVuZGVmaW5lZCAmJiBtRGF0YSAhPT0gbnVsbCAmJiB0eXBlb2YgbURhdGEgPT09ICdvYmplY3QnICkKCQkJewoJCQkJLyogT2JqZWN0IHVwZGF0ZSAtIHVwZGF0ZSB0aGUgd2hvbGUgcm93IC0gYXNzdW1lIHRoZSBkZXZlbG9wZXIgZ2V0cyB0aGUgb2JqZWN0IHJpZ2h0ICovCgkJCQlvU2V0dGluZ3MuYW9EYXRhW2lSb3ddLl9hRGF0YSA9ICQuZXh0ZW5kKCB0cnVlLCB7fSwgbURhdGEgKTsKCQkKCQkJCW9TZXR0aW5ncy5fX2ZuVXBkYXRlRGVlcCA9IHRydWU7CgkJCQlmb3IgKCBpPTAgOyBpPG9TZXR0aW5ncy5hb0NvbHVtbnMubGVuZ3RoIDsgaSsrICkKCQkJCXsKCQkJCQl0aGlzLmZuVXBkYXRlKCBfZm5HZXRDZWxsRGF0YSggb1NldHRpbmdzLCBpUm93LCBpICksIGlSb3csIGksIGZhbHNlLCBmYWxzZSApOwoJCQkJfQoJCQkJb1NldHRpbmdzLl9fZm5VcGRhdGVEZWVwID0gdW5kZWZpbmVkOwoJCQl9CgkJCWVsc2UKCQkJewoJCQkJLyogSW5kaXZpZHVhbCBjZWxsIHVwZGF0ZSAqLwoJCQkJX2ZuU2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaUNvbHVtbiwgbURhdGEgKTsKCQkJCXNEaXNwbGF5ID0gX2ZuR2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaUNvbHVtbiwgJ2Rpc3BsYXknICk7CgkJCQkKCQkJCXZhciBvQ29sID0gb1NldHRpbmdzLmFvQ29sdW1uc1tpQ29sdW1uXTsKCQkJCWlmICggb0NvbC5mblJlbmRlciAhPT0gbnVsbCApCgkJCQl7CgkJCQkJc0Rpc3BsYXkgPSBfZm5SZW5kZXIoIG9TZXR0aW5ncywgaVJvdywgaUNvbHVtbiApOwoJCQkJCWlmICggb0NvbC5iVXNlUmVuZGVyZWQgKQoJCQkJCXsKCQkJCQkJX2ZuU2V0Q2VsbERhdGEoIG9TZXR0aW5ncywgaVJvdywgaUNvbHVtbiwgc0Rpc3BsYXkgKTsKCQkJCQl9CgkJCQl9CgkJCQkKCQkJCWlmICggb1NldHRpbmdzLmFvRGF0YVtpUm93XS5uVHIgIT09IG51bGwgKQoJCQkJewoJCQkJCS8qIERvIHRoZSBhY3R1YWwgSFRNTCB1cGRhdGUgKi8KCQkJCQlfZm5HZXRUZE5vZGVzKCBvU2V0dGluZ3MsIGlSb3cgKVtpQ29sdW1uXS5pbm5lckhUTUwgPSBzRGlzcGxheTsKCQkJCX0KCQkJfQoJCQkKCQkJLyogTW9kaWZ5IHRoZSBzZWFyY2ggaW5kZXggZm9yIHRoaXMgcm93IChzdHJpY3RseSB0aGlzIGlzIGxpa2VseSBub3QgbmVlZGVkLCBzaW5jZSBmblJlRHJhdwoJCQkgKiB3aWxsIHJlYnVpbGQgdGhlIHNlYXJjaCBhcnJheSAtIGhvd2V2ZXIsIHRoZSByZWRyYXcgbWlnaHQgYmUgZGlzYWJsZWQgYnkgdGhlIHVzZXIpCgkJCSAqLwoJCQl2YXIgaURpc3BsYXlJbmRleCA9ICQuaW5BcnJheSggaVJvdywgb1NldHRpbmdzLmFpRGlzcGxheSApOwoJCQlvU2V0dGluZ3MuYXNEYXRhU2VhcmNoW2lEaXNwbGF5SW5kZXhdID0gX2ZuQnVpbGRTZWFyY2hSb3coIG9TZXR0aW5ncywgCgkJCQlfZm5HZXRSb3dEYXRhKCBvU2V0dGluZ3MsIGlSb3csICdmaWx0ZXInICkgKTsKCQkJCgkJCS8qIFBlcmZvcm0gcHJlLWRyYXcgYWN0aW9ucyAqLwoJCQlpZiAoIGJBY3Rpb24gPT09IHVuZGVmaW5lZCB8fCBiQWN0aW9uICkKCQkJewoJCQkJX2ZuQWRqdXN0Q29sdW1uU2l6aW5nKCBvU2V0dGluZ3MgKTsKCQkJfQoJCQkKCQkJLyogUmVkcmF3IHRoZSB0YWJsZSAqLwoJCQlpZiAoIGJSZWRyYXcgPT09IHVuZGVmaW5lZCB8fCBiUmVkcmF3ICkKCQkJewoJCQkJX2ZuUmVEcmF3KCBvU2V0dGluZ3MgKTsKCQkJfQoJCQlyZXR1cm4gMDsKCQl9OwoJCQoJCQoJCS8qKgoJCSAqIFByb3ZpZGUgYSBjb21tb24gbWV0aG9kIGZvciBwbHVnLWlucyB0byBjaGVjayB0aGUgdmVyc2lvbiBvZiBEYXRhVGFibGVzIGJlaW5nIHVzZWQsIGluIG9yZGVyCgkJICogdG8gZW5zdXJlIGNvbXBhdGliaWxpdHkuCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzVmVyc2lvbiBWZXJzaW9uIHN0cmluZyB0byBjaGVjayBmb3IsIGluIHRoZSBmb3JtYXQgIlguWS5aIi4gTm90ZSB0aGF0IHRoZQoJCSAqICAgIGZvcm1hdHMgIlgiIGFuZCAiWC5ZIiBhcmUgYWxzbyBhY2NlcHRhYmxlLgoJCSAqICBAcmV0dXJucyB7Ym9vbGVhbn0gdHJ1ZSBpZiB0aGlzIHZlcnNpb24gb2YgRGF0YVRhYmxlcyBpcyBncmVhdGVyIG9yIGVxdWFsIHRvIHRoZSByZXF1aXJlZAoJCSAqICAgIHZlcnNpb24sIG9yIGZhbHNlIGlmIHRoaXMgdmVyc2lvbiBvZiBEYXRhVGFsZXMgaXMgbm90IHN1aXRhYmxlCgkJICogIEBtZXRob2QKCQkgKiAgQGR0b3B0IEFQSQoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoKTsKCQkgKiAgICAgIGFsZXJ0KCBvVGFibGUuZm5WZXJzaW9uQ2hlY2soICcxLjkuMCcgKSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQl0aGlzLmZuVmVyc2lvbkNoZWNrID0gRGF0YVRhYmxlLmV4dC5mblZlcnNpb25DaGVjazsKCQkKCQkKCQkvKgoJCSAqIFRoaXMgaXMgcmVhbGx5IGEgZ29vZCBiaXQgcnViYmlzaCB0aGlzIG1ldGhvZCBvZiBleHBvc2luZyB0aGUgaW50ZXJuYWwgbWV0aG9kcwoJCSAqIHB1YmxpY2FsbHkuLi4gLSBUbyBiZSBmaXhlZCBpbiAyLjAgdXNpbmcgbWV0aG9kcyBvbiB0aGUgcHJvdG90eXBlCgkJICovCgkJCgkJCgkJLyoqCgkJICogQ3JlYXRlIGEgd3JhcHBlciBmdW5jdGlvbiBmb3IgZXhwb3J0aW5nIGFuIGludGVybmFsIGZ1bmN0aW9ucyB0byBhbiBleHRlcm5hbCBBUEkuCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzRnVuYyBBUEkgZnVuY3Rpb24gbmFtZQoJCSAqICBAcmV0dXJucyB7ZnVuY3Rpb259IHdyYXBwZWQgZnVuY3Rpb24KCQkgKiAgQG1lbWJlcm9mIERhdGFUYWJsZSNvQXBpCgkJICovCgkJZnVuY3Rpb24gX2ZuRXh0ZXJuQXBpRnVuYyAoc0Z1bmMpCgkJewoJCQlyZXR1cm4gZnVuY3Rpb24oKSB7CgkJCQl2YXIgYUFyZ3MgPSBbX2ZuU2V0dGluZ3NGcm9tTm9kZSh0aGlzW0RhdGFUYWJsZS5leHQuaUFwaUluZGV4XSldLmNvbmNhdCggCgkJCQkJQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKSApOwoJCQkJcmV0dXJuIERhdGFUYWJsZS5leHQub0FwaVtzRnVuY10uYXBwbHkoIHRoaXMsIGFBcmdzICk7CgkJCX07CgkJfQoJCQoJCQoJCS8qKgoJCSAqIFJlZmVyZW5jZSB0byBpbnRlcm5hbCBmdW5jdGlvbnMgZm9yIHVzZSBieSBwbHVnLWluIGRldmVsb3BlcnMuIE5vdGUgdGhhdCB0aGVzZQoJCSAqIG1ldGhvZHMgYXJlIHJlZmVyZW5jZXMgdG8gaW50ZXJuYWwgZnVuY3Rpb25zIGFuZCBhcmUgY29uc2lkZXJlZCB0byBiZSBwcml2YXRlLgoJCSAqIElmIHlvdSB1c2UgdGhlc2UgbWV0aG9kcywgYmUgYXdhcmUgdGhhdCB0aGV5IGFyZSBsaWFibGUgdG8gY2hhbmdlIGJldHdlZW4gdmVyc2lvbnMKCQkgKiAoY2hlY2sgdGhlIHVwZ3JhZGUgbm90ZXMpLgoJCSAqICBAbmFtZXNwYWNlCgkJICovCgkJdGhpcy5vQXBpID0gewoJCQkiX2ZuRXh0ZXJuQXBpRnVuYyI6IF9mbkV4dGVybkFwaUZ1bmMsCgkJCSJfZm5Jbml0aWFsaXNlIjogX2ZuSW5pdGlhbGlzZSwKCQkJIl9mbkluaXRDb21wbGV0ZSI6IF9mbkluaXRDb21wbGV0ZSwKCQkJIl9mbkxhbmd1YWdlQ29tcGF0IjogX2ZuTGFuZ3VhZ2VDb21wYXQsCgkJCSJfZm5BZGRDb2x1bW4iOiBfZm5BZGRDb2x1bW4sCgkJCSJfZm5Db2x1bW5PcHRpb25zIjogX2ZuQ29sdW1uT3B0aW9ucywKCQkJIl9mbkFkZERhdGEiOiBfZm5BZGREYXRhLAoJCQkiX2ZuQ3JlYXRlVHIiOiBfZm5DcmVhdGVUciwKCQkJIl9mbkdhdGhlckRhdGEiOiBfZm5HYXRoZXJEYXRhLAoJCQkiX2ZuQnVpbGRIZWFkIjogX2ZuQnVpbGRIZWFkLAoJCQkiX2ZuRHJhd0hlYWQiOiBfZm5EcmF3SGVhZCwKCQkJIl9mbkRyYXciOiBfZm5EcmF3LAoJCQkiX2ZuUmVEcmF3IjogX2ZuUmVEcmF3LAoJCQkiX2ZuQWpheFVwZGF0ZSI6IF9mbkFqYXhVcGRhdGUsCgkJCSJfZm5BamF4UGFyYW1ldGVycyI6IF9mbkFqYXhQYXJhbWV0ZXJzLAoJCQkiX2ZuQWpheFVwZGF0ZURyYXciOiBfZm5BamF4VXBkYXRlRHJhdywKCQkJIl9mblNlcnZlclBhcmFtcyI6IF9mblNlcnZlclBhcmFtcywKCQkJIl9mbkFkZE9wdGlvbnNIdG1sIjogX2ZuQWRkT3B0aW9uc0h0bWwsCgkJCSJfZm5GZWF0dXJlSHRtbFRhYmxlIjogX2ZuRmVhdHVyZUh0bWxUYWJsZSwKCQkJIl9mblNjcm9sbERyYXciOiBfZm5TY3JvbGxEcmF3LAoJCQkiX2ZuQWRqdXN0Q29sdW1uU2l6aW5nIjogX2ZuQWRqdXN0Q29sdW1uU2l6aW5nLAoJCQkiX2ZuRmVhdHVyZUh0bWxGaWx0ZXIiOiBfZm5GZWF0dXJlSHRtbEZpbHRlciwKCQkJIl9mbkZpbHRlckNvbXBsZXRlIjogX2ZuRmlsdGVyQ29tcGxldGUsCgkJCSJfZm5GaWx0ZXJDdXN0b20iOiBfZm5GaWx0ZXJDdXN0b20sCgkJCSJfZm5GaWx0ZXJDb2x1bW4iOiBfZm5GaWx0ZXJDb2x1bW4sCgkJCSJfZm5GaWx0ZXIiOiBfZm5GaWx0ZXIsCgkJCSJfZm5CdWlsZFNlYXJjaEFycmF5IjogX2ZuQnVpbGRTZWFyY2hBcnJheSwKCQkJIl9mbkJ1aWxkU2VhcmNoUm93IjogX2ZuQnVpbGRTZWFyY2hSb3csCgkJCSJfZm5GaWx0ZXJDcmVhdGVTZWFyY2giOiBfZm5GaWx0ZXJDcmVhdGVTZWFyY2gsCgkJCSJfZm5EYXRhVG9TZWFyY2giOiBfZm5EYXRhVG9TZWFyY2gsCgkJCSJfZm5Tb3J0IjogX2ZuU29ydCwKCQkJIl9mblNvcnRBdHRhY2hMaXN0ZW5lciI6IF9mblNvcnRBdHRhY2hMaXN0ZW5lciwKCQkJIl9mblNvcnRpbmdDbGFzc2VzIjogX2ZuU29ydGluZ0NsYXNzZXMsCgkJCSJfZm5GZWF0dXJlSHRtbFBhZ2luYXRlIjogX2ZuRmVhdHVyZUh0bWxQYWdpbmF0ZSwKCQkJIl9mblBhZ2VDaGFuZ2UiOiBfZm5QYWdlQ2hhbmdlLAoJCQkiX2ZuRmVhdHVyZUh0bWxJbmZvIjogX2ZuRmVhdHVyZUh0bWxJbmZvLAoJCQkiX2ZuVXBkYXRlSW5mbyI6IF9mblVwZGF0ZUluZm8sCgkJCSJfZm5GZWF0dXJlSHRtbExlbmd0aCI6IF9mbkZlYXR1cmVIdG1sTGVuZ3RoLAoJCQkiX2ZuRmVhdHVyZUh0bWxQcm9jZXNzaW5nIjogX2ZuRmVhdHVyZUh0bWxQcm9jZXNzaW5nLAoJCQkiX2ZuUHJvY2Vzc2luZ0Rpc3BsYXkiOiBfZm5Qcm9jZXNzaW5nRGlzcGxheSwKCQkJIl9mblZpc2libGVUb0NvbHVtbkluZGV4IjogX2ZuVmlzaWJsZVRvQ29sdW1uSW5kZXgsCgkJCSJfZm5Db2x1bW5JbmRleFRvVmlzaWJsZSI6IF9mbkNvbHVtbkluZGV4VG9WaXNpYmxlLAoJCQkiX2ZuTm9kZVRvRGF0YUluZGV4IjogX2ZuTm9kZVRvRGF0YUluZGV4LAoJCQkiX2ZuVmlzYmxlQ29sdW1ucyI6IF9mblZpc2JsZUNvbHVtbnMsCgkJCSJfZm5DYWxjdWxhdGVFbmQiOiBfZm5DYWxjdWxhdGVFbmQsCgkJCSJfZm5Db252ZXJ0VG9XaWR0aCI6IF9mbkNvbnZlcnRUb1dpZHRoLAoJCQkiX2ZuQ2FsY3VsYXRlQ29sdW1uV2lkdGhzIjogX2ZuQ2FsY3VsYXRlQ29sdW1uV2lkdGhzLAoJCQkiX2ZuU2Nyb2xsaW5nV2lkdGhBZGp1c3QiOiBfZm5TY3JvbGxpbmdXaWR0aEFkanVzdCwKCQkJIl9mbkdldFdpZGVzdE5vZGUiOiBfZm5HZXRXaWRlc3ROb2RlLAoJCQkiX2ZuR2V0TWF4TGVuU3RyaW5nIjogX2ZuR2V0TWF4TGVuU3RyaW5nLAoJCQkiX2ZuU3RyaW5nVG9Dc3MiOiBfZm5TdHJpbmdUb0NzcywKCQkJIl9mbkRldGVjdFR5cGUiOiBfZm5EZXRlY3RUeXBlLAoJCQkiX2ZuU2V0dGluZ3NGcm9tTm9kZSI6IF9mblNldHRpbmdzRnJvbU5vZGUsCgkJCSJfZm5HZXREYXRhTWFzdGVyIjogX2ZuR2V0RGF0YU1hc3RlciwKCQkJIl9mbkdldFRyTm9kZXMiOiBfZm5HZXRUck5vZGVzLAoJCQkiX2ZuR2V0VGROb2RlcyI6IF9mbkdldFRkTm9kZXMsCgkJCSJfZm5Fc2NhcGVSZWdleCI6IF9mbkVzY2FwZVJlZ2V4LAoJCQkiX2ZuRGVsZXRlSW5kZXgiOiBfZm5EZWxldGVJbmRleCwKCQkJIl9mblJlT3JkZXJJbmRleCI6IF9mblJlT3JkZXJJbmRleCwKCQkJIl9mbkNvbHVtbk9yZGVyaW5nIjogX2ZuQ29sdW1uT3JkZXJpbmcsCgkJCSJfZm5Mb2ciOiBfZm5Mb2csCgkJCSJfZm5DbGVhclRhYmxlIjogX2ZuQ2xlYXJUYWJsZSwKCQkJIl9mblNhdmVTdGF0ZSI6IF9mblNhdmVTdGF0ZSwKCQkJIl9mbkxvYWRTdGF0ZSI6IF9mbkxvYWRTdGF0ZSwKCQkJIl9mbkNyZWF0ZUNvb2tpZSI6IF9mbkNyZWF0ZUNvb2tpZSwKCQkJIl9mblJlYWRDb29raWUiOiBfZm5SZWFkQ29va2llLAoJCQkiX2ZuRGV0ZWN0SGVhZGVyIjogX2ZuRGV0ZWN0SGVhZGVyLAoJCQkiX2ZuR2V0VW5pcXVlVGhzIjogX2ZuR2V0VW5pcXVlVGhzLAoJCQkiX2ZuU2Nyb2xsQmFyV2lkdGgiOiBfZm5TY3JvbGxCYXJXaWR0aCwKCQkJIl9mbkFwcGx5VG9DaGlsZHJlbiI6IF9mbkFwcGx5VG9DaGlsZHJlbiwKCQkJIl9mbk1hcCI6IF9mbk1hcCwKCQkJIl9mbkdldFJvd0RhdGEiOiBfZm5HZXRSb3dEYXRhLAoJCQkiX2ZuR2V0Q2VsbERhdGEiOiBfZm5HZXRDZWxsRGF0YSwKCQkJIl9mblNldENlbGxEYXRhIjogX2ZuU2V0Q2VsbERhdGEsCgkJCSJfZm5HZXRPYmplY3REYXRhRm4iOiBfZm5HZXRPYmplY3REYXRhRm4sCgkJCSJfZm5TZXRPYmplY3REYXRhRm4iOiBfZm5TZXRPYmplY3REYXRhRm4sCgkJCSJfZm5BcHBseUNvbHVtbkRlZnMiOiBfZm5BcHBseUNvbHVtbkRlZnMsCgkJCSJfZm5CaW5kQWN0aW9uIjogX2ZuQmluZEFjdGlvbiwKCQkJIl9mbkV4dGVuZCI6IF9mbkV4dGVuZCwKCQkJIl9mbkNhbGxiYWNrUmVnIjogX2ZuQ2FsbGJhY2tSZWcsCgkJCSJfZm5DYWxsYmFja0ZpcmUiOiBfZm5DYWxsYmFja0ZpcmUsCgkJCSJfZm5Kc29uU3RyaW5nIjogX2ZuSnNvblN0cmluZywKCQkJIl9mblJlbmRlciI6IF9mblJlbmRlciwKCQkJIl9mbk5vZGVUb0NvbHVtbkluZGV4IjogX2ZuTm9kZVRvQ29sdW1uSW5kZXgsCgkJCSJfZm5JbmZvTWFjcm9zIjogX2ZuSW5mb01hY3JvcwoJCX07CgkJCgkJJC5leHRlbmQoIERhdGFUYWJsZS5leHQub0FwaSwgdGhpcy5vQXBpICk7CgkJCgkJZm9yICggdmFyIHNGdW5jIGluIERhdGFUYWJsZS5leHQub0FwaSApCgkJewoJCQlpZiAoIHNGdW5jICkKCQkJewoJCQkJdGhpc1tzRnVuY10gPSBfZm5FeHRlcm5BcGlGdW5jKHNGdW5jKTsKCQkJfQoJCX0KCQkKCQkKCQl2YXIgX3RoYXQgPSB0aGlzOwoJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CgkJCQoJCQl2YXIgaT0wLCBpTGVuLCBqLCBqTGVuLCBrLCBrTGVuOwoJCQl2YXIgc0lkID0gdGhpcy5nZXRBdHRyaWJ1dGUoICdpZCcgKTsKCQkJdmFyIGJJbml0SGFuZGVkT2ZmID0gZmFsc2U7CgkJCXZhciBiVXNlUGFzc2VkRGF0YSA9IGZhbHNlOwoJCQkKCQkJCgkJCS8qIFNhbml0eSBjaGVjayAqLwoJCQlpZiAoIHRoaXMubm9kZU5hbWUudG9Mb3dlckNhc2UoKSAhPSAndGFibGUnICkKCQkJewoJCQkJX2ZuTG9nKCBudWxsLCAwLCAiQXR0ZW1wdGVkIHRvIGluaXRpYWxpc2UgRGF0YVRhYmxlcyBvbiBhIG5vZGUgd2hpY2ggaXMgbm90IGEgIisKCQkJCQkidGFibGU6ICIrdGhpcy5ub2RlTmFtZSApOwoJCQkJcmV0dXJuOwoJCQl9CgkJCQoJCQkvKiBDaGVjayB0byBzZWUgaWYgd2UgYXJlIHJlLWluaXRpYWxpc2luZyBhIHRhYmxlICovCgkJCWZvciAoIGk9MCwgaUxlbj1EYXRhVGFibGUuc2V0dGluZ3MubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJewoJCQkJLyogQmFzZSBjaGVjayBvbiB0YWJsZSBub2RlICovCgkJCQlpZiAoIERhdGFUYWJsZS5zZXR0aW5nc1tpXS5uVGFibGUgPT0gdGhpcyApCgkJCQl7CgkJCQkJaWYgKCBvSW5pdCA9PT0gdW5kZWZpbmVkIHx8IG9Jbml0LmJSZXRyaWV2ZSApCgkJCQkJewoJCQkJCQlyZXR1cm4gRGF0YVRhYmxlLnNldHRpbmdzW2ldLm9JbnN0YW5jZTsKCQkJCQl9CgkJCQkJZWxzZSBpZiAoIG9Jbml0LmJEZXN0cm95ICkKCQkJCQl7CgkJCQkJCURhdGFUYWJsZS5zZXR0aW5nc1tpXS5vSW5zdGFuY2UuZm5EZXN0cm95KCk7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCQkJCQllbHNlCgkJCQkJewoJCQkJCQlfZm5Mb2coIERhdGFUYWJsZS5zZXR0aW5nc1tpXSwgMCwgIkNhbm5vdCByZWluaXRpYWxpc2UgRGF0YVRhYmxlLlxuXG4iKwoJCQkJCQkJIlRvIHJldHJpZXZlIHRoZSBEYXRhVGFibGVzIG9iamVjdCBmb3IgdGhpcyB0YWJsZSwgcGFzcyBubyBhcmd1bWVudHMgb3Igc2VlICIrCgkJCQkJCQkidGhlIGRvY3MgZm9yIGJSZXRyaWV2ZSBhbmQgYkRlc3Ryb3kiICk7CgkJCQkJCXJldHVybjsKCQkJCQl9CgkJCQl9CgkJCQkKCQkJCS8qIElmIHRoZSBlbGVtZW50IHdlIGFyZSBpbml0aWFsaXNpbmcgaGFzIHRoZSBzYW1lIElEIGFzIGEgdGFibGUgd2hpY2ggd2FzIHByZXZpb3VzbHkKCQkJCSAqIGluaXRpYWxpc2VkLCBidXQgdGhlIHRhYmxlIG5vZGVzIGRvbid0IG1hdGNoIChmcm9tIGJlZm9yZSkgdGhlbiB3ZSBkZXN0cm95IHRoZSBvbGQKCQkJCSAqIGluc3RhbmNlIGJ5IHNpbXBseSBkZWxldGluZyBpdC4gVGhpcyBpcyB1bmRlciB0aGUgYXNzdW1wdGlvbiB0aGF0IHRoZSB0YWJsZSBoYXMgYmVlbgoJCQkJICogZGVzdHJveWVkIGJ5IG90aGVyIG1ldGhvZHMuIEFueW9uZSB1c2luZyBub24taWQgc2VsZWN0b3JzIHdpbGwgbmVlZCB0byBkbyB0aGlzIG1hbnVhbGx5CgkJCQkgKi8KCQkJCWlmICggRGF0YVRhYmxlLnNldHRpbmdzW2ldLnNUYWJsZUlkID09IHRoaXMuaWQgKQoJCQkJewoJCQkJCURhdGFUYWJsZS5zZXR0aW5ncy5zcGxpY2UoIGksIDEgKTsKCQkJCQlicmVhazsKCQkJCX0KCQkJfQoJCQkKCQkJLyogRW5zdXJlIHRoZSB0YWJsZSBoYXMgYW4gSUQgLSByZXF1aXJlZCBmb3IgYWNjZXNzaWJpbGl0eSAqLwoJCQlpZiAoIHNJZCA9PT0gbnVsbCB8fCBzSWQgPT09ICIiICkKCQkJewoJCQkJc0lkID0gIkRhdGFUYWJsZXNfVGFibGVfIisoRGF0YVRhYmxlLmV4dC5fb0V4dGVybkNvbmZpZy5pTmV4dFVuaXF1ZSsrKTsKCQkJCXRoaXMuaWQgPSBzSWQ7CgkJCX0KCQkJCgkJCS8qIENyZWF0ZSB0aGUgc2V0dGluZ3Mgb2JqZWN0IGZvciB0aGlzIHRhYmxlIGFuZCBzZXQgc29tZSBvZiB0aGUgZGVmYXVsdCBwYXJhbWV0ZXJzICovCgkJCXZhciBvU2V0dGluZ3MgPSAkLmV4dGVuZCggdHJ1ZSwge30sIERhdGFUYWJsZS5tb2RlbHMub1NldHRpbmdzLCB7CgkJCQkiblRhYmxlIjogICAgICAgIHRoaXMsCgkJCQkib0FwaSI6ICAgICAgICAgIF90aGF0Lm9BcGksCgkJCQkib0luaXQiOiAgICAgICAgIG9Jbml0LAoJCQkJInNEZXN0cm95V2lkdGgiOiAkKHRoaXMpLndpZHRoKCksCgkJCQkic0luc3RhbmNlIjogICAgIHNJZCwKCQkJCSJzVGFibGVJZCI6ICAgICAgc0lkCgkJCX0gKTsKCQkJRGF0YVRhYmxlLnNldHRpbmdzLnB1c2goIG9TZXR0aW5ncyApOwoJCQkKCQkJLy8gTmVlZCB0byBhZGQgdGhlIGluc3RhbmNlIGFmdGVyIHRoZSBpbnN0YW5jZSBhZnRlciB0aGUgc2V0dGluZ3Mgb2JqZWN0IGhhcyBiZWVuIGFkZGVkCgkJCS8vIHRvIHRoZSBzZXR0aW5ncyBhcnJheSwgc28gd2UgY2FuIHNlbGYgcmVmZXJlbmNlIHRoZSB0YWJsZSBpbnN0YW5jZSBpZiBtb3JlIHRoYW4gb25lCgkJCW9TZXR0aW5ncy5vSW5zdGFuY2UgPSAoX3RoYXQubGVuZ3RoPT09MSkgPyBfdGhhdCA6ICQodGhpcykuZGF0YVRhYmxlKCk7CgkJCQoJCQkvKiBTZXR0aW5nIHVwIHRoZSBpbml0aWFsaXNhdGlvbiBvYmplY3QgKi8KCQkJaWYgKCAhb0luaXQgKQoJCQl7CgkJCQlvSW5pdCA9IHt9OwoJCQl9CgkJCQoJCQkvLyBCYWNrd2FyZHMgY29tcGF0aWJpbGl0eSwgYmVmb3JlIHdlIGFwcGx5IGFsbCB0aGUgZGVmYXVsdHMKCQkJaWYgKCBvSW5pdC5vTGFuZ3VhZ2UgKQoJCQl7CgkJCQlfZm5MYW5ndWFnZUNvbXBhdCggb0luaXQub0xhbmd1YWdlICk7CgkJCX0KCQkJCgkJCW9Jbml0ID0gX2ZuRXh0ZW5kKCAkLmV4dGVuZCh0cnVlLCB7fSwgRGF0YVRhYmxlLmRlZmF1bHRzKSwgb0luaXQgKTsKCQkJCgkJCS8vIE1hcCB0aGUgaW5pdGlhbGlzYXRpb24gb3B0aW9ucyBvbnRvIHRoZSBzZXR0aW5ncyBvYmplY3QKCQkJX2ZuTWFwKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLCBvSW5pdCwgImJQYWdpbmF0ZSIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLCBvSW5pdCwgImJMZW5ndGhDaGFuZ2UiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLm9GZWF0dXJlcywgb0luaXQsICJiRmlsdGVyIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vRmVhdHVyZXMsIG9Jbml0LCAiYlNvcnQiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLm9GZWF0dXJlcywgb0luaXQsICJiSW5mbyIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLCBvSW5pdCwgImJQcm9jZXNzaW5nIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vRmVhdHVyZXMsIG9Jbml0LCAiYkF1dG9XaWR0aCIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLCBvSW5pdCwgImJTb3J0Q2xhc3NlcyIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLCBvSW5pdCwgImJTZXJ2ZXJTaWRlIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vRmVhdHVyZXMsIG9Jbml0LCAiYkRlZmVyUmVuZGVyIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vU2Nyb2xsLCBvSW5pdCwgInNTY3JvbGxYIiwgInNYIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vU2Nyb2xsLCBvSW5pdCwgInNTY3JvbGxYSW5uZXIiLCAic1hJbm5lciIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3Mub1Njcm9sbCwgb0luaXQsICJzU2Nyb2xsWSIsICJzWSIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3Mub1Njcm9sbCwgb0luaXQsICJiU2Nyb2xsQ29sbGFwc2UiLCAiYkNvbGxhcHNlIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vU2Nyb2xsLCBvSW5pdCwgImJTY3JvbGxJbmZpbml0ZSIsICJiSW5maW5pdGUiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLm9TY3JvbGwsIG9Jbml0LCAiaVNjcm9sbExvYWRHYXAiLCAiaUxvYWRHYXAiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLm9TY3JvbGwsIG9Jbml0LCAiYlNjcm9sbEF1dG9Dc3MiLCAiYkF1dG9Dc3MiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLCBvSW5pdCwgImFzU3RyaXBlQ2xhc3NlcyIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAiYXNTdHJpcENsYXNzZXMiLCAiYXNTdHJpcGVDbGFzc2VzIiApOyAvLyBsZWdhY3kKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAiZm5TZXJ2ZXJEYXRhIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJmbkZvcm1hdE51bWJlciIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAic1NlcnZlck1ldGhvZCIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAiYWFTb3J0aW5nIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJhYVNvcnRpbmdGaXhlZCIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAiYUxlbmd0aE1lbnUiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLCBvSW5pdCwgInNQYWdpbmF0aW9uVHlwZSIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAic0FqYXhTb3VyY2UiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLCBvSW5pdCwgInNBamF4RGF0YVByb3AiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLCBvSW5pdCwgImlDb29raWVEdXJhdGlvbiIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAic0Nvb2tpZVByZWZpeCIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAic0RvbSIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAiYlNvcnRDZWxsc1RvcCIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAiaVRhYkluZGV4IiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJvU2VhcmNoIiwgIm9QcmV2aW91c1NlYXJjaCIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAiYW9TZWFyY2hDb2xzIiwgImFvUHJlU2VhcmNoQ29scyIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAiaURpc3BsYXlMZW5ndGgiLCAiX2lEaXNwbGF5TGVuZ3RoIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncywgb0luaXQsICJiSlF1ZXJ5VUkiLCAiYkpVSSIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAiZm5Db29raWVDYWxsYmFjayIgKTsKCQkJX2ZuTWFwKCBvU2V0dGluZ3MsIG9Jbml0LCAiZm5TdGF0ZUxvYWQiICk7CgkJCV9mbk1hcCggb1NldHRpbmdzLCBvSW5pdCwgImZuU3RhdGVTYXZlIiApOwoJCQlfZm5NYXAoIG9TZXR0aW5ncy5vTGFuZ3VhZ2UsIG9Jbml0LCAiZm5JbmZvQ2FsbGJhY2siICk7CgkJCQoJCQkvKiBDYWxsYmFjayBmdW5jdGlvbnMgd2hpY2ggYXJlIGFycmF5IGRyaXZlbiAqLwoJCQlfZm5DYWxsYmFja1JlZyggb1NldHRpbmdzLCAnYW9EcmF3Q2FsbGJhY2snLCAgICAgICBvSW5pdC5mbkRyYXdDYWxsYmFjaywgICAgICAndXNlcicgKTsKCQkJX2ZuQ2FsbGJhY2tSZWcoIG9TZXR0aW5ncywgJ2FvU2VydmVyUGFyYW1zJywgICAgICAgb0luaXQuZm5TZXJ2ZXJQYXJhbXMsICAgICAgJ3VzZXInICk7CgkJCV9mbkNhbGxiYWNrUmVnKCBvU2V0dGluZ3MsICdhb1N0YXRlU2F2ZVBhcmFtcycsICAgIG9Jbml0LmZuU3RhdGVTYXZlUGFyYW1zLCAgICd1c2VyJyApOwoJCQlfZm5DYWxsYmFja1JlZyggb1NldHRpbmdzLCAnYW9TdGF0ZUxvYWRQYXJhbXMnLCAgICBvSW5pdC5mblN0YXRlTG9hZFBhcmFtcywgICAndXNlcicgKTsKCQkJX2ZuQ2FsbGJhY2tSZWcoIG9TZXR0aW5ncywgJ2FvU3RhdGVMb2FkZWQnLCAgICAgICAgb0luaXQuZm5TdGF0ZUxvYWRlZCwgICAgICAgJ3VzZXInICk7CgkJCV9mbkNhbGxiYWNrUmVnKCBvU2V0dGluZ3MsICdhb1Jvd0NhbGxiYWNrJywgICAgICAgIG9Jbml0LmZuUm93Q2FsbGJhY2ssICAgICAgICd1c2VyJyApOwoJCQlfZm5DYWxsYmFja1JlZyggb1NldHRpbmdzLCAnYW9Sb3dDcmVhdGVkQ2FsbGJhY2snLCBvSW5pdC5mbkNyZWF0ZWRSb3csICAgICAgICAndXNlcicgKTsKCQkJX2ZuQ2FsbGJhY2tSZWcoIG9TZXR0aW5ncywgJ2FvSGVhZGVyQ2FsbGJhY2snLCAgICAgb0luaXQuZm5IZWFkZXJDYWxsYmFjaywgICAgJ3VzZXInICk7CgkJCV9mbkNhbGxiYWNrUmVnKCBvU2V0dGluZ3MsICdhb0Zvb3RlckNhbGxiYWNrJywgICAgIG9Jbml0LmZuRm9vdGVyQ2FsbGJhY2ssICAgICd1c2VyJyApOwoJCQlfZm5DYWxsYmFja1JlZyggb1NldHRpbmdzLCAnYW9Jbml0Q29tcGxldGUnLCAgICAgICBvSW5pdC5mbkluaXRDb21wbGV0ZSwgICAgICAndXNlcicgKTsKCQkJX2ZuQ2FsbGJhY2tSZWcoIG9TZXR0aW5ncywgJ2FvUHJlRHJhd0NhbGxiYWNrJywgICAgb0luaXQuZm5QcmVEcmF3Q2FsbGJhY2ssICAgJ3VzZXInICk7CgkJCQoJCQlpZiAoIG9TZXR0aW5ncy5vRmVhdHVyZXMuYlNlcnZlclNpZGUgJiYgb1NldHRpbmdzLm9GZWF0dXJlcy5iU29ydCAmJgoJCQkJICAgb1NldHRpbmdzLm9GZWF0dXJlcy5iU29ydENsYXNzZXMgKQoJCQl7CgkJCQkvKiBFbmFibGUgc29ydCBjbGFzc2VzIGZvciBzZXJ2ZXItc2lkZSBwcm9jZXNzaW5nLiBTYWZlIHRvIGRvIGl0IGhlcmUsIHNpbmNlIHNlcnZlci1zaWRlCgkJCQkgKiBwcm9jZXNzaW5nIG11c3QgYmUgZW5hYmxlZCBieSB0aGUgZGV2ZWxvcGVyCgkJCQkgKi8KCQkJCV9mbkNhbGxiYWNrUmVnKCBvU2V0dGluZ3MsICdhb0RyYXdDYWxsYmFjaycsIF9mblNvcnRpbmdDbGFzc2VzLCAnc2VydmVyX3NpZGVfc29ydF9jbGFzc2VzJyApOwoJCQl9CgkJCWVsc2UgaWYgKCBvU2V0dGluZ3Mub0ZlYXR1cmVzLmJEZWZlclJlbmRlciApCgkJCXsKCQkJCV9mbkNhbGxiYWNrUmVnKCBvU2V0dGluZ3MsICdhb0RyYXdDYWxsYmFjaycsIF9mblNvcnRpbmdDbGFzc2VzLCAnZGVmZXJfc29ydF9jbGFzc2VzJyApOwoJCQl9CgkJCQoJCQlpZiAoIG9Jbml0LmJKUXVlcnlVSSApCgkJCXsKCQkJCS8qIFVzZSB0aGUgSlVJIGNsYXNzZXMgb2JqZWN0IGZvciBkaXNwbGF5LiBZb3UgY291bGQgY2xvbmUgdGhlIG9TdGRDbGFzc2VzIG9iamVjdCBpZiAKCQkJCSAqIHlvdSB3YW50IHRvIGhhdmUgbXVsdGlwbGUgdGFibGVzIHdpdGggbXVsdGlwbGUgaW5kZXBlbmRlbnQgY2xhc3NlcyAKCQkJCSAqLwoJCQkJJC5leHRlbmQoIG9TZXR0aW5ncy5vQ2xhc3NlcywgRGF0YVRhYmxlLmV4dC5vSlVJQ2xhc3NlcyApOwoJCQkJCgkJCQlpZiAoIG9Jbml0LnNEb20gPT09IERhdGFUYWJsZS5kZWZhdWx0cy5zRG9tICYmIERhdGFUYWJsZS5kZWZhdWx0cy5zRG9tID09PSAibGZydGlwIiApCgkJCQl7CgkJCQkJLyogU2V0IHRoZSBET00gdG8gdXNlIGEgbGF5b3V0IHN1aXRhYmxlIGZvciBqUXVlcnkgVUkncyB0aGVtaW5nICovCgkJCQkJb1NldHRpbmdzLnNEb20gPSAnPCJIImxmcj50PCJGImlwPic7CgkJCQl9CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQkkLmV4dGVuZCggb1NldHRpbmdzLm9DbGFzc2VzLCBEYXRhVGFibGUuZXh0Lm9TdGRDbGFzc2VzICk7CgkJCX0KCQkJJCh0aGlzKS5hZGRDbGFzcyggb1NldHRpbmdzLm9DbGFzc2VzLnNUYWJsZSApOwoJCQkKCQkJLyogQ2FsY3VsYXRlIHRoZSBzY3JvbGwgYmFyIHdpZHRoIGFuZCBjYWNoZSBpdCBmb3IgdXNlIGxhdGVyIG9uICovCgkJCWlmICggb1NldHRpbmdzLm9TY3JvbGwuc1ggIT09ICIiIHx8IG9TZXR0aW5ncy5vU2Nyb2xsLnNZICE9PSAiIiApCgkJCXsKCQkJCW9TZXR0aW5ncy5vU2Nyb2xsLmlCYXJXaWR0aCA9IF9mblNjcm9sbEJhcldpZHRoKCk7CgkJCX0KCQkJCgkJCWlmICggb1NldHRpbmdzLmlJbml0RGlzcGxheVN0YXJ0ID09PSB1bmRlZmluZWQgKQoJCQl7CgkJCQkvKiBEaXNwbGF5IHN0YXJ0IHBvaW50LCB0YWtpbmcgaW50byBhY2NvdW50IHRoZSBzYXZlIHNhdmluZyAqLwoJCQkJb1NldHRpbmdzLmlJbml0RGlzcGxheVN0YXJ0ID0gb0luaXQuaURpc3BsYXlTdGFydDsKCQkJCW9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA9IG9Jbml0LmlEaXNwbGF5U3RhcnQ7CgkJCX0KCQkJCgkJCS8qIE11c3QgYmUgZG9uZSBhZnRlciBldmVyeXRoaW5nIHdoaWNoIGNhbiBiZSBvdmVycmlkZGVuIGJ5IGEgY29va2llISAqLwoJCQlpZiAoIG9Jbml0LmJTdGF0ZVNhdmUgKQoJCQl7CgkJCQlvU2V0dGluZ3Mub0ZlYXR1cmVzLmJTdGF0ZVNhdmUgPSB0cnVlOwoJCQkJX2ZuTG9hZFN0YXRlKCBvU2V0dGluZ3MsIG9Jbml0ICk7CgkJCQlfZm5DYWxsYmFja1JlZyggb1NldHRpbmdzLCAnYW9EcmF3Q2FsbGJhY2snLCBfZm5TYXZlU3RhdGUsICdzdGF0ZV9zYXZlJyApOwoJCQl9CgkJCQoJCQlpZiAoIG9Jbml0LmlEZWZlckxvYWRpbmcgIT09IG51bGwgKQoJCQl7CgkJCQlvU2V0dGluZ3MuYkRlZmVyTG9hZGluZyA9IHRydWU7CgkJCQl2YXIgdG1wID0gJC5pc0FycmF5KCBvSW5pdC5pRGVmZXJMb2FkaW5nICk7CgkJCQlvU2V0dGluZ3MuX2lSZWNvcmRzRGlzcGxheSA9IHRtcCA/IG9Jbml0LmlEZWZlckxvYWRpbmdbMF0gOiBvSW5pdC5pRGVmZXJMb2FkaW5nOwoJCQkJb1NldHRpbmdzLl9pUmVjb3Jkc1RvdGFsID0gdG1wID8gb0luaXQuaURlZmVyTG9hZGluZ1sxXSA6IG9Jbml0LmlEZWZlckxvYWRpbmc7CgkJCX0KCQkJCgkJCWlmICggb0luaXQuYWFEYXRhICE9PSBudWxsICkKCQkJewoJCQkJYlVzZVBhc3NlZERhdGEgPSB0cnVlOwoJCQl9CgkJCQoJCQkvKiBMYW5ndWFnZSBkZWZpbml0aW9ucyAqLwoJCQlpZiAoIG9Jbml0Lm9MYW5ndWFnZS5zVXJsICE9PSAiIiApCgkJCXsKCQkJCS8qIEdldCB0aGUgbGFuZ3VhZ2UgZGVmaW5pdGlvbnMgZnJvbSBhIGZpbGUgLSBiZWNhdXNlIHRoaXMgQWpheCBjYWxsIG1ha2VzIHRoZSBsYW5ndWFnZQoJCQkJICogZ2V0IGFzeW5jIHRvIHRoZSByZW1haW5kZXIgb2YgdGhpcyBmdW5jdGlvbiB3ZSB1c2UgYkluaXRIYW5kZWRPZmYgdG8gaW5kaWNhdGUgdGhhdCAKCQkJCSAqIF9mbkluaXRpYWxpc2Ugd2lsbCBiZSBmaXJlZCBieSB0aGUgcmV0dXJuZWQgQWpheCBoYW5kbGVyLCByYXRoZXIgdGhhbiB0aGUgY29uc3RydWN0b3IKCQkJCSAqLwoJCQkJb1NldHRpbmdzLm9MYW5ndWFnZS5zVXJsID0gb0luaXQub0xhbmd1YWdlLnNVcmw7CgkJCQkkLmdldEpTT04oIG9TZXR0aW5ncy5vTGFuZ3VhZ2Uuc1VybCwgbnVsbCwgZnVuY3Rpb24oIGpzb24gKSB7CgkJCQkJX2ZuTGFuZ3VhZ2VDb21wYXQoIGpzb24gKTsKCQkJCQkkLmV4dGVuZCggdHJ1ZSwgb1NldHRpbmdzLm9MYW5ndWFnZSwgb0luaXQub0xhbmd1YWdlLCBqc29uICk7CgkJCQkJX2ZuSW5pdGlhbGlzZSggb1NldHRpbmdzICk7CgkJCQl9ICk7CgkJCQliSW5pdEhhbmRlZE9mZiA9IHRydWU7CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQkkLmV4dGVuZCggdHJ1ZSwgb1NldHRpbmdzLm9MYW5ndWFnZSwgb0luaXQub0xhbmd1YWdlICk7CgkJCX0KCQkJCgkJCQoJCQkvKgoJCQkgKiBTdHJpcGVzCgkJCSAqLwoJCQlpZiAoIG9Jbml0LmFzU3RyaXBlQ2xhc3NlcyA9PT0gbnVsbCApCgkJCXsKCQkJCW9TZXR0aW5ncy5hc1N0cmlwZUNsYXNzZXMgPVsKCQkJCQlvU2V0dGluZ3Mub0NsYXNzZXMuc1N0cmlwZU9kZCwKCQkJCQlvU2V0dGluZ3Mub0NsYXNzZXMuc1N0cmlwZUV2ZW4KCQkJCV07CgkJCX0KCQkJCgkJCS8qIFJlbW92ZSByb3cgc3RyaXBlIGNsYXNzZXMgaWYgdGhleSBhcmUgYWxyZWFkeSBvbiB0aGUgdGFibGUgcm93ICovCgkJCXZhciBiU3RyaXBlUmVtb3ZlID0gZmFsc2U7CgkJCXZhciBhblJvd3MgPSAkKHRoaXMpLmNoaWxkcmVuKCd0Ym9keScpLmNoaWxkcmVuKCd0cicpOwoJCQlmb3IgKCBpPTAsIGlMZW49b1NldHRpbmdzLmFzU3RyaXBlQ2xhc3Nlcy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlpZiAoIGFuUm93cy5maWx0ZXIoIjpsdCgyKSIpLmhhc0NsYXNzKCBvU2V0dGluZ3MuYXNTdHJpcGVDbGFzc2VzW2ldKSApCgkJCQl7CgkJCQkJYlN0cmlwZVJlbW92ZSA9IHRydWU7CgkJCQkJYnJlYWs7CgkJCQl9CgkJCX0KCQkJCQkKCQkJaWYgKCBiU3RyaXBlUmVtb3ZlICkKCQkJewoJCQkJLyogU3RvcmUgdGhlIGNsYXNzZXMgd2hpY2ggd2UgYXJlIGFib3V0IHRvIHJlbW92ZSBzbyB0aGV5IGNhbiBiZSByZWFkZGVkIG9uIGRlc3Ryb3kgKi8KCQkJCW9TZXR0aW5ncy5hc0Rlc3Ryb3lTdHJpcGVzID0gWyAnJywgJycgXTsKCQkJCWlmICggJChhblJvd3NbMF0pLmhhc0NsYXNzKG9TZXR0aW5ncy5vQ2xhc3Nlcy5zU3RyaXBlT2RkKSApCgkJCQl7CgkJCQkJb1NldHRpbmdzLmFzRGVzdHJveVN0cmlwZXNbMF0gKz0gb1NldHRpbmdzLm9DbGFzc2VzLnNTdHJpcGVPZGQrIiAiOwoJCQkJfQoJCQkJaWYgKCAkKGFuUm93c1swXSkuaGFzQ2xhc3Mob1NldHRpbmdzLm9DbGFzc2VzLnNTdHJpcGVFdmVuKSApCgkJCQl7CgkJCQkJb1NldHRpbmdzLmFzRGVzdHJveVN0cmlwZXNbMF0gKz0gb1NldHRpbmdzLm9DbGFzc2VzLnNTdHJpcGVFdmVuOwoJCQkJfQoJCQkJaWYgKCAkKGFuUm93c1sxXSkuaGFzQ2xhc3Mob1NldHRpbmdzLm9DbGFzc2VzLnNTdHJpcGVPZGQpICkKCQkJCXsKCQkJCQlvU2V0dGluZ3MuYXNEZXN0cm95U3RyaXBlc1sxXSArPSBvU2V0dGluZ3Mub0NsYXNzZXMuc1N0cmlwZU9kZCsiICI7CgkJCQl9CgkJCQlpZiAoICQoYW5Sb3dzWzFdKS5oYXNDbGFzcyhvU2V0dGluZ3Mub0NsYXNzZXMuc1N0cmlwZUV2ZW4pICkKCQkJCXsKCQkJCQlvU2V0dGluZ3MuYXNEZXN0cm95U3RyaXBlc1sxXSArPSBvU2V0dGluZ3Mub0NsYXNzZXMuc1N0cmlwZUV2ZW47CgkJCQl9CgkJCQkKCQkJCWFuUm93cy5yZW1vdmVDbGFzcyggb1NldHRpbmdzLmFzU3RyaXBlQ2xhc3Nlcy5qb2luKCcgJykgKTsKCQkJfQoJCQkKCQkJCgkJCS8qCgkJCSAqIENvbHVtbnMKCQkJICogU2VlIGlmIHdlIHNob3VsZCBsb2FkIGNvbHVtbnMgYXV0b21hdGljYWxseSBvciB1c2UgZGVmaW5lZCBvbmVzCgkJCSAqLwoJCQl2YXIgYW5UaHMgPSBbXTsKCQkJdmFyIGFvQ29sdW1uc0luaXQ7CgkJCXZhciBuVGhlYWQgPSB0aGlzLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0aGVhZCcpOwoJCQlpZiAoIG5UaGVhZC5sZW5ndGggIT09IDAgKQoJCQl7CgkJCQlfZm5EZXRlY3RIZWFkZXIoIG9TZXR0aW5ncy5hb0hlYWRlciwgblRoZWFkWzBdICk7CgkJCQlhblRocyA9IF9mbkdldFVuaXF1ZVRocyggb1NldHRpbmdzICk7CgkJCX0KCQkJCgkJCS8qIElmIG5vdCBnaXZlbiBhIGNvbHVtbiBhcnJheSwgZ2VuZXJhdGUgb25lIHdpdGggbnVsbHMgKi8KCQkJaWYgKCBvSW5pdC5hb0NvbHVtbnMgPT09IG51bGwgKQoJCQl7CgkJCQlhb0NvbHVtbnNJbml0ID0gW107CgkJCQlmb3IgKCBpPTAsIGlMZW49YW5UaHMubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkKCQkJCXsKCQkJCQlhb0NvbHVtbnNJbml0LnB1c2goIG51bGwgKTsKCQkJCX0KCQkJfQoJCQllbHNlCgkJCXsKCQkJCWFvQ29sdW1uc0luaXQgPSBvSW5pdC5hb0NvbHVtbnM7CgkJCX0KCQkJCgkJCS8qIEFkZCB0aGUgY29sdW1ucyAqLwoJCQlmb3IgKCBpPTAsIGlMZW49YW9Db2x1bW5zSW5pdC5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQkvKiBTaG9ydCBjdXQgLSB1c2UgdGhlIGxvb3AgdG8gY2hlY2sgaWYgd2UgaGF2ZSBjb2x1bW4gdmlzaWJpbGl0eSBzdGF0ZSB0byByZXN0b3JlICovCgkJCQlpZiAoIG9Jbml0LnNhdmVkX2FvQ29sdW1ucyAhPT0gdW5kZWZpbmVkICYmIG9Jbml0LnNhdmVkX2FvQ29sdW1ucy5sZW5ndGggPT0gaUxlbiApCgkJCQl7CgkJCQkJaWYgKCBhb0NvbHVtbnNJbml0W2ldID09PSBudWxsICkKCQkJCQl7CgkJCQkJCWFvQ29sdW1uc0luaXRbaV0gPSB7fTsKCQkJCQl9CgkJCQkJYW9Db2x1bW5zSW5pdFtpXS5iVmlzaWJsZSA9IG9Jbml0LnNhdmVkX2FvQ29sdW1uc1tpXS5iVmlzaWJsZTsKCQkJCX0KCQkJCQoJCQkJX2ZuQWRkQ29sdW1uKCBvU2V0dGluZ3MsIGFuVGhzID8gYW5UaHNbaV0gOiBudWxsICk7CgkJCX0KCQkJCgkJCS8qIEFwcGx5IHRoZSBjb2x1bW4gZGVmaW5pdGlvbnMgKi8KCQkJX2ZuQXBwbHlDb2x1bW5EZWZzKCBvU2V0dGluZ3MsIG9Jbml0LmFvQ29sdW1uRGVmcywgYW9Db2x1bW5zSW5pdCwgZnVuY3Rpb24gKGlDb2wsIG9EZWYpIHsKCQkJCV9mbkNvbHVtbk9wdGlvbnMoIG9TZXR0aW5ncywgaUNvbCwgb0RlZiApOwoJCQl9ICk7CgkJCQoJCQkKCQkJLyoKCQkJICogU29ydGluZwoJCQkgKiBDaGVjayB0aGUgYWFTb3J0aW5nIGFycmF5CgkJCSAqLwoJCQlmb3IgKCBpPTAsIGlMZW49b1NldHRpbmdzLmFhU29ydGluZy5sZW5ndGggOyBpPGlMZW4gOyBpKysgKQoJCQl7CgkJCQlpZiAoIG9TZXR0aW5ncy5hYVNvcnRpbmdbaV1bMF0gPj0gb1NldHRpbmdzLmFvQ29sdW1ucy5sZW5ndGggKQoJCQkJewoJCQkJCW9TZXR0aW5ncy5hYVNvcnRpbmdbaV1bMF0gPSAwOwoJCQkJfQoJCQkJdmFyIG9Db2x1bW4gPSBvU2V0dGluZ3MuYW9Db2x1bW5zWyBvU2V0dGluZ3MuYWFTb3J0aW5nW2ldWzBdIF07CgkJCQkKCQkJCS8qIEFkZCBhIGRlZmF1bHQgc29ydGluZyBpbmRleCAqLwoJCQkJaWYgKCBvU2V0dGluZ3MuYWFTb3J0aW5nW2ldWzJdID09PSB1bmRlZmluZWQgKQoJCQkJewoJCQkJCW9TZXR0aW5ncy5hYVNvcnRpbmdbaV1bMl0gPSAwOwoJCQkJfQoJCQkJCgkJCQkvKiBJZiBhYVNvcnRpbmcgaXMgbm90IGRlZmluZWQsIHRoZW4gd2UgdXNlIHRoZSBmaXJzdCBpbmRpY2F0b3IgaW4gYXNTb3J0aW5nICovCgkJCQlpZiAoIG9Jbml0LmFhU29ydGluZyA9PT0gdW5kZWZpbmVkICYmIG9TZXR0aW5ncy5zYXZlZF9hYVNvcnRpbmcgPT09IHVuZGVmaW5lZCApCgkJCQl7CgkJCQkJb1NldHRpbmdzLmFhU29ydGluZ1tpXVsxXSA9IG9Db2x1bW4uYXNTb3J0aW5nWzBdOwoJCQkJfQoJCQkJCgkJCQkvKiBTZXQgdGhlIGN1cnJlbnQgc29ydGluZyBpbmRleCBiYXNlZCBvbiBhb0NvbHVtbnMuYXNTb3J0aW5nICovCgkJCQlmb3IgKCBqPTAsIGpMZW49b0NvbHVtbi5hc1NvcnRpbmcubGVuZ3RoIDsgajxqTGVuIDsgaisrICkKCQkJCXsKCQkJCQlpZiAoIG9TZXR0aW5ncy5hYVNvcnRpbmdbaV1bMV0gPT0gb0NvbHVtbi5hc1NvcnRpbmdbal0gKQoJCQkJCXsKCQkJCQkJb1NldHRpbmdzLmFhU29ydGluZ1tpXVsyXSA9IGo7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCQkJCX0KCQkJfQoJCQkJCgkJCS8qIERvIGEgZmlyc3QgcGFzcyBvbiB0aGUgc29ydGluZyBjbGFzc2VzIChhbGxvd3MgYW55IHNpemUgY2hhbmdlcyB0byBiZSB0YWtlbiBpbnRvCgkJCSAqIGFjY291bnQsIGFuZCBhbHNvIHdpbGwgYXBwbHkgc29ydGluZyBkaXNhYmxlZCBjbGFzc2VzIGlmIGRpc2FibGVkCgkJCSAqLwoJCQlfZm5Tb3J0aW5nQ2xhc3Nlcyggb1NldHRpbmdzICk7CgkJCQoJCQkKCQkJLyoKCQkJICogRmluYWwgaW5pdAoJCQkgKiBDYWNoZSB0aGUgaGVhZGVyLCBib2R5IGFuZCBmb290ZXIgYXMgcmVxdWlyZWQsIGNyZWF0aW5nIHRoZW0gaWYgbmVlZGVkCgkJCSAqLwoJCQkKCQkJLy8gV29yayBhcm91bmQgZm9yIFdlYmtpdCBidWcgODM4NjcgLSBzdG9yZSB0aGUgY2FwdGlvbi1zaWRlIGJlZm9yZSByZW1vdmluZyBmcm9tIGRvYwoJCQl2YXIgY2FwdGlvbnMgPSAkKHRoaXMpLmNoaWxkcmVuKCdjYXB0aW9uJykuZWFjaCggZnVuY3Rpb24gKCkgewoJCQkJdGhpcy5fY2FwdGlvblNpZGUgPSAkKHRoaXMpLmNzcygnY2FwdGlvbi1zaWRlJyk7CgkJCX0gKTsKCQkJCgkJCXZhciB0aGVhZCA9ICQodGhpcykuY2hpbGRyZW4oJ3RoZWFkJyk7CgkJCWlmICggdGhlYWQubGVuZ3RoID09PSAwICkKCQkJewoJCQkJdGhlYWQgPSBbIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICd0aGVhZCcgKSBdOwoJCQkJdGhpcy5hcHBlbmRDaGlsZCggdGhlYWRbMF0gKTsKCQkJfQoJCQlvU2V0dGluZ3MublRIZWFkID0gdGhlYWRbMF07CgkJCQoJCQl2YXIgdGJvZHkgPSAkKHRoaXMpLmNoaWxkcmVuKCd0Ym9keScpOwoJCQlpZiAoIHRib2R5Lmxlbmd0aCA9PT0gMCApCgkJCXsKCQkJCXRib2R5ID0gWyBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAndGJvZHknICkgXTsKCQkJCXRoaXMuYXBwZW5kQ2hpbGQoIHRib2R5WzBdICk7CgkJCX0KCQkJb1NldHRpbmdzLm5UQm9keSA9IHRib2R5WzBdOwoJCQlvU2V0dGluZ3MublRCb2R5LnNldEF0dHJpYnV0ZSggInJvbGUiLCAiYWxlcnQiICk7CgkJCW9TZXR0aW5ncy5uVEJvZHkuc2V0QXR0cmlidXRlKCAiYXJpYS1saXZlIiwgInBvbGl0ZSIgKTsKCQkJb1NldHRpbmdzLm5UQm9keS5zZXRBdHRyaWJ1dGUoICJhcmlhLXJlbGV2YW50IiwgImFsbCIgKTsKCQkJCgkJCXZhciB0Zm9vdCA9ICQodGhpcykuY2hpbGRyZW4oJ3Rmb290Jyk7CgkJCWlmICggdGZvb3QubGVuZ3RoID09PSAwICYmIGNhcHRpb25zLmxlbmd0aCA+IDAgJiYgKG9TZXR0aW5ncy5vU2Nyb2xsLnNYICE9PSAiIiB8fCBvU2V0dGluZ3Mub1Njcm9sbC5zWSAhPT0gIiIpICkKCQkJewoJCQkJLy8gSWYgd2UgYXJlIGEgc2Nyb2xsaW5nIHRhYmxlLCBhbmQgbm8gZm9vdGVyIGhhcyBiZWVuIGdpdmVuLCB0aGVuIHdlIG5lZWQgdG8gY3JlYXRlCgkJCQkvLyBhIHRmb290IGVsZW1lbnQgZm9yIHRoZSBjYXB0aW9uIGVsZW1lbnQgdG8gYmUgYXBwZW5kZWQgdG8KCQkJCXRmb290ID0gWyBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAndGZvb3QnICkgXTsKCQkJCXRoaXMuYXBwZW5kQ2hpbGQoIHRmb290WzBdICk7CgkJCX0KCQkJCgkJCWlmICggdGZvb3QubGVuZ3RoID4gMCApCgkJCXsKCQkJCW9TZXR0aW5ncy5uVEZvb3QgPSB0Zm9vdFswXTsKCQkJCV9mbkRldGVjdEhlYWRlciggb1NldHRpbmdzLmFvRm9vdGVyLCBvU2V0dGluZ3MublRGb290ICk7CgkJCX0KCQkJCgkJCS8qIENoZWNrIGlmIHRoZXJlIGlzIGRhdGEgcGFzc2luZyBpbnRvIHRoZSBjb25zdHJ1Y3RvciAqLwoJCQlpZiAoIGJVc2VQYXNzZWREYXRhICkKCQkJewoJCQkJZm9yICggaT0wIDsgaTxvSW5pdC5hYURhdGEubGVuZ3RoIDsgaSsrICkKCQkJCXsKCQkJCQlfZm5BZGREYXRhKCBvU2V0dGluZ3MsIG9Jbml0LmFhRGF0YVsgaSBdICk7CgkJCQl9CgkJCX0KCQkJZWxzZQoJCQl7CgkJCQkvKiBHcmFiIHRoZSBkYXRhIGZyb20gdGhlIHBhZ2UgKi8KCQkJCV9mbkdhdGhlckRhdGEoIG9TZXR0aW5ncyApOwoJCQl9CgkJCQoJCQkvKiBDb3B5IHRoZSBkYXRhIGluZGV4IGFycmF5ICovCgkJCW9TZXR0aW5ncy5haURpc3BsYXkgPSBvU2V0dGluZ3MuYWlEaXNwbGF5TWFzdGVyLnNsaWNlKCk7CgkJCQoJCQkvKiBJbml0aWFsaXNhdGlvbiBjb21wbGV0ZSAtIHRhYmxlIGNhbiBiZSBkcmF3biAqLwoJCQlvU2V0dGluZ3MuYkluaXRpYWxpc2VkID0gdHJ1ZTsKCQkJCgkJCS8qIENoZWNrIGlmIHdlIG5lZWQgdG8gaW5pdGlhbGlzZSB0aGUgdGFibGUgKGl0IG1pZ2h0IG5vdCBoYXZlIGJlZW4gaGFuZGVkIG9mZiB0byB0aGUKCQkJICogbGFuZ3VhZ2UgcHJvY2Vzc29yKQoJCQkgKi8KCQkJaWYgKCBiSW5pdEhhbmRlZE9mZiA9PT0gZmFsc2UgKQoJCQl7CgkJCQlfZm5Jbml0aWFsaXNlKCBvU2V0dGluZ3MgKTsKCQkJfQoJCX0gKTsKCX07CgoJCgkKCS8qKgoJICogUHJvdmlkZSBhIGNvbW1vbiBtZXRob2QgZm9yIHBsdWctaW5zIHRvIGNoZWNrIHRoZSB2ZXJzaW9uIG9mIERhdGFUYWJsZXMgYmVpbmcgdXNlZCwgaW4gb3JkZXIKCSAqIHRvIGVuc3VyZSBjb21wYXRpYmlsaXR5LgoJICogIEBwYXJhbSB7c3RyaW5nfSBzVmVyc2lvbiBWZXJzaW9uIHN0cmluZyB0byBjaGVjayBmb3IsIGluIHRoZSBmb3JtYXQgIlguWS5aIi4gTm90ZSB0aGF0IHRoZQoJICogICAgZm9ybWF0cyAiWCIgYW5kICJYLlkiIGFyZSBhbHNvIGFjY2VwdGFibGUuCgkgKiAgQHJldHVybnMge2Jvb2xlYW59IHRydWUgaWYgdGhpcyB2ZXJzaW9uIG9mIERhdGFUYWJsZXMgaXMgZ3JlYXRlciBvciBlcXVhbCB0byB0aGUgcmVxdWlyZWQKCSAqICAgIHZlcnNpb24sIG9yIGZhbHNlIGlmIHRoaXMgdmVyc2lvbiBvZiBEYXRhVGFsZXMgaXMgbm90IHN1aXRhYmxlCgkgKiAgQHN0YXRpYwoJICogIEBkdG9wdCBBUEktU3RhdGljCgkgKgoJICogIEBleGFtcGxlCgkgKiAgICBhbGVydCggJC5mbi5kYXRhVGFibGUuZm5WZXJzaW9uQ2hlY2soICcxLjkuMCcgKSApOwoJICovCglEYXRhVGFibGUuZm5WZXJzaW9uQ2hlY2sgPSBmdW5jdGlvbiggc1ZlcnNpb24gKQoJewoJCS8qIFRoaXMgaXMgY2hlYXAsIGJ1dCBlZmZlY3RpdmUgKi8KCQl2YXIgZm5aUGFkID0gZnVuY3Rpb24gKFpwYWQsIGNvdW50KQoJCXsKCQkJd2hpbGUoWnBhZC5sZW5ndGggPCBjb3VudCkgewoJCQkJWnBhZCArPSAnMCc7CgkJCX0KCQkJcmV0dXJuIFpwYWQ7CgkJfTsKCQl2YXIgYVRoaXMgPSBEYXRhVGFibGUuZXh0LnNWZXJzaW9uLnNwbGl0KCcuJyk7CgkJdmFyIGFUaGF0ID0gc1ZlcnNpb24uc3BsaXQoJy4nKTsKCQl2YXIgc1RoaXMgPSAnJywgc1RoYXQgPSAnJzsKCQkKCQlmb3IgKCB2YXIgaT0wLCBpTGVuPWFUaGF0Lmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJewoJCQlzVGhpcyArPSBmblpQYWQoIGFUaGlzW2ldLCAzICk7CgkJCXNUaGF0ICs9IGZuWlBhZCggYVRoYXRbaV0sIDMgKTsKCQl9CgkJCgkJcmV0dXJuIHBhcnNlSW50KHNUaGlzLCAxMCkgPj0gcGFyc2VJbnQoc1RoYXQsIDEwKTsKCX07CgkKCQoJLyoqCgkgKiBDaGVjayBpZiBhIFRBQkxFIG5vZGUgaXMgYSBEYXRhVGFibGUgdGFibGUgYWxyZWFkeSBvciBub3QuCgkgKiAgQHBhcmFtIHtub2RlfSBuVGFibGUgVGhlIFRBQkxFIG5vZGUgdG8gY2hlY2sgaWYgaXQgaXMgYSBEYXRhVGFibGUgb3Igbm90IChub3RlIHRoYXQgb3RoZXIKCSAqICAgIG5vZGUgdHlwZXMgY2FuIGJlIHBhc3NlZCBpbiwgYnV0IHdpbGwgYWx3YXlzIHJldHVybiBmYWxzZSkuCgkgKiAgQHJldHVybnMge2Jvb2xlYW59IHRydWUgdGhlIHRhYmxlIGdpdmVuIGlzIGEgRGF0YVRhYmxlLCBvciBmYWxzZSBvdGhlcndpc2UKCSAqICBAc3RhdGljCgkgKiAgQGR0b3B0IEFQSS1TdGF0aWMKCSAqCgkgKiAgQGV4YW1wbGUKCSAqICAgIHZhciBleCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdleGFtcGxlJyk7CgkgKiAgICBpZiAoICEgJC5mbi5EYXRhVGFibGUuZm5Jc0RhdGFUYWJsZSggZXggKSApIHsKCSAqICAgICAgJChleCkuZGF0YVRhYmxlKCk7CgkgKiAgICB9CgkgKi8KCURhdGFUYWJsZS5mbklzRGF0YVRhYmxlID0gZnVuY3Rpb24gKCBuVGFibGUgKQoJewoJCXZhciBvID0gRGF0YVRhYmxlLnNldHRpbmdzOwoJCgkJZm9yICggdmFyIGk9MCA7IGk8by5sZW5ndGggOyBpKysgKQoJCXsKCQkJaWYgKCBvW2ldLm5UYWJsZSA9PT0gblRhYmxlIHx8IG9baV0ublNjcm9sbEhlYWQgPT09IG5UYWJsZSB8fCBvW2ldLm5TY3JvbGxGb290ID09PSBuVGFibGUgKQoJCQl7CgkJCQlyZXR1cm4gdHJ1ZTsKCQkJfQoJCX0KCQoJCXJldHVybiBmYWxzZTsKCX07CgkKCQoJLyoqCgkgKiBHZXQgYWxsIERhdGFUYWJsZSB0YWJsZXMgdGhhdCBoYXZlIGJlZW4gaW5pdGlhbGlzZWQgLSBvcHRpb25hbGx5IHlvdSBjYW4gc2VsZWN0IHRvCgkgKiBnZXQgb25seSBjdXJyZW50bHkgdmlzaWJsZSB0YWJsZXMuCgkgKiAgQHBhcmFtIHtib29sZWFufSBbYlZpc2libGU9ZmFsc2VdIEZsYWcgdG8gaW5kaWNhdGUgaWYgeW91IHdhbnQgYWxsIChkZWZhdWx0KSBvciAKCSAqICAgIHZpc2libGUgdGFibGVzIG9ubHkuCgkgKiAgQHJldHVybnMge2FycmF5fSBBcnJheSBvZiBUQUJMRSBub2RlcyAobm90IERhdGFUYWJsZSBpbnN0YW5jZXMpIHdoaWNoIGFyZSBEYXRhVGFibGVzCgkgKiAgQHN0YXRpYwoJICogIEBkdG9wdCBBUEktU3RhdGljCgkgKgoJICogIEBleGFtcGxlCgkgKiAgICB2YXIgdGFibGUgPSAkLmZuLmRhdGFUYWJsZS5mblRhYmxlcyh0cnVlKTsKCSAqICAgIGlmICggdGFibGUubGVuZ3RoID4gMCApIHsKCSAqICAgICAgJCh0YWJsZSkuZGF0YVRhYmxlKCkuZm5BZGp1c3RDb2x1bW5TaXppbmcoKTsKCSAqICAgIH0KCSAqLwoJRGF0YVRhYmxlLmZuVGFibGVzID0gZnVuY3Rpb24gKCBiVmlzaWJsZSApCgl7CgkJdmFyIG91dCA9IFtdOwoJCgkJalF1ZXJ5LmVhY2goIERhdGFUYWJsZS5zZXR0aW5ncywgZnVuY3Rpb24gKGksIG8pIHsKCQkJaWYgKCAhYlZpc2libGUgfHwgKGJWaXNpYmxlID09PSB0cnVlICYmICQoby5uVGFibGUpLmlzKCc6dmlzaWJsZScpKSApCgkJCXsKCQkJCW91dC5wdXNoKCBvLm5UYWJsZSApOwoJCQl9CgkJfSApOwoJCgkJcmV0dXJuIG91dDsKCX07CgkKCgkvKioKCSAqIFZlcnNpb24gc3RyaW5nIGZvciBwbHVnLWlucyB0byBjaGVjayBjb21wYXRpYmlsaXR5LiBBbGxvd2VkIGZvcm1hdCBpcwoJICogYS5iLmMuZC5lIHdoZXJlOiBhOmludCwgYjppbnQsIGM6aW50LCBkOnN0cmluZyhkZXZ8YmV0YSksIGU6aW50LiBkIGFuZAoJICogZSBhcmUgb3B0aW9uYWwKCSAqICBAbWVtYmVyCgkgKiAgQHR5cGUgc3RyaW5nCgkgKiAgQGRlZmF1bHQgVmVyc2lvbiBudW1iZXIKCSAqLwoJRGF0YVRhYmxlLnZlcnNpb24gPSAiMS45LjIiOwoKCS8qKgoJICogUHJpdmF0ZSBkYXRhIHN0b3JlLCBjb250YWluaW5nIGFsbCBvZiB0aGUgc2V0dGluZ3Mgb2JqZWN0cyB0aGF0IGFyZSBjcmVhdGVkIGZvciB0aGUKCSAqIHRhYmxlcyBvbiBhIGdpdmVuIHBhZ2UuCgkgKiAKCSAqIE5vdGUgdGhhdCB0aGUgPGk+RGF0YVRhYmxlLnNldHRpbmdzPC9pPiBvYmplY3QgaXMgYWxpYXNlZCB0byA8aT5qUXVlcnkuZm4uZGF0YVRhYmxlRXh0PC9pPiAKCSAqIHRocm91Z2ggd2hpY2ggaXQgbWF5IGJlIGFjY2Vzc2VkIGFuZCBtYW5pcHVsYXRlZCwgb3IgPGk+alF1ZXJ5LmZuLmRhdGFUYWJsZS5zZXR0aW5nczwvaT4uCgkgKiAgQG1lbWJlcgoJICogIEB0eXBlIGFycmF5CgkgKiAgQGRlZmF1bHQgW10KCSAqICBAcHJpdmF0ZQoJICovCglEYXRhVGFibGUuc2V0dGluZ3MgPSBbXTsKCgkvKioKCSAqIE9iamVjdCBtb2RlbHMgY29udGFpbmVyLCBmb3IgdGhlIHZhcmlvdXMgbW9kZWxzIHRoYXQgRGF0YVRhYmxlcyBoYXMgYXZhaWxhYmxlCgkgKiB0byBpdC4gVGhlc2UgbW9kZWxzIGRlZmluZSB0aGUgb2JqZWN0cyB0aGF0IGFyZSB1c2VkIHRvIGhvbGQgdGhlIGFjdGl2ZSBzdGF0ZSAKCSAqIGFuZCBjb25maWd1cmF0aW9uIG9mIHRoZSB0YWJsZS4KCSAqICBAbmFtZXNwYWNlCgkgKi8KCURhdGFUYWJsZS5tb2RlbHMgPSB7fTsKCQoJCgkvKioKCSAqIERhdGFUYWJsZXMgZXh0ZW5zaW9uIG9wdGlvbnMgYW5kIHBsdWctaW5zLiBUaGlzIG5hbWVzcGFjZSBhY3RzIGFzIGEgY29sbGVjdGlvbiAiYXJlYSIKCSAqIGZvciBwbHVnLWlucyB0aGF0IGNhbiBiZSB1c2VkIHRvIGV4dGVuZCB0aGUgZGVmYXVsdCBEYXRhVGFibGVzIGJlaGF2aW91ciAtIGluZGVlZCBtYW55CgkgKiBvZiB0aGUgYnVpbGQgaW4gbWV0aG9kcyB1c2UgdGhpcyBtZXRob2QgdG8gcHJvdmlkZSB0aGVpciBvd24gY2FwYWJpbGl0aWVzIChzb3J0aW5nIG1ldGhvZHMKCSAqIGZvciBleGFtcGxlKS4KCSAqIAoJICogTm90ZSB0aGF0IHRoaXMgbmFtZXNwYWNlIGlzIGFsaWFzZWQgdG8galF1ZXJ5LmZuLmRhdGFUYWJsZUV4dCBzbyBpdCBjYW4gYmUgcmVhZGlseSBhY2Nlc3NlZAoJICogYW5kIG1vZGlmaWVkIGJ5IHBsdWctaW5zLgoJICogIEBuYW1lc3BhY2UKCSAqLwoJRGF0YVRhYmxlLm1vZGVscy5leHQgPSB7CgkJLyoqCgkJICogUGx1Zy1pbiBmaWx0ZXJpbmcgZnVuY3Rpb25zIC0gdGhpcyBtZXRob2Qgb2YgZmlsdGVyaW5nIGlzIGNvbXBsaW1lbnRhcnkgdG8gdGhlIGRlZmF1bHQKCQkgKiB0eXBlIGJhc2VkIGZpbHRlcmluZywgYW5kIGEgbG90IG1vcmUgY29tcHJlaGVuc2l2ZSBhcyBpdCBhbGxvd3MgeW91IGNvbXBsZXRlIGNvbnRyb2wKCQkgKiBvdmVyIHRoZSBmaWx0ZXJpbmcgbG9naWMuIEVhY2ggZWxlbWVudCBpbiB0aGlzIGFycmF5IGlzIGEgZnVuY3Rpb24gKHBhcmFtZXRlcnMKCQkgKiBkZXNjcmliZWQgYmVsb3cpIHRoYXQgaXMgY2FsbGVkIGZvciBldmVyeSByb3cgaW4gdGhlIHRhYmxlLCBhbmQgeW91ciBsb2dpYyBkZWNpZGVzIGlmCgkJICogaXQgc2hvdWxkIGJlIGluY2x1ZGVkIGluIHRoZSBmaWx0ZXJlZCBkYXRhIHNldCBvciBub3QuCgkJICogICA8dWw+CgkJICogICAgIDxsaT4KCQkgKiAgICAgICBGdW5jdGlvbiBpbnB1dCBwYXJhbWV0ZXJzOgoJCSAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT57b2JqZWN0fSBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdDogc2VlIHtAbGluayBEYXRhVGFibGUubW9kZWxzLm9TZXR0aW5nc30uPC9saT4KCQkgKiAgICAgICAgIDxsaT57YXJyYXl8b2JqZWN0fSBEYXRhIGZvciB0aGUgcm93IHRvIGJlIHByb2Nlc3NlZCAoc2FtZSBhcyB0aGUgb3JpZ2luYWwgZm9ybWF0CgkJICogICAgICAgICAgIHRoYXQgd2FzIHBhc3NlZCBpbiBhcyB0aGUgZGF0YSBzb3VyY2UsIG9yIGFuIGFycmF5IGZyb20gYSBET00gZGF0YSBzb3VyY2U8L2xpPgoJCSAqICAgICAgICAgPGxpPntpbnR9IFJvdyBpbmRleCBpbiBhb0RhdGEgKHtAbGluayBEYXRhVGFibGUubW9kZWxzLm9TZXR0aW5ncy5hb0RhdGF9KSwgd2hpY2ggY2FuCgkJICogICAgICAgICAgIGJlIHVzZWZ1bCB0byByZXRyaWV2ZSB0aGUgVFIgZWxlbWVudCBpZiB5b3UgbmVlZCBET00gaW50ZXJhY3Rpb24uPC9saT4KCQkgKiAgICAgICA8L3VsPgoJCSAqICAgICA8L2xpPgoJCSAqICAgICA8bGk+CgkJICogICAgICAgRnVuY3Rpb24gcmV0dXJuOgoJCSAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT57Ym9vbGVhbn0gSW5jbHVkZSB0aGUgcm93IGluIHRoZSBmaWx0ZXJlZCByZXN1bHQgc2V0ICh0cnVlKSBvciBub3QgKGZhbHNlKTwvbGk+CgkJICogICAgICAgPC91bD4KCQkgKiAgICAgPC9pbD4KCQkgKiAgIDwvdWw+CgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBUaGUgZm9sbG93aW5nIGV4YW1wbGUgc2hvd3MgY3VzdG9tIGZpbHRlcmluZyBiZWluZyBhcHBsaWVkIHRvIHRoZSBmb3VydGggY29sdW1uIChpLmUuCgkJICogICAgLy8gdGhlIGFEYXRhWzNdIGluZGV4KSBiYXNlZCBvbiB0d28gaW5wdXQgdmFsdWVzIGZyb20gdGhlIGVuZC11c2VyLCBtYXRjaGluZyB0aGUgZGF0YSBpbiAKCQkgKiAgICAvLyBhIGNlcnRhaW4gcmFuZ2UuCgkJICogICAgJC5mbi5kYXRhVGFibGVFeHQuYWZuRmlsdGVyaW5nLnB1c2goCgkJICogICAgICBmdW5jdGlvbiggb1NldHRpbmdzLCBhRGF0YSwgaURhdGFJbmRleCApIHsKCQkgKiAgICAgICAgdmFyIGlNaW4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWluJykudmFsdWUgKiAxOwoJCSAqICAgICAgICB2YXIgaU1heCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXgnKS52YWx1ZSAqIDE7CgkJICogICAgICAgIHZhciBpVmVyc2lvbiA9IGFEYXRhWzNdID09ICItIiA/IDAgOiBhRGF0YVszXSoxOwoJCSAqICAgICAgICBpZiAoIGlNaW4gPT0gIiIgJiYgaU1heCA9PSAiIiApIHsKCQkgKiAgICAgICAgICByZXR1cm4gdHJ1ZTsKCQkgKiAgICAgICAgfQoJCSAqICAgICAgICBlbHNlIGlmICggaU1pbiA9PSAiIiAmJiBpVmVyc2lvbiA8IGlNYXggKSB7CgkJICogICAgICAgICAgcmV0dXJuIHRydWU7CgkJICogICAgICAgIH0KCQkgKiAgICAgICAgZWxzZSBpZiAoIGlNaW4gPCBpVmVyc2lvbiAmJiAiIiA9PSBpTWF4ICkgewoJCSAqICAgICAgICAgIHJldHVybiB0cnVlOwoJCSAqICAgICAgICB9CgkJICogICAgICAgIGVsc2UgaWYgKCBpTWluIDwgaVZlcnNpb24gJiYgaVZlcnNpb24gPCBpTWF4ICkgewoJCSAqICAgICAgICAgIHJldHVybiB0cnVlOwoJCSAqICAgICAgICB9CgkJICogICAgICAgIHJldHVybiBmYWxzZTsKCQkgKiAgICAgIH0KCQkgKiAgICApOwoJCSAqLwoJCSJhZm5GaWx0ZXJpbmciOiBbXSwKCQoJCgkJLyoqCgkJICogUGx1Zy1pbiBzb3J0aW5nIGZ1bmN0aW9ucyAtIHRoaXMgbWV0aG9kIG9mIHNvcnRpbmcgaXMgY29tcGxpbWVudGFyeSB0byB0aGUgZGVmYXVsdCB0eXBlCgkJICogYmFzZWQgc29ydGluZyB0aGF0IERhdGFUYWJsZXMgZG9lcyBhdXRvbWF0aWNhbGx5LCBhbGxvd2luZyBtdWNoIGdyZWF0ZXIgY29udHJvbCBvdmVyIHRoZQoJCSAqIHRoZSBkYXRhIHRoYXQgaXMgYmVpbmcgdXNlZCB0byBzb3J0IGEgY29sdW1uLiBUaGlzIGlzIHVzZWZ1bCBpZiB5b3Ugd2FudCB0byBkbyBzb3J0aW5nCgkJICogYmFzZWQgb24gbGl2ZSBkYXRhIChmb3IgZXhhbXBsZSB0aGUgY29udGVudHMgb2YgYW4gJ2lucHV0JyBlbGVtZW50KSByYXRoZXIgdGhhbiBqdXN0IHRoZQoJCSAqIHN0YXRpYyBzdHJpbmcgdGhhdCBEYXRhVGFibGVzIGtub3dzIG9mLiBUaGUgd2F5IHRoZXNlIHBsdWctaW5zIHdvcmsgaXMgdGhhdCB5b3UgY3JlYXRlCgkJICogYW4gYXJyYXkgb2YgdGhlIHZhbHVlcyB5b3Ugd2lzaCB0byBiZSBzb3J0ZWQgZm9yIHRoZSBjb2x1bW4gaW4gcXVlc3Rpb24gYW5kIHRoZW4gcmV0dXJuCgkJICogdGhhdCBhcnJheS4gV2hpY2ggcHJlLXNvcnRpbmcgZnVuY3Rpb24gaXMgcnVuIGhlcmUgZGVwZW5kcyBvbiB0aGUgc1NvcnREYXRhVHlwZSBwYXJhbWV0ZXIKCQkgKiB0aGF0IGlzIHVzZWQgZm9yIHRoZSBjb2x1bW4gKGlmIGFueSkuIFRoaXMgaXMgdGhlIGNvcm9sbGFyeSBvZiA8aT5vZm5TZWFyY2g8L2k+IGZvciBzb3J0IAoJCSAqIGRhdGEuCgkJICogICA8dWw+CgkgICAgICogICAgIDxsaT4KCSAgICAgKiAgICAgICBGdW5jdGlvbiBpbnB1dCBwYXJhbWV0ZXJzOgoJICAgICAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT57b2JqZWN0fSBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdDogc2VlIHtAbGluayBEYXRhVGFibGUubW9kZWxzLm9TZXR0aW5nc30uPC9saT4KCSAgICAgKiAgICAgICAgIDxsaT57aW50fSBUYXJnZXQgY29sdW1uIGluZGV4PC9saT4KCSAgICAgKiAgICAgICA8L3VsPgoJICAgICAqICAgICA8L2xpPgoJCSAqICAgICA8bGk+CgkJICogICAgICAgRnVuY3Rpb24gcmV0dXJuOgoJCSAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT57YXJyYXl9IERhdGEgZm9yIHRoZSBjb2x1bW4gdG8gYmUgc29ydGVkIHVwb248L2xpPgoJCSAqICAgICAgIDwvdWw+CgkJICogICAgIDwvaWw+CgkJICogICA8L3VsPgoJCSAqICAKCQkgKiBOb3RlIHRoYXQgYXMgb2YgdjEuOSwgaXQgaXMgdHlwaWNhbGx5IHByZWZlcmFibGUgdG8gdXNlIDxpPm1EYXRhUHJvcDwvaT4gdG8gcHJlcGFyZSBkYXRhIGZvcgoJCSAqIHRoZSBkaWZmZXJlbnQgdXNlcyB0aGF0IERhdGFUYWJsZXMgY2FuIHB1dCB0aGUgZGF0YSB0by4gU3BlY2lmaWNhbGx5IDxpPm1EYXRhUHJvcDwvaT4gd2hlbgoJCSAqIHVzZWQgYXMgYSBmdW5jdGlvbiB3aWxsIGdpdmUgeW91IGEgJ3R5cGUnIChzb3J0aW5nLCBmaWx0ZXJpbmcgZXRjKSB0aGF0IHlvdSBjYW4gdXNlIHRvIAoJCSAqIHByZXBhcmUgdGhlIGRhdGEgYXMgcmVxdWlyZWQgZm9yIHRoZSBkaWZmZXJlbnQgdHlwZXMuIEFzIHN1Y2gsIHRoaXMgbWV0aG9kIGlzIGRlcHJlY2F0ZWQuCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICogIEBkZXByZWNhdGVkCgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVcGRhdGluZyB0aGUgY2FjaGVkIHNvcnRpbmcgaW5mb3JtYXRpb24gd2l0aCB1c2VyIGVudGVyZWQgdmFsdWVzIGluIEhUTUwgaW5wdXQgZWxlbWVudHMKCQkgKiAgICBqUXVlcnkuZm4uZGF0YVRhYmxlRXh0LmFmblNvcnREYXRhWydkb20tdGV4dCddID0gZnVuY3Rpb24gKCBvU2V0dGluZ3MsIGlDb2x1bW4gKQoJCSAqICAgIHsKCQkgKiAgICAgIHZhciBhRGF0YSA9IFtdOwoJCSAqICAgICAgJCggJ3RkOmVxKCcraUNvbHVtbisnKSBpbnB1dCcsIG9TZXR0aW5ncy5vQXBpLl9mbkdldFRyTm9kZXMob1NldHRpbmdzKSApLmVhY2goIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICAgYURhdGEucHVzaCggdGhpcy52YWx1ZSApOwoJCSAqICAgICAgfSApOwoJCSAqICAgICAgcmV0dXJuIGFEYXRhOwoJCSAqICAgIH0KCQkgKi8KCQkiYWZuU29ydERhdGEiOiBbXSwKCQoJCgkJLyoqCgkJICogRmVhdHVyZSBwbHVnLWlucyAtIFRoaXMgaXMgYW4gYXJyYXkgb2Ygb2JqZWN0cyB3aGljaCBkZXNjcmliZSB0aGUgZmVhdHVyZSBwbHVnLWlucyB0aGF0IGFyZQoJCSAqIGF2YWlsYWJsZSB0byBEYXRhVGFibGVzLiBUaGVzZSBmZWF0dXJlIHBsdWctaW5zIGFyZSBhY2Nlc3NpYmxlIHRocm91Z2ggdGhlIHNEb20gaW5pdGlhbGlzYXRpb24KCQkgKiBvcHRpb24uIEFzIHN1Y2gsIGVhY2ggZmVhdHVyZSBwbHVnLWluIG11c3QgZGVzY3JpYmUgYSBmdW5jdGlvbiB0aGF0IGlzIHVzZWQgdG8gaW5pdGlhbGlzZQoJCSAqIGl0c2VsZiAoZm5Jbml0KSwgYSBjaGFyYWN0ZXIgc28gdGhlIGZlYXR1cmUgY2FuIGJlIGVuYWJsZWQgYnkgc0RvbSAoY0ZlYXR1cmUpIGFuZCB0aGUgbmFtZQoJCSAqIG9mIHRoZSBmZWF0dXJlIChzRmVhdHVyZSkuIFRodXMgdGhlIG9iamVjdHMgYXR0YWNoZWQgdG8gdGhpcyBtZXRob2QgbXVzdCBwcm92aWRlOgoJCSAqICAgPHVsPgoJCSAqICAgICA8bGk+e2Z1bmN0aW9ufSBmbkluaXQgSW5pdGlhbGlzYXRpb24gb2YgdGhlIHBsdWctaW4KCQkgKiAgICAgICA8dWw+CgkgICAgICogICAgICAgICA8bGk+CgkgICAgICogICAgICAgICAgIEZ1bmN0aW9uIGlucHV0IHBhcmFtZXRlcnM6CgkgICAgICogICAgICAgICAgIDx1bD4KCQkgKiAgICAgICAgICAgICA8bGk+e29iamVjdH0gRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3Q6IHNlZSB7QGxpbmsgRGF0YVRhYmxlLm1vZGVscy5vU2V0dGluZ3N9LjwvbGk+CgkgICAgICogICAgICAgICAgIDwvdWw+CgkgICAgICogICAgICAgICA8L2xpPgoJCSAqICAgICAgICAgPGxpPgoJCSAqICAgICAgICAgICBGdW5jdGlvbiByZXR1cm46CgkJICogICAgICAgICAgIDx1bD4KCQkgKiAgICAgICAgICAgICA8bGk+e25vZGV8bnVsbH0gVGhlIGVsZW1lbnQgd2hpY2ggY29udGFpbnMgeW91ciBmZWF0dXJlLiBOb3RlIHRoYXQgdGhlIHJldHVybgoJCSAqICAgICAgICAgICAgICAgIG1heSBhbHNvIGJlIHZvaWQgaWYgeW91ciBwbHVnLWluIGRvZXMgbm90IHJlcXVpcmUgdG8gaW5qZWN0IGFueSBET00gZWxlbWVudHMgCgkJICogICAgICAgICAgICAgICAgaW50byBEYXRhVGFibGVzIGNvbnRyb2wgKHNEb20pIC0gZm9yIGV4YW1wbGUgdGhpcyBtaWdodCBiZSB1c2VmdWwgd2hlbiAKCQkgKiAgICAgICAgICAgICAgICBkZXZlbG9waW5nIGEgcGx1Zy1pbiB3aGljaCBhbGxvd3MgdGFibGUgY29udHJvbCB2aWEga2V5Ym9hcmQgZW50cnkuPC9saT4KCQkgKiAgICAgICAgICAgPC91bD4KCQkgKiAgICAgICAgIDwvaWw+CgkJICogICAgICAgPC91bD4KCQkgKiAgICAgPC9saT4KCQkgKiAgICAgPGxpPntjaGFyYWN0ZXJ9IGNGZWF0dXJlIENoYXJhY3RlciB0aGF0IHdpbGwgYmUgbWF0Y2hlZCBpbiBzRG9tIC0gY2FzZSBzZW5zaXRpdmU8L2xpPgoJCSAqICAgICA8bGk+e3N0cmluZ30gc0ZlYXR1cmUgRmVhdHVyZSBuYW1lPC9saT4KCQkgKiAgIDwvdWw+CgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gSG93IFRhYmxlVG9vbHMgaW5pdGlhbGlzZXMgaXRzZWxmLgoJCSAqICAgICQuZm4uZGF0YVRhYmxlRXh0LmFvRmVhdHVyZXMucHVzaCggewoJCSAqICAgICAgImZuSW5pdCI6IGZ1bmN0aW9uKCBvU2V0dGluZ3MgKSB7CgkJICogICAgICAgIHJldHVybiBuZXcgVGFibGVUb29scyggeyAib0RUU2V0dGluZ3MiOiBvU2V0dGluZ3MgfSApOwoJCSAqICAgICAgfSwKCQkgKiAgICAgICJjRmVhdHVyZSI6ICJUIiwKCQkgKiAgICAgICJzRmVhdHVyZSI6ICJUYWJsZVRvb2xzIgoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYW9GZWF0dXJlcyI6IFtdLAoJCgkKCQkvKioKCQkgKiBUeXBlIGRldGVjdGlvbiBwbHVnLWluIGZ1bmN0aW9ucyAtIERhdGFUYWJsZXMgdXRpbGlzZXMgdHlwZXMgdG8gZGVmaW5lIGhvdyBzb3J0aW5nIGFuZAoJCSAqIGZpbHRlcmluZyBiZWhhdmUsIGFuZCB0eXBlcyBjYW4gYmUgZWl0aGVyICBiZSBkZWZpbmVkIGJ5IHRoZSBkZXZlbG9wZXIgKHNUeXBlIGZvciB0aGUKCQkgKiBjb2x1bW4pIG9yIHRoZXkgY2FuIGJlIGF1dG9tYXRpY2FsbHkgZGV0ZWN0ZWQgYnkgdGhlIG1ldGhvZHMgaW4gdGhpcyBhcnJheS4gVGhlIGZ1bmN0aW9ucwoJCSAqIGRlZmluZWQgaW4gdGhlIGFycmF5IGFyZSBxdWl0ZSBzaW1wbGUsIHRha2luZyBhIHNpbmdsZSBwYXJhbWV0ZXIgKHRoZSBkYXRhIHRvIGFuYWx5c2UpIAoJCSAqIGFuZCByZXR1cm5pbmcgdGhlIHR5cGUgaWYgaXQgaXMgYSBrbm93biB0eXBlLCBvciBudWxsIG90aGVyd2lzZS4KCQkgKiAgIDx1bD4KCSAgICAgKiAgICAgPGxpPgoJICAgICAqICAgICAgIEZ1bmN0aW9uIGlucHV0IHBhcmFtZXRlcnM6CgkgICAgICogICAgICAgPHVsPgoJCSAqICAgICAgICAgPGxpPnsqfSBEYXRhIGZyb20gdGhlIGNvbHVtbiBjZWxsIHRvIGJlIGFuYWx5c2VkPC9saT4KCSAgICAgKiAgICAgICA8L3VsPgoJICAgICAqICAgICA8L2xpPgoJCSAqICAgICA8bGk+CgkJICogICAgICAgRnVuY3Rpb24gcmV0dXJuOgoJCSAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT57c3RyaW5nfG51bGx9IERhdGEgdHlwZSBkZXRlY3RlZCwgb3IgbnVsbCBpZiB1bmtub3duIChhbmQgdGh1cyBwYXNzIGl0CgkJICogICAgICAgICAgIG9uIHRvIHRoZSBvdGhlciB0eXBlIGRldGVjdGlvbiBmdW5jdGlvbnMuPC9saT4KCQkgKiAgICAgICA8L3VsPgoJCSAqICAgICA8L2lsPgoJCSAqICAgPC91bD4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKiAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gQ3VycmVuY3kgdHlwZSBkZXRlY3Rpb24gcGx1Zy1pbjoKCQkgKiAgICBqUXVlcnkuZm4uZGF0YVRhYmxlRXh0LmFUeXBlcy5wdXNoKAoJCSAqICAgICAgZnVuY3Rpb24gKCBzRGF0YSApIHsKCQkgKiAgICAgICAgdmFyIHNWYWxpZENoYXJzID0gIjAxMjM0NTY3ODkuLSI7CgkJICogICAgICAgIHZhciBDaGFyOwoJCSAqICAgICAgICAKCQkgKiAgICAgICAgLy8gQ2hlY2sgdGhlIG51bWVyaWMgcGFydAoJCSAqICAgICAgICBmb3IgKCBpPTEgOyBpPHNEYXRhLmxlbmd0aCA7IGkrKyApIHsKCQkgKiAgICAgICAgICBDaGFyID0gc0RhdGEuY2hhckF0KGkpOyAKCQkgKiAgICAgICAgICBpZiAoc1ZhbGlkQ2hhcnMuaW5kZXhPZihDaGFyKSA9PSAtMSkgewoJCSAqICAgICAgICAgICAgcmV0dXJuIG51bGw7CgkJICogICAgICAgICAgfQoJCSAqICAgICAgICB9CgkJICogICAgICAgIAoJCSAqICAgICAgICAvLyBDaGVjayBwcmVmaXhlZCBieSBjdXJyZW5jeQoJCSAqICAgICAgICBpZiAoIHNEYXRhLmNoYXJBdCgwKSA9PSAnJCcgfHwgc0RhdGEuY2hhckF0KDApID09ICcmcG91bmQ7JyApIHsKCQkgKiAgICAgICAgICByZXR1cm4gJ2N1cnJlbmN5JzsKCQkgKiAgICAgICAgfQoJCSAqICAgICAgICByZXR1cm4gbnVsbDsKCQkgKiAgICAgIH0KCQkgKiAgICApOwoJCSAqLwoJCSJhVHlwZXMiOiBbXSwKCQoJCgkJLyoqCgkJICogUHJvdmlkZSBhIGNvbW1vbiBtZXRob2QgZm9yIHBsdWctaW5zIHRvIGNoZWNrIHRoZSB2ZXJzaW9uIG9mIERhdGFUYWJsZXMgYmVpbmcgdXNlZCwgCgkJICogaW4gb3JkZXIgdG8gZW5zdXJlIGNvbXBhdGliaWxpdHkuCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzVmVyc2lvbiBWZXJzaW9uIHN0cmluZyB0byBjaGVjayBmb3IsIGluIHRoZSBmb3JtYXQgIlguWS5aIi4gTm90ZSAKCQkgKiAgICB0aGF0IHRoZSBmb3JtYXRzICJYIiBhbmQgIlguWSIgYXJlIGFsc28gYWNjZXB0YWJsZS4KCQkgKiAgQHJldHVybnMge2Jvb2xlYW59IHRydWUgaWYgdGhpcyB2ZXJzaW9uIG9mIERhdGFUYWJsZXMgaXMgZ3JlYXRlciBvciBlcXVhbCB0byB0aGUgCgkJICogICAgcmVxdWlyZWQgdmVyc2lvbiwgb3IgZmFsc2UgaWYgdGhpcyB2ZXJzaW9uIG9mIERhdGFUYWxlcyBpcyBub3Qgc3VpdGFibGUKCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCk7CgkJICogICAgICBhbGVydCggb1RhYmxlLmZuVmVyc2lvbkNoZWNrKCAnMS45LjAnICkgKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImZuVmVyc2lvbkNoZWNrIjogRGF0YVRhYmxlLmZuVmVyc2lvbkNoZWNrLAoJCgkKCQkvKioKCQkgKiBJbmRleCBmb3Igd2hhdCAndGhpcycgaW5kZXggQVBJIGZ1bmN0aW9ucyBzaG91bGQgdXNlCgkJICogIEB0eXBlIGludAoJCSAqICBAZGVmYXVsdCAwCgkJICovCgkJImlBcGlJbmRleCI6IDAsCgkKCQoJCS8qKgoJCSAqIFByZS1wcm9jZXNzaW5nIG9mIGZpbHRlcmluZyBkYXRhIHBsdWctaW5zIC0gV2hlbiB5b3UgYXNzaWduIHRoZSBzVHlwZSBmb3IgYSBjb2x1bW4KCQkgKiAob3IgaGF2ZSBpdCBhdXRvbWF0aWNhbGx5IGRldGVjdGVkIGZvciB5b3UgYnkgRGF0YVRhYmxlcyBvciBhIHR5cGUgZGV0ZWN0aW9uIHBsdWctaW4pLCAKCQkgKiB5b3Ugd2lsbCB0eXBpY2FsbHkgYmUgdXNpbmcgdGhpcyBmb3IgY3VzdG9tIHNvcnRpbmcsIGJ1dCBpdCBjYW4gYWxzbyBiZSB1c2VkIHRvIHByb3ZpZGUgCgkJICogY3VzdG9tIGZpbHRlcmluZyBieSBhbGxvd2luZyB5b3UgdG8gcHJlLXByb2Nlc3NpbmcgdGhlIGRhdGEgYW5kIHJldHVybmluZyB0aGUgZGF0YSBpbgoJCSAqIHRoZSBmb3JtYXQgdGhhdCBzaG91bGQgYmUgZmlsdGVyZWQgdXBvbi4gVGhpcyBpcyBkb25lIGJ5IGFkZGluZyBmdW5jdGlvbnMgdGhpcyBvYmplY3QgCgkJICogd2l0aCBhIHBhcmFtZXRlciBuYW1lIHdoaWNoIG1hdGNoZXMgdGhlIHNUeXBlIGZvciB0aGF0IHRhcmdldCBjb2x1bW4uIFRoaXMgaXMgdGhlCgkJICogY29yb2xsYXJ5IG9mIDxpPmFmblNvcnREYXRhPC9pPiBmb3IgZmlsdGVyaW5nIGRhdGEuCgkJICogICA8dWw+CgkgICAgICogICAgIDxsaT4KCSAgICAgKiAgICAgICBGdW5jdGlvbiBpbnB1dCBwYXJhbWV0ZXJzOgoJICAgICAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT57Kn0gRGF0YSBmcm9tIHRoZSBjb2x1bW4gY2VsbCB0byBiZSBwcmVwYXJlZCBmb3IgZmlsdGVyaW5nPC9saT4KCSAgICAgKiAgICAgICA8L3VsPgoJICAgICAqICAgICA8L2xpPgoJCSAqICAgICA8bGk+CgkJICogICAgICAgRnVuY3Rpb24gcmV0dXJuOgoJCSAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT57c3RyaW5nfG51bGx9IEZvcm1hdHRlZCBzdHJpbmcgdGhhdCB3aWxsIGJlIHVzZWQgZm9yIHRoZSBmaWx0ZXJpbmcuPC9saT4KCQkgKiAgICAgICA8L3VsPgoJCSAqICAgICA8L2lsPgoJCSAqICAgPC91bD4KCQkgKiAKCQkgKiBOb3RlIHRoYXQgYXMgb2YgdjEuOSwgaXQgaXMgdHlwaWNhbGx5IHByZWZlcmFibGUgdG8gdXNlIDxpPm1EYXRhUHJvcDwvaT4gdG8gcHJlcGFyZSBkYXRhIGZvcgoJCSAqIHRoZSBkaWZmZXJlbnQgdXNlcyB0aGF0IERhdGFUYWJsZXMgY2FuIHB1dCB0aGUgZGF0YSB0by4gU3BlY2lmaWNhbGx5IDxpPm1EYXRhUHJvcDwvaT4gd2hlbgoJCSAqIHVzZWQgYXMgYSBmdW5jdGlvbiB3aWxsIGdpdmUgeW91IGEgJ3R5cGUnIChzb3J0aW5nLCBmaWx0ZXJpbmcgZXRjKSB0aGF0IHlvdSBjYW4gdXNlIHRvIAoJCSAqIHByZXBhcmUgdGhlIGRhdGEgYXMgcmVxdWlyZWQgZm9yIHRoZSBkaWZmZXJlbnQgdHlwZXMuIEFzIHN1Y2gsIHRoaXMgbWV0aG9kIGlzIGRlcHJlY2F0ZWQuCgkJICogIEB0eXBlIG9iamVjdAoJCSAqICBAZGVmYXVsdCB7fQoJCSAqICBAZGVwcmVjYXRlZAoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgJC5mbi5kYXRhVGFibGVFeHQub2ZuU2VhcmNoWyd0aXRsZS1udW1lcmljJ10gPSBmdW5jdGlvbiAoIHNEYXRhICkgewoJCSAqICAgICAgcmV0dXJuIHNEYXRhLnJlcGxhY2UoL1xuL2csIiAiKS5yZXBsYWNlKCAvPC4qPz4vZywgIiIgKTsKCQkgKiAgICB9CgkJICovCgkJIm9mblNlYXJjaCI6IHt9LAoJCgkKCQkvKioKCQkgKiBDb250YWluZXIgZm9yIGFsbCBwcml2YXRlIGZ1bmN0aW9ucyBpbiBEYXRhVGFibGVzIHNvIHRoZXkgY2FuIGJlIGV4cG9zZWQgZXh0ZXJuYWxseQoJCSAqICBAdHlwZSBvYmplY3QKCQkgKiAgQGRlZmF1bHQge30KCQkgKi8KCQkib0FwaSI6IHt9LAoJCgkKCQkvKioKCQkgKiBTdG9yYWdlIGZvciB0aGUgdmFyaW91cyBjbGFzc2VzIHRoYXQgRGF0YVRhYmxlcyB1c2VzCgkJICogIEB0eXBlIG9iamVjdAoJCSAqICBAZGVmYXVsdCB7fQoJCSAqLwoJCSJvU3RkQ2xhc3NlcyI6IHt9LAoJCQoJCgkJLyoqCgkJICogU3RvcmFnZSBmb3IgdGhlIHZhcmlvdXMgY2xhc3NlcyB0aGF0IERhdGFUYWJsZXMgdXNlcyAtIGpRdWVyeSBVSSBzdWl0YWJsZQoJCSAqICBAdHlwZSBvYmplY3QKCQkgKiAgQGRlZmF1bHQge30KCQkgKi8KCQkib0pVSUNsYXNzZXMiOiB7fSwKCQoJCgkJLyoqCgkJICogUGFnaW5hdGlvbiBwbHVnLWluIG1ldGhvZHMgLSBUaGUgc3R5bGUgYW5kIGNvbnRyb2xzIG9mIHRoZSBwYWdpbmF0aW9uIGNhbiBzaWduaWZpY2FudGx5IAoJCSAqIGltcGFjdCBvbiBob3cgdGhlIGVuZCB1c2VyIGludGVyYWN0cyB3aXRoIHRoZSBkYXRhIGluIHlvdXIgdGFibGUsIGFuZCBEYXRhVGFibGVzIGFsbG93cyAKCQkgKiB0aGUgYWRkaXRpb24gb2YgcGFnaW5hdGlvbiBjb250cm9scyBieSBleHRlbmRpbmcgdGhpcyBvYmplY3QsIHdoaWNoIGNhbiB0aGVuIGJlIGVuYWJsZWQKCQkgKiB0aHJvdWdoIHRoZSA8aT5zUGFnaW5hdGlvblR5cGU8L2k+IGluaXRpYWxpc2F0aW9uIHBhcmFtZXRlci4gRWFjaCBwYWdpbmF0aW9uIHR5cGUgdGhhdAoJCSAqIGlzIGFkZGVkIGlzIGFuIG9iamVjdCAodGhlIHByb3BlcnR5IG5hbWUgb2Ygd2hpY2ggaXMgd2hhdCA8aT5zUGFnaW5hdGlvblR5cGU8L2k+IHJlZmVycwoJCSAqIHRvKSB0aGF0IGhhcyB0d28gcHJvcGVydGllcywgYm90aCBtZXRob2RzIHRoYXQgYXJlIHVzZWQgYnkgRGF0YVRhYmxlcyB0byB1cGRhdGUgdGhlCgkJICogY29udHJvbCdzIHN0YXRlLgoJCSAqICAgPHVsPgoJCSAqICAgICA8bGk+CgkJICogICAgICAgZm5Jbml0IC0gIEluaXRpYWxpc2F0aW9uIG9mIHRoZSBwYWdpbmcgY29udHJvbHMuIENhbGxlZCBvbmx5IGR1cmluZyBpbml0aWFsaXNhdGlvbiAKCQkgKiAgICAgICAgIG9mIHRoZSB0YWJsZS4gSXQgaXMgZXhwZWN0ZWQgdGhhdCB0aGlzIGZ1bmN0aW9uIHdpbGwgYWRkIHRoZSByZXF1aXJlZCBET00gZWxlbWVudHMgCgkJICogICAgICAgICB0byB0aGUgcGFnZSBmb3IgdGhlIHBhZ2luZyBjb250cm9scyB0byB3b3JrLiBUaGUgZWxlbWVudCBwb2ludGVyIAoJCSAqICAgICAgICAgJ29TZXR0aW5ncy5hYW5GZWF0dXJlcy5wJyBhcnJheSBpcyBwcm92aWRlZCBieSBEYXRhVGFibGVzIHRvIGNvbnRhaW4gdGhlIHBhZ2luZyAKCQkgKiAgICAgICAgIGNvbnRyb2xzIChub3RlIHRoYXQgdGhpcyBpcyBhIDJEIGFycmF5IHRvIGFsbG93IGZvciBtdWx0aXBsZSBpbnN0YW5jZXMgb2YgZWFjaCAKCQkgKiAgICAgICAgIERhdGFUYWJsZXMgRE9NIGVsZW1lbnQpLiBJdCBpcyBzdWdnZXN0ZWQgdGhhdCB5b3UgYWRkIHRoZSBjb250cm9scyB0byB0aGlzIGVsZW1lbnQgCgkJICogICAgICAgICBhcyBjaGlsZHJlbgoJCSAqICAgICAgIDx1bD4KCSAgICAgKiAgICAgICAgIDxsaT4KCSAgICAgKiAgICAgICAgICAgRnVuY3Rpb24gaW5wdXQgcGFyYW1ldGVyczoKCSAgICAgKiAgICAgICAgICAgPHVsPgoJCSAqICAgICAgICAgICAgIDxsaT57b2JqZWN0fSBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdDogc2VlIHtAbGluayBEYXRhVGFibGUubW9kZWxzLm9TZXR0aW5nc30uPC9saT4KCQkgKiAgICAgICAgICAgICA8bGk+e25vZGV9IENvbnRhaW5lciBpbnRvIHdoaWNoIHRoZSBwYWdpbmF0aW9uIGNvbnRyb2xzIG11c3QgYmUgaW5zZXJ0ZWQ8L2xpPgoJCSAqICAgICAgICAgICAgIDxsaT57ZnVuY3Rpb259IERyYXcgY2FsbGJhY2sgZnVuY3Rpb24gLSB3aGVuZXZlciB0aGUgY29udHJvbHMgY2F1c2UgYSBwYWdlCgkJICogICAgICAgICAgICAgICBjaGFuZ2UsIHRoaXMgbWV0aG9kIG11c3QgYmUgY2FsbGVkIHRvIHJlZHJhdyB0aGUgdGFibGUuPC9saT4KCSAgICAgKiAgICAgICAgICAgPC91bD4KCSAgICAgKiAgICAgICAgIDwvbGk+CgkJICogICAgICAgICA8bGk+CgkJICogICAgICAgICAgIEZ1bmN0aW9uIHJldHVybjoKCQkgKiAgICAgICAgICAgPHVsPgoJCSAqICAgICAgICAgICAgIDxsaT5ObyByZXR1cm4gcmVxdWlyZWQ8L2xpPgoJCSAqICAgICAgICAgICA8L3VsPgoJCSAqICAgICAgICAgPC9pbD4KCQkgKiAgICAgICA8L3VsPgoJCSAqICAgICA8L2lsPgoJCSAqICAgICA8bGk+CgkJICogICAgICAgZm5Jbml0IC0gIFRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIHdoZW5ldmVyIHRoZSBwYWdpbmcgc3RhdHVzIG9mIHRoZSB0YWJsZSBjaGFuZ2VzIGFuZCBpcwoJCSAqICAgICAgICAgdHlwaWNhbGx5IHVzZWQgdG8gdXBkYXRlIGNsYXNzZXMgYW5kL29yIHRleHQgb2YgdGhlIHBhZ2luZyBjb250cm9scyB0byByZWZsZXggdGhlIG5ldyAKCQkgKiAgICAgICAgIHN0YXR1cy4KCQkgKiAgICAgICA8dWw+CgkgICAgICogICAgICAgICA8bGk+CgkgICAgICogICAgICAgICAgIEZ1bmN0aW9uIGlucHV0IHBhcmFtZXRlcnM6CgkgICAgICogICAgICAgICAgIDx1bD4KCQkgKiAgICAgICAgICAgICA8bGk+e29iamVjdH0gRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3Q6IHNlZSB7QGxpbmsgRGF0YVRhYmxlLm1vZGVscy5vU2V0dGluZ3N9LjwvbGk+CgkJICogICAgICAgICAgICAgPGxpPntmdW5jdGlvbn0gRHJhdyBjYWxsYmFjayBmdW5jdGlvbiAtIGluIGNhc2UgeW91IG5lZWQgdG8gcmVkcmF3IHRoZSB0YWJsZSBhZ2FpbgoJCSAqICAgICAgICAgICAgICAgb3IgYXR0YWNoIG5ldyBldmVudCBsaXN0ZW5lcnM8L2xpPgoJICAgICAqICAgICAgICAgICA8L3VsPgoJICAgICAqICAgICAgICAgPC9saT4KCQkgKiAgICAgICAgIDxsaT4KCQkgKiAgICAgICAgICAgRnVuY3Rpb24gcmV0dXJuOgoJCSAqICAgICAgICAgICA8dWw+CgkJICogICAgICAgICAgICAgPGxpPk5vIHJldHVybiByZXF1aXJlZDwvbGk+CgkJICogICAgICAgICAgIDwvdWw+CgkJICogICAgICAgICA8L2lsPgoJCSAqICAgICAgIDwvdWw+CgkJICogICAgIDwvaWw+CgkJICogICA8L3VsPgoJCSAqICBAdHlwZSBvYmplY3QKCQkgKiAgQGRlZmF1bHQge30KCQkgKgoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQuZm4uZGF0YVRhYmxlRXh0Lm9QYWdpbmF0aW9uLmZvdXJfYnV0dG9uID0gewoJCSAqICAgICAgImZuSW5pdCI6IGZ1bmN0aW9uICggb1NldHRpbmdzLCBuUGFnaW5nLCBmbkNhbGxiYWNrRHJhdyApIHsKCQkgKiAgICAgICAgbkZpcnN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ3NwYW4nICk7CgkJICogICAgICAgIG5QcmV2aW91cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdzcGFuJyApOwoJCSAqICAgICAgICBuTmV4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdzcGFuJyApOwoJCSAqICAgICAgICBuTGFzdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdzcGFuJyApOwoJCSAqICAgICAgICAKCQkgKiAgICAgICAgbkZpcnN0LmFwcGVuZENoaWxkKCBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSggb1NldHRpbmdzLm9MYW5ndWFnZS5vUGFnaW5hdGUuc0ZpcnN0ICkgKTsKCQkgKiAgICAgICAgblByZXZpb3VzLmFwcGVuZENoaWxkKCBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSggb1NldHRpbmdzLm9MYW5ndWFnZS5vUGFnaW5hdGUuc1ByZXZpb3VzICkgKTsKCQkgKiAgICAgICAgbk5leHQuYXBwZW5kQ2hpbGQoIGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCBvU2V0dGluZ3Mub0xhbmd1YWdlLm9QYWdpbmF0ZS5zTmV4dCApICk7CgkJICogICAgICAgIG5MYXN0LmFwcGVuZENoaWxkKCBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSggb1NldHRpbmdzLm9MYW5ndWFnZS5vUGFnaW5hdGUuc0xhc3QgKSApOwoJCSAqICAgICAgICAKCQkgKiAgICAgICAgbkZpcnN0LmNsYXNzTmFtZSA9ICJwYWdpbmF0ZV9idXR0b24gZmlyc3QiOwoJCSAqICAgICAgICBuUHJldmlvdXMuY2xhc3NOYW1lID0gInBhZ2luYXRlX2J1dHRvbiBwcmV2aW91cyI7CgkJICogICAgICAgIG5OZXh0LmNsYXNzTmFtZT0icGFnaW5hdGVfYnV0dG9uIG5leHQiOwoJCSAqICAgICAgICBuTGFzdC5jbGFzc05hbWUgPSAicGFnaW5hdGVfYnV0dG9uIGxhc3QiOwoJCSAqICAgICAgICAKCQkgKiAgICAgICAgblBhZ2luZy5hcHBlbmRDaGlsZCggbkZpcnN0ICk7CgkJICogICAgICAgIG5QYWdpbmcuYXBwZW5kQ2hpbGQoIG5QcmV2aW91cyApOwoJCSAqICAgICAgICBuUGFnaW5nLmFwcGVuZENoaWxkKCBuTmV4dCApOwoJCSAqICAgICAgICBuUGFnaW5nLmFwcGVuZENoaWxkKCBuTGFzdCApOwoJCSAqICAgICAgICAKCQkgKiAgICAgICAgJChuRmlyc3QpLmNsaWNrKCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAgICAgb1NldHRpbmdzLm9BcGkuX2ZuUGFnZUNoYW5nZSggb1NldHRpbmdzLCAiZmlyc3QiICk7CgkJICogICAgICAgICAgZm5DYWxsYmFja0RyYXcoIG9TZXR0aW5ncyApOwoJCSAqICAgICAgICB9ICk7CgkJICogICAgICAgIAoJCSAqICAgICAgICAkKG5QcmV2aW91cykuY2xpY2soIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgICAgIG9TZXR0aW5ncy5vQXBpLl9mblBhZ2VDaGFuZ2UoIG9TZXR0aW5ncywgInByZXZpb3VzIiApOwoJCSAqICAgICAgICAgIGZuQ2FsbGJhY2tEcmF3KCBvU2V0dGluZ3MgKTsKCQkgKiAgICAgICAgfSApOwoJCSAqICAgICAgICAKCQkgKiAgICAgICAgJChuTmV4dCkuY2xpY2soIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgICAgIG9TZXR0aW5ncy5vQXBpLl9mblBhZ2VDaGFuZ2UoIG9TZXR0aW5ncywgIm5leHQiICk7CgkJICogICAgICAgICAgZm5DYWxsYmFja0RyYXcoIG9TZXR0aW5ncyApOwoJCSAqICAgICAgICB9ICk7CgkJICogICAgICAgIAoJCSAqICAgICAgICAkKG5MYXN0KS5jbGljayggZnVuY3Rpb24oKSB7CgkJICogICAgICAgICAgb1NldHRpbmdzLm9BcGkuX2ZuUGFnZUNoYW5nZSggb1NldHRpbmdzLCAibGFzdCIgKTsKCQkgKiAgICAgICAgICBmbkNhbGxiYWNrRHJhdyggb1NldHRpbmdzICk7CgkJICogICAgICAgIH0gKTsKCQkgKiAgICAgICAgCgkJICogICAgICAgICQobkZpcnN0KS5iaW5kKCAnc2VsZWN0c3RhcnQnLCBmdW5jdGlvbiAoKSB7IHJldHVybiBmYWxzZTsgfSApOwoJCSAqICAgICAgICAkKG5QcmV2aW91cykuYmluZCggJ3NlbGVjdHN0YXJ0JywgZnVuY3Rpb24gKCkgeyByZXR1cm4gZmFsc2U7IH0gKTsKCQkgKiAgICAgICAgJChuTmV4dCkuYmluZCggJ3NlbGVjdHN0YXJ0JywgZnVuY3Rpb24gKCkgeyByZXR1cm4gZmFsc2U7IH0gKTsKCQkgKiAgICAgICAgJChuTGFzdCkuYmluZCggJ3NlbGVjdHN0YXJ0JywgZnVuY3Rpb24gKCkgeyByZXR1cm4gZmFsc2U7IH0gKTsKCQkgKiAgICAgIH0sCgkJICogICAgICAKCQkgKiAgICAgICJmblVwZGF0ZSI6IGZ1bmN0aW9uICggb1NldHRpbmdzLCBmbkNhbGxiYWNrRHJhdyApIHsKCQkgKiAgICAgICAgaWYgKCAhb1NldHRpbmdzLmFhbkZlYXR1cmVzLnAgKSB7CgkJICogICAgICAgICAgcmV0dXJuOwoJCSAqICAgICAgICB9CgkJICogICAgICAgIAoJCSAqICAgICAgICAvLyBMb29wIG92ZXIgZWFjaCBpbnN0YW5jZSBvZiB0aGUgcGFnZXIKCQkgKiAgICAgICAgdmFyIGFuID0gb1NldHRpbmdzLmFhbkZlYXR1cmVzLnA7CgkJICogICAgICAgIGZvciAoIHZhciBpPTAsIGlMZW49YW4ubGVuZ3RoIDsgaTxpTGVuIDsgaSsrICkgewoJCSAqICAgICAgICAgIHZhciBidXR0b25zID0gYW5baV0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3NwYW4nKTsKCQkgKiAgICAgICAgICBpZiAoIG9TZXR0aW5ncy5faURpc3BsYXlTdGFydCA9PT0gMCApIHsKCQkgKiAgICAgICAgICAgIGJ1dHRvbnNbMF0uY2xhc3NOYW1lID0gInBhZ2luYXRlX2Rpc2FibGVkX3ByZXZpb3VzIjsKCQkgKiAgICAgICAgICAgIGJ1dHRvbnNbMV0uY2xhc3NOYW1lID0gInBhZ2luYXRlX2Rpc2FibGVkX3ByZXZpb3VzIjsKCQkgKiAgICAgICAgICB9CgkJICogICAgICAgICAgZWxzZSB7CgkJICogICAgICAgICAgICBidXR0b25zWzBdLmNsYXNzTmFtZSA9ICJwYWdpbmF0ZV9lbmFibGVkX3ByZXZpb3VzIjsKCQkgKiAgICAgICAgICAgIGJ1dHRvbnNbMV0uY2xhc3NOYW1lID0gInBhZ2luYXRlX2VuYWJsZWRfcHJldmlvdXMiOwoJCSAqICAgICAgICAgIH0KCQkgKiAgICAgICAgICAKCQkgKiAgICAgICAgICBpZiAoIG9TZXR0aW5ncy5mbkRpc3BsYXlFbmQoKSA9PSBvU2V0dGluZ3MuZm5SZWNvcmRzRGlzcGxheSgpICkgewoJCSAqICAgICAgICAgICAgYnV0dG9uc1syXS5jbGFzc05hbWUgPSAicGFnaW5hdGVfZGlzYWJsZWRfbmV4dCI7CgkJICogICAgICAgICAgICBidXR0b25zWzNdLmNsYXNzTmFtZSA9ICJwYWdpbmF0ZV9kaXNhYmxlZF9uZXh0IjsKCQkgKiAgICAgICAgICB9CgkJICogICAgICAgICAgZWxzZSB7CgkJICogICAgICAgICAgICBidXR0b25zWzJdLmNsYXNzTmFtZSA9ICJwYWdpbmF0ZV9lbmFibGVkX25leHQiOwoJCSAqICAgICAgICAgICAgYnV0dG9uc1szXS5jbGFzc05hbWUgPSAicGFnaW5hdGVfZW5hYmxlZF9uZXh0IjsKCQkgKiAgICAgICAgICB9CgkJICogICAgICAgIH0KCQkgKiAgICAgIH0KCQkgKiAgICB9OwoJCSAqLwoJCSJvUGFnaW5hdGlvbiI6IHt9LAoJCgkKCQkvKioKCQkgKiBTb3J0aW5nIHBsdWctaW4gbWV0aG9kcyAtIFNvcnRpbmcgaW4gRGF0YVRhYmxlcyBpcyBiYXNlZCBvbiB0aGUgZGV0ZWN0ZWQgdHlwZSBvZiB0aGUKCQkgKiBkYXRhIGNvbHVtbiAoeW91IGNhbiBhZGQgeW91ciBvd24gdHlwZSBkZXRlY3Rpb24gZnVuY3Rpb25zLCBvciBvdmVycmlkZSBhdXRvbWF0aWMgCgkJICogZGV0ZWN0aW9uIHVzaW5nIHNUeXBlKS4gV2l0aCB0aGlzIHNwZWNpZmljIHR5cGUgZ2l2ZW4gdG8gdGhlIGNvbHVtbiwgRGF0YVRhYmxlcyB3aWxsIAoJCSAqIGFwcGx5IHRoZSByZXF1aXJlZCBzb3J0IGZyb20gdGhlIGZ1bmN0aW9ucyBpbiB0aGUgb2JqZWN0LiBFYWNoIHNvcnQgdHlwZSBtdXN0IHByb3ZpZGUKCQkgKiB0d28gbWFuZGF0b3J5IG1ldGhvZHMsIG9uZSBlYWNoIGZvciBhc2NlbmRpbmcgYW5kIGRlc2NlbmRpbmcgc29ydGluZywgYW5kIGNhbiBvcHRpb25hbGx5CgkJICogcHJvdmlkZSBhIHByZS1mb3JtYXR0aW5nIG1ldGhvZCB0aGF0IHdpbGwgaGVscCBzcGVlZCB1cCBzb3J0aW5nIGJ5IGFsbG93aW5nIERhdGFUYWJsZXMKCQkgKiB0byBwcmUtZm9ybWF0IHRoZSBzb3J0IGRhdGEgb25seSBvbmNlIChyYXRoZXIgdGhhbiBldmVyeSB0aW1lIHRoZSBhY3R1YWwgc29ydCBmdW5jdGlvbnMKCQkgKiBhcmUgcnVuKS4gVGhlIHR3byBzb3J0aW5nIGZ1bmN0aW9ucyBhcmUgdHlwaWNhbCBKYXZhc2NyaXB0IHNvcnQgbWV0aG9kczoKCQkgKiAgIDx1bD4KCSAgICAgKiAgICAgPGxpPgoJICAgICAqICAgICAgIEZ1bmN0aW9uIGlucHV0IHBhcmFtZXRlcnM6CgkgICAgICogICAgICAgPHVsPgoJCSAqICAgICAgICAgPGxpPnsqfSBEYXRhIHRvIGNvbXBhcmUgdG8gdGhlIHNlY29uZCBwYXJhbWV0ZXI8L2xpPgoJCSAqICAgICAgICAgPGxpPnsqfSBEYXRhIHRvIGNvbXBhcmUgdG8gdGhlIGZpcnN0IHBhcmFtZXRlcjwvbGk+CgkgICAgICogICAgICAgPC91bD4KCSAgICAgKiAgICAgPC9saT4KCQkgKiAgICAgPGxpPgoJCSAqICAgICAgIEZ1bmN0aW9uIHJldHVybjoKCQkgKiAgICAgICA8dWw+CgkJICogICAgICAgICA8bGk+e2ludH0gU29ydGluZyBtYXRjaDogPDAgaWYgZmlyc3QgcGFyYW1ldGVyIHNob3VsZCBiZSBzb3J0ZWQgbG93ZXIgdGhhbgoJCSAqICAgICAgICAgICB0aGUgc2Vjb25kIHBhcmFtZXRlciwgPT09MCBpZiB0aGUgdHdvIHBhcmFtZXRlcnMgYXJlIGVxdWFsIGFuZCA+MCBpZgoJCSAqICAgICAgICAgICB0aGUgZmlyc3QgcGFyYW1ldGVyIHNob3VsZCBiZSBzb3J0ZWQgaGVpZ2h0IHRoYW4gdGhlIHNlY29uZCBwYXJhbWV0ZXIuPC9saT4KCQkgKiAgICAgICA8L3VsPgoJCSAqICAgICA8L2lsPgoJCSAqICAgPC91bD4KCQkgKiAgQHR5cGUgb2JqZWN0CgkJICogIEBkZWZhdWx0IHt9CgkJICoKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBDYXNlLXNlbnNpdGl2ZSBzdHJpbmcgc29ydGluZywgd2l0aCBubyBwcmUtZm9ybWF0dGluZyBtZXRob2QKCQkgKiAgICAkLmV4dGVuZCggJC5mbi5kYXRhVGFibGVFeHQub1NvcnQsIHsKCQkgKiAgICAgICJzdHJpbmctY2FzZS1hc2MiOiBmdW5jdGlvbih4LHkpIHsKCQkgKiAgICAgICAgcmV0dXJuICgoeCA8IHkpID8gLTEgOiAoKHggPiB5KSA/IDEgOiAwKSk7CgkJICogICAgICB9LAoJCSAqICAgICAgInN0cmluZy1jYXNlLWRlc2MiOiBmdW5jdGlvbih4LHkpIHsKCQkgKiAgICAgICAgcmV0dXJuICgoeCA8IHkpID8gMSA6ICgoeCA+IHkpID8gLTEgOiAwKSk7CgkJICogICAgICB9CgkJICogICAgfSApOwoJCSAqCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gQ2FzZS1pbnNlbnNpdGl2ZSBzdHJpbmcgc29ydGluZywgd2l0aCBwcmUtZm9ybWF0dGluZwoJCSAqICAgICQuZXh0ZW5kKCAkLmZuLmRhdGFUYWJsZUV4dC5vU29ydCwgewoJCSAqICAgICAgInN0cmluZy1wcmUiOiBmdW5jdGlvbih4KSB7CgkJICogICAgICAgIHJldHVybiB4LnRvTG93ZXJDYXNlKCk7CgkJICogICAgICB9LAoJCSAqICAgICAgInN0cmluZy1hc2MiOiBmdW5jdGlvbih4LHkpIHsKCQkgKiAgICAgICAgcmV0dXJuICgoeCA8IHkpID8gLTEgOiAoKHggPiB5KSA/IDEgOiAwKSk7CgkJICogICAgICB9LAoJCSAqICAgICAgInN0cmluZy1kZXNjIjogZnVuY3Rpb24oeCx5KSB7CgkJICogICAgICAgIHJldHVybiAoKHggPCB5KSA/IDEgOiAoKHggPiB5KSA/IC0xIDogMCkpOwoJCSAqICAgICAgfQoJCSAqICAgIH0gKTsKCQkgKi8KCQkib1NvcnQiOiB7fSwKCQoJCgkJLyoqCgkJICogVmVyc2lvbiBzdHJpbmcgZm9yIHBsdWctaW5zIHRvIGNoZWNrIGNvbXBhdGliaWxpdHkuIEFsbG93ZWQgZm9ybWF0IGlzCgkJICogYS5iLmMuZC5lIHdoZXJlOiBhOmludCwgYjppbnQsIGM6aW50LCBkOnN0cmluZyhkZXZ8YmV0YSksIGU6aW50LiBkIGFuZAoJCSAqIGUgYXJlIG9wdGlvbmFsCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBWZXJzaW9uIG51bWJlcgoJCSAqLwoJCSJzVmVyc2lvbiI6IERhdGFUYWJsZS52ZXJzaW9uLAoJCgkKCQkvKioKCQkgKiBIb3cgc2hvdWxkIERhdGFUYWJsZXMgcmVwb3J0IGFuIGVycm9yLiBDYW4gdGFrZSB0aGUgdmFsdWUgJ2FsZXJ0JyBvciAndGhyb3cnCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBhbGVydAoJCSAqLwoJCSJzRXJyTW9kZSI6ICJhbGVydCIsCgkKCQoJCS8qKgoJCSAqIFN0b3JlIGluZm9ybWF0aW9uIGZvciBEYXRhVGFibGVzIHRvIGFjY2VzcyBnbG9iYWxseSBhYm91dCBvdGhlciBpbnN0YW5jZXMKCQkgKiAgQG5hbWVzcGFjZQoJCSAqICBAcHJpdmF0ZQoJCSAqLwoJCSJfb0V4dGVybkNvbmZpZyI6IHsKCQkJLyogaW50OmlOZXh0VW5pcXVlIC0gbmV4dCB1bmlxdWUgbnVtYmVyIGZvciBhbiBpbnN0YW5jZSAqLwoJCQkiaU5leHRVbmlxdWUiOiAwCgkJfQoJfTsKCQoJCgkKCQoJLyoqCgkgKiBUZW1wbGF0ZSBvYmplY3QgZm9yIHRoZSB3YXkgaW4gd2hpY2ggRGF0YVRhYmxlcyBob2xkcyBpbmZvcm1hdGlvbiBhYm91dAoJICogc2VhcmNoIGluZm9ybWF0aW9uIGZvciB0aGUgZ2xvYmFsIGZpbHRlciBhbmQgaW5kaXZpZHVhbCBjb2x1bW4gZmlsdGVycy4KCSAqICBAbmFtZXNwYWNlCgkgKi8KCURhdGFUYWJsZS5tb2RlbHMub1NlYXJjaCA9IHsKCQkvKioKCQkgKiBGbGFnIHRvIGluZGljYXRlIGlmIHRoZSBmaWx0ZXJpbmcgc2hvdWxkIGJlIGNhc2UgaW5zZW5zaXRpdmUgb3Igbm90CgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgdHJ1ZQoJCSAqLwoJCSJiQ2FzZUluc2Vuc2l0aXZlIjogdHJ1ZSwKCQoJCS8qKgoJCSAqIEFwcGxpZWQgc2VhcmNoIHRlcm0KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IDxpPkVtcHR5IHN0cmluZzwvaT4KCQkgKi8KCQkic1NlYXJjaCI6ICIiLAoJCgkJLyoqCgkJICogRmxhZyB0byBpbmRpY2F0ZSBpZiB0aGUgc2VhcmNoIHRlcm0gc2hvdWxkIGJlIGludGVycHJldGVkIGFzIGEKCQkgKiByZWd1bGFyIGV4cHJlc3Npb24gKHRydWUpIG9yIG5vdCAoZmFsc2UpIGFuZCB0aGVyZWZvcmUgYW5kIHNwZWNpYWwKCQkgKiByZWdleCBjaGFyYWN0ZXJzIGVzY2FwZWQuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkgKi8KCQkiYlJlZ2V4IjogZmFsc2UsCgkKCQkvKioKCQkgKiBGbGFnIHRvIGluZGljYXRlIGlmIERhdGFUYWJsZXMgaXMgdG8gdXNlIGl0cyBzbWFydCBmaWx0ZXJpbmcgb3Igbm90LgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IHRydWUKCQkgKi8KCQkiYlNtYXJ0IjogdHJ1ZQoJfTsKCQoJCgkKCQoJLyoqCgkgKiBUZW1wbGF0ZSBvYmplY3QgZm9yIHRoZSB3YXkgaW4gd2hpY2ggRGF0YVRhYmxlcyBob2xkcyBpbmZvcm1hdGlvbiBhYm91dAoJICogZWFjaCBpbmRpdmlkdWFsIHJvdy4gVGhpcyBpcyB0aGUgb2JqZWN0IGZvcm1hdCB1c2VkIGZvciB0aGUgc2V0dGluZ3MgCgkgKiBhb0RhdGEgYXJyYXkuCgkgKiAgQG5hbWVzcGFjZQoJICovCglEYXRhVGFibGUubW9kZWxzLm9Sb3cgPSB7CgkJLyoqCgkJICogVFIgZWxlbWVudCBmb3IgdGhlIHJvdwoJCSAqICBAdHlwZSBub2RlCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkiblRyIjogbnVsbCwKCQoJCS8qKgoJCSAqIERhdGEgb2JqZWN0IGZyb20gdGhlIG9yaWdpbmFsIGRhdGEgc291cmNlIGZvciB0aGUgcm93LiBUaGlzIGlzIGVpdGhlcgoJCSAqIGFuIGFycmF5IGlmIHVzaW5nIHRoZSB0cmFkaXRpb25hbCBmb3JtIG9mIERhdGFUYWJsZXMsIG9yIGFuIG9iamVjdCBpZgoJCSAqIHVzaW5nIG1EYXRhUHJvcCBvcHRpb25zLiBUaGUgZXhhY3QgdHlwZSB3aWxsIGRlcGVuZCBvbiB0aGUgcGFzc2VkIGluCgkJICogZGF0YSBmcm9tIHRoZSBkYXRhIHNvdXJjZSwgb3Igd2lsbCBiZSBhbiBhcnJheSBpZiB1c2luZyBET00gYSBkYXRhIAoJCSAqIHNvdXJjZS4KCQkgKiAgQHR5cGUgYXJyYXl8b2JqZWN0CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJIl9hRGF0YSI6IFtdLAoJCgkJLyoqCgkJICogU29ydGluZyBkYXRhIGNhY2hlIC0gdGhpcyBhcnJheSBpcyBvc3RlbnNpYmx5IHRoZSBzYW1lIGxlbmd0aCBhcyB0aGUKCQkgKiBudW1iZXIgb2YgY29sdW1ucyAoYWx0aG91Z2ggZWFjaCBpbmRleCBpcyBnZW5lcmF0ZWQgb25seSBhcyBpdCBpcyAKCQkgKiBuZWVkZWQpLCBhbmQgaG9sZHMgdGhlIGRhdGEgdGhhdCBpcyB1c2VkIGZvciBzb3J0aW5nIGVhY2ggY29sdW1uIGluIHRoZQoJCSAqIHJvdy4gV2UgZG8gdGhpcyBjYWNoZSBnZW5lcmF0aW9uIGF0IHRoZSBzdGFydCBvZiB0aGUgc29ydCBpbiBvcmRlciB0aGF0CgkJICogdGhlIGZvcm1hdHRpbmcgb2YgdGhlIHNvcnQgZGF0YSBuZWVkIGJlIGRvbmUgb25seSBvbmNlIGZvciBlYWNoIGNlbGwKCQkgKiBwZXIgc29ydC4gVGhpcyBhcnJheSBzaG91bGQgbm90IGJlIHJlYWQgZnJvbSBvciB3cml0dGVuIHRvIGJ5IGFueXRoaW5nCgkJICogb3RoZXIgdGhhbiB0aGUgbWFzdGVyIHNvcnRpbmcgbWV0aG9kcy4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKiAgQHByaXZhdGUKCQkgKi8KCQkiX2FTb3J0RGF0YSI6IFtdLAoJCgkJLyoqCgkJICogQXJyYXkgb2YgVEQgZWxlbWVudHMgdGhhdCBhcmUgY2FjaGVkIGZvciBoaWRkZW4gcm93cywgc28gdGhleSBjYW4gYmUKCQkgKiByZWluc2VydGVkIGludG8gdGhlIHRhYmxlIGlmIGEgY29sdW1uIGlzIG1hZGUgdmlzaWJsZSBhZ2FpbiAob3IgdG8gYWN0CgkJICogYXMgYSBzdG9yZSBpZiBhIGNvbHVtbiBpcyBtYWRlIGhpZGRlbikuIE9ubHkgaGlkZGVuIGNvbHVtbnMgaGF2ZSBhIAoJCSAqIHJlZmVyZW5jZSBpbiB0aGUgYXJyYXkuIEZvciBub24taGlkZGVuIGNvbHVtbnMgdGhlIHZhbHVlIGlzIGVpdGhlcgoJCSAqIHVuZGVmaW5lZCBvciBudWxsLgoJCSAqICBAdHlwZSBhcnJheSBub2RlcwoJCSAqICBAZGVmYXVsdCBbXQoJCSAqICBAcHJpdmF0ZQoJCSAqLwoJCSJfYW5IaWRkZW4iOiBbXSwKCQoJCS8qKgoJCSAqIENhY2hlIG9mIHRoZSBjbGFzcyBuYW1lIHRoYXQgRGF0YVRhYmxlcyBoYXMgYXBwbGllZCB0byB0aGUgcm93LCBzbyB3ZQoJCSAqIGNhbiBxdWlja2x5IGxvb2sgYXQgdGhpcyB2YXJpYWJsZSByYXRoZXIgdGhhbiBuZWVkaW5nIHRvIGRvIGEgRE9NIGNoZWNrCgkJICogb24gY2xhc3NOYW1lIGZvciB0aGUgblRyIHByb3BlcnR5LgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgPGk+RW1wdHkgc3RyaW5nPC9pPgoJCSAqICBAcHJpdmF0ZQoJCSAqLwoJCSJfc1Jvd1N0cmlwZSI6ICIiCgl9OwoJCgkKCQoJLyoqCgkgKiBUZW1wbGF0ZSBvYmplY3QgZm9yIHRoZSBjb2x1bW4gaW5mb3JtYXRpb24gb2JqZWN0IGluIERhdGFUYWJsZXMuIFRoaXMgb2JqZWN0CgkgKiBpcyBoZWxkIGluIHRoZSBzZXR0aW5ncyBhb0NvbHVtbnMgYXJyYXkgYW5kIGNvbnRhaW5zIGFsbCB0aGUgaW5mb3JtYXRpb24gdGhhdAoJICogRGF0YVRhYmxlcyBuZWVkcyBhYm91dCBlYWNoIGluZGl2aWR1YWwgY29sdW1uLgoJICogCgkgKiBOb3RlIHRoYXQgdGhpcyBvYmplY3QgaXMgcmVsYXRlZCB0byB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzLmNvbHVtbnN9IAoJICogYnV0IHRoaXMgb25lIGlzIHRoZSBpbnRlcm5hbCBkYXRhIHN0b3JlIGZvciBEYXRhVGFibGVzJ3MgY2FjaGUgb2YgY29sdW1ucy4KCSAqIEl0IHNob3VsZCBOT1QgYmUgbWFuaXB1bGF0ZWQgb3V0c2lkZSBvZiBEYXRhVGFibGVzLiBBbnkgY29uZmlndXJhdGlvbiBzaG91bGQKCSAqIGJlIGRvbmUgdGhyb3VnaCB0aGUgaW5pdGlhbGlzYXRpb24gb3B0aW9ucy4KCSAqICBAbmFtZXNwYWNlCgkgKi8KCURhdGFUYWJsZS5tb2RlbHMub0NvbHVtbiA9IHsKCQkvKioKCQkgKiBBIGxpc3Qgb2YgdGhlIGNvbHVtbnMgdGhhdCBzb3J0aW5nIHNob3VsZCBvY2N1ciBvbiB3aGVuIHRoaXMgY29sdW1uCgkJICogaXMgc29ydGVkLiBUaGF0IHRoaXMgcHJvcGVydHkgaXMgYW4gYXJyYXkgYWxsb3dzIG11bHRpLWNvbHVtbiBzb3J0aW5nCgkJICogdG8gYmUgZGVmaW5lZCBmb3IgYSBjb2x1bW4gKGZvciBleGFtcGxlIGZpcnN0IG5hbWUgLyBsYXN0IG5hbWUgY29sdW1ucwoJCSAqIHdvdWxkIGJlbmVmaXQgZnJvbSB0aGlzKS4gVGhlIHZhbHVlcyBhcmUgaW50ZWdlcnMgcG9pbnRpbmcgdG8gdGhlCgkJICogY29sdW1ucyB0byBiZSBzb3J0ZWQgb24gKHR5cGljYWxseSBpdCB3aWxsIGJlIGEgc2luZ2xlIGludGVnZXIgcG9pbnRpbmcKCQkgKiBhdCBpdHNlbGYsIGJ1dCB0aGF0IGRvZXNuJ3QgbmVlZCB0byBiZSB0aGUgY2FzZSkuCgkJICogIEB0eXBlIGFycmF5CgkJICovCgkJImFEYXRhU29ydCI6IG51bGwsCgkKCQkvKioKCQkgKiBEZWZpbmUgdGhlIHNvcnRpbmcgZGlyZWN0aW9ucyB0aGF0IGFyZSBhcHBsaWVkIHRvIHRoZSBjb2x1bW4sIGluIHNlcXVlbmNlCgkJICogYXMgdGhlIGNvbHVtbiBpcyByZXBlYXRlZGx5IHNvcnRlZCB1cG9uIC0gaS5lLiB0aGUgZmlyc3QgdmFsdWUgaXMgdXNlZAoJCSAqIGFzIHRoZSBzb3J0aW5nIGRpcmVjdGlvbiB3aGVuIHRoZSBjb2x1bW4gaWYgZmlyc3Qgc29ydGVkIChjbGlja2VkIG9uKS4KCQkgKiBTb3J0IGl0IGFnYWluIChjbGljayBhZ2FpbikgYW5kIGl0IHdpbGwgbW92ZSBvbiB0byB0aGUgbmV4dCBpbmRleC4KCQkgKiBSZXBlYXQgdW50aWwgbG9vcC4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKi8KCQkiYXNTb3J0aW5nIjogbnVsbCwKCQkKCQkvKioKCQkgKiBGbGFnIHRvIGluZGljYXRlIGlmIHRoZSBjb2x1bW4gaXMgc2VhcmNoYWJsZSwgYW5kIHRodXMgc2hvdWxkIGJlIGluY2x1ZGVkCgkJICogaW4gdGhlIGZpbHRlcmluZyBvciBub3QuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKi8KCQkiYlNlYXJjaGFibGUiOiBudWxsLAoJCQoJCS8qKgoJCSAqIEZsYWcgdG8gaW5kaWNhdGUgaWYgdGhlIGNvbHVtbiBpcyBzb3J0YWJsZSBvciBub3QuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKi8KCQkiYlNvcnRhYmxlIjogbnVsbCwKCQkKCQkvKioKCQkgKiBXaGVuIHVzaW5nIGZuUmVuZGVyLCB5b3UgaGF2ZSB0d28gb3B0aW9ucyBmb3Igd2hhdCB0byBkbyB3aXRoIHRoZSBkYXRhLAoJCSAqIGFuZCB0aGlzIHByb3BlcnR5IHNlcnZlcyBhcyB0aGUgc3dpdGNoLiBGaXJzdGx5LCB5b3UgY2FuIGhhdmUgdGhlIHNvcnRpbmcKCQkgKiBhbmQgZmlsdGVyaW5nIHVzZSB0aGUgcmVuZGVyZWQgdmFsdWUgKHRydWUgLSBkZWZhdWx0KSwgb3IgeW91IGNhbiBoYXZlCgkJICogdGhlIHNvcnRpbmcgYW5kIGZpbHRlcmluZyB1cyB0aGUgb3JpZ2luYWwgdmFsdWUgKGZhbHNlKS4KCQkgKiAKCQkgKiAqTk9URSogSXQgaXMgaXQgaXMgYWR2aXNhYmxlIG5vdyB0byB1c2UgbURhdGFQcm9wIGFzIGEgZnVuY3Rpb24gYW5kIG1ha2UgCgkJICogdXNlIG9mIHRoZSAndHlwZScgdGhhdCBpdCBnaXZlcywgYWxsb3dpbmcgKHBvdGVudGlhbGx5KSBkaWZmZXJlbnQgZGF0YSB0bwoJCSAqIGJlIHVzZWQgZm9yIHNvcnRpbmcsIGZpbHRlcmluZywgZGlzcGxheSBhbmQgdHlwZSBkZXRlY3Rpb24uCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlcHJlY2F0ZWQKCQkgKi8KCQkiYlVzZVJlbmRlcmVkIjogbnVsbCwKCQkKCQkvKioKCQkgKiBGbGFnIHRvIGluZGljYXRlIGlmIHRoZSBjb2x1bW4gaXMgY3VycmVudGx5IHZpc2libGUgaW4gdGhlIHRhYmxlIG9yIG5vdAoJCSAqICBAdHlwZSBib29sZWFuCgkJICovCgkJImJWaXNpYmxlIjogbnVsbCwKCQkKCQkvKioKCQkgKiBGbGFnIHRvIGluZGljYXRlIHRvIHRoZSB0eXBlIGRldGVjdGlvbiBtZXRob2QgaWYgdGhlIGF1dG9tYXRpYyB0eXBlCgkJICogZGV0ZWN0aW9uIHNob3VsZCBiZSB1c2VkLCBvciBpZiBhIGNvbHVtbiB0eXBlIChzVHlwZSkgaGFzIGJlZW4gc3BlY2lmaWVkCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgdHJ1ZQoJCSAqICBAcHJpdmF0ZQoJCSAqLwoJCSJfYkF1dG9UeXBlIjogdHJ1ZSwKCQkKCQkvKioKCQkgKiBEZXZlbG9wZXIgZGVmaW5hYmxlIGZ1bmN0aW9uIHRoYXQgaXMgY2FsbGVkIHdoZW5ldmVyIGEgY2VsbCBpcyBjcmVhdGVkIChBamF4IHNvdXJjZSwKCQkgKiBldGMpIG9yIHByb2Nlc3NlZCBmb3IgaW5wdXQgKERPTSBzb3VyY2UpLiBUaGlzIGNhbiBiZSB1c2VkIGFzIGEgY29tcGxpbWVudCB0byBmblJlbmRlcgoJCSAqIGFsbG93aW5nIHlvdSB0byBtb2RpZnkgdGhlIERPTSBlbGVtZW50IChhZGQgYmFja2dyb3VuZCBjb2xvdXIgZm9yIGV4YW1wbGUpIHdoZW4gdGhlCgkJICogZWxlbWVudCBpcyBhdmFpbGFibGUgKHNpbmNlIGl0IGlzIG5vdCB3aGVuIGZuUmVuZGVyIGlzIGNhbGxlZCkuCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7ZWxlbWVudH0gblRkIFRoZSBURCBub2RlIHRoYXQgaGFzIGJlZW4gY3JlYXRlZAoJCSAqICBAcGFyYW0geyp9IHNEYXRhIFRoZSBEYXRhIGZvciB0aGUgY2VsbAoJCSAqICBAcGFyYW0ge2FycmF5fG9iamVjdH0gb0RhdGEgVGhlIGRhdGEgZm9yIHRoZSB3aG9sZSByb3cKCQkgKiAgQHBhcmFtIHtpbnR9IGlSb3cgVGhlIHJvdyBpbmRleCBmb3IgdGhlIGFvRGF0YSBkYXRhIHN0b3JlCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkiZm5DcmVhdGVkQ2VsbCI6IG51bGwsCgkJCgkJLyoqCgkJICogRnVuY3Rpb24gdG8gZ2V0IGRhdGEgZnJvbSBhIGNlbGwgaW4gYSBjb2x1bW4uIFlvdSBzaG91bGQgPGI+bmV2ZXI8L2I+CgkJICogYWNjZXNzIGRhdGEgZGlyZWN0bHkgdGhyb3VnaCBfYURhdGEgaW50ZXJuYWxseSBpbiBEYXRhVGFibGVzIC0gYWx3YXlzIHVzZQoJCSAqIHRoZSBtZXRob2QgYXR0YWNoZWQgdG8gdGhpcyBwcm9wZXJ0eS4gSXQgYWxsb3dzIG1EYXRhUHJvcCB0byBmdW5jdGlvbiBhcwoJCSAqIHJlcXVpcmVkLiBUaGlzIGZ1bmN0aW9uIGlzIGF1dG9tYXRpY2FsbHkgYXNzaWduZWQgYnkgdGhlIGNvbHVtbiAKCQkgKiBpbml0aWFsaXNhdGlvbiBtZXRob2QKCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHthcnJheXxvYmplY3R9IG9EYXRhIFRoZSBkYXRhIGFycmF5L29iamVjdCBmb3IgdGhlIGFycmF5IAoJCSAqICAgIChpLmUuIGFvRGF0YVtdLl9hRGF0YSkKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNTcGVjaWZpYyBUaGUgc3BlY2lmaWMgZGF0YSB0eXBlIHlvdSB3YW50IHRvIGdldCAtIAoJCSAqICAgICdkaXNwbGF5JywgJ3R5cGUnICdmaWx0ZXInICdzb3J0JwoJCSAqICBAcmV0dXJucyB7Kn0gVGhlIGRhdGEgZm9yIHRoZSBjZWxsIGZyb20gdGhlIGdpdmVuIHJvdydzIGRhdGEKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJmbkdldERhdGEiOiBudWxsLAoJCQoJCS8qKgoJCSAqIEN1c3RvbSBkaXNwbGF5IGZ1bmN0aW9uIHRoYXQgd2lsbCBiZSBjYWxsZWQgZm9yIHRoZSBkaXNwbGF5IG9mIGVhY2ggY2VsbCAKCQkgKiBpbiB0aGlzIGNvbHVtbi4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG8gT2JqZWN0IHdpdGggdGhlIGZvbGxvd2luZyBwYXJhbWV0ZXJzOgoJCSAqICBAcGFyYW0ge2ludH0gICAgby5pRGF0YVJvdyBUaGUgcm93IGluIGFvRGF0YQoJCSAqICBAcGFyYW0ge2ludH0gICAgby5pRGF0YUNvbHVtbiBUaGUgY29sdW1uIGluIHF1ZXN0aW9uCgkJICogIEBwYXJhbSB7YXJyYXl9ICBvLmFEYXRhIFRoZSBkYXRhIGZvciB0aGUgcm93IGluIHF1ZXN0aW9uCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvLm9TZXR0aW5ncyBUaGUgc2V0dGluZ3Mgb2JqZWN0IGZvciB0aGlzIERhdGFUYWJsZXMgaW5zdGFuY2UKCQkgKiAgQHJldHVybnMge3N0cmluZ30gVGhlIHN0cmluZyB5b3Ugd2hpY2ggdG8gdXNlIGluIHRoZSBkaXNwbGF5CgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkiZm5SZW5kZXIiOiBudWxsLAoJCQoJCS8qKgoJCSAqIEZ1bmN0aW9uIHRvIHNldCBkYXRhIGZvciBhIGNlbGwgaW4gdGhlIGNvbHVtbi4gWW91IHNob3VsZCA8Yj5uZXZlcjwvYj4gCgkJICogc2V0IHRoZSBkYXRhIGRpcmVjdGx5IHRvIF9hRGF0YSBpbnRlcm5hbGx5IGluIERhdGFUYWJsZXMgLSBhbHdheXMgdXNlCgkJICogdGhpcyBtZXRob2QuIEl0IGFsbG93cyBtRGF0YVByb3AgdG8gZnVuY3Rpb24gYXMgcmVxdWlyZWQuIFRoaXMgZnVuY3Rpb24KCQkgKiBpcyBhdXRvbWF0aWNhbGx5IGFzc2lnbmVkIGJ5IHRoZSBjb2x1bW4gaW5pdGlhbGlzYXRpb24gbWV0aG9kCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7YXJyYXl8b2JqZWN0fSBvRGF0YSBUaGUgZGF0YSBhcnJheS9vYmplY3QgZm9yIHRoZSBhcnJheSAKCQkgKiAgICAoaS5lLiBhb0RhdGFbXS5fYURhdGEpCgkJICogIEBwYXJhbSB7Kn0gc1ZhbHVlIFZhbHVlIHRvIHNldAoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJImZuU2V0RGF0YSI6IG51bGwsCgkJCgkJLyoqCgkJICogUHJvcGVydHkgdG8gcmVhZCB0aGUgdmFsdWUgZm9yIHRoZSBjZWxscyBpbiB0aGUgY29sdW1uIGZyb20gdGhlIGRhdGEgCgkJICogc291cmNlIGFycmF5IC8gb2JqZWN0LiBJZiBudWxsLCB0aGVuIHRoZSBkZWZhdWx0IGNvbnRlbnQgaXMgdXNlZCwgaWYgYQoJCSAqIGZ1bmN0aW9uIGlzIGdpdmVuIHRoZW4gdGhlIHJldHVybiBmcm9tIHRoZSBmdW5jdGlvbiBpcyB1c2VkLgoJCSAqICBAdHlwZSBmdW5jdGlvbnxpbnR8c3RyaW5nfG51bGwKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJtRGF0YVByb3AiOiBudWxsLAoJCQoJCS8qKgoJCSAqIFVuaXF1ZSBoZWFkZXIgVEgvVEQgZWxlbWVudCBmb3IgdGhpcyBjb2x1bW4gLSB0aGlzIGlzIHdoYXQgdGhlIHNvcnRpbmcKCQkgKiBsaXN0ZW5lciBpcyBhdHRhY2hlZCB0byAoaWYgc29ydGluZyBpcyBlbmFibGVkLikKCQkgKiAgQHR5cGUgbm9kZQoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJIm5UaCI6IG51bGwsCgkJCgkJLyoqCgkJICogVW5pcXVlIGZvb3RlciBUSC9URCBlbGVtZW50IGZvciB0aGlzIGNvbHVtbiAoaWYgdGhlcmUgaXMgb25lKS4gTm90IHVzZWQgCgkJICogaW4gRGF0YVRhYmxlcyBhcyBzdWNoLCBidXQgY2FuIGJlIHVzZWQgZm9yIHBsdWctaW5zIHRvIHJlZmVyZW5jZSB0aGUgCgkJICogZm9vdGVyIGZvciBlYWNoIGNvbHVtbi4KCQkgKiAgQHR5cGUgbm9kZQoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJIm5UZiI6IG51bGwsCgkJCgkJLyoqCgkJICogVGhlIGNsYXNzIHRvIGFwcGx5IHRvIGFsbCBURCBlbGVtZW50cyBpbiB0aGUgdGFibGUncyBUQk9EWSBmb3IgdGhlIGNvbHVtbgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJzQ2xhc3MiOiBudWxsLAoJCQoJCS8qKgoJCSAqIFdoZW4gRGF0YVRhYmxlcyBjYWxjdWxhdGVzIHRoZSBjb2x1bW4gd2lkdGhzIHRvIGFzc2lnbiB0byBlYWNoIGNvbHVtbiwKCQkgKiBpdCBmaW5kcyB0aGUgbG9uZ2VzdCBzdHJpbmcgaW4gZWFjaCBjb2x1bW4gYW5kIHRoZW4gY29uc3RydWN0cyBhCgkJICogdGVtcG9yYXJ5IHRhYmxlIGFuZCByZWFkcyB0aGUgd2lkdGhzIGZyb20gdGhhdC4gVGhlIHByb2JsZW0gd2l0aCB0aGlzCgkJICogaXMgdGhhdCAibW1tIiBpcyBtdWNoIHdpZGVyIHRoZW4gImlpaWkiLCBidXQgdGhlIGxhdHRlciBpcyBhIGxvbmdlciAKCQkgKiBzdHJpbmcgLSB0aHVzIHRoZSBjYWxjdWxhdGlvbiBjYW4gZ28gd3JvbmcgKGRvaW5nIGl0IHByb3Blcmx5IGFuZCBwdXR0aW5nCgkJICogaXQgaW50byBhbiBET00gb2JqZWN0IGFuZCBtZWFzdXJpbmcgdGhhdCBpcyBob3JyaWJseSghKSBzbG93KS4gVGh1cyBhcwoJCSAqIGEgIndvcmsgYXJvdW5kIiB3ZSBwcm92aWRlIHRoaXMgb3B0aW9uLiBJdCB3aWxsIGFwcGVuZCBpdHMgdmFsdWUgdG8gdGhlCgkJICogdGV4dCB0aGF0IGlzIGZvdW5kIHRvIGJlIHRoZSBsb25nZXN0IHN0cmluZyBmb3IgdGhlIGNvbHVtbiAtIGkuZS4gcGFkZGluZy4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICovCgkJInNDb250ZW50UGFkZGluZyI6IG51bGwsCgkJCgkJLyoqCgkJICogQWxsb3dzIGEgZGVmYXVsdCB2YWx1ZSB0byBiZSBnaXZlbiBmb3IgYSBjb2x1bW4ncyBkYXRhLCBhbmQgd2lsbCBiZSB1c2VkCgkJICogd2hlbmV2ZXIgYSBudWxsIGRhdGEgc291cmNlIGlzIGVuY291bnRlcmVkICh0aGlzIGNhbiBiZSBiZWNhdXNlIG1EYXRhUHJvcAoJCSAqIGlzIHNldCB0byBudWxsLCBvciBiZWNhdXNlIHRoZSBkYXRhIHNvdXJjZSBpdHNlbGYgaXMgbnVsbCkuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJInNEZWZhdWx0Q29udGVudCI6IG51bGwsCgkJCgkJLyoqCgkJICogTmFtZSBmb3IgdGhlIGNvbHVtbiwgYWxsb3dpbmcgcmVmZXJlbmNlIHRvIHRoZSBjb2x1bW4gYnkgbmFtZSBhcyB3ZWxsIGFzCgkJICogYnkgaW5kZXggKG5lZWRzIGEgbG9va3VwIHRvIHdvcmsgYnkgbmFtZSkuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqLwoJCSJzTmFtZSI6IG51bGwsCgkJCgkJLyoqCgkJICogQ3VzdG9tIHNvcnRpbmcgZGF0YSB0eXBlIC0gZGVmaW5lcyB3aGljaCBvZiB0aGUgYXZhaWxhYmxlIHBsdWctaW5zIGluCgkJICogYWZuU29ydERhdGEgdGhlIGN1c3RvbSBzb3J0aW5nIHdpbGwgdXNlIC0gaWYgYW55IGlzIGRlZmluZWQuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBzdGQKCQkgKi8KCQkic1NvcnREYXRhVHlwZSI6ICdzdGQnLAoJCQoJCS8qKgoJCSAqIENsYXNzIHRvIGJlIGFwcGxpZWQgdG8gdGhlIGhlYWRlciBlbGVtZW50IHdoZW4gc29ydGluZyBvbiB0aGlzIGNvbHVtbgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJzU29ydGluZ0NsYXNzIjogbnVsbCwKCQkKCQkvKioKCQkgKiBDbGFzcyB0byBiZSBhcHBsaWVkIHRvIHRoZSBoZWFkZXIgZWxlbWVudCB3aGVuIHNvcnRpbmcgb24gdGhpcyBjb2x1bW4gLQoJCSAqIHdoZW4galF1ZXJ5IFVJIHRoZW1pbmcgaXMgdXNlZC4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkic1NvcnRpbmdDbGFzc0pVSSI6IG51bGwsCgkJCgkJLyoqCgkJICogVGl0bGUgb2YgdGhlIGNvbHVtbiAtIHdoYXQgaXMgc2VlbiBpbiB0aGUgVEggZWxlbWVudCAoblRoKS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICovCgkJInNUaXRsZSI6IG51bGwsCgkJCgkJLyoqCgkJICogQ29sdW1uIHNvcnRpbmcgYW5kIGZpbHRlcmluZyB0eXBlCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJInNUeXBlIjogbnVsbCwKCQkKCQkvKioKCQkgKiBXaWR0aCBvZiB0aGUgY29sdW1uCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJInNXaWR0aCI6IG51bGwsCgkJCgkJLyoqCgkJICogV2lkdGggb2YgdGhlIGNvbHVtbiB3aGVuIGl0IHdhcyBmaXJzdCAiZW5jb3VudGVyZWQiCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJInNXaWR0aE9yaWciOiBudWxsCgl9OwoJCgkKCQoJLyoqCgkgKiBJbml0aWFsaXNhdGlvbiBvcHRpb25zIHRoYXQgY2FuIGJlIGdpdmVuIHRvIERhdGFUYWJsZXMgYXQgaW5pdGlhbGlzYXRpb24gCgkgKiB0aW1lLgoJICogIEBuYW1lc3BhY2UKCSAqLwoJRGF0YVRhYmxlLmRlZmF1bHRzID0gewoJCS8qKgoJCSAqIEFuIGFycmF5IG9mIGRhdGEgdG8gdXNlIGZvciB0aGUgdGFibGUsIHBhc3NlZCBpbiBhdCBpbml0aWFsaXNhdGlvbiB3aGljaCAKCQkgKiB3aWxsIGJlIHVzZWQgaW4gcHJlZmVyZW5jZSB0byBhbnkgZGF0YSB3aGljaCBpcyBhbHJlYWR5IGluIHRoZSBET00uIFRoaXMgaXMKCQkgKiBwYXJ0aWN1bGFybHkgdXNlZnVsIGZvciBjb25zdHJ1Y3RpbmcgdGFibGVzIHB1cmVseSBpbiBKYXZhc2NyaXB0LCBmb3IKCQkgKiBleGFtcGxlIHdpdGggYSBjdXN0b20gQWpheCBjYWxsLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBudWxsCgkJICogIEBkdG9wdCBPcHRpb24KCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhIDJEIGFycmF5IGRhdGEgc291cmNlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhYURhdGEiOiBbCgkJICogICAgICAgICAgWydUcmlkZW50JywgJ0ludGVybmV0IEV4cGxvcmVyIDQuMCcsICdXaW4gOTUrJywgNCwgJ1gnXSwKCQkgKiAgICAgICAgICBbJ1RyaWRlbnQnLCAnSW50ZXJuZXQgRXhwbG9yZXIgNS4wJywgJ1dpbiA5NSsnLCA1LCAnQyddLAoJCSAqICAgICAgICBdLAoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWwoJCSAqICAgICAgICAgIHsgInNUaXRsZSI6ICJFbmdpbmUiIH0sCgkJICogICAgICAgICAgeyAic1RpdGxlIjogIkJyb3dzZXIiIH0sCgkJICogICAgICAgICAgeyAic1RpdGxlIjogIlBsYXRmb3JtIiB9LAoJCSAqICAgICAgICAgIHsgInNUaXRsZSI6ICJWZXJzaW9uIiB9LAoJCSAqICAgICAgICAgIHsgInNUaXRsZSI6ICJHcmFkZSIgfQoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFuIGFycmF5IG9mIG9iamVjdHMgYXMgYSBkYXRhIHNvdXJjZSAobURhdGFQcm9wKQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYWFEYXRhIjogWwoJCSAqICAgICAgICAgIHsKCQkgKiAgICAgICAgICAgICJlbmdpbmUiOiAgICJUcmlkZW50IiwKCQkgKiAgICAgICAgICAgICJicm93c2VyIjogICJJbnRlcm5ldCBFeHBsb3JlciA0LjAiLAoJCSAqICAgICAgICAgICAgInBsYXRmb3JtIjogIldpbiA5NSsiLAoJCSAqICAgICAgICAgICAgInZlcnNpb24iOiAgNCwKCQkgKiAgICAgICAgICAgICJncmFkZSI6ICAgICJYIgoJCSAqICAgICAgICAgIH0sCgkJICogICAgICAgICAgewoJCSAqICAgICAgICAgICAgImVuZ2luZSI6ICAgIlRyaWRlbnQiLAoJCSAqICAgICAgICAgICAgImJyb3dzZXIiOiAgIkludGVybmV0IEV4cGxvcmVyIDUuMCIsCgkJICogICAgICAgICAgICAicGxhdGZvcm0iOiAiV2luIDk1KyIsCgkJICogICAgICAgICAgICAidmVyc2lvbiI6ICA1LAoJCSAqICAgICAgICAgICAgImdyYWRlIjogICAgIkMiCgkJICogICAgICAgICAgfQoJCSAqICAgICAgICBdLAoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWwoJCSAqICAgICAgICAgIHsgInNUaXRsZSI6ICJFbmdpbmUiLCAgICJtRGF0YVByb3AiOiAiZW5naW5lIiB9LAoJCSAqICAgICAgICAgIHsgInNUaXRsZSI6ICJCcm93c2VyIiwgICJtRGF0YVByb3AiOiAiYnJvd3NlciIgfSwKCQkgKiAgICAgICAgICB7ICJzVGl0bGUiOiAiUGxhdGZvcm0iLCAibURhdGFQcm9wIjogInBsYXRmb3JtIiB9LAoJCSAqICAgICAgICAgIHsgInNUaXRsZSI6ICJWZXJzaW9uIiwgICJtRGF0YVByb3AiOiAidmVyc2lvbiIgfSwKCQkgKiAgICAgICAgICB7ICJzVGl0bGUiOiAiR3JhZGUiLCAgICAibURhdGFQcm9wIjogImdyYWRlIiB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImFhRGF0YSI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIElmIHNvcnRpbmcgaXMgZW5hYmxlZCwgdGhlbiBEYXRhVGFibGVzIHdpbGwgcGVyZm9ybSBhIGZpcnN0IHBhc3Mgc29ydCBvbiAKCQkgKiBpbml0aWFsaXNhdGlvbi4gWW91IGNhbiBkZWZpbmUgd2hpY2ggY29sdW1uKHMpIHRoZSBzb3J0IGlzIHBlcmZvcm1lZCB1cG9uLCAKCQkgKiBhbmQgdGhlIHNvcnRpbmcgZGlyZWN0aW9uLCB3aXRoIHRoaXMgdmFyaWFibGUuIFRoZSBhYVNvcnRpbmcgYXJyYXkgc2hvdWxkIAoJCSAqIGNvbnRhaW4gYW4gYXJyYXkgZm9yIGVhY2ggY29sdW1uIHRvIGJlIHNvcnRlZCBpbml0aWFsbHkgY29udGFpbmluZyB0aGUgCgkJICogY29sdW1uJ3MgaW5kZXggYW5kIGEgZGlyZWN0aW9uIHN0cmluZyAoJ2FzYycgb3IgJ2Rlc2MnKS4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW1swLCdhc2MnXV0KCQkgKiAgQGR0b3B0IE9wdGlvbgoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFNvcnQgYnkgM3JkIGNvbHVtbiBmaXJzdCwgYW5kIHRoZW4gNHRoIGNvbHVtbgoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhYVNvcnRpbmciOiBbWzIsJ2FzYyddLCBbMywnZGVzYyddXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKiAgICAKCQkgKiAgICAvLyBObyBpbml0aWFsIHNvcnRpbmcKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYWFTb3J0aW5nIjogW10KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImFhU29ydGluZyI6IFtbMCwnYXNjJ11dLAoJCgkKCQkvKioKCQkgKiBUaGlzIHBhcmFtZXRlciBpcyBiYXNpY2FsbHkgaWRlbnRpY2FsIHRvIHRoZSBhYVNvcnRpbmcgcGFyYW1ldGVyLCBidXQgCgkJICogY2Fubm90IGJlIG92ZXJyaWRkZW4gYnkgdXNlciBpbnRlcmFjdGlvbiB3aXRoIHRoZSB0YWJsZS4gV2hhdCB0aGlzIG1lYW5zIAoJCSAqIGlzIHRoYXQgeW91IGNvdWxkIGhhdmUgYSBjb2x1bW4gKHZpc2libGUgb3IgaGlkZGVuKSB3aGljaCB0aGUgc29ydGluZyB3aWxsIAoJCSAqIGFsd2F5cyBiZSBmb3JjZWQgb24gZmlyc3QgLSBhbnkgc29ydGluZyBhZnRlciB0aGF0IChmcm9tIHRoZSB1c2VyKSB3aWxsIAoJCSAqIHRoZW4gYmUgcGVyZm9ybWVkIGFzIHJlcXVpcmVkLiBUaGlzIGNhbiBiZSB1c2VmdWwgZm9yIGdyb3VwaW5nIHJvd3MgCgkJICogdG9nZXRoZXIuCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IG51bGwKCQkgKiAgQGR0b3B0IE9wdGlvbgoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhYVNvcnRpbmdGaXhlZCI6IFtbMCwnYXNjJ11dCgkJICogICAgICB9ICk7CgkJICogICAgfSApCgkJICovCgkJImFhU29ydGluZ0ZpeGVkIjogbnVsbCwKCQoJCgkJLyoqCgkJICogVGhpcyBwYXJhbWV0ZXIgYWxsb3dzIHlvdSB0byByZWFkaWx5IHNwZWNpZnkgdGhlIGVudHJpZXMgaW4gdGhlIGxlbmd0aCBkcm9wCgkJICogZG93biBtZW51IHRoYXQgRGF0YVRhYmxlcyBzaG93cyB3aGVuIHBhZ2luYXRpb24gaXMgZW5hYmxlZC4gSXQgY2FuIGJlIAoJCSAqIGVpdGhlciBhIDFEIGFycmF5IG9mIG9wdGlvbnMgd2hpY2ggd2lsbCBiZSB1c2VkIGZvciBib3RoIHRoZSBkaXNwbGF5ZWQgCgkJICogb3B0aW9uIGFuZCB0aGUgdmFsdWUsIG9yIGEgMkQgYXJyYXkgd2hpY2ggd2lsbCB1c2UgdGhlIGFycmF5IGluIHRoZSBmaXJzdCAKCQkgKiBwb3NpdGlvbiBhcyB0aGUgdmFsdWUsIGFuZCB0aGUgYXJyYXkgaW4gdGhlIHNlY29uZCBwb3NpdGlvbiBhcyB0aGUgCgkJICogZGlzcGxheWVkIG9wdGlvbnMgKHVzZWZ1bCBmb3IgbGFuZ3VhZ2Ugc3RyaW5ncyBzdWNoIGFzICdBbGwnKS4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgWyAxMCwgMjUsIDUwLCAxMDAgXQoJCSAqICBAZHRvcHQgT3B0aW9uCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYUxlbmd0aE1lbnUiOiBbWzEwLCAyNSwgNTAsIC0xXSwgWzEwLCAyNSwgNTAsICJBbGwiXV0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFNldHRpbmcgdGhlIGRlZmF1bHQgZGlzcGxheSBsZW5ndGggYXMgd2VsbCBhcyBsZW5ndGggbWVudQoJCSAqICAgIC8vIFRoaXMgaXMgbGlrZWx5IHRvIGJlIHdhbnRlZCBpZiB5b3UgcmVtb3ZlIHRoZSAnMTAnIG9wdGlvbiB3aGljaAoJCSAqICAgIC8vIGlzIHRoZSBpRGlzcGxheUxlbmd0aCBkZWZhdWx0LgoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImlEaXNwbGF5TGVuZ3RoIjogMjUsCgkJICogICAgICAgICJhTGVuZ3RoTWVudSI6IFtbMjUsIDUwLCAxMDAsIC0xXSwgWzI1LCA1MCwgMTAwLCAiQWxsIl1dCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJhTGVuZ3RoTWVudSI6IFsgMTAsIDI1LCA1MCwgMTAwIF0sCgkKCQoJCS8qKgoJCSAqIFRoZSBhb0NvbHVtbnMgb3B0aW9uIGluIHRoZSBpbml0aWFsaXNhdGlvbiBwYXJhbWV0ZXIgYWxsb3dzIHlvdSB0byBkZWZpbmUKCQkgKiBkZXRhaWxzIGFib3V0IHRoZSB3YXkgaW5kaXZpZHVhbCBjb2x1bW5zIGJlaGF2ZS4gRm9yIGEgZnVsbCBsaXN0IG9mCgkJICogY29sdW1uIG9wdGlvbnMgdGhhdCBjYW4gYmUgc2V0LCBwbGVhc2Ugc2VlIAoJCSAqIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHMuY29sdW1uc30uIE5vdGUgdGhhdCBpZiB5b3UgdXNlIGFvQ29sdW1ucyB0bwoJCSAqIGRlZmluZSB5b3VyIGNvbHVtbnMsIHlvdSBtdXN0IGhhdmUgYW4gZW50cnkgaW4gdGhlIGFycmF5IGZvciBldmVyeSBzaW5nbGUKCQkgKiBjb2x1bW4gdGhhdCB5b3UgaGF2ZSBpbiB5b3VyIHRhYmxlICh0aGVzZSBjYW4gYmUgbnVsbCBpZiB5b3UgZG9uJ3Qgd2hpY2gKCQkgKiB0byBzcGVjaWZ5IGFueSBvcHRpb25zKS4KCQkgKiAgQG1lbWJlcgoJCSAqLwoJCSJhb0NvbHVtbnMiOiBudWxsLAoJCgkJLyoqCgkJICogVmVyeSBzaW1pbGFyIHRvIGFvQ29sdW1ucywgYW9Db2x1bW5EZWZzIGFsbG93cyB5b3UgdG8gdGFyZ2V0IGEgc3BlY2lmaWMgCgkJICogY29sdW1uLCBtdWx0aXBsZSBjb2x1bW5zLCBvciBhbGwgY29sdW1ucywgdXNpbmcgdGhlIGFUYXJnZXRzIHByb3BlcnR5IG9mIAoJCSAqIGVhY2ggb2JqZWN0IGluIHRoZSBhcnJheS4gVGhpcyBhbGxvd3MgZ3JlYXQgZmxleGliaWxpdHkgd2hlbiBjcmVhdGluZyAKCQkgKiB0YWJsZXMsIGFzIHRoZSBhb0NvbHVtbkRlZnMgYXJyYXlzIGNhbiBiZSBvZiBhbnkgbGVuZ3RoLCB0YXJnZXRpbmcgdGhlIAoJCSAqIGNvbHVtbnMgeW91IHNwZWNpZmljYWxseSB3YW50LiBhb0NvbHVtbkRlZnMgbWF5IHVzZSBhbnkgb2YgdGhlIGNvbHVtbiAKCQkgKiBvcHRpb25zIGF2YWlsYWJsZToge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0cy5jb2x1bW5zfSwgYnV0IGl0IF9tdXN0XwoJCSAqIGhhdmUgYVRhcmdldHMgZGVmaW5lZCBpbiBlYWNoIG9iamVjdCBpbiB0aGUgYXJyYXkuIFZhbHVlcyBpbiB0aGUgYVRhcmdldHMKCQkgKiBhcnJheSBtYXkgYmU6CgkJICogICA8dWw+CgkJICogICAgIDxsaT5hIHN0cmluZyAtIGNsYXNzIG5hbWUgd2lsbCBiZSBtYXRjaGVkIG9uIHRoZSBUSCBmb3IgdGhlIGNvbHVtbjwvbGk+CgkJICogICAgIDxsaT4wIG9yIGEgcG9zaXRpdmUgaW50ZWdlciAtIGNvbHVtbiBpbmRleCBjb3VudGluZyBmcm9tIHRoZSBsZWZ0PC9saT4KCQkgKiAgICAgPGxpPmEgbmVnYXRpdmUgaW50ZWdlciAtIGNvbHVtbiBpbmRleCBjb3VudGluZyBmcm9tIHRoZSByaWdodDwvbGk+CgkJICogICAgIDxsaT50aGUgc3RyaW5nICJfYWxsIiAtIGFsbCBjb2x1bW5zIChpLmUuIGFzc2lnbiBhIGRlZmF1bHQpPC9saT4KCQkgKiAgIDwvdWw+CgkJICogIEBtZW1iZXIKCQkgKi8KCQkiYW9Db2x1bW5EZWZzIjogbnVsbCwKCQoJCgkJLyoqCgkJICogQmFzaWNhbGx5IHRoZSBzYW1lIGFzIG9TZWFyY2gsIHRoaXMgcGFyYW1ldGVyIGRlZmluZXMgdGhlIGluZGl2aWR1YWwgY29sdW1uCgkJICogZmlsdGVyaW5nIHN0YXRlIGF0IGluaXRpYWxpc2F0aW9uIHRpbWUuIFRoZSBhcnJheSBtdXN0IGJlIG9mIHRoZSBzYW1lIHNpemUgCgkJICogYXMgdGhlIG51bWJlciBvZiBjb2x1bW5zLCBhbmQgZWFjaCBlbGVtZW50IGJlIGFuIG9iamVjdCB3aXRoIHRoZSBwYXJhbWV0ZXJzCgkJICogInNTZWFyY2giIGFuZCAiYkVzY2FwZVJlZ2V4IiAodGhlIGxhdHRlciBpcyBvcHRpb25hbCkuICdudWxsJyBpcyBhbHNvCgkJICogYWNjZXB0ZWQgYW5kIHRoZSBkZWZhdWx0IHdpbGwgYmUgdXNlZC4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKiAgQGR0b3B0IE9wdGlvbgoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb1NlYXJjaENvbHMiOiBbCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICB7ICJzU2VhcmNoIjogIk15IGZpbHRlciIgfSwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIHsgInNTZWFyY2giOiAiXlswLTldIiwgImJFc2NhcGVSZWdleCI6IGZhbHNlIH0KCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKQoJCSAqLwoJCSJhb1NlYXJjaENvbHMiOiBbXSwKCQoJCgkJLyoqCgkJICogQW4gYXJyYXkgb2YgQ1NTIGNsYXNzZXMgdGhhdCBzaG91bGQgYmUgYXBwbGllZCB0byBkaXNwbGF5ZWQgcm93cy4gVGhpcyAKCQkgKiBhcnJheSBtYXkgYmUgb2YgYW55IGxlbmd0aCwgYW5kIERhdGFUYWJsZXMgd2lsbCBhcHBseSBlYWNoIGNsYXNzIAoJCSAqIHNlcXVlbnRpYWxseSwgbG9vcGluZyB3aGVuIHJlcXVpcmVkLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBudWxsIDxpPldpbGwgdGFrZSB0aGUgdmFsdWVzIGRldGVybWludGVkIGJ5IHRoZSBvQ2xhc3Nlcy5zU3RyaXBlKgoJCSAqICAgIG9wdGlvbnM8L2k+CgkJICogIEBkdG9wdCBPcHRpb24KCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYXNTdHJpcGVDbGFzc2VzIjogWyAnc3RyaXAxJywgJ3N0cmlwMicsICdzdHJpcDMnIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICkKCQkgKi8KCQkiYXNTdHJpcGVDbGFzc2VzIjogbnVsbCwKCQoJCgkJLyoqCgkJICogRW5hYmxlIG9yIGRpc2FibGUgYXV0b21hdGljIGNvbHVtbiB3aWR0aCBjYWxjdWxhdGlvbi4gVGhpcyBjYW4gYmUgZGlzYWJsZWQKCQkgKiBhcyBhbiBvcHRpbWlzYXRpb24gKGl0IHRha2VzIHNvbWUgdGltZSB0byBjYWxjdWxhdGUgdGhlIHdpZHRocykgaWYgdGhlCgkJICogdGFibGVzIHdpZHRocyBhcmUgcGFzc2VkIGluIHVzaW5nIGFvQ29sdW1ucy4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCB0cnVlCgkJICogIEBkdG9wdCBGZWF0dXJlcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYkF1dG9XaWR0aCI6IGZhbHNlCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJiQXV0b1dpZHRoIjogdHJ1ZSwKCQoJCgkJLyoqCgkJICogRGVmZXJyZWQgcmVuZGVyaW5nIGNhbiBwcm92aWRlIERhdGFUYWJsZXMgd2l0aCBhIGh1Z2Ugc3BlZWQgYm9vc3Qgd2hlbiB5b3UKCQkgKiBhcmUgdXNpbmcgYW4gQWpheCBvciBKUyBkYXRhIHNvdXJjZSBmb3IgdGhlIHRhYmxlLiBUaGlzIG9wdGlvbiwgd2hlbiBzZXQgdG8KCQkgKiB0cnVlLCB3aWxsIGNhdXNlIERhdGFUYWJsZXMgdG8gZGVmZXIgdGhlIGNyZWF0aW9uIG9mIHRoZSB0YWJsZSBlbGVtZW50cyBmb3IKCQkgKiBlYWNoIHJvdyB1bnRpbCB0aGV5IGFyZSBuZWVkZWQgZm9yIGEgZHJhdyAtIHNhdmluZyBhIHNpZ25pZmljYW50IGFtb3VudCBvZgoJCSAqIHRpbWUuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkgKiAgQGR0b3B0IEZlYXR1cmVzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgInNBamF4U291cmNlIjogInNvdXJjZXMvYXJyYXlzLnR4dCIsCgkJICogICAgICAgICJiRGVmZXJSZW5kZXIiOiB0cnVlCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJiRGVmZXJSZW5kZXIiOiBmYWxzZSwKCQoJCgkJLyoqCgkJICogUmVwbGFjZSBhIERhdGFUYWJsZSB3aGljaCBtYXRjaGVzIHRoZSBnaXZlbiBzZWxlY3RvciBhbmQgcmVwbGFjZSBpdCB3aXRoIAoJCSAqIG9uZSB3aGljaCBoYXMgdGhlIHByb3BlcnRpZXMgb2YgdGhlIG5ldyBpbml0aWFsaXNhdGlvbiBvYmplY3QgcGFzc2VkLiBJZiBubwoJCSAqIHRhYmxlIG1hdGNoZXMgdGhlIHNlbGVjdG9yLCB0aGVuIHRoZSBuZXcgRGF0YVRhYmxlIHdpbGwgYmUgY29uc3RydWN0ZWQgYXMKCQkgKiBwZXIgbm9ybWFsLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IGZhbHNlCgkJICogIEBkdG9wdCBPcHRpb25zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic1Njcm9sbFkiOiAiMjAwcHgiLAoJCSAqICAgICAgICAiYlBhZ2luYXRlIjogZmFsc2UKCQkgKiAgICAgIH0gKTsKCQkgKiAgICAgIAoJCSAqICAgICAgLy8gU29tZSB0aW1lIGxhdGVyLi4uLgoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJGaWx0ZXIiOiBmYWxzZSwKCQkgKiAgICAgICAgImJEZXN0cm95IjogdHJ1ZQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYkRlc3Ryb3kiOiBmYWxzZSwKCQoJCgkJLyoqCgkJICogRW5hYmxlIG9yIGRpc2FibGUgZmlsdGVyaW5nIG9mIGRhdGEuIEZpbHRlcmluZyBpbiBEYXRhVGFibGVzIGlzICJzbWFydCIgaW4KCQkgKiB0aGF0IGl0IGFsbG93cyB0aGUgZW5kIHVzZXIgdG8gaW5wdXQgbXVsdGlwbGUgd29yZHMgKHNwYWNlIHNlcGFyYXRlZCkgYW5kCgkJICogd2lsbCBtYXRjaCBhIHJvdyBjb250YWluaW5nIHRob3NlIHdvcmRzLCBldmVuIGlmIG5vdCBpbiB0aGUgb3JkZXIgdGhhdCB3YXMKCQkgKiBzcGVjaWZpZWQgKHRoaXMgYWxsb3cgbWF0Y2hpbmcgYWNyb3NzIG11bHRpcGxlIGNvbHVtbnMpLiBOb3RlIHRoYXQgaWYgeW91CgkJICogd2lzaCB0byB1c2UgZmlsdGVyaW5nIGluIERhdGFUYWJsZXMgdGhpcyBtdXN0IHJlbWFpbiAndHJ1ZScgLSB0byByZW1vdmUgdGhlCgkJICogZGVmYXVsdCBmaWx0ZXJpbmcgaW5wdXQgYm94IGFuZCByZXRhaW4gZmlsdGVyaW5nIGFiaWxpdGllcywgcGxlYXNlIHVzZQoJCSAqIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHMuc0RvbX0uCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgdHJ1ZQoJCSAqICBAZHRvcHQgRmVhdHVyZXMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24gKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJGaWx0ZXIiOiBmYWxzZQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYkZpbHRlciI6IHRydWUsCgkKCQoJCS8qKgoJCSAqIEVuYWJsZSBvciBkaXNhYmxlIHRoZSB0YWJsZSBpbmZvcm1hdGlvbiBkaXNwbGF5LiBUaGlzIHNob3dzIGluZm9ybWF0aW9uIAoJCSAqIGFib3V0IHRoZSBkYXRhIHRoYXQgaXMgY3VycmVudGx5IHZpc2libGUgb24gdGhlIHBhZ2UsIGluY2x1ZGluZyBpbmZvcm1hdGlvbgoJCSAqIGFib3V0IGZpbHRlcmVkIGRhdGEgaWYgdGhhdCBhY3Rpb24gaXMgYmVpbmcgcGVyZm9ybWVkLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IHRydWUKCQkgKiAgQGR0b3B0IEZlYXR1cmVzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiSW5mbyI6IGZhbHNlCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJiSW5mbyI6IHRydWUsCgkKCQoJCS8qKgoJCSAqIEVuYWJsZSBqUXVlcnkgVUkgVGhlbWVSb2xsZXIgc3VwcG9ydCAocmVxdWlyZWQgYXMgVGhlbWVSb2xsZXIgcmVxdWlyZXMgc29tZQoJCSAqIHNsaWdodGx5IGRpZmZlcmVudCBhbmQgYWRkaXRpb25hbCBtYXJrLXVwIGZyb20gd2hhdCBEYXRhVGFibGVzIGhhcwoJCSAqIHRyYWRpdGlvbmFsbHkgdXNlZCkuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkgKiAgQGR0b3B0IEZlYXR1cmVzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJKUXVlcnlVSSI6IHRydWUKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImJKUXVlcnlVSSI6IGZhbHNlLAoJCgkKCQkvKioKCQkgKiBBbGxvd3MgdGhlIGVuZCB1c2VyIHRvIHNlbGVjdCB0aGUgc2l6ZSBvZiBhIGZvcm1hdHRlZCBwYWdlIGZyb20gYSBzZWxlY3QKCQkgKiBtZW51IChzaXplcyBhcmUgMTAsIDI1LCA1MCBhbmQgMTAwKS4gUmVxdWlyZXMgcGFnaW5hdGlvbiAoYlBhZ2luYXRlKS4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCB0cnVlCgkJICogIEBkdG9wdCBGZWF0dXJlcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYkxlbmd0aENoYW5nZSI6IGZhbHNlCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJiTGVuZ3RoQ2hhbmdlIjogdHJ1ZSwKCQoJCgkJLyoqCgkJICogRW5hYmxlIG9yIGRpc2FibGUgcGFnaW5hdGlvbi4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCB0cnVlCgkJICogIEBkdG9wdCBGZWF0dXJlcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYlBhZ2luYXRlIjogZmFsc2UKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImJQYWdpbmF0ZSI6IHRydWUsCgkKCQoJCS8qKgoJCSAqIEVuYWJsZSBvciBkaXNhYmxlIHRoZSBkaXNwbGF5IG9mIGEgJ3Byb2Nlc3NpbmcnIGluZGljYXRvciB3aGVuIHRoZSB0YWJsZSBpcwoJCSAqIGJlaW5nIHByb2Nlc3NlZCAoZS5nLiBhIHNvcnQpLiBUaGlzIGlzIHBhcnRpY3VsYXJseSB1c2VmdWwgZm9yIHRhYmxlcyB3aXRoCgkJICogbGFyZ2UgYW1vdW50cyBvZiBkYXRhIHdoZXJlIGl0IGNhbiB0YWtlIGEgbm90aWNlYWJsZSBhbW91bnQgb2YgdGltZSB0byBzb3J0CgkJICogdGhlIGVudHJpZXMuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkgKiAgQGR0b3B0IEZlYXR1cmVzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiUHJvY2Vzc2luZyI6IHRydWUKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImJQcm9jZXNzaW5nIjogZmFsc2UsCgkKCQoJCS8qKgoJCSAqIFJldHJpZXZlIHRoZSBEYXRhVGFibGVzIG9iamVjdCBmb3IgdGhlIGdpdmVuIHNlbGVjdG9yLiBOb3RlIHRoYXQgaWYgdGhlCgkJICogdGFibGUgaGFzIGFscmVhZHkgYmVlbiBpbml0aWFsaXNlZCwgdGhpcyBwYXJhbWV0ZXIgd2lsbCBjYXVzZSBEYXRhVGFibGVzCgkJICogdG8gc2ltcGx5IHJldHVybiB0aGUgb2JqZWN0IHRoYXQgaGFzIGFscmVhZHkgYmVlbiBzZXQgdXAgLSBpdCB3aWxsIG5vdCB0YWtlCgkJICogYWNjb3VudCBvZiBhbnkgY2hhbmdlcyB5b3UgbWlnaHQgaGF2ZSBtYWRlIHRvIHRoZSBpbml0aWFsaXNhdGlvbiBvYmplY3QKCQkgKiBwYXNzZWQgdG8gRGF0YVRhYmxlcyAoc2V0dGluZyB0aGlzIHBhcmFtZXRlciB0byB0cnVlIGlzIGFuIGFja25vd2xlZGdlbWVudAoJCSAqIHRoYXQgeW91IHVuZGVyc3RhbmQgdGhpcykuIGJEZXN0cm95IGNhbiBiZSB1c2VkIHRvIHJlaW5pdGlhbGlzZSBhIHRhYmxlIGlmCgkJICogeW91IG5lZWQuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIGluaXRUYWJsZSgpOwoJCSAqICAgICAgdGFibGVBY3Rpb25zKCk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICAgIGZ1bmN0aW9uIGluaXRUYWJsZSAoKQoJCSAqICAgIHsKCQkgKiAgICAgIHJldHVybiAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic1Njcm9sbFkiOiAiMjAwcHgiLAoJCSAqICAgICAgICAiYlBhZ2luYXRlIjogZmFsc2UsCgkJICogICAgICAgICJiUmV0cmlldmUiOiB0cnVlCgkJICogICAgICB9ICk7CgkJICogICAgfQoJCSAqICAgIAoJCSAqICAgIGZ1bmN0aW9uIHRhYmxlQWN0aW9ucyAoKQoJCSAqICAgIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSBpbml0VGFibGUoKTsKCQkgKiAgICAgIC8vIHBlcmZvcm0gQVBJIG9wZXJhdGlvbnMgd2l0aCBvVGFibGUgCgkJICogICAgfQoJCSAqLwoJCSJiUmV0cmlldmUiOiBmYWxzZSwKCQoJCgkJLyoqCgkJICogSW5kaWNhdGUgaWYgRGF0YVRhYmxlcyBzaG91bGQgYmUgYWxsb3dlZCB0byBzZXQgdGhlIHBhZGRpbmcgLyBtYXJnaW4KCQkgKiBldGMgZm9yIHRoZSBzY3JvbGxpbmcgaGVhZGVyIGVsZW1lbnRzIG9yIG5vdC4gVHlwaWNhbGx5IHlvdSB3aWxsIHdhbnQKCQkgKiB0aGlzLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IHRydWUKCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU2Nyb2xsQXV0b0NzcyI6IGZhbHNlLAoJCSAqICAgICAgICAic1Njcm9sbFkiOiAiMjAwcHgiCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJiU2Nyb2xsQXV0b0NzcyI6IHRydWUsCgkKCQoJCS8qKgoJCSAqIFdoZW4gdmVydGljYWwgKHkpIHNjcm9sbGluZyBpcyBlbmFibGVkLCBEYXRhVGFibGVzIHdpbGwgZm9yY2UgdGhlIGhlaWdodCBvZgoJCSAqIHRoZSB0YWJsZSdzIHZpZXdwb3J0IHRvIHRoZSBnaXZlbiBoZWlnaHQgYXQgYWxsIHRpbWVzICh1c2VmdWwgZm9yIGxheW91dCkuCgkJICogSG93ZXZlciwgdGhpcyBjYW4gbG9vayBvZGQgd2hlbiBmaWx0ZXJpbmcgZGF0YSBkb3duIHRvIGEgc21hbGwgZGF0YSBzZXQsCgkJICogYW5kIHRoZSBmb290ZXIgaXMgbGVmdCAiZmxvYXRpbmciIGZ1cnRoZXIgZG93bi4gVGhpcyBwYXJhbWV0ZXIgKHdoZW4KCQkgKiBlbmFibGVkKSB3aWxsIGNhdXNlIERhdGFUYWJsZXMgdG8gY29sbGFwc2UgdGhlIHRhYmxlJ3Mgdmlld3BvcnQgZG93biB3aGVuCgkJICogdGhlIHJlc3VsdCBzZXQgd2lsbCBmaXQgd2l0aGluIHRoZSBnaXZlbiBZIGhlaWdodC4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCBmYWxzZQoJCSAqICBAZHRvcHQgT3B0aW9ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgInNTY3JvbGxZIjogIjIwMCIsCgkJICogICAgICAgICJiU2Nyb2xsQ29sbGFwc2UiOiB0cnVlCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJiU2Nyb2xsQ29sbGFwc2UiOiBmYWxzZSwKCQoJCgkJLyoqCgkJICogRW5hYmxlIGluZmluaXRlIHNjcm9sbGluZyBmb3IgRGF0YVRhYmxlcyAodG8gYmUgdXNlZCBpbiBjb21iaW5hdGlvbiB3aXRoCgkJICogc1Njcm9sbFkpLiBJbmZpbml0ZSBzY3JvbGxpbmcgbWVhbnMgdGhhdCBEYXRhVGFibGVzIHdpbGwgY29udGludWFsbHkgbG9hZAoJCSAqIGRhdGEgYXMgYSB1c2VyIHNjcm9sbHMgdGhyb3VnaCBhIHRhYmxlLCB3aGljaCBpcyB2ZXJ5IHVzZWZ1bCBmb3IgbGFyZ2UKCQkgKiBkYXRhc2V0LiBUaGlzIGNhbm5vdCBiZSB1c2VkIHdpdGggcGFnaW5hdGlvbiwgd2hpY2ggaXMgYXV0b21hdGljYWxseQoJCSAqIGRpc2FibGVkLiBOb3RlIC0gdGhlIFNjcm9sbGVyIGV4dHJhIGZvciBEYXRhVGFibGVzIGlzIHJlY29tbWVuZGVkIGluCgkJICogaW4gcHJlZmVyZW5jZSB0byB0aGlzIG9wdGlvbi4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCBmYWxzZQoJCSAqICBAZHRvcHQgRmVhdHVyZXMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU2Nyb2xsSW5maW5pdGUiOiB0cnVlLAoJCSAqICAgICAgICAiYlNjcm9sbENvbGxhcHNlIjogdHJ1ZSwKCQkgKiAgICAgICAgInNTY3JvbGxZIjogIjIwMHB4IgoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYlNjcm9sbEluZmluaXRlIjogZmFsc2UsCgkKCQoJCS8qKgoJCSAqIENvbmZpZ3VyZSBEYXRhVGFibGVzIHRvIHVzZSBzZXJ2ZXItc2lkZSBwcm9jZXNzaW5nLiBOb3RlIHRoYXQgdGhlCgkJICogc0FqYXhTb3VyY2UgcGFyYW1ldGVyIG11c3QgYWxzbyBiZSBnaXZlbiBpbiBvcmRlciB0byBnaXZlIERhdGFUYWJsZXMgYQoJCSAqIHNvdXJjZSB0byBvYnRhaW4gdGhlIHJlcXVpcmVkIGRhdGEgZm9yIGVhY2ggZHJhdy4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCBmYWxzZQoJCSAqICBAZHRvcHQgRmVhdHVyZXMKCQkgKiAgQGR0b3B0IFNlcnZlci1zaWRlCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU2VydmVyU2lkZSI6IHRydWUsCgkJICogICAgICAgICJzQWpheFNvdXJjZSI6ICJ4aHIucGhwIgoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYlNlcnZlclNpZGUiOiBmYWxzZSwKCQoJCgkJLyoqCgkJICogRW5hYmxlIG9yIGRpc2FibGUgc29ydGluZyBvZiBjb2x1bW5zLiBTb3J0aW5nIG9mIGluZGl2aWR1YWwgY29sdW1ucyBjYW4gYmUKCQkgKiBkaXNhYmxlZCBieSB0aGUgImJTb3J0YWJsZSIgb3B0aW9uIGZvciBlYWNoIGNvbHVtbi4KCQkgKiAgQHR5cGUgYm9vbGVhbgoJCSAqICBAZGVmYXVsdCB0cnVlCgkJICogIEBkdG9wdCBGZWF0dXJlcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYlNvcnQiOiBmYWxzZQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYlNvcnQiOiB0cnVlLAoJCgkKCQkvKioKCQkgKiBBbGxvd3MgY29udHJvbCBvdmVyIHdoZXRoZXIgRGF0YVRhYmxlcyBzaG91bGQgdXNlIHRoZSB0b3AgKHRydWUpIHVuaXF1ZQoJCSAqIGNlbGwgdGhhdCBpcyBmb3VuZCBmb3IgYSBzaW5nbGUgY29sdW1uLCBvciB0aGUgYm90dG9tIChmYWxzZSAtIGRlZmF1bHQpLgoJCSAqIFRoaXMgaXMgdXNlZnVsIHdoZW4gdXNpbmcgY29tcGxleCBoZWFkZXJzLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IGZhbHNlCgkJICogIEBkdG9wdCBPcHRpb25zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYlNvcnRDZWxsc1RvcCI6IHRydWUKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImJTb3J0Q2VsbHNUb3AiOiBmYWxzZSwKCQoJCgkJLyoqCgkJICogRW5hYmxlIG9yIGRpc2FibGUgdGhlIGFkZGl0aW9uIG9mIHRoZSBjbGFzc2VzICdzb3J0aW5nXzEnLCAnc29ydGluZ18yJyBhbmQKCQkgKiAnc29ydGluZ18zJyB0byB0aGUgY29sdW1ucyB3aGljaCBhcmUgY3VycmVudGx5IGJlaW5nIHNvcnRlZCBvbi4gVGhpcyBpcwoJCSAqIHByZXNlbnRlZCBhcyBhIGZlYXR1cmUgc3dpdGNoIGFzIGl0IGNhbiBpbmNyZWFzZSBwcm9jZXNzaW5nIHRpbWUgKHdoaWxlCgkJICogY2xhc3NlcyBhcmUgcmVtb3ZlZCBhbmQgYWRkZWQpIHNvIGZvciBsYXJnZSBkYXRhIHNldHMgeW91IG1pZ2h0IHdhbnQgdG8KCQkgKiB0dXJuIHRoaXMgb2ZmLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IHRydWUKCQkgKiAgQGR0b3B0IEZlYXR1cmVzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uICgpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU29ydENsYXNzZXMiOiBmYWxzZQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYlNvcnRDbGFzc2VzIjogdHJ1ZSwKCQoJCgkJLyoqCgkJICogRW5hYmxlIG9yIGRpc2FibGUgc3RhdGUgc2F2aW5nLiBXaGVuIGVuYWJsZWQgYSBjb29raWUgd2lsbCBiZSB1c2VkIHRvIHNhdmUKCQkgKiB0YWJsZSBkaXNwbGF5IGluZm9ybWF0aW9uIHN1Y2ggYXMgcGFnaW5hdGlvbiBpbmZvcm1hdGlvbiwgZGlzcGxheSBsZW5ndGgsCgkJICogZmlsdGVyaW5nIGFuZCBzb3J0aW5nLiBBcyBzdWNoIHdoZW4gdGhlIGVuZCB1c2VyIHJlbG9hZHMgdGhlIHBhZ2UgdGhlCgkJICogZGlzcGxheSBkaXNwbGF5IHdpbGwgbWF0Y2ggd2hhdCB0aHkgaGFkIHByZXZpb3VzbHkgc2V0IHVwLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IGZhbHNlCgkJICogIEBkdG9wdCBGZWF0dXJlcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYlN0YXRlU2F2ZSI6IHRydWUKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImJTdGF0ZVNhdmUiOiBmYWxzZSwKCQoJCgkJLyoqCgkJICogQ3VzdG9taXNlIHRoZSBjb29raWUgYW5kIC8gb3IgdGhlIHBhcmFtZXRlcnMgYmVpbmcgc3RvcmVkIHdoZW4gdXNpbmcKCQkgKiBEYXRhVGFibGVzIHdpdGggc3RhdGUgc2F2aW5nIGVuYWJsZWQuIFRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIHdoZW5ldmVyCgkJICogdGhlIGNvb2tpZSBpcyBtb2RpZmllZCwgYW5kIGl0IGV4cGVjdHMgYSBmdWxseSBmb3JtZWQgY29va2llIHN0cmluZyB0byBiZQoJCSAqIHJldHVybmVkLiBOb3RlIHRoYXQgdGhlIGRhdGEgb2JqZWN0IHBhc3NlZCBpbiBpcyBhIEphdmFzY3JpcHQgb2JqZWN0IHdoaWNoCgkJICogbXVzdCBiZSBjb252ZXJ0ZWQgdG8gYSBzdHJpbmcgKEpTT04uc3RyaW5naWZ5IGZvciBleGFtcGxlKS4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNOYW1lIE5hbWUgb2YgdGhlIGNvb2tpZSBkZWZpbmVkIGJ5IERhdGFUYWJsZXMKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9EYXRhIERhdGEgdG8gYmUgc3RvcmVkIGluIHRoZSBjb29raWUKCQkgKiAgQHBhcmFtIHtzdHJpbmd9IHNFeHBpcmVzIENvb2tpZSBleHBpcmVzIHN0cmluZwoJCSAqICBAcGFyYW0ge3N0cmluZ30gc1BhdGggUGF0aCBvZiB0aGUgY29va2llIHRvIHNldAoJCSAqICBAcmV0dXJucyB7c3RyaW5nfSBDb29raWUgZm9ybWF0dGVkIHN0cmluZyAod2hpY2ggc2hvdWxkIGJlIGVuY29kZWQgYnkKCQkgKiAgICB1c2luZyBlbmNvZGVVUklDb21wb25lbnQoKSkKCQkgKiAgQGR0b3B0IENhbGxiYWNrcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbiAoKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiZm5Db29raWVDYWxsYmFjayI6IGZ1bmN0aW9uIChzTmFtZSwgb0RhdGEsIHNFeHBpcmVzLCBzUGF0aCkgewoJCSAqICAgICAgICAgIC8vIEN1c3RvbWlzZSBvRGF0YSBvciBzTmFtZSBvciB3aGF0ZXZlciBlbHNlIGhlcmUKCQkgKiAgICAgICAgICByZXR1cm4gc05hbWUgKyAiPSIrSlNPTi5zdHJpbmdpZnkob0RhdGEpKyI7IGV4cGlyZXM9IiArIHNFeHBpcmVzICsiOyBwYXRoPSIgKyBzUGF0aDsKCQkgKiAgICAgICAgfQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiZm5Db29raWVDYWxsYmFjayI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIFRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIHdoZW4gYSBUUiBlbGVtZW50IGlzIGNyZWF0ZWQgKGFuZCBhbGwgVEQgY2hpbGQKCQkgKiBlbGVtZW50cyBoYXZlIGJlZW4gaW5zZXJ0ZWQpLCBvciByZWdpc3RlcmVkIGlmIHVzaW5nIGEgRE9NIHNvdXJjZSwgYWxsb3dpbmcKCQkgKiBtYW5pcHVsYXRpb24gb2YgdGhlIFRSIGVsZW1lbnQgKGFkZGluZyBjbGFzc2VzIGV0YykuCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7bm9kZX0gblJvdyAiVFIiIGVsZW1lbnQgZm9yIHRoZSBjdXJyZW50IHJvdwoJCSAqICBAcGFyYW0ge2FycmF5fSBhRGF0YSBSYXcgZGF0YSBhcnJheSBmb3IgdGhpcyByb3cKCQkgKiAgQHBhcmFtIHtpbnR9IGlEYXRhSW5kZXggVGhlIGluZGV4IG9mIHRoaXMgcm93IGluIGFvRGF0YQoJCSAqICBAZHRvcHQgQ2FsbGJhY2tzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiZm5DcmVhdGVkUm93IjogZnVuY3Rpb24oIG5Sb3csIGFEYXRhLCBpRGF0YUluZGV4ICkgewoJCSAqICAgICAgICAgIC8vIEJvbGQgdGhlIGdyYWRlIGZvciBhbGwgJ0EnIGdyYWRlIGJyb3dzZXJzCgkJICogICAgICAgICAgaWYgKCBhRGF0YVs0XSA9PSAiQSIgKQoJCSAqICAgICAgICAgIHsKCQkgKiAgICAgICAgICAgICQoJ3RkOmVxKDQpJywgblJvdykuaHRtbCggJzxiPkE8L2I+JyApOwoJCSAqICAgICAgICAgIH0KCQkgKiAgICAgICAgfQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiZm5DcmVhdGVkUm93IjogbnVsbCwKCQoJCgkJLyoqCgkJICogVGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgb24gZXZlcnkgJ2RyYXcnIGV2ZW50LCBhbmQgYWxsb3dzIHlvdSB0bwoJCSAqIGR5bmFtaWNhbGx5IG1vZGlmeSBhbnkgYXNwZWN0IHlvdSB3YW50IGFib3V0IHRoZSBjcmVhdGVkIERPTS4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAZHRvcHQgQ2FsbGJhY2tzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImZuRHJhd0NhbGxiYWNrIjogZnVuY3Rpb24oIG9TZXR0aW5ncyApIHsKCQkgKiAgICAgICAgICBhbGVydCggJ0RhdGFUYWJsZXMgaGFzIHJlZHJhd24gdGhlIHRhYmxlJyApOwoJCSAqICAgICAgICB9CgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJmbkRyYXdDYWxsYmFjayI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIElkZW50aWNhbCB0byBmbkhlYWRlckNhbGxiYWNrKCkgYnV0IGZvciB0aGUgdGFibGUgZm9vdGVyIHRoaXMgZnVuY3Rpb24KCQkgKiBhbGxvd3MgeW91IHRvIG1vZGlmeSB0aGUgdGFibGUgZm9vdGVyIG9uIGV2ZXJ5ICdkcmF3JyBldmVuLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAcGFyYW0ge25vZGV9IG5Gb290ICJUUiIgZWxlbWVudCBmb3IgdGhlIGZvb3RlcgoJCSAqICBAcGFyYW0ge2FycmF5fSBhRGF0YSBGdWxsIHRhYmxlIGRhdGEgKGFzIGRlcml2ZWQgZnJvbSB0aGUgb3JpZ2luYWwgSFRNTCkKCQkgKiAgQHBhcmFtIHtpbnR9IGlTdGFydCBJbmRleCBmb3IgdGhlIGN1cnJlbnQgZGlzcGxheSBzdGFydGluZyBwb2ludCBpbiB0aGUgCgkJICogICAgZGlzcGxheSBhcnJheQoJCSAqICBAcGFyYW0ge2ludH0gaUVuZCBJbmRleCBmb3IgdGhlIGN1cnJlbnQgZGlzcGxheSBlbmRpbmcgcG9pbnQgaW4gdGhlIAoJCSAqICAgIGRpc3BsYXkgYXJyYXkKCQkgKiAgQHBhcmFtIHthcnJheSBpbnR9IGFpRGlzcGxheSBJbmRleCBhcnJheSB0byB0cmFuc2xhdGUgdGhlIHZpc3VhbCBwb3NpdGlvbgoJCSAqICAgIHRvIHRoZSBmdWxsIGRhdGEgYXJyYXkKCQkgKiAgQGR0b3B0IENhbGxiYWNrcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJmbkZvb3RlckNhbGxiYWNrIjogZnVuY3Rpb24oIG5Gb290LCBhRGF0YSwgaVN0YXJ0LCBpRW5kLCBhaURpc3BsYXkgKSB7CgkJICogICAgICAgICAgbkZvb3QuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RoJylbMF0uaW5uZXJIVE1MID0gIlN0YXJ0aW5nIGluZGV4IGlzICIraVN0YXJ0OwoJCSAqICAgICAgICB9CgkJICogICAgICB9ICk7CgkJICogICAgfSApCgkJICovCgkJImZuRm9vdGVyQ2FsbGJhY2siOiBudWxsLAoJCgkKCQkvKioKCQkgKiBXaGVuIHJlbmRlcmluZyBsYXJnZSBudW1iZXJzIGluIHRoZSBpbmZvcm1hdGlvbiBlbGVtZW50IGZvciB0aGUgdGFibGUKCQkgKiAoaS5lLiAiU2hvd2luZyAxIHRvIDEwIG9mIDU3IGVudHJpZXMiKSBEYXRhVGFibGVzIHdpbGwgcmVuZGVyIGxhcmdlIG51bWJlcnMKCQkgKiB0byBoYXZlIGEgY29tbWEgc2VwYXJhdG9yIGZvciB0aGUgJ3Rob3VzYW5kcycgdW5pdHMgKGUuZy4gMSBtaWxsaW9uIGlzCgkJICogcmVuZGVyZWQgYXMgIjEsMDAwLDAwMCIpIHRvIGhlbHAgcmVhZGFiaWxpdHkgZm9yIHRoZSBlbmQgdXNlci4gVGhpcwoJCSAqIGZ1bmN0aW9uIHdpbGwgb3ZlcnJpZGUgdGhlIGRlZmF1bHQgbWV0aG9kIERhdGFUYWJsZXMgdXNlcy4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQG1lbWJlcgoJCSAqICBAcGFyYW0ge2ludH0gaUluIG51bWJlciB0byBiZSBmb3JtYXR0ZWQKCQkgKiAgQHJldHVybnMge3N0cmluZ30gZm9ybWF0dGVkIHN0cmluZyBmb3IgRGF0YVRhYmxlcyB0byBzaG93IHRoZSBudW1iZXIKCQkgKiAgQGR0b3B0IENhbGxiYWNrcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImZuRm9ybWF0TnVtYmVyIjogZnVuY3Rpb24gKCBpSW4gKSB7CgkJICogICAgICAgICAgaWYgKCBpSW4gJmx0OyAxMDAwICkgewoJCSAqICAgICAgICAgICAgcmV0dXJuIGlJbjsKCQkgKiAgICAgICAgICB9IGVsc2UgewoJCSAqICAgICAgICAgICAgdmFyIAoJCSAqICAgICAgICAgICAgICBzPShpSW4rIiIpLCAKCQkgKiAgICAgICAgICAgICAgYT1zLnNwbGl0KCIiKSwgb3V0PSIiLCAKCQkgKiAgICAgICAgICAgICAgaUxlbj1zLmxlbmd0aDsKCQkgKiAgICAgICAgICAgIAoJCSAqICAgICAgICAgICAgZm9yICggdmFyIGk9MCA7IGkmbHQ7aUxlbiA7IGkrKyApIHsKCQkgKiAgICAgICAgICAgICAgaWYgKCBpJTMgPT09IDAgJmFtcDsmYW1wOyBpICE9PSAwICkgewoJCSAqICAgICAgICAgICAgICAgIG91dCA9ICInIitvdXQ7CgkJICogICAgICAgICAgICAgIH0KCQkgKiAgICAgICAgICAgICAgb3V0ID0gYVtpTGVuLWktMV0rb3V0OwoJCSAqICAgICAgICAgICAgfQoJCSAqICAgICAgICAgIH0KCQkgKiAgICAgICAgICByZXR1cm4gb3V0OwoJCSAqICAgICAgICB9OwoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiZm5Gb3JtYXROdW1iZXIiOiBmdW5jdGlvbiAoIGlJbiApIHsKCQkJaWYgKCBpSW4gPCAxMDAwICkKCQkJewoJCQkJLy8gQSBzbWFsbCBvcHRpbWlzYXRpb24gZm9yIHdoYXQgaXMgbGlrZWx5IHRvIGJlIHRoZSBtYWpvcml0eSBvZiB1c2UgY2FzZXMKCQkJCXJldHVybiBpSW47CgkJCX0KCQoJCQl2YXIgcz0oaUluKyIiKSwgYT1zLnNwbGl0KCIiKSwgb3V0PSIiLCBpTGVuPXMubGVuZ3RoOwoJCQkKCQkJZm9yICggdmFyIGk9MCA7IGk8aUxlbiA7IGkrKyApCgkJCXsKCQkJCWlmICggaSUzID09PSAwICYmIGkgIT09IDAgKQoJCQkJewoJCQkJCW91dCA9IHRoaXMub0xhbmd1YWdlLnNJbmZvVGhvdXNhbmRzK291dDsKCQkJCX0KCQkJCW91dCA9IGFbaUxlbi1pLTFdK291dDsKCQkJfQoJCQlyZXR1cm4gb3V0OwoJCX0sCgkKCQoJCS8qKgoJCSAqIFRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIG9uIGV2ZXJ5ICdkcmF3JyBldmVudCwgYW5kIGFsbG93cyB5b3UgdG8KCQkgKiBkeW5hbWljYWxseSBtb2RpZnkgdGhlIGhlYWRlciByb3cuIFRoaXMgY2FuIGJlIHVzZWQgdG8gY2FsY3VsYXRlIGFuZAoJCSAqIGRpc3BsYXkgdXNlZnVsIGluZm9ybWF0aW9uIGFib3V0IHRoZSB0YWJsZS4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHtub2RlfSBuSGVhZCAiVFIiIGVsZW1lbnQgZm9yIHRoZSBoZWFkZXIKCQkgKiAgQHBhcmFtIHthcnJheX0gYURhdGEgRnVsbCB0YWJsZSBkYXRhIChhcyBkZXJpdmVkIGZyb20gdGhlIG9yaWdpbmFsIEhUTUwpCgkJICogIEBwYXJhbSB7aW50fSBpU3RhcnQgSW5kZXggZm9yIHRoZSBjdXJyZW50IGRpc3BsYXkgc3RhcnRpbmcgcG9pbnQgaW4gdGhlCgkJICogICAgZGlzcGxheSBhcnJheQoJCSAqICBAcGFyYW0ge2ludH0gaUVuZCBJbmRleCBmb3IgdGhlIGN1cnJlbnQgZGlzcGxheSBlbmRpbmcgcG9pbnQgaW4gdGhlCgkJICogICAgZGlzcGxheSBhcnJheQoJCSAqICBAcGFyYW0ge2FycmF5IGludH0gYWlEaXNwbGF5IEluZGV4IGFycmF5IHRvIHRyYW5zbGF0ZSB0aGUgdmlzdWFsIHBvc2l0aW9uCgkJICogICAgdG8gdGhlIGZ1bGwgZGF0YSBhcnJheQoJCSAqICBAZHRvcHQgQ2FsbGJhY2tzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImZuSGVhZGVyQ2FsbGJhY2siOiBmdW5jdGlvbiggbkhlYWQsIGFEYXRhLCBpU3RhcnQsIGlFbmQsIGFpRGlzcGxheSApIHsKCQkgKiAgICAgICAgICBuSGVhZC5nZXRFbGVtZW50c0J5VGFnTmFtZSgndGgnKVswXS5pbm5lckhUTUwgPSAiRGlzcGxheWluZyAiKyhpRW5kLWlTdGFydCkrIiByZWNvcmRzIjsKCQkgKiAgICAgICAgfQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKQoJCSAqLwoJCSJmbkhlYWRlckNhbGxiYWNrIjogbnVsbCwKCQoJCgkJLyoqCgkJICogVGhlIGluZm9ybWF0aW9uIGVsZW1lbnQgY2FuIGJlIHVzZWQgdG8gY29udmV5IGluZm9ybWF0aW9uIGFib3V0IHRoZSBjdXJyZW50CgkJICogc3RhdGUgb2YgdGhlIHRhYmxlLiBBbHRob3VnaCB0aGUgaW50ZXJuYXRpb25hbGlzYXRpb24gb3B0aW9ucyBwcmVzZW50ZWQgYnkKCQkgKiBEYXRhVGFibGVzIGFyZSBxdWl0ZSBjYXBhYmxlIG9mIGRlYWxpbmcgd2l0aCBtb3N0IGN1c3RvbWlzYXRpb25zLCB0aGVyZSBtYXkKCQkgKiBiZSB0aW1lcyB3aGVyZSB5b3Ugd2lzaCB0byBjdXN0b21pc2UgdGhlIHN0cmluZyBmdXJ0aGVyLiBUaGlzIGNhbGxiYWNrCgkJICogYWxsb3dzIHlvdSB0byBkbyBleGFjdGx5IHRoYXQuCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtpbnR9IGlTdGFydCBTdGFydGluZyBwb3NpdGlvbiBpbiBkYXRhIGZvciB0aGUgZHJhdwoJCSAqICBAcGFyYW0ge2ludH0gaUVuZCBFbmQgcG9zaXRpb24gaW4gZGF0YSBmb3IgdGhlIGRyYXcKCQkgKiAgQHBhcmFtIHtpbnR9IGlNYXggVG90YWwgbnVtYmVyIG9mIHJvd3MgaW4gdGhlIHRhYmxlIChyZWdhcmRsZXNzIG9mCgkJICogICAgZmlsdGVyaW5nKQoJCSAqICBAcGFyYW0ge2ludH0gaVRvdGFsIFRvdGFsIG51bWJlciBvZiByb3dzIGluIHRoZSBkYXRhIHNldCwgYWZ0ZXIgZmlsdGVyaW5nCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzUHJlIFRoZSBzdHJpbmcgdGhhdCBEYXRhVGFibGVzIGhhcyBmb3JtYXR0ZWQgdXNpbmcgaXQncwoJCSAqICAgIG93biBydWxlcwoJCSAqICBAcmV0dXJucyB7c3RyaW5nfSBUaGUgc3RyaW5nIHRvIGJlIGRpc3BsYXllZCBpbiB0aGUgaW5mb3JtYXRpb24gZWxlbWVudC4KCQkgKiAgQGR0b3B0IENhbGxiYWNrcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAiZm5JbmZvQ2FsbGJhY2siOiBmdW5jdGlvbiggb1NldHRpbmdzLCBpU3RhcnQsIGlFbmQsIGlNYXgsIGlUb3RhbCwgc1ByZSApIHsKCQkgKiAgICAgICAgcmV0dXJuIGlTdGFydCArIiB0byAiKyBpRW5kOwoJCSAqICAgICAgfQoJCSAqICAgIH0gKTsKCQkgKi8KCQkiZm5JbmZvQ2FsbGJhY2siOiBudWxsLAoJCgkKCQkvKioKCQkgKiBDYWxsZWQgd2hlbiB0aGUgdGFibGUgaGFzIGJlZW4gaW5pdGlhbGlzZWQuIE5vcm1hbGx5IERhdGFUYWJsZXMgd2lsbAoJCSAqIGluaXRpYWxpc2Ugc2VxdWVudGlhbGx5IGFuZCB0aGVyZSB3aWxsIGJlIG5vIG5lZWQgZm9yIHRoaXMgZnVuY3Rpb24sCgkJICogaG93ZXZlciwgdGhpcyBkb2VzIG5vdCBob2xkIHRydWUgd2hlbiB1c2luZyBleHRlcm5hbCBsYW5ndWFnZSBpbmZvcm1hdGlvbgoJCSAqIHNpbmNlIHRoYXQgaXMgb2J0YWluZWQgdXNpbmcgYW4gYXN5bmMgWEhSIGNhbGwuCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtvYmplY3R9IGpzb24gVGhlIEpTT04gb2JqZWN0IHJlcXVlc3QgZnJvbSB0aGUgc2VydmVyIC0gb25seQoJCSAqICAgIHByZXNlbnQgaWYgY2xpZW50LXNpZGUgQWpheCBzb3VyY2VkIGRhdGEgaXMgdXNlZAoJCSAqICBAZHRvcHQgQ2FsbGJhY2tzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImZuSW5pdENvbXBsZXRlIjogZnVuY3Rpb24ob1NldHRpbmdzLCBqc29uKSB7CgkJICogICAgICAgICAgYWxlcnQoICdEYXRhVGFibGVzIGhhcyBmaW5pc2hlZCBpdHMgaW5pdGlhbGlzYXRpb24uJyApOwoJCSAqICAgICAgICB9CgkJICogICAgICB9ICk7CgkJICogICAgfSApCgkJICovCgkJImZuSW5pdENvbXBsZXRlIjogbnVsbCwKCQoJCgkJLyoqCgkJICogQ2FsbGVkIGF0IHRoZSB2ZXJ5IHN0YXJ0IG9mIGVhY2ggdGFibGUgZHJhdyBhbmQgY2FuIGJlIHVzZWQgdG8gY2FuY2VsIHRoZQoJCSAqIGRyYXcgYnkgcmV0dXJuaW5nIGZhbHNlLCBhbnkgb3RoZXIgcmV0dXJuIChpbmNsdWRpbmcgdW5kZWZpbmVkKSByZXN1bHRzIGluCgkJICogdGhlIGZ1bGwgZHJhdyBvY2N1cnJpbmcpLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEByZXR1cm5zIHtib29sZWFufSBGYWxzZSB3aWxsIGNhbmNlbCB0aGUgZHJhdywgYW55dGhpbmcgZWxzZSAoaW5jbHVkaW5nIG5vCgkJICogICAgcmV0dXJuKSB3aWxsIGFsbG93IGl0IHRvIGNvbXBsZXRlLgoJCSAqICBAZHRvcHQgQ2FsbGJhY2tzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImZuUHJlRHJhd0NhbGxiYWNrIjogZnVuY3Rpb24oIG9TZXR0aW5ncyApIHsKCQkgKiAgICAgICAgICBpZiAoICQoJyN0ZXN0JykudmFsKCkgPT0gMSApIHsKCQkgKiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCQkgKiAgICAgICAgICB9CgkJICogICAgICAgIH0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImZuUHJlRHJhd0NhbGxiYWNrIjogbnVsbCwKCQoJCgkJLyoqCgkJICogVGhpcyBmdW5jdGlvbiBhbGxvd3MgeW91IHRvICdwb3N0IHByb2Nlc3MnIGVhY2ggcm93IGFmdGVyIGl0IGhhdmUgYmVlbgoJCSAqIGdlbmVyYXRlZCBmb3IgZWFjaCB0YWJsZSBkcmF3LCBidXQgYmVmb3JlIGl0IGlzIHJlbmRlcmVkIG9uIHNjcmVlbi4gVGhpcwoJCSAqIGZ1bmN0aW9uIG1pZ2h0IGJlIHVzZWQgZm9yIHNldHRpbmcgdGhlIHJvdyBjbGFzcyBuYW1lIGV0Yy4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHtub2RlfSBuUm93ICJUUiIgZWxlbWVudCBmb3IgdGhlIGN1cnJlbnQgcm93CgkJICogIEBwYXJhbSB7YXJyYXl9IGFEYXRhIFJhdyBkYXRhIGFycmF5IGZvciB0aGlzIHJvdwoJCSAqICBAcGFyYW0ge2ludH0gaURpc3BsYXlJbmRleCBUaGUgZGlzcGxheSBpbmRleCBmb3IgdGhlIGN1cnJlbnQgdGFibGUgZHJhdwoJCSAqICBAcGFyYW0ge2ludH0gaURpc3BsYXlJbmRleEZ1bGwgVGhlIGluZGV4IG9mIHRoZSBkYXRhIGluIHRoZSBmdWxsIGxpc3Qgb2YKCQkgKiAgICByb3dzIChhZnRlciBmaWx0ZXJpbmcpCgkJICogIEBkdG9wdCBDYWxsYmFja3MKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJmblJvd0NhbGxiYWNrIjogZnVuY3Rpb24oIG5Sb3csIGFEYXRhLCBpRGlzcGxheUluZGV4LCBpRGlzcGxheUluZGV4RnVsbCApIHsKCQkgKiAgICAgICAgICAvLyBCb2xkIHRoZSBncmFkZSBmb3IgYWxsICdBJyBncmFkZSBicm93c2VycwoJCSAqICAgICAgICAgIGlmICggYURhdGFbNF0gPT0gIkEiICkKCQkgKiAgICAgICAgICB7CgkJICogICAgICAgICAgICAkKCd0ZDplcSg0KScsIG5Sb3cpLmh0bWwoICc8Yj5BPC9iPicgKTsKCQkgKiAgICAgICAgICB9CgkJICogICAgICAgIH0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImZuUm93Q2FsbGJhY2siOiBudWxsLAoJCgkKCQkvKioKCQkgKiBUaGlzIHBhcmFtZXRlciBhbGxvd3MgeW91IHRvIG92ZXJyaWRlIHRoZSBkZWZhdWx0IGZ1bmN0aW9uIHdoaWNoIG9idGFpbnMKCQkgKiB0aGUgZGF0YSBmcm9tIHRoZSBzZXJ2ZXIgKCQuZ2V0SlNPTikgc28gc29tZXRoaW5nIG1vcmUgc3VpdGFibGUgZm9yIHlvdXIKCQkgKiBhcHBsaWNhdGlvbi4gRm9yIGV4YW1wbGUgeW91IGNvdWxkIHVzZSBQT1NUIGRhdGEsIG9yIHB1bGwgaW5mb3JtYXRpb24gZnJvbQoJCSAqIGEgR2VhcnMgb3IgQUlSIGRhdGFiYXNlLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAbWVtYmVyCgkJICogIEBwYXJhbSB7c3RyaW5nfSBzU291cmNlIEhUVFAgc291cmNlIHRvIG9idGFpbiB0aGUgZGF0YSBmcm9tIChzQWpheFNvdXJjZSkKCQkgKiAgQHBhcmFtIHthcnJheX0gYW9EYXRhIEEga2V5L3ZhbHVlIHBhaXIgb2JqZWN0IGNvbnRhaW5pbmcgdGhlIGRhdGEgdG8gc2VuZAoJCSAqICAgIHRvIHRoZSBzZXJ2ZXIKCQkgKiAgQHBhcmFtIHtmdW5jdGlvbn0gZm5DYWxsYmFjayB0byBiZSBjYWxsZWQgb24gY29tcGxldGlvbiBvZiB0aGUgZGF0YSBnZXQKCQkgKiAgICBwcm9jZXNzIHRoYXQgd2lsbCBkcmF3IHRoZSBkYXRhIG9uIHRoZSBwYWdlLgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBkdG9wdCBDYWxsYmFja3MKCQkgKiAgQGR0b3B0IFNlcnZlci1zaWRlCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gUE9TVCBkYXRhIHRvIHNlcnZlcgoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImJQcm9jZXNzaW5nIjogdHJ1ZSwKCQkgKiAgICAgICAgImJTZXJ2ZXJTaWRlIjogdHJ1ZSwKCQkgKiAgICAgICAgInNBamF4U291cmNlIjogInhoci5waHAiLAoJCSAqICAgICAgICAiZm5TZXJ2ZXJEYXRhIjogZnVuY3Rpb24gKCBzU291cmNlLCBhb0RhdGEsIGZuQ2FsbGJhY2ssIG9TZXR0aW5ncyApIHsKCQkgKiAgICAgICAgICBvU2V0dGluZ3MuanFYSFIgPSAkLmFqYXgoIHsKCQkgKiAgICAgICAgICAgICJkYXRhVHlwZSI6ICdqc29uJywgCgkJICogICAgICAgICAgICAidHlwZSI6ICJQT1NUIiwgCgkJICogICAgICAgICAgICAidXJsIjogc1NvdXJjZSwgCgkJICogICAgICAgICAgICAiZGF0YSI6IGFvRGF0YSwgCgkJICogICAgICAgICAgICAic3VjY2VzcyI6IGZuQ2FsbGJhY2sKCQkgKiAgICAgICAgICB9ICk7CgkJICogICAgICAgIH0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImZuU2VydmVyRGF0YSI6IGZ1bmN0aW9uICggc1VybCwgYW9EYXRhLCBmbkNhbGxiYWNrLCBvU2V0dGluZ3MgKSB7CgkJCW9TZXR0aW5ncy5qcVhIUiA9ICQuYWpheCggewoJCQkJInVybCI6ICBzVXJsLAoJCQkJImRhdGEiOiBhb0RhdGEsCgkJCQkic3VjY2VzcyI6IGZ1bmN0aW9uIChqc29uKSB7CgkJCQkJJChvU2V0dGluZ3Mub0luc3RhbmNlKS50cmlnZ2VyKCd4aHInLCBvU2V0dGluZ3MpOwoJCQkJCWZuQ2FsbGJhY2soIGpzb24gKTsKCQkJCX0sCgkJCQkiZGF0YVR5cGUiOiAianNvbiIsCgkJCQkiY2FjaGUiOiBmYWxzZSwKCQkJCSJ0eXBlIjogb1NldHRpbmdzLnNTZXJ2ZXJNZXRob2QsCgkJCQkiZXJyb3IiOiBmdW5jdGlvbiAoeGhyLCBlcnJvciwgdGhyb3duKSB7CgkJCQkJaWYgKCBlcnJvciA9PSAicGFyc2VyZXJyb3IiICkgewoJCQkJCQlvU2V0dGluZ3Mub0FwaS5fZm5Mb2coIG9TZXR0aW5ncywgMCwgIkRhdGFUYWJsZXMgd2FybmluZzogSlNPTiBkYXRhIGZyb20gIisKCQkJCQkJCSJzZXJ2ZXIgY291bGQgbm90IGJlIHBhcnNlZC4gVGhpcyBpcyBjYXVzZWQgYnkgYSBKU09OIGZvcm1hdHRpbmcgZXJyb3IuIiApOwoJCQkJCX0KCQkJCX0KCQkJfSApOwoJCX0sCgkKCQoJCS8qKgoJCSAqIEl0IGlzIG9mdGVuIHVzZWZ1bCB0byBzZW5kIGV4dHJhIGRhdGEgdG8gdGhlIHNlcnZlciB3aGVuIG1ha2luZyBhbiBBamF4CgkJICogcmVxdWVzdCAtIGZvciBleGFtcGxlIGN1c3RvbSBmaWx0ZXJpbmcgaW5mb3JtYXRpb24sIGFuZCB0aGlzIGNhbGxiYWNrCgkJICogZnVuY3Rpb24gbWFrZXMgaXQgdHJpdmlhbCB0byBzZW5kIGV4dHJhIGluZm9ybWF0aW9uIHRvIHRoZSBzZXJ2ZXIuIFRoZQoJCSAqIHBhc3NlZCBpbiBwYXJhbWV0ZXIgaXMgdGhlIGRhdGEgc2V0IHRoYXQgaGFzIGJlZW4gY29uc3RydWN0ZWQgYnkKCQkgKiBEYXRhVGFibGVzLCBhbmQgeW91IGNhbiBhZGQgdG8gdGhpcyBvciBtb2RpZnkgaXQgYXMgeW91IHJlcXVpcmUuCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7YXJyYXl9IGFvRGF0YSBEYXRhIGFycmF5IChhcnJheSBvZiBvYmplY3RzIHdoaWNoIGFyZSBuYW1lL3ZhbHVlCgkJICogICAgcGFpcnMpIHRoYXQgaGFzIGJlZW4gY29uc3RydWN0ZWQgYnkgRGF0YVRhYmxlcyBhbmQgd2lsbCBiZSBzZW50IHRvIHRoZQoJCSAqICAgIHNlcnZlci4gSW4gdGhlIGNhc2Ugb2YgQWpheCBzb3VyY2VkIGRhdGEgd2l0aCBzZXJ2ZXItc2lkZSBwcm9jZXNzaW5nCgkJICogICAgdGhpcyB3aWxsIGJlIGFuIGVtcHR5IGFycmF5LCBmb3Igc2VydmVyLXNpZGUgcHJvY2Vzc2luZyB0aGVyZSB3aWxsIGJlIGEKCQkgKiAgICBzaWduaWZpY2FudCBudW1iZXIgb2YgcGFyYW1ldGVycyEKCQkgKiAgQHJldHVybnMge3VuZGVmaW5lZH0gRW5zdXJlIHRoYXQgeW91IG1vZGlmeSB0aGUgYW9EYXRhIGFycmF5IHBhc3NlZCBpbiwKCQkgKiAgICBhcyB0aGlzIGlzIHBhc3NlZCBieSByZWZlcmVuY2UuCgkJICogIEBkdG9wdCBDYWxsYmFja3MKCQkgKiAgQGR0b3B0IFNlcnZlci1zaWRlCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYlByb2Nlc3NpbmciOiB0cnVlLAoJCSAqICAgICAgICAiYlNlcnZlclNpZGUiOiB0cnVlLAoJCSAqICAgICAgICAic0FqYXhTb3VyY2UiOiAic2NyaXB0cy9zZXJ2ZXJfcHJvY2Vzc2luZy5waHAiLAoJCSAqICAgICAgICAiZm5TZXJ2ZXJQYXJhbXMiOiBmdW5jdGlvbiAoIGFvRGF0YSApIHsKCQkgKiAgICAgICAgICBhb0RhdGEucHVzaCggeyAibmFtZSI6ICJtb3JlX2RhdGEiLCAidmFsdWUiOiAibXlfdmFsdWUiIH0gKTsKCQkgKiAgICAgICAgfQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiZm5TZXJ2ZXJQYXJhbXMiOiBudWxsLAoJCgkKCQkvKioKCQkgKiBMb2FkIHRoZSB0YWJsZSBzdGF0ZS4gV2l0aCB0aGlzIGZ1bmN0aW9uIHlvdSBjYW4gZGVmaW5lIGZyb20gd2hlcmUsIGFuZCBob3csIHRoZQoJCSAqIHN0YXRlIG9mIGEgdGFibGUgaXMgbG9hZGVkLiBCeSBkZWZhdWx0IERhdGFUYWJsZXMgd2lsbCBsb2FkIGZyb20gaXRzIHN0YXRlIHNhdmluZwoJCSAqIGNvb2tpZSwgYnV0IHlvdSBtaWdodCB3aXNoIHRvIHVzZSBsb2NhbCBzdG9yYWdlIChIVE1MNSkgb3IgYSBzZXJ2ZXItc2lkZSBkYXRhYmFzZS4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQG1lbWJlcgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEByZXR1cm4ge29iamVjdH0gVGhlIERhdGFUYWJsZXMgc3RhdGUgb2JqZWN0IHRvIGJlIGxvYWRlZAoJCSAqICBAZHRvcHQgQ2FsbGJhY2tzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYlN0YXRlU2F2ZSI6IHRydWUsCgkJICogICAgICAgICJmblN0YXRlTG9hZCI6IGZ1bmN0aW9uIChvU2V0dGluZ3MpIHsKCQkgKiAgICAgICAgICB2YXIgbzsKCQkgKiAgICAgICAgICAKCQkgKiAgICAgICAgICAvLyBTZW5kIGFuIEFqYXggcmVxdWVzdCB0byB0aGUgc2VydmVyIHRvIGdldCB0aGUgZGF0YS4gTm90ZSB0aGF0CgkJICogICAgICAgICAgLy8gdGhpcyBpcyBhIHN5bmNocm9ub3VzIHJlcXVlc3QuCgkJICogICAgICAgICAgJC5hamF4KCB7CgkJICogICAgICAgICAgICAidXJsIjogIi9zdGF0ZV9sb2FkIiwKCQkgKiAgICAgICAgICAgICJhc3luYyI6IGZhbHNlLAoJCSAqICAgICAgICAgICAgImRhdGFUeXBlIjogImpzb24iLAoJCSAqICAgICAgICAgICAgInN1Y2Nlc3MiOiBmdW5jdGlvbiAoanNvbikgewoJCSAqICAgICAgICAgICAgICBvID0ganNvbjsKCQkgKiAgICAgICAgICAgIH0KCQkgKiAgICAgICAgICB9ICk7CgkJICogICAgICAgICAgCgkJICogICAgICAgICAgcmV0dXJuIG87CgkJICogICAgICAgIH0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImZuU3RhdGVMb2FkIjogZnVuY3Rpb24gKCBvU2V0dGluZ3MgKSB7CgkJCXZhciBzRGF0YSA9IHRoaXMub0FwaS5fZm5SZWFkQ29va2llKCBvU2V0dGluZ3Muc0Nvb2tpZVByZWZpeCtvU2V0dGluZ3Muc0luc3RhbmNlICk7CgkJCXZhciBvRGF0YTsKCQoJCQl0cnkgewoJCQkJb0RhdGEgPSAodHlwZW9mICQucGFyc2VKU09OID09PSAnZnVuY3Rpb24nKSA/IAoJCQkJCSQucGFyc2VKU09OKHNEYXRhKSA6IGV2YWwoICcoJytzRGF0YSsnKScgKTsKCQkJfSBjYXRjaCAoZSkgewoJCQkJb0RhdGEgPSBudWxsOwoJCQl9CgkKCQkJcmV0dXJuIG9EYXRhOwoJCX0sCgkKCQoJCS8qKgoJCSAqIENhbGxiYWNrIHdoaWNoIGFsbG93cyBtb2RpZmljYXRpb24gb2YgdGhlIHNhdmVkIHN0YXRlIHByaW9yIHRvIGxvYWRpbmcgdGhhdCBzdGF0ZS4KCQkgKiBUaGlzIGNhbGxiYWNrIGlzIGNhbGxlZCB3aGVuIHRoZSB0YWJsZSBpcyBsb2FkaW5nIHN0YXRlIGZyb20gdGhlIHN0b3JlZCBkYXRhLCBidXQKCQkgKiBwcmlvciB0byB0aGUgc2V0dGluZ3Mgb2JqZWN0IGJlaW5nIG1vZGlmaWVkIGJ5IHRoZSBzYXZlZCBzdGF0ZS4gTm90ZSB0aGF0IGZvciAKCQkgKiBwbHVnLWluIGF1dGhvcnMsIHlvdSBzaG91bGQgdXNlIHRoZSAnc3RhdGVMb2FkUGFyYW1zJyBldmVudCB0byBsb2FkIHBhcmFtZXRlcnMgZm9yIAoJCSAqIGEgcGx1Zy1pbi4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge29iamVjdH0gb0RhdGEgVGhlIHN0YXRlIG9iamVjdCB0aGF0IGlzIHRvIGJlIGxvYWRlZAoJCSAqICBAZHRvcHQgQ2FsbGJhY2tzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gUmVtb3ZlIGEgc2F2ZWQgZmlsdGVyLCBzbyBmaWx0ZXJpbmcgaXMgbmV2ZXIgbG9hZGVkCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYlN0YXRlU2F2ZSI6IHRydWUsCgkJICogICAgICAgICJmblN0YXRlTG9hZFBhcmFtcyI6IGZ1bmN0aW9uIChvU2V0dGluZ3MsIG9EYXRhKSB7CgkJICogICAgICAgICAgb0RhdGEub1NlYXJjaC5zU2VhcmNoID0gIiI7CgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIERpc2FsbG93IHN0YXRlIGxvYWRpbmcgYnkgcmV0dXJuaW5nIGZhbHNlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYlN0YXRlU2F2ZSI6IHRydWUsCgkJICogICAgICAgICJmblN0YXRlTG9hZFBhcmFtcyI6IGZ1bmN0aW9uIChvU2V0dGluZ3MsIG9EYXRhKSB7CgkJICogICAgICAgICAgcmV0dXJuIGZhbHNlOwoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiZm5TdGF0ZUxvYWRQYXJhbXMiOiBudWxsLAoJCgkKCQkvKioKCQkgKiBDYWxsYmFjayB0aGF0IGlzIGNhbGxlZCB3aGVuIHRoZSBzdGF0ZSBoYXMgYmVlbiBsb2FkZWQgZnJvbSB0aGUgc3RhdGUgc2F2aW5nIG1ldGhvZAoJCSAqIGFuZCB0aGUgRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QgaGFzIGJlZW4gbW9kaWZpZWQgYXMgYSByZXN1bHQgb2YgdGhlIGxvYWRlZCBzdGF0ZS4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCSAqICBAcGFyYW0ge29iamVjdH0gb0RhdGEgVGhlIHN0YXRlIG9iamVjdCB0aGF0IHdhcyBsb2FkZWQKCQkgKiAgQGR0b3B0IENhbGxiYWNrcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFNob3cgYW4gYWxlcnQgd2l0aCB0aGUgZmlsdGVyaW5nIHZhbHVlIHRoYXQgd2FzIHNhdmVkCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYlN0YXRlU2F2ZSI6IHRydWUsCgkJICogICAgICAgICJmblN0YXRlTG9hZGVkIjogZnVuY3Rpb24gKG9TZXR0aW5ncywgb0RhdGEpIHsKCQkgKiAgICAgICAgICBhbGVydCggJ1NhdmVkIGZpbHRlciB3YXM6ICcrb0RhdGEub1NlYXJjaC5zU2VhcmNoICk7CgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJmblN0YXRlTG9hZGVkIjogbnVsbCwKCQoJCgkJLyoqCgkJICogU2F2ZSB0aGUgdGFibGUgc3RhdGUuIFRoaXMgZnVuY3Rpb24gYWxsb3dzIHlvdSB0byBkZWZpbmUgd2hlcmUgYW5kIGhvdyB0aGUgc3RhdGUKCQkgKiBpbmZvcm1hdGlvbiBmb3IgdGhlIHRhYmxlIGlzIHN0b3JlZCAtIGJ5IGRlZmF1bHQgaXQgd2lsbCB1c2UgYSBjb29raWUsIGJ1dCB5b3UKCQkgKiBtaWdodCB3YW50IHRvIHVzZSBsb2NhbCBzdG9yYWdlIChIVE1MNSkgb3IgYSBzZXJ2ZXItc2lkZSBkYXRhYmFzZS4KCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKiAgQG1lbWJlcgoJCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJICogIEBwYXJhbSB7b2JqZWN0fSBvRGF0YSBUaGUgc3RhdGUgb2JqZWN0IHRvIGJlIHNhdmVkCgkJICogIEBkdG9wdCBDYWxsYmFja3MKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU3RhdGVTYXZlIjogdHJ1ZSwKCQkgKiAgICAgICAgImZuU3RhdGVTYXZlIjogZnVuY3Rpb24gKG9TZXR0aW5ncywgb0RhdGEpIHsKCQkgKiAgICAgICAgICAvLyBTZW5kIGFuIEFqYXggcmVxdWVzdCB0byB0aGUgc2VydmVyIHdpdGggdGhlIHN0YXRlIG9iamVjdAoJCSAqICAgICAgICAgICQuYWpheCggewoJCSAqICAgICAgICAgICAgInVybCI6ICIvc3RhdGVfc2F2ZSIsCgkJICogICAgICAgICAgICAiZGF0YSI6IG9EYXRhLAoJCSAqICAgICAgICAgICAgImRhdGFUeXBlIjogImpzb24iLAoJCSAqICAgICAgICAgICAgIm1ldGhvZCI6ICJQT1NUIgoJCSAqICAgICAgICAgICAgInN1Y2Nlc3MiOiBmdW5jdGlvbiAoKSB7fQoJCSAqICAgICAgICAgIH0gKTsKCQkgKiAgICAgICAgfQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiZm5TdGF0ZVNhdmUiOiBmdW5jdGlvbiAoIG9TZXR0aW5ncywgb0RhdGEgKSB7CgkJCXRoaXMub0FwaS5fZm5DcmVhdGVDb29raWUoIAoJCQkJb1NldHRpbmdzLnNDb29raWVQcmVmaXgrb1NldHRpbmdzLnNJbnN0YW5jZSwgCgkJCQl0aGlzLm9BcGkuX2ZuSnNvblN0cmluZyhvRGF0YSksIAoJCQkJb1NldHRpbmdzLmlDb29raWVEdXJhdGlvbiwgCgkJCQlvU2V0dGluZ3Muc0Nvb2tpZVByZWZpeCwgCgkJCQlvU2V0dGluZ3MuZm5Db29raWVDYWxsYmFjawoJCQkpOwoJCX0sCgkKCQoJCS8qKgoJCSAqIENhbGxiYWNrIHdoaWNoIGFsbG93cyBtb2RpZmljYXRpb24gb2YgdGhlIHN0YXRlIHRvIGJlIHNhdmVkLiBDYWxsZWQgd2hlbiB0aGUgdGFibGUgCgkJICogaGFzIGNoYW5nZWQgc3RhdGUgYSBuZXcgc3RhdGUgc2F2ZSBpcyByZXF1aXJlZC4gVGhpcyBtZXRob2QgYWxsb3dzIG1vZGlmaWNhdGlvbiBvZgoJCSAqIHRoZSBzdGF0ZSBzYXZpbmcgb2JqZWN0IHByaW9yIHRvIGFjdHVhbGx5IGRvaW5nIHRoZSBzYXZlLCBpbmNsdWRpbmcgYWRkaXRpb24gb3IgCgkJICogb3RoZXIgc3RhdGUgcHJvcGVydGllcyBvciBtb2RpZmljYXRpb24uIE5vdGUgdGhhdCBmb3IgcGx1Zy1pbiBhdXRob3JzLCB5b3Ugc2hvdWxkIAoJCSAqIHVzZSB0aGUgJ3N0YXRlU2F2ZVBhcmFtcycgZXZlbnQgdG8gc2F2ZSBwYXJhbWV0ZXJzIGZvciBhIHBsdWctaW4uCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkgKiAgQHBhcmFtIHtvYmplY3R9IG9EYXRhIFRoZSBzdGF0ZSBvYmplY3QgdG8gYmUgc2F2ZWQKCQkgKiAgQGR0b3B0IENhbGxiYWNrcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFJlbW92ZSBhIHNhdmVkIGZpbHRlciwgc28gZmlsdGVyaW5nIGlzIG5ldmVyIHNhdmVkCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYlN0YXRlU2F2ZSI6IHRydWUsCgkJICogICAgICAgICJmblN0YXRlU2F2ZVBhcmFtcyI6IGZ1bmN0aW9uIChvU2V0dGluZ3MsIG9EYXRhKSB7CgkJICogICAgICAgICAgb0RhdGEub1NlYXJjaC5zU2VhcmNoID0gIiI7CgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJmblN0YXRlU2F2ZVBhcmFtcyI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIER1cmF0aW9uIG9mIHRoZSBjb29raWUgd2hpY2ggaXMgdXNlZCBmb3Igc3RvcmluZyBzZXNzaW9uIGluZm9ybWF0aW9uLiBUaGlzCgkJICogdmFsdWUgaXMgZ2l2ZW4gaW4gc2Vjb25kcy4KCQkgKiAgQHR5cGUgaW50CgkJICogIEBkZWZhdWx0IDcyMDAgPGk+KDIgaG91cnMpPC9pPgoJCSAqICBAZHRvcHQgT3B0aW9ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJpQ29va2llRHVyYXRpb24iOiA2MCo2MCoyNCAvLyAxIGRheQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKQoJCSAqLwoJCSJpQ29va2llRHVyYXRpb24iOiA3MjAwLAoJCgkKCQkvKioKCQkgKiBXaGVuIGVuYWJsZWQgRGF0YVRhYmxlcyB3aWxsIG5vdCBtYWtlIGEgcmVxdWVzdCB0byB0aGUgc2VydmVyIGZvciB0aGUgZmlyc3QKCQkgKiBwYWdlIGRyYXcgLSByYXRoZXIgaXQgd2lsbCB1c2UgdGhlIGRhdGEgYWxyZWFkeSBvbiB0aGUgcGFnZSAobm8gc29ydGluZyBldGMKCQkgKiB3aWxsIGJlIGFwcGxpZWQgdG8gaXQpLCB0aHVzIHNhdmluZyBvbiBhbiBYSFIgYXQgbG9hZCB0aW1lLiBpRGVmZXJMb2FkaW5nCgkJICogaXMgdXNlZCB0byBpbmRpY2F0ZSB0aGF0IGRlZmVycmVkIGxvYWRpbmcgaXMgcmVxdWlyZWQsIGJ1dCBpdCBpcyBhbHNvIHVzZWQKCQkgKiB0byB0ZWxsIERhdGFUYWJsZXMgaG93IG1hbnkgcmVjb3JkcyB0aGVyZSBhcmUgaW4gdGhlIGZ1bGwgdGFibGUgKGFsbG93aW5nCgkJICogdGhlIGluZm9ybWF0aW9uIGVsZW1lbnQgYW5kIHBhZ2luYXRpb24gdG8gYmUgZGlzcGxheWVkIGNvcnJlY3RseSkuIEluIHRoZSBjYXNlCgkJICogd2hlcmUgYSBmaWx0ZXJpbmcgaXMgYXBwbGllZCB0byB0aGUgdGFibGUgb24gaW5pdGlhbCBsb2FkLCB0aGlzIGNhbiBiZQoJCSAqIGluZGljYXRlZCBieSBnaXZpbmcgdGhlIHBhcmFtZXRlciBhcyBhbiBhcnJheSwgd2hlcmUgdGhlIGZpcnN0IGVsZW1lbnQgaXMKCQkgKiB0aGUgbnVtYmVyIG9mIHJlY29yZHMgYXZhaWxhYmxlIGFmdGVyIGZpbHRlcmluZyBhbmQgdGhlIHNlY29uZCBlbGVtZW50IGlzIHRoZQoJCSAqIG51bWJlciBvZiByZWNvcmRzIHdpdGhvdXQgZmlsdGVyaW5nIChhbGxvd2luZyB0aGUgdGFibGUgaW5mb3JtYXRpb24gZWxlbWVudAoJCSAqIHRvIGJlIHNob3duIGNvcnJlY3RseSkuCgkJICogIEB0eXBlIGludCB8IGFycmF5CgkJICogIEBkZWZhdWx0IG51bGwKCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyA1NyByZWNvcmRzIGF2YWlsYWJsZSBpbiB0aGUgdGFibGUsIG5vIGZpbHRlcmluZyBhcHBsaWVkCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYlNlcnZlclNpZGUiOiB0cnVlLAoJCSAqICAgICAgICAic0FqYXhTb3VyY2UiOiAic2NyaXB0cy9zZXJ2ZXJfcHJvY2Vzc2luZy5waHAiLAoJCSAqICAgICAgICAiaURlZmVyTG9hZGluZyI6IDU3CgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIDU3IHJlY29yZHMgYWZ0ZXIgZmlsdGVyaW5nLCAxMDAgd2l0aG91dCBmaWx0ZXJpbmcgKGFuIGluaXRpYWwgZmlsdGVyIGFwcGxpZWQpCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYlNlcnZlclNpZGUiOiB0cnVlLAoJCSAqICAgICAgICAic0FqYXhTb3VyY2UiOiAic2NyaXB0cy9zZXJ2ZXJfcHJvY2Vzc2luZy5waHAiLAoJCSAqICAgICAgICAiaURlZmVyTG9hZGluZyI6IFsgNTcsIDEwMCBdLAoJCSAqICAgICAgICAib1NlYXJjaCI6IHsKCQkgKiAgICAgICAgICAic1NlYXJjaCI6ICJteV9maWx0ZXIiCgkJICogICAgICAgIH0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImlEZWZlckxvYWRpbmciOiBudWxsLAoJCgkKCQkvKioKCQkgKiBOdW1iZXIgb2Ygcm93cyB0byBkaXNwbGF5IG9uIGEgc2luZ2xlIHBhZ2Ugd2hlbiB1c2luZyBwYWdpbmF0aW9uLiBJZgoJCSAqIGZlYXR1cmUgZW5hYmxlZCAoYkxlbmd0aENoYW5nZSkgdGhlbiB0aGUgZW5kIHVzZXIgd2lsbCBiZSBhYmxlIHRvIG92ZXJyaWRlCgkJICogdGhpcyB0byBhIGN1c3RvbSBzZXR0aW5nIHVzaW5nIGEgcG9wLXVwIG1lbnUuCgkJICogIEB0eXBlIGludAoJCSAqICBAZGVmYXVsdCAxMAoJCSAqICBAZHRvcHQgT3B0aW9ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJpRGlzcGxheUxlbmd0aCI6IDUwCgkJICogICAgICB9ICk7CgkJICogICAgfSApCgkJICovCgkJImlEaXNwbGF5TGVuZ3RoIjogMTAsCgkKCQoJCS8qKgoJCSAqIERlZmluZSB0aGUgc3RhcnRpbmcgcG9pbnQgZm9yIGRhdGEgZGlzcGxheSB3aGVuIHVzaW5nIERhdGFUYWJsZXMgd2l0aAoJCSAqIHBhZ2luYXRpb24uIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciBpcyB0aGUgbnVtYmVyIG9mIHJlY29yZHMsIHJhdGhlciB0aGFuCgkJICogdGhlIHBhZ2UgbnVtYmVyLCBzbyBpZiB5b3UgaGF2ZSAxMCByZWNvcmRzIHBlciBwYWdlIGFuZCB3YW50IHRvIHN0YXJ0IG9uCgkJICogdGhlIHRoaXJkIHBhZ2UsIGl0IHNob3VsZCBiZSAiMjAiLgoJCSAqICBAdHlwZSBpbnQKCQkgKiAgQGRlZmF1bHQgMAoJCSAqICBAZHRvcHQgT3B0aW9ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJpRGlzcGxheVN0YXJ0IjogMjAKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICkKCQkgKi8KCQkiaURpc3BsYXlTdGFydCI6IDAsCgkKCQoJCS8qKgoJCSAqIFRoZSBzY3JvbGwgZ2FwIGlzIHRoZSBhbW91bnQgb2Ygc2Nyb2xsaW5nIHRoYXQgaXMgbGVmdCB0byBnbyBiZWZvcmUKCQkgKiBEYXRhVGFibGVzIHdpbGwgbG9hZCB0aGUgbmV4dCAncGFnZScgb2YgZGF0YSBhdXRvbWF0aWNhbGx5LiBZb3UgdHlwaWNhbGx5CgkJICogd2FudCBhIGdhcCB3aGljaCBpcyBiaWcgZW5vdWdoIHRoYXQgdGhlIHNjcm9sbGluZyB3aWxsIGJlIHNtb290aCBmb3IgdGhlCgkJICogdXNlciwgd2hpbGUgbm90IHNvIGxhcmdlIHRoYXQgaXQgd2lsbCBsb2FkIG1vcmUgZGF0YSB0aGFuIG5lZWQuCgkJICogIEB0eXBlIGludAoJCSAqICBAZGVmYXVsdCAxMDAKCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU2Nyb2xsSW5maW5pdGUiOiB0cnVlLAoJCSAqICAgICAgICAiYlNjcm9sbENvbGxhcHNlIjogdHJ1ZSwKCQkgKiAgICAgICAgInNTY3JvbGxZIjogIjIwMHB4IiwKCQkgKiAgICAgICAgImlTY3JvbGxMb2FkR2FwIjogNTAKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImlTY3JvbGxMb2FkR2FwIjogMTAwLAoJCgkKCQkvKioKCQkgKiBCeSBkZWZhdWx0IERhdGFUYWJsZXMgYWxsb3dzIGtleWJvYXJkIG5hdmlnYXRpb24gb2YgdGhlIHRhYmxlIChzb3J0aW5nLCBwYWdpbmcsCgkJICogYW5kIGZpbHRlcmluZykgYnkgYWRkaW5nIGEgdGFiaW5kZXggYXR0cmlidXRlIHRvIHRoZSByZXF1aXJlZCBlbGVtZW50cy4gVGhpcwoJCSAqIGFsbG93cyB5b3UgdG8gdGFiIHRocm91Z2ggdGhlIGNvbnRyb2xzIGFuZCBwcmVzcyB0aGUgZW50ZXIga2V5IHRvIGFjdGl2YXRlIHRoZW0uCgkJICogVGhlIHRhYmluZGV4IGlzIGRlZmF1bHQgMCwgbWVhbmluZyB0aGF0IHRoZSB0YWIgZm9sbG93cyB0aGUgZmxvdyBvZiB0aGUgZG9jdW1lbnQuCgkJICogWW91IGNhbiBvdmVycnVsZSB0aGlzIHVzaW5nIHRoaXMgcGFyYW1ldGVyIGlmIHlvdSB3aXNoLiBVc2UgYSB2YWx1ZSBvZiAtMSB0bwoJCSAqIGRpc2FibGUgYnVpbHQtaW4ga2V5Ym9hcmQgbmF2aWdhdGlvbi4KCQkgKiAgQHR5cGUgaW50CgkJICogIEBkZWZhdWx0IDAKCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJpVGFiSW5kZXgiOiAxCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJpVGFiSW5kZXgiOiAwLAoJCgkKCQkvKioKCQkgKiBBbGwgc3RyaW5ncyB0aGF0IERhdGFUYWJsZXMgdXNlcyBpbiB0aGUgdXNlciBpbnRlcmZhY2UgdGhhdCBpdCBjcmVhdGVzCgkJICogYXJlIGRlZmluZWQgaW4gdGhpcyBvYmplY3QsIGFsbG93aW5nIHlvdSB0byBtb2RpZmllZCB0aGVtIGluZGl2aWR1YWxseSBvcgoJCSAqIGNvbXBsZXRlbHkgcmVwbGFjZSB0aGVtIGFsbCBhcyByZXF1aXJlZC4KCQkgKiAgQG5hbWVzcGFjZQoJCSAqLwoJCSJvTGFuZ3VhZ2UiOiB7CgkJCS8qKgoJCQkgKiBTdHJpbmdzIHRoYXQgYXJlIHVzZWQgZm9yIFdBSS1BUklBIGxhYmVscyBhbmQgY29udHJvbHMgb25seSAodGhlc2UgYXJlIG5vdAoJCQkgKiBhY3R1YWxseSB2aXNpYmxlIG9uIHRoZSBwYWdlLCBidXQgd2lsbCBiZSByZWFkIGJ5IHNjcmVlbnJlYWRlcnMsIGFuZCB0aHVzCgkJCSAqIG11c3QgYmUgaW50ZXJuYXRpb25hbGlzZWQgYXMgd2VsbCkuCgkJCSAqICBAbmFtZXNwYWNlCgkJCSAqLwoJCQkib0FyaWEiOiB7CgkJCQkvKioKCQkJCSAqIEFSSUEgbGFiZWwgdGhhdCBpcyBhZGRlZCB0byB0aGUgdGFibGUgaGVhZGVycyB3aGVuIHRoZSBjb2x1bW4gbWF5IGJlCgkJCQkgKiBzb3J0ZWQgYXNjZW5kaW5nIGJ5IGFjdGl2aW5nIHRoZSBjb2x1bW4gKGNsaWNrIG9yIHJldHVybiB3aGVuIGZvY3VzZWQpLgoJCQkJICogTm90ZSB0aGF0IHRoZSBjb2x1bW4gaGVhZGVyIGlzIHByZWZpeGVkIHRvIHRoaXMgc3RyaW5nLgoJCQkJICogIEB0eXBlIHN0cmluZwoJCQkJICogIEBkZWZhdWx0IDogYWN0aXZhdGUgdG8gc29ydCBjb2x1bW4gYXNjZW5kaW5nCgkJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCQkgKiAKCQkJCSAqICBAZXhhbXBsZQoJCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJCQkgKiAgICAgICAgIm9MYW5ndWFnZSI6IHsKCQkJCSAqICAgICAgICAgICJvQXJpYSI6IHsKCQkJCSAqICAgICAgICAgICAgInNTb3J0QXNjZW5kaW5nIjogIiAtIGNsaWNrL3JldHVybiB0byBzb3J0IGFzY2VuZGluZyIKCQkJCSAqICAgICAgICAgIH0KCQkJCSAqICAgICAgICB9CgkJCQkgKiAgICAgIH0gKTsKCQkJCSAqICAgIH0gKTsKCQkJCSAqLwoJCQkJInNTb3J0QXNjZW5kaW5nIjogIjogYWN0aXZhdGUgdG8gc29ydCBjb2x1bW4gYXNjZW5kaW5nIiwKCQoJCQkJLyoqCgkJCQkgKiBBUklBIGxhYmVsIHRoYXQgaXMgYWRkZWQgdG8gdGhlIHRhYmxlIGhlYWRlcnMgd2hlbiB0aGUgY29sdW1uIG1heSBiZQoJCQkJICogc29ydGVkIGRlc2NlbmRpbmcgYnkgYWN0aXZpbmcgdGhlIGNvbHVtbiAoY2xpY2sgb3IgcmV0dXJuIHdoZW4gZm9jdXNlZCkuCgkJCQkgKiBOb3RlIHRoYXQgdGhlIGNvbHVtbiBoZWFkZXIgaXMgcHJlZml4ZWQgdG8gdGhpcyBzdHJpbmcuCgkJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCQkgKiAgQGRlZmF1bHQgOiBhY3RpdmF0ZSB0byBzb3J0IGNvbHVtbiBhc2NlbmRpbmcKCQkJCSAqICBAZHRvcHQgTGFuZ3VhZ2UKCQkJCSAqIAoJCQkJICogIEBleGFtcGxlCgkJCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJCSAqICAgICAgICAib0xhbmd1YWdlIjogewoJCQkJICogICAgICAgICAgIm9BcmlhIjogewoJCQkJICogICAgICAgICAgICAic1NvcnREZXNjZW5kaW5nIjogIiAtIGNsaWNrL3JldHVybiB0byBzb3J0IGRlc2NlbmRpbmciCgkJCQkgKiAgICAgICAgICB9CgkJCQkgKiAgICAgICAgfQoJCQkJICogICAgICB9ICk7CgkJCQkgKiAgICB9ICk7CgkJCQkgKi8KCQkJCSJzU29ydERlc2NlbmRpbmciOiAiOiBhY3RpdmF0ZSB0byBzb3J0IGNvbHVtbiBkZXNjZW5kaW5nIgoJCQl9LAoJCgkJCS8qKgoJCQkgKiBQYWdpbmF0aW9uIHN0cmluZyB1c2VkIGJ5IERhdGFUYWJsZXMgZm9yIHRoZSB0d28gYnVpbHQtaW4gcGFnaW5hdGlvbgoJCQkgKiBjb250cm9sIHR5cGVzICgidHdvX2J1dHRvbiIgYW5kICJmdWxsX251bWJlcnMiKQoJCQkgKiAgQG5hbWVzcGFjZQoJCQkgKi8KCQkJIm9QYWdpbmF0ZSI6IHsKCQkJCS8qKgoJCQkJICogVGV4dCB0byB1c2Ugd2hlbiB1c2luZyB0aGUgJ2Z1bGxfbnVtYmVycycgdHlwZSBvZiBwYWdpbmF0aW9uIGZvciB0aGUKCQkJCSAqIGJ1dHRvbiB0byB0YWtlIHRoZSB1c2VyIHRvIHRoZSBmaXJzdCBwYWdlLgoJCQkJICogIEB0eXBlIHN0cmluZwoJCQkJICogIEBkZWZhdWx0IEZpcnN0CgkJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCQkgKiAKCQkJCSAqICBAZXhhbXBsZQoJCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJCQkgKiAgICAgICAgIm9MYW5ndWFnZSI6IHsKCQkJCSAqICAgICAgICAgICJvUGFnaW5hdGUiOiB7CgkJCQkgKiAgICAgICAgICAgICJzRmlyc3QiOiAiRmlyc3QgcGFnZSIKCQkJCSAqICAgICAgICAgIH0KCQkJCSAqICAgICAgICB9CgkJCQkgKiAgICAgIH0gKTsKCQkJCSAqICAgIH0gKTsKCQkJCSAqLwoJCQkJInNGaXJzdCI6ICJGaXJzdCIsCgkJCQoJCQkKCQkJCS8qKgoJCQkJICogVGV4dCB0byB1c2Ugd2hlbiB1c2luZyB0aGUgJ2Z1bGxfbnVtYmVycycgdHlwZSBvZiBwYWdpbmF0aW9uIGZvciB0aGUKCQkJCSAqIGJ1dHRvbiB0byB0YWtlIHRoZSB1c2VyIHRvIHRoZSBsYXN0IHBhZ2UuCgkJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCQkgKiAgQGRlZmF1bHQgTGFzdAoJCQkJICogIEBkdG9wdCBMYW5ndWFnZQoJCQkJICogCgkJCQkgKiAgQGV4YW1wbGUKCQkJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCQkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCQkgKiAgICAgICAgICAib1BhZ2luYXRlIjogewoJCQkJICogICAgICAgICAgICAic0xhc3QiOiAiTGFzdCBwYWdlIgoJCQkJICogICAgICAgICAgfQoJCQkJICogICAgICAgIH0KCQkJCSAqICAgICAgfSApOwoJCQkJICogICAgfSApOwoJCQkJICovCgkJCQkic0xhc3QiOiAiTGFzdCIsCgkJCQoJCQkKCQkJCS8qKgoJCQkJICogVGV4dCB0byB1c2Ugd2hlbiB1c2luZyB0aGUgJ2Z1bGxfbnVtYmVycycgdHlwZSBvZiBwYWdpbmF0aW9uIGZvciB0aGUKCQkJCSAqIGJ1dHRvbiB0byB0YWtlIHRoZSB1c2VyIHRvIHRoZSBuZXh0IHBhZ2UuCgkJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCQkgKiAgQGRlZmF1bHQgTmV4dAoJCQkJICogIEBkdG9wdCBMYW5ndWFnZQoJCQkJICogCgkJCQkgKiAgQGV4YW1wbGUKCQkJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCQkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCQkgKiAgICAgICAgICAib1BhZ2luYXRlIjogewoJCQkJICogICAgICAgICAgICAic05leHQiOiAiTmV4dCBwYWdlIgoJCQkJICogICAgICAgICAgfQoJCQkJICogICAgICAgIH0KCQkJCSAqICAgICAgfSApOwoJCQkJICogICAgfSApOwoJCQkJICovCgkJCQkic05leHQiOiAiTmV4dCIsCgkJCQoJCQkKCQkJCS8qKgoJCQkJICogVGV4dCB0byB1c2Ugd2hlbiB1c2luZyB0aGUgJ2Z1bGxfbnVtYmVycycgdHlwZSBvZiBwYWdpbmF0aW9uIGZvciB0aGUKCQkJCSAqIGJ1dHRvbiB0byB0YWtlIHRoZSB1c2VyIHRvIHRoZSBwcmV2aW91cyBwYWdlLgoJCQkJICogIEB0eXBlIHN0cmluZwoJCQkJICogIEBkZWZhdWx0IFByZXZpb3VzCgkJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCQkgKiAKCQkJCSAqICBAZXhhbXBsZQoJCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJCQkgKiAgICAgICAgIm9MYW5ndWFnZSI6IHsKCQkJCSAqICAgICAgICAgICJvUGFnaW5hdGUiOiB7CgkJCQkgKiAgICAgICAgICAgICJzUHJldmlvdXMiOiAiUHJldmlvdXMgcGFnZSIKCQkJCSAqICAgICAgICAgIH0KCQkJCSAqICAgICAgICB9CgkJCQkgKiAgICAgIH0gKTsKCQkJCSAqICAgIH0gKTsKCQkJCSAqLwoJCQkJInNQcmV2aW91cyI6ICJQcmV2aW91cyIKCQkJfSwKCQkKCQkJLyoqCgkJCSAqIFRoaXMgc3RyaW5nIGlzIHNob3duIGluIHByZWZlcmVuY2UgdG8gc1plcm9SZWNvcmRzIHdoZW4gdGhlIHRhYmxlIGlzCgkJCSAqIGVtcHR5IG9mIGRhdGEgKHJlZ2FyZGxlc3Mgb2YgZmlsdGVyaW5nKS4gTm90ZSB0aGF0IHRoaXMgaXMgYW4gb3B0aW9uYWwKCQkJICogcGFyYW1ldGVyIC0gaWYgaXQgaXMgbm90IGdpdmVuLCB0aGUgdmFsdWUgb2Ygc1plcm9SZWNvcmRzIHdpbGwgYmUgdXNlZAoJCQkgKiBpbnN0ZWFkIChlaXRoZXIgdGhlIGRlZmF1bHQgb3IgZ2l2ZW4gdmFsdWUpLgoJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCSAqICBAZGVmYXVsdCBObyBkYXRhIGF2YWlsYWJsZSBpbiB0YWJsZQoJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCSAqIAoJCQkgKiAgQGV4YW1wbGUKCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzRW1wdHlUYWJsZSI6ICJObyBkYXRhIGF2YWlsYWJsZSBpbiB0YWJsZSIKCQkJICogICAgICAgIH0KCQkJICogICAgICB9ICk7CgkJCSAqICAgIH0gKTsKCQkJICovCgkJCSJzRW1wdHlUYWJsZSI6ICJObyBkYXRhIGF2YWlsYWJsZSBpbiB0YWJsZSIsCgkJCgkJCgkJCS8qKgoJCQkgKiBUaGlzIHN0cmluZyBnaXZlcyBpbmZvcm1hdGlvbiB0byB0aGUgZW5kIHVzZXIgYWJvdXQgdGhlIGluZm9ybWF0aW9uIHRoYXQgCgkJCSAqIGlzIGN1cnJlbnQgb24gZGlzcGxheSBvbiB0aGUgcGFnZS4gVGhlIF9TVEFSVF8sIF9FTkRfIGFuZCBfVE9UQUxfIAoJCQkgKiB2YXJpYWJsZXMgYXJlIGFsbCBkeW5hbWljYWxseSByZXBsYWNlZCBhcyB0aGUgdGFibGUgZGlzcGxheSB1cGRhdGVzLCBhbmQgCgkJCSAqIGNhbiBiZSBmcmVlbHkgbW92ZWQgb3IgcmVtb3ZlZCBhcyB0aGUgbGFuZ3VhZ2UgcmVxdWlyZW1lbnRzIGNoYW5nZS4KCQkJICogIEB0eXBlIHN0cmluZwoJCQkgKiAgQGRlZmF1bHQgU2hvd2luZyBfU1RBUlRfIHRvIF9FTkRfIG9mIF9UT1RBTF8gZW50cmllcwoJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCSAqIAoJCQkgKiAgQGV4YW1wbGUKCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzSW5mbyI6ICJHb3QgYSB0b3RhbCBvZiBfVE9UQUxfIGVudHJpZXMgdG8gc2hvdyAoX1NUQVJUXyB0byBfRU5EXykiCgkJCSAqICAgICAgICB9CgkJCSAqICAgICAgfSApOwoJCQkgKiAgICB9ICk7CgkJCSAqLwoJCQkic0luZm8iOiAiU2hvd2luZyBfU1RBUlRfIHRvIF9FTkRfIG9mIF9UT1RBTF8gZW50cmllcyIsCgkJCgkJCgkJCS8qKgoJCQkgKiBEaXNwbGF5IGluZm9ybWF0aW9uIHN0cmluZyBmb3Igd2hlbiB0aGUgdGFibGUgaXMgZW1wdHkuIFR5cGljYWxseSB0aGUgCgkJCSAqIGZvcm1hdCBvZiB0aGlzIHN0cmluZyBzaG91bGQgbWF0Y2ggc0luZm8uCgkJCSAqICBAdHlwZSBzdHJpbmcKCQkJICogIEBkZWZhdWx0IFNob3dpbmcgMCB0byAwIG9mIDAgZW50cmllcwoJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCSAqIAoJCQkgKiAgQGV4YW1wbGUKCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzSW5mb0VtcHR5IjogIk5vIGVudHJpZXMgdG8gc2hvdyIKCQkJICogICAgICAgIH0KCQkJICogICAgICB9ICk7CgkJCSAqICAgIH0gKTsKCQkJICovCgkJCSJzSW5mb0VtcHR5IjogIlNob3dpbmcgMCB0byAwIG9mIDAgZW50cmllcyIsCgkJCgkJCgkJCS8qKgoJCQkgKiBXaGVuIGEgdXNlciBmaWx0ZXJzIHRoZSBpbmZvcm1hdGlvbiBpbiBhIHRhYmxlLCB0aGlzIHN0cmluZyBpcyBhcHBlbmRlZCAKCQkJICogdG8gdGhlIGluZm9ybWF0aW9uIChzSW5mbykgdG8gZ2l2ZSBhbiBpZGVhIG9mIGhvdyBzdHJvbmcgdGhlIGZpbHRlcmluZyAKCQkJICogaXMuIFRoZSB2YXJpYWJsZSBfTUFYXyBpcyBkeW5hbWljYWxseSB1cGRhdGVkLgoJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCSAqICBAZGVmYXVsdCAoZmlsdGVyZWQgZnJvbSBfTUFYXyB0b3RhbCBlbnRyaWVzKQoJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCSAqIAoJCQkgKiAgQGV4YW1wbGUKCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzSW5mb0ZpbHRlcmVkIjogIiAtIGZpbHRlcmluZyBmcm9tIF9NQVhfIHJlY29yZHMiCgkJCSAqICAgICAgICB9CgkJCSAqICAgICAgfSApOwoJCQkgKiAgICB9ICk7CgkJCSAqLwoJCQkic0luZm9GaWx0ZXJlZCI6ICIoZmlsdGVyZWQgZnJvbSBfTUFYXyB0b3RhbCBlbnRyaWVzKSIsCgkJCgkJCgkJCS8qKgoJCQkgKiBJZiBjYW4gYmUgdXNlZnVsIHRvIGFwcGVuZCBleHRyYSBpbmZvcm1hdGlvbiB0byB0aGUgaW5mbyBzdHJpbmcgYXQgdGltZXMsCgkJCSAqIGFuZCB0aGlzIHZhcmlhYmxlIGRvZXMgZXhhY3RseSB0aGF0LiBUaGlzIGluZm9ybWF0aW9uIHdpbGwgYmUgYXBwZW5kZWQgdG8KCQkJICogdGhlIHNJbmZvIChzSW5mb0VtcHR5IGFuZCBzSW5mb0ZpbHRlcmVkIGluIHdoYXRldmVyIGNvbWJpbmF0aW9uIHRoZXkgYXJlCgkJCSAqIGJlaW5nIHVzZWQpIGF0IGFsbCB0aW1lcy4KCQkJICogIEB0eXBlIHN0cmluZwoJCQkgKiAgQGRlZmF1bHQgPGk+RW1wdHkgc3RyaW5nPC9pPgoJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCSAqIAoJCQkgKiAgQGV4YW1wbGUKCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzSW5mb1Bvc3RGaXgiOiAiQWxsIHJlY29yZHMgc2hvd24gYXJlIGRlcml2ZWQgZnJvbSByZWFsIGluZm9ybWF0aW9uLiIKCQkJICogICAgICAgIH0KCQkJICogICAgICB9ICk7CgkJCSAqICAgIH0gKTsKCQkJICovCgkJCSJzSW5mb1Bvc3RGaXgiOiAiIiwKCQkKCQkKCQkJLyoqCgkJCSAqIERhdGFUYWJsZXMgaGFzIGEgYnVpbGQgaW4gbnVtYmVyIGZvcm1hdHRlciAoZm5Gb3JtYXROdW1iZXIpIHdoaWNoIGlzIHVzZWQKCQkJICogdG8gZm9ybWF0IGxhcmdlIG51bWJlcnMgdGhhdCBhcmUgdXNlZCBpbiB0aGUgdGFibGUgaW5mb3JtYXRpb24uIEJ5CgkJCSAqIGRlZmF1bHQgYSBjb21tYSBpcyB1c2VkLCBidXQgdGhpcyBjYW4gYmUgdHJpdmlhbGx5IGNoYW5nZWQgdG8gYW55CgkJCSAqIGNoYXJhY3RlciB5b3Ugd2lzaCB3aXRoIHRoaXMgcGFyYW1ldGVyLgoJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCSAqICBAZGVmYXVsdCAsCgkJCSAqICBAZHRvcHQgTGFuZ3VhZ2UKCQkJICogCgkJCSAqICBAZXhhbXBsZQoJCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCQkgKiAgICAgICAgIm9MYW5ndWFnZSI6IHsKCQkJICogICAgICAgICAgInNJbmZvVGhvdXNhbmRzIjogIiciCgkJCSAqICAgICAgICB9CgkJCSAqICAgICAgfSApOwoJCQkgKiAgICB9ICk7CgkJCSAqLwoJCQkic0luZm9UaG91c2FuZHMiOiAiLCIsCgkJCgkJCgkJCS8qKgoJCQkgKiBEZXRhaWwgdGhlIGFjdGlvbiB0aGF0IHdpbGwgYmUgdGFrZW4gd2hlbiB0aGUgZHJvcCBkb3duIG1lbnUgZm9yIHRoZQoJCQkgKiBwYWdpbmF0aW9uIGxlbmd0aCBvcHRpb24gaXMgY2hhbmdlZC4gVGhlICdfTUVOVV8nIHZhcmlhYmxlIGlzIHJlcGxhY2VkCgkJCSAqIHdpdGggYSBkZWZhdWx0IHNlbGVjdCBsaXN0IG9mIDEwLCAyNSwgNTAgYW5kIDEwMCwgYW5kIGNhbiBiZSByZXBsYWNlZAoJCQkgKiB3aXRoIGEgY3VzdG9tIHNlbGVjdCBib3ggaWYgcmVxdWlyZWQuCgkJCSAqICBAdHlwZSBzdHJpbmcKCQkJICogIEBkZWZhdWx0IFNob3cgX01FTlVfIGVudHJpZXMKCQkJICogIEBkdG9wdCBMYW5ndWFnZQoJCQkgKiAKCQkJICogIEBleGFtcGxlCgkJCSAqICAgIC8vIExhbmd1YWdlIGNoYW5nZSBvbmx5CgkJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJCSAqICAgICAgICAib0xhbmd1YWdlIjogewoJCQkgKiAgICAgICAgICAic0xlbmd0aE1lbnUiOiAiRGlzcGxheSBfTUVOVV8gcmVjb3JkcyIKCQkJICogICAgICAgIH0KCQkJICogICAgICB9ICk7CgkJCSAqICAgIH0gKTsKCQkJICogICAgCgkJCSAqICBAZXhhbXBsZQoJCQkgKiAgICAvLyBMYW5ndWFnZSBhbmQgb3B0aW9ucyBjaGFuZ2UKCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzTGVuZ3RoTWVudSI6ICdEaXNwbGF5IDxzZWxlY3Q+JysKCQkJICogICAgICAgICAgICAnPG9wdGlvbiB2YWx1ZT0iMTAiPjEwPC9vcHRpb24+JysKCQkJICogICAgICAgICAgICAnPG9wdGlvbiB2YWx1ZT0iMjAiPjIwPC9vcHRpb24+JysKCQkJICogICAgICAgICAgICAnPG9wdGlvbiB2YWx1ZT0iMzAiPjMwPC9vcHRpb24+JysKCQkJICogICAgICAgICAgICAnPG9wdGlvbiB2YWx1ZT0iNDAiPjQwPC9vcHRpb24+JysKCQkJICogICAgICAgICAgICAnPG9wdGlvbiB2YWx1ZT0iNTAiPjUwPC9vcHRpb24+JysKCQkJICogICAgICAgICAgICAnPG9wdGlvbiB2YWx1ZT0iLTEiPkFsbDwvb3B0aW9uPicrCgkJCSAqICAgICAgICAgICAgJzwvc2VsZWN0PiByZWNvcmRzJwoJCQkgKiAgICAgICAgfQoJCQkgKiAgICAgIH0gKTsKCQkJICogICAgfSApOwoJCQkgKi8KCQkJInNMZW5ndGhNZW51IjogIlNob3cgX01FTlVfIGVudHJpZXMiLAoJCQoJCQoJCQkvKioKCQkJICogV2hlbiB1c2luZyBBamF4IHNvdXJjZWQgZGF0YSBhbmQgZHVyaW5nIHRoZSBmaXJzdCBkcmF3IHdoZW4gRGF0YVRhYmxlcyBpcwoJCQkgKiBnYXRoZXJpbmcgdGhlIGRhdGEsIHRoaXMgbWVzc2FnZSBpcyBzaG93biBpbiBhbiBlbXB0eSByb3cgaW4gdGhlIHRhYmxlIHRvCgkJCSAqIGluZGljYXRlIHRvIHRoZSBlbmQgdXNlciB0aGUgdGhlIGRhdGEgaXMgYmVpbmcgbG9hZGVkLiBOb3RlIHRoYXQgdGhpcwoJCQkgKiBwYXJhbWV0ZXIgaXMgbm90IHVzZWQgd2hlbiBsb2FkaW5nIGRhdGEgYnkgc2VydmVyLXNpZGUgcHJvY2Vzc2luZywganVzdAoJCQkgKiBBamF4IHNvdXJjZWQgZGF0YSB3aXRoIGNsaWVudC1zaWRlIHByb2Nlc3NpbmcuCgkJCSAqICBAdHlwZSBzdHJpbmcKCQkJICogIEBkZWZhdWx0IExvYWRpbmcuLi4KCQkJICogIEBkdG9wdCBMYW5ndWFnZQoJCQkgKiAKCQkJICogIEBleGFtcGxlCgkJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KCBmdW5jdGlvbigpIHsKCQkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCQkgKiAgICAgICAgIm9MYW5ndWFnZSI6IHsKCQkJICogICAgICAgICAgInNMb2FkaW5nUmVjb3JkcyI6ICJQbGVhc2Ugd2FpdCAtIGxvYWRpbmcuLi4iCgkJCSAqICAgICAgICB9CgkJCSAqICAgICAgfSApOwoJCQkgKiAgICB9ICk7CgkJCSAqLwoJCQkic0xvYWRpbmdSZWNvcmRzIjogIkxvYWRpbmcuLi4iLAoJCQoJCQoJCQkvKioKCQkJICogVGV4dCB3aGljaCBpcyBkaXNwbGF5ZWQgd2hlbiB0aGUgdGFibGUgaXMgcHJvY2Vzc2luZyBhIHVzZXIgYWN0aW9uCgkJCSAqICh1c3VhbGx5IGEgc29ydCBjb21tYW5kIG9yIHNpbWlsYXIpLgoJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCSAqICBAZGVmYXVsdCBQcm9jZXNzaW5nLi4uCgkJCSAqICBAZHRvcHQgTGFuZ3VhZ2UKCQkJICogCgkJCSAqICBAZXhhbXBsZQoJCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCQkgKiAgICAgICAgIm9MYW5ndWFnZSI6IHsKCQkJICogICAgICAgICAgInNQcm9jZXNzaW5nIjogIkRhdGFUYWJsZXMgaXMgY3VycmVudGx5IGJ1c3kiCgkJCSAqICAgICAgICB9CgkJCSAqICAgICAgfSApOwoJCQkgKiAgICB9ICk7CgkJCSAqLwoJCQkic1Byb2Nlc3NpbmciOiAiUHJvY2Vzc2luZy4uLiIsCgkJCgkJCgkJCS8qKgoJCQkgKiBEZXRhaWxzIHRoZSBhY3Rpb25zIHRoYXQgd2lsbCBiZSB0YWtlbiB3aGVuIHRoZSB1c2VyIHR5cGVzIGludG8gdGhlCgkJCSAqIGZpbHRlcmluZyBpbnB1dCB0ZXh0IGJveC4gVGhlIHZhcmlhYmxlICJfSU5QVVRfIiwgaWYgdXNlZCBpbiB0aGUgc3RyaW5nLAoJCQkgKiBpcyByZXBsYWNlZCB3aXRoIHRoZSBIVE1MIHRleHQgYm94IGZvciB0aGUgZmlsdGVyaW5nIGlucHV0IGFsbG93aW5nCgkJCSAqIGNvbnRyb2wgb3ZlciB3aGVyZSBpdCBhcHBlYXJzIGluIHRoZSBzdHJpbmcuIElmICJfSU5QVVRfIiBpcyBub3QgZ2l2ZW4KCQkJICogdGhlbiB0aGUgaW5wdXQgYm94IGlzIGFwcGVuZGVkIHRvIHRoZSBzdHJpbmcgYXV0b21hdGljYWxseS4KCQkJICogIEB0eXBlIHN0cmluZwoJCQkgKiAgQGRlZmF1bHQgU2VhcmNoOgoJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCSAqIAoJCQkgKiAgQGV4YW1wbGUKCQkJICogICAgLy8gSW5wdXQgdGV4dCBib3ggd2lsbCBiZSBhcHBlbmRlZCBhdCB0aGUgZW5kIGF1dG9tYXRpY2FsbHkKCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzU2VhcmNoIjogIkZpbHRlciByZWNvcmRzOiIKCQkJICogICAgICAgIH0KCQkJICogICAgICB9ICk7CgkJCSAqICAgIH0gKTsKCQkJICogICAgCgkJCSAqICBAZXhhbXBsZQoJCQkgKiAgICAvLyBTcGVjaWZ5IHdoZXJlIHRoZSBmaWx0ZXIgc2hvdWxkIGFwcGVhcgoJCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCQkgKiAgICAgICAgIm9MYW5ndWFnZSI6IHsKCQkJICogICAgICAgICAgInNTZWFyY2giOiAiQXBwbHkgZmlsdGVyIF9JTlBVVF8gdG8gdGFibGUiCgkJCSAqICAgICAgICB9CgkJCSAqICAgICAgfSApOwoJCQkgKiAgICB9ICk7CgkJCSAqLwoJCQkic1NlYXJjaCI6ICJTZWFyY2g6IiwKCQkKCQkKCQkJLyoqCgkJCSAqIEFsbCBvZiB0aGUgbGFuZ3VhZ2UgaW5mb3JtYXRpb24gY2FuIGJlIHN0b3JlZCBpbiBhIGZpbGUgb24gdGhlCgkJCSAqIHNlcnZlci1zaWRlLCB3aGljaCBEYXRhVGFibGVzIHdpbGwgbG9vayB1cCBpZiB0aGlzIHBhcmFtZXRlciBpcyBwYXNzZWQuCgkJCSAqIEl0IG11c3Qgc3RvcmUgdGhlIFVSTCBvZiB0aGUgbGFuZ3VhZ2UgZmlsZSwgd2hpY2ggaXMgaW4gYSBKU09OIGZvcm1hdCwKCQkJICogYW5kIHRoZSBvYmplY3QgaGFzIHRoZSBzYW1lIHByb3BlcnRpZXMgYXMgdGhlIG9MYW5ndWFnZSBvYmplY3QgaW4gdGhlCgkJCSAqIGluaXRpYWxpc2VyIG9iamVjdCAoaS5lLiB0aGUgYWJvdmUgcGFyYW1ldGVycykuIFBsZWFzZSByZWZlciB0byBvbmUgb2YKCQkJICogdGhlIGV4YW1wbGUgbGFuZ3VhZ2UgZmlsZXMgdG8gc2VlIGhvdyB0aGlzIHdvcmtzIGluIGFjdGlvbi4KCQkJICogIEB0eXBlIHN0cmluZwoJCQkgKiAgQGRlZmF1bHQgPGk+RW1wdHkgc3RyaW5nIC0gaS5lLiBkaXNhYmxlZDwvaT4KCQkJICogIEBkdG9wdCBMYW5ndWFnZQoJCQkgKiAKCQkJICogIEBleGFtcGxlCgkJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJCSAqICAgICAgICAib0xhbmd1YWdlIjogewoJCQkgKiAgICAgICAgICAic1VybCI6ICJodHRwOi8vd3d3LnNwcnltZWRpYS5jby51ay9kYXRhVGFibGVzL2xhbmcudHh0IgoJCQkgKiAgICAgICAgfQoJCQkgKiAgICAgIH0gKTsKCQkJICogICAgfSApOwoJCQkgKi8KCQkJInNVcmwiOiAiIiwKCQkKCQkKCQkJLyoqCgkJCSAqIFRleHQgc2hvd24gaW5zaWRlIHRoZSB0YWJsZSByZWNvcmRzIHdoZW4gdGhlIGlzIG5vIGluZm9ybWF0aW9uIHRvIGJlCgkJCSAqIGRpc3BsYXllZCBhZnRlciBmaWx0ZXJpbmcuIHNFbXB0eVRhYmxlIGlzIHNob3duIHdoZW4gdGhlcmUgaXMgc2ltcGx5IG5vCgkJCSAqIGluZm9ybWF0aW9uIGluIHRoZSB0YWJsZSBhdCBhbGwgKHJlZ2FyZGxlc3Mgb2YgZmlsdGVyaW5nKS4KCQkJICogIEB0eXBlIHN0cmluZwoJCQkgKiAgQGRlZmF1bHQgTm8gbWF0Y2hpbmcgcmVjb3JkcyBmb3VuZAoJCQkgKiAgQGR0b3B0IExhbmd1YWdlCgkJCSAqIAoJCQkgKiAgQGV4YW1wbGUKCQkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkJICogICAgICAgICJvTGFuZ3VhZ2UiOiB7CgkJCSAqICAgICAgICAgICJzWmVyb1JlY29yZHMiOiAiTm8gcmVjb3JkcyB0byBkaXNwbGF5IgoJCQkgKiAgICAgICAgfQoJCQkgKiAgICAgIH0gKTsKCQkJICogICAgfSApOwoJCQkgKi8KCQkJInNaZXJvUmVjb3JkcyI6ICJObyBtYXRjaGluZyByZWNvcmRzIGZvdW5kIgoJCX0sCgkKCQoJCS8qKgoJCSAqIFRoaXMgcGFyYW1ldGVyIGFsbG93cyB5b3UgdG8gaGF2ZSBkZWZpbmUgdGhlIGdsb2JhbCBmaWx0ZXJpbmcgc3RhdGUgYXQKCQkgKiBpbml0aWFsaXNhdGlvbiB0aW1lLiBBcyBhbiBvYmplY3QgdGhlICJzU2VhcmNoIiBwYXJhbWV0ZXIgbXVzdCBiZQoJCSAqIGRlZmluZWQsIGJ1dCBhbGwgb3RoZXIgcGFyYW1ldGVycyBhcmUgb3B0aW9uYWwuIFdoZW4gImJSZWdleCIgaXMgdHJ1ZSwKCQkgKiB0aGUgc2VhcmNoIHN0cmluZyB3aWxsIGJlIHRyZWF0ZWQgYXMgYSByZWd1bGFyIGV4cHJlc3Npb24sIHdoZW4gZmFsc2UKCQkgKiAoZGVmYXVsdCkgaXQgd2lsbCBiZSB0cmVhdGVkIGFzIGEgc3RyYWlnaHQgc3RyaW5nLiBXaGVuICJiU21hcnQiCgkJICogRGF0YVRhYmxlcyB3aWxsIHVzZSBpdCdzIHNtYXJ0IGZpbHRlcmluZyBtZXRob2RzICh0byB3b3JkIG1hdGNoIGF0CgkJICogYW55IHBvaW50IGluIHRoZSBkYXRhKSwgd2hlbiBmYWxzZSB0aGlzIHdpbGwgbm90IGJlIGRvbmUuCgkJICogIEBuYW1lc3BhY2UKCQkgKiAgQGV4dGVuZHMgRGF0YVRhYmxlLm1vZGVscy5vU2VhcmNoCgkJICogIEBkdG9wdCBPcHRpb25zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoIGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgIm9TZWFyY2giOiB7InNTZWFyY2giOiAiSW5pdGlhbCBzZWFyY2gifQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKQoJCSAqLwoJCSJvU2VhcmNoIjogJC5leHRlbmQoIHt9LCBEYXRhVGFibGUubW9kZWxzLm9TZWFyY2ggKSwKCQoJCgkJLyoqCgkJICogQnkgZGVmYXVsdCBEYXRhVGFibGVzIHdpbGwgbG9vayBmb3IgdGhlIHByb3BlcnR5ICdhYURhdGEnIHdoZW4gb2J0YWluaW5nCgkJICogZGF0YSBmcm9tIGFuIEFqYXggc291cmNlIG9yIGZvciBzZXJ2ZXItc2lkZSBwcm9jZXNzaW5nIC0gdGhpcyBwYXJhbWV0ZXIKCQkgKiBhbGxvd3MgdGhhdCBwcm9wZXJ0eSB0byBiZSBjaGFuZ2VkLiBZb3UgY2FuIHVzZSBKYXZhc2NyaXB0IGRvdHRlZCBvYmplY3QKCQkgKiBub3RhdGlvbiB0byBnZXQgYSBkYXRhIHNvdXJjZSBmb3IgbXVsdGlwbGUgbGV2ZWxzIG9mIG5lc3RpbmcuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBhYURhdGEKCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAgQGR0b3B0IFNlcnZlci1zaWRlCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gR2V0IGRhdGEgZnJvbSB7ICJkYXRhIjogWy4uLl0gfQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgdmFyIG9UYWJsZSA9ICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJzQWpheFNvdXJjZSI6ICJzb3VyY2VzL2RhdGEudHh0IiwKCQkgKiAgICAgICAgInNBamF4RGF0YVByb3AiOiAiZGF0YSIKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gR2V0IGRhdGEgZnJvbSB7ICJkYXRhIjogeyAiaW5uZXIiOiBbLi4uXSB9IH0KCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic0FqYXhTb3VyY2UiOiAic291cmNlcy9kYXRhLnR4dCIsCgkJICogICAgICAgICJzQWpheERhdGFQcm9wIjogImRhdGEuaW5uZXIiCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJzQWpheERhdGFQcm9wIjogImFhRGF0YSIsCgkKCQoJCS8qKgoJCSAqIFlvdSBjYW4gaW5zdHJ1Y3QgRGF0YVRhYmxlcyB0byBsb2FkIGRhdGEgZnJvbSBhbiBleHRlcm5hbCBzb3VyY2UgdXNpbmcgdGhpcwoJCSAqIHBhcmFtZXRlciAodXNlIGFEYXRhIGlmIHlvdSB3YW50IHRvIHBhc3MgZGF0YSBpbiB5b3UgYWxyZWFkeSBoYXZlKS4gU2ltcGx5CgkJICogcHJvdmlkZSBhIHVybCBhIEpTT04gb2JqZWN0IGNhbiBiZSBvYnRhaW5lZCBmcm9tLiBUaGlzIG9iamVjdCBtdXN0IGluY2x1ZGUKCQkgKiB0aGUgcGFyYW1ldGVyICdhYURhdGEnIHdoaWNoIGlzIHRoZSBkYXRhIHNvdXJjZSBmb3IgdGhlIHRhYmxlLgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqICBAZHRvcHQgT3B0aW9ucwoJCSAqICBAZHRvcHQgU2VydmVyLXNpZGUKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic0FqYXhTb3VyY2UiOiAiaHR0cDovL3d3dy5zcHJ5bWVkaWEuY28udWsvZGF0YVRhYmxlcy9qc29uLnBocCIKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICkKCQkgKi8KCQkic0FqYXhTb3VyY2UiOiBudWxsLAoJCgkKCQkvKioKCQkgKiBUaGlzIHBhcmFtZXRlciBjYW4gYmUgdXNlZCB0byBvdmVycmlkZSB0aGUgZGVmYXVsdCBwcmVmaXggdGhhdCBEYXRhVGFibGVzCgkJICogYXNzaWducyB0byBhIGNvb2tpZSB3aGVuIHN0YXRlIHNhdmluZyBpcyBlbmFibGVkLgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgU3ByeU1lZGlhX0RhdGFUYWJsZXNfCgkJICogIEBkdG9wdCBPcHRpb25zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic0Nvb2tpZVByZWZpeCI6ICJteV9kYXRhdGFibGVfIiwKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJInNDb29raWVQcmVmaXgiOiAiU3ByeU1lZGlhX0RhdGFUYWJsZXNfIiwKCQoJCgkJLyoqCgkJICogVGhpcyBpbml0aWFsaXNhdGlvbiB2YXJpYWJsZSBhbGxvd3MgeW91IHRvIHNwZWNpZnkgZXhhY3RseSB3aGVyZSBpbiB0aGUKCQkgKiBET00geW91IHdhbnQgRGF0YVRhYmxlcyB0byBpbmplY3QgdGhlIHZhcmlvdXMgY29udHJvbHMgaXQgYWRkcyB0byB0aGUgcGFnZQoJCSAqIChmb3IgZXhhbXBsZSB5b3UgbWlnaHQgd2FudCB0aGUgcGFnaW5hdGlvbiBjb250cm9scyBhdCB0aGUgdG9wIG9mIHRoZQoJCSAqIHRhYmxlKS4gRElWIGVsZW1lbnRzICh3aXRoIG9yIHdpdGhvdXQgYSBjdXN0b20gY2xhc3MpIGNhbiBhbHNvIGJlIGFkZGVkIHRvCgkJICogYWlkIHN0eWxpbmcuIFRoZSBmb2xsb3cgc3ludGF4IGlzIHVzZWQ6CgkJICogICA8dWw+CgkJICogICAgIDxsaT5UaGUgZm9sbG93aW5nIG9wdGlvbnMgYXJlIGFsbG93ZWQ6CQoJCSAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT4nbCcgLSBMZW5ndGggY2hhbmdpbmc8L2xpCgkJICogICAgICAgICA8bGk+J2YnIC0gRmlsdGVyaW5nIGlucHV0PC9saT4KCQkgKiAgICAgICAgIDxsaT4ndCcgLSBUaGUgdGFibGUhPC9saT4KCQkgKiAgICAgICAgIDxsaT4naScgLSBJbmZvcm1hdGlvbjwvbGk+CgkJICogICAgICAgICA8bGk+J3AnIC0gUGFnaW5hdGlvbjwvbGk+CgkJICogICAgICAgICA8bGk+J3InIC0gcFJvY2Vzc2luZzwvbGk+CgkJICogICAgICAgPC91bD4KCQkgKiAgICAgPC9saT4KCQkgKiAgICAgPGxpPlRoZSBmb2xsb3dpbmcgY29uc3RhbnRzIGFyZSBhbGxvd2VkOgoJCSAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT4nSCcgLSBqUXVlcnlVSSB0aGVtZSAiaGVhZGVyIiBjbGFzc2VzICgnZmctdG9vbGJhciB1aS13aWRnZXQtaGVhZGVyIHVpLWNvcm5lci10bCB1aS1jb3JuZXItdHIgdWktaGVscGVyLWNsZWFyZml4Jyk8L2xpPgoJCSAqICAgICAgICAgPGxpPidGJyAtIGpRdWVyeVVJIHRoZW1lICJmb290ZXIiIGNsYXNzZXMgKCdmZy10b29sYmFyIHVpLXdpZGdldC1oZWFkZXIgdWktY29ybmVyLWJsIHVpLWNvcm5lci1iciB1aS1oZWxwZXItY2xlYXJmaXgnKTwvbGk+CgkJICogICAgICAgPC91bD4KCQkgKiAgICAgPC9saT4KCQkgKiAgICAgPGxpPlRoZSBmb2xsb3dpbmcgc3ludGF4IGlzIGV4cGVjdGVkOgoJCSAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT4nJmx0OycgYW5kICcmZ3Q7JyAtIGRpdiBlbGVtZW50czwvbGk+CgkJICogICAgICAgICA8bGk+JyZsdDsiY2xhc3MiIGFuZCAnJmd0OycgLSBkaXYgd2l0aCBhIGNsYXNzPC9saT4KCQkgKiAgICAgICAgIDxsaT4nJmx0OyIjaWQiIGFuZCAnJmd0OycgLSBkaXYgd2l0aCBhbiBJRDwvbGk+CgkJICogICAgICAgPC91bD4KCQkgKiAgICAgPC9saT4KCQkgKiAgICAgPGxpPkV4YW1wbGVzOgoJCSAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT4nJmx0OyJ3cmFwcGVyImZsaXB0Jmd0Oyc8L2xpPgoJCSAqICAgICAgICAgPGxpPicmbHQ7bGYmbHQ7dCZndDtpcCZndDsnPC9saT4KCQkgKiAgICAgICA8L3VsPgoJCSAqICAgICA8L2xpPgoJCSAqICAgPC91bD4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IGxmcnRpcCA8aT4od2hlbiBiSlF1ZXJ5VUkgaXMgZmFsc2UpPC9pPiA8Yj5vcjwvYj4gCgkJICogICAgPCJIImxmcj50PCJGImlwPiA8aT4od2hlbiBiSlF1ZXJ5VUkgaXMgdHJ1ZSk8L2k+CgkJICogIEBkdG9wdCBPcHRpb25zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic0RvbSI6ICcmbHQ7InRvcCJpJmd0O3J0Jmx0OyJib3R0b20iZmxwJmd0OyZsdDsiY2xlYXIiJmd0OycKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJInNEb20iOiAibGZydGlwIiwKCQoJCgkJLyoqCgkJICogRGF0YVRhYmxlcyBmZWF0dXJlcyB0d28gZGlmZmVyZW50IGJ1aWx0LWluIHBhZ2luYXRpb24gaW50ZXJhY3Rpb24gbWV0aG9kcwoJCSAqICgndHdvX2J1dHRvbicgb3IgJ2Z1bGxfbnVtYmVycycpIHdoaWNoIHByZXNlbnQgZGlmZmVyZW50IHBhZ2UgY29udHJvbHMgdG8KCQkgKiB0aGUgZW5kIHVzZXIuIEZ1cnRoZXIgbWV0aG9kcyBjYW4gYmUgYWRkZWQgdXNpbmcgdGhlIEFQSSAoc2VlIGJlbG93KS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IHR3b19idXR0b24KCQkgKiAgQGR0b3B0IE9wdGlvbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeSggZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic1BhZ2luYXRpb25UeXBlIjogImZ1bGxfbnVtYmVycyIKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICkKCQkgKi8KCQkic1BhZ2luYXRpb25UeXBlIjogInR3b19idXR0b24iLAoJCgkKCQkvKioKCQkgKiBFbmFibGUgaG9yaXpvbnRhbCBzY3JvbGxpbmcuIFdoZW4gYSB0YWJsZSBpcyB0b28gd2lkZSB0byBmaXQgaW50byBhIGNlcnRhaW4KCQkgKiBsYXlvdXQsIG9yIHlvdSBoYXZlIGEgbGFyZ2UgbnVtYmVyIG9mIGNvbHVtbnMgaW4gdGhlIHRhYmxlLCB5b3UgY2FuIGVuYWJsZQoJCSAqIHgtc2Nyb2xsaW5nIHRvIHNob3cgdGhlIHRhYmxlIGluIGEgdmlld3BvcnQsIHdoaWNoIGNhbiBiZSBzY3JvbGxlZC4gVGhpcwoJCSAqIHByb3BlcnR5IGNhbiBiZSBhbnkgQ1NTIHVuaXQsIG9yIGEgbnVtYmVyIChpbiB3aGljaCBjYXNlIGl0IHdpbGwgYmUgdHJlYXRlZAoJCSAqIGFzIGEgcGl4ZWwgbWVhc3VyZW1lbnQpLgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgPGk+Ymxhbmsgc3RyaW5nIC0gaS5lLiBkaXNhYmxlZDwvaT4KCQkgKiAgQGR0b3B0IEZlYXR1cmVzCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic1Njcm9sbFgiOiAiMTAwJSIsCgkJICogICAgICAgICJiU2Nyb2xsQ29sbGFwc2UiOiB0cnVlCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJzU2Nyb2xsWCI6ICIiLAoJCgkKCQkvKioKCQkgKiBUaGlzIHByb3BlcnR5IGNhbiBiZSB1c2VkIHRvIGZvcmNlIGEgRGF0YVRhYmxlIHRvIHVzZSBtb3JlIHdpZHRoIHRoYW4gaXQKCQkgKiBtaWdodCBvdGhlcndpc2UgZG8gd2hlbiB4LXNjcm9sbGluZyBpcyBlbmFibGVkLiBGb3IgZXhhbXBsZSBpZiB5b3UgaGF2ZSBhCgkJICogdGFibGUgd2hpY2ggcmVxdWlyZXMgdG8gYmUgd2VsbCBzcGFjZWQsIHRoaXMgcGFyYW1ldGVyIGlzIHVzZWZ1bCBmb3IKCQkgKiAib3Zlci1zaXppbmciIHRoZSB0YWJsZSwgYW5kIHRodXMgZm9yY2luZyBzY3JvbGxpbmcuIFRoaXMgcHJvcGVydHkgY2FuIGJ5CgkJICogYW55IENTUyB1bml0LCBvciBhIG51bWJlciAoaW4gd2hpY2ggY2FzZSBpdCB3aWxsIGJlIHRyZWF0ZWQgYXMgYSBwaXhlbAoJCSAqIG1lYXN1cmVtZW50KS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IDxpPmJsYW5rIHN0cmluZyAtIGkuZS4gZGlzYWJsZWQ8L2k+CgkJICogIEBkdG9wdCBPcHRpb25zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAic1Njcm9sbFgiOiAiMTAwJSIsCgkJICogICAgICAgICJzU2Nyb2xsWElubmVyIjogIjExMCUiCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJzU2Nyb2xsWElubmVyIjogIiIsCgkKCQoJCS8qKgoJCSAqIEVuYWJsZSB2ZXJ0aWNhbCBzY3JvbGxpbmcuIFZlcnRpY2FsIHNjcm9sbGluZyB3aWxsIGNvbnN0cmFpbiB0aGUgRGF0YVRhYmxlCgkJICogdG8gdGhlIGdpdmVuIGhlaWdodCwgYW5kIGVuYWJsZSBzY3JvbGxpbmcgZm9yIGFueSBkYXRhIHdoaWNoIG92ZXJmbG93cyB0aGUKCQkgKiBjdXJyZW50IHZpZXdwb3J0LiBUaGlzIGNhbiBiZSB1c2VkIGFzIGFuIGFsdGVybmF0aXZlIHRvIHBhZ2luZyB0byBkaXNwbGF5CgkJICogYSBsb3Qgb2YgZGF0YSBpbiBhIHNtYWxsIGFyZWEgKGFsdGhvdWdoIHBhZ2luZyBhbmQgc2Nyb2xsaW5nIGNhbiBib3RoIGJlCgkJICogZW5hYmxlZCBhdCB0aGUgc2FtZSB0aW1lKS4gVGhpcyBwcm9wZXJ0eSBjYW4gYmUgYW55IENTUyB1bml0LCBvciBhIG51bWJlcgoJCSAqIChpbiB3aGljaCBjYXNlIGl0IHdpbGwgYmUgdHJlYXRlZCBhcyBhIHBpeGVsIG1lYXN1cmVtZW50KS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IDxpPmJsYW5rIHN0cmluZyAtIGkuZS4gZGlzYWJsZWQ8L2k+CgkJICogIEBkdG9wdCBGZWF0dXJlcwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgInNTY3JvbGxZIjogIjIwMHB4IiwKCQkgKiAgICAgICAgImJQYWdpbmF0ZSI6IGZhbHNlCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJzU2Nyb2xsWSI6ICIiLAoJCgkKCQkvKioKCQkgKiBTZXQgdGhlIEhUVFAgbWV0aG9kIHRoYXQgaXMgdXNlZCB0byBtYWtlIHRoZSBBamF4IGNhbGwgZm9yIHNlcnZlci1zaWRlCgkJICogcHJvY2Vzc2luZyBvciBBamF4IHNvdXJjZWQgZGF0YS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IEdFVAoJCSAqICBAZHRvcHQgT3B0aW9ucwoJCSAqICBAZHRvcHQgU2VydmVyLXNpZGUKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJiU2VydmVyU2lkZSI6IHRydWUsCgkJICogICAgICAgICJzQWpheFNvdXJjZSI6ICJzY3JpcHRzL3Bvc3QucGhwIiwKCQkgKiAgICAgICAgInNTZXJ2ZXJNZXRob2QiOiAiUE9TVCIKCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJInNTZXJ2ZXJNZXRob2QiOiAiR0VUIgoJfTsKCQoJCgkKCS8qKgoJICogQ29sdW1uIG9wdGlvbnMgdGhhdCBjYW4gYmUgZ2l2ZW4gdG8gRGF0YVRhYmxlcyBhdCBpbml0aWFsaXNhdGlvbiB0aW1lLgoJICogIEBuYW1lc3BhY2UKCSAqLwoJRGF0YVRhYmxlLmRlZmF1bHRzLmNvbHVtbnMgPSB7CgkJLyoqCgkJICogQWxsb3dzIGEgY29sdW1uJ3Mgc29ydGluZyB0byB0YWtlIG11bHRpcGxlIGNvbHVtbnMgaW50byBhY2NvdW50IHdoZW4gCgkJICogZG9pbmcgYSBzb3J0LiBGb3IgZXhhbXBsZSBmaXJzdCBuYW1lIC8gbGFzdCBuYW1lIGNvbHVtbnMgbWFrZSBzZW5zZSB0byAKCQkgKiBkbyBhIG11bHRpLWNvbHVtbiBzb3J0IG92ZXIgdGhlIHR3byBjb2x1bW5zLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBudWxsIDxpPlRha2VzIHRoZSB2YWx1ZSBvZiB0aGUgY29sdW1uIGluZGV4IGF1dG9tYXRpY2FsbHk8L2k+CgkJICogIEBkdG9wdCBDb2x1bW5zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5EZWZzCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5EZWZzIjogWwoJCSAqICAgICAgICAgIHsgImFEYXRhU29ydCI6IFsgMCwgMSBdLCAiYVRhcmdldHMiOiBbIDAgXSB9LAoJCSAqICAgICAgICAgIHsgImFEYXRhU29ydCI6IFsgMSwgMCBdLCAiYVRhcmdldHMiOiBbIDEgXSB9LAoJCSAqICAgICAgICAgIHsgImFEYXRhU29ydCI6IFsgMiwgMywgNCBdLCAiYVRhcmdldHMiOiBbIDIgXSB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5zCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWwoJCSAqICAgICAgICAgIHsgImFEYXRhU29ydCI6IFsgMCwgMSBdIH0sCgkJICogICAgICAgICAgeyAiYURhdGFTb3J0IjogWyAxLCAwIF0gfSwKCQkgKiAgICAgICAgICB7ICJhRGF0YVNvcnQiOiBbIDIsIDMsIDQgXSB9LAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbAoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJhRGF0YVNvcnQiOiBudWxsLAoJCgkKCQkvKioKCQkgKiBZb3UgY2FuIGNvbnRyb2wgdGhlIGRlZmF1bHQgc29ydGluZyBkaXJlY3Rpb24sIGFuZCBldmVuIGFsdGVyIHRoZSBiZWhhdmlvdXIKCQkgKiBvZiB0aGUgc29ydCBoYW5kbGVyIChpLmUuIG9ubHkgYWxsb3cgYXNjZW5kaW5nIHNvcnRpbmcgZXRjKSB1c2luZyB0aGlzCgkJICogcGFyYW1ldGVyLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbICdhc2MnLCAnZGVzYycgXQoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1uRGVmcwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1uRGVmcyI6IFsKCQkgKiAgICAgICAgICB7ICJhc1NvcnRpbmciOiBbICJhc2MiIF0sICJhVGFyZ2V0cyI6IFsgMSBdIH0sCgkJICogICAgICAgICAgeyAiYXNTb3J0aW5nIjogWyAiZGVzYyIsICJhc2MiLCAiYXNjIiBdLCAiYVRhcmdldHMiOiBbIDIgXSB9LAoJCSAqICAgICAgICAgIHsgImFzU29ydGluZyI6IFsgImRlc2MiIF0sICJhVGFyZ2V0cyI6IFsgMyBdIH0KCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKiAgICAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbnMiOiBbCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICB7ICJhc1NvcnRpbmciOiBbICJhc2MiIF0gfSwKCQkgKiAgICAgICAgICB7ICJhc1NvcnRpbmciOiBbICJkZXNjIiwgImFzYyIsICJhc2MiIF0gfSwKCQkgKiAgICAgICAgICB7ICJhc1NvcnRpbmciOiBbICJkZXNjIiBdIH0sCgkJICogICAgICAgICAgbnVsbAoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJhc1NvcnRpbmciOiBbICdhc2MnLCAnZGVzYycgXSwKCQoJCgkJLyoqCgkJICogRW5hYmxlIG9yIGRpc2FibGUgZmlsdGVyaW5nIG9uIHRoZSBkYXRhIGluIHRoaXMgY29sdW1uLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IHRydWUKCQkgKiAgQGR0b3B0IENvbHVtbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbkRlZnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbkRlZnMiOiBbIAoJCSAqICAgICAgICAgIHsgImJTZWFyY2hhYmxlIjogZmFsc2UsICJhVGFyZ2V0cyI6IFsgMCBdIH0KCQkgKiAgICAgICAgXSB9ICk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1ucwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1ucyI6IFsgCgkJICogICAgICAgICAgeyAiYlNlYXJjaGFibGUiOiBmYWxzZSB9LAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwKCQkgKiAgICAgICAgXSB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJiU2VhcmNoYWJsZSI6IHRydWUsCgkKCQoJCS8qKgoJCSAqIEVuYWJsZSBvciBkaXNhYmxlIHNvcnRpbmcgb24gdGhpcyBjb2x1bW4uCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgdHJ1ZQoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1uRGVmcwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1uRGVmcyI6IFsgCgkJICogICAgICAgICAgeyAiYlNvcnRhYmxlIjogZmFsc2UsICJhVGFyZ2V0cyI6IFsgMCBdIH0KCQkgKiAgICAgICAgXSB9ICk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1ucwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1ucyI6IFsgCgkJICogICAgICAgICAgeyAiYlNvcnRhYmxlIjogZmFsc2UgfSwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsCgkJICogICAgICAgIF0gfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYlNvcnRhYmxlIjogdHJ1ZSwKCQoJCgkJLyoqCgkJICogV2hlbiB1c2luZyBmblJlbmRlcigpIGZvciBhIGNvbHVtbiwgeW91IG1heSB3aXNoIHRvIHVzZSB0aGUgb3JpZ2luYWwgZGF0YQoJCSAqIChiZWZvcmUgcmVuZGVyaW5nKSBmb3Igc29ydGluZyBhbmQgZmlsdGVyaW5nICh0aGUgZGVmYXVsdCBpcyB0byB1c2VkIHRoZQoJCSAqIHJlbmRlcmVkIGRhdGEgdGhhdCB0aGUgdXNlciBjYW4gc2VlKS4gVGhpcyBtYXkgYmUgdXNlZnVsIGZvciBkYXRlcyBldGMuCgkJICogCgkJICogKk5PVEUqIEl0IGlzIGl0IGlzIGFkdmlzYWJsZSBub3cgdG8gdXNlIG1EYXRhUHJvcCBhcyBhIGZ1bmN0aW9uIGFuZCBtYWtlIAoJCSAqIHVzZSBvZiB0aGUgJ3R5cGUnIHRoYXQgaXQgZ2l2ZXMsIGFsbG93aW5nIChwb3RlbnRpYWxseSkgZGlmZmVyZW50IGRhdGEgdG8KCQkgKiBiZSB1c2VkIGZvciBzb3J0aW5nLCBmaWx0ZXJpbmcsIGRpc3BsYXkgYW5kIHR5cGUgZGV0ZWN0aW9uLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IHRydWUKCQkgKiAgQGR0b3B0IENvbHVtbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbkRlZnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbkRlZnMiOiBbIAoJCSAqICAgICAgICAgIHsKCQkgKiAgICAgICAgICAgICJmblJlbmRlciI6IGZ1bmN0aW9uICggb09iaiApIHsKCQkgKiAgICAgICAgICAgICAgcmV0dXJuIG9PYmouYURhdGFbMF0gKycgJysgb09iai5hRGF0YVszXTsKCQkgKiAgICAgICAgICAgIH0sCgkJICogICAgICAgICAgICAiYlVzZVJlbmRlcmVkIjogZmFsc2UsCgkJICogICAgICAgICAgICAiYVRhcmdldHMiOiBbIDAgXQoJCSAqICAgICAgICAgIH0KCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKiAgICAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbnMiOiBbIAoJCSAqICAgICAgICAgIHsKCQkgKiAgICAgICAgICAgICJmblJlbmRlciI6IGZ1bmN0aW9uICggb09iaiApIHsKCQkgKiAgICAgICAgICAgICAgcmV0dXJuIG9PYmouYURhdGFbMF0gKycgJysgb09iai5hRGF0YVszXTsKCQkgKiAgICAgICAgICAgIH0sCgkJICogICAgICAgICAgICAiYlVzZVJlbmRlcmVkIjogZmFsc2UKCQkgKiAgICAgICAgICB9LAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwKCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiYlVzZVJlbmRlcmVkIjogdHJ1ZSwKCQoJCgkJLyoqCgkJICogRW5hYmxlIG9yIGRpc2FibGUgdGhlIGRpc3BsYXkgb2YgdGhpcyBjb2x1bW4uCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgdHJ1ZQoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1uRGVmcwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1uRGVmcyI6IFsgCgkJICogICAgICAgICAgeyAiYlZpc2libGUiOiBmYWxzZSwgImFUYXJnZXRzIjogWyAwIF0gfQoJCSAqICAgICAgICBdIH0gKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5zCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWyAKCQkgKiAgICAgICAgICB7ICJiVmlzaWJsZSI6IGZhbHNlIH0sCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbAoJCSAqICAgICAgICBdIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJImJWaXNpYmxlIjogdHJ1ZSwKCQkKCQkKCQkvKioKCQkgKiBEZXZlbG9wZXIgZGVmaW5hYmxlIGZ1bmN0aW9uIHRoYXQgaXMgY2FsbGVkIHdoZW5ldmVyIGEgY2VsbCBpcyBjcmVhdGVkIChBamF4IHNvdXJjZSwKCQkgKiBldGMpIG9yIHByb2Nlc3NlZCBmb3IgaW5wdXQgKERPTSBzb3VyY2UpLiBUaGlzIGNhbiBiZSB1c2VkIGFzIGEgY29tcGxpbWVudCB0byBmblJlbmRlcgoJCSAqIGFsbG93aW5nIHlvdSB0byBtb2RpZnkgdGhlIERPTSBlbGVtZW50IChhZGQgYmFja2dyb3VuZCBjb2xvdXIgZm9yIGV4YW1wbGUpIHdoZW4gdGhlCgkJICogZWxlbWVudCBpcyBhdmFpbGFibGUgKHNpbmNlIGl0IGlzIG5vdCB3aGVuIGZuUmVuZGVyIGlzIGNhbGxlZCkuCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICogIEBwYXJhbSB7ZWxlbWVudH0gblRkIFRoZSBURCBub2RlIHRoYXQgaGFzIGJlZW4gY3JlYXRlZAoJCSAqICBAcGFyYW0geyp9IHNEYXRhIFRoZSBEYXRhIGZvciB0aGUgY2VsbAoJCSAqICBAcGFyYW0ge2FycmF5fG9iamVjdH0gb0RhdGEgVGhlIGRhdGEgZm9yIHRoZSB3aG9sZSByb3cKCQkgKiAgQHBhcmFtIHtpbnR9IGlSb3cgVGhlIHJvdyBpbmRleCBmb3IgdGhlIGFvRGF0YSBkYXRhIHN0b3JlCgkJICogIEBwYXJhbSB7aW50fSBpQ29sIFRoZSBjb2x1bW4gaW5kZXggZm9yIGFvQ29sdW1ucwoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1uRGVmcyI6IFsgewoJCSAqICAgICAgICAgICJhVGFyZ2V0cyI6IFszXSwKCQkgKiAgICAgICAgICAiZm5DcmVhdGVkQ2VsbCI6IGZ1bmN0aW9uIChuVGQsIHNEYXRhLCBvRGF0YSwgaVJvdywgaUNvbCkgewoJCSAqICAgICAgICAgICAgaWYgKCBzRGF0YSA9PSAiMS43IiApIHsKCQkgKiAgICAgICAgICAgICAgJChuVGQpLmNzcygnY29sb3InLCAnYmx1ZScpCgkJICogICAgICAgICAgICB9CgkJICogICAgICAgICAgfQoJCSAqICAgICAgICB9IF0KCQkgKiAgICAgIH0pOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkiZm5DcmVhdGVkQ2VsbCI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIEN1c3RvbSBkaXNwbGF5IGZ1bmN0aW9uIHRoYXQgd2lsbCBiZSBjYWxsZWQgZm9yIHRoZSBkaXNwbGF5IG9mIGVhY2ggY2VsbCBpbgoJCSAqIHRoaXMgY29sdW1uLgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAcGFyYW0ge29iamVjdH0gbyBPYmplY3Qgd2l0aCB0aGUgZm9sbG93aW5nIHBhcmFtZXRlcnM6CgkJICogIEBwYXJhbSB7aW50fSAgICBvLmlEYXRhUm93IFRoZSByb3cgaW4gYW9EYXRhCgkJICogIEBwYXJhbSB7aW50fSAgICBvLmlEYXRhQ29sdW1uIFRoZSBjb2x1bW4gaW4gcXVlc3Rpb24KCQkgKiAgQHBhcmFtIHthcnJheX0gIG8uYURhdGEgVGhlIGRhdGEgZm9yIHRoZSByb3cgaW4gcXVlc3Rpb24KCQkgKiAgQHBhcmFtIHtvYmplY3R9IG8ub1NldHRpbmdzIFRoZSBzZXR0aW5ncyBvYmplY3QgZm9yIHRoaXMgRGF0YVRhYmxlcyBpbnN0YW5jZQoJCSAqICBAcGFyYW0ge29iamVjdH0gby5tRGF0YVByb3AgVGhlIGRhdGEgcHJvcGVydHkgdXNlZCBmb3IgdGhpcyBjb2x1bW4KCQkgKiAgQHBhcmFtIHsqfSAgICAgIHZhbCBUaGUgY3VycmVudCBjZWxsIHZhbHVlCgkJICogIEByZXR1cm5zIHtzdHJpbmd9IFRoZSBzdHJpbmcgeW91IHdoaWNoIHRvIHVzZSBpbiB0aGUgZGlzcGxheQoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1uRGVmcwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1uRGVmcyI6IFsgCgkJICogICAgICAgICAgewoJCSAqICAgICAgICAgICAgImZuUmVuZGVyIjogZnVuY3Rpb24gKCBvLCB2YWwgKSB7CgkJICogICAgICAgICAgICAgIHJldHVybiBvLmFEYXRhWzBdICsnICcrIG8uYURhdGFbM107CgkJICogICAgICAgICAgICB9LAoJCSAqICAgICAgICAgICAgImFUYXJnZXRzIjogWyAwIF0KCQkgKiAgICAgICAgICB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5zCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWyAKCQkgKiAgICAgICAgICB7ICJmblJlbmRlciI6IGZ1bmN0aW9uICggbywgdmFsICkgewoJCSAqICAgICAgICAgICAgcmV0dXJuIG8uYURhdGFbMF0gKycgJysgby5hRGF0YVszXTsKCQkgKiAgICAgICAgICB9IH0sCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbAoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJmblJlbmRlciI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIFRoZSBjb2x1bW4gaW5kZXggKHN0YXJ0aW5nIGZyb20gMCEpIHRoYXQgeW91IHdpc2ggYSBzb3J0IHRvIGJlIHBlcmZvcm1lZAoJCSAqIHVwb24gd2hlbiB0aGlzIGNvbHVtbiBpcyBzZWxlY3RlZCBmb3Igc29ydGluZy4gVGhpcyBjYW4gYmUgdXNlZCBmb3Igc29ydGluZwoJCSAqIG9uIGhpZGRlbiBjb2x1bW5zIGZvciBleGFtcGxlLgoJCSAqICBAdHlwZSBpbnQKCQkgKiAgQGRlZmF1bHQgLTEgPGk+VXNlIGF1dG9tYXRpY2FsbHkgY2FsY3VsYXRlZCBjb2x1bW4gaW5kZXg8L2k+CgkJICogIEBkdG9wdCBDb2x1bW5zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5EZWZzCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5EZWZzIjogWyAKCQkgKiAgICAgICAgICB7ICJpRGF0YVNvcnQiOiAxLCAiYVRhcmdldHMiOiBbIDAgXSB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5zCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWyAKCQkgKiAgICAgICAgICB7ICJpRGF0YVNvcnQiOiAxIH0sCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbAoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJpRGF0YVNvcnQiOiAtMSwKCQoJCgkJLyoqCgkJICogVGhpcyBwcm9wZXJ0eSBjYW4gYmUgdXNlZCB0byByZWFkIGRhdGEgZnJvbSBhbnkgSlNPTiBkYXRhIHNvdXJjZSBwcm9wZXJ0eSwKCQkgKiBpbmNsdWRpbmcgZGVlcGx5IG5lc3RlZCBvYmplY3RzIC8gcHJvcGVydGllcy4gbURhdGFQcm9wIGNhbiBiZSBnaXZlbiBpbiBhCgkJICogbnVtYmVyIG9mIGRpZmZlcmVudCB3YXlzIHdoaWNoIGVmZmVjdCBpdHMgYmVoYXZpb3VyOgoJCSAqICAgPHVsPgoJCSAqICAgICA8bGk+aW50ZWdlciAtIHRyZWF0ZWQgYXMgYW4gYXJyYXkgaW5kZXggZm9yIHRoZSBkYXRhIHNvdXJjZS4gVGhpcyBpcyB0aGUKCQkgKiAgICAgICBkZWZhdWx0IHRoYXQgRGF0YVRhYmxlcyB1c2VzIChpbmNyZW1lbnRhbGx5IGluY3JlYXNlZCBmb3IgZWFjaCBjb2x1bW4pLjwvbGk+CgkJICogICAgIDxsaT5zdHJpbmcgLSByZWFkIGFuIG9iamVjdCBwcm9wZXJ0eSBmcm9tIHRoZSBkYXRhIHNvdXJjZS4gTm90ZSB0aGF0IHlvdSBjYW4KCQkgKiAgICAgICB1c2UgSmF2YXNjcmlwdCBkb3R0ZWQgbm90YXRpb24gdG8gcmVhZCBkZWVwIHByb3BlcnRpZXMvYXJyYXlzIGZyb20gdGhlCgkJICogICAgICAgZGF0YSBzb3VyY2UuPC9saT4KCQkgKiAgICAgPGxpPm51bGwgLSB0aGUgc0RlZmF1bHRDb250ZW50IG9wdGlvbiB3aWxsIGJlIHVzZWQgZm9yIHRoZSBjZWxsIChudWxsCgkJICogICAgICAgYnkgZGVmYXVsdCwgc28geW91IHdpbGwgbmVlZCB0byBzcGVjaWZ5IHRoZSBkZWZhdWx0IGNvbnRlbnQgeW91IHdhbnQgLQoJCSAqICAgICAgIHR5cGljYWxseSBhbiBlbXB0eSBzdHJpbmcpLiBUaGlzIGNhbiBiZSB1c2VmdWwgb24gZ2VuZXJhdGVkIGNvbHVtbnMgc3VjaCAKCQkgKiAgICAgICBhcyBlZGl0IC8gZGVsZXRlIGFjdGlvbiBjb2x1bW5zLjwvbGk+CgkJICogICAgIDxsaT5mdW5jdGlvbiAtIHRoZSBmdW5jdGlvbiBnaXZlbiB3aWxsIGJlIGV4ZWN1dGVkIHdoZW5ldmVyIERhdGFUYWJsZXMgCgkJICogICAgICAgbmVlZHMgdG8gc2V0IG9yIGdldCB0aGUgZGF0YSBmb3IgYSBjZWxsIGluIHRoZSBjb2x1bW4uIFRoZSBmdW5jdGlvbiAKCQkgKiAgICAgICB0YWtlcyB0aHJlZSBwYXJhbWV0ZXJzOgoJCSAqICAgICAgIDx1bD4KCQkgKiAgICAgICAgIDxsaT57YXJyYXl8b2JqZWN0fSBUaGUgZGF0YSBzb3VyY2UgZm9yIHRoZSByb3c8L2xpPgoJCSAqICAgICAgICAgPGxpPntzdHJpbmd9IFRoZSB0eXBlIGNhbGwgZGF0YSByZXF1ZXN0ZWQgLSB0aGlzIHdpbGwgYmUgJ3NldCcgd2hlbgoJCSAqICAgICAgICAgICBzZXR0aW5nIGRhdGEgb3IgJ2ZpbHRlcicsICdkaXNwbGF5JywgJ3R5cGUnLCAnc29ydCcgb3IgdW5kZWZpbmVkIHdoZW4gCgkJICogICAgICAgICAgIGdhdGhlcmluZyBkYXRhLiBOb3RlIHRoYXQgd2hlbiA8aT51bmRlZmluZWQ8L2k+IGlzIGdpdmVuIGZvciB0aGUgdHlwZQoJCSAqICAgICAgICAgICBEYXRhVGFibGVzIGV4cGVjdHMgdG8gZ2V0IHRoZSByYXcgZGF0YSBmb3IgdGhlIG9iamVjdCBiYWNrPC9saT4KCQkgKiAgICAgICAgIDxsaT57Kn0gRGF0YSB0byBzZXQgd2hlbiB0aGUgc2Vjb25kIHBhcmFtZXRlciBpcyAnc2V0Jy48L2xpPgoJCSAqICAgICAgIDwvdWw+CgkJICogICAgICAgVGhlIHJldHVybiB2YWx1ZSBmcm9tIHRoZSBmdW5jdGlvbiBpcyBub3QgcmVxdWlyZWQgd2hlbiAnc2V0JyBpcyB0aGUgdHlwZQoJCSAqICAgICAgIG9mIGNhbGwsIGJ1dCBvdGhlcndpc2UgdGhlIHJldHVybiBpcyB3aGF0IHdpbGwgYmUgdXNlZCBmb3IgdGhlIGRhdGEKCQkgKiAgICAgICByZXF1ZXN0ZWQuPC9saT4KCQkgKiAgICA8L3VsPgoJCSAqICBAdHlwZSBzdHJpbmd8aW50fGZ1bmN0aW9ufG51bGwKCQkgKiAgQGRlZmF1bHQgbnVsbCA8aT5Vc2UgYXV0b21hdGljYWxseSBjYWxjdWxhdGVkIGNvbHVtbiBpbmRleDwvaT4KCQkgKiAgQGR0b3B0IENvbHVtbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBSZWFkIHRhYmxlIGRhdGEgZnJvbSBvYmplY3RzCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgInNBamF4U291cmNlIjogInNvdXJjZXMvZGVlcC50eHQiLAoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWwoJCSAqICAgICAgICAgIHsgIm1EYXRhUHJvcCI6ICJlbmdpbmUiIH0sCgkJICogICAgICAgICAgeyAibURhdGFQcm9wIjogImJyb3dzZXIiIH0sCgkJICogICAgICAgICAgeyAibURhdGFQcm9wIjogInBsYXRmb3JtLmlubmVyIiB9LAoJCSAqICAgICAgICAgIHsgIm1EYXRhUHJvcCI6ICJwbGF0Zm9ybS5kZXRhaWxzLjAiIH0sCgkJICogICAgICAgICAgeyAibURhdGFQcm9wIjogInBsYXRmb3JtLmRldGFpbHMuMSIgfQoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIG1EYXRhUHJvcCBhcyBhIGZ1bmN0aW9uIHRvIHByb3ZpZGUgZGlmZmVyZW50IGluZm9ybWF0aW9uIGZvcgoJCSAqICAgIC8vIHNvcnRpbmcsIGZpbHRlcmluZyBhbmQgZGlzcGxheS4gSW4gdGhpcyBjYXNlLCBjdXJyZW5jeSAocHJpY2UpCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICB2YXIgb1RhYmxlID0gJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1uRGVmcyI6IFsKCQkgKiAgICAgICAgewoJCSAqICAgICAgICAgICJhVGFyZ2V0cyI6IFsgMCBdLAoJCSAqICAgICAgICAgICJtRGF0YVByb3AiOiBmdW5jdGlvbiAoIHNvdXJjZSwgdHlwZSwgdmFsICkgewoJCSAqICAgICAgICAgICAgaWYgKHR5cGUgPT09ICdzZXQnKSB7CgkJICogICAgICAgICAgICAgIHNvdXJjZS5wcmljZSA9IHZhbDsKCQkgKiAgICAgICAgICAgICAgLy8gU3RvcmUgdGhlIGNvbXB1dGVkIGRpc2xheSBhbmQgZmlsdGVyIHZhbHVlcyBmb3IgZWZmaWNpZW5jeQoJCSAqICAgICAgICAgICAgICBzb3VyY2UucHJpY2VfZGlzcGxheSA9IHZhbD09IiIgPyAiIiA6ICIkIitudW1iZXJGb3JtYXQodmFsKTsKCQkgKiAgICAgICAgICAgICAgc291cmNlLnByaWNlX2ZpbHRlciAgPSB2YWw9PSIiID8gIiIgOiAiJCIrbnVtYmVyRm9ybWF0KHZhbCkrIiAiK3ZhbDsKCQkgKiAgICAgICAgICAgICAgcmV0dXJuOwoJCSAqICAgICAgICAgICAgfQoJCSAqICAgICAgICAgICAgZWxzZSBpZiAodHlwZSA9PT0gJ2Rpc3BsYXknKSB7CgkJICogICAgICAgICAgICAgIHJldHVybiBzb3VyY2UucHJpY2VfZGlzcGxheTsKCQkgKiAgICAgICAgICAgIH0KCQkgKiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGUgPT09ICdmaWx0ZXInKSB7CgkJICogICAgICAgICAgICAgIHJldHVybiBzb3VyY2UucHJpY2VfZmlsdGVyOwoJCSAqICAgICAgICAgICAgfQoJCSAqICAgICAgICAgICAgLy8gJ3NvcnQnLCAndHlwZScgYW5kIHVuZGVmaW5lZCBhbGwganVzdCB1c2UgdGhlIGludGVnZXIKCQkgKiAgICAgICAgICAgIHJldHVybiBzb3VyY2UucHJpY2U7CgkJICogICAgICAgICAgfQoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJtRGF0YVByb3AiOiBudWxsLAoJCgkKCQkvKioKCQkgKiBDaGFuZ2UgdGhlIGNlbGwgdHlwZSBjcmVhdGVkIGZvciB0aGUgY29sdW1uIC0gZWl0aGVyIFREIGNlbGxzIG9yIFRIIGNlbGxzLiBUaGlzCgkJICogY2FuIGJlIHVzZWZ1bCBhcyBUSCBjZWxscyBoYXZlIHNlbWFudGljIG1lYW5pbmcgaW4gdGhlIHRhYmxlIGJvZHksIGFsbG93aW5nIHRoZW0KCQkgKiB0byBhY3QgYXMgYSBoZWFkZXIgZm9yIGEgcm93ICh5b3UgbWF5IHdpc2ggdG8gYWRkIHNjb3BlPSdyb3cnIHRvIHRoZSBUSCBlbGVtZW50cykuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCB0ZAoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIE1ha2UgdGhlIGZpcnN0IGNvbHVtbiB1c2UgVEggY2VsbHMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgIHZhciBvVGFibGUgPSAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5EZWZzIjogWwoJCSAqICAgICAgICB7CgkJICogICAgICAgICAgImFUYXJnZXRzIjogWyAwIF0sCgkJICogICAgICAgICAgInNDZWxsVHlwZSI6ICJ0aCIKCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkic0NlbGxUeXBlIjogInRkIiwKCQoJCgkJLyoqCgkJICogQ2xhc3MgdG8gZ2l2ZSB0byBlYWNoIGNlbGwgaW4gdGhpcyBjb2x1bW4uCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCA8aT5FbXB0eSBzdHJpbmc8L2k+CgkJICogIEBkdG9wdCBDb2x1bW5zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5EZWZzCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5EZWZzIjogWyAKCQkgKiAgICAgICAgICB7ICJzQ2xhc3MiOiAibXlfY2xhc3MiLCAiYVRhcmdldHMiOiBbIDAgXSB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5zCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWyAKCQkgKiAgICAgICAgICB7ICJzQ2xhc3MiOiAibXlfY2xhc3MiIH0sCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbAoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJzQ2xhc3MiOiAiIiwKCQkKCQkvKioKCQkgKiBXaGVuIERhdGFUYWJsZXMgY2FsY3VsYXRlcyB0aGUgY29sdW1uIHdpZHRocyB0byBhc3NpZ24gdG8gZWFjaCBjb2x1bW4sCgkJICogaXQgZmluZHMgdGhlIGxvbmdlc3Qgc3RyaW5nIGluIGVhY2ggY29sdW1uIGFuZCB0aGVuIGNvbnN0cnVjdHMgYQoJCSAqIHRlbXBvcmFyeSB0YWJsZSBhbmQgcmVhZHMgdGhlIHdpZHRocyBmcm9tIHRoYXQuIFRoZSBwcm9ibGVtIHdpdGggdGhpcwoJCSAqIGlzIHRoYXQgIm1tbSIgaXMgbXVjaCB3aWRlciB0aGVuICJpaWlpIiwgYnV0IHRoZSBsYXR0ZXIgaXMgYSBsb25nZXIgCgkJICogc3RyaW5nIC0gdGh1cyB0aGUgY2FsY3VsYXRpb24gY2FuIGdvIHdyb25nIChkb2luZyBpdCBwcm9wZXJseSBhbmQgcHV0dGluZwoJCSAqIGl0IGludG8gYW4gRE9NIG9iamVjdCBhbmQgbWVhc3VyaW5nIHRoYXQgaXMgaG9ycmlibHkoISkgc2xvdykuIFRodXMgYXMKCQkgKiBhICJ3b3JrIGFyb3VuZCIgd2UgcHJvdmlkZSB0aGlzIG9wdGlvbi4gSXQgd2lsbCBhcHBlbmQgaXRzIHZhbHVlIHRvIHRoZQoJCSAqIHRleHQgdGhhdCBpcyBmb3VuZCB0byBiZSB0aGUgbG9uZ2VzdCBzdHJpbmcgZm9yIHRoZSBjb2x1bW4gLSBpLmUuIHBhZGRpbmcuCgkJICogR2VuZXJhbGx5IHlvdSBzaG91bGRuJ3QgbmVlZCB0aGlzLCBhbmQgaXQgaXMgbm90IGRvY3VtZW50ZWQgb24gdGhlIAoJCSAqIGdlbmVyYWwgRGF0YVRhYmxlcy5uZXQgZG9jdW1lbnRhdGlvbgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgPGk+RW1wdHkgc3RyaW5nPGk+CgkJICogIEBkdG9wdCBDb2x1bW5zCgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5zCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWyAKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICB7CgkJICogICAgICAgICAgICAic0NvbnRlbnRQYWRkaW5nIjogIm1tbSIKCQkgKiAgICAgICAgICB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJInNDb250ZW50UGFkZGluZyI6ICIiLAoJCgkKCQkvKioKCQkgKiBBbGxvd3MgYSBkZWZhdWx0IHZhbHVlIHRvIGJlIGdpdmVuIGZvciBhIGNvbHVtbidzIGRhdGEsIGFuZCB3aWxsIGJlIHVzZWQKCQkgKiB3aGVuZXZlciBhIG51bGwgZGF0YSBzb3VyY2UgaXMgZW5jb3VudGVyZWQgKHRoaXMgY2FuIGJlIGJlY2F1c2UgbURhdGFQcm9wCgkJICogaXMgc2V0IHRvIG51bGwsIG9yIGJlY2F1c2UgdGhlIGRhdGEgc291cmNlIGl0c2VsZiBpcyBudWxsKS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKiAgQGR0b3B0IENvbHVtbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbkRlZnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbkRlZnMiOiBbIAoJCSAqICAgICAgICAgIHsKCQkgKiAgICAgICAgICAgICJtRGF0YVByb3AiOiBudWxsLAoJCSAqICAgICAgICAgICAgInNEZWZhdWx0Q29udGVudCI6ICJFZGl0IiwKCQkgKiAgICAgICAgICAgICJhVGFyZ2V0cyI6IFsgLTEgXQoJCSAqICAgICAgICAgIH0KCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKiAgICAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbnMiOiBbIAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIHsKCQkgKiAgICAgICAgICAgICJtRGF0YVByb3AiOiBudWxsLAoJCSAqICAgICAgICAgICAgInNEZWZhdWx0Q29udGVudCI6ICJFZGl0IgoJCSAqICAgICAgICAgIH0KCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkic0RlZmF1bHRDb250ZW50IjogbnVsbCwKCQoJCgkJLyoqCgkJICogVGhpcyBwYXJhbWV0ZXIgaXMgb25seSB1c2VkIGluIERhdGFUYWJsZXMnIHNlcnZlci1zaWRlIHByb2Nlc3NpbmcuIEl0IGNhbgoJCSAqIGJlIGV4Y2VwdGlvbmFsbHkgdXNlZnVsIHRvIGtub3cgd2hhdCBjb2x1bW5zIGFyZSBiZWluZyBkaXNwbGF5ZWQgb24gdGhlCgkJICogY2xpZW50IHNpZGUsIGFuZCB0byBtYXAgdGhlc2UgdG8gZGF0YWJhc2UgZmllbGRzLiBXaGVuIGRlZmluZWQsIHRoZSBuYW1lcwoJCSAqIGFsc28gYWxsb3cgRGF0YVRhYmxlcyB0byByZW9yZGVyIGluZm9ybWF0aW9uIGZyb20gdGhlIHNlcnZlciBpZiBpdCBjb21lcwoJCSAqIGJhY2sgaW4gYW4gdW5leHBlY3RlZCBvcmRlciAoaS5lLiBpZiB5b3Ugc3dpdGNoIHlvdXIgY29sdW1ucyBhcm91bmQgb24gdGhlCgkJICogY2xpZW50LXNpZGUsIHlvdXIgc2VydmVyLXNpZGUgY29kZSBkb2VzIG5vdCBhbHNvIG5lZWQgdXBkYXRpbmcpLgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgPGk+RW1wdHkgc3RyaW5nPC9pPgoJCSAqICBAZHRvcHQgQ29sdW1ucwoJCSAqIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1uRGVmcwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1uRGVmcyI6IFsgCgkJICogICAgICAgICAgeyAic05hbWUiOiAiZW5naW5lIiwgImFUYXJnZXRzIjogWyAwIF0gfSwKCQkgKiAgICAgICAgICB7ICJzTmFtZSI6ICJicm93c2VyIiwgImFUYXJnZXRzIjogWyAxIF0gfSwKCQkgKiAgICAgICAgICB7ICJzTmFtZSI6ICJwbGF0Zm9ybSIsICJhVGFyZ2V0cyI6IFsgMiBdIH0sCgkJICogICAgICAgICAgeyAic05hbWUiOiAidmVyc2lvbiIsICJhVGFyZ2V0cyI6IFsgMyBdIH0sCgkJICogICAgICAgICAgeyAic05hbWUiOiAiZ3JhZGUiLCAiYVRhcmdldHMiOiBbIDQgXSB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5zCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWyAKCQkgKiAgICAgICAgICB7ICJzTmFtZSI6ICJlbmdpbmUiIH0sCgkJICogICAgICAgICAgeyAic05hbWUiOiAiYnJvd3NlciIgfSwKCQkgKiAgICAgICAgICB7ICJzTmFtZSI6ICJwbGF0Zm9ybSIgfSwKCQkgKiAgICAgICAgICB7ICJzTmFtZSI6ICJ2ZXJzaW9uIiB9LAoJCSAqICAgICAgICAgIHsgInNOYW1lIjogImdyYWRlIiB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJInNOYW1lIjogIiIsCgkKCQoJCS8qKgoJCSAqIERlZmluZXMgYSBkYXRhIHNvdXJjZSB0eXBlIGZvciB0aGUgc29ydGluZyB3aGljaCBjYW4gYmUgdXNlZCB0byByZWFkCgkJICogcmVhbHRpbWUgaW5mb3JtYXRpb24gZnJvbSB0aGUgdGFibGUgKHVwZGF0aW5nIHRoZSBpbnRlcm5hbGx5IGNhY2hlZAoJCSAqIHZlcnNpb24pIHByaW9yIHRvIHNvcnRpbmcuIFRoaXMgYWxsb3dzIHNvcnRpbmcgdG8gb2NjdXIgb24gdXNlciBlZGl0YWJsZQoJCSAqIGVsZW1lbnRzIHN1Y2ggYXMgZm9ybSBpbnB1dHMuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBzdGQKCQkgKiAgQGR0b3B0IENvbHVtbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbkRlZnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbkRlZnMiOiBbCgkJICogICAgICAgICAgeyAic1NvcnREYXRhVHlwZSI6ICJkb20tdGV4dCIsICJhVGFyZ2V0cyI6IFsgMiwgMyBdIH0sCgkJICogICAgICAgICAgeyAic1R5cGUiOiAibnVtZXJpYyIsICJhVGFyZ2V0cyI6IFsgMyBdIH0sCgkJICogICAgICAgICAgeyAic1NvcnREYXRhVHlwZSI6ICJkb20tc2VsZWN0IiwgImFUYXJnZXRzIjogWyA0IF0gfSwKCQkgKiAgICAgICAgICB7ICJzU29ydERhdGFUeXBlIjogImRvbS1jaGVja2JveCIsICJhVGFyZ2V0cyI6IFsgNSBdIH0KCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKiAgICAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbnMiOiBbCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIHsgInNTb3J0RGF0YVR5cGUiOiAiZG9tLXRleHQiIH0sCgkJICogICAgICAgICAgeyAic1NvcnREYXRhVHlwZSI6ICJkb20tdGV4dCIsICJzVHlwZSI6ICJudW1lcmljIiB9LAoJCSAqICAgICAgICAgIHsgInNTb3J0RGF0YVR5cGUiOiAiZG9tLXNlbGVjdCIgfSwKCQkgKiAgICAgICAgICB7ICJzU29ydERhdGFUeXBlIjogImRvbS1jaGVja2JveCIgfQoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqLwoJCSJzU29ydERhdGFUeXBlIjogInN0ZCIsCgkKCQoJCS8qKgoJCSAqIFRoZSB0aXRsZSBvZiB0aGlzIGNvbHVtbi4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IG51bGwgPGk+RGVyaXZlZCBmcm9tIHRoZSAnVEgnIHZhbHVlIGZvciB0aGlzIGNvbHVtbiBpbiB0aGUgCgkJICogICAgb3JpZ2luYWwgSFRNTCB0YWJsZS48L2k+CgkJICogIEBkdG9wdCBDb2x1bW5zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5EZWZzCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5EZWZzIjogWyAKCQkgKiAgICAgICAgICB7ICJzVGl0bGUiOiAiTXkgY29sdW1uIHRpdGxlIiwgImFUYXJnZXRzIjogWyAwIF0gfQoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1ucwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1ucyI6IFsgCgkJICogICAgICAgICAgeyAic1RpdGxlIjogIk15IGNvbHVtbiB0aXRsZSIgfSwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsCgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJInNUaXRsZSI6IG51bGwsCgkKCQoJCS8qKgoJCSAqIFRoZSB0eXBlIGFsbG93cyB5b3UgdG8gc3BlY2lmeSBob3cgdGhlIGRhdGEgZm9yIHRoaXMgY29sdW1uIHdpbGwgYmUgc29ydGVkLgoJCSAqIEZvdXIgdHlwZXMgKHN0cmluZywgbnVtZXJpYywgZGF0ZSBhbmQgaHRtbCAod2hpY2ggd2lsbCBzdHJpcCBIVE1MIHRhZ3MKCQkgKiBiZWZvcmUgc29ydGluZykpIGFyZSBjdXJyZW50bHkgYXZhaWxhYmxlLiBOb3RlIHRoYXQgb25seSBkYXRlIGZvcm1hdHMKCQkgKiB1bmRlcnN0b29kIGJ5IEphdmFzY3JpcHQncyBEYXRlKCkgb2JqZWN0IHdpbGwgYmUgYWNjZXB0ZWQgYXMgdHlwZSBkYXRlLiBGb3IKCQkgKiBleGFtcGxlOiAiTWFyIDI2LCAyMDA4IDU6MDMgUE0iLiBNYXkgdGFrZSB0aGUgdmFsdWVzOiAnc3RyaW5nJywgJ251bWVyaWMnLAoJCSAqICdkYXRlJyBvciAnaHRtbCcgKGJ5IGRlZmF1bHQpLiBGdXJ0aGVyIHR5cGVzIGNhbiBiZSBhZGRpbmcgdGhyb3VnaAoJCSAqIHBsdWctaW5zLgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgbnVsbCA8aT5BdXRvLWRldGVjdGVkIGZyb20gcmF3IGRhdGE8L2k+CgkJICogIEBkdG9wdCBDb2x1bW5zCgkJICogCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5EZWZzCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5EZWZzIjogWyAKCQkgKiAgICAgICAgICB7ICJzVHlwZSI6ICJodG1sIiwgImFUYXJnZXRzIjogWyAwIF0gfQoJCSAqICAgICAgICBdCgkJICogICAgICB9ICk7CgkJICogICAgfSApOwoJCSAqICAgIAoJCSAqICBAZXhhbXBsZQoJCSAqICAgIC8vIFVzaW5nIGFvQ29sdW1ucwoJCSAqICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgewoJCSAqICAgICAgJCgnI2V4YW1wbGUnKS5kYXRhVGFibGUoIHsKCQkgKiAgICAgICAgImFvQ29sdW1ucyI6IFsgCgkJICogICAgICAgICAgeyAic1R5cGUiOiAiaHRtbCIgfSwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsCgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICovCgkJInNUeXBlIjogbnVsbCwKCQoJCgkJLyoqCgkJICogRGVmaW5pbmcgdGhlIHdpZHRoIG9mIHRoZSBjb2x1bW4sIHRoaXMgcGFyYW1ldGVyIG1heSB0YWtlIGFueSBDU1MgdmFsdWUKCQkgKiAoM2VtLCAyMHB4IGV0YykuIERhdGFUYWJsZXMgYXBwbHlzICdzbWFydCcgd2lkdGhzIHRvIGNvbHVtbnMgd2hpY2ggaGF2ZSBub3QKCQkgKiBiZWVuIGdpdmVuIGEgc3BlY2lmaWMgd2lkdGggdGhyb3VnaCB0aGlzIGludGVyZmFjZSBlbnN1cmluZyB0aGF0IHRoZSB0YWJsZQoJCSAqIHJlbWFpbnMgcmVhZGFibGUuCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBudWxsIDxpPkF1dG9tYXRpYzwvaT4KCQkgKiAgQGR0b3B0IENvbHVtbnMKCQkgKiAKCQkgKiAgQGV4YW1wbGUKCQkgKiAgICAvLyBVc2luZyBhb0NvbHVtbkRlZnMKCQkgKiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkgKiAgICAgICQoJyNleGFtcGxlJykuZGF0YVRhYmxlKCB7CgkJICogICAgICAgICJhb0NvbHVtbkRlZnMiOiBbIAoJCSAqICAgICAgICAgIHsgInNXaWR0aCI6ICIyMCUiLCAiYVRhcmdldHMiOiBbIDAgXSB9CgkJICogICAgICAgIF0KCQkgKiAgICAgIH0gKTsKCQkgKiAgICB9ICk7CgkJICogICAgCgkJICogIEBleGFtcGxlCgkJICogICAgLy8gVXNpbmcgYW9Db2x1bW5zCgkJICogICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICogICAgICAkKCcjZXhhbXBsZScpLmRhdGFUYWJsZSggewoJCSAqICAgICAgICAiYW9Db2x1bW5zIjogWyAKCQkgKiAgICAgICAgICB7ICJzV2lkdGgiOiAiMjAlIiB9LAoJCSAqICAgICAgICAgIG51bGwsCgkJICogICAgICAgICAgbnVsbCwKCQkgKiAgICAgICAgICBudWxsLAoJCSAqICAgICAgICAgIG51bGwKCQkgKiAgICAgICAgXQoJCSAqICAgICAgfSApOwoJCSAqICAgIH0gKTsKCQkgKi8KCQkic1dpZHRoIjogbnVsbAoJfTsKCQoJCgkKCS8qKgoJICogRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QgLSB0aGlzIGhvbGRzIGFsbCB0aGUgaW5mb3JtYXRpb24gbmVlZGVkIGZvciBhCgkgKiBnaXZlbiB0YWJsZSwgaW5jbHVkaW5nIGNvbmZpZ3VyYXRpb24sIGRhdGEgYW5kIGN1cnJlbnQgYXBwbGljYXRpb24gb2YgdGhlCgkgKiB0YWJsZSBvcHRpb25zLiBEYXRhVGFibGVzIGRvZXMgbm90IGhhdmUgYSBzaW5nbGUgaW5zdGFuY2UgZm9yIGVhY2ggRGF0YVRhYmxlCgkgKiB3aXRoIHRoZSBzZXR0aW5ncyBhdHRhY2hlZCB0byB0aGF0IGluc3RhbmNlLCBidXQgcmF0aGVyIGluc3RhbmNlcyBvZiB0aGUKCSAqIERhdGFUYWJsZSAiY2xhc3MiIGFyZSBjcmVhdGVkIG9uLXRoZS1mbHkgYXMgbmVlZGVkICh0eXBpY2FsbHkgYnkgYSAKCSAqICQoKS5kYXRhVGFibGUoKSBjYWxsKSBhbmQgdGhlIHNldHRpbmdzIG9iamVjdCBpcyB0aGVuIGFwcGxpZWQgdG8gdGhhdAoJICogaW5zdGFuY2UuCgkgKiAKCSAqIE5vdGUgdGhhdCB0aGlzIG9iamVjdCBpcyByZWxhdGVkIHRvIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9IGJ1dCB0aGlzIAoJICogb25lIGlzIHRoZSBpbnRlcm5hbCBkYXRhIHN0b3JlIGZvciBEYXRhVGFibGVzJ3MgY2FjaGUgb2YgY29sdW1ucy4gSXQgc2hvdWxkCgkgKiBOT1QgYmUgbWFuaXB1bGF0ZWQgb3V0c2lkZSBvZiBEYXRhVGFibGVzLiBBbnkgY29uZmlndXJhdGlvbiBzaG91bGQgYmUgZG9uZQoJICogdGhyb3VnaCB0aGUgaW5pdGlhbGlzYXRpb24gb3B0aW9ucy4KCSAqICBAbmFtZXNwYWNlCgkgKiAgQHRvZG8gUmVhbGx5IHNob3VsZCBhdHRhY2ggdGhlIHNldHRpbmdzIG9iamVjdCB0byBpbmRpdmlkdWFsIGluc3RhbmNlcyBzbyB3ZQoJICogICAgZG9uJ3QgbmVlZCB0byBjcmVhdGUgbmV3IGluc3RhbmNlcyBvbiBlYWNoICQoKS5kYXRhVGFibGUoKSBjYWxsIChpZiB0aGUKCSAqICAgIHRhYmxlIGFscmVhZHkgZXhpc3RzKS4gSXQgd291bGQgYWxzbyBzYXZlIHBhc3Npbmcgb1NldHRpbmdzIGFyb3VuZCBhbmQKCSAqICAgIGludG8gZXZlcnkgc2luZ2xlIGZ1bmN0aW9uLiBIb3dldmVyLCB0aGlzIGlzIGEgdmVyeSBzaWduaWZpY2FudCAKCSAqICAgIGFyY2hpdGVjdHVyZSBjaGFuZ2UgZm9yIERhdGFUYWJsZXMgYW5kIHdpbGwgYWxtb3N0IGNlcnRhaW5seSBicmVhawoJICogICAgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkgd2l0aCBvbGRlciBpbnN0YWxsYXRpb25zLiBUaGlzIGlzIHNvbWV0aGluZyB0aGF0CgkgKiAgICB3aWxsIGJlIGRvbmUgaW4gMi4wLgoJICovCglEYXRhVGFibGUubW9kZWxzLm9TZXR0aW5ncyA9IHsKCQkvKioKCQkgKiBQcmltYXJ5IGZlYXR1cmVzIG9mIERhdGFUYWJsZXMgYW5kIHRoZWlyIGVuYWJsZW1lbnQgc3RhdGUuCgkJICogIEBuYW1lc3BhY2UKCQkgKi8KCQkib0ZlYXR1cmVzIjogewoJCQkKCQkJLyoqCgkJCSAqIEZsYWcgdG8gc2F5IGlmIERhdGFUYWJsZXMgc2hvdWxkIGF1dG9tYXRpY2FsbHkgdHJ5IHRvIGNhbGN1bGF0ZSB0aGUKCQkJICogb3B0aW11bSB0YWJsZSBhbmQgY29sdW1ucyB3aWR0aHMgKHRydWUpIG9yIG5vdCAoZmFsc2UpLgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCQkgKiAgQHR5cGUgYm9vbGVhbgoJCQkgKi8KCQkJImJBdXRvV2lkdGgiOiBudWxsLAoJCgkJCS8qKgoJCQkgKiBEZWxheSB0aGUgY3JlYXRpb24gb2YgVFIgYW5kIFREIGVsZW1lbnRzIHVudGlsIHRoZXkgYXJlIGFjdHVhbGx5CgkJCSAqIG5lZWRlZCBieSBhIGRyaXZlbiBwYWdlIGRyYXcuIFRoaXMgY2FuIGdpdmUgYSBzaWduaWZpY2FudCBzcGVlZAoJCQkgKiBpbmNyZWFzZSBmb3IgQWpheCBzb3VyY2UgYW5kIEphdmFzY3JpcHQgc291cmNlIGRhdGEsIGJ1dCBtYWtlcyBubwoJCQkgKiBkaWZmZXJlbmNlIGF0IGFsbCBmcm8gRE9NIGFuZCBzZXJ2ZXItc2lkZSBwcm9jZXNzaW5nIHRhYmxlcy4KCQkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkJICogIEB0eXBlIGJvb2xlYW4KCQkJICovCgkJCSJiRGVmZXJSZW5kZXIiOiBudWxsLAoJCQkKCQkJLyoqCgkJCSAqIEVuYWJsZSBmaWx0ZXJpbmcgb24gdGhlIHRhYmxlIG9yIG5vdC4gTm90ZSB0aGF0IGlmIHRoaXMgaXMgZGlzYWJsZWQKCQkJICogdGhlbiB0aGVyZSBpcyBubyBmaWx0ZXJpbmcgYXQgYWxsIG9uIHRoZSB0YWJsZSwgaW5jbHVkaW5nIGZuRmlsdGVyLgoJCQkgKiBUbyBqdXN0IHJlbW92ZSB0aGUgZmlsdGVyaW5nIGlucHV0IHVzZSBzRG9tIGFuZCByZW1vdmUgdGhlICdmJyBvcHRpb24uCgkJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJCSAqICBAdHlwZSBib29sZWFuCgkJCSAqLwoJCQkiYkZpbHRlciI6IG51bGwsCgkJCQoJCQkvKioKCQkJICogVGFibGUgaW5mb3JtYXRpb24gZWxlbWVudCAodGhlICdTaG93aW5nIHggb2YgeSByZWNvcmRzJyBkaXYpIGVuYWJsZQoJCQkgKiBmbGFnLgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCQkgKiAgQHR5cGUgYm9vbGVhbgoJCQkgKi8KCQkJImJJbmZvIjogbnVsbCwKCQkJCgkJCS8qKgoJCQkgKiBQcmVzZW50IGEgdXNlciBjb250cm9sIGFsbG93aW5nIHRoZSBlbmQgdXNlciB0byBjaGFuZ2UgdGhlIHBhZ2Ugc2l6ZQoJCQkgKiB3aGVuIHBhZ2luYXRpb24gaXMgZW5hYmxlZC4KCQkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkJICogIEB0eXBlIGJvb2xlYW4KCQkJICovCgkJCSJiTGVuZ3RoQ2hhbmdlIjogbnVsbCwKCQoJCQkvKioKCQkJICogUGFnaW5hdGlvbiBlbmFibGVkIG9yIG5vdC4gTm90ZSB0aGF0IGlmIHRoaXMgaXMgZGlzYWJsZWQgdGhlbiBsZW5ndGgKCQkJICogY2hhbmdpbmcgbXVzdCBhbHNvIGJlIGRpc2FibGVkLgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCQkgKiAgQHR5cGUgYm9vbGVhbgoJCQkgKi8KCQkJImJQYWdpbmF0ZSI6IG51bGwsCgkJCQoJCQkvKioKCQkJICogUHJvY2Vzc2luZyBpbmRpY2F0b3IgZW5hYmxlIGZsYWcgd2hlbmV2ZXIgRGF0YVRhYmxlcyBpcyBlbmFjdGluZyBhCgkJCSAqIHVzZXIgcmVxdWVzdCAtIHR5cGljYWxseSBhbiBBamF4IHJlcXVlc3QgZm9yIHNlcnZlci1zaWRlIHByb2Nlc3NpbmcuCgkJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJCSAqICBAdHlwZSBib29sZWFuCgkJCSAqLwoJCQkiYlByb2Nlc3NpbmciOiBudWxsLAoJCQkKCQkJLyoqCgkJCSAqIFNlcnZlci1zaWRlIHByb2Nlc3NpbmcgZW5hYmxlZCBmbGFnIC0gd2hlbiBlbmFibGVkIERhdGFUYWJsZXMgd2lsbAoJCQkgKiBnZXQgYWxsIGRhdGEgZnJvbSB0aGUgc2VydmVyIGZvciBldmVyeSBkcmF3IC0gdGhlcmUgaXMgbm8gZmlsdGVyaW5nLAoJCQkgKiBzb3J0aW5nIG9yIHBhZ2luZyBkb25lIG9uIHRoZSBjbGllbnQtc2lkZS4KCQkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkJICogIEB0eXBlIGJvb2xlYW4KCQkJICovCgkJCSJiU2VydmVyU2lkZSI6IG51bGwsCgkJCQoJCQkvKioKCQkJICogU29ydGluZyBlbmFibGVtZW50IGZsYWcuCgkJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJCSAqICBAdHlwZSBib29sZWFuCgkJCSAqLwoJCQkiYlNvcnQiOiBudWxsLAoJCQkKCQkJLyoqCgkJCSAqIEFwcGx5IGEgY2xhc3MgdG8gdGhlIGNvbHVtbnMgd2hpY2ggYXJlIGJlaW5nIHNvcnRlZCB0byBwcm92aWRlIGEKCQkJICogdmlzdWFsIGhpZ2hsaWdodCBvciBub3QuIFRoaXMgY2FuIHNsb3cgdGhpbmdzIGRvd24gd2hlbiBlbmFibGVkIHNpbmNlCgkJCSAqIHRoZXJlIGlzIGEgbG90IG9mIERPTSBpbnRlcmFjdGlvbi4KCQkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkJICogIEB0eXBlIGJvb2xlYW4KCQkJICovCgkJCSJiU29ydENsYXNzZXMiOiBudWxsLAoJCQkKCQkJLyoqCgkJCSAqIFN0YXRlIHNhdmluZyBlbmFibGVtZW50IGZsYWcuCgkJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJCSAqICBAdHlwZSBib29sZWFuCgkJCSAqLwoJCQkiYlN0YXRlU2F2ZSI6IG51bGwKCQl9LAoJCQoJCgkJLyoqCgkJICogU2Nyb2xsaW5nIHNldHRpbmdzIGZvciBhIHRhYmxlLgoJCSAqICBAbmFtZXNwYWNlCgkJICovCgkJIm9TY3JvbGwiOiB7CgkJCS8qKgoJCQkgKiBJbmRpY2F0ZSBpZiBEYXRhVGFibGVzIHNob3VsZCBiZSBhbGxvd2VkIHRvIHNldCB0aGUgcGFkZGluZyAvIG1hcmdpbgoJCQkgKiBldGMgZm9yIHRoZSBzY3JvbGxpbmcgaGVhZGVyIGVsZW1lbnRzIG9yIG5vdC4gVHlwaWNhbGx5IHlvdSB3aWxsIHdhbnQKCQkJICogdGhpcy4KCQkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkJICogIEB0eXBlIGJvb2xlYW4KCQkJICovCgkJCSJiQXV0b0NzcyI6IG51bGwsCgkJCQoJCQkvKioKCQkJICogV2hlbiB0aGUgdGFibGUgaXMgc2hvcnRlciBpbiBoZWlnaHQgdGhhbiBzU2Nyb2xsWSwgY29sbGFwc2UgdGhlCgkJCSAqIHRhYmxlIGNvbnRhaW5lciBkb3duIHRvIHRoZSBoZWlnaHQgb2YgdGhlIHRhYmxlICh3aGVuIHRydWUpLgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCQkgKiAgQHR5cGUgYm9vbGVhbgoJCQkgKi8KCQkJImJDb2xsYXBzZSI6IG51bGwsCgkJCQoJCQkvKioKCQkJICogSW5maW5pdGUgc2Nyb2xsaW5nIGVuYWJsZW1lbnQgZmxhZy4gTm93IGRlcHJlY2F0ZWQgaW4gZmF2b3VyIG9mCgkJCSAqIHVzaW5nIHRoZSBTY3JvbGxlciBwbHVnLWluLgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCQkgKiAgQHR5cGUgYm9vbGVhbgoJCQkgKi8KCQkJImJJbmZpbml0ZSI6IG51bGwsCgkJCQoJCQkvKioKCQkJICogV2lkdGggb2YgdGhlIHNjcm9sbGJhciBmb3IgdGhlIHdlYi1icm93c2VyJ3MgcGxhdGZvcm0uIENhbGN1bGF0ZWQKCQkJICogZHVyaW5nIHRhYmxlIGluaXRpYWxpc2F0aW9uLgoJCQkgKiAgQHR5cGUgaW50CgkJCSAqICBAZGVmYXVsdCAwCgkJCSAqLwoJCQkiaUJhcldpZHRoIjogMCwKCQkJCgkJCS8qKgoJCQkgKiBTcGFjZSAoaW4gcGl4ZWxzKSBiZXR3ZWVuIHRoZSBib3R0b20gb2YgdGhlIHNjcm9sbGluZyBjb250YWluZXIgYW5kIAoJCQkgKiB0aGUgYm90dG9tIG9mIHRoZSBzY3JvbGxpbmcgdmlld3BvcnQgYmVmb3JlIHRoZSBuZXh0IHBhZ2UgaXMgbG9hZGVkCgkJCSAqIHdoZW4gdXNpbmcgaW5maW5pdGUgc2Nyb2xsaW5nLgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCQkgKiAgQHR5cGUgaW50CgkJCSAqLwoJCQkiaUxvYWRHYXAiOiBudWxsLAoJCQkKCQkJLyoqCgkJCSAqIFZpZXdwb3J0IHdpZHRoIGZvciBob3Jpem9udGFsIHNjcm9sbGluZy4gSG9yaXpvbnRhbCBzY3JvbGxpbmcgaXMgCgkJCSAqIGRpc2FibGVkIGlmIGFuIGVtcHR5IHN0cmluZy4KCQkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkJICogIEB0eXBlIHN0cmluZwoJCQkgKi8KCQkJInNYIjogbnVsbCwKCQkJCgkJCS8qKgoJCQkgKiBXaWR0aCB0byBleHBhbmQgdGhlIHRhYmxlIHRvIHdoZW4gdXNpbmcgeC1zY3JvbGxpbmcuIFR5cGljYWxseSB5b3UKCQkJICogc2hvdWxkIG5vdCBuZWVkIHRvIHVzZSB0aGlzLgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCSAqICBAZGVwcmVjYXRlZAoJCQkgKi8KCQkJInNYSW5uZXIiOiBudWxsLAoJCQkKCQkJLyoqCgkJCSAqIFZpZXdwb3J0IGhlaWdodCBmb3IgdmVydGljYWwgc2Nyb2xsaW5nLiBWZXJ0aWNhbCBzY3JvbGxpbmcgaXMgZGlzYWJsZWQKCQkJICogaWYgYW4gZW1wdHkgc3RyaW5nLgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCQkgKiAgQHR5cGUgc3RyaW5nCgkJCSAqLwoJCQkic1kiOiBudWxsCgkJfSwKCQkKCQkvKioKCQkgKiBMYW5ndWFnZSBpbmZvcm1hdGlvbiBmb3IgdGhlIHRhYmxlLgoJCSAqICBAbmFtZXNwYWNlCgkJICogIEBleHRlbmRzIERhdGFUYWJsZS5kZWZhdWx0cy5vTGFuZ3VhZ2UKCQkgKi8KCQkib0xhbmd1YWdlIjogewoJCQkvKioKCQkJICogSW5mb3JtYXRpb24gY2FsbGJhY2sgZnVuY3Rpb24uIFNlZSAKCQkJICoge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0cy5mbkluZm9DYWxsYmFja30KCQkJICogIEB0eXBlIGZ1bmN0aW9uCgkJCSAqICBAZGVmYXVsdCAKCQkJICovCgkJCSJmbkluZm9DYWxsYmFjayI6IG51bGwKCQl9LAoJCQoJCS8qKgoJCSAqIEFycmF5IHJlZmVyZW5jaW5nIHRoZSBub2RlcyB3aGljaCBhcmUgdXNlZCBmb3IgdGhlIGZlYXR1cmVzLiBUaGUgCgkJICogcGFyYW1ldGVycyBvZiB0aGlzIG9iamVjdCBtYXRjaCB3aGF0IGlzIGFsbG93ZWQgYnkgc0RvbSAtIGkuZS4KCQkgKiAgIDx1bD4KCQkgKiAgICAgPGxpPidsJyAtIExlbmd0aCBjaGFuZ2luZzwvbGk+CgkJICogICAgIDxsaT4nZicgLSBGaWx0ZXJpbmcgaW5wdXQ8L2xpPgoJCSAqICAgICA8bGk+J3QnIC0gVGhlIHRhYmxlITwvbGk+CgkJICogICAgIDxsaT4naScgLSBJbmZvcm1hdGlvbjwvbGk+CgkJICogICAgIDxsaT4ncCcgLSBQYWdpbmF0aW9uPC9saT4KCQkgKiAgICAgPGxpPidyJyAtIHBSb2Nlc3Npbmc8L2xpPgoJCSAqICAgPC91bD4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYWFuRmVhdHVyZXMiOiBbXSwKCQkKCQkvKioKCQkgKiBTdG9yZSBkYXRhIGluZm9ybWF0aW9uIC0gc2VlIHtAbGluayBEYXRhVGFibGUubW9kZWxzLm9Sb3d9IGZvciBkZXRhaWxlZAoJCSAqIGluZm9ybWF0aW9uLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb0RhdGEiOiBbXSwKCQkKCQkvKioKCQkgKiBBcnJheSBvZiBpbmRleGVzIHdoaWNoIGFyZSBpbiB0aGUgY3VycmVudCBkaXNwbGF5IChhZnRlciBmaWx0ZXJpbmcgZXRjKQoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhaURpc3BsYXkiOiBbXSwKCQkKCQkvKioKCQkgKiBBcnJheSBvZiBpbmRleGVzIGZvciBkaXNwbGF5IC0gbm8gZmlsdGVyaW5nCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFpRGlzcGxheU1hc3RlciI6IFtdLAoJCQoJCS8qKgoJCSAqIFN0b3JlIGluZm9ybWF0aW9uIGFib3V0IGVhY2ggY29sdW1uIHRoYXQgaXMgaW4gdXNlCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFvQ29sdW1ucyI6IFtdLAoJCQoJCS8qKgoJCSAqIFN0b3JlIGluZm9ybWF0aW9uIGFib3V0IHRoZSB0YWJsZSdzIGhlYWRlcgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb0hlYWRlciI6IFtdLAoJCQoJCS8qKgoJCSAqIFN0b3JlIGluZm9ybWF0aW9uIGFib3V0IHRoZSB0YWJsZSdzIGZvb3RlcgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb0Zvb3RlciI6IFtdLAoJCQoJCS8qKgoJCSAqIFNlYXJjaCBkYXRhIGFycmF5IGZvciByZWd1bGFyIGV4cHJlc3Npb24gc2VhcmNoaW5nCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFzRGF0YVNlYXJjaCI6IFtdLAoJCQoJCS8qKgoJCSAqIFN0b3JlIHRoZSBhcHBsaWVkIGdsb2JhbCBzZWFyY2ggaW5mb3JtYXRpb24gaW4gY2FzZSB3ZSB3YW50IHRvIGZvcmNlIGEgCgkJICogcmVzZWFyY2ggb3IgY29tcGFyZSB0aGUgb2xkIHNlYXJjaCB0byBhIG5ldyBvbmUuCgkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCSAqICBAbmFtZXNwYWNlCgkJICogIEBleHRlbmRzIERhdGFUYWJsZS5tb2RlbHMub1NlYXJjaAoJCSAqLwoJCSJvUHJldmlvdXNTZWFyY2giOiB7fSwKCQkKCQkvKioKCQkgKiBTdG9yZSB0aGUgYXBwbGllZCBzZWFyY2ggZm9yIGVhY2ggY29sdW1uIC0gc2VlIAoJCSAqIHtAbGluayBEYXRhVGFibGUubW9kZWxzLm9TZWFyY2h9IGZvciB0aGUgZm9ybWF0IHRoYXQgaXMgdXNlZCBmb3IgdGhlCgkJICogZmlsdGVyaW5nIGluZm9ybWF0aW9uIGZvciBlYWNoIGNvbHVtbi4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYW9QcmVTZWFyY2hDb2xzIjogW10sCgkJCgkJLyoqCgkJICogU29ydGluZyB0aGF0IGlzIGFwcGxpZWQgdG8gdGhlIHRhYmxlLiBOb3RlIHRoYXQgdGhlIGlubmVyIGFycmF5cyBhcmUKCQkgKiB1c2VkIGluIHRoZSBmb2xsb3dpbmcgbWFubmVyOgoJCSAqIDx1bD4KCQkgKiAgIDxsaT5JbmRleCAwIC0gY29sdW1uIG51bWJlcjwvbGk+CgkJICogICA8bGk+SW5kZXggMSAtIGN1cnJlbnQgc29ydGluZyBkaXJlY3Rpb248L2xpPgoJCSAqICAgPGxpPkluZGV4IDIgLSBpbmRleCBvZiBhc1NvcnRpbmcgZm9yIHRoaXMgY29sdW1uPC9saT4KCQkgKiA8L3VsPgoJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQHRvZG8gVGhlc2UgaW5uZXIgYXJyYXlzIHNob3VsZCByZWFsbHkgYmUgb2JqZWN0cwoJCSAqLwoJCSJhYVNvcnRpbmciOiBudWxsLAoJCQoJCS8qKgoJCSAqIFNvcnRpbmcgdGhhdCBpcyBhbHdheXMgYXBwbGllZCB0byB0aGUgdGFibGUgKGkuZS4gcHJlZml4ZWQgaW4gZnJvbnQgb2YKCQkgKiBhYVNvcnRpbmcpLgoJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkgKiAgQHR5cGUgYXJyYXl8bnVsbAoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJImFhU29ydGluZ0ZpeGVkIjogbnVsbCwKCQkKCQkvKioKCQkgKiBDbGFzc2VzIHRvIHVzZSBmb3IgdGhlIHN0cmlwaW5nIG9mIGEgdGFibGUuCgkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhc1N0cmlwZUNsYXNzZXMiOiBudWxsLAoJCQoJCS8qKgoJCSAqIElmIHJlc3RvcmluZyBhIHRhYmxlIC0gd2Ugc2hvdWxkIHJlc3RvcmUgaXRzIHN0cmlwaW5nIGNsYXNzZXMgYXMgd2VsbAoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhc0Rlc3Ryb3lTdHJpcGVzIjogW10sCgkJCgkJLyoqCgkJICogSWYgcmVzdG9yaW5nIGEgdGFibGUgLSB3ZSBzaG91bGQgcmVzdG9yZSBpdHMgd2lkdGggCgkJICogIEB0eXBlIGludAoJCSAqICBAZGVmYXVsdCAwCgkJICovCgkJInNEZXN0cm95V2lkdGgiOiAwLAoJCQoJCS8qKgoJCSAqIENhbGxiYWNrIGZ1bmN0aW9ucyBhcnJheSBmb3IgZXZlcnkgdGltZSBhIHJvdyBpcyBpbnNlcnRlZCAoaS5lLiBvbiBhIGRyYXcpLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb1Jvd0NhbGxiYWNrIjogW10sCgkJCgkJLyoqCgkJICogQ2FsbGJhY2sgZnVuY3Rpb25zIGZvciB0aGUgaGVhZGVyIG9uIGVhY2ggZHJhdy4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYW9IZWFkZXJDYWxsYmFjayI6IFtdLAoJCQoJCS8qKgoJCSAqIENhbGxiYWNrIGZ1bmN0aW9uIGZvciB0aGUgZm9vdGVyIG9uIGVhY2ggZHJhdy4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYW9Gb290ZXJDYWxsYmFjayI6IFtdLAoJCQoJCS8qKgoJCSAqIEFycmF5IG9mIGNhbGxiYWNrIGZ1bmN0aW9ucyBmb3IgZHJhdyBjYWxsYmFjayBmdW5jdGlvbnMKCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYW9EcmF3Q2FsbGJhY2siOiBbXSwKCQkKCQkvKioKCQkgKiBBcnJheSBvZiBjYWxsYmFjayBmdW5jdGlvbnMgZm9yIHJvdyBjcmVhdGVkIGZ1bmN0aW9uCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFvUm93Q3JlYXRlZENhbGxiYWNrIjogW10sCgkJCgkJLyoqCgkJICogQ2FsbGJhY2sgZnVuY3Rpb25zIGZvciBqdXN0IGJlZm9yZSB0aGUgdGFibGUgaXMgcmVkcmF3bi4gQSByZXR1cm4gb2YgCgkJICogZmFsc2Ugd2lsbCBiZSB1c2VkIHRvIGNhbmNlbCB0aGUgZHJhdy4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYW9QcmVEcmF3Q2FsbGJhY2siOiBbXSwKCQkKCQkvKioKCQkgKiBDYWxsYmFjayBmdW5jdGlvbnMgZm9yIHdoZW4gdGhlIHRhYmxlIGhhcyBiZWVuIGluaXRpYWxpc2VkLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb0luaXRDb21wbGV0ZSI6IFtdLAoJCgkJCgkJLyoqCgkJICogQ2FsbGJhY2tzIGZvciBtb2RpZnlpbmcgdGhlIHNldHRpbmdzIHRvIGJlIHN0b3JlZCBmb3Igc3RhdGUgc2F2aW5nLCBwcmlvciB0bwoJCSAqIHNhdmluZyBzdGF0ZS4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYW9TdGF0ZVNhdmVQYXJhbXMiOiBbXSwKCQkKCQkvKioKCQkgKiBDYWxsYmFja3MgZm9yIG1vZGlmeWluZyB0aGUgc2V0dGluZ3MgdGhhdCBoYXZlIGJlZW4gc3RvcmVkIGZvciBzdGF0ZSBzYXZpbmcKCQkgKiBwcmlvciB0byB1c2luZyB0aGUgc3RvcmVkIHZhbHVlcyB0byByZXN0b3JlIHRoZSBzdGF0ZS4KCQkgKiAgQHR5cGUgYXJyYXkKCQkgKiAgQGRlZmF1bHQgW10KCQkgKi8KCQkiYW9TdGF0ZUxvYWRQYXJhbXMiOiBbXSwKCQkKCQkvKioKCQkgKiBDYWxsYmFja3MgZm9yIG9wZXJhdGluZyBvbiB0aGUgc2V0dGluZ3Mgb2JqZWN0IG9uY2UgdGhlIHNhdmVkIHN0YXRlIGhhcyBiZWVuCgkJICogbG9hZGVkCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFvU3RhdGVMb2FkZWQiOiBbXSwKCQkKCQkvKioKCQkgKiBDYWNoZSB0aGUgdGFibGUgSUQgZm9yIHF1aWNrIGFjY2VzcwoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgPGk+RW1wdHkgc3RyaW5nPC9pPgoJCSAqLwoJCSJzVGFibGVJZCI6ICIiLAoJCQoJCS8qKgoJCSAqIFRoZSBUQUJMRSBub2RlIGZvciB0aGUgbWFpbiB0YWJsZQoJCSAqICBAdHlwZSBub2RlCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkiblRhYmxlIjogbnVsbCwKCQkKCQkvKioKCQkgKiBQZXJtYW5lbnQgcmVmIHRvIHRoZSB0aGVhZCBlbGVtZW50CgkJICogIEB0eXBlIG5vZGUKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJuVEhlYWQiOiBudWxsLAoJCQoJCS8qKgoJCSAqIFBlcm1hbmVudCByZWYgdG8gdGhlIHRmb290IGVsZW1lbnQgLSBpZiBpdCBleGlzdHMKCQkgKiAgQHR5cGUgbm9kZQoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJIm5URm9vdCI6IG51bGwsCgkJCgkJLyoqCgkJICogUGVybWFuZW50IHJlZiB0byB0aGUgdGJvZHkgZWxlbWVudAoJCSAqICBAdHlwZSBub2RlCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkiblRCb2R5IjogbnVsbCwKCQkKCQkvKioKCQkgKiBDYWNoZSB0aGUgd3JhcHBlciBub2RlIChjb250YWlucyBhbGwgRGF0YVRhYmxlcyBjb250cm9sbGVkIGVsZW1lbnRzKQoJCSAqICBAdHlwZSBub2RlCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkiblRhYmxlV3JhcHBlciI6IG51bGwsCgkJCgkJLyoqCgkJICogSW5kaWNhdGUgaWYgd2hlbiB1c2luZyBzZXJ2ZXItc2lkZSBwcm9jZXNzaW5nIHRoZSBsb2FkaW5nIG9mIGRhdGEgCgkJICogc2hvdWxkIGJlIGRlZmVycmVkIHVudGlsIHRoZSBzZWNvbmQgZHJhdy4KCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkgKi8KCQkiYkRlZmVyTG9hZGluZyI6IGZhbHNlLAoJCQoJCS8qKgoJCSAqIEluZGljYXRlIGlmIGFsbCByZXF1aXJlZCBpbmZvcm1hdGlvbiBoYXMgYmVlbiByZWFkIGluCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkgKi8KCQkiYkluaXRpYWxpc2VkIjogZmFsc2UsCgkJCgkJLyoqCgkJICogSW5mb3JtYXRpb24gYWJvdXQgb3BlbiByb3dzLiBFYWNoIG9iamVjdCBpbiB0aGUgYXJyYXkgaGFzIHRoZSBwYXJhbWV0ZXJzCgkJICogJ25UcicgYW5kICduUGFyZW50JwoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb09wZW5Sb3dzIjogW10sCgkJCgkJLyoqCgkJICogRGljdGF0ZSB0aGUgcG9zaXRpb25pbmcgb2YgRGF0YVRhYmxlcycgY29udHJvbCBlbGVtZW50cyAtIHNlZQoJCSAqIHtAbGluayBEYXRhVGFibGUubW9kZWwub0luaXQuc0RvbX0uCgkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKiAgQGRlZmF1bHQgbnVsbAoJCSAqLwoJCSJzRG9tIjogbnVsbCwKCQkKCQkvKioKCQkgKiBXaGljaCB0eXBlIG9mIHBhZ2luYXRpb24gc2hvdWxkIGJlIHVzZWQuCgkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCSAqICBAdHlwZSBzdHJpbmcgCgkJICogIEBkZWZhdWx0IHR3b19idXR0b24KCQkgKi8KCQkic1BhZ2luYXRpb25UeXBlIjogInR3b19idXR0b24iLAoJCQoJCS8qKgoJCSAqIFRoZSBjb29raWUgZHVyYXRpb24gKGZvciBiU3RhdGVTYXZlKSBpbiBzZWNvbmRzLgoJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkgKiAgQHR5cGUgaW50CgkJICogIEBkZWZhdWx0IDAKCQkgKi8KCQkiaUNvb2tpZUR1cmF0aW9uIjogMCwKCQkKCQkvKioKCQkgKiBUaGUgY29va2llIG5hbWUgcHJlZml4LgoJCSAqIE5vdGUgdGhhdCB0aGlzIHBhcmFtZXRlciB3aWxsIGJlIHNldCBieSB0aGUgaW5pdGlhbGlzYXRpb24gcm91dGluZS4gVG8KCQkgKiBzZXQgYSBkZWZhdWx0IHVzZSB7QGxpbmsgRGF0YVRhYmxlLmRlZmF1bHRzfS4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IDxpPkVtcHR5IHN0cmluZzwvaT4KCQkgKi8KCQkic0Nvb2tpZVByZWZpeCI6ICIiLAoJCQoJCS8qKgoJCSAqIENhbGxiYWNrIGZ1bmN0aW9uIGZvciBjb29raWUgY3JlYXRpb24uCgkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJImZuQ29va2llQ2FsbGJhY2siOiBudWxsLAoJCQoJCS8qKgoJCSAqIEFycmF5IG9mIGNhbGxiYWNrIGZ1bmN0aW9ucyBmb3Igc3RhdGUgc2F2aW5nLiBFYWNoIGFycmF5IGVsZW1lbnQgaXMgYW4gCgkJICogb2JqZWN0IHdpdGggdGhlIGZvbGxvd2luZyBwYXJhbWV0ZXJzOgoJCSAqICAgPHVsPgoJCSAqICAgICA8bGk+ZnVuY3Rpb246Zm4gLSBmdW5jdGlvbiB0byBjYWxsLiBUYWtlcyB0d28gcGFyYW1ldGVycywgb1NldHRpbmdzCgkJICogICAgICAgYW5kIHRoZSBKU09OIHN0cmluZyB0byBzYXZlIHRoYXQgaGFzIGJlZW4gdGh1cyBmYXIgY3JlYXRlZC4gUmV0dXJucwoJCSAqICAgICAgIGEgSlNPTiBzdHJpbmcgdG8gYmUgaW5zZXJ0ZWQgaW50byBhIGpzb24gb2JqZWN0IAoJCSAqICAgICAgIChpLmUuICcicGFyYW0iOiBbIDAsIDEsIDJdJyk8L2xpPgoJCSAqICAgICA8bGk+c3RyaW5nOnNOYW1lIC0gbmFtZSBvZiBjYWxsYmFjazwvbGk+CgkJICogICA8L3VsPgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb1N0YXRlU2F2ZSI6IFtdLAoJCQoJCS8qKgoJCSAqIEFycmF5IG9mIGNhbGxiYWNrIGZ1bmN0aW9ucyBmb3Igc3RhdGUgbG9hZGluZy4gRWFjaCBhcnJheSBlbGVtZW50IGlzIGFuIAoJCSAqIG9iamVjdCB3aXRoIHRoZSBmb2xsb3dpbmcgcGFyYW1ldGVyczoKCQkgKiAgIDx1bD4KCQkgKiAgICAgPGxpPmZ1bmN0aW9uOmZuIC0gZnVuY3Rpb24gdG8gY2FsbC4gVGFrZXMgdHdvIHBhcmFtZXRlcnMsIG9TZXR0aW5ncyAKCQkgKiAgICAgICBhbmQgdGhlIG9iamVjdCBzdG9yZWQuIE1heSByZXR1cm4gZmFsc2UgdG8gY2FuY2VsIHN0YXRlIGxvYWRpbmc8L2xpPgoJCSAqICAgICA8bGk+c3RyaW5nOnNOYW1lIC0gbmFtZSBvZiBjYWxsYmFjazwvbGk+CgkJICogICA8L3VsPgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb1N0YXRlTG9hZCI6IFtdLAoJCQoJCS8qKgoJCSAqIFN0YXRlIHRoYXQgd2FzIGxvYWRlZCBmcm9tIHRoZSBjb29raWUuIFVzZWZ1bCBmb3IgYmFjayByZWZlcmVuY2UKCQkgKiAgQHR5cGUgb2JqZWN0CgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkib0xvYWRlZFN0YXRlIjogbnVsbCwKCQkKCQkvKioKCQkgKiBTb3VyY2UgdXJsIGZvciBBSkFYIGRhdGEgZm9yIHRoZSB0YWJsZS4KCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJICogIEB0eXBlIHN0cmluZwoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJInNBamF4U291cmNlIjogbnVsbCwKCQkKCQkvKioKCQkgKiBQcm9wZXJ0eSBmcm9tIGEgZ2l2ZW4gb2JqZWN0IGZyb20gd2hpY2ggdG8gcmVhZCB0aGUgdGFibGUgZGF0YSBmcm9tLiBUaGlzCgkJICogY2FuIGJlIGFuIGVtcHR5IHN0cmluZyAod2hlbiBub3Qgc2VydmVyLXNpZGUgcHJvY2Vzc2luZyksIGluIHdoaWNoIGNhc2UgCgkJICogaXQgaXMgIGFzc3VtZWQgYW4gYW4gYXJyYXkgaXMgZ2l2ZW4gZGlyZWN0bHkuCgkJICogTm90ZSB0aGF0IHRoaXMgcGFyYW1ldGVyIHdpbGwgYmUgc2V0IGJ5IHRoZSBpbml0aWFsaXNhdGlvbiByb3V0aW5lLiBUbwoJCSAqIHNldCBhIGRlZmF1bHQgdXNlIHtAbGluayBEYXRhVGFibGUuZGVmYXVsdHN9LgoJCSAqICBAdHlwZSBzdHJpbmcKCQkgKi8KCQkic0FqYXhEYXRhUHJvcCI6IG51bGwsCgkJCgkJLyoqCgkJICogTm90ZSBpZiBkcmF3IHNob3VsZCBiZSBibG9ja2VkIHdoaWxlIGdldHRpbmcgZGF0YQoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IHRydWUKCQkgKi8KCQkiYkFqYXhEYXRhR2V0IjogdHJ1ZSwKCQkKCQkvKioKCQkgKiBUaGUgbGFzdCBqUXVlcnkgWEhSIG9iamVjdCB0aGF0IHdhcyB1c2VkIGZvciBzZXJ2ZXItc2lkZSBkYXRhIGdhdGhlcmluZy4gCgkJICogVGhpcyBjYW4gYmUgdXNlZCBmb3Igd29ya2luZyB3aXRoIHRoZSBYSFIgaW5mb3JtYXRpb24gaW4gb25lIG9mIHRoZSAKCQkgKiBjYWxsYmFja3MKCQkgKiAgQHR5cGUgb2JqZWN0CgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkianFYSFIiOiBudWxsLAoJCQoJCS8qKgoJCSAqIEZ1bmN0aW9uIHRvIGdldCB0aGUgc2VydmVyLXNpZGUgZGF0YS4KCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICovCgkJImZuU2VydmVyRGF0YSI6IG51bGwsCgkJCgkJLyoqCgkJICogRnVuY3Rpb25zIHdoaWNoIGFyZSBjYWxsZWQgcHJpb3IgdG8gc2VuZGluZyBhbiBBamF4IHJlcXVlc3Qgc28gZXh0cmEgCgkJICogcGFyYW1ldGVycyBjYW4gZWFzaWx5IGJlIHNlbnQgdG8gdGhlIHNlcnZlcgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb1NlcnZlclBhcmFtcyI6IFtdLAoJCQoJCS8qKgoJCSAqIFNlbmQgdGhlIFhIUiBIVFRQIG1ldGhvZCAtIEdFVCBvciBQT1NUIChjb3VsZCBiZSBQVVQgb3IgREVMRVRFIGlmIAoJCSAqIHJlcXVpcmVkKS4KCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJICogIEB0eXBlIHN0cmluZwoJCSAqLwoJCSJzU2VydmVyTWV0aG9kIjogbnVsbCwKCQkKCQkvKioKCQkgKiBGb3JtYXQgbnVtYmVycyBmb3IgZGlzcGxheS4KCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICovCgkJImZuRm9ybWF0TnVtYmVyIjogbnVsbCwKCQkKCQkvKioKCQkgKiBMaXN0IG9mIG9wdGlvbnMgdGhhdCBjYW4gYmUgdXNlZCBmb3IgdGhlIHVzZXIgc2VsZWN0YWJsZSBsZW5ndGggbWVudS4KCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJICogIEB0eXBlIGFycmF5CgkJICogIEBkZWZhdWx0IFtdCgkJICovCgkJImFMZW5ndGhNZW51IjogbnVsbCwKCQkKCQkvKioKCQkgKiBDb3VudGVyIGZvciB0aGUgZHJhd3MgdGhhdCB0aGUgdGFibGUgZG9lcy4gQWxzbyB1c2VkIGFzIGEgdHJhY2tlciBmb3IKCQkgKiBzZXJ2ZXItc2lkZSBwcm9jZXNzaW5nCgkJICogIEB0eXBlIGludAoJCSAqICBAZGVmYXVsdCAwCgkJICovCgkJImlEcmF3IjogMCwKCQkKCQkvKioKCQkgKiBJbmRpY2F0ZSBpZiBhIHJlZHJhdyBpcyBiZWluZyBkb25lIC0gdXNlZnVsIGZvciBBamF4CgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkgKi8KCQkiYkRyYXdpbmciOiBmYWxzZSwKCQkKCQkvKioKCQkgKiBEcmF3IGluZGV4IChpRHJhdykgb2YgdGhlIGxhc3QgZXJyb3Igd2hlbiBwYXJzaW5nIHRoZSByZXR1cm5lZCBkYXRhCgkJICogIEB0eXBlIGludAoJCSAqICBAZGVmYXVsdCAtMQoJCSAqLwoJCSJpRHJhd0Vycm9yIjogLTEsCgkJCgkJLyoqCgkJICogUGFnaW5nIGRpc3BsYXkgbGVuZ3RoCgkJICogIEB0eXBlIGludAoJCSAqICBAZGVmYXVsdCAxMAoJCSAqLwoJCSJfaURpc3BsYXlMZW5ndGgiOiAxMCwKCQoJCS8qKgoJCSAqIFBhZ2luZyBzdGFydCBwb2ludCAtIGFpRGlzcGxheSBpbmRleAoJCSAqICBAdHlwZSBpbnQKCQkgKiAgQGRlZmF1bHQgMAoJCSAqLwoJCSJfaURpc3BsYXlTdGFydCI6IDAsCgkKCQkvKioKCQkgKiBQYWdpbmcgZW5kIHBvaW50IC0gYWlEaXNwbGF5IGluZGV4LiBVc2UgZm5EaXNwbGF5RW5kIHJhdGhlciB0aGFuCgkJICogdGhpcyBwcm9wZXJ0eSB0byBnZXQgdGhlIGVuZCBwb2ludAoJCSAqICBAdHlwZSBpbnQKCQkgKiAgQGRlZmF1bHQgMTAKCQkgKiAgQHByaXZhdGUKCQkgKi8KCQkiX2lEaXNwbGF5RW5kIjogMTAsCgkJCgkJLyoqCgkJICogU2VydmVyLXNpZGUgcHJvY2Vzc2luZyAtIG51bWJlciBvZiByZWNvcmRzIGluIHRoZSByZXN1bHQgc2V0CgkJICogKGkuZS4gYmVmb3JlIGZpbHRlcmluZyksIFVzZSBmblJlY29yZHNUb3RhbCByYXRoZXIgdGhhbgoJCSAqIHRoaXMgcHJvcGVydHkgdG8gZ2V0IHRoZSB2YWx1ZSBvZiB0aGUgbnVtYmVyIG9mIHJlY29yZHMsIHJlZ2FyZGxlc3Mgb2YKCQkgKiB0aGUgc2VydmVyLXNpZGUgcHJvY2Vzc2luZyBzZXR0aW5nLgoJCSAqICBAdHlwZSBpbnQKCQkgKiAgQGRlZmF1bHQgMAoJCSAqICBAcHJpdmF0ZQoJCSAqLwoJCSJfaVJlY29yZHNUb3RhbCI6IDAsCgkKCQkvKioKCQkgKiBTZXJ2ZXItc2lkZSBwcm9jZXNzaW5nIC0gbnVtYmVyIG9mIHJlY29yZHMgaW4gdGhlIGN1cnJlbnQgZGlzcGxheSBzZXQKCQkgKiAoaS5lLiBhZnRlciBmaWx0ZXJpbmcpLiBVc2UgZm5SZWNvcmRzRGlzcGxheSByYXRoZXIgdGhhbgoJCSAqIHRoaXMgcHJvcGVydHkgdG8gZ2V0IHRoZSB2YWx1ZSBvZiB0aGUgbnVtYmVyIG9mIHJlY29yZHMsIHJlZ2FyZGxlc3Mgb2YKCQkgKiB0aGUgc2VydmVyLXNpZGUgcHJvY2Vzc2luZyBzZXR0aW5nLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IDAKCQkgKiAgQHByaXZhdGUKCQkgKi8KCQkiX2lSZWNvcmRzRGlzcGxheSI6IDAsCgkJCgkJLyoqCgkJICogRmxhZyB0byBpbmRpY2F0ZSBpZiBqUXVlcnkgVUkgbWFya2luZyBhbmQgY2xhc3NlcyBzaG91bGQgYmUgdXNlZC4KCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKi8KCQkiYkpVSSI6IG51bGwsCgkJCgkJLyoqCgkJICogVGhlIGNsYXNzZXMgdG8gdXNlIGZvciB0aGUgdGFibGUKCQkgKiAgQHR5cGUgb2JqZWN0CgkJICogIEBkZWZhdWx0IHt9CgkJICovCgkJIm9DbGFzc2VzIjoge30sCgkJCgkJLyoqCgkJICogRmxhZyBhdHRhY2hlZCB0byB0aGUgc2V0dGluZ3Mgb2JqZWN0IHNvIHlvdSBjYW4gY2hlY2sgaW4gdGhlIGRyYXcgCgkJICogY2FsbGJhY2sgaWYgZmlsdGVyaW5nIGhhcyBiZWVuIGRvbmUgaW4gdGhlIGRyYXcuIERlcHJlY2F0ZWQgaW4gZmF2b3VyIG9mCgkJICogZXZlbnRzLgoJCSAqICBAdHlwZSBib29sZWFuCgkJICogIEBkZWZhdWx0IGZhbHNlCgkJICogIEBkZXByZWNhdGVkCgkJICovCgkJImJGaWx0ZXJlZCI6IGZhbHNlLAoJCQoJCS8qKgoJCSAqIEZsYWcgYXR0YWNoZWQgdG8gdGhlIHNldHRpbmdzIG9iamVjdCBzbyB5b3UgY2FuIGNoZWNrIGluIHRoZSBkcmF3IAoJCSAqIGNhbGxiYWNrIGlmIHNvcnRpbmcgaGFzIGJlZW4gZG9uZSBpbiB0aGUgZHJhdy4gRGVwcmVjYXRlZCBpbiBmYXZvdXIgb2YKCQkgKiBldmVudHMuCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKiAgQGRlZmF1bHQgZmFsc2UKCQkgKiAgQGRlcHJlY2F0ZWQKCQkgKi8KCQkiYlNvcnRlZCI6IGZhbHNlLAoJCQoJCS8qKgoJCSAqIEluZGljYXRlIHRoYXQgaWYgbXVsdGlwbGUgcm93cyBhcmUgaW4gdGhlIGhlYWRlciBhbmQgdGhlcmUgaXMgbW9yZSB0aGFuIAoJCSAqIG9uZSB1bmlxdWUgY2VsbCBwZXIgY29sdW1uLCBpZiB0aGUgdG9wIG9uZSAodHJ1ZSkgb3IgYm90dG9tIG9uZSAoZmFsc2UpIAoJCSAqIHNob3VsZCBiZSB1c2VkIGZvciBzb3J0aW5nIC8gdGl0bGUgYnkgRGF0YVRhYmxlcy4KCQkgKiBOb3RlIHRoYXQgdGhpcyBwYXJhbWV0ZXIgd2lsbCBiZSBzZXQgYnkgdGhlIGluaXRpYWxpc2F0aW9uIHJvdXRpbmUuIFRvCgkJICogc2V0IGEgZGVmYXVsdCB1c2Uge0BsaW5rIERhdGFUYWJsZS5kZWZhdWx0c30uCgkJICogIEB0eXBlIGJvb2xlYW4KCQkgKi8KCQkiYlNvcnRDZWxsc1RvcCI6IG51bGwsCgkJCgkJLyoqCgkJICogSW5pdGlhbGlzYXRpb24gb2JqZWN0IHRoYXQgaXMgdXNlZCBmb3IgdGhlIHRhYmxlCgkJICogIEB0eXBlIG9iamVjdAoJCSAqICBAZGVmYXVsdCBudWxsCgkJICovCgkJIm9Jbml0IjogbnVsbCwKCQkKCQkvKioKCQkgKiBEZXN0cm95IGNhbGxiYWNrIGZ1bmN0aW9ucyAtIGZvciBwbHVnLWlucyB0byBhdHRhY2ggdGhlbXNlbHZlcyB0byB0aGUKCQkgKiBkZXN0cm95IHNvIHRoZXkgY2FuIGNsZWFuIHVwIG1hcmt1cCBhbmQgZXZlbnRzLgoJCSAqICBAdHlwZSBhcnJheQoJCSAqICBAZGVmYXVsdCBbXQoJCSAqLwoJCSJhb0Rlc3Ryb3lDYWxsYmFjayI6IFtdLAoJCgkJCgkJLyoqCgkJICogR2V0IHRoZSBudW1iZXIgb2YgcmVjb3JkcyBpbiB0aGUgY3VycmVudCByZWNvcmQgc2V0LCBiZWZvcmUgZmlsdGVyaW5nCgkJICogIEB0eXBlIGZ1bmN0aW9uCgkJICovCgkJImZuUmVjb3Jkc1RvdGFsIjogZnVuY3Rpb24gKCkKCQl7CgkJCWlmICggdGhpcy5vRmVhdHVyZXMuYlNlcnZlclNpZGUgKSB7CgkJCQlyZXR1cm4gcGFyc2VJbnQodGhpcy5faVJlY29yZHNUb3RhbCwgMTApOwoJCQl9IGVsc2UgewoJCQkJcmV0dXJuIHRoaXMuYWlEaXNwbGF5TWFzdGVyLmxlbmd0aDsKCQkJfQoJCX0sCgkJCgkJLyoqCgkJICogR2V0IHRoZSBudW1iZXIgb2YgcmVjb3JkcyBpbiB0aGUgY3VycmVudCByZWNvcmQgc2V0LCBhZnRlciBmaWx0ZXJpbmcKCQkgKiAgQHR5cGUgZnVuY3Rpb24KCQkgKi8KCQkiZm5SZWNvcmRzRGlzcGxheSI6IGZ1bmN0aW9uICgpCgkJewoJCQlpZiAoIHRoaXMub0ZlYXR1cmVzLmJTZXJ2ZXJTaWRlICkgewoJCQkJcmV0dXJuIHBhcnNlSW50KHRoaXMuX2lSZWNvcmRzRGlzcGxheSwgMTApOwoJCQl9IGVsc2UgewoJCQkJcmV0dXJuIHRoaXMuYWlEaXNwbGF5Lmxlbmd0aDsKCQkJfQoJCX0sCgkJCgkJLyoqCgkJICogU2V0IHRoZSBkaXNwbGF5IGVuZCBwb2ludCAtIGFpRGlzcGxheSBpbmRleAoJCSAqICBAdHlwZSBmdW5jdGlvbgoJCSAqICBAdG9kbyBTaG91bGQgZG8gYXdheSB3aXRoIF9pRGlzcGxheUVuZCBhbmQgY2FsY3VsYXRlIGl0IG9uLXRoZS1mbHkgaGVyZQoJCSAqLwoJCSJmbkRpc3BsYXlFbmQiOiBmdW5jdGlvbiAoKQoJCXsKCQkJaWYgKCB0aGlzLm9GZWF0dXJlcy5iU2VydmVyU2lkZSApIHsKCQkJCWlmICggdGhpcy5vRmVhdHVyZXMuYlBhZ2luYXRlID09PSBmYWxzZSB8fCB0aGlzLl9pRGlzcGxheUxlbmd0aCA9PSAtMSApIHsKCQkJCQlyZXR1cm4gdGhpcy5faURpc3BsYXlTdGFydCt0aGlzLmFpRGlzcGxheS5sZW5ndGg7CgkJCQl9IGVsc2UgewoJCQkJCXJldHVybiBNYXRoLm1pbiggdGhpcy5faURpc3BsYXlTdGFydCt0aGlzLl9pRGlzcGxheUxlbmd0aCwgCgkJCQkJCXRoaXMuX2lSZWNvcmRzRGlzcGxheSApOwoJCQkJfQoJCQl9IGVsc2UgewoJCQkJcmV0dXJuIHRoaXMuX2lEaXNwbGF5RW5kOwoJCQl9CgkJfSwKCQkKCQkvKioKCQkgKiBUaGUgRGF0YVRhYmxlcyBvYmplY3QgZm9yIHRoaXMgdGFibGUKCQkgKiAgQHR5cGUgb2JqZWN0CgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkib0luc3RhbmNlIjogbnVsbCwKCQkKCQkvKioKCQkgKiBVbmlxdWUgaWRlbnRpZmllciBmb3IgZWFjaCBpbnN0YW5jZSBvZiB0aGUgRGF0YVRhYmxlcyBvYmplY3QuIElmIHRoZXJlCgkJICogaXMgYW4gSUQgb24gdGhlIHRhYmxlIG5vZGUsIHRoZW4gaXQgdGFrZXMgdGhhdCB2YWx1ZSwgb3RoZXJ3aXNlIGFuCgkJICogaW5jcmVtZW50aW5nIGludGVybmFsIGNvdW50ZXIgaXMgdXNlZC4KCQkgKiAgQHR5cGUgc3RyaW5nCgkJICogIEBkZWZhdWx0IG51bGwKCQkgKi8KCQkic0luc3RhbmNlIjogbnVsbCwKCQoJCS8qKgoJCSAqIHRhYmluZGV4IGF0dHJpYnV0ZSB2YWx1ZSB0aGF0IGlzIGFkZGVkIHRvIERhdGFUYWJsZXMgY29udHJvbCBlbGVtZW50cywgYWxsb3dpbmcKCQkgKiBrZXlib2FyZCBuYXZpZ2F0aW9uIG9mIHRoZSB0YWJsZSBhbmQgaXRzIGNvbnRyb2xzLgoJCSAqLwoJCSJpVGFiSW5kZXgiOiAwLAoJCgkJLyoqCgkJICogRElWIGNvbnRhaW5lciBmb3IgdGhlIGZvb3RlciBzY3JvbGxpbmcgdGFibGUgaWYgc2Nyb2xsaW5nCgkJICovCgkJIm5TY3JvbGxIZWFkIjogbnVsbCwKCQoJCS8qKgoJCSAqIERJViBjb250YWluZXIgZm9yIHRoZSBmb290ZXIgc2Nyb2xsaW5nIHRhYmxlIGlmIHNjcm9sbGluZwoJCSAqLwoJCSJuU2Nyb2xsRm9vdCI6IG51bGwKCX07CgoJLyoqCgkgKiBFeHRlbnNpb24gb2JqZWN0IGZvciBEYXRhVGFibGVzIHRoYXQgaXMgdXNlZCB0byBwcm92aWRlIGFsbCBleHRlbnNpb24gb3B0aW9ucy4KCSAqIAoJICogTm90ZSB0aGF0IHRoZSA8aT5EYXRhVGFibGUuZXh0PC9pPiBvYmplY3QgaXMgYXZhaWxhYmxlIHRocm91Z2gKCSAqIDxpPmpRdWVyeS5mbi5kYXRhVGFibGUuZXh0PC9pPiB3aGVyZSBpdCBtYXkgYmUgYWNjZXNzZWQgYW5kIG1hbmlwdWxhdGVkLiBJdCBpcwoJICogYWxzbyBhbGlhc2VkIHRvIDxpPmpRdWVyeS5mbi5kYXRhVGFibGVFeHQ8L2k+IGZvciBoaXN0b3JpYyByZWFzb25zLgoJICogIEBuYW1lc3BhY2UKCSAqICBAZXh0ZW5kcyBEYXRhVGFibGUubW9kZWxzLmV4dAoJICovCglEYXRhVGFibGUuZXh0ID0gJC5leHRlbmQoIHRydWUsIHt9LCBEYXRhVGFibGUubW9kZWxzLmV4dCApOwoJCgkkLmV4dGVuZCggRGF0YVRhYmxlLmV4dC5vU3RkQ2xhc3NlcywgewoJCSJzVGFibGUiOiAiZGF0YVRhYmxlIiwKCQoJCS8qIFR3byBidXR0b25zIGJ1dHRvbnMgKi8KCQkic1BhZ2VQcmV2RW5hYmxlZCI6ICJwYWdpbmF0ZV9lbmFibGVkX3ByZXZpb3VzIiwKCQkic1BhZ2VQcmV2RGlzYWJsZWQiOiAicGFnaW5hdGVfZGlzYWJsZWRfcHJldmlvdXMiLAoJCSJzUGFnZU5leHRFbmFibGVkIjogInBhZ2luYXRlX2VuYWJsZWRfbmV4dCIsCgkJInNQYWdlTmV4dERpc2FibGVkIjogInBhZ2luYXRlX2Rpc2FibGVkX25leHQiLAoJCSJzUGFnZUpVSU5leHQiOiAiIiwKCQkic1BhZ2VKVUlQcmV2IjogIiIsCgkJCgkJLyogRnVsbCBudW1iZXJzIHBhZ2luZyBidXR0b25zICovCgkJInNQYWdlQnV0dG9uIjogInBhZ2luYXRlX2J1dHRvbiIsCgkJInNQYWdlQnV0dG9uQWN0aXZlIjogInBhZ2luYXRlX2FjdGl2ZSIsCgkJInNQYWdlQnV0dG9uU3RhdGljRGlzYWJsZWQiOiAicGFnaW5hdGVfYnV0dG9uIHBhZ2luYXRlX2J1dHRvbl9kaXNhYmxlZCIsCgkJInNQYWdlRmlyc3QiOiAiZmlyc3QiLAoJCSJzUGFnZVByZXZpb3VzIjogInByZXZpb3VzIiwKCQkic1BhZ2VOZXh0IjogIm5leHQiLAoJCSJzUGFnZUxhc3QiOiAibGFzdCIsCgkJCgkJLyogU3RyaXBpbmcgY2xhc3NlcyAqLwoJCSJzU3RyaXBlT2RkIjogIm9kZCIsCgkJInNTdHJpcGVFdmVuIjogImV2ZW4iLAoJCQoJCS8qIEVtcHR5IHJvdyAqLwoJCSJzUm93RW1wdHkiOiAiZGF0YVRhYmxlc19lbXB0eSIsCgkJCgkJLyogRmVhdHVyZXMgKi8KCQkic1dyYXBwZXIiOiAiZGF0YVRhYmxlc193cmFwcGVyIiwKCQkic0ZpbHRlciI6ICJkYXRhVGFibGVzX2ZpbHRlciIsCgkJInNJbmZvIjogImRhdGFUYWJsZXNfaW5mbyIsCgkJInNQYWdpbmciOiAiZGF0YVRhYmxlc19wYWdpbmF0ZSBwYWdpbmdfIiwgLyogTm90ZSB0aGF0IHRoZSB0eXBlIGlzIHBvc3RmaXhlZCAqLwoJCSJzTGVuZ3RoIjogImRhdGFUYWJsZXNfbGVuZ3RoIiwKCQkic1Byb2Nlc3NpbmciOiAiZGF0YVRhYmxlc19wcm9jZXNzaW5nIiwKCQkKCQkvKiBTb3J0aW5nICovCgkJInNTb3J0QXNjIjogInNvcnRpbmdfYXNjIiwKCQkic1NvcnREZXNjIjogInNvcnRpbmdfZGVzYyIsCgkJInNTb3J0YWJsZSI6ICJzb3J0aW5nIiwgLyogU29ydGFibGUgaW4gYm90aCBkaXJlY3Rpb25zICovCgkJInNTb3J0YWJsZUFzYyI6ICJzb3J0aW5nX2FzY19kaXNhYmxlZCIsCgkJInNTb3J0YWJsZURlc2MiOiAic29ydGluZ19kZXNjX2Rpc2FibGVkIiwKCQkic1NvcnRhYmxlTm9uZSI6ICJzb3J0aW5nX2Rpc2FibGVkIiwKCQkic1NvcnRDb2x1bW4iOiAic29ydGluZ18iLCAvKiBOb3RlIHRoYXQgYW4gaW50IGlzIHBvc3RmaXhlZCBmb3IgdGhlIHNvcnRpbmcgb3JkZXIgKi8KCQkic1NvcnRKVUlBc2MiOiAiIiwKCQkic1NvcnRKVUlEZXNjIjogIiIsCgkJInNTb3J0SlVJIjogIiIsCgkJInNTb3J0SlVJQXNjQWxsb3dlZCI6ICIiLAoJCSJzU29ydEpVSURlc2NBbGxvd2VkIjogIiIsCgkJInNTb3J0SlVJV3JhcHBlciI6ICIiLAoJCSJzU29ydEljb24iOiAiIiwKCQkKCQkvKiBTY3JvbGxpbmcgKi8KCQkic1Njcm9sbFdyYXBwZXIiOiAiZGF0YVRhYmxlc19zY3JvbGwiLAoJCSJzU2Nyb2xsSGVhZCI6ICJkYXRhVGFibGVzX3Njcm9sbEhlYWQiLAoJCSJzU2Nyb2xsSGVhZElubmVyIjogImRhdGFUYWJsZXNfc2Nyb2xsSGVhZElubmVyIiwKCQkic1Njcm9sbEJvZHkiOiAiZGF0YVRhYmxlc19zY3JvbGxCb2R5IiwKCQkic1Njcm9sbEZvb3QiOiAiZGF0YVRhYmxlc19zY3JvbGxGb290IiwKCQkic1Njcm9sbEZvb3RJbm5lciI6ICJkYXRhVGFibGVzX3Njcm9sbEZvb3RJbm5lciIsCgkJCgkJLyogTWlzYyAqLwoJCSJzRm9vdGVyVEgiOiAiIiwKCQkic0pVSUhlYWRlciI6ICIiLAoJCSJzSlVJRm9vdGVyIjogIiIKCX0gKTsKCQoJCgkkLmV4dGVuZCggRGF0YVRhYmxlLmV4dC5vSlVJQ2xhc3NlcywgRGF0YVRhYmxlLmV4dC5vU3RkQ2xhc3NlcywgewoJCS8qIFR3byBidXR0b25zIGJ1dHRvbnMgKi8KCQkic1BhZ2VQcmV2RW5hYmxlZCI6ICJmZy1idXR0b24gdWktYnV0dG9uIHVpLXN0YXRlLWRlZmF1bHQgdWktY29ybmVyLWxlZnQiLAoJCSJzUGFnZVByZXZEaXNhYmxlZCI6ICJmZy1idXR0b24gdWktYnV0dG9uIHVpLXN0YXRlLWRlZmF1bHQgdWktY29ybmVyLWxlZnQgdWktc3RhdGUtZGlzYWJsZWQiLAoJCSJzUGFnZU5leHRFbmFibGVkIjogImZnLWJ1dHRvbiB1aS1idXR0b24gdWktc3RhdGUtZGVmYXVsdCB1aS1jb3JuZXItcmlnaHQiLAoJCSJzUGFnZU5leHREaXNhYmxlZCI6ICJmZy1idXR0b24gdWktYnV0dG9uIHVpLXN0YXRlLWRlZmF1bHQgdWktY29ybmVyLXJpZ2h0IHVpLXN0YXRlLWRpc2FibGVkIiwKCQkic1BhZ2VKVUlOZXh0IjogInVpLWljb24gdWktaWNvbi1jaXJjbGUtYXJyb3ctZSIsCgkJInNQYWdlSlVJUHJldiI6ICJ1aS1pY29uIHVpLWljb24tY2lyY2xlLWFycm93LXciLAoJCQoJCS8qIEZ1bGwgbnVtYmVycyBwYWdpbmcgYnV0dG9ucyAqLwoJCSJzUGFnZUJ1dHRvbiI6ICJmZy1idXR0b24gdWktYnV0dG9uIHVpLXN0YXRlLWRlZmF1bHQiLAoJCSJzUGFnZUJ1dHRvbkFjdGl2ZSI6ICJmZy1idXR0b24gdWktYnV0dG9uIHVpLXN0YXRlLWRlZmF1bHQgdWktc3RhdGUtZGlzYWJsZWQiLAoJCSJzUGFnZUJ1dHRvblN0YXRpY0Rpc2FibGVkIjogImZnLWJ1dHRvbiB1aS1idXR0b24gdWktc3RhdGUtZGVmYXVsdCB1aS1zdGF0ZS1kaXNhYmxlZCIsCgkJInNQYWdlRmlyc3QiOiAiZmlyc3QgdWktY29ybmVyLXRsIHVpLWNvcm5lci1ibCIsCgkJInNQYWdlTGFzdCI6ICJsYXN0IHVpLWNvcm5lci10ciB1aS1jb3JuZXItYnIiLAoJCQoJCS8qIEZlYXR1cmVzICovCgkJInNQYWdpbmciOiAiZGF0YVRhYmxlc19wYWdpbmF0ZSBmZy1idXR0b25zZXQgdWktYnV0dG9uc2V0IGZnLWJ1dHRvbnNldC1tdWx0aSAiKwoJCQkidWktYnV0dG9uc2V0LW11bHRpIHBhZ2luZ18iLCAvKiBOb3RlIHRoYXQgdGhlIHR5cGUgaXMgcG9zdGZpeGVkICovCgkJCgkJLyogU29ydGluZyAqLwoJCSJzU29ydEFzYyI6ICJ1aS1zdGF0ZS1kZWZhdWx0IiwKCQkic1NvcnREZXNjIjogInVpLXN0YXRlLWRlZmF1bHQiLAoJCSJzU29ydGFibGUiOiAidWktc3RhdGUtZGVmYXVsdCIsCgkJInNTb3J0YWJsZUFzYyI6ICJ1aS1zdGF0ZS1kZWZhdWx0IiwKCQkic1NvcnRhYmxlRGVzYyI6ICJ1aS1zdGF0ZS1kZWZhdWx0IiwKCQkic1NvcnRhYmxlTm9uZSI6ICJ1aS1zdGF0ZS1kZWZhdWx0IiwKCQkic1NvcnRKVUlBc2MiOiAiY3NzX3JpZ2h0IHVpLWljb24gdWktaWNvbi10cmlhbmdsZS0xLW4iLAoJCSJzU29ydEpVSURlc2MiOiAiY3NzX3JpZ2h0IHVpLWljb24gdWktaWNvbi10cmlhbmdsZS0xLXMiLAoJCSJzU29ydEpVSSI6ICJjc3NfcmlnaHQgdWktaWNvbiB1aS1pY29uLWNhcmF0LTItbi1zIiwKCQkic1NvcnRKVUlBc2NBbGxvd2VkIjogImNzc19yaWdodCB1aS1pY29uIHVpLWljb24tY2FyYXQtMS1uIiwKCQkic1NvcnRKVUlEZXNjQWxsb3dlZCI6ICJjc3NfcmlnaHQgdWktaWNvbiB1aS1pY29uLWNhcmF0LTEtcyIsCgkJInNTb3J0SlVJV3JhcHBlciI6ICJEYXRhVGFibGVzX3NvcnRfd3JhcHBlciIsCgkJInNTb3J0SWNvbiI6ICJEYXRhVGFibGVzX3NvcnRfaWNvbiIsCgkJCgkJLyogU2Nyb2xsaW5nICovCgkJInNTY3JvbGxIZWFkIjogImRhdGFUYWJsZXNfc2Nyb2xsSGVhZCB1aS1zdGF0ZS1kZWZhdWx0IiwKCQkic1Njcm9sbEZvb3QiOiAiZGF0YVRhYmxlc19zY3JvbGxGb290IHVpLXN0YXRlLWRlZmF1bHQiLAoJCQoJCS8qIE1pc2MgKi8KCQkic0Zvb3RlclRIIjogInVpLXN0YXRlLWRlZmF1bHQiLAoJCSJzSlVJSGVhZGVyIjogImZnLXRvb2xiYXIgdWktdG9vbGJhciB1aS13aWRnZXQtaGVhZGVyIHVpLWNvcm5lci10bCB1aS1jb3JuZXItdHIgdWktaGVscGVyLWNsZWFyZml4IiwKCQkic0pVSUZvb3RlciI6ICJmZy10b29sYmFyIHVpLXRvb2xiYXIgdWktd2lkZ2V0LWhlYWRlciB1aS1jb3JuZXItYmwgdWktY29ybmVyLWJyIHVpLWhlbHBlci1jbGVhcmZpeCIKCX0gKTsKCQoJCgkvKgoJICogVmFyaWFibGU6IG9QYWdpbmF0aW9uCgkgKiBQdXJwb3NlOiAgCgkgKiBTY29wZTogICAgalF1ZXJ5LmZuLmRhdGFUYWJsZUV4dAoJICovCgkkLmV4dGVuZCggRGF0YVRhYmxlLmV4dC5vUGFnaW5hdGlvbiwgewoJCS8qCgkJICogVmFyaWFibGU6IHR3b19idXR0b24KCQkgKiBQdXJwb3NlOiAgU3RhbmRhcmQgdHdvIGJ1dHRvbiAoZm9yd2FyZC9iYWNrKSBwYWdpbmF0aW9uCgkJICogU2NvcGU6ICAgIGpRdWVyeS5mbi5kYXRhVGFibGVFeHQub1BhZ2luYXRpb24KCQkgKi8KCQkidHdvX2J1dHRvbiI6IHsKCQkJLyoKCQkJICogRnVuY3Rpb246IG9QYWdpbmF0aW9uLnR3b19idXR0b24uZm5Jbml0CgkJCSAqIFB1cnBvc2U6ICBJbml0aWFsaXNlIGRvbSBlbGVtZW50cyByZXF1aXJlZCBmb3IgcGFnaW5hdGlvbiB3aXRoIGZvcndhcmQvYmFjayBidXR0b25zIG9ubHkKCQkJICogUmV0dXJuczogIC0KCQkJICogSW5wdXRzOiAgIG9iamVjdDpvU2V0dGluZ3MgLSBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCQkgKiAgICAgICAgICAgbm9kZTpuUGFnaW5nIC0gdGhlIERJViB3aGljaCBjb250YWlucyB0aGlzIHBhZ2luYXRpb24gY29udHJvbAoJCQkgKiAgICAgICAgICAgZnVuY3Rpb246Zm5DYWxsYmFja0RyYXcgLSBkcmF3IGZ1bmN0aW9uIHdoaWNoIG11c3QgYmUgY2FsbGVkIG9uIHVwZGF0ZQoJCQkgKi8KCQkJImZuSW5pdCI6IGZ1bmN0aW9uICggb1NldHRpbmdzLCBuUGFnaW5nLCBmbkNhbGxiYWNrRHJhdyApCgkJCXsKCQkJCXZhciBvTGFuZyA9IG9TZXR0aW5ncy5vTGFuZ3VhZ2Uub1BhZ2luYXRlOwoJCQkJdmFyIG9DbGFzc2VzID0gb1NldHRpbmdzLm9DbGFzc2VzOwoJCQkJdmFyIGZuQ2xpY2tIYW5kbGVyID0gZnVuY3Rpb24gKCBlICkgewoJCQkJCWlmICggb1NldHRpbmdzLm9BcGkuX2ZuUGFnZUNoYW5nZSggb1NldHRpbmdzLCBlLmRhdGEuYWN0aW9uICkgKQoJCQkJCXsKCQkJCQkJZm5DYWxsYmFja0RyYXcoIG9TZXR0aW5ncyApOwoJCQkJCX0KCQkJCX07CgkKCQkJCXZhciBzQXBwZW5kID0gKCFvU2V0dGluZ3MuYkpVSSkgPwoJCQkJCSc8YSBjbGFzcz0iJytvU2V0dGluZ3Mub0NsYXNzZXMuc1BhZ2VQcmV2RGlzYWJsZWQrJyIgdGFiaW5kZXg9Iicrb1NldHRpbmdzLmlUYWJJbmRleCsnIiByb2xlPSJidXR0b24iPicrb0xhbmcuc1ByZXZpb3VzKyc8L2E+JysKCQkJCQknPGEgY2xhc3M9Iicrb1NldHRpbmdzLm9DbGFzc2VzLnNQYWdlTmV4dERpc2FibGVkKyciIHRhYmluZGV4PSInK29TZXR0aW5ncy5pVGFiSW5kZXgrJyIgcm9sZT0iYnV0dG9uIj4nK29MYW5nLnNOZXh0Kyc8L2E+JwoJCQkJCToKCQkJCQknPGEgY2xhc3M9Iicrb1NldHRpbmdzLm9DbGFzc2VzLnNQYWdlUHJldkRpc2FibGVkKyciIHRhYmluZGV4PSInK29TZXR0aW5ncy5pVGFiSW5kZXgrJyIgcm9sZT0iYnV0dG9uIj48c3BhbiBjbGFzcz0iJytvU2V0dGluZ3Mub0NsYXNzZXMuc1BhZ2VKVUlQcmV2KyciPjwvc3Bhbj48L2E+JysKCQkJCQknPGEgY2xhc3M9Iicrb1NldHRpbmdzLm9DbGFzc2VzLnNQYWdlTmV4dERpc2FibGVkKyciIHRhYmluZGV4PSInK29TZXR0aW5ncy5pVGFiSW5kZXgrJyIgcm9sZT0iYnV0dG9uIj48c3BhbiBjbGFzcz0iJytvU2V0dGluZ3Mub0NsYXNzZXMuc1BhZ2VKVUlOZXh0KyciPjwvc3Bhbj48L2E+JzsKCQkJCSQoblBhZ2luZykuYXBwZW5kKCBzQXBwZW5kICk7CgkJCQkKCQkJCXZhciBlbHMgPSAkKCdhJywgblBhZ2luZyk7CgkJCQl2YXIgblByZXZpb3VzID0gZWxzWzBdLAoJCQkJCW5OZXh0ID0gZWxzWzFdOwoJCQkJCgkJCQlvU2V0dGluZ3Mub0FwaS5fZm5CaW5kQWN0aW9uKCBuUHJldmlvdXMsIHthY3Rpb246ICJwcmV2aW91cyJ9LCBmbkNsaWNrSGFuZGxlciApOwoJCQkJb1NldHRpbmdzLm9BcGkuX2ZuQmluZEFjdGlvbiggbk5leHQsICAgICB7YWN0aW9uOiAibmV4dCJ9LCAgICAgZm5DbGlja0hhbmRsZXIgKTsKCQkJCQoJCQkJLyogSUQgdGhlIGZpcnN0IGVsZW1lbnRzIG9ubHkgKi8KCQkJCWlmICggIW9TZXR0aW5ncy5hYW5GZWF0dXJlcy5wICkKCQkJCXsKCQkJCQluUGFnaW5nLmlkID0gb1NldHRpbmdzLnNUYWJsZUlkKydfcGFnaW5hdGUnOwoJCQkJCW5QcmV2aW91cy5pZCA9IG9TZXR0aW5ncy5zVGFibGVJZCsnX3ByZXZpb3VzJzsKCQkJCQluTmV4dC5pZCA9IG9TZXR0aW5ncy5zVGFibGVJZCsnX25leHQnOwoJCgkJCQkJblByZXZpb3VzLnNldEF0dHJpYnV0ZSgnYXJpYS1jb250cm9scycsIG9TZXR0aW5ncy5zVGFibGVJZCk7CgkJCQkJbk5leHQuc2V0QXR0cmlidXRlKCdhcmlhLWNvbnRyb2xzJywgb1NldHRpbmdzLnNUYWJsZUlkKTsKCQkJCX0KCQkJfSwKCQkJCgkJCS8qCgkJCSAqIEZ1bmN0aW9uOiBvUGFnaW5hdGlvbi50d29fYnV0dG9uLmZuVXBkYXRlCgkJCSAqIFB1cnBvc2U6ICBVcGRhdGUgdGhlIHR3byBidXR0b24gcGFnaW5hdGlvbiBhdCB0aGUgZW5kIG9mIHRoZSBkcmF3CgkJCSAqIFJldHVybnM6ICAtCgkJCSAqIElucHV0czogICBvYmplY3Q6b1NldHRpbmdzIC0gZGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCQkJICogICAgICAgICAgIGZ1bmN0aW9uOmZuQ2FsbGJhY2tEcmF3IC0gZHJhdyBmdW5jdGlvbiB0byBjYWxsIG9uIHBhZ2UgY2hhbmdlCgkJCSAqLwoJCQkiZm5VcGRhdGUiOiBmdW5jdGlvbiAoIG9TZXR0aW5ncywgZm5DYWxsYmFja0RyYXcgKQoJCQl7CgkJCQlpZiAoICFvU2V0dGluZ3MuYWFuRmVhdHVyZXMucCApCgkJCQl7CgkJCQkJcmV0dXJuOwoJCQkJfQoJCQkJCgkJCQl2YXIgb0NsYXNzZXMgPSBvU2V0dGluZ3Mub0NsYXNzZXM7CgkJCQl2YXIgYW4gPSBvU2V0dGluZ3MuYWFuRmVhdHVyZXMucDsKCQoJCQkJLyogTG9vcCBvdmVyIGVhY2ggaW5zdGFuY2Ugb2YgdGhlIHBhZ2VyICovCgkJCQlmb3IgKCB2YXIgaT0wLCBpTGVuPWFuLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJaWYgKCBhbltpXS5jaGlsZE5vZGVzLmxlbmd0aCAhPT0gMCApCgkJCQkJewoJCQkJCQlhbltpXS5jaGlsZE5vZGVzWzBdLmNsYXNzTmFtZSA9ICggb1NldHRpbmdzLl9pRGlzcGxheVN0YXJ0ID09PSAwICkgPyAKCQkJCQkJCW9DbGFzc2VzLnNQYWdlUHJldkRpc2FibGVkIDogb0NsYXNzZXMuc1BhZ2VQcmV2RW5hYmxlZDsKCQkJCQkJCgkJCQkJCWFuW2ldLmNoaWxkTm9kZXNbMV0uY2xhc3NOYW1lID0gKCBvU2V0dGluZ3MuZm5EaXNwbGF5RW5kKCkgPT0gb1NldHRpbmdzLmZuUmVjb3Jkc0Rpc3BsYXkoKSApID8gCgkJCQkJCQlvQ2xhc3Nlcy5zUGFnZU5leHREaXNhYmxlZCA6IG9DbGFzc2VzLnNQYWdlTmV4dEVuYWJsZWQ7CgkJCQkJfQoJCQkJfQoJCQl9CgkJfSwKCQkKCQkKCQkvKgoJCSAqIFZhcmlhYmxlOiBpRnVsbE51bWJlcnNTaG93UGFnZXMKCQkgKiBQdXJwb3NlOiAgQ2hhbmdlIHRoZSBudW1iZXIgb2YgcGFnZXMgd2hpY2ggY2FuIGJlIHNlZW4KCQkgKiBTY29wZTogICAgalF1ZXJ5LmZuLmRhdGFUYWJsZUV4dC5vUGFnaW5hdGlvbgoJCSAqLwoJCSJpRnVsbE51bWJlcnNTaG93UGFnZXMiOiA1LAoJCQoJCS8qCgkJICogVmFyaWFibGU6IGZ1bGxfbnVtYmVycwoJCSAqIFB1cnBvc2U6ICBGdWxsIG51bWJlcnMgcGFnaW5hdGlvbgoJCSAqIFNjb3BlOiAgICBqUXVlcnkuZm4uZGF0YVRhYmxlRXh0Lm9QYWdpbmF0aW9uCgkJICovCgkJImZ1bGxfbnVtYmVycyI6IHsKCQkJLyoKCQkJICogRnVuY3Rpb246IG9QYWdpbmF0aW9uLmZ1bGxfbnVtYmVycy5mbkluaXQKCQkJICogUHVycG9zZTogIEluaXRpYWxpc2UgZG9tIGVsZW1lbnRzIHJlcXVpcmVkIGZvciBwYWdpbmF0aW9uIHdpdGggYSBsaXN0IG9mIHRoZSBwYWdlcwoJCQkgKiBSZXR1cm5zOiAgLQoJCQkgKiBJbnB1dHM6ICAgb2JqZWN0Om9TZXR0aW5ncyAtIGRhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkJCSAqICAgICAgICAgICBub2RlOm5QYWdpbmcgLSB0aGUgRElWIHdoaWNoIGNvbnRhaW5zIHRoaXMgcGFnaW5hdGlvbiBjb250cm9sCgkJCSAqICAgICAgICAgICBmdW5jdGlvbjpmbkNhbGxiYWNrRHJhdyAtIGRyYXcgZnVuY3Rpb24gd2hpY2ggbXVzdCBiZSBjYWxsZWQgb24gdXBkYXRlCgkJCSAqLwoJCQkiZm5Jbml0IjogZnVuY3Rpb24gKCBvU2V0dGluZ3MsIG5QYWdpbmcsIGZuQ2FsbGJhY2tEcmF3ICkKCQkJewoJCQkJdmFyIG9MYW5nID0gb1NldHRpbmdzLm9MYW5ndWFnZS5vUGFnaW5hdGU7CgkJCQl2YXIgb0NsYXNzZXMgPSBvU2V0dGluZ3Mub0NsYXNzZXM7CgkJCQl2YXIgZm5DbGlja0hhbmRsZXIgPSBmdW5jdGlvbiAoIGUgKSB7CgkJCQkJaWYgKCBvU2V0dGluZ3Mub0FwaS5fZm5QYWdlQ2hhbmdlKCBvU2V0dGluZ3MsIGUuZGF0YS5hY3Rpb24gKSApCgkJCQkJewoJCQkJCQlmbkNhbGxiYWNrRHJhdyggb1NldHRpbmdzICk7CgkJCQkJfQoJCQkJfTsKCQoJCQkJJChuUGFnaW5nKS5hcHBlbmQoCgkJCQkJJzxhICB0YWJpbmRleD0iJytvU2V0dGluZ3MuaVRhYkluZGV4KyciIGNsYXNzPSInK29DbGFzc2VzLnNQYWdlQnV0dG9uKyIgIitvQ2xhc3Nlcy5zUGFnZUZpcnN0KyciPicrb0xhbmcuc0ZpcnN0Kyc8L2E+JysKCQkJCQknPGEgIHRhYmluZGV4PSInK29TZXR0aW5ncy5pVGFiSW5kZXgrJyIgY2xhc3M9Iicrb0NsYXNzZXMuc1BhZ2VCdXR0b24rIiAiK29DbGFzc2VzLnNQYWdlUHJldmlvdXMrJyI+JytvTGFuZy5zUHJldmlvdXMrJzwvYT4nKwoJCQkJCSc8c3Bhbj48L3NwYW4+JysKCQkJCQknPGEgdGFiaW5kZXg9Iicrb1NldHRpbmdzLmlUYWJJbmRleCsnIiBjbGFzcz0iJytvQ2xhc3Nlcy5zUGFnZUJ1dHRvbisiICIrb0NsYXNzZXMuc1BhZ2VOZXh0KyciPicrb0xhbmcuc05leHQrJzwvYT4nKwoJCQkJCSc8YSB0YWJpbmRleD0iJytvU2V0dGluZ3MuaVRhYkluZGV4KyciIGNsYXNzPSInK29DbGFzc2VzLnNQYWdlQnV0dG9uKyIgIitvQ2xhc3Nlcy5zUGFnZUxhc3QrJyI+JytvTGFuZy5zTGFzdCsnPC9hPicKCQkJCSk7CgkJCQl2YXIgZWxzID0gJCgnYScsIG5QYWdpbmcpOwoJCQkJdmFyIG5GaXJzdCA9IGVsc1swXSwKCQkJCQluUHJldiA9IGVsc1sxXSwKCQkJCQluTmV4dCA9IGVsc1syXSwKCQkJCQluTGFzdCA9IGVsc1szXTsKCQkJCQoJCQkJb1NldHRpbmdzLm9BcGkuX2ZuQmluZEFjdGlvbiggbkZpcnN0LCB7YWN0aW9uOiAiZmlyc3QifSwgICAgZm5DbGlja0hhbmRsZXIgKTsKCQkJCW9TZXR0aW5ncy5vQXBpLl9mbkJpbmRBY3Rpb24oIG5QcmV2LCAge2FjdGlvbjogInByZXZpb3VzIn0sIGZuQ2xpY2tIYW5kbGVyICk7CgkJCQlvU2V0dGluZ3Mub0FwaS5fZm5CaW5kQWN0aW9uKCBuTmV4dCwgIHthY3Rpb246ICJuZXh0In0sICAgICBmbkNsaWNrSGFuZGxlciApOwoJCQkJb1NldHRpbmdzLm9BcGkuX2ZuQmluZEFjdGlvbiggbkxhc3QsICB7YWN0aW9uOiAibGFzdCJ9LCAgICAgZm5DbGlja0hhbmRsZXIgKTsKCQkJCQoJCQkJLyogSUQgdGhlIGZpcnN0IGVsZW1lbnRzIG9ubHkgKi8KCQkJCWlmICggIW9TZXR0aW5ncy5hYW5GZWF0dXJlcy5wICkKCQkJCXsKCQkJCQluUGFnaW5nLmlkID0gb1NldHRpbmdzLnNUYWJsZUlkKydfcGFnaW5hdGUnOwoJCQkJCW5GaXJzdC5pZCA9b1NldHRpbmdzLnNUYWJsZUlkKydfZmlyc3QnOwoJCQkJCW5QcmV2LmlkID1vU2V0dGluZ3Muc1RhYmxlSWQrJ19wcmV2aW91cyc7CgkJCQkJbk5leHQuaWQgPW9TZXR0aW5ncy5zVGFibGVJZCsnX25leHQnOwoJCQkJCW5MYXN0LmlkID1vU2V0dGluZ3Muc1RhYmxlSWQrJ19sYXN0JzsKCQkJCX0KCQkJfSwKCQkJCgkJCS8qCgkJCSAqIEZ1bmN0aW9uOiBvUGFnaW5hdGlvbi5mdWxsX251bWJlcnMuZm5VcGRhdGUKCQkJICogUHVycG9zZTogIFVwZGF0ZSB0aGUgbGlzdCBvZiBwYWdlIGJ1dHRvbnMgc2hvd3MKCQkJICogUmV0dXJuczogIC0KCQkJICogSW5wdXRzOiAgIG9iamVjdDpvU2V0dGluZ3MgLSBkYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJCQkgKiAgICAgICAgICAgZnVuY3Rpb246Zm5DYWxsYmFja0RyYXcgLSBkcmF3IGZ1bmN0aW9uIHRvIGNhbGwgb24gcGFnZSBjaGFuZ2UKCQkJICovCgkJCSJmblVwZGF0ZSI6IGZ1bmN0aW9uICggb1NldHRpbmdzLCBmbkNhbGxiYWNrRHJhdyApCgkJCXsKCQkJCWlmICggIW9TZXR0aW5ncy5hYW5GZWF0dXJlcy5wICkKCQkJCXsKCQkJCQlyZXR1cm47CgkJCQl9CgkJCQkKCQkJCXZhciBpUGFnZUNvdW50ID0gRGF0YVRhYmxlLmV4dC5vUGFnaW5hdGlvbi5pRnVsbE51bWJlcnNTaG93UGFnZXM7CgkJCQl2YXIgaVBhZ2VDb3VudEhhbGYgPSBNYXRoLmZsb29yKGlQYWdlQ291bnQgLyAyKTsKCQkJCXZhciBpUGFnZXMgPSBNYXRoLmNlaWwoKG9TZXR0aW5ncy5mblJlY29yZHNEaXNwbGF5KCkpIC8gb1NldHRpbmdzLl9pRGlzcGxheUxlbmd0aCk7CgkJCQl2YXIgaUN1cnJlbnRQYWdlID0gTWF0aC5jZWlsKG9TZXR0aW5ncy5faURpc3BsYXlTdGFydCAvIG9TZXR0aW5ncy5faURpc3BsYXlMZW5ndGgpICsgMTsKCQkJCXZhciBzTGlzdCA9ICIiOwoJCQkJdmFyIGlTdGFydEJ1dHRvbiwgaUVuZEJ1dHRvbiwgaSwgaUxlbjsKCQkJCXZhciBvQ2xhc3NlcyA9IG9TZXR0aW5ncy5vQ2xhc3NlczsKCQkJCXZhciBhbkJ1dHRvbnMsIGFuU3RhdGljLCBuUGFnaW5hdGVMaXN0OwoJCQkJdmFyIGFuID0gb1NldHRpbmdzLmFhbkZlYXR1cmVzLnA7CgkJCQl2YXIgZm5CaW5kID0gZnVuY3Rpb24gKGopIHsKCQkJCQlvU2V0dGluZ3Mub0FwaS5fZm5CaW5kQWN0aW9uKCB0aGlzLCB7InBhZ2UiOiBqK2lTdGFydEJ1dHRvbi0xfSwgZnVuY3Rpb24oZSkgewoJCQkJCQkvKiBVc2UgdGhlIGluZm9ybWF0aW9uIGluIHRoZSBlbGVtZW50IHRvIGp1bXAgdG8gdGhlIHJlcXVpcmVkIHBhZ2UgKi8KCQkJCQkJb1NldHRpbmdzLm9BcGkuX2ZuUGFnZUNoYW5nZSggb1NldHRpbmdzLCBlLmRhdGEucGFnZSApOwoJCQkJCQlmbkNhbGxiYWNrRHJhdyggb1NldHRpbmdzICk7CgkJCQkJCWUucHJldmVudERlZmF1bHQoKTsKCQkJCQl9ICk7CgkJCQl9OwoJCQkJCgkJCQkvKiBQYWdlcyBjYWxjdWxhdGlvbiAqLwoJCQkJaWYgKCBvU2V0dGluZ3MuX2lEaXNwbGF5TGVuZ3RoID09PSAtMSApCgkJCQl7CgkJCQkJaVN0YXJ0QnV0dG9uID0gMTsKCQkJCQlpRW5kQnV0dG9uID0gMTsKCQkJCQlpQ3VycmVudFBhZ2UgPSAxOwoJCQkJfQoJCQkJZWxzZSBpZiAoaVBhZ2VzIDwgaVBhZ2VDb3VudCkKCQkJCXsKCQkJCQlpU3RhcnRCdXR0b24gPSAxOwoJCQkJCWlFbmRCdXR0b24gPSBpUGFnZXM7CgkJCQl9CgkJCQllbHNlIGlmIChpQ3VycmVudFBhZ2UgPD0gaVBhZ2VDb3VudEhhbGYpCgkJCQl7CgkJCQkJaVN0YXJ0QnV0dG9uID0gMTsKCQkJCQlpRW5kQnV0dG9uID0gaVBhZ2VDb3VudDsKCQkJCX0KCQkJCWVsc2UgaWYgKGlDdXJyZW50UGFnZSA+PSAoaVBhZ2VzIC0gaVBhZ2VDb3VudEhhbGYpKQoJCQkJewoJCQkJCWlTdGFydEJ1dHRvbiA9IGlQYWdlcyAtIGlQYWdlQ291bnQgKyAxOwoJCQkJCWlFbmRCdXR0b24gPSBpUGFnZXM7CgkJCQl9CgkJCQllbHNlCgkJCQl7CgkJCQkJaVN0YXJ0QnV0dG9uID0gaUN1cnJlbnRQYWdlIC0gTWF0aC5jZWlsKGlQYWdlQ291bnQgLyAyKSArIDE7CgkJCQkJaUVuZEJ1dHRvbiA9IGlTdGFydEJ1dHRvbiArIGlQYWdlQ291bnQgLSAxOwoJCQkJfQoJCgkJCQkKCQkJCS8qIEJ1aWxkIHRoZSBkeW5hbWljIGxpc3QgKi8KCQkJCWZvciAoIGk9aVN0YXJ0QnV0dG9uIDsgaTw9aUVuZEJ1dHRvbiA7IGkrKyApCgkJCQl7CgkJCQkJc0xpc3QgKz0gKGlDdXJyZW50UGFnZSAhPT0gaSkgPwoJCQkJCQknPGEgdGFiaW5kZXg9Iicrb1NldHRpbmdzLmlUYWJJbmRleCsnIiBjbGFzcz0iJytvQ2xhc3Nlcy5zUGFnZUJ1dHRvbisnIj4nK29TZXR0aW5ncy5mbkZvcm1hdE51bWJlcihpKSsnPC9hPicgOgoJCQkJCQknPGEgdGFiaW5kZXg9Iicrb1NldHRpbmdzLmlUYWJJbmRleCsnIiBjbGFzcz0iJytvQ2xhc3Nlcy5zUGFnZUJ1dHRvbkFjdGl2ZSsnIj4nK29TZXR0aW5ncy5mbkZvcm1hdE51bWJlcihpKSsnPC9hPic7CgkJCQl9CgkJCQkKCQkJCS8qIExvb3Agb3ZlciBlYWNoIGluc3RhbmNlIG9mIHRoZSBwYWdlciAqLwoJCQkJZm9yICggaT0wLCBpTGVuPWFuLmxlbmd0aCA7IGk8aUxlbiA7IGkrKyApCgkJCQl7CgkJCQkJaWYgKCBhbltpXS5jaGlsZE5vZGVzLmxlbmd0aCA9PT0gMCApCgkJCQkJewoJCQkJCQljb250aW51ZTsKCQkJCQl9CgkJCQkJCgkJCQkJLyogQnVpbGQgdXAgdGhlIGR5bmFtaWMgbGlzdCBmb3JzdCAtIGh0bWwgYW5kIGxpc3RlbmVycyAqLwoJCQkJCSQoJ3NwYW46ZXEoMCknLCBhbltpXSkKCQkJCQkJLmh0bWwoIHNMaXN0ICkKCQkJCQkJLmNoaWxkcmVuKCdhJykuZWFjaCggZm5CaW5kICk7CgkJCQkJCgkJCQkJLyogVXBkYXRlIHRoZSBwcmVtYW5lbnQgYm90dG9uJ3MgY2xhc3NlcyAqLwoJCQkJCWFuQnV0dG9ucyA9IGFuW2ldLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdhJyk7CgkJCQkJYW5TdGF0aWMgPSBbCgkJCQkJCWFuQnV0dG9uc1swXSwgYW5CdXR0b25zWzFdLCAKCQkJCQkJYW5CdXR0b25zW2FuQnV0dG9ucy5sZW5ndGgtMl0sIGFuQnV0dG9uc1thbkJ1dHRvbnMubGVuZ3RoLTFdCgkJCQkJXTsKCQoJCQkJCSQoYW5TdGF0aWMpLnJlbW92ZUNsYXNzKCBvQ2xhc3Nlcy5zUGFnZUJ1dHRvbisiICIrb0NsYXNzZXMuc1BhZ2VCdXR0b25BY3RpdmUrIiAiK29DbGFzc2VzLnNQYWdlQnV0dG9uU3RhdGljRGlzYWJsZWQgKTsKCQkJCQkkKFthblN0YXRpY1swXSwgYW5TdGF0aWNbMV1dKS5hZGRDbGFzcyggCgkJCQkJCShpQ3VycmVudFBhZ2U9PTEpID8KCQkJCQkJCW9DbGFzc2VzLnNQYWdlQnV0dG9uU3RhdGljRGlzYWJsZWQgOgoJCQkJCQkJb0NsYXNzZXMuc1BhZ2VCdXR0b24KCQkJCQkpOwoJCQkJCSQoW2FuU3RhdGljWzJdLCBhblN0YXRpY1szXV0pLmFkZENsYXNzKAoJCQkJCQkoaVBhZ2VzPT09MCB8fCBpQ3VycmVudFBhZ2U9PT1pUGFnZXMgfHwgb1NldHRpbmdzLl9pRGlzcGxheUxlbmd0aD09PS0xKSA/CgkJCQkJCQlvQ2xhc3Nlcy5zUGFnZUJ1dHRvblN0YXRpY0Rpc2FibGVkIDoKCQkJCQkJCW9DbGFzc2VzLnNQYWdlQnV0dG9uCgkJCQkJKTsKCQkJCX0KCQkJfQoJCX0KCX0gKTsKCQoJJC5leHRlbmQoIERhdGFUYWJsZS5leHQub1NvcnQsIHsKCQkvKgoJCSAqIHRleHQgc29ydGluZwoJCSAqLwoJCSJzdHJpbmctcHJlIjogZnVuY3Rpb24gKCBhICkKCQl7CgkJCWlmICggdHlwZW9mIGEgIT0gJ3N0cmluZycgKSB7CgkJCQlhID0gKGEgIT09IG51bGwgJiYgYS50b1N0cmluZykgPyBhLnRvU3RyaW5nKCkgOiAnJzsKCQkJfQoJCQlyZXR1cm4gYS50b0xvd2VyQ2FzZSgpOwoJCX0sCgkKCQkic3RyaW5nLWFzYyI6IGZ1bmN0aW9uICggeCwgeSApCgkJewoJCQlyZXR1cm4gKCh4IDwgeSkgPyAtMSA6ICgoeCA+IHkpID8gMSA6IDApKTsKCQl9LAoJCQoJCSJzdHJpbmctZGVzYyI6IGZ1bmN0aW9uICggeCwgeSApCgkJewoJCQlyZXR1cm4gKCh4IDwgeSkgPyAxIDogKCh4ID4geSkgPyAtMSA6IDApKTsKCQl9LAoJCQoJCQoJCS8qCgkJICogaHRtbCBzb3J0aW5nIChpZ25vcmUgaHRtbCB0YWdzKQoJCSAqLwoJCSJodG1sLXByZSI6IGZ1bmN0aW9uICggYSApCgkJewoJCQlyZXR1cm4gYS5yZXBsYWNlKCAvPC4qPz4vZywgIiIgKS50b0xvd2VyQ2FzZSgpOwoJCX0sCgkJCgkJImh0bWwtYXNjIjogZnVuY3Rpb24gKCB4LCB5ICkKCQl7CgkJCXJldHVybiAoKHggPCB5KSA/IC0xIDogKCh4ID4geSkgPyAxIDogMCkpOwoJCX0sCgkJCgkJImh0bWwtZGVzYyI6IGZ1bmN0aW9uICggeCwgeSApCgkJewoJCQlyZXR1cm4gKCh4IDwgeSkgPyAxIDogKCh4ID4geSkgPyAtMSA6IDApKTsKCQl9LAoJCQoJCQoJCS8qCgkJICogZGF0ZSBzb3J0aW5nCgkJICovCgkJImRhdGUtcHJlIjogZnVuY3Rpb24gKCBhICkKCQl7CgkJCXZhciB4ID0gRGF0ZS5wYXJzZSggYSApOwoJCQkKCQkJaWYgKCBpc05hTih4KSB8fCB4PT09IiIgKQoJCQl7CgkJCQl4ID0gRGF0ZS5wYXJzZSggIjAxLzAxLzE5NzAgMDA6MDA6MDAiICk7CgkJCX0KCQkJcmV0dXJuIHg7CgkJfSwKCQoJCSJkYXRlLWFzYyI6IGZ1bmN0aW9uICggeCwgeSApCgkJewoJCQlyZXR1cm4geCAtIHk7CgkJfSwKCQkKCQkiZGF0ZS1kZXNjIjogZnVuY3Rpb24gKCB4LCB5ICkKCQl7CgkJCXJldHVybiB5IC0geDsKCQl9LAoJCQoJCQoJCS8qCgkJICogbnVtZXJpY2FsIHNvcnRpbmcKCQkgKi8KCQkibnVtZXJpYy1wcmUiOiBmdW5jdGlvbiAoIGEgKQoJCXsKCQkJcmV0dXJuIChhPT0iLSIgfHwgYT09PSIiKSA/IDAgOiBhKjE7CgkJfSwKCQoJCSJudW1lcmljLWFzYyI6IGZ1bmN0aW9uICggeCwgeSApCgkJewoJCQlyZXR1cm4geCAtIHk7CgkJfSwKCQkKCQkibnVtZXJpYy1kZXNjIjogZnVuY3Rpb24gKCB4LCB5ICkKCQl7CgkJCXJldHVybiB5IC0geDsKCQl9Cgl9ICk7CgkKCQoJJC5leHRlbmQoIERhdGFUYWJsZS5leHQuYVR5cGVzLCBbCgkJLyoKCQkgKiBGdW5jdGlvbjogLQoJCSAqIFB1cnBvc2U6ICBDaGVjayB0byBzZWUgaWYgYSBzdHJpbmcgaXMgbnVtZXJpYwoJCSAqIFJldHVybnM6ICBzdHJpbmc6J251bWVyaWMnIG9yIG51bGwKCQkgKiBJbnB1dHM6ICAgbWl4ZWQ6c1RleHQgLSBzdHJpbmcgdG8gY2hlY2sKCQkgKi8KCQlmdW5jdGlvbiAoIHNEYXRhICkKCQl7CgkJCS8qIEFsbG93IHplcm8gbGVuZ3RoIHN0cmluZ3MgYXMgYSBudW1iZXIgKi8KCQkJaWYgKCB0eXBlb2Ygc0RhdGEgPT09ICdudW1iZXInICkKCQkJewoJCQkJcmV0dXJuICdudW1lcmljJzsKCQkJfQoJCQllbHNlIGlmICggdHlwZW9mIHNEYXRhICE9PSAnc3RyaW5nJyApCgkJCXsKCQkJCXJldHVybiBudWxsOwoJCQl9CgkJCQoJCQl2YXIgc1ZhbGlkRmlyc3RDaGFycyA9ICIwMTIzNDU2Nzg5LSI7CgkJCXZhciBzVmFsaWRDaGFycyA9ICIwMTIzNDU2Nzg5LiI7CgkJCXZhciBDaGFyOwoJCQl2YXIgYkRlY2ltYWwgPSBmYWxzZTsKCQkJCgkJCS8qIENoZWNrIGZvciBhIHZhbGlkIGZpcnN0IGNoYXIgKG5vIHBlcmlvZCBhbmQgYWxsb3cgbmVnYXRpdmVzKSAqLwoJCQlDaGFyID0gc0RhdGEuY2hhckF0KDApOyAKCQkJaWYgKHNWYWxpZEZpcnN0Q2hhcnMuaW5kZXhPZihDaGFyKSA9PSAtMSkgCgkJCXsKCQkJCXJldHVybiBudWxsOwoJCQl9CgkJCQoJCQkvKiBDaGVjayBhbGwgdGhlIG90aGVyIGNoYXJhY3RlcnMgYXJlIHZhbGlkICovCgkJCWZvciAoIHZhciBpPTEgOyBpPHNEYXRhLmxlbmd0aCA7IGkrKyApIAoJCQl7CgkJCQlDaGFyID0gc0RhdGEuY2hhckF0KGkpOyAKCQkJCWlmIChzVmFsaWRDaGFycy5pbmRleE9mKENoYXIpID09IC0xKSAKCQkJCXsKCQkJCQlyZXR1cm4gbnVsbDsKCQkJCX0KCQkJCQoJCQkJLyogT25seSBhbGxvd2VkIG9uZSBkZWNpbWFsIHBsYWNlLi4uICovCgkJCQlpZiAoIENoYXIgPT0gIi4iICkKCQkJCXsKCQkJCQlpZiAoIGJEZWNpbWFsICkKCQkJCQl7CgkJCQkJCXJldHVybiBudWxsOwoJCQkJCX0KCQkJCQliRGVjaW1hbCA9IHRydWU7CgkJCQl9CgkJCX0KCQkJCgkJCXJldHVybiAnbnVtZXJpYyc7CgkJfSwKCQkKCQkvKgoJCSAqIEZ1bmN0aW9uOiAtCgkJICogUHVycG9zZTogIENoZWNrIHRvIHNlZSBpZiBhIHN0cmluZyBpcyBhY3R1YWxseSBhIGZvcm1hdHRlZCBkYXRlCgkJICogUmV0dXJuczogIHN0cmluZzonZGF0ZScgb3IgbnVsbAoJCSAqIElucHV0czogICBzdHJpbmc6c1RleHQgLSBzdHJpbmcgdG8gY2hlY2sKCQkgKi8KCQlmdW5jdGlvbiAoIHNEYXRhICkKCQl7CgkJCXZhciBpUGFyc2UgPSBEYXRlLnBhcnNlKHNEYXRhKTsKCQkJaWYgKCAoaVBhcnNlICE9PSBudWxsICYmICFpc05hTihpUGFyc2UpKSB8fCAodHlwZW9mIHNEYXRhID09PSAnc3RyaW5nJyAmJiBzRGF0YS5sZW5ndGggPT09IDApICkKCQkJewoJCQkJcmV0dXJuICdkYXRlJzsKCQkJfQoJCQlyZXR1cm4gbnVsbDsKCQl9LAoJCQoJCS8qCgkJICogRnVuY3Rpb246IC0KCQkgKiBQdXJwb3NlOiAgQ2hlY2sgdG8gc2VlIGlmIGEgc3RyaW5nIHNob3VsZCBiZSB0cmVhdGVkIGFzIGFuIEhUTUwgc3RyaW5nCgkJICogUmV0dXJuczogIHN0cmluZzonaHRtbCcgb3IgbnVsbAoJCSAqIElucHV0czogICBzdHJpbmc6c1RleHQgLSBzdHJpbmcgdG8gY2hlY2sKCQkgKi8KCQlmdW5jdGlvbiAoIHNEYXRhICkKCQl7CgkJCWlmICggdHlwZW9mIHNEYXRhID09PSAnc3RyaW5nJyAmJiBzRGF0YS5pbmRleE9mKCc8JykgIT0gLTEgJiYgc0RhdGEuaW5kZXhPZignPicpICE9IC0xICkKCQkJewoJCQkJcmV0dXJuICdodG1sJzsKCQkJfQoJCQlyZXR1cm4gbnVsbDsKCQl9CgldICk7CgkKCgkvLyBqUXVlcnkgYWxpYXNlcwoJJC5mbi5EYXRhVGFibGUgPSBEYXRhVGFibGU7CgkkLmZuLmRhdGFUYWJsZSA9IERhdGFUYWJsZTsKCSQuZm4uZGF0YVRhYmxlU2V0dGluZ3MgPSBEYXRhVGFibGUuc2V0dGluZ3M7CgkkLmZuLmRhdGFUYWJsZUV4dCA9IERhdGFUYWJsZS5leHQ7CgoKCS8vIEluZm9ybWF0aW9uIGFib3V0IGV2ZW50cyBmaXJlZCBieSBEYXRhVGFibGVzIC0gZm9yIGRvY3VtZW50YXRpb24uCgkvKioKCSAqIERyYXcgZXZlbnQsIGZpcmVkIHdoZW5ldmVyIHRoZSB0YWJsZSBpcyByZWRyYXduIG9uIHRoZSBwYWdlLCBhdCB0aGUgc2FtZSBwb2ludCBhcwoJICogZm5EcmF3Q2FsbGJhY2suIFRoaXMgbWF5IGJlIHVzZWZ1bCBmb3IgYmluZGluZyBldmVudHMgb3IgcGVyZm9ybWluZyBjYWxjdWxhdGlvbnMgd2hlbgoJICogdGhlIHRhYmxlIGlzIGFsdGVyZWQgYXQgYWxsLgoJICogIEBuYW1lIERhdGFUYWJsZSNkcmF3CgkgKiAgQGV2ZW50CgkgKiAgQHBhcmFtIHtldmVudH0gZSBqUXVlcnkgZXZlbnQgb2JqZWN0CgkgKiAgQHBhcmFtIHtvYmplY3R9IG8gRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3Qge0BsaW5rIERhdGFUYWJsZS5tb2RlbHMub1NldHRpbmdzfQoJICovCgoJLyoqCgkgKiBGaWx0ZXIgZXZlbnQsIGZpcmVkIHdoZW4gdGhlIGZpbHRlcmluZyBhcHBsaWVkIHRvIHRoZSB0YWJsZSAodXNpbmcgdGhlIGJ1aWxkIGluIGdsb2JhbAoJICogZ2xvYmFsIGZpbHRlciwgb3IgY29sdW1uIGZpbHRlcnMpIGlzIGFsdGVyZWQuCgkgKiAgQG5hbWUgRGF0YVRhYmxlI2ZpbHRlcgoJICogIEBldmVudAoJICogIEBwYXJhbSB7ZXZlbnR9IGUgalF1ZXJ5IGV2ZW50IG9iamVjdAoJICogIEBwYXJhbSB7b2JqZWN0fSBvIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0IHtAbGluayBEYXRhVGFibGUubW9kZWxzLm9TZXR0aW5nc30KCSAqLwoKCS8qKgoJICogUGFnZSBjaGFuZ2UgZXZlbnQsIGZpcmVkIHdoZW4gdGhlIHBhZ2luZyBvZiB0aGUgdGFibGUgaXMgYWx0ZXJlZC4KCSAqICBAbmFtZSBEYXRhVGFibGUjcGFnZQoJICogIEBldmVudAoJICogIEBwYXJhbSB7ZXZlbnR9IGUgalF1ZXJ5IGV2ZW50IG9iamVjdAoJICogIEBwYXJhbSB7b2JqZWN0fSBvIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0IHtAbGluayBEYXRhVGFibGUubW9kZWxzLm9TZXR0aW5nc30KCSAqLwoKCS8qKgoJICogU29ydCBldmVudCwgZmlyZWQgd2hlbiB0aGUgc29ydGluZyBhcHBsaWVkIHRvIHRoZSB0YWJsZSBpcyBhbHRlcmVkLgoJICogIEBuYW1lIERhdGFUYWJsZSNzb3J0CgkgKiAgQGV2ZW50CgkgKiAgQHBhcmFtIHtldmVudH0gZSBqUXVlcnkgZXZlbnQgb2JqZWN0CgkgKiAgQHBhcmFtIHtvYmplY3R9IG8gRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3Qge0BsaW5rIERhdGFUYWJsZS5tb2RlbHMub1NldHRpbmdzfQoJICovCgoJLyoqCgkgKiBEYXRhVGFibGVzIGluaXRpYWxpc2F0aW9uIGNvbXBsZXRlIGV2ZW50LCBmaXJlZCB3aGVuIHRoZSB0YWJsZSBpcyBmdWxseSBkcmF3biwKCSAqIGluY2x1ZGluZyBBamF4IGRhdGEgbG9hZGVkLCBpZiBBamF4IGRhdGEgaXMgcmVxdWlyZWQuCgkgKiAgQG5hbWUgRGF0YVRhYmxlI2luaXQKCSAqICBAZXZlbnQKCSAqICBAcGFyYW0ge2V2ZW50fSBlIGpRdWVyeSBldmVudCBvYmplY3QKCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkgKiAgQHBhcmFtIHtvYmplY3R9IGpzb24gVGhlIEpTT04gb2JqZWN0IHJlcXVlc3QgZnJvbSB0aGUgc2VydmVyIC0gb25seQoJICogICAgcHJlc2VudCBpZiBjbGllbnQtc2lkZSBBamF4IHNvdXJjZWQgZGF0YSBpcyB1c2VkPC9saT48L29sPgoJICovCgoJLyoqCgkgKiBTdGF0ZSBzYXZlIGV2ZW50LCBmaXJlZCB3aGVuIHRoZSB0YWJsZSBoYXMgY2hhbmdlZCBzdGF0ZSBhIG5ldyBzdGF0ZSBzYXZlIGlzIHJlcXVpcmVkLgoJICogVGhpcyBtZXRob2QgYWxsb3dzIG1vZGlmaWNhdGlvbiBvZiB0aGUgc3RhdGUgc2F2aW5nIG9iamVjdCBwcmlvciB0byBhY3R1YWxseSBkb2luZyB0aGUKCSAqIHNhdmUsIGluY2x1ZGluZyBhZGRpdGlvbiBvciBvdGhlciBzdGF0ZSBwcm9wZXJ0aWVzIChmb3IgcGx1Zy1pbnMpIG9yIG1vZGlmaWNhdGlvbgoJICogb2YgYSBEYXRhVGFibGVzIGNvcmUgcHJvcGVydHkuCgkgKiAgQG5hbWUgRGF0YVRhYmxlI3N0YXRlU2F2ZVBhcmFtcwoJICogIEBldmVudAoJICogIEBwYXJhbSB7ZXZlbnR9IGUgalF1ZXJ5IGV2ZW50IG9iamVjdAoJICogIEBwYXJhbSB7b2JqZWN0fSBvU2V0dGluZ3MgRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3QKCSAqICBAcGFyYW0ge29iamVjdH0ganNvbiBUaGUgc3RhdGUgaW5mb3JtYXRpb24gdG8gYmUgc2F2ZWQKCSAqLwoKCS8qKgoJICogU3RhdGUgbG9hZCBldmVudCwgZmlyZWQgd2hlbiB0aGUgdGFibGUgaXMgbG9hZGluZyBzdGF0ZSBmcm9tIHRoZSBzdG9yZWQgZGF0YSwgYnV0CgkgKiBwcmlvciB0byB0aGUgc2V0dGluZ3Mgb2JqZWN0IGJlaW5nIG1vZGlmaWVkIGJ5IHRoZSBzYXZlZCBzdGF0ZSAtIGFsbG93aW5nIG1vZGlmaWNhdGlvbgoJICogb2YgdGhlIHNhdmVkIHN0YXRlIGlzIHJlcXVpcmVkIG9yIGxvYWRpbmcgb2Ygc3RhdGUgZm9yIGEgcGx1Zy1pbi4KCSAqICBAbmFtZSBEYXRhVGFibGUjc3RhdGVMb2FkUGFyYW1zCgkgKiAgQGV2ZW50CgkgKiAgQHBhcmFtIHtldmVudH0gZSBqUXVlcnkgZXZlbnQgb2JqZWN0CgkgKiAgQHBhcmFtIHtvYmplY3R9IG9TZXR0aW5ncyBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdAoJICogIEBwYXJhbSB7b2JqZWN0fSBqc29uIFRoZSBzYXZlZCBzdGF0ZSBpbmZvcm1hdGlvbgoJICovCgoJLyoqCgkgKiBTdGF0ZSBsb2FkZWQgZXZlbnQsIGZpcmVkIHdoZW4gc3RhdGUgaGFzIGJlZW4gbG9hZGVkIGZyb20gc3RvcmVkIGRhdGEgYW5kIHRoZSBzZXR0aW5ncwoJICogb2JqZWN0IGhhcyBiZWVuIG1vZGlmaWVkIGJ5IHRoZSBsb2FkZWQgZGF0YS4KCSAqICBAbmFtZSBEYXRhVGFibGUjc3RhdGVMb2FkZWQKCSAqICBAZXZlbnQKCSAqICBAcGFyYW0ge2V2ZW50fSBlIGpRdWVyeSBldmVudCBvYmplY3QKCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkgKiAgQHBhcmFtIHtvYmplY3R9IGpzb24gVGhlIHNhdmVkIHN0YXRlIGluZm9ybWF0aW9uCgkgKi8KCgkvKioKCSAqIFByb2Nlc3NpbmcgZXZlbnQsIGZpcmVkIHdoZW4gRGF0YVRhYmxlcyBpcyBkb2luZyBzb21lIGtpbmQgb2YgcHJvY2Vzc2luZyAoYmUgaXQsCgkgKiBzb3J0LCBmaWx0ZXIgb3IgYW55dGhpbmcgZWxzZSkuIENhbiBiZSB1c2VkIHRvIGluZGljYXRlIHRvIHRoZSBlbmQgdXNlciB0aGF0CgkgKiB0aGVyZSBpcyBzb21ldGhpbmcgaGFwcGVuaW5nLCBvciB0aGF0IHNvbWV0aGluZyBoYXMgZmluaXNoZWQuCgkgKiAgQG5hbWUgRGF0YVRhYmxlI3Byb2Nlc3NpbmcKCSAqICBAZXZlbnQKCSAqICBAcGFyYW0ge2V2ZW50fSBlIGpRdWVyeSBldmVudCBvYmplY3QKCSAqICBAcGFyYW0ge29iamVjdH0gb1NldHRpbmdzIERhdGFUYWJsZXMgc2V0dGluZ3Mgb2JqZWN0CgkgKiAgQHBhcmFtIHtib29sZWFufSBiU2hvdyBGbGFnIGZvciBpZiBEYXRhVGFibGVzIGlzIGRvaW5nIHByb2Nlc3Npbmcgb3Igbm90CgkgKi8KCgkvKioKCSAqIEFqYXggKFhIUikgZXZlbnQsIGZpcmVkIHdoZW5ldmVyIGFuIEFqYXggcmVxdWVzdCBpcyBjb21wbGV0ZWQgZnJvbSBhIHJlcXVlc3QgdG8gCgkgKiBtYWRlIHRvIHRoZSBzZXJ2ZXIgZm9yIG5ldyBkYXRhIChub3RlIHRoYXQgdGhpcyB0cmlnZ2VyIGlzIGNhbGxlZCBpbiBmblNlcnZlckRhdGEsCgkgKiBpZiB5b3Ugb3ZlcnJpZGUgZm5TZXJ2ZXJEYXRhIGFuZCB3aGljaCB0byB1c2UgdGhpcyBldmVudCwgeW91IG5lZWQgdG8gdHJpZ2dlciBpdCBpbgoJICogeW91IHN1Y2Nlc3MgZnVuY3Rpb24pLgoJICogIEBuYW1lIERhdGFUYWJsZSN4aHIKCSAqICBAZXZlbnQKCSAqICBAcGFyYW0ge2V2ZW50fSBlIGpRdWVyeSBldmVudCBvYmplY3QKCSAqICBAcGFyYW0ge29iamVjdH0gbyBEYXRhVGFibGVzIHNldHRpbmdzIG9iamVjdCB7QGxpbmsgRGF0YVRhYmxlLm1vZGVscy5vU2V0dGluZ3N9CgkgKi8KCgkvKioKCSAqIERlc3Ryb3kgZXZlbnQsIGZpcmVkIHdoZW4gdGhlIERhdGFUYWJsZSBpcyBkZXN0cm95ZWQgYnkgY2FsbGluZyBmbkRlc3Ryb3kgb3IgcGFzc2luZwoJICogdGhlIGJEZXN0cm95OnRydWUgcGFyYW1ldGVyIGluIHRoZSBpbml0aWFsaXNhdGlvbiBvYmplY3QuIFRoaXMgY2FuIGJlIHVzZWQgdG8gcmVtb3ZlCgkgKiBib3VuZCBldmVudHMsIGFkZGVkIERPTSBub2RlcywgZXRjLgoJICogIEBuYW1lIERhdGFUYWJsZSNkZXN0cm95CgkgKiAgQGV2ZW50CgkgKiAgQHBhcmFtIHtldmVudH0gZSBqUXVlcnkgZXZlbnQgb2JqZWN0CgkgKiAgQHBhcmFtIHtvYmplY3R9IG8gRGF0YVRhYmxlcyBzZXR0aW5ncyBvYmplY3Qge0BsaW5rIERhdGFUYWJsZS5tb2RlbHMub1NldHRpbmdzfQoJICovCn0oalF1ZXJ5LCB3aW5kb3csIGRvY3VtZW50LCB1bmRlZmluZWQpKTsK",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Sat, 08 Nov 2014 03:54:55 GMT",
                    "Content-Length": "369048",
                    "Date": "Sat, 08 Nov 2014 03:55:09 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}