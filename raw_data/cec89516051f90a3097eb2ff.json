{
    "url": "http://localhost:9999/ImBobby/tabby/src/tabby.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Cross-site scripting (DOM-based)",
    "issueType": 2097936,
    "severity": "High",
    "confidence": "Firm",
    "issueBackground": "DOM-based cross-site scripting vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the HTML document in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause JavaScript code supplied by the attacker to execute within the user's browser in the context of that user's session with the application.<br><br>The attacker-supplied code can perform a wide variety of actions, such as stealing the victim's session token or login credentials, performing arbitrary actions on the victim's behalf, and logging their keystrokes.<br><br>Users can be induced to visit the attacker's crafted URL in various ways, similar to the usual attack delivery vectors for reflected cross-site scripting vulnerabilities. ",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based cross-site scripting vulnerabilities is not to dynamically write data into the HTML document that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing script code into the document. In many cases, the relevant data can be validated on a whitelist basis, to allow only content that is known to be safe. In other cases, it will be necessary to sanitize or encode the data. This can be a complex task, and depending on the context that the data is to be inserted may need to involve a combination of JavaScript escaping, HTML encoding, and URL encoding, in the appropriate sequence.",
    "issueDetail": "The application may be vulnerable to DOM-based cross-site scripting. Data is read from <b>window.location.hash</b> and written to <b>$()</b> via the following statement:<ul><li>var id        = window.location.hash,             $target   = $(id),             $trigger  = $('.tabby-trigger[href=\"' + id + '\"]');</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/ImBobby/tabby/src/tabby.js",
                "path": "/ImBobby/tabby/src/tabby.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9JbUJvYmJ5L3RhYmJ5L3NyYy90YWJieS5qcyBIVFRQLzEuMQ0KSG9zdDogbG9jYWxob3N0Ojk5OTkNCg0K",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogNjIxMA0KQWNjZXB0LVJhbmdlczogYnl0ZXMNCkNvbnRlbnQtVHlwZTogYXBwbGljYXRpb24vamF2YXNjcmlwdA0KRGF0ZTogU2F0LCAwOCBOb3YgMjAxNCAxNToxNzowOSBHTVQNCkxhc3QtTW9kaWZpZWQ6IFNhdCwgMDggTm92IDIwMTQgMTU6MTc6MDkgR01UDQoNCi8qISBUYWJieSB2MS4wLjAgfCAoYykgMjAxNCBAX2JvYmJ5bGllIHwgaHR0cHM6Ly9naXRodWIuY29tL0ltQm9iYnkvdGFiYnkgKi8KCjsoZnVuY3Rpb24gKCAkLCB3aW5kb3csIGRvY3VtZW50LCB1bmRlZmluZWQgKSB7CgogIHZhciBkZWZhdWx0cyA9IHsKICAgIHNwZWVkOiA1MDAsCiAgICBoYXNoQ2hhbmdlOiBmYWxzZSwKICAgIGNvbXBsZXRlOiBudWxsCiAgfTsKCiAgdmFyIFJJR0hUX0FSUk9XID0gMzksCiAgICAgIExFRlRfQVJST1cgID0gMzc7CgogIC8vIFN0b3JlIGNsYXNzIG5hbWUKICB2YXIgX2NsYXNzID0gewogICAgdGFiQWN0aXZlICAgICA6ICdhY3RpdmUnLAogICAgdGFiUmVhZHkgICAgICA6ICd0YWJieS10YWItLXJlYWR5JywKICAgIHRyaWdnZXJBY3RpdmUgOiAnYWN0aXZlJywKICAgIGV4Y2x1ZGUgICAgICAgOiAndGFiYnktZXhjbHVkZScKICB9OwoKICBmdW5jdGlvbiBQbHVnaW4gKCBlbGVtZW50LCB1c2VyT3B0aW9ucyApIHsKICAgIHRoaXMuX2VsZW1lbnQgICA9ICQoZWxlbWVudCk7CiAgICB0aGlzLl9zZXR0aW5ncyAgPSAkLmV4dGVuZCgge30sIGRlZmF1bHRzLCB1c2VyT3B0aW9ucyk7CiAgICB0aGlzLl9kZWZhdWx0cyAgPSB0aGlzLl9zZXR0aW5nczsKICAgIHRoaXMuX3RyaWdnZXJzICA9IHRoaXMuX2VsZW1lbnQuZmluZCgnLnRhYmJ5LXRyaWdnZXInKTsKICAgIHRoaXMuX2FjdGl2ZVRhYiA9IHRoaXMuX2VsZW1lbnQuZmluZCgnLnRhYmJ5LXRhYi5hY3RpdmUnKTsKICAgIHRoaXMuaW5pdCgpOwogIH0KCiAgJC5leHRlbmQoIFBsdWdpbi5wcm90b3R5cGUsIHsKCiAgICBpbml0OiBmdW5jdGlvbiAoKSB7CiAgICAgIHRoaXMuc2V0R3JvdXAoKTsKICAgICAgdGhpcy5zaG93QWN0aXZlVGFiKCB0aGlzLl9hY3RpdmVUYWIsIHRoaXMuX2RlZmF1bHRzICk7CiAgICAgIHRoaXMudG9nZ2xlVGFiKCk7CiAgICAgIHRoaXMuc2V0QWNjZXNzaWJpbGl0eSgpOwogICAgICB0aGlzLmhhc0hhc2goKTsKICAgICAgdGhpcy5rZXlib2FyZE5hdigpOwogICAgfSwKCiAgICAvLyBTZXQgVUlEIHRvIGVhY2ggaW5zdGFuY2UKICAgIHNldEdyb3VwOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBVSUQgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTsKCiAgICAgIHRoaXMuX2VsZW1lbnQuYXR0cignZGF0YS10YWJieS1ncm91cCcsIFVJRCk7CiAgICB9LAoKICAgIHNob3dBY3RpdmVUYWI6IGZ1bmN0aW9uICggYWN0aXZlVGFiLCBzZXR0aW5ncyApIHsKICAgICAgdmFyICRjb250YWluZXIgID0gYWN0aXZlVGFiLnBhcmVudCgpLAoKICAgICAgICAgIC8vIEZpbmQgYWxsIHRhYnMKICAgICAgICAgICR0YWJzICAgICAgID0gJGNvbnRhaW5lci5maW5kKCcudGFiYnktdGFiJyksCgogICAgICAgICAgLy8gR2V0IHRoZSBoZWlnaHQgb2Ygc2VsZWN0ZWQgdGFiCiAgICAgICAgICBoZWlnaHQgICAgICA9IGFjdGl2ZVRhYi5pbm5lckhlaWdodCgpLAoKICAgICAgICAgIC8vIEdldCBzcGVlZCB2YWx1ZQogICAgICAgICAgc3BlZWQgICAgICAgPSBzZXR0aW5ncy5zcGVlZDsKCiAgICAgIGlmICggc3VwcG9ydFRyYW5zaXRpb24oKSApIHsKICAgICAgICBQbHVnaW4ucHJvdG90eXBlLnNldFRhYmJ5U3BlZWQoICRjb250YWluZXIsICR0YWJzLCBzcGVlZCApOwogICAgICAgICRjb250YWluZXIuY3NzKCdoZWlnaHQnLCBoZWlnaHQpOwogICAgICB9IGVsc2UgewogICAgICAgICRjb250YWluZXIuYW5pbWF0ZSh7CiAgICAgICAgICAnaGVpZ2h0JzogaGVpZ2h0ICsgJ3B4JwogICAgICAgIH0sIHNwZWVkKTsKICAgICAgfQoKICAgICAgYWN0aXZlVGFiLnNpYmxpbmdzKCkKICAgICAgICAucmVtb3ZlQ2xhc3MoIF9jbGFzcy50YWJBY3RpdmUgKyAnICcgKyBfY2xhc3MudGFiUmVhZHkgKQogICAgICAgIC5hdHRyKCdhcmlhLWhpZGRlbicsICd0cnVlJyk7CgogICAgICBhY3RpdmVUYWIKICAgICAgICAuYWRkQ2xhc3MoIF9jbGFzcy50YWJBY3RpdmUgKyAnICcgKyBfY2xhc3MudGFiUmVhZHkgKQogICAgICAgIC5yZW1vdmVBdHRyKCdhcmlhLWhpZGRlbicpOwoKICAgICAgaWYgKCAkLmlzRnVuY3Rpb24oIHNldHRpbmdzLmNvbXBsZXRlICkgKSB7CiAgICAgICAgdmFyIHRyYW5zaXRpb25Db21wbGV0ZSA9IHNldFRpbWVvdXQoIHNldHRpbmdzLmNvbXBsZXRlLCBzZXR0aW5ncy5zcGVlZCApOwogICAgICB9CiAgICB9LAoKICAgIHRvZ2dsZVRhYjogZnVuY3Rpb24gKCkgewogICAgICB2YXIgc2V0dGluZ3MgPSB0aGlzLl9kZWZhdWx0czsKCiAgICAgIHRoaXMuX3RyaWdnZXJzLmNsaWNrKCBmdW5jdGlvbiAoIGV2ZW50ICkgewogICAgICAgIHZhciAkdGhpcyAgID0gJCh0aGlzKTsKCiAgICAgICAgaWYgKCAkdGhpcy5oYXNDbGFzcyggX2NsYXNzLnRyaWdnZXJBY3RpdmUgKSApIHsKICAgICAgICAgIHJldHVybiBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIH0KCiAgICAgICAgdmFyIHRhcmdldCAgPSAkdGhpcy5hdHRyKCdocmVmJyksCiAgICAgICAgICAgICR0YXJnZXQgPSAkKHRhcmdldCk7CgogICAgICAgIGlmICggISR0YXJnZXQubGVuZ3RoICkgcmV0dXJuOwoKICAgICAgICAkdGhpcy5zaWJsaW5ncygnOm5vdCguJyArIF9jbGFzcy5leGNsdWRlICsgJyknKQogICAgICAgICAgLnJlbW92ZUNsYXNzKCBfY2xhc3MudHJpZ2dlckFjdGl2ZSApCiAgICAgICAgICAuYXR0cigndGFiaW5kZXgnLCAnLTEnKQogICAgICAgICAgLnJlbW92ZUF0dHIoJ2FyaWEtc2VsZWN0ZWQnKTsKCiAgICAgICAgJHRoaXMKICAgICAgICAgIC5hZGRDbGFzcyggX2NsYXNzLnRyaWdnZXJBY3RpdmUgKQogICAgICAgICAgLmF0dHIoewogICAgICAgICAgICAndGFiaW5kZXgnOiAnMCcsCiAgICAgICAgICAgICdhcmlhLXNlbGVjdGVkJzogJ3RydWUnCiAgICAgICAgICB9KTsKCiAgICAgICAgUGx1Z2luLnByb3RvdHlwZS5zaG93QWN0aXZlVGFiKCAkdGFyZ2V0LCBzZXR0aW5ncyApOwoKICAgICAgICBpZiAoICFzZXR0aW5ncy5oYXNoQ2hhbmdlICkgcmV0dXJuIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIH0pOwogICAgfSwKCiAgICAvLyBodHRwOi8vZ29vLmdsLzNqRGRjRgogICAgc2V0QWNjZXNzaWJpbGl0eTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgJHRyaWdnZXJzV3JhcHBlciAgPSB0aGlzLl9lbGVtZW50LmZpbmQoJy50YWJieS10cmlnZ2VycycpLAogICAgICAgICAgJHRyaWdnZXJzICAgICAgICAgPSB0aGlzLl9lbGVtZW50LmZpbmQoJy50YWJieS10cmlnZ2VyOm5vdCguJyArIF9jbGFzcy5leGNsdWRlICsgJyknKSwKICAgICAgICAgICR0YWJzICAgICAgICAgICAgID0gdGhpcy5fZWxlbWVudC5maW5kKCcudGFiYnktdGFiJyk7CgogICAgICAkdHJpZ2dlcnNXcmFwcGVyLmF0dHIoJ3JvbGUnLCAndGFibGlzdCcpOwogICAgICAKICAgICAgJHRyaWdnZXJzLmVhY2goZnVuY3Rpb24oaW5kZXgsIGVsKSB7CiAgICAgICAgdmFyICR0aGlzICAgICA9ICQoZWwpLAogICAgICAgICAgICBocmVmICAgICAgPSAkdGhpcy5hdHRyKCdocmVmJyksCiAgICAgICAgICAgIGNvbnRyb2xzICA9IGhyZWYuc3Vic3RyaW5nKDEsIGhyZWYubGVuZ3RoKTsKCiAgICAgICAgJHRoaXMuYXR0cih7CiAgICAgICAgICAncm9sZSc6ICd0YWInLAogICAgICAgICAgJ2FyaWEtY29udHJvbHMnOiBjb250cm9scywKICAgICAgICAgICd0YWJpbmRleCc6ICctMScKICAgICAgICB9KTsKCiAgICAgICAgaWYgKCAkdGhpcy5oYXNDbGFzcyggX2NsYXNzLnRyaWdnZXJBY3RpdmUgKSApIHsKICAgICAgICAgICR0aGlzLmF0dHIoewogICAgICAgICAgICAnYXJpYS1zZWxlY3RlZCc6ICd0cnVlJywKICAgICAgICAgICAgJ3RhYmluZGV4JzogJzAnCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgJHRhYnMuZWFjaChmdW5jdGlvbihpbmRleCwgZWwpIHsKICAgICAgICB2YXIgJHRoaXMgPSAkKGVsKTsKCiAgICAgICAgJHRoaXMuYXR0cigncm9sZScsICd0YWJwYW5lbCcpOwoKICAgICAgICBpZiAoICEkdGhpcy5oYXNDbGFzcyggX2NsYXNzLnRhYkFjdGl2ZSApICkgewogICAgICAgICAgJHRoaXMuYXR0cignYXJpYS1oaWRkZW4nLCAndHJ1ZScpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAoKICAgIGhhc0hhc2g6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9oYXNoICAgICA9IHdpbmRvdy5sb2NhdGlvbi5oYXNoLAogICAgICAgICAgc2V0dGluZ3MgID0gdGhpcy5fZGVmYXVsdHM7CgogICAgICBpZiAoICFzZXR0aW5ncy5oYXNoQ2hhbmdlIHx8IF9oYXNoID09PSAnJyApIHJldHVybjsKCiAgICAgIHZhciBzaG93VGFiQnlIYXNoID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBpZCAgICAgICAgPSB3aW5kb3cubG9jYXRpb24uaGFzaCwKICAgICAgICAgICAgJHRhcmdldCAgID0gJChpZCksCiAgICAgICAgICAgICR0cmlnZ2VyICA9ICQoJy50YWJieS10cmlnZ2VyW2hyZWY9IicgKyBpZCArICciXScpOwoKICAgICAgICAkdHJpZ2dlci50cmlnZ2VyKCdjbGljaycpLmZvY3VzKCk7CiAgICAgIH07CgogICAgICBzaG93VGFiQnlIYXNoKCk7CgogICAgICB3aW5kb3cub25oYXNoY2hhbmdlID0gc2hvd1RhYkJ5SGFzaDsKICAgIH0sCgogICAga2V5Ym9hcmROYXY6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGVsZW1lbnQgICAgICAgPSB0aGlzLl9lbGVtZW50LAogICAgICAgICAgaXNIYXNoQ2hhbmdlICA9IHRoaXMuX2RlZmF1bHRzLmhhc2hDaGFuZ2U7CgogICAgICB2YXIgY3ljbGVUYWJieU5hdiA9IGZ1bmN0aW9uICggZXZlbnQgKSB7CiAgICAgICAgdmFyICRhY3RpdmVFbGVtID0gZWxlbWVudC5maW5kKCcudGFiYnktdHJpZ2dlcjpmb2N1czpub3QoLicgKyBfY2xhc3MuZXhjbHVkZSArICcpJyk7CgogICAgICAgIGlmICggISRhY3RpdmVFbGVtLmxlbmd0aCApIHJldHVybjsKCiAgICAgICAgdmFyIHByZXYgICAgPSAkYWN0aXZlRWxlbS5wcmV2KCksCiAgICAgICAgICAgIG5leHQgICAgPSAkYWN0aXZlRWxlbS5uZXh0KCksCgogICAgICAgICAgICBoYXNQcmV2ID0gcHJldi5sZW5ndGgsCiAgICAgICAgICAgIGhhc05leHQgPSBuZXh0Lmxlbmd0aDsKCiAgICAgICAgdmFyIGdvdG9OYXYgPSBmdW5jdGlvbiAoIHBvc2l0aW9uICkgewoKICAgICAgICAgIGlmICggcG9zaXRpb24uaGFzQ2xhc3MoIF9jbGFzcy5leGNsdWRlICkgKSByZXR1cm47CgogICAgICAgICAgcG9zaXRpb24udHJpZ2dlcignY2xpY2snKS5mb2N1cygpOwoKICAgICAgICAgIGlmICggaXNIYXNoQ2hhbmdlICkgewogICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaGFzaCA9IHBvc2l0aW9uLmF0dHIoJ2hyZWYnKTsKICAgICAgICAgIH0KCiAgICAgICAgfTsKCiAgICAgICAgaWYgKCBldmVudC5rZXlDb2RlID09PSBSSUdIVF9BUlJPVyAmJiBoYXNOZXh0ICkgewogICAgICAgICAgZ290b05hdiggbmV4dCApOwogICAgICAgIH0gZWxzZSBpZiAoIGV2ZW50LmtleUNvZGUgPT09IExFRlRfQVJST1cgJiYgaGFzUHJldiApIHsKICAgICAgICAgIGdvdG9OYXYoIHByZXYgKTsKICAgICAgICB9CiAgICAgIH07CgogICAgICAkKGRvY3VtZW50KS5rZXlkb3duKCBjeWNsZVRhYmJ5TmF2ICk7CiAgICB9LAoKICAgIHNldFRhYmJ5U3BlZWQ6IGZ1bmN0aW9uICggY29udGFpbmVyLCB0YWJzLCBkdXJhdGlvbiApIHsKICAgICAgdmFyIHNwZWVkID0gZHVyYXRpb24gKyAnbXMnOwoKICAgICAgY29udGFpbmVyLmNzcygndHJhbnNpdGlvbi1kdXJhdGlvbicsIHNwZWVkKTsKICAgICAgdGFicy5jc3MoJ3RyYW5zaXRpb24tZGVsYXknLCBzcGVlZCk7CiAgICB9CgogIH0pOwoKICAvLyBodHRwOi8vZ29vLmdsL2JrTXJBVgogIGZ1bmN0aW9uIHN1cHBvcnRUcmFuc2l0aW9uKCkgewogICAgcmV0dXJuICgKICAgICAgJ1dlYmtpdFRyYW5zaXRpb24nIGluIGRvY3VtZW50LmJvZHkuc3R5bGUgfHwKICAgICAgJ01velRyYW5zaXRpb24nIGluIGRvY3VtZW50LmJvZHkuc3R5bGUgfHwKICAgICAgJ09UcmFuc2l0aW9uJyBpbiBkb2N1bWVudC5ib2R5LnN0eWxlIHx8CiAgICAgICd0cmFuc2l0aW9uJyBpbiBkb2N1bWVudC5ib2R5LnN0eWxlCiAgICApOwogIH0KCiAgJC5mbi50YWJieSA9IGZ1bmN0aW9uICggdXNlck9wdGlvbnMgKSB7CgogICAgaWYgKCAhdGhpcy5sZW5ndGggKSByZXR1cm47CgogICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7CiAgICAgIG5ldyBQbHVnaW4oIHRoaXMsIHVzZXJPcHRpb25zICk7CiAgICB9KTsKICB9OwoKfSkoIGpRdWVyeSwgd2luZG93LCBkb2N1bWVudCApOw==",
                "body": "LyohIFRhYmJ5IHYxLjAuMCB8IChjKSAyMDE0IEBfYm9iYnlsaWUgfCBodHRwczovL2dpdGh1Yi5jb20vSW1Cb2JieS90YWJieSAqLwoKOyhmdW5jdGlvbiAoICQsIHdpbmRvdywgZG9jdW1lbnQsIHVuZGVmaW5lZCApIHsKCiAgdmFyIGRlZmF1bHRzID0gewogICAgc3BlZWQ6IDUwMCwKICAgIGhhc2hDaGFuZ2U6IGZhbHNlLAogICAgY29tcGxldGU6IG51bGwKICB9OwoKICB2YXIgUklHSFRfQVJST1cgPSAzOSwKICAgICAgTEVGVF9BUlJPVyAgPSAzNzsKCiAgLy8gU3RvcmUgY2xhc3MgbmFtZQogIHZhciBfY2xhc3MgPSB7CiAgICB0YWJBY3RpdmUgICAgIDogJ2FjdGl2ZScsCiAgICB0YWJSZWFkeSAgICAgIDogJ3RhYmJ5LXRhYi0tcmVhZHknLAogICAgdHJpZ2dlckFjdGl2ZSA6ICdhY3RpdmUnLAogICAgZXhjbHVkZSAgICAgICA6ICd0YWJieS1leGNsdWRlJwogIH07CgogIGZ1bmN0aW9uIFBsdWdpbiAoIGVsZW1lbnQsIHVzZXJPcHRpb25zICkgewogICAgdGhpcy5fZWxlbWVudCAgID0gJChlbGVtZW50KTsKICAgIHRoaXMuX3NldHRpbmdzICA9ICQuZXh0ZW5kKCB7fSwgZGVmYXVsdHMsIHVzZXJPcHRpb25zKTsKICAgIHRoaXMuX2RlZmF1bHRzICA9IHRoaXMuX3NldHRpbmdzOwogICAgdGhpcy5fdHJpZ2dlcnMgID0gdGhpcy5fZWxlbWVudC5maW5kKCcudGFiYnktdHJpZ2dlcicpOwogICAgdGhpcy5fYWN0aXZlVGFiID0gdGhpcy5fZWxlbWVudC5maW5kKCcudGFiYnktdGFiLmFjdGl2ZScpOwogICAgdGhpcy5pbml0KCk7CiAgfQoKICAkLmV4dGVuZCggUGx1Z2luLnByb3RvdHlwZSwgewoKICAgIGluaXQ6IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5zZXRHcm91cCgpOwogICAgICB0aGlzLnNob3dBY3RpdmVUYWIoIHRoaXMuX2FjdGl2ZVRhYiwgdGhpcy5fZGVmYXVsdHMgKTsKICAgICAgdGhpcy50b2dnbGVUYWIoKTsKICAgICAgdGhpcy5zZXRBY2Nlc3NpYmlsaXR5KCk7CiAgICAgIHRoaXMuaGFzSGFzaCgpOwogICAgICB0aGlzLmtleWJvYXJkTmF2KCk7CiAgICB9LAoKICAgIC8vIFNldCBVSUQgdG8gZWFjaCBpbnN0YW5jZQogICAgc2V0R3JvdXA6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIFVJRCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOwoKICAgICAgdGhpcy5fZWxlbWVudC5hdHRyKCdkYXRhLXRhYmJ5LWdyb3VwJywgVUlEKTsKICAgIH0sCgogICAgc2hvd0FjdGl2ZVRhYjogZnVuY3Rpb24gKCBhY3RpdmVUYWIsIHNldHRpbmdzICkgewogICAgICB2YXIgJGNvbnRhaW5lciAgPSBhY3RpdmVUYWIucGFyZW50KCksCgogICAgICAgICAgLy8gRmluZCBhbGwgdGFicwogICAgICAgICAgJHRhYnMgICAgICAgPSAkY29udGFpbmVyLmZpbmQoJy50YWJieS10YWInKSwKCiAgICAgICAgICAvLyBHZXQgdGhlIGhlaWdodCBvZiBzZWxlY3RlZCB0YWIKICAgICAgICAgIGhlaWdodCAgICAgID0gYWN0aXZlVGFiLmlubmVySGVpZ2h0KCksCgogICAgICAgICAgLy8gR2V0IHNwZWVkIHZhbHVlCiAgICAgICAgICBzcGVlZCAgICAgICA9IHNldHRpbmdzLnNwZWVkOwoKICAgICAgaWYgKCBzdXBwb3J0VHJhbnNpdGlvbigpICkgewogICAgICAgIFBsdWdpbi5wcm90b3R5cGUuc2V0VGFiYnlTcGVlZCggJGNvbnRhaW5lciwgJHRhYnMsIHNwZWVkICk7CiAgICAgICAgJGNvbnRhaW5lci5jc3MoJ2hlaWdodCcsIGhlaWdodCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgJGNvbnRhaW5lci5hbmltYXRlKHsKICAgICAgICAgICdoZWlnaHQnOiBoZWlnaHQgKyAncHgnCiAgICAgICAgfSwgc3BlZWQpOwogICAgICB9CgogICAgICBhY3RpdmVUYWIuc2libGluZ3MoKQogICAgICAgIC5yZW1vdmVDbGFzcyggX2NsYXNzLnRhYkFjdGl2ZSArICcgJyArIF9jbGFzcy50YWJSZWFkeSApCiAgICAgICAgLmF0dHIoJ2FyaWEtaGlkZGVuJywgJ3RydWUnKTsKCiAgICAgIGFjdGl2ZVRhYgogICAgICAgIC5hZGRDbGFzcyggX2NsYXNzLnRhYkFjdGl2ZSArICcgJyArIF9jbGFzcy50YWJSZWFkeSApCiAgICAgICAgLnJlbW92ZUF0dHIoJ2FyaWEtaGlkZGVuJyk7CgogICAgICBpZiAoICQuaXNGdW5jdGlvbiggc2V0dGluZ3MuY29tcGxldGUgKSApIHsKICAgICAgICB2YXIgdHJhbnNpdGlvbkNvbXBsZXRlID0gc2V0VGltZW91dCggc2V0dGluZ3MuY29tcGxldGUsIHNldHRpbmdzLnNwZWVkICk7CiAgICAgIH0KICAgIH0sCgogICAgdG9nZ2xlVGFiOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBzZXR0aW5ncyA9IHRoaXMuX2RlZmF1bHRzOwoKICAgICAgdGhpcy5fdHJpZ2dlcnMuY2xpY2soIGZ1bmN0aW9uICggZXZlbnQgKSB7CiAgICAgICAgdmFyICR0aGlzICAgPSAkKHRoaXMpOwoKICAgICAgICBpZiAoICR0aGlzLmhhc0NsYXNzKCBfY2xhc3MudHJpZ2dlckFjdGl2ZSApICkgewogICAgICAgICAgcmV0dXJuIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgfQoKICAgICAgICB2YXIgdGFyZ2V0ICA9ICR0aGlzLmF0dHIoJ2hyZWYnKSwKICAgICAgICAgICAgJHRhcmdldCA9ICQodGFyZ2V0KTsKCiAgICAgICAgaWYgKCAhJHRhcmdldC5sZW5ndGggKSByZXR1cm47CgogICAgICAgICR0aGlzLnNpYmxpbmdzKCc6bm90KC4nICsgX2NsYXNzLmV4Y2x1ZGUgKyAnKScpCiAgICAgICAgICAucmVtb3ZlQ2xhc3MoIF9jbGFzcy50cmlnZ2VyQWN0aXZlICkKICAgICAgICAgIC5hdHRyKCd0YWJpbmRleCcsICctMScpCiAgICAgICAgICAucmVtb3ZlQXR0cignYXJpYS1zZWxlY3RlZCcpOwoKICAgICAgICAkdGhpcwogICAgICAgICAgLmFkZENsYXNzKCBfY2xhc3MudHJpZ2dlckFjdGl2ZSApCiAgICAgICAgICAuYXR0cih7CiAgICAgICAgICAgICd0YWJpbmRleCc6ICcwJywKICAgICAgICAgICAgJ2FyaWEtc2VsZWN0ZWQnOiAndHJ1ZScKICAgICAgICAgIH0pOwoKICAgICAgICBQbHVnaW4ucHJvdG90eXBlLnNob3dBY3RpdmVUYWIoICR0YXJnZXQsIHNldHRpbmdzICk7CgogICAgICAgIGlmICggIXNldHRpbmdzLmhhc2hDaGFuZ2UgKSByZXR1cm4gZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgfSk7CiAgICB9LAoKICAgIC8vIGh0dHA6Ly9nb28uZ2wvM2pEZGNGCiAgICBzZXRBY2Nlc3NpYmlsaXR5OiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciAkdHJpZ2dlcnNXcmFwcGVyICA9IHRoaXMuX2VsZW1lbnQuZmluZCgnLnRhYmJ5LXRyaWdnZXJzJyksCiAgICAgICAgICAkdHJpZ2dlcnMgICAgICAgICA9IHRoaXMuX2VsZW1lbnQuZmluZCgnLnRhYmJ5LXRyaWdnZXI6bm90KC4nICsgX2NsYXNzLmV4Y2x1ZGUgKyAnKScpLAogICAgICAgICAgJHRhYnMgICAgICAgICAgICAgPSB0aGlzLl9lbGVtZW50LmZpbmQoJy50YWJieS10YWInKTsKCiAgICAgICR0cmlnZ2Vyc1dyYXBwZXIuYXR0cigncm9sZScsICd0YWJsaXN0Jyk7CiAgICAgIAogICAgICAkdHJpZ2dlcnMuZWFjaChmdW5jdGlvbihpbmRleCwgZWwpIHsKICAgICAgICB2YXIgJHRoaXMgICAgID0gJChlbCksCiAgICAgICAgICAgIGhyZWYgICAgICA9ICR0aGlzLmF0dHIoJ2hyZWYnKSwKICAgICAgICAgICAgY29udHJvbHMgID0gaHJlZi5zdWJzdHJpbmcoMSwgaHJlZi5sZW5ndGgpOwoKICAgICAgICAkdGhpcy5hdHRyKHsKICAgICAgICAgICdyb2xlJzogJ3RhYicsCiAgICAgICAgICAnYXJpYS1jb250cm9scyc6IGNvbnRyb2xzLAogICAgICAgICAgJ3RhYmluZGV4JzogJy0xJwogICAgICAgIH0pOwoKICAgICAgICBpZiAoICR0aGlzLmhhc0NsYXNzKCBfY2xhc3MudHJpZ2dlckFjdGl2ZSApICkgewogICAgICAgICAgJHRoaXMuYXR0cih7CiAgICAgICAgICAgICdhcmlhLXNlbGVjdGVkJzogJ3RydWUnLAogICAgICAgICAgICAndGFiaW5kZXgnOiAnMCcKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSk7CgogICAgICAkdGFicy5lYWNoKGZ1bmN0aW9uKGluZGV4LCBlbCkgewogICAgICAgIHZhciAkdGhpcyA9ICQoZWwpOwoKICAgICAgICAkdGhpcy5hdHRyKCdyb2xlJywgJ3RhYnBhbmVsJyk7CgogICAgICAgIGlmICggISR0aGlzLmhhc0NsYXNzKCBfY2xhc3MudGFiQWN0aXZlICkgKSB7CiAgICAgICAgICAkdGhpcy5hdHRyKCdhcmlhLWhpZGRlbicsICd0cnVlJyk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCgogICAgaGFzSGFzaDogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX2hhc2ggICAgID0gd2luZG93LmxvY2F0aW9uLmhhc2gsCiAgICAgICAgICBzZXR0aW5ncyAgPSB0aGlzLl9kZWZhdWx0czsKCiAgICAgIGlmICggIXNldHRpbmdzLmhhc2hDaGFuZ2UgfHwgX2hhc2ggPT09ICcnICkgcmV0dXJuOwoKICAgICAgdmFyIHNob3dUYWJCeUhhc2ggPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGlkICAgICAgICA9IHdpbmRvdy5sb2NhdGlvbi5oYXNoLAogICAgICAgICAgICAkdGFyZ2V0ICAgPSAkKGlkKSwKICAgICAgICAgICAgJHRyaWdnZXIgID0gJCgnLnRhYmJ5LXRyaWdnZXJbaHJlZj0iJyArIGlkICsgJyJdJyk7CgogICAgICAgICR0cmlnZ2VyLnRyaWdnZXIoJ2NsaWNrJykuZm9jdXMoKTsKICAgICAgfTsKCiAgICAgIHNob3dUYWJCeUhhc2goKTsKCiAgICAgIHdpbmRvdy5vbmhhc2hjaGFuZ2UgPSBzaG93VGFiQnlIYXNoOwogICAgfSwKCiAgICBrZXlib2FyZE5hdjogZnVuY3Rpb24gKCkgewogICAgICB2YXIgZWxlbWVudCAgICAgICA9IHRoaXMuX2VsZW1lbnQsCiAgICAgICAgICBpc0hhc2hDaGFuZ2UgID0gdGhpcy5fZGVmYXVsdHMuaGFzaENoYW5nZTsKCiAgICAgIHZhciBjeWNsZVRhYmJ5TmF2ID0gZnVuY3Rpb24gKCBldmVudCApIHsKICAgICAgICB2YXIgJGFjdGl2ZUVsZW0gPSBlbGVtZW50LmZpbmQoJy50YWJieS10cmlnZ2VyOmZvY3VzOm5vdCguJyArIF9jbGFzcy5leGNsdWRlICsgJyknKTsKCiAgICAgICAgaWYgKCAhJGFjdGl2ZUVsZW0ubGVuZ3RoICkgcmV0dXJuOwoKICAgICAgICB2YXIgcHJldiAgICA9ICRhY3RpdmVFbGVtLnByZXYoKSwKICAgICAgICAgICAgbmV4dCAgICA9ICRhY3RpdmVFbGVtLm5leHQoKSwKCiAgICAgICAgICAgIGhhc1ByZXYgPSBwcmV2Lmxlbmd0aCwKICAgICAgICAgICAgaGFzTmV4dCA9IG5leHQubGVuZ3RoOwoKICAgICAgICB2YXIgZ290b05hdiA9IGZ1bmN0aW9uICggcG9zaXRpb24gKSB7CgogICAgICAgICAgaWYgKCBwb3NpdGlvbi5oYXNDbGFzcyggX2NsYXNzLmV4Y2x1ZGUgKSApIHJldHVybjsKCiAgICAgICAgICBwb3NpdGlvbi50cmlnZ2VyKCdjbGljaycpLmZvY3VzKCk7CgogICAgICAgICAgaWYgKCBpc0hhc2hDaGFuZ2UgKSB7CiAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5oYXNoID0gcG9zaXRpb24uYXR0cignaHJlZicpOwogICAgICAgICAgfQoKICAgICAgICB9OwoKICAgICAgICBpZiAoIGV2ZW50LmtleUNvZGUgPT09IFJJR0hUX0FSUk9XICYmIGhhc05leHQgKSB7CiAgICAgICAgICBnb3RvTmF2KCBuZXh0ICk7CiAgICAgICAgfSBlbHNlIGlmICggZXZlbnQua2V5Q29kZSA9PT0gTEVGVF9BUlJPVyAmJiBoYXNQcmV2ICkgewogICAgICAgICAgZ290b05hdiggcHJldiApOwogICAgICAgIH0KICAgICAgfTsKCiAgICAgICQoZG9jdW1lbnQpLmtleWRvd24oIGN5Y2xlVGFiYnlOYXYgKTsKICAgIH0sCgogICAgc2V0VGFiYnlTcGVlZDogZnVuY3Rpb24gKCBjb250YWluZXIsIHRhYnMsIGR1cmF0aW9uICkgewogICAgICB2YXIgc3BlZWQgPSBkdXJhdGlvbiArICdtcyc7CgogICAgICBjb250YWluZXIuY3NzKCd0cmFuc2l0aW9uLWR1cmF0aW9uJywgc3BlZWQpOwogICAgICB0YWJzLmNzcygndHJhbnNpdGlvbi1kZWxheScsIHNwZWVkKTsKICAgIH0KCiAgfSk7CgogIC8vIGh0dHA6Ly9nb28uZ2wvYmtNckFWCiAgZnVuY3Rpb24gc3VwcG9ydFRyYW5zaXRpb24oKSB7CiAgICByZXR1cm4gKAogICAgICAnV2Via2l0VHJhbnNpdGlvbicgaW4gZG9jdW1lbnQuYm9keS5zdHlsZSB8fAogICAgICAnTW96VHJhbnNpdGlvbicgaW4gZG9jdW1lbnQuYm9keS5zdHlsZSB8fAogICAgICAnT1RyYW5zaXRpb24nIGluIGRvY3VtZW50LmJvZHkuc3R5bGUgfHwKICAgICAgJ3RyYW5zaXRpb24nIGluIGRvY3VtZW50LmJvZHkuc3R5bGUKICAgICk7CiAgfQoKICAkLmZuLnRhYmJ5ID0gZnVuY3Rpb24gKCB1c2VyT3B0aW9ucyApIHsKCiAgICBpZiAoICF0aGlzLmxlbmd0aCApIHJldHVybjsKCiAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgbmV3IFBsdWdpbiggdGhpcywgdXNlck9wdGlvbnMgKTsKICAgIH0pOwogIH07Cgp9KSggalF1ZXJ5LCB3aW5kb3csIGRvY3VtZW50ICk7",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Sat, 08 Nov 2014 15:17:09 GMT",
                    "Content-Length": "6210",
                    "Date": "Sat, 08 Nov 2014 15:17:09 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}