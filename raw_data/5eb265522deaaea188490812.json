{
    "url": "http://localhost:9999/glassesfactory/kazitori.js/example/assets/js/kazitori.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Open redirection (DOM-based)",
    "issueType": 5243152,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based open redirection vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the target of a redirection in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause a redirection to an arbitrary external domain. This behavior can be leveraged to facilitate phishing attacks against users of the application. The ability to use an authentic application URL, targeting the correct domain with a valid SSL certificate (if SSL is used) lends credibility to the phishing attack because many users, even if they verify these features, will not notice the subsequent redirection to a different domain.<br><br><b>Note:</b> If an attacker is able to control the start of the string that is passed to the redirection API, then it may be possible to escalate this vulnerability into a JavaScript injection attack, by using a URL with the javascript: pseudo-protocol to execute arbitrary script code when the URL is processed by the browser.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based open redirection vulnerabilities is not to dynamically set redirection targets using data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing an arbitrary URL as a redirection target. In general, this is best achieved by using a whitelist of URLs that are permitted redirection targets, and strictly validating the target against this list before performing the redirection.",
    "issueDetail": "The application may be vulnerable to DOM-based open redirection. Data is read from <b>location.href</b> and written to <b>location.replace()</b> via the following statements:<ul><li>href = location.href.replace(/(javascript:|#).*$/, '');</li><li>location.replace(href + '#' + fragment);</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/glassesfactory/kazitori.js/example/assets/js/kazitori.js",
                "path": "/glassesfactory/kazitori.js/example/assets/js/kazitori.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9nbGFzc2VzZmFjdG9yeS9rYXppdG9yaS5qcy9leGFtcGxlL2Fzc2V0cy9qcy9rYXppdG9yaS5qcyBIVFRQLzEuMQ0KSG9zdDogbG9jYWxob3N0Ojk5OTkNCg0K",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogNTEwMjANCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IEZyaSwgMDcgTm92IDIwMTQgMDc6NTc6NTggR01UDQpMYXN0LU1vZGlmaWVkOiBGcmksIDA3IE5vdiAyMDE0IDA3OjU3OjU4IEdNVA0KDQp2YXIgRGVmZmVyZWQsIEV2ZW50RGlzcGF0Y2hlciwgS2F6aXRvcmksIEtheml0b3JpRXZlbnQsIFJ1bGUsIFZBUklBQkxFX1RZUEVTLCBkZWxlZ2F0ZXIsIGVzY2FwZVJlZ0V4cCwgZ2VuZXJpY1BhcmFtLCBuYW1lZFBhcmFtLCBvcHRpb25hbFBhcmFtLCByb3V0ZVN0cmlwcGVyLCBzcGxhdFBhcmFtLCB0cmFpbGluZ1NsYXNoLAogIF9fYmluZCA9IGZ1bmN0aW9uKGZuLCBtZSl7IHJldHVybiBmdW5jdGlvbigpeyByZXR1cm4gZm4uYXBwbHkobWUsIGFyZ3VtZW50cyk7IH07IH0sCiAgX19pbmRleE9mID0gW10uaW5kZXhPZiB8fCBmdW5jdGlvbihpdGVtKSB7IGZvciAodmFyIGkgPSAwLCBsID0gdGhpcy5sZW5ndGg7IGkgPCBsOyBpKyspIHsgaWYgKGkgaW4gdGhpcyAmJiB0aGlzW2ldID09PSBpdGVtKSByZXR1cm4gaTsgfSByZXR1cm4gLTE7IH0sCiAgX19zbGljZSA9IFtdLnNsaWNlLAogIF9faGFzUHJvcCA9IHt9Lmhhc093blByb3BlcnR5LAogIF9fZXh0ZW5kcyA9IGZ1bmN0aW9uKGNoaWxkLCBwYXJlbnQpIHsgZm9yICh2YXIga2V5IGluIHBhcmVudCkgeyBpZiAoX19oYXNQcm9wLmNhbGwocGFyZW50LCBrZXkpKSBjaGlsZFtrZXldID0gcGFyZW50W2tleV07IH0gZnVuY3Rpb24gY3RvcigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGNoaWxkOyB9IGN0b3IucHJvdG90eXBlID0gcGFyZW50LnByb3RvdHlwZTsgY2hpbGQucHJvdG90eXBlID0gbmV3IGN0b3IoKTsgY2hpbGQuX19zdXBlcl9fID0gcGFyZW50LnByb3RvdHlwZTsgcmV0dXJuIGNoaWxkOyB9OwoKZGVsZWdhdGVyID0gZnVuY3Rpb24odGFyZ2V0LCBmdW5jKSB7CiAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIGZ1bmMuYXBwbHkodGFyZ2V0LCBhcmd1bWVudHMpOwogIH07Cn07Cgp0cmFpbGluZ1NsYXNoID0gL1wvJC87Cgpyb3V0ZVN0cmlwcGVyID0gL15bI1wvXXxccyskL2c7Cgplc2NhcGVSZWdFeHAgPSAvW1wte31cW1xdKz8uLFxcXF4kfCNcc10vZzsKCm5hbWVkUGFyYW0gPSAvPChcdyt8W0EtWmEtel8tXSs6XHcrKT4vZzsKCmdlbmVyaWNQYXJhbSA9IC8oW0EtWmEtel8tXSspOihcdyspLzsKCm9wdGlvbmFsUGFyYW0gPSAvXCgoLio/KVwpL2c7CgpzcGxhdFBhcmFtID0gL1wqXHcrL2c7CgovKlVSTCDlpInmlbDjgavlr77jgZfjgabmjIflrprjgafjgY3jgovlnosqLwoKClZBUklBQkxFX1RZUEVTID0gWwogIHsKICAgIG5hbWU6ICJpbnQiLAogICAgY2FzdDogTnVtYmVyCiAgfSwgewogICAgbmFtZTogInN0cmluZyIsCiAgICBjYXN0OiBTdHJpbmcKICB9Cl07CgovKioKKiBLYXppdG9yaS5qcyDjga8gcHVzaFN0YXRlIOOCkuOBhOOBhOaEn+OBmOOBq+OBleOBsOOBhOOBpuOBj+OCjOOCi+ODq+ODvOOCv+ODvOODqeOCpOODluODqeODquOBp+OBmeOAgjxicj4KKiDjgrfjg7Pjg5fjg6vjgYvjgaTopovpgJrjgZfjgojjgY8gcHVzaFN0YXRlIOOCs+ODs+ODhuODs+ODhOOBruODq+ODvOODhuOCo+ODs+OCsOOCkuWumue+qeOBmeOCi+OBk+OBqOOBjOOBp+OBjeOBvuOBmeOAggoqCiog5L2/44GE5pa544Gv44Go44Gm44KC57Ch5Y2Y44CCCiogPHVsPjxsaT5LYXppdG9yaSDjgpLntpnmib/jgZfjgZ/jgq/jg6njgrnjgpLkvZzjgos8L2xpPjxsaT5yb3V0ZXMg44Gr5omx44GE44Gf44GEIFVSTCDjgajjgIHjgZ3jgozjgavlr77lv5zjgZfjgZ/jg6Hjgr3jg4Pjg4njgpLmjIflrprjgII8L2xpPjxsaT7jgqTjg7Pjgrnjgr/jg7PjgrnljJY8L2xpPjwvdWw+CioKKiA8aDQ+ZXhhbXBsZTwvaDQ+CiogICAgICBjbGFzcyBSb3V0ZXIgZXh0ZW5kcyBLYXppdG9yaQoqICAgICAgICByb3V0ZXM6CiogICAgICAgICAgIi8iOiAiaW5kZXgiCiogICAgICAgICAgIi88aW50OmlkPiI6ICJzaG93IgoqCiogICAgICAgIGluZGV4OigpLT4KKiAgICAgICAgICBjb25zb2xlLmxvZyAiaW5kZXghIgoqICAgICAgICBzaG93OihpZCktPgoqICAgICAgICAgIGNvbnNvbGUubG9nIGlkCioKKiAgICAgICQoKCktPgoqICAgICAgICBhcHAgPSBuZXcgUm91dGVyKCkKKiAgICAgICkKKgoqIEtheml0b3JpIOOBp+OBryBwdXNoU3RhdGUg44Gn6Z2e5ZCM5pyf44Kz44Oz44OG44Oz44OE44KS5L2c44Gj44Gm44GE44GP5LiK44Gn5b+F6KaB44Go44Gq44KL44Gn44GC44KN44GG5qmf6IO944KS5LuW44Gr44KC5rKi5bGx55So5oSP44GX44Gm44GE44G+44GZ44CCPGJyPgoqIOips+e0sOOBryBBUEkg5LiA6Kan44GL44KJ56K66KqN44GX44Gm5LiL44GV44GE44CCCiogQG1vZHVsZSBLYXppdG9yaS5qcwoqIEBtYWluIEtheml0b3JpCiovCgoKLyoqCiogIEtheml0b3JpIOOBruODoeOCpOODs+OCr+ODqeOCuQoqCiogIEBjbGFzcyBLYXppdG9yaQoqICBAY29uc3RydWN0b3IKKi8KCgpLYXppdG9yaSA9IChmdW5jdGlvbigpIHsKICBLYXppdG9yaS5wcm90b3R5cGUuVkVSU0lPTiA9ICIxLjAuMiI7CgogIEtheml0b3JpLnByb3RvdHlwZS5oaXN0b3J5ID0gbnVsbDsKCiAgS2F6aXRvcmkucHJvdG90eXBlLmxvY2F0aW9uID0gbnVsbDsKCiAgLyoqCiAgKiDjg57jg4Pjg4HjgZnjgotVUkzjga7jg6vjg7zjg6vjgajjgIHjgZ3jgozjgavlr77lv5zjgZnjgovlh6bnkIbjgpLlrprnvqnjgZfjgb7jgZnjgIIKICAqIDxoND5leGFtcGxlPC9oND4KICAqICAgICByb3V0ZXM6CiAgKiAgICAgICAnLyc6J2luZGV4JwogICogICAgICAgJy88aW50OmlkPic6J3Nob3cnCiAgKgogICogQHByb3BlcnR5IHJvdXRlcwogICogQHR5cGUgT2JqZWN0CiAgKiBAZGVmYXVsdCB7fQogICovCgoKICBLYXppdG9yaS5wcm90b3R5cGUucm91dGVzID0ge307CgogIEtheml0b3JpLnByb3RvdHlwZS5oYW5kbGVycyA9IFtdOwoKICAvKioKICAqIOODnuODg+ODgeOBl+OBnyBVUkwg44Gr5a++44GZ44KL5Yem55CG44KS6KGM44GG5YmN44Gr5a6f6KGM44GX44Gf44GE5Yem55CG44KS5a6a576p44GX44G+44GZ44CCCiAgKiBAcHJvcGVydHkgYmVmb3JlcwogICogQHR5cGUgT2JqZWN0CiAgKiBAZGVmYXVsdCB7fQogICovCgoKICBLYXppdG9yaS5wcm90b3R5cGUuYmVmb3JlcyA9IHt9OwoKICBLYXppdG9yaS5wcm90b3R5cGUuYmVmb3JlSGFuZGxlcnMgPSBbXTsKCiAgLyoqCiAgKiBVUkwg44GM5aSJ44KP44KL6Zqb44CB5LqL5YmN44Gr5a6f6KGM44GX44Gf44GE5Yem55CG44KS5a6a576p44GX44G+44GZ44CCPGJyPgogICog44GT44Gu44OX44Ot44OR44OG44Kj44Gr55m76Yyy44GV44KM44Gf5Yem55CG44Gv44CB5LiO44GI44KJ44KM44GfIFVSTCDjgavjg57jg4Pjg4HjgZnjgovjgYvjganjgYbjgYvjgavjgYvjgYvjgo/jgonjgZrjgIHluLjjgavlrp/ooYzjgZXjgozjgb7jgZnjgIIKICAqIEBwcm9wZXJ0eSBiZWZvcmVBbnl0aW1lSGFuZGxlcgogICogQHR5cGUgQXJyYXkKICAqIEBkZWZhdWx0IFtdCiAgKi8KCgogIEtheml0b3JpLnByb3RvdHlwZS5iZWZvcmVBbnl0aW1lSGFuZGxlciA9IG51bGw7CgogIEtheml0b3JpLnByb3RvdHlwZS5hZnRlcmhhbmRsZXJzID0gW107CgogIC8qKgogICog54m55a6a44Gu44OV44Kh44Kk44Or5ZCN44GMIFVSTCDjgavlkKvjgb7jgozjgabjgYTjgZ/mmYLjgIHjg6vjg7zjg4jjgajjgZfjgablh6bnkIbjgZnjgovjg6rjgrnjg4jjgafjgZnjgIIKICAqIEBwcm9wZXJ0eSByb290RmlsZXMKICAqIEB0eXBlIEFycmF5CiAgKi8KCgogIEtheml0b3JpLnByb3RvdHlwZS5yb290RmlsZXMgPSBbJ2luZGV4Lmh0bWwnLCAnaW5kZXguaHRtJywgJ2luZGV4LnBocCcsICd1bmtvLmh0bWwnXTsKCiAgLyoqCiAgKiDjg6vjg7zjg4jjgpLmjIflrprjgZfjgb7jgZnjgII8YnI+CiAgKiDjgZPjgZPjgafmjIflrprjgZXjgozjgZ/lgKTjgYwgVVJMIOOBriBwcmVmaXgg44Go44GX44Gm5b+F44Ga44Gk44GN44G+44GZ44CCPGJyPgogICog54mp55CG55qE44GrIFVSTCDjga7jg6vjg7zjg4jjgojjgoogMeODh+OCo+ODrOOCr+ODiOODquS4i+OBjOOBo+OBn+euh+aJgOOBpyBwdXNoU3RhdGUg44KS6KGM44GE44Gf44GE5aC05ZCIPGJyPgogICog44GT44Gu5YCk44KSIC8g5Lul5aSW44Gr5oyH5a6a44GX44G+44GZ44CCCiAgKiA8aDQ+ZXhhbXBsZTwvaDQ+CiAgKiDjgrPjg7Pjg4bjg7Pjg4TjgpLphY3nva7jgZnjgovlrp/jg4fjgqPjg6zjgq/jg4jjg6rjgYwgZXhhbXBsZSDjgaDjgaPjgZ/loLTlkIgKICAqCiAgKiAgICAgYXBwID0gbmV3IFJvdXRlcih7cm9vdDonL2V4YW1wbGUvJ30pCiAgKiBAcHJvcGVydHkgcm9vdAogICogQHR5cGUgU3RyaW5nCiAgKiBAZGVmYXVsdCAvCiAgKi8KCgogIEtheml0b3JpLnByb3RvdHlwZS5yb290ID0gbnVsbDsKCiAgLyoqCiAgKiDnj77lnKjjga4gVVJMIOOBq+ODnuODg+ODgeOBmeOCi+ODq+ODvOODq+OBjOOBquOBi+OBo+OBn+WgtOWQiOOBq+WkieabtOOBmeOCiyBVUkwKICAqIEBwcm9wZXJ0eSBub3RGb3VuZAogICogQHR5cGUgU3RyaW5nCiAgKiBAZGVmYXVsdCBudWxsCiAgKi8KCgogIEtheml0b3JpLnByb3RvdHlwZS5ub3RGb3VuZCA9IG51bGw7CgogIEtheml0b3JpLnByb3RvdHlwZS5kaXJlY3QgPSBudWxsOwoKICBLYXppdG9yaS5wcm90b3R5cGUuaXNJRSA9IGZhbHNlOwoKICAvKioKICAqIFVSTCDjgpLlrp/pmpvjgavjga/lpInmm7TjgZfjgarjgYTjgojjgYbjgavjgZnjgovjgYvjganjgYbjgYvjgpLmsbrlrprjgZfjgb7jgZnjgII8YnI+CiAgKiB0cnVlIOOBq+OBl+OBn+WgtOWQiOOAgVVSTCDjga/lpInmm7TjgZXjgozjgZrjgIHlhoXpg6jjgafkv53mjIHjgZfjgabjgYTjgovnirbmhYvnrqHnkIbjgqrjg5bjgrjjgqfjgq/jg4jjgpLln7rmupbjgavlsZXplovjgZfjgb7jgZnjgIIKICAqIEBwcm9wZXJ0eSBzaWxlbnQKICAqIEB0eXBlIEJvb2xlYW4KICAqIEBkZWZhdWx0IGZhbHNlCiAgKi8KCgogIEtheml0b3JpLnByb3RvdHlwZS5zaWxlbnQgPSBmYWxzZTsKCiAgLyoqCiAgKiBwdXNoU3RhdGUg44G444Gu55uj6KaW44GM6ZaL5aeL44GV44KM44Gm44GE44KL44GL44Gp44GG44GLCiAgKiBAcHJvcGVydHkgc3RhcnRlZAogICogQHR5cGUgQm9vbGVhbgogICogQGRlZmF1bHQgZmFsc2UKICAqLwoKCiAgS2F6aXRvcmkucHJvdG90eXBlLnN0YXJ0ZWQgPSBmYWxzZTsKCiAgS2F6aXRvcmkucHJvdG90eXBlLl9wYXJhbXMgPSB7CiAgICBwYXJhbXM6IFtdLAogICAgJ2ZyYWdtZW50JzogJycKICB9OwoKICAvKioKICAqIGJlZm9yZSDlh6bnkIbjgYzlpLHmlZfjgZfjgZ/mmYLjgavlrp/ooYzjgZXjgozjgb7jgZnjgII8YnI+CiAgKiDjg4fjg5Xjgqnjg6vjg4jjgafjga/nqbrjga4gZnVuY3Rpb24g44Gr44Gq44Gj44Gm44GE44G+44GZ44CCCiAgKgogICogQG1ldGhvZCBiZWZvcmVGYWlsZWRIYW5kbGVyCiAgKi8KCgogIEtheml0b3JpLnByb3RvdHlwZS5iZWZvcmVGYWlsZWRIYW5kbGVyID0gZnVuY3Rpb24oKSB7fTsKCiAgLyppc0JlZm9yZUZvcmNlKi8KCgogIEtheml0b3JpLnByb3RvdHlwZS5pc0JlZm9yZUZvcmNlID0gZmFsc2U7CgogIEtheml0b3JpLnByb3RvdHlwZS5pc1RlbWFlID0gZmFsc2U7CgogIEtheml0b3JpLnByb3RvdHlwZS5fY2hhbmdlT3B0aW9ucyA9IG51bGw7CgogIEtheml0b3JpLnByb3RvdHlwZS5pc05vdEZvdW5kRm9yY2UgPSBmYWxzZTsKCiAgS2F6aXRvcmkucHJvdG90eXBlLl9ub3RGb3VuZCA9IG51bGw7CgogIEtheml0b3JpLnByb3RvdHlwZS5icmVha2VyID0ge307CgogIEtheml0b3JpLnByb3RvdHlwZS5fZGlzcGF0Y2hlciA9IG51bGw7CgogIEtheml0b3JpLnByb3RvdHlwZS5fYmVmb3JlRGVmZmVyID0gbnVsbDsKCiAgLyoqCiAgKiDnj77lnKjjga4gVVJMIOOCkui/lOOBl+OBvuOBmeOAggogICogQHByb3BlcnR5IGZyYWdtZW50CiAgKiBAdHlwZSBTdHJpbmcKICAqIEBkZWZhdWx0IG51bGwKICAqLwoKCiAgS2F6aXRvcmkucHJvdG90eXBlLmZyYWdtZW50ID0gbnVsbDsKCiAgLyoqCiAgKiDnj77lnKjjga4gVVJMIOOBi+OCiSAx44Gk5YmN44GuIFVSTCDjgpLov5TjgZfjgb7jgZnjgIIKICAqIEBwcm9wZXJ0eSBsYXN0RnJhZ21lbnQKICAqIEB0eXBlIFN0cmluZwogICogQGRlZmF1bHQgbnVsbAogICovCgoKICBLYXppdG9yaS5wcm90b3R5cGUubGFzdEZyYWdtZW50ID0gbnVsbDsKCiAgS2F6aXRvcmkucHJvdG90eXBlLmlzVXNlckFjdGlvbiA9IGZhbHNlOwoKICBLYXppdG9yaS5wcm90b3R5cGUuX2lzRmlyc3RSZXF1ZXN0ID0gdHJ1ZTsKCiAgS2F6aXRvcmkucHJvdG90eXBlLmlzSW5pdFJlcGxhY2UgPSB0cnVlOwoKICBLYXppdG9yaS5wcm90b3R5cGUuaXNMYXN0U2xhc2ggPSBmYWxzZTsKCiAgLyoqCiAgKiDkuIDmmYLlgZzmraLjgZfjgabjgYTjgovjgYvjganjgYbjgYvjgpLov5TjgZfjgb7jgZnjgIIKICAqCiAgKiBAcHJvcGVydHkgaXNTdXNwZW5kCiAgKiBAdHlwZSBCb29sZWFuCiAgKiBAZGVmYXVsdCBmYWxzZQogICovCgoKICBLYXppdG9yaS5wcm90b3R5cGUuaXNTdXNwZW5kID0gZmFsc2U7CgogIEtheml0b3JpLnByb3RvdHlwZS5fcHJvY2Vzc1N0ZXAgPSB7CiAgICAnc3RhdHVzJzogJ251bGwnLAogICAgJ2FyZ3MnOiBbXQogIH07CgogIGZ1bmN0aW9uIEtheml0b3JpKG9wdGlvbnMpIHsKICAgIHRoaXMub2JzZXJ2ZVVSTEhhbmRsZXIgPSBfX2JpbmQodGhpcy5vYnNlcnZlVVJMSGFuZGxlciwgdGhpcyk7CiAgICB0aGlzLmJlZm9yZUZhaWxlZCA9IF9fYmluZCh0aGlzLmJlZm9yZUZhaWxlZCwgdGhpcyk7CiAgICB0aGlzLmV4ZWN1dGVIYW5kbGVycyA9IF9fYmluZCh0aGlzLmV4ZWN1dGVIYW5kbGVycywgdGhpcyk7CiAgICB0aGlzLl9leGVjdXRlQmVmb3JlcyA9IF9fYmluZCh0aGlzLl9leGVjdXRlQmVmb3JlcywgdGhpcyk7CiAgICB0aGlzLmJlZm9yZUNvbXBsZXRlID0gX19iaW5kKHRoaXMuYmVmb3JlQ29tcGxldGUsIHRoaXMpOwogICAgdmFyIGRvY01vZGUsIGUsIHdpbjsKICAgIHRoaXMuX3Byb2Nlc3NTdGVwLnN0YXR1cyA9ICdjb25zdHJ1Y3Rvcic7CiAgICB0aGlzLl9wcm9jZXNzU3RlcC5hcmdzID0gW29wdGlvbnNdOwogICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTsKICAgIGlmIChvcHRpb25zLnJvdXRlcykgewogICAgICB0aGlzLnJvdXRlcyA9IG9wdGlvbnMucm91dGVzOwogICAgfQogICAgdGhpcy5yb290ID0gb3B0aW9ucy5oYXNPd25Qcm9wZXJ0eSgicm9vdCIpID8gb3B0aW9ucy5yb290IDogdGhpcy5yb290ID09PSBudWxsID8gJy8nIDogdGhpcy5yb290OwogICAgdGhpcy5pc1RlbWFlID0gb3B0aW9ucy5pc1RlbWFlID8gb3B0aW9ucy5pc1RlbWFlIDogZmFsc2U7CiAgICB0aGlzLnNpbGVudCA9IG9wdGlvbnMuc2lsZW50ID8gb3B0aW9ucy5zaWxlbnQgOiBmYWxzZTsKICAgIHRoaXMuaXNJbml0UmVwbGFjZSA9IG9wdGlvbnMuaGFzT3duUHJvcGVydHkoImlzSW5pdFJlcGxhY2UiKSA/IG9wdGlvbnMuaXNJbml0UmVwbGFjZSA6IHRydWU7CiAgICB0aGlzLmlzTGFzdFNsYXNoID0gb3B0aW9ucy5oYXNPd25Qcm9wZXJ0eSgiaXNMYXN0U2xhc2giKSA/IG9wdGlvbnMuaXNMYXN0U2xhc2ggOiBmYWxzZTsKICAgIHRoaXMuX3BhcmFtcyA9IHsKICAgICAgcGFyYW1zOiBbXSwKICAgICAgcXVlcmllczoge30sCiAgICAgIGZyYWdtZW50OiBudWxsCiAgICB9OwogICAgaWYgKHRoaXMubm90Rm91bmQgPT09IG51bGwpIHsKICAgICAgdGhpcy5ub3RGb3VuZCA9IG9wdGlvbnMubm90Rm91bmQgPyBvcHRpb25zLm5vdEZvdW5kIDogdGhpcy5yb290OwogICAgfQogICAgd2luID0gd2luZG93OwogICAgaWYgKHR5cGVvZiB3aW4gIT09ICd1bmRlZmluZWQnKSB7CiAgICAgIHRoaXMubG9jYXRpb24gPSB3aW4ubG9jYXRpb247CiAgICAgIHRoaXMuaGlzdG9yeSA9IHdpbi5oaXN0b3J5OwogICAgfQogICAgZG9jTW9kZSA9IGRvY3VtZW50LmRvY3VtZW50TW9kZTsKICAgIHRoaXMuaXNJRSA9IHdpbi5uYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCkuaW5kZXhPZignbXNpZScpICE9PSAtMTsKICAgIHRoaXMuaXNPbGRJRSA9IHRoaXMuaXNJRSAmJiAoIWRvY01vZGUgfHwgZG9jTW9kZSA8IDkpOwogICAgdGhpcy5fZGlzcGF0Y2hlciA9IG5ldyBFdmVudERpc3BhdGNoZXIoKTsKICAgIHRoaXMuaGFuZGxlcnMgPSBbXTsKICAgIHRoaXMuYmVmb3JlSGFuZGxlcnMgPSBbXTsKICAgIHRoaXMuX2JpbmRCZWZvcmVzKCk7CiAgICB0aGlzLl9iaW5kUnVsZXMoKTsKICAgIHRoaXMuX2JpbmROb3RGb3VuZCgpOwogICAgdHJ5IHsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsICdwYXJhbXMnLCB7CiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuX3BhcmFtcy5wYXJhbXM7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsICdxdWVyaWVzJywgewogICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl9wYXJhbXMucXVlcmllczsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSBjYXRjaCAoX2Vycm9yKSB7CiAgICAgIGUgPSBfZXJyb3I7CiAgICAgIGlmICh0aGlzLmlzT2xkSUUpIHsKICAgICAgICB0aGlzLnBhcmFtcyA9IHRoaXMuX3BhcmFtcy5wYXJhbXM7CiAgICAgICAgdGhpcy5xdWVyaWVzID0gdGhpcy5fcGFyYW1zLnF1ZXJpZXM7CiAgICAgIH0KICAgIH0KICAgIGlmICgodGhpcy5vcHRpb25zLmlzQXV0b1N0YXJ0ID09IG51bGwpIHx8IHRoaXMub3B0aW9ucy5pc0F1dG9TdGFydCAhPT0gZmFsc2UpIHsKICAgICAgdGhpcy5zdGFydCgpOwogICAgfQogICAgcmV0dXJuOwogIH0KCiAgLyoqCiAgKiBLYXppdG9yaS5qcyDjgpLplovlp4vjgZfjgb7jgZnjgII8YnI+CiAgKiBTVEFSVCDjgqTjg5njg7Pjg4jjgYzjg4fjgqPjgrnjg5Hjg4Pjg4HjgZXjgozjgb7jgZnjgIIKICAqIEBtZXRob2Qgc3RhcnQKICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIOOCquODl+OCt+ODp+ODswogICovCgoKICBLYXppdG9yaS5wcm90b3R5cGUuc3RhcnQgPSBmdW5jdGlvbihvcHRpb25zKSB7CiAgICB2YXIgYXRSb290LCBmcmFnbWVudCwgZnJhbWUsIGllRnJhZywgb3ZlcnJpZGUsIHdpbjsKICAgIHRoaXMuX3Byb2Nlc3NTdGVwLnN0YXR1cyA9ICdzdGFydCc7CiAgICB0aGlzLl9wcm9jZXNzU3RlcC5hcmdzID0gW29wdGlvbnNdOwogICAgaWYgKHRoaXMuc3RhcnRlZCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ21vdSBoYXppbSBtYXR0ZXJ1Jyk7CiAgICB9CiAgICB0aGlzLnN0YXJ0ZWQgPSB0cnVlOwogICAgd2luID0gd2luZG93OwogICAgdGhpcy5vcHRpb25zID0gdGhpcy5fZXh0ZW5kKHt9LCB7CiAgICAgIHJvb3Q6ICcvJwogICAgfSwgdGhpcy5vcHRpb25zLCBvcHRpb25zKTsKICAgIHRoaXMuX2hhc1B1c2hTdGF0ZSA9ICEhKHRoaXMuaGlzdG9yeSAmJiB0aGlzLmhpc3RvcnkucHVzaFN0YXRlKTsKICAgIHRoaXMuX3dhbnRDaGFuZ2VIYXNoID0gdGhpcy5vcHRpb25zLmhhc2hDaGFuZ2UgIT09IGZhbHNlOwogICAgZnJhZ21lbnQgPSB0aGlzLmZyYWdtZW50ID0gdGhpcy5nZXRGcmFnbWVudCgpOwogICAgYXRSb290ID0gdGhpcy5sb2NhdGlvbi5wYXRobmFtZS5yZXBsYWNlKC9bXlwvXSQvLCAnJCYvJykgPT09IHRoaXMucm9vdDsKICAgIGlmICh0aGlzLmlzSUUgJiYgIWF0Um9vdCAmJiAhdGhpcy5faGFzUHVzaFN0YXRlICYmIHRoaXMuaXNJbml0UmVwbGFjZSkgewogICAgICBpZUZyYWcgPSB0aGlzLmxvY2F0aW9uLnBhdGhuYW1lLnJlcGxhY2UodGhpcy5yb290LCAnJyk7CiAgICAgIHRoaXMuX3VwZGF0ZUhhc2hJRShpZUZyYWcpOwogICAgfQogICAgaWYgKHRoaXMuaXNPbGRJRSAmJiB0aGlzLl93YW50Q2hhbmdlSGFzaCkgewogICAgICBmcmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImlmcmFtZSIpOwogICAgICBmcmFtZS5zZXRBdHRyaWJ1dGUoInNyYyIsICJqYXZhc2NyaXB0OjAiKTsKICAgICAgZnJhbWUuc2V0QXR0cmlidXRlKCJ0YWJpbmRleCIsICItMSIpOwogICAgICBmcmFtZS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGZyYW1lKTsKICAgICAgdGhpcy5pZnJhbWUgPSBmcmFtZS5jb250ZW50V2luZG93OwogICAgICB0aGlzLmNoYW5nZShmcmFnbWVudCk7CiAgICB9CiAgICB0aGlzLl9hZGRQb3BTdGF0ZUhhbmRsZXIoKTsKICAgIGlmICh0aGlzLl9oYXNQdXNoU3RhdGUgJiYgYXRSb290ICYmIHRoaXMubG9jYXRpb24uaGFzaCkgewogICAgICB0aGlzLmZyYWdtZW50ID0gdGhpcy5sYXN0RnJhZ21lbnQgPSB0aGlzLmdldEhhc2goKS5yZXBsYWNlKHJvdXRlU3RyaXBwZXIsICcnKTsKICAgICAgdGhpcy5oaXN0b3J5LnJlcGxhY2VTdGF0ZSh7fSwgZG9jdW1lbnQudGl0bGUsIHRoaXMucm9vdCArIHRoaXMuZnJhZ21lbnQgKyB0aGlzLmxvY2F0aW9uLnNlYXJjaCk7CiAgICB9CiAgICB0aGlzLl9kaXNwYXRjaGVyLmRpc3BhdGNoRXZlbnQobmV3IEtheml0b3JpRXZlbnQoS2F6aXRvcmlFdmVudC5TVEFSVCwgdGhpcy5mcmFnbWVudCkpOwogICAgb3ZlcnJpZGUgPSB0aGlzLnJvb3Q7CiAgICBpZiAoIXRoaXMuc2lsZW50KSB7CiAgICAgIGlmICghdGhpcy5faGFzUHVzaFN0YXRlICYmIGF0Um9vdCkgewogICAgICAgIG92ZXJyaWRlID0gdGhpcy5mcmFnbWVudDsKICAgICAgfSBlbHNlIGlmICghYXRSb290KSB7CiAgICAgICAgb3ZlcnJpZGUgPSB0aGlzLmZyYWdtZW50OwogICAgICB9CiAgICB9CiAgICByZXR1cm4gdGhpcy5sb2FkVVJMKG92ZXJyaWRlKTsKICB9OwoKICAvKioKICAqIEtheml0b3JpLmpzIOOCkuWBnOatouOBl+OBvuOBmeOAgjxicj4KICAqIFNUT1Ag44Kk44OZ44Oz44OI44GM44OH44Kj44K544OR44OD44OB44GV44KM44G+44GZ44CCCiAgKiBAbWV0aG9kIHN0b3AKICAqLwoKCiAgS2F6aXRvcmkucHJvdG90eXBlLnN0b3AgPSBmdW5jdGlvbigpIHsKICAgIHZhciB3aW47CiAgICB3aW4gPSB3aW5kb3c7CiAgICB3aW4ucmVtb3ZlRXZlbnRMaXN0ZW5lcigncG9wc3RhdGUnLCB0aGlzLm9ic2VydmVVUkxIYW5kbGVyKTsKICAgIHdpbi5yZW1vdmVFdmVudExpc3RlbmVyKCdoYXNoY2hhbmdlJywgdGhpcy5vYnNlcnZlVVJMSGFuZGxlcik7CiAgICB0aGlzLnN0YXJ0ZWQgPSBmYWxzZTsKICAgIHJldHVybiB0aGlzLl9kaXNwYXRjaGVyLmRpc3BhdGNoRXZlbnQobmV3IEtheml0b3JpRXZlbnQoS2F6aXRvcmlFdmVudC5TVE9QLCB0aGlzLmZyYWdtZW50KSk7CiAgfTsKCiAgLyoqCiAgKiDjg5bjg6njgqbjgrbjga7jg5Ljgrnjg4jjg6rjg7zmqZ/og73jgpLliKnnlKjjgZfjgabjgIzpgLLjgoDjgI3jgpLlrp/ooYzjgZfjgb7jgZnjgII8YnI+CiAgKiDmiJDlip/jgZfjgZ/loLTlkIggTkVYVCDjgqTjg5njg7Pjg4jjgYzjg4fjgqPjgrnjg5Hjg4Pjg4HjgZXjgozjgb7jgZnjgIIKICAqIEBtZXRob2QgdG9yaWthemkKICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zCiAgKi8KCgogIEtheml0b3JpLnByb3RvdHlwZS50b3Jpa2F6aSA9IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgIHJldHVybiB0aGlzLmRpcmVjdGlvbihvcHRpb25zLCAibmV4dCIpOwogIH07CgogIC8qKgogICog44OW44Op44Km44K244OS44K544OI44Oq44O85qmf6IO944KS5Yip55So44GX44Gm44CM5oi744KL44CN44KS5a6f6KGM44GX44G+44GZ44CCPGJyPgogICog5oiQ5Yqf44GX44Gf5aC05ZCIIFBSRVYg44Kk44OZ44Oz44OI44GM44OH44Kj44K544OR44OD44OB44GV44KM44G+44GZ44CCCiAgKiBAbWV0aG9kIG9tb2themkKICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zCiAgKi8KCgogIEtheml0b3JpLnByb3RvdHlwZS5vbW9rYXppID0gZnVuY3Rpb24ob3B0aW9ucykgewogICAgcmV0dXJuIHRoaXMuZGlyZWN0aW9uKG9wdGlvbnMsICJwcmV2Iik7CiAgfTsKCiAgS2F6aXRvcmkucHJvdG90eXBlLmRpcmVjdGlvbiA9IGZ1bmN0aW9uKG9wdGlvbiwgZGlyZWN0aW9uKSB7CiAgICB2YXIgdG1wRnJhZzsKICAgIGlmICghdGhpcy5zdGFydGVkKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHRtcEZyYWcgPSB0aGlzLmxhc3RGcmFnbWVudDsKICAgIHRoaXMubGFzdEZyYWdtZW50ID0gdGhpcy5nZXRGcmFnbWVudCgpOwogICAgdGhpcy5kaXJlY3QgPSBkaXJlY3Rpb247CiAgICB0aGlzLmlzVXNlckFjdGlvbiA9IHRydWU7CiAgICB0aGlzLl9yZW1vdmVQb3BTdGF0ZUhhbmRsZXIoKTsKICAgIGlmIChkaXJlY3Rpb24gPT09ICJwcmV2IikgewogICAgICB0aGlzLmhpc3RvcnkuYmFjaygpOwogICAgICB0aGlzLl9kaXNwYXRjaGVyLmRpc3BhdGNoRXZlbnQobmV3IEtheml0b3JpRXZlbnQoS2F6aXRvcmlFdmVudC5QUkVWLCB0bXBGcmFnLCB0aGlzLmxhc3RGcmFnbWVudCkpOwogICAgfSBlbHNlIGlmIChkaXJlY3Rpb24gPT09ICJuZXh0IikgewogICAgICB0aGlzLmhpc3RvcnkuZm9yd2FyZCgpOwogICAgICB0aGlzLl9kaXNwYXRjaGVyLmRpc3BhdGNoRXZlbnQobmV3IEtheml0b3JpRXZlbnQoS2F6aXRvcmlFdmVudC5ORVhULCB0bXBGcmFnLCB0aGlzLmxhc3RGcmFnbWVudCkpOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5fYWRkUG9wU3RhdGVIYW5kbGVyKCk7CiAgICByZXR1cm4gdGhpcy5sb2FkVVJMKHRtcEZyYWcpOwogIH07CgogIC8qKgogICogdXJsIOOCkuWkieabtOOBl+OBvuOBmeOAgjxicj4KICAqIOeEoeS6iyBVUkwg44GM5YiH44KK5pu/44KP44Gj44Gf5aC05ZCI44CBQ0hBTkdFIOOCpOODmeODs+ODiOOBjOODh+OCo+OCueODkeODg+ODgeOBleOCjOOBvuOBmeOAggogICogPGg0PmV4YW1wbGU8L2g0PgogICogICAgIGFwcC5jaGFuZ2UoJy9zb21ldXJsJyk7CiAgKiBAbWV0aG9kIGNoYW5nZQogICogQHBhcmFtIHtTdHJpbmd9IGZyYWdtZW50IOWkieabtOOBl+OBn+OBhCBVUkwKICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIOOCquODl+OCt+ODp+ODswogICovCgoKICBLYXppdG9yaS5wcm90b3R5cGUuY2hhbmdlID0gZnVuY3Rpb24oZnJhZ21lbnQsIG9wdGlvbnMpIHsKICAgIHZhciBmcmFnLCBtYXRjaGVkLCBuZXh0LCB1cmw7CiAgICBpZiAoIXRoaXMuc3RhcnRlZCkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICB0aGlzLl9wcm9jZXNzU3RlcC5zdGF0dXMgPSAnY2hhbmdlJzsKICAgIHRoaXMuX3Byb2Nlc3NTdGVwLmFyZ3MgPSBbZnJhZ21lbnQsIG9wdGlvbnNdOwogICAgaWYgKCFvcHRpb25zKSB7CiAgICAgIG9wdGlvbnMgPSB7CiAgICAgICAgJ3RyaWdnZXInOiBvcHRpb25zCiAgICAgIH07CiAgICB9CiAgICB0aGlzLl9jaGFuZ2VPcHRpb25zID0gb3B0aW9uczsKICAgIHRoaXMuaXNCZWZvcmVGb3JjZSA9IG9wdGlvbnMuaXNCZWZvcmVGb3JjZSAhPT0gZmFsc2U7CiAgICBmcmFnID0gdGhpcy5nZXRGcmFnbWVudChmcmFnbWVudCB8fCAnJyk7CiAgICBpZiAodGhpcy5mcmFnbWVudCA9PT0gZnJhZykgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLmxhc3RGcmFnbWVudCA9IHRoaXMuZnJhZ21lbnQ7CiAgICB0aGlzLmZyYWdtZW50ID0gZnJhZzsKICAgIG5leHQgPSB0aGlzLmZyYWdtZW50OwogICAgdXJsID0gdGhpcy5yb290ICsgdGhpcy5fcmVwbGFjZS5hcHBseShmcmFnLCBbcm91dGVTdHJpcHBlciwgJyddKTsKICAgIG1hdGNoZWQgPSB0aGlzLl9tYXRjaENoZWNrKHRoaXMuZnJhZ21lbnQsIHRoaXMuaGFuZGxlcnMpOwogICAgaWYgKG1hdGNoZWQgPT09IGZhbHNlICYmIHRoaXMuaXNOb3RGb3VuZEZvcmNlID09PSBmYWxzZSkgewogICAgICBpZiAodGhpcy5ub3RGb3VuZCAhPT0gbnVsbCkgewogICAgICAgIHRoaXMuX25vdEZvdW5kLmNhbGxiYWNrKHRoaXMuZnJhZ21lbnQpOwogICAgICAgIHVybCA9IHRoaXMucm9vdCArIHRoaXMuX25vdEZvdW5kLnJ1bGUucmVwbGFjZShyb3V0ZVN0cmlwcGVyLCAnJyk7CiAgICAgICAgdGhpcy5oaXN0b3J5W29wdGlvbnMucmVwbGFjZSA/ICdyZXBsYWNlU3RhdGUnIDogJ3B1c2hTdGF0ZSddKHt9LCBkb2N1bWVudC50aXRsZSwgdXJsKTsKICAgICAgfQogICAgICB0aGlzLl9kaXNwYXRjaGVyLmRpc3BhdGNoRXZlbnQobmV3IEtheml0b3JpRXZlbnQoS2F6aXRvcmlFdmVudC5OT1RfRk9VTkQpKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKHRoaXMuaXNUZW1hZSAmJiAodGhpcy5iZWZvcmVBbnl0aW1lSGFuZGxlciB8fCB0aGlzLmJlZm9yZUhhbmRsZXJzLmxlbmd0aCA+IDApKSB7CiAgICAgIHRoaXMuX2V4ZWN1dGVCZWZvcmVzKGZyYWcpOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5fdXJsQ2hhbmdlKGZyYWcsIG9wdGlvbnMpOwogICAgfQogIH07CgogIC8qKgogICogcHVzaFN0YXRlIOOBp+OBr+OBquOBjyByZXBsYWNlU3RhdGUg44Gn5Yem55CG44GX44G+44GZ44CCPGJyPgogICogcmVwbGFjZVN0YXRlIOOBr+ePvuWcqOOBriBVUkwg44KS572u44GN5o+b44GI44KL44Gf44KB44CB5bGl5q2044Gr44Gv6L+95Yqg44GV44KM44G+44Gb44KT44CCCiAgKiA8aDQ+ZXhhbXBsZTwvaDQ+CiAgKiAgICAgYXBwLnJlcGxhY2UoJy9zb21ldXJsJyk7CiAgKiBAbWV0aG9kIHJlcGxhY2UKICAqIEBwYXJhbSB7U3RyaW5nfSBmcmFnbWVudCDlpInmm7TjgZfjgZ/jgYQgVVJMCiAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyDjgqrjg5fjgrfjg6fjg7MKICAqLwoKCiAgS2F6aXRvcmkucHJvdG90eXBlLnJlcGxhY2UgPSBmdW5jdGlvbihmcmFnbWVudCwgb3B0aW9ucykgewogICAgdGhpcy5fcHJvY2Vzc1N0ZXAuc3RhdHVzID0gJ3JlcGxhY2UnOwogICAgdGhpcy5fcHJvY2Vzc1N0ZXAuYXJncyA9IFtmcmFnbWVudCwgb3B0aW9uc107CiAgICBpZiAoIW9wdGlvbnMpIHsKICAgICAgb3B0aW9ucyA9IHsKICAgICAgICByZXBsYWNlOiB0cnVlCiAgICAgIH07CiAgICB9IGVsc2UgaWYgKCFvcHRpb25zLnJlcGxhY2UgfHwgb3B0aW9ucy5yZXBsYWNlID09PSBmYWxzZSkgewogICAgICBvcHRpb25zLnJlcGxhY2UgPSB0cnVlOwogICAgfQogICAgdGhpcy5jaGFuZ2UoZnJhZ21lbnQsIG9wdGlvbnMpOwogIH07CgogIEtheml0b3JpLnByb3RvdHlwZS5fdXJsQ2hhbmdlID0gZnVuY3Rpb24oZnJhZ21lbnQsIG9wdGlvbnMpIHsKICAgIHZhciB1cmw7CiAgICB0aGlzLl9wcm9jZXNzU3RlcC5zdGF0dXMgPSAnX3VybENoYW5nZSc7CiAgICB0aGlzLl9wcm9jZXNzU3RlcC5hcmdzID0gW2ZyYWdtZW50LCBvcHRpb25zXTsKICAgIGlmICh0aGlzLmlzU3VzcGVuZCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoIW9wdGlvbnMpIHsKICAgICAgb3B0aW9ucyA9IHRoaXMuX2NoYW5nZU9wdGlvbnM7CiAgICB9CiAgICB1cmwgPSB0aGlzLnJvb3QgKyB0aGlzLmZyYWdtZW50LnJlcGxhY2Uocm91dGVTdHJpcHBlciwgJycpOwogICAgaWYgKHRoaXMuaXNMYXN0U2xhc2gpIHsKICAgICAgdXJsICs9ICIvIjsKICAgIH0KICAgIGlmICghdGhpcy5zaWxlbnQpIHsKICAgICAgaWYgKHRoaXMuX2hhc1B1c2hTdGF0ZSkgewogICAgICAgIHRoaXMuaGlzdG9yeVtvcHRpb25zLnJlcGxhY2UgPyAncmVwbGFjZVN0YXRlJyA6ICdwdXNoU3RhdGUnXSh7fSwgZG9jdW1lbnQudGl0bGUsIHVybCk7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5fd2FudENoYW5nZUhhc2gpIHsKICAgICAgICB0aGlzLl91cGRhdGVIYXNoKHRoaXMubG9jYXRpb24sIGZyYWdtZW50LCBvcHRpb25zLnJlcGxhY2UpOwogICAgICAgIGlmICh0aGlzLmlmcmFtZSAmJiAoZnJhZ21lbnQgIT09IHRoaXMuZ2V0RnJhZ21lbnQodGhpcy5nZXRIYXNoKHRoaXMuaWZyYW1lKSkpKSB7CiAgICAgICAgICBpZiAoIW9wdGlvbnMucmVwbGFjZSkgewogICAgICAgICAgICB0aGlzLmlmcmFtZS5kb2N1bWVudC5vcGVuKCkuY2xvc2UoKTsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuX3VwZGF0ZUhhc2godGhpcy5pZnJhbWUubG9jYXRpb24sIGZyYWdtZW50LCBvcHRpb25zLnJlcGxhY2UpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gdGhpcy5sb2NhdGlvbi5hc3NpZ24odXJsKTsKICAgICAgfQogICAgfQogICAgdGhpcy5kaXNwYXRjaEV2ZW50KG5ldyBLYXppdG9yaUV2ZW50KEtheml0b3JpRXZlbnQuQ0hBTkdFLCB0aGlzLmZyYWdtZW50LCB0aGlzLmxhc3RGcmFnbWVudCkpOwogICAgaWYgKG9wdGlvbnMuaW50ZXJuYWwgJiYgb3B0aW9ucy5pbnRlcm5hbCA9PT0gdHJ1ZSkgewogICAgICB0aGlzLl9kaXNwYXRjaGVyLmRpc3BhdGNoRXZlbnQobmV3IEtheml0b3JpRXZlbnQoS2F6aXRvcmlFdmVudC5JTlRFUk5BTF9DSEFOR0UsIHRoaXMuZnJhZ21lbnQsIHRoaXMubGFzdEZyYWdtZW50KSk7CiAgICB9CiAgICByZXR1cm4gdGhpcy5sb2FkVVJMKHRoaXMuZnJhZ21lbnQsIG9wdGlvbnMpOwogIH07CgogIC8qKgogICog5Lit5q2i44GX44G+44GZ44CCCiAgKiBAbWV0aG9kIHJlamVjdAogICovCgoKICBLYXppdG9yaS5wcm90b3R5cGUucmVqZWN0ID0gZnVuY3Rpb24oKSB7CiAgICB0aGlzLmRpc3BhdGNoRXZlbnQobmV3IEtheml0b3JpRXZlbnQoS2F6aXRvcmlFdmVudC5SRUpFQ1QsIHRoaXMuZnJhZ21lbnQpKTsKICAgIGlmICh0aGlzLl9iZWZvcmVEZWZmZXIpIHsKICAgICAgdGhpcy5fYmVmb3JlRGVmZmVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoS2F6aXRvcmlFdmVudC5UQVNLX1FVRVVFX0NPTVBMRVRFLCB0aGlzLmJlZm9yZUNvbXBsZXRlKTsKICAgICAgdGhpcy5fYmVmb3JlRGVmZmVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoS2F6aXRvcmlFdmVudC5UQVNLX1FVRVVFX0ZBSUxFRCwgdGhpcy5iZWZvcmVGYWlsZWQpOwogICAgICB0aGlzLl9iZWZvcmVEZWZmZXIgPSBudWxsOwogICAgfQogIH07CgogIC8qKgogICog5Yem55CG44KS5LiA5pmC5YGc5q2i44GX44G+44GZ44CCPGJyPgogICogU1VTUEVORCDjgqTjg5njg7Pjg4jjgYzjg4fjgqPjgrnjg5Hjg4Pjg4HjgZXjgozjgb7jgZnjgIIKICAqIEBtZXRob2Qgc3VzcGVuZAogICovCgoKICBLYXppdG9yaS5wcm90b3R5cGUuc3VzcGVuZCA9IGZ1bmN0aW9uKCkgewogICAgaWYgKHRoaXMuX2JlZm9yZURlZmZlciAhPSBudWxsKSB7CiAgICAgIHRoaXMuX2JlZm9yZURlZmZlci5zdXNwZW5kKCk7CiAgICB9CiAgICB0aGlzLnN0YXJ0ZWQgPSBmYWxzZTsKICAgIHRoaXMuaXNTdXNwZW5kID0gdHJ1ZTsKICAgIHRoaXMuX2Rpc3BhdGNoZXIuZGlzcGF0Y2hFdmVudChuZXcgS2F6aXRvcmlFdmVudChLYXppdG9yaUV2ZW50LlNVU1BFTkQsIHRoaXMuZnJhZ21lbnQsIHRoaXMubGFzdEZyYWdtZW50KSk7CiAgfTsKCiAgLyoqCiAgKiDlh6bnkIbjgpLlho3plovjgZfjgb7jgZnjgII8YnI+CiAgKiBSRVNVTUUg44Kk44OZ44Oz44OI44GM44OH44Kj44K544OR44OD44OB44GV44KM44G+44GZ44CCCiAgKiBAbWV0aG9kIHJlc3VtZQogICovCgoKICBLYXppdG9yaS5wcm90b3R5cGUucmVzdW1lID0gZnVuY3Rpb24oKSB7CiAgICBpZiAodGhpcy5fYmVmb3JlRGVmZmVyICE9IG51bGwpIHsKICAgICAgdGhpcy5fYmVmb3JlRGVmZmVyLnJlc3VtZSgpOwogICAgfQogICAgdGhpcy5zdGFydGVkID0gdHJ1ZTsKICAgIHRoaXMuaXNTdXNwZW5kID0gZmFsc2U7CiAgICB0aGlzW3RoaXMuX3Byb2Nlc3NTdGVwLnN0YXR1c10odGhpcy5fcHJvY2Vzc1N0ZXAuYXJncyk7CiAgICB0aGlzLl9kaXNwYXRjaGVyLmRpc3BhdGNoRXZlbnQobmV3IEtheml0b3JpRXZlbnQoS2F6aXRvcmlFdmVudC5SRVNVTUUsIHRoaXMuZnJhZ21lbnQsIHRoaXMubGFzdEZyYWdtZW50KSk7CiAgfTsKCiAgS2F6aXRvcmkucHJvdG90eXBlLnJlZ2lzdGVySGFuZGxlciA9IGZ1bmN0aW9uKHJ1bGUsIG5hbWUsIGlzQmVmb3JlLCBjYWxsYmFjaykgewogICAgdmFyIGNoaWxkLCBlLCB0YXJnZXQ7CiAgICBpZiAoIWNhbGxiYWNrKSB7CiAgICAgIGlmIChpc0JlZm9yZSkgewogICAgICAgIGNhbGxiYWNrID0gdGhpcy5fYmluZEZ1bmN0aW9ucyhuYW1lKTsKICAgICAgfSBlbHNlIGlmIChuYW1lIGluc3RhbmNlb2YgS2F6aXRvcmkpIHsKICAgICAgICB0aGlzLl9iaW5kQ2hpbGQocnVsZSwgbmFtZSk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIG5hbWUgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICBpZiAobmFtZS5oYXNPd25Qcm9wZXJ0eSgnX19zdXBlcl9fJykpIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGNoaWxkID0gbmV3IG5hbWUoewogICAgICAgICAgICAgICdpc0F1dG9TdGFydCc6IGZhbHNlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0aGlzLl9iaW5kQ2hpbGQocnVsZSwgY2hpbGQpOwogICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgIH0gY2F0Y2ggKF9lcnJvcikgewogICAgICAgICAgICBlID0gX2Vycm9yOwogICAgICAgICAgICBjYWxsYmFjayA9IG5hbWU7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNhbGxiYWNrID0gbmFtZTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY2FsbGJhY2sgPSB0aGlzW25hbWVdOwogICAgICB9CiAgICB9CiAgICB0YXJnZXQgPSBpc0JlZm9yZSA/IHRoaXMuYmVmb3JlSGFuZGxlcnMgOiB0aGlzLmhhbmRsZXJzOwogICAgdGFyZ2V0LnVuc2hpZnQobmV3IFJ1bGUocnVsZSwgZnVuY3Rpb24oZnJhZ21lbnQpIHsKICAgICAgdmFyIGFyZ3M7CiAgICAgIGFyZ3MgPSB0aGlzLnJvdXRlci5leHRyYWN0UGFyYW1zKHRoaXMsIGZyYWdtZW50KTsKICAgICAgcmV0dXJuIGNhbGxiYWNrICYmIGNhbGxiYWNrLmFwcGx5KHRoaXMucm91dGVyLCBhcmdzKTsKICAgIH0sIHRoaXMpKTsKICAgIHJldHVybiB0aGlzOwogIH07CgogIEtheml0b3JpLnByb3RvdHlwZS5fYmluZENoaWxkID0gZnVuY3Rpb24ocnVsZSwgY2hpbGQpIHsKICAgIHZhciBjaGlsZEJlZm9yZSwgY2hpbGRCZWZvcmVzLCBjaGlsZEhhbmRsZXJzLCBjaGlsZFJ1bGUsIF9pLCBfaiwgX2xlbiwgX2xlbjE7CiAgICBjaGlsZC5yZWplY3QoKTsKICAgIGNoaWxkLnN0b3AoKTsKICAgIGNoaWxkSGFuZGxlcnMgPSBjaGlsZC5oYW5kbGVycy5jb25jYXQoKTsKICAgIGZvciAoX2kgPSAwLCBfbGVuID0gY2hpbGRIYW5kbGVycy5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykgewogICAgICBjaGlsZFJ1bGUgPSBjaGlsZEhhbmRsZXJzW19pXTsKICAgICAgY2hpbGRSdWxlLnVwZGF0ZShydWxlKTsKICAgIH0KICAgIHRoaXMuaGFuZGxlcnMgPSBjaGlsZEhhbmRsZXJzLmNvbmNhdCh0aGlzLmhhbmRsZXJzKTsKICAgIGNoaWxkQmVmb3JlcyA9IGNoaWxkLmJlZm9yZUhhbmRsZXJzLmNvbmNhdCgpOwogICAgZm9yIChfaiA9IDAsIF9sZW4xID0gY2hpbGRCZWZvcmVzLmxlbmd0aDsgX2ogPCBfbGVuMTsgX2orKykgewogICAgICBjaGlsZEJlZm9yZSA9IGNoaWxkQmVmb3Jlc1tfal07CiAgICAgIGNoaWxkQmVmb3JlLnVwZGF0ZShydWxlKTsKICAgIH0KICAgIHRoaXMuYmVmb3JlSGFuZGxlcnMgPSBjaGlsZEJlZm9yZXMuY29uY2F0KHRoaXMuYmVmb3JlSGFuZGxlcnMpOwogICAgaWYgKGNoaWxkLmJlZm9yZUFueXRpbWVIYW5kbGVyKSB7CiAgICAgIHRoaXMubGFzdEFueXRpbWUgPSB0aGlzLmJlZm9yZUFueXRpbWUuY29uY2F0KCk7CiAgICAgIHJldHVybiB0aGlzLl9iaW5kQmVmb3JlQW55dGltZSh0aGlzLmJlZm9yZUFueXRpbWUsIFtjaGlsZC5iZWZvcmVBbnl0aW1lSGFuZGxlci5jYWxsYmFja10pOwogICAgfQogIH07CgogIC8qKgogICog44Or44O844K/44O844KS5YuV55qE44Gr6L+95Yqg44GX44G+44GZ44CCPGJyPgogICog44Or44O844K/44O844Gu6L+95Yqg44Gr5oiQ5Yqf44GX44Gf5aC05ZCI44CBQURERUQg44Kk44OZ44Oz44OI44GM44OH44Kj44K544OR44OD44OB44GV44KM44G+44GZ44CCCiAgKiA8aDQ+ZXhhbXBsZTwvaDQ+CiAgKiAgICAgZm9vUm91dGVyID0gbmV3IEZvb1JvdXRlcigpOwogICogICAgIGFwcC5hcHBlbmRSb3V0ZXIoZm9vKTsKICAqIEBtZXRob2QgYXBwZW5kUm91dGVyCiAgKiBAcGFyYW0ge09iamVjdH0gY2hpbGQKICAqIEBwYXJhbSB7U3RyaW5nfSBjaGlsZFJvb3QKICAqLwoKCiAgS2F6aXRvcmkucHJvdG90eXBlLmFwcGVuZFJvdXRlciA9IGZ1bmN0aW9uKGNoaWxkLCBjaGlsZFJvb3QpIHsKICAgIHZhciBlLCBydWxlLCBfaW5zdGFuY2U7CiAgICBpZiAoIWNoaWxkIGluc3RhbmNlb2YgS2F6aXRvcmkgJiYgdHlwZW9mIGNoaWxkICE9PSAiZnVuY3Rpb24iKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigi5byV5pWw44Gu5YCk44GM5LiN5q2j44Gn44GZ44CCIOW8leaVsOOBqOOBl+OBpuS4juOBiOOCieOCjOOCi+OCquODluOCuOOCp+OCr+ODiOOBryBLYXppdG9yaSDjgpLntpnmib/jgZfjgabjgYTjgovlv4XopoHjgYzjgYLjgorjgb7jgZnjgIIiKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKGNoaWxkIGluc3RhbmNlb2YgS2F6aXRvcmkpIHsKICAgICAgcnVsZSA9IHRoaXMuX2dldENoaWxkUnVsZShjaGlsZCwgY2hpbGRSb290KTsKICAgICAgdGhpcy5fYmluZENoaWxkKHJ1bGUsIGNoaWxkKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9IGVsc2UgewogICAgICBpZiAoY2hpbGQuaGFzT3duUHJvcGVydHkoJ19fc3VwZXJfXycpKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIF9pbnN0YW5jZSA9IG5ldyBjaGlsZCh7CiAgICAgICAgICAgICdpc0F1dG9TdGFydCc6IGZhbHNlCiAgICAgICAgICB9KTsKICAgICAgICAgIHJ1bGUgPSB0aGlzLl9nZXRDaGlsZFJ1bGUoX2luc3RhbmNlLCBjaGlsZFJvb3QpOwogICAgICAgICAgdGhpcy5fYmluZENoaWxkKHJ1bGUsIF9pbnN0YW5jZSk7CiAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9IGNhdGNoIChfZXJyb3IpIHsKICAgICAgICAgIGUgPSBfZXJyb3I7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIuW8leaVsOOBruWApOOBjOS4jeato+OBp+OBmeOAgiDlvJXmlbDjgajjgZfjgabkuI7jgYjjgonjgozjgovjgqrjg5bjgrjjgqfjgq/jg4jjga8gS2F6aXRvcmkg44KS57aZ5om/44GX44Gm44GE44KL5b+F6KaB44GM44GC44KK44G+44GZ44CCIik7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICB0aGlzLl9kaXNwYXRjaGVyLmRpc3BhdGNoRXZlbnQobmV3IEtheml0b3JpRXZlbnQoS2F6aXRvcmlFdmVudC5BRERFRCwgdGhpcy5mcmFnbWVudCwgdGhpcy5sYXN0RnJhZ21lbnQpKTsKICAgIHJldHVybiB0aGlzOwogIH07CgogIEtheml0b3JpLnByb3RvdHlwZS5fZ2V0Q2hpbGRSdWxlID0gZnVuY3Rpb24oY2hpbGQsIGNoaWxkUm9vdCkgewogICAgdmFyIHJ1bGU7CiAgICBydWxlID0gY2hpbGQucm9vdDsKICAgIGlmIChjaGlsZFJvb3QpIHsKICAgICAgcnVsZSA9IGNoaWxkUm9vdDsKICAgIH0KICAgIGlmIChydWxlLm1hdGNoKHRyYWlsaW5nU2xhc2gpKSB7CiAgICAgIHJ1bGUgPSBydWxlLnJlcGxhY2UodHJhaWxpbmdTbGFzaCwgJycpOwogICAgfQogICAgaWYgKHJ1bGUgPT09IHRoaXMucm9vdCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIuOBi+OBtuOBo+OBpuOCiyIpOwogICAgfQogICAgcmV0dXJuIHJ1bGU7CiAgfTsKCiAgLyoqCiAgKiDli5XnmoTjgavov73liqDjgZfjgZ/jg6vjg7zjgr/jg7zjgpLliYrpmaTjgZfjgb7jgZnjgIIKICAqIOODq+ODvOOCv+ODvOOBruWJiumZpOOBq+aIkOWKn+OBl+OBn+WgtOWQiOOAgVJFTU9WRUQg44Kk44OZ44Oz44OI44GM44OH44Kj44K544OR44OD44OB44GV44KM44G+44GZ44CCCiAgKiA8aDQ+ZXhhbXBsZTwvaDQ+CiAgKiAgICAgZm9vID0gbmV3IEZvb1JvdXRlcigpOwogICogICAgIGFwcC5hcHBlbmRSb3V0ZXIoZm9vKTsKICAqICAgICBhcHAucmVtb3ZlUm91dGVyKGZvbyk7CiAgKiBAbWV0aG9kIHJlbW92ZVJvdXRlcgogICogQHBhcmFtIHtPYmplY3R9IGNoaWxkCiAgKiBAcGFyYW0ge1N0cmluZ30gY2hpbGRSb290CiAgKi8KCgogIEtheml0b3JpLnByb3RvdHlwZS5yZW1vdmVSb3V0ZXIgPSBmdW5jdGlvbihjaGlsZCwgY2hpbGRSb290KSB7CiAgICB2YXIgZSwgX2luc3RhbmNlOwogICAgaWYgKCFjaGlsZCBpbnN0YW5jZW9mIEtheml0b3JpICYmIHR5cGVvZiBjaGlsZCAhPT0gImZ1bmN0aW9uIikgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIuW8leaVsOOBruWApOOBjOS4jeato+OBp+OBmeOAgiDlvJXmlbDjgajjgZfjgabkuI7jgYjjgonjgozjgovjgqrjg5bjgrjjgqfjgq/jg4jjga8gS2F6aXRvcmkg44KS57aZ5om/44GX44Gm44GE44KL5b+F6KaB44GM44GC44KK44G+44GZ44CCIik7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmIChjaGlsZCBpbnN0YW5jZW9mIEtheml0b3JpKSB7CiAgICAgIHRoaXMuX3VuYmluZENoaWxkKGNoaWxkLCBjaGlsZFJvb3QpOwogICAgfSBlbHNlIHsKICAgICAgaWYgKGNoaWxkLmhhc093blByb3BlcnR5KCdfX3N1cGVyX18nKSkgewogICAgICAgIHRyeSB7CiAgICAgICAgICBfaW5zdGFuY2UgPSBuZXcgY2hpbGQoewogICAgICAgICAgICAnaXNBdXRvU3RhcnQnOiBmYWxzZQogICAgICAgICAgfSk7CiAgICAgICAgICB0aGlzLl91bmJpbmRDaGlsZChfaW5zdGFuY2UsIGNoaWxkUm9vdCk7CiAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9IGNhdGNoIChfZXJyb3IpIHsKICAgICAgICAgIGUgPSBfZXJyb3I7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIuW8leaVsOOBruWApOOBjOS4jeato+OBp+OBmeOAgiDlvJXmlbDjgajjgZfjgabkuI7jgYjjgonjgozjgovjgqrjg5bjgrjjgqfjgq/jg4jjga8gS2F6aXRvcmkg44KS57aZ5om/44GX44Gm44GE44KL5b+F6KaB44GM44GC44KK44G+44GZ44CCIik7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICB0aGlzLl9kaXNwYXRjaGVyLmRpc3BhdGNoRXZlbnQobmV3IEtheml0b3JpRXZlbnQoS2F6aXRvcmlFdmVudC5SRU1PVkVELCB0aGlzLmZyYWdtZW50LCB0aGlzLmxhc3RGcmFnbWVudCkpOwogICAgcmV0dXJuIHRoaXM7CiAgfTsKCiAgS2F6aXRvcmkucHJvdG90eXBlLl91bmJpbmRDaGlsZCA9IGZ1bmN0aW9uKGNoaWxkLCBjaGlsZFJvb3QpIHsKICAgIHZhciBiZWZvcmVSdWxlLCBpLCBsZW4sIG5ld0JlZm9yZXMsIG5ld0hhbmRsZXJzLCBydWxlLCBydWxlT2JqOwogICAgcnVsZSA9IHRoaXMuX2dldENoaWxkUnVsZShjaGlsZCwgY2hpbGRSb290KTsKICAgIGkgPSAwOwogICAgbGVuID0gdGhpcy5oYW5kbGVycy5sZW5ndGg7CiAgICBuZXdIYW5kbGVycyA9IFtdOwogICAgd2hpbGUgKGkgPCBsZW4pIHsKICAgICAgcnVsZU9iaiA9IHRoaXMuaGFuZGxlcnMuc2hpZnQoKTsKICAgICAgaWYgKChydWxlT2JqLnJ1bGUubWF0Y2gocnVsZSkpID09PSBudWxsKSB7CiAgICAgICAgbmV3SGFuZGxlcnMudW5zaGlmdChydWxlT2JqKTsKICAgICAgfQogICAgICBpKys7CiAgICB9CiAgICB0aGlzLmhhbmRsZXJzID0gbmV3SGFuZGxlcnM7CiAgICBpID0gMDsKICAgIGxlbiA9IHRoaXMuYmVmb3JlSGFuZGxlcnMubGVuZ3RoOwogICAgbmV3QmVmb3JlcyA9IFtdOwogICAgd2hpbGUgKGkgPCBsZW4pIHsKICAgICAgYmVmb3JlUnVsZSA9IHRoaXMuYmVmb3JlSGFuZGxlcnMuc2hpZnQoKTsKICAgICAgaWYgKChiZWZvcmVSdWxlLnJ1bGUubWF0Y2gocnVsZSkpID09PSBudWxsKSB7CiAgICAgICAgbmV3QmVmb3Jlcy51bnNoaWZ0KGJlZm9yZVJ1bGUpOwogICAgICB9CiAgICAgIGkrKzsKICAgIH0KICAgIHJldHVybiB0aGlzLmJlZm9yZUhhbmRsZXJzID0gbmV3QmVmb3JlczsKICB9OwoKICAvKioKICAqIOODluODqeOCpuOCtuOBi+OCieePvuWcqOOBriBVUkwg44KS6Kqt44G/6L6844G/44G+44GZ44CCCiAgKiBAbWV0aG9kIGxvYWRVUkwKICAqIEBwYXJhbSB7U3RyaW5nfSBmcmFnbWVudE92ZXJyaWRlCiAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogICovCgoKICBLYXppdG9yaS5wcm90b3R5cGUubG9hZFVSTCA9IGZ1bmN0aW9uKGZyYWdtZW50T3ZlcnJpZGUsIG9wdGlvbnMpIHsKICAgIHZhciBmcmFnbWVudDsKICAgIHRoaXMuX3Byb2Nlc3NTdGVwLnN0YXR1cyA9ICdsb2FkVVJMJzsKICAgIHRoaXMuX3Byb2Nlc3NTdGVwLmFyZ3MgPSBbZnJhZ21lbnRPdmVycmlkZSwgb3B0aW9uc107CiAgICBpZiAodGhpcy5pc1N1c3BlbmQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgZnJhZ21lbnQgPSB0aGlzLmZyYWdtZW50ID0gdGhpcy5nZXRGcmFnbWVudChmcmFnbWVudE92ZXJyaWRlKTsKICAgIGlmICh0aGlzLmlzVGVtYWUgPT09IGZhbHNlICYmICh0aGlzLmJlZm9yZUFueXRpbWVIYW5kbGVyIHx8IHRoaXMuYmVmb3JlSGFuZGxlcnMubGVuZ3RoID4gMCkpIHsKICAgICAgdGhpcy5fZXhlY3V0ZUJlZm9yZXMoZnJhZ21lbnQpOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5leGVjdXRlSGFuZGxlcnMoKTsKICAgIH0KICB9OwoKICAvKioKICAqIOaMh+WumuOBl+OBnyDmloflrZfliJfjgavlr77lv5zjgZfjgZ8gVVJMIOODq+ODvOODq+OBjOioreWumuOBleOCjOOBpuOBhOOCi+OBi+OBqeOBhuOBizxicj4KICAqIEJvb2xlYW4g44Gn6L+U44GX44G+44GZ44CCCiAgKiA8aDQ+ZXhhbXBsZTwvaDQ+CiAgKiAgICAgYXBwLm1hdGNoKCcvaG9nZScpOwogICogQG1ldGhvZCBtYXRjaAogICogQHBhcmFtIHtTdHJpbmd9IGZyYWdtZW50CiAgKiBAcmV0dXJuIHtCb29sZWFufQogICovCgoKICBLYXppdG9yaS5wcm90b3R5cGUubWF0Y2ggPSBmdW5jdGlvbihmcmFnbWVudCkgewogICAgdmFyIG1hdGNoZWQ7CiAgICBtYXRjaGVkID0gdGhpcy5fbWF0Y2hDaGVjayhmcmFnbWVudCwgdGhpcy5oYW5kbGVycywgdHJ1ZSk7CiAgICByZXR1cm4gbWF0Y2hlZC5sZW5ndGggPiAwOwogIH07CgogIEtheml0b3JpLnByb3RvdHlwZS5iZWZvcmVDb21wbGV0ZSA9IGZ1bmN0aW9uKGV2ZW50KSB7CiAgICB0aGlzLl9iZWZvcmVEZWZmZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcihLYXppdG9yaUV2ZW50LlRBU0tfUVVFVUVfQ09NUExFVEUsIHRoaXMuYmVmb3JlQ29tcGxldGUpOwogICAgdGhpcy5fYmVmb3JlRGVmZmVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoS2F6aXRvcmlFdmVudC5UQVNLX1FVRVVFX0ZBSUxFRCwgdGhpcy5iZWZvcmVGYWlsZWQpOwogICAgdGhpcy5fZGlzcGF0Y2hlci5kaXNwYXRjaEV2ZW50KG5ldyBLYXppdG9yaUV2ZW50KEtheml0b3JpRXZlbnQuQkVGT1JFX0VYRUNVVEVELCB0aGlzLmZyYWdtZW50LCB0aGlzLmxhc3RGcmFnbWVudCkpOwogICAgaWYgKHRoaXMuaXNUZW1hZSkgewogICAgICB0aGlzLl91cmxDaGFuZ2UodGhpcy5mcmFnbWVudCwgdGhpcy5fY2hhbmdlT3B0aW9ucyk7CiAgICB9IGVsc2UgewogICAgICB0aGlzLmV4ZWN1dGVIYW5kbGVycygpOwogICAgfQogIH07CgogIEtheml0b3JpLnByb3RvdHlwZS5fZXhlY3V0ZUJlZm9yZXMgPSBmdW5jdGlvbihmcmFnbWVudCkgewogICAgdmFyIGhhbmRsZXIsIG1hdGNoZWQsIF9pLCBfbGVuLAogICAgICBfdGhpcyA9IHRoaXM7CiAgICB0aGlzLl9wcm9jZXNzU3RlcC5zdGF0dXMgPSAnX2V4ZWN1dGVCZWZvcmVzJzsKICAgIHRoaXMuX3Byb2Nlc3NTdGVwLmFyZ3MgPSBbZnJhZ21lbnRdOwogICAgdGhpcy5fYmVmb3JlRGVmZmVyID0gbmV3IERlZmZlcmVkKCk7CiAgICBpZiAodGhpcy5iZWZvcmVBbnl0aW1lSGFuZGxlciAhPSBudWxsKSB7CiAgICAgIHRoaXMuX2JlZm9yZURlZmZlci5kZWZmZXJlZChmdW5jdGlvbihkKSB7CiAgICAgICAgX3RoaXMuYmVmb3JlQW55dGltZUhhbmRsZXIuY2FsbGJhY2soZnJhZ21lbnQpOwogICAgICAgIGQuZXhlY3V0ZShkKTsKICAgICAgfSk7CiAgICB9CiAgICBtYXRjaGVkID0gdGhpcy5fbWF0Y2hDaGVjayhmcmFnbWVudCwgdGhpcy5iZWZvcmVIYW5kbGVycyk7CiAgICBmb3IgKF9pID0gMCwgX2xlbiA9IG1hdGNoZWQubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHsKICAgICAgaGFuZGxlciA9IG1hdGNoZWRbX2ldOwogICAgICB0aGlzLl9iZWZvcmVEZWZmZXIuZGVmZmVyZWQoZnVuY3Rpb24oZCkgewogICAgICAgIGhhbmRsZXIuY2FsbGJhY2soZnJhZ21lbnQpOwogICAgICAgIGQuZXhlY3V0ZShkKTsKICAgICAgfSk7CiAgICB9CiAgICB0aGlzLl9iZWZvcmVEZWZmZXIuYWRkRXZlbnRMaXN0ZW5lcihLYXppdG9yaUV2ZW50LlRBU0tfUVVFVUVfQ09NUExFVEUsIHRoaXMuYmVmb3JlQ29tcGxldGUpOwogICAgdGhpcy5fYmVmb3JlRGVmZmVyLmFkZEV2ZW50TGlzdGVuZXIoS2F6aXRvcmlFdmVudC5UQVNLX1FVRVVFX0ZBSUxFRCwgdGhpcy5iZWZvcmVGYWlsZWQpOwogICAgcmV0dXJuIHRoaXMuX2JlZm9yZURlZmZlci5leGVjdXRlKHRoaXMuX2JlZm9yZURlZmZlcik7CiAgfTsKCiAgS2F6aXRvcmkucHJvdG90eXBlLmV4ZWN1dGVIYW5kbGVycyA9IGZ1bmN0aW9uKCkgewogICAgdmFyIGhhbmRsZXIsIGlzTWF0Y2hlZCwgbWF0Y2gsIG1hdGNoZWQsIF9pLCBfaiwgX2xlbiwgX2xlbjEsCiAgICAgIF90aGlzID0gdGhpczsKICAgIHRoaXMuX3Byb2Nlc3NTdGVwLnN0YXR1cyA9ICdleGVjdXRlSGFuZGxlcnMnOwogICAgdGhpcy5fcHJvY2Vzc1N0ZXAuYXJncyA9IFtdOwogICAgaWYgKHRoaXMuaXNTdXNwZW5kKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIG1hdGNoZWQgPSB0aGlzLl9tYXRjaENoZWNrKHRoaXMuZnJhZ21lbnQsIHRoaXMuaGFuZGxlcnMpOwogICAgaXNNYXRjaGVkID0gdHJ1ZTsKICAgIGlmIChtYXRjaGVkID09PSBmYWxzZSB8fCBtYXRjaGVkLmxlbmd0aCA8IDEpIHsKICAgICAgaWYgKHRoaXMubm90Rm91bmQgIT09IG51bGwpIHsKICAgICAgICB0aGlzLl9ub3RGb3VuZC5jYWxsYmFjayh0aGlzLmZyYWdtZW50KTsKICAgICAgfQogICAgICBpc01hdGNoZWQgPSBmYWxzZTsKICAgICAgdGhpcy5fZGlzcGF0Y2hlci5kaXNwYXRjaEV2ZW50KG5ldyBLYXppdG9yaUV2ZW50KEtheml0b3JpRXZlbnQuTk9UX0ZPVU5EKSk7CiAgICB9IGVsc2UgaWYgKG1hdGNoZWQubGVuZ3RoID4gMSkgewogICAgICBmb3IgKF9pID0gMCwgX2xlbiA9IG1hdGNoZWQubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHsKICAgICAgICBtYXRjaCA9IG1hdGNoZWRbX2ldOwogICAgICAgIGlmICh0aGlzLmZyYWdtZW50LmluZGV4T2YobWF0Y2gucnVsZSkgPiAtMSkgewogICAgICAgICAgbWF0Y2guY2FsbGJhY2sodGhpcy5mcmFnbWVudCk7CiAgICAgICAgfQogICAgICB9CiAgICB9IGVsc2UgewogICAgICBmb3IgKF9qID0gMCwgX2xlbjEgPSBtYXRjaGVkLmxlbmd0aDsgX2ogPCBfbGVuMTsgX2orKykgewogICAgICAgIGhhbmRsZXIgPSBtYXRjaGVkW19qXTsKICAgICAgICBoYW5kbGVyLmNhbGxiYWNrKHRoaXMuZnJhZ21lbnQpOwogICAgICB9CiAgICB9CiAgICBpZiAodGhpcy5faXNGaXJzdFJlcXVlc3QpIHsKICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICBfdGhpcy5fZGlzcGF0Y2hlci5kaXNwYXRjaEV2ZW50KG5ldyBLYXppdG9yaUV2ZW50KEtheml0b3JpRXZlbnQuRklSU1RfUkVRVUVTVCwgX3RoaXMuZnJhZ21lbnQsIG51bGwpKTsKICAgICAgICBpZiAoaXNNYXRjaGVkKSB7CiAgICAgICAgICByZXR1cm4gX3RoaXMuX2Rpc3BhdGNoZXIuZGlzcGF0Y2hFdmVudChuZXcgS2F6aXRvcmlFdmVudChLYXppdG9yaUV2ZW50LkVYRUNVVEVELCBfdGhpcy5mcmFnbWVudCwgbnVsbCkpOwogICAgICAgIH0KICAgICAgfSwgMCk7CiAgICAgIHRoaXMuX2lzRmlyc3RSZXF1ZXN0ID0gZmFsc2U7CiAgICB9IGVsc2UgewogICAgICBpZiAoaXNNYXRjaGVkKSB7CiAgICAgICAgdGhpcy5fZGlzcGF0Y2hlci5kaXNwYXRjaEV2ZW50KG5ldyBLYXppdG9yaUV2ZW50KEtheml0b3JpRXZlbnQuRVhFQ1VURUQsIHRoaXMuZnJhZ21lbnQsIHRoaXMubGFzdEZyYWdtZW50KSk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBtYXRjaGVkOwogIH07CgogIEtheml0b3JpLnByb3RvdHlwZS5iZWZvcmVGYWlsZWQgPSBmdW5jdGlvbihldmVudCkgewogICAgdGhpcy5iZWZvcmVGYWlsZWRIYW5kbGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICB0aGlzLl9iZWZvcmVEZWZmZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcihLYXppdG9yaUV2ZW50LlRBU0tfUVVFVUVfRkFJTEVELCB0aGlzLmJlZm9yZUZhaWxlZCk7CiAgICB0aGlzLl9iZWZvcmVEZWZmZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcihLYXppdG9yaUV2ZW50LlRBU0tfUVVFVUVfQ09NUExFVEUsIHRoaXMuYmVmb3JlQ29tcGxldGUpOwogICAgaWYgKHRoaXMuaXNCZWZvcmVGb3JjZSkgewogICAgICB0aGlzLmJlZm9yZUNvbXBsZXRlKCk7CiAgICB9CiAgICB0aGlzLl9iZWZvcmVEZWZmZXIgPSBudWxsOwogIH07CgogIEtheml0b3JpLnByb3RvdHlwZS5vYnNlcnZlVVJMSGFuZGxlciA9IGZ1bmN0aW9uKGV2ZW50KSB7CiAgICB2YXIgY3VycmVudDsKICAgIGN1cnJlbnQgPSB0aGlzLmdldEZyYWdtZW50KCk7CiAgICBpZiAoY3VycmVudCA9PT0gdGhpcy5mcmFnbWVudCAmJiB0aGlzLmlmcmFtZSkgewogICAgICBjdXJyZW50ID0gdGhpcy5nZXRGcmFnbWVudCh0aGlzLmdldEhhc2godGhpcy5pZnJhbWUpKTsKICAgIH0KICAgIGlmIChjdXJyZW50ID09PSB0aGlzLmZyYWdtZW50KSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGlmICh0aGlzLmlmcmFtZSkgewogICAgICB0aGlzLmNoYW5nZShjdXJyZW50KTsKICAgIH0KICAgIGlmICh0aGlzLmxhc3RGcmFnbWVudCA9PT0gY3VycmVudCAmJiB0aGlzLmlzVXNlckFjdGlvbiA9PT0gZmFsc2UpIHsKICAgICAgdGhpcy5fZGlzcGF0Y2hlci5kaXNwYXRjaEV2ZW50KG5ldyBLYXppdG9yaUV2ZW50KEtheml0b3JpRXZlbnQuUFJFViwgY3VycmVudCwgdGhpcy5mcmFnbWVudCkpOwogICAgfSBlbHNlIGlmICh0aGlzLmxhc3RGcmFnbWVudCA9PT0gdGhpcy5mcmFnbWVudCAmJiB0aGlzLmlzVXNlckFjdGlvbiA9PT0gZmFsc2UpIHsKICAgICAgdGhpcy5fZGlzcGF0Y2hlci5kaXNwYXRjaEV2ZW50KG5ldyBLYXppdG9yaUV2ZW50KEtheml0b3JpRXZlbnQuTkVYVCwgY3VycmVudCwgdGhpcy5sYXN0RnJhZ21lbnQpKTsKICAgIH0KICAgIHRoaXMuaXNVc2VyQWN0aW9uID0gZmFsc2U7CiAgICB0aGlzLl9kaXNwYXRjaGVyLmRpc3BhdGNoRXZlbnQobmV3IEtheml0b3JpRXZlbnQoS2F6aXRvcmlFdmVudC5DSEFOR0UsIGN1cnJlbnQsIHRoaXMubGFzdEZyYWdtZW50KSk7CiAgICByZXR1cm4gdGhpcy5sb2FkVVJMKGN1cnJlbnQpOwogIH07CgogIEtheml0b3JpLnByb3RvdHlwZS5fYmluZFJ1bGVzID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgcm91dGVzLCBydWxlLCBfaSwgX2xlbjsKICAgIGlmICh0aGlzLnJvdXRlcyA9PSBudWxsKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHJvdXRlcyA9IHRoaXMuX2tleXModGhpcy5yb3V0ZXMpOwogICAgZm9yIChfaSA9IDAsIF9sZW4gPSByb3V0ZXMubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHsKICAgICAgcnVsZSA9IHJvdXRlc1tfaV07CiAgICAgIHRoaXMucmVnaXN0ZXJIYW5kbGVyKHJ1bGUsIHRoaXMucm91dGVzW3J1bGVdLCBmYWxzZSk7CiAgICB9CiAgfTsKCiAgS2F6aXRvcmkucHJvdG90eXBlLl9iaW5kQmVmb3JlcyA9IGZ1bmN0aW9uKCkgewogICAgdmFyIGJlZm9yZXMsIGtleSwgX2ksIF9sZW47CiAgICBpZiAodGhpcy5iZWZvcmVBbnl0aW1lKSB7CiAgICAgIHRoaXMuX2JpbmRCZWZvcmVBbnl0aW1lKHRoaXMuYmVmb3JlQW55dGltZSk7CiAgICB9CiAgICBpZiAodGhpcy5iZWZvcmVzID09IG51bGwpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgYmVmb3JlcyA9IHRoaXMuX2tleXModGhpcy5iZWZvcmVzKTsKICAgIGZvciAoX2kgPSAwLCBfbGVuID0gYmVmb3Jlcy5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykgewogICAgICBrZXkgPSBiZWZvcmVzW19pXTsKICAgICAgdGhpcy5yZWdpc3RlckhhbmRsZXIoa2V5LCB0aGlzLmJlZm9yZXNba2V5XSwgdHJ1ZSk7CiAgICB9CiAgfTsKCiAgS2F6aXRvcmkucHJvdG90eXBlLl9iaW5kQmVmb3JlQW55dGltZSA9IGZ1bmN0aW9uKGZ1bmNzLCBiaW5kZWRGdW5jcykgewogICAgdmFyIGNhbGxiYWNrOwogICAgY2FsbGJhY2sgPSB0aGlzLl9iaW5kRnVuY3Rpb25zKGZ1bmNzLCBiaW5kZWRGdW5jcyk7CiAgICByZXR1cm4gdGhpcy5iZWZvcmVBbnl0aW1lSGFuZGxlciA9IHsKICAgICAgY2FsbGJhY2s6IHRoaXMuX2JpbmRlcihmdW5jdGlvbihmcmFnbWVudCkgewogICAgICAgIHZhciBhcmdzOwogICAgICAgIGFyZ3MgPSBbZnJhZ21lbnRdOwogICAgICAgIHJldHVybiBjYWxsYmFjayAmJiBjYWxsYmFjay5hcHBseSh0aGlzLCBhcmdzKTsKICAgICAgfSwgdGhpcykKICAgIH07CiAgfTsKCiAgS2F6aXRvcmkucHJvdG90eXBlLl9iaW5kTm90Rm91bmQgPSBmdW5jdGlvbigpIHsKICAgIHZhciBjYWxsYmFjaywgbm90Rm91bmRGcmFnbWVudCwgbm90Rm91bmRGdW5jTmFtZSwgcnVsZSwgX2ksIF9sZW4sIF9yZWY7CiAgICBpZiAodGhpcy5ub3RGb3VuZCA9PSBudWxsKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICh0eXBlb2YgdGhpcy5ub3RGb3VuZCA9PT0gInN0cmluZyIpIHsKICAgICAgX3JlZiA9IHRoaXMuaGFuZGxlcnM7CiAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gX3JlZi5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykgewogICAgICAgIHJ1bGUgPSBfcmVmW19pXTsKICAgICAgICBpZiAocnVsZS5ydWxlID09PSAnLycgKyB0aGlzLm5vdEZvdW5kLnJlcGxhY2UodGhpcy5yb290LCAnJykpIHsKICAgICAgICAgIHRoaXMuX25vdEZvdW5kID0gcnVsZTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIG5vdEZvdW5kRnJhZ21lbnQgPSB0aGlzLl9rZXlzKHRoaXMubm90Rm91bmQpWzBdOwogICAgfQogICAgbm90Rm91bmRGdW5jTmFtZSA9IHRoaXMubm90Rm91bmRbbm90Rm91bmRGcmFnbWVudF07CiAgICBpZiAodHlwZW9mIG5vdEZvdW5kRnVuY05hbWUgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgY2FsbGJhY2sgPSBub3RGb3VuZEZ1bmNOYW1lOwogICAgfSBlbHNlIHsKICAgICAgY2FsbGJhY2sgPSB0aGlzW25vdEZvdW5kRnVuY05hbWVdOwogICAgfQogICAgdGhpcy5fbm90Rm91bmQgPSBuZXcgUnVsZShub3RGb3VuZEZyYWdtZW50LCBmdW5jdGlvbihmcmFnbWVudCkgewogICAgICB2YXIgYXJnczsKICAgICAgYXJncyA9IHRoaXMucm91dGVyLmV4dHJhY3RQYXJhbXModGhpcywgZnJhZ21lbnQpOwogICAgICByZXR1cm4gY2FsbGJhY2sgJiYgY2FsbGJhY2suYXBwbHkodGhpcy5yb3V0ZXIsIGFyZ3MpOwogICAgfSwgdGhpcyk7CiAgfTsKCiAgS2F6aXRvcmkucHJvdG90eXBlLl91cGRhdGVIYXNoID0gZnVuY3Rpb24obG9jYXRpb24sIGZyYWdtZW50LCByZXBsYWNlKSB7CiAgICB2YXIgYXRSb290LCBocmVmOwogICAgYXRSb290ID0gdGhpcy5sb2NhdGlvbi5wYXRobmFtZS5yZXBsYWNlKC9bXlwvXSQvLCAnJCYvJykgPT09IHRoaXMucm9vdDsKICAgIGlmICghYXRSb290KSB7CiAgICAgIGxvY2F0aW9uLnJlcGxhY2UodGhpcy5yb290ICsgJyMnICsgZnJhZ21lbnQpOwogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAocmVwbGFjZSkgewogICAgICBocmVmID0gbG9jYXRpb24uaHJlZi5yZXBsYWNlKC8oamF2YXNjcmlwdDp8IykuKiQvLCAnJyk7CiAgICAgIGxvY2F0aW9uLnJlcGxhY2UoaHJlZiArICcjJyArIGZyYWdtZW50KTsKICAgIH0gZWxzZSB7CiAgICAgIGxvY2F0aW9uLmhhc2ggPSAiIyIgKyBmcmFnbWVudDsKICAgIH0KICB9OwoKICBLYXppdG9yaS5wcm90b3R5cGUuX3VwZGF0ZUhhc2hJRSA9IGZ1bmN0aW9uKGZyYWdtZW50LCByZXBsYWNlKSB7CiAgICByZXR1cm4gbG9jYXRpb24ucmVwbGFjZSh0aGlzLnJvb3QgKyAnIy8nICsgZnJhZ21lbnQpOwogIH07CgogIEtheml0b3JpLnByb3RvdHlwZS5fbWF0Y2hDaGVjayA9IGZ1bmN0aW9uKGZyYWdtZW50LCBoYW5kbGVycywgdGVzdCkgewogICAgdmFyIGEsIGFyZ3MsIGFyZ3NNYXRjaCwgYXJnc01hdGNoZWQsIGhhbmRsZXIsIGhhc1F1ZXJ5LCBpLCBsZW4sIG1hdGNoLCBtYXRjaGVkLCB0LCB0bXBGcmFnLCBfaSwgX2osIF9sZW4sIF9sZW4xOwogICAgaWYgKHRlc3QgPT0gbnVsbCkgewogICAgICB0ZXN0ID0gZmFsc2U7CiAgICB9CiAgICBtYXRjaGVkID0gW107CiAgICB0bXBGcmFnID0gZnJhZ21lbnQ7CiAgICBpZiAodG1wRnJhZyAhPT0gdm9pZCAwICYmIHRtcEZyYWcgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgIGhhc1F1ZXJ5ID0gdGhpcy5fbWF0Y2guYXBwbHkodG1wRnJhZywgWy8oXD9bXHdcZD18XSspL2ddKTsKICAgIH0KICAgIGlmIChoYXNRdWVyeSkgewogICAgICBmcmFnbWVudCA9IGZyYWdtZW50LnNwbGl0KCc/JylbMF07CiAgICB9CiAgICBmb3IgKF9pID0gMCwgX2xlbiA9IGhhbmRsZXJzLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7CiAgICAgIGhhbmRsZXIgPSBoYW5kbGVyc1tfaV07CiAgICAgIGlmIChoYW5kbGVyLnJ1bGUgPT09IGZyYWdtZW50KSB7CiAgICAgICAgbWF0Y2hlZC5wdXNoKGhhbmRsZXIpOwogICAgICB9IGVsc2UgaWYgKGhhbmRsZXIudGVzdChmcmFnbWVudCkpIHsKICAgICAgICBpZiAoaGFuZGxlci5pc1ZhcmlhYmxlICYmIGhhbmRsZXIudHlwZXMubGVuZ3RoID4gMCkgewogICAgICAgICAgYXJncyA9IHRoaXMuZXh0cmFjdFBhcmFtcyhoYW5kbGVyLCBmcmFnbWVudCwgdGVzdCk7CiAgICAgICAgICBhcmdzTWF0Y2ggPSBbXTsKICAgICAgICAgIGxlbiA9IGFyZ3MubGVuZ3RoOwogICAgICAgICAgaSA9IDA7CiAgICAgICAgICB3aGlsZSAoaSA8IGxlbikgewogICAgICAgICAgICBhID0gYXJnc1tpXTsKICAgICAgICAgICAgdCA9IGhhbmRsZXIudHlwZXNbaV07CiAgICAgICAgICAgIGlmICh0eXBlb2YgYSAhPT0gIm9iamVjdCIpIHsKICAgICAgICAgICAgICBpZiAodCA9PT0gbnVsbCkgewogICAgICAgICAgICAgICAgYXJnc01hdGNoLnB1c2godHJ1ZSk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGFyZ3NNYXRjaC5wdXNoKHRoaXMuX3R5cGVDaGVjayhhLCB0KSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGkrKzsKICAgICAgICAgIH0KICAgICAgICAgIGFyZ3NNYXRjaGVkID0gdHJ1ZTsKICAgICAgICAgIGZvciAoX2ogPSAwLCBfbGVuMSA9IGFyZ3NNYXRjaC5sZW5ndGg7IF9qIDwgX2xlbjE7IF9qKyspIHsKICAgICAgICAgICAgbWF0Y2ggPSBhcmdzTWF0Y2hbX2pdOwogICAgICAgICAgICBpZiAoIW1hdGNoKSB7CiAgICAgICAgICAgICAgYXJnc01hdGNoZWQgPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgaWYgKGFyZ3NNYXRjaGVkKSB7CiAgICAgICAgICAgIG1hdGNoZWQucHVzaChoYW5kbGVyKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgbWF0Y2hlZC5wdXNoKGhhbmRsZXIpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgaWYgKG1hdGNoZWQubGVuZ3RoID4gMCkgewogICAgICByZXR1cm4gbWF0Y2hlZDsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICB9OwoKICAvKioKICAqIFVSTCDjg6vjg7zjg4jku6XkuIvjgpLlj5blvpcKICAqIEBtZXRob2QgZ2V0RnJhZ21lbnQKICAqIEBwYXJhbSB7U3RyaW5nfSBmcmFnbWVudAogICovCgoKICBLYXppdG9yaS5wcm90b3R5cGUuZ2V0RnJhZ21lbnQgPSBmdW5jdGlvbihmcmFnbWVudCkgewogICAgdmFyIGZyYWcsIGluZGV4LCBtYXRjaGVkLCByb290LCBfaSwgX2xlbiwgX3JlZjsKICAgIGlmICgoZnJhZ21lbnQgPT0gbnVsbCkgfHwgZnJhZ21lbnQgPT09IHZvaWQgMCkgewogICAgICBpZiAodGhpcy5faGFzUHVzaFN0YXRlIHx8ICF0aGlzLl93YW50Q2hhbmdlSGFzaCkgewogICAgICAgIGZyYWdtZW50ID0gdGhpcy5sb2NhdGlvbi5wYXRobmFtZTsKICAgICAgICBtYXRjaGVkID0gZmFsc2U7CiAgICAgICAgZnJhZyA9IGZyYWdtZW50OwogICAgICAgIGlmIChmcmFnLm1hdGNoKC9eXC8vKSkgewogICAgICAgICAgZnJhZyA9IGZyYWcuc3Vic3RyKDEpOwogICAgICAgIH0KICAgICAgICByb290ID0gdGhpcy5yb290OwogICAgICAgIGlmIChyb290Lm1hdGNoKC9eXC8vKSkgewogICAgICAgICAgcm9vdCA9IHJvb3Quc3Vic3RyKDEpOwogICAgICAgIH0KICAgICAgICBfcmVmID0gdGhpcy5yb290RmlsZXM7CiAgICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSBfcmVmLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7CiAgICAgICAgICBpbmRleCA9IF9yZWZbX2ldOwogICAgICAgICAgaWYgKGluZGV4ID09PSBmcmFnIHx8IHJvb3QgKyBpbmRleCA9PT0gZnJhZykgewogICAgICAgICAgICBtYXRjaGVkID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKG1hdGNoZWQpIHsKICAgICAgICAgIGZyYWdtZW50ID0gdGhpcy5yb290OwogICAgICAgIH0KICAgICAgICBmcmFnbWVudCA9IGZyYWdtZW50ICsgdGhpcy5sb2NhdGlvbi5zZWFyY2g7CiAgICAgICAgcm9vdCA9IHRoaXMucm9vdC5yZXBsYWNlKHRyYWlsaW5nU2xhc2gsICcnKTsKICAgICAgICBpZiAoZnJhZ21lbnQuaW5kZXhPZihyb290KSA+IC0xKSB7CiAgICAgICAgICBmcmFnbWVudCA9IGZyYWdtZW50LnN1YnN0cihyb290Lmxlbmd0aCk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGZyYWdtZW50ID0gdGhpcy5nZXRIYXNoKCk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHJvb3QgPSB0aGlzLnJvb3QucmVwbGFjZSh0cmFpbGluZ1NsYXNoLCAnJyk7CiAgICAgIGlmIChmcmFnbWVudC5pbmRleE9mKHRoaXMucm9vdCkgPiAtMSAmJiBmcmFnbWVudC5pbmRleE9mKHJvb3QpID4gLTEpIHsKICAgICAgICBmcmFnbWVudCA9IGZyYWdtZW50LnN1YnN0cihyb290Lmxlbmd0aCk7CiAgICAgIH0KICAgIH0KICAgIGlmICh0eXBlb2YgZnJhZ21lbnQgPT09ICJzdHJpbmciKSB7CiAgICAgIGZyYWdtZW50ID0gZnJhZ21lbnQucmVwbGFjZSh0cmFpbGluZ1NsYXNoLCAnJyk7CiAgICAgIGlmIChmcmFnbWVudCA9PT0gIiIpIHsKICAgICAgICBmcmFnbWVudCA9ICIvIjsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGZyYWdtZW50OwogIH07CgogIC8qKgogICogVVJMIOOBriAjIOS7pemZjeOCkuWPluW+lwogICogQG1ldGhvZCBnZXRIYXNoCiAgKiBAcmV0dXJuIHtTdHJpbmd9IFVSTCDjga4gIyDku6XpmY3jga7mloflrZfliJcKICAqLwoKCiAgS2F6aXRvcmkucHJvdG90eXBlLmdldEhhc2ggPSBmdW5jdGlvbigpIHsKICAgIHZhciBtYXRjaDsKICAgIG1hdGNoID0gKHdpbmRvdyB8fCB0aGlzKS5sb2NhdGlvbi5ocmVmLm1hdGNoKC8jKC4qKSQvKTsKICAgIGlmIChtYXRjaCAhPSBudWxsKSB7CiAgICAgIHJldHVybiBtYXRjaFsxXTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiAnJzsKICAgIH0KICB9OwoKICAvKioKICAqIFVSTCDjg5Hjg6njg6Hjg7zjgr/jgpLliIbop6MKICAqIEBtZXRob2QgZXh0cmFjdFBhcmFtcwogICogQHBhcmFtIHtSdWxlfSBydWxlCiAgKiBAcGFyYW0ge1N0cmluZ30gZnJhZ21lbnQKICAqIEBwYXJhbSB7Qm9vbGVhbn0gdGVzdAogICovCgoKICBLYXppdG9yaS5wcm90b3R5cGUuZXh0cmFjdFBhcmFtcyA9IGZ1bmN0aW9uKHJ1bGUsIGZyYWdtZW50LCB0ZXN0KSB7CiAgICB2YXIgaywga3YsIGxhc3QsIG5ld1BhcmFtLCBuZXdRdWVyaWVzLCBwYXJhbSwgcSwgcXVlcmllcywgcXVlcnksIHF1ZXJ5UGFyYW1zLCB2LCBfaSwgX2xlbjsKICAgIGlmICh0ZXN0ID09IG51bGwpIHsKICAgICAgdGVzdCA9IGZhbHNlOwogICAgfQogICAgaWYgKHRoaXMuX3BhcmFtcy5wYXJhbXMubGVuZ3RoID4gMCAmJiB0aGlzLl9wYXJhbXMuZnJhZ21lbnQgPT09IGZyYWdtZW50KSB7CiAgICAgIHJldHVybiB0aGlzLl9wYXJhbXMucGFyYW1zOwogICAgfQogICAgcGFyYW0gPSBydWxlLl9yZWdleHAuZXhlYyhmcmFnbWVudCk7CiAgICBpZiAocGFyYW0gPT09IG51bGwgJiYgZnJhZ21lbnQuaW5kZXhPZignPycpID4gLTEpIHsKICAgICAgcGFyYW0gPSBbMCwgJz8nICsgZnJhZ21lbnQuc3BsaXQoJz8nKVsxXV07CiAgICB9CiAgICB0aGlzLl9wYXJhbXMuZnJhZ21lbnQgPSBmcmFnbWVudDsKICAgIGlmIChwYXJhbSAhPSBudWxsKSB7CiAgICAgIG5ld1BhcmFtID0gcGFyYW0uc2xpY2UoMSk7CiAgICAgIGxhc3QgPSBwYXJhbVtwYXJhbS5sZW5ndGggLSAxXTsKICAgICAgaWYgKGxhc3QuaW5kZXhPZignPycpID4gLTEpIHsKICAgICAgICBuZXdRdWVyaWVzID0ge307CiAgICAgICAgcXVlcmllcyA9IGxhc3Quc3BsaXQoJz8nKVsxXTsKICAgICAgICBxdWVyeVBhcmFtcyA9IHF1ZXJpZXMuc3BsaXQoJyYnKTsKICAgICAgICBmb3IgKF9pID0gMCwgX2xlbiA9IHF1ZXJ5UGFyYW1zLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7CiAgICAgICAgICBxdWVyeSA9IHF1ZXJ5UGFyYW1zW19pXTsKICAgICAgICAgIGt2ID0gcXVlcnkuc3BsaXQoJz0nKTsKICAgICAgICAgIGsgPSBrdlswXTsKICAgICAgICAgIHYgPSBrdlsxXSA/IGt2WzFdIDogIiI7CiAgICAgICAgICBpZiAodi5pbmRleE9mKCd8JykgPiAtMSkgewogICAgICAgICAgICB2ID0gdi5zcGxpdCgifCIpOwogICAgICAgICAgfQogICAgICAgICAgbmV3UXVlcmllc1trXSA9IHY7CiAgICAgICAgfQogICAgICAgIG5ld1BhcmFtLnBvcCgpOwogICAgICAgIG5ld1BhcmFtLnB1c2gobGFzdC5zcGxpdCgnPycpWzBdKTsKICAgICAgICBxID0gewogICAgICAgICAgInF1ZXJpZXMiOiBuZXdRdWVyaWVzCiAgICAgICAgfTsKICAgICAgICBuZXdQYXJhbS5wdXNoKHEpOwogICAgICAgIGlmICghdGVzdCkgewogICAgICAgICAgdGhpcy5fcGFyYW1zLnBhcmFtcyA9IHRoaXMuX2dldENhc3RlZFBhcmFtcyhydWxlLCBuZXdQYXJhbS5zbGljZSgwKSk7CiAgICAgICAgICB0aGlzLl9wYXJhbXMucXVlcmllcyA9IG5ld1F1ZXJpZXM7CiAgICAgICAgICBpZiAodGhpcy5pc09sZElFKSB7CiAgICAgICAgICAgIHRoaXMucGFyYW1zID0gdGhpcy5fcGFyYW1zLnBhcmFtczsKICAgICAgICAgICAgdGhpcy5xdWVyaWVzID0gdGhpcy5fcGFyYW1zLnF1ZXJpZXM7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGlmICghdGVzdCkgewogICAgICAgICAgdGhpcy5fcGFyYW1zLnBhcmFtcyA9IHRoaXMuX2dldENhc3RlZFBhcmFtcyhydWxlLCBuZXdQYXJhbSk7CiAgICAgICAgICBpZiAodGhpcy5pc09sZElFKSB7CiAgICAgICAgICAgIHRoaXMucGFyYW1zID0gdGhpcy5fcGFyYW1zLnBhcmFtczsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIG5ld1BhcmFtOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5fcGFyYW1zLnBhcmFtcyA9IFtdOwogICAgICBpZiAodGhpcy5pc09sZElFKSB7CiAgICAgICAgdGhpcy5wYXJhbSA9IFtdOwogICAgICB9CiAgICAgIHJldHVybiBudWxsOwogICAgfQogIH07CgogIEtheml0b3JpLnByb3RvdHlwZS5fZ2V0Q2FzdGVkUGFyYW1zID0gZnVuY3Rpb24ocnVsZSwgcGFyYW1zKSB7CiAgICB2YXIgY2FzdGVkUGFyYW1zLCBpLCBsZW4sIHR5cGUsIF9pLCBfbGVuOwogICAgaSA9IDA7CiAgICBpZiAoIXBhcmFtcykgewogICAgICByZXR1cm4gcGFyYW1zOwogICAgfQogICAgaWYgKHJ1bGUudHlwZXMubGVuZ3RoIDwgMSkgewogICAgICByZXR1cm4gcGFyYW1zOwogICAgfQogICAgbGVuID0gcGFyYW1zLmxlbmd0aDsKICAgIGNhc3RlZFBhcmFtcyA9IFtdOwogICAgd2hpbGUgKGkgPCBsZW4pIHsKICAgICAgaWYgKHJ1bGUudHlwZXNbaV0gPT09IG51bGwpIHsKICAgICAgICBjYXN0ZWRQYXJhbXMucHVzaChwYXJhbXNbaV0pOwogICAgICB9IGVsc2UgaWYgKHR5cGVvZiBwYXJhbXNbaV0gPT09ICJvYmplY3QiKSB7CiAgICAgICAgY2FzdGVkUGFyYW1zLnB1c2gocGFyYW1zW2ldKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBmb3IgKF9pID0gMCwgX2xlbiA9IFZBUklBQkxFX1RZUEVTLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7CiAgICAgICAgICB0eXBlID0gVkFSSUFCTEVfVFlQRVNbX2ldOwogICAgICAgICAgaWYgKHJ1bGUudHlwZXNbaV0gPT09IHR5cGUubmFtZSkgewogICAgICAgICAgICBjYXN0ZWRQYXJhbXMucHVzaCh0eXBlLmNhc3QocGFyYW1zW2ldKSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGkrKzsKICAgIH0KICAgIHJldHVybiBjYXN0ZWRQYXJhbXM7CiAgfTsKCiAgS2F6aXRvcmkucHJvdG90eXBlLmFkZEV2ZW50TGlzdGVuZXIgPSBmdW5jdGlvbih0eXBlLCBsaXN0ZW5lcikgewogICAgcmV0dXJuIHRoaXMuX2Rpc3BhdGNoZXIuYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcik7CiAgfTsKCiAgS2F6aXRvcmkucHJvdG90eXBlLnJlbW92ZUV2ZW50TGlzdGVuZXIgPSBmdW5jdGlvbih0eXBlLCBsaXN0ZW5lcikgewogICAgcmV0dXJuIHRoaXMuX2Rpc3BhdGNoZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcik7CiAgfTsKCiAgS2F6aXRvcmkucHJvdG90eXBlLmRpc3BhdGNoRXZlbnQgPSBmdW5jdGlvbihldmVudCkgewogICAgcmV0dXJuIHRoaXMuX2Rpc3BhdGNoZXIuZGlzcGF0Y2hFdmVudChldmVudCk7CiAgfTsKCiAgS2F6aXRvcmkucHJvdG90eXBlLl9hZGRQb3BTdGF0ZUhhbmRsZXIgPSBmdW5jdGlvbigpIHsKICAgIHZhciB3aW47CiAgICB3aW4gPSB3aW5kb3c7CiAgICBpZiAodGhpcy5faGFzUHVzaFN0YXRlID09PSB0cnVlKSB7CiAgICAgIHdpbi5hZGRFdmVudExpc3RlbmVyKCdwb3BzdGF0ZScsIHRoaXMub2JzZXJ2ZVVSTEhhbmRsZXIpOwogICAgfQogICAgaWYgKHRoaXMuX3dhbnRDaGFuZ2VIYXNoID09PSB0cnVlICYmICF0aGlzLmlzT2xkSUUpIHsKICAgICAgcmV0dXJuIHdpbi5hZGRFdmVudExpc3RlbmVyKCdoYXNoY2hhbmdlJywgdGhpcy5vYnNlcnZlVVJMSGFuZGxlcik7CiAgICB9IGVsc2UgaWYgKHRoaXMuX3dhbnRDaGFuZ2VIYXNoID09PSB0cnVlKSB7CiAgICAgIHJldHVybiB3aW4uYXR0YWNoRXZlbnQoJ29uaGFzaGNoYW5nZScsIHRoaXMub2JzZXJ2ZVVSTEhhbmRsZXIpOwogICAgfQogIH07CgogIEtheml0b3JpLnByb3RvdHlwZS5fcmVtb3ZlUG9wU3RhdGVIYW5kbGVyID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgd2luOwogICAgd2luID0gd2luZG93OwogICAgd2luLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3BvcHN0YXRlJywgdGhpcy5vYnNlcnZlVVJMSGFuZGxlcik7CiAgICB3aW4ucmVtb3ZlRXZlbnRMaXN0ZW5lcignaGFzaGNoYW5nZScsIHRoaXMub2JzZXJ2ZVVSTEhhbmRsZXIpOwogICAgaWYgKHRoaXMuaXNPbGRJRSkgewogICAgICByZXR1cm4gd2luLmRldGFjaEV2ZW50KCdvbmhhc2hjaGFuZ2UnLCB0aGlzLm9ic2VydmVVUkxIYW5kbGVyKTsKICAgIH0KICB9OwoKICBLYXppdG9yaS5wcm90b3R5cGUuX3NsaWNlID0gQXJyYXkucHJvdG90eXBlLnNsaWNlOwoKICBLYXppdG9yaS5wcm90b3R5cGUuX3JlcGxhY2UgPSBTdHJpbmcucHJvdG90eXBlLnJlcGxhY2U7CgogIEtheml0b3JpLnByb3RvdHlwZS5fbWF0Y2ggPSBTdHJpbmcucHJvdG90eXBlLm1hdGNoOwoKICBLYXppdG9yaS5wcm90b3R5cGUuX2tleXMgPSBPYmplY3Qua2V5cyB8fCBmdW5jdGlvbihvYmopIHsKICAgIHZhciBrZXksIGtleXM7CiAgICBpZiAob2JqID09PSAhT2JqZWN0KG9iaikpIHsKICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignb2JqZWN0IGphIG5haScpOwogICAgfQogICAga2V5cyA9IFtdOwogICAgZm9yIChrZXkgaW4gb2JqKSB7CiAgICAgIGlmIChPYmplY3QuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSkpIHsKICAgICAgICBrZXlzW2tleXMubGVuZ3RoXSA9IGtleTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGtleXM7CiAgfTsKCiAgS2F6aXRvcmkucHJvdG90eXBlLl9iaW5kZXIgPSBmdW5jdGlvbihmdW5jLCBvYmopIHsKICAgIHZhciBhcmdzLCBzbGljZTsKICAgIHNsaWNlID0gdGhpcy5fc2xpY2U7CiAgICBhcmdzID0gc2xpY2UuY2FsbChhcmd1bWVudHMsIDIpOwogICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gZnVuYy5hcHBseShvYmogfHwge30sIGFyZ3MuY29uY2F0KHNsaWNlLmNhbGwoYXJndW1lbnRzKSkpOwogICAgfTsKICB9OwoKICBLYXppdG9yaS5wcm90b3R5cGUuX2V4dGVuZCA9IGZ1bmN0aW9uKG9iaikgewogICAgdGhpcy5fZWFjaCh0aGlzLl9zbGljZS5jYWxsKGFyZ3VtZW50cywgMSksIGZ1bmN0aW9uKHNvdXJjZSkgewogICAgICB2YXIgcHJvcCwgX3Jlc3VsdHM7CiAgICAgIGlmIChzb3VyY2UpIHsKICAgICAgICBfcmVzdWx0cyA9IFtdOwogICAgICAgIGZvciAocHJvcCBpbiBzb3VyY2UpIHsKICAgICAgICAgIF9yZXN1bHRzLnB1c2gob2JqW3Byb3BdID0gc291cmNlW3Byb3BdKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9yZXN1bHRzOwogICAgICB9CiAgICB9KTsKICAgIHJldHVybiBvYmo7CiAgfTsKCiAgS2F6aXRvcmkucHJvdG90eXBlLl9lYWNoID0gZnVuY3Rpb24ob2JqLCBpdGVyLCBjdHgpIHsKICAgIHZhciBlYWNoLCBpLCBrLCBsOwogICAgaWYgKG9iaiA9PSBudWxsKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGVhY2ggPSBBcnJheS5wcm90b3R5cGUuZm9yRWFjaDsKICAgIGlmIChlYWNoICYmIG9iai5mb3JFYWNoID09PSBlYWNoKSB7CiAgICAgIHJldHVybiBvYmouZm9yRWFjaChpdGVyLCBjdHgpOwogICAgfSBlbHNlIGlmIChvYmoubGVuZ3RoID09PSArb2JqLmxlbmd0aCkgewogICAgICBpID0gMDsKICAgICAgbCA9IG9iai5sZW5ndGg7CiAgICAgIHdoaWxlIChpIDwgbCkgewogICAgICAgIGlmIChpdGVyLmNhbGwoY3R4LCBvYmpbaV0sIGksIG9iaikgPT09IHRoaXMuYnJlYWtlcikgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpKys7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGZvciAoayBpbiBvYmopIHsKICAgICAgICBpZiAoX19pbmRleE9mLmNhbGwob2JqLCBrKSA+PSAwKSB7CiAgICAgICAgICBpZiAoaXRlci5jYWxsKGN0eCwgb2JqW2tdLCBrLCBvYmopID09PSB0aGlzLmJyZWFrZXIpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogIH07CgogIEtheml0b3JpLnByb3RvdHlwZS5fYmluZEZ1bmN0aW9ucyA9IGZ1bmN0aW9uKGZ1bmNzLCBpbnNlcnQpIHsKICAgIHZhciBiaW5kZWRGdW5jcywgY2FsbGJhY2ssIGYsIGZ1bmMsIGZ1bmNOYW1lLCBpLCBsZW4sIG5hbWVzLCBuZXdGLCBfaSwgX2xlbjsKICAgIGlmICh0eXBlb2YgZnVuY3MgPT09ICdzdHJpbmcnKSB7CiAgICAgIGZ1bmNzID0gZnVuY3Muc3BsaXQoJywnKTsKICAgIH0KICAgIGJpbmRlZEZ1bmNzID0gW107CiAgICBmb3IgKF9pID0gMCwgX2xlbiA9IGZ1bmNzLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7CiAgICAgIGZ1bmNOYW1lID0gZnVuY3NbX2ldOwogICAgICBmdW5jID0gdGhpc1tmdW5jTmFtZV07CiAgICAgIGlmIChmdW5jID09IG51bGwpIHsKICAgICAgICBuYW1lcyA9IGZ1bmNOYW1lLnNwbGl0KCcuJyk7CiAgICAgICAgaWYgKG5hbWVzLmxlbmd0aCA+IDEpIHsKICAgICAgICAgIGYgPSB3aW5kb3dbbmFtZXNbMF1dOwogICAgICAgICAgaSA9IDE7CiAgICAgICAgICBsZW4gPSBuYW1lcy5sZW5ndGg7CiAgICAgICAgICB3aGlsZSAoaSA8IGxlbikgewogICAgICAgICAgICBuZXdGID0gZltuYW1lc1tpXV07CiAgICAgICAgICAgIGlmIChuZXdGICE9IG51bGwpIHsKICAgICAgICAgICAgICBmID0gbmV3RjsKICAgICAgICAgICAgICBpKys7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGZ1bmMgPSBmOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBmdW5jID0gd2luZG93W2Z1bmNOYW1lXTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKGZ1bmMgIT0gbnVsbCkgewogICAgICAgIGJpbmRlZEZ1bmNzLnB1c2goZnVuYyk7CiAgICAgIH0KICAgIH0KICAgIGlmIChpbnNlcnQpIHsKICAgICAgYmluZGVkRnVuY3MgPSBpbnNlcnQuY29uY2F0KGJpbmRlZEZ1bmNzKTsKICAgIH0KICAgIGNhbGxiYWNrID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBhcmdzLCBfaiwgX2xlbjE7CiAgICAgIGFyZ3MgPSAxIDw9IGFyZ3VtZW50cy5sZW5ndGggPyBfX3NsaWNlLmNhbGwoYXJndW1lbnRzLCAwKSA6IFtdOwogICAgICBmb3IgKF9qID0gMCwgX2xlbjEgPSBiaW5kZWRGdW5jcy5sZW5ndGg7IF9qIDwgX2xlbjE7IF9qKyspIHsKICAgICAgICBmdW5jID0gYmluZGVkRnVuY3NbX2pdOwogICAgICAgIGZ1bmMuYXBwbHkodGhpcywgX19zbGljZS5jYWxsKGFyZ3MpKTsKICAgICAgfQogICAgfTsKICAgIHJldHVybiBjYWxsYmFjazsKICB9OwoKICBLYXppdG9yaS5wcm90b3R5cGUuX3R5cGVDaGVjayA9IGZ1bmN0aW9uKGEsIHQpIHsKICAgIHZhciBtYXRjaGVkLCB0eXBlLCBfaSwgX2xlbjsKICAgIG1hdGNoZWQgPSBmYWxzZTsKICAgIGZvciAoX2kgPSAwLCBfbGVuID0gVkFSSUFCTEVfVFlQRVMubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHsKICAgICAgdHlwZSA9IFZBUklBQkxFX1RZUEVTW19pXTsKICAgICAgaWYgKHQudG9Mb3dlckNhc2UoKSA9PT0gdHlwZS5uYW1lKSB7CiAgICAgICAgaWYgKHR5cGUuY2FzdChhKSkgewogICAgICAgICAgbWF0Y2hlZCA9IHRydWU7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gbWF0Y2hlZDsKICB9OwoKICByZXR1cm4gS2F6aXRvcmk7Cgp9KSgpOwoKLyoqCiogcHVzaFN0YXRlIOOBp+WHpueQhuOBl+OBn+OBhOODq+ODvOODq+OCkuWumue+qeOBmeOCi+OCr+ODqeOCuQoqCiogQGNsYXNzIFJ1bGUKKiBAY29uc3RydWN0b3IKKiBAcGFyYW0ge1N0cmluZ30gcnVsZQoqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrCiogQHBhcmFtIHtLYXppdG9yaX0gcm91dGVyCiovCgoKUnVsZSA9IChmdW5jdGlvbigpIHsKICAvKioKICAqIOODq+ODvOODq+aWh+Wtl+WIlwogICogQHByb3BlcnR5IHJ1bGUKICAqIEB0eXBlIFN0cmluZwogICogQGRlZmF1bHQgIiIKICAqLwoKICBSdWxlLnByb3RvdHlwZS5ydWxlID0gIiI7CgogIFJ1bGUucHJvdG90eXBlLl9yZWdleHAgPSBudWxsOwoKICAvKioKICAqIOOCs+ODvOODq+ODkOODg+OCr+mWouaVsAogICog44Or44O844Or44Go44Oe44OD44OB44GZ44KL5aC05ZCI5a6f6KGM44GV44KM44G+44GZ44CCCiAgKiBAcHJvcGVydHkgY2FsbGJhY2sKICAqIEB0eXBlOiBGdW5jdGlvbgogICogQGRlZmF1bHQgbnVsbAogICovCgoKICBSdWxlLnByb3RvdHlwZS5jYWxsYmFjayA9IG51bGw7CgogIFJ1bGUucHJvdG90eXBlLm5hbWUgPSAiIjsKCiAgUnVsZS5wcm90b3R5cGUucm91dGVyID0gbnVsbDsKCiAgUnVsZS5wcm90b3R5cGUuaXNWYXJpYWJsZSA9IGZhbHNlOwoKICBSdWxlLnByb3RvdHlwZS50eXBlcyA9IFtdOwoKICBmdW5jdGlvbiBSdWxlKHJ1bGUsIGNhbGxiYWNrLCByb3V0ZXIpIHsKICAgIHRoaXMudXBkYXRlID0gX19iaW5kKHRoaXMudXBkYXRlLCB0aGlzKTsKICAgIGlmICh0eXBlb2YgcnVsZSAhPT0gInN0cmluZyIgJiYgdHlwZW9mIHJ1bGUgIT09ICJOdW1iZXIiKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuY2FsbGJhY2sgPSBjYWxsYmFjazsKICAgIHRoaXMucm91dGVyID0gcm91dGVyOwogICAgdGhpcy51cGRhdGUocnVsZSk7CiAgfQoKICAvKioKICAqIFJ1bGUg44Go44GX44Gm5a6a576p44GX44Gf44OR44K/44O844Oz44GoIGZyYWdtZW50IOOBqOOBl+OBpuS4juOBiOOCieOCjOOBn+aWh+Wtl+WIl+OBjOODnuODg+ODgeOBmeOCi+OBi+OBqeOBhuOBi+ODhuOCueODiOOBmeOCiwogICogQG1ldGhvZCB0ZXN0CiAgKiBAcGFyYW0ge1N0cmluZ30gZnJhZ21lbnQKICAqIEByZXR1cm4ge0Jvb2xlYW59IOODnuODg+ODgeOBmeOCi+WgtOWQiCB0cnVlIOOCkui/lOOBmQogICovCgoKICBSdWxlLnByb3RvdHlwZS50ZXN0ID0gZnVuY3Rpb24oZnJhZ21lbnQpIHsKICAgIHJldHVybiB0aGlzLl9yZWdleHAudGVzdChmcmFnbWVudCk7CiAgfTsKCiAgUnVsZS5wcm90b3R5cGUuX3J1bGVUb1JlZ0V4cCA9IGZ1bmN0aW9uKHJ1bGUpIHsKICAgIHZhciBuZXdSdWxlOwogICAgbmV3UnVsZSA9IHJ1bGUucmVwbGFjZShlc2NhcGVSZWdFeHAsICdcXCQmJykucmVwbGFjZShvcHRpb25hbFBhcmFtLCAnKD86JDEpPycpLnJlcGxhY2UobmFtZWRQYXJhbSwgJyhbXlwvXSspJykucmVwbGFjZShzcGxhdFBhcmFtLCAnKC4qPyknKTsKICAgIHJldHVybiBuZXcgUmVnRXhwKCdeJyArIG5ld1J1bGUgKyAnJCcpOwogIH07CgogIC8qKgogICog5LiO44GI44KJ44KM44GfIHBhdGgg44Gn54++5Zyo44GuIFJ1bGUg44KS44Ki44OD44OX44OH44O844OI44GX44G+44GZ44CCCiAgKiBAbWV0aG9kIHVwZGF0ZQogICogQHBhcmFtIHtTdHJpbmd9IHBhdGgKICAqLwoKCiAgUnVsZS5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24ocGF0aCkgewogICAgdmFyIG0sIG1hdGNoZWQsIHJlLCB0LCBfaSwgX2xlbiwgX3Jlc3VsdHM7CiAgICB0aGlzLnJ1bGUgPSBwYXRoICsgdGhpcy5ydWxlOwogICAgaWYgKHRoaXMucnVsZSAhPT0gJy8nKSB7CiAgICAgIHRoaXMucnVsZSA9IHRoaXMucnVsZS5yZXBsYWNlKHRyYWlsaW5nU2xhc2gsICcnKTsKICAgIH0KICAgIHRoaXMuX3JlZ2V4cCA9IHRoaXMuX3J1bGVUb1JlZ0V4cCh0aGlzLnJ1bGUpOwogICAgcmUgPSBuZXcgUmVnRXhwKG5hbWVkUGFyYW0pOwogICAgbWF0Y2hlZCA9IHBhdGgubWF0Y2gocmUpOwogICAgaWYgKG1hdGNoZWQgIT09IG51bGwpIHsKICAgICAgdGhpcy5pc1ZhcmlhYmxlID0gdHJ1ZTsKICAgICAgX3Jlc3VsdHMgPSBbXTsKICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSBtYXRjaGVkLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7CiAgICAgICAgbSA9IG1hdGNoZWRbX2ldOwogICAgICAgIHQgPSBtLm1hdGNoKGdlbmVyaWNQYXJhbSkgfHwgbnVsbDsKICAgICAgICBfcmVzdWx0cy5wdXNoKHRoaXMudHlwZXMucHVzaCh0ICE9PSBudWxsID8gdFsxXSA6IG51bGwpKTsKICAgICAgfQogICAgICByZXR1cm4gX3Jlc3VsdHM7CiAgICB9CiAgfTsKCiAgcmV0dXJuIFJ1bGU7Cgp9KSgpOwoKLyoqCiog44Kk44OZ44Oz44OI44OH44Kj44K544OR44OD44OB44OjCiogQGNsYXNzIEV2ZW50RGlzcGF0Y2hlcgoqIEBjb25zdHJ1Y3RvcgoqLwoKCkV2ZW50RGlzcGF0Y2hlciA9IChmdW5jdGlvbigpIHsKICBmdW5jdGlvbiBFdmVudERpc3BhdGNoZXIoKSB7fQoKICBFdmVudERpc3BhdGNoZXIucHJvdG90eXBlLmxpc3RlbmVycyA9IHt9OwoKICBFdmVudERpc3BhdGNoZXIucHJvdG90eXBlLmFkZEV2ZW50TGlzdGVuZXIgPSBmdW5jdGlvbih0eXBlLCBsaXN0ZW5lcikgewogICAgaWYgKHRoaXMubGlzdGVuZXJzW3R5cGVdID09PSB2b2lkIDApIHsKICAgICAgdGhpcy5saXN0ZW5lcnNbdHlwZV0gPSBbXTsKICAgIH0KICAgIGlmICh0aGlzLl9pbkFycmF5KGxpc3RlbmVyLCB0aGlzLmxpc3RlbmVyc1t0eXBlXSkgPCAwKSB7CiAgICAgIHRoaXMubGlzdGVuZXJzW3R5cGVdLnB1c2gobGlzdGVuZXIpOwogICAgfQogIH07CgogIEV2ZW50RGlzcGF0Y2hlci5wcm90b3R5cGUucmVtb3ZlRXZlbnRMaXN0ZW5lciA9IGZ1bmN0aW9uKHR5cGUsIGxpc3RlbmVyKSB7CiAgICB2YXIgYXJyLCBpLCBsZW4sIHByb3A7CiAgICBsZW4gPSAwOwogICAgZm9yIChwcm9wIGluIHRoaXMubGlzdGVuZXJzKSB7CiAgICAgIGxlbisrOwogICAgfQogICAgaWYgKGxlbiA8IDEpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgYXJyID0gdGhpcy5saXN0ZW5lcnNbdHlwZV07CiAgICBpZiAoIWFycikgewogICAgICByZXR1cm47CiAgICB9CiAgICBpID0gMDsKICAgIGxlbiA9IGFyci5sZW5ndGg7CiAgICB3aGlsZSAoaSA8IGxlbikgewogICAgICBpZiAoYXJyW2ldID09PSBsaXN0ZW5lcikgewogICAgICAgIGlmIChsZW4gPT09IDEpIHsKICAgICAgICAgIGRlbGV0ZSB0aGlzLmxpc3RlbmVyc1t0eXBlXTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgYXJyLnNwbGljZShpLCAxKTsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgaSsrOwogICAgfQogIH07CgogIEV2ZW50RGlzcGF0Y2hlci5wcm90b3R5cGUuZGlzcGF0Y2hFdmVudCA9IGZ1bmN0aW9uKGV2ZW50KSB7CiAgICB2YXIgYXJ5LCBoYW5kbGVyLCBfaSwgX2xlbjsKICAgIGFyeSA9IHRoaXMubGlzdGVuZXJzW2V2ZW50LnR5cGVdOwogICAgaWYgKGFyeSAhPT0gdm9pZCAwKSB7CiAgICAgIGV2ZW50LnRhcmdldCA9IHRoaXM7CiAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gYXJ5Lmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7CiAgICAgICAgaGFuZGxlciA9IGFyeVtfaV07CiAgICAgICAgaGFuZGxlci5jYWxsKHRoaXMsIGV2ZW50KTsKICAgICAgfQogICAgfQogIH07CgogIEV2ZW50RGlzcGF0Y2hlci5wcm90b3R5cGUuX2luQXJyYXkgPSBmdW5jdGlvbihlbGVtLCBhcnJheSkgewogICAgdmFyIGksIGxlbjsKICAgIGkgPSAwOwogICAgbGVuID0gYXJyYXkubGVuZ3RoOwogICAgd2hpbGUgKGkgPCBsZW4pIHsKICAgICAgaWYgKGFycmF5W2ldID09PSBlbGVtKSB7CiAgICAgICAgcmV0dXJuIGk7CiAgICAgIH0KICAgICAgaSsrOwogICAgfQogICAgcmV0dXJuIC0xOwogIH07CgogIHJldHVybiBFdmVudERpc3BhdGNoZXI7Cgp9KSgpOwoKRGVmZmVyZWQgPSAoZnVuY3Rpb24oX3N1cGVyKSB7CiAgX19leHRlbmRzKERlZmZlcmVkLCBfc3VwZXIpOwoKICBEZWZmZXJlZC5wcm90b3R5cGUucXVldWUgPSBbXTsKCiAgRGVmZmVyZWQucHJvdG90eXBlLmlzU3VzcGVuZCA9IGZhbHNlOwoKICBmdW5jdGlvbiBEZWZmZXJlZCgpIHsKICAgIHRoaXMucXVldWUgPSBbXTsKICAgIHRoaXMuaXNTdXNwZW5kID0gZmFsc2U7CiAgfQoKICBEZWZmZXJlZC5wcm90b3R5cGUuZGVmZmVyZWQgPSBmdW5jdGlvbihmdW5jKSB7CiAgICB0aGlzLnF1ZXVlLnB1c2goZnVuYyk7CiAgICByZXR1cm4gdGhpczsKICB9OwoKICBEZWZmZXJlZC5wcm90b3R5cGUuZXhlY3V0ZSA9IGZ1bmN0aW9uKCkgewogICAgdmFyIGVycm9yLCB0YXNrOwogICAgaWYgKHRoaXMuaXNTdXNwZW5kKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRyeSB7CiAgICAgIHRhc2sgPSB0aGlzLnF1ZXVlLnNoaWZ0KCk7CiAgICAgIGlmICh0YXNrKSB7CiAgICAgICAgdGFzay5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CiAgICAgIGlmICh0aGlzLnF1ZXVlLmxlbmd0aCA8IDEpIHsKICAgICAgICB0aGlzLnF1ZXVlID0gW107CiAgICAgICAgcmV0dXJuIHRoaXMuZGlzcGF0Y2hFdmVudChuZXcgS2F6aXRvcmlFdmVudChLYXppdG9yaUV2ZW50LlRBU0tfUVVFVUVfQ09NUExFVEUpKTsKICAgICAgfQogICAgfSBjYXRjaCAoX2Vycm9yKSB7CiAgICAgIGVycm9yID0gX2Vycm9yOwogICAgICByZXR1cm4gdGhpcy5yZWplY3QoZXJyb3IpOwogICAgfQogIH07CgogIERlZmZlcmVkLnByb3RvdHlwZS5yZWplY3QgPSBmdW5jdGlvbihlcnJvcikgewogICAgdmFyIG1lc3NhZ2U7CiAgICBtZXNzYWdlID0gIWVycm9yID8gInVzZXIgcmVqZWN0IiA6IGVycm9yOwogICAgdGhpcy5kaXNwYXRjaEV2ZW50KHsKICAgICAgdHlwZTogS2F6aXRvcmlFdmVudC5UQVNLX1FVRVVFX0ZBSUxFRCwKICAgICAgaW5kZXg6IHRoaXMuaW5kZXgsCiAgICAgIG1lc3NhZ2U6IG1lc3NhZ2UKICAgIH0pOwogICAgcmV0dXJuIHRoaXMuaXNTdXNwZW5kID0gZmFsc2U7CiAgfTsKCiAgRGVmZmVyZWQucHJvdG90eXBlLnN1c3BlbmQgPSBmdW5jdGlvbigpIHsKICAgIHRoaXMuaXNTdXNwZW5kID0gdHJ1ZTsKICB9OwoKICBEZWZmZXJlZC5wcm90b3R5cGUucmVzdW1lID0gZnVuY3Rpb24oKSB7CiAgICB0aGlzLmlzU3VzcGVuZCA9IGZhbHNlOwogICAgdGhpcy5leGVjdXRlKCk7CiAgfTsKCiAgcmV0dXJuIERlZmZlcmVkOwoKfSkoRXZlbnREaXNwYXRjaGVyKTsKCi8qKgoqIHB1c2hTdGF0ZSDlh6bnkIbjgoQgS2F6aXRvcmkg44Gr44G+44Gk44KP44KL44Kk44OZ44Oz44OICiogQGNsYXNzIEtheml0b3JpRXZlbnQKKiBAY29uc3RydWN0b3IKKiBAcGFyYW0ge1N0cmluZ30gdHlwZQoqIEBwYXJhbSB7U3RyaW5nfSBuZXh0CiogQHBhcmFtIHtTdHJpbmd9IHByZXYKKi8KCgpLYXppdG9yaUV2ZW50ID0gKGZ1bmN0aW9uKCkgewogIEtheml0b3JpRXZlbnQucHJvdG90eXBlLm5leHQgPSBudWxsOwoKICBLYXppdG9yaUV2ZW50LnByb3RvdHlwZS5wcmV2ID0gbnVsbDsKCiAgS2F6aXRvcmlFdmVudC5wcm90b3R5cGUudHlwZSA9IG51bGw7CgogIGZ1bmN0aW9uIEtheml0b3JpRXZlbnQodHlwZSwgbmV4dCwgcHJldikgewogICAgdGhpcy50eXBlID0gdHlwZTsKICAgIHRoaXMubmV4dCA9IG5leHQ7CiAgICB0aGlzLnByZXYgPSBwcmV2OwogIH0KCiAgS2F6aXRvcmlFdmVudC5wcm90b3R5cGUuY2xvbmUgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiBuZXcgS2F6aXRvcmlFdmVudCh0aGlzLnR5cGUsIHRoaXMubmV4dCwgdGhpcy5wcmV2KTsKICB9OwoKICBLYXppdG9yaUV2ZW50LnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuICJLYXppdG9yaUV2ZW50IDo6ICIgKyAidHlwZToiICsgdGhpcy50eXBlICsgIiBuZXh0OiIgKyBTdHJpbmcodGhpcy5uZXh0KSArICIgcHJldjoiICsgU3RyaW5nKHRoaXMucHJldik7CiAgfTsKCiAgcmV0dXJuIEtheml0b3JpRXZlbnQ7Cgp9KSgpOwoKLyoqCiog44K/44K544Kv44Kt44Ol44O844GM56m644Gr44Gq44Gj44GfCiogQHByb3BlcnR5IFRBU0tfUVVFVUVfQ09NUExFVEUKKiBAdHlwZSBTdHJpbmcKKiBAZGVmYXVsdCB0YXNrX3F1ZXVlX2NvbXBsZXRlCiovCgoKS2F6aXRvcmlFdmVudC5UQVNLX1FVRVVFX0NPTVBMRVRFID0gJ3Rhc2tfcXVldWVfY29tcGxldGUnOwoKLyoqCiog44K/44K544Kv44Kt44Ol44O844GM5Lit5pat44GV44KM44GfCiogQHByb3BlcnR5IFRBU0tfUVVFVUVfRkFJTEVECiogQHR5cGUgU3RyaW5nCiogQGRlZmF1bHQgdGFza19xdWV1ZV9mYWlsZWQKKi8KCgpLYXppdG9yaUV2ZW50LlRBU0tfUVVFVUVfRkFJTEVEID0gJ3Rhc2tfcXVldWVfZmFpbGVkJzsKCi8qKgoqIFVSTCDjgYzlpInmm7TjgZXjgozjgZ8KKiBAcHJvcGVydHkgQ0hBTkdFCiogQHR5cGUgU3RyaW5nCiogQGRlZmF1bHQgY2hhbmdlCiovCgoKS2F6aXRvcmlFdmVudC5DSEFOR0UgPSAnY2hhbmdlJzsKCi8qKgoqIFVSTCDjgavnmbvpjLLjgZXjgozjgZ/jg6Hjgr3jg4Pjg4njgYzjgaHjgoPjgpPjgajlrp/ooYzjgZXjgozjgZ8KKiBAcHJvcGVydHkgRVhFQ1VURUQKKiBAdHlwZSBTdHJpbmcKKiBAZGVmYXVsdCBleGVjdXRlZAoqLwoKCktheml0b3JpRXZlbnQuRVhFQ1VURUQgPSAnZXhlY3V0ZWQnOwoKLyoqCiog5LqL5YmN5Yem55CG44GM5a6M5LqG44GX44GfCiogQHByb3BlcnR5IEJFRk9SRV9FWEVDVVRFRAoqIEB0eXBlIFN0cmluZwoqIEBkZWZhdWx0IGJlZm9yZV9leGVjdXRlZAoqLwoKCktheml0b3JpRXZlbnQuQkVGT1JFX0VYRUNVVEVEID0gJ2JlZm9yZV9leGVjdXRlZCc7CgovKioKKiDjg6bjg7zjgrbjg7zjgqLjgq/jgrfjg6fjg7Pku6XlpJbjgacgVVJMIOOBruWkieabtOOBjOOBguOBo+OBnwoqIEBwcm9wZXJ0eSBJTlRFUk5BTF9DSEFOR0UKKiBAdHlwZSBTdHJpbmcKKiBAZGVmYXVsdCBpbnRlcm5hbF9jaGFuZ2UKKi8KCgpLYXppdG9yaUV2ZW50LklOVEVSTkFMX0NIQU5HRSA9ICdpbnRlcm5hbF9jaGFuZ2UnOwoKS2F6aXRvcmlFdmVudC5VU0VSX0NIQU5HRSA9ICd1c2VyX2NoYW5nZSc7CgovKioKKiDjg5Ljgrnjg4jjg6rjg7zjg5Djg4Pjgq/jgZfjgZ8KKiBAcHJvcGVydHkgUFJFVgoqIEB0eXBlIFN0cmluZwoqIEBkZWZhdWx0IHByZXYKKi8KCgpLYXppdG9yaUV2ZW50LlBSRVYgPSAncHJldic7CgovKioKKiDjg5Ljgrnjg4jjg6rjg7zjg43jgq/jgrnjg4jjgZfjgZ/mmYIKKiBAcHJvcGVydHkgTkVYVAoqIEB0eXBlIFN0cmluZwoqIEBkZWZhdWx0IG5leHQKKi8KCgpLYXppdG9yaUV2ZW50Lk5FWFQgPSAnbmV4dCc7CgovKioKKiBLYXppdG9yaSDjgYzkuK3mlq3jgZfjgZ8KKiBAcHJvcGVydHkgUkVKRUNUCiogQHR5cGUgU3RyaW5nCiogQGRlZmF1bHQgcmVqZWN0CiovCgoKS2F6aXRvcmlFdmVudC5SRUpFQ1QgPSAncmVqZWN0JzsKCi8qKgoqIFVSTCDjgavjg57jg4Pjg4HjgZnjgovlh6bnkIbjgYzopovjgaTjgYvjgonjgarjgYvjgaPjgZ8KKiBAcHJvcGVydHkgTk9UX0ZPVU5ECiogQHR5cGUgU3RyaW5nCiogQGRlZmF1bHQgbm90X2ZvdW5kCiovCgoKS2F6aXRvcmlFdmVudC5OT1RfRk9VTkQgPSAnbm90X2ZvdW5kJzsKCi8qKgoqIEtheml0b3JpIOOBjOmWi+Wni+OBl+OBnwoqIEBwcm9wZXJ0eSBTVEFSVAoqIEB0eXBlIFN0cmluZwoqIEBkZWZhdWx0IHN0YXJ0CiovCgoKS2F6aXRvcmlFdmVudC5TVEFSVCA9ICdzdGFydCc7CgovKioKKiBLYXppdG9yaSDjgYzlgZzmraLjgZfjgZ8KKiBAcHJvcGVydHkgU1RPUAoqIEB0eXBlIFN0cmluZwoqIEBkZWZhdWx0IHN0b3AKKi8KCgpLYXppdG9yaUV2ZW50LlNUT1AgPSAnc3RvcCc7CgovKioKKiBLYXppdG9yaSDjgYzkuIDmmYLlgZzmraLjgZfjgZ8KKiBAcHJvcGVydHkgU1VTUEVORAoqIEB0eXBlIFN0cmluZwoqIEBkZWZhdWx0IFNVU1BFTkQKKi8KCgpLYXppdG9yaUV2ZW50LlNVU1BFTkQgPSAnU1VTUEVORCc7CgovKioKKiBLYXppdG9yaSDjgYzlho3plovjgZfjgZ8KKiBAcHJvcGVydHkgUkVTVU1FCiogQHR5cGUgU3RyaW5nCiogQGRlZmF1bHQgcmVzdW1lCiovCgoKS2F6aXRvcmlFdmVudC5SRVNVTUUgPSAncmVzdW1lJzsKCi8qKgoqIEtheml0b3JpIOOBjOmWi+Wni+OBl+OBpuOBi+OCieOAgeS4gOeVquacgOWIneOBruOCouOCr+OCu+OCueOBjOOBguOBo+OBnwoqIEBwcm9wZXJ0eSBGSVJTVF9SRVFVRVNUCiogQHR5cGUgU3RyaW5nCiogQGRlZmF1bHQgZmlyc3RfcmVxdWVzdAoqLwoKCktheml0b3JpRXZlbnQuRklSU1RfUkVRVUVTVCA9ICdmaXJzdF9yZXF1ZXN0JzsKCi8qKgoqIOODq+ODvOOCv+ODvOOBjOi/veWKoOOBleOCjOOBnwoqIEBwcm9wZXJ0eSBBRERFRAoqIEB0eXBlIFN0cmluZwoqIEBkZWZhdWx0IGFkZGVkCiovCgoKS2F6aXRvcmlFdmVudC5BRERFRCA9ICdhZGRlZCc7CgovKioKKiDjg6vjg7zjgr/jg7zjgYzliYrpmaTjgZXjgozjgZ8KKiBAcHJvcGVydHkgUkVNT1ZFRAoqIEB0eXBlIFN0cmluZwoqIEBkZWZhdWx0IHJlbW92ZWQKKi8KCgpLYXppdG9yaUV2ZW50LlJFTU9WRUQgPSAncmVtb3ZlZCc7Cg==",
                "body": "dmFyIERlZmZlcmVkLCBFdmVudERpc3BhdGNoZXIsIEtheml0b3JpLCBLYXppdG9yaUV2ZW50LCBSdWxlLCBWQVJJQUJMRV9UWVBFUywgZGVsZWdhdGVyLCBlc2NhcGVSZWdFeHAsIGdlbmVyaWNQYXJhbSwgbmFtZWRQYXJhbSwgb3B0aW9uYWxQYXJhbSwgcm91dGVTdHJpcHBlciwgc3BsYXRQYXJhbSwgdHJhaWxpbmdTbGFzaCwKICBfX2JpbmQgPSBmdW5jdGlvbihmbiwgbWUpeyByZXR1cm4gZnVuY3Rpb24oKXsgcmV0dXJuIGZuLmFwcGx5KG1lLCBhcmd1bWVudHMpOyB9OyB9LAogIF9faW5kZXhPZiA9IFtdLmluZGV4T2YgfHwgZnVuY3Rpb24oaXRlbSkgeyBmb3IgKHZhciBpID0gMCwgbCA9IHRoaXMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7IGlmIChpIGluIHRoaXMgJiYgdGhpc1tpXSA9PT0gaXRlbSkgcmV0dXJuIGk7IH0gcmV0dXJuIC0xOyB9LAogIF9fc2xpY2UgPSBbXS5zbGljZSwKICBfX2hhc1Byb3AgPSB7fS5oYXNPd25Qcm9wZXJ0eSwKICBfX2V4dGVuZHMgPSBmdW5jdGlvbihjaGlsZCwgcGFyZW50KSB7IGZvciAodmFyIGtleSBpbiBwYXJlbnQpIHsgaWYgKF9faGFzUHJvcC5jYWxsKHBhcmVudCwga2V5KSkgY2hpbGRba2V5XSA9IHBhcmVudFtrZXldOyB9IGZ1bmN0aW9uIGN0b3IoKSB7IHRoaXMuY29uc3RydWN0b3IgPSBjaGlsZDsgfSBjdG9yLnByb3RvdHlwZSA9IHBhcmVudC5wcm90b3R5cGU7IGNoaWxkLnByb3RvdHlwZSA9IG5ldyBjdG9yKCk7IGNoaWxkLl9fc3VwZXJfXyA9IHBhcmVudC5wcm90b3R5cGU7IHJldHVybiBjaGlsZDsgfTsKCmRlbGVnYXRlciA9IGZ1bmN0aW9uKHRhcmdldCwgZnVuYykgewogIHJldHVybiBmdW5jdGlvbigpIHsKICAgIHJldHVybiBmdW5jLmFwcGx5KHRhcmdldCwgYXJndW1lbnRzKTsKICB9Owp9OwoKdHJhaWxpbmdTbGFzaCA9IC9cLyQvOwoKcm91dGVTdHJpcHBlciA9IC9eWyNcL118XHMrJC9nOwoKZXNjYXBlUmVnRXhwID0gL1tcLXt9XFtcXSs/LixcXFxeJHwjXHNdL2c7CgpuYW1lZFBhcmFtID0gLzwoXHcrfFtBLVphLXpfLV0rOlx3Kyk+L2c7CgpnZW5lcmljUGFyYW0gPSAvKFtBLVphLXpfLV0rKTooXHcrKS87CgpvcHRpb25hbFBhcmFtID0gL1woKC4qPylcKS9nOwoKc3BsYXRQYXJhbSA9IC9cKlx3Ky9nOwoKLypVUkwg5aSJ5pWw44Gr5a++44GX44Gm5oyH5a6a44Gn44GN44KL5Z6LKi8KCgpWQVJJQUJMRV9UWVBFUyA9IFsKICB7CiAgICBuYW1lOiAiaW50IiwKICAgIGNhc3Q6IE51bWJlcgogIH0sIHsKICAgIG5hbWU6ICJzdHJpbmciLAogICAgY2FzdDogU3RyaW5nCiAgfQpdOwoKLyoqCiogS2F6aXRvcmkuanMg44GvIHB1c2hTdGF0ZSDjgpLjgYTjgYTmhJ/jgZjjgavjgZXjgbDjgYTjgabjgY/jgozjgovjg6vjg7zjgr/jg7zjg6njgqTjg5bjg6njg6rjgafjgZnjgII8YnI+Ciog44K344Oz44OX44Or44GL44Gk6KaL6YCa44GX44KI44GPIHB1c2hTdGF0ZSDjgrPjg7Pjg4bjg7Pjg4Tjga7jg6vjg7zjg4bjgqPjg7PjgrDjgpLlrprnvqnjgZnjgovjgZPjgajjgYzjgafjgY3jgb7jgZnjgIIKKgoqIOS9v+OBhOaWueOBr+OBqOOBpuOCguewoeWNmOOAggoqIDx1bD48bGk+S2F6aXRvcmkg44KS57aZ5om/44GX44Gf44Kv44Op44K544KS5L2c44KLPC9saT48bGk+cm91dGVzIOOBq+aJseOBhOOBn+OBhCBVUkwg44Go44CB44Gd44KM44Gr5a++5b+c44GX44Gf44Oh44K944OD44OJ44KS5oyH5a6a44CCPC9saT48bGk+44Kk44Oz44K544K/44Oz44K55YyWPC9saT48L3VsPgoqCiogPGg0PmV4YW1wbGU8L2g0PgoqICAgICAgY2xhc3MgUm91dGVyIGV4dGVuZHMgS2F6aXRvcmkKKiAgICAgICAgcm91dGVzOgoqICAgICAgICAgICIvIjogImluZGV4IgoqICAgICAgICAgICIvPGludDppZD4iOiAic2hvdyIKKgoqICAgICAgICBpbmRleDooKS0+CiogICAgICAgICAgY29uc29sZS5sb2cgImluZGV4ISIKKiAgICAgICAgc2hvdzooaWQpLT4KKiAgICAgICAgICBjb25zb2xlLmxvZyBpZAoqCiogICAgICAkKCgpLT4KKiAgICAgICAgYXBwID0gbmV3IFJvdXRlcigpCiogICAgICApCioKKiBLYXppdG9yaSDjgafjga8gcHVzaFN0YXRlIOOBp+mdnuWQjOacn+OCs+ODs+ODhuODs+ODhOOCkuS9nOOBo+OBpuOBhOOBj+S4iuOBp+W/heimgeOBqOOBquOCi+OBp+OBguOCjeOBhuapn+iDveOCkuS7luOBq+OCguayouWxseeUqOaEj+OBl+OBpuOBhOOBvuOBmeOAgjxicj4KKiDoqbPntLDjga8gQVBJIOS4gOimp+OBi+OCieeiuuiqjeOBl+OBpuS4i+OBleOBhOOAggoqIEBtb2R1bGUgS2F6aXRvcmkuanMKKiBAbWFpbiBLYXppdG9yaQoqLwoKCi8qKgoqICBLYXppdG9yaSDjga7jg6HjgqTjg7Pjgq/jg6njgrkKKgoqICBAY2xhc3MgS2F6aXRvcmkKKiAgQGNvbnN0cnVjdG9yCiovCgoKS2F6aXRvcmkgPSAoZnVuY3Rpb24oKSB7CiAgS2F6aXRvcmkucHJvdG90eXBlLlZFUlNJT04gPSAiMS4wLjIiOwoKICBLYXppdG9yaS5wcm90b3R5cGUuaGlzdG9yeSA9IG51bGw7CgogIEtheml0b3JpLnByb3RvdHlwZS5sb2NhdGlvbiA9IG51bGw7CgogIC8qKgogICog44Oe44OD44OB44GZ44KLVVJM44Gu44Or44O844Or44Go44CB44Gd44KM44Gr5a++5b+c44GZ44KL5Yem55CG44KS5a6a576p44GX44G+44GZ44CCCiAgKiA8aDQ+ZXhhbXBsZTwvaDQ+CiAgKiAgICAgcm91dGVzOgogICogICAgICAgJy8nOidpbmRleCcKICAqICAgICAgICcvPGludDppZD4nOidzaG93JwogICoKICAqIEBwcm9wZXJ0eSByb3V0ZXMKICAqIEB0eXBlIE9iamVjdAogICogQGRlZmF1bHQge30KICAqLwoKCiAgS2F6aXRvcmkucHJvdG90eXBlLnJvdXRlcyA9IHt9OwoKICBLYXppdG9yaS5wcm90b3R5cGUuaGFuZGxlcnMgPSBbXTsKCiAgLyoqCiAgKiDjg57jg4Pjg4HjgZfjgZ8gVVJMIOOBq+WvvuOBmeOCi+WHpueQhuOCkuihjOOBhuWJjeOBq+Wun+ihjOOBl+OBn+OBhOWHpueQhuOCkuWumue+qeOBl+OBvuOBmeOAggogICogQHByb3BlcnR5IGJlZm9yZXMKICAqIEB0eXBlIE9iamVjdAogICogQGRlZmF1bHQge30KICAqLwoKCiAgS2F6aXRvcmkucHJvdG90eXBlLmJlZm9yZXMgPSB7fTsKCiAgS2F6aXRvcmkucHJvdG90eXBlLmJlZm9yZUhhbmRsZXJzID0gW107CgogIC8qKgogICogVVJMIOOBjOWkieOCj+OCi+mam+OAgeS6i+WJjeOBq+Wun+ihjOOBl+OBn+OBhOWHpueQhuOCkuWumue+qeOBl+OBvuOBmeOAgjxicj4KICAqIOOBk+OBruODl+ODreODkeODhuOCo+OBq+eZu+mMsuOBleOCjOOBn+WHpueQhuOBr+OAgeS4juOBiOOCieOCjOOBnyBVUkwg44Gr44Oe44OD44OB44GZ44KL44GL44Gp44GG44GL44Gr44GL44GL44KP44KJ44Ga44CB5bi444Gr5a6f6KGM44GV44KM44G+44GZ44CCCiAgKiBAcHJvcGVydHkgYmVmb3JlQW55dGltZUhhbmRsZXIKICAqIEB0eXBlIEFycmF5CiAgKiBAZGVmYXVsdCBbXQogICovCgoKICBLYXppdG9yaS5wcm90b3R5cGUuYmVmb3JlQW55dGltZUhhbmRsZXIgPSBudWxsOwoKICBLYXppdG9yaS5wcm90b3R5cGUuYWZ0ZXJoYW5kbGVycyA9IFtdOwoKICAvKioKICAqIOeJueWumuOBruODleOCoeOCpOODq+WQjeOBjCBVUkwg44Gr5ZCr44G+44KM44Gm44GE44Gf5pmC44CB44Or44O844OI44Go44GX44Gm5Yem55CG44GZ44KL44Oq44K544OI44Gn44GZ44CCCiAgKiBAcHJvcGVydHkgcm9vdEZpbGVzCiAgKiBAdHlwZSBBcnJheQogICovCgoKICBLYXppdG9yaS5wcm90b3R5cGUucm9vdEZpbGVzID0gWydpbmRleC5odG1sJywgJ2luZGV4Lmh0bScsICdpbmRleC5waHAnLCAndW5rby5odG1sJ107CgogIC8qKgogICog44Or44O844OI44KS5oyH5a6a44GX44G+44GZ44CCPGJyPgogICog44GT44GT44Gn5oyH5a6a44GV44KM44Gf5YCk44GMIFVSTCDjga4gcHJlZml4IOOBqOOBl+OBpuW/heOBmuOBpOOBjeOBvuOBmeOAgjxicj4KICAqIOeJqeeQhueahOOBqyBVUkwg44Gu44Or44O844OI44KI44KKIDHjg4fjgqPjg6zjgq/jg4jjg6rkuIvjgYzjgaPjgZ/nrofmiYDjgacgcHVzaFN0YXRlIOOCkuihjOOBhOOBn+OBhOWgtOWQiDxicj4KICAqIOOBk+OBruWApOOCkiAvIOS7peWkluOBq+aMh+WumuOBl+OBvuOBmeOAggogICogPGg0PmV4YW1wbGU8L2g0PgogICog44Kz44Oz44OG44Oz44OE44KS6YWN572u44GZ44KL5a6f44OH44Kj44Os44Kv44OI44Oq44GMIGV4YW1wbGUg44Gg44Gj44Gf5aC05ZCICiAgKgogICogICAgIGFwcCA9IG5ldyBSb3V0ZXIoe3Jvb3Q6Jy9leGFtcGxlLyd9KQogICogQHByb3BlcnR5IHJvb3QKICAqIEB0eXBlIFN0cmluZwogICogQGRlZmF1bHQgLwogICovCgoKICBLYXppdG9yaS5wcm90b3R5cGUucm9vdCA9IG51bGw7CgogIC8qKgogICog54++5Zyo44GuIFVSTCDjgavjg57jg4Pjg4HjgZnjgovjg6vjg7zjg6vjgYzjgarjgYvjgaPjgZ/loLTlkIjjgavlpInmm7TjgZnjgosgVVJMCiAgKiBAcHJvcGVydHkgbm90Rm91bmQKICAqIEB0eXBlIFN0cmluZwogICogQGRlZmF1bHQgbnVsbAogICovCgoKICBLYXppdG9yaS5wcm90b3R5cGUubm90Rm91bmQgPSBudWxsOwoKICBLYXppdG9yaS5wcm90b3R5cGUuZGlyZWN0ID0gbnVsbDsKCiAgS2F6aXRvcmkucHJvdG90eXBlLmlzSUUgPSBmYWxzZTsKCiAgLyoqCiAgKiBVUkwg44KS5a6f6Zqb44Gr44Gv5aSJ5pu044GX44Gq44GE44KI44GG44Gr44GZ44KL44GL44Gp44GG44GL44KS5rG65a6a44GX44G+44GZ44CCPGJyPgogICogdHJ1ZSDjgavjgZfjgZ/loLTlkIjjgIFVUkwg44Gv5aSJ5pu044GV44KM44Ga44CB5YaF6YOo44Gn5L+d5oyB44GX44Gm44GE44KL54q25oWL566h55CG44Kq44OW44K444Kn44Kv44OI44KS5Z+65rqW44Gr5bGV6ZaL44GX44G+44GZ44CCCiAgKiBAcHJvcGVydHkgc2lsZW50CiAgKiBAdHlwZSBCb29sZWFuCiAgKiBAZGVmYXVsdCBmYWxzZQogICovCgoKICBLYXppdG9yaS5wcm90b3R5cGUuc2lsZW50ID0gZmFsc2U7CgogIC8qKgogICogcHVzaFN0YXRlIOOBuOOBruebo+imluOBjOmWi+Wni+OBleOCjOOBpuOBhOOCi+OBi+OBqeOBhuOBiwogICogQHByb3BlcnR5IHN0YXJ0ZWQKICAqIEB0eXBlIEJvb2xlYW4KICAqIEBkZWZhdWx0IGZhbHNlCiAgKi8KCgogIEtheml0b3JpLnByb3RvdHlwZS5zdGFydGVkID0gZmFsc2U7CgogIEtheml0b3JpLnByb3RvdHlwZS5fcGFyYW1zID0gewogICAgcGFyYW1zOiBbXSwKICAgICdmcmFnbWVudCc6ICcnCiAgfTsKCiAgLyoqCiAgKiBiZWZvcmUg5Yem55CG44GM5aSx5pWX44GX44Gf5pmC44Gr5a6f6KGM44GV44KM44G+44GZ44CCPGJyPgogICog44OH44OV44Kp44Or44OI44Gn44Gv56m644GuIGZ1bmN0aW9uIOOBq+OBquOBo+OBpuOBhOOBvuOBmeOAggogICoKICAqIEBtZXRob2QgYmVmb3JlRmFpbGVkSGFuZGxlcgogICovCgoKICBLYXppdG9yaS5wcm90b3R5cGUuYmVmb3JlRmFpbGVkSGFuZGxlciA9IGZ1bmN0aW9uKCkge307CgogIC8qaXNCZWZvcmVGb3JjZSovCgoKICBLYXppdG9yaS5wcm90b3R5cGUuaXNCZWZvcmVGb3JjZSA9IGZhbHNlOwoKICBLYXppdG9yaS5wcm90b3R5cGUuaXNUZW1hZSA9IGZhbHNlOwoKICBLYXppdG9yaS5wcm90b3R5cGUuX2NoYW5nZU9wdGlvbnMgPSBudWxsOwoKICBLYXppdG9yaS5wcm90b3R5cGUuaXNOb3RGb3VuZEZvcmNlID0gZmFsc2U7CgogIEtheml0b3JpLnByb3RvdHlwZS5fbm90Rm91bmQgPSBudWxsOwoKICBLYXppdG9yaS5wcm90b3R5cGUuYnJlYWtlciA9IHt9OwoKICBLYXppdG9yaS5wcm90b3R5cGUuX2Rpc3BhdGNoZXIgPSBudWxsOwoKICBLYXppdG9yaS5wcm90b3R5cGUuX2JlZm9yZURlZmZlciA9IG51bGw7CgogIC8qKgogICog54++5Zyo44GuIFVSTCDjgpLov5TjgZfjgb7jgZnjgIIKICAqIEBwcm9wZXJ0eSBmcmFnbWVudAogICogQHR5cGUgU3RyaW5nCiAgKiBAZGVmYXVsdCBudWxsCiAgKi8KCgogIEtheml0b3JpLnByb3RvdHlwZS5mcmFnbWVudCA9IG51bGw7CgogIC8qKgogICog54++5Zyo44GuIFVSTCDjgYvjgokgMeOBpOWJjeOBriBVUkwg44KS6L+U44GX44G+44GZ44CCCiAgKiBAcHJvcGVydHkgbGFzdEZyYWdtZW50CiAgKiBAdHlwZSBTdHJpbmcKICAqIEBkZWZhdWx0IG51bGwKICAqLwoKCiAgS2F6aXRvcmkucHJvdG90eXBlLmxhc3RGcmFnbWVudCA9IG51bGw7CgogIEtheml0b3JpLnByb3RvdHlwZS5pc1VzZXJBY3Rpb24gPSBmYWxzZTsKCiAgS2F6aXRvcmkucHJvdG90eXBlLl9pc0ZpcnN0UmVxdWVzdCA9IHRydWU7CgogIEtheml0b3JpLnByb3RvdHlwZS5pc0luaXRSZXBsYWNlID0gdHJ1ZTsKCiAgS2F6aXRvcmkucHJvdG90eXBlLmlzTGFzdFNsYXNoID0gZmFsc2U7CgogIC8qKgogICog5LiA5pmC5YGc5q2i44GX44Gm44GE44KL44GL44Gp44GG44GL44KS6L+U44GX44G+44GZ44CCCiAgKgogICogQHByb3BlcnR5IGlzU3VzcGVuZAogICogQHR5cGUgQm9vbGVhbgogICogQGRlZmF1bHQgZmFsc2UKICAqLwoKCiAgS2F6aXRvcmkucHJvdG90eXBlLmlzU3VzcGVuZCA9IGZhbHNlOwoKICBLYXppdG9yaS5wcm90b3R5cGUuX3Byb2Nlc3NTdGVwID0gewogICAgJ3N0YXR1cyc6ICdudWxsJywKICAgICdhcmdzJzogW10KICB9OwoKICBmdW5jdGlvbiBLYXppdG9yaShvcHRpb25zKSB7CiAgICB0aGlzLm9ic2VydmVVUkxIYW5kbGVyID0gX19iaW5kKHRoaXMub2JzZXJ2ZVVSTEhhbmRsZXIsIHRoaXMpOwogICAgdGhpcy5iZWZvcmVGYWlsZWQgPSBfX2JpbmQodGhpcy5iZWZvcmVGYWlsZWQsIHRoaXMpOwogICAgdGhpcy5leGVjdXRlSGFuZGxlcnMgPSBfX2JpbmQodGhpcy5leGVjdXRlSGFuZGxlcnMsIHRoaXMpOwogICAgdGhpcy5fZXhlY3V0ZUJlZm9yZXMgPSBfX2JpbmQodGhpcy5fZXhlY3V0ZUJlZm9yZXMsIHRoaXMpOwogICAgdGhpcy5iZWZvcmVDb21wbGV0ZSA9IF9fYmluZCh0aGlzLmJlZm9yZUNvbXBsZXRlLCB0aGlzKTsKICAgIHZhciBkb2NNb2RlLCBlLCB3aW47CiAgICB0aGlzLl9wcm9jZXNzU3RlcC5zdGF0dXMgPSAnY29uc3RydWN0b3InOwogICAgdGhpcy5fcHJvY2Vzc1N0ZXAuYXJncyA9IFtvcHRpb25zXTsKICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnMgfHwgKG9wdGlvbnMgPSB7fSk7CiAgICBpZiAob3B0aW9ucy5yb3V0ZXMpIHsKICAgICAgdGhpcy5yb3V0ZXMgPSBvcHRpb25zLnJvdXRlczsKICAgIH0KICAgIHRoaXMucm9vdCA9IG9wdGlvbnMuaGFzT3duUHJvcGVydHkoInJvb3QiKSA/IG9wdGlvbnMucm9vdCA6IHRoaXMucm9vdCA9PT0gbnVsbCA/ICcvJyA6IHRoaXMucm9vdDsKICAgIHRoaXMuaXNUZW1hZSA9IG9wdGlvbnMuaXNUZW1hZSA/IG9wdGlvbnMuaXNUZW1hZSA6IGZhbHNlOwogICAgdGhpcy5zaWxlbnQgPSBvcHRpb25zLnNpbGVudCA/IG9wdGlvbnMuc2lsZW50IDogZmFsc2U7CiAgICB0aGlzLmlzSW5pdFJlcGxhY2UgPSBvcHRpb25zLmhhc093blByb3BlcnR5KCJpc0luaXRSZXBsYWNlIikgPyBvcHRpb25zLmlzSW5pdFJlcGxhY2UgOiB0cnVlOwogICAgdGhpcy5pc0xhc3RTbGFzaCA9IG9wdGlvbnMuaGFzT3duUHJvcGVydHkoImlzTGFzdFNsYXNoIikgPyBvcHRpb25zLmlzTGFzdFNsYXNoIDogZmFsc2U7CiAgICB0aGlzLl9wYXJhbXMgPSB7CiAgICAgIHBhcmFtczogW10sCiAgICAgIHF1ZXJpZXM6IHt9LAogICAgICBmcmFnbWVudDogbnVsbAogICAgfTsKICAgIGlmICh0aGlzLm5vdEZvdW5kID09PSBudWxsKSB7CiAgICAgIHRoaXMubm90Rm91bmQgPSBvcHRpb25zLm5vdEZvdW5kID8gb3B0aW9ucy5ub3RGb3VuZCA6IHRoaXMucm9vdDsKICAgIH0KICAgIHdpbiA9IHdpbmRvdzsKICAgIGlmICh0eXBlb2Ygd2luICE9PSAndW5kZWZpbmVkJykgewogICAgICB0aGlzLmxvY2F0aW9uID0gd2luLmxvY2F0aW9uOwogICAgICB0aGlzLmhpc3RvcnkgPSB3aW4uaGlzdG9yeTsKICAgIH0KICAgIGRvY01vZGUgPSBkb2N1bWVudC5kb2N1bWVudE1vZGU7CiAgICB0aGlzLmlzSUUgPSB3aW4ubmF2aWdhdG9yLnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpLmluZGV4T2YoJ21zaWUnKSAhPT0gLTE7CiAgICB0aGlzLmlzT2xkSUUgPSB0aGlzLmlzSUUgJiYgKCFkb2NNb2RlIHx8IGRvY01vZGUgPCA5KTsKICAgIHRoaXMuX2Rpc3BhdGNoZXIgPSBuZXcgRXZlbnREaXNwYXRjaGVyKCk7CiAgICB0aGlzLmhhbmRsZXJzID0gW107CiAgICB0aGlzLmJlZm9yZUhhbmRsZXJzID0gW107CiAgICB0aGlzLl9iaW5kQmVmb3JlcygpOwogICAgdGhpcy5fYmluZFJ1bGVzKCk7CiAgICB0aGlzLl9iaW5kTm90Rm91bmQoKTsKICAgIHRyeSB7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCAncGFyYW1zJywgewogICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl9wYXJhbXMucGFyYW1zOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCAncXVlcmllcycsIHsKICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICAgIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5fcGFyYW1zLnF1ZXJpZXM7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0gY2F0Y2ggKF9lcnJvcikgewogICAgICBlID0gX2Vycm9yOwogICAgICBpZiAodGhpcy5pc09sZElFKSB7CiAgICAgICAgdGhpcy5wYXJhbXMgPSB0aGlzLl9wYXJhbXMucGFyYW1zOwogICAgICAgIHRoaXMucXVlcmllcyA9IHRoaXMuX3BhcmFtcy5xdWVyaWVzOwogICAgICB9CiAgICB9CiAgICBpZiAoKHRoaXMub3B0aW9ucy5pc0F1dG9TdGFydCA9PSBudWxsKSB8fCB0aGlzLm9wdGlvbnMuaXNBdXRvU3RhcnQgIT09IGZhbHNlKSB7CiAgICAgIHRoaXMuc3RhcnQoKTsKICAgIH0KICAgIHJldHVybjsKICB9CgogIC8qKgogICogS2F6aXRvcmkuanMg44KS6ZaL5aeL44GX44G+44GZ44CCPGJyPgogICogU1RBUlQg44Kk44OZ44Oz44OI44GM44OH44Kj44K544OR44OD44OB44GV44KM44G+44GZ44CCCiAgKiBAbWV0aG9kIHN0YXJ0CiAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyDjgqrjg5fjgrfjg6fjg7MKICAqLwoKCiAgS2F6aXRvcmkucHJvdG90eXBlLnN0YXJ0ID0gZnVuY3Rpb24ob3B0aW9ucykgewogICAgdmFyIGF0Um9vdCwgZnJhZ21lbnQsIGZyYW1lLCBpZUZyYWcsIG92ZXJyaWRlLCB3aW47CiAgICB0aGlzLl9wcm9jZXNzU3RlcC5zdGF0dXMgPSAnc3RhcnQnOwogICAgdGhpcy5fcHJvY2Vzc1N0ZXAuYXJncyA9IFtvcHRpb25zXTsKICAgIGlmICh0aGlzLnN0YXJ0ZWQpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdtb3UgaGF6aW0gbWF0dGVydScpOwogICAgfQogICAgdGhpcy5zdGFydGVkID0gdHJ1ZTsKICAgIHdpbiA9IHdpbmRvdzsKICAgIHRoaXMub3B0aW9ucyA9IHRoaXMuX2V4dGVuZCh7fSwgewogICAgICByb290OiAnLycKICAgIH0sIHRoaXMub3B0aW9ucywgb3B0aW9ucyk7CiAgICB0aGlzLl9oYXNQdXNoU3RhdGUgPSAhISh0aGlzLmhpc3RvcnkgJiYgdGhpcy5oaXN0b3J5LnB1c2hTdGF0ZSk7CiAgICB0aGlzLl93YW50Q2hhbmdlSGFzaCA9IHRoaXMub3B0aW9ucy5oYXNoQ2hhbmdlICE9PSBmYWxzZTsKICAgIGZyYWdtZW50ID0gdGhpcy5mcmFnbWVudCA9IHRoaXMuZ2V0RnJhZ21lbnQoKTsKICAgIGF0Um9vdCA9IHRoaXMubG9jYXRpb24ucGF0aG5hbWUucmVwbGFjZSgvW15cL10kLywgJyQmLycpID09PSB0aGlzLnJvb3Q7CiAgICBpZiAodGhpcy5pc0lFICYmICFhdFJvb3QgJiYgIXRoaXMuX2hhc1B1c2hTdGF0ZSAmJiB0aGlzLmlzSW5pdFJlcGxhY2UpIHsKICAgICAgaWVGcmFnID0gdGhpcy5sb2NhdGlvbi5wYXRobmFtZS5yZXBsYWNlKHRoaXMucm9vdCwgJycpOwogICAgICB0aGlzLl91cGRhdGVIYXNoSUUoaWVGcmFnKTsKICAgIH0KICAgIGlmICh0aGlzLmlzT2xkSUUgJiYgdGhpcy5fd2FudENoYW5nZUhhc2gpIHsKICAgICAgZnJhbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpZnJhbWUiKTsKICAgICAgZnJhbWUuc2V0QXR0cmlidXRlKCJzcmMiLCAiamF2YXNjcmlwdDowIik7CiAgICAgIGZyYW1lLnNldEF0dHJpYnV0ZSgidGFiaW5kZXgiLCAiLTEiKTsKICAgICAgZnJhbWUuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChmcmFtZSk7CiAgICAgIHRoaXMuaWZyYW1lID0gZnJhbWUuY29udGVudFdpbmRvdzsKICAgICAgdGhpcy5jaGFuZ2UoZnJhZ21lbnQpOwogICAgfQogICAgdGhpcy5fYWRkUG9wU3RhdGVIYW5kbGVyKCk7CiAgICBpZiAodGhpcy5faGFzUHVzaFN0YXRlICYmIGF0Um9vdCAmJiB0aGlzLmxvY2F0aW9uLmhhc2gpIHsKICAgICAgdGhpcy5mcmFnbWVudCA9IHRoaXMubGFzdEZyYWdtZW50ID0gdGhpcy5nZXRIYXNoKCkucmVwbGFjZShyb3V0ZVN0cmlwcGVyLCAnJyk7CiAgICAgIHRoaXMuaGlzdG9yeS5yZXBsYWNlU3RhdGUoe30sIGRvY3VtZW50LnRpdGxlLCB0aGlzLnJvb3QgKyB0aGlzLmZyYWdtZW50ICsgdGhpcy5sb2NhdGlvbi5zZWFyY2gpOwogICAgfQogICAgdGhpcy5fZGlzcGF0Y2hlci5kaXNwYXRjaEV2ZW50KG5ldyBLYXppdG9yaUV2ZW50KEtheml0b3JpRXZlbnQuU1RBUlQsIHRoaXMuZnJhZ21lbnQpKTsKICAgIG92ZXJyaWRlID0gdGhpcy5yb290OwogICAgaWYgKCF0aGlzLnNpbGVudCkgewogICAgICBpZiAoIXRoaXMuX2hhc1B1c2hTdGF0ZSAmJiBhdFJvb3QpIHsKICAgICAgICBvdmVycmlkZSA9IHRoaXMuZnJhZ21lbnQ7CiAgICAgIH0gZWxzZSBpZiAoIWF0Um9vdCkgewogICAgICAgIG92ZXJyaWRlID0gdGhpcy5mcmFnbWVudDsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHRoaXMubG9hZFVSTChvdmVycmlkZSk7CiAgfTsKCiAgLyoqCiAgKiBLYXppdG9yaS5qcyDjgpLlgZzmraLjgZfjgb7jgZnjgII8YnI+CiAgKiBTVE9QIOOCpOODmeODs+ODiOOBjOODh+OCo+OCueODkeODg+ODgeOBleOCjOOBvuOBmeOAggogICogQG1ldGhvZCBzdG9wCiAgKi8KCgogIEtheml0b3JpLnByb3RvdHlwZS5zdG9wID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgd2luOwogICAgd2luID0gd2luZG93OwogICAgd2luLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3BvcHN0YXRlJywgdGhpcy5vYnNlcnZlVVJMSGFuZGxlcik7CiAgICB3aW4ucmVtb3ZlRXZlbnRMaXN0ZW5lcignaGFzaGNoYW5nZScsIHRoaXMub2JzZXJ2ZVVSTEhhbmRsZXIpOwogICAgdGhpcy5zdGFydGVkID0gZmFsc2U7CiAgICByZXR1cm4gdGhpcy5fZGlzcGF0Y2hlci5kaXNwYXRjaEV2ZW50KG5ldyBLYXppdG9yaUV2ZW50KEtheml0b3JpRXZlbnQuU1RPUCwgdGhpcy5mcmFnbWVudCkpOwogIH07CgogIC8qKgogICog44OW44Op44Km44K244Gu44OS44K544OI44Oq44O85qmf6IO944KS5Yip55So44GX44Gm44CM6YCy44KA44CN44KS5a6f6KGM44GX44G+44GZ44CCPGJyPgogICog5oiQ5Yqf44GX44Gf5aC05ZCIIE5FWFQg44Kk44OZ44Oz44OI44GM44OH44Kj44K544OR44OD44OB44GV44KM44G+44GZ44CCCiAgKiBAbWV0aG9kIHRvcmlrYXppCiAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogICovCgoKICBLYXppdG9yaS5wcm90b3R5cGUudG9yaWthemkgPSBmdW5jdGlvbihvcHRpb25zKSB7CiAgICByZXR1cm4gdGhpcy5kaXJlY3Rpb24ob3B0aW9ucywgIm5leHQiKTsKICB9OwoKICAvKioKICAqIOODluODqeOCpuOCtuODkuOCueODiOODquODvOapn+iDveOCkuWIqeeUqOOBl+OBpuOAjOaIu+OCi+OAjeOCkuWun+ihjOOBl+OBvuOBmeOAgjxicj4KICAqIOaIkOWKn+OBl+OBn+WgtOWQiCBQUkVWIOOCpOODmeODs+ODiOOBjOODh+OCo+OCueODkeODg+ODgeOBleOCjOOBvuOBmeOAggogICogQG1ldGhvZCBvbW9rYXppCiAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogICovCgoKICBLYXppdG9yaS5wcm90b3R5cGUub21va2F6aSA9IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgIHJldHVybiB0aGlzLmRpcmVjdGlvbihvcHRpb25zLCAicHJldiIpOwogIH07CgogIEtheml0b3JpLnByb3RvdHlwZS5kaXJlY3Rpb24gPSBmdW5jdGlvbihvcHRpb24sIGRpcmVjdGlvbikgewogICAgdmFyIHRtcEZyYWc7CiAgICBpZiAoIXRoaXMuc3RhcnRlZCkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICB0bXBGcmFnID0gdGhpcy5sYXN0RnJhZ21lbnQ7CiAgICB0aGlzLmxhc3RGcmFnbWVudCA9IHRoaXMuZ2V0RnJhZ21lbnQoKTsKICAgIHRoaXMuZGlyZWN0ID0gZGlyZWN0aW9uOwogICAgdGhpcy5pc1VzZXJBY3Rpb24gPSB0cnVlOwogICAgdGhpcy5fcmVtb3ZlUG9wU3RhdGVIYW5kbGVyKCk7CiAgICBpZiAoZGlyZWN0aW9uID09PSAicHJldiIpIHsKICAgICAgdGhpcy5oaXN0b3J5LmJhY2soKTsKICAgICAgdGhpcy5fZGlzcGF0Y2hlci5kaXNwYXRjaEV2ZW50KG5ldyBLYXppdG9yaUV2ZW50KEtheml0b3JpRXZlbnQuUFJFViwgdG1wRnJhZywgdGhpcy5sYXN0RnJhZ21lbnQpKTsKICAgIH0gZWxzZSBpZiAoZGlyZWN0aW9uID09PSAibmV4dCIpIHsKICAgICAgdGhpcy5oaXN0b3J5LmZvcndhcmQoKTsKICAgICAgdGhpcy5fZGlzcGF0Y2hlci5kaXNwYXRjaEV2ZW50KG5ldyBLYXppdG9yaUV2ZW50KEtheml0b3JpRXZlbnQuTkVYVCwgdG1wRnJhZywgdGhpcy5sYXN0RnJhZ21lbnQpKTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuX2FkZFBvcFN0YXRlSGFuZGxlcigpOwogICAgcmV0dXJuIHRoaXMubG9hZFVSTCh0bXBGcmFnKTsKICB9OwoKICAvKioKICAqIHVybCDjgpLlpInmm7TjgZfjgb7jgZnjgII8YnI+CiAgKiDnhKHkuosgVVJMIOOBjOWIh+OCiuabv+OCj+OBo+OBn+WgtOWQiOOAgUNIQU5HRSDjgqTjg5njg7Pjg4jjgYzjg4fjgqPjgrnjg5Hjg4Pjg4HjgZXjgozjgb7jgZnjgIIKICAqIDxoND5leGFtcGxlPC9oND4KICAqICAgICBhcHAuY2hhbmdlKCcvc29tZXVybCcpOwogICogQG1ldGhvZCBjaGFuZ2UKICAqIEBwYXJhbSB7U3RyaW5nfSBmcmFnbWVudCDlpInmm7TjgZfjgZ/jgYQgVVJMCiAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyDjgqrjg5fjgrfjg6fjg7MKICAqLwoKCiAgS2F6aXRvcmkucHJvdG90eXBlLmNoYW5nZSA9IGZ1bmN0aW9uKGZyYWdtZW50LCBvcHRpb25zKSB7CiAgICB2YXIgZnJhZywgbWF0Y2hlZCwgbmV4dCwgdXJsOwogICAgaWYgKCF0aGlzLnN0YXJ0ZWQpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgdGhpcy5fcHJvY2Vzc1N0ZXAuc3RhdHVzID0gJ2NoYW5nZSc7CiAgICB0aGlzLl9wcm9jZXNzU3RlcC5hcmdzID0gW2ZyYWdtZW50LCBvcHRpb25zXTsKICAgIGlmICghb3B0aW9ucykgewogICAgICBvcHRpb25zID0gewogICAgICAgICd0cmlnZ2VyJzogb3B0aW9ucwogICAgICB9OwogICAgfQogICAgdGhpcy5fY2hhbmdlT3B0aW9ucyA9IG9wdGlvbnM7CiAgICB0aGlzLmlzQmVmb3JlRm9yY2UgPSBvcHRpb25zLmlzQmVmb3JlRm9yY2UgIT09IGZhbHNlOwogICAgZnJhZyA9IHRoaXMuZ2V0RnJhZ21lbnQoZnJhZ21lbnQgfHwgJycpOwogICAgaWYgKHRoaXMuZnJhZ21lbnQgPT09IGZyYWcpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5sYXN0RnJhZ21lbnQgPSB0aGlzLmZyYWdtZW50OwogICAgdGhpcy5mcmFnbWVudCA9IGZyYWc7CiAgICBuZXh0ID0gdGhpcy5mcmFnbWVudDsKICAgIHVybCA9IHRoaXMucm9vdCArIHRoaXMuX3JlcGxhY2UuYXBwbHkoZnJhZywgW3JvdXRlU3RyaXBwZXIsICcnXSk7CiAgICBtYXRjaGVkID0gdGhpcy5fbWF0Y2hDaGVjayh0aGlzLmZyYWdtZW50LCB0aGlzLmhhbmRsZXJzKTsKICAgIGlmIChtYXRjaGVkID09PSBmYWxzZSAmJiB0aGlzLmlzTm90Rm91bmRGb3JjZSA9PT0gZmFsc2UpIHsKICAgICAgaWYgKHRoaXMubm90Rm91bmQgIT09IG51bGwpIHsKICAgICAgICB0aGlzLl9ub3RGb3VuZC5jYWxsYmFjayh0aGlzLmZyYWdtZW50KTsKICAgICAgICB1cmwgPSB0aGlzLnJvb3QgKyB0aGlzLl9ub3RGb3VuZC5ydWxlLnJlcGxhY2Uocm91dGVTdHJpcHBlciwgJycpOwogICAgICAgIHRoaXMuaGlzdG9yeVtvcHRpb25zLnJlcGxhY2UgPyAncmVwbGFjZVN0YXRlJyA6ICdwdXNoU3RhdGUnXSh7fSwgZG9jdW1lbnQudGl0bGUsIHVybCk7CiAgICAgIH0KICAgICAgdGhpcy5fZGlzcGF0Y2hlci5kaXNwYXRjaEV2ZW50KG5ldyBLYXppdG9yaUV2ZW50KEtheml0b3JpRXZlbnQuTk9UX0ZPVU5EKSk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICh0aGlzLmlzVGVtYWUgJiYgKHRoaXMuYmVmb3JlQW55dGltZUhhbmRsZXIgfHwgdGhpcy5iZWZvcmVIYW5kbGVycy5sZW5ndGggPiAwKSkgewogICAgICB0aGlzLl9leGVjdXRlQmVmb3JlcyhmcmFnKTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuX3VybENoYW5nZShmcmFnLCBvcHRpb25zKTsKICAgIH0KICB9OwoKICAvKioKICAqIHB1c2hTdGF0ZSDjgafjga/jgarjgY8gcmVwbGFjZVN0YXRlIOOBp+WHpueQhuOBl+OBvuOBmeOAgjxicj4KICAqIHJlcGxhY2VTdGF0ZSDjga/nj77lnKjjga4gVVJMIOOCkue9ruOBjeaPm+OBiOOCi+OBn+OCgeOAgeWxpeattOOBq+OBr+i/veWKoOOBleOCjOOBvuOBm+OCk+OAggogICogPGg0PmV4YW1wbGU8L2g0PgogICogICAgIGFwcC5yZXBsYWNlKCcvc29tZXVybCcpOwogICogQG1ldGhvZCByZXBsYWNlCiAgKiBAcGFyYW0ge1N0cmluZ30gZnJhZ21lbnQg5aSJ5pu044GX44Gf44GEIFVSTAogICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMg44Kq44OX44K344On44OzCiAgKi8KCgogIEtheml0b3JpLnByb3RvdHlwZS5yZXBsYWNlID0gZnVuY3Rpb24oZnJhZ21lbnQsIG9wdGlvbnMpIHsKICAgIHRoaXMuX3Byb2Nlc3NTdGVwLnN0YXR1cyA9ICdyZXBsYWNlJzsKICAgIHRoaXMuX3Byb2Nlc3NTdGVwLmFyZ3MgPSBbZnJhZ21lbnQsIG9wdGlvbnNdOwogICAgaWYgKCFvcHRpb25zKSB7CiAgICAgIG9wdGlvbnMgPSB7CiAgICAgICAgcmVwbGFjZTogdHJ1ZQogICAgICB9OwogICAgfSBlbHNlIGlmICghb3B0aW9ucy5yZXBsYWNlIHx8IG9wdGlvbnMucmVwbGFjZSA9PT0gZmFsc2UpIHsKICAgICAgb3B0aW9ucy5yZXBsYWNlID0gdHJ1ZTsKICAgIH0KICAgIHRoaXMuY2hhbmdlKGZyYWdtZW50LCBvcHRpb25zKTsKICB9OwoKICBLYXppdG9yaS5wcm90b3R5cGUuX3VybENoYW5nZSA9IGZ1bmN0aW9uKGZyYWdtZW50LCBvcHRpb25zKSB7CiAgICB2YXIgdXJsOwogICAgdGhpcy5fcHJvY2Vzc1N0ZXAuc3RhdHVzID0gJ191cmxDaGFuZ2UnOwogICAgdGhpcy5fcHJvY2Vzc1N0ZXAuYXJncyA9IFtmcmFnbWVudCwgb3B0aW9uc107CiAgICBpZiAodGhpcy5pc1N1c3BlbmQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKCFvcHRpb25zKSB7CiAgICAgIG9wdGlvbnMgPSB0aGlzLl9jaGFuZ2VPcHRpb25zOwogICAgfQogICAgdXJsID0gdGhpcy5yb290ICsgdGhpcy5mcmFnbWVudC5yZXBsYWNlKHJvdXRlU3RyaXBwZXIsICcnKTsKICAgIGlmICh0aGlzLmlzTGFzdFNsYXNoKSB7CiAgICAgIHVybCArPSAiLyI7CiAgICB9CiAgICBpZiAoIXRoaXMuc2lsZW50KSB7CiAgICAgIGlmICh0aGlzLl9oYXNQdXNoU3RhdGUpIHsKICAgICAgICB0aGlzLmhpc3Rvcnlbb3B0aW9ucy5yZXBsYWNlID8gJ3JlcGxhY2VTdGF0ZScgOiAncHVzaFN0YXRlJ10oe30sIGRvY3VtZW50LnRpdGxlLCB1cmwpOwogICAgICB9IGVsc2UgaWYgKHRoaXMuX3dhbnRDaGFuZ2VIYXNoKSB7CiAgICAgICAgdGhpcy5fdXBkYXRlSGFzaCh0aGlzLmxvY2F0aW9uLCBmcmFnbWVudCwgb3B0aW9ucy5yZXBsYWNlKTsKICAgICAgICBpZiAodGhpcy5pZnJhbWUgJiYgKGZyYWdtZW50ICE9PSB0aGlzLmdldEZyYWdtZW50KHRoaXMuZ2V0SGFzaCh0aGlzLmlmcmFtZSkpKSkgewogICAgICAgICAgaWYgKCFvcHRpb25zLnJlcGxhY2UpIHsKICAgICAgICAgICAgdGhpcy5pZnJhbWUuZG9jdW1lbnQub3BlbigpLmNsb3NlKCk7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLl91cGRhdGVIYXNoKHRoaXMuaWZyYW1lLmxvY2F0aW9uLCBmcmFnbWVudCwgb3B0aW9ucy5yZXBsYWNlKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIHRoaXMubG9jYXRpb24uYXNzaWduKHVybCk7CiAgICAgIH0KICAgIH0KICAgIHRoaXMuZGlzcGF0Y2hFdmVudChuZXcgS2F6aXRvcmlFdmVudChLYXppdG9yaUV2ZW50LkNIQU5HRSwgdGhpcy5mcmFnbWVudCwgdGhpcy5sYXN0RnJhZ21lbnQpKTsKICAgIGlmIChvcHRpb25zLmludGVybmFsICYmIG9wdGlvbnMuaW50ZXJuYWwgPT09IHRydWUpIHsKICAgICAgdGhpcy5fZGlzcGF0Y2hlci5kaXNwYXRjaEV2ZW50KG5ldyBLYXppdG9yaUV2ZW50KEtheml0b3JpRXZlbnQuSU5URVJOQUxfQ0hBTkdFLCB0aGlzLmZyYWdtZW50LCB0aGlzLmxhc3RGcmFnbWVudCkpOwogICAgfQogICAgcmV0dXJuIHRoaXMubG9hZFVSTCh0aGlzLmZyYWdtZW50LCBvcHRpb25zKTsKICB9OwoKICAvKioKICAqIOS4reatouOBl+OBvuOBmeOAggogICogQG1ldGhvZCByZWplY3QKICAqLwoKCiAgS2F6aXRvcmkucHJvdG90eXBlLnJlamVjdCA9IGZ1bmN0aW9uKCkgewogICAgdGhpcy5kaXNwYXRjaEV2ZW50KG5ldyBLYXppdG9yaUV2ZW50KEtheml0b3JpRXZlbnQuUkVKRUNULCB0aGlzLmZyYWdtZW50KSk7CiAgICBpZiAodGhpcy5fYmVmb3JlRGVmZmVyKSB7CiAgICAgIHRoaXMuX2JlZm9yZURlZmZlci5yZW1vdmVFdmVudExpc3RlbmVyKEtheml0b3JpRXZlbnQuVEFTS19RVUVVRV9DT01QTEVURSwgdGhpcy5iZWZvcmVDb21wbGV0ZSk7CiAgICAgIHRoaXMuX2JlZm9yZURlZmZlci5yZW1vdmVFdmVudExpc3RlbmVyKEtheml0b3JpRXZlbnQuVEFTS19RVUVVRV9GQUlMRUQsIHRoaXMuYmVmb3JlRmFpbGVkKTsKICAgICAgdGhpcy5fYmVmb3JlRGVmZmVyID0gbnVsbDsKICAgIH0KICB9OwoKICAvKioKICAqIOWHpueQhuOCkuS4gOaZguWBnOatouOBl+OBvuOBmeOAgjxicj4KICAqIFNVU1BFTkQg44Kk44OZ44Oz44OI44GM44OH44Kj44K544OR44OD44OB44GV44KM44G+44GZ44CCCiAgKiBAbWV0aG9kIHN1c3BlbmQKICAqLwoKCiAgS2F6aXRvcmkucHJvdG90eXBlLnN1c3BlbmQgPSBmdW5jdGlvbigpIHsKICAgIGlmICh0aGlzLl9iZWZvcmVEZWZmZXIgIT0gbnVsbCkgewogICAgICB0aGlzLl9iZWZvcmVEZWZmZXIuc3VzcGVuZCgpOwogICAgfQogICAgdGhpcy5zdGFydGVkID0gZmFsc2U7CiAgICB0aGlzLmlzU3VzcGVuZCA9IHRydWU7CiAgICB0aGlzLl9kaXNwYXRjaGVyLmRpc3BhdGNoRXZlbnQobmV3IEtheml0b3JpRXZlbnQoS2F6aXRvcmlFdmVudC5TVVNQRU5ELCB0aGlzLmZyYWdtZW50LCB0aGlzLmxhc3RGcmFnbWVudCkpOwogIH07CgogIC8qKgogICog5Yem55CG44KS5YaN6ZaL44GX44G+44GZ44CCPGJyPgogICogUkVTVU1FIOOCpOODmeODs+ODiOOBjOODh+OCo+OCueODkeODg+ODgeOBleOCjOOBvuOBmeOAggogICogQG1ldGhvZCByZXN1bWUKICAqLwoKCiAgS2F6aXRvcmkucHJvdG90eXBlLnJlc3VtZSA9IGZ1bmN0aW9uKCkgewogICAgaWYgKHRoaXMuX2JlZm9yZURlZmZlciAhPSBudWxsKSB7CiAgICAgIHRoaXMuX2JlZm9yZURlZmZlci5yZXN1bWUoKTsKICAgIH0KICAgIHRoaXMuc3RhcnRlZCA9IHRydWU7CiAgICB0aGlzLmlzU3VzcGVuZCA9IGZhbHNlOwogICAgdGhpc1t0aGlzLl9wcm9jZXNzU3RlcC5zdGF0dXNdKHRoaXMuX3Byb2Nlc3NTdGVwLmFyZ3MpOwogICAgdGhpcy5fZGlzcGF0Y2hlci5kaXNwYXRjaEV2ZW50KG5ldyBLYXppdG9yaUV2ZW50KEtheml0b3JpRXZlbnQuUkVTVU1FLCB0aGlzLmZyYWdtZW50LCB0aGlzLmxhc3RGcmFnbWVudCkpOwogIH07CgogIEtheml0b3JpLnByb3RvdHlwZS5yZWdpc3RlckhhbmRsZXIgPSBmdW5jdGlvbihydWxlLCBuYW1lLCBpc0JlZm9yZSwgY2FsbGJhY2spIHsKICAgIHZhciBjaGlsZCwgZSwgdGFyZ2V0OwogICAgaWYgKCFjYWxsYmFjaykgewogICAgICBpZiAoaXNCZWZvcmUpIHsKICAgICAgICBjYWxsYmFjayA9IHRoaXMuX2JpbmRGdW5jdGlvbnMobmFtZSk7CiAgICAgIH0gZWxzZSBpZiAobmFtZSBpbnN0YW5jZW9mIEtheml0b3JpKSB7CiAgICAgICAgdGhpcy5fYmluZENoaWxkKHJ1bGUsIG5hbWUpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9IGVsc2UgaWYgKHR5cGVvZiBuYW1lID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgaWYgKG5hbWUuaGFzT3duUHJvcGVydHkoJ19fc3VwZXJfXycpKSB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICBjaGlsZCA9IG5ldyBuYW1lKHsKICAgICAgICAgICAgICAnaXNBdXRvU3RhcnQnOiBmYWxzZQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGhpcy5fYmluZENoaWxkKHJ1bGUsIGNoaWxkKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICB9IGNhdGNoIChfZXJyb3IpIHsKICAgICAgICAgICAgZSA9IF9lcnJvcjsKICAgICAgICAgICAgY2FsbGJhY2sgPSBuYW1lOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjYWxsYmFjayA9IG5hbWU7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGNhbGxiYWNrID0gdGhpc1tuYW1lXTsKICAgICAgfQogICAgfQogICAgdGFyZ2V0ID0gaXNCZWZvcmUgPyB0aGlzLmJlZm9yZUhhbmRsZXJzIDogdGhpcy5oYW5kbGVyczsKICAgIHRhcmdldC51bnNoaWZ0KG5ldyBSdWxlKHJ1bGUsIGZ1bmN0aW9uKGZyYWdtZW50KSB7CiAgICAgIHZhciBhcmdzOwogICAgICBhcmdzID0gdGhpcy5yb3V0ZXIuZXh0cmFjdFBhcmFtcyh0aGlzLCBmcmFnbWVudCk7CiAgICAgIHJldHVybiBjYWxsYmFjayAmJiBjYWxsYmFjay5hcHBseSh0aGlzLnJvdXRlciwgYXJncyk7CiAgICB9LCB0aGlzKSk7CiAgICByZXR1cm4gdGhpczsKICB9OwoKICBLYXppdG9yaS5wcm90b3R5cGUuX2JpbmRDaGlsZCA9IGZ1bmN0aW9uKHJ1bGUsIGNoaWxkKSB7CiAgICB2YXIgY2hpbGRCZWZvcmUsIGNoaWxkQmVmb3JlcywgY2hpbGRIYW5kbGVycywgY2hpbGRSdWxlLCBfaSwgX2osIF9sZW4sIF9sZW4xOwogICAgY2hpbGQucmVqZWN0KCk7CiAgICBjaGlsZC5zdG9wKCk7CiAgICBjaGlsZEhhbmRsZXJzID0gY2hpbGQuaGFuZGxlcnMuY29uY2F0KCk7CiAgICBmb3IgKF9pID0gMCwgX2xlbiA9IGNoaWxkSGFuZGxlcnMubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHsKICAgICAgY2hpbGRSdWxlID0gY2hpbGRIYW5kbGVyc1tfaV07CiAgICAgIGNoaWxkUnVsZS51cGRhdGUocnVsZSk7CiAgICB9CiAgICB0aGlzLmhhbmRsZXJzID0gY2hpbGRIYW5kbGVycy5jb25jYXQodGhpcy5oYW5kbGVycyk7CiAgICBjaGlsZEJlZm9yZXMgPSBjaGlsZC5iZWZvcmVIYW5kbGVycy5jb25jYXQoKTsKICAgIGZvciAoX2ogPSAwLCBfbGVuMSA9IGNoaWxkQmVmb3Jlcy5sZW5ndGg7IF9qIDwgX2xlbjE7IF9qKyspIHsKICAgICAgY2hpbGRCZWZvcmUgPSBjaGlsZEJlZm9yZXNbX2pdOwogICAgICBjaGlsZEJlZm9yZS51cGRhdGUocnVsZSk7CiAgICB9CiAgICB0aGlzLmJlZm9yZUhhbmRsZXJzID0gY2hpbGRCZWZvcmVzLmNvbmNhdCh0aGlzLmJlZm9yZUhhbmRsZXJzKTsKICAgIGlmIChjaGlsZC5iZWZvcmVBbnl0aW1lSGFuZGxlcikgewogICAgICB0aGlzLmxhc3RBbnl0aW1lID0gdGhpcy5iZWZvcmVBbnl0aW1lLmNvbmNhdCgpOwogICAgICByZXR1cm4gdGhpcy5fYmluZEJlZm9yZUFueXRpbWUodGhpcy5iZWZvcmVBbnl0aW1lLCBbY2hpbGQuYmVmb3JlQW55dGltZUhhbmRsZXIuY2FsbGJhY2tdKTsKICAgIH0KICB9OwoKICAvKioKICAqIOODq+ODvOOCv+ODvOOCkuWLleeahOOBq+i/veWKoOOBl+OBvuOBmeOAgjxicj4KICAqIOODq+ODvOOCv+ODvOOBrui/veWKoOOBq+aIkOWKn+OBl+OBn+WgtOWQiOOAgUFEREVEIOOCpOODmeODs+ODiOOBjOODh+OCo+OCueODkeODg+ODgeOBleOCjOOBvuOBmeOAggogICogPGg0PmV4YW1wbGU8L2g0PgogICogICAgIGZvb1JvdXRlciA9IG5ldyBGb29Sb3V0ZXIoKTsKICAqICAgICBhcHAuYXBwZW5kUm91dGVyKGZvbyk7CiAgKiBAbWV0aG9kIGFwcGVuZFJvdXRlcgogICogQHBhcmFtIHtPYmplY3R9IGNoaWxkCiAgKiBAcGFyYW0ge1N0cmluZ30gY2hpbGRSb290CiAgKi8KCgogIEtheml0b3JpLnByb3RvdHlwZS5hcHBlbmRSb3V0ZXIgPSBmdW5jdGlvbihjaGlsZCwgY2hpbGRSb290KSB7CiAgICB2YXIgZSwgcnVsZSwgX2luc3RhbmNlOwogICAgaWYgKCFjaGlsZCBpbnN0YW5jZW9mIEtheml0b3JpICYmIHR5cGVvZiBjaGlsZCAhPT0gImZ1bmN0aW9uIikgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIuW8leaVsOOBruWApOOBjOS4jeato+OBp+OBmeOAgiDlvJXmlbDjgajjgZfjgabkuI7jgYjjgonjgozjgovjgqrjg5bjgrjjgqfjgq/jg4jjga8gS2F6aXRvcmkg44KS57aZ5om/44GX44Gm44GE44KL5b+F6KaB44GM44GC44KK44G+44GZ44CCIik7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmIChjaGlsZCBpbnN0YW5jZW9mIEtheml0b3JpKSB7CiAgICAgIHJ1bGUgPSB0aGlzLl9nZXRDaGlsZFJ1bGUoY2hpbGQsIGNoaWxkUm9vdCk7CiAgICAgIHRoaXMuX2JpbmRDaGlsZChydWxlLCBjaGlsZCk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSBlbHNlIHsKICAgICAgaWYgKGNoaWxkLmhhc093blByb3BlcnR5KCdfX3N1cGVyX18nKSkgewogICAgICAgIHRyeSB7CiAgICAgICAgICBfaW5zdGFuY2UgPSBuZXcgY2hpbGQoewogICAgICAgICAgICAnaXNBdXRvU3RhcnQnOiBmYWxzZQogICAgICAgICAgfSk7CiAgICAgICAgICBydWxlID0gdGhpcy5fZ2V0Q2hpbGRSdWxlKF9pbnN0YW5jZSwgY2hpbGRSb290KTsKICAgICAgICAgIHRoaXMuX2JpbmRDaGlsZChydWxlLCBfaW5zdGFuY2UpOwogICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfSBjYXRjaCAoX2Vycm9yKSB7CiAgICAgICAgICBlID0gX2Vycm9yOwogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCLlvJXmlbDjga7lgKTjgYzkuI3mraPjgafjgZnjgIIg5byV5pWw44Go44GX44Gm5LiO44GI44KJ44KM44KL44Kq44OW44K444Kn44Kv44OI44GvIEtheml0b3JpIOOCkue2meaJv+OBl+OBpuOBhOOCi+W/heimgeOBjOOBguOCiuOBvuOBmeOAgiIpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgdGhpcy5fZGlzcGF0Y2hlci5kaXNwYXRjaEV2ZW50KG5ldyBLYXppdG9yaUV2ZW50KEtheml0b3JpRXZlbnQuQURERUQsIHRoaXMuZnJhZ21lbnQsIHRoaXMubGFzdEZyYWdtZW50KSk7CiAgICByZXR1cm4gdGhpczsKICB9OwoKICBLYXppdG9yaS5wcm90b3R5cGUuX2dldENoaWxkUnVsZSA9IGZ1bmN0aW9uKGNoaWxkLCBjaGlsZFJvb3QpIHsKICAgIHZhciBydWxlOwogICAgcnVsZSA9IGNoaWxkLnJvb3Q7CiAgICBpZiAoY2hpbGRSb290KSB7CiAgICAgIHJ1bGUgPSBjaGlsZFJvb3Q7CiAgICB9CiAgICBpZiAocnVsZS5tYXRjaCh0cmFpbGluZ1NsYXNoKSkgewogICAgICBydWxlID0gcnVsZS5yZXBsYWNlKHRyYWlsaW5nU2xhc2gsICcnKTsKICAgIH0KICAgIGlmIChydWxlID09PSB0aGlzLnJvb3QpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCLjgYvjgbbjgaPjgabjgosiKTsKICAgIH0KICAgIHJldHVybiBydWxlOwogIH07CgogIC8qKgogICog5YuV55qE44Gr6L+95Yqg44GX44Gf44Or44O844K/44O844KS5YmK6Zmk44GX44G+44GZ44CCCiAgKiDjg6vjg7zjgr/jg7zjga7liYrpmaTjgavmiJDlip/jgZfjgZ/loLTlkIjjgIFSRU1PVkVEIOOCpOODmeODs+ODiOOBjOODh+OCo+OCueODkeODg+ODgeOBleOCjOOBvuOBmeOAggogICogPGg0PmV4YW1wbGU8L2g0PgogICogICAgIGZvbyA9IG5ldyBGb29Sb3V0ZXIoKTsKICAqICAgICBhcHAuYXBwZW5kUm91dGVyKGZvbyk7CiAgKiAgICAgYXBwLnJlbW92ZVJvdXRlcihmb28pOwogICogQG1ldGhvZCByZW1vdmVSb3V0ZXIKICAqIEBwYXJhbSB7T2JqZWN0fSBjaGlsZAogICogQHBhcmFtIHtTdHJpbmd9IGNoaWxkUm9vdAogICovCgoKICBLYXppdG9yaS5wcm90b3R5cGUucmVtb3ZlUm91dGVyID0gZnVuY3Rpb24oY2hpbGQsIGNoaWxkUm9vdCkgewogICAgdmFyIGUsIF9pbnN0YW5jZTsKICAgIGlmICghY2hpbGQgaW5zdGFuY2VvZiBLYXppdG9yaSAmJiB0eXBlb2YgY2hpbGQgIT09ICJmdW5jdGlvbiIpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCLlvJXmlbDjga7lgKTjgYzkuI3mraPjgafjgZnjgIIg5byV5pWw44Go44GX44Gm5LiO44GI44KJ44KM44KL44Kq44OW44K444Kn44Kv44OI44GvIEtheml0b3JpIOOCkue2meaJv+OBl+OBpuOBhOOCi+W/heimgeOBjOOBguOCiuOBvuOBmeOAgiIpOwogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoY2hpbGQgaW5zdGFuY2VvZiBLYXppdG9yaSkgewogICAgICB0aGlzLl91bmJpbmRDaGlsZChjaGlsZCwgY2hpbGRSb290KTsKICAgIH0gZWxzZSB7CiAgICAgIGlmIChjaGlsZC5oYXNPd25Qcm9wZXJ0eSgnX19zdXBlcl9fJykpIHsKICAgICAgICB0cnkgewogICAgICAgICAgX2luc3RhbmNlID0gbmV3IGNoaWxkKHsKICAgICAgICAgICAgJ2lzQXV0b1N0YXJ0JzogZmFsc2UKICAgICAgICAgIH0pOwogICAgICAgICAgdGhpcy5fdW5iaW5kQ2hpbGQoX2luc3RhbmNlLCBjaGlsZFJvb3QpOwogICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfSBjYXRjaCAoX2Vycm9yKSB7CiAgICAgICAgICBlID0gX2Vycm9yOwogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCLlvJXmlbDjga7lgKTjgYzkuI3mraPjgafjgZnjgIIg5byV5pWw44Go44GX44Gm5LiO44GI44KJ44KM44KL44Kq44OW44K444Kn44Kv44OI44GvIEtheml0b3JpIOOCkue2meaJv+OBl+OBpuOBhOOCi+W/heimgeOBjOOBguOCiuOBvuOBmeOAgiIpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgdGhpcy5fZGlzcGF0Y2hlci5kaXNwYXRjaEV2ZW50KG5ldyBLYXppdG9yaUV2ZW50KEtheml0b3JpRXZlbnQuUkVNT1ZFRCwgdGhpcy5mcmFnbWVudCwgdGhpcy5sYXN0RnJhZ21lbnQpKTsKICAgIHJldHVybiB0aGlzOwogIH07CgogIEtheml0b3JpLnByb3RvdHlwZS5fdW5iaW5kQ2hpbGQgPSBmdW5jdGlvbihjaGlsZCwgY2hpbGRSb290KSB7CiAgICB2YXIgYmVmb3JlUnVsZSwgaSwgbGVuLCBuZXdCZWZvcmVzLCBuZXdIYW5kbGVycywgcnVsZSwgcnVsZU9iajsKICAgIHJ1bGUgPSB0aGlzLl9nZXRDaGlsZFJ1bGUoY2hpbGQsIGNoaWxkUm9vdCk7CiAgICBpID0gMDsKICAgIGxlbiA9IHRoaXMuaGFuZGxlcnMubGVuZ3RoOwogICAgbmV3SGFuZGxlcnMgPSBbXTsKICAgIHdoaWxlIChpIDwgbGVuKSB7CiAgICAgIHJ1bGVPYmogPSB0aGlzLmhhbmRsZXJzLnNoaWZ0KCk7CiAgICAgIGlmICgocnVsZU9iai5ydWxlLm1hdGNoKHJ1bGUpKSA9PT0gbnVsbCkgewogICAgICAgIG5ld0hhbmRsZXJzLnVuc2hpZnQocnVsZU9iaik7CiAgICAgIH0KICAgICAgaSsrOwogICAgfQogICAgdGhpcy5oYW5kbGVycyA9IG5ld0hhbmRsZXJzOwogICAgaSA9IDA7CiAgICBsZW4gPSB0aGlzLmJlZm9yZUhhbmRsZXJzLmxlbmd0aDsKICAgIG5ld0JlZm9yZXMgPSBbXTsKICAgIHdoaWxlIChpIDwgbGVuKSB7CiAgICAgIGJlZm9yZVJ1bGUgPSB0aGlzLmJlZm9yZUhhbmRsZXJzLnNoaWZ0KCk7CiAgICAgIGlmICgoYmVmb3JlUnVsZS5ydWxlLm1hdGNoKHJ1bGUpKSA9PT0gbnVsbCkgewogICAgICAgIG5ld0JlZm9yZXMudW5zaGlmdChiZWZvcmVSdWxlKTsKICAgICAgfQogICAgICBpKys7CiAgICB9CiAgICByZXR1cm4gdGhpcy5iZWZvcmVIYW5kbGVycyA9IG5ld0JlZm9yZXM7CiAgfTsKCiAgLyoqCiAgKiDjg5bjg6njgqbjgrbjgYvjgonnj77lnKjjga4gVVJMIOOCkuiqreOBv+i+vOOBv+OBvuOBmeOAggogICogQG1ldGhvZCBsb2FkVVJMCiAgKiBAcGFyYW0ge1N0cmluZ30gZnJhZ21lbnRPdmVycmlkZQogICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMKICAqLwoKCiAgS2F6aXRvcmkucHJvdG90eXBlLmxvYWRVUkwgPSBmdW5jdGlvbihmcmFnbWVudE92ZXJyaWRlLCBvcHRpb25zKSB7CiAgICB2YXIgZnJhZ21lbnQ7CiAgICB0aGlzLl9wcm9jZXNzU3RlcC5zdGF0dXMgPSAnbG9hZFVSTCc7CiAgICB0aGlzLl9wcm9jZXNzU3RlcC5hcmdzID0gW2ZyYWdtZW50T3ZlcnJpZGUsIG9wdGlvbnNdOwogICAgaWYgKHRoaXMuaXNTdXNwZW5kKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGZyYWdtZW50ID0gdGhpcy5mcmFnbWVudCA9IHRoaXMuZ2V0RnJhZ21lbnQoZnJhZ21lbnRPdmVycmlkZSk7CiAgICBpZiAodGhpcy5pc1RlbWFlID09PSBmYWxzZSAmJiAodGhpcy5iZWZvcmVBbnl0aW1lSGFuZGxlciB8fCB0aGlzLmJlZm9yZUhhbmRsZXJzLmxlbmd0aCA+IDApKSB7CiAgICAgIHRoaXMuX2V4ZWN1dGVCZWZvcmVzKGZyYWdtZW50KTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuZXhlY3V0ZUhhbmRsZXJzKCk7CiAgICB9CiAgfTsKCiAgLyoqCiAgKiDmjIflrprjgZfjgZ8g5paH5a2X5YiX44Gr5a++5b+c44GX44GfIFVSTCDjg6vjg7zjg6vjgYzoqK3lrprjgZXjgozjgabjgYTjgovjgYvjganjgYbjgYs8YnI+CiAgKiBCb29sZWFuIOOBp+i/lOOBl+OBvuOBmeOAggogICogPGg0PmV4YW1wbGU8L2g0PgogICogICAgIGFwcC5tYXRjaCgnL2hvZ2UnKTsKICAqIEBtZXRob2QgbWF0Y2gKICAqIEBwYXJhbSB7U3RyaW5nfSBmcmFnbWVudAogICogQHJldHVybiB7Qm9vbGVhbn0KICAqLwoKCiAgS2F6aXRvcmkucHJvdG90eXBlLm1hdGNoID0gZnVuY3Rpb24oZnJhZ21lbnQpIHsKICAgIHZhciBtYXRjaGVkOwogICAgbWF0Y2hlZCA9IHRoaXMuX21hdGNoQ2hlY2soZnJhZ21lbnQsIHRoaXMuaGFuZGxlcnMsIHRydWUpOwogICAgcmV0dXJuIG1hdGNoZWQubGVuZ3RoID4gMDsKICB9OwoKICBLYXppdG9yaS5wcm90b3R5cGUuYmVmb3JlQ29tcGxldGUgPSBmdW5jdGlvbihldmVudCkgewogICAgdGhpcy5fYmVmb3JlRGVmZmVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoS2F6aXRvcmlFdmVudC5UQVNLX1FVRVVFX0NPTVBMRVRFLCB0aGlzLmJlZm9yZUNvbXBsZXRlKTsKICAgIHRoaXMuX2JlZm9yZURlZmZlci5yZW1vdmVFdmVudExpc3RlbmVyKEtheml0b3JpRXZlbnQuVEFTS19RVUVVRV9GQUlMRUQsIHRoaXMuYmVmb3JlRmFpbGVkKTsKICAgIHRoaXMuX2Rpc3BhdGNoZXIuZGlzcGF0Y2hFdmVudChuZXcgS2F6aXRvcmlFdmVudChLYXppdG9yaUV2ZW50LkJFRk9SRV9FWEVDVVRFRCwgdGhpcy5mcmFnbWVudCwgdGhpcy5sYXN0RnJhZ21lbnQpKTsKICAgIGlmICh0aGlzLmlzVGVtYWUpIHsKICAgICAgdGhpcy5fdXJsQ2hhbmdlKHRoaXMuZnJhZ21lbnQsIHRoaXMuX2NoYW5nZU9wdGlvbnMpOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5leGVjdXRlSGFuZGxlcnMoKTsKICAgIH0KICB9OwoKICBLYXppdG9yaS5wcm90b3R5cGUuX2V4ZWN1dGVCZWZvcmVzID0gZnVuY3Rpb24oZnJhZ21lbnQpIHsKICAgIHZhciBoYW5kbGVyLCBtYXRjaGVkLCBfaSwgX2xlbiwKICAgICAgX3RoaXMgPSB0aGlzOwogICAgdGhpcy5fcHJvY2Vzc1N0ZXAuc3RhdHVzID0gJ19leGVjdXRlQmVmb3Jlcyc7CiAgICB0aGlzLl9wcm9jZXNzU3RlcC5hcmdzID0gW2ZyYWdtZW50XTsKICAgIHRoaXMuX2JlZm9yZURlZmZlciA9IG5ldyBEZWZmZXJlZCgpOwogICAgaWYgKHRoaXMuYmVmb3JlQW55dGltZUhhbmRsZXIgIT0gbnVsbCkgewogICAgICB0aGlzLl9iZWZvcmVEZWZmZXIuZGVmZmVyZWQoZnVuY3Rpb24oZCkgewogICAgICAgIF90aGlzLmJlZm9yZUFueXRpbWVIYW5kbGVyLmNhbGxiYWNrKGZyYWdtZW50KTsKICAgICAgICBkLmV4ZWN1dGUoZCk7CiAgICAgIH0pOwogICAgfQogICAgbWF0Y2hlZCA9IHRoaXMuX21hdGNoQ2hlY2soZnJhZ21lbnQsIHRoaXMuYmVmb3JlSGFuZGxlcnMpOwogICAgZm9yIChfaSA9IDAsIF9sZW4gPSBtYXRjaGVkLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7CiAgICAgIGhhbmRsZXIgPSBtYXRjaGVkW19pXTsKICAgICAgdGhpcy5fYmVmb3JlRGVmZmVyLmRlZmZlcmVkKGZ1bmN0aW9uKGQpIHsKICAgICAgICBoYW5kbGVyLmNhbGxiYWNrKGZyYWdtZW50KTsKICAgICAgICBkLmV4ZWN1dGUoZCk7CiAgICAgIH0pOwogICAgfQogICAgdGhpcy5fYmVmb3JlRGVmZmVyLmFkZEV2ZW50TGlzdGVuZXIoS2F6aXRvcmlFdmVudC5UQVNLX1FVRVVFX0NPTVBMRVRFLCB0aGlzLmJlZm9yZUNvbXBsZXRlKTsKICAgIHRoaXMuX2JlZm9yZURlZmZlci5hZGRFdmVudExpc3RlbmVyKEtheml0b3JpRXZlbnQuVEFTS19RVUVVRV9GQUlMRUQsIHRoaXMuYmVmb3JlRmFpbGVkKTsKICAgIHJldHVybiB0aGlzLl9iZWZvcmVEZWZmZXIuZXhlY3V0ZSh0aGlzLl9iZWZvcmVEZWZmZXIpOwogIH07CgogIEtheml0b3JpLnByb3RvdHlwZS5leGVjdXRlSGFuZGxlcnMgPSBmdW5jdGlvbigpIHsKICAgIHZhciBoYW5kbGVyLCBpc01hdGNoZWQsIG1hdGNoLCBtYXRjaGVkLCBfaSwgX2osIF9sZW4sIF9sZW4xLAogICAgICBfdGhpcyA9IHRoaXM7CiAgICB0aGlzLl9wcm9jZXNzU3RlcC5zdGF0dXMgPSAnZXhlY3V0ZUhhbmRsZXJzJzsKICAgIHRoaXMuX3Byb2Nlc3NTdGVwLmFyZ3MgPSBbXTsKICAgIGlmICh0aGlzLmlzU3VzcGVuZCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBtYXRjaGVkID0gdGhpcy5fbWF0Y2hDaGVjayh0aGlzLmZyYWdtZW50LCB0aGlzLmhhbmRsZXJzKTsKICAgIGlzTWF0Y2hlZCA9IHRydWU7CiAgICBpZiAobWF0Y2hlZCA9PT0gZmFsc2UgfHwgbWF0Y2hlZC5sZW5ndGggPCAxKSB7CiAgICAgIGlmICh0aGlzLm5vdEZvdW5kICE9PSBudWxsKSB7CiAgICAgICAgdGhpcy5fbm90Rm91bmQuY2FsbGJhY2sodGhpcy5mcmFnbWVudCk7CiAgICAgIH0KICAgICAgaXNNYXRjaGVkID0gZmFsc2U7CiAgICAgIHRoaXMuX2Rpc3BhdGNoZXIuZGlzcGF0Y2hFdmVudChuZXcgS2F6aXRvcmlFdmVudChLYXppdG9yaUV2ZW50Lk5PVF9GT1VORCkpOwogICAgfSBlbHNlIGlmIChtYXRjaGVkLmxlbmd0aCA+IDEpIHsKICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSBtYXRjaGVkLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7CiAgICAgICAgbWF0Y2ggPSBtYXRjaGVkW19pXTsKICAgICAgICBpZiAodGhpcy5mcmFnbWVudC5pbmRleE9mKG1hdGNoLnJ1bGUpID4gLTEpIHsKICAgICAgICAgIG1hdGNoLmNhbGxiYWNrKHRoaXMuZnJhZ21lbnQpOwogICAgICAgIH0KICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgZm9yIChfaiA9IDAsIF9sZW4xID0gbWF0Y2hlZC5sZW5ndGg7IF9qIDwgX2xlbjE7IF9qKyspIHsKICAgICAgICBoYW5kbGVyID0gbWF0Y2hlZFtfal07CiAgICAgICAgaGFuZGxlci5jYWxsYmFjayh0aGlzLmZyYWdtZW50KTsKICAgICAgfQogICAgfQogICAgaWYgKHRoaXMuX2lzRmlyc3RSZXF1ZXN0KSB7CiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgX3RoaXMuX2Rpc3BhdGNoZXIuZGlzcGF0Y2hFdmVudChuZXcgS2F6aXRvcmlFdmVudChLYXppdG9yaUV2ZW50LkZJUlNUX1JFUVVFU1QsIF90aGlzLmZyYWdtZW50LCBudWxsKSk7CiAgICAgICAgaWYgKGlzTWF0Y2hlZCkgewogICAgICAgICAgcmV0dXJuIF90aGlzLl9kaXNwYXRjaGVyLmRpc3BhdGNoRXZlbnQobmV3IEtheml0b3JpRXZlbnQoS2F6aXRvcmlFdmVudC5FWEVDVVRFRCwgX3RoaXMuZnJhZ21lbnQsIG51bGwpKTsKICAgICAgICB9CiAgICAgIH0sIDApOwogICAgICB0aGlzLl9pc0ZpcnN0UmVxdWVzdCA9IGZhbHNlOwogICAgfSBlbHNlIHsKICAgICAgaWYgKGlzTWF0Y2hlZCkgewogICAgICAgIHRoaXMuX2Rpc3BhdGNoZXIuZGlzcGF0Y2hFdmVudChuZXcgS2F6aXRvcmlFdmVudChLYXppdG9yaUV2ZW50LkVYRUNVVEVELCB0aGlzLmZyYWdtZW50LCB0aGlzLmxhc3RGcmFnbWVudCkpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gbWF0Y2hlZDsKICB9OwoKICBLYXppdG9yaS5wcm90b3R5cGUuYmVmb3JlRmFpbGVkID0gZnVuY3Rpb24oZXZlbnQpIHsKICAgIHRoaXMuYmVmb3JlRmFpbGVkSGFuZGxlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgdGhpcy5fYmVmb3JlRGVmZmVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoS2F6aXRvcmlFdmVudC5UQVNLX1FVRVVFX0ZBSUxFRCwgdGhpcy5iZWZvcmVGYWlsZWQpOwogICAgdGhpcy5fYmVmb3JlRGVmZmVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoS2F6aXRvcmlFdmVudC5UQVNLX1FVRVVFX0NPTVBMRVRFLCB0aGlzLmJlZm9yZUNvbXBsZXRlKTsKICAgIGlmICh0aGlzLmlzQmVmb3JlRm9yY2UpIHsKICAgICAgdGhpcy5iZWZvcmVDb21wbGV0ZSgpOwogICAgfQogICAgdGhpcy5fYmVmb3JlRGVmZmVyID0gbnVsbDsKICB9OwoKICBLYXppdG9yaS5wcm90b3R5cGUub2JzZXJ2ZVVSTEhhbmRsZXIgPSBmdW5jdGlvbihldmVudCkgewogICAgdmFyIGN1cnJlbnQ7CiAgICBjdXJyZW50ID0gdGhpcy5nZXRGcmFnbWVudCgpOwogICAgaWYgKGN1cnJlbnQgPT09IHRoaXMuZnJhZ21lbnQgJiYgdGhpcy5pZnJhbWUpIHsKICAgICAgY3VycmVudCA9IHRoaXMuZ2V0RnJhZ21lbnQodGhpcy5nZXRIYXNoKHRoaXMuaWZyYW1lKSk7CiAgICB9CiAgICBpZiAoY3VycmVudCA9PT0gdGhpcy5mcmFnbWVudCkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBpZiAodGhpcy5pZnJhbWUpIHsKICAgICAgdGhpcy5jaGFuZ2UoY3VycmVudCk7CiAgICB9CiAgICBpZiAodGhpcy5sYXN0RnJhZ21lbnQgPT09IGN1cnJlbnQgJiYgdGhpcy5pc1VzZXJBY3Rpb24gPT09IGZhbHNlKSB7CiAgICAgIHRoaXMuX2Rpc3BhdGNoZXIuZGlzcGF0Y2hFdmVudChuZXcgS2F6aXRvcmlFdmVudChLYXppdG9yaUV2ZW50LlBSRVYsIGN1cnJlbnQsIHRoaXMuZnJhZ21lbnQpKTsKICAgIH0gZWxzZSBpZiAodGhpcy5sYXN0RnJhZ21lbnQgPT09IHRoaXMuZnJhZ21lbnQgJiYgdGhpcy5pc1VzZXJBY3Rpb24gPT09IGZhbHNlKSB7CiAgICAgIHRoaXMuX2Rpc3BhdGNoZXIuZGlzcGF0Y2hFdmVudChuZXcgS2F6aXRvcmlFdmVudChLYXppdG9yaUV2ZW50Lk5FWFQsIGN1cnJlbnQsIHRoaXMubGFzdEZyYWdtZW50KSk7CiAgICB9CiAgICB0aGlzLmlzVXNlckFjdGlvbiA9IGZhbHNlOwogICAgdGhpcy5fZGlzcGF0Y2hlci5kaXNwYXRjaEV2ZW50KG5ldyBLYXppdG9yaUV2ZW50KEtheml0b3JpRXZlbnQuQ0hBTkdFLCBjdXJyZW50LCB0aGlzLmxhc3RGcmFnbWVudCkpOwogICAgcmV0dXJuIHRoaXMubG9hZFVSTChjdXJyZW50KTsKICB9OwoKICBLYXppdG9yaS5wcm90b3R5cGUuX2JpbmRSdWxlcyA9IGZ1bmN0aW9uKCkgewogICAgdmFyIHJvdXRlcywgcnVsZSwgX2ksIF9sZW47CiAgICBpZiAodGhpcy5yb3V0ZXMgPT0gbnVsbCkgewogICAgICByZXR1cm47CiAgICB9CiAgICByb3V0ZXMgPSB0aGlzLl9rZXlzKHRoaXMucm91dGVzKTsKICAgIGZvciAoX2kgPSAwLCBfbGVuID0gcm91dGVzLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7CiAgICAgIHJ1bGUgPSByb3V0ZXNbX2ldOwogICAgICB0aGlzLnJlZ2lzdGVySGFuZGxlcihydWxlLCB0aGlzLnJvdXRlc1tydWxlXSwgZmFsc2UpOwogICAgfQogIH07CgogIEtheml0b3JpLnByb3RvdHlwZS5fYmluZEJlZm9yZXMgPSBmdW5jdGlvbigpIHsKICAgIHZhciBiZWZvcmVzLCBrZXksIF9pLCBfbGVuOwogICAgaWYgKHRoaXMuYmVmb3JlQW55dGltZSkgewogICAgICB0aGlzLl9iaW5kQmVmb3JlQW55dGltZSh0aGlzLmJlZm9yZUFueXRpbWUpOwogICAgfQogICAgaWYgKHRoaXMuYmVmb3JlcyA9PSBudWxsKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGJlZm9yZXMgPSB0aGlzLl9rZXlzKHRoaXMuYmVmb3Jlcyk7CiAgICBmb3IgKF9pID0gMCwgX2xlbiA9IGJlZm9yZXMubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHsKICAgICAga2V5ID0gYmVmb3Jlc1tfaV07CiAgICAgIHRoaXMucmVnaXN0ZXJIYW5kbGVyKGtleSwgdGhpcy5iZWZvcmVzW2tleV0sIHRydWUpOwogICAgfQogIH07CgogIEtheml0b3JpLnByb3RvdHlwZS5fYmluZEJlZm9yZUFueXRpbWUgPSBmdW5jdGlvbihmdW5jcywgYmluZGVkRnVuY3MpIHsKICAgIHZhciBjYWxsYmFjazsKICAgIGNhbGxiYWNrID0gdGhpcy5fYmluZEZ1bmN0aW9ucyhmdW5jcywgYmluZGVkRnVuY3MpOwogICAgcmV0dXJuIHRoaXMuYmVmb3JlQW55dGltZUhhbmRsZXIgPSB7CiAgICAgIGNhbGxiYWNrOiB0aGlzLl9iaW5kZXIoZnVuY3Rpb24oZnJhZ21lbnQpIHsKICAgICAgICB2YXIgYXJnczsKICAgICAgICBhcmdzID0gW2ZyYWdtZW50XTsKICAgICAgICByZXR1cm4gY2FsbGJhY2sgJiYgY2FsbGJhY2suYXBwbHkodGhpcywgYXJncyk7CiAgICAgIH0sIHRoaXMpCiAgICB9OwogIH07CgogIEtheml0b3JpLnByb3RvdHlwZS5fYmluZE5vdEZvdW5kID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgY2FsbGJhY2ssIG5vdEZvdW5kRnJhZ21lbnQsIG5vdEZvdW5kRnVuY05hbWUsIHJ1bGUsIF9pLCBfbGVuLCBfcmVmOwogICAgaWYgKHRoaXMubm90Rm91bmQgPT0gbnVsbCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAodHlwZW9mIHRoaXMubm90Rm91bmQgPT09ICJzdHJpbmciKSB7CiAgICAgIF9yZWYgPSB0aGlzLmhhbmRsZXJzOwogICAgICBmb3IgKF9pID0gMCwgX2xlbiA9IF9yZWYubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHsKICAgICAgICBydWxlID0gX3JlZltfaV07CiAgICAgICAgaWYgKHJ1bGUucnVsZSA9PT0gJy8nICsgdGhpcy5ub3RGb3VuZC5yZXBsYWNlKHRoaXMucm9vdCwgJycpKSB7CiAgICAgICAgICB0aGlzLl9ub3RGb3VuZCA9IHJ1bGU7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICB9CiAgICB9IGVsc2UgewogICAgICBub3RGb3VuZEZyYWdtZW50ID0gdGhpcy5fa2V5cyh0aGlzLm5vdEZvdW5kKVswXTsKICAgIH0KICAgIG5vdEZvdW5kRnVuY05hbWUgPSB0aGlzLm5vdEZvdW5kW25vdEZvdW5kRnJhZ21lbnRdOwogICAgaWYgKHR5cGVvZiBub3RGb3VuZEZ1bmNOYW1lID09PSAiZnVuY3Rpb24iKSB7CiAgICAgIGNhbGxiYWNrID0gbm90Rm91bmRGdW5jTmFtZTsKICAgIH0gZWxzZSB7CiAgICAgIGNhbGxiYWNrID0gdGhpc1tub3RGb3VuZEZ1bmNOYW1lXTsKICAgIH0KICAgIHRoaXMuX25vdEZvdW5kID0gbmV3IFJ1bGUobm90Rm91bmRGcmFnbWVudCwgZnVuY3Rpb24oZnJhZ21lbnQpIHsKICAgICAgdmFyIGFyZ3M7CiAgICAgIGFyZ3MgPSB0aGlzLnJvdXRlci5leHRyYWN0UGFyYW1zKHRoaXMsIGZyYWdtZW50KTsKICAgICAgcmV0dXJuIGNhbGxiYWNrICYmIGNhbGxiYWNrLmFwcGx5KHRoaXMucm91dGVyLCBhcmdzKTsKICAgIH0sIHRoaXMpOwogIH07CgogIEtheml0b3JpLnByb3RvdHlwZS5fdXBkYXRlSGFzaCA9IGZ1bmN0aW9uKGxvY2F0aW9uLCBmcmFnbWVudCwgcmVwbGFjZSkgewogICAgdmFyIGF0Um9vdCwgaHJlZjsKICAgIGF0Um9vdCA9IHRoaXMubG9jYXRpb24ucGF0aG5hbWUucmVwbGFjZSgvW15cL10kLywgJyQmLycpID09PSB0aGlzLnJvb3Q7CiAgICBpZiAoIWF0Um9vdCkgewogICAgICBsb2NhdGlvbi5yZXBsYWNlKHRoaXMucm9vdCArICcjJyArIGZyYWdtZW50KTsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKHJlcGxhY2UpIHsKICAgICAgaHJlZiA9IGxvY2F0aW9uLmhyZWYucmVwbGFjZSgvKGphdmFzY3JpcHQ6fCMpLiokLywgJycpOwogICAgICBsb2NhdGlvbi5yZXBsYWNlKGhyZWYgKyAnIycgKyBmcmFnbWVudCk7CiAgICB9IGVsc2UgewogICAgICBsb2NhdGlvbi5oYXNoID0gIiMiICsgZnJhZ21lbnQ7CiAgICB9CiAgfTsKCiAgS2F6aXRvcmkucHJvdG90eXBlLl91cGRhdGVIYXNoSUUgPSBmdW5jdGlvbihmcmFnbWVudCwgcmVwbGFjZSkgewogICAgcmV0dXJuIGxvY2F0aW9uLnJlcGxhY2UodGhpcy5yb290ICsgJyMvJyArIGZyYWdtZW50KTsKICB9OwoKICBLYXppdG9yaS5wcm90b3R5cGUuX21hdGNoQ2hlY2sgPSBmdW5jdGlvbihmcmFnbWVudCwgaGFuZGxlcnMsIHRlc3QpIHsKICAgIHZhciBhLCBhcmdzLCBhcmdzTWF0Y2gsIGFyZ3NNYXRjaGVkLCBoYW5kbGVyLCBoYXNRdWVyeSwgaSwgbGVuLCBtYXRjaCwgbWF0Y2hlZCwgdCwgdG1wRnJhZywgX2ksIF9qLCBfbGVuLCBfbGVuMTsKICAgIGlmICh0ZXN0ID09IG51bGwpIHsKICAgICAgdGVzdCA9IGZhbHNlOwogICAgfQogICAgbWF0Y2hlZCA9IFtdOwogICAgdG1wRnJhZyA9IGZyYWdtZW50OwogICAgaWYgKHRtcEZyYWcgIT09IHZvaWQgMCAmJiB0bXBGcmFnICE9PSAndW5kZWZpbmVkJykgewogICAgICBoYXNRdWVyeSA9IHRoaXMuX21hdGNoLmFwcGx5KHRtcEZyYWcsIFsvKFw/W1x3XGQ9fF0rKS9nXSk7CiAgICB9CiAgICBpZiAoaGFzUXVlcnkpIHsKICAgICAgZnJhZ21lbnQgPSBmcmFnbWVudC5zcGxpdCgnPycpWzBdOwogICAgfQogICAgZm9yIChfaSA9IDAsIF9sZW4gPSBoYW5kbGVycy5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykgewogICAgICBoYW5kbGVyID0gaGFuZGxlcnNbX2ldOwogICAgICBpZiAoaGFuZGxlci5ydWxlID09PSBmcmFnbWVudCkgewogICAgICAgIG1hdGNoZWQucHVzaChoYW5kbGVyKTsKICAgICAgfSBlbHNlIGlmIChoYW5kbGVyLnRlc3QoZnJhZ21lbnQpKSB7CiAgICAgICAgaWYgKGhhbmRsZXIuaXNWYXJpYWJsZSAmJiBoYW5kbGVyLnR5cGVzLmxlbmd0aCA+IDApIHsKICAgICAgICAgIGFyZ3MgPSB0aGlzLmV4dHJhY3RQYXJhbXMoaGFuZGxlciwgZnJhZ21lbnQsIHRlc3QpOwogICAgICAgICAgYXJnc01hdGNoID0gW107CiAgICAgICAgICBsZW4gPSBhcmdzLmxlbmd0aDsKICAgICAgICAgIGkgPSAwOwogICAgICAgICAgd2hpbGUgKGkgPCBsZW4pIHsKICAgICAgICAgICAgYSA9IGFyZ3NbaV07CiAgICAgICAgICAgIHQgPSBoYW5kbGVyLnR5cGVzW2ldOwogICAgICAgICAgICBpZiAodHlwZW9mIGEgIT09ICJvYmplY3QiKSB7CiAgICAgICAgICAgICAgaWYgKHQgPT09IG51bGwpIHsKICAgICAgICAgICAgICAgIGFyZ3NNYXRjaC5wdXNoKHRydWUpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBhcmdzTWF0Y2gucHVzaCh0aGlzLl90eXBlQ2hlY2soYSwgdCkpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpKys7CiAgICAgICAgICB9CiAgICAgICAgICBhcmdzTWF0Y2hlZCA9IHRydWU7CiAgICAgICAgICBmb3IgKF9qID0gMCwgX2xlbjEgPSBhcmdzTWF0Y2gubGVuZ3RoOyBfaiA8IF9sZW4xOyBfaisrKSB7CiAgICAgICAgICAgIG1hdGNoID0gYXJnc01hdGNoW19qXTsKICAgICAgICAgICAgaWYgKCFtYXRjaCkgewogICAgICAgICAgICAgIGFyZ3NNYXRjaGVkID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGlmIChhcmdzTWF0Y2hlZCkgewogICAgICAgICAgICBtYXRjaGVkLnB1c2goaGFuZGxlcik7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG1hdGNoZWQucHVzaChoYW5kbGVyKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGlmIChtYXRjaGVkLmxlbmd0aCA+IDApIHsKICAgICAgcmV0dXJuIG1hdGNoZWQ7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgfTsKCiAgLyoqCiAgKiBVUkwg44Or44O844OI5Lul5LiL44KS5Y+W5b6XCiAgKiBAbWV0aG9kIGdldEZyYWdtZW50CiAgKiBAcGFyYW0ge1N0cmluZ30gZnJhZ21lbnQKICAqLwoKCiAgS2F6aXRvcmkucHJvdG90eXBlLmdldEZyYWdtZW50ID0gZnVuY3Rpb24oZnJhZ21lbnQpIHsKICAgIHZhciBmcmFnLCBpbmRleCwgbWF0Y2hlZCwgcm9vdCwgX2ksIF9sZW4sIF9yZWY7CiAgICBpZiAoKGZyYWdtZW50ID09IG51bGwpIHx8IGZyYWdtZW50ID09PSB2b2lkIDApIHsKICAgICAgaWYgKHRoaXMuX2hhc1B1c2hTdGF0ZSB8fCAhdGhpcy5fd2FudENoYW5nZUhhc2gpIHsKICAgICAgICBmcmFnbWVudCA9IHRoaXMubG9jYXRpb24ucGF0aG5hbWU7CiAgICAgICAgbWF0Y2hlZCA9IGZhbHNlOwogICAgICAgIGZyYWcgPSBmcmFnbWVudDsKICAgICAgICBpZiAoZnJhZy5tYXRjaCgvXlwvLykpIHsKICAgICAgICAgIGZyYWcgPSBmcmFnLnN1YnN0cigxKTsKICAgICAgICB9CiAgICAgICAgcm9vdCA9IHRoaXMucm9vdDsKICAgICAgICBpZiAocm9vdC5tYXRjaCgvXlwvLykpIHsKICAgICAgICAgIHJvb3QgPSByb290LnN1YnN0cigxKTsKICAgICAgICB9CiAgICAgICAgX3JlZiA9IHRoaXMucm9vdEZpbGVzOwogICAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gX3JlZi5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykgewogICAgICAgICAgaW5kZXggPSBfcmVmW19pXTsKICAgICAgICAgIGlmIChpbmRleCA9PT0gZnJhZyB8fCByb290ICsgaW5kZXggPT09IGZyYWcpIHsKICAgICAgICAgICAgbWF0Y2hlZCA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChtYXRjaGVkKSB7CiAgICAgICAgICBmcmFnbWVudCA9IHRoaXMucm9vdDsKICAgICAgICB9CiAgICAgICAgZnJhZ21lbnQgPSBmcmFnbWVudCArIHRoaXMubG9jYXRpb24uc2VhcmNoOwogICAgICAgIHJvb3QgPSB0aGlzLnJvb3QucmVwbGFjZSh0cmFpbGluZ1NsYXNoLCAnJyk7CiAgICAgICAgaWYgKGZyYWdtZW50LmluZGV4T2Yocm9vdCkgPiAtMSkgewogICAgICAgICAgZnJhZ21lbnQgPSBmcmFnbWVudC5zdWJzdHIocm9vdC5sZW5ndGgpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBmcmFnbWVudCA9IHRoaXMuZ2V0SGFzaCgpOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICByb290ID0gdGhpcy5yb290LnJlcGxhY2UodHJhaWxpbmdTbGFzaCwgJycpOwogICAgICBpZiAoZnJhZ21lbnQuaW5kZXhPZih0aGlzLnJvb3QpID4gLTEgJiYgZnJhZ21lbnQuaW5kZXhPZihyb290KSA+IC0xKSB7CiAgICAgICAgZnJhZ21lbnQgPSBmcmFnbWVudC5zdWJzdHIocm9vdC5sZW5ndGgpOwogICAgICB9CiAgICB9CiAgICBpZiAodHlwZW9mIGZyYWdtZW50ID09PSAic3RyaW5nIikgewogICAgICBmcmFnbWVudCA9IGZyYWdtZW50LnJlcGxhY2UodHJhaWxpbmdTbGFzaCwgJycpOwogICAgICBpZiAoZnJhZ21lbnQgPT09ICIiKSB7CiAgICAgICAgZnJhZ21lbnQgPSAiLyI7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBmcmFnbWVudDsKICB9OwoKICAvKioKICAqIFVSTCDjga4gIyDku6XpmY3jgpLlj5blvpcKICAqIEBtZXRob2QgZ2V0SGFzaAogICogQHJldHVybiB7U3RyaW5nfSBVUkwg44GuICMg5Lul6ZmN44Gu5paH5a2X5YiXCiAgKi8KCgogIEtheml0b3JpLnByb3RvdHlwZS5nZXRIYXNoID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgbWF0Y2g7CiAgICBtYXRjaCA9ICh3aW5kb3cgfHwgdGhpcykubG9jYXRpb24uaHJlZi5tYXRjaCgvIyguKikkLyk7CiAgICBpZiAobWF0Y2ggIT0gbnVsbCkgewogICAgICByZXR1cm4gbWF0Y2hbMV07CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gJyc7CiAgICB9CiAgfTsKCiAgLyoqCiAgKiBVUkwg44OR44Op44Oh44O844K/44KS5YiG6KejCiAgKiBAbWV0aG9kIGV4dHJhY3RQYXJhbXMKICAqIEBwYXJhbSB7UnVsZX0gcnVsZQogICogQHBhcmFtIHtTdHJpbmd9IGZyYWdtZW50CiAgKiBAcGFyYW0ge0Jvb2xlYW59IHRlc3QKICAqLwoKCiAgS2F6aXRvcmkucHJvdG90eXBlLmV4dHJhY3RQYXJhbXMgPSBmdW5jdGlvbihydWxlLCBmcmFnbWVudCwgdGVzdCkgewogICAgdmFyIGssIGt2LCBsYXN0LCBuZXdQYXJhbSwgbmV3UXVlcmllcywgcGFyYW0sIHEsIHF1ZXJpZXMsIHF1ZXJ5LCBxdWVyeVBhcmFtcywgdiwgX2ksIF9sZW47CiAgICBpZiAodGVzdCA9PSBudWxsKSB7CiAgICAgIHRlc3QgPSBmYWxzZTsKICAgIH0KICAgIGlmICh0aGlzLl9wYXJhbXMucGFyYW1zLmxlbmd0aCA+IDAgJiYgdGhpcy5fcGFyYW1zLmZyYWdtZW50ID09PSBmcmFnbWVudCkgewogICAgICByZXR1cm4gdGhpcy5fcGFyYW1zLnBhcmFtczsKICAgIH0KICAgIHBhcmFtID0gcnVsZS5fcmVnZXhwLmV4ZWMoZnJhZ21lbnQpOwogICAgaWYgKHBhcmFtID09PSBudWxsICYmIGZyYWdtZW50LmluZGV4T2YoJz8nKSA+IC0xKSB7CiAgICAgIHBhcmFtID0gWzAsICc/JyArIGZyYWdtZW50LnNwbGl0KCc/JylbMV1dOwogICAgfQogICAgdGhpcy5fcGFyYW1zLmZyYWdtZW50ID0gZnJhZ21lbnQ7CiAgICBpZiAocGFyYW0gIT0gbnVsbCkgewogICAgICBuZXdQYXJhbSA9IHBhcmFtLnNsaWNlKDEpOwogICAgICBsYXN0ID0gcGFyYW1bcGFyYW0ubGVuZ3RoIC0gMV07CiAgICAgIGlmIChsYXN0LmluZGV4T2YoJz8nKSA+IC0xKSB7CiAgICAgICAgbmV3UXVlcmllcyA9IHt9OwogICAgICAgIHF1ZXJpZXMgPSBsYXN0LnNwbGl0KCc/JylbMV07CiAgICAgICAgcXVlcnlQYXJhbXMgPSBxdWVyaWVzLnNwbGl0KCcmJyk7CiAgICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSBxdWVyeVBhcmFtcy5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykgewogICAgICAgICAgcXVlcnkgPSBxdWVyeVBhcmFtc1tfaV07CiAgICAgICAgICBrdiA9IHF1ZXJ5LnNwbGl0KCc9Jyk7CiAgICAgICAgICBrID0ga3ZbMF07CiAgICAgICAgICB2ID0ga3ZbMV0gPyBrdlsxXSA6ICIiOwogICAgICAgICAgaWYgKHYuaW5kZXhPZignfCcpID4gLTEpIHsKICAgICAgICAgICAgdiA9IHYuc3BsaXQoInwiKTsKICAgICAgICAgIH0KICAgICAgICAgIG5ld1F1ZXJpZXNba10gPSB2OwogICAgICAgIH0KICAgICAgICBuZXdQYXJhbS5wb3AoKTsKICAgICAgICBuZXdQYXJhbS5wdXNoKGxhc3Quc3BsaXQoJz8nKVswXSk7CiAgICAgICAgcSA9IHsKICAgICAgICAgICJxdWVyaWVzIjogbmV3UXVlcmllcwogICAgICAgIH07CiAgICAgICAgbmV3UGFyYW0ucHVzaChxKTsKICAgICAgICBpZiAoIXRlc3QpIHsKICAgICAgICAgIHRoaXMuX3BhcmFtcy5wYXJhbXMgPSB0aGlzLl9nZXRDYXN0ZWRQYXJhbXMocnVsZSwgbmV3UGFyYW0uc2xpY2UoMCkpOwogICAgICAgICAgdGhpcy5fcGFyYW1zLnF1ZXJpZXMgPSBuZXdRdWVyaWVzOwogICAgICAgICAgaWYgKHRoaXMuaXNPbGRJRSkgewogICAgICAgICAgICB0aGlzLnBhcmFtcyA9IHRoaXMuX3BhcmFtcy5wYXJhbXM7CiAgICAgICAgICAgIHRoaXMucXVlcmllcyA9IHRoaXMuX3BhcmFtcy5xdWVyaWVzOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoIXRlc3QpIHsKICAgICAgICAgIHRoaXMuX3BhcmFtcy5wYXJhbXMgPSB0aGlzLl9nZXRDYXN0ZWRQYXJhbXMocnVsZSwgbmV3UGFyYW0pOwogICAgICAgICAgaWYgKHRoaXMuaXNPbGRJRSkgewogICAgICAgICAgICB0aGlzLnBhcmFtcyA9IHRoaXMuX3BhcmFtcy5wYXJhbXM7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBuZXdQYXJhbTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuX3BhcmFtcy5wYXJhbXMgPSBbXTsKICAgICAgaWYgKHRoaXMuaXNPbGRJRSkgewogICAgICAgIHRoaXMucGFyYW0gPSBbXTsKICAgICAgfQogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICB9OwoKICBLYXppdG9yaS5wcm90b3R5cGUuX2dldENhc3RlZFBhcmFtcyA9IGZ1bmN0aW9uKHJ1bGUsIHBhcmFtcykgewogICAgdmFyIGNhc3RlZFBhcmFtcywgaSwgbGVuLCB0eXBlLCBfaSwgX2xlbjsKICAgIGkgPSAwOwogICAgaWYgKCFwYXJhbXMpIHsKICAgICAgcmV0dXJuIHBhcmFtczsKICAgIH0KICAgIGlmIChydWxlLnR5cGVzLmxlbmd0aCA8IDEpIHsKICAgICAgcmV0dXJuIHBhcmFtczsKICAgIH0KICAgIGxlbiA9IHBhcmFtcy5sZW5ndGg7CiAgICBjYXN0ZWRQYXJhbXMgPSBbXTsKICAgIHdoaWxlIChpIDwgbGVuKSB7CiAgICAgIGlmIChydWxlLnR5cGVzW2ldID09PSBudWxsKSB7CiAgICAgICAgY2FzdGVkUGFyYW1zLnB1c2gocGFyYW1zW2ldKTsKICAgICAgfSBlbHNlIGlmICh0eXBlb2YgcGFyYW1zW2ldID09PSAib2JqZWN0IikgewogICAgICAgIGNhc3RlZFBhcmFtcy5wdXNoKHBhcmFtc1tpXSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZm9yIChfaSA9IDAsIF9sZW4gPSBWQVJJQUJMRV9UWVBFUy5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykgewogICAgICAgICAgdHlwZSA9IFZBUklBQkxFX1RZUEVTW19pXTsKICAgICAgICAgIGlmIChydWxlLnR5cGVzW2ldID09PSB0eXBlLm5hbWUpIHsKICAgICAgICAgICAgY2FzdGVkUGFyYW1zLnB1c2godHlwZS5jYXN0KHBhcmFtc1tpXSkpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBpKys7CiAgICB9CiAgICByZXR1cm4gY2FzdGVkUGFyYW1zOwogIH07CgogIEtheml0b3JpLnByb3RvdHlwZS5hZGRFdmVudExpc3RlbmVyID0gZnVuY3Rpb24odHlwZSwgbGlzdGVuZXIpIHsKICAgIHJldHVybiB0aGlzLl9kaXNwYXRjaGVyLmFkZEV2ZW50TGlzdGVuZXIodHlwZSwgbGlzdGVuZXIpOwogIH07CgogIEtheml0b3JpLnByb3RvdHlwZS5yZW1vdmVFdmVudExpc3RlbmVyID0gZnVuY3Rpb24odHlwZSwgbGlzdGVuZXIpIHsKICAgIHJldHVybiB0aGlzLl9kaXNwYXRjaGVyLnJlbW92ZUV2ZW50TGlzdGVuZXIodHlwZSwgbGlzdGVuZXIpOwogIH07CgogIEtheml0b3JpLnByb3RvdHlwZS5kaXNwYXRjaEV2ZW50ID0gZnVuY3Rpb24oZXZlbnQpIHsKICAgIHJldHVybiB0aGlzLl9kaXNwYXRjaGVyLmRpc3BhdGNoRXZlbnQoZXZlbnQpOwogIH07CgogIEtheml0b3JpLnByb3RvdHlwZS5fYWRkUG9wU3RhdGVIYW5kbGVyID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgd2luOwogICAgd2luID0gd2luZG93OwogICAgaWYgKHRoaXMuX2hhc1B1c2hTdGF0ZSA9PT0gdHJ1ZSkgewogICAgICB3aW4uYWRkRXZlbnRMaXN0ZW5lcigncG9wc3RhdGUnLCB0aGlzLm9ic2VydmVVUkxIYW5kbGVyKTsKICAgIH0KICAgIGlmICh0aGlzLl93YW50Q2hhbmdlSGFzaCA9PT0gdHJ1ZSAmJiAhdGhpcy5pc09sZElFKSB7CiAgICAgIHJldHVybiB3aW4uYWRkRXZlbnRMaXN0ZW5lcignaGFzaGNoYW5nZScsIHRoaXMub2JzZXJ2ZVVSTEhhbmRsZXIpOwogICAgfSBlbHNlIGlmICh0aGlzLl93YW50Q2hhbmdlSGFzaCA9PT0gdHJ1ZSkgewogICAgICByZXR1cm4gd2luLmF0dGFjaEV2ZW50KCdvbmhhc2hjaGFuZ2UnLCB0aGlzLm9ic2VydmVVUkxIYW5kbGVyKTsKICAgIH0KICB9OwoKICBLYXppdG9yaS5wcm90b3R5cGUuX3JlbW92ZVBvcFN0YXRlSGFuZGxlciA9IGZ1bmN0aW9uKCkgewogICAgdmFyIHdpbjsKICAgIHdpbiA9IHdpbmRvdzsKICAgIHdpbi5yZW1vdmVFdmVudExpc3RlbmVyKCdwb3BzdGF0ZScsIHRoaXMub2JzZXJ2ZVVSTEhhbmRsZXIpOwogICAgd2luLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2hhc2hjaGFuZ2UnLCB0aGlzLm9ic2VydmVVUkxIYW5kbGVyKTsKICAgIGlmICh0aGlzLmlzT2xkSUUpIHsKICAgICAgcmV0dXJuIHdpbi5kZXRhY2hFdmVudCgnb25oYXNoY2hhbmdlJywgdGhpcy5vYnNlcnZlVVJMSGFuZGxlcik7CiAgICB9CiAgfTsKCiAgS2F6aXRvcmkucHJvdG90eXBlLl9zbGljZSA9IEFycmF5LnByb3RvdHlwZS5zbGljZTsKCiAgS2F6aXRvcmkucHJvdG90eXBlLl9yZXBsYWNlID0gU3RyaW5nLnByb3RvdHlwZS5yZXBsYWNlOwoKICBLYXppdG9yaS5wcm90b3R5cGUuX21hdGNoID0gU3RyaW5nLnByb3RvdHlwZS5tYXRjaDsKCiAgS2F6aXRvcmkucHJvdG90eXBlLl9rZXlzID0gT2JqZWN0LmtleXMgfHwgZnVuY3Rpb24ob2JqKSB7CiAgICB2YXIga2V5LCBrZXlzOwogICAgaWYgKG9iaiA9PT0gIU9iamVjdChvYmopKSB7CiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ29iamVjdCBqYSBuYWknKTsKICAgIH0KICAgIGtleXMgPSBbXTsKICAgIGZvciAoa2V5IGluIG9iaikgewogICAgICBpZiAoT2JqZWN0Lmhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpKSB7CiAgICAgICAga2V5c1trZXlzLmxlbmd0aF0gPSBrZXk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBrZXlzOwogIH07CgogIEtheml0b3JpLnByb3RvdHlwZS5fYmluZGVyID0gZnVuY3Rpb24oZnVuYywgb2JqKSB7CiAgICB2YXIgYXJncywgc2xpY2U7CiAgICBzbGljZSA9IHRoaXMuX3NsaWNlOwogICAgYXJncyA9IHNsaWNlLmNhbGwoYXJndW1lbnRzLCAyKTsKICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIGZ1bmMuYXBwbHkob2JqIHx8IHt9LCBhcmdzLmNvbmNhdChzbGljZS5jYWxsKGFyZ3VtZW50cykpKTsKICAgIH07CiAgfTsKCiAgS2F6aXRvcmkucHJvdG90eXBlLl9leHRlbmQgPSBmdW5jdGlvbihvYmopIHsKICAgIHRoaXMuX2VhY2godGhpcy5fc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpLCBmdW5jdGlvbihzb3VyY2UpIHsKICAgICAgdmFyIHByb3AsIF9yZXN1bHRzOwogICAgICBpZiAoc291cmNlKSB7CiAgICAgICAgX3Jlc3VsdHMgPSBbXTsKICAgICAgICBmb3IgKHByb3AgaW4gc291cmNlKSB7CiAgICAgICAgICBfcmVzdWx0cy5wdXNoKG9ialtwcm9wXSA9IHNvdXJjZVtwcm9wXSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfcmVzdWx0czsKICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gb2JqOwogIH07CgogIEtheml0b3JpLnByb3RvdHlwZS5fZWFjaCA9IGZ1bmN0aW9uKG9iaiwgaXRlciwgY3R4KSB7CiAgICB2YXIgZWFjaCwgaSwgaywgbDsKICAgIGlmIChvYmogPT0gbnVsbCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBlYWNoID0gQXJyYXkucHJvdG90eXBlLmZvckVhY2g7CiAgICBpZiAoZWFjaCAmJiBvYmouZm9yRWFjaCA9PT0gZWFjaCkgewogICAgICByZXR1cm4gb2JqLmZvckVhY2goaXRlciwgY3R4KTsKICAgIH0gZWxzZSBpZiAob2JqLmxlbmd0aCA9PT0gK29iai5sZW5ndGgpIHsKICAgICAgaSA9IDA7CiAgICAgIGwgPSBvYmoubGVuZ3RoOwogICAgICB3aGlsZSAoaSA8IGwpIHsKICAgICAgICBpZiAoaXRlci5jYWxsKGN0eCwgb2JqW2ldLCBpLCBvYmopID09PSB0aGlzLmJyZWFrZXIpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaSsrOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBmb3IgKGsgaW4gb2JqKSB7CiAgICAgICAgaWYgKF9faW5kZXhPZi5jYWxsKG9iaiwgaykgPj0gMCkgewogICAgICAgICAgaWYgKGl0ZXIuY2FsbChjdHgsIG9ialtrXSwgaywgb2JqKSA9PT0gdGhpcy5icmVha2VyKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9OwoKICBLYXppdG9yaS5wcm90b3R5cGUuX2JpbmRGdW5jdGlvbnMgPSBmdW5jdGlvbihmdW5jcywgaW5zZXJ0KSB7CiAgICB2YXIgYmluZGVkRnVuY3MsIGNhbGxiYWNrLCBmLCBmdW5jLCBmdW5jTmFtZSwgaSwgbGVuLCBuYW1lcywgbmV3RiwgX2ksIF9sZW47CiAgICBpZiAodHlwZW9mIGZ1bmNzID09PSAnc3RyaW5nJykgewogICAgICBmdW5jcyA9IGZ1bmNzLnNwbGl0KCcsJyk7CiAgICB9CiAgICBiaW5kZWRGdW5jcyA9IFtdOwogICAgZm9yIChfaSA9IDAsIF9sZW4gPSBmdW5jcy5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykgewogICAgICBmdW5jTmFtZSA9IGZ1bmNzW19pXTsKICAgICAgZnVuYyA9IHRoaXNbZnVuY05hbWVdOwogICAgICBpZiAoZnVuYyA9PSBudWxsKSB7CiAgICAgICAgbmFtZXMgPSBmdW5jTmFtZS5zcGxpdCgnLicpOwogICAgICAgIGlmIChuYW1lcy5sZW5ndGggPiAxKSB7CiAgICAgICAgICBmID0gd2luZG93W25hbWVzWzBdXTsKICAgICAgICAgIGkgPSAxOwogICAgICAgICAgbGVuID0gbmFtZXMubGVuZ3RoOwogICAgICAgICAgd2hpbGUgKGkgPCBsZW4pIHsKICAgICAgICAgICAgbmV3RiA9IGZbbmFtZXNbaV1dOwogICAgICAgICAgICBpZiAobmV3RiAhPSBudWxsKSB7CiAgICAgICAgICAgICAgZiA9IG5ld0Y7CiAgICAgICAgICAgICAgaSsrOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jID0gZjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZnVuYyA9IHdpbmRvd1tmdW5jTmFtZV07CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChmdW5jICE9IG51bGwpIHsKICAgICAgICBiaW5kZWRGdW5jcy5wdXNoKGZ1bmMpOwogICAgICB9CiAgICB9CiAgICBpZiAoaW5zZXJ0KSB7CiAgICAgIGJpbmRlZEZ1bmNzID0gaW5zZXJ0LmNvbmNhdChiaW5kZWRGdW5jcyk7CiAgICB9CiAgICBjYWxsYmFjayA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgYXJncywgX2osIF9sZW4xOwogICAgICBhcmdzID0gMSA8PSBhcmd1bWVudHMubGVuZ3RoID8gX19zbGljZS5jYWxsKGFyZ3VtZW50cywgMCkgOiBbXTsKICAgICAgZm9yIChfaiA9IDAsIF9sZW4xID0gYmluZGVkRnVuY3MubGVuZ3RoOyBfaiA8IF9sZW4xOyBfaisrKSB7CiAgICAgICAgZnVuYyA9IGJpbmRlZEZ1bmNzW19qXTsKICAgICAgICBmdW5jLmFwcGx5KHRoaXMsIF9fc2xpY2UuY2FsbChhcmdzKSk7CiAgICAgIH0KICAgIH07CiAgICByZXR1cm4gY2FsbGJhY2s7CiAgfTsKCiAgS2F6aXRvcmkucHJvdG90eXBlLl90eXBlQ2hlY2sgPSBmdW5jdGlvbihhLCB0KSB7CiAgICB2YXIgbWF0Y2hlZCwgdHlwZSwgX2ksIF9sZW47CiAgICBtYXRjaGVkID0gZmFsc2U7CiAgICBmb3IgKF9pID0gMCwgX2xlbiA9IFZBUklBQkxFX1RZUEVTLmxlbmd0aDsgX2kgPCBfbGVuOyBfaSsrKSB7CiAgICAgIHR5cGUgPSBWQVJJQUJMRV9UWVBFU1tfaV07CiAgICAgIGlmICh0LnRvTG93ZXJDYXNlKCkgPT09IHR5cGUubmFtZSkgewogICAgICAgIGlmICh0eXBlLmNhc3QoYSkpIHsKICAgICAgICAgIG1hdGNoZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIG1hdGNoZWQ7CiAgfTsKCiAgcmV0dXJuIEtheml0b3JpOwoKfSkoKTsKCi8qKgoqIHB1c2hTdGF0ZSDjgaflh6bnkIbjgZfjgZ/jgYTjg6vjg7zjg6vjgpLlrprnvqnjgZnjgovjgq/jg6njgrkKKgoqIEBjbGFzcyBSdWxlCiogQGNvbnN0cnVjdG9yCiogQHBhcmFtIHtTdHJpbmd9IHJ1bGUKKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjawoqIEBwYXJhbSB7S2F6aXRvcml9IHJvdXRlcgoqLwoKClJ1bGUgPSAoZnVuY3Rpb24oKSB7CiAgLyoqCiAgKiDjg6vjg7zjg6vmloflrZfliJcKICAqIEBwcm9wZXJ0eSBydWxlCiAgKiBAdHlwZSBTdHJpbmcKICAqIEBkZWZhdWx0ICIiCiAgKi8KCiAgUnVsZS5wcm90b3R5cGUucnVsZSA9ICIiOwoKICBSdWxlLnByb3RvdHlwZS5fcmVnZXhwID0gbnVsbDsKCiAgLyoqCiAgKiDjgrPjg7zjg6vjg5Djg4Pjgq/plqLmlbAKICAqIOODq+ODvOODq+OBqOODnuODg+ODgeOBmeOCi+WgtOWQiOWun+ihjOOBleOCjOOBvuOBmeOAggogICogQHByb3BlcnR5IGNhbGxiYWNrCiAgKiBAdHlwZTogRnVuY3Rpb24KICAqIEBkZWZhdWx0IG51bGwKICAqLwoKCiAgUnVsZS5wcm90b3R5cGUuY2FsbGJhY2sgPSBudWxsOwoKICBSdWxlLnByb3RvdHlwZS5uYW1lID0gIiI7CgogIFJ1bGUucHJvdG90eXBlLnJvdXRlciA9IG51bGw7CgogIFJ1bGUucHJvdG90eXBlLmlzVmFyaWFibGUgPSBmYWxzZTsKCiAgUnVsZS5wcm90b3R5cGUudHlwZXMgPSBbXTsKCiAgZnVuY3Rpb24gUnVsZShydWxlLCBjYWxsYmFjaywgcm91dGVyKSB7CiAgICB0aGlzLnVwZGF0ZSA9IF9fYmluZCh0aGlzLnVwZGF0ZSwgdGhpcyk7CiAgICBpZiAodHlwZW9mIHJ1bGUgIT09ICJzdHJpbmciICYmIHR5cGVvZiBydWxlICE9PSAiTnVtYmVyIikgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLmNhbGxiYWNrID0gY2FsbGJhY2s7CiAgICB0aGlzLnJvdXRlciA9IHJvdXRlcjsKICAgIHRoaXMudXBkYXRlKHJ1bGUpOwogIH0KCiAgLyoqCiAgKiBSdWxlIOOBqOOBl+OBpuWumue+qeOBl+OBn+ODkeOCv+ODvOODs+OBqCBmcmFnbWVudCDjgajjgZfjgabkuI7jgYjjgonjgozjgZ/mloflrZfliJfjgYzjg57jg4Pjg4HjgZnjgovjgYvjganjgYbjgYvjg4bjgrnjg4jjgZnjgosKICAqIEBtZXRob2QgdGVzdAogICogQHBhcmFtIHtTdHJpbmd9IGZyYWdtZW50CiAgKiBAcmV0dXJuIHtCb29sZWFufSDjg57jg4Pjg4HjgZnjgovloLTlkIggdHJ1ZSDjgpLov5TjgZkKICAqLwoKCiAgUnVsZS5wcm90b3R5cGUudGVzdCA9IGZ1bmN0aW9uKGZyYWdtZW50KSB7CiAgICByZXR1cm4gdGhpcy5fcmVnZXhwLnRlc3QoZnJhZ21lbnQpOwogIH07CgogIFJ1bGUucHJvdG90eXBlLl9ydWxlVG9SZWdFeHAgPSBmdW5jdGlvbihydWxlKSB7CiAgICB2YXIgbmV3UnVsZTsKICAgIG5ld1J1bGUgPSBydWxlLnJlcGxhY2UoZXNjYXBlUmVnRXhwLCAnXFwkJicpLnJlcGxhY2Uob3B0aW9uYWxQYXJhbSwgJyg/OiQxKT8nKS5yZXBsYWNlKG5hbWVkUGFyYW0sICcoW15cL10rKScpLnJlcGxhY2Uoc3BsYXRQYXJhbSwgJyguKj8pJyk7CiAgICByZXR1cm4gbmV3IFJlZ0V4cCgnXicgKyBuZXdSdWxlICsgJyQnKTsKICB9OwoKICAvKioKICAqIOS4juOBiOOCieOCjOOBnyBwYXRoIOOBp+ePvuWcqOOBriBSdWxlIOOCkuOCouODg+ODl+ODh+ODvOODiOOBl+OBvuOBmeOAggogICogQG1ldGhvZCB1cGRhdGUKICAqIEBwYXJhbSB7U3RyaW5nfSBwYXRoCiAgKi8KCgogIFJ1bGUucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uKHBhdGgpIHsKICAgIHZhciBtLCBtYXRjaGVkLCByZSwgdCwgX2ksIF9sZW4sIF9yZXN1bHRzOwogICAgdGhpcy5ydWxlID0gcGF0aCArIHRoaXMucnVsZTsKICAgIGlmICh0aGlzLnJ1bGUgIT09ICcvJykgewogICAgICB0aGlzLnJ1bGUgPSB0aGlzLnJ1bGUucmVwbGFjZSh0cmFpbGluZ1NsYXNoLCAnJyk7CiAgICB9CiAgICB0aGlzLl9yZWdleHAgPSB0aGlzLl9ydWxlVG9SZWdFeHAodGhpcy5ydWxlKTsKICAgIHJlID0gbmV3IFJlZ0V4cChuYW1lZFBhcmFtKTsKICAgIG1hdGNoZWQgPSBwYXRoLm1hdGNoKHJlKTsKICAgIGlmIChtYXRjaGVkICE9PSBudWxsKSB7CiAgICAgIHRoaXMuaXNWYXJpYWJsZSA9IHRydWU7CiAgICAgIF9yZXN1bHRzID0gW107CiAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gbWF0Y2hlZC5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykgewogICAgICAgIG0gPSBtYXRjaGVkW19pXTsKICAgICAgICB0ID0gbS5tYXRjaChnZW5lcmljUGFyYW0pIHx8IG51bGw7CiAgICAgICAgX3Jlc3VsdHMucHVzaCh0aGlzLnR5cGVzLnB1c2godCAhPT0gbnVsbCA/IHRbMV0gOiBudWxsKSk7CiAgICAgIH0KICAgICAgcmV0dXJuIF9yZXN1bHRzOwogICAgfQogIH07CgogIHJldHVybiBSdWxlOwoKfSkoKTsKCi8qKgoqIOOCpOODmeODs+ODiOODh+OCo+OCueODkeODg+ODgeODowoqIEBjbGFzcyBFdmVudERpc3BhdGNoZXIKKiBAY29uc3RydWN0b3IKKi8KCgpFdmVudERpc3BhdGNoZXIgPSAoZnVuY3Rpb24oKSB7CiAgZnVuY3Rpb24gRXZlbnREaXNwYXRjaGVyKCkge30KCiAgRXZlbnREaXNwYXRjaGVyLnByb3RvdHlwZS5saXN0ZW5lcnMgPSB7fTsKCiAgRXZlbnREaXNwYXRjaGVyLnByb3RvdHlwZS5hZGRFdmVudExpc3RlbmVyID0gZnVuY3Rpb24odHlwZSwgbGlzdGVuZXIpIHsKICAgIGlmICh0aGlzLmxpc3RlbmVyc1t0eXBlXSA9PT0gdm9pZCAwKSB7CiAgICAgIHRoaXMubGlzdGVuZXJzW3R5cGVdID0gW107CiAgICB9CiAgICBpZiAodGhpcy5faW5BcnJheShsaXN0ZW5lciwgdGhpcy5saXN0ZW5lcnNbdHlwZV0pIDwgMCkgewogICAgICB0aGlzLmxpc3RlbmVyc1t0eXBlXS5wdXNoKGxpc3RlbmVyKTsKICAgIH0KICB9OwoKICBFdmVudERpc3BhdGNoZXIucHJvdG90eXBlLnJlbW92ZUV2ZW50TGlzdGVuZXIgPSBmdW5jdGlvbih0eXBlLCBsaXN0ZW5lcikgewogICAgdmFyIGFyciwgaSwgbGVuLCBwcm9wOwogICAgbGVuID0gMDsKICAgIGZvciAocHJvcCBpbiB0aGlzLmxpc3RlbmVycykgewogICAgICBsZW4rKzsKICAgIH0KICAgIGlmIChsZW4gPCAxKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGFyciA9IHRoaXMubGlzdGVuZXJzW3R5cGVdOwogICAgaWYgKCFhcnIpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgaSA9IDA7CiAgICBsZW4gPSBhcnIubGVuZ3RoOwogICAgd2hpbGUgKGkgPCBsZW4pIHsKICAgICAgaWYgKGFycltpXSA9PT0gbGlzdGVuZXIpIHsKICAgICAgICBpZiAobGVuID09PSAxKSB7CiAgICAgICAgICBkZWxldGUgdGhpcy5saXN0ZW5lcnNbdHlwZV07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGFyci5zcGxpY2UoaSwgMSk7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGkrKzsKICAgIH0KICB9OwoKICBFdmVudERpc3BhdGNoZXIucHJvdG90eXBlLmRpc3BhdGNoRXZlbnQgPSBmdW5jdGlvbihldmVudCkgewogICAgdmFyIGFyeSwgaGFuZGxlciwgX2ksIF9sZW47CiAgICBhcnkgPSB0aGlzLmxpc3RlbmVyc1tldmVudC50eXBlXTsKICAgIGlmIChhcnkgIT09IHZvaWQgMCkgewogICAgICBldmVudC50YXJnZXQgPSB0aGlzOwogICAgICBmb3IgKF9pID0gMCwgX2xlbiA9IGFyeS5sZW5ndGg7IF9pIDwgX2xlbjsgX2krKykgewogICAgICAgIGhhbmRsZXIgPSBhcnlbX2ldOwogICAgICAgIGhhbmRsZXIuY2FsbCh0aGlzLCBldmVudCk7CiAgICAgIH0KICAgIH0KICB9OwoKICBFdmVudERpc3BhdGNoZXIucHJvdG90eXBlLl9pbkFycmF5ID0gZnVuY3Rpb24oZWxlbSwgYXJyYXkpIHsKICAgIHZhciBpLCBsZW47CiAgICBpID0gMDsKICAgIGxlbiA9IGFycmF5Lmxlbmd0aDsKICAgIHdoaWxlIChpIDwgbGVuKSB7CiAgICAgIGlmIChhcnJheVtpXSA9PT0gZWxlbSkgewogICAgICAgIHJldHVybiBpOwogICAgICB9CiAgICAgIGkrKzsKICAgIH0KICAgIHJldHVybiAtMTsKICB9OwoKICByZXR1cm4gRXZlbnREaXNwYXRjaGVyOwoKfSkoKTsKCkRlZmZlcmVkID0gKGZ1bmN0aW9uKF9zdXBlcikgewogIF9fZXh0ZW5kcyhEZWZmZXJlZCwgX3N1cGVyKTsKCiAgRGVmZmVyZWQucHJvdG90eXBlLnF1ZXVlID0gW107CgogIERlZmZlcmVkLnByb3RvdHlwZS5pc1N1c3BlbmQgPSBmYWxzZTsKCiAgZnVuY3Rpb24gRGVmZmVyZWQoKSB7CiAgICB0aGlzLnF1ZXVlID0gW107CiAgICB0aGlzLmlzU3VzcGVuZCA9IGZhbHNlOwogIH0KCiAgRGVmZmVyZWQucHJvdG90eXBlLmRlZmZlcmVkID0gZnVuY3Rpb24oZnVuYykgewogICAgdGhpcy5xdWV1ZS5wdXNoKGZ1bmMpOwogICAgcmV0dXJuIHRoaXM7CiAgfTsKCiAgRGVmZmVyZWQucHJvdG90eXBlLmV4ZWN1dGUgPSBmdW5jdGlvbigpIHsKICAgIHZhciBlcnJvciwgdGFzazsKICAgIGlmICh0aGlzLmlzU3VzcGVuZCkgewogICAgICByZXR1cm47CiAgICB9CiAgICB0cnkgewogICAgICB0YXNrID0gdGhpcy5xdWV1ZS5zaGlmdCgpOwogICAgICBpZiAodGFzaykgewogICAgICAgIHRhc2suYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQogICAgICBpZiAodGhpcy5xdWV1ZS5sZW5ndGggPCAxKSB7CiAgICAgICAgdGhpcy5xdWV1ZSA9IFtdOwogICAgICAgIHJldHVybiB0aGlzLmRpc3BhdGNoRXZlbnQobmV3IEtheml0b3JpRXZlbnQoS2F6aXRvcmlFdmVudC5UQVNLX1FVRVVFX0NPTVBMRVRFKSk7CiAgICAgIH0KICAgIH0gY2F0Y2ggKF9lcnJvcikgewogICAgICBlcnJvciA9IF9lcnJvcjsKICAgICAgcmV0dXJuIHRoaXMucmVqZWN0KGVycm9yKTsKICAgIH0KICB9OwoKICBEZWZmZXJlZC5wcm90b3R5cGUucmVqZWN0ID0gZnVuY3Rpb24oZXJyb3IpIHsKICAgIHZhciBtZXNzYWdlOwogICAgbWVzc2FnZSA9ICFlcnJvciA/ICJ1c2VyIHJlamVjdCIgOiBlcnJvcjsKICAgIHRoaXMuZGlzcGF0Y2hFdmVudCh7CiAgICAgIHR5cGU6IEtheml0b3JpRXZlbnQuVEFTS19RVUVVRV9GQUlMRUQsCiAgICAgIGluZGV4OiB0aGlzLmluZGV4LAogICAgICBtZXNzYWdlOiBtZXNzYWdlCiAgICB9KTsKICAgIHJldHVybiB0aGlzLmlzU3VzcGVuZCA9IGZhbHNlOwogIH07CgogIERlZmZlcmVkLnByb3RvdHlwZS5zdXNwZW5kID0gZnVuY3Rpb24oKSB7CiAgICB0aGlzLmlzU3VzcGVuZCA9IHRydWU7CiAgfTsKCiAgRGVmZmVyZWQucHJvdG90eXBlLnJlc3VtZSA9IGZ1bmN0aW9uKCkgewogICAgdGhpcy5pc1N1c3BlbmQgPSBmYWxzZTsKICAgIHRoaXMuZXhlY3V0ZSgpOwogIH07CgogIHJldHVybiBEZWZmZXJlZDsKCn0pKEV2ZW50RGlzcGF0Y2hlcik7CgovKioKKiBwdXNoU3RhdGUg5Yem55CG44KEIEtheml0b3JpIOOBq+OBvuOBpOOCj+OCi+OCpOODmeODs+ODiAoqIEBjbGFzcyBLYXppdG9yaUV2ZW50CiogQGNvbnN0cnVjdG9yCiogQHBhcmFtIHtTdHJpbmd9IHR5cGUKKiBAcGFyYW0ge1N0cmluZ30gbmV4dAoqIEBwYXJhbSB7U3RyaW5nfSBwcmV2CiovCgoKS2F6aXRvcmlFdmVudCA9IChmdW5jdGlvbigpIHsKICBLYXppdG9yaUV2ZW50LnByb3RvdHlwZS5uZXh0ID0gbnVsbDsKCiAgS2F6aXRvcmlFdmVudC5wcm90b3R5cGUucHJldiA9IG51bGw7CgogIEtheml0b3JpRXZlbnQucHJvdG90eXBlLnR5cGUgPSBudWxsOwoKICBmdW5jdGlvbiBLYXppdG9yaUV2ZW50KHR5cGUsIG5leHQsIHByZXYpIHsKICAgIHRoaXMudHlwZSA9IHR5cGU7CiAgICB0aGlzLm5leHQgPSBuZXh0OwogICAgdGhpcy5wcmV2ID0gcHJldjsKICB9CgogIEtheml0b3JpRXZlbnQucHJvdG90eXBlLmNsb25lID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gbmV3IEtheml0b3JpRXZlbnQodGhpcy50eXBlLCB0aGlzLm5leHQsIHRoaXMucHJldik7CiAgfTsKCiAgS2F6aXRvcmlFdmVudC5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiAiS2F6aXRvcmlFdmVudCA6OiAiICsgInR5cGU6IiArIHRoaXMudHlwZSArICIgbmV4dDoiICsgU3RyaW5nKHRoaXMubmV4dCkgKyAiIHByZXY6IiArIFN0cmluZyh0aGlzLnByZXYpOwogIH07CgogIHJldHVybiBLYXppdG9yaUV2ZW50OwoKfSkoKTsKCi8qKgoqIOOCv+OCueOCr+OCreODpeODvOOBjOepuuOBq+OBquOBo+OBnwoqIEBwcm9wZXJ0eSBUQVNLX1FVRVVFX0NPTVBMRVRFCiogQHR5cGUgU3RyaW5nCiogQGRlZmF1bHQgdGFza19xdWV1ZV9jb21wbGV0ZQoqLwoKCktheml0b3JpRXZlbnQuVEFTS19RVUVVRV9DT01QTEVURSA9ICd0YXNrX3F1ZXVlX2NvbXBsZXRlJzsKCi8qKgoqIOOCv+OCueOCr+OCreODpeODvOOBjOS4reaWreOBleOCjOOBnwoqIEBwcm9wZXJ0eSBUQVNLX1FVRVVFX0ZBSUxFRAoqIEB0eXBlIFN0cmluZwoqIEBkZWZhdWx0IHRhc2tfcXVldWVfZmFpbGVkCiovCgoKS2F6aXRvcmlFdmVudC5UQVNLX1FVRVVFX0ZBSUxFRCA9ICd0YXNrX3F1ZXVlX2ZhaWxlZCc7CgovKioKKiBVUkwg44GM5aSJ5pu044GV44KM44GfCiogQHByb3BlcnR5IENIQU5HRQoqIEB0eXBlIFN0cmluZwoqIEBkZWZhdWx0IGNoYW5nZQoqLwoKCktheml0b3JpRXZlbnQuQ0hBTkdFID0gJ2NoYW5nZSc7CgovKioKKiBVUkwg44Gr55m76Yyy44GV44KM44Gf44Oh44K944OD44OJ44GM44Gh44KD44KT44Go5a6f6KGM44GV44KM44GfCiogQHByb3BlcnR5IEVYRUNVVEVECiogQHR5cGUgU3RyaW5nCiogQGRlZmF1bHQgZXhlY3V0ZWQKKi8KCgpLYXppdG9yaUV2ZW50LkVYRUNVVEVEID0gJ2V4ZWN1dGVkJzsKCi8qKgoqIOS6i+WJjeWHpueQhuOBjOWujOS6huOBl+OBnwoqIEBwcm9wZXJ0eSBCRUZPUkVfRVhFQ1VURUQKKiBAdHlwZSBTdHJpbmcKKiBAZGVmYXVsdCBiZWZvcmVfZXhlY3V0ZWQKKi8KCgpLYXppdG9yaUV2ZW50LkJFRk9SRV9FWEVDVVRFRCA9ICdiZWZvcmVfZXhlY3V0ZWQnOwoKLyoqCiog44Om44O844K244O844Ki44Kv44K344On44Oz5Lul5aSW44GnIFVSTCDjga7lpInmm7TjgYzjgYLjgaPjgZ8KKiBAcHJvcGVydHkgSU5URVJOQUxfQ0hBTkdFCiogQHR5cGUgU3RyaW5nCiogQGRlZmF1bHQgaW50ZXJuYWxfY2hhbmdlCiovCgoKS2F6aXRvcmlFdmVudC5JTlRFUk5BTF9DSEFOR0UgPSAnaW50ZXJuYWxfY2hhbmdlJzsKCktheml0b3JpRXZlbnQuVVNFUl9DSEFOR0UgPSAndXNlcl9jaGFuZ2UnOwoKLyoqCiog44OS44K544OI44Oq44O844OQ44OD44Kv44GX44GfCiogQHByb3BlcnR5IFBSRVYKKiBAdHlwZSBTdHJpbmcKKiBAZGVmYXVsdCBwcmV2CiovCgoKS2F6aXRvcmlFdmVudC5QUkVWID0gJ3ByZXYnOwoKLyoqCiog44OS44K544OI44Oq44O844ON44Kv44K544OI44GX44Gf5pmCCiogQHByb3BlcnR5IE5FWFQKKiBAdHlwZSBTdHJpbmcKKiBAZGVmYXVsdCBuZXh0CiovCgoKS2F6aXRvcmlFdmVudC5ORVhUID0gJ25leHQnOwoKLyoqCiogS2F6aXRvcmkg44GM5Lit5pat44GX44GfCiogQHByb3BlcnR5IFJFSkVDVAoqIEB0eXBlIFN0cmluZwoqIEBkZWZhdWx0IHJlamVjdAoqLwoKCktheml0b3JpRXZlbnQuUkVKRUNUID0gJ3JlamVjdCc7CgovKioKKiBVUkwg44Gr44Oe44OD44OB44GZ44KL5Yem55CG44GM6KaL44Gk44GL44KJ44Gq44GL44Gj44GfCiogQHByb3BlcnR5IE5PVF9GT1VORAoqIEB0eXBlIFN0cmluZwoqIEBkZWZhdWx0IG5vdF9mb3VuZAoqLwoKCktheml0b3JpRXZlbnQuTk9UX0ZPVU5EID0gJ25vdF9mb3VuZCc7CgovKioKKiBLYXppdG9yaSDjgYzplovlp4vjgZfjgZ8KKiBAcHJvcGVydHkgU1RBUlQKKiBAdHlwZSBTdHJpbmcKKiBAZGVmYXVsdCBzdGFydAoqLwoKCktheml0b3JpRXZlbnQuU1RBUlQgPSAnc3RhcnQnOwoKLyoqCiogS2F6aXRvcmkg44GM5YGc5q2i44GX44GfCiogQHByb3BlcnR5IFNUT1AKKiBAdHlwZSBTdHJpbmcKKiBAZGVmYXVsdCBzdG9wCiovCgoKS2F6aXRvcmlFdmVudC5TVE9QID0gJ3N0b3AnOwoKLyoqCiogS2F6aXRvcmkg44GM5LiA5pmC5YGc5q2i44GX44GfCiogQHByb3BlcnR5IFNVU1BFTkQKKiBAdHlwZSBTdHJpbmcKKiBAZGVmYXVsdCBTVVNQRU5ECiovCgoKS2F6aXRvcmlFdmVudC5TVVNQRU5EID0gJ1NVU1BFTkQnOwoKLyoqCiogS2F6aXRvcmkg44GM5YaN6ZaL44GX44GfCiogQHByb3BlcnR5IFJFU1VNRQoqIEB0eXBlIFN0cmluZwoqIEBkZWZhdWx0IHJlc3VtZQoqLwoKCktheml0b3JpRXZlbnQuUkVTVU1FID0gJ3Jlc3VtZSc7CgovKioKKiBLYXppdG9yaSDjgYzplovlp4vjgZfjgabjgYvjgonjgIHkuIDnlarmnIDliJ3jga7jgqLjgq/jgrvjgrnjgYzjgYLjgaPjgZ8KKiBAcHJvcGVydHkgRklSU1RfUkVRVUVTVAoqIEB0eXBlIFN0cmluZwoqIEBkZWZhdWx0IGZpcnN0X3JlcXVlc3QKKi8KCgpLYXppdG9yaUV2ZW50LkZJUlNUX1JFUVVFU1QgPSAnZmlyc3RfcmVxdWVzdCc7CgovKioKKiDjg6vjg7zjgr/jg7zjgYzov73liqDjgZXjgozjgZ8KKiBAcHJvcGVydHkgQURERUQKKiBAdHlwZSBTdHJpbmcKKiBAZGVmYXVsdCBhZGRlZAoqLwoKCktheml0b3JpRXZlbnQuQURERUQgPSAnYWRkZWQnOwoKLyoqCiog44Or44O844K/44O844GM5YmK6Zmk44GV44KM44GfCiogQHByb3BlcnR5IFJFTU9WRUQKKiBAdHlwZSBTdHJpbmcKKiBAZGVmYXVsdCByZW1vdmVkCiovCgoKS2F6aXRvcmlFdmVudC5SRU1PVkVEID0gJ3JlbW92ZWQnOwo=",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Fri, 07 Nov 2014 07:57:58 GMT",
                    "Content-Length": "51020",
                    "Date": "Fri, 07 Nov 2014 07:57:58 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}