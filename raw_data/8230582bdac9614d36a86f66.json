{
    "url": "http://localhost:9999/ripvtech/angular.js/test/ng/browserSpecs.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Cookie manipulation (DOM-based)",
    "issueType": 5245696,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based cookie manipulation vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the value of a cookie in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will set an arbitrary value in the user's cookie.<br><br>The potential impact of the vulnerability depends on the role that the cookie plays within the application. If the cookie is used to control the behavior that results from certain user actions (for example, a 'production' versus 'demo' mode setting), then the attacker may be able to cause the user to perform unintended actions by manipulating the cookie's value. If the cookie is used to track the user's session, then the attacker may be able to perform a session fixation attack, in which they set the cookie's value to a valid token that they have obtained from the application, and then hijack the session during the victim user's subsequent interaction with the application.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based cookie manipulation vulnerabilities is not to dynamically write to cookies using data that originated from any untrusted source. This behavior should never be implemented for cookies that have any role in controlling privileged actions or user sessions within the application.",
    "issueDetail": "The application may be vulnerable to DOM-based cookie manipulation. Data is read from <b>location.pathname</b> and written to <b>document.cookie</b> via the following statements:<ul><li>var path = location.pathname;</li><li>var parts = path.split('/');</li><li>document.cookie = name + \"=;path=\" + (parts.join('/') || '/') + \";expires=Thu, 01 Jan 1970 00:00:00 GMT\";</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/ripvtech/angular.js/test/ng/browserSpecs.js",
                "path": "/ripvtech/angular.js/test/ng/browserSpecs.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9yaXB2dGVjaC9hbmd1bGFyLmpzL3Rlc3QvbmcvYnJvd3NlclNwZWNzLmpzIEhUVFAvMS4xDQpIb3N0OiBsb2NhbGhvc3Q6OTk5OQ0KDQo=",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMjk5NzgNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IFRodSwgMDYgTm92IDIwMTQgMDg6MDA6MTQgR01UDQpMYXN0LU1vZGlmaWVkOiBUaHUsIDA2IE5vdiAyMDE0IDA4OjAwOjEwIEdNVA0KDQondXNlIHN0cmljdCc7Cgp2YXIgaGlzdG9yeUVudHJpZXNMZW5ndGg7CnZhciBzbmlmZmVyID0ge307CgpmdW5jdGlvbiBNb2NrV2luZG93KCkgewogIHZhciBldmVudHMgPSB7fTsKICB2YXIgdGltZW91dHMgPSB0aGlzLnRpbWVvdXRzID0gW107CiAgdmFyIGxvY2F0aW9uSHJlZiA9ICdodHRwOi8vc2VydmVyLyc7CiAgdmFyIG1vY2tXaW5kb3cgPSB0aGlzOwoKICBoaXN0b3J5RW50cmllc0xlbmd0aCA9IDE7CgogIHRoaXMuc2V0VGltZW91dCA9IGZ1bmN0aW9uKGZuKSB7CiAgICByZXR1cm4gdGltZW91dHMucHVzaChmbikgLSAxOwogIH07CgogIHRoaXMuY2xlYXJUaW1lb3V0ID0gZnVuY3Rpb24oaWQpIHsKICAgIHRpbWVvdXRzW2lkXSA9IG5vb3A7CiAgfTsKCiAgdGhpcy5zZXRUaW1lb3V0LmZsdXNoID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgbGVuZ3RoID0gdGltZW91dHMubGVuZ3RoOwogICAgd2hpbGUgKGxlbmd0aC0tID4gMCkgdGltZW91dHMuc2hpZnQoKSgpOwogIH07CgogIHRoaXMuYWRkRXZlbnRMaXN0ZW5lciA9IGZ1bmN0aW9uKG5hbWUsIGxpc3RlbmVyKSB7CiAgICBpZiAoYW5ndWxhci5pc1VuZGVmaW5lZChldmVudHNbbmFtZV0pKSBldmVudHNbbmFtZV0gPSBbXTsKICAgIGV2ZW50c1tuYW1lXS5wdXNoKGxpc3RlbmVyKTsKICB9OwoKICB0aGlzLmF0dGFjaEV2ZW50ID0gZnVuY3Rpb24obmFtZSwgbGlzdGVuZXIpIHsKICAgIHRoaXMuYWRkRXZlbnRMaXN0ZW5lcihuYW1lLnN1YnN0cigyKSwgbGlzdGVuZXIpOwogIH07CgogIHRoaXMucmVtb3ZlRXZlbnRMaXN0ZW5lciA9IG5vb3A7CiAgdGhpcy5kZXRhY2hFdmVudCA9IG5vb3A7CgogIHRoaXMuZmlyZSA9IGZ1bmN0aW9uKG5hbWUpIHsKICAgIGZvckVhY2goZXZlbnRzW25hbWVdLCBmdW5jdGlvbihmbikgewogICAgICBmbih7dHlwZTogbmFtZX0pOyAvLyB0eXBlIHRvIG1ha2UgalF1ZXJ5IGhhcHB5CiAgICB9KTsKICB9OwoKICB0aGlzLmxvY2F0aW9uID0gewogICAgZ2V0IGhyZWYoKSB7CiAgICAgIHJldHVybiBsb2NhdGlvbkhyZWY7CiAgICB9LAogICAgc2V0IGhyZWYodmFsdWUpIHsKICAgICAgbG9jYXRpb25IcmVmID0gdmFsdWU7CiAgICAgIG1vY2tXaW5kb3cuaGlzdG9yeS5zdGF0ZSA9IG51bGw7CiAgICAgIGhpc3RvcnlFbnRyaWVzTGVuZ3RoKys7CiAgICB9LAogICAgcmVwbGFjZTogZnVuY3Rpb24odXJsKSB7CiAgICAgIGxvY2F0aW9uSHJlZiA9IHVybDsKICAgICAgbW9ja1dpbmRvdy5oaXN0b3J5LnN0YXRlID0gbnVsbDsKICAgIH0sCiAgfTsKCiAgdGhpcy5oaXN0b3J5ID0gewogICAgc3RhdGU6IG51bGwsCiAgICBwdXNoU3RhdGU6IGZ1bmN0aW9uKCkgewogICAgICB0aGlzLnJlcGxhY2VTdGF0ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICBoaXN0b3J5RW50cmllc0xlbmd0aCsrOwogICAgfSwKICAgIHJlcGxhY2VTdGF0ZTogZnVuY3Rpb24oc3RhdGUsIHRpdGxlLCB1cmwpIHsKICAgICAgbG9jYXRpb25IcmVmID0gdXJsOwogICAgICBtb2NrV2luZG93Lmhpc3Rvcnkuc3RhdGUgPSBjb3B5KHN0YXRlKTsKICAgIH0KICB9Owp9CgpmdW5jdGlvbiBNb2NrRG9jdW1lbnQoKSB7CiAgdmFyIHNlbGYgPSB0aGlzOwoKICB0aGlzWzBdID0gd2luZG93LmRvY3VtZW50OwogIHRoaXMuYmFzZVBhdGggPSAnLyc7CgogIHRoaXMuZmluZCA9IGZ1bmN0aW9uKG5hbWUpIHsKICAgIGlmIChuYW1lID09ICdiYXNlJykgewogICAgICByZXR1cm4gewogICAgICAgIGF0dHI6IGZ1bmN0aW9uKG5hbWUpewogICAgICAgICAgaWYgKG5hbWUgPT0gJ2hyZWYnKSB7CiAgICAgICAgICAgIHJldHVybiBzZWxmLmJhc2VQYXRoOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKG5hbWUpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfTsKICAgIH0gZWxzZSB7CiAgICAgIHRocm93IG5ldyBFcnJvcihuYW1lKTsKICAgIH0KICB9Owp9CgpkZXNjcmliZSgnYnJvd3NlcicsIGZ1bmN0aW9uKCkgewogIC8qIGdsb2JhbCBCcm93c2VyOiBmYWxzZSAqLwogIHZhciBicm93c2VyLCBmYWtlV2luZG93LCBmYWtlRG9jdW1lbnQsIGxvZ3MsIHNjcmlwdHMsIHJlbW92ZWRTY3JpcHRzOwoKICBiZWZvcmVFYWNoKGZ1bmN0aW9uKCkgewogICAgc2NyaXB0cyA9IFtdOwogICAgcmVtb3ZlZFNjcmlwdHMgPSBbXTsKICAgIHNuaWZmZXIgPSB7aGlzdG9yeTogdHJ1ZX07CiAgICBmYWtlV2luZG93ID0gbmV3IE1vY2tXaW5kb3coKTsKICAgIGZha2VEb2N1bWVudCA9IG5ldyBNb2NrRG9jdW1lbnQoKTsKCiAgICBsb2dzID0ge2xvZzpbXSwgd2FybjpbXSwgaW5mbzpbXSwgZXJyb3I6W119OwoKICAgIHZhciBmYWtlTG9nID0ge2xvZzogZnVuY3Rpb24oKSB7IGxvZ3MubG9nLnB1c2goc2xpY2UuY2FsbChhcmd1bWVudHMpKTsgfSwKICAgICAgICAgICAgICAgICAgIHdhcm46IGZ1bmN0aW9uKCkgeyBsb2dzLndhcm4ucHVzaChzbGljZS5jYWxsKGFyZ3VtZW50cykpOyB9LAogICAgICAgICAgICAgICAgICAgaW5mbzogZnVuY3Rpb24oKSB7IGxvZ3MuaW5mby5wdXNoKHNsaWNlLmNhbGwoYXJndW1lbnRzKSk7IH0sCiAgICAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24oKSB7IGxvZ3MuZXJyb3IucHVzaChzbGljZS5jYWxsKGFyZ3VtZW50cykpOyB9fTsKCiAgICBicm93c2VyID0gbmV3IEJyb3dzZXIoZmFrZVdpbmRvdywgZmFrZURvY3VtZW50LCBmYWtlTG9nLCBzbmlmZmVyKTsKICB9KTsKCiAgZGVzY3JpYmUoJ01vY2tCcm93c2VyIGhpc3RvcnlFbnRyaWVzTGVuZ3RoJywgZnVuY3Rpb24oKSB7CiAgICBpdCgnc2hvdWxkIGluY3JlbWVudCBoaXN0b3J5RW50cmllc0xlbmd0aCB3aGVuIHNldHRpbmcgbG9jYXRpb24uaHJlZicsIGZ1bmN0aW9uKCkgewogICAgICBleHBlY3QoaGlzdG9yeUVudHJpZXNMZW5ndGgpLnRvQmUoMSk7CiAgICAgIGZha2VXaW5kb3cubG9jYXRpb24uaHJlZiA9ICcvZm9vJzsKICAgICAgZXhwZWN0KGhpc3RvcnlFbnRyaWVzTGVuZ3RoKS50b0JlKDIpOwogICAgfSk7CgogICAgaXQoJ3Nob3VsZCBub3QgaW5jcmVtZW50IGhpc3RvcnlFbnRyaWVzTGVuZ3RoIHdoZW4gdXNpbmcgbG9jYXRpb24ucmVwbGFjZScsIGZ1bmN0aW9uKCkgewogICAgICBleHBlY3QoaGlzdG9yeUVudHJpZXNMZW5ndGgpLnRvQmUoMSk7CiAgICAgIGZha2VXaW5kb3cubG9jYXRpb24ucmVwbGFjZSgnL2ZvbycpOwogICAgICBleHBlY3QoaGlzdG9yeUVudHJpZXNMZW5ndGgpLnRvQmUoMSk7CiAgICB9KTsKCiAgICBpdCgnc2hvdWxkIGluY3JlbWVudCBoaXN0b3J5RW50cmllc0xlbmd0aCB3aGVuIHVzaW5nIGhpc3RvcnkucHVzaFN0YXRlJywgZnVuY3Rpb24oKSB7CiAgICAgIGV4cGVjdChoaXN0b3J5RW50cmllc0xlbmd0aCkudG9CZSgxKTsKICAgICAgZmFrZVdpbmRvdy5oaXN0b3J5LnB1c2hTdGF0ZSh7YTogMn0sICdmb28nLCAnL2JhcicpOwogICAgICBleHBlY3QoaGlzdG9yeUVudHJpZXNMZW5ndGgpLnRvQmUoMik7CiAgICB9KTsKCiAgICBpdCgnc2hvdWxkIG5vdCBpbmNyZW1lbnQgaGlzdG9yeUVudHJpZXNMZW5ndGggd2hlbiB1c2luZyBoaXN0b3J5LnJlcGxhY2VTdGF0ZScsIGZ1bmN0aW9uKCkgewogICAgICBleHBlY3QoaGlzdG9yeUVudHJpZXNMZW5ndGgpLnRvQmUoMSk7CiAgICAgIGZha2VXaW5kb3cuaGlzdG9yeS5yZXBsYWNlU3RhdGUoe2E6IDJ9LCAnZm9vJywgJy9iYXInKTsKICAgICAgZXhwZWN0KGhpc3RvcnlFbnRyaWVzTGVuZ3RoKS50b0JlKDEpOwogICAgfSk7CiAgfSk7CgogIGl0KCdzaG91bGQgY29udGFpbiBjb29raWUgY3J1bmNoZXInLCBmdW5jdGlvbigpIHsKICAgIGV4cGVjdChicm93c2VyLmNvb2tpZXMpLnRvQmVEZWZpbmVkKCk7CiAgfSk7CgogIGRlc2NyaWJlKCdvdXRzdGFkaW5nIHJlcXVlc3RzJywgZnVuY3Rpb24oKSB7CiAgICBpdCgnc2hvdWxkIHByb2Nlc3MgY2FsbGJhY2tzIGltbWVkaWV0bHkgd2l0aCBubyBvdXRzdGFuZGluZyByZXF1ZXN0cycsIGZ1bmN0aW9uKCkgewogICAgICB2YXIgY2FsbGJhY2sgPSBqYXNtaW5lLmNyZWF0ZVNweSgnY2FsbGJhY2snKTsKICAgICAgYnJvd3Nlci5ub3RpZnlXaGVuTm9PdXRzdGFuZGluZ1JlcXVlc3RzKGNhbGxiYWNrKTsKICAgICAgZXhwZWN0KGNhbGxiYWNrKS50b0hhdmVCZWVuQ2FsbGVkKCk7CiAgICB9KTsKICB9KTsKCgogIGRlc2NyaWJlKCdkZWZlcicsIGZ1bmN0aW9uKCkgewogICAgaXQoJ3Nob3VsZCBleGVjdXRlIGZuIGFzeW5jaHJvbmlvdXNseSB2aWEgc2V0VGltZW91dCcsIGZ1bmN0aW9uKCkgewogICAgICB2YXIgY2FsbGJhY2sgPSBqYXNtaW5lLmNyZWF0ZVNweSgnZGVmZXJyZWQnKTsKCiAgICAgIGJyb3dzZXIuZGVmZXIoY2FsbGJhY2spOwogICAgICBleHBlY3QoY2FsbGJhY2spLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7CgogICAgICBmYWtlV2luZG93LnNldFRpbWVvdXQuZmx1c2goKTsKICAgICAgZXhwZWN0KGNhbGxiYWNrKS50b0hhdmVCZWVuQ2FsbGVkT25jZSgpOwogICAgfSk7CgoKICAgIGl0KCdzaG91bGQgdXBkYXRlIG91dHN0YW5kaW5nUmVxdWVzdHMgY291bnRlcicsIGZ1bmN0aW9uKCkgewogICAgICB2YXIgY2FsbGJhY2sgPSBqYXNtaW5lLmNyZWF0ZVNweSgnZGVmZXJyZWQnKTsKCiAgICAgIGJyb3dzZXIuZGVmZXIoY2FsbGJhY2spOwogICAgICBleHBlY3QoY2FsbGJhY2spLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7CgogICAgICBmYWtlV2luZG93LnNldFRpbWVvdXQuZmx1c2goKTsKICAgICAgZXhwZWN0KGNhbGxiYWNrKS50b0hhdmVCZWVuQ2FsbGVkT25jZSgpOwogICAgfSk7CgoKICAgIGl0KCdzaG91bGQgcmV0dXJuIHVuaXF1ZSBkZWZlcklkJywgZnVuY3Rpb24oKSB7CiAgICAgIHZhciBkZWZlcklkMSA9IGJyb3dzZXIuZGVmZXIobm9vcCksCiAgICAgICAgICBkZWZlcklkMiA9IGJyb3dzZXIuZGVmZXIobm9vcCk7CgogICAgICBleHBlY3QoZGVmZXJJZDEpLnRvQmVEZWZpbmVkKCk7CiAgICAgIGV4cGVjdChkZWZlcklkMikudG9CZURlZmluZWQoKTsKICAgICAgZXhwZWN0KGRlZmVySWQxKS5ub3QudG9FcXVhbChkZWZlcklkMik7CiAgICB9KTsKCgogICAgZGVzY3JpYmUoJ2NhbmNlbCcsIGZ1bmN0aW9uKCkgewogICAgICBpdCgnc2hvdWxkIGFsbG93IHRhc2tzIHRvIGJlIGNhbmNlbGVkIHdpdGggcmV0dXJuZWQgZGVmZXJJZCcsIGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBsb2cgPSBbXSwKICAgICAgICAgICAgZGVmZXJJZDEgPSBicm93c2VyLmRlZmVyKGZ1bmN0aW9uKCkgeyBsb2cucHVzaCgnY2FuY2VsIG1lJyk7IH0pLAogICAgICAgICAgICBkZWZlcklkMiA9IGJyb3dzZXIuZGVmZXIoZnVuY3Rpb24oKSB7IGxvZy5wdXNoKCdvaycpOyB9KSwKICAgICAgICAgICAgZGVmZXJJZDMgPSBicm93c2VyLmRlZmVyKGZ1bmN0aW9uKCkgeyBsb2cucHVzaCgnY2FuY2VsIG1lLCBub3chJyk7IH0pOwoKICAgICAgICBleHBlY3QobG9nKS50b0VxdWFsKFtdKTsKICAgICAgICBleHBlY3QoYnJvd3Nlci5kZWZlci5jYW5jZWwoZGVmZXJJZDEpKS50b0JlKHRydWUpOwogICAgICAgIGV4cGVjdChicm93c2VyLmRlZmVyLmNhbmNlbChkZWZlcklkMykpLnRvQmUodHJ1ZSk7CiAgICAgICAgZmFrZVdpbmRvdy5zZXRUaW1lb3V0LmZsdXNoKCk7CiAgICAgICAgZXhwZWN0KGxvZykudG9FcXVhbChbJ29rJ10pOwogICAgICAgIGV4cGVjdChicm93c2VyLmRlZmVyLmNhbmNlbChkZWZlcklkMikpLnRvQmUoZmFsc2UpOwogICAgICB9KTsKICAgIH0pOwogIH0pOwoKCiAgZGVzY3JpYmUoJ2Nvb2tpZXMnLCBmdW5jdGlvbigpIHsKCiAgICBmdW5jdGlvbiBkZWxldGVBbGxDb29raWVzKCkgewogICAgICB2YXIgY29va2llcyA9IGRvY3VtZW50LmNvb2tpZS5zcGxpdCgiOyIpOwogICAgICB2YXIgcGF0aCA9IGxvY2F0aW9uLnBhdGhuYW1lOwoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjb29raWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFyIGNvb2tpZSA9IGNvb2tpZXNbaV07CiAgICAgICAgdmFyIGVxUG9zID0gY29va2llLmluZGV4T2YoIj0iKTsKICAgICAgICB2YXIgbmFtZSA9IGVxUG9zID4gLTEgPyBjb29raWUuc3Vic3RyKDAsIGVxUG9zKSA6IGNvb2tpZTsKICAgICAgICB2YXIgcGFydHMgPSBwYXRoLnNwbGl0KCcvJyk7CiAgICAgICAgd2hpbGUgKHBhcnRzLmxlbmd0aCkgewogICAgICAgICAgZG9jdW1lbnQuY29va2llID0gbmFtZSArICI9O3BhdGg9IiArIChwYXJ0cy5qb2luKCcvJykgfHwgJy8nKSArICI7ZXhwaXJlcz1UaHUsIDAxIEphbiAxOTcwIDAwOjAwOjAwIEdNVCI7CiAgICAgICAgICBwYXJ0cy5wb3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBiZWZvcmVFYWNoKGZ1bmN0aW9uKCkgewogICAgICBkZWxldGVBbGxDb29raWVzKCk7CiAgICAgIGV4cGVjdChkb2N1bWVudC5jb29raWUpLnRvRXF1YWwoJycpOwogICAgfSk7CgoKICAgIGFmdGVyRWFjaChmdW5jdGlvbigpIHsKICAgICAgZGVsZXRlQWxsQ29va2llcygpOwogICAgICBleHBlY3QoZG9jdW1lbnQuY29va2llKS50b0VxdWFsKCcnKTsKICAgIH0pOwoKCiAgICBkZXNjcmliZSgncmVtb3ZlIGFsbCB2aWEgKG51bGwpJywgZnVuY3Rpb24oKSB7CgogICAgICBpdCgnc2hvdWxkIGRvIG5vdGhpbmcgd2hlbiBubyBjb29raWVzIGFyZSBzZXQnLCBmdW5jdGlvbigpIHsKICAgICAgICBicm93c2VyLmNvb2tpZXMobnVsbCk7CiAgICAgICAgZXhwZWN0KGRvY3VtZW50LmNvb2tpZSkudG9FcXVhbCgnJyk7CiAgICAgICAgZXhwZWN0KGJyb3dzZXIuY29va2llcygpKS50b0VxdWFsKHt9KTsKICAgICAgfSk7CgogICAgfSk7CgogICAgZGVzY3JpYmUoJ3JlbW92ZSB2aWEgY29va2llcyhjb29raWVOYW1lLCB1bmRlZmluZWQpJywgZnVuY3Rpb24oKSB7CgogICAgICBpdCgnc2hvdWxkIHJlbW92ZSBhIGNvb2tpZSB3aGVuIGl0IGlzIHByZXNlbnQnLCBmdW5jdGlvbigpIHsKICAgICAgICBkb2N1bWVudC5jb29raWUgPSAnZm9vPWJhcjtwYXRoPS8nOwoKICAgICAgICBicm93c2VyLmNvb2tpZXMoJ2ZvbycsIHVuZGVmaW5lZCk7CgogICAgICAgIGV4cGVjdChkb2N1bWVudC5jb29raWUpLnRvRXF1YWwoJycpOwogICAgICAgIGV4cGVjdChicm93c2VyLmNvb2tpZXMoKSkudG9FcXVhbCh7fSk7CiAgICAgIH0pOwoKCiAgICAgIGl0KCdzaG91bGQgZG8gbm90aGluZyB3aGVuIGFuIG5vbmV4aXN0aW5nIGNvb2tpZSBpcyBiZWluZyByZW1vdmVkJywgZnVuY3Rpb24oKSB7CiAgICAgICAgYnJvd3Nlci5jb29raWVzKCdkb2VzbnRleGlzdCcsIHVuZGVmaW5lZCk7CiAgICAgICAgZXhwZWN0KGRvY3VtZW50LmNvb2tpZSkudG9FcXVhbCgnJyk7CiAgICAgICAgZXhwZWN0KGJyb3dzZXIuY29va2llcygpKS50b0VxdWFsKHt9KTsKICAgICAgfSk7CiAgICB9KTsKCgogICAgZGVzY3JpYmUoJ3B1dCB2aWEgY29va2llcyhjb29raWVOYW1lLCBzdHJpbmcpJywgZnVuY3Rpb24oKSB7CgogICAgICBpdCgnc2hvdWxkIGNyZWF0ZSBhbmQgc3RvcmUgYSBjb29raWUnLCBmdW5jdGlvbigpIHsKICAgICAgICBicm93c2VyLmNvb2tpZXMoJ2Nvb2tpZU5hbWUnLCAnY29va2llPVZhbHVlJyk7CiAgICAgICAgZXhwZWN0KGRvY3VtZW50LmNvb2tpZSkudG9NYXRjaCgvY29va2llTmFtZT1jb29raWUlM0RWYWx1ZTs/ID8vKTsKICAgICAgICBleHBlY3QoYnJvd3Nlci5jb29raWVzKCkpLnRvRXF1YWwoeydjb29raWVOYW1lJzonY29va2llPVZhbHVlJ30pOwogICAgICB9KTsKCgogICAgICBpdCgnc2hvdWxkIG92ZXJ3cml0ZSBhbiBleGlzdGluZyB1bnN5bmNlZCBjb29raWUnLCBmdW5jdGlvbigpIHsKICAgICAgICBkb2N1bWVudC5jb29raWUgPSAiY29va2llPW5ldztwYXRoPS8iOwoKICAgICAgICB2YXIgb2xkVmFsID0gYnJvd3Nlci5jb29raWVzKCdjb29raWUnLCAnbmV3ZXInKTsKCiAgICAgICAgZXhwZWN0KGRvY3VtZW50LmNvb2tpZSkudG9FcXVhbCgnY29va2llPW5ld2VyJyk7CiAgICAgICAgZXhwZWN0KGJyb3dzZXIuY29va2llcygpKS50b0VxdWFsKHsnY29va2llJzonbmV3ZXInfSk7CiAgICAgICAgZXhwZWN0KG9sZFZhbCkubm90LnRvQmVEZWZpbmVkKCk7CiAgICAgIH0pOwoKICAgICAgaXQoJ3Nob3VsZCBlbmNvZGUgYm90aCBuYW1lIGFuZCB2YWx1ZScsIGZ1bmN0aW9uKCkgewogICAgICAgIGJyb3dzZXIuY29va2llcygnY29va2llMT0nLCAndmFsO3VlJyk7CiAgICAgICAgYnJvd3Nlci5jb29raWVzKCdjb29raWUyPWJhcjtiYXonLCAndmFsPXVlJyk7CgogICAgICAgIHZhciByYXdDb29raWVzID0gZG9jdW1lbnQuY29va2llLnNwbGl0KCI7ICIpOyAvL29yZGVyIGlzIG5vdCBndWFyYW50ZWVkLCBzbyB3ZSBuZWVkIHRvIHBhcnNlCiAgICAgICAgZXhwZWN0KHJhd0Nvb2tpZXMubGVuZ3RoKS50b0VxdWFsKDIpOwogICAgICAgIGV4cGVjdChyYXdDb29raWVzKS50b0NvbnRhaW4oJ2Nvb2tpZTElM0Q9dmFsJTNCdWUnKTsKICAgICAgICBleHBlY3QocmF3Q29va2llcykudG9Db250YWluKCdjb29raWUyJTNEYmFyJTNCYmF6PXZhbCUzRHVlJyk7CiAgICAgIH0pOwoKICAgICAgaXQoJ3Nob3VsZCBsb2cgd2FybmluZ3Mgd2hlbiA0a2IgcGVyIGNvb2tpZSBzdG9yYWdlIGxpbWl0IGlzIHJlYWNoZWQnLCBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgaSwgbG9uZ1ZhbCA9ICcnLCBjb29raWVTdHI7CgogICAgICAgIGZvcihpPTA7IGk8NDA4MzsgaSsrKSB7CiAgICAgICAgICBsb25nVmFsICs9ICd4JzsKICAgICAgICB9CgogICAgICAgIGNvb2tpZVN0ciA9IGRvY3VtZW50LmNvb2tpZTsKICAgICAgICBicm93c2VyLmNvb2tpZXMoJ3gnLCBsb25nVmFsKTsgLy90b3RhbCBzaXplIDQwOTMtNDA5Niwgc28gaXQgc2hvdWxkIGdvIHRocm91Z2gKICAgICAgICBleHBlY3QoZG9jdW1lbnQuY29va2llKS5ub3QudG9FcXVhbChjb29raWVTdHIpOwogICAgICAgIGV4cGVjdChicm93c2VyLmNvb2tpZXMoKVsneCddKS50b0VxdWFsKGxvbmdWYWwpOwogICAgICAgIGV4cGVjdChsb2dzLndhcm4pLnRvRXF1YWwoW10pOwoKICAgICAgICBicm93c2VyLmNvb2tpZXMoJ3gnLCBsb25nVmFsICsgJ3h4eHgnKTsgLy90b3RhbCBzaXplIDQwOTctNDA5OSwgYSB3YXJuaW5nIHNob3VsZCBiZSBsb2dnZWQKICAgICAgICBleHBlY3QobG9ncy53YXJuKS50b0VxdWFsKAogICAgICAgICAgW1sgIkNvb2tpZSAneCcgcG9zc2libHkgbm90IHNldCBvciBvdmVyZmxvd2VkIGJlY2F1c2UgaXQgd2FzIHRvbyBsYXJnZSAoNDA5NyA+IDQwOTYgIiArCiAgICAgICAgICAgICAiYnl0ZXMpISIgXV0pOwoKICAgICAgICAvL2ZvcmNlIGJyb3dzZXIgdG8gZHJvcHBlZCBhIGNvb2tpZSBhbmQgbWFrZSBzdXJlIHRoYXQgdGhlIGNhY2hlIGlzIG5vdCBvdXQgb2Ygc3luYwogICAgICAgIGJyb3dzZXIuY29va2llcygneCcsICdzaG9ydFZhbCcpOwogICAgICAgIGV4cGVjdChicm93c2VyLmNvb2tpZXMoKS54KS50b0VxdWFsKCdzaG9ydFZhbCcpOyAvL25lZWRlZCB0byBwcmltZSB0aGUgY2FjaGUKICAgICAgICBjb29raWVTdHIgPSBkb2N1bWVudC5jb29raWU7CiAgICAgICAgYnJvd3Nlci5jb29raWVzKCd4JywgbG9uZ1ZhbCArIGxvbmdWYWwgKyBsb25nVmFsKTsgLy9zaG91bGQgYmUgdG9vIGxvbmcgZm9yIGFsbCBicm93c2VycwoKICAgICAgICBpZiAoZG9jdW1lbnQuY29va2llICE9PSBjb29raWVTdHIpIHsKICAgICAgICAgIHRoaXMuZmFpbChuZXcgRXJyb3IoImJyb3dzZXIgZGlkbid0IGRyb3AgbG9uZyBjb29raWUgd2hlbiBpdCB3YXMgZXhwZWN0ZWQuIG1ha2UgdGhlICIgKwogICAgICAgICAgICAgICJjb29raWUgaW4gdGhpcyB0ZXN0IGxvbmdlciIpKTsKICAgICAgICB9CgogICAgICAgIGV4cGVjdChicm93c2VyLmNvb2tpZXMoKS54KS50b0VxdWFsKCdzaG9ydFZhbCcpOwogICAgICB9KTsKICAgIH0pOwoKICAgIGRlc2NyaWJlKCdwdXQgdmlhIGNvb2tpZXMoY29va2llTmFtZSwgc3RyaW5nKSwgaWYgbm8gPGJhc2UgaHJlZj4gJywgZnVuY3Rpb24gKCkgewogICAgICBiZWZvcmVFYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgICBmYWtlRG9jdW1lbnQuYmFzZVBhdGggPSB1bmRlZmluZWQ7CiAgICAgIH0pOwoKICAgICAgaXQoJ3Nob3VsZCBkZWZhdWx0IHBhdGggaW4gY29va2llIHRvICIiIChlbXB0eSBzdHJpbmcpJywgZnVuY3Rpb24gKCkgewogICAgICAgIGJyb3dzZXIuY29va2llcygnY29va2llJywgJ2JlbmRlcicpOwogICAgICAgIC8vIFRoaXMgb25seSBmYWlscyBpbiBTYWZhcmkgYW5kIElFIHdoZW4gY29va2llUGF0aCByZXR1cm5zIHVuZGVmaW5lZAogICAgICAgIC8vIFdoZXJlIGl0IG5vdyBzdWNjZWVkcyBzaW5jZSBiYXNlSHJlZiByZXR1cm4gJycgaW5zdGVhZCBvZiB1bmRlZmluZWQKICAgICAgICBleHBlY3QoZG9jdW1lbnQuY29va2llKS50b0VxdWFsKCdjb29raWU9YmVuZGVyJyk7CiAgICAgIH0pOwogICAgfSk7CgogICAgZGVzY3JpYmUoJ2dldCB2aWEgY29va2llcygpW2Nvb2tpZU5hbWVdJywgZnVuY3Rpb24oKSB7CgogICAgICBpdCgnc2hvdWxkIHJldHVybiB1bmRlZmluZWQgZm9yIG5vbmV4aXN0ZW50IGNvb2tpZScsIGZ1bmN0aW9uKCkgewogICAgICAgIGV4cGVjdChicm93c2VyLmNvb2tpZXMoKS5ub25leGlzdGVudCkubm90LnRvQmVEZWZpbmVkKCk7CiAgICAgIH0pOwoKCiAgICAgIGl0ICgnc2hvdWxkIHJldHVybiBhIHZhbHVlIGZvciBhbiBleGlzdGluZyBjb29raWUnLCBmdW5jdGlvbigpIHsKICAgICAgICBkb2N1bWVudC5jb29raWUgPSAiZm9vPWJhcj1iYXo7cGF0aD0vIjsKICAgICAgICBleHBlY3QoYnJvd3Nlci5jb29raWVzKCkuZm9vKS50b0VxdWFsKCdiYXI9YmF6Jyk7CiAgICAgIH0pOwoKICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gdGhlIHRoZSBmaXJzdCB2YWx1ZSBwcm92aWRlZCBmb3IgYSBjb29raWUnLCBmdW5jdGlvbigpIHsKICAgICAgICAvLyBGb3IgYSBjb29raWUgdGhhdCBoYXMgZGlmZmVyZW50IHZhbHVlcyB0aGF0IGRpZmZlciBieSBwYXRoLCB0aGUKICAgICAgICAvLyB2YWx1ZSBmb3IgdGhlIG1vc3Qgc3BlY2lmaWMgcGF0aCBhcHBlYXJzIGZpcnN0LiAgYnJvd3Nlci5jb29raWVzKCkKICAgICAgICAvLyBzaG91bGQgcHJvdmlkZSB0aGF0IHZhbHVlIGZvciB0aGUgY29va2llLgogICAgICAgIGRvY3VtZW50LmNvb2tpZSA9ICdmb289ImZpcnN0IjsgZm9vPSJzZWNvbmQiJzsKICAgICAgICBleHBlY3QoYnJvd3Nlci5jb29raWVzKClbJ2ZvbyddKS50b0JlKCciZmlyc3QiJyk7CiAgICAgIH0pOwoKICAgICAgaXQgKCdzaG91bGQgZGVjb2RlIGNvb2tpZSB2YWx1ZXMgdGhhdCB3ZXJlIGVuY29kZWQgYnkgcHV0cycsIGZ1bmN0aW9uKCkgewogICAgICAgIGRvY3VtZW50LmNvb2tpZSA9ICJjb29raWUyJTNEYmFyJTNCYmF6PXZhbCUzRHVlO3BhdGg9LyI7CiAgICAgICAgZXhwZWN0KGJyb3dzZXIuY29va2llcygpWydjb29raWUyPWJhcjtiYXonXSkudG9FcXVhbCgndmFsPXVlJyk7CiAgICAgIH0pOwoKCiAgICAgIGl0KCdzaG91bGQgcHJlc2VydmUgbGVhZGluZyAmIHRyYWlsaW5nIHNwYWNlcyBpbiBuYW1lcyBhbmQgdmFsdWVzJywgZnVuY3Rpb24oKSB7CiAgICAgICAgYnJvd3Nlci5jb29raWVzKCcgY29va2llIG5hbWUgJywgJyBjb29raWUgdmFsdWUgJyk7CiAgICAgICAgZXhwZWN0KGJyb3dzZXIuY29va2llcygpWycgY29va2llIG5hbWUgJ10pLnRvRXF1YWwoJyBjb29raWUgdmFsdWUgJyk7CiAgICAgICAgZXhwZWN0KGJyb3dzZXIuY29va2llcygpWydjb29raWUgbmFtZSddKS5ub3QudG9CZURlZmluZWQoKTsKICAgICAgfSk7CgogICAgICBpdCgnc2hvdWxkIGRlY29kZSBzcGVjaWFsIGNoYXJhY3RlcnMgaW4gY29va2llIHZhbHVlcycsIGZ1bmN0aW9uKCkgewogICAgICAgIGRvY3VtZW50LmNvb2tpZSA9ICdjb29raWVfbmFtZT1jb29raWVfdmFsdWVfJUUyJTgyJUFDJzsKICAgICAgICBleHBlY3QoYnJvd3Nlci5jb29raWVzKClbJ2Nvb2tpZV9uYW1lJ10pLnRvRXF1YWwoJ2Nvb2tpZV92YWx1ZV/igqwnKTsKICAgICAgfSk7CgogICAgICBpdCgnc2hvdWxkIG5vdCBkZWNvZGUgY29va2llIHZhbHVlcyB0aGF0IGRvIG5vdCBhcHBlYXIgdG8gYmUgZW5jb2RlZCcsIGZ1bmN0aW9uKCkgewogICAgICAgIC8vIHNlZSAjOTIxMSAtIHNvbWV0aW1lcyBjb29raWVzIGNvbnRhaW4gYSB2YWx1ZSB0aGF0IGNhdXNlcyBkZWNvZGVVUklDb21wb25lbnQgdG8gdGhyb3cKICAgICAgICBkb2N1bWVudC5jb29raWUgPSAnY29va2llX25hbWU9Y29va2llX3ZhbHVlXyVYWCc7CiAgICAgICAgZXhwZWN0KGJyb3dzZXIuY29va2llcygpWydjb29raWVfbmFtZSddKS50b0VxdWFsKCdjb29raWVfdmFsdWVfJVhYJyk7CiAgICAgIH0pOwogICAgfSk7CgoKICAgIGRlc2NyaWJlKCdnZXRBbGwgdmlhIGNvb2tpZXMoKScsIGZ1bmN0aW9uKCkgewoKICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gY29va2llcyBhcyBoYXNoJywgZnVuY3Rpb24oKSB7CiAgICAgICAgZG9jdW1lbnQuY29va2llID0gImZvbzE9YmFyMTtwYXRoPS8iOwogICAgICAgIGRvY3VtZW50LmNvb2tpZSA9ICJmb28yPWJhcjI7cGF0aD0vIjsKICAgICAgICBleHBlY3QoYnJvd3Nlci5jb29raWVzKCkpLnRvRXF1YWwoeydmb28xJzonYmFyMScsICdmb28yJzonYmFyMid9KTsKICAgICAgfSk7CgoKICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gZW1wdHkgaGFzaCBpZiBubyBjb29raWVzIGV4aXN0JywgZnVuY3Rpb24oKSB7CiAgICAgICAgZXhwZWN0KGJyb3dzZXIuY29va2llcygpKS50b0VxdWFsKHt9KTsKICAgICAgfSk7CiAgICB9KTsKCgogICAgaXQoJ3Nob3VsZCBwaWNrIHVwIGV4dGVybmFsIGNoYW5nZXMgbWFkZSB0byBicm93c2VyIGNvb2tpZXMnLCBmdW5jdGlvbigpIHsKICAgICAgYnJvd3Nlci5jb29raWVzKCdvYXRtZWFsQ29va2llJywgJ2Ryb29sJyk7CiAgICAgIGV4cGVjdChicm93c2VyLmNvb2tpZXMoKSkudG9FcXVhbCh7J29hdG1lYWxDb29raWUnOidkcm9vbCd9KTsKCiAgICAgIGRvY3VtZW50LmNvb2tpZSA9ICdvYXRtZWFsQ29va2llPWNoYW5nZWQ7cGF0aD0vJzsKICAgICAgZXhwZWN0KGJyb3dzZXIuY29va2llcygpLm9hdG1lYWxDb29raWUpLnRvRXF1YWwoJ2NoYW5nZWQnKTsKICAgIH0pOwoKCiAgICBpdCgnc2hvdWxkIGluaXRpYWxpemUgY29va2llIGNhY2hlIHdpdGggZXhpc3RpbmcgY29va2llcycsIGZ1bmN0aW9uKCkgewogICAgICBkb2N1bWVudC5jb29raWUgPSAiZXhpc3RpbmdDb29raWU9ZXhpc3RpbmdWYWx1ZTtwYXRoPS8iOwogICAgICBleHBlY3QoYnJvd3Nlci5jb29raWVzKCkpLnRvRXF1YWwoeydleGlzdGluZ0Nvb2tpZSc6J2V4aXN0aW5nVmFsdWUnfSk7CiAgICB9KTsKCiAgfSk7CgogIGRlc2NyaWJlKCdwb2xsZXInLCBmdW5jdGlvbigpIHsKCiAgICBpdCgnc2hvdWxkIGNhbGwgZnVuY3Rpb25zIGluIHBvbGxGbnMgaW4gcmVndWxhciBpbnRlcnZhbHMnLCBmdW5jdGlvbigpIHsKICAgICAgdmFyIGxvZyA9ICcnOwogICAgICBicm93c2VyLmFkZFBvbGxGbihmdW5jdGlvbigpIHtsb2crPSdhJzt9KTsKICAgICAgYnJvd3Nlci5hZGRQb2xsRm4oZnVuY3Rpb24oKSB7bG9nKz0nYic7fSk7CiAgICAgIGV4cGVjdChsb2cpLnRvRXF1YWwoJycpOwogICAgICBmYWtlV2luZG93LnNldFRpbWVvdXQuZmx1c2goKTsKICAgICAgZXhwZWN0KGxvZykudG9FcXVhbCgnYWInKTsKICAgICAgZmFrZVdpbmRvdy5zZXRUaW1lb3V0LmZsdXNoKCk7CiAgICAgIGV4cGVjdChsb2cpLnRvRXF1YWwoJ2FiYWInKTsKICAgIH0pOwoKICAgIGl0KCdzaG91bGQgc3RhcnRQb2xsZXInLCBmdW5jdGlvbigpIHsKICAgICAgZXhwZWN0KGZha2VXaW5kb3cudGltZW91dHMubGVuZ3RoKS50b0VxdWFsKDApOwoKICAgICAgYnJvd3Nlci5hZGRQb2xsRm4oZnVuY3Rpb24oKSB7fSk7CiAgICAgIGV4cGVjdChmYWtlV2luZG93LnRpbWVvdXRzLmxlbmd0aCkudG9FcXVhbCgxKTsKCiAgICAgIC8vc2hvdWxkIHJlbWFpbiAxIGFzIGl0IGlzIHRoZSBjaGVjayBmbgogICAgICBicm93c2VyLmFkZFBvbGxGbihmdW5jdGlvbigpIHt9KTsKICAgICAgZXhwZWN0KGZha2VXaW5kb3cudGltZW91dHMubGVuZ3RoKS50b0VxdWFsKDEpOwogICAgfSk7CgogICAgaXQoJ3Nob3VsZCByZXR1cm4gZm4gdGhhdCB3YXMgcGFzc2VkIGludG8gYWRkUG9sbEZuJywgZnVuY3Rpb24oKSB7CiAgICAgIHZhciBmbiA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gMTsgfTsKICAgICAgdmFyIHJldHVybmVkRm4gPSBicm93c2VyLmFkZFBvbGxGbihmbik7CiAgICAgIGV4cGVjdChyZXR1cm5lZEZuKS50b0JlKGZuKTsKICAgIH0pOwogIH0pOwoKICBkZXNjcmliZSgndXJsJywgZnVuY3Rpb24oKSB7CiAgICB2YXIgcHVzaFN0YXRlLCByZXBsYWNlU3RhdGUsIGxvY2F0aW9uUmVwbGFjZTsKCiAgICBiZWZvcmVFYWNoKGZ1bmN0aW9uKCkgewogICAgICBwdXNoU3RhdGUgPSBzcHlPbihmYWtlV2luZG93Lmhpc3RvcnksICdwdXNoU3RhdGUnKTsKICAgICAgcmVwbGFjZVN0YXRlID0gc3B5T24oZmFrZVdpbmRvdy5oaXN0b3J5LCAncmVwbGFjZVN0YXRlJyk7CiAgICAgIGxvY2F0aW9uUmVwbGFjZSA9IHNweU9uKGZha2VXaW5kb3cubG9jYXRpb24sICdyZXBsYWNlJyk7CiAgICB9KTsKCiAgICBpdCgnc2hvdWxkIHJldHVybiBjdXJyZW50IGxvY2F0aW9uLmhyZWYnLCBmdW5jdGlvbigpIHsKICAgICAgZmFrZVdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJ2h0dHA6Ly90ZXN0LmNvbSc7CiAgICAgIGV4cGVjdChicm93c2VyLnVybCgpKS50b0VxdWFsKCdodHRwOi8vdGVzdC5jb20nKTsKCiAgICAgIGZha2VXaW5kb3cubG9jYXRpb24uaHJlZiA9ICdodHRwczovL2Fub3RoZXIuY29tJzsKICAgICAgZXhwZWN0KGJyb3dzZXIudXJsKCkpLnRvRXF1YWwoJ2h0dHBzOi8vYW5vdGhlci5jb20nKTsKICAgIH0pOwoKICAgIGl0KCdzaG91bGQgdXNlIGhpc3RvcnkucHVzaFN0YXRlIHdoZW4gYXZhaWxhYmxlJywgZnVuY3Rpb24oKSB7CiAgICAgIHNuaWZmZXIuaGlzdG9yeSA9IHRydWU7CiAgICAgIGJyb3dzZXIudXJsKCdodHRwOi8vbmV3Lm9yZycpOwoKICAgICAgZXhwZWN0KHB1c2hTdGF0ZSkudG9IYXZlQmVlbkNhbGxlZE9uY2UoKTsKICAgICAgZXhwZWN0KHB1c2hTdGF0ZS5hcmdzRm9yQ2FsbFswXVsyXSkudG9FcXVhbCgnaHR0cDovL25ldy5vcmcnKTsKCiAgICAgIGV4cGVjdChyZXBsYWNlU3RhdGUpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7CiAgICAgIGV4cGVjdChsb2NhdGlvblJlcGxhY2UpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7CiAgICAgIGV4cGVjdChmYWtlV2luZG93LmxvY2F0aW9uLmhyZWYpLnRvRXF1YWwoJ2h0dHA6Ly9zZXJ2ZXIvJyk7CiAgICB9KTsKCiAgICBpdCgnc2hvdWxkIHVzZSBoaXN0b3J5LnJlcGxhY2VTdGF0ZSB3aGVuIGF2YWlsYWJsZScsIGZ1bmN0aW9uKCkgewogICAgICBzbmlmZmVyLmhpc3RvcnkgPSB0cnVlOwogICAgICBicm93c2VyLnVybCgnaHR0cDovL25ldy5vcmcnLCB0cnVlKTsKCiAgICAgIGV4cGVjdChyZXBsYWNlU3RhdGUpLnRvSGF2ZUJlZW5DYWxsZWRPbmNlKCk7CiAgICAgIGV4cGVjdChyZXBsYWNlU3RhdGUuYXJnc0ZvckNhbGxbMF1bMl0pLnRvRXF1YWwoJ2h0dHA6Ly9uZXcub3JnJyk7CgogICAgICBleHBlY3QocHVzaFN0YXRlKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpOwogICAgICBleHBlY3QobG9jYXRpb25SZXBsYWNlKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpOwogICAgICBleHBlY3QoZmFrZVdpbmRvdy5sb2NhdGlvbi5ocmVmKS50b0VxdWFsKCdodHRwOi8vc2VydmVyLycpOwogICAgfSk7CgogICAgaXQoJ3Nob3VsZCBzZXQgbG9jYXRpb24uaHJlZiB3aGVuIHB1c2hTdGF0ZSBub3QgYXZhaWxhYmxlJywgZnVuY3Rpb24oKSB7CiAgICAgIHNuaWZmZXIuaGlzdG9yeSA9IGZhbHNlOwogICAgICBicm93c2VyLnVybCgnaHR0cDovL25ldy5vcmcnKTsKCiAgICAgIGV4cGVjdChmYWtlV2luZG93LmxvY2F0aW9uLmhyZWYpLnRvRXF1YWwoJ2h0dHA6Ly9uZXcub3JnJyk7CgogICAgICBleHBlY3QocHVzaFN0YXRlKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpOwogICAgICBleHBlY3QocmVwbGFjZVN0YXRlKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpOwogICAgICBleHBlY3QobG9jYXRpb25SZXBsYWNlKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpOwogICAgfSk7CgogICAgaXQoJ3Nob3VsZCBzZXQgbG9jYXRpb24uaHJlZiBhbmQgbm90IHVzZSBwdXNoU3RhdGUgd2hlbiB0aGUgdXJsIG9ubHkgY2hhbmdlZCBpbiB0aGUgaGFzaCBmcmFnbWVudCB0byBwbGVhc2UgSUUxMC8xMScsIGZ1bmN0aW9uKCkgewogICAgICBzbmlmZmVyLmhpc3RvcnkgPSB0cnVlOwogICAgICBicm93c2VyLnVybCgnaHR0cDovL3NlcnZlci8jMTIzJyk7CgogICAgICBleHBlY3QoZmFrZVdpbmRvdy5sb2NhdGlvbi5ocmVmKS50b0VxdWFsKCdodHRwOi8vc2VydmVyLyMxMjMnKTsKCiAgICAgIGV4cGVjdChwdXNoU3RhdGUpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7CiAgICAgIGV4cGVjdChyZXBsYWNlU3RhdGUpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7CiAgICAgIGV4cGVjdChsb2NhdGlvblJlcGxhY2UpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7CiAgICB9KTsKCiAgICBpdCgnc2hvdWxkIHVzZSBsb2NhdGlvbi5yZXBsYWNlIHdoZW4gaGlzdG9yeS5yZXBsYWNlU3RhdGUgbm90IGF2YWlsYWJsZScsIGZ1bmN0aW9uKCkgewogICAgICBzbmlmZmVyLmhpc3RvcnkgPSBmYWxzZTsKICAgICAgYnJvd3Nlci51cmwoJ2h0dHA6Ly9uZXcub3JnJywgdHJ1ZSk7CgogICAgICBleHBlY3QobG9jYXRpb25SZXBsYWNlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnaHR0cDovL25ldy5vcmcnKTsKCiAgICAgIGV4cGVjdChwdXNoU3RhdGUpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7CiAgICAgIGV4cGVjdChyZXBsYWNlU3RhdGUpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7CiAgICAgIGV4cGVjdChmYWtlV2luZG93LmxvY2F0aW9uLmhyZWYpLnRvRXF1YWwoJ2h0dHA6Ly9zZXJ2ZXIvJyk7CiAgICB9KTsKCiAgICBpdCgnc2hvdWxkIHVzZSBsb2NhdGlvbi5yZXBsYWNlIGFuZCBub3QgdXNlIHJlcGxhY2VTdGF0ZSB3aGVuIHRoZSB1cmwgb25seSBjaGFuZ2VkIGluIHRoZSBoYXNoIGZyYWdtZW50IHRvIHBsZWFzZSBJRTEwLzExJywgZnVuY3Rpb24oKSB7CiAgICAgIHNuaWZmZXIuaGlzdG9yeSA9IHRydWU7CiAgICAgIGJyb3dzZXIudXJsKCdodHRwOi8vc2VydmVyLyMxMjMnLCB0cnVlKTsKCiAgICAgIGV4cGVjdChsb2NhdGlvblJlcGxhY2UpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdodHRwOi8vc2VydmVyLyMxMjMnKTsKCiAgICAgIGV4cGVjdChwdXNoU3RhdGUpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7CiAgICAgIGV4cGVjdChyZXBsYWNlU3RhdGUpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7CiAgICAgIGV4cGVjdChmYWtlV2luZG93LmxvY2F0aW9uLmhyZWYpLnRvRXF1YWwoJ2h0dHA6Ly9zZXJ2ZXIvJyk7CiAgICB9KTsKCiAgICBpdCgnc2hvdWxkIHJldHVybiAkYnJvd3NlciB0byBhbGxvdyBjaGFpbmluZycsIGZ1bmN0aW9uKCkgewogICAgICBleHBlY3QoYnJvd3Nlci51cmwoJ2h0dHA6Ly9hbnkuY29tJykpLnRvQmUoYnJvd3Nlcik7CiAgICB9KTsKCgogICAgaXQoJ3Nob3VsZCBkZWNvZGUgc2luZ2xlIHF1b3RlcyB0byB3b3JrIGFyb3VuZCBGRiBidWcgNDA3MjczJywgZnVuY3Rpb24oKSB7CiAgICAgIGZha2VXaW5kb3cubG9jYXRpb24uaHJlZiA9ICJodHRwOi8vZmYtYnVnLz9zaW5nbGUlMjdxdW90ZSI7CiAgICAgIGV4cGVjdChicm93c2VyLnVybCgpKS50b0JlKCJodHRwOi8vZmYtYnVnLz9zaW5nbGUncXVvdGUiKTsKICAgIH0pOwoKICAgIGl0KCdzaG91bGQgbm90IHNldCBVUkwgd2hlbiB0aGUgVVJMIGlzIGFscmVhZHkgc2V0JywgZnVuY3Rpb24oKSB7CiAgICAgIHZhciBjdXJyZW50ID0gZmFrZVdpbmRvdy5sb2NhdGlvbi5ocmVmOwogICAgICBzbmlmZmVyLmhpc3RvcnkgPSBmYWxzZTsKICAgICAgZmFrZVdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJ2RvbnRjaGFuZ2UnOwogICAgICBicm93c2VyLnVybChjdXJyZW50KTsKICAgICAgZXhwZWN0KGZha2VXaW5kb3cubG9jYXRpb24uaHJlZikudG9CZSgnZG9udGNoYW5nZScpOwogICAgfSk7CgogICAgaXQoJ3Nob3VsZCBub3QgcmVhZCBvdXQgbG9jYXRpb24uaHJlZiBpZiBhIHJlbG9hZCB3YXMgdHJpZ2dlcmVkIGJ1dCBzdGlsbCBhbGxvdyB0byBjaGFuZ2UgdGhlIHVybCcsIGZ1bmN0aW9uKCkgewogICAgICBzbmlmZmVyLmhpc3RvcnkgPSBmYWxzZTsKICAgICAgYnJvd3Nlci51cmwoJ2h0dHA6Ly9zZXJ2ZXIvc29tZU90aGVyVXJsVGhhdENhdXNlc1JlbG9hZCcpOwogICAgICBleHBlY3QoZmFrZVdpbmRvdy5sb2NhdGlvbi5ocmVmKS50b0JlKCdodHRwOi8vc2VydmVyL3NvbWVPdGhlclVybFRoYXRDYXVzZXNSZWxvYWQnKTsKCiAgICAgIGZha2VXaW5kb3cubG9jYXRpb24uaHJlZiA9ICdodHRwOi8vc29tZU5ld1VybCc7CiAgICAgIGV4cGVjdChicm93c2VyLnVybCgpKS50b0JlKCdodHRwOi8vc2VydmVyL3NvbWVPdGhlclVybFRoYXRDYXVzZXNSZWxvYWQnKTsKCiAgICAgIGJyb3dzZXIudXJsKCdodHRwOi8vc2VydmVyL3NvbWVPdGhlclVybCcpOwogICAgICBleHBlY3QoYnJvd3Nlci51cmwoKSkudG9CZSgnaHR0cDovL3NlcnZlci9zb21lT3RoZXJVcmwnKTsKICAgICAgZXhwZWN0KGZha2VXaW5kb3cubG9jYXRpb24uaHJlZikudG9CZSgnaHR0cDovL3NlcnZlci9zb21lT3RoZXJVcmwnKTsKICAgIH0pOwoKICAgIGl0KCdhc3N1bWVzIHRoYXQgY2hhbmdlcyB0byBsb2NhdGlvbi5oYXNoIG9jY3VyIGluIHN5bmMnLCBmdW5jdGlvbigpIHsKICAgICAgLy8gVGhpcyBpcyBhbiBhc3luY2hyb25vdXMgaW50ZWdyYXRpb24gdGVzdCB0aGF0IGNoYW5nZXMgdGhlCiAgICAgIC8vIGhhc2ggaW4gYWxsIHBvc3NpYmxlIHdheXMgYW5kIGNoZWNrcwogICAgICAvLyAtIHdoZXRoZXIgdGhlIGNoYW5nZSB0byB0aGUgaGFzaCBjYW4gYmUgcmVhZCBvdXQgaW4gc3luYwogICAgICAvLyAtIHdoZXRoZXIgdGhlIGNoYW5nZSB0byB0aGUgaGFzaCBjYW4gYmUgcmVhZCBvdXQgaW4gdGhlIGhhc2hjaGFuZ2UgZXZlbnQKICAgICAgdmFyIHJlYWxXaW4gPSB3aW5kb3csCiAgICAgICAgICAkcmVhbFdpbiA9IGpxTGl0ZShyZWFsV2luKSwKICAgICAgICAgIGhhc2hJbkhhc2hDaGFuZ2VFdmVudCA9IFtdOwoKICAgICAgcnVucyhmdW5jdGlvbigpIHsKICAgICAgICAkcmVhbFdpbi5vbignaGFzaGNoYW5nZScsIGhhc2hMaXN0ZW5lcik7CgogICAgICAgIHJlYWxXaW4ubG9jYXRpb24uaGFzaCA9ICcxJzsKICAgICAgICByZWFsV2luLmxvY2F0aW9uLmhyZWYgKz0gJzInOwogICAgICAgIHJlYWxXaW4ubG9jYXRpb24ucmVwbGFjZShyZWFsV2luLmxvY2F0aW9uLmhyZWYgKyAnMycpOwogICAgICAgIHJlYWxXaW4ubG9jYXRpb24uYXNzaWduKHJlYWxXaW4ubG9jYXRpb24uaHJlZiArICc0Jyk7CgogICAgICAgIGV4cGVjdChyZWFsV2luLmxvY2F0aW9uLmhhc2gpLnRvQmUoJyMxMjM0Jyk7CiAgICAgIH0pOwogICAgICB3YWl0c0ZvcihmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gaGFzaEluSGFzaENoYW5nZUV2ZW50Lmxlbmd0aCA+IDM7CiAgICAgIH0pOwogICAgICBydW5zKGZ1bmN0aW9uKCkgewogICAgICAgICRyZWFsV2luLm9mZignaGFzaGNoYW5nZScsIGhhc2hMaXN0ZW5lcik7CgogICAgICAgIGZvckVhY2goaGFzaEluSGFzaENoYW5nZUV2ZW50LCBmdW5jdGlvbihoYXNoKSB7CiAgICAgICAgICBleHBlY3QoaGFzaCkudG9CZSgnIzEyMzQnKTsKICAgICAgICB9KTsKICAgICAgfSk7CgogICAgICBmdW5jdGlvbiBoYXNoTGlzdGVuZXIoKSB7CiAgICAgICAgaGFzaEluSGFzaENoYW5nZUV2ZW50LnB1c2gocmVhbFdpbi5sb2NhdGlvbi5oYXNoKTsKICAgICAgfQogICAgfSk7CgogIH0pOwoKICBkZXNjcmliZSgndXJsICh3aGVuIHN0YXRlIHBhc3NlZCknLCBmdW5jdGlvbigpIHsKICAgIHZhciBjdXJyZW50SHJlZjsKCiAgICBiZWZvcmVFYWNoKGZ1bmN0aW9uKCkgewogICAgICBzbmlmZmVyID0ge2hpc3Rvcnk6IHRydWV9OwogICAgICBjdXJyZW50SHJlZiA9IGZha2VXaW5kb3cubG9jYXRpb24uaHJlZjsKICAgIH0pOwoKICAgIGl0KCdzaG91bGQgY2hhbmdlIHN0YXRlJywgZnVuY3Rpb24oKSB7CiAgICAgIGJyb3dzZXIudXJsKGN1cnJlbnRIcmVmICsgJy9zb21ldGhpbmcnLCBmYWxzZSwge3Byb3A6ICd2YWwxJ30pOwogICAgICBleHBlY3QoZmFrZVdpbmRvdy5oaXN0b3J5LnN0YXRlKS50b0VxdWFsKHtwcm9wOiAndmFsMSd9KTsKICAgIH0pOwoKICAgIGl0KCdzaG91bGQgYWxsb3cgdG8gc2V0IGZhbHN5IHN0YXRlcyAoZXhjZXB0IGB1bmRlZmluZWRgKScsIGZ1bmN0aW9uKCkgewogICAgICBmYWtlV2luZG93Lmhpc3Rvcnkuc3RhdGUgPSB7cHJvcDogJ3ZhbDEnfTsKCiAgICAgIGJyb3dzZXIudXJsKGN1cnJlbnRIcmVmLCBmYWxzZSwgbnVsbCk7CiAgICAgIGV4cGVjdChmYWtlV2luZG93Lmhpc3Rvcnkuc3RhdGUpLnRvQmUobnVsbCk7CgogICAgICBicm93c2VyLnVybChjdXJyZW50SHJlZiwgZmFsc2UsIGZhbHNlKTsKICAgICAgZXhwZWN0KGZha2VXaW5kb3cuaGlzdG9yeS5zdGF0ZSkudG9CZShmYWxzZSk7CgogICAgICBicm93c2VyLnVybChjdXJyZW50SHJlZiwgZmFsc2UsICcnKTsKICAgICAgZXhwZWN0KGZha2VXaW5kb3cuaGlzdG9yeS5zdGF0ZSkudG9CZSgnJyk7CgogICAgICBicm93c2VyLnVybChjdXJyZW50SHJlZiwgZmFsc2UsIDApOwogICAgICBleHBlY3QoZmFrZVdpbmRvdy5oaXN0b3J5LnN0YXRlKS50b0JlKDApOwogICAgfSk7CgogICAgaXQoJ3Nob3VsZCB0cmVhdCBgdW5kZWZpbmVkYCBzdGF0ZSBhcyBgbnVsbGAnLCBmdW5jdGlvbigpIHsKICAgICAgZmFrZVdpbmRvdy5oaXN0b3J5LnN0YXRlID0ge3Byb3A6ICd2YWwxJ307CgogICAgICBicm93c2VyLnVybChjdXJyZW50SHJlZiwgZmFsc2UsIHVuZGVmaW5lZCk7CiAgICAgIGV4cGVjdChmYWtlV2luZG93Lmhpc3Rvcnkuc3RhdGUpLnRvQmUobnVsbCk7CiAgICB9KTsKCiAgICBpdCgnc2hvdWxkIGRvIHB1c2hTdGF0ZSB3aXRoIHRoZSBzYW1lIFVSTCBhbmQgYSBkaWZmZXJlbnQgc3RhdGUnLCBmdW5jdGlvbigpIHsKICAgICAgYnJvd3Nlci51cmwoY3VycmVudEhyZWYsIGZhbHNlLCB7cHJvcDogJ3ZhbDEnfSk7CiAgICAgIGV4cGVjdChmYWtlV2luZG93Lmhpc3Rvcnkuc3RhdGUpLnRvRXF1YWwoe3Byb3A6ICd2YWwxJ30pOwoKICAgICAgYnJvd3Nlci51cmwoY3VycmVudEhyZWYsIGZhbHNlLCBudWxsKTsKICAgICAgZXhwZWN0KGZha2VXaW5kb3cuaGlzdG9yeS5zdGF0ZSkudG9CZShudWxsKTsKCiAgICAgIGJyb3dzZXIudXJsKGN1cnJlbnRIcmVmLCBmYWxzZSwge3Byb3A6ICd2YWwyJ30pOwogICAgICBicm93c2VyLnVybChjdXJyZW50SHJlZiwgZmFsc2UsIHtwcm9wOiAndmFsMyd9KTsKICAgICAgZXhwZWN0KGZha2VXaW5kb3cuaGlzdG9yeS5zdGF0ZSkudG9FcXVhbCh7cHJvcDogJ3ZhbDMnfSk7CiAgICB9KTsKCiAgICBpdCgnc2hvdWxkIGRvIHB1c2hTdGF0ZSB3aXRoIHRoZSBzYW1lIFVSTCBhbmQgbnVsbCBzdGF0ZScsIGZ1bmN0aW9uKCkgewogICAgICBmYWtlV2luZG93Lmhpc3Rvcnkuc3RhdGUgPSB7cHJvcDogJ3ZhbDEnfTsKICAgICAgYnJvd3Nlci51cmwoY3VycmVudEhyZWYsIGZhbHNlLCBudWxsKTsKICAgICAgZXhwZWN0KGZha2VXaW5kb3cuaGlzdG9yeS5zdGF0ZSkudG9FcXVhbChudWxsKTsKICAgIH0pOwoKICAgIGl0KCdzaG91bGQgZG8gcHVzaFN0YXRlIHdpdGggdGhlIHNhbWUgVVJMIGFuZCB0aGUgc2FtZSBub24tbnVsbCBzdGF0ZScsIGZ1bmN0aW9uKCkgewogICAgICBicm93c2VyLnVybChjdXJyZW50SHJlZiwgZmFsc2UsIHtwcm9wOiAndmFsMid9KTsKICAgICAgZmFrZVdpbmRvdy5oaXN0b3J5LnN0YXRlID0ge3Byb3A6ICd2YWwzJ307CiAgICAgIGJyb3dzZXIudXJsKGN1cnJlbnRIcmVmLCBmYWxzZSwge3Byb3A6ICd2YWwyJ30pOwogICAgICBleHBlY3QoZmFrZVdpbmRvdy5oaXN0b3J5LnN0YXRlKS50b0VxdWFsKHtwcm9wOiAndmFsMid9KTsKICAgIH0pOwogIH0pOwoKICBkZXNjcmliZSgndXJsQ2hhbmdlJywgZnVuY3Rpb24oKSB7CiAgICB2YXIgY2FsbGJhY2s7CgogICAgYmVmb3JlRWFjaChmdW5jdGlvbigpIHsKICAgICAgY2FsbGJhY2sgPSBqYXNtaW5lLmNyZWF0ZVNweSgnb25VcmxDaGFuZ2UnKTsKICAgIH0pOwoKICAgIGFmdGVyRWFjaChmdW5jdGlvbigpIHsKICAgICAgaWYgKCFqUXVlcnkpIGpxTGl0ZURlYWxvYyhmYWtlV2luZG93KTsKICAgIH0pOwoKICAgIGl0KCdzaG91bGQgcmV0dXJuIHJlZ2lzdGVyZWQgY2FsbGJhY2snLCBmdW5jdGlvbigpIHsKICAgICAgZXhwZWN0KGJyb3dzZXIub25VcmxDaGFuZ2UoY2FsbGJhY2spKS50b0JlKGNhbGxiYWNrKTsKICAgIH0pOwoKICAgIGl0KCdzaG91bGQgZm9yd2FyZCBwb3BzdGF0ZSBldmVudCB3aXRoIG5ldyB1cmwgd2hlbiBoaXN0b3J5IHN1cHBvcnRlZCcsIGZ1bmN0aW9uKCkgewogICAgICBzbmlmZmVyLmhpc3RvcnkgPSB0cnVlOwogICAgICBicm93c2VyLm9uVXJsQ2hhbmdlKGNhbGxiYWNrKTsKICAgICAgZmFrZVdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJ2h0dHA6Ly9zZXJ2ZXIvbmV3JzsKCiAgICAgIGZha2VXaW5kb3cuZmlyZSgncG9wc3RhdGUnKTsKICAgICAgZXhwZWN0KGNhbGxiYWNrKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnaHR0cDovL3NlcnZlci9uZXcnLCBudWxsKTsKCiAgICAgIGZha2VXaW5kb3cuZmlyZSgnaGFzaGNoYW5nZScpOwogICAgICBmYWtlV2luZG93LnNldFRpbWVvdXQuZmx1c2goKTsKICAgICAgZXhwZWN0KGNhbGxiYWNrKS50b0hhdmVCZWVuQ2FsbGVkT25jZSgpOwogICAgfSk7CgogICAgaXQoJ3Nob3VsZCBmb3J3YXJkIG9ubHkgcG9wc3RhdGUgZXZlbnQgd2hlbiBoaXN0b3J5IHN1cHBvcnRlZCcsIGZ1bmN0aW9uKCkgewogICAgICBzbmlmZmVyLmhpc3RvcnkgPSB0cnVlOwogICAgICBicm93c2VyLm9uVXJsQ2hhbmdlKGNhbGxiYWNrKTsKICAgICAgZmFrZVdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJ2h0dHA6Ly9zZXJ2ZXIvbmV3JzsKCiAgICAgIGZha2VXaW5kb3cuZmlyZSgncG9wc3RhdGUnKTsKICAgICAgZXhwZWN0KGNhbGxiYWNrKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnaHR0cDovL3NlcnZlci9uZXcnLCBudWxsKTsKCiAgICAgIGZha2VXaW5kb3cuZmlyZSgnaGFzaGNoYW5nZScpOwogICAgICBmYWtlV2luZG93LnNldFRpbWVvdXQuZmx1c2goKTsKICAgICAgZXhwZWN0KGNhbGxiYWNrKS50b0hhdmVCZWVuQ2FsbGVkT25jZSgpOwogICAgfSk7CgogICAgaXQoJ3Nob3VsZCBmb3J3YXJkIGhhc2hjaGFuZ2UgZXZlbnQgd2l0aCBuZXcgdXJsIHdoZW4gaGlzdG9yeSBub3Qgc3VwcG9ydGVkJywgZnVuY3Rpb24oKSB7CiAgICAgIHNuaWZmZXIuaGlzdG9yeSA9IGZhbHNlOwogICAgICBicm93c2VyLm9uVXJsQ2hhbmdlKGNhbGxiYWNrKTsKICAgICAgZmFrZVdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJ2h0dHA6Ly9zZXJ2ZXIvbmV3JzsKCiAgICAgIGZha2VXaW5kb3cuZmlyZSgnaGFzaGNoYW5nZScpOwogICAgICBleHBlY3QoY2FsbGJhY2spLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdodHRwOi8vc2VydmVyL25ldycsIG51bGwpOwoKICAgICAgZmFrZVdpbmRvdy5maXJlKCdwb3BzdGF0ZScpOwogICAgICBmYWtlV2luZG93LnNldFRpbWVvdXQuZmx1c2goKTsKICAgICAgZXhwZWN0KGNhbGxiYWNrKS50b0hhdmVCZWVuQ2FsbGVkT25jZSgpOwogICAgfSk7CgogICAgaXQoJ3Nob3VsZCBub3QgZmlyZSB1cmxDaGFuZ2UgaWYgY2hhbmdlZCBieSBicm93c2VyLnVybCBtZXRob2QnLCBmdW5jdGlvbigpIHsKICAgICAgc25pZmZlci5oaXN0b3J5ID0gZmFsc2U7CiAgICAgIGJyb3dzZXIub25VcmxDaGFuZ2UoY2FsbGJhY2spOwogICAgICBicm93c2VyLnVybCgnaHR0cDovL25ldy5jb20nKTsKCiAgICAgIGZha2VXaW5kb3cuZmlyZSgnaGFzaGNoYW5nZScpOwogICAgICBleHBlY3QoY2FsbGJhY2spLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7CiAgICB9KTsKICB9KTsKCgogIGRlc2NyaWJlKCdiYXNlSHJlZicsIGZ1bmN0aW9uKCkgewogICAgdmFyIGpxRG9jSGVhZDsKCiAgICBiZWZvcmVFYWNoKGZ1bmN0aW9uKCkgewogICAgICBqcURvY0hlYWQgPSBqcUxpdGUoZG9jdW1lbnQpLmZpbmQoJ2hlYWQnKTsKICAgIH0pOwoKICAgIGl0KCdzaG91bGQgcmV0dXJuIHZhbHVlIGZyb20gPGJhc2UgaHJlZj4nLCBmdW5jdGlvbigpIHsKICAgICAgZmFrZURvY3VtZW50LmJhc2VQYXRoID0gJy9iYXNlL3BhdGgvJzsKICAgICAgZXhwZWN0KGJyb3dzZXIuYmFzZUhyZWYoKSkudG9FcXVhbCgnL2Jhc2UvcGF0aC8nKTsKICAgIH0pOwoKICAgIGl0KCdzaG91bGQgcmV0dXJuIFwnXCcgKGVtcHR5IHN0cmluZykgaWYgbm8gPGJhc2UgaHJlZj4nLCBmdW5jdGlvbigpIHsKICAgICAgZmFrZURvY3VtZW50LmJhc2VQYXRoID0gdW5kZWZpbmVkOwogICAgICBleHBlY3QoYnJvd3Nlci5iYXNlSHJlZigpKS50b0VxdWFsKCcnKTsKICAgIH0pOwoKICAgIGl0KCdzaG91bGQgcmVtb3ZlIGRvbWFpbiBmcm9tIDxiYXNlIGhyZWY+JywgZnVuY3Rpb24oKSB7CiAgICAgIGZha2VEb2N1bWVudC5iYXNlUGF0aCA9ICdodHRwOi8vaG9zdC5jb20vYmFzZS9wYXRoLyc7CiAgICAgIGV4cGVjdChicm93c2VyLmJhc2VIcmVmKCkpLnRvRXF1YWwoJy9iYXNlL3BhdGgvJyk7CgogICAgICBmYWtlRG9jdW1lbnQuYmFzZVBhdGggPSAnaHR0cDovL2hvc3QuY29tL2Jhc2UvcGF0aC9pbmRleC5odG1sJzsKICAgICAgZXhwZWN0KGJyb3dzZXIuYmFzZUhyZWYoKSkudG9FcXVhbCgnL2Jhc2UvcGF0aC9pbmRleC5odG1sJyk7CiAgICB9KTsKCiAgICBpdCgnc2hvdWxkIHJlbW92ZSBkb21haW4gZnJvbSA8YmFzZSBocmVmPiBiZWdpbm5pbmcgd2l0aCBcJy8vXCcnLCBmdW5jdGlvbigpIHsKICAgICAgZmFrZURvY3VtZW50LmJhc2VQYXRoID0gJy8vZ29vZ2xlLmNvbS9iYXNlL3BhdGgvJzsKICAgICAgZXhwZWN0KGJyb3dzZXIuYmFzZUhyZWYoKSkudG9FcXVhbCgnL2Jhc2UvcGF0aC8nKTsKICAgIH0pOwogIH0pOwoKICBkZXNjcmliZSgnaW50ZWdyYXRpb24gdGVzdHMgd2l0aCAkbG9jYXRpb24nLCBmdW5jdGlvbigpIHsKCiAgICBmdW5jdGlvbiBzZXR1cChvcHRpb25zKSB7CiAgICAgIG1vZHVsZShmdW5jdGlvbigkcHJvdmlkZSwgJGxvY2F0aW9uUHJvdmlkZXIpIHsKICAgICAgICBzcHlPbihmYWtlV2luZG93Lmhpc3RvcnksICdwdXNoU3RhdGUnKS5hbmRDYWxsRmFrZShmdW5jdGlvbihzdGF0ZU9iaiwgdGl0bGUsIG5ld1VybCkgewogICAgICAgICAgZmFrZVdpbmRvdy5sb2NhdGlvbi5ocmVmID0gbmV3VXJsOwogICAgICAgIH0pOwogICAgICAgIHNweU9uKGZha2VXaW5kb3cubG9jYXRpb24sICdyZXBsYWNlJykuYW5kQ2FsbEZha2UoZnVuY3Rpb24obmV3VXJsKSB7CiAgICAgICAgICBmYWtlV2luZG93LmxvY2F0aW9uLmhyZWYgPSBuZXdVcmw7CiAgICAgICAgfSk7CiAgICAgICAgJHByb3ZpZGUudmFsdWUoJyRicm93c2VyJywgYnJvd3Nlcik7CiAgICAgICAgYnJvd3Nlci5wb2xsRm5zID0gW107CgogICAgICAgIHNuaWZmZXIuaGlzdG9yeSA9IG9wdGlvbnMuaGlzdG9yeTsKICAgICAgICAkcHJvdmlkZS52YWx1ZSgnJHNuaWZmZXInLCBzbmlmZmVyKTsKCiAgICAgICAgJGxvY2F0aW9uUHJvdmlkZXIuaHRtbDVNb2RlKG9wdGlvbnMuaHRtbDVNb2RlKTsKICAgICAgfSk7CiAgICB9CgogICAgZGVzY3JpYmUoJ3VwZGF0ZSAkbG9jYXRpb24gd2hlbiBpdCB3YXMgY2hhbmdlZCBvdXRzaWRlIG9mIEFuZ3VsYXIgaW4gc3luYyAnKwogICAgICAgJ2JlZm9yZSAkZGlnZXN0IHdhcyBjYWxsZWQnLCBmdW5jdGlvbigpIHsKCiAgICAgIGl0KCdzaG91bGQgd29yayB3aXRoIG5vIGhpc3Rvcnkgc3VwcG9ydCwgbm8gaHRtbDVNb2RlJywgZnVuY3Rpb24oKSB7CiAgICAgICAgc2V0dXAoewogICAgICAgICAgaGlzdG9yeTogZmFsc2UsCiAgICAgICAgICBodG1sNU1vZGU6IGZhbHNlCiAgICAgICAgfSk7CiAgICAgICAgaW5qZWN0KGZ1bmN0aW9uKCRyb290U2NvcGUsICRsb2NhdGlvbikgewogICAgICAgICAgJHJvb3RTY29wZS4kYXBwbHkoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvaW5pdGlhbFBhdGgnKTsKICAgICAgICAgIH0pOwogICAgICAgICAgZXhwZWN0KGZha2VXaW5kb3cubG9jYXRpb24uaHJlZikudG9CZSgnaHR0cDovL3NlcnZlci8jL2luaXRpYWxQYXRoJyk7CgogICAgICAgICAgZmFrZVdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJ2h0dHA6Ly9zZXJ2ZXIvIy9zb21lVGVzdEhhc2gnOwoKICAgICAgICAgICRyb290U2NvcGUuJGRpZ2VzdCgpOwoKICAgICAgICAgIGV4cGVjdCgkbG9jYXRpb24ucGF0aCgpKS50b0JlKCcvc29tZVRlc3RIYXNoJyk7CiAgICAgICAgfSk7CiAgICAgIH0pOwoKICAgICAgaXQoJ3Nob3VsZCB3b3JrIHdpdGggaGlzdG9yeSBzdXBwb3J0LCBubyBodG1sNU1vZGUnLCBmdW5jdGlvbigpIHsKICAgICAgICBzZXR1cCh7CiAgICAgICAgICBoaXN0b3J5OiB0cnVlLAogICAgICAgICAgaHRtbDVNb2RlOiBmYWxzZQogICAgICAgIH0pOwogICAgICAgIGluamVjdChmdW5jdGlvbigkcm9vdFNjb3BlLCAkbG9jYXRpb24pIHsKICAgICAgICAgICRyb290U2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2luaXRpYWxQYXRoJyk7CiAgICAgICAgICB9KTsKICAgICAgICAgIGV4cGVjdChmYWtlV2luZG93LmxvY2F0aW9uLmhyZWYpLnRvQmUoJ2h0dHA6Ly9zZXJ2ZXIvIy9pbml0aWFsUGF0aCcpOwoKICAgICAgICAgIGZha2VXaW5kb3cubG9jYXRpb24uaHJlZiA9ICdodHRwOi8vc2VydmVyLyMvc29tZVRlc3RIYXNoJzsKCiAgICAgICAgICAkcm9vdFNjb3BlLiRkaWdlc3QoKTsKCiAgICAgICAgICBleHBlY3QoJGxvY2F0aW9uLnBhdGgoKSkudG9CZSgnL3NvbWVUZXN0SGFzaCcpOwogICAgICAgIH0pOwogICAgICB9KTsKCiAgICAgIGl0KCdzaG91bGQgd29yayB3aXRoIG5vIGhpc3Rvcnkgc3VwcG9ydCwgd2l0aCBodG1sNU1vZGUnLCBmdW5jdGlvbigpIHsKICAgICAgICBzZXR1cCh7CiAgICAgICAgICBoaXN0b3J5OiBmYWxzZSwKICAgICAgICAgIGh0bWw1TW9kZTogdHJ1ZQogICAgICAgIH0pOwogICAgICAgIGluamVjdChmdW5jdGlvbigkcm9vdFNjb3BlLCAkbG9jYXRpb24pIHsKICAgICAgICAgICRyb290U2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2luaXRpYWxQYXRoJyk7CiAgICAgICAgICB9KTsKICAgICAgICAgIGV4cGVjdChmYWtlV2luZG93LmxvY2F0aW9uLmhyZWYpLnRvQmUoJ2h0dHA6Ly9zZXJ2ZXIvIy9pbml0aWFsUGF0aCcpOwoKICAgICAgICAgIGZha2VXaW5kb3cubG9jYXRpb24uaHJlZiA9ICdodHRwOi8vc2VydmVyLyMvc29tZVRlc3RIYXNoJzsKCiAgICAgICAgICAkcm9vdFNjb3BlLiRkaWdlc3QoKTsKCiAgICAgICAgICBleHBlY3QoJGxvY2F0aW9uLnBhdGgoKSkudG9CZSgnL3NvbWVUZXN0SGFzaCcpOwogICAgICAgIH0pOwogICAgICB9KTsKCiAgICAgIGl0KCdzaG91bGQgd29yayB3aXRoIGhpc3Rvcnkgc3VwcG9ydCwgd2l0aCBodG1sNU1vZGUnLCBmdW5jdGlvbigpIHsKICAgICAgICBzZXR1cCh7CiAgICAgICAgICBoaXN0b3J5OiB0cnVlLAogICAgICAgICAgaHRtbDVNb2RlOiB0cnVlCiAgICAgICAgfSk7CiAgICAgICAgaW5qZWN0KGZ1bmN0aW9uKCRyb290U2NvcGUsICRsb2NhdGlvbikgewogICAgICAgICAgJHJvb3RTY29wZS4kYXBwbHkoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvaW5pdGlhbFBhdGgnKTsKICAgICAgICAgIH0pOwogICAgICAgICAgZXhwZWN0KGZha2VXaW5kb3cubG9jYXRpb24uaHJlZikudG9CZSgnaHR0cDovL3NlcnZlci9pbml0aWFsUGF0aCcpOwoKICAgICAgICAgIGZha2VXaW5kb3cubG9jYXRpb24uaHJlZiA9ICdodHRwOi8vc2VydmVyL3NvbWVUZXN0SGFzaCc7CgogICAgICAgICAgJHJvb3RTY29wZS4kZGlnZXN0KCk7CgogICAgICAgICAgZXhwZWN0KCRsb2NhdGlvbi5wYXRoKCkpLnRvQmUoJy9zb21lVGVzdEhhc2gnKTsKICAgICAgICB9KTsKICAgICAgfSk7CgogICAgfSk7CgogICAgaXQoJ3Nob3VsZCBub3QgcmVsb2FkIHRoZSBwYWdlIG9uIGV2ZXJ5ICRkaWdlc3Qgd2hlbiB0aGUgcGFnZSB3aWxsIGJlIHJlbG9hZGVkIGR1ZSB0byB1cmwgcmV3cml0ZSBvbiBsb2FkJywgZnVuY3Rpb24oKSB7CiAgICAgIHNldHVwKHsKICAgICAgICBoaXN0b3J5OiBmYWxzZSwKICAgICAgICBodG1sNU1vZGU6IHRydWUKICAgICAgfSk7CiAgICAgIGZha2VXaW5kb3cubG9jYXRpb24uaHJlZiA9ICdodHRwOi8vc2VydmVyL3NvbWUvZGVlcC9wYXRoJzsKICAgICAgdmFyIGNoYW5nZVVybENvdW50ID0gMDsKICAgICAgdmFyIF91cmwgPSBicm93c2VyLnVybDsKICAgICAgYnJvd3Nlci51cmwgPSBmdW5jdGlvbihuZXdVcmwsIHJlcGxhY2UsIHN0YXRlKSB7CiAgICAgICAgaWYgKG5ld1VybCkgewogICAgICAgICAgY2hhbmdlVXJsQ291bnQrKzsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF91cmwuY2FsbCh0aGlzLCBuZXdVcmwsIHJlcGxhY2UpOwogICAgICB9OwogICAgICBzcHlPbihicm93c2VyLCAndXJsJykuYW5kQ2FsbFRocm91Z2goKTsKICAgICAgaW5qZWN0KGZ1bmN0aW9uKCRyb290U2NvcGUsICRsb2NhdGlvbikgewogICAgICAgICRyb290U2NvcGUuJGRpZ2VzdCgpOwogICAgICAgICRyb290U2NvcGUuJGRpZ2VzdCgpOwogICAgICAgICRyb290U2NvcGUuJGRpZ2VzdCgpOwogICAgICAgICRyb290U2NvcGUuJGRpZ2VzdCgpOwoKICAgICAgICAvLyBmcm9tICRsb2NhdGlvbiBmb3IgcmV3cml0aW5nIHRoZSBpbml0aWFsIHVybCBpbnRvIGEgaGFzaCB1cmwKICAgICAgICBleHBlY3QoYnJvd3Nlci51cmwpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdodHRwOi8vc2VydmVyLyMvc29tZS9kZWVwL3BhdGgnLCB0cnVlKTsKICAgICAgICAvLyBmcm9tIHRoZSBpbml0aWFsIGNhbGwgdG8gdGhlIHdhdGNoIGluICRsb2NhdGlvbiBmb3Igd2F0Y2hpbmcgJGxvY2F0aW9uCiAgICAgICAgZXhwZWN0KGJyb3dzZXIudXJsKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnaHR0cDovL3NlcnZlci8jL3NvbWUvZGVlcC9wYXRoJywgZmFsc2UsIG51bGwpOwogICAgICAgIGV4cGVjdChjaGFuZ2VVcmxDb3VudCkudG9CZSgyKTsKICAgICAgfSk7CgogICAgfSk7CiAgfSk7CgogIGRlc2NyaWJlKCdpbnRlZ3JhdGlvbiB0ZXN0IHdpdGggJHJvb3RTY29wZScsIGZ1bmN0aW9uKCkgewoKICAgIGJlZm9yZUVhY2gobW9kdWxlKGZ1bmN0aW9uKCRwcm92aWRlLCAkbG9jYXRpb25Qcm92aWRlcikgewogICAgICAkcHJvdmlkZS52YWx1ZSgnJGJyb3dzZXInLCBicm93c2VyKTsKICAgICAgYnJvd3Nlci5wb2xsRm5zID0gW107CiAgICB9KSk7CgogICAgaXQoJ3Nob3VsZCBub3QgaW50ZXJmZXJlIHdpdGggbGVnYWN5IGJyb3dzZXIgdXJsIHJlcGxhY2UgYmVoYXZpb3InLCBmdW5jdGlvbigpIHsKICAgICAgaW5qZWN0KGZ1bmN0aW9uKCRyb290U2NvcGUpIHsKICAgICAgICB2YXIgY3VycmVudCA9IGZha2VXaW5kb3cubG9jYXRpb24uaHJlZjsKICAgICAgICB2YXIgbmV3VXJsID0gJ25vdHlldCc7CiAgICAgICAgc25pZmZlci5oaXN0b3J5ID0gZmFsc2U7CiAgICAgICAgZXhwZWN0KGhpc3RvcnlFbnRyaWVzTGVuZ3RoKS50b0JlKDEpOwogICAgICAgIGJyb3dzZXIudXJsKG5ld1VybCwgdHJ1ZSk7CiAgICAgICAgZXhwZWN0KGJyb3dzZXIudXJsKCkpLnRvQmUobmV3VXJsKTsKICAgICAgICBleHBlY3QoaGlzdG9yeUVudHJpZXNMZW5ndGgpLnRvQmUoMSk7CiAgICAgICAgJHJvb3RTY29wZS4kZGlnZXN0KCk7CiAgICAgICAgZXhwZWN0KGJyb3dzZXIudXJsKCkpLnRvQmUobmV3VXJsKTsKICAgICAgICBleHBlY3QoaGlzdG9yeUVudHJpZXNMZW5ndGgpLnRvQmUoMSk7CiAgICAgIH0pOwogICAgfSk7CgogIH0pOwoKfSk7Cg==",
                "body": "J3VzZSBzdHJpY3QnOwoKdmFyIGhpc3RvcnlFbnRyaWVzTGVuZ3RoOwp2YXIgc25pZmZlciA9IHt9OwoKZnVuY3Rpb24gTW9ja1dpbmRvdygpIHsKICB2YXIgZXZlbnRzID0ge307CiAgdmFyIHRpbWVvdXRzID0gdGhpcy50aW1lb3V0cyA9IFtdOwogIHZhciBsb2NhdGlvbkhyZWYgPSAnaHR0cDovL3NlcnZlci8nOwogIHZhciBtb2NrV2luZG93ID0gdGhpczsKCiAgaGlzdG9yeUVudHJpZXNMZW5ndGggPSAxOwoKICB0aGlzLnNldFRpbWVvdXQgPSBmdW5jdGlvbihmbikgewogICAgcmV0dXJuIHRpbWVvdXRzLnB1c2goZm4pIC0gMTsKICB9OwoKICB0aGlzLmNsZWFyVGltZW91dCA9IGZ1bmN0aW9uKGlkKSB7CiAgICB0aW1lb3V0c1tpZF0gPSBub29wOwogIH07CgogIHRoaXMuc2V0VGltZW91dC5mbHVzaCA9IGZ1bmN0aW9uKCkgewogICAgdmFyIGxlbmd0aCA9IHRpbWVvdXRzLmxlbmd0aDsKICAgIHdoaWxlIChsZW5ndGgtLSA+IDApIHRpbWVvdXRzLnNoaWZ0KCkoKTsKICB9OwoKICB0aGlzLmFkZEV2ZW50TGlzdGVuZXIgPSBmdW5jdGlvbihuYW1lLCBsaXN0ZW5lcikgewogICAgaWYgKGFuZ3VsYXIuaXNVbmRlZmluZWQoZXZlbnRzW25hbWVdKSkgZXZlbnRzW25hbWVdID0gW107CiAgICBldmVudHNbbmFtZV0ucHVzaChsaXN0ZW5lcik7CiAgfTsKCiAgdGhpcy5hdHRhY2hFdmVudCA9IGZ1bmN0aW9uKG5hbWUsIGxpc3RlbmVyKSB7CiAgICB0aGlzLmFkZEV2ZW50TGlzdGVuZXIobmFtZS5zdWJzdHIoMiksIGxpc3RlbmVyKTsKICB9OwoKICB0aGlzLnJlbW92ZUV2ZW50TGlzdGVuZXIgPSBub29wOwogIHRoaXMuZGV0YWNoRXZlbnQgPSBub29wOwoKICB0aGlzLmZpcmUgPSBmdW5jdGlvbihuYW1lKSB7CiAgICBmb3JFYWNoKGV2ZW50c1tuYW1lXSwgZnVuY3Rpb24oZm4pIHsKICAgICAgZm4oe3R5cGU6IG5hbWV9KTsgLy8gdHlwZSB0byBtYWtlIGpRdWVyeSBoYXBweQogICAgfSk7CiAgfTsKCiAgdGhpcy5sb2NhdGlvbiA9IHsKICAgIGdldCBocmVmKCkgewogICAgICByZXR1cm4gbG9jYXRpb25IcmVmOwogICAgfSwKICAgIHNldCBocmVmKHZhbHVlKSB7CiAgICAgIGxvY2F0aW9uSHJlZiA9IHZhbHVlOwogICAgICBtb2NrV2luZG93Lmhpc3Rvcnkuc3RhdGUgPSBudWxsOwogICAgICBoaXN0b3J5RW50cmllc0xlbmd0aCsrOwogICAgfSwKICAgIHJlcGxhY2U6IGZ1bmN0aW9uKHVybCkgewogICAgICBsb2NhdGlvbkhyZWYgPSB1cmw7CiAgICAgIG1vY2tXaW5kb3cuaGlzdG9yeS5zdGF0ZSA9IG51bGw7CiAgICB9LAogIH07CgogIHRoaXMuaGlzdG9yeSA9IHsKICAgIHN0YXRlOiBudWxsLAogICAgcHVzaFN0YXRlOiBmdW5jdGlvbigpIHsKICAgICAgdGhpcy5yZXBsYWNlU3RhdGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgaGlzdG9yeUVudHJpZXNMZW5ndGgrKzsKICAgIH0sCiAgICByZXBsYWNlU3RhdGU6IGZ1bmN0aW9uKHN0YXRlLCB0aXRsZSwgdXJsKSB7CiAgICAgIGxvY2F0aW9uSHJlZiA9IHVybDsKICAgICAgbW9ja1dpbmRvdy5oaXN0b3J5LnN0YXRlID0gY29weShzdGF0ZSk7CiAgICB9CiAgfTsKfQoKZnVuY3Rpb24gTW9ja0RvY3VtZW50KCkgewogIHZhciBzZWxmID0gdGhpczsKCiAgdGhpc1swXSA9IHdpbmRvdy5kb2N1bWVudDsKICB0aGlzLmJhc2VQYXRoID0gJy8nOwoKICB0aGlzLmZpbmQgPSBmdW5jdGlvbihuYW1lKSB7CiAgICBpZiAobmFtZSA9PSAnYmFzZScpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBhdHRyOiBmdW5jdGlvbihuYW1lKXsKICAgICAgICAgIGlmIChuYW1lID09ICdocmVmJykgewogICAgICAgICAgICByZXR1cm4gc2VsZi5iYXNlUGF0aDsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihuYW1lKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH07CiAgICB9IGVsc2UgewogICAgICB0aHJvdyBuZXcgRXJyb3IobmFtZSk7CiAgICB9CiAgfTsKfQoKZGVzY3JpYmUoJ2Jyb3dzZXInLCBmdW5jdGlvbigpIHsKICAvKiBnbG9iYWwgQnJvd3NlcjogZmFsc2UgKi8KICB2YXIgYnJvd3NlciwgZmFrZVdpbmRvdywgZmFrZURvY3VtZW50LCBsb2dzLCBzY3JpcHRzLCByZW1vdmVkU2NyaXB0czsKCiAgYmVmb3JlRWFjaChmdW5jdGlvbigpIHsKICAgIHNjcmlwdHMgPSBbXTsKICAgIHJlbW92ZWRTY3JpcHRzID0gW107CiAgICBzbmlmZmVyID0ge2hpc3Rvcnk6IHRydWV9OwogICAgZmFrZVdpbmRvdyA9IG5ldyBNb2NrV2luZG93KCk7CiAgICBmYWtlRG9jdW1lbnQgPSBuZXcgTW9ja0RvY3VtZW50KCk7CgogICAgbG9ncyA9IHtsb2c6W10sIHdhcm46W10sIGluZm86W10sIGVycm9yOltdfTsKCiAgICB2YXIgZmFrZUxvZyA9IHtsb2c6IGZ1bmN0aW9uKCkgeyBsb2dzLmxvZy5wdXNoKHNsaWNlLmNhbGwoYXJndW1lbnRzKSk7IH0sCiAgICAgICAgICAgICAgICAgICB3YXJuOiBmdW5jdGlvbigpIHsgbG9ncy53YXJuLnB1c2goc2xpY2UuY2FsbChhcmd1bWVudHMpKTsgfSwKICAgICAgICAgICAgICAgICAgIGluZm86IGZ1bmN0aW9uKCkgeyBsb2dzLmluZm8ucHVzaChzbGljZS5jYWxsKGFyZ3VtZW50cykpOyB9LAogICAgICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKCkgeyBsb2dzLmVycm9yLnB1c2goc2xpY2UuY2FsbChhcmd1bWVudHMpKTsgfX07CgogICAgYnJvd3NlciA9IG5ldyBCcm93c2VyKGZha2VXaW5kb3csIGZha2VEb2N1bWVudCwgZmFrZUxvZywgc25pZmZlcik7CiAgfSk7CgogIGRlc2NyaWJlKCdNb2NrQnJvd3NlciBoaXN0b3J5RW50cmllc0xlbmd0aCcsIGZ1bmN0aW9uKCkgewogICAgaXQoJ3Nob3VsZCBpbmNyZW1lbnQgaGlzdG9yeUVudHJpZXNMZW5ndGggd2hlbiBzZXR0aW5nIGxvY2F0aW9uLmhyZWYnLCBmdW5jdGlvbigpIHsKICAgICAgZXhwZWN0KGhpc3RvcnlFbnRyaWVzTGVuZ3RoKS50b0JlKDEpOwogICAgICBmYWtlV2luZG93LmxvY2F0aW9uLmhyZWYgPSAnL2Zvbyc7CiAgICAgIGV4cGVjdChoaXN0b3J5RW50cmllc0xlbmd0aCkudG9CZSgyKTsKICAgIH0pOwoKICAgIGl0KCdzaG91bGQgbm90IGluY3JlbWVudCBoaXN0b3J5RW50cmllc0xlbmd0aCB3aGVuIHVzaW5nIGxvY2F0aW9uLnJlcGxhY2UnLCBmdW5jdGlvbigpIHsKICAgICAgZXhwZWN0KGhpc3RvcnlFbnRyaWVzTGVuZ3RoKS50b0JlKDEpOwogICAgICBmYWtlV2luZG93LmxvY2F0aW9uLnJlcGxhY2UoJy9mb28nKTsKICAgICAgZXhwZWN0KGhpc3RvcnlFbnRyaWVzTGVuZ3RoKS50b0JlKDEpOwogICAgfSk7CgogICAgaXQoJ3Nob3VsZCBpbmNyZW1lbnQgaGlzdG9yeUVudHJpZXNMZW5ndGggd2hlbiB1c2luZyBoaXN0b3J5LnB1c2hTdGF0ZScsIGZ1bmN0aW9uKCkgewogICAgICBleHBlY3QoaGlzdG9yeUVudHJpZXNMZW5ndGgpLnRvQmUoMSk7CiAgICAgIGZha2VXaW5kb3cuaGlzdG9yeS5wdXNoU3RhdGUoe2E6IDJ9LCAnZm9vJywgJy9iYXInKTsKICAgICAgZXhwZWN0KGhpc3RvcnlFbnRyaWVzTGVuZ3RoKS50b0JlKDIpOwogICAgfSk7CgogICAgaXQoJ3Nob3VsZCBub3QgaW5jcmVtZW50IGhpc3RvcnlFbnRyaWVzTGVuZ3RoIHdoZW4gdXNpbmcgaGlzdG9yeS5yZXBsYWNlU3RhdGUnLCBmdW5jdGlvbigpIHsKICAgICAgZXhwZWN0KGhpc3RvcnlFbnRyaWVzTGVuZ3RoKS50b0JlKDEpOwogICAgICBmYWtlV2luZG93Lmhpc3RvcnkucmVwbGFjZVN0YXRlKHthOiAyfSwgJ2ZvbycsICcvYmFyJyk7CiAgICAgIGV4cGVjdChoaXN0b3J5RW50cmllc0xlbmd0aCkudG9CZSgxKTsKICAgIH0pOwogIH0pOwoKICBpdCgnc2hvdWxkIGNvbnRhaW4gY29va2llIGNydW5jaGVyJywgZnVuY3Rpb24oKSB7CiAgICBleHBlY3QoYnJvd3Nlci5jb29raWVzKS50b0JlRGVmaW5lZCgpOwogIH0pOwoKICBkZXNjcmliZSgnb3V0c3RhZGluZyByZXF1ZXN0cycsIGZ1bmN0aW9uKCkgewogICAgaXQoJ3Nob3VsZCBwcm9jZXNzIGNhbGxiYWNrcyBpbW1lZGlldGx5IHdpdGggbm8gb3V0c3RhbmRpbmcgcmVxdWVzdHMnLCBmdW5jdGlvbigpIHsKICAgICAgdmFyIGNhbGxiYWNrID0gamFzbWluZS5jcmVhdGVTcHkoJ2NhbGxiYWNrJyk7CiAgICAgIGJyb3dzZXIubm90aWZ5V2hlbk5vT3V0c3RhbmRpbmdSZXF1ZXN0cyhjYWxsYmFjayk7CiAgICAgIGV4cGVjdChjYWxsYmFjaykudG9IYXZlQmVlbkNhbGxlZCgpOwogICAgfSk7CiAgfSk7CgoKICBkZXNjcmliZSgnZGVmZXInLCBmdW5jdGlvbigpIHsKICAgIGl0KCdzaG91bGQgZXhlY3V0ZSBmbiBhc3luY2hyb25pb3VzbHkgdmlhIHNldFRpbWVvdXQnLCBmdW5jdGlvbigpIHsKICAgICAgdmFyIGNhbGxiYWNrID0gamFzbWluZS5jcmVhdGVTcHkoJ2RlZmVycmVkJyk7CgogICAgICBicm93c2VyLmRlZmVyKGNhbGxiYWNrKTsKICAgICAgZXhwZWN0KGNhbGxiYWNrKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpOwoKICAgICAgZmFrZVdpbmRvdy5zZXRUaW1lb3V0LmZsdXNoKCk7CiAgICAgIGV4cGVjdChjYWxsYmFjaykudG9IYXZlQmVlbkNhbGxlZE9uY2UoKTsKICAgIH0pOwoKCiAgICBpdCgnc2hvdWxkIHVwZGF0ZSBvdXRzdGFuZGluZ1JlcXVlc3RzIGNvdW50ZXInLCBmdW5jdGlvbigpIHsKICAgICAgdmFyIGNhbGxiYWNrID0gamFzbWluZS5jcmVhdGVTcHkoJ2RlZmVycmVkJyk7CgogICAgICBicm93c2VyLmRlZmVyKGNhbGxiYWNrKTsKICAgICAgZXhwZWN0KGNhbGxiYWNrKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpOwoKICAgICAgZmFrZVdpbmRvdy5zZXRUaW1lb3V0LmZsdXNoKCk7CiAgICAgIGV4cGVjdChjYWxsYmFjaykudG9IYXZlQmVlbkNhbGxlZE9uY2UoKTsKICAgIH0pOwoKCiAgICBpdCgnc2hvdWxkIHJldHVybiB1bmlxdWUgZGVmZXJJZCcsIGZ1bmN0aW9uKCkgewogICAgICB2YXIgZGVmZXJJZDEgPSBicm93c2VyLmRlZmVyKG5vb3ApLAogICAgICAgICAgZGVmZXJJZDIgPSBicm93c2VyLmRlZmVyKG5vb3ApOwoKICAgICAgZXhwZWN0KGRlZmVySWQxKS50b0JlRGVmaW5lZCgpOwogICAgICBleHBlY3QoZGVmZXJJZDIpLnRvQmVEZWZpbmVkKCk7CiAgICAgIGV4cGVjdChkZWZlcklkMSkubm90LnRvRXF1YWwoZGVmZXJJZDIpOwogICAgfSk7CgoKICAgIGRlc2NyaWJlKCdjYW5jZWwnLCBmdW5jdGlvbigpIHsKICAgICAgaXQoJ3Nob3VsZCBhbGxvdyB0YXNrcyB0byBiZSBjYW5jZWxlZCB3aXRoIHJldHVybmVkIGRlZmVySWQnLCBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgbG9nID0gW10sCiAgICAgICAgICAgIGRlZmVySWQxID0gYnJvd3Nlci5kZWZlcihmdW5jdGlvbigpIHsgbG9nLnB1c2goJ2NhbmNlbCBtZScpOyB9KSwKICAgICAgICAgICAgZGVmZXJJZDIgPSBicm93c2VyLmRlZmVyKGZ1bmN0aW9uKCkgeyBsb2cucHVzaCgnb2snKTsgfSksCiAgICAgICAgICAgIGRlZmVySWQzID0gYnJvd3Nlci5kZWZlcihmdW5jdGlvbigpIHsgbG9nLnB1c2goJ2NhbmNlbCBtZSwgbm93IScpOyB9KTsKCiAgICAgICAgZXhwZWN0KGxvZykudG9FcXVhbChbXSk7CiAgICAgICAgZXhwZWN0KGJyb3dzZXIuZGVmZXIuY2FuY2VsKGRlZmVySWQxKSkudG9CZSh0cnVlKTsKICAgICAgICBleHBlY3QoYnJvd3Nlci5kZWZlci5jYW5jZWwoZGVmZXJJZDMpKS50b0JlKHRydWUpOwogICAgICAgIGZha2VXaW5kb3cuc2V0VGltZW91dC5mbHVzaCgpOwogICAgICAgIGV4cGVjdChsb2cpLnRvRXF1YWwoWydvayddKTsKICAgICAgICBleHBlY3QoYnJvd3Nlci5kZWZlci5jYW5jZWwoZGVmZXJJZDIpKS50b0JlKGZhbHNlKTsKICAgICAgfSk7CiAgICB9KTsKICB9KTsKCgogIGRlc2NyaWJlKCdjb29raWVzJywgZnVuY3Rpb24oKSB7CgogICAgZnVuY3Rpb24gZGVsZXRlQWxsQ29va2llcygpIHsKICAgICAgdmFyIGNvb2tpZXMgPSBkb2N1bWVudC5jb29raWUuc3BsaXQoIjsiKTsKICAgICAgdmFyIHBhdGggPSBsb2NhdGlvbi5wYXRobmFtZTsKCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY29va2llcy5sZW5ndGg7IGkrKykgewogICAgICAgIHZhciBjb29raWUgPSBjb29raWVzW2ldOwogICAgICAgIHZhciBlcVBvcyA9IGNvb2tpZS5pbmRleE9mKCI9Iik7CiAgICAgICAgdmFyIG5hbWUgPSBlcVBvcyA+IC0xID8gY29va2llLnN1YnN0cigwLCBlcVBvcykgOiBjb29raWU7CiAgICAgICAgdmFyIHBhcnRzID0gcGF0aC5zcGxpdCgnLycpOwogICAgICAgIHdoaWxlIChwYXJ0cy5sZW5ndGgpIHsKICAgICAgICAgIGRvY3VtZW50LmNvb2tpZSA9IG5hbWUgKyAiPTtwYXRoPSIgKyAocGFydHMuam9pbignLycpIHx8ICcvJykgKyAiO2V4cGlyZXM9VGh1LCAwMSBKYW4gMTk3MCAwMDowMDowMCBHTVQiOwogICAgICAgICAgcGFydHMucG9wKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgYmVmb3JlRWFjaChmdW5jdGlvbigpIHsKICAgICAgZGVsZXRlQWxsQ29va2llcygpOwogICAgICBleHBlY3QoZG9jdW1lbnQuY29va2llKS50b0VxdWFsKCcnKTsKICAgIH0pOwoKCiAgICBhZnRlckVhY2goZnVuY3Rpb24oKSB7CiAgICAgIGRlbGV0ZUFsbENvb2tpZXMoKTsKICAgICAgZXhwZWN0KGRvY3VtZW50LmNvb2tpZSkudG9FcXVhbCgnJyk7CiAgICB9KTsKCgogICAgZGVzY3JpYmUoJ3JlbW92ZSBhbGwgdmlhIChudWxsKScsIGZ1bmN0aW9uKCkgewoKICAgICAgaXQoJ3Nob3VsZCBkbyBub3RoaW5nIHdoZW4gbm8gY29va2llcyBhcmUgc2V0JywgZnVuY3Rpb24oKSB7CiAgICAgICAgYnJvd3Nlci5jb29raWVzKG51bGwpOwogICAgICAgIGV4cGVjdChkb2N1bWVudC5jb29raWUpLnRvRXF1YWwoJycpOwogICAgICAgIGV4cGVjdChicm93c2VyLmNvb2tpZXMoKSkudG9FcXVhbCh7fSk7CiAgICAgIH0pOwoKICAgIH0pOwoKICAgIGRlc2NyaWJlKCdyZW1vdmUgdmlhIGNvb2tpZXMoY29va2llTmFtZSwgdW5kZWZpbmVkKScsIGZ1bmN0aW9uKCkgewoKICAgICAgaXQoJ3Nob3VsZCByZW1vdmUgYSBjb29raWUgd2hlbiBpdCBpcyBwcmVzZW50JywgZnVuY3Rpb24oKSB7CiAgICAgICAgZG9jdW1lbnQuY29va2llID0gJ2Zvbz1iYXI7cGF0aD0vJzsKCiAgICAgICAgYnJvd3Nlci5jb29raWVzKCdmb28nLCB1bmRlZmluZWQpOwoKICAgICAgICBleHBlY3QoZG9jdW1lbnQuY29va2llKS50b0VxdWFsKCcnKTsKICAgICAgICBleHBlY3QoYnJvd3Nlci5jb29raWVzKCkpLnRvRXF1YWwoe30pOwogICAgICB9KTsKCgogICAgICBpdCgnc2hvdWxkIGRvIG5vdGhpbmcgd2hlbiBhbiBub25leGlzdGluZyBjb29raWUgaXMgYmVpbmcgcmVtb3ZlZCcsIGZ1bmN0aW9uKCkgewogICAgICAgIGJyb3dzZXIuY29va2llcygnZG9lc250ZXhpc3QnLCB1bmRlZmluZWQpOwogICAgICAgIGV4cGVjdChkb2N1bWVudC5jb29raWUpLnRvRXF1YWwoJycpOwogICAgICAgIGV4cGVjdChicm93c2VyLmNvb2tpZXMoKSkudG9FcXVhbCh7fSk7CiAgICAgIH0pOwogICAgfSk7CgoKICAgIGRlc2NyaWJlKCdwdXQgdmlhIGNvb2tpZXMoY29va2llTmFtZSwgc3RyaW5nKScsIGZ1bmN0aW9uKCkgewoKICAgICAgaXQoJ3Nob3VsZCBjcmVhdGUgYW5kIHN0b3JlIGEgY29va2llJywgZnVuY3Rpb24oKSB7CiAgICAgICAgYnJvd3Nlci5jb29raWVzKCdjb29raWVOYW1lJywgJ2Nvb2tpZT1WYWx1ZScpOwogICAgICAgIGV4cGVjdChkb2N1bWVudC5jb29raWUpLnRvTWF0Y2goL2Nvb2tpZU5hbWU9Y29va2llJTNEVmFsdWU7PyA/Lyk7CiAgICAgICAgZXhwZWN0KGJyb3dzZXIuY29va2llcygpKS50b0VxdWFsKHsnY29va2llTmFtZSc6J2Nvb2tpZT1WYWx1ZSd9KTsKICAgICAgfSk7CgoKICAgICAgaXQoJ3Nob3VsZCBvdmVyd3JpdGUgYW4gZXhpc3RpbmcgdW5zeW5jZWQgY29va2llJywgZnVuY3Rpb24oKSB7CiAgICAgICAgZG9jdW1lbnQuY29va2llID0gImNvb2tpZT1uZXc7cGF0aD0vIjsKCiAgICAgICAgdmFyIG9sZFZhbCA9IGJyb3dzZXIuY29va2llcygnY29va2llJywgJ25ld2VyJyk7CgogICAgICAgIGV4cGVjdChkb2N1bWVudC5jb29raWUpLnRvRXF1YWwoJ2Nvb2tpZT1uZXdlcicpOwogICAgICAgIGV4cGVjdChicm93c2VyLmNvb2tpZXMoKSkudG9FcXVhbCh7J2Nvb2tpZSc6J25ld2VyJ30pOwogICAgICAgIGV4cGVjdChvbGRWYWwpLm5vdC50b0JlRGVmaW5lZCgpOwogICAgICB9KTsKCiAgICAgIGl0KCdzaG91bGQgZW5jb2RlIGJvdGggbmFtZSBhbmQgdmFsdWUnLCBmdW5jdGlvbigpIHsKICAgICAgICBicm93c2VyLmNvb2tpZXMoJ2Nvb2tpZTE9JywgJ3ZhbDt1ZScpOwogICAgICAgIGJyb3dzZXIuY29va2llcygnY29va2llMj1iYXI7YmF6JywgJ3ZhbD11ZScpOwoKICAgICAgICB2YXIgcmF3Q29va2llcyA9IGRvY3VtZW50LmNvb2tpZS5zcGxpdCgiOyAiKTsgLy9vcmRlciBpcyBub3QgZ3VhcmFudGVlZCwgc28gd2UgbmVlZCB0byBwYXJzZQogICAgICAgIGV4cGVjdChyYXdDb29raWVzLmxlbmd0aCkudG9FcXVhbCgyKTsKICAgICAgICBleHBlY3QocmF3Q29va2llcykudG9Db250YWluKCdjb29raWUxJTNEPXZhbCUzQnVlJyk7CiAgICAgICAgZXhwZWN0KHJhd0Nvb2tpZXMpLnRvQ29udGFpbignY29va2llMiUzRGJhciUzQmJhej12YWwlM0R1ZScpOwogICAgICB9KTsKCiAgICAgIGl0KCdzaG91bGQgbG9nIHdhcm5pbmdzIHdoZW4gNGtiIHBlciBjb29raWUgc3RvcmFnZSBsaW1pdCBpcyByZWFjaGVkJywgZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGksIGxvbmdWYWwgPSAnJywgY29va2llU3RyOwoKICAgICAgICBmb3IoaT0wOyBpPDQwODM7IGkrKykgewogICAgICAgICAgbG9uZ1ZhbCArPSAneCc7CiAgICAgICAgfQoKICAgICAgICBjb29raWVTdHIgPSBkb2N1bWVudC5jb29raWU7CiAgICAgICAgYnJvd3Nlci5jb29raWVzKCd4JywgbG9uZ1ZhbCk7IC8vdG90YWwgc2l6ZSA0MDkzLTQwOTYsIHNvIGl0IHNob3VsZCBnbyB0aHJvdWdoCiAgICAgICAgZXhwZWN0KGRvY3VtZW50LmNvb2tpZSkubm90LnRvRXF1YWwoY29va2llU3RyKTsKICAgICAgICBleHBlY3QoYnJvd3Nlci5jb29raWVzKClbJ3gnXSkudG9FcXVhbChsb25nVmFsKTsKICAgICAgICBleHBlY3QobG9ncy53YXJuKS50b0VxdWFsKFtdKTsKCiAgICAgICAgYnJvd3Nlci5jb29raWVzKCd4JywgbG9uZ1ZhbCArICd4eHh4Jyk7IC8vdG90YWwgc2l6ZSA0MDk3LTQwOTksIGEgd2FybmluZyBzaG91bGQgYmUgbG9nZ2VkCiAgICAgICAgZXhwZWN0KGxvZ3Mud2FybikudG9FcXVhbCgKICAgICAgICAgIFtbICJDb29raWUgJ3gnIHBvc3NpYmx5IG5vdCBzZXQgb3Igb3ZlcmZsb3dlZCBiZWNhdXNlIGl0IHdhcyB0b28gbGFyZ2UgKDQwOTcgPiA0MDk2ICIgKwogICAgICAgICAgICAgImJ5dGVzKSEiIF1dKTsKCiAgICAgICAgLy9mb3JjZSBicm93c2VyIHRvIGRyb3BwZWQgYSBjb29raWUgYW5kIG1ha2Ugc3VyZSB0aGF0IHRoZSBjYWNoZSBpcyBub3Qgb3V0IG9mIHN5bmMKICAgICAgICBicm93c2VyLmNvb2tpZXMoJ3gnLCAnc2hvcnRWYWwnKTsKICAgICAgICBleHBlY3QoYnJvd3Nlci5jb29raWVzKCkueCkudG9FcXVhbCgnc2hvcnRWYWwnKTsgLy9uZWVkZWQgdG8gcHJpbWUgdGhlIGNhY2hlCiAgICAgICAgY29va2llU3RyID0gZG9jdW1lbnQuY29va2llOwogICAgICAgIGJyb3dzZXIuY29va2llcygneCcsIGxvbmdWYWwgKyBsb25nVmFsICsgbG9uZ1ZhbCk7IC8vc2hvdWxkIGJlIHRvbyBsb25nIGZvciBhbGwgYnJvd3NlcnMKCiAgICAgICAgaWYgKGRvY3VtZW50LmNvb2tpZSAhPT0gY29va2llU3RyKSB7CiAgICAgICAgICB0aGlzLmZhaWwobmV3IEVycm9yKCJicm93c2VyIGRpZG4ndCBkcm9wIGxvbmcgY29va2llIHdoZW4gaXQgd2FzIGV4cGVjdGVkLiBtYWtlIHRoZSAiICsKICAgICAgICAgICAgICAiY29va2llIGluIHRoaXMgdGVzdCBsb25nZXIiKSk7CiAgICAgICAgfQoKICAgICAgICBleHBlY3QoYnJvd3Nlci5jb29raWVzKCkueCkudG9FcXVhbCgnc2hvcnRWYWwnKTsKICAgICAgfSk7CiAgICB9KTsKCiAgICBkZXNjcmliZSgncHV0IHZpYSBjb29raWVzKGNvb2tpZU5hbWUsIHN0cmluZyksIGlmIG5vIDxiYXNlIGhyZWY+ICcsIGZ1bmN0aW9uICgpIHsKICAgICAgYmVmb3JlRWFjaChmdW5jdGlvbiAoKSB7CiAgICAgICAgZmFrZURvY3VtZW50LmJhc2VQYXRoID0gdW5kZWZpbmVkOwogICAgICB9KTsKCiAgICAgIGl0KCdzaG91bGQgZGVmYXVsdCBwYXRoIGluIGNvb2tpZSB0byAiIiAoZW1wdHkgc3RyaW5nKScsIGZ1bmN0aW9uICgpIHsKICAgICAgICBicm93c2VyLmNvb2tpZXMoJ2Nvb2tpZScsICdiZW5kZXInKTsKICAgICAgICAvLyBUaGlzIG9ubHkgZmFpbHMgaW4gU2FmYXJpIGFuZCBJRSB3aGVuIGNvb2tpZVBhdGggcmV0dXJucyB1bmRlZmluZWQKICAgICAgICAvLyBXaGVyZSBpdCBub3cgc3VjY2VlZHMgc2luY2UgYmFzZUhyZWYgcmV0dXJuICcnIGluc3RlYWQgb2YgdW5kZWZpbmVkCiAgICAgICAgZXhwZWN0KGRvY3VtZW50LmNvb2tpZSkudG9FcXVhbCgnY29va2llPWJlbmRlcicpOwogICAgICB9KTsKICAgIH0pOwoKICAgIGRlc2NyaWJlKCdnZXQgdmlhIGNvb2tpZXMoKVtjb29raWVOYW1lXScsIGZ1bmN0aW9uKCkgewoKICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gdW5kZWZpbmVkIGZvciBub25leGlzdGVudCBjb29raWUnLCBmdW5jdGlvbigpIHsKICAgICAgICBleHBlY3QoYnJvd3Nlci5jb29raWVzKCkubm9uZXhpc3RlbnQpLm5vdC50b0JlRGVmaW5lZCgpOwogICAgICB9KTsKCgogICAgICBpdCAoJ3Nob3VsZCByZXR1cm4gYSB2YWx1ZSBmb3IgYW4gZXhpc3RpbmcgY29va2llJywgZnVuY3Rpb24oKSB7CiAgICAgICAgZG9jdW1lbnQuY29va2llID0gImZvbz1iYXI9YmF6O3BhdGg9LyI7CiAgICAgICAgZXhwZWN0KGJyb3dzZXIuY29va2llcygpLmZvbykudG9FcXVhbCgnYmFyPWJheicpOwogICAgICB9KTsKCiAgICAgIGl0KCdzaG91bGQgcmV0dXJuIHRoZSB0aGUgZmlyc3QgdmFsdWUgcHJvdmlkZWQgZm9yIGEgY29va2llJywgZnVuY3Rpb24oKSB7CiAgICAgICAgLy8gRm9yIGEgY29va2llIHRoYXQgaGFzIGRpZmZlcmVudCB2YWx1ZXMgdGhhdCBkaWZmZXIgYnkgcGF0aCwgdGhlCiAgICAgICAgLy8gdmFsdWUgZm9yIHRoZSBtb3N0IHNwZWNpZmljIHBhdGggYXBwZWFycyBmaXJzdC4gIGJyb3dzZXIuY29va2llcygpCiAgICAgICAgLy8gc2hvdWxkIHByb3ZpZGUgdGhhdCB2YWx1ZSBmb3IgdGhlIGNvb2tpZS4KICAgICAgICBkb2N1bWVudC5jb29raWUgPSAnZm9vPSJmaXJzdCI7IGZvbz0ic2Vjb25kIic7CiAgICAgICAgZXhwZWN0KGJyb3dzZXIuY29va2llcygpWydmb28nXSkudG9CZSgnImZpcnN0IicpOwogICAgICB9KTsKCiAgICAgIGl0ICgnc2hvdWxkIGRlY29kZSBjb29raWUgdmFsdWVzIHRoYXQgd2VyZSBlbmNvZGVkIGJ5IHB1dHMnLCBmdW5jdGlvbigpIHsKICAgICAgICBkb2N1bWVudC5jb29raWUgPSAiY29va2llMiUzRGJhciUzQmJhej12YWwlM0R1ZTtwYXRoPS8iOwogICAgICAgIGV4cGVjdChicm93c2VyLmNvb2tpZXMoKVsnY29va2llMj1iYXI7YmF6J10pLnRvRXF1YWwoJ3ZhbD11ZScpOwogICAgICB9KTsKCgogICAgICBpdCgnc2hvdWxkIHByZXNlcnZlIGxlYWRpbmcgJiB0cmFpbGluZyBzcGFjZXMgaW4gbmFtZXMgYW5kIHZhbHVlcycsIGZ1bmN0aW9uKCkgewogICAgICAgIGJyb3dzZXIuY29va2llcygnIGNvb2tpZSBuYW1lICcsICcgY29va2llIHZhbHVlICcpOwogICAgICAgIGV4cGVjdChicm93c2VyLmNvb2tpZXMoKVsnIGNvb2tpZSBuYW1lICddKS50b0VxdWFsKCcgY29va2llIHZhbHVlICcpOwogICAgICAgIGV4cGVjdChicm93c2VyLmNvb2tpZXMoKVsnY29va2llIG5hbWUnXSkubm90LnRvQmVEZWZpbmVkKCk7CiAgICAgIH0pOwoKICAgICAgaXQoJ3Nob3VsZCBkZWNvZGUgc3BlY2lhbCBjaGFyYWN0ZXJzIGluIGNvb2tpZSB2YWx1ZXMnLCBmdW5jdGlvbigpIHsKICAgICAgICBkb2N1bWVudC5jb29raWUgPSAnY29va2llX25hbWU9Y29va2llX3ZhbHVlXyVFMiU4MiVBQyc7CiAgICAgICAgZXhwZWN0KGJyb3dzZXIuY29va2llcygpWydjb29raWVfbmFtZSddKS50b0VxdWFsKCdjb29raWVfdmFsdWVf4oKsJyk7CiAgICAgIH0pOwoKICAgICAgaXQoJ3Nob3VsZCBub3QgZGVjb2RlIGNvb2tpZSB2YWx1ZXMgdGhhdCBkbyBub3QgYXBwZWFyIHRvIGJlIGVuY29kZWQnLCBmdW5jdGlvbigpIHsKICAgICAgICAvLyBzZWUgIzkyMTEgLSBzb21ldGltZXMgY29va2llcyBjb250YWluIGEgdmFsdWUgdGhhdCBjYXVzZXMgZGVjb2RlVVJJQ29tcG9uZW50IHRvIHRocm93CiAgICAgICAgZG9jdW1lbnQuY29va2llID0gJ2Nvb2tpZV9uYW1lPWNvb2tpZV92YWx1ZV8lWFgnOwogICAgICAgIGV4cGVjdChicm93c2VyLmNvb2tpZXMoKVsnY29va2llX25hbWUnXSkudG9FcXVhbCgnY29va2llX3ZhbHVlXyVYWCcpOwogICAgICB9KTsKICAgIH0pOwoKCiAgICBkZXNjcmliZSgnZ2V0QWxsIHZpYSBjb29raWVzKCknLCBmdW5jdGlvbigpIHsKCiAgICAgIGl0KCdzaG91bGQgcmV0dXJuIGNvb2tpZXMgYXMgaGFzaCcsIGZ1bmN0aW9uKCkgewogICAgICAgIGRvY3VtZW50LmNvb2tpZSA9ICJmb28xPWJhcjE7cGF0aD0vIjsKICAgICAgICBkb2N1bWVudC5jb29raWUgPSAiZm9vMj1iYXIyO3BhdGg9LyI7CiAgICAgICAgZXhwZWN0KGJyb3dzZXIuY29va2llcygpKS50b0VxdWFsKHsnZm9vMSc6J2JhcjEnLCAnZm9vMic6J2JhcjInfSk7CiAgICAgIH0pOwoKCiAgICAgIGl0KCdzaG91bGQgcmV0dXJuIGVtcHR5IGhhc2ggaWYgbm8gY29va2llcyBleGlzdCcsIGZ1bmN0aW9uKCkgewogICAgICAgIGV4cGVjdChicm93c2VyLmNvb2tpZXMoKSkudG9FcXVhbCh7fSk7CiAgICAgIH0pOwogICAgfSk7CgoKICAgIGl0KCdzaG91bGQgcGljayB1cCBleHRlcm5hbCBjaGFuZ2VzIG1hZGUgdG8gYnJvd3NlciBjb29raWVzJywgZnVuY3Rpb24oKSB7CiAgICAgIGJyb3dzZXIuY29va2llcygnb2F0bWVhbENvb2tpZScsICdkcm9vbCcpOwogICAgICBleHBlY3QoYnJvd3Nlci5jb29raWVzKCkpLnRvRXF1YWwoeydvYXRtZWFsQ29va2llJzonZHJvb2wnfSk7CgogICAgICBkb2N1bWVudC5jb29raWUgPSAnb2F0bWVhbENvb2tpZT1jaGFuZ2VkO3BhdGg9Lyc7CiAgICAgIGV4cGVjdChicm93c2VyLmNvb2tpZXMoKS5vYXRtZWFsQ29va2llKS50b0VxdWFsKCdjaGFuZ2VkJyk7CiAgICB9KTsKCgogICAgaXQoJ3Nob3VsZCBpbml0aWFsaXplIGNvb2tpZSBjYWNoZSB3aXRoIGV4aXN0aW5nIGNvb2tpZXMnLCBmdW5jdGlvbigpIHsKICAgICAgZG9jdW1lbnQuY29va2llID0gImV4aXN0aW5nQ29va2llPWV4aXN0aW5nVmFsdWU7cGF0aD0vIjsKICAgICAgZXhwZWN0KGJyb3dzZXIuY29va2llcygpKS50b0VxdWFsKHsnZXhpc3RpbmdDb29raWUnOidleGlzdGluZ1ZhbHVlJ30pOwogICAgfSk7CgogIH0pOwoKICBkZXNjcmliZSgncG9sbGVyJywgZnVuY3Rpb24oKSB7CgogICAgaXQoJ3Nob3VsZCBjYWxsIGZ1bmN0aW9ucyBpbiBwb2xsRm5zIGluIHJlZ3VsYXIgaW50ZXJ2YWxzJywgZnVuY3Rpb24oKSB7CiAgICAgIHZhciBsb2cgPSAnJzsKICAgICAgYnJvd3Nlci5hZGRQb2xsRm4oZnVuY3Rpb24oKSB7bG9nKz0nYSc7fSk7CiAgICAgIGJyb3dzZXIuYWRkUG9sbEZuKGZ1bmN0aW9uKCkge2xvZys9J2InO30pOwogICAgICBleHBlY3QobG9nKS50b0VxdWFsKCcnKTsKICAgICAgZmFrZVdpbmRvdy5zZXRUaW1lb3V0LmZsdXNoKCk7CiAgICAgIGV4cGVjdChsb2cpLnRvRXF1YWwoJ2FiJyk7CiAgICAgIGZha2VXaW5kb3cuc2V0VGltZW91dC5mbHVzaCgpOwogICAgICBleHBlY3QobG9nKS50b0VxdWFsKCdhYmFiJyk7CiAgICB9KTsKCiAgICBpdCgnc2hvdWxkIHN0YXJ0UG9sbGVyJywgZnVuY3Rpb24oKSB7CiAgICAgIGV4cGVjdChmYWtlV2luZG93LnRpbWVvdXRzLmxlbmd0aCkudG9FcXVhbCgwKTsKCiAgICAgIGJyb3dzZXIuYWRkUG9sbEZuKGZ1bmN0aW9uKCkge30pOwogICAgICBleHBlY3QoZmFrZVdpbmRvdy50aW1lb3V0cy5sZW5ndGgpLnRvRXF1YWwoMSk7CgogICAgICAvL3Nob3VsZCByZW1haW4gMSBhcyBpdCBpcyB0aGUgY2hlY2sgZm4KICAgICAgYnJvd3Nlci5hZGRQb2xsRm4oZnVuY3Rpb24oKSB7fSk7CiAgICAgIGV4cGVjdChmYWtlV2luZG93LnRpbWVvdXRzLmxlbmd0aCkudG9FcXVhbCgxKTsKICAgIH0pOwoKICAgIGl0KCdzaG91bGQgcmV0dXJuIGZuIHRoYXQgd2FzIHBhc3NlZCBpbnRvIGFkZFBvbGxGbicsIGZ1bmN0aW9uKCkgewogICAgICB2YXIgZm4gPSBmdW5jdGlvbigpIHsgcmV0dXJuIDE7IH07CiAgICAgIHZhciByZXR1cm5lZEZuID0gYnJvd3Nlci5hZGRQb2xsRm4oZm4pOwogICAgICBleHBlY3QocmV0dXJuZWRGbikudG9CZShmbik7CiAgICB9KTsKICB9KTsKCiAgZGVzY3JpYmUoJ3VybCcsIGZ1bmN0aW9uKCkgewogICAgdmFyIHB1c2hTdGF0ZSwgcmVwbGFjZVN0YXRlLCBsb2NhdGlvblJlcGxhY2U7CgogICAgYmVmb3JlRWFjaChmdW5jdGlvbigpIHsKICAgICAgcHVzaFN0YXRlID0gc3B5T24oZmFrZVdpbmRvdy5oaXN0b3J5LCAncHVzaFN0YXRlJyk7CiAgICAgIHJlcGxhY2VTdGF0ZSA9IHNweU9uKGZha2VXaW5kb3cuaGlzdG9yeSwgJ3JlcGxhY2VTdGF0ZScpOwogICAgICBsb2NhdGlvblJlcGxhY2UgPSBzcHlPbihmYWtlV2luZG93LmxvY2F0aW9uLCAncmVwbGFjZScpOwogICAgfSk7CgogICAgaXQoJ3Nob3VsZCByZXR1cm4gY3VycmVudCBsb2NhdGlvbi5ocmVmJywgZnVuY3Rpb24oKSB7CiAgICAgIGZha2VXaW5kb3cubG9jYXRpb24uaHJlZiA9ICdodHRwOi8vdGVzdC5jb20nOwogICAgICBleHBlY3QoYnJvd3Nlci51cmwoKSkudG9FcXVhbCgnaHR0cDovL3Rlc3QuY29tJyk7CgogICAgICBmYWtlV2luZG93LmxvY2F0aW9uLmhyZWYgPSAnaHR0cHM6Ly9hbm90aGVyLmNvbSc7CiAgICAgIGV4cGVjdChicm93c2VyLnVybCgpKS50b0VxdWFsKCdodHRwczovL2Fub3RoZXIuY29tJyk7CiAgICB9KTsKCiAgICBpdCgnc2hvdWxkIHVzZSBoaXN0b3J5LnB1c2hTdGF0ZSB3aGVuIGF2YWlsYWJsZScsIGZ1bmN0aW9uKCkgewogICAgICBzbmlmZmVyLmhpc3RvcnkgPSB0cnVlOwogICAgICBicm93c2VyLnVybCgnaHR0cDovL25ldy5vcmcnKTsKCiAgICAgIGV4cGVjdChwdXNoU3RhdGUpLnRvSGF2ZUJlZW5DYWxsZWRPbmNlKCk7CiAgICAgIGV4cGVjdChwdXNoU3RhdGUuYXJnc0ZvckNhbGxbMF1bMl0pLnRvRXF1YWwoJ2h0dHA6Ly9uZXcub3JnJyk7CgogICAgICBleHBlY3QocmVwbGFjZVN0YXRlKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpOwogICAgICBleHBlY3QobG9jYXRpb25SZXBsYWNlKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpOwogICAgICBleHBlY3QoZmFrZVdpbmRvdy5sb2NhdGlvbi5ocmVmKS50b0VxdWFsKCdodHRwOi8vc2VydmVyLycpOwogICAgfSk7CgogICAgaXQoJ3Nob3VsZCB1c2UgaGlzdG9yeS5yZXBsYWNlU3RhdGUgd2hlbiBhdmFpbGFibGUnLCBmdW5jdGlvbigpIHsKICAgICAgc25pZmZlci5oaXN0b3J5ID0gdHJ1ZTsKICAgICAgYnJvd3Nlci51cmwoJ2h0dHA6Ly9uZXcub3JnJywgdHJ1ZSk7CgogICAgICBleHBlY3QocmVwbGFjZVN0YXRlKS50b0hhdmVCZWVuQ2FsbGVkT25jZSgpOwogICAgICBleHBlY3QocmVwbGFjZVN0YXRlLmFyZ3NGb3JDYWxsWzBdWzJdKS50b0VxdWFsKCdodHRwOi8vbmV3Lm9yZycpOwoKICAgICAgZXhwZWN0KHB1c2hTdGF0ZSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTsKICAgICAgZXhwZWN0KGxvY2F0aW9uUmVwbGFjZSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTsKICAgICAgZXhwZWN0KGZha2VXaW5kb3cubG9jYXRpb24uaHJlZikudG9FcXVhbCgnaHR0cDovL3NlcnZlci8nKTsKICAgIH0pOwoKICAgIGl0KCdzaG91bGQgc2V0IGxvY2F0aW9uLmhyZWYgd2hlbiBwdXNoU3RhdGUgbm90IGF2YWlsYWJsZScsIGZ1bmN0aW9uKCkgewogICAgICBzbmlmZmVyLmhpc3RvcnkgPSBmYWxzZTsKICAgICAgYnJvd3Nlci51cmwoJ2h0dHA6Ly9uZXcub3JnJyk7CgogICAgICBleHBlY3QoZmFrZVdpbmRvdy5sb2NhdGlvbi5ocmVmKS50b0VxdWFsKCdodHRwOi8vbmV3Lm9yZycpOwoKICAgICAgZXhwZWN0KHB1c2hTdGF0ZSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTsKICAgICAgZXhwZWN0KHJlcGxhY2VTdGF0ZSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTsKICAgICAgZXhwZWN0KGxvY2F0aW9uUmVwbGFjZSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTsKICAgIH0pOwoKICAgIGl0KCdzaG91bGQgc2V0IGxvY2F0aW9uLmhyZWYgYW5kIG5vdCB1c2UgcHVzaFN0YXRlIHdoZW4gdGhlIHVybCBvbmx5IGNoYW5nZWQgaW4gdGhlIGhhc2ggZnJhZ21lbnQgdG8gcGxlYXNlIElFMTAvMTEnLCBmdW5jdGlvbigpIHsKICAgICAgc25pZmZlci5oaXN0b3J5ID0gdHJ1ZTsKICAgICAgYnJvd3Nlci51cmwoJ2h0dHA6Ly9zZXJ2ZXIvIzEyMycpOwoKICAgICAgZXhwZWN0KGZha2VXaW5kb3cubG9jYXRpb24uaHJlZikudG9FcXVhbCgnaHR0cDovL3NlcnZlci8jMTIzJyk7CgogICAgICBleHBlY3QocHVzaFN0YXRlKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpOwogICAgICBleHBlY3QocmVwbGFjZVN0YXRlKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpOwogICAgICBleHBlY3QobG9jYXRpb25SZXBsYWNlKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpOwogICAgfSk7CgogICAgaXQoJ3Nob3VsZCB1c2UgbG9jYXRpb24ucmVwbGFjZSB3aGVuIGhpc3RvcnkucmVwbGFjZVN0YXRlIG5vdCBhdmFpbGFibGUnLCBmdW5jdGlvbigpIHsKICAgICAgc25pZmZlci5oaXN0b3J5ID0gZmFsc2U7CiAgICAgIGJyb3dzZXIudXJsKCdodHRwOi8vbmV3Lm9yZycsIHRydWUpOwoKICAgICAgZXhwZWN0KGxvY2F0aW9uUmVwbGFjZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2h0dHA6Ly9uZXcub3JnJyk7CgogICAgICBleHBlY3QocHVzaFN0YXRlKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpOwogICAgICBleHBlY3QocmVwbGFjZVN0YXRlKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpOwogICAgICBleHBlY3QoZmFrZVdpbmRvdy5sb2NhdGlvbi5ocmVmKS50b0VxdWFsKCdodHRwOi8vc2VydmVyLycpOwogICAgfSk7CgogICAgaXQoJ3Nob3VsZCB1c2UgbG9jYXRpb24ucmVwbGFjZSBhbmQgbm90IHVzZSByZXBsYWNlU3RhdGUgd2hlbiB0aGUgdXJsIG9ubHkgY2hhbmdlZCBpbiB0aGUgaGFzaCBmcmFnbWVudCB0byBwbGVhc2UgSUUxMC8xMScsIGZ1bmN0aW9uKCkgewogICAgICBzbmlmZmVyLmhpc3RvcnkgPSB0cnVlOwogICAgICBicm93c2VyLnVybCgnaHR0cDovL3NlcnZlci8jMTIzJywgdHJ1ZSk7CgogICAgICBleHBlY3QobG9jYXRpb25SZXBsYWNlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnaHR0cDovL3NlcnZlci8jMTIzJyk7CgogICAgICBleHBlY3QocHVzaFN0YXRlKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpOwogICAgICBleHBlY3QocmVwbGFjZVN0YXRlKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpOwogICAgICBleHBlY3QoZmFrZVdpbmRvdy5sb2NhdGlvbi5ocmVmKS50b0VxdWFsKCdodHRwOi8vc2VydmVyLycpOwogICAgfSk7CgogICAgaXQoJ3Nob3VsZCByZXR1cm4gJGJyb3dzZXIgdG8gYWxsb3cgY2hhaW5pbmcnLCBmdW5jdGlvbigpIHsKICAgICAgZXhwZWN0KGJyb3dzZXIudXJsKCdodHRwOi8vYW55LmNvbScpKS50b0JlKGJyb3dzZXIpOwogICAgfSk7CgoKICAgIGl0KCdzaG91bGQgZGVjb2RlIHNpbmdsZSBxdW90ZXMgdG8gd29yayBhcm91bmQgRkYgYnVnIDQwNzI3MycsIGZ1bmN0aW9uKCkgewogICAgICBmYWtlV2luZG93LmxvY2F0aW9uLmhyZWYgPSAiaHR0cDovL2ZmLWJ1Zy8/c2luZ2xlJTI3cXVvdGUiOwogICAgICBleHBlY3QoYnJvd3Nlci51cmwoKSkudG9CZSgiaHR0cDovL2ZmLWJ1Zy8/c2luZ2xlJ3F1b3RlIik7CiAgICB9KTsKCiAgICBpdCgnc2hvdWxkIG5vdCBzZXQgVVJMIHdoZW4gdGhlIFVSTCBpcyBhbHJlYWR5IHNldCcsIGZ1bmN0aW9uKCkgewogICAgICB2YXIgY3VycmVudCA9IGZha2VXaW5kb3cubG9jYXRpb24uaHJlZjsKICAgICAgc25pZmZlci5oaXN0b3J5ID0gZmFsc2U7CiAgICAgIGZha2VXaW5kb3cubG9jYXRpb24uaHJlZiA9ICdkb250Y2hhbmdlJzsKICAgICAgYnJvd3Nlci51cmwoY3VycmVudCk7CiAgICAgIGV4cGVjdChmYWtlV2luZG93LmxvY2F0aW9uLmhyZWYpLnRvQmUoJ2RvbnRjaGFuZ2UnKTsKICAgIH0pOwoKICAgIGl0KCdzaG91bGQgbm90IHJlYWQgb3V0IGxvY2F0aW9uLmhyZWYgaWYgYSByZWxvYWQgd2FzIHRyaWdnZXJlZCBidXQgc3RpbGwgYWxsb3cgdG8gY2hhbmdlIHRoZSB1cmwnLCBmdW5jdGlvbigpIHsKICAgICAgc25pZmZlci5oaXN0b3J5ID0gZmFsc2U7CiAgICAgIGJyb3dzZXIudXJsKCdodHRwOi8vc2VydmVyL3NvbWVPdGhlclVybFRoYXRDYXVzZXNSZWxvYWQnKTsKICAgICAgZXhwZWN0KGZha2VXaW5kb3cubG9jYXRpb24uaHJlZikudG9CZSgnaHR0cDovL3NlcnZlci9zb21lT3RoZXJVcmxUaGF0Q2F1c2VzUmVsb2FkJyk7CgogICAgICBmYWtlV2luZG93LmxvY2F0aW9uLmhyZWYgPSAnaHR0cDovL3NvbWVOZXdVcmwnOwogICAgICBleHBlY3QoYnJvd3Nlci51cmwoKSkudG9CZSgnaHR0cDovL3NlcnZlci9zb21lT3RoZXJVcmxUaGF0Q2F1c2VzUmVsb2FkJyk7CgogICAgICBicm93c2VyLnVybCgnaHR0cDovL3NlcnZlci9zb21lT3RoZXJVcmwnKTsKICAgICAgZXhwZWN0KGJyb3dzZXIudXJsKCkpLnRvQmUoJ2h0dHA6Ly9zZXJ2ZXIvc29tZU90aGVyVXJsJyk7CiAgICAgIGV4cGVjdChmYWtlV2luZG93LmxvY2F0aW9uLmhyZWYpLnRvQmUoJ2h0dHA6Ly9zZXJ2ZXIvc29tZU90aGVyVXJsJyk7CiAgICB9KTsKCiAgICBpdCgnYXNzdW1lcyB0aGF0IGNoYW5nZXMgdG8gbG9jYXRpb24uaGFzaCBvY2N1ciBpbiBzeW5jJywgZnVuY3Rpb24oKSB7CiAgICAgIC8vIFRoaXMgaXMgYW4gYXN5bmNocm9ub3VzIGludGVncmF0aW9uIHRlc3QgdGhhdCBjaGFuZ2VzIHRoZQogICAgICAvLyBoYXNoIGluIGFsbCBwb3NzaWJsZSB3YXlzIGFuZCBjaGVja3MKICAgICAgLy8gLSB3aGV0aGVyIHRoZSBjaGFuZ2UgdG8gdGhlIGhhc2ggY2FuIGJlIHJlYWQgb3V0IGluIHN5bmMKICAgICAgLy8gLSB3aGV0aGVyIHRoZSBjaGFuZ2UgdG8gdGhlIGhhc2ggY2FuIGJlIHJlYWQgb3V0IGluIHRoZSBoYXNoY2hhbmdlIGV2ZW50CiAgICAgIHZhciByZWFsV2luID0gd2luZG93LAogICAgICAgICAgJHJlYWxXaW4gPSBqcUxpdGUocmVhbFdpbiksCiAgICAgICAgICBoYXNoSW5IYXNoQ2hhbmdlRXZlbnQgPSBbXTsKCiAgICAgIHJ1bnMoZnVuY3Rpb24oKSB7CiAgICAgICAgJHJlYWxXaW4ub24oJ2hhc2hjaGFuZ2UnLCBoYXNoTGlzdGVuZXIpOwoKICAgICAgICByZWFsV2luLmxvY2F0aW9uLmhhc2ggPSAnMSc7CiAgICAgICAgcmVhbFdpbi5sb2NhdGlvbi5ocmVmICs9ICcyJzsKICAgICAgICByZWFsV2luLmxvY2F0aW9uLnJlcGxhY2UocmVhbFdpbi5sb2NhdGlvbi5ocmVmICsgJzMnKTsKICAgICAgICByZWFsV2luLmxvY2F0aW9uLmFzc2lnbihyZWFsV2luLmxvY2F0aW9uLmhyZWYgKyAnNCcpOwoKICAgICAgICBleHBlY3QocmVhbFdpbi5sb2NhdGlvbi5oYXNoKS50b0JlKCcjMTIzNCcpOwogICAgICB9KTsKICAgICAgd2FpdHNGb3IoZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIGhhc2hJbkhhc2hDaGFuZ2VFdmVudC5sZW5ndGggPiAzOwogICAgICB9KTsKICAgICAgcnVucyhmdW5jdGlvbigpIHsKICAgICAgICAkcmVhbFdpbi5vZmYoJ2hhc2hjaGFuZ2UnLCBoYXNoTGlzdGVuZXIpOwoKICAgICAgICBmb3JFYWNoKGhhc2hJbkhhc2hDaGFuZ2VFdmVudCwgZnVuY3Rpb24oaGFzaCkgewogICAgICAgICAgZXhwZWN0KGhhc2gpLnRvQmUoJyMxMjM0Jyk7CiAgICAgICAgfSk7CiAgICAgIH0pOwoKICAgICAgZnVuY3Rpb24gaGFzaExpc3RlbmVyKCkgewogICAgICAgIGhhc2hJbkhhc2hDaGFuZ2VFdmVudC5wdXNoKHJlYWxXaW4ubG9jYXRpb24uaGFzaCk7CiAgICAgIH0KICAgIH0pOwoKICB9KTsKCiAgZGVzY3JpYmUoJ3VybCAod2hlbiBzdGF0ZSBwYXNzZWQpJywgZnVuY3Rpb24oKSB7CiAgICB2YXIgY3VycmVudEhyZWY7CgogICAgYmVmb3JlRWFjaChmdW5jdGlvbigpIHsKICAgICAgc25pZmZlciA9IHtoaXN0b3J5OiB0cnVlfTsKICAgICAgY3VycmVudEhyZWYgPSBmYWtlV2luZG93LmxvY2F0aW9uLmhyZWY7CiAgICB9KTsKCiAgICBpdCgnc2hvdWxkIGNoYW5nZSBzdGF0ZScsIGZ1bmN0aW9uKCkgewogICAgICBicm93c2VyLnVybChjdXJyZW50SHJlZiArICcvc29tZXRoaW5nJywgZmFsc2UsIHtwcm9wOiAndmFsMSd9KTsKICAgICAgZXhwZWN0KGZha2VXaW5kb3cuaGlzdG9yeS5zdGF0ZSkudG9FcXVhbCh7cHJvcDogJ3ZhbDEnfSk7CiAgICB9KTsKCiAgICBpdCgnc2hvdWxkIGFsbG93IHRvIHNldCBmYWxzeSBzdGF0ZXMgKGV4Y2VwdCBgdW5kZWZpbmVkYCknLCBmdW5jdGlvbigpIHsKICAgICAgZmFrZVdpbmRvdy5oaXN0b3J5LnN0YXRlID0ge3Byb3A6ICd2YWwxJ307CgogICAgICBicm93c2VyLnVybChjdXJyZW50SHJlZiwgZmFsc2UsIG51bGwpOwogICAgICBleHBlY3QoZmFrZVdpbmRvdy5oaXN0b3J5LnN0YXRlKS50b0JlKG51bGwpOwoKICAgICAgYnJvd3Nlci51cmwoY3VycmVudEhyZWYsIGZhbHNlLCBmYWxzZSk7CiAgICAgIGV4cGVjdChmYWtlV2luZG93Lmhpc3Rvcnkuc3RhdGUpLnRvQmUoZmFsc2UpOwoKICAgICAgYnJvd3Nlci51cmwoY3VycmVudEhyZWYsIGZhbHNlLCAnJyk7CiAgICAgIGV4cGVjdChmYWtlV2luZG93Lmhpc3Rvcnkuc3RhdGUpLnRvQmUoJycpOwoKICAgICAgYnJvd3Nlci51cmwoY3VycmVudEhyZWYsIGZhbHNlLCAwKTsKICAgICAgZXhwZWN0KGZha2VXaW5kb3cuaGlzdG9yeS5zdGF0ZSkudG9CZSgwKTsKICAgIH0pOwoKICAgIGl0KCdzaG91bGQgdHJlYXQgYHVuZGVmaW5lZGAgc3RhdGUgYXMgYG51bGxgJywgZnVuY3Rpb24oKSB7CiAgICAgIGZha2VXaW5kb3cuaGlzdG9yeS5zdGF0ZSA9IHtwcm9wOiAndmFsMSd9OwoKICAgICAgYnJvd3Nlci51cmwoY3VycmVudEhyZWYsIGZhbHNlLCB1bmRlZmluZWQpOwogICAgICBleHBlY3QoZmFrZVdpbmRvdy5oaXN0b3J5LnN0YXRlKS50b0JlKG51bGwpOwogICAgfSk7CgogICAgaXQoJ3Nob3VsZCBkbyBwdXNoU3RhdGUgd2l0aCB0aGUgc2FtZSBVUkwgYW5kIGEgZGlmZmVyZW50IHN0YXRlJywgZnVuY3Rpb24oKSB7CiAgICAgIGJyb3dzZXIudXJsKGN1cnJlbnRIcmVmLCBmYWxzZSwge3Byb3A6ICd2YWwxJ30pOwogICAgICBleHBlY3QoZmFrZVdpbmRvdy5oaXN0b3J5LnN0YXRlKS50b0VxdWFsKHtwcm9wOiAndmFsMSd9KTsKCiAgICAgIGJyb3dzZXIudXJsKGN1cnJlbnRIcmVmLCBmYWxzZSwgbnVsbCk7CiAgICAgIGV4cGVjdChmYWtlV2luZG93Lmhpc3Rvcnkuc3RhdGUpLnRvQmUobnVsbCk7CgogICAgICBicm93c2VyLnVybChjdXJyZW50SHJlZiwgZmFsc2UsIHtwcm9wOiAndmFsMid9KTsKICAgICAgYnJvd3Nlci51cmwoY3VycmVudEhyZWYsIGZhbHNlLCB7cHJvcDogJ3ZhbDMnfSk7CiAgICAgIGV4cGVjdChmYWtlV2luZG93Lmhpc3Rvcnkuc3RhdGUpLnRvRXF1YWwoe3Byb3A6ICd2YWwzJ30pOwogICAgfSk7CgogICAgaXQoJ3Nob3VsZCBkbyBwdXNoU3RhdGUgd2l0aCB0aGUgc2FtZSBVUkwgYW5kIG51bGwgc3RhdGUnLCBmdW5jdGlvbigpIHsKICAgICAgZmFrZVdpbmRvdy5oaXN0b3J5LnN0YXRlID0ge3Byb3A6ICd2YWwxJ307CiAgICAgIGJyb3dzZXIudXJsKGN1cnJlbnRIcmVmLCBmYWxzZSwgbnVsbCk7CiAgICAgIGV4cGVjdChmYWtlV2luZG93Lmhpc3Rvcnkuc3RhdGUpLnRvRXF1YWwobnVsbCk7CiAgICB9KTsKCiAgICBpdCgnc2hvdWxkIGRvIHB1c2hTdGF0ZSB3aXRoIHRoZSBzYW1lIFVSTCBhbmQgdGhlIHNhbWUgbm9uLW51bGwgc3RhdGUnLCBmdW5jdGlvbigpIHsKICAgICAgYnJvd3Nlci51cmwoY3VycmVudEhyZWYsIGZhbHNlLCB7cHJvcDogJ3ZhbDInfSk7CiAgICAgIGZha2VXaW5kb3cuaGlzdG9yeS5zdGF0ZSA9IHtwcm9wOiAndmFsMyd9OwogICAgICBicm93c2VyLnVybChjdXJyZW50SHJlZiwgZmFsc2UsIHtwcm9wOiAndmFsMid9KTsKICAgICAgZXhwZWN0KGZha2VXaW5kb3cuaGlzdG9yeS5zdGF0ZSkudG9FcXVhbCh7cHJvcDogJ3ZhbDInfSk7CiAgICB9KTsKICB9KTsKCiAgZGVzY3JpYmUoJ3VybENoYW5nZScsIGZ1bmN0aW9uKCkgewogICAgdmFyIGNhbGxiYWNrOwoKICAgIGJlZm9yZUVhY2goZnVuY3Rpb24oKSB7CiAgICAgIGNhbGxiYWNrID0gamFzbWluZS5jcmVhdGVTcHkoJ29uVXJsQ2hhbmdlJyk7CiAgICB9KTsKCiAgICBhZnRlckVhY2goZnVuY3Rpb24oKSB7CiAgICAgIGlmICghalF1ZXJ5KSBqcUxpdGVEZWFsb2MoZmFrZVdpbmRvdyk7CiAgICB9KTsKCiAgICBpdCgnc2hvdWxkIHJldHVybiByZWdpc3RlcmVkIGNhbGxiYWNrJywgZnVuY3Rpb24oKSB7CiAgICAgIGV4cGVjdChicm93c2VyLm9uVXJsQ2hhbmdlKGNhbGxiYWNrKSkudG9CZShjYWxsYmFjayk7CiAgICB9KTsKCiAgICBpdCgnc2hvdWxkIGZvcndhcmQgcG9wc3RhdGUgZXZlbnQgd2l0aCBuZXcgdXJsIHdoZW4gaGlzdG9yeSBzdXBwb3J0ZWQnLCBmdW5jdGlvbigpIHsKICAgICAgc25pZmZlci5oaXN0b3J5ID0gdHJ1ZTsKICAgICAgYnJvd3Nlci5vblVybENoYW5nZShjYWxsYmFjayk7CiAgICAgIGZha2VXaW5kb3cubG9jYXRpb24uaHJlZiA9ICdodHRwOi8vc2VydmVyL25ldyc7CgogICAgICBmYWtlV2luZG93LmZpcmUoJ3BvcHN0YXRlJyk7CiAgICAgIGV4cGVjdChjYWxsYmFjaykudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2h0dHA6Ly9zZXJ2ZXIvbmV3JywgbnVsbCk7CgogICAgICBmYWtlV2luZG93LmZpcmUoJ2hhc2hjaGFuZ2UnKTsKICAgICAgZmFrZVdpbmRvdy5zZXRUaW1lb3V0LmZsdXNoKCk7CiAgICAgIGV4cGVjdChjYWxsYmFjaykudG9IYXZlQmVlbkNhbGxlZE9uY2UoKTsKICAgIH0pOwoKICAgIGl0KCdzaG91bGQgZm9yd2FyZCBvbmx5IHBvcHN0YXRlIGV2ZW50IHdoZW4gaGlzdG9yeSBzdXBwb3J0ZWQnLCBmdW5jdGlvbigpIHsKICAgICAgc25pZmZlci5oaXN0b3J5ID0gdHJ1ZTsKICAgICAgYnJvd3Nlci5vblVybENoYW5nZShjYWxsYmFjayk7CiAgICAgIGZha2VXaW5kb3cubG9jYXRpb24uaHJlZiA9ICdodHRwOi8vc2VydmVyL25ldyc7CgogICAgICBmYWtlV2luZG93LmZpcmUoJ3BvcHN0YXRlJyk7CiAgICAgIGV4cGVjdChjYWxsYmFjaykudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2h0dHA6Ly9zZXJ2ZXIvbmV3JywgbnVsbCk7CgogICAgICBmYWtlV2luZG93LmZpcmUoJ2hhc2hjaGFuZ2UnKTsKICAgICAgZmFrZVdpbmRvdy5zZXRUaW1lb3V0LmZsdXNoKCk7CiAgICAgIGV4cGVjdChjYWxsYmFjaykudG9IYXZlQmVlbkNhbGxlZE9uY2UoKTsKICAgIH0pOwoKICAgIGl0KCdzaG91bGQgZm9yd2FyZCBoYXNoY2hhbmdlIGV2ZW50IHdpdGggbmV3IHVybCB3aGVuIGhpc3Rvcnkgbm90IHN1cHBvcnRlZCcsIGZ1bmN0aW9uKCkgewogICAgICBzbmlmZmVyLmhpc3RvcnkgPSBmYWxzZTsKICAgICAgYnJvd3Nlci5vblVybENoYW5nZShjYWxsYmFjayk7CiAgICAgIGZha2VXaW5kb3cubG9jYXRpb24uaHJlZiA9ICdodHRwOi8vc2VydmVyL25ldyc7CgogICAgICBmYWtlV2luZG93LmZpcmUoJ2hhc2hjaGFuZ2UnKTsKICAgICAgZXhwZWN0KGNhbGxiYWNrKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnaHR0cDovL3NlcnZlci9uZXcnLCBudWxsKTsKCiAgICAgIGZha2VXaW5kb3cuZmlyZSgncG9wc3RhdGUnKTsKICAgICAgZmFrZVdpbmRvdy5zZXRUaW1lb3V0LmZsdXNoKCk7CiAgICAgIGV4cGVjdChjYWxsYmFjaykudG9IYXZlQmVlbkNhbGxlZE9uY2UoKTsKICAgIH0pOwoKICAgIGl0KCdzaG91bGQgbm90IGZpcmUgdXJsQ2hhbmdlIGlmIGNoYW5nZWQgYnkgYnJvd3Nlci51cmwgbWV0aG9kJywgZnVuY3Rpb24oKSB7CiAgICAgIHNuaWZmZXIuaGlzdG9yeSA9IGZhbHNlOwogICAgICBicm93c2VyLm9uVXJsQ2hhbmdlKGNhbGxiYWNrKTsKICAgICAgYnJvd3Nlci51cmwoJ2h0dHA6Ly9uZXcuY29tJyk7CgogICAgICBmYWtlV2luZG93LmZpcmUoJ2hhc2hjaGFuZ2UnKTsKICAgICAgZXhwZWN0KGNhbGxiYWNrKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpOwogICAgfSk7CiAgfSk7CgoKICBkZXNjcmliZSgnYmFzZUhyZWYnLCBmdW5jdGlvbigpIHsKICAgIHZhciBqcURvY0hlYWQ7CgogICAgYmVmb3JlRWFjaChmdW5jdGlvbigpIHsKICAgICAganFEb2NIZWFkID0ganFMaXRlKGRvY3VtZW50KS5maW5kKCdoZWFkJyk7CiAgICB9KTsKCiAgICBpdCgnc2hvdWxkIHJldHVybiB2YWx1ZSBmcm9tIDxiYXNlIGhyZWY+JywgZnVuY3Rpb24oKSB7CiAgICAgIGZha2VEb2N1bWVudC5iYXNlUGF0aCA9ICcvYmFzZS9wYXRoLyc7CiAgICAgIGV4cGVjdChicm93c2VyLmJhc2VIcmVmKCkpLnRvRXF1YWwoJy9iYXNlL3BhdGgvJyk7CiAgICB9KTsKCiAgICBpdCgnc2hvdWxkIHJldHVybiBcJ1wnIChlbXB0eSBzdHJpbmcpIGlmIG5vIDxiYXNlIGhyZWY+JywgZnVuY3Rpb24oKSB7CiAgICAgIGZha2VEb2N1bWVudC5iYXNlUGF0aCA9IHVuZGVmaW5lZDsKICAgICAgZXhwZWN0KGJyb3dzZXIuYmFzZUhyZWYoKSkudG9FcXVhbCgnJyk7CiAgICB9KTsKCiAgICBpdCgnc2hvdWxkIHJlbW92ZSBkb21haW4gZnJvbSA8YmFzZSBocmVmPicsIGZ1bmN0aW9uKCkgewogICAgICBmYWtlRG9jdW1lbnQuYmFzZVBhdGggPSAnaHR0cDovL2hvc3QuY29tL2Jhc2UvcGF0aC8nOwogICAgICBleHBlY3QoYnJvd3Nlci5iYXNlSHJlZigpKS50b0VxdWFsKCcvYmFzZS9wYXRoLycpOwoKICAgICAgZmFrZURvY3VtZW50LmJhc2VQYXRoID0gJ2h0dHA6Ly9ob3N0LmNvbS9iYXNlL3BhdGgvaW5kZXguaHRtbCc7CiAgICAgIGV4cGVjdChicm93c2VyLmJhc2VIcmVmKCkpLnRvRXF1YWwoJy9iYXNlL3BhdGgvaW5kZXguaHRtbCcpOwogICAgfSk7CgogICAgaXQoJ3Nob3VsZCByZW1vdmUgZG9tYWluIGZyb20gPGJhc2UgaHJlZj4gYmVnaW5uaW5nIHdpdGggXCcvL1wnJywgZnVuY3Rpb24oKSB7CiAgICAgIGZha2VEb2N1bWVudC5iYXNlUGF0aCA9ICcvL2dvb2dsZS5jb20vYmFzZS9wYXRoLyc7CiAgICAgIGV4cGVjdChicm93c2VyLmJhc2VIcmVmKCkpLnRvRXF1YWwoJy9iYXNlL3BhdGgvJyk7CiAgICB9KTsKICB9KTsKCiAgZGVzY3JpYmUoJ2ludGVncmF0aW9uIHRlc3RzIHdpdGggJGxvY2F0aW9uJywgZnVuY3Rpb24oKSB7CgogICAgZnVuY3Rpb24gc2V0dXAob3B0aW9ucykgewogICAgICBtb2R1bGUoZnVuY3Rpb24oJHByb3ZpZGUsICRsb2NhdGlvblByb3ZpZGVyKSB7CiAgICAgICAgc3B5T24oZmFrZVdpbmRvdy5oaXN0b3J5LCAncHVzaFN0YXRlJykuYW5kQ2FsbEZha2UoZnVuY3Rpb24oc3RhdGVPYmosIHRpdGxlLCBuZXdVcmwpIHsKICAgICAgICAgIGZha2VXaW5kb3cubG9jYXRpb24uaHJlZiA9IG5ld1VybDsKICAgICAgICB9KTsKICAgICAgICBzcHlPbihmYWtlV2luZG93LmxvY2F0aW9uLCAncmVwbGFjZScpLmFuZENhbGxGYWtlKGZ1bmN0aW9uKG5ld1VybCkgewogICAgICAgICAgZmFrZVdpbmRvdy5sb2NhdGlvbi5ocmVmID0gbmV3VXJsOwogICAgICAgIH0pOwogICAgICAgICRwcm92aWRlLnZhbHVlKCckYnJvd3NlcicsIGJyb3dzZXIpOwogICAgICAgIGJyb3dzZXIucG9sbEZucyA9IFtdOwoKICAgICAgICBzbmlmZmVyLmhpc3RvcnkgPSBvcHRpb25zLmhpc3Rvcnk7CiAgICAgICAgJHByb3ZpZGUudmFsdWUoJyRzbmlmZmVyJywgc25pZmZlcik7CgogICAgICAgICRsb2NhdGlvblByb3ZpZGVyLmh0bWw1TW9kZShvcHRpb25zLmh0bWw1TW9kZSk7CiAgICAgIH0pOwogICAgfQoKICAgIGRlc2NyaWJlKCd1cGRhdGUgJGxvY2F0aW9uIHdoZW4gaXQgd2FzIGNoYW5nZWQgb3V0c2lkZSBvZiBBbmd1bGFyIGluIHN5bmMgJysKICAgICAgICdiZWZvcmUgJGRpZ2VzdCB3YXMgY2FsbGVkJywgZnVuY3Rpb24oKSB7CgogICAgICBpdCgnc2hvdWxkIHdvcmsgd2l0aCBubyBoaXN0b3J5IHN1cHBvcnQsIG5vIGh0bWw1TW9kZScsIGZ1bmN0aW9uKCkgewogICAgICAgIHNldHVwKHsKICAgICAgICAgIGhpc3Rvcnk6IGZhbHNlLAogICAgICAgICAgaHRtbDVNb2RlOiBmYWxzZQogICAgICAgIH0pOwogICAgICAgIGluamVjdChmdW5jdGlvbigkcm9vdFNjb3BlLCAkbG9jYXRpb24pIHsKICAgICAgICAgICRyb290U2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2luaXRpYWxQYXRoJyk7CiAgICAgICAgICB9KTsKICAgICAgICAgIGV4cGVjdChmYWtlV2luZG93LmxvY2F0aW9uLmhyZWYpLnRvQmUoJ2h0dHA6Ly9zZXJ2ZXIvIy9pbml0aWFsUGF0aCcpOwoKICAgICAgICAgIGZha2VXaW5kb3cubG9jYXRpb24uaHJlZiA9ICdodHRwOi8vc2VydmVyLyMvc29tZVRlc3RIYXNoJzsKCiAgICAgICAgICAkcm9vdFNjb3BlLiRkaWdlc3QoKTsKCiAgICAgICAgICBleHBlY3QoJGxvY2F0aW9uLnBhdGgoKSkudG9CZSgnL3NvbWVUZXN0SGFzaCcpOwogICAgICAgIH0pOwogICAgICB9KTsKCiAgICAgIGl0KCdzaG91bGQgd29yayB3aXRoIGhpc3Rvcnkgc3VwcG9ydCwgbm8gaHRtbDVNb2RlJywgZnVuY3Rpb24oKSB7CiAgICAgICAgc2V0dXAoewogICAgICAgICAgaGlzdG9yeTogdHJ1ZSwKICAgICAgICAgIGh0bWw1TW9kZTogZmFsc2UKICAgICAgICB9KTsKICAgICAgICBpbmplY3QoZnVuY3Rpb24oJHJvb3RTY29wZSwgJGxvY2F0aW9uKSB7CiAgICAgICAgICAkcm9vdFNjb3BlLiRhcHBseShmdW5jdGlvbigpIHsKICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9pbml0aWFsUGF0aCcpOwogICAgICAgICAgfSk7CiAgICAgICAgICBleHBlY3QoZmFrZVdpbmRvdy5sb2NhdGlvbi5ocmVmKS50b0JlKCdodHRwOi8vc2VydmVyLyMvaW5pdGlhbFBhdGgnKTsKCiAgICAgICAgICBmYWtlV2luZG93LmxvY2F0aW9uLmhyZWYgPSAnaHR0cDovL3NlcnZlci8jL3NvbWVUZXN0SGFzaCc7CgogICAgICAgICAgJHJvb3RTY29wZS4kZGlnZXN0KCk7CgogICAgICAgICAgZXhwZWN0KCRsb2NhdGlvbi5wYXRoKCkpLnRvQmUoJy9zb21lVGVzdEhhc2gnKTsKICAgICAgICB9KTsKICAgICAgfSk7CgogICAgICBpdCgnc2hvdWxkIHdvcmsgd2l0aCBubyBoaXN0b3J5IHN1cHBvcnQsIHdpdGggaHRtbDVNb2RlJywgZnVuY3Rpb24oKSB7CiAgICAgICAgc2V0dXAoewogICAgICAgICAgaGlzdG9yeTogZmFsc2UsCiAgICAgICAgICBodG1sNU1vZGU6IHRydWUKICAgICAgICB9KTsKICAgICAgICBpbmplY3QoZnVuY3Rpb24oJHJvb3RTY29wZSwgJGxvY2F0aW9uKSB7CiAgICAgICAgICAkcm9vdFNjb3BlLiRhcHBseShmdW5jdGlvbigpIHsKICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9pbml0aWFsUGF0aCcpOwogICAgICAgICAgfSk7CiAgICAgICAgICBleHBlY3QoZmFrZVdpbmRvdy5sb2NhdGlvbi5ocmVmKS50b0JlKCdodHRwOi8vc2VydmVyLyMvaW5pdGlhbFBhdGgnKTsKCiAgICAgICAgICBmYWtlV2luZG93LmxvY2F0aW9uLmhyZWYgPSAnaHR0cDovL3NlcnZlci8jL3NvbWVUZXN0SGFzaCc7CgogICAgICAgICAgJHJvb3RTY29wZS4kZGlnZXN0KCk7CgogICAgICAgICAgZXhwZWN0KCRsb2NhdGlvbi5wYXRoKCkpLnRvQmUoJy9zb21lVGVzdEhhc2gnKTsKICAgICAgICB9KTsKICAgICAgfSk7CgogICAgICBpdCgnc2hvdWxkIHdvcmsgd2l0aCBoaXN0b3J5IHN1cHBvcnQsIHdpdGggaHRtbDVNb2RlJywgZnVuY3Rpb24oKSB7CiAgICAgICAgc2V0dXAoewogICAgICAgICAgaGlzdG9yeTogdHJ1ZSwKICAgICAgICAgIGh0bWw1TW9kZTogdHJ1ZQogICAgICAgIH0pOwogICAgICAgIGluamVjdChmdW5jdGlvbigkcm9vdFNjb3BlLCAkbG9jYXRpb24pIHsKICAgICAgICAgICRyb290U2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2luaXRpYWxQYXRoJyk7CiAgICAgICAgICB9KTsKICAgICAgICAgIGV4cGVjdChmYWtlV2luZG93LmxvY2F0aW9uLmhyZWYpLnRvQmUoJ2h0dHA6Ly9zZXJ2ZXIvaW5pdGlhbFBhdGgnKTsKCiAgICAgICAgICBmYWtlV2luZG93LmxvY2F0aW9uLmhyZWYgPSAnaHR0cDovL3NlcnZlci9zb21lVGVzdEhhc2gnOwoKICAgICAgICAgICRyb290U2NvcGUuJGRpZ2VzdCgpOwoKICAgICAgICAgIGV4cGVjdCgkbG9jYXRpb24ucGF0aCgpKS50b0JlKCcvc29tZVRlc3RIYXNoJyk7CiAgICAgICAgfSk7CiAgICAgIH0pOwoKICAgIH0pOwoKICAgIGl0KCdzaG91bGQgbm90IHJlbG9hZCB0aGUgcGFnZSBvbiBldmVyeSAkZGlnZXN0IHdoZW4gdGhlIHBhZ2Ugd2lsbCBiZSByZWxvYWRlZCBkdWUgdG8gdXJsIHJld3JpdGUgb24gbG9hZCcsIGZ1bmN0aW9uKCkgewogICAgICBzZXR1cCh7CiAgICAgICAgaGlzdG9yeTogZmFsc2UsCiAgICAgICAgaHRtbDVNb2RlOiB0cnVlCiAgICAgIH0pOwogICAgICBmYWtlV2luZG93LmxvY2F0aW9uLmhyZWYgPSAnaHR0cDovL3NlcnZlci9zb21lL2RlZXAvcGF0aCc7CiAgICAgIHZhciBjaGFuZ2VVcmxDb3VudCA9IDA7CiAgICAgIHZhciBfdXJsID0gYnJvd3Nlci51cmw7CiAgICAgIGJyb3dzZXIudXJsID0gZnVuY3Rpb24obmV3VXJsLCByZXBsYWNlLCBzdGF0ZSkgewogICAgICAgIGlmIChuZXdVcmwpIHsKICAgICAgICAgIGNoYW5nZVVybENvdW50Kys7CiAgICAgICAgfQogICAgICAgIHJldHVybiBfdXJsLmNhbGwodGhpcywgbmV3VXJsLCByZXBsYWNlKTsKICAgICAgfTsKICAgICAgc3B5T24oYnJvd3NlciwgJ3VybCcpLmFuZENhbGxUaHJvdWdoKCk7CiAgICAgIGluamVjdChmdW5jdGlvbigkcm9vdFNjb3BlLCAkbG9jYXRpb24pIHsKICAgICAgICAkcm9vdFNjb3BlLiRkaWdlc3QoKTsKICAgICAgICAkcm9vdFNjb3BlLiRkaWdlc3QoKTsKICAgICAgICAkcm9vdFNjb3BlLiRkaWdlc3QoKTsKICAgICAgICAkcm9vdFNjb3BlLiRkaWdlc3QoKTsKCiAgICAgICAgLy8gZnJvbSAkbG9jYXRpb24gZm9yIHJld3JpdGluZyB0aGUgaW5pdGlhbCB1cmwgaW50byBhIGhhc2ggdXJsCiAgICAgICAgZXhwZWN0KGJyb3dzZXIudXJsKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnaHR0cDovL3NlcnZlci8jL3NvbWUvZGVlcC9wYXRoJywgdHJ1ZSk7CiAgICAgICAgLy8gZnJvbSB0aGUgaW5pdGlhbCBjYWxsIHRvIHRoZSB3YXRjaCBpbiAkbG9jYXRpb24gZm9yIHdhdGNoaW5nICRsb2NhdGlvbgogICAgICAgIGV4cGVjdChicm93c2VyLnVybCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2h0dHA6Ly9zZXJ2ZXIvIy9zb21lL2RlZXAvcGF0aCcsIGZhbHNlLCBudWxsKTsKICAgICAgICBleHBlY3QoY2hhbmdlVXJsQ291bnQpLnRvQmUoMik7CiAgICAgIH0pOwoKICAgIH0pOwogIH0pOwoKICBkZXNjcmliZSgnaW50ZWdyYXRpb24gdGVzdCB3aXRoICRyb290U2NvcGUnLCBmdW5jdGlvbigpIHsKCiAgICBiZWZvcmVFYWNoKG1vZHVsZShmdW5jdGlvbigkcHJvdmlkZSwgJGxvY2F0aW9uUHJvdmlkZXIpIHsKICAgICAgJHByb3ZpZGUudmFsdWUoJyRicm93c2VyJywgYnJvd3Nlcik7CiAgICAgIGJyb3dzZXIucG9sbEZucyA9IFtdOwogICAgfSkpOwoKICAgIGl0KCdzaG91bGQgbm90IGludGVyZmVyZSB3aXRoIGxlZ2FjeSBicm93c2VyIHVybCByZXBsYWNlIGJlaGF2aW9yJywgZnVuY3Rpb24oKSB7CiAgICAgIGluamVjdChmdW5jdGlvbigkcm9vdFNjb3BlKSB7CiAgICAgICAgdmFyIGN1cnJlbnQgPSBmYWtlV2luZG93LmxvY2F0aW9uLmhyZWY7CiAgICAgICAgdmFyIG5ld1VybCA9ICdub3R5ZXQnOwogICAgICAgIHNuaWZmZXIuaGlzdG9yeSA9IGZhbHNlOwogICAgICAgIGV4cGVjdChoaXN0b3J5RW50cmllc0xlbmd0aCkudG9CZSgxKTsKICAgICAgICBicm93c2VyLnVybChuZXdVcmwsIHRydWUpOwogICAgICAgIGV4cGVjdChicm93c2VyLnVybCgpKS50b0JlKG5ld1VybCk7CiAgICAgICAgZXhwZWN0KGhpc3RvcnlFbnRyaWVzTGVuZ3RoKS50b0JlKDEpOwogICAgICAgICRyb290U2NvcGUuJGRpZ2VzdCgpOwogICAgICAgIGV4cGVjdChicm93c2VyLnVybCgpKS50b0JlKG5ld1VybCk7CiAgICAgICAgZXhwZWN0KGhpc3RvcnlFbnRyaWVzTGVuZ3RoKS50b0JlKDEpOwogICAgICB9KTsKICAgIH0pOwoKICB9KTsKCn0pOwo=",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Thu, 06 Nov 2014 08:00:10 GMT",
                    "Content-Length": "29978",
                    "Date": "Thu, 06 Nov 2014 08:00:14 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}