{
    "url": "http://localhost:9999/imakewebthings/deck.js/core/deck.core.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "DOM data manipulation (DOM-based)",
    "issueType": 5247488,
    "severity": "Information",
    "confidence": "Firm",
    "issueBackground": "DOM-based DOM data manipulation vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this to a data field within the DOM that is used within the visible UI or client-side application logic. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will modify the appearance or behavior of the client-side UI. An attacker may be able to leverage this to perform virtual defacement of the application, or possibly to induce the user to perform unintended actions.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based DOM data manipulation vulnerabilities is not to dynamically write to DOM data fields any data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from being stored. In general, this is best achieved by using a whitelist of permitted values.",
    "issueDetail": "The application may be vulnerable to DOM-based DOM data manipulation. Data is read from <b>window.location.href</b> and written to <b>window.history.replaceState()</b> via the following statements:<ul><li>var hashPath = window.location.href.replace(/#.*/, '') + hash;</li><li>window.history.replaceState({}, \"\", hashPath);</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/imakewebthings/deck.js/core/deck.core.js",
                "path": "/imakewebthings/deck.js/core/deck.core.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9pbWFrZXdlYnRoaW5ncy9kZWNrLmpzL2NvcmUvZGVjay5jb3JlLmpzIEhUVFAvMS4xDQpIb3N0OiBsb2NhbGhvc3Q6OTk5OQ0KDQo=",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMjI5ODENCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IFRodSwgMDYgTm92IDIwMTQgMjA6MTU6MzMgR01UDQpMYXN0LU1vZGlmaWVkOiBUaHUsIDA2IE5vdiAyMDE0IDIwOjE1OjMzIEdNVA0KDQovKiEKRGVjayBKUyAtIGRlY2suY29yZQpDb3B5cmlnaHQgKGMpIDIwMTEtMjAxNCBDYWxlYiBUcm91Z2h0b24KRHVhbCBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UuCmh0dHBzOi8vZ2l0aHViLmNvbS9pbWFrZXdlYnRoaW5ncy9kZWNrLmpzL2Jsb2IvbWFzdGVyL01JVC1saWNlbnNlLnR4dAoqLwoKLyoKVGhlIGRlY2suY29yZSBtb2R1bGUgcHJvdmlkZXMgYWxsIHRoZSBiYXNpYyBmdW5jdGlvbmFsaXR5IGZvciBjcmVhdGluZyBhbmQKbW92aW5nIHRocm91Z2ggYSBkZWNrLiAgSXQgZG9lcyBzbyBieSBhcHBseWluZyBjbGFzc2VzIHRvIGluZGljYXRlIHRoZSBzdGF0ZSBvZgp0aGUgZGVjayBhbmQgaXRzIHNsaWRlcywgYWxsb3dpbmcgQ1NTIHRvIHRha2UgY2FyZSBvZiB0aGUgdmlzdWFsIHJlcHJlc2VudGF0aW9uCm9mIGVhY2ggc3RhdGUuICBJdCBhbHNvIHByb3ZpZGVzIG1ldGhvZHMgZm9yIG5hdmlnYXRpbmcgdGhlIGRlY2sgYW5kIGluc3BlY3RpbmcKaXRzIHN0YXRlLCBhcyB3ZWxsIGFzIGJhc2ljIGtleSBiaW5kaW5ncyBmb3IgZ29pbmcgdG8gdGhlIG5leHQgYW5kIHByZXZpb3VzCnNsaWRlcy4gIE1vcmUgZnVuY3Rpb25hbGl0eSBpcyBwcm92aWRlZCBieSB3aG9sbHkgc2VwYXJhdGUgZXh0ZW5zaW9uIG1vZHVsZXMKdGhhdCB1c2UgdGhlIEFQSSBwcm92aWRlZCBieSBjb3JlLgoqLwooZnVuY3Rpb24oJCwgdW5kZWZpbmVkKSB7CiAgdmFyIHNsaWRlcywgY3VycmVudEluZGV4LCAkY29udGFpbmVyLCAkZnJhZ21lbnRMaW5rczsKCiAgdmFyIGV2ZW50cyA9IHsKICAgIC8qCiAgICBUaGlzIGV2ZW50IGZpcmVzIGF0IHRoZSBiZWdpbm5pbmcgb2YgYSBzbGlkZSBjaGFuZ2UsIGJlZm9yZSB0aGUgYWN0dWFsCiAgICBjaGFuZ2Ugb2NjdXJzLiBJdHMgcHVycG9zZSBpcyB0byBnaXZlIGV4dGVuc2lvbiBhdXRob3JzIGEgd2F5IHRvIHByZXZlbnQKICAgIHRoZSBzbGlkZSBjaGFuZ2UgZnJvbSBvY2N1cmluZy4gVGhpcyBpcyBkb25lIGJ5IGNhbGxpbmcgcHJldmVudERlZmF1bHQKICAgIG9uIHRoZSBldmVudCBvYmplY3Qgd2l0aGluIHRoaXMgZXZlbnQuIElmIHRoYXQgaXMgZG9uZSwgdGhlIGRlY2suY2hhbmdlCiAgICBldmVudCB3aWxsIG5ldmVyIGJlIGZpcmVkIGFuZCB0aGUgc2xpZGUgd2lsbCBub3QgY2hhbmdlLgogICAgKi8KICAgIGJlZm9yZUNoYW5nZTogJ2RlY2suYmVmb3JlQ2hhbmdlJywKCiAgICAvKgogICAgVGhpcyBldmVudCBmaXJlcyB3aGVuZXZlciB0aGUgY3VycmVudCBzbGlkZSBjaGFuZ2VzLCB3aGV0aGVyIGJ5IHdheSBvZgogICAgbmV4dCwgcHJldiwgb3IgZ28uIFRoZSBjYWxsYmFjayBmdW5jdGlvbiBpcyBwYXNzZWQgdHdvIHBhcmFtZXRlcnMsIGZyb20KICAgIGFuZCB0bywgZXF1YWwgdG8gdGhlIGluZGljZXMgb2YgdGhlIG9sZCBzbGlkZSBhbmQgdGhlIG5ldyBzbGlkZQogICAgcmVzcGVjdGl2ZWx5LiBJZiBwcmV2ZW50RGVmYXVsdCBpcyBjYWxsZWQgb24gdGhlIGV2ZW50IHdpdGhpbiB0aGlzIGhhbmRsZXIKICAgIHRoZSBzbGlkZSBjaGFuZ2UgZG9lcyBub3Qgb2NjdXIuCgogICAgJChkb2N1bWVudCkuYmluZCgnZGVjay5jaGFuZ2UnLCBmdW5jdGlvbihldmVudCwgZnJvbSwgdG8pIHsKICAgICAgIGFsZXJ0KCdNb3ZpbmcgZnJvbSBzbGlkZSAnICsgZnJvbSArICcgdG8gJyArIHRvKTsKICAgIH0pOwogICAgKi8KICAgIGNoYW5nZTogJ2RlY2suY2hhbmdlJywKCiAgICAvKgogICAgVGhpcyBldmVudCBmaXJlcyBhdCB0aGUgYmVnaW5uaW5nIG9mIGRlY2sgaW5pdGlhbGl6YXRpb24uIFRoaXMgZXZlbnQgbWFrZXMKICAgIGEgZ29vZCBob29rIGZvciBwcmVwcm9jZXNzaW5nIGV4dGVuc2lvbnMgbG9va2luZyB0byBtb2RpZnkgdGhlIERPTSBiZWZvcmUKICAgIHRoZSBkZWNrIGlzIGZ1bGx5IGluaXRpYWxpemVkLiBJdCBpcyBhbHNvIHBvc3NpYmxlIHRvIGhhbHQgdGhlIGRlY2suaW5pdAogICAgZXZlbnQgZnJvbSBmaXJpbmcgd2hpbGUgeW91IGRvIHRoaW5ncyBpbiBiZWZvcmVJbml0LiBUaGlzIGNhbiBiZSBkb25lIGJ5CiAgICBjYWxsaW5nIGxvY2tJbml0IG9uIHRoZSBldmVudCBvYmplY3QgcGFzc2VkIHRvIHRoaXMgZXZlbnQuIFRoZSBpbml0IGNhbiBiZQogICAgcmVsZWFzZWQgYnkgY2FsbGluZyByZWxlYXNlSW5pdC4KCiAgICAkKGRvY3VtZW50KS5iaW5kKCdkZWNrLmJlZm9yZUluaXQnLCBmdW5jdGlvbihldmVudCkgewogICAgICBldmVudC5sb2NrSW5pdCgpOyAvLyBoYWx0cyBkZWNrLmluaXQgZXZlbnQKICAgICAgd2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgZXZlbnQucmVsZWFzZUluaXQoKTsgLy8gZGVjay5pbml0IHdpbGwgbm93IGZpcmUgMiBzZWNvbmRzIGxhdGVyCiAgICAgIH0sIDIwMDApOwogICAgfSk7CgogICAgVGhlIGluaXQgZXZlbnQgd2lsbCBiZSBmaXJlZCByZWdhcmRsZXNzIG9mIGxvY2tzIGFmdGVyCiAgICBvcHRpb25zLmluaXRMb2NrVGltZW91dCBtaWxsaXNlY29uZHMuCiAgICAqLwogICAgYmVmb3JlSW5pdGlhbGl6ZTogJ2RlY2suYmVmb3JlSW5pdCcsCgogICAgLyoKICAgIFRoaXMgZXZlbnQgZmlyZXMgYXQgdGhlIGVuZCBvZiBkZWNrIGluaXRpYWxpemF0aW9uLiBFeHRlbnNpb25zIHNob3VsZAogICAgaW1wbGVtZW50IGFueSBjb2RlIHRoYXQgcmVsaWVzIG9uIHVzZXIgZXh0ZW5zaWJsZSBvcHRpb25zIChrZXkgYmluZGluZ3MsCiAgICBlbGVtZW50IHNlbGVjdG9ycywgY2xhc3Nlcykgd2l0aGluIGEgaGFuZGxlciBmb3IgdGhpcyBldmVudC4gTmF0aXZlCiAgICBldmVudHMgYXNzb2NpYXRlZCB3aXRoIERlY2sgSlMgc2hvdWxkIGJlIHNjb3BlZCB1bmRlciBhIC5kZWNrIGV2ZW50CiAgICBuYW1lc3BhY2UsIGFzIHdpdGggdGhlIGV4YW1wbGUgYmVsb3c6CgogICAgdmFyICRkID0gJChkb2N1bWVudCk7CiAgICAkLmRlY2suZGVmYXVsdHMua2V5cy5teUV4dGVuc2lvbktleWNvZGUgPSA3MDsgLy8gJ2gnCiAgICAkZC5iaW5kKCdkZWNrLmluaXQnLCBmdW5jdGlvbigpIHsKICAgICAgICRkLmJpbmQoJ2tleWRvd24uZGVjaycsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgICBpZiAoZXZlbnQud2hpY2ggPT09ICQuZGVjay5nZXRPcHRpb25zKCkua2V5cy5teUV4dGVuc2lvbktleWNvZGUpIHsKICAgICAgICAgICAgIC8vIFJvY2sgb3V0CiAgICAgICAgICB9CiAgICAgICB9KTsKICAgIH0pOwogICAgKi8KICAgIGluaXRpYWxpemU6ICdkZWNrLmluaXQnCiAgfTsKCiAgdmFyIG9wdGlvbnMgPSB7fTsKICB2YXIgJGRvY3VtZW50ID0gJChkb2N1bWVudCk7CiAgdmFyICR3aW5kb3cgPSAkKHdpbmRvdyk7CiAgdmFyIHN0b3BQcm9wYWdhdGlvbiA9IGZ1bmN0aW9uKGV2ZW50KSB7CiAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKICB9OwoKICB2YXIgdXBkYXRlQ29udGFpbmVyU3RhdGUgPSBmdW5jdGlvbigpIHsKICAgIHZhciBvbGRJbmRleCA9ICRjb250YWluZXIuZGF0YSgnb25TbGlkZScpOwogICAgJGNvbnRhaW5lci5yZW1vdmVDbGFzcyhvcHRpb25zLmNsYXNzZXMub25QcmVmaXggKyBvbGRJbmRleCk7CiAgICAkY29udGFpbmVyLmFkZENsYXNzKG9wdGlvbnMuY2xhc3Nlcy5vblByZWZpeCArIGN1cnJlbnRJbmRleCk7CiAgICAkY29udGFpbmVyLmRhdGEoJ29uU2xpZGUnLCBjdXJyZW50SW5kZXgpOwogIH07CgogIHZhciB1cGRhdGVDaGlsZEN1cnJlbnQgPSBmdW5jdGlvbigpIHsKICAgIHZhciAkb2xkQ3VycmVudCA9ICQoJy4nICsgb3B0aW9ucy5jbGFzc2VzLmN1cnJlbnQpOwogICAgdmFyICRvbGRQYXJlbnRzID0gJG9sZEN1cnJlbnQucGFyZW50c1VudGlsKG9wdGlvbnMuc2VsZWN0b3JzLmNvbnRhaW5lcik7CiAgICB2YXIgJG5ld0N1cnJlbnQgPSBzbGlkZXNbY3VycmVudEluZGV4XTsKICAgIHZhciAkbmV3UGFyZW50cyA9ICRuZXdDdXJyZW50LnBhcmVudHNVbnRpbChvcHRpb25zLnNlbGVjdG9ycy5jb250YWluZXIpOwogICAgJG9sZFBhcmVudHMucmVtb3ZlQ2xhc3Mob3B0aW9ucy5jbGFzc2VzLmNoaWxkQ3VycmVudCk7CiAgICAkbmV3UGFyZW50cy5hZGRDbGFzcyhvcHRpb25zLmNsYXNzZXMuY2hpbGRDdXJyZW50KTsKICB9OwoKICB2YXIgcmVtb3ZlT2xkU2xpZGVTdGF0ZXMgPSBmdW5jdGlvbigpIHsKICAgIHZhciAkYWxsID0gJCgpOwogICAgJC5lYWNoKHNsaWRlcywgZnVuY3Rpb24oaSwgZWwpIHsKICAgICAgJGFsbCA9ICRhbGwuYWRkKGVsKTsKICAgIH0pOwogICAgJGFsbC5yZW1vdmVDbGFzcyhbCiAgICAgIG9wdGlvbnMuY2xhc3Nlcy5iZWZvcmUsCiAgICAgIG9wdGlvbnMuY2xhc3Nlcy5wcmV2aW91cywKICAgICAgb3B0aW9ucy5jbGFzc2VzLmN1cnJlbnQsCiAgICAgIG9wdGlvbnMuY2xhc3Nlcy5uZXh0LAogICAgICBvcHRpb25zLmNsYXNzZXMuYWZ0ZXIKICAgIF0uam9pbignICcpKTsKICB9OwoKICB2YXIgYWRkTmV3U2xpZGVTdGF0ZXMgPSBmdW5jdGlvbigpIHsKICAgIHNsaWRlc1tjdXJyZW50SW5kZXhdLmFkZENsYXNzKG9wdGlvbnMuY2xhc3Nlcy5jdXJyZW50KTsKICAgIGlmIChjdXJyZW50SW5kZXggPiAwKSB7CiAgICAgIHNsaWRlc1tjdXJyZW50SW5kZXgtMV0uYWRkQ2xhc3Mob3B0aW9ucy5jbGFzc2VzLnByZXZpb3VzKTsKICAgIH0KICAgIGlmIChjdXJyZW50SW5kZXggKyAxIDwgc2xpZGVzLmxlbmd0aCkgewogICAgICBzbGlkZXNbY3VycmVudEluZGV4KzFdLmFkZENsYXNzKG9wdGlvbnMuY2xhc3Nlcy5uZXh0KTsKICAgIH0KICAgIGlmIChjdXJyZW50SW5kZXggPiAxKSB7CiAgICAgICQuZWFjaChzbGlkZXMuc2xpY2UoMCwgY3VycmVudEluZGV4IC0gMSksIGZ1bmN0aW9uKGksICRzbGlkZSkgewogICAgICAgICRzbGlkZS5hZGRDbGFzcyhvcHRpb25zLmNsYXNzZXMuYmVmb3JlKTsKICAgICAgfSk7CiAgICB9CiAgICBpZiAoY3VycmVudEluZGV4ICsgMiA8IHNsaWRlcy5sZW5ndGgpIHsKICAgICAgJC5lYWNoKHNsaWRlcy5zbGljZShjdXJyZW50SW5kZXgrMiksIGZ1bmN0aW9uKGksICRzbGlkZSkgewogICAgICAgICRzbGlkZS5hZGRDbGFzcyhvcHRpb25zLmNsYXNzZXMuYWZ0ZXIpOwogICAgICB9KTsKICAgIH0KICB9OwoKICB2YXIgc2V0QXJpYUhpZGRlbnMgPSBmdW5jdGlvbigpIHsKICAgICQob3B0aW9ucy5zZWxlY3RvcnMuc2xpZGVzKS5lYWNoKGZ1bmN0aW9uKCkgewogICAgICB2YXIgJHNsaWRlID0gJCh0aGlzKTsKICAgICAgdmFyIGlzU3ViID0gJHNsaWRlLmNsb3Nlc3QoJy4nICsgb3B0aW9ucy5jbGFzc2VzLmNoaWxkQ3VycmVudCkubGVuZ3RoOwogICAgICB2YXIgaXNCZWZvcmUgPSAkc2xpZGUuaGFzQ2xhc3Mob3B0aW9ucy5jbGFzc2VzLmJlZm9yZSkgJiYgIWlzU3ViOwogICAgICB2YXIgaXNQcmV2aW91cyA9ICRzbGlkZS5oYXNDbGFzcyhvcHRpb25zLmNsYXNzZXMucHJldmlvdXMpICYmICFpc1N1YjsKICAgICAgdmFyIGlzTmV4dCA9ICRzbGlkZS5oYXNDbGFzcyhvcHRpb25zLmNsYXNzZXMubmV4dCk7CiAgICAgIHZhciBpc0FmdGVyID0gJHNsaWRlLmhhc0NsYXNzKG9wdGlvbnMuY2xhc3Nlcy5hZnRlcik7CiAgICAgIHZhciBhcmlhSGlkZGVuVmFsdWUgPSBpc0JlZm9yZSB8fCBpc1ByZXZpb3VzIHx8IGlzTmV4dCB8fCBpc0FmdGVyOwogICAgICAkc2xpZGUuYXR0cignYXJpYS1oaWRkZW4nLCBhcmlhSGlkZGVuVmFsdWUpOwogICAgfSk7CiAgfTsKCiAgdmFyIHVwZGF0ZVN0YXRlcyA9IGZ1bmN0aW9uKCkgewogICAgdXBkYXRlQ29udGFpbmVyU3RhdGUoKTsKICAgIHVwZGF0ZUNoaWxkQ3VycmVudCgpOwogICAgcmVtb3ZlT2xkU2xpZGVTdGF0ZXMoKTsKICAgIGFkZE5ld1NsaWRlU3RhdGVzKCk7CiAgICBpZiAob3B0aW9ucy5zZXRBcmlhSGlkZGVucykgewogICAgICBzZXRBcmlhSGlkZGVucygpOwogICAgfQogIH07CgogIHZhciBpbml0U2xpZGVzQXJyYXkgPSBmdW5jdGlvbihlbGVtZW50cykgewogICAgaWYgKCQuaXNBcnJheShlbGVtZW50cykpIHsKICAgICAgJC5lYWNoKGVsZW1lbnRzLCBmdW5jdGlvbihpLCBlbGVtZW50KSB7CiAgICAgICAgc2xpZGVzLnB1c2goJChlbGVtZW50KSk7CiAgICAgIH0pOwogICAgfQogICAgZWxzZSB7CiAgICAgICQoZWxlbWVudHMpLmVhY2goZnVuY3Rpb24oaSwgZWxlbWVudCkgewogICAgICAgIHNsaWRlcy5wdXNoKCQoZWxlbWVudCkpOwogICAgICB9KTsKICAgIH0KICB9OwoKICB2YXIgYmluZEtleUV2ZW50cyA9IGZ1bmN0aW9uKCkgewogICAgdmFyIGVkaXRhYmxlcyA9IFsKICAgICAgJ2lucHV0JywKICAgICAgJ3RleHRhcmVhJywKICAgICAgJ3NlbGVjdCcsCiAgICAgICdidXR0b24nLAogICAgICAnbWV0ZXInLAogICAgICAncHJvZ3Jlc3MnLAogICAgICAnW2NvbnRlbnRFZGl0YWJsZV0nCiAgICBdLmpvaW4oJywgJyk7CgogICAgJGRvY3VtZW50LnVuYmluZCgna2V5ZG93bi5kZWNrJykuYmluZCgna2V5ZG93bi5kZWNrJywgZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgdmFyIGlzTmV4dCA9IGV2ZW50LndoaWNoID09PSBvcHRpb25zLmtleXMubmV4dDsKICAgICAgdmFyIGlzUHJldiA9IGV2ZW50LndoaWNoID09PSBvcHRpb25zLmtleXMucHJldmlvdXM7CiAgICAgIGlzTmV4dCA9IGlzTmV4dCB8fCAkLmluQXJyYXkoZXZlbnQud2hpY2gsIG9wdGlvbnMua2V5cy5uZXh0KSA+IC0xOwogICAgICBpc1ByZXYgPSBpc1ByZXYgfHwgJC5pbkFycmF5KGV2ZW50LndoaWNoLCBvcHRpb25zLmtleXMucHJldmlvdXMpID4gLTE7CgogICAgICBpZiAoaXNOZXh0KSB7CiAgICAgICAgbWV0aG9kcy5uZXh0KCk7CiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgfQogICAgICBlbHNlIGlmIChpc1ByZXYpIHsKICAgICAgICBtZXRob2RzLnByZXYoKTsKICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICB9CiAgICB9KTsKCiAgICAkZG9jdW1lbnQudW5kZWxlZ2F0ZShlZGl0YWJsZXMsICdrZXlkb3duLmRlY2snLCBzdG9wUHJvcGFnYXRpb24pOwogICAgJGRvY3VtZW50LmRlbGVnYXRlKGVkaXRhYmxlcywgJ2tleWRvd24uZGVjaycsIHN0b3BQcm9wYWdhdGlvbik7CiAgfTsKCiAgdmFyIGJpbmRUb3VjaEV2ZW50cyA9IGZ1bmN0aW9uKCkgewogICAgdmFyIHN0YXJ0VG91Y2g7CiAgICB2YXIgZGlyZWN0aW9uID0gb3B0aW9ucy50b3VjaC5zd2lwZURpcmVjdGlvbjsKICAgIHZhciB0b2xlcmFuY2UgPSBvcHRpb25zLnRvdWNoLnN3aXBlVG9sZXJhbmNlOwogICAgdmFyIGxpc3RlblRvSG9yaXpvbnRhbCA9ICh7IGJvdGg6IHRydWUsIGhvcml6b250YWw6IHRydWUgfSlbZGlyZWN0aW9uXTsKICAgIHZhciBsaXN0ZW5Ub1ZlcnRpY2FsID0gKHsgYm90aDogdHJ1ZSwgdmVydGljYWw6IHRydWUgfSlbZGlyZWN0aW9uXTsKCiAgICAkY29udGFpbmVyLnVuYmluZCgndG91Y2hzdGFydC5kZWNrJyk7CiAgICAkY29udGFpbmVyLmJpbmQoJ3RvdWNoc3RhcnQuZGVjaycsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgIGlmICghc3RhcnRUb3VjaCkgewogICAgICAgIHN0YXJ0VG91Y2ggPSAkLmV4dGVuZCh7fSwgZXZlbnQub3JpZ2luYWxFdmVudC50YXJnZXRUb3VjaGVzWzBdKTsKICAgICAgfQogICAgfSk7CgogICAgJGNvbnRhaW5lci51bmJpbmQoJ3RvdWNobW92ZS5kZWNrJyk7CiAgICAkY29udGFpbmVyLmJpbmQoJ3RvdWNobW92ZS5kZWNrJywgZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgJC5lYWNoKGV2ZW50Lm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXMsIGZ1bmN0aW9uKGksIHRvdWNoKSB7CiAgICAgICAgaWYgKCFzdGFydFRvdWNoIHx8IHRvdWNoLmlkZW50aWZpZXIgIT09IHN0YXJ0VG91Y2guaWRlbnRpZmllcikgewogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHZhciB4RGlzdGFuY2UgPSB0b3VjaC5zY3JlZW5YIC0gc3RhcnRUb3VjaC5zY3JlZW5YOwogICAgICAgIHZhciB5RGlzdGFuY2UgPSB0b3VjaC5zY3JlZW5ZIC0gc3RhcnRUb3VjaC5zY3JlZW5ZOwogICAgICAgIHZhciBsZWZ0VG9SaWdodCA9IHhEaXN0YW5jZSA+IHRvbGVyYW5jZSAmJiBsaXN0ZW5Ub0hvcml6b250YWw7CiAgICAgICAgdmFyIHJpZ2h0VG9MZWZ0ID0geERpc3RhbmNlIDwgLXRvbGVyYW5jZSAmJiBsaXN0ZW5Ub0hvcml6b250YWw7CiAgICAgICAgdmFyIHRvcFRvQm90dG9tID0geURpc3RhbmNlID4gdG9sZXJhbmNlICYmIGxpc3RlblRvVmVydGljYWw7CiAgICAgICAgdmFyIGJvdHRvbVRvVG9wID0geURpc3RhbmNlIDwgLXRvbGVyYW5jZSAmJiBsaXN0ZW5Ub1ZlcnRpY2FsOwoKICAgICAgICBpZiAobGVmdFRvUmlnaHQgfHwgdG9wVG9Cb3R0b20pIHsKICAgICAgICAgICQuZGVjaygncHJldicpOwogICAgICAgICAgc3RhcnRUb3VjaCA9IHVuZGVmaW5lZDsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAocmlnaHRUb0xlZnQgfHwgYm90dG9tVG9Ub3ApIHsKICAgICAgICAgICQuZGVjaygnbmV4dCcpOwogICAgICAgICAgc3RhcnRUb3VjaCA9IHVuZGVmaW5lZDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9KTsKCiAgICAgIGlmIChsaXN0ZW5Ub1ZlcnRpY2FsKSB7CiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgfQogICAgfSk7CgogICAgJGNvbnRhaW5lci51bmJpbmQoJ3RvdWNoZW5kLmRlY2snKTsKICAgICRjb250YWluZXIuYmluZCgndG91Y2hlbmQuZGVjaycsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICQuZWFjaChldmVudC5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzLCBmdW5jdGlvbihpLCB0b3VjaCkgewogICAgICAgIGlmIChzdGFydFRvdWNoICYmIHRvdWNoLmlkZW50aWZpZXIgPT09IHN0YXJ0VG91Y2guaWRlbnRpZmllcikgewogICAgICAgICAgc3RhcnRUb3VjaCA9IHVuZGVmaW5lZDsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSk7CiAgfTsKCiAgdmFyIGluZGV4SW5Cb3VuZHMgPSBmdW5jdGlvbihpbmRleCkgewogICAgcmV0dXJuIHR5cGVvZiBpbmRleCA9PT0gJ251bWJlcicgJiYgaW5kZXggPj0wICYmIGluZGV4IDwgc2xpZGVzLmxlbmd0aDsKICB9OwoKICB2YXIgY3JlYXRlQmVmb3JlSW5pdEV2ZW50ID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgZXZlbnQgPSAkLkV2ZW50KGV2ZW50cy5iZWZvcmVJbml0aWFsaXplKTsKICAgIGV2ZW50LmxvY2tzID0gMDsKICAgIGV2ZW50LmRvbmUgPSAkLm5vb3A7CiAgICBldmVudC5sb2NrSW5pdCA9IGZ1bmN0aW9uKCkgewogICAgICArK2V2ZW50LmxvY2tzOwogICAgfTsKICAgIGV2ZW50LnJlbGVhc2VJbml0ID0gZnVuY3Rpb24oKSB7CiAgICAgIC0tZXZlbnQubG9ja3M7CiAgICAgIGlmICghZXZlbnQubG9ja3MpIHsKICAgICAgICBldmVudC5kb25lKCk7CiAgICAgIH0KICAgIH07CiAgICByZXR1cm4gZXZlbnQ7CiAgfTsKCiAgdmFyIGdvQnlIYXNoID0gZnVuY3Rpb24oc3RyKSB7CiAgICB2YXIgaWQgPSBzdHIuc3Vic3RyKHN0ci5pbmRleE9mKCIjIikgKyAxKTsKCiAgICAkLmVhY2goc2xpZGVzLCBmdW5jdGlvbihpLCAkc2xpZGUpIHsKICAgICAgaWYgKCRzbGlkZS5hdHRyKCdpZCcpID09PSBpZCkgewogICAgICAgICQuZGVjaygnZ28nLCBpKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH0pOwoKICAgIC8vIElmIHdlIGRvbid0IHNldCB0aGVzZSB0byAwIHRoZSBjb250YWluZXIgc2Nyb2xscyBkdWUgdG8gaGFzaGNoYW5nZQogICAgaWYgKG9wdGlvbnMucHJldmVudEZyYWdtZW50U2Nyb2xsKSB7CiAgICAgICQuZGVjaygnZ2V0Q29udGFpbmVyJykuc2Nyb2xsTGVmdCgwKS5zY3JvbGxUb3AoMCk7CiAgICB9CiAgfTsKCiAgdmFyIGFzc2lnblNsaWRlSWQgPSBmdW5jdGlvbihpLCAkc2xpZGUpIHsKICAgIHZhciBjdXJyZW50SWQgPSAkc2xpZGUuYXR0cignaWQnKTsKICAgIHZhciBwcmV2aW91c2x5QXNzaWduZWQgPSAkc2xpZGUuZGF0YSgnZGVja0Fzc2lnbmVkSWQnKSA9PT0gY3VycmVudElkOwogICAgaWYgKCFjdXJyZW50SWQgfHwgcHJldmlvdXNseUFzc2lnbmVkKSB7CiAgICAgICRzbGlkZS5hdHRyKCdpZCcsIG9wdGlvbnMuaGFzaFByZWZpeCArIGkpOwogICAgICAkc2xpZGUuZGF0YSgnZGVja0Fzc2lnbmVkSWQnLCBvcHRpb25zLmhhc2hQcmVmaXggKyBpKTsKICAgIH0KICB9OwoKICB2YXIgcmVtb3ZlQ29udGFpbmVySGFzaENsYXNzID0gZnVuY3Rpb24oaWQpIHsKICAgICRjb250YWluZXIucmVtb3ZlQ2xhc3Mob3B0aW9ucy5jbGFzc2VzLm9uUHJlZml4ICsgaWQpOwogIH07CgogIHZhciBhZGRDb250YWluZXJIYXNoQ2xhc3MgPSBmdW5jdGlvbihpZCkgewogICAgJGNvbnRhaW5lci5hZGRDbGFzcyhvcHRpb25zLmNsYXNzZXMub25QcmVmaXggKyBpZCk7CiAgfTsKCiAgdmFyIHNldHVwSGFzaEJlaGF2aW9ycyA9IGZ1bmN0aW9uKCkgewogICAgJGZyYWdtZW50TGlua3MgPSAkKCk7CiAgICAkLmVhY2goc2xpZGVzLCBmdW5jdGlvbihpLCAkc2xpZGUpIHsKICAgICAgdmFyIGhhc2g7CgogICAgICBhc3NpZ25TbGlkZUlkKGksICRzbGlkZSk7CiAgICAgIGhhc2ggPSAnIycgKyAkc2xpZGUuYXR0cignaWQnKTsKICAgICAgaWYgKGhhc2ggPT09IHdpbmRvdy5sb2NhdGlvbi5oYXNoKSB7CiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICQuZGVjaygnZ28nLCBpKTsKICAgICAgICB9LCAxKTsKICAgICAgfQogICAgICAkZnJhZ21lbnRMaW5rcyA9ICRmcmFnbWVudExpbmtzLmFkZCgnYVtocmVmPSInICsgaGFzaCArICciXScpOwogICAgfSk7CgogICAgaWYgKHNsaWRlcy5sZW5ndGgpIHsKICAgICAgYWRkQ29udGFpbmVySGFzaENsYXNzKCQuZGVjaygnZ2V0U2xpZGUnKS5hdHRyKCdpZCcpKTsKICAgIH07CiAgfTsKCiAgdmFyIGNoYW5nZUhhc2ggPSBmdW5jdGlvbihmcm9tLCB0bykgewogICAgdmFyIGhhc2ggPSAnIycgKyAkLmRlY2soJ2dldFNsaWRlJywgdG8pLmF0dHIoJ2lkJyk7CiAgICB2YXIgaGFzaFBhdGggPSB3aW5kb3cubG9jYXRpb24uaHJlZi5yZXBsYWNlKC8jLiovLCAnJykgKyBoYXNoOwoKICAgIHJlbW92ZUNvbnRhaW5lckhhc2hDbGFzcygkLmRlY2soJ2dldFNsaWRlJywgZnJvbSkuYXR0cignaWQnKSk7CiAgICBhZGRDb250YWluZXJIYXNoQ2xhc3MoJC5kZWNrKCdnZXRTbGlkZScsIHRvKS5hdHRyKCdpZCcpKTsKICAgIGlmIChNb2Rlcm5penIuaGlzdG9yeSkgewogICAgICB3aW5kb3cuaGlzdG9yeS5yZXBsYWNlU3RhdGUoe30sICIiLCBoYXNoUGF0aCk7CiAgICB9CiAgfTsKCiAgLyogTWV0aG9kcyBleHBvc2VkIGluIHRoZSBqUXVlcnkuZGVjayBuYW1lc3BhY2UgKi8KICB2YXIgbWV0aG9kcyA9IHsKCiAgICAvKgogICAgalF1ZXJ5LmRlY2soc2VsZWN0b3IsIG9wdGlvbnMpCgogICAgc2VsZWN0b3I6IHN0cmluZyB8IGpRdWVyeSB8IGFycmF5CiAgICBvcHRpb25zOiBvYmplY3QsIG9wdGlvbmFsCgogICAgSW5pdGlhbGl6ZXMgdGhlIGRlY2ssIHVzaW5nIGVhY2ggZWxlbWVudCBtYXRjaGVkIGJ5IHNlbGVjdG9yIGFzIGEgc2xpZGUuCiAgICBNYXkgYWxzbyBiZSBwYXNzZWQgYW4gYXJyYXkgb2Ygc3RyaW5nIHNlbGVjdG9ycyBvciBqUXVlcnkgb2JqZWN0cywgaW4KICAgIHdoaWNoIGNhc2UgZWFjaCBzZWxlY3RvciBpbiB0aGUgYXJyYXkgaXMgY29uc2lkZXJlZCBhIHNsaWRlLiBUaGUgc2Vjb25kCiAgICBwYXJhbWV0ZXIgaXMgYW4gb3B0aW9uYWwgb3B0aW9ucyBvYmplY3Qgd2hpY2ggd2lsbCBleHRlbmQgdGhlIGRlZmF1bHQKICAgIHZhbHVlcy4KCiAgICBVc2VycyBtYXkgYWxzbyBwYXNzIG9ubHkgYW4gb3B0aW9ucyBvYmplY3QgdG8gaW5pdC4gSW4gdGhpcyBjYXNlIHRoZSBzbGlkZQogICAgc2VsZWN0b3Igd2lsbCBiZSBvcHRpb25zLnNlbGVjdG9ycy5zbGlkZXMgd2hpY2ggZGVmYXVsdHMgdG8gLnNsaWRlLgoKICAgICQuZGVjaygnLnNsaWRlJyk7CgogICAgb3IKCiAgICAkLmRlY2soWwogICAgICAgJyNmaXJzdC1zbGlkZScsCiAgICAgICAnI3NlY29uZC1zbGlkZScsCiAgICAgICAnI2V0YycKICAgIF0pOwogICAgKi8KICAgIGluaXQ6IGZ1bmN0aW9uKG9wdHMpIHsKICAgICAgdmFyIGJlZm9yZUluaXRFdmVudCA9IGNyZWF0ZUJlZm9yZUluaXRFdmVudCgpOwogICAgICB2YXIgb3ZlcnJpZGVzID0gb3B0czsKCiAgICAgIGlmICghJC5pc1BsYWluT2JqZWN0KG9wdHMpKSB7CiAgICAgICAgb3ZlcnJpZGVzID0gYXJndW1lbnRzWzFdIHx8IHt9OwogICAgICAgICQuZXh0ZW5kKHRydWUsIG92ZXJyaWRlcywgewogICAgICAgICAgc2VsZWN0b3JzOiB7CiAgICAgICAgICAgIHNsaWRlczogYXJndW1lbnRzWzBdCiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIG9wdGlvbnMgPSAkLmV4dGVuZCh0cnVlLCB7fSwgJC5kZWNrLmRlZmF1bHRzLCBvdmVycmlkZXMpOwogICAgICBzbGlkZXMgPSBbXTsKICAgICAgY3VycmVudEluZGV4ID0gMDsKICAgICAgJGNvbnRhaW5lciA9ICQob3B0aW9ucy5zZWxlY3RvcnMuY29udGFpbmVyKTsKCiAgICAgIC8vIEhpZGUgdGhlIGRlY2sgd2hpbGUgc3RhdGVzIGFyZSBiZWluZyBhcHBsaWVkIHRvIGtpbGwgdHJhbnNpdGlvbnMKICAgICAgJGNvbnRhaW5lci5hZGRDbGFzcyhvcHRpb25zLmNsYXNzZXMubG9hZGluZyk7CgogICAgICAvLyBwb3B1bGF0ZSB0aGUgYXJyYXkgb2Ygc2xpZGVzIGZvciBwcmUtaW5pdAogICAgICBpbml0U2xpZGVzQXJyYXkob3B0aW9ucy5zZWxlY3RvcnMuc2xpZGVzKTsKICAgICAgLy8gUHJlIGluaXQgZXZlbnQgZm9yIHByZXByb2Nlc3NpbmcgaG9va3MKICAgICAgYmVmb3JlSW5pdEV2ZW50LmRvbmUgPSBmdW5jdGlvbigpIHsKICAgICAgICAvLyByZS1wb3B1bGF0ZSB0aGUgYXJyYXkgb2Ygc2xpZGVzCiAgICAgICAgc2xpZGVzID0gW107CiAgICAgICAgaW5pdFNsaWRlc0FycmF5KG9wdGlvbnMuc2VsZWN0b3JzLnNsaWRlcyk7CiAgICAgICAgc2V0dXBIYXNoQmVoYXZpb3JzKCk7CiAgICAgICAgYmluZEtleUV2ZW50cygpOwogICAgICAgIGJpbmRUb3VjaEV2ZW50cygpOwogICAgICAgICRjb250YWluZXIuc2Nyb2xsTGVmdCgwKS5zY3JvbGxUb3AoMCk7CgogICAgICAgIGlmIChzbGlkZXMubGVuZ3RoKSB7CiAgICAgICAgICB1cGRhdGVTdGF0ZXMoKTsKICAgICAgICB9CgogICAgICAgIC8vIFNob3cgZGVjayBhZ2FpbiBub3cgdGhhdCBzbGlkZXMgYXJlIGluIHBsYWNlCiAgICAgICAgJGNvbnRhaW5lci5yZW1vdmVDbGFzcyhvcHRpb25zLmNsYXNzZXMubG9hZGluZyk7CiAgICAgICAgJGRvY3VtZW50LnRyaWdnZXIoZXZlbnRzLmluaXRpYWxpemUpOwogICAgICB9OwoKICAgICAgJGRvY3VtZW50LnRyaWdnZXIoYmVmb3JlSW5pdEV2ZW50KTsKICAgICAgaWYgKCFiZWZvcmVJbml0RXZlbnQubG9ja3MpIHsKICAgICAgICBiZWZvcmVJbml0RXZlbnQuZG9uZSgpOwogICAgICB9CiAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgIGlmIChiZWZvcmVJbml0RXZlbnQubG9ja3MpIHsKICAgICAgICAgIGlmICh3aW5kb3cuY29uc29sZSkgewogICAgICAgICAgICB3aW5kb3cuY29uc29sZS53YXJuKCdTb21ldGhpbmcgbG9ja2VkIGRlY2sgaW5pdGlhbGl6YXRpb25cCiAgICAgICAgICAgICAgd2l0aG91dCByZWxlYXNpbmcgaXQgYmVmb3JlIHRoZSB0aW1lb3V0LiBQcm9jZWVkaW5nIHdpdGhcCiAgICAgICAgICAgICAgaW5pdGlhbGl6YXRpb24gYW55d2F5LicpOwogICAgICAgICAgfQogICAgICAgICAgYmVmb3JlSW5pdEV2ZW50LmRvbmUoKTsKICAgICAgICB9CiAgICAgIH0sIG9wdGlvbnMuaW5pdExvY2tUaW1lb3V0KTsKICAgIH0sCgogICAgLyoKICAgIGpRdWVyeS5kZWNrKCdnbycsIGluZGV4KQoKICAgIGluZGV4OiBpbnRlZ2VyIHwgc3RyaW5nCgogICAgTW92ZXMgdG8gdGhlIHNsaWRlIGF0IHRoZSBzcGVjaWZpZWQgaW5kZXggaWYgaW5kZXggaXMgYSBudW1iZXIuIEluZGV4IGlzCiAgICAwLWJhc2VkLCBzbyAkLmRlY2soJ2dvJywgMCk7IHdpbGwgbW92ZSB0byB0aGUgZmlyc3Qgc2xpZGUuIElmIGluZGV4IGlzIGEKICAgIHN0cmluZyB0aGlzIHdpbGwgbW92ZSB0byB0aGUgc2xpZGUgd2l0aCB0aGUgc3BlY2lmaWVkIGlkLiBJZiBpbmRleCBpcyBvdXQKICAgIG9mIGJvdW5kcyBvciBkb2Vzbid0IG1hdGNoIGEgc2xpZGUgaWQgdGhlIGNhbGwgaXMgaWdub3JlZC4KICAgICovCiAgICBnbzogZnVuY3Rpb24oaW5kZXhPcklkKSB7CiAgICAgIHZhciBiZWZvcmVDaGFuZ2VFdmVudCA9ICQuRXZlbnQoZXZlbnRzLmJlZm9yZUNoYW5nZSk7CiAgICAgIHZhciBpbmRleDsKCiAgICAgIC8qIE51bWJlciBpbmRleCwgZWFzeS4gKi8KICAgICAgaWYgKGluZGV4SW5Cb3VuZHMoaW5kZXhPcklkKSkgewogICAgICAgIGluZGV4ID0gaW5kZXhPcklkOwogICAgICB9CiAgICAgIC8qIElkIHN0cmluZyBpbmRleCwgc2VhcmNoIGZvciBpdCBhbmQgc2V0IGludGVnZXIgaW5kZXggKi8KICAgICAgZWxzZSBpZiAodHlwZW9mIGluZGV4T3JJZCA9PT0gJ3N0cmluZycpIHsKICAgICAgICAkLmVhY2goc2xpZGVzLCBmdW5jdGlvbihpLCAkc2xpZGUpIHsKICAgICAgICAgIGlmICgkc2xpZGUuYXR0cignaWQnKSA9PT0gaW5kZXhPcklkKSB7CiAgICAgICAgICAgIGluZGV4ID0gaTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICAgIGlmICh0eXBlb2YgaW5kZXggPT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICAvKiBUcmlnZ2VyIGJlZm9yZUNoYW5nZS4gSWYgbm90aGluZyBwcmV2ZW50cyB0aGUgY2hhbmdlLCB0cmlnZ2VyCiAgICAgIHRoZSBzbGlkZSBjaGFuZ2UuICovCiAgICAgICRkb2N1bWVudC50cmlnZ2VyKGJlZm9yZUNoYW5nZUV2ZW50LCBbY3VycmVudEluZGV4LCBpbmRleF0pOwogICAgICBpZiAoIWJlZm9yZUNoYW5nZUV2ZW50LmlzRGVmYXVsdFByZXZlbnRlZCgpKSB7CiAgICAgICAgJGRvY3VtZW50LnRyaWdnZXIoZXZlbnRzLmNoYW5nZSwgW2N1cnJlbnRJbmRleCwgaW5kZXhdKTsKICAgICAgICBjaGFuZ2VIYXNoKGN1cnJlbnRJbmRleCwgaW5kZXgpOwogICAgICAgIGN1cnJlbnRJbmRleCA9IGluZGV4OwogICAgICAgIHVwZGF0ZVN0YXRlcygpOwogICAgICB9CiAgICB9LAoKICAgIC8qCiAgICBqUXVlcnkuZGVjaygnbmV4dCcpCgogICAgTW92ZXMgdG8gdGhlIG5leHQgc2xpZGUuIElmIHRoZSBsYXN0IHNsaWRlIGlzIGFscmVhZHkgYWN0aXZlLCB0aGUgY2FsbAogICAgaXMgaWdub3JlZC4KICAgICovCiAgICBuZXh0OiBmdW5jdGlvbigpIHsKICAgICAgbWV0aG9kcy5nbyhjdXJyZW50SW5kZXgrMSk7CiAgICB9LAoKICAgIC8qCiAgICBqUXVlcnkuZGVjaygncHJldicpCgogICAgTW92ZXMgdG8gdGhlIHByZXZpb3VzIHNsaWRlLiBJZiB0aGUgZmlyc3Qgc2xpZGUgaXMgYWxyZWFkeSBhY3RpdmUsIHRoZQogICAgY2FsbCBpcyBpZ25vcmVkLgogICAgKi8KICAgIHByZXY6IGZ1bmN0aW9uKCkgewogICAgICBtZXRob2RzLmdvKGN1cnJlbnRJbmRleC0xKTsKICAgIH0sCgogICAgLyoKICAgIGpRdWVyeS5kZWNrKCdnZXRTbGlkZScsIGluZGV4KQoKICAgIGluZGV4OiBpbnRlZ2VyLCBvcHRpb25hbAoKICAgIFJldHVybnMgYSBqUXVlcnkgb2JqZWN0IGNvbnRhaW5pbmcgdGhlIHNsaWRlIGF0IGluZGV4LiBJZiBpbmRleCBpcyBub3QKICAgIHNwZWNpZmllZCwgdGhlIGN1cnJlbnQgc2xpZGUgaXMgcmV0dXJuZWQuCiAgICAqLwogICAgZ2V0U2xpZGU6IGZ1bmN0aW9uKGluZGV4KSB7CiAgICAgIGluZGV4ID0gdHlwZW9mIGluZGV4ICE9PSAndW5kZWZpbmVkJyA/IGluZGV4IDogY3VycmVudEluZGV4OwogICAgICBpZiAoIWluZGV4SW5Cb3VuZHMoaW5kZXgpKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgcmV0dXJuIHNsaWRlc1tpbmRleF07CiAgICB9LAoKICAgIC8qCiAgICBqUXVlcnkuZGVjaygnZ2V0U2xpZGVzJykKCiAgICBSZXR1cm5zIGFsbCBzbGlkZXMgYXMgYW4gYXJyYXkgb2YgalF1ZXJ5IG9iamVjdHMuCiAgICAqLwogICAgZ2V0U2xpZGVzOiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIHNsaWRlczsKICAgIH0sCgogICAgLyoKICAgIGpRdWVyeS5kZWNrKCdnZXRUb3BMZXZlbFNsaWRlcycpCgogICAgUmV0dXJucyBhbGwgc2xpZGVzIHRoYXQgYXJlIG5vdCBzdWJzbGlkZXMuCiAgICAqLwogICAgZ2V0VG9wTGV2ZWxTbGlkZXM6IGZ1bmN0aW9uKCkgewogICAgICB2YXIgdG9wTGV2ZWxTbGlkZXMgPSBbXTsKICAgICAgdmFyIHNsaWRlU2VsZWN0b3IgPSBvcHRpb25zLnNlbGVjdG9ycy5zbGlkZXM7CiAgICAgIHZhciBzdWJTZWxlY3RvciA9IFtzbGlkZVNlbGVjdG9yLCBzbGlkZVNlbGVjdG9yXS5qb2luKCcgJyk7CiAgICAgICQuZWFjaChzbGlkZXMsIGZ1bmN0aW9uKGksICRzbGlkZSkgewogICAgICAgIGlmICghJHNsaWRlLmlzKHN1YlNlbGVjdG9yKSkgewogICAgICAgICAgdG9wTGV2ZWxTbGlkZXMucHVzaCgkc2xpZGUpOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHJldHVybiB0b3BMZXZlbFNsaWRlczsKICAgIH0sCgogICAgLyoKICAgIGpRdWVyeS5kZWNrKCdnZXROZXN0ZWRTbGlkZXMnLCBpbmRleCkKCiAgICBpbmRleDogaW50ZWdlciwgb3B0aW9uYWwKCiAgICBSZXR1cm5zIGFsbCB0aGUgbmVzdGVkIHNsaWRlcyBvZiB0aGUgY3VycmVudCBzbGlkZS4gSWYgaW5kZXggaXMKICAgIHNwZWNpZmllZCBpdCByZXR1cm5zIHRoZSBuZXN0ZWQgc2xpZGVzIG9mIHRoZSBzbGlkZSBhdCB0aGF0IGluZGV4LgogICAgSWYgdGhlcmUgYXJlIG5vIG5lc3RlZCBzbGlkZXMgdGhpcyB3aWxsIHJldHVybiBhbiBlbXB0eSBhcnJheS4KICAgICovCiAgICBnZXROZXN0ZWRTbGlkZXM6IGZ1bmN0aW9uKGluZGV4KSB7CiAgICAgIHZhciB0YXJnZXRJbmRleCA9IGluZGV4ID09IG51bGwgPyBjdXJyZW50SW5kZXggOiBpbmRleDsKICAgICAgdmFyICR0YXJnZXRTbGlkZSA9ICQuZGVjaygnZ2V0U2xpZGUnLCB0YXJnZXRJbmRleCk7CiAgICAgIHZhciAkbmVzdGVkcyA9ICR0YXJnZXRTbGlkZS5maW5kKG9wdGlvbnMuc2VsZWN0b3JzLnNsaWRlcyk7CiAgICAgIHZhciBuZXN0ZWRzID0gJG5lc3RlZHMuZ2V0KCk7CiAgICAgIHJldHVybiAkLm1hcChuZXN0ZWRzLCBmdW5jdGlvbihzbGlkZSwgaSkgewogICAgICAgIHJldHVybiAkKHNsaWRlKTsKICAgICAgfSk7CiAgICB9LAoKCiAgICAvKgogICAgalF1ZXJ5LmRlY2soJ2dldENvbnRhaW5lcicpCgogICAgUmV0dXJucyBhIGpRdWVyeSBvYmplY3QgY29udGFpbmluZyB0aGUgZGVjayBjb250YWluZXIgYXMgZGVmaW5lZCBieSB0aGUKICAgIGNvbnRhaW5lciBvcHRpb24uCiAgICAqLwogICAgZ2V0Q29udGFpbmVyOiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuICRjb250YWluZXI7CiAgICB9LAoKICAgIC8qCiAgICBqUXVlcnkuZGVjaygnZ2V0T3B0aW9ucycpCgogICAgUmV0dXJucyB0aGUgb3B0aW9ucyBvYmplY3QgZm9yIHRoZSBkZWNrLCBpbmNsdWRpbmcgYW55IG92ZXJyaWRlcyB0aGF0CiAgICB3ZXJlIGRlZmluZWQgYXQgaW5pdGlhbGl6YXRpb24uCiAgICAqLwogICAgZ2V0T3B0aW9uczogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBvcHRpb25zOwogICAgfSwKCiAgICAvKgogICAgalF1ZXJ5LmRlY2soJ2V4dGVuZCcsIG5hbWUsIG1ldGhvZCkKCiAgICBuYW1lOiBzdHJpbmcKICAgIG1ldGhvZDogZnVuY3Rpb24KCiAgICBBZGRzIG1ldGhvZCB0byB0aGUgZGVjayBuYW1lc3BhY2Ugd2l0aCB0aGUga2V5IG9mIG5hbWUuIFRoaXMgZG9lc27igJl0CiAgICBnaXZlIGFjY2VzcyB0byBhbnkgcHJpdmF0ZSBtZW1iZXIgZGF0YSDigJQgcHVibGljIG1ldGhvZHMgbXVzdCBzdGlsbCBiZQogICAgdXNlZCB3aXRoaW4gbWV0aG9kIOKAlCBidXQgbGV0cyBleHRlbnNpb24gYXV0aG9ycyBwaWdneWJhY2sgb24gdGhlIGRlY2sKICAgIG5hbWVzcGFjZSByYXRoZXIgdGhhbiBwb2xsdXRlIGpRdWVyeS4KCiAgICAkLmRlY2soJ2V4dGVuZCcsICdhbGVydCcsIGZ1bmN0aW9uKG1zZykgewogICAgICAgYWxlcnQobXNnKTsKICAgIH0pOwoKICAgIC8vIEFsZXJ0cyAnYm9vbScKICAgICQuZGVjaygnYWxlcnQnLCAnYm9vbScpOwogICAgKi8KICAgIGV4dGVuZDogZnVuY3Rpb24obmFtZSwgbWV0aG9kKSB7CiAgICAgIG1ldGhvZHNbbmFtZV0gPSBtZXRob2Q7CiAgICB9CiAgfTsKCiAgLyogalF1ZXJ5IGV4dGVuc2lvbiAqLwogICQuZGVjayA9IGZ1bmN0aW9uKG1ldGhvZCwgYXJnKSB7CiAgICB2YXIgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSk7CiAgICBpZiAobWV0aG9kc1ttZXRob2RdKSB7CiAgICAgIHJldHVybiBtZXRob2RzW21ldGhvZF0uYXBwbHkodGhpcywgYXJncyk7CiAgICB9CiAgICBlbHNlIHsKICAgICAgcmV0dXJuIG1ldGhvZHMuaW5pdChtZXRob2QsIGFyZyk7CiAgICB9CiAgfTsKCiAgLyoKICBUaGUgZGVmYXVsdCBzZXR0aW5ncyBvYmplY3QgZm9yIGEgZGVjay4gQWxsIGRlY2sgZXh0ZW5zaW9ucyBzaG91bGQgZXh0ZW5kCiAgdGhpcyBvYmplY3QgdG8gYWRkIGRlZmF1bHRzIGZvciBhbnkgb2YgdGhlaXIgb3B0aW9ucy4KCiAgb3B0aW9ucy5jbGFzc2VzLmFmdGVyCiAgICBUaGlzIGNsYXNzIGlzIGFkZGVkIHRvIGFsbCBzbGlkZXMgdGhhdCBhcHBlYXIgYWZ0ZXIgdGhlICduZXh0JyBzbGlkZS4KCiAgb3B0aW9ucy5jbGFzc2VzLmJlZm9yZQogICAgVGhpcyBjbGFzcyBpcyBhZGRlZCB0byBhbGwgc2xpZGVzIHRoYXQgYXBwZWFyIGJlZm9yZSB0aGUgJ3ByZXZpb3VzJwogICAgc2xpZGUuCgogIG9wdGlvbnMuY2xhc3Nlcy5jaGlsZEN1cnJlbnQKICAgIFRoaXMgY2xhc3MgaXMgYWRkZWQgdG8gYWxsIGVsZW1lbnRzIGluIHRoZSBET00gdHJlZSBiZXR3ZWVuIHRoZQogICAgJ2N1cnJlbnQnIHNsaWRlIGFuZCB0aGUgZGVjayBjb250YWluZXIuIEZvciBzdGFuZGFyZCBzbGlkZXMsIHRoaXMgaXMKICAgIG1vc3RseSBzZWVuIGFuZCB1c2VkIGZvciBuZXN0ZWQgc2xpZGVzLgoKICBvcHRpb25zLmNsYXNzZXMuY3VycmVudAogICAgVGhpcyBjbGFzcyBpcyBhZGRlZCB0byB0aGUgY3VycmVudCBzbGlkZS4KCiAgb3B0aW9ucy5jbGFzc2VzLmxvYWRpbmcKICAgIFRoaXMgY2xhc3MgaXMgYXBwbGllZCB0byB0aGUgZGVjayBjb250YWluZXIgZHVyaW5nIGxvYWRpbmcgcGhhc2VzIGFuZCBpcwogICAgcHJpbWFyaWx5IHVzZWQgYXMgYSB3YXkgdG8gc2hvcnQgY2lyY3VpdCB0cmFuc2l0aW9ucyBiZXR3ZWVuIHN0YXRlcwogICAgd2hlcmUgc3VjaCB0cmFuc2l0aW9ucyBhcmUgZGlzdHJhY3Rpbmcgb3IgdW53YW50ZWQuICBGb3IgZXhhbXBsZSwgdGhpcwogICAgY2xhc3MgaXMgYXBwbGllZCBkdXJpbmcgZGVjayBpbml0aWFsaXphdGlvbiBhbmQgdGhlbiByZW1vdmVkIHRvIHByZXZlbnQKICAgIGFsbCB0aGUgc2xpZGVzIGZyb20gYXBwZWFyaW5nIHN0YWNrZWQgYW5kIHRyYW5zaXRpb25pbmcgaW50byBwbGFjZQogICAgb24gbG9hZC4KCiAgb3B0aW9ucy5jbGFzc2VzLm5leHQKICAgIFRoaXMgY2xhc3MgaXMgYWRkZWQgdG8gdGhlIHNsaWRlIGltbWVkaWF0ZWx5IGZvbGxvd2luZyB0aGUgJ2N1cnJlbnQnCiAgICBzbGlkZS4KCiAgb3B0aW9ucy5jbGFzc2VzLm9uUHJlZml4CiAgICBUaGlzIHByZWZpeCwgY29uY2F0ZW5hdGVkIHdpdGggdGhlIGN1cnJlbnQgc2xpZGUgaW5kZXgsIGlzIGFkZGVkIHRvIHRoZQogICAgZGVjayBjb250YWluZXIgYXMgeW91IGNoYW5nZSBzbGlkZXMuCgogIG9wdGlvbnMuY2xhc3Nlcy5wcmV2aW91cwogICAgVGhpcyBjbGFzcyBpcyBhZGRlZCB0byB0aGUgc2xpZGUgaW1tZWRpYXRlbHkgcHJlY2VkaW5nIHRoZSAnY3VycmVudCcKICAgIHNsaWRlLgoKICBvcHRpb25zLnNlbGVjdG9ycy5jb250YWluZXIKICAgIEVsZW1lbnRzIG1hdGNoZWQgYnkgdGhpcyBDU1Mgc2VsZWN0b3Igd2lsbCBiZSBjb25zaWRlcmVkIHRoZSBkZWNrCiAgICBjb250YWluZXIuIFRoZSBkZWNrIGNvbnRhaW5lciBpcyB1c2VkIHRvIHNjb3BlIGNlcnRhaW4gc3RhdGVzIG9mIHRoZQogICAgZGVjaywgYXMgd2l0aCB0aGUgb25QcmVmaXggb3B0aW9uLCBvciB3aXRoIGV4dGVuc2lvbnMgc3VjaCBhcyBkZWNrLmdvdG8KICAgIGFuZCBkZWNrLm1lbnUuCgogIG9wdGlvbnMuc2VsZWN0b3JzLnNsaWRlcwogICAgRWxlbWVudHMgbWF0Y2hlZCBieSB0aGlzIHNlbGVjdG9yIG1ha2UgdXAgdGhlIGluZGl2aWR1YWwgZGVjayBzbGlkZXMuCiAgICBJZiBhIHVzZXIgY2hvb3NlcyB0byBwYXNzIHRoZSBzbGlkZSBzZWxlY3RvciBhcyB0aGUgZmlyc3QgYXJndW1lbnQgdG8KICAgICQuZGVjaygpIG9uIGluaXRpYWxpemF0aW9uIGl0IGRvZXMgdGhlIHNhbWUgdGhpbmcgYXMgcGFzc2luZyBpbiB0aGlzCiAgICBvcHRpb24gYW5kIHRoaXMgb3B0aW9uIHZhbHVlIHdpbGwgYmUgc2V0IHRvIHRoZSB2YWx1ZSBvZiB0aGF0IHBhcmFtZXRlci4KCiAgb3B0aW9ucy5rZXlzLm5leHQKICAgIFRoZSBudW1lcmljIGtleWNvZGUgdXNlZCB0byBnbyB0byB0aGUgbmV4dCBzbGlkZS4KCiAgb3B0aW9ucy5rZXlzLnByZXZpb3VzCiAgICBUaGUgbnVtZXJpYyBrZXljb2RlIHVzZWQgdG8gZ28gdG8gdGhlIHByZXZpb3VzIHNsaWRlLgoKICBvcHRpb25zLnRvdWNoLnN3aXBlRGlyZWN0aW9uCiAgICBUaGUgZGlyZWN0aW9uIHN3aXBlcyBvY2N1ciB0byBjYXVzZSBzbGlkZSBjaGFuZ2VzLiBDYW4gYmUgJ2hvcml6b250YWwnLAogICAgJ3ZlcnRpY2FsJywgb3IgJ2JvdGgnLiBBbnkgb3RoZXIgdmFsdWUgb3IgYSBmYWxzeSB2YWx1ZSB3aWxsIGRpc2FibGUKICAgIHN3aXBlIGdlc3R1cmVzIGZvciBuYXZpZ2F0aW9uLgoKICBvcHRpb25zLnRvdWNoLnN3aXBlVG9sZXJhbmNlCiAgICBUaGUgbnVtYmVyIG9mIHBpeGVscyB0aGUgdXNlcnMgZmluZ2VyIG11c3QgdHJhdmVsIHRvIHByb2R1Y2UgYSBzd2lwZQogICAgZ2VzdHVyZS4KCiAgb3B0aW9ucy5pbml0TG9ja1RpbWVvdXQKICAgIFRoZSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzIHRoZSBpbml0IGV2ZW50IHdpbGwgd2FpdCBmb3IgQmVmb3JlSW5pdCBldmVudAogICAgbG9ja3MgdG8gYmUgcmVsZWFzZWQgYmVmb3JlIGZpcmluZyB0aGUgaW5pdCBldmVudCByZWdhcmRsZXNzLgoKICBvcHRpb25zLmhhc2hQcmVmaXgKICAgIEV2ZXJ5IHNsaWRlIHRoYXQgZG9lcyBub3QgaGF2ZSBhbiBpZCBpcyBhc3NpZ25lZCBvbmUgYXQgaW5pdGlhbGl6YXRpb24uCiAgICBBc3NpZ25lZCBpZHMgdGFrZSB0aGUgZm9ybSBvZiBoYXNoUHJlZml4ICsgc2xpZGVJbmRleCwgZS5nLiwgc2xpZGUtMCwKICAgIHNsaWRlLTEyLCBldGMuCgogIG9wdGlvbnMucHJldmVudEZyYWdtZW50U2Nyb2xsCiAgICBXaGVuIGRlZXAgbGlua2luZyB0byBhIGhhc2ggb2YgYSBuZXN0ZWQgc2xpZGUsIHRoaXMgc2Nyb2xscyB0aGUgZGVjawogICAgY29udGFpbmVyIHRvIHRoZSB0b3AsIHVuZG9pbmcgdGhlIG5hdHVyYWwgYnJvd3NlciBiZWhhdmlvciBvZiBzY3JvbGxpbmcKICAgIHRvIHRoZSBkb2N1bWVudCBmcmFnbWVudCBvbiBsb2FkLgoKICBvcHRpb25zLnNldEFyaWFIaWRkZW5zCiAgICBXaGVuIHNldCB0byB0cnVlLCBkZWNrLmpzIHdpbGwgc2V0IGFyaWEgaGlkZGVuIGF0dHJpYnV0ZXMgZm9yIHNsaWRlcwogICAgdGhhdCBkbyBub3QgYXBwZWFyIG9uc2NyZWVuIGFjY29yZGluZyB0byBhIHR5cGljYWwgaGVpcmFyY2hpY2FsCiAgICBkZWNrIHN0cnVjdHVyZS4gWW91IG1heSB3YW50IHRvIHR1cm4gdGhpcyBvZmYgaWYgeW91IGFyZSB1c2luZyBhIHRoZW1lCiAgICB3aGVyZSBzbGlkZXMgYmVzaWRlcyB0aGUgY3VycmVudCBzbGlkZSBhcmUgdmlzaWJsZSBvbiBzY3JlZW4gYW5kIHNob3VsZAogICAgYmUgYWNjZXNzaWJsZSB0byBzY3JlZW5yZWFkZXJzLgogICovCiAgJC5kZWNrLmRlZmF1bHRzID0gewogICAgY2xhc3NlczogewogICAgICBhZnRlcjogJ2RlY2stYWZ0ZXInLAogICAgICBiZWZvcmU6ICdkZWNrLWJlZm9yZScsCiAgICAgIGNoaWxkQ3VycmVudDogJ2RlY2stY2hpbGQtY3VycmVudCcsCiAgICAgIGN1cnJlbnQ6ICdkZWNrLWN1cnJlbnQnLAogICAgICBsb2FkaW5nOiAnZGVjay1sb2FkaW5nJywKICAgICAgbmV4dDogJ2RlY2stbmV4dCcsCiAgICAgIG9uUHJlZml4OiAnb24tc2xpZGUtJywKICAgICAgcHJldmlvdXM6ICdkZWNrLXByZXZpb3VzJwogICAgfSwKCiAgICBzZWxlY3RvcnM6IHsKICAgICAgY29udGFpbmVyOiAnLmRlY2stY29udGFpbmVyJywKICAgICAgc2xpZGVzOiAnLnNsaWRlJwogICAgfSwKCiAgICBrZXlzOiB7CiAgICAgIC8vIGVudGVyLCBzcGFjZSwgcGFnZSBkb3duLCByaWdodCBhcnJvdywgZG93biBhcnJvdywKICAgICAgbmV4dDogWzEzLCAzMiwgMzQsIDM5LCA0MF0sCiAgICAgIC8vIGJhY2tzcGFjZSwgcGFnZSB1cCwgbGVmdCBhcnJvdywgdXAgYXJyb3cKICAgICAgcHJldmlvdXM6IFs4LCAzMywgMzcsIDM4XQogICAgfSwKCiAgICB0b3VjaDogewogICAgICBzd2lwZURpcmVjdGlvbjogJ2hvcml6b250YWwnLAogICAgICBzd2lwZVRvbGVyYW5jZTogNjAKICAgIH0sCgogICAgaW5pdExvY2tUaW1lb3V0OiAxMDAwMCwKICAgIGhhc2hQcmVmaXg6ICdzbGlkZS0nLAogICAgcHJldmVudEZyYWdtZW50U2Nyb2xsOiB0cnVlLAogICAgc2V0QXJpYUhpZGRlbnM6IHRydWUKICB9OwoKICAkZG9jdW1lbnQucmVhZHkoZnVuY3Rpb24oKSB7CiAgICAkKCdodG1sJykuYWRkQ2xhc3MoJ3JlYWR5Jyk7CiAgfSk7CgogICR3aW5kb3cuYmluZCgnaGFzaGNoYW5nZS5kZWNrJywgZnVuY3Rpb24oZXZlbnQpIHsKICAgIGlmIChldmVudC5vcmlnaW5hbEV2ZW50ICYmIGV2ZW50Lm9yaWdpbmFsRXZlbnQubmV3VVJMKSB7CiAgICAgIGdvQnlIYXNoKGV2ZW50Lm9yaWdpbmFsRXZlbnQubmV3VVJMKTsKICAgIH0KICAgIGVsc2UgewogICAgICBnb0J5SGFzaCh3aW5kb3cubG9jYXRpb24uaGFzaCk7CiAgICB9CiAgfSk7CgogICR3aW5kb3cuYmluZCgnbG9hZC5kZWNrJywgZnVuY3Rpb24oKSB7CiAgICBpZiAob3B0aW9ucy5wcmV2ZW50RnJhZ21lbnRTY3JvbGwpIHsKICAgICAgJGNvbnRhaW5lci5zY3JvbGxMZWZ0KDApLnNjcm9sbFRvcCgwKTsKICAgIH0KICB9KTsKfSkoalF1ZXJ5KTsK",
                "body": "LyohCkRlY2sgSlMgLSBkZWNrLmNvcmUKQ29weXJpZ2h0IChjKSAyMDExLTIwMTQgQ2FsZWIgVHJvdWdodG9uCkR1YWwgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlLgpodHRwczovL2dpdGh1Yi5jb20vaW1ha2V3ZWJ0aGluZ3MvZGVjay5qcy9ibG9iL21hc3Rlci9NSVQtbGljZW5zZS50eHQKKi8KCi8qClRoZSBkZWNrLmNvcmUgbW9kdWxlIHByb3ZpZGVzIGFsbCB0aGUgYmFzaWMgZnVuY3Rpb25hbGl0eSBmb3IgY3JlYXRpbmcgYW5kCm1vdmluZyB0aHJvdWdoIGEgZGVjay4gIEl0IGRvZXMgc28gYnkgYXBwbHlpbmcgY2xhc3NlcyB0byBpbmRpY2F0ZSB0aGUgc3RhdGUgb2YKdGhlIGRlY2sgYW5kIGl0cyBzbGlkZXMsIGFsbG93aW5nIENTUyB0byB0YWtlIGNhcmUgb2YgdGhlIHZpc3VhbCByZXByZXNlbnRhdGlvbgpvZiBlYWNoIHN0YXRlLiAgSXQgYWxzbyBwcm92aWRlcyBtZXRob2RzIGZvciBuYXZpZ2F0aW5nIHRoZSBkZWNrIGFuZCBpbnNwZWN0aW5nCml0cyBzdGF0ZSwgYXMgd2VsbCBhcyBiYXNpYyBrZXkgYmluZGluZ3MgZm9yIGdvaW5nIHRvIHRoZSBuZXh0IGFuZCBwcmV2aW91cwpzbGlkZXMuICBNb3JlIGZ1bmN0aW9uYWxpdHkgaXMgcHJvdmlkZWQgYnkgd2hvbGx5IHNlcGFyYXRlIGV4dGVuc2lvbiBtb2R1bGVzCnRoYXQgdXNlIHRoZSBBUEkgcHJvdmlkZWQgYnkgY29yZS4KKi8KKGZ1bmN0aW9uKCQsIHVuZGVmaW5lZCkgewogIHZhciBzbGlkZXMsIGN1cnJlbnRJbmRleCwgJGNvbnRhaW5lciwgJGZyYWdtZW50TGlua3M7CgogIHZhciBldmVudHMgPSB7CiAgICAvKgogICAgVGhpcyBldmVudCBmaXJlcyBhdCB0aGUgYmVnaW5uaW5nIG9mIGEgc2xpZGUgY2hhbmdlLCBiZWZvcmUgdGhlIGFjdHVhbAogICAgY2hhbmdlIG9jY3Vycy4gSXRzIHB1cnBvc2UgaXMgdG8gZ2l2ZSBleHRlbnNpb24gYXV0aG9ycyBhIHdheSB0byBwcmV2ZW50CiAgICB0aGUgc2xpZGUgY2hhbmdlIGZyb20gb2NjdXJpbmcuIFRoaXMgaXMgZG9uZSBieSBjYWxsaW5nIHByZXZlbnREZWZhdWx0CiAgICBvbiB0aGUgZXZlbnQgb2JqZWN0IHdpdGhpbiB0aGlzIGV2ZW50LiBJZiB0aGF0IGlzIGRvbmUsIHRoZSBkZWNrLmNoYW5nZQogICAgZXZlbnQgd2lsbCBuZXZlciBiZSBmaXJlZCBhbmQgdGhlIHNsaWRlIHdpbGwgbm90IGNoYW5nZS4KICAgICovCiAgICBiZWZvcmVDaGFuZ2U6ICdkZWNrLmJlZm9yZUNoYW5nZScsCgogICAgLyoKICAgIFRoaXMgZXZlbnQgZmlyZXMgd2hlbmV2ZXIgdGhlIGN1cnJlbnQgc2xpZGUgY2hhbmdlcywgd2hldGhlciBieSB3YXkgb2YKICAgIG5leHQsIHByZXYsIG9yIGdvLiBUaGUgY2FsbGJhY2sgZnVuY3Rpb24gaXMgcGFzc2VkIHR3byBwYXJhbWV0ZXJzLCBmcm9tCiAgICBhbmQgdG8sIGVxdWFsIHRvIHRoZSBpbmRpY2VzIG9mIHRoZSBvbGQgc2xpZGUgYW5kIHRoZSBuZXcgc2xpZGUKICAgIHJlc3BlY3RpdmVseS4gSWYgcHJldmVudERlZmF1bHQgaXMgY2FsbGVkIG9uIHRoZSBldmVudCB3aXRoaW4gdGhpcyBoYW5kbGVyCiAgICB0aGUgc2xpZGUgY2hhbmdlIGRvZXMgbm90IG9jY3VyLgoKICAgICQoZG9jdW1lbnQpLmJpbmQoJ2RlY2suY2hhbmdlJywgZnVuY3Rpb24oZXZlbnQsIGZyb20sIHRvKSB7CiAgICAgICBhbGVydCgnTW92aW5nIGZyb20gc2xpZGUgJyArIGZyb20gKyAnIHRvICcgKyB0byk7CiAgICB9KTsKICAgICovCiAgICBjaGFuZ2U6ICdkZWNrLmNoYW5nZScsCgogICAgLyoKICAgIFRoaXMgZXZlbnQgZmlyZXMgYXQgdGhlIGJlZ2lubmluZyBvZiBkZWNrIGluaXRpYWxpemF0aW9uLiBUaGlzIGV2ZW50IG1ha2VzCiAgICBhIGdvb2QgaG9vayBmb3IgcHJlcHJvY2Vzc2luZyBleHRlbnNpb25zIGxvb2tpbmcgdG8gbW9kaWZ5IHRoZSBET00gYmVmb3JlCiAgICB0aGUgZGVjayBpcyBmdWxseSBpbml0aWFsaXplZC4gSXQgaXMgYWxzbyBwb3NzaWJsZSB0byBoYWx0IHRoZSBkZWNrLmluaXQKICAgIGV2ZW50IGZyb20gZmlyaW5nIHdoaWxlIHlvdSBkbyB0aGluZ3MgaW4gYmVmb3JlSW5pdC4gVGhpcyBjYW4gYmUgZG9uZSBieQogICAgY2FsbGluZyBsb2NrSW5pdCBvbiB0aGUgZXZlbnQgb2JqZWN0IHBhc3NlZCB0byB0aGlzIGV2ZW50LiBUaGUgaW5pdCBjYW4gYmUKICAgIHJlbGVhc2VkIGJ5IGNhbGxpbmcgcmVsZWFzZUluaXQuCgogICAgJChkb2N1bWVudCkuYmluZCgnZGVjay5iZWZvcmVJbml0JywgZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgZXZlbnQubG9ja0luaXQoKTsgLy8gaGFsdHMgZGVjay5pbml0IGV2ZW50CiAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgIGV2ZW50LnJlbGVhc2VJbml0KCk7IC8vIGRlY2suaW5pdCB3aWxsIG5vdyBmaXJlIDIgc2Vjb25kcyBsYXRlcgogICAgICB9LCAyMDAwKTsKICAgIH0pOwoKICAgIFRoZSBpbml0IGV2ZW50IHdpbGwgYmUgZmlyZWQgcmVnYXJkbGVzcyBvZiBsb2NrcyBhZnRlcgogICAgb3B0aW9ucy5pbml0TG9ja1RpbWVvdXQgbWlsbGlzZWNvbmRzLgogICAgKi8KICAgIGJlZm9yZUluaXRpYWxpemU6ICdkZWNrLmJlZm9yZUluaXQnLAoKICAgIC8qCiAgICBUaGlzIGV2ZW50IGZpcmVzIGF0IHRoZSBlbmQgb2YgZGVjayBpbml0aWFsaXphdGlvbi4gRXh0ZW5zaW9ucyBzaG91bGQKICAgIGltcGxlbWVudCBhbnkgY29kZSB0aGF0IHJlbGllcyBvbiB1c2VyIGV4dGVuc2libGUgb3B0aW9ucyAoa2V5IGJpbmRpbmdzLAogICAgZWxlbWVudCBzZWxlY3RvcnMsIGNsYXNzZXMpIHdpdGhpbiBhIGhhbmRsZXIgZm9yIHRoaXMgZXZlbnQuIE5hdGl2ZQogICAgZXZlbnRzIGFzc29jaWF0ZWQgd2l0aCBEZWNrIEpTIHNob3VsZCBiZSBzY29wZWQgdW5kZXIgYSAuZGVjayBldmVudAogICAgbmFtZXNwYWNlLCBhcyB3aXRoIHRoZSBleGFtcGxlIGJlbG93OgoKICAgIHZhciAkZCA9ICQoZG9jdW1lbnQpOwogICAgJC5kZWNrLmRlZmF1bHRzLmtleXMubXlFeHRlbnNpb25LZXljb2RlID0gNzA7IC8vICdoJwogICAgJGQuYmluZCgnZGVjay5pbml0JywgZnVuY3Rpb24oKSB7CiAgICAgICAkZC5iaW5kKCdrZXlkb3duLmRlY2snLCBmdW5jdGlvbihldmVudCkgewogICAgICAgICAgaWYgKGV2ZW50LndoaWNoID09PSAkLmRlY2suZ2V0T3B0aW9ucygpLmtleXMubXlFeHRlbnNpb25LZXljb2RlKSB7CiAgICAgICAgICAgICAvLyBSb2NrIG91dAogICAgICAgICAgfQogICAgICAgfSk7CiAgICB9KTsKICAgICovCiAgICBpbml0aWFsaXplOiAnZGVjay5pbml0JwogIH07CgogIHZhciBvcHRpb25zID0ge307CiAgdmFyICRkb2N1bWVudCA9ICQoZG9jdW1lbnQpOwogIHZhciAkd2luZG93ID0gJCh3aW5kb3cpOwogIHZhciBzdG9wUHJvcGFnYXRpb24gPSBmdW5jdGlvbihldmVudCkgewogICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgfTsKCiAgdmFyIHVwZGF0ZUNvbnRhaW5lclN0YXRlID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgb2xkSW5kZXggPSAkY29udGFpbmVyLmRhdGEoJ29uU2xpZGUnKTsKICAgICRjb250YWluZXIucmVtb3ZlQ2xhc3Mob3B0aW9ucy5jbGFzc2VzLm9uUHJlZml4ICsgb2xkSW5kZXgpOwogICAgJGNvbnRhaW5lci5hZGRDbGFzcyhvcHRpb25zLmNsYXNzZXMub25QcmVmaXggKyBjdXJyZW50SW5kZXgpOwogICAgJGNvbnRhaW5lci5kYXRhKCdvblNsaWRlJywgY3VycmVudEluZGV4KTsKICB9OwoKICB2YXIgdXBkYXRlQ2hpbGRDdXJyZW50ID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgJG9sZEN1cnJlbnQgPSAkKCcuJyArIG9wdGlvbnMuY2xhc3Nlcy5jdXJyZW50KTsKICAgIHZhciAkb2xkUGFyZW50cyA9ICRvbGRDdXJyZW50LnBhcmVudHNVbnRpbChvcHRpb25zLnNlbGVjdG9ycy5jb250YWluZXIpOwogICAgdmFyICRuZXdDdXJyZW50ID0gc2xpZGVzW2N1cnJlbnRJbmRleF07CiAgICB2YXIgJG5ld1BhcmVudHMgPSAkbmV3Q3VycmVudC5wYXJlbnRzVW50aWwob3B0aW9ucy5zZWxlY3RvcnMuY29udGFpbmVyKTsKICAgICRvbGRQYXJlbnRzLnJlbW92ZUNsYXNzKG9wdGlvbnMuY2xhc3Nlcy5jaGlsZEN1cnJlbnQpOwogICAgJG5ld1BhcmVudHMuYWRkQ2xhc3Mob3B0aW9ucy5jbGFzc2VzLmNoaWxkQ3VycmVudCk7CiAgfTsKCiAgdmFyIHJlbW92ZU9sZFNsaWRlU3RhdGVzID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgJGFsbCA9ICQoKTsKICAgICQuZWFjaChzbGlkZXMsIGZ1bmN0aW9uKGksIGVsKSB7CiAgICAgICRhbGwgPSAkYWxsLmFkZChlbCk7CiAgICB9KTsKICAgICRhbGwucmVtb3ZlQ2xhc3MoWwogICAgICBvcHRpb25zLmNsYXNzZXMuYmVmb3JlLAogICAgICBvcHRpb25zLmNsYXNzZXMucHJldmlvdXMsCiAgICAgIG9wdGlvbnMuY2xhc3Nlcy5jdXJyZW50LAogICAgICBvcHRpb25zLmNsYXNzZXMubmV4dCwKICAgICAgb3B0aW9ucy5jbGFzc2VzLmFmdGVyCiAgICBdLmpvaW4oJyAnKSk7CiAgfTsKCiAgdmFyIGFkZE5ld1NsaWRlU3RhdGVzID0gZnVuY3Rpb24oKSB7CiAgICBzbGlkZXNbY3VycmVudEluZGV4XS5hZGRDbGFzcyhvcHRpb25zLmNsYXNzZXMuY3VycmVudCk7CiAgICBpZiAoY3VycmVudEluZGV4ID4gMCkgewogICAgICBzbGlkZXNbY3VycmVudEluZGV4LTFdLmFkZENsYXNzKG9wdGlvbnMuY2xhc3Nlcy5wcmV2aW91cyk7CiAgICB9CiAgICBpZiAoY3VycmVudEluZGV4ICsgMSA8IHNsaWRlcy5sZW5ndGgpIHsKICAgICAgc2xpZGVzW2N1cnJlbnRJbmRleCsxXS5hZGRDbGFzcyhvcHRpb25zLmNsYXNzZXMubmV4dCk7CiAgICB9CiAgICBpZiAoY3VycmVudEluZGV4ID4gMSkgewogICAgICAkLmVhY2goc2xpZGVzLnNsaWNlKDAsIGN1cnJlbnRJbmRleCAtIDEpLCBmdW5jdGlvbihpLCAkc2xpZGUpIHsKICAgICAgICAkc2xpZGUuYWRkQ2xhc3Mob3B0aW9ucy5jbGFzc2VzLmJlZm9yZSk7CiAgICAgIH0pOwogICAgfQogICAgaWYgKGN1cnJlbnRJbmRleCArIDIgPCBzbGlkZXMubGVuZ3RoKSB7CiAgICAgICQuZWFjaChzbGlkZXMuc2xpY2UoY3VycmVudEluZGV4KzIpLCBmdW5jdGlvbihpLCAkc2xpZGUpIHsKICAgICAgICAkc2xpZGUuYWRkQ2xhc3Mob3B0aW9ucy5jbGFzc2VzLmFmdGVyKTsKICAgICAgfSk7CiAgICB9CiAgfTsKCiAgdmFyIHNldEFyaWFIaWRkZW5zID0gZnVuY3Rpb24oKSB7CiAgICAkKG9wdGlvbnMuc2VsZWN0b3JzLnNsaWRlcykuZWFjaChmdW5jdGlvbigpIHsKICAgICAgdmFyICRzbGlkZSA9ICQodGhpcyk7CiAgICAgIHZhciBpc1N1YiA9ICRzbGlkZS5jbG9zZXN0KCcuJyArIG9wdGlvbnMuY2xhc3Nlcy5jaGlsZEN1cnJlbnQpLmxlbmd0aDsKICAgICAgdmFyIGlzQmVmb3JlID0gJHNsaWRlLmhhc0NsYXNzKG9wdGlvbnMuY2xhc3Nlcy5iZWZvcmUpICYmICFpc1N1YjsKICAgICAgdmFyIGlzUHJldmlvdXMgPSAkc2xpZGUuaGFzQ2xhc3Mob3B0aW9ucy5jbGFzc2VzLnByZXZpb3VzKSAmJiAhaXNTdWI7CiAgICAgIHZhciBpc05leHQgPSAkc2xpZGUuaGFzQ2xhc3Mob3B0aW9ucy5jbGFzc2VzLm5leHQpOwogICAgICB2YXIgaXNBZnRlciA9ICRzbGlkZS5oYXNDbGFzcyhvcHRpb25zLmNsYXNzZXMuYWZ0ZXIpOwogICAgICB2YXIgYXJpYUhpZGRlblZhbHVlID0gaXNCZWZvcmUgfHwgaXNQcmV2aW91cyB8fCBpc05leHQgfHwgaXNBZnRlcjsKICAgICAgJHNsaWRlLmF0dHIoJ2FyaWEtaGlkZGVuJywgYXJpYUhpZGRlblZhbHVlKTsKICAgIH0pOwogIH07CgogIHZhciB1cGRhdGVTdGF0ZXMgPSBmdW5jdGlvbigpIHsKICAgIHVwZGF0ZUNvbnRhaW5lclN0YXRlKCk7CiAgICB1cGRhdGVDaGlsZEN1cnJlbnQoKTsKICAgIHJlbW92ZU9sZFNsaWRlU3RhdGVzKCk7CiAgICBhZGROZXdTbGlkZVN0YXRlcygpOwogICAgaWYgKG9wdGlvbnMuc2V0QXJpYUhpZGRlbnMpIHsKICAgICAgc2V0QXJpYUhpZGRlbnMoKTsKICAgIH0KICB9OwoKICB2YXIgaW5pdFNsaWRlc0FycmF5ID0gZnVuY3Rpb24oZWxlbWVudHMpIHsKICAgIGlmICgkLmlzQXJyYXkoZWxlbWVudHMpKSB7CiAgICAgICQuZWFjaChlbGVtZW50cywgZnVuY3Rpb24oaSwgZWxlbWVudCkgewogICAgICAgIHNsaWRlcy5wdXNoKCQoZWxlbWVudCkpOwogICAgICB9KTsKICAgIH0KICAgIGVsc2UgewogICAgICAkKGVsZW1lbnRzKS5lYWNoKGZ1bmN0aW9uKGksIGVsZW1lbnQpIHsKICAgICAgICBzbGlkZXMucHVzaCgkKGVsZW1lbnQpKTsKICAgICAgfSk7CiAgICB9CiAgfTsKCiAgdmFyIGJpbmRLZXlFdmVudHMgPSBmdW5jdGlvbigpIHsKICAgIHZhciBlZGl0YWJsZXMgPSBbCiAgICAgICdpbnB1dCcsCiAgICAgICd0ZXh0YXJlYScsCiAgICAgICdzZWxlY3QnLAogICAgICAnYnV0dG9uJywKICAgICAgJ21ldGVyJywKICAgICAgJ3Byb2dyZXNzJywKICAgICAgJ1tjb250ZW50RWRpdGFibGVdJwogICAgXS5qb2luKCcsICcpOwoKICAgICRkb2N1bWVudC51bmJpbmQoJ2tleWRvd24uZGVjaycpLmJpbmQoJ2tleWRvd24uZGVjaycsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgIHZhciBpc05leHQgPSBldmVudC53aGljaCA9PT0gb3B0aW9ucy5rZXlzLm5leHQ7CiAgICAgIHZhciBpc1ByZXYgPSBldmVudC53aGljaCA9PT0gb3B0aW9ucy5rZXlzLnByZXZpb3VzOwogICAgICBpc05leHQgPSBpc05leHQgfHwgJC5pbkFycmF5KGV2ZW50LndoaWNoLCBvcHRpb25zLmtleXMubmV4dCkgPiAtMTsKICAgICAgaXNQcmV2ID0gaXNQcmV2IHx8ICQuaW5BcnJheShldmVudC53aGljaCwgb3B0aW9ucy5rZXlzLnByZXZpb3VzKSA+IC0xOwoKICAgICAgaWYgKGlzTmV4dCkgewogICAgICAgIG1ldGhvZHMubmV4dCgpOwogICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIH0KICAgICAgZWxzZSBpZiAoaXNQcmV2KSB7CiAgICAgICAgbWV0aG9kcy5wcmV2KCk7CiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgfQogICAgfSk7CgogICAgJGRvY3VtZW50LnVuZGVsZWdhdGUoZWRpdGFibGVzLCAna2V5ZG93bi5kZWNrJywgc3RvcFByb3BhZ2F0aW9uKTsKICAgICRkb2N1bWVudC5kZWxlZ2F0ZShlZGl0YWJsZXMsICdrZXlkb3duLmRlY2snLCBzdG9wUHJvcGFnYXRpb24pOwogIH07CgogIHZhciBiaW5kVG91Y2hFdmVudHMgPSBmdW5jdGlvbigpIHsKICAgIHZhciBzdGFydFRvdWNoOwogICAgdmFyIGRpcmVjdGlvbiA9IG9wdGlvbnMudG91Y2guc3dpcGVEaXJlY3Rpb247CiAgICB2YXIgdG9sZXJhbmNlID0gb3B0aW9ucy50b3VjaC5zd2lwZVRvbGVyYW5jZTsKICAgIHZhciBsaXN0ZW5Ub0hvcml6b250YWwgPSAoeyBib3RoOiB0cnVlLCBob3Jpem9udGFsOiB0cnVlIH0pW2RpcmVjdGlvbl07CiAgICB2YXIgbGlzdGVuVG9WZXJ0aWNhbCA9ICh7IGJvdGg6IHRydWUsIHZlcnRpY2FsOiB0cnVlIH0pW2RpcmVjdGlvbl07CgogICAgJGNvbnRhaW5lci51bmJpbmQoJ3RvdWNoc3RhcnQuZGVjaycpOwogICAgJGNvbnRhaW5lci5iaW5kKCd0b3VjaHN0YXJ0LmRlY2snLCBmdW5jdGlvbihldmVudCkgewogICAgICBpZiAoIXN0YXJ0VG91Y2gpIHsKICAgICAgICBzdGFydFRvdWNoID0gJC5leHRlbmQoe30sIGV2ZW50Lm9yaWdpbmFsRXZlbnQudGFyZ2V0VG91Y2hlc1swXSk7CiAgICAgIH0KICAgIH0pOwoKICAgICRjb250YWluZXIudW5iaW5kKCd0b3VjaG1vdmUuZGVjaycpOwogICAgJGNvbnRhaW5lci5iaW5kKCd0b3VjaG1vdmUuZGVjaycsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICQuZWFjaChldmVudC5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzLCBmdW5jdGlvbihpLCB0b3VjaCkgewogICAgICAgIGlmICghc3RhcnRUb3VjaCB8fCB0b3VjaC5pZGVudGlmaWVyICE9PSBzdGFydFRvdWNoLmlkZW50aWZpZXIpIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICB2YXIgeERpc3RhbmNlID0gdG91Y2guc2NyZWVuWCAtIHN0YXJ0VG91Y2guc2NyZWVuWDsKICAgICAgICB2YXIgeURpc3RhbmNlID0gdG91Y2guc2NyZWVuWSAtIHN0YXJ0VG91Y2guc2NyZWVuWTsKICAgICAgICB2YXIgbGVmdFRvUmlnaHQgPSB4RGlzdGFuY2UgPiB0b2xlcmFuY2UgJiYgbGlzdGVuVG9Ib3Jpem9udGFsOwogICAgICAgIHZhciByaWdodFRvTGVmdCA9IHhEaXN0YW5jZSA8IC10b2xlcmFuY2UgJiYgbGlzdGVuVG9Ib3Jpem9udGFsOwogICAgICAgIHZhciB0b3BUb0JvdHRvbSA9IHlEaXN0YW5jZSA+IHRvbGVyYW5jZSAmJiBsaXN0ZW5Ub1ZlcnRpY2FsOwogICAgICAgIHZhciBib3R0b21Ub1RvcCA9IHlEaXN0YW5jZSA8IC10b2xlcmFuY2UgJiYgbGlzdGVuVG9WZXJ0aWNhbDsKCiAgICAgICAgaWYgKGxlZnRUb1JpZ2h0IHx8IHRvcFRvQm90dG9tKSB7CiAgICAgICAgICAkLmRlY2soJ3ByZXYnKTsKICAgICAgICAgIHN0YXJ0VG91Y2ggPSB1bmRlZmluZWQ7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKHJpZ2h0VG9MZWZ0IHx8IGJvdHRvbVRvVG9wKSB7CiAgICAgICAgICAkLmRlY2soJ25leHQnKTsKICAgICAgICAgIHN0YXJ0VG91Y2ggPSB1bmRlZmluZWQ7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfSk7CgogICAgICBpZiAobGlzdGVuVG9WZXJ0aWNhbCkgewogICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIH0KICAgIH0pOwoKICAgICRjb250YWluZXIudW5iaW5kKCd0b3VjaGVuZC5kZWNrJyk7CiAgICAkY29udGFpbmVyLmJpbmQoJ3RvdWNoZW5kLmRlY2snLCBmdW5jdGlvbihldmVudCkgewogICAgICAkLmVhY2goZXZlbnQub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlcywgZnVuY3Rpb24oaSwgdG91Y2gpIHsKICAgICAgICBpZiAoc3RhcnRUb3VjaCAmJiB0b3VjaC5pZGVudGlmaWVyID09PSBzdGFydFRvdWNoLmlkZW50aWZpZXIpIHsKICAgICAgICAgIHN0YXJ0VG91Y2ggPSB1bmRlZmluZWQ7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0pOwogIH07CgogIHZhciBpbmRleEluQm91bmRzID0gZnVuY3Rpb24oaW5kZXgpIHsKICAgIHJldHVybiB0eXBlb2YgaW5kZXggPT09ICdudW1iZXInICYmIGluZGV4ID49MCAmJiBpbmRleCA8IHNsaWRlcy5sZW5ndGg7CiAgfTsKCiAgdmFyIGNyZWF0ZUJlZm9yZUluaXRFdmVudCA9IGZ1bmN0aW9uKCkgewogICAgdmFyIGV2ZW50ID0gJC5FdmVudChldmVudHMuYmVmb3JlSW5pdGlhbGl6ZSk7CiAgICBldmVudC5sb2NrcyA9IDA7CiAgICBldmVudC5kb25lID0gJC5ub29wOwogICAgZXZlbnQubG9ja0luaXQgPSBmdW5jdGlvbigpIHsKICAgICAgKytldmVudC5sb2NrczsKICAgIH07CiAgICBldmVudC5yZWxlYXNlSW5pdCA9IGZ1bmN0aW9uKCkgewogICAgICAtLWV2ZW50LmxvY2tzOwogICAgICBpZiAoIWV2ZW50LmxvY2tzKSB7CiAgICAgICAgZXZlbnQuZG9uZSgpOwogICAgICB9CiAgICB9OwogICAgcmV0dXJuIGV2ZW50OwogIH07CgogIHZhciBnb0J5SGFzaCA9IGZ1bmN0aW9uKHN0cikgewogICAgdmFyIGlkID0gc3RyLnN1YnN0cihzdHIuaW5kZXhPZigiIyIpICsgMSk7CgogICAgJC5lYWNoKHNsaWRlcywgZnVuY3Rpb24oaSwgJHNsaWRlKSB7CiAgICAgIGlmICgkc2xpZGUuYXR0cignaWQnKSA9PT0gaWQpIHsKICAgICAgICAkLmRlY2soJ2dvJywgaSk7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9KTsKCiAgICAvLyBJZiB3ZSBkb24ndCBzZXQgdGhlc2UgdG8gMCB0aGUgY29udGFpbmVyIHNjcm9sbHMgZHVlIHRvIGhhc2hjaGFuZ2UKICAgIGlmIChvcHRpb25zLnByZXZlbnRGcmFnbWVudFNjcm9sbCkgewogICAgICAkLmRlY2soJ2dldENvbnRhaW5lcicpLnNjcm9sbExlZnQoMCkuc2Nyb2xsVG9wKDApOwogICAgfQogIH07CgogIHZhciBhc3NpZ25TbGlkZUlkID0gZnVuY3Rpb24oaSwgJHNsaWRlKSB7CiAgICB2YXIgY3VycmVudElkID0gJHNsaWRlLmF0dHIoJ2lkJyk7CiAgICB2YXIgcHJldmlvdXNseUFzc2lnbmVkID0gJHNsaWRlLmRhdGEoJ2RlY2tBc3NpZ25lZElkJykgPT09IGN1cnJlbnRJZDsKICAgIGlmICghY3VycmVudElkIHx8IHByZXZpb3VzbHlBc3NpZ25lZCkgewogICAgICAkc2xpZGUuYXR0cignaWQnLCBvcHRpb25zLmhhc2hQcmVmaXggKyBpKTsKICAgICAgJHNsaWRlLmRhdGEoJ2RlY2tBc3NpZ25lZElkJywgb3B0aW9ucy5oYXNoUHJlZml4ICsgaSk7CiAgICB9CiAgfTsKCiAgdmFyIHJlbW92ZUNvbnRhaW5lckhhc2hDbGFzcyA9IGZ1bmN0aW9uKGlkKSB7CiAgICAkY29udGFpbmVyLnJlbW92ZUNsYXNzKG9wdGlvbnMuY2xhc3Nlcy5vblByZWZpeCArIGlkKTsKICB9OwoKICB2YXIgYWRkQ29udGFpbmVySGFzaENsYXNzID0gZnVuY3Rpb24oaWQpIHsKICAgICRjb250YWluZXIuYWRkQ2xhc3Mob3B0aW9ucy5jbGFzc2VzLm9uUHJlZml4ICsgaWQpOwogIH07CgogIHZhciBzZXR1cEhhc2hCZWhhdmlvcnMgPSBmdW5jdGlvbigpIHsKICAgICRmcmFnbWVudExpbmtzID0gJCgpOwogICAgJC5lYWNoKHNsaWRlcywgZnVuY3Rpb24oaSwgJHNsaWRlKSB7CiAgICAgIHZhciBoYXNoOwoKICAgICAgYXNzaWduU2xpZGVJZChpLCAkc2xpZGUpOwogICAgICBoYXNoID0gJyMnICsgJHNsaWRlLmF0dHIoJ2lkJyk7CiAgICAgIGlmIChoYXNoID09PSB3aW5kb3cubG9jYXRpb24uaGFzaCkgewogICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgICAkLmRlY2soJ2dvJywgaSk7CiAgICAgICAgfSwgMSk7CiAgICAgIH0KICAgICAgJGZyYWdtZW50TGlua3MgPSAkZnJhZ21lbnRMaW5rcy5hZGQoJ2FbaHJlZj0iJyArIGhhc2ggKyAnIl0nKTsKICAgIH0pOwoKICAgIGlmIChzbGlkZXMubGVuZ3RoKSB7CiAgICAgIGFkZENvbnRhaW5lckhhc2hDbGFzcygkLmRlY2soJ2dldFNsaWRlJykuYXR0cignaWQnKSk7CiAgICB9OwogIH07CgogIHZhciBjaGFuZ2VIYXNoID0gZnVuY3Rpb24oZnJvbSwgdG8pIHsKICAgIHZhciBoYXNoID0gJyMnICsgJC5kZWNrKCdnZXRTbGlkZScsIHRvKS5hdHRyKCdpZCcpOwogICAgdmFyIGhhc2hQYXRoID0gd2luZG93LmxvY2F0aW9uLmhyZWYucmVwbGFjZSgvIy4qLywgJycpICsgaGFzaDsKCiAgICByZW1vdmVDb250YWluZXJIYXNoQ2xhc3MoJC5kZWNrKCdnZXRTbGlkZScsIGZyb20pLmF0dHIoJ2lkJykpOwogICAgYWRkQ29udGFpbmVySGFzaENsYXNzKCQuZGVjaygnZ2V0U2xpZGUnLCB0bykuYXR0cignaWQnKSk7CiAgICBpZiAoTW9kZXJuaXpyLmhpc3RvcnkpIHsKICAgICAgd2luZG93Lmhpc3RvcnkucmVwbGFjZVN0YXRlKHt9LCAiIiwgaGFzaFBhdGgpOwogICAgfQogIH07CgogIC8qIE1ldGhvZHMgZXhwb3NlZCBpbiB0aGUgalF1ZXJ5LmRlY2sgbmFtZXNwYWNlICovCiAgdmFyIG1ldGhvZHMgPSB7CgogICAgLyoKICAgIGpRdWVyeS5kZWNrKHNlbGVjdG9yLCBvcHRpb25zKQoKICAgIHNlbGVjdG9yOiBzdHJpbmcgfCBqUXVlcnkgfCBhcnJheQogICAgb3B0aW9uczogb2JqZWN0LCBvcHRpb25hbAoKICAgIEluaXRpYWxpemVzIHRoZSBkZWNrLCB1c2luZyBlYWNoIGVsZW1lbnQgbWF0Y2hlZCBieSBzZWxlY3RvciBhcyBhIHNsaWRlLgogICAgTWF5IGFsc28gYmUgcGFzc2VkIGFuIGFycmF5IG9mIHN0cmluZyBzZWxlY3RvcnMgb3IgalF1ZXJ5IG9iamVjdHMsIGluCiAgICB3aGljaCBjYXNlIGVhY2ggc2VsZWN0b3IgaW4gdGhlIGFycmF5IGlzIGNvbnNpZGVyZWQgYSBzbGlkZS4gVGhlIHNlY29uZAogICAgcGFyYW1ldGVyIGlzIGFuIG9wdGlvbmFsIG9wdGlvbnMgb2JqZWN0IHdoaWNoIHdpbGwgZXh0ZW5kIHRoZSBkZWZhdWx0CiAgICB2YWx1ZXMuCgogICAgVXNlcnMgbWF5IGFsc28gcGFzcyBvbmx5IGFuIG9wdGlvbnMgb2JqZWN0IHRvIGluaXQuIEluIHRoaXMgY2FzZSB0aGUgc2xpZGUKICAgIHNlbGVjdG9yIHdpbGwgYmUgb3B0aW9ucy5zZWxlY3RvcnMuc2xpZGVzIHdoaWNoIGRlZmF1bHRzIHRvIC5zbGlkZS4KCiAgICAkLmRlY2soJy5zbGlkZScpOwoKICAgIG9yCgogICAgJC5kZWNrKFsKICAgICAgICcjZmlyc3Qtc2xpZGUnLAogICAgICAgJyNzZWNvbmQtc2xpZGUnLAogICAgICAgJyNldGMnCiAgICBdKTsKICAgICovCiAgICBpbml0OiBmdW5jdGlvbihvcHRzKSB7CiAgICAgIHZhciBiZWZvcmVJbml0RXZlbnQgPSBjcmVhdGVCZWZvcmVJbml0RXZlbnQoKTsKICAgICAgdmFyIG92ZXJyaWRlcyA9IG9wdHM7CgogICAgICBpZiAoISQuaXNQbGFpbk9iamVjdChvcHRzKSkgewogICAgICAgIG92ZXJyaWRlcyA9IGFyZ3VtZW50c1sxXSB8fCB7fTsKICAgICAgICAkLmV4dGVuZCh0cnVlLCBvdmVycmlkZXMsIHsKICAgICAgICAgIHNlbGVjdG9yczogewogICAgICAgICAgICBzbGlkZXM6IGFyZ3VtZW50c1swXQogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CgogICAgICBvcHRpb25zID0gJC5leHRlbmQodHJ1ZSwge30sICQuZGVjay5kZWZhdWx0cywgb3ZlcnJpZGVzKTsKICAgICAgc2xpZGVzID0gW107CiAgICAgIGN1cnJlbnRJbmRleCA9IDA7CiAgICAgICRjb250YWluZXIgPSAkKG9wdGlvbnMuc2VsZWN0b3JzLmNvbnRhaW5lcik7CgogICAgICAvLyBIaWRlIHRoZSBkZWNrIHdoaWxlIHN0YXRlcyBhcmUgYmVpbmcgYXBwbGllZCB0byBraWxsIHRyYW5zaXRpb25zCiAgICAgICRjb250YWluZXIuYWRkQ2xhc3Mob3B0aW9ucy5jbGFzc2VzLmxvYWRpbmcpOwoKICAgICAgLy8gcG9wdWxhdGUgdGhlIGFycmF5IG9mIHNsaWRlcyBmb3IgcHJlLWluaXQKICAgICAgaW5pdFNsaWRlc0FycmF5KG9wdGlvbnMuc2VsZWN0b3JzLnNsaWRlcyk7CiAgICAgIC8vIFByZSBpbml0IGV2ZW50IGZvciBwcmVwcm9jZXNzaW5nIGhvb2tzCiAgICAgIGJlZm9yZUluaXRFdmVudC5kb25lID0gZnVuY3Rpb24oKSB7CiAgICAgICAgLy8gcmUtcG9wdWxhdGUgdGhlIGFycmF5IG9mIHNsaWRlcwogICAgICAgIHNsaWRlcyA9IFtdOwogICAgICAgIGluaXRTbGlkZXNBcnJheShvcHRpb25zLnNlbGVjdG9ycy5zbGlkZXMpOwogICAgICAgIHNldHVwSGFzaEJlaGF2aW9ycygpOwogICAgICAgIGJpbmRLZXlFdmVudHMoKTsKICAgICAgICBiaW5kVG91Y2hFdmVudHMoKTsKICAgICAgICAkY29udGFpbmVyLnNjcm9sbExlZnQoMCkuc2Nyb2xsVG9wKDApOwoKICAgICAgICBpZiAoc2xpZGVzLmxlbmd0aCkgewogICAgICAgICAgdXBkYXRlU3RhdGVzKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBTaG93IGRlY2sgYWdhaW4gbm93IHRoYXQgc2xpZGVzIGFyZSBpbiBwbGFjZQogICAgICAgICRjb250YWluZXIucmVtb3ZlQ2xhc3Mob3B0aW9ucy5jbGFzc2VzLmxvYWRpbmcpOwogICAgICAgICRkb2N1bWVudC50cmlnZ2VyKGV2ZW50cy5pbml0aWFsaXplKTsKICAgICAgfTsKCiAgICAgICRkb2N1bWVudC50cmlnZ2VyKGJlZm9yZUluaXRFdmVudCk7CiAgICAgIGlmICghYmVmb3JlSW5pdEV2ZW50LmxvY2tzKSB7CiAgICAgICAgYmVmb3JlSW5pdEV2ZW50LmRvbmUoKTsKICAgICAgfQogICAgICB3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICBpZiAoYmVmb3JlSW5pdEV2ZW50LmxvY2tzKSB7CiAgICAgICAgICBpZiAod2luZG93LmNvbnNvbGUpIHsKICAgICAgICAgICAgd2luZG93LmNvbnNvbGUud2FybignU29tZXRoaW5nIGxvY2tlZCBkZWNrIGluaXRpYWxpemF0aW9uXAogICAgICAgICAgICAgIHdpdGhvdXQgcmVsZWFzaW5nIGl0IGJlZm9yZSB0aGUgdGltZW91dC4gUHJvY2VlZGluZyB3aXRoXAogICAgICAgICAgICAgIGluaXRpYWxpemF0aW9uIGFueXdheS4nKTsKICAgICAgICAgIH0KICAgICAgICAgIGJlZm9yZUluaXRFdmVudC5kb25lKCk7CiAgICAgICAgfQogICAgICB9LCBvcHRpb25zLmluaXRMb2NrVGltZW91dCk7CiAgICB9LAoKICAgIC8qCiAgICBqUXVlcnkuZGVjaygnZ28nLCBpbmRleCkKCiAgICBpbmRleDogaW50ZWdlciB8IHN0cmluZwoKICAgIE1vdmVzIHRvIHRoZSBzbGlkZSBhdCB0aGUgc3BlY2lmaWVkIGluZGV4IGlmIGluZGV4IGlzIGEgbnVtYmVyLiBJbmRleCBpcwogICAgMC1iYXNlZCwgc28gJC5kZWNrKCdnbycsIDApOyB3aWxsIG1vdmUgdG8gdGhlIGZpcnN0IHNsaWRlLiBJZiBpbmRleCBpcyBhCiAgICBzdHJpbmcgdGhpcyB3aWxsIG1vdmUgdG8gdGhlIHNsaWRlIHdpdGggdGhlIHNwZWNpZmllZCBpZC4gSWYgaW5kZXggaXMgb3V0CiAgICBvZiBib3VuZHMgb3IgZG9lc24ndCBtYXRjaCBhIHNsaWRlIGlkIHRoZSBjYWxsIGlzIGlnbm9yZWQuCiAgICAqLwogICAgZ286IGZ1bmN0aW9uKGluZGV4T3JJZCkgewogICAgICB2YXIgYmVmb3JlQ2hhbmdlRXZlbnQgPSAkLkV2ZW50KGV2ZW50cy5iZWZvcmVDaGFuZ2UpOwogICAgICB2YXIgaW5kZXg7CgogICAgICAvKiBOdW1iZXIgaW5kZXgsIGVhc3kuICovCiAgICAgIGlmIChpbmRleEluQm91bmRzKGluZGV4T3JJZCkpIHsKICAgICAgICBpbmRleCA9IGluZGV4T3JJZDsKICAgICAgfQogICAgICAvKiBJZCBzdHJpbmcgaW5kZXgsIHNlYXJjaCBmb3IgaXQgYW5kIHNldCBpbnRlZ2VyIGluZGV4ICovCiAgICAgIGVsc2UgaWYgKHR5cGVvZiBpbmRleE9ySWQgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgJC5lYWNoKHNsaWRlcywgZnVuY3Rpb24oaSwgJHNsaWRlKSB7CiAgICAgICAgICBpZiAoJHNsaWRlLmF0dHIoJ2lkJykgPT09IGluZGV4T3JJZCkgewogICAgICAgICAgICBpbmRleCA9IGk7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgICBpZiAodHlwZW9mIGluZGV4ID09PSAndW5kZWZpbmVkJykgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgLyogVHJpZ2dlciBiZWZvcmVDaGFuZ2UuIElmIG5vdGhpbmcgcHJldmVudHMgdGhlIGNoYW5nZSwgdHJpZ2dlcgogICAgICB0aGUgc2xpZGUgY2hhbmdlLiAqLwogICAgICAkZG9jdW1lbnQudHJpZ2dlcihiZWZvcmVDaGFuZ2VFdmVudCwgW2N1cnJlbnRJbmRleCwgaW5kZXhdKTsKICAgICAgaWYgKCFiZWZvcmVDaGFuZ2VFdmVudC5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkgewogICAgICAgICRkb2N1bWVudC50cmlnZ2VyKGV2ZW50cy5jaGFuZ2UsIFtjdXJyZW50SW5kZXgsIGluZGV4XSk7CiAgICAgICAgY2hhbmdlSGFzaChjdXJyZW50SW5kZXgsIGluZGV4KTsKICAgICAgICBjdXJyZW50SW5kZXggPSBpbmRleDsKICAgICAgICB1cGRhdGVTdGF0ZXMoKTsKICAgICAgfQogICAgfSwKCiAgICAvKgogICAgalF1ZXJ5LmRlY2soJ25leHQnKQoKICAgIE1vdmVzIHRvIHRoZSBuZXh0IHNsaWRlLiBJZiB0aGUgbGFzdCBzbGlkZSBpcyBhbHJlYWR5IGFjdGl2ZSwgdGhlIGNhbGwKICAgIGlzIGlnbm9yZWQuCiAgICAqLwogICAgbmV4dDogZnVuY3Rpb24oKSB7CiAgICAgIG1ldGhvZHMuZ28oY3VycmVudEluZGV4KzEpOwogICAgfSwKCiAgICAvKgogICAgalF1ZXJ5LmRlY2soJ3ByZXYnKQoKICAgIE1vdmVzIHRvIHRoZSBwcmV2aW91cyBzbGlkZS4gSWYgdGhlIGZpcnN0IHNsaWRlIGlzIGFscmVhZHkgYWN0aXZlLCB0aGUKICAgIGNhbGwgaXMgaWdub3JlZC4KICAgICovCiAgICBwcmV2OiBmdW5jdGlvbigpIHsKICAgICAgbWV0aG9kcy5nbyhjdXJyZW50SW5kZXgtMSk7CiAgICB9LAoKICAgIC8qCiAgICBqUXVlcnkuZGVjaygnZ2V0U2xpZGUnLCBpbmRleCkKCiAgICBpbmRleDogaW50ZWdlciwgb3B0aW9uYWwKCiAgICBSZXR1cm5zIGEgalF1ZXJ5IG9iamVjdCBjb250YWluaW5nIHRoZSBzbGlkZSBhdCBpbmRleC4gSWYgaW5kZXggaXMgbm90CiAgICBzcGVjaWZpZWQsIHRoZSBjdXJyZW50IHNsaWRlIGlzIHJldHVybmVkLgogICAgKi8KICAgIGdldFNsaWRlOiBmdW5jdGlvbihpbmRleCkgewogICAgICBpbmRleCA9IHR5cGVvZiBpbmRleCAhPT0gJ3VuZGVmaW5lZCcgPyBpbmRleCA6IGN1cnJlbnRJbmRleDsKICAgICAgaWYgKCFpbmRleEluQm91bmRzKGluZGV4KSkgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIHJldHVybiBzbGlkZXNbaW5kZXhdOwogICAgfSwKCiAgICAvKgogICAgalF1ZXJ5LmRlY2soJ2dldFNsaWRlcycpCgogICAgUmV0dXJucyBhbGwgc2xpZGVzIGFzIGFuIGFycmF5IG9mIGpRdWVyeSBvYmplY3RzLgogICAgKi8KICAgIGdldFNsaWRlczogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBzbGlkZXM7CiAgICB9LAoKICAgIC8qCiAgICBqUXVlcnkuZGVjaygnZ2V0VG9wTGV2ZWxTbGlkZXMnKQoKICAgIFJldHVybnMgYWxsIHNsaWRlcyB0aGF0IGFyZSBub3Qgc3Vic2xpZGVzLgogICAgKi8KICAgIGdldFRvcExldmVsU2xpZGVzOiBmdW5jdGlvbigpIHsKICAgICAgdmFyIHRvcExldmVsU2xpZGVzID0gW107CiAgICAgIHZhciBzbGlkZVNlbGVjdG9yID0gb3B0aW9ucy5zZWxlY3RvcnMuc2xpZGVzOwogICAgICB2YXIgc3ViU2VsZWN0b3IgPSBbc2xpZGVTZWxlY3Rvciwgc2xpZGVTZWxlY3Rvcl0uam9pbignICcpOwogICAgICAkLmVhY2goc2xpZGVzLCBmdW5jdGlvbihpLCAkc2xpZGUpIHsKICAgICAgICBpZiAoISRzbGlkZS5pcyhzdWJTZWxlY3RvcikpIHsKICAgICAgICAgIHRvcExldmVsU2xpZGVzLnB1c2goJHNsaWRlKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICByZXR1cm4gdG9wTGV2ZWxTbGlkZXM7CiAgICB9LAoKICAgIC8qCiAgICBqUXVlcnkuZGVjaygnZ2V0TmVzdGVkU2xpZGVzJywgaW5kZXgpCgogICAgaW5kZXg6IGludGVnZXIsIG9wdGlvbmFsCgogICAgUmV0dXJucyBhbGwgdGhlIG5lc3RlZCBzbGlkZXMgb2YgdGhlIGN1cnJlbnQgc2xpZGUuIElmIGluZGV4IGlzCiAgICBzcGVjaWZpZWQgaXQgcmV0dXJucyB0aGUgbmVzdGVkIHNsaWRlcyBvZiB0aGUgc2xpZGUgYXQgdGhhdCBpbmRleC4KICAgIElmIHRoZXJlIGFyZSBubyBuZXN0ZWQgc2xpZGVzIHRoaXMgd2lsbCByZXR1cm4gYW4gZW1wdHkgYXJyYXkuCiAgICAqLwogICAgZ2V0TmVzdGVkU2xpZGVzOiBmdW5jdGlvbihpbmRleCkgewogICAgICB2YXIgdGFyZ2V0SW5kZXggPSBpbmRleCA9PSBudWxsID8gY3VycmVudEluZGV4IDogaW5kZXg7CiAgICAgIHZhciAkdGFyZ2V0U2xpZGUgPSAkLmRlY2soJ2dldFNsaWRlJywgdGFyZ2V0SW5kZXgpOwogICAgICB2YXIgJG5lc3RlZHMgPSAkdGFyZ2V0U2xpZGUuZmluZChvcHRpb25zLnNlbGVjdG9ycy5zbGlkZXMpOwogICAgICB2YXIgbmVzdGVkcyA9ICRuZXN0ZWRzLmdldCgpOwogICAgICByZXR1cm4gJC5tYXAobmVzdGVkcywgZnVuY3Rpb24oc2xpZGUsIGkpIHsKICAgICAgICByZXR1cm4gJChzbGlkZSk7CiAgICAgIH0pOwogICAgfSwKCgogICAgLyoKICAgIGpRdWVyeS5kZWNrKCdnZXRDb250YWluZXInKQoKICAgIFJldHVybnMgYSBqUXVlcnkgb2JqZWN0IGNvbnRhaW5pbmcgdGhlIGRlY2sgY29udGFpbmVyIGFzIGRlZmluZWQgYnkgdGhlCiAgICBjb250YWluZXIgb3B0aW9uLgogICAgKi8KICAgIGdldENvbnRhaW5lcjogZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiAkY29udGFpbmVyOwogICAgfSwKCiAgICAvKgogICAgalF1ZXJ5LmRlY2soJ2dldE9wdGlvbnMnKQoKICAgIFJldHVybnMgdGhlIG9wdGlvbnMgb2JqZWN0IGZvciB0aGUgZGVjaywgaW5jbHVkaW5nIGFueSBvdmVycmlkZXMgdGhhdAogICAgd2VyZSBkZWZpbmVkIGF0IGluaXRpYWxpemF0aW9uLgogICAgKi8KICAgIGdldE9wdGlvbnM6IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gb3B0aW9uczsKICAgIH0sCgogICAgLyoKICAgIGpRdWVyeS5kZWNrKCdleHRlbmQnLCBuYW1lLCBtZXRob2QpCgogICAgbmFtZTogc3RyaW5nCiAgICBtZXRob2Q6IGZ1bmN0aW9uCgogICAgQWRkcyBtZXRob2QgdG8gdGhlIGRlY2sgbmFtZXNwYWNlIHdpdGggdGhlIGtleSBvZiBuYW1lLiBUaGlzIGRvZXNu4oCZdAogICAgZ2l2ZSBhY2Nlc3MgdG8gYW55IHByaXZhdGUgbWVtYmVyIGRhdGEg4oCUIHB1YmxpYyBtZXRob2RzIG11c3Qgc3RpbGwgYmUKICAgIHVzZWQgd2l0aGluIG1ldGhvZCDigJQgYnV0IGxldHMgZXh0ZW5zaW9uIGF1dGhvcnMgcGlnZ3liYWNrIG9uIHRoZSBkZWNrCiAgICBuYW1lc3BhY2UgcmF0aGVyIHRoYW4gcG9sbHV0ZSBqUXVlcnkuCgogICAgJC5kZWNrKCdleHRlbmQnLCAnYWxlcnQnLCBmdW5jdGlvbihtc2cpIHsKICAgICAgIGFsZXJ0KG1zZyk7CiAgICB9KTsKCiAgICAvLyBBbGVydHMgJ2Jvb20nCiAgICAkLmRlY2soJ2FsZXJ0JywgJ2Jvb20nKTsKICAgICovCiAgICBleHRlbmQ6IGZ1bmN0aW9uKG5hbWUsIG1ldGhvZCkgewogICAgICBtZXRob2RzW25hbWVdID0gbWV0aG9kOwogICAgfQogIH07CgogIC8qIGpRdWVyeSBleHRlbnNpb24gKi8KICAkLmRlY2sgPSBmdW5jdGlvbihtZXRob2QsIGFyZykgewogICAgdmFyIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpOwogICAgaWYgKG1ldGhvZHNbbWV0aG9kXSkgewogICAgICByZXR1cm4gbWV0aG9kc1ttZXRob2RdLmFwcGx5KHRoaXMsIGFyZ3MpOwogICAgfQogICAgZWxzZSB7CiAgICAgIHJldHVybiBtZXRob2RzLmluaXQobWV0aG9kLCBhcmcpOwogICAgfQogIH07CgogIC8qCiAgVGhlIGRlZmF1bHQgc2V0dGluZ3Mgb2JqZWN0IGZvciBhIGRlY2suIEFsbCBkZWNrIGV4dGVuc2lvbnMgc2hvdWxkIGV4dGVuZAogIHRoaXMgb2JqZWN0IHRvIGFkZCBkZWZhdWx0cyBmb3IgYW55IG9mIHRoZWlyIG9wdGlvbnMuCgogIG9wdGlvbnMuY2xhc3Nlcy5hZnRlcgogICAgVGhpcyBjbGFzcyBpcyBhZGRlZCB0byBhbGwgc2xpZGVzIHRoYXQgYXBwZWFyIGFmdGVyIHRoZSAnbmV4dCcgc2xpZGUuCgogIG9wdGlvbnMuY2xhc3Nlcy5iZWZvcmUKICAgIFRoaXMgY2xhc3MgaXMgYWRkZWQgdG8gYWxsIHNsaWRlcyB0aGF0IGFwcGVhciBiZWZvcmUgdGhlICdwcmV2aW91cycKICAgIHNsaWRlLgoKICBvcHRpb25zLmNsYXNzZXMuY2hpbGRDdXJyZW50CiAgICBUaGlzIGNsYXNzIGlzIGFkZGVkIHRvIGFsbCBlbGVtZW50cyBpbiB0aGUgRE9NIHRyZWUgYmV0d2VlbiB0aGUKICAgICdjdXJyZW50JyBzbGlkZSBhbmQgdGhlIGRlY2sgY29udGFpbmVyLiBGb3Igc3RhbmRhcmQgc2xpZGVzLCB0aGlzIGlzCiAgICBtb3N0bHkgc2VlbiBhbmQgdXNlZCBmb3IgbmVzdGVkIHNsaWRlcy4KCiAgb3B0aW9ucy5jbGFzc2VzLmN1cnJlbnQKICAgIFRoaXMgY2xhc3MgaXMgYWRkZWQgdG8gdGhlIGN1cnJlbnQgc2xpZGUuCgogIG9wdGlvbnMuY2xhc3Nlcy5sb2FkaW5nCiAgICBUaGlzIGNsYXNzIGlzIGFwcGxpZWQgdG8gdGhlIGRlY2sgY29udGFpbmVyIGR1cmluZyBsb2FkaW5nIHBoYXNlcyBhbmQgaXMKICAgIHByaW1hcmlseSB1c2VkIGFzIGEgd2F5IHRvIHNob3J0IGNpcmN1aXQgdHJhbnNpdGlvbnMgYmV0d2VlbiBzdGF0ZXMKICAgIHdoZXJlIHN1Y2ggdHJhbnNpdGlvbnMgYXJlIGRpc3RyYWN0aW5nIG9yIHVud2FudGVkLiAgRm9yIGV4YW1wbGUsIHRoaXMKICAgIGNsYXNzIGlzIGFwcGxpZWQgZHVyaW5nIGRlY2sgaW5pdGlhbGl6YXRpb24gYW5kIHRoZW4gcmVtb3ZlZCB0byBwcmV2ZW50CiAgICBhbGwgdGhlIHNsaWRlcyBmcm9tIGFwcGVhcmluZyBzdGFja2VkIGFuZCB0cmFuc2l0aW9uaW5nIGludG8gcGxhY2UKICAgIG9uIGxvYWQuCgogIG9wdGlvbnMuY2xhc3Nlcy5uZXh0CiAgICBUaGlzIGNsYXNzIGlzIGFkZGVkIHRvIHRoZSBzbGlkZSBpbW1lZGlhdGVseSBmb2xsb3dpbmcgdGhlICdjdXJyZW50JwogICAgc2xpZGUuCgogIG9wdGlvbnMuY2xhc3Nlcy5vblByZWZpeAogICAgVGhpcyBwcmVmaXgsIGNvbmNhdGVuYXRlZCB3aXRoIHRoZSBjdXJyZW50IHNsaWRlIGluZGV4LCBpcyBhZGRlZCB0byB0aGUKICAgIGRlY2sgY29udGFpbmVyIGFzIHlvdSBjaGFuZ2Ugc2xpZGVzLgoKICBvcHRpb25zLmNsYXNzZXMucHJldmlvdXMKICAgIFRoaXMgY2xhc3MgaXMgYWRkZWQgdG8gdGhlIHNsaWRlIGltbWVkaWF0ZWx5IHByZWNlZGluZyB0aGUgJ2N1cnJlbnQnCiAgICBzbGlkZS4KCiAgb3B0aW9ucy5zZWxlY3RvcnMuY29udGFpbmVyCiAgICBFbGVtZW50cyBtYXRjaGVkIGJ5IHRoaXMgQ1NTIHNlbGVjdG9yIHdpbGwgYmUgY29uc2lkZXJlZCB0aGUgZGVjawogICAgY29udGFpbmVyLiBUaGUgZGVjayBjb250YWluZXIgaXMgdXNlZCB0byBzY29wZSBjZXJ0YWluIHN0YXRlcyBvZiB0aGUKICAgIGRlY2ssIGFzIHdpdGggdGhlIG9uUHJlZml4IG9wdGlvbiwgb3Igd2l0aCBleHRlbnNpb25zIHN1Y2ggYXMgZGVjay5nb3RvCiAgICBhbmQgZGVjay5tZW51LgoKICBvcHRpb25zLnNlbGVjdG9ycy5zbGlkZXMKICAgIEVsZW1lbnRzIG1hdGNoZWQgYnkgdGhpcyBzZWxlY3RvciBtYWtlIHVwIHRoZSBpbmRpdmlkdWFsIGRlY2sgc2xpZGVzLgogICAgSWYgYSB1c2VyIGNob29zZXMgdG8gcGFzcyB0aGUgc2xpZGUgc2VsZWN0b3IgYXMgdGhlIGZpcnN0IGFyZ3VtZW50IHRvCiAgICAkLmRlY2soKSBvbiBpbml0aWFsaXphdGlvbiBpdCBkb2VzIHRoZSBzYW1lIHRoaW5nIGFzIHBhc3NpbmcgaW4gdGhpcwogICAgb3B0aW9uIGFuZCB0aGlzIG9wdGlvbiB2YWx1ZSB3aWxsIGJlIHNldCB0byB0aGUgdmFsdWUgb2YgdGhhdCBwYXJhbWV0ZXIuCgogIG9wdGlvbnMua2V5cy5uZXh0CiAgICBUaGUgbnVtZXJpYyBrZXljb2RlIHVzZWQgdG8gZ28gdG8gdGhlIG5leHQgc2xpZGUuCgogIG9wdGlvbnMua2V5cy5wcmV2aW91cwogICAgVGhlIG51bWVyaWMga2V5Y29kZSB1c2VkIHRvIGdvIHRvIHRoZSBwcmV2aW91cyBzbGlkZS4KCiAgb3B0aW9ucy50b3VjaC5zd2lwZURpcmVjdGlvbgogICAgVGhlIGRpcmVjdGlvbiBzd2lwZXMgb2NjdXIgdG8gY2F1c2Ugc2xpZGUgY2hhbmdlcy4gQ2FuIGJlICdob3Jpem9udGFsJywKICAgICd2ZXJ0aWNhbCcsIG9yICdib3RoJy4gQW55IG90aGVyIHZhbHVlIG9yIGEgZmFsc3kgdmFsdWUgd2lsbCBkaXNhYmxlCiAgICBzd2lwZSBnZXN0dXJlcyBmb3IgbmF2aWdhdGlvbi4KCiAgb3B0aW9ucy50b3VjaC5zd2lwZVRvbGVyYW5jZQogICAgVGhlIG51bWJlciBvZiBwaXhlbHMgdGhlIHVzZXJzIGZpbmdlciBtdXN0IHRyYXZlbCB0byBwcm9kdWNlIGEgc3dpcGUKICAgIGdlc3R1cmUuCgogIG9wdGlvbnMuaW5pdExvY2tUaW1lb3V0CiAgICBUaGUgbnVtYmVyIG9mIG1pbGxpc2Vjb25kcyB0aGUgaW5pdCBldmVudCB3aWxsIHdhaXQgZm9yIEJlZm9yZUluaXQgZXZlbnQKICAgIGxvY2tzIHRvIGJlIHJlbGVhc2VkIGJlZm9yZSBmaXJpbmcgdGhlIGluaXQgZXZlbnQgcmVnYXJkbGVzcy4KCiAgb3B0aW9ucy5oYXNoUHJlZml4CiAgICBFdmVyeSBzbGlkZSB0aGF0IGRvZXMgbm90IGhhdmUgYW4gaWQgaXMgYXNzaWduZWQgb25lIGF0IGluaXRpYWxpemF0aW9uLgogICAgQXNzaWduZWQgaWRzIHRha2UgdGhlIGZvcm0gb2YgaGFzaFByZWZpeCArIHNsaWRlSW5kZXgsIGUuZy4sIHNsaWRlLTAsCiAgICBzbGlkZS0xMiwgZXRjLgoKICBvcHRpb25zLnByZXZlbnRGcmFnbWVudFNjcm9sbAogICAgV2hlbiBkZWVwIGxpbmtpbmcgdG8gYSBoYXNoIG9mIGEgbmVzdGVkIHNsaWRlLCB0aGlzIHNjcm9sbHMgdGhlIGRlY2sKICAgIGNvbnRhaW5lciB0byB0aGUgdG9wLCB1bmRvaW5nIHRoZSBuYXR1cmFsIGJyb3dzZXIgYmVoYXZpb3Igb2Ygc2Nyb2xsaW5nCiAgICB0byB0aGUgZG9jdW1lbnQgZnJhZ21lbnQgb24gbG9hZC4KCiAgb3B0aW9ucy5zZXRBcmlhSGlkZGVucwogICAgV2hlbiBzZXQgdG8gdHJ1ZSwgZGVjay5qcyB3aWxsIHNldCBhcmlhIGhpZGRlbiBhdHRyaWJ1dGVzIGZvciBzbGlkZXMKICAgIHRoYXQgZG8gbm90IGFwcGVhciBvbnNjcmVlbiBhY2NvcmRpbmcgdG8gYSB0eXBpY2FsIGhlaXJhcmNoaWNhbAogICAgZGVjayBzdHJ1Y3R1cmUuIFlvdSBtYXkgd2FudCB0byB0dXJuIHRoaXMgb2ZmIGlmIHlvdSBhcmUgdXNpbmcgYSB0aGVtZQogICAgd2hlcmUgc2xpZGVzIGJlc2lkZXMgdGhlIGN1cnJlbnQgc2xpZGUgYXJlIHZpc2libGUgb24gc2NyZWVuIGFuZCBzaG91bGQKICAgIGJlIGFjY2Vzc2libGUgdG8gc2NyZWVucmVhZGVycy4KICAqLwogICQuZGVjay5kZWZhdWx0cyA9IHsKICAgIGNsYXNzZXM6IHsKICAgICAgYWZ0ZXI6ICdkZWNrLWFmdGVyJywKICAgICAgYmVmb3JlOiAnZGVjay1iZWZvcmUnLAogICAgICBjaGlsZEN1cnJlbnQ6ICdkZWNrLWNoaWxkLWN1cnJlbnQnLAogICAgICBjdXJyZW50OiAnZGVjay1jdXJyZW50JywKICAgICAgbG9hZGluZzogJ2RlY2stbG9hZGluZycsCiAgICAgIG5leHQ6ICdkZWNrLW5leHQnLAogICAgICBvblByZWZpeDogJ29uLXNsaWRlLScsCiAgICAgIHByZXZpb3VzOiAnZGVjay1wcmV2aW91cycKICAgIH0sCgogICAgc2VsZWN0b3JzOiB7CiAgICAgIGNvbnRhaW5lcjogJy5kZWNrLWNvbnRhaW5lcicsCiAgICAgIHNsaWRlczogJy5zbGlkZScKICAgIH0sCgogICAga2V5czogewogICAgICAvLyBlbnRlciwgc3BhY2UsIHBhZ2UgZG93biwgcmlnaHQgYXJyb3csIGRvd24gYXJyb3csCiAgICAgIG5leHQ6IFsxMywgMzIsIDM0LCAzOSwgNDBdLAogICAgICAvLyBiYWNrc3BhY2UsIHBhZ2UgdXAsIGxlZnQgYXJyb3csIHVwIGFycm93CiAgICAgIHByZXZpb3VzOiBbOCwgMzMsIDM3LCAzOF0KICAgIH0sCgogICAgdG91Y2g6IHsKICAgICAgc3dpcGVEaXJlY3Rpb246ICdob3Jpem9udGFsJywKICAgICAgc3dpcGVUb2xlcmFuY2U6IDYwCiAgICB9LAoKICAgIGluaXRMb2NrVGltZW91dDogMTAwMDAsCiAgICBoYXNoUHJlZml4OiAnc2xpZGUtJywKICAgIHByZXZlbnRGcmFnbWVudFNjcm9sbDogdHJ1ZSwKICAgIHNldEFyaWFIaWRkZW5zOiB0cnVlCiAgfTsKCiAgJGRvY3VtZW50LnJlYWR5KGZ1bmN0aW9uKCkgewogICAgJCgnaHRtbCcpLmFkZENsYXNzKCdyZWFkeScpOwogIH0pOwoKICAkd2luZG93LmJpbmQoJ2hhc2hjaGFuZ2UuZGVjaycsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICBpZiAoZXZlbnQub3JpZ2luYWxFdmVudCAmJiBldmVudC5vcmlnaW5hbEV2ZW50Lm5ld1VSTCkgewogICAgICBnb0J5SGFzaChldmVudC5vcmlnaW5hbEV2ZW50Lm5ld1VSTCk7CiAgICB9CiAgICBlbHNlIHsKICAgICAgZ29CeUhhc2god2luZG93LmxvY2F0aW9uLmhhc2gpOwogICAgfQogIH0pOwoKICAkd2luZG93LmJpbmQoJ2xvYWQuZGVjaycsIGZ1bmN0aW9uKCkgewogICAgaWYgKG9wdGlvbnMucHJldmVudEZyYWdtZW50U2Nyb2xsKSB7CiAgICAgICRjb250YWluZXIuc2Nyb2xsTGVmdCgwKS5zY3JvbGxUb3AoMCk7CiAgICB9CiAgfSk7Cn0pKGpRdWVyeSk7Cg==",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Thu, 06 Nov 2014 20:15:33 GMT",
                    "Content-Length": "22981",
                    "Date": "Thu, 06 Nov 2014 20:15:33 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}