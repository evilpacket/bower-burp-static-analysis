{
    "url": "http://localhost:9999/hamweather/aerisjs/node_modules/yuidocjs/node_modules/yui/history-hash/history-hash.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Open redirection (DOM-based)",
    "issueType": 5243152,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based open redirection vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the target of a redirection in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause a redirection to an arbitrary external domain. This behavior can be leveraged to facilitate phishing attacks against users of the application. The ability to use an authentic application URL, targeting the correct domain with a valid SSL certificate (if SSL is used) lends credibility to the phishing attack because many users, even if they verify these features, will not notice the subsequent redirection to a different domain.<br><br><b>Note:</b> If an attacker is able to control the start of the string that is passed to the redirection API, then it may be possible to escalate this vulnerability into a JavaScript injection attack, by using a URL with the javascript: pseudo-protocol to execute arbitrary script code when the URL is processed by the browser.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based open redirection vulnerabilities is not to dynamically set redirection targets using data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing an arbitrary URL as a redirection target. In general, this is best achieved by using a whitelist of URLs that are permitted redirection targets, and strictly validating the target against this list before performing the redirection.",
    "issueDetail": "The application may be vulnerable to DOM-based open redirection. Data is read from <b>location.href</b> and written to <b>location.replace()</b> via the following statements:<ul><li>var location = Y.getLocation(),             base     = location.href.replace(/#.*$/, '');</li><li>location.replace(base + '#' + (HistoryHash.hashPrefix || '') + hash);</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/hamweather/aerisjs/node_modules/yuidocjs/node_modules/yui/history-hash/history-hash.js",
                "path": "/hamweather/aerisjs/node_modules/yuidocjs/node_modules/yui/history-hash/history-hash.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9oYW13ZWF0aGVyL2FlcmlzanMvbm9kZV9tb2R1bGVzL3l1aWRvY2pzL25vZGVfbW9kdWxlcy95dWkvaGlzdG9yeS1oYXNoL2hpc3RvcnktaGFzaC5qcyBIVFRQLzEuMQ0KSG9zdDogbG9jYWxob3N0Ojk5OTkNCg0K",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMTQ2MzcNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IFRodSwgMDYgTm92IDIwMTQgMDY6Mzk6MjQgR01UDQpMYXN0LU1vZGlmaWVkOiBUaHUsIDA2IE5vdiAyMDE0IDA2OjM4OjMxIEdNVA0KDQpZVUkuYWRkKCdoaXN0b3J5LWhhc2gnLCBmdW5jdGlvbiAoWSwgTkFNRSkgewoKLyoqCiAqIFByb3ZpZGVzIGJyb3dzZXIgaGlzdG9yeSBtYW5hZ2VtZW50IGJhY2tlZCBieQogKiA8Y29kZT53aW5kb3cubG9jYXRpb24uaGFzaDwvY29kZT4sIGFzIHdlbGwgYXMgY29udmVuaWVuY2UgbWV0aG9kcyBmb3Igd29ya2luZwogKiB3aXRoIHRoZSBsb2NhdGlvbiBoYXNoIGFuZCBhIHN5bnRoZXRpYyA8Y29kZT5oYXNoY2hhbmdlPC9jb2RlPiBldmVudCB0aGF0CiAqIG5vcm1hbGl6ZXMgZGlmZmVyZW5jZXMgYWNyb3NzIGJyb3dzZXJzLgogKgogKiBAbW9kdWxlIGhpc3RvcnkKICogQHN1Ym1vZHVsZSBoaXN0b3J5LWhhc2gKICogQHNpbmNlIDMuMi4wCiAqIEBjbGFzcyBIaXN0b3J5SGFzaAogKiBAZXh0ZW5kcyBIaXN0b3J5QmFzZQogKiBAY29uc3RydWN0b3IKICogQHBhcmFtIHtPYmplY3R9IGNvbmZpZyAob3B0aW9uYWwpIENvbmZpZ3VyYXRpb24gb2JqZWN0LiBTZWUgdGhlIEhpc3RvcnlCYXNlCiAqICAgZG9jdW1lbnRhdGlvbiBmb3IgZGV0YWlscy4KICovCgp2YXIgSGlzdG9yeUJhc2UgPSBZLkhpc3RvcnlCYXNlLAogICAgTGFuZyAgICAgICAgPSBZLkxhbmcsCiAgICBZQXJyYXkgICAgICA9IFkuQXJyYXksCiAgICBZT2JqZWN0ICAgICA9IFkuT2JqZWN0LAogICAgR2xvYmFsRW52ICAgPSBZVUkubmFtZXNwYWNlKCdFbnYuSGlzdG9yeUhhc2gnKSwKCiAgICBTUkNfSEFTSCAgICA9ICdoYXNoJywKCiAgICBoYXNoTm90aWZpZXJzLAogICAgb2xkSGFzaCwKICAgIG9sZFVybCwKICAgIHdpbiAgICAgICAgICAgICA9IFkuY29uZmlnLndpbiwKICAgIHVzZUhpc3RvcnlIVE1MNSA9IFkuY29uZmlnLnVzZUhpc3RvcnlIVE1MNTsKCmZ1bmN0aW9uIEhpc3RvcnlIYXNoKCkgewogICAgSGlzdG9yeUhhc2guc3VwZXJjbGFzcy5jb25zdHJ1Y3Rvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwp9CgpZLmV4dGVuZChIaXN0b3J5SGFzaCwgSGlzdG9yeUJhc2UsIHsKICAgIC8vIC0tIEluaXRpYWxpemF0aW9uIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIF9pbml0OiBmdW5jdGlvbiAoY29uZmlnKSB7CiAgICAgICAgdmFyIGJvb2ttYXJrZWRTdGF0ZSA9IEhpc3RvcnlIYXNoLnBhcnNlSGFzaCgpOwoKICAgICAgICAvLyBJZiBhbiBpbml0aWFsU3RhdGUgd2FzIHByb3ZpZGVkLCBtZXJnZSB0aGUgYm9va21hcmtlZCBzdGF0ZSBpbnRvIGl0CiAgICAgICAgLy8gKHRoZSBib29rbWFya2VkIHN0YXRlIHdpbnMpLgogICAgICAgIGNvbmZpZyA9IGNvbmZpZyB8fCB7fTsKCiAgICAgICAgdGhpcy5faW5pdGlhbFN0YXRlID0gY29uZmlnLmluaXRpYWxTdGF0ZSA/CiAgICAgICAgICAgICAgICBZLm1lcmdlKGNvbmZpZy5pbml0aWFsU3RhdGUsIGJvb2ttYXJrZWRTdGF0ZSkgOiBib29rbWFya2VkU3RhdGU7CgogICAgICAgIC8vIFN1YnNjcmliZSB0byB0aGUgc3ludGhldGljIGhhc2hjaGFuZ2UgZXZlbnQgKGRlZmluZWQgYmVsb3cpIHRvIGhhbmRsZQogICAgICAgIC8vIGNoYW5nZXMuCiAgICAgICAgWS5hZnRlcignaGFzaGNoYW5nZScsIFkuYmluZCh0aGlzLl9hZnRlckhhc2hDaGFuZ2UsIHRoaXMpLCB3aW4pOwoKICAgICAgICBIaXN0b3J5SGFzaC5zdXBlcmNsYXNzLl9pbml0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICB9LAoKICAgIC8vIC0tIFByb3RlY3RlZCBNZXRob2RzIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIF9jaGFuZ2U6IGZ1bmN0aW9uIChzcmMsIHN0YXRlLCBvcHRpb25zKSB7CiAgICAgICAgLy8gU3RyaW5naWZ5IGFsbCB2YWx1ZXMgdG8gZW5zdXJlIHRoYXQgY29tcGFyaXNvbnMgZG9uJ3QgZmFpbCBhZnRlcgogICAgICAgIC8vIHRoZXkncmUgY29lcmNlZCB0byBzdHJpbmdzIGluIHRoZSBsb2NhdGlvbiBoYXNoLgogICAgICAgIFlPYmplY3QuZWFjaChzdGF0ZSwgZnVuY3Rpb24gKHZhbHVlLCBrZXkpIHsKICAgICAgICAgICAgaWYgKExhbmcuaXNWYWx1ZSh2YWx1ZSkpIHsKICAgICAgICAgICAgICAgIHN0YXRlW2tleV0gPSB2YWx1ZS50b1N0cmluZygpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIHJldHVybiBIaXN0b3J5SGFzaC5zdXBlcmNsYXNzLl9jaGFuZ2UuY2FsbCh0aGlzLCBzcmMsIHN0YXRlLCBvcHRpb25zKTsKICAgIH0sCgogICAgX3N0b3JlU3RhdGU6IGZ1bmN0aW9uIChzcmMsIG5ld1N0YXRlKSB7CiAgICAgICAgdmFyIGRlY29kZSAgPSBIaXN0b3J5SGFzaC5kZWNvZGUsCiAgICAgICAgICAgIG5ld0hhc2ggPSBIaXN0b3J5SGFzaC5jcmVhdGVIYXNoKG5ld1N0YXRlKTsKCiAgICAgICAgSGlzdG9yeUhhc2guc3VwZXJjbGFzcy5fc3RvcmVTdGF0ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwoKICAgICAgICAvLyBVcGRhdGUgdGhlIGxvY2F0aW9uIGhhc2ggd2l0aCB0aGUgY2hhbmdlcywgYnV0IG9ubHkgaWYgdGhlIG5ldyBoYXNoCiAgICAgICAgLy8gYWN0dWFsbHkgZGlmZmVycyBmcm9tIHRoZSBjdXJyZW50IGhhc2ggKHRoaXMgYXZvaWRzIGNyZWF0aW5nIG11bHRpcGxlCiAgICAgICAgLy8gaGlzdG9yeSBlbnRyaWVzIGZvciBhIHNpbmdsZSBzdGF0ZSkuCiAgICAgICAgLy8KICAgICAgICAvLyBXZSBhbHdheXMgY29tcGFyZSBkZWNvZGVkIGhhc2hlcywgc2luY2UgaXQncyBwb3NzaWJsZSB0aGF0IHRoZSBoYXNoCiAgICAgICAgLy8gY291bGQgYmUgc2V0IGluY29ycmVjdGx5IHRvIGEgbm9uLWVuY29kZWQgdmFsdWUgb3V0c2lkZSBvZgogICAgICAgIC8vIEhpc3RvcnlIYXNoLgogICAgICAgIGlmIChzcmMgIT09IFNSQ19IQVNIICYmIGRlY29kZShIaXN0b3J5SGFzaC5nZXRIYXNoKCkpICE9PSBkZWNvZGUobmV3SGFzaCkpIHsKICAgICAgICAgICAgSGlzdG9yeUhhc2hbc3JjID09PSBIaXN0b3J5QmFzZS5TUkNfUkVQTEFDRSA/ICdyZXBsYWNlSGFzaCcgOiAnc2V0SGFzaCddKG5ld0hhc2gpOwogICAgICAgIH0KICAgIH0sCgogICAgLy8gLS0gUHJvdGVjdGVkIEV2ZW50IEhhbmRsZXJzIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKICAgIC8qKgogICAgICogSGFuZGxlciBmb3IgaGFzaGNoYW5nZSBldmVudHMuCiAgICAgKgogICAgICogQG1ldGhvZCBfYWZ0ZXJIYXNoQ2hhbmdlCiAgICAgKiBAcGFyYW0ge0V2ZW50fSBlCiAgICAgKiBAcHJvdGVjdGVkCiAgICAgKi8KICAgIF9hZnRlckhhc2hDaGFuZ2U6IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdGhpcy5fcmVzb2x2ZUNoYW5nZXMoU1JDX0hBU0gsIEhpc3RvcnlIYXNoLnBhcnNlSGFzaChlLm5ld0hhc2gpLCB7fSk7CiAgICB9Cn0sIHsKICAgIC8vIC0tIFB1YmxpYyBTdGF0aWMgUHJvcGVydGllcyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIE5BTUU6ICdoaXN0b3J5SGFzaCcsCgogICAgLyoqCiAgICAgKiBDb25zdGFudCB1c2VkIHRvIGlkZW50aWZ5IHN0YXRlIGNoYW5nZXMgb3JpZ2luYXRpbmcgZnJvbQogICAgICogPGNvZGU+aGFzaGNoYW5nZTwvY29kZT4gZXZlbnRzLgogICAgICoKICAgICAqIEBwcm9wZXJ0eSBTUkNfSEFTSAogICAgICogQHR5cGUgU3RyaW5nCiAgICAgKiBAc3RhdGljCiAgICAgKiBAZmluYWwKICAgICAqLwogICAgU1JDX0hBU0g6IFNSQ19IQVNILAoKICAgIC8qKgogICAgICogPHA+CiAgICAgKiBQcmVmaXggdG8gcHJlcGVuZCB3aGVuIHNldHRpbmcgdGhlIGhhc2ggZnJhZ21lbnQuIEZvciBleGFtcGxlLCBpZiB0aGUKICAgICAqIHByZWZpeCBpcyA8Y29kZT4hPC9jb2RlPiBhbmQgdGhlIGhhc2ggZnJhZ21lbnQgaXMgc2V0IHRvCiAgICAgKiA8Y29kZT4jZm9vPWJhciZiYXo9cXV1eDwvY29kZT4sIHRoZSBmaW5hbCBoYXNoIGZyYWdtZW50IGluIHRoZSBVUkwgd2lsbAogICAgICogYmVjb21lIDxjb2RlPiMhZm9vPWJhciZiYXo9cXV1eDwvY29kZT4uIFRoaXMgY2FuIGJlIHVzZWQgdG8gaGVscCBtYWtlIGFuCiAgICAgKiBBamF4IGFwcGxpY2F0aW9uIGNyYXdsYWJsZSBpbiBhY2NvcmRhbmNlIHdpdGggR29vZ2xlJ3MgZ3VpZGVsaW5lcyBhdAogICAgICogPGEgaHJlZj0iaHR0cDovL2NvZGUuZ29vZ2xlLmNvbS93ZWIvYWpheGNyYXdsaW5nLyI+aHR0cDovL2NvZGUuZ29vZ2xlLmNvbS93ZWIvYWpheGNyYXdsaW5nLzwvYT4uCiAgICAgKiA8L3A+CiAgICAgKgogICAgICogPHA+CiAgICAgKiBOb3RlIHRoYXQgdGhpcyBwcmVmaXggYXBwbGllcyB0byBhbGwgSGlzdG9yeUhhc2ggaW5zdGFuY2VzLiBJdCdzIG5vdAogICAgICogcG9zc2libGUgZm9yIGluZGl2aWR1YWwgaW5zdGFuY2VzIHRvIHVzZSB0aGVpciBvd24gcHJlZml4ZXMgc2luY2UgdGhleQogICAgICogYWxsIG9wZXJhdGUgb24gdGhlIHNhbWUgVVJMLgogICAgICogPC9wPgogICAgICoKICAgICAqIEBwcm9wZXJ0eSBoYXNoUHJlZml4CiAgICAgKiBAdHlwZSBTdHJpbmcKICAgICAqIEBkZWZhdWx0ICcnCiAgICAgKiBAc3RhdGljCiAgICAgKi8KICAgIGhhc2hQcmVmaXg6ICcnLAoKICAgIC8vIC0tIFByb3RlY3RlZCBTdGF0aWMgUHJvcGVydGllcyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgICAvKioKICAgICAqIFJlZ3VsYXIgZXhwcmVzc2lvbiB1c2VkIHRvIHBhcnNlIGxvY2F0aW9uIGhhc2gvcXVlcnkgc3RyaW5ncy4KICAgICAqCiAgICAgKiBAcHJvcGVydHkgX1JFR0VYX0hBU0gKICAgICAqIEB0eXBlIFJlZ0V4cAogICAgICogQHByb3RlY3RlZAogICAgICogQHN0YXRpYwogICAgICogQGZpbmFsCiAgICAgKi8KICAgIF9SRUdFWF9IQVNIOiAvKFteXD8jJj1dKyk9PyhbXiY9XSopL2csCgogICAgLy8gLS0gUHVibGljIFN0YXRpYyBNZXRob2RzIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKICAgIC8qKgogICAgICogQ3JlYXRlcyBhIGxvY2F0aW9uIGhhc2ggc3RyaW5nIGZyb20gdGhlIHNwZWNpZmllZCBvYmplY3Qgb2Yga2V5L3ZhbHVlCiAgICAgKiBwYWlycy4KICAgICAqCiAgICAgKiBAbWV0aG9kIGNyZWF0ZUhhc2gKICAgICAqIEBwYXJhbSB7T2JqZWN0fSBwYXJhbXMgb2JqZWN0IG9mIGtleS92YWx1ZSBwYXJhbWV0ZXIgcGFpcnMKICAgICAqIEByZXR1cm4ge1N0cmluZ30gbG9jYXRpb24gaGFzaCBzdHJpbmcKICAgICAqIEBzdGF0aWMKICAgICAqLwogICAgY3JlYXRlSGFzaDogZnVuY3Rpb24gKHBhcmFtcykgewogICAgICAgIHZhciBlbmNvZGUgPSBIaXN0b3J5SGFzaC5lbmNvZGUsCiAgICAgICAgICAgIGhhc2ggICA9IFtdOwoKICAgICAgICBZT2JqZWN0LmVhY2gocGFyYW1zLCBmdW5jdGlvbiAodmFsdWUsIGtleSkgewogICAgICAgICAgICBpZiAoTGFuZy5pc1ZhbHVlKHZhbHVlKSkgewogICAgICAgICAgICAgICAgaGFzaC5wdXNoKGVuY29kZShrZXkpICsgJz0nICsgZW5jb2RlKHZhbHVlKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgcmV0dXJuIGhhc2guam9pbignJicpOwogICAgfSwKCiAgICAvKioKICAgICAqIFdyYXBwZXIgYXJvdW5kIDxjb2RlPmRlY29kZVVSSUNvbXBvbmVudCgpPC9jb2RlPiB0aGF0IGFsc28gY29udmVydHMgKwogICAgICogY2hhcnMgaW50byBzcGFjZXMuCiAgICAgKgogICAgICogQG1ldGhvZCBkZWNvZGUKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBzdHJpbmcgc3RyaW5nIHRvIGRlY29kZQogICAgICogQHJldHVybiB7U3RyaW5nfSBkZWNvZGVkIHN0cmluZwogICAgICogQHN0YXRpYwogICAgICovCiAgICBkZWNvZGU6IGZ1bmN0aW9uIChzdHJpbmcpIHsKICAgICAgICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KHN0cmluZy5yZXBsYWNlKC9cKy9nLCAnICcpKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBXcmFwcGVyIGFyb3VuZCA8Y29kZT5lbmNvZGVVUklDb21wb25lbnQoKTwvY29kZT4gdGhhdCBjb252ZXJ0cyBzcGFjZXMgdG8KICAgICAqICsgY2hhcnMuCiAgICAgKgogICAgICogQG1ldGhvZCBlbmNvZGUKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBzdHJpbmcgc3RyaW5nIHRvIGVuY29kZQogICAgICogQHJldHVybiB7U3RyaW5nfSBlbmNvZGVkIHN0cmluZwogICAgICogQHN0YXRpYwogICAgICovCiAgICBlbmNvZGU6IGZ1bmN0aW9uIChzdHJpbmcpIHsKICAgICAgICByZXR1cm4gZW5jb2RlVVJJQ29tcG9uZW50KHN0cmluZykucmVwbGFjZSgvJTIwL2csICcrJyk7CiAgICB9LAoKICAgIC8qKgogICAgICogR2V0cyB0aGUgcmF3IChub3QgZGVjb2RlZCkgY3VycmVudCBsb2NhdGlvbiBoYXNoLCBtaW51cyB0aGUgcHJlY2VkaW5nICcjJwogICAgICogY2hhcmFjdGVyIGFuZCB0aGUgaGFzaFByZWZpeCAoaWYgb25lIGlzIHNldCkuCiAgICAgKgogICAgICogQG1ldGhvZCBnZXRIYXNoCiAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IGN1cnJlbnQgbG9jYXRpb24gaGFzaAogICAgICogQHN0YXRpYwogICAgICovCiAgICBnZXRIYXNoOiAoWS5VQS5nZWNrbyA/IGZ1bmN0aW9uICgpIHsKICAgICAgICAvLyBHZWNrbydzIHdpbmRvdy5sb2NhdGlvbi5oYXNoIHJldHVybnMgYSBkZWNvZGVkIHN0cmluZyBhbmQgd2Ugd2FudCBhbGwKICAgICAgICAvLyBlbmNvZGluZyB1bnRvdWNoZWQsIHNvIHdlIG5lZWQgdG8gZ2V0IHRoZSBoYXNoIHZhbHVlIGZyb20KICAgICAgICAvLyB3aW5kb3cubG9jYXRpb24uaHJlZiBpbnN0ZWFkLiBXZSBoYXZlIHRvIHVzZSBVQSBzbmlmZmluZyByYXRoZXIgdGhhbgogICAgICAgIC8vIGZlYXR1cmUgZGV0ZWN0aW9uLCBzaW5jZSB0aGUgb25seSB3YXkgdG8gZGV0ZWN0IHRoaXMgd291bGQgYmUgdG8KICAgICAgICAvLyBhY3R1YWxseSBjaGFuZ2UgdGhlIGhhc2guCiAgICAgICAgdmFyIGxvY2F0aW9uID0gWS5nZXRMb2NhdGlvbigpLAogICAgICAgICAgICBtYXRjaGVzICA9IC8jKC4qKSQvLmV4ZWMobG9jYXRpb24uaHJlZiksCiAgICAgICAgICAgIGhhc2ggICAgID0gbWF0Y2hlcyAmJiBtYXRjaGVzWzFdIHx8ICcnLAogICAgICAgICAgICBwcmVmaXggICA9IEhpc3RvcnlIYXNoLmhhc2hQcmVmaXg7CgogICAgICAgIHJldHVybiBwcmVmaXggJiYgaGFzaC5pbmRleE9mKHByZWZpeCkgPT09IDAgPwogICAgICAgICAgICAgICAgICAgIGhhc2gucmVwbGFjZShwcmVmaXgsICcnKSA6IGhhc2g7CiAgICB9IDogZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBsb2NhdGlvbiA9IFkuZ2V0TG9jYXRpb24oKSwKICAgICAgICAgICAgaGFzaCAgICAgPSBsb2NhdGlvbi5oYXNoLnN1YnN0cmluZygxKSwKICAgICAgICAgICAgcHJlZml4ICAgPSBIaXN0b3J5SGFzaC5oYXNoUHJlZml4OwoKICAgICAgICAvLyBTbGlnaHQgY29kZSBkdXBsaWNhdGlvbiBoZXJlLCBidXQgZXhlY3V0aW9uIHNwZWVkIGlzIG9mIHRoZSBlc3NlbmNlCiAgICAgICAgLy8gc2luY2UgZ2V0SGFzaCgpIGlzIGNhbGxlZCBldmVyeSA1MG1zIHRvIHBvbGwgZm9yIGNoYW5nZXMgaW4gYnJvd3NlcnMKICAgICAgICAvLyB0aGF0IGRvbid0IHN1cHBvcnQgbmF0aXZlIG9uaGFzaGNoYW5nZS4gQW4gYWRkaXRpb25hbCBmdW5jdGlvbiBjYWxsCiAgICAgICAgLy8gd291bGQgYWRkIHVubmVjZXNzYXJ5IG92ZXJoZWFkLgogICAgICAgIHJldHVybiBwcmVmaXggJiYgaGFzaC5pbmRleE9mKHByZWZpeCkgPT09IDAgPwogICAgICAgICAgICAgICAgICAgIGhhc2gucmVwbGFjZShwcmVmaXgsICcnKSA6IGhhc2g7CiAgICB9KSwKCiAgICAvKioKICAgICAqIEdldHMgdGhlIGN1cnJlbnQgYm9va21hcmthYmxlIFVSTC4KICAgICAqCiAgICAgKiBAbWV0aG9kIGdldFVybAogICAgICogQHJldHVybiB7U3RyaW5nfSBjdXJyZW50IGJvb2ttYXJrYWJsZSBVUkwKICAgICAqIEBzdGF0aWMKICAgICAqLwogICAgZ2V0VXJsOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIGxvY2F0aW9uLmhyZWY7CiAgICB9LAoKICAgIC8qKgogICAgICogUGFyc2VzIGEgbG9jYXRpb24gaGFzaCBzdHJpbmcgaW50byBhbiBvYmplY3Qgb2Yga2V5L3ZhbHVlIHBhcmFtZXRlcgogICAgICogcGFpcnMuIElmIDxpPmhhc2g8L2k+IGlzIG5vdCBzcGVjaWZpZWQsIHRoZSBjdXJyZW50IGxvY2F0aW9uIGhhc2ggd2lsbAogICAgICogYmUgdXNlZC4KICAgICAqCiAgICAgKiBAbWV0aG9kIHBhcnNlSGFzaAogICAgICogQHBhcmFtIHtTdHJpbmd9IGhhc2ggKG9wdGlvbmFsKSBsb2NhdGlvbiBoYXNoIHN0cmluZwogICAgICogQHJldHVybiB7T2JqZWN0fSBvYmplY3Qgb2YgcGFyc2VkIGtleS92YWx1ZSBwYXJhbWV0ZXIgcGFpcnMKICAgICAqIEBzdGF0aWMKICAgICAqLwogICAgcGFyc2VIYXNoOiBmdW5jdGlvbiAoaGFzaCkgewogICAgICAgIHZhciBkZWNvZGUgPSBIaXN0b3J5SGFzaC5kZWNvZGUsCiAgICAgICAgICAgIGksCiAgICAgICAgICAgIGxlbiwKICAgICAgICAgICAgbWF0Y2gsCiAgICAgICAgICAgIG1hdGNoZXMsCiAgICAgICAgICAgIHBhcmFtLAogICAgICAgICAgICBwYXJhbXMgPSB7fSwKICAgICAgICAgICAgcHJlZml4ID0gSGlzdG9yeUhhc2guaGFzaFByZWZpeCwKICAgICAgICAgICAgcHJlZml4SW5kZXg7CgogICAgICAgIGhhc2ggPSBMYW5nLmlzVmFsdWUoaGFzaCkgPyBoYXNoIDogSGlzdG9yeUhhc2guZ2V0SGFzaCgpOwoKICAgICAgICBpZiAocHJlZml4KSB7CiAgICAgICAgICAgIHByZWZpeEluZGV4ID0gaGFzaC5pbmRleE9mKHByZWZpeCk7CgogICAgICAgICAgICBpZiAocHJlZml4SW5kZXggPT09IDAgfHwgKHByZWZpeEluZGV4ID09PSAxICYmIGhhc2guY2hhckF0KDApID09PSAnIycpKSB7CiAgICAgICAgICAgICAgICBoYXNoID0gaGFzaC5yZXBsYWNlKHByZWZpeCwgJycpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBtYXRjaGVzID0gaGFzaC5tYXRjaChIaXN0b3J5SGFzaC5fUkVHRVhfSEFTSCkgfHwgW107CgogICAgICAgIGZvciAoaSA9IDAsIGxlbiA9IG1hdGNoZXMubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHsKICAgICAgICAgICAgbWF0Y2ggPSBtYXRjaGVzW2ldOwoKICAgICAgICAgICAgcGFyYW0gPSBtYXRjaC5zcGxpdCgnPScpOwoKICAgICAgICAgICAgaWYgKHBhcmFtLmxlbmd0aCA+IDEpIHsKICAgICAgICAgICAgICAgIHBhcmFtc1tkZWNvZGUocGFyYW1bMF0pXSA9IGRlY29kZShwYXJhbVsxXSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBwYXJhbXNbZGVjb2RlKG1hdGNoKV0gPSAnJzsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHBhcmFtczsKICAgIH0sCgogICAgLyoqCiAgICAgKiBSZXBsYWNlcyB0aGUgYnJvd3NlcidzIGN1cnJlbnQgbG9jYXRpb24gaGFzaCB3aXRoIHRoZSBzcGVjaWZpZWQgaGFzaAogICAgICogYW5kIHJlbW92ZXMgYWxsIGZvcndhcmQgbmF2aWdhdGlvbiBzdGF0ZXMsIHdpdGhvdXQgY3JlYXRpbmcgYSBuZXcgYnJvd3NlcgogICAgICogaGlzdG9yeSBlbnRyeS4gQXV0b21hdGljYWxseSBwcmVwZW5kcyB0aGUgPGNvZGU+aGFzaFByZWZpeDwvY29kZT4gaWYgb25lCiAgICAgKiBpcyBzZXQuCiAgICAgKgogICAgICogQG1ldGhvZCByZXBsYWNlSGFzaAogICAgICogQHBhcmFtIHtTdHJpbmd9IGhhc2ggbmV3IGxvY2F0aW9uIGhhc2gKICAgICAqIEBzdGF0aWMKICAgICAqLwogICAgcmVwbGFjZUhhc2g6IGZ1bmN0aW9uIChoYXNoKSB7CiAgICAgICAgdmFyIGxvY2F0aW9uID0gWS5nZXRMb2NhdGlvbigpLAogICAgICAgICAgICBiYXNlICAgICA9IGxvY2F0aW9uLmhyZWYucmVwbGFjZSgvIy4qJC8sICcnKTsKCiAgICAgICAgaWYgKGhhc2guY2hhckF0KDApID09PSAnIycpIHsKICAgICAgICAgICAgaGFzaCA9IGhhc2guc3Vic3RyaW5nKDEpOwogICAgICAgIH0KCiAgICAgICAgbG9jYXRpb24ucmVwbGFjZShiYXNlICsgJyMnICsgKEhpc3RvcnlIYXNoLmhhc2hQcmVmaXggfHwgJycpICsgaGFzaCk7CiAgICB9LAoKICAgIC8qKgogICAgICogU2V0cyB0aGUgYnJvd3NlcidzIGxvY2F0aW9uIGhhc2ggdG8gdGhlIHNwZWNpZmllZCBzdHJpbmcuIEF1dG9tYXRpY2FsbHkKICAgICAqIHByZXBlbmRzIHRoZSA8Y29kZT5oYXNoUHJlZml4PC9jb2RlPiBpZiBvbmUgaXMgc2V0LgogICAgICoKICAgICAqIEBtZXRob2Qgc2V0SGFzaAogICAgICogQHBhcmFtIHtTdHJpbmd9IGhhc2ggbmV3IGxvY2F0aW9uIGhhc2gKICAgICAqIEBzdGF0aWMKICAgICAqLwogICAgc2V0SGFzaDogZnVuY3Rpb24gKGhhc2gpIHsKICAgICAgICB2YXIgbG9jYXRpb24gPSBZLmdldExvY2F0aW9uKCk7CgogICAgICAgIGlmIChoYXNoLmNoYXJBdCgwKSA9PT0gJyMnKSB7CiAgICAgICAgICAgIGhhc2ggPSBoYXNoLnN1YnN0cmluZygxKTsKICAgICAgICB9CgogICAgICAgIGxvY2F0aW9uLmhhc2ggPSAoSGlzdG9yeUhhc2guaGFzaFByZWZpeCB8fCAnJykgKyBoYXNoOwogICAgfQp9KTsKCi8vIC0tIFN5bnRoZXRpYyBoYXNoY2hhbmdlIEV2ZW50IC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgovLyBUT0RPOiBZVUlEb2MgY3VycmVudGx5IGRvZXNuJ3QgcHJvdmlkZSBhIGdvb2Qgd2F5IHRvIGRvY3VtZW50IHN5bnRoZXRpYyBET00KLy8gZXZlbnRzLiBGb3Igbm93LCB3ZSdyZSBqdXN0IGRvY3VtZW50aW5nIHRoZSBoYXNoY2hhbmdlIGV2ZW50IG9uIHRoZSBZVUkKLy8gb2JqZWN0LCB3aGljaCBpcyBhYm91dCB0aGUgYmVzdCB3ZSBjYW4gZG8gdW50aWwgZW5oYW5jZW1lbnRzIGFyZSBtYWRlIHRvCi8vIFlVSURvYy4KCi8qKgpTeW50aGV0aWMgPGNvZGU+d2luZG93Lm9uaGFzaGNoYW5nZTwvY29kZT4gZXZlbnQgdGhhdCBub3JtYWxpemVzIGRpZmZlcmVuY2VzCmFjcm9zcyBicm93c2VycyBhbmQgcHJvdmlkZXMgc3VwcG9ydCBmb3IgYnJvd3NlcnMgdGhhdCBkb24ndCBuYXRpdmVseSBzdXBwb3J0Cjxjb2RlPm9uaGFzaGNoYW5nZTwvY29kZT4uCgpUaGlzIGV2ZW50IGlzIHByb3ZpZGVkIGJ5IHRoZSA8Y29kZT5oaXN0b3J5LWhhc2g8L2NvZGU+IG1vZHVsZS4KCkBleGFtcGxlCgogICAgWVVJKCkudXNlKCdoaXN0b3J5LWhhc2gnLCBmdW5jdGlvbiAoWSkgewogICAgICBZLm9uKCdoYXNoY2hhbmdlJywgZnVuY3Rpb24gKGUpIHsKICAgICAgICAvLyBIYW5kbGUgaGFzaGNoYW5nZSBldmVudHMgb24gdGhlIGN1cnJlbnQgd2luZG93LgogICAgICB9LCBZLmNvbmZpZy53aW4pOwogICAgfSk7CgpAZXZlbnQgaGFzaGNoYW5nZQpAcGFyYW0ge0V2ZW50RmFjYWRlfSBlIEV2ZW50IGZhY2FkZSB3aXRoIHRoZSBmb2xsb3dpbmcgYWRkaXRpb25hbAogIHByb3BlcnRpZXM6Cgo8ZGw+CiAgPGR0Pm9sZEhhc2g8L2R0PgogIDxkZD4KICAgIFByZXZpb3VzIGhhc2ggZnJhZ21lbnQgdmFsdWUgYmVmb3JlIHRoZSBjaGFuZ2UuCiAgPC9kZD4KCiAgPGR0Pm9sZFVybDwvZHQ+CiAgPGRkPgogICAgUHJldmlvdXMgVVJMIChpbmNsdWRpbmcgdGhlIGhhc2ggZnJhZ21lbnQpIGJlZm9yZSB0aGUgY2hhbmdlLgogIDwvZGQ+CgogIDxkdD5uZXdIYXNoPC9kdD4KICA8ZGQ+CiAgICBOZXcgaGFzaCBmcmFnbWVudCB2YWx1ZSBhZnRlciB0aGUgY2hhbmdlLgogIDwvZGQ+CgogIDxkdD5uZXdVcmw8L2R0PgogIDxkZD4KICAgIE5ldyBVUkwgKGluY2x1ZGluZyB0aGUgaGFzaCBmcmFnbWVudCkgYWZ0ZXIgdGhlIGNoYW5nZS4KICA8L2RkPgo8L2RsPgpAZm9yIFlVSQpAc2luY2UgMy4yLjAKKiovCgpoYXNoTm90aWZpZXJzID0gR2xvYmFsRW52Ll9ub3RpZmllcnM7CgppZiAoIWhhc2hOb3RpZmllcnMpIHsKICAgIGhhc2hOb3RpZmllcnMgPSBHbG9iYWxFbnYuX25vdGlmaWVycyA9IFtdOwp9CgpZLkV2ZW50LmRlZmluZSgnaGFzaGNoYW5nZScsIHsKICAgIG9uOiBmdW5jdGlvbiAobm9kZSwgc3Vic2NyaWJlciwgbm90aWZpZXIpIHsKICAgICAgICAvLyBJZ25vcmUgdGhpcyBzdWJzY3JpcHRpb24gaWYgdGhlIG5vZGUgaXMgYW55dGhpbmcgb3RoZXIgdGhhbiB0aGUKICAgICAgICAvLyB3aW5kb3cgb3IgZG9jdW1lbnQgYm9keSwgc2luY2UgdGhvc2UgYXJlIHRoZSBvbmx5IGVsZW1lbnRzIHRoYXQKICAgICAgICAvLyBzaG91bGQgc3VwcG9ydCB0aGUgaGFzaGNoYW5nZSBldmVudC4gTm90ZSB0aGF0IHRoZSBib2R5IGNvdWxkIGFsc28gYmUKICAgICAgICAvLyBhIGZyYW1lc2V0LCBidXQgdGhhdCdzIG9rYXkgc2luY2UgZnJhbWVzZXRzIHN1cHBvcnQgaGFzaGNoYW5nZSB0b28uCiAgICAgICAgaWYgKG5vZGUuY29tcGFyZVRvKHdpbikgfHwgbm9kZS5jb21wYXJlVG8oWS5jb25maWcuZG9jLmJvZHkpKSB7CiAgICAgICAgICAgIGhhc2hOb3RpZmllcnMucHVzaChub3RpZmllcik7CiAgICAgICAgfQogICAgfSwKCiAgICBkZXRhY2g6IGZ1bmN0aW9uIChub2RlLCBzdWJzY3JpYmVyLCBub3RpZmllcikgewogICAgICAgIHZhciBpbmRleCA9IFlBcnJheS5pbmRleE9mKGhhc2hOb3RpZmllcnMsIG5vdGlmaWVyKTsKCiAgICAgICAgaWYgKGluZGV4ICE9PSAtMSkgewogICAgICAgICAgICBoYXNoTm90aWZpZXJzLnNwbGljZShpbmRleCwgMSk7CiAgICAgICAgfQogICAgfQp9KTsKCm9sZEhhc2ggPSBIaXN0b3J5SGFzaC5nZXRIYXNoKCk7Cm9sZFVybCAgPSBIaXN0b3J5SGFzaC5nZXRVcmwoKTsKCmlmIChIaXN0b3J5QmFzZS5uYXRpdmVIYXNoQ2hhbmdlKSB7CiAgICAvLyBXcmFwIHRoZSBicm93c2VyJ3MgbmF0aXZlIGhhc2hjaGFuZ2UgZXZlbnQgaWYgdGhlcmUncyBub3QgYWxyZWFkeSBhCiAgICAvLyBnbG9iYWwgbGlzdGVuZXIuCiAgICBpZiAoIUdsb2JhbEVudi5faGFzaEhhbmRsZSkgewogICAgICAgIEdsb2JhbEVudi5faGFzaEhhbmRsZSA9IFkuRXZlbnQuYXR0YWNoKCdoYXNoY2hhbmdlJywgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgdmFyIG5ld0hhc2ggPSBIaXN0b3J5SGFzaC5nZXRIYXNoKCksCiAgICAgICAgICAgICAgICBuZXdVcmwgID0gSGlzdG9yeUhhc2guZ2V0VXJsKCk7CgogICAgICAgICAgICAvLyBJdGVyYXRlIG92ZXIgYSBjb3B5IG9mIHRoZSBoYXNoTm90aWZpZXJzIGFycmF5IHNpbmNlIGEgc3Vic2NyaWJlcgogICAgICAgICAgICAvLyBjb3VsZCBkZXRhY2ggZHVyaW5nIGl0ZXJhdGlvbiBhbmQgY2F1c2UgdGhlIGFycmF5IHRvIGJlIHJlLWluZGV4ZWQuCiAgICAgICAgICAgIFlBcnJheS5lYWNoKGhhc2hOb3RpZmllcnMuY29uY2F0KCksIGZ1bmN0aW9uIChub3RpZmllcikgewogICAgICAgICAgICAgICAgbm90aWZpZXIuZmlyZSh7CiAgICAgICAgICAgICAgICAgICAgX2V2ZW50IDogZSwKICAgICAgICAgICAgICAgICAgICBvbGRIYXNoOiBvbGRIYXNoLAogICAgICAgICAgICAgICAgICAgIG9sZFVybCA6IG9sZFVybCwKICAgICAgICAgICAgICAgICAgICBuZXdIYXNoOiBuZXdIYXNoLAogICAgICAgICAgICAgICAgICAgIG5ld1VybCA6IG5ld1VybAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgb2xkSGFzaCA9IG5ld0hhc2g7CiAgICAgICAgICAgIG9sZFVybCAgPSBuZXdVcmw7CiAgICAgICAgfSwgd2luKTsKICAgIH0KfSBlbHNlIHsKICAgIC8vIEJlZ2luIHBvbGxpbmcgZm9yIGxvY2F0aW9uIGhhc2ggY2hhbmdlcyBpZiB0aGVyZSdzIG5vdCBhbHJlYWR5IGEgZ2xvYmFsCiAgICAvLyBwb2xsIHJ1bm5pbmcuCiAgICBpZiAoIUdsb2JhbEVudi5faGFzaFBvbGwpIHsKICAgICAgICBHbG9iYWxFbnYuX2hhc2hQb2xsID0gWS5sYXRlcig1MCwgbnVsbCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgbmV3SGFzaCA9IEhpc3RvcnlIYXNoLmdldEhhc2goKSwKICAgICAgICAgICAgICAgIGZhY2FkZSwgbmV3VXJsOwoKICAgICAgICAgICAgaWYgKG9sZEhhc2ggIT09IG5ld0hhc2gpIHsKICAgICAgICAgICAgICAgIG5ld1VybCA9IEhpc3RvcnlIYXNoLmdldFVybCgpOwoKICAgICAgICAgICAgICAgIGZhY2FkZSA9IHsKICAgICAgICAgICAgICAgICAgICBvbGRIYXNoOiBvbGRIYXNoLAogICAgICAgICAgICAgICAgICAgIG9sZFVybCA6IG9sZFVybCwKICAgICAgICAgICAgICAgICAgICBuZXdIYXNoOiBuZXdIYXNoLAogICAgICAgICAgICAgICAgICAgIG5ld1VybCA6IG5ld1VybAogICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICBvbGRIYXNoID0gbmV3SGFzaDsKICAgICAgICAgICAgICAgIG9sZFVybCAgPSBuZXdVcmw7CgogICAgICAgICAgICAgICAgWUFycmF5LmVhY2goaGFzaE5vdGlmaWVycy5jb25jYXQoKSwgZnVuY3Rpb24gKG5vdGlmaWVyKSB7CiAgICAgICAgICAgICAgICAgICAgbm90aWZpZXIuZmlyZShmYWNhZGUpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LCBudWxsLCB0cnVlKTsKICAgIH0KfQoKWS5IaXN0b3J5SGFzaCA9IEhpc3RvcnlIYXNoOwoKLy8gSGlzdG9yeUhhc2ggd2lsbCBuZXZlciB3aW4gb3ZlciBIaXN0b3J5SFRNTDUgdW5sZXNzIHVzZUhpc3RvcnlIVE1MNSBpcyBmYWxzZS4KaWYgKHVzZUhpc3RvcnlIVE1MNSA9PT0gZmFsc2UgfHwgKCFZLkhpc3RvcnkgJiYgdXNlSGlzdG9yeUhUTUw1ICE9PSB0cnVlICYmCiAgICAgICAgKCFIaXN0b3J5QmFzZS5odG1sNSB8fCAhWS5IaXN0b3J5SFRNTDUpKSkgewogICAgWS5IaXN0b3J5ID0gSGlzdG9yeUhhc2g7Cn0KCgp9LCAnMy4xNC4xJywgeyJyZXF1aXJlcyI6IFsiZXZlbnQtc3ludGhldGljIiwgImhpc3RvcnktYmFzZSIsICJ5dWktbGF0ZXIiXX0pOwo=",
                "body": "WVVJLmFkZCgnaGlzdG9yeS1oYXNoJywgZnVuY3Rpb24gKFksIE5BTUUpIHsKCi8qKgogKiBQcm92aWRlcyBicm93c2VyIGhpc3RvcnkgbWFuYWdlbWVudCBiYWNrZWQgYnkKICogPGNvZGU+d2luZG93LmxvY2F0aW9uLmhhc2g8L2NvZGU+LCBhcyB3ZWxsIGFzIGNvbnZlbmllbmNlIG1ldGhvZHMgZm9yIHdvcmtpbmcKICogd2l0aCB0aGUgbG9jYXRpb24gaGFzaCBhbmQgYSBzeW50aGV0aWMgPGNvZGU+aGFzaGNoYW5nZTwvY29kZT4gZXZlbnQgdGhhdAogKiBub3JtYWxpemVzIGRpZmZlcmVuY2VzIGFjcm9zcyBicm93c2Vycy4KICoKICogQG1vZHVsZSBoaXN0b3J5CiAqIEBzdWJtb2R1bGUgaGlzdG9yeS1oYXNoCiAqIEBzaW5jZSAzLjIuMAogKiBAY2xhc3MgSGlzdG9yeUhhc2gKICogQGV4dGVuZHMgSGlzdG9yeUJhc2UKICogQGNvbnN0cnVjdG9yCiAqIEBwYXJhbSB7T2JqZWN0fSBjb25maWcgKG9wdGlvbmFsKSBDb25maWd1cmF0aW9uIG9iamVjdC4gU2VlIHRoZSBIaXN0b3J5QmFzZQogKiAgIGRvY3VtZW50YXRpb24gZm9yIGRldGFpbHMuCiAqLwoKdmFyIEhpc3RvcnlCYXNlID0gWS5IaXN0b3J5QmFzZSwKICAgIExhbmcgICAgICAgID0gWS5MYW5nLAogICAgWUFycmF5ICAgICAgPSBZLkFycmF5LAogICAgWU9iamVjdCAgICAgPSBZLk9iamVjdCwKICAgIEdsb2JhbEVudiAgID0gWVVJLm5hbWVzcGFjZSgnRW52Lkhpc3RvcnlIYXNoJyksCgogICAgU1JDX0hBU0ggICAgPSAnaGFzaCcsCgogICAgaGFzaE5vdGlmaWVycywKICAgIG9sZEhhc2gsCiAgICBvbGRVcmwsCiAgICB3aW4gICAgICAgICAgICAgPSBZLmNvbmZpZy53aW4sCiAgICB1c2VIaXN0b3J5SFRNTDUgPSBZLmNvbmZpZy51c2VIaXN0b3J5SFRNTDU7CgpmdW5jdGlvbiBIaXN0b3J5SGFzaCgpIHsKICAgIEhpc3RvcnlIYXNoLnN1cGVyY2xhc3MuY29uc3RydWN0b3IuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKfQoKWS5leHRlbmQoSGlzdG9yeUhhc2gsIEhpc3RvcnlCYXNlLCB7CiAgICAvLyAtLSBJbml0aWFsaXphdGlvbiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICBfaW5pdDogZnVuY3Rpb24gKGNvbmZpZykgewogICAgICAgIHZhciBib29rbWFya2VkU3RhdGUgPSBIaXN0b3J5SGFzaC5wYXJzZUhhc2goKTsKCiAgICAgICAgLy8gSWYgYW4gaW5pdGlhbFN0YXRlIHdhcyBwcm92aWRlZCwgbWVyZ2UgdGhlIGJvb2ttYXJrZWQgc3RhdGUgaW50byBpdAogICAgICAgIC8vICh0aGUgYm9va21hcmtlZCBzdGF0ZSB3aW5zKS4KICAgICAgICBjb25maWcgPSBjb25maWcgfHwge307CgogICAgICAgIHRoaXMuX2luaXRpYWxTdGF0ZSA9IGNvbmZpZy5pbml0aWFsU3RhdGUgPwogICAgICAgICAgICAgICAgWS5tZXJnZShjb25maWcuaW5pdGlhbFN0YXRlLCBib29rbWFya2VkU3RhdGUpIDogYm9va21hcmtlZFN0YXRlOwoKICAgICAgICAvLyBTdWJzY3JpYmUgdG8gdGhlIHN5bnRoZXRpYyBoYXNoY2hhbmdlIGV2ZW50IChkZWZpbmVkIGJlbG93KSB0byBoYW5kbGUKICAgICAgICAvLyBjaGFuZ2VzLgogICAgICAgIFkuYWZ0ZXIoJ2hhc2hjaGFuZ2UnLCBZLmJpbmQodGhpcy5fYWZ0ZXJIYXNoQ2hhbmdlLCB0aGlzKSwgd2luKTsKCiAgICAgICAgSGlzdG9yeUhhc2guc3VwZXJjbGFzcy5faW5pdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgfSwKCiAgICAvLyAtLSBQcm90ZWN0ZWQgTWV0aG9kcyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICBfY2hhbmdlOiBmdW5jdGlvbiAoc3JjLCBzdGF0ZSwgb3B0aW9ucykgewogICAgICAgIC8vIFN0cmluZ2lmeSBhbGwgdmFsdWVzIHRvIGVuc3VyZSB0aGF0IGNvbXBhcmlzb25zIGRvbid0IGZhaWwgYWZ0ZXIKICAgICAgICAvLyB0aGV5J3JlIGNvZXJjZWQgdG8gc3RyaW5ncyBpbiB0aGUgbG9jYXRpb24gaGFzaC4KICAgICAgICBZT2JqZWN0LmVhY2goc3RhdGUsIGZ1bmN0aW9uICh2YWx1ZSwga2V5KSB7CiAgICAgICAgICAgIGlmIChMYW5nLmlzVmFsdWUodmFsdWUpKSB7CiAgICAgICAgICAgICAgICBzdGF0ZVtrZXldID0gdmFsdWUudG9TdHJpbmcoKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICByZXR1cm4gSGlzdG9yeUhhc2guc3VwZXJjbGFzcy5fY2hhbmdlLmNhbGwodGhpcywgc3JjLCBzdGF0ZSwgb3B0aW9ucyk7CiAgICB9LAoKICAgIF9zdG9yZVN0YXRlOiBmdW5jdGlvbiAoc3JjLCBuZXdTdGF0ZSkgewogICAgICAgIHZhciBkZWNvZGUgID0gSGlzdG9yeUhhc2guZGVjb2RlLAogICAgICAgICAgICBuZXdIYXNoID0gSGlzdG9yeUhhc2guY3JlYXRlSGFzaChuZXdTdGF0ZSk7CgogICAgICAgIEhpc3RvcnlIYXNoLnN1cGVyY2xhc3MuX3N0b3JlU3RhdGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKCiAgICAgICAgLy8gVXBkYXRlIHRoZSBsb2NhdGlvbiBoYXNoIHdpdGggdGhlIGNoYW5nZXMsIGJ1dCBvbmx5IGlmIHRoZSBuZXcgaGFzaAogICAgICAgIC8vIGFjdHVhbGx5IGRpZmZlcnMgZnJvbSB0aGUgY3VycmVudCBoYXNoICh0aGlzIGF2b2lkcyBjcmVhdGluZyBtdWx0aXBsZQogICAgICAgIC8vIGhpc3RvcnkgZW50cmllcyBmb3IgYSBzaW5nbGUgc3RhdGUpLgogICAgICAgIC8vCiAgICAgICAgLy8gV2UgYWx3YXlzIGNvbXBhcmUgZGVjb2RlZCBoYXNoZXMsIHNpbmNlIGl0J3MgcG9zc2libGUgdGhhdCB0aGUgaGFzaAogICAgICAgIC8vIGNvdWxkIGJlIHNldCBpbmNvcnJlY3RseSB0byBhIG5vbi1lbmNvZGVkIHZhbHVlIG91dHNpZGUgb2YKICAgICAgICAvLyBIaXN0b3J5SGFzaC4KICAgICAgICBpZiAoc3JjICE9PSBTUkNfSEFTSCAmJiBkZWNvZGUoSGlzdG9yeUhhc2guZ2V0SGFzaCgpKSAhPT0gZGVjb2RlKG5ld0hhc2gpKSB7CiAgICAgICAgICAgIEhpc3RvcnlIYXNoW3NyYyA9PT0gSGlzdG9yeUJhc2UuU1JDX1JFUExBQ0UgPyAncmVwbGFjZUhhc2gnIDogJ3NldEhhc2gnXShuZXdIYXNoKTsKICAgICAgICB9CiAgICB9LAoKICAgIC8vIC0tIFByb3RlY3RlZCBFdmVudCBIYW5kbGVycyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgICAvKioKICAgICAqIEhhbmRsZXIgZm9yIGhhc2hjaGFuZ2UgZXZlbnRzLgogICAgICoKICAgICAqIEBtZXRob2QgX2FmdGVySGFzaENoYW5nZQogICAgICogQHBhcmFtIHtFdmVudH0gZQogICAgICogQHByb3RlY3RlZAogICAgICovCiAgICBfYWZ0ZXJIYXNoQ2hhbmdlOiBmdW5jdGlvbiAoZSkgewogICAgICAgIHRoaXMuX3Jlc29sdmVDaGFuZ2VzKFNSQ19IQVNILCBIaXN0b3J5SGFzaC5wYXJzZUhhc2goZS5uZXdIYXNoKSwge30pOwogICAgfQp9LCB7CiAgICAvLyAtLSBQdWJsaWMgU3RhdGljIFByb3BlcnRpZXMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICBOQU1FOiAnaGlzdG9yeUhhc2gnLAoKICAgIC8qKgogICAgICogQ29uc3RhbnQgdXNlZCB0byBpZGVudGlmeSBzdGF0ZSBjaGFuZ2VzIG9yaWdpbmF0aW5nIGZyb20KICAgICAqIDxjb2RlPmhhc2hjaGFuZ2U8L2NvZGU+IGV2ZW50cy4KICAgICAqCiAgICAgKiBAcHJvcGVydHkgU1JDX0hBU0gKICAgICAqIEB0eXBlIFN0cmluZwogICAgICogQHN0YXRpYwogICAgICogQGZpbmFsCiAgICAgKi8KICAgIFNSQ19IQVNIOiBTUkNfSEFTSCwKCiAgICAvKioKICAgICAqIDxwPgogICAgICogUHJlZml4IHRvIHByZXBlbmQgd2hlbiBzZXR0aW5nIHRoZSBoYXNoIGZyYWdtZW50LiBGb3IgZXhhbXBsZSwgaWYgdGhlCiAgICAgKiBwcmVmaXggaXMgPGNvZGU+ITwvY29kZT4gYW5kIHRoZSBoYXNoIGZyYWdtZW50IGlzIHNldCB0bwogICAgICogPGNvZGU+I2Zvbz1iYXImYmF6PXF1dXg8L2NvZGU+LCB0aGUgZmluYWwgaGFzaCBmcmFnbWVudCBpbiB0aGUgVVJMIHdpbGwKICAgICAqIGJlY29tZSA8Y29kZT4jIWZvbz1iYXImYmF6PXF1dXg8L2NvZGU+LiBUaGlzIGNhbiBiZSB1c2VkIHRvIGhlbHAgbWFrZSBhbgogICAgICogQWpheCBhcHBsaWNhdGlvbiBjcmF3bGFibGUgaW4gYWNjb3JkYW5jZSB3aXRoIEdvb2dsZSdzIGd1aWRlbGluZXMgYXQKICAgICAqIDxhIGhyZWY9Imh0dHA6Ly9jb2RlLmdvb2dsZS5jb20vd2ViL2FqYXhjcmF3bGluZy8iPmh0dHA6Ly9jb2RlLmdvb2dsZS5jb20vd2ViL2FqYXhjcmF3bGluZy88L2E+LgogICAgICogPC9wPgogICAgICoKICAgICAqIDxwPgogICAgICogTm90ZSB0aGF0IHRoaXMgcHJlZml4IGFwcGxpZXMgdG8gYWxsIEhpc3RvcnlIYXNoIGluc3RhbmNlcy4gSXQncyBub3QKICAgICAqIHBvc3NpYmxlIGZvciBpbmRpdmlkdWFsIGluc3RhbmNlcyB0byB1c2UgdGhlaXIgb3duIHByZWZpeGVzIHNpbmNlIHRoZXkKICAgICAqIGFsbCBvcGVyYXRlIG9uIHRoZSBzYW1lIFVSTC4KICAgICAqIDwvcD4KICAgICAqCiAgICAgKiBAcHJvcGVydHkgaGFzaFByZWZpeAogICAgICogQHR5cGUgU3RyaW5nCiAgICAgKiBAZGVmYXVsdCAnJwogICAgICogQHN0YXRpYwogICAgICovCiAgICBoYXNoUHJlZml4OiAnJywKCiAgICAvLyAtLSBQcm90ZWN0ZWQgU3RhdGljIFByb3BlcnRpZXMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgogICAgLyoqCiAgICAgKiBSZWd1bGFyIGV4cHJlc3Npb24gdXNlZCB0byBwYXJzZSBsb2NhdGlvbiBoYXNoL3F1ZXJ5IHN0cmluZ3MuCiAgICAgKgogICAgICogQHByb3BlcnR5IF9SRUdFWF9IQVNICiAgICAgKiBAdHlwZSBSZWdFeHAKICAgICAqIEBwcm90ZWN0ZWQKICAgICAqIEBzdGF0aWMKICAgICAqIEBmaW5hbAogICAgICovCiAgICBfUkVHRVhfSEFTSDogLyhbXlw/IyY9XSspPT8oW14mPV0qKS9nLAoKICAgIC8vIC0tIFB1YmxpYyBTdGF0aWMgTWV0aG9kcyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgICAvKioKICAgICAqIENyZWF0ZXMgYSBsb2NhdGlvbiBoYXNoIHN0cmluZyBmcm9tIHRoZSBzcGVjaWZpZWQgb2JqZWN0IG9mIGtleS92YWx1ZQogICAgICogcGFpcnMuCiAgICAgKgogICAgICogQG1ldGhvZCBjcmVhdGVIYXNoCiAgICAgKiBAcGFyYW0ge09iamVjdH0gcGFyYW1zIG9iamVjdCBvZiBrZXkvdmFsdWUgcGFyYW1ldGVyIHBhaXJzCiAgICAgKiBAcmV0dXJuIHtTdHJpbmd9IGxvY2F0aW9uIGhhc2ggc3RyaW5nCiAgICAgKiBAc3RhdGljCiAgICAgKi8KICAgIGNyZWF0ZUhhc2g6IGZ1bmN0aW9uIChwYXJhbXMpIHsKICAgICAgICB2YXIgZW5jb2RlID0gSGlzdG9yeUhhc2guZW5jb2RlLAogICAgICAgICAgICBoYXNoICAgPSBbXTsKCiAgICAgICAgWU9iamVjdC5lYWNoKHBhcmFtcywgZnVuY3Rpb24gKHZhbHVlLCBrZXkpIHsKICAgICAgICAgICAgaWYgKExhbmcuaXNWYWx1ZSh2YWx1ZSkpIHsKICAgICAgICAgICAgICAgIGhhc2gucHVzaChlbmNvZGUoa2V5KSArICc9JyArIGVuY29kZSh2YWx1ZSkpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIHJldHVybiBoYXNoLmpvaW4oJyYnKTsKICAgIH0sCgogICAgLyoqCiAgICAgKiBXcmFwcGVyIGFyb3VuZCA8Y29kZT5kZWNvZGVVUklDb21wb25lbnQoKTwvY29kZT4gdGhhdCBhbHNvIGNvbnZlcnRzICsKICAgICAqIGNoYXJzIGludG8gc3BhY2VzLgogICAgICoKICAgICAqIEBtZXRob2QgZGVjb2RlCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gc3RyaW5nIHN0cmluZyB0byBkZWNvZGUKICAgICAqIEByZXR1cm4ge1N0cmluZ30gZGVjb2RlZCBzdHJpbmcKICAgICAqIEBzdGF0aWMKICAgICAqLwogICAgZGVjb2RlOiBmdW5jdGlvbiAoc3RyaW5nKSB7CiAgICAgICAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChzdHJpbmcucmVwbGFjZSgvXCsvZywgJyAnKSk7CiAgICB9LAoKICAgIC8qKgogICAgICogV3JhcHBlciBhcm91bmQgPGNvZGU+ZW5jb2RlVVJJQ29tcG9uZW50KCk8L2NvZGU+IHRoYXQgY29udmVydHMgc3BhY2VzIHRvCiAgICAgKiArIGNoYXJzLgogICAgICoKICAgICAqIEBtZXRob2QgZW5jb2RlCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gc3RyaW5nIHN0cmluZyB0byBlbmNvZGUKICAgICAqIEByZXR1cm4ge1N0cmluZ30gZW5jb2RlZCBzdHJpbmcKICAgICAqIEBzdGF0aWMKICAgICAqLwogICAgZW5jb2RlOiBmdW5jdGlvbiAoc3RyaW5nKSB7CiAgICAgICAgcmV0dXJuIGVuY29kZVVSSUNvbXBvbmVudChzdHJpbmcpLnJlcGxhY2UoLyUyMC9nLCAnKycpOwogICAgfSwKCiAgICAvKioKICAgICAqIEdldHMgdGhlIHJhdyAobm90IGRlY29kZWQpIGN1cnJlbnQgbG9jYXRpb24gaGFzaCwgbWludXMgdGhlIHByZWNlZGluZyAnIycKICAgICAqIGNoYXJhY3RlciBhbmQgdGhlIGhhc2hQcmVmaXggKGlmIG9uZSBpcyBzZXQpLgogICAgICoKICAgICAqIEBtZXRob2QgZ2V0SGFzaAogICAgICogQHJldHVybiB7U3RyaW5nfSBjdXJyZW50IGxvY2F0aW9uIGhhc2gKICAgICAqIEBzdGF0aWMKICAgICAqLwogICAgZ2V0SGFzaDogKFkuVUEuZ2Vja28gPyBmdW5jdGlvbiAoKSB7CiAgICAgICAgLy8gR2Vja28ncyB3aW5kb3cubG9jYXRpb24uaGFzaCByZXR1cm5zIGEgZGVjb2RlZCBzdHJpbmcgYW5kIHdlIHdhbnQgYWxsCiAgICAgICAgLy8gZW5jb2RpbmcgdW50b3VjaGVkLCBzbyB3ZSBuZWVkIHRvIGdldCB0aGUgaGFzaCB2YWx1ZSBmcm9tCiAgICAgICAgLy8gd2luZG93LmxvY2F0aW9uLmhyZWYgaW5zdGVhZC4gV2UgaGF2ZSB0byB1c2UgVUEgc25pZmZpbmcgcmF0aGVyIHRoYW4KICAgICAgICAvLyBmZWF0dXJlIGRldGVjdGlvbiwgc2luY2UgdGhlIG9ubHkgd2F5IHRvIGRldGVjdCB0aGlzIHdvdWxkIGJlIHRvCiAgICAgICAgLy8gYWN0dWFsbHkgY2hhbmdlIHRoZSBoYXNoLgogICAgICAgIHZhciBsb2NhdGlvbiA9IFkuZ2V0TG9jYXRpb24oKSwKICAgICAgICAgICAgbWF0Y2hlcyAgPSAvIyguKikkLy5leGVjKGxvY2F0aW9uLmhyZWYpLAogICAgICAgICAgICBoYXNoICAgICA9IG1hdGNoZXMgJiYgbWF0Y2hlc1sxXSB8fCAnJywKICAgICAgICAgICAgcHJlZml4ICAgPSBIaXN0b3J5SGFzaC5oYXNoUHJlZml4OwoKICAgICAgICByZXR1cm4gcHJlZml4ICYmIGhhc2guaW5kZXhPZihwcmVmaXgpID09PSAwID8KICAgICAgICAgICAgICAgICAgICBoYXNoLnJlcGxhY2UocHJlZml4LCAnJykgOiBoYXNoOwogICAgfSA6IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgbG9jYXRpb24gPSBZLmdldExvY2F0aW9uKCksCiAgICAgICAgICAgIGhhc2ggICAgID0gbG9jYXRpb24uaGFzaC5zdWJzdHJpbmcoMSksCiAgICAgICAgICAgIHByZWZpeCAgID0gSGlzdG9yeUhhc2guaGFzaFByZWZpeDsKCiAgICAgICAgLy8gU2xpZ2h0IGNvZGUgZHVwbGljYXRpb24gaGVyZSwgYnV0IGV4ZWN1dGlvbiBzcGVlZCBpcyBvZiB0aGUgZXNzZW5jZQogICAgICAgIC8vIHNpbmNlIGdldEhhc2goKSBpcyBjYWxsZWQgZXZlcnkgNTBtcyB0byBwb2xsIGZvciBjaGFuZ2VzIGluIGJyb3dzZXJzCiAgICAgICAgLy8gdGhhdCBkb24ndCBzdXBwb3J0IG5hdGl2ZSBvbmhhc2hjaGFuZ2UuIEFuIGFkZGl0aW9uYWwgZnVuY3Rpb24gY2FsbAogICAgICAgIC8vIHdvdWxkIGFkZCB1bm5lY2Vzc2FyeSBvdmVyaGVhZC4KICAgICAgICByZXR1cm4gcHJlZml4ICYmIGhhc2guaW5kZXhPZihwcmVmaXgpID09PSAwID8KICAgICAgICAgICAgICAgICAgICBoYXNoLnJlcGxhY2UocHJlZml4LCAnJykgOiBoYXNoOwogICAgfSksCgogICAgLyoqCiAgICAgKiBHZXRzIHRoZSBjdXJyZW50IGJvb2ttYXJrYWJsZSBVUkwuCiAgICAgKgogICAgICogQG1ldGhvZCBnZXRVcmwKICAgICAqIEByZXR1cm4ge1N0cmluZ30gY3VycmVudCBib29rbWFya2FibGUgVVJMCiAgICAgKiBAc3RhdGljCiAgICAgKi8KICAgIGdldFVybDogZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBsb2NhdGlvbi5ocmVmOwogICAgfSwKCiAgICAvKioKICAgICAqIFBhcnNlcyBhIGxvY2F0aW9uIGhhc2ggc3RyaW5nIGludG8gYW4gb2JqZWN0IG9mIGtleS92YWx1ZSBwYXJhbWV0ZXIKICAgICAqIHBhaXJzLiBJZiA8aT5oYXNoPC9pPiBpcyBub3Qgc3BlY2lmaWVkLCB0aGUgY3VycmVudCBsb2NhdGlvbiBoYXNoIHdpbGwKICAgICAqIGJlIHVzZWQuCiAgICAgKgogICAgICogQG1ldGhvZCBwYXJzZUhhc2gKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBoYXNoIChvcHRpb25hbCkgbG9jYXRpb24gaGFzaCBzdHJpbmcKICAgICAqIEByZXR1cm4ge09iamVjdH0gb2JqZWN0IG9mIHBhcnNlZCBrZXkvdmFsdWUgcGFyYW1ldGVyIHBhaXJzCiAgICAgKiBAc3RhdGljCiAgICAgKi8KICAgIHBhcnNlSGFzaDogZnVuY3Rpb24gKGhhc2gpIHsKICAgICAgICB2YXIgZGVjb2RlID0gSGlzdG9yeUhhc2guZGVjb2RlLAogICAgICAgICAgICBpLAogICAgICAgICAgICBsZW4sCiAgICAgICAgICAgIG1hdGNoLAogICAgICAgICAgICBtYXRjaGVzLAogICAgICAgICAgICBwYXJhbSwKICAgICAgICAgICAgcGFyYW1zID0ge30sCiAgICAgICAgICAgIHByZWZpeCA9IEhpc3RvcnlIYXNoLmhhc2hQcmVmaXgsCiAgICAgICAgICAgIHByZWZpeEluZGV4OwoKICAgICAgICBoYXNoID0gTGFuZy5pc1ZhbHVlKGhhc2gpID8gaGFzaCA6IEhpc3RvcnlIYXNoLmdldEhhc2goKTsKCiAgICAgICAgaWYgKHByZWZpeCkgewogICAgICAgICAgICBwcmVmaXhJbmRleCA9IGhhc2guaW5kZXhPZihwcmVmaXgpOwoKICAgICAgICAgICAgaWYgKHByZWZpeEluZGV4ID09PSAwIHx8IChwcmVmaXhJbmRleCA9PT0gMSAmJiBoYXNoLmNoYXJBdCgwKSA9PT0gJyMnKSkgewogICAgICAgICAgICAgICAgaGFzaCA9IGhhc2gucmVwbGFjZShwcmVmaXgsICcnKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgbWF0Y2hlcyA9IGhhc2gubWF0Y2goSGlzdG9yeUhhc2guX1JFR0VYX0hBU0gpIHx8IFtdOwoKICAgICAgICBmb3IgKGkgPSAwLCBsZW4gPSBtYXRjaGVzLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgICAgIG1hdGNoID0gbWF0Y2hlc1tpXTsKCiAgICAgICAgICAgIHBhcmFtID0gbWF0Y2guc3BsaXQoJz0nKTsKCiAgICAgICAgICAgIGlmIChwYXJhbS5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgICAgICBwYXJhbXNbZGVjb2RlKHBhcmFtWzBdKV0gPSBkZWNvZGUocGFyYW1bMV0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcGFyYW1zW2RlY29kZShtYXRjaCldID0gJyc7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBwYXJhbXM7CiAgICB9LAoKICAgIC8qKgogICAgICogUmVwbGFjZXMgdGhlIGJyb3dzZXIncyBjdXJyZW50IGxvY2F0aW9uIGhhc2ggd2l0aCB0aGUgc3BlY2lmaWVkIGhhc2gKICAgICAqIGFuZCByZW1vdmVzIGFsbCBmb3J3YXJkIG5hdmlnYXRpb24gc3RhdGVzLCB3aXRob3V0IGNyZWF0aW5nIGEgbmV3IGJyb3dzZXIKICAgICAqIGhpc3RvcnkgZW50cnkuIEF1dG9tYXRpY2FsbHkgcHJlcGVuZHMgdGhlIDxjb2RlPmhhc2hQcmVmaXg8L2NvZGU+IGlmIG9uZQogICAgICogaXMgc2V0LgogICAgICoKICAgICAqIEBtZXRob2QgcmVwbGFjZUhhc2gKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBoYXNoIG5ldyBsb2NhdGlvbiBoYXNoCiAgICAgKiBAc3RhdGljCiAgICAgKi8KICAgIHJlcGxhY2VIYXNoOiBmdW5jdGlvbiAoaGFzaCkgewogICAgICAgIHZhciBsb2NhdGlvbiA9IFkuZ2V0TG9jYXRpb24oKSwKICAgICAgICAgICAgYmFzZSAgICAgPSBsb2NhdGlvbi5ocmVmLnJlcGxhY2UoLyMuKiQvLCAnJyk7CgogICAgICAgIGlmIChoYXNoLmNoYXJBdCgwKSA9PT0gJyMnKSB7CiAgICAgICAgICAgIGhhc2ggPSBoYXNoLnN1YnN0cmluZygxKTsKICAgICAgICB9CgogICAgICAgIGxvY2F0aW9uLnJlcGxhY2UoYmFzZSArICcjJyArIChIaXN0b3J5SGFzaC5oYXNoUHJlZml4IHx8ICcnKSArIGhhc2gpOwogICAgfSwKCiAgICAvKioKICAgICAqIFNldHMgdGhlIGJyb3dzZXIncyBsb2NhdGlvbiBoYXNoIHRvIHRoZSBzcGVjaWZpZWQgc3RyaW5nLiBBdXRvbWF0aWNhbGx5CiAgICAgKiBwcmVwZW5kcyB0aGUgPGNvZGU+aGFzaFByZWZpeDwvY29kZT4gaWYgb25lIGlzIHNldC4KICAgICAqCiAgICAgKiBAbWV0aG9kIHNldEhhc2gKICAgICAqIEBwYXJhbSB7U3RyaW5nfSBoYXNoIG5ldyBsb2NhdGlvbiBoYXNoCiAgICAgKiBAc3RhdGljCiAgICAgKi8KICAgIHNldEhhc2g6IGZ1bmN0aW9uIChoYXNoKSB7CiAgICAgICAgdmFyIGxvY2F0aW9uID0gWS5nZXRMb2NhdGlvbigpOwoKICAgICAgICBpZiAoaGFzaC5jaGFyQXQoMCkgPT09ICcjJykgewogICAgICAgICAgICBoYXNoID0gaGFzaC5zdWJzdHJpbmcoMSk7CiAgICAgICAgfQoKICAgICAgICBsb2NhdGlvbi5oYXNoID0gKEhpc3RvcnlIYXNoLmhhc2hQcmVmaXggfHwgJycpICsgaGFzaDsKICAgIH0KfSk7CgovLyAtLSBTeW50aGV0aWMgaGFzaGNoYW5nZSBFdmVudCAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKLy8gVE9ETzogWVVJRG9jIGN1cnJlbnRseSBkb2Vzbid0IHByb3ZpZGUgYSBnb29kIHdheSB0byBkb2N1bWVudCBzeW50aGV0aWMgRE9NCi8vIGV2ZW50cy4gRm9yIG5vdywgd2UncmUganVzdCBkb2N1bWVudGluZyB0aGUgaGFzaGNoYW5nZSBldmVudCBvbiB0aGUgWVVJCi8vIG9iamVjdCwgd2hpY2ggaXMgYWJvdXQgdGhlIGJlc3Qgd2UgY2FuIGRvIHVudGlsIGVuaGFuY2VtZW50cyBhcmUgbWFkZSB0bwovLyBZVUlEb2MuCgovKioKU3ludGhldGljIDxjb2RlPndpbmRvdy5vbmhhc2hjaGFuZ2U8L2NvZGU+IGV2ZW50IHRoYXQgbm9ybWFsaXplcyBkaWZmZXJlbmNlcwphY3Jvc3MgYnJvd3NlcnMgYW5kIHByb3ZpZGVzIHN1cHBvcnQgZm9yIGJyb3dzZXJzIHRoYXQgZG9uJ3QgbmF0aXZlbHkgc3VwcG9ydAo8Y29kZT5vbmhhc2hjaGFuZ2U8L2NvZGU+LgoKVGhpcyBldmVudCBpcyBwcm92aWRlZCBieSB0aGUgPGNvZGU+aGlzdG9yeS1oYXNoPC9jb2RlPiBtb2R1bGUuCgpAZXhhbXBsZQoKICAgIFlVSSgpLnVzZSgnaGlzdG9yeS1oYXNoJywgZnVuY3Rpb24gKFkpIHsKICAgICAgWS5vbignaGFzaGNoYW5nZScsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgLy8gSGFuZGxlIGhhc2hjaGFuZ2UgZXZlbnRzIG9uIHRoZSBjdXJyZW50IHdpbmRvdy4KICAgICAgfSwgWS5jb25maWcud2luKTsKICAgIH0pOwoKQGV2ZW50IGhhc2hjaGFuZ2UKQHBhcmFtIHtFdmVudEZhY2FkZX0gZSBFdmVudCBmYWNhZGUgd2l0aCB0aGUgZm9sbG93aW5nIGFkZGl0aW9uYWwKICBwcm9wZXJ0aWVzOgoKPGRsPgogIDxkdD5vbGRIYXNoPC9kdD4KICA8ZGQ+CiAgICBQcmV2aW91cyBoYXNoIGZyYWdtZW50IHZhbHVlIGJlZm9yZSB0aGUgY2hhbmdlLgogIDwvZGQ+CgogIDxkdD5vbGRVcmw8L2R0PgogIDxkZD4KICAgIFByZXZpb3VzIFVSTCAoaW5jbHVkaW5nIHRoZSBoYXNoIGZyYWdtZW50KSBiZWZvcmUgdGhlIGNoYW5nZS4KICA8L2RkPgoKICA8ZHQ+bmV3SGFzaDwvZHQ+CiAgPGRkPgogICAgTmV3IGhhc2ggZnJhZ21lbnQgdmFsdWUgYWZ0ZXIgdGhlIGNoYW5nZS4KICA8L2RkPgoKICA8ZHQ+bmV3VXJsPC9kdD4KICA8ZGQ+CiAgICBOZXcgVVJMIChpbmNsdWRpbmcgdGhlIGhhc2ggZnJhZ21lbnQpIGFmdGVyIHRoZSBjaGFuZ2UuCiAgPC9kZD4KPC9kbD4KQGZvciBZVUkKQHNpbmNlIDMuMi4wCioqLwoKaGFzaE5vdGlmaWVycyA9IEdsb2JhbEVudi5fbm90aWZpZXJzOwoKaWYgKCFoYXNoTm90aWZpZXJzKSB7CiAgICBoYXNoTm90aWZpZXJzID0gR2xvYmFsRW52Ll9ub3RpZmllcnMgPSBbXTsKfQoKWS5FdmVudC5kZWZpbmUoJ2hhc2hjaGFuZ2UnLCB7CiAgICBvbjogZnVuY3Rpb24gKG5vZGUsIHN1YnNjcmliZXIsIG5vdGlmaWVyKSB7CiAgICAgICAgLy8gSWdub3JlIHRoaXMgc3Vic2NyaXB0aW9uIGlmIHRoZSBub2RlIGlzIGFueXRoaW5nIG90aGVyIHRoYW4gdGhlCiAgICAgICAgLy8gd2luZG93IG9yIGRvY3VtZW50IGJvZHksIHNpbmNlIHRob3NlIGFyZSB0aGUgb25seSBlbGVtZW50cyB0aGF0CiAgICAgICAgLy8gc2hvdWxkIHN1cHBvcnQgdGhlIGhhc2hjaGFuZ2UgZXZlbnQuIE5vdGUgdGhhdCB0aGUgYm9keSBjb3VsZCBhbHNvIGJlCiAgICAgICAgLy8gYSBmcmFtZXNldCwgYnV0IHRoYXQncyBva2F5IHNpbmNlIGZyYW1lc2V0cyBzdXBwb3J0IGhhc2hjaGFuZ2UgdG9vLgogICAgICAgIGlmIChub2RlLmNvbXBhcmVUbyh3aW4pIHx8IG5vZGUuY29tcGFyZVRvKFkuY29uZmlnLmRvYy5ib2R5KSkgewogICAgICAgICAgICBoYXNoTm90aWZpZXJzLnB1c2gobm90aWZpZXIpOwogICAgICAgIH0KICAgIH0sCgogICAgZGV0YWNoOiBmdW5jdGlvbiAobm9kZSwgc3Vic2NyaWJlciwgbm90aWZpZXIpIHsKICAgICAgICB2YXIgaW5kZXggPSBZQXJyYXkuaW5kZXhPZihoYXNoTm90aWZpZXJzLCBub3RpZmllcik7CgogICAgICAgIGlmIChpbmRleCAhPT0gLTEpIHsKICAgICAgICAgICAgaGFzaE5vdGlmaWVycy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICAgIH0KICAgIH0KfSk7CgpvbGRIYXNoID0gSGlzdG9yeUhhc2guZ2V0SGFzaCgpOwpvbGRVcmwgID0gSGlzdG9yeUhhc2guZ2V0VXJsKCk7CgppZiAoSGlzdG9yeUJhc2UubmF0aXZlSGFzaENoYW5nZSkgewogICAgLy8gV3JhcCB0aGUgYnJvd3NlcidzIG5hdGl2ZSBoYXNoY2hhbmdlIGV2ZW50IGlmIHRoZXJlJ3Mgbm90IGFscmVhZHkgYQogICAgLy8gZ2xvYmFsIGxpc3RlbmVyLgogICAgaWYgKCFHbG9iYWxFbnYuX2hhc2hIYW5kbGUpIHsKICAgICAgICBHbG9iYWxFbnYuX2hhc2hIYW5kbGUgPSBZLkV2ZW50LmF0dGFjaCgnaGFzaGNoYW5nZScsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIHZhciBuZXdIYXNoID0gSGlzdG9yeUhhc2guZ2V0SGFzaCgpLAogICAgICAgICAgICAgICAgbmV3VXJsICA9IEhpc3RvcnlIYXNoLmdldFVybCgpOwoKICAgICAgICAgICAgLy8gSXRlcmF0ZSBvdmVyIGEgY29weSBvZiB0aGUgaGFzaE5vdGlmaWVycyBhcnJheSBzaW5jZSBhIHN1YnNjcmliZXIKICAgICAgICAgICAgLy8gY291bGQgZGV0YWNoIGR1cmluZyBpdGVyYXRpb24gYW5kIGNhdXNlIHRoZSBhcnJheSB0byBiZSByZS1pbmRleGVkLgogICAgICAgICAgICBZQXJyYXkuZWFjaChoYXNoTm90aWZpZXJzLmNvbmNhdCgpLCBmdW5jdGlvbiAobm90aWZpZXIpIHsKICAgICAgICAgICAgICAgIG5vdGlmaWVyLmZpcmUoewogICAgICAgICAgICAgICAgICAgIF9ldmVudCA6IGUsCiAgICAgICAgICAgICAgICAgICAgb2xkSGFzaDogb2xkSGFzaCwKICAgICAgICAgICAgICAgICAgICBvbGRVcmwgOiBvbGRVcmwsCiAgICAgICAgICAgICAgICAgICAgbmV3SGFzaDogbmV3SGFzaCwKICAgICAgICAgICAgICAgICAgICBuZXdVcmwgOiBuZXdVcmwKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIG9sZEhhc2ggPSBuZXdIYXNoOwogICAgICAgICAgICBvbGRVcmwgID0gbmV3VXJsOwogICAgICAgIH0sIHdpbik7CiAgICB9Cn0gZWxzZSB7CiAgICAvLyBCZWdpbiBwb2xsaW5nIGZvciBsb2NhdGlvbiBoYXNoIGNoYW5nZXMgaWYgdGhlcmUncyBub3QgYWxyZWFkeSBhIGdsb2JhbAogICAgLy8gcG9sbCBydW5uaW5nLgogICAgaWYgKCFHbG9iYWxFbnYuX2hhc2hQb2xsKSB7CiAgICAgICAgR2xvYmFsRW52Ll9oYXNoUG9sbCA9IFkubGF0ZXIoNTAsIG51bGwsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIG5ld0hhc2ggPSBIaXN0b3J5SGFzaC5nZXRIYXNoKCksCiAgICAgICAgICAgICAgICBmYWNhZGUsIG5ld1VybDsKCiAgICAgICAgICAgIGlmIChvbGRIYXNoICE9PSBuZXdIYXNoKSB7CiAgICAgICAgICAgICAgICBuZXdVcmwgPSBIaXN0b3J5SGFzaC5nZXRVcmwoKTsKCiAgICAgICAgICAgICAgICBmYWNhZGUgPSB7CiAgICAgICAgICAgICAgICAgICAgb2xkSGFzaDogb2xkSGFzaCwKICAgICAgICAgICAgICAgICAgICBvbGRVcmwgOiBvbGRVcmwsCiAgICAgICAgICAgICAgICAgICAgbmV3SGFzaDogbmV3SGFzaCwKICAgICAgICAgICAgICAgICAgICBuZXdVcmwgOiBuZXdVcmwKICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgb2xkSGFzaCA9IG5ld0hhc2g7CiAgICAgICAgICAgICAgICBvbGRVcmwgID0gbmV3VXJsOwoKICAgICAgICAgICAgICAgIFlBcnJheS5lYWNoKGhhc2hOb3RpZmllcnMuY29uY2F0KCksIGZ1bmN0aW9uIChub3RpZmllcikgewogICAgICAgICAgICAgICAgICAgIG5vdGlmaWVyLmZpcmUoZmFjYWRlKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfSwgbnVsbCwgdHJ1ZSk7CiAgICB9Cn0KClkuSGlzdG9yeUhhc2ggPSBIaXN0b3J5SGFzaDsKCi8vIEhpc3RvcnlIYXNoIHdpbGwgbmV2ZXIgd2luIG92ZXIgSGlzdG9yeUhUTUw1IHVubGVzcyB1c2VIaXN0b3J5SFRNTDUgaXMgZmFsc2UuCmlmICh1c2VIaXN0b3J5SFRNTDUgPT09IGZhbHNlIHx8ICghWS5IaXN0b3J5ICYmIHVzZUhpc3RvcnlIVE1MNSAhPT0gdHJ1ZSAmJgogICAgICAgICghSGlzdG9yeUJhc2UuaHRtbDUgfHwgIVkuSGlzdG9yeUhUTUw1KSkpIHsKICAgIFkuSGlzdG9yeSA9IEhpc3RvcnlIYXNoOwp9CgoKfSwgJzMuMTQuMScsIHsicmVxdWlyZXMiOiBbImV2ZW50LXN5bnRoZXRpYyIsICJoaXN0b3J5LWJhc2UiLCAieXVpLWxhdGVyIl19KTsK",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Thu, 06 Nov 2014 06:38:31 GMT",
                    "Content-Length": "14637",
                    "Date": "Thu, 06 Nov 2014 06:39:24 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}