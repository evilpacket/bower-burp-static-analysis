{
    "url": "http://localhost:9999/synapticism/ajaxinate/src/ajaxinate.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Cross-site scripting (DOM-based)",
    "issueType": 2097936,
    "severity": "High",
    "confidence": "Firm",
    "issueBackground": "DOM-based cross-site scripting vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the HTML document in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause JavaScript code supplied by the attacker to execute within the user's browser in the context of that user's session with the application.<br><br>The attacker-supplied code can perform a wide variety of actions, such as stealing the victim's session token or login credentials, performing arbitrary actions on the victim's behalf, and logging their keystrokes.<br><br>Users can be induced to visit the attacker's crafted URL in various ways, similar to the usual attack delivery vectors for reflected cross-site scripting vulnerabilities. ",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based cross-site scripting vulnerabilities is not to dynamically write data into the HTML document that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing script code into the document. In many cases, the relevant data can be validated on a whitelist basis, to allow only content that is known to be safe. In other cases, it will be necessary to sanitize or encode the data. This can be a complex task, and depending on the context that the data is to be inserted may need to involve a combination of JavaScript escaping, HTML encoding, and URL encoding, in the appropriate sequence.",
    "issueDetail": "The application may be vulnerable to DOM-based cross-site scripting. Data is read from <b>location.hash</b> and written to <b>$()</b> via the following statements:<ul><li>var $body = $('body' ...t' ) .offset() .top;</li><li>var $hash = $('[id=\"'+hash+'\"]');</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/synapticism/ajaxinate/src/ajaxinate.js",
                "path": "/synapticism/ajaxinate/src/ajaxinate.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9zeW5hcHRpY2lzbS9hamF4aW5hdGUvc3JjL2FqYXhpbmF0ZS5qcyBIVFRQLzEuMQ0KSG9zdDogbG9jYWxob3N0Ojk5OTkNCg0K",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMTUwMTUNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IFRodSwgMDYgTm92IDIwMTQgMDY6NDQ6MjQgR01UDQpMYXN0LU1vZGlmaWVkOiBUaHUsIDA2IE5vdiAyMDE0IDA2OjQ0OjI0IEdNVA0KDQovLyA9PT09IEFKQVhJTkFURSA9PT09IC8vCgovLyBEb2N1bWVudGF0aW9uOiBodHRwczovL2dpdGh1Yi5jb20vc3luYXB0aWNpc20vYWpheGluYXRlCgovLyBHbG9iYWwgbmFtZXNwYWNlIG9iamVjdDsgaW5zcGlyYXRpb24gZm9yIHRoZSBkZXNpZ24gb2YgdGhpcyB2aWEgUnlhbiBGbG9yZW5jZTogaHR0cDovL3J5YW5mbG9yZW5jZS5jb20vYXV0aG9yaW5nLWpxdWVyeS1wbHVnaW5zLXdpdGgtb2JqZWN0LW9yaWVudGVkLWphdmFzY3JpcHQvCnZhciBYTjggPSB7fTsKCjsoZnVuY3Rpb24oJCwgd2luZG93LCBkb2N1bWVudCwgdW5kZWZpbmVkKXsKICAndXNlIHN0cmljdCc7CgogIC8vIEluaXRpYWxpemUgSFRNTDUtSGlzdG9yeS1BUEkgcG9seWZpbGwgd2l0aCB0aGlzIHNpbmdsZSBsaW5lCiAgdmFyIGxvY2F0aW9uID0gd2luZG93Lmhpc3RvcnkubG9jYXRpb24gfHwgd2luZG93LmxvY2F0aW9uOwoKICAvLyBDaGVjayB0byBzZWUgaWYgdGhlIGJyb3dzZXIgc3VwcG9ydHMgdGhlIEhUTUw1IGhpc3RvcnkgQVBJOyBpZiBub3QsIGZhaWwgZWFybHkgYW5kIGxldCB0aGUgc2l0ZSBsb2FkIG5vcm1hbGx5CiAgaWYgKCAhKHdpbmRvdy5oaXN0b3J5ICYmIGhpc3RvcnkucHVzaFN0YXRlKSApIHsKICAgIHJldHVybiBmYWxzZTsKICB9CgogIC8vIENvbnN0cnVjdG9yIGZ1bmN0aW9uCiAgdmFyIEFqYXhpbmF0ZSA9IHRoaXMuQWpheGluYXRlID0gZnVuY3Rpb24oZWxlbWVudCwgb3B0cyl7CiAgICB0aGlzLmVsZW1lbnQgPSBlbGVtZW50OwogICAgdGhpcy5vcHRzID0gJC5leHRlbmQoe30sICQuZm4uYWpheGluYXRlLmRlZmF1bHRzLCBvcHRzKTsKICAgIHRoaXMuaW5pdCgpOwogIH07CgogIC8vIFByb3RvdHlwZSBsb2dpYwogIEFqYXhpbmF0ZS5wcm90b3R5cGUgPSB7CiAgICBpbml0OiBmdW5jdGlvbigpewoKICAgICAgLy8gRmV0Y2ggaW5pdGlhbCBjb250ZW50IGFuZCBtZW51CiAgICAgIHRoaXMuY29udGVudCA9ICQodGhpcy5vcHRzLmNvbnRlbnRTZWwpLmZpbHRlcignOmZpcnN0Jyk7CiAgICAgIHRoaXMubWVudSA9ICQodGhpcy5vcHRzLm1lbnVTZWwpLmZpbHRlcignOmZpcnN0Jyk7CgogICAgICAvLyBJbnZhbGlkIGNvbnRlbnQgc2VsZWN0b3I7IGFib3J0IG1pc3Npb24hIChXZSBjYW4gaGFuZGxlIGEgYmFkIG1lbnUgc2VsZWN0b3IsIGhvd2V2ZXIuLi4pCiAgICAgIGlmICghdGhpcy5jb250ZW50Lmxlbmd0aCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgLy8gSW5pdGlhbGl6ZSBpbnRlcm5hbCBsaW5rIHNlbGVjdG9yCiAgICAgIHRoaXMuaW50ZXJuYWxTZWwoKTsKCiAgICAgIC8vIEluaXRpYWxpemUgZXZlbnQgaGFuZGxlcnMgZm9yIHRoZSBlbGVtZW50KHMpIHNwZWNpZmllZAogICAgICB0aGlzLnByZXAodGhpcy5lbGVtZW50KTsKCiAgICAgIC8vIEluaXRpYWxpemUgcG9wc3RhdGUgZXZlbnQgaGFuZGxlcgogICAgICB0aGlzLnBvcHBlcigpOwoKICAgICAgLy8gSW5pdGlhbGl6ZSBzcGlubmVyCiAgICAgIHRoaXMuc3Bpbm5lcigpOwogICAgfSwKCgoKICAgIC8vIEludGVybmFsIGxpbmsgc2xlY3RvcgogICAgaW50ZXJuYWxTZWw6IGZ1bmN0aW9uKCl7CiAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgIC8vIFJlZ2lzdGVyIHRoZSBjdXN0b20gc2VsZWN0b3IgdG8gaWRlbnRpZnkgaW50ZXJuYWwgbGlua3MKICAgICAgJC5leHByWyc6J10uaW50ZXJuYWwgPSBmdW5jdGlvbihvYmosaW5kZXgsbWV0YSxzdGFjayl7CiAgICAgICAgdmFyCiAgICAgICAgICAkdGhpcyAgID0gJChvYmopLAogICAgICAgICAgdXJsICAgICA9ICR0aGlzLmF0dHIoJ2hyZWYnKSB8fCAnJywKICAgICAgICAgIHJvb3R1cmwgPSBzZWxmLnJvb3QoKTsKCiAgICAgICAgLy8gVGhlIGxpbmsgaXMgImludGVybmFsIiBpZjogdGhlIGRvbWFpbiBtYXRjaGVzIHRoZSBjdXJyZW50IGRvbWFpbiBvciB0aGVyZSBpcyBubyBwcm90b2NvbCAoaS5lLiBpdCBpcyBhIHJlbGF0aXZlIGxpbmspCiAgICAgICAgcmV0dXJuIHVybC5zdWJzdHJpbmcoMCxyb290dXJsLmxlbmd0aCkgPT09IHJvb3R1cmwgfHwgdXJsLmluZGV4T2YoJzonKSA9PT0gLTE7CiAgICAgIH07CiAgICB9LCAvLyBlbmQgaW50ZXJuYWxTZWwoKQoKCgogICAgLy8gUHJpbWFyeSBldmVudCBiaW5kaW5nIGZ1bmN0aW9uCiAgICBwcmVwOiBmdW5jdGlvbihlbGVtZW50KXsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgLy8gU2VsZWN0IGFsbCBhbmNob3IgdGFncyB3aXRoaW4gdGhlIHRhcmdldCBlbGVtZW50OyB1c2VzIG5hdGl2ZSBKYXZhU2NyaXB0IG1ldGhvZHMgKGZhc3QpCiAgICAgICQoZWxlbWVudCkuZmluZCgnYScpCgogICAgICAvLyBOb3cgZmlsdGVyIHRoZSByZXN1bHRzIHRvIGZpbmQgY2VydGFpbiBpbnRlcm5hbCBsaW5rczsgdXNlcyBjb21wbGV4IGpRdWVyeSBzZWxlY3RvcnMgKHNsb3cpCiAgICAgIC5maWx0ZXIoJzppbnRlcm5hbCcgKyBzZWxmLm9wdHMuZmlsdGVycykKCiAgICAgIC8vIE1hbmFnZSBjbGljayBldmVudAogICAgICAub24oJ2NsaWNrJywgZnVuY3Rpb24oZXZlbnQpewogICAgICAgIHZhcgogICAgICAgICAgJHRoaXMgPSAkKHRoaXMpLAogICAgICAgICAgdXJsICAgPSAkdGhpcy5hdHRyKCdocmVmJyksCiAgICAgICAgICB0aXRsZSA9ICR0aGlzLmF0dHIoJ3RpdGxlJykgfHwgbnVsbDsgLy8gTm90IGh1Z2VseSBpbXBvcnRhbnQgYnV0IHdlJ2xsIHVzZSBhIHRpdGxlIGF0dHJpYnV0ZSBpZiBvbmUgaGFwcGVucyB0byBiZSBwcmVzZW50CgogICAgICAgIC8vIFJldHVybiBmYWxzZSAoYW5kIHByZXZlbnQgYWxsIGFjdGlvbnMpIHVuZGVyIHRoZXNlIGNpcmN1bXN0YW5jZXM6CiAgICAgICAgLy8gLSBVUkwgaXMgdGhlIHNhbWUgYXMgdGhlIGN1cnJlbnQgbG9jYXRpb24gKG5vIHNlbnNlIGluIHJlbG9hZGluZyBhbnl0aGluZykKICAgICAgICAvLyAtIFVSTCBpcyBqdXN0IGEgaGFzaCAoZGl0dG8pCiAgICAgICAgaWYgKCB1cmwgPT09IGxvY2F0aW9uLmhyZWYgfHwgdXJsID09PSAnIycgKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICAvLyBSZXR1cm4gdHJ1ZSAoYW5kIGFsbG93IG5vcm1hbCBicm93c2VyIGJlaGF2aW9yKSB1bmRlciB0aGVzZSBjaXJjdW1zdGFuY2VzOgogICAgICAgIC8vIC0gTWlkZGxlIG1vdXNlIGJ1dHRvbiBjbGlja3MgKGV2ZW50LndoaWNoID09PSAyKTsgcmVmZXJlbmNlOiBodHRwczovL2FwaS5qcXVlcnkuY29tL2V2ZW50LndoaWNoLwogICAgICAgIC8vIC0gQ29tbWFuZCBhbmQgY29udHJvbCBrZXkgY2xpY2tzIGUuZy4gdG8gb3BlbiBpbiBhIG5ldyB0YWI7IHJlZmVyZW5jZTogaHR0cHM6Ly9naXRodWIuY29tL2Jyb3dzZXJzdGF0ZS9hamF4aWZ5L3B1bGwvMTUvZmlsZXMKICAgICAgICAvLyAtIFNlZSBhbHNvOiBldmVudC5hbHRLZXksIGV2ZW50LnNoaWZ0S2V5IChub3QgaW1wbGVtZW50ZWQpCiAgICAgICAgLy8gLSBVUkwgbm90IHNldCAoc2hvdWxkbid0IGhhcHBlbikgb3IgVVJMIGJlZ2lucyB3aXRoIGEgaGFzaCAoaW4gZG9jdW1lbnQgbGluaykKICAgICAgICAvLyAtIFVSTCBtYXRjaGVzIHRoZSBleGNlcHRpb25zIGRlZmluZWQgaW4gdGhlIG9wdGlvbnMgKGRlZmF1bHRzOiBjZXJ0YWluIGZpbGUgZXh0ZW5zaW9ucyBlLmcuIGltYWdlcywgYXVkaW8gZmlsZXMsIGV0Yy4pCiAgICAgICAgaWYgKAogICAgICAgICAgZXZlbnQud2hpY2ggPT09IDIgfHwKICAgICAgICAgIGV2ZW50Lm1ldGFLZXkgICAgIHx8CiAgICAgICAgICBldmVudC5jdHJsS2V5ICAgICB8fAogICAgICAgICAgIXVybCAgICAgICAgICAgICAgfHwKICAgICAgICAgIHVybFswXSA9PT0gJyMnICAgIHx8CiAgICAgICAgICB1cmwubWF0Y2goc2VsZi5vcHRzLmV4Y2VwdGlvbnMpCiAgICAgICAgKSB7CiAgICAgICAgICAvLyBAVE9ETzogLnRyaWdnZXIoJ2ludGVybmFsRXhjZXB0aW9uJykgY3VzdG9tIGV2ZW50PwogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICAvLyBEb24ndCBtYWtlIGEgcGFnZSByZXF1ZXN0IGlmIHdlJ3ZlIGNvbWUgdGhpcyBmYXIKICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgICAvLyBQdXNoIGFuZCBsb2FkCiAgICAgICAgc2VsZi5wdXNoZXIodGl0bGUsdXJsKTsKICAgICAgfSk7CiAgICB9LCAvLyBlbmQgcHJlcCgpCgoKCiAgICAvLyBQdXNoIHN0YXRlIGhhbmRsZXI7IGlzb2xhdGVkIGhlcmUgZm9yIGdyZWF0ZXIgbW9kdWxhcml0eTsgeW91IGNhbiBjYWxsIHRoaXMgZnJvbSBwbHVnaW5zIG1vcmUgZWFzaWx5CiAgICBwdXNoZXI6IGZ1bmN0aW9uKHRpdGxlLHVybCl7CgogICAgICAvLyBJbml0aWF0ZSBhIHN0YXRlIG9iamVjdCBmb3IgdGhpcyBwdXNoOyBAVE9ETzogZmxlc2ggdGhpcyBvdXQgYSBiaXQsIGl0J3Mgbm90IGh1Z2VseSB1c2VmdWwgaW4gaXRzIHByZXNlbnQgc3RhdGUKICAgICAgdmFyIHN0YXRlID0gewogICAgICAgIHRpdGxlOiB0aXRsZSwKICAgICAgICB1cmw6IHVybAogICAgICB9OwoKICAgICAgLy8gUHVzaCBzdGF0ZQogICAgICBoaXN0b3J5LnB1c2hTdGF0ZShzdGF0ZSx0aXRsZSx1cmwpOwoKICAgICAgLy8gTG9hZCBuZXcgY29udGVudCB2aWEgQUpBWAogICAgICB0aGlzLmxvYWQodXJsKTsKICAgIH0sIC8vIGVuZCBwdXNoZXIoKQoKCgogICAgLy8gVGhlIHBvcHN0YXRlIGV2ZW50IGZpcmVzIHdoZW4gdGhlIHVzZXIgbmF2aWdhdGVzIGJhY2t3YXJkIG9yIGZvcndhcmQgaW4gdGhlIGJyb3dzZXIKICAgIHBvcHBlcjogZnVuY3Rpb24oKXsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwoKICAgICAgJCh3aW5kb3cpLm9uKCdwb3BzdGF0ZScsIGZ1bmN0aW9uKGV2ZW50KXsKCiAgICAgICAgLy8gQFRPRE86IGNoZWNrIHByZXZpb3VzIHN0YXRlIG9iamVjdCB0byBzZWUgd2hldGhlciBtb3JlIHRoYW4ganVzdCB0aGUgaGFzaCBoYXMgY2hhbmdlZAogICAgICAgIC8vIEdldCB5b3VyIGhhc2g6IGh0dHA6Ly9sZWEudmVyb3UubWUvMjAxMS8wNS9nZXQteW91ci1oYXNoLXRoZS1idWxsZXRwcm9vZi13YXkvCiAgICAgICAgaWYgKGxvY2F0aW9uLmhhc2guc3Vic3RyaW5nKDEpID09PSAnJykgewogICAgICAgICAgc2VsZi5sb2FkKGxvY2F0aW9uLmhyZWYpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LCAvLyBlbmQgcG9wcGVyKCkKCgoKICAgIC8vIENvbmRpdGlvbmFsbHkgaW5pdGlhbGl6ZSBzcGlubmVyIGRpdjsgZGVncmFkZXMgZ3JhY2VmdWxseSBpZiBzcGluLmpzIG5vdCBmb3VuZAogICAgc3Bpbm5lcjogZnVuY3Rpb24oKXsKICAgICAgaWYgKCAkLmlzRnVuY3Rpb24od2luZG93LlNwaW5uZXIpICkgewogICAgICAgIHRoaXMuY29udGVudC5iZWZvcmUoJzxkaXYgaWQ9InNwaW5uZXIiIHN0eWxlPSJwb3NpdGlvbjogZml4ZWQ7IGhlaWdodDogMTAwJTsgd2lkdGg6IDEwMCU7Ij48L2Rpdj4nKTsKICAgICAgICAkKCcjc3Bpbm5lcicpLnNwaW4odGhpcy5vcHRzLnNwaW5PcHRzKS5oaWRlKCk7CiAgICAgIH0KICAgIH0sIC8vIGVuZCBzcGlubmVyKCkKCgoKICAgIC8vIFRoaXMgZnVuY3Rpb24gZHluYW1pY2FsbHkgbG9hZHMgY29udGVudCBmcm9tIHRoZSByZXF1ZXN0ZWQgcGFnZQogICAgbG9hZDogZnVuY3Rpb24odXJsKXsKICAgICAgdmFyCiAgICAgICAgc2VsZiAgICAgICA9IHRoaXMsCiAgICAgICAgJGJvZHkgICAgICA9ICQoZG9jdW1lbnQuYm9keSksCiAgICAgICAgJHNwaW5uZXIgICA9ICQoJyNzcGlubmVyJyksCiAgICAgICAgY29udGVudFNlbCA9IHRoaXMub3B0cy5jb250ZW50U2VsLAogICAgICAgIG1lbnVTZWwgICAgPSB0aGlzLm9wdHMubWVudVNlbDsKCiAgICAgIC8vIERpbSBleGlzdGluZyBjb250ZW50OyB1c2UgYW5pbWF0ZSB0byBwcmVzZXJ2ZSB0aGUgZWxlbWVudCdzIGhlaWdodCAoYXZvaWRzIHNjcm9sbGJhciBmbGlja2VyKQogICAgICB0aGlzLmNvbnRlbnQuYW5pbWF0ZSh7IG9wYWNpdHk6IHRoaXMub3B0cy5vdXRPcGFjaXR5IH0sIHRoaXMub3B0cy5vdXREZWxheSk7CgogICAgICAvLyBTcGluIHNwaW4gc3VnYXI7IG5vIGRlbGF5IG5lZWRlZCBoZXJlCiAgICAgICRzcGlubmVyLnNob3coKTsKCiAgICAgIC8vIEFKQVggcGFnZSByZXF1ZXN0OyBmZXRjaCB0aGUgY29udGVudCB3ZSBuZWVkCiAgICAgICQuYWpheCh7CiAgICAgICAgdXJsOiB1cmwsCiAgICAgICAgc3VjY2VzczogZnVuY3Rpb24oZGF0YSx0ZXh0U3RhdHVzLGpxWEhSKXsKCiAgICAgICAgICAvLyBRdWlja2x5IGZhZGUgY29udGVudCBvdXQgZW50aXJlbHkKICAgICAgICAgIHNlbGYuY29udGVudC5hbmltYXRlKHsgb3BhY2l0eTogMCB9LCAyMCk7CgogICAgICAgICAgdmFyCiAgICAgICAgICAgICRkYXRhICAgICAgICAgPSAkKHNlbGYuZG9jSGVscChkYXRhKSksCiAgICAgICAgICAgICRkb2NCb2R5ICAgICAgPSAkZGF0YS5maW5kKCcjZG9jLWJvZHk6Zmlyc3QnKSwKICAgICAgICAgICAgJGNvbnRlbnQgICAgICA9ICRkb2NCb2R5LmZpbmQoY29udGVudFNlbCkuZmlsdGVyKCc6Zmlyc3QnKSwKICAgICAgICAgICAgJG1lbnUgICAgICAgICA9ICRkb2NCb2R5LmZpbmQobWVudVNlbCkuZmlsdGVyKCc6Zmlyc3QnKTsKCiAgICAgICAgICAvLyBJZiBubyBjb250ZW50IGlzIHJlY2VpdmVkIGZvciBhbnkgcmVhc29uIGp1c3QgZm9yd2FyZCB0aGUgdXNlciBvbiB0byB0aGUgdGFyZ2V0IFVSTAogICAgICAgICAgaWYgKCEkY29udGVudC5sZW5ndGgpIHsKICAgICAgICAgICAgZG9jdW1lbnQubG9jYXRpb24uaHJlZiA9IHVybDsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIFN0b3AgYW5pbWF0aW9uIGltbWVkaWF0ZWx5CiAgICAgICAgICBzZWxmLmNvbnRlbnQuc3RvcCh0cnVlLHRydWUpOwoKICAgICAgICAgIC8vIFVwZGF0ZSB0aGUgY29udGVudCBhbmQgcHJlcCBldmVudCBoYW5kbGVycwogICAgICAgICAgc2VsZi5wcmVwKCBzZWxmLmNvbnRlbnQuaHRtbCggJGNvbnRlbnQuaHRtbCgpICkgKTsKCiAgICAgICAgICAvLyBTd2FwIHRoZSBtZW51KHMpIGFuZCBwcmVwIGV2ZW50IGhhbmRsZXJzIGlmIGEgbWVudSBpcyBmb3VuZAogICAgICAgICAgaWYgKCRtZW51Lmxlbmd0aCkgewogICAgICAgICAgICBzZWxmLnByZXAoIHNlbGYubWVudS5odG1sKCAkbWVudS5odG1sKCkgKSApOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIEhhcm1vbml6ZSBib2R5IGNsYXNzZXM7IG1ha2VzIFdvcmRQcmVzcyBwYWdlcyByZW5kZXIgc21vb3RobHkgYnV0IGFsc28gZ2VuZXJhbGx5IHVzZWZ1bAogICAgICAgICAgJGJvZHkuYXR0cignY2xhc3MnLCAkZG9jQm9keS5hdHRyKCdjbGFzcycpKTsKCiAgICAgICAgICAvLyBGYWRlIHRoZSBjb250ZW50IGJhY2sgaW4KICAgICAgICAgIHNlbGYuY29udGVudC5hbmltYXRlKHsgb3BhY2l0eTogMSB9LCBzZWxmLm9wdHMuaW5EZWxheSk7CgogICAgICAgICAgLy8gVXBkYXRlIGJvZHkgc2NyaXB0cyBvdXRzaWRlIG9mIHRoZSBjb250ZW50IGFyZWEKICAgICAgICAgIHNlbGYuc2NyaXB0cyggJGRvY0JvZHkuZmluZCgnc2NyaXB0Jykubm90KGNvbnRlbnRTZWwrJzpmaXJzdCBzY3JpcHQnKSApOwoKICAgICAgICAgIC8vIFVwZGF0ZSBkb2N1bWVudCB0aXRsZQogICAgICAgICAgZG9jdW1lbnQudGl0bGUgPSBzZWxmLnNhbml0aXplKCAkZGF0YS5maW5kKCcjZG9jLXRpdGxlOmZpcnN0JykudGV4dCgpICk7CiAgICAgICAgfSwKCiAgICAgICAgLy8gRXJyb3IgaGFuZGxpbmc7IGZhbGwgYmFjayBvbiByZWd1bGFyIHBhZ2UgbG9hZCBpZiBhbnl0aGluZyBnb2VzIHdyb25nCiAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKGpxWEhSLHRleHRTdGF0dXMsZXJyb3JUaHJvd24pewogICAgICAgICAgZG9jdW1lbnQubG9jYXRpb24uaHJlZiA9IHVybDsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9LCAvLyBlbmQgZXJyb3IgaGFuZGxpbmcKCiAgICAgICAgLy8gQ2xlYW4gdXAgYWZ0ZXIgY29tcGxldGluZyB0aGUgQUpBWCBjYWxsCiAgICAgICAgY29tcGxldGU6IGZ1bmN0aW9uKGpxWEhSLHRleHRTdGF0dXMpewoKICAgICAgICAgIC8vIEZhZGUgb3V0IHNwaW5uZXIKICAgICAgICAgICRzcGlubmVyLmZhZGVPdXQoc2VsZi5vcHRzLnNwaW5GYWRlLCBmdW5jdGlvbigpeyAkKHRoaXMpLmhpZGUoKTsgfSk7CgogICAgICAgICAgLy8gU2Nyb2xsIHRvIHRoZSBhcHByb3ByaWF0ZSBsb2NhdGlvbgogICAgICAgICAgc2VsZi5zY3JvbGwoKTsKCiAgICAgICAgICAvLyBVcGRhdGUgYW5hbHl0aWNzCiAgICAgICAgICBzZWxmLmFuYWx5dGljcyh1cmwpOwoKICAgICAgICB9IC8vIGVuZCBjb21wbGV0ZQoKICAgICAgfSk7IC8vIGVuZCAkLmFqYXgKCiAgICB9LCAvLyBlbmQgbG9hZCgpCgoKCiAgICAvLyBVcGRhdGUgc2NyaXB0cwogICAgc2NyaXB0czogZnVuY3Rpb24oJHNjcmlwdHMpewogICAgICB2YXIKICAgICAgICAkYm9keSAgICAgICA9ICQoJ2JvZHknKSwKICAgICAgICBjb250ZW50U2NyICA9IHRoaXMub3B0cy5jb250ZW50U2VsICsgJzpmaXJzdCBzY3JpcHQnOyAvLyBTZWxlY3RzIGNvbnRlbnQgc2NyaXB0cwoKICAgICAgLy8gRmV0Y2ggYm9keSBzY3JpcHRzIG5vdCBpbiB0aGUgY29udGVudCAod2hpY2ggd2lsbCBiZSByZXBsYWNlZCBhbnlob3cpCiAgICAgIGlmICggJHNjcmlwdHMubGVuZ3RoICkgewogICAgICAgICRzY3JpcHRzLmRldGFjaCgpOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBmYWxzZTsgLy8gRWFybHkgZXhpdDsgdGhlcmUgYXJlIG5vIHNjcmlwdHMgdG8gd29yayB3aXRoCiAgICAgIH0KCiAgICAgIC8vIFVwZGF0ZSB0aGUgYm9keSBzY3JpcHRzIG91dHNpZGUgb2YgdGhlIGNvbnRlbnQgYXJlYTsgd2UncmUgYXNzdW1pbmcgdGhhdCBoZWFkZXIgc2NyaXB0cyBkb24ndCBjaGFuZ2UKICAgICAgJHNjcmlwdHMuZWFjaChmdW5jdGlvbigpewogICAgICAgIHZhciAkdGhpcyA9ICQodGhpcyk7CgogICAgICAgIC8vIElmIHRoZSBjdXJyZW50IHNjcmlwdCBpc24ndCBlbXB0eSB3ZSBhc3N1bWUgaXQgbXVzdCBiZSBpbmxpbmUKICAgICAgICBpZiAoICR0aGlzLmh0bWwoKSAhPT0gJycgKSB7CgogICAgICAgICAgLy8gU2F2ZSB0aGUgY3VycmVjdCBzY3JpcHQgY29udGVudHMgZm9yIHVzZSBpbiB0aGUgbG9vcCB0byBmb2xsb3cKICAgICAgICAgIHZhcgogICAgICAgICAgICBpbmxpbmVTY3JpcHQgPSAkdGhpcy5odG1sKCksCiAgICAgICAgICAgIGlzTmV3ICAgICAgICA9IHRydWU7CgogICAgICAgICAgLy8gQ2hlY2sgZXhpc3Rpbmcgc2NyaXB0cyB0byBzZWUgaWYgdGhleSBjb250YWluIHRoZSBzYW1lIHN0dWZmCiAgICAgICAgICAkLmVhY2goICRib2R5LmZpbmQoJ3NjcmlwdDpub3QoOmVtcHR5KScpLm5vdChjb250ZW50U2NyKSwgZnVuY3Rpb24oKXsKICAgICAgICAgICAgaWYgKCAkdGhpcy5odG1sKCkgPT09IGlubGluZVNjcmlwdCApIHsKICAgICAgICAgICAgICBpc05ldyA9IGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKCiAgICAgICAgICAvLyBQYXN0ZSBuZXcgc3R1ZmYgaW4gaWYgaXQgaXNuJ3QgZm91bmQgaW4gdGhlIGN1cnJlbnQgRE9NOyB0aGlzIGlzIHF1aXRlIGEga2x1ZGdlCiAgICAgICAgICBpZiAoIGlzTmV3ID09PSB0cnVlICkgewogICAgICAgICAgICAkYm9keS5maW5kKCdzY3JpcHQ6bm90KDplbXB0eSknKS5ub3QoY29udGVudFNjcikuZmlsdGVyKCc6Zmlyc3QnKS5iZWZvcmUoJzxzY3JpcHQ+JyArICR0aGlzLmh0bWwoKSArICc8L3NjcmlwdD4nKTsKICAgICAgICAgIH0KCiAgICAgICAgLy8gRmV0Y2ggbmV3IG5vbi1pbmxpbmUgc2NyaXB0cwogICAgICAgIH0gZWxzZSB7CgogICAgICAgICAgLy8gVGVzdCBmb3IgdGhlIHByZXNlbmNlIG9mIGVhY2ggc2NyaXB0OyBubyBzZW5zZSBpbiByZXBlYXRpbmcgb3Vyc2VsdmVzIGhlcmUKICAgICAgICAgIGlmICggISRib2R5LmZpbmQoJ3NjcmlwdFtzcmMqPSInICsgJHRoaXMuYXR0cignc3JjJykgKyAnIl0nKS5sZW5ndGggKSB7CiAgICAgICAgICAgIC8vICQuZ2V0U2NyaXB0IGRvZXMgbm90IGNhY2hlIHNjcmlwdHMgYnkgZGVmYXVsdCBzbyB3ZSdsbCBza2lwIHRoZSBzaG9ydGN1dCBhbmQgZ28gc3RyYWlnaHQgdG8gdGhlIHNvdXJjZQogICAgICAgICAgICAkLmFqYXgoewogICAgICAgICAgICAgIHVybDogJHRoaXMuYXR0cignc3JjJyksCiAgICAgICAgICAgICAgZGF0YVR5cGU6ICJzY3JpcHQiLAogICAgICAgICAgICAgIGNhY2hlOiB0cnVlLAogICAgICAgICAgICAgIGNvbXBsZXRlOiBmdW5jdGlvbigpeyAvLyBJbiBjYXNlIGNhY2hpbmcgaXNuJ3Qgd29ya2luZy4uLiBhZGQgdGhlIHNjcmlwdCB0byB0aGUgRE9NCiAgICAgICAgICAgICAgICB2YXIgbmV3U2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7CiAgICAgICAgICAgICAgICBuZXdTY3JpcHQuc3JjID0gJHRoaXMuYXR0cignc3JjJyk7IC8vIE5vIG5lZWQgZm9yIHR5cGU9InRleHQvamF2YXNjcmlwdCIgaW4gSFRNTDUKICAgICAgICAgICAgICAgICRib2R5WzBdLmFwcGVuZENoaWxkKG5ld1NjcmlwdCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsgLy8gZW5kICQuYWpheCgpCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsgLy8gZW5kICRzY3JpcHRzLmVhY2goKQogICAgfSwgLy8gZW5kIHNjcmlwdHMoKQoKCgogICAgLy8gRXNjYXBlIEhUTUwgZW50aXRpZXMgaW4gYSBzdHJpbmcKICAgIHNhbml0aXplOiBmdW5jdGlvbihzdHIpewogICAgICByZXR1cm4gU3RyaW5nKHN0cikucmVwbGFjZSgvWyY8PiInXC8hPV0vZywgZnVuY3Rpb24ocyl7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICImIjogIiZhbXA7IiwKICAgICAgICAgICI8IjogIiZsdDsiLAogICAgICAgICAgIj4iOiAiJmd0OyIsCiAgICAgICAgICAnIic6ICImcXVvdDsiLAogICAgICAgICAgIiciOiAiJmFwb3M7IiwKICAgICAgICAgICIvIjogIiYjMDQ3OyIsCiAgICAgICAgICAiISI6ICImIzAzMzsiLAogICAgICAgICAgIj0iOiAiJiMwNjE7IgogICAgICAgIH1bc107CiAgICAgIH0pOwogICAgfSwgLy8gZW5kIHNhbml0aXplKCkKCgoKICAgIC8vIFVwZGF0ZSBzY3JvbGwgcG9zaXRpb24KICAgIHNjcm9sbDogZnVuY3Rpb24oKXsKICAgICAgdmFyCiAgICAgICAgJGJvZHkgICAgICAgPSAkKCdib2R5JyksCiAgICAgICAgaGFzaCAgICAgICAgPSBsb2NhdGlvbi5oYXNoLnN1YnN0cmluZygxKSwKICAgICAgICBzY3JvbGxEZWxheSA9IHRoaXMub3B0cy5zY3JvbGxEZWxheSwKICAgICAgICB0b3AgICAgICAgICA9ICQodGhpcy5vcHRzLmNvbnRlbnRTZWwpLmZpbHRlcignOmZpcnN0Jykub2Zmc2V0KCkudG9wOwoKICAgICAgLy8gVGVzdCBmb3IgdGhlIHByZXNlbmNlIG9mIGEgaGFzaCBpbiB0aGUgbG9jYXRpb24KICAgICAgaWYgKGhhc2ggIT09ICcnKSB7CgogICAgICAgIC8vIERlZmluZSB0aGUgc2VsZWN0b3IKICAgICAgICB2YXIgJGhhc2ggPSAkKCdbaWQ9IicraGFzaCsnIl0nKTsKCiAgICAgICAgLy8gVGVzdCB3aGV0aGVyIHRoZSBzZWxlY3RvciBleGlzdHM7IHNjcm9sbCB0aGVyZSBpZiBmb3VuZCBhbmQgZmFsbCBiYWNrIG9uIHJlZ3VsYXIgc2Nyb2xsIHJvdXRpbmUgaWYgbm90CiAgICAgICAgaWYgKCAkaGFzaC5sZW5ndGggKSB7CiAgICAgICAgICAkYm9keS5hbmltYXRlKHsgc2Nyb2xsVG9wOiAkaGFzaC5vZmZzZXQoKS50b3AgfSwgc2Nyb2xsRGVsYXksICJzd2luZyIpOwogICAgICAgICAgcmV0dXJuOyAvLyBFYXJseSBleGl0IGZyb20gZnVuY3Rpb247IHdlJ3ZlIGdvdCBzb21ldGhpbmcgdG8gc2Nyb2xsIHRvIGFuZCBpdCdzIGdvaW5nIHRvIGJlIGJlbG93IHRoZSBmb2xkCiAgICAgICAgfQogICAgICB9CgogICAgICAvLyBTY3JvbGwgdG8gdGhlIHRvcCBvZiB0aGUgY29udGVudCBjb250YWluZXIgd2hlbiBiZWxvdyB0aGUgZm9sZAogICAgICBpZiAoICQod2luZG93KS5zY3JvbGxUb3AoKSA+IHRvcCApIHsKICAgICAgICAkYm9keS5hbmltYXRlKHsgc2Nyb2xsVG9wOiB0b3AgfSwgc2Nyb2xsRGVsYXksICJzd2luZyIpOwogICAgICB9CgogICAgfSwgLy8gZW5kIHNjcm9sbCgpCgoKCiAgICAvLyBVcGRhdGUgR29vZ2xlIEFuYWx5dGljcyBvbiBjb250ZW50IGxvYWQKICAgIGFuYWx5dGljczogZnVuY3Rpb24odXJsKXsKICAgICAgdmFyIHJlbGF0aXZlVXJsID0gJy8nICsgdXJsLnJlcGxhY2UodGhpcy5yb290KCksICcnKTsgLy8gU2V0IHRoZSByZWxhdGl2ZSBVUkwgcmVxdWlyZWQgYnkgR29vZ2xlIEFuYWx5dGljcwoKICAgICAgLy8gSW5mb3JtIEdvb2dsZSBBbmFseXRpY3Mgb2YgdGhlIGNoYW5nZTsgY29tcGF0aWJsZSB3aXRoIHRoZSBuZXcgVW5pdmVyc2FsIEFuYWx5dGljcyBzY3JpcHQKICAgICAgaWYgKCB0eXBlb2Ygd2luZG93LmdhICE9PSAndW5kZWZpbmVkJyApIHsKICAgICAgICB3aW5kb3cuZ2EoJ3NlbmQnLCAncGFnZXZpZXcnLCByZWxhdGl2ZVVybCk7CiAgICAgIH0gZWxzZSBpZiAoIHR5cGVvZiB3aW5kb3cuX2dhcSAhPT0gJ3VuZGVmaW5lZCcgKSB7CiAgICAgICAgd2luZG93Ll9nYXEucHVzaChbJ190cmFja1BhZ2V2aWV3JywgcmVsYXRpdmVVcmxdKTsgLy8gTGVnYWN5IGFuYWx5dGljczsgcmVmOiBodHRwczovL2dpdGh1Yi5jb20vYnJvd3NlcnN0YXRlL2FqYXhpZnkvcHVsbC8yNQogICAgICB9CiAgICB9LCAvLyBlbmQgYW5hbHl0aWNzKCkKCgoKICAgIC8vIERvY3VtZW50IGhlbHBlcjsgYnJvd3NlcnMgb2Z0ZW4gc3RyaXAgb3V0IGh0bWwsIGhlYWQsIGJvZHksIHRpdGxlLCBiYXNlLCBhbmQgbWV0YSB0YWdzIHdoZW4gdXNpbmcgLmlubmVySFRNTDsgc2VlIGh0dHBzOi8vYXBpLmpxdWVyeS5jb20vbG9hZC8KICAgIC8vIFRoaXMgZnVuY3Rpb24gYWxsb3dzIGFjY2VzcyB0byB0aGVzZSB0YWdzIGJ5IHRyYW5zZm9ybWluZyB0aGVtIHRvIGRpdnMgd2l0aCBpZHMgdGhhdCBtYXRjaCB0aGUgb3JpZ2luYWwgZS5nLiAjZG9jLXRpdGxlCiAgICAvLyBTZWUgYWxzbzogaHR0cHM6Ly9naXN0LmdpdGh1Yi5jb20vY293Ym95Lzc0Mjk1Mi8KICAgIGRvY0hlbHA6IGZ1bmN0aW9uKGh0bWwpewogICAgICB2YXIKICAgICAgICByZXN1bHQgPSBTdHJpbmcoaHRtbCkKICAgICAgICAgIC5yZXBsYWNlKC88XCFET0NUWVBFW14+XSo+L2ksICcnKQogICAgICAgICAgLnJlcGxhY2UoLzwoaHRtbHxoZWFkfGJvZHl8dGl0bGV8YmFzZXxtZXRhKShbXHNcPl0pL2dpLCc8ZGl2IGlkPSJkb2MtJDEiJDInKQogICAgICAgICAgLnJlcGxhY2UoLzxcLyhodG1sfGhlYWR8Ym9keXx0aXRsZXxiYXNlfG1ldGEpXD4vZ2ksJzwvZGl2PicpCiAgICAgIDsKICAgICAgcmV0dXJuICQudHJpbShyZXN1bHQpOwogICAgfSwgLy8gZW5kIGRvY0hlbHAoKQoKCgogICAgLy8gVXRpbGl0eSBmdW5jdGlvbiB0byBnZXQgdGhlIHJvb3QgVVJMIHdpdGggdHJhaWxpbmcgc2xhc2ggZS5nLiBodHRwKHMpOi8veW91cmRvbWFpbi5jb20vCiAgICByb290OiBmdW5jdGlvbigpewogICAgICB2YXIKICAgICAgICBwb3J0ID0gZG9jdW1lbnQubG9jYXRpb24ucG9ydCA/ICc6JyArIGRvY3VtZW50LmxvY2F0aW9uLnBvcnQgOiAnJywKICAgICAgICB1cmwgPSBkb2N1bWVudC5sb2NhdGlvbi5wcm90b2NvbCArICcvLycgKyAoZG9jdW1lbnQubG9jYXRpb24uaG9zdG5hbWUgfHwgZG9jdW1lbnQubG9jYXRpb24uaG9zdCkgKyBwb3J0ICsgJy8nOwogICAgICByZXR1cm4gdXJsOwogICAgfSAvLyBlbmQgcm9vdCgpCgogIH07IC8vIGVuZCBBamF4aW5hdGUucHJvdG90eXBlCgoKCiAgLy8gQSBsaWdodHdlaWdodCBwbHVnaW4gd3JhcHBlciBhcm91bmQgdGhlIGNvbnN0cnVjdG9yIHByZXZlbnRpbmcgbXVsdGlwbGUgaW5zdGFudGlhdGlvbnMKICAkLmZuLmFqYXhpbmF0ZSA9IGZ1bmN0aW9uIChvcHRzKXsKICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXsKICAgICAgaWYgKCEkLmRhdGEodGhpcywgJ1hOOF9hamF4aW5hdGUnKSkgewogICAgICAgICQuZGF0YSh0aGlzLCAnWE44X2FqYXhpbmF0ZScsIG5ldyBBamF4aW5hdGUodGhpcywgb3B0cykpOwogICAgICB9CiAgICB9KTsKICB9OwoKCgogIC8vIEV4dGVuc2libGUgZGVmYXVsdCBzZXR0aW5ncwogICQuZm4uYWpheGluYXRlLmRlZmF1bHRzID0gewogICAgY29udGVudFNlbDogICAgJyNjb250ZW50JyAvLyBUaGUgc2VsZWN0b3IgZm9yIGFsbCBwYWdlIGNvbnRlbnRzCiAgLCBtZW51U2VsOiAgICAgICAnI21lbnUnICAgIC8vIFRoZSBzZWxlY3RvciBmb3IgdGhlIGVudGlyZSBtZW51CiAgLCBvdXREZWxheTogICAgICA2MDAKICAsIG91dE9wYWNpdHk6ICAgIDAuMiAgICAgICAgLy8gRGltbWluZyByYXRoZXIgdGhhbiBjb21wbGV0ZWx5IGhpZGluZyBjb250ZW50CiAgLCBpbkRlbGF5OiAgICAgICAxMjAKICAsIHNjcm9sbERlbGF5OiAgIDMwMAogICwgc3BpbkZhZGU6ICAgICAgMzAwICAgICAgICAvLyBTcGlubmVyIGZhZGUgb3V0IGR1cmF0aW9uCiAgLCBzcGluT3B0czogeyAgICAgICAgICAgICAgIC8vIHNwaW4uanMgb3B0aW9uczsgcmVmZXJlbmNlOiBodHRwczovL2ZnbmFzcy5naXRodWIuaW8vc3Bpbi5qcy8KICAgICAgbGluZXM6ICAyNQogICAgLCBsZW5ndGg6IDAKICAgICwgd2lkdGg6ICA0CiAgICAsIHJhZGl1czogMjUKICAgICwgc3BlZWQ6ICAxLjUKICAgICwgdHJhaWw6ICA0MAogICAgLCB0b3A6ICAgICcyNSUnCiAgfQoKICAvLyBXaGl0ZWxpc3RlZCBleHRlbnNpb25zIChyZWdleHApOyB0aGVzZSB3aWxsIG5lZ2F0ZSB0aGUgY3VzdG9tICJpbnRlcm5hbCIgc2VsZWN0b3IKICAsIGV4Y2VwdGlvbnM6IC9cLihqcGd8anBlZ3xwbmd8Z2lmfGJtcHxwZGZ8bXAzfGZsYWN8d2F2fHJhcnx6aXApJC9pCgogIC8vIEFkZGl0aW9uYWwgc2VsZWN0b3JzIHRvIGZpbHRlciB3aGVuIGJpbmRpbmcgZXZlbnRzIChzdHJpbmcpOyB1c2UgIjpub3Qoc2VsZWN0b3IpIiwgZm9yIGV4YW1wbGUsIHRvIHNraXAgY2VydGFpbiBzZWxlY3RvcnMgZS5nLiBgOm5vdChbaHJlZio9InRlc3QiXSlgIGV0Yy4KICAsIGZpbHRlcnM6ICcnCiAgfTsKCn0pLmFwcGx5KFhOOCwgW2pRdWVyeSwgd2luZG93LCBkb2N1bWVudF0pOwo=",
                "body": "Ly8gPT09PSBBSkFYSU5BVEUgPT09PSAvLwoKLy8gRG9jdW1lbnRhdGlvbjogaHR0cHM6Ly9naXRodWIuY29tL3N5bmFwdGljaXNtL2FqYXhpbmF0ZQoKLy8gR2xvYmFsIG5hbWVzcGFjZSBvYmplY3Q7IGluc3BpcmF0aW9uIGZvciB0aGUgZGVzaWduIG9mIHRoaXMgdmlhIFJ5YW4gRmxvcmVuY2U6IGh0dHA6Ly9yeWFuZmxvcmVuY2UuY29tL2F1dGhvcmluZy1qcXVlcnktcGx1Z2lucy13aXRoLW9iamVjdC1vcmllbnRlZC1qYXZhc2NyaXB0Lwp2YXIgWE44ID0ge307Cgo7KGZ1bmN0aW9uKCQsIHdpbmRvdywgZG9jdW1lbnQsIHVuZGVmaW5lZCl7CiAgJ3VzZSBzdHJpY3QnOwoKICAvLyBJbml0aWFsaXplIEhUTUw1LUhpc3RvcnktQVBJIHBvbHlmaWxsIHdpdGggdGhpcyBzaW5nbGUgbGluZQogIHZhciBsb2NhdGlvbiA9IHdpbmRvdy5oaXN0b3J5LmxvY2F0aW9uIHx8IHdpbmRvdy5sb2NhdGlvbjsKCiAgLy8gQ2hlY2sgdG8gc2VlIGlmIHRoZSBicm93c2VyIHN1cHBvcnRzIHRoZSBIVE1MNSBoaXN0b3J5IEFQSTsgaWYgbm90LCBmYWlsIGVhcmx5IGFuZCBsZXQgdGhlIHNpdGUgbG9hZCBub3JtYWxseQogIGlmICggISh3aW5kb3cuaGlzdG9yeSAmJiBoaXN0b3J5LnB1c2hTdGF0ZSkgKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQoKICAvLyBDb25zdHJ1Y3RvciBmdW5jdGlvbgogIHZhciBBamF4aW5hdGUgPSB0aGlzLkFqYXhpbmF0ZSA9IGZ1bmN0aW9uKGVsZW1lbnQsIG9wdHMpewogICAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDsKICAgIHRoaXMub3B0cyA9ICQuZXh0ZW5kKHt9LCAkLmZuLmFqYXhpbmF0ZS5kZWZhdWx0cywgb3B0cyk7CiAgICB0aGlzLmluaXQoKTsKICB9OwoKICAvLyBQcm90b3R5cGUgbG9naWMKICBBamF4aW5hdGUucHJvdG90eXBlID0gewogICAgaW5pdDogZnVuY3Rpb24oKXsKCiAgICAgIC8vIEZldGNoIGluaXRpYWwgY29udGVudCBhbmQgbWVudQogICAgICB0aGlzLmNvbnRlbnQgPSAkKHRoaXMub3B0cy5jb250ZW50U2VsKS5maWx0ZXIoJzpmaXJzdCcpOwogICAgICB0aGlzLm1lbnUgPSAkKHRoaXMub3B0cy5tZW51U2VsKS5maWx0ZXIoJzpmaXJzdCcpOwoKICAgICAgLy8gSW52YWxpZCBjb250ZW50IHNlbGVjdG9yOyBhYm9ydCBtaXNzaW9uISAoV2UgY2FuIGhhbmRsZSBhIGJhZCBtZW51IHNlbGVjdG9yLCBob3dldmVyLi4uKQogICAgICBpZiAoIXRoaXMuY29udGVudC5sZW5ndGgpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIC8vIEluaXRpYWxpemUgaW50ZXJuYWwgbGluayBzZWxlY3RvcgogICAgICB0aGlzLmludGVybmFsU2VsKCk7CgogICAgICAvLyBJbml0aWFsaXplIGV2ZW50IGhhbmRsZXJzIGZvciB0aGUgZWxlbWVudChzKSBzcGVjaWZpZWQKICAgICAgdGhpcy5wcmVwKHRoaXMuZWxlbWVudCk7CgogICAgICAvLyBJbml0aWFsaXplIHBvcHN0YXRlIGV2ZW50IGhhbmRsZXIKICAgICAgdGhpcy5wb3BwZXIoKTsKCiAgICAgIC8vIEluaXRpYWxpemUgc3Bpbm5lcgogICAgICB0aGlzLnNwaW5uZXIoKTsKICAgIH0sCgoKCiAgICAvLyBJbnRlcm5hbCBsaW5rIHNsZWN0b3IKICAgIGludGVybmFsU2VsOiBmdW5jdGlvbigpewogICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICAvLyBSZWdpc3RlciB0aGUgY3VzdG9tIHNlbGVjdG9yIHRvIGlkZW50aWZ5IGludGVybmFsIGxpbmtzCiAgICAgICQuZXhwclsnOiddLmludGVybmFsID0gZnVuY3Rpb24ob2JqLGluZGV4LG1ldGEsc3RhY2spewogICAgICAgIHZhcgogICAgICAgICAgJHRoaXMgICA9ICQob2JqKSwKICAgICAgICAgIHVybCAgICAgPSAkdGhpcy5hdHRyKCdocmVmJykgfHwgJycsCiAgICAgICAgICByb290dXJsID0gc2VsZi5yb290KCk7CgogICAgICAgIC8vIFRoZSBsaW5rIGlzICJpbnRlcm5hbCIgaWY6IHRoZSBkb21haW4gbWF0Y2hlcyB0aGUgY3VycmVudCBkb21haW4gb3IgdGhlcmUgaXMgbm8gcHJvdG9jb2wgKGkuZS4gaXQgaXMgYSByZWxhdGl2ZSBsaW5rKQogICAgICAgIHJldHVybiB1cmwuc3Vic3RyaW5nKDAscm9vdHVybC5sZW5ndGgpID09PSByb290dXJsIHx8IHVybC5pbmRleE9mKCc6JykgPT09IC0xOwogICAgICB9OwogICAgfSwgLy8gZW5kIGludGVybmFsU2VsKCkKCgoKICAgIC8vIFByaW1hcnkgZXZlbnQgYmluZGluZyBmdW5jdGlvbgogICAgcHJlcDogZnVuY3Rpb24oZWxlbWVudCl7CiAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgIC8vIFNlbGVjdCBhbGwgYW5jaG9yIHRhZ3Mgd2l0aGluIHRoZSB0YXJnZXQgZWxlbWVudDsgdXNlcyBuYXRpdmUgSmF2YVNjcmlwdCBtZXRob2RzIChmYXN0KQogICAgICAkKGVsZW1lbnQpLmZpbmQoJ2EnKQoKICAgICAgLy8gTm93IGZpbHRlciB0aGUgcmVzdWx0cyB0byBmaW5kIGNlcnRhaW4gaW50ZXJuYWwgbGlua3M7IHVzZXMgY29tcGxleCBqUXVlcnkgc2VsZWN0b3JzIChzbG93KQogICAgICAuZmlsdGVyKCc6aW50ZXJuYWwnICsgc2VsZi5vcHRzLmZpbHRlcnMpCgogICAgICAvLyBNYW5hZ2UgY2xpY2sgZXZlbnQKICAgICAgLm9uKCdjbGljaycsIGZ1bmN0aW9uKGV2ZW50KXsKICAgICAgICB2YXIKICAgICAgICAgICR0aGlzID0gJCh0aGlzKSwKICAgICAgICAgIHVybCAgID0gJHRoaXMuYXR0cignaHJlZicpLAogICAgICAgICAgdGl0bGUgPSAkdGhpcy5hdHRyKCd0aXRsZScpIHx8IG51bGw7IC8vIE5vdCBodWdlbHkgaW1wb3J0YW50IGJ1dCB3ZSdsbCB1c2UgYSB0aXRsZSBhdHRyaWJ1dGUgaWYgb25lIGhhcHBlbnMgdG8gYmUgcHJlc2VudAoKICAgICAgICAvLyBSZXR1cm4gZmFsc2UgKGFuZCBwcmV2ZW50IGFsbCBhY3Rpb25zKSB1bmRlciB0aGVzZSBjaXJjdW1zdGFuY2VzOgogICAgICAgIC8vIC0gVVJMIGlzIHRoZSBzYW1lIGFzIHRoZSBjdXJyZW50IGxvY2F0aW9uIChubyBzZW5zZSBpbiByZWxvYWRpbmcgYW55dGhpbmcpCiAgICAgICAgLy8gLSBVUkwgaXMganVzdCBhIGhhc2ggKGRpdHRvKQogICAgICAgIGlmICggdXJsID09PSBsb2NhdGlvbi5ocmVmIHx8IHVybCA9PT0gJyMnICkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgLy8gUmV0dXJuIHRydWUgKGFuZCBhbGxvdyBub3JtYWwgYnJvd3NlciBiZWhhdmlvcikgdW5kZXIgdGhlc2UgY2lyY3Vtc3RhbmNlczoKICAgICAgICAvLyAtIE1pZGRsZSBtb3VzZSBidXR0b24gY2xpY2tzIChldmVudC53aGljaCA9PT0gMik7IHJlZmVyZW5jZTogaHR0cHM6Ly9hcGkuanF1ZXJ5LmNvbS9ldmVudC53aGljaC8KICAgICAgICAvLyAtIENvbW1hbmQgYW5kIGNvbnRyb2wga2V5IGNsaWNrcyBlLmcuIHRvIG9wZW4gaW4gYSBuZXcgdGFiOyByZWZlcmVuY2U6IGh0dHBzOi8vZ2l0aHViLmNvbS9icm93c2Vyc3RhdGUvYWpheGlmeS9wdWxsLzE1L2ZpbGVzCiAgICAgICAgLy8gLSBTZWUgYWxzbzogZXZlbnQuYWx0S2V5LCBldmVudC5zaGlmdEtleSAobm90IGltcGxlbWVudGVkKQogICAgICAgIC8vIC0gVVJMIG5vdCBzZXQgKHNob3VsZG4ndCBoYXBwZW4pIG9yIFVSTCBiZWdpbnMgd2l0aCBhIGhhc2ggKGluIGRvY3VtZW50IGxpbmspCiAgICAgICAgLy8gLSBVUkwgbWF0Y2hlcyB0aGUgZXhjZXB0aW9ucyBkZWZpbmVkIGluIHRoZSBvcHRpb25zIChkZWZhdWx0czogY2VydGFpbiBmaWxlIGV4dGVuc2lvbnMgZS5nLiBpbWFnZXMsIGF1ZGlvIGZpbGVzLCBldGMuKQogICAgICAgIGlmICgKICAgICAgICAgIGV2ZW50LndoaWNoID09PSAyIHx8CiAgICAgICAgICBldmVudC5tZXRhS2V5ICAgICB8fAogICAgICAgICAgZXZlbnQuY3RybEtleSAgICAgfHwKICAgICAgICAgICF1cmwgICAgICAgICAgICAgIHx8CiAgICAgICAgICB1cmxbMF0gPT09ICcjJyAgICB8fAogICAgICAgICAgdXJsLm1hdGNoKHNlbGYub3B0cy5leGNlcHRpb25zKQogICAgICAgICkgewogICAgICAgICAgLy8gQFRPRE86IC50cmlnZ2VyKCdpbnRlcm5hbEV4Y2VwdGlvbicpIGN1c3RvbSBldmVudD8KICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgLy8gRG9uJ3QgbWFrZSBhIHBhZ2UgcmVxdWVzdCBpZiB3ZSd2ZSBjb21lIHRoaXMgZmFyCiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKCiAgICAgICAgLy8gUHVzaCBhbmQgbG9hZAogICAgICAgIHNlbGYucHVzaGVyKHRpdGxlLHVybCk7CiAgICAgIH0pOwogICAgfSwgLy8gZW5kIHByZXAoKQoKCgogICAgLy8gUHVzaCBzdGF0ZSBoYW5kbGVyOyBpc29sYXRlZCBoZXJlIGZvciBncmVhdGVyIG1vZHVsYXJpdHk7IHlvdSBjYW4gY2FsbCB0aGlzIGZyb20gcGx1Z2lucyBtb3JlIGVhc2lseQogICAgcHVzaGVyOiBmdW5jdGlvbih0aXRsZSx1cmwpewoKICAgICAgLy8gSW5pdGlhdGUgYSBzdGF0ZSBvYmplY3QgZm9yIHRoaXMgcHVzaDsgQFRPRE86IGZsZXNoIHRoaXMgb3V0IGEgYml0LCBpdCdzIG5vdCBodWdlbHkgdXNlZnVsIGluIGl0cyBwcmVzZW50IHN0YXRlCiAgICAgIHZhciBzdGF0ZSA9IHsKICAgICAgICB0aXRsZTogdGl0bGUsCiAgICAgICAgdXJsOiB1cmwKICAgICAgfTsKCiAgICAgIC8vIFB1c2ggc3RhdGUKICAgICAgaGlzdG9yeS5wdXNoU3RhdGUoc3RhdGUsdGl0bGUsdXJsKTsKCiAgICAgIC8vIExvYWQgbmV3IGNvbnRlbnQgdmlhIEFKQVgKICAgICAgdGhpcy5sb2FkKHVybCk7CiAgICB9LCAvLyBlbmQgcHVzaGVyKCkKCgoKICAgIC8vIFRoZSBwb3BzdGF0ZSBldmVudCBmaXJlcyB3aGVuIHRoZSB1c2VyIG5hdmlnYXRlcyBiYWNrd2FyZCBvciBmb3J3YXJkIGluIHRoZSBicm93c2VyCiAgICBwb3BwZXI6IGZ1bmN0aW9uKCl7CiAgICAgIHZhciBzZWxmID0gdGhpczsKCiAgICAgICQod2luZG93KS5vbigncG9wc3RhdGUnLCBmdW5jdGlvbihldmVudCl7CgogICAgICAgIC8vIEBUT0RPOiBjaGVjayBwcmV2aW91cyBzdGF0ZSBvYmplY3QgdG8gc2VlIHdoZXRoZXIgbW9yZSB0aGFuIGp1c3QgdGhlIGhhc2ggaGFzIGNoYW5nZWQKICAgICAgICAvLyBHZXQgeW91ciBoYXNoOiBodHRwOi8vbGVhLnZlcm91Lm1lLzIwMTEvMDUvZ2V0LXlvdXItaGFzaC10aGUtYnVsbGV0cHJvb2Ytd2F5LwogICAgICAgIGlmIChsb2NhdGlvbi5oYXNoLnN1YnN0cmluZygxKSA9PT0gJycpIHsKICAgICAgICAgIHNlbGYubG9hZChsb2NhdGlvbi5ocmVmKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwgLy8gZW5kIHBvcHBlcigpCgoKCiAgICAvLyBDb25kaXRpb25hbGx5IGluaXRpYWxpemUgc3Bpbm5lciBkaXY7IGRlZ3JhZGVzIGdyYWNlZnVsbHkgaWYgc3Bpbi5qcyBub3QgZm91bmQKICAgIHNwaW5uZXI6IGZ1bmN0aW9uKCl7CiAgICAgIGlmICggJC5pc0Z1bmN0aW9uKHdpbmRvdy5TcGlubmVyKSApIHsKICAgICAgICB0aGlzLmNvbnRlbnQuYmVmb3JlKCc8ZGl2IGlkPSJzcGlubmVyIiBzdHlsZT0icG9zaXRpb246IGZpeGVkOyBoZWlnaHQ6IDEwMCU7IHdpZHRoOiAxMDAlOyI+PC9kaXY+Jyk7CiAgICAgICAgJCgnI3NwaW5uZXInKS5zcGluKHRoaXMub3B0cy5zcGluT3B0cykuaGlkZSgpOwogICAgICB9CiAgICB9LCAvLyBlbmQgc3Bpbm5lcigpCgoKCiAgICAvLyBUaGlzIGZ1bmN0aW9uIGR5bmFtaWNhbGx5IGxvYWRzIGNvbnRlbnQgZnJvbSB0aGUgcmVxdWVzdGVkIHBhZ2UKICAgIGxvYWQ6IGZ1bmN0aW9uKHVybCl7CiAgICAgIHZhcgogICAgICAgIHNlbGYgICAgICAgPSB0aGlzLAogICAgICAgICRib2R5ICAgICAgPSAkKGRvY3VtZW50LmJvZHkpLAogICAgICAgICRzcGlubmVyICAgPSAkKCcjc3Bpbm5lcicpLAogICAgICAgIGNvbnRlbnRTZWwgPSB0aGlzLm9wdHMuY29udGVudFNlbCwKICAgICAgICBtZW51U2VsICAgID0gdGhpcy5vcHRzLm1lbnVTZWw7CgogICAgICAvLyBEaW0gZXhpc3RpbmcgY29udGVudDsgdXNlIGFuaW1hdGUgdG8gcHJlc2VydmUgdGhlIGVsZW1lbnQncyBoZWlnaHQgKGF2b2lkcyBzY3JvbGxiYXIgZmxpY2tlcikKICAgICAgdGhpcy5jb250ZW50LmFuaW1hdGUoeyBvcGFjaXR5OiB0aGlzLm9wdHMub3V0T3BhY2l0eSB9LCB0aGlzLm9wdHMub3V0RGVsYXkpOwoKICAgICAgLy8gU3BpbiBzcGluIHN1Z2FyOyBubyBkZWxheSBuZWVkZWQgaGVyZQogICAgICAkc3Bpbm5lci5zaG93KCk7CgogICAgICAvLyBBSkFYIHBhZ2UgcmVxdWVzdDsgZmV0Y2ggdGhlIGNvbnRlbnQgd2UgbmVlZAogICAgICAkLmFqYXgoewogICAgICAgIHVybDogdXJsLAogICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKGRhdGEsdGV4dFN0YXR1cyxqcVhIUil7CgogICAgICAgICAgLy8gUXVpY2tseSBmYWRlIGNvbnRlbnQgb3V0IGVudGlyZWx5CiAgICAgICAgICBzZWxmLmNvbnRlbnQuYW5pbWF0ZSh7IG9wYWNpdHk6IDAgfSwgMjApOwoKICAgICAgICAgIHZhcgogICAgICAgICAgICAkZGF0YSAgICAgICAgID0gJChzZWxmLmRvY0hlbHAoZGF0YSkpLAogICAgICAgICAgICAkZG9jQm9keSAgICAgID0gJGRhdGEuZmluZCgnI2RvYy1ib2R5OmZpcnN0JyksCiAgICAgICAgICAgICRjb250ZW50ICAgICAgPSAkZG9jQm9keS5maW5kKGNvbnRlbnRTZWwpLmZpbHRlcignOmZpcnN0JyksCiAgICAgICAgICAgICRtZW51ICAgICAgICAgPSAkZG9jQm9keS5maW5kKG1lbnVTZWwpLmZpbHRlcignOmZpcnN0Jyk7CgogICAgICAgICAgLy8gSWYgbm8gY29udGVudCBpcyByZWNlaXZlZCBmb3IgYW55IHJlYXNvbiBqdXN0IGZvcndhcmQgdGhlIHVzZXIgb24gdG8gdGhlIHRhcmdldCBVUkwKICAgICAgICAgIGlmICghJGNvbnRlbnQubGVuZ3RoKSB7CiAgICAgICAgICAgIGRvY3VtZW50LmxvY2F0aW9uLmhyZWYgPSB1cmw7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyBTdG9wIGFuaW1hdGlvbiBpbW1lZGlhdGVseQogICAgICAgICAgc2VsZi5jb250ZW50LnN0b3AodHJ1ZSx0cnVlKTsKCiAgICAgICAgICAvLyBVcGRhdGUgdGhlIGNvbnRlbnQgYW5kIHByZXAgZXZlbnQgaGFuZGxlcnMKICAgICAgICAgIHNlbGYucHJlcCggc2VsZi5jb250ZW50Lmh0bWwoICRjb250ZW50Lmh0bWwoKSApICk7CgogICAgICAgICAgLy8gU3dhcCB0aGUgbWVudShzKSBhbmQgcHJlcCBldmVudCBoYW5kbGVycyBpZiBhIG1lbnUgaXMgZm91bmQKICAgICAgICAgIGlmICgkbWVudS5sZW5ndGgpIHsKICAgICAgICAgICAgc2VsZi5wcmVwKCBzZWxmLm1lbnUuaHRtbCggJG1lbnUuaHRtbCgpICkgKTsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyBIYXJtb25pemUgYm9keSBjbGFzc2VzOyBtYWtlcyBXb3JkUHJlc3MgcGFnZXMgcmVuZGVyIHNtb290aGx5IGJ1dCBhbHNvIGdlbmVyYWxseSB1c2VmdWwKICAgICAgICAgICRib2R5LmF0dHIoJ2NsYXNzJywgJGRvY0JvZHkuYXR0cignY2xhc3MnKSk7CgogICAgICAgICAgLy8gRmFkZSB0aGUgY29udGVudCBiYWNrIGluCiAgICAgICAgICBzZWxmLmNvbnRlbnQuYW5pbWF0ZSh7IG9wYWNpdHk6IDEgfSwgc2VsZi5vcHRzLmluRGVsYXkpOwoKICAgICAgICAgIC8vIFVwZGF0ZSBib2R5IHNjcmlwdHMgb3V0c2lkZSBvZiB0aGUgY29udGVudCBhcmVhCiAgICAgICAgICBzZWxmLnNjcmlwdHMoICRkb2NCb2R5LmZpbmQoJ3NjcmlwdCcpLm5vdChjb250ZW50U2VsKyc6Zmlyc3Qgc2NyaXB0JykgKTsKCiAgICAgICAgICAvLyBVcGRhdGUgZG9jdW1lbnQgdGl0bGUKICAgICAgICAgIGRvY3VtZW50LnRpdGxlID0gc2VsZi5zYW5pdGl6ZSggJGRhdGEuZmluZCgnI2RvYy10aXRsZTpmaXJzdCcpLnRleHQoKSApOwogICAgICAgIH0sCgogICAgICAgIC8vIEVycm9yIGhhbmRsaW5nOyBmYWxsIGJhY2sgb24gcmVndWxhciBwYWdlIGxvYWQgaWYgYW55dGhpbmcgZ29lcyB3cm9uZwogICAgICAgIGVycm9yOiBmdW5jdGlvbihqcVhIUix0ZXh0U3RhdHVzLGVycm9yVGhyb3duKXsKICAgICAgICAgIGRvY3VtZW50LmxvY2F0aW9uLmhyZWYgPSB1cmw7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfSwgLy8gZW5kIGVycm9yIGhhbmRsaW5nCgogICAgICAgIC8vIENsZWFuIHVwIGFmdGVyIGNvbXBsZXRpbmcgdGhlIEFKQVggY2FsbAogICAgICAgIGNvbXBsZXRlOiBmdW5jdGlvbihqcVhIUix0ZXh0U3RhdHVzKXsKCiAgICAgICAgICAvLyBGYWRlIG91dCBzcGlubmVyCiAgICAgICAgICAkc3Bpbm5lci5mYWRlT3V0KHNlbGYub3B0cy5zcGluRmFkZSwgZnVuY3Rpb24oKXsgJCh0aGlzKS5oaWRlKCk7IH0pOwoKICAgICAgICAgIC8vIFNjcm9sbCB0byB0aGUgYXBwcm9wcmlhdGUgbG9jYXRpb24KICAgICAgICAgIHNlbGYuc2Nyb2xsKCk7CgogICAgICAgICAgLy8gVXBkYXRlIGFuYWx5dGljcwogICAgICAgICAgc2VsZi5hbmFseXRpY3ModXJsKTsKCiAgICAgICAgfSAvLyBlbmQgY29tcGxldGUKCiAgICAgIH0pOyAvLyBlbmQgJC5hamF4CgogICAgfSwgLy8gZW5kIGxvYWQoKQoKCgogICAgLy8gVXBkYXRlIHNjcmlwdHMKICAgIHNjcmlwdHM6IGZ1bmN0aW9uKCRzY3JpcHRzKXsKICAgICAgdmFyCiAgICAgICAgJGJvZHkgICAgICAgPSAkKCdib2R5JyksCiAgICAgICAgY29udGVudFNjciAgPSB0aGlzLm9wdHMuY29udGVudFNlbCArICc6Zmlyc3Qgc2NyaXB0JzsgLy8gU2VsZWN0cyBjb250ZW50IHNjcmlwdHMKCiAgICAgIC8vIEZldGNoIGJvZHkgc2NyaXB0cyBub3QgaW4gdGhlIGNvbnRlbnQgKHdoaWNoIHdpbGwgYmUgcmVwbGFjZWQgYW55aG93KQogICAgICBpZiAoICRzY3JpcHRzLmxlbmd0aCApIHsKICAgICAgICAkc2NyaXB0cy5kZXRhY2goKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gZmFsc2U7IC8vIEVhcmx5IGV4aXQ7IHRoZXJlIGFyZSBubyBzY3JpcHRzIHRvIHdvcmsgd2l0aAogICAgICB9CgogICAgICAvLyBVcGRhdGUgdGhlIGJvZHkgc2NyaXB0cyBvdXRzaWRlIG9mIHRoZSBjb250ZW50IGFyZWE7IHdlJ3JlIGFzc3VtaW5nIHRoYXQgaGVhZGVyIHNjcmlwdHMgZG9uJ3QgY2hhbmdlCiAgICAgICRzY3JpcHRzLmVhY2goZnVuY3Rpb24oKXsKICAgICAgICB2YXIgJHRoaXMgPSAkKHRoaXMpOwoKICAgICAgICAvLyBJZiB0aGUgY3VycmVudCBzY3JpcHQgaXNuJ3QgZW1wdHkgd2UgYXNzdW1lIGl0IG11c3QgYmUgaW5saW5lCiAgICAgICAgaWYgKCAkdGhpcy5odG1sKCkgIT09ICcnICkgewoKICAgICAgICAgIC8vIFNhdmUgdGhlIGN1cnJlY3Qgc2NyaXB0IGNvbnRlbnRzIGZvciB1c2UgaW4gdGhlIGxvb3AgdG8gZm9sbG93CiAgICAgICAgICB2YXIKICAgICAgICAgICAgaW5saW5lU2NyaXB0ID0gJHRoaXMuaHRtbCgpLAogICAgICAgICAgICBpc05ldyAgICAgICAgPSB0cnVlOwoKICAgICAgICAgIC8vIENoZWNrIGV4aXN0aW5nIHNjcmlwdHMgdG8gc2VlIGlmIHRoZXkgY29udGFpbiB0aGUgc2FtZSBzdHVmZgogICAgICAgICAgJC5lYWNoKCAkYm9keS5maW5kKCdzY3JpcHQ6bm90KDplbXB0eSknKS5ub3QoY29udGVudFNjciksIGZ1bmN0aW9uKCl7CiAgICAgICAgICAgIGlmICggJHRoaXMuaHRtbCgpID09PSBpbmxpbmVTY3JpcHQgKSB7CiAgICAgICAgICAgICAgaXNOZXcgPSBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CgogICAgICAgICAgLy8gUGFzdGUgbmV3IHN0dWZmIGluIGlmIGl0IGlzbid0IGZvdW5kIGluIHRoZSBjdXJyZW50IERPTTsgdGhpcyBpcyBxdWl0ZSBhIGtsdWRnZQogICAgICAgICAgaWYgKCBpc05ldyA9PT0gdHJ1ZSApIHsKICAgICAgICAgICAgJGJvZHkuZmluZCgnc2NyaXB0Om5vdCg6ZW1wdHkpJykubm90KGNvbnRlbnRTY3IpLmZpbHRlcignOmZpcnN0JykuYmVmb3JlKCc8c2NyaXB0PicgKyAkdGhpcy5odG1sKCkgKyAnPC9zY3JpcHQ+Jyk7CiAgICAgICAgICB9CgogICAgICAgIC8vIEZldGNoIG5ldyBub24taW5saW5lIHNjcmlwdHMKICAgICAgICB9IGVsc2UgewoKICAgICAgICAgIC8vIFRlc3QgZm9yIHRoZSBwcmVzZW5jZSBvZiBlYWNoIHNjcmlwdDsgbm8gc2Vuc2UgaW4gcmVwZWF0aW5nIG91cnNlbHZlcyBoZXJlCiAgICAgICAgICBpZiAoICEkYm9keS5maW5kKCdzY3JpcHRbc3JjKj0iJyArICR0aGlzLmF0dHIoJ3NyYycpICsgJyJdJykubGVuZ3RoICkgewogICAgICAgICAgICAvLyAkLmdldFNjcmlwdCBkb2VzIG5vdCBjYWNoZSBzY3JpcHRzIGJ5IGRlZmF1bHQgc28gd2UnbGwgc2tpcCB0aGUgc2hvcnRjdXQgYW5kIGdvIHN0cmFpZ2h0IHRvIHRoZSBzb3VyY2UKICAgICAgICAgICAgJC5hamF4KHsKICAgICAgICAgICAgICB1cmw6ICR0aGlzLmF0dHIoJ3NyYycpLAogICAgICAgICAgICAgIGRhdGFUeXBlOiAic2NyaXB0IiwKICAgICAgICAgICAgICBjYWNoZTogdHJ1ZSwKICAgICAgICAgICAgICBjb21wbGV0ZTogZnVuY3Rpb24oKXsgLy8gSW4gY2FzZSBjYWNoaW5nIGlzbid0IHdvcmtpbmcuLi4gYWRkIHRoZSBzY3JpcHQgdG8gdGhlIERPTQogICAgICAgICAgICAgICAgdmFyIG5ld1NjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpOwogICAgICAgICAgICAgICAgbmV3U2NyaXB0LnNyYyA9ICR0aGlzLmF0dHIoJ3NyYycpOyAvLyBObyBuZWVkIGZvciB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiIGluIEhUTUw1CiAgICAgICAgICAgICAgICAkYm9keVswXS5hcHBlbmRDaGlsZChuZXdTY3JpcHQpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7IC8vIGVuZCAkLmFqYXgoKQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7IC8vIGVuZCAkc2NyaXB0cy5lYWNoKCkKICAgIH0sIC8vIGVuZCBzY3JpcHRzKCkKCgoKICAgIC8vIEVzY2FwZSBIVE1MIGVudGl0aWVzIGluIGEgc3RyaW5nCiAgICBzYW5pdGl6ZTogZnVuY3Rpb24oc3RyKXsKICAgICAgcmV0dXJuIFN0cmluZyhzdHIpLnJlcGxhY2UoL1smPD4iJ1wvIT1dL2csIGZ1bmN0aW9uKHMpewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAiJiI6ICImYW1wOyIsCiAgICAgICAgICAiPCI6ICImbHQ7IiwKICAgICAgICAgICI+IjogIiZndDsiLAogICAgICAgICAgJyInOiAiJnF1b3Q7IiwKICAgICAgICAgICInIjogIiZhcG9zOyIsCiAgICAgICAgICAiLyI6ICImIzA0NzsiLAogICAgICAgICAgIiEiOiAiJiMwMzM7IiwKICAgICAgICAgICI9IjogIiYjMDYxOyIKICAgICAgICB9W3NdOwogICAgICB9KTsKICAgIH0sIC8vIGVuZCBzYW5pdGl6ZSgpCgoKCiAgICAvLyBVcGRhdGUgc2Nyb2xsIHBvc2l0aW9uCiAgICBzY3JvbGw6IGZ1bmN0aW9uKCl7CiAgICAgIHZhcgogICAgICAgICRib2R5ICAgICAgID0gJCgnYm9keScpLAogICAgICAgIGhhc2ggICAgICAgID0gbG9jYXRpb24uaGFzaC5zdWJzdHJpbmcoMSksCiAgICAgICAgc2Nyb2xsRGVsYXkgPSB0aGlzLm9wdHMuc2Nyb2xsRGVsYXksCiAgICAgICAgdG9wICAgICAgICAgPSAkKHRoaXMub3B0cy5jb250ZW50U2VsKS5maWx0ZXIoJzpmaXJzdCcpLm9mZnNldCgpLnRvcDsKCiAgICAgIC8vIFRlc3QgZm9yIHRoZSBwcmVzZW5jZSBvZiBhIGhhc2ggaW4gdGhlIGxvY2F0aW9uCiAgICAgIGlmIChoYXNoICE9PSAnJykgewoKICAgICAgICAvLyBEZWZpbmUgdGhlIHNlbGVjdG9yCiAgICAgICAgdmFyICRoYXNoID0gJCgnW2lkPSInK2hhc2grJyJdJyk7CgogICAgICAgIC8vIFRlc3Qgd2hldGhlciB0aGUgc2VsZWN0b3IgZXhpc3RzOyBzY3JvbGwgdGhlcmUgaWYgZm91bmQgYW5kIGZhbGwgYmFjayBvbiByZWd1bGFyIHNjcm9sbCByb3V0aW5lIGlmIG5vdAogICAgICAgIGlmICggJGhhc2gubGVuZ3RoICkgewogICAgICAgICAgJGJvZHkuYW5pbWF0ZSh7IHNjcm9sbFRvcDogJGhhc2gub2Zmc2V0KCkudG9wIH0sIHNjcm9sbERlbGF5LCAic3dpbmciKTsKICAgICAgICAgIHJldHVybjsgLy8gRWFybHkgZXhpdCBmcm9tIGZ1bmN0aW9uOyB3ZSd2ZSBnb3Qgc29tZXRoaW5nIHRvIHNjcm9sbCB0byBhbmQgaXQncyBnb2luZyB0byBiZSBiZWxvdyB0aGUgZm9sZAogICAgICAgIH0KICAgICAgfQoKICAgICAgLy8gU2Nyb2xsIHRvIHRoZSB0b3Agb2YgdGhlIGNvbnRlbnQgY29udGFpbmVyIHdoZW4gYmVsb3cgdGhlIGZvbGQKICAgICAgaWYgKCAkKHdpbmRvdykuc2Nyb2xsVG9wKCkgPiB0b3AgKSB7CiAgICAgICAgJGJvZHkuYW5pbWF0ZSh7IHNjcm9sbFRvcDogdG9wIH0sIHNjcm9sbERlbGF5LCAic3dpbmciKTsKICAgICAgfQoKICAgIH0sIC8vIGVuZCBzY3JvbGwoKQoKCgogICAgLy8gVXBkYXRlIEdvb2dsZSBBbmFseXRpY3Mgb24gY29udGVudCBsb2FkCiAgICBhbmFseXRpY3M6IGZ1bmN0aW9uKHVybCl7CiAgICAgIHZhciByZWxhdGl2ZVVybCA9ICcvJyArIHVybC5yZXBsYWNlKHRoaXMucm9vdCgpLCAnJyk7IC8vIFNldCB0aGUgcmVsYXRpdmUgVVJMIHJlcXVpcmVkIGJ5IEdvb2dsZSBBbmFseXRpY3MKCiAgICAgIC8vIEluZm9ybSBHb29nbGUgQW5hbHl0aWNzIG9mIHRoZSBjaGFuZ2U7IGNvbXBhdGlibGUgd2l0aCB0aGUgbmV3IFVuaXZlcnNhbCBBbmFseXRpY3Mgc2NyaXB0CiAgICAgIGlmICggdHlwZW9mIHdpbmRvdy5nYSAhPT0gJ3VuZGVmaW5lZCcgKSB7CiAgICAgICAgd2luZG93LmdhKCdzZW5kJywgJ3BhZ2V2aWV3JywgcmVsYXRpdmVVcmwpOwogICAgICB9IGVsc2UgaWYgKCB0eXBlb2Ygd2luZG93Ll9nYXEgIT09ICd1bmRlZmluZWQnICkgewogICAgICAgIHdpbmRvdy5fZ2FxLnB1c2goWydfdHJhY2tQYWdldmlldycsIHJlbGF0aXZlVXJsXSk7IC8vIExlZ2FjeSBhbmFseXRpY3M7IHJlZjogaHR0cHM6Ly9naXRodWIuY29tL2Jyb3dzZXJzdGF0ZS9hamF4aWZ5L3B1bGwvMjUKICAgICAgfQogICAgfSwgLy8gZW5kIGFuYWx5dGljcygpCgoKCiAgICAvLyBEb2N1bWVudCBoZWxwZXI7IGJyb3dzZXJzIG9mdGVuIHN0cmlwIG91dCBodG1sLCBoZWFkLCBib2R5LCB0aXRsZSwgYmFzZSwgYW5kIG1ldGEgdGFncyB3aGVuIHVzaW5nIC5pbm5lckhUTUw7IHNlZSBodHRwczovL2FwaS5qcXVlcnkuY29tL2xvYWQvCiAgICAvLyBUaGlzIGZ1bmN0aW9uIGFsbG93cyBhY2Nlc3MgdG8gdGhlc2UgdGFncyBieSB0cmFuc2Zvcm1pbmcgdGhlbSB0byBkaXZzIHdpdGggaWRzIHRoYXQgbWF0Y2ggdGhlIG9yaWdpbmFsIGUuZy4gI2RvYy10aXRsZQogICAgLy8gU2VlIGFsc286IGh0dHBzOi8vZ2lzdC5naXRodWIuY29tL2Nvd2JveS83NDI5NTIvCiAgICBkb2NIZWxwOiBmdW5jdGlvbihodG1sKXsKICAgICAgdmFyCiAgICAgICAgcmVzdWx0ID0gU3RyaW5nKGh0bWwpCiAgICAgICAgICAucmVwbGFjZSgvPFwhRE9DVFlQRVtePl0qPi9pLCAnJykKICAgICAgICAgIC5yZXBsYWNlKC88KGh0bWx8aGVhZHxib2R5fHRpdGxlfGJhc2V8bWV0YSkoW1xzXD5dKS9naSwnPGRpdiBpZD0iZG9jLSQxIiQyJykKICAgICAgICAgIC5yZXBsYWNlKC88XC8oaHRtbHxoZWFkfGJvZHl8dGl0bGV8YmFzZXxtZXRhKVw+L2dpLCc8L2Rpdj4nKQogICAgICA7CiAgICAgIHJldHVybiAkLnRyaW0ocmVzdWx0KTsKICAgIH0sIC8vIGVuZCBkb2NIZWxwKCkKCgoKICAgIC8vIFV0aWxpdHkgZnVuY3Rpb24gdG8gZ2V0IHRoZSByb290IFVSTCB3aXRoIHRyYWlsaW5nIHNsYXNoIGUuZy4gaHR0cChzKTovL3lvdXJkb21haW4uY29tLwogICAgcm9vdDogZnVuY3Rpb24oKXsKICAgICAgdmFyCiAgICAgICAgcG9ydCA9IGRvY3VtZW50LmxvY2F0aW9uLnBvcnQgPyAnOicgKyBkb2N1bWVudC5sb2NhdGlvbi5wb3J0IDogJycsCiAgICAgICAgdXJsID0gZG9jdW1lbnQubG9jYXRpb24ucHJvdG9jb2wgKyAnLy8nICsgKGRvY3VtZW50LmxvY2F0aW9uLmhvc3RuYW1lIHx8IGRvY3VtZW50LmxvY2F0aW9uLmhvc3QpICsgcG9ydCArICcvJzsKICAgICAgcmV0dXJuIHVybDsKICAgIH0gLy8gZW5kIHJvb3QoKQoKICB9OyAvLyBlbmQgQWpheGluYXRlLnByb3RvdHlwZQoKCgogIC8vIEEgbGlnaHR3ZWlnaHQgcGx1Z2luIHdyYXBwZXIgYXJvdW5kIHRoZSBjb25zdHJ1Y3RvciBwcmV2ZW50aW5nIG11bHRpcGxlIGluc3RhbnRpYXRpb25zCiAgJC5mbi5hamF4aW5hdGUgPSBmdW5jdGlvbiAob3B0cyl7CiAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7CiAgICAgIGlmICghJC5kYXRhKHRoaXMsICdYTjhfYWpheGluYXRlJykpIHsKICAgICAgICAkLmRhdGEodGhpcywgJ1hOOF9hamF4aW5hdGUnLCBuZXcgQWpheGluYXRlKHRoaXMsIG9wdHMpKTsKICAgICAgfQogICAgfSk7CiAgfTsKCgoKICAvLyBFeHRlbnNpYmxlIGRlZmF1bHQgc2V0dGluZ3MKICAkLmZuLmFqYXhpbmF0ZS5kZWZhdWx0cyA9IHsKICAgIGNvbnRlbnRTZWw6ICAgICcjY29udGVudCcgLy8gVGhlIHNlbGVjdG9yIGZvciBhbGwgcGFnZSBjb250ZW50cwogICwgbWVudVNlbDogICAgICAgJyNtZW51JyAgICAvLyBUaGUgc2VsZWN0b3IgZm9yIHRoZSBlbnRpcmUgbWVudQogICwgb3V0RGVsYXk6ICAgICAgNjAwCiAgLCBvdXRPcGFjaXR5OiAgICAwLjIgICAgICAgIC8vIERpbW1pbmcgcmF0aGVyIHRoYW4gY29tcGxldGVseSBoaWRpbmcgY29udGVudAogICwgaW5EZWxheTogICAgICAgMTIwCiAgLCBzY3JvbGxEZWxheTogICAzMDAKICAsIHNwaW5GYWRlOiAgICAgIDMwMCAgICAgICAgLy8gU3Bpbm5lciBmYWRlIG91dCBkdXJhdGlvbgogICwgc3Bpbk9wdHM6IHsgICAgICAgICAgICAgICAvLyBzcGluLmpzIG9wdGlvbnM7IHJlZmVyZW5jZTogaHR0cHM6Ly9mZ25hc3MuZ2l0aHViLmlvL3NwaW4uanMvCiAgICAgIGxpbmVzOiAgMjUKICAgICwgbGVuZ3RoOiAwCiAgICAsIHdpZHRoOiAgNAogICAgLCByYWRpdXM6IDI1CiAgICAsIHNwZWVkOiAgMS41CiAgICAsIHRyYWlsOiAgNDAKICAgICwgdG9wOiAgICAnMjUlJwogIH0KCiAgLy8gV2hpdGVsaXN0ZWQgZXh0ZW5zaW9ucyAocmVnZXhwKTsgdGhlc2Ugd2lsbCBuZWdhdGUgdGhlIGN1c3RvbSAiaW50ZXJuYWwiIHNlbGVjdG9yCiAgLCBleGNlcHRpb25zOiAvXC4oanBnfGpwZWd8cG5nfGdpZnxibXB8cGRmfG1wM3xmbGFjfHdhdnxyYXJ8emlwKSQvaQoKICAvLyBBZGRpdGlvbmFsIHNlbGVjdG9ycyB0byBmaWx0ZXIgd2hlbiBiaW5kaW5nIGV2ZW50cyAoc3RyaW5nKTsgdXNlICI6bm90KHNlbGVjdG9yKSIsIGZvciBleGFtcGxlLCB0byBza2lwIGNlcnRhaW4gc2VsZWN0b3JzIGUuZy4gYDpub3QoW2hyZWYqPSJ0ZXN0Il0pYCBldGMuCiAgLCBmaWx0ZXJzOiAnJwogIH07Cgp9KS5hcHBseShYTjgsIFtqUXVlcnksIHdpbmRvdywgZG9jdW1lbnRdKTsK",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Thu, 06 Nov 2014 06:44:24 GMT",
                    "Content-Length": "15015",
                    "Date": "Thu, 06 Nov 2014 06:44:24 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}