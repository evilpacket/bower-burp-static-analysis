{
    "url": "http://localhost:9999/docluv/spa/js/dev/spa.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Open redirection (DOM-based)",
    "issueType": 5243152,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based open redirection vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the target of a redirection in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause a redirection to an arbitrary external domain. This behavior can be leveraged to facilitate phishing attacks against users of the application. The ability to use an authentic application URL, targeting the correct domain with a valid SSL certificate (if SSL is used) lends credibility to the phishing attack because many users, even if they verify these features, will not notice the subsequent redirection to a different domain.<br><br><b>Note:</b> If an attacker is able to control the start of the string that is passed to the redirection API, then it may be possible to escalate this vulnerability into a JavaScript injection attack, by using a URL with the javascript: pseudo-protocol to execute arbitrary script code when the URL is processed by the browser.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based open redirection vulnerabilities is not to dynamically set redirection targets using data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing an arbitrary URL as a redirection target. In general, this is best achieved by using a whitelist of URLs that are permitted redirection targets, and strictly validating the target against this list before performing the redirection.",
    "issueDetail": "The application may be vulnerable to DOM-based open redirection. Data is read from <b>window.location.href</b> and written to <b>window.location.replace()</b> via the following statements:<ul><li>loc = window.location.href.split(\"#!\");</li><li>window.location.replace(loc[0] + \"?\" +                         this.settings.forceReload + \"=\" + loc[1]);</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/docluv/spa/js/dev/spa.js",
                "path": "/docluv/spa/js/dev/spa.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9kb2NsdXYvc3BhL2pzL2Rldi9zcGEuanMgSFRUUC8xLjENCkhvc3Q6IGxvY2FsaG9zdDo5OTk5DQoNCg==",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMjE0MjcNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IFNhdCwgMDggTm92IDIwMTQgMDU6MTY6MzcgR01UDQpMYXN0LU1vZGlmaWVkOiBTYXQsIDA4IE5vdiAyMDE0IDA1OjE2OjM2IEdNVA0KDQovLy8gPHJlZmVyZW5jZSBwYXRoPSJiYWNrYWNrLmpzIiAvPgovLy8gPHJlZmVyZW5jZSBwYXRoPSJoZWxwZXIuZXh0ZW5zaW9ucy5qcyIgLz4KOwoKKGZ1bmN0aW9uICh3aW5kb3csIHVuZGVmaW5lZCkgewoKICAgICJ1c2Ugc3RyaWN0IjsKCi8vICAgIHZhciBfZ2FxID0gX2dhcSB8fCB1bmRlZmluZWQ7CgogICAgLy8gRGVmaW5lIGEgbG9jYWwgY29weSBvZiBkZWZlcnJlZAogICAgdmFyIFNQQSA9IGZ1bmN0aW9uIChjdXN0b21TZXR0aW5ncykgewoKICAgICAgICB2YXIgc3BhID0gbmV3IFNQQS5mbi5pbml0KCksCiAgICAgICAgICAgIGFwcE5hbWUgPSAiIjsKCiAgICAgICAgc3BhLnNldHRpbmdzID0gJC5leHRlbmQoe30sIHNwYS5zZXR0aW5ncywgY3VzdG9tU2V0dGluZ3MpOwoKICAgICAgICBpZiAoc3BhLnNldHRpbmdzLkFwcENvbnRleHQpIHsKICAgICAgICAgICAgc3BhLiRjb250ZXh0ID0gc3BhLnNldHRpbmdzLkFwcENvbnRleHQ7CiAgICAgICAgfSBlbHNlIHsKCiAgICAgICAgICAgIHZhciBzcGFBcHAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbc3BhLWFwcF0iKTsKCiAgICAgICAgICAgIGlmIChzcGFBcHApIHsKCiAgICAgICAgICAgICAgICBhcHBOYW1lID0gd2luZG93W3NwYUFwcC5nZXRBdHRyaWJ1dGUoInNwYS1hcHAiKV07CgogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBhcHBOYW1lID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICAgICAgICAgICAgYXBwTmFtZSA9IGFwcE5hbWUoKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBzcGEuJGNvbnRleHQgPSBhcHBOYW1lOwoKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIk11c3QgaGF2ZSBhbiBhcHBsaWNhdGlvbiBjb250ZXh0IGRlZmluZWQiKTsKCiAgICAgICAgICAgICAgICB0aHJvdyB7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogIlNQQSBFcnJvciIsCiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogIk11c3QgaGF2ZSBhbiBhcHBsaWNhdGlvbiBjb250ZXh0IGRlZmluZWQiCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CgogICAgICAgIH0KCiAgICAgICAgc3BhLnZpZXdDYWNoZSA9IHNwYS5zZXR0aW5ncy52aWV3Q2FjaGUgfHwgQmFja3BhY2soKTsKCiAgICAgICAgc3BhLmFuYWx5dGljcyA9IHNwYS5zZXR0aW5ncy5hbmFseXRpY3M7CgogICAgICAgIHNwYS50aXRsZUVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHNwYS5zZXR0aW5ncy50aXRsZVNlbGVjdG9yKTsKCiAgICAgICAgaWYgKHNwYS5zZXR0aW5ncy5wYXJzZURPTSkgewoKICAgICAgICAgICAgc3BhLnNldHVwUm91dGVzKHNwYS5zZXR0aW5ncy52aWV3U2VsZWN0b3IpOwoKICAgICAgICB9CgogICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJoYXNoY2hhbmdlIiwgZnVuY3Rpb24gKCkgewoKICAgICAgICAgICAgc3BhLnN3YXBWaWV3KCk7CgogICAgICAgIH0pOwoKICAgICAgICBpZiAoc3BhLmdldFBhcmFtZXRlckJ5TmFtZShzcGEuc2V0dGluZ3MuZm9yY2VSZWxvYWQpKSB7CgogICAgICAgICAgICB3aW5kb3cubG9jYXRpb24ucmVwbGFjZSh3aW5kb3cubG9jYXRpb24uaHJlZi5zcGxpdCgiPyIpWzBdICsgIiMhIiArCiAgICAgICAgICAgICAgICBzcGEuZ2V0UGFyYW1ldGVyQnlOYW1lKHNwYS5zZXR0aW5ncy5mb3JjZVJlbG9hZCkpOwogICAgICAgICAgICByZXR1cm4gc3BhOwoKICAgICAgICB9IGVsc2UgaWYgKHNwYS5zZXR0aW5ncy5pbml0VmlldykgewogICAgICAgICAgICBzcGEuc3dhcFZpZXcoKTsKICAgICAgICB9CgogICAgICAgIC8qCgogICAgICAgIC8vZGVjaWRlZCB0byBzaGVsdmUgdGhpcyBmb3IgdGhlIHRpbWUgYmVpbmcuIFdpbGwgY29tcGxldGUgdGhpcyBmdW5jdGlvbmFsaXR5CiAgICAgICAgLy9hZnRlciB0aGUgYm9vayBpcyBwdWJsaXNoZWQKCiAgICAgICAgaWYgKHNwYS5zZXR0aW5ncy5hc3luY1VybCAmJiB0eXBlb2Ygc3BhLnNldHRpbmdzLmFzeW5jVXJsID09PSAic3RyaW5nIikgewoKICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiRE9NQ29udGVudExvYWRlZCIsIGZ1bmN0aW9uICgpIHsKCiAgICAgICAgICAgICAgICBlLnRhcmdldC5yZW1vdmVFdmVudExpc3RlbmVyKGUudHlwZSwgYXJndW1lbnRzLmNhbGxlZSk7CgogICAgICAgICAgICAgICAgc3BhLmxvYWRBc3luY0NvbnRlbnQuY2FsbChzcGEsIHNwYS5zZXR0aW5ncy5hc3luY1VybCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgKi8KCiAgICAgICAgcmV0dXJuIHNwYTsKCiAgICB9OwoKICAgIFNQQS5mbiA9IFNQQS5wcm90b3R5cGUgPSB7CgogICAgICAgIGNvbnN0cnVjdG9yOiBTUEEsCgogICAgICAgIGluaXQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfSwKCiAgICAgICAgdmVyc2lvbjogIjAuMC42IiwKCiAgICAgICAgdmlld0NhY2hlOiB1bmRlZmluZWQsCgoKICAgICAgICAvL2JhcnJvd2luZyBuYW1pbmcgY29udmVudGlvbnMgZnJvbSBBbmd1bGFyCiAgICAgICAgLy9UaGlzIGlzIGxpa2UgcmVuYW1pbmcgYSBicmFuZCB3aXRoIGEgYmFkIHJlcHV0YXRpb24sCiAgICAgICAgLy9tYWludGFpbmluZyBhbmQgdXNpbmcgdGhlIGNvbnRleHQgKHRoaXMpIHByb3Blcmx5CiAgICAgICAgLy9pcyBjb25mdXNpbmcgZm9yIG1hbnkgZGV2ZWxvcGVycyBuZXcgdG8gSmF2YVNjcmlwdC4KICAgICAgICAvL0NoYW5naW5nIHRoZSBuYW1lIGFic3RyYWN0cyB0aGUgbWluZCBmcm9tIGFzc29jaWF0aW5nCiAgICAgICAgLy90aGUgbmFtZSB0byBzb21ldGhpbmcgdGhleSBwZXJjZWl2ZSBhcyBhbm5veWluZy4KICAgICAgICAkY29udGV4dDogdW5kZWZpbmVkLAogICAgICAgICRjb250cm9sbGVyOiB1bmRlZmluZWQsCiAgICAgICAgJG9sZENvbnRyb2xsZXI6IHVuZGVmaW5lZCwKCiAgICAgICAgc2V0dXBSb3V0ZXM6IGZ1bmN0aW9uICgpIHsKCiAgICAgICAgICAgIHZhciBzcGEgPSB0aGlzLAogICAgICAgICAgICAgICAgc2V0dGluZ3MgPSBzcGEuc2V0dGluZ3MsCiAgICAgICAgICAgICAgICByb3V0ZXMgPSAkLmV4dGVuZCgkLnBhcnNlTG9jYWxTdG9yYWdlKCJyb3V0ZXMiKSB8fCB7fSwgc2V0dGluZ3Mucm91dGVzKSwKICAgICAgICAgICAgICAgIGkgPSAwLAogICAgICAgICAgICAgICAgcmF3UGF0aCwgdmlldywgcm91dGUsIHZpZXdJZCwKICAgICAgICAgICAgICAgIFZpZXdzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChzZXR0aW5ncy52aWV3U2VsZWN0b3IpOwoKICAgICAgICAgICAgZm9yICg7IGkgPCBWaWV3cy5sZW5ndGg7IGkrKykgewoKICAgICAgICAgICAgICAgIHZpZXcgPSBWaWV3c1tpXTsKCiAgICAgICAgICAgICAgICBpZiAodmlldy5oYXNBdHRyaWJ1dGVzKCkgJiYgdmlldy5oYXNBdHRyaWJ1dGUoImlkIikpIHsKCiAgICAgICAgICAgICAgICAgICAgdmlld0lkID0gdmlldy5nZXRBdHRyaWJ1dGUoImlkIik7CiAgICAgICAgICAgICAgICAgICAgcmF3UGF0aCA9ICh2aWV3Lmhhc0F0dHJpYnV0ZSgic3BhLXJvdXRlIikgPyB2aWV3LmdldEF0dHJpYnV0ZSgic3BhLXJvdXRlIikgOiAiIik7CgogICAgICAgICAgICAgICAgICAgIHJvdXRlID0gc3BhLmNyZWF0ZVJvdXRlKHZpZXdJZCwgcmF3UGF0aCwgdmlldyk7CiAgICAgICAgICAgICAgICAgICAgcm91dGVzW3JvdXRlLnBhdGhdID0gcm91dGU7CgogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgfQoKICAgICAgICAgICAgc3BhLnNldHRpbmdzLnJvdXRlcyA9IHJvdXRlczsKCiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCJyb3V0ZXMiLCBKU09OLnN0cmluZ2lmeShyb3V0ZXMpKTsKCiAgICAgICAgICAgIGlmIChzcGEudmlld0NhY2hlICYmIChzcGEuZ2V0UGFyYW1ldGVyQnlOYW1lKCJfZXNjYXBlZF9mcmFnbWVudF8iKSA9PT0gIiIpKSB7CiAgICAgICAgICAgICAgICBzcGEudmlld0NhY2hlLnVwZGF0ZVZpZXdzKHNldHRpbmdzLnZpZXdTZWxlY3Rvcik7CiAgICAgICAgICAgIH0KCiAgICAgICAgfSwKCiAgICAgICAgY3JlYXRlUm91dGU6IGZ1bmN0aW9uICh2aWV3SWQsIHJhd1BhdGgsIHZpZXcpIHsKCiAgICAgICAgICAgIC8vbmVlZCB0byBjaGVjayBmb3IgZHVwbGljYXRlIHBhdGgKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIHZpZXdJZDogdmlld0lkLAogICAgICAgICAgICAgICAgdmlld01vZHVsZTogKHZpZXcuaGFzQXR0cmlidXRlKCJzcGEtbW9kdWxlIikgPyB2aWV3LmdldEF0dHJpYnV0ZSgic3BhLXZpZXdJZCIpIDoKICAgICAgICAgICAgICAgICAgICB2aWV3SWQpLAogICAgICAgICAgICAgICAgcGF0aDogcmF3UGF0aC5zcGxpdCgiXFw6IilbMF0sCiAgICAgICAgICAgICAgICBwYXJhbXM6IHJhd1BhdGguc3BsaXQoIlxcOiIpLnNsaWNlKDEpLAogICAgICAgICAgICAgICAgdGl0bGU6ICh2aWV3Lmhhc0F0dHJpYnV0ZSgic3BhLXRpdGxlIikgPyB2aWV3LmdldEF0dHJpYnV0ZSgic3BhLXRpdGxlIikgOgogICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0dGluZ3MuZGVmYXVsdFRpdGxlKSwKICAgICAgICAgICAgICAgIHRyYW5zaXRpb246ICh2aWV3Lmhhc0F0dHJpYnV0ZSgic3BhLXRyYW5zaXRpb24iKSA/CiAgICAgICAgICAgICAgICAgICAgdmlldy5nZXRBdHRyaWJ1dGUoInNwYS10cmFuc2l0aW9uIikgOgogICAgICAgICAgICAgICAgICAgICIiKSwKICAgICAgICAgICAgICAgIHBhcmFtVmFsdWVzOiB7fSwKICAgICAgICAgICAgICAgIGJlZm9yZW9ubG9hZDogKHZpZXcuaGFzQXR0cmlidXRlKCJzcGEtYmVmb3Jlb25sb2FkIikgPyB2aWV3LmdldEF0dHJpYnV0ZSgic3BhLWJlZm9yZW9ubG9hZCIpIDogdW5kZWZpbmVkKSwKICAgICAgICAgICAgICAgIG9ubG9hZDogKHZpZXcuaGFzQXR0cmlidXRlKCJzcGEtb25sb2FkIikgPyB2aWV3LmdldEF0dHJpYnV0ZSgic3BhLW9ubG9hZCIpIDogdW5kZWZpbmVkKSwKICAgICAgICAgICAgICAgIGFmdGVyb25sb2FkOiAodmlldy5oYXNBdHRyaWJ1dGUoInNwYS1hZnRlcm9ubG9hZCIpID8gdmlldy5nZXRBdHRyaWJ1dGUoInNwYS1hZnRlcm9ubG9hZCIpIDogdW5kZWZpbmVkKSwKICAgICAgICAgICAgICAgIGJlZm9yZXVubG9hZDogKHZpZXcuaGFzQXR0cmlidXRlKCJzcGEtYmVmb3JldW5sb2FkIikgPyB2aWV3LmdldEF0dHJpYnV0ZSgic3BhLWJlZm9yZXVubG9hZCIpIDogdW5kZWZpbmVkKSwKICAgICAgICAgICAgICAgIHVubG9hZDogKHZpZXcuaGFzQXR0cmlidXRlKCJzcGEtdW5sb2FkIikgPyB2aWV3LmdldEF0dHJpYnV0ZSgic3BhLXVubG9hZCIpIDogdW5kZWZpbmVkKSwKICAgICAgICAgICAgICAgIGFmdGVydW5sb2FkOiAodmlldy5oYXNBdHRyaWJ1dGUoInNwYS1hZnRlcnVubG9hZCIpID8gdmlldy5nZXRBdHRyaWJ1dGUoInNwYS1hZnRlcnVubG9hZCIpIDogdW5kZWZpbmVkKQogICAgICAgICAgICB9OwoKICAgICAgICB9LAoKICAgICAgICBtYXRjaFJvdXRlQnlQYXRoOiBmdW5jdGlvbiAocGF0aCwgcm91dGVzKSB7CgogICAgICAgICAgICBpZiAoIXJvdXRlcykgewogICAgICAgICAgICAgICAgcm91dGVzID0gdGhpcy5zZXR0aW5ncy5yb3V0ZXM7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBrZXksIHJvdXRlLCBwYXJhbXMsIGksCiAgICAgICAgICAgICAgICBwYXJhbVZhbHVlcyA9IHt9LAogICAgICAgICAgICAgICAgc2VhcmNoOwoKICAgICAgICAgICAgLy9yb3V0ZXMgaXMgYW4gb2JqZWN0IHNvIHdlIGNhbiBtYXRjaCB0aGUgcGF0aCB0byB0aGUgcm91dGUgYXMgaXQgd2lsbCBiZSBhIHByb3BlcnR5IG5hbWUuCiAgICAgICAgICAgIGlmIChyb3V0ZXMuaGFzT3duUHJvcGVydHkocGF0aCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiByb3V0ZXNbcGF0aF07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZvciAoa2V5IGluIHJvdXRlcykgewoKICAgICAgICAgICAgICAgIGlmIChyb3V0ZXMuaGFzT3duUHJvcGVydHkoa2V5KSkgewoKICAgICAgICAgICAgICAgICAgICByb3V0ZSA9IHJvdXRlc1trZXldOwoKICAgICAgICAgICAgICAgICAgICBzZWFyY2ggPSBuZXcgUmVnRXhwKCdcXGInICsgcm91dGUucGF0aCArICdcXGInLCAnZ2knKTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKHJvdXRlLnBhdGggIT09ICIiICYmCiAgICAgICAgICAgICAgICAgICAgICAgIHBhdGguc2VhcmNoKHNlYXJjaCkgPT09IDApIHsKCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtcyA9IHBhdGgucmVwbGFjZShyb3V0ZS5wYXRoLCAiIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zcGxpdCgiLyIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc2xpY2UoMSk7IC8vdGhlIGZpcnN0IGl0ZW0gd2lsbCBiZSBlbXB0eQoKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHBhcmFtcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1WYWx1ZXNbcm91dGUucGFyYW1zW2ldXSA9IHBhcmFtc1tpXTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgcm91dGUucGFyYW1WYWx1ZXMgPSBwYXJhbVZhbHVlczsKCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJvdXRlID0gdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gcm91dGU7CiAgICAgICAgfSwKCiAgICAgICAgbWF0Y2hSb3V0ZUJ5SWQ6IGZ1bmN0aW9uIChpZCwgcm91dGVzKSB7CgogICAgICAgICAgICBpZiAoIXJvdXRlcykgewogICAgICAgICAgICAgICAgcm91dGVzID0gdGhpcy5zZXR0aW5ncy5yb3V0ZXM7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciByb3V0ZTsKCiAgICAgICAgICAgIGZvciAocm91dGUgaW4gcm91dGVzKSB7CiAgICAgICAgICAgICAgICBpZiAocm91dGVzW3JvdXRlXS52aWV3SWQgPT09IGlkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJvdXRlc1tyb3V0ZV07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgfSwKCiAgICAgICAgLy8gIG5ld1ZpZXc6IHVuZGVmaW5lZCwgLy9wbGFjZWhvbGRlciBmb3IgbmV3IHZpZXcKICAgICAgICAvLyAgY3VycmVudFZpZXc6IHVuZGVmaW5lZCwgLy9wbGFjZWhvbGRlciBmb3IgY3VycmVudCB2aWV3IGJlZm9yZSBhIHN3YXAKICAgICAgICBhbmltYXRpb246IHVuZGVmaW5lZCwKCiAgICAgICAgZ2V0UGFyYW1ldGVyQnlOYW1lOiBmdW5jdGlvbiAobmFtZSkgewoKICAgICAgICAgICAgbmFtZSA9IG5hbWUucmVwbGFjZSgvW1xbXS8sICJcXFxbIikucmVwbGFjZSgvW1xdXS8sICJcXFxdIik7CgogICAgICAgICAgICB2YXIgcmVnZXggPSBuZXcgUmVnRXhwKCJbXFw/Jl0iICsgbmFtZSArICI9KFteJiNdKikiKSwKICAgICAgICAgICAgICAgIHJlc3VsdHMgPSByZWdleC5leGVjKGxvY2F0aW9uLnNlYXJjaCk7CgogICAgICAgICAgICByZXR1cm4gcmVzdWx0cyA9PT0gbnVsbCA/ICIiIDogZGVjb2RlVVJJQ29tcG9uZW50KHJlc3VsdHNbMV0ucmVwbGFjZSgvXCsvZywgIiAiKSk7CiAgICAgICAgfSwKCiAgICAgICAgZ2V0VmVuZG9yUHJvcGVydHlOYW1lOiBmdW5jdGlvbiAocHJvcCkgewoKICAgICAgICAgICAgdmFyIHByZWZpeGVzID0gWydNb3onLCAnV2Via2l0JywgJ08nLCAnbXMnXSwKICAgICAgICAgICAgICAgIHZlbmRvclByb3AsIGksCiAgICAgICAgICAgICAgICBwcm9wXyA9IHByb3AuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBwcm9wLnN1YnN0cigxKTsKCiAgICAgICAgICAgIGlmIChwcm9wIGluIHRoaXMuZGl2LnN0eWxlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcHJvcDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHByZWZpeGVzLmxlbmd0aDsgKytpKSB7CgogICAgICAgICAgICAgICAgdmVuZG9yUHJvcCA9IHByZWZpeGVzW2ldICsgcHJvcF87CgogICAgICAgICAgICAgICAgaWYgKHZlbmRvclByb3AgaW4gdGhpcy5kaXYuc3R5bGUpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmVuZG9yUHJvcDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIH0KICAgICAgICB9LAoKICAgICAgICB0cmFuc2l0aW9uZW5kOiB7CiAgICAgICAgICAgICdhbmltYXRpb24nOiAnYW5pbWF0aW9uZW5kJywKICAgICAgICAgICAgJ3dlYmtpdEFuaW1hdGlvbic6ICd3ZWJraXRBbmltYXRpb25FbmQnLAogICAgICAgICAgICAnTW96QW5pbWF0aW9uJzogJ2FuaW1hdGlvbmVuZCcsCiAgICAgICAgICAgICdPQW5pbWF0aW9uJzogJ29BbmltYXRpb25FbmQnCiAgICAgICAgfSwKCiAgICAgICAgLy8gcmVwdXJwb3NlZCBoZWxwZXIKICAgICAgICBjc3NQcmVmaXg6IGZ1bmN0aW9uIChzdWZmaXgpIHsKCiAgICAgICAgICAgIGlmICghc3VmZml4KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJyc7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBpLCBsZW4sIHBhcnRzLCBwcmVmaXhlcywKICAgICAgICAgICAgICAgIGJvZHlTdHlsZSA9IGRvY3VtZW50LmJvZHkuc3R5bGU7CgogICAgICAgICAgICBpZiAoc3VmZml4LmluZGV4T2YoJy0nKSA+PSAwKSB7CgogICAgICAgICAgICAgICAgcGFydHMgPSAoJycgKyBzdWZmaXgpLnNwbGl0KCctJyk7CgogICAgICAgICAgICAgICAgZm9yIChpID0gMSwgbGVuID0gcGFydHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBwYXJ0c1tpXSA9IHBhcnRzW2ldLnN1YnN0cigwLCAxKS50b1VwcGVyQ2FzZSgpICsgcGFydHNbaV0uc3Vic3RyKDEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc3VmZml4ID0gcGFydHMuam9pbignJyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChzdWZmaXggaW4gYm9keVN0eWxlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc3VmZml4OwogICAgICAgICAgICB9CgogICAgICAgICAgICBzdWZmaXggPSBzdWZmaXguc3Vic3RyKDAsIDEpLnRvVXBwZXJDYXNlKCkgKyBzdWZmaXguc3Vic3RyKDEpOwoKICAgICAgICAgICAgcHJlZml4ZXMgPSBbJ3dlYmtpdCcsICdNb3onLCAnbXMnLCAnTyddOwoKICAgICAgICAgICAgZm9yIChpID0gMCwgbGVuID0gcHJlZml4ZXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChwcmVmaXhlc1tpXSArIHN1ZmZpeCBpbiBib2R5U3R5bGUpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcHJlZml4ZXNbaV0gKyBzdWZmaXg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiAiIjsKICAgICAgICB9LAoKICAgICAgICByZW1vdmVFeHRyYVZpZXdzOiBmdW5jdGlvbiAoY3VycmVudFZpZXcpIHsKCiAgICAgICAgICAgIHZhciBsZW5ndGggPSBjdXJyZW50Vmlldy5sZW5ndGg7CgogICAgICAgICAgICB3aGlsZSAobGVuZ3RoID4gMSkgewoKICAgICAgICAgICAgICAgIGxlbmd0aC0tOwogICAgICAgICAgICAgICAgY3VycmVudFZpZXdbbGVuZ3RoXQogICAgICAgICAgICAgICAgICAgIC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGN1cnJlbnRWaWV3W2xlbmd0aF0pOwogICAgICAgICAgICB9CiAgICAgICAgfSwKCiAgICAgICAgcHVzaFZpZXc6IGZ1bmN0aW9uIChwYXRoKSB7CgogICAgICAgICAgICB2YXIgc3BhID0gdGhpczsKCiAgICAgICAgICAgIGlmIChzcGEuYW5hbHl0aWNzKSB7CiAgICAgICAgICAgICAgICBzcGEuYW5hbHl0aWNzLnB1c2hWaWV3KFsnX3RyYWNrUGFnZXZpZXcnLCBwYXRoXSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgfSwKCiAgICAgICAgc3dhcFZpZXc6IGZ1bmN0aW9uICgpIHsKCiAgICAgICAgICAgIHZhciBzcGEgPSB0aGlzLAogICAgICAgICAgICAgICAgc2V0dGluZ3MgPSBzcGEuc2V0dGluZ3MsCiAgICAgICAgICAgICAgICByb3V0ZSwgb2xkUm91dGUsIGFuaW0sCiAgICAgICAgICAgICAgICBoYXNoID0gd2luZG93LmxvY2F0aW9uLmhhc2gsCiAgICAgICAgICAgICAgICBuZXdWaWV3LAogICAgICAgICAgICAgICAgaGFzRXNjYXBlRnJhZ21lbnQgPSBzcGEuZ2V0UGFyYW1ldGVyQnlOYW1lKCJfZXNjYXBlZF9mcmFnbWVudF8iKSwKICAgICAgICAgICAgICAgIGhhc2hGcmFnbWVudCA9IChoYXNoICE9PSAiIyIpID8gaGFzaC5yZXBsYWNlKCIjISIsICIiKSA6ICIiLAogICAgICAgICAgICAgICAgcGF0aCA9IGhhc2hGcmFnbWVudC5zcGxpdCgiOiIpWzBdLAogICAgICAgICAgICAgICAgY3VycmVudFZpZXcgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCIuIiArIHNldHRpbmdzLmN1cnJlbnRDbGFzcyk7CgogICAgICAgICAgICBzcGEuJG9sZENvbnRyb2xsZXIgPSBzcGEuJGNvbnRyb2xsZXI7CgogICAgICAgICAgICBpZiAoY3VycmVudFZpZXcubGVuZ3RoICYmIGN1cnJlbnRWaWV3Lmxlbmd0aCA+IDEpIHsKICAgICAgICAgICAgICAgIC8vYWRkaW5nIHRoaXMgYmVjYXVzZSBJIGZvdW5kIG15c2VsZiBzb21ldGltZXMgdGFwcGluZyBpdGVtcyB0byBsYXVuY2ggYSBuZXcgdmlldyBiZWZvcmUgdGhlIGFuaW1hdGlvbiB3YXMgY29tcGxldGUuCiAgICAgICAgICAgICAgICBzcGEucmVtb3ZlRXh0cmFWaWV3cyhjdXJyZW50Vmlldyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vY29udmVydCBub2RlbGlzdCB0byBhIHNpbmdsZSBub2RlCiAgICAgICAgICAgIGN1cnJlbnRWaWV3ID0gY3VycmVudFZpZXdbMF07CgogICAgICAgICAgICBpZiAoY3VycmVudFZpZXcgJiYgY3VycmVudFZpZXcuaWQpIHsKICAgICAgICAgICAgICAgIG9sZFJvdXRlID0gc3BhLm1hdGNoUm91dGVCeUlkKGN1cnJlbnRWaWV3LmlkKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcm91dGUgPSBzcGEubWF0Y2hSb3V0ZUJ5UGF0aChwYXRoKTsKCiAgICAgICAgICAgIGlmIChyb3V0ZSAhPT0gdW5kZWZpbmVkKSB7CgogICAgICAgICAgICAgICAgaWYgKHNwYS4kY29udGV4dFtyb3V0ZS52aWV3SWRdICYmCiAgICAgICAgICAgICAgICAgICAgdHlwZW9mIHNwYS4kY29udGV4dFtyb3V0ZS52aWV3SWRdID09PSAiZnVuY3Rpb24iKSB7CgogICAgICAgICAgICAgICAgICAgIHNwYS4kY29udHJvbGxlciA9IG5ldyBzcGEuJGNvbnRleHRbcm91dGUudmlld0lkXShzcGEuJGNvbnRleHQpOwoKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc3BhLiRjb250ZXh0W3JvdXRlLnZpZXdJZF0gJiYKICAgICAgICAgICAgICAgICAgICB0eXBlb2Ygc3BhLiRjb250ZXh0W3JvdXRlLnZpZXdJZF0gPT09ICJvYmplY3QiKSB7CgogICAgICAgICAgICAgICAgICAgIHNwYS4kY29udHJvbGxlciA9IG5ldyBzcGEuJGNvbnRleHRbcm91dGUudmlld0lkXTsKCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBzcGEucHVzaFZpZXcocGF0aCk7CgogICAgICAgICAgICAgICAgc3BhLmVuc3VyZVZpZXdBdmFpbGFibGUoY3VycmVudFZpZXcsIHJvdXRlLnZpZXdJZCk7CgogICAgICAgICAgICAgICAgbmV3VmlldyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHJvdXRlLnZpZXdJZCk7CgogICAgICAgICAgICAgICAgaWYgKG5ld1ZpZXcpIHsKCiAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRWaWV3KSB7CgogICAgICAgICAgICAgICAgICAgICAgICAvL3NwYS5tYWtlVmlld0NhbGxiYWNrKG9sZFJvdXRlLCAiYmVmb3JldW5sb2FkIik7CgogICAgICAgICAgICAgICAgICAgICAgICBzcGEubWFrZVZpZXdDYWxsYmFjazEoc3BhLiRvbGRDb250cm9sbGVyLCAiYmVmb3JldW5sb2FkIik7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3BhLmhhc0FuaW1hdGlvbnMoKSkgewoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuaW0gPSBzcGEuZ2V0QW5pbWF0aW9uKHJvdXRlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwYS5hbmltYXRpb24gPSBhbmltOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhbmltKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRWaWV3LmFkZEV2ZW50TGlzdGVuZXIoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwYS50cmFuc2l0aW9uZW5kW3NwYS5jc3NQcmVmaXgoImFuaW1hdGlvbiIpXSwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwYS5lbmRTd2FwQW5pbWF0aW9uLmNhbGwoc3BhLCBvbGRSb3V0ZSwgcm91dGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFZpZXcgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL21vZGlmeSBvbmNlIGFkZENsYXNzIHN1cHBvcnRzIGFycmF5IG9mIGNsYXNzZXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKGN1cnJlbnRWaWV3KS5hZGRDbGFzcygiYW5pbWF0ZWQgb3V0ICIgKyBhbmltKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoImluIik7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQobmV3VmlldykuYWRkQ2xhc3Moc2V0dGluZ3MuY3VycmVudENsYXNzICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIiBhbmltYXRlZCAiICsgYW5pbSArICIgaW4iKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKG5ld1ZpZXcpLmFkZENsYXNzKHNldHRpbmdzLmN1cnJlbnRDbGFzcyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3BhLmVuZFN3YXBBbmltYXRpb24uY2FsbChzcGEsIG9sZFJvdXRlLCByb3V0ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2V0dGluZ3MuaW50b0FuaW1hdGlvbikgewoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld1ZpZXcuYWRkRXZlbnRMaXN0ZW5lcigKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcGEudHJhbnNpdGlvbmVuZFtzcGEuY3NzUHJlZml4KCJhbmltYXRpb24iKV0sIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwYS5lbmRTd2FwQW5pbWF0aW9uLmNhbGwoc3BhLCBvbGRSb3V0ZSwgcm91dGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50VmlldyA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKG5ld1ZpZXcpLmFkZENsYXNzKHNldHRpbmdzLmN1cnJlbnRDbGFzcyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIiBhbmltYXRlZCAiICsgYW5pbSArICIgaW4iKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJChuZXdWaWV3KS5hZGRDbGFzcyhzZXR0aW5ncy5jdXJyZW50Q2xhc3MpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3BhLmVuZFN3YXBBbmltYXRpb24uY2FsbChzcGEsIG9sZFJvdXRlLCByb3V0ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBzcGEuc2V0RG9jdW1lbnRUaXRsZShyb3V0ZSk7CgogICAgICAgICAgICAgICAgICAgIGlmIChyb3V0ZSkgewoKICAgICAgICAgICAgICAgICAgICAgICAgLy9zcGEubWFrZVZpZXdDYWxsYmFjayhyb3V0ZSwgImJlZm9yZW9ubG9hZCIpOwogICAgICAgICAgICAgICAgICAgICAgICAvL3NwYS5tYWtlVmlld0NhbGxiYWNrKHJvdXRlLCAib25sb2FkIik7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vc3BhLm1ha2VWaWV3Q2FsbGJhY2socm91dGUsICJhZnRlcm9ubG9hZCIpOwoKICAgICAgICAgICAgICAgICAgICAgICAgc3BhLm1ha2VWaWV3Q2FsbGJhY2sxKHNwYS4kY29udHJvbGxlciwgImJlZm9yZW9ubG9hZCIsIHJvdXRlLnBhcmFtVmFsdWVzKTsKICAgICAgICAgICAgICAgICAgICAgICAgc3BhLm1ha2VWaWV3Q2FsbGJhY2sxKHNwYS4kY29udHJvbGxlciwgIm9ubG9hZCIsIHJvdXRlLnBhcmFtVmFsdWVzKTsKICAgICAgICAgICAgICAgICAgICAgICAgc3BhLm1ha2VWaWV3Q2FsbGJhY2sxKHNwYS4kY29udHJvbGxlciwgImFmdGVyb25sb2FkIiwgcm91dGUucGFyYW1WYWx1ZXMpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICB9IGVsc2UgaWYgKGhhc0VzY2FwZUZyYWdtZW50ID09PSAiIikgeyAvL0dvdG8gNDA0IGhhbmRsZXIKCiAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaGFzaCA9ICIjISIgKyBzZXR0aW5ncy5Ob3RGb3VuZFJvdXRlOwoKICAgICAgICAgICAgfSBlbHNlIHsgLy9zaG91bGQgb25seSBnZXQgaGVyZSBpcyB0aGlzIGlzIGFuIGVzY2FwZWZyYWdlbWVudGVkIHVybCBmb3IgdGhlIHNwaWRlcnMKICAgICAgICAgICAgICAgIG5ld1ZpZXcgPSAkKHNldHRpbmdzLnZpZXdTZWxlY3RvcikuYWRkQ2xhc3Moc2V0dGluZ3MuY3VycmVudENsYXNzKTsKICAgICAgICAgICAgfQoKICAgICAgICB9LAoKICAgICAgICBnZXRBbmltYXRpb246IGZ1bmN0aW9uIChyb3V0ZSkgewoKICAgICAgICAgICAgaWYgKCFyb3V0ZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2V0dGluZ3Mudmlld1RyYW5zaXRpb247CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB0aGlzLmFuaW1hdGlvbnNbcm91dGUudHJhbnNpdGlvbl0gfHwgdGhpcy5zZXR0aW5ncy52aWV3VHJhbnNpdGlvbjsKCiAgICAgICAgfSwKCiAgICAgICAgZW5kU3dhcEFuaW1hdGlvbjogZnVuY3Rpb24gKHJvdXRlLCBuZXdSb3V0ZSkgewogICAgICAgICAgICAvL2N1cnJlbnRWaWV3LCBuZXdWaWV3LCAKICAgICAgICAgICAgdmFyIHNwYSA9IHRoaXMsCiAgICAgICAgICAgICAgICBjdXJyZW50VmlldyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi5jdXJyZW50Lm91dCIpLAogICAgICAgICAgICAgICAgbmV3VmlldyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG5ld1JvdXRlLnZpZXdJZCksCiAgICAgICAgICAgICAgICBwYXJlbnQsCiAgICAgICAgICAgICAgICBhbmltID0gc3BhLmFuaW1hdGlvbjsKCiAgICAgICAgICAgIGlmIChyb3V0ZSkgewogICAgICAgICAgICAgICAgc3BhLm1ha2VWaWV3Q2FsbGJhY2sxKHNwYS4kb2xkQ29udHJvbGxlciwgInVubG9hZCIpOwogICAgICAgICAgICAgICAgc3BhLm1ha2VWaWV3Q2FsbGJhY2sxKHNwYS4kb2xkQ29udHJvbGxlciwgImFmdGVydW5sb2FkIik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChuZXdWaWV3LmNsYXNzTGlzdC5jb250YWlucygiaW4iKSkgewogICAgICAgICAgICAgICAgbmV3Vmlldy5jbGFzc0xpc3QucmVtb3ZlKCJpbiIpOwogICAgICAgICAgICAgICAgbmV3Vmlldy5jbGFzc0xpc3QucmVtb3ZlKGFuaW0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoY3VycmVudFZpZXcgJiYgc3BhLnZpZXdDYWNoZSAmJiBjdXJyZW50Vmlldy5wYXJlbnROb2RlKSB7CgogICAgICAgICAgICAgICAgcGFyZW50ID0gY3VycmVudFZpZXcucGFyZW50Tm9kZQogICAgICAgICAgICAgICAgcGFyZW50LnJlbW92ZUNoaWxkKGN1cnJlbnRWaWV3KTsKCiAgICAgICAgICAgIH0KCiAgICAgICAgfSwKCiAgICAgICAgLy9tYWtlIHN1cmUgdGhlIHZpZXcgaXMgYWN0dWFsbHkgYXZhaWxhYmxlLCB0aGlzIHJlbGllcyBvbiBiYWNrcGFjayB0byBzdXBwbHkgdGhlIG1hcmt1cCBhbmQgaW5qZWN0IGl0IGludG8gdGhlIERPTQogICAgICAgIGVuc3VyZVZpZXdBdmFpbGFibGU6IGZ1bmN0aW9uIChjdXJyZW50VmlldywgbmV3Vmlld0lkKSB7CiAgICAgICAgICAgIC8vbXVzdCBoYXZlIGJhY2twYWNrIG9yIHNvbWV0aGluZyBzaW1pbGFyIHNwYSBpbXBsZW1lbnRzIGl0cyBpbnRlcmZhY2UKICAgICAgICAgICAgaWYgKHRoaXMudmlld0NhY2hlKSB7CgogICAgICAgICAgICAgICAgdmFyIHZpZXcgPSB0aGlzLnZpZXdDYWNoZS5nZXRWaWV3SW5mbyhuZXdWaWV3SWQpLAogICAgICAgICAgICAgICAgICAgIG5ld1ZpZXcsIGxvYzsKCiAgICAgICAgICAgICAgICBpZiAodmlldykgewogICAgICAgICAgICAgICAgICAgIG5ld1ZpZXcgPSB0aGlzLmNyZWF0ZUZyYWdtZW50KHZpZXcuY29udGVudCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGxvYyA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmLnNwbGl0KCIjISIpOwogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5yZXBsYWNlKGxvY1swXSArICI/IiArCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0dGluZ3MuZm9yY2VSZWxvYWQgKyAiPSIgKyBsb2NbMV0pOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChjdXJyZW50VmlldykgewogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRWaWV3LnBhcmVudE5vZGUKICAgICAgICAgICAgICAgICAgICAgICAgLmluc2VydEJlZm9yZShuZXdWaWV3LCBjdXJyZW50Vmlldyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5zZXR0aW5ncy5tYWluV3JhcHBwZXJTZWxlY3RvcikKICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZENoaWxkKG5ld1ZpZXcpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgfQogICAgICAgICAgICAvL2Vsc2UgYXNzdW1lIHRoZSB2aWV3IGlzIGFscmVhZHkgaW4gdGhlIG1hcmt1cAoKICAgICAgICB9LAoKICAgICAgICBtYWtlVmlld0NhbGxiYWNrMTogZnVuY3Rpb24gKGNvbnRyb2xsZXIsIGFjdGlvbiwgcGFyYW1zKSB7CgogICAgICAgICAgICBpZiAoY29udHJvbGxlciAmJiBjb250cm9sbGVyW2FjdGlvbl0pIHsKICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJbYWN0aW9uXS5jYWxsKGNvbnRyb2xsZXIsIHBhcmFtcyB8fCB7fSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgfSwKCiAgICAgICAgbWFrZVZpZXdDYWxsYmFjazogZnVuY3Rpb24gKHJvdXRlLCBhY3Rpb24pIHsKCiAgICAgICAgICAgIHZhciBzcGEgPSB0aGlzLAogICAgICAgICAgICAgICAgJGNvbnRleHQgPSBzcGEuJGNvbnRleHQsCiAgICAgICAgICAgICAgICBzZXR0aW5ncyA9IHNwYS5zZXR0aW5ncywKICAgICAgICAgICAgICAgIGEsIGNiUGF0aHMsIGNhbGxiYWNrOwoKICAgICAgICAgICAgaWYgKGFjdGlvbiAmJiAhcm91dGVbYWN0aW9uXSkgewoKICAgICAgICAgICAgICAgIGlmICgkY29udGV4dCkgewoKICAgICAgICAgICAgICAgICAgICBpZiAoJGNvbnRleHRbcm91dGUudmlld01vZHVsZV0gJiYgJGNvbnRleHRbcm91dGUudmlld01vZHVsZV1bYWN0aW9uXSkgewogICAgICAgICAgICAgICAgICAgICAgICAkY29udGV4dFtyb3V0ZS52aWV3TW9kdWxlXVthY3Rpb25dLmNhbGwoJGNvbnRleHQsIHJvdXRlLnBhcmFtVmFsdWVzIHx8IHt9KTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY2JQYXRocyA9IHJvdXRlW2FjdGlvbl0uc3BsaXQoIi4iKTsKCiAgICAgICAgICAgIGNhbGxiYWNrID0gd2luZG93W2NiUGF0aHNbMF1dOwoKICAgICAgICAgICAgZm9yIChhID0gMTsgYSA8IGNiUGF0aHMubGVuZ3RoOyBhKyspIHsKCiAgICAgICAgICAgICAgICBpZiAoYSA9PT0gMSkgewogICAgICAgICAgICAgICAgICAgIHNwYSA9IGNhbGxiYWNrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGNhbGxiYWNrID0gY2FsbGJhY2tbY2JQYXRoc1thXV07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChjYWxsYmFjaykgewogICAgICAgICAgICAgICAgY2FsbGJhY2suY2FsbChzcGEsIHJvdXRlLnBhcmFtVmFsdWVzIHx8IHt9KTsKICAgICAgICAgICAgfQoKICAgICAgICB9LAoKICAgICAgICBzZXREb2N1bWVudFRpdGxlOiBmdW5jdGlvbiAocm91dGUpIHsKCiAgICAgICAgICAgIHZhciB0aXRsZSA9IHJvdXRlLnRpdGxlLAogICAgICAgICAgICAgICAgaTsKCiAgICAgICAgICAgIGlmICh0aXRsZSA9PT0gIiIpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHJvdXRlLnBhcmFtcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgdGl0bGUgPSB0aXRsZS5yZXBsYWNlKCI6IiArCiAgICAgICAgICAgICAgICAgICAgcm91dGUucGFyYW1zW2ldLAogICAgICAgICAgICAgICAgICAgIHJvdXRlLnBhcmFtVmFsdWVzW3JvdXRlLnBhcmFtc1tpXV0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBkb2N1bWVudC50aXRsZSA9IHRpdGxlOwoKICAgICAgICB9LAoKICAgICAgICBjcmVhdGVGcmFnbWVudDogZnVuY3Rpb24gKGh0bWxTdHIpIHsKCiAgICAgICAgICAgIHZhciBmcmFnID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpLAogICAgICAgICAgICAgICAgdGVtcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwoKICAgICAgICAgICAgdGVtcC5pbm5lckhUTUwgPSBodG1sU3RyOwoKICAgICAgICAgICAgd2hpbGUgKHRlbXAuZmlyc3RDaGlsZCkgewogICAgICAgICAgICAgICAgZnJhZy5hcHBlbmRDaGlsZCh0ZW1wLmZpcnN0Q2hpbGQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gZnJhZzsKICAgICAgICB9LAoKICAgICAgICBoYXNBbmltYXRpb25zOiBmdW5jdGlvbiAoKSB7CgogICAgICAgICAgICB2YXIgYW5pbWF0aW9uID0gZmFsc2UsCiAgICAgICAgICAgICAgICBlbG0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKSwKICAgICAgICAgICAgICAgIGFuaW1hdGlvbnN0cmluZyA9ICdhbmltYXRpb24nLAogICAgICAgICAgICAgICAga2V5ZnJhbWVwcmVmaXggPSAnJywKICAgICAgICAgICAgICAgIGRvbVByZWZpeGVzID0gJ1dlYmtpdCBNb3ogTyBtcyBLaHRtbCcuc3BsaXQoJyAnKSwKICAgICAgICAgICAgICAgIHBmeCA9ICcnLAogICAgICAgICAgICAgICAgaSA9IDA7CgogICAgICAgICAgICBpZiAoZWxtLnN0eWxlLmFuaW1hdGlvbk5hbWUpIHsKICAgICAgICAgICAgICAgIGFuaW1hdGlvbiA9IHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChhbmltYXRpb24gPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgZG9tUHJlZml4ZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZWxtLnN0eWxlW2RvbVByZWZpeGVzW2ldICsgJ0FuaW1hdGlvbk5hbWUnXSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHBmeCA9IGRvbVByZWZpeGVzW2ldOwogICAgICAgICAgICAgICAgICAgICAgICBhbmltYXRpb25zdHJpbmcgPSBwZnggKyAnQW5pbWF0aW9uJzsKICAgICAgICAgICAgICAgICAgICAgICAga2V5ZnJhbWVwcmVmaXggPSAnLScgKyBwZngudG9Mb3dlckNhc2UoKSArICctJzsKICAgICAgICAgICAgICAgICAgICAgICAgYW5pbWF0aW9uID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gYW5pbWF0aW9uOwoKICAgICAgICB9LAoKICAgICAgICAvKgogICAgICAgIHN0b3JlQXN5bmNDb250ZW50OiBmdW5jdGlvbiAoY29udGVudCkgewoKICAgICAgICAgICAgdGhpcy52aWV3Q2FjaGUudXBkYXRlVmlld3NGcm9tRnJhZ21lbnQodGhpcy5zZXR0aW5ncy52aWV3U2VsZWN0b3IsIGNvbnRlbnQpOwogICAgICAgIH0sCgogICAgICAgIGxvYWRBc3luY0NvbnRlbnQ6IGZ1bmN0aW9uICh1cmwsIGNhbGxiYWNrKSB7CgogICAgICAgICAgICBjYWxsYmFjayA9IGNhbGxiYWNrIHx8IHRoaXMuc3RvcmVBc3luY0NvbnRlbnQ7CgogICAgICAgICAgICB2YXIgb1JlcSA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOwoKICAgICAgICAgICAgb1JlcS5vbmxvYWQgPSBjYWxsYmFjazsKICAgICAgICAgICAgb1JlcS5vcGVuKCJnZXQiLCB1cmwsIHRydWUpOwogICAgICAgICAgICBvUmVxLnNlbmQoKTsKICAgICAgICB9LAogICAgICAgICovCgogICAgICAgIC8vYXJyYXkgb2YgYW5pbWF0aW9ucy4gVGhlIG5hbWVzIG1hdGNoIHRoZSBDU1MgY2xhc3Mgc28gbWFrZSBzdXJlIHlvdSBoYXZlIHRoZSBDU1MgZm9yIHRoaXMgYW5pbWF0aW9uIG9yIHlvdSB3aWxsIGJlIGRpc3NhcG9pbnRlZC4KICAgICAgICBhbmltYXRpb25zOiB7CiAgICAgICAgICAgICJzbGlkZSI6ICJzbGlkZSIsCiAgICAgICAgICAgICJmYWRlIjogImZhZGUiLAogICAgICAgICAgICAiZmxpcCI6ICJmbGlwIgogICAgICAgIH0sCgogICAgICAgIHNldHRpbmdzOiB7CiAgICAgICAgICAgIHJvdXRlczogW10sCiAgICAgICAgICAgIHZpZXdTZWxlY3RvcjogIi5jb250ZW50LXBhbmUiLAogICAgICAgICAgICBjdXJyZW50Q2xhc3M6ICJjdXJyZW50IiwKICAgICAgICAgICAgbWFpbldyYXBwcGVyU2VsZWN0b3I6ICJtYWluIiwKICAgICAgICAgICAgTm90Rm91bmRWaWV3OiAibm9mb3VuZFZpZXciLAogICAgICAgICAgICBOb3RGb3VuZFJvdXRlOiAiNDA0IiwKICAgICAgICAgICAgZGVmYXVsdFRpdGxlOiAiQSBTaW5nbGUgUGFnZSBBcHBsaWNhdGlvbiB3aXRoIFJvdXRlcyIsCiAgICAgICAgICAgIHRpdGxlU2VsZWN0b3I6ICIudmlldy10aXRsZSIsCiAgICAgICAgICAgIGZvcmNlUmVsb2FkOiAiX2ZvcmNlX3JlbG9hZF8iLAogICAgICAgICAgICBhdXRvU2V0VGl0bGU6IHRydWUsCiAgICAgICAgICAgIHBhcnNlRE9NOiB0cnVlLAogICAgICAgICAgICBpbml0VmlldzogdHJ1ZSwKICAgICAgICAgICAgaW50b0FuaW1hdGlvbjogdHJ1ZSwKICAgICAgICAgICAgdmlld1RyYW5zaXRpb246ICJzbGlkZSIsCiAgICAgICAgICAgIGFzeW5jVXJsOiB1bmRlZmluZWQKICAgICAgICB9CgogICAgfTsKCiAgICAvLyBHaXZlIHRoZSBpbml0IGZ1bmN0aW9uIHRoZSBzcGEgcHJvdG90eXBlIGZvciBsYXRlciBpbnN0YW50aWF0aW9uCiAgICBTUEEuZm4uaW5pdC5wcm90b3R5cGUgPSBTUEEuZm47CgogICAgcmV0dXJuICh3aW5kb3cuU1BBID0gU1BBKTsKCn0pKHdpbmRvdyk7",
                "body": "Ly8vIDxyZWZlcmVuY2UgcGF0aD0iYmFja2Fjay5qcyIgLz4KLy8vIDxyZWZlcmVuY2UgcGF0aD0iaGVscGVyLmV4dGVuc2lvbnMuanMiIC8+CjsKCihmdW5jdGlvbiAod2luZG93LCB1bmRlZmluZWQpIHsKCiAgICAidXNlIHN0cmljdCI7CgovLyAgICB2YXIgX2dhcSA9IF9nYXEgfHwgdW5kZWZpbmVkOwoKICAgIC8vIERlZmluZSBhIGxvY2FsIGNvcHkgb2YgZGVmZXJyZWQKICAgIHZhciBTUEEgPSBmdW5jdGlvbiAoY3VzdG9tU2V0dGluZ3MpIHsKCiAgICAgICAgdmFyIHNwYSA9IG5ldyBTUEEuZm4uaW5pdCgpLAogICAgICAgICAgICBhcHBOYW1lID0gIiI7CgogICAgICAgIHNwYS5zZXR0aW5ncyA9ICQuZXh0ZW5kKHt9LCBzcGEuc2V0dGluZ3MsIGN1c3RvbVNldHRpbmdzKTsKCiAgICAgICAgaWYgKHNwYS5zZXR0aW5ncy5BcHBDb250ZXh0KSB7CiAgICAgICAgICAgIHNwYS4kY29udGV4dCA9IHNwYS5zZXR0aW5ncy5BcHBDb250ZXh0OwogICAgICAgIH0gZWxzZSB7CgogICAgICAgICAgICB2YXIgc3BhQXBwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiW3NwYS1hcHBdIik7CgogICAgICAgICAgICBpZiAoc3BhQXBwKSB7CgogICAgICAgICAgICAgICAgYXBwTmFtZSA9IHdpbmRvd1tzcGFBcHAuZ2V0QXR0cmlidXRlKCJzcGEtYXBwIildOwoKICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgYXBwTmFtZSA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICAgICAgICAgIGFwcE5hbWUgPSBhcHBOYW1lKCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgc3BhLiRjb250ZXh0ID0gYXBwTmFtZTsKCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCJNdXN0IGhhdmUgYW4gYXBwbGljYXRpb24gY29udGV4dCBkZWZpbmVkIik7CgogICAgICAgICAgICAgICAgdGhyb3cgewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICJTUEEgRXJyb3IiLAogICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICJNdXN0IGhhdmUgYW4gYXBwbGljYXRpb24gY29udGV4dCBkZWZpbmVkIgogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQoKICAgICAgICB9CgogICAgICAgIHNwYS52aWV3Q2FjaGUgPSBzcGEuc2V0dGluZ3Mudmlld0NhY2hlIHx8IEJhY2twYWNrKCk7CgogICAgICAgIHNwYS5hbmFseXRpY3MgPSBzcGEuc2V0dGluZ3MuYW5hbHl0aWNzOwoKICAgICAgICBzcGEudGl0bGVFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihzcGEuc2V0dGluZ3MudGl0bGVTZWxlY3Rvcik7CgogICAgICAgIGlmIChzcGEuc2V0dGluZ3MucGFyc2VET00pIHsKCiAgICAgICAgICAgIHNwYS5zZXR1cFJvdXRlcyhzcGEuc2V0dGluZ3Mudmlld1NlbGVjdG9yKTsKCiAgICAgICAgfQoKICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigiaGFzaGNoYW5nZSIsIGZ1bmN0aW9uICgpIHsKCiAgICAgICAgICAgIHNwYS5zd2FwVmlldygpOwoKICAgICAgICB9KTsKCiAgICAgICAgaWYgKHNwYS5nZXRQYXJhbWV0ZXJCeU5hbWUoc3BhLnNldHRpbmdzLmZvcmNlUmVsb2FkKSkgewoKICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlcGxhY2Uod2luZG93LmxvY2F0aW9uLmhyZWYuc3BsaXQoIj8iKVswXSArICIjISIgKwogICAgICAgICAgICAgICAgc3BhLmdldFBhcmFtZXRlckJ5TmFtZShzcGEuc2V0dGluZ3MuZm9yY2VSZWxvYWQpKTsKICAgICAgICAgICAgcmV0dXJuIHNwYTsKCiAgICAgICAgfSBlbHNlIGlmIChzcGEuc2V0dGluZ3MuaW5pdFZpZXcpIHsKICAgICAgICAgICAgc3BhLnN3YXBWaWV3KCk7CiAgICAgICAgfQoKICAgICAgICAvKgoKICAgICAgICAvL2RlY2lkZWQgdG8gc2hlbHZlIHRoaXMgZm9yIHRoZSB0aW1lIGJlaW5nLiBXaWxsIGNvbXBsZXRlIHRoaXMgZnVuY3Rpb25hbGl0eQogICAgICAgIC8vYWZ0ZXIgdGhlIGJvb2sgaXMgcHVibGlzaGVkCgogICAgICAgIGlmIChzcGEuc2V0dGluZ3MuYXN5bmNVcmwgJiYgdHlwZW9mIHNwYS5zZXR0aW5ncy5hc3luY1VybCA9PT0gInN0cmluZyIpIHsKCiAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIkRPTUNvbnRlbnRMb2FkZWQiLCBmdW5jdGlvbiAoKSB7CgogICAgICAgICAgICAgICAgZS50YXJnZXQucmVtb3ZlRXZlbnRMaXN0ZW5lcihlLnR5cGUsIGFyZ3VtZW50cy5jYWxsZWUpOwoKICAgICAgICAgICAgICAgIHNwYS5sb2FkQXN5bmNDb250ZW50LmNhbGwoc3BhLCBzcGEuc2V0dGluZ3MuYXN5bmNVcmwpOwogICAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgICovCgogICAgICAgIHJldHVybiBzcGE7CgogICAgfTsKCiAgICBTUEEuZm4gPSBTUEEucHJvdG90eXBlID0gewoKICAgICAgICBjb25zdHJ1Y3RvcjogU1BBLAoKICAgICAgICBpbml0OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0sCgogICAgICAgIHZlcnNpb246ICIwLjAuNiIsCgogICAgICAgIHZpZXdDYWNoZTogdW5kZWZpbmVkLAoKCiAgICAgICAgLy9iYXJyb3dpbmcgbmFtaW5nIGNvbnZlbnRpb25zIGZyb20gQW5ndWxhcgogICAgICAgIC8vVGhpcyBpcyBsaWtlIHJlbmFtaW5nIGEgYnJhbmQgd2l0aCBhIGJhZCByZXB1dGF0aW9uLAogICAgICAgIC8vbWFpbnRhaW5pbmcgYW5kIHVzaW5nIHRoZSBjb250ZXh0ICh0aGlzKSBwcm9wZXJseQogICAgICAgIC8vaXMgY29uZnVzaW5nIGZvciBtYW55IGRldmVsb3BlcnMgbmV3IHRvIEphdmFTY3JpcHQuCiAgICAgICAgLy9DaGFuZ2luZyB0aGUgbmFtZSBhYnN0cmFjdHMgdGhlIG1pbmQgZnJvbSBhc3NvY2lhdGluZwogICAgICAgIC8vdGhlIG5hbWUgdG8gc29tZXRoaW5nIHRoZXkgcGVyY2VpdmUgYXMgYW5ub3lpbmcuCiAgICAgICAgJGNvbnRleHQ6IHVuZGVmaW5lZCwKICAgICAgICAkY29udHJvbGxlcjogdW5kZWZpbmVkLAogICAgICAgICRvbGRDb250cm9sbGVyOiB1bmRlZmluZWQsCgogICAgICAgIHNldHVwUm91dGVzOiBmdW5jdGlvbiAoKSB7CgogICAgICAgICAgICB2YXIgc3BhID0gdGhpcywKICAgICAgICAgICAgICAgIHNldHRpbmdzID0gc3BhLnNldHRpbmdzLAogICAgICAgICAgICAgICAgcm91dGVzID0gJC5leHRlbmQoJC5wYXJzZUxvY2FsU3RvcmFnZSgicm91dGVzIikgfHwge30sIHNldHRpbmdzLnJvdXRlcyksCiAgICAgICAgICAgICAgICBpID0gMCwKICAgICAgICAgICAgICAgIHJhd1BhdGgsIHZpZXcsIHJvdXRlLCB2aWV3SWQsCiAgICAgICAgICAgICAgICBWaWV3cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoc2V0dGluZ3Mudmlld1NlbGVjdG9yKTsKCiAgICAgICAgICAgIGZvciAoOyBpIDwgVmlld3MubGVuZ3RoOyBpKyspIHsKCiAgICAgICAgICAgICAgICB2aWV3ID0gVmlld3NbaV07CgogICAgICAgICAgICAgICAgaWYgKHZpZXcuaGFzQXR0cmlidXRlcygpICYmIHZpZXcuaGFzQXR0cmlidXRlKCJpZCIpKSB7CgogICAgICAgICAgICAgICAgICAgIHZpZXdJZCA9IHZpZXcuZ2V0QXR0cmlidXRlKCJpZCIpOwogICAgICAgICAgICAgICAgICAgIHJhd1BhdGggPSAodmlldy5oYXNBdHRyaWJ1dGUoInNwYS1yb3V0ZSIpID8gdmlldy5nZXRBdHRyaWJ1dGUoInNwYS1yb3V0ZSIpIDogIiIpOwoKICAgICAgICAgICAgICAgICAgICByb3V0ZSA9IHNwYS5jcmVhdGVSb3V0ZSh2aWV3SWQsIHJhd1BhdGgsIHZpZXcpOwogICAgICAgICAgICAgICAgICAgIHJvdXRlc1tyb3V0ZS5wYXRoXSA9IHJvdXRlOwoKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHNwYS5zZXR0aW5ncy5yb3V0ZXMgPSByb3V0ZXM7CgogICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgicm91dGVzIiwgSlNPTi5zdHJpbmdpZnkocm91dGVzKSk7CgogICAgICAgICAgICBpZiAoc3BhLnZpZXdDYWNoZSAmJiAoc3BhLmdldFBhcmFtZXRlckJ5TmFtZSgiX2VzY2FwZWRfZnJhZ21lbnRfIikgPT09ICIiKSkgewogICAgICAgICAgICAgICAgc3BhLnZpZXdDYWNoZS51cGRhdGVWaWV3cyhzZXR0aW5ncy52aWV3U2VsZWN0b3IpOwogICAgICAgICAgICB9CgogICAgICAgIH0sCgogICAgICAgIGNyZWF0ZVJvdXRlOiBmdW5jdGlvbiAodmlld0lkLCByYXdQYXRoLCB2aWV3KSB7CgogICAgICAgICAgICAvL25lZWQgdG8gY2hlY2sgZm9yIGR1cGxpY2F0ZSBwYXRoCiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICB2aWV3SWQ6IHZpZXdJZCwKICAgICAgICAgICAgICAgIHZpZXdNb2R1bGU6ICh2aWV3Lmhhc0F0dHJpYnV0ZSgic3BhLW1vZHVsZSIpID8gdmlldy5nZXRBdHRyaWJ1dGUoInNwYS12aWV3SWQiKSA6CiAgICAgICAgICAgICAgICAgICAgdmlld0lkKSwKICAgICAgICAgICAgICAgIHBhdGg6IHJhd1BhdGguc3BsaXQoIlxcOiIpWzBdLAogICAgICAgICAgICAgICAgcGFyYW1zOiByYXdQYXRoLnNwbGl0KCJcXDoiKS5zbGljZSgxKSwKICAgICAgICAgICAgICAgIHRpdGxlOiAodmlldy5oYXNBdHRyaWJ1dGUoInNwYS10aXRsZSIpID8gdmlldy5nZXRBdHRyaWJ1dGUoInNwYS10aXRsZSIpIDoKICAgICAgICAgICAgICAgICAgICB0aGlzLnNldHRpbmdzLmRlZmF1bHRUaXRsZSksCiAgICAgICAgICAgICAgICB0cmFuc2l0aW9uOiAodmlldy5oYXNBdHRyaWJ1dGUoInNwYS10cmFuc2l0aW9uIikgPwogICAgICAgICAgICAgICAgICAgIHZpZXcuZ2V0QXR0cmlidXRlKCJzcGEtdHJhbnNpdGlvbiIpIDoKICAgICAgICAgICAgICAgICAgICAiIiksCiAgICAgICAgICAgICAgICBwYXJhbVZhbHVlczoge30sCiAgICAgICAgICAgICAgICBiZWZvcmVvbmxvYWQ6ICh2aWV3Lmhhc0F0dHJpYnV0ZSgic3BhLWJlZm9yZW9ubG9hZCIpID8gdmlldy5nZXRBdHRyaWJ1dGUoInNwYS1iZWZvcmVvbmxvYWQiKSA6IHVuZGVmaW5lZCksCiAgICAgICAgICAgICAgICBvbmxvYWQ6ICh2aWV3Lmhhc0F0dHJpYnV0ZSgic3BhLW9ubG9hZCIpID8gdmlldy5nZXRBdHRyaWJ1dGUoInNwYS1vbmxvYWQiKSA6IHVuZGVmaW5lZCksCiAgICAgICAgICAgICAgICBhZnRlcm9ubG9hZDogKHZpZXcuaGFzQXR0cmlidXRlKCJzcGEtYWZ0ZXJvbmxvYWQiKSA/IHZpZXcuZ2V0QXR0cmlidXRlKCJzcGEtYWZ0ZXJvbmxvYWQiKSA6IHVuZGVmaW5lZCksCiAgICAgICAgICAgICAgICBiZWZvcmV1bmxvYWQ6ICh2aWV3Lmhhc0F0dHJpYnV0ZSgic3BhLWJlZm9yZXVubG9hZCIpID8gdmlldy5nZXRBdHRyaWJ1dGUoInNwYS1iZWZvcmV1bmxvYWQiKSA6IHVuZGVmaW5lZCksCiAgICAgICAgICAgICAgICB1bmxvYWQ6ICh2aWV3Lmhhc0F0dHJpYnV0ZSgic3BhLXVubG9hZCIpID8gdmlldy5nZXRBdHRyaWJ1dGUoInNwYS11bmxvYWQiKSA6IHVuZGVmaW5lZCksCiAgICAgICAgICAgICAgICBhZnRlcnVubG9hZDogKHZpZXcuaGFzQXR0cmlidXRlKCJzcGEtYWZ0ZXJ1bmxvYWQiKSA/IHZpZXcuZ2V0QXR0cmlidXRlKCJzcGEtYWZ0ZXJ1bmxvYWQiKSA6IHVuZGVmaW5lZCkKICAgICAgICAgICAgfTsKCiAgICAgICAgfSwKCiAgICAgICAgbWF0Y2hSb3V0ZUJ5UGF0aDogZnVuY3Rpb24gKHBhdGgsIHJvdXRlcykgewoKICAgICAgICAgICAgaWYgKCFyb3V0ZXMpIHsKICAgICAgICAgICAgICAgIHJvdXRlcyA9IHRoaXMuc2V0dGluZ3Mucm91dGVzOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIga2V5LCByb3V0ZSwgcGFyYW1zLCBpLAogICAgICAgICAgICAgICAgcGFyYW1WYWx1ZXMgPSB7fSwKICAgICAgICAgICAgICAgIHNlYXJjaDsKCiAgICAgICAgICAgIC8vcm91dGVzIGlzIGFuIG9iamVjdCBzbyB3ZSBjYW4gbWF0Y2ggdGhlIHBhdGggdG8gdGhlIHJvdXRlIGFzIGl0IHdpbGwgYmUgYSBwcm9wZXJ0eSBuYW1lLgogICAgICAgICAgICBpZiAocm91dGVzLmhhc093blByb3BlcnR5KHBhdGgpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcm91dGVzW3BhdGhdOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmb3IgKGtleSBpbiByb3V0ZXMpIHsKCiAgICAgICAgICAgICAgICBpZiAocm91dGVzLmhhc093blByb3BlcnR5KGtleSkpIHsKCiAgICAgICAgICAgICAgICAgICAgcm91dGUgPSByb3V0ZXNba2V5XTsKCiAgICAgICAgICAgICAgICAgICAgc2VhcmNoID0gbmV3IFJlZ0V4cCgnXFxiJyArIHJvdXRlLnBhdGggKyAnXFxiJywgJ2dpJyk7CgogICAgICAgICAgICAgICAgICAgIGlmIChyb3V0ZS5wYXRoICE9PSAiIiAmJgogICAgICAgICAgICAgICAgICAgICAgICBwYXRoLnNlYXJjaChzZWFyY2gpID09PSAwKSB7CgogICAgICAgICAgICAgICAgICAgICAgICBwYXJhbXMgPSBwYXRoLnJlcGxhY2Uocm91dGUucGF0aCwgIiIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc3BsaXQoIi8iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLnNsaWNlKDEpOyAvL3RoZSBmaXJzdCBpdGVtIHdpbGwgYmUgZW1wdHkKCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBwYXJhbXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtVmFsdWVzW3JvdXRlLnBhcmFtc1tpXV0gPSBwYXJhbXNbaV07CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIHJvdXRlLnBhcmFtVmFsdWVzID0gcGFyYW1WYWx1ZXM7CgogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICByb3V0ZSA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHJvdXRlOwogICAgICAgIH0sCgogICAgICAgIG1hdGNoUm91dGVCeUlkOiBmdW5jdGlvbiAoaWQsIHJvdXRlcykgewoKICAgICAgICAgICAgaWYgKCFyb3V0ZXMpIHsKICAgICAgICAgICAgICAgIHJvdXRlcyA9IHRoaXMuc2V0dGluZ3Mucm91dGVzOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgcm91dGU7CgogICAgICAgICAgICBmb3IgKHJvdXRlIGluIHJvdXRlcykgewogICAgICAgICAgICAgICAgaWYgKHJvdXRlc1tyb3V0ZV0udmlld0lkID09PSBpZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiByb3V0ZXNbcm91dGVdOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgIH0sCgogICAgICAgIC8vICBuZXdWaWV3OiB1bmRlZmluZWQsIC8vcGxhY2Vob2xkZXIgZm9yIG5ldyB2aWV3CiAgICAgICAgLy8gIGN1cnJlbnRWaWV3OiB1bmRlZmluZWQsIC8vcGxhY2Vob2xkZXIgZm9yIGN1cnJlbnQgdmlldyBiZWZvcmUgYSBzd2FwCiAgICAgICAgYW5pbWF0aW9uOiB1bmRlZmluZWQsCgogICAgICAgIGdldFBhcmFtZXRlckJ5TmFtZTogZnVuY3Rpb24gKG5hbWUpIHsKCiAgICAgICAgICAgIG5hbWUgPSBuYW1lLnJlcGxhY2UoL1tcW10vLCAiXFxcWyIpLnJlcGxhY2UoL1tcXV0vLCAiXFxcXSIpOwoKICAgICAgICAgICAgdmFyIHJlZ2V4ID0gbmV3IFJlZ0V4cCgiW1xcPyZdIiArIG5hbWUgKyAiPShbXiYjXSopIiksCiAgICAgICAgICAgICAgICByZXN1bHRzID0gcmVnZXguZXhlYyhsb2NhdGlvbi5zZWFyY2gpOwoKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdHMgPT09IG51bGwgPyAiIiA6IGRlY29kZVVSSUNvbXBvbmVudChyZXN1bHRzWzFdLnJlcGxhY2UoL1wrL2csICIgIikpOwogICAgICAgIH0sCgogICAgICAgIGdldFZlbmRvclByb3BlcnR5TmFtZTogZnVuY3Rpb24gKHByb3ApIHsKCiAgICAgICAgICAgIHZhciBwcmVmaXhlcyA9IFsnTW96JywgJ1dlYmtpdCcsICdPJywgJ21zJ10sCiAgICAgICAgICAgICAgICB2ZW5kb3JQcm9wLCBpLAogICAgICAgICAgICAgICAgcHJvcF8gPSBwcm9wLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgcHJvcC5zdWJzdHIoMSk7CgogICAgICAgICAgICBpZiAocHJvcCBpbiB0aGlzLmRpdi5zdHlsZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHByb3A7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBwcmVmaXhlcy5sZW5ndGg7ICsraSkgewoKICAgICAgICAgICAgICAgIHZlbmRvclByb3AgPSBwcmVmaXhlc1tpXSArIHByb3BfOwoKICAgICAgICAgICAgICAgIGlmICh2ZW5kb3JQcm9wIGluIHRoaXMuZGl2LnN0eWxlKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZlbmRvclByb3A7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICB9CiAgICAgICAgfSwKCiAgICAgICAgdHJhbnNpdGlvbmVuZDogewogICAgICAgICAgICAnYW5pbWF0aW9uJzogJ2FuaW1hdGlvbmVuZCcsCiAgICAgICAgICAgICd3ZWJraXRBbmltYXRpb24nOiAnd2Via2l0QW5pbWF0aW9uRW5kJywKICAgICAgICAgICAgJ01vekFuaW1hdGlvbic6ICdhbmltYXRpb25lbmQnLAogICAgICAgICAgICAnT0FuaW1hdGlvbic6ICdvQW5pbWF0aW9uRW5kJwogICAgICAgIH0sCgogICAgICAgIC8vIHJlcHVycG9zZWQgaGVscGVyCiAgICAgICAgY3NzUHJlZml4OiBmdW5jdGlvbiAoc3VmZml4KSB7CgogICAgICAgICAgICBpZiAoIXN1ZmZpeCkgewogICAgICAgICAgICAgICAgcmV0dXJuICcnOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgaSwgbGVuLCBwYXJ0cywgcHJlZml4ZXMsCiAgICAgICAgICAgICAgICBib2R5U3R5bGUgPSBkb2N1bWVudC5ib2R5LnN0eWxlOwoKICAgICAgICAgICAgaWYgKHN1ZmZpeC5pbmRleE9mKCctJykgPj0gMCkgewoKICAgICAgICAgICAgICAgIHBhcnRzID0gKCcnICsgc3VmZml4KS5zcGxpdCgnLScpOwoKICAgICAgICAgICAgICAgIGZvciAoaSA9IDEsIGxlbiA9IHBhcnRzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgcGFydHNbaV0gPSBwYXJ0c1tpXS5zdWJzdHIoMCwgMSkudG9VcHBlckNhc2UoKSArIHBhcnRzW2ldLnN1YnN0cigxKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHN1ZmZpeCA9IHBhcnRzLmpvaW4oJycpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoc3VmZml4IGluIGJvZHlTdHlsZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHN1ZmZpeDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgc3VmZml4ID0gc3VmZml4LnN1YnN0cigwLCAxKS50b1VwcGVyQ2FzZSgpICsgc3VmZml4LnN1YnN0cigxKTsKCiAgICAgICAgICAgIHByZWZpeGVzID0gWyd3ZWJraXQnLCAnTW96JywgJ21zJywgJ08nXTsKCiAgICAgICAgICAgIGZvciAoaSA9IDAsIGxlbiA9IHByZWZpeGVzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAocHJlZml4ZXNbaV0gKyBzdWZmaXggaW4gYm9keVN0eWxlKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHByZWZpeGVzW2ldICsgc3VmZml4OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gIiI7CiAgICAgICAgfSwKCiAgICAgICAgcmVtb3ZlRXh0cmFWaWV3czogZnVuY3Rpb24gKGN1cnJlbnRWaWV3KSB7CgogICAgICAgICAgICB2YXIgbGVuZ3RoID0gY3VycmVudFZpZXcubGVuZ3RoOwoKICAgICAgICAgICAgd2hpbGUgKGxlbmd0aCA+IDEpIHsKCiAgICAgICAgICAgICAgICBsZW5ndGgtLTsKICAgICAgICAgICAgICAgIGN1cnJlbnRWaWV3W2xlbmd0aF0KICAgICAgICAgICAgICAgICAgICAucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChjdXJyZW50Vmlld1tsZW5ndGhdKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCgogICAgICAgIHB1c2hWaWV3OiBmdW5jdGlvbiAocGF0aCkgewoKICAgICAgICAgICAgdmFyIHNwYSA9IHRoaXM7CgogICAgICAgICAgICBpZiAoc3BhLmFuYWx5dGljcykgewogICAgICAgICAgICAgICAgc3BhLmFuYWx5dGljcy5wdXNoVmlldyhbJ190cmFja1BhZ2V2aWV3JywgcGF0aF0pOwogICAgICAgICAgICB9CgogICAgICAgIH0sCgogICAgICAgIHN3YXBWaWV3OiBmdW5jdGlvbiAoKSB7CgogICAgICAgICAgICB2YXIgc3BhID0gdGhpcywKICAgICAgICAgICAgICAgIHNldHRpbmdzID0gc3BhLnNldHRpbmdzLAogICAgICAgICAgICAgICAgcm91dGUsIG9sZFJvdXRlLCBhbmltLAogICAgICAgICAgICAgICAgaGFzaCA9IHdpbmRvdy5sb2NhdGlvbi5oYXNoLAogICAgICAgICAgICAgICAgbmV3VmlldywKICAgICAgICAgICAgICAgIGhhc0VzY2FwZUZyYWdtZW50ID0gc3BhLmdldFBhcmFtZXRlckJ5TmFtZSgiX2VzY2FwZWRfZnJhZ21lbnRfIiksCiAgICAgICAgICAgICAgICBoYXNoRnJhZ21lbnQgPSAoaGFzaCAhPT0gIiMiKSA/IGhhc2gucmVwbGFjZSgiIyEiLCAiIikgOiAiIiwKICAgICAgICAgICAgICAgIHBhdGggPSBoYXNoRnJhZ21lbnQuc3BsaXQoIjoiKVswXSwKICAgICAgICAgICAgICAgIGN1cnJlbnRWaWV3ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiLiIgKyBzZXR0aW5ncy5jdXJyZW50Q2xhc3MpOwoKICAgICAgICAgICAgc3BhLiRvbGRDb250cm9sbGVyID0gc3BhLiRjb250cm9sbGVyOwoKICAgICAgICAgICAgaWYgKGN1cnJlbnRWaWV3Lmxlbmd0aCAmJiBjdXJyZW50Vmlldy5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgICAgICAvL2FkZGluZyB0aGlzIGJlY2F1c2UgSSBmb3VuZCBteXNlbGYgc29tZXRpbWVzIHRhcHBpbmcgaXRlbXMgdG8gbGF1bmNoIGEgbmV3IHZpZXcgYmVmb3JlIHRoZSBhbmltYXRpb24gd2FzIGNvbXBsZXRlLgogICAgICAgICAgICAgICAgc3BhLnJlbW92ZUV4dHJhVmlld3MoY3VycmVudFZpZXcpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvL2NvbnZlcnQgbm9kZWxpc3QgdG8gYSBzaW5nbGUgbm9kZQogICAgICAgICAgICBjdXJyZW50VmlldyA9IGN1cnJlbnRWaWV3WzBdOwoKICAgICAgICAgICAgaWYgKGN1cnJlbnRWaWV3ICYmIGN1cnJlbnRWaWV3LmlkKSB7CiAgICAgICAgICAgICAgICBvbGRSb3V0ZSA9IHNwYS5tYXRjaFJvdXRlQnlJZChjdXJyZW50Vmlldy5pZCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJvdXRlID0gc3BhLm1hdGNoUm91dGVCeVBhdGgocGF0aCk7CgogICAgICAgICAgICBpZiAocm91dGUgIT09IHVuZGVmaW5lZCkgewoKICAgICAgICAgICAgICAgIGlmIChzcGEuJGNvbnRleHRbcm91dGUudmlld0lkXSAmJgogICAgICAgICAgICAgICAgICAgIHR5cGVvZiBzcGEuJGNvbnRleHRbcm91dGUudmlld0lkXSA9PT0gImZ1bmN0aW9uIikgewoKICAgICAgICAgICAgICAgICAgICBzcGEuJGNvbnRyb2xsZXIgPSBuZXcgc3BhLiRjb250ZXh0W3JvdXRlLnZpZXdJZF0oc3BhLiRjb250ZXh0KTsKCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNwYS4kY29udGV4dFtyb3V0ZS52aWV3SWRdICYmCiAgICAgICAgICAgICAgICAgICAgdHlwZW9mIHNwYS4kY29udGV4dFtyb3V0ZS52aWV3SWRdID09PSAib2JqZWN0IikgewoKICAgICAgICAgICAgICAgICAgICBzcGEuJGNvbnRyb2xsZXIgPSBuZXcgc3BhLiRjb250ZXh0W3JvdXRlLnZpZXdJZF07CgogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgc3BhLnB1c2hWaWV3KHBhdGgpOwoKICAgICAgICAgICAgICAgIHNwYS5lbnN1cmVWaWV3QXZhaWxhYmxlKGN1cnJlbnRWaWV3LCByb3V0ZS52aWV3SWQpOwoKICAgICAgICAgICAgICAgIG5ld1ZpZXcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChyb3V0ZS52aWV3SWQpOwoKICAgICAgICAgICAgICAgIGlmIChuZXdWaWV3KSB7CgogICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50VmlldykgewoKICAgICAgICAgICAgICAgICAgICAgICAgLy9zcGEubWFrZVZpZXdDYWxsYmFjayhvbGRSb3V0ZSwgImJlZm9yZXVubG9hZCIpOwoKICAgICAgICAgICAgICAgICAgICAgICAgc3BhLm1ha2VWaWV3Q2FsbGJhY2sxKHNwYS4kb2xkQ29udHJvbGxlciwgImJlZm9yZXVubG9hZCIpOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNwYS5oYXNBbmltYXRpb25zKCkpIHsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbmltID0gc3BhLmdldEFuaW1hdGlvbihyb3V0ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcGEuYW5pbWF0aW9uID0gYW5pbTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYW5pbSkgewoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50Vmlldy5hZGRFdmVudExpc3RlbmVyKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcGEudHJhbnNpdGlvbmVuZFtzcGEuY3NzUHJlZml4KCJhbmltYXRpb24iKV0sIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcGEuZW5kU3dhcEFuaW1hdGlvbi5jYWxsKHNwYSwgb2xkUm91dGUsIHJvdXRlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRWaWV3ID0gdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9tb2RpZnkgb25jZSBhZGRDbGFzcyBzdXBwb3J0cyBhcnJheSBvZiBjbGFzc2VzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJChjdXJyZW50VmlldykuYWRkQ2xhc3MoImFuaW1hdGVkIG91dCAiICsgYW5pbSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKCJpbiIpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKG5ld1ZpZXcpLmFkZENsYXNzKHNldHRpbmdzLmN1cnJlbnRDbGFzcyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICIgYW5pbWF0ZWQgIiArIGFuaW0gKyAiIGluIik7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJChuZXdWaWV3KS5hZGRDbGFzcyhzZXR0aW5ncy5jdXJyZW50Q2xhc3MpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwYS5lbmRTd2FwQW5pbWF0aW9uLmNhbGwoc3BhLCBvbGRSb3V0ZSwgcm91dGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNldHRpbmdzLmludG9BbmltYXRpb24pIHsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdWaWV3LmFkZEV2ZW50TGlzdGVuZXIoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3BhLnRyYW5zaXRpb25lbmRbc3BhLmNzc1ByZWZpeCgiYW5pbWF0aW9uIildLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcGEuZW5kU3dhcEFuaW1hdGlvbi5jYWxsKHNwYSwgb2xkUm91dGUsIHJvdXRlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFZpZXcgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJChuZXdWaWV3KS5hZGRDbGFzcyhzZXR0aW5ncy5jdXJyZW50Q2xhc3MgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICIgYW5pbWF0ZWQgIiArIGFuaW0gKyAiIGluIik7CgogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICQobmV3VmlldykuYWRkQ2xhc3Moc2V0dGluZ3MuY3VycmVudENsYXNzKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwYS5lbmRTd2FwQW5pbWF0aW9uLmNhbGwoc3BhLCBvbGRSb3V0ZSwgcm91dGUpOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgc3BhLnNldERvY3VtZW50VGl0bGUocm91dGUpOwoKICAgICAgICAgICAgICAgICAgICBpZiAocm91dGUpIHsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vc3BhLm1ha2VWaWV3Q2FsbGJhY2socm91dGUsICJiZWZvcmVvbmxvYWQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgLy9zcGEubWFrZVZpZXdDYWxsYmFjayhyb3V0ZSwgIm9ubG9hZCIpOwogICAgICAgICAgICAgICAgICAgICAgICAvL3NwYS5tYWtlVmlld0NhbGxiYWNrKHJvdXRlLCAiYWZ0ZXJvbmxvYWQiKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIHNwYS5tYWtlVmlld0NhbGxiYWNrMShzcGEuJGNvbnRyb2xsZXIsICJiZWZvcmVvbmxvYWQiLCByb3V0ZS5wYXJhbVZhbHVlcyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHNwYS5tYWtlVmlld0NhbGxiYWNrMShzcGEuJGNvbnRyb2xsZXIsICJvbmxvYWQiLCByb3V0ZS5wYXJhbVZhbHVlcyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHNwYS5tYWtlVmlld0NhbGxiYWNrMShzcGEuJGNvbnRyb2xsZXIsICJhZnRlcm9ubG9hZCIsIHJvdXRlLnBhcmFtVmFsdWVzKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgfSBlbHNlIGlmIChoYXNFc2NhcGVGcmFnbWVudCA9PT0gIiIpIHsgLy9Hb3RvIDQwNCBoYW5kbGVyCgogICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhhc2ggPSAiIyEiICsgc2V0dGluZ3MuTm90Rm91bmRSb3V0ZTsKCiAgICAgICAgICAgIH0gZWxzZSB7IC8vc2hvdWxkIG9ubHkgZ2V0IGhlcmUgaXMgdGhpcyBpcyBhbiBlc2NhcGVmcmFnZW1lbnRlZCB1cmwgZm9yIHRoZSBzcGlkZXJzCiAgICAgICAgICAgICAgICBuZXdWaWV3ID0gJChzZXR0aW5ncy52aWV3U2VsZWN0b3IpLmFkZENsYXNzKHNldHRpbmdzLmN1cnJlbnRDbGFzcyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgfSwKCiAgICAgICAgZ2V0QW5pbWF0aW9uOiBmdW5jdGlvbiAocm91dGUpIHsKCiAgICAgICAgICAgIGlmICghcm91dGUpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNldHRpbmdzLnZpZXdUcmFuc2l0aW9uOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gdGhpcy5hbmltYXRpb25zW3JvdXRlLnRyYW5zaXRpb25dIHx8IHRoaXMuc2V0dGluZ3Mudmlld1RyYW5zaXRpb247CgogICAgICAgIH0sCgogICAgICAgIGVuZFN3YXBBbmltYXRpb246IGZ1bmN0aW9uIChyb3V0ZSwgbmV3Um91dGUpIHsKICAgICAgICAgICAgLy9jdXJyZW50VmlldywgbmV3VmlldywgCiAgICAgICAgICAgIHZhciBzcGEgPSB0aGlzLAogICAgICAgICAgICAgICAgY3VycmVudFZpZXcgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIuY3VycmVudC5vdXQiKSwKICAgICAgICAgICAgICAgIG5ld1ZpZXcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChuZXdSb3V0ZS52aWV3SWQpLAogICAgICAgICAgICAgICAgcGFyZW50LAogICAgICAgICAgICAgICAgYW5pbSA9IHNwYS5hbmltYXRpb247CgogICAgICAgICAgICBpZiAocm91dGUpIHsKICAgICAgICAgICAgICAgIHNwYS5tYWtlVmlld0NhbGxiYWNrMShzcGEuJG9sZENvbnRyb2xsZXIsICJ1bmxvYWQiKTsKICAgICAgICAgICAgICAgIHNwYS5tYWtlVmlld0NhbGxiYWNrMShzcGEuJG9sZENvbnRyb2xsZXIsICJhZnRlcnVubG9hZCIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAobmV3Vmlldy5jbGFzc0xpc3QuY29udGFpbnMoImluIikpIHsKICAgICAgICAgICAgICAgIG5ld1ZpZXcuY2xhc3NMaXN0LnJlbW92ZSgiaW4iKTsKICAgICAgICAgICAgICAgIG5ld1ZpZXcuY2xhc3NMaXN0LnJlbW92ZShhbmltKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGN1cnJlbnRWaWV3ICYmIHNwYS52aWV3Q2FjaGUgJiYgY3VycmVudFZpZXcucGFyZW50Tm9kZSkgewoKICAgICAgICAgICAgICAgIHBhcmVudCA9IGN1cnJlbnRWaWV3LnBhcmVudE5vZGUKICAgICAgICAgICAgICAgIHBhcmVudC5yZW1vdmVDaGlsZChjdXJyZW50Vmlldyk7CgogICAgICAgICAgICB9CgogICAgICAgIH0sCgogICAgICAgIC8vbWFrZSBzdXJlIHRoZSB2aWV3IGlzIGFjdHVhbGx5IGF2YWlsYWJsZSwgdGhpcyByZWxpZXMgb24gYmFja3BhY2sgdG8gc3VwcGx5IHRoZSBtYXJrdXAgYW5kIGluamVjdCBpdCBpbnRvIHRoZSBET00KICAgICAgICBlbnN1cmVWaWV3QXZhaWxhYmxlOiBmdW5jdGlvbiAoY3VycmVudFZpZXcsIG5ld1ZpZXdJZCkgewogICAgICAgICAgICAvL211c3QgaGF2ZSBiYWNrcGFjayBvciBzb21ldGhpbmcgc2ltaWxhciBzcGEgaW1wbGVtZW50cyBpdHMgaW50ZXJmYWNlCiAgICAgICAgICAgIGlmICh0aGlzLnZpZXdDYWNoZSkgewoKICAgICAgICAgICAgICAgIHZhciB2aWV3ID0gdGhpcy52aWV3Q2FjaGUuZ2V0Vmlld0luZm8obmV3Vmlld0lkKSwKICAgICAgICAgICAgICAgICAgICBuZXdWaWV3LCBsb2M7CgogICAgICAgICAgICAgICAgaWYgKHZpZXcpIHsKICAgICAgICAgICAgICAgICAgICBuZXdWaWV3ID0gdGhpcy5jcmVhdGVGcmFnbWVudCh2aWV3LmNvbnRlbnQpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBsb2MgPSB3aW5kb3cubG9jYXRpb24uaHJlZi5zcGxpdCgiIyEiKTsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24ucmVwbGFjZShsb2NbMF0gKyAiPyIgKwogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldHRpbmdzLmZvcmNlUmVsb2FkICsgIj0iICsgbG9jWzFdKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoY3VycmVudFZpZXcpIHsKICAgICAgICAgICAgICAgICAgICBjdXJyZW50Vmlldy5wYXJlbnROb2RlCiAgICAgICAgICAgICAgICAgICAgICAgIC5pbnNlcnRCZWZvcmUobmV3VmlldywgY3VycmVudFZpZXcpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHRoaXMuc2V0dGluZ3MubWFpbldyYXBwcGVyU2VsZWN0b3IpCiAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmRDaGlsZChuZXdWaWV3KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy9lbHNlIGFzc3VtZSB0aGUgdmlldyBpcyBhbHJlYWR5IGluIHRoZSBtYXJrdXAKCiAgICAgICAgfSwKCiAgICAgICAgbWFrZVZpZXdDYWxsYmFjazE6IGZ1bmN0aW9uIChjb250cm9sbGVyLCBhY3Rpb24sIHBhcmFtcykgewoKICAgICAgICAgICAgaWYgKGNvbnRyb2xsZXIgJiYgY29udHJvbGxlclthY3Rpb25dKSB7CiAgICAgICAgICAgICAgICBjb250cm9sbGVyW2FjdGlvbl0uY2FsbChjb250cm9sbGVyLCBwYXJhbXMgfHwge30pOwogICAgICAgICAgICB9CgogICAgICAgIH0sCgogICAgICAgIG1ha2VWaWV3Q2FsbGJhY2s6IGZ1bmN0aW9uIChyb3V0ZSwgYWN0aW9uKSB7CgogICAgICAgICAgICB2YXIgc3BhID0gdGhpcywKICAgICAgICAgICAgICAgICRjb250ZXh0ID0gc3BhLiRjb250ZXh0LAogICAgICAgICAgICAgICAgc2V0dGluZ3MgPSBzcGEuc2V0dGluZ3MsCiAgICAgICAgICAgICAgICBhLCBjYlBhdGhzLCBjYWxsYmFjazsKCiAgICAgICAgICAgIGlmIChhY3Rpb24gJiYgIXJvdXRlW2FjdGlvbl0pIHsKCiAgICAgICAgICAgICAgICBpZiAoJGNvbnRleHQpIHsKCiAgICAgICAgICAgICAgICAgICAgaWYgKCRjb250ZXh0W3JvdXRlLnZpZXdNb2R1bGVdICYmICRjb250ZXh0W3JvdXRlLnZpZXdNb2R1bGVdW2FjdGlvbl0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGNvbnRleHRbcm91dGUudmlld01vZHVsZV1bYWN0aW9uXS5jYWxsKCRjb250ZXh0LCByb3V0ZS5wYXJhbVZhbHVlcyB8fCB7fSk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNiUGF0aHMgPSByb3V0ZVthY3Rpb25dLnNwbGl0KCIuIik7CgogICAgICAgICAgICBjYWxsYmFjayA9IHdpbmRvd1tjYlBhdGhzWzBdXTsKCiAgICAgICAgICAgIGZvciAoYSA9IDE7IGEgPCBjYlBhdGhzLmxlbmd0aDsgYSsrKSB7CgogICAgICAgICAgICAgICAgaWYgKGEgPT09IDEpIHsKICAgICAgICAgICAgICAgICAgICBzcGEgPSBjYWxsYmFjazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBjYWxsYmFjayA9IGNhbGxiYWNrW2NiUGF0aHNbYV1dOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoY2FsbGJhY2spIHsKICAgICAgICAgICAgICAgIGNhbGxiYWNrLmNhbGwoc3BhLCByb3V0ZS5wYXJhbVZhbHVlcyB8fCB7fSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgfSwKCiAgICAgICAgc2V0RG9jdW1lbnRUaXRsZTogZnVuY3Rpb24gKHJvdXRlKSB7CgogICAgICAgICAgICB2YXIgdGl0bGUgPSByb3V0ZS50aXRsZSwKICAgICAgICAgICAgICAgIGk7CgogICAgICAgICAgICBpZiAodGl0bGUgPT09ICIiKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCByb3V0ZS5wYXJhbXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIHRpdGxlID0gdGl0bGUucmVwbGFjZSgiOiIgKwogICAgICAgICAgICAgICAgICAgIHJvdXRlLnBhcmFtc1tpXSwKICAgICAgICAgICAgICAgICAgICByb3V0ZS5wYXJhbVZhbHVlc1tyb3V0ZS5wYXJhbXNbaV1dKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZG9jdW1lbnQudGl0bGUgPSB0aXRsZTsKCiAgICAgICAgfSwKCiAgICAgICAgY3JlYXRlRnJhZ21lbnQ6IGZ1bmN0aW9uIChodG1sU3RyKSB7CgogICAgICAgICAgICB2YXIgZnJhZyA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKSwKICAgICAgICAgICAgICAgIHRlbXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKCiAgICAgICAgICAgIHRlbXAuaW5uZXJIVE1MID0gaHRtbFN0cjsKCiAgICAgICAgICAgIHdoaWxlICh0ZW1wLmZpcnN0Q2hpbGQpIHsKICAgICAgICAgICAgICAgIGZyYWcuYXBwZW5kQ2hpbGQodGVtcC5maXJzdENoaWxkKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIGZyYWc7CiAgICAgICAgfSwKCiAgICAgICAgaGFzQW5pbWF0aW9uczogZnVuY3Rpb24gKCkgewoKICAgICAgICAgICAgdmFyIGFuaW1hdGlvbiA9IGZhbHNlLAogICAgICAgICAgICAgICAgZWxtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IiksCiAgICAgICAgICAgICAgICBhbmltYXRpb25zdHJpbmcgPSAnYW5pbWF0aW9uJywKICAgICAgICAgICAgICAgIGtleWZyYW1lcHJlZml4ID0gJycsCiAgICAgICAgICAgICAgICBkb21QcmVmaXhlcyA9ICdXZWJraXQgTW96IE8gbXMgS2h0bWwnLnNwbGl0KCcgJyksCiAgICAgICAgICAgICAgICBwZnggPSAnJywKICAgICAgICAgICAgICAgIGkgPSAwOwoKICAgICAgICAgICAgaWYgKGVsbS5zdHlsZS5hbmltYXRpb25OYW1lKSB7CiAgICAgICAgICAgICAgICBhbmltYXRpb24gPSB0cnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoYW5pbWF0aW9uID09PSBmYWxzZSkgewogICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGRvbVByZWZpeGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGVsbS5zdHlsZVtkb21QcmVmaXhlc1tpXSArICdBbmltYXRpb25OYW1lJ10gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgICAgICBwZnggPSBkb21QcmVmaXhlc1tpXTsKICAgICAgICAgICAgICAgICAgICAgICAgYW5pbWF0aW9uc3RyaW5nID0gcGZ4ICsgJ0FuaW1hdGlvbic7CiAgICAgICAgICAgICAgICAgICAgICAgIGtleWZyYW1lcHJlZml4ID0gJy0nICsgcGZ4LnRvTG93ZXJDYXNlKCkgKyAnLSc7CiAgICAgICAgICAgICAgICAgICAgICAgIGFuaW1hdGlvbiA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIGFuaW1hdGlvbjsKCiAgICAgICAgfSwKCiAgICAgICAgLyoKICAgICAgICBzdG9yZUFzeW5jQ29udGVudDogZnVuY3Rpb24gKGNvbnRlbnQpIHsKCiAgICAgICAgICAgIHRoaXMudmlld0NhY2hlLnVwZGF0ZVZpZXdzRnJvbUZyYWdtZW50KHRoaXMuc2V0dGluZ3Mudmlld1NlbGVjdG9yLCBjb250ZW50KTsKICAgICAgICB9LAoKICAgICAgICBsb2FkQXN5bmNDb250ZW50OiBmdW5jdGlvbiAodXJsLCBjYWxsYmFjaykgewoKICAgICAgICAgICAgY2FsbGJhY2sgPSBjYWxsYmFjayB8fCB0aGlzLnN0b3JlQXN5bmNDb250ZW50OwoKICAgICAgICAgICAgdmFyIG9SZXEgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKCiAgICAgICAgICAgIG9SZXEub25sb2FkID0gY2FsbGJhY2s7CiAgICAgICAgICAgIG9SZXEub3BlbigiZ2V0IiwgdXJsLCB0cnVlKTsKICAgICAgICAgICAgb1JlcS5zZW5kKCk7CiAgICAgICAgfSwKICAgICAgICAqLwoKICAgICAgICAvL2FycmF5IG9mIGFuaW1hdGlvbnMuIFRoZSBuYW1lcyBtYXRjaCB0aGUgQ1NTIGNsYXNzIHNvIG1ha2Ugc3VyZSB5b3UgaGF2ZSB0aGUgQ1NTIGZvciB0aGlzIGFuaW1hdGlvbiBvciB5b3Ugd2lsbCBiZSBkaXNzYXBvaW50ZWQuCiAgICAgICAgYW5pbWF0aW9uczogewogICAgICAgICAgICAic2xpZGUiOiAic2xpZGUiLAogICAgICAgICAgICAiZmFkZSI6ICJmYWRlIiwKICAgICAgICAgICAgImZsaXAiOiAiZmxpcCIKICAgICAgICB9LAoKICAgICAgICBzZXR0aW5nczogewogICAgICAgICAgICByb3V0ZXM6IFtdLAogICAgICAgICAgICB2aWV3U2VsZWN0b3I6ICIuY29udGVudC1wYW5lIiwKICAgICAgICAgICAgY3VycmVudENsYXNzOiAiY3VycmVudCIsCiAgICAgICAgICAgIG1haW5XcmFwcHBlclNlbGVjdG9yOiAibWFpbiIsCiAgICAgICAgICAgIE5vdEZvdW5kVmlldzogIm5vZm91bmRWaWV3IiwKICAgICAgICAgICAgTm90Rm91bmRSb3V0ZTogIjQwNCIsCiAgICAgICAgICAgIGRlZmF1bHRUaXRsZTogIkEgU2luZ2xlIFBhZ2UgQXBwbGljYXRpb24gd2l0aCBSb3V0ZXMiLAogICAgICAgICAgICB0aXRsZVNlbGVjdG9yOiAiLnZpZXctdGl0bGUiLAogICAgICAgICAgICBmb3JjZVJlbG9hZDogIl9mb3JjZV9yZWxvYWRfIiwKICAgICAgICAgICAgYXV0b1NldFRpdGxlOiB0cnVlLAogICAgICAgICAgICBwYXJzZURPTTogdHJ1ZSwKICAgICAgICAgICAgaW5pdFZpZXc6IHRydWUsCiAgICAgICAgICAgIGludG9BbmltYXRpb246IHRydWUsCiAgICAgICAgICAgIHZpZXdUcmFuc2l0aW9uOiAic2xpZGUiLAogICAgICAgICAgICBhc3luY1VybDogdW5kZWZpbmVkCiAgICAgICAgfQoKICAgIH07CgogICAgLy8gR2l2ZSB0aGUgaW5pdCBmdW5jdGlvbiB0aGUgc3BhIHByb3RvdHlwZSBmb3IgbGF0ZXIgaW5zdGFudGlhdGlvbgogICAgU1BBLmZuLmluaXQucHJvdG90eXBlID0gU1BBLmZuOwoKICAgIHJldHVybiAod2luZG93LlNQQSA9IFNQQSk7Cgp9KSh3aW5kb3cpOw==",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Sat, 08 Nov 2014 05:16:36 GMT",
                    "Content-Length": "21427",
                    "Date": "Sat, 08 Nov 2014 05:16:37 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}