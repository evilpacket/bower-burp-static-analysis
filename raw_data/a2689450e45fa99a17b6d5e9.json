{
    "url": "http://localhost:9999/openlayers/openlayers/examples/wps.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "DOM data manipulation (DOM-based)",
    "issueType": 5247488,
    "severity": "Information",
    "confidence": "Firm",
    "issueBackground": "DOM-based DOM data manipulation vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this to a data field within the DOM that is used within the visible UI or client-side application logic. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will modify the appearance or behavior of the client-side UI. An attacker may be able to leverage this to perform virtual defacement of the application, or possibly to induce the user to perform unintended actions.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based DOM data manipulation vulnerabilities is not to dynamically write to DOM data fields any data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from being stored. In general, this is best achieved by using a whitelist of permitted values.",
    "issueDetail": "The application may be vulnerable to DOM-based DOM data manipulation. Data is read from <b>window.location.href</b> and written to <b>the 'value' property of a DOM element</b> via the following statements:<ul><li>var url = window.location.href.split(\"?\")[0];</li><li>field.value = url.substr(0, url.lastIndexOf(\"/\")+1) + \"data/tazdem.tiff\";</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/openlayers/openlayers/examples/wps.js",
                "path": "/openlayers/openlayers/examples/wps.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9vcGVubGF5ZXJzL29wZW5sYXllcnMvZXhhbXBsZXMvd3BzLmpzIEhUVFAvMS4xDQpIb3N0OiBsb2NhbGhvc3Q6OTk5OQ0KDQo=",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMTI0MTQNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IEZyaSwgMDcgTm92IDIwMTQgMjE6MjM6MjkgR01UDQpMYXN0LU1vZGlmaWVkOiBGcmksIDA3IE5vdiAyMDE0IDIxOjIzOjI4IEdNVA0KDQpPcGVuTGF5ZXJzLlByb3h5SG9zdCA9ICJwcm94eS5jZ2k/dXJsPSI7Cgp2YXIgd3BzID0gImh0dHA6Ly9kZW1vLm9wZW5nZW8ub3JnL2dlb3NlcnZlci93cHMiLAogICAgY2FwYWJpbGl0aWVzLCAvLyB0aGUgY2FwYWJpbGl0aWVzLCByZWFkIGJ5IEZvcm1hdC5XUFNDYXBhYmlsaXRpZXM6OnJlYWQKICAgIHByb2Nlc3M7IC8vIHRoZSBwcm9jZXNzIGRlc2NyaXB0aW9uIGZyb20gRm9ybWF0LldQU0Rlc2NyaWJlUHJvY2Vzczo6cmVhZAoKLy8gZ2V0IHNvbWUgY2FwYWJpbGl0aWVzCmdldENhcGFiaWxpdGllcygpOwoKLy8gY3JlYXRlIHRoZSBVSQp2YXIgbGF5ZXIgPSBuZXcgT3BlbkxheWVycy5MYXllci5WZWN0b3IoIlNjcmF0Y2hwYWQiKTsKdmFyIHRvb2xiYXIgPSBuZXcgT3BlbkxheWVycy5Db250cm9sLkVkaXRpbmdUb29sYmFyKGxheWVyKTsKdG9vbGJhci5hZGRDb250cm9scyhbbmV3IE9wZW5MYXllcnMuQ29udHJvbC5Nb2RpZnlGZWF0dXJlKGxheWVyLCB7CiAgICB0aXRsZTogIlNlbGVjdCBmZWF0dXJlIgp9KV0pOwp2YXIgbWFwID0gbmV3IE9wZW5MYXllcnMuTWFwKCdtYXAnLCB7CiAgICBjb250cm9sczogWwogICAgICAgIHRvb2xiYXIsCiAgICAgICAgbmV3IE9wZW5MYXllcnMuQ29udHJvbC5ab29tUGFuZWwoKSwKICAgICAgICBuZXcgT3BlbkxheWVycy5Db250cm9sLlBhblBhbmVsKCkKICAgIF0sCiAgICBsYXllcnM6IFsKICAgICAgICBuZXcgT3BlbkxheWVycy5MYXllci5XTVMoCiAgICAgICAgICAgICJPU00iLCAiaHR0cDovL21hcHMub3Blbmdlby5vcmcvZ2Vvd2ViY2FjaGUvc2VydmljZS93bXMiLAogICAgICAgICAgICB7bGF5ZXJzOiAib3BlbnN0cmVldG1hcCIsIGZvcm1hdDogImltYWdlL3BuZyJ9CiAgICAgICAgKSwgbGF5ZXIKICAgIF0KfSk7Cm1hcC56b29tVG9NYXhFeHRlbnQoKTsKCi8vIGFkZCBiZWhhdmlvciB0byBodG1sIGVsZW1lbnRzCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwcm9jZXNzZXMiKS5vbmNoYW5nZSA9IGRlc2NyaWJlUHJvY2VzczsKCi8vIHVzaW5nIE9wZW5MYXllcnMuRm9ybWF0LldQU0NhcGFiaWxpdGllcyB0byByZWFkIHRoZSBjYXBhYmlsaXRpZXMKZnVuY3Rpb24gZ2V0Q2FwYWJpbGl0aWVzKCkgewogICAgT3BlbkxheWVycy5SZXF1ZXN0LkdFVCh7CiAgICAgICAgdXJsOiB3cHMsCiAgICAgICAgcGFyYW1zOiB7CiAgICAgICAgICAgICJTRVJWSUNFIjogIldQUyIsCiAgICAgICAgICAgICJSRVFVRVNUIjogIkdldENhcGFiaWxpdGllcyIKICAgICAgICB9LAogICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlc3BvbnNlKXsKICAgICAgICAgICAgY2FwYWJpbGl0aWVzID0gbmV3IE9wZW5MYXllcnMuRm9ybWF0LldQU0NhcGFiaWxpdGllcygpLnJlYWQoCiAgICAgICAgICAgICAgICByZXNwb25zZS5yZXNwb25zZVRleHQKICAgICAgICAgICAgKTsKICAgICAgICAgICAgdmFyIGRyb3Bkb3duID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInByb2Nlc3NlcyIpOwogICAgICAgICAgICB2YXIgb2ZmZXJpbmdzID0gY2FwYWJpbGl0aWVzLnByb2Nlc3NPZmZlcmluZ3MsIG9wdGlvbjsKICAgICAgICAgICAgLy8gcG9wdWxhdGUgdGhlIGRyb3Bkb3duCiAgICAgICAgICAgIGZvciAodmFyIHAgaW4gb2ZmZXJpbmdzKSB7CiAgICAgICAgICAgICAgICBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJvcHRpb24iKTsKICAgICAgICAgICAgICAgIG9wdGlvbi5pbm5lckhUTUwgPSBvZmZlcmluZ3NbcF0uaWRlbnRpZmllcjsKICAgICAgICAgICAgICAgIG9wdGlvbi52YWx1ZSA9IHA7CiAgICAgICAgICAgICAgICBkcm9wZG93bi5hcHBlbmRDaGlsZChvcHRpb24pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSk7Cn0KCi8vIHVzaW5nIE9wZW5MYXllcnMuRm9ybWF0LldQU0Rlc2NyaWJlUHJvY2VzcyB0byBnZXQgaW5mb3JtYXRpb24gYWJvdXQgYQovLyBwcm9jZXNzCmZ1bmN0aW9uIGRlc2NyaWJlUHJvY2VzcygpIHsKICAgIHZhciBzZWxlY3Rpb24gPSB0aGlzLm9wdGlvbnNbdGhpcy5zZWxlY3RlZEluZGV4XS52YWx1ZTsKICAgIE9wZW5MYXllcnMuUmVxdWVzdC5HRVQoewogICAgICAgIHVybDogd3BzLAogICAgICAgIHBhcmFtczogewogICAgICAgICAgICAiU0VSVklDRSI6ICJXUFMiLAogICAgICAgICAgICAiUkVRVUVTVCI6ICJEZXNjcmliZVByb2Nlc3MiLAogICAgICAgICAgICAiVkVSU0lPTiI6IGNhcGFiaWxpdGllcy52ZXJzaW9uLAogICAgICAgICAgICAiSURFTlRJRklFUiI6IHNlbGVjdGlvbgogICAgICAgIH0sCiAgICAgICAgc3VjY2VzczogZnVuY3Rpb24ocmVzcG9uc2UpIHsKICAgICAgICAgICAgcHJvY2VzcyA9IG5ldyBPcGVuTGF5ZXJzLkZvcm1hdC5XUFNEZXNjcmliZVByb2Nlc3MoKS5yZWFkKAogICAgICAgICAgICAgICAgcmVzcG9uc2UucmVzcG9uc2VUZXh0CiAgICAgICAgICAgICkucHJvY2Vzc0Rlc2NyaXB0aW9uc1tzZWxlY3Rpb25dOwogICAgICAgICAgICBidWlsZEZvcm0oKTsKICAgICAgICB9CiAgICB9KTsKfQoKLy8gZHluYW1pY2FsbHkgY3JlYXRlIGEgZm9ybSBmcm9tIHRoZSBwcm9jZXNzIGRlc2NyaXB0aW9uCmZ1bmN0aW9uIGJ1aWxkRm9ybSgpIHsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJhYnN0cmFjdCIpLmlubmVySFRNTCA9IHByb2Nlc3NbImFic3RyYWN0Il07CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaW5wdXQiKS5pbm5lckhUTUwgPSAiPGgzPklucHV0OjwvaDM+IjsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJvdXRwdXQiKS5pbm5lckhUTUwgPSAiIjsKCiAgICB2YXIgaW5wdXRzID0gcHJvY2Vzcy5kYXRhSW5wdXRzLCBzdXBwb3J0ZWQgPSB0cnVlLAogICAgICAgIHNsZCA9ICJ0ZXh0L3htbDsgc3VidHlwZT1zbGQvMS4wLjAiLAogICAgICAgIGlucHV0OwogICAgZm9yICh2YXIgaT0wLGlpPWlucHV0cy5sZW5ndGg7IGk8aWk7ICsraSkgewogICAgICAgIGlucHV0ID0gaW5wdXRzW2ldOwogICAgICAgIGlmIChpbnB1dC5jb21wbGV4RGF0YSkgewogICAgICAgICAgICB2YXIgZm9ybWF0cyA9IGlucHV0LmNvbXBsZXhEYXRhLnN1cHBvcnRlZC5mb3JtYXRzOwogICAgICAgICAgICBpZiAoZm9ybWF0c1siYXBwbGljYXRpb24vd2t0Il0pIHsKICAgICAgICAgICAgICAgIGFkZFdLVElucHV0KGlucHV0KTsKICAgICAgICAgICAgfSBlbHNlIGlmIChmb3JtYXRzWyJ0ZXh0L3htbDsgc3VidHlwZT13ZnMtY29sbGVjdGlvbi8xLjAiXSkgewogICAgICAgICAgICAgICAgYWRkV0ZTQ29sbGVjdGlvbklucHV0KGlucHV0KTsKICAgICAgICAgICAgfSBlbHNlIGlmIChmb3JtYXRzWyJpbWFnZS90aWZmIl0pIHsKICAgICAgICAgICAgICAgIGFkZFJhc3RlcklucHV0KGlucHV0KTsKICAgICAgICAgICAgfSBlbHNlIGlmIChmb3JtYXRzW3NsZF0pIHsKICAgICAgICAgICAgICAgIGFkZFhNTElucHV0KGlucHV0LCBzbGQpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgc3VwcG9ydGVkID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKGlucHV0LmJvdW5kaW5nQm94RGF0YSkgewogICAgICAgICAgICBhZGRCb3VuZGluZ0JveElucHV0KGlucHV0KTsKICAgICAgICB9IGVsc2UgaWYgKGlucHV0LmxpdGVyYWxEYXRhKSB7CiAgICAgICAgICAgIGFkZExpdGVyYWxJbnB1dChpbnB1dCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc3VwcG9ydGVkID0gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmIChpbnB1dC5taW5PY2N1cnMgPiAwKSB7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJpbnB1dCIpLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCIqICIpKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIGlmIChzdXBwb3J0ZWQpIHsKICAgICAgICB2YXIgZXhlY3V0ZUJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIpOwogICAgICAgIGV4ZWN1dGVCdXR0b24uaW5uZXJIVE1MID0gIkV4ZWN1dGUiOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJpbnB1dCIpLmFwcGVuZENoaWxkKGV4ZWN1dGVCdXR0b24pOwogICAgICAgIGV4ZWN1dGVCdXR0b24ub25jbGljayA9IGV4ZWN1dGU7CiAgICB9IGVsc2UgewogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJpbnB1dCIpLmlubmVySFRNTCA9ICc8c3BhbiBjbGFzcz0ibm90c3VwcG9ydGVkIj4nICsKICAgICAgICAgICAgIlNvcnJ5LCB0aGUgV1BTIGJ1aWxkZXIgZG9lcyBub3Qgc3VwcG9ydCB0aGUgc2VsZWN0ZWQgcHJvY2Vzcy4iICsKICAgICAgICAgICAgIjwvc3Bhbj4iOwogICAgfQp9CgovLyBoZWxwZXIgZnVuY3Rpb24gdG8gZHluYW1pY2FsbHkgY3JlYXRlIGEgdGV4dGFyZWEgZm9yIGdlb21ldHJ5IChXS1QpIGRhdGEKLy8gaW5wdXQKZnVuY3Rpb24gYWRkV0tUSW5wdXQoaW5wdXQsIHByZXZpb3VzU2libGluZykgewogICAgdmFyIG5hbWUgPSBpbnB1dC5pZGVudGlmaWVyOwogICAgdmFyIGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJpbnB1dCIpOwogICAgdmFyIGxhYmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgibGFiZWwiKTsKICAgIGxhYmVsWyJmb3IiXSA9IG5hbWU7CiAgICBsYWJlbC50aXRsZSA9IGlucHV0WyJhYnN0cmFjdCJdOwogICAgbGFiZWwuaW5uZXJIVE1MID0gbmFtZSArICIgKHNlbGVjdCBmZWF0dXJlLCB0aGVuIGNsaWNrIGZpZWxkKToiOwogICAgcHJldmlvdXNTaWJsaW5nICYmIHByZXZpb3VzU2libGluZy5uZXh0U2libGluZyA/CiAgICAgICAgY29udGFpbmVyLmluc2VydEJlZm9yZShsYWJlbCwgcHJldmlvdXNTaWJsaW5nLm5leHRTaWJsaW5nKSA6CiAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGxhYmVsKTsKICAgIHZhciBmaWVsZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRleHRhcmVhIik7CiAgICBmaWVsZC5vbmNsaWNrID0gZnVuY3Rpb24gKCkgewogICAgICAgIGlmIChsYXllci5zZWxlY3RlZEZlYXR1cmVzLmxlbmd0aCkgewogICAgICAgICAgICB0aGlzLmlubmVySFRNTCA9IG5ldyBPcGVuTGF5ZXJzLkZvcm1hdC5XS1QoKS53cml0ZSgKICAgICAgICAgICAgICAgIGxheWVyLnNlbGVjdGVkRmVhdHVyZXNbMF0KICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgY3JlYXRlQ29weShpbnB1dCwgdGhpcywgYWRkV0tUSW5wdXQpOwogICAgfTsKICAgIGZpZWxkLm9uYmx1ciA9IGZ1bmN0aW9uKCkgewogICAgICAgIGlucHV0LmRhdGEgPSBmaWVsZC52YWx1ZSA/IHsKICAgICAgICAgICAgY29tcGxleERhdGE6IHsKICAgICAgICAgICAgICAgIG1pbWVUeXBlOiAiYXBwbGljYXRpb24vd2t0IiwKICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLnZhbHVlCiAgICAgICAgICAgIH0KICAgICAgICB9IDogdW5kZWZpbmVkOwogICAgfTsKICAgIGZpZWxkLnRpdGxlID0gaW5wdXRbImFic3RyYWN0Il07CiAgICBmaWVsZC5pZCA9IG5hbWU7CiAgICBwcmV2aW91c1NpYmxpbmcgJiYgcHJldmlvdXNTaWJsaW5nLm5leHRTaWJsaW5nID8KICAgICAgICBjb250YWluZXIuaW5zZXJ0QmVmb3JlKGZpZWxkLCBwcmV2aW91c1NpYmxpbmcubmV4dFNpYmxpbmcubmV4dFNpYmxpbmcpIDoKICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoZmllbGQpOwp9CgovLyBoZWxwZXIgZnVuY3Rpb24gZm9yIHhtbCBpbnB1dApmdW5jdGlvbiBhZGRYTUxJbnB1dChpbnB1dCwgdHlwZSkgewogICAgdmFyIG5hbWUgPSBpbnB1dC5pZGVudGlmaWVyOwogICAgdmFyIGZpZWxkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaW5wdXQiKTsKICAgIGZpZWxkLnRpdGxlID0gaW5wdXRbImFic3RyYWN0Il07CiAgICBmaWVsZC52YWx1ZSA9IG5hbWUgKyAiICgiICsgdHlwZSArICIpIjsKICAgIGZpZWxkLm9uYmx1ciA9IGZ1bmN0aW9uKCkgewogICAgICAgIGlucHV0LmRhdGEgPSBmaWVsZC52YWx1ZSA/IHsKICAgICAgICAgICAgY29tcGxleERhdGE6IHsKICAgICAgICAgICAgICAgIG1pbWVUeXBlOiB0eXBlLAogICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMudmFsdWUKICAgICAgICAgICAgfQogICAgICAgIH0gOiB1bmRlZmluZWQ7CiAgICB9OwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImlucHV0IikuYXBwZW5kQ2hpbGQoZmllbGQpOwp9CgovLyBoZWxwZXIgZnVuY3Rpb24gdG8gZHluYW1pY2FsbHkgY3JlYXRlIGEgV0ZTIGNvbGxlY3Rpb24gcmVmZXJlbmNlIGlucHV0CmZ1bmN0aW9uIGFkZFdGU0NvbGxlY3Rpb25JbnB1dChpbnB1dCkgewogICAgdmFyIG5hbWUgPSBpbnB1dC5pZGVudGlmaWVyOwogICAgdmFyIGZpZWxkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaW5wdXQiKTsKICAgIGZpZWxkLnRpdGxlID0gaW5wdXRbImFic3RyYWN0Il07CiAgICBmaWVsZC52YWx1ZSA9IG5hbWUgKyAiIChsYXllciBvbiBkZW1vIHNlcnZlcikiOwogICAgYWRkVmFsdWVIYW5kbGVycyhmaWVsZCwgZnVuY3Rpb24oKSB7CiAgICAgICAgaW5wdXQucmVmZXJlbmNlID0gZmllbGQudmFsdWUgPyB7CiAgICAgICAgICAgIG1pbWVUeXBlOiAidGV4dC94bWw7IHN1YnR5cGU9d2ZzLWNvbGxlY3Rpb24vMS4wIiwKICAgICAgICAgICAgaHJlZjogImh0dHA6Ly9nZW9zZXJ2ZXIvd2ZzIiwKICAgICAgICAgICAgbWV0aG9kOiAiUE9TVCIsCiAgICAgICAgICAgIGJvZHk6IHsKICAgICAgICAgICAgICAgIHdmczogewogICAgICAgICAgICAgICAgICAgIHZlcnNpb246ICIxLjAuMCIsCiAgICAgICAgICAgICAgICAgICAgb3V0cHV0Rm9ybWF0OiAiR01MMiIsCiAgICAgICAgICAgICAgICAgICAgZmVhdHVyZVR5cGU6IGZpZWxkLnZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IDogdW5kZWZpbmVkOwogICAgfSk7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaW5wdXQiKS5hcHBlbmRDaGlsZChmaWVsZCk7Cn0KCi8vIGhlbHBlciBmdW5jdGlvbiB0byBkeW5hbWljYWxseSBjcmVhdGUgYSByYXN0ZXIgKEdlb1RJRkYpIHVybCBpbnB1dApmdW5jdGlvbiBhZGRSYXN0ZXJJbnB1dChpbnB1dCkgewogICAgdmFyIG5hbWUgPSBpbnB1dC5pZGVudGlmaWVyOwogICAgdmFyIGZpZWxkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaW5wdXQiKTsKICAgIGZpZWxkLnRpdGxlID0gaW5wdXRbImFic3RyYWN0Il07CiAgICB2YXIgdXJsID0gd2luZG93LmxvY2F0aW9uLmhyZWYuc3BsaXQoIj8iKVswXTsKICAgIGZpZWxkLnZhbHVlID0gdXJsLnN1YnN0cigwLCB1cmwubGFzdEluZGV4T2YoIi8iKSsxKSArICJkYXRhL3RhemRlbS50aWZmIjsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJpbnB1dCIpLmFwcGVuZENoaWxkKGZpZWxkKTsKICAgIChmaWVsZC5vbmJsdXIgPSBmdW5jdGlvbigpIHsKICAgICAgICBpbnB1dC5yZWZlcmVuY2UgPSB7CiAgICAgICAgICAgIG1pbWVUeXBlOiAiaW1hZ2UvdGlmZiIsCiAgICAgICAgICAgIGhyZWY6IGZpZWxkLnZhbHVlLAogICAgICAgICAgICBtZXRob2Q6ICJHRVQiCiAgICAgICAgfTsKICAgIH0pKCk7Cn0KCi8vIGhlbHBlciBmdW5jdGlvbiB0byBkeW5hbWljYWxseSBjcmVhdGUgYSBib3VuZGluZyBib3ggaW5wdXQKZnVuY3Rpb24gYWRkQm91bmRpbmdCb3hJbnB1dChpbnB1dCkgewogICAgdmFyIG5hbWUgPSBpbnB1dC5pZGVudGlmaWVyOwogICAgdmFyIGZpZWxkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaW5wdXQiKTsKICAgIGZpZWxkLnRpdGxlID0gaW5wdXRbImFic3RyYWN0Il07CiAgICBmaWVsZC52YWx1ZSA9ICJsZWZ0LGJvdHRvbSxyaWdodCx0b3AgKEVQU0c6NDMyNikiOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImlucHV0IikuYXBwZW5kQ2hpbGQoZmllbGQpOwogICAgYWRkVmFsdWVIYW5kbGVycyhmaWVsZCwgZnVuY3Rpb24oKSB7CiAgICAgICAgaW5wdXQuYm91bmRpbmdCb3hEYXRhID0gewogICAgICAgICAgICBwcm9qZWN0aW9uOiAiRVBTRzo0MzI2IiwKICAgICAgICAgICAgYm91bmRzOiBPcGVuTGF5ZXJzLkJvdW5kcy5mcm9tU3RyaW5nKGZpZWxkLnZhbHVlKQogICAgICAgIH07CiAgICB9KTsKfQoKLy8gaGVscGVyIGZ1bmN0aW9uIHRvIGNyZWF0ZSBhIGxpdGVyYWwgaW5wdXQgdGV4dGZpZWxkIG9yIGRyb3Bkb3duCmZ1bmN0aW9uIGFkZExpdGVyYWxJbnB1dChpbnB1dCwgcHJldmlvdXNTaWJsaW5nKSB7CiAgICB2YXIgbmFtZSA9IGlucHV0LmlkZW50aWZpZXI7CiAgICB2YXIgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImlucHV0Iik7CiAgICB2YXIgYW55VmFsdWUgPSBpbnB1dC5saXRlcmFsRGF0YS5hbnlWYWx1ZTsKICAgIC8vIGFueVZhbHVlIG1lYW5zIHRleHRmaWVsZCwgb3RoZXJ3aXNlIHdlIGNyZWF0ZSBhIGRyb3Bkb3duCiAgICB2YXIgZmllbGQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KGFueVZhbHVlID8gImlucHV0IiA6ICJzZWxlY3QiKTsKICAgIGZpZWxkLmlkID0gbmFtZTsKICAgIGZpZWxkLnRpdGxlID0gaW5wdXRbImFic3RyYWN0Il07CiAgICBwcmV2aW91c1NpYmxpbmcgJiYgcHJldmlvdXNTaWJsaW5nLm5leHRTaWJsaW5nID8KICAgICAgICBjb250YWluZXIuaW5zZXJ0QmVmb3JlKGZpZWxkLCBwcmV2aW91c1NpYmxpbmcubmV4dFNpYmxpbmcpIDoKICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoZmllbGQpOwogICAgaWYgKGFueVZhbHVlKSB7CiAgICAgICAgdmFyIGRhdGFUeXBlID0gaW5wdXQubGl0ZXJhbERhdGEuZGF0YVR5cGU7CiAgICAgICAgZmllbGQudmFsdWUgPSBuYW1lICsgKGRhdGFUeXBlID8gIiAoIiArIGRhdGFUeXBlICsgIikiIDogIiIpOwogICAgICAgIGFkZFZhbHVlSGFuZGxlcnMoZmllbGQsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICBpbnB1dC5kYXRhID0gZmllbGQudmFsdWUgPyB7CiAgICAgICAgICAgICAgICBsaXRlcmFsRGF0YTogewogICAgICAgICAgICAgICAgICAgIHZhbHVlOiBmaWVsZC52YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IDogdW5kZWZpbmVkOwogICAgICAgICAgICBjcmVhdGVDb3B5KGlucHV0LCBmaWVsZCwgYWRkTGl0ZXJhbElucHV0KTsKICAgICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIG9wdGlvbjsKICAgICAgICBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJvcHRpb24iKTsKICAgICAgICBvcHRpb24uaW5uZXJIVE1MID0gbmFtZTsKICAgICAgICBmaWVsZC5hcHBlbmRDaGlsZChvcHRpb24pOwogICAgICAgIGZvciAodmFyIHYgaW4gaW5wdXQubGl0ZXJhbERhdGEuYWxsb3dlZFZhbHVlcykgewogICAgICAgICAgICBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJvcHRpb24iKTsKICAgICAgICAgICAgb3B0aW9uLnZhbHVlID0gdjsKICAgICAgICAgICAgb3B0aW9uLmlubmVySFRNTCA9IHY7CiAgICAgICAgICAgIGZpZWxkLmFwcGVuZENoaWxkKG9wdGlvbik7CiAgICAgICAgfQogICAgICAgIGZpZWxkLm9uY2hhbmdlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGNyZWF0ZUNvcHkoaW5wdXQsIGZpZWxkLCBhZGRMaXRlcmFsSW5wdXQpOwogICAgICAgICAgICBpbnB1dC5kYXRhID0gdGhpcy5zZWxlY3RlZEluZGV4ID8gewogICAgICAgICAgICAgICAgbGl0ZXJhbERhdGE6IHsKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5vcHRpb25zW3RoaXMuc2VsZWN0ZWRJbmRleF0udmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSA6IHVuZGVmaW5lZDsKICAgICAgICB9OwogICAgfQp9CgovLyBpZiBtYXhPY2N1cnMgaXMgPiAxLCB0aGlzIHdpbGwgYWRkIGEgY29weSBvZiB0aGUgZmllbGQKZnVuY3Rpb24gY3JlYXRlQ29weShpbnB1dCwgZmllbGQsIGZuKSB7CiAgICBpZiAoaW5wdXQubWF4T2NjdXJzICYmIGlucHV0Lm1heE9jY3VycyA+IDEgJiYgIWZpZWxkLnVzZXJTZWxlY3RlZCkgewogICAgICAgIC8vIGFkZCBhbm90aGVyIGNvcHkgb2YgdGhlIGZpZWxkIC0gd2UgZG9uJ3QgY2hlY2sgbWF4T2NjdXJzCiAgICAgICAgZmllbGQudXNlclNlbGVjdGVkID0gdHJ1ZTsKICAgICAgICB2YXIgbmV3SW5wdXQgPSBPcGVuTGF5ZXJzLlV0aWwuZXh0ZW5kKHt9LCBpbnB1dCk7CiAgICAgICAgLy8gd2UgcmVjb2duaXplIGNvcGllcyBieSB0aGUgb2NjdXJyZW5jZSBwcm9wZXJ0eQogICAgICAgIG5ld0lucHV0Lm9jY3VycmVuY2UgPSAoaW5wdXQub2NjdXJyZW5jZSB8fCAwKSArIDE7CiAgICAgICAgcHJvY2Vzcy5kYXRhSW5wdXRzLnB1c2gobmV3SW5wdXQpOwogICAgICAgIGZuKG5ld0lucHV0LCBmaWVsZCk7CiAgICB9Cn0KCi8vIGhlbHBlciBmdW5jdGlvbiBmb3IgYWRkaW5nIGV2ZW50cyB0byBmb3JtIGZpZWxkcwpmdW5jdGlvbiBhZGRWYWx1ZUhhbmRsZXJzKGZpZWxkLCBvbmJsdXIpIHsKICAgIGZpZWxkLm9uY2xpY2sgPSBmdW5jdGlvbigpIHsKICAgICAgICBpZiAoIXRoaXMuaW5pdGlhbFZhbHVlKSB7CiAgICAgICAgICAgIHRoaXMuaW5pdGlhbFZhbHVlID0gdGhpcy52YWx1ZTsKICAgICAgICAgICAgdGhpcy52YWx1ZSA9ICIiOwogICAgICAgIH0KICAgIH07CiAgICBmaWVsZC5vbmJsdXIgPSBmdW5jdGlvbigpIHsKICAgICAgICBpZiAoIXRoaXMudmFsdWUpIHsKICAgICAgICAgICAgdGhpcy52YWx1ZSA9IHRoaXMuaW5pdGlhbFZhbHVlOwogICAgICAgICAgICBkZWxldGUgdGhpcy5pbml0aWFsVmFsdWU7CiAgICAgICAgfQogICAgICAgIG9uYmx1ci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgfTsKfQoKLy8gZXhlY3V0ZSB0aGUgcHJvY2VzcwpmdW5jdGlvbiBleGVjdXRlKCkgewogICAgdmFyIG91dHB1dCA9IHByb2Nlc3MucHJvY2Vzc091dHB1dHNbMF07CiAgICB2YXIgaW5wdXQ7CiAgICAvLyByZW1vdmUgb2NjdXJyZW5jZXMgdGhhdCB0aGUgdXNlciBoYXMgbm90IGZpbGxlZCBvdXQKICAgIGZvciAodmFyIGk9cHJvY2Vzcy5kYXRhSW5wdXRzLmxlbmd0aC0xOyBpPj0wOyAtLWkpIHsKICAgICAgICBpbnB1dCA9IHByb2Nlc3MuZGF0YUlucHV0c1tpXTsKICAgICAgICBpZiAoKGlucHV0Lm1pbk9jY3VycyA9PT0gMCB8fCBpbnB1dC5vY2N1cnJlbmNlKSAmJiAhaW5wdXQuZGF0YSAmJiAhaW5wdXQucmVmZXJlbmNlKSB7CiAgICAgICAgICAgIE9wZW5MYXllcnMuVXRpbC5yZW1vdmVJdGVtKHByb2Nlc3MuZGF0YUlucHV0cywgaW5wdXQpOwogICAgICAgIH0KICAgIH0KICAgIHByb2Nlc3MucmVzcG9uc2VGb3JtID0gewogICAgICAgIHJhd0RhdGFPdXRwdXQ6IHsKICAgICAgICAgICAgaWRlbnRpZmllcjogb3V0cHV0LmlkZW50aWZpZXIKICAgICAgICB9CiAgICB9OwogICAgaWYgKG91dHB1dC5jb21wbGV4T3V0cHV0ICYmIG91dHB1dC5jb21wbGV4T3V0cHV0LnN1cHBvcnRlZC5mb3JtYXRzWyJhcHBsaWNhdGlvbi93a3QiXSkgewogICAgICAgIHByb2Nlc3MucmVzcG9uc2VGb3JtLnJhd0RhdGFPdXRwdXQubWltZVR5cGUgPSAiYXBwbGljYXRpb24vd2t0IjsKICAgIH0KICAgIE9wZW5MYXllcnMuUmVxdWVzdC5QT1NUKHsKICAgICAgICB1cmw6IHdwcywKICAgICAgICBkYXRhOiBuZXcgT3BlbkxheWVycy5Gb3JtYXQuV1BTRXhlY3V0ZSgpLndyaXRlKHByb2Nlc3MpLAogICAgICAgIHN1Y2Nlc3M6IHNob3dPdXRwdXQKICAgIH0pOwp9CgovLyBhZGQgdGhlIHByb2Nlc3MncyBvdXRwdXQgdG8gdGhlIHBhZ2UKZnVuY3Rpb24gc2hvd091dHB1dChyZXNwb25zZSkgewogICAgdmFyIHJlc3VsdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJvdXRwdXQiKTsKICAgIHJlc3VsdC5pbm5lckhUTUwgPSAiPGgzPk91dHB1dDo8L2gzPiI7CiAgICB2YXIgZmVhdHVyZXM7CiAgICB2YXIgY29udGVudFR5cGUgPSByZXNwb25zZS5nZXRSZXNwb25zZUhlYWRlcigiQ29udGVudC1UeXBlIik7CiAgICBpZiAoY29udGVudFR5cGUgPT0gImFwcGxpY2F0aW9uL3drdCIpIHsKICAgICAgICBmZWF0dXJlcyA9IG5ldyBPcGVuTGF5ZXJzLkZvcm1hdC5XS1QoKS5yZWFkKHJlc3BvbnNlLnJlc3BvbnNlVGV4dCk7CiAgICB9IGVsc2UgaWYgKGNvbnRlbnRUeXBlID09ICJ0ZXh0L3htbDsgc3VidHlwZT13ZnMtY29sbGVjdGlvbi8xLjAiKSB7CiAgICAgICAgZmVhdHVyZXMgPSBuZXcgT3BlbkxheWVycy5Gb3JtYXQuV0ZTVC52MV8wXzAoKS5yZWFkKHJlc3BvbnNlLnJlc3BvbnNlVGV4dCk7CiAgICB9CiAgICBpZiAoZmVhdHVyZXMgJiYgKGZlYXR1cmVzIGluc3RhbmNlb2YgT3BlbkxheWVycy5GZWF0dXJlLlZlY3RvciB8fCBmZWF0dXJlcy5sZW5ndGgpKSB7CiAgICAgICAgbGF5ZXIuYWRkRmVhdHVyZXMoZmVhdHVyZXMpOwogICAgICAgIHJlc3VsdC5pbm5lckhUTUwgKz0gIlRoZSByZXN1bHQgc2hvdWxkIGFsc28gYmUgdmlzaWJsZSBvbiB0aGUgbWFwLiI7CiAgICB9CiAgICByZXN1bHQuaW5uZXJIVE1MICs9ICI8dGV4dGFyZWE+IiArIHJlc3BvbnNlLnJlc3BvbnNlVGV4dCArICI8L3RleHRhcmVhPiI7Cn0=",
                "body": "T3BlbkxheWVycy5Qcm94eUhvc3QgPSAicHJveHkuY2dpP3VybD0iOwoKdmFyIHdwcyA9ICJodHRwOi8vZGVtby5vcGVuZ2VvLm9yZy9nZW9zZXJ2ZXIvd3BzIiwKICAgIGNhcGFiaWxpdGllcywgLy8gdGhlIGNhcGFiaWxpdGllcywgcmVhZCBieSBGb3JtYXQuV1BTQ2FwYWJpbGl0aWVzOjpyZWFkCiAgICBwcm9jZXNzOyAvLyB0aGUgcHJvY2VzcyBkZXNjcmlwdGlvbiBmcm9tIEZvcm1hdC5XUFNEZXNjcmliZVByb2Nlc3M6OnJlYWQKCi8vIGdldCBzb21lIGNhcGFiaWxpdGllcwpnZXRDYXBhYmlsaXRpZXMoKTsKCi8vIGNyZWF0ZSB0aGUgVUkKdmFyIGxheWVyID0gbmV3IE9wZW5MYXllcnMuTGF5ZXIuVmVjdG9yKCJTY3JhdGNocGFkIik7CnZhciB0b29sYmFyID0gbmV3IE9wZW5MYXllcnMuQ29udHJvbC5FZGl0aW5nVG9vbGJhcihsYXllcik7CnRvb2xiYXIuYWRkQ29udHJvbHMoW25ldyBPcGVuTGF5ZXJzLkNvbnRyb2wuTW9kaWZ5RmVhdHVyZShsYXllciwgewogICAgdGl0bGU6ICJTZWxlY3QgZmVhdHVyZSIKfSldKTsKdmFyIG1hcCA9IG5ldyBPcGVuTGF5ZXJzLk1hcCgnbWFwJywgewogICAgY29udHJvbHM6IFsKICAgICAgICB0b29sYmFyLAogICAgICAgIG5ldyBPcGVuTGF5ZXJzLkNvbnRyb2wuWm9vbVBhbmVsKCksCiAgICAgICAgbmV3IE9wZW5MYXllcnMuQ29udHJvbC5QYW5QYW5lbCgpCiAgICBdLAogICAgbGF5ZXJzOiBbCiAgICAgICAgbmV3IE9wZW5MYXllcnMuTGF5ZXIuV01TKAogICAgICAgICAgICAiT1NNIiwgImh0dHA6Ly9tYXBzLm9wZW5nZW8ub3JnL2dlb3dlYmNhY2hlL3NlcnZpY2Uvd21zIiwKICAgICAgICAgICAge2xheWVyczogIm9wZW5zdHJlZXRtYXAiLCBmb3JtYXQ6ICJpbWFnZS9wbmcifQogICAgICAgICksIGxheWVyCiAgICBdCn0pOwptYXAuem9vbVRvTWF4RXh0ZW50KCk7CgovLyBhZGQgYmVoYXZpb3IgdG8gaHRtbCBlbGVtZW50cwpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicHJvY2Vzc2VzIikub25jaGFuZ2UgPSBkZXNjcmliZVByb2Nlc3M7CgovLyB1c2luZyBPcGVuTGF5ZXJzLkZvcm1hdC5XUFNDYXBhYmlsaXRpZXMgdG8gcmVhZCB0aGUgY2FwYWJpbGl0aWVzCmZ1bmN0aW9uIGdldENhcGFiaWxpdGllcygpIHsKICAgIE9wZW5MYXllcnMuUmVxdWVzdC5HRVQoewogICAgICAgIHVybDogd3BzLAogICAgICAgIHBhcmFtczogewogICAgICAgICAgICAiU0VSVklDRSI6ICJXUFMiLAogICAgICAgICAgICAiUkVRVUVTVCI6ICJHZXRDYXBhYmlsaXRpZXMiCiAgICAgICAgfSwKICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihyZXNwb25zZSl7CiAgICAgICAgICAgIGNhcGFiaWxpdGllcyA9IG5ldyBPcGVuTGF5ZXJzLkZvcm1hdC5XUFNDYXBhYmlsaXRpZXMoKS5yZWFkKAogICAgICAgICAgICAgICAgcmVzcG9uc2UucmVzcG9uc2VUZXh0CiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHZhciBkcm9wZG93biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwcm9jZXNzZXMiKTsKICAgICAgICAgICAgdmFyIG9mZmVyaW5ncyA9IGNhcGFiaWxpdGllcy5wcm9jZXNzT2ZmZXJpbmdzLCBvcHRpb247CiAgICAgICAgICAgIC8vIHBvcHVsYXRlIHRoZSBkcm9wZG93bgogICAgICAgICAgICBmb3IgKHZhciBwIGluIG9mZmVyaW5ncykgewogICAgICAgICAgICAgICAgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgib3B0aW9uIik7CiAgICAgICAgICAgICAgICBvcHRpb24uaW5uZXJIVE1MID0gb2ZmZXJpbmdzW3BdLmlkZW50aWZpZXI7CiAgICAgICAgICAgICAgICBvcHRpb24udmFsdWUgPSBwOwogICAgICAgICAgICAgICAgZHJvcGRvd24uYXBwZW5kQ2hpbGQob3B0aW9uKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0pOwp9CgovLyB1c2luZyBPcGVuTGF5ZXJzLkZvcm1hdC5XUFNEZXNjcmliZVByb2Nlc3MgdG8gZ2V0IGluZm9ybWF0aW9uIGFib3V0IGEKLy8gcHJvY2VzcwpmdW5jdGlvbiBkZXNjcmliZVByb2Nlc3MoKSB7CiAgICB2YXIgc2VsZWN0aW9uID0gdGhpcy5vcHRpb25zW3RoaXMuc2VsZWN0ZWRJbmRleF0udmFsdWU7CiAgICBPcGVuTGF5ZXJzLlJlcXVlc3QuR0VUKHsKICAgICAgICB1cmw6IHdwcywKICAgICAgICBwYXJhbXM6IHsKICAgICAgICAgICAgIlNFUlZJQ0UiOiAiV1BTIiwKICAgICAgICAgICAgIlJFUVVFU1QiOiAiRGVzY3JpYmVQcm9jZXNzIiwKICAgICAgICAgICAgIlZFUlNJT04iOiBjYXBhYmlsaXRpZXMudmVyc2lvbiwKICAgICAgICAgICAgIklERU5USUZJRVIiOiBzZWxlY3Rpb24KICAgICAgICB9LAogICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlc3BvbnNlKSB7CiAgICAgICAgICAgIHByb2Nlc3MgPSBuZXcgT3BlbkxheWVycy5Gb3JtYXQuV1BTRGVzY3JpYmVQcm9jZXNzKCkucmVhZCgKICAgICAgICAgICAgICAgIHJlc3BvbnNlLnJlc3BvbnNlVGV4dAogICAgICAgICAgICApLnByb2Nlc3NEZXNjcmlwdGlvbnNbc2VsZWN0aW9uXTsKICAgICAgICAgICAgYnVpbGRGb3JtKCk7CiAgICAgICAgfQogICAgfSk7Cn0KCi8vIGR5bmFtaWNhbGx5IGNyZWF0ZSBhIGZvcm0gZnJvbSB0aGUgcHJvY2VzcyBkZXNjcmlwdGlvbgpmdW5jdGlvbiBidWlsZEZvcm0oKSB7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYWJzdHJhY3QiKS5pbm5lckhUTUwgPSBwcm9jZXNzWyJhYnN0cmFjdCJdOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImlucHV0IikuaW5uZXJIVE1MID0gIjxoMz5JbnB1dDo8L2gzPiI7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgib3V0cHV0IikuaW5uZXJIVE1MID0gIiI7CgogICAgdmFyIGlucHV0cyA9IHByb2Nlc3MuZGF0YUlucHV0cywgc3VwcG9ydGVkID0gdHJ1ZSwKICAgICAgICBzbGQgPSAidGV4dC94bWw7IHN1YnR5cGU9c2xkLzEuMC4wIiwKICAgICAgICBpbnB1dDsKICAgIGZvciAodmFyIGk9MCxpaT1pbnB1dHMubGVuZ3RoOyBpPGlpOyArK2kpIHsKICAgICAgICBpbnB1dCA9IGlucHV0c1tpXTsKICAgICAgICBpZiAoaW5wdXQuY29tcGxleERhdGEpIHsKICAgICAgICAgICAgdmFyIGZvcm1hdHMgPSBpbnB1dC5jb21wbGV4RGF0YS5zdXBwb3J0ZWQuZm9ybWF0czsKICAgICAgICAgICAgaWYgKGZvcm1hdHNbImFwcGxpY2F0aW9uL3drdCJdKSB7CiAgICAgICAgICAgICAgICBhZGRXS1RJbnB1dChpbnB1dCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZm9ybWF0c1sidGV4dC94bWw7IHN1YnR5cGU9d2ZzLWNvbGxlY3Rpb24vMS4wIl0pIHsKICAgICAgICAgICAgICAgIGFkZFdGU0NvbGxlY3Rpb25JbnB1dChpbnB1dCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZm9ybWF0c1siaW1hZ2UvdGlmZiJdKSB7CiAgICAgICAgICAgICAgICBhZGRSYXN0ZXJJbnB1dChpbnB1dCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZm9ybWF0c1tzbGRdKSB7CiAgICAgICAgICAgICAgICBhZGRYTUxJbnB1dChpbnB1dCwgc2xkKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHN1cHBvcnRlZCA9IGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChpbnB1dC5ib3VuZGluZ0JveERhdGEpIHsKICAgICAgICAgICAgYWRkQm91bmRpbmdCb3hJbnB1dChpbnB1dCk7CiAgICAgICAgfSBlbHNlIGlmIChpbnB1dC5saXRlcmFsRGF0YSkgewogICAgICAgICAgICBhZGRMaXRlcmFsSW5wdXQoaW5wdXQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHN1cHBvcnRlZCA9IGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAoaW5wdXQubWluT2NjdXJzID4gMCkgewogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaW5wdXQiKS5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgiKiAiKSk7CiAgICAgICAgfQogICAgfQogICAgCiAgICBpZiAoc3VwcG9ydGVkKSB7CiAgICAgICAgdmFyIGV4ZWN1dGVCdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJidXR0b24iKTsKICAgICAgICBleGVjdXRlQnV0dG9uLmlubmVySFRNTCA9ICJFeGVjdXRlIjsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaW5wdXQiKS5hcHBlbmRDaGlsZChleGVjdXRlQnV0dG9uKTsKICAgICAgICBleGVjdXRlQnV0dG9uLm9uY2xpY2sgPSBleGVjdXRlOwogICAgfSBlbHNlIHsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaW5wdXQiKS5pbm5lckhUTUwgPSAnPHNwYW4gY2xhc3M9Im5vdHN1cHBvcnRlZCI+JyArCiAgICAgICAgICAgICJTb3JyeSwgdGhlIFdQUyBidWlsZGVyIGRvZXMgbm90IHN1cHBvcnQgdGhlIHNlbGVjdGVkIHByb2Nlc3MuIiArCiAgICAgICAgICAgICI8L3NwYW4+IjsKICAgIH0KfQoKLy8gaGVscGVyIGZ1bmN0aW9uIHRvIGR5bmFtaWNhbGx5IGNyZWF0ZSBhIHRleHRhcmVhIGZvciBnZW9tZXRyeSAoV0tUKSBkYXRhCi8vIGlucHV0CmZ1bmN0aW9uIGFkZFdLVElucHV0KGlucHV0LCBwcmV2aW91c1NpYmxpbmcpIHsKICAgIHZhciBuYW1lID0gaW5wdXQuaWRlbnRpZmllcjsKICAgIHZhciBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaW5wdXQiKTsKICAgIHZhciBsYWJlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImxhYmVsIik7CiAgICBsYWJlbFsiZm9yIl0gPSBuYW1lOwogICAgbGFiZWwudGl0bGUgPSBpbnB1dFsiYWJzdHJhY3QiXTsKICAgIGxhYmVsLmlubmVySFRNTCA9IG5hbWUgKyAiIChzZWxlY3QgZmVhdHVyZSwgdGhlbiBjbGljayBmaWVsZCk6IjsKICAgIHByZXZpb3VzU2libGluZyAmJiBwcmV2aW91c1NpYmxpbmcubmV4dFNpYmxpbmcgPwogICAgICAgIGNvbnRhaW5lci5pbnNlcnRCZWZvcmUobGFiZWwsIHByZXZpb3VzU2libGluZy5uZXh0U2libGluZykgOgogICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChsYWJlbCk7CiAgICB2YXIgZmllbGQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZXh0YXJlYSIpOwogICAgZmllbGQub25jbGljayA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAobGF5ZXIuc2VsZWN0ZWRGZWF0dXJlcy5sZW5ndGgpIHsKICAgICAgICAgICAgdGhpcy5pbm5lckhUTUwgPSBuZXcgT3BlbkxheWVycy5Gb3JtYXQuV0tUKCkud3JpdGUoCiAgICAgICAgICAgICAgICBsYXllci5zZWxlY3RlZEZlYXR1cmVzWzBdCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIGNyZWF0ZUNvcHkoaW5wdXQsIHRoaXMsIGFkZFdLVElucHV0KTsKICAgIH07CiAgICBmaWVsZC5vbmJsdXIgPSBmdW5jdGlvbigpIHsKICAgICAgICBpbnB1dC5kYXRhID0gZmllbGQudmFsdWUgPyB7CiAgICAgICAgICAgIGNvbXBsZXhEYXRhOiB7CiAgICAgICAgICAgICAgICBtaW1lVHlwZTogImFwcGxpY2F0aW9uL3drdCIsCiAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy52YWx1ZQogICAgICAgICAgICB9CiAgICAgICAgfSA6IHVuZGVmaW5lZDsKICAgIH07CiAgICBmaWVsZC50aXRsZSA9IGlucHV0WyJhYnN0cmFjdCJdOwogICAgZmllbGQuaWQgPSBuYW1lOwogICAgcHJldmlvdXNTaWJsaW5nICYmIHByZXZpb3VzU2libGluZy5uZXh0U2libGluZyA/CiAgICAgICAgY29udGFpbmVyLmluc2VydEJlZm9yZShmaWVsZCwgcHJldmlvdXNTaWJsaW5nLm5leHRTaWJsaW5nLm5leHRTaWJsaW5nKSA6CiAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGZpZWxkKTsKfQoKLy8gaGVscGVyIGZ1bmN0aW9uIGZvciB4bWwgaW5wdXQKZnVuY3Rpb24gYWRkWE1MSW5wdXQoaW5wdXQsIHR5cGUpIHsKICAgIHZhciBuYW1lID0gaW5wdXQuaWRlbnRpZmllcjsKICAgIHZhciBmaWVsZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImlucHV0Iik7CiAgICBmaWVsZC50aXRsZSA9IGlucHV0WyJhYnN0cmFjdCJdOwogICAgZmllbGQudmFsdWUgPSBuYW1lICsgIiAoIiArIHR5cGUgKyAiKSI7CiAgICBmaWVsZC5vbmJsdXIgPSBmdW5jdGlvbigpIHsKICAgICAgICBpbnB1dC5kYXRhID0gZmllbGQudmFsdWUgPyB7CiAgICAgICAgICAgIGNvbXBsZXhEYXRhOiB7CiAgICAgICAgICAgICAgICBtaW1lVHlwZTogdHlwZSwKICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLnZhbHVlCiAgICAgICAgICAgIH0KICAgICAgICB9IDogdW5kZWZpbmVkOwogICAgfTsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJpbnB1dCIpLmFwcGVuZENoaWxkKGZpZWxkKTsKfQoKLy8gaGVscGVyIGZ1bmN0aW9uIHRvIGR5bmFtaWNhbGx5IGNyZWF0ZSBhIFdGUyBjb2xsZWN0aW9uIHJlZmVyZW5jZSBpbnB1dApmdW5jdGlvbiBhZGRXRlNDb2xsZWN0aW9uSW5wdXQoaW5wdXQpIHsKICAgIHZhciBuYW1lID0gaW5wdXQuaWRlbnRpZmllcjsKICAgIHZhciBmaWVsZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImlucHV0Iik7CiAgICBmaWVsZC50aXRsZSA9IGlucHV0WyJhYnN0cmFjdCJdOwogICAgZmllbGQudmFsdWUgPSBuYW1lICsgIiAobGF5ZXIgb24gZGVtbyBzZXJ2ZXIpIjsKICAgIGFkZFZhbHVlSGFuZGxlcnMoZmllbGQsIGZ1bmN0aW9uKCkgewogICAgICAgIGlucHV0LnJlZmVyZW5jZSA9IGZpZWxkLnZhbHVlID8gewogICAgICAgICAgICBtaW1lVHlwZTogInRleHQveG1sOyBzdWJ0eXBlPXdmcy1jb2xsZWN0aW9uLzEuMCIsCiAgICAgICAgICAgIGhyZWY6ICJodHRwOi8vZ2Vvc2VydmVyL3dmcyIsCiAgICAgICAgICAgIG1ldGhvZDogIlBPU1QiLAogICAgICAgICAgICBib2R5OiB7CiAgICAgICAgICAgICAgICB3ZnM6IHsKICAgICAgICAgICAgICAgICAgICB2ZXJzaW9uOiAiMS4wLjAiLAogICAgICAgICAgICAgICAgICAgIG91dHB1dEZvcm1hdDogIkdNTDIiLAogICAgICAgICAgICAgICAgICAgIGZlYXR1cmVUeXBlOiBmaWVsZC52YWx1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSA6IHVuZGVmaW5lZDsKICAgIH0pOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImlucHV0IikuYXBwZW5kQ2hpbGQoZmllbGQpOwp9CgovLyBoZWxwZXIgZnVuY3Rpb24gdG8gZHluYW1pY2FsbHkgY3JlYXRlIGEgcmFzdGVyIChHZW9USUZGKSB1cmwgaW5wdXQKZnVuY3Rpb24gYWRkUmFzdGVySW5wdXQoaW5wdXQpIHsKICAgIHZhciBuYW1lID0gaW5wdXQuaWRlbnRpZmllcjsKICAgIHZhciBmaWVsZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImlucHV0Iik7CiAgICBmaWVsZC50aXRsZSA9IGlucHV0WyJhYnN0cmFjdCJdOwogICAgdmFyIHVybCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmLnNwbGl0KCI/IilbMF07CiAgICBmaWVsZC52YWx1ZSA9IHVybC5zdWJzdHIoMCwgdXJsLmxhc3RJbmRleE9mKCIvIikrMSkgKyAiZGF0YS90YXpkZW0udGlmZiI7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaW5wdXQiKS5hcHBlbmRDaGlsZChmaWVsZCk7CiAgICAoZmllbGQub25ibHVyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgaW5wdXQucmVmZXJlbmNlID0gewogICAgICAgICAgICBtaW1lVHlwZTogImltYWdlL3RpZmYiLAogICAgICAgICAgICBocmVmOiBmaWVsZC52YWx1ZSwKICAgICAgICAgICAgbWV0aG9kOiAiR0VUIgogICAgICAgIH07CiAgICB9KSgpOwp9CgovLyBoZWxwZXIgZnVuY3Rpb24gdG8gZHluYW1pY2FsbHkgY3JlYXRlIGEgYm91bmRpbmcgYm94IGlucHV0CmZ1bmN0aW9uIGFkZEJvdW5kaW5nQm94SW5wdXQoaW5wdXQpIHsKICAgIHZhciBuYW1lID0gaW5wdXQuaWRlbnRpZmllcjsKICAgIHZhciBmaWVsZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImlucHV0Iik7CiAgICBmaWVsZC50aXRsZSA9IGlucHV0WyJhYnN0cmFjdCJdOwogICAgZmllbGQudmFsdWUgPSAibGVmdCxib3R0b20scmlnaHQsdG9wIChFUFNHOjQzMjYpIjsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJpbnB1dCIpLmFwcGVuZENoaWxkKGZpZWxkKTsKICAgIGFkZFZhbHVlSGFuZGxlcnMoZmllbGQsIGZ1bmN0aW9uKCkgewogICAgICAgIGlucHV0LmJvdW5kaW5nQm94RGF0YSA9IHsKICAgICAgICAgICAgcHJvamVjdGlvbjogIkVQU0c6NDMyNiIsCiAgICAgICAgICAgIGJvdW5kczogT3BlbkxheWVycy5Cb3VuZHMuZnJvbVN0cmluZyhmaWVsZC52YWx1ZSkKICAgICAgICB9OwogICAgfSk7Cn0KCi8vIGhlbHBlciBmdW5jdGlvbiB0byBjcmVhdGUgYSBsaXRlcmFsIGlucHV0IHRleHRmaWVsZCBvciBkcm9wZG93bgpmdW5jdGlvbiBhZGRMaXRlcmFsSW5wdXQoaW5wdXQsIHByZXZpb3VzU2libGluZykgewogICAgdmFyIG5hbWUgPSBpbnB1dC5pZGVudGlmaWVyOwogICAgdmFyIGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJpbnB1dCIpOwogICAgdmFyIGFueVZhbHVlID0gaW5wdXQubGl0ZXJhbERhdGEuYW55VmFsdWU7CiAgICAvLyBhbnlWYWx1ZSBtZWFucyB0ZXh0ZmllbGQsIG90aGVyd2lzZSB3ZSBjcmVhdGUgYSBkcm9wZG93bgogICAgdmFyIGZpZWxkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChhbnlWYWx1ZSA/ICJpbnB1dCIgOiAic2VsZWN0Iik7CiAgICBmaWVsZC5pZCA9IG5hbWU7CiAgICBmaWVsZC50aXRsZSA9IGlucHV0WyJhYnN0cmFjdCJdOwogICAgcHJldmlvdXNTaWJsaW5nICYmIHByZXZpb3VzU2libGluZy5uZXh0U2libGluZyA/CiAgICAgICAgY29udGFpbmVyLmluc2VydEJlZm9yZShmaWVsZCwgcHJldmlvdXNTaWJsaW5nLm5leHRTaWJsaW5nKSA6CiAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGZpZWxkKTsKICAgIGlmIChhbnlWYWx1ZSkgewogICAgICAgIHZhciBkYXRhVHlwZSA9IGlucHV0LmxpdGVyYWxEYXRhLmRhdGFUeXBlOwogICAgICAgIGZpZWxkLnZhbHVlID0gbmFtZSArIChkYXRhVHlwZSA/ICIgKCIgKyBkYXRhVHlwZSArICIpIiA6ICIiKTsKICAgICAgICBhZGRWYWx1ZUhhbmRsZXJzKGZpZWxkLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgaW5wdXQuZGF0YSA9IGZpZWxkLnZhbHVlID8gewogICAgICAgICAgICAgICAgbGl0ZXJhbERhdGE6IHsKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogZmllbGQudmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgY3JlYXRlQ29weShpbnB1dCwgZmllbGQsIGFkZExpdGVyYWxJbnB1dCk7CiAgICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICAgIHZhciBvcHRpb247CiAgICAgICAgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgib3B0aW9uIik7CiAgICAgICAgb3B0aW9uLmlubmVySFRNTCA9IG5hbWU7CiAgICAgICAgZmllbGQuYXBwZW5kQ2hpbGQob3B0aW9uKTsKICAgICAgICBmb3IgKHZhciB2IGluIGlucHV0LmxpdGVyYWxEYXRhLmFsbG93ZWRWYWx1ZXMpIHsKICAgICAgICAgICAgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgib3B0aW9uIik7CiAgICAgICAgICAgIG9wdGlvbi52YWx1ZSA9IHY7CiAgICAgICAgICAgIG9wdGlvbi5pbm5lckhUTUwgPSB2OwogICAgICAgICAgICBmaWVsZC5hcHBlbmRDaGlsZChvcHRpb24pOwogICAgICAgIH0KICAgICAgICBmaWVsZC5vbmNoYW5nZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBjcmVhdGVDb3B5KGlucHV0LCBmaWVsZCwgYWRkTGl0ZXJhbElucHV0KTsKICAgICAgICAgICAgaW5wdXQuZGF0YSA9IHRoaXMuc2VsZWN0ZWRJbmRleCA/IHsKICAgICAgICAgICAgICAgIGxpdGVyYWxEYXRhOiB7CiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMub3B0aW9uc1t0aGlzLnNlbGVjdGVkSW5kZXhdLnZhbHVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gOiB1bmRlZmluZWQ7CiAgICAgICAgfTsKICAgIH0KfQoKLy8gaWYgbWF4T2NjdXJzIGlzID4gMSwgdGhpcyB3aWxsIGFkZCBhIGNvcHkgb2YgdGhlIGZpZWxkCmZ1bmN0aW9uIGNyZWF0ZUNvcHkoaW5wdXQsIGZpZWxkLCBmbikgewogICAgaWYgKGlucHV0Lm1heE9jY3VycyAmJiBpbnB1dC5tYXhPY2N1cnMgPiAxICYmICFmaWVsZC51c2VyU2VsZWN0ZWQpIHsKICAgICAgICAvLyBhZGQgYW5vdGhlciBjb3B5IG9mIHRoZSBmaWVsZCAtIHdlIGRvbid0IGNoZWNrIG1heE9jY3VycwogICAgICAgIGZpZWxkLnVzZXJTZWxlY3RlZCA9IHRydWU7CiAgICAgICAgdmFyIG5ld0lucHV0ID0gT3BlbkxheWVycy5VdGlsLmV4dGVuZCh7fSwgaW5wdXQpOwogICAgICAgIC8vIHdlIHJlY29nbml6ZSBjb3BpZXMgYnkgdGhlIG9jY3VycmVuY2UgcHJvcGVydHkKICAgICAgICBuZXdJbnB1dC5vY2N1cnJlbmNlID0gKGlucHV0Lm9jY3VycmVuY2UgfHwgMCkgKyAxOwogICAgICAgIHByb2Nlc3MuZGF0YUlucHV0cy5wdXNoKG5ld0lucHV0KTsKICAgICAgICBmbihuZXdJbnB1dCwgZmllbGQpOwogICAgfQp9CgovLyBoZWxwZXIgZnVuY3Rpb24gZm9yIGFkZGluZyBldmVudHMgdG8gZm9ybSBmaWVsZHMKZnVuY3Rpb24gYWRkVmFsdWVIYW5kbGVycyhmaWVsZCwgb25ibHVyKSB7CiAgICBmaWVsZC5vbmNsaWNrID0gZnVuY3Rpb24oKSB7CiAgICAgICAgaWYgKCF0aGlzLmluaXRpYWxWYWx1ZSkgewogICAgICAgICAgICB0aGlzLmluaXRpYWxWYWx1ZSA9IHRoaXMudmFsdWU7CiAgICAgICAgICAgIHRoaXMudmFsdWUgPSAiIjsKICAgICAgICB9CiAgICB9OwogICAgZmllbGQub25ibHVyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgaWYgKCF0aGlzLnZhbHVlKSB7CiAgICAgICAgICAgIHRoaXMudmFsdWUgPSB0aGlzLmluaXRpYWxWYWx1ZTsKICAgICAgICAgICAgZGVsZXRlIHRoaXMuaW5pdGlhbFZhbHVlOwogICAgICAgIH0KICAgICAgICBvbmJsdXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIH07Cn0KCi8vIGV4ZWN1dGUgdGhlIHByb2Nlc3MKZnVuY3Rpb24gZXhlY3V0ZSgpIHsKICAgIHZhciBvdXRwdXQgPSBwcm9jZXNzLnByb2Nlc3NPdXRwdXRzWzBdOwogICAgdmFyIGlucHV0OwogICAgLy8gcmVtb3ZlIG9jY3VycmVuY2VzIHRoYXQgdGhlIHVzZXIgaGFzIG5vdCBmaWxsZWQgb3V0CiAgICBmb3IgKHZhciBpPXByb2Nlc3MuZGF0YUlucHV0cy5sZW5ndGgtMTsgaT49MDsgLS1pKSB7CiAgICAgICAgaW5wdXQgPSBwcm9jZXNzLmRhdGFJbnB1dHNbaV07CiAgICAgICAgaWYgKChpbnB1dC5taW5PY2N1cnMgPT09IDAgfHwgaW5wdXQub2NjdXJyZW5jZSkgJiYgIWlucHV0LmRhdGEgJiYgIWlucHV0LnJlZmVyZW5jZSkgewogICAgICAgICAgICBPcGVuTGF5ZXJzLlV0aWwucmVtb3ZlSXRlbShwcm9jZXNzLmRhdGFJbnB1dHMsIGlucHV0KTsKICAgICAgICB9CiAgICB9CiAgICBwcm9jZXNzLnJlc3BvbnNlRm9ybSA9IHsKICAgICAgICByYXdEYXRhT3V0cHV0OiB7CiAgICAgICAgICAgIGlkZW50aWZpZXI6IG91dHB1dC5pZGVudGlmaWVyCiAgICAgICAgfQogICAgfTsKICAgIGlmIChvdXRwdXQuY29tcGxleE91dHB1dCAmJiBvdXRwdXQuY29tcGxleE91dHB1dC5zdXBwb3J0ZWQuZm9ybWF0c1siYXBwbGljYXRpb24vd2t0Il0pIHsKICAgICAgICBwcm9jZXNzLnJlc3BvbnNlRm9ybS5yYXdEYXRhT3V0cHV0Lm1pbWVUeXBlID0gImFwcGxpY2F0aW9uL3drdCI7CiAgICB9CiAgICBPcGVuTGF5ZXJzLlJlcXVlc3QuUE9TVCh7CiAgICAgICAgdXJsOiB3cHMsCiAgICAgICAgZGF0YTogbmV3IE9wZW5MYXllcnMuRm9ybWF0LldQU0V4ZWN1dGUoKS53cml0ZShwcm9jZXNzKSwKICAgICAgICBzdWNjZXNzOiBzaG93T3V0cHV0CiAgICB9KTsKfQoKLy8gYWRkIHRoZSBwcm9jZXNzJ3Mgb3V0cHV0IHRvIHRoZSBwYWdlCmZ1bmN0aW9uIHNob3dPdXRwdXQocmVzcG9uc2UpIHsKICAgIHZhciByZXN1bHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgib3V0cHV0Iik7CiAgICByZXN1bHQuaW5uZXJIVE1MID0gIjxoMz5PdXRwdXQ6PC9oMz4iOwogICAgdmFyIGZlYXR1cmVzOwogICAgdmFyIGNvbnRlbnRUeXBlID0gcmVzcG9uc2UuZ2V0UmVzcG9uc2VIZWFkZXIoIkNvbnRlbnQtVHlwZSIpOwogICAgaWYgKGNvbnRlbnRUeXBlID09ICJhcHBsaWNhdGlvbi93a3QiKSB7CiAgICAgICAgZmVhdHVyZXMgPSBuZXcgT3BlbkxheWVycy5Gb3JtYXQuV0tUKCkucmVhZChyZXNwb25zZS5yZXNwb25zZVRleHQpOwogICAgfSBlbHNlIGlmIChjb250ZW50VHlwZSA9PSAidGV4dC94bWw7IHN1YnR5cGU9d2ZzLWNvbGxlY3Rpb24vMS4wIikgewogICAgICAgIGZlYXR1cmVzID0gbmV3IE9wZW5MYXllcnMuRm9ybWF0LldGU1QudjFfMF8wKCkucmVhZChyZXNwb25zZS5yZXNwb25zZVRleHQpOwogICAgfQogICAgaWYgKGZlYXR1cmVzICYmIChmZWF0dXJlcyBpbnN0YW5jZW9mIE9wZW5MYXllcnMuRmVhdHVyZS5WZWN0b3IgfHwgZmVhdHVyZXMubGVuZ3RoKSkgewogICAgICAgIGxheWVyLmFkZEZlYXR1cmVzKGZlYXR1cmVzKTsKICAgICAgICByZXN1bHQuaW5uZXJIVE1MICs9ICJUaGUgcmVzdWx0IHNob3VsZCBhbHNvIGJlIHZpc2libGUgb24gdGhlIG1hcC4iOwogICAgfQogICAgcmVzdWx0LmlubmVySFRNTCArPSAiPHRleHRhcmVhPiIgKyByZXNwb25zZS5yZXNwb25zZVRleHQgKyAiPC90ZXh0YXJlYT4iOwp9",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Fri, 07 Nov 2014 21:23:28 GMT",
                    "Content-Length": "12414",
                    "Date": "Fri, 07 Nov 2014 21:23:29 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}