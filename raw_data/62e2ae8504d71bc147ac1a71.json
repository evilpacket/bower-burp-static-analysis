{
    "url": "http://localhost:9999/angular/angular.js/test/ng/browserSpecs.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Cookie manipulation (DOM-based)",
    "issueType": 5245696,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based cookie manipulation vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the value of a cookie in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will set an arbitrary value in the user's cookie.<br><br>The potential impact of the vulnerability depends on the role that the cookie plays within the application. If the cookie is used to control the behavior that results from certain user actions (for example, a 'production' versus 'demo' mode setting), then the attacker may be able to cause the user to perform unintended actions by manipulating the cookie's value. If the cookie is used to track the user's session, then the attacker may be able to perform a session fixation attack, in which they set the cookie's value to a valid token that they have obtained from the application, and then hijack the session during the victim user's subsequent interaction with the application.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based cookie manipulation vulnerabilities is not to dynamically write to cookies using data that originated from any untrusted source. This behavior should never be implemented for cookies that have any role in controlling privileged actions or user sessions within the application.",
    "issueDetail": "The application may be vulnerable to DOM-based cookie manipulation. Data is read from <b>location.pathname</b> and written to <b>document.cookie</b> via the following statements:<ul><li>var path = location.pathname;</li><li>var parts = path.split('/');</li><li>document.cookie = name + \"=;path=\" + (parts.join('/') || '/') + \";expires=Thu, 01 Jan 1970 00:00:00 GMT\";</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/angular/angular.js/test/ng/browserSpecs.js",
                "path": "/angular/angular.js/test/ng/browserSpecs.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9hbmd1bGFyL2FuZ3VsYXIuanMvdGVzdC9uZy9icm93c2VyU3BlY3MuanMgSFRUUC8xLjENCkhvc3Q6IGxvY2FsaG9zdDo5OTk5DQoNCg==",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMzQ3NjYNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IFRodSwgMDYgTm92IDIwMTQgMDk6MTc6NDMgR01UDQpMYXN0LU1vZGlmaWVkOiBUaHUsIDA2IE5vdiAyMDE0IDA5OjE3OjM5IEdNVA0KDQondXNlIHN0cmljdCc7Cgp2YXIgaGlzdG9yeUVudHJpZXNMZW5ndGg7CnZhciBzbmlmZmVyID0ge307CgpmdW5jdGlvbiBNb2NrV2luZG93KG9wdGlvbnMpIHsKICBpZiAodHlwZW9mIG9wdGlvbnMgIT09ICdvYmplY3QnKSB7CiAgICBvcHRpb25zID0ge307CiAgfQogIHZhciBldmVudHMgPSB7fTsKICB2YXIgdGltZW91dHMgPSB0aGlzLnRpbWVvdXRzID0gW107CiAgdmFyIGxvY2F0aW9uSHJlZiA9ICdodHRwOi8vc2VydmVyLyc7CiAgdmFyIG1vY2tXaW5kb3cgPSB0aGlzOwogIHZhciBtc2llID0gb3B0aW9ucy5tc2llOwogIHZhciBpZVN0YXRlOwoKICBoaXN0b3J5RW50cmllc0xlbmd0aCA9IDE7CgogIHRoaXMuc2V0VGltZW91dCA9IGZ1bmN0aW9uKGZuKSB7CiAgICByZXR1cm4gdGltZW91dHMucHVzaChmbikgLSAxOwogIH07CgogIHRoaXMuY2xlYXJUaW1lb3V0ID0gZnVuY3Rpb24oaWQpIHsKICAgIHRpbWVvdXRzW2lkXSA9IG5vb3A7CiAgfTsKCiAgdGhpcy5zZXRUaW1lb3V0LmZsdXNoID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgbGVuZ3RoID0gdGltZW91dHMubGVuZ3RoOwogICAgd2hpbGUgKGxlbmd0aC0tID4gMCkgdGltZW91dHMuc2hpZnQoKSgpOwogIH07CgogIHRoaXMuYWRkRXZlbnRMaXN0ZW5lciA9IGZ1bmN0aW9uKG5hbWUsIGxpc3RlbmVyKSB7CiAgICBpZiAoYW5ndWxhci5pc1VuZGVmaW5lZChldmVudHNbbmFtZV0pKSBldmVudHNbbmFtZV0gPSBbXTsKICAgIGV2ZW50c1tuYW1lXS5wdXNoKGxpc3RlbmVyKTsKICB9OwoKICB0aGlzLnJlbW92ZUV2ZW50TGlzdGVuZXIgPSBub29wOwoKICB0aGlzLmZpcmUgPSBmdW5jdGlvbihuYW1lKSB7CiAgICBmb3JFYWNoKGV2ZW50c1tuYW1lXSwgZnVuY3Rpb24oZm4pIHsKICAgICAgZm4oe3R5cGU6IG5hbWV9KTsgLy8gdHlwZSB0byBtYWtlIGpRdWVyeSBoYXBweQogICAgfSk7CiAgfTsKCiAgdGhpcy5sb2NhdGlvbiA9IHsKICAgIGdldCBocmVmKCkgewogICAgICByZXR1cm4gbG9jYXRpb25IcmVmOwogICAgfSwKICAgIHNldCBocmVmKHZhbHVlKSB7CiAgICAgIGxvY2F0aW9uSHJlZiA9IHZhbHVlOwogICAgICBtb2NrV2luZG93Lmhpc3Rvcnkuc3RhdGUgPSBudWxsOwogICAgICBoaXN0b3J5RW50cmllc0xlbmd0aCsrOwogICAgfSwKICAgIHJlcGxhY2U6IGZ1bmN0aW9uKHVybCkgewogICAgICBsb2NhdGlvbkhyZWYgPSB1cmw7CiAgICAgIG1vY2tXaW5kb3cuaGlzdG9yeS5zdGF0ZSA9IG51bGw7CiAgICB9CiAgfTsKCiAgdGhpcy5oaXN0b3J5ID0gewogICAgcHVzaFN0YXRlOiBmdW5jdGlvbigpIHsKICAgICAgdGhpcy5yZXBsYWNlU3RhdGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgaGlzdG9yeUVudHJpZXNMZW5ndGgrKzsKICAgIH0sCiAgICByZXBsYWNlU3RhdGU6IGZ1bmN0aW9uKHN0YXRlLCB0aXRsZSwgdXJsKSB7CiAgICAgIGxvY2F0aW9uSHJlZiA9IHVybDsKICAgICAgbW9ja1dpbmRvdy5oaXN0b3J5LnN0YXRlID0gY29weShzdGF0ZSk7CiAgICB9CiAgfTsKICAvLyBJRSAxMC0xMSBkZXNlcmlhbGl6ZSBoaXN0b3J5LnN0YXRlIG9uIGVhY2ggcmVhZCBtYWtpbmcgc3Vic2VxdWVudCByZWFkcwogIC8vIGRpZmZlcmVudCBvYmplY3QuCiAgaWYgKCFtc2llKSB7CiAgICB0aGlzLmhpc3Rvcnkuc3RhdGUgPSBudWxsOwogIH0gZWxzZSB7CiAgICBpZVN0YXRlID0gbnVsbDsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLmhpc3RvcnksICdzdGF0ZScsIHsKICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gY29weShpZVN0YXRlKTsKICAgICAgfSwKICAgICAgc2V0OiBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgIGllU3RhdGUgPSB2YWx1ZTsKICAgICAgfSwKICAgICAgY29uZmlndXJhYmxlOiB0cnVlLAogICAgICBlbnVtZXJhYmxlOiB0cnVlCiAgICB9KTsKICB9Cn0KCmZ1bmN0aW9uIE1vY2tEb2N1bWVudCgpIHsKICB2YXIgc2VsZiA9IHRoaXM7CgogIHRoaXNbMF0gPSB3aW5kb3cuZG9jdW1lbnQ7CiAgdGhpcy5iYXNlUGF0aCA9ICcvJzsKCiAgdGhpcy5maW5kID0gZnVuY3Rpb24obmFtZSkgewogICAgaWYgKG5hbWUgPT0gJ2Jhc2UnKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgYXR0cjogZnVuY3Rpb24obmFtZSkgewogICAgICAgICAgaWYgKG5hbWUgPT0gJ2hyZWYnKSB7CiAgICAgICAgICAgIHJldHVybiBzZWxmLmJhc2VQYXRoOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKG5hbWUpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfTsKICAgIH0gZWxzZSB7CiAgICAgIHRocm93IG5ldyBFcnJvcihuYW1lKTsKICAgIH0KICB9Owp9CgpkZXNjcmliZSgnYnJvd3NlcicsIGZ1bmN0aW9uKCkgewogIC8qIGdsb2JhbCBCcm93c2VyOiBmYWxzZSAqLwogIHZhciBicm93c2VyLCBmYWtlV2luZG93LCBmYWtlRG9jdW1lbnQsIGZha2VMb2csIGxvZ3MsIHNjcmlwdHMsIHJlbW92ZWRTY3JpcHRzOwoKICBiZWZvcmVFYWNoKGZ1bmN0aW9uKCkgewogICAgc2NyaXB0cyA9IFtdOwogICAgcmVtb3ZlZFNjcmlwdHMgPSBbXTsKICAgIHNuaWZmZXIgPSB7aGlzdG9yeTogdHJ1ZX07CiAgICBmYWtlV2luZG93ID0gbmV3IE1vY2tXaW5kb3coKTsKICAgIGZha2VEb2N1bWVudCA9IG5ldyBNb2NrRG9jdW1lbnQoKTsKCiAgICBsb2dzID0ge2xvZzpbXSwgd2FybjpbXSwgaW5mbzpbXSwgZXJyb3I6W119OwoKICAgIHZhciBmYWtlTG9nID0ge2xvZzogZnVuY3Rpb24oKSB7IGxvZ3MubG9nLnB1c2goc2xpY2UuY2FsbChhcmd1bWVudHMpKTsgfSwKICAgICAgICAgICAgICAgICAgIHdhcm46IGZ1bmN0aW9uKCkgeyBsb2dzLndhcm4ucHVzaChzbGljZS5jYWxsKGFyZ3VtZW50cykpOyB9LAogICAgICAgICAgICAgICAgICAgaW5mbzogZnVuY3Rpb24oKSB7IGxvZ3MuaW5mby5wdXNoKHNsaWNlLmNhbGwoYXJndW1lbnRzKSk7IH0sCiAgICAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24oKSB7IGxvZ3MuZXJyb3IucHVzaChzbGljZS5jYWxsKGFyZ3VtZW50cykpOyB9fTsKCiAgICBicm93c2VyID0gbmV3IEJyb3dzZXIoZmFrZVdpbmRvdywgZmFrZURvY3VtZW50LCBmYWtlTG9nLCBzbmlmZmVyKTsKICB9KTsKCiAgZGVzY3JpYmUoJ01vY2tCcm93c2VyJywgZnVuY3Rpb24oKSB7CiAgICBkZXNjcmliZSgnaGlzdG9yeUVudHJpZXNMZW5ndGgnLCBmdW5jdGlvbigpIHsKICAgICAgaXQoJ3Nob3VsZCBpbmNyZW1lbnQgaGlzdG9yeUVudHJpZXNMZW5ndGggd2hlbiBzZXR0aW5nIGxvY2F0aW9uLmhyZWYnLCBmdW5jdGlvbigpIHsKICAgICAgICBleHBlY3QoaGlzdG9yeUVudHJpZXNMZW5ndGgpLnRvQmUoMSk7CiAgICAgICAgZmFrZVdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJy9mb28nOwogICAgICAgIGV4cGVjdChoaXN0b3J5RW50cmllc0xlbmd0aCkudG9CZSgyKTsKICAgICAgfSk7CgogICAgICBpdCgnc2hvdWxkIG5vdCBpbmNyZW1lbnQgaGlzdG9yeUVudHJpZXNMZW5ndGggd2hlbiB1c2luZyBsb2NhdGlvbi5yZXBsYWNlJywgZnVuY3Rpb24oKSB7CiAgICAgICAgZXhwZWN0KGhpc3RvcnlFbnRyaWVzTGVuZ3RoKS50b0JlKDEpOwogICAgICAgIGZha2VXaW5kb3cubG9jYXRpb24ucmVwbGFjZSgnL2ZvbycpOwogICAgICAgIGV4cGVjdChoaXN0b3J5RW50cmllc0xlbmd0aCkudG9CZSgxKTsKICAgICAgfSk7CgogICAgICBpdCgnc2hvdWxkIGluY3JlbWVudCBoaXN0b3J5RW50cmllc0xlbmd0aCB3aGVuIHVzaW5nIGhpc3RvcnkucHVzaFN0YXRlJywgZnVuY3Rpb24oKSB7CiAgICAgICAgZXhwZWN0KGhpc3RvcnlFbnRyaWVzTGVuZ3RoKS50b0JlKDEpOwogICAgICAgIGZha2VXaW5kb3cuaGlzdG9yeS5wdXNoU3RhdGUoe2E6IDJ9LCAnZm9vJywgJy9iYXInKTsKICAgICAgICBleHBlY3QoaGlzdG9yeUVudHJpZXNMZW5ndGgpLnRvQmUoMik7CiAgICAgIH0pOwoKICAgICAgaXQoJ3Nob3VsZCBub3QgaW5jcmVtZW50IGhpc3RvcnlFbnRyaWVzTGVuZ3RoIHdoZW4gdXNpbmcgaGlzdG9yeS5yZXBsYWNlU3RhdGUnLCBmdW5jdGlvbigpIHsKICAgICAgICBleHBlY3QoaGlzdG9yeUVudHJpZXNMZW5ndGgpLnRvQmUoMSk7CiAgICAgICAgZmFrZVdpbmRvdy5oaXN0b3J5LnJlcGxhY2VTdGF0ZSh7YTogMn0sICdmb28nLCAnL2JhcicpOwogICAgICAgIGV4cGVjdChoaXN0b3J5RW50cmllc0xlbmd0aCkudG9CZSgxKTsKICAgICAgfSk7CiAgICB9KTsKCiAgICBkZXNjcmliZSgnaW4gSUUnLCBydW5UZXN0cyh7bXNpZTogdHJ1ZX0pKTsKICAgIGRlc2NyaWJlKCdub3QgaW4gSUUnLCBydW5UZXN0cyh7bXNpZTogZmFsc2V9KSk7CgogICAgZnVuY3Rpb24gcnVuVGVzdHMob3B0aW9ucykgewogICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gdGhlIHNhbWUgc3RhdGUgb2JqZWN0IG9uIGV2ZXJ5IHJlYWQnLCBmdW5jdGlvbigpIHsKICAgICAgICAgIHZhciBtc2llID0gb3B0aW9ucy5tc2llOwoKICAgICAgICAgIGZha2VXaW5kb3cgPSBuZXcgTW9ja1dpbmRvdyh7bXNpZTogbXNpZX0pOwogICAgICAgICAgZmFrZVdpbmRvdy5sb2NhdGlvbi5zdGF0ZSA9IHtwcm9wOiAndmFsJ307CiAgICAgICAgICBicm93c2VyID0gbmV3IEJyb3dzZXIoZmFrZVdpbmRvdywgZmFrZURvY3VtZW50LCBmYWtlTG9nLCBzbmlmZmVyKTsKCiAgICAgICAgICBicm93c2VyLnVybChmYWtlV2luZG93LmxvY2F0aW9uLmhyZWYsIGZhbHNlLCB7cHJvcDogJ3ZhbCd9KTsKICAgICAgICAgIGlmIChtc2llKSB7CiAgICAgICAgICAgIGV4cGVjdChmYWtlV2luZG93Lmhpc3Rvcnkuc3RhdGUpLm5vdC50b0JlKGZha2VXaW5kb3cuaGlzdG9yeS5zdGF0ZSk7CiAgICAgICAgICAgIGV4cGVjdChmYWtlV2luZG93Lmhpc3Rvcnkuc3RhdGUpLnRvRXF1YWwoZmFrZVdpbmRvdy5oaXN0b3J5LnN0YXRlKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGV4cGVjdChmYWtlV2luZG93Lmhpc3Rvcnkuc3RhdGUpLnRvQmUoZmFrZVdpbmRvdy5oaXN0b3J5LnN0YXRlKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfTsKICAgIH0KICB9KTsKCiAgaXQoJ3Nob3VsZCBjb250YWluIGNvb2tpZSBjcnVuY2hlcicsIGZ1bmN0aW9uKCkgewogICAgZXhwZWN0KGJyb3dzZXIuY29va2llcykudG9CZURlZmluZWQoKTsKICB9KTsKCiAgZGVzY3JpYmUoJ291dHN0YWRpbmcgcmVxdWVzdHMnLCBmdW5jdGlvbigpIHsKICAgIGl0KCdzaG91bGQgcHJvY2VzcyBjYWxsYmFja3MgaW1tZWRpZXRseSB3aXRoIG5vIG91dHN0YW5kaW5nIHJlcXVlc3RzJywgZnVuY3Rpb24oKSB7CiAgICAgIHZhciBjYWxsYmFjayA9IGphc21pbmUuY3JlYXRlU3B5KCdjYWxsYmFjaycpOwogICAgICBicm93c2VyLm5vdGlmeVdoZW5Ob091dHN0YW5kaW5nUmVxdWVzdHMoY2FsbGJhY2spOwogICAgICBleHBlY3QoY2FsbGJhY2spLnRvSGF2ZUJlZW5DYWxsZWQoKTsKICAgIH0pOwogIH0pOwoKCiAgZGVzY3JpYmUoJ2RlZmVyJywgZnVuY3Rpb24oKSB7CiAgICBpdCgnc2hvdWxkIGV4ZWN1dGUgZm4gYXN5bmNocm9uaW91c2x5IHZpYSBzZXRUaW1lb3V0JywgZnVuY3Rpb24oKSB7CiAgICAgIHZhciBjYWxsYmFjayA9IGphc21pbmUuY3JlYXRlU3B5KCdkZWZlcnJlZCcpOwoKICAgICAgYnJvd3Nlci5kZWZlcihjYWxsYmFjayk7CiAgICAgIGV4cGVjdChjYWxsYmFjaykubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTsKCiAgICAgIGZha2VXaW5kb3cuc2V0VGltZW91dC5mbHVzaCgpOwogICAgICBleHBlY3QoY2FsbGJhY2spLnRvSGF2ZUJlZW5DYWxsZWRPbmNlKCk7CiAgICB9KTsKCgogICAgaXQoJ3Nob3VsZCB1cGRhdGUgb3V0c3RhbmRpbmdSZXF1ZXN0cyBjb3VudGVyJywgZnVuY3Rpb24oKSB7CiAgICAgIHZhciBjYWxsYmFjayA9IGphc21pbmUuY3JlYXRlU3B5KCdkZWZlcnJlZCcpOwoKICAgICAgYnJvd3Nlci5kZWZlcihjYWxsYmFjayk7CiAgICAgIGV4cGVjdChjYWxsYmFjaykubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTsKCiAgICAgIGZha2VXaW5kb3cuc2V0VGltZW91dC5mbHVzaCgpOwogICAgICBleHBlY3QoY2FsbGJhY2spLnRvSGF2ZUJlZW5DYWxsZWRPbmNlKCk7CiAgICB9KTsKCgogICAgaXQoJ3Nob3VsZCByZXR1cm4gdW5pcXVlIGRlZmVySWQnLCBmdW5jdGlvbigpIHsKICAgICAgdmFyIGRlZmVySWQxID0gYnJvd3Nlci5kZWZlcihub29wKSwKICAgICAgICAgIGRlZmVySWQyID0gYnJvd3Nlci5kZWZlcihub29wKTsKCiAgICAgIGV4cGVjdChkZWZlcklkMSkudG9CZURlZmluZWQoKTsKICAgICAgZXhwZWN0KGRlZmVySWQyKS50b0JlRGVmaW5lZCgpOwogICAgICBleHBlY3QoZGVmZXJJZDEpLm5vdC50b0VxdWFsKGRlZmVySWQyKTsKICAgIH0pOwoKCiAgICBkZXNjcmliZSgnY2FuY2VsJywgZnVuY3Rpb24oKSB7CiAgICAgIGl0KCdzaG91bGQgYWxsb3cgdGFza3MgdG8gYmUgY2FuY2VsZWQgd2l0aCByZXR1cm5lZCBkZWZlcklkJywgZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGxvZyA9IFtdLAogICAgICAgICAgICBkZWZlcklkMSA9IGJyb3dzZXIuZGVmZXIoZnVuY3Rpb24oKSB7IGxvZy5wdXNoKCdjYW5jZWwgbWUnKTsgfSksCiAgICAgICAgICAgIGRlZmVySWQyID0gYnJvd3Nlci5kZWZlcihmdW5jdGlvbigpIHsgbG9nLnB1c2goJ29rJyk7IH0pLAogICAgICAgICAgICBkZWZlcklkMyA9IGJyb3dzZXIuZGVmZXIoZnVuY3Rpb24oKSB7IGxvZy5wdXNoKCdjYW5jZWwgbWUsIG5vdyEnKTsgfSk7CgogICAgICAgIGV4cGVjdChsb2cpLnRvRXF1YWwoW10pOwogICAgICAgIGV4cGVjdChicm93c2VyLmRlZmVyLmNhbmNlbChkZWZlcklkMSkpLnRvQmUodHJ1ZSk7CiAgICAgICAgZXhwZWN0KGJyb3dzZXIuZGVmZXIuY2FuY2VsKGRlZmVySWQzKSkudG9CZSh0cnVlKTsKICAgICAgICBmYWtlV2luZG93LnNldFRpbWVvdXQuZmx1c2goKTsKICAgICAgICBleHBlY3QobG9nKS50b0VxdWFsKFsnb2snXSk7CiAgICAgICAgZXhwZWN0KGJyb3dzZXIuZGVmZXIuY2FuY2VsKGRlZmVySWQyKSkudG9CZShmYWxzZSk7CiAgICAgIH0pOwogICAgfSk7CiAgfSk7CgoKICBkZXNjcmliZSgnY29va2llcycsIGZ1bmN0aW9uKCkgewoKICAgIGZ1bmN0aW9uIGRlbGV0ZUFsbENvb2tpZXMoKSB7CiAgICAgIHZhciBjb29raWVzID0gZG9jdW1lbnQuY29va2llLnNwbGl0KCI7Iik7CiAgICAgIHZhciBwYXRoID0gbG9jYXRpb24ucGF0aG5hbWU7CgogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNvb2tpZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICB2YXIgY29va2llID0gY29va2llc1tpXTsKICAgICAgICB2YXIgZXFQb3MgPSBjb29raWUuaW5kZXhPZigiPSIpOwogICAgICAgIHZhciBuYW1lID0gZXFQb3MgPiAtMSA/IGNvb2tpZS5zdWJzdHIoMCwgZXFQb3MpIDogY29va2llOwogICAgICAgIHZhciBwYXJ0cyA9IHBhdGguc3BsaXQoJy8nKTsKICAgICAgICB3aGlsZSAocGFydHMubGVuZ3RoKSB7CiAgICAgICAgICBkb2N1bWVudC5jb29raWUgPSBuYW1lICsgIj07cGF0aD0iICsgKHBhcnRzLmpvaW4oJy8nKSB8fCAnLycpICsgIjtleHBpcmVzPVRodSwgMDEgSmFuIDE5NzAgMDA6MDA6MDAgR01UIjsKICAgICAgICAgIHBhcnRzLnBvcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIGJlZm9yZUVhY2goZnVuY3Rpb24oKSB7CiAgICAgIGRlbGV0ZUFsbENvb2tpZXMoKTsKICAgICAgZXhwZWN0KGRvY3VtZW50LmNvb2tpZSkudG9FcXVhbCgnJyk7CiAgICB9KTsKCgogICAgYWZ0ZXJFYWNoKGZ1bmN0aW9uKCkgewogICAgICBkZWxldGVBbGxDb29raWVzKCk7CiAgICAgIGV4cGVjdChkb2N1bWVudC5jb29raWUpLnRvRXF1YWwoJycpOwogICAgfSk7CgoKICAgIGRlc2NyaWJlKCdyZW1vdmUgYWxsIHZpYSAobnVsbCknLCBmdW5jdGlvbigpIHsKCiAgICAgIGl0KCdzaG91bGQgZG8gbm90aGluZyB3aGVuIG5vIGNvb2tpZXMgYXJlIHNldCcsIGZ1bmN0aW9uKCkgewogICAgICAgIGJyb3dzZXIuY29va2llcyhudWxsKTsKICAgICAgICBleHBlY3QoZG9jdW1lbnQuY29va2llKS50b0VxdWFsKCcnKTsKICAgICAgICBleHBlY3QoYnJvd3Nlci5jb29raWVzKCkpLnRvRXF1YWwoe30pOwogICAgICB9KTsKCiAgICB9KTsKCiAgICBkZXNjcmliZSgncmVtb3ZlIHZpYSBjb29raWVzKGNvb2tpZU5hbWUsIHVuZGVmaW5lZCknLCBmdW5jdGlvbigpIHsKCiAgICAgIGl0KCdzaG91bGQgcmVtb3ZlIGEgY29va2llIHdoZW4gaXQgaXMgcHJlc2VudCcsIGZ1bmN0aW9uKCkgewogICAgICAgIGRvY3VtZW50LmNvb2tpZSA9ICdmb289YmFyO3BhdGg9Lyc7CgogICAgICAgIGJyb3dzZXIuY29va2llcygnZm9vJywgdW5kZWZpbmVkKTsKCiAgICAgICAgZXhwZWN0KGRvY3VtZW50LmNvb2tpZSkudG9FcXVhbCgnJyk7CiAgICAgICAgZXhwZWN0KGJyb3dzZXIuY29va2llcygpKS50b0VxdWFsKHt9KTsKICAgICAgfSk7CgoKICAgICAgaXQoJ3Nob3VsZCBkbyBub3RoaW5nIHdoZW4gYW4gbm9uZXhpc3RpbmcgY29va2llIGlzIGJlaW5nIHJlbW92ZWQnLCBmdW5jdGlvbigpIHsKICAgICAgICBicm93c2VyLmNvb2tpZXMoJ2RvZXNudGV4aXN0JywgdW5kZWZpbmVkKTsKICAgICAgICBleHBlY3QoZG9jdW1lbnQuY29va2llKS50b0VxdWFsKCcnKTsKICAgICAgICBleHBlY3QoYnJvd3Nlci5jb29raWVzKCkpLnRvRXF1YWwoe30pOwogICAgICB9KTsKICAgIH0pOwoKCiAgICBkZXNjcmliZSgncHV0IHZpYSBjb29raWVzKGNvb2tpZU5hbWUsIHN0cmluZyknLCBmdW5jdGlvbigpIHsKCiAgICAgIGl0KCdzaG91bGQgY3JlYXRlIGFuZCBzdG9yZSBhIGNvb2tpZScsIGZ1bmN0aW9uKCkgewogICAgICAgIGJyb3dzZXIuY29va2llcygnY29va2llTmFtZScsICdjb29raWU9VmFsdWUnKTsKICAgICAgICBleHBlY3QoZG9jdW1lbnQuY29va2llKS50b01hdGNoKC9jb29raWVOYW1lPWNvb2tpZSUzRFZhbHVlOz8gPy8pOwogICAgICAgIGV4cGVjdChicm93c2VyLmNvb2tpZXMoKSkudG9FcXVhbCh7J2Nvb2tpZU5hbWUnOidjb29raWU9VmFsdWUnfSk7CiAgICAgIH0pOwoKCiAgICAgIGl0KCdzaG91bGQgb3ZlcndyaXRlIGFuIGV4aXN0aW5nIHVuc3luY2VkIGNvb2tpZScsIGZ1bmN0aW9uKCkgewogICAgICAgIGRvY3VtZW50LmNvb2tpZSA9ICJjb29raWU9bmV3O3BhdGg9LyI7CgogICAgICAgIHZhciBvbGRWYWwgPSBicm93c2VyLmNvb2tpZXMoJ2Nvb2tpZScsICduZXdlcicpOwoKICAgICAgICBleHBlY3QoZG9jdW1lbnQuY29va2llKS50b0VxdWFsKCdjb29raWU9bmV3ZXInKTsKICAgICAgICBleHBlY3QoYnJvd3Nlci5jb29raWVzKCkpLnRvRXF1YWwoeydjb29raWUnOiduZXdlcid9KTsKICAgICAgICBleHBlY3Qob2xkVmFsKS5ub3QudG9CZURlZmluZWQoKTsKICAgICAgfSk7CgogICAgICBpdCgnc2hvdWxkIGVuY29kZSBib3RoIG5hbWUgYW5kIHZhbHVlJywgZnVuY3Rpb24oKSB7CiAgICAgICAgYnJvd3Nlci5jb29raWVzKCdjb29raWUxPScsICd2YWw7dWUnKTsKICAgICAgICBicm93c2VyLmNvb2tpZXMoJ2Nvb2tpZTI9YmFyO2JheicsICd2YWw9dWUnKTsKCiAgICAgICAgdmFyIHJhd0Nvb2tpZXMgPSBkb2N1bWVudC5jb29raWUuc3BsaXQoIjsgIik7IC8vb3JkZXIgaXMgbm90IGd1YXJhbnRlZWQsIHNvIHdlIG5lZWQgdG8gcGFyc2UKICAgICAgICBleHBlY3QocmF3Q29va2llcy5sZW5ndGgpLnRvRXF1YWwoMik7CiAgICAgICAgZXhwZWN0KHJhd0Nvb2tpZXMpLnRvQ29udGFpbignY29va2llMSUzRD12YWwlM0J1ZScpOwogICAgICAgIGV4cGVjdChyYXdDb29raWVzKS50b0NvbnRhaW4oJ2Nvb2tpZTIlM0RiYXIlM0JiYXo9dmFsJTNEdWUnKTsKICAgICAgfSk7CgogICAgICBpdCgnc2hvdWxkIGxvZyB3YXJuaW5ncyB3aGVuIDRrYiBwZXIgY29va2llIHN0b3JhZ2UgbGltaXQgaXMgcmVhY2hlZCcsIGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBpLCBsb25nVmFsID0gJycsIGNvb2tpZVN0cjsKCiAgICAgICAgZm9yIChpPTA7IGk8NDA4MzsgaSsrKSB7CiAgICAgICAgICBsb25nVmFsICs9ICd4JzsKICAgICAgICB9CgogICAgICAgIGNvb2tpZVN0ciA9IGRvY3VtZW50LmNvb2tpZTsKICAgICAgICBicm93c2VyLmNvb2tpZXMoJ3gnLCBsb25nVmFsKTsgLy90b3RhbCBzaXplIDQwOTMtNDA5Niwgc28gaXQgc2hvdWxkIGdvIHRocm91Z2gKICAgICAgICBleHBlY3QoZG9jdW1lbnQuY29va2llKS5ub3QudG9FcXVhbChjb29raWVTdHIpOwogICAgICAgIGV4cGVjdChicm93c2VyLmNvb2tpZXMoKVsneCddKS50b0VxdWFsKGxvbmdWYWwpOwogICAgICAgIGV4cGVjdChsb2dzLndhcm4pLnRvRXF1YWwoW10pOwoKICAgICAgICBicm93c2VyLmNvb2tpZXMoJ3gnLCBsb25nVmFsICsgJ3h4eHgnKTsgLy90b3RhbCBzaXplIDQwOTctNDA5OSwgYSB3YXJuaW5nIHNob3VsZCBiZSBsb2dnZWQKICAgICAgICBleHBlY3QobG9ncy53YXJuKS50b0VxdWFsKAogICAgICAgICAgW1siQ29va2llICd4JyBwb3NzaWJseSBub3Qgc2V0IG9yIG92ZXJmbG93ZWQgYmVjYXVzZSBpdCB3YXMgdG9vIGxhcmdlICg0MDk3ID4gNDA5NiAiICsKICAgICAgICAgICAgICJieXRlcykhIl1dKTsKCiAgICAgICAgLy9mb3JjZSBicm93c2VyIHRvIGRyb3BwZWQgYSBjb29raWUgYW5kIG1ha2Ugc3VyZSB0aGF0IHRoZSBjYWNoZSBpcyBub3Qgb3V0IG9mIHN5bmMKICAgICAgICBicm93c2VyLmNvb2tpZXMoJ3gnLCAnc2hvcnRWYWwnKTsKICAgICAgICBleHBlY3QoYnJvd3Nlci5jb29raWVzKCkueCkudG9FcXVhbCgnc2hvcnRWYWwnKTsgLy9uZWVkZWQgdG8gcHJpbWUgdGhlIGNhY2hlCiAgICAgICAgY29va2llU3RyID0gZG9jdW1lbnQuY29va2llOwogICAgICAgIGJyb3dzZXIuY29va2llcygneCcsIGxvbmdWYWwgKyBsb25nVmFsICsgbG9uZ1ZhbCk7IC8vc2hvdWxkIGJlIHRvbyBsb25nIGZvciBhbGwgYnJvd3NlcnMKCiAgICAgICAgaWYgKGRvY3VtZW50LmNvb2tpZSAhPT0gY29va2llU3RyKSB7CiAgICAgICAgICB0aGlzLmZhaWwobmV3IEVycm9yKCJicm93c2VyIGRpZG4ndCBkcm9wIGxvbmcgY29va2llIHdoZW4gaXQgd2FzIGV4cGVjdGVkLiBtYWtlIHRoZSAiICsKICAgICAgICAgICAgICAiY29va2llIGluIHRoaXMgdGVzdCBsb25nZXIiKSk7CiAgICAgICAgfQoKICAgICAgICBleHBlY3QoYnJvd3Nlci5jb29raWVzKCkueCkudG9FcXVhbCgnc2hvcnRWYWwnKTsKICAgICAgfSk7CiAgICB9KTsKCiAgICBkZXNjcmliZSgncHV0IHZpYSBjb29raWVzKGNvb2tpZU5hbWUsIHN0cmluZyksIGlmIG5vIDxiYXNlIGhyZWY+ICcsIGZ1bmN0aW9uKCkgewogICAgICBiZWZvcmVFYWNoKGZ1bmN0aW9uKCkgewogICAgICAgIGZha2VEb2N1bWVudC5iYXNlUGF0aCA9IHVuZGVmaW5lZDsKICAgICAgfSk7CgogICAgICBpdCgnc2hvdWxkIGRlZmF1bHQgcGF0aCBpbiBjb29raWUgdG8gIiIgKGVtcHR5IHN0cmluZyknLCBmdW5jdGlvbigpIHsKICAgICAgICBicm93c2VyLmNvb2tpZXMoJ2Nvb2tpZScsICdiZW5kZXInKTsKICAgICAgICAvLyBUaGlzIG9ubHkgZmFpbHMgaW4gU2FmYXJpIGFuZCBJRSB3aGVuIGNvb2tpZVBhdGggcmV0dXJucyB1bmRlZmluZWQKICAgICAgICAvLyBXaGVyZSBpdCBub3cgc3VjY2VlZHMgc2luY2UgYmFzZUhyZWYgcmV0dXJuICcnIGluc3RlYWQgb2YgdW5kZWZpbmVkCiAgICAgICAgZXhwZWN0KGRvY3VtZW50LmNvb2tpZSkudG9FcXVhbCgnY29va2llPWJlbmRlcicpOwogICAgICB9KTsKICAgIH0pOwoKICAgIGRlc2NyaWJlKCdnZXQgdmlhIGNvb2tpZXMoKVtjb29raWVOYW1lXScsIGZ1bmN0aW9uKCkgewoKICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gdW5kZWZpbmVkIGZvciBub25leGlzdGVudCBjb29raWUnLCBmdW5jdGlvbigpIHsKICAgICAgICBleHBlY3QoYnJvd3Nlci5jb29raWVzKCkubm9uZXhpc3RlbnQpLm5vdC50b0JlRGVmaW5lZCgpOwogICAgICB9KTsKCgogICAgICBpdCAoJ3Nob3VsZCByZXR1cm4gYSB2YWx1ZSBmb3IgYW4gZXhpc3RpbmcgY29va2llJywgZnVuY3Rpb24oKSB7CiAgICAgICAgZG9jdW1lbnQuY29va2llID0gImZvbz1iYXI9YmF6O3BhdGg9LyI7CiAgICAgICAgZXhwZWN0KGJyb3dzZXIuY29va2llcygpLmZvbykudG9FcXVhbCgnYmFyPWJheicpOwogICAgICB9KTsKCiAgICAgIGl0KCdzaG91bGQgcmV0dXJuIHRoZSB0aGUgZmlyc3QgdmFsdWUgcHJvdmlkZWQgZm9yIGEgY29va2llJywgZnVuY3Rpb24oKSB7CiAgICAgICAgLy8gRm9yIGEgY29va2llIHRoYXQgaGFzIGRpZmZlcmVudCB2YWx1ZXMgdGhhdCBkaWZmZXIgYnkgcGF0aCwgdGhlCiAgICAgICAgLy8gdmFsdWUgZm9yIHRoZSBtb3N0IHNwZWNpZmljIHBhdGggYXBwZWFycyBmaXJzdC4gIGJyb3dzZXIuY29va2llcygpCiAgICAgICAgLy8gc2hvdWxkIHByb3ZpZGUgdGhhdCB2YWx1ZSBmb3IgdGhlIGNvb2tpZS4KICAgICAgICBkb2N1bWVudC5jb29raWUgPSAnZm9vPSJmaXJzdCI7IGZvbz0ic2Vjb25kIic7CiAgICAgICAgZXhwZWN0KGJyb3dzZXIuY29va2llcygpWydmb28nXSkudG9CZSgnImZpcnN0IicpOwogICAgICB9KTsKCiAgICAgIGl0ICgnc2hvdWxkIGRlY29kZSBjb29raWUgdmFsdWVzIHRoYXQgd2VyZSBlbmNvZGVkIGJ5IHB1dHMnLCBmdW5jdGlvbigpIHsKICAgICAgICBkb2N1bWVudC5jb29raWUgPSAiY29va2llMiUzRGJhciUzQmJhej12YWwlM0R1ZTtwYXRoPS8iOwogICAgICAgIGV4cGVjdChicm93c2VyLmNvb2tpZXMoKVsnY29va2llMj1iYXI7YmF6J10pLnRvRXF1YWwoJ3ZhbD11ZScpOwogICAgICB9KTsKCgogICAgICBpdCgnc2hvdWxkIHByZXNlcnZlIGxlYWRpbmcgJiB0cmFpbGluZyBzcGFjZXMgaW4gbmFtZXMgYW5kIHZhbHVlcycsIGZ1bmN0aW9uKCkgewogICAgICAgIGJyb3dzZXIuY29va2llcygnIGNvb2tpZSBuYW1lICcsICcgY29va2llIHZhbHVlICcpOwogICAgICAgIGV4cGVjdChicm93c2VyLmNvb2tpZXMoKVsnIGNvb2tpZSBuYW1lICddKS50b0VxdWFsKCcgY29va2llIHZhbHVlICcpOwogICAgICAgIGV4cGVjdChicm93c2VyLmNvb2tpZXMoKVsnY29va2llIG5hbWUnXSkubm90LnRvQmVEZWZpbmVkKCk7CiAgICAgIH0pOwoKICAgICAgaXQoJ3Nob3VsZCBkZWNvZGUgc3BlY2lhbCBjaGFyYWN0ZXJzIGluIGNvb2tpZSB2YWx1ZXMnLCBmdW5jdGlvbigpIHsKICAgICAgICBkb2N1bWVudC5jb29raWUgPSAnY29va2llX25hbWU9Y29va2llX3ZhbHVlXyVFMiU4MiVBQyc7CiAgICAgICAgZXhwZWN0KGJyb3dzZXIuY29va2llcygpWydjb29raWVfbmFtZSddKS50b0VxdWFsKCdjb29raWVfdmFsdWVf4oKsJyk7CiAgICAgIH0pOwoKICAgICAgaXQoJ3Nob3VsZCBub3QgZGVjb2RlIGNvb2tpZSB2YWx1ZXMgdGhhdCBkbyBub3QgYXBwZWFyIHRvIGJlIGVuY29kZWQnLCBmdW5jdGlvbigpIHsKICAgICAgICAvLyBzZWUgIzkyMTEgLSBzb21ldGltZXMgY29va2llcyBjb250YWluIGEgdmFsdWUgdGhhdCBjYXVzZXMgZGVjb2RlVVJJQ29tcG9uZW50IHRvIHRocm93CiAgICAgICAgZG9jdW1lbnQuY29va2llID0gJ2Nvb2tpZV9uYW1lPWNvb2tpZV92YWx1ZV8lWFgnOwogICAgICAgIGV4cGVjdChicm93c2VyLmNvb2tpZXMoKVsnY29va2llX25hbWUnXSkudG9FcXVhbCgnY29va2llX3ZhbHVlXyVYWCcpOwogICAgICB9KTsKICAgIH0pOwoKCiAgICBkZXNjcmliZSgnZ2V0QWxsIHZpYSBjb29raWVzKCknLCBmdW5jdGlvbigpIHsKCiAgICAgIGl0KCdzaG91bGQgcmV0dXJuIGNvb2tpZXMgYXMgaGFzaCcsIGZ1bmN0aW9uKCkgewogICAgICAgIGRvY3VtZW50LmNvb2tpZSA9ICJmb28xPWJhcjE7cGF0aD0vIjsKICAgICAgICBkb2N1bWVudC5jb29raWUgPSAiZm9vMj1iYXIyO3BhdGg9LyI7CiAgICAgICAgZXhwZWN0KGJyb3dzZXIuY29va2llcygpKS50b0VxdWFsKHsnZm9vMSc6J2JhcjEnLCAnZm9vMic6J2JhcjInfSk7CiAgICAgIH0pOwoKCiAgICAgIGl0KCdzaG91bGQgcmV0dXJuIGVtcHR5IGhhc2ggaWYgbm8gY29va2llcyBleGlzdCcsIGZ1bmN0aW9uKCkgewogICAgICAgIGV4cGVjdChicm93c2VyLmNvb2tpZXMoKSkudG9FcXVhbCh7fSk7CiAgICAgIH0pOwogICAgfSk7CgoKICAgIGl0KCdzaG91bGQgcGljayB1cCBleHRlcm5hbCBjaGFuZ2VzIG1hZGUgdG8gYnJvd3NlciBjb29raWVzJywgZnVuY3Rpb24oKSB7CiAgICAgIGJyb3dzZXIuY29va2llcygnb2F0bWVhbENvb2tpZScsICdkcm9vbCcpOwogICAgICBleHBlY3QoYnJvd3Nlci5jb29raWVzKCkpLnRvRXF1YWwoeydvYXRtZWFsQ29va2llJzonZHJvb2wnfSk7CgogICAgICBkb2N1bWVudC5jb29raWUgPSAnb2F0bWVhbENvb2tpZT1jaGFuZ2VkO3BhdGg9Lyc7CiAgICAgIGV4cGVjdChicm93c2VyLmNvb2tpZXMoKS5vYXRtZWFsQ29va2llKS50b0VxdWFsKCdjaGFuZ2VkJyk7CiAgICB9KTsKCgogICAgaXQoJ3Nob3VsZCBpbml0aWFsaXplIGNvb2tpZSBjYWNoZSB3aXRoIGV4aXN0aW5nIGNvb2tpZXMnLCBmdW5jdGlvbigpIHsKICAgICAgZG9jdW1lbnQuY29va2llID0gImV4aXN0aW5nQ29va2llPWV4aXN0aW5nVmFsdWU7cGF0aD0vIjsKICAgICAgZXhwZWN0KGJyb3dzZXIuY29va2llcygpKS50b0VxdWFsKHsnZXhpc3RpbmdDb29raWUnOidleGlzdGluZ1ZhbHVlJ30pOwogICAgfSk7CgogIH0pOwoKICBkZXNjcmliZSgncG9sbGVyJywgZnVuY3Rpb24oKSB7CgogICAgaXQoJ3Nob3VsZCBjYWxsIGZ1bmN0aW9ucyBpbiBwb2xsRm5zIGluIHJlZ3VsYXIgaW50ZXJ2YWxzJywgZnVuY3Rpb24oKSB7CiAgICAgIHZhciBsb2cgPSAnJzsKICAgICAgYnJvd3Nlci5hZGRQb2xsRm4oZnVuY3Rpb24oKSB7bG9nKz0nYSc7fSk7CiAgICAgIGJyb3dzZXIuYWRkUG9sbEZuKGZ1bmN0aW9uKCkge2xvZys9J2InO30pOwogICAgICBleHBlY3QobG9nKS50b0VxdWFsKCcnKTsKICAgICAgZmFrZVdpbmRvdy5zZXRUaW1lb3V0LmZsdXNoKCk7CiAgICAgIGV4cGVjdChsb2cpLnRvRXF1YWwoJ2FiJyk7CiAgICAgIGZha2VXaW5kb3cuc2V0VGltZW91dC5mbHVzaCgpOwogICAgICBleHBlY3QobG9nKS50b0VxdWFsKCdhYmFiJyk7CiAgICB9KTsKCiAgICBpdCgnc2hvdWxkIHN0YXJ0UG9sbGVyJywgZnVuY3Rpb24oKSB7CiAgICAgIGV4cGVjdChmYWtlV2luZG93LnRpbWVvdXRzLmxlbmd0aCkudG9FcXVhbCgwKTsKCiAgICAgIGJyb3dzZXIuYWRkUG9sbEZuKGZ1bmN0aW9uKCkge30pOwogICAgICBleHBlY3QoZmFrZVdpbmRvdy50aW1lb3V0cy5sZW5ndGgpLnRvRXF1YWwoMSk7CgogICAgICAvL3Nob3VsZCByZW1haW4gMSBhcyBpdCBpcyB0aGUgY2hlY2sgZm4KICAgICAgYnJvd3Nlci5hZGRQb2xsRm4oZnVuY3Rpb24oKSB7fSk7CiAgICAgIGV4cGVjdChmYWtlV2luZG93LnRpbWVvdXRzLmxlbmd0aCkudG9FcXVhbCgxKTsKICAgIH0pOwoKICAgIGl0KCdzaG91bGQgcmV0dXJuIGZuIHRoYXQgd2FzIHBhc3NlZCBpbnRvIGFkZFBvbGxGbicsIGZ1bmN0aW9uKCkgewogICAgICB2YXIgZm4gPSBmdW5jdGlvbigpIHsgcmV0dXJuIDE7IH07CiAgICAgIHZhciByZXR1cm5lZEZuID0gYnJvd3Nlci5hZGRQb2xsRm4oZm4pOwogICAgICBleHBlY3QocmV0dXJuZWRGbikudG9CZShmbik7CiAgICB9KTsKICB9KTsKCiAgZGVzY3JpYmUoJ3VybCcsIGZ1bmN0aW9uKCkgewogICAgdmFyIHB1c2hTdGF0ZSwgcmVwbGFjZVN0YXRlLCBsb2NhdGlvblJlcGxhY2U7CgogICAgYmVmb3JlRWFjaChmdW5jdGlvbigpIHsKICAgICAgcHVzaFN0YXRlID0gc3B5T24oZmFrZVdpbmRvdy5oaXN0b3J5LCAncHVzaFN0YXRlJyk7CiAgICAgIHJlcGxhY2VTdGF0ZSA9IHNweU9uKGZha2VXaW5kb3cuaGlzdG9yeSwgJ3JlcGxhY2VTdGF0ZScpOwogICAgICBsb2NhdGlvblJlcGxhY2UgPSBzcHlPbihmYWtlV2luZG93LmxvY2F0aW9uLCAncmVwbGFjZScpOwogICAgfSk7CgogICAgaXQoJ3Nob3VsZCByZXR1cm4gY3VycmVudCBsb2NhdGlvbi5ocmVmJywgZnVuY3Rpb24oKSB7CiAgICAgIGZha2VXaW5kb3cubG9jYXRpb24uaHJlZiA9ICdodHRwOi8vdGVzdC5jb20nOwogICAgICBleHBlY3QoYnJvd3Nlci51cmwoKSkudG9FcXVhbCgnaHR0cDovL3Rlc3QuY29tJyk7CgogICAgICBmYWtlV2luZG93LmxvY2F0aW9uLmhyZWYgPSAnaHR0cHM6Ly9hbm90aGVyLmNvbSc7CiAgICAgIGV4cGVjdChicm93c2VyLnVybCgpKS50b0VxdWFsKCdodHRwczovL2Fub3RoZXIuY29tJyk7CiAgICB9KTsKCiAgICBpdCgnc2hvdWxkIHVzZSBoaXN0b3J5LnB1c2hTdGF0ZSB3aGVuIGF2YWlsYWJsZScsIGZ1bmN0aW9uKCkgewogICAgICBzbmlmZmVyLmhpc3RvcnkgPSB0cnVlOwogICAgICBicm93c2VyLnVybCgnaHR0cDovL25ldy5vcmcnKTsKCiAgICAgIGV4cGVjdChwdXNoU3RhdGUpLnRvSGF2ZUJlZW5DYWxsZWRPbmNlKCk7CiAgICAgIGV4cGVjdChwdXNoU3RhdGUuYXJnc0ZvckNhbGxbMF1bMl0pLnRvRXF1YWwoJ2h0dHA6Ly9uZXcub3JnJyk7CgogICAgICBleHBlY3QocmVwbGFjZVN0YXRlKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpOwogICAgICBleHBlY3QobG9jYXRpb25SZXBsYWNlKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpOwogICAgICBleHBlY3QoZmFrZVdpbmRvdy5sb2NhdGlvbi5ocmVmKS50b0VxdWFsKCdodHRwOi8vc2VydmVyLycpOwogICAgfSk7CgogICAgaXQoJ3Nob3VsZCB1c2UgaGlzdG9yeS5yZXBsYWNlU3RhdGUgd2hlbiBhdmFpbGFibGUnLCBmdW5jdGlvbigpIHsKICAgICAgc25pZmZlci5oaXN0b3J5ID0gdHJ1ZTsKICAgICAgYnJvd3Nlci51cmwoJ2h0dHA6Ly9uZXcub3JnJywgdHJ1ZSk7CgogICAgICBleHBlY3QocmVwbGFjZVN0YXRlKS50b0hhdmVCZWVuQ2FsbGVkT25jZSgpOwogICAgICBleHBlY3QocmVwbGFjZVN0YXRlLmFyZ3NGb3JDYWxsWzBdWzJdKS50b0VxdWFsKCdodHRwOi8vbmV3Lm9yZycpOwoKICAgICAgZXhwZWN0KHB1c2hTdGF0ZSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTsKICAgICAgZXhwZWN0KGxvY2F0aW9uUmVwbGFjZSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTsKICAgICAgZXhwZWN0KGZha2VXaW5kb3cubG9jYXRpb24uaHJlZikudG9FcXVhbCgnaHR0cDovL3NlcnZlci8nKTsKICAgIH0pOwoKICAgIGl0KCdzaG91bGQgc2V0IGxvY2F0aW9uLmhyZWYgd2hlbiBwdXNoU3RhdGUgbm90IGF2YWlsYWJsZScsIGZ1bmN0aW9uKCkgewogICAgICBzbmlmZmVyLmhpc3RvcnkgPSBmYWxzZTsKICAgICAgYnJvd3Nlci51cmwoJ2h0dHA6Ly9uZXcub3JnJyk7CgogICAgICBleHBlY3QoZmFrZVdpbmRvdy5sb2NhdGlvbi5ocmVmKS50b0VxdWFsKCdodHRwOi8vbmV3Lm9yZycpOwoKICAgICAgZXhwZWN0KHB1c2hTdGF0ZSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTsKICAgICAgZXhwZWN0KHJlcGxhY2VTdGF0ZSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTsKICAgICAgZXhwZWN0KGxvY2F0aW9uUmVwbGFjZSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTsKICAgIH0pOwoKICAgIGl0KCdzaG91bGQgc2V0IGxvY2F0aW9uLmhyZWYgYW5kIG5vdCB1c2UgcHVzaFN0YXRlIHdoZW4gdGhlIHVybCBvbmx5IGNoYW5nZWQgaW4gdGhlIGhhc2ggZnJhZ21lbnQgdG8gcGxlYXNlIElFMTAvMTEnLCBmdW5jdGlvbigpIHsKICAgICAgc25pZmZlci5oaXN0b3J5ID0gdHJ1ZTsKICAgICAgYnJvd3Nlci51cmwoJ2h0dHA6Ly9zZXJ2ZXIvIzEyMycpOwoKICAgICAgZXhwZWN0KGZha2VXaW5kb3cubG9jYXRpb24uaHJlZikudG9FcXVhbCgnaHR0cDovL3NlcnZlci8jMTIzJyk7CgogICAgICBleHBlY3QocHVzaFN0YXRlKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpOwogICAgICBleHBlY3QocmVwbGFjZVN0YXRlKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpOwogICAgICBleHBlY3QobG9jYXRpb25SZXBsYWNlKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpOwogICAgfSk7CgogICAgaXQoJ3Nob3VsZCB1c2UgbG9jYXRpb24ucmVwbGFjZSB3aGVuIGhpc3RvcnkucmVwbGFjZVN0YXRlIG5vdCBhdmFpbGFibGUnLCBmdW5jdGlvbigpIHsKICAgICAgc25pZmZlci5oaXN0b3J5ID0gZmFsc2U7CiAgICAgIGJyb3dzZXIudXJsKCdodHRwOi8vbmV3Lm9yZycsIHRydWUpOwoKICAgICAgZXhwZWN0KGxvY2F0aW9uUmVwbGFjZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2h0dHA6Ly9uZXcub3JnJyk7CgogICAgICBleHBlY3QocHVzaFN0YXRlKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpOwogICAgICBleHBlY3QocmVwbGFjZVN0YXRlKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpOwogICAgICBleHBlY3QoZmFrZVdpbmRvdy5sb2NhdGlvbi5ocmVmKS50b0VxdWFsKCdodHRwOi8vc2VydmVyLycpOwogICAgfSk7CgogICAgaXQoJ3Nob3VsZCB1c2UgbG9jYXRpb24ucmVwbGFjZSBhbmQgbm90IHVzZSByZXBsYWNlU3RhdGUgd2hlbiB0aGUgdXJsIG9ubHkgY2hhbmdlZCBpbiB0aGUgaGFzaCBmcmFnbWVudCB0byBwbGVhc2UgSUUxMC8xMScsIGZ1bmN0aW9uKCkgewogICAgICBzbmlmZmVyLmhpc3RvcnkgPSB0cnVlOwogICAgICBicm93c2VyLnVybCgnaHR0cDovL3NlcnZlci8jMTIzJywgdHJ1ZSk7CgogICAgICBleHBlY3QobG9jYXRpb25SZXBsYWNlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnaHR0cDovL3NlcnZlci8jMTIzJyk7CgogICAgICBleHBlY3QocHVzaFN0YXRlKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpOwogICAgICBleHBlY3QocmVwbGFjZVN0YXRlKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpOwogICAgICBleHBlY3QoZmFrZVdpbmRvdy5sb2NhdGlvbi5ocmVmKS50b0VxdWFsKCdodHRwOi8vc2VydmVyLycpOwogICAgfSk7CgogICAgaXQoJ3Nob3VsZCByZXR1cm4gJGJyb3dzZXIgdG8gYWxsb3cgY2hhaW5pbmcnLCBmdW5jdGlvbigpIHsKICAgICAgZXhwZWN0KGJyb3dzZXIudXJsKCdodHRwOi8vYW55LmNvbScpKS50b0JlKGJyb3dzZXIpOwogICAgfSk7CgoKICAgIGl0KCdzaG91bGQgZGVjb2RlIHNpbmdsZSBxdW90ZXMgdG8gd29yayBhcm91bmQgRkYgYnVnIDQwNzI3MycsIGZ1bmN0aW9uKCkgewogICAgICBmYWtlV2luZG93LmxvY2F0aW9uLmhyZWYgPSAiaHR0cDovL2ZmLWJ1Zy8/c2luZ2xlJTI3cXVvdGUiOwogICAgICBleHBlY3QoYnJvd3Nlci51cmwoKSkudG9CZSgiaHR0cDovL2ZmLWJ1Zy8/c2luZ2xlJ3F1b3RlIik7CiAgICB9KTsKCiAgICBpdCgnc2hvdWxkIG5vdCBzZXQgVVJMIHdoZW4gdGhlIFVSTCBpcyBhbHJlYWR5IHNldCcsIGZ1bmN0aW9uKCkgewogICAgICB2YXIgY3VycmVudCA9IGZha2VXaW5kb3cubG9jYXRpb24uaHJlZjsKICAgICAgc25pZmZlci5oaXN0b3J5ID0gZmFsc2U7CiAgICAgIGZha2VXaW5kb3cubG9jYXRpb24uaHJlZiA9ICdkb250Y2hhbmdlJzsKICAgICAgYnJvd3Nlci51cmwoY3VycmVudCk7CiAgICAgIGV4cGVjdChmYWtlV2luZG93LmxvY2F0aW9uLmhyZWYpLnRvQmUoJ2RvbnRjaGFuZ2UnKTsKICAgIH0pOwoKICAgIGl0KCdzaG91bGQgbm90IHJlYWQgb3V0IGxvY2F0aW9uLmhyZWYgaWYgYSByZWxvYWQgd2FzIHRyaWdnZXJlZCBidXQgc3RpbGwgYWxsb3cgdG8gY2hhbmdlIHRoZSB1cmwnLCBmdW5jdGlvbigpIHsKICAgICAgc25pZmZlci5oaXN0b3J5ID0gZmFsc2U7CiAgICAgIGJyb3dzZXIudXJsKCdodHRwOi8vc2VydmVyL3NvbWVPdGhlclVybFRoYXRDYXVzZXNSZWxvYWQnKTsKICAgICAgZXhwZWN0KGZha2VXaW5kb3cubG9jYXRpb24uaHJlZikudG9CZSgnaHR0cDovL3NlcnZlci9zb21lT3RoZXJVcmxUaGF0Q2F1c2VzUmVsb2FkJyk7CgogICAgICBmYWtlV2luZG93LmxvY2F0aW9uLmhyZWYgPSAnaHR0cDovL3NvbWVOZXdVcmwnOwogICAgICBleHBlY3QoYnJvd3Nlci51cmwoKSkudG9CZSgnaHR0cDovL3NlcnZlci9zb21lT3RoZXJVcmxUaGF0Q2F1c2VzUmVsb2FkJyk7CgogICAgICBicm93c2VyLnVybCgnaHR0cDovL3NlcnZlci9zb21lT3RoZXJVcmwnKTsKICAgICAgZXhwZWN0KGJyb3dzZXIudXJsKCkpLnRvQmUoJ2h0dHA6Ly9zZXJ2ZXIvc29tZU90aGVyVXJsJyk7CiAgICAgIGV4cGVjdChmYWtlV2luZG93LmxvY2F0aW9uLmhyZWYpLnRvQmUoJ2h0dHA6Ly9zZXJ2ZXIvc29tZU90aGVyVXJsJyk7CiAgICB9KTsKCiAgICBpdCgnYXNzdW1lcyB0aGF0IGNoYW5nZXMgdG8gbG9jYXRpb24uaGFzaCBvY2N1ciBpbiBzeW5jJywgZnVuY3Rpb24oKSB7CiAgICAgIC8vIFRoaXMgaXMgYW4gYXN5bmNocm9ub3VzIGludGVncmF0aW9uIHRlc3QgdGhhdCBjaGFuZ2VzIHRoZQogICAgICAvLyBoYXNoIGluIGFsbCBwb3NzaWJsZSB3YXlzIGFuZCBjaGVja3MKICAgICAgLy8gLSB3aGV0aGVyIHRoZSBjaGFuZ2UgdG8gdGhlIGhhc2ggY2FuIGJlIHJlYWQgb3V0IGluIHN5bmMKICAgICAgLy8gLSB3aGV0aGVyIHRoZSBjaGFuZ2UgdG8gdGhlIGhhc2ggY2FuIGJlIHJlYWQgb3V0IGluIHRoZSBoYXNoY2hhbmdlIGV2ZW50CiAgICAgIHZhciByZWFsV2luID0gd2luZG93LAogICAgICAgICAgJHJlYWxXaW4gPSBqcUxpdGUocmVhbFdpbiksCiAgICAgICAgICBoYXNoSW5IYXNoQ2hhbmdlRXZlbnQgPSBbXTsKCiAgICAgIHJ1bnMoZnVuY3Rpb24oKSB7CiAgICAgICAgJHJlYWxXaW4ub24oJ2hhc2hjaGFuZ2UnLCBoYXNoTGlzdGVuZXIpOwoKICAgICAgICByZWFsV2luLmxvY2F0aW9uLmhhc2ggPSAnMSc7CiAgICAgICAgcmVhbFdpbi5sb2NhdGlvbi5ocmVmICs9ICcyJzsKICAgICAgICByZWFsV2luLmxvY2F0aW9uLnJlcGxhY2UocmVhbFdpbi5sb2NhdGlvbi5ocmVmICsgJzMnKTsKICAgICAgICByZWFsV2luLmxvY2F0aW9uLmFzc2lnbihyZWFsV2luLmxvY2F0aW9uLmhyZWYgKyAnNCcpOwoKICAgICAgICBleHBlY3QocmVhbFdpbi5sb2NhdGlvbi5oYXNoKS50b0JlKCcjMTIzNCcpOwogICAgICB9KTsKICAgICAgd2FpdHNGb3IoZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIGhhc2hJbkhhc2hDaGFuZ2VFdmVudC5sZW5ndGggPiAzOwogICAgICB9KTsKICAgICAgcnVucyhmdW5jdGlvbigpIHsKICAgICAgICAkcmVhbFdpbi5vZmYoJ2hhc2hjaGFuZ2UnLCBoYXNoTGlzdGVuZXIpOwoKICAgICAgICBmb3JFYWNoKGhhc2hJbkhhc2hDaGFuZ2VFdmVudCwgZnVuY3Rpb24oaGFzaCkgewogICAgICAgICAgZXhwZWN0KGhhc2gpLnRvQmUoJyMxMjM0Jyk7CiAgICAgICAgfSk7CiAgICAgIH0pOwoKICAgICAgZnVuY3Rpb24gaGFzaExpc3RlbmVyKCkgewogICAgICAgIGhhc2hJbkhhc2hDaGFuZ2VFdmVudC5wdXNoKHJlYWxXaW4ubG9jYXRpb24uaGFzaCk7CiAgICAgIH0KICAgIH0pOwoKICB9KTsKCiAgZGVzY3JpYmUoJ3VybCAod2hlbiBzdGF0ZSBwYXNzZWQpJywgZnVuY3Rpb24oKSB7CiAgICB2YXIgY3VycmVudEhyZWYsIHB1c2hTdGF0ZSwgcmVwbGFjZVN0YXRlLCBsb2NhdGlvblJlcGxhY2U7CgogICAgYmVmb3JlRWFjaChmdW5jdGlvbigpIHsKICAgIH0pOwoKICAgIGRlc2NyaWJlKCdpbiBJRScsIHJ1blRlc3RzKHttc2llOiB0cnVlfSkpOwogICAgZGVzY3JpYmUoJ25vdCBpbiBJRScsIHJ1blRlc3RzKHttc2llOiBmYWxzZX0pKTsKCiAgICBmdW5jdGlvbiBydW5UZXN0cyhvcHRpb25zKSB7CiAgICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICBiZWZvcmVFYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgc25pZmZlciA9IHtoaXN0b3J5OiB0cnVlfTsKCiAgICAgICAgICBmYWtlV2luZG93ID0gbmV3IE1vY2tXaW5kb3coe21zaWU6IG9wdGlvbnMubXNpZX0pOwogICAgICAgICAgY3VycmVudEhyZWYgPSBmYWtlV2luZG93LmxvY2F0aW9uLmhyZWY7CiAgICAgICAgICBwdXNoU3RhdGUgPSBzcHlPbihmYWtlV2luZG93Lmhpc3RvcnksICdwdXNoU3RhdGUnKS5hbmRDYWxsVGhyb3VnaCgpOwogICAgICAgICAgcmVwbGFjZVN0YXRlID0gc3B5T24oZmFrZVdpbmRvdy5oaXN0b3J5LCAncmVwbGFjZVN0YXRlJykuYW5kQ2FsbFRocm91Z2goKTsKICAgICAgICAgIGxvY2F0aW9uUmVwbGFjZSA9IHNweU9uKGZha2VXaW5kb3cubG9jYXRpb24sICdyZXBsYWNlJykuYW5kQ2FsbFRocm91Z2goKTsKCiAgICAgICAgICBicm93c2VyID0gbmV3IEJyb3dzZXIoZmFrZVdpbmRvdywgZmFrZURvY3VtZW50LCBmYWtlTG9nLCBzbmlmZmVyKTsKICAgICAgICAgIGJyb3dzZXIub25VcmxDaGFuZ2UoZnVuY3Rpb24oKSB7fSk7CiAgICAgICAgfSk7CgogICAgICAgIGl0KCdzaG91bGQgY2hhbmdlIHN0YXRlJywgZnVuY3Rpb24oKSB7CiAgICAgICAgICBicm93c2VyLnVybChjdXJyZW50SHJlZiwgZmFsc2UsIHtwcm9wOiAndmFsMSd9KTsKICAgICAgICAgIGV4cGVjdChmYWtlV2luZG93Lmhpc3Rvcnkuc3RhdGUpLnRvRXF1YWwoe3Byb3A6ICd2YWwxJ30pOwogICAgICAgICAgYnJvd3Nlci51cmwoY3VycmVudEhyZWYgKyAnL3NvbWV0aGluZycsIGZhbHNlLCB7cHJvcDogJ3ZhbDInfSk7CiAgICAgICAgICBleHBlY3QoZmFrZVdpbmRvdy5oaXN0b3J5LnN0YXRlKS50b0VxdWFsKHtwcm9wOiAndmFsMid9KTsKICAgICAgICB9KTsKCiAgICAgICAgaXQoJ3Nob3VsZCBhbGxvdyB0byBzZXQgZmFsc3kgc3RhdGVzIChleGNlcHQgYHVuZGVmaW5lZGApJywgZnVuY3Rpb24oKSB7CiAgICAgICAgICBmYWtlV2luZG93Lmhpc3Rvcnkuc3RhdGUgPSB7cHJvcDogJ3ZhbDEnfTsKICAgICAgICAgIGZha2VXaW5kb3cuZmlyZSgncG9wc3RhdGUnKTsKCiAgICAgICAgICBicm93c2VyLnVybChjdXJyZW50SHJlZiwgZmFsc2UsIG51bGwpOwogICAgICAgICAgZXhwZWN0KGZha2VXaW5kb3cuaGlzdG9yeS5zdGF0ZSkudG9CZShudWxsKTsKCiAgICAgICAgICBicm93c2VyLnVybChjdXJyZW50SHJlZiwgZmFsc2UsIGZhbHNlKTsKICAgICAgICAgIGV4cGVjdChmYWtlV2luZG93Lmhpc3Rvcnkuc3RhdGUpLnRvQmUoZmFsc2UpOwoKICAgICAgICAgIGJyb3dzZXIudXJsKGN1cnJlbnRIcmVmLCBmYWxzZSwgJycpOwogICAgICAgICAgZXhwZWN0KGZha2VXaW5kb3cuaGlzdG9yeS5zdGF0ZSkudG9CZSgnJyk7CgogICAgICAgICAgYnJvd3Nlci51cmwoY3VycmVudEhyZWYsIGZhbHNlLCAwKTsKICAgICAgICAgIGV4cGVjdChmYWtlV2luZG93Lmhpc3Rvcnkuc3RhdGUpLnRvQmUoMCk7CiAgICAgICAgfSk7CgogICAgICAgIGl0KCdzaG91bGQgdHJlYXQgYHVuZGVmaW5lZGAgc3RhdGUgYXMgYG51bGxgJywgZnVuY3Rpb24oKSB7CiAgICAgICAgICBmYWtlV2luZG93Lmhpc3Rvcnkuc3RhdGUgPSB7cHJvcDogJ3ZhbDEnfTsKICAgICAgICAgIGZha2VXaW5kb3cuZmlyZSgncG9wc3RhdGUnKTsKCiAgICAgICAgICBicm93c2VyLnVybChjdXJyZW50SHJlZiwgZmFsc2UsIHVuZGVmaW5lZCk7CiAgICAgICAgICBleHBlY3QoZmFrZVdpbmRvdy5oaXN0b3J5LnN0YXRlKS50b0JlKG51bGwpOwogICAgICAgIH0pOwoKICAgICAgICBpdCgnc2hvdWxkIGRvIHB1c2hTdGF0ZSB3aXRoIHRoZSBzYW1lIFVSTCBhbmQgYSBkaWZmZXJlbnQgc3RhdGUnLCBmdW5jdGlvbigpIHsKICAgICAgICAgIGJyb3dzZXIudXJsKGN1cnJlbnRIcmVmLCBmYWxzZSwge3Byb3A6ICd2YWwxJ30pOwogICAgICAgICAgZXhwZWN0KGZha2VXaW5kb3cuaGlzdG9yeS5zdGF0ZSkudG9FcXVhbCh7cHJvcDogJ3ZhbDEnfSk7CgogICAgICAgICAgYnJvd3Nlci51cmwoY3VycmVudEhyZWYsIGZhbHNlLCBudWxsKTsKICAgICAgICAgIGV4cGVjdChmYWtlV2luZG93Lmhpc3Rvcnkuc3RhdGUpLnRvQmUobnVsbCk7CgogICAgICAgICAgYnJvd3Nlci51cmwoY3VycmVudEhyZWYsIGZhbHNlLCB7cHJvcDogJ3ZhbDInfSk7CiAgICAgICAgICBicm93c2VyLnVybChjdXJyZW50SHJlZiwgZmFsc2UsIHtwcm9wOiAndmFsMyd9KTsKICAgICAgICAgIGV4cGVjdChmYWtlV2luZG93Lmhpc3Rvcnkuc3RhdGUpLnRvRXF1YWwoe3Byb3A6ICd2YWwzJ30pOwogICAgICAgIH0pOwoKICAgICAgICBpdCgnc2hvdWxkIGRvIHB1c2hTdGF0ZSB3aXRoIHRoZSBzYW1lIFVSTCBhbmQgZGVlcCBlcXVhbCBidXQgcmVmZXJlbnRpYWxseSBkaWZmZXJlbnQgc3RhdGUnLCBmdW5jdGlvbigpIHsKICAgICAgICAgIGZha2VXaW5kb3cuaGlzdG9yeS5zdGF0ZSA9IHtwcm9wOiAndmFsJ307CiAgICAgICAgICBmYWtlV2luZG93LmZpcmUoJ3BvcHN0YXRlJyk7CiAgICAgICAgICBleHBlY3QoaGlzdG9yeUVudHJpZXNMZW5ndGgpLnRvQmUoMSk7CgogICAgICAgICAgYnJvd3Nlci51cmwoY3VycmVudEhyZWYsIGZhbHNlLCB7cHJvcDogJ3ZhbCd9KTsKICAgICAgICAgIGV4cGVjdChmYWtlV2luZG93Lmhpc3Rvcnkuc3RhdGUpLnRvRXF1YWwoe3Byb3A6ICd2YWwnfSk7CiAgICAgICAgICBleHBlY3QoaGlzdG9yeUVudHJpZXNMZW5ndGgpLnRvQmUoMik7CiAgICAgICAgfSk7CgogICAgICAgIGl0KCdzaG91bGQgbm90IGRvIHB1c2hTdGF0ZSB3aXRoIHRoZSBzYW1lIFVSTCBhbmQgc3RhdGUgZnJvbSAkYnJvd3Nlci5zdGF0ZSgpJywgZnVuY3Rpb24oKSB7CiAgICAgICAgICBicm93c2VyLnVybChjdXJyZW50SHJlZiwgZmFsc2UsIHtwcm9wOiAndmFsJ30pOwoKICAgICAgICAgIHB1c2hTdGF0ZS5yZXNldCgpOwogICAgICAgICAgcmVwbGFjZVN0YXRlLnJlc2V0KCk7CiAgICAgICAgICBsb2NhdGlvblJlcGxhY2UucmVzZXQoKTsKCiAgICAgICAgICBicm93c2VyLnVybChjdXJyZW50SHJlZiwgZmFsc2UsIGJyb3dzZXIuc3RhdGUoKSk7CiAgICAgICAgICBleHBlY3QocHVzaFN0YXRlKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpOwogICAgICAgICAgZXhwZWN0KHJlcGxhY2VTdGF0ZSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTsKICAgICAgICAgIGV4cGVjdChsb2NhdGlvblJlcGxhY2UpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7CiAgICAgICAgfSk7CiAgICAgIH07CiAgICB9CiAgfSk7CgogIGRlc2NyaWJlKCdzdGF0ZScsIGZ1bmN0aW9uKCkgewogICAgdmFyIGN1cnJlbnRIcmVmOwoKICAgIGJlZm9yZUVhY2goZnVuY3Rpb24oKSB7CiAgICAgIHNuaWZmZXIgPSB7aGlzdG9yeTogdHJ1ZX07CiAgICAgIGN1cnJlbnRIcmVmID0gZmFrZVdpbmRvdy5sb2NhdGlvbi5ocmVmOwogICAgfSk7CgogICAgZGVzY3JpYmUoJ2luIElFJywgcnVuVGVzdHMoe21zaWU6IHRydWV9KSk7CiAgICBkZXNjcmliZSgnbm90IGluIElFJywgcnVuVGVzdHMoe21zaWU6IGZhbHNlfSkpOwoKICAgIGZ1bmN0aW9uIHJ1blRlc3RzKG9wdGlvbnMpIHsKICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICAgIGJlZm9yZUVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICBmYWtlV2luZG93ID0gbmV3IE1vY2tXaW5kb3coe21zaWU6IG9wdGlvbnMubXNpZX0pOwogICAgICAgICAgYnJvd3NlciA9IG5ldyBCcm93c2VyKGZha2VXaW5kb3csIGZha2VEb2N1bWVudCwgZmFrZUxvZywgc25pZmZlcik7CiAgICAgICAgfSk7CgogICAgICAgIGl0KCdzaG91bGQgcmV0dXJuIGhpc3Rvcnkuc3RhdGUnLCBmdW5jdGlvbigpIHsKICAgICAgICAgIGJyb3dzZXIudXJsKGN1cnJlbnRIcmVmLCBmYWxzZSwge3Byb3A6ICd2YWwnfSk7CiAgICAgICAgICBleHBlY3QoYnJvd3Nlci5zdGF0ZSgpKS50b0VxdWFsKHtwcm9wOiAndmFsJ30pOwogICAgICAgICAgYnJvd3Nlci51cmwoY3VycmVudEhyZWYsIGZhbHNlLCAyKTsKICAgICAgICAgIGV4cGVjdChicm93c2VyLnN0YXRlKCkpLnRvRXF1YWwoMik7CiAgICAgICAgICBicm93c2VyLnVybChjdXJyZW50SHJlZiwgZmFsc2UsIG51bGwpOwogICAgICAgICAgZXhwZWN0KGJyb3dzZXIuc3RhdGUoKSkudG9FcXVhbChudWxsKTsKICAgICAgICB9KTsKCiAgICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gbnVsbCBpZiBoaXN0b3J5LnN0YXRlIGlzIHVuZGVmaW5lZCcsIGZ1bmN0aW9uKCkgewogICAgICAgICAgYnJvd3Nlci51cmwoY3VycmVudEhyZWYsIGZhbHNlLCB1bmRlZmluZWQpOwogICAgICAgICAgZXhwZWN0KGJyb3dzZXIuc3RhdGUoKSkudG9CZShudWxsKTsKICAgICAgICB9KTsKCiAgICAgICAgaXQoJ3Nob3VsZCByZXR1cm4gdGhlIHNhbWUgc3RhdGUgb2JqZWN0IGluIHN1YnNlcXVlbnQgaW52b2NhdGlvbnMgaW4gSUUnLCBmdW5jdGlvbigpIHsKICAgICAgICAgIGJyb3dzZXIudXJsKGN1cnJlbnRIcmVmLCBmYWxzZSwge3Byb3A6ICd2YWwnfSk7CiAgICAgICAgICBleHBlY3QoYnJvd3Nlci5zdGF0ZSgpKS50b0JlKGJyb3dzZXIuc3RhdGUoKSk7CiAgICAgICAgfSk7CiAgICAgIH07CiAgICB9CiAgfSk7CgogIGRlc2NyaWJlKCd1cmxDaGFuZ2UnLCBmdW5jdGlvbigpIHsKICAgIHZhciBjYWxsYmFjazsKCiAgICBiZWZvcmVFYWNoKGZ1bmN0aW9uKCkgewogICAgICBjYWxsYmFjayA9IGphc21pbmUuY3JlYXRlU3B5KCdvblVybENoYW5nZScpOwogICAgfSk7CgogICAgYWZ0ZXJFYWNoKGZ1bmN0aW9uKCkgewogICAgICBpZiAoIWpRdWVyeSkganFMaXRlRGVhbG9jKGZha2VXaW5kb3cpOwogICAgfSk7CgogICAgaXQoJ3Nob3VsZCByZXR1cm4gcmVnaXN0ZXJlZCBjYWxsYmFjaycsIGZ1bmN0aW9uKCkgewogICAgICBleHBlY3QoYnJvd3Nlci5vblVybENoYW5nZShjYWxsYmFjaykpLnRvQmUoY2FsbGJhY2spOwogICAgfSk7CgogICAgaXQoJ3Nob3VsZCBmb3J3YXJkIHBvcHN0YXRlIGV2ZW50IHdpdGggbmV3IHVybCB3aGVuIGhpc3Rvcnkgc3VwcG9ydGVkJywgZnVuY3Rpb24oKSB7CiAgICAgIHNuaWZmZXIuaGlzdG9yeSA9IHRydWU7CiAgICAgIGJyb3dzZXIub25VcmxDaGFuZ2UoY2FsbGJhY2spOwogICAgICBmYWtlV2luZG93LmxvY2F0aW9uLmhyZWYgPSAnaHR0cDovL3NlcnZlci9uZXcnOwoKICAgICAgZmFrZVdpbmRvdy5maXJlKCdwb3BzdGF0ZScpOwogICAgICBleHBlY3QoY2FsbGJhY2spLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdodHRwOi8vc2VydmVyL25ldycsIG51bGwpOwoKICAgICAgZmFrZVdpbmRvdy5maXJlKCdoYXNoY2hhbmdlJyk7CiAgICAgIGZha2VXaW5kb3cuc2V0VGltZW91dC5mbHVzaCgpOwogICAgICBleHBlY3QoY2FsbGJhY2spLnRvSGF2ZUJlZW5DYWxsZWRPbmNlKCk7CiAgICB9KTsKCiAgICBpdCgnc2hvdWxkIGZvcndhcmQgb25seSBwb3BzdGF0ZSBldmVudCB3aGVuIGhpc3Rvcnkgc3VwcG9ydGVkJywgZnVuY3Rpb24oKSB7CiAgICAgIHNuaWZmZXIuaGlzdG9yeSA9IHRydWU7CiAgICAgIGJyb3dzZXIub25VcmxDaGFuZ2UoY2FsbGJhY2spOwogICAgICBmYWtlV2luZG93LmxvY2F0aW9uLmhyZWYgPSAnaHR0cDovL3NlcnZlci9uZXcnOwoKICAgICAgZmFrZVdpbmRvdy5maXJlKCdwb3BzdGF0ZScpOwogICAgICBleHBlY3QoY2FsbGJhY2spLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdodHRwOi8vc2VydmVyL25ldycsIG51bGwpOwoKICAgICAgZmFrZVdpbmRvdy5maXJlKCdoYXNoY2hhbmdlJyk7CiAgICAgIGZha2VXaW5kb3cuc2V0VGltZW91dC5mbHVzaCgpOwogICAgICBleHBlY3QoY2FsbGJhY2spLnRvSGF2ZUJlZW5DYWxsZWRPbmNlKCk7CiAgICB9KTsKCiAgICBpdCgnc2hvdWxkIGZvcndhcmQgaGFzaGNoYW5nZSBldmVudCB3aXRoIG5ldyB1cmwgd2hlbiBoaXN0b3J5IG5vdCBzdXBwb3J0ZWQnLCBmdW5jdGlvbigpIHsKICAgICAgc25pZmZlci5oaXN0b3J5ID0gZmFsc2U7CiAgICAgIGJyb3dzZXIub25VcmxDaGFuZ2UoY2FsbGJhY2spOwogICAgICBmYWtlV2luZG93LmxvY2F0aW9uLmhyZWYgPSAnaHR0cDovL3NlcnZlci9uZXcnOwoKICAgICAgZmFrZVdpbmRvdy5maXJlKCdoYXNoY2hhbmdlJyk7CiAgICAgIGV4cGVjdChjYWxsYmFjaykudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2h0dHA6Ly9zZXJ2ZXIvbmV3JywgbnVsbCk7CgogICAgICBmYWtlV2luZG93LmZpcmUoJ3BvcHN0YXRlJyk7CiAgICAgIGZha2VXaW5kb3cuc2V0VGltZW91dC5mbHVzaCgpOwogICAgICBleHBlY3QoY2FsbGJhY2spLnRvSGF2ZUJlZW5DYWxsZWRPbmNlKCk7CiAgICB9KTsKCiAgICBpdCgnc2hvdWxkIG5vdCBmaXJlIHVybENoYW5nZSBpZiBjaGFuZ2VkIGJ5IGJyb3dzZXIudXJsIG1ldGhvZCcsIGZ1bmN0aW9uKCkgewogICAgICBzbmlmZmVyLmhpc3RvcnkgPSBmYWxzZTsKICAgICAgYnJvd3Nlci5vblVybENoYW5nZShjYWxsYmFjayk7CiAgICAgIGJyb3dzZXIudXJsKCdodHRwOi8vbmV3LmNvbScpOwoKICAgICAgZmFrZVdpbmRvdy5maXJlKCdoYXNoY2hhbmdlJyk7CiAgICAgIGV4cGVjdChjYWxsYmFjaykubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTsKICAgIH0pOwoKICAgIGRlc2NyaWJlKCdzdGF0ZSBoYW5kbGluZycsIGZ1bmN0aW9uKCkgewogICAgICB2YXIgY3VycmVudEhyZWY7CgogICAgICBiZWZvcmVFYWNoKGZ1bmN0aW9uKCkgewogICAgICAgIHNuaWZmZXIgPSB7aGlzdG9yeTogdHJ1ZX07CiAgICAgICAgY3VycmVudEhyZWYgPSBmYWtlV2luZG93LmxvY2F0aW9uLmhyZWY7CiAgICAgIH0pOwoKICAgICAgZGVzY3JpYmUoJ2luIElFJywgcnVuVGVzdHMoe21zaWU6IHRydWV9KSk7CiAgICAgIGRlc2NyaWJlKCdub3QgaW4gSUUnLCBydW5UZXN0cyh7bXNpZTogZmFsc2V9KSk7CgogICAgICBmdW5jdGlvbiBydW5UZXN0cyhvcHRpb25zKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICAgICAgYmVmb3JlRWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgZmFrZVdpbmRvdyA9IG5ldyBNb2NrV2luZG93KHttc2llOiBvcHRpb25zLm1zaWV9KTsKICAgICAgICAgICAgYnJvd3NlciA9IG5ldyBCcm93c2VyKGZha2VXaW5kb3csIGZha2VEb2N1bWVudCwgZmFrZUxvZywgc25pZmZlcik7CiAgICAgICAgICB9KTsKCiAgICAgICAgICBpdCgnc2hvdWxkIGZpcmUgb25VcmxDaGFuZ2UgbGlzdGVuZXJzIG9ubHkgb25jZSBpZiBib3RoIHBvcHN0YXRlIGFuZCBoYXNoY2hhbmdlIHRyaWdnZXJlZCcsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICBmYWtlV2luZG93Lmhpc3Rvcnkuc3RhdGUgPSB7cHJvcDogJ3ZhbCd9OwogICAgICAgICAgICBicm93c2VyLm9uVXJsQ2hhbmdlKGNhbGxiYWNrKTsKCiAgICAgICAgICAgIGZha2VXaW5kb3cuZmlyZSgnaGFzaGNoYW5nZScpOwogICAgICAgICAgICBmYWtlV2luZG93LmZpcmUoJ3BvcHN0YXRlJyk7CiAgICAgICAgICAgIGV4cGVjdChjYWxsYmFjaykudG9IYXZlQmVlbkNhbGxlZE9uY2UoKTsKICAgICAgICAgIH0pOwogICAgICAgIH07CiAgICAgIH0KICAgIH0pOwogIH0pOwoKCiAgZGVzY3JpYmUoJ2Jhc2VIcmVmJywgZnVuY3Rpb24oKSB7CiAgICB2YXIganFEb2NIZWFkOwoKICAgIGJlZm9yZUVhY2goZnVuY3Rpb24oKSB7CiAgICAgIGpxRG9jSGVhZCA9IGpxTGl0ZShkb2N1bWVudCkuZmluZCgnaGVhZCcpOwogICAgfSk7CgogICAgaXQoJ3Nob3VsZCByZXR1cm4gdmFsdWUgZnJvbSA8YmFzZSBocmVmPicsIGZ1bmN0aW9uKCkgewogICAgICBmYWtlRG9jdW1lbnQuYmFzZVBhdGggPSAnL2Jhc2UvcGF0aC8nOwogICAgICBleHBlY3QoYnJvd3Nlci5iYXNlSHJlZigpKS50b0VxdWFsKCcvYmFzZS9wYXRoLycpOwogICAgfSk7CgogICAgaXQoJ3Nob3VsZCByZXR1cm4gXCdcJyAoZW1wdHkgc3RyaW5nKSBpZiBubyA8YmFzZSBocmVmPicsIGZ1bmN0aW9uKCkgewogICAgICBmYWtlRG9jdW1lbnQuYmFzZVBhdGggPSB1bmRlZmluZWQ7CiAgICAgIGV4cGVjdChicm93c2VyLmJhc2VIcmVmKCkpLnRvRXF1YWwoJycpOwogICAgfSk7CgogICAgaXQoJ3Nob3VsZCByZW1vdmUgZG9tYWluIGZyb20gPGJhc2UgaHJlZj4nLCBmdW5jdGlvbigpIHsKICAgICAgZmFrZURvY3VtZW50LmJhc2VQYXRoID0gJ2h0dHA6Ly9ob3N0LmNvbS9iYXNlL3BhdGgvJzsKICAgICAgZXhwZWN0KGJyb3dzZXIuYmFzZUhyZWYoKSkudG9FcXVhbCgnL2Jhc2UvcGF0aC8nKTsKCiAgICAgIGZha2VEb2N1bWVudC5iYXNlUGF0aCA9ICdodHRwOi8vaG9zdC5jb20vYmFzZS9wYXRoL2luZGV4Lmh0bWwnOwogICAgICBleHBlY3QoYnJvd3Nlci5iYXNlSHJlZigpKS50b0VxdWFsKCcvYmFzZS9wYXRoL2luZGV4Lmh0bWwnKTsKICAgIH0pOwoKICAgIGl0KCdzaG91bGQgcmVtb3ZlIGRvbWFpbiBmcm9tIDxiYXNlIGhyZWY+IGJlZ2lubmluZyB3aXRoIFwnLy9cJycsIGZ1bmN0aW9uKCkgewogICAgICBmYWtlRG9jdW1lbnQuYmFzZVBhdGggPSAnLy9nb29nbGUuY29tL2Jhc2UvcGF0aC8nOwogICAgICBleHBlY3QoYnJvd3Nlci5iYXNlSHJlZigpKS50b0VxdWFsKCcvYmFzZS9wYXRoLycpOwogICAgfSk7CiAgfSk7CgogIGRlc2NyaWJlKCdpbnRlZ3JhdGlvbiB0ZXN0cyB3aXRoICRsb2NhdGlvbicsIGZ1bmN0aW9uKCkgewoKICAgIGZ1bmN0aW9uIHNldHVwKG9wdGlvbnMpIHsKICAgICAgbW9kdWxlKGZ1bmN0aW9uKCRwcm92aWRlLCAkbG9jYXRpb25Qcm92aWRlcikgewogICAgICAgIHNweU9uKGZha2VXaW5kb3cuaGlzdG9yeSwgJ3B1c2hTdGF0ZScpLmFuZENhbGxGYWtlKGZ1bmN0aW9uKHN0YXRlT2JqLCB0aXRsZSwgbmV3VXJsKSB7CiAgICAgICAgICBmYWtlV2luZG93LmxvY2F0aW9uLmhyZWYgPSBuZXdVcmw7CiAgICAgICAgfSk7CiAgICAgICAgc3B5T24oZmFrZVdpbmRvdy5sb2NhdGlvbiwgJ3JlcGxhY2UnKS5hbmRDYWxsRmFrZShmdW5jdGlvbihuZXdVcmwpIHsKICAgICAgICAgIGZha2VXaW5kb3cubG9jYXRpb24uaHJlZiA9IG5ld1VybDsKICAgICAgICB9KTsKICAgICAgICAkcHJvdmlkZS52YWx1ZSgnJGJyb3dzZXInLCBicm93c2VyKTsKICAgICAgICBicm93c2VyLnBvbGxGbnMgPSBbXTsKCiAgICAgICAgc25pZmZlci5oaXN0b3J5ID0gb3B0aW9ucy5oaXN0b3J5OwogICAgICAgICRwcm92aWRlLnZhbHVlKCckc25pZmZlcicsIHNuaWZmZXIpOwoKICAgICAgICAkbG9jYXRpb25Qcm92aWRlci5odG1sNU1vZGUob3B0aW9ucy5odG1sNU1vZGUpOwogICAgICB9KTsKICAgIH0KCiAgICBkZXNjcmliZSgndXBkYXRlICRsb2NhdGlvbiB3aGVuIGl0IHdhcyBjaGFuZ2VkIG91dHNpZGUgb2YgQW5ndWxhciBpbiBzeW5jICcrCiAgICAgICAnYmVmb3JlICRkaWdlc3Qgd2FzIGNhbGxlZCcsIGZ1bmN0aW9uKCkgewoKICAgICAgaXQoJ3Nob3VsZCB3b3JrIHdpdGggbm8gaGlzdG9yeSBzdXBwb3J0LCBubyBodG1sNU1vZGUnLCBmdW5jdGlvbigpIHsKICAgICAgICBzZXR1cCh7CiAgICAgICAgICBoaXN0b3J5OiBmYWxzZSwKICAgICAgICAgIGh0bWw1TW9kZTogZmFsc2UKICAgICAgICB9KTsKICAgICAgICBpbmplY3QoZnVuY3Rpb24oJHJvb3RTY29wZSwgJGxvY2F0aW9uKSB7CiAgICAgICAgICAkcm9vdFNjb3BlLiRhcHBseShmdW5jdGlvbigpIHsKICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9pbml0aWFsUGF0aCcpOwogICAgICAgICAgfSk7CiAgICAgICAgICBleHBlY3QoZmFrZVdpbmRvdy5sb2NhdGlvbi5ocmVmKS50b0JlKCdodHRwOi8vc2VydmVyLyMvaW5pdGlhbFBhdGgnKTsKCiAgICAgICAgICBmYWtlV2luZG93LmxvY2F0aW9uLmhyZWYgPSAnaHR0cDovL3NlcnZlci8jL3NvbWVUZXN0SGFzaCc7CgogICAgICAgICAgJHJvb3RTY29wZS4kZGlnZXN0KCk7CgogICAgICAgICAgZXhwZWN0KCRsb2NhdGlvbi5wYXRoKCkpLnRvQmUoJy9zb21lVGVzdEhhc2gnKTsKICAgICAgICB9KTsKICAgICAgfSk7CgogICAgICBpdCgnc2hvdWxkIHdvcmsgd2l0aCBoaXN0b3J5IHN1cHBvcnQsIG5vIGh0bWw1TW9kZScsIGZ1bmN0aW9uKCkgewogICAgICAgIHNldHVwKHsKICAgICAgICAgIGhpc3Rvcnk6IHRydWUsCiAgICAgICAgICBodG1sNU1vZGU6IGZhbHNlCiAgICAgICAgfSk7CiAgICAgICAgaW5qZWN0KGZ1bmN0aW9uKCRyb290U2NvcGUsICRsb2NhdGlvbikgewogICAgICAgICAgJHJvb3RTY29wZS4kYXBwbHkoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvaW5pdGlhbFBhdGgnKTsKICAgICAgICAgIH0pOwogICAgICAgICAgZXhwZWN0KGZha2VXaW5kb3cubG9jYXRpb24uaHJlZikudG9CZSgnaHR0cDovL3NlcnZlci8jL2luaXRpYWxQYXRoJyk7CgogICAgICAgICAgZmFrZVdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJ2h0dHA6Ly9zZXJ2ZXIvIy9zb21lVGVzdEhhc2gnOwoKICAgICAgICAgICRyb290U2NvcGUuJGRpZ2VzdCgpOwoKICAgICAgICAgIGV4cGVjdCgkbG9jYXRpb24ucGF0aCgpKS50b0JlKCcvc29tZVRlc3RIYXNoJyk7CiAgICAgICAgfSk7CiAgICAgIH0pOwoKICAgICAgaXQoJ3Nob3VsZCB3b3JrIHdpdGggbm8gaGlzdG9yeSBzdXBwb3J0LCB3aXRoIGh0bWw1TW9kZScsIGZ1bmN0aW9uKCkgewogICAgICAgIHNldHVwKHsKICAgICAgICAgIGhpc3Rvcnk6IGZhbHNlLAogICAgICAgICAgaHRtbDVNb2RlOiB0cnVlCiAgICAgICAgfSk7CiAgICAgICAgaW5qZWN0KGZ1bmN0aW9uKCRyb290U2NvcGUsICRsb2NhdGlvbikgewogICAgICAgICAgJHJvb3RTY29wZS4kYXBwbHkoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvaW5pdGlhbFBhdGgnKTsKICAgICAgICAgIH0pOwogICAgICAgICAgZXhwZWN0KGZha2VXaW5kb3cubG9jYXRpb24uaHJlZikudG9CZSgnaHR0cDovL3NlcnZlci8jL2luaXRpYWxQYXRoJyk7CgogICAgICAgICAgZmFrZVdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJ2h0dHA6Ly9zZXJ2ZXIvIy9zb21lVGVzdEhhc2gnOwoKICAgICAgICAgICRyb290U2NvcGUuJGRpZ2VzdCgpOwoKICAgICAgICAgIGV4cGVjdCgkbG9jYXRpb24ucGF0aCgpKS50b0JlKCcvc29tZVRlc3RIYXNoJyk7CiAgICAgICAgfSk7CiAgICAgIH0pOwoKICAgICAgaXQoJ3Nob3VsZCB3b3JrIHdpdGggaGlzdG9yeSBzdXBwb3J0LCB3aXRoIGh0bWw1TW9kZScsIGZ1bmN0aW9uKCkgewogICAgICAgIHNldHVwKHsKICAgICAgICAgIGhpc3Rvcnk6IHRydWUsCiAgICAgICAgICBodG1sNU1vZGU6IHRydWUKICAgICAgICB9KTsKICAgICAgICBpbmplY3QoZnVuY3Rpb24oJHJvb3RTY29wZSwgJGxvY2F0aW9uKSB7CiAgICAgICAgICAkcm9vdFNjb3BlLiRhcHBseShmdW5jdGlvbigpIHsKICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9pbml0aWFsUGF0aCcpOwogICAgICAgICAgfSk7CiAgICAgICAgICBleHBlY3QoZmFrZVdpbmRvdy5sb2NhdGlvbi5ocmVmKS50b0JlKCdodHRwOi8vc2VydmVyL2luaXRpYWxQYXRoJyk7CgogICAgICAgICAgZmFrZVdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJ2h0dHA6Ly9zZXJ2ZXIvc29tZVRlc3RIYXNoJzsKCiAgICAgICAgICAkcm9vdFNjb3BlLiRkaWdlc3QoKTsKCiAgICAgICAgICBleHBlY3QoJGxvY2F0aW9uLnBhdGgoKSkudG9CZSgnL3NvbWVUZXN0SGFzaCcpOwogICAgICAgIH0pOwogICAgICB9KTsKCiAgICB9KTsKCiAgICBpdCgnc2hvdWxkIG5vdCByZWxvYWQgdGhlIHBhZ2Ugb24gZXZlcnkgJGRpZ2VzdCB3aGVuIHRoZSBwYWdlIHdpbGwgYmUgcmVsb2FkZWQgZHVlIHRvIHVybCByZXdyaXRlIG9uIGxvYWQnLCBmdW5jdGlvbigpIHsKICAgICAgc2V0dXAoewogICAgICAgIGhpc3Rvcnk6IGZhbHNlLAogICAgICAgIGh0bWw1TW9kZTogdHJ1ZQogICAgICB9KTsKICAgICAgZmFrZVdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJ2h0dHA6Ly9zZXJ2ZXIvc29tZS9kZWVwL3BhdGgnOwogICAgICB2YXIgY2hhbmdlVXJsQ291bnQgPSAwOwogICAgICB2YXIgX3VybCA9IGJyb3dzZXIudXJsOwogICAgICBicm93c2VyLnVybCA9IGZ1bmN0aW9uKG5ld1VybCwgcmVwbGFjZSwgc3RhdGUpIHsKICAgICAgICBpZiAobmV3VXJsKSB7CiAgICAgICAgICBjaGFuZ2VVcmxDb3VudCsrOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX3VybC5jYWxsKHRoaXMsIG5ld1VybCwgcmVwbGFjZSk7CiAgICAgIH07CiAgICAgIHNweU9uKGJyb3dzZXIsICd1cmwnKS5hbmRDYWxsVGhyb3VnaCgpOwogICAgICBpbmplY3QoZnVuY3Rpb24oJHJvb3RTY29wZSwgJGxvY2F0aW9uKSB7CiAgICAgICAgJHJvb3RTY29wZS4kZGlnZXN0KCk7CiAgICAgICAgJHJvb3RTY29wZS4kZGlnZXN0KCk7CiAgICAgICAgJHJvb3RTY29wZS4kZGlnZXN0KCk7CiAgICAgICAgJHJvb3RTY29wZS4kZGlnZXN0KCk7CgogICAgICAgIC8vIGZyb20gJGxvY2F0aW9uIGZvciByZXdyaXRpbmcgdGhlIGluaXRpYWwgdXJsIGludG8gYSBoYXNoIHVybAogICAgICAgIGV4cGVjdChicm93c2VyLnVybCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2h0dHA6Ly9zZXJ2ZXIvIy9zb21lL2RlZXAvcGF0aCcsIHRydWUpOwogICAgICAgIGV4cGVjdChjaGFuZ2VVcmxDb3VudCkudG9CZSgxKTsKICAgICAgfSk7CgogICAgfSk7CiAgfSk7CgogIGRlc2NyaWJlKCdpbnRlZ3JhdGlvbiB0ZXN0IHdpdGggJHJvb3RTY29wZScsIGZ1bmN0aW9uKCkgewoKICAgIGJlZm9yZUVhY2gobW9kdWxlKGZ1bmN0aW9uKCRwcm92aWRlLCAkbG9jYXRpb25Qcm92aWRlcikgewogICAgICAkcHJvdmlkZS52YWx1ZSgnJGJyb3dzZXInLCBicm93c2VyKTsKICAgICAgYnJvd3Nlci5wb2xsRm5zID0gW107CiAgICB9KSk7CgogICAgaXQoJ3Nob3VsZCBub3QgaW50ZXJmZXJlIHdpdGggbGVnYWN5IGJyb3dzZXIgdXJsIHJlcGxhY2UgYmVoYXZpb3InLCBmdW5jdGlvbigpIHsKICAgICAgaW5qZWN0KGZ1bmN0aW9uKCRyb290U2NvcGUpIHsKICAgICAgICB2YXIgY3VycmVudCA9IGZha2VXaW5kb3cubG9jYXRpb24uaHJlZjsKICAgICAgICB2YXIgbmV3VXJsID0gJ25vdHlldCc7CiAgICAgICAgc25pZmZlci5oaXN0b3J5ID0gZmFsc2U7CiAgICAgICAgZXhwZWN0KGhpc3RvcnlFbnRyaWVzTGVuZ3RoKS50b0JlKDEpOwogICAgICAgIGJyb3dzZXIudXJsKG5ld1VybCwgdHJ1ZSk7CiAgICAgICAgZXhwZWN0KGJyb3dzZXIudXJsKCkpLnRvQmUobmV3VXJsKTsKICAgICAgICBleHBlY3QoaGlzdG9yeUVudHJpZXNMZW5ndGgpLnRvQmUoMSk7CiAgICAgICAgJHJvb3RTY29wZS4kZGlnZXN0KCk7CiAgICAgICAgZXhwZWN0KGJyb3dzZXIudXJsKCkpLnRvQmUobmV3VXJsKTsKICAgICAgICBleHBlY3QoaGlzdG9yeUVudHJpZXNMZW5ndGgpLnRvQmUoMSk7CiAgICAgIH0pOwogICAgfSk7CgogIH0pOwoKfSk7Cg==",
                "body": "J3VzZSBzdHJpY3QnOwoKdmFyIGhpc3RvcnlFbnRyaWVzTGVuZ3RoOwp2YXIgc25pZmZlciA9IHt9OwoKZnVuY3Rpb24gTW9ja1dpbmRvdyhvcHRpb25zKSB7CiAgaWYgKHR5cGVvZiBvcHRpb25zICE9PSAnb2JqZWN0JykgewogICAgb3B0aW9ucyA9IHt9OwogIH0KICB2YXIgZXZlbnRzID0ge307CiAgdmFyIHRpbWVvdXRzID0gdGhpcy50aW1lb3V0cyA9IFtdOwogIHZhciBsb2NhdGlvbkhyZWYgPSAnaHR0cDovL3NlcnZlci8nOwogIHZhciBtb2NrV2luZG93ID0gdGhpczsKICB2YXIgbXNpZSA9IG9wdGlvbnMubXNpZTsKICB2YXIgaWVTdGF0ZTsKCiAgaGlzdG9yeUVudHJpZXNMZW5ndGggPSAxOwoKICB0aGlzLnNldFRpbWVvdXQgPSBmdW5jdGlvbihmbikgewogICAgcmV0dXJuIHRpbWVvdXRzLnB1c2goZm4pIC0gMTsKICB9OwoKICB0aGlzLmNsZWFyVGltZW91dCA9IGZ1bmN0aW9uKGlkKSB7CiAgICB0aW1lb3V0c1tpZF0gPSBub29wOwogIH07CgogIHRoaXMuc2V0VGltZW91dC5mbHVzaCA9IGZ1bmN0aW9uKCkgewogICAgdmFyIGxlbmd0aCA9IHRpbWVvdXRzLmxlbmd0aDsKICAgIHdoaWxlIChsZW5ndGgtLSA+IDApIHRpbWVvdXRzLnNoaWZ0KCkoKTsKICB9OwoKICB0aGlzLmFkZEV2ZW50TGlzdGVuZXIgPSBmdW5jdGlvbihuYW1lLCBsaXN0ZW5lcikgewogICAgaWYgKGFuZ3VsYXIuaXNVbmRlZmluZWQoZXZlbnRzW25hbWVdKSkgZXZlbnRzW25hbWVdID0gW107CiAgICBldmVudHNbbmFtZV0ucHVzaChsaXN0ZW5lcik7CiAgfTsKCiAgdGhpcy5yZW1vdmVFdmVudExpc3RlbmVyID0gbm9vcDsKCiAgdGhpcy5maXJlID0gZnVuY3Rpb24obmFtZSkgewogICAgZm9yRWFjaChldmVudHNbbmFtZV0sIGZ1bmN0aW9uKGZuKSB7CiAgICAgIGZuKHt0eXBlOiBuYW1lfSk7IC8vIHR5cGUgdG8gbWFrZSBqUXVlcnkgaGFwcHkKICAgIH0pOwogIH07CgogIHRoaXMubG9jYXRpb24gPSB7CiAgICBnZXQgaHJlZigpIHsKICAgICAgcmV0dXJuIGxvY2F0aW9uSHJlZjsKICAgIH0sCiAgICBzZXQgaHJlZih2YWx1ZSkgewogICAgICBsb2NhdGlvbkhyZWYgPSB2YWx1ZTsKICAgICAgbW9ja1dpbmRvdy5oaXN0b3J5LnN0YXRlID0gbnVsbDsKICAgICAgaGlzdG9yeUVudHJpZXNMZW5ndGgrKzsKICAgIH0sCiAgICByZXBsYWNlOiBmdW5jdGlvbih1cmwpIHsKICAgICAgbG9jYXRpb25IcmVmID0gdXJsOwogICAgICBtb2NrV2luZG93Lmhpc3Rvcnkuc3RhdGUgPSBudWxsOwogICAgfQogIH07CgogIHRoaXMuaGlzdG9yeSA9IHsKICAgIHB1c2hTdGF0ZTogZnVuY3Rpb24oKSB7CiAgICAgIHRoaXMucmVwbGFjZVN0YXRlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIGhpc3RvcnlFbnRyaWVzTGVuZ3RoKys7CiAgICB9LAogICAgcmVwbGFjZVN0YXRlOiBmdW5jdGlvbihzdGF0ZSwgdGl0bGUsIHVybCkgewogICAgICBsb2NhdGlvbkhyZWYgPSB1cmw7CiAgICAgIG1vY2tXaW5kb3cuaGlzdG9yeS5zdGF0ZSA9IGNvcHkoc3RhdGUpOwogICAgfQogIH07CiAgLy8gSUUgMTAtMTEgZGVzZXJpYWxpemUgaGlzdG9yeS5zdGF0ZSBvbiBlYWNoIHJlYWQgbWFraW5nIHN1YnNlcXVlbnQgcmVhZHMKICAvLyBkaWZmZXJlbnQgb2JqZWN0LgogIGlmICghbXNpZSkgewogICAgdGhpcy5oaXN0b3J5LnN0YXRlID0gbnVsbDsKICB9IGVsc2UgewogICAgaWVTdGF0ZSA9IG51bGw7CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcy5oaXN0b3J5LCAnc3RhdGUnLCB7CiAgICAgIGdldDogZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuIGNvcHkoaWVTdGF0ZSk7CiAgICAgIH0sCiAgICAgIHNldDogZnVuY3Rpb24odmFsdWUpIHsKICAgICAgICBpZVN0YXRlID0gdmFsdWU7CiAgICAgIH0sCiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgZW51bWVyYWJsZTogdHJ1ZQogICAgfSk7CiAgfQp9CgpmdW5jdGlvbiBNb2NrRG9jdW1lbnQoKSB7CiAgdmFyIHNlbGYgPSB0aGlzOwoKICB0aGlzWzBdID0gd2luZG93LmRvY3VtZW50OwogIHRoaXMuYmFzZVBhdGggPSAnLyc7CgogIHRoaXMuZmluZCA9IGZ1bmN0aW9uKG5hbWUpIHsKICAgIGlmIChuYW1lID09ICdiYXNlJykgewogICAgICByZXR1cm4gewogICAgICAgIGF0dHI6IGZ1bmN0aW9uKG5hbWUpIHsKICAgICAgICAgIGlmIChuYW1lID09ICdocmVmJykgewogICAgICAgICAgICByZXR1cm4gc2VsZi5iYXNlUGF0aDsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihuYW1lKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH07CiAgICB9IGVsc2UgewogICAgICB0aHJvdyBuZXcgRXJyb3IobmFtZSk7CiAgICB9CiAgfTsKfQoKZGVzY3JpYmUoJ2Jyb3dzZXInLCBmdW5jdGlvbigpIHsKICAvKiBnbG9iYWwgQnJvd3NlcjogZmFsc2UgKi8KICB2YXIgYnJvd3NlciwgZmFrZVdpbmRvdywgZmFrZURvY3VtZW50LCBmYWtlTG9nLCBsb2dzLCBzY3JpcHRzLCByZW1vdmVkU2NyaXB0czsKCiAgYmVmb3JlRWFjaChmdW5jdGlvbigpIHsKICAgIHNjcmlwdHMgPSBbXTsKICAgIHJlbW92ZWRTY3JpcHRzID0gW107CiAgICBzbmlmZmVyID0ge2hpc3Rvcnk6IHRydWV9OwogICAgZmFrZVdpbmRvdyA9IG5ldyBNb2NrV2luZG93KCk7CiAgICBmYWtlRG9jdW1lbnQgPSBuZXcgTW9ja0RvY3VtZW50KCk7CgogICAgbG9ncyA9IHtsb2c6W10sIHdhcm46W10sIGluZm86W10sIGVycm9yOltdfTsKCiAgICB2YXIgZmFrZUxvZyA9IHtsb2c6IGZ1bmN0aW9uKCkgeyBsb2dzLmxvZy5wdXNoKHNsaWNlLmNhbGwoYXJndW1lbnRzKSk7IH0sCiAgICAgICAgICAgICAgICAgICB3YXJuOiBmdW5jdGlvbigpIHsgbG9ncy53YXJuLnB1c2goc2xpY2UuY2FsbChhcmd1bWVudHMpKTsgfSwKICAgICAgICAgICAgICAgICAgIGluZm86IGZ1bmN0aW9uKCkgeyBsb2dzLmluZm8ucHVzaChzbGljZS5jYWxsKGFyZ3VtZW50cykpOyB9LAogICAgICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKCkgeyBsb2dzLmVycm9yLnB1c2goc2xpY2UuY2FsbChhcmd1bWVudHMpKTsgfX07CgogICAgYnJvd3NlciA9IG5ldyBCcm93c2VyKGZha2VXaW5kb3csIGZha2VEb2N1bWVudCwgZmFrZUxvZywgc25pZmZlcik7CiAgfSk7CgogIGRlc2NyaWJlKCdNb2NrQnJvd3NlcicsIGZ1bmN0aW9uKCkgewogICAgZGVzY3JpYmUoJ2hpc3RvcnlFbnRyaWVzTGVuZ3RoJywgZnVuY3Rpb24oKSB7CiAgICAgIGl0KCdzaG91bGQgaW5jcmVtZW50IGhpc3RvcnlFbnRyaWVzTGVuZ3RoIHdoZW4gc2V0dGluZyBsb2NhdGlvbi5ocmVmJywgZnVuY3Rpb24oKSB7CiAgICAgICAgZXhwZWN0KGhpc3RvcnlFbnRyaWVzTGVuZ3RoKS50b0JlKDEpOwogICAgICAgIGZha2VXaW5kb3cubG9jYXRpb24uaHJlZiA9ICcvZm9vJzsKICAgICAgICBleHBlY3QoaGlzdG9yeUVudHJpZXNMZW5ndGgpLnRvQmUoMik7CiAgICAgIH0pOwoKICAgICAgaXQoJ3Nob3VsZCBub3QgaW5jcmVtZW50IGhpc3RvcnlFbnRyaWVzTGVuZ3RoIHdoZW4gdXNpbmcgbG9jYXRpb24ucmVwbGFjZScsIGZ1bmN0aW9uKCkgewogICAgICAgIGV4cGVjdChoaXN0b3J5RW50cmllc0xlbmd0aCkudG9CZSgxKTsKICAgICAgICBmYWtlV2luZG93LmxvY2F0aW9uLnJlcGxhY2UoJy9mb28nKTsKICAgICAgICBleHBlY3QoaGlzdG9yeUVudHJpZXNMZW5ndGgpLnRvQmUoMSk7CiAgICAgIH0pOwoKICAgICAgaXQoJ3Nob3VsZCBpbmNyZW1lbnQgaGlzdG9yeUVudHJpZXNMZW5ndGggd2hlbiB1c2luZyBoaXN0b3J5LnB1c2hTdGF0ZScsIGZ1bmN0aW9uKCkgewogICAgICAgIGV4cGVjdChoaXN0b3J5RW50cmllc0xlbmd0aCkudG9CZSgxKTsKICAgICAgICBmYWtlV2luZG93Lmhpc3RvcnkucHVzaFN0YXRlKHthOiAyfSwgJ2ZvbycsICcvYmFyJyk7CiAgICAgICAgZXhwZWN0KGhpc3RvcnlFbnRyaWVzTGVuZ3RoKS50b0JlKDIpOwogICAgICB9KTsKCiAgICAgIGl0KCdzaG91bGQgbm90IGluY3JlbWVudCBoaXN0b3J5RW50cmllc0xlbmd0aCB3aGVuIHVzaW5nIGhpc3RvcnkucmVwbGFjZVN0YXRlJywgZnVuY3Rpb24oKSB7CiAgICAgICAgZXhwZWN0KGhpc3RvcnlFbnRyaWVzTGVuZ3RoKS50b0JlKDEpOwogICAgICAgIGZha2VXaW5kb3cuaGlzdG9yeS5yZXBsYWNlU3RhdGUoe2E6IDJ9LCAnZm9vJywgJy9iYXInKTsKICAgICAgICBleHBlY3QoaGlzdG9yeUVudHJpZXNMZW5ndGgpLnRvQmUoMSk7CiAgICAgIH0pOwogICAgfSk7CgogICAgZGVzY3JpYmUoJ2luIElFJywgcnVuVGVzdHMoe21zaWU6IHRydWV9KSk7CiAgICBkZXNjcmliZSgnbm90IGluIElFJywgcnVuVGVzdHMoe21zaWU6IGZhbHNlfSkpOwoKICAgIGZ1bmN0aW9uIHJ1blRlc3RzKG9wdGlvbnMpIHsKICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICAgIGl0KCdzaG91bGQgcmV0dXJuIHRoZSBzYW1lIHN0YXRlIG9iamVjdCBvbiBldmVyeSByZWFkJywgZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgbXNpZSA9IG9wdGlvbnMubXNpZTsKCiAgICAgICAgICBmYWtlV2luZG93ID0gbmV3IE1vY2tXaW5kb3coe21zaWU6IG1zaWV9KTsKICAgICAgICAgIGZha2VXaW5kb3cubG9jYXRpb24uc3RhdGUgPSB7cHJvcDogJ3ZhbCd9OwogICAgICAgICAgYnJvd3NlciA9IG5ldyBCcm93c2VyKGZha2VXaW5kb3csIGZha2VEb2N1bWVudCwgZmFrZUxvZywgc25pZmZlcik7CgogICAgICAgICAgYnJvd3Nlci51cmwoZmFrZVdpbmRvdy5sb2NhdGlvbi5ocmVmLCBmYWxzZSwge3Byb3A6ICd2YWwnfSk7CiAgICAgICAgICBpZiAobXNpZSkgewogICAgICAgICAgICBleHBlY3QoZmFrZVdpbmRvdy5oaXN0b3J5LnN0YXRlKS5ub3QudG9CZShmYWtlV2luZG93Lmhpc3Rvcnkuc3RhdGUpOwogICAgICAgICAgICBleHBlY3QoZmFrZVdpbmRvdy5oaXN0b3J5LnN0YXRlKS50b0VxdWFsKGZha2VXaW5kb3cuaGlzdG9yeS5zdGF0ZSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBleHBlY3QoZmFrZVdpbmRvdy5oaXN0b3J5LnN0YXRlKS50b0JlKGZha2VXaW5kb3cuaGlzdG9yeS5zdGF0ZSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH07CiAgICB9CiAgfSk7CgogIGl0KCdzaG91bGQgY29udGFpbiBjb29raWUgY3J1bmNoZXInLCBmdW5jdGlvbigpIHsKICAgIGV4cGVjdChicm93c2VyLmNvb2tpZXMpLnRvQmVEZWZpbmVkKCk7CiAgfSk7CgogIGRlc2NyaWJlKCdvdXRzdGFkaW5nIHJlcXVlc3RzJywgZnVuY3Rpb24oKSB7CiAgICBpdCgnc2hvdWxkIHByb2Nlc3MgY2FsbGJhY2tzIGltbWVkaWV0bHkgd2l0aCBubyBvdXRzdGFuZGluZyByZXF1ZXN0cycsIGZ1bmN0aW9uKCkgewogICAgICB2YXIgY2FsbGJhY2sgPSBqYXNtaW5lLmNyZWF0ZVNweSgnY2FsbGJhY2snKTsKICAgICAgYnJvd3Nlci5ub3RpZnlXaGVuTm9PdXRzdGFuZGluZ1JlcXVlc3RzKGNhbGxiYWNrKTsKICAgICAgZXhwZWN0KGNhbGxiYWNrKS50b0hhdmVCZWVuQ2FsbGVkKCk7CiAgICB9KTsKICB9KTsKCgogIGRlc2NyaWJlKCdkZWZlcicsIGZ1bmN0aW9uKCkgewogICAgaXQoJ3Nob3VsZCBleGVjdXRlIGZuIGFzeW5jaHJvbmlvdXNseSB2aWEgc2V0VGltZW91dCcsIGZ1bmN0aW9uKCkgewogICAgICB2YXIgY2FsbGJhY2sgPSBqYXNtaW5lLmNyZWF0ZVNweSgnZGVmZXJyZWQnKTsKCiAgICAgIGJyb3dzZXIuZGVmZXIoY2FsbGJhY2spOwogICAgICBleHBlY3QoY2FsbGJhY2spLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7CgogICAgICBmYWtlV2luZG93LnNldFRpbWVvdXQuZmx1c2goKTsKICAgICAgZXhwZWN0KGNhbGxiYWNrKS50b0hhdmVCZWVuQ2FsbGVkT25jZSgpOwogICAgfSk7CgoKICAgIGl0KCdzaG91bGQgdXBkYXRlIG91dHN0YW5kaW5nUmVxdWVzdHMgY291bnRlcicsIGZ1bmN0aW9uKCkgewogICAgICB2YXIgY2FsbGJhY2sgPSBqYXNtaW5lLmNyZWF0ZVNweSgnZGVmZXJyZWQnKTsKCiAgICAgIGJyb3dzZXIuZGVmZXIoY2FsbGJhY2spOwogICAgICBleHBlY3QoY2FsbGJhY2spLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7CgogICAgICBmYWtlV2luZG93LnNldFRpbWVvdXQuZmx1c2goKTsKICAgICAgZXhwZWN0KGNhbGxiYWNrKS50b0hhdmVCZWVuQ2FsbGVkT25jZSgpOwogICAgfSk7CgoKICAgIGl0KCdzaG91bGQgcmV0dXJuIHVuaXF1ZSBkZWZlcklkJywgZnVuY3Rpb24oKSB7CiAgICAgIHZhciBkZWZlcklkMSA9IGJyb3dzZXIuZGVmZXIobm9vcCksCiAgICAgICAgICBkZWZlcklkMiA9IGJyb3dzZXIuZGVmZXIobm9vcCk7CgogICAgICBleHBlY3QoZGVmZXJJZDEpLnRvQmVEZWZpbmVkKCk7CiAgICAgIGV4cGVjdChkZWZlcklkMikudG9CZURlZmluZWQoKTsKICAgICAgZXhwZWN0KGRlZmVySWQxKS5ub3QudG9FcXVhbChkZWZlcklkMik7CiAgICB9KTsKCgogICAgZGVzY3JpYmUoJ2NhbmNlbCcsIGZ1bmN0aW9uKCkgewogICAgICBpdCgnc2hvdWxkIGFsbG93IHRhc2tzIHRvIGJlIGNhbmNlbGVkIHdpdGggcmV0dXJuZWQgZGVmZXJJZCcsIGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBsb2cgPSBbXSwKICAgICAgICAgICAgZGVmZXJJZDEgPSBicm93c2VyLmRlZmVyKGZ1bmN0aW9uKCkgeyBsb2cucHVzaCgnY2FuY2VsIG1lJyk7IH0pLAogICAgICAgICAgICBkZWZlcklkMiA9IGJyb3dzZXIuZGVmZXIoZnVuY3Rpb24oKSB7IGxvZy5wdXNoKCdvaycpOyB9KSwKICAgICAgICAgICAgZGVmZXJJZDMgPSBicm93c2VyLmRlZmVyKGZ1bmN0aW9uKCkgeyBsb2cucHVzaCgnY2FuY2VsIG1lLCBub3chJyk7IH0pOwoKICAgICAgICBleHBlY3QobG9nKS50b0VxdWFsKFtdKTsKICAgICAgICBleHBlY3QoYnJvd3Nlci5kZWZlci5jYW5jZWwoZGVmZXJJZDEpKS50b0JlKHRydWUpOwogICAgICAgIGV4cGVjdChicm93c2VyLmRlZmVyLmNhbmNlbChkZWZlcklkMykpLnRvQmUodHJ1ZSk7CiAgICAgICAgZmFrZVdpbmRvdy5zZXRUaW1lb3V0LmZsdXNoKCk7CiAgICAgICAgZXhwZWN0KGxvZykudG9FcXVhbChbJ29rJ10pOwogICAgICAgIGV4cGVjdChicm93c2VyLmRlZmVyLmNhbmNlbChkZWZlcklkMikpLnRvQmUoZmFsc2UpOwogICAgICB9KTsKICAgIH0pOwogIH0pOwoKCiAgZGVzY3JpYmUoJ2Nvb2tpZXMnLCBmdW5jdGlvbigpIHsKCiAgICBmdW5jdGlvbiBkZWxldGVBbGxDb29raWVzKCkgewogICAgICB2YXIgY29va2llcyA9IGRvY3VtZW50LmNvb2tpZS5zcGxpdCgiOyIpOwogICAgICB2YXIgcGF0aCA9IGxvY2F0aW9uLnBhdGhuYW1lOwoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjb29raWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFyIGNvb2tpZSA9IGNvb2tpZXNbaV07CiAgICAgICAgdmFyIGVxUG9zID0gY29va2llLmluZGV4T2YoIj0iKTsKICAgICAgICB2YXIgbmFtZSA9IGVxUG9zID4gLTEgPyBjb29raWUuc3Vic3RyKDAsIGVxUG9zKSA6IGNvb2tpZTsKICAgICAgICB2YXIgcGFydHMgPSBwYXRoLnNwbGl0KCcvJyk7CiAgICAgICAgd2hpbGUgKHBhcnRzLmxlbmd0aCkgewogICAgICAgICAgZG9jdW1lbnQuY29va2llID0gbmFtZSArICI9O3BhdGg9IiArIChwYXJ0cy5qb2luKCcvJykgfHwgJy8nKSArICI7ZXhwaXJlcz1UaHUsIDAxIEphbiAxOTcwIDAwOjAwOjAwIEdNVCI7CiAgICAgICAgICBwYXJ0cy5wb3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBiZWZvcmVFYWNoKGZ1bmN0aW9uKCkgewogICAgICBkZWxldGVBbGxDb29raWVzKCk7CiAgICAgIGV4cGVjdChkb2N1bWVudC5jb29raWUpLnRvRXF1YWwoJycpOwogICAgfSk7CgoKICAgIGFmdGVyRWFjaChmdW5jdGlvbigpIHsKICAgICAgZGVsZXRlQWxsQ29va2llcygpOwogICAgICBleHBlY3QoZG9jdW1lbnQuY29va2llKS50b0VxdWFsKCcnKTsKICAgIH0pOwoKCiAgICBkZXNjcmliZSgncmVtb3ZlIGFsbCB2aWEgKG51bGwpJywgZnVuY3Rpb24oKSB7CgogICAgICBpdCgnc2hvdWxkIGRvIG5vdGhpbmcgd2hlbiBubyBjb29raWVzIGFyZSBzZXQnLCBmdW5jdGlvbigpIHsKICAgICAgICBicm93c2VyLmNvb2tpZXMobnVsbCk7CiAgICAgICAgZXhwZWN0KGRvY3VtZW50LmNvb2tpZSkudG9FcXVhbCgnJyk7CiAgICAgICAgZXhwZWN0KGJyb3dzZXIuY29va2llcygpKS50b0VxdWFsKHt9KTsKICAgICAgfSk7CgogICAgfSk7CgogICAgZGVzY3JpYmUoJ3JlbW92ZSB2aWEgY29va2llcyhjb29raWVOYW1lLCB1bmRlZmluZWQpJywgZnVuY3Rpb24oKSB7CgogICAgICBpdCgnc2hvdWxkIHJlbW92ZSBhIGNvb2tpZSB3aGVuIGl0IGlzIHByZXNlbnQnLCBmdW5jdGlvbigpIHsKICAgICAgICBkb2N1bWVudC5jb29raWUgPSAnZm9vPWJhcjtwYXRoPS8nOwoKICAgICAgICBicm93c2VyLmNvb2tpZXMoJ2ZvbycsIHVuZGVmaW5lZCk7CgogICAgICAgIGV4cGVjdChkb2N1bWVudC5jb29raWUpLnRvRXF1YWwoJycpOwogICAgICAgIGV4cGVjdChicm93c2VyLmNvb2tpZXMoKSkudG9FcXVhbCh7fSk7CiAgICAgIH0pOwoKCiAgICAgIGl0KCdzaG91bGQgZG8gbm90aGluZyB3aGVuIGFuIG5vbmV4aXN0aW5nIGNvb2tpZSBpcyBiZWluZyByZW1vdmVkJywgZnVuY3Rpb24oKSB7CiAgICAgICAgYnJvd3Nlci5jb29raWVzKCdkb2VzbnRleGlzdCcsIHVuZGVmaW5lZCk7CiAgICAgICAgZXhwZWN0KGRvY3VtZW50LmNvb2tpZSkudG9FcXVhbCgnJyk7CiAgICAgICAgZXhwZWN0KGJyb3dzZXIuY29va2llcygpKS50b0VxdWFsKHt9KTsKICAgICAgfSk7CiAgICB9KTsKCgogICAgZGVzY3JpYmUoJ3B1dCB2aWEgY29va2llcyhjb29raWVOYW1lLCBzdHJpbmcpJywgZnVuY3Rpb24oKSB7CgogICAgICBpdCgnc2hvdWxkIGNyZWF0ZSBhbmQgc3RvcmUgYSBjb29raWUnLCBmdW5jdGlvbigpIHsKICAgICAgICBicm93c2VyLmNvb2tpZXMoJ2Nvb2tpZU5hbWUnLCAnY29va2llPVZhbHVlJyk7CiAgICAgICAgZXhwZWN0KGRvY3VtZW50LmNvb2tpZSkudG9NYXRjaCgvY29va2llTmFtZT1jb29raWUlM0RWYWx1ZTs/ID8vKTsKICAgICAgICBleHBlY3QoYnJvd3Nlci5jb29raWVzKCkpLnRvRXF1YWwoeydjb29raWVOYW1lJzonY29va2llPVZhbHVlJ30pOwogICAgICB9KTsKCgogICAgICBpdCgnc2hvdWxkIG92ZXJ3cml0ZSBhbiBleGlzdGluZyB1bnN5bmNlZCBjb29raWUnLCBmdW5jdGlvbigpIHsKICAgICAgICBkb2N1bWVudC5jb29raWUgPSAiY29va2llPW5ldztwYXRoPS8iOwoKICAgICAgICB2YXIgb2xkVmFsID0gYnJvd3Nlci5jb29raWVzKCdjb29raWUnLCAnbmV3ZXInKTsKCiAgICAgICAgZXhwZWN0KGRvY3VtZW50LmNvb2tpZSkudG9FcXVhbCgnY29va2llPW5ld2VyJyk7CiAgICAgICAgZXhwZWN0KGJyb3dzZXIuY29va2llcygpKS50b0VxdWFsKHsnY29va2llJzonbmV3ZXInfSk7CiAgICAgICAgZXhwZWN0KG9sZFZhbCkubm90LnRvQmVEZWZpbmVkKCk7CiAgICAgIH0pOwoKICAgICAgaXQoJ3Nob3VsZCBlbmNvZGUgYm90aCBuYW1lIGFuZCB2YWx1ZScsIGZ1bmN0aW9uKCkgewogICAgICAgIGJyb3dzZXIuY29va2llcygnY29va2llMT0nLCAndmFsO3VlJyk7CiAgICAgICAgYnJvd3Nlci5jb29raWVzKCdjb29raWUyPWJhcjtiYXonLCAndmFsPXVlJyk7CgogICAgICAgIHZhciByYXdDb29raWVzID0gZG9jdW1lbnQuY29va2llLnNwbGl0KCI7ICIpOyAvL29yZGVyIGlzIG5vdCBndWFyYW50ZWVkLCBzbyB3ZSBuZWVkIHRvIHBhcnNlCiAgICAgICAgZXhwZWN0KHJhd0Nvb2tpZXMubGVuZ3RoKS50b0VxdWFsKDIpOwogICAgICAgIGV4cGVjdChyYXdDb29raWVzKS50b0NvbnRhaW4oJ2Nvb2tpZTElM0Q9dmFsJTNCdWUnKTsKICAgICAgICBleHBlY3QocmF3Q29va2llcykudG9Db250YWluKCdjb29raWUyJTNEYmFyJTNCYmF6PXZhbCUzRHVlJyk7CiAgICAgIH0pOwoKICAgICAgaXQoJ3Nob3VsZCBsb2cgd2FybmluZ3Mgd2hlbiA0a2IgcGVyIGNvb2tpZSBzdG9yYWdlIGxpbWl0IGlzIHJlYWNoZWQnLCBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgaSwgbG9uZ1ZhbCA9ICcnLCBjb29raWVTdHI7CgogICAgICAgIGZvciAoaT0wOyBpPDQwODM7IGkrKykgewogICAgICAgICAgbG9uZ1ZhbCArPSAneCc7CiAgICAgICAgfQoKICAgICAgICBjb29raWVTdHIgPSBkb2N1bWVudC5jb29raWU7CiAgICAgICAgYnJvd3Nlci5jb29raWVzKCd4JywgbG9uZ1ZhbCk7IC8vdG90YWwgc2l6ZSA0MDkzLTQwOTYsIHNvIGl0IHNob3VsZCBnbyB0aHJvdWdoCiAgICAgICAgZXhwZWN0KGRvY3VtZW50LmNvb2tpZSkubm90LnRvRXF1YWwoY29va2llU3RyKTsKICAgICAgICBleHBlY3QoYnJvd3Nlci5jb29raWVzKClbJ3gnXSkudG9FcXVhbChsb25nVmFsKTsKICAgICAgICBleHBlY3QobG9ncy53YXJuKS50b0VxdWFsKFtdKTsKCiAgICAgICAgYnJvd3Nlci5jb29raWVzKCd4JywgbG9uZ1ZhbCArICd4eHh4Jyk7IC8vdG90YWwgc2l6ZSA0MDk3LTQwOTksIGEgd2FybmluZyBzaG91bGQgYmUgbG9nZ2VkCiAgICAgICAgZXhwZWN0KGxvZ3Mud2FybikudG9FcXVhbCgKICAgICAgICAgIFtbIkNvb2tpZSAneCcgcG9zc2libHkgbm90IHNldCBvciBvdmVyZmxvd2VkIGJlY2F1c2UgaXQgd2FzIHRvbyBsYXJnZSAoNDA5NyA+IDQwOTYgIiArCiAgICAgICAgICAgICAiYnl0ZXMpISJdXSk7CgogICAgICAgIC8vZm9yY2UgYnJvd3NlciB0byBkcm9wcGVkIGEgY29va2llIGFuZCBtYWtlIHN1cmUgdGhhdCB0aGUgY2FjaGUgaXMgbm90IG91dCBvZiBzeW5jCiAgICAgICAgYnJvd3Nlci5jb29raWVzKCd4JywgJ3Nob3J0VmFsJyk7CiAgICAgICAgZXhwZWN0KGJyb3dzZXIuY29va2llcygpLngpLnRvRXF1YWwoJ3Nob3J0VmFsJyk7IC8vbmVlZGVkIHRvIHByaW1lIHRoZSBjYWNoZQogICAgICAgIGNvb2tpZVN0ciA9IGRvY3VtZW50LmNvb2tpZTsKICAgICAgICBicm93c2VyLmNvb2tpZXMoJ3gnLCBsb25nVmFsICsgbG9uZ1ZhbCArIGxvbmdWYWwpOyAvL3Nob3VsZCBiZSB0b28gbG9uZyBmb3IgYWxsIGJyb3dzZXJzCgogICAgICAgIGlmIChkb2N1bWVudC5jb29raWUgIT09IGNvb2tpZVN0cikgewogICAgICAgICAgdGhpcy5mYWlsKG5ldyBFcnJvcigiYnJvd3NlciBkaWRuJ3QgZHJvcCBsb25nIGNvb2tpZSB3aGVuIGl0IHdhcyBleHBlY3RlZC4gbWFrZSB0aGUgIiArCiAgICAgICAgICAgICAgImNvb2tpZSBpbiB0aGlzIHRlc3QgbG9uZ2VyIikpOwogICAgICAgIH0KCiAgICAgICAgZXhwZWN0KGJyb3dzZXIuY29va2llcygpLngpLnRvRXF1YWwoJ3Nob3J0VmFsJyk7CiAgICAgIH0pOwogICAgfSk7CgogICAgZGVzY3JpYmUoJ3B1dCB2aWEgY29va2llcyhjb29raWVOYW1lLCBzdHJpbmcpLCBpZiBubyA8YmFzZSBocmVmPiAnLCBmdW5jdGlvbigpIHsKICAgICAgYmVmb3JlRWFjaChmdW5jdGlvbigpIHsKICAgICAgICBmYWtlRG9jdW1lbnQuYmFzZVBhdGggPSB1bmRlZmluZWQ7CiAgICAgIH0pOwoKICAgICAgaXQoJ3Nob3VsZCBkZWZhdWx0IHBhdGggaW4gY29va2llIHRvICIiIChlbXB0eSBzdHJpbmcpJywgZnVuY3Rpb24oKSB7CiAgICAgICAgYnJvd3Nlci5jb29raWVzKCdjb29raWUnLCAnYmVuZGVyJyk7CiAgICAgICAgLy8gVGhpcyBvbmx5IGZhaWxzIGluIFNhZmFyaSBhbmQgSUUgd2hlbiBjb29raWVQYXRoIHJldHVybnMgdW5kZWZpbmVkCiAgICAgICAgLy8gV2hlcmUgaXQgbm93IHN1Y2NlZWRzIHNpbmNlIGJhc2VIcmVmIHJldHVybiAnJyBpbnN0ZWFkIG9mIHVuZGVmaW5lZAogICAgICAgIGV4cGVjdChkb2N1bWVudC5jb29raWUpLnRvRXF1YWwoJ2Nvb2tpZT1iZW5kZXInKTsKICAgICAgfSk7CiAgICB9KTsKCiAgICBkZXNjcmliZSgnZ2V0IHZpYSBjb29raWVzKClbY29va2llTmFtZV0nLCBmdW5jdGlvbigpIHsKCiAgICAgIGl0KCdzaG91bGQgcmV0dXJuIHVuZGVmaW5lZCBmb3Igbm9uZXhpc3RlbnQgY29va2llJywgZnVuY3Rpb24oKSB7CiAgICAgICAgZXhwZWN0KGJyb3dzZXIuY29va2llcygpLm5vbmV4aXN0ZW50KS5ub3QudG9CZURlZmluZWQoKTsKICAgICAgfSk7CgoKICAgICAgaXQgKCdzaG91bGQgcmV0dXJuIGEgdmFsdWUgZm9yIGFuIGV4aXN0aW5nIGNvb2tpZScsIGZ1bmN0aW9uKCkgewogICAgICAgIGRvY3VtZW50LmNvb2tpZSA9ICJmb289YmFyPWJhejtwYXRoPS8iOwogICAgICAgIGV4cGVjdChicm93c2VyLmNvb2tpZXMoKS5mb28pLnRvRXF1YWwoJ2Jhcj1iYXonKTsKICAgICAgfSk7CgogICAgICBpdCgnc2hvdWxkIHJldHVybiB0aGUgdGhlIGZpcnN0IHZhbHVlIHByb3ZpZGVkIGZvciBhIGNvb2tpZScsIGZ1bmN0aW9uKCkgewogICAgICAgIC8vIEZvciBhIGNvb2tpZSB0aGF0IGhhcyBkaWZmZXJlbnQgdmFsdWVzIHRoYXQgZGlmZmVyIGJ5IHBhdGgsIHRoZQogICAgICAgIC8vIHZhbHVlIGZvciB0aGUgbW9zdCBzcGVjaWZpYyBwYXRoIGFwcGVhcnMgZmlyc3QuICBicm93c2VyLmNvb2tpZXMoKQogICAgICAgIC8vIHNob3VsZCBwcm92aWRlIHRoYXQgdmFsdWUgZm9yIHRoZSBjb29raWUuCiAgICAgICAgZG9jdW1lbnQuY29va2llID0gJ2Zvbz0iZmlyc3QiOyBmb289InNlY29uZCInOwogICAgICAgIGV4cGVjdChicm93c2VyLmNvb2tpZXMoKVsnZm9vJ10pLnRvQmUoJyJmaXJzdCInKTsKICAgICAgfSk7CgogICAgICBpdCAoJ3Nob3VsZCBkZWNvZGUgY29va2llIHZhbHVlcyB0aGF0IHdlcmUgZW5jb2RlZCBieSBwdXRzJywgZnVuY3Rpb24oKSB7CiAgICAgICAgZG9jdW1lbnQuY29va2llID0gImNvb2tpZTIlM0RiYXIlM0JiYXo9dmFsJTNEdWU7cGF0aD0vIjsKICAgICAgICBleHBlY3QoYnJvd3Nlci5jb29raWVzKClbJ2Nvb2tpZTI9YmFyO2JheiddKS50b0VxdWFsKCd2YWw9dWUnKTsKICAgICAgfSk7CgoKICAgICAgaXQoJ3Nob3VsZCBwcmVzZXJ2ZSBsZWFkaW5nICYgdHJhaWxpbmcgc3BhY2VzIGluIG5hbWVzIGFuZCB2YWx1ZXMnLCBmdW5jdGlvbigpIHsKICAgICAgICBicm93c2VyLmNvb2tpZXMoJyBjb29raWUgbmFtZSAnLCAnIGNvb2tpZSB2YWx1ZSAnKTsKICAgICAgICBleHBlY3QoYnJvd3Nlci5jb29raWVzKClbJyBjb29raWUgbmFtZSAnXSkudG9FcXVhbCgnIGNvb2tpZSB2YWx1ZSAnKTsKICAgICAgICBleHBlY3QoYnJvd3Nlci5jb29raWVzKClbJ2Nvb2tpZSBuYW1lJ10pLm5vdC50b0JlRGVmaW5lZCgpOwogICAgICB9KTsKCiAgICAgIGl0KCdzaG91bGQgZGVjb2RlIHNwZWNpYWwgY2hhcmFjdGVycyBpbiBjb29raWUgdmFsdWVzJywgZnVuY3Rpb24oKSB7CiAgICAgICAgZG9jdW1lbnQuY29va2llID0gJ2Nvb2tpZV9uYW1lPWNvb2tpZV92YWx1ZV8lRTIlODIlQUMnOwogICAgICAgIGV4cGVjdChicm93c2VyLmNvb2tpZXMoKVsnY29va2llX25hbWUnXSkudG9FcXVhbCgnY29va2llX3ZhbHVlX+KCrCcpOwogICAgICB9KTsKCiAgICAgIGl0KCdzaG91bGQgbm90IGRlY29kZSBjb29raWUgdmFsdWVzIHRoYXQgZG8gbm90IGFwcGVhciB0byBiZSBlbmNvZGVkJywgZnVuY3Rpb24oKSB7CiAgICAgICAgLy8gc2VlICM5MjExIC0gc29tZXRpbWVzIGNvb2tpZXMgY29udGFpbiBhIHZhbHVlIHRoYXQgY2F1c2VzIGRlY29kZVVSSUNvbXBvbmVudCB0byB0aHJvdwogICAgICAgIGRvY3VtZW50LmNvb2tpZSA9ICdjb29raWVfbmFtZT1jb29raWVfdmFsdWVfJVhYJzsKICAgICAgICBleHBlY3QoYnJvd3Nlci5jb29raWVzKClbJ2Nvb2tpZV9uYW1lJ10pLnRvRXF1YWwoJ2Nvb2tpZV92YWx1ZV8lWFgnKTsKICAgICAgfSk7CiAgICB9KTsKCgogICAgZGVzY3JpYmUoJ2dldEFsbCB2aWEgY29va2llcygpJywgZnVuY3Rpb24oKSB7CgogICAgICBpdCgnc2hvdWxkIHJldHVybiBjb29raWVzIGFzIGhhc2gnLCBmdW5jdGlvbigpIHsKICAgICAgICBkb2N1bWVudC5jb29raWUgPSAiZm9vMT1iYXIxO3BhdGg9LyI7CiAgICAgICAgZG9jdW1lbnQuY29va2llID0gImZvbzI9YmFyMjtwYXRoPS8iOwogICAgICAgIGV4cGVjdChicm93c2VyLmNvb2tpZXMoKSkudG9FcXVhbCh7J2ZvbzEnOidiYXIxJywgJ2ZvbzInOidiYXIyJ30pOwogICAgICB9KTsKCgogICAgICBpdCgnc2hvdWxkIHJldHVybiBlbXB0eSBoYXNoIGlmIG5vIGNvb2tpZXMgZXhpc3QnLCBmdW5jdGlvbigpIHsKICAgICAgICBleHBlY3QoYnJvd3Nlci5jb29raWVzKCkpLnRvRXF1YWwoe30pOwogICAgICB9KTsKICAgIH0pOwoKCiAgICBpdCgnc2hvdWxkIHBpY2sgdXAgZXh0ZXJuYWwgY2hhbmdlcyBtYWRlIHRvIGJyb3dzZXIgY29va2llcycsIGZ1bmN0aW9uKCkgewogICAgICBicm93c2VyLmNvb2tpZXMoJ29hdG1lYWxDb29raWUnLCAnZHJvb2wnKTsKICAgICAgZXhwZWN0KGJyb3dzZXIuY29va2llcygpKS50b0VxdWFsKHsnb2F0bWVhbENvb2tpZSc6J2Ryb29sJ30pOwoKICAgICAgZG9jdW1lbnQuY29va2llID0gJ29hdG1lYWxDb29raWU9Y2hhbmdlZDtwYXRoPS8nOwogICAgICBleHBlY3QoYnJvd3Nlci5jb29raWVzKCkub2F0bWVhbENvb2tpZSkudG9FcXVhbCgnY2hhbmdlZCcpOwogICAgfSk7CgoKICAgIGl0KCdzaG91bGQgaW5pdGlhbGl6ZSBjb29raWUgY2FjaGUgd2l0aCBleGlzdGluZyBjb29raWVzJywgZnVuY3Rpb24oKSB7CiAgICAgIGRvY3VtZW50LmNvb2tpZSA9ICJleGlzdGluZ0Nvb2tpZT1leGlzdGluZ1ZhbHVlO3BhdGg9LyI7CiAgICAgIGV4cGVjdChicm93c2VyLmNvb2tpZXMoKSkudG9FcXVhbCh7J2V4aXN0aW5nQ29va2llJzonZXhpc3RpbmdWYWx1ZSd9KTsKICAgIH0pOwoKICB9KTsKCiAgZGVzY3JpYmUoJ3BvbGxlcicsIGZ1bmN0aW9uKCkgewoKICAgIGl0KCdzaG91bGQgY2FsbCBmdW5jdGlvbnMgaW4gcG9sbEZucyBpbiByZWd1bGFyIGludGVydmFscycsIGZ1bmN0aW9uKCkgewogICAgICB2YXIgbG9nID0gJyc7CiAgICAgIGJyb3dzZXIuYWRkUG9sbEZuKGZ1bmN0aW9uKCkge2xvZys9J2EnO30pOwogICAgICBicm93c2VyLmFkZFBvbGxGbihmdW5jdGlvbigpIHtsb2crPSdiJzt9KTsKICAgICAgZXhwZWN0KGxvZykudG9FcXVhbCgnJyk7CiAgICAgIGZha2VXaW5kb3cuc2V0VGltZW91dC5mbHVzaCgpOwogICAgICBleHBlY3QobG9nKS50b0VxdWFsKCdhYicpOwogICAgICBmYWtlV2luZG93LnNldFRpbWVvdXQuZmx1c2goKTsKICAgICAgZXhwZWN0KGxvZykudG9FcXVhbCgnYWJhYicpOwogICAgfSk7CgogICAgaXQoJ3Nob3VsZCBzdGFydFBvbGxlcicsIGZ1bmN0aW9uKCkgewogICAgICBleHBlY3QoZmFrZVdpbmRvdy50aW1lb3V0cy5sZW5ndGgpLnRvRXF1YWwoMCk7CgogICAgICBicm93c2VyLmFkZFBvbGxGbihmdW5jdGlvbigpIHt9KTsKICAgICAgZXhwZWN0KGZha2VXaW5kb3cudGltZW91dHMubGVuZ3RoKS50b0VxdWFsKDEpOwoKICAgICAgLy9zaG91bGQgcmVtYWluIDEgYXMgaXQgaXMgdGhlIGNoZWNrIGZuCiAgICAgIGJyb3dzZXIuYWRkUG9sbEZuKGZ1bmN0aW9uKCkge30pOwogICAgICBleHBlY3QoZmFrZVdpbmRvdy50aW1lb3V0cy5sZW5ndGgpLnRvRXF1YWwoMSk7CiAgICB9KTsKCiAgICBpdCgnc2hvdWxkIHJldHVybiBmbiB0aGF0IHdhcyBwYXNzZWQgaW50byBhZGRQb2xsRm4nLCBmdW5jdGlvbigpIHsKICAgICAgdmFyIGZuID0gZnVuY3Rpb24oKSB7IHJldHVybiAxOyB9OwogICAgICB2YXIgcmV0dXJuZWRGbiA9IGJyb3dzZXIuYWRkUG9sbEZuKGZuKTsKICAgICAgZXhwZWN0KHJldHVybmVkRm4pLnRvQmUoZm4pOwogICAgfSk7CiAgfSk7CgogIGRlc2NyaWJlKCd1cmwnLCBmdW5jdGlvbigpIHsKICAgIHZhciBwdXNoU3RhdGUsIHJlcGxhY2VTdGF0ZSwgbG9jYXRpb25SZXBsYWNlOwoKICAgIGJlZm9yZUVhY2goZnVuY3Rpb24oKSB7CiAgICAgIHB1c2hTdGF0ZSA9IHNweU9uKGZha2VXaW5kb3cuaGlzdG9yeSwgJ3B1c2hTdGF0ZScpOwogICAgICByZXBsYWNlU3RhdGUgPSBzcHlPbihmYWtlV2luZG93Lmhpc3RvcnksICdyZXBsYWNlU3RhdGUnKTsKICAgICAgbG9jYXRpb25SZXBsYWNlID0gc3B5T24oZmFrZVdpbmRvdy5sb2NhdGlvbiwgJ3JlcGxhY2UnKTsKICAgIH0pOwoKICAgIGl0KCdzaG91bGQgcmV0dXJuIGN1cnJlbnQgbG9jYXRpb24uaHJlZicsIGZ1bmN0aW9uKCkgewogICAgICBmYWtlV2luZG93LmxvY2F0aW9uLmhyZWYgPSAnaHR0cDovL3Rlc3QuY29tJzsKICAgICAgZXhwZWN0KGJyb3dzZXIudXJsKCkpLnRvRXF1YWwoJ2h0dHA6Ly90ZXN0LmNvbScpOwoKICAgICAgZmFrZVdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJ2h0dHBzOi8vYW5vdGhlci5jb20nOwogICAgICBleHBlY3QoYnJvd3Nlci51cmwoKSkudG9FcXVhbCgnaHR0cHM6Ly9hbm90aGVyLmNvbScpOwogICAgfSk7CgogICAgaXQoJ3Nob3VsZCB1c2UgaGlzdG9yeS5wdXNoU3RhdGUgd2hlbiBhdmFpbGFibGUnLCBmdW5jdGlvbigpIHsKICAgICAgc25pZmZlci5oaXN0b3J5ID0gdHJ1ZTsKICAgICAgYnJvd3Nlci51cmwoJ2h0dHA6Ly9uZXcub3JnJyk7CgogICAgICBleHBlY3QocHVzaFN0YXRlKS50b0hhdmVCZWVuQ2FsbGVkT25jZSgpOwogICAgICBleHBlY3QocHVzaFN0YXRlLmFyZ3NGb3JDYWxsWzBdWzJdKS50b0VxdWFsKCdodHRwOi8vbmV3Lm9yZycpOwoKICAgICAgZXhwZWN0KHJlcGxhY2VTdGF0ZSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTsKICAgICAgZXhwZWN0KGxvY2F0aW9uUmVwbGFjZSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTsKICAgICAgZXhwZWN0KGZha2VXaW5kb3cubG9jYXRpb24uaHJlZikudG9FcXVhbCgnaHR0cDovL3NlcnZlci8nKTsKICAgIH0pOwoKICAgIGl0KCdzaG91bGQgdXNlIGhpc3RvcnkucmVwbGFjZVN0YXRlIHdoZW4gYXZhaWxhYmxlJywgZnVuY3Rpb24oKSB7CiAgICAgIHNuaWZmZXIuaGlzdG9yeSA9IHRydWU7CiAgICAgIGJyb3dzZXIudXJsKCdodHRwOi8vbmV3Lm9yZycsIHRydWUpOwoKICAgICAgZXhwZWN0KHJlcGxhY2VTdGF0ZSkudG9IYXZlQmVlbkNhbGxlZE9uY2UoKTsKICAgICAgZXhwZWN0KHJlcGxhY2VTdGF0ZS5hcmdzRm9yQ2FsbFswXVsyXSkudG9FcXVhbCgnaHR0cDovL25ldy5vcmcnKTsKCiAgICAgIGV4cGVjdChwdXNoU3RhdGUpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7CiAgICAgIGV4cGVjdChsb2NhdGlvblJlcGxhY2UpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7CiAgICAgIGV4cGVjdChmYWtlV2luZG93LmxvY2F0aW9uLmhyZWYpLnRvRXF1YWwoJ2h0dHA6Ly9zZXJ2ZXIvJyk7CiAgICB9KTsKCiAgICBpdCgnc2hvdWxkIHNldCBsb2NhdGlvbi5ocmVmIHdoZW4gcHVzaFN0YXRlIG5vdCBhdmFpbGFibGUnLCBmdW5jdGlvbigpIHsKICAgICAgc25pZmZlci5oaXN0b3J5ID0gZmFsc2U7CiAgICAgIGJyb3dzZXIudXJsKCdodHRwOi8vbmV3Lm9yZycpOwoKICAgICAgZXhwZWN0KGZha2VXaW5kb3cubG9jYXRpb24uaHJlZikudG9FcXVhbCgnaHR0cDovL25ldy5vcmcnKTsKCiAgICAgIGV4cGVjdChwdXNoU3RhdGUpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7CiAgICAgIGV4cGVjdChyZXBsYWNlU3RhdGUpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7CiAgICAgIGV4cGVjdChsb2NhdGlvblJlcGxhY2UpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7CiAgICB9KTsKCiAgICBpdCgnc2hvdWxkIHNldCBsb2NhdGlvbi5ocmVmIGFuZCBub3QgdXNlIHB1c2hTdGF0ZSB3aGVuIHRoZSB1cmwgb25seSBjaGFuZ2VkIGluIHRoZSBoYXNoIGZyYWdtZW50IHRvIHBsZWFzZSBJRTEwLzExJywgZnVuY3Rpb24oKSB7CiAgICAgIHNuaWZmZXIuaGlzdG9yeSA9IHRydWU7CiAgICAgIGJyb3dzZXIudXJsKCdodHRwOi8vc2VydmVyLyMxMjMnKTsKCiAgICAgIGV4cGVjdChmYWtlV2luZG93LmxvY2F0aW9uLmhyZWYpLnRvRXF1YWwoJ2h0dHA6Ly9zZXJ2ZXIvIzEyMycpOwoKICAgICAgZXhwZWN0KHB1c2hTdGF0ZSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTsKICAgICAgZXhwZWN0KHJlcGxhY2VTdGF0ZSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTsKICAgICAgZXhwZWN0KGxvY2F0aW9uUmVwbGFjZSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTsKICAgIH0pOwoKICAgIGl0KCdzaG91bGQgdXNlIGxvY2F0aW9uLnJlcGxhY2Ugd2hlbiBoaXN0b3J5LnJlcGxhY2VTdGF0ZSBub3QgYXZhaWxhYmxlJywgZnVuY3Rpb24oKSB7CiAgICAgIHNuaWZmZXIuaGlzdG9yeSA9IGZhbHNlOwogICAgICBicm93c2VyLnVybCgnaHR0cDovL25ldy5vcmcnLCB0cnVlKTsKCiAgICAgIGV4cGVjdChsb2NhdGlvblJlcGxhY2UpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdodHRwOi8vbmV3Lm9yZycpOwoKICAgICAgZXhwZWN0KHB1c2hTdGF0ZSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTsKICAgICAgZXhwZWN0KHJlcGxhY2VTdGF0ZSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTsKICAgICAgZXhwZWN0KGZha2VXaW5kb3cubG9jYXRpb24uaHJlZikudG9FcXVhbCgnaHR0cDovL3NlcnZlci8nKTsKICAgIH0pOwoKICAgIGl0KCdzaG91bGQgdXNlIGxvY2F0aW9uLnJlcGxhY2UgYW5kIG5vdCB1c2UgcmVwbGFjZVN0YXRlIHdoZW4gdGhlIHVybCBvbmx5IGNoYW5nZWQgaW4gdGhlIGhhc2ggZnJhZ21lbnQgdG8gcGxlYXNlIElFMTAvMTEnLCBmdW5jdGlvbigpIHsKICAgICAgc25pZmZlci5oaXN0b3J5ID0gdHJ1ZTsKICAgICAgYnJvd3Nlci51cmwoJ2h0dHA6Ly9zZXJ2ZXIvIzEyMycsIHRydWUpOwoKICAgICAgZXhwZWN0KGxvY2F0aW9uUmVwbGFjZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2h0dHA6Ly9zZXJ2ZXIvIzEyMycpOwoKICAgICAgZXhwZWN0KHB1c2hTdGF0ZSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTsKICAgICAgZXhwZWN0KHJlcGxhY2VTdGF0ZSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTsKICAgICAgZXhwZWN0KGZha2VXaW5kb3cubG9jYXRpb24uaHJlZikudG9FcXVhbCgnaHR0cDovL3NlcnZlci8nKTsKICAgIH0pOwoKICAgIGl0KCdzaG91bGQgcmV0dXJuICRicm93c2VyIHRvIGFsbG93IGNoYWluaW5nJywgZnVuY3Rpb24oKSB7CiAgICAgIGV4cGVjdChicm93c2VyLnVybCgnaHR0cDovL2FueS5jb20nKSkudG9CZShicm93c2VyKTsKICAgIH0pOwoKCiAgICBpdCgnc2hvdWxkIGRlY29kZSBzaW5nbGUgcXVvdGVzIHRvIHdvcmsgYXJvdW5kIEZGIGJ1ZyA0MDcyNzMnLCBmdW5jdGlvbigpIHsKICAgICAgZmFrZVdpbmRvdy5sb2NhdGlvbi5ocmVmID0gImh0dHA6Ly9mZi1idWcvP3NpbmdsZSUyN3F1b3RlIjsKICAgICAgZXhwZWN0KGJyb3dzZXIudXJsKCkpLnRvQmUoImh0dHA6Ly9mZi1idWcvP3NpbmdsZSdxdW90ZSIpOwogICAgfSk7CgogICAgaXQoJ3Nob3VsZCBub3Qgc2V0IFVSTCB3aGVuIHRoZSBVUkwgaXMgYWxyZWFkeSBzZXQnLCBmdW5jdGlvbigpIHsKICAgICAgdmFyIGN1cnJlbnQgPSBmYWtlV2luZG93LmxvY2F0aW9uLmhyZWY7CiAgICAgIHNuaWZmZXIuaGlzdG9yeSA9IGZhbHNlOwogICAgICBmYWtlV2luZG93LmxvY2F0aW9uLmhyZWYgPSAnZG9udGNoYW5nZSc7CiAgICAgIGJyb3dzZXIudXJsKGN1cnJlbnQpOwogICAgICBleHBlY3QoZmFrZVdpbmRvdy5sb2NhdGlvbi5ocmVmKS50b0JlKCdkb250Y2hhbmdlJyk7CiAgICB9KTsKCiAgICBpdCgnc2hvdWxkIG5vdCByZWFkIG91dCBsb2NhdGlvbi5ocmVmIGlmIGEgcmVsb2FkIHdhcyB0cmlnZ2VyZWQgYnV0IHN0aWxsIGFsbG93IHRvIGNoYW5nZSB0aGUgdXJsJywgZnVuY3Rpb24oKSB7CiAgICAgIHNuaWZmZXIuaGlzdG9yeSA9IGZhbHNlOwogICAgICBicm93c2VyLnVybCgnaHR0cDovL3NlcnZlci9zb21lT3RoZXJVcmxUaGF0Q2F1c2VzUmVsb2FkJyk7CiAgICAgIGV4cGVjdChmYWtlV2luZG93LmxvY2F0aW9uLmhyZWYpLnRvQmUoJ2h0dHA6Ly9zZXJ2ZXIvc29tZU90aGVyVXJsVGhhdENhdXNlc1JlbG9hZCcpOwoKICAgICAgZmFrZVdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJ2h0dHA6Ly9zb21lTmV3VXJsJzsKICAgICAgZXhwZWN0KGJyb3dzZXIudXJsKCkpLnRvQmUoJ2h0dHA6Ly9zZXJ2ZXIvc29tZU90aGVyVXJsVGhhdENhdXNlc1JlbG9hZCcpOwoKICAgICAgYnJvd3Nlci51cmwoJ2h0dHA6Ly9zZXJ2ZXIvc29tZU90aGVyVXJsJyk7CiAgICAgIGV4cGVjdChicm93c2VyLnVybCgpKS50b0JlKCdodHRwOi8vc2VydmVyL3NvbWVPdGhlclVybCcpOwogICAgICBleHBlY3QoZmFrZVdpbmRvdy5sb2NhdGlvbi5ocmVmKS50b0JlKCdodHRwOi8vc2VydmVyL3NvbWVPdGhlclVybCcpOwogICAgfSk7CgogICAgaXQoJ2Fzc3VtZXMgdGhhdCBjaGFuZ2VzIHRvIGxvY2F0aW9uLmhhc2ggb2NjdXIgaW4gc3luYycsIGZ1bmN0aW9uKCkgewogICAgICAvLyBUaGlzIGlzIGFuIGFzeW5jaHJvbm91cyBpbnRlZ3JhdGlvbiB0ZXN0IHRoYXQgY2hhbmdlcyB0aGUKICAgICAgLy8gaGFzaCBpbiBhbGwgcG9zc2libGUgd2F5cyBhbmQgY2hlY2tzCiAgICAgIC8vIC0gd2hldGhlciB0aGUgY2hhbmdlIHRvIHRoZSBoYXNoIGNhbiBiZSByZWFkIG91dCBpbiBzeW5jCiAgICAgIC8vIC0gd2hldGhlciB0aGUgY2hhbmdlIHRvIHRoZSBoYXNoIGNhbiBiZSByZWFkIG91dCBpbiB0aGUgaGFzaGNoYW5nZSBldmVudAogICAgICB2YXIgcmVhbFdpbiA9IHdpbmRvdywKICAgICAgICAgICRyZWFsV2luID0ganFMaXRlKHJlYWxXaW4pLAogICAgICAgICAgaGFzaEluSGFzaENoYW5nZUV2ZW50ID0gW107CgogICAgICBydW5zKGZ1bmN0aW9uKCkgewogICAgICAgICRyZWFsV2luLm9uKCdoYXNoY2hhbmdlJywgaGFzaExpc3RlbmVyKTsKCiAgICAgICAgcmVhbFdpbi5sb2NhdGlvbi5oYXNoID0gJzEnOwogICAgICAgIHJlYWxXaW4ubG9jYXRpb24uaHJlZiArPSAnMic7CiAgICAgICAgcmVhbFdpbi5sb2NhdGlvbi5yZXBsYWNlKHJlYWxXaW4ubG9jYXRpb24uaHJlZiArICczJyk7CiAgICAgICAgcmVhbFdpbi5sb2NhdGlvbi5hc3NpZ24ocmVhbFdpbi5sb2NhdGlvbi5ocmVmICsgJzQnKTsKCiAgICAgICAgZXhwZWN0KHJlYWxXaW4ubG9jYXRpb24uaGFzaCkudG9CZSgnIzEyMzQnKTsKICAgICAgfSk7CiAgICAgIHdhaXRzRm9yKGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBoYXNoSW5IYXNoQ2hhbmdlRXZlbnQubGVuZ3RoID4gMzsKICAgICAgfSk7CiAgICAgIHJ1bnMoZnVuY3Rpb24oKSB7CiAgICAgICAgJHJlYWxXaW4ub2ZmKCdoYXNoY2hhbmdlJywgaGFzaExpc3RlbmVyKTsKCiAgICAgICAgZm9yRWFjaChoYXNoSW5IYXNoQ2hhbmdlRXZlbnQsIGZ1bmN0aW9uKGhhc2gpIHsKICAgICAgICAgIGV4cGVjdChoYXNoKS50b0JlKCcjMTIzNCcpOwogICAgICAgIH0pOwogICAgICB9KTsKCiAgICAgIGZ1bmN0aW9uIGhhc2hMaXN0ZW5lcigpIHsKICAgICAgICBoYXNoSW5IYXNoQ2hhbmdlRXZlbnQucHVzaChyZWFsV2luLmxvY2F0aW9uLmhhc2gpOwogICAgICB9CiAgICB9KTsKCiAgfSk7CgogIGRlc2NyaWJlKCd1cmwgKHdoZW4gc3RhdGUgcGFzc2VkKScsIGZ1bmN0aW9uKCkgewogICAgdmFyIGN1cnJlbnRIcmVmLCBwdXNoU3RhdGUsIHJlcGxhY2VTdGF0ZSwgbG9jYXRpb25SZXBsYWNlOwoKICAgIGJlZm9yZUVhY2goZnVuY3Rpb24oKSB7CiAgICB9KTsKCiAgICBkZXNjcmliZSgnaW4gSUUnLCBydW5UZXN0cyh7bXNpZTogdHJ1ZX0pKTsKICAgIGRlc2NyaWJlKCdub3QgaW4gSUUnLCBydW5UZXN0cyh7bXNpZTogZmFsc2V9KSk7CgogICAgZnVuY3Rpb24gcnVuVGVzdHMob3B0aW9ucykgewogICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgYmVmb3JlRWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgIHNuaWZmZXIgPSB7aGlzdG9yeTogdHJ1ZX07CgogICAgICAgICAgZmFrZVdpbmRvdyA9IG5ldyBNb2NrV2luZG93KHttc2llOiBvcHRpb25zLm1zaWV9KTsKICAgICAgICAgIGN1cnJlbnRIcmVmID0gZmFrZVdpbmRvdy5sb2NhdGlvbi5ocmVmOwogICAgICAgICAgcHVzaFN0YXRlID0gc3B5T24oZmFrZVdpbmRvdy5oaXN0b3J5LCAncHVzaFN0YXRlJykuYW5kQ2FsbFRocm91Z2goKTsKICAgICAgICAgIHJlcGxhY2VTdGF0ZSA9IHNweU9uKGZha2VXaW5kb3cuaGlzdG9yeSwgJ3JlcGxhY2VTdGF0ZScpLmFuZENhbGxUaHJvdWdoKCk7CiAgICAgICAgICBsb2NhdGlvblJlcGxhY2UgPSBzcHlPbihmYWtlV2luZG93LmxvY2F0aW9uLCAncmVwbGFjZScpLmFuZENhbGxUaHJvdWdoKCk7CgogICAgICAgICAgYnJvd3NlciA9IG5ldyBCcm93c2VyKGZha2VXaW5kb3csIGZha2VEb2N1bWVudCwgZmFrZUxvZywgc25pZmZlcik7CiAgICAgICAgICBicm93c2VyLm9uVXJsQ2hhbmdlKGZ1bmN0aW9uKCkge30pOwogICAgICAgIH0pOwoKICAgICAgICBpdCgnc2hvdWxkIGNoYW5nZSBzdGF0ZScsIGZ1bmN0aW9uKCkgewogICAgICAgICAgYnJvd3Nlci51cmwoY3VycmVudEhyZWYsIGZhbHNlLCB7cHJvcDogJ3ZhbDEnfSk7CiAgICAgICAgICBleHBlY3QoZmFrZVdpbmRvdy5oaXN0b3J5LnN0YXRlKS50b0VxdWFsKHtwcm9wOiAndmFsMSd9KTsKICAgICAgICAgIGJyb3dzZXIudXJsKGN1cnJlbnRIcmVmICsgJy9zb21ldGhpbmcnLCBmYWxzZSwge3Byb3A6ICd2YWwyJ30pOwogICAgICAgICAgZXhwZWN0KGZha2VXaW5kb3cuaGlzdG9yeS5zdGF0ZSkudG9FcXVhbCh7cHJvcDogJ3ZhbDInfSk7CiAgICAgICAgfSk7CgogICAgICAgIGl0KCdzaG91bGQgYWxsb3cgdG8gc2V0IGZhbHN5IHN0YXRlcyAoZXhjZXB0IGB1bmRlZmluZWRgKScsIGZ1bmN0aW9uKCkgewogICAgICAgICAgZmFrZVdpbmRvdy5oaXN0b3J5LnN0YXRlID0ge3Byb3A6ICd2YWwxJ307CiAgICAgICAgICBmYWtlV2luZG93LmZpcmUoJ3BvcHN0YXRlJyk7CgogICAgICAgICAgYnJvd3Nlci51cmwoY3VycmVudEhyZWYsIGZhbHNlLCBudWxsKTsKICAgICAgICAgIGV4cGVjdChmYWtlV2luZG93Lmhpc3Rvcnkuc3RhdGUpLnRvQmUobnVsbCk7CgogICAgICAgICAgYnJvd3Nlci51cmwoY3VycmVudEhyZWYsIGZhbHNlLCBmYWxzZSk7CiAgICAgICAgICBleHBlY3QoZmFrZVdpbmRvdy5oaXN0b3J5LnN0YXRlKS50b0JlKGZhbHNlKTsKCiAgICAgICAgICBicm93c2VyLnVybChjdXJyZW50SHJlZiwgZmFsc2UsICcnKTsKICAgICAgICAgIGV4cGVjdChmYWtlV2luZG93Lmhpc3Rvcnkuc3RhdGUpLnRvQmUoJycpOwoKICAgICAgICAgIGJyb3dzZXIudXJsKGN1cnJlbnRIcmVmLCBmYWxzZSwgMCk7CiAgICAgICAgICBleHBlY3QoZmFrZVdpbmRvdy5oaXN0b3J5LnN0YXRlKS50b0JlKDApOwogICAgICAgIH0pOwoKICAgICAgICBpdCgnc2hvdWxkIHRyZWF0IGB1bmRlZmluZWRgIHN0YXRlIGFzIGBudWxsYCcsIGZ1bmN0aW9uKCkgewogICAgICAgICAgZmFrZVdpbmRvdy5oaXN0b3J5LnN0YXRlID0ge3Byb3A6ICd2YWwxJ307CiAgICAgICAgICBmYWtlV2luZG93LmZpcmUoJ3BvcHN0YXRlJyk7CgogICAgICAgICAgYnJvd3Nlci51cmwoY3VycmVudEhyZWYsIGZhbHNlLCB1bmRlZmluZWQpOwogICAgICAgICAgZXhwZWN0KGZha2VXaW5kb3cuaGlzdG9yeS5zdGF0ZSkudG9CZShudWxsKTsKICAgICAgICB9KTsKCiAgICAgICAgaXQoJ3Nob3VsZCBkbyBwdXNoU3RhdGUgd2l0aCB0aGUgc2FtZSBVUkwgYW5kIGEgZGlmZmVyZW50IHN0YXRlJywgZnVuY3Rpb24oKSB7CiAgICAgICAgICBicm93c2VyLnVybChjdXJyZW50SHJlZiwgZmFsc2UsIHtwcm9wOiAndmFsMSd9KTsKICAgICAgICAgIGV4cGVjdChmYWtlV2luZG93Lmhpc3Rvcnkuc3RhdGUpLnRvRXF1YWwoe3Byb3A6ICd2YWwxJ30pOwoKICAgICAgICAgIGJyb3dzZXIudXJsKGN1cnJlbnRIcmVmLCBmYWxzZSwgbnVsbCk7CiAgICAgICAgICBleHBlY3QoZmFrZVdpbmRvdy5oaXN0b3J5LnN0YXRlKS50b0JlKG51bGwpOwoKICAgICAgICAgIGJyb3dzZXIudXJsKGN1cnJlbnRIcmVmLCBmYWxzZSwge3Byb3A6ICd2YWwyJ30pOwogICAgICAgICAgYnJvd3Nlci51cmwoY3VycmVudEhyZWYsIGZhbHNlLCB7cHJvcDogJ3ZhbDMnfSk7CiAgICAgICAgICBleHBlY3QoZmFrZVdpbmRvdy5oaXN0b3J5LnN0YXRlKS50b0VxdWFsKHtwcm9wOiAndmFsMyd9KTsKICAgICAgICB9KTsKCiAgICAgICAgaXQoJ3Nob3VsZCBkbyBwdXNoU3RhdGUgd2l0aCB0aGUgc2FtZSBVUkwgYW5kIGRlZXAgZXF1YWwgYnV0IHJlZmVyZW50aWFsbHkgZGlmZmVyZW50IHN0YXRlJywgZnVuY3Rpb24oKSB7CiAgICAgICAgICBmYWtlV2luZG93Lmhpc3Rvcnkuc3RhdGUgPSB7cHJvcDogJ3ZhbCd9OwogICAgICAgICAgZmFrZVdpbmRvdy5maXJlKCdwb3BzdGF0ZScpOwogICAgICAgICAgZXhwZWN0KGhpc3RvcnlFbnRyaWVzTGVuZ3RoKS50b0JlKDEpOwoKICAgICAgICAgIGJyb3dzZXIudXJsKGN1cnJlbnRIcmVmLCBmYWxzZSwge3Byb3A6ICd2YWwnfSk7CiAgICAgICAgICBleHBlY3QoZmFrZVdpbmRvdy5oaXN0b3J5LnN0YXRlKS50b0VxdWFsKHtwcm9wOiAndmFsJ30pOwogICAgICAgICAgZXhwZWN0KGhpc3RvcnlFbnRyaWVzTGVuZ3RoKS50b0JlKDIpOwogICAgICAgIH0pOwoKICAgICAgICBpdCgnc2hvdWxkIG5vdCBkbyBwdXNoU3RhdGUgd2l0aCB0aGUgc2FtZSBVUkwgYW5kIHN0YXRlIGZyb20gJGJyb3dzZXIuc3RhdGUoKScsIGZ1bmN0aW9uKCkgewogICAgICAgICAgYnJvd3Nlci51cmwoY3VycmVudEhyZWYsIGZhbHNlLCB7cHJvcDogJ3ZhbCd9KTsKCiAgICAgICAgICBwdXNoU3RhdGUucmVzZXQoKTsKICAgICAgICAgIHJlcGxhY2VTdGF0ZS5yZXNldCgpOwogICAgICAgICAgbG9jYXRpb25SZXBsYWNlLnJlc2V0KCk7CgogICAgICAgICAgYnJvd3Nlci51cmwoY3VycmVudEhyZWYsIGZhbHNlLCBicm93c2VyLnN0YXRlKCkpOwogICAgICAgICAgZXhwZWN0KHB1c2hTdGF0ZSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTsKICAgICAgICAgIGV4cGVjdChyZXBsYWNlU3RhdGUpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7CiAgICAgICAgICBleHBlY3QobG9jYXRpb25SZXBsYWNlKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpOwogICAgICAgIH0pOwogICAgICB9OwogICAgfQogIH0pOwoKICBkZXNjcmliZSgnc3RhdGUnLCBmdW5jdGlvbigpIHsKICAgIHZhciBjdXJyZW50SHJlZjsKCiAgICBiZWZvcmVFYWNoKGZ1bmN0aW9uKCkgewogICAgICBzbmlmZmVyID0ge2hpc3Rvcnk6IHRydWV9OwogICAgICBjdXJyZW50SHJlZiA9IGZha2VXaW5kb3cubG9jYXRpb24uaHJlZjsKICAgIH0pOwoKICAgIGRlc2NyaWJlKCdpbiBJRScsIHJ1blRlc3RzKHttc2llOiB0cnVlfSkpOwogICAgZGVzY3JpYmUoJ25vdCBpbiBJRScsIHJ1blRlc3RzKHttc2llOiBmYWxzZX0pKTsKCiAgICBmdW5jdGlvbiBydW5UZXN0cyhvcHRpb25zKSB7CiAgICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICBiZWZvcmVFYWNoKGZ1bmN0aW9uKCkgewogICAgICAgICAgZmFrZVdpbmRvdyA9IG5ldyBNb2NrV2luZG93KHttc2llOiBvcHRpb25zLm1zaWV9KTsKICAgICAgICAgIGJyb3dzZXIgPSBuZXcgQnJvd3NlcihmYWtlV2luZG93LCBmYWtlRG9jdW1lbnQsIGZha2VMb2csIHNuaWZmZXIpOwogICAgICAgIH0pOwoKICAgICAgICBpdCgnc2hvdWxkIHJldHVybiBoaXN0b3J5LnN0YXRlJywgZnVuY3Rpb24oKSB7CiAgICAgICAgICBicm93c2VyLnVybChjdXJyZW50SHJlZiwgZmFsc2UsIHtwcm9wOiAndmFsJ30pOwogICAgICAgICAgZXhwZWN0KGJyb3dzZXIuc3RhdGUoKSkudG9FcXVhbCh7cHJvcDogJ3ZhbCd9KTsKICAgICAgICAgIGJyb3dzZXIudXJsKGN1cnJlbnRIcmVmLCBmYWxzZSwgMik7CiAgICAgICAgICBleHBlY3QoYnJvd3Nlci5zdGF0ZSgpKS50b0VxdWFsKDIpOwogICAgICAgICAgYnJvd3Nlci51cmwoY3VycmVudEhyZWYsIGZhbHNlLCBudWxsKTsKICAgICAgICAgIGV4cGVjdChicm93c2VyLnN0YXRlKCkpLnRvRXF1YWwobnVsbCk7CiAgICAgICAgfSk7CgogICAgICAgIGl0KCdzaG91bGQgcmV0dXJuIG51bGwgaWYgaGlzdG9yeS5zdGF0ZSBpcyB1bmRlZmluZWQnLCBmdW5jdGlvbigpIHsKICAgICAgICAgIGJyb3dzZXIudXJsKGN1cnJlbnRIcmVmLCBmYWxzZSwgdW5kZWZpbmVkKTsKICAgICAgICAgIGV4cGVjdChicm93c2VyLnN0YXRlKCkpLnRvQmUobnVsbCk7CiAgICAgICAgfSk7CgogICAgICAgIGl0KCdzaG91bGQgcmV0dXJuIHRoZSBzYW1lIHN0YXRlIG9iamVjdCBpbiBzdWJzZXF1ZW50IGludm9jYXRpb25zIGluIElFJywgZnVuY3Rpb24oKSB7CiAgICAgICAgICBicm93c2VyLnVybChjdXJyZW50SHJlZiwgZmFsc2UsIHtwcm9wOiAndmFsJ30pOwogICAgICAgICAgZXhwZWN0KGJyb3dzZXIuc3RhdGUoKSkudG9CZShicm93c2VyLnN0YXRlKCkpOwogICAgICAgIH0pOwogICAgICB9OwogICAgfQogIH0pOwoKICBkZXNjcmliZSgndXJsQ2hhbmdlJywgZnVuY3Rpb24oKSB7CiAgICB2YXIgY2FsbGJhY2s7CgogICAgYmVmb3JlRWFjaChmdW5jdGlvbigpIHsKICAgICAgY2FsbGJhY2sgPSBqYXNtaW5lLmNyZWF0ZVNweSgnb25VcmxDaGFuZ2UnKTsKICAgIH0pOwoKICAgIGFmdGVyRWFjaChmdW5jdGlvbigpIHsKICAgICAgaWYgKCFqUXVlcnkpIGpxTGl0ZURlYWxvYyhmYWtlV2luZG93KTsKICAgIH0pOwoKICAgIGl0KCdzaG91bGQgcmV0dXJuIHJlZ2lzdGVyZWQgY2FsbGJhY2snLCBmdW5jdGlvbigpIHsKICAgICAgZXhwZWN0KGJyb3dzZXIub25VcmxDaGFuZ2UoY2FsbGJhY2spKS50b0JlKGNhbGxiYWNrKTsKICAgIH0pOwoKICAgIGl0KCdzaG91bGQgZm9yd2FyZCBwb3BzdGF0ZSBldmVudCB3aXRoIG5ldyB1cmwgd2hlbiBoaXN0b3J5IHN1cHBvcnRlZCcsIGZ1bmN0aW9uKCkgewogICAgICBzbmlmZmVyLmhpc3RvcnkgPSB0cnVlOwogICAgICBicm93c2VyLm9uVXJsQ2hhbmdlKGNhbGxiYWNrKTsKICAgICAgZmFrZVdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJ2h0dHA6Ly9zZXJ2ZXIvbmV3JzsKCiAgICAgIGZha2VXaW5kb3cuZmlyZSgncG9wc3RhdGUnKTsKICAgICAgZXhwZWN0KGNhbGxiYWNrKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnaHR0cDovL3NlcnZlci9uZXcnLCBudWxsKTsKCiAgICAgIGZha2VXaW5kb3cuZmlyZSgnaGFzaGNoYW5nZScpOwogICAgICBmYWtlV2luZG93LnNldFRpbWVvdXQuZmx1c2goKTsKICAgICAgZXhwZWN0KGNhbGxiYWNrKS50b0hhdmVCZWVuQ2FsbGVkT25jZSgpOwogICAgfSk7CgogICAgaXQoJ3Nob3VsZCBmb3J3YXJkIG9ubHkgcG9wc3RhdGUgZXZlbnQgd2hlbiBoaXN0b3J5IHN1cHBvcnRlZCcsIGZ1bmN0aW9uKCkgewogICAgICBzbmlmZmVyLmhpc3RvcnkgPSB0cnVlOwogICAgICBicm93c2VyLm9uVXJsQ2hhbmdlKGNhbGxiYWNrKTsKICAgICAgZmFrZVdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJ2h0dHA6Ly9zZXJ2ZXIvbmV3JzsKCiAgICAgIGZha2VXaW5kb3cuZmlyZSgncG9wc3RhdGUnKTsKICAgICAgZXhwZWN0KGNhbGxiYWNrKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnaHR0cDovL3NlcnZlci9uZXcnLCBudWxsKTsKCiAgICAgIGZha2VXaW5kb3cuZmlyZSgnaGFzaGNoYW5nZScpOwogICAgICBmYWtlV2luZG93LnNldFRpbWVvdXQuZmx1c2goKTsKICAgICAgZXhwZWN0KGNhbGxiYWNrKS50b0hhdmVCZWVuQ2FsbGVkT25jZSgpOwogICAgfSk7CgogICAgaXQoJ3Nob3VsZCBmb3J3YXJkIGhhc2hjaGFuZ2UgZXZlbnQgd2l0aCBuZXcgdXJsIHdoZW4gaGlzdG9yeSBub3Qgc3VwcG9ydGVkJywgZnVuY3Rpb24oKSB7CiAgICAgIHNuaWZmZXIuaGlzdG9yeSA9IGZhbHNlOwogICAgICBicm93c2VyLm9uVXJsQ2hhbmdlKGNhbGxiYWNrKTsKICAgICAgZmFrZVdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJ2h0dHA6Ly9zZXJ2ZXIvbmV3JzsKCiAgICAgIGZha2VXaW5kb3cuZmlyZSgnaGFzaGNoYW5nZScpOwogICAgICBleHBlY3QoY2FsbGJhY2spLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdodHRwOi8vc2VydmVyL25ldycsIG51bGwpOwoKICAgICAgZmFrZVdpbmRvdy5maXJlKCdwb3BzdGF0ZScpOwogICAgICBmYWtlV2luZG93LnNldFRpbWVvdXQuZmx1c2goKTsKICAgICAgZXhwZWN0KGNhbGxiYWNrKS50b0hhdmVCZWVuQ2FsbGVkT25jZSgpOwogICAgfSk7CgogICAgaXQoJ3Nob3VsZCBub3QgZmlyZSB1cmxDaGFuZ2UgaWYgY2hhbmdlZCBieSBicm93c2VyLnVybCBtZXRob2QnLCBmdW5jdGlvbigpIHsKICAgICAgc25pZmZlci5oaXN0b3J5ID0gZmFsc2U7CiAgICAgIGJyb3dzZXIub25VcmxDaGFuZ2UoY2FsbGJhY2spOwogICAgICBicm93c2VyLnVybCgnaHR0cDovL25ldy5jb20nKTsKCiAgICAgIGZha2VXaW5kb3cuZmlyZSgnaGFzaGNoYW5nZScpOwogICAgICBleHBlY3QoY2FsbGJhY2spLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7CiAgICB9KTsKCiAgICBkZXNjcmliZSgnc3RhdGUgaGFuZGxpbmcnLCBmdW5jdGlvbigpIHsKICAgICAgdmFyIGN1cnJlbnRIcmVmOwoKICAgICAgYmVmb3JlRWFjaChmdW5jdGlvbigpIHsKICAgICAgICBzbmlmZmVyID0ge2hpc3Rvcnk6IHRydWV9OwogICAgICAgIGN1cnJlbnRIcmVmID0gZmFrZVdpbmRvdy5sb2NhdGlvbi5ocmVmOwogICAgICB9KTsKCiAgICAgIGRlc2NyaWJlKCdpbiBJRScsIHJ1blRlc3RzKHttc2llOiB0cnVlfSkpOwogICAgICBkZXNjcmliZSgnbm90IGluIElFJywgcnVuVGVzdHMoe21zaWU6IGZhbHNlfSkpOwoKICAgICAgZnVuY3Rpb24gcnVuVGVzdHMob3B0aW9ucykgewogICAgICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICAgIGJlZm9yZUVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGZha2VXaW5kb3cgPSBuZXcgTW9ja1dpbmRvdyh7bXNpZTogb3B0aW9ucy5tc2llfSk7CiAgICAgICAgICAgIGJyb3dzZXIgPSBuZXcgQnJvd3NlcihmYWtlV2luZG93LCBmYWtlRG9jdW1lbnQsIGZha2VMb2csIHNuaWZmZXIpOwogICAgICAgICAgfSk7CgogICAgICAgICAgaXQoJ3Nob3VsZCBmaXJlIG9uVXJsQ2hhbmdlIGxpc3RlbmVycyBvbmx5IG9uY2UgaWYgYm90aCBwb3BzdGF0ZSBhbmQgaGFzaGNoYW5nZSB0cmlnZ2VyZWQnLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgZmFrZVdpbmRvdy5oaXN0b3J5LnN0YXRlID0ge3Byb3A6ICd2YWwnfTsKICAgICAgICAgICAgYnJvd3Nlci5vblVybENoYW5nZShjYWxsYmFjayk7CgogICAgICAgICAgICBmYWtlV2luZG93LmZpcmUoJ2hhc2hjaGFuZ2UnKTsKICAgICAgICAgICAgZmFrZVdpbmRvdy5maXJlKCdwb3BzdGF0ZScpOwogICAgICAgICAgICBleHBlY3QoY2FsbGJhY2spLnRvSGF2ZUJlZW5DYWxsZWRPbmNlKCk7CiAgICAgICAgICB9KTsKICAgICAgICB9OwogICAgICB9CiAgICB9KTsKICB9KTsKCgogIGRlc2NyaWJlKCdiYXNlSHJlZicsIGZ1bmN0aW9uKCkgewogICAgdmFyIGpxRG9jSGVhZDsKCiAgICBiZWZvcmVFYWNoKGZ1bmN0aW9uKCkgewogICAgICBqcURvY0hlYWQgPSBqcUxpdGUoZG9jdW1lbnQpLmZpbmQoJ2hlYWQnKTsKICAgIH0pOwoKICAgIGl0KCdzaG91bGQgcmV0dXJuIHZhbHVlIGZyb20gPGJhc2UgaHJlZj4nLCBmdW5jdGlvbigpIHsKICAgICAgZmFrZURvY3VtZW50LmJhc2VQYXRoID0gJy9iYXNlL3BhdGgvJzsKICAgICAgZXhwZWN0KGJyb3dzZXIuYmFzZUhyZWYoKSkudG9FcXVhbCgnL2Jhc2UvcGF0aC8nKTsKICAgIH0pOwoKICAgIGl0KCdzaG91bGQgcmV0dXJuIFwnXCcgKGVtcHR5IHN0cmluZykgaWYgbm8gPGJhc2UgaHJlZj4nLCBmdW5jdGlvbigpIHsKICAgICAgZmFrZURvY3VtZW50LmJhc2VQYXRoID0gdW5kZWZpbmVkOwogICAgICBleHBlY3QoYnJvd3Nlci5iYXNlSHJlZigpKS50b0VxdWFsKCcnKTsKICAgIH0pOwoKICAgIGl0KCdzaG91bGQgcmVtb3ZlIGRvbWFpbiBmcm9tIDxiYXNlIGhyZWY+JywgZnVuY3Rpb24oKSB7CiAgICAgIGZha2VEb2N1bWVudC5iYXNlUGF0aCA9ICdodHRwOi8vaG9zdC5jb20vYmFzZS9wYXRoLyc7CiAgICAgIGV4cGVjdChicm93c2VyLmJhc2VIcmVmKCkpLnRvRXF1YWwoJy9iYXNlL3BhdGgvJyk7CgogICAgICBmYWtlRG9jdW1lbnQuYmFzZVBhdGggPSAnaHR0cDovL2hvc3QuY29tL2Jhc2UvcGF0aC9pbmRleC5odG1sJzsKICAgICAgZXhwZWN0KGJyb3dzZXIuYmFzZUhyZWYoKSkudG9FcXVhbCgnL2Jhc2UvcGF0aC9pbmRleC5odG1sJyk7CiAgICB9KTsKCiAgICBpdCgnc2hvdWxkIHJlbW92ZSBkb21haW4gZnJvbSA8YmFzZSBocmVmPiBiZWdpbm5pbmcgd2l0aCBcJy8vXCcnLCBmdW5jdGlvbigpIHsKICAgICAgZmFrZURvY3VtZW50LmJhc2VQYXRoID0gJy8vZ29vZ2xlLmNvbS9iYXNlL3BhdGgvJzsKICAgICAgZXhwZWN0KGJyb3dzZXIuYmFzZUhyZWYoKSkudG9FcXVhbCgnL2Jhc2UvcGF0aC8nKTsKICAgIH0pOwogIH0pOwoKICBkZXNjcmliZSgnaW50ZWdyYXRpb24gdGVzdHMgd2l0aCAkbG9jYXRpb24nLCBmdW5jdGlvbigpIHsKCiAgICBmdW5jdGlvbiBzZXR1cChvcHRpb25zKSB7CiAgICAgIG1vZHVsZShmdW5jdGlvbigkcHJvdmlkZSwgJGxvY2F0aW9uUHJvdmlkZXIpIHsKICAgICAgICBzcHlPbihmYWtlV2luZG93Lmhpc3RvcnksICdwdXNoU3RhdGUnKS5hbmRDYWxsRmFrZShmdW5jdGlvbihzdGF0ZU9iaiwgdGl0bGUsIG5ld1VybCkgewogICAgICAgICAgZmFrZVdpbmRvdy5sb2NhdGlvbi5ocmVmID0gbmV3VXJsOwogICAgICAgIH0pOwogICAgICAgIHNweU9uKGZha2VXaW5kb3cubG9jYXRpb24sICdyZXBsYWNlJykuYW5kQ2FsbEZha2UoZnVuY3Rpb24obmV3VXJsKSB7CiAgICAgICAgICBmYWtlV2luZG93LmxvY2F0aW9uLmhyZWYgPSBuZXdVcmw7CiAgICAgICAgfSk7CiAgICAgICAgJHByb3ZpZGUudmFsdWUoJyRicm93c2VyJywgYnJvd3Nlcik7CiAgICAgICAgYnJvd3Nlci5wb2xsRm5zID0gW107CgogICAgICAgIHNuaWZmZXIuaGlzdG9yeSA9IG9wdGlvbnMuaGlzdG9yeTsKICAgICAgICAkcHJvdmlkZS52YWx1ZSgnJHNuaWZmZXInLCBzbmlmZmVyKTsKCiAgICAgICAgJGxvY2F0aW9uUHJvdmlkZXIuaHRtbDVNb2RlKG9wdGlvbnMuaHRtbDVNb2RlKTsKICAgICAgfSk7CiAgICB9CgogICAgZGVzY3JpYmUoJ3VwZGF0ZSAkbG9jYXRpb24gd2hlbiBpdCB3YXMgY2hhbmdlZCBvdXRzaWRlIG9mIEFuZ3VsYXIgaW4gc3luYyAnKwogICAgICAgJ2JlZm9yZSAkZGlnZXN0IHdhcyBjYWxsZWQnLCBmdW5jdGlvbigpIHsKCiAgICAgIGl0KCdzaG91bGQgd29yayB3aXRoIG5vIGhpc3Rvcnkgc3VwcG9ydCwgbm8gaHRtbDVNb2RlJywgZnVuY3Rpb24oKSB7CiAgICAgICAgc2V0dXAoewogICAgICAgICAgaGlzdG9yeTogZmFsc2UsCiAgICAgICAgICBodG1sNU1vZGU6IGZhbHNlCiAgICAgICAgfSk7CiAgICAgICAgaW5qZWN0KGZ1bmN0aW9uKCRyb290U2NvcGUsICRsb2NhdGlvbikgewogICAgICAgICAgJHJvb3RTY29wZS4kYXBwbHkoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvaW5pdGlhbFBhdGgnKTsKICAgICAgICAgIH0pOwogICAgICAgICAgZXhwZWN0KGZha2VXaW5kb3cubG9jYXRpb24uaHJlZikudG9CZSgnaHR0cDovL3NlcnZlci8jL2luaXRpYWxQYXRoJyk7CgogICAgICAgICAgZmFrZVdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJ2h0dHA6Ly9zZXJ2ZXIvIy9zb21lVGVzdEhhc2gnOwoKICAgICAgICAgICRyb290U2NvcGUuJGRpZ2VzdCgpOwoKICAgICAgICAgIGV4cGVjdCgkbG9jYXRpb24ucGF0aCgpKS50b0JlKCcvc29tZVRlc3RIYXNoJyk7CiAgICAgICAgfSk7CiAgICAgIH0pOwoKICAgICAgaXQoJ3Nob3VsZCB3b3JrIHdpdGggaGlzdG9yeSBzdXBwb3J0LCBubyBodG1sNU1vZGUnLCBmdW5jdGlvbigpIHsKICAgICAgICBzZXR1cCh7CiAgICAgICAgICBoaXN0b3J5OiB0cnVlLAogICAgICAgICAgaHRtbDVNb2RlOiBmYWxzZQogICAgICAgIH0pOwogICAgICAgIGluamVjdChmdW5jdGlvbigkcm9vdFNjb3BlLCAkbG9jYXRpb24pIHsKICAgICAgICAgICRyb290U2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2luaXRpYWxQYXRoJyk7CiAgICAgICAgICB9KTsKICAgICAgICAgIGV4cGVjdChmYWtlV2luZG93LmxvY2F0aW9uLmhyZWYpLnRvQmUoJ2h0dHA6Ly9zZXJ2ZXIvIy9pbml0aWFsUGF0aCcpOwoKICAgICAgICAgIGZha2VXaW5kb3cubG9jYXRpb24uaHJlZiA9ICdodHRwOi8vc2VydmVyLyMvc29tZVRlc3RIYXNoJzsKCiAgICAgICAgICAkcm9vdFNjb3BlLiRkaWdlc3QoKTsKCiAgICAgICAgICBleHBlY3QoJGxvY2F0aW9uLnBhdGgoKSkudG9CZSgnL3NvbWVUZXN0SGFzaCcpOwogICAgICAgIH0pOwogICAgICB9KTsKCiAgICAgIGl0KCdzaG91bGQgd29yayB3aXRoIG5vIGhpc3Rvcnkgc3VwcG9ydCwgd2l0aCBodG1sNU1vZGUnLCBmdW5jdGlvbigpIHsKICAgICAgICBzZXR1cCh7CiAgICAgICAgICBoaXN0b3J5OiBmYWxzZSwKICAgICAgICAgIGh0bWw1TW9kZTogdHJ1ZQogICAgICAgIH0pOwogICAgICAgIGluamVjdChmdW5jdGlvbigkcm9vdFNjb3BlLCAkbG9jYXRpb24pIHsKICAgICAgICAgICRyb290U2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2luaXRpYWxQYXRoJyk7CiAgICAgICAgICB9KTsKICAgICAgICAgIGV4cGVjdChmYWtlV2luZG93LmxvY2F0aW9uLmhyZWYpLnRvQmUoJ2h0dHA6Ly9zZXJ2ZXIvIy9pbml0aWFsUGF0aCcpOwoKICAgICAgICAgIGZha2VXaW5kb3cubG9jYXRpb24uaHJlZiA9ICdodHRwOi8vc2VydmVyLyMvc29tZVRlc3RIYXNoJzsKCiAgICAgICAgICAkcm9vdFNjb3BlLiRkaWdlc3QoKTsKCiAgICAgICAgICBleHBlY3QoJGxvY2F0aW9uLnBhdGgoKSkudG9CZSgnL3NvbWVUZXN0SGFzaCcpOwogICAgICAgIH0pOwogICAgICB9KTsKCiAgICAgIGl0KCdzaG91bGQgd29yayB3aXRoIGhpc3Rvcnkgc3VwcG9ydCwgd2l0aCBodG1sNU1vZGUnLCBmdW5jdGlvbigpIHsKICAgICAgICBzZXR1cCh7CiAgICAgICAgICBoaXN0b3J5OiB0cnVlLAogICAgICAgICAgaHRtbDVNb2RlOiB0cnVlCiAgICAgICAgfSk7CiAgICAgICAgaW5qZWN0KGZ1bmN0aW9uKCRyb290U2NvcGUsICRsb2NhdGlvbikgewogICAgICAgICAgJHJvb3RTY29wZS4kYXBwbHkoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvaW5pdGlhbFBhdGgnKTsKICAgICAgICAgIH0pOwogICAgICAgICAgZXhwZWN0KGZha2VXaW5kb3cubG9jYXRpb24uaHJlZikudG9CZSgnaHR0cDovL3NlcnZlci9pbml0aWFsUGF0aCcpOwoKICAgICAgICAgIGZha2VXaW5kb3cubG9jYXRpb24uaHJlZiA9ICdodHRwOi8vc2VydmVyL3NvbWVUZXN0SGFzaCc7CgogICAgICAgICAgJHJvb3RTY29wZS4kZGlnZXN0KCk7CgogICAgICAgICAgZXhwZWN0KCRsb2NhdGlvbi5wYXRoKCkpLnRvQmUoJy9zb21lVGVzdEhhc2gnKTsKICAgICAgICB9KTsKICAgICAgfSk7CgogICAgfSk7CgogICAgaXQoJ3Nob3VsZCBub3QgcmVsb2FkIHRoZSBwYWdlIG9uIGV2ZXJ5ICRkaWdlc3Qgd2hlbiB0aGUgcGFnZSB3aWxsIGJlIHJlbG9hZGVkIGR1ZSB0byB1cmwgcmV3cml0ZSBvbiBsb2FkJywgZnVuY3Rpb24oKSB7CiAgICAgIHNldHVwKHsKICAgICAgICBoaXN0b3J5OiBmYWxzZSwKICAgICAgICBodG1sNU1vZGU6IHRydWUKICAgICAgfSk7CiAgICAgIGZha2VXaW5kb3cubG9jYXRpb24uaHJlZiA9ICdodHRwOi8vc2VydmVyL3NvbWUvZGVlcC9wYXRoJzsKICAgICAgdmFyIGNoYW5nZVVybENvdW50ID0gMDsKICAgICAgdmFyIF91cmwgPSBicm93c2VyLnVybDsKICAgICAgYnJvd3Nlci51cmwgPSBmdW5jdGlvbihuZXdVcmwsIHJlcGxhY2UsIHN0YXRlKSB7CiAgICAgICAgaWYgKG5ld1VybCkgewogICAgICAgICAgY2hhbmdlVXJsQ291bnQrKzsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIF91cmwuY2FsbCh0aGlzLCBuZXdVcmwsIHJlcGxhY2UpOwogICAgICB9OwogICAgICBzcHlPbihicm93c2VyLCAndXJsJykuYW5kQ2FsbFRocm91Z2goKTsKICAgICAgaW5qZWN0KGZ1bmN0aW9uKCRyb290U2NvcGUsICRsb2NhdGlvbikgewogICAgICAgICRyb290U2NvcGUuJGRpZ2VzdCgpOwogICAgICAgICRyb290U2NvcGUuJGRpZ2VzdCgpOwogICAgICAgICRyb290U2NvcGUuJGRpZ2VzdCgpOwogICAgICAgICRyb290U2NvcGUuJGRpZ2VzdCgpOwoKICAgICAgICAvLyBmcm9tICRsb2NhdGlvbiBmb3IgcmV3cml0aW5nIHRoZSBpbml0aWFsIHVybCBpbnRvIGEgaGFzaCB1cmwKICAgICAgICBleHBlY3QoYnJvd3Nlci51cmwpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdodHRwOi8vc2VydmVyLyMvc29tZS9kZWVwL3BhdGgnLCB0cnVlKTsKICAgICAgICBleHBlY3QoY2hhbmdlVXJsQ291bnQpLnRvQmUoMSk7CiAgICAgIH0pOwoKICAgIH0pOwogIH0pOwoKICBkZXNjcmliZSgnaW50ZWdyYXRpb24gdGVzdCB3aXRoICRyb290U2NvcGUnLCBmdW5jdGlvbigpIHsKCiAgICBiZWZvcmVFYWNoKG1vZHVsZShmdW5jdGlvbigkcHJvdmlkZSwgJGxvY2F0aW9uUHJvdmlkZXIpIHsKICAgICAgJHByb3ZpZGUudmFsdWUoJyRicm93c2VyJywgYnJvd3Nlcik7CiAgICAgIGJyb3dzZXIucG9sbEZucyA9IFtdOwogICAgfSkpOwoKICAgIGl0KCdzaG91bGQgbm90IGludGVyZmVyZSB3aXRoIGxlZ2FjeSBicm93c2VyIHVybCByZXBsYWNlIGJlaGF2aW9yJywgZnVuY3Rpb24oKSB7CiAgICAgIGluamVjdChmdW5jdGlvbigkcm9vdFNjb3BlKSB7CiAgICAgICAgdmFyIGN1cnJlbnQgPSBmYWtlV2luZG93LmxvY2F0aW9uLmhyZWY7CiAgICAgICAgdmFyIG5ld1VybCA9ICdub3R5ZXQnOwogICAgICAgIHNuaWZmZXIuaGlzdG9yeSA9IGZhbHNlOwogICAgICAgIGV4cGVjdChoaXN0b3J5RW50cmllc0xlbmd0aCkudG9CZSgxKTsKICAgICAgICBicm93c2VyLnVybChuZXdVcmwsIHRydWUpOwogICAgICAgIGV4cGVjdChicm93c2VyLnVybCgpKS50b0JlKG5ld1VybCk7CiAgICAgICAgZXhwZWN0KGhpc3RvcnlFbnRyaWVzTGVuZ3RoKS50b0JlKDEpOwogICAgICAgICRyb290U2NvcGUuJGRpZ2VzdCgpOwogICAgICAgIGV4cGVjdChicm93c2VyLnVybCgpKS50b0JlKG5ld1VybCk7CiAgICAgICAgZXhwZWN0KGhpc3RvcnlFbnRyaWVzTGVuZ3RoKS50b0JlKDEpOwogICAgICB9KTsKICAgIH0pOwoKICB9KTsKCn0pOwo=",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Thu, 06 Nov 2014 09:17:39 GMT",
                    "Content-Length": "34766",
                    "Date": "Thu, 06 Nov 2014 09:17:43 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}