{
    "url": "http://localhost:9999/Fluidbyte/UMDRouter/src/umdrouter.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Open redirection (DOM-based)",
    "issueType": 5243152,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based open redirection vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this data into the target of a redirection in an unsafe way. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will cause a redirection to an arbitrary external domain. This behavior can be leveraged to facilitate phishing attacks against users of the application. The ability to use an authentic application URL, targeting the correct domain with a valid SSL certificate (if SSL is used) lends credibility to the phishing attack because many users, even if they verify these features, will not notice the subsequent redirection to a different domain.<br><br><b>Note:</b> If an attacker is able to control the start of the string that is passed to the redirection API, then it may be possible to escalate this vulnerability into a JavaScript injection attack, by using a URL with the javascript: pseudo-protocol to execute arbitrary script code when the URL is processed by the browser.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based open redirection vulnerabilities is not to dynamically set redirection targets using data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing an arbitrary URL as a redirection target. In general, this is best achieved by using a whitelist of URLs that are permitted redirection targets, and strictly validating the target against this list before performing the redirection.",
    "issueDetail": "The application may be vulnerable to DOM-based open redirection. Data is read from <b>location.search</b> and written to <b>location.replace()</b> via the following statements:<ul><li>url = root + location.search;</li><li>location.replace(root + url);</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/Fluidbyte/UMDRouter/src/umdrouter.js",
                "path": "/Fluidbyte/UMDRouter/src/umdrouter.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9GbHVpZGJ5dGUvVU1EUm91dGVyL3NyYy91bWRyb3V0ZXIuanMgSFRUUC8xLjENCkhvc3Q6IGxvY2FsaG9zdDo5OTk5DQoNCg==",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogNjYyNA0KQWNjZXB0LVJhbmdlczogYnl0ZXMNCkNvbnRlbnQtVHlwZTogYXBwbGljYXRpb24vamF2YXNjcmlwdA0KRGF0ZTogU3VuLCAwOSBOb3YgMjAxNCAwMDozOTo0OSBHTVQNCkxhc3QtTW9kaWZpZWQ6IFN1biwgMDkgTm92IDIwMTQgMDA6Mzk6NDkgR01UDQoNCihmdW5jdGlvbiAocm9vdCwgZmFjdG9yeSkgewoJaWYgKHR5cGVvZiBkZWZpbmUgPT09ICJmdW5jdGlvbiIgJiYgZGVmaW5lLmFtZCkgewoJCWRlZmluZShbXSwgZmFjdG9yeSk7Cgl9IGVsc2UgaWYgKHR5cGVvZiBleHBvcnRzID09PSAib2JqZWN0IikgewoJCW1vZHVsZS5leHBvcnRzID0gZmFjdG9yeSgpOwoJfSBlbHNlIHsKCQlyb290LlVNRFJvdXRlciA9IGZhY3RvcnkoKTsKCX0KfSh0aGlzLCBmdW5jdGlvbiAoKSB7CgoJLyoqCgkgKiBSb3V0ZXIgY29uc3RydWN0b3IgZnVuY3Rpb24KCSAqIEBjb25zdHJ1Y3RvciBSb3V0ZXIKCSAqLwoJdmFyIFVNRFJvdXRlciA9IGZ1bmN0aW9uICgpIHsKCQl2YXIgc2VsZiA9IHRoaXM7CgoJCS8vIFdhdGNoIGhhc2hjaGFuZ2UKCQl3aW5kb3cub25oYXNoY2hhbmdlID0gZnVuY3Rpb24gKCkgewoJCQlzZWxmLnByb2Nlc3MoKTsKCQl9OwoKCQkvLyBSdW4gb24gbG9hZAoJCXdpbmRvdy5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7CgkJCXNlbGYucHJvY2VzcygpOwoJCX07Cgl9OwoKCS8qKgoJICogQ29udGFpbmVyIG9iamVjdCBmb3Igcm91dGVzCgkgKiBAbWVtYmVyb2YgVU1EUm91dGVyCgkgKiBAbWVtYmVyIHtvYmplY3R9CgkgKi8KCVVNRFJvdXRlci5wcm90b3R5cGUucm91dGVzID0ge307CgoJLyoqCgkgKiBDb250YWluZXIgYXJyYXkgZm9yIGhpc3RvcnkKCSAqIEBtZW1iZXJvZiBVTURSb3V0ZXIKCSAqIEBtZW1iZXIge2FycmF5fQoJICovCglVTURSb3V0ZXIucHJvdG90eXBlLmhpc3RvcnkgPSBbXTsKCgkvKioKCSAqIFByb2Nlc3NlcyByb3V0ZSBjaGFuZ2UKCSAqIEBtZW1iZXJvZiBVTURSb3V0ZXIKCSAqIEBtZXRob2QgcHJvY2VzcwoJICovCglVTURSb3V0ZXIucHJvdG90eXBlLnByb2Nlc3MgPSBmdW5jdGlvbiAoKSB7CgkJdmFyIHNlbGYgPSB0aGlzLAoJCQlmcmFnbWVudCA9IHdpbmRvdy5sb2NhdGlvbi5oYXNoLnJlcGxhY2UoIiMiLCAiIiksCgkJCW1hdGNoID0gc2VsZi5tYXRjaCgpLAoJCQlyb3V0ZSA9IG1hdGNoLnJvdXRlLAoJCQlhcmdzID0gbWF0Y2guYXJncywKCQkJcHJldlJvdXRlID0gZmFsc2UsCgkJCXByZXZTYW5kYm94ID0gbnVsbCwKCQkJcm91dGVPYmogPSBbXTsKCgkJLy8gR2V0IHByZXZfcm91dGUKCQlpZiAoc2VsZi5oaXN0b3J5Lmxlbmd0aCAhPT0gMCkgewoJCQlwcmV2Um91dGUgPSBzZWxmLnJvdXRlc1tzZWxmLmhpc3Rvcnlbc2VsZi5oaXN0b3J5Lmxlbmd0aCAtIDFdLm1hdGNoZXJdOwoJCX0KCgkJLy8gRW5zdXJlIGEgbWF0Y2ggaGFzIGJlZW4gbWFkZQoJCWlmICghcm91dGUpIHsKCQkJcmV0dXJuOwoJCX0KCgkJcm91dGVPYmogPSBzZWxmLnJvdXRlc1tyb3V0ZV07CgoJCS8vIEdldCBjdXJyZW50IHJvdXRlIGFuZCB1bmxvYWQKCQlpZiAocHJldlJvdXRlICYmIHByZXZSb3V0ZS51bmxvYWQpIHsKCQkJcHJldlJvdXRlLnVubG9hZC5hcHBseSh0aGlzKTsKCQkJZm9yICh2YXIga2V5IGluIFVNRFJvdXRlci51bmxvYWRGdW5jdGlvbnMpIHsKCQkJCVVNRFJvdXRlci51bmxvYWRGdW5jdGlvbnNba2V5XS5hcHBseShwcmV2U2FuZGJveCk7CgkJCX0KCQl9CgoJCXZhciBiZWZvcmVDYWxsYmFjayA9IGZ1bmN0aW9uIChiZWZvcmUpIHsKCgkJCWlmICh0eXBlb2YgYmVmb3JlID09PSAidW5kZWZpbmVkIikgewoJCQkJYmVmb3JlID0gdHJ1ZTsKCQkJfQoKCQkJaWYgKHR5cGVvZiBhcmdzWzBdID09PSAiZnVuY3Rpb24iKSB7CgkJCQlhcmdzLnNoaWZ0KCk7CgkJCX0KCgkJCS8vIElmIGJlZm9yZSByZXR1cm5lZCBmYWxzZSwgZ28gYmFjawoJCQlpZiAoIWJlZm9yZSkgewoJCQkJc2VsZi5nbyhzZWxmLmhpc3Rvcnlbc2VsZi5oaXN0b3J5Lmxlbmd0aCAtIDFdLmZyYWdtZW50KTsKCQkJfQoKCQkJaWYgKCFyb3V0ZU9iai5sb2FkKSB7CgkJCQlyZXR1cm47CgkJCX0KCgkJCXZhciBzYW5kYm94ID0gc2VsZi5jcmVhdGVTYW5kYm94KHJvdXRlKTsKCQkJcHJldlNhbmRib3ggPSBzYW5kYm94OwoKCQkJcm91dGVPYmoubG9hZC5hcHBseShzYW5kYm94LCBhcmdzKTsKCQkJc2VsZi5oaXN0b3J5LnB1c2goewoJCQkJbWF0Y2hlcjogcm91dGUsCgkJCQlmcmFnbWVudDogZnJhZ21lbnQKCQkJfSk7CgoJCX07CgoJCS8vIENoZWNrIGFuZCBydW4gJ2JlZm9yZScKCQlpZiAocm91dGVPYmouYmVmb3JlKSB7CgkJCWFyZ3MudW5zaGlmdChiZWZvcmVDYWxsYmFjayk7CgkJCXJvdXRlT2JqLmJlZm9yZS5hcHBseSh0aGlzLCBhcmdzKTsKCQkJcmV0dXJuOwoJCX0gZWxzZSB7CgkJCWJlZm9yZUNhbGxiYWNrKHRydWUpOwoJCX0KCgl9OwoKCS8qKgoJICogQG1ldGhvZCBjcmVhdGVTYW5kYm94CgkgKi8KCVVNRFJvdXRlci5wcm90b3R5cGUuY3JlYXRlU2FuZGJveCA9IGZ1bmN0aW9uIChyb3V0ZSkgewoKCQl2YXIgc2FuZGJveCA9IHt9LAoJCQlyb3V0ZU9iaiA9IHRoaXMucm91dGVzW3JvdXRlXSwKCQkJa2V5OwoKCQlmb3IgKGtleSBpbiByb3V0ZU9iai5leHRlbmQpIHsKCQkJaWYgKHR5cGVvZiByb3V0ZU9iai5leHRlbmRba2V5XSA9PT0gImZ1bmN0aW9uIikgewoJCQkJc2FuZGJveFtrZXldID0gcm91dGVPYmouZXh0ZW5kW2tleV0uYmluZChzYW5kYm94KTsKCQkJfSBlbHNlIHsKCQkJCXNhbmRib3hba2V5XSA9IHJvdXRlT2JqLmV4dGVuZFtrZXldOwoJCQl9CgkJfQoKCQlmb3IgKGtleSBpbiBVTURSb3V0ZXIuZXh0ZW5zaW9ucykgewoJCQlpZiAodHlwZW9mIFVNRFJvdXRlci5leHRlbnNpb25zW2tleV0gPT09ICJmdW5jdGlvbiIpIHsKCQkJCXNhbmRib3hba2V5XSA9IFVNRFJvdXRlci5leHRlbnNpb25zW2tleV0uYmluZChzYW5kYm94KTsKCQkJfSBlbHNlIHsKCQkJCXNhbmRib3hba2V5XSA9IFVNRFJvdXRlci5leHRlbnNpb25zW2tleV07CgkJCX0KCQl9CgoJCXJldHVybiBzYW5kYm94OwoKCX07CgoJLyoqCgkgKiBNYXRjaGVzIHJvdXRlcyBhbmQgZmlyZXMgY2FsbGJhY2sKCSAqIEBtZW1iZXJvZiBVTURSb3V0ZXIKCSAqIEBtZXRob2QgbWF0Y2gKCSAqLwoJVU1EUm91dGVyLnByb3RvdHlwZS5tYXRjaCA9IGZ1bmN0aW9uICgpIHsKCQl2YXIgc2VsZiA9IHRoaXMsCgkJCWZyYWdtZW50ID0gd2luZG93LmxvY2F0aW9uLmhhc2gucmVwbGFjZSgiIyIsICIiKSwKCQkJbWF0Y2hlciwKCQkJcm91dGUsCgkJCWFyZ3MgPSBbXSwKCQkJbWF0Y2hlZCA9IGZhbHNlLAoJCQlpLAoJCQl6OwoKCQkvLyBNYXRjaCByb290CgkJaWYgKGZyYWdtZW50ID09PSAiLyIgfHwgZnJhZ21lbnQgPT09ICIiICYmIHNlbGYucm91dGVzLmhhc093blByb3BlcnR5KCIvIikpIHsKCQkJbWF0Y2hlZCA9IHsKCQkJCXJvdXRlOiAiLyIsCgkJCQlhcmdzOiBbXQoJCQl9OwoJCX0gZWxzZSB7CgkJCS8vIE1hdGNoIHJvdXRlcwoJCQlmb3IgKHJvdXRlIGluIHNlbGYucm91dGVzKSB7CgkJCQltYXRjaGVyID0gZnJhZ21lbnQubWF0Y2gobmV3IFJlZ0V4cChyb3V0ZS5yZXBsYWNlKC86W15ccy9dKy9nLCAiKFtcXHctXSspIikpKTsKCQkJCWlmIChtYXRjaGVyICE9PSBudWxsICYmIHJvdXRlICE9PSAiLyIpIHsKCQkJCQlhcmdzID0gW107CgkJCQkJLy8gR2V0IGFyZ3MKCQkJCQlpZiAobWF0Y2hlci5sZW5ndGggPiAxKSB7CgkJCQkJCWZvciAoaSA9IDEsIHogPSBtYXRjaGVyLmxlbmd0aDsgaSA8IHo7IGkrKykgewoJCQkJCQkJYXJncy5wdXNoKG1hdGNoZXJbaV0pOwoJCQkJCQl9CgkJCQkJfQoJCQkJCW1hdGNoZWQgPSB7CgkJCQkJCXJvdXRlOiByb3V0ZSwKCQkJCQkJYXJnczogYXJncwoJCQkJCX07CgkJCQl9CgkJCX0KCQl9CgoJCS8vIFJldHVybiBtYXRjaGVkIGFuZCBhcmd1bWVudHMKCQlyZXR1cm4gbWF0Y2hlZDsKCgl9OwoKCS8qKgoJICogTWV0aG9kIHRvIHJlbG9hZCAocmVmcmVzaCkgdGhlIHJvdXRlCgkgKiBAbWVtYmVyb2YgVU1EUm91dGVyCgkgKiBAbWV0aG9kIHJlbG9hZAoJICovCglVTURSb3V0ZXIucHJvdG90eXBlLnJlbG9hZCA9IGZ1bmN0aW9uICgpIHsKCQl0aGlzLnByb2Nlc3MoKTsKCX07CgoJLyoqCgkgKiBNZXRob2QgZm9yIGJpbmRpbmcgcm91dGUgdG8gY2FsbGJhY2sKCSAqIEBtZW1iZXJvZiBVTURSb3V0ZXIKCSAqIEBtZXRob2Qgb24KCSAqIEBwYXJhbSB7c3RyaW5nfSByb3V0ZSAtIFRoZSByb3V0ZSB0byBtYXRjaCBhZ2FpbnN0CgkgKiBAcGFyYW0ge2Z1bmN0aW9ufG9iamVjdH0gaGFuZGxlciAtIFRoZSBjYWxsYmFjayBmdW5jdGlvbiBvciBmdW5jdGlvbnMgKG9iamVjdCkKCSAqLwoJVU1EUm91dGVyLnByb3RvdHlwZS5vbiA9IGZ1bmN0aW9uIChyb3V0ZSwgaGFuZGxlcikgewoKCQl2YXIgaGFuZGxlck9iaiA9IHt9OwoKCQlpZiAodHlwZW9mIGhhbmRsZXIgPT09ICJmdW5jdGlvbiIpIHsKCQkJaGFuZGxlck9iai5sb2FkID0gaGFuZGxlcjsKCQl9IGVsc2UgaWYgKHR5cGVvZiBoYW5kbGVyID09PSAib2JqZWN0IikgewoJCQloYW5kbGVyT2JqID0gaGFuZGxlcjsKCQl9IGVsc2UgewoJCQl0aHJvdyAiRXJyb3IgY3JlYXRpbmcgcm91dGU6ICIgKyByb3V0ZSArICIuIGBoYW5kbGVyYCBtdXN0IGJlIGEgZnVuY3Rpb24gb3Igb2JqZWN0LiI7CgkJfQoKCQl0aGlzLmRlZmF1bHRzKGhhbmRsZXJPYmosIHsKCQkJImJlZm9yZSI6IG51bGwsCgkJCSJsb2FkIjogbnVsbCwKCQkJInVubG9hZCI6IG51bGwsCgkJCSJleHRlbmQiOiB7fQoJCX0pOwoKCQl0aGlzLnJvdXRlc1tyb3V0ZV0gPSBoYW5kbGVyT2JqOwoKCX07CgoJLyoqCgkgKiBTZWUgdW5kZXJzY29yZS5kZWZhdWx0cygpLgoJICogQG1lbWJlcm9mIFVNRFJvdXRlcgoJICogQG1ldGhvZCBkZWZhdWx0cwoJICovCglVTURSb3V0ZXIucHJvdG90eXBlLmRlZmF1bHRzID0gZnVuY3Rpb24gKG9iaiwgZGVmYXVsdHMpIHsKCQlvYmogPSBvYmogfHwge307CgkJZm9yICh2YXIga2V5IGluIGRlZmF1bHRzKSB7CgkJCWlmICghb2JqW2tleV0pIHsKCQkJCW9ialtrZXldID0gZGVmYXVsdHNba2V5XTsKCQkJfQoJCX0KCX07CgoJLyoqCgkgKiBNZXRob2QgZm9yIHByb2dyYW1hdGljYWxseSBuYXZpZ2F0aW5nIHRvIHJvdXRlCgkgKiBAbWVtYmVyb2YgVU1EUm91dGVyCgkgKiBAbWV0aG9kIGdvCgkgKiBAcGFyYW0ge3N0cmluZ30gcGF0aCAtIFRoZSByb3V0ZSB0byBuYXZpZ2F0ZSB0bwoJICovCglVTURSb3V0ZXIucHJvdG90eXBlLmdvID0gZnVuY3Rpb24gKHBhdGgpIHsKCgkJdmFyIGxvY2F0aW9uID0gd2luZG93LmxvY2F0aW9uLAoJCQlyb290ID0gbG9jYXRpb24ucGF0aG5hbWUucmVwbGFjZSgvW15cL10kLywgIiQmIiksCgkJCXVybCwKCQkJc2VsZiA9IHRoaXM7CgoJCS8vIEhhbmRsZSB1cmwgY29tcG9zaXRpb24KCQlpZiAocGF0aC5sZW5ndGgpIHsKCQkJLy8gRnJhZ21lbnQgZXhpc3RzCgkJCXVybCA9IHJvb3QgKyBsb2NhdGlvbi5zZWFyY2ggKyAiIyIgKyBwYXRoOwoJCX0gZWxzZSB7CgkJCS8vIE51bGwvQmxhbmsgZnJhZ21lbnQsIG5hdiB0byByb290CgkJCXVybCA9IHJvb3QgKyBsb2NhdGlvbi5zZWFyY2g7CgkJfQoKCQlpZiAoaGlzdG9yeS5wdXNoU3RhdGUpIHsKCQkJLy8gQnJvd3NlciBzdXBwb3J0cyBwdXNoU3RhdGUoKQoJCQloaXN0b3J5LnB1c2hTdGF0ZShudWxsLCBkb2N1bWVudC50aXRsZSwgdXJsKTsKCQkJc2VsZi5wcm9jZXNzKCk7CgkJfSBlbHNlIHsKCQkJLy8gT2xkZXIgYnJvd3NlciBmYWxsYmFjawoJCQlsb2NhdGlvbi5yZXBsYWNlKHJvb3QgKyB1cmwpOwoJCQlzZWxmLnByb2Nlc3MoKTsKCQl9Cgl9OwoKCS8qKgoJICogQ29udGFpbmVyIG9iamVjdCBmb3IgZXh0ZW5zaW9ucwoJICogQG1lbWJlcm9mIFVNRFJvdXRlcgoJICogQG1lbWJlciB7b2JqZWN0fQoJICovCglVTURSb3V0ZXIuZXh0ZW5zaW9ucyA9IHt9OwoKCS8qKgoJICogQWxsb3dzIGZvciBleHRlbmRpbmcgdGhlIFVNRFJvdXRlciBvYmplY3QKCSAqIEBtZW1iZXJvZiBVTURSb3V0ZXIKCSAqIEBtZXRob2QgZXh0ZW5kCgkgKiBAcGFyYW0ge29iamVjdH0gZXh0IC0gVGhlIGV4dGVuc2lvbiB0byBiZSBhcHBsaWVkCgkgKi8KCVVNRFJvdXRlci5leHRlbmQgPSBmdW5jdGlvbiAoZXh0KSB7CgoJCWlmICh0eXBlb2YgZXh0ICE9PSAib2JqZWN0IikgewoJCQl0aHJvdyAiSW52YWxpZCBleHRlbnNpb24gc3BlY2lmaWVkLiI7CgkJfQoKCQlmb3IgKHZhciBrZXkgaW4gZXh0KSB7CgkJCVVNRFJvdXRlci5leHRlbnNpb25zW2tleV0gPSBleHRba2V5XTsKCQl9CgoJfTsKCgkvKioKCSAqIENvbnRhaW5lciBhcnJheSBmb3IgdW5sb2FkIGZ1bmN0aW9ucwoJICogQG1lbWJlcm9mIFVNRFJvdXRlcgoJICogQG1lbWJlciB7YXJyYXl9CgkgKi8KCVVNRFJvdXRlci51bmxvYWRGdW5jdGlvbnMgPSBbXTsKCgkvKioKCSAqIEFkZHMgdW5sb2FkIGZ1bmN0aW9uIHRvIGFycmF5CgkgKiBAbWVtYmVyb2YgVU1EUm91dGVyCgkgKiBAbWV0aG9kIHVubG9hZAoJICogQHBhcmFtIHtmdW5jdGlvbn0gZm4gLSBUaGUgZnVuY3Rpb24gdG8gY2FsbCBvbiB1bmxvYWQKCSAqLwoJVU1EUm91dGVyLnVubG9hZCA9IGZ1bmN0aW9uIChmbikgewoKCQlpZiAodHlwZW9mIGZuICE9PSAiZnVuY3Rpb24iKSB7CgkJCXRocm93ICJJbnZhbGlkIGNhbGxiYWNrIGZ1bmN0aW9uIHNwZWNpZmllZC4iOwoJCX0KCgkJVU1EUm91dGVyLnVubG9hZEZ1bmN0aW9ucy5wdXNoKGZuKTsKCgl9OwoKCS8qKgoJICogQHJldHVybnMgdGhlIFVNRFJvdXRlciBjb250cnVjdG9yCgkgKi8KCXJldHVybiBVTURSb3V0ZXI7Cgp9KSk7Cg==",
                "body": "KGZ1bmN0aW9uIChyb290LCBmYWN0b3J5KSB7CglpZiAodHlwZW9mIGRlZmluZSA9PT0gImZ1bmN0aW9uIiAmJiBkZWZpbmUuYW1kKSB7CgkJZGVmaW5lKFtdLCBmYWN0b3J5KTsKCX0gZWxzZSBpZiAodHlwZW9mIGV4cG9ydHMgPT09ICJvYmplY3QiKSB7CgkJbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCk7Cgl9IGVsc2UgewoJCXJvb3QuVU1EUm91dGVyID0gZmFjdG9yeSgpOwoJfQp9KHRoaXMsIGZ1bmN0aW9uICgpIHsKCgkvKioKCSAqIFJvdXRlciBjb25zdHJ1Y3RvciBmdW5jdGlvbgoJICogQGNvbnN0cnVjdG9yIFJvdXRlcgoJICovCgl2YXIgVU1EUm91dGVyID0gZnVuY3Rpb24gKCkgewoJCXZhciBzZWxmID0gdGhpczsKCgkJLy8gV2F0Y2ggaGFzaGNoYW5nZQoJCXdpbmRvdy5vbmhhc2hjaGFuZ2UgPSBmdW5jdGlvbiAoKSB7CgkJCXNlbGYucHJvY2VzcygpOwoJCX07CgoJCS8vIFJ1biBvbiBsb2FkCgkJd2luZG93Lm9ubG9hZCA9IGZ1bmN0aW9uICgpIHsKCQkJc2VsZi5wcm9jZXNzKCk7CgkJfTsKCX07CgoJLyoqCgkgKiBDb250YWluZXIgb2JqZWN0IGZvciByb3V0ZXMKCSAqIEBtZW1iZXJvZiBVTURSb3V0ZXIKCSAqIEBtZW1iZXIge29iamVjdH0KCSAqLwoJVU1EUm91dGVyLnByb3RvdHlwZS5yb3V0ZXMgPSB7fTsKCgkvKioKCSAqIENvbnRhaW5lciBhcnJheSBmb3IgaGlzdG9yeQoJICogQG1lbWJlcm9mIFVNRFJvdXRlcgoJICogQG1lbWJlciB7YXJyYXl9CgkgKi8KCVVNRFJvdXRlci5wcm90b3R5cGUuaGlzdG9yeSA9IFtdOwoKCS8qKgoJICogUHJvY2Vzc2VzIHJvdXRlIGNoYW5nZQoJICogQG1lbWJlcm9mIFVNRFJvdXRlcgoJICogQG1ldGhvZCBwcm9jZXNzCgkgKi8KCVVNRFJvdXRlci5wcm90b3R5cGUucHJvY2VzcyA9IGZ1bmN0aW9uICgpIHsKCQl2YXIgc2VsZiA9IHRoaXMsCgkJCWZyYWdtZW50ID0gd2luZG93LmxvY2F0aW9uLmhhc2gucmVwbGFjZSgiIyIsICIiKSwKCQkJbWF0Y2ggPSBzZWxmLm1hdGNoKCksCgkJCXJvdXRlID0gbWF0Y2gucm91dGUsCgkJCWFyZ3MgPSBtYXRjaC5hcmdzLAoJCQlwcmV2Um91dGUgPSBmYWxzZSwKCQkJcHJldlNhbmRib3ggPSBudWxsLAoJCQlyb3V0ZU9iaiA9IFtdOwoKCQkvLyBHZXQgcHJldl9yb3V0ZQoJCWlmIChzZWxmLmhpc3RvcnkubGVuZ3RoICE9PSAwKSB7CgkJCXByZXZSb3V0ZSA9IHNlbGYucm91dGVzW3NlbGYuaGlzdG9yeVtzZWxmLmhpc3RvcnkubGVuZ3RoIC0gMV0ubWF0Y2hlcl07CgkJfQoKCQkvLyBFbnN1cmUgYSBtYXRjaCBoYXMgYmVlbiBtYWRlCgkJaWYgKCFyb3V0ZSkgewoJCQlyZXR1cm47CgkJfQoKCQlyb3V0ZU9iaiA9IHNlbGYucm91dGVzW3JvdXRlXTsKCgkJLy8gR2V0IGN1cnJlbnQgcm91dGUgYW5kIHVubG9hZAoJCWlmIChwcmV2Um91dGUgJiYgcHJldlJvdXRlLnVubG9hZCkgewoJCQlwcmV2Um91dGUudW5sb2FkLmFwcGx5KHRoaXMpOwoJCQlmb3IgKHZhciBrZXkgaW4gVU1EUm91dGVyLnVubG9hZEZ1bmN0aW9ucykgewoJCQkJVU1EUm91dGVyLnVubG9hZEZ1bmN0aW9uc1trZXldLmFwcGx5KHByZXZTYW5kYm94KTsKCQkJfQoJCX0KCgkJdmFyIGJlZm9yZUNhbGxiYWNrID0gZnVuY3Rpb24gKGJlZm9yZSkgewoKCQkJaWYgKHR5cGVvZiBiZWZvcmUgPT09ICJ1bmRlZmluZWQiKSB7CgkJCQliZWZvcmUgPSB0cnVlOwoJCQl9CgoJCQlpZiAodHlwZW9mIGFyZ3NbMF0gPT09ICJmdW5jdGlvbiIpIHsKCQkJCWFyZ3Muc2hpZnQoKTsKCQkJfQoKCQkJLy8gSWYgYmVmb3JlIHJldHVybmVkIGZhbHNlLCBnbyBiYWNrCgkJCWlmICghYmVmb3JlKSB7CgkJCQlzZWxmLmdvKHNlbGYuaGlzdG9yeVtzZWxmLmhpc3RvcnkubGVuZ3RoIC0gMV0uZnJhZ21lbnQpOwoJCQl9CgoJCQlpZiAoIXJvdXRlT2JqLmxvYWQpIHsKCQkJCXJldHVybjsKCQkJfQoKCQkJdmFyIHNhbmRib3ggPSBzZWxmLmNyZWF0ZVNhbmRib3gocm91dGUpOwoJCQlwcmV2U2FuZGJveCA9IHNhbmRib3g7CgoJCQlyb3V0ZU9iai5sb2FkLmFwcGx5KHNhbmRib3gsIGFyZ3MpOwoJCQlzZWxmLmhpc3RvcnkucHVzaCh7CgkJCQltYXRjaGVyOiByb3V0ZSwKCQkJCWZyYWdtZW50OiBmcmFnbWVudAoJCQl9KTsKCgkJfTsKCgkJLy8gQ2hlY2sgYW5kIHJ1biAnYmVmb3JlJwoJCWlmIChyb3V0ZU9iai5iZWZvcmUpIHsKCQkJYXJncy51bnNoaWZ0KGJlZm9yZUNhbGxiYWNrKTsKCQkJcm91dGVPYmouYmVmb3JlLmFwcGx5KHRoaXMsIGFyZ3MpOwoJCQlyZXR1cm47CgkJfSBlbHNlIHsKCQkJYmVmb3JlQ2FsbGJhY2sodHJ1ZSk7CgkJfQoKCX07CgoJLyoqCgkgKiBAbWV0aG9kIGNyZWF0ZVNhbmRib3gKCSAqLwoJVU1EUm91dGVyLnByb3RvdHlwZS5jcmVhdGVTYW5kYm94ID0gZnVuY3Rpb24gKHJvdXRlKSB7CgoJCXZhciBzYW5kYm94ID0ge30sCgkJCXJvdXRlT2JqID0gdGhpcy5yb3V0ZXNbcm91dGVdLAoJCQlrZXk7CgoJCWZvciAoa2V5IGluIHJvdXRlT2JqLmV4dGVuZCkgewoJCQlpZiAodHlwZW9mIHJvdXRlT2JqLmV4dGVuZFtrZXldID09PSAiZnVuY3Rpb24iKSB7CgkJCQlzYW5kYm94W2tleV0gPSByb3V0ZU9iai5leHRlbmRba2V5XS5iaW5kKHNhbmRib3gpOwoJCQl9IGVsc2UgewoJCQkJc2FuZGJveFtrZXldID0gcm91dGVPYmouZXh0ZW5kW2tleV07CgkJCX0KCQl9CgoJCWZvciAoa2V5IGluIFVNRFJvdXRlci5leHRlbnNpb25zKSB7CgkJCWlmICh0eXBlb2YgVU1EUm91dGVyLmV4dGVuc2lvbnNba2V5XSA9PT0gImZ1bmN0aW9uIikgewoJCQkJc2FuZGJveFtrZXldID0gVU1EUm91dGVyLmV4dGVuc2lvbnNba2V5XS5iaW5kKHNhbmRib3gpOwoJCQl9IGVsc2UgewoJCQkJc2FuZGJveFtrZXldID0gVU1EUm91dGVyLmV4dGVuc2lvbnNba2V5XTsKCQkJfQoJCX0KCgkJcmV0dXJuIHNhbmRib3g7CgoJfTsKCgkvKioKCSAqIE1hdGNoZXMgcm91dGVzIGFuZCBmaXJlcyBjYWxsYmFjawoJICogQG1lbWJlcm9mIFVNRFJvdXRlcgoJICogQG1ldGhvZCBtYXRjaAoJICovCglVTURSb3V0ZXIucHJvdG90eXBlLm1hdGNoID0gZnVuY3Rpb24gKCkgewoJCXZhciBzZWxmID0gdGhpcywKCQkJZnJhZ21lbnQgPSB3aW5kb3cubG9jYXRpb24uaGFzaC5yZXBsYWNlKCIjIiwgIiIpLAoJCQltYXRjaGVyLAoJCQlyb3V0ZSwKCQkJYXJncyA9IFtdLAoJCQltYXRjaGVkID0gZmFsc2UsCgkJCWksCgkJCXo7CgoJCS8vIE1hdGNoIHJvb3QKCQlpZiAoZnJhZ21lbnQgPT09ICIvIiB8fCBmcmFnbWVudCA9PT0gIiIgJiYgc2VsZi5yb3V0ZXMuaGFzT3duUHJvcGVydHkoIi8iKSkgewoJCQltYXRjaGVkID0gewoJCQkJcm91dGU6ICIvIiwKCQkJCWFyZ3M6IFtdCgkJCX07CgkJfSBlbHNlIHsKCQkJLy8gTWF0Y2ggcm91dGVzCgkJCWZvciAocm91dGUgaW4gc2VsZi5yb3V0ZXMpIHsKCQkJCW1hdGNoZXIgPSBmcmFnbWVudC5tYXRjaChuZXcgUmVnRXhwKHJvdXRlLnJlcGxhY2UoLzpbXlxzL10rL2csICIoW1xcdy1dKykiKSkpOwoJCQkJaWYgKG1hdGNoZXIgIT09IG51bGwgJiYgcm91dGUgIT09ICIvIikgewoJCQkJCWFyZ3MgPSBbXTsKCQkJCQkvLyBHZXQgYXJncwoJCQkJCWlmIChtYXRjaGVyLmxlbmd0aCA+IDEpIHsKCQkJCQkJZm9yIChpID0gMSwgeiA9IG1hdGNoZXIubGVuZ3RoOyBpIDwgejsgaSsrKSB7CgkJCQkJCQlhcmdzLnB1c2gobWF0Y2hlcltpXSk7CgkJCQkJCX0KCQkJCQl9CgkJCQkJbWF0Y2hlZCA9IHsKCQkJCQkJcm91dGU6IHJvdXRlLAoJCQkJCQlhcmdzOiBhcmdzCgkJCQkJfTsKCQkJCX0KCQkJfQoJCX0KCgkJLy8gUmV0dXJuIG1hdGNoZWQgYW5kIGFyZ3VtZW50cwoJCXJldHVybiBtYXRjaGVkOwoKCX07CgoJLyoqCgkgKiBNZXRob2QgdG8gcmVsb2FkIChyZWZyZXNoKSB0aGUgcm91dGUKCSAqIEBtZW1iZXJvZiBVTURSb3V0ZXIKCSAqIEBtZXRob2QgcmVsb2FkCgkgKi8KCVVNRFJvdXRlci5wcm90b3R5cGUucmVsb2FkID0gZnVuY3Rpb24gKCkgewoJCXRoaXMucHJvY2VzcygpOwoJfTsKCgkvKioKCSAqIE1ldGhvZCBmb3IgYmluZGluZyByb3V0ZSB0byBjYWxsYmFjawoJICogQG1lbWJlcm9mIFVNRFJvdXRlcgoJICogQG1ldGhvZCBvbgoJICogQHBhcmFtIHtzdHJpbmd9IHJvdXRlIC0gVGhlIHJvdXRlIHRvIG1hdGNoIGFnYWluc3QKCSAqIEBwYXJhbSB7ZnVuY3Rpb258b2JqZWN0fSBoYW5kbGVyIC0gVGhlIGNhbGxiYWNrIGZ1bmN0aW9uIG9yIGZ1bmN0aW9ucyAob2JqZWN0KQoJICovCglVTURSb3V0ZXIucHJvdG90eXBlLm9uID0gZnVuY3Rpb24gKHJvdXRlLCBoYW5kbGVyKSB7CgoJCXZhciBoYW5kbGVyT2JqID0ge307CgoJCWlmICh0eXBlb2YgaGFuZGxlciA9PT0gImZ1bmN0aW9uIikgewoJCQloYW5kbGVyT2JqLmxvYWQgPSBoYW5kbGVyOwoJCX0gZWxzZSBpZiAodHlwZW9mIGhhbmRsZXIgPT09ICJvYmplY3QiKSB7CgkJCWhhbmRsZXJPYmogPSBoYW5kbGVyOwoJCX0gZWxzZSB7CgkJCXRocm93ICJFcnJvciBjcmVhdGluZyByb3V0ZTogIiArIHJvdXRlICsgIi4gYGhhbmRsZXJgIG11c3QgYmUgYSBmdW5jdGlvbiBvciBvYmplY3QuIjsKCQl9CgoJCXRoaXMuZGVmYXVsdHMoaGFuZGxlck9iaiwgewoJCQkiYmVmb3JlIjogbnVsbCwKCQkJImxvYWQiOiBudWxsLAoJCQkidW5sb2FkIjogbnVsbCwKCQkJImV4dGVuZCI6IHt9CgkJfSk7CgoJCXRoaXMucm91dGVzW3JvdXRlXSA9IGhhbmRsZXJPYmo7CgoJfTsKCgkvKioKCSAqIFNlZSB1bmRlcnNjb3JlLmRlZmF1bHRzKCkuCgkgKiBAbWVtYmVyb2YgVU1EUm91dGVyCgkgKiBAbWV0aG9kIGRlZmF1bHRzCgkgKi8KCVVNRFJvdXRlci5wcm90b3R5cGUuZGVmYXVsdHMgPSBmdW5jdGlvbiAob2JqLCBkZWZhdWx0cykgewoJCW9iaiA9IG9iaiB8fCB7fTsKCQlmb3IgKHZhciBrZXkgaW4gZGVmYXVsdHMpIHsKCQkJaWYgKCFvYmpba2V5XSkgewoJCQkJb2JqW2tleV0gPSBkZWZhdWx0c1trZXldOwoJCQl9CgkJfQoJfTsKCgkvKioKCSAqIE1ldGhvZCBmb3IgcHJvZ3JhbWF0aWNhbGx5IG5hdmlnYXRpbmcgdG8gcm91dGUKCSAqIEBtZW1iZXJvZiBVTURSb3V0ZXIKCSAqIEBtZXRob2QgZ28KCSAqIEBwYXJhbSB7c3RyaW5nfSBwYXRoIC0gVGhlIHJvdXRlIHRvIG5hdmlnYXRlIHRvCgkgKi8KCVVNRFJvdXRlci5wcm90b3R5cGUuZ28gPSBmdW5jdGlvbiAocGF0aCkgewoKCQl2YXIgbG9jYXRpb24gPSB3aW5kb3cubG9jYXRpb24sCgkJCXJvb3QgPSBsb2NhdGlvbi5wYXRobmFtZS5yZXBsYWNlKC9bXlwvXSQvLCAiJCYiKSwKCQkJdXJsLAoJCQlzZWxmID0gdGhpczsKCgkJLy8gSGFuZGxlIHVybCBjb21wb3NpdGlvbgoJCWlmIChwYXRoLmxlbmd0aCkgewoJCQkvLyBGcmFnbWVudCBleGlzdHMKCQkJdXJsID0gcm9vdCArIGxvY2F0aW9uLnNlYXJjaCArICIjIiArIHBhdGg7CgkJfSBlbHNlIHsKCQkJLy8gTnVsbC9CbGFuayBmcmFnbWVudCwgbmF2IHRvIHJvb3QKCQkJdXJsID0gcm9vdCArIGxvY2F0aW9uLnNlYXJjaDsKCQl9CgoJCWlmIChoaXN0b3J5LnB1c2hTdGF0ZSkgewoJCQkvLyBCcm93c2VyIHN1cHBvcnRzIHB1c2hTdGF0ZSgpCgkJCWhpc3RvcnkucHVzaFN0YXRlKG51bGwsIGRvY3VtZW50LnRpdGxlLCB1cmwpOwoJCQlzZWxmLnByb2Nlc3MoKTsKCQl9IGVsc2UgewoJCQkvLyBPbGRlciBicm93c2VyIGZhbGxiYWNrCgkJCWxvY2F0aW9uLnJlcGxhY2Uocm9vdCArIHVybCk7CgkJCXNlbGYucHJvY2VzcygpOwoJCX0KCX07CgoJLyoqCgkgKiBDb250YWluZXIgb2JqZWN0IGZvciBleHRlbnNpb25zCgkgKiBAbWVtYmVyb2YgVU1EUm91dGVyCgkgKiBAbWVtYmVyIHtvYmplY3R9CgkgKi8KCVVNRFJvdXRlci5leHRlbnNpb25zID0ge307CgoJLyoqCgkgKiBBbGxvd3MgZm9yIGV4dGVuZGluZyB0aGUgVU1EUm91dGVyIG9iamVjdAoJICogQG1lbWJlcm9mIFVNRFJvdXRlcgoJICogQG1ldGhvZCBleHRlbmQKCSAqIEBwYXJhbSB7b2JqZWN0fSBleHQgLSBUaGUgZXh0ZW5zaW9uIHRvIGJlIGFwcGxpZWQKCSAqLwoJVU1EUm91dGVyLmV4dGVuZCA9IGZ1bmN0aW9uIChleHQpIHsKCgkJaWYgKHR5cGVvZiBleHQgIT09ICJvYmplY3QiKSB7CgkJCXRocm93ICJJbnZhbGlkIGV4dGVuc2lvbiBzcGVjaWZpZWQuIjsKCQl9CgoJCWZvciAodmFyIGtleSBpbiBleHQpIHsKCQkJVU1EUm91dGVyLmV4dGVuc2lvbnNba2V5XSA9IGV4dFtrZXldOwoJCX0KCgl9OwoKCS8qKgoJICogQ29udGFpbmVyIGFycmF5IGZvciB1bmxvYWQgZnVuY3Rpb25zCgkgKiBAbWVtYmVyb2YgVU1EUm91dGVyCgkgKiBAbWVtYmVyIHthcnJheX0KCSAqLwoJVU1EUm91dGVyLnVubG9hZEZ1bmN0aW9ucyA9IFtdOwoKCS8qKgoJICogQWRkcyB1bmxvYWQgZnVuY3Rpb24gdG8gYXJyYXkKCSAqIEBtZW1iZXJvZiBVTURSb3V0ZXIKCSAqIEBtZXRob2QgdW5sb2FkCgkgKiBAcGFyYW0ge2Z1bmN0aW9ufSBmbiAtIFRoZSBmdW5jdGlvbiB0byBjYWxsIG9uIHVubG9hZAoJICovCglVTURSb3V0ZXIudW5sb2FkID0gZnVuY3Rpb24gKGZuKSB7CgoJCWlmICh0eXBlb2YgZm4gIT09ICJmdW5jdGlvbiIpIHsKCQkJdGhyb3cgIkludmFsaWQgY2FsbGJhY2sgZnVuY3Rpb24gc3BlY2lmaWVkLiI7CgkJfQoKCQlVTURSb3V0ZXIudW5sb2FkRnVuY3Rpb25zLnB1c2goZm4pOwoKCX07CgoJLyoqCgkgKiBAcmV0dXJucyB0aGUgVU1EUm91dGVyIGNvbnRydWN0b3IKCSAqLwoJcmV0dXJuIFVNRFJvdXRlcjsKCn0pKTsK",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Sun, 09 Nov 2014 00:39:49 GMT",
                    "Content-Length": "6624",
                    "Date": "Sun, 09 Nov 2014 00:39:49 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}