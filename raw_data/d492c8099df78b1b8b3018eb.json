{
    "url": "http://localhost:9999/mrdoob/three.js/examples/webgl_geometry_text2.html",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "Link manipulation (DOM-based)",
    "issueType": 5246976,
    "severity": "Low",
    "confidence": "Firm",
    "issueBackground": "DOM-based link manipulation vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this to a navigation target within the current page, such as a clickable link or the submission URL of a form. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will modify the target of links within the response. An attacker may be able to leverage this to perform various attacks, including:<ul><li>Causing the user to redirect to an arbitrary external URL, to facilitate a phishing attack.</li><li>Causing the user to submit sensitive form data to a server controlled by the attacker.</li><li>Causing the user to perform an unintended action within the application, by changing the file or query string associated with a link.</li><li>Bypassing browser anti-XSS defenses by injecting on-site links containing XSS exploits, since browser anti-XSS defenses typically do not operate on on-site links.</li></ul>",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based link manipulation vulnerabilities is not to dynamically set the target URLs of links or forms using data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from introducing an arbitrary URL as a link target. In general, this is best achieved by using a whitelist of URLs that are permitted link targets, and strictly validating the target against this list before setting the link target.",
    "issueDetail": "The application may be vulnerable to DOM-based link manipulation. Data is read from <b>document.location.hash</b> and written to <b>the 'href' property of a DOM element</b> via the following statements:<ul><li>var hash = document.location.hash.substr( 1 );</li><li>var colorhash  = hash.substring( 0, 6 );</li><li>hex = colorhash;</li><li>var link = hex + fontMap[ font ] + weightMap[ weight ] + boolToNum( postprocessing.enabled ) + boolToNum( bevelEnabled ) + \"#\" + encodeURI( text );</li><li>permalink.href = \"#\" + link;</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/mrdoob/three.js/examples/webgl_geometry_text2.html",
                "path": "/mrdoob/three.js/examples/webgl_geometry_text2.html",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9tcmRvb2IvdGhyZWUuanMvZXhhbXBsZXMvd2ViZ2xfZ2VvbWV0cnlfdGV4dDIuaHRtbCBIVFRQLzEuMQ0KSG9zdDogbG9jYWxob3N0Ojk5OTkNCg0K",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMTU5NDgNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IHRleHQvaHRtbDsgY2hhcnNldD11dGYtOA0KRGF0ZTogU2F0LCAwOCBOb3YgMjAxNCAxNTozODowMyBHTVQNCkxhc3QtTW9kaWZpZWQ6IFNhdCwgMDggTm92IDIwMTQgMTU6Mzc6NTUgR01UDQoNCjwhRE9DVFlQRSBodG1sPgo8aHRtbCBsYW5nPSJlbiI+Cgk8aGVhZD4KCQk8dGl0bGU+dGhyZWUuanMgd2ViZ2wgLSBnZW9tZXRyeSAtIHRleHQ8L3RpdGxlPgoJCTxtZXRhIGNoYXJzZXQ9InV0Zi04Ij4KCQk8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCB1c2VyLXNjYWxhYmxlPW5vLCBtaW5pbXVtLXNjYWxlPTEuMCwgbWF4aW11bS1zY2FsZT0xLjAiPgoJCTxzdHlsZT4KCQkJYm9keSB7CgkJCQlmb250LWZhbWlseTogTW9ub3NwYWNlOwoJCQkJYmFja2dyb3VuZC1jb2xvcjogIzAwMDsKCQkJCWNvbG9yOiAjZmZmOwoJCQkJbWFyZ2luOiAwcHg7CgkJCQlvdmVyZmxvdzogaGlkZGVuOwoJCQl9CgkJCSNpbmZvIHsKCQkJCXBvc2l0aW9uOiBhYnNvbHV0ZTsKCQkJCXRvcDogMTBweDsKCQkJCXdpZHRoOiAxMDAlOwoJCQkJdGV4dC1hbGlnbjogY2VudGVyOwoJCQkJei1pbmRleDogMTAwOwoJCQkJZGlzcGxheTpibG9jazsKCQkJfQoJCQkjaW5mbyBhLCAuYnV0dG9uIHsgY29sb3I6ICNmMDA7IGZvbnQtd2VpZ2h0OiBib2xkOyB0ZXh0LWRlY29yYXRpb246IHVuZGVybGluZTsgY3Vyc29yOiBwb2ludGVyIH0KCQk8L3N0eWxlPgoJPC9oZWFkPgoJPGJvZHk+CgoJCTxkaXYgaWQ9ImluZm8iPgoJCTxhIGhyZWY9Imh0dHA6Ly90aHJlZWpzLm9yZyIgdGFyZ2V0PSJfYmxhbmsiPnRocmVlLmpzPC9hPiAtIHByb2NlZHVyYWwgM0QgdGV4dCBieSA8YSBocmVmPSJodHRwOi8vd3d3LmxhYjRnYW1lcy5uZXQveno4NS9ibG9nIiB0YXJnZXQ9Il9ibGFuayI+eno4NTwvYT4gJmFtcDsgYWx0ZXJlZHEKCQkoZm9udHMgZnJvbSA8YSBocmVmPSJodHRwOi8vdHlwZWZhY2UubmVvY3JhY3kub3JnLyI+dHlwZWZhY2UuanM8L2E+IGFuZCA8YSBocmVmPSJodHRwOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0Ryb2lkXyUyOGZvbnQlMjkiPkRyb2lkPC9hPikKCQk8YnIvPmJ1aWx0LWluIHNoYXBlIHRyaWFuZ3VsYXRpb24gaGFzIGJlZW4gcmVwbGFjZWQgd2l0aCA8YSBocmVmPSJodHRwczovL2dpdGh1Yi5jb20vamFodGluZy9wbmx0cmkuanMiPlBubFRyaS5qczwvYT4gYnkgPGEgaHJlZj0iaHR0cHM6Ly9naXRodWIuY29tL2phaHRpbmciIHRhcmdldD0iX2JsYW5rIj5qIGFodGluZzwvYT4KCQk8YnIvPnR5cGUgdG8gZW50ZXIgbmV3IHRleHQsIGRyYWcgdG8gc3BpbiB0aGUgdGV4dAoJCTxici8+PHNwYW4gY2xhc3M9ImJ1dHRvbiIgaWQ9ImNvbG9yIj5jaGFuZ2UgY29sb3I8L3NwYW4+LAoJCQk8c3BhbiBjbGFzcz0iYnV0dG9uIiBpZD0iZm9udCI+Y2hhbmdlIGZvbnQ8L3NwYW4+LAoJCQk8c3BhbiBjbGFzcz0iYnV0dG9uIiBpZD0id2VpZ2h0Ij5jaGFuZ2Ugd2VpZ2h0PC9zcGFuPiwKCQkJPHNwYW4gY2xhc3M9ImJ1dHRvbiIgaWQ9ImJldmVsIj5jaGFuZ2UgYmV2ZWw8L3NwYW4+LAoJCQk8c3BhbiBjbGFzcz0iYnV0dG9uIiBpZD0icG9zdHByb2Nlc3NpbmciPmNoYW5nZSBwb3N0cHJvY2Vzc2luZzwvc3Bhbj4sCgkJCTxhIGlkPSJwZXJtYWxpbmsiIGhyZWY9IiMiPnBlcm1hbGluazwvYT4KCQk8L2Rpdj4KCgoJCTxzY3JpcHQgc3JjPSIuLi9idWlsZC90aHJlZS5taW4uanMiPjwvc2NyaXB0PgoJCTxzY3JpcHQgc3JjPSJqcy91dGlscy9HZW9tZXRyeVV0aWxzLmpzIj48L3NjcmlwdD4KCgkJPHNjcmlwdCBzcmM9ImpzL3NoYWRlcnMvQ29udm9sdXRpb25TaGFkZXIuanMiPjwvc2NyaXB0PgoJCTxzY3JpcHQgc3JjPSJqcy9zaGFkZXJzL0NvcHlTaGFkZXIuanMiPjwvc2NyaXB0PgoJCTxzY3JpcHQgc3JjPSJqcy9zaGFkZXJzL0ZpbG1TaGFkZXIuanMiPjwvc2NyaXB0PgoJCTxzY3JpcHQgc3JjPSJqcy9zaGFkZXJzL0ZYQUFTaGFkZXIuanMiPjwvc2NyaXB0PgoKCQk8c2NyaXB0IHNyYz0ianMvcG9zdHByb2Nlc3NpbmcvRWZmZWN0Q29tcG9zZXIuanMiPjwvc2NyaXB0PgoJCTxzY3JpcHQgc3JjPSJqcy9wb3N0cHJvY2Vzc2luZy9SZW5kZXJQYXNzLmpzIj48L3NjcmlwdD4KCQk8c2NyaXB0IHNyYz0ianMvcG9zdHByb2Nlc3NpbmcvU2hhZGVyUGFzcy5qcyI+PC9zY3JpcHQ+CgkJPHNjcmlwdCBzcmM9ImpzL3Bvc3Rwcm9jZXNzaW5nL01hc2tQYXNzLmpzIj48L3NjcmlwdD4KCQk8c2NyaXB0IHNyYz0ianMvcG9zdHByb2Nlc3NpbmcvQmxvb21QYXNzLmpzIj48L3NjcmlwdD4KCQk8c2NyaXB0IHNyYz0ianMvcG9zdHByb2Nlc3NpbmcvRmlsbVBhc3MuanMiPjwvc2NyaXB0PgoKCQk8c2NyaXB0IHNyYz0ianMvRGV0ZWN0b3IuanMiPjwvc2NyaXB0PgoJCTxzY3JpcHQgc3JjPSJqcy9saWJzL3N0YXRzLm1pbi5qcyI+PC9zY3JpcHQ+CgoJCTwhLS0gbG9hZCB0aGUgZm9udCBmaWxlcyAtLT4KCgkJPHNjcmlwdCBzcmM9ImZvbnRzL2dlbnRpbGlzX2JvbGQudHlwZWZhY2UuanMiPjwvc2NyaXB0PgoJCTxzY3JpcHQgc3JjPSJmb250cy9nZW50aWxpc19yZWd1bGFyLnR5cGVmYWNlLmpzIj48L3NjcmlwdD4KCQk8c2NyaXB0IHNyYz0iZm9udHMvb3B0aW1lcl9ib2xkLnR5cGVmYWNlLmpzIj48L3NjcmlwdD4KCQk8c2NyaXB0IHNyYz0iZm9udHMvb3B0aW1lcl9yZWd1bGFyLnR5cGVmYWNlLmpzIj48L3NjcmlwdD4KCQk8c2NyaXB0IHNyYz0iZm9udHMvaGVsdmV0aWtlcl9ib2xkLnR5cGVmYWNlLmpzIj48L3NjcmlwdD4KCQk8c2NyaXB0IHNyYz0iZm9udHMvaGVsdmV0aWtlcl9yZWd1bGFyLnR5cGVmYWNlLmpzIj48L3NjcmlwdD4KCQk8c2NyaXB0IHNyYz0iZm9udHMvZHJvaWQvZHJvaWRfc2Fuc19yZWd1bGFyLnR5cGVmYWNlLmpzIj48L3NjcmlwdD4KCQk8c2NyaXB0IHNyYz0iZm9udHMvZHJvaWQvZHJvaWRfc2Fuc19ib2xkLnR5cGVmYWNlLmpzIj48L3NjcmlwdD4KCQk8c2NyaXB0IHNyYz0iZm9udHMvZHJvaWQvZHJvaWRfc2VyaWZfcmVndWxhci50eXBlZmFjZS5qcyI+PC9zY3JpcHQ+CgkJPHNjcmlwdCBzcmM9ImZvbnRzL2Ryb2lkL2Ryb2lkX3NlcmlmX2JvbGQudHlwZWZhY2UuanMiPjwvc2NyaXB0PgoKCQk8IS0tIHRvZG8gYXN5bmMgbG9hZGVyIGZvciBmb250cyAtLT4KCgoJCTwhLS0gcmVwbGFjZSBidWlsdC1pbiB0cmlhbmd1bGF0aW9uIHdpdGggUG5sVHJpLmpzIC0tPgoJCTxzY3JpcHQgc3JjPSJqcy9saWJzL3BubHRyaS5taW4uanMiPjwvc2NyaXB0PgoJCTxzY3JpcHQ+CgkJCVRIUkVFLlNoYXBlLlV0aWxzLnRyaWFuZ3VsYXRlU2hhcGUgPSAoIGZ1bmN0aW9uICgpIHsKCQkJCXZhciBwbmxUcmlhbmd1bGF0b3IgPSBuZXcgUE5MVFJJLlRyaWFuZ3VsYXRvcigpOwoJCQkJcmV0dXJuIGZ1bmN0aW9uICggY29udG91ciwgaG9sZXMgKSB7CgkJCQkJLy8gY29uc29sZS5sb2coIm5ldyBUcmlhbmd1bGF0aW9uOiBQbmxUcmkuanMgIiArIFBOTFRSSS5SRVZJU0lPTiApOwoJCQkJCXJldHVybiBwbmxUcmlhbmd1bGF0b3IudHJpYW5ndWxhdGVfcG9seWdvbiggWyBjb250b3VyIF0uY29uY2F0KGhvbGVzKSApOwoJCQkJfTsKCQkJfSApKCk7CgkJPC9zY3JpcHQ+CgkJCgoJCTxzY3JpcHQ+CgoJCQlpZiAoICEgRGV0ZWN0b3Iud2ViZ2wgKSBEZXRlY3Rvci5hZGRHZXRXZWJHTE1lc3NhZ2UoKTsKCgkJCXZhciBjb250YWluZXIsIHN0YXRzLCBwZXJtYWxpbmssIGhleCwgY29sb3I7CgoJCQl2YXIgY2FtZXJhLCBjYW1lcmFUYXJnZXQsIHNjZW5lLCByZW5kZXJlcjsKCgkJCXZhciBjb21wb3NlcjsKCQkJdmFyIGVmZmVjdEZYQUE7CgoJCQl2YXIgZ3JvdXAsIHRleHRNZXNoMSwgdGV4dE1lc2gyLCB0ZXh0R2VvLCBtYXRlcmlhbDsKCgkJCXZhciBmaXJzdExldHRlciA9IHRydWU7CgoJCQl2YXIgdGV4dCA9ICJ0aHJlZS5qcyIsCgoJCQkJaGVpZ2h0ID0gMjAsCgkJCQlzaXplID0gNzAsCgkJCQlob3ZlciA9IDMwLAoKCQkJCWN1cnZlU2VnbWVudHMgPSA0LAoKCQkJCWJldmVsVGhpY2tuZXNzID0gMiwKCQkJCWJldmVsU2l6ZSA9IDEuNSwKCQkJCWJldmVsU2VnbWVudHMgPSAzLAoJCQkJYmV2ZWxFbmFibGVkID0gdHJ1ZSwKCgkJCQlmb250ID0gIm9wdGltZXIiLCAvLyBoZWx2ZXRpa2VyLCBvcHRpbWVyLCBnZW50aWxpcywgZHJvaWQgc2FucywgZHJvaWQgc2VyaWYKCQkJCXdlaWdodCA9ICJib2xkIiwgLy8gbm9ybWFsIGJvbGQKCQkJCXN0eWxlID0gIm5vcm1hbCI7IC8vIG5vcm1hbCBpdGFsaWMKCgkJCXZhciBtaXJyb3IgPSB0cnVlOwoKCQkJdmFyIGZvbnRNYXAgPSB7CgoJCQkJImhlbHZldGlrZXIiOiAwLAoJCQkJIm9wdGltZXIiOiAxLAoJCQkJImdlbnRpbGlzIjogMiwKCQkJCSJkcm9pZCBzYW5zIjogMywKCQkJCSJkcm9pZCBzZXJpZiI6IDQKCgkJCX07CgoJCQl2YXIgd2VpZ2h0TWFwID0gewoKCQkJCSJub3JtYWwiOiAwLAoJCQkJImJvbGQiOiAxCgoJCQl9OwoKCQkJdmFyIHJldmVyc2VGb250TWFwID0ge307CgkJCXZhciByZXZlcnNlV2VpZ2h0TWFwID0ge307CgoJCQlmb3IgKCB2YXIgaSBpbiBmb250TWFwICkgcmV2ZXJzZUZvbnRNYXBbIGZvbnRNYXBbaV0gXSA9IGk7CgkJCWZvciAoIHZhciBpIGluIHdlaWdodE1hcCApIHJldmVyc2VXZWlnaHRNYXBbIHdlaWdodE1hcFtpXSBdID0gaTsKCgkJCXZhciB0YXJnZXRSb3RhdGlvbiA9IDA7CgkJCXZhciB0YXJnZXRSb3RhdGlvbk9uTW91c2VEb3duID0gMDsKCgkJCXZhciBtb3VzZVggPSAwOwoJCQl2YXIgbW91c2VYT25Nb3VzZURvd24gPSAwOwoKCQkJdmFyIHdpbmRvd0hhbGZYID0gd2luZG93LmlubmVyV2lkdGggLyAyOwoJCQl2YXIgd2luZG93SGFsZlkgPSB3aW5kb3cuaW5uZXJIZWlnaHQgLyAyOwoKCQkJdmFyIHBvc3Rwcm9jZXNzaW5nID0geyBlbmFibGVkIDogZmFsc2UgfTsKCQkJdmFyIGdsb3cgPSAwLjk7CgoJCQlpbml0KCk7CgkJCWFuaW1hdGUoKTsKCgkJCWZ1bmN0aW9uIGNhcGl0YWxpemUoIHR4dCApIHsKCgkJCQlyZXR1cm4gdHh0LnN1YnN0cmluZyggMCwgMSApLnRvVXBwZXJDYXNlKCkgKyB0eHQuc3Vic3RyaW5nKCAxICk7CgoJCQl9CgoJCQlmdW5jdGlvbiBkZWNpbWFsVG9IZXgoIGQgKSB7CgoJCQkJdmFyIGhleCA9IE51bWJlciggZCApLnRvU3RyaW5nKCAxNiApOwoJCQkJaGV4ID0gIjAwMDAwMCIuc3Vic3RyKCAwLCA2IC0gaGV4Lmxlbmd0aCApICsgaGV4OwoJCQkJcmV0dXJuIGhleC50b1VwcGVyQ2FzZSgpOwoKCQkJfQoKCQkJZnVuY3Rpb24gaW5pdCgpIHsKCgkJCQljb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAnZGl2JyApOwoJCQkJZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCggY29udGFpbmVyICk7CgoJCQkJcGVybWFsaW5rID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoICJwZXJtYWxpbmsiICk7CgoJCQkJLy8gQ0FNRVJBCgoJCQkJY2FtZXJhID0gbmV3IFRIUkVFLlBlcnNwZWN0aXZlQ2FtZXJhKCAzMCwgd2luZG93LmlubmVyV2lkdGggLyB3aW5kb3cuaW5uZXJIZWlnaHQsIDEsIDE1MDAgKTsKCQkJCWNhbWVyYS5wb3NpdGlvbi5zZXQoIDAsIDQwMCwgNzAwICk7CgoJCQkJY2FtZXJhVGFyZ2V0ID0gbmV3IFRIUkVFLlZlY3RvcjMoIDAsIDE1MCwgMCApOwoKCQkJCS8vIFNDRU5FCgoJCQkJc2NlbmUgPSBuZXcgVEhSRUUuU2NlbmUoKTsKCQkJCXNjZW5lLmZvZyA9IG5ldyBUSFJFRS5Gb2coIDB4MDAwMDAwLCAyNTAsIDE0MDAgKTsKCgkJCQkvLyBMSUdIVFMKCgkJCQl2YXIgZGlyTGlnaHQgPSBuZXcgVEhSRUUuRGlyZWN0aW9uYWxMaWdodCggMHhmZmZmZmYsIDAuMTI1ICk7CgkJCQlkaXJMaWdodC5wb3NpdGlvbi5zZXQoIDAsIDAsIDEgKS5ub3JtYWxpemUoKTsKCQkJCXNjZW5lLmFkZCggZGlyTGlnaHQgKTsKCgkJCQl2YXIgcG9pbnRMaWdodCA9IG5ldyBUSFJFRS5Qb2ludExpZ2h0KCAweGZmZmZmZiwgMS41ICk7CgkJCQlwb2ludExpZ2h0LnBvc2l0aW9uLnNldCggMCwgMTAwLCA5MCApOwoJCQkJc2NlbmUuYWRkKCBwb2ludExpZ2h0ICk7CgoJCQkJLy90ZXh0ID0gY2FwaXRhbGl6ZSggZm9udCApICsgIiAiICsgY2FwaXRhbGl6ZSggd2VpZ2h0ICk7CgkJCQkvL3RleHQgPSAiYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5IjsKCQkJCS8vdGV4dCA9ICJBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWjAxMjM0NTY3ODkiOwoKCQkJCS8vIEdldCB0ZXh0IGZyb20gaGFzaAoKCQkJCXZhciBoYXNoID0gZG9jdW1lbnQubG9jYXRpb24uaGFzaC5zdWJzdHIoIDEgKTsKCgkJCQlpZiAoIGhhc2gubGVuZ3RoICE9PSAwICkgewoKCQkJCQl2YXIgY29sb3JoYXNoICA9IGhhc2guc3Vic3RyaW5nKCAwLCA2ICk7CgkJCQkJdmFyIGZvbnRoYXNoICAgPSBoYXNoLnN1YnN0cmluZyggNiwgNyApOwoJCQkJCXZhciB3ZWlnaHRoYXNoID0gaGFzaC5zdWJzdHJpbmcoIDcsIDggKTsKCQkJCQl2YXIgcHBoYXNoIAkgICA9IGhhc2guc3Vic3RyaW5nKCA4LCA5ICk7CgkJCQkJdmFyIGJldmVsaGFzaCAgPSBoYXNoLnN1YnN0cmluZyggOSwgMTAgKTsKCQkJCQl2YXIgdGV4dGhhc2ggICA9IGhhc2guc3Vic3RyaW5nKCAxMCApOwoKCQkJCQloZXggPSBjb2xvcmhhc2g7CgkJCQkJcG9pbnRMaWdodC5jb2xvci5zZXRIZXgoIHBhcnNlSW50KCBjb2xvcmhhc2gsIDE2ICkgKTsKCgkJCQkJZm9udCA9IHJldmVyc2VGb250TWFwWyBwYXJzZUludCggZm9udGhhc2ggKSBdOwoJCQkJCXdlaWdodCA9IHJldmVyc2VXZWlnaHRNYXBbIHBhcnNlSW50KCB3ZWlnaHRoYXNoICkgXTsKCgkJCQkJcG9zdHByb2Nlc3NpbmcuZW5hYmxlZCA9IHBhcnNlSW50KCBwcGhhc2ggKTsKCQkJCQliZXZlbEVuYWJsZWQgPSBwYXJzZUludCggYmV2ZWxoYXNoICk7CgoJCQkJCXRleHQgPSBkZWNvZGVVUkkoIHRleHRoYXNoICk7CgoJCQkJCXVwZGF0ZVBlcm1hbGluaygpOwoKCQkJCX0gZWxzZSB7CgoJCQkJCXBvaW50TGlnaHQuY29sb3Iuc2V0SFNMKCBNYXRoLnJhbmRvbSgpLCAxLCAwLjUgKTsKCQkJCQloZXggPSBkZWNpbWFsVG9IZXgoIHBvaW50TGlnaHQuY29sb3IuZ2V0SGV4KCkgKTsKCgkJCQl9CgoJCQkJbWF0ZXJpYWwgPSBuZXcgVEhSRUUuTWVzaEZhY2VNYXRlcmlhbCggWyAKCQkJCQluZXcgVEhSRUUuTWVzaFBob25nTWF0ZXJpYWwoIHsgY29sb3I6IDB4ZmZmZmZmLCBzaGFkaW5nOiBUSFJFRS5GbGF0U2hhZGluZyB9ICksIC8vIGZyb250CgkJCQkJbmV3IFRIUkVFLk1lc2hQaG9uZ01hdGVyaWFsKCB7IGNvbG9yOiAweGZmZmZmZiwgc2hhZGluZzogVEhSRUUuU21vb3RoU2hhZGluZyB9ICkgLy8gc2lkZQoJCQkJXSApOwoKCQkJCWdyb3VwID0gbmV3IFRIUkVFLkdyb3VwKCk7CgkJCQlncm91cC5wb3NpdGlvbi55ID0gMTAwOwoKCQkJCXNjZW5lLmFkZCggZ3JvdXAgKTsKCgkJCQljcmVhdGVUZXh0KCk7CgoJCQkJdmFyIHBsYW5lID0gbmV3IFRIUkVFLk1lc2goCgkJCQkJbmV3IFRIUkVFLlBsYW5lQnVmZmVyR2VvbWV0cnkoIDEwMDAwLCAxMDAwMCApLAoJCQkJCW5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCggeyBjb2xvcjogMHhmZmZmZmYsIG9wYWNpdHk6IDAuNSwgdHJhbnNwYXJlbnQ6IHRydWUgfSApCgkJCQkpOwoJCQkJcGxhbmUucG9zaXRpb24ueSA9IDEwMDsKCQkJCXBsYW5lLnJvdGF0aW9uLnggPSAtIE1hdGguUEkgLyAyOwoJCQkJc2NlbmUuYWRkKCBwbGFuZSApOwoKCQkJCS8vIFJFTkRFUkVSCgoJCQkJcmVuZGVyZXIgPSBuZXcgVEhSRUUuV2ViR0xSZW5kZXJlciggeyBhbnRpYWxpYXM6IHRydWUgfSApOwoJCQkJcmVuZGVyZXIuc2V0U2l6ZSggd2luZG93LmlubmVyV2lkdGgsIHdpbmRvdy5pbm5lckhlaWdodCApOwoKCQkJCXJlbmRlcmVyLnNldENsZWFyQ29sb3IoIHNjZW5lLmZvZy5jb2xvciwgMSApOwoKCQkJCWNvbnRhaW5lci5hcHBlbmRDaGlsZCggcmVuZGVyZXIuZG9tRWxlbWVudCApOwoKCQkJCS8vIFNUQVRTCgoJCQkJc3RhdHMgPSBuZXcgU3RhdHMoKTsKCQkJCXN0YXRzLmRvbUVsZW1lbnQuc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnOwoJCQkJc3RhdHMuZG9tRWxlbWVudC5zdHlsZS50b3AgPSAnMHB4JzsKCQkJCS8vY29udGFpbmVyLmFwcGVuZENoaWxkKCBzdGF0cy5kb21FbGVtZW50ICk7CgoJCQkJLy8gRVZFTlRTCgoJCQkJZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lciggJ21vdXNlZG93bicsIG9uRG9jdW1lbnRNb3VzZURvd24sIGZhbHNlICk7CgkJCQlkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCAndG91Y2hzdGFydCcsIG9uRG9jdW1lbnRUb3VjaFN0YXJ0LCBmYWxzZSApOwoJCQkJZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lciggJ3RvdWNobW92ZScsIG9uRG9jdW1lbnRUb3VjaE1vdmUsIGZhbHNlICk7CgkJCQlkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCAna2V5cHJlc3MnLCBvbkRvY3VtZW50S2V5UHJlc3MsIGZhbHNlICk7CgkJCQlkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCAna2V5ZG93bicsIG9uRG9jdW1lbnRLZXlEb3duLCBmYWxzZSApOwoKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCAiY29sb3IiICkuYWRkRXZlbnRMaXN0ZW5lciggJ2NsaWNrJywgZnVuY3Rpb24oKSB7CgoJCQkJCXBvaW50TGlnaHQuY29sb3Iuc2V0SFNMKCBNYXRoLnJhbmRvbSgpLCAxLCAwLjUgKTsKCQkJCQloZXggPSBkZWNpbWFsVG9IZXgoIHBvaW50TGlnaHQuY29sb3IuZ2V0SGV4KCkgKTsKCgkJCQkJdXBkYXRlUGVybWFsaW5rKCk7CgoJCQkJfSwgZmFsc2UgKTsKCgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCggImZvbnQiICkuYWRkRXZlbnRMaXN0ZW5lciggJ2NsaWNrJywgZnVuY3Rpb24oKSB7CgoJCQkJCWlmICggZm9udCA9PSAiaGVsdmV0aWtlciIgKSB7CgoJCQkJCQlmb250ID0gIm9wdGltZXIiOwoKCQkJCQl9IGVsc2UgaWYgKCBmb250ID09ICJvcHRpbWVyIiApIHsKCgkJCQkJCWZvbnQgPSAiZ2VudGlsaXMiOwoKCQkJCQl9IGVsc2UgaWYgKCBmb250ID09ICJnZW50aWxpcyIgKSB7CgoJCQkJCQlmb250ID0gImRyb2lkIHNhbnMiOwoKCQkJCQl9IGVsc2UgaWYgKCBmb250ID09ICJkcm9pZCBzYW5zIiApIHsKCgkJCQkJCWZvbnQgPSAiZHJvaWQgc2VyaWYiOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJZm9udCA9ICJoZWx2ZXRpa2VyIjsKCgkJCQkJfQoKCQkJCQlyZWZyZXNoVGV4dCgpOwoKCQkJCX0sIGZhbHNlICk7CgoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoICJ3ZWlnaHQiICkuYWRkRXZlbnRMaXN0ZW5lciggJ2NsaWNrJywgZnVuY3Rpb24oKSB7CgoJCQkJCWlmICggd2VpZ2h0ID09ICJib2xkIiApIHsKCgkJCQkJCXdlaWdodCA9ICJub3JtYWwiOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJd2VpZ2h0ID0gImJvbGQiOwoKCQkJCQl9CgoJCQkJCXJlZnJlc2hUZXh0KCk7CgoJCQkJfSwgZmFsc2UgKTsKCgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCggImJldmVsIiApLmFkZEV2ZW50TGlzdGVuZXIoICdjbGljaycsIGZ1bmN0aW9uKCkgewoKCQkJCQliZXZlbEVuYWJsZWQgPSAhYmV2ZWxFbmFibGVkOwoKCQkJCQlyZWZyZXNoVGV4dCgpOwoKCQkJCX0sIGZhbHNlICk7CgoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoICJwb3N0cHJvY2Vzc2luZyIgKS5hZGRFdmVudExpc3RlbmVyKCAnY2xpY2snLCBmdW5jdGlvbigpIHsKCgkJCQkJcG9zdHByb2Nlc3NpbmcuZW5hYmxlZCA9ICFwb3N0cHJvY2Vzc2luZy5lbmFibGVkOwoJCQkJCXVwZGF0ZVBlcm1hbGluaygpOwoKCQkJCX0sIGZhbHNlICk7CgoKCQkJCS8vIFBPU1RQUk9DRVNTSU5HCgoJCQkJcmVuZGVyZXIuYXV0b0NsZWFyID0gZmFsc2U7CgoJCQkJdmFyIHJlbmRlck1vZGVsID0gbmV3IFRIUkVFLlJlbmRlclBhc3MoIHNjZW5lLCBjYW1lcmEgKTsKCQkJCXZhciBlZmZlY3RCbG9vbSA9IG5ldyBUSFJFRS5CbG9vbVBhc3MoIDAuMjUgKTsKCQkJCXZhciBlZmZlY3RGaWxtID0gbmV3IFRIUkVFLkZpbG1QYXNzKCAwLjUsIDAuMTI1LCAyMDQ4LCBmYWxzZSApOwoKCQkJCWVmZmVjdEZYQUEgPSBuZXcgVEhSRUUuU2hhZGVyUGFzcyggVEhSRUUuRlhBQVNoYWRlciApOwoKCQkJCXZhciB3aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoIHx8IDI7CgkJCQl2YXIgaGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0IHx8IDI7CgoJCQkJZWZmZWN0RlhBQS51bmlmb3Jtc1sgJ3Jlc29sdXRpb24nIF0udmFsdWUuc2V0KCAxIC8gd2lkdGgsIDEgLyBoZWlnaHQgKTsKCgkJCQllZmZlY3RGaWxtLnJlbmRlclRvU2NyZWVuID0gdHJ1ZTsKCgkJCQljb21wb3NlciA9IG5ldyBUSFJFRS5FZmZlY3RDb21wb3NlciggcmVuZGVyZXIgKTsKCgkJCQljb21wb3Nlci5hZGRQYXNzKCByZW5kZXJNb2RlbCApOwoJCQkJY29tcG9zZXIuYWRkUGFzcyggZWZmZWN0RlhBQSApOwoJCQkJY29tcG9zZXIuYWRkUGFzcyggZWZmZWN0Qmxvb20gKTsKCQkJCWNvbXBvc2VyLmFkZFBhc3MoIGVmZmVjdEZpbG0gKTsKCgkJCQkvLwoKCQkJCXdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCAncmVzaXplJywgb25XaW5kb3dSZXNpemUsIGZhbHNlICk7CgoJCQl9CgoJCQlmdW5jdGlvbiBvbldpbmRvd1Jlc2l6ZSgpIHsKCgkJCQl3aW5kb3dIYWxmWCA9IHdpbmRvdy5pbm5lcldpZHRoIC8gMjsKCQkJCXdpbmRvd0hhbGZZID0gd2luZG93LmlubmVySGVpZ2h0IC8gMjsKCgkJCQljYW1lcmEuYXNwZWN0ID0gd2luZG93LmlubmVyV2lkdGggLyB3aW5kb3cuaW5uZXJIZWlnaHQ7CgkJCQljYW1lcmEudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpOwoKCQkJCXJlbmRlcmVyLnNldFNpemUoIHdpbmRvdy5pbm5lcldpZHRoLCB3aW5kb3cuaW5uZXJIZWlnaHQgKTsKCgkJCQljb21wb3Nlci5yZXNldCgpOwoKCQkJCWVmZmVjdEZYQUEudW5pZm9ybXNbICdyZXNvbHV0aW9uJyBdLnZhbHVlLnNldCggMSAvIHdpbmRvdy5pbm5lcldpZHRoLCAxIC8gd2luZG93LmlubmVySGVpZ2h0ICk7CgoJCQl9CgoJCQkvLwoKCQkJZnVuY3Rpb24gYm9vbFRvTnVtKCBiICkgewoKCQkJCXJldHVybiBiID8gMSA6IDA7CgoJCQl9CgoJCQlmdW5jdGlvbiB1cGRhdGVQZXJtYWxpbmsoKSB7CgoJCQkJdmFyIGxpbmsgPSBoZXggKyBmb250TWFwWyBmb250IF0gKyB3ZWlnaHRNYXBbIHdlaWdodCBdICsgYm9vbFRvTnVtKCBwb3N0cHJvY2Vzc2luZy5lbmFibGVkICkgKyBib29sVG9OdW0oIGJldmVsRW5hYmxlZCApICsgIiMiICsgZW5jb2RlVVJJKCB0ZXh0ICk7CgoJCQkJcGVybWFsaW5rLmhyZWYgPSAiIyIgKyBsaW5rOwoJCQkJd2luZG93LmxvY2F0aW9uLmhhc2ggPSBsaW5rOwoKCQkJfQoKCQkJZnVuY3Rpb24gb25Eb2N1bWVudEtleURvd24oIGV2ZW50ICkgewoKCQkJCWlmICggZmlyc3RMZXR0ZXIgKSB7CgoJCQkJCWZpcnN0TGV0dGVyID0gZmFsc2U7CgkJCQkJdGV4dCA9ICIiOwoKCQkJCX0KCgkJCQl2YXIga2V5Q29kZSA9IGV2ZW50LmtleUNvZGU7CgoJCQkJLy8gYmFja3NwYWNlCgoJCQkJaWYgKCBrZXlDb2RlID09IDggKSB7CgoJCQkJCWV2ZW50LnByZXZlbnREZWZhdWx0KCk7CgoJCQkJCXRleHQgPSB0ZXh0LnN1YnN0cmluZyggMCwgdGV4dC5sZW5ndGggLSAxICk7CgkJCQkJcmVmcmVzaFRleHQoKTsKCgkJCQkJcmV0dXJuIGZhbHNlOwoKCQkJCX0KCgkJCX0KCgkJCWZ1bmN0aW9uIG9uRG9jdW1lbnRLZXlQcmVzcyggZXZlbnQgKSB7CgoJCQkJdmFyIGtleUNvZGUgPSBldmVudC53aGljaDsKCgkJCQkvLyBiYWNrc3BhY2UKCgkJCQlpZiAoIGtleUNvZGUgPT0gOCApIHsKCgkJCQkJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCgkJCQl9IGVsc2UgewoKCQkJCQl2YXIgY2ggPSBTdHJpbmcuZnJvbUNoYXJDb2RlKCBrZXlDb2RlICk7CgkJCQkJdGV4dCArPSBjaDsKCgkJCQkJcmVmcmVzaFRleHQoKTsKCgkJCQl9CgoJCQl9CgoJCQlmdW5jdGlvbiBjcmVhdGVUZXh0KCkgewoKCQkJCXRleHRHZW8gPSBuZXcgVEhSRUUuVGV4dEdlb21ldHJ5KCB0ZXh0LCB7CgoJCQkJCXNpemU6IHNpemUsCgkJCQkJaGVpZ2h0OiBoZWlnaHQsCgkJCQkJY3VydmVTZWdtZW50czogY3VydmVTZWdtZW50cywKCgkJCQkJZm9udDogZm9udCwKCQkJCQl3ZWlnaHQ6IHdlaWdodCwKCQkJCQlzdHlsZTogc3R5bGUsCgoJCQkJCWJldmVsVGhpY2tuZXNzOiBiZXZlbFRoaWNrbmVzcywKCQkJCQliZXZlbFNpemU6IGJldmVsU2l6ZSwKCQkJCQliZXZlbEVuYWJsZWQ6IGJldmVsRW5hYmxlZCwKCgkJCQkJbWF0ZXJpYWw6IDAsCgkJCQkJZXh0cnVkZU1hdGVyaWFsOiAxCgoJCQkJfSk7CgoJCQkJdGV4dEdlby5jb21wdXRlQm91bmRpbmdCb3goKTsKCQkJCXRleHRHZW8uY29tcHV0ZVZlcnRleE5vcm1hbHMoKTsKCgkJCQkvLyAiZml4IiBzaWRlIG5vcm1hbHMgYnkgcmVtb3Zpbmcgei1jb21wb25lbnQgb2Ygbm9ybWFscyBmb3Igc2lkZSBmYWNlcwoJCQkJLy8gKHRoaXMgZG9lc24ndCB3b3JrIHdlbGwgZm9yIGJldmVsZWQgZ2VvbWV0cnkgYXMgdGhlbiB3ZSBsb3NlIG5pY2UgY3VydmF0dXJlIGFyb3VuZCB6LWF4aXMpCgoJCQkJaWYgKCAhIGJldmVsRW5hYmxlZCApIHsKCgkJCQkJdmFyIHRyaWFuZ2xlQXJlYUhldXJpc3RpY3MgPSAwLjEgKiAoIGhlaWdodCAqIHNpemUgKTsKCgkJCQkJZm9yICggdmFyIGkgPSAwOyBpIDwgdGV4dEdlby5mYWNlcy5sZW5ndGg7IGkgKysgKSB7CgoJCQkJCQl2YXIgZmFjZSA9IHRleHRHZW8uZmFjZXNbIGkgXTsKCgkJCQkJCWlmICggZmFjZS5tYXRlcmlhbEluZGV4ID09IDEgKSB7CgoJCQkJCQkJZm9yICggdmFyIGogPSAwOyBqIDwgZmFjZS52ZXJ0ZXhOb3JtYWxzLmxlbmd0aDsgaiArKyApIHsKCgkJCQkJCQkJZmFjZS52ZXJ0ZXhOb3JtYWxzWyBqIF0ueiA9IDA7CgkJCQkJCQkJZmFjZS52ZXJ0ZXhOb3JtYWxzWyBqIF0ubm9ybWFsaXplKCk7CgoJCQkJCQkJfQoKCQkJCQkJCXZhciB2YSA9IHRleHRHZW8udmVydGljZXNbIGZhY2UuYSBdOwoJCQkJCQkJdmFyIHZiID0gdGV4dEdlby52ZXJ0aWNlc1sgZmFjZS5iIF07CgkJCQkJCQl2YXIgdmMgPSB0ZXh0R2VvLnZlcnRpY2VzWyBmYWNlLmMgXTsKCgkJCQkJCQl2YXIgcyA9IFRIUkVFLkdlb21ldHJ5VXRpbHMudHJpYW5nbGVBcmVhKCB2YSwgdmIsIHZjICk7CgoJCQkJCQkJaWYgKCBzID4gdHJpYW5nbGVBcmVhSGV1cmlzdGljcyApIHsKCgkJCQkJCQkJZm9yICggdmFyIGogPSAwOyBqIDwgZmFjZS52ZXJ0ZXhOb3JtYWxzLmxlbmd0aDsgaiArKyApIHsKCgkJCQkJCQkJCWZhY2UudmVydGV4Tm9ybWFsc1sgaiBdLmNvcHkoIGZhY2Uubm9ybWFsICk7CgoJCQkJCQkJCX0KCgkJCQkJCQl9CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQl9CgoJCQkJdmFyIGNlbnRlck9mZnNldCA9IC0wLjUgKiAoIHRleHRHZW8uYm91bmRpbmdCb3gubWF4LnggLSB0ZXh0R2VvLmJvdW5kaW5nQm94Lm1pbi54ICk7CgoJCQkJdGV4dE1lc2gxID0gbmV3IFRIUkVFLk1lc2goIHRleHRHZW8sIG1hdGVyaWFsICk7CgoJCQkJdGV4dE1lc2gxLnBvc2l0aW9uLnggPSBjZW50ZXJPZmZzZXQ7CgkJCQl0ZXh0TWVzaDEucG9zaXRpb24ueSA9IGhvdmVyOwoJCQkJdGV4dE1lc2gxLnBvc2l0aW9uLnogPSAwOwoKCQkJCXRleHRNZXNoMS5yb3RhdGlvbi54ID0gMDsKCQkJCXRleHRNZXNoMS5yb3RhdGlvbi55ID0gTWF0aC5QSSAqIDI7CgoJCQkJZ3JvdXAuYWRkKCB0ZXh0TWVzaDEgKTsKCgkJCQlpZiAoIG1pcnJvciApIHsKCgkJCQkJdGV4dE1lc2gyID0gbmV3IFRIUkVFLk1lc2goIHRleHRHZW8sIG1hdGVyaWFsICk7CgoJCQkJCXRleHRNZXNoMi5wb3NpdGlvbi54ID0gY2VudGVyT2Zmc2V0OwoJCQkJCXRleHRNZXNoMi5wb3NpdGlvbi55ID0gLWhvdmVyOwoJCQkJCXRleHRNZXNoMi5wb3NpdGlvbi56ID0gaGVpZ2h0OwoKCQkJCQl0ZXh0TWVzaDIucm90YXRpb24ueCA9IE1hdGguUEk7CgkJCQkJdGV4dE1lc2gyLnJvdGF0aW9uLnkgPSBNYXRoLlBJICogMjsKCgkJCQkJZ3JvdXAuYWRkKCB0ZXh0TWVzaDIgKTsKCgkJCQl9CgoJCQl9CgoJCQlmdW5jdGlvbiByZWZyZXNoVGV4dCgpIHsKCgkJCQl1cGRhdGVQZXJtYWxpbmsoKTsKCgkJCQlncm91cC5yZW1vdmUoIHRleHRNZXNoMSApOwoJCQkJaWYgKCBtaXJyb3IgKSBncm91cC5yZW1vdmUoIHRleHRNZXNoMiApOwoKCQkJCWlmICggIXRleHQgKSByZXR1cm47CgoJCQkJY3JlYXRlVGV4dCgpOwoKCQkJfQoKCQkJZnVuY3Rpb24gb25Eb2N1bWVudE1vdXNlRG93biggZXZlbnQgKSB7CgoJCQkJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCgkJCQlkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCAnbW91c2Vtb3ZlJywgb25Eb2N1bWVudE1vdXNlTW92ZSwgZmFsc2UgKTsKCQkJCWRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoICdtb3VzZXVwJywgb25Eb2N1bWVudE1vdXNlVXAsIGZhbHNlICk7CgkJCQlkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCAnbW91c2VvdXQnLCBvbkRvY3VtZW50TW91c2VPdXQsIGZhbHNlICk7CgoJCQkJbW91c2VYT25Nb3VzZURvd24gPSBldmVudC5jbGllbnRYIC0gd2luZG93SGFsZlg7CgkJCQl0YXJnZXRSb3RhdGlvbk9uTW91c2VEb3duID0gdGFyZ2V0Um90YXRpb247CgoJCQl9CgoJCQlmdW5jdGlvbiBvbkRvY3VtZW50TW91c2VNb3ZlKCBldmVudCApIHsKCgkJCQltb3VzZVggPSBldmVudC5jbGllbnRYIC0gd2luZG93SGFsZlg7CgoJCQkJdGFyZ2V0Um90YXRpb24gPSB0YXJnZXRSb3RhdGlvbk9uTW91c2VEb3duICsgKCBtb3VzZVggLSBtb3VzZVhPbk1vdXNlRG93biApICogMC4wMjsKCgkJCX0KCgkJCWZ1bmN0aW9uIG9uRG9jdW1lbnRNb3VzZVVwKCBldmVudCApIHsKCgkJCQlkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCAnbW91c2Vtb3ZlJywgb25Eb2N1bWVudE1vdXNlTW92ZSwgZmFsc2UgKTsKCQkJCWRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoICdtb3VzZXVwJywgb25Eb2N1bWVudE1vdXNlVXAsIGZhbHNlICk7CgkJCQlkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCAnbW91c2VvdXQnLCBvbkRvY3VtZW50TW91c2VPdXQsIGZhbHNlICk7CgoJCQl9CgoJCQlmdW5jdGlvbiBvbkRvY3VtZW50TW91c2VPdXQoIGV2ZW50ICkgewoKCQkJCWRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoICdtb3VzZW1vdmUnLCBvbkRvY3VtZW50TW91c2VNb3ZlLCBmYWxzZSApOwoJCQkJZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ21vdXNldXAnLCBvbkRvY3VtZW50TW91c2VVcCwgZmFsc2UgKTsKCQkJCWRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoICdtb3VzZW91dCcsIG9uRG9jdW1lbnRNb3VzZU91dCwgZmFsc2UgKTsKCgkJCX0KCgkJCWZ1bmN0aW9uIG9uRG9jdW1lbnRUb3VjaFN0YXJ0KCBldmVudCApIHsKCgkJCQlpZiAoIGV2ZW50LnRvdWNoZXMubGVuZ3RoID09IDEgKSB7CgoJCQkJCWV2ZW50LnByZXZlbnREZWZhdWx0KCk7CgoJCQkJCW1vdXNlWE9uTW91c2VEb3duID0gZXZlbnQudG91Y2hlc1sgMCBdLnBhZ2VYIC0gd2luZG93SGFsZlg7CgkJCQkJdGFyZ2V0Um90YXRpb25Pbk1vdXNlRG93biA9IHRhcmdldFJvdGF0aW9uOwoKCQkJCX0KCgkJCX0KCgkJCWZ1bmN0aW9uIG9uRG9jdW1lbnRUb3VjaE1vdmUoIGV2ZW50ICkgewoKCQkJCWlmICggZXZlbnQudG91Y2hlcy5sZW5ndGggPT0gMSApIHsKCgkJCQkJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCgkJCQkJbW91c2VYID0gZXZlbnQudG91Y2hlc1sgMCBdLnBhZ2VYIC0gd2luZG93SGFsZlg7CgkJCQkJdGFyZ2V0Um90YXRpb24gPSB0YXJnZXRSb3RhdGlvbk9uTW91c2VEb3duICsgKCBtb3VzZVggLSBtb3VzZVhPbk1vdXNlRG93biApICogMC4wNTsKCgkJCQl9CgoJCQl9CgoJCQkvLwoKCQkJZnVuY3Rpb24gYW5pbWF0ZSgpIHsKCgkJCQlyZXF1ZXN0QW5pbWF0aW9uRnJhbWUoIGFuaW1hdGUgKTsKCgkJCQlyZW5kZXIoKTsKCQkJCXN0YXRzLnVwZGF0ZSgpOwoKCQkJfQoKCQkJZnVuY3Rpb24gcmVuZGVyKCkgewoKCQkJCWdyb3VwLnJvdGF0aW9uLnkgKz0gKCB0YXJnZXRSb3RhdGlvbiAtIGdyb3VwLnJvdGF0aW9uLnkgKSAqIDAuMDU7CgoJCQkJY2FtZXJhLmxvb2tBdCggY2FtZXJhVGFyZ2V0ICk7CgoJCQkJcmVuZGVyZXIuY2xlYXIoKTsKCgkJCQlpZiAoIHBvc3Rwcm9jZXNzaW5nLmVuYWJsZWQgKSB7CgoJCQkJCWNvbXBvc2VyLnJlbmRlciggMC4wNSApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCXJlbmRlcmVyLnJlbmRlciggc2NlbmUsIGNhbWVyYSApOwoKCQkJCX0KCgkJCX0KCgkJPC9zY3JpcHQ+CgoJPC9ib2R5Pgo8L2h0bWw+Cg==",
                "body": "PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KCTxoZWFkPgoJCTx0aXRsZT50aHJlZS5qcyB3ZWJnbCAtIGdlb21ldHJ5IC0gdGV4dDwvdGl0bGU+CgkJPG1ldGEgY2hhcnNldD0idXRmLTgiPgoJCTxtZXRhIG5hbWU9InZpZXdwb3J0IiBjb250ZW50PSJ3aWR0aD1kZXZpY2Utd2lkdGgsIHVzZXItc2NhbGFibGU9bm8sIG1pbmltdW0tc2NhbGU9MS4wLCBtYXhpbXVtLXNjYWxlPTEuMCI+CgkJPHN0eWxlPgoJCQlib2R5IHsKCQkJCWZvbnQtZmFtaWx5OiBNb25vc3BhY2U7CgkJCQliYWNrZ3JvdW5kLWNvbG9yOiAjMDAwOwoJCQkJY29sb3I6ICNmZmY7CgkJCQltYXJnaW46IDBweDsKCQkJCW92ZXJmbG93OiBoaWRkZW47CgkJCX0KCQkJI2luZm8gewoJCQkJcG9zaXRpb246IGFic29sdXRlOwoJCQkJdG9wOiAxMHB4OwoJCQkJd2lkdGg6IDEwMCU7CgkJCQl0ZXh0LWFsaWduOiBjZW50ZXI7CgkJCQl6LWluZGV4OiAxMDA7CgkJCQlkaXNwbGF5OmJsb2NrOwoJCQl9CgkJCSNpbmZvIGEsIC5idXR0b24geyBjb2xvcjogI2YwMDsgZm9udC13ZWlnaHQ6IGJvbGQ7IHRleHQtZGVjb3JhdGlvbjogdW5kZXJsaW5lOyBjdXJzb3I6IHBvaW50ZXIgfQoJCTwvc3R5bGU+Cgk8L2hlYWQ+Cgk8Ym9keT4KCgkJPGRpdiBpZD0iaW5mbyI+CgkJPGEgaHJlZj0iaHR0cDovL3RocmVlanMub3JnIiB0YXJnZXQ9Il9ibGFuayI+dGhyZWUuanM8L2E+IC0gcHJvY2VkdXJhbCAzRCB0ZXh0IGJ5IDxhIGhyZWY9Imh0dHA6Ly93d3cubGFiNGdhbWVzLm5ldC96ejg1L2Jsb2ciIHRhcmdldD0iX2JsYW5rIj56ejg1PC9hPiAmYW1wOyBhbHRlcmVkcQoJCShmb250cyBmcm9tIDxhIGhyZWY9Imh0dHA6Ly90eXBlZmFjZS5uZW9jcmFjeS5vcmcvIj50eXBlZmFjZS5qczwvYT4gYW5kIDxhIGhyZWY9Imh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvRHJvaWRfJTI4Zm9udCUyOSI+RHJvaWQ8L2E+KQoJCTxici8+YnVpbHQtaW4gc2hhcGUgdHJpYW5ndWxhdGlvbiBoYXMgYmVlbiByZXBsYWNlZCB3aXRoIDxhIGhyZWY9Imh0dHBzOi8vZ2l0aHViLmNvbS9qYWh0aW5nL3BubHRyaS5qcyI+UG5sVHJpLmpzPC9hPiBieSA8YSBocmVmPSJodHRwczovL2dpdGh1Yi5jb20vamFodGluZyIgdGFyZ2V0PSJfYmxhbmsiPmogYWh0aW5nPC9hPgoJCTxici8+dHlwZSB0byBlbnRlciBuZXcgdGV4dCwgZHJhZyB0byBzcGluIHRoZSB0ZXh0CgkJPGJyLz48c3BhbiBjbGFzcz0iYnV0dG9uIiBpZD0iY29sb3IiPmNoYW5nZSBjb2xvcjwvc3Bhbj4sCgkJCTxzcGFuIGNsYXNzPSJidXR0b24iIGlkPSJmb250Ij5jaGFuZ2UgZm9udDwvc3Bhbj4sCgkJCTxzcGFuIGNsYXNzPSJidXR0b24iIGlkPSJ3ZWlnaHQiPmNoYW5nZSB3ZWlnaHQ8L3NwYW4+LAoJCQk8c3BhbiBjbGFzcz0iYnV0dG9uIiBpZD0iYmV2ZWwiPmNoYW5nZSBiZXZlbDwvc3Bhbj4sCgkJCTxzcGFuIGNsYXNzPSJidXR0b24iIGlkPSJwb3N0cHJvY2Vzc2luZyI+Y2hhbmdlIHBvc3Rwcm9jZXNzaW5nPC9zcGFuPiwKCQkJPGEgaWQ9InBlcm1hbGluayIgaHJlZj0iIyI+cGVybWFsaW5rPC9hPgoJCTwvZGl2PgoKCgkJPHNjcmlwdCBzcmM9Ii4uL2J1aWxkL3RocmVlLm1pbi5qcyI+PC9zY3JpcHQ+CgkJPHNjcmlwdCBzcmM9ImpzL3V0aWxzL0dlb21ldHJ5VXRpbHMuanMiPjwvc2NyaXB0PgoKCQk8c2NyaXB0IHNyYz0ianMvc2hhZGVycy9Db252b2x1dGlvblNoYWRlci5qcyI+PC9zY3JpcHQ+CgkJPHNjcmlwdCBzcmM9ImpzL3NoYWRlcnMvQ29weVNoYWRlci5qcyI+PC9zY3JpcHQ+CgkJPHNjcmlwdCBzcmM9ImpzL3NoYWRlcnMvRmlsbVNoYWRlci5qcyI+PC9zY3JpcHQ+CgkJPHNjcmlwdCBzcmM9ImpzL3NoYWRlcnMvRlhBQVNoYWRlci5qcyI+PC9zY3JpcHQ+CgoJCTxzY3JpcHQgc3JjPSJqcy9wb3N0cHJvY2Vzc2luZy9FZmZlY3RDb21wb3Nlci5qcyI+PC9zY3JpcHQ+CgkJPHNjcmlwdCBzcmM9ImpzL3Bvc3Rwcm9jZXNzaW5nL1JlbmRlclBhc3MuanMiPjwvc2NyaXB0PgoJCTxzY3JpcHQgc3JjPSJqcy9wb3N0cHJvY2Vzc2luZy9TaGFkZXJQYXNzLmpzIj48L3NjcmlwdD4KCQk8c2NyaXB0IHNyYz0ianMvcG9zdHByb2Nlc3NpbmcvTWFza1Bhc3MuanMiPjwvc2NyaXB0PgoJCTxzY3JpcHQgc3JjPSJqcy9wb3N0cHJvY2Vzc2luZy9CbG9vbVBhc3MuanMiPjwvc2NyaXB0PgoJCTxzY3JpcHQgc3JjPSJqcy9wb3N0cHJvY2Vzc2luZy9GaWxtUGFzcy5qcyI+PC9zY3JpcHQ+CgoJCTxzY3JpcHQgc3JjPSJqcy9EZXRlY3Rvci5qcyI+PC9zY3JpcHQ+CgkJPHNjcmlwdCBzcmM9ImpzL2xpYnMvc3RhdHMubWluLmpzIj48L3NjcmlwdD4KCgkJPCEtLSBsb2FkIHRoZSBmb250IGZpbGVzIC0tPgoKCQk8c2NyaXB0IHNyYz0iZm9udHMvZ2VudGlsaXNfYm9sZC50eXBlZmFjZS5qcyI+PC9zY3JpcHQ+CgkJPHNjcmlwdCBzcmM9ImZvbnRzL2dlbnRpbGlzX3JlZ3VsYXIudHlwZWZhY2UuanMiPjwvc2NyaXB0PgoJCTxzY3JpcHQgc3JjPSJmb250cy9vcHRpbWVyX2JvbGQudHlwZWZhY2UuanMiPjwvc2NyaXB0PgoJCTxzY3JpcHQgc3JjPSJmb250cy9vcHRpbWVyX3JlZ3VsYXIudHlwZWZhY2UuanMiPjwvc2NyaXB0PgoJCTxzY3JpcHQgc3JjPSJmb250cy9oZWx2ZXRpa2VyX2JvbGQudHlwZWZhY2UuanMiPjwvc2NyaXB0PgoJCTxzY3JpcHQgc3JjPSJmb250cy9oZWx2ZXRpa2VyX3JlZ3VsYXIudHlwZWZhY2UuanMiPjwvc2NyaXB0PgoJCTxzY3JpcHQgc3JjPSJmb250cy9kcm9pZC9kcm9pZF9zYW5zX3JlZ3VsYXIudHlwZWZhY2UuanMiPjwvc2NyaXB0PgoJCTxzY3JpcHQgc3JjPSJmb250cy9kcm9pZC9kcm9pZF9zYW5zX2JvbGQudHlwZWZhY2UuanMiPjwvc2NyaXB0PgoJCTxzY3JpcHQgc3JjPSJmb250cy9kcm9pZC9kcm9pZF9zZXJpZl9yZWd1bGFyLnR5cGVmYWNlLmpzIj48L3NjcmlwdD4KCQk8c2NyaXB0IHNyYz0iZm9udHMvZHJvaWQvZHJvaWRfc2VyaWZfYm9sZC50eXBlZmFjZS5qcyI+PC9zY3JpcHQ+CgoJCTwhLS0gdG9kbyBhc3luYyBsb2FkZXIgZm9yIGZvbnRzIC0tPgoKCgkJPCEtLSByZXBsYWNlIGJ1aWx0LWluIHRyaWFuZ3VsYXRpb24gd2l0aCBQbmxUcmkuanMgLS0+CgkJPHNjcmlwdCBzcmM9ImpzL2xpYnMvcG5sdHJpLm1pbi5qcyI+PC9zY3JpcHQ+CgkJPHNjcmlwdD4KCQkJVEhSRUUuU2hhcGUuVXRpbHMudHJpYW5ndWxhdGVTaGFwZSA9ICggZnVuY3Rpb24gKCkgewoJCQkJdmFyIHBubFRyaWFuZ3VsYXRvciA9IG5ldyBQTkxUUkkuVHJpYW5ndWxhdG9yKCk7CgkJCQlyZXR1cm4gZnVuY3Rpb24gKCBjb250b3VyLCBob2xlcyApIHsKCQkJCQkvLyBjb25zb2xlLmxvZygibmV3IFRyaWFuZ3VsYXRpb246IFBubFRyaS5qcyAiICsgUE5MVFJJLlJFVklTSU9OICk7CgkJCQkJcmV0dXJuIHBubFRyaWFuZ3VsYXRvci50cmlhbmd1bGF0ZV9wb2x5Z29uKCBbIGNvbnRvdXIgXS5jb25jYXQoaG9sZXMpICk7CgkJCQl9OwoJCQl9ICkoKTsKCQk8L3NjcmlwdD4KCQkKCgkJPHNjcmlwdD4KCgkJCWlmICggISBEZXRlY3Rvci53ZWJnbCApIERldGVjdG9yLmFkZEdldFdlYkdMTWVzc2FnZSgpOwoKCQkJdmFyIGNvbnRhaW5lciwgc3RhdHMsIHBlcm1hbGluaywgaGV4LCBjb2xvcjsKCgkJCXZhciBjYW1lcmEsIGNhbWVyYVRhcmdldCwgc2NlbmUsIHJlbmRlcmVyOwoKCQkJdmFyIGNvbXBvc2VyOwoJCQl2YXIgZWZmZWN0RlhBQTsKCgkJCXZhciBncm91cCwgdGV4dE1lc2gxLCB0ZXh0TWVzaDIsIHRleHRHZW8sIG1hdGVyaWFsOwoKCQkJdmFyIGZpcnN0TGV0dGVyID0gdHJ1ZTsKCgkJCXZhciB0ZXh0ID0gInRocmVlLmpzIiwKCgkJCQloZWlnaHQgPSAyMCwKCQkJCXNpemUgPSA3MCwKCQkJCWhvdmVyID0gMzAsCgoJCQkJY3VydmVTZWdtZW50cyA9IDQsCgoJCQkJYmV2ZWxUaGlja25lc3MgPSAyLAoJCQkJYmV2ZWxTaXplID0gMS41LAoJCQkJYmV2ZWxTZWdtZW50cyA9IDMsCgkJCQliZXZlbEVuYWJsZWQgPSB0cnVlLAoKCQkJCWZvbnQgPSAib3B0aW1lciIsIC8vIGhlbHZldGlrZXIsIG9wdGltZXIsIGdlbnRpbGlzLCBkcm9pZCBzYW5zLCBkcm9pZCBzZXJpZgoJCQkJd2VpZ2h0ID0gImJvbGQiLCAvLyBub3JtYWwgYm9sZAoJCQkJc3R5bGUgPSAibm9ybWFsIjsgLy8gbm9ybWFsIGl0YWxpYwoKCQkJdmFyIG1pcnJvciA9IHRydWU7CgoJCQl2YXIgZm9udE1hcCA9IHsKCgkJCQkiaGVsdmV0aWtlciI6IDAsCgkJCQkib3B0aW1lciI6IDEsCgkJCQkiZ2VudGlsaXMiOiAyLAoJCQkJImRyb2lkIHNhbnMiOiAzLAoJCQkJImRyb2lkIHNlcmlmIjogNAoKCQkJfTsKCgkJCXZhciB3ZWlnaHRNYXAgPSB7CgoJCQkJIm5vcm1hbCI6IDAsCgkJCQkiYm9sZCI6IDEKCgkJCX07CgoJCQl2YXIgcmV2ZXJzZUZvbnRNYXAgPSB7fTsKCQkJdmFyIHJldmVyc2VXZWlnaHRNYXAgPSB7fTsKCgkJCWZvciAoIHZhciBpIGluIGZvbnRNYXAgKSByZXZlcnNlRm9udE1hcFsgZm9udE1hcFtpXSBdID0gaTsKCQkJZm9yICggdmFyIGkgaW4gd2VpZ2h0TWFwICkgcmV2ZXJzZVdlaWdodE1hcFsgd2VpZ2h0TWFwW2ldIF0gPSBpOwoKCQkJdmFyIHRhcmdldFJvdGF0aW9uID0gMDsKCQkJdmFyIHRhcmdldFJvdGF0aW9uT25Nb3VzZURvd24gPSAwOwoKCQkJdmFyIG1vdXNlWCA9IDA7CgkJCXZhciBtb3VzZVhPbk1vdXNlRG93biA9IDA7CgoJCQl2YXIgd2luZG93SGFsZlggPSB3aW5kb3cuaW5uZXJXaWR0aCAvIDI7CgkJCXZhciB3aW5kb3dIYWxmWSA9IHdpbmRvdy5pbm5lckhlaWdodCAvIDI7CgoJCQl2YXIgcG9zdHByb2Nlc3NpbmcgPSB7IGVuYWJsZWQgOiBmYWxzZSB9OwoJCQl2YXIgZ2xvdyA9IDAuOTsKCgkJCWluaXQoKTsKCQkJYW5pbWF0ZSgpOwoKCQkJZnVuY3Rpb24gY2FwaXRhbGl6ZSggdHh0ICkgewoKCQkJCXJldHVybiB0eHQuc3Vic3RyaW5nKCAwLCAxICkudG9VcHBlckNhc2UoKSArIHR4dC5zdWJzdHJpbmcoIDEgKTsKCgkJCX0KCgkJCWZ1bmN0aW9uIGRlY2ltYWxUb0hleCggZCApIHsKCgkJCQl2YXIgaGV4ID0gTnVtYmVyKCBkICkudG9TdHJpbmcoIDE2ICk7CgkJCQloZXggPSAiMDAwMDAwIi5zdWJzdHIoIDAsIDYgLSBoZXgubGVuZ3RoICkgKyBoZXg7CgkJCQlyZXR1cm4gaGV4LnRvVXBwZXJDYXNlKCk7CgoJCQl9CgoJCQlmdW5jdGlvbiBpbml0KCkgewoKCQkJCWNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdkaXYnICk7CgkJCQlkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKCBjb250YWluZXIgKTsKCgkJCQlwZXJtYWxpbmsgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCggInBlcm1hbGluayIgKTsKCgkJCQkvLyBDQU1FUkEKCgkJCQljYW1lcmEgPSBuZXcgVEhSRUUuUGVyc3BlY3RpdmVDYW1lcmEoIDMwLCB3aW5kb3cuaW5uZXJXaWR0aCAvIHdpbmRvdy5pbm5lckhlaWdodCwgMSwgMTUwMCApOwoJCQkJY2FtZXJhLnBvc2l0aW9uLnNldCggMCwgNDAwLCA3MDAgKTsKCgkJCQljYW1lcmFUYXJnZXQgPSBuZXcgVEhSRUUuVmVjdG9yMyggMCwgMTUwLCAwICk7CgoJCQkJLy8gU0NFTkUKCgkJCQlzY2VuZSA9IG5ldyBUSFJFRS5TY2VuZSgpOwoJCQkJc2NlbmUuZm9nID0gbmV3IFRIUkVFLkZvZyggMHgwMDAwMDAsIDI1MCwgMTQwMCApOwoKCQkJCS8vIExJR0hUUwoKCQkJCXZhciBkaXJMaWdodCA9IG5ldyBUSFJFRS5EaXJlY3Rpb25hbExpZ2h0KCAweGZmZmZmZiwgMC4xMjUgKTsKCQkJCWRpckxpZ2h0LnBvc2l0aW9uLnNldCggMCwgMCwgMSApLm5vcm1hbGl6ZSgpOwoJCQkJc2NlbmUuYWRkKCBkaXJMaWdodCApOwoKCQkJCXZhciBwb2ludExpZ2h0ID0gbmV3IFRIUkVFLlBvaW50TGlnaHQoIDB4ZmZmZmZmLCAxLjUgKTsKCQkJCXBvaW50TGlnaHQucG9zaXRpb24uc2V0KCAwLCAxMDAsIDkwICk7CgkJCQlzY2VuZS5hZGQoIHBvaW50TGlnaHQgKTsKCgkJCQkvL3RleHQgPSBjYXBpdGFsaXplKCBmb250ICkgKyAiICIgKyBjYXBpdGFsaXplKCB3ZWlnaHQgKTsKCQkJCS8vdGV4dCA9ICJhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkiOwoJCQkJLy90ZXh0ID0gIkFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaMDEyMzQ1Njc4OSI7CgoJCQkJLy8gR2V0IHRleHQgZnJvbSBoYXNoCgoJCQkJdmFyIGhhc2ggPSBkb2N1bWVudC5sb2NhdGlvbi5oYXNoLnN1YnN0ciggMSApOwoKCQkJCWlmICggaGFzaC5sZW5ndGggIT09IDAgKSB7CgoJCQkJCXZhciBjb2xvcmhhc2ggID0gaGFzaC5zdWJzdHJpbmcoIDAsIDYgKTsKCQkJCQl2YXIgZm9udGhhc2ggICA9IGhhc2guc3Vic3RyaW5nKCA2LCA3ICk7CgkJCQkJdmFyIHdlaWdodGhhc2ggPSBoYXNoLnN1YnN0cmluZyggNywgOCApOwoJCQkJCXZhciBwcGhhc2ggCSAgID0gaGFzaC5zdWJzdHJpbmcoIDgsIDkgKTsKCQkJCQl2YXIgYmV2ZWxoYXNoICA9IGhhc2guc3Vic3RyaW5nKCA5LCAxMCApOwoJCQkJCXZhciB0ZXh0aGFzaCAgID0gaGFzaC5zdWJzdHJpbmcoIDEwICk7CgoJCQkJCWhleCA9IGNvbG9yaGFzaDsKCQkJCQlwb2ludExpZ2h0LmNvbG9yLnNldEhleCggcGFyc2VJbnQoIGNvbG9yaGFzaCwgMTYgKSApOwoKCQkJCQlmb250ID0gcmV2ZXJzZUZvbnRNYXBbIHBhcnNlSW50KCBmb250aGFzaCApIF07CgkJCQkJd2VpZ2h0ID0gcmV2ZXJzZVdlaWdodE1hcFsgcGFyc2VJbnQoIHdlaWdodGhhc2ggKSBdOwoKCQkJCQlwb3N0cHJvY2Vzc2luZy5lbmFibGVkID0gcGFyc2VJbnQoIHBwaGFzaCApOwoJCQkJCWJldmVsRW5hYmxlZCA9IHBhcnNlSW50KCBiZXZlbGhhc2ggKTsKCgkJCQkJdGV4dCA9IGRlY29kZVVSSSggdGV4dGhhc2ggKTsKCgkJCQkJdXBkYXRlUGVybWFsaW5rKCk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJcG9pbnRMaWdodC5jb2xvci5zZXRIU0woIE1hdGgucmFuZG9tKCksIDEsIDAuNSApOwoJCQkJCWhleCA9IGRlY2ltYWxUb0hleCggcG9pbnRMaWdodC5jb2xvci5nZXRIZXgoKSApOwoKCQkJCX0KCgkJCQltYXRlcmlhbCA9IG5ldyBUSFJFRS5NZXNoRmFjZU1hdGVyaWFsKCBbIAoJCQkJCW5ldyBUSFJFRS5NZXNoUGhvbmdNYXRlcmlhbCggeyBjb2xvcjogMHhmZmZmZmYsIHNoYWRpbmc6IFRIUkVFLkZsYXRTaGFkaW5nIH0gKSwgLy8gZnJvbnQKCQkJCQluZXcgVEhSRUUuTWVzaFBob25nTWF0ZXJpYWwoIHsgY29sb3I6IDB4ZmZmZmZmLCBzaGFkaW5nOiBUSFJFRS5TbW9vdGhTaGFkaW5nIH0gKSAvLyBzaWRlCgkJCQldICk7CgoJCQkJZ3JvdXAgPSBuZXcgVEhSRUUuR3JvdXAoKTsKCQkJCWdyb3VwLnBvc2l0aW9uLnkgPSAxMDA7CgoJCQkJc2NlbmUuYWRkKCBncm91cCApOwoKCQkJCWNyZWF0ZVRleHQoKTsKCgkJCQl2YXIgcGxhbmUgPSBuZXcgVEhSRUUuTWVzaCgKCQkJCQluZXcgVEhSRUUuUGxhbmVCdWZmZXJHZW9tZXRyeSggMTAwMDAsIDEwMDAwICksCgkJCQkJbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKCB7IGNvbG9yOiAweGZmZmZmZiwgb3BhY2l0eTogMC41LCB0cmFuc3BhcmVudDogdHJ1ZSB9ICkKCQkJCSk7CgkJCQlwbGFuZS5wb3NpdGlvbi55ID0gMTAwOwoJCQkJcGxhbmUucm90YXRpb24ueCA9IC0gTWF0aC5QSSAvIDI7CgkJCQlzY2VuZS5hZGQoIHBsYW5lICk7CgoJCQkJLy8gUkVOREVSRVIKCgkJCQlyZW5kZXJlciA9IG5ldyBUSFJFRS5XZWJHTFJlbmRlcmVyKCB7IGFudGlhbGlhczogdHJ1ZSB9ICk7CgkJCQlyZW5kZXJlci5zZXRTaXplKCB3aW5kb3cuaW5uZXJXaWR0aCwgd2luZG93LmlubmVySGVpZ2h0ICk7CgoJCQkJcmVuZGVyZXIuc2V0Q2xlYXJDb2xvciggc2NlbmUuZm9nLmNvbG9yLCAxICk7CgoJCQkJY29udGFpbmVyLmFwcGVuZENoaWxkKCByZW5kZXJlci5kb21FbGVtZW50ICk7CgoJCQkJLy8gU1RBVFMKCgkJCQlzdGF0cyA9IG5ldyBTdGF0cygpOwoJCQkJc3RhdHMuZG9tRWxlbWVudC5zdHlsZS5wb3NpdGlvbiA9ICdhYnNvbHV0ZSc7CgkJCQlzdGF0cy5kb21FbGVtZW50LnN0eWxlLnRvcCA9ICcwcHgnOwoJCQkJLy9jb250YWluZXIuYXBwZW5kQ2hpbGQoIHN0YXRzLmRvbUVsZW1lbnQgKTsKCgkJCQkvLyBFVkVOVFMKCgkJCQlkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCAnbW91c2Vkb3duJywgb25Eb2N1bWVudE1vdXNlRG93biwgZmFsc2UgKTsKCQkJCWRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoICd0b3VjaHN0YXJ0Jywgb25Eb2N1bWVudFRvdWNoU3RhcnQsIGZhbHNlICk7CgkJCQlkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCAndG91Y2htb3ZlJywgb25Eb2N1bWVudFRvdWNoTW92ZSwgZmFsc2UgKTsKCQkJCWRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoICdrZXlwcmVzcycsIG9uRG9jdW1lbnRLZXlQcmVzcywgZmFsc2UgKTsKCQkJCWRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoICdrZXlkb3duJywgb25Eb2N1bWVudEtleURvd24sIGZhbHNlICk7CgoJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoICJjb2xvciIgKS5hZGRFdmVudExpc3RlbmVyKCAnY2xpY2snLCBmdW5jdGlvbigpIHsKCgkJCQkJcG9pbnRMaWdodC5jb2xvci5zZXRIU0woIE1hdGgucmFuZG9tKCksIDEsIDAuNSApOwoJCQkJCWhleCA9IGRlY2ltYWxUb0hleCggcG9pbnRMaWdodC5jb2xvci5nZXRIZXgoKSApOwoKCQkJCQl1cGRhdGVQZXJtYWxpbmsoKTsKCgkJCQl9LCBmYWxzZSApOwoKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCAiZm9udCIgKS5hZGRFdmVudExpc3RlbmVyKCAnY2xpY2snLCBmdW5jdGlvbigpIHsKCgkJCQkJaWYgKCBmb250ID09ICJoZWx2ZXRpa2VyIiApIHsKCgkJCQkJCWZvbnQgPSAib3B0aW1lciI7CgoJCQkJCX0gZWxzZSBpZiAoIGZvbnQgPT0gIm9wdGltZXIiICkgewoKCQkJCQkJZm9udCA9ICJnZW50aWxpcyI7CgoJCQkJCX0gZWxzZSBpZiAoIGZvbnQgPT0gImdlbnRpbGlzIiApIHsKCgkJCQkJCWZvbnQgPSAiZHJvaWQgc2FucyI7CgoJCQkJCX0gZWxzZSBpZiAoIGZvbnQgPT0gImRyb2lkIHNhbnMiICkgewoKCQkJCQkJZm9udCA9ICJkcm9pZCBzZXJpZiI7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQlmb250ID0gImhlbHZldGlrZXIiOwoKCQkJCQl9CgoJCQkJCXJlZnJlc2hUZXh0KCk7CgoJCQkJfSwgZmFsc2UgKTsKCgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCggIndlaWdodCIgKS5hZGRFdmVudExpc3RlbmVyKCAnY2xpY2snLCBmdW5jdGlvbigpIHsKCgkJCQkJaWYgKCB3ZWlnaHQgPT0gImJvbGQiICkgewoKCQkJCQkJd2VpZ2h0ID0gIm5vcm1hbCI7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQl3ZWlnaHQgPSAiYm9sZCI7CgoJCQkJCX0KCgkJCQkJcmVmcmVzaFRleHQoKTsKCgkJCQl9LCBmYWxzZSApOwoKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCAiYmV2ZWwiICkuYWRkRXZlbnRMaXN0ZW5lciggJ2NsaWNrJywgZnVuY3Rpb24oKSB7CgoJCQkJCWJldmVsRW5hYmxlZCA9ICFiZXZlbEVuYWJsZWQ7CgoJCQkJCXJlZnJlc2hUZXh0KCk7CgoJCQkJfSwgZmFsc2UgKTsKCgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCggInBvc3Rwcm9jZXNzaW5nIiApLmFkZEV2ZW50TGlzdGVuZXIoICdjbGljaycsIGZ1bmN0aW9uKCkgewoKCQkJCQlwb3N0cHJvY2Vzc2luZy5lbmFibGVkID0gIXBvc3Rwcm9jZXNzaW5nLmVuYWJsZWQ7CgkJCQkJdXBkYXRlUGVybWFsaW5rKCk7CgoJCQkJfSwgZmFsc2UgKTsKCgoJCQkJLy8gUE9TVFBST0NFU1NJTkcKCgkJCQlyZW5kZXJlci5hdXRvQ2xlYXIgPSBmYWxzZTsKCgkJCQl2YXIgcmVuZGVyTW9kZWwgPSBuZXcgVEhSRUUuUmVuZGVyUGFzcyggc2NlbmUsIGNhbWVyYSApOwoJCQkJdmFyIGVmZmVjdEJsb29tID0gbmV3IFRIUkVFLkJsb29tUGFzcyggMC4yNSApOwoJCQkJdmFyIGVmZmVjdEZpbG0gPSBuZXcgVEhSRUUuRmlsbVBhc3MoIDAuNSwgMC4xMjUsIDIwNDgsIGZhbHNlICk7CgoJCQkJZWZmZWN0RlhBQSA9IG5ldyBUSFJFRS5TaGFkZXJQYXNzKCBUSFJFRS5GWEFBU2hhZGVyICk7CgoJCQkJdmFyIHdpZHRoID0gd2luZG93LmlubmVyV2lkdGggfHwgMjsKCQkJCXZhciBoZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQgfHwgMjsKCgkJCQllZmZlY3RGWEFBLnVuaWZvcm1zWyAncmVzb2x1dGlvbicgXS52YWx1ZS5zZXQoIDEgLyB3aWR0aCwgMSAvIGhlaWdodCApOwoKCQkJCWVmZmVjdEZpbG0ucmVuZGVyVG9TY3JlZW4gPSB0cnVlOwoKCQkJCWNvbXBvc2VyID0gbmV3IFRIUkVFLkVmZmVjdENvbXBvc2VyKCByZW5kZXJlciApOwoKCQkJCWNvbXBvc2VyLmFkZFBhc3MoIHJlbmRlck1vZGVsICk7CgkJCQljb21wb3Nlci5hZGRQYXNzKCBlZmZlY3RGWEFBICk7CgkJCQljb21wb3Nlci5hZGRQYXNzKCBlZmZlY3RCbG9vbSApOwoJCQkJY29tcG9zZXIuYWRkUGFzcyggZWZmZWN0RmlsbSApOwoKCQkJCS8vCgoJCQkJd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoICdyZXNpemUnLCBvbldpbmRvd1Jlc2l6ZSwgZmFsc2UgKTsKCgkJCX0KCgkJCWZ1bmN0aW9uIG9uV2luZG93UmVzaXplKCkgewoKCQkJCXdpbmRvd0hhbGZYID0gd2luZG93LmlubmVyV2lkdGggLyAyOwoJCQkJd2luZG93SGFsZlkgPSB3aW5kb3cuaW5uZXJIZWlnaHQgLyAyOwoKCQkJCWNhbWVyYS5hc3BlY3QgPSB3aW5kb3cuaW5uZXJXaWR0aCAvIHdpbmRvdy5pbm5lckhlaWdodDsKCQkJCWNhbWVyYS51cGRhdGVQcm9qZWN0aW9uTWF0cml4KCk7CgoJCQkJcmVuZGVyZXIuc2V0U2l6ZSggd2luZG93LmlubmVyV2lkdGgsIHdpbmRvdy5pbm5lckhlaWdodCApOwoKCQkJCWNvbXBvc2VyLnJlc2V0KCk7CgoJCQkJZWZmZWN0RlhBQS51bmlmb3Jtc1sgJ3Jlc29sdXRpb24nIF0udmFsdWUuc2V0KCAxIC8gd2luZG93LmlubmVyV2lkdGgsIDEgLyB3aW5kb3cuaW5uZXJIZWlnaHQgKTsKCgkJCX0KCgkJCS8vCgoJCQlmdW5jdGlvbiBib29sVG9OdW0oIGIgKSB7CgoJCQkJcmV0dXJuIGIgPyAxIDogMDsKCgkJCX0KCgkJCWZ1bmN0aW9uIHVwZGF0ZVBlcm1hbGluaygpIHsKCgkJCQl2YXIgbGluayA9IGhleCArIGZvbnRNYXBbIGZvbnQgXSArIHdlaWdodE1hcFsgd2VpZ2h0IF0gKyBib29sVG9OdW0oIHBvc3Rwcm9jZXNzaW5nLmVuYWJsZWQgKSArIGJvb2xUb051bSggYmV2ZWxFbmFibGVkICkgKyAiIyIgKyBlbmNvZGVVUkkoIHRleHQgKTsKCgkJCQlwZXJtYWxpbmsuaHJlZiA9ICIjIiArIGxpbms7CgkJCQl3aW5kb3cubG9jYXRpb24uaGFzaCA9IGxpbms7CgoJCQl9CgoJCQlmdW5jdGlvbiBvbkRvY3VtZW50S2V5RG93biggZXZlbnQgKSB7CgoJCQkJaWYgKCBmaXJzdExldHRlciApIHsKCgkJCQkJZmlyc3RMZXR0ZXIgPSBmYWxzZTsKCQkJCQl0ZXh0ID0gIiI7CgoJCQkJfQoKCQkJCXZhciBrZXlDb2RlID0gZXZlbnQua2V5Q29kZTsKCgkJCQkvLyBiYWNrc3BhY2UKCgkJCQlpZiAoIGtleUNvZGUgPT0gOCApIHsKCgkJCQkJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCgkJCQkJdGV4dCA9IHRleHQuc3Vic3RyaW5nKCAwLCB0ZXh0Lmxlbmd0aCAtIDEgKTsKCQkJCQlyZWZyZXNoVGV4dCgpOwoKCQkJCQlyZXR1cm4gZmFsc2U7CgoJCQkJfQoKCQkJfQoKCQkJZnVuY3Rpb24gb25Eb2N1bWVudEtleVByZXNzKCBldmVudCApIHsKCgkJCQl2YXIga2V5Q29kZSA9IGV2ZW50LndoaWNoOwoKCQkJCS8vIGJhY2tzcGFjZQoKCQkJCWlmICgga2V5Q29kZSA9PSA4ICkgewoKCQkJCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoKCQkJCX0gZWxzZSB7CgoJCQkJCXZhciBjaCA9IFN0cmluZy5mcm9tQ2hhckNvZGUoIGtleUNvZGUgKTsKCQkJCQl0ZXh0ICs9IGNoOwoKCQkJCQlyZWZyZXNoVGV4dCgpOwoKCQkJCX0KCgkJCX0KCgkJCWZ1bmN0aW9uIGNyZWF0ZVRleHQoKSB7CgoJCQkJdGV4dEdlbyA9IG5ldyBUSFJFRS5UZXh0R2VvbWV0cnkoIHRleHQsIHsKCgkJCQkJc2l6ZTogc2l6ZSwKCQkJCQloZWlnaHQ6IGhlaWdodCwKCQkJCQljdXJ2ZVNlZ21lbnRzOiBjdXJ2ZVNlZ21lbnRzLAoKCQkJCQlmb250OiBmb250LAoJCQkJCXdlaWdodDogd2VpZ2h0LAoJCQkJCXN0eWxlOiBzdHlsZSwKCgkJCQkJYmV2ZWxUaGlja25lc3M6IGJldmVsVGhpY2tuZXNzLAoJCQkJCWJldmVsU2l6ZTogYmV2ZWxTaXplLAoJCQkJCWJldmVsRW5hYmxlZDogYmV2ZWxFbmFibGVkLAoKCQkJCQltYXRlcmlhbDogMCwKCQkJCQlleHRydWRlTWF0ZXJpYWw6IDEKCgkJCQl9KTsKCgkJCQl0ZXh0R2VvLmNvbXB1dGVCb3VuZGluZ0JveCgpOwoJCQkJdGV4dEdlby5jb21wdXRlVmVydGV4Tm9ybWFscygpOwoKCQkJCS8vICJmaXgiIHNpZGUgbm9ybWFscyBieSByZW1vdmluZyB6LWNvbXBvbmVudCBvZiBub3JtYWxzIGZvciBzaWRlIGZhY2VzCgkJCQkvLyAodGhpcyBkb2Vzbid0IHdvcmsgd2VsbCBmb3IgYmV2ZWxlZCBnZW9tZXRyeSBhcyB0aGVuIHdlIGxvc2UgbmljZSBjdXJ2YXR1cmUgYXJvdW5kIHotYXhpcykKCgkJCQlpZiAoICEgYmV2ZWxFbmFibGVkICkgewoKCQkJCQl2YXIgdHJpYW5nbGVBcmVhSGV1cmlzdGljcyA9IDAuMSAqICggaGVpZ2h0ICogc2l6ZSApOwoKCQkJCQlmb3IgKCB2YXIgaSA9IDA7IGkgPCB0ZXh0R2VvLmZhY2VzLmxlbmd0aDsgaSArKyApIHsKCgkJCQkJCXZhciBmYWNlID0gdGV4dEdlby5mYWNlc1sgaSBdOwoKCQkJCQkJaWYgKCBmYWNlLm1hdGVyaWFsSW5kZXggPT0gMSApIHsKCgkJCQkJCQlmb3IgKCB2YXIgaiA9IDA7IGogPCBmYWNlLnZlcnRleE5vcm1hbHMubGVuZ3RoOyBqICsrICkgewoKCQkJCQkJCQlmYWNlLnZlcnRleE5vcm1hbHNbIGogXS56ID0gMDsKCQkJCQkJCQlmYWNlLnZlcnRleE5vcm1hbHNbIGogXS5ub3JtYWxpemUoKTsKCgkJCQkJCQl9CgoJCQkJCQkJdmFyIHZhID0gdGV4dEdlby52ZXJ0aWNlc1sgZmFjZS5hIF07CgkJCQkJCQl2YXIgdmIgPSB0ZXh0R2VvLnZlcnRpY2VzWyBmYWNlLmIgXTsKCQkJCQkJCXZhciB2YyA9IHRleHRHZW8udmVydGljZXNbIGZhY2UuYyBdOwoKCQkJCQkJCXZhciBzID0gVEhSRUUuR2VvbWV0cnlVdGlscy50cmlhbmdsZUFyZWEoIHZhLCB2YiwgdmMgKTsKCgkJCQkJCQlpZiAoIHMgPiB0cmlhbmdsZUFyZWFIZXVyaXN0aWNzICkgewoKCQkJCQkJCQlmb3IgKCB2YXIgaiA9IDA7IGogPCBmYWNlLnZlcnRleE5vcm1hbHMubGVuZ3RoOyBqICsrICkgewoKCQkJCQkJCQkJZmFjZS52ZXJ0ZXhOb3JtYWxzWyBqIF0uY29weSggZmFjZS5ub3JtYWwgKTsKCgkJCQkJCQkJfQoKCQkJCQkJCX0KCgkJCQkJCX0KCgkJCQkJfQoKCQkJCX0KCgkJCQl2YXIgY2VudGVyT2Zmc2V0ID0gLTAuNSAqICggdGV4dEdlby5ib3VuZGluZ0JveC5tYXgueCAtIHRleHRHZW8uYm91bmRpbmdCb3gubWluLnggKTsKCgkJCQl0ZXh0TWVzaDEgPSBuZXcgVEhSRUUuTWVzaCggdGV4dEdlbywgbWF0ZXJpYWwgKTsKCgkJCQl0ZXh0TWVzaDEucG9zaXRpb24ueCA9IGNlbnRlck9mZnNldDsKCQkJCXRleHRNZXNoMS5wb3NpdGlvbi55ID0gaG92ZXI7CgkJCQl0ZXh0TWVzaDEucG9zaXRpb24ueiA9IDA7CgoJCQkJdGV4dE1lc2gxLnJvdGF0aW9uLnggPSAwOwoJCQkJdGV4dE1lc2gxLnJvdGF0aW9uLnkgPSBNYXRoLlBJICogMjsKCgkJCQlncm91cC5hZGQoIHRleHRNZXNoMSApOwoKCQkJCWlmICggbWlycm9yICkgewoKCQkJCQl0ZXh0TWVzaDIgPSBuZXcgVEhSRUUuTWVzaCggdGV4dEdlbywgbWF0ZXJpYWwgKTsKCgkJCQkJdGV4dE1lc2gyLnBvc2l0aW9uLnggPSBjZW50ZXJPZmZzZXQ7CgkJCQkJdGV4dE1lc2gyLnBvc2l0aW9uLnkgPSAtaG92ZXI7CgkJCQkJdGV4dE1lc2gyLnBvc2l0aW9uLnogPSBoZWlnaHQ7CgoJCQkJCXRleHRNZXNoMi5yb3RhdGlvbi54ID0gTWF0aC5QSTsKCQkJCQl0ZXh0TWVzaDIucm90YXRpb24ueSA9IE1hdGguUEkgKiAyOwoKCQkJCQlncm91cC5hZGQoIHRleHRNZXNoMiApOwoKCQkJCX0KCgkJCX0KCgkJCWZ1bmN0aW9uIHJlZnJlc2hUZXh0KCkgewoKCQkJCXVwZGF0ZVBlcm1hbGluaygpOwoKCQkJCWdyb3VwLnJlbW92ZSggdGV4dE1lc2gxICk7CgkJCQlpZiAoIG1pcnJvciApIGdyb3VwLnJlbW92ZSggdGV4dE1lc2gyICk7CgoJCQkJaWYgKCAhdGV4dCApIHJldHVybjsKCgkJCQljcmVhdGVUZXh0KCk7CgoJCQl9CgoJCQlmdW5jdGlvbiBvbkRvY3VtZW50TW91c2VEb3duKCBldmVudCApIHsKCgkJCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoKCQkJCWRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoICdtb3VzZW1vdmUnLCBvbkRvY3VtZW50TW91c2VNb3ZlLCBmYWxzZSApOwoJCQkJZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lciggJ21vdXNldXAnLCBvbkRvY3VtZW50TW91c2VVcCwgZmFsc2UgKTsKCQkJCWRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoICdtb3VzZW91dCcsIG9uRG9jdW1lbnRNb3VzZU91dCwgZmFsc2UgKTsKCgkJCQltb3VzZVhPbk1vdXNlRG93biA9IGV2ZW50LmNsaWVudFggLSB3aW5kb3dIYWxmWDsKCQkJCXRhcmdldFJvdGF0aW9uT25Nb3VzZURvd24gPSB0YXJnZXRSb3RhdGlvbjsKCgkJCX0KCgkJCWZ1bmN0aW9uIG9uRG9jdW1lbnRNb3VzZU1vdmUoIGV2ZW50ICkgewoKCQkJCW1vdXNlWCA9IGV2ZW50LmNsaWVudFggLSB3aW5kb3dIYWxmWDsKCgkJCQl0YXJnZXRSb3RhdGlvbiA9IHRhcmdldFJvdGF0aW9uT25Nb3VzZURvd24gKyAoIG1vdXNlWCAtIG1vdXNlWE9uTW91c2VEb3duICkgKiAwLjAyOwoKCQkJfQoKCQkJZnVuY3Rpb24gb25Eb2N1bWVudE1vdXNlVXAoIGV2ZW50ICkgewoKCQkJCWRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoICdtb3VzZW1vdmUnLCBvbkRvY3VtZW50TW91c2VNb3ZlLCBmYWxzZSApOwoJCQkJZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ21vdXNldXAnLCBvbkRvY3VtZW50TW91c2VVcCwgZmFsc2UgKTsKCQkJCWRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoICdtb3VzZW91dCcsIG9uRG9jdW1lbnRNb3VzZU91dCwgZmFsc2UgKTsKCgkJCX0KCgkJCWZ1bmN0aW9uIG9uRG9jdW1lbnRNb3VzZU91dCggZXZlbnQgKSB7CgoJCQkJZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ21vdXNlbW92ZScsIG9uRG9jdW1lbnRNb3VzZU1vdmUsIGZhbHNlICk7CgkJCQlkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCAnbW91c2V1cCcsIG9uRG9jdW1lbnRNb3VzZVVwLCBmYWxzZSApOwoJCQkJZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ21vdXNlb3V0Jywgb25Eb2N1bWVudE1vdXNlT3V0LCBmYWxzZSApOwoKCQkJfQoKCQkJZnVuY3Rpb24gb25Eb2N1bWVudFRvdWNoU3RhcnQoIGV2ZW50ICkgewoKCQkJCWlmICggZXZlbnQudG91Y2hlcy5sZW5ndGggPT0gMSApIHsKCgkJCQkJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCgkJCQkJbW91c2VYT25Nb3VzZURvd24gPSBldmVudC50b3VjaGVzWyAwIF0ucGFnZVggLSB3aW5kb3dIYWxmWDsKCQkJCQl0YXJnZXRSb3RhdGlvbk9uTW91c2VEb3duID0gdGFyZ2V0Um90YXRpb247CgoJCQkJfQoKCQkJfQoKCQkJZnVuY3Rpb24gb25Eb2N1bWVudFRvdWNoTW92ZSggZXZlbnQgKSB7CgoJCQkJaWYgKCBldmVudC50b3VjaGVzLmxlbmd0aCA9PSAxICkgewoKCQkJCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoKCQkJCQltb3VzZVggPSBldmVudC50b3VjaGVzWyAwIF0ucGFnZVggLSB3aW5kb3dIYWxmWDsKCQkJCQl0YXJnZXRSb3RhdGlvbiA9IHRhcmdldFJvdGF0aW9uT25Nb3VzZURvd24gKyAoIG1vdXNlWCAtIG1vdXNlWE9uTW91c2VEb3duICkgKiAwLjA1OwoKCQkJCX0KCgkJCX0KCgkJCS8vCgoJCQlmdW5jdGlvbiBhbmltYXRlKCkgewoKCQkJCXJlcXVlc3RBbmltYXRpb25GcmFtZSggYW5pbWF0ZSApOwoKCQkJCXJlbmRlcigpOwoJCQkJc3RhdHMudXBkYXRlKCk7CgoJCQl9CgoJCQlmdW5jdGlvbiByZW5kZXIoKSB7CgoJCQkJZ3JvdXAucm90YXRpb24ueSArPSAoIHRhcmdldFJvdGF0aW9uIC0gZ3JvdXAucm90YXRpb24ueSApICogMC4wNTsKCgkJCQljYW1lcmEubG9va0F0KCBjYW1lcmFUYXJnZXQgKTsKCgkJCQlyZW5kZXJlci5jbGVhcigpOwoKCQkJCWlmICggcG9zdHByb2Nlc3NpbmcuZW5hYmxlZCApIHsKCgkJCQkJY29tcG9zZXIucmVuZGVyKCAwLjA1ICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJcmVuZGVyZXIucmVuZGVyKCBzY2VuZSwgY2FtZXJhICk7CgoJCQkJfQoKCQkJfQoKCQk8L3NjcmlwdD4KCgk8L2JvZHk+CjwvaHRtbD4K",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Sat, 08 Nov 2014 15:37:55 GMT",
                    "Content-Length": "15948",
                    "Date": "Sat, 08 Nov 2014 15:38:03 GMT",
                    "Content-Type": "text/html; charset=utf-8"
                },
                "cookies": [],
                "mimeType": "HTML",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}