{
    "url": "http://localhost:9999/cubiq/add-to-homescreen/src/addtohomescreen.js",
    "host": "localhost",
    "port": 9999,
    "protocol": "http",
    "name": "DOM data manipulation (DOM-based)",
    "issueType": 5247488,
    "severity": "Information",
    "confidence": "Firm",
    "issueBackground": "DOM-based DOM data manipulation vulnerabilities arise when a client-side script within an application's response reads data from a controllable part of the DOM (for example, the URL), and writes this to a data field within the DOM that is used within the visible UI or client-side application logic. An attacker may be able to use the vulnerability to construct a URL which, if visited by another application user, will modify the appearance or behavior of the client-side UI. An attacker may be able to leverage this to perform virtual defacement of the application, or possibly to induce the user to perform unintended actions.",
    "remediationBackground": "Static analysis of code to identify vulnerabilities of this kind may lead to false positives that are not actually exploitable. You should review the highlighted code and related execution paths to determine whether the application is indeed vulnerable, or whether mitigations are in place that would prevent exploitation.<br><br>The most effective way to avoid DOM-based DOM data manipulation vulnerabilities is not to dynamically write to DOM data fields any data that originated from any untrusted source. If the desired functionality of the application means that this behavior is unavoidable, then defenses must be implemented within the client-side code to prevent malicious data from being stored. In general, this is best achieved by using a whitelist of permitted values.",
    "issueDetail": "The application may be vulnerable to DOM-based DOM data manipulation. Data is read from <b>document.location.href</b> and written to <b>history.replaceState()</b> via the following statement:<ul><li>history.replaceState('', window.document.title, document.location.href.split('#')[0]);</li></ul>",
    "requestResponses": [
        {
            "request": {
                "host": "localhost",
                "port": 9999,
                "protocol": "http",
                "url": "http://localhost:9999/cubiq/add-to-homescreen/src/addtohomescreen.js",
                "path": "/cubiq/add-to-homescreen/src/addtohomescreen.js",
                "httpVersion": "HTTP/1.1",
                "method": "GET",
                "headers": {
                    "Host": "localhost:9999"
                },
                "body": "",
                "raw": "R0VUIC9jdWJpcS9hZGQtdG8taG9tZXNjcmVlbi9zcmMvYWRkdG9ob21lc2NyZWVuLmpzIEhUVFAvMS4xDQpIb3N0OiBsb2NhbGhvc3Q6OTk5OQ0KDQo=",
                "inScope": true,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "request"
            },
            "response": {
                "statusCode": 200,
                "raw": "SFRUUC8xLjEgMjAwIE9LDQpDb250ZW50LUxlbmd0aDogMjA2NzUNCkFjY2VwdC1SYW5nZXM6IGJ5dGVzDQpDb250ZW50LVR5cGU6IGFwcGxpY2F0aW9uL2phdmFzY3JpcHQNCkRhdGU6IFRodSwgMDYgTm92IDIwMTQgMDY6MzY6NDUgR01UDQpMYXN0LU1vZGlmaWVkOiBUaHUsIDA2IE5vdiAyMDE0IDA2OjM2OjQ1IEdNVA0KDQovKiBBZGQgdG8gSG9tZXNjcmVlbiB2My4wLjggfiAoYykgMjAxNCBNYXR0ZW8gU3BpbmVsbGkgfiBAbGljZW5zZTogaHR0cDovL2N1YmlxLm9yZy9saWNlbnNlICovCihmdW5jdGlvbiAod2luZG93LCBkb2N1bWVudCkgewovKgogICAgICAgXyAgIF8gX19fX18gICAgIF9fX19fCiBfX18gX3wgfF98IHxfICAgX3xfX198ICB8ICB8X19fIF9fX19fIF9fXyBfX18gX19fIF9fXyBfX18gX19fIF9fXwp8IC4nfCAuIHwgLiB8IHwgfCB8IC4gfCAgICAgfCAuIHwgICAgIHwgLV98XyAtfCAgX3wgIF98IC1ffCAtX3wgICB8CnxfXyx8X19ffF9fX3wgfF98IHxfX198X198X198X19ffF98X3xffF9fX3xfX198X19ffF98IHxfX198X19ffF98X3wKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnkgTWF0dGVvIFNwaW5lbGxpIH4gaHR0cDovL2N1YmlxLm9yZwoqLwoKLy8gQ2hlY2sgaWYgZG9jdW1lbnQgaXMgbG9hZGVkLCBuZWVkZWQgYnkgYXV0b3N0YXJ0CnZhciBfRE9NUmVhZHkgPSBmYWxzZTsKaWYgKCBkb2N1bWVudC5yZWFkeVN0YXRlID09PSAnY29tcGxldGUnICkgewoJX0RPTVJlYWR5ID0gdHJ1ZTsKfSBlbHNlIHsKCXdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgbG9hZGVkLCBmYWxzZSk7Cn0KCmZ1bmN0aW9uIGxvYWRlZCAoKSB7Cgl3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignbG9hZCcsIGxvYWRlZCwgZmFsc2UpOwoJX0RPTVJlYWR5ID0gdHJ1ZTsKfQoKLy8gcmVnZXggdXNlZCB0byBkZXRlY3QgaWYgYXBwIGhhcyBiZWVuIGFkZGVkIHRvIHRoZSBob21lc2NyZWVuCnZhciBfcmVTbWFydFVSTCA9IC9cL2F0aChcLyk/JC87CnZhciBfcmVRdWVyeVN0cmluZyA9IC8oW1w/Jl1hdGg9W14mXSokfCZhdGg9W14mXSooJikpLzsKCi8vIHNpbmdsZXRvbgp2YXIgX2luc3RhbmNlOwpmdW5jdGlvbiBhdGggKG9wdGlvbnMpIHsKCV9pbnN0YW5jZSA9IF9pbnN0YW5jZSB8fCBuZXcgYXRoLkNsYXNzKG9wdGlvbnMpOwoKCXJldHVybiBfaW5zdGFuY2U7Cn0KCi8vIG1lc3NhZ2UgaW4gYWxsIHN1cHBvcnRlZCBsYW5ndWFnZXMKYXRoLmludGwgPSB7CglkZV9kZTogewoJCW1lc3NhZ2U6ICdVbSBkaWVzZSBXZWItQXBwIHp1bSBIb21lLUJpbGRzY2hpcm0gaGluenV6dWbDvGdlbiwgdGlwcGVuIFNpZSBhdWYgJWljb24gdW5kIGRhbm4gPHN0cm9uZz4lYWN0aW9uPC9zdHJvbmc+LicsCgkJYWN0aW9uOiB7IGlvczogJ1p1bSBIb21lLUJpbGRzY2hpcm0nLCBhbmRyb2lkOiAnWnVtIFN0YXJ0YmlsZHNjaGlybSBoaW56dWbDvGdlbicsIHdpbmRvd3M6ICdBdWYgU3RhcnRzZWl0ZScgfQoJfSwKCgllbl91czogewoJCW1lc3NhZ2U6ICdUbyBhZGQgdGhpcyB3ZWIgYXBwIHRvIHRoZSBob21lIHNjcmVlbjogdGFwICVpY29uIGFuZCB0aGVuIDxzdHJvbmc+JWFjdGlvbjwvc3Ryb25nPi4nLAoJCWFjdGlvbjogeyBpb3M6ICdBZGQgdG8gSG9tZSBTY3JlZW4nLCBhbmRyb2lkOiAnQWRkIHRvIGhvbWVzY3JlZW4nLCB3aW5kb3dzOiAncGluIHRvIHN0YXJ0JyB9Cgl9LAoKCWVzX2VzOiB7CgkJbWVzc2FnZTogJ1BhcmEgYcOxYWRpciBlc3RhIGFwbGljYWNpw7NuIHdlYiBhIGxhIHBhbnRhbGxhIGRlIGluaWNpbzogcHVsc2EgJWljb24geSBzZWxlY2Npb25hIDxzdHJvbmc+JWFjdGlvbjwvc3Ryb25nPi4nLAoJCWFjdGlvbjogeyBpb3M6ICdBw7FhZGlyIGEgcGFudGFsbGEgZGUgaW5pY2lvJywgYW5kcm9pZDogJ0HDsWFkaXIgYSBwYW50YWxsYSBkZSBpbmljaW8nLCB3aW5kb3dzOiAnQcOxYWRpciBhIGluaWNpbycgfQoJfSwKCglmcl9mcjogewoJCW1lc3NhZ2U6ICdQb3VyIGFqb3V0ZXIgY2V0dGUgYXBwbGljYXRpb24gd2ViIHN1ciBsXCfDqWNyYW4gZFwnYWNjdWVpbCA6IEFwcHV5ZXogJWljb24gZXQgc8OpbGVjdGlvbm5leiA8c3Ryb25nPiVhY3Rpb248L3N0cm9uZz4uJywKCQlhY3Rpb246IHsgaW9zOiAnQWpvdXRlciBzdXIgbFwnw6ljcmFuIGRcJ2FjY3VlaWwnLCBhbmRyb2lkOiAnQWpvdXRlciDDoCBsXCfDqWNyYW4gZFwnYWNjdWVpbCcsIHdpbmRvd3M6ICfDiXBpbmdsZXIgw6AgbFwnw6ljcmFuIGRcJ2FjY3VlaWwnIH0KCX0sCgoJaXRfaXQ6IHsKCQltZXNzYWdlOiAnUGVyIEFnZ2l1bmdlcmUgcXVlc3RhIHdlYiBhcHAgYWxsYSBzY2hlcm1hdGEgaW5pemlhbGU6IHByZW1pICVpY29uIGUgcG9pIDxzdHJvbmc+JWFjdGlvbjwvc3Ryb25nPi4nLAoJCWFjdGlvbjogeyBpb3M6ICdBZ2dpdW5naSBhIEhvbWUnLCBhbmRyb2lkOiAnQWdnaXVuZ2kgYWxsYSBob21lc2NyZWVuJywgd2luZG93czogJ2FnZ2l1bmdpIGEgc3RhcnQnIH0KCX0sCgoJbmJfbm86IHsKCQltZXNzYWdlOiAnRm9yIMOlIGluc3RhbGxlcmUgZGVubmUgYXBwZW4gcMOlIGhqZW0tc2tqZXJtZW46IHRyeWtrIHDDpSAlaWNvbiBvZyBkZXJldHRlciA8c3Ryb25nPiVhY3Rpb248L3N0cm9uZz4uJywKCQlhY3Rpb246IHsgaW9zOiAnTGVnZyB0aWwgcMOlIEhqZW0tc2tqZXJtJywgYW5kcm9pZDogJ0xlZ2cgdGlsIHDDpSBzdGFydHNpZGVuJywgd2luZG93czogJ2Zlc3QgdGlsIHN0YXJ0JyB9Cgl9LAoKCW5sX25sOiB7CgkJbWVzc2FnZTogJ09tIGRlemUgd2ViYXBwIG9wIGplIHRlbGVmb29uIHRlIGluc3RhbGxlcmVuLCBrbGlrIG9wICVpY29uIGVuIGRhbiA8c3Ryb25nPiVhY3Rpb248L3N0cm9uZz4uJywKCQlhY3Rpb246IHsgaW9zOiAnWmV0IGluIGJlZ2luc2NoZXJtJywgYW5kcm9pZDogJ1RvZXZvZWdlbiBhYW4gc3RhcnRzY2hlcm0nLCB3aW5kb3dzOiAnQWFuIHN0YXJ0c2NoZXJtIHZhc3RtYWtlbicgfQoJfSwKCglzdl9zZTogewoJCW1lc3NhZ2U6ICdGw7ZyIGF0dCBsw6RnZ2EgdGlsbCBkZW5uYSB3ZWJiYXBwbGlrYXRpb24gcMOlIGhlbXNrw6RybWVuOiB0cnljayBww6UgJWljb24gb2NoIGTDpHJlZnRlciA8c3Ryb25nPiVhY3Rpb248L3N0cm9uZz4uJywKCQlhY3Rpb246IHsgaW9zOiAnTMOkZ2cgdGlsbCBww6UgaGVtc2vDpHJtZW4nLCBhbmRyb2lkOiAnTMOkZ2cgdGlsIHDDpSBzdGFydHNrw6RybWVuJywgd2luZG93czogJ2bDpHN0IHDDpSBzdGFydHNrw6RybWVuJyB9Cgl9LAoKCXpoX2NuOiB7CgkJbWVzc2FnZTogJ+WmguimgeaKiuW6lOeUqOeoi+W8j+WKoOiHs+S4u+Wxj+W5lSzor7fngrnlh7slaWNvbiwg54S25ZCOPHN0cm9uZz4lYWN0aW9uPC9zdHJvbmc+JywKCQlhY3Rpb246IHsgaW9zOiAn5Yqg6Iez5Li75bGP5bmVJywgYW5kcm9pZDogJ+WKoOiHs+S4u+Wxj+W5lScsIHdpbmRvd3M6ICfmjInkvY/lkK/liqgnIH0KCX0sCgoJemhfdHc6IHsKCQltZXNzYWdlOiAn5aaC6KaB5oqK5oeJ55So56iL5byP5Yqg6Iez5Li75bGP5bmVLCDoq4vpu57mk4olaWNvbiwg54S25b6MPHN0cm9uZz4lYWN0aW9uPC9zdHJvbmc+LicsCgkJYWN0aW9uOiB7IGlvczogJ+WKoOiHs+S4u+Wxj+W5lScsIGFuZHJvaWQ6ICfliqDoh7PkuLvlsY/luZUnLCB3aW5kb3dzOiAn5oyJ5L2P5ZWf5YuVJyB9Cgl9Cn07CgovLyBBZGQgMiBjaGFyYWN0ZXJzIGxhbmd1YWdlIHN1cHBvcnQgKEFuZHJvaWQgbW9zdGx5KQpmb3IgKCB2YXIgbGFuZyBpbiBhdGguaW50bCApIHsKCWF0aC5pbnRsW2xhbmcuc3Vic3RyKDAsIDIpXSA9IGF0aC5pbnRsW2xhbmddOwp9CgovLyBkZWZhdWx0IG9wdGlvbnMKYXRoLmRlZmF1bHRzID0gewoJYXBwSUQ6ICdvcmcuY3ViaXEuYWRkdG9ob21lJywJCS8vIGxvY2FsIHN0b3JhZ2UgbmFtZSAobm8gbmVlZCB0byBjaGFuZ2UpCglmb250U2l6ZTogMTUsCQkJCS8vIGJhc2UgZm9udCBzaXplLCB1c2VkIHRvIHByb3Blcmx5IHJlc2l6ZSB0aGUgcG9wdXAgYmFzZWQgb24gdmlld3BvcnQgc2NhbGUgZmFjdG9yCglkZWJ1ZzogZmFsc2UsCQkJCS8vIG92ZXJyaWRlIGJyb3dzZXIgY2hlY2tzCgltb2RhbDogZmFsc2UsCQkJCS8vIHByZXZlbnQgZnVydGhlciBhY3Rpb25zIHVudGlsIHRoZSBtZXNzYWdlIGlzIGNsb3NlZAoJbWFuZGF0b3J5OiBmYWxzZSwJCQkvLyB5b3UgY2FuJ3QgcHJvY2VlZCBpZiB5b3UgZG9uJ3QgYWRkIHRoZSBhcHAgdG8gdGhlIGhvbWVzY3JlZW4KCWF1dG9zdGFydDogdHJ1ZSwJCQkvLyBzaG93IHRoZSBtZXNzYWdlIGF1dG9tYXRpY2FsbHkKCXNraXBGaXJzdFZpc2l0OiBmYWxzZSwJCS8vIHNob3cgb25seSB0byByZXR1cm5pbmcgdmlzaXRvcnMgKGllOiBza2lwIHRoZSBmaXJzdCB0aW1lIHlvdSB2aXNpdCkKCXN0YXJ0RGVsYXk6IDEsCQkJCS8vIGRpc3BsYXkgdGhlIG1lc3NhZ2UgYWZ0ZXIgdGhhdCBtYW55IHNlY29uZHMgZnJvbSBwYWdlIGxvYWQKCWxpZmVzcGFuOiAxNSwJCQkJLy8gbGlmZSBvZiB0aGUgbWVzc2FnZSBpbiBzZWNvbmRzCglkaXNwbGF5UGFjZTogMTQ0MCwJCQkvLyBtaW51dGVzIGJlZm9yZSB0aGUgbWVzc2FnZSBpcyBzaG93biBhZ2FpbiAoMDogZGlzcGxheSBldmVyeSB0aW1lLCBkZWZhdWx0IDI0IGhvdXJzKQoJbWF4RGlzcGxheUNvdW50OiAwLAkJCS8vIGFic29sdXRlIG1heGltdW0gbnVtYmVyIG9mIHRpbWVzIHRoZSBtZXNzYWdlIHdpbGwgYmUgc2hvd24gdG8gdGhlIHVzZXIgKDA6IG5vIGxpbWl0KQoJaWNvbjogdHJ1ZSwJCQkJCS8vIGFkZCB0b3VjaCBpY29uIHRvIHRoZSBtZXNzYWdlCgltZXNzYWdlOiAnJywJCQkJLy8gdGhlIG1lc3NhZ2UgY2FuIGJlIGN1c3RvbWl6ZWQKCXZhbGlkTG9jYXRpb246IFtdLAkJCS8vIGxpc3Qgb2YgcGFnZXMgd2hlcmUgdGhlIG1lc3NhZ2Ugd2lsbCBiZSBzaG93biAoYXJyYXkgb2YgcmVnZXhlcykKCW9uSW5pdDogbnVsbCwJCQkJLy8gZXhlY3V0ZWQgb24gaW5zdGFuY2UgY3JlYXRpb24KCW9uU2hvdzogbnVsbCwJCQkJLy8gZXhlY3V0ZWQgd2hlbiB0aGUgbWVzc2FnZSBpcyBzaG93bgoJb25SZW1vdmU6IG51bGwsCQkJCS8vIGV4ZWN1dGVkIHdoZW4gdGhlIG1lc3NhZ2UgaXMgcmVtb3ZlZAoJb25BZGQ6IG51bGwsCQkJCS8vIHdoZW4gdGhlIGFwcGxpY2F0aW9uIGlzIGxhdW5jaGVkIHRoZSBmaXJzdCB0aW1lIGZyb20gdGhlIGhvbWVzY3JlZW4gKGd1ZXNzdGltYXRlKQoJb25Qcml2YXRlOiBudWxsLAkJCS8vIGV4ZWN1dGVkIGlmIHVzZXIgaXMgaW4gcHJpdmF0ZSBtb2RlCglkZXRlY3RIb21lc2NyZWVuOiBmYWxzZQkJLy8gdHJ5IHRvIGRldGVjdCBpZiB0aGUgc2l0ZSBoYXMgYmVlbiBhZGRlZCB0byB0aGUgaG9tZXNjcmVlbiAoZmFsc2UgfCB0cnVlIHwgJ2hhc2gnIHwgJ3F1ZXJ5U3RyaW5nJyB8ICdzbWFydFVSTCcpCn07CgovLyBicm93c2VyIGluZm8gYW5kIGNhcGFiaWxpdHkKdmFyIF91YSA9IHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50OwoKdmFyIF9uYXYgPSB3aW5kb3cubmF2aWdhdG9yOwpfZXh0ZW5kKGF0aCwgewoJaGFzVG9rZW46IGRvY3VtZW50LmxvY2F0aW9uLmhhc2ggPT0gJyNhdGgnIHx8IF9yZVNtYXJ0VVJMLnRlc3QoZG9jdW1lbnQubG9jYXRpb24uaHJlZikgfHwgX3JlUXVlcnlTdHJpbmcudGVzdChkb2N1bWVudC5sb2NhdGlvbi5zZWFyY2gpLAoJaXNSZXRpbmE6IHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvICYmIHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvID4gMSwKCWlzSURldmljZTogKC9pcGhvbmV8aXBvZHxpcGFkL2kpLnRlc3QoX3VhKSwKCWlzTW9iaWxlQ2hyb21lOiBfdWEuaW5kZXhPZignQW5kcm9pZCcpID4gLTEgJiYgKC9DaHJvbWVcL1suMC05XSovKS50ZXN0KF91YSksCglpc01vYmlsZUlFOiBfdWEuaW5kZXhPZignV2luZG93cyBQaG9uZScpID4gLTEsCglsYW5ndWFnZTogX25hdi5sYW5ndWFnZSAmJiBfbmF2Lmxhbmd1YWdlLnRvTG93ZXJDYXNlKCkucmVwbGFjZSgnLScsICdfJykgfHwgJycKfSk7CgovLyBmYWxscyBiYWNrIHRvIGVuX3VzIGlmIGxhbmd1YWdlIGlzIHVuc3VwcG9ydGVkCmF0aC5sYW5ndWFnZSA9IGF0aC5sYW5ndWFnZSAmJiBhdGgubGFuZ3VhZ2UgaW4gYXRoLmludGwgPyBhdGgubGFuZ3VhZ2UgOiAnZW5fdXMnOwoKYXRoLmlzTW9iaWxlU2FmYXJpID0gYXRoLmlzSURldmljZSAmJiBfdWEuaW5kZXhPZignU2FmYXJpJykgPiAtMSAmJiBfdWEuaW5kZXhPZignQ3JpT1MnKSA8IDA7CmF0aC5PUyA9IGF0aC5pc0lEZXZpY2UgPyAnaW9zJyA6IGF0aC5pc01vYmlsZUNocm9tZSA/ICdhbmRyb2lkJyA6IGF0aC5pc01vYmlsZUlFID8gJ3dpbmRvd3MnIDogJ3Vuc3VwcG9ydGVkJzsKCmF0aC5PU1ZlcnNpb24gPSBfdWEubWF0Y2goLyhPU3xBbmRyb2lkKSAoXGQrW19cLl1cZCspLyk7CmF0aC5PU1ZlcnNpb24gPSBhdGguT1NWZXJzaW9uICYmIGF0aC5PU1ZlcnNpb25bMl0gPyArYXRoLk9TVmVyc2lvblsyXS5yZXBsYWNlKCdfJywgJy4nKSA6IDA7CgphdGguaXNTdGFuZGFsb25lID0gd2luZG93Lm5hdmlnYXRvci5zdGFuZGFsb25lIHx8ICggYXRoLmlzTW9iaWxlQ2hyb21lICYmICggc2NyZWVuLmhlaWdodCAtIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQgPCA0MCApICk7CS8vIFRPRE86IGNoZWNrIHRoZSBsYW1lIHBvbHlmaWxsCmF0aC5pc1RhYmxldCA9IChhdGguaXNNb2JpbGVTYWZhcmkgJiYgX3VhLmluZGV4T2YoJ2lQYWQnKSA+IC0xKSB8fCAoYXRoLmlzTW9iaWxlQ2hyb21lICYmIF91YS5pbmRleE9mKCdNb2JpbGUnKSA8IDApOwoKYXRoLmlzQ29tcGF0aWJsZSA9IChhdGguaXNNb2JpbGVTYWZhcmkgJiYgYXRoLk9TVmVyc2lvbiA+PSA2KSB8fCBhdGguaXNNb2JpbGVDaHJvbWU7CS8vIFRPRE86IGFkZCB3aW5waG9uZQoKdmFyIF9kZWZhdWx0U2Vzc2lvbiA9IHsKCWxhc3REaXNwbGF5VGltZTogMCwJCQkvLyBsYXN0IHRpbWUgd2UgZGlzcGxheWVkIHRoZSBtZXNzYWdlCglyZXR1cm5pbmdWaXNpdG9yOiBmYWxzZSwJLy8gaXMgdGhpcyB0aGUgZmlyc3QgdGltZSB5b3UgdmlzaXQKCWRpc3BsYXlDb3VudDogMCwJCQkvLyBudW1iZXIgb2YgdGltZXMgdGhlIG1lc3NhZ2UgaGFzIGJlZW4gc2hvd24KCW9wdGVkb3V0OiBmYWxzZSwJCQkvLyBoYXMgdGhlIHVzZXIgb3B0ZWQgb3V0CglhZGRlZDogZmFsc2UJCQkJLy8gaGFzIGJlZW4gYWN0dWFsbHkgYWRkZWQgdG8gdGhlIGhvbWVzY3JlZW4KfTsKCmF0aC5yZW1vdmVTZXNzaW9uID0gZnVuY3Rpb24gKGFwcElEKSB7Cgl0cnkgewoJCWxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGFwcElEIHx8IGF0aC5kZWZhdWx0cy5hcHBJRCk7Cgl9IGNhdGNoIChlKSB7CgkJLy8gd2UgYXJlIG1vc3QgbGlrZWx5IGluIHByaXZhdGUgbW9kZQoJfQp9OwoKYXRoLkNsYXNzID0gZnVuY3Rpb24gKG9wdGlvbnMpIHsKCS8vIG1lcmdlIGRlZmF1bHQgb3B0aW9ucyB3aXRoIHVzZXIgY29uZmlnCgl0aGlzLm9wdGlvbnMgPSBfZXh0ZW5kKHt9LCBhdGguZGVmYXVsdHMpOwoJX2V4dGVuZCh0aGlzLm9wdGlvbnMsIG9wdGlvbnMpOwoKCS8vIG5vcm1hbGl6ZSBzb21lIG9wdGlvbnMKCXRoaXMub3B0aW9ucy5tYW5kYXRvcnkgPSB0aGlzLm9wdGlvbnMubWFuZGF0b3J5ICYmICggJ3N0YW5kYWxvbmUnIGluIHdpbmRvdy5uYXZpZ2F0b3IgfHwgdGhpcy5vcHRpb25zLmRlYnVnICk7Cgl0aGlzLm9wdGlvbnMubW9kYWwgPSB0aGlzLm9wdGlvbnMubW9kYWwgfHwgdGhpcy5vcHRpb25zLm1hbmRhdG9yeTsKCWlmICggdGhpcy5vcHRpb25zLm1hbmRhdG9yeSApIHsKCQl0aGlzLm9wdGlvbnMuc3RhcnREZWxheSA9IC0wLjU7CQkvLyBtYWtlIHRoZSBwb3B1cCBoYXN0eQoJfQoJdGhpcy5vcHRpb25zLmRldGVjdEhvbWVzY3JlZW4gPSB0aGlzLm9wdGlvbnMuZGV0ZWN0SG9tZXNjcmVlbiA9PT0gdHJ1ZSA/ICdoYXNoJyA6IHRoaXMub3B0aW9ucy5kZXRlY3RIb21lc2NyZWVuOwoKCS8vIHNldHVwIHRoZSBkZWJ1ZyBlbnZpcm9ubWVudAoJaWYgKCB0aGlzLm9wdGlvbnMuZGVidWcgKSB7CgkJYXRoLmlzQ29tcGF0aWJsZSA9IHRydWU7CgkJYXRoLk9TID0gdHlwZW9mIHRoaXMub3B0aW9ucy5kZWJ1ZyA9PSAnc3RyaW5nJyA/IHRoaXMub3B0aW9ucy5kZWJ1ZyA6IGF0aC5PUyA9PSAndW5zdXBwb3J0ZWQnID8gJ2FuZHJvaWQnIDogYXRoLk9TOwoJCWF0aC5PU1ZlcnNpb24gPSBhdGguT1MgPT0gJ2lvcycgPyAnOCcgOiAnNCc7Cgl9CgoJLy8gdGhlIGVsZW1lbnQgdGhlIG1lc3NhZ2Ugd2lsbCBiZSBhcHBlbmRlZCB0bwoJdGhpcy5jb250YWluZXIgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7CgoJLy8gbG9hZCBzZXNzaW9uCgl0aGlzLnNlc3Npb24gPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSh0aGlzLm9wdGlvbnMuYXBwSUQpOwoJdGhpcy5zZXNzaW9uID0gdGhpcy5zZXNzaW9uID8gSlNPTi5wYXJzZSh0aGlzLnNlc3Npb24pIDogdW5kZWZpbmVkOwoKCS8vIHVzZXIgbW9zdCBsaWtlbHkgY2FtZSBmcm9tIGEgZGlyZWN0IGxpbmsgY29udGFpbmluZyBvdXIgdG9rZW4sIHdlIGRvbid0IG5lZWQgaXQgYW5kIHdlIHJlbW92ZSBpdAoJaWYgKCBhdGguaGFzVG9rZW4gJiYgKCAhYXRoLmlzQ29tcGF0aWJsZSB8fCAhdGhpcy5zZXNzaW9uICkgKSB7CgkJYXRoLmhhc1Rva2VuID0gZmFsc2U7CgkJX3JlbW92ZVRva2VuKCk7Cgl9CgoJLy8gdGhlIGRldmljZSBpcyBub3Qgc3VwcG9ydGVkCglpZiAoICFhdGguaXNDb21wYXRpYmxlICkgewoJCXJldHVybjsKCX0KCgl0aGlzLnNlc3Npb24gPSB0aGlzLnNlc3Npb24gfHwgX2RlZmF1bHRTZXNzaW9uOwoKCS8vIGNoZWNrIGlmIHdlIGNhbiB1c2UgdGhlIGxvY2FsIHN0b3JhZ2UKCXRyeSB7CgkJbG9jYWxTdG9yYWdlLnNldEl0ZW0odGhpcy5vcHRpb25zLmFwcElELCBKU09OLnN0cmluZ2lmeSh0aGlzLnNlc3Npb24pKTsKCQlhdGguaGFzTG9jYWxTdG9yYWdlID0gdHJ1ZTsKCX0gY2F0Y2ggKGUpIHsKCQkvLyB3ZSBhcmUgbW9zdCBsaWtlbHkgaW4gcHJpdmF0ZSBtb2RlCgkJYXRoLmhhc0xvY2FsU3RvcmFnZSA9IGZhbHNlOwoKCQlpZiAoIHRoaXMub3B0aW9ucy5vblByaXZhdGUgKSB7CgkJCXRoaXMub3B0aW9ucy5vblByaXZhdGUuY2FsbCh0aGlzKTsKCQl9Cgl9CgoJLy8gY2hlY2sgaWYgdGhpcyBpcyBhIHZhbGlkIGxvY2F0aW9uCgl2YXIgaXNWYWxpZExvY2F0aW9uID0gIXRoaXMub3B0aW9ucy52YWxpZExvY2F0aW9uLmxlbmd0aDsKCWZvciAoIHZhciBpID0gdGhpcy5vcHRpb25zLnZhbGlkTG9jYXRpb24ubGVuZ3RoOyBpLS07ICkgewoJCWlmICggdGhpcy5vcHRpb25zLnZhbGlkTG9jYXRpb25baV0udGVzdChkb2N1bWVudC5sb2NhdGlvbi5ocmVmKSApIHsKCQkJaXNWYWxpZExvY2F0aW9uID0gdHJ1ZTsKCQkJYnJlYWs7CgkJfQoJfQoKCS8vIGNoZWNrIGNvbXBhdGliaWxpdHkgd2l0aCBvbGQgdmVyc2lvbnMgb2YgYWRkIHRvIGhvbWVzY3JlZW4uIE9wdC1vdXQgaWYgYW4gb2xkIHNlc3Npb24gaXMgZm91bmQKCWlmICggbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2FkZFRvSG9tZScpICkgewoJCXRoaXMub3B0T3V0KCk7Cgl9CgoJLy8gY3JpdGljYWwgZXJyb3JzOgoJLy8gdXNlciBvcHRlZCBvdXQsIGFscmVhZHkgYWRkZWQgdG8gdGhlIGhvbWVzY3JlZW4sIG5vdCBhIHZhbGlkIGxvY2F0aW9uCglpZiAoIHRoaXMuc2Vzc2lvbi5vcHRlZG91dCB8fCB0aGlzLnNlc3Npb24uYWRkZWQgfHwgIWlzVmFsaWRMb2NhdGlvbiApIHsKCQlyZXR1cm47Cgl9CgoJLy8gY2hlY2sgaWYgdGhlIGFwcCBpcyBpbiBzdGFuZCBhbG9uZSBtb2RlCglpZiAoIGF0aC5pc1N0YW5kYWxvbmUgKSB7CgkJLy8gZXhlY3V0ZSB0aGUgb25BZGQgZXZlbnQgaWYgd2UgaGF2ZW4ndCBhbHJlYWR5CgkJaWYgKCAhdGhpcy5zZXNzaW9uLmFkZGVkICkgewoJCQl0aGlzLnNlc3Npb24uYWRkZWQgPSB0cnVlOwoJCQl0aGlzLnVwZGF0ZVNlc3Npb24oKTsKCgkJCWlmICggdGhpcy5vcHRpb25zLm9uQWRkICYmIGF0aC5oYXNMb2NhbFN0b3JhZ2UgKSB7CS8vIGRvdWJsZSBjaGVjayBvbiBsb2NhbHN0b3JhZ2UgdG8gYXZvaWQgbXVsdGlwbGUgY2FsbHMgdG8gdGhlIGN1c3RvbSBldmVudAoJCQkJdGhpcy5vcHRpb25zLm9uQWRkLmNhbGwodGhpcyk7CgkJCX0KCQl9CgoJCXJldHVybjsKCX0KCgkvLyAodHJ5IHRvKSBjaGVjayBpZiB0aGUgcGFnZSBoYXMgYmVlbiBhZGRlZCB0byB0aGUgaG9tZXNjcmVlbgoJaWYgKCB0aGlzLm9wdGlvbnMuZGV0ZWN0SG9tZXNjcmVlbiApIHsKCQkvLyB0aGUgVVJMIGhhcyB0aGUgdG9rZW4sIHdlIGFyZSBsaWtlbHkgY29taW5nIGZyb20gdGhlIGhvbWVzY3JlZW4KCQlpZiAoIGF0aC5oYXNUb2tlbiApIHsKCQkJX3JlbW92ZVRva2VuKCk7CQkvLyB3ZSBkb24ndCBhY3R1YWxseSBuZWVkIHRoZSB0b2tlbiBhbnltb3JlLCB3ZSByZW1vdmUgaXQgdG8gcHJldmVudCByZWRpc3RyaWJ1dGlvbgoKCQkJLy8gdGhpcyBpcyBjYWxsZWQgdGhlIGZpcnN0IHRpbWUgdGhlIHVzZXIgb3BlbnMgdGhlIGFwcCBmcm9tIHRoZSBob21lc2NyZWVuCgkJCWlmICggIXRoaXMuc2Vzc2lvbi5hZGRlZCApIHsKCQkJCXRoaXMuc2Vzc2lvbi5hZGRlZCA9IHRydWU7CgkJCQl0aGlzLnVwZGF0ZVNlc3Npb24oKTsKCgkJCQlpZiAoIHRoaXMub3B0aW9ucy5vbkFkZCAmJiBhdGguaGFzTG9jYWxTdG9yYWdlICkgewkvLyBkb3VibGUgY2hlY2sgb24gbG9jYWxzdG9yYWdlIHRvIGF2b2lkIG11bHRpcGxlIGNhbGxzIHRvIHRoZSBjdXN0b20gZXZlbnQKCQkJCQl0aGlzLm9wdGlvbnMub25BZGQuY2FsbCh0aGlzKTsKCQkJCX0KCQkJfQoKCQkJcmV0dXJuOwoJCX0KCgkJLy8gVVJMIGRvZXNuJ3QgaGF2ZSB0aGUgdG9rZW4sIHNvIGFkZCBpdAoJCWlmICggdGhpcy5vcHRpb25zLmRldGVjdEhvbWVzY3JlZW4gPT0gJ2hhc2gnICkgewoJCQloaXN0b3J5LnJlcGxhY2VTdGF0ZSgnJywgd2luZG93LmRvY3VtZW50LnRpdGxlLCBkb2N1bWVudC5sb2NhdGlvbi5ocmVmICsgJyNhdGgnKTsKCQl9IGVsc2UgaWYgKCB0aGlzLm9wdGlvbnMuZGV0ZWN0SG9tZXNjcmVlbiA9PSAnc21hcnRVUkwnICkgewoJCQloaXN0b3J5LnJlcGxhY2VTdGF0ZSgnJywgd2luZG93LmRvY3VtZW50LnRpdGxlLCBkb2N1bWVudC5sb2NhdGlvbi5ocmVmLnJlcGxhY2UoLyhcLyk/JC8sICcvYXRoJDEnKSk7CgkJfSBlbHNlIHsKCQkJaGlzdG9yeS5yZXBsYWNlU3RhdGUoJycsIHdpbmRvdy5kb2N1bWVudC50aXRsZSwgZG9jdW1lbnQubG9jYXRpb24uaHJlZiArIChkb2N1bWVudC5sb2NhdGlvbi5zZWFyY2ggPyAnJicgOiAnPycgKSArICdhdGg9Jyk7CgkJfQoJfQoKCS8vIGNoZWNrIGlmIHRoaXMgaXMgYSByZXR1cm5pbmcgdmlzaXRvcgoJaWYgKCAhdGhpcy5zZXNzaW9uLnJldHVybmluZ1Zpc2l0b3IgKSB7CgkJdGhpcy5zZXNzaW9uLnJldHVybmluZ1Zpc2l0b3IgPSB0cnVlOwoJCXRoaXMudXBkYXRlU2Vzc2lvbigpOwoKCQkvLyB3ZSBkbyBub3Qgc2hvdyB0aGUgbWVzc2FnZSBpZiB0aGlzIGlzIHlvdXIgZmlyc3QgdmlzaXQKCQlpZiAoIHRoaXMub3B0aW9ucy5za2lwRmlyc3RWaXNpdCApIHsKCQkJcmV0dXJuOwoJCX0KCX0KCgkvLyB3ZSBkbyBubyBzaG93IHRoZSBtZXNzYWdlIGluIHByaXZhdGUgbW9kZQoJaWYgKCAhYXRoLmhhc0xvY2FsU3RvcmFnZSApIHsKCQlyZXR1cm47Cgl9CgoJLy8gYWxsIGNoZWNrcyBwYXNzZWQsIHJlYWR5IHRvIGRpc3BsYXkKCXRoaXMucmVhZHkgPSB0cnVlOwoKCWlmICggdGhpcy5vcHRpb25zLm9uSW5pdCApIHsKCQl0aGlzLm9wdGlvbnMub25Jbml0LmNhbGwodGhpcyk7Cgl9CgoJaWYgKCB0aGlzLm9wdGlvbnMuYXV0b3N0YXJ0ICkgewoJCXRoaXMuc2hvdygpOwoJfQp9OwoKYXRoLkNsYXNzLnByb3RvdHlwZSA9IHsKCS8vIGV2ZW50IHR5cGUgdG8gbWV0aG9kIGNvbnZlcnNpb24KCWV2ZW50czogewoJCWxvYWQ6ICdfZGVsYXllZFNob3cnLAoJCWVycm9yOiAnX2RlbGF5ZWRTaG93JywKCQlvcmllbnRhdGlvbmNoYW5nZTogJ3Jlc2l6ZScsCgkJcmVzaXplOiAncmVzaXplJywKCQlzY3JvbGw6ICdyZXNpemUnLAoJCWNsaWNrOiAncmVtb3ZlJywKCQl0b3VjaG1vdmU6ICdfcHJldmVudERlZmF1bHQnLAoJCXRyYW5zaXRpb25lbmQ6ICdfcmVtb3ZlRWxlbWVudHMnLAoJCXdlYmtpdFRyYW5zaXRpb25FbmQ6ICdfcmVtb3ZlRWxlbWVudHMnLAoJCU1TVHJhbnNpdGlvbkVuZDogJ19yZW1vdmVFbGVtZW50cycKCX0sCgoJaGFuZGxlRXZlbnQ6IGZ1bmN0aW9uIChlKSB7CgkJdmFyIHR5cGUgPSB0aGlzLmV2ZW50c1tlLnR5cGVdOwoJCWlmICggdHlwZSApIHsKCQkJdGhpc1t0eXBlXShlKTsKCQl9Cgl9LAoKCXNob3c6IGZ1bmN0aW9uIChmb3JjZSkgewoJCS8vIGluIGF1dG9zdGFydCBtb2RlIHdhaXQgZm9yIHRoZSBkb2N1bWVudCB0byBiZSByZWFkeQoJCWlmICggdGhpcy5vcHRpb25zLmF1dG9zdGFydCAmJiAhX0RPTVJlYWR5ICkgewoJCQlzZXRUaW1lb3V0KHRoaXMuc2hvdy5iaW5kKHRoaXMpLCA1MCk7CgkJCXJldHVybjsKCQl9CgoJCS8vIG1lc3NhZ2UgYWxyZWFkeSBvbiBzY3JlZW4KCQlpZiAoIHRoaXMuc2hvd24gKSB7CgkJCXJldHVybjsKCQl9CgoJCXZhciBub3cgPSBEYXRlLm5vdygpOwoJCXZhciBsYXN0RGlzcGxheVRpbWUgPSB0aGlzLnNlc3Npb24ubGFzdERpc3BsYXlUaW1lOwoKCQlpZiAoIGZvcmNlICE9PSB0cnVlICkgewoJCQkvLyB0aGlzIGlzIG5lZWRlZCBpZiBhdXRvc3RhcnQgaXMgZGlzYWJsZWQgYW5kIHlvdSBwcm9ncmFtbWF0aWNhbGx5IGNhbGwgdGhlIHNob3coKSBtZXRob2QKCQkJaWYgKCAhdGhpcy5yZWFkeSApIHsKCQkJCXJldHVybjsKCQkJfQoKCQkJLy8gd2Ugb2JleSB0aGUgZGlzcGxheSBwYWNlIChwcmV2ZW50IHRoZSBtZXNzYWdlIHRvIHBvcHVwIHRvbyBvZnRlbikKCQkJaWYgKCBub3cgLSBsYXN0RGlzcGxheVRpbWUgPCB0aGlzLm9wdGlvbnMuZGlzcGxheVBhY2UgKiA2MDAwMCApIHsKCQkJCXJldHVybjsKCQkJfQoKCQkJLy8gb2JleSB0aGUgbWF4aW11bSBudW1iZXIgb2YgZGlzcGxheSBjb3VudAoJCQlpZiAoIHRoaXMub3B0aW9ucy5tYXhEaXNwbGF5Q291bnQgJiYgdGhpcy5zZXNzaW9uLmRpc3BsYXlDb3VudCA+PSB0aGlzLm9wdGlvbnMubWF4RGlzcGxheUNvdW50ICkgewoJCQkJcmV0dXJuOwoJCQl9CgkJfQoKCQl0aGlzLnNob3duID0gdHJ1ZTsKCgkJLy8gaW5jcmVtZW50IHRoZSBkaXNwbGF5IGNvdW50CgkJdGhpcy5zZXNzaW9uLmxhc3REaXNwbGF5VGltZSA9IG5vdzsKCQl0aGlzLnNlc3Npb24uZGlzcGxheUNvdW50Kys7CgkJdGhpcy51cGRhdGVTZXNzaW9uKCk7CgoJCS8vIHRyeSB0byBnZXQgdGhlIGhpZ2hlc3QgcmVzb2x1dGlvbiBhcHBsaWNhdGlvbiBpY29uCgkJaWYgKCAhdGhpcy5hcHBsaWNhdGlvbkljb24gKSB7CgkJCWlmICggYXRoLk9TID09ICdpb3MnICkgewoJCQkJdGhpcy5hcHBsaWNhdGlvbkljb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdoZWFkIGxpbmtbcmVsXj1hcHBsZS10b3VjaC1pY29uXVtzaXplcz0iMTUyeDE1MiJdLGhlYWQgbGlua1tyZWxePWFwcGxlLXRvdWNoLWljb25dW3NpemVzPSIxNDR4MTQ0Il0saGVhZCBsaW5rW3JlbF49YXBwbGUtdG91Y2gtaWNvbl1bc2l6ZXM9IjEyMHgxMjAiXSxoZWFkIGxpbmtbcmVsXj1hcHBsZS10b3VjaC1pY29uXVtzaXplcz0iMTE0eDExNCJdLGhlYWQgbGlua1tyZWxePWFwcGxlLXRvdWNoLWljb25dJyk7CgkJCX0gZWxzZSB7CgkJCQl0aGlzLmFwcGxpY2F0aW9uSWNvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2hlYWQgbGlua1tyZWxePSJzaG9ydGN1dCBpY29uIl1bc2l6ZXM9IjE5NngxOTYiXSxoZWFkIGxpbmtbcmVsXj1hcHBsZS10b3VjaC1pY29uXScpOwoJCQl9CgkJfQoKCQl2YXIgbWVzc2FnZSA9ICcnOwoKCQlpZiAoIHRoaXMub3B0aW9ucy5tZXNzYWdlIGluIGF0aC5pbnRsICkgewkJLy8geW91IGNhbiBmb3JjZSB0aGUgbG9jYWxlCgkJCW1lc3NhZ2UgPSBhdGguaW50bFt0aGlzLm9wdGlvbnMubWVzc2FnZV0ubWVzc2FnZS5yZXBsYWNlKCclYWN0aW9uJywgYXRoLmludGxbdGhpcy5vcHRpb25zLm1lc3NhZ2VdLmFjdGlvblthdGguT1NdKTsKCQl9IGVsc2UgaWYgKCB0aGlzLm9wdGlvbnMubWVzc2FnZSAhPT0gJycgKSB7CQkvLyBvciB1c2UgYSBjdXN0b20gbWVzc2FnZQoJCQltZXNzYWdlID0gdGhpcy5vcHRpb25zLm1lc3NhZ2U7CgkJfSBlbHNlIHsJCQkJCQkJCQkJLy8gb3RoZXJ3aXNlIHdlIHVzZSBvdXIgbWVzc2FnZQoJCQltZXNzYWdlID0gYXRoLmludGxbYXRoLmxhbmd1YWdlXS5tZXNzYWdlLnJlcGxhY2UoJyVhY3Rpb24nLCBhdGguaW50bFthdGgubGFuZ3VhZ2VdLmFjdGlvblthdGguT1NdKTsKCQl9CgoJCS8vIGFkZCB0aGUgYWN0aW9uIGljb24KCQltZXNzYWdlID0gJzxwPicgKyBtZXNzYWdlLnJlcGxhY2UoJyVpY29uJywgJzxzcGFuIGNsYXNzPSJhdGgtYWN0aW9uLWljb24iPmljb248L3NwYW4+JykgKyAnPC9wPic7CgoJCS8vIGNyZWF0ZSB0aGUgbWVzc2FnZSBjb250YWluZXIKCQl0aGlzLnZpZXdwb3J0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CgkJdGhpcy52aWV3cG9ydC5jbGFzc05hbWUgPSAnYXRoLXZpZXdwb3J0JzsKCQlpZiAoIHRoaXMub3B0aW9ucy5tb2RhbCApIHsKCQkJdGhpcy52aWV3cG9ydC5jbGFzc05hbWUgKz0gJyBhdGgtbW9kYWwnOwoJCX0KCQlpZiAoIHRoaXMub3B0aW9ucy5tYW5kYXRvcnkgKSB7CgkJCXRoaXMudmlld3BvcnQuY2xhc3NOYW1lICs9ICcgYXRoLW1hbmRhdG9yeSc7CgkJfQoJCXRoaXMudmlld3BvcnQuc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnOwoKCQkvLyBjcmVhdGUgdGhlIGFjdHVhbCBtZXNzYWdlIGVsZW1lbnQKCQl0aGlzLmVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKCQl0aGlzLmVsZW1lbnQuY2xhc3NOYW1lID0gJ2F0aC1jb250YWluZXIgYXRoLScgKyBhdGguT1MgKyAnIGF0aC0nICsgYXRoLk9TICsgKGF0aC5PU1ZlcnNpb24gKyAnJykuc3Vic3RyKDAsMSkgKyAnIGF0aC0nICsgKGF0aC5pc1RhYmxldCA/ICd0YWJsZXQnIDogJ3Bob25lJyk7CgkJdGhpcy5lbGVtZW50LnN0eWxlLmNzc1RleHQgPSAnLXdlYmtpdC10cmFuc2l0aW9uLXByb3BlcnR5Oi13ZWJraXQtdHJhbnNmb3JtLG9wYWNpdHk7LXdlYmtpdC10cmFuc2l0aW9uLWR1cmF0aW9uOjA7LXdlYmtpdC10cmFuc2Zvcm06dHJhbnNsYXRlM2QoMCwwLDApO3RyYW5zaXRpb24tcHJvcGVydHk6dHJhbnNmb3JtLG9wYWNpdHk7dHJhbnNpdGlvbi1kdXJhdGlvbjowO3RyYW5zZm9ybTp0cmFuc2xhdGUzZCgwLDAsMCk7LXdlYmtpdC10cmFuc2l0aW9uLXRpbWluZy1mdW5jdGlvbjplYXNlLW91dCc7CgkJdGhpcy5lbGVtZW50LnN0eWxlLndlYmtpdFRyYW5zZm9ybSA9ICd0cmFuc2xhdGUzZCgwLC0nICsgd2luZG93LmlubmVySGVpZ2h0ICsgJ3B4LDApJzsKCQl0aGlzLmVsZW1lbnQuc3R5bGUud2Via2l0VHJhbnNpdGlvbkR1cmF0aW9uID0gJzBzJzsKCgkJLy8gYWRkIHRoZSBhcHBsaWNhdGlvbiBpY29uCgkJaWYgKCB0aGlzLm9wdGlvbnMuaWNvbiAmJiB0aGlzLmFwcGxpY2F0aW9uSWNvbiApIHsKCQkJdGhpcy5lbGVtZW50LmNsYXNzTmFtZSArPSAnIGF0aC1pY29uJzsKCQkJdGhpcy5pbWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTsKCQkJdGhpcy5pbWcuY2xhc3NOYW1lID0gJ2F0aC1hcHBsaWNhdGlvbi1pY29uJzsKCQkJdGhpcy5pbWcuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsIHRoaXMsIGZhbHNlKTsKCQkJdGhpcy5pbWcuYWRkRXZlbnRMaXN0ZW5lcignZXJyb3InLCB0aGlzLCBmYWxzZSk7CgoJCQl0aGlzLmltZy5zcmMgPSB0aGlzLmFwcGxpY2F0aW9uSWNvbi5ocmVmOwoJCQl0aGlzLmVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy5pbWcpOwoJCX0KCgkJdGhpcy5lbGVtZW50LmlubmVySFRNTCArPSBtZXNzYWdlOwoKCQkvLyB3ZSBhcmUgbm90IHJlYWR5IHRvIHNob3csIHBsYWNlIHRoZSBtZXNzYWdlIG91dCBvZiBzaWdodAoJCXRoaXMudmlld3BvcnQuc3R5bGUubGVmdCA9ICctOTk5OTllbSc7CgoJCS8vIGF0dGFjaCBhbGwgZWxlbWVudHMgdG8gdGhlIERPTQoJCXRoaXMudmlld3BvcnQuYXBwZW5kQ2hpbGQodGhpcy5lbGVtZW50KTsKCQl0aGlzLmNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzLnZpZXdwb3J0KTsKCgkJLy8gaWYgd2UgZG9uJ3QgaGF2ZSB0byB3YWl0IGZvciBhbiBpbWFnZSB0byBsb2FkLCBzaG93IHRoZSBtZXNzYWdlIHJpZ2h0IGF3YXkKCQlpZiAoICF0aGlzLmltZyApIHsKCQkJdGhpcy5fZGVsYXllZFNob3coKTsKCQl9Cgl9LAoKCV9kZWxheWVkU2hvdzogZnVuY3Rpb24gKGUpIHsKCQlzZXRUaW1lb3V0KHRoaXMuX3Nob3cuYmluZCh0aGlzKSwgdGhpcy5vcHRpb25zLnN0YXJ0RGVsYXkgKiAxMDAwICsgNTAwKTsKCX0sCgoJX3Nob3c6IGZ1bmN0aW9uICgpIHsKCQl2YXIgdGhhdCA9IHRoaXM7CgoJCS8vIHVwZGF0ZSB0aGUgdmlld3BvcnQgc2l6ZSBhbmQgb3JpZW50YXRpb24KCQl0aGlzLnVwZGF0ZVZpZXdwb3J0KCk7CgoJCS8vIHJlcG9zaXRpb24vcmVzaXplIHRoZSBtZXNzYWdlIG9uIG9yaWVudGF0aW9uIGNoYW5nZQoJCXdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCB0aGlzLCBmYWxzZSk7CgkJd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIHRoaXMsIGZhbHNlKTsKCQl3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignb3JpZW50YXRpb25jaGFuZ2UnLCB0aGlzLCBmYWxzZSk7CgoJCWlmICggdGhpcy5vcHRpb25zLm1vZGFsICkgewoJCQkvLyBsb2NrIGFueSBvdGhlciBpbnRlcmFjdGlvbgoJCQlkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCB0aGlzLCB0cnVlKTsKCQl9CgoJCS8vIEVuYWJsZSBjbG9zaW5nIGFmdGVyIDEgc2Vjb25kCgkJaWYgKCAhdGhpcy5vcHRpb25zLm1hbmRhdG9yeSApIHsKCQkJc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CgkJCQl0aGF0LmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGF0LCB0cnVlKTsKCQkJfSwgMTAwMCk7CgkJfQoKCQkvLyBraWNrIHRoZSBhbmltYXRpb24KCQlzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKCQkJdGhhdC5lbGVtZW50LnN0eWxlLndlYmtpdFRyYW5zZm9ybSA9ICd0cmFuc2xhdGUzZCgwLDAsMCknOwoJCQl0aGF0LmVsZW1lbnQuc3R5bGUud2Via2l0VHJhbnNpdGlvbkR1cmF0aW9uID0gJzEuMnMnOwoJCX0sIDApOwoKCQkvLyBzZXQgdGhlIGRlc3Ryb3kgdGltZXIKCQlpZiAoIHRoaXMub3B0aW9ucy5saWZlc3BhbiApIHsKCQkJdGhpcy5yZW1vdmVUaW1lciA9IHNldFRpbWVvdXQodGhpcy5yZW1vdmUuYmluZCh0aGlzKSwgdGhpcy5vcHRpb25zLmxpZmVzcGFuICogMTAwMCk7CgkJfQoKCQkvLyBmaXJlIHRoZSBjdXN0b20gb25TaG93IGV2ZW50CgkJaWYgKCB0aGlzLm9wdGlvbnMub25TaG93ICkgewoJCQl0aGlzLm9wdGlvbnMub25TaG93LmNhbGwodGhpcyk7CgkJfQoJfSwKCglyZW1vdmU6IGZ1bmN0aW9uICgpIHsKCQljbGVhclRpbWVvdXQodGhpcy5yZW1vdmVUaW1lcik7CgoJCS8vIGNsZWFyIHVwIHRoZSBldmVudCBsaXN0ZW5lcnMKCQlpZiAoIHRoaXMuaW1nICkgewoJCQl0aGlzLmltZy5yZW1vdmVFdmVudExpc3RlbmVyKCdsb2FkJywgdGhpcywgZmFsc2UpOwoJCQl0aGlzLmltZy5yZW1vdmVFdmVudExpc3RlbmVyKCdlcnJvcicsIHRoaXMsIGZhbHNlKTsKCQl9CgoJCXdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdyZXNpemUnLCB0aGlzLCBmYWxzZSk7CgkJd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIHRoaXMsIGZhbHNlKTsKCQl3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignb3JpZW50YXRpb25jaGFuZ2UnLCB0aGlzLCBmYWxzZSk7CgkJZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigndG91Y2htb3ZlJywgdGhpcywgdHJ1ZSk7CgkJdGhpcy5lbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcywgdHJ1ZSk7CgoJCS8vIHJlbW92ZSB0aGUgbWVzc2FnZSBlbGVtZW50IG9uIHRyYW5zaXRpb24gZW5kCgkJdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3RyYW5zaXRpb25lbmQnLCB0aGlzLCBmYWxzZSk7CgkJdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3dlYmtpdFRyYW5zaXRpb25FbmQnLCB0aGlzLCBmYWxzZSk7CgkJdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ01TVHJhbnNpdGlvbkVuZCcsIHRoaXMsIGZhbHNlKTsKCgkJLy8gc3RhcnQgdGhlIGZhZGUgb3V0IGFuaW1hdGlvbgoJCXRoaXMuZWxlbWVudC5zdHlsZS53ZWJraXRUcmFuc2l0aW9uRHVyYXRpb24gPSAnMC4zcyc7CgkJdGhpcy5lbGVtZW50LnN0eWxlLm9wYWNpdHkgPSAnMCc7Cgl9LAoKCV9yZW1vdmVFbGVtZW50czogZnVuY3Rpb24gKCkgewoJCXRoaXMuZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCd0cmFuc2l0aW9uZW5kJywgdGhpcywgZmFsc2UpOwoJCXRoaXMuZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCd3ZWJraXRUcmFuc2l0aW9uRW5kJywgdGhpcywgZmFsc2UpOwoJCXRoaXMuZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdNU1RyYW5zaXRpb25FbmQnLCB0aGlzLCBmYWxzZSk7CgoJCS8vIHJlbW92ZSB0aGUgbWVzc2FnZSBmcm9tIHRoZSBET00KCQl0aGlzLmNvbnRhaW5lci5yZW1vdmVDaGlsZCh0aGlzLnZpZXdwb3J0KTsKCgkJdGhpcy5zaG93biA9IGZhbHNlOwoKCQkvLyBmaXJlIHRoZSBjdXN0b20gb25SZW1vdmUgZXZlbnQKCQlpZiAoIHRoaXMub3B0aW9ucy5vblJlbW92ZSApIHsKCQkJdGhpcy5vcHRpb25zLm9uUmVtb3ZlLmNhbGwodGhpcyk7CgkJfQoJfSwKCgl1cGRhdGVWaWV3cG9ydDogZnVuY3Rpb24gKCkgewoJCWlmICggIXRoaXMuc2hvd24gKSB7CgkJCXJldHVybjsKCQl9CgoJCXRoaXMudmlld3BvcnQuc3R5bGUud2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aCArICdweCc7CgkJdGhpcy52aWV3cG9ydC5zdHlsZS5oZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQgKyAncHgnOwoJCXRoaXMudmlld3BvcnQuc3R5bGUubGVmdCA9IHdpbmRvdy5zY3JvbGxYICsgJ3B4JzsKCQl0aGlzLnZpZXdwb3J0LnN0eWxlLnRvcCA9IHdpbmRvdy5zY3JvbGxZICsgJ3B4JzsKCgkJdmFyIGNsaWVudFdpZHRoID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoOwoKCQl0aGlzLm9yaWVudGF0aW9uID0gY2xpZW50V2lkdGggPiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0ID8gJ2xhbmRzY2FwZScgOiAncG9ydHJhaXQnOwoKCQl2YXIgc2NyZWVuV2lkdGggPSBhdGguT1MgPT0gJ2lvcycgPyB0aGlzLm9yaWVudGF0aW9uID09ICdwb3J0cmFpdCcgPyBzY3JlZW4ud2lkdGggOiBzY3JlZW4uaGVpZ2h0IDogc2NyZWVuLndpZHRoOwoJCXRoaXMuc2NhbGUgPSBzY3JlZW4ud2lkdGggPiBjbGllbnRXaWR0aCA/IDEgOiBzY3JlZW5XaWR0aCAvIHdpbmRvdy5pbm5lcldpZHRoOwoKCQl0aGlzLmVsZW1lbnQuc3R5bGUuZm9udFNpemUgPSB0aGlzLm9wdGlvbnMuZm9udFNpemUgLyB0aGlzLnNjYWxlICsgJ3B4JzsKCX0sCgoJcmVzaXplOiBmdW5jdGlvbiAoKSB7CgkJY2xlYXJUaW1lb3V0KHRoaXMucmVzaXplVGltZXIpOwoJCXRoaXMucmVzaXplVGltZXIgPSBzZXRUaW1lb3V0KHRoaXMudXBkYXRlVmlld3BvcnQuYmluZCh0aGlzKSwgMTAwKTsKCX0sCgoJdXBkYXRlU2Vzc2lvbjogZnVuY3Rpb24gKCkgewoJCWlmICggYXRoLmhhc0xvY2FsU3RvcmFnZSA9PT0gZmFsc2UgKSB7CgkJCXJldHVybjsKCQl9CgoJCWxvY2FsU3RvcmFnZS5zZXRJdGVtKHRoaXMub3B0aW9ucy5hcHBJRCwgSlNPTi5zdHJpbmdpZnkodGhpcy5zZXNzaW9uKSk7Cgl9LAoKCWNsZWFyU2Vzc2lvbjogZnVuY3Rpb24gKCkgewoJCXRoaXMuc2Vzc2lvbiA9IF9kZWZhdWx0U2Vzc2lvbjsKCQl0aGlzLnVwZGF0ZVNlc3Npb24oKTsKCX0sCgoJb3B0T3V0OiBmdW5jdGlvbiAoKSB7CgkJdGhpcy5zZXNzaW9uLm9wdGVkb3V0ID0gdHJ1ZTsKCQl0aGlzLnVwZGF0ZVNlc3Npb24oKTsKCX0sCgoJb3B0SW46IGZ1bmN0aW9uICgpIHsKCQl0aGlzLnNlc3Npb24ub3B0ZWRvdXQgPSBmYWxzZTsKCQl0aGlzLnVwZGF0ZVNlc3Npb24oKTsKCX0sCgoJY2xlYXJEaXNwbGF5Q291bnQ6IGZ1bmN0aW9uICgpIHsKCQl0aGlzLnNlc3Npb24uZGlzcGxheUNvdW50ID0gMDsKCQl0aGlzLnVwZGF0ZVNlc3Npb24oKTsKCX0sCgoJX3ByZXZlbnREZWZhdWx0OiBmdW5jdGlvbiAoZSkgewoJCWUucHJldmVudERlZmF1bHQoKTsKCQllLnN0b3BQcm9wYWdhdGlvbigpOwoJfQp9OwoKLy8gdXRpbGl0eQpmdW5jdGlvbiBfZXh0ZW5kICh0YXJnZXQsIG9iaikgewoJZm9yICggdmFyIGkgaW4gb2JqICkgewoJCXRhcmdldFtpXSA9IG9ialtpXTsKCX0KCglyZXR1cm4gdGFyZ2V0Owp9CgpmdW5jdGlvbiBfcmVtb3ZlVG9rZW4gKCkgewoJaWYgKCBkb2N1bWVudC5sb2NhdGlvbi5oYXNoID09ICcjYXRoJyApIHsKCQloaXN0b3J5LnJlcGxhY2VTdGF0ZSgnJywgd2luZG93LmRvY3VtZW50LnRpdGxlLCBkb2N1bWVudC5sb2NhdGlvbi5ocmVmLnNwbGl0KCcjJylbMF0pOwoJfQoKCWlmICggX3JlU21hcnRVUkwudGVzdChkb2N1bWVudC5sb2NhdGlvbi5ocmVmKSApIHsKCQloaXN0b3J5LnJlcGxhY2VTdGF0ZSgnJywgd2luZG93LmRvY3VtZW50LnRpdGxlLCBkb2N1bWVudC5sb2NhdGlvbi5ocmVmLnJlcGxhY2UoX3JlU21hcnRVUkwsICckMScpKTsKCX0KCglpZiAoIF9yZVF1ZXJ5U3RyaW5nLnRlc3QoZG9jdW1lbnQubG9jYXRpb24uc2VhcmNoKSApIHsKCQloaXN0b3J5LnJlcGxhY2VTdGF0ZSgnJywgd2luZG93LmRvY3VtZW50LnRpdGxlLCBkb2N1bWVudC5sb2NhdGlvbi5ocmVmLnJlcGxhY2UoX3JlUXVlcnlTdHJpbmcsICckMicpKTsKCX0KfQoKLy8gZXhwb3NlIHRvIHRoZSB3b3JsZAp3aW5kb3cuYWRkVG9Ib21lc2NyZWVuID0gYXRoOwoKfSkod2luZG93LCBkb2N1bWVudCk7Cg==",
                "body": "LyogQWRkIHRvIEhvbWVzY3JlZW4gdjMuMC44IH4gKGMpIDIwMTQgTWF0dGVvIFNwaW5lbGxpIH4gQGxpY2Vuc2U6IGh0dHA6Ly9jdWJpcS5vcmcvbGljZW5zZSAqLwooZnVuY3Rpb24gKHdpbmRvdywgZG9jdW1lbnQpIHsKLyoKICAgICAgIF8gICBfIF9fX19fICAgICBfX19fXwogX19fIF98IHxffCB8XyAgIF98X19ffCAgfCAgfF9fXyBfX19fXyBfX18gX19fIF9fXyBfX18gX19fIF9fXyBfX18KfCAuJ3wgLiB8IC4gfCB8IHwgfCAuIHwgICAgIHwgLiB8ICAgICB8IC1ffF8gLXwgIF98ICBffCAtX3wgLV98ICAgfAp8X18sfF9fX3xfX198IHxffCB8X19ffF9ffF9ffF9fX3xffF98X3xfX198X19ffF9fX3xffCB8X19ffF9fX3xffF98CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ5IE1hdHRlbyBTcGluZWxsaSB+IGh0dHA6Ly9jdWJpcS5vcmcKKi8KCi8vIENoZWNrIGlmIGRvY3VtZW50IGlzIGxvYWRlZCwgbmVlZGVkIGJ5IGF1dG9zdGFydAp2YXIgX0RPTVJlYWR5ID0gZmFsc2U7CmlmICggZG9jdW1lbnQucmVhZHlTdGF0ZSA9PT0gJ2NvbXBsZXRlJyApIHsKCV9ET01SZWFkeSA9IHRydWU7Cn0gZWxzZSB7Cgl3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsIGxvYWRlZCwgZmFsc2UpOwp9CgpmdW5jdGlvbiBsb2FkZWQgKCkgewoJd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2xvYWQnLCBsb2FkZWQsIGZhbHNlKTsKCV9ET01SZWFkeSA9IHRydWU7Cn0KCi8vIHJlZ2V4IHVzZWQgdG8gZGV0ZWN0IGlmIGFwcCBoYXMgYmVlbiBhZGRlZCB0byB0aGUgaG9tZXNjcmVlbgp2YXIgX3JlU21hcnRVUkwgPSAvXC9hdGgoXC8pPyQvOwp2YXIgX3JlUXVlcnlTdHJpbmcgPSAvKFtcPyZdYXRoPVteJl0qJHwmYXRoPVteJl0qKCYpKS87CgovLyBzaW5nbGV0b24KdmFyIF9pbnN0YW5jZTsKZnVuY3Rpb24gYXRoIChvcHRpb25zKSB7CglfaW5zdGFuY2UgPSBfaW5zdGFuY2UgfHwgbmV3IGF0aC5DbGFzcyhvcHRpb25zKTsKCglyZXR1cm4gX2luc3RhbmNlOwp9CgovLyBtZXNzYWdlIGluIGFsbCBzdXBwb3J0ZWQgbGFuZ3VhZ2VzCmF0aC5pbnRsID0gewoJZGVfZGU6IHsKCQltZXNzYWdlOiAnVW0gZGllc2UgV2ViLUFwcCB6dW0gSG9tZS1CaWxkc2NoaXJtIGhpbnp1enVmw7xnZW4sIHRpcHBlbiBTaWUgYXVmICVpY29uIHVuZCBkYW5uIDxzdHJvbmc+JWFjdGlvbjwvc3Ryb25nPi4nLAoJCWFjdGlvbjogeyBpb3M6ICdadW0gSG9tZS1CaWxkc2NoaXJtJywgYW5kcm9pZDogJ1p1bSBTdGFydGJpbGRzY2hpcm0gaGluenVmw7xnZW4nLCB3aW5kb3dzOiAnQXVmIFN0YXJ0c2VpdGUnIH0KCX0sCgoJZW5fdXM6IHsKCQltZXNzYWdlOiAnVG8gYWRkIHRoaXMgd2ViIGFwcCB0byB0aGUgaG9tZSBzY3JlZW46IHRhcCAlaWNvbiBhbmQgdGhlbiA8c3Ryb25nPiVhY3Rpb248L3N0cm9uZz4uJywKCQlhY3Rpb246IHsgaW9zOiAnQWRkIHRvIEhvbWUgU2NyZWVuJywgYW5kcm9pZDogJ0FkZCB0byBob21lc2NyZWVuJywgd2luZG93czogJ3BpbiB0byBzdGFydCcgfQoJfSwKCgllc19lczogewoJCW1lc3NhZ2U6ICdQYXJhIGHDsWFkaXIgZXN0YSBhcGxpY2FjacOzbiB3ZWIgYSBsYSBwYW50YWxsYSBkZSBpbmljaW86IHB1bHNhICVpY29uIHkgc2VsZWNjaW9uYSA8c3Ryb25nPiVhY3Rpb248L3N0cm9uZz4uJywKCQlhY3Rpb246IHsgaW9zOiAnQcOxYWRpciBhIHBhbnRhbGxhIGRlIGluaWNpbycsIGFuZHJvaWQ6ICdBw7FhZGlyIGEgcGFudGFsbGEgZGUgaW5pY2lvJywgd2luZG93czogJ0HDsWFkaXIgYSBpbmljaW8nIH0KCX0sCgoJZnJfZnI6IHsKCQltZXNzYWdlOiAnUG91ciBham91dGVyIGNldHRlIGFwcGxpY2F0aW9uIHdlYiBzdXIgbFwnw6ljcmFuIGRcJ2FjY3VlaWwgOiBBcHB1eWV6ICVpY29uIGV0IHPDqWxlY3Rpb25uZXogPHN0cm9uZz4lYWN0aW9uPC9zdHJvbmc+LicsCgkJYWN0aW9uOiB7IGlvczogJ0Fqb3V0ZXIgc3VyIGxcJ8OpY3JhbiBkXCdhY2N1ZWlsJywgYW5kcm9pZDogJ0Fqb3V0ZXIgw6AgbFwnw6ljcmFuIGRcJ2FjY3VlaWwnLCB3aW5kb3dzOiAnw4lwaW5nbGVyIMOgIGxcJ8OpY3JhbiBkXCdhY2N1ZWlsJyB9Cgl9LAoKCWl0X2l0OiB7CgkJbWVzc2FnZTogJ1BlciBBZ2dpdW5nZXJlIHF1ZXN0YSB3ZWIgYXBwIGFsbGEgc2NoZXJtYXRhIGluaXppYWxlOiBwcmVtaSAlaWNvbiBlIHBvaSA8c3Ryb25nPiVhY3Rpb248L3N0cm9uZz4uJywKCQlhY3Rpb246IHsgaW9zOiAnQWdnaXVuZ2kgYSBIb21lJywgYW5kcm9pZDogJ0FnZ2l1bmdpIGFsbGEgaG9tZXNjcmVlbicsIHdpbmRvd3M6ICdhZ2dpdW5naSBhIHN0YXJ0JyB9Cgl9LAoKCW5iX25vOiB7CgkJbWVzc2FnZTogJ0ZvciDDpSBpbnN0YWxsZXJlIGRlbm5lIGFwcGVuIHDDpSBoamVtLXNramVybWVuOiB0cnlrayBww6UgJWljb24gb2cgZGVyZXR0ZXIgPHN0cm9uZz4lYWN0aW9uPC9zdHJvbmc+LicsCgkJYWN0aW9uOiB7IGlvczogJ0xlZ2cgdGlsIHDDpSBIamVtLXNramVybScsIGFuZHJvaWQ6ICdMZWdnIHRpbCBww6Ugc3RhcnRzaWRlbicsIHdpbmRvd3M6ICdmZXN0IHRpbCBzdGFydCcgfQoJfSwKCglubF9ubDogewoJCW1lc3NhZ2U6ICdPbSBkZXplIHdlYmFwcCBvcCBqZSB0ZWxlZm9vbiB0ZSBpbnN0YWxsZXJlbiwga2xpayBvcCAlaWNvbiBlbiBkYW4gPHN0cm9uZz4lYWN0aW9uPC9zdHJvbmc+LicsCgkJYWN0aW9uOiB7IGlvczogJ1pldCBpbiBiZWdpbnNjaGVybScsIGFuZHJvaWQ6ICdUb2V2b2VnZW4gYWFuIHN0YXJ0c2NoZXJtJywgd2luZG93czogJ0FhbiBzdGFydHNjaGVybSB2YXN0bWFrZW4nIH0KCX0sCgoJc3Zfc2U6IHsKCQltZXNzYWdlOiAnRsO2ciBhdHQgbMOkZ2dhIHRpbGwgZGVubmEgd2ViYmFwcGxpa2F0aW9uIHDDpSBoZW1za8Okcm1lbjogdHJ5Y2sgcMOlICVpY29uIG9jaCBkw6RyZWZ0ZXIgPHN0cm9uZz4lYWN0aW9uPC9zdHJvbmc+LicsCgkJYWN0aW9uOiB7IGlvczogJ0zDpGdnIHRpbGwgcMOlIGhlbXNrw6RybWVuJywgYW5kcm9pZDogJ0zDpGdnIHRpbCBww6Ugc3RhcnRza8Okcm1lbicsIHdpbmRvd3M6ICdmw6RzdCBww6Ugc3RhcnRza8Okcm1lbicgfQoJfSwKCgl6aF9jbjogewoJCW1lc3NhZ2U6ICflpoLopoHmiorlupTnlKjnqIvlvI/liqDoh7PkuLvlsY/luZUs6K+354K55Ye7JWljb24sIOeEtuWQjjxzdHJvbmc+JWFjdGlvbjwvc3Ryb25nPicsCgkJYWN0aW9uOiB7IGlvczogJ+WKoOiHs+S4u+Wxj+W5lScsIGFuZHJvaWQ6ICfliqDoh7PkuLvlsY/luZUnLCB3aW5kb3dzOiAn5oyJ5L2P5ZCv5YqoJyB9Cgl9LAoKCXpoX3R3OiB7CgkJbWVzc2FnZTogJ+WmguimgeaKiuaHieeUqOeoi+W8j+WKoOiHs+S4u+Wxj+W5lSwg6KuL6bue5pOKJWljb24sIOeEtuW+jDxzdHJvbmc+JWFjdGlvbjwvc3Ryb25nPi4nLAoJCWFjdGlvbjogeyBpb3M6ICfliqDoh7PkuLvlsY/luZUnLCBhbmRyb2lkOiAn5Yqg6Iez5Li75bGP5bmVJywgd2luZG93czogJ+aMieS9j+WVn+WLlScgfQoJfQp9OwoKLy8gQWRkIDIgY2hhcmFjdGVycyBsYW5ndWFnZSBzdXBwb3J0IChBbmRyb2lkIG1vc3RseSkKZm9yICggdmFyIGxhbmcgaW4gYXRoLmludGwgKSB7CglhdGguaW50bFtsYW5nLnN1YnN0cigwLCAyKV0gPSBhdGguaW50bFtsYW5nXTsKfQoKLy8gZGVmYXVsdCBvcHRpb25zCmF0aC5kZWZhdWx0cyA9IHsKCWFwcElEOiAnb3JnLmN1YmlxLmFkZHRvaG9tZScsCQkvLyBsb2NhbCBzdG9yYWdlIG5hbWUgKG5vIG5lZWQgdG8gY2hhbmdlKQoJZm9udFNpemU6IDE1LAkJCQkvLyBiYXNlIGZvbnQgc2l6ZSwgdXNlZCB0byBwcm9wZXJseSByZXNpemUgdGhlIHBvcHVwIGJhc2VkIG9uIHZpZXdwb3J0IHNjYWxlIGZhY3RvcgoJZGVidWc6IGZhbHNlLAkJCQkvLyBvdmVycmlkZSBicm93c2VyIGNoZWNrcwoJbW9kYWw6IGZhbHNlLAkJCQkvLyBwcmV2ZW50IGZ1cnRoZXIgYWN0aW9ucyB1bnRpbCB0aGUgbWVzc2FnZSBpcyBjbG9zZWQKCW1hbmRhdG9yeTogZmFsc2UsCQkJLy8geW91IGNhbid0IHByb2NlZWQgaWYgeW91IGRvbid0IGFkZCB0aGUgYXBwIHRvIHRoZSBob21lc2NyZWVuCglhdXRvc3RhcnQ6IHRydWUsCQkJLy8gc2hvdyB0aGUgbWVzc2FnZSBhdXRvbWF0aWNhbGx5Cglza2lwRmlyc3RWaXNpdDogZmFsc2UsCQkvLyBzaG93IG9ubHkgdG8gcmV0dXJuaW5nIHZpc2l0b3JzIChpZTogc2tpcCB0aGUgZmlyc3QgdGltZSB5b3UgdmlzaXQpCglzdGFydERlbGF5OiAxLAkJCQkvLyBkaXNwbGF5IHRoZSBtZXNzYWdlIGFmdGVyIHRoYXQgbWFueSBzZWNvbmRzIGZyb20gcGFnZSBsb2FkCglsaWZlc3BhbjogMTUsCQkJCS8vIGxpZmUgb2YgdGhlIG1lc3NhZ2UgaW4gc2Vjb25kcwoJZGlzcGxheVBhY2U6IDE0NDAsCQkJLy8gbWludXRlcyBiZWZvcmUgdGhlIG1lc3NhZ2UgaXMgc2hvd24gYWdhaW4gKDA6IGRpc3BsYXkgZXZlcnkgdGltZSwgZGVmYXVsdCAyNCBob3VycykKCW1heERpc3BsYXlDb3VudDogMCwJCQkvLyBhYnNvbHV0ZSBtYXhpbXVtIG51bWJlciBvZiB0aW1lcyB0aGUgbWVzc2FnZSB3aWxsIGJlIHNob3duIHRvIHRoZSB1c2VyICgwOiBubyBsaW1pdCkKCWljb246IHRydWUsCQkJCQkvLyBhZGQgdG91Y2ggaWNvbiB0byB0aGUgbWVzc2FnZQoJbWVzc2FnZTogJycsCQkJCS8vIHRoZSBtZXNzYWdlIGNhbiBiZSBjdXN0b21pemVkCgl2YWxpZExvY2F0aW9uOiBbXSwJCQkvLyBsaXN0IG9mIHBhZ2VzIHdoZXJlIHRoZSBtZXNzYWdlIHdpbGwgYmUgc2hvd24gKGFycmF5IG9mIHJlZ2V4ZXMpCglvbkluaXQ6IG51bGwsCQkJCS8vIGV4ZWN1dGVkIG9uIGluc3RhbmNlIGNyZWF0aW9uCglvblNob3c6IG51bGwsCQkJCS8vIGV4ZWN1dGVkIHdoZW4gdGhlIG1lc3NhZ2UgaXMgc2hvd24KCW9uUmVtb3ZlOiBudWxsLAkJCQkvLyBleGVjdXRlZCB3aGVuIHRoZSBtZXNzYWdlIGlzIHJlbW92ZWQKCW9uQWRkOiBudWxsLAkJCQkvLyB3aGVuIHRoZSBhcHBsaWNhdGlvbiBpcyBsYXVuY2hlZCB0aGUgZmlyc3QgdGltZSBmcm9tIHRoZSBob21lc2NyZWVuIChndWVzc3RpbWF0ZSkKCW9uUHJpdmF0ZTogbnVsbCwJCQkvLyBleGVjdXRlZCBpZiB1c2VyIGlzIGluIHByaXZhdGUgbW9kZQoJZGV0ZWN0SG9tZXNjcmVlbjogZmFsc2UJCS8vIHRyeSB0byBkZXRlY3QgaWYgdGhlIHNpdGUgaGFzIGJlZW4gYWRkZWQgdG8gdGhlIGhvbWVzY3JlZW4gKGZhbHNlIHwgdHJ1ZSB8ICdoYXNoJyB8ICdxdWVyeVN0cmluZycgfCAnc21hcnRVUkwnKQp9OwoKLy8gYnJvd3NlciBpbmZvIGFuZCBjYXBhYmlsaXR5CnZhciBfdWEgPSB3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudDsKCnZhciBfbmF2ID0gd2luZG93Lm5hdmlnYXRvcjsKX2V4dGVuZChhdGgsIHsKCWhhc1Rva2VuOiBkb2N1bWVudC5sb2NhdGlvbi5oYXNoID09ICcjYXRoJyB8fCBfcmVTbWFydFVSTC50ZXN0KGRvY3VtZW50LmxvY2F0aW9uLmhyZWYpIHx8IF9yZVF1ZXJ5U3RyaW5nLnRlc3QoZG9jdW1lbnQubG9jYXRpb24uc2VhcmNoKSwKCWlzUmV0aW5hOiB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyAmJiB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyA+IDEsCglpc0lEZXZpY2U6ICgvaXBob25lfGlwb2R8aXBhZC9pKS50ZXN0KF91YSksCglpc01vYmlsZUNocm9tZTogX3VhLmluZGV4T2YoJ0FuZHJvaWQnKSA+IC0xICYmICgvQ2hyb21lXC9bLjAtOV0qLykudGVzdChfdWEpLAoJaXNNb2JpbGVJRTogX3VhLmluZGV4T2YoJ1dpbmRvd3MgUGhvbmUnKSA+IC0xLAoJbGFuZ3VhZ2U6IF9uYXYubGFuZ3VhZ2UgJiYgX25hdi5sYW5ndWFnZS50b0xvd2VyQ2FzZSgpLnJlcGxhY2UoJy0nLCAnXycpIHx8ICcnCn0pOwoKLy8gZmFsbHMgYmFjayB0byBlbl91cyBpZiBsYW5ndWFnZSBpcyB1bnN1cHBvcnRlZAphdGgubGFuZ3VhZ2UgPSBhdGgubGFuZ3VhZ2UgJiYgYXRoLmxhbmd1YWdlIGluIGF0aC5pbnRsID8gYXRoLmxhbmd1YWdlIDogJ2VuX3VzJzsKCmF0aC5pc01vYmlsZVNhZmFyaSA9IGF0aC5pc0lEZXZpY2UgJiYgX3VhLmluZGV4T2YoJ1NhZmFyaScpID4gLTEgJiYgX3VhLmluZGV4T2YoJ0NyaU9TJykgPCAwOwphdGguT1MgPSBhdGguaXNJRGV2aWNlID8gJ2lvcycgOiBhdGguaXNNb2JpbGVDaHJvbWUgPyAnYW5kcm9pZCcgOiBhdGguaXNNb2JpbGVJRSA/ICd3aW5kb3dzJyA6ICd1bnN1cHBvcnRlZCc7CgphdGguT1NWZXJzaW9uID0gX3VhLm1hdGNoKC8oT1N8QW5kcm9pZCkgKFxkK1tfXC5dXGQrKS8pOwphdGguT1NWZXJzaW9uID0gYXRoLk9TVmVyc2lvbiAmJiBhdGguT1NWZXJzaW9uWzJdID8gK2F0aC5PU1ZlcnNpb25bMl0ucmVwbGFjZSgnXycsICcuJykgOiAwOwoKYXRoLmlzU3RhbmRhbG9uZSA9IHdpbmRvdy5uYXZpZ2F0b3Iuc3RhbmRhbG9uZSB8fCAoIGF0aC5pc01vYmlsZUNocm9tZSAmJiAoIHNjcmVlbi5oZWlnaHQgLSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0IDwgNDAgKSApOwkvLyBUT0RPOiBjaGVjayB0aGUgbGFtZSBwb2x5ZmlsbAphdGguaXNUYWJsZXQgPSAoYXRoLmlzTW9iaWxlU2FmYXJpICYmIF91YS5pbmRleE9mKCdpUGFkJykgPiAtMSkgfHwgKGF0aC5pc01vYmlsZUNocm9tZSAmJiBfdWEuaW5kZXhPZignTW9iaWxlJykgPCAwKTsKCmF0aC5pc0NvbXBhdGlibGUgPSAoYXRoLmlzTW9iaWxlU2FmYXJpICYmIGF0aC5PU1ZlcnNpb24gPj0gNikgfHwgYXRoLmlzTW9iaWxlQ2hyb21lOwkvLyBUT0RPOiBhZGQgd2lucGhvbmUKCnZhciBfZGVmYXVsdFNlc3Npb24gPSB7CglsYXN0RGlzcGxheVRpbWU6IDAsCQkJLy8gbGFzdCB0aW1lIHdlIGRpc3BsYXllZCB0aGUgbWVzc2FnZQoJcmV0dXJuaW5nVmlzaXRvcjogZmFsc2UsCS8vIGlzIHRoaXMgdGhlIGZpcnN0IHRpbWUgeW91IHZpc2l0CglkaXNwbGF5Q291bnQ6IDAsCQkJLy8gbnVtYmVyIG9mIHRpbWVzIHRoZSBtZXNzYWdlIGhhcyBiZWVuIHNob3duCglvcHRlZG91dDogZmFsc2UsCQkJLy8gaGFzIHRoZSB1c2VyIG9wdGVkIG91dAoJYWRkZWQ6IGZhbHNlCQkJCS8vIGhhcyBiZWVuIGFjdHVhbGx5IGFkZGVkIHRvIHRoZSBob21lc2NyZWVuCn07CgphdGgucmVtb3ZlU2Vzc2lvbiA9IGZ1bmN0aW9uIChhcHBJRCkgewoJdHJ5IHsKCQlsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShhcHBJRCB8fCBhdGguZGVmYXVsdHMuYXBwSUQpOwoJfSBjYXRjaCAoZSkgewoJCS8vIHdlIGFyZSBtb3N0IGxpa2VseSBpbiBwcml2YXRlIG1vZGUKCX0KfTsKCmF0aC5DbGFzcyA9IGZ1bmN0aW9uIChvcHRpb25zKSB7CgkvLyBtZXJnZSBkZWZhdWx0IG9wdGlvbnMgd2l0aCB1c2VyIGNvbmZpZwoJdGhpcy5vcHRpb25zID0gX2V4dGVuZCh7fSwgYXRoLmRlZmF1bHRzKTsKCV9leHRlbmQodGhpcy5vcHRpb25zLCBvcHRpb25zKTsKCgkvLyBub3JtYWxpemUgc29tZSBvcHRpb25zCgl0aGlzLm9wdGlvbnMubWFuZGF0b3J5ID0gdGhpcy5vcHRpb25zLm1hbmRhdG9yeSAmJiAoICdzdGFuZGFsb25lJyBpbiB3aW5kb3cubmF2aWdhdG9yIHx8IHRoaXMub3B0aW9ucy5kZWJ1ZyApOwoJdGhpcy5vcHRpb25zLm1vZGFsID0gdGhpcy5vcHRpb25zLm1vZGFsIHx8IHRoaXMub3B0aW9ucy5tYW5kYXRvcnk7CglpZiAoIHRoaXMub3B0aW9ucy5tYW5kYXRvcnkgKSB7CgkJdGhpcy5vcHRpb25zLnN0YXJ0RGVsYXkgPSAtMC41OwkJLy8gbWFrZSB0aGUgcG9wdXAgaGFzdHkKCX0KCXRoaXMub3B0aW9ucy5kZXRlY3RIb21lc2NyZWVuID0gdGhpcy5vcHRpb25zLmRldGVjdEhvbWVzY3JlZW4gPT09IHRydWUgPyAnaGFzaCcgOiB0aGlzLm9wdGlvbnMuZGV0ZWN0SG9tZXNjcmVlbjsKCgkvLyBzZXR1cCB0aGUgZGVidWcgZW52aXJvbm1lbnQKCWlmICggdGhpcy5vcHRpb25zLmRlYnVnICkgewoJCWF0aC5pc0NvbXBhdGlibGUgPSB0cnVlOwoJCWF0aC5PUyA9IHR5cGVvZiB0aGlzLm9wdGlvbnMuZGVidWcgPT0gJ3N0cmluZycgPyB0aGlzLm9wdGlvbnMuZGVidWcgOiBhdGguT1MgPT0gJ3Vuc3VwcG9ydGVkJyA/ICdhbmRyb2lkJyA6IGF0aC5PUzsKCQlhdGguT1NWZXJzaW9uID0gYXRoLk9TID09ICdpb3MnID8gJzgnIDogJzQnOwoJfQoKCS8vIHRoZSBlbGVtZW50IHRoZSBtZXNzYWdlIHdpbGwgYmUgYXBwZW5kZWQgdG8KCXRoaXMuY29udGFpbmVyID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50OwoKCS8vIGxvYWQgc2Vzc2lvbgoJdGhpcy5zZXNzaW9uID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0odGhpcy5vcHRpb25zLmFwcElEKTsKCXRoaXMuc2Vzc2lvbiA9IHRoaXMuc2Vzc2lvbiA/IEpTT04ucGFyc2UodGhpcy5zZXNzaW9uKSA6IHVuZGVmaW5lZDsKCgkvLyB1c2VyIG1vc3QgbGlrZWx5IGNhbWUgZnJvbSBhIGRpcmVjdCBsaW5rIGNvbnRhaW5pbmcgb3VyIHRva2VuLCB3ZSBkb24ndCBuZWVkIGl0IGFuZCB3ZSByZW1vdmUgaXQKCWlmICggYXRoLmhhc1Rva2VuICYmICggIWF0aC5pc0NvbXBhdGlibGUgfHwgIXRoaXMuc2Vzc2lvbiApICkgewoJCWF0aC5oYXNUb2tlbiA9IGZhbHNlOwoJCV9yZW1vdmVUb2tlbigpOwoJfQoKCS8vIHRoZSBkZXZpY2UgaXMgbm90IHN1cHBvcnRlZAoJaWYgKCAhYXRoLmlzQ29tcGF0aWJsZSApIHsKCQlyZXR1cm47Cgl9CgoJdGhpcy5zZXNzaW9uID0gdGhpcy5zZXNzaW9uIHx8IF9kZWZhdWx0U2Vzc2lvbjsKCgkvLyBjaGVjayBpZiB3ZSBjYW4gdXNlIHRoZSBsb2NhbCBzdG9yYWdlCgl0cnkgewoJCWxvY2FsU3RvcmFnZS5zZXRJdGVtKHRoaXMub3B0aW9ucy5hcHBJRCwgSlNPTi5zdHJpbmdpZnkodGhpcy5zZXNzaW9uKSk7CgkJYXRoLmhhc0xvY2FsU3RvcmFnZSA9IHRydWU7Cgl9IGNhdGNoIChlKSB7CgkJLy8gd2UgYXJlIG1vc3QgbGlrZWx5IGluIHByaXZhdGUgbW9kZQoJCWF0aC5oYXNMb2NhbFN0b3JhZ2UgPSBmYWxzZTsKCgkJaWYgKCB0aGlzLm9wdGlvbnMub25Qcml2YXRlICkgewoJCQl0aGlzLm9wdGlvbnMub25Qcml2YXRlLmNhbGwodGhpcyk7CgkJfQoJfQoKCS8vIGNoZWNrIGlmIHRoaXMgaXMgYSB2YWxpZCBsb2NhdGlvbgoJdmFyIGlzVmFsaWRMb2NhdGlvbiA9ICF0aGlzLm9wdGlvbnMudmFsaWRMb2NhdGlvbi5sZW5ndGg7Cglmb3IgKCB2YXIgaSA9IHRoaXMub3B0aW9ucy52YWxpZExvY2F0aW9uLmxlbmd0aDsgaS0tOyApIHsKCQlpZiAoIHRoaXMub3B0aW9ucy52YWxpZExvY2F0aW9uW2ldLnRlc3QoZG9jdW1lbnQubG9jYXRpb24uaHJlZikgKSB7CgkJCWlzVmFsaWRMb2NhdGlvbiA9IHRydWU7CgkJCWJyZWFrOwoJCX0KCX0KCgkvLyBjaGVjayBjb21wYXRpYmlsaXR5IHdpdGggb2xkIHZlcnNpb25zIG9mIGFkZCB0byBob21lc2NyZWVuLiBPcHQtb3V0IGlmIGFuIG9sZCBzZXNzaW9uIGlzIGZvdW5kCglpZiAoIGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdhZGRUb0hvbWUnKSApIHsKCQl0aGlzLm9wdE91dCgpOwoJfQoKCS8vIGNyaXRpY2FsIGVycm9yczoKCS8vIHVzZXIgb3B0ZWQgb3V0LCBhbHJlYWR5IGFkZGVkIHRvIHRoZSBob21lc2NyZWVuLCBub3QgYSB2YWxpZCBsb2NhdGlvbgoJaWYgKCB0aGlzLnNlc3Npb24ub3B0ZWRvdXQgfHwgdGhpcy5zZXNzaW9uLmFkZGVkIHx8ICFpc1ZhbGlkTG9jYXRpb24gKSB7CgkJcmV0dXJuOwoJfQoKCS8vIGNoZWNrIGlmIHRoZSBhcHAgaXMgaW4gc3RhbmQgYWxvbmUgbW9kZQoJaWYgKCBhdGguaXNTdGFuZGFsb25lICkgewoJCS8vIGV4ZWN1dGUgdGhlIG9uQWRkIGV2ZW50IGlmIHdlIGhhdmVuJ3QgYWxyZWFkeQoJCWlmICggIXRoaXMuc2Vzc2lvbi5hZGRlZCApIHsKCQkJdGhpcy5zZXNzaW9uLmFkZGVkID0gdHJ1ZTsKCQkJdGhpcy51cGRhdGVTZXNzaW9uKCk7CgoJCQlpZiAoIHRoaXMub3B0aW9ucy5vbkFkZCAmJiBhdGguaGFzTG9jYWxTdG9yYWdlICkgewkvLyBkb3VibGUgY2hlY2sgb24gbG9jYWxzdG9yYWdlIHRvIGF2b2lkIG11bHRpcGxlIGNhbGxzIHRvIHRoZSBjdXN0b20gZXZlbnQKCQkJCXRoaXMub3B0aW9ucy5vbkFkZC5jYWxsKHRoaXMpOwoJCQl9CgkJfQoKCQlyZXR1cm47Cgl9CgoJLy8gKHRyeSB0bykgY2hlY2sgaWYgdGhlIHBhZ2UgaGFzIGJlZW4gYWRkZWQgdG8gdGhlIGhvbWVzY3JlZW4KCWlmICggdGhpcy5vcHRpb25zLmRldGVjdEhvbWVzY3JlZW4gKSB7CgkJLy8gdGhlIFVSTCBoYXMgdGhlIHRva2VuLCB3ZSBhcmUgbGlrZWx5IGNvbWluZyBmcm9tIHRoZSBob21lc2NyZWVuCgkJaWYgKCBhdGguaGFzVG9rZW4gKSB7CgkJCV9yZW1vdmVUb2tlbigpOwkJLy8gd2UgZG9uJ3QgYWN0dWFsbHkgbmVlZCB0aGUgdG9rZW4gYW55bW9yZSwgd2UgcmVtb3ZlIGl0IHRvIHByZXZlbnQgcmVkaXN0cmlidXRpb24KCgkJCS8vIHRoaXMgaXMgY2FsbGVkIHRoZSBmaXJzdCB0aW1lIHRoZSB1c2VyIG9wZW5zIHRoZSBhcHAgZnJvbSB0aGUgaG9tZXNjcmVlbgoJCQlpZiAoICF0aGlzLnNlc3Npb24uYWRkZWQgKSB7CgkJCQl0aGlzLnNlc3Npb24uYWRkZWQgPSB0cnVlOwoJCQkJdGhpcy51cGRhdGVTZXNzaW9uKCk7CgoJCQkJaWYgKCB0aGlzLm9wdGlvbnMub25BZGQgJiYgYXRoLmhhc0xvY2FsU3RvcmFnZSApIHsJLy8gZG91YmxlIGNoZWNrIG9uIGxvY2Fsc3RvcmFnZSB0byBhdm9pZCBtdWx0aXBsZSBjYWxscyB0byB0aGUgY3VzdG9tIGV2ZW50CgkJCQkJdGhpcy5vcHRpb25zLm9uQWRkLmNhbGwodGhpcyk7CgkJCQl9CgkJCX0KCgkJCXJldHVybjsKCQl9CgoJCS8vIFVSTCBkb2Vzbid0IGhhdmUgdGhlIHRva2VuLCBzbyBhZGQgaXQKCQlpZiAoIHRoaXMub3B0aW9ucy5kZXRlY3RIb21lc2NyZWVuID09ICdoYXNoJyApIHsKCQkJaGlzdG9yeS5yZXBsYWNlU3RhdGUoJycsIHdpbmRvdy5kb2N1bWVudC50aXRsZSwgZG9jdW1lbnQubG9jYXRpb24uaHJlZiArICcjYXRoJyk7CgkJfSBlbHNlIGlmICggdGhpcy5vcHRpb25zLmRldGVjdEhvbWVzY3JlZW4gPT0gJ3NtYXJ0VVJMJyApIHsKCQkJaGlzdG9yeS5yZXBsYWNlU3RhdGUoJycsIHdpbmRvdy5kb2N1bWVudC50aXRsZSwgZG9jdW1lbnQubG9jYXRpb24uaHJlZi5yZXBsYWNlKC8oXC8pPyQvLCAnL2F0aCQxJykpOwoJCX0gZWxzZSB7CgkJCWhpc3RvcnkucmVwbGFjZVN0YXRlKCcnLCB3aW5kb3cuZG9jdW1lbnQudGl0bGUsIGRvY3VtZW50LmxvY2F0aW9uLmhyZWYgKyAoZG9jdW1lbnQubG9jYXRpb24uc2VhcmNoID8gJyYnIDogJz8nICkgKyAnYXRoPScpOwoJCX0KCX0KCgkvLyBjaGVjayBpZiB0aGlzIGlzIGEgcmV0dXJuaW5nIHZpc2l0b3IKCWlmICggIXRoaXMuc2Vzc2lvbi5yZXR1cm5pbmdWaXNpdG9yICkgewoJCXRoaXMuc2Vzc2lvbi5yZXR1cm5pbmdWaXNpdG9yID0gdHJ1ZTsKCQl0aGlzLnVwZGF0ZVNlc3Npb24oKTsKCgkJLy8gd2UgZG8gbm90IHNob3cgdGhlIG1lc3NhZ2UgaWYgdGhpcyBpcyB5b3VyIGZpcnN0IHZpc2l0CgkJaWYgKCB0aGlzLm9wdGlvbnMuc2tpcEZpcnN0VmlzaXQgKSB7CgkJCXJldHVybjsKCQl9Cgl9CgoJLy8gd2UgZG8gbm8gc2hvdyB0aGUgbWVzc2FnZSBpbiBwcml2YXRlIG1vZGUKCWlmICggIWF0aC5oYXNMb2NhbFN0b3JhZ2UgKSB7CgkJcmV0dXJuOwoJfQoKCS8vIGFsbCBjaGVja3MgcGFzc2VkLCByZWFkeSB0byBkaXNwbGF5Cgl0aGlzLnJlYWR5ID0gdHJ1ZTsKCglpZiAoIHRoaXMub3B0aW9ucy5vbkluaXQgKSB7CgkJdGhpcy5vcHRpb25zLm9uSW5pdC5jYWxsKHRoaXMpOwoJfQoKCWlmICggdGhpcy5vcHRpb25zLmF1dG9zdGFydCApIHsKCQl0aGlzLnNob3coKTsKCX0KfTsKCmF0aC5DbGFzcy5wcm90b3R5cGUgPSB7CgkvLyBldmVudCB0eXBlIHRvIG1ldGhvZCBjb252ZXJzaW9uCglldmVudHM6IHsKCQlsb2FkOiAnX2RlbGF5ZWRTaG93JywKCQllcnJvcjogJ19kZWxheWVkU2hvdycsCgkJb3JpZW50YXRpb25jaGFuZ2U6ICdyZXNpemUnLAoJCXJlc2l6ZTogJ3Jlc2l6ZScsCgkJc2Nyb2xsOiAncmVzaXplJywKCQljbGljazogJ3JlbW92ZScsCgkJdG91Y2htb3ZlOiAnX3ByZXZlbnREZWZhdWx0JywKCQl0cmFuc2l0aW9uZW5kOiAnX3JlbW92ZUVsZW1lbnRzJywKCQl3ZWJraXRUcmFuc2l0aW9uRW5kOiAnX3JlbW92ZUVsZW1lbnRzJywKCQlNU1RyYW5zaXRpb25FbmQ6ICdfcmVtb3ZlRWxlbWVudHMnCgl9LAoKCWhhbmRsZUV2ZW50OiBmdW5jdGlvbiAoZSkgewoJCXZhciB0eXBlID0gdGhpcy5ldmVudHNbZS50eXBlXTsKCQlpZiAoIHR5cGUgKSB7CgkJCXRoaXNbdHlwZV0oZSk7CgkJfQoJfSwKCglzaG93OiBmdW5jdGlvbiAoZm9yY2UpIHsKCQkvLyBpbiBhdXRvc3RhcnQgbW9kZSB3YWl0IGZvciB0aGUgZG9jdW1lbnQgdG8gYmUgcmVhZHkKCQlpZiAoIHRoaXMub3B0aW9ucy5hdXRvc3RhcnQgJiYgIV9ET01SZWFkeSApIHsKCQkJc2V0VGltZW91dCh0aGlzLnNob3cuYmluZCh0aGlzKSwgNTApOwoJCQlyZXR1cm47CgkJfQoKCQkvLyBtZXNzYWdlIGFscmVhZHkgb24gc2NyZWVuCgkJaWYgKCB0aGlzLnNob3duICkgewoJCQlyZXR1cm47CgkJfQoKCQl2YXIgbm93ID0gRGF0ZS5ub3coKTsKCQl2YXIgbGFzdERpc3BsYXlUaW1lID0gdGhpcy5zZXNzaW9uLmxhc3REaXNwbGF5VGltZTsKCgkJaWYgKCBmb3JjZSAhPT0gdHJ1ZSApIHsKCQkJLy8gdGhpcyBpcyBuZWVkZWQgaWYgYXV0b3N0YXJ0IGlzIGRpc2FibGVkIGFuZCB5b3UgcHJvZ3JhbW1hdGljYWxseSBjYWxsIHRoZSBzaG93KCkgbWV0aG9kCgkJCWlmICggIXRoaXMucmVhZHkgKSB7CgkJCQlyZXR1cm47CgkJCX0KCgkJCS8vIHdlIG9iZXkgdGhlIGRpc3BsYXkgcGFjZSAocHJldmVudCB0aGUgbWVzc2FnZSB0byBwb3B1cCB0b28gb2Z0ZW4pCgkJCWlmICggbm93IC0gbGFzdERpc3BsYXlUaW1lIDwgdGhpcy5vcHRpb25zLmRpc3BsYXlQYWNlICogNjAwMDAgKSB7CgkJCQlyZXR1cm47CgkJCX0KCgkJCS8vIG9iZXkgdGhlIG1heGltdW0gbnVtYmVyIG9mIGRpc3BsYXkgY291bnQKCQkJaWYgKCB0aGlzLm9wdGlvbnMubWF4RGlzcGxheUNvdW50ICYmIHRoaXMuc2Vzc2lvbi5kaXNwbGF5Q291bnQgPj0gdGhpcy5vcHRpb25zLm1heERpc3BsYXlDb3VudCApIHsKCQkJCXJldHVybjsKCQkJfQoJCX0KCgkJdGhpcy5zaG93biA9IHRydWU7CgoJCS8vIGluY3JlbWVudCB0aGUgZGlzcGxheSBjb3VudAoJCXRoaXMuc2Vzc2lvbi5sYXN0RGlzcGxheVRpbWUgPSBub3c7CgkJdGhpcy5zZXNzaW9uLmRpc3BsYXlDb3VudCsrOwoJCXRoaXMudXBkYXRlU2Vzc2lvbigpOwoKCQkvLyB0cnkgdG8gZ2V0IHRoZSBoaWdoZXN0IHJlc29sdXRpb24gYXBwbGljYXRpb24gaWNvbgoJCWlmICggIXRoaXMuYXBwbGljYXRpb25JY29uICkgewoJCQlpZiAoIGF0aC5PUyA9PSAnaW9zJyApIHsKCQkJCXRoaXMuYXBwbGljYXRpb25JY29uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignaGVhZCBsaW5rW3JlbF49YXBwbGUtdG91Y2gtaWNvbl1bc2l6ZXM9IjE1MngxNTIiXSxoZWFkIGxpbmtbcmVsXj1hcHBsZS10b3VjaC1pY29uXVtzaXplcz0iMTQ0eDE0NCJdLGhlYWQgbGlua1tyZWxePWFwcGxlLXRvdWNoLWljb25dW3NpemVzPSIxMjB4MTIwIl0saGVhZCBsaW5rW3JlbF49YXBwbGUtdG91Y2gtaWNvbl1bc2l6ZXM9IjExNHgxMTQiXSxoZWFkIGxpbmtbcmVsXj1hcHBsZS10b3VjaC1pY29uXScpOwoJCQl9IGVsc2UgewoJCQkJdGhpcy5hcHBsaWNhdGlvbkljb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdoZWFkIGxpbmtbcmVsXj0ic2hvcnRjdXQgaWNvbiJdW3NpemVzPSIxOTZ4MTk2Il0saGVhZCBsaW5rW3JlbF49YXBwbGUtdG91Y2gtaWNvbl0nKTsKCQkJfQoJCX0KCgkJdmFyIG1lc3NhZ2UgPSAnJzsKCgkJaWYgKCB0aGlzLm9wdGlvbnMubWVzc2FnZSBpbiBhdGguaW50bCApIHsJCS8vIHlvdSBjYW4gZm9yY2UgdGhlIGxvY2FsZQoJCQltZXNzYWdlID0gYXRoLmludGxbdGhpcy5vcHRpb25zLm1lc3NhZ2VdLm1lc3NhZ2UucmVwbGFjZSgnJWFjdGlvbicsIGF0aC5pbnRsW3RoaXMub3B0aW9ucy5tZXNzYWdlXS5hY3Rpb25bYXRoLk9TXSk7CgkJfSBlbHNlIGlmICggdGhpcy5vcHRpb25zLm1lc3NhZ2UgIT09ICcnICkgewkJLy8gb3IgdXNlIGEgY3VzdG9tIG1lc3NhZ2UKCQkJbWVzc2FnZSA9IHRoaXMub3B0aW9ucy5tZXNzYWdlOwoJCX0gZWxzZSB7CQkJCQkJCQkJCS8vIG90aGVyd2lzZSB3ZSB1c2Ugb3VyIG1lc3NhZ2UKCQkJbWVzc2FnZSA9IGF0aC5pbnRsW2F0aC5sYW5ndWFnZV0ubWVzc2FnZS5yZXBsYWNlKCclYWN0aW9uJywgYXRoLmludGxbYXRoLmxhbmd1YWdlXS5hY3Rpb25bYXRoLk9TXSk7CgkJfQoKCQkvLyBhZGQgdGhlIGFjdGlvbiBpY29uCgkJbWVzc2FnZSA9ICc8cD4nICsgbWVzc2FnZS5yZXBsYWNlKCclaWNvbicsICc8c3BhbiBjbGFzcz0iYXRoLWFjdGlvbi1pY29uIj5pY29uPC9zcGFuPicpICsgJzwvcD4nOwoKCQkvLyBjcmVhdGUgdGhlIG1lc3NhZ2UgY29udGFpbmVyCgkJdGhpcy52aWV3cG9ydCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwoJCXRoaXMudmlld3BvcnQuY2xhc3NOYW1lID0gJ2F0aC12aWV3cG9ydCc7CgkJaWYgKCB0aGlzLm9wdGlvbnMubW9kYWwgKSB7CgkJCXRoaXMudmlld3BvcnQuY2xhc3NOYW1lICs9ICcgYXRoLW1vZGFsJzsKCQl9CgkJaWYgKCB0aGlzLm9wdGlvbnMubWFuZGF0b3J5ICkgewoJCQl0aGlzLnZpZXdwb3J0LmNsYXNzTmFtZSArPSAnIGF0aC1tYW5kYXRvcnknOwoJCX0KCQl0aGlzLnZpZXdwb3J0LnN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJzsKCgkJLy8gY3JlYXRlIHRoZSBhY3R1YWwgbWVzc2FnZSBlbGVtZW50CgkJdGhpcy5lbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CgkJdGhpcy5lbGVtZW50LmNsYXNzTmFtZSA9ICdhdGgtY29udGFpbmVyIGF0aC0nICsgYXRoLk9TICsgJyBhdGgtJyArIGF0aC5PUyArIChhdGguT1NWZXJzaW9uICsgJycpLnN1YnN0cigwLDEpICsgJyBhdGgtJyArIChhdGguaXNUYWJsZXQgPyAndGFibGV0JyA6ICdwaG9uZScpOwoJCXRoaXMuZWxlbWVudC5zdHlsZS5jc3NUZXh0ID0gJy13ZWJraXQtdHJhbnNpdGlvbi1wcm9wZXJ0eTotd2Via2l0LXRyYW5zZm9ybSxvcGFjaXR5Oy13ZWJraXQtdHJhbnNpdGlvbi1kdXJhdGlvbjowOy13ZWJraXQtdHJhbnNmb3JtOnRyYW5zbGF0ZTNkKDAsMCwwKTt0cmFuc2l0aW9uLXByb3BlcnR5OnRyYW5zZm9ybSxvcGFjaXR5O3RyYW5zaXRpb24tZHVyYXRpb246MDt0cmFuc2Zvcm06dHJhbnNsYXRlM2QoMCwwLDApOy13ZWJraXQtdHJhbnNpdGlvbi10aW1pbmctZnVuY3Rpb246ZWFzZS1vdXQnOwoJCXRoaXMuZWxlbWVudC5zdHlsZS53ZWJraXRUcmFuc2Zvcm0gPSAndHJhbnNsYXRlM2QoMCwtJyArIHdpbmRvdy5pbm5lckhlaWdodCArICdweCwwKSc7CgkJdGhpcy5lbGVtZW50LnN0eWxlLndlYmtpdFRyYW5zaXRpb25EdXJhdGlvbiA9ICcwcyc7CgoJCS8vIGFkZCB0aGUgYXBwbGljYXRpb24gaWNvbgoJCWlmICggdGhpcy5vcHRpb25zLmljb24gJiYgdGhpcy5hcHBsaWNhdGlvbkljb24gKSB7CgkJCXRoaXMuZWxlbWVudC5jbGFzc05hbWUgKz0gJyBhdGgtaWNvbic7CgkJCXRoaXMuaW1nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7CgkJCXRoaXMuaW1nLmNsYXNzTmFtZSA9ICdhdGgtYXBwbGljYXRpb24taWNvbic7CgkJCXRoaXMuaW1nLmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCB0aGlzLCBmYWxzZSk7CgkJCXRoaXMuaW1nLmFkZEV2ZW50TGlzdGVuZXIoJ2Vycm9yJywgdGhpcywgZmFsc2UpOwoKCQkJdGhpcy5pbWcuc3JjID0gdGhpcy5hcHBsaWNhdGlvbkljb24uaHJlZjsKCQkJdGhpcy5lbGVtZW50LmFwcGVuZENoaWxkKHRoaXMuaW1nKTsKCQl9CgoJCXRoaXMuZWxlbWVudC5pbm5lckhUTUwgKz0gbWVzc2FnZTsKCgkJLy8gd2UgYXJlIG5vdCByZWFkeSB0byBzaG93LCBwbGFjZSB0aGUgbWVzc2FnZSBvdXQgb2Ygc2lnaHQKCQl0aGlzLnZpZXdwb3J0LnN0eWxlLmxlZnQgPSAnLTk5OTk5ZW0nOwoKCQkvLyBhdHRhY2ggYWxsIGVsZW1lbnRzIHRvIHRoZSBET00KCQl0aGlzLnZpZXdwb3J0LmFwcGVuZENoaWxkKHRoaXMuZWxlbWVudCk7CgkJdGhpcy5jb250YWluZXIuYXBwZW5kQ2hpbGQodGhpcy52aWV3cG9ydCk7CgoJCS8vIGlmIHdlIGRvbid0IGhhdmUgdG8gd2FpdCBmb3IgYW4gaW1hZ2UgdG8gbG9hZCwgc2hvdyB0aGUgbWVzc2FnZSByaWdodCBhd2F5CgkJaWYgKCAhdGhpcy5pbWcgKSB7CgkJCXRoaXMuX2RlbGF5ZWRTaG93KCk7CgkJfQoJfSwKCglfZGVsYXllZFNob3c6IGZ1bmN0aW9uIChlKSB7CgkJc2V0VGltZW91dCh0aGlzLl9zaG93LmJpbmQodGhpcyksIHRoaXMub3B0aW9ucy5zdGFydERlbGF5ICogMTAwMCArIDUwMCk7Cgl9LAoKCV9zaG93OiBmdW5jdGlvbiAoKSB7CgkJdmFyIHRoYXQgPSB0aGlzOwoKCQkvLyB1cGRhdGUgdGhlIHZpZXdwb3J0IHNpemUgYW5kIG9yaWVudGF0aW9uCgkJdGhpcy51cGRhdGVWaWV3cG9ydCgpOwoKCQkvLyByZXBvc2l0aW9uL3Jlc2l6ZSB0aGUgbWVzc2FnZSBvbiBvcmllbnRhdGlvbiBjaGFuZ2UKCQl3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgdGhpcywgZmFsc2UpOwoJCXdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdzY3JvbGwnLCB0aGlzLCBmYWxzZSk7CgkJd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ29yaWVudGF0aW9uY2hhbmdlJywgdGhpcywgZmFsc2UpOwoKCQlpZiAoIHRoaXMub3B0aW9ucy5tb2RhbCApIHsKCQkJLy8gbG9jayBhbnkgb3RoZXIgaW50ZXJhY3Rpb24KCQkJZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2htb3ZlJywgdGhpcywgdHJ1ZSk7CgkJfQoKCQkvLyBFbmFibGUgY2xvc2luZyBhZnRlciAxIHNlY29uZAoJCWlmICggIXRoaXMub3B0aW9ucy5tYW5kYXRvcnkgKSB7CgkJCXNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewoJCQkJdGhhdC5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhhdCwgdHJ1ZSk7CgkJCX0sIDEwMDApOwoJCX0KCgkJLy8ga2ljayB0aGUgYW5pbWF0aW9uCgkJc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CgkJCXRoYXQuZWxlbWVudC5zdHlsZS53ZWJraXRUcmFuc2Zvcm0gPSAndHJhbnNsYXRlM2QoMCwwLDApJzsKCQkJdGhhdC5lbGVtZW50LnN0eWxlLndlYmtpdFRyYW5zaXRpb25EdXJhdGlvbiA9ICcxLjJzJzsKCQl9LCAwKTsKCgkJLy8gc2V0IHRoZSBkZXN0cm95IHRpbWVyCgkJaWYgKCB0aGlzLm9wdGlvbnMubGlmZXNwYW4gKSB7CgkJCXRoaXMucmVtb3ZlVGltZXIgPSBzZXRUaW1lb3V0KHRoaXMucmVtb3ZlLmJpbmQodGhpcyksIHRoaXMub3B0aW9ucy5saWZlc3BhbiAqIDEwMDApOwoJCX0KCgkJLy8gZmlyZSB0aGUgY3VzdG9tIG9uU2hvdyBldmVudAoJCWlmICggdGhpcy5vcHRpb25zLm9uU2hvdyApIHsKCQkJdGhpcy5vcHRpb25zLm9uU2hvdy5jYWxsKHRoaXMpOwoJCX0KCX0sCgoJcmVtb3ZlOiBmdW5jdGlvbiAoKSB7CgkJY2xlYXJUaW1lb3V0KHRoaXMucmVtb3ZlVGltZXIpOwoKCQkvLyBjbGVhciB1cCB0aGUgZXZlbnQgbGlzdGVuZXJzCgkJaWYgKCB0aGlzLmltZyApIHsKCQkJdGhpcy5pbWcucmVtb3ZlRXZlbnRMaXN0ZW5lcignbG9hZCcsIHRoaXMsIGZhbHNlKTsKCQkJdGhpcy5pbWcucmVtb3ZlRXZlbnRMaXN0ZW5lcignZXJyb3InLCB0aGlzLCBmYWxzZSk7CgkJfQoKCQl3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigncmVzaXplJywgdGhpcywgZmFsc2UpOwoJCXdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdzY3JvbGwnLCB0aGlzLCBmYWxzZSk7CgkJd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ29yaWVudGF0aW9uY2hhbmdlJywgdGhpcywgZmFsc2UpOwoJCWRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RvdWNobW92ZScsIHRoaXMsIHRydWUpOwoJCXRoaXMuZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMsIHRydWUpOwoKCQkvLyByZW1vdmUgdGhlIG1lc3NhZ2UgZWxlbWVudCBvbiB0cmFuc2l0aW9uIGVuZAoJCXRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCd0cmFuc2l0aW9uZW5kJywgdGhpcywgZmFsc2UpOwoJCXRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCd3ZWJraXRUcmFuc2l0aW9uRW5kJywgdGhpcywgZmFsc2UpOwoJCXRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdNU1RyYW5zaXRpb25FbmQnLCB0aGlzLCBmYWxzZSk7CgoJCS8vIHN0YXJ0IHRoZSBmYWRlIG91dCBhbmltYXRpb24KCQl0aGlzLmVsZW1lbnQuc3R5bGUud2Via2l0VHJhbnNpdGlvbkR1cmF0aW9uID0gJzAuM3MnOwoJCXRoaXMuZWxlbWVudC5zdHlsZS5vcGFjaXR5ID0gJzAnOwoJfSwKCglfcmVtb3ZlRWxlbWVudHM6IGZ1bmN0aW9uICgpIHsKCQl0aGlzLmVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigndHJhbnNpdGlvbmVuZCcsIHRoaXMsIGZhbHNlKTsKCQl0aGlzLmVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignd2Via2l0VHJhbnNpdGlvbkVuZCcsIHRoaXMsIGZhbHNlKTsKCQl0aGlzLmVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignTVNUcmFuc2l0aW9uRW5kJywgdGhpcywgZmFsc2UpOwoKCQkvLyByZW1vdmUgdGhlIG1lc3NhZ2UgZnJvbSB0aGUgRE9NCgkJdGhpcy5jb250YWluZXIucmVtb3ZlQ2hpbGQodGhpcy52aWV3cG9ydCk7CgoJCXRoaXMuc2hvd24gPSBmYWxzZTsKCgkJLy8gZmlyZSB0aGUgY3VzdG9tIG9uUmVtb3ZlIGV2ZW50CgkJaWYgKCB0aGlzLm9wdGlvbnMub25SZW1vdmUgKSB7CgkJCXRoaXMub3B0aW9ucy5vblJlbW92ZS5jYWxsKHRoaXMpOwoJCX0KCX0sCgoJdXBkYXRlVmlld3BvcnQ6IGZ1bmN0aW9uICgpIHsKCQlpZiAoICF0aGlzLnNob3duICkgewoJCQlyZXR1cm47CgkJfQoKCQl0aGlzLnZpZXdwb3J0LnN0eWxlLndpZHRoID0gd2luZG93LmlubmVyV2lkdGggKyAncHgnOwoJCXRoaXMudmlld3BvcnQuc3R5bGUuaGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0ICsgJ3B4JzsKCQl0aGlzLnZpZXdwb3J0LnN0eWxlLmxlZnQgPSB3aW5kb3cuc2Nyb2xsWCArICdweCc7CgkJdGhpcy52aWV3cG9ydC5zdHlsZS50b3AgPSB3aW5kb3cuc2Nyb2xsWSArICdweCc7CgoJCXZhciBjbGllbnRXaWR0aCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aDsKCgkJdGhpcy5vcmllbnRhdGlvbiA9IGNsaWVudFdpZHRoID4gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCA/ICdsYW5kc2NhcGUnIDogJ3BvcnRyYWl0JzsKCgkJdmFyIHNjcmVlbldpZHRoID0gYXRoLk9TID09ICdpb3MnID8gdGhpcy5vcmllbnRhdGlvbiA9PSAncG9ydHJhaXQnID8gc2NyZWVuLndpZHRoIDogc2NyZWVuLmhlaWdodCA6IHNjcmVlbi53aWR0aDsKCQl0aGlzLnNjYWxlID0gc2NyZWVuLndpZHRoID4gY2xpZW50V2lkdGggPyAxIDogc2NyZWVuV2lkdGggLyB3aW5kb3cuaW5uZXJXaWR0aDsKCgkJdGhpcy5lbGVtZW50LnN0eWxlLmZvbnRTaXplID0gdGhpcy5vcHRpb25zLmZvbnRTaXplIC8gdGhpcy5zY2FsZSArICdweCc7Cgl9LAoKCXJlc2l6ZTogZnVuY3Rpb24gKCkgewoJCWNsZWFyVGltZW91dCh0aGlzLnJlc2l6ZVRpbWVyKTsKCQl0aGlzLnJlc2l6ZVRpbWVyID0gc2V0VGltZW91dCh0aGlzLnVwZGF0ZVZpZXdwb3J0LmJpbmQodGhpcyksIDEwMCk7Cgl9LAoKCXVwZGF0ZVNlc3Npb246IGZ1bmN0aW9uICgpIHsKCQlpZiAoIGF0aC5oYXNMb2NhbFN0b3JhZ2UgPT09IGZhbHNlICkgewoJCQlyZXR1cm47CgkJfQoKCQlsb2NhbFN0b3JhZ2Uuc2V0SXRlbSh0aGlzLm9wdGlvbnMuYXBwSUQsIEpTT04uc3RyaW5naWZ5KHRoaXMuc2Vzc2lvbikpOwoJfSwKCgljbGVhclNlc3Npb246IGZ1bmN0aW9uICgpIHsKCQl0aGlzLnNlc3Npb24gPSBfZGVmYXVsdFNlc3Npb247CgkJdGhpcy51cGRhdGVTZXNzaW9uKCk7Cgl9LAoKCW9wdE91dDogZnVuY3Rpb24gKCkgewoJCXRoaXMuc2Vzc2lvbi5vcHRlZG91dCA9IHRydWU7CgkJdGhpcy51cGRhdGVTZXNzaW9uKCk7Cgl9LAoKCW9wdEluOiBmdW5jdGlvbiAoKSB7CgkJdGhpcy5zZXNzaW9uLm9wdGVkb3V0ID0gZmFsc2U7CgkJdGhpcy51cGRhdGVTZXNzaW9uKCk7Cgl9LAoKCWNsZWFyRGlzcGxheUNvdW50OiBmdW5jdGlvbiAoKSB7CgkJdGhpcy5zZXNzaW9uLmRpc3BsYXlDb3VudCA9IDA7CgkJdGhpcy51cGRhdGVTZXNzaW9uKCk7Cgl9LAoKCV9wcmV2ZW50RGVmYXVsdDogZnVuY3Rpb24gKGUpIHsKCQllLnByZXZlbnREZWZhdWx0KCk7CgkJZS5zdG9wUHJvcGFnYXRpb24oKTsKCX0KfTsKCi8vIHV0aWxpdHkKZnVuY3Rpb24gX2V4dGVuZCAodGFyZ2V0LCBvYmopIHsKCWZvciAoIHZhciBpIGluIG9iaiApIHsKCQl0YXJnZXRbaV0gPSBvYmpbaV07Cgl9CgoJcmV0dXJuIHRhcmdldDsKfQoKZnVuY3Rpb24gX3JlbW92ZVRva2VuICgpIHsKCWlmICggZG9jdW1lbnQubG9jYXRpb24uaGFzaCA9PSAnI2F0aCcgKSB7CgkJaGlzdG9yeS5yZXBsYWNlU3RhdGUoJycsIHdpbmRvdy5kb2N1bWVudC50aXRsZSwgZG9jdW1lbnQubG9jYXRpb24uaHJlZi5zcGxpdCgnIycpWzBdKTsKCX0KCglpZiAoIF9yZVNtYXJ0VVJMLnRlc3QoZG9jdW1lbnQubG9jYXRpb24uaHJlZikgKSB7CgkJaGlzdG9yeS5yZXBsYWNlU3RhdGUoJycsIHdpbmRvdy5kb2N1bWVudC50aXRsZSwgZG9jdW1lbnQubG9jYXRpb24uaHJlZi5yZXBsYWNlKF9yZVNtYXJ0VVJMLCAnJDEnKSk7Cgl9CgoJaWYgKCBfcmVRdWVyeVN0cmluZy50ZXN0KGRvY3VtZW50LmxvY2F0aW9uLnNlYXJjaCkgKSB7CgkJaGlzdG9yeS5yZXBsYWNlU3RhdGUoJycsIHdpbmRvdy5kb2N1bWVudC50aXRsZSwgZG9jdW1lbnQubG9jYXRpb24uaHJlZi5yZXBsYWNlKF9yZVF1ZXJ5U3RyaW5nLCAnJDInKSk7Cgl9Cn0KCi8vIGV4cG9zZSB0byB0aGUgd29ybGQKd2luZG93LmFkZFRvSG9tZXNjcmVlbiA9IGF0aDsKCn0pKHdpbmRvdywgZG9jdW1lbnQpOwo=",
                "headers": {
                    "Accept-Ranges": "bytes",
                    "Last-Modified": "Thu, 06 Nov 2014 06:36:45 GMT",
                    "Content-Length": "20675",
                    "Date": "Thu, 06 Nov 2014 06:36:45 GMT",
                    "Content-Type": "application/javascript"
                },
                "cookies": [],
                "mimeType": "script",
                "host": "localhost",
                "protocol": "http",
                "port": 9999,
                "inScope": false,
                "toolFlag": 16962,
                "referenceID": 0,
                "messageType": "response"
            },
            "messageType": "requestResponse"
        }
    ],
    "inScope": true,
    "messageType": "scanIssue"
}